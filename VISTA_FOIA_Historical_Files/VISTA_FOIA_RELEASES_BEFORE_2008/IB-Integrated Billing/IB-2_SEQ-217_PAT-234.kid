Released IB*2*234 SEQ #217
Extracted from mail message
**KIDS**:IB*2.0*234^

**INSTALL NAME**
IB*2.0*234
"BLD",4344,0)
IB*2.0*234^INTEGRATED BILLING^0^3030904^y
"BLD",4344,1,0)
^^1^1^3030807^^
"BLD",4344,1,1,0)
COMBAT VETERANS INTERIM SOLUTION - PHASE I
"BLD",4344,4,0)
^9.64PA^351.2^1
"BLD",4344,4,351.2,0)
351.2
"BLD",4344,4,351.2,2,0)
^9.641^351.2^1
"BLD",4344,4,351.2,2,351.2,0)
SPECIAL INPATIENT BILLING CASES  (File-top level)
"BLD",4344,4,351.2,2,351.2,1,0)
^9.6411^.03^1
"BLD",4344,4,351.2,2,351.2,1,.03,0)
PATIENT TYPE
"BLD",4344,4,351.2,222)
y^n^p^^^^n^^n
"BLD",4344,4,351.2,224)

"BLD",4344,4,"APDD",351.2,351.2)

"BLD",4344,4,"APDD",351.2,351.2,.03)

"BLD",4344,4,"B",351.2,351.2)

"BLD",4344,"KRN",0)
^9.67PA^8989.52^19
"BLD",4344,"KRN",.4,0)
.4
"BLD",4344,"KRN",.401,0)
.401
"BLD",4344,"KRN",.402,0)
.402
"BLD",4344,"KRN",.403,0)
.403
"BLD",4344,"KRN",.5,0)
.5
"BLD",4344,"KRN",.84,0)
.84
"BLD",4344,"KRN",3.6,0)
3.6
"BLD",4344,"KRN",3.8,0)
3.8
"BLD",4344,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",4344,"KRN",3.8,"NM",1,0)
IB COMBAT VET RX COPAY^^0
"BLD",4344,"KRN",3.8,"NM","B","IB COMBAT VET RX COPAY",1)

"BLD",4344,"KRN",9.2,0)
9.2
"BLD",4344,"KRN",9.8,0)
9.8
"BLD",4344,"KRN",9.8,"NM",0)
^9.68A^8^7
"BLD",4344,"KRN",9.8,"NM",1,0)
IBAMTD^^0^B18317055
"BLD",4344,"KRN",9.8,"NM",2,0)
IBAMTI^^0^B19746737
"BLD",4344,"KRN",9.8,"NM",3,0)
IBAMTI1^^0^B18623119
"BLD",4344,"KRN",9.8,"NM",4,0)
IBARX1^^0^B20695837
"BLD",4344,"KRN",9.8,"NM",6,0)
IBOVOP1^^0^B14596477
"BLD",4344,"KRN",9.8,"NM",7,0)
IBOVOP2^^0^B13264142
"BLD",4344,"KRN",9.8,"NM",8,0)
IBACV^^0^B7385476
"BLD",4344,"KRN",9.8,"NM","B","IBACV",8)

"BLD",4344,"KRN",9.8,"NM","B","IBAMTD",1)

"BLD",4344,"KRN",9.8,"NM","B","IBAMTI",2)

"BLD",4344,"KRN",9.8,"NM","B","IBAMTI1",3)

"BLD",4344,"KRN",9.8,"NM","B","IBARX1",4)

"BLD",4344,"KRN",9.8,"NM","B","IBOVOP1",6)

"BLD",4344,"KRN",9.8,"NM","B","IBOVOP2",7)

"BLD",4344,"KRN",19,0)
19
"BLD",4344,"KRN",19.1,0)
19.1
"BLD",4344,"KRN",101,0)
101
"BLD",4344,"KRN",409.61,0)
409.61
"BLD",4344,"KRN",771,0)
771
"BLD",4344,"KRN",870,0)
870
"BLD",4344,"KRN",8989.51,0)
8989.51
"BLD",4344,"KRN",8989.52,0)
8989.52
"BLD",4344,"KRN",8994,0)
8994
"BLD",4344,"KRN","B",.4,.4)

"BLD",4344,"KRN","B",.401,.401)

"BLD",4344,"KRN","B",.402,.402)

"BLD",4344,"KRN","B",.403,.403)

"BLD",4344,"KRN","B",.5,.5)

"BLD",4344,"KRN","B",.84,.84)

"BLD",4344,"KRN","B",3.6,3.6)

"BLD",4344,"KRN","B",3.8,3.8)

"BLD",4344,"KRN","B",9.2,9.2)

"BLD",4344,"KRN","B",9.8,9.8)

"BLD",4344,"KRN","B",19,19)

"BLD",4344,"KRN","B",19.1,19.1)

"BLD",4344,"KRN","B",101,101)

"BLD",4344,"KRN","B",409.61,409.61)

"BLD",4344,"KRN","B",771,771)

"BLD",4344,"KRN","B",870,870)

"BLD",4344,"KRN","B",8989.51,8989.51)

"BLD",4344,"KRN","B",8989.52,8989.52)

"BLD",4344,"KRN","B",8994,8994)

"BLD",4344,"QUES",0)
^9.62^^
"BLD",4344,"REQB",0)
^9.611^3^3
"BLD",4344,"REQB",1,0)
IB*2.0*176^2
"BLD",4344,"REQB",2,0)
IB*2.0*199^2
"BLD",4344,"REQB",3,0)
DG*5.3*528^2
"BLD",4344,"REQB","B","DG*5.3*528",3)

"BLD",4344,"REQB","B","IB*2.0*176",1)

"BLD",4344,"REQB","B","IB*2.0*199",2)

"FIA",351.2)
SPECIAL INPATIENT BILLING CASES
"FIA",351.2,0)
^IBE(351.2,
"FIA",351.2,0,0)
351.2PI
"FIA",351.2,0,1)
y^n^p^^^^n^^n
"FIA",351.2,0,10)

"FIA",351.2,0,11)

"FIA",351.2,0,"RLRO")

"FIA",351.2,0,"VR")
2.0^IB
"FIA",351.2,351.2)
1
"FIA",351.2,351.2,.03)

"KRN",3.8,322,-1)
0^1
"KRN",3.8,322,0)
IB COMBAT VET RX COPAY^PU^^^^^
"KRN",3.8,322,2,0)
^3.801^4^4^3030820^^^^
"KRN",3.8,322,2,1,0)
Each site must determine the IB/Pharmacy staff members/responsibility 
"KRN",3.8,322,2,2,0)
for researching and canceling Rx charges.  These staff members must
"KRN",3.8,322,2,3,0)
be included in this e-mail group in order to receive the MailMan
"KRN",3.8,322,2,4,0)
messages
"KRN",3.8,322,3)

"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
234^3030904^123456830
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3030904
"PKG",200,22,1,"PAH",1,1,1,0)
COMBAT VETERANS INTERIM SOLUTION - PHASE I
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","IBACV")
0^8^B7385476
"RTN","IBACV",1,0)
IBACV ;WOIFO/SS-COMBAT VET UTILITIES ;7-AUG-03
"RTN","IBACV",2,0)
 ;;2.0;INTEGRATED BILLING;**234**;21-MAR-94
"RTN","IBACV",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBACV",4,0)
 ;
"RTN","IBACV",5,0)
 ;To replace CL^SDCO21 with CL^IBACV that wraps out both CL^SDCO21 and $$CVEDT^DGCV
"RTN","IBACV",6,0)
CL(IBDFN,IBSDDT,IBSDOE,IBSDCLY) ;Build Classification Array
"RTN","IBACV",7,0)
 ; Input  -- DFN      Patient file IEN  
"RTN","IBACV",8,0)
 ;   SDDT     Date/Time [Optional]
"RTN","IBACV",9,0)
 ;   SDOE     Outpatient Encounter file IEN  [Optional]
"RTN","IBACV",10,0)
 ; Output -- SDCLY    Classification Array
"RTN","IBACV",11,0)
 ;    Subscripted by Class. Type file (#409.41) IEN
"RTN","IBACV",12,0)
 ;
"RTN","IBACV",13,0)
 ;To replace CL^SDCO21 with CL^IBACV that wraps out both CL^SDCO21 and $$CVEDT^DGCV
"RTN","IBACV",14,0)
 D CL^SDCO21(IBDFN,$G(IBSDDT),$G(IBSDOE),.IBSDCLY)
"RTN","IBACV",15,0)
 S:+$$CVEDT(IBDFN,$G(IBSDDT))=1 IBSDCLY(7)=""
"RTN","IBACV",16,0)
 Q
"RTN","IBACV",17,0)
 ;
"RTN","IBACV",18,0)
 ;returns CV status as:
"RTN","IBACV",19,0)
 ; current_CV_status^end_date^if_ever_had_CV_status
"RTN","IBACV",20,0)
CVEDT(IBDFN,IBDT)       ;
"RTN","IBACV",21,0)
 N IBRET S IBRET=$$CVEDT^DGCV($G(IBDFN),$G(IBDT))
"RTN","IBACV",22,0)
 Q (+$P(IBRET,"^",3))_"^"_(+$P(IBRET,"^",2))_"^"_(+$P(IBRET,"^",1))  ;swop
"RTN","IBACV",23,0)
 ;
"RTN","IBACV",24,0)
 ;/**
"RTN","IBACV",25,0)
 ;Return the classification description of code sets for #.03 in #351.2.
"RTN","IBACV",26,0)
 ;  Input:
"RTN","IBACV",27,0)
 ; X  --  Patient class [1-ao|2-ir|3-ec|4-sc|5-mst|6-hnc|7-cv]
"RTN","IBACV",28,0)
 ; IBCASE -- "M" - mixed case (the first letter is uppercase and others-lowercase)
"RTN","IBACV",29,0)
PATTYPE(X,IBCASE) ; */
"RTN","IBACV",30,0)
 N IBZ
"RTN","IBACV",31,0)
 S IBZ=$S(X=1:"AGENT ORANGE",X=2:"IONIZING RADIATION",X=3:"ENVIRONMENTAL CONTAMINANT",X=4:"SERVICE CONNECTED",X=5:"MILITARY SEXUAL TRAUMA",X=6:"HEAD/NECK CANCER",X=7:"COMBAT VETERAN",1:"SPECIAL")
"RTN","IBACV",32,0)
 Q:$G(IBCASE)="M" $$LOWER^VALM1(IBZ)
"RTN","IBACV",33,0)
 Q IBZ
"RTN","IBACV",34,0)
 ;
"RTN","IBACV",35,0)
 ;if Combat Vet sends e-mail to mailgroup "IB COMBAT VET RX COPAY"
"RTN","IBACV",36,0)
RXALRT(IBDFN,IBDT) ;
"RTN","IBACV",37,0)
 N IB1
"RTN","IBACV",38,0)
 S IB1=$$CVEDT(IBDFN,$G(IBDT))
"RTN","IBACV",39,0)
 I +IB1 D EMAIL(IBDFN,$G(IBDT),$P(IB1,"^",2))
"RTN","IBACV",40,0)
 Q
"RTN","IBACV",41,0)
 ;sends e-mail to mail group IB COMBAT VET RX COPAY
"RTN","IBACV",42,0)
EMAIL(DFN,IBEFDT,IBEXPDT) ;
"RTN","IBACV",43,0)
 N IBTODAY,IBPAT,IBT,IBSSN
"RTN","IBACV",44,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","IBACV",45,0)
 N Y D NOW^%DTC S Y=%\1 X ^DD("DD") S IBTODAY=Y
"RTN","IBACV",46,0)
 I +$G(DFN)>0 D
"RTN","IBACV",47,0)
 . N VADM,VA,VAERR
"RTN","IBACV",48,0)
 . D DEM^VADPT
"RTN","IBACV",49,0)
 . S IBPAT=$G(VADM(1))
"RTN","IBACV",50,0)
 . S IBSSN=$P($G(VADM(2)),"^",2)
"RTN","IBACV",51,0)
 S:IBPAT="" IBPAT="Unknown"
"RTN","IBACV",52,0)
 S XMSUB="COMBAT VET RX COPAY REVIEW NEEDED"
"RTN","IBACV",53,0)
 S XMY("G.IB COMBAT VET RX COPAY")=""
"RTN","IBACV",54,0)
 S XMTEXT="IBT(",XMDUZ="INTEGRATED BILLING PACKAGE"
"RTN","IBACV",55,0)
 S IBT(1,0)="PATIENT: "_IBPAT
"RTN","IBACV",56,0)
 I $G(IBEXPDT)>0 S Y=IBEXPDT X ^DD("DD") S IBT(1,0)=IBT(1,0)_"  COMBAT VET until: "_Y
"RTN","IBACV",57,0)
 S IBT(2,0)="SSN: "_IBSSN
"RTN","IBACV",58,0)
 S IBT(3,0)=""
"RTN","IBACV",59,0)
 S IBT(4,0)="RX RELEASE DATE: "_IBTODAY
"RTN","IBACV",60,0)
 S IBT(5,0)=""
"RTN","IBACV",61,0)
 S IBT(6,0)="The above patient has a Combat Veteran status. Please review this"
"RTN","IBACV",62,0)
 S IBT(7,0)="prescription to determine if the RX Copay charge should be cancelled."
"RTN","IBACV",63,0)
 S IBT(8,0)=""
"RTN","IBACV",64,0)
 D ^XMD
"RTN","IBACV",65,0)
 Q
"RTN","IBACV",66,0)
 ;
"RTN","IBACV",67,0)
 ;
"RTN","IBAMTD")
0^1^B18317055
"RTN","IBAMTD",1,0)
IBAMTD ;ALB/CPM - MOVEMENT EVENT DRIVER INTERFACE ; 21-OCT-91
"RTN","IBAMTD",2,0)
V ;;2.0;INTEGRATED BILLING;**45,52,93,115,132,153,164,156,234**;21-MAR-94
"RTN","IBAMTD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBAMTD",4,0)
 ;
"RTN","IBAMTD",5,0)
 I $G(DGPMA)="",$G(DGPMP)="" Q
"RTN","IBAMTD",6,0)
 ;
"RTN","IBAMTD",7,0)
EN ; Process events from the Movement Event Driver.
"RTN","IBAMTD",8,0)
 ;
"RTN","IBAMTD",9,0)
 ;S XRTL=$ZU(0),XRTN="IBAMTD-1" D T0^%ZOSV ;start rt clock
"RTN","IBAMTD",10,0)
 ;
"RTN","IBAMTD",11,0)
 ; -- add admissions to claims tracking
"RTN","IBAMTD",12,0)
 D INP^IBTRKR
"RTN","IBAMTD",13,0)
 ;
"RTN","IBAMTD",14,0)
 ; -- update Transfer Pricing
"RTN","IBAMTD",15,0)
 D ^IBATEI
"RTN","IBAMTD",16,0)
 ;
"RTN","IBAMTD",17,0)
 ; -- check for Long Term Care
"RTN","IBAMTD",18,0)
 N IBALTC D EN^IBAECI Q:IBALTC
"RTN","IBAMTD",19,0)
 ;
"RTN","IBAMTD",20,0)
 ; - process billing for CHAMPVA patients
"RTN","IBAMTD",21,0)
 I $$CVA^IBAUTL5(DFN) D PROC^IBACVA G END
"RTN","IBAMTD",22,0)
 ;
"RTN","IBAMTD",23,0)
 ; - unflag continuous patients
"RTN","IBAMTD",24,0)
 S IBASIH=$$ASIH^IBAUTL5(DGPMA)
"RTN","IBAMTD",25,0)
 I DGPMP="",($P(DGPMA,"^",2)=3!(IBASIH)),$O(^IBE(351.1,"B",DFN,0)),$D(^IBE(351.1,+$O(^(0)),0)),'$P(^(0),"^",2) D UNFLAG^IBAMTD1
"RTN","IBAMTD",26,0)
 ;
"RTN","IBAMTD",27,0)
 ; - update case record on discharge for special inpatient episodes
"RTN","IBAMTD",28,0)
 S IBA=$P($S(DGPMA="":DGPMP,1:DGPMA),"^",14)
"RTN","IBAMTD",29,0)
 I $O(^IBE(351.2,"AC",IBA,0)),DGPMP="",($P(DGPMA,"^",2)=3!(IBASIH)) D DIS^IBAMTI(IBA) G END
"RTN","IBAMTD",30,0)
 ;
"RTN","IBAMTD",31,0)
 ; - quit if patient was last Means Test copay patient before adm. date
"RTN","IBAMTD",32,0)
 S IBLC=$$BILST^DGMTUB(DFN) G:'IBLC END I DGPMA="",$P(DGPMP,"^",2)=1,IBLC<$P(+DGPMP,".") G END
"RTN","IBAMTD",33,0)
 D ORIG^IBAMTC I IBLC<$P(IBADMDT,".") G END
"RTN","IBAMTD",34,0)
 ;
"RTN","IBAMTD",35,0)
 ; - if editing or deleting a movement, send bulletin; delete
"RTN","IBAMTD",36,0)
 ;   case record in #351.2 for deleted admissions
"RTN","IBAMTD",37,0)
 I DGPMP]"" S IBJOB=3 D  G END
"RTN","IBAMTD",38,0)
 .D ^IBAMTBU
"RTN","IBAMTD",39,0)
 .I DGPMA="",$P(DGPMP,"^",2)=1,$O(^IBE(351.2,"AC",IBA,0)) S DA=$O(^(0)),DIK="^IBE(351.2," D ^DIK K DA,DIK
"RTN","IBAMTD",40,0)
 ;
"RTN","IBAMTD",41,0)
 ; - add a case record for admission of special (ao/ir/ec/mst/hnc) inpatients
"RTN","IBAMTD",42,0)
 I $P(DGPMA,"^",2)=1 D  G END
"RTN","IBAMTD",43,0)
 .N IBCLSF D CL^IBACV(DFN,IBADMDT,"",.IBCLSF)
"RTN","IBAMTD",44,0)
 .S IBCLSF=$O(IBCLSF(0)) I IBCLSF,(IBCLSF<5) D ADM^IBAMTI(DFN,IBA,IBCLSF) Q
"RTN","IBAMTD",45,0)
 .I $P($$GETSTAT^DGMSTAPI(DFN,IBADMDT),U,2)="Y" S IBCLSF=5,IBCLSF(5)="" D ADM^IBAMTI(DFN,IBA,IBCLSF) Q
"RTN","IBAMTD",46,0)
 .I IBCLSF=6 D ADM^IBAMTI(DFN,IBA,IBCLSF)
"RTN","IBAMTD",47,0)
 .I IBCLSF=7 D ADM^IBAMTI(DFN,IBA,IBCLSF) ;CV has the lowest priority
"RTN","IBAMTD",48,0)
 ;
"RTN","IBAMTD",49,0)
 ; - if adding a retro-active transfer or spec. transfer, send bulletin
"RTN","IBAMTD",50,0)
 I ($P(DGPMA,"^",2)=2!($P(DGPMA,"^",2)=6)),+DGPMA<DT S IBJOB=6 D ^IBAMTBU
"RTN","IBAMTD",51,0)
 ;
"RTN","IBAMTD",52,0)
 ; - process discharges and ASIH movements only
"RTN","IBAMTD",53,0)
 I $P(DGPMA,"^",2)'=3,'IBASIH G END
"RTN","IBAMTD",54,0)
 ;
"RTN","IBAMTD",55,0)
 W:'$G(DGQUIET) !,"Billing Means Test charges...."
"RTN","IBAMTD",56,0)
 S (IBY,Y)=1,IBEVOLD=0,IBJOB=2,IBWHER=1,IBDISDT=+DGPMA\1,IBAFY=$$FY^IBOUTL(DT)
"RTN","IBAMTD",57,0)
 D SITE^IBAUTL I Y<1 S IBY=Y G END1
"RTN","IBAMTD",58,0)
 D SERV^IBAUTL2 G:IBY<1 END1
"RTN","IBAMTD",59,0)
 S IBWHER=24 D CLOCK^IBAUTL3 G:IBY<1 END1
"RTN","IBAMTD",60,0)
 ;
"RTN","IBAMTD",61,0)
 ; - Create an Outpat Copay for discharge with Observation Speciality
"RTN","IBAMTD",62,0)
 I $$MVT^DGPMOBS(IBA) D OBS^IBECEAU5 G:IBY<1 END1 G END
"RTN","IBAMTD",63,0)
 ;
"RTN","IBAMTD",64,0)
 ; - handle the variations on the basis of the event record
"RTN","IBAMTD",65,0)
 D EVFIND^IBAUTL3 ; sets IBEVDA to IEN of event record, or to 0 if none
"RTN","IBAMTD",66,0)
 S IBWHER=25 D @$S(IBEVDA:"EVT",1:"NOEVT")
"RTN","IBAMTD",67,0)
 ;
"RTN","IBAMTD",68,0)
 ; - kill variables and close
"RTN","IBAMTD",69,0)
END1 I IBY<1 S IBDUZ=DUZ D ^IBAERR1 K IBDUZ
"RTN","IBAMTD",70,0)
 W:'$G(DGQUIET) "completed."
"RTN","IBAMTD",71,0)
END D KILL1^IBAMTC
"RTN","IBAMTD",72,0)
 ;
"RTN","IBAMTD",73,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBAMTD" D T1^%ZOSV ;stop rt clock
"RTN","IBAMTD",74,0)
 ;
"RTN","IBAMTD",75,0)
 Q
"RTN","IBAMTD",76,0)
 ;
"RTN","IBAMTD",77,0)
EVT ; Billable admission event on record.
"RTN","IBAMTD",78,0)
 ; I +$$MVT^DGPMOBS(IBA) S IBDT=IBDISDT D OE^IBAMTBU1,CLOSE1 G EVTQ
"RTN","IBAMTD",79,0)
 I IBEVCAL'<IBDISDT S IBY="-1^IB033" G EVTQ
"RTN","IBAMTD",80,0)
 I IBEVCAL S X1=IBEVCAL,X2=1 D C^%DTC S IBBDT=%H I X=IBDISDT S IBDT=IBEVCAL D PASS^IBAUTL5,CLOSE1:IBY>0 G EVTQ
"RTN","IBAMTD",81,0)
 I 'IBEVCAL S X=IBEVDT D H^%DTC S IBBDT=%H
"RTN","IBAMTD",82,0)
 S X=IBDISDT D H^%DTC S IBEDT=%H-1
"RTN","IBAMTD",83,0)
 I IBCLDA S %H=IBBDT D YMD^%DTC S IBDT=X D COUNT
"RTN","IBAMTD",84,0)
 D ^IBAUTL4,CLOSE:IBY>0
"RTN","IBAMTD",85,0)
EVTQ Q
"RTN","IBAMTD",86,0)
 ;
"RTN","IBAMTD",87,0)
NOEVT ; No billable event on record since admission date.
"RTN","IBAMTD",88,0)
 ; I +$$MVT^DGPMOBS(IBA) W:'$G(DGQUIET) " patient not billed (adm. for O&E)... " G NOEVTQ ; admitted for Observation & Examination
"RTN","IBAMTD",89,0)
 S (IBCUR,VAIP("D"))=+$G(^DGPM(IBA,0)) D IN5^VADPT S IBBS=$$SECT^IBAUTL5(+VAIP(8))
"RTN","IBAMTD",90,0)
 I 'IBASIH,'IBBS G NOEVTQ ; not in billable bedsection
"RTN","IBAMTD",91,0)
 I 'IBASIH,IBCUR\1=IBDISDT S IBDT=IBDISDT D:IBBS ^IBAMTD1 G NOEVTQ
"RTN","IBAMTD",92,0)
 S X=IBADMDT\1 D H^%DTC S IBBDT=%H
"RTN","IBAMTD",93,0)
 I IBASIH S VAIP("D")=IBADMDT,IBSAVBS=IBBS D IN5^VADPT S IBBS=$$SECT^IBAUTL5(+VAIP(8)) I 'IBBS S X=IBCUR D H^%DTC S IBBDT=%H I IBCUR\1=IBDISDT S IBDT=IBDISDT,IBBS=IBSAVBS D:IBBS ^IBAMTD1 G NOEVTQ
"RTN","IBAMTD",94,0)
 D LAST^IBAUTL5
"RTN","IBAMTD",95,0)
 S X=IBDISDT D H^%DTC S IBEDT=%H-1
"RTN","IBAMTD",96,0)
 I IBCLDA S %H=IBBDT D YMD^%DTC S IBDT=X D COUNT
"RTN","IBAMTD",97,0)
 D ^IBAUTL4,CLOSE:IBY>0
"RTN","IBAMTD",98,0)
NOEVTQ Q
"RTN","IBAMTD",99,0)
 ;
"RTN","IBAMTD",100,0)
COUNT ; Find number of days on clock.    Input:  IBDT
"RTN","IBAMTD",101,0)
 S X1=IBDT,X2=IBCLDT D ^%DTC S IBCLCT=X Q
"RTN","IBAMTD",102,0)
 ;
"RTN","IBAMTD",103,0)
CLOSE ; Close out charges, events; update clocks (at discharge: tag CLOSE1)
"RTN","IBAMTD",104,0)
 I $G(IBCHPDA) S IBNOS=IBCHPDA D FILER^IBAUTL5 G:IBY<1 CLOSEQ
"RTN","IBAMTD",105,0)
 I $G(IBCHCDA) S IBNOS=IBCHCDA D FILER^IBAUTL5 G:IBY<1 CLOSEQ
"RTN","IBAMTD",106,0)
 I IBCLDA D CLUPD^IBAUTL3
"RTN","IBAMTD",107,0)
CLOSE1 I IBEVDA,$D(IBDT) S IBEVCLD=IBDT D EVCLOSE^IBAUTL3
"RTN","IBAMTD",108,0)
CLOSEQ Q
"RTN","IBAMTI")
0^2^B19746737
"RTN","IBAMTI",1,0)
IBAMTI ;ALB/CPM - SPECIAL INPATIENT BILLING CASES ; 11-AUG-93
"RTN","IBAMTI",2,0)
 ;;2.0;INTEGRATED BILLING;**52,132,153,156,234**;21-MAR-94
"RTN","IBAMTI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBAMTI",4,0)
 ;
"RTN","IBAMTI",5,0)
ADM(DFN,IBPM,IBCL) ; Create a new case record upon admission
"RTN","IBAMTI",6,0)
 ;  Input:     DFN  --  Pointer to the patient in file #2
"RTN","IBAMTI",7,0)
 ;            IBPM  --  Pointer to the adm movement in file #405
"RTN","IBAMTI",8,0)
 ;            IBCL  --  Patient class [1-ao|2-ir|3-sc|4-ec|5-mst|6-hnc|7-cv]
"RTN","IBAMTI",9,0)
 I '$G(DFN)!'$G(IBPM)!'$G(IBCL) G ADMQ
"RTN","IBAMTI",10,0)
 N DA,DIC,DIE,DR,IBC,X,Y
"RTN","IBAMTI",11,0)
 ;
"RTN","IBAMTI",12,0)
 ; - need to swap the input of 3 (SC) to 4, and 4 (EC) to 3
"RTN","IBAMTI",13,0)
 S IBCL=$S(IBCL=3:4,IBCL=4:3,IBCL=5:5,1:IBCL)
"RTN","IBAMTI",14,0)
 ;
"RTN","IBAMTI",15,0)
 K DD,DO S DIC="^IBE(351.2,",DIC(0)="",X=DFN D FILE^DICN S IBC=+Y
"RTN","IBAMTI",16,0)
 S DR=".02////"_IBPM_";.03////"_IBCL_";.05////1;2.01////"_DUZ_";2.02///NOW;2.03////"_DUZ_";2.04///NOW"
"RTN","IBAMTI",17,0)
 S DA=IBC,DIE=DIC D ^DIE
"RTN","IBAMTI",18,0)
 D BULL(1,IBCL) ; send admission bulletin
"RTN","IBAMTI",19,0)
ADMQ Q
"RTN","IBAMTI",20,0)
 ;
"RTN","IBAMTI",21,0)
DIS(IBPM) ; Update the case record upon discharge
"RTN","IBAMTI",22,0)
 ;  Input:    IBPM  --  Pointer to the adm movement in file #405
"RTN","IBAMTI",23,0)
 N DA,DIE,DR,IBC
"RTN","IBAMTI",24,0)
 S IBC=$O(^IBE(351.2,"AC",+$G(IBPM),0)) I 'IBC G DISQ
"RTN","IBAMTI",25,0)
 S DR=".05////2;.06////"_DT_";2.03////"_DUZ_";2.04///NOW"
"RTN","IBAMTI",26,0)
 S DA=IBC,DIE="^IBE(351.2," D ^DIE
"RTN","IBAMTI",27,0)
 D BULL(2,+$P($G(^IBE(351.2,IBC,0)),"^",3)) ; send discharge bulletin
"RTN","IBAMTI",28,0)
DISQ Q
"RTN","IBAMTI",29,0)
 ;
"RTN","IBAMTI",30,0)
BGJ ; Perform nightly background monitoring of all case records.
"RTN","IBAMTI",31,0)
 N IBC,IBCD,IBNUM
"RTN","IBAMTI",32,0)
 S IBC=0 F  S IBC=$O(^IBE(351.2,IBC)) Q:'IBC  S IBCD=$G(^(IBC,0)) D
"RTN","IBAMTI",33,0)
 .Q:$P(IBCD,"^",8)  ; case has been dispositioned
"RTN","IBAMTI",34,0)
 .Q:$P(IBCD,"^",5)=1  ; patient still admitted
"RTN","IBAMTI",35,0)
 .I '$P(IBCD,"^",6) S $P(^IBE(351.2,IBC,0),"^",6)=DT Q  ; no disch date
"RTN","IBAMTI",36,0)
 .S IBNUM=$$FMDIFF^XLFDT(DT,$P(IBCD,"^",6))
"RTN","IBAMTI",37,0)
 .Q:IBNUM<45  ; still time to disposition the case
"RTN","IBAMTI",38,0)
 .D NOTICE(IBNUM,+IBCD,+$P(IBCD,"^",2),+$P(IBCD,"^",3)) ; send reminder to disposition
"RTN","IBAMTI",39,0)
 Q
"RTN","IBAMTI",40,0)
 ;
"RTN","IBAMTI",41,0)
BULL(IBEV,IBCL) ; Send a bulletin at admission and discharge.
"RTN","IBAMTI",42,0)
 ;  Input:    IBEV  --  Event [1:admission|2:discharge]
"RTN","IBAMTI",43,0)
 ;            IBCL  --  Patient class [1-ao|2-ir|3-ec|4-sc|5-mst|6-hnc|7-cv]
"RTN","IBAMTI",44,0)
 K IBT S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBAMTI",45,0)
 S XMSUB=$E($P(IBPT,"^"),1,14)_"  "_$P(IBPT,"^",3)_" - "_$$UCCL(IBCL)_$S($G(IBEV)=1:" ADM",1:" DISCH")
"RTN","IBAMTI",46,0)
 S IBT(1)="The following Means Test copay "_$$LCCL(IBCL)_" patient was just "_$S($G(IBEV)=1:"admitted:",1:"discharged:")
"RTN","IBAMTI",47,0)
 S IBT(2)=" " S IBC=2
"RTN","IBAMTI",48,0)
 S IBDUZ=DUZ D PAT^IBAERR1
"RTN","IBAMTI",49,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBAMTI",50,0)
 S IBC=IBC+1,IBT(IBC)=$S($G(IBEV)=1:"Please note that a special inpatient case record has been created for",1:"Please note that you have 45 days to determine if this episode of care")
"RTN","IBAMTI",51,0)
 S IBC=IBC+1,IBT(IBC)=$S($G(IBEV)=1:"this admission.",1:"should be billed.")
"RTN","IBAMTI",52,0)
 I IBEV=2 D
"RTN","IBAMTI",53,0)
 .I '$$BIL^DGMTUB(DFN,DT) S IBC=IBC+1,IBT(IBC)=" ",IBC=IBC+1,IBT(IBC)="Note: This patient, who was MT copay at admission, is no longer MT billable."
"RTN","IBAMTI",54,0)
 .I $$BFO^IBECEAU(DFN,+$G(^DGPM(IBPM,0))\1) S IBC=IBC+1,IBT(IBC)=" ",IBC=IBC+1,IBT(IBC)="Note: This patient was billed the outpatient copayment at admission."
"RTN","IBAMTI",55,0)
 D SEND^IBACVA2
"RTN","IBAMTI",56,0)
 Q
"RTN","IBAMTI",57,0)
 ;
"RTN","IBAMTI",58,0)
NOTICE(IBNUM,DFN,IBPM,IBCL) ; Notice to disposition billing case
"RTN","IBAMTI",59,0)
 ;  Input:   IBNUM  --  Number of days since discharge
"RTN","IBAMTI",60,0)
 ;             DFN  --  Pointer to the patient in file #2
"RTN","IBAMTI",61,0)
 ;            IBPM  --  Pointer to the admission in file #405
"RTN","IBAMTI",62,0)
 ;            IBCL  --  Patient class [1-ao|2-ir|3-ec|4-sc|5-mst|6-hnc|7-cv]
"RTN","IBAMTI",63,0)
 ;
"RTN","IBAMTI",64,0)
 Q:IBNUM#15  ; send notice every 15 days only
"RTN","IBAMTI",65,0)
 N IBC K IBT S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBAMTI",66,0)
 S XMSUB="NOTICE TO DISPOSITION SPECIAL INPATIENT BILLING CASE"
"RTN","IBAMTI",67,0)
 S IBT(1)="The case record for this Means Test copay "_$$LCCL(IBCL)_" patient"
"RTN","IBAMTI",68,0)
 S IBT(2)="is now "_IBNUM_" days old and should be dispositioned:"
"RTN","IBAMTI",69,0)
 S IBT(3)=" " S IBC=3
"RTN","IBAMTI",70,0)
 S IBDUZ=DUZ D PAT^IBAERR1
"RTN","IBAMTI",71,0)
 S Y=+$G(^DGPM(+$G(IBPM),0)) D DD^%DT
"RTN","IBAMTI",72,0)
 S IBC=IBC+1,IBT(IBC)=" Adm Date: "_Y
"RTN","IBAMTI",73,0)
 S Y=+$G(^DGPM(+$P($G(^DGPM(+$G(IBPM),0)),"^",17),0)) D DD^%DT
"RTN","IBAMTI",74,0)
 S IBC=IBC+1,IBT(IBC)="Disc Date: "_Y
"RTN","IBAMTI",75,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBAMTI",76,0)
 S IBC=IBC+1,IBT(IBC)="Please determine if this episode of care should be billed, and use"
"RTN","IBAMTI",77,0)
 S IBC=IBC+1,IBT(IBC)="the Cancel/Edit/Add Patient Charges option to add charges, or the"
"RTN","IBAMTI",78,0)
 S IBC=IBC+1,IBT(IBC)="Disposition Special Inpatient Billing Cases option to enter the reason"
"RTN","IBAMTI",79,0)
 S IBC=IBC+1,IBT(IBC)="for not billing."
"RTN","IBAMTI",80,0)
 D SEND^IBACVA2
"RTN","IBAMTI",81,0)
 Q
"RTN","IBAMTI",82,0)
 ;
"RTN","IBAMTI",83,0)
UCCL(X) ; Return the upper case classification description.
"RTN","IBAMTI",84,0)
 ;  Input:       X  --  Patient class [1-ao|2-ir|3-ec|4-sc|5-mst|6-hnc|7-cv]
"RTN","IBAMTI",85,0)
 Q $S('$G(X):"SPECIAL",1:$$PATTYPE^IBACV(X))
"RTN","IBAMTI",86,0)
 ;
"RTN","IBAMTI",87,0)
LCCL(X) ; Return the lower case classification description.
"RTN","IBAMTI",88,0)
 ;  Input:       X  --  Patient class [1-ao|2-ir|3-ec|4-sc|5-mst|6-hnc|7-cv]
"RTN","IBAMTI",89,0)
 Q $S('$G(X):"Special",1:$$PATTYPE^IBACV(X,"M"))
"RTN","IBAMTI",90,0)
 ;
"RTN","IBAMTI1")
0^3^B18623119
"RTN","IBAMTI1",1,0)
IBAMTI1 ;ALB/CPM - SPECIAL INPATIENT BILLING CASES (CON'T.) ; 11-AUG-93
"RTN","IBAMTI1",2,0)
 ;;2.0;INTEGRATED BILLING;**52,132,156,199,234**;21-MAR-94
"RTN","IBAMTI1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBAMTI1",4,0)
 ;
"RTN","IBAMTI1",5,0)
DISP ; Manually disposition a case record.
"RTN","IBAMTI1",6,0)
 W !!,"This option is used to disposition case records for special (AO/IR/EC/SC/MST/"
"RTN","IBAMTI1",7,0)
 W !,"HNC/CV) inpatient episodes of care which are not to be billed.After identifying"
"RTN","IBAMTI1",8,0)
 W !,"the case, please enter the reason (up to 80 characters) for non-billing."
"RTN","IBAMTI1",9,0)
 ;
"RTN","IBAMTI1",10,0)
 ; - main processing loop
"RTN","IBAMTI1",11,0)
 S IBQ=0 F  W ! D SEL Q:IBQ
"RTN","IBAMTI1",12,0)
 K IBQ
"RTN","IBAMTI1",13,0)
 Q
"RTN","IBAMTI1",14,0)
 ;
"RTN","IBAMTI1",15,0)
SEL ; Select an inpatient billing case and enter the reason for non-billing.
"RTN","IBAMTI1",16,0)
 S DIC="^IBE(351.2,",DIC(0)="QEAMZ",DIC("A")="Select PATIENT: "
"RTN","IBAMTI1",17,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBAMTI1",18,0)
 D ^DIC S IBC=+Y I Y<0 S IBQ=1 G SELQ
"RTN","IBAMTI1",19,0)
 I $P(Y(0),"^",5)=1 W !!,"You must wait until this patient has been discharged to disposition the case." G SELQ
"RTN","IBAMTI1",20,0)
 I $P(Y(0),"^",4) S IBBILLED=1 W !!,"Please note that it appears as if this case has been billed."
"RTN","IBAMTI1",21,0)
 I $P(Y(0),"^",8) W !!,"Please note that this case has already been dispositioned."
"RTN","IBAMTI1",22,0)
 ;
"RTN","IBAMTI1",23,0)
 ; - display case record
"RTN","IBAMTI1",24,0)
 W ! D DSPL(IBC)
"RTN","IBAMTI1",25,0)
 ;
"RTN","IBAMTI1",26,0)
 ; - allow user update of record
"RTN","IBAMTI1",27,0)
 S IBHC=$P(Y(0),"^",7),IBHR=$G(^IBE(351.2,IBC,1))
"RTN","IBAMTI1",28,0)
 S DIE="^IBE(351.2,",DA=IBC,DR=$S($G(IBBILLED):".07;",1:"")_1 D ^DIE
"RTN","IBAMTI1",29,0)
 ;
"RTN","IBAMTI1",30,0)
 S IBNC=$P(^IBE(351.2,IBC,0),"^",7),IBNR=$G(^IBE(351.2,IBC,1))
"RTN","IBAMTI1",31,0)
 I IBHC=IBNC,IBHR=IBNR W !!,"No changes made to the case record!" G SELQ
"RTN","IBAMTI1",32,0)
 I IBNR]"" W !!,"This case record will be dispositioned."
"RTN","IBAMTI1",33,0)
 S DR="2.03////"_DUZ_";2.04///NOW"
"RTN","IBAMTI1",34,0)
 I IBNR]"" S DR=".07////1;.08////1;"_DR
"RTN","IBAMTI1",35,0)
 S DIE="^IBE(351.2,",DA=IBC D ^DIE
"RTN","IBAMTI1",36,0)
SELQ K DA,DIC,DIE,DR,IBC,IBHC,IBHR,IBNC,IBNR,IBBILLED
"RTN","IBAMTI1",37,0)
 Q
"RTN","IBAMTI1",38,0)
 ;
"RTN","IBAMTI1",39,0)
CEA(IBPM,IBEVT) ; Automatically disposition the case from Cancel/Edit/Add.
"RTN","IBAMTI1",40,0)
 ;  Input:     IBPM  --  Pointer to the adm movement in file #405
"RTN","IBAMTI1",41,0)
 ;            IBEVT  --  Pointer to the billing event record in file #350
"RTN","IBAMTI1",42,0)
 I '$G(IBEVT) G CEAQ
"RTN","IBAMTI1",43,0)
 N DA,DIE,DR,IBC
"RTN","IBAMTI1",44,0)
 S IBC=$O(^IBE(351.2,"AC",+$G(IBPM),0)) I IBC D UPD(0)
"RTN","IBAMTI1",45,0)
CEAQ Q
"RTN","IBAMTI1",46,0)
 ;
"RTN","IBAMTI1",47,0)
CHK(IBC,IBEVT) ; Review the case after adding a charge from Cancel/Edit/Add.
"RTN","IBAMTI1",48,0)
 ;  Input:      IBC  --  Pointer to the case in file #351.2
"RTN","IBAMTI1",49,0)
 ;            IBEVT  --  Pointer to the billing event record in file #350
"RTN","IBAMTI1",50,0)
 I '$G(IBC)!'$G(IBEVT) G CHKQ
"RTN","IBAMTI1",51,0)
 N DA,DIE,DR,IBCD,IBCD1
"RTN","IBAMTI1",52,0)
 S IBCD=$G(^IBE(351.2,IBC,0)),IBCD1=$G(^(1))
"RTN","IBAMTI1",53,0)
 I $P(IBCD,"^",7)!'$P(IBCD,"^",8)!(IBCD1]"") D UPD(1)
"RTN","IBAMTI1",54,0)
CHKQ Q
"RTN","IBAMTI1",55,0)
 ;
"RTN","IBAMTI1",56,0)
UPD(IND) ; Disposition the case record.
"RTN","IBAMTI1",57,0)
 ;  Input:      IND  --  0 = dispositioning  |  1 = reviewing
"RTN","IBAMTI1",58,0)
 ;         variables --  IBC => ptr to case record
"RTN","IBAMTI1",59,0)
 ;                       IBEVT => ptr to event record in #350
"RTN","IBAMTI1",60,0)
 W !,"Dispositioning the special inpatient billing case record"
"RTN","IBAMTI1",61,0)
 W:$G(IND) " (as billable)" W "..."
"RTN","IBAMTI1",62,0)
 K ^IBE(351.2,IBC,1)
"RTN","IBAMTI1",63,0)
 S DR=".04////"_IBEVT_";.07////0;.08////1;2.03////"_DUZ_";2.04///NOW"
"RTN","IBAMTI1",64,0)
 S DIE="^IBE(351.2,",DA=IBC D ^DIE W "  done."
"RTN","IBAMTI1",65,0)
 Q
"RTN","IBAMTI1",66,0)
 ;
"RTN","IBAMTI1",67,0)
DSPL(IBC) ; Display a case record.
"RTN","IBAMTI1",68,0)
 ;  Input:      IBC  --  Pointer to the case record in file #351.2
"RTN","IBAMTI1",69,0)
 I '$G(IBC) G DSPLQ
"RTN","IBAMTI1",70,0)
 N DFN,IBCD,IBC1,IBC2,IBATYP,IBPT,IBDIS,IBCL,IBEVT,IBN,IBND,Y
"RTN","IBAMTI1",71,0)
 S IBCD=$G(^IBE(351.2,IBC,0)),IBC1=$G(^(1)),IBC2=$G(^(2))
"RTN","IBAMTI1",72,0)
 S DFN=+IBCD,IBPT=$$PT^IBEFUNC(DFN),IBCL=$P(IBCD,"^",3)
"RTN","IBAMTI1",73,0)
 W !,$$DASH(),!?1,"Pt. Name: ",$E($P(IBPT,"^"),1,17),"  (",$P(IBPT,"^",3),")"
"RTN","IBAMTI1",74,0)
 W ?38,"Care related to ",$S(IBCL=1:"AO",IBCL=2:"IR",IBCL=3:"EC",IBCL=5:"MST",IBCL=6:"HNC",IBCL=7:"CV",1:"SC"),": ",$S($P(IBCD,"^",7):"YES",$P(IBCD,"^",7)=0:"NO",1:"UNANSWERED")
"RTN","IBAMTI1",75,0)
 W !?5,"Type: ",$$UCCL^IBAMTI(IBCL),?39,"Case Dispositioned: ",$S($P(IBCD,"^",8):"YES",1:"NO")
"RTN","IBAMTI1",76,0)
 W !?1,"Adm Date: ",$$DAT1^IBOUTL(+$G(^DGPM(+$P(IBCD,"^",2),0)),1),?41,"Date Last Edited: ",$$DAT1^IBOUTL(+$P(IBC2,"^",4),1)
"RTN","IBAMTI1",77,0)
 S IBDIS=+$G(^DGPM(+$P($G(^DGPM(+$P(IBCD,"^",2),0)),"^",17),0))
"RTN","IBAMTI1",78,0)
 W !,"Disc Date: ",$S(IBDIS:$$DAT1^IBOUTL(IBDIS,1),1:"Still Admitted"),?43,"Last Edited By: ",$E($P($G(^VA(200,+$P(IBC2,"^",3),0)),"^"),1,20),!,$$DASH()
"RTN","IBAMTI1",79,0)
 ;
"RTN","IBAMTI1",80,0)
 S IBEVT=+$P(IBCD,"^",4)
"RTN","IBAMTI1",81,0)
 I $O(^IB("AF",IBEVT,IBEVT)) W !?1,"Charges Billed:" D
"RTN","IBAMTI1",82,0)
 .S IBN=0 F  S IBN=$O(^IB("AF",IBEVT,IBN)) Q:'IBN  I IBN'=IBEVT D
"RTN","IBAMTI1",83,0)
 ..S IBND=$G(^IB(IBN,0))
"RTN","IBAMTI1",84,0)
 ..S IBATYP=$P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^")
"RTN","IBAMTI1",85,0)
 ..S:$E(IBATYP,1,2)="DG" IBATYP=$E(IBATYP,4,99)
"RTN","IBAMTI1",86,0)
 ..W !?5,IBATYP,?35,$$DAT1^IBOUTL($P(IBND,"^",14)),?46,$$DAT1^IBOUTL($P(IBND,"^",15))
"RTN","IBAMTI1",87,0)
 ..W ?57,"$",$P(IBND,"^",7),?64,$P($G(^IBE(350.21,+$P(IBND,"^",5),0)),"^",2)
"RTN","IBAMTI1",88,0)
 .W !,$$DASH()
"RTN","IBAMTI1",89,0)
 ;
"RTN","IBAMTI1",90,0)
 I IBC1]"" W !?1,"Reason for Non-Billing:",!,IBC1,!,$$DASH(),!
"RTN","IBAMTI1",91,0)
DSPLQ Q
"RTN","IBAMTI1",92,0)
 ;
"RTN","IBAMTI1",93,0)
DASH() ; Return a dashed line.
"RTN","IBAMTI1",94,0)
 Q $TR($J("",80)," ","-")
"RTN","IBARX1")
0^4^B20695837
"RTN","IBARX1",1,0)
IBARX1 ;ALB/AAS - INTEGRATED BILING, PHARMACY COPAY INTERFACE (CONT.) ;21-FEB-91
"RTN","IBARX1",2,0)
 ;;2.0;INTEGRATED BILLING;**34,101,150,158,156,234**;21-MAR-94
"RTN","IBARX1",3,0)
 ;;Per VHA Directive 10-93-142 ;This routine should not be modified.
"RTN","IBARX1",4,0)
 ;
"RTN","IBARX1",5,0)
 ;  - process 1 rx entry and accumulate totals
"RTN","IBARX1",6,0)
 ;
"RTN","IBARX1",7,0)
RX N IBAM,IBNOCH
"RTN","IBARX1",8,0)
 ;if Combat Vet send alert e-mail to mailgroup "IB COMBAT VET RX COPAY"
"RTN","IBARX1",9,0)
 D
"RTN","IBARX1",10,0)
 . N Y D NOW^%DTC S Y=%\1 D RXALRT^IBACV(DFN,Y)
"RTN","IBARX1",11,0)
 I $P(IBX,"^")'?1.N1":"1.N.ANP S Y="-1^IB012" G RXQ
"RTN","IBARX1",12,0)
 I $P(IBX,"^",2)<1 S Y="-1^IB013" G RXQ
"RTN","IBARX1",13,0)
 ;
"RTN","IBARX1",14,0)
 D BDESC
"RTN","IBARX1",15,0)
 ;
"RTN","IBARX1",16,0)
 S DA=IBATYP D COST^IBAUTL
"RTN","IBARX1",17,0)
 ;
"RTN","IBARX1",18,0)
 ; compute amount above cap
"RTN","IBARX1",19,0)
 D NEW^IBARXMC($P(IBX,"^",2),X1,DT,.IBCHRG,.IBNOCH)
"RTN","IBARX1",20,0)
 ;
"RTN","IBARX1",21,0)
 S IBTCH=$P(IBX,"^",2)*X1
"RTN","IBARX1",22,0)
 ;
"RTN","IBARX1",23,0)
 ; add to 354.71
"RTN","IBARX1",24,0)
 S IBAM=$$ADD^IBARXMN(DFN,"^^"_$S($G(IBEFDT):IBEFDT,1:DT)_"^^P^"_$P(IBX,"^")_"^"_$P(IBX,"^",2)_"^"_IBTCH_"^"_IBDESC_"^"_$S($G(IBAMP):IBAMP,1:"")_"^"_IBCHRG_"^"_IBNOCH_"^"_(+$P($$SITE^IBARXMU,"^",3)),IBATYP) I IBAM<1 S Y="-1^IB316" G RXQ
"RTN","IBARX1",25,0)
 ;
"RTN","IBARX1",26,0)
 ; setup new pieces (4, 5, 6, and 7), quit if above cap
"RTN","IBARX1",27,0)
 S $P(IBSAVY(IBJ),"^",4,7)=$S(IBNOCH:1,1:0)_"^"_$S(IBNOCH&(IBCHRG):"P",IBCHRG:"F",1:"")_"^"_(+$G(IBEXMP))_"^"_IBAM G:'IBCHRG RXQ
"RTN","IBARX1",28,0)
 ;
"RTN","IBARX1",29,0)
 S IBTOTL=IBTOTL+IBCHRG
"RTN","IBARX1",30,0)
 S IBWHER=2
"RTN","IBARX1",31,0)
 D ADD^IBAUTL
"RTN","IBARX1",32,0)
 I +Y<1 G RXQ
"RTN","IBARX1",33,0)
 S IBPARNT=$S($D(IBPARNT):IBPARNT,1:IBN)
"RTN","IBARX1",34,0)
 S $P(^IB(IBN,1),"^",1)=IBDUZ,$P(^IB(IBN,0),"^",2,13)=DFN_"^"_IBATYP_"^"_$P(IBX,"^")_"^2^"_$P(IBX,"^",2)_"^"_IBCHRG_"^"_IBDESC_"^"_IBPARNT_"^^"_IBIL_"^"_IBTRAN_"^"_IBFAC,$P(^(0),"^",19)=IBAM
"RTN","IBARX1",35,0)
 K IBPARNT,^IB("AC",1,IBN) ;S ^IB("AC",2,IBN)=""
"RTN","IBARX1",36,0)
 D INDEX
"RTN","IBARX1",37,0)
 S $P(IBSAVY(IBJ),"^",1,3)=IBN_"^"_IBCHRG_"^"_IBIL
"RTN","IBARX1",38,0)
 S:'$D(IBNOS) IBNOS="" S IBNOS=IBN_"^"_IBNOS
"RTN","IBARX1",39,0)
RXQ Q
"RTN","IBARX1",40,0)
 ;
"RTN","IBARX1",41,0)
CANRX ;  - ibx = ibn for parent entry
"RTN","IBARX1",42,0)
 ;  - ibn = new cancellation entry
"RTN","IBARX1",43,0)
 N IBAM,IBAMY
"RTN","IBARX1",44,0)
 S IBY(IBJ)=1
"RTN","IBARX1",45,0)
 I '$D(^IBE(350.3,+$P(IBX,"^",2),0)) S (Y,IBY(IBJ))="-1^IB020" G CANRXQ
"RTN","IBARX1",46,0)
 I '$D(^IB(+IBX,0)) S (Y,IBY(IBJ))="-1^IB021" G CANRXQ
"RTN","IBARX1",47,0)
 S IBND=^IB(+IBX,0)
"RTN","IBARX1",48,0)
 S IBCRES=$P(IBX,"^",2)
"RTN","IBARX1",49,0)
 ;  -find most recent entry for parent ibx
"RTN","IBARX1",50,0)
 ;  -if status isn't an update or new, error already cancelled?
"RTN","IBARX1",51,0)
 D LAST I IBLAST'=IBPARNT,$D(^IB(IBLAST,0)),$P(^IBE(350.1,$P(^IB(IBLAST,0),"^",3),0),"^",5)=2 S (Y,IBY(IBJ))="-1^IB026^ Ref. No: "_+^IB(+IBLAST,0) G CANRXQ ;already cancelled
"RTN","IBARX1",52,0)
 ;
"RTN","IBARX1",53,0)
 ; cancel 354.71
"RTN","IBARX1",54,0)
 S IBAM=$$CANCEL^IBARXMN(DFN,$P(IBND,"^",19),.IBAMY,IBCRES) I $G(IBAMY)<0 S (Y,IBY(IBJ))=IBAMY G CANRXQ
"RTN","IBARX1",55,0)
 ;
"RTN","IBARX1",56,0)
 I $P(IBND,"^",5)=8 D  QUIT  ;Cancel a charge with a status of HOLD
"RTN","IBARX1",57,0)
 . N DIE,DA,DR
"RTN","IBARX1",58,0)
 . S DIE="^IB(",DA=+IBX,DR=".05////10;.1////"_IBCRES
"RTN","IBARX1",59,0)
 . DO ^DIE
"RTN","IBARX1",60,0)
 . S Y=1,IBY(IBJ)=1,Y(IBJ)=+IBX
"RTN","IBARX1",61,0)
 ;
"RTN","IBARX1",62,0)
 S IBPARNT=$P(IBND,"^",9) I '$D(^IB(IBPARNT,0)) S (Y,IBY(IBJ))="-1^IB027" G CANRXQ
"RTN","IBARX1",63,0)
 S IBATYP=$P(^IBE(350.1,$P(IBND,"^",3),0),"^",6) ;cancellation action type for parent
"RTN","IBARX1",64,0)
 I '$D(^IBE(350.1,+IBATYP,0)) S (Y,IBY(IBJ))="-1^IB022" G CANRXQ
"RTN","IBARX1",65,0)
 S IBSEQNO=$P(^IBE(350.1,+IBATYP,0),"^",5) I 'IBSEQNO S (Y,IBY(IBJ))="-1^IB023" G CANRXQ
"RTN","IBARX1",66,0)
 S IBIL=$P(IBND,"^",11) I IBIL="" S (Y,IBY(IBJ))="-1^IB024" G CANRXQ
"RTN","IBARX1",67,0)
 S IBUNIT=$S($D(^IB(+IBLAST,0)):$P(^(0),"^",6),1:$P(IBND,"^",6)) I IBUNIT<1 S (Y,IBY(IBJ))="-1^IB025" G CANRXQ
"RTN","IBARX1",68,0)
 S IBCHRG=$S($D(^IB(+IBLAST,0)):$P(^(0),"^",7),1:$P(IBND,"^",7)) I IBCHRG<1 S (Y,IBY(IBJ))="-1^IB025" G CANRXQ
"RTN","IBARX1",69,0)
 S IBTOTL=IBTOTL+IBCHRG
"RTN","IBARX1",70,0)
 S IBWHER=2
"RTN","IBARX1",71,0)
 D ADD^IBAUTL I +Y<1 S IBY(IBJ)=Y G CANRXQ
"RTN","IBARX1",72,0)
 S $P(^IB(IBN,1),"^",1)=IBDUZ,$P(^IB(IBN,0),"^",2,13)=DFN_"^"_IBATYP_"^"_$P(IBND,"^",4)_"^2^"_IBUNIT_"^"_IBCHRG_"^"_$P(IBND,"^",8)_"^"_IBPARNT_"^"_IBCRES_"^"_IBIL_"^^"_IBFAC S:IBAM $P(^(0),"^",19)=IBAM
"RTN","IBARX1",73,0)
 K ^IB("AC",1,IBN) ;S ^IB("AC",2,IBN)=""
"RTN","IBARX1",74,0)
 D INDEX
"RTN","IBARX1",75,0)
 S Y(IBJ)=IBN_"^"_IBCHRG_"^"_IBIL
"RTN","IBARX1",76,0)
 S IBNOS=IBN
"RTN","IBARX1",77,0)
CANRXQ Q
"RTN","IBARX1",78,0)
 ;
"RTN","IBARX1",79,0)
BDESC ;  -return brief description
"RTN","IBARX1",80,0)
 N X,Y S IBDESC="",X=$P(IBX,"^")
"RTN","IBARX1",81,0)
 I $D(^IBE(350.1,IBATYP,20)) X ^(20) S IBDESC=X
"RTN","IBARX1",82,0)
 Q
"RTN","IBARX1",83,0)
LAST ;find last entry
"RTN","IBARX1",84,0)
 S IBLAST=""
"RTN","IBARX1",85,0)
 S IBPARNT=$P(^IB(+IBX,0),"^",9) I 'IBPARNT S IBPARNT=+IBX
"RTN","IBARX1",86,0)
 S IBLDT=$O(^IB("APDT",IBPARNT,"")) I +IBLDT F IBL=0:0 S IBL=$O(^IB("APDT",IBPARNT,IBLDT,IBL)) Q:'IBL  S IBLAST=IBL
"RTN","IBARX1",87,0)
 I IBLAST="" S IBLAST=IBPARNT
"RTN","IBARX1",88,0)
 Q
"RTN","IBARX1",89,0)
 ;
"RTN","IBARX1",90,0)
INDEX ;cross-reference entry
"RTN","IBARX1",91,0)
 N X,Y
"RTN","IBARX1",92,0)
 S DA=IBN,DIK="^IB(" D IX^DIK
"RTN","IBARX1",93,0)
 K DIK Q
"RTN","IBARX1",94,0)
 ;
"RTN","IBARX1",95,0)
SERV(Y) ; -- Service check for Pharmacy
"RTN","IBARX1",96,0)
 ;    called by the screen in the input transform for the IB SERVICE/SECTION
"RTN","IBARX1",97,0)
 ;    field of the PHARMACY SITE file.
"RTN","IBARX1",98,0)
 ;    input = Y internal entry number in service section file
"RTN","IBARX1",99,0)
 ;    output = 1 if okay to use (service matches) or 0 if not okay
"RTN","IBARX1",100,0)
 ;
"RTN","IBARX1",101,0)
 ; -- screen logic for field 1003 in file 59 should be 
"RTN","IBARX1",102,0)
 ;    S DIC("S")="I $$SERV^IBARX1(+Y)"
"RTN","IBARX1",103,0)
 ;
"RTN","IBARX1",104,0)
 Q $S('$G(Y):0,1:$D(^IBE(350.1,"ANEW",Y,1,1))&$D(^IBE(350.1,"ANEW",Y,1,2)))
"RTN","IBOVOP1")
0^6^B14596477
"RTN","IBOVOP1",1,0)
IBOVOP1 ;ALB/RLW-Report of Visits for NSC Outpatients ; 12-JUN-92
"RTN","IBOVOP1",2,0)
 ;;2.0;INTEGRATED BILLING;**52,91,99,132,156,176,234**;21-MAR-94
"RTN","IBOVOP1",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified
"RTN","IBOVOP1",4,0)
MAIN(IBQUERY) ; perform report for day(s)
"RTN","IBOVOP1",5,0)
 ; IBQUERY = the query object to use to search for outpt encounters
"RTN","IBOVOP1",6,0)
 ;           if not a valid #, a new QUERY will be created
"RTN","IBOVOP1",7,0)
 D HDR^IBOVOP2
"RTN","IBOVOP1",8,0)
 I $$STOP^IBOUTL("Outpatient/Registration Events Report") S IBQUIT=1 G END
"RTN","IBOVOP1",9,0)
 ; scan visits for NSC patients
"RTN","IBOVOP1",10,0)
 N IBVAL,IBCBK,IBCK,IBFILTER,IBPB,IBOE,IBOE0,IBZ
"RTN","IBOVOP1",11,0)
 S IBVAL("BDT")=IBDATE,IBVAL("EDT")=IBDATE\1+.99
"RTN","IBOVOP1",12,0)
 S IBFILTER=""
"RTN","IBOVOP1",13,0)
 ; Look for hospital location is a clinic-type, valid Means-Test or LTC patient, and potentially billable events
"RTN","IBOVOP1",14,0)
 S IBCBK="I $D(^SC(""AC"",""C"",+$P(Y0,U,4))) D IBCBK^IBOVOP1(Y,Y0,.IBCK)" ; Action of scanning
"RTN","IBOVOP1",15,0)
 F IBZ=9,13.1 S IBCK(IBZ)=""
"RTN","IBOVOP1",16,0)
 D SCAN^IBSDU("DATE/TIME",.IBVAL,"",IBCBK,0,.IBQUERY) K ^TMP("DIERR",$J)
"RTN","IBOVOP1",17,0)
 ; Search for Inpatient Observations
"RTN","IBOVOP1",18,0)
 D IBOVOP^IBECEAU5(IBDATE)
"RTN","IBOVOP1",19,0)
 D PRINT^IBOVOP2
"RTN","IBOVOP1",20,0)
END K DFN,^TMP("IBOVOP",$J),IBAPPT,IBJ,IB
"RTN","IBOVOP1",21,0)
 Q
"RTN","IBOVOP1",22,0)
 ;
"RTN","IBOVOP1",23,0)
 ; To be executed only if the hospital location a clinic-type.
"RTN","IBOVOP1",24,0)
 ; Check the record, and add to the ^TMP if needed
"RTN","IBOVOP1",25,0)
 ; IBENC - encounter IEN
"RTN","IBOVOP1",26,0)
 ; IBENCZ - encounter zero-node
"RTN","IBOVOP1",27,0)
 ; IBCK - array of criteria flags for the $$BILLCK^IBAMTEDU() API call
"RTN","IBOVOP1",28,0)
IBCBK(IBENC,IBENCZ,IBCK) ;
"RTN","IBOVOP1",29,0)
 N IBPAT,IBDAT,Y,Y0,X
"RTN","IBOVOP1",30,0)
 ; Quit if not a billable event
"RTN","IBOVOP1",31,0)
 I '$$BILLCK^IBAMTEDU(IBENC,IBENCZ,.IBCK) Q
"RTN","IBOVOP1",32,0)
 S IBDAT=+IBENCZ ; Date of event
"RTN","IBOVOP1",33,0)
 S IBPAT=+$P(IBENCZ,U,2) Q:'IBPAT  ; Patient IEN
"RTN","IBOVOP1",34,0)
 ; Check for valid MT or LTC patient
"RTN","IBOVOP1",35,0)
 I '$$BIL^DGMTUB(IBPAT,IBDAT),+$$LTCST^IBAECU(IBPAT,IBDAT,1)'=2 Q
"RTN","IBOVOP1",36,0)
 D OPTENC(IBENC,IBENCZ) ; Extract Outpatient Encounter and add to the ^TMP global
"RTN","IBOVOP1",37,0)
 Q
"RTN","IBOVOP1",38,0)
 ;
"RTN","IBOVOP1",39,0)
 ;
"RTN","IBOVOP1",40,0)
OPTENC(IBOE,IBOE0) ; Extract outpatient encounter
"RTN","IBOVOP1",41,0)
 N IBSDATA,IBCL,DFN,IBFLD4,IBJ,IBSEQ
"RTN","IBOVOP1",42,0)
 S DFN=+$P(IBOE0,U,2),IBJ=+IBOE0,IBCL=+$P(IBOE0,U,4),IBSEQ=0
"RTN","IBOVOP1",43,0)
 Q:'$$BIL^DGMTUB(DFN,IBJ)
"RTN","IBOVOP1",44,0)
 I $P(IBOE0,U,8)=1 D  ; - appt
"RTN","IBOVOP1",45,0)
 .;            field 4=clinic
"RTN","IBOVOP1",46,0)
 .;            field 5=appt type
"RTN","IBOVOP1",47,0)
 .;            field 6=status
"RTN","IBOVOP1",48,0)
 . S IBSDATA=$$DPTSND^IBSDU(DFN,IBJ)
"RTN","IBOVOP1",49,0)
 . S IBFLD4=$P($G(^SC(IBCL,0)),U)
"RTN","IBOVOP1",50,0)
 . I IBFLD4'="" S:+$G(^SC(IBCL,"AT"))=6 IBFLD4=$E(IBFLD4,1,13)_" [R]"
"RTN","IBOVOP1",51,0)
 . S ^TMP("IBOVOP",$J,$$FLD1(DFN),"CLINIC APPT",$$FLD3(IBJ),0)=$E(IBFLD4,1,17)_U_$$FLD5($P(IBOE0,U,10))_U_$E($P($$STATUS^SDAM1(DFN,IBJ,IBCL,IBSDATA),";",3),1,17)_U_DFN_U_IBOE Q
"RTN","IBOVOP1",52,0)
 ;
"RTN","IBOVOP1",53,0)
 I $P(IBOE0,U,8)=2 D  ; - add/edit stop code
"RTN","IBOVOP1",54,0)
 .;           field 5=appt type
"RTN","IBOVOP1",55,0)
 . S ^TMP("IBOVOP",$J,$$FLD1(DFN),"STOP CODE",$$FLD3(IBJ),IBSEQ)=$E($P($G(^DIC(40.7,$P(IBOE0,U,3),0)),U),1,16)_U_$$FLD5($P(IBOE0,U,10))_"^^"_DFN_U_IBOE,IBSEQ=IBSEQ+1
"RTN","IBOVOP1",56,0)
 ;
"RTN","IBOVOP1",57,0)
 I $P(IBOE0,U,8)=3 D  ; - registration
"RTN","IBOVOP1",58,0)
 . Q:'$$DISCT^IBEFUNC(IBOE,IBOE0)
"RTN","IBOVOP1",59,0)
 . S IBDATA=$$DISND^IBSDU(IBOE,IBOE0)
"RTN","IBOVOP1",60,0)
 . S IBFLD4=$E($$EXTERNAL^DILFD(2.101,2,"",$P(IBDATA,U,3)),1,16)
"RTN","IBOVOP1",61,0)
 . S Y=$E($$EXTERNAL^DILFD(2.101,6,"",$P(IBDATA,U,7)),1,30)
"RTN","IBOVOP1",62,0)
 . S ^TMP("IBOVOP",$J,$$FLD1(DFN),"REGISTRATION",$$FLD3(IBJ),0)=IBFLD4_U_Y_"^^"_DFN_U_IBOE
"RTN","IBOVOP1",63,0)
 ;
"RTN","IBOVOP1",64,0)
 K IBB,IBE,IBX,IBY,IBCLN,IBXP,IBDFN,IBAPDT,IBAPTYP,X,Y
"RTN","IBOVOP1",65,0)
 Q
"RTN","IBOVOP1",66,0)
CKENC(IBOE,IBOE0,IBSEQ) ;
"RTN","IBOVOP1",67,0)
 S DFN=$P(IBOE0,U,2),IBJ=+IBOE0
"RTN","IBOVOP1",68,0)
 Q
"RTN","IBOVOP1",69,0)
 ;
"RTN","IBOVOP1",70,0)
FLD1(DFN) ; get patient name, l-4 ssn id, classification, insured?
"RTN","IBOVOP1",71,0)
 I '$G(DFN) Q ""
"RTN","IBOVOP1",72,0)
 N IBX,IBY,IBZ S IBX=$$PT^IBEFUNC(DFN),IBZ=""
"RTN","IBOVOP1",73,0)
 D CL^IBACV(DFN,IBDATE,"",.IBY)
"RTN","IBOVOP1",74,0)
 I $D(IBY(1)) S IBZ="AO"
"RTN","IBOVOP1",75,0)
 I $D(IBY(2)) S IBZ=IBZ_$S(IBZ]"":"/",1:"")_"IR"
"RTN","IBOVOP1",76,0)
 I $D(IBY(3)) S IBZ=IBZ_$S(IBZ]"":"/",1:"")_"SC"
"RTN","IBOVOP1",77,0)
 I $D(IBY(4)) S IBZ=IBZ_$S(IBZ]"":"/",1:"")_"EC"
"RTN","IBOVOP1",78,0)
 I $D(IBY(5)) S IBZ=IBZ_$S(IBZ]"":"/",1:"")_"MST"
"RTN","IBOVOP1",79,0)
 I $D(IBY(6)) S IBZ=IBZ_$S(IBZ]"":"/",1:"")_"HNC"
"RTN","IBOVOP1",80,0)
 I $D(IBY(7)) S IBZ=IBZ_$S(IBZ]"":"/",1:"")_"CV"
"RTN","IBOVOP1",81,0)
 Q $E($P(IBX,U),1,20)_" "_$E(IBX)_$P(IBX,U,3)_$S(IBZ]"":"    ["_IBZ_"]",1:"")_$S($$INSURED^IBCNS1(DFN,IBDATE):"    **Insured**",1:"")
"RTN","IBOVOP1",82,0)
 ;
"RTN","IBOVOP1",83,0)
FLD3(Y) ; time - convert date/time to time only, no seconds
"RTN","IBOVOP1",84,0)
 I '$G(Y) Q ""
"RTN","IBOVOP1",85,0)
 X ^DD("DD") Q $P($P(Y,"@",2),":",1,2)
"RTN","IBOVOP1",86,0)
 ;
"RTN","IBOVOP1",87,0)
FLD5(I) ; get appointment type name
"RTN","IBOVOP1",88,0)
 Q $E($P($G(^SD(409.1,+$G(I),0)),U,1),1,17)
"RTN","IBOVOP2")
0^7^B13264142
"RTN","IBOVOP2",1,0)
IBOVOP2 ;ALB/CPM-Opt/Reg Events Report Print Utilities ; 30-AUG-93
"RTN","IBOVOP2",2,0)
 ;;2.0;INTEGRATED BILLING;**52,132,153,156,167,176,234**;21-MAR-94
"RTN","IBOVOP2",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified
"RTN","IBOVOP2",4,0)
 ;
"RTN","IBOVOP2",5,0)
PRINT ; Retrieve data for printing.
"RTN","IBOVOP2",6,0)
 N IBCOMBAT
"RTN","IBOVOP2",7,0)
 S IBFLD1="" I '$D(^TMP("IBOVOP",$J)) W !!,"No Outpatient activity recorded for MT/LTC copay patients on ",$$DAT1^IBOUTL(IBDATE),"."
"RTN","IBOVOP2",8,0)
 F  S IBFLD1=$O(^TMP("IBOVOP",$J,IBFLD1)) Q:(IBFLD1="")!(IBQUIT)  W ! D:IBLINE>55 HDR W !,IBFLD1 D  D CHRGS Q:IBQUIT
"RTN","IBOVOP2",9,0)
 .S IBFLD2="" F  S IBFLD2=$O(^TMP("IBOVOP",$J,IBFLD1,IBFLD2)) Q:(IBFLD2="")!(IBQUIT)  D
"RTN","IBOVOP2",10,0)
 ..S IBFLD3="" F  S IBFLD3=$O(^TMP("IBOVOP",$J,IBFLD1,IBFLD2,IBFLD3)) Q:(IBFLD3="")!(IBQUIT)  D
"RTN","IBOVOP2",11,0)
 ...S IBSEQ="" F  S IBSEQ=$O(^TMP("IBOVOP",$J,IBFLD1,IBFLD2,IBFLD3,IBSEQ)) Q:(IBSEQ="")!(IBQUIT)  S IBDATA=$G(^(IBSEQ)) D
"RTN","IBOVOP2",12,0)
 ....S IBFLD4=$P(IBDATA,"^",1),IBFLD5=$P(IBDATA,"^",2),IBFLD6=$P(IBDATA,"^",3),DFN=$P(IBDATA,"^",4)
"RTN","IBOVOP2",13,0)
 ....S IBCOMBAT=$$CVEDT^IBACV(DFN,IBDATE) I +IBCOMBAT I $P(IBCOMBAT,"^",2)>0 W !,"Veteran has CV status until "_$$DAT1^IBOUTL($P(IBCOMBAT,"^",2))
"RTN","IBOVOP2",14,0)
 ....W !?5,IBFLD2
"RTN","IBOVOP2",15,0)
 ....W ?20,IBFLD3,?26,IBFLD4,?44,IBFLD5,?63,IBFLD6 D CLSF(+$P(IBDATA,"^",5)) D:IBFLD2="OBS ADMIS" CLSF^IBECEAU5(+$P(IBDATA,U,6)) W ! S IBLINE=IBLINE+1
"RTN","IBOVOP2",16,0)
 ....Q:$O(^TMP("IBOVOP",$J,IBFLD1))=""
"RTN","IBOVOP2",17,0)
 ....I IBLINE>55 D HDR W !,IBFLD1 I $D(^TMP("IBOVOP",$J,IBFLD1,IBFLD2,IBFLD3,IBSEQ+1)) W !?5,IBFLD2
"RTN","IBOVOP2",18,0)
 ....I $Y>(IOSL-5) D PAUSE^IBOUTL Q:IBQUIT  D HDR W !,IBFLD1,!?5,IBFLD2
"RTN","IBOVOP2",19,0)
 D:'IBQUIT PAUSE^IBOUTL
"RTN","IBOVOP2",20,0)
 Q
"RTN","IBOVOP2",21,0)
 ;
"RTN","IBOVOP2",22,0)
CHRGS ; Find OP charges for day, if any. Build string for print.
"RTN","IBOVOP2",23,0)
 Q:'$G(DFN)
"RTN","IBOVOP2",24,0)
 N IBSTDATA
"RTN","IBOVOP2",25,0)
 I $D(^IB("AFDT",DFN,-IBDATE))=10 D
"RTN","IBOVOP2",26,0)
 .S IBPRNT="" F  S IBPRNT=$O(^IB("AFDT",DFN,-IBDATE,IBPRNT)) Q:IBPRNT=""!(IBQUIT)  D
"RTN","IBOVOP2",27,0)
 ..S IBIEN="" F  S IBIEN=$O(^IB("AD",IBPRNT,IBIEN)) Q:IBIEN=""!(IBQUIT)  D
"RTN","IBOVOP2",28,0)
 ...S IBDATA=$G(^IB(IBIEN,0)) Q:IBDATA=""
"RTN","IBOVOP2",29,0)
 ...I $Y>(IOSL-5) D PAUSE^IBOUTL Q:IBQUIT  D HDR W !,IBFLD1
"RTN","IBOVOP2",30,0)
 ...S IBSTAT=$P($G(^IBE(350.21,+$P(IBDATA,"^",5),0)),"^",2)
"RTN","IBOVOP2",31,0)
 ...S IBACT=$S($P($G(^IBE(350.1,+$P(IBDATA,"^",3),0)),"^",8)'="":$P(^(0),"^",8),1:$P(^(0),"^",1))
"RTN","IBOVOP2",32,0)
 ...S IBAMT=$P(IBDATA,"^",7)
"RTN","IBOVOP2",33,0)
 ...S IBAMT=$S(IBAMT?1N.N1"."1N:IBAMT_"0 ",IBAMT?1N.N:IBAMT_".00 ",1:IBAMT)
"RTN","IBOVOP2",34,0)
 ...S IBAMT=$S(IBACT["CANCEL":"*($"_IBAMT_")",1:"* $"_IBAMT)
"RTN","IBOVOP2",35,0)
 ...S IBSTDATA=$G(^IBE(352.5,+$P(IBDATA,"^",20),0))
"RTN","IBOVOP2",36,0)
 ...I IBSTDATA'="" W !?26,"Stop Code: ",$P(IBSTDATA,"^",4),?58,"#",$P(IBSTDATA,"^"),?63,$$TYPE^IBEMTSCR(+$P(IBSTDATA,"^",3))
"RTN","IBOVOP2",37,0)
 ...W !?5,IBAMT,?13,IBACT,?63,IBSTAT S IBLINE=IBLINE+1
"RTN","IBOVOP2",38,0)
 Q
"RTN","IBOVOP2",39,0)
 ;
"RTN","IBOVOP2",40,0)
HDR ; Print header.
"RTN","IBOVOP2",41,0)
 S IBPAGE=IBPAGE+1,IBLINE=5,IBTITLE="Means Test/LTC Outpatient and Registration Activity for "_$$DAT1^IBOUTL(IBDATE)
"RTN","IBOVOP2",42,0)
 I $E(IOST,1,2)["C-"!(IBPAGE>1) W @IOF,*13
"RTN","IBOVOP2",43,0)
 W ?(80-$L(IBTITLE))\2,IBTITLE
"RTN","IBOVOP2",44,0)
 S IBTITLE="Printed: "_$$DAT1^IBOUTL(DT)
"RTN","IBOVOP2",45,0)
 W !?(80-$L(IBTITLE))\2,IBTITLE,?70,"Page: "_IBPAGE
"RTN","IBOVOP2",46,0)
 W !!,"Patient/Event",?20,"Time",?26,"Clinic/Stop",?44,"Appt.Type",?63,"(Status)",!
"RTN","IBOVOP2",47,0)
 Q
"RTN","IBOVOP2",48,0)
 ;
"RTN","IBOVOP2",49,0)
CLSF(IBOE) ; Display classification results.
"RTN","IBOVOP2",50,0)
 ;  Input:    IBOE  --  Pointer to Outpatient Encounter in file #409.68
"RTN","IBOVOP2",51,0)
 I '$G(IBOE) G CLSFQ
"RTN","IBOVOP2",52,0)
 N I,IBCLS,IBCLSD,IBF S IBF=0,IBCLSD=$$ENCL^IBAMTS2(IBOE)
"RTN","IBOVOP2",53,0)
 I IBCLSD]"" F I=1,2,3,4,5,6 S IBCLS=$P(IBCLSD,"^",I) I IBCLS]"" W:'IBF !?6 W:IBF "  " W "Care related to ",$S(I=1:"AO",I=2:"IR",I=3:"SC",I=4:"EC",5:"MST",1:"HNC"),"? ",$S(IBCLS:"YES",1:"NO") S IBF=1
"RTN","IBOVOP2",54,0)
CLSFQ Q
"VER")
8.0^22
"^DD",351.2,351.2,.03,0)
PATIENT TYPE^S^1:AGENT ORANGE;2:IONIZING RADIATION;3:ENVIRONMENTAL CONTAMINANT;4:SERVICE CONNECTED;5:MILITARY SEXUAL TRAUMA;6:HEAD/NECK CANCER;7:COMBAT VETERAN;^0;3^Q
"^DD",351.2,351.2,.03,3)
Please enter a number from 1 to 7 that best represents the exposure being claimed.
"^DD",351.2,351.2,.03,21,0)
^.001^3^3^3030807^^^
"^DD",351.2,351.2,.03,21,1,0)
This field is used to determine whether the patient has claimed exposure
"^DD",351.2,351.2,.03,21,2,0)
to Agent Orange, Ionizing Radiation, Environmental Contaminants, Military
"^DD",351.2,351.2,.03,21,3,0)
Sexual Trauma or Head/Neck Cancer.
"^DD",351.2,351.2,.03,"DT")
3030807
**END**
**END**
