Released PRC*5.1*101 SEQ #89
Extracted from mail message
**KIDS**:PRC*5.1*101^

**INSTALL NAME**
PRC*5.1*101
"BLD",4992,0)
PRC*5.1*101^IFCAP^0^3060726^y
"BLD",4992,1,0)
^^7^7^3060726^
"BLD",4992,1,1,0)
This patch corrects two issues.  The first issue involves a FRAMESTACK 
"BLD",4992,1,2,0)
error in running the BOC Totals report when the number of obligations in 
"BLD",4992,1,3,0)
a selected quarter approaches 3,000.  The second issue occurs when 
"BLD",4992,1,4,0)
running the option Generate Requests From Repetitive Item List Entry 
"BLD",4992,1,5,0)
[PRCSRI GENERATE].  An Undefined Error occurs when the default device for 
"BLD",4992,1,6,0)
the station selected for the given type of order (example:  Supply) is 
"BLD",4992,1,7,0)
either out-of-date or is non-existent.  
"BLD",4992,4,0)
^9.64PA^^
"BLD",4992,6)
1^
"BLD",4992,"KRN",0)
^9.67PA^8989.52^19
"BLD",4992,"KRN",.4,0)
.4
"BLD",4992,"KRN",.401,0)
.401
"BLD",4992,"KRN",.402,0)
.402
"BLD",4992,"KRN",.403,0)
.403
"BLD",4992,"KRN",.5,0)
.5
"BLD",4992,"KRN",.84,0)
.84
"BLD",4992,"KRN",3.6,0)
3.6
"BLD",4992,"KRN",3.8,0)
3.8
"BLD",4992,"KRN",9.2,0)
9.2
"BLD",4992,"KRN",9.8,0)
9.8
"BLD",4992,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4992,"KRN",9.8,"NM",1,0)
PRCSP1C1^^0^B12474530
"BLD",4992,"KRN",9.8,"NM",2,0)
PRCSRIG1^^0^B18163336
"BLD",4992,"KRN",9.8,"NM",3,0)
PRCSRIG2^^0^B48642698
"BLD",4992,"KRN",9.8,"NM","B","PRCSP1C1",1)

"BLD",4992,"KRN",9.8,"NM","B","PRCSRIG1",2)

"BLD",4992,"KRN",9.8,"NM","B","PRCSRIG2",3)

"BLD",4992,"KRN",19,0)
19
"BLD",4992,"KRN",19.1,0)
19.1
"BLD",4992,"KRN",101,0)
101
"BLD",4992,"KRN",409.61,0)
409.61
"BLD",4992,"KRN",771,0)
771
"BLD",4992,"KRN",870,0)
870
"BLD",4992,"KRN",8989.51,0)
8989.51
"BLD",4992,"KRN",8989.52,0)
8989.52
"BLD",4992,"KRN",8994,0)
8994
"BLD",4992,"KRN","B",.4,.4)

"BLD",4992,"KRN","B",.401,.401)

"BLD",4992,"KRN","B",.402,.402)

"BLD",4992,"KRN","B",.403,.403)

"BLD",4992,"KRN","B",.5,.5)

"BLD",4992,"KRN","B",.84,.84)

"BLD",4992,"KRN","B",3.6,3.6)

"BLD",4992,"KRN","B",3.8,3.8)

"BLD",4992,"KRN","B",9.2,9.2)

"BLD",4992,"KRN","B",9.8,9.8)

"BLD",4992,"KRN","B",19,19)

"BLD",4992,"KRN","B",19.1,19.1)

"BLD",4992,"KRN","B",101,101)

"BLD",4992,"KRN","B",409.61,409.61)

"BLD",4992,"KRN","B",771,771)

"BLD",4992,"KRN","B",870,870)

"BLD",4992,"KRN","B",8989.51,8989.51)

"BLD",4992,"KRN","B",8989.52,8989.52)

"BLD",4992,"KRN","B",8994,8994)

"BLD",4992,"QUES",0)
^9.62^^
"BLD",4992,"REQB",0)
^9.611^2^1
"BLD",4992,"REQB",2,0)
PRC*5.1*81^2
"BLD",4992,"REQB","B","PRC*5.1*81",2)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
101^3060726^123456803
"PKG",455,22,1,"PAH",1,1,0)
^^7^7^3060726
"PKG",455,22,1,"PAH",1,1,1,0)
This patch corrects two issues.  The first issue involves a FRAMESTACK 
"PKG",455,22,1,"PAH",1,1,2,0)
error in running the BOC Totals report when the number of obligations in 
"PKG",455,22,1,"PAH",1,1,3,0)
a selected quarter approaches 3,000.  The second issue occurs when 
"PKG",455,22,1,"PAH",1,1,4,0)
running the option Generate Requests From Repetitive Item List Entry 
"PKG",455,22,1,"PAH",1,1,5,0)
[PRCSRI GENERATE].  An Undefined Error occurs when the default device for 
"PKG",455,22,1,"PAH",1,1,6,0)
the station selected for the given type of order (example:  Supply) is 
"PKG",455,22,1,"PAH",1,1,7,0)
either out-of-date or is non-existent.  
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PRCSP1C1")
0^1^B12474530^B12327241
"RTN","PRCSP1C1",1,0)
PRCSP1C1 ;SF/LJP-CONTROL POINT ACTIVITY PRINT OPTIONS CON'T ;4-26-94/3:45 PM
"RTN","PRCSP1C1",2,0)
V ;;5.1;IFCAP;**101**;Oct 20, 2000
"RTN","PRCSP1C1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSP1C1",4,0)
SUB ;BUDGET OBJECT CODE TOTALS
"RTN","PRCSP1C1",5,0)
 D EN1^PRCSUT G W1:'$D(PRC("SITE")),EXIT:Y<0 W ! S %ZIS="MQ" D ^%ZIS G EXIT:POP I $D(IO("Q")) S ZTRTN="SUB1^PRCSP1C1",ZTSAVE("DUZ")="",ZTSAVE("PRC*")="" D ^%ZTLOAD,EXIT,W2 G SUB
"RTN","PRCSP1C1",6,0)
SUB1 K T S (N,Z1)="",(T("COM"),T("OBL"),P)=0 D SUB2
"RTN","PRCSP1C1",7,0)
 U IO D SUBHD W !,"BUDGET OBJECT CODE TOTALS",! S X="",$P(X,"-",18)="" W X S N=""
"RTN","PRCSP1C1",8,0)
 S S=0 F I=0:1 S S=$O(T("S",S)) Q:S'>0  S PRC("SUB")=^PRCD(420.2,+S,0),PRC("SUB")=$P(PRC("SUB"),"^") W !,$E(PRC("SUB"),1,60),?70,$J(T("S",S),10,2) I IOSL-$Y<6 D HOLD Q:Z1[U  D SUBHD
"RTN","PRCSP1C1",9,0)
 G SUB:Z1[U I 'I W !!,"There are no transactions for this control point for the station and time frame",!,"you selected."
"RTN","PRCSP1C1",10,0)
 I IOSL-($Y#IOSL)<6 D HOLD Q:Z1[U  D SUBHD
"RTN","PRCSP1C1",11,0)
 I I S X="",$P(X,"-",38)="" W !,X W !,"TOTAL OBLIGATED (ACTUAL) COST: ",?70,$J(T("OBL"),10,2),!,"TOTAL COMMITTED (ESTIMATED) COST: ",?70,$J(T("COM"),10,2)
"RTN","PRCSP1C1",12,0)
 I I S REPORT2=1 D T2^PRCSAPP1 K REPORT2
"RTN","PRCSP1C1",13,0)
 I $D(ZTSK) D KILL^%ZTLOAD K ZTSK G EXIT
"RTN","PRCSP1C1",14,0)
 D W,W2 G SUB
"RTN","PRCSP1C1",15,0)
SUB2 S N1=PRC("SITE")_"-"_PRC("FY")_"-"_PRC("QTR")_"-"_$P(PRC("CP")," "),N2=N1_"-0000"
"RTN","PRCSP1C1",16,0)
S1 S N2=$O(^PRCS(410,"B",N2)) Q:$P(N2,"-",1,4)'=N1
"RTN","PRCSP1C1",17,0)
 S N3=0,N3=$O(^PRCS(410,"B",N2,N3)) G S1:'N3
"RTN","PRCSP1C1",18,0)
 G S1:'$D(^PRCS(410,N3,0)),S1:$P(^(0),U,2)'="O"
"RTN","PRCSP1C1",19,0)
 I $P(^PRCS(410,N3,0),"^",4)=1 D CALC2 G S2
"RTN","PRCSP1C1",20,0)
 S N4=0 F I=0:0 S N4=$O(^PRCS(410,N3,"IT",N4)) Q:N4'>0  I $D(^(N4,0)) S X=^(0) I $P(X,U,4)]"",+$P(X,U,2),+$P(X,U,7) D CALC
"RTN","PRCSP1C1",21,0)
 G S2
"RTN","PRCSP1C1",22,0)
CALC ;
"RTN","PRCSP1C1",23,0)
 S S=$P(X,U,4),SA=$P(X,U,2)*$P(X,U,7)
"RTN","PRCSP1C1",24,0)
 I $D(^PRCS(410,N3,"IT",N4,3)) S AMT=$P($G(^(0)),"^")-$P($G(^(0)),"^",2),SA=AMT
"RTN","PRCSP1C1",25,0)
 S:'$D(T("S",+S)) T("S",+S)=0 S T("S",+S)=T("S",+S)+SA,T("OBL")=T("OBL")+SA Q
"RTN","PRCSP1C1",26,0)
CALC2 ; Changes to include 1358s begin here
"RTN","PRCSP1C1",27,0)
 N AA,BB,PRCTMP
"RTN","PRCSP1C1",28,0)
 S PRCTMP=^PRCS(410,N3,3) F AA=6,8 S BB=AA+1 I $P(PRCTMP,"^",AA),$P(PRCTMP,"^",BB) D
"RTN","PRCSP1C1",29,0)
 .S S=$P(PRCTMP,"^",AA),SA=$P(PRCTMP,"^",BB)
"RTN","PRCSP1C1",30,0)
 .I '$D(T("S",+S)) S T("S",+S)=0
"RTN","PRCSP1C1",31,0)
 .S T("S",+S)=T("S",+S)+SA,T("OBL")=T("OBL")+SA
"RTN","PRCSP1C1",32,0)
 K AA,BB,PRCTMP
"RTN","PRCSP1C1",33,0)
 Q
"RTN","PRCSP1C1",34,0)
S2 S:$D(^PRCS(410,N3,4)) T("COM")=T("COM")+$P(^(4),U,1)
"RTN","PRCSP1C1",35,0)
 G S1
"RTN","PRCSP1C1",36,0)
SUBHD S P=P+1 W @IOF,!!,"BUDGET OBJECT CODE TOTALS REPORT",?50 D NOW^%DTC S Y=% D DD^%DT W Y,?73,"PAGE ",P
"RTN","PRCSP1C1",37,0)
 W !,"STATION ",PRC("SITE"),", ",PRC("QTR")_$S(PRC("QTR")=1:"ST",PRC("QTR")=2:"ND",PRC("QTR")=3:"RD",1:"TH")," QUARTER, FY",PRC("FY")," ,CONTROL POINT ",PRC("CP")
"RTN","PRCSP1C1",38,0)
 S L="",$P(L,"-",IOM)="-" W !,L Q
"RTN","PRCSP1C1",39,0)
HOLD Q:$D(ZTQUEUED)  Q:IO'=IO(0)  W !,"Press return to continue, uparrow (^) to exit: " R Z1:DTIME S:'$T Z1=U Q
"RTN","PRCSP1C1",40,0)
W1 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5 G EXIT
"RTN","PRCSP1C1",41,0)
W2 W !!,"Enter information for another report or an uparrow to return to the menu.",! Q
"RTN","PRCSP1C1",42,0)
W I '$D(ZTQUEUED),IO'=IO(0) U IO(0) W !!,"Press return to continue:  " R X:DTIME
"RTN","PRCSP1C1",43,0)
 I (IO'=IO(0))!($D(ZTQUEUED)) D ^%ZISC
"RTN","PRCSP1C1",44,0)
 I (IO=IO(0))!($D(ZTQUEUED)) D ^%ZISC
"RTN","PRCSP1C1",45,0)
EXIT K IO("Q"),S,SA,%,%DT,%ZIS,I,J,L,N,N1,N2,N3,N4,P,PRCS,T,X,Y,Z1,ZTRTN,ZTSAVE,PRC("SUB") Q
"RTN","PRCSRIG1")
0^2^B18163336^B18018274
"RTN","PRCSRIG1",1,0)
PRCSRIG1 ;WISC/SAW/KMB/LJP/SC-GENERATE REQUESTS FROM REPETITIVE ITEM LIST FILE (CON'T) ;3-3-93/14:30 ; 3/31/05 3:48pm
"RTN","PRCSRIG1",2,0)
V ;;5.1;IFCAP;**13,81,101**;Oct 20, 2000
"RTN","PRCSRIG1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSRIG1",4,0)
 ;
"RTN","PRCSRIG1",5,0)
 ;PRC*5.1*81, RIL that originated thru DynaMed is NOT allowed to be
"RTN","PRCSRIG1",6,0)
 ;RE-USED for generating 2237(s),hence removed this prompt for DM
"RTN","PRCSRIG1",7,0)
 ;trxs. only.
"RTN","PRCSRIG1",8,0)
 ;
"RTN","PRCSRIG1",9,0)
 U IO S PRCSNO=$P(^PRCS(410.3,PRCSRID0,0),"^"),PRC("SITE")=+PRCSNO,PRC("CP")=$S($D(^PRC(420,PRC("SITE"),1,+$P(PRCSNO,"-",4),0)):$P(^(0),"^"),1:"")
"RTN","PRCSRIG1",10,0)
 I PRC("CP")="" W !!,"Control Point ",$P(PRCSNO,"-",4),"no longer exists.  You will have to transfer",!,"this repetitive item list to an existing control point before you can continue." K PRC("CP") G EXIT
"RTN","PRCSRIG1",11,0)
 ;Create transaction number 
"RTN","PRCSRIG1",12,0)
 D:'$D(DT) DT^DICRW S PRCSTIME=$E(DT,4,5),PRCSQUAR=$P("2^2^2^3^3^3^4^4^4^1^1^1","^",PRCSTIME)
"RTN","PRCSRIG1",13,0)
 S:PQTR=1 PRCSQUAR=$P(PRCSNO,"-",3)
"RTN","PRCSRIG1",14,0)
 S Z1=$P(PRCSNO,"-")_"-"_PRC("FY")_"-"_PRCSQUAR_"-"_$P(PRCSNO,"-",4)
"RTN","PRCSRIG1",15,0)
 S Z2=$P(Z1,"-",1,2)_"-"_$P(Z1,"-",4)
"RTN","PRCSRIG1",16,0)
 S PRCSCC=$P(PRCSNO,"-",5),PRCSCC=$S($D(^PRCD(420.1,+PRCSCC,0)):$E($P(^(0),"^"),1,30),1:PRCSCC) S:PRCSCC="NONE" PRCSCC="" S X="N",%DT="T" D ^%DT S PRCSD1=$P(Y,".") X ^DD("DD") S PRCSD=Y,X="T+30" D ^%DT S PRCSD(1)=Y
"RTN","PRCSRIG1",17,0)
 ;
"RTN","PRCSRIG1",18,0)
 ;See NOIS MON-0399-51726
"RTN","PRCSRIG1",19,0)
 KILL ^TMP($J)
"RTN","PRCSRIG1",20,0)
 S IB=0
"RTN","PRCSRIG1",21,0)
 F  S IB=$O(^PRCS(410.3,PRCSRID0,1,IB)) Q:'IB  D  ;
"RTN","PRCSRIG1",22,0)
 . S FF=$G(^PRCS(410.3,PRCSRID0,1,IB,0))
"RTN","PRCSRIG1",23,0)
 . S ^TMP($J,410.3,PRCSRID0,1,"AC",$P(FF,"^",3)_";"_$P(FF,"^",5),IB)=""
"RTN","PRCSRIG1",24,0)
 ;
"RTN","PRCSRIG1",25,0)
 ; Loop thru RIL entry numbers. PRCSV1 is the vendor for
"RTN","PRCSRIG1",26,0)
 ;the item, from the Rep. Item List. Starting here, loop
"RTN","PRCSRIG1",27,0)
 ;thru the vendor to get the items ordered from that vendor,
"RTN","PRCSRIG1",28,0)
 ;using PRCSRI for the item.
"RTN","PRCSRIG1",29,0)
 S (PRCSV1,PRCSTC)="",(PRCSCT,PRCSCT(1),PRCSIT,BFLAG)=0
"RTN","PRCSRIG1",30,0)
 F PRCSRIJ=0:1 S PRCSV1=$O(^TMP($J,410.3,PRCSRID0,1,"AC",PRCSV1)) Q:PRCSV1=""!(BFLAG=1)  S PRCSCT=PRCSCT+1,PRCSCT(1)=PRCSCT(1)+1 D:'PRCSRIJ HDRG D ITEMG^PRCSRIG2
"RTN","PRCSRIG1",31,0)
 I 'PRCSRIJ W !,"Items have not yet been entered for Repetitive Item List # ",PRCSNO G CLS
"RTN","PRCSRIG1",32,0)
 D:IOSL-$Y<3 HOLD,HDRG W !!,"Total no. of requests generated: ",PRCSCT,"    Total no. of items (all requests): ",PRCSIT,!,"Total committed (estimated) cost (all requests) : ","$"_$J(PRCSTC,0,2)
"RTN","PRCSRIG1",33,0)
SV ;
"RTN","PRCSRIG1",34,0)
 I (IO'=IO(0))!($D(ZTQUEUED)) D ^%ZISC
"RTN","PRCSRIG1",35,0)
 G EXIT:$D(ZTQUEUED)
"RTN","PRCSRIG1",36,0)
 ;patch *81 -DynaMed trx. is not allowed to be re-used
"RTN","PRCSRIG1",37,0)
 N PRCVSY,PRCVID
"RTN","PRCSRIG1",38,0)
 S PRCVSY=$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")
"RTN","PRCSRIG1",39,0)
 I PRCVSY=1 S PRCVID=$$ITDMID(PRCSRID0)
"RTN","PRCSRIG1",40,0)
 I PRCVSY=1,PRCVID=1 G CHK1
"RTN","PRCSRIG1",41,0)
 U IO(0) S %=2 W !,"Do you wish to re-use this list " D YN^DICN G:%=1 JMP G:%=0 SV
"RTN","PRCSRIG1",42,0)
CHK1 I PRCSCT=PRCSCT(1) S DIK="^PRCS(410.3,",DA=PRCSRID0 D ^DIK G CLS
"RTN","PRCSRIG1",43,0)
JMP D RLR^PRCSUT1
"RTN","PRCSRIG1",44,0)
 S $P(^PRCS(410.3,PRCSRID0,0),U,5)="",DIK="^PRCS(410.3,",DA=PRCSRID0 D IX^DIK
"RTN","PRCSRIG1",45,0)
CLS ;
"RTN","PRCSRIG1",46,0)
 D:$D(ZTSK) KILL^%ZTLOAD G EXIT
"RTN","PRCSRIG1",47,0)
 ;
"RTN","PRCSRIG1",48,0)
HDRG W @IOF,"GENERATE REQUESTS FROM REPETITIVE ITEM LIST FILE",?55,"DATE: ",PRCSD,!,"Requests Generated From Repetitive Item List Entry # ",PRCSNO,! S L="",$P(L,"-",IOM)="-" W L S L=""
"RTN","PRCSRIG1",49,0)
 Q
"RTN","PRCSRIG1",50,0)
 ;
"RTN","PRCSRIG1",51,0)
HOLD Q:IO'=IO(0)!($D(ZTQUEUED))  W !,"Press return to continue: " R Z(1):DTIME Q
"RTN","PRCSRIG1",52,0)
ASK S %=2 W !,"Do you wish to edit this request" D YN^DICN D ASK:%=0 G:%=2 EN1 Q:%'=1
"RTN","PRCSRIG1",53,0)
EN W ! K DTOUT,DUOUT,Y S DIE="^PRCS(410,",(PRCSDR,DR)="[PRCSENPR]",T1=DA D ^DIE I $D(Y)!($D(DTOUT)) S DA=T1 Q
"RTN","PRCSRIG1",54,0)
 S DA=T1 D RL^PRCSUT1,^PRCSCK I $D(PRCSERR),PRCSERR G EN
"RTN","PRCSRIG1",55,0)
EN1 W ! D W6^PRCSEB Q
"RTN","PRCSRIG1",56,0)
 ;*****************************************************************
"RTN","PRCSRIG1",57,0)
 ; PRCSRID0 represents the ien of the record in file 410.3
"RTN","PRCSRIG1",58,0)
 ; patch *81 --itdmid removes Re-use Ques for DM related RIL
"RTN","PRCSRIG1",59,0)
 ;*****************************************************************
"RTN","PRCSRIG1",60,0)
ITDMID(PRCSRID0) ; check DynaMed DOC ID existence for an item
"RTN","PRCSRIG1",61,0)
 ;N PRCVA,PRCVB,PRCVFLG
"RTN","PRCSRIG1",62,0)
 ;S PRCVA=0
"RTN","PRCSRIG1",63,0)
 ;S PRCVFLG=0 ; 0 means that there is no DM ID on a item
"RTN","PRCSRIG1",64,0)
 ;S PRCVA=$O(^PRCS(410.3,PRCSRID0,1,PRCVA)) D
"RTN","PRCSRIG1",65,0)
 ;.Q:+$G(PRCVA)'>0
"RTN","PRCSRIG1",66,0)
 ;.S PRCVB=$$GET1^DIQ(410.31,PRCVA_","_PRCSRID0_",",6) ; DM doc id
"RTN","PRCSRIG1",67,0)
 ;.I PRCVB'="" S PRCVFLG=1 Q
"RTN","PRCSRIG1",68,0)
 ;Q PRCVFLG
"RTN","PRCSRIG1",69,0)
 ;
"RTN","PRCSRIG1",70,0)
 ;Remove the prompt if entry is set in 414.02 Audit File 'C' x-ref
"RTN","PRCSRIG1",71,0)
 N PRCVFLG,PRCVL,PRCVM
"RTN","PRCSRIG1",72,0)
 S PRCVM=$$GET1^DIQ(410.3,PRCSRID0_",",.01) ; ext value of RIL trx
"RTN","PRCSRIG1",73,0)
 S PRCVL=""
"RTN","PRCSRIG1",74,0)
 S PRCVFLG=0
"RTN","PRCSRIG1",75,0)
 S PRCVL=$O(^PRCV(414.02,"C",PRCVM,PRCVL))
"RTN","PRCSRIG1",76,0)
 I PRCVL'="" S PRCVFLG=1 Q 1
"RTN","PRCSRIG1",77,0)
 Q PRCVFLG
"RTN","PRCSRIG1",78,0)
 ;
"RTN","PRCSRIG1",79,0)
 ;
"RTN","PRCSRIG1",80,0)
EXIT K %,%DT,%ZIS,PRCSRID0,DA,DIC,DIE,DIK,PRCSRIJ,K,L,PRCSRIM,PRCS,PRCSCS
"RTN","PRCSRIG1",81,0)
 K PRCSCT,PRCSCC,PRCSD,PRCSD1,PRCSRI,PRCSIT,PRCSL,PRCSNO,PRCSS,PRCSTC
"RTN","PRCSRIG1",82,0)
 K PRCSV1,PX,T1,X,X1,X2,Y,Z,Z1,Z2
"RTN","PRCSRIG1",83,0)
 K PRCSTIME,PRCSQUAR,^TMP($J) Q
"RTN","PRCSRIG2")
0^3^B48642698^B42383043
"RTN","PRCSRIG2",1,0)
PRCSRIG2 ;SF-ISC/LJP/KMB/BMM-GENERATE REQUESTS FROM REPETITIVE ITEM LIST FILE (CON'T) ; 3/25/05 3:05pm
"RTN","PRCSRIG2",2,0)
V ;;5.1;IFCAP;**13,81,101**;Oct 20, 2000
"RTN","PRCSRIG2",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCSRIG2",4,0)
 ;PRCSRI is the ordered item from the RIL.  PX(3) is
"RTN","PRCSRIG2",5,0)
 ;the ordered item from the Item Master File. PRCSV1 is
"RTN","PRCSRIG2",6,0)
 ;the vendor from the RIL. X2 is the vendor listed for
"RTN","PRCSRIG2",7,0)
 ;the item from the Item Master File. PX(1) holds Item
"RTN","PRCSRIG2",8,0)
 ;Master File data, PX(2) holds Vendor File data.
"RTN","PRCSRIG2",9,0)
 ;
"RTN","PRCSRIG2",10,0)
 ;2/16/05 BMM per PRC*5.1*81, added code in ITEMG1 to capture
"RTN","PRCSRIG2",11,0)
 ;data from two new fields in files 410 and 410.3:
"RTN","PRCSRIG2",12,0)
 ;DM Doc ID (410 #17, 410.3 #6) and Date Needed (410 #18, 410.3 #7)
"RTN","PRCSRIG2",13,0)
 ;added variables PRCVDN, PRCVDTN in ITEMG
"RTN","PRCSRIG2",14,0)
 ;
"RTN","PRCSRIG2",15,0)
 ;3/9/05 BMM per PRC*5.1*81, added sub UPDAUD to update the DM Audit
"RTN","PRCSRIG2",16,0)
 ;file when a 2237 is created.
"RTN","PRCSRIG2",17,0)
 ;
"RTN","PRCSRIG2",18,0)
ITEMG N STOP,PRCVDN,PRCVDTN S (PRCSRI,PRCSCS,STOP)="",(PRCSIT(1),K,BFLAG)=0
"RTN","PRCSRIG2",19,0)
 S (PRCVDN,PRCVDTN)=""
"RTN","PRCSRIG2",20,0)
 F PRCSRIM=0:1 S PRCSRI=$O(^TMP($J,410.3,PRCSRID0,1,"AC",PRCSV1,PRCSRI)) Q:PRCSRI=""  S PRCSIT=PRCSIT+1,PRCSIT(1)=PRCSIT(1)+1 D ITEMG1 D:STOP'=1 ITEMG3 Q:BFLAG  S STOP=""
"RTN","PRCSRIG2",21,0)
 D:'BFLAG
"RTN","PRCSRIG2",22,0)
 . D:$D(DA) ITEMG2 I $D(PRCSL),PRCSL L
"RTN","PRCSRIG2",23,0)
 . D:IOSL-$Y<2 HOLD,HDRG W !!,"  Finished building request.",!,"This request contains ",PRCSIT(1)_$S(PRCSIT(1)=1:" item.",1:" items."),"  The total cost for this request is $",$J(PRCSCS,0,2),! S L="",$P(L,"-",IOM)="-" W L S L=""
"RTN","PRCSRIG2",24,0)
 . S PRCSTC=PRCSTC+PRCSCS Q
"RTN","PRCSRIG2",25,0)
 D:BFLAG
"RTN","PRCSRIG2",26,0)
 . I (PRCSIT>0)  D
"RTN","PRCSRIG2",27,0)
 . . S PRCSIT=PRCSIT-1
"RTN","PRCSRIG2",28,0)
 . I (PRCSCT>0)  D
"RTN","PRCSRIG2",29,0)
 . . S PRCSCT=PRCSCT-1
"RTN","PRCSRIG2",30,0)
 Q
"RTN","PRCSRIG2",31,0)
 ;
"RTN","PRCSRIG2",32,0)
ITEMG1 S PX=^PRCS(410.3,PRCSRID0,1,PRCSRI,0),PX(3)=$P(PX,"^"),PX(1)=^PRC(441,PX(3),0),X2=$P(PX,"^",5),PX(2)=^PRC(440,X2,0),PRCVDN=$P(PX,"^",7),PRCVDTN=$P(PX,"^",8)
"RTN","PRCSRIG2",33,0)
 ; If a discrepancy is found, set STOP=1, skip item
"RTN","PRCSRIG2",34,0)
 I $D(PX(1)),$P(PX(1),"^",10)'?4N W !,"The budget object code for this item is not entered in the Item Master File.",!,"This item cannot be processed.",! S STOP=1
"RTN","PRCSRIG2",35,0)
 I '$D(^PRC(441,PX(3),2,X2,0)) D:IOSL-$Y<2 HOLD,HDRG W !,$C(7),"WARNING!!! Item # ",PX(3)," is not available from ",$P(PRCSV1,";"),"  (",$P(PRCSV1,";",2),")",!,"This item cannot be processed.",! S PRCSIT=PRCSIT-1,PRCSIT(1)=PRCSIT(1)-1 S STOP=1
"RTN","PRCSRIG2",36,0)
 Q
"RTN","PRCSRIG2",37,0)
 ;
"RTN","PRCSRIG2",38,0)
ITEMG3 I '$D(Z1)!'$D(Z2)  D DVERR Q
"RTN","PRCSRIG2",39,0)
 I 'K S Z=Z1,X=Z2 D EN1^PRCSUT3 G:'X EX S X1=X D EN2^PRCSUT3 G:'$D(X1) EX L +^PRCS(410,DA):15 G:$T=0 EX
"RTN","PRCSRIG2",40,0)
 D:IOSL-$Y<7 HOLD,HDRG
"RTN","PRCSRIG2",41,0)
 I 'K W !,"A request with Transaction Number ",$P(Y(0),"^")," has been generated.",!!,"The vendor for this request is ",$P(PRCSV1,";"),"  (",$P(PRCSV1,";",2),")",!,"Now entering items for this request."
"RTN","PRCSRIG2",42,0)
 ;PRC*5.1*81 update audit file for 2237 creation
"RTN","PRCSRIG2",43,0)
 I 'K S PRCV2=$P(Y(0),"^",1)
"RTN","PRCSRIG2",44,0)
 ;S K=K+1,X(3)=^PRC(441,PX(3),2,X2,0) I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)),$P(^(0),U,12)<1 S PRCSS=$S($P(PX(1),"^",10):$E($P(^PRCD(420.2,$P(PX(1),"^",10),0),"^"),1,30),1:"")
"RTN","PRCSRIG2",45,0)
 ;
"RTN","PRCSRIG2",46,0)
 ;For a Supply Fund Requests adding code to derive BOC from NSN
"RTN","PRCSRIG2",47,0)
 S K=K+1
"RTN","PRCSRIG2",48,0)
 S X(3)=^PRC(441,PX(3),2,X2,0)
"RTN","PRCSRIG2",49,0)
 S ITNSN=$E($P($G(^PRC(441,+PX(3),0)),U,5),1,4)
"RTN","PRCSRIG2",50,0)
 I $D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)) D
"RTN","PRCSRIG2",51,0)
 . I $P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),U,12)'=2!($P(^(0),U,12)'=4) D
"RTN","PRCSRIG2",52,0)
 . . S PRCSS=$S($P(PX(1),"^",10):$E($P(^PRCD(420.2,$P(PX(1),"^",10),0),"^"),1,30),1:"")
"RTN","PRCSRIG2",53,0)
 . . Q
"RTN","PRCSRIG2",54,0)
 . I $P(^PRC(420,PRC("SITE"),1,+PRC("CP"),0),U,12)=2!($P(^(0),U,12)=4) D
"RTN","PRCSRIG2",55,0)
 . . S ITACCT=$$ACCT^PRCPUX1(ITNSN)
"RTN","PRCSRIG2",56,0)
 . . S ITBOC=$S(ITACCT=1:2697,ITACCT=2:2698,ITACCT=3:2699,ITACCT=6:2699,ITACCT=8:2696,1:2699)
"RTN","PRCSRIG2",57,0)
 . . S PRCSS=$E($P(^PRCD(420.2,ITBOC,0),U,1),1,30)
"RTN","PRCSRIG2",58,0)
 . . Q
"RTN","PRCSRIG2",59,0)
 . Q
"RTN","PRCSRIG2",60,0)
 S:'$D(PRCSS) PRCSS="" S ^PRCS(410,DA,"IT",K,0)=K_"^"_$P(PX,"^",2)_"^"_$P(X(3),"^",7)_"^"_PRCSS_"^"_PX(3)_"^"_$P(X(3),"^",4)_"^"_$P(PX,"^",4),^PRCS(410,DA,"IT",K,1,0)="^^1^1^"_PRCSD1_"^^",^(1,0)=$P(PX(1),"^",2)
"RTN","PRCSRIG2",61,0)
 ;PRC*5.1*81 add DM Doc ID, Date Needed to new line item
"RTN","PRCSRIG2",62,0)
 ;
"RTN","PRCSRIG2",63,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D
"RTN","PRCSRIG2",64,0)
 . Q:'$D(^PRCV(414.02,"C",PRCSNO))
"RTN","PRCSRIG2",65,0)
 . S ^PRCS(410,DA,"IT",K,4)=PRCVDN_"^"_PRCVDTN
"RTN","PRCSRIG2",66,0)
 . D UPDAUD(PRCV2)
"RTN","PRCSRIG2",67,0)
 S ^PRCS(410,DA,"IT","B",K,K)="",^PRCS(410,DA,"IT","AB",K,K)="" S:PRCSS ^PRCS(410,"AD",PRCSS,DA)=""
"RTN","PRCSRIG2",68,0)
 S PRCSCS=PRCSCS+($P(PX,"^",2)*($P(PX,"^",4))) G EX2
"RTN","PRCSRIG2",69,0)
 ;
"RTN","PRCSRIG2",70,0)
ITEMG2 S ^PRCS(410,DA,"IT",0)="^"_"410.02AI"_"^"_K_"^"_K,%=$P(^PRCS(410.3,PRCSRID0,0),"^",3),$P(^PRCS(410,DA,0),"^",2)="O" S:% $P(^(0),"^",6)=%,^PRCS(410,"AO",%,DA)="" S $P(^PRCS(410,DA,0),"^",4)=$S($D(^PRC(440,"AC","S",X2)):5,1:3)
"RTN","PRCSRIG2",71,0)
 S ^PRCS(410,DA,1)=PRCSD1_"^^"_"ST"_"^"_PRCSD(1),^(2)=PX(2),^PRCS(410,DA,3)=$P(^PRCS(410,DA,3),"^",1,2)_"^"_PRCSCC_"^"_X2_"^"_$S($D(^PRC(420,PRC("SITE"),1,+PRC("CP"),0)):$P(^(0),"^",10),1:"")
"RTN","PRCSRIG2",72,0)
 S $P(^PRCS(410,DA,3),"^",11)=$P($$DATE^PRC0C(PRC("BBFY"),"E"),"^",7)
"RTN","PRCSRIG2",73,0)
 S:PRC("ACC") $P(^PRCS(410,DA,3),"^",12)=$P(PRC("ACC"),"^",3)
"RTN","PRCSRIG2",74,0)
 S ^PRCS(410,DA,4)=PRCSCS_"^"_PRCSD1_"^^^^^^"_PRCSCS,^(10)=K,^(7)=+PRC("PER")_"^"_$P(PRC("PER"),"^",3) S:'$D(^(11)) ^(11)=""
"RTN","PRCSRIG2",75,0)
 S ^PRCS(410,"E",$E($P(PX(2),"^"),1,30),DA)="" S:PRCSCC ^PRCS(410,"AC",$E(PRCSCC,1,30),DA)=""
"RTN","PRCSRIG2",76,0)
 I IO'=IO(0)!$D(ZTQUEUED) S $P(^PRCS(410,DA,11),U,3)=1,^PRCS(410,"F",PRC("SITE")_"-"_+PRC("CP")_"-"_$P($P(^PRCS(410,DA,0),U),"-",5),DA)="",^PRCS(410,"F1",$P($P(^PRCS(410,DA,0),U),"-",5)_"-"_PRC("SITE")_"-"_+PRC("CP"),DA)=""
"RTN","PRCSRIG2",77,0)
 I IO'=IO(0)!$D(ZTQUEUED) S ^PRCS(410,"AQ",1,DA)="" L -^PRCS(410,DA) G END
"RTN","PRCSRIG2",78,0)
 S PRC("QTR")=$P($P(^PRCS(410,DA,0),U),"-",3) D ASK^PRCSRIG1 L -^PRCS(410,DA)
"RTN","PRCSRIG2",79,0)
END K DA,PRCSDR,PRCSCQT,PRCSOCK,PRCSOCP,PRCSOCS,PRCST,PRCST1,PX,X2 Q
"RTN","PRCSRIG2",80,0)
 ;
"RTN","PRCSRIG2",81,0)
HDRG W @IOF,"GENERATE REQUESTS FROM REPETITIVE ITEM LIST FILE",?55,"DATE: ",PRCSD,!,"Requests Generated From Repetitive Item List Entry # ",PRCSNO,! S L="",$P(L,"-",IOM)="-" W L S L=""
"RTN","PRCSRIG2",82,0)
 Q
"RTN","PRCSRIG2",83,0)
 ;
"RTN","PRCSRIG2",84,0)
HOLD Q:IO'=IO(0)!($D(ZTQUEUED))  W !,"Press return to continue: " R Z(1):DTIME Q
"RTN","PRCSRIG2",85,0)
EX K PX,X,X1,X2,Z S PRCSCT=PRCSCT-1 W $C(7),!,"Could not create a request" Q
"RTN","PRCSRIG2",86,0)
EX1 K X,X2 D KRL K PX Q
"RTN","PRCSRIG2",87,0)
EX2 K PRCSS,Y D KRL K PX(3),X(3) Q
"RTN","PRCSRIG2",88,0)
KRL Q
"RTN","PRCSRIG2",89,0)
 ;
"RTN","PRCSRIG2",90,0)
UPDAUD(PRCV2) ;per PRC*5.1*81, update DM Audit file (#414.02) when 2237 is created
"RTN","PRCSRIG2",91,0)
 ;PRCV2 - 2237's .01 value
"RTN","PRCSRIG2",92,0)
 ;PRCVDYN - DM Doc ID for each item
"RTN","PRCSRIG2",93,0)
 ;PRCSRID0 - RIL IEN from above
"RTN","PRCSRIG2",94,0)
 ;
"RTN","PRCSRIG2",95,0)
 ;first check DM flag
"RTN","PRCSRIG2",96,0)
 ;Q:$$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")'=1
"RTN","PRCSRIG2",97,0)
 N PRCVA,PRCVAC,PRCVC,PRCVDI,PRCVDYN,PRCVI,PRCVIEN,PRCVFCP
"RTN","PRCSRIG2",98,0)
 N PRCVFL,PRCVJ,PRCVST,PRCVTMP,XMB
"RTN","PRCSRIG2",99,0)
 S (PRCVC,PRCVDYN,PRCVIEN)="",PRCVFL=0
"RTN","PRCSRIG2",100,0)
 ;get #items for RIL in 414.02
"RTN","PRCSRIG2",101,0)
 ;F PRCVI=0:1 S PRCVC=$O(^PRCV(414.02,"C",PRCSNO,PRCVC)) Q:PRCVC=""
"RTN","PRCSRIG2",102,0)
 ;for each item, update entry in 414.02
"RTN","PRCSRIG2",103,0)
 ;F PRCVJ=1:1:PRCVI Q:PRCVFL=1  D
"RTN","PRCSRIG2",104,0)
 S PRCVJ=PRCSRI D
"RTN","PRCSRIG2",105,0)
 . S PRCVDYN=$$GET1^DIQ(410.31,PRCVJ_","_PRCSRID0_",",6)
"RTN","PRCSRIG2",106,0)
 . ;
"RTN","PRCSRIG2",107,0)
 . I PRCVDYN="" D  Q
"RTN","PRCSRIG2",108,0)
 . . ;DM Doc ID missing
"RTN","PRCSRIG2",109,0)
 . . S PRCVTMP="PRCSRIG2",PRCVST=$P(PRCSNO,"-")
"RTN","PRCSRIG2",110,0)
 . . S PRCVFCP=$P(PRCSNO,"-",4)
"RTN","PRCSRIG2",111,0)
 . . S XMB(1)="creating a new 2237 record"
"RTN","PRCSRIG2",112,0)
 . . S XMB(2)=" <missing>"
"RTN","PRCSRIG2",113,0)
 . . S XMB(3)="DM doc ID value missing from line item in 2237"
"RTN","PRCSRIG2",114,0)
 . . S ^TMP($J,"PRCSRIG2",1,0)=""
"RTN","PRCSRIG2",115,0)
 . . S ^TMP($J,"PRCSRIG2",2,0)="2237 #: "_PRCV2
"RTN","PRCSRIG2",116,0)
 . . S ^TMP($J,"PRCSRIG2",3,0)="Item #: "_PX(3)
"RTN","PRCSRIG2",117,0)
 . . D DMERXMB^PRCVLIC(PRCVTMP,PRCVST,PRCVFCP)
"RTN","PRCSRIG2",118,0)
 . ;
"RTN","PRCSRIG2",119,0)
 . S PRCVIEN=$O(^PRCV(414.02,"B",PRCVDYN,0))
"RTN","PRCSRIG2",120,0)
 . S PRCVA(414.02,PRCVIEN_",",7)=PRCV2
"RTN","PRCSRIG2",121,0)
 . D FILE^DIE("","PRCVA")
"RTN","PRCSRIG2",122,0)
 . I $D(^TMP("DIERR",$J)) D  Q
"RTN","PRCSRIG2",123,0)
 . . ;error updating Audit file
"RTN","PRCSRIG2",124,0)
 . . S PRCVTMP="PRCSRIG2",PRCVST=$P(PRCSNO,"-")
"RTN","PRCSRIG2",125,0)
 . . S PRCVFCP=$P(PRCSNO,"-",4)
"RTN","PRCSRIG2",126,0)
 . . S XMB(1)="updating the DynaMed IFCAP Interface Audit file (#414.02)"
"RTN","PRCSRIG2",127,0)
 . . S XMB(2)=PRCVDYN
"RTN","PRCSRIG2",128,0)
 . . S XMB(3)="unable to add update to Audit file entry"
"RTN","PRCSRIG2",129,0)
 . . S ^TMP($J,"PRCSRIG2",1,0)=""
"RTN","PRCSRIG2",130,0)
 . . S ^TMP($J,"PRCSRIG2",2,0)="2237 #: "_PRCV2
"RTN","PRCSRIG2",131,0)
 . . S ^TMP($J,"PRCSRIG2",3,0)="Item #: "_PX(3)
"RTN","PRCSRIG2",132,0)
 . . S ^TMP($J,"PRCSRIG2",4,0)="Error text: "_$G(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","PRCSRIG2",133,0)
 . . D DMERXMB^PRCVLIC(PRCVTMP,PRCVST,PRCVFCP)
"RTN","PRCSRIG2",134,0)
 Q
"RTN","PRCSRIG2",135,0)
DVERR D BLNKON
"RTN","PRCSRIG2",136,0)
 W !,"There is an error with the default device defined in file 411.",!,"Please contact IRM before proceeding.",!
"RTN","PRCSRIG2",137,0)
 D BLNKOFF
"RTN","PRCSRIG2",138,0)
 S BFLAG=1
"RTN","PRCSRIG2",139,0)
 Q
"RTN","PRCSRIG2",140,0)
 ;
"RTN","PRCSRIG2",141,0)
BLNKON ;if terminal-type exists turn-on blink
"RTN","PRCSRIG2",142,0)
 D:$D(IOST(0))
"RTN","PRCSRIG2",143,0)
 . S X="IOBON"
"RTN","PRCSRIG2",144,0)
 . D ENDR^%ZISS
"RTN","PRCSRIG2",145,0)
 . W IOBON
"RTN","PRCSRIG2",146,0)
 Q
"RTN","PRCSRIG2",147,0)
BLNKOFF ;if terminal-type exists turn-off blink
"RTN","PRCSRIG2",148,0)
 D:$D(IOST(0))
"RTN","PRCSRIG2",149,0)
 . S X="IOBOFF"
"RTN","PRCSRIG2",150,0)
 . D ENDR^%ZISS
"RTN","PRCSRIG2",151,0)
 . W IOBOFF
"RTN","PRCSRIG2",152,0)
 Q
"VER")
8.0^22.0
"BLD",4992,6)
^89
**END**
**END**
