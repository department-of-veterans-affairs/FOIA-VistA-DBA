Released IB*2*239 SEQ #232
Extracted from mail message
**KIDS**:IB*2.0*239^

**INSTALL NAME**
IB*2.0*239
"BLD",4962,0)
IB*2.0*239^INTEGRATED BILLING^0^3040126^y
"BLD",4962,1,0)
^^2^2^3030803^
"BLD",4962,1,1,0)
Care Units are displaying incorrectly on the Insurance Company Provider
"BLD",4962,1,2,0)
ID Maintenance screen.
"BLD",4962,4,0)
^9.64PA^^
"BLD",4962,"INID")
^n
"BLD",4962,"INIT")
POST^IB20P239
"BLD",4962,"KRN",0)
^9.67PA^8989.52^19
"BLD",4962,"KRN",.4,0)
.4
"BLD",4962,"KRN",.401,0)
.401
"BLD",4962,"KRN",.402,0)
.402
"BLD",4962,"KRN",.403,0)
.403
"BLD",4962,"KRN",.5,0)
.5
"BLD",4962,"KRN",.84,0)
.84
"BLD",4962,"KRN",3.6,0)
3.6
"BLD",4962,"KRN",3.8,0)
3.8
"BLD",4962,"KRN",9.2,0)
9.2
"BLD",4962,"KRN",9.8,0)
9.8
"BLD",4962,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4962,"KRN",9.8,"NM",1,0)
IBCEP0^^0^B58046488
"BLD",4962,"KRN",9.8,"NM",2,0)
IBCEP5B^^0^B75933281
"BLD",4962,"KRN",9.8,"NM",3,0)
IBCEP5C^^0^B33009592
"BLD",4962,"KRN",9.8,"NM","B","IBCEP0",1)

"BLD",4962,"KRN",9.8,"NM","B","IBCEP5B",2)

"BLD",4962,"KRN",9.8,"NM","B","IBCEP5C",3)

"BLD",4962,"KRN",19,0)
19
"BLD",4962,"KRN",19.1,0)
19.1
"BLD",4962,"KRN",101,0)
101
"BLD",4962,"KRN",409.61,0)
409.61
"BLD",4962,"KRN",771,0)
771
"BLD",4962,"KRN",870,0)
870
"BLD",4962,"KRN",8989.51,0)
8989.51
"BLD",4962,"KRN",8989.52,0)
8989.52
"BLD",4962,"KRN",8994,0)
8994
"BLD",4962,"KRN","B",.4,.4)

"BLD",4962,"KRN","B",.401,.401)

"BLD",4962,"KRN","B",.402,.402)

"BLD",4962,"KRN","B",.403,.403)

"BLD",4962,"KRN","B",.5,.5)

"BLD",4962,"KRN","B",.84,.84)

"BLD",4962,"KRN","B",3.6,3.6)

"BLD",4962,"KRN","B",3.8,3.8)

"BLD",4962,"KRN","B",9.2,9.2)

"BLD",4962,"KRN","B",9.8,9.8)

"BLD",4962,"KRN","B",19,19)

"BLD",4962,"KRN","B",19.1,19.1)

"BLD",4962,"KRN","B",101,101)

"BLD",4962,"KRN","B",409.61,409.61)

"BLD",4962,"KRN","B",771,771)

"BLD",4962,"KRN","B",870,870)

"BLD",4962,"KRN","B",8989.51,8989.51)

"BLD",4962,"KRN","B",8989.52,8989.52)

"BLD",4962,"KRN","B",8994,8994)

"BLD",4962,"QUES",0)
^9.62^^
"BLD",4962,"REQB",0)
^9.611^1^1
"BLD",4962,"REQB",1,0)
IB*2.0*191^1
"BLD",4962,"REQB","B","IB*2.0*191",1)

"INIT")
POST^IB20P239
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
239^3040126
"PKG",200,22,1,"PAH",1,1,0)
^^2^2^3040126
"PKG",200,22,1,"PAH",1,1,1,0)
Care Units are displaying incorrectly on the Insurance Company Provider
"PKG",200,22,1,"PAH",1,1,2,0)
ID Maintenance screen.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","IB20P239")
0^^B26683316
"RTN","IB20P239",1,0)
IB20P239 ;ISP/TDP - Post-Init routine for IB*2.0*239 ;11/14/2003
"RTN","IB20P239",2,0)
 ;;2.0;INTEGRATED BILLING;**239**;21-MAR-94
"RTN","IB20P239",3,0)
 ; This routine is to remove hyphens from the SUBSCRIBER ID (#1) field
"RTN","IB20P239",4,0)
 ; of the INSURANCE TYPE SUB-FIELD (#2.312) file of the PATIENT (#2)
"RTN","IB20P239",5,0)
 ; file.  It also will delete invalid entries from the IB DM EXTRACT
"RTN","IB20P239",6,0)
 ; DATA (#351.71) file.
"RTN","IB20P239",7,0)
 ;
"RTN","IB20P239",8,0)
 Q
"RTN","IB20P239",9,0)
POST ; Start of Post-Init process.
"RTN","IB20P239",10,0)
 N BILL,CU,DA,DATA,DBILL,DCU,DFORM,DID,DIE,DINS,DR,FORM,IB35591,IBACCNT
"RTN","IB20P239",11,0)
 N IBANQCNT,IBCNT,IBNOW,IBPURGE,IBTYPE,ID,IEN,INS,X,X1,X2
"RTN","IB20P239",12,0)
 D BMES^XPDUTL("PROVIDER ID CARE UNIT clean up started in the")
"RTN","IB20P239",13,0)
 D MES^XPDUTL("   IB INSURANCE CO LEVEL BILLING PROV ID (#355.91) file.")
"RTN","IB20P239",14,0)
 ;D BMES^XPDUTL(" ")
"RTN","IB20P239",15,0)
 D BMES^XPDUTL("> Searching for Care Unit values of -1.")
"RTN","IB20P239",16,0)
 ;D BMES^XPDUTL(" ")
"RTN","IB20P239",17,0)
 K ^XTMP("IB20P239",$J)
"RTN","IB20P239",18,0)
 D NOW^%DTC S (IBNOW,X1)=X
"RTN","IB20P239",19,0)
 S X2=30
"RTN","IB20P239",20,0)
 D C^%DTC S IBPURGE=X
"RTN","IB20P239",21,0)
 S ^XTMP("IB20P239",0)=IBPURGE_"^"_IBNOW_"^"_$G(DUZ)
"RTN","IB20P239",22,0)
 S DA="",(IBACCNT,IBANQCNT,IBCNT)=0
"RTN","IB20P239",23,0)
 ;Find and delete the -1 Care Unit values from the records.
"RTN","IB20P239",24,0)
 F  S DA=$O(^IBA(355.91,DA)) Q:DA=""  D
"RTN","IB20P239",25,0)
 . I $P($G(^IBA(355.91,DA,0)),U,3)=-1 D
"RTN","IB20P239",26,0)
 .. S DR=".03///@",DIE="^IBA(355.91,"
"RTN","IB20P239",27,0)
 .. S IB35591=$G(^IBA(355.91,DA,0))
"RTN","IB20P239",28,0)
 .. L +^IBA(355.91,DA) I $T D ^DIE L -^IBA(355.91,DA)
"RTN","IB20P239",29,0)
 .. S ^XTMP("IB20P239",$J,DA,0)=IB35591,IBCNT=IBCNT+1
"RTN","IB20P239",30,0)
 .. D MES^XPDUTL(">> Record "_DA_" has been modified.")
"RTN","IB20P239",31,0)
 ;Now, clean up the "AC" and "AUNIQ" cross-references that may have been
"RTN","IB20P239",32,0)
 ;left with -1 Care Unit values or invalid cross-references.
"RTN","IB20P239",33,0)
 D BMES^XPDUTL("> Searching for invalid ""AUNIQ"" cross-references.")
"RTN","IB20P239",34,0)
 S INS=""
"RTN","IB20P239",35,0)
 F  S INS=$O(^IBA(355.91,"AUNIQ",INS)) Q:INS=""  D
"RTN","IB20P239",36,0)
 . S CU=""
"RTN","IB20P239",37,0)
 . F  S CU=$O(^IBA(355.91,"AUNIQ",INS,CU)) Q:CU=""  D
"RTN","IB20P239",38,0)
 .. S FORM=""
"RTN","IB20P239",39,0)
 .. F  S FORM=$O(^IBA(355.91,"AUNIQ",INS,CU,FORM)) Q:FORM=""  D
"RTN","IB20P239",40,0)
 ... S BILL=""
"RTN","IB20P239",41,0)
 ... F  S BILL=$O(^IBA(355.91,"AUNIQ",INS,CU,FORM,BILL)) Q:BILL=""  D
"RTN","IB20P239",42,0)
 .... S ID=""
"RTN","IB20P239",43,0)
 .... F  S ID=$O(^IBA(355.91,"AUNIQ",INS,CU,FORM,BILL,ID)) Q:ID=""  D
"RTN","IB20P239",44,0)
 ..... S IEN=""
"RTN","IB20P239",45,0)
 ..... F  S IEN=$O(^IBA(355.91,"AUNIQ",INS,CU,FORM,BILL,ID,IEN)) Q:IEN=""  D
"RTN","IB20P239",46,0)
 ...... I CU<0 D AUNIQ Q
"RTN","IB20P239",47,0)
 ...... S DATA=$G(^IBA(355.91,IEN,0))
"RTN","IB20P239",48,0)
 ...... I DATA="" D AUNIQ Q
"RTN","IB20P239",49,0)
 ...... S DINS=$P(DATA,"^",1)
"RTN","IB20P239",50,0)
 ...... S DCU=$P(DATA,"^",10)
"RTN","IB20P239",51,0)
 ...... S DFORM=$P(DATA,"^",4)
"RTN","IB20P239",52,0)
 ...... S DBILL=$P(DATA,"^",5)
"RTN","IB20P239",53,0)
 ...... S DID=$P(DATA,"^",6)
"RTN","IB20P239",54,0)
 ...... I DINS'=INS!(DCU'=CU)!(DFORM'=FORM)!(DBILL'=BILL)!(DID'=ID) D AUNIQ Q
"RTN","IB20P239",55,0)
 D BMES^XPDUTL("> Searching for invalid ""AC"" cross-references.")
"RTN","IB20P239",56,0)
 F  S INS=$O(^IBA(355.91,"AC",INS)) Q:INS=""  D
"RTN","IB20P239",57,0)
 . S ID=""
"RTN","IB20P239",58,0)
 . F  S ID=$O(^IBA(355.91,"AC",INS,ID)) Q:ID=""  D
"RTN","IB20P239",59,0)
 .. S CU=""
"RTN","IB20P239",60,0)
 .. F  S CU=$O(^IBA(355.91,"AC",INS,ID,CU)) Q:CU=""  D
"RTN","IB20P239",61,0)
 ... S IEN=""
"RTN","IB20P239",62,0)
 ... F  S IEN=$O(^IBA(355.91,"AC",INS,ID,CU,IEN)) Q:IEN=""  D
"RTN","IB20P239",63,0)
 .... I CU<0 D AC Q
"RTN","IB20P239",64,0)
 .... S DATA=$G(^IBA(355.91,IEN,0))
"RTN","IB20P239",65,0)
 .... I DATA="" D AC Q
"RTN","IB20P239",66,0)
 .... S DINS=$P(DATA,"^",1)
"RTN","IB20P239",67,0)
 .... S DID=$P(DATA,"^",6)
"RTN","IB20P239",68,0)
 .... S DCU=$P(DATA,"^",10)
"RTN","IB20P239",69,0)
 .... I DINS'=INS!(DID'=ID)!(DCU'=CU) D AC Q
"RTN","IB20P239",70,0)
 D BMES^XPDUTL("> Searches have completed.")
"RTN","IB20P239",71,0)
 I IBACCNT!(IBANQCNT)!(IBCNT) D
"RTN","IB20P239",72,0)
 . D MES^XPDUTL(" ")
"RTN","IB20P239",73,0)
 . D MES^XPDUTL("> "_IBCNT_" total records were modified.")
"RTN","IB20P239",74,0)
 . D MES^XPDUTL("> "_IBACCNT_" total ""AC"" cross-references were modified.")
"RTN","IB20P239",75,0)
 . D MES^XPDUTL("> "_IBANQCNT_" total ""AUNIQ"" cross-references were modified.")
"RTN","IB20P239",76,0)
 I 'IBACCNT,'IBANQCNT,'IBCNT D
"RTN","IB20P239",77,0)
 . D BMES^XPDUTL("> No records needed to be modified.")
"RTN","IB20P239",78,0)
 ;D BMES^XPDUTL(" ")
"RTN","IB20P239",79,0)
 D BMES^XPDUTL("PROVIDER ID CARE UNIT clean up completed.")
"RTN","IB20P239",80,0)
END ; display message that pre-init has completed successfully
"RTN","IB20P239",81,0)
 K BILL,CU,DA,DATA,DBILL,DCU,DFORM,DID,DIE,DINS,DR,FORM,IB35591,IBACCNT
"RTN","IB20P239",82,0)
 K IBANQCNT,IBCNT,IBNOW,IBPURGE,IBTYPE,ID,IEN,INS,X,X1,X2
"RTN","IB20P239",83,0)
 Q
"RTN","IB20P239",84,0)
AC ;Set "AC" cross-reference entry into temporary global then kill the
"RTN","IB20P239",85,0)
 ;"AC" cross-reference.
"RTN","IB20P239",86,0)
 S IBACCNT=IBACCNT+1
"RTN","IB20P239",87,0)
 S ^XTMP("IB20P239",$J,"AC",INS,ID,CU,IEN)=""
"RTN","IB20P239",88,0)
 K ^IBA(355.91,"AC",INS,ID,CU,IEN)
"RTN","IB20P239",89,0)
 Q
"RTN","IB20P239",90,0)
AUNIQ ;Set "AUNIQ" cross-reference entry into temporary global then kill the
"RTN","IB20P239",91,0)
 ;"AUNIQ" cross-reference.
"RTN","IB20P239",92,0)
 S IBANQCNT=IBANQCNT+1
"RTN","IB20P239",93,0)
 S ^XTMP("IB20P239",$J,"AUNIQ",INS,CU,FORM,BILL,ID,IEN)=""
"RTN","IB20P239",94,0)
 K ^IBA(355.91,"AUNIQ",INS,CU,FORM,BILL,ID,IEN)
"RTN","IB20P239",95,0)
 Q
"RTN","IB20P239",96,0)
 ;
"RTN","IB20P239",97,0)
MSG ; Send message
"RTN","IB20P239",98,0)
 N IBC,IBGROUP,IBPARAM,IBTXT,XMDUZ,XMERR,XMSUB,XMTEXT,XMY
"RTN","IB20P239",99,0)
 S XMSUB="PROVIDER ID CARE UNIT CLEAN UP COMPLETE"
"RTN","IB20P239",100,0)
 S XMDUZ=DUZ,XMTEXT="IBTXT"
"RTN","IB20P239",101,0)
 S IBPARAM("FROM")="PATCH IB*2.0*239 POST-INIT"
"RTN","IB20P239",102,0)
 S IBGROUP="IB EDI SUPERVISOR"
"RTN","IB20P239",103,0)
 I '$D(^XMB(3.8,"B",IBGROUP)) S IBGROUP=DUZ ; billing group not defined - send to the user
"RTN","IB20P239",104,0)
 E  S IBGROUP="G."_IBGROUP
"RTN","IB20P239",105,0)
 S XMY(IBGROUP)="",XMY("PHELPS.TY@FORUM.VA.GOV")=""
"RTN","IB20P239",106,0)
 ;
"RTN","IB20P239",107,0)
 S IBC=0
"RTN","IB20P239",108,0)
 S IBC=IBC+1,IBTXT(IBC)="This message has been sent by patch IB*2.0*239 at the completion of"
"RTN","IB20P239",109,0)
 S IBC=IBC+1,IBTXT(IBC)="the post-init routine."
"RTN","IB20P239",110,0)
 S IBC=IBC+1,IBTXT(IBC)="The following entries in file 355.91 have been modified:"
"RTN","IB20P239",111,0)
 S IBC=IBC+1,IBTXT(IBC)="  "
"RTN","IB20P239",112,0)
 S IBCNT=0,DA=""
"RTN","IB20P239",113,0)
 F  S DA=$O(^XTMP("IB20P239",$J,DA)) Q:DA=""  D
"RTN","IB20P239",114,0)
 . S IBC=IBC+1,IBTXT(IBC)="^IBA(355.91,DA)"
"RTN","IB20P239",115,0)
 . S IBCNT=IBCNT+1
"RTN","IB20P239",116,0)
 S IBC=IBC+1,IBTXT(IBC)="  "
"RTN","IB20P239",117,0)
 S IBC=IBC+1,IBTXT(IBC)="Total records modified: "_IBCNT_"."
"RTN","IB20P239",118,0)
 D SENDMSG^XMXAPI(XMDUZ,XMSUB,XMTEXT,.XMY,.IBPARAM,"","")
"RTN","IB20P239",119,0)
 S IBTXT="Provider ID Care Unit clean up message "_$S($D(XMERR):"not sent due to error in message set up.",1:"sent to IB EDI SUPERVISOR mail group and to the patch developer.")
"RTN","IB20P239",120,0)
 D BMES^XPDUTL(IBTXT)
"RTN","IB20P239",121,0)
 Q
"RTN","IBCEP0")
0^1^B58046488
"RTN","IBCEP0",1,0)
IBCEP0 ;ALB/TMP - Functions for PROVIDER ID MAINTENANCE ;13-DEC-99
"RTN","IBCEP0",2,0)
 ;;2.0;INTEGRATED BILLING;**137,191,239**;21-MAR-94
"RTN","IBCEP0",3,0)
 ;
"RTN","IBCEP0",4,0)
EN ; -- main entry point for IBCE PRV INS ID
"RTN","IBCEP0",5,0)
 N IBINS,IBDSP,IBSORT,IBPRV ; Variables should be available throughout actions
"RTN","IBCEP0",6,0)
 D FULL^VALM1
"RTN","IBCEP0",7,0)
 D EN^VALM("IBCE PRVINS ID")
"RTN","IBCEP0",8,0)
 Q
"RTN","IBCEP0",9,0)
 ;
"RTN","IBCEP0",10,0)
EN1(IBINS) ; Entrypoint from insurance co maintenance
"RTN","IBCEP0",11,0)
 N IBDSP,IBSORT ; Variables should be available throughout actions
"RTN","IBCEP0",12,0)
 D FULL^VALM1
"RTN","IBCEP0",13,0)
 D EN^VALM("IBCE PRVINS ID FROM INS MAINT")
"RTN","IBCEP0",14,0)
 Q
"RTN","IBCEP0",15,0)
 ;
"RTN","IBCEP0",16,0)
HDR ; -- header code
"RTN","IBCEP0",17,0)
 N Z,Z0,Z1,IBCT,IBPPTYP,IBEMCTYP
"RTN","IBCEP0",18,0)
 S IBCT=1
"RTN","IBCEP0",19,0)
 K VALMHDR
"RTN","IBCEP0",20,0)
 I $G(IBINS) D
"RTN","IBCEP0",21,0)
 . S VALMHDR(1)="INSURANCE CO: "_$P($G(^DIC(36,+IBINS,0)),U)
"RTN","IBCEP0",22,0)
 . ; Get performing provider id type for insurance co
"RTN","IBCEP0",23,0)
 . S IBPPTYP=$$PPTYP(IBINS)
"RTN","IBCEP0",24,0)
 . ; Get ien of EMC ID from file 355.97
"RTN","IBCEP0",25,0)
 . S IBEMCTYP=+$$EMCID^IBCEP()
"RTN","IBCEP0",26,0)
 . I $G(IBSORT)="ALL"!($G(IBDSP)="I")!($G(IBSORT)=IBPPTYP)!($G(IBSORT)=IBEMCTYP) D
"RTN","IBCEP0",27,0)
 .. ; Look for care unit in either of these id types - if there, report on line 2 of header
"RTN","IBCEP0",28,0)
 .. I $G(IBSORT)=IBPPTYP S IBEMCTYP=0
"RTN","IBCEP0",29,0)
 .. I $G(IBSORT)=IBEMCTYP S IBPPTYP=0
"RTN","IBCEP0",30,0)
 .. F Z0=IBPPTYP_"P",IBEMCTYP_"E" S Z1="" F  S Z1=$O(^IBA(355.96,"D",+IBINS,+Z0,Z1)) Q:Z1=""  I Z1'="*N/A*" S Z($E(Z0,$L(Z0)))=1 Q
"RTN","IBCEP0",31,0)
 .. I $D(Z("P"))!$D(Z("E")) D
"RTN","IBCEP0",32,0)
 ... S IBCT=IBCT+1
"RTN","IBCEP0",33,0)
 ... S VALMHDR(IBCT)="  "_$S($D(Z("P")):"PERFORMING PROV ID"_$S($D(Z("E")):" AND ",1:""),1:"")_$S($D(Z("E")):"EMC PROV ID",1:"")_" MAY REQUIRE CARE UNIT"
"RTN","IBCEP0",34,0)
 . I $D(Z("P"))!$D(Z("E")) S IBCT=IBCT+1,VALMHDR(IBCT)=" "
"RTN","IBCEP0",35,0)
 . S IBCT=IBCT+1,VALMHDR(IBCT)="     PROVIDER "_$S($G(IBDSP)="I":"ID TYPE",1:"NAME   ")_$J("",6)_"FORM   CARE TYPE    CARE UNIT       ID#"
"RTN","IBCEP0",36,0)
 Q
"RTN","IBCEP0",37,0)
 ;
"RTN","IBCEP0",38,0)
INIT ; Initialization
"RTN","IBCEP0",39,0)
 D INSID(.IBINS,.IBDSP,.IBSORT)
"RTN","IBCEP0",40,0)
 I $G(IBDSP)="I",$G(IBSORT) S IBPRV=IBSORT
"RTN","IBCEP0",41,0)
 I '$G(IBINS) S VALMQUIT=1
"RTN","IBCEP0",42,0)
 Q
"RTN","IBCEP0",43,0)
 ;
"RTN","IBCEP0",44,0)
INSID(IBINS,IBDSP,IBSORT) ;
"RTN","IBCEP0",45,0)
 N DIC,DIR,DA,X,Y,IBOK
"RTN","IBCEP0",46,0)
 S IBOK=1
"RTN","IBCEP0",47,0)
 I '$G(IBINS) D
"RTN","IBCEP0",48,0)
 . S DIC(0)="AEMQ",DIC="^DIC(36," D ^DIC
"RTN","IBCEP0",49,0)
 . I Y'>0 S IBOK=0 Q
"RTN","IBCEP0",50,0)
 . S IBINS=+Y
"RTN","IBCEP0",51,0)
 I '$G(IBINS) S IBOK=0
"RTN","IBCEP0",52,0)
 I 'IBOK G INSIDQ
"RTN","IBCEP0",53,0)
 ;
"RTN","IBCEP0",54,0)
 S DIR(0)="SA^D:INSURANCE CO DEFAULT IDS;I:INDIVIDUAL PROVIDER IDS FURNISHED BY THE INS CO;A:ALL IDS FURNISHED BY THE INS CO BY PROVIDER TYPE"
"RTN","IBCEP0",55,0)
 S DIR("A")="SELECT DISPLAY CONTENT: ",DIR("B")="A"
"RTN","IBCEP0",56,0)
 S DIR("?",1)="(D) DISPLAY CONTAINS ONLY THOSE IDS ASSIGNED AS DEFAULTS TO THE FACILITY BY",DIR("?",2)="    THE INSURANCE COMPANY"
"RTN","IBCEP0",57,0)
 S DIR("?",3)="(I) DISPLAY CONTAINS ONLY THOSE IDS ASSIGNED TO INDIVIDUAL PROVIDERS BY THE",DIR("?",4)="    INSURANCE COMPANY"
"RTN","IBCEP0",58,0)
 S DIR("?",5)="(A) DISPLAY CONTAINS ALL IDS ASSIGNED BY THE INSURANCE COMPANY FOR ONE OR ALL",DIR("?")="    PROVIDER ID TYPES"
"RTN","IBCEP0",59,0)
 W ! D ^DIR K DIR W !
"RTN","IBCEP0",60,0)
 I $D(DTOUT)!$D(DUOUT)!("DIA"'[Y) S IBOK=0 G INSIDQ
"RTN","IBCEP0",61,0)
 S IBDSP=Y,IBSORT=""
"RTN","IBCEP0",62,0)
 I IBDSP="A"!(IBDSP="I") F  D  Q:'IBOK!(IBSORT'="")
"RTN","IBCEP0",63,0)
 . N Z
"RTN","IBCEP0",64,0)
 . S Z=$S(IBDSP="I":"",1:" ID TYPE")
"RTN","IBCEP0",65,0)
 . S DIR("A")="DO YOU WANT TO DISPLAY IDS FOR A SPECIFIC PROVIDER"_Z_"?: ",DIR("B")="NO",DIR(0)="YA"
"RTN","IBCEP0",66,0)
 . S DIR("?",1)="IF YOU ANSWER YES TO THIS QUESTION, YOU MAY SELECT A SPECIFIC PROVIDER"_Z,DIR("?")="  TO DISPLAY, OTHERWISE, ALL PROVIDER"_Z_"S FOUND WILL BE DISPLAYED"
"RTN","IBCEP0",67,0)
 . W ! D ^DIR K DIR W !
"RTN","IBCEP0",68,0)
 . I $D(DTOUT)!$D(DUOUT) S IBOK=0 Q
"RTN","IBCEP0",69,0)
 . I Y'=1 S IBSORT="ALL" Q
"RTN","IBCEP0",70,0)
 . ;
"RTN","IBCEP0",71,0)
 . I IBDSP="A" D  Q
"RTN","IBCEP0",72,0)
 .. S DIC(0)="AEMQ",DIC="^IBE(355.97,",DIC("S")="I $S('$P(^(0),U,2):1,1:$P(^(0),U,2)=3)" D ^DIC K DIC
"RTN","IBCEP0",73,0)
 .. I Y>0 S IBSORT=+Y Q
"RTN","IBCEP0",74,0)
 .. I $D(DTOUT)!$D(DUOUT) S IBOK=0
"RTN","IBCEP0",75,0)
 . ;
"RTN","IBCEP0",76,0)
 . I IBDSP="I" D  Q
"RTN","IBCEP0",77,0)
 .. N DA
"RTN","IBCEP0",78,0)
 .. S DIR(0)="399.0222,.02A",DIR("A")="SELECT PROVIDER: "
"RTN","IBCEP0",79,0)
 .. W ! D ^DIR K DIR W !
"RTN","IBCEP0",80,0)
 .. I Y>0 S IBSORT=Y Q
"RTN","IBCEP0",81,0)
 .. I $D(DTOUT)!$D(DUOUT) S IBOK=0 Q
"RTN","IBCEP0",82,0)
 . S IBOK=0 Q
"RTN","IBCEP0",83,0)
 ;
"RTN","IBCEP0",84,0)
 G:'IBOK INSIDQ
"RTN","IBCEP0",85,0)
 D BLD(IBINS,IBDSP,IBSORT)
"RTN","IBCEP0",86,0)
INSIDQ I 'IBOK S VALMQUIT=1
"RTN","IBCEP0",87,0)
 Q
"RTN","IBCEP0",88,0)
 ;
"RTN","IBCEP0",89,0)
BLD(IBINS,IBDSP,IBSORT) ; Build display for Insurance co level provider ID's
"RTN","IBCEP0",90,0)
 N IB,IBENT,IBLCT,IBCT,IBPRV,IBSRT1,IBSRT2,IBOSRT1,IBOSRT2,CU,FT,PT,CT,Z,Z0
"RTN","IBCEP0",91,0)
 K ^TMP("IBPRV_INS_ID",$J),^TMP("IBPRV_INS_SORT",$J)
"RTN","IBCEP0",92,0)
 ;
"RTN","IBCEP0",93,0)
 S (IBENT,IBCT,IBLCT)=0
"RTN","IBCEP0",94,0)
 ;
"RTN","IBCEP0",95,0)
 I "DA"[$G(IBDSP) D
"RTN","IBCEP0",96,0)
 . S CU="" F  S CU=$O(^IBA(355.91,"AUNIQ",IBINS,CU)) Q:CU=""  S FT="" F  S FT=$O(^IBA(355.91,"AUNIQ",IBINS,CU,FT)) Q:FT=""  D
"RTN","IBCEP0",97,0)
 .. S CT="" F  S CT=$O(^IBA(355.91,"AUNIQ",IBINS,CU,FT,CT)) Q:CT=""  S PT=0 F  S PT=$S(IBDSP="A"&IBSORT:IBSORT,1:$O(^IBA(355.91,"AUNIQ",IBINS,CU,FT,CT,PT))) Q:'PT  D  Q:IBDSP="A"&IBSORT
"RTN","IBCEP0",98,0)
 ... S Z=0 F  S Z=$O(^IBA(355.91,"AUNIQ",IBINS,CU,FT,CT,PT,Z)) Q:'Z  S IB=$G(^IBA(355.91,Z,0)) S ^TMP("IBPRV_INS_SORT",$J,PT,"^<<INS CO DEFAULT>>",FT,CT,CU,Z)=$P(IB,U,7)_U
"RTN","IBCEP0",99,0)
 ;
"RTN","IBCEP0",100,0)
 I "IA"[$G(IBDSP) D
"RTN","IBCEP0",101,0)
 . S IBPRV=""
"RTN","IBCEP0",102,0)
 . N IB1,IB2
"RTN","IBCEP0",103,0)
 . F  S IBPRV=$O(^IBA(355.9,"AE",IBINS,IBPRV)) Q:'IBPRV  S Z=0 F  S Z=$O(^IBA(355.9,"AE",IBINS,IBPRV,Z)) Q:'Z  S IB=$G(^IBA(355.9,Z,0)) D
"RTN","IBCEP0",104,0)
 .. Q:$P(IB,U,4)=""!($P(IB,U,5)="")!($P(IB,U,6)="")!($P(IB,U,16)="")
"RTN","IBCEP0",105,0)
 .. I IBSORT,$S(IBDSP="I":IBPRV'=IBSORT,1:$P(IB,U,6)'=IBSORT) Q
"RTN","IBCEP0",106,0)
 .. S IB1=$S(IBDSP="A":$P(IB,U,6),1:U_$$EXPAND^IBTRE(355.9,.01,IBPRV)_U_IBPRV)
"RTN","IBCEP0",107,0)
 .. S IB2=$S(IBDSP="I":$P(IB,U,6),1:U_$$EXPAND^IBTRE(355.9,.01,IBPRV)_U_IBPRV)
"RTN","IBCEP0",108,0)
 .. S ^TMP("IBPRV_INS_SORT",$J,IB1,IB2,$P(IB,U,4),$P(IB,U,5),$P(IB,U,16),Z)=$P(IB,U,7)_U_IBPRV
"RTN","IBCEP0",109,0)
 ;
"RTN","IBCEP0",110,0)
 S IBOSRT1=""
"RTN","IBCEP0",111,0)
 S IBSRT1="" F  S IBSRT1=$O(^TMP("IBPRV_INS_SORT",$J,IBSRT1)) Q:IBSRT1=""  D
"RTN","IBCEP0",112,0)
 . S IBSRT2="",IBOSRT2=""
"RTN","IBCEP0",113,0)
 . F  S IBSRT2=$O(^TMP("IBPRV_INS_SORT",$J,IBSRT1,IBSRT2)) Q:IBSRT2=""  D
"RTN","IBCEP0",114,0)
 .. I IBOSRT1'=IBSRT1 D
"RTN","IBCEP0",115,0)
 ... I IBOSRT1'="" S IBLCT=IBLCT+1 D SET^VALM10(IBLCT," ",IBCT+1)
"RTN","IBCEP0",116,0)
 ... S IBLCT=IBLCT+1 D SET^VALM10(IBLCT,"Provider"_$S(IBDSP'="I":" ID Type",1:"")_": "_$S(IBDSP'="I":$$EXPAND^IBTRE(355.91,.06,IBSRT1),1:$P(IBSRT1,U,2_$S($P(IBSRT2,U,3)["VA(200":" (VA)",1:"(NON-VA)"))),IBCT+1)
"RTN","IBCEP0",117,0)
 ... S IBOSRT1=IBSRT1
"RTN","IBCEP0",118,0)
 .. ;
"RTN","IBCEP0",119,0)
 .. S FT="" F  S FT=$O(^TMP("IBPRV_INS_SORT",$J,IBSRT1,IBSRT2,FT)) Q:FT=""  S CT="" F  S CT=$O(^TMP("IBPRV_INS_SORT",$J,IBSRT1,IBSRT2,FT,CT)) Q:CT=""  D
"RTN","IBCEP0",120,0)
 ... S CU="" F  S CU=$O(^TMP("IBPRV_INS_SORT",$J,IBSRT1,IBSRT2,FT,CT,CU)) Q:CU=""  S Z=0 F  S Z=$O(^TMP("IBPRV_INS_SORT",$J,IBSRT1,IBSRT2,FT,CT,CU,Z)) Q:'Z  S IB=$G(^(Z)) D
"RTN","IBCEP0",121,0)
 .... S IBLCT=IBLCT+1,IBCT=IBCT+1
"RTN","IBCEP0",122,0)
 .... S Z0=$E(IBCT_$J("",4),1,4)_" "
"RTN","IBCEP0",123,0)
 .... I IBDSP'="I" S Z0=Z0_$E($S(IBOSRT2'=IBSRT2:$P(IBSRT2,U,2),1:"")_$J("",20),1,20)
"RTN","IBCEP0",124,0)
 .... I IBDSP="I" S Z0=Z0_$E($S(IBOSRT2'=IBSRT2:$$EXPAND^IBTRE(355.9,.06,IBSRT2),1:"")_$J("",20),1,20)
"RTN","IBCEP0",125,0)
 .... S IBOSRT2=IBSRT2
"RTN","IBCEP0",126,0)
 .... S Z0=Z0_"  "_$S(FT=1:"UB-92",FT=2:"HCFA ",1:"BOTH ")_"  "_$E($S(CT=4:"RX",CT=1:"INPT",CT=2:"OUTPT",1:"INPT/OUTPT")_$J("",11),1,11)_"  "_$E($S(CU'="*N/A*":$P($G(^IBA(355.95,+$P($G(^IBA(355.96,+CU,0)),U),0)),U),1:"")_$J("",15),1,15)
"RTN","IBCEP0",127,0)
 .... D SET^VALM10(IBLCT,Z0_" "_$P(IB,U),IBCT)
"RTN","IBCEP0",128,0)
 .... S ^TMP("IBPRV_INS_ID",$J,"ZIDX",IBCT)=Z,^(IBCT,"PRV")=$P(IB,U,2)
"RTN","IBCEP0",129,0)
 .... I '$D(^TMP("IBPRV_INS_ID",$J,$S(IBDSP="I":"ZXPRV",1:"ZXPTYP"),IBSRT1)) S ^(IBSRT1)=IBLCT-1
"RTN","IBCEP0",130,0)
 K ^TMP("IBPRV_INS_SORT",$J)
"RTN","IBCEP0",131,0)
 ;
"RTN","IBCEP0",132,0)
 I IBLCT=0 D  G BLDQ ; No entries found
"RTN","IBCEP0",133,0)
 . D SET^VALM10(1," ")
"RTN","IBCEP0",134,0)
 . S Z="  No "_$S(IBDSP="D":"default ",1:"")
"RTN","IBCEP0",135,0)
 . S Z=Z_"ID's found for "_$S(IBDSP="I":"provider "_$S(IBSORT:"("_$$EXPAND^IBTRE(355.9,.01,IBSORT)_") ",1:"")_"and ",IBDSP="A":"provider type "_$S(IBSORT:"("_$$EXPAND^IBTRE(355.9,.06,IBSORT)_") ",1:"")_"and ",1:"")_"insurance co"
"RTN","IBCEP0",136,0)
 . D SET^VALM10(2,Z)
"RTN","IBCEP0",137,0)
 . S IBLCT=2
"RTN","IBCEP0",138,0)
 ;
"RTN","IBCEP0",139,0)
BLDQ S VALMCNT=IBLCT,VALMBG=1
"RTN","IBCEP0",140,0)
 Q
"RTN","IBCEP0",141,0)
 ;
"RTN","IBCEP0",142,0)
EXPND ;
"RTN","IBCEP0",143,0)
 Q
"RTN","IBCEP0",144,0)
 ;
"RTN","IBCEP0",145,0)
HELP ;
"RTN","IBCEP0",146,0)
 Q
"RTN","IBCEP0",147,0)
 ;
"RTN","IBCEP0",148,0)
EXIT ;
"RTN","IBCEP0",149,0)
 K ^TMP("IBPRV_INS_ID",$J)
"RTN","IBCEP0",150,0)
 D CLEAN^VALM10
"RTN","IBCEP0",151,0)
 Q
"RTN","IBCEP0",152,0)
 ;
"RTN","IBCEP0",153,0)
SEL(IBDA,MANY) ; Select from provider id list
"RTN","IBCEP0",154,0)
 ; IBDA is passed by reference and IBDA(1) returned containing
"RTN","IBCEP0",155,0)
 ;  ien's of the provider id records selected (file 355.9).
"RTN","IBCEP0",156,0)
 ; If > 1 entry can be selected, MANY is set to 1
"RTN","IBCEP0",157,0)
 N Z
"RTN","IBCEP0",158,0)
 S IBDA=0
"RTN","IBCEP0",159,0)
 D EN^VALM2($G(XQORNOD(0)),$S($G(MANY):"",1:"S"))
"RTN","IBCEP0",160,0)
 S Z=0 F  S Z=$O(VALMY(Z)) Q:'Z  S IBDA=IBDA+1,IBDA(IBDA)=+$G(^TMP("IBPRV_INS_ID",$J,"ZIDX",Z))_U_$G(^(Z,"PRV"))
"RTN","IBCEP0",161,0)
 Q
"RTN","IBCEP0",162,0)
 ;
"RTN","IBCEP0",163,0)
ENX(IBINS1) ; Insurance co level defaults for all providers or
"RTN","IBCEP0",164,0)
 ; for all providers by care unit
"RTN","IBCEP0",165,0)
 N DIC,DA,X,Y,DLAYGO
"RTN","IBCEP0",166,0)
 I '$G(IBINS1) D  G:'$G(IBINS1) ENQ
"RTN","IBCEP0",167,0)
 . S DIC="^IBA(355.91,",DIC(0)="AELMQ",DLAYGO=355.91 D ^DIC
"RTN","IBCEP0",168,0)
 . I Y>0 S IBINS1=+Y
"RTN","IBCEP0",169,0)
 S DIE="^IBA(355.91,",DA=IBINS1,DR=".01;.06;.04;.05;.03;.07" D ^DIE
"RTN","IBCEP0",170,0)
 ;
"RTN","IBCEP0",171,0)
ENQ Q
"RTN","IBCEP0",172,0)
 ;
"RTN","IBCEP0",173,0)
PPTYP(IBINS) ; Returns the ien of the default performing provider type for 
"RTN","IBCEP0",174,0)
 ;  insurance company IBINS (ien file 36)
"RTN","IBCEP0",175,0)
 Q +$G(^DIC(36,+IBINS,4))
"RTN","IBCEP0",176,0)
 ;
"RTN","IBCEP5B")
0^2^B75933281
"RTN","IBCEP5B",1,0)
IBCEP5B ;ALB/TMP - EDI UTILITIES for provider ID ;29-SEP-00
"RTN","IBCEP5B",2,0)
 ;;2.0;INTEGRATED BILLING;**137,239**;21-MAR-94
"RTN","IBCEP5B",3,0)
 ;
"RTN","IBCEP5B",4,0)
NEWID(IBFILE,IBINS,IBPRV,IBPTYP,IBIEN,IBF) ; Generic add of provider id
"RTN","IBCEP5B",5,0)
 ; at both prov (file 355.9) and ins co levels (file 355.91)
"RTN","IBCEP5B",6,0)
 ; IBFILE = 355.9 or 355.91 for the file being edited
"RTN","IBCEP5B",7,0)
 ; IBINS = ien of ins co (file 36) or *ALL* for all ins co
"RTN","IBCEP5B",8,0)
 ; IBPRV = vp ien of billing prov.
"RTN","IBCEP5B",9,0)
 ; IBPTYP = ien of billing prov type (file 355.96)
"RTN","IBCEP5B",10,0)
 ; IBIEN = ien of entry being added (required)
"RTN","IBCEP5B",11,0)
 ; IBF = 1 if deleting from ins co-related options, ""
"RTN","IBCEP5B",12,0)
 ;       from provider-related options
"RTN","IBCEP5B",13,0)
 N DIC,DIR,X,Y,Z,DA,DR,DIE,DO,DD,DLAYGO,IBQ,IBCUND,IB3559,IB35591,Q
"RTN","IBCEP5B",14,0)
 S IB35591(.03)=""
"RTN","IBCEP5B",15,0)
 F Z=.04,.05,.03 D  G:Z="" NEWQ
"RTN","IBCEP5B",16,0)
 . I $S(Z'=.03:1,1:$S('$G(IBINS):0,1:$G(IBCUND))) D  Q:Z=""
"RTN","IBCEP5B",17,0)
 .. N DA
"RTN","IBCEP5B",18,0)
 .. I Z'=.03 S DIR(0)=IBFILE_","_Z
"RTN","IBCEP5B",19,0)
 .. I Z=.03 D  ;,IBFILE'=355.9 D
"RTN","IBCEP5B",20,0)
 ... S DIR(0)="PA^355.95:AEMQ"
"RTN","IBCEP5B",21,0)
 ... S DIR("S")="I $O(^IBA(355.96,""AUNIQ"","_IBINS_",Y,"_$G(IB3559(.04))_","_$G(IB3559(.05))_","_$G(IBPTYP)_",0))!($O(^IBA(355.96,""AUNIQ"","_IBINS_",Y,"_$G(IB3559(.04))_",0,"_$G(IBPTYP)_",0)))"
"RTN","IBCEP5B",22,0)
 ... S DIR("S")=DIR("S")_"!($O(^IBA(355.96,""AUNIQ"","_IBINS_",Y,0,"_$G(IB3559(.05))_","_$G(IBPTYP)_",0)))!($O(^IBA(355.96,""AUNIQ"","_IBINS_",Y,0,0,"_$G(IBPTYP)_",0)))"
"RTN","IBCEP5B",23,0)
 ... S DIR("?",1)="Care unit describes areas of service and is assigned by the payer, if",DIR("?",2)="  applicable.  Use the Care Unit Maintenance option to add or modify care",DIR("?")="  units and descriptions"
"RTN","IBCEP5B",24,0)
 .. S DA=0
"RTN","IBCEP5B",25,0)
 .. D ^DIR K DIR
"RTN","IBCEP5B",26,0)
 .. I $D(DTOUT)!$D(DUOUT) S Z="" K IB3559,IB35591 Q
"RTN","IBCEP5B",27,0)
 .. S IB3559(Z)=$P(Y,U)
"RTN","IBCEP5B",28,0)
 . I Z=.05 D
"RTN","IBCEP5B",29,0)
 .. S IBCUND=$$CAREUN^IBCEP3(IBINS,IBPTYP,IB3559(.04),IB3559(.05),IB3559(.05)=3)
"RTN","IBCEP5B",30,0)
 .. S:'IBCUND IB3559(.03)="*N/A*"
"RTN","IBCEP5B",31,0)
 .. I '$G(IBINS) S IBINS="*ALL*"
"RTN","IBCEP5B",32,0)
 . I Z=.03 D CAREUN^IBCEP5C
"RTN","IBCEP5B",33,0)
 ;
"RTN","IBCEP5B",34,0)
 I $D(IB3559) D
"RTN","IBCEP5B",35,0)
 . N Q,Z2,Z3,Z4,Z5,Z6,IBLAST,IBOK,DIR,Y,X
"RTN","IBCEP5B",36,0)
 . S IBLAST=0
"RTN","IBCEP5B",37,0)
 . D DISP^IBCEP4("Q",IBINS,IBPTYP,IB3559(.04),IB3559(.05),1)
"RTN","IBCEP5B",38,0)
 . W !!,"THE FOLLOWING COMBINATION WAS CHOSEN:"
"RTN","IBCEP5B",39,0)
 . S Q=0 F  S Q=$O(Q(Q)) Q:'Q  W !,?3,Q(Q)
"RTN","IBCEP5B",40,0)
 . I IBCUND W !,?3,"CARE UNIT: "_$$EXPAND^IBTRE(355.96,.01,IB3559(.03))
"RTN","IBCEP5B",41,0)
 . S Z2=IBINS,Z3=IB35591(.03),Z4=IB3559(.04),Z5=IB3559(.05),Z6=IBPTYP
"RTN","IBCEP5B",42,0)
 . S IBOK=1
"RTN","IBCEP5B",43,0)
 . ; If both form types, check for specific
"RTN","IBCEP5B",44,0)
 . I 'Z4 S IBOK=$$COMBOK^IBCEP5C(IBFILE,IBPRV_U_4_U_Z2_U_Z3_U_Z4_U_Z5_U_Z6,1,$G(IBFILE)=355.91)
"RTN","IBCEP5B",45,0)
 . ; If specific form type, check for 'all'
"RTN","IBCEP5B",46,0)
 . I IBOK,Z4 S IBOK=$$COMBOK^IBCEP5C(IBFILE,IBPRV_U_4_U_Z2_U_Z3_U_Z4_U_Z5_U_Z6,0,$G(IBFILE)=355.91)
"RTN","IBCEP5B",47,0)
 . ; If both care types, check for specific
"RTN","IBCEP5B",48,0)
 . I IBOK,'Z5 S IBOK=$$COMBOK^IBCEP5C(IBFILE,IBPRV_U_5_U_Z2_U_Z3_U_Z4_U_Z5_U_Z6,1,$G(IBFILE)=355.91)
"RTN","IBCEP5B",49,0)
 . ; If specific care type, check for 'all'
"RTN","IBCEP5B",50,0)
 . I IBOK,Z5 S IBOK=$$COMBOK^IBCEP5C(IBFILE,IBPRV_U_5_U_Z2_U_Z3_U_Z4_U_Z5_U_Z6,0,$G(IBFILE)=355.91)
"RTN","IBCEP5B",51,0)
 . I 'IBOK K IB3559,IB35591
"RTN","IBCEP5B",52,0)
 . I IBOK D
"RTN","IBCEP5B",53,0)
 .. S DIR(0)=IBFILE_",.07"
"RTN","IBCEP5B",54,0)
 .. W ! D ^DIR K DIR
"RTN","IBCEP5B",55,0)
 .. S IBID=Y
"RTN","IBCEP5B",56,0)
 .. I $D(DTOUT)!$D(DUOUT) K IB3559,IB35591 S IBOK=0 Q
"RTN","IBCEP5B",57,0)
 .. S IBDR=$S(IBFILE=355.9:$S($G(IBINS):".02////"_IBINS_";",1:""),1:"")_$S($G(IBCUND):".03////"_IB35591(.03)_";",1:"")_".04////"_IB3559(.04)_";.05////"_IB3559(.05)_";.06////"_IBPTYP_$S(IBID'="":";.07////"_IBID,1:"")
"RTN","IBCEP5B",58,0)
 .. ;
"RTN","IBCEP5B",59,0)
 .. I $G(IBIEN) D
"RTN","IBCEP5B",60,0)
 ... S DR=IBDR,DA=IBIEN,DIE="^IBA("_IBFILE_","
"RTN","IBCEP5B",61,0)
 ... D ^DIE
"RTN","IBCEP5B",62,0)
 ... I $D(Y) K IB3559,IB35591 S IBOK=0
"RTN","IBCEP5B",63,0)
 ;
"RTN","IBCEP5B",64,0)
NEWQ I '$D(IB3559),$G(IBIEN) D
"RTN","IBCEP5B",65,0)
 . S DA=IBIEN,DIK="^IBA("_IBFILE_"," D ^DIK
"RTN","IBCEP5B",66,0)
 . S DIR(0)="EA",DIR("A",1)=$S('$G(IBOK):"",1:"PROBLEM ENCOUNTERED FILING THE RECORD - ")_"RECORD NOT ADDED",DIR("A")="PRESS the ENTER key to continue " W ! D ^DIR K DIR
"RTN","IBCEP5B",67,0)
 Q
"RTN","IBCEP5B",68,0)
 ;
"RTN","IBCEP5B",69,0)
CHG(IBFILE,IBDA) ; Generic call to edit prov id's
"RTN","IBCEP5B",70,0)
 ; IBFILE = 355.9 or 355.91 for the file being edited
"RTN","IBCEP5B",71,0)
 ; IBDA = ien of entry in file IBFILE
"RTN","IBCEP5B",72,0)
 ;
"RTN","IBCEP5B",73,0)
 N DIR,DIE,DA,DR,IBCUCHK,IBOK,IB0,IBOLD,X,Y,Z
"RTN","IBCEP5B",74,0)
 F Z=1:1:3 L +^IBA(IBFILE,IBDA):5 Q:$T  W !,"Attempting to lock record"
"RTN","IBCEP5B",75,0)
 I '$T D  G CHGQ
"RTN","IBCEP5B",76,0)
 . W !,"RECORD IS LOCKED BY ANOTHER USER - TRY AGAIN LATER"
"RTN","IBCEP5B",77,0)
 . S DIR(0)="EA",DIR("A")="PRESS THE ENTER KEY TO CONTINUE"
"RTN","IBCEP5B",78,0)
 . W ! D ^DIR K DIR W !
"RTN","IBCEP5B",79,0)
 S (IB0,IBOLD)=$G(^IBA(IBFILE,IBDA,0))
"RTN","IBCEP5B",80,0)
 G:IB0="" CHGQ
"RTN","IBCEP5B",81,0)
 F Z=.04,.05,.06,.03 S IBOK=$$EDIT(IBFILE,Z,IB0,IBOLD,IBDA,0) S:IBOK="*ALL*" IBOK="" Q:$P(IBOK,U,2)  S $P(IB0,U,Z*100)=$P(IBOK,U)
"RTN","IBCEP5B",82,0)
 I $P(IBOK,U,2)!(IB0=IBOLD) S DIR(0)="EA",DIR("A")="NO CHANGES MADE, PRESS ENTER TO CONTINUE: " W ! D ^DIR K DIR W ! G CHGQ
"RTN","IBCEP5B",83,0)
 S IBOK=$$EDIT(IBFILE,.07,IB0,IBOLD,IBDA,1)
"RTN","IBCEP5B",84,0)
 I '$P(IBOK,U,2) S $P(IB0,U,7)=$P(IBOK,U)
"RTN","IBCEP5B",85,0)
 S IBCUCHK=0 D CUCHK^IBCEP5C G:IBCUCHK CHGQ
"RTN","IBCEP5B",86,0)
 S DR=""
"RTN","IBCEP5B",87,0)
 F Z=2,4:1:7,3 I $P(IB0,U,Z)'=$P(IBOLD,U,Z) S DR=DR_$S(DR'="":";",1:"")_(Z/100)_"///"_$S($P(IB0,U,Z)'="@":"/",1:"")_$P(IB0,U,Z)
"RTN","IBCEP5B",88,0)
 I DR'="" S DIE="^IBA("_IBFILE_",",DA=IBDA D ^DIE
"RTN","IBCEP5B",89,0)
CHGQ L -^IBA(IBFILE,IBDA)
"RTN","IBCEP5B",90,0)
 Q
"RTN","IBCEP5B",91,0)
 ;
"RTN","IBCEP5B",92,0)
DEL(IBFILE,IBDA,IBF) ; Delete prov specific ID's
"RTN","IBCEP5B",93,0)
 ; IBFILE = 355.9 or 355.91 for the file being edited
"RTN","IBCEP5B",94,0)
 ; IBDA = ien of entry in file IBFILE
"RTN","IBCEP5B",95,0)
 ; IBF = 1 if deleting from ins co-related options, ""
"RTN","IBCEP5B",96,0)
 ;       from provider-related options
"RTN","IBCEP5B",97,0)
 N IB0,IBLAST,IBX,DIK,DA,DIR,X,Y,Z
"RTN","IBCEP5B",98,0)
 F Z=1:1:3 L +^IBA(IBFILE,IBDA):5 Q:$T
"RTN","IBCEP5B",99,0)
 I '$T D  G DELQ
"RTN","IBCEP5B",100,0)
 . W !,"RECORD IS LOCKED BY ANOTHER USER - PLEASE TRY AGAIN LATER"
"RTN","IBCEP5B",101,0)
 . S DIR(0)="EA",DIR("A")="PRESS THE ENTER KEY TO CONTINUE"
"RTN","IBCEP5B",102,0)
 . W ! D ^DIR K DIR W !
"RTN","IBCEP5B",103,0)
 S IB0=$G(^IBA(IBFILE,IBDA,0))
"RTN","IBCEP5B",104,0)
 S IBX=0
"RTN","IBCEP5B",105,0)
 S IBX=IBX+1,DIR("A",IBX)=" PROVIDER: "_$S(IBFILE=355.9:$$EXPAND^IBTRE(355.9,.01,$P(IB0,U)),1:"*ALL*")
"RTN","IBCEP5B",106,0)
 D DISP^IBCEP4("DIR(""A"")",$P(IB0,U,$S(IBFILE=355.9:2,1:1)),$P(IB0,U,6),$P(IB0,U,4),$P(IB0,U,5),IBX+1,.IBLAST)
"RTN","IBCEP5B",107,0)
 I $P(IB0,U,3)'="" S DIR("A",IBLAST+1)="CARE UNIT: "_$$EXPAND^IBTRE(355.91,.03,$P(IB0,U,3))
"RTN","IBCEP5B",108,0)
 S DIR("A",IBLAST+2)="  PROV ID: "_$P(IB0,U,7),DIR("A",IBLAST+3)=" "
"RTN","IBCEP5B",109,0)
 S DIR("A")="OK TO DELETE THIS "_$S($G(IBF):"INSURANCE COMPANY ",1:"")_"PROVIDER ID RECORD?: ",DIR("B")="NO"
"RTN","IBCEP5B",110,0)
 S DIR(0)="YA"
"RTN","IBCEP5B",111,0)
 W ! D ^DIR K DIR W !
"RTN","IBCEP5B",112,0)
 I Y'=1 G DELQ
"RTN","IBCEP5B",113,0)
 I IBDA>0 S DA=IBDA,DIK="^IBA("_IBFILE_"," D ^DIK
"RTN","IBCEP5B",114,0)
DELQ L -^IBA(IBFILE,IBDA)
"RTN","IBCEP5B",115,0)
 Q
"RTN","IBCEP5B",116,0)
 ;
"RTN","IBCEP5B",117,0)
EDIT(IBFILE,IBFLD,IB0,IBOLD,IBIEN,IBCK1) ; Generic edit entry's fields
"RTN","IBCEP5B",118,0)
 N DIR,Y,X,IB,IB1,IBCUVAL,IBCUY,IBFLD0,IBNEW,IBPRV,IBVAL,IBIVAL,IBINS
"RTN","IBCEP5B",119,0)
 I IBFILE=355.91,IBFLD=.02 S IBNEW="" G EDITQ ; No fld .02 in file 355.91
"RTN","IBCEP5B",120,0)
 S IBCUCHK=1,IBCUVAL=""
"RTN","IBCEP5B",121,0)
 S IBFLD0=IBFLD*100,IBPRV=$S(IBFILE=355.9:$P(IB0,U),1:""),IBNEW=""
"RTN","IBCEP5B",122,0)
 S IBINS=$P(IB0,U,$S(IBFILE=355.9:2,1:1))
"RTN","IBCEP5B",123,0)
 I IBFLD'=.03 S IBVAL=$$EXPAND^IBTRE(IBFILE,IBFLD,$P(IB0,U,IBFLD0)),IBIVAL=$P(IB0,U,IBFLD0)
"RTN","IBCEP5B",124,0)
 I IBFLD=.03 G:$S('IBINS:1,1:'$$CAREUN^IBCEP3(IBINS,$P(IB0,U,6),$P(IB0,U,4),$P(IB0,U,5),$P(IB0,U,5)=3)) EDITCUQ  S IBVAL=$P($G(^IBA(355.95,+$G(^IBA(355.96,+$P(IB0,U,3),0)),0)),U),IBIVAL=$P(IB0,U,3) D
"RTN","IBCEP5B",125,0)
 . S IBCUCHK=0,IBCUVAL=$P($G(^IBA(355.96,+IBIVAL,0)),U,1) I IBCUVAL="" Q
"RTN","IBCEP5B",126,0)
 . I $O(^IBA(355.96,"AUNIQ",IBINS,IBCUVAL,$P(IB0,U,4),$P(IB0,U,5),$P(IB0,U,6),"")) S IBCUCHK=1 Q
"RTN","IBCEP5B",127,0)
 . I $O(^IBA(355.96,"AUNIQ",IBINS,IBCUVAL,$P(IB0,U,4),0,$P(IB0,U,6),"")) S IBCUCHK=1 Q
"RTN","IBCEP5B",128,0)
 . I $O(^IBA(355.96,"AUNIQ",IBINS,IBCUVAL,0,$P(IB0,U,5),$P(IB0,U,6),"")) S IBCUCHK=1 Q
"RTN","IBCEP5B",129,0)
 . I $O(^IBA(355.96,"AUNIQ",IBINS,IBCUVAL,0,0,$P(IB0,U,6),"")) S IBCUCHK=1 Q
"RTN","IBCEP5B",130,0)
 . S IBIVAL="@"
"RTN","IBCEP5B",131,0)
 I IBFLD'=.02 D
"RTN","IBCEP5B",132,0)
 . N DA
"RTN","IBCEP5B",133,0)
 . S DIR(0)=$S(IBFLD'=.03:IBFILE_","_IBFLD_"AO",1:"PAO^355.95:AEMQ")
"RTN","IBCEP5B",134,0)
 . I IBFLD=.03 D  Q:$P(IB0,U,4)=""!($P(IB0,U,5)="")!($P(IB0,U,6)="")
"RTN","IBCEP5B",135,0)
 .. S DIR("A")="CARE UNIT: "
"RTN","IBCEP5B",136,0)
 .. S DIR("S")="I $D(^IBA(355.96,""AUNIQ"",IBINS,Y,$P(IB0,U,4),$P(IB0,U,5),$P(IB0,U,6)))!($D(^IBA(355.96,""AUNIQ"",IBINS,Y,$P(IB0,U,4),0,$P(IB0,U,6))))"
"RTN","IBCEP5B",137,0)
 .. S DIR("S")=DIR("S")_"!($D(^IBA(355.96,""AUNIQ"",IBINS,Y,0,$P(IB0,U,5),$P(IB0,U,6))))!($D(^IBA(355.96,""AUNIQ"",IBINS,Y,0,0,$P(IB0,U,6))))"
"RTN","IBCEP5B",138,0)
 . I IBFLD'=.03 S DIR("A")=$$GET1^DID(IBFILE,IBFLD,,"LABEL")_": "
"RTN","IBCEP5B",139,0)
 . S:IBVAL'=""&(IBCUCHK) DIR("A")=DIR("A")_IBVAL_"// "
"RTN","IBCEP5B",140,0)
 . S DA=0
"RTN","IBCEP5B",141,0)
 . D ^DIR K DIR
"RTN","IBCEP5B",142,0)
 . I IBFLD=.03,'$D(DTOUT),'$D(DUOUT),X'="" D  S Y=IBCUY
"RTN","IBCEP5B",143,0)
 .. S IBCUY=+$O(^IBA(355.96,"AUNIQ",IBINS,+Y,$P(IB0,U,4),$P(IB0,U,5),$P(IB0,U,6),0)) I 'IBCUY D
"RTN","IBCEP5B",144,0)
 ... S IBCUY=+$O(^IBA(355.96,"AUNIQ",IBINS,+Y,$P(IB0,U,4),0,$P(IB0,U,6),0)) I 'IBCUY D
"RTN","IBCEP5B",145,0)
 .... S IBCUY=+$O(^IBA(355.96,"AUNIQ",IBINS,+Y,0,$P(IB0,U,5),$P(IB0,U,6),0)) I 'IBCUY D
"RTN","IBCEP5B",146,0)
 ..... S IBCUY=+$O(^IBA(355.96,"AUNIQ",IBINS,+Y,0,0,$P(IB0,U,6),0))
"RTN","IBCEP5B",147,0)
 . I IBIVAL'="",IBCUCHK,($P(Y,U)=IBIVAL!(X="")) S IBNEW=IBIVAL Q
"RTN","IBCEP5B",148,0)
 . I 'IBCUCHK,X="" S IBNEW=IBIVAL Q
"RTN","IBCEP5B",149,0)
 . I X'="@",($S(X="":IBIVAL'="",1:0)!$D(DTOUT)!$D(DUOUT)) S IBNEW="^1" Q
"RTN","IBCEP5B",150,0)
 . S IBNEW=$S(X'="@":$P(Y,U),1:X)
"RTN","IBCEP5B",151,0)
 . I IBFLD=.03,X="" S IBNEW="" ; No care unit selected
"RTN","IBCEP5B",152,0)
 I IBFLD=.02 D  ; Only file 355.9
"RTN","IBCEP5B",153,0)
 . N DIR,X,Y,DIC,DA,IBIT
"RTN","IBCEP5B",154,0)
 . S IBIT=$$GET1^DID(355.9,.02,,"INPUT TRANSFORM")
"RTN","IBCEP5B",155,0)
 . S DIR(0)="FAO^1:30"
"RTN","IBCEP5B",156,0)
 . S DIR("A")="INSURANCE CO: "_$S(IBVAL'="":IBVAL_"// ",1:" "),DIR("?")="^N IBHELP,Z D HELP^DIE(355.9,,.02,""A"",""IBHELP"") S Z=0 F  S Z=$O(IBHELP(""DIHELP"",Z)) Q:'Z  W !,IBHELP(""DIHELP"",Z)"
"RTN","IBCEP5B",157,0)
 . F  W ! D ^DIR D  I IBNEW'="" K DIR Q
"RTN","IBCEP5B",158,0)
 .. I $D(DTOUT)!$D(DUOUT) S IBNEW="^1" Q
"RTN","IBCEP5B",159,0)
 .. I IBIVAL'="",($P(Y,U)=IBIVAL!(X="")) S IBNEW=IBIVAL Q
"RTN","IBCEP5B",160,0)
 .. I X="@" S IBNEW="@" Q
"RTN","IBCEP5B",161,0)
 .. I X="",IBIVAL="" S IBNEW="*ALL*" Q
"RTN","IBCEP5B",162,0)
 .. S DIC="^DIC(36,",DIC(0)="EMQ",DIC("S")="X IBIT I $D(X)" D ^DIC
"RTN","IBCEP5B",163,0)
 .. I Y>0 S IBNEW=$P(Y,U) Q
"RTN","IBCEP5B",164,0)
 .. S Y="",IBNEW="^1"
"RTN","IBCEP5B",165,0)
 G:IBNEW="^1"!(IBNEW=IBIVAL)!(IBFLD=.07) EDITQ
"RTN","IBCEP5B",166,0)
 I $G(IBCK1) D
"RTN","IBCEP5B",167,0)
 . N X1,X2,X3,X4,X5,X6
"RTN","IBCEP5B",168,0)
 . S X1=$S(IBFILE=355.9:$S(IBFLD'=.01:IBPRV,1:IBNEW),1:"")
"RTN","IBCEP5B",169,0)
 . S X2=$S(IBFILE=355.9:$S(IBFLD'=.02:$P(IB0,U,2),1:IBNEW),1:$S(IBFLD'=.01:$P(IB0,U),1:IBNEW))
"RTN","IBCEP5B",170,0)
 . S X3=$S(IBFLD'=.03:$P(IB0,U,3),1:IBNEW),X4=$S(IBFLD'=.04:$P(IB0,U,4),1:IBNEW),X5=$S(IBFLD'=.05:$P(IB0,U,5),1:IBNEW),X6=$S(IBFLD'=.06:$P(IB0,U,6),1:IBNEW)
"RTN","IBCEP5B",171,0)
 . I X2="" S X2="*ALL*"
"RTN","IBCEP5B",172,0)
 . I X3="" S X3="*N/A*"
"RTN","IBCEP5B",173,0)
 . I IBFILE=355.9,$S(X4=""!(X5="")!(X6=""):1,$O(^IBA(355.9,"AUNIQ",X1,X2,X3,X4,X5,X6,0)):$O(^(0))'=IBIEN,1:0) S IBNEW=IBNEW_"^2" Q
"RTN","IBCEP5B",174,0)
 . I IBFILE=355.91,$S(X4=""!(X5="")!(X6=""):1,$O(^IBA(355.91,"AUNIQ",X2,X3,X4,X5,X6,0)):$O(^(0))'=IBIEN,1:0) S IBNEW=IBNEW_"^2" Q
"RTN","IBCEP5B",175,0)
 . F IB=2,3 D  Q:$P(IBNEW,U,3)=3
"RTN","IBCEP5B",176,0)
 .. S IB1=(X2="*ALL*"!(X3="*N/A*"))
"RTN","IBCEP5B",177,0)
 .. I IBFILE=355.9,IB=2,$S($P(IBOLD,U,2)="":X2'="*ALL*",1:$P(IBOLD,U,2)'=X2) S X2=""
"RTN","IBCEP5B",178,0)
 .. I IB=3,$S($P(IBOLD,U,3)="":X3'="*N/A*",1:$P(IBOLD,U,3)'=X3) S X3=""
"RTN","IBCEP5B",179,0)
 .. I '$$COMBOK^IBCEP5C(IBFILE,IBPRV_U_(IBFLD*100)_U_X2_U_X3_U_X4_U_X5_U_X6,IB1) S IBNEW="^3"
"RTN","IBCEP5B",180,0)
 ;
"RTN","IBCEP5B",181,0)
EDITQ Q IBNEW
"RTN","IBCEP5B",182,0)
EDITCUQ ;
"RTN","IBCEP5B",183,0)
 I $P(IB0,U,3) S IBNEW="@"
"RTN","IBCEP5B",184,0)
 Q IBNEW
"RTN","IBCEP5B",185,0)
 ;
"RTN","IBCEP5C")
0^3^B33009592
"RTN","IBCEP5C",1,0)
IBCEP5C ;ALB/TMP - EDI UTILITIES for provider ID ;02-NOV-00
"RTN","IBCEP5C",2,0)
 ;;2.0;INTEGRATED BILLING;**137,239**;21-MAR-94
"RTN","IBCEP5C",3,0)
 ;
"RTN","IBCEP5C",4,0)
COMBOK(IBFILE,IBDAT,IBALL,IBF) ; Generic ask if conflict, should id rec still
"RTN","IBCEP5C",5,0)
 ;  be added?
"RTN","IBCEP5C",6,0)
 ; IBFILE = 355.9 or 355.91 for the file being edited
"RTN","IBCEP5C",7,0)
 ; IBDAT = var ptr prov ien (355.9) ^ pc to check ^
"RTN","IBCEP5C",8,0)
 ;           ins co ien or *ALL* ^ care unit or *N/A* ^
"RTN","IBCEP5C",9,0)
 ;           form type code ^ care type code ^ prov id type ptr
"RTN","IBCEP5C",10,0)
 ; IBALL = flag:
"RTN","IBCEP5C",11,0)
 ;   0 = Individual entry selected - check for existing ALL entry
"RTN","IBCEP5C",12,0)
 ;   1 = 'ALL' selected - check for existing individual ones
"RTN","IBCEP5C",13,0)
 ; IBF = 1 if deleting from ins co-related options, ""
"RTN","IBCEP5C",14,0)
 ;       from provider-related options
"RTN","IBCEP5C",15,0)
 ; Returns 1 if ok to continue, 0 if not
"RTN","IBCEP5C",16,0)
 ;
"RTN","IBCEP5C",17,0)
 N X,Y,DIR,Z,IBD,IBDD,IBOK,IBSPEC
"RTN","IBCEP5C",18,0)
 S IBALL=$G(IBALL),IBOK=1
"RTN","IBCEP5C",19,0)
 S IBD=+$P(IBDAT,U,2),IBDD=$S(IBD=4:5,1:4)
"RTN","IBCEP5C",20,0)
 F Z=2:1:6 D
"RTN","IBCEP5C",21,0)
 . I IBD'=Z,$P(IBDAT,U,Z+1)'="" S Z(Z)=$P(IBDAT,U,Z+1) Q
"RTN","IBCEP5C",22,0)
 . I IBD=Z S IBD(Z)=$P(IBDAT,U,Z+1)
"RTN","IBCEP5C",23,0)
 K IBSPEC
"RTN","IBCEP5C",24,0)
 I IBALL D  ; Check for specific
"RTN","IBCEP5C",25,0)
 . N X0,X1
"RTN","IBCEP5C",26,0)
 . S X1=0
"RTN","IBCEP5C",27,0)
 . F  S X1=$O(^IBA(IBFILE,"AC",$S(IBFILE=355.9:Z(6),1:Z(2)),$S(IBFILE=355.9:Z(2),1:Z(6)),$S(IBFILE=355.9:$P(IBDAT,U),1:Z(3)),X1)) Q:'X1  S X0=$G(^IBA(IBFILE,X1,0)) I $S(IBFILE=355.9:$P(X0,U,3)=Z(3),1:1) D
"RTN","IBCEP5C",28,0)
 .. I $P(X0,U,IBD)'=IBD(IBD),"12"[$P(X0,U,IBD),($P(X0,U,IBDD)=Z(IBDD)!($P(X0,U,IBDD)=0)!(Z(IBDD)=0&(IBD(IBD)=0))) S X1($P(X0,U,IBD))=X1 Q
"RTN","IBCEP5C",29,0)
 .. I IBD(IBD)=0,Z(IBDD)=0 S X1(0)=X1
"RTN","IBCEP5C",30,0)
 . S X0=0 F  S X0=$O(X1(X0)) Q:X0=""  D
"RTN","IBCEP5C",31,0)
 .. S IBSPEC=$S($G(IBSPEC)'="":IBSPEC_"  ",1:"")_$P($S(IBD=4:"UB92^HCFA 1500",1:"INPT^OUTPT"),U,X0)_" ONLY"
"RTN","IBCEP5C",32,0)
 . I $D(X1(0)) S IBSPEC=$S($G(IBSPEC)'="":IBSPEC_"  ",1:"")_$S(IBD=4:"BOTH UB92 and HCFA 1500 form type  AND  BOTH INPT and OUTPT care type",1:"BOTH INPT and OUTPT care type  AND  BOTH UB92 and HCFA 1500 form type")
"RTN","IBCEP5C",33,0)
 . ;
"RTN","IBCEP5C",34,0)
 I 'IBALL D
"RTN","IBCEP5C",35,0)
 . N X0,X1
"RTN","IBCEP5C",36,0)
 . S X1=0
"RTN","IBCEP5C",37,0)
 . F  S X1=$O(^IBA(IBFILE,"AC",$S(IBFILE=355.9:Z(6),1:Z(2)),$S(IBFILE=355.9:Z(2),1:Z(6)),$S(IBFILE=355.9:$P(IBDAT,U),1:Z(3)),X1)) Q:'X1  D
"RTN","IBCEP5C",38,0)
 .. S X0=$G(^IBA(IBFILE,X1,0))
"RTN","IBCEP5C",39,0)
 .. I $S(IBFILE=355.9:$P(X0,U,16)=Z(3),1:1),$P(X0,U,IBD)=0,$S($P(X0,U,IBDD)=Z(IBDD):1,1:$P(X0,U,IBDD)=0) S IBSPEC=""
"RTN","IBCEP5C",40,0)
 ;
"RTN","IBCEP5C",41,0)
 I $D(IBSPEC) D
"RTN","IBCEP5C",42,0)
 . N X0,X1,TEXT,IBWHAT
"RTN","IBCEP5C",43,0)
 . S IBWHAT=$S(IBFILE=355.9:$S($G(IBF):"INS CO AND PROVIDER",1:"PROVIDER"),1:"INSURANCE CO")
"RTN","IBCEP5C",44,0)
 . S X0=$S($D(IBD(4)):"UB-92^HCFA 1500",1:"INPT^OUTPT")
"RTN","IBCEP5C",45,0)
 . S X1=$S($D(IBD(4)):"FORM TYPE",1:"CARE TYPE")
"RTN","IBCEP5C",46,0)
 . S DIR(0)="YA"
"RTN","IBCEP5C",47,0)
 . S TEXT(1)="WARNING ... POTENTIAL CONFLICT DETECTED!!"
"RTN","IBCEP5C",48,0)
 . S TEXT(2)=" YOUR NEW COMBINATION APPLIES TO "_$S(IBALL:"BOTH "_$S(IBD=4:"FORM ",1:"INPT AND OUTPT CARE ")_"TYPES",1:"ONLY "_$P(X0,U,IBD(IBD))_" "_X1)
"RTN","IBCEP5C",49,0)
 . S TEXT(3)=" THIS SAME COMBINATION ALREADY EXISTS FOR THE "_IBWHAT_" & "_$S('IBALL:"ALL "_X1_"S",1:"SPECIFIC "_X1_"(S):")
"RTN","IBCEP5C",50,0)
 . S:IBSPEC'="" TEXT(4)=$J("",4)_IBSPEC
"RTN","IBCEP5C",51,0)
 . S TEXT($S($D(TEXT(4)):5,1:4))=" "
"RTN","IBCEP5C",52,0)
 . S DIR("A")="ARE YOU SURE YOU STILL WANT TO ADD THIS RECORD?: "
"RTN","IBCEP5C",53,0)
 . S DIR("?",1)=" "
"RTN","IBCEP5C",54,0)
 . S DIR("?",2)="This combination appears to be conflicting with one(s) already on file."
"RTN","IBCEP5C",55,0)
 . S DIR("?",3)="It has already been defined for the "_$$LOW^XLFSTR(IBWHAT)_" for "_$S(IBALL:"at least 1 specific ",1:"ALL ")_$S(IBD=4:"form",1:"care")_" type"_$S(IBALL:".",1:"s.")
"RTN","IBCEP5C",56,0)
 . S DIR("?")="Respond NO to reject this conflicting record or YES to continue on to add it in spite of the apparent conflict.",DIR("B")="NO"
"RTN","IBCEP5C",57,0)
 . W !! F Q=1:1 Q:'$D(TEXT(Q))  W TEXT(Q),!
"RTN","IBCEP5C",58,0)
 . D ^DIR K DIR W !
"RTN","IBCEP5C",59,0)
 . S IBOK=(Y=1)
"RTN","IBCEP5C",60,0)
 Q IBOK
"RTN","IBCEP5C",61,0)
 ;
"RTN","IBCEP5C",62,0)
CAREUN ;Called from NEWID^IBCEP5B to check for existing record combination
"RTN","IBCEP5C",63,0)
 I IBFILE'=355.9 D
"RTN","IBCEP5C",64,0)
 . S IB35591(.03)=IB3559(.03)
"RTN","IBCEP5C",65,0)
 . I IB35591(.03)'="*N/A*" S IB35591(.03)=$O(^IBA(355.96,"AUNIQ",IBINS,IB3559(.03),IB3559(.04),IB3559(.05),IBPTYP,"")) I 'IB35591(.03) D
"RTN","IBCEP5C",66,0)
 .. S IB35591(.03)=$O(^IBA(355.96,"AUNIQ",IBINS,IB3559(.03),IB3559(.04),0,IBPTYP,"")) I 'IB35591(.03) D
"RTN","IBCEP5C",67,0)
 ... S IB35591(.03)=$O(^IBA(355.96,"AUNIQ",IBINS,IB3559(.03),0,IB3559(.05),IBPTYP,"")) I 'IB35591(.03) D
"RTN","IBCEP5C",68,0)
 .... S IB35591(.03)=$O(^IBA(355.96,"AUNIQ",IBINS,IB3559(.03),0,0,IBPTYP,""))
"RTN","IBCEP5C",69,0)
 . I $D(^IBA(355.91,"AUNIQ",IBINS,IB35591(.03),IB3559(.04),IB3559(.05),IBPTYP)) D  Q
"RTN","IBCEP5C",70,0)
 .. S DIR(0)="EA",DIR("A",1)="This record already exists - NOT ADDED",DIR("A")="PRESS the ENTER key to continue" W ! D ^DIR K DIR,IB3559,IB35591 W !
"RTN","IBCEP5C",71,0)
 I IBFILE=355.9 D
"RTN","IBCEP5C",72,0)
 . S IB35591(.03)=IB3559(.03)
"RTN","IBCEP5C",73,0)
 . I IB35591(.03)'="*N/A*" S IB35591(.03)=$O(^IBA(355.96,"AUNIQ",IBINS,IB3559(.03),IB3559(.04),IB3559(.05),IBPTYP,"")) I 'IB35591(.03) D
"RTN","IBCEP5C",74,0)
 .. S IB35591(.03)=$O(^IBA(355.96,"AUNIQ",IBINS,IB3559(.03),IB3559(.04),0,IBPTYP,"")) I 'IB35591(.03) D
"RTN","IBCEP5C",75,0)
 ... S IB35591(.03)=$O(^IBA(355.96,"AUNIQ",IBINS,IB3559(.03),0,IB3559(.05),IBPTYP,"")) I 'IB35591(.03) D
"RTN","IBCEP5C",76,0)
 .... S IB35591(.03)=$O(^IBA(355.96,"AUNIQ",IBINS,IB3559(.03),0,0,IBPTYP,""))
"RTN","IBCEP5C",77,0)
 . I $D(^IBA(355.9,"AUNIQ",IBPRV,IBINS,IB35591(.03),IB3559(.04),IB3559(.05),IBPTYP)) D  Q
"RTN","IBCEP5C",78,0)
 .. S DIR(0)="EA",DIR("A",1)="This record already exists - NOT ADDED",DIR("A")="PRESS the ENTER key to continue" W ! D ^DIR K DIR,IB3559,IB35591 W !
"RTN","IBCEP5C",79,0)
 Q
"RTN","IBCEP5C",80,0)
 ;
"RTN","IBCEP5C",81,0)
CUCHK ;Called from CHG^IBCEP5B to check for existing combination during edit 
"RTN","IBCEP5C",82,0)
 I IBFILE=355.91,$D(^IBA(355.91,"AUNIQ",$P(IB0,U,1),$S($P(IB0,U,3)="@":"*N/A*",$P(IB0,U,3):$P(IB0,U,3),1:$P(IB0,U,10)),$P(IB0,U,4),$P(IB0,U,5),$P(IB0,U,6))) D  S IBCUCHK=1
"RTN","IBCEP5C",83,0)
 . S DIR(0)="EA",DIR("A",1)="This combination already exists - RECORD NOT CHANGED",DIR("A")="PRESS the ENTER key to continue" W ! D ^DIR K DIR W !
"RTN","IBCEP5C",84,0)
 I IBFILE=355.9,$D(^IBA(355.9,"AUNIQ",$P(IB0,U,1),$P(IB0,U,2),$S($P(IB0,U,3)="@":"*N/A*",$P(IB0,U,3):$P(IB0,U,3),1:$P(IB0,U,16)),$P(IB0,U,4),$P(IB0,U,5),$P(IB0,U,6))) D  S IBCUCHK=1
"RTN","IBCEP5C",85,0)
 . S DIR(0)="EA",DIR("A",1)="This combination already exists - RECORD NOT CHANGED",DIR("A")="PRESS the ENTER key to continue" W ! D ^DIR K DIR W !
"RTN","IBCEP5C",86,0)
 Q
"VER")
8.0^22
**END**
**END**
