Released DG*5.3*730 SEQ #654
Extracted from mail message
**KIDS**:DG*5.3*730^

**INSTALL NAME**
DG*5.3*730
"BLD",7026,0)
DG*5.3*730^REGISTRATION^0^3061114^y
"BLD",7026,1,0)
^^3^3^3061114^
"BLD",7026,1,1,0)
  This patch resolves problems related to the patient's address, the 
"BLD",7026,1,2,0)
emergency contact work phone, the principal investigator report, 
"BLD",7026,1,3,0)
and the patient name change bulletin.
"BLD",7026,4,0)
^9.64PA^^
"BLD",7026,6.3)
2
"BLD",7026,"KRN",0)
^9.67PA^8989.52^19
"BLD",7026,"KRN",.4,0)
.4
"BLD",7026,"KRN",.401,0)
.401
"BLD",7026,"KRN",.402,0)
.402
"BLD",7026,"KRN",.403,0)
.403
"BLD",7026,"KRN",.5,0)
.5
"BLD",7026,"KRN",.84,0)
.84
"BLD",7026,"KRN",3.6,0)
3.6
"BLD",7026,"KRN",3.8,0)
3.8
"BLD",7026,"KRN",9.2,0)
9.2
"BLD",7026,"KRN",9.8,0)
9.8
"BLD",7026,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",7026,"KRN",9.8,"NM",1,0)
DGREGAED^^0^B17873671
"BLD",7026,"KRN",9.8,"NM",2,0)
DGADDUTL^^0^B43351815
"BLD",7026,"KRN",9.8,"NM",3,0)
DGRPD1^^0^B5267286
"BLD",7026,"KRN",9.8,"NM",4,0)
DGPFRPI^^0^B18765680
"BLD",7026,"KRN",9.8,"NM",5,0)
DGBUL^^0^B6329339
"BLD",7026,"KRN",9.8,"NM",6,0)
DGREGAZL^^0^B39798425
"BLD",7026,"KRN",9.8,"NM","B","DGADDUTL",2)

"BLD",7026,"KRN",9.8,"NM","B","DGBUL",5)

"BLD",7026,"KRN",9.8,"NM","B","DGPFRPI",4)

"BLD",7026,"KRN",9.8,"NM","B","DGREGAED",1)

"BLD",7026,"KRN",9.8,"NM","B","DGREGAZL",6)

"BLD",7026,"KRN",9.8,"NM","B","DGRPD1",3)

"BLD",7026,"KRN",19,0)
19
"BLD",7026,"KRN",19.1,0)
19.1
"BLD",7026,"KRN",101,0)
101
"BLD",7026,"KRN",409.61,0)
409.61
"BLD",7026,"KRN",771,0)
771
"BLD",7026,"KRN",870,0)
870
"BLD",7026,"KRN",8989.51,0)
8989.51
"BLD",7026,"KRN",8989.52,0)
8989.52
"BLD",7026,"KRN",8994,0)
8994
"BLD",7026,"KRN","B",.4,.4)

"BLD",7026,"KRN","B",.401,.401)

"BLD",7026,"KRN","B",.402,.402)

"BLD",7026,"KRN","B",.403,.403)

"BLD",7026,"KRN","B",.5,.5)

"BLD",7026,"KRN","B",.84,.84)

"BLD",7026,"KRN","B",3.6,3.6)

"BLD",7026,"KRN","B",3.8,3.8)

"BLD",7026,"KRN","B",9.2,9.2)

"BLD",7026,"KRN","B",9.8,9.8)

"BLD",7026,"KRN","B",19,19)

"BLD",7026,"KRN","B",19.1,19.1)

"BLD",7026,"KRN","B",101,101)

"BLD",7026,"KRN","B",409.61,409.61)

"BLD",7026,"KRN","B",771,771)

"BLD",7026,"KRN","B",870,870)

"BLD",7026,"KRN","B",8989.51,8989.51)

"BLD",7026,"KRN","B",8989.52,8989.52)

"BLD",7026,"KRN","B",8994,8994)

"BLD",7026,"QUES",0)
^9.62^^
"BLD",7026,"REQB",0)
^9.611^6^6
"BLD",7026,"REQB",1,0)
DG*5.3*545^1
"BLD",7026,"REQB",2,0)
DG*5.3*554^1
"BLD",7026,"REQB",3,0)
DG*5.3*581^1
"BLD",7026,"REQB",4,0)
DG*5.3*658^1
"BLD",7026,"REQB",5,0)
DG*5.3*695^1
"BLD",7026,"REQB",6,0)
DG*5.3*703^1
"BLD",7026,"REQB","B","DG*5.3*545",1)

"BLD",7026,"REQB","B","DG*5.3*554",2)

"BLD",7026,"REQB","B","DG*5.3*581",3)

"BLD",7026,"REQB","B","DG*5.3*658",4)

"BLD",7026,"REQB","B","DG*5.3*695",5)

"BLD",7026,"REQB","B","DG*5.3*703",6)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
730^3061114
"PKG",5,22,1,"PAH",1,1,0)
^^3^3^3061114
"PKG",5,22,1,"PAH",1,1,1,0)
  This patch resolves problems related to the patient's address, the 
"PKG",5,22,1,"PAH",1,1,2,0)
emergency contact work phone, the principal investigator report, 
"PKG",5,22,1,"PAH",1,1,3,0)
and the patient name change bulletin.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","DGADDUTL")
0^2^B43351815^B43598540
"RTN","DGADDUTL",1,0)
DGADDUTL ;ALB/PHH,EG-PATIENT ADDRESS; 12/06/2005
"RTN","DGADDUTL",2,0)
 ;;5.3;Registration;**658,695,730**;Aug 13, 1993;Build 2
"RTN","DGADDUTL",3,0)
 Q
"RTN","DGADDUTL",4,0)
ADDR ; validate/edit Patient address (entry for DG ADDRESS UPDATE option)
"RTN","DGADDUTL",5,0)
 N %,QUIT,DIC,Y,DFN,USERSEL
"RTN","DGADDUTL",6,0)
ADDRLOOP ;
"RTN","DGADDUTL",7,0)
 W !!
"RTN","DGADDUTL",8,0)
 K DIC,Y,DFN,USERSEL
"RTN","DGADDUTL",9,0)
 S DIC="^DPT(",DIC(0)="AEMZQ",DIC("A")="Veteran Name/SSN: " D ^DIC
"RTN","DGADDUTL",10,0)
 I $D(DTOUT)!($D(DUOUT)) Q
"RTN","DGADDUTL",11,0)
 Q:Y'>0
"RTN","DGADDUTL",12,0)
 ;
"RTN","DGADDUTL",13,0)
 S DFN=+Y,QUIT=0
"RTN","DGADDUTL",14,0)
 F  D  Q:QUIT
"RTN","DGADDUTL",15,0)
 .W !!,"Do you want to update the (P)ermanent Address, (T)emporary Address, or (B)oth? "
"RTN","DGADDUTL",16,0)
 .R USERSEL:300
"RTN","DGADDUTL",17,0)
 .I '$T S USERSEL="^"
"RTN","DGADDUTL",18,0)
 .I USERSEL["^"!(USERSEL="") S QUIT=1 Q
"RTN","DGADDUTL",19,0)
 .S USERSEL=$TR(USERSEL,"ptb","PTB")
"RTN","DGADDUTL",20,0)
 .I USERSEL'="P",USERSEL'="T",USERSEL'="B" D  Q
"RTN","DGADDUTL",21,0)
 ..W !,"Invalid selection!"
"RTN","DGADDUTL",22,0)
 .I USERSEL="P"!(USERSEL="B") W ! D UPDATE(DFN,"PERM")
"RTN","DGADDUTL",23,0)
 .I USERSEL="T"!(USERSEL="B") D UPDATE(DFN,"TEMP")
"RTN","DGADDUTL",24,0)
 .S QUIT=1
"RTN","DGADDUTL",25,0)
 G ADDRLOOP
"RTN","DGADDUTL",26,0)
ADD(DFN) ; validate/edit Patient address (entry point for routine DGREG)
"RTN","DGADDUTL",27,0)
 ;         Input  -- DFN
"RTN","DGADDUTL",28,0)
 ;
"RTN","DGADDUTL",29,0)
 N RETVAL,ADDYN
"RTN","DGADDUTL",30,0)
 S (RETVAL,ADDYN)=0
"RTN","DGADDUTL",31,0)
 F  D  Q:ADDYN
"RTN","DGADDUTL",32,0)
 .S ADDYN=$$ADDYN("Do you want to validate/edit the Patient's Address")
"RTN","DGADDUTL",33,0)
 .S RETVAL=ADDYN
"RTN","DGADDUTL",34,0)
 .I ADDYN'=1,ADDYN'=2 S (ADDYN,RETVAL)=0
"RTN","DGADDUTL",35,0)
 .I 'ADDYN W !?5,"Enter 'YES' to validate/edit Patient's Address or 'NO' to continue."
"RTN","DGADDUTL",36,0)
 I ADDYN=1,$G(DFN)'="",$D(^DPT(DFN,0)) D
"RTN","DGADDUTL",37,0)
 .D UPDATE(DFN,"PERM")
"RTN","DGADDUTL",38,0)
 .S RETVAL=1
"RTN","DGADDUTL",39,0)
 Q RETVAL
"RTN","DGADDUTL",40,0)
ADDYN(PROMPT) ; Yes/No Prompt to Edit/Validate Address
"RTN","DGADDUTL",41,0)
 ;         Input  -- None
"RTN","DGADDUTL",42,0)
 ;         Output --  1 = YES
"RTN","DGADDUTL",43,0)
 ;                    2 = NO
"RTN","DGADDUTL",44,0)
 ;                   -1 = Aborted
"RTN","DGADDUTL",45,0)
 ;
"RTN","DGADDUTL",46,0)
 N %
"RTN","DGADDUTL",47,0)
 W !,PROMPT
"RTN","DGADDUTL",48,0)
 D YN^DICN
"RTN","DGADDUTL",49,0)
 Q %
"RTN","DGADDUTL",50,0)
UPDATE(DFN,TYPE) ; Update the Address
"RTN","DGADDUTL",51,0)
 ;         Input  -- TYPE = "PERM" for Permanent Address
"RTN","DGADDUTL",52,0)
 ;                        = "TEMP" for Temporary Address
"RTN","DGADDUTL",53,0)
 ;         Output -- None
"RTN","DGADDUTL",54,0)
 ;         
"RTN","DGADDUTL",55,0)
 I TYPE'="PERM",TYPE'="TEMP" Q
"RTN","DGADDUTL",56,0)
 I TYPE="PERM" D
"RTN","DGADDUTL",57,0)
 .W !
"RTN","DGADDUTL",58,0)
 .N FLG S (FLG(1),FLG(2))=1
"RTN","DGADDUTL",59,0)
 .D ADDRED(DFN,.FLG)
"RTN","DGADDUTL",60,0)
 ;
"RTN","DGADDUTL",61,0)
 I TYPE="TEMP" D
"RTN","DGADDUTL",62,0)
 .D EDITTADR(DFN)
"RTN","DGADDUTL",63,0)
 Q
"RTN","DGADDUTL",64,0)
UPDDTTM(DFN,TYPE) ; Update the PATIENT file #2 with the current date and time
"RTN","DGADDUTL",65,0)
 ;
"RTN","DGADDUTL",66,0)
 N %H,%,X,%Y,%D,%M,%I,ADDDTTM,DIE,DA,DR
"RTN","DGADDUTL",67,0)
 D NOW^%DTC
"RTN","DGADDUTL",68,0)
 S ADDDTTM=%,DIE="^DPT(",DA=DFN
"RTN","DGADDUTL",69,0)
 ;
"RTN","DGADDUTL",70,0)
 ; If it's the Temporary Address, the field is .12113
"RTN","DGADDUTL",71,0)
 ; If not, it should be the Permanent Address and the default field is .118
"RTN","DGADDUTL",72,0)
 S DR=$S(TYPE="TEMP":".12113///^S X=ADDDTTM",1:".118///^S X=ADDDTTM")
"RTN","DGADDUTL",73,0)
 D ^DIE
"RTN","DGADDUTL",74,0)
 Q
"RTN","DGADDUTL",75,0)
ADDRED(DFN,FLG) ; Address Edit (Code copied from DGREGAED and modified)
"RTN","DGADDUTL",76,0)
 ;Input:
"RTN","DGADDUTL",77,0)
 ;  DFN (required) - Interal Entry # of Patient File (#2)
"RTN","DGADDUTL",78,0)
 ;  FLG (optional) - Flags of 1 or 0; if null, 0 is assumed. Details:
"RTN","DGADDUTL",79,0)
 ;    FLG(1) - if 1, let user edit phone numbers (field #.131 and #.132)
"RTN","DGADDUTL",80,0)
 ;    FLG(2) - if 1, display before & after address for user confirmation
"RTN","DGADDUTL",81,0)
 K EASZIPLK
"RTN","DGADDUTL",82,0)
 N DGINPUT,I,X,Y,%
"RTN","DGADDUTL",83,0)
 I $G(DFN)="" Q
"RTN","DGADDUTL",84,0)
 ;I ($G(DFN)'?.N) Q
"RTN","DGADDUTL",85,0)
 S FLG(1)=$G(FLG(1)),FLG(2)=$G(FLG(2))
"RTN","DGADDUTL",86,0)
 D INPUT^DGREGAED(.DGINPUT,DFN)
"RTN","DGADDUTL",87,0)
 I $G(DGINPUT)=-1 Q
"RTN","DGADDUTL",88,0)
 I $G(FLG(2))=1 D COMPARE^DGREGAED(.DGINPUT,DFN)
"RTN","DGADDUTL",89,0)
 I '$$CONFIRM^DGREGAED() W !,"Change aborted." D EOP^DGREGAED Q
"RTN","DGADDUTL",90,0)
 N DGPRIOR
"RTN","DGADDUTL",91,0)
 D GETPRIOR(DFN,.DGPRIOR)
"RTN","DGADDUTL",92,0)
 D SAVE^DGREGAED(.DGINPUT,DFN)
"RTN","DGADDUTL",93,0)
 Q:'$$FILEYN(.DGPRIOR,.DGINPUT)
"RTN","DGADDUTL",94,0)
 D GETUPDTS(DFN,.DGINPUT)
"RTN","DGADDUTL",95,0)
 D UPDADDLG(DFN,.DGPRIOR,.DGINPUT)
"RTN","DGADDUTL",96,0)
 ; Update the Date/Time Stamp
"RTN","DGADDUTL",97,0)
 D UPDDTTM(DFN,TYPE)
"RTN","DGADDUTL",98,0)
 Q
"RTN","DGADDUTL",99,0)
GETPRIOR(DFN,DGPRIOR) ; Get prior address fields.
"RTN","DGADDUTL",100,0)
 N DGCURR,DGN,DGARRY,DGCIEN,DGST,DGCNTY
"RTN","DGADDUTL",101,0)
 D GETS^DIQ(2,DFN_",",".111;.112;.113;.114;.115;.117;.1112;.131;.132;.121;.118;.119;.12;.122","I","DGCURR")
"RTN","DGADDUTL",102,0)
 F DGN=.111,.112,.113,.114,.115,.117,.1112,.131,.132,.121,.118,.119,.12,.122 D
"RTN","DGADDUTL",103,0)
 . S DGARRY("OLD",DGN)=$G(DGCURR(2,DFN_",",DGN,"I"))
"RTN","DGADDUTL",104,0)
 M DGPRIOR=DGARRY("OLD")
"RTN","DGADDUTL",105,0)
 Q
"RTN","DGADDUTL",106,0)
GETUPDTS(DFN,DGINPUT) ; Get current address fields.
"RTN","DGADDUTL",107,0)
 N DGCURR,DGN,DGARRY
"RTN","DGADDUTL",108,0)
 D GETS^DIQ(2,DFN_",",".118;.119;.12;.122","I","DGCURR")
"RTN","DGADDUTL",109,0)
 F DGN=.118,.119,.12,.122 D
"RTN","DGADDUTL",110,0)
 . S DGARRY("NEW",DGN)=$G(DGCURR(2,DFN_",",DGN,"I"))
"RTN","DGADDUTL",111,0)
 M DGINPUT=DGARRY("NEW")
"RTN","DGADDUTL",112,0)
 Q
"RTN","DGADDUTL",113,0)
FILEYN(DGOLD,DGNEW) ; Determine whether or not to file to #301.7
"RTN","DGADDUTL",114,0)
 N RETVAL
"RTN","DGADDUTL",115,0)
 S RETVAL=0
"RTN","DGADDUTL",116,0)
 D
"RTN","DGADDUTL",117,0)
 .I DGOLD(.111)'=$G(DGNEW(.111)) S RETVAL=1 Q
"RTN","DGADDUTL",118,0)
 .I DGOLD(.112)'=$G(DGNEW(.112)) S RETVAL=1 Q
"RTN","DGADDUTL",119,0)
 .I DGOLD(.114)'=$G(DGNEW(.114)) S RETVAL=1 Q
"RTN","DGADDUTL",120,0)
 .I DGOLD(.115)'=$P($G(DGNEW(.115)),"^",2) S RETVAL=1 Q
"RTN","DGADDUTL",121,0)
 .I DGOLD(.1112)'=$G(DGNEW(.1112)) S RETVAL=1 Q
"RTN","DGADDUTL",122,0)
 .I DGOLD(.117)'=$P($G(DGNEW(.117)),"^",2) S RETVAL=1 Q
"RTN","DGADDUTL",123,0)
 .I DGOLD(.131)'=$G(DGNEW(.131)) S RETVAL=1 Q
"RTN","DGADDUTL",124,0)
 Q RETVAL
"RTN","DGADDUTL",125,0)
UPDADDLG(DFN,DGPRIOR,DGINPUT) ; Update the IVM ADDRESS CHANGE LOG file #301.7
"RTN","DGADDUTL",126,0)
 ;
"RTN","DGADDUTL",127,0)
 N DGDATA
"RTN","DGADDUTL",128,0)
 ; Zero node:
"RTN","DGADDUTL",129,0)
 S DGDATA(.01)=DGINPUT(.118)
"RTN","DGADDUTL",130,0)
 S DGDATA(1)=DFN
"RTN","DGADDUTL",131,0)
 S DGDATA(2)=DGINPUT(.122)
"RTN","DGADDUTL",132,0)
 S DGDATA(3)=DGINPUT(.119)
"RTN","DGADDUTL",133,0)
 S DGDATA(3.5)=DGINPUT(.12)
"RTN","DGADDUTL",134,0)
 ;
"RTN","DGADDUTL",135,0)
 ; One node:
"RTN","DGADDUTL",136,0)
 S DGDATA(4)=DGPRIOR(.118)
"RTN","DGADDUTL",137,0)
 S DGDATA(5)=DGPRIOR(.122)
"RTN","DGADDUTL",138,0)
 S DGDATA(6)=DGPRIOR(.12)
"RTN","DGADDUTL",139,0)
 S DGDATA(7)=DGPRIOR(.119)
"RTN","DGADDUTL",140,0)
 S DGDATA(8)=DGPRIOR(.131)
"RTN","DGADDUTL",141,0)
 S DGDATA(9)=DGPRIOR(.111)
"RTN","DGADDUTL",142,0)
 S DGDATA(10)=DGPRIOR(.112)
"RTN","DGADDUTL",143,0)
 S DGDATA(11)=DGPRIOR(.114)
"RTN","DGADDUTL",144,0)
 S DGDATA(12)=DGPRIOR(.117)
"RTN","DGADDUTL",145,0)
 S DGDATA(13)=DGPRIOR(.115)
"RTN","DGADDUTL",146,0)
 S DGDATA(14)=DGPRIOR(.1112)
"RTN","DGADDUTL",147,0)
 ;
"RTN","DGADDUTL",148,0)
 I $$ADD^DGENDBS(301.7,,.DGDATA) ;
"RTN","DGADDUTL",149,0)
 Q
"RTN","DGADDUTL",150,0)
EDITTADR(DFN) ; Edit Temporary Address
"RTN","DGADDUTL",151,0)
 N DGPRIOR,DGCH,DGRPAN,DGDR,DGRPS
"RTN","DGADDUTL",152,0)
 I $G(DFN)="" Q
"RTN","DGADDUTL",153,0)
 ;I ($G(DFN)'?.N) Q
"RTN","DGADDUTL",154,0)
 ;
"RTN","DGADDUTL",155,0)
 ; Get the current Temporary Address and display it
"RTN","DGADDUTL",156,0)
 D GETTADR(DFN,.DGPRIOR)
"RTN","DGADDUTL",157,0)
 D DISPTADR(DFN,.DGPRIOR)
"RTN","DGADDUTL",158,0)
 W !!
"RTN","DGADDUTL",159,0)
 ;
"RTN","DGADDUTL",160,0)
 S DGCH=5,DGRPAN="1,2,3,4,5,",DGDR="",DGRPS=1
"RTN","DGADDUTL",161,0)
 D CHOICE^DGRPP
"RTN","DGADDUTL",162,0)
 D ^DGRPE
"RTN","DGADDUTL",163,0)
 ; Update the Date/Time Stamp
"RTN","DGADDUTL",164,0)
 D UPDDTTM(DFN,TYPE)
"RTN","DGADDUTL",165,0)
 Q
"RTN","DGADDUTL",166,0)
GETTADR(DFN,DGPRIOR) ; Get prior temporary address fields.
"RTN","DGADDUTL",167,0)
 N DGCURR,DGN,DGARRY,DGCIEN,DGST,DGCNTY
"RTN","DGADDUTL",168,0)
 D GETS^DIQ(2,DFN_",",".1211;.1212;.1213;.1214;.1215;.1216;.1217;.1218;.12105;.1219;.12111;.12112;.12113;.12114","I","DGCURR")
"RTN","DGADDUTL",169,0)
 F DGN=.1211,.1212,.1213,.1214,.1215,.1216,.1217,.1218,.12105,.1219,.12111,.12112,.12113,.12114 D
"RTN","DGADDUTL",170,0)
 .S DGARRY("OLD",DGN)=$G(DGCURR(2,DFN_",",DGN,"I"))
"RTN","DGADDUTL",171,0)
 M DGPRIOR=DGARRY("OLD")
"RTN","DGADDUTL",172,0)
 Q
"RTN","DGADDUTL",173,0)
DISPTADR(DFN,DGARRY) ; Display Temporary Address
"RTN","DGADDUTL",174,0)
 N DGADRACT,DGADR1,DGADR2,DGADR3,DGCITY,DGSTATE,DGZIP
"RTN","DGADDUTL",175,0)
 N DGCOUNTY,DGPHONE,DGFROMDT,DGTODT
"RTN","DGADDUTL",176,0)
 ;
"RTN","DGADDUTL",177,0)
 S DGADRACT=$G(DGARRY(.12105))
"RTN","DGADDUTL",178,0)
 S DGADR1=$G(DGARRY(.1211))
"RTN","DGADDUTL",179,0)
 S DGADR2=$G(DGARRY(.1212))
"RTN","DGADDUTL",180,0)
 S DGADR3=$G(DGARRY(.1213))
"RTN","DGADDUTL",181,0)
 S DGCITY=$G(DGARRY(.1214))
"RTN","DGADDUTL",182,0)
 S DGSTATE=$G(DGARRY(.1215))
"RTN","DGADDUTL",183,0)
 S DGZIP=$G(DGARRY(.1216))
"RTN","DGADDUTL",184,0)
 S DGCOUNTY=$G(DGARRY(.12111))
"RTN","DGADDUTL",185,0)
 I DGCOUNTY'="",DGSTATE'="",$D(^DIC(5,DGSTATE,1,DGCOUNTY,0)) D
"RTN","DGADDUTL",186,0)
 .S DGCOUNTY=$P(^DIC(5,DGSTATE,1,DGCOUNTY,0),"^")_" ("_$P(^DIC(5,DGSTATE,1,DGCOUNTY,0),"^",4)_")"
"RTN","DGADDUTL",187,0)
 I DGADRACT'="Y" S DGCOUNTY="NOT APPLICABLE"
"RTN","DGADDUTL",188,0)
 I DGSTATE'="",$D(^DIC(5,DGSTATE,0)) S DGSTATE=$P(^DIC(5,DGSTATE,0),"^",2)
"RTN","DGADDUTL",189,0)
 S DGPHONE=$G(DGARRY(.1219))
"RTN","DGADDUTL",190,0)
 S DGFROMDT=$$FMTE^XLFDT($G(DGARRY(.1217)))
"RTN","DGADDUTL",191,0)
 S DGTODT=$$FMTE^XLFDT($G(DGARRY(.1218)))
"RTN","DGADDUTL",192,0)
 ;
"RTN","DGADDUTL",193,0)
 W !!,"Temporary Address: "
"RTN","DGADDUTL",194,0)
 I DGADRACT="Y" D
"RTN","DGADDUTL",195,0)
 .W:DGADR1'="" !?9,DGADR1
"RTN","DGADDUTL",196,0)
 .W:DGADR2'="" !?9,DGADR2
"RTN","DGADDUTL",197,0)
 .W:DGADR3'="" !?9,DGADR3
"RTN","DGADDUTL",198,0)
 .W !?9,$S(DGCITY'="":DGCITY,1:"")_","_$S(DGSTATE'="":DGSTATE,1:"")_" "_$S(DGZIP'="":DGZIP,1:"")
"RTN","DGADDUTL",199,0)
 .W !," County: "_DGCOUNTY
"RTN","DGADDUTL",200,0)
 .W !,"  Phone: "_DGPHONE
"RTN","DGADDUTL",201,0)
 .W !,"From/To: "_$P(DGFROMDT,",")_","_$P(DGFROMDT,", ",2)_"-"_$P(DGTODT,",")_","_$P(DGTODT,", ",2)
"RTN","DGADDUTL",202,0)
 ;
"RTN","DGADDUTL",203,0)
 I $G(DGARRY(.12105))="N" D
"RTN","DGADDUTL",204,0)
 .W:$G(DGARRY(.1211))="" !?9,"NO TEMPORARY ADDRESS"
"RTN","DGADDUTL",205,0)
 .W:$G(DGARRY(.1212))="" !?9,""
"RTN","DGADDUTL",206,0)
 .W !," County: NOT APPLICABLE"
"RTN","DGADDUTL",207,0)
 .W !,"  Phone: NOT APPLICABLE"
"RTN","DGADDUTL",208,0)
 .W !,"From/To: NOT APPLICABLE"
"RTN","DGADDUTL",209,0)
 Q
"RTN","DGBUL")
0^5^B6329339^B6158333
"RTN","DGBUL",1,0)
DGBUL ;ALB/MRL - SEND DG BULLETIN ; 22 MAY 1987
"RTN","DGBUL",2,0)
 ;;5.3;Registration;**31,244,545,730**;Aug 13, 1993;Build 2
"RTN","DGBUL",3,0)
 ;
"RTN","DGBUL",4,0)
 N DIC,DIX,DIY,DO,DD
"RTN","DGBUL",5,0)
 I '$D(DGB),'$D(XMSUB) G Q
"RTN","DGBUL",6,0)
 K:$D(DGTEXT) XMTEXT I '$D(DGTEXT)&('$D(XMTEXT)) G Q
"RTN","DGBUL",7,0)
 S DGB=+$P($G(^DG(43,1,"NOT")),"^",DGB)
"RTN","DGBUL",8,0)
 I '$D(^XMB(3.8,DGB,0)) G Q
"RTN","DGBUL",9,0)
 ;
"RTN","DGBUL",10,0)
 ;Protect Fileman from Mailman call
"RTN","DGBUL",11,0)
 N DICRREC,DIDATA,DIEFAR,DIEFCNOD,DIEFDAS,DIEFECNT,DIEFF,DIEFFLAG
"RTN","DGBUL",12,0)
 N DIEFFLD,DIEFFLST,DIEFFREF,DIEFFVAL,DIEFFXR,DIEFI,DIEFIEN,DIEFLEV
"RTN","DGBUL",13,0)
 N DIEFNODE,DIEFNVAL,DIEFOUT,DIEFOVAL,DIEFRFLD,DIEFRLST,DIEFSORK
"RTN","DGBUL",14,0)
 N DIEFSPOT,DIEFTMP,DIEFTREF,DIFLD,DIFM,DIQUIET,DISYS,D,D0,DA
"RTN","DGBUL",15,0)
 ;next line from DG*730
"RTN","DGBUL",16,0)
 K:$D(XMY) XMY
"RTN","DGBUL",17,0)
 ;
"RTN","DGBUL",18,0)
 S XMY("G."_$P($G(^XMB(3.8,DGB,0)),"^",1))="" ; pass mailgroup
"RTN","DGBUL",19,0)
 G Q:'$D(DUZ) S:'$D(DGSM) DGSM=1 S XMTEXT=$S('$D(XMTEXT):"DGTEXT(",1:XMTEXT),XMDUZ=$S(($D(DUZ)#2):DUZ,1:.5) S:$D(DUZ)#2&(DGSM) XMY(DUZ)="" K:'$D(XMY) DGSM D ^XMD:$D(XMY)
"RTN","DGBUL",20,0)
Q K DGSM,DGB,DGTEXT,XMR,DGII,XMY,XMTEXT,XMDUZ,XMSUB Q
"RTN","DGBUL",21,0)
 ;
"RTN","DGBUL",22,0)
EDIT ;
"RTN","DGBUL",23,0)
 F I=1:1 S J=$P($T(T+I),";;",2) Q:J']""  W !,J
"RTN","DGBUL",24,0)
 W ! S DIE="^DG(43,",(DA,Y)=1,DR="500:513" D ^DIE K D,D0,DI,DIC,DQ,X,DR,DIE,DA,Y,I,J Q
"RTN","DGBUL",25,0)
T ;
"RTN","DGBUL",26,0)
 ;;This option is used to specify the mailgroup you desire specific types of
"RTN","DGBUL",27,0)
 ;;notification to be made to.  The mailgroup can be one created locally or a
"RTN","DGBUL",28,0)
 ;;distributed 'DG' mailgroup.  If a mailgroup is selected notification concerning
"RTN","DGBUL",29,0)
 ;;that specific action will be made in the form of a mailman bulletin.  If no
"RTN","DGBUL",30,0)
 ;;notification is desired for a specific action no mailgroup should be specified.
"RTN","DGBUL",31,0)
 ;;If you have any questions concerning the purpose of a specific type of
"RTN","DGBUL",32,0)
 ;;notification enter a question mark at the applicable prompt.
"RTN","DGPFRPI")
0^4^B18765680^B19041361
"RTN","DGPFRPI",1,0)
DGPFRPI ;ALB/RBS - PRF PRINCIPAL INVEST REPORT ; 7/26/05 3:39pm
"RTN","DGPFRPI",2,0)
 ;;5.3;Registration;**554,730**;Aug 13, 1993;Build 2
"RTN","DGPFRPI",3,0)
 ;
"RTN","DGPFRPI",4,0)
 ;This routine will be used for selecting sort parameters to produce
"RTN","DGPFRPI",5,0)
 ;the DGPF PRINCIPAL INVEST REPORT for Patient Record Flags.
"RTN","DGPFRPI",6,0)
 ;
"RTN","DGPFRPI",7,0)
 ; Selection options will provide the ability to report by:
"RTN","DGPFRPI",8,0)
 ;  PRINCIPAL INVESTIGATOR
"RTN","DGPFRPI",9,0)
 ;  CATEGORY
"RTN","DGPFRPI",10,0)
 ;  STATUS (ASSIGNMENTS)
"RTN","DGPFRPI",11,0)
 ;  BEGINNING DATE
"RTN","DGPFRPI",12,0)
 ;  ENDING DATE
"RTN","DGPFRPI",13,0)
 ;
"RTN","DGPFRPI",14,0)
 ; The following reporting sort array will be built by user prompts:
"RTN","DGPFRPI",15,0)
 ;  DGSORT("DGPRINC") = pointer to NEW PERSON (#200) file^Person Name
"RTN","DGPFRPI",16,0)
 ;                      or
"RTN","DGPFRPI",17,0)
 ;                    = "A" = All Principal Investigator's
"RTN","DGPFRPI",18,0)
 ;  DGSORT("DGCAT") = CATEGORY
"RTN","DGPFRPI",19,0)
 ;                      2^Category II (Local)
"RTN","DGPFRPI",20,0)
 ;  DGSORT("DGSTATUS") = Assignment Status to report on
"RTN","DGPFRPI",21,0)
 ;                         1^Active
"RTN","DGPFRPI",22,0)
 ;                         2^Inactive
"RTN","DGPFRPI",23,0)
 ;                         3^Both
"RTN","DGPFRPI",24,0)
 ;  DGSORT("DGBEG") = BEGINNING DATE  (internal FileMan date)
"RTN","DGPFRPI",25,0)
 ;  DGSORT("DGEND") = ENDING DATE     (internal FileMan date)
"RTN","DGPFRPI",26,0)
 ;
"RTN","DGPFRPI",27,0)
 ;-- no direct entry
"RTN","DGPFRPI",28,0)
 QUIT
"RTN","DGPFRPI",29,0)
 ;
"RTN","DGPFRPI",30,0)
EN ;Entry point
"RTN","DGPFRPI",31,0)
 ;-- user prompts for report selection sorts
"RTN","DGPFRPI",32,0)
 ;  Input: none
"RTN","DGPFRPI",33,0)
 ; Output: Report generated using user selected parameters
"RTN","DGPFRPI",34,0)
 ;
"RTN","DGPFRPI",35,0)
 N DGABORT ;abort flag
"RTN","DGPFRPI",36,0)
 N DGASK   ;return value from $$ANSWER^DGPFUT call
"RTN","DGPFRPI",37,0)
 N DGDIRA  ;DGDIRA - DIR("A") string
"RTN","DGPFRPI",38,0)
 N DGDIRB  ;DGDIRB - DIR("B") string
"RTN","DGPFRPI",39,0)
 N DGDIRH  ;DGDIRH - DIR("?") string
"RTN","DGPFRPI",40,0)
 N DGDIRO  ;DGDIR0 - DIR(0) string
"RTN","DGPFRPI",41,0)
 N DGDIRS  ;DGDIRS - DIR("S") string
"RTN","DGPFRPI",42,0)
 N DGFIRST ;first assignment date
"RTN","DGPFRPI",43,0)
 N DGQ     ;quit flag
"RTN","DGPFRPI",44,0)
 N DGSEL   ;help text var
"RTN","DGPFRPI",45,0)
 N DGSORT  ;array or report parameters
"RTN","DGPFRPI",46,0)
 N ZTSAVE  ;open array reference of input parameters used by tasking
"RTN","DGPFRPI",47,0)
 ;
"RTN","DGPFRPI",48,0)
 ;check for database
"RTN","DGPFRPI",49,0)
 S DGFIRST=$P(+$O(^DGPF(26.14,"D","")),".")    ;first assignment date
"RTN","DGPFRPI",50,0)
 I 'DGFIRST D  Q
"RTN","DGPFRPI",51,0)
 . W !?2,">>> No Patient Record Flag Assignments have been found.",*7
"RTN","DGPFRPI",52,0)
 . I $$ANSWER^DGPFUT("Enter RETURN to continue","","E")  ;pause
"RTN","DGPFRPI",53,0)
 ;
"RTN","DGPFRPI",54,0)
 ;-- prompt for selection of an approved by person
"RTN","DGPFRPI",55,0)
 S DGDIRA="Select to report on a (S)ingle Principal Investigator or (A)ll"
"RTN","DGPFRPI",56,0)
 S DGDIRB="Single"
"RTN","DGPFRPI",57,0)
 S DGDIRH="Enter one of the selections to report on"
"RTN","DGPFRPI",58,0)
 S DGDIRO="S^S:Single Principal Investigator;A:All Principal Investigators"
"RTN","DGPFRPI",59,0)
 S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRPI",60,0)
 Q:DGASK=-1!(DGASK=0)
"RTN","DGPFRPI",61,0)
 ;
"RTN","DGPFRPI",62,0)
 S:DGASK="A" DGSORT("DGPRINC")="A"
"RTN","DGPFRPI",63,0)
 ;
"RTN","DGPFRPI",64,0)
 D:DGASK="S"
"RTN","DGPFRPI",65,0)
 .S (DGQ,DGABORT)=0
"RTN","DGPFRPI",66,0)
 .N DIC,D,X,Y,I
"RTN","DGPFRPI",67,0)
 .S DIC="^DGPF(26.11,"
"RTN","DGPFRPI",68,0)
 .S DIC(0)="AEQZ"
"RTN","DGPFRPI",69,0)
 .S D="C"
"RTN","DGPFRPI",70,0)
 .S DIC("A")="Select Principal Investigator's name: "
"RTN","DGPFRPI",71,0)
 .D IX^DIC
"RTN","DGPFRPI",72,0)
 .I Y<0 S DGABORT=1 Q
"RTN","DGPFRPI",73,0)
 .S I=0
"RTN","DGPFRPI",74,0)
 .F  S I=$O(^DGPF(26.11,+Y,2,"B",I)) Q:'I  I $P(^VA(200,I,0),U)[X Q
"RTN","DGPFRPI",75,0)
 .I '$G(I) S DGABORT=1 Q
"RTN","DGPFRPI",76,0)
 .S DGSORT("DGPRINC")=I_U_$$EXTERNAL^DILFD(26.112,.01,"F",I)
"RTN","DGPFRPI",77,0)
 .S DGQ=1
"RTN","DGPFRPI",78,0)
 ;
"RTN","DGPFRPI",79,0)
 Q:$G(DGABORT)
"RTN","DGPFRPI",80,0)
 ;
"RTN","DGPFRPI",81,0)
 ;-- prompt for selection of a flag category
"RTN","DGPFRPI",82,0)
 ; only Cat II (Local) file (#26.11) has Research Flags
"RTN","DGPFRPI",83,0)
 S DGSORT("DGCAT")=2_U_"Category II (Local)"
"RTN","DGPFRPI",84,0)
 ;
"RTN","DGPFRPI",85,0)
 ;-- prompt for selection of the assignment status to report on
"RTN","DGPFRPI",86,0)
 S DGDIRA="Select Assignment Status to report on"
"RTN","DGPFRPI",87,0)
 S DGDIRB="Both"
"RTN","DGPFRPI",88,0)
 S DGDIRH="Enter one of the status selections to report on"
"RTN","DGPFRPI",89,0)
 S DGDIRO="S^1:Active;2:Inactive;3:Both"
"RTN","DGPFRPI",90,0)
 S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRPI",91,0)
 Q:(DGASK<1)
"RTN","DGPFRPI",92,0)
 S DGSORT("DGSTATUS")=DGASK_U_$S(DGASK=1:"Active",DGASK=2:"Inactive",DGASK=3:"Both",1:3)
"RTN","DGPFRPI",93,0)
 ;
"RTN","DGPFRPI",94,0)
 ;-- prompt for beginning date
"RTN","DGPFRPI",95,0)
 S DGDIRA="Select Beginning Date"
"RTN","DGPFRPI",96,0)
 S DGDIRB=""
"RTN","DGPFRPI",97,0)
 S DGDIRH="^D HELP^DGPFRPI(1)"
"RTN","DGPFRPI",98,0)
 S DGDIRO="D^"_DGFIRST_":DT:EX"
"RTN","DGPFRPI",99,0)
 S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRPI",100,0)
 Q:(DGASK=-1)
"RTN","DGPFRPI",101,0)
 S DGSORT("DGBEG")=DGASK
"RTN","DGPFRPI",102,0)
 ;
"RTN","DGPFRPI",103,0)
 ;-- prompt for ending date
"RTN","DGPFRPI",104,0)
 S DGDIRA="Select Ending Date"
"RTN","DGPFRPI",105,0)
 S DGDIRB=""
"RTN","DGPFRPI",106,0)
 S DGDIRH="^D HELP^DGPFRPI(2)"
"RTN","DGPFRPI",107,0)
 S DGDIRO="D^"_DGSORT("DGBEG")_":DT:EX"
"RTN","DGPFRPI",108,0)
 S DGASK=$$ANSWER^DGPFUT(DGDIRA,DGDIRB,DGDIRO,DGDIRH)
"RTN","DGPFRPI",109,0)
 Q:(DGASK=-1)
"RTN","DGPFRPI",110,0)
 S DGSORT("DGEND")=DGASK
"RTN","DGPFRPI",111,0)
 ;
"RTN","DGPFRPI",112,0)
 K DGDIRA,DGDIRB,DGDIRO,DGDIRH,DGDIRS,DGASK,DGQ,DGABORT
"RTN","DGPFRPI",113,0)
 ;
"RTN","DGPFRPI",114,0)
 ;-- prompt for device
"RTN","DGPFRPI",115,0)
 S ZTSAVE("DGSORT(")=""
"RTN","DGPFRPI",116,0)
 D EN^XUTMDEVQ("START^DGPFRPI1","Assignments By Principle Investigator Report",.ZTSAVE)
"RTN","DGPFRPI",117,0)
 D HOME^%ZIS
"RTN","DGPFRPI",118,0)
 Q
"RTN","DGPFRPI",119,0)
 ;
"RTN","DGPFRPI",120,0)
HELP(DGSEL) ;provide extended DIR("?") help text.
"RTN","DGPFRPI",121,0)
 ;
"RTN","DGPFRPI",122,0)
 ;  Input: DGSEL - prompt var for help text word selection
"RTN","DGPFRPI",123,0)
 ; Output: none
"RTN","DGPFRPI",124,0)
 ;
"RTN","DGPFRPI",125,0)
 W !,"  Enter the "_$S(DGSEL=1:"earliest",1:"latest")_" Assignment Date to include in the report."
"RTN","DGPFRPI",126,0)
 W !,"  Please enter a date from the specified date range displayed."
"RTN","DGPFRPI",127,0)
 Q
"RTN","DGREGAED")
0^1^B17873671^B17895648
"RTN","DGREGAED",1,0)
DGREGAED ;ALB/DW/PHH - Address Edit API; 9/1/2005
"RTN","DGREGAED",2,0)
 ;;5.3;Registration;**522,560,658,730**;Aug 13, 1993;Build 2
"RTN","DGREGAED",3,0)
EN(DFN,FLG) ;Entry point
"RTN","DGREGAED",4,0)
 ;Input: 
"RTN","DGREGAED",5,0)
 ;  DFN (required) - Internal Entry # of Patient File (#2)
"RTN","DGREGAED",6,0)
 ;  FLG (optional) - Flags of 1 or 0; if null, 0 is assumed. Details:
"RTN","DGREGAED",7,0)
 ;    FLG(1) - if 1, let user edit phone numbers (field #.131 and #.132)
"RTN","DGREGAED",8,0)
 ;    FLG(2) - if 1, display before & after address for user confirmation
"RTN","DGREGAED",9,0)
 K EASZIPLK
"RTN","DGREGAED",10,0)
 N DGINPUT
"RTN","DGREGAED",11,0)
 N I,X,Y
"RTN","DGREGAED",12,0)
 I $G(DFN)="" Q
"RTN","DGREGAED",13,0)
 ;I ($G(DFN)'?.N) Q
"RTN","DGREGAED",14,0)
 S FLG(1)=$G(FLG(1)),FLG(2)=$G(FLG(2))
"RTN","DGREGAED",15,0)
 D INPUT(.DGINPUT,DFN)
"RTN","DGREGAED",16,0)
 I $G(DGINPUT)=-1 Q
"RTN","DGREGAED",17,0)
 I $G(FLG(2))=1 D COMPARE(.DGINPUT,DFN)
"RTN","DGREGAED",18,0)
 I '$$CONFIRM() W !,"Change aborted." D EOP Q
"RTN","DGREGAED",19,0)
 N DGPRIOR
"RTN","DGREGAED",20,0)
 D GETPRIOR^DGADDUTL(DFN,.DGPRIOR)
"RTN","DGREGAED",21,0)
 D SAVE(.DGINPUT,DFN)
"RTN","DGREGAED",22,0)
 I +$G(DGNEW) Q
"RTN","DGREGAED",23,0)
 Q:'$$FILEYN^DGADDUTL(.DGPRIOR,.DGINPUT)
"RTN","DGREGAED",24,0)
 D GETUPDTS^DGADDUTL(DFN,.DGINPUT)
"RTN","DGREGAED",25,0)
 D UPDADDLG^DGADDUTL(DFN,.DGPRIOR,.DGINPUT)
"RTN","DGREGAED",26,0)
 Q
"RTN","DGREGAED",27,0)
INPUT(DGINPUT,DFN) ;Let user input address changes
"RTN","DGREGAED",28,0)
 ;Output: DGINPUT(field#)=external^internal(if any)
"RTN","DGREGAED",29,0)
 N DIR,X,Y,DA,DGR,DTOUT,DUOUT,DIROUT,DGN,POP
"RTN","DGREGAED",30,0)
 S POP=0
"RTN","DGREGAED",31,0)
 F DGN=.111,.112,.113,.1112,.131,.132,.121 Q:POP  D
"RTN","DGREGAED",32,0)
 . I ($G(DGINPUT(.111))="")&((DGN=.112)!(DGN=.113)) Q
"RTN","DGREGAED",33,0)
 . I ($G(DGINPUT(.112))="")&(DGN=.113) Q
"RTN","DGREGAED",34,0)
 . I ($G(FLG(1))'=1)&((DGN=.131)!(DGN=.132)) Q
"RTN","DGREGAED",35,0)
 . I DGN=.1112 D  Q
"RTN","DGREGAED",36,0)
 .. D EN^DGREGAZL(.DGR,DFN)
"RTN","DGREGAED",37,0)
 .. I $G(DGR)=-1 S POP=1 Q
"RTN","DGREGAED",38,0)
 .. N DGM F DGM=.1112,.114,.115,.117 S DGINPUT(DGM)=$G(DGR(DGM))
"RTN","DGREGAED",39,0)
AGN . S DIR(0)=2_","_DGN
"RTN","DGREGAED",40,0)
 . S DA=DFN
"RTN","DGREGAED",41,0)
 . D ^DIR
"RTN","DGREGAED",42,0)
 . I $D(DTOUT) S POP=1 Q
"RTN","DGREGAED",43,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT G AGN
"RTN","DGREGAED",44,0)
 . I DGN'=.121 S DGINPUT(DGN)=$G(Y)
"RTN","DGREGAED",45,0)
 . I DGN=.121 D
"RTN","DGREGAED",46,0)
 .. I $P($G(Y),U)=$$GET1^DIQ(2,DFN_",",DGN,"I") D
"RTN","DGREGAED",47,0)
 ... S DGINPUT(DGN)=$$GET1^DIQ(2,DFN_",",DGN)_U_$P($G(Y),U)
"RTN","DGREGAED",48,0)
 .. I $P($G(Y),U)'=$$GET1^DIQ(2,DFN_",",DGN,"I") D
"RTN","DGREGAED",49,0)
 ... S DGINPUT(DGN)=$P($G(Y(0)),U)_U_$G(Y)
"RTN","DGREGAED",50,0)
 I $G(POP)=1 S DGINPUT=-1
"RTN","DGREGAED",51,0)
 Q
"RTN","DGREGAED",52,0)
COMPARE(DGINPUT,DFN) ;Display before & after address fields
"RTN","DGREGAED",53,0)
 N DGCURR,DGN,DGCMP,DGM,DGCNTY,DGCIEN,DGST
"RTN","DGREGAED",54,0)
 D GETS^DIQ(2,DFN_",",".111;.112;.113;.114;.115;.117;.1112;.131;.132;.121","EI","DGCURR")
"RTN","DGREGAED",55,0)
 F DGN=.111,.112,.113,.114,.115,.117,.1112,.131,.132,.121 D
"RTN","DGREGAED",56,0)
 . S DGCMP("OLD",DGN)=$G(DGCURR(2,DFN_",",DGN,"E"))
"RTN","DGREGAED",57,0)
 S DGCIEN=$G(DGCURR(2,DFN_",",.117,"I"))
"RTN","DGREGAED",58,0)
 S DGST=$G(DGCURR(2,DFN_",",.115,"I"))
"RTN","DGREGAED",59,0)
 S DGCNTY=$$CNTY^DGREGAZL(DGST,DGCIEN)
"RTN","DGREGAED",60,0)
 I DGCNTY=-1 S DGCNTY=""
"RTN","DGREGAED",61,0)
 S DGCMP("OLD",.117)=$P(DGCNTY,U)_" "_$P(DGCNTY,U,3)
"RTN","DGREGAED",62,0)
 M DGCMP("NEW")=DGINPUT
"RTN","DGREGAED",63,0)
 S DGCNTY=$P($G(DGCMP("NEW",.117)),U)_" "_$P($G(DGCMP("NEW",.117)),U,3)
"RTN","DGREGAED",64,0)
 S DGCMP("NEW",.117)=DGCNTY
"RTN","DGREGAED",65,0)
 I ($L(DGCMP("NEW",.1112))>5)&($P(DGCMP("NEW",.1112),"-",2)="") S DGCMP("NEW",.1112)=$E(DGCMP("NEW",.1112),1,5)_"-"_$E(DGCMP("NEW",.1112),6,9)
"RTN","DGREGAED",66,0)
 F DGM="OLD","NEW" D
"RTN","DGREGAED",67,0)
 . W !,?2,"[",DGM," ADDRESS]"
"RTN","DGREGAED",68,0)
 . W ?16,$P($G(DGCMP(DGM,.111)),U)
"RTN","DGREGAED",69,0)
 . I $P($G(DGCMP(DGM,.112)),U)'="" W !,?16,$P($G(DGCMP(DGM,.112)),U)
"RTN","DGREGAED",70,0)
 . I $P($G(DGCMP(DGM,.113)),U)'="" W !,?16,$P($G(DGCMP(DGM,.113)),U)
"RTN","DGREGAED",71,0)
 . W !,?16,$P($G(DGCMP(DGM,.114)),U)
"RTN","DGREGAED",72,0)
 . W:($P($G(DGCMP(DGM,.114)),U)'="")!($P($G(DGCMP(DGM,.115)),U)'="") ","
"RTN","DGREGAED",73,0)
 . W $P($G(DGCMP(DGM,.115)),U)
"RTN","DGREGAED",74,0)
 . W " ",$G(DGCMP(DGM,.1112))
"RTN","DGREGAED",75,0)
 . I $P($G(DGCMP(DGM,.117)),U)'="" W !,?6,"  County: ",$P($G(DGCMP(DGM,.117)),U)
"RTN","DGREGAED",76,0)
 . I $G(FLG(1))=1 D
"RTN","DGREGAED",77,0)
 .. W !,?6,"   Phone: ",?16,$P($G(DGCMP(DGM,.131)),U)
"RTN","DGREGAED",78,0)
 .. W !,?6,"  Office: ",?16,$P($G(DGCMP(DGM,.132)),U)
"RTN","DGREGAED",79,0)
 . W !,?6,"Bad Addr: ",?16,$P($G(DGCMP(DGM,.121)),U)
"RTN","DGREGAED",80,0)
 . W !
"RTN","DGREGAED",81,0)
 Q
"RTN","DGREGAED",82,0)
CONFIRM() ;Confirm if user wants to save the change
"RTN","DGREGAED",83,0)
 N DIR,X,Y,DTOUT,DUOUT,DIROUT
"RTN","DGREGAED",84,0)
 S DIR(0)="Y"
"RTN","DGREGAED",85,0)
 S DIR("A")="Are you sure that you want to save the above changes"
"RTN","DGREGAED",86,0)
 S DIR("?")="Please answer Y for YES or N for NO."
"RTN","DGREGAED",87,0)
 D ^DIR
"RTN","DGREGAED",88,0)
 I $D(DTOUT)!($G(Y)=0) Q 0
"RTN","DGREGAED",89,0)
 I $D(DUOUT)!$D(DIROUT) Q 0
"RTN","DGREGAED",90,0)
 Q 1
"RTN","DGREGAED",91,0)
SAVE(DGINPUT,DFN) ;Save changes
"RTN","DGREGAED",92,0)
 N DGN,DGER,DGM
"RTN","DGREGAED",93,0)
 S DGER=0
"RTN","DGREGAED",94,0)
 F DGN=.111,.112,.113,.131,.132,.1112,.114,.115,.117,.121 D
"RTN","DGREGAED",95,0)
 . I ($G(FLG(1))'=1)&((DGN=.131)!(DGN=.132)) Q
"RTN","DGREGAED",96,0)
 . N DGCODE,DGNAME,FDA,MSG
"RTN","DGREGAED",97,0)
 . S DGCODE=$P($G(DGINPUT(DGN)),U,2)
"RTN","DGREGAED",98,0)
 . S DGNAME=$P($G(DGINPUT(DGN)),U)
"RTN","DGREGAED",99,0)
 . S FDA(2,DFN_",",DGN)=$S(DGCODE:DGCODE,1:DGNAME)
"RTN","DGREGAED",100,0)
 . D FILE^DIE($S(DGCODE:"",1:"E"),"FDA","MSG")
"RTN","DGREGAED",101,0)
 . I $D(MSG) D
"RTN","DGREGAED",102,0)
 .. S DGM="",DGER=1
"RTN","DGREGAED",103,0)
 .. W !,"Please review the saved changes!!",!
"RTN","DGREGAED",104,0)
 .. F  S DGM=$O(MSG("DIERR",1,"TEXT",DGM)) Q:DGM=""  D
"RTN","DGREGAED",105,0)
 ... W $G(MSG("DIERR",1,"TEXT",DGM))
"RTN","DGREGAED",106,0)
 I $G(DGER)=0 W !,"Change saved."
"RTN","DGREGAED",107,0)
 D EOP
"RTN","DGREGAED",108,0)
 Q
"RTN","DGREGAED",109,0)
EOP ;End of page prompt
"RTN","DGREGAED",110,0)
 N DIR,DTOUT,DUOUT,DIROUT,X,Y
"RTN","DGREGAED",111,0)
 S DIR(0)="E"
"RTN","DGREGAED",112,0)
 S DIR("A")="Press ENTER to continue"
"RTN","DGREGAED",113,0)
 D ^DIR
"RTN","DGREGAED",114,0)
 Q
"RTN","DGREGAED",115,0)
UPCT ;Indicate "^" or "^^" are unacceptable inputs.
"RTN","DGREGAED",116,0)
 W !,"EXIT NOT ALLOWED ??"
"RTN","DGREGAED",117,0)
 Q
"RTN","DGREGAZL")
0^6^B39798425^B37170348
"RTN","DGREGAZL",1,0)
DGREGAZL ;ALB/DW - ZIP LINKING UTILITY ; 5/27/04 10:54am
"RTN","DGREGAZL",2,0)
 ;;5.3;Registration;**522,560,581,730**;Aug 13, 1993;Build 2
"RTN","DGREGAZL",3,0)
 ;
"RTN","DGREGAZL",4,0)
EN(RESULT,DFN) ;Let user edit zip+4, city, state, county based on zip-linking
"RTN","DGREGAZL",5,0)
 ; Output: RESULT(field#) = User Input External ^ Internal
"RTN","DGREGAZL",6,0)
 K RESULT
"RTN","DGREGAZL",7,0)
 N DGIND,DGTOT
"RTN","DGREGAZL",8,0)
 I $G(DFN)="" S RESULT=-1 Q
"RTN","DGREGAZL",9,0)
 N DGR,DGDFLT,DGALW,DGZIP,DGN
"RTN","DGREGAZL",10,0)
 S DGN=""
"RTN","DGREGAZL",11,0)
 I $$FOREIGN() D  Q
"RTN","DGREGAZL",12,0)
 . D FRGNEDT(.DGR,DFN)
"RTN","DGREGAZL",13,0)
 . I $G(DGR)=-1 S RESULT=-1 Q
"RTN","DGREGAZL",14,0)
 . F DGN=.1112,.114,.115,.117 S RESULT(DGN)=$G(DGR(DGN))
"RTN","DGREGAZL",15,0)
 S DGZIP=$$ZIP(DFN)
"RTN","DGREGAZL",16,0)
 I DGZIP=-1 S RESULT=-1 Q
"RTN","DGREGAZL",17,0)
 S RESULT(.1112)=DGZIP
"RTN","DGREGAZL",18,0)
 S DGIND=$$CITY(.DGR,DGZIP,DFN)
"RTN","DGREGAZL",19,0)
 I DGIND=$G(DGTOT)+1 S DGIND=""
"RTN","DGREGAZL",20,0)
 I $G(DGR)=-1 S RESULT=-1 Q
"RTN","DGREGAZL",21,0)
 S RESULT(.114)=$G(DGR)
"RTN","DGREGAZL",22,0)
 S DGALW=$$ALWEDT^DGREGDD1($G(DUZ),DGZIP)
"RTN","DGREGAZL",23,0)
 I DGALW=1 D
"RTN","DGREGAZL",24,0)
 . K DGR D STCNTY(.DGR,DGZIP,DFN,DGIND)
"RTN","DGREGAZL",25,0)
 . I $G(DGR)=-1 S RESULT=-1 Q
"RTN","DGREGAZL",26,0)
 . S RESULT(.115)=$G(DGR(.115))
"RTN","DGREGAZL",27,0)
 . S RESULT(.117)=$G(DGR(.117))
"RTN","DGREGAZL",28,0)
 I DGALW=0 D
"RTN","DGREGAZL",29,0)
 . I DGZIP'="" D LINK(.DGDFLT,DGZIP,1)
"RTN","DGREGAZL",30,0)
 . S RESULT(.115)=$G(DGDFLT(.115))
"RTN","DGREGAZL",31,0)
 . S RESULT(.117)=$G(DGDFLT(.117))
"RTN","DGREGAZL",32,0)
 Q
"RTN","DGREGAZL",33,0)
ZIP(DFN) ;Let user input zip+4
"RTN","DGREGAZL",34,0)
ZAGN N DIR,DTOUT,DUOUT,DIROUT,DGDATA
"RTN","DGREGAZL",35,0)
 S DIR(0)="2,.1112"
"RTN","DGREGAZL",36,0)
 S DA=DFN
"RTN","DGREGAZL",37,0)
 D ^DIR
"RTN","DGREGAZL",38,0)
 I $D(DTOUT) Q -1
"RTN","DGREGAZL",39,0)
 I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G ZAGN
"RTN","DGREGAZL",40,0)
 S DGZIP=$G(Y)
"RTN","DGREGAZL",41,0)
 ;allow bogus zip:
"RTN","DGREGAZL",42,0)
 I $D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) Q DGZIP
"RTN","DGREGAZL",43,0)
 I DGZIP="" Q DGZIP
"RTN","DGREGAZL",44,0)
 D POSTALB^XIPUTIL(DGZIP,.DGDATA)
"RTN","DGREGAZL",45,0)
  ;DG*730
"RTN","DGREGAZL",46,0)
 I $G(DGDATA(1,"CITY ABBREVIATION"))'="",$G(DGDATA(1,"CITY ABBREVIATION"))=$G(DGDATA(2,"CITY")) S DGDATA=1 K DGDATA(2)
"RTN","DGREGAZL",47,0)
 I $D(DGDATA("ERROR")) D  G ZAGN
"RTN","DGREGAZL",48,0)
 . W $C(7)," ??"
"RTN","DGREGAZL",49,0)
 Q DGZIP
"RTN","DGREGAZL",50,0)
CITY(RESULT,ZIP,DFN) ;Base on zip, let user input city(#.114)
"RTN","DGREGAZL",51,0)
 ; Input:
"RTN","DGREGAZL",52,0)
 ;   ZIP - user input zip for the patient primary address
"RTN","DGREGAZL",53,0)
 ;   DFN - Interal entry number of Patient File (#2)
"RTN","DGREGAZL",54,0)
 ; Output:RESULT=-1 (input error or times or ^ out) 
"RTN","DGREGAZL",55,0)
 ;        or    =user input city
"RTN","DGREGAZL",56,0)
 ;        Array index # of selected city.
"RTN","DGREGAZL",57,0)
 K RESULT
"RTN","DGREGAZL",58,0)
 N DGDATA,DIR,DA,Y,DTOUT,DUOUT,DIROUT,DGIND
"RTN","DGREGAZL",59,0)
 N DGCITY,DGST,DGCNTY,DGABRV,DGN,DGECH,DGSOC
"RTN","DGREGAZL",60,0)
 N DOLDCITY,DGSAME,DGELEVEN
"RTN","DGREGAZL",61,0)
 S DGIND=""
"RTN","DGREGAZL",62,0)
 D POSTALB^XIPUTIL(ZIP,.DGDATA)
"RTN","DGREGAZL",63,0)
 ;DG*730
"RTN","DGREGAZL",64,0)
 I $G(DGDATA(1,"CITY ABBREVIATION"))'="",$G(DGDATA(1,"CITY ABBREVIATION"))=$G(DGDATA(2,"CITY")) S DGDATA=1 K DGDATA(2)
"RTN","DGREGAZL",65,0)
 D FIELD^DID(2,.114,"N","LABEL","DGCITY")
"RTN","DGREGAZL",66,0)
 S DGN=""
"RTN","DGREGAZL",67,0)
 I '$D(DGDATA("ERROR")) D
"RTN","DGREGAZL",68,0)
 . S DOLDCITY=$$GET1^DIQ(2,DFN_",",.114)
"RTN","DGREGAZL",69,0)
 . S DGSAME=0
"RTN","DGREGAZL",70,0)
 . F  S DGN=$O(DGDATA(DGN)) Q:DGN=""  D
"RTN","DGREGAZL",71,0)
 .. S DGABRV=$G(DGDATA(DGN,"CITY ABBREVIATION"))
"RTN","DGREGAZL",72,0)
 .. I DOLDCITY'="",DGABRV=DOLDCITY S DGSAME=1
"RTN","DGREGAZL",73,0)
 .. I DGABRV="" S DGABRV=$P($G(DGDATA(DGN,"CITY")),"*",1)
"RTN","DGREGAZL",74,0)
 .. I DOLDCITY'="",DGABRV=DOLDCITY S DGSAME=1
"RTN","DGREGAZL",75,0)
 .. I $G(DGDATA(DGN,"CITY"))["*" S:DGABRV'="" DGABRV=DGABRV_"*"
"RTN","DGREGAZL",76,0)
 .. S DGECH=DGN_":"_DGABRV
"RTN","DGREGAZL",77,0)
 .. S DGSOC=$S($G(DGSOC)="":DGECH,1:DGSOC_";"_DGECH)
"RTN","DGREGAZL",78,0)
 .. S DGTOT=DGN
"RTN","DGREGAZL",79,0)
 .I 'DGSAME S DGELEVEN=$G(^DPT(DFN,.11)) D
"RTN","DGREGAZL",80,0)
 ..Q:$P(DGELEVEN,U,6)'=$G(DGDATA(DGTOT,"POSTAL CODE"))
"RTN","DGREGAZL",81,0)
 ..Q:$P(DGELEVEN,U,14)'="VAMC"
"RTN","DGREGAZL",82,0)
 ..Q:$P(DGELEVEN,U,15)'=$$GETSITE^DGMTU4($G(DUZ))
"RTN","DGREGAZL",83,0)
 ..Q:$P(DGELEVEN,U,17)'>.5
"RTN","DGREGAZL",84,0)
 ..S DGN=DGTOT+1,DGECH=DGN_":"_DOLDCITY,DGSOC=DGSOC_";"_DGECH
"RTN","DGREGAZL",85,0)
 .;
"RTN","DGREGAZL",86,0)
 . I $D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) D
"RTN","DGREGAZL",87,0)
 .. S DGSOC=$G(DGSOC)_";"_99_":"_"FREE TEXT"
"RTN","DGREGAZL",88,0)
 . S DIR(0)="SO^"_$G(DGSOC)
"RTN","DGREGAZL",89,0)
 . ;if zip '= zip on file, default = ""; else default=city on file
"RTN","DGREGAZL",90,0)
 . ;I ($G(DFN)'="")&($E(ZIP,1,5)=$$GET1^DIQ(2,DFN_",",.116)) D
"RTN","DGREGAZL",91,0)
 . S DIR("B")=$$GET1^DIQ(2,DFN_",",.114)
"RTN","DGREGAZL",92,0)
 . S DIR("A")=$G(DGCITY("LABEL"))
"RTN","DGREGAZL",93,0)
CAGN1 . D ^DIR
"RTN","DGREGAZL",94,0)
 . I $D(DTOUT) S RESULT=-1 Q
"RTN","DGREGAZL",95,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G CAGN1
"RTN","DGREGAZL",96,0)
 . S RESULT=$P($G(Y(0)),"*")
"RTN","DGREGAZL",97,0)
 . S DGIND=$G(Y)
"RTN","DGREGAZL",98,0)
 I ($G(Y)=99)!($D(DGDATA("ERROR"))) D
"RTN","DGREGAZL",99,0)
CAGN2 . I '$D(^XUSEC("EAS GMT COUNTY EDIT",+DUZ)) Q
"RTN","DGREGAZL",100,0)
 . N DIR,X,Y
"RTN","DGREGAZL",101,0)
 . S DIR(0)="2,.114"
"RTN","DGREGAZL",102,0)
 . S DA=DFN
"RTN","DGREGAZL",103,0)
 . D ^DIR
"RTN","DGREGAZL",104,0)
 . I $D(DTOUT) S RESULT=-1 Q
"RTN","DGREGAZL",105,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G CAGN2
"RTN","DGREGAZL",106,0)
 . S RESULT=$G(Y)
"RTN","DGREGAZL",107,0)
 I $L($G(RESULT))>15 S RESULT=$E(RESULT,1,15)
"RTN","DGREGAZL",108,0)
 Q DGIND
"RTN","DGREGAZL",109,0)
 ;
"RTN","DGREGAZL",110,0)
LINK(RESULT,ZIP,DGN) ;From zip, get the linked state,county
"RTN","DGREGAZL",111,0)
 K RESULT
"RTN","DGREGAZL",112,0)
 N DGDATA,CNTYIEN
"RTN","DGREGAZL",113,0)
 S CNTYIEN=""
"RTN","DGREGAZL",114,0)
 S DGN=$G(DGN)
"RTN","DGREGAZL",115,0)
 I (DGN="")&($$MLT^DGREGDD1(ZIP)) S DGN=1
"RTN","DGREGAZL",116,0)
 I (DGN=99)&($$MLT^DGREGDD1(ZIP)) S DGN=1
"RTN","DGREGAZL",117,0)
 I (DGN="")!(DGN=99) Q
"RTN","DGREGAZL",118,0)
 D POSTALB^XIPUTIL(ZIP,.DGDATA)
"RTN","DGREGAZL",119,0)
 S:$G(DGDATA(DGN,"STATE POINTER"))'="" CNTYIEN=$$FIND1^DIC(5.01,","_$G(DGDATA(DGN,"STATE POINTER"))_",","MOXQ",$E($G(DGDATA(DGN,"FIPS CODE")),3,5),"C")
"RTN","DGREGAZL",120,0)
 D:'CNTYIEN  ;could be duplicate county codes in subfile #5.01
"RTN","DGREGAZL",121,0)
 .Q:'$D(^DIC(5,+$G(DGDATA(DGN,"STATE POINTER")),1))
"RTN","DGREGAZL",122,0)
 .Q:$E($G(DGDATA(DGN,"FIPS CODE")),3,5)=""
"RTN","DGREGAZL",123,0)
 .S CNTYIEN=$O(^DIC(5,$G(DGDATA(DGN,"STATE POINTER")),1,"C",$E($G(DGDATA(DGN,"FIPS CODE")),3,5),""))
"RTN","DGREGAZL",124,0)
 S RESULT(.115)=$G(DGDATA(DGN,"STATE"))_U_$G(DGDATA(DGN,"STATE POINTER"))
"RTN","DGREGAZL",125,0)
 S RESULT(.117)=$G(DGDATA(DGN,"COUNTY"))_U_$G(CNTYIEN)_U_$E($G(DGDATA(DGN,"FIPS CODE")),3,5)
"RTN","DGREGAZL",126,0)
 Q
"RTN","DGREGAZL",127,0)
 ;
"RTN","DGREGAZL",128,0)
STCNTY(RESULT,ZIP,DFN,DGNUM) ;Based on zip,input state (#.115) and county (#.117)
"RTN","DGREGAZL",129,0)
 K RESULT
"RTN","DGREGAZL",130,0)
 S DGNUM=$G(DGNUM)
"RTN","DGREGAZL",131,0)
 N DGN,DGDFLT,DGST,POP,DIR,X,Y,DTOUT,DUOUT,DIROUT
"RTN","DGREGAZL",132,0)
 S POP=0
"RTN","DGREGAZL",133,0)
 D LINK(.DGDFLT,ZIP,DGNUM)
"RTN","DGREGAZL",134,0)
 F DGN=.115,.117 Q:POP  D
"RTN","DGREGAZL",135,0)
SCAGN . I DGN=.115 S DIR(0)=2_","_DGN
"RTN","DGREGAZL",136,0)
 . I ($G(DGST)="")&(DGN=.117) Q
"RTN","DGREGAZL",137,0)
 . I DGN=.117 S DIR(0)="POA^DIC(5,DGST,1,:AEMQ"
"RTN","DGREGAZL",138,0)
 . S DIR("B")=$P($G(DGDFLT(DGN)),U)
"RTN","DGREGAZL",139,0)
 . D ^DIR
"RTN","DGREGAZL",140,0)
 . I $D(DTOUT) S POP=1 Q
"RTN","DGREGAZL",141,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G SCAGN
"RTN","DGREGAZL",142,0)
 . S RESULT(DGN)=$P($G(Y),U,2)_U_$P($G(Y),U)
"RTN","DGREGAZL",143,0)
 . I DGN=.115 S DGST=$P($G(Y),U)
"RTN","DGREGAZL",144,0)
 . I DGN=.117 S RESULT(.117)=$$CNTY(DGST,$P($G(RESULT(.117)),U,2))
"RTN","DGREGAZL",145,0)
 I POP=1 S RESULT=-1
"RTN","DGREGAZL",146,0)
 Q
"RTN","DGREGAZL",147,0)
CNTY(DGST,DGCIEN) ;Return county name and code
"RTN","DGREGAZL",148,0)
 ;Input:state number and county IEN
"RTN","DGREGAZL",149,0)
 ;Output: CountyName^CountyIEN^CountyCode
"RTN","DGREGAZL",150,0)
 I ($G(DGST)="")!($G(DGCIEN)="") S RESULT=-1 Q RESULT
"RTN","DGREGAZL",151,0)
 N DGR,RESULT
"RTN","DGREGAZL",152,0)
 S DGR=$G(^DIC(5,DGST,1,DGCIEN,0))
"RTN","DGREGAZL",153,0)
 S RESULT=$P($G(DGR),U)_U_DGCIEN_U_$P($G(DGR),U,3)
"RTN","DGREGAZL",154,0)
 Q RESULT
"RTN","DGREGAZL",155,0)
FOREIGN() ;Manila (Philippines) doesn't need zip linking.
"RTN","DGREGAZL",156,0)
 ;Output: 1 - area need no zip linking
"RTN","DGREGAZL",157,0)
 ;        0 - zip-linking area
"RTN","DGREGAZL",158,0)
 I $$STA^XUAF4(+$$KSP^XUPARAM("INST"))=358 Q 1
"RTN","DGREGAZL",159,0)
 ;;;I $$STA^XUAF4(+$$KSP^XUPARAM("INST"))=500 Q 1 ;;HERE TEST
"RTN","DGREGAZL",160,0)
 Q 0
"RTN","DGREGAZL",161,0)
FRGNEDT(DGINPUT,DFN) ;Edit zip+4, city, state, county for no zip-linking area
"RTN","DGREGAZL",162,0)
 K DGINPUT
"RTN","DGREGAZL",163,0)
 N DGN,DIR,DTOUT,DUOUT,DIROUT,X,Y,POP,DGST
"RTN","DGREGAZL",164,0)
 S POP=0
"RTN","DGREGAZL",165,0)
 F DGN=.1112,.114,.115,.117 Q:POP  D
"RTN","DGREGAZL",166,0)
FAGN . I ($G(DGST)="")&(DGN=.117) Q
"RTN","DGREGAZL",167,0)
 . S DIR(0)=2_","_DGN
"RTN","DGREGAZL",168,0)
 . I DGN=.117 D
"RTN","DGREGAZL",169,0)
 .. S DIR(0)="POA^DIC(5,DGST,1,:AEMQ"
"RTN","DGREGAZL",170,0)
 .. S DIR("B")=$$GET1^DIQ(2,DFN_",",.117)
"RTN","DGREGAZL",171,0)
 . I DGN'=.117 S DA=DFN
"RTN","DGREGAZL",172,0)
 . D ^DIR
"RTN","DGREGAZL",173,0)
 . I $D(DTOUT) S POP=1 Q
"RTN","DGREGAZL",174,0)
 . I $D(DUOUT)!$D(DIROUT) D UPCT^DGREGAED G FAGN
"RTN","DGREGAZL",175,0)
 . I (DGN=.114)!(DGN=.1112) S DGINPUT(DGN)=$G(Y)
"RTN","DGREGAZL",176,0)
 . I (DGN=.115) D
"RTN","DGREGAZL",177,0)
 .. S DGST=$P($G(Y),U)
"RTN","DGREGAZL",178,0)
 .. I DGST=$$GET1^DIQ(2,DFN_",",.115,"I") D
"RTN","DGREGAZL",179,0)
 ... S DGINPUT(.115)=$$GET1^DIQ(2,DFN_",",.115)_U_DGST
"RTN","DGREGAZL",180,0)
 .. I DGST'=$$GET1^DIQ(2,DFN_",",.115,"I") D
"RTN","DGREGAZL",181,0)
 ... S DGINPUT(.115)=$P($G(Y(0)),U)_U_DGST
"RTN","DGREGAZL",182,0)
 . I DGN=.117 S DGINPUT(DGN)=$P($G(Y),U,2)_U_$P($G(Y),U)
"RTN","DGREGAZL",183,0)
 I POP=1 S RESULT=-1
"RTN","DGREGAZL",184,0)
 Q
"RTN","DGRPD1")
0^3^B5267286^B5093592
"RTN","DGRPD1",1,0)
DGRPD1 ;BPFO/JRC - PATIENT INQUIRY (NEW) ; 4/11/06 9:30am
"RTN","DGRPD1",2,0)
 ;;5.3;Registration;**703,730**;Aug 13, 1993;Build 2
"RTN","DGRPD1",3,0)
 Q
"RTN","DGRPD1",4,0)
EC ;display emergency contact information
"RTN","DGRPD1",5,0)
 N DGEC1,DGEC2
"RTN","DGRPD1",6,0)
 Q:'$G(DFN)
"RTN","DGRPD1",7,0)
 S VAOA("A")=1,VAROOT="DGEC1"  D OAD^VADPT ; Get Primary EC
"RTN","DGRPD1",8,0)
 S VAOA("A")=4,VAROOT="DGEC2"  D OAD^VADPT ; Get Secondary EC
"RTN","DGRPD1",9,0)
 I DGEC1(9)]"" D
"RTN","DGRPD1",10,0)
 . W !,"Emergency Contact Information:"
"RTN","DGRPD1",11,0)
 . ;Contacts name and realtionship
"RTN","DGRPD1",12,0)
 . W !?5,"E-Cont.: ",DGEC1(9)
"RTN","DGRPD1",13,0)
 . I DGEC2(9)]"" W ?40,"E2-Cont.: ",DGEC2(9)
"RTN","DGRPD1",14,0)
 . W !,"Relationship: ",DGEC1(10)
"RTN","DGRPD1",15,0)
 . I DGEC2(9)]"" W ?36,"Relationship: ",DGEC2(10)
"RTN","DGRPD1",16,0)
 . ;ECs address lines 1, 2 and 3
"RTN","DGRPD1",17,0)
 . I DGEC1(1)]"" W !?14,DGEC1(1)
"RTN","DGRPD1",18,0)
 . I DGEC1(1)']"",DGEC2(1)]"" W !
"RTN","DGRPD1",19,0)
 . I DGEC2(1)]"" W ?50,DGEC2(1)
"RTN","DGRPD1",20,0)
 . I DGEC1(2)]"" W !?14,DGEC1(2)
"RTN","DGRPD1",21,0)
 . I DGEC1(2)']"",DGEC2(2)]"" W !
"RTN","DGRPD1",22,0)
 . I DGEC2(2)]"" W ?50,DGEC2(2)
"RTN","DGRPD1",23,0)
 . I DGEC1(3)]"" W !?14,DGEC1(3)
"RTN","DGRPD1",24,0)
 . I DGEC1(3)']"",DGEC2(3)]"" W !
"RTN","DGRPD1",25,0)
 . I DGEC2(3)]"" W ?50,DGEC2(3)
"RTN","DGRPD1",26,0)
 . ;Emergency Contact 1 City, State an Zip+4
"RTN","DGRPD1",27,0)
 . I DGEC1(4)]"" D
"RTN","DGRPD1",28,0)
 . . W !?14,DGEC1(4)
"RTN","DGRPD1",29,0)
 . . I DGEC1(5)]"" W ", "_$$GET1^DIQ(5,+DGEC1(5),1)
"RTN","DGRPD1",30,0)
 . . W "  ",$P(DGEC1(11),"^",2)
"RTN","DGRPD1",31,0)
 . ;Emergency Contact 2 City State and Zip+4
"RTN","DGRPD1",32,0)
 . I DGEC2(4)]"" D
"RTN","DGRPD1",33,0)
 . . I DGEC1(4)']"" W !
"RTN","DGRPD1",34,0)
 . . W ?50,DGEC2(4)
"RTN","DGRPD1",35,0)
 . . I DGEC2(5)]"" W ", "_$$GET1^DIQ(5,+DGEC2(5),1)
"RTN","DGRPD1",36,0)
 . . W "  ",$P(DGEC2(11),"^",2)
"RTN","DGRPD1",37,0)
 .;Home and work phones
"RTN","DGRPD1",38,0)
 . W !,?7,"Phone: ",$S(DGEC1(8)]"":DGEC1(8),1:"UNSPECIFIED")
"RTN","DGRPD1",39,0)
 . I DGEC2(9)]"" W ?43,"Phone: ",$S(DGEC2(8)]"":DGEC2(8),1:"UNSPECIFIED")
"RTN","DGRPD1",40,0)
 . W !?2,"Work Phone: ",$S($P(^DPT(DFN,.33),U,11)]"":$P(^DPT(DFN,.33),U,11),1:"UNSPECIFIED")
"RTN","DGRPD1",41,0)
 . I DGEC2(9)]"" W ?38,"Work Phone: ",$S($P(^DPT(DFN,.331),U,11)]"":$P(^DPT(DFN,.331),U,11),1:"UNSPECIFIED")
"RTN","DGRPD1",42,0)
 D KVAR^VADPT
"RTN","DGRPD1",43,0)
 Q
"RTN","DGRPD1",44,0)
 ;
"RTN","DGRPD1",45,0)
CATDIS ;
"RTN","DGRPD1",46,0)
 ;displays catastrophic disabity review date if there is one
"RTN","DGRPD1",47,0)
 N DGCDIS
"RTN","DGRPD1",48,0)
 Q:'$G(DFN)
"RTN","DGRPD1",49,0)
 I $$GET^DGENCDA(DFN,.DGCDIS) D
"RTN","DGRPD1",50,0)
 .Q:'DGCDIS("REVDTE")
"RTN","DGRPD1",51,0)
 .W !!,"Catastrophically Disabled Review Date: ",$$FMTE^XLFDT(DGCDIS("REVDTE"),1)
"RTN","DGRPD1",52,0)
 Q
"RTN","DGRPD1",53,0)
 ;
"VER")
8.0^22.0
"BLD",7026,6)
^654
**END**
**END**
