Released PSO*7*132 SEQ #152
Extracted from mail message
**KIDS**:PSO*7.0*132^

**INSTALL NAME**
PSO*7.0*132
"BLD",4266,0)
PSO*7.0*132^OUTPATIENT PHARMACY^0^3040428^y
"BLD",4266,1,0)
^^11^11^3040421^^^^
"BLD",4266,1,1,0)
Joint Commission for Accreditation of Healthcare Organizations (JCAHO)
"BLD",4266,1,2,0)
requires that patients' use of OTC medications, Herbal supplements,
"BLD",4266,1,3,0)
medications prescribed by the VA but purchased by the patient at an
"BLD",4266,1,4,0)
outside pharmacy, and medications prescribed by providers outside the VA
"BLD",4266,1,5,0)
be documented in patients' medical records.  These four categories of
"BLD",4266,1,6,0)
medications will hereafter be referred to as Non-VA Meds. In September
"BLD",4266,1,7,0)
2002, a team with members from different applications was put together to
"BLD",4266,1,8,0)
come up with a national solution to address this requirement. The
"BLD",4266,1,9,0)
applications involved in this project are Computerized Patient Record
"BLD",4266,1,10,0)
System (CPRS), Outpatient Pharmacy, Pharmacy Data Management, Inpatient
"BLD",4266,1,11,0)
Medications and National Drug File (NDF).
"BLD",4266,4,0)
^9.64PA^55^1
"BLD",4266,4,55,0)
55
"BLD",4266,4,55,2,0)
^9.641^55.05^1
"BLD",4266,4,55,2,55.05,0)
NON-VA MEDS  (sub-file)
"BLD",4266,4,55,2,55.05,1,0)
^9.6411^^0
"BLD",4266,4,55,222)
y^n^p^^^^n^^n
"BLD",4266,4,55,224)

"BLD",4266,4,"APDD",55,55.05)

"BLD",4266,4,"B",55,55)

"BLD",4266,"ABPKG")
n
"BLD",4266,"KRN",0)
^9.67PA^8989.52^19
"BLD",4266,"KRN",.4,0)
.4
"BLD",4266,"KRN",.401,0)
.401
"BLD",4266,"KRN",.402,0)
.402
"BLD",4266,"KRN",.403,0)
.403
"BLD",4266,"KRN",.5,0)
.5
"BLD",4266,"KRN",.84,0)
.84
"BLD",4266,"KRN",3.6,0)
3.6
"BLD",4266,"KRN",3.8,0)
3.8
"BLD",4266,"KRN",9.2,0)
9.2
"BLD",4266,"KRN",9.8,0)
9.8
"BLD",4266,"KRN",9.8,"NM",0)
^9.68A^31^28
"BLD",4266,"KRN",9.8,"NM",2,0)
PSOPRF^^0^B36401491
"BLD",4266,"KRN",9.8,"NM",3,0)
PSOPOLY^^0^B40602112
"BLD",4266,"KRN",9.8,"NM",4,0)
PSOORUT1^^0^B58566993
"BLD",4266,"KRN",9.8,"NM",5,0)
PSOHCSUM^^0^B22645938
"BLD",4266,"KRN",9.8,"NM",6,0)
PSOORDRG^^0^B36756976
"BLD",4266,"KRN",9.8,"NM",7,0)
PSOORRL^^0^B54436001
"BLD",4266,"KRN",9.8,"NM",9,0)
PSOLMUTL^^0^B9393494
"BLD",4266,"KRN",9.8,"NM",10,0)
PSOHLNEW^^0^B73457870
"BLD",4266,"KRN",9.8,"NM",12,0)
PSOP^^0^B45598913
"BLD",4266,"KRN",9.8,"NM",13,0)
PSOBUILD^^0^B38788021
"BLD",4266,"KRN",9.8,"NM",14,0)
PSONVARP^^0^B23438977
"BLD",4266,"KRN",9.8,"NM",15,0)
PSODRDUP^^0^B44264471
"BLD",4266,"KRN",9.8,"NM",16,0)
PSODRDU1^^0^B48930048
"BLD",4266,"KRN",9.8,"NM",17,0)
PSOCPDUP^^0^B34178406
"BLD",4266,"KRN",9.8,"NM",18,0)
PSODGDGI^^0^B44455499
"BLD",4266,"KRN",9.8,"NM",19,0)
PSOP1^^0^B25203140
"BLD",4266,"KRN",9.8,"NM",20,0)
PSOP2^^0^B32288266
"BLD",4266,"KRN",9.8,"NM",21,0)
PSOSD1^^0^B47474708
"BLD",4266,"KRN",9.8,"NM",22,0)
PSOSD3^^0^B40259023
"BLD",4266,"KRN",9.8,"NM",23,0)
PSONVAR1^^0^B37613532
"BLD",4266,"KRN",9.8,"NM",24,0)
PSOORUT2^^0^B21833506
"BLD",4266,"KRN",9.8,"NM",25,0)
PSODSPL^^0^B19120882
"BLD",4266,"KRN",9.8,"NM",26,0)
PSONVNEW^^0^B27586427
"BLD",4266,"KRN",9.8,"NM",27,0)
PSOORRL1^^0^B23602588
"BLD",4266,"KRN",9.8,"NM",28,0)
PSOORUTL^^0^B41534579
"BLD",4266,"KRN",9.8,"NM",29,0)
PSOAUTOC^^0^B65584203
"BLD",4266,"KRN",9.8,"NM",30,0)
PSOCAN3^^0^B71491238
"BLD",4266,"KRN",9.8,"NM",31,0)
PSODRDU2^^0^B29471172
"BLD",4266,"KRN",9.8,"NM","B","PSOAUTOC",29)

"BLD",4266,"KRN",9.8,"NM","B","PSOBUILD",13)

"BLD",4266,"KRN",9.8,"NM","B","PSOCAN3",30)

"BLD",4266,"KRN",9.8,"NM","B","PSOCPDUP",17)

"BLD",4266,"KRN",9.8,"NM","B","PSODGDGI",18)

"BLD",4266,"KRN",9.8,"NM","B","PSODRDU1",16)

"BLD",4266,"KRN",9.8,"NM","B","PSODRDU2",31)

"BLD",4266,"KRN",9.8,"NM","B","PSODRDUP",15)

"BLD",4266,"KRN",9.8,"NM","B","PSODSPL",25)

"BLD",4266,"KRN",9.8,"NM","B","PSOHCSUM",5)

"BLD",4266,"KRN",9.8,"NM","B","PSOHLNEW",10)

"BLD",4266,"KRN",9.8,"NM","B","PSOLMUTL",9)

"BLD",4266,"KRN",9.8,"NM","B","PSONVAR1",23)

"BLD",4266,"KRN",9.8,"NM","B","PSONVARP",14)

"BLD",4266,"KRN",9.8,"NM","B","PSONVNEW",26)

"BLD",4266,"KRN",9.8,"NM","B","PSOORDRG",6)

"BLD",4266,"KRN",9.8,"NM","B","PSOORRL",7)

"BLD",4266,"KRN",9.8,"NM","B","PSOORRL1",27)

"BLD",4266,"KRN",9.8,"NM","B","PSOORUT1",4)

"BLD",4266,"KRN",9.8,"NM","B","PSOORUT2",24)

"BLD",4266,"KRN",9.8,"NM","B","PSOORUTL",28)

"BLD",4266,"KRN",9.8,"NM","B","PSOP",12)

"BLD",4266,"KRN",9.8,"NM","B","PSOP1",19)

"BLD",4266,"KRN",9.8,"NM","B","PSOP2",20)

"BLD",4266,"KRN",9.8,"NM","B","PSOPOLY",3)

"BLD",4266,"KRN",9.8,"NM","B","PSOPRF",2)

"BLD",4266,"KRN",9.8,"NM","B","PSOSD1",21)

"BLD",4266,"KRN",9.8,"NM","B","PSOSD3",22)

"BLD",4266,"KRN",19,0)
19
"BLD",4266,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",4266,"KRN",19,"NM",1,0)
PSO NON-VA MEDS USAGE REPORT^^0^
"BLD",4266,"KRN",19,"NM",2,0)
PSO OUTPUTS^^2
"BLD",4266,"KRN",19,"NM","B","PSO NON-VA MEDS USAGE REPORT",1)

"BLD",4266,"KRN",19,"NM","B","PSO OUTPUTS",2)

"BLD",4266,"KRN",19.1,0)
19.1
"BLD",4266,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4266,"KRN",101,0)
101
"BLD",4266,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",4266,"KRN",101,"NM",1,0)
PSO LM NON-VA MEDS RPT^^0
"BLD",4266,"KRN",101,"NM",2,0)
PSO LM HIDDEN OTHER^^2
"BLD",4266,"KRN",101,"NM","B","PSO LM HIDDEN OTHER",2)

"BLD",4266,"KRN",101,"NM","B","PSO LM NON-VA MEDS RPT",1)

"BLD",4266,"KRN",409.61,0)
409.61
"BLD",4266,"KRN",771,0)
771
"BLD",4266,"KRN",870,0)
870
"BLD",4266,"KRN",8989.51,0)
8989.51
"BLD",4266,"KRN",8989.52,0)
8989.52
"BLD",4266,"KRN",8994,0)
8994
"BLD",4266,"KRN","B",.4,.4)

"BLD",4266,"KRN","B",.401,.401)

"BLD",4266,"KRN","B",.402,.402)

"BLD",4266,"KRN","B",.403,.403)

"BLD",4266,"KRN","B",.5,.5)

"BLD",4266,"KRN","B",.84,.84)

"BLD",4266,"KRN","B",3.6,3.6)

"BLD",4266,"KRN","B",3.8,3.8)

"BLD",4266,"KRN","B",9.2,9.2)

"BLD",4266,"KRN","B",9.8,9.8)

"BLD",4266,"KRN","B",19,19)

"BLD",4266,"KRN","B",19.1,19.1)

"BLD",4266,"KRN","B",101,101)

"BLD",4266,"KRN","B",409.61,409.61)

"BLD",4266,"KRN","B",771,771)

"BLD",4266,"KRN","B",870,870)

"BLD",4266,"KRN","B",8989.51,8989.51)

"BLD",4266,"KRN","B",8989.52,8989.52)

"BLD",4266,"KRN","B",8994,8994)

"BLD",4266,"QUES",0)
^9.62^^
"BLD",4266,"REQB",0)
^9.611^14^12
"BLD",4266,"REQB",1,0)
PSO*7.0*119^2
"BLD",4266,"REQB",2,0)
PSO*7.0*130^2
"BLD",4266,"REQB",5,0)
PSO*7.0*99^2
"BLD",4266,"REQB",6,0)
PSO*7.0*134^2
"BLD",4266,"REQB",7,0)
PSO*7.0*144^2
"BLD",4266,"REQB",8,0)
PSO*7.0*131^2
"BLD",4266,"REQB",9,0)
PSO*7.0*103^2
"BLD",4266,"REQB",10,0)
PSO*7.0*98^2
"BLD",4266,"REQB",11,0)
PSO*7.0*110^2
"BLD",4266,"REQB",12,0)
PSO*7.0*28^2
"BLD",4266,"REQB",13,0)
PSO*7.0*19^2
"BLD",4266,"REQB",14,0)
PSO*7.0*146^2
"BLD",4266,"REQB","B","PSO*7.0*103",9)

"BLD",4266,"REQB","B","PSO*7.0*110",11)

"BLD",4266,"REQB","B","PSO*7.0*119",1)

"BLD",4266,"REQB","B","PSO*7.0*130",2)

"BLD",4266,"REQB","B","PSO*7.0*131",8)

"BLD",4266,"REQB","B","PSO*7.0*134",6)

"BLD",4266,"REQB","B","PSO*7.0*144",7)

"BLD",4266,"REQB","B","PSO*7.0*146",14)

"BLD",4266,"REQB","B","PSO*7.0*19",13)

"BLD",4266,"REQB","B","PSO*7.0*28",12)

"BLD",4266,"REQB","B","PSO*7.0*98",10)

"BLD",4266,"REQB","B","PSO*7.0*99",5)

"FIA",55)
PHARMACY PATIENT
"FIA",55,0)
^PS(55,
"FIA",55,0,0)
55P
"FIA",55,0,1)
y^n^p^^^^n^^n
"FIA",55,0,10)

"FIA",55,0,11)

"FIA",55,0,"RLRO")

"FIA",55,0,"VR")
7.0^PSO
"FIA",55,55)
1
"FIA",55,55,52.2)

"FIA",55,55.05)
0
"FIA",55,55.051)
0
"FIA",55,55.0511)
0
"FIA",55,55.052)
0
"FIA",55,55.514)
0
"KRN",19,254,-1)
2^2
"KRN",19,254,0)
PSO OUTPUTS^Output Reports^^M^11853^^^^^^^141
"KRN",19,254,10,0)
^19.01IP^23^23
"KRN",19,254,10,23,0)
12283
"KRN",19,254,10,23,"^")
PSO NON-VA MEDS USAGE REPORT
"KRN",19,254,10,"A6359",1)
Formulary Listing^461^^
"KRN",19,254,10,"A6359",2)
Alpha Drug List and Synonyms^462^^
"KRN",19,254,10,"A6359",3)
Drug List By Synonym^463^^
"KRN",19,254,10,"A6359",4)
Commonly Dispensed Drugs^464^^
"KRN",19,254,10,"A6359",5)
Inactive Drug List^465^^
"KRN",19,254,10,"A6359",6)
Non-Formulary List^466^^
"KRN",19,254,10,"A6359",7)
Narcotic Prescription List^467^^
"KRN",19,254,10,"A6359",8)
Cost Analysis Reports^1135^^
"KRN",19,254,10,"A6359",9)
Amis Report^481^^
"KRN",19,254,10,"A6359",10)
Prescriptions on Hold^487^^
"KRN",19,254,10,"A6359",11)
Action Profile^509^^
"KRN",19,254,"U")
OUTPUT REPORTS
"KRN",19,12283,-1)
0^1
"KRN",19,12283,0)
PSO NON-VA MEDS USAGE REPORT^Non-VA Meds Usage Report^^A^^^^^^^^OUTPATIENT PHARMACY^^1
"KRN",19,12283,1,0)
^19.06^1^1^3040107^^
"KRN",19,12283,1,1,0)
This option provides a list of Non-VA Medication taken by the veteran.
"KRN",19,12283,20)
D EN^PSONVARP
"KRN",19,12283,"U")
NON-VA MEDS USAGE REPORT
"KRN",101,3842,-1)
2^2
"KRN",101,3842,0)
PSO LM HIDDEN OTHER^Other OP Actions^^M^11881^^^^^^^141
"KRN",101,3842,10,0)
^101.01PA^4^4
"KRN",101,3842,10,4,0)
4889^NV^^
"KRN",101,3842,10,4,"^")
PSO LM NON-VA MEDS RPT
"KRN",101,4889,-1)
0^1
"KRN",101,4889,0)
PSO LM NON-VA MEDS RPT^Non-VA Meds Report^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,4889,15)
S VALMBCK="R"
"KRN",101,4889,20)
D FULL^VALM1 D HID^PSONVARP
"KRN",101,4889,99)
59541,30877
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
132^3040428^10000000013
"PKG",141,22,1,"PAH",1,1,0)
^^11^11^3040428
"PKG",141,22,1,"PAH",1,1,1,0)
Joint Commission for Accreditation of Healthcare Organizations (JCAHO)
"PKG",141,22,1,"PAH",1,1,2,0)
requires that patients' use of OTC medications, Herbal supplements,
"PKG",141,22,1,"PAH",1,1,3,0)
medications prescribed by the VA but purchased by the patient at an
"PKG",141,22,1,"PAH",1,1,4,0)
outside pharmacy, and medications prescribed by providers outside the VA
"PKG",141,22,1,"PAH",1,1,5,0)
be documented in patients' medical records.  These four categories of
"PKG",141,22,1,"PAH",1,1,6,0)
medications will hereafter be referred to as Non-VA Meds. In September
"PKG",141,22,1,"PAH",1,1,7,0)
2002, a team with members from different applications was put together to
"PKG",141,22,1,"PAH",1,1,8,0)
come up with a national solution to address this requirement. The
"PKG",141,22,1,"PAH",1,1,9,0)
applications involved in this project are Computerized Patient Record
"PKG",141,22,1,"PAH",1,1,10,0)
System (CPRS), Outpatient Pharmacy, Pharmacy Data Management, Inpatient
"PKG",141,22,1,"PAH",1,1,11,0)
Medications and National Drug File (NDF).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
28
"RTN","PSOAUTOC")
0^29^B65584203
"RTN","PSOAUTOC",1,0)
PSOAUTOC ;BIR/SAB - autocancel rxs on admission ;08/15/94
"RTN","PSOAUTOC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,24,30,36,88,146,132**;DEC 1997
"RTN","PSOAUTOC",3,0)
 ;External reference to File #59.7 supported by DBIA 694
"RTN","PSOAUTOC",4,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOAUTOC",5,0)
 ;External reference ^DPT(PSODFN,.1) supported by DBIA 10035
"RTN","PSOAUTOC",6,0)
 ;External reference ^DGPM("AMV1" supported by DBIA 2249
"RTN","PSOAUTOC",7,0)
 ;External reference ^DGPM("APTT1" supported by DBIA 2249
"RTN","PSOAUTOC",8,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOAUTOC",9,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOAUTOC",10,0)
AUTO I '$P(^PS(59.7,1,40.1),"^") W $C(7),!,"Autocancel System Parameter must be set to 'YES'",!,"before prescriptions are discontinued."
"RTN","PSOAUTOC",11,0)
 K %DT,DIC S DIC(0)="XZM",(DIE,DIC)="^DIC(19.2,",X="PSO AUTOCANCEL" D ^DIC
"RTN","PSOAUTOC",12,0)
 I +Y>0 D EDIT^XUTMOPT("PSO AUTOCANCEL") G EX
"RTN","PSOAUTOC",13,0)
 D RESCH^XUTMOPT("PSO AUTOCANCEL","","","24H","L"),EDIT^XUTMOPT("PSO AUTOCANCEL")
"RTN","PSOAUTOC",14,0)
EX K Y,C,D,D0,DI,DQ,DA,DIE,DR,DIC,X
"RTN","PSOAUTOC",15,0)
 Q
"RTN","PSOAUTOC",16,0)
TASK ;TaskMan entry point
"RTN","PSOAUTOC",17,0)
 G:'$P(^PS(59.7,1,40.1),"^") KILL S X="T-3" D ^%DT S PSOD2=Y,PSOD0=Y-.01,PSODL=Y+.3
"RTN","PSOAUTOC",18,0)
 S PSOD=PSOD0 F  S PSOD=$O(^DGPM("AMV1",PSOD)),PSODFN=0 Q:'PSOD!(PSOD>PSODL)  F PSODFN=0:0 S PSODFN=$O(^DGPM("AMV1",PSOD,PSODFN)) Q:'PSODFN  I $G(^DPT(PSODFN,.1))]"",$O(^PS(55,PSODFN,"P",0)),'$O(^DGPM("APTT1",PSODFN,PSOD)) D CAN
"RTN","PSOAUTOC",19,0)
 G KILL
"RTN","PSOAUTOC",20,0)
CAN ;discontinue Rxs
"RTN","PSOAUTOC",21,0)
 S DFN=PSODFN K VAIN D INP^VADPT I $P($G(VAIN(4)),"^"),$D(^PS(59.7,1,40.19,"B",$P($G(VAIN(4)),"^"))) Q
"RTN","PSOAUTOC",22,0)
 I $D(^PS(55,PSODFN,0)),$P($G(^PS(55,PSODFN,0)),U,6)'=2 D EN^PSOHLUP(PSODFN)
"RTN","PSOAUTOC",23,0)
 F PSORXJ=0:0 S PSORXJ=$O(^PS(55,PSODFN,"P",PSORXJ)) Q:'PSORXJ  I $D(^(PSORXJ,0)) S PSORX=^(0) D
"RTN","PSOAUTOC",24,0)
 .I $D(^PSRX(PSORX,0)) S PSO0=^(0),PSO2=$G(^(2)),STA=+^("STA") I STA<11,PSO2,$P(PSO2,"^",6)'<DT,$E(PSO2,1,7)'>PSOD2!(STA=16) D
"RTN","PSOAUTOC",25,0)
 ..S $P(^PSRX(PSORX,3),"^",5)=$P(^(3),"^"),$P(^("STA"),"^")=12
"RTN","PSOAUTOC",26,0)
 ..D CAN^PSOTPCAN(PSORX)
"RTN","PSOAUTOC",27,0)
 ..D FIL^PSOCAN3
"RTN","PSOAUTOC",28,0)
 ..;remove from hold
"RTN","PSOAUTOC",29,0)
 ..I $G(^PSRX(PSORX,"H"))]"" D
"RTN","PSOAUTOC",30,0)
 ...K:$P(^PSRX(PSORX,"H"),"^") ^PSRX("AH",$P(^PSRX(PSORX,"H"),"^"),PSORX) S ^PSRX(PSORX,"H")=""
"RTN","PSOAUTOC",31,0)
 ...I '$P($G(^PSRX(PSORX,2)),"^",2),$P($G(^(3)),"^") S $P(^PSRX(PSORX,2),"^",2)=$P(^(3),"^")
"RTN","PSOAUTOC",32,0)
 ..;Add activity record
"RTN","PSOAUTOC",33,0)
 ..S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(PSORX,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOAUTOC",34,0)
 ..S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(PSORX,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOAUTOC",35,0)
 ..D NOW^%DTC S ACNT=ACNT+1,^PSRX(PSORX,"A",0)="^52.3DA^"_ACNT_"^"_ACNT S ^PSRX(PSORX,"A",ACNT,0)=%_"^"_"C"_"^^"_RFCNT_"^"_"Auto Discontinued on Admission"
"RTN","PSOAUTOC",36,0)
 ..;delete from suspense
"RTN","PSOAUTOC",37,0)
 ..D:$O(^PS(52.5,"B",PSORX,0))
"RTN","PSOAUTOC",38,0)
 ...I $O(^PSRX(PSORX,1,0)) S DA=PSORX,SUSD=$P($G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),0)),"^",2) D:'$G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),"P")) REF^PSOCAN2
"RTN","PSOAUTOC",39,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)),DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOAUTOC",40,0)
 ..;remove from non-verified file
"RTN","PSOAUTOC",41,0)
 ..I $G(^PS(52.4,PSORX,0))]"" S DIK="^PS(52.4,",DA=PSORX D ^DIK K DIK
"RTN","PSOAUTOC",42,0)
 ..S STAT="OD",PHARMST="",COM="Auto Discontinued on Admission" D EN^PSOHLSN1(PSORX,STAT,PHARMST,COM,"A")
"RTN","PSOAUTOC",43,0)
 ;auto-dc pending orders
"RTN","PSOAUTOC",44,0)
 ;F PSOIORD=0:0 S PSOIORD=$O(^PS(52.41,"AOR",PSODFN,PSOIORD)) Q:'PSOIORD  F PSORD=0:0 S PSORD=$O(^PS(52.41,"AOR",PSODFN,PSOIORD,PSORD)) Q:'PSORD  D
"RTN","PSOAUTOC",45,0)
 ;.I $P(^PS(52.41,PSORD,0),"^",3)="RF" S DA=PSORD,DIK="^PS(52.41," D ^DIK K DA,DIK Q
"RTN","PSOAUTOC",46,0)
 ;.K ^PS(52.41,"AOR",PSODFN,PSOIORD,PSORD) S $P(^PS(52.41,PSORD,0),"^",3)="DC"
"RTN","PSOAUTOC",47,0)
 ;.D EN^PSOHLSN(+^PS(52.41,PSORD,0),"OC","Auto Canceled on Admission","A")
"RTN","PSOAUTOC",48,0)
 K PSORD,PSOIORD
"RTN","PSOAUTOC",49,0)
 Q
"RTN","PSOAUTOC",50,0)
KILL K %,%H,%T,ACNT,DA,DFN,DIRUT,DTOUT,PSO,PSO0,PSO2,PSOD,PSOD0,PSOD2,PSODFN,PSODL,PSORX,PSORXJ,PSOSD,RF,RFCNT,SUB,TM,TSKDT,VAIN,X,X1,X2,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PSOAUTOC",51,0)
 K ORD,PHARMST,STAT,COM S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOAUTOC",52,0)
 Q
"RTN","PSOAUTOC",53,0)
SETUP ;initialize nightly Rx cost compile job
"RTN","PSOAUTOC",54,0)
 K %DT,DIC,DTOUT S DIC(0)="XZM",DIC="^DIC(19.2,",X="PSO COSTDAY NIGHTJOB" D ^DIC
"RTN","PSOAUTOC",55,0)
 I +Y>0 D EDIT^XUTMOPT("PSO COSTDAY NIGHTJOB") G OUT
"RTN","PSOAUTOC",56,0)
 D RESCH^XUTMOPT("PSO COSTDAY NIGHTJOB","","","24H","L"),EDIT^XUTMOPT("PSO COSTDAY NIGHTJOB")
"RTN","PSOAUTOC",57,0)
OUT K Y,DIC,X,PSOTM,PSOOPTN,PSOPTN,%DT,DTOUT
"RTN","PSOAUTOC",58,0)
 Q
"RTN","PSOAUTOC",59,0)
 ;initialize management data compile job
"RTN","PSOAUTOC",60,0)
SETUP1 K %DT,DIC,DTOUT S DIC(0)="ZXM",DIC="^DIC(19.2,",X="PSO MGMT NIGHTLY COMPILE" D ^DIC
"RTN","PSOAUTOC",61,0)
 I +Y>0 D EDIT^XUTMOPT("PSO MGMT NIGHTLY COMPILE") G OUT
"RTN","PSOAUTOC",62,0)
 D RESCH^XUTMOPT("PSO MGMT NIGHTLY COMPILE","","","24H","L"),EDIT^XUTMOPT("PSO MGMT NIGHTLY COMPILE")
"RTN","PSOAUTOC",63,0)
 K Y,DIC,X,PSOTM,DIR,PSOOPTN,PSOPTN,%DT,DTOUT
"RTN","PSOAUTOC",64,0)
 Q
"RTN","PSOAUTOC",65,0)
APSOD(PSODFN) ;sends mail message that date of death has been deleted
"RTN","PSOAUTOC",66,0)
 I $G(PSODFN),$D(^PS(52.91,PSODFN,0)) D
"RTN","PSOAUTOC",67,0)
 .I $P(^PS(52.91,PSODFN,0),"^",3),$P(^(0),"^",4)=5 D
"RTN","PSOAUTOC",68,0)
 ..S $P(^PS(52.91,PSODFN,0),"^",3)="",$P(^PS(52.91,PSODFN,0),"^",4)=""
"RTN","PSOAUTOC",69,0)
 ..S ^PS(52.91,"AX",DT,PSODFN)=""
"RTN","PSOAUTOC",70,0)
 ..I $D(^PS(55,PSODFN,0)),$P($G(^PS(55,PSODFN,"PS")),"^")="" D
"RTN","PSOAUTOC",71,0)
 ...N PSORESPS,PSORESFG,PSORESF1 S PSORESFG=0 F PSORESPS=0:0 S PSORESPS=$O(^PS(53,PSORESPS)) Q:'PSORESPS!(PSORESFG)  D
"RTN","PSOAUTOC",72,0)
 ....S PSORESF1=$P($G(^PS(53,PSORESPS,0)),"^") S PSORESF1=$$UP^XLFSTR(PSORESF1) I PSORESF1="NON-VA" S $P(^PS(55,PSODFN,"PS"),"^")=PSORESPS,PSORESFG=1
"RTN","PSOAUTOC",73,0)
 N DI,DA,DR,DIE,DIC,X,Y
"RTN","PSOAUTOC",74,0)
 S ZTDTH=$H,ZTREQ="@",ZTSAVE("ZTREQ")="",ZTSAVE("PSODFN")="",ZTRTN="MAIL^PSOAUTOC",ZTDESC="Sends Mail Message that a Date of Death was Deleted",ZTIO="" D ^%ZTLOAD
"RTN","PSOAUTOC",75,0)
 Q
"RTN","PSOAUTOC",76,0)
MAIL ;builds mail message
"RTN","PSOAUTOC",77,0)
 S DIC=2,DA=PSODFN,DR=.351,DIQ="PTDOD" D EN^DIQ1 I PTDOD(2,DA,.351)]"" G EX1
"RTN","PSOAUTOC",78,0)
 K ^TMP("PSOHLD",$J),^TMP("PSOAD",$J),TOTRX,TOTPRX
"RTN","PSOAUTOC",79,0)
 F I=0:0 S I=$O(^PSRX("APSOD",PSODFN,I)) Q:'I  S TOTRX=$G(TOTRX)+1
"RTN","PSOAUTOC",80,0)
 F I=0:0 S I=$O(^PS(52.41,"APSOD",PSODFN,I)) Q:'I  S TOTPRX=$G(TOTPRX)+1
"RTN","PSOAUTOC",81,0)
 F I=0:0 S I=$O(^PS(55,PSODFN,"NVA","APSOD",I)) Q:'I  S TOTNVA=$G(TOTNVA)+1
"RTN","PSOAUTOC",82,0)
 K I Q:'$G(TOTRX)&('$G(TOTPRX))&('$G(TOTNVA))
"RTN","PSOAUTOC",83,0)
 S ENT=0,DFN=PSODFN D DEM^VADPT
"RTN","PSOAUTOC",84,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=$P(^DPT(PSODFN,0),"^")_" ID#: "_VA("PID")_" DOB: "_$P(VADM(3),"^",2)
"RTN","PSOAUTOC",85,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" " S Y=DT D DD^%DT
"RTN","PSOAUTOC",86,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="This patient had a Date of Death deleted on "_Y_"."
"RTN","PSOAUTOC",87,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="When a Date of Death is entered ALL active prescriptions, pending orders, and",ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Non-VA Meds are discontinued automatically. The following Outpatient"
"RTN","PSOAUTOC",88,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Prescriptions and/or Pending Orders should be reviewed for this patient using",ENT=ENT+1,^TMP("PSOAD",$J,ENT)="the Patient Prescription Processing option."
"RTN","PSOAUTOC",89,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" "
"RTN","PSOAUTOC",90,0)
 I $G(TOTRX) S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Total number of Prescriptions found for review is "_TOTRX D
"RTN","PSOAUTOC",91,0)
 .F I=0:0 S I=$O(^PSRX("APSOD",PSODFN,I)) Q:'I  S ^TMP("PSOHLD",$J,$P(^PSDRUG($P(^PSRX(I,0),"^",6),0),"^"),I)=I
"RTN","PSOAUTOC",92,0)
 .S DRG="" F  S DRG=$O(^TMP("PSOHLD",$J,DRG)) Q:DRG=""  F I=0:0 S I=$O(^TMP("PSOHLD",$J,DRG,I)) Q:'I  S RX=^TMP("PSOHLD",$J,DRG,I) D
"RTN","PSOAUTOC",93,0)
 ..S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Rx: "_$P(^PSRX(RX,0),"^")_"  Drug: "_DRG
"RTN","PSOAUTOC",94,0)
 N PSOLPI,PSOLPIX,PSOLPIST,PSOLPND
"RTN","PSOAUTOC",95,0)
 I $G(TOTPRX) S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" " D
"RTN","PSOAUTOC",96,0)
 .S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Total number of Pending Orders found and reinstated is "_TOTPRX
"RTN","PSOAUTOC",97,0)
 .F PSOLPI=0:0 S PSOLPI=$O(^PS(52.41,"APSOD",PSODFN,PSOLPI)) Q:'PSOLPI  D
"RTN","PSOAUTOC",98,0)
 ..S $P(^PS(52.41,PSOLPI,0),"^",3)=$P(^PS(52.41,PSOLPI,"DDSTA"),";"),^PS(52.41,"AOR",PSODFN,$P(^PS(52.41,PSOLPI,"DDSTA"),";",2),PSOLPI)=""
"RTN","PSOAUTOC",99,0)
 ..S PSOLPIX=$P($G(^PS(52.41,PSOLPI,0)),"^"),PSOLPIST=$P($G(^(0)),"^",3)
"RTN","PSOAUTOC",100,0)
 ..I PSOLPIX D
"RTN","PSOAUTOC",101,0)
 ...I PSOLPIST'="NW",PSOLPIST'="RNW",PSOLPIST'="RF" Q
"RTN","PSOAUTOC",102,0)
 ...;Reset remaining cross references
"RTN","PSOAUTOC",103,0)
 ...S PSOLPND=$G(^PS(52.41,PSOLPI,0))
"RTN","PSOAUTOC",104,0)
 ...I $P(PSOLPND,"^",12),$P(PSOLPND,"^",13) S ^PS(52.41,"ACL",$P(PSOLPND,"^",13),$P(PSOLPND,"^",12),PSOLPI)=""
"RTN","PSOAUTOC",105,0)
 ...I $P(^PS(52.41,PSOLPI,"INI"),"^"),$P(PSOLPND,"^",12) S ^PS(52.41,"AD",$P(PSOLPND,"^",12),$P(^PS(52.41,PSOLPI,"INI"),"^"),PSOLPI)=""
"RTN","PSOAUTOC",106,0)
 ...I PSOLPIST="RNW",$P(PSOLPND,"^",21) S ^PS(52.41,"AQ",$P(PSOLPND,"^",21),PSOLPI)=""
"RTN","PSOAUTOC",107,0)
 ...I PSOLPIST="RF" Q
"RTN","PSOAUTOC",108,0)
 ...;Update CPRS with Pending order information on new and renewals
"RTN","PSOAUTOC",109,0)
 ...D EN^PSOHLSN(PSOLPIX,"SC","IP")
"RTN","PSOAUTOC",110,0)
 ..K ^PS(52.41,"APSOD",PSODFN,PSOLPI),ORTYP
"RTN","PSOAUTOC",111,0)
 ..S ENT=ENT+1,ORTYP=$P(^PS(52.41,PSOLPI,0),"^",3)
"RTN","PSOAUTOC",112,0)
 ..S MED=$S($P(^PS(52.41,PSOLPI,0),"^",9):$P(^PSDRUG($P(^PS(52.41,PSOLPI,0),"^",9),0),"^"),1:$P(^PS(50.7,$P(^PS(52.41,PSOLPI,0),"^",8),0),"^"))
"RTN","PSOAUTOC",113,0)
 ..I $G(MED)']"" S MED="NO DRUG OR ORDERABLE ITEM FOUND"
"RTN","PSOAUTOC",114,0)
 ..S ^TMP("PSOAD",$J,ENT)=$S(ORTYP="RF":"Refill",ORTYP="RNW":"Renew",ORTYP="HD":"On Hold",1:"New")_" Order Request  -  "
"RTN","PSOAUTOC",115,0)
 ..S ^TMP("PSOAD",$J,ENT)=^TMP("PSOAD",$J,ENT)_"Medication: "_MED
"RTN","PSOAUTOC",116,0)
 I $G(TOTNVA) S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" " D
"RTN","PSOAUTOC",117,0)
 .N PSODD,MED,PSOOI,PSONVA,NVA S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Total number of Non-VA Med Orders found and reinstated is "_TOTNVA
"RTN","PSOAUTOC",118,0)
 .F NVA=0:0 S NVA=$O(^PS(55,PSODFN,"NVA","APSOD",NVA)) Q:'NVA  D
"RTN","PSOAUTOC",119,0)
 ..S PSOOI=$P(^PS(55,PSODFN,"NVA",NVA,0),"^"),PSODD=$P(^(0),"^",2),PLACER=$P(^(0),"^",8),LOCATION=$P(^(0),"^",12),DFN=PSODFN
"RTN","PSOAUTOC",120,0)
 ..S MED=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),1:$P(^PS(50.7,+PSOOI,0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,+PSOOI,0),"^",2),0),"^"))
"RTN","PSOAUTOC",121,0)
 ..S $P(^PS(55,PSODFN,"NVA",NVA,0),"^",6)="",$P(^(0),"^",7)="" K ^PS(55,PSODFN,"NVA","APSOD",NVA)
"RTN","PSOAUTOC",122,0)
 ..S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Non-VA "_MED,REIN=1,PSONVA=NVA D REIN^PSONVNEW
"RTN","PSOAUTOC",123,0)
 ..K PSOOI,PSODD,PLACER,LOCATION,MED,REIN
"RTN","PSOAUTOC",124,0)
 S XMDUZ=.5,XMSUB="Date of Death Deleted for "_$P(^DPT(PSODFN,0),"^")_" ("_VA("BID")_")",XMTEXT="^TMP(""PSOAD"",$J," N DIFROM
"RTN","PSOAUTOC",125,0)
 F I=0:0 S I=$O(^XUSEC("PSORPH",I)) Q:'I  S XMY(I)=""
"RTN","PSOAUTOC",126,0)
 D ^XMD
"RTN","PSOAUTOC",127,0)
EX1 K ^TMP("PSOHLD",$J),XMSUB,XMTEXT,XMY,XMDUZ,^TMP("PSOAD",$J),I,TOTRX,TOTPRX,PSODFN,ENT,ORTYP,X,Y,MED,RX,PTDOD
"RTN","PSOAUTOC",128,0)
 Q
"RTN","PSOBUILD")
0^13^B38788021
"RTN","PSOBUILD",1,0)
PSOBUILD ;IHS/DSD/JCM - BUILD ARRAY OF PATIENTS CURRENT MEDS  [ 07/15/96  5:25 PM ]
"RTN","PSOBUILD",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**23,82,119,132**;DEC 1997
"RTN","PSOBUILD",3,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOBUILD",4,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOBUILD",5,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOBUILD",6,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOBUILD",7,0)
 ; Input variables: PSODFN,DT,PSODTCUT
"RTN","PSOBUILD",8,0)
START N ORD K PSOSD I '$D(PSODFN)!('$D(DT)) G END
"RTN","PSOBUILD",9,0)
 D EOJ,INIT G:PSOQFLG END D BUILD
"RTN","PSOBUILD",10,0)
 S STA="ACTIVE^NON-VERIFIED^REFILL^HOLD^NON-VERIFIED^ACTIVE^^^^^^ACTIVE^DISCONTINUED^^DISCONTINUED^DISCONTINUED^HOLD"
"RTN","PSOBUILD",11,0)
 S DRG="" F I=0:0 S DRG=$O(PSOSD(DRG)) Q:DRG=""  I $G(PSOSD(DRG))]"" S PSOSD($P(STA,"^",$P(PSOSD(DRG),"^",2)+1),DRG)=PSOSD(DRG) D  K PSOSD(DRG)
"RTN","PSOBUILD",12,0)
 .S $P(PSOSD($P(STA,"^",$P(PSOSD(DRG),"^",2)+1),DRG),"^",9)=$G(^TMP("PS",$J,$P(STA,"^",$P(PSOSD(DRG),"^",2)+1),DRG))
"RTN","PSOBUILD",13,0)
 F PEN=0:0 S PEN=$O(^PS(52.41,"P",PSODFN,PEN)) Q:'PEN  S ORD=^PS(52.41,PEN,0),PSOOI=$P(ORD,"^",8),PSODD=+$P(ORD,"^",9) D:$P(ORD,"^",3)'="DC"&($P(ORD,"^",3)'="DE")&($P(ORD,"^",3)'="HD")
"RTN","PSOBUILD",14,0)
 .S DRG=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),+PSOOI&('PSODD):$P(^PS(50.7,+PSOOI,0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,+PSOOI,0),"^",2),0),"^"),1:"") Q:DRG']""
"RTN","PSOBUILD",15,0)
 .I $D(PSOSD("PENDING",DRG)) S DRG=DRG_"^"_PEN
"RTN","PSOBUILD",16,0)
 .S PSOSD("PENDING",DRG)="*****^17^Z^Z^"_$S(PSODD:$P(^PSDRUG(PSODD,0),"^",2),1:"")_"^"_$P(^PS(52.41,PEN,0),"^",11)_"^"_$S($G(^PSDRUG(PSODD,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:"")
"RTN","PSOBUILD",17,0)
 .S PSOSD("PENDING",DRG)=PSOSD("PENDING",DRG)_"^"_$P(ORD,"^",10)_"^"_$P(ORD,"^",6)_"^"_PEN_"^"_$S($G(PSODD):$G(PSODD),1:""),PSOSD=+$G(PSOSD)+1 K PSOOI,PSODD
"RTN","PSOBUILD",18,0)
 F NVA=0:0 S NVA=$O(^PS(55,PSODFN,"NVA",NVA)) Q:'NVA  S NON=^PS(55,PSODFN,"NVA",NVA,0) D:'$P(^PS(55,PSODFN,"NVA",NVA,0),"^",7)
"RTN","PSOBUILD",19,0)
 .S PSODD=$P(NON,"^",2),PSOOI=$P(NON,"^")
"RTN","PSOBUILD",20,0)
 .S DRG=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),+PSOOI&('PSODD):$P(^PS(50.7,+PSOOI,0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,+PSOOI,0),"^",2),0),"^"),1:"")
"RTN","PSOBUILD",21,0)
 .I $D(PSOSD("ZNONVA",DRG)) S DRG=DRG_"^"_NVA
"RTN","PSOBUILD",22,0)
 .S PSOSD("ZNONVA",DRG)="****^9^Z^Z^"_$S($P(NON,"^",2):$P(^PSDRUG($P(NON,"^",2),0),"^",2),1:"")_"^"_$P(NON,"^",3)_"^^"_$P(NON,"^",5)_"^"_$P(NON,"^",10)_"^"_NVA_"^"_$P(NON,"^",2)
"RTN","PSOBUILD",23,0)
 .I $P(NON,"^",2) S $P(PSOSD("ZNONVA",DRG),"^",7)=$S($G(^PSDRUG(PSODD,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:"")
"RTN","PSOBUILD",24,0)
 .S PSOSD=+$G(PSOSD)+1
"RTN","PSOBUILD",25,0)
END D EOJ
"RTN","PSOBUILD",26,0)
 Q
"RTN","PSOBUILD",27,0)
INIT ;
"RTN","PSOBUILD",28,0)
 K PSOSD,PSOMED S PSOQFLG=0,U="^",PSOBUILD("COUNT")=0 G:$D(PSODTCUT) INITX
"RTN","PSOBUILD",29,0)
 I '$D(^PS(53,"B","OUTPATIENT")) S PSOQFLG=1 G INITX
"RTN","PSOBUILD",30,0)
 S PSOX=$O(^PS(53,"B","OUTPATIENT","")) I 'PSOX S PSOQFLG=1 G INITX
"RTN","PSOBUILD",31,0)
 ;S DAYS=$S($D(DAYS360):360,1:45),X2=-$S($P($G(^PS(53,PSOX,0)),"^",3)+15>DAYS:$P($G(^(0)),"^",3)+15,1:DAYS),X1=DT D C^%DTC S PSODTCUT=X
"RTN","PSOBUILD",32,0)
 S X2=-120,X1=DT D C^%DTC S PSODTCUT=X
"RTN","PSOBUILD",33,0)
INITX K X,X1,X2,PSOX
"RTN","PSOBUILD",34,0)
 Q
"RTN","PSOBUILD",35,0)
 ;
"RTN","PSOBUILD",36,0)
BUILD ;build profiles
"RTN","PSOBUILD",37,0)
 F PSOEXPDT=(PSODTCUT-1):0 S PSOEXPDT=$O(^PS(55,PSODFN,"P","A",PSOEXPDT)) Q:'PSOEXPDT  F PSOBUILD("RX")=0:0 S PSOBUILD("RX")=$O(^PS(55,PSODFN,"P","A",PSOEXPDT,PSOBUILD("RX"))) Q:'PSOBUILD("RX")  I $D(^PSRX(PSOBUILD("RX"),0)) D GET
"RTN","PSOBUILD",38,0)
BUILDX I PSOBUILD("COUNT")>0 S PSOSD=PSOBUILD("COUNT")
"RTN","PSOBUILD",39,0)
 Q
"RTN","PSOBUILD",40,0)
GET ;data for profiles
"RTN","PSOBUILD",41,0)
 Q:'$P(^PSRX(PSOBUILD("RX"),0),"^",2)
"RTN","PSOBUILD",42,0)
 S (PSOSTF,PSOSTN)="",PSORX0=^PSRX(PSOBUILD("RX"),0),PSOST0=+^PSRX(PSOBUILD("RX"),"STA"),$P(PSORX0,"^",15)=PSOST0
"RTN","PSOBUILD",43,0)
 G:PSOST0=13 GETX S PSORX2=$G(^PSRX(PSOBUILD("RX"),2))
"RTN","PSOBUILD",44,0)
 S PSORX3=$G(^PSRX(PSOBUILD("RX"),3)) S:PSORX3="" PSORX3=$P(PSORX2,"^",2)
"RTN","PSOBUILD",45,0)
 S PSODRG=+$P(PSORX0,"^",6) G:'$D(^PSDRUG(PSODRG,0)) GETX S PSODRUG0=^PSDRUG(PSODRG,0),PSOVACL=$P(PSODRUG0,"^",2),PSODYS=$P(PSORX0,"^",8)
"RTN","PSOBUILD",46,0)
 ;
"RTN","PSOBUILD",47,0)
 I PSOST0<12,PSOEXPDT<DT D:$P(PSORX0,"^",15)'=11
"RTN","PSOBUILD",48,0)
 .S PSOST0=11,$P(PSORX0,"^",15)=11 N DIE,DIC,DR,DA S DIE=52,DA=PSOBUILD("RX"),DR="100////11" D ^DIE K DIE,DIC,DR
"RTN","PSOBUILD",49,0)
 .S STAT="SC",PHARMST="ZE",COMM="Medication Expired on "_$E(PSOEXPDT,4,5)_"/"_$E(PSOEXPDT,6,7)_"/"_$E(PSOEXPDT,2,3) D EN^PSOHLSN1(DA,STAT,PHARMST,COMM) K COMM,STAT,PHARMST
"RTN","PSOBUILD",50,0)
 .D ECAN^PSOUTL(DA) K DA
"RTN","PSOBUILD",51,0)
 I PSOST0=12,PSOEXPDT<DT S PSOST0=12
"RTN","PSOBUILD",52,0)
 I PSOST0=5 D  G GT1
"RTN","PSOBUILD",53,0)
 .I $O(^PS(52.5,"B",PSOBUILD("RX"),0)),'$D(^PS(52.5,+$O(^(0)),0)) D  Q
"RTN","PSOBUILD",54,0)
 ..S PSOST0=0 D FSTA
"RTN","PSOBUILD",55,0)
 ..K ^PS(52.5,"B",PSOBUILD("RX"),$O(^PS(52.5,"B",PSOBUILD("RX"),0)))
"RTN","PSOBUILD",56,0)
 .I '$O(^PS(52.5,"B",PSOBUILD("RX"),0)) S PSOST0=0 D FSTA
"RTN","PSOBUILD",57,0)
 I 'PSOST0 D STAT
"RTN","PSOBUILD",58,0)
GT1 G GETX:$D(NOEXP)&(PSOST0=11)
"RTN","PSOBUILD",59,0)
 I $D(^PSDRUG(PSODRG,"I")),^("I")]"",DT>^("I") S PSOSTN=PSOSTN_"A" I $P($G(PSOPAR),"^",11)']"" S PSOSTF=PSOSTF_"A"
"RTN","PSOBUILD",60,0)
 S PSONDF=$S($G(^PSDRUG(PSODRG,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOBUILD",61,0)
 I $P($G(^PSDRUG(PSODRG,2)),"^",3)'["O" S PSOSTN=PSOSTN_"M"
"RTN","PSOBUILD",62,0)
 S CLOZPT=$S($P($G(^PSDRUG(PSODRG,"CLOZ1")),"^")="PSOCLO1":1,1:0)
"RTN","PSOBUILD",63,0)
 I 'CLOZPT,$P(PSODRUG0,"^",3)["A",$P(PSODRUG0,"^",3)'["B" S PSOSTN=PSOSTN_"B",PSOSTF=PSOSTF_"B"
"RTN","PSOBUILD",64,0)
 K CLOZPT I $P(PSODRUG0,"^",3)["W" S PSOSTN=PSOSTN_"C"
"RTN","PSOBUILD",65,0)
 I $D(^PS(53,+$P(PSORX0,"^",3),0)),'$P(^(0),"^",5) S PSOSTN=PSOSTN_"D"
"RTN","PSOBUILD",66,0)
 I PSOST0=1 S PSOSTN=PSOSTN_"E"
"RTN","PSOBUILD",67,0)
 S PSOLC=$P(PSORX0,"^"),PSOLC=$E(PSOLC,$L(PSOLC)) I $A(PSOLC)>90 S PSOSTN=PSOSTN_"F"
"RTN","PSOBUILD",68,0)
 I PSOST0,PSOST0'=2,PSOST0'=6 S PSOSTF=PSOSTF_"Z"
"RTN","PSOBUILD",69,0)
 I $G(PSORX("BAR CODE")),PSOST0,PSOST0'=2,PSOST0'=5,PSOST0'=6,PSOST0'=11,PSOST0'=12 S PSOSTN=PSOSTN_"Z" G BARC
"RTN","PSOBUILD",70,0)
 I PSOST0,PSOST0'=2,PSOST0'=5,PSOST0'=6,PSOST0'=11,PSOST0'=12,PSOST0'=14 S PSOSTN=PSOSTN_"Z"
"RTN","PSOBUILD",71,0)
BARC S PSORFRM=$P(PSORX0,"^",9) F PSOJ=0:0 S PSOJ=$O(^PSRX(PSOBUILD("RX"),1,PSOJ)) Q:'PSOJ  S PSORFRM=PSORFRM-1
"RTN","PSOBUILD",72,0)
 S:PSORFRM<0 PSORFRM=0 S:PSORFRM=0 PSOSTF=PSOSTF_"G"
"RTN","PSOBUILD",73,0)
 S PSODRUGN=$P(PSODRUG0,"^") I $D(PSOSD(PSODRUGN)),PSOST0>10 Q:$P(PSOSD(PSODRUGN),"^",2)<11  Q:$P(PSOSD(PSODRUGN),"^",2)>10&($P(PSORX0,"^",13)<$P(^PSRX(+$P(PSOSD(PSODRUGN),"^"),0),"^",13))
"RTN","PSOBUILD",74,0)
 S:'$D(PSOSD(PSODRUGN)) PSOBUILD("COUNT")=PSOBUILD("COUNT")+1
"RTN","PSOBUILD",75,0)
 I $D(PSOSD(PSODRUGN)),$P(PSOSD(PSODRUGN),"^",2)<10,PSOST0<10 S PSOSD(PSODRUGN_"^"_PSOBUILD("RX"))=PSOBUILD("RX")_"^"_PSOST0_"^"_PSOSTN_"^"_PSOSTF_"^"_PSOVACL_"^"_PSORFRM_"^"_PSONDF_"^"_PSODYS,PSOBUILD("COUNT")=PSOBUILD("COUNT")+1
"RTN","PSOBUILD",76,0)
 E  S PSOSD(PSODRUGN)=PSOBUILD("RX")_"^"_PSOST0_"^"_PSOSTN_"^"_PSOSTF_"^"_PSOVACL_"^"_PSORFRM_"^"_PSONDF_"^"_PSODYS
"RTN","PSOBUILD",77,0)
GETX Q
"RTN","PSOBUILD",78,0)
STAT N X S X=+$O(^PS(52.5,"B",PSOBUILD("RX"),0))
"RTN","PSOBUILD",79,0)
 I X,$D(^PS(52.5,X,0)),$P($G(^PS(52.5,X,0)),"^",7)'="X",'$G(^PS(52.5,X,"P")) S PSOST0=5
"RTN","PSOBUILD",80,0)
 I PSOST0 D FSTA
"RTN","PSOBUILD",81,0)
 Q
"RTN","PSOBUILD",82,0)
FSTA S $P(PSORX0,"^",15)=PSOST0
"RTN","PSOBUILD",83,0)
 N DIE,DR,DA S DIE=52,DA=PSOBUILD("RX"),DR="100////"_PSOST0 D ^DIE K DIE,DR,DA
"RTN","PSOBUILD",84,0)
 Q
"RTN","PSOBUILD",85,0)
 ;
"RTN","PSOBUILD",86,0)
EOJ K ORD,PSOX,PSOEXPDT,PSODRG,PSODRUG0,PSOLC,PSONDF,PSOQFLG,PSORFRM,PSORX0,PSORX2,PSORX3,PSOST0,PSOSTF,PSOSTN,PSOJ,PSODRUGN,PSOVACL,PSOBUILD,PSODYS,PEN,DRG,NON,NVA
"RTN","PSOBUILD",87,0)
 Q
"RTN","PSOBUILD",88,0)
INPAT(PSODFN) ;entry point for inpat meds to view patient's outpat. meds
"RTN","PSOBUILD",89,0)
 D FULL^VALM1
"RTN","PSOBUILD",90,0)
 S INPAT=1,X2=-120,X1=DT D C^%DTC S PSODTCUT=X D START,^PSODSPL
"RTN","PSOBUILD",91,0)
 K PSOSD,DDH,PSCNT,PSOCT,PSODD,PSOOI,PSOPAR,PSOSTA,STP,STR,PSODTCUT,PSODFN,INPAT,DRG
"RTN","PSOBUILD",92,0)
 Q
"RTN","PSOCAN3")
0^30^B71491238
"RTN","PSOCAN3",1,0)
PSOCAN3 ;BIR/RTR/SAB - auto dc rxs due to death ;2/5/97
"RTN","PSOCAN3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,24,27,32,36,94,88,117,131,146,139,132**;DEC 1997
"RTN","PSOCAN3",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOCAN3",4,0)
 ;External references to L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCAN3",5,0)
 Q
"RTN","PSOCAN3",6,0)
APSOD(PSODFN) ;called from file #2 death of death entry xref 'APOSD'
"RTN","PSOCAN3",7,0)
 N D,DA,DB,DC,DE,DG,DH,DI,DIC,DIE,DIG,DIH,DIK,DIR,DIQ,DIU,DIV,DIW,DK,DL,DM,DP,DQ,DU,DV,DW,DR
"RTN","PSOCAN3",8,0)
 S PSODEATH=1 D CAN K PSODEATH
"RTN","PSOCAN3",9,0)
 Q
"RTN","PSOCAN3",10,0)
CAN ;discontinued rxs due to death
"RTN","PSOCAN3",11,0)
 I $G(PSODFN),$D(^PS(52.91,PSODFN,0)) D
"RTN","PSOCAN3",12,0)
 .I '$P($G(^PS(52.91,PSODFN,0)),"^",3)!($P($G(^(0)),"^",3)>DT) S $P(^PS(52.91,PSODFN,0),"^",3)=DT,$P(^PS(52.91,PSODFN,0),"^",4)=5,^PS(52.91,"AX",DT,PSODFN)="" D SET^PSOTPCAN(PSODFN)
"RTN","PSOCAN3",13,0)
 F PSORXJ=0:0 S PSORXJ=$O(^PS(55,PSODFN,"P",PSORXJ)) Q:'PSORXJ  I $D(^(PSORXJ,0)) S PSORX=^(0) S STA=$S($P($G(^PSRX(PSORX,"STA")),"^")<11:1,$P($G(^("STA")),"^")=16:1,1:0) D:STA
"RTN","PSOCAN3",14,0)
 .I $D(^PSRX(PSORX,0)),$P($G(^PSRX(PSORX,"STA")),"^")="" S $P(^PSRX(PSORX,"STA"),"^")=12 D CAN^PSOTPCAN(PSORX)
"RTN","PSOCAN3",15,0)
 .I $D(^PSRX(PSORX,0)),$P($G(^PSRX(PSORX,2)),"^",6)'<DT S PSO0=^(0),PSO2=$G(^(2)) D
"RTN","PSOCAN3",16,0)
 ..S ^PSRX(PSORX,"DDSTA")="52;"_$P(^PSRX(PSORX,"STA"),"^")
"RTN","PSOCAN3",17,0)
 ..;remove from hold
"RTN","PSOCAN3",18,0)
 ..I $G(^PSRX(PSORX,"H"))]"" D
"RTN","PSOCAN3",19,0)
 ...S ^PSRX(PSORX,"DDSTA")="52;"_$P(^PSRX(PSORX,"STA"),"^")_"^"_^PSRX(PSORX,"H")
"RTN","PSOCAN3",20,0)
 ...K:$P(^PSRX(PSORX,"H"),"^") ^PSRX("AH",$P(^PSRX(PSORX,"H"),"^"),PSORX) S ^PSRX(PSORX,"H")=""
"RTN","PSOCAN3",21,0)
 ...I '$P($G(^PSRX(PSORX,2)),"^",2),$P($G(^(3)),"^") S $P(^PSRX(PSORX,2),"^",2)=$P(^(3),"^")
"RTN","PSOCAN3",22,0)
 ...I $G(PSODEATH),$P(^PSRX(PSORX,0),"^",2) S ^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",23,0)
 ..;delete from non-verified file
"RTN","PSOCAN3",24,0)
 ..I $G(^PS(52.4,PSORX,0))]"" S ^PSRX(PSORX,"DDSTA")="52.4;"_$P(^PSRX(PSORX,"STA"),"^")_"^"_^PS(52.4,PSORX,0),DIK="^PS(52.4,",DA=PSORX D ^DIK K DIK
"RTN","PSOCAN3",25,0)
 ..I $G(PSODEATH),$P(^PSRX(PSORX,0),"^",2) S ^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",26,0)
 ..;delete from suspense
"RTN","PSOCAN3",27,0)
 ..D:$O(^PS(52.5,"B",PSORX,0))
"RTN","PSOCAN3",28,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)) I '$G(^PS(52.5,DA,"P")),$G(PSODEATH) S ^PSRX(PSORX,"DDSTA")="52.5;5^"_^PS(52.5,DA,0),^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",29,0)
 ...I $O(^PSRX(PSORX,1,0)),'$G(PSODEATH) S DA=PSORX,SUSD=$P($G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),0)),"^",2) D:'$G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),"P")) REF^PSOCAN2
"RTN","PSOCAN3",30,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)),DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOCAN3",31,0)
 ..S $P(^PSRX(PSORX,3),"^",5)=$P(^PSRX(PSORX,3),"^"),$P(^("STA"),"^")=12 D CAN^PSOTPCAN(PSORX)
"RTN","PSOCAN3",32,0)
 ..;activity record
"RTN","PSOCAN3",33,0)
 ..S (COM,ACOM)=$S($G(PSODEATH):"Date of Death Entered by MAS",1:"Discontinued by Pharmacy")_"."
"RTN","PSOCAN3",34,0)
 ..S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(PSORX,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOCAN3",35,0)
 ..S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(PSORX,1,RF)) Q:'RF  S RFCNT=RF
"RTN","PSOCAN3",36,0)
 ..D NOW^%DTC S ACNT=ACNT+1,^PSRX(PSORX,"A",0)="^52.3DA^"_ACNT_"^"_ACNT
"RTN","PSOCAN3",37,0)
 ..S ^PSRX(PSORX,"A",ACNT,0)=%_"^"_"C"_"^^"_RFCNT_"^"_"Auto Discontinued Due to Death. "_ACOM
"RTN","PSOCAN3",38,0)
 ..S STAT="OD",PHARMST="" D EN^PSOHLSN1(PSORX,STAT,PHARMST,COM,"A") K COMM,PHARMST,STAT
"RTN","PSOCAN3",39,0)
 ..;check for label/release/pending release
"RTN","PSOCAN3",40,0)
 ..D FIL
"RTN","PSOCAN3",41,0)
 ;dc pending orders
"RTN","PSOCAN3",42,0)
 F PDA=0:0 S PDA=$O(^PS(52.41,"P",PSODFN,PDA)) Q:'PDA  I $P(^PS(52.41,PDA,0),"^",3)'="DC"&($P(^(0),"^",3)'="DE") D
"RTN","PSOCAN3",43,0)
 .I $G(PSODEATH) D
"RTN","PSOCAN3",44,0)
 ..S ^PS(52.41,PDA,"DDSTA")=$P(^PS(52.41,PDA,0),"^",3)_";"_+$P($G(^PS(52.41,PDA,"INI")),"^"),^PS(52.41,"APSOD",PSODFN,PDA)=""
"RTN","PSOCAN3",45,0)
 ..S $P(^PS(52.41,PDA,4),"^")="Date of Death Entered by MAS."
"RTN","PSOCAN3",46,0)
 .S $P(^PS(52.41,PDA,0),"^",3)="DC"
"RTN","PSOCAN3",47,0)
 .K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,PDA,"INI")),"^"),PDA)
"RTN","PSOCAN3",48,0)
 .S COM=$S($G(PSODEATH):"Date of Death Entered by MAS.",1:""),PL=$P(^PS(52.41,PDA,0),"^"),$P(^(0),"^",3)="DC"
"RTN","PSOCAN3",49,0)
 .D EN^PSOHLSN(PL,"OC",COM,"A") K COM,PL
"RTN","PSOCAN3",50,0)
 ;dc non-va meds
"RTN","PSOCAN3",51,0)
 D APSOD^PSONVNEW
"RTN","PSOCAN3",52,0)
KILL K %,%H,%T,ACNT,DA,PDA,DIRUT,DTOUT,PSO,PSO0,PSO2,PSOD,PSOD0,PSODFN,PSODL,PSORX,PSORXJ,PSOSD,RF,RFCNT,SUB,TM,TSKDT,X,X1,X2,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PSOCAN3",53,0)
 D KVAR^VADPT S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOCAN3",54,0)
 Q
"RTN","PSOCAN3",55,0)
CAN1 Q:$G(DODR)
"RTN","PSOCAN3",56,0)
 S PSOMGDFN=$G(PSODFN) ; SAVE IN CASE CANCELING RX THAT WAS MERGED TO ANOTHER DFN
"RTN","PSOCAN3",57,0)
 I $G(^PSRX(DA,"H"))]"" D HLD^PSOCAN2
"RTN","PSOCAN3",58,0)
 S PSCANVAR=0,RXDA=DA,DA=$O(^PS(52.5,"B",DA,0)) I DA,'$G(^PS(52.5,DA,"P")) S PSCANVAR=1 D
"RTN","PSOCAN3",59,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOCAN3",60,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" while suspended. "_$G(COM)
"RTN","PSOCAN3",61,0)
 .S DIK="^PS(52.5," D ^DIK K DIK S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2)
"RTN","PSOCAN3",62,0)
 .D AREC^PSOCAN1 S DA=RXDA I $O(^PSRX(DA,1,0)) D REF^PSOCAN2
"RTN","PSOCAN3",63,0)
 I $G(REA)="C" S DA=$O(^PS(52.5,"B",RXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOCAN3",64,0)
 I 'PSCANVAR S:$D(SPCANC) ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" during Rx cancel.  "
"RTN","PSOCAN3",65,0)
ADD S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2) S:$G(PSOOPT)=3 REA="L"
"RTN","PSOCAN3",66,0)
 D:'$G(PSCANVAR) AREC^PSOCAN1 S:REA="L" REA="C" S:REA'="C" $P(^PSRX(DA,"STA"),"^")=0
"RTN","PSOCAN3",67,0)
 N PSOTPCNZ S PSOTPCNZ=0 I $P(^PSRX(DA,"STA"),"^")'=12 S PSOTPCNZ=1
"RTN","PSOCAN3",68,0)
 S:REA="C"&($P(^PSRX(DA,"STA"),"^")<12)!($P(^("STA"),"^")=16) $P(^PSRX(DA,"STA"),"^")=12 I $P($G(^PSRX(DA,"STA")),"^")=12,$G(PSOTPCNZ) D CAN^PSOTPCAN(DA)
"RTN","PSOCAN3",69,0)
 K PSOTPCNZ
"RTN","PSOCAN3",70,0)
 I REA="R" D
"RTN","PSOCAN3",71,0)
 .I $P(^PSRX(DA,3),"^",8) S $P(^PSRX(DA,3),"^",2)=$P(^PSRX(DA,3),"^",8),$P(^(3),"^",8)=""
"RTN","PSOCAN3",72,0)
 .I $P(^PSRX(DA,3),"^",5) S $P(^PSRX(DA,3),"^")=$P(^PSRX(DA,3),"^",5),$P(^(3),"^",5)=""
"RTN","PSOCAN3",73,0)
 I REA="C" D
"RTN","PSOCAN3",74,0)
 .S:'$P(^PSRX(DA,3),"^",5) $P(^PSRX(DA,3),"^",5)=$P(^(3),"^")
"RTN","PSOCAN3",75,0)
 .I $O(^PS(52.41,"ARF",DA,0)),'$O(^PS(52.41,"APSOD",PSODFN,0)) S HLDDA=DA,DA=$O(^PS(52.41,"ARF",DA,0)),DIK="^PS(52.41," D ^DIK S DA=HLDDA K HLDDA
"RTN","PSOCAN3",76,0)
 .;check for label/release/pending release
"RTN","PSOCAN3",77,0)
 .I $G(PSOOPT)'=3 D FILX
"RTN","PSOCAN3",78,0)
 S PSONOOR=$S($D(PSONOOR):PSONOOR,1:"D"),STAT=$S(REA="C":"OD",1:"SC"),PHARMST=$S(REA="C":"",1:"CM")
"RTN","PSOCAN3",79,0)
 S COM=$S(REA="C":$S($G(PSOOPT)=3&('$G(DUP)):"Renewed",1:"Discontinued")_" by Pharmacy",1:"Reinstated by Pharmacy")
"RTN","PSOCAN3",80,0)
 D EN^PSOHLSN1(DA,STAT,PHARMST,COM,$S($G(PSOOPT)=3&('$G(DUP)):"",1:PSONOOR)) K COM,STAT,PHARMST,PSCANVAR
"RTN","PSOCAN3",81,0)
 I REA="C" D
"RTN","PSOCAN3",82,0)
 .I $G(^PS(52.4,DA,0))]"" S PSCDA=DA,DIK="^PS(52.4," D ^DIK S DA=PSCDA K DIK,PSCDA
"RTN","PSOCAN3",83,0)
 I $G(PSOMGDFN)'="" S PSODFN=PSOMGDFN K PSOMGDFN
"RTN","PSOCAN3",84,0)
 Q:(REA="C")!('$P($G(PSOPAR),"^",2))!($P(^PSRX(DA,2),"^",10)]"")
"RTN","PSOCAN3",85,0)
 Q:$D(^XUSEC("PSORPH",DUZ))  S PSVC=$P(^PSRX(DA,0),"^",16) F JJ=0:0 S JJ=$O(^PS(55,PSODFN,"P",JJ)) Q:'JJ  I $D(^(JJ,0)),+^(0)=DA Q
"RTN","PSOCAN3",86,0)
 Q:'JJ  S PSRXIN=DA,DIC="^PS(52.4,",DLAYGO=52.4,(X,DINUM)=PSRXIN,DIC(0)="ML"
"RTN","PSOCAN3",87,0)
 S DIC("DR")="1////"_$G(PSODFN)_";2////"_DUZ_";4////"_DT
"RTN","PSOCAN3",88,0)
 K DD,DO D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM
"RTN","PSOCAN3",89,0)
 K DA,DIK S DA=PSRXIN K PSRXIN S $P(^PSRX(DA,"STA"),"^")=1
"RTN","PSOCAN3",90,0)
 W !,"Rx # "_$P(^PSRX(DA,0),"^")_" is still non-verified!"
"RTN","PSOCAN3",91,0)
 Q
"RTN","PSOCAN3",92,0)
OERR I '$D(^XUSEC("PSORPH",DUZ)),'$P($G(PSOPAR),"^",2) S VALMSG="Invalid Action Selection!",VALMBCK="" Q
"RTN","PSOCAN3",93,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSOCAN3",94,0)
 K PSOPLCK S PSOCANRD=+$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^",4),PSOCANRA=1
"RTN","PSOCAN3",95,0)
 I $P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^"),$P(^("STA"),"^")=1!($P(^("STA"),"^")=4) S:$G(SPEED) PSONOORS=$G(PSONOOR) D DEL^PSOCAN4 S:$G(PSONOORS)'="" PSONOOR=$G(PSONOORS) K PSONOORS D KCAN D ULP Q
"RTN","PSOCAN3",96,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D KCAN D ULP Q
"RTN","PSOCAN3",97,0)
 I '+^PSRX($P(PSOLST(ORN),"^",2),"OR1"),$P(^("STA"),"^")=12 S VALMSG="Rx Cannot be Reinstated.  No Orderable Item." D KCAN D ULP D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN3",98,0)
 I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12,$P($G(^("PKI")),"^") S VALMSG="Cannot be Reinstated - Digitally Signed" D KCAN D ULP D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN3",99,0)
 I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12 S PSOCANRZ=1
"RTN","PSOCAN3",100,0)
 D HLDHDR^PSOLMUTL S X=$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),PS=$S($P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^")=12:"Reinstate: ",1:"Discontinue: ")
"RTN","PSOCAN3",101,0)
 S POERR=1,DFNHLD=PSODFN,DA=$P(PSOLST(ORN),"^",2)
"RTN","PSOCAN3",102,0)
 D LMNO D:$P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12 RMP
"RTN","PSOCAN3",103,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOCAN3",104,0)
 K POERR,PSCAN,PSI,PSL S PSODFN=DFNHLD K DFNHLD D ULP
"RTN","PSOCAN3",105,0)
 D KCAN
"RTN","PSOCAN3",106,0)
 Q
"RTN","PSOCAN3",107,0)
 Q
"RTN","PSOCAN3",108,0)
ULP D UL^PSSLOCK(+$G(PSODFN))
"RTN","PSOCAN3",109,0)
 Q
"RTN","PSOCAN3",110,0)
 ;
"RTN","PSOCAN3",111,0)
LMNO ; Calls LMNO^PSOCAN
"RTN","PSOCAN3",112,0)
 N PSODFN,PSORX,RXN,RX0
"RTN","PSOCAN3",113,0)
 S PSPOP=0,RXNUM=X S PSODFN=+$P(^PSRX(DA,0),"^",2) D LMNO^PSOCAN
"RTN","PSOCAN3",114,0)
 Q
"RTN","PSOCAN3",115,0)
 ;
"RTN","PSOCAN3",116,0)
KCAN ;
"RTN","PSOCAN3",117,0)
 K PSOCANRA,PSOCANRC,PSOCANRD,PSOCANRN,PSOCANRP,PSOCANRZ,PSOMSG
"RTN","PSOCAN3",118,0)
 Q
"RTN","PSOCAN3",119,0)
 ;
"RTN","PSOCAN3",120,0)
KCAN1 ;
"RTN","PSOCAN3",121,0)
 K PSOCANRC,PSOCANRD,PSOCANRN,PSOCANRP,PSOCANRZ
"RTN","PSOCAN3",122,0)
 Q
"RTN","PSOCAN3",123,0)
 ;
"RTN","PSOCAN3",124,0)
RMP ;remove Rx if found in array PSORX("PSOL") (Label Queue)
"RTN","PSOCAN3",125,0)
 Q:'$D(PSORX("PSOL"))  S:'$G(DA) DA=$P(PSOLST(ORN),"^",2)
"RTN","PSOCAN3",126,0)
 N I,J,FND,ST1,ST2,ST3 S I=0
"RTN","PSOCAN3",127,0)
 F  S I=$O(PSORX("PSOL",I)) Q:'I  D
"RTN","PSOCAN3",128,0)
 . S ST1=PSORX("PSOL",I) Q:ST1'[(DA_",")
"RTN","PSOCAN3",129,0)
 . S ST3="",FND=0
"RTN","PSOCAN3",130,0)
 . F J=1:1 S ST2=$P(ST1,",",J) Q:'ST2  D
"RTN","PSOCAN3",131,0)
 . . I ST2=DA S FND=1 Q
"RTN","PSOCAN3",132,0)
 . . S ST3=ST3_$S('ST3:"",1:",")_ST2
"RTN","PSOCAN3",133,0)
 . I FND D
"RTN","PSOCAN3",134,0)
 . . S:ST3]"" PSORX("PSOL",I)=ST3_","
"RTN","PSOCAN3",135,0)
 . . K:ST3="" PSORX("PSOL",I)
"RTN","PSOCAN3",136,0)
 . . D:$D(BBRX(I)) RMB(I)
"RTN","PSOCAN3",137,0)
 Q
"RTN","PSOCAN3",138,0)
 ;
"RTN","PSOCAN3",139,0)
RMB(IDX) ;remove Rx if found in array BBRX() (Bingo Board)
"RTN","PSOCAN3",140,0)
 N ST4,ST5,ST6,K
"RTN","PSOCAN3",141,0)
 S ST4=BBRX(IDX) Q:ST4'[(DA_",")
"RTN","PSOCAN3",142,0)
 S ST6=""
"RTN","PSOCAN3",143,0)
 F K=1:1 S ST5=$P(ST4,",",K) Q:'ST5  D
"RTN","PSOCAN3",144,0)
 . S:ST5'=DA ST6=ST6_$S('ST6:"",1:",")_ST5
"RTN","PSOCAN3",145,0)
 . S:ST6]"" BBRX(IDX)=ST6_"," K:ST6="" BBRX(IDX)
"RTN","PSOCAN3",146,0)
 I '$D(BBRX) K BINGCRT
"RTN","PSOCAN3",147,0)
 Q
"RTN","PSOCAN3",148,0)
 ;
"RTN","PSOCAN3",149,0)
FIL Q:'$G(PSORX)
"RTN","PSOCAN3",150,0)
 S PSOFC=PSORX G FILC
"RTN","PSOCAN3",151,0)
FILX Q:'$G(DA)
"RTN","PSOCAN3",152,0)
 S PSOFC=DA
"RTN","PSOCAN3",153,0)
FILC ;
"RTN","PSOCAN3",154,0)
 N PFC,PSOFFLAG
"RTN","PSOCAN3",155,0)
 I $P($G(^PSRX(PSOFC,2)),"^",13) G FILQ
"RTN","PSOCAN3",156,0)
 S PSOFFLAG=0 F PFC=0:0 S PFC=$O(^PSRX(PSOFC,1,PFC)) Q:'PFC!(PSOFFLAG)  I $P($G(^PSRX(PSOFC,1,PFC,0)),"^",18) S PSOFFLAG=1
"RTN","PSOCAN3",157,0)
 I PSOFFLAG G FILQ
"RTN","PSOCAN3",158,0)
 F PFC=0:0 S PFC=$O(^PSRX(PSOFC,"L",PFC)) Q:'PFC!(PSOFFLAG)  I $D(^PSRX(PSOFC,"L",PFC,0)),'$P($G(^(0)),"^",5) S PSOFFLAG=1
"RTN","PSOCAN3",159,0)
 I PSOFFLAG G FILQ
"RTN","PSOCAN3",160,0)
 S PSOFCSUS=$O(^PS(52.5,"B",PSOFC,0))
"RTN","PSOCAN3",161,0)
 I $G(PSOFCSUS),$P($G(^PS(52.5,PSOFCSUS,0)),"^",7)="L"!($P($G(^(0)),"^",7)="X") G FILQ
"RTN","PSOCAN3",162,0)
 S $P(^PSRX(PSOFC,3),"^",8)=$P($G(^PSRX(PSOFC,3)),"^",2)
"RTN","PSOCAN3",163,0)
 S $P(^PSRX(PSOFC,3),"^",2)=$P($G(^PSRX(PSOFC,2)),"^",2)
"RTN","PSOCAN3",164,0)
 I $P($G(^PSRX(PSOFC,"OR1")),"^",3) S $P(^PSRX(PSOFC,3),"^")=$P($G(^PSRX($P(^PSRX(PSOFC,"OR1"),"^",3),3)),"^")
"RTN","PSOCAN3",165,0)
FILQ K PSOFC,PSOFCSUS
"RTN","PSOCAN3",166,0)
 Q
"RTN","PSOCPDUP")
0^17^B34178406
"RTN","PSOCPDUP",1,0)
PSOCPDUP ;BIR/SAB - Dup drug and class checker for copy orders ;2/13/96
"RTN","PSOCPDUP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,32,130,132**;DEC 1997
"RTN","PSOCPDUP",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCPDUP",4,0)
 S $P(PSONULN,"-",79)="-",(STA,DNM)=""
"RTN","PSOCPDUP",5,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DNM=$O(PSOSD(STA,DNM)) Q:DNM=""  D  Q:$G(PSORX("DFLG"))
"RTN","PSOCPDUP",6,0)
 .I STA="PENDING" D ^PSODRDU1 Q
"RTN","PSOCPDUP",7,0)
 .I STA="ZNONVA" D NVA^PSODRDU1 Q
"RTN","PSOCPDUP",8,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&('$D(^XUSEC("PSORPH",DUZ)))  Q:$G(PSORX("DFLG"))
"RTN","PSOCPDUP",9,0)
 ..I $P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSOCPDUP",10,0)
 ..I $P(PSOPAR,"^",2),'$P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSOCPDUP",11,0)
 ..I '$P(PSOPAR,"^",2),'$P($G(PSOPAR),"^",16) D DUP
"RTN","PSOCPDUP",12,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&($D(^XUSEC("PSORPH",DUZ))) DUP Q:$G(PSORX("DFLG"))
"RTN","PSOCPDUP",13,0)
 .I PSODRUG("VA CLASS")]"",$E(PSODRUG("VA CLASS"),1,4)=$E($P(PSOSD(STA,DNM),"^",5),1,4),PSODRUG("NAME")'=$P(DNM,"^") S PSOCPCLS=1 D CLS K PSOCPCLS
"RTN","PSOCPDUP",14,0)
 G EXIT
"RTN","PSOCPDUP",15,0)
DOSE ;I '$D(PSOCLOZ) G EXIT
"RTN","PSOCPDUP",16,0)
 S DIR(0)="N^12.5:3000:1",DIR("A")="CLOZAPINE dosage (mg/day) ? " D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) G EXIT
"RTN","PSOCPDUP",17,0)
 S PSOCD=X
"RTN","PSOCPDUP",18,0)
 I PSOCD#25=0,PSOCD'<12.5,PSOCD<900 S PSONEW("SAND")=PSOCD_"^"_$G(PSOLR)_"^"_$G(PSOLDT) G EXIT
"RTN","PSOCPDUP",19,0)
 I PSOCD#12.5 S DIR(0)="Y",DIR("B")="NO",DIR("A")=PSOCD_" is an unusual dose.  Are you sure " D ^DIR K DIR G EXIT:$D(DTOUT),EXIT:$D(DUOUT) I X'="Y" G DOSE
"RTN","PSOCPDUP",20,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" "
"RTN","PSOCPDUP",21,0)
 I PSOCD>900 S DIR(0)="Y",DIR("A")="Recommended maximum daily dose is 900. Are you sure " D ^DIR K DIR G EXIT:$D(DTOUT),EXIT:$D(DUOUT) I X'="Y" G DOSE
"RTN","PSOCPDUP",22,0)
 S PSONEW("SAND")=PSOCD_"^"_$G(PSOLR)_"^"_$G(PSOLDT)
"RTN","PSOCPDUP",23,0)
EXIT D ^PSOBUILD K CAN,DA,DIR,DNM,DUPRX0,ISSD,J,LSTFL,MSG,PHYS,PSOCLC,PSONULN,REA,RFLS,RX0,RX2,RXREC,ST,Y,ZZ,ACT,PSOCLOZ,PSOLR,PSOLDT,PSOCD,SIG
"RTN","PSOCPDUP",24,0)
 Q
"RTN","PSOCPDUP",25,0)
DUP S:$P(PSOSD(STA,DNM),"^",2)<10!($P(PSOSD(STA,DNM),"^",2)=16) DUP=1 W !,PSONULN,!,$C(7),"DUPLICATE DRUG "_$P(DNM,"^")_" in Prescription: ",$P(^PSRX(+PSOSD(STA,DNM),0),"^")
"RTN","PSOCPDUP",26,0)
 S RXREC=+PSOSD(STA,DNM),MSG="Discontinued During Prescription Entry COPY - Duplicate Drug"
"RTN","PSOCPDUP",27,0)
DATA S DUPRX0=^PSRX(RXREC,0),RFLS=$P(DUPRX0,"^",9),ISSD=$P(^PSRX(RXREC,0),"^",13),RX0=DUPRX0,RX2=^PSRX(RXREC,2),SIG=$P($G(^PSRX(RXREC,"SIG")),"^"),$P(RX0,"^",15)=+$G(^PSRX(RXREC,"STA"))
"RTN","PSOCPDUP",28,0)
 W !!,$J("Status: ",24) S J=RXREC D STAT^PSOFUNC W ST K RX0,RX2 W ?40,$J("Issued: ",24),$E(ISSD,4,5)_"/"_$E(ISSD,6,7)_"/"_$E(ISSD,2,3)
"RTN","PSOCPDUP",29,0)
 K FSIG,BSIG I $P($G(^PSRX(RXREC,"SIG")),"^",2) D FSIG^PSOUTLA("R",RXREC,54) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSOCPDUP",30,0)
 K FSIG,PSREV I '$P($G(^PSRX(RXREC,"SIG")),"^",2) D EN2^PSOUTLA1(RXREC,54)
"RTN","PSOCPDUP",31,0)
 W !,$J("SIG: ",24) W $G(BSIG(1))
"RTN","PSOCPDUP",32,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?24,$G(BSIG(PSREV))
"RTN","PSOCPDUP",33,0)
 K BSIG,PSREV
"RTN","PSOCPDUP",34,0)
 W !,$J("QTY: ",24)_$P(DUPRX0,"^",7),?40,$J("# of refills: ",24)_RFLS S PHYS=$S($D(^VA(200,+$P(DUPRX0,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOCPDUP",35,0)
 W !,$J("Provider: ",24)_PHYS,?40,$J("Refills remaining: ",24),RFLS-$S($D(^PSRX(RXREC,1,0)):$P(^(0),"^",4),1:0)
"RTN","PSOCPDUP",36,0)
 S LSTFL=+^PSRX(RXREC,3) W !?40,$J("Last filled on: ",24)_$E(LSTFL,4,5)_"/"_$E(LSTFL,6,7)_"/"_$E(LSTFL,2,3),!?40,$J("Days Supply: ",24)_$P(DUPRX0,"^",8)
"RTN","PSOCPDUP",37,0)
 W !,PSONULN,! I $P($G(^PS(53,+$P($G(PSORX("PATIENT STATUS")),"^"),0)),"^")["AUTH ABS",'$P(PSOPAR,"^",5) W !,"PATIENT ON AUTHORIZED ABSENSE!" Q
"RTN","PSOCPDUP",38,0)
ASKCAN I $P(PSOSD(STA,DNM),"^",2)>10,$P(PSOSD(STA,DNM),"^",2)'=16 Q
"RTN","PSOCPDUP",39,0)
 I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)),'$G(CLS) S PSORX("DFLG")=1 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR Q
"RTN","PSOCPDUP",40,0)
 I $P(PSOPAR,"^",2),'$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)),'$G(CLS) S PSORX("DFLG")=1 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR Q
"RTN","PSOCPDUP",41,0)
 I $P(PSOSD(STA,DNM),"^",2)=16,$G(DUP) W !!,"Prescription "_$S(+$G(PSOSD(STA,DNM)):$P($G(^PSRX(+$G(PSOSD(STA,DNM)),0)),"^")_" ",1:"")_"is on Provider Hold, it cannot be discontinued.",! D  Q
"RTN","PSOCPDUP",42,0)
 .S PSORX("DFLG")=1 K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DUP
"RTN","PSOCPDUP",43,0)
 I $G(PSOCPCLS),$G(RXRECCOP) D PSOL^PSSLOCK(RXRECCOP) I '$G(PSOMSG) D  K PSOMSG,DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSOCPDUP",44,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2) Q
"RTN","PSOCPDUP",45,0)
 .W !!,"Another person is editing Rx "_$P($G(^PSRX(RXRECCOP,0)),"^")
"RTN","PSOCPDUP",46,0)
 K PSOMSG S DIR("A")="Discontinue Rx # "_$P(^PSRX(+PSOSD(STA,DNM),0),"^"),DIR(0)="Y",DIR("?")="Enter Y to discontinue this Rx."
"RTN","PSOCPDUP",47,0)
 D ^DIR K DIR S DA=RXREC S ACT="Discontinued while entering new Rx"
"RTN","PSOCPDUP",48,0)
 I 'Y W $C(7)," -Prescription was not discontinued..." S:'$D(PSOCLC) PSOCLC=DUZ S MSG=ACT,REA="C" S:$G(DUP) PSORX("DFLG")=1 K DUP,CLS D  Q
"RTN","PSOCPDUP",49,0)
 .I $D(^TMP("PSORXDC",$J,RXREC,0)) K ^TMP("PSORXDC",$J,RXREC,0)
"RTN","PSOCPDUP",50,0)
 .D:$G(PSOCPCLS) ULRX
"RTN","PSOCPDUP",51,0)
 I $P(PSOSD(STA,DNM),"^",2)=16,$G(CLS) W !!,"Prescription "_$P($G(^PSRX(+$G(RXRECLOC),0)),"^")_" is on Provider Hold, it cannot be discontinued.",! D ULRX K CLS,DUP,RXRECLOC S PSORX("DFLG")=1 H 2 Q
"RTN","PSOCPDUP",52,0)
 S PSOCLC=DUZ,MSG=$S($G(MSG)]"":MSG,1:ACT_" During New Rx Entry - DUPLICATE RX"),REA="C"
"RTN","PSOCPDUP",53,0)
 W !!,"Duplicate "_$S($G(CLS):"Class",1:"Drug")_" will be discontinued after the acceptance of the new order.",!
"RTN","PSOCPDUP",54,0)
 S ^TMP("PSORXDC",$J,RXREC,0)="52^"_DA_"^"_MSG_"^"_REA_"^"_ACT_"^"_STA_"^"_DNM,PSONOOR="D"
"RTN","PSOCPDUP",55,0)
 K CLS,DUP,PSOCPCLS Q
"RTN","PSOCPDUP",56,0)
CLS K DUP S CLS=1,MSG="Discontinued During New Prescription Entry - Duplicate Class" W !,PSONULN
"RTN","PSOCPDUP",57,0)
 W !?5,$C(7),"*** SAME CLASS *** OF DRUG IN RX #"_$P(^PSRX(+PSOSD(STA,DNM),0),"^")_" FOR "_$P(DNM,"^"),!,"CLASS: "_PSODRUG("VA CLASS")
"RTN","PSOCPDUP",58,0)
 S CAN=$P(PSOSD(STA,DNM),"^",2)'<11!($P(PSOSD(STA,DNM),"^",2)=1) S (RXREC,RXRECCOP)=+PSOSD(STA,DNM) S PSOELSE=$P(PSOPAR,"^",10) I PSOELSE D DATA
"RTN","PSOCPDUP",59,0)
 I 'PSOELSE S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DTOUT,DUOUT,DIRUT
"RTN","PSOCPDUP",60,0)
 K PSOELSE,RXRECCOP Q
"RTN","PSOCPDUP",61,0)
ULRX ;
"RTN","PSOCPDUP",62,0)
 I '$G(RXRECCOP) Q
"RTN","PSOCPDUP",63,0)
 D PSOUL^PSSLOCK(RXRECCOP)
"RTN","PSOCPDUP",64,0)
 Q
"RTN","PSODGDGI")
0^18^B44455499
"RTN","PSODGDGI",1,0)
PSODGDGI ;BIR/SAB - drug drug interaction checker ;4/14/93
"RTN","PSODGDGI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,27,48,130,144,132**;DEC 1997
"RTN","PSODGDGI",3,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSODGDGI",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSODGDGI",5,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSODGDGI",6,0)
 ;External reference to DDIEX^PSNAPIS supported by DBIA 2574
"RTN","PSODGDGI",7,0)
 Q:$$DDIEX^PSNAPIS($P(PSODRUG("NDF"),"A"),$P(PSODRUG("NDF"),"A",2))
"RTN","PSODGDGI",8,0)
 S (CRIT,DRG,LSI,DGI,DGS,SER,SERS,STA)=""
"RTN","PSODGDGI",9,0)
 S STA=$O(PSOSD(STA)) Q:STA=""!($G(PSORX("DFLG")))  F  S DRG=$O(PSOSD(STA,DRG)) Q:DRG=""!($G(PSORX("DFLG")))  I $P(PSOSD(STA,DRG),"^",2)<10 D
"RTN","PSODGDGI",10,0)
 .Q:$P(PSOSD(STA,DRG),"^",7)']""
"RTN","PSODGDGI",11,0)
 .S NDF=$P(PSOSD(STA,DRG),"^",7),IT=$O(^PS(56,"APD",NDF,PSODRUG("NDF"),0)) I IT D
"RTN","PSODGDGI",12,0)
 ..Q:$$DDIEX^PSNAPIS($P(NDF,"A"),$P(NDF,"A",2))
"RTN","PSODGDGI",13,0)
 ..Q:$P(^PS(56,IT,0),"^",7)&($P(^PS(56,IT,0),"^",7)<DT)
"RTN","PSODGDGI",14,0)
 ..I STA="ZNONVA" S DNM=DRG D NVA^PSODRDU1 K DNM Q
"RTN","PSODGDGI",15,0)
 ..D BLD Q:+$G(PSORX("DFLG"))
"RTN","PSODGDGI",16,0)
 I '$D(^XUSEC("PSORPH",DUZ)),$G(DGI)]"" S:+CRIT PSONEW("STATUS")=4 W $C(7),!,"DRUG INTERACTON WITH RX #s: "_LSI,! K LSI,DRG,IT,NDF
"RTN","PSODGDGI",17,0)
 Q
"RTN","PSODGDGI",18,0)
TECH ;add tech entry to RX VERIFY file (#52.4)
"RTN","PSODGDGI",19,0)
 I +CRIT S PSODI=1,DIC="^PS(52.4,",DLAYGO=52.4,DIC(0)="L",(DINUM,X)=PSOX("IRXN"),DIC("DR")="1////"_PSODFN_";2////"_DUZ_";4///"_DT_";7///"_1_";7.1///"_SER_";7.2///"_DGI K DD,DO D FILE^DICN K DD,DO
"RTN","PSODGDGI",20,0)
 S:$G(DGS)'="" $P(^PSRX(PSOX("IRXN"),"DRI"),"^")=SERS,$P(^PSRX(PSOX("IRXN"),"DRI"),"^",2)=DGS  K PSODI,CRIT,DIC,DLAYGO,DINUM,DGI,DGS,SER,SERS Q
"RTN","PSODGDGI",21,0)
BLD I $D(^XUSEC("PSORPH",DUZ)) S PSORX("PHARM")=DUZ D PHARM Q
"RTN","PSODGDGI",22,0)
 S LSI=$P(^PSRX(+PSOSD(STA,DRG),0),"^")_"/"_$P(^PSDRUG($P(^(0),"^",6),0),"^")_","_LSI,DGI=$P(PSOSD(STA,DRG),"^")_","_DGI,SER=IT_","_SER I $P(PSOSD(STA,DRG),"^",9),$P(^PS(56,IT,0),"^",4)=1 S $P(^PSRX(+PSOSD(STA,DRG),"STA"),"^")=4
"RTN","PSODGDGI",23,0)
 I $P(^PS(56,IT,0),"^",4)=2 S SERS=IT_","_SERS,DGS=$P(PSOSD(STA,DRG),"^")_","_DGS
"RTN","PSODGDGI",24,0)
 S:$P(^PS(56,IT,0),"^",4)=1 CRIT=1 Q
"RTN","PSODGDGI",25,0)
PHARM ;pharmacist verification of drug interaction
"RTN","PSODGDGI",26,0)
 D PSOL^PSSLOCK($P(PSOSD(STA,DRG),"^")) I '$G(PSOMSG) D  K PSOMSG S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSODGDGI",27,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2) D  Q
"RTN","PSODGDGI",28,0)
 ..W !,"Rx: "_$P($G(^PSRX($P(PSOSD(STA,DRG),"^"),0)),"^")_"    Drug: "_$P($G(^PSDRUG(+$P($G(^(0)),"^",6),0)),"^")
"RTN","PSODGDGI",29,0)
 ..W !,"which interacts with the drug you are entering!",!
"RTN","PSODGDGI",30,0)
 .W !!,"Another person is editing Rx "_$P($G(^PSRX($P(PSOSD(STA,DRG),"^"),0)),"^")_",",!,"which interacts with the drug you are entering!",!
"RTN","PSODGDGI",31,0)
 S PSODGRLX=$P(PSOSD(STA,DRG),"^")
"RTN","PSODGDGI",32,0)
 S SER=^PS(56,IT,0),DIR("?",1)="Answer 'YES' if you DO want to "_$S($P(SER,"^",4)=1:"continue processing",1:"enter an intervention for")_" this medication,"
"RTN","PSODGDGI",33,0)
 S DIR("?")="       'NO' if you DON'T want to "_$S($P(SER,"^",4)=1:"continue processing",1:"enter an intervention for")_" this medication,"
"RTN","PSODGDGI",34,0)
 W $C(7),$C(7) S DIR("A",1)="***"_$S($P(SER,"^",4)=1:"CRITICAL",1:"SIGNIFICANT")_"*** "_"Drug Interaction with RX #"_$P(^PSRX($P(PSOSD(STA,DRG),"^"),0),"^"),DIR("A",2)="DRUG: "_$P(DRG,"^")
"RTN","PSODGDGI",35,0)
 S DIR(0)="SA^1:YES;0:NO",DIR("A")="Do you want to "_$S($P(SER,"^",4)=1:"Continue? ",1:"Intervene? "),DIR("B")="Y" D ^DIR
"RTN","PSODGDGI",36,0)
 I 'Y,$P(SER,"^",4)=1 S PSORX("DFLG")=1,DGI="" K DIR,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSODGDGI",37,0)
 I Y,$P(SER,"^",4)=1 S PSORX("INTERVENE")=1,DGI="" K DIR,DTOUT,DIRUT,DIROUT,DUOUT G CRI Q
"RTN","PSODGDGI",38,0)
 I 'Y,$P(SER,"^",4)=2 K DIR,DTOUT,DIRUT,DIROUT,DUOUT D ULRX Q
"RTN","PSODGDGI",39,0)
 I Y,$P(SER,"^",4)=2 S PSORX("INTERVENE")=2,DGI="" K DIR,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSODGDGI",40,0)
 D ULRX
"RTN","PSODGDGI",41,0)
 Q
"RTN","PSODGDGI",42,0)
CRI ;process new drug interactions entered by pharmacist
"RTN","PSODGDGI",43,0)
 K DIR G:$P(PSOSD(STA,DRG),"^",9) CRITN S DIR("A",1)="",DIR("A",2)="Do you want to Process medication",DIR("A")=PSODRUG("NAME")_": ",DIR(0)="SA^1:PROCESS;0:ABORT ORDER ENTRY",DIR("B")="P"
"RTN","PSODGDGI",44,0)
 S DIR("?",1)="Enter '1' or 'P' to Activate medication",DIR("?")="      '0' or 'A' to Abort Order Entry process" D ^DIR K X1,DIR I 'Y S PSORX("DFLG")=1,DGI="" K DTOUT,DIRUT,DIROUT,DUOUT,PSORX("INTERVENE") D ULRX Q
"RTN","PSODGDGI",45,0)
 I $P(SER,"^",4)=1 D
"RTN","PSODGDGI",46,0)
 .D SIG^XUSESIG I X1="" K PSORX("INTERVENE") S PSORX("DFLG")=1 Q
"RTN","PSODGDGI",47,0)
 .S PSORX("INTERVENE")=$P(SER,"^",4)
"RTN","PSODGDGI",48,0)
 K DUOUT,DTOUT,DIRUT,DIROUT D ULRX Q
"RTN","PSODGDGI",49,0)
CRITN ;process multiple new drug interactions
"RTN","PSODGDGI",50,0)
 K X1,DIR S DIR("A",1)="",DIR("A",2)="Do you want to: ",DIR("A",3)=" 1.  Delete NEW medication "_PSODRUG("NAME"),DIR("A",4)=" 2.  Cancel ACTIVE New Rx #"_$P(^PSRX($P(PSOSD(STA,DRG),"^"),0),"^")_" DRUG: "_$P(DRG,"^")
"RTN","PSODGDGI",51,0)
 S DIR("A",5)=" 3.  Delete 1 and Cancel 2",DIR("A")=" 4.  Continue ?: ",DIR(0)="SA^1:NEW MEDICATION;2:ACTIVE New Rx "_$P(DRG,"^")_";3:BOTH;4:CONTINUE"
"RTN","PSODGDGI",52,0)
 S DIR("?",1)="Enter '1' or 'N' to Delete New Medication and Dispense Rx #"_$P(^PSRX(+PSOSD(STA,DRG),0),"^")
"RTN","PSODGDGI",53,0)
 S DIR("?",2)="      '2' or 'A' to Cancel Active Rx #"_$P(^PSRX(+PSOSD(STA,DRG),0),"^")_" and Dispense New Rx"
"RTN","PSODGDGI",54,0)
 S DIR("?",3)="      '3' or 'B' to Delete 1 and Cancel 2",DIR("?")="      '4' or 'C' to do nothing to either Rx" D ^DIR K DIR
"RTN","PSODGDGI",55,0)
 I Y=1 S PSORX("DFLG")=1,DGI="",PSHLDDRG=PSODRUG("IEN") D  D ULRX Q
"RTN","PSODGDGI",56,0)
 .I $G(PSORXED) D  Q
"RTN","PSODGDGI",57,0)
 ..D NOOR^PSOCAN4 I $D(DIRUT) W $C(7)," ACTION NOT TAKEN!",! S PSORX("DFLG")=1 K PSORX("INTERVENE") Q
"RTN","PSODGDGI",58,0)
 ..S DA=$P(PSOLST(ORN),"^",2) D MESS,ENQ^PSORXDL,FULL^VALM1
"RTN","PSODGDGI",59,0)
 ..K PSOSD($P(PSOLST(ORN),"^",3),PSODRUG("NAME")),DTOUT,DIROUT,DIRUT,DUOUT S:$G(PSOSD) PSOSD=PSOSD-1 S ZONE=1
"RTN","PSODGDGI",60,0)
 .S PSODRUG("IEN")=$P(^PSRX($P(PSOSD(STA,DRG),"^"),0),"^",6) D FULL^VALM1,^PSORXI
"RTN","PSODGDGI",61,0)
 .S PSODRUG("IEN")=PSHLDDRG,VALMBCK="R"
"RTN","PSODGDGI",62,0)
 .K DTOUT,DIRUT,DIROUT,DUOUT,PSHLDDRG
"RTN","PSODGDGI",63,0)
 .I $G(OR0) D
"RTN","PSODGDGI",64,0)
 ..D NOOR^PSOCAN4 I $D(DIRUT) D  Q
"RTN","PSODGDGI",65,0)
 ...W $C(7)," ACTION NOT TAKEN!",! K PSORX("INTERVENE") S PSORX("DFLG")=1
"RTN","PSODGDGI",66,0)
 ..D DC^PSOORFI2
"RTN","PSODGDGI",67,0)
 I Y=2 S (DA,PSOHOLDA)=+PSOSD(STA,DRG) D  D ULRX Q
"RTN","PSODGDGI",68,0)
 .D NOOR^PSOCAN4 I $D(DIRUT) D  Q
"RTN","PSODGDGI",69,0)
 ..W $C(7)," ACTION NOT TAKEN!",! K PSORX("INTERVENE") S PSORX("DFLG")=1
"RTN","PSODGDGI",70,0)
 .D MESS,ENQ^PSORXDL
"RTN","PSODGDGI",71,0)
 .S DA=PSOHOLDA D FULL^VALM1,EN1^PSORXI(.DA),PPL
"RTN","PSODGDGI",72,0)
 .K PSOSD(STA,DRG),DTOUT,DIROUT,DIRUT,DUOUT,PSOHOLDA
"RTN","PSODGDGI",73,0)
 .S:$G(PSOSD) PSOSD=PSOSD-1 S VALMBCK="R"
"RTN","PSODGDGI",74,0)
 I Y=3 S (DA,PSOHOLDA)=+PSOSD(STA,DRG) D  S VALMBCK="R"
"RTN","PSODGDGI",75,0)
 .D NOOR^PSOCAN4 I $D(DIRUT) D  Q
"RTN","PSODGDGI",76,0)
 ..W $C(7)," ACTION NOT TAKEN!",! K PSORX("INTERVENE") S PSORX("DFLG")=1
"RTN","PSODGDGI",77,0)
 .S:$G(PSOSD) PSOSD=PSOSD-1 S PSORX("DFLG")=1 D MESS,ENQ^PSORXDL
"RTN","PSODGDGI",78,0)
 .I $G(OR0) D DC^PSOORFI2
"RTN","PSODGDGI",79,0)
 .S DA=PSOHOLDA D FULL^VALM1,EN1^PSORXI(.DA),PPL K PSOSD(STA,DRG),PSOHOLDA
"RTN","PSODGDGI",80,0)
 .I $G(PSORXED) D
"RTN","PSODGDGI",81,0)
 ..S DA=$P(PSOLST(ORN),"^",2) D MESS,ENQ^PSORXDL,FULL^VALM1
"RTN","PSODGDGI",82,0)
 ..K PSOSD($P(PSOLST(ORN),"^",3),PSODRUG("NAME")),DTOUT,DIROUT,DIRUT,DUOUT S:$G(PSOSD) PSOSD=PSOSD-1 S ZONE=1
"RTN","PSODGDGI",83,0)
 K DTOUT,DIROUT,DIRUT,DUOUT
"RTN","PSODGDGI",84,0)
 D ULRX
"RTN","PSODGDGI",85,0)
 Q
"RTN","PSODGDGI",86,0)
MESS W !!,"Canceling Rx: "_$P($G(^PSRX(DA,0)),"^")_"   "_"Drug: "_$P($G(^PSDRUG($P(^PSRX(DA,0),"^",6),0)),"^"),! Q
"RTN","PSODGDGI",87,0)
PPL F PSOSL=0:0 S PSOSL=$O(PSORX("PSOL",PSOSL)) Q:'PSOSL  S PSOX2=PSOSL
"RTN","PSODGDGI",88,0)
 I $G(PSOX2) D
"RTN","PSODGDGI",89,0)
 .F PSOSL=0:1:PSOX2 S PSOSL=$O(PSORX("PSOL",PSOSL)) Q:'PSOSL  F ENT=1:1:$L(PSORX("PSOL",PSOSL),",") I $P(PSORX("PSOL",PSOSL),",",ENT)=$P(PSOSD(STA,DRG),"^") S PSOL(PSOSL,ENT)=""
"RTN","PSODGDGI",90,0)
 .F PSOL=0:0 S PSOL=$O(PSOL(PSOL)) Q:'PSOL  F ENT=0:0 S ENT=$O(PSOL(PSOL,ENT)) Q:'ENT  D
"RTN","PSODGDGI",91,0)
 ..I ENT=1,'$P(PSORX("PSOL",PSOL),",",2) K PSORX("PSOL",PSOL) Q
"RTN","PSODGDGI",92,0)
 ..I ENT=1,$P(PSORX("PSOL",PSOL),",",2) S PSORX("PSOL",PSOL)=$P(PSORX("PSOL",PSOL),",",2,99) Q
"RTN","PSODGDGI",93,0)
 ..S PSORX("PSOL",PSOL)=$P(PSORX("PSOL",PSOL),",",1,ENT-1)_","_$P(PSORX("PSOL",PSOL),",",ENT+1,99)
"RTN","PSODGDGI",94,0)
 K PSOX2,PSOSL,PSOL,ENT Q
"RTN","PSODGDGI",95,0)
ULRX ;
"RTN","PSODGDGI",96,0)
 I '$G(PSODGRLX) Q
"RTN","PSODGDGI",97,0)
 D PSOUL^PSSLOCK(PSODGRLX) K PSODGRLX
"RTN","PSODGDGI",98,0)
 Q
"RTN","PSODRDU1")
0^16^B48930048
"RTN","PSODRDU1",1,0)
PSODRDU1 ;BIR/SAB - dup drug class checker for pending orders ;7/19/96
"RTN","PSODRDU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,27,32,56,63,130,132**;DEC 1997
"RTN","PSODRDU1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSODRDU1",4,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSODRDU1",5,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSODRDU1",6,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSODRDU1",7,0)
 ;External reference to ^SC supported by DBIA 10040
"RTN","PSODRDU1",8,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSODRDU1",9,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSODRDU1",10,0)
 S RXREC=$P(PSOSD(STA,DNM),"^",10)
"RTN","PSODRDU1",11,0)
 Q:'$D(^PS(52.41,RXREC,0))
"RTN","PSODRDU1",12,0)
 Q:$P($G(^PS(52.41,RXREC,0)),"^",3)="RF"
"RTN","PSODRDU1",13,0)
 I $G(ORD) D  K FSIG Q
"RTN","PSODRDU1",14,0)
 .D:ORD'=RXREC&($G(PSODRUG("NAME"))=$P(DNM,"^"))&('$D(^XUSEC("PSORPH",DUZ)))  Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",15,0)
 ..I $P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",16,0)
 ..I $P($G(PSOPAR),"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",17,0)
 ..I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",18,0)
 .I $D(^XUSEC("PSORPH",DUZ)) D:ORD'=RXREC&($G(PSODRUG("NAME"))=$P(DNM,"^")) DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",19,0)
 .I $G(PSODRUG("VA CLASS"))]"",$E($G(PSODRUG("VA CLASS")),1,4)=$E($P($G(PSOSD(STA,DNM)),"^",5),1,4),$G(PSODRUG("NAME"))'=$P(DNM,"^"),ORD'=RXREC D CLS
"RTN","PSODRDU1",20,0)
 ;backdoor orders
"RTN","PSODRDU1",21,0)
 Q:'$P($G(^PS(52.41,RXREC,0)),"^",9)
"RTN","PSODRDU1",22,0)
 D:PSODRUG("NAME")=$P(DNM,"^")&('$D(^XUSEC("PSORPH",DUZ)))  I $G(PSORX("DFLG")) K FSIG Q
"RTN","PSODRDU1",23,0)
 .I $P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",24,0)
 .I $P($G(PSOPAR),"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",25,0)
 .I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",26,0)
 D:PSODRUG("NAME")=$P(DNM,"^")&($D(^XUSEC("PSORPH",DUZ))) DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDU1",27,0)
 I $G(PSODRUG("VA CLASS"))]"",$E($G(PSODRUG("VA CLASS")),1,4)=$E($P($G(PSOSD(STA,DNM)),"^",5),1,4),$G(PSODRUG("NAME"))'=$P(DNM,"^") D CLS
"RTN","PSODRDU1",28,0)
 K FSIG Q
"RTN","PSODRDU1",29,0)
DUP S DUP=1 W !,PSONULN,!,$C(7),"DUPLICATE DRUG "_$P(DNM,"^")_" in a Pending Order"
"RTN","PSODRDU1",30,0)
 S MSG="Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Drug."
"RTN","PSODRDU1",31,0)
DATA S DUPRX0=^PS(52.41,RXREC,0),RFLS=$P(DUPRX0,"^",11),ISSD=$P(DUPRX0,"^",6)
"RTN","PSODRDU1",32,0)
 S RXRECLOD=RXREC
"RTN","PSODRDU1",33,0)
 W !,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODRDU1",34,0)
 W !,"Drug: "_$S($P(DUPRX0,"^",9):$P(^PSDRUG($P(DUPRX0,"^",9),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSODRDU1",35,0)
 W !,"Instructions: " S TY=2 D INST
"RTN","PSODRDU1",36,0)
 D FSIG^PSOUTLA("P",RXREC,IOM-6)
"RTN","PSODRDU1",37,0)
 W !,"SIG: " F I=0:0 S I=$O(FSIG(I)) Q:'I  W FSIG(I),!?5
"RTN","PSODRDU1",38,0)
 W !,"Routing: "_$S($P(DUPRX0,"^",17)="W":"WINDOW",1:"MAIL"),?30,"Quantity: "_$P(DUPRX0,"^",10),!,"# of Refills: "_$P(DUPRX0,"^",11)
"RTN","PSODRDU1",39,0)
 W ?30,"Patient Status: SC",!,"Patient Location: "_$S($P(DUPRX0,"^",13):$P($G(^SC($P(DUPRX0,"^",13),0)),"^"),1:""),!,"Med Route: "_$P($G(^PS(51.2,+$P(DUPRX0,"^",15),0)),"^"),?30,"Provider: "_$P(^VA(200,$P(DUPRX0,"^",5),0),"^")
"RTN","PSODRDU1",40,0)
 S Y=$P(DUPRX0,"^",6) X ^DD("DD") W !,"Issue Date: "_Y
"RTN","PSODRDU1",41,0)
 W !,"Provider Comments: " S TY=3 D INST
"RTN","PSODRDU1",42,0)
 W !,PSONULN,! I $P($G(^PS(53,+$P($G(PSORX("PATIENT STATUS")),"^"),0)),"^")["AUTH ABS",'$P(PSOPAR,"^",5) W !,"PATIENT ON AUTHORIZED ABSENSE!" K RXRECLOD Q
"RTN","PSODRDU1",43,0)
ASKCAN D PSOL^PSSLOCK(RXRECLOD_"S") I '$G(PSOMSG) D  K PSOMSG,DIR,DUP,RXRECLOD S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSODRDU1",44,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2),! Q
"RTN","PSODRDU1",45,0)
 .W !!,"Another person is editing this pending order.",!
"RTN","PSODRDU1",46,0)
 K PSOMSG S DIR("A")="Discontinue Pending Order",DIR(0)="Y",DIR("?")="Enter Y to Discontinue this pending order."
"RTN","PSODRDU1",47,0)
 D ^DIR K DIR
"RTN","PSODRDU1",48,0)
 I 'Y W $C(7)," -Pending Order was not discontinued..." S:$G(DUP) PSORX("DFLG")=1 K DUP,CLS D ULPN Q
"RTN","PSODRDU1",49,0)
 S ACT="Discontinued while "_$S('$G(PSONV):"entering",1:"verifying")_" new RX"
"RTN","PSODRDU1",50,0)
 W !!,"Duplicate "_$S($G(CLS):"Class",1:"Drug")_" will be discontinued after the acceptance of the new order.",! H 2
"RTN","PSODRDU1",51,0)
 S ^TMP("PSORXDC",$J,RXREC,0)="P^"_RXREC_"^"_MSG
"RTN","PSODRDU1",52,0)
 K CLS,DUP,PSOSD(STA,DNM) Q
"RTN","PSODRDU1",53,0)
CLS K DUP
"RTN","PSODRDU1",54,0)
 I $E($G(PSODRUG("VA CLASS")),1,2)="HA",$E($P($G(PSOSD(STA,DNM)),"^",5),1,2)="HA" K CLS,DUP,PSOELSE Q
"RTN","PSODRDU1",55,0)
 S MSG="  Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Class." W !,PSONULN
"RTN","PSODRDU1",56,0)
 W !,$C(7),"*** SAME CLASS *** of drug in a Pending Order for "_$P(DNM,"^"),!,"Class: "_$G(PSODRUG("VA CLASS"))
"RTN","PSODRDU1",57,0)
 S CLS=1 I $P($G(PSOPAR),"^",10) D DATA Q
"RTN","PSODRDU1",58,0)
 E  S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DTOUT,DUOUT,DIRUT
"RTN","PSODRDU1",59,0)
 K CLS,DUP,PSOELSE Q
"RTN","PSODRDU1",60,0)
INST ;displays instruction and/or comments
"RTN","PSODRDU1",61,0)
 S INST=0 F  S INST=$O(^PS(52.41,RXREC,TY,INST)) Q:'INST  S MIG=^PS(52.41,RXREC,TY,INST,0) D
"RTN","PSODRDU1",62,0)
 .F SG=1:1:$L(MIG," ") W:$X+$L($P(MIG," ",SG)_" ")>IOM @$S(TY=3:"!?14",1:"!?19") W $P(MIG," ",SG)_" "
"RTN","PSODRDU1",63,0)
 K INST,TY,MIG,SG
"RTN","PSODRDU1",64,0)
 Q
"RTN","PSODRDU1",65,0)
ULPN ;
"RTN","PSODRDU1",66,0)
 I '$G(RXRECLOD) Q
"RTN","PSODRDU1",67,0)
 D PSOUL^PSSLOCK(RXRECLOD_"S") K RXRECLOD
"RTN","PSODRDU1",68,0)
 Q
"RTN","PSODRDU1",69,0)
NVA ;displays dupclicate drugs and classes for non-va meds
"RTN","PSODRDU1",70,0)
 I $G(IT) D  Q
"RTN","PSODRDU1",71,0)
 .S SER=$P($G(^PS(56,IT,0)),"^",4)
"RTN","PSODRDU1",72,0)
 .W "***"_$S(SER=1:"Critical",1:"Significant")_"*** Drug Interacton with a Non-VA Med Order.",!,"Drug: "_$P(DNM,"^")
"RTN","PSODRDU1",73,0)
 .K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSODRDU1",74,0)
 Q:'$D(^PS(55,PSODFN,"NVA",$P(PSOSD(STA,DNM),"^",10),0))
"RTN","PSODRDU1",75,0)
 S IFN=$P(PSOSD(STA,DNM),"^",10),RXREC=IFN
"RTN","PSODRDU1",76,0)
 I '$G(IT),$G(PSODRUG("NAME"))=$P(DNM,"^") D DSP Q
"RTN","PSODRDU1",77,0)
 I '$G(IT),$G(PSODRUG("VA CLASS"))]"",$E($G(PSODRUG("VA CLASS")),1,4)=$E($P($G(PSOSD(STA,DNM)),"^",5),1,4),$G(PSODRUG("NAME"))'=$P(DNM,"^") D DSP
"RTN","PSODRDU1",78,0)
 Q
"RTN","PSODRDU1",79,0)
DSP S $P(PSONULN,"-",79)="-"
"RTN","PSODRDU1",80,0)
 W !,PSONULN,!,$C(7),"Duplicate Drug "_$S($G(PSODRUG("NAME"))=$P(DNM,"^"):$P(DNM,"^"),1:"Class "_$G(PSODRUG("VA CLASS")))_" in a Non-VA Med Order.",!
"RTN","PSODRDU1",81,0)
 S DUPRX0=^PS(55,PSODFN,"NVA",RXREC,0)
"RTN","PSODRDU1",82,0)
 W !,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODRDU1",83,0)
 W !,"Drug: "_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSODRDU1",84,0)
 W !,"Drug Class: "_$G(PSODRUG("VA CLASS"))
"RTN","PSODRDU1",85,0)
 W !,"Dosage: "_$P(DUPRX0,"^",3)
"RTN","PSODRDU1",86,0)
 W !,"Schedule: "_$P(DUPRX0,"^",5),?40,"Medication Route: "_$P(DUPRX0,"^",4)
"RTN","PSODRDU1",87,0)
 W !,"Start Date: "_$$FMTE^XLFDT($P(DUPRX0,"^",9)),?40,"CPRS Oder #: "_$P(DUPRX0,"^",8)
"RTN","PSODRDU1",88,0)
 W !,"Documented By: "_$P(^VA(200,$P(DUPRX0,"^",11),0),"^")_" on "_$$FMTE^XLFDT($P(DUPRX0,"^",10))
"RTN","PSODRDU1",89,0)
 F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",IFN,"OCK",I)) Q:'I  D  W !
"RTN","PSODRDU1",90,0)
 .S ORD1=$P(^PS(55,PSODFN,"NVA",IFN,"OCK",I,0),"^"),ORP=$P(^(0),"^",2)
"RTN","PSODRDU1",91,0)
 .W !,"Order Check #"_I_": "
"RTN","PSODRDU1",92,0)
 .K OCK,LEN I $L(ORD1)>70 S (LEN,IEN)=1 D
"RTN","PSODRDU1",93,0)
 ..F SG=1:1:$L(ORD1) S:$L($G(OCK(IEN))_" "_$P(ORD1," ",SG))>75&($P(ORD1," ",SG)]"") IEN=IEN+1 S:$P(ORD1," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(ORD1," ",SG)
"RTN","PSODRDU1",94,0)
 ..F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSODRDU1",95,0)
 .W:'$G(LEN) ORD1 K LEN,SG,IEN,II,OCK,ORD1
"RTN","PSODRDU1",96,0)
 .W !,"Overriding Provider: "_$S($G(ORP):$P(^VA(200,ORP,0),"^"),1:"")
"RTN","PSODRDU1",97,0)
 .K ORP,OCK,REA W !,"Reason:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",IFN,"OCK",I,"OVR",SS)) Q:'SS  S REA(SS)=^PS(55,PSODFN,"NVA",IFN,"OCK",I,"OVR",SS,0)
"RTN","PSODRDU1",98,0)
 .S IEN=1 F II=0:0 S II=$O(REA(II)) Q:'II  D
"RTN","PSODRDU1",99,0)
 ..F SG=1:1:$L(REA(II)) S:$L($G(OCK(IEN))_" "_$P(REA(II)," ",SG))>70&($P(REA(II)," ",SG)]"") IEN=IEN+1 S:$P(REA(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(REA(II)," ",SG)
"RTN","PSODRDU1",100,0)
 ..K REA,IEN,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W OCK(II) I $O(OCK(II)) W !?5
"RTN","PSODRDU1",101,0)
 .K OCK W !,"Statement/Explanation/Comments:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",IFN,"DSC",SS)) Q:'SS  S DSC(SS)=^PS(55,PSODFN,"NVA",IFN,"DSC",SS,0)
"RTN","PSODRDU1",102,0)
 .S IEN=1 F II=0:0 S II=$O(DSC(II)) Q:'II  D
"RTN","PSODRDU1",103,0)
 ..F SG=1:1:$L(DSC(II)) S:$L($G(OCK(IEN))_" "_$P(DSC(II)," ",SG))>70&($P(DSC(II)," ",SG)]"") IEN=IEN+1 S:$P(DSC(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(DSC(II)," ",SG)
"RTN","PSODRDU1",104,0)
 ..K IEN,DSC,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSODRDU1",105,0)
 W !,PSONULN,!
"RTN","PSODRDU1",106,0)
 K RX3,LSTFL,PSONULN,ISSD,J,LSTFD,PHYS,ST,TRM,DUPRX0,FL,FSIG,I,IFN,RFLS,RXREC,X,Y,IEN,DSC,REA,OCK,ORD1
"RTN","PSODRDU1",107,0)
 K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSODRDU1",108,0)
 Q
"RTN","PSODRDU2")
0^31^B29471172
"RTN","PSODRDU2",1,0)
PSODRDU2 ;BHAM ISC/SAB - dup drug/class display for outpatient orders ;9/23/97 8:40am
"RTN","PSODRDU2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**132**;DEC 1997
"RTN","PSODRDU2",3,0)
 ;External reference ^PS(50.7 - 2223
"RTN","PSODRDU2",4,0)
 ;External reference ^PS(50.606 - 2174
"RTN","PSODRDU2",5,0)
 ;External reference ^PSDRUG( - 221
"RTN","PSODRDU2",6,0)
 ;External reference to ^PS(55 - 2228
"RTN","PSODRDU2",7,0)
EN(DFN,RXNUM) ;dfn=patient's ifn, rxnum=internal order # for rx, pending or non-va med
"RTN","PSODRDU2",8,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) Q:RXNUM=""
"RTN","PSODRDU2",9,0)
 S $P(PSONULN,"-",79)="-"
"RTN","PSODRDU2",10,0)
 K INST,SD,IFN S FL=$P(RXNUM,";"),IFN=+FL G:RXNUM["P" PEN G:RXNUM["N" NVA
"RTN","PSODRDU2",11,0)
 Q:'$D(^PSRX(IFN,0))
"RTN","PSODRDU2",12,0)
 S RX0=^PSRX(IFN,0),RX2=^(2),RX3=^(3),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2),DNM=$P(^PSDRUG($P(RX0,"^",6),0),"^")
"RTN","PSODRDU2",13,0)
 W !,PSONULN S RXREC=IFN
"RTN","PSODRDU2",14,0)
 S DUPRX0=^PSRX(RXREC,0),RFLS=$P(DUPRX0,"^",9),ISSD=$P(^PSRX(RXREC,0),"^",13),RX0=DUPRX0,RX2=^PSRX(RXREC,2),$P(RX0,"^",15)=+$G(^PSRX(RXREC,"STA"))
"RTN","PSODRDU2",15,0)
 W !,$J("Rx #: ",24)_$P(RX0,"^"),?39,DNM
"RTN","PSODRDU2",16,0)
 W !,$J("Status: ",24) S J=RXREC D STAT^PSOFUNC W ST K RX0,RX2 W ?40,$J("Issued: ",24),$E(ISSD,4,5)_"/"_$E(ISSD,6,7)_"/"_$E(ISSD,2,3)
"RTN","PSODRDU2",17,0)
 K FSIG,BSIG I $P($G(^PSRX(RXREC,"SIG")),"^",2) D FSIG^PSOUTLA("R",RXREC,54) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSODRDU2",18,0)
 K FSIG,PSREV I '$P($G(^PSRX(RXREC,"SIG")),"^",2) D EN2^PSOUTLA1(RXREC,54)
"RTN","PSODRDU2",19,0)
 W !,$J("SIG: ",24) W $G(BSIG(1))
"RTN","PSODRDU2",20,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?24,$G(BSIG(PSREV))
"RTN","PSODRDU2",21,0)
 K BSIG,PSREV
"RTN","PSODRDU2",22,0)
 W !,$J("QTY: ",24)_$P(DUPRX0,"^",7),?40,$J("# of refills: ",24)_RFLS S PHYS=$S($D(^VA(200,+$P(DUPRX0,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSODRDU2",23,0)
 W !,$J("Provider: ",24)_PHYS,?40,$J("Refills remaining: ",24),RFLS-$S($D(^PSRX(RXREC,1,0)):$P(^(0),"^",4),1:0)
"RTN","PSODRDU2",24,0)
 S LSTFL=+^PSRX(RXREC,3) W !?40,$J("Last filled on: ",24)_$E(LSTFL,4,5)_"/"_$E(LSTFL,6,7)_"/"_$E(LSTFL,2,3),!?40,$J("Days Supply: ",24)_$P(DUPRX0,"^",8)
"RTN","PSODRDU2",25,0)
 W !,PSONULN,!
"RTN","PSODRDU2",26,0)
 K DNM,RX3,LSTFL,PSONULN,ISSD,J,LSTFD,PHYS,ST,STA,TRM,DUPRX0,FL,FSIG,I,IFN,RFLS,RXREC,X,Y Q
"RTN","PSODRDU2",27,0)
 ;
"RTN","PSODRDU2",28,0)
PEN Q:'$D(^PS(52.41,IFN,0))
"RTN","PSODRDU2",29,0)
 W !,PSONULN,! S RXREC=IFN
"RTN","PSODRDU2",30,0)
 S DUPRX0=^PS(52.41,RXREC,0),RFLS=$P(DUPRX0,"^",11),ISSD=$P(DUPRX0,"^",6)
"RTN","PSODRDU2",31,0)
 W !,"Pending Order: "_$P(DUPRX0,"^"),!,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODRDU2",32,0)
 W !,"Drug: "_$S($P(DUPRX0,"^",9):$P(^PSDRUG($P(DUPRX0,"^",9),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSODRDU2",33,0)
 W !,"Provider Comments: " S TY=2 D INST
"RTN","PSODRDU2",34,0)
 D FSIG^PSOUTLA("P",RXREC,IOM-6)
"RTN","PSODRDU2",35,0)
 W !,"SIG: " F I=0:0 S I=$O(FSIG(I)) Q:'I  W FSIG(I),!?5
"RTN","PSODRDU2",36,0)
 W !,"Routing: "_$S($P(DUPRX0,"^",17)="W":"WINDOW",1:"MAIL"),?30,"Quantity: "_$P(DUPRX0,"^",10),!,"# of Refills: "_$P(DUPRX0,"^",11)
"RTN","PSODRDU2",37,0)
 W ?30,"Patient Status: SC",!,"Patient Location: "_$S($P(DUPRX0,"^",13):$P($G(^SC($P(DUPRX0,"^",13),0)),"^"),1:""),!,"Med Route: "_$P($G(^PS(51.2,+$P(DUPRX0,"^",15),0)),"^"),?30,"Provider: "_$P(^VA(200,$P(DUPRX0,"^",5),0),"^")
"RTN","PSODRDU2",38,0)
 S Y=$P(DUPRX0,"^",6) X ^DD("DD") W !,"Issue Date: "_Y
"RTN","PSODRDU2",39,0)
 W !,"Instructions: " S TY=3 D INST
"RTN","PSODRDU2",40,0)
 W !,PSONULN,!
"RTN","PSODRDU2",41,0)
 K DNM,RX3,LSTFL,PSONULN,ISSD,J,LSTFD,PHYS,ST,STA,TRM,DUPRX0,FL,FSIG,I,IFN,RFLS,RXREC,X,Y Q
"RTN","PSODRDU2",42,0)
 ;
"RTN","PSODRDU2",43,0)
INST ;displays instruction and/or comments
"RTN","PSODRDU2",44,0)
 S INST=0 F  S INST=$O(^PS(52.41,IFN,TY,INST)) Q:'INST  S MIG=^PS(52.41,IFN,TY,INST,0) D
"RTN","PSODRDU2",45,0)
 .F SG=1:1:$L(MIG," ") W:$X+$L($P(MIG," ",SG)_" ")>IOM @$S(TY=3:"!?14",1:"!?19") W $P(MIG," ",SG)_" "
"RTN","PSODRDU2",46,0)
 K INST,TY,MIG,SG
"RTN","PSODRDU2",47,0)
 Q
"RTN","PSODRDU2",48,0)
NVA ;displays non-va meds
"RTN","PSODRDU2",49,0)
 Q:'$G(^PS(55,DFN,"NVA",IFN,0))
"RTN","PSODRDU2",50,0)
 W !,PSONULN S DUPRX0=^PS(55,DFN,"NVA",IFN,0)
"RTN","PSODRDU2",51,0)
 W !,"Non-VA Med: "_$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSODRDU2",52,0)
 W !,"Drug: "_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSODRDU2",53,0)
 W !,"Status: "_$S($P(DUPRX0,"^",7):"Discontinued ("_$$FMTE^XLFDT($P($P(DUPRX0,"^",7),"."))_")",1:"Active")
"RTN","PSODRDU2",54,0)
 W !,"Dosage: "_$P(DUPRX0,"^",3)
"RTN","PSODRDU2",55,0)
 W !,"Schedule: "_$P(DUPRX0,"^",5),!,"Route: "_$P(DUPRX0,"^",4)
"RTN","PSODRDU2",56,0)
 W !,"Start Date: "_$$FMTE^XLFDT($P(DUPRX0,"^",9)),?40,"CPRS Oder #: "_$P(DUPRX0,"^",8)
"RTN","PSODRDU2",57,0)
 W !,"Documented By: "_$P(^VA(200,$P(DUPRX0,"^",11),0),"^")_" on "_$$FMTE^XLFDT($P(DUPRX0,"^",10))
"RTN","PSODRDU2",58,0)
 S RMLEN=$S($G(IOM):(IOM-5),1:70)
"RTN","PSODRDU2",59,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",IFN,"OCK",I)) Q:'I  D  I $O(^PS(55,DFN,"NVA",IFN,"OCK",I)) S DIR(0)="E",DIR("A")="   Press Enter to Continue" D ^DIR K DIR
"RTN","PSODRDU2",60,0)
 .S ORD=$P(^PS(55,DFN,"NVA",IFN,"OCK",I,0),"^"),ORP=$P(^(0),"^",2)
"RTN","PSODRDU2",61,0)
 .W !,"Order Check #"_I_": "
"RTN","PSODRDU2",62,0)
 .K OCK,LEN I $L(ORD)>RMLEN S (LEN,IEN)=1 D
"RTN","PSODRDU2",63,0)
 ..F SG=1:1:$L(ORD) S:$L($G(OCK(IEN))_" "_$P(ORD," ",SG))>RMLEN&($P(ORD," ",SG)]"") IEN=IEN+1 S:$P(ORD," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(ORD," ",SG)
"RTN","PSODRDU2",64,0)
 ..F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSODRDU2",65,0)
 .W:'$G(LEN) ORD K LEN,SG,IEN,II,OCK,ORD
"RTN","PSODRDU2",66,0)
 .W !,"Overriding Provider: "_$S($G(ORP):$P(^VA(200,ORP,0),"^"),1:"")
"RTN","PSODRDU2",67,0)
 .K ORP,OCK,REA W !,"Reason:" F SS=0:0 S SS=$O(^PS(55,DFN,"NVA",IFN,"OCK",I,"OVR",SS)) Q:'SS  S REA(SS)=^PS(55,DFN,"NVA",IFN,"OCK",I,"OVR",SS,0)
"RTN","PSODRDU2",68,0)
 .S IEN=1 F II=0:0 S II=$O(REA(II)) Q:'II  D
"RTN","PSODRDU2",69,0)
 ..F SG=1:1:$L(REA(II)) S:$L($G(OCK(IEN))_" "_$P(REA(II)," ",SG))>RMLEN&($P(REA(II)," ",SG)]"") IEN=IEN+1 S:$P(REA(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(REA(II)," ",SG)
"RTN","PSODRDU2",70,0)
 ..K REA,IEN,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W OCK(II) I $O(OCK(II)) W !?5
"RTN","PSODRDU2",71,0)
 K OCK W !,"Statement/Explanation/Comments:" F SS=0:0 S SS=$O(^PS(55,DFN,"NVA",IFN,"DSC",SS)) Q:'SS  S DSC(SS)=^PS(55,DFN,"NVA",IFN,"DSC",SS,0)
"RTN","PSODRDU2",72,0)
 S IEN=1 F II=0:0 S II=$O(DSC(II)) Q:'II  D
"RTN","PSODRDU2",73,0)
 .F SG=1:1:$L(DSC(II)) S:$L($G(OCK(IEN))_" "_$P(DSC(II)," ",SG))>RMLEN&($P(DSC(II)," ",SG)]"") IEN=IEN+1 S:$P(DSC(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(DSC(II)," ",SG)
"RTN","PSODRDU2",74,0)
 K IEN,DSC,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSODRDU2",75,0)
 W !,PSONULN,!
"RTN","PSODRDU2",76,0)
        K RMLEN
"RTN","PSODRDUP")
0^15^B44264471
"RTN","PSODRDUP",1,0)
PSODRDUP ;BIR/SAB - Dup drug class checker ;03/06/96
"RTN","PSODRDUP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,39,56,130,132**;DEC 1997
"RTN","PSODRDUP",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSODRDUP",4,0)
 S $P(PSONULN,"-",79)="-",(STA,DNM)="" K CLS
"RTN","PSODRDUP",5,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DNM=$O(PSOSD(STA,DNM)) Q:DNM=""!$G(PSORX("DFLG"))  I $P(PSOSD(STA,DNM),"^")'=$G(PSORENW("OIRXN")) D  Q:$G(PSORX("DFLG"))
"RTN","PSODRDUP",6,0)
 .I STA="PENDING" D ^PSODRDU1 Q
"RTN","PSODRDUP",7,0)
 .I STA="ZNONVA" D NVA^PSODRDU1 Q
"RTN","PSODRDUP",8,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&('$D(^XUSEC("PSORPH",DUZ)))  Q:$G(PSORX("DFLG"))
"RTN","PSODRDUP",9,0)
 ..I $P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDUP",10,0)
 ..I $P(PSOPAR,"^",2),'$P($G(PSOPAR),"^",16) D DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDUP",11,0)
 ..I '$P(PSOPAR,"^",2),'$P($G(PSOPAR),"^",16) D DUP
"RTN","PSODRDUP",12,0)
 .D:PSODRUG("NAME")=$P(DNM,"^")&($D(^XUSEC("PSORPH",DUZ))) DUP Q:$G(PSORX("DFLG"))
"RTN","PSODRDUP",13,0)
 .I PSODRUG("VA CLASS")]"",$E(PSODRUG("VA CLASS"),1,4)=$E($P(PSOSD(STA,DNM),"^",5),1,4),PSODRUG("NAME")'=$P(DNM,"^") D CLS
"RTN","PSODRDUP",14,0)
 G EXIT
"RTN","PSODRDUP",15,0)
DOSE ;I '$D(PSOCLOZ) G EXIT
"RTN","PSODRDUP",16,0)
 S DIR(0)="N^12.5:3000:1",DIR("A")="CLOZAPINE dosage (mg/day) ? " D ^DIR K DIR I $D(DIRUT) S (ANQX,ANQNO)=1 G EXIT
"RTN","PSODRDUP",17,0)
 S PSOCD=X
"RTN","PSODRDUP",18,0)
 I PSOCD#25=0,PSOCD'<12.5,PSOCD<900 S PSONEW("SAND")=PSOCD_"^"_$G(PSOLR)_"^"_$G(PSOLDT) G EXIT
"RTN","PSODRDUP",19,0)
 I PSOCD#12.5 S DIR(0)="Y",DIR("B")="NO",DIR("A")=PSOCD_" is an unusual dose.  Are you sure " D ^DIR K DIR G EXIT:$D(DIRUT) I 'Y G DOSE
"RTN","PSODRDUP",20,0)
 I PSOCD>900 S DIR(0)="Y",DIR("A")="Recommended maximum daily dose is 900. Are you sure " D ^DIR K DIR G EXIT:$D(DIRUT) I 'Y G DOSE
"RTN","PSODRDUP",21,0)
 S PSONEW("SAND")=PSOCD_"^"_$G(PSOLR)_"^"_$G(PSOLDT)
"RTN","PSODRDUP",22,0)
EXIT D ^PSOBUILD K CAN,DA,DIR,DNM,DUPRX0,ISSD,J,LSTFL,MSG,PHYS,PSOCLC,PSONULN,REA,RFLS,RX0,RX2,RXN,RXREC,ST,Y,ZZ,ACT,PSOCLOZ,PSOLR,PSOLDT,PSOCD,SIG
"RTN","PSODRDUP",23,0)
 Q
"RTN","PSODRDUP",24,0)
DUP S:$P(PSOSD(STA,DNM),"^",2)<10!($P(PSOSD(STA,DNM),"^",2)=16) DUP=1 W !,PSONULN,!,$C(7),"Duplicate Drug "_$P(DNM,"^")_" in Prescription: ",$P(^PSRX(+PSOSD(STA,DNM),0),"^")
"RTN","PSODRDUP",25,0)
 S RXREC=+PSOSD(STA,DNM),MSG="Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Drug"
"RTN","PSODRDUP",26,0)
DATA S DUPRX0=^PSRX(RXREC,0),RFLS=$P(DUPRX0,"^",9),ISSD=$P(^PSRX(RXREC,0),"^",13),RX0=DUPRX0,RX2=^PSRX(RXREC,2),$P(RX0,"^",15)=+$G(^PSRX(RXREC,"STA"))
"RTN","PSODRDUP",27,0)
 S RXRECLOC=$G(RXREC)
"RTN","PSODRDUP",28,0)
 W !!,$J("Status: ",24) S J=RXREC D STAT^PSOFUNC W ST K RX0,RX2 W ?40,$J("Issued: ",24),$E(ISSD,4,5)_"/"_$E(ISSD,6,7)_"/"_$E(ISSD,2,3)
"RTN","PSODRDUP",29,0)
 S DA=RXREC D ^PSOCMOPA I $G(PSOCMOP)]"" D  K CMOP,PSOTRANS,PSOREL
"RTN","PSODRDUP",30,0)
 .S PSOTRANS=$E($P(PSOCMOP,"^",2),4,5)_"/"_$E($P(PSOCMOP,"^",2),6,7)_"/"_$E($P(PSOCMOP,"^",2),2,3)
"RTN","PSODRDUP",31,0)
 .S PSOREL=$S(CMOP("L")=0:$P($G(^PSRX(DA,2)),"^",13),1:$P(^PSRX(DA,1,CMOP("L"),0),"^",18))
"RTN","PSODRDUP",32,0)
 .S PSOREL=$E(PSOREL,4,5)_"/"_$E(PSOREL,6,7)_"/"_$E(PSOREL,2,3)_"@"_$E($P(PSOREL,".",2),1,4)
"RTN","PSODRDUP",33,0)
 .W !,$J("CMOP Status: ",24)_$S($P(PSOCMOP,"^")=0!($P(PSOCMOP,"^")=2):"Transmitted to on "_PSOTRANS,$P(PSOCMOP,"^")=1:"Released by CMOP on "_PSOREL,1:"Not Dispensed")
"RTN","PSODRDUP",34,0)
 K FSIG,BSIG I $P($G(^PSRX(RXREC,"SIG")),"^",2) D FSIG^PSOUTLA("R",RXREC,54) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSODRDUP",35,0)
 K FSIG,PSREV I '$P($G(^PSRX(RXREC,"SIG")),"^",2) D EN2^PSOUTLA1(RXREC,54)
"RTN","PSODRDUP",36,0)
 W !,$J("SIG: ",24) W $G(BSIG(1))
"RTN","PSODRDUP",37,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?24,$G(BSIG(PSREV))
"RTN","PSODRDUP",38,0)
 K BSIG,PSREV
"RTN","PSODRDUP",39,0)
 W !,$J("QTY: ",24)_$P(DUPRX0,"^",7),?40,$J("# of refills: ",24)_RFLS S PHYS=$S($D(^VA(200,+$P(DUPRX0,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSODRDUP",40,0)
 W !,$J("Provider: ",24)_PHYS,?40,$J("Refills remaining: ",24),RFLS-$S($D(^PSRX(RXREC,1,0)):$P(^(0),"^",4),1:0)
"RTN","PSODRDUP",41,0)
 S LSTFL=+^PSRX(RXREC,3) W !?40,$J("Last filled on: ",24)_$E(LSTFL,4,5)_"/"_$E(LSTFL,6,7)_"/"_$E(LSTFL,2,3),!?40,$J("Days Supply: ",24)_$P(DUPRX0,"^",8)
"RTN","PSODRDUP",42,0)
 W !,PSONULN,! I $P($G(^PS(53,+$P($G(PSORX("PATIENT STATUS")),"^"),0)),"^")["AUTH ABS"!($G(PSORX("PATIENT STATUS"))["AUTH ABS")&'$P(PSOPAR,"^",5) W !,"PATIENT ON AUTHORIZED ABSENSE!" K RXRECLOC Q
"RTN","PSODRDUP",43,0)
ASKCAN I $P(PSOSD(STA,DNM),"^",2)>10,$P(PSOSD(STA,DNM),"^",2)'=16 K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DTOUT,DUOUT,DIRUT,RXRECLOC Q
"RTN","PSODRDUP",44,0)
 I '$P(PSOPAR,"^",2),'$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)),'$G(CLS) S PSORX("DFLG")=1 K RXRECLOC Q
"RTN","PSODRDUP",45,0)
 I $P(PSOPAR,"^",2),'$P(PSOPAR,"^",16),'$D(^XUSEC("PSORPH",DUZ)),'$G(CLS) S PSORX("DFLG")=1 K RXRECLOC Q
"RTN","PSODRDUP",46,0)
 I $P(PSOSD(STA,DNM),"^",2)=16,$G(DUP) W !!,"Prescription "_$P($G(^PSRX(+$G(RXRECLOC),0)),"^")_" is on Provider Hold, it cannot be discontinued.",! K DUP,RXRECLOC S PSORX("DFLG")=1 Q
"RTN","PSODRDUP",47,0)
 D PSOL^PSSLOCK(RXRECLOC) I '$G(PSOMSG) D  K PSOMSG,DIR,DUP,RXRECLOC S DIR("A")="Press Return to continue",DIR(0)="E" D ^DIR K DIR S PSORX("DFLG")=1 Q
"RTN","PSODRDUP",48,0)
 .I $P($G(PSOMSG),"^",2)'="" W !!,$P(PSOMSG,"^",2),! Q
"RTN","PSODRDUP",49,0)
 .W !!,"Another person is editing Rx "_$P($G(^PSRX(RXRECLOC,0)),"^"),!
"RTN","PSODRDUP",50,0)
 K PSOMSG S DIR("A")=$S($P(PSOSD(STA,DNM),"^",2)=12:"Reinstate",1:"Discontinue")_" RX # "_$P(^PSRX(+PSOSD(STA,DNM),0),"^"),DIR(0)="Y",DIR("?")="Enter Y to "_$S($P(PSOSD(STA,DNM),"^",2)=12:"reinstate",1:"discontinue")_" this RX."
"RTN","PSODRDUP",51,0)
 D ^DIR K DIR S DA=RXREC S ACT=$S($D(SPCANC):"Reinstated during Rx cancel.",1:$S($P(PSOSD(STA,DNM),"^",2)=12:"Reinstated",1:"Discontinued")_" while "_$S('$G(PSONV):"entering",1:"verifying")_" new RX")
"RTN","PSODRDUP",52,0)
 D CMOP^PSOUTL I $G(CMOP("S"))="L" W !,"A CMOP Rx cannot be discontinued during transmission!",! S Y=0 K CMOP
"RTN","PSODRDUP",53,0)
 I 'Y W $C(7)," -Prescription was not "_$S($P(PSOSD(STA,DNM),"^",2)=12:"reinstated",1:"discontinued")_"..." D  Q
"RTN","PSODRDUP",54,0)
 .S:'$D(PSOCLC) PSOCLC=DUZ S MSG=ACT,REA=$S($P(PSOSD(STA,DNM),"^",2)=12:"R",1:"C") S:$G(DUP) PSORX("DFLG")=1 K DUP D ULRX K RXRECLOC
"RTN","PSODRDUP",55,0)
 .I $D(^TMP("PSORXDC",$J,RXREC,0)) K ^TMP("PSORXDC",$J,RXREC,0)
"RTN","PSODRDUP",56,0)
 I $P(PSOSD(STA,DNM),"^",2)=16,$G(CLS) W !!,"Prescription "_$P($G(^PSRX(+$G(RXRECLOC),0)),"^")_" is on Provider Hold, it cannot be discontinued.",! D ULRX K CLS,DUP,RXRECLOC S PSORX("DFLG")=1 H 2 Q
"RTN","PSODRDUP",57,0)
 S PSOCLC=DUZ,MSG=$S($G(MSG)]"":MSG,1:ACT_" During New RX "_$S('$G(PSONV):"Entry",1:"Verification")_" - Duplicate Rx"),REA=$S($P(PSOSD(STA,DNM),"^",2)=12:"R",1:"C")
"RTN","PSODRDUP",58,0)
 W !!,"Duplicate "_$S($G(CLS):"Class",1:"Drug")_" will be discontinued after the acceptance of the new order.",!
"RTN","PSODRDUP",59,0)
 S ^TMP("PSORXDC",$J,RXREC,0)="52^"_DA_"^"_MSG_"^"_REA_"^"_ACT_"^"_STA_"^"_DNM,PSONOOR="D"
"RTN","PSODRDUP",60,0)
 K RXRECLOC,DUP,CLS,PSONOOR Q
"RTN","PSODRDUP",61,0)
CLS K DUP
"RTN","PSODRDUP",62,0)
 I $E($G(PSODRUG("VA CLASS")),1,2)="HA",$E($P($G(PSOSD(STA,DNM)),"^",5),1,2)="HA" K PSOELSE Q
"RTN","PSODRDUP",63,0)
 S CLS=1,MSG="Discontinued During "_$S('$G(PSONV):"New Prescription Entry",1:"Verification")_" - Duplicate Class" W !,PSONULN
"RTN","PSODRDUP",64,0)
 W !?5,$C(7),"*** SAME CLASS *** OF DRUG IN RX #"_$P(^PSRX(+PSOSD(STA,DNM),0),"^")_" FOR "_$P(DNM,"^"),!,"CLASS: "_PSODRUG("VA CLASS")
"RTN","PSODRDUP",65,0)
 S CAN=$P(PSOSD(STA,DNM),"^",2)'<11!($P(PSOSD(STA,DNM),"^",2)=1) S RXREC=+PSOSD(STA,DNM) I $P($G(PSOPAR),"^",10) D DATA Q
"RTN","PSODRDUP",66,0)
 E  W !,PSONULN K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,DTOUT,DUOUT,DIRUT
"RTN","PSODRDUP",67,0)
 K PSOELSE Q
"RTN","PSODRDUP",68,0)
ULRX ;
"RTN","PSODRDUP",69,0)
 I '$G(RXRECLOC) Q
"RTN","PSODRDUP",70,0)
 D PSOUL^PSSLOCK(RXRECLOC)
"RTN","PSODRDUP",71,0)
 Q
"RTN","PSODSPL")
0^25^B19120882
"RTN","PSODSPL",1,0)
PSODSPL ;IHS/DSD/JCM - DISPLAY RX PROFILE TO SCREEN ;03/07/93 18:11
"RTN","PSODSPL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**132**;DEC 1997
"RTN","PSODSPL",3,0)
 ; Input Variables: PSOSD(,
"RTN","PSODSPL",4,0)
 ; Optional Inupt Variables: PSOOPT
"RTN","PSODSPL",5,0)
 ;
"RTN","PSODSPL",6,0)
 ; display profiles needs PSOOPT=3 from new PSOOPT=4 from refill, 
"RTN","PSODSPL",7,0)
 ; or PSOOPT=0 from anywhere
"RTN","PSODSPL",8,0)
 ; PSOOPT=-1 to get numbered list but no refill/renew message
"RTN","PSODSPL",9,0)
 ;---------------------------------------------------------------
"RTN","PSODSPL",10,0)
START ;
"RTN","PSODSPL",11,0)
 I '$G(PSOSD) W $C(7),!!,"This patient has no prescriptions",! G END
"RTN","PSODSPL",12,0)
 D EOJ,SHOW
"RTN","PSODSPL",13,0)
END D EOJ
"RTN","PSODSPL",14,0)
 Q
"RTN","PSODSPL",15,0)
 ;-----------------------------------------------------------------
"RTN","PSODSPL",16,0)
SHOW ;
"RTN","PSODSPL",17,0)
 S PSOPENFL=0
"RTN","PSODSPL",18,0)
 S (PSOSTA,PSODRUG)="",(PSOCNT,PSOQFLG)=0
"RTN","PSODSPL",19,0)
 D HD F PSCNT=0:0 S PSOSTA=$O(PSOSD(PSOSTA)) Q:PSOSTA=""!($G(PSOQFLG))  D STA F PSOCT=0:0 S PSODRUG=$O(PSOSD(PSOSTA,PSODRUG)) Q:PSODRUG=""  Q:PSOCNT>1000!PSOQFLG  D
"RTN","PSODSPL",20,0)
 .S PSODATA=PSOSD(PSOSTA,PSODRUG),PSOCNT=PSOCNT+1 I PSOSTA="PENDING" D PEN Q
"RTN","PSODSPL",21,0)
 .I PSOSTA="ZNONVA" D  Q
"RTN","PSODSPL",22,0)
 ..W !,"  "_$P(PSODRUG,"^")_" "_$P(PSODATA,"^",6)_" "_$P(PSODATA,"^",8)
"RTN","PSODSPL",23,0)
 ..I ($L("  "_$P(PSODRUG,"^")_" "_$P(PSODATA,"^",6)_" "_$P(PSODATA,"^",8))+20)>70 W !
"RTN","PSODSPL",24,0)
 ..W ?50,"Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSODSPL",25,0)
 .S:'$D(^PSRX(+PSODATA,0)) PSOCNT=PSOCNT-1 D:$D(^(0)) DISPL
"RTN","PSODSPL",26,0)
 I PSOQFLG G SHOWX
"RTN","PSODSPL",27,0)
 K DIR S DIR(0)="EA",DIR("A")="Press RETURN to continue: " D ^DIR ;S:'$D(DFN) DFN=PSODFN D:'$G(INPAT) GMRA^PSODEM
"RTN","PSODSPL",28,0)
SHOWX W ! K DIRUT,DTOUT,DUOUT,DIROUT S PSOCNT=PSOCNT-1 K PSODRUG
"RTN","PSODSPL",29,0)
 Q
"RTN","PSODSPL",30,0)
 ;
"RTN","PSODSPL",31,0)
HD ;
"RTN","PSODSPL",32,0)
 I $Y+5>IOSL S (DX,DY)=0 X ^%ZOSF("XY") K DX,DY
"RTN","PSODSPL",33,0)
 Q:$G(PSOPENFL)  K LINE
"RTN","PSODSPL",34,0)
 W !!,?61,"ISSUE",?68,"LAST",?73,"REF DAY",!,?4,"RX #",?17,"DRUG",?54,"QTY",?58,"ST",?62,"DATE",?68,"FILL",?73,"REM",?77,"SUP" S $P(LINE,"-",80)="-" W !,LINE K LINE
"RTN","PSODSPL",35,0)
 Q
"RTN","PSODSPL",36,0)
DISPL W ! I $G(PSOOPT) W $J(PSOCNT,2)
"RTN","PSODSPL",37,0)
 S PSODQLZ=$L($P(PSODRUG,"^"))+$L($P(^PSRX(+PSODATA,0),"^",7))
"RTN","PSODSPL",38,0)
 W ?3,$P(^PSRX(+PSODATA,0),"^")_$S($G(^PSRX(+PSODATA,"IB")):"$",1:"")
"RTN","PSODSPL",39,0)
 S PSOQTLZ=57-$L($P(^PSRX(+PSODATA,0),"^",7)) I PSODQLZ<39 W ?17,$P(PSODRUG,"^"),?PSOQTLZ,$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSODSPL",40,0)
 E  W ?17,$P(PSODRUG,"^")
"RTN","PSODSPL",41,0)
 N PSOCMOP
"RTN","PSODSPL",42,0)
 I $D(^PSDRUG("AQ",$P(^PSRX(+PSODATA,0),"^",6))) S PSOCMOP=">"
"RTN","PSODSPL",43,0)
 N X S X="PSXOPUTL" X ^%ZOSF("TEST") K X I $T D
"RTN","PSODSPL",44,0)
 .N DA S DA=+PSODATA D ^PSXOPUTL K DA
"RTN","PSODSPL",45,0)
 .I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S PSOCMOP="T"
"RTN","PSODSPL",46,0)
 .K PSXZ
"RTN","PSODSPL",47,0)
 S STA="A^N^R^H^N^S^^^^^^E^DC^^DC^DE^H^P^" W ?58,$P(STA,"^",$P(PSODATA,"^",2)+1) W $G(PSOCMOP) K STA
"RTN","PSODSPL",48,0)
 S PSOID=$P(^PSRX(+PSODATA,0),"^",13),PSOLF=+^(3) W ?61,$E(PSOID,4,5)_"-"_$E(PSOID,6,7)
"RTN","PSODSPL",49,0)
 F PSOX=0:0 S PSOX=$O(^PSRX(+PSODATA,1,PSOX)) Q:'PSOX  I +^PSRX(+PSODATA,1,PSOX,0)=PSOLF,$P(^PSRX(+PSODATA,1,PSOX,0),"^",16) S PSOLF=PSOLF_"^R"
"RTN","PSODSPL",50,0)
 I '$O(^PSRX(+PSODATA,1,0)),$P(^PSRX(+PSODATA,2),"^",15) S PSOLF=PSOLF_"^R"
"RTN","PSODSPL",51,0)
 W ?67,$S(+PSOLF:$E(PSOLF,4,5)_"-"_$E(PSOLF,6,7),1:"  -  "),$P(PSOLF,"^",2)
"RTN","PSODSPL",52,0)
 W ?74,$J($P(PSODATA,"^",6),2)
"RTN","PSODSPL",53,0)
 W ?78,$J($P(PSODATA,"^",8),2)
"RTN","PSODSPL",54,0)
 I PSODQLZ>38 S PSOQTLZ=PSOQTLZ-5 W !?PSOQTLZ,"Qty: ",$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSODSPL",55,0)
 K PSODQLZ,PSOQTLZ,PSODATA,PSOID,PSOLF,PSOX
"RTN","PSODSPL",56,0)
 ;
"RTN","PSODSPL",57,0)
EOF I $Y+5>IOSL,$O(PSOSD(PSOSTA,PSODRUG))]"" K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT) PSOHI=PSOCNT,PSOQFLG=1 K DIRUT,DTOUT,DUOUT,DIROUT D:'PSOQFLG HD,STA
"RTN","PSODSPL",58,0)
 ;
"RTN","PSODSPL",59,0)
 Q
"RTN","PSODSPL",60,0)
STA ;
"RTN","PSODSPL",61,0)
 Q:$G(PSOQFLG)
"RTN","PSODSPL",62,0)
 I PSOSTA="ZNONVA" S ZSTA=PSOSTA,PSOSTA="Non-VA MEDS (Not dispensed by VA)"
"RTN","PSODSPL",63,0)
 S STR=($L(PSOSTA)+IOM/2)-$L(PSOSTA),STP=IOM-(STR+$L(PSOSTA)) W ! F I=1:1:STR W "-"
"RTN","PSODSPL",64,0)
 W PSOSTA F I=1:1:STP W "-"
"RTN","PSODSPL",65,0)
 I $G(ZSTA)]"" W "-" S PSOSTA=ZSTA K ZSTA
"RTN","PSODSPL",66,0)
 Q
"RTN","PSODSPL",67,0)
EOJ ;
"RTN","PSODSPL",68,0)
 K PSOHI,PSOQFLG,PSODRUG,PSODATA,PSOID,PSOLF,PSOCNT,PSOLO1,PSOPENFL
"RTN","PSODSPL",69,0)
 Q
"RTN","PSODSPL",70,0)
PEN ;
"RTN","PSODSPL",71,0)
 N PSCMOPR S PSCMOPR=0 I $P($G(PSODATA),"^",11),$D(^PSDRUG("AQ",$P(PSODATA,"^",11))) S PSCMOPR=1
"RTN","PSODSPL",72,0)
 W ! I $G(PSOOPT) W $J(PSOCNT,2)
"RTN","PSODSPL",73,0)
 S PSOPENFL=1
"RTN","PSODSPL",74,0)
 S PSODQLZ=$L($P(PSODRUG,"^")),PSOQTLZ=$L($P(PSODATA,"^",8))
"RTN","PSODSPL",75,0)
 W ?3,$P(PSODRUG,"^") I +$G(PSODQLZ)>37 W !
"RTN","PSODSPL",76,0)
 ;W ?49,"ISDT: ",$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_"  QTY: "_$S(PSOQTLZ=1:"  ",PSOQTLZ=2:" ",1:"")_$P(PSODATA,"^",8)_"  REF: "_$J($P(PSODATA,"^",6),2)
"RTN","PSODSPL",77,0)
 W ?42,"QTY: ",$P(PSODATA,"^",8),?59,"ISDT: ",$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPR):"> ",1:"  ")_"REF: "_$J($P(PSODATA,"^",6),2)
"RTN","PSODSPL",78,0)
 K PSODATA,PSOID,PSOLF,PSODQLZ,PSOQTLZ D EOF
"RTN","PSODSPL",79,0)
 Q
"RTN","PSOHCSUM")
0^5^B22645938
"RTN","PSOHCSUM",1,0)
PSOHCSUM ;BHAM ISC/SAB - gather data for outpatient rx health care summary ;03/01/96 8:29
"RTN","PSOHCSUM",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,35,42,48,54,46,103,132**;DEC 1997
"RTN","PSOHCSUM",3,0)
 ;External reference to File ^PS(55 supported by DBIA 2228
"RTN","PSOHCSUM",4,0)
 ;External reference to File ^PSDRUG supported by DBIA 221
"RTN","PSOHCSUM",5,0)
 ;External reference to File ^PS(50.7 supported by DBIA 2223
"RTN","PSOHCSUM",6,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOHCSUM",7,0)
 ;External reference to ^SC supported by DBIA 10040
"RTN","PSOHCSUM",8,0)
 ;Accepts DFN (assumed to be valid)
"RTN","PSOHCSUM",9,0)
 ;Looks for PSOBEGIN as earliest expiration/cancel date for search
"RTN","PSOHCSUM",10,0)
 ;If $D(PSOBEGIN)=0 use DT as earliest expiration/cancel date
"RTN","PSOHCSUM",11,0)
 ;returns data in ^TMP("PSOO",$J,Inverse last fill date,0)
"RTN","PSOHCSUM",12,0)
 ;data is ISSUE DATE^LAST FILL DATE^DRUG^PROVIDER^STATUS^RX#^QTY^#REFILLS^IFN^COST/FILL^EXP/CANC DATE
"RTN","PSOHCSUM",13,0)
 ;and ^TMP("PSOO",$J,Inverse last fill date,n,0)=SIG
"RTN","PSOHCSUM",14,0)
 ;NON-VA Meds: ^TMP("PSOO",$J,"NVA",n,0)=orderable item_" "_dose form^status (active or discontinued)^start date(fm format)^cprs order # (ptr to 100)^date/time documented (fm format)^documented by (ptr to 200_";"_.01)^dc date/time(fm format)
"RTN","PSOHCSUM",15,0)
 ;^TMP("PSOO",$J,"NVA",n,1,0)=dosage^med route^schedule^drug (file #50_";"_.01)^clinic (file #44_";"_.01)
"RTN","PSOHCSUM",16,0)
 ;^TMP("PSOO",$J,"NVA",n,"DSC",nn,0)=statement/explanation/comments
"RTN","PSOHCSUM",17,0)
 ;
"RTN","PSOHCSUM",18,0)
 ;returns PSOBEGIN (if sent or equal DT if not sent)
"RTN","PSOHCSUM",19,0)
 ;
"RTN","PSOHCSUM",20,0)
 ;If $D(PSOACT) loop thru PS(55,DFN,"P","A") from PSOBEGIN to get actives only
"RTN","PSOHCSUM",21,0)
 ;otherwise loop through entire "P" multiple to get all Rx's
"RTN","PSOHCSUM",22,0)
 ;
"RTN","PSOHCSUM",23,0)
 K ^TMP("PSOO",$J),PSONV
"RTN","PSOHCSUM",24,0)
 S PSOBEGIN=$S($D(PSOBEGIN):PSOBEGIN,1:DT)
"RTN","PSOHCSUM",25,0)
 I $D(PSOACT) F PSODT=PSOBEGIN-1:0 S PSODT=$O(^PS(55,DFN,"P","A",PSODT)) Q:'PSODT  F PSORXX=0:0 S PSORXX=$O(^PS(55,DFN,"P","A",PSODT,PSORXX)) Q:'PSORXX  D:$G(^PSRX(PSORXX,0))]"" GET
"RTN","PSOHCSUM",26,0)
 I '$D(PSOACT) F PSOI=0:0 S PSOI=$O(^PS(55,DFN,"P",PSOI)) Q:'PSOI  S PSORXX=+^(PSOI,0) D:$G(^PSRX(PSORXX,0))]"" GET
"RTN","PSOHCSUM",27,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",I)) Q:'I  S NVA=^PS(55,DFN,"NVA",I,0) D
"RTN","PSOHCSUM",28,0)
 .Q:'$P(NVA,"^")  S PSONV=$G(PSONV)+1
"RTN","PSOHCSUM",29,0)
 .S ^TMP("PSOO",$J,"NVA",PSONV,0)=$S($D(^PS(50.7,$P(+NVA,"^"),0)):$P(^PS(50.7,$P(+NVA,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"")_"^"
"RTN","PSOHCSUM",30,0)
 .S ^TMP("PSOO",$J,"NVA",PSONV,0)=^TMP("PSOO",$J,"NVA",PSONV,0)_$S($P(NVA,"^",6):"Discontinued",1:"Active")_"^"_$P(NVA,"^",9)_"^"_$P(NVA,"^",8)_"^"_$P(NVA,"^",10)_"^"_$P(NVA,"^",11)_";"_$P($G(^VA(200,$P(NVA,"^",11),0)),"^")_"^"_$P(NVA,"^",7)
"RTN","PSOHCSUM",31,0)
 .S ^TMP("PSOO",$J,"NVA",PSONV,1,0)=$P(NVA,"^",3)_"^"_$P(NVA,"^",4)_"^"_$P(NVA,"^",5)_"^"_$S($P(NVA,"^",2):$P(NVA,"^",2)_";"_$P(^PSDRUG($P(NVA,"^",2),0),"^"),1:"")_"^"
"RTN","PSOHCSUM",32,0)
 .S ^TMP("PSOO",$J,"NVA",PSONV,1,0)=^TMP("PSOO",$J,"NVA",PSONV,1,0)_$S($D(^SC(+$P(NVA,"^",12),0)):$P(NVA,"^",12)_";"_$P(^SC($P(NVA,"^",12),0),"^"),1:"")
"RTN","PSOHCSUM",33,0)
 .F S=0:0 S S=$O(^PS(55,DFN,"NVA",I,"DSC",S)) Q:'S  S ^TMP("PSOO",$J,"NVA",PSONV,"DSC",S,0)=^PS(55,DFN,"NVA",I,"DSC",S,0)
"RTN","PSOHCSUM",34,0)
 ;
"RTN","PSOHCSUM",35,0)
END K PSODT,PSOST,PSORXX,PSO0,PSO2,PSOIDD,PSOFD,PSODR,PSOPR,PSOREF,PSORFL,PSOI,PSOJ,PSOX,PSOCF,I,PSONV,NVA
"RTN","PSOHCSUM",36,0)
 Q
"RTN","PSOHCSUM",37,0)
 ;
"RTN","PSOHCSUM",38,0)
GET Q:$P($G(^PSRX(PSORXX,"STA")),"^")=13  S PSO0=^PSRX(PSORXX,0),PSO2=$G(^(2)),PSOFD=+$G(^(3)),PSODR=$P(PSO0,"^",6),PSOPR=$P(PSO0,"^",4),PSOREF=$P(PSO0,"^",9),PSOIDD=$P(PSO0,"^",13)
"RTN","PSOHCSUM",39,0)
 I '$P(PSO0,"^",2)!('PSODR)!('PSOPR) Q
"RTN","PSOHCSUM",40,0)
 I $D(^PS(55,$P(PSO0,"^",2),0)) D:$P($G(^PS(55,$P(PSO0,"^",2),0)),"^",6)'=2 EN^PSOHLUP($P(PSO0,"^",2))
"RTN","PSOHCSUM",41,0)
 S PSOST=$P($G(^PSRX(PSORXX,"STA")),"^")
"RTN","PSOHCSUM",42,0)
 I '$D(PSOACT) D ODT I PSODT<PSOBEGIN Q
"RTN","PSOHCSUM",43,0)
 I $D(PSOACT) Q:PSOST>10&(PSOST<16)
"RTN","PSOHCSUM",44,0)
 I 'PSOFD S PSOFD=$P(PSO0,"^",13) F PSOJ=0:0 S PSOJ=$O(^PSRX(PSORXX,1,PSOJ)) Q:'PSOJ  I $D(^(PSOJ,0)),^(0)>PSOFD S PSOFD=+^(0)
"RTN","PSOHCSUM",45,0)
 S PSOX=$S($D(^PSDRUG(PSODR,0)):$P(^(0),"^"),1:"NOT ON FILE"),PSODR=PSODR_";"_PSOX
"RTN","PSOHCSUM",46,0)
 S PSOX=$G(^VA(200,PSOPR,0)) S PSOPR=PSOPR_";"_$P(PSOX,"^")
"RTN","PSOHCSUM",47,0)
 S PSOX="A;ACTIVE" S:$D(^PS(52.4,PSORXX,0)) PSOX="N;NON-VERIFIED" S:$O(^PS(52.5,"B",PSORXX,0))&($G(^PS(52.5,+$O(^PS(52.5,"B",PSORXX,0)),"P"))'=1) PSOX="S;SUSPENDED"
"RTN","PSOHCSUM",48,0)
 S:PSODT<DT PSOX="E;EXPIRED" S:PSOST=4 PSOX="N;NON-VERIFIED" S:PSOST=3!(PSOST=16) PSOX="H;HOLD"
"RTN","PSOHCSUM",49,0)
 S:PSOST=12!(PSOST=14)!(PSOST=15) PSOX="DC;DISCONTINUED"
"RTN","PSOHCSUM",50,0)
 S PSOCF=+$P(PSO0,"^",17)*(+$P(PSO0,"^",7)) ; Cost/Fill
"RTN","PSOHCSUM",51,0)
 S PSORFL=0 F PSOJ=0:0 S PSORFL=$O(^PSRX(PSORXX,1,PSORFL)) Q:PSORFL'>0  S PSOREF=PSOREF-1
"RTN","PSOHCSUM",52,0)
 F PSOJ=9999999-PSOFD:.0001 Q:'$D(^TMP("PSOO",$J,PSOJ))
"RTN","PSOHCSUM",53,0)
 S ^TMP("PSOO",$J,PSOJ,0)=PSOIDD_"^"_PSOFD_"^"_PSODR_"^"_PSOPR_"^"_PSOX_"^"_$P(PSO0,"^")_"^"_$P(PSO0,"^",7)_"^"_PSOREF_"^"_PSORXX_"^"_PSOCF_"^"_PSODT
"RTN","PSOHCSUM",54,0)
 I '$P(^PSRX(PSORXX,"SIG"),"^",2) D SIG Q
"RTN","PSOHCSUM",55,0)
 F I=0:0 S I=$O(^PSRX(PSORXX,"SIG1",I)) Q:'I  S ^TMP("PSOO",$J,PSOJ,I,0)=^PSRX(PSORXX,"SIG1",I,0)
"RTN","PSOHCSUM",56,0)
 Q
"RTN","PSOHCSUM",57,0)
SIG ;formats backdoor SIG
"RTN","PSOHCSUM",58,0)
 S X=$P(^PSRX(PSORXX,"SIG"),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250),ENT=1
"RTN","PSOHCSUM",59,0)
 F SG=1:1:$L(SIG) S:$L($G(^TMP("PSOO",$J,PSOJ,ENT,0))_" "_$P(SIG," ",SG))>80 ENT=ENT+1 S:$P(SIG," ",SG)'="" ^TMP("PSOO",$J,PSOJ,ENT,0)=$G(^TMP("PSOO",$J,PSOJ,ENT,0))_" "_$P(SIG," ",SG)
"RTN","PSOHCSUM",60,0)
 K SIG,ENT,SG,X Q
"RTN","PSOHCSUM",61,0)
ODT ;canceled or expiration date
"RTN","PSOHCSUM",62,0)
 I +PSOST=12!(PSOST=14)!(PSOST=15) D  Q
"RTN","PSOHCSUM",63,0)
 .I $P(^PSRX(PSORXX,3),"^",5) S PSODT=$P(^PSRX(PSORXX,3),"^",5) Q
"RTN","PSOHCSUM",64,0)
 .S PSODT=0 F PSOJ=0:0 S PSOJ=$O(^PSRX(PSORXX,"A",PSOJ)) Q:PSOJ'>0  I $D(^(PSOJ,0)),$P(^(0),"^",2)="C",+$P(^(0),"^")>PSODT S PSODT=+$P(^(0),"^")
"RTN","PSOHCSUM",65,0)
 S PSODT=+$P(PSO2,"^",6)
"RTN","PSOHCSUM",66,0)
 Q
"RTN","PSOHLNEW")
0^10^B73457870
"RTN","PSOHLNEW",1,0)
PSOHLNEW ;BIR/RTR - CPRS orders ;7/21/96
"RTN","PSOHLNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,7,15,46,71,98,111,124,117,131,146,132**;DEC 1997
"RTN","PSOHLNEW",3,0)
 ;40.8-728,50-221,SC-2675,100-2219,50.7-2223,EN^ORERR-2187
"RTN","PSOHLNEW",4,0)
EN(MSG) ;
"RTN","PSOHLNEW",5,0)
 N PSODDRUG,ENTERED,LOCATION,PLACER,PSOOC,ROUTE,NATURE,PREV,ROUTING,OO,OR,STAT,ZZ,DFN,COMM,QCOUNT,OCOUNT,Q1I,QTARRAY,QTARRAY2,EE,PP,XOFLAG,PSODYSPL,PSOFILNM
"RTN","PSOHLNEW",6,0)
 N ONEFLAG,SERV,WPCT,EFFECT,PROV,PENDING,RRX,PSOLQ1I,PSOLQ1II,PSOQWX,PSOLQ1IX,PSONVA
"RTN","PSOHLNEW",7,0)
 N OBXAR,AA,II,SIG1,FILLER,COMM,GG,FF,JJ,JJJ,CT,LIM,VAR,VAR1,QQQ,PSRNFLAG,PSRNQFLG,RCOMM,XOFLAGZ,NWFLAG,PFLAG,PSINPTR,INPTRX,PSOIBN,PSOIBY
"RTN","PSOHLNEW",8,0)
 N DSIG,PSOCHFFL,PSOCVI,PSOMO,PSOXRP,NN,LL,LLL,WPARRAY,QTVAR,POVAR,POVAR1,ORCSEG,NNN,OOO,AAA,NNNN,POLIM,NNCK,PRIOR,IPPLACER,PLACERXX,EER,PSERRPID,PSERRPV1,PSERRORC,PSOEXFLG,PSOMSORR,PDFN
"RTN","PSOHLNEW",9,0)
 S (SEND,PSOSND,OCOUNT)=0 K PSOPLC,PSOFFL,PSORSO,PSOSUSZ
"RTN","PSOHLNEW",10,0)
 F OO=0:0 S OO=$O(MSG(OO)) Q:'OO!(SEND)!(PSOSND)  D:$P(MSG(OO),"|")="PID" SPDFN I $P(MSG(OO),"|")="ORC",$P(MSG(OO),"|",2)'="NW",$P(MSG(OO),"|",2)'="XO" D
"RTN","PSOHLNEW",11,0)
 .S OR("STAT")=$P(MSG(OO),"|",2),OR("PLACE")=+$P(MSG(OO),"|",3),PLACERXX=+$P($P(MSG(OO),"|",3),";",2),OR("COMM")=$P(MSG(OO),"|",17),OR("USER")=$P(MSG(OO),"|",11) I $P(MSG(OO),"|",2)'="DE",$P(MSG(OO),"|",2)'="NA" S SEND=1 D FILL Q
"RTN","PSOHLNEW",12,0)
 .S PSOPLC=+$P(MSG(OO),"|",3),PSOFFL=+$P(MSG(OO),"|",4),PSOSND=1,PSOCHFFL=$P($P(MSG(OO),"|",4),"^")
"RTN","PSOHLNEW",13,0)
 I $G(OR("COMM"))["^" S OR("COMM")=$P(OR("COMM"),"^",5)
"RTN","PSOHLNEW",14,0)
 I PSOSND,$G(PSOCHFFL)["S",$G(OR("STAT"))="NA" D CHCS^PSOHLNE1 Q
"RTN","PSOHLNEW",15,0)
 I PSOSND,'$D(^PSRX(+$G(PSOFFL),0)) S COMM="Order was not located by Pharmacy" D EN^ORERR(COMM,.MSG) D KL Q
"RTN","PSOHLNEW",16,0)
 I PSOSND,$G(PDFN),PDFN'=+$P($G(^PSRX(+$G(PSOFFL),0)),"^",2) S COMM="Patient does not match" D EN^ORERR(COMM,.MSG) D KL Q
"RTN","PSOHLNEW",17,0)
 I PSOSND,$G(OR("STAT"))'="DE" S $P(^PSRX(PSOFFL,"OR1"),"^",2)=PSOPLC,^PSRX("APL",PSOPLC,PSOFFL)="" D KL Q
"RTN","PSOHLNEW",18,0)
 D KL
"RTN","PSOHLNEW",19,0)
 I SEND,$G(OR("STAT"))="Z@" G PURGE^PSOHLNE2
"RTN","PSOHLNEW",20,0)
 I SEND,$G(OR("STAT"))="ZF" G REF^PSOHLNE2
"RTN","PSOHLNEW",21,0)
 I SEND,$G(OR("STAT"))'="CA",$G(OR("STAT"))'="DC",$G(OR("STAT"))'="HD",$G(OR("STAT"))'="RL",$G(OR("STAT"))'="SS" S RCOMM="Invalid Order Control Code" D EN^ORERR(RCOMM,.MSG) Q
"RTN","PSOHLNEW",22,0)
 I SEND K SEND G:$G(OR("STAT"))="SS" ESTAT D EN^PSOORUTL(.OR) S PLACER=OR("PLACE"),STAT=OR("STAT"),COMM=OR("COMM") S PSOMSORR=1 D  K PSOMSORR Q
"RTN","PSOHLNEW",23,0)
 .I $G(OR("FILLER"))="" D  D ERROR^PSOHLSN Q
"RTN","PSOHLNEW",24,0)
 ..F EER=0:0 S EER=$O(MSG(EER)) Q:'EER  S:$P(MSG(EER),"|")="PV1" PSERRPV1=MSG(EER) S:$P(MSG(EER),"|")="PID" PSERRPID=MSG(EER) S:$P(MSG(EER),"|")="ORC"&($G(PSERRORC)="") PSERRORC=MSG(EER)
"RTN","PSOHLNEW",25,0)
 .I $P(OR("FILLER"),"^",2)="R" S FILLER=$P(OR("FILLER"),"^") D EN^PSOHLSN1(FILLER,STAT,$G(OR("PHARMST")),COMM) K:$G(PSOEXFLG) PSOMSORR,PLACERXX D:$G(PSOEXFLG) EN^PSOHLSN1(FILLER,"SC","ZE","") D:$G(PSOSUSZ) SUS^PSOORUT1 K PSOSUSZ Q
"RTN","PSOHLNEW",26,0)
 .D EN^PSOHLSN(PLACER,STAT,COMM) Q
"RTN","PSOHLNEW",27,0)
 D KL^PSOHLSIH S RRX=1 F ZZ=0:0 S ZZ=$O(MSG(ZZ)) Q:'ZZ  S PSOSEG=$G(MSG(ZZ)),PSOTYPE=$P(PSOSEG,"|") S PSOSEG=$E(PSOSEG,5,$L(PSOSEG)) I PSOTYPE'="NTE" D @PSOTYPE
"RTN","PSOHLNEW",28,0)
 I $G(PSRNFLAG) S PSOMO=0 D MISRN^PSOHLNE1 I $G(PSOMO) Q
"RTN","PSOHLNEW",29,0)
 S PSRNQFLG=0 I $G(PSRNFLAG),$G(PREV) D  I $G(PSRNQFLG) S RCOMM="Duplicate Renewal Request. Order rejected by Pharmacy." D EN^ORERR(RCOMM,.MSG) D RERROR^PSOHLSN D KL^PSOHLSIH Q
"RTN","PSOHLNEW",30,0)
 .I $P($G(^PSRX(PREV,"OR1")),"^",4) S PSRNQFLG=1 Q
"RTN","PSOHLNEW",31,0)
 .I $O(^PS(52.41,"AQ",PREV,0)) S PSRNQFLG=1
"RTN","PSOHLNEW",32,0)
 .I $G(XOFLAG),$G(DFN)'=$S($G(PFLAG):$P($G(^PS(52.41,+$G(PREV),0)),"^",2),1:$P($G(^PSRX(+$G(PREV),0)),"^",2)) S RCOMM="Patient mismatch on previous order." D EN^ORERR(RCOMM,.MSG) S XOFLAGZ=1 D RERROR^PSOHLSN D KL^PSOHLSIH Q
"RTN","PSOHLNEW",33,0)
 I $G(DFN)'=+$P($G(^OR(100,+$G(PLACER),0)),"^",2) G MISX^PSOHLNE1
"RTN","PSOHLNEW",34,0)
 I $G(PLACER) D NFILE
"RTN","PSOHLNEW",35,0)
 D KL^PSOHLSIH
"RTN","PSOHLNEW",36,0)
 Q
"RTN","PSOHLNEW",37,0)
ESTAT ;
"RTN","PSOHLNEW",38,0)
 D EXP^PSOHLNE1
"RTN","PSOHLNEW",39,0)
 Q
"RTN","PSOHLNEW",40,0)
MSH Q
"RTN","PSOHLNEW",41,0)
PID S DFN=+$P(PSOSEG,"|",3)
"RTN","PSOHLNEW",42,0)
 Q
"RTN","PSOHLNEW",43,0)
PV1 S LOCATION=+$P(+$P(PSOSEG,"|",3),"^")
"RTN","PSOHLNEW",44,0)
 S:'$D(^SC(LOCATION,0)) LOCATION=""
"RTN","PSOHLNEW",45,0)
 S INPTRX=0 I $G(LOCATION) S PSINPTR=$P($G(^SC(LOCATION,0)),"^",4) I PSINPTR Q
"RTN","PSOHLNEW",46,0)
 I $G(LOCATION) S INPTRX=$P($G(^SC(LOCATION,0)),"^",15)
"RTN","PSOHLNEW",47,0)
 I '$G(INPTRX) S INPTRX=$O(^DG(40.8,0))
"RTN","PSOHLNEW",48,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLNEW",49,0)
 S PSINPTR=+$$SITE^VASITE(DT,INPTRX)
"RTN","PSOHLNEW",50,0)
 Q
"RTN","PSOHLNEW",51,0)
ORC ;
"RTN","PSOHLNEW",52,0)
 Q:$P(PSOSEG,"|")="DE"
"RTN","PSOHLNEW",53,0)
 S:$P(PSOSEG,"|")="XO" XOFLAG=1 D ^PSOHLNE1 S:$G(PRIOR)="A" PRIOR="E" S:$G(PRIOR)="" PRIOR="R"
"RTN","PSOHLNEW",54,0)
 Q
"RTN","PSOHLNEW",55,0)
 ;
"RTN","PSOHLNEW",56,0)
RXO I $O(MSG(ZZ,0)) D ^PSOHLNE2 G RXOPS
"RTN","PSOHLNEW",57,0)
 S PSORDITE=$P($P(PSOSEG,"|"),"^",4)
"RTN","PSOHLNEW",58,0)
 S PSODDRUG=$P($P(PSOSEG,"|",10),"^",4) I $G(PSODDRUG) S:'$D(^PSDRUG(PSODDRUG,0)) PSODDRUG=""
"RTN","PSOHLNEW",59,0)
 S PSOXQTY=$P(PSOSEG,"|",11)
"RTN","PSOHLNEW",60,0)
 S PSOREFIL=$P(PSOSEG,"|",13)
"RTN","PSOHLNEW",61,0)
 S PSODYSPL=$P(PSOSEG,"|",17)
"RTN","PSOHLNEW",62,0)
RXOPS S ONEFLAG=0,WPCT=1,LL=ZZ+1
"RTN","PSOHLNEW",63,0)
 I $P($G(MSG(LL)),"|")="NTE" D
"RTN","PSOHLNEW",64,0)
 .S ONEFLAG=1,WORDP=$S($P(MSG(LL),"|",2):$P(MSG(LL),"|",2),1:$P(MSG(LL),"|",3)) S:$P(MSG(LL),"|",4)'="" WPARRAY(WORDP,WPCT)=$P(MSG(LL),"|",4) S:$P(MSG(LL),"|",4)'="" WPCT=WPCT+1 F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNEW",65,0)
 ..I $G(MSG(LL,LLL))'="" S WPARRAY(WORDP,WPCT)=$G(MSG(LL,LLL)),WPCT=WPCT+1
"RTN","PSOHLNEW",66,0)
 I ONEFLAG S LL=LL+1 I $P($G(MSG(LL)),"|")="NTE" D NTE^PSOHLNE1
"RTN","PSOHLNEW",67,0)
 K WORDP
"RTN","PSOHLNEW",68,0)
 Q
"RTN","PSOHLNEW",69,0)
RXR I $P($P(PSOSEG,"|"),"^",4) S ROUTE(RRX)=$P($P(PSOSEG,"|"),"^",4) S RRX=RRX+1
"RTN","PSOHLNEW",70,0)
 Q
"RTN","PSOHLNEW",71,0)
OBX I $O(MSG(ZZ,0)) D OBXX^PSOHLNE2 G OBXNTE
"RTN","PSOHLNEW",72,0)
 S OCOUNT=OCOUNT+1
"RTN","PSOHLNEW",73,0)
 S OBXAR(OCOUNT,1)=$P(PSOSEG,"|",5)
"RTN","PSOHLNEW",74,0)
OBXNTE ;
"RTN","PSOHLNEW",75,0)
 S LL=ZZ+1,PSOBCT=2
"RTN","PSOHLNEW",76,0)
 I $P($G(MSG(LL)),"|")="NTE" D
"RTN","PSOHLNEW",77,0)
 .I $P(MSG(LL),"|",4)'="" S PSOBCT=3,OBXAR(OCOUNT,2)=$P(MSG(LL),"|",4)
"RTN","PSOHLNEW",78,0)
 .F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNEW",79,0)
 ..I $P($G(MSG(LL,LLL)),"|",4)'="" S OBXAR(OCOUNT,PSOBCT)=$P(MSG(LL,LLL),"|",4),PSOBCT=PSOBCT+1
"RTN","PSOHLNEW",80,0)
 Q
"RTN","PSOHLNEW",81,0)
ZRN S PSODSC=1_"^"_$P(PSOSEG,"|",2)
"RTN","PSOHLNEW",82,0)
 I $O(MSG(ZZ,0)) F T=0:0 S T=$O(MSG(ZZ,T)) Q:'T  S PSODSC(T)=MSG(ZZ,T)
"RTN","PSOHLNEW",83,0)
 K T
"RTN","PSOHLNEW",84,0)
 Q
"RTN","PSOHLNEW",85,0)
 ;
"RTN","PSOHLNEW",86,0)
ZRX D ZRX^PSOHLNE1
"RTN","PSOHLNEW",87,0)
 Q
"RTN","PSOHLNEW",88,0)
 ;
"RTN","PSOHLNEW",89,0)
ZSC D CP^PSOHLNE1
"RTN","PSOHLNEW",90,0)
 Q
"RTN","PSOHLNEW",91,0)
NFILE ;
"RTN","PSOHLNEW",92,0)
 I $G(PSODSC) D ^PSONVNEW Q  ;adds non-va med to #55
"RTN","PSOHLNEW",93,0)
 ;
"RTN","PSOHLNEW",94,0)
 K DD,DO,DIC S DLAYGO="52.41",DIC="^PS(52.41,",DIC(0)="L",X=PLACER,DIC("DR")="1////"_DFN_";2////"_PSOOC_";6////"_$G(EFFECT)_";12////"_$G(PSOXQTY)_";25////"_$G(PRIOR)
"RTN","PSOHLNEW",95,0)
 S DIC("DR")=DIC("DR")_";22////"_$G(PSORSO)_";22.1////"_$G(PREV)_";19////"_$G(ROUTING)_";17////"_$G(SERV)_";7////"_$G(NATURE)_";13////"_$G(PSOREFIL)_";1.1////"_$G(LOCATION)_";117////"_$G(DSIG)
"RTN","PSOHLNEW",96,0)
 D FILE^DICN K DIC,DR I Y<0 Q
"RTN","PSOHLNEW",97,0)
 S PENDING=+Y
"RTN","PSOHLNEW",98,0)
 S $P(^PS(52.41,PENDING,0),"^",4)=$S($G(ENTERED):+$G(ENTERED),1:""),$P(^(0),"^",5)=$S($G(PROV):+$G(PROV),1:""),$P(^(0),"^",8)=$S($G(PSORDITE):+$G(PSORDITE),1:""),$P(^(0),"^",9)=$S($G(PSODDRUG):+$G(PSODDRUG),1:""),$P(^(0),"^",15)=$G(ROUTE)
"RTN","PSOHLNEW",99,0)
 S ^PS(52.41,PENDING,"IBQ")=$G(PSOIBY)
"RTN","PSOHLNEW",100,0)
 I $G(PSODYSPL)'="",$E(PSODYSPL)?1A S PSODYSPL=$E(PSODYSPL,2,$L(PSODYSPL))
"RTN","PSOHLNEW",101,0)
 S $P(^PS(52.41,PENDING,"INI"),"^")=$G(PSINPTR),$P(^(0),"^",12)=$G(PSOLOG),$P(^(0),"^",22)=$G(PSODYSPL)
"RTN","PSOHLNEW",102,0)
 I $G(QCOUNT) S ^PS(52.41,PENDING,1,0)="^52.413^"_QCOUNT_"^"_QCOUNT
"RTN","PSOHLNEW",103,0)
 S PSOQWX=$G(PSODDRUG) D:'$G(PSOQWX) OID^PSOHLNE1
"RTN","PSOHLNEW",104,0)
 F PP=0:0 S PP=$O(Q1I(PP)) Q:'PP  S ^PS(52.41,PENDING,1,PP,0)=$S($G(PSOQWX)&($G(PSOLQ1II(PP))):Q1I(PP),$G(PSOQWX)&($G(PSOLQ1IX(PP))'="")&('$G(PSOLQ1II(PP))):PSOLQ1IX(PP),1:PSOLQ1I(PP))
"RTN","PSOHLNEW",105,0)
 F EE=0:0 S EE=$O(QTARRAY(EE)) Q:'EE  S ^PS(52.41,PENDING,1,EE,1)=QTARRAY(EE),^PS(52.41,PENDING,1,EE,2)=$S($G(PSOQWX)&($G(PSOLQ1II(EE))):$G(QTARRAY2(EE)),$G(PSOQWX)&($G(PSOLQ1IX(EE))'="")&('$G(PSOLQ1II(EE))):PSOLQ1IX(EE),1:$G(PSOLQ1I(EE))) D
"RTN","PSOHLNEW",106,0)
 .S $P(^PS(52.41,PENDING,1,EE,1),"^",8)=+$G(ROUTE(EE))
"RTN","PSOHLNEW",107,0)
 S:$P($G(^PS(52.41,PENDING,1,1,1)),"^",3) $P(^PS(52.41,PENDING,0),"^",18)=$E($P($G(^PS(52.41,PENDING,1,1,1)),"^",3),1,7)
"RTN","PSOHLNEW",108,0)
 D STUFF^PSOHLNE2
"RTN","PSOHLNEW",109,0)
 D ^PSOHLPII
"RTN","PSOHLNEW",110,0)
 S LL=0 I $O(WPARRAY(6,0)) F LLL=0:0 S LLL=$O(WPARRAY(6,LLL)) Q:'LLL  S LL=LL+1 S ^PS(52.41,PENDING,3,LL,0)=$G(WPARRAY(6,LLL))
"RTN","PSOHLNEW",111,0)
 I LL S ^PS(52.41,PENDING,3,0)="^52.42^"_LL_"^"_LL
"RTN","PSOHLNEW",112,0)
 S LL=0 I $O(WPARRAY(7,0)) F LLL=0:0 S LLL=$O(WPARRAY(7,LLL)) Q:'LLL  S LL=LL+1 S ^PS(52.41,PENDING,"INS1",LL,0)=$G(WPARRAY(7,LLL))
"RTN","PSOHLNEW",113,0)
 I LL S ^PS(52.41,PENDING,"INS1",0)="^^"_LL_"^"_LL_"^"_$G(DT)_"^"
"RTN","PSOHLNEW",114,0)
 I $P($G(^PS(50.7,+$G(PSORDITE),"INS")),"^")'="" S $P(^PS(52.41,PENDING,"INS"),"^",2)=$S($O(^PS(52.41,PENDING,"INS1",0)):1,1:0)
"RTN","PSOHLNEW",115,0)
 I $G(OCOUNT) S ^PS(52.41,PENDING,"OBX",0)="^52.4118A^"_OCOUNT_"^"_OCOUNT F OCOUNT=1:1:OCOUNT D
"RTN","PSOHLNEW",116,0)
 .S ^PS(52.41,PENDING,"OBX",OCOUNT,0)=$G(OBXAR(OCOUNT,1))
"RTN","PSOHLNEW",117,0)
 .D USER^PSOORFI2(+$G(PROV)) S ^PS(52.41,PENDING,"OBX",OCOUNT,1)=USER1 K USER1
"RTN","PSOHLNEW",118,0)
 .S PSOBCT=1 F LLL=2:1 Q:'$D(OBXAR(OCOUNT,LLL))  S ^PS(52.41,PENDING,"OBX",OCOUNT,2,PSOBCT,0)=OBXAR(OCOUNT,LLL),^PS(52.41,PENDING,"OBX",OCOUNT,2,0)="^^"_PSOBCT_"^"_PSOBCT_"^"_$G(DT)_"^"
"RTN","PSOHLNEW",119,0)
 D ^PSOHLPIS
"RTN","PSOHLNEW",120,0)
 K DIK S DIK="^PS(52.41,",DA=PENDING D IX^DIK
"RTN","PSOHLNEW",121,0)
 I $G(PSOOC)="RNW",$G(PREV),$D(^PSRX(+$G(PREV),0)) D EN^PSOHLSN1(PREV,"SC","ZZ","")
"RTN","PSOHLNEW",122,0)
 S PSOMSORR=1,IPPLACER=$P($G(^PS(52.41,PENDING,0)),"^") I IPPLACER D
"RTN","PSOHLNEW",123,0)
 .I '$G(XOFLAG) D EN^PSOHLSN(IPPLACER,"OK","IP") Q
"RTN","PSOHLNEW",124,0)
 .D EN^PSOHLSN(IPPLACER,"XR","IP") I $G(PFLAG) D DCP^PSOHLSN Q
"RTN","PSOHLNEW",125,0)
 .K PSOMSORR I $D(^PSRX(+$G(PREV),0)) S $P(^PSRX(PREV,"STA"),"^")=15 D CAN^PSOTPCAN(PREV),CAN^PSOUTL(PREV) D  D EN^PSOHLSN1(PREV,"RP","","","A")
"RTN","PSOHLNEW",126,0)
 ..D CNT^PSOHLNE1
"RTN","PSOHLNEW",127,0)
 ..D:$G(^PS(52.41,PENDING,1,1,0))=""&($P($G(^PS(52.41,PENDING,1,1,1)),"^")="")&($G(^PS(52.41,PENDING,"SIG",1,0))="")
"RTN","PSOHLNEW",128,0)
 ...N FSIG,BSIG
"RTN","PSOHLNEW",129,0)
 ...I '$P($G(^PSRX(PREV,"SIG")),"^",2),$P($G(^("SIG")),"^")'="" D
"RTN","PSOHLNEW",130,0)
 ....D EN3^PSOUTLA1(PREV,70)
"RTN","PSOHLNEW",131,0)
 ....I $G(BSIG(1))'="" S ^PS(52.41,PENDING,"SIG",1,0)=$G(BSIG(1)) I $O(BSIG(1)) F EE=1:0 S EE=$O(BSIG(EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",EE,0)=$G(BSIG(EE))
"RTN","PSOHLNEW",132,0)
 ...I $P($G(^PSRX(PREV,"SIG")),"^",2),$G(^PSRX(PREV,"SIG1",1,0))'="" D
"RTN","PSOHLNEW",133,0)
 ....D FSIG^PSOUTLA("R",PREV,70)
"RTN","PSOHLNEW",134,0)
 ....I $G(FSIG(1))'="" S ^PS(52.41,PENDING,"SIG",1,0)=$G(FSIG(1)) I $O(FSIG(1)) F EE=1:0 S EE=$O(FSIG(EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",EE,0)=$G(FSIG(EE))
"RTN","PSOHLNEW",135,0)
 ...F EE=0:0 S EE=$O(^PS(52.41,PENDING,"SIG",EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",0)="^52.4124A^"_EE_"^"_EE
"RTN","PSOHLNEW",136,0)
 Q
"RTN","PSOHLNEW",137,0)
SPDFN S PDFN=$P($G(MSG(OO)),"|",4) Q
"RTN","PSOHLNEW",138,0)
KL K PSOPLC,PSOFFL,PSOSND
"RTN","PSOHLNEW",139,0)
 Q
"RTN","PSOHLNEW",140,0)
FILL ;
"RTN","PSOHLNEW",141,0)
 S (PSOFILNM,OR("PSOFILNM"))=$P($P(MSG(OO),"|",4),"^")
"RTN","PSOHLNEW",142,0)
 Q
"RTN","PSOLMUTL")
0^9^B9393494
"RTN","PSOLMUTL",1,0)
PSOLMUTL ;BIR/SAB - listman utilities ;03/07/95
"RTN","PSOLMUTL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**19,46,84,99,131,132**;DEC 1997
"RTN","PSOLMUTL",3,0)
 ;External reference FULL^VALM1 supported by dbia 10116
"RTN","PSOLMUTL",4,0)
 ;External reference $$SETSTR^VALM1 supported by dbia 10116
"RTN","PSOLMUTL",5,0)
 ;External reference EN2^GMRAPEMO supported by dbia 190
"RTN","PSOLMUTL",6,0)
 ;External reference to ^ORD(101 supported by DBIA 872
"RTN","PSOLMUTL",7,0)
 ;
"RTN","PSOLMUTL",8,0)
EN W @IOF S VALMCNT=0
"RTN","PSOLMUTL",9,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) W $C(7),!!?5,"Site parameter must be defined!",! G INITQ
"RTN","PSOLMUTL",10,0)
 D EN^PSOLMPI
"RTN","PSOLMUTL",11,0)
INITQ Q
"RTN","PSOLMUTL",12,0)
HDR ;patient med profile display
"RTN","PSOLMUTL",13,0)
 K VALMHDR S HDR=^TMP("PSOHDR",$J,1,0)
"RTN","PSOLMUTL",14,0)
 S:^TMP("PSOHDR",$J,8,0) X=IORVON_"<A>"_IORVOFF,HDR=$$SETSTR^VALM1(X,HDR,80-$L(X),80) S VALMHDR(1)=HDR
"RTN","PSOLMUTL",15,0)
 S HDR="  PID: "_^TMP("PSOHDR",$J,2,0)
"RTN","PSOLMUTL",16,0)
 S VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_^TMP("PSOHDR",$J,7,0),HDR,52,27)
"RTN","PSOLMUTL",17,0)
 S HDR="  DOB: "_^TMP("PSOHDR",$J,3,0)_" ("_^TMP("PSOHDR",$J,4,0)_")"
"RTN","PSOLMUTL",18,0)
 S VALMHDR(3)=$$SETSTR^VALM1(" Wt(kg): "_^TMP("PSOHDR",$J,6,0),HDR,51,28)
"RTN","PSOLMUTL",19,0)
 S HDR="  SEX: "_$E(^TMP("PSOHDR",$J,5,0),1,44)
"RTN","PSOLMUTL",20,0)
 S VALMHDR(4)=HDR
"RTN","PSOLMUTL",21,0)
 S $P(VALMHDR(5)," ",30)="  "_$E(^TMP("PSOHDR",$J,5,0),48,80)
"RTN","PSOLMUTL",22,0)
 Q:$G(PS)="VIEW"!($G(PS)="DELETE")
"RTN","PSOLMUTL",23,0)
 ;S $P(VALMHDR(5)," ",30)=$E(^TMP("PSOHDR",$J,5,0),48,80)
"RTN","PSOLMUTL",24,0)
 S VALMHDR(6)=^TMP("PSOHDR",$J,9,0)
"RTN","PSOLMUTL",25,0)
 S VALMHDR(7)=^TMP("PSOHDR",$J,10,0)
"RTN","PSOLMUTL",26,0)
 Q
"RTN","PSOLMUTL",27,0)
 ;
"RTN","PSOLMUTL",28,0)
NEWALL(DFN) ; Enter Allergy info.
"RTN","PSOLMUTL",29,0)
 N PSOID D FULL^VALM1,EN2^GMRAPEM0,^PSOORUT2 S VALMBCK="R"
"RTN","PSOLMUTL",30,0)
 Q
"RTN","PSOLMUTL",31,0)
NEWSEL ;allows order selection by number instead of action
"RTN","PSOLMUTL",32,0)
 S Y=$P(XQORNOD(0),"=",2) N VALMCNT D NEWSEL^PSOORNE2
"RTN","PSOLMUTL",33,0)
 Q
"RTN","PSOLMUTL",34,0)
EDTSEL ;allows edit selection by number instead of action - active orders
"RTN","PSOLMUTL",35,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOOREDT
"RTN","PSOLMUTL",36,0)
 Q
"RTN","PSOLMUTL",37,0)
SELAL ;selection of allergy by number instead of action - select allergy
"RTN","PSOLMUTL",38,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D SELAL^PSOORDA
"RTN","PSOLMUTL",39,0)
 Q
"RTN","PSOLMUTL",40,0)
EDTNEW ;allows edit selection by number instead of action - new orders
"RTN","PSOLMUTL",41,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOORNE1
"RTN","PSOLMUTL",42,0)
 Q
"RTN","PSOLMUTL",43,0)
EDTRNEW ;allows edit selection by number instead of action - renew orders
"RTN","PSOLMUTL",44,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOORNE4
"RTN","PSOLMUTL",45,0)
 Q
"RTN","PSOLMUTL",46,0)
EDTPEN ;allows edit selection by number instead of action - pending orders
"RTN","PSOLMUTL",47,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2),SEDT=1 G EDTSEL^PSOORNEW
"RTN","PSOLMUTL",48,0)
 Q
"RTN","PSOLMUTL",49,0)
HLDHDR ;keeps patient's header info
"RTN","PSOLMUTL",50,0)
 S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSOLMUTL",51,0)
 Q
"RTN","PSOLMUTL",52,0)
 ;
"RTN","PSOLMUTL",53,0)
BYPASS S:$G(PSOFDR) SIGOK=1 S Y=-1,VALMBCK="Q"
"RTN","PSOLMUTL",54,0)
 Q
"RTN","PSOLMUTL",55,0)
ACTIONS() ;screen actions on active orders
"RTN","PSOLMUTL",56,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",57,0)
 N DIC,X,Y K DIC,Y S DIC="^ORD(101,"_DA(1)_",10,",X=DA,DIC(0)="ZN" D ^DIC Q:Y<0 0
"RTN","PSOLMUTL",58,0)
 S Y=Y(0,0)
"RTN","PSOLMUTL",59,0)
 I Y="PSO REFILL" Q $S(PSOACT["R":1,1:0)
"RTN","PSOLMUTL",60,0)
 I Y="PSO RENEW" Q $S(PSOACT["N":1,1:0)
"RTN","PSOLMUTL",61,0)
 I Y="PSO REPRINT" Q $S(PSOACT["P":1,1:0)
"RTN","PSOLMUTL",62,0)
 I Y="PSO EDIT ORDERS" Q $S(PSOACT["E":1,1:0)
"RTN","PSOLMUTL",63,0)
 I Y="PSO RELEASE" Q $S(PSOACT["L":1,1:0)
"RTN","PSOLMUTL",64,0)
 I Y="PSO PARTIAL" Q $S(PSOACT["T":1,1:0)
"RTN","PSOLMUTL",65,0)
 I Y="PSO CANCEL" Q $S(PSOACT["D":1,1:0)
"RTN","PSOLMUTL",66,0)
 I Y="PSO HOLD" Q $S(PSOACT["H":1,1:0)
"RTN","PSOLMUTL",67,0)
 I Y="PSO UNHOLD" Q $S(PSOACT["U":1,1:0)
"RTN","PSOLMUTL",68,0)
 I Y="PSO LM BACKDOOR COPY" Q $S(PSOACT["C":1,1:0)
"RTN","PSOLMUTL",69,0)
 I Y="PSO VERIFY" Q $S(PSOACT["V":1,1:0)
"RTN","PSOLMUTL",70,0)
 I Y="PSO ACTIVITY LOGS" Q 1
"RTN","PSOLMUTL",71,0)
 Q 1
"RTN","PSOLMUTL",72,0)
ACTIONS1() ;screen actions on pending orders
"RTN","PSOLMUTL",73,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",74,0)
 N DIC,X,Y K DIC,Y S DIC="^ORD(101,"_DA(1)_",10,",X=DA,DIC(0)="ZN" D ^DIC Q:Y<0 0
"RTN","PSOLMUTL",75,0)
 S Y=Y(0,0)
"RTN","PSOLMUTL",76,0)
 I Y="PSO LM DISCONTINUE" Q $S(PSOACT["D":1,1:0)
"RTN","PSOLMUTL",77,0)
 I Y="PSO LM EDIT" Q $S(PSOACT["E":1,1:0)
"RTN","PSOLMUTL",78,0)
 I Y="PSO LM FINISH" Q $S(PSOACT["F":1,1:0)
"RTN","PSOLMUTL",79,0)
 Q 1
"RTN","PSOLMUTL",80,0)
PKIACT() ;screen actions on pending orders DEA/PKI proj.
"RTN","PSOLMUTL",81,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",82,0)
 Q 1
"RTN","PSONVAR1")
0^23^B37613532
"RTN","PSONVAR1",1,0)
PSONVAR1 ;BHM/MFR - Non-VA Med Usage Report ;04/10/03
"RTN","PSONVAR1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**132**;13 Feb 97
"RTN","PSONVAR1",3,0)
 ;External reference to File ^PS(55 supported by DBIA 2228
"RTN","PSONVAR1",4,0)
 ;External reference to $$GET1^DIQ is supported by DBIA 2056
"RTN","PSONVAR1",5,0)
 ;External reference to ^VADPT is supported by DBIA 10061
"RTN","PSONVAR1",6,0)
 ;External reference to ^XLFDT is supported by DBIA 10103
"RTN","PSONVAR1",7,0)
 ;External reference to ^%ZISC is supported by DBIA 10089
"RTN","PSONVAR1",8,0)
 ;
"RTN","PSONVAR1",9,0)
EN N DATE,DFN,ORD,PAG,PCNT,PRTD,OINAM,PNAM,I,J,Y,X,C,XX,S1,S2,S3,S4,S5,OCNT
"RTN","PSONVAR1",10,0)
 N OCK,OK,STS,SUB,SP1,SP2,SPF
"RTN","PSONVAR1",11,0)
 ;
"RTN","PSONVAR1",12,0)
 U IO K ^TMP("PSONV",$J),^TMP("PSOCNT",$J)
"RTN","PSONVAR1",13,0)
 S SPF=0,(SP1,SP2)="",$P(SP1,"=",80)="",$P(SP2,"-",80)=""
"RTN","PSONVAR1",14,0)
 ;
"RTN","PSONVAR1",15,0)
 ; - Loop through the Non-VA Med orders x-reference
"RTN","PSONVAR1",16,0)
 S DATE=PSOSD,(DFN,ORD)="",(PCNT,OCNT,PRTD)=0 K DIRUT
"RTN","PSONVAR1",17,0)
DATE S DATE=$O(^PS(55,"ADCDT",DATE)) G NEXT:DATE=""!(DATE>PSOED)
"RTN","PSONVAR1",18,0)
 W:SPF SP1
"RTN","PSONVAR1",19,0)
 ;
"RTN","PSONVAR1",20,0)
DFN I PSOAPT S DFN=$O(^PS(55,"ADCDT",DATE,DFN)) G DATE:DFN=""
"RTN","PSONVAR1",21,0)
 I 'PSOAPT S DFN=$O(PSOPT(DFN)) G DATE:DFN=""        ;Patient Filter
"RTN","PSONVAR1",22,0)
 ;
"RTN","PSONVAR1",23,0)
 I $$DEAD^PSONVARP(DFN) G DFN                        ;Patient is Dead
"RTN","PSONVAR1",24,0)
 ;
"RTN","PSONVAR1",25,0)
ORD S ORD=$O(^PS(55,"ADCDT",DATE,DFN,ORD)) G DFN:ORD=""
"RTN","PSONVAR1",26,0)
 S XX=$G(^PS(55,DFN,"NVA",ORD,0))
"RTN","PSONVAR1",27,0)
 I 'PSOAOI,'$D(PSOOI(+$P(XX,"^"))) G ORD             ;OI Filter
"RTN","PSONVAR1",28,0)
 I '$P(XX,"^",6),PSOST="D" G ORD                     ;Status Filter
"RTN","PSONVAR1",29,0)
 I $P(XX,"^",6),PSOST="A" G ORD
"RTN","PSONVAR1",30,0)
 I '$D(^PS(55,DFN,"NVA",ORD,"OCK")),PSOOC="Y" G ORD  ;Order Checks Filter
"RTN","PSONVAR1",31,0)
 I $D(^PS(55,DFN,"NVA",ORD,"OCK")),PSOOC="N" G ORD
"RTN","PSONVAR1",32,0)
 ;
"RTN","PSONVAR1",33,0)
 I PSOSRT=3 D  G CLOSE:$D(DIRUT),ORD                 ;If not Sorting,
"RTN","PSONVAR1",34,0)
 . I $Y>(IOSL-9) D HDR I $D(DIRUT) Q                 ;Print the Report
"RTN","PSONVAR1",35,0)
 . D PRINT(DFN,ORD) Q:$D(DIRUT)  S SPF=1             ;Then G ORD
"RTN","PSONVAR1",36,0)
 ;
"RTN","PSONVAR1",37,0)
 I PSOSRT[1 S PNAM=$$GET1^DIQ(2,DFN,.01)             ;Retrieving Patient
"RTN","PSONVAR1",38,0)
 I PSOSRT[2 S OINAM=$$GET1^DIQ(50.7,+$P(XX,"^"),.01) ;Name and Orderable
"RTN","PSONVAR1",39,0)
 S:$G(PNAM)="" PNAM=0 S:$G(OINAM)="" OINAM=0         ;Item Name
"RTN","PSONVAR1",40,0)
 S (S1,S2,S3,S4,S5)=0
"RTN","PSONVAR1",41,0)
 F I=1:1:$L(PSOSRT,",") D
"RTN","PSONVAR1",42,0)
 . S Y=$P(PSOSRT,",",I),STS=+$P(XX,"^",6)
"RTN","PSONVAR1",43,0)
 . S OCK=$S($D(^PS(55,DFN,"NVA",ORD,"OCK")):1,1:2)
"RTN","PSONVAR1",44,0)
 . S @("S"_I)=$S(Y=1:PNAM,Y=2:OINAM,Y=3:DATE,Y=4:+STS,Y=5:OCK)
"RTN","PSONVAR1",45,0)
 S ^TMP("PSONV",$J,S1,S2,S3,S4,S5,DFN,ORD)=""
"RTN","PSONVAR1",46,0)
 G ORD
"RTN","PSONVAR1",47,0)
 ;
"RTN","PSONVAR1",48,0)
NEXT ; - If not Sorting (already printed), SKIP, otherwise, print the report
"RTN","PSONVAR1",49,0)
 I PSOSRT="" G NDTP
"RTN","PSONVAR1",50,0)
 S (S1,S2,S3,S4,S5,DFN,ORD)=""
"RTN","PSONVAR1",51,0)
 F  S S1=$O(^TMP("PSONV",$J,S1)) Q:S1=""  D  Q:$D(DIRUT)
"RTN","PSONVAR1",52,0)
 . F  S S2=$O(^TMP("PSONV",$J,S1,S2)) Q:S2=""  D  Q:$D(DIRUT)
"RTN","PSONVAR1",53,0)
 . . F  S S3=$O(^TMP("PSONV",$J,S1,S2,S3)) Q:S3=""  D  Q:$D(DIRUT)
"RTN","PSONVAR1",54,0)
 . . . F  S S4=$O(^TMP("PSONV",$J,S1,S2,S3,S4)) Q:S4=""  D  Q:$D(DIRUT)
"RTN","PSONVAR1",55,0)
 . . . . F  S S5=$O(^TMP("PSONV",$J,S1,S2,S3,S4,S5)) Q:S5=""  D  Q:$D(DIRUT)
"RTN","PSONVAR1",56,0)
 . . . . . F  S DFN=$O(^TMP("PSONV",$J,S1,S2,S3,S4,S5,DFN)) Q:DFN=""  D  Q:$D(DIRUT)
"RTN","PSONVAR1",57,0)
 . . . . . . F   S ORD=$O(^TMP("PSONV",$J,S1,S2,S3,S4,S5,DFN,ORD)) Q:ORD=""  D  Q:$D(DIRUT)
"RTN","PSONVAR1",58,0)
 . . . . . . . I $Y>(IOSL-12) D HDR I $D(DIRUT) Q
"RTN","PSONVAR1",59,0)
 . . . . . . . D PRINT(DFN,ORD)
"RTN","PSONVAR1",60,0)
 . . I '$D(DIRUT),S2'=0,$O(^TMP("PSONV",$J,S1,S2))'="" W SP2
"RTN","PSONVAR1",61,0)
 . I '$D(DIRUT),$O(^TMP("PSONV",$J,S1))'="" W SP1
"RTN","PSONVAR1",62,0)
 G CLOSE:$D(DIRUT)
"RTN","PSONVAR1",63,0)
 ;
"RTN","PSONVAR1",64,0)
NDTP I 'PRTD D HDR W !!?18,"**********   NO DATA TO PRINT   **********"
"RTN","PSONVAR1",65,0)
 I PRTD D
"RTN","PSONVAR1",66,0)
 . W SP1
"RTN","PSONVAR1",67,0)
 . W !,"Total: ",PCNT," patient",$S(PCNT>1:"s",1:"")
"RTN","PSONVAR1",68,0)
 . W " and ",OCNT," order",$S(OCNT>1:"s",1:""),"."
"RTN","PSONVAR1",69,0)
 ;
"RTN","PSONVAR1",70,0)
CLOSE D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSONVAR1",71,0)
END K ^TMP("PSONV",$J),^TMP("PSOCNT",$J)
"RTN","PSONVAR1",72,0)
 Q
"RTN","PSONVAR1",73,0)
 ;
"RTN","PSONVAR1",74,0)
PRINT(DFN,ORD) ; - Print a Non-VA Med Order
"RTN","PSONVAR1",75,0)
 ;Input: DFN-Patient;ORD-Non-VA Order#
"RTN","PSONVAR1",76,0)
 N X,XX,K,OI,OIX,OINAM,DGNAM,PNAM,PSSN,CLNAM,PRV,I,J,Z,TXT,VAPA,VADM,SCH
"RTN","PSONVAR1",77,0)
 N STR,OCK
"RTN","PSONVAR1",78,0)
 ;
"RTN","PSONVAR1",79,0)
 I '$D(^PS(55,DFN,"NVA",ORD)) Q
"RTN","PSONVAR1",80,0)
 I '$G(PAG) D HDR I $D(DIRUT) Q
"RTN","PSONVAR1",81,0)
 ;
"RTN","PSONVAR1",82,0)
 S XX=^PS(55,DFN,"NVA",ORD,0),OINAM=$$GET1^DIQ(50.7,+$P(XX,"^"),.01)
"RTN","PSONVAR1",83,0)
 S DGNAM="" I $P(XX,"^",2) S DGNAM=$$GET1^DIQ(50,+$P(XX,"^",2),.01)
"RTN","PSONVAR1",84,0)
 D DEM^VADPT,ADD^VADPT S PNAM=$P(VADM(1),"^"),PSSN=$P($G(VADM(2)),"^",2)
"RTN","PSONVAR1",85,0)
 W !,PNAM," (ID:",$S(PSSN:$P(PSSN,"-",3),1:"0000"),")"
"RTN","PSONVAR1",86,0)
 W ?46,"Patient Phone #: ",$E($P(VAPA(8),"^"),1,16)
"RTN","PSONVAR1",87,0)
 S:'$D(^TMP("PSOCNT",$J,DFN)) PCNT=PCNT+1 S ^TMP("PSOCNT",$J,DFN)=""
"RTN","PSONVAR1",88,0)
 ;
"RTN","PSONVAR1",89,0)
 W !?5,"Non-VA Med: ",OINAM
"RTN","PSONVAR1",90,0)
 W !?2,"Dispense Drug: ",$E(DGNAM,1,37)
"RTN","PSONVAR1",91,0)
 W ?55,"Dosage: ",$E($P(XX,"^",3),1,16)
"RTN","PSONVAR1",92,0)
 W !?7,"Schedule: " S X=$E($P(XX,"^",5),1,30)
"RTN","PSONVAR1",93,0)
 S SCH=$S($L($P(XX,"^",5))>30:$P(X," ",1,$L(X," ")-1),1:X) W SCH
"RTN","PSONVAR1",94,0)
 W ?52,"Med Route: ",$E($P(XX,"^",4),1,35)
"RTN","PSONVAR1",95,0)
 I $E($P(XX,"^",5),$L(SCH)+1,99)'="" D
"RTN","PSONVAR1",96,0)
 . W !?16,$E($P(XX,"^",5),$L(SCH)+1,99)
"RTN","PSONVAR1",97,0)
 W !?9,"Status: ",$S('$P(XX,"^",6):"ACTIVE",1:"DISCONTINUED on "_$$DT($P(XX,"^",7)))
"RTN","PSONVAR1",98,0)
 W ?49,"CPRS Order #: ",$P(XX,"^",8)
"RTN","PSONVAR1",99,0)
 W !?2,"Documented By: ",$E($$GET1^DIQ(200,+$P(XX,"^",11),.01),1,29)
"RTN","PSONVAR1",100,0)
 W ?46,"Documented Date: ",$$DT($P(XX,"^",10))
"RTN","PSONVAR1",101,0)
 S CLNAM=$$GET1^DIQ(44,+$P(XX,"^",12),.01)
"RTN","PSONVAR1",102,0)
 W !?9,"Clinic: " W:$P(XX,"^",12) $E($P(XX,"^",12)_" - "_CLNAM,1,33)
"RTN","PSONVAR1",103,0)
 W ?51,"Start Date: ",$$DT($P(XX,"^",9)),!
"RTN","PSONVAR1",104,0)
 ;
"RTN","PSONVAR1",105,0)
 ; - Printing "Order Checks" fields
"RTN","PSONVAR1",106,0)
 W:$D(^PS(55,DFN,"NVA",ORD,"OCK")) !
"RTN","PSONVAR1",107,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",ORD,"OCK",I)) Q:'I  D  Q:$D(DIRUT)
"RTN","PSONVAR1",108,0)
 . S OCK=^PS(55,DFN,"NVA",ORD,"OCK",I,0),STR=$P(OCK,"^"),PRV=+$P(OCK,"^",2)
"RTN","PSONVAR1",109,0)
 . I $Y>(IOSL-5) D HDR Q:$D(DIRUT)  W !
"RTN","PSONVAR1",110,0)
 . W ?1,"Order Check #",I,": " K TXT D TEXT(.TXT,STR,61)
"RTN","PSONVAR1",111,0)
 . F K=1:1 Q:'$D(TXT(K))  D  Q:$D(DIRUT)
"RTN","PSONVAR1",112,0)
 . . W ?17,TXT(K),! I $Y>(IOSL-4) D HDR Q:$D(DIRUT)  W !
"RTN","PSONVAR1",113,0)
 . Q:$D(DIRUT)  K TXT
"RTN","PSONVAR1",114,0)
 . F J=0:0 S J=$O(^PS(55,DFN,"NVA",ORD,"OCK",I,"OVR",J)) Q:'J  D
"RTN","PSONVAR1",115,0)
 . . S STR=^PS(55,DFN,"NVA",ORD,"OCK",I,"OVR",J,0)
"RTN","PSONVAR1",116,0)
 . . D TEXT(.TXT,STR,56)
"RTN","PSONVAR1",117,0)
 . W ?6,"Override Reason: " W:'$D(TXT) !
"RTN","PSONVAR1",118,0)
 . F K=1:1 Q:'$D(TXT(K))  D  Q:$D(DIRUT)
"RTN","PSONVAR1",119,0)
 . . W ?23,TXT(K),! I $Y>(IOSL-4) D HDR Q:$D(DIRUT)  W !
"RTN","PSONVAR1",120,0)
 . Q:$D(DIRUT)
"RTN","PSONVAR1",121,0)
 . W ?6,"Override Provider: " W:PRV $$GET1^DIQ(200,+PRV,.01) W !
"RTN","PSONVAR1",122,0)
 Q:$D(DIRUT)
"RTN","PSONVAR1",123,0)
 ;
"RTN","PSONVAR1",124,0)
 ; - Printing "Statement/Explanation/Comments" field
"RTN","PSONVAR1",125,0)
 I $D(^PS(55,DFN,"NVA",ORD,"DSC")) D  Q:$D(DIRUT)
"RTN","PSONVAR1",126,0)
 . W !,"Statement/Explanation/Comments: " K TXT
"RTN","PSONVAR1",127,0)
 . F I=0:0 S I=$O(^PS(55,DFN,"NVA",ORD,"DSC",I)) Q:'I  D
"RTN","PSONVAR1",128,0)
 . . S STR=^PS(55,DFN,"NVA",ORD,"DSC",I,0)
"RTN","PSONVAR1",129,0)
 . . D TEXT(.TXT,STR,47)
"RTN","PSONVAR1",130,0)
 . F K=1:1 Q:'$D(TXT(K))  D  Q:$D(DIRUT)
"RTN","PSONVAR1",131,0)
 . . W ?32,TXT(K),! I $Y>(IOSL-4) D HDR Q:$D(DIRUT)  W !
"RTN","PSONVAR1",132,0)
 ;
"RTN","PSONVAR1",133,0)
 S PRTD=1,OCNT=OCNT+1
"RTN","PSONVAR1",134,0)
 Q
"RTN","PSONVAR1",135,0)
 ;
"RTN","PSONVAR1",136,0)
TEXT(TEXT,STR,L) ; Formats STR into TEXT array, lines lenght = L
"RTN","PSONVAR1",137,0)
 N J,WORD,K S K=+$O(TEXT(""),-1) S:'K K=1
"RTN","PSONVAR1",138,0)
 F J=1:1:$L(STR," ") D
"RTN","PSONVAR1",139,0)
 . S WORD=$P(STR," ",J) I ($L($G(TEXT(K))_WORD))>L S K=K+1
"RTN","PSONVAR1",140,0)
 . S TEXT(K)=$G(TEXT(K))_WORD_" "
"RTN","PSONVAR1",141,0)
 Q
"RTN","PSONVAR1",142,0)
 ;
"RTN","PSONVAR1",143,0)
HDR ; - Prints the Header
"RTN","PSONVAR1",144,0)
 N X,DIR S PAG=$G(PAG)+1
"RTN","PSONVAR1",145,0)
 I PAG>1,$E(IOST)="C" D  Q:$D(DIRUT)
"RTN","PSONVAR1",146,0)
 . S DIR(0)="E",DIR("A")=" Press ENTER to Continue or ^ to Exit" D ^DIR
"RTN","PSONVAR1",147,0)
 ;
"RTN","PSONVAR1",148,0)
 W @IOF,"Non-VA Meds Usage Report",?74,"Page: ",$J(PAG,3)
"RTN","PSONVAR1",149,0)
 W !,"Sorted by",$$SRT(PSOSRT)
"RTN","PSONVAR1",150,0)
 W !,"Date Range: "_$$DT(PSOSD+1\1)_" - "_$$DT(PSOED\1)
"RTN","PSONVAR1",151,0)
 W ?48,"Run Date: "_$$FMTE^XLFDT($$NOW^XLFDT())
"RTN","PSONVAR1",152,0)
 S X="",$P(X,"-",80)="" W !,X
"RTN","PSONVAR1",153,0)
 Q
"RTN","PSONVAR1",154,0)
 ;
"RTN","PSONVAR1",155,0)
SRT(ST) ; - Convert the "1,2,4" (example) to "PATIENT,ORDERABLE ITEM,STATUS"
"RTN","PSONVAR1",156,0)
 ;Input: ST-String with the Sorting fields by number
"RTN","PSONVAR1",157,0)
 ;Output: ST-String with the Sorting fields by name
"RTN","PSONVAR1",158,0)
 N I,X,STR,FLD
"RTN","PSONVAR1",159,0)
 S STR="PATIENT NAME^ORDERABLE ITEM^DATE DOCUMENTED^STATUS^ORDER CHECKS"
"RTN","PSONVAR1",160,0)
 F I=1:1:$L(ST,",") D
"RTN","PSONVAR1",161,0)
 . S FLD=+$P(ST,",",I),X=$P(STR,"^",FLD)
"RTN","PSONVAR1",162,0)
 . S $P(ST,",",I)=" "_X
"RTN","PSONVAR1",163,0)
 Q ST
"RTN","PSONVAR1",164,0)
 ;
"RTN","PSONVAR1",165,0)
DT(DT) ; - Convert FM Date to MM/DD/YYYY
"RTN","PSONVAR1",166,0)
 Q $E(DT,4,5)_"/"_$E(DT,6,7)_"/"_(1700+$E(DT,1,3))
"RTN","PSONVARP")
0^14^B23438977
"RTN","PSONVARP",1,0)
PSONVARP ;BHM/MFR - Non-VA Med Usage Report - Input ;04/10/03
"RTN","PSONVARP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**132**;13 Feb 97
"RTN","PSONVARP",3,0)
 ;External reference to ^%DT is supported by DBIA 10003
"RTN","PSONVARP",4,0)
 ;External reference to ^%ZTLOAD is supported by DBIA 10063
"RTN","PSONVARP",5,0)
 ;External reference to ^%ZIS is supported by DBIA 10086
"RTN","PSONVARP",6,0)
 ;External reference to ^DIR is supported by DBIA 10026
"RTN","PSONVARP",7,0)
 ;External reference to ^XLFSTR is supported by DBIA 10104
"RTN","PSONVARP",8,0)
 ;
"RTN","PSONVARP",9,0)
HID ; - Entrhy point from the Hidden Action in the Medication Profile
"RTN","PSONVARP",10,0)
 N PSOHDFLG S PSOHDFLG=1
"RTN","PSONVARP",11,0)
 ;
"RTN","PSONVARP",12,0)
EN N PSOSD,PSOED,PSOST,PSOSRT,PSOAPT,PSOAOI,PSOST,PSOOC,PSOAPT,PSOAOI,I,Y
"RTN","PSONVARP",13,0)
 N OK,X,C,%DT
"RTN","PSONVARP",14,0)
 ;
"RTN","PSONVARP",15,0)
 ; - Ask for FROM DATE DOCUMENTED
"RTN","PSONVARP",16,0)
 S %DT(0)=-DT,%DT="AEP",%DT("A")="FROM DATE DOCUMENTED: "
"RTN","PSONVARP",17,0)
 W ! D ^%DT I Y<0!($D(DTOUT)) G END
"RTN","PSONVARP",18,0)
 S PSOSD=Y\1-.00001
"RTN","PSONVARP",19,0)
 ;
"RTN","PSONVARP",20,0)
ENDT ; - Ask for TO DATE DOCUMENTED
"RTN","PSONVARP",21,0)
 S %DT(0)=PSOSD+1\1,%DT("A")="TO DATE DOCUMENTED: "
"RTN","PSONVARP",22,0)
 W ! D ^%DT I Y<0!($D(DTOUT)) G END
"RTN","PSONVARP",23,0)
 S PSOED=Y\1+.99999
"RTN","PSONVARP",24,0)
 ;
"RTN","PSONVARP",25,0)
 ; - Reported called from a Hidden Action menu
"RTN","PSONVARP",26,0)
 I $G(PSOHDFLG) D  G DEV
"RTN","PSONVARP",27,0)
 . S PSOPT(DFN)="",PSOAPT=0,PSOAOI=1,PSOST="B",PSOOC="B",PSOSRT="4,2"
"RTN","PSONVARP",28,0)
 ;
"RTN","PSONVARP",29,0)
SORT ; - Ask for SORT BY
"RTN","PSONVARP",30,0)
 K DIR S DIR("B")="PATIENT NAME" D HL1("A")
"RTN","PSONVARP",31,0)
SORT1 S PSOSRT="",(PSOAPT,PSOAOI)=1,(PSOST,PSOOC)="B"
"RTN","PSONVARP",32,0)
 S DIR("A")="SORT BY",DIR(0)="FO" D HL1("?")
"RTN","PSONVARP",33,0)
 W ! D ^DIR K DIR I $D(DIRUT) G END
"RTN","PSONVARP",34,0)
 ;
"RTN","PSONVARP",35,0)
 S OK=1,C=15 W !
"RTN","PSONVARP",36,0)
 F I=1:1:$L(Y,",") D
"RTN","PSONVARP",37,0)
 . S X=$P(Y,",",I) S:X'?.N X=$$TRNS(X) I PSOSRT[X Q
"RTN","PSONVARP",38,0)
 . W !?(C-10),$S(I=1:"SORT BY ",1:"THEN BY ") S C=C+5
"RTN","PSONVARP",39,0)
 . I X<1!(X>5) W X,"???",$C(7) S OK=0 Q
"RTN","PSONVARP",40,0)
 . W $P("PATIENT NAME^ORDERABLE ITEM^DATE DOCUMENTED^STATUS^ORDER CHECKS","^",X)
"RTN","PSONVARP",41,0)
 . S PSOSRT=PSOSRT_","_X
"RTN","PSONVARP",42,0)
 I 'OK S DIR("B")=Y G SORT1
"RTN","PSONVARP",43,0)
 S $E(PSOSRT)=""
"RTN","PSONVARP",44,0)
 ;
"RTN","PSONVARP",45,0)
 S OK=1
"RTN","PSONVARP",46,0)
 F I=1:1:$L(PSOSRT,",") D  I 'OK Q
"RTN","PSONVARP",47,0)
 . S X=$P(PSOSRT,",",I) D:X'=3 @("SRT"_X)
"RTN","PSONVARP",48,0)
 I 'OK S DIR("B")="PATIENT NAME" G SORT1
"RTN","PSONVARP",49,0)
 ;
"RTN","PSONVARP",50,0)
DEV W ! K %ZIS,IOP,POP,ZTSK S %ZIS="QM" D ^%ZIS K %ZIS I POP G END
"RTN","PSONVARP",51,0)
 I $D(IO("Q")) D  G END
"RTN","PSONVARP",52,0)
 . N G K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK
"RTN","PSONVARP",53,0)
 . S ZTRTN="EN^PSONVAR1",ZTDESC="Non-VA Meds Usage Report"
"RTN","PSONVARP",54,0)
 . F G="PSOSD","PSOED","PSOSRT","PSOPT","PSOOI" S:$D(@G) ZTSAVE(G)=""
"RTN","PSONVARP",55,0)
 . F G="PSOST","PSOOC","PSOAPT","PSOAOI" S:$D(@G) ZTSAVE(G)=""
"RTN","PSONVARP",56,0)
 . S:$D(PSOPT) ZTSAVE("PSOPT(")="" S:$D(PSOOI) ZTSAVE("PSOOI(")=""
"RTN","PSONVARP",57,0)
 . D ^%ZTLOAD W:$D(ZTSK) !,"Report is Queued to print !!" K ZTSK
"RTN","PSONVARP",58,0)
 ;
"RTN","PSONVARP",59,0)
 G EN^PSONVAR1
"RTN","PSONVARP",60,0)
 ;
"RTN","PSONVARP",61,0)
END Q
"RTN","PSONVARP",62,0)
 ;
"RTN","PSONVARP",63,0)
SRT1 ; - Selection of PATIENTS to print on the Report
"RTN","PSONVARP",64,0)
 N DIC,X,I K PSOPT S PSOAPT=0
"RTN","PSONVARP",65,0)
 W !!,?5,"You may select a single or multiple PATIENTS,"
"RTN","PSONVARP",66,0)
 W !,?5,"or enter ^ALL to select all PATIENTS.",!
"RTN","PSONVARP",67,0)
 S DIC=2,DIC(0)="QEAM",DIC("A")="     PATIENT: "
"RTN","PSONVARP",68,0)
 F  D ^DIC Q:Y<0  S:'$$DEAD(+Y,1) PSOPT(+Y)="" K DIC("B")
"RTN","PSONVARP",69,0)
 I X="^ALL" S PSOAPT=1 K PSOPT,DUOUT Q
"RTN","PSONVARP",70,0)
 I $D(DUOUT)!($D(DTOUT)) S OK=0 Q
"RTN","PSONVARP",71,0)
 I '$D(PSOPT),Y<0 S OK=0 Q
"RTN","PSONVARP",72,0)
 Q
"RTN","PSONVARP",73,0)
 ;
"RTN","PSONVARP",74,0)
SRT2 ; - Selection of ORDERABLE ITEMS to print on the Report
"RTN","PSONVARP",75,0)
 N DIC,X,I K PSOOI S PSOAOI=0
"RTN","PSONVARP",76,0)
 W !!,?5,"You may select a single or multiple ORDERABLE ITEMS,"
"RTN","PSONVARP",77,0)
 W !,?5,"or enter ^ALL to select all ORDERABLE ITEMS.",!
"RTN","PSONVARP",78,0)
 S DIC=50.7,DIC(0)="QEAM",DIC("A")="     ORDERABLE ITEM: "
"RTN","PSONVARP",79,0)
 F  D ^DIC Q:Y<0  S PSOOI(+Y)="" K DIC("B")
"RTN","PSONVARP",80,0)
 I X="^ALL" S PSOAOI=1 K PSOOI,DUOUT Q
"RTN","PSONVARP",81,0)
 I $D(DUOUT)!($D(DTOUT)) S OK=0 Q
"RTN","PSONVARP",82,0)
 I '$D(PSOOI)&(Y<0) S OK=0 Q
"RTN","PSONVARP",83,0)
 Q
"RTN","PSONVARP",84,0)
 ;
"RTN","PSONVARP",85,0)
SRT4 ; - Selection of STATUS to print on the Report
"RTN","PSONVARP",86,0)
 N DIR,X,I K PSOST
"RTN","PSONVARP",87,0)
 W !!,?5,"You may select (A)CTIVE, (D)ISCONTINUED or (B)OTH status.",!
"RTN","PSONVARP",88,0)
 S DIR(0)="SAO^A:ACTIVE;D:DISCONTINUED;B:BOTH"
"RTN","PSONVARP",89,0)
 S DIR("A")="     STATUS: ",DIR("B")="ACTIVE" D ^DIR
"RTN","PSONVARP",90,0)
 I $D(DIRUT) S OK=0 Q
"RTN","PSONVARP",91,0)
 S PSOST=Y
"RTN","PSONVARP",92,0)
 Q
"RTN","PSONVARP",93,0)
 ;
"RTN","PSONVARP",94,0)
SRT5 ; - Selection of ORDER CHECKS to print on the Report
"RTN","PSONVARP",95,0)
 N DIR,X,OP1,OP2 K PSOOC
"RTN","PSONVARP",96,0)
 S OP1="ORDERS WITH ORDER CHECKS ONLY"
"RTN","PSONVARP",97,0)
 S OP2="ORDERS WITHOUT ORDER CHECKS ONLY"
"RTN","PSONVARP",98,0)
 W !!,?5,"You may select 'Y' to print ",OP1,","
"RTN","PSONVARP",99,0)
 W !?5,"'N' to print ",OP2," or 'B' for BOTH.",!
"RTN","PSONVARP",100,0)
 S DIR(0)="SAO^Y:"_OP1_";N:"_OP2_";B:BOTH"
"RTN","PSONVARP",101,0)
 S DIR("A")="     ORDER CHECKS: ",DIR("B")="BOTH" D ^DIR
"RTN","PSONVARP",102,0)
 I $D(DIRUT) S OK=0 Q
"RTN","PSONVARP",103,0)
 S PSOOC=Y
"RTN","PSONVARP",104,0)
 Q
"RTN","PSONVARP",105,0)
 ;
"RTN","PSONVARP",106,0)
TRNS(X) ; - Translates Alpha into the corresponding Sorting Code
"RTN","PSONVARP",107,0)
 N L,UPX S L=$L(X),UPX=$$UP^XLFSTR(X)
"RTN","PSONVARP",108,0)
 I $E("PATIENT NAME",1,L)=UPX Q 1
"RTN","PSONVARP",109,0)
 I $E("ORDERABLE ITEM",1,L)=UPX Q 2
"RTN","PSONVARP",110,0)
 I $E("DATE DOCUMENTED",1,L)=UPX Q 3
"RTN","PSONVARP",111,0)
 I $E("STATUS",1,L)=UPX Q 4
"RTN","PSONVARP",112,0)
 I $E("ORDER CHECKS",1,L)=UPX Q 5
"RTN","PSONVARP",113,0)
 Q X
"RTN","PSONVARP",114,0)
 ;
"RTN","PSONVARP",115,0)
DEAD(DFN,DSPL) ; Check if Patient has a Date Of Death on File
"RTN","PSONVARP",116,0)
 N VADM,Y
"RTN","PSONVARP",117,0)
 I '$G(DFN) Q 0
"RTN","PSONVARP",118,0)
 D DEM^VADPT I $G(VADM(6))="" Q 0
"RTN","PSONVARP",119,0)
 I $G(DSPL) W !?10,$P($G(VADM(1)),"^")," (",$P($G(VADM(2)),"^",2),") DIED ",$P($G(VADM(6)),"^",2),$G(7)
"RTN","PSONVARP",120,0)
 Q 1
"RTN","PSONVARP",121,0)
 ;
"RTN","PSONVARP",122,0)
HL1(S) ; - Help for the SORT BY prompt
"RTN","PSONVARP",123,0)
 S DIR(S,1)="    Enter the SORT field(s) for this Report:"
"RTN","PSONVARP",124,0)
 S DIR(S,2)=" "
"RTN","PSONVARP",125,0)
 S DIR(S,3)="       1 - PATIENT NAME"
"RTN","PSONVARP",126,0)
 S DIR(S,4)="       2 - ORDERABLE ITEM"
"RTN","PSONVARP",127,0)
 S DIR(S,5)="       3 - DATE DOCUMENTED"
"RTN","PSONVARP",128,0)
 S DIR(S,6)="       4 - STATUS"
"RTN","PSONVARP",129,0)
 S DIR(S,7)="       5 - ORDER CHECKS"
"RTN","PSONVARP",130,0)
 S DIR(S,8)=" "
"RTN","PSONVARP",131,0)
 S DIR(S,9)="    Or any combination of the above, separated by comma,"
"RTN","PSONVARP",132,0)
 S DIR(S,10)="    as in these examples:"
"RTN","PSONVARP",133,0)
 S DIR(S,11)=" "
"RTN","PSONVARP",134,0)
 S DIR(S,12)="       2,1  - BY ORDERABLE ITEM, THEN BY PATIENT NAME"
"RTN","PSONVARP",135,0)
 S DIR(S,13)="      5,1,4 - BY ORDER CHECKS, THEN BY PATIENT NAME, THEN BY STATUS"
"RTN","PSONVARP",136,0)
 S DIR(S,14)=" "
"RTN","PSONVARP",137,0)
 S DIR(S)=" "
"RTN","PSONVARP",138,0)
 Q
"RTN","PSONVNEW")
0^26^B27586427
"RTN","PSONVNEW",1,0)
PSONVNEW ;BIR/SAB - Add Non-VA Med orders ;7/15/03
"RTN","PSONVNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**132**;DEC 1997
"RTN","PSONVNEW",3,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSONVNEW",4,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSONVNEW",5,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSONVNEW",6,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSONVNEW",7,0)
 ;adds new non-va med to #55
"RTN","PSONVNEW",8,0)
 ;
"RTN","PSONVNEW",9,0)
 I '$D(^PS(55,DFN,0)) D
"RTN","PSONVNEW",10,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=DFN,DIC("DR")="52.1////2" D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSONVNEW",11,0)
 ..S $P(^PS(55,DFN,0),"^")=DFN,$P(^(0),"^",6)=2
"RTN","PSONVNEW",12,0)
 ..K DIK S DA=DFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSONVNEW",13,0)
 ;
"RTN","PSONVNEW",14,0)
 ;
"RTN","PSONVNEW",15,0)
 N PSONVA,SCH,SCHED,SDL,SGL,ZSB,W,WW,SZZ,DSC K HOLD,PCOM
"RTN","PSONVNEW",16,0)
 F I=0:0 S I=$O(MSG(I)) Q:'I  D
"RTN","PSONVNEW",17,0)
 .I $P(MSG(I),"|")="NTE",$P(MSG(I),"|",2)=6 S DSC=$G(DSC)+1 S PCOM(DSC)=$P(MSG(I),"|",4) F T=0:0 S T=$O(MSG(I,T)) Q:'T  S DSC=DSC+1,PCOM(DSC)=MSG(I,T)
"RTN","PSONVNEW",18,0)
 .I $P(MSG(I),"|")="ORC" S STDT=$P(MSG(I),"|",8),STRDT=$$HL7TFM^XLFDT($P(STDT,"^",4))
"RTN","PSONVNEW",19,0)
 F IV=0:0 S IV=$O(^PS(55,DFN,"NVA",IV)) Q:'IV  S PSONVA=$G(PSONVA)+1
"RTN","PSONVNEW",20,0)
 K IV,DSC,STDT
"RTN","PSONVNEW",21,0)
 S PSONVA=$G(PSONVA)+1,^PS(55,DFN,"NVA",0)="^55.05P^"_PSONVA_"^"_PSONVA
"RTN","PSONVNEW",22,0)
 S ^PS(55,DFN,"NVA",PSONVA,0)=PSORDITE_"^"_PSODDRUG
"RTN","PSONVNEW",23,0)
 S ^PS(55,DFN,"NVA","B",$E(PSORDITE,1,30),PSONVA)=""
"RTN","PSONVNEW",24,0)
 S $P(^PS(55,DFN,"NVA",PSONVA,0),"^",11)=$G(ENTERED),$P(^(0),"^",10)=$G(PSOLOG),$P(^(0),"^",12)=$G(LOCATION)
"RTN","PSONVNEW",25,0)
 S ^PS(55,"ADCDT",$E(PSOLOG,1,30),DFN,PSONVA)="",SCH=$P($G(QTARRAY(1)),"^")
"RTN","PSONVNEW",26,0)
 S $P(^PS(55,DFN,"NVA",PSONVA,0),"^",8)=PLACER,$P(^(0),"^",9)=$G(STRDT)
"RTN","PSONVNEW",27,0)
 S $P(^PS(55,DFN,"NVA",PSONVA,0),"^",3)=$G(PSOLQ1I(1)) ;,$P(^(0),"^",5)=$P($G(QTARRAY(1)),"^")
"RTN","PSONVNEW",28,0)
 I $G(SCH)]"" D
"RTN","PSONVNEW",29,0)
 .S SGL=0 F W=0:0 S W=$O(^PS(51.1,"B",SCH,W)) Q:'W!($G(SGL))  I $P($G(^PS(51.1,W,0)),"^",8)'="" S SCHED=$P($G(^(0)),"^",8),SGL=1
"RTN","PSONVNEW",30,0)
 .Q:$G(SGL)
"RTN","PSONVNEW",31,0)
 .I $G(^PS(51,"A",SCH))'="" S SCHED=$P(^PS(51,"A",SCH),"^") Q
"RTN","PSONVNEW",32,0)
 .S ZSB=0 F ZZS=1:1:$L(SCH) S SZZ=$E(SCH,ZZS) I SZZ=" " S ZSB=ZSB+1
"RTN","PSONVNEW",33,0)
 .S ZSB=ZSB+1 K HOLD F Z=1:1:ZSB S (SDL,HOLD(Z))=$P(SCH," ",Z) D
"RTN","PSONVNEW",34,0)
 ..Q:$G(SDL)=""
"RTN","PSONVNEW",35,0)
 ..S SGL=0 F WW=0:0 S WW=$O(^PS(51.1,"B",SDL,WW)) Q:'WW!($G(SGLFLAG))  I $P($G(^PS(51.1,WW,0)),"^",8)'="" S HOLD(Z)=$P($G(^(0)),"^",8),SGL=1
"RTN","PSONVNEW",36,0)
 ..Q:$G(SGL)
"RTN","PSONVNEW",37,0)
 ..I $G(^PS(51,"A",SDL))]"" S HOLD(Z)=$P(^(SDL),"^")
"RTN","PSONVNEW",38,0)
 .S SCHED="",SGL=0 F WW=1:1:ZSB S SCHED=SCHED_$S($G(SGL):" ",1:"")_$G(HOLD(WW)),SGL=1
"RTN","PSONVNEW",39,0)
 I $G(SCHED)]"" S $P(^PS(55,DFN,"NVA",PSONVA,0),"^",5)=SCHED
"RTN","PSONVNEW",40,0)
 I $G(ROUTE(1)) S $P(^PS(55,DFN,"NVA",PSONVA,0),"^",4)=$S($P($G(^PS(51.2,ROUTE(1),0)),"^",2)]"":$P(^PS(51.2,ROUTE(1),0),"^",2),1:$P(^PS(51.2,ROUTE(1),0),"^"))
"RTN","PSONVNEW",41,0)
 I $P(PSODSC,"^",2)]"" D
"RTN","PSONVNEW",42,0)
 .S DSC=1,^PS(55,DFN,"NVA",PSONVA,"DSC",1,0)=$P(PSODSC,"^",2)
"RTN","PSONVNEW",43,0)
 .S ^PS(55,DFN,"NVA",PSONVA,"DSC",0)="^55.052^1^1^"_DT_"^^^^"
"RTN","PSONVNEW",44,0)
 I $O(PSODSC(0)) D
"RTN","PSONVNEW",45,0)
 .F T=0:0 S T=$O(PSODSC(T)) Q:'T  S DSC=$G(DSC)+1,^PS(55,DFN,"NVA",PSONVA,"DSC",DSC,0)=PSODSC(T)
"RTN","PSONVNEW",46,0)
 .S ^PS(55,DFN,"NVA",PSONVA,"DSC",0)="^55.052^"_DSC_"^"_DSC_"^"_DT_"^^^^"
"RTN","PSONVNEW",47,0)
 I $O(PCOM(0)) F T=0:0 S T=$O(PCOM(T)) Q:'T  D
"RTN","PSONVNEW",48,0)
 .S DSC=$G(DSC)+1,^PS(55,DFN,"NVA",PSONVA,"DSC",DSC,0)=PCOM(T)
"RTN","PSONVNEW",49,0)
 .S ^PS(55,DFN,"NVA",PSONVA,"DSC",0)="^55.052^"_DSC_"^"_DSC_"^"_DT_"^^^^"
"RTN","PSONVNEW",50,0)
 .S ^PS(55,DFN,"NVA",PSONVA,1,T,0)=PCOM(T)
"RTN","PSONVNEW",51,0)
 .S ^PS(55,DFN,"NVA",PSONVA,1,0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSONVNEW",52,0)
 I $G(OCOUNT) S ^PS(55,DFN,"NVA",PSONVA,"OCK",0)="^55.051^"_OCOUNT_"^"_OCOUNT F OCOUNT=1:1:OCOUNT D
"RTN","PSONVNEW",53,0)
 .S ^PS(55,DFN,"NVA",PSONVA,"OCK",OCOUNT,0)=$G(OBXAR(OCOUNT,1))_"^"_PROV
"RTN","PSONVNEW",54,0)
 .I $G(OBXAR(OCOUNT,1))]"" S ^PS(55,DFN,"NVA",PSONVA,"OCK","B",$E(OBXAR(OCOUNT,1),1,30),OCOUNT)=""
"RTN","PSONVNEW",55,0)
 .S PSOBCT=1 F LLL=2:1 Q:'$D(OBXAR(OCOUNT,LLL))  S ^PS(55,DFN,"NVA",PSONVA,"OCK",OCOUNT,"OVR",1,0)=OBXAR(OCOUNT,LLL)
"RTN","PSONVNEW",56,0)
 K HOLD,SCH,SCHED,SDL,SGL,ZSB,W,WW,SZZ,STRDT
"RTN","PSONVNEW",57,0)
 ;
"RTN","PSONVNEW",58,0)
 ;
"RTN","PSONVNEW",59,0)
 M PMSG=MSG
"RTN","PSONVNEW",60,0)
REIN  K MSG S NULLFLDS="F JJ=0:1:LIMIT S FIELD(JJ)="""""
"RTN","PSONVNEW",61,0)
 K ^UTILITY("DIQ1",$J),DIQ S DA=$P($$SITE^VASITE(),"^")
"RTN","PSONVNEW",62,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOHINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIQ,DIC
"RTN","PSONVNEW",63,0)
 S MSG(1)="MSH|^~\&|PHARMACY|"_$G(PSOHINST)_"|||||ORR"
"RTN","PSONVNEW",64,0)
 ;
"RTN","PSONVNEW",65,0)
 S COUNT=1,LIMIT=5 X NULLFLDS D DEM^VADPT S NAME=$G(VADM(1)) K VADM
"RTN","PSONVNEW",66,0)
 S FIELD(0)="PID",FIELD(3)=DFN,FIELD(5)=NAME
"RTN","PSONVNEW",67,0)
 D SEG^PSOHLSN1
"RTN","PSONVNEW",68,0)
 ;
"RTN","PSONVNEW",69,0)
 ;
"RTN","PSONVNEW",70,0)
 S LIMIT=19 X NULLFLDS
"RTN","PSONVNEW",71,0)
 S FIELD(0)="PV1",FIELD(2)="O",FIELD(3)=LOCATION
"RTN","PSONVNEW",72,0)
 D SEG^PSOHLSN1
"RTN","PSONVNEW",73,0)
 ;
"RTN","PSONVNEW",74,0)
 S LIMIT=15 X NULLFLDS
"RTN","PSONVNEW",75,0)
 S FIELD(0)="ORC",FIELD(1)=$S($G(REIN):"SC",1:"OK"),FIELD(2)=PLACER_"^OR",FIELD(3)=PSONVA_"N^PS",FIELD(5)="CM"
"RTN","PSONVNEW",76,0)
 S FIELD(10)=$P(^PS(55,DFN,"NVA",PSONVA,0),"^",11)_"^"_$P(^VA(200,$P(^PS(55,DFN,"NVA",PSONVA,0),"^",11),0),"^")
"RTN","PSONVNEW",77,0)
 D SEG^PSOHLSN1
"RTN","PSONVNEW",78,0)
 I $G(REIN) S MSG(COUNT)=MSG(COUNT)_"|^^^^DATE OF DEATH DELETED BY MAS.^"
"RTN","PSONVNEW",79,0)
 ;
"RTN","PSONVNEW",80,0)
 S LIMIT=1 X NULLFLDS
"RTN","PSONVNEW",81,0)
 S FIELD(0)="RXO",OI=$P(^PS(55,DFN,"NVA",PSONVA,0),"^")
"RTN","PSONVNEW",82,0)
 S FIELD(1)="^^^"_OI_"^"_$P($G(^PS(50.7,OI,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")_"^99PSP"
"RTN","PSONVNEW",83,0)
 D SEG^PSOHLSN1
"RTN","PSONVNEW",84,0)
 ;
"RTN","PSONVNEW",85,0)
 S LIMIT=1 X NULLFLDS
"RTN","PSONVNEW",86,0)
 S FIELD(0)="RXE"
"RTN","PSONVNEW",87,0)
 S PSOPSTRT="",X=$P(^PS(55,DFN,"NVA",PSONVA,0),"^",9) I X S PSOPSTRT=$$FMTHL7^XLFDT(X)
"RTN","PSONVNEW",88,0)
 K X S FIELD(1)="^^^"_$G(PSOPSTRT)_"^"
"RTN","PSONVNEW",89,0)
 D SEG^PSOHLSN1
"RTN","PSONVNEW",90,0)
 ;
"RTN","PSONVNEW",91,0)
 D SEND^PSOHLSN1 K FIELDS,LIMIT,PSODSC,PSONVA,OI Q:$G(REIN)
"RTN","PSONVNEW",92,0)
 ;dc change order
"RTN","PSONVNEW",93,0)
DC F OO=0:0 S OO=$O(PMSG(OO)) Q:'OO  I $P(PMSG(OO),"|")="ORC",$P(PMSG(OO),"|",2)="XO" D  Q
"RTN","PSONVNEW",94,0)
 .F XO=0:0 S XO=$O(PMSG(XO)) Q:'XO  I $P(PMSG(XO),"|")="ZRX" S POERR("PSOFILNM")=$P(PMSG(XO),"|",2) Q
"RTN","PSONVNEW",95,0)
 I +$G(POERR("PSOFILNM")),$G(^PS(55,DFN,"NVA",+$G(POERR("PSOFILNM")),0)) S PDFN=DFN D XO^PSOORUTL
"RTN","PSONVNEW",96,0)
 K XO,OO,PMSG
"RTN","PSONVNEW",97,0)
 Q
"RTN","PSONVNEW",98,0)
APSOD ;dc non-va meds because of date of death entry called from psocan3
"RTN","PSONVNEW",99,0)
 N PDA,PDFN ;,POERR("PSOFILNM")
"RTN","PSONVNEW",100,0)
 F PDA=0:0 S PDA=$O(^PS(55,PSODFN,"NVA",PDA)) Q:'PDA  I '$P(^PS(55,PSODFN,"NVA",PDA,0),"^",6),'$P(^(0),"^",7) D
"RTN","PSONVNEW",101,0)
 .S POERR("PSOFILNM")=PDA,PDFN=PSODFN D XO^PSOORUTL
"RTN","PSOORDRG")
0^6^B36756976
"RTN","PSOORDRG",1,0)
PSOORDRG ;BIR/SAB - order entry drug selection ;11/13/97
"RTN","PSOORDRG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,29,49,46,81,105,134,144,132**;DEC 1997
"RTN","PSOORDRG",3,0)
 ;External references to ^PSJORUT2 supported by DBIA 2376
"RTN","PSOORDRG",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORDRG",5,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOORDRG",6,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORDRG",7,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORDRG",8,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSOORDRG",9,0)
 ;External reference to ^PS(50.416 supported by DBIA 692
"RTN","PSOORDRG",10,0)
 ;External reference to DDIEX^PSNAPIS supported by DBIA 2574
"RTN","PSOORDRG",11,0)
EN(PSODFN,DREN) ;
"RTN","PSOORDRG",12,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC"),PSOPHI S INDX=0
"RTN","PSOORDRG",13,0)
 ;build patient's drug profile outpat/inpat/non-va
"RTN","PSOORDRG",14,0)
 D BLD,ENCHK^PSJORUT2(PSODFN,.INDX),NVA
"RTN","PSOORDRG",15,0)
 ;collect drug info
"RTN","PSOORDRG",16,0)
DRG ;S X=DREN,DIC="^PSDRUG(",DIC(0)="MQNZO" D ^DIC K DIC,PSOY Q:Y<1  S PSOY=Y,PSOY(0)=Y(0) K X,Y
"RTN","PSOORDRG",17,0)
 S PSOY=DREN_"^"_$P($G(^PSDRUG(DREN,0)),"^"),PSOY(0)=$G(^PSDRUG(DREN,0)) K X,Y
"RTN","PSOORDRG",18,0)
 S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2),PSODRUG("NAME")=$P(PSOY(0),"^")
"RTN","PSOORDRG",19,0)
 S:+$G(^PSDRUG(+PSOY,2)) PSODRUG("OI")=+$G(^(2)),PSODRUG("OIN")=$P(^PS(50.7,+$G(^(2)),0),"^")
"RTN","PSOORDRG",20,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(+PSOY,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORDRG",21,0)
 S PSODRUG("MAXDOSE")=$P(PSOY(0),"^",4),PSODRUG("DEA")=$P(PSOY(0),"^",3),PSODRUG("CLN")=$S($D(^PSDRUG(+PSOY,"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSOORDRG",22,0)
 S PSODRUG("SIG")=$P(PSOY(0),"^",5),PSODRUG("NDC")=$P($G(^PSDRUG(+PSOY,2)),"^",4)
"RTN","PSOORDRG",23,0)
 S PSOX1=$G(^PSDRUG(+PSOY,660)),PSODRUG("COST")=$P($G(PSOX1),"^",6),PSODRUG("UNIT")=$P($G(PSOX1),"^",8),PSODRUG("EXPIRATION DATE")=$P($G(PSOX1),"^",9)
"RTN","PSOORDRG",24,0)
 K PSOX1,PSOY Q:$G(POERR)
"RTN","PSOORDRG",25,0)
 ;dup drug/class check
"RTN","PSOORDRG",26,0)
 S DNM=0 F  S DNM=$O(^TMP($J,"ORDERS",DNM)) Q:'DNM  D
"RTN","PSOORDRG",27,0)
 .S DRNM=$P(^TMP($J,"ORDERS",DNM),"^",3)
"RTN","PSOORDRG",28,0)
 .I PSODRUG("NAME")=DRNM S DD=$G(DD)+1,^TMP($J,"DD",DD,0)=PSODRUG("IEN")_"^"_PSODRUG("NAME")_"^"_$P(^TMP($J,"ORDERS",DNM),"^",4)_"^"_$P(^(DNM),"^",5) Q:'$G(PSOPHI)
"RTN","PSOORDRG",29,0)
 .I PSODRUG("VA CLASS")]"",$E(PSODRUG("VA CLASS"),1,4)=$E($P(^TMP($J,"ORDERS",DNM),"^"),1,4),DRNM'=PSODRUG("NAME") D
"RTN","PSOORDRG",30,0)
 ..I $E(PSODRUG("VA CLASS"),1,2)="HA",$E($P(^TMP($J,"ORDERS",DNM),"^"),1,2)="HA" Q
"RTN","PSOORDRG",31,0)
 ..S PSODC=$O(^PS(50.605,"B",PSODRUG("VA CLASS"),0)) Q:'PSODC
"RTN","PSOORDRG",32,0)
 ..S DC=$G(DC)+1,^TMP($J,"DC",DC,0)=PSODRUG("VA CLASS")
"RTN","PSOORDRG",33,0)
 ..S PSODC=$P(^PS(50.605,PSODC,0),"^",2),^TMP($J,"DC",DC,0)=^TMP($J,"DC",DC,0)_"^"_PSODC_"^"_$O(^PSDRUG("B",DRNM,0))_"^"_DRNM_"^"_$P(^TMP($J,"ORDERS",DNM),"^",4)_"^"_$P(^(DNM),"^",5)
"RTN","PSOORDRG",34,0)
 ;drug interaction check
"RTN","PSOORDRG",35,0)
 S DRG=0 F  S DRG=$O(^TMP($J,"ORDERS",DRG)) Q:'DRG  S NDF=$P(^TMP($J,"ORDERS",DRG),"^",2),IT=$O(^PS(56,"APD",NDF,PSODRUG("NDF"),0)) I IT D
"RTN","PSOORDRG",36,0)
 .Q:$$DDIEX^PSNAPIS($P(NDF,"A"),$P(NDF,"A",2))
"RTN","PSOORDRG",37,0)
 .Q:$$DDIEX^PSNAPIS($P(PSODRUG("NDF"),"A"),$P(PSODRUG("NDF"),"A",2))
"RTN","PSOORDRG",38,0)
 .Q:$P(^PS(56,IT,0),"^",7)&($P(^PS(56,IT,0),"^",7)<DT)
"RTN","PSOORDRG",39,0)
 .S DRNM=$P(^TMP($J,"ORDERS",DRG),"^",3),ORN=$P(^(DRG),"^",4),RXN=$P(^(DRG),"^",5)
"RTN","PSOORDRG",40,0)
 .S DI=$G(DI)+1,^TMP($J,"DI",DI,0)=$O(^PSDRUG("B",DRNM,0))_"^"_DRNM_"^"_IT_"^"_$S($P(^PS(56,IT,0),"^",4)=1:"CRITICAL",1:"SIGNIFICANT")_"^"
"RTN","PSOORDRG",41,0)
 .S ^TMP($J,"DI",DI,0)=^TMP($J,"DI",DI,0)_$P(^PS(50.416,$P(^PS(56,IT,0),"^",2),0),"^")_"^"_$P(^PS(50.416,$P(^PS(56,IT,0),"^",3),0),"^")_"^"_ORN_"^"_RXN
"RTN","PSOORDRG",42,0)
 Q:$G(PSOPHI)
"RTN","PSOORDRG",43,0)
EXIT K ^TMP($J,"ORDERS"),DFN,DA,DNM,DUPRX0,RX,Y,ZZ,PSOCLOZ,PSOY,DRG,DNM,DD,DI,DC,IT,PSODRUG,PSOY,ORN,DRNM
"RTN","PSOORDRG",44,0)
 K PSOX,EXPDT,PSODRUG0,PSORX0,PSORX2,PSORX3,PSOST0,PSOVACL,X,Y,X1,X2,RXN
"RTN","PSOORDRG",45,0)
 Q
"RTN","PSOORDRG",46,0)
BLD K ^TMP($J,"ORDERS") I '$D(PSODFN)!('$D(DT)) G EXIT
"RTN","PSOORDRG",47,0)
 S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X D BUILD G GETX
"RTN","PSOORDRG",48,0)
 Q
"RTN","PSOORDRG",49,0)
BUILD ;build profiles
"RTN","PSOORDRG",50,0)
 S EXPDT=PSODTCUT-1,RX=0
"RTN","PSOORDRG",51,0)
 F  S EXPDT=$O(^PS(55,PSODFN,"P","A",EXPDT)) Q:'EXPDT  F  S RX=$O(^PS(55,PSODFN,"P","A",EXPDT,RX)) Q:'RX  I $D(^PSRX(RX,0)) D GET
"RTN","PSOORDRG",52,0)
 S EN=0
"RTN","PSOORDRG",53,0)
 F PSOEN=0:0 S PSOEN=$O(^PS(52.41,"AOR",PSODFN,PSOEN)) Q:'PSOEN  D
"RTN","PSOORDRG",54,0)
 .F  S EN=$O(^PS(52.41,"AOR",PSODFN,PSOEN,EN)) Q:'EN  D
"RTN","PSOORDRG",55,0)
 ..S PSOOI=^PS(52.41,EN,0) I $P(PSOOI,"^",3)'="DC"&($P(PSOOI,"^",3)'="DE") D:'$P(^PS(52.41,EN,0),"^",9) BLDOI I $P(^PS(52.41,EN,0),"^",9) S PSODD=+$P(PSOOI,"^",9) D SETTMP
"RTN","PSOORDRG",56,0)
 D BUILDX
"RTN","PSOORDRG",57,0)
 Q
"RTN","PSOORDRG",58,0)
 ;
"RTN","PSOORDRG",59,0)
BLDOI ;If no DD/non-standard dose, get all drugs for OI
"RTN","PSOORDRG",60,0)
 N PSOI S PSOI=$P(PSOOI,"^",8) Q:'PSOOI
"RTN","PSOORDRG",61,0)
 S PSODD="" F  S PSODD=$O(^PSDRUG("ASP",PSOI,PSODD)) Q:'PSODD  D SETTMP
"RTN","PSOORDRG",62,0)
 Q
"RTN","PSOORDRG",63,0)
 ;
"RTN","PSOORDRG",64,0)
SETTMP ;Create ^TMP($J,"ORDERS"
"RTN","PSOORDRG",65,0)
 Q:$P(PSOOI,"^",3)="RF"
"RTN","PSOORDRG",66,0)
 S DRG=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),1:"") Q:DRG']""
"RTN","PSOORDRG",67,0)
 S INDX=$G(INDX)+1,^TMP($J,"ORDERS",INDX)=$S(PSODD:$P(^PSDRUG(PSODD,0),"^",2),1:"")_"^"_$S($G(^PSDRUG(PSODD,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)_"^"_DRG_"^"_$P(^PS(52.41,EN,0),"^")_"^"_EN_"P;O"
"RTN","PSOORDRG",68,0)
 Q
"RTN","PSOORDRG",69,0)
 ;
"RTN","PSOORDRG",70,0)
BUILDX K EN,PSOOI,PSODD,PSOEN Q
"RTN","PSOORDRG",71,0)
 ;
"RTN","PSOORDRG",72,0)
GET ;data for profiles
"RTN","PSOORDRG",73,0)
 S PSORX0=^PSRX(RX,0),PSOST0=+^("STA") Q:PSOST0>5&(PSOST0'=16)
"RTN","PSOORDRG",74,0)
 S PSORX2=$G(^PSRX(RX,2)),PSORX3=$G(^(3)),ORN=$P($G(^("OR1")),"^",2) S:PSORX3="" PSORX3=$P(PSORX2,"^",2)
"RTN","PSOORDRG",75,0)
 S PSODRUG=+$P(PSORX0,"^",6) Q:'$D(^PSDRUG(PSODRUG,0))
"RTN","PSOORDRG",76,0)
 S PSODRUG0=^PSDRUG(PSODRUG,0),PSOVACL=$P(PSODRUG0,"^",2)
"RTN","PSOORDRG",77,0)
 ;
"RTN","PSOORDRG",78,0)
 I EXPDT<DT D
"RTN","PSOORDRG",79,0)
 .N DIE,DIC,DR,DA S STAT="SC",DIE=52,DA=RX,DR="100////11" D ^DIE K DIE,DIC,DR,DA
"RTN","PSOORDRG",80,0)
 .D ECAN^PSOUTL(RX) S DA=RX
"RTN","PSOORDRG",81,0)
 .S COMM="Prescription Expired",PHARMST="ZE" D EN^PSOHLSN1(DA,STAT,PHARMST,COMM)
"RTN","PSOORDRG",82,0)
 S INDX=$G(INDX)+1
"RTN","PSOORDRG",83,0)
 S ^TMP($J,"ORDERS",INDX)=PSOVACL_"^"_$S($G(^PSDRUG(PSODRUG,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)_"^"_$P(^PSDRUG(PSODRUG,0),"^")_"^"_ORN_"^"_RX_"R;O"
"RTN","PSOORDRG",84,0)
 Q
"RTN","PSOORDRG",85,0)
GETX ;
"RTN","PSOORDRG",86,0)
 K PSOX,EXPDT,PSODRUG,PSODRUG0,PSORX0,PSORX2,PSORX3,PSOST0,PSOVACL,X,Y,X1,X2,ORN
"RTN","PSOORDRG",87,0)
 Q
"RTN","PSOORDRG",88,0)
CLOZ ;
"RTN","PSOORDRG",89,0)
 S ANQRTN=$P(^PSDRUG(PSODRUG("IEN"),"CLOZ1"),"^"),ANQX=0,P(5)=PSODRUG("IEN"),DFN=PSODFN,X=ANQRTN
"RTN","PSOORDRG",90,0)
 X ^%ZOSF("TEST") I  D @("^"_ANQRTN) S:$G(ANQX) PSORX("DFLG")=1
"RTN","PSOORDRG",91,0)
 K P(5),ANQRTN,ANQX,X
"RTN","PSOORDRG",92,0)
 Q
"RTN","PSOORDRG",93,0)
DRGCHK(PSODFN,DREN,DDRUG)    ;Only check DREN against drug in DDRG()
"RTN","PSOORDRG",94,0)
 ;* PSODFN = Patient's DFN
"RTN","PSOORDRG",95,0)
 ;* DREN   = Dispendse drug to be checked against the drug in the array
"RTN","PSOORDRG",96,0)
 ;* DDRUG  = The array of dispendse drug in the buffer.
"RTN","PSOORDRG",97,0)
 ;*
"RTN","PSOORDRG",98,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC")
"RTN","PSOORDRG",99,0)
 NEW DDRUG0,DDRUGND,COD,PSJINX S COD="",PSJINX=0
"RTN","PSOORDRG",100,0)
 S DDRUG=0 F  S DDRUG=$O(DDRUG(DDRUG)) Q:'DDRUG  D DDRUG^PSJORUT2
"RTN","PSOORDRG",101,0)
 D DRG
"RTN","PSOORDRG",102,0)
 Q
"RTN","PSOORDRG",103,0)
OIDRG(PSODFN,PSOI) ;checks every drug tied to orderable item passed by package use
"RTN","PSOORDRG",104,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC"),DD,DC,DI N DREN S INDX=0,PSOPHI=1
"RTN","PSOORDRG",105,0)
 ;build patient's drug profile inpat/outpat/non-va
"RTN","PSOORDRG",106,0)
 D BLD,ENCHK^PSJORUT2(PSODFN,.INDX),NVA
"RTN","PSOORDRG",107,0)
 F DREN=0:0 S DREN=$O(^PSDRUG("ASP",PSOI,DREN)) Q:'DREN  I $D(^PSDRUG(DREN,O)) D DRG
"RTN","PSOORDRG",108,0)
 K PSOPHI D EXIT
"RTN","PSOORDRG",109,0)
 Q
"RTN","PSOORDRG",110,0)
NVA ;checks existing nva
"RTN","PSOORDRG",111,0)
 F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",I)) Q:'I  D:$D(^PS(55,PSODFN,"NVA",I,0))
"RTN","PSOORDRG",112,0)
 .Q:$P(^PS(55,PSODFN,"NVA",I,0),"^",7)
"RTN","PSOORDRG",113,0)
 .S PSOI=$P(^PS(55,PSODFN,"NVA",I,0),"^"),DRG=$P(^(0),"^",2),ORN=$P(^(0),"^",8)
"RTN","PSOORDRG",114,0)
 .I DRG,$G(^PSDRUG(DRG,0))]"" D NVA1 K DRG Q
"RTN","PSOORDRG",115,0)
 .K DRG F DRG=0:0 S DRG=$O(^PSDRUG("ASP",PSOI,DRG)) Q:'DRG  D:$D(^PSDRUG(DRG,0)) NVA1
"RTN","PSOORDRG",116,0)
 K I,PSOOTC,ORN,PSOI,DRG,DRGN,PSOY,VACL,NDF
"RTN","PSOORDRG",117,0)
 Q
"RTN","PSOORDRG",118,0)
NVA1 S PSOY=$G(^PSDRUG(DRG,0)),DRGN=$P(PSOY,"^"),VACL=$P(PSOY,"^",2)
"RTN","PSOORDRG",119,0)
 S NDF=$S($G(^PSDRUG(DRG,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORDRG",120,0)
 S INDX=$G(INDX)+1,^TMP($J,"ORDERS",INDX)=VACL_"^"_NDF_"^"_DRGN_"^"_ORN_"^"_I_"N;O"
"RTN","PSOORDRG",121,0)
 Q
"RTN","PSOORRL")
0^7^B54436001
"RTN","PSOORRL",1,0)
PSOORRL ;BHAM ISC/SAB - returns patient's outpatient meds ;07/21/96
"RTN","PSOORRL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,20,9,34,54,82,124,132**;DEC 1997
"RTN","PSOORRL",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORRL",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRL",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOORRL",6,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORRL",7,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORRL",8,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORRL",9,0)
 ;External reference to OCL^PSJORRE supported by DBIA 2383
"RTN","PSOORRL",10,0)
 ;External reference to OEL^PSJORRE1 supported by DBIA 2384
"RTN","PSOORRL",11,0)
OCL(DFN,BDT,EDT) ;entry point to return condensed list
"RTN","PSOORRL",12,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN)
"RTN","PSOORRL",13,0)
 K ^TMP("PS",$J) S TFN=0,PSBDT=$G(BDT),PSEDT=$G(EDT) I +$G(PSBDT)<1 S X1=DT,X2=-120 D C^%DTC S PSBDT=X
"RTN","PSOORRL",14,0)
 S EXDT=PSBDT-1,IFN=0
"RTN","PSOORRL",15,0)
 F  S EXDT=$O(^PS(55,DFN,"P","A",EXDT)) Q:'EXDT  F  S IFN=$O(^PS(55,DFN,"P","A",EXDT,IFN)) Q:'IFN  D:$D(^PSRX(IFN,0))
"RTN","PSOORRL",16,0)
 .Q:$P($G(^PSRX(IFN,"STA")),"^")=13
"RTN","PSOORRL",17,0)
 .S TFN=TFN+1,RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2),LSTRD=$P(RX2,"^",13),LSTDS=$P(RX0,"^",8)
"RTN","PSOORRL",18,0)
 .F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^"),LSTDS=$P(^(0),"^",10) S:$P(^(0),"^",18)]"" LSTRD=$P(^(0),"^",18)
"RTN","PSOORRL",19,0)
 .S ^TMP("PS",$J,TFN,0)=IFN_"R;O"_"^"_$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")_"^^"_$P(RX2,"^",6)_"^"_($P(RX0,"^",9)-TRM)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)
"RTN","PSOORRL",20,0)
 .S ^TMP("PS",$J,TFN,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRL",21,0)
 .S ST0=$S(STA<12&($P(RX2,"^",6)<DT):11,1:STA)
"RTN","PSOORRL",22,0)
 .S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL FILL^HOLD^NON-VERIFIED^SUSPENDED^^^^^DONE^EXPIRED^DISCONTINUED^DISCONTINUED^DISCONTINUED^DISCONTINUED (EDIT)^HOLD^","^",ST0+2)
"RTN","PSOORRL",23,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^"_ST_"^"_LSTFD_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P(RX0,"^",13)_"^"_LSTRD_"^"_LSTDS
"RTN","PSOORRL",24,0)
 .S ^TMP("PS",$J,TFN,"SCH",0)=0
"RTN","PSOORRL",25,0)
 .S (SCH,SC)=0 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PS",$J,TFN,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^"),^TMP("PS",$J,TFN,"SCH",0)=^TMP("PS",$J,TFN,"SCH",0)+1
"RTN","PSOORRL",26,0)
 .S ^TMP("PS",$J,TFN,"MDR",0)=0,(MDR,MR)=0 F  S MR=$O(^PSRX(IFN,"MEDR",MR)) Q:'MR  D
"RTN","PSOORRL",27,0)
 ..Q:'$D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0))  S MDR=MDR+1
"RTN","PSOORRL",28,0)
 ..I $P($G(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),"^",3)]"" S ^TMP("PS",$J,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^",3)
"RTN","PSOORRL",29,0)
 ..I $D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),$P($G(^(0)),"^",3)']"" S ^TMP("PS",$J,TFN,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^")
"RTN","PSOORRL",30,0)
 ..S ^TMP("PS",$J,TFN,"MDR",0)=^TMP("PS",$J,TFN,"MDR",0)+1
"RTN","PSOORRL",31,0)
 .S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG1^PSOORRL1
"RTN","PSOORRL",32,0)
 .I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRL",33,0)
 ..S ^TMP("PS",$J,TFN,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PS",$J,TFN,"SIG",0)=+$G(^TMP("PS",$J,TFN,"SIG",0))+1
"RTN","PSOORRL",34,0)
 ..F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,TFN,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PS",$J,TFN,"SIG",0)=+$G(^TMP("PS",$J,TFN,"SIG",0))+1
"RTN","PSOORRL",35,0)
 K PSOELSE
"RTN","PSOORRL",36,0)
 S IFN=0 F  S IFN=$O(^PS(52.41,"P",DFN,IFN)) Q:'IFN  S PSOR=^PS(52.41,IFN,0) D:$P(PSOR,"^",3)="" WAIT D:$P(PSOR,"^",3)'="DC"&($P(PSOR,"^",3)'="DE")&($P(PSOR,"^",3)'="")
"RTN","PSOORRL",37,0)
 .Q:$P(PSOR,"^",3)="RF"
"RTN","PSOORRL",38,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" D WAIT
"RTN","PSOORRL",39,0)
 .I $P(PSOR,"^",8)="",$P(PSOR,"^",9)="" Q  ; QUIT IF STILL NULL AFTER WAITING
"RTN","PSOORRL",40,0)
 .S TFN=TFN+1,^TMP("PS",$J,TFN,0)=IFN_"P;O^"_$S($P(PSOR,"^",9):$P($G(^PSDRUG($P(PSOR,"^",9),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^",8),0),"^",2),0),"^"))
"RTN","PSOORRL",41,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^^^^^^"_$P(PSOR,"^")_"^"_"PENDING^^^"_$P(PSOR,"^",10)_"^"
"RTN","PSOORRL",42,0)
 .S ^TMP("PS",$J,TFN,0)=^TMP("PS",$J,TFN,0)_"^"_$S($P(PSOR,"^",3)="RNW":1,1:0)
"RTN","PSOORRL",43,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,1,SCH)) Q:'SCH  S SD=SD+1,^TMP("PS",$J,TFN,"SCH",SD,0)=$P(^PS(52.41,IFN,1,SCH,1),"^"),^TMP("PS",$J,TFN,"SCH",0)=SD
"RTN","PSOORRL",44,0)
 .S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,"SIG",SCH)) Q:'SCH  S SD=SD+1,^TMP("PS",$J,TFN,"SIG",SD,0)=$P(^PS(52.41,IFN,"SIG",SCH,0),"^"),^TMP("PS",$J,TFN,"SIG",0)=SD
"RTN","PSOORRL",45,0)
 .S (IEN,SD)=1,INST=0 F  S INST=$O(^PS(52.41,IFN,2,INST)) Q:'INST  S (MIG,INST(INST))=^PS(52.41,IFN,2,INST,0),^TMP("PS",$J,TFN,"SIO",0)=SD D
"RTN","PSOORRL",46,0)
 ..F SG=1:1:$L(MIG," ") S:$L($G(^TMP("PS",$J,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG))>80 IEN=IEN+1,SD=SD+1,^TMP("PS",$J,TFN,"SIO",0)=SD S ^TMP("PS",$J,TFN,"SIO",IEN,0)=$G(^TMP("PS",$J,TFN,"SIO",IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORRL",47,0)
 D NVA,OCL^PSJORRE(DFN,BDT,EDT,.TFN),END^PSOORRL1
"RTN","PSOORRL",48,0)
 K SDT,SDT1,EDT,EDT1,BDT,DBT1,X
"RTN","PSOORRL",49,0)
 Q
"RTN","PSOORRL",50,0)
OEL(DFN,RXNUM) ;returns expanded list on specific order
"RTN","PSOORRL",51,0)
 I $P(RXNUM,";",2)="I" D OEL^PSJORRE1(DFN,$P(RXNUM,";")) Q
"RTN","PSOORRL",52,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) Q:RXNUM=""
"RTN","PSOORRL",53,0)
 K INST,SD,IFN,^TMP("PS",$J) S FL=$P(RXNUM,";"),IFN=+FL,RXNUM=$P(RXNUM,";",2)
"RTN","PSOORRL",54,0)
 I $G(FL)["P"!($G(FL)["S") D PEN^PSOORRL1 Q
"RTN","PSOORRL",55,0)
 I $G(FL)["N" D NVA^PSOORRL1 Q
"RTN","PSOORRL",56,0)
 Q:'$D(^PSRX(IFN,0))
"RTN","PSOORRL",57,0)
 S RX0=^PSRX(IFN,0),RX2=$G(^(2)),RX3=$G(^(3)),STA=+$G(^("STA")),TRM=0,LSTFD=$P(RX2,"^",2)
"RTN","PSOORRL",58,0)
 S ^TMP("PS",$J,"RXN",0)=$P(RX0,"^")_"^"_$E($P(RX2,"^",13),1,7)_"^"_$S($P(RX0,"^",11)="W":"W",1:"M")_"^"_$P(RX3,"^",7)_"^"_$S($P($G(^PSRX(IFN,"OR1")),"^",5):$P(^PSRX(IFN,"OR1"),"^",5),1:"")_"^"_$E($P(RX2,"^",2),1,7)_"^"_$E($P(RX2,"^",13),1,7)
"RTN","PSOORRL",59,0)
 F I=0:0 S I=$O(^PSRX(IFN,1,I)) Q:'I  S TRM=TRM+1,LSTFD=$P(^PSRX(IFN,1,I,0),"^") D
"RTN","PSOORRL",60,0)
 .S ^TMP("PS",$J,"REF",I,0)=$P(^PSRX(IFN,1,I,0),"^")_"^"_$P(^(0),"^",10)_"^"_$P(^(0),"^",4)_"^"_$E($P(^(0),"^",18),1,7)_"^"_$S($P(^(0),"^",2)="W":"W",1:"M")_"^"_$P(^(0),"^",3)
"RTN","PSOORRL",61,0)
 .I $P(^PSRX(IFN,1,I,0),"^",18) S $P(^TMP("PS",$J,"RXN",0),"^",2)=$E($P(^PSRX(IFN,1,I,0),"^",18),1,7)
"RTN","PSOORRL",62,0)
 .S ^TMP("PS",$J,"REF",0)=$G(^TMP("PS",$J,"REF",0))+1
"RTN","PSOORRL",63,0)
 F I=0:0 S I=$O(^PSRX(IFN,"P",I)) Q:'I  D
"RTN","PSOORRL",64,0)
 .S ^TMP("PS",$J,"PAR",I,0)=$P(^PSRX(IFN,"P",I,0),"^")_"^"_$P(^(0),"^",10)_"^"_$P(^(0),"^",4)_"^"_$E($P(^(0),"^",19),1,7)_"^"_$S($P(^(0),"^",2)="W":"W",1:"M")_"^"_$P(^(0),"^",3)
"RTN","PSOORRL",65,0)
 .S ^TMP("PS",$J,"PAR",0)=$G(^TMP("PS",$J,"PAR",0))+1
"RTN","PSOORRL",66,0)
 S ^TMP("PS",$J,0)=$P($G(^PSDRUG(+$P(RX0,"^",6),0)),"^")_"^^"_$P(RX2,"^",6)
"RTN","PSOORRL",67,0)
 S ^TMP("PS",$J,"P",0)=$P(RX0,"^",4)_"^"_$P($G(^VA(200,+$P(RX0,"^",4),0)),"^")
"RTN","PSOORRL",68,0)
 S ST0=$S(STA<12&($P(RX2,"^",6)<DT):11,1:STA)
"RTN","PSOORRL",69,0)
 S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL FILL^HOLD^NON-VERIFIED^SUSPENDED^^^^^DONE^EXPIRED^DISCONTINUE^DISCONTINUED^DISCONTINUED^DISCONTINUED (EDIT)^HOLD^","^",ST0+2)
"RTN","PSOORRL",70,0)
 S ^TMP("PS",$J,0)=^TMP("PS",$J,0)_"^"_($P(RX0,"^",9)-TRM)_"^"_$P(RX0,"^",13)_"^"_ST_"^"_$P(RX0,"^",8)_"^"_$P(RX0,"^",7)_"^^^"_$P($G(^PSRX(IFN,"OR1")),"^",2)_"^"_LSTFD_"^^"
"RTN","PSOORRL",71,0)
 S ^TMP("PS",$J,"DD",0)=1,^TMP("PS",$J,"DD",1,0)=$P(RX0,"^",6)_"^^"
"RTN","PSOORRL",72,0)
 S COD=$S('$G(^PSDRUG(+$P(RX0,"^",6),"I")):1,+$G(^PSDRUG(+$P(RX0,"^",6),"I"))>DT:1,1:0)
"RTN","PSOORRL",73,0)
 S ^TMP("PS",$J,"DD",1,0)=^TMP("PS",$J,"DD",1,0)_$S($P($G(^PSDRUG(+$P(RX0,"^",6),2)),"^",3)["U"&(COD):$P(RX0,"^",6),1:"") K COD
"RTN","PSOORRL",74,0)
 S ^TMP("PS",$J,"SCH",0)=0,(SCH,SC)=0
"RTN","PSOORRL",75,0)
 F  S SC=$O(^PSRX(IFN,"SCH",SC)) Q:'SC  S SCH=SCH+1,^TMP("PS",$J,"SCH",SCH,0)=$P(^PSRX(IFN,"SCH",SC,0),"^") D
"RTN","PSOORRL",76,0)
 .S ^TMP("PS",$J,"SCH",0)=^TMP("PS",$J,"SCH",0)+1
"RTN","PSOORRL",77,0)
 D MDR^PSOORRL1
"RTN","PSOORRL",78,0)
 S PSOELSE=0 I $D(^PSRX(IFN,"SIG")),'$P(^PSRX(IFN,"SIG"),"^",2) S PSOELSE=1 S X=$P(^PSRX(IFN,"SIG"),"^") D SIG^PSOORRL1
"RTN","PSOORRL",79,0)
 I '$G(PSOELSE) S ITFN=1 D
"RTN","PSOORRL",80,0)
 .S ^TMP("PS",$J,"SIG",ITFN,0)=$G(^PSRX(IFN,"SIG1",1,0)),^TMP("PS",$J,"SIG",0)=+$G(^TMP("PS",$J,"SIG",0))+1
"RTN","PSOORRL",81,0)
 .F I=1:0 S I=$O(^PSRX(IFN,"SIG1",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,"SIG",ITFN,0)=^PSRX(IFN,"SIG1",I,0),^TMP("PS",$J,"SIG",0)=+$G(^TMP("PS",$J,"SIG",0))+1
"RTN","PSOORRL",82,0)
 K PSOELSE
"RTN","PSOORRL",83,0)
 S ^TMP("PS",$J,"PC",0)=0,ITFN=0
"RTN","PSOORRL",84,0)
 F I=0:0 S I=$O(^PSRX(IFN,"PRC",I)) Q:'I  S ITFN=ITFN+1,^TMP("PS",$J,"PC",ITFN,0)=^PSRX(IFN,"PRC",I,0),^TMP("PS",$J,"PC",0)=^TMP("PS",$J,"PC",0)+1
"RTN","PSOORRL",85,0)
 Q
"RTN","PSOORRL",86,0)
 ;
"RTN","PSOORRL",87,0)
WAIT ; IF PENDING ENTRY STILL BEING BUILT SEE IF IT COMPLETES WITHIN ANOTHER SECOND
"RTN","PSOORRL",88,0)
 H 1 S PSOR=$G(^PS(52.41,IFN,0))
"RTN","PSOORRL",89,0)
 Q
"RTN","PSOORRL",90,0)
 ;
"RTN","PSOORRL",91,0)
NVA ; Set Non-VA Med Orders in the ^TMP Global
"RTN","PSOORRL",92,0)
 F I=0:0 S I=$O(^PS(55,DFN,"NVA",I)) Q:'I  S X=$G(^PS(55,DFN,"NVA",I,0)) D
"RTN","PSOORRL",93,0)
 .Q:'$P(X,"^")
"RTN","PSOORRL",94,0)
 .S DRG=$S($P(X,"^",2):$P($G(^PSDRUG($P(X,"^",2),0)),"^"),1:$P(^PS(50.7,$P(X,"^"),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(X,"^"),0),"^",2),0),"^"))
"RTN","PSOORRL",95,0)
 .S SDT=$P(X,"^",9) I 'SDT D TMPBLD Q
"RTN","PSOORRL",96,0)
 .I $E(SDT,4,5),$E(SDT,6,7) D
"RTN","PSOORRL",97,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRL",98,0)
 ..I $G(BDT),SDT<BDT Q
"RTN","PSOORRL",99,0)
 ..I $G(EDT),SDT>EDT Q
"RTN","PSOORRL",100,0)
 ..I $G(BDT),$P(X,"^",7),$P(X,"^",7)<BDT Q
"RTN","PSOORRL",101,0)
 ..D TMPBLD
"RTN","PSOORRL",102,0)
 .I $E(SDT,4,5),'$E(SDT,6,7) D
"RTN","PSOORRL",103,0)
 ..S SDT1=$E(SDT,1,5),BDT1=$E(+$G(BDT),1,5),EDT1=$E(+$G(EDT),1,5)
"RTN","PSOORRL",104,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRL",105,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRL",106,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,5)<BDT1 Q
"RTN","PSOORRL",107,0)
 ..D TMPBLD
"RTN","PSOORRL",108,0)
 .I '$E(SDT,4,5),'$E($P(X,"^",9),6,7) D
"RTN","PSOORRL",109,0)
 ..;I $P(X,"^",9) D  Q
"RTN","PSOORRL",110,0)
 ..S SDT1=$E(SDT,1,3),BDT1=$E(+$G(BDT),1,3),EDT1=$E(+$G(EDT),1,3)
"RTN","PSOORRL",111,0)
 ..I $G(BDT1),SDT1<BDT1 Q
"RTN","PSOORRL",112,0)
 ..I $G(EDT1),SDT1>EDT1 Q
"RTN","PSOORRL",113,0)
 ..I $G(BDT1),$P(X,"^",7),$E($P(X,"^",7),1,3)<BDT1 Q
"RTN","PSOORRL",114,0)
 ..D TMPBLD
"RTN","PSOORRL",115,0)
 Q
"RTN","PSOORRL",116,0)
TMPBLD S TFN=$G(TFN)+1,^TMP("PS",$J,TFN,0)=I_"N;O^"_DRG
"RTN","PSOORRL",117,0)
 S $P(^TMP("PS",$J,TFN,0),"^",8)=$P(X,"^",8)_"^"_$S($P(X,"^",7):"DISCONTINUED",1:"ACTIVE")
"RTN","PSOORRL",118,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=1,^TMP("PS",$J,TFN,"SCH",1,0)=$P(X,"^",5)
"RTN","PSOORRL",119,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=1,^TMP("PS",$J,TFN,"SIG",1,0)=$P(X,"^",3)_" "_$P(X,"^",4)_" "_$P(X,"^",5)
"RTN","PSOORRL",120,0)
 Q
"RTN","PSOORRL1")
0^27^B23602588
"RTN","PSOORRL1",1,0)
PSOORRL1 ;BHAM ISC/SAB,TJH - sub-module for PSOORRL ;01/14/99
"RTN","PSOORRL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,46,132**;DEC 1997
"RTN","PSOORRL1",3,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOORRL1",4,0)
 ;External reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSOORRL1",5,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORRL1",6,0)
 ;External reference to ^PS(51 supported by DBIA 2224
"RTN","PSOORRL1",7,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORRL1",8,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORRL1",9,0)
 ;
"RTN","PSOORRL1",10,0)
MDR ;
"RTN","PSOORRL1",11,0)
 S ^TMP("PS",$J,"MDR",0)=0,(MDR,MR)=0 F  S MR=$O(^PSRX(IFN,"MEDR",MR)) Q:'MR  D
"RTN","PSOORRL1",12,0)
 .Q:'$D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0))  S MDR=MDR+1
"RTN","PSOORRL1",13,0)
 .I $P($G(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),"^",3)]"" S ^TMP("PS",$J,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^",3)
"RTN","PSOORRL1",14,0)
 .I $D(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0)),$P($G(^(0)),"^",3)']"" S ^TMP("PS",$J,"MDR",MDR,0)=$P(^PS(51.2,+^PSRX(IFN,"MEDR",MR,0),0),"^")
"RTN","PSOORRL1",15,0)
 .S ^TMP("PS",$J,"MDR",0)=^TMP("PS",$J,"MDR",0)+1
"RTN","PSOORRL1",16,0)
 Q
"RTN","PSOORRL1",17,0)
 ;
"RTN","PSOORRL1",18,0)
PEN Q:'$D(^PS(52.41,IFN,0))!($P($G(^PS(52.41,IFN,0)),"^",3)="RF")  S PSOR=^PS(52.41,IFN,0)
"RTN","PSOORRL1",19,0)
 S ^TMP("PS",$J,0)=$S($P(PSOR,"^",9):$P($G(^PSDRUG($P(PSOR,"^",9),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^",8),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^",8),0),"^",2),0),"^"))
"RTN","PSOORRL1",20,0)
 I $P(PSOR,"^",9) D
"RTN","PSOORRL1",21,0)
 .S ^TMP("PS",$J,"DD",0)=1
"RTN","PSOORRL1",22,0)
 .S COD=$S('$G(^PSDRUG($P(PSOR,"^",9),"I")):1,+$G(^PSDRUG($P(PSOR,"^",9),"I"))>DT:1,1:0)
"RTN","PSOORRL1",23,0)
 .S ^TMP("PS",$J,"DD",1,0)=$P(PSOR,"^",9)_"^^"_$S($P($G(^PSDRUG($P(PSOR,"^",9),2)),"^",3)["U"&(COD):$P(PSOR,"^",9),1:"") K COD
"RTN","PSOORRL1",24,0)
 S ^TMP("PS",$J,0)=^TMP("PS",$J,0)_"^"_$S($G(^PS(51.2,+$P(PSOR,"^",15),0))]"":$P(^PS(51.2,+$P(PSOR,"^",15),0),"^",3),1:"")_"^^"_$P(PSOR,"^",11)_"^"_$P($P(PSOR,"^",6),".")_"^"_$S($P(PSOR,"^",3)'="HD":"PENDING",1:" ON HOLD")_"^^"_$P(PSOR,"^",10)
"RTN","PSOORRL1",25,0)
 S $P(^TMP("PS",$J,0),"^",11)=$P(PSOR,"^")
"RTN","PSOORRL1",26,0)
 S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,1,SCH)) Q:'SCH  S SD=SD+1,^TMP("PS",$J,"SCH",SD,0)=$P(^PS(52.41,IFN,1,SCH,1),"^"),^TMP("PS",$J,"SCH",0)=SD
"RTN","PSOORRL1",27,0)
 S SD=0 F SCH=0:0 S SCH=$O(^PS(52.41,IFN,"SIG",SCH)) Q:'SCH  S SD=SD+1,^TMP("PS",$J,"SIG",SD,0)=$P(^PS(52.41,IFN,"SIG",SCH,0),"^"),^TMP("PS",$J,"SIG",0)=SD
"RTN","PSOORRL1",28,0)
 S (IEN,SD)=1,INST=0 F  S INST=$O(^PS(52.41,IFN,2,INST)) Q:'INST  S (MIG,INST(INST))=^PS(52.41,IFN,2,INST,0),^TMP("PS",$J,"SIO",0)=SD D
"RTN","PSOORRL1",29,0)
 .F SG=1:1:$L(MIG," ") S:$L($G(^TMP("PS",$J,"SIO",SD,0))_" "_$P(MIG," ",SG))>80 SD=SD+1,^TMP("PS",$J,"SIO",0)=SD S ^TMP("PS",$J,"SIO",SD,0)=$G(^TMP("PS",$J,"SIO",SD,0))_" "_$P(MIG," ",SG)
"RTN","PSOORRL1",30,0)
END K FL,SD,SCH,%T,Y,ST,ST0,PSBDT,PSEDT,IFN,EXDT,RX0,RX2,RX3,TRM,I,X,Z1,Z0,PSOX1,PSOX2,PSOR,STA,TFN,X1,X2,SC,MDR,MR,IFN,MIG,INST
"RTN","PSOORRL1",31,0)
 K BDT,EDT,IEN,ITFN,RXNUM
"RTN","PSOORRL1",32,0)
 Q
"RTN","PSOORRL1",33,0)
NVA ;non-va meds display
"RTN","PSOORRL1",34,0)
 Q:'$D(^PS(55,DFN,"NVA",IFN,0))!('$P($G(^PS(55,DFN,"NVA",IFN,0)),"^"))
"RTN","PSOORRL1",35,0)
 S PSOR=^PS(55,DFN,"NVA",IFN,0)
"RTN","PSOORRL1",36,0)
 S ^TMP("PS",$J,0)=$S($P(PSOR,"^",2):$P($G(^PSDRUG($P(PSOR,"^",2),0)),"^"),1:$P(^PS(50.7,$P(PSOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,$P(PSOR,"^"),0),"^",2),0),"^"))
"RTN","PSOORRL1",37,0)
 I $P(PSOR,"^",2) D
"RTN","PSOORRL1",38,0)
 .S ^TMP("PS",$J,"DD",0)=1
"RTN","PSOORRL1",39,0)
 .S COD=$S('$G(^PSDRUG($P(PSOR,"^",2),"I")):1,+$G(^PSDRUG($P(PSOR,"^",2),"I"))>DT:1,1:0)
"RTN","PSOORRL1",40,0)
 .S ^TMP("PS",$J,"DD",1,0)=$P(PSOR,"^",2)_"^^"_$S($P($G(^PSDRUG($P(PSOR,"^",2),2)),"^",3)["U"&(COD):$P(PSOR,"^",2),1:"") K COD
"RTN","PSOORRL1",41,0)
 S ^TMP("PS",$J,0)=^TMP("PS",$J,0)_"^^^N/A^"_$P($P(PSOR,"^",9),".")_"^"_$S('$P(PSOR,"^",7):"ACTIVE",1:"DISCONTINUED")_"^^N/A^^^"_$P(PSOR,"^",8)
"RTN","PSOORRL1",42,0)
 S ^TMP("PS",$J,"SCH",1,0)=$P(PSOR,"^",5),^TMP("PS",$J,"SCH",0)=1
"RTN","PSOORRL1",43,0)
 S ^TMP("PS",$J,"SIG",1,0)=$P(PSOR,"^",3)_" "_$P(PSOR,"^",4)_" "_$P(PSOR,"^",5),^TMP("PS",$J,"SIG",0)=1
"RTN","PSOORRL1",44,0)
 S ^TMP("PS",$J,"SIO",1,0)=$P(PSOR,"^",3)_" "_$P(PSOR,"^",4)_" "_$P(PSOR,"^",5),^TMP("PS",$J,"SIO",0)=1
"RTN","PSOORRL1",45,0)
 K PSOR
"RTN","PSOORRL1",46,0)
 Q
"RTN","PSOORRL1",47,0)
 ;
"RTN","PSOORRL1",48,0)
SIG ;expands SIG expanded list
"RTN","PSOORRL1",49,0)
 F Z0=1:1:$L(X," ") G:Z0="" EN S Z1=$P(X," ",Z0) D
"RTN","PSOORRL1",50,0)
 .D:$D(X)&($G(Z1)]"")
"RTN","PSOORRL1",51,0)
 ..S Y=$O(^PS(51,"B",Z1,0)) Q:'Y!($P($G(^PS(51,+Y,0)),"^",4)>1)  S Z1=$P(^PS(51,Y,0),"^",2) Q:'$D(^(9))  S Y=$P(X," ",Z0-1),Y=$E(Y,$L(Y)) S:Y>1 Z1=^(9)
"RTN","PSOORRL1",52,0)
 .I $G(^TMP("PS",$J,"SIG",1,0))']"" S ^TMP("PS",$J,"SIG",1,0)=Z1,^TMP("PS",$J,"SIG",0)=1 Q
"RTN","PSOORRL1",53,0)
 .F PSOX1=0:0 S PSOX1=$O(^TMP("PS",$J,"SIG",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOORRL1",54,0)
 .I $L(^TMP("PS",$J,"SIG",PSOX2,0))+$L(Z1)<245 S ^TMP("PS",$J,"SIG",PSOX2,0)=^TMP("PS",$J,"SIG",PSOX2,0)_" "_Z1
"RTN","PSOORRL1",55,0)
 .E  S PSOX2=PSOX2+1,^TMP("PS",$J,"SIG",PSOX2,0)=Z1
"RTN","PSOORRL1",56,0)
EN K Z1,Z0,PSOX1 Q
"RTN","PSOORRL1",57,0)
 ;
"RTN","PSOORRL1",58,0)
SIG1 ;expands SIG for condensed list
"RTN","PSOORRL1",59,0)
 F Z0=1:1:$L(X," ") G:Z0="" EN S Z1=$P(X," ",Z0) D
"RTN","PSOORRL1",60,0)
 .D:$D(X)&($G(Z1)]"")
"RTN","PSOORRL1",61,0)
 ..S Y=$O(^PS(51,"B",Z1,0)) Q:'Y!($P($G(^PS(51,+Y,0)),"^",4)>1)  S Z1=$P(^PS(51,Y,0),"^",2) Q:'$D(^(9))  S Y=$P(X," ",Z0-1),Y=$E(Y,$L(Y)) S:Y>1 Z1=^(9)
"RTN","PSOORRL1",62,0)
 .I $G(^TMP("PS",$J,TFN,"SIG",1,0))']"" S ^TMP("PS",$J,TFN,"SIG",1,0)=Z1,^TMP("PS",$J,TFN,"SIG",0)=1 Q
"RTN","PSOORRL1",63,0)
 .F PSOX1=0:0 S PSOX1=$O(^TMP("PS",$J,TFN,"SIG",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOORRL1",64,0)
 .I $L(^TMP("PS",$J,TFN,"SIG",PSOX2,0))+$L(Z1)<245 S ^TMP("PS",$J,TFN,"SIG",PSOX2,0)=^TMP("PS",$J,TFN,"SIG",PSOX2,0)_" "_Z1
"RTN","PSOORRL1",65,0)
 .E  S PSOX2=PSOX2+1,^TMP("PS",$J,TFN,"SIG",PSOX2,0)=Z1
"RTN","PSOORRL1",66,0)
 Q
"RTN","PSOORUT1")
0^4^B58566993
"RTN","PSOORUT1",1,0)
PSOORUT1 ;BIR/SAB - utility routine for oerr interface ;02/22/95
"RTN","PSOORUT1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,30,46,132**;DEC 1997
"RTN","PSOORUT1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORUT1",4,0)
 ;External reference to ^PSXOPUTL supported by DBIA 2203
"RTN","PSOORUT1",5,0)
 ;called from HD^PSOORUTL
"RTN","PSOORUT1",6,0)
REL ;removed order from hold
"RTN","PSOORUT1",7,0)
 S ACT=1,ORS=0
"RTN","PSOORUT1",8,0)
 I POERR("PSOFILNM")["S" S DA=+POERR("PSOFILNM") D  G EXIT^PSOORUTL
"RTN","PSOORUT1",9,0)
 .Q:'$D(^PS(52.41,DA,0))  Q:$P(^PS(52.41,DA,0),"^",3)="RF"
"RTN","PSOORUT1",10,0)
 .S $P(^PS(52.41,DA,0),"^",3)="NW",POERR("STAT")="OR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUT1",11,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order RELEASED from HOLD by OE/RR before finished." S $P(^PS(52.41,DA,4),"^")=POERR("COMM"),ORS=1
"RTN","PSOORUT1",12,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) S ORS=1,PSDA=DA D  G EXIT^PSOORUTL
"RTN","PSOORUT1",13,0)
 .S POERR("FILLER")=DA_"^R",POERR("STAT")="OR"
"RTN","PSOORUT1",14,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription Released from HOLD by OE/RR"
"RTN","PSOORUT1",15,0)
 .I DT>$P(^PSRX(DA,2),"^",6) D
"RTN","PSOORUT1",16,0)
 ..S EXP=$P(^PSRX(DA,2),"^",6) S:$P(^PSRX(DA,"STA"),"^")<12 $P(^PSRX(DA,"STA"),"^")=11,PSOEXFLG=1 S POERR("STAT")="UR",POERR("COMM")="Medication Expired on "_$E(EXP,4,5)_"/"_$E(EXP,6,7)_"/"_$E(EXP,2,3)_".",POERR("PHARMST")="" D ECAN^PSOUTL(DA) Q
"RTN","PSOORUT1",17,0)
 .I $P(^PSRX(DA,"STA"),"^")'=16 S POERR("STAT")="UR",POERR("COMM")="Unable to Release from Hold" Q
"RTN","PSOORUT1",18,0)
 .S RXFL(DA)=0,FDT=$P(^PSRX(DA,2),"^",2)
"RTN","PSOORUT1",19,0)
 .I $O(^PSRX(DA,1,0)) F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S FDT=$P(^PSRX(DA,1,I,0),"^"),RXFL(DA)=I
"RTN","PSOORUT1",20,0)
 .I FDT>DT N PSOSITEZ,ZPSOPAR6 S PSOSITEZ=$S($P($G(^PSRX(DA,2)),"^",9):$P(^(2),"^",9),1:$O(^PS(59,0))),ZPSOPAR6=$P($G(^PS(59,PSOSITEZ,1)),"^",6) I ZPSOPAR6 D  Q
"RTN","PSOORUT1",21,0)
 ..S RXXDA=DA,DA=$O(^PS(52.5,"B",RXXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORUT1",22,0)
 ..S DA=RXXDA
"RTN","PSOORUT1",23,0)
 ..S DIC="^PS(52.5,",DIC(0)="L",DLAYGO=52.5,X=RXXDA,DIC("DR")=".02///"_FDT_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///0;.06////"_PSOSITEZ_";2///0;9///"_RXFL(DA) K DD,DO D FILE^DICN K RXFL,DD,DO
"RTN","PSOORUT1",24,0)
 ..S DA=RXXDA K RXXDA S $P(^PSRX(DA,"STA"),"^")=5,LFD=$E(FDT,4,5)_"-"_$E(FDT,6,7)_"-"_$E(FDT,2,3) D ACT1
"RTN","PSOORUT1",25,0)
 ..;S POERR("STAT")="SC",POERR("COMM")="Medication suspended until "_LFD_".",POERR("PHARMST")="ZS"
"RTN","PSOORUT1",26,0)
 ..S PSOSUSZ=1
"RTN","PSOORUT1",27,0)
 .E  S $P(^PSRX(DA,"STA"),"^")=0
"RTN","PSOORUT1",28,0)
 .S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",29,0)
 .D ACT^PSOORUTL
"RTN","PSOORUT1",30,0)
 G EXIT^PSOORUTL
"RTN","PSOORUT1",31,0)
ACT1 I '$D(RXF) S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",32,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORUT1",33,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORUT1",34,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_POERR("USER")_"^"_RXF_"^"_"RX Placed on Suspense until "_LFD
"RTN","PSOORUT1",35,0)
 Q
"RTN","PSOORUT1",36,0)
SUS ;
"RTN","PSOORUT1",37,0)
 I $P($G(^PSRX(+$G(FILLER),"STA")),"^")=5 N PSOMSORR,PLACERXX D EN^PSOHLSN1(+$G(FILLER),"SC","ZS","")
"RTN","PSOORUT1",38,0)
 Q
"RTN","PSOORUT1",39,0)
BLD ;builds med profile for listman
"RTN","PSOORUT1",40,0)
 K ^TMP("PSOPF",$J),PSOLST S:$G(PSOOPT)'=3 PSOOPT=0 I '$G(PSOSD) S ^TMP("PSOPF",$J,1,0)="This patient has no prescriptions" S PSOCNT=0,PSOPF=1 Q
"RTN","PSOORUT1",41,0)
 D EOJ,SHOW
"RTN","PSOORUT1",42,0)
EOJ ;
"RTN","PSOORUT1",43,0)
 K PSOQFLG,PSODRG,PSODATA,PSOLF
"RTN","PSOORUT1",44,0)
 Q
"RTN","PSOORUT1",45,0)
 ;-----------------------------------------------------------------
"RTN","PSOORUT1",46,0)
SHOW ;
"RTN","PSOORUT1",47,0)
 S (PSOSTA,PSODRG)="",(PSOCNT,PSOQFLG,IEN)=0 K RN,DL S $P(RN," ",12)=" ",$P(DL," ",40)=" "
"RTN","PSOORUT1",48,0)
 F PSCNT=0:0 S PSOSTA=$O(PSOSD(PSOSTA)) Q:PSOSTA=""  D STA F PSOCT=0:0 S PSODRG=$O(PSOSD(PSOSTA,PSODRG)) Q:PSODRG=""  Q:PSOCNT>1000!PSOQFLG  D
"RTN","PSOORUT1",49,0)
 .S PSODATA=PSOSD(PSOSTA,PSODRG) I PSOSTA="ZNONVA" D  Q
"RTN","PSOORUT1",50,0)
 ..S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="  "_$P(PSODRG,"^")_" "
"RTN","PSOORUT1",51,0)
 ..I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",6))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",52,0)
 ..S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)_" "
"RTN","PSOORUT1",53,0)
 ..I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",8))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",54,0)
 ..S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",8)
"RTN","PSOORUT1",55,0)
 ..I ($L(^TMP("PSOPF",$J,IEN,0))+20)>70 S IEN=IEN+1,$P(^TMP("PSOPF",$J,IEN,0)," ",51)="Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3) Q
"RTN","PSOORUT1",56,0)
 ..F I=0:0 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_" " Q:$L(^TMP("PSOPF",$J,IEN,0))>49
"RTN","PSOORUT1",57,0)
 ..S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",58,0)
 .S PSOCNT=PSOCNT+1 I PSOSTA="PENDING" D PEN Q
"RTN","PSOORUT1",59,0)
 .S:'$D(^PSRX(+PSODATA,0)) PSOCNT=PSOCNT-1 D:$D(^(0)) DISPL
"RTN","PSOORUT1",60,0)
 S (VALMCNT,PSOPF)=IEN
"RTN","PSOORUT1",61,0)
SHOWX K DIRUT,DTOUT,DUOUT,DIROUT,PSODRG
"RTN","PSOORUT1",62,0)
 Q
"RTN","PSOORUT1",63,0)
 ;
"RTN","PSOORUT1",64,0)
DISPL S IEN=IEN+1 N PSOID,PSOCMOP,STATLTH
"RTN","PSOORUT1",65,0)
 K PSOLNT,PSOQTL,PSOLSP S PSOLRX=$S($G(^PSRX(+PSODATA,"IB")):13,1:14)-$L($P(^PSRX(+PSODATA,0),"^")),$P(PSOLNT," ",PSOLRX)=" ",PSODQL=$L($P(PSODRG,"^"))+$L($P(^PSRX(+PSODATA,0),"^",7))
"RTN","PSOORUT1",66,0)
 I PSODQL<39 S $P(PSOQTL," ",(40-PSODQL))=" "
"RTN","PSOORUT1",67,0)
 E  S $P(PSOQTL," ",(52-$L($P(^PSRX(+PSODATA,0),"^",7))))=" ",$P(PSOLSP," ",(41-$L($P(PSODRG,"^"))))=" "
"RTN","PSOORUT1",68,0)
 S ^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(^PSRX(+PSODATA,0),"^")_$S($G(^PSRX(+PSODATA,"IB")):"$",1:"")_PSOLNT_$P(PSODRG,"^")_$S(PSODQL<39:PSOQTL_$P(^PSRX(+PSODATA,0),"^",7)_" ",1:$G(PSOLSP))
"RTN","PSOORUT1",69,0)
 S STA="A^N^R^H^N^S^^^^^^E^DC^^DC^DE^H^P^"
"RTN","PSOORUT1",70,0)
 S PSOCMOP=""
"RTN","PSOORUT1",71,0)
 I $D(^PSDRUG("AQ",$P(^PSRX(+PSODATA,0),"^",6))) S PSOCMOP=">"
"RTN","PSOORUT1",72,0)
 N X S X="PSXOPUTL" X ^%ZOSF("TEST") K X I $T D
"RTN","PSOORUT1",73,0)
 .N DA S DA=+PSODATA D ^PSXOPUTL K DA
"RTN","PSOORUT1",74,0)
 .I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S PSOCMOP="T"
"RTN","PSOORUT1",75,0)
 .K PSXZ
"RTN","PSOORUT1",76,0)
 S STATLTH=$P(STA,"^",$P(PSODATA,"^",2)+1)
"RTN","PSOORUT1",77,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(STA,"^",$P(PSODATA,"^",2)+1)_$G(PSOCMOP)_$S($L(STATLTH)+$L(PSOCMOP)=0:"   ",$L(STATLTH)+$L(PSOCMOP)=1:"  ",$L(STATLTH)+$L(PSOCMOP)=2:" ",1:"")
"RTN","PSOORUT1",78,0)
 S PSOID=$P(^PSRX(+PSODATA,0),"^",13),PSOLF=+$G(^(3)),^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$E(PSOID,4,5)_"-"_$E(PSOID,6,7)_" "
"RTN","PSOORUT1",79,0)
 F PSOX=0:0 S PSOX=$O(^PSRX(+PSODATA,1,PSOX)) Q:'PSOX  I +^PSRX(+PSODATA,1,PSOX,0)=PSOLF,$P(^PSRX(+PSODATA,1,PSOX,0),"^",16) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",80,0)
 K PSOX
"RTN","PSOORUT1",81,0)
 I '$O(^PSRX(+PSODATA,1,0)),$P(^PSRX(+PSODATA,2),"^",15) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",82,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$S($G(PSOLF):$E(PSOLF,4,5),1:"  ")_"-"_$S($G(PSOLF):$E(PSOLF,6,7),1:"  ")_$S($P(PSOLF,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",83,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$J($P(PSODATA,"^",6),2)_" "_$J($P(PSODATA,"^",8),3)
"RTN","PSOORUT1",84,0)
 I PSODQL>38 S IEN=IEN+1 S ^TMP("PSOPF",$J,IEN,0)=PSOQTL_"Qty: "_$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSOORUT1",85,0)
 K PSOLNT,PSOQTL,PSOLSP,PSOLRX,PSODQL
"RTN","PSOORUT1",86,0)
 S PSOLST(PSOCNT)="52^"_+PSODATA_"^"_PSOSTA
"RTN","PSOORUT1",87,0)
 K PSODATA,PSOLF S PSOPF=IEN
"RTN","PSOORUT1",88,0)
 Q
"RTN","PSOORUT1",89,0)
STA K ZSTA
"RTN","PSOORUT1",90,0)
 S IEN=IEN+1 I PSOSTA="ZNONVA" S ZSTA=PSOSTA,PSOSTA="Non-VA MEDS (Not dispensed by VA)"
"RTN","PSOORUT1",91,0)
 S STR=($L(PSOSTA)+IOM/2)-$L(PSOSTA),STP=IOM-(STR+$L(PSOSTA)) F I=1:1:STR S ^TMP("PSOPF",$J,IEN,0)=$G(^TMP("PSOPF",$J,IEN,0))_"-"
"RTN","PSOORUT1",92,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_PSOSTA F I=1:1:STP S ^(0)=^(0)_"-"
"RTN","PSOORUT1",93,0)
 I $G(ZSTA)]"" S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"--" S PSOSTA=ZSTA K ZSTA
"RTN","PSOORUT1",94,0)
 Q
"RTN","PSOORUT1",95,0)
PENX S PSOLST(PSOCNT)="52.41^"_$P(PSODATA,"^",10)_"^"_PSOSTA
"RTN","PSOORUT1",96,0)
 K PSODATA,PSOLF,RN,PSOLSP,PSOQTL,PSOLNT
"RTN","PSOORUT1",97,0)
 Q
"RTN","PSOORUT1",98,0)
PEN ;
"RTN","PSOORUT1",99,0)
 N PSOQTL,PSOLNT,PSOLNTZ,PSOQTLX,PSCMOPF,SPACEZ
"RTN","PSOORUT1",100,0)
 Q:'$D(^PS(52.41,$P(PSODATA,"^",10),0))
"RTN","PSOORUT1",101,0)
 S PSCMOPF=0 I $P($G(PSODATA),"^",11),$D(^PSDRUG("AQ",$P(PSODATA,"^",11))) S PSCMOPF=1
"RTN","PSOORUT1",102,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(PSODRG,"^")
"RTN","PSOORUT1",103,0)
 S PSOLNT=$L($P(PSODRG,"^")),PSOLNTZ=$L($P(PSODATA,"^",8))
"RTN","PSOORUT1",104,0)
 S $P(PSOQTLX," ",(11-PSOLNTZ))=" "
"RTN","PSOORUT1",105,0)
 S:PSOLNT<37 $P(PSOQTL," ",(37-PSOLNT))=" "
"RTN","PSOORUT1",106,0)
 I PSOLNT<38 D  G PENX
"RTN","PSOORUT1",107,0)
 .I PSOLNT=37 S PSOQTL=""
"RTN","PSOORUT1",108,0)
 .I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") Q
"RTN","PSOORUT1",109,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  "_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")
"RTN","PSOORUT1",110,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")_$P(PSODATA,"^",6)
"RTN","PSOORUT1",111,0)
 S IEN=IEN+1,$P(SPACEZ," ",42)=" "
"RTN","PSOORUT1",112,0)
 I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") G PENX
"RTN","PSOORUT1",113,0)
 S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")
"RTN","PSOORUT1",114,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)
"RTN","PSOORUT1",115,0)
 G PENX
"RTN","PSOORUT2")
0^24^B21833506
"RTN","PSOORUT2",1,0)
PSOORUT2 ;ISC BHAM/SAB - build listman screen ;02/22/95
"RTN","PSOORUT2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,146,132**;DEC 1997
"RTN","PSOORUT2",3,0)
 ;External reference to SDPHARM1 supported by DBIA 4196
"RTN","PSOORUT2",4,0)
 K ^TMP("PSOHDR",$J),^TMP("PSOPI",$J) S DFN=PSODFN D ^VADPT,ADD^VADPT
"RTN","PSOORUT2",5,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1),^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSOORUT2",6,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSOORUT2",7,0)
 D NVA
"RTN","PSOORUT2",8,0)
 S POERR=1 D RE^PSODEM K POERR
"RTN","PSOORUT2",9,0)
 S ^TMP("PSOHDR",$J,6,0)=$S($P(WT,"^",8):$P(WT,"^",9)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSOORUT2",10,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$P(HT,"^",9)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSOORUT2",11,0)
 S GMRA="0^0^111" D ^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSOORUT2",12,0)
 S $P(^TMP("PSOHDR",$J,9,0)," ",62)="ISSUE  LAST REF DAY"
"RTN","PSOORUT2",13,0)
 S ^TMP("PSOHDR",$J,10,0)=" #  RX #         DRUG                                 QTY ST  DATE  FILL REM SUP"
"RTN","PSOORUT2",14,0)
 D ELIG^VADPT S ^TMP("PSOPI",$J,1,0)="Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","PSOORUT2",15,0)
 S ^TMP("PSOPI",$J,2,0)=" ",IEN=3,^TMP("PSOPI",$J,IEN,0)="Disabilities: "
"RTN","PSOORUT2",16,0)
 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSOORUT2",17,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSOORUT2",18,0)
 .S:$L(^TMP("PSOPI",$J,IEN,0)_PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 IEN=IEN+1,$P(^TMP("PSOPI",$J,IEN,0)," ",14)=" "
"RTN","PSOORUT2",19,0)
 .S ^TMP("PSOPI",$J,IEN,0)=$G(^TMP("PSOPI",$J,IEN,0))_PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSOORUT2",20,0)
 S IEN=IEN+1 S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1
"RTN","PSOORUT2",21,0)
 I +VAPA(9),+VAPA(10) S ^TMP("PSOPI",$J,IEN,0)="      (Temp Address from "_$P(VAPA(9),"^",2)_" till "_$P(VAPA(10),"^",2)_")",IEN=IEN+1
"RTN","PSOORUT2",22,0)
 S ^TMP("PSOPI",$J,IEN,0)=VAPA(1) S:VAPA(2)]"" IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(2) S:VAPA(3)]"" IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(3)
"RTN","PSOORUT2",23,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(4),$P(^TMP("PSOPI",$J,IEN,0)," ",40)="PHONE: "_VAPA(8)
"RTN","PSOORUT2",24,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6))
"RTN","PSOORUT2",25,0)
 S MAILD=+$P($G(^PS(55,DFN,0)),"^",3) D  K MAILD
"RTN","PSOORUT2",26,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Prescription Mail Delivery: "_$S(MAILD=1:"Certified Mail",MAILD=2:"DO NOT MAIL",MAILD=3:"Local - Regular Mail",MAILD=4:"Local - Certified Mail",1:"Regular Mail")
"RTN","PSOORUT2",27,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=$S($P($G(^PS(55,DFN,0)),"^",2):"Cannot use safety caps.",1:"") S $P(^TMP("PSOPI",$J,IEN,0)," ",40)=$S($P($G(^PS(55,DFN,0)),"^",4):"Dialysis Patient.",1:"")
"RTN","PSOORUT2",28,0)
 I $G(^PS(55,DFN,1))]"" S PSON=^(1),IEN=IEN+1 D
"RTN","PSOORUT2",29,0)
 .S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="     Outpatient Narrative: "
"RTN","PSOORUT2",30,0)
 .F I=1:1 Q:$P(PSON," ",I,99)=""  S:$L(^TMP("PSOPI",$J,IEN,0)_$P(PSON," ",I)_" ")>80 IEN=IEN+1 S ^TMP("PSOPI",$J,IEN,0)=$G(^TMP("PSOPI",$J,IEN,0))_$P(PSON," ",I)_" "
"RTN","PSOORUT2",31,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",32,0)
 I $D(^PS(52.91,DFN,0)) I '$P(^(0),"^",3)!($P(^(0),"^",3)>DT) D
"RTN","PSOORUT2",33,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Primary Care Appointment: "_$$PRIAPT^SDPHARM1(DFN)
"RTN","PSOORUT2",34,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",35,0)
 I 'GMRAL D
"RTN","PSOORUT2",36,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Allergies: "_$S(GMRAL=0:"NKA",1:""),IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",37,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Adverse Reactions:"
"RTN","PSOORUT2",38,0)
 D:$G(GMRAL) ^PSOORUT3
"RTN","PSOORUT2",39,0)
 K ^UTILITY("VASD",$J),VASD S DFN=PSODFN,VASD("F")=DT,VASD("T")=9999999,VASD("W")="123456789" D SDA^VADPT K VASD I $D(^UTILITY("VASD",$J)) D
"RTN","PSOORUT2",40,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Pending Clinic Appointments:"
"RTN","PSOORUT2",41,0)
 .F PSOAPP=0:0 S PSOAPP=$O(^UTILITY("VASD",$J,PSOAPP)) Q:'PSOAPP  S PSOAPPE=$G(^UTILITY("VASD",$J,PSOAPP,"E")),PSOAPPI=$G(^("I")) D
"RTN","PSOORUT2",42,0)
 ..K X S X2=DT,X1=$P($P($G(PSOAPPI),"^"),".") I $G(X1) D ^%DTC
"RTN","PSOORUT2",43,0)
 ..S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="    "_$P(PSOAPPE,"^")_"  "_$P(PSOAPPE,"^",2)_$S($P(PSOAPPI,"^",3)["C":"   *** Canceled ***",1:" ("_$G(X)_" days)")
"RTN","PSOORUT2",44,0)
 K ^UTILITY("VASD",$J),X,PSOAPPI,PSOAPPE,PSOAPP
"RTN","PSOORUT2",45,0)
 S PSOPI=IEN K IEN
"RTN","PSOORUT2",46,0)
 Q
"RTN","PSOORUT2",47,0)
NVA ;
"RTN","PSOORUT2",48,0)
 Q:'$O(^PS(55,PSODFN,"NVA",0))
"RTN","PSOORUT2",49,0)
 K LSTDT F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",I)) Q:'I  D
"RTN","PSOORUT2",50,0)
 .Q:$P(^PS(55,PSODFN,"NVA",I,0),"^",7)  Q:'$P(^PS(55,PSODFN,"NVA",I,0),"^")
"RTN","PSOORUT2",51,0)
 .I $P(^PS(55,PSODFN,"NVA",I,0),"^",10)>+$G(LSTDT) S LSTDT=$P(^(0),"^",10)
"RTN","PSOORUT2",52,0)
 I $G(LSTDT)]"" D
"RTN","PSOORUT2",53,0)
 .S LSTDT="Non-VA Meds on File - Last entry on "_$E(LSTDT,4,5)_"/"_$E(LSTDT,6,7)_"/"_$E(LSTDT,2,3)
"RTN","PSOORUT2",54,0)
 .I $G(^TMP("PSOHDR",$J,5,0))="MALE" S $P(^TMP("PSOHDR",$J,5,0)," ",22)=LSTDT K LSTDT Q
"RTN","PSOORUT2",55,0)
 .S $P(^TMP("PSOHDR",$J,5,0)," ",20)=LSTDT K LSTDT
"RTN","PSOORUT2",56,0)
 K I
"RTN","PSOORUT2",57,0)
 Q
"RTN","PSOORUTL")
0^28^B41534579
"RTN","PSOORUTL",1,0)
PSOORUTL ;ISC BHAM/SAB  - updates order status from oerr ;02/22/95
"RTN","PSOORUTL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**14,46,146,132**;DEC 1997
"RTN","PSOORUTL",3,0)
 ;External reference to EN^ORERR - 2187
"RTN","PSOORUTL",4,0)
 ;External reference to ^PS(55 - 2228
"RTN","PSOORUTL",5,0)
 ;Input variables, poerr("psofilnm")=pharmacy pointer # from OE/RR, poerr("stat")=Order Control status
"RTN","PSOORUTL",6,0)
 ;poerr("pharmst")=will contain 'ZE'if rx has expired, poerr("comm")=Comments, poerr("user")=Person placing request
"RTN","PSOORUTL",7,0)
EN(POERR) ;
"RTN","PSOORUTL",8,0)
 N PSZORS,III
"RTN","PSOORUTL",9,0)
 F OO=0:0 S OO=$O(MSG(OO)) Q:'OO  I $P(MSG(OO),"|")="ZRN" S NVA=1
"RTN","PSOORUTL",10,0)
 I $G(NVA) G NVA
"RTN","PSOORUTL",11,0)
 G:POERR("PSOFILNM")'["S" RXO S III=+POERR("PSOFILNM")
"RTN","PSOORUTL",12,0)
 S ORS=0 I $D(^PS(52.41,III,0)) D  G PEXIT
"RTN","PSOORUTL",13,0)
 .Q:$P($G(^PS(52.41,III,0)),"^",3)="RF"
"RTN","PSOORUTL",14,0)
 .I $G(PDFN),$P($G(^PS(52.41,III,0)),"^",2),PDFN'=$P(^PS(52.41,III,0),"^",2) S ORS=1
"RTN","PSOORUTL",15,0)
RXO S III=POERR("PSOFILNM") I $D(^PSRX(III,0)) D  G PEXIT
"RTN","PSOORUTL",16,0)
 .I $G(PDFN),$P($G(^PSRX(III,0)),"^",2),PDFN'=$P(^PSRX(III,0),"^",2) S ORS=1
"RTN","PSOORUTL",17,0)
 S (ORS,PSZORS)=1
"RTN","PSOORUTL",18,0)
PEXIT I $G(ORS) S POERR("STAT")=$S(POERR("STAT")="CA":"UC",POERR("STAT")="DC":"UD",POERR("STAT")="HD":"UH",1:"UR"),POERR("FILLER")="",POERR("COMM")=$S($G(PSZORS):"Unable to locate order.",1:"Patient does not match.") K ORS,PSZORS,III Q
"RTN","PSOORUTL",19,0)
 S POERR("PHARMST")="" G:POERR("STAT")="HD"!(POERR("STAT")="RL") HD
"RTN","PSOORUTL",20,0)
 S ORS=0 I POERR("PSOFILNM")["S" S DA=+POERR("PSOFILNM") I $D(^PS(52.41,DA,0)) D  G EXIT
"RTN","PSOORUTL",21,0)
 .Q:$P($G(^PS(52.41,DA,0)),"^",3)="RF"
"RTN","PSOORUTL",22,0)
 .S $P(^PS(52.41,DA,0),"^",3)="DC",POERR("PLACE")=$P(^(0),"^"),POERR("STAT")="CR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUTL",23,0)
 .K ^PS(52.41,"AOR",+$P($G(^PS(52.41,DA,0)),"^",2),+$P($G(^PS(52.41,DA,"INI")),"^"),DA)
"RTN","PSOORUTL",24,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order Canceled by OE/RR before finishing." S ORS=1,$P(^PS(52.41,DA,4),"^")=$G(POERR("COMM"))
"RTN","PSOORUTL",25,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) D  S $P(^PSRX(DA,"STA"),"^")=14 D CAN^PSOTPCAN(DA) G EXIT
"RTN","PSOORUTL",26,0)
 .;cancel/discontinue action
"RTN","PSOORUTL",27,0)
 .S POERR("PLACE")=+$P($G(^PSRX(DA,"OR1")),"^",2),POERR("STAT")=$S(POERR("STAT")="CA":"CR",1:"DR"),POERR("FILLER")=DA_"^R"
"RTN","PSOORUTL",28,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription DISCONTINUED by OERR"
"RTN","PSOORUTL",29,0)
 .S ORS=1 D CAN
"RTN","PSOORUTL",30,0)
EXIT I '$G(ORS) D
"RTN","PSOORUTL",31,0)
 .S POERR("STAT")=$S(POERR("STAT")="CA":"UC",POERR("STAT")="DC":"UD",POERR("STAT")="HD":"UH",1:"UR"),POERR("FILLER")="",POERR("COMM")="Order was not located by Pharmacy"
"RTN","PSOORUTL",32,0)
 K EXP,ORS,DA,ACOM,RXDA,SUSD,PSUS,RXF,I,FDA,DIC,DIE,DR,Y,X,%,%I,%H,RSDT,ACNT,ACT,DIK,FDT,IR,LFD,NOW,ORD,PSDA,PSCDA,PSODFN,PSUS,RF,RFCNT,RXN,RXP,RXREF,SD,SUB
"RTN","PSOORUTL",33,0)
 Q
"RTN","PSOORUTL",34,0)
CAN S ACOM="Discontinued by OE/RR." I $P(^PSRX(DA,"STA"),"^")=3!($P(^("STA"),"^")=16) D
"RTN","PSOORUTL",35,0)
 .S ACOM="Discontinued by OE/RR while on hold. " K:$P(^PSRX(DA,"H"),"^") ^PSRX("AH",$P(^PSRX(DA,"H"),"^"),DA) S ^PSRX(DA,"H")=""
"RTN","PSOORUTL",36,0)
 .I $P(^PSRX(DA,0),"^",13),'$O(^PSRX(DA,1,0)) S DIE=52,DR="22///"_$E($P(^PSRX(DA,0),"^",13),1,7) D ^DIE K DIE,DR Q
"RTN","PSOORUTL",37,0)
 .S (IFN,SUSD)=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  S SUSD=IFN,RFDT=$P(^PSRX(DA,1,IFN,0),"^")
"RTN","PSOORUTL",38,0)
 .Q:'$G(SUSD)  I '$P(^PSRX(DA,1,SUSD,0),"^",18) S PSDTEST=0 D  I 'PSDTEST K ^PSRX(DA,1,SUSD),^PSRX("AD",RFDT,DA,SUSD),^PSRX(DA,1,"B",RFDT,SUSD),IFN,SUSD,RFDT
"RTN","PSOORUTL",39,0)
 ..F PDA=0:0 S PDA=$O(^PSRX(DA,"L",PDA)) Q:'PDA  I $P($G(^PSRX(DA,"L",PDA,0)),"^",2)=SUSD S PSDTEST=1
"RTN","PSOORUTL",40,0)
 ..K CMOP D ^PSOCMOPA I $G(CMOP(CMOP("L")))="",$G(CMOP("S"))'="L" Q
"RTN","PSOORUTL",41,0)
 ..S PSDTEST=1
"RTN","PSOORUTL",42,0)
 S RXDA=DA,(DA,SUSDA)=$O(^PS(52.5,"B",DA,0)) D:DA
"RTN","PSOORUTL",43,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOORUTL",44,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 ACOM="Discontinued by OE/RR while suspended."
"RTN","PSOORUTL",45,0)
 .I $O(^PSRX(RXDA,1,0)) S DA=RXDA D:'$G(^PS(52.5,+SUSDA,"P")) REF^PSOCAN2
"RTN","PSOORUTL",46,0)
 .S DA=SUSDA,DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORUTL",47,0)
 K SUSD,SUSDA S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2) D
"RTN","PSOORUTL",48,0)
 .S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(DA,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOORUTL",49,0)
 .S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOORUTL",50,0)
 .D NOW^%DTC S ^PSRX(DA,"A",0)="^52.3DA^"_(ACNT+1)_"^"_(ACNT+1),^PSRX(DA,"A",ACNT+1,0)=%_"^C^"_POERR("USER")_"^"_RFCNT_"^"_$G(ACOM)
"RTN","PSOORUTL",51,0)
 .S REA="C" D EXP^PSOHELP1
"RTN","PSOORUTL",52,0)
 I $G(^PS(52.4,DA,0))]"" S PSCDA=DA,DIK="^PS(52.4," D ^DIK S DA=PSCDA K DIK,PSCDA
"RTN","PSOORUTL",53,0)
 Q
"RTN","PSOORUTL",54,0)
HD ;place order on hold
"RTN","PSOORUTL",55,0)
 G:POERR("STAT")="RL" REL^PSOORUT1 S (ACT,ORS)=0 I POERR("PSOFILNM")["S" D  G EXIT
"RTN","PSOORUTL",56,0)
 .S DA=+POERR("PSOFILNM")
"RTN","PSOORUTL",57,0)
 .Q:'$D(^PS(52.41,DA,0))  Q:$P(^PS(52.41,DA,0),"^",3)="RF"
"RTN","PSOORUTL",58,0)
 .S $P(^PS(52.41,DA,0),"^",3)="HD",POERR("STAT")="HR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUTL",59,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order PLACED on HOLD by OERR before finished." S $P(^PS(52.41,DA,4),"^")=POERR("COMM"),ORS=1
"RTN","PSOORUTL",60,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) S ORS=1,PSDA=DA D  G EXIT
"RTN","PSOORUTL",61,0)
 .S POERR("FILLER")=DA_"^R"
"RTN","PSOORUTL",62,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription Placed on HOLD by OERR"
"RTN","PSOORUTL",63,0)
 .I DT>$P(^PSRX(DA,2),"^",6) S EXP=$P(^(2),"^",6) S:$P(^PSRX(DA,"STA"),"^")<12 $P(^PSRX(DA,"STA"),"^")=11,PSOEXFLG=1 S POERR("STAT")="UH",POERR("COMM")="Prescription EXPIRED on "_$E(EXP,4,5)_"/"_$E(EXP,6,7)_"/"_$E(EXP,2,3)_"." D  Q
"RTN","PSOORUTL",64,0)
 ..D ECAN^PSOUTL(DA)
"RTN","PSOORUTL",65,0)
 .I $P(^PSRX(DA,"STA"),"^")=3!($P(^("STA"),"^")>11) S POERR("STAT")="UH",POERR("COMM")="Unable to place on HOLD" Q
"RTN","PSOORUTL",66,0)
 .S $P(^PSRX(DA,"STA"),"^")=16,POERR("STAT")="HR",^PSRX(DA,"H")=99_"^"_POERR("COMM")_"^"_DT
"RTN","PSOORUTL",67,0)
 .S (PSUS,RXF)=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:RXF>1 RSDT=$P(^(RXF-1,0),"^")
"RTN","PSOORUTL",68,0)
 .S DA=$O(^PS(52.5,"B",PSDA,0)) I DA S DIK="^PS(52.5,",PSUS=1 D ^DIK K DA,DIK
"RTN","PSOORUTL",69,0)
 .S DA=PSDA D ACT
"RTN","PSOORUTL",70,0)
 I 'ORS S POERR("COMM")="Unable to place order on HOLD" G EXIT
"RTN","PSOORUTL",71,0)
 Q
"RTN","PSOORUTL",72,0)
NVA ;non-va med action
"RTN","PSOORUTL",73,0)
 K NVA
"RTN","PSOORUTL",74,0)
 I POERR("PSOFILNM")'["N"!('$D(^PS(55,PDFN,"NVA",+POERR("PSOFILNM"),0))) D EN^ORERR("Order was not located by Pharmacy",.MSG) Q
"RTN","PSOORUTL",75,0)
 I $G(OR("STAT"))'="CA",$G(OR("STAT"))'="DC" D EN^ORERR("Invalid Order Control Code",.MSG) Q
"RTN","PSOORUTL",76,0)
XO S ORD=+POERR("PSOFILNM") D NOW^%DTC S $P(^PS(55,PDFN,"NVA",ORD,0),"^",6)=$S($G(PSODEATH):2,1:1),$P(^(0),"^",7)=%,PLACER=$P(^PS(55,PDFN,"NVA",ORD,0),"^",8)
"RTN","PSOORUTL",77,0)
 S:$G(PSODEATH) ^PS(55,PSODFN,"NVA","APSOD",ORD)="" K ORD,%
"RTN","PSOORUTL",78,0)
 K MSG S NULLFLDS="F JJ=0:1:LIMIT S FIELD(JJ)="""""
"RTN","PSOORUTL",79,0)
 K ^UTILITY("DIQ1",$J),DIQ S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOORUTL",80,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOHINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIQ,DIC
"RTN","PSOORUTL",81,0)
 S MSG(1)="MSH|^~\&|PHARMACY|"_$G(PSOHINST)_"|||||ORR"
"RTN","PSOORUTL",82,0)
 ;
"RTN","PSOORUTL",83,0)
 S DFN=PDFN,COUNT=1,LIMIT=5 X NULLFLDS D DEM^VADPT S NAME=$G(VADM(1)) K VADM
"RTN","PSOORUTL",84,0)
 S FIELD(0)="PID",FIELD(3)=DFN,FIELD(5)=NAME
"RTN","PSOORUTL",85,0)
 D SEG^PSOHLSN1
"RTN","PSOORUTL",86,0)
 ;
"RTN","PSOORUTL",87,0)
 S LIMIT=15 X NULLFLDS
"RTN","PSOORUTL",88,0)
 S FIELD(0)="ORC",FIELD(2)=PLACER_"^OR",FIELD(3)=+POERR("PSOFILNM")_"N^PS"
"RTN","PSOORUTL",89,0)
 S FIELD(1)="SC",FIELD(5)="DC"
"RTN","PSOORUTL",90,0)
 D SEG^PSOHLSN1
"RTN","PSOORUTL",91,0)
 I $G(PSODEATH) S MSG(COUNT)=MSG(COUNT)_"|^^^^DATE OF DEATH ENTERED BY MAS.^"
"RTN","PSOORUTL",92,0)
 ;
"RTN","PSOORUTL",93,0)
 D SEND^PSOHLSN1 K FIELDS,LIMIT,PSODSC,PSONVA,OI
"RTN","PSOORUTL",94,0)
 Q
"RTN","PSOORUTL",95,0)
 ;
"RTN","PSOORUTL",96,0)
ACT ;activity log
"RTN","PSOORUTL",97,0)
 D NOW^%DTC S NOW=%
"RTN","PSOORUTL",98,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORUTL",99,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORUTL",100,0)
 S ^PSRX(DA,"A",IR,0)=NOW_"^"_$S(ACT:"U",1:"H")_"^"_POERR("USER")_"^"_RXF_"^"_"RX "_$S('ACT:"placed in a",1:"removed from")_" HOLD status "_$S(+$G(PSUS):"and removed from SUSPENSE ",1:"")_"("_$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)_") by OERR."
"RTN","PSOORUTL",101,0)
 Q
"RTN","PSOP")
0^12^B45598913
"RTN","PSOP",1,0)
PSOP ;BIR/SAB - medication profile long or short ;02/25/94
"RTN","PSOP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,15,98,132**;DEC 1997
"RTN","PSOP",3,0)
 ;External reference to PS(55 supported by DBIA 2228
"RTN","PSOP",4,0)
 ;External reference to PS(59.7 supported by DBIA 694
"RTN","PSOP",5,0)
 ;External reference to PSDRUG supported by DBIA 221
"RTN","PSOP",6,0)
 W !! K ^TMP($J),ZTSK,CLS S DIC=2,DIC(0)="QEAM" D ^DIC G Q:Y<0  S PSOLOUD=1,DFN=+Y D:$P($G(^PS(55,+Y,0)),"^",6)'=2 EN^PSOHLUP(+Y) K PSOLOUD S Y=DFN
"RTN","PSOP",7,0)
DOIT S (FN,DFN,D0,DA)=+Y I '$D(^PS(55,+Y,"P")),'$D(^("ARC")),'$D(^("NVA")),'$D(^PS(52.41,"AOR",+Y)) W !?20,$C(7),"NO PHARMACY INFORMATION" H 5 D ^PSODEM G PSOP
"RTN","PSOP",8,0)
 I '$O(^PS(55,+Y,"P",0)),$D(^PS(55,+Y,"ARC")) D ^PSODEM W !!,"PATIENT HAS ARCHIVED PRESCRIPTIONS",! G PSOP
"RTN","PSOP",9,0)
 S DIR("?")="Enter 'L' for a long profile or 'S' for a short profile",DIR("A")="LONG or SHORT: ",DIR(0)="SA^L:LONG;S:SHORT",DIR("B")="SHORT" D ^DIR G:$D(DUOUT)!$D(DIRUT) Q S PLS=Y K DIR
"RTN","PSOP",10,0)
S S DIR(0)="SA^D:DATE;M:MEDICATION;C:CLASS",DIR("A")="Sort by DATE, CLASS or MEDICATION: ",DIR("B")=$S($P($G(PSOPAR),"^",14)=2:"MEDICATION",$P($G(PSOPAR),"^",14)=1:"CLASS",1:"DATE")
"RTN","PSOP",11,0)
 S DIR("?",1)="Enter 'DATE', 'CLASS' or 'MEDICATION' to determine the order in which",DIR("?")="prescriptions will appear on the profile." D ^DIR G:$D(DUOUT)!$D(DIRUT) Q S PSRT=$S(Y="D":"DATE",Y="M":"DRUG",1:"CLSS")
"RTN","PSOP",12,0)
 S HDR=$S(Y="D":"ISSUE DATE",Y="M":"DRUG NAME",1:"DRUG CLASS") K DIR
"RTN","PSOP",13,0)
 K DIR G:PSRT="DATE" DEV S DIR("A")="Profile Expiration/Discontinued cutoff",DIR("B")=120,DIR(0)="N^1:9999:0",DIR("?",1)="Enter the number of days which will cut discontinued and expired Rx's from",DIR("?")="the profile."
"RTN","PSOP",14,0)
 D ^DIR G:$D(DTOUT)!($D(DUOUT)) Q K DIR S X1=DT,X2=-X D C^%DTC S PSODTCT=X
"RTN","PSOP",15,0)
DEV D SORT^PSOP1 G:$D(DUOUT)!($D(DTOUT)) Q
"RTN","PSOP",16,0)
 K %ZIS,IOP,ZTSK S PSOION=ION,%ZIS="MQ" D ^%ZIS K %ZIS I POP S IOP=PSOION D ^%ZIS K IOP,PSOION G Q
"RTN","PSOP",17,0)
 K PSOION I $D(IO("Q")) S ZTDESC="Patient Medication Profile",ZTRTN="P^PSOP" D  G PSOP
"RTN","PSOP",18,0)
 .F G="HDR","TO","FR","SDT","PSFR","PSTO","DTS","CLS","EDT","DRS","PSODTCT","FN","DFN","DA","D0","PLS","PSRT","PSOPAR" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOP",19,0)
 .K IO("Q") D ^%ZTLOAD W:$D(ZTSK) !,"Task Queued to Print",! K Q,ZTSK D Q
"RTN","PSOP",20,0)
 D P,Q G PSOP
"RTN","PSOP",21,0)
P U IO S PAGE=1,$P(PSOPLINE,"-",80)="" K ^TMP($J) D LOOP D ^PSODEM W:$O(^PS(55,DA,"ARC",0)) !!,"Patient Has Archived Prescriptions",!
"RTN","PSOP",22,0)
 I $Y+10>IOSL,$E(IOST)="C" D DIR^PSOP1 Q:$D(PQT)  W @IOF
"RTN","PSOP",23,0)
 W:$P($G(^PS(59.7,1,40.1)),"^") !,"Outpatient prescriptions are discontinued 72 hours after admission"
"RTN","PSOP",24,0)
 W !!?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",25,0)
 I PLS="S" D ^PSOP1 G Q
"RTN","PSOP",26,0)
 W ! S DRUG="" F II=0:0 S DRUG=$O(^TMP($J,DRUG)) Q:DRUG=""!($D(PQT))  F J=0:0 S J=$O(^TMP($J,DRUG,J)) Q:'J  D O W:$G(PQT) @IOF Q:$G(PQT)  I $Y+8>IOSL,$E(IOST)="C" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",27,0)
 D PEND^PSOP2,NVA^PSOP2
"RTN","PSOP",28,0)
Q D ^%ZISC K CP,HDR,X1,X2,RX3,^TMP($J),ST0,PSODTCT,ST,D0,DIC,DIR,DIRUT,DUOUT,G,II,K,RXD,RXF,ZX,DRUG,X,DFN,PHYS,PSRT,CT,AL,I1,PLS,REF,LMI,PI,FN,Y,I,J,RX,DRX,ST,RX0,RX2,DA,PSOPLINE,PAGE,PRLBL,PSOPATOK
"RTN","PSOP",29,0)
 K PSOLR,PSDIV,PQT,TO,FR,CLS,DRG,DRS,DTS,DTOUT,PSFR,PSTO,SDT,EDT,PPP,FSIG,IIII,STAT,PP,EEEE,PPPCNT,PENDREX,PSOPEND,PPDIS,PPOI,PCOUNT,PPCOUNT,PPP S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOP",30,0)
O S RX0=^PSRX(J,0),RX2=$G(^(2)),RX3=$G(^(3)),$P(RX0,"^",15)=$G(^("STA")),DRX="NOT ON FILE",CP=$S(+$G(^PSRX(J,"IB")):"$",1:" ") S:$P(RX0,"^",15)="" $P(RX0,"^",15)=-1
"RTN","PSOP",31,0)
 I $D(^PSDRUG(+$P(RX0,"^",6),0)) S DRX=$P(^(0),"^")
"RTN","PSOP",32,0)
 I $Y+10>IOSL,IOSL["C-" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",33,0)
 I $Y+10>IOSL,$E(IOST)'="C" S PAGE=PAGE+1 D
"RTN","PSOP",34,0)
 .W @IOF,!,$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP",35,0)
 .W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",36,0)
 .W !,PSOPLINE
"RTN","PSOP",37,0)
 W !!,"Rx #: "_CP_$P(RX0,"^"),?32,"Drug: ",$G(DRX)
"RTN","PSOP",38,0)
 S PSOBRSIG=$P($G(^PSRX(J,"SIG")),"^",2) K FSIG,BSIG D
"RTN","PSOP",39,0)
 .I PSOBRSIG D FSIG^PSOUTLA("R",J,70) Q
"RTN","PSOP",40,0)
 .D EN2^PSOUTLA1(J,70) F IIII=0:0 S IIII=$O(BSIG(IIII)) Q:'IIII  S FSIG(IIII)=BSIG(IIII)
"RTN","PSOP",41,0)
 K PSOBRSIG,IIII,BSIG
"RTN","PSOP",42,0)
 W !?2,"SIG: "_$G(FSIG(1)) D:$O(FSIG(1))
"RTN","PSOP",43,0)
 .F IIII=1:0 S IIII=$O(FSIG(IIII)) Q:'IIII!($G(PQT))  W !?7,$G(FSIG(IIII))  D:($Y+5>IOSL)&($E(IOST)["C") DIR^PSOP1 Q:$G(PQT)  D:$Y+5>IOSL
"RTN","PSOP",44,0)
 ..S PAGE=PAGE+1
"RTN","PSOP",45,0)
 ..W @IOF,!,$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP",46,0)
 ..W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",47,0)
 ..W !,PSOPLINE
"RTN","PSOP",48,0)
 Q:$G(PQT)
"RTN","PSOP",49,0)
 W !?2,"QTY: ",$P(RX0,"^",7),?23,"# of Refills: ",$P(RX0,"^",9),?45,"Issue/Expr: " S Y=$P(RX0,"^",13) W $E(Y,4,5),"-",$E(Y,6,7),"-",$E(Y,2,3),"/" S Y=$P(RX2,"^",6) W:Y $E(Y,4,5),"-",$E(Y,6,7),"-",$E(Y,2,3)
"RTN","PSOP",50,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(RX0,"^",4) D ^DIC S PHYS=$S(+Y:$P(Y,"^",2),1:"Unknown") K DIC,X,Y
"RTN","PSOP",51,0)
 W !?2,"Prov: "_PHYS,?30,"Entry By: "_$P(RX0,"^",16),?45,"Filled: " S Y=$P(RX2,"^",2) W:Y $E(Y,4,5),"-",$E(Y,6,7),"-",$E(Y,2,3) W " (",$P(RX0,"^",11),")"
"RTN","PSOP",52,0)
 I $P(RX3,"^",3) D
"RTN","PSOP",53,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(RX3,"^",3) D ^DIC S PHYS=$S(+Y:$P(Y,"^",2),1:"Unknown") K DIC,X,Y W !?2,"Cosigner: "_PHYS K PHYS
"RTN","PSOP",54,0)
 S PSOLR=$S($P(RX2,"^",13):$P(RX2,"^",13),1:"") F PSOX=0:0 S PSOX=$O(^PSRX(J,1,PSOX)) Q:'PSOX  S:$P(^PSRX(J,1,PSOX,0),"^",18) PSOLR=$P(^(0),"^",18)
"RTN","PSOP",55,0)
 W !?2,"Last Released: " W:PSOLR $E(PSOLR,4,5)_"-"_$E(PSOLR,6,7)_"-"_$E(PSOLR,2,3)
"RTN","PSOP",56,0)
 W ?45,$S($P(RX2,"^",15):"Original Fill Returned to Stock",1:"Original Release: "_$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"-"_$E($P(RX2,"^",13),6,7)_"-"_$E($P(RX2,"^",13),2,3),1:""))
"RTN","PSOP",57,0)
 S CT=0,REF=$P(RX0,"^",9) F K=0:0 S K=$O(^PSRX(J,1,K)) Q:'K  S RX1=^PSRX(J,1,K,0) D
"RTN","PSOP",58,0)
 .I $Y+5>IOSL,IOSL["C-" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",59,0)
 .I $Y+5>IOSL,$E(IOST)'="C" S PAGE=PAGE+1 D
"RTN","PSOP",60,0)
 ..W @IOF,!,$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP",61,0)
 ..W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",62,0)
 ..W !,PSOPLINE
"RTN","PSOP",63,0)
 .W !?2,"Refilled: "_$E($P(RX1,"^"),4,5)_"-"_$E($P(RX1,"^"),6,7)_"-"_$E($P(RX1,"^"),2,3)_" ("_$P(RX1,"^",2)_")"_$S($P(RX1,"^",16):"(R)",1:"")
"RTN","PSOP",64,0)
 .W ?30,"Released: "_$S($P(RX1,"^",18):$E($P(RX1,"^",18),4,5)_"-"_$E($P(RX1,"^",18),6,7)_"-"_$E($P(RX1,"^",18),2,3),1:"")
"RTN","PSOP",65,0)
 .S REF=REF-1
"RTN","PSOP",66,0)
 I $Y+2>IOSL,IOSL["C-" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",67,0)
 I $Y+2>IOSL,$E(IOST)'="C" S PAGE=PAGE+1 W @IOF,!,$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP",68,0)
 I $O(^PSRX(J,"P",0)) W !?2,"Partials: " F K=0:0 S K=$O(^PSRX(J,"P",K)) Q:'K  W $E(^(K,0),4,5),"-",$E(^(0),6,7),"-",$E(^(0),2,3)," (",$P(^(0),"^",2),") QTY:",$P(^(0),"^",4)_$S($P(^(0),"^",16):" (R)",1:"")_", "
"RTN","PSOP",69,0)
 W:$P(RX3,"^",7)]"" !?2,"Remarks: ",$P(RX3,"^",7) D STAT^PSOFUNC
"RTN","PSOP",70,0)
 S PSDIV=$S($D(^PS(59,+$P(RX2,"^",9),0)):$P(^(0),"^")_" ("_$P(^(0),"^",6)_")",1:"Unknown")
"RTN","PSOP",71,0)
 W !?2,"Division: "_$E(PSDIV,1,25),?40,ST,?60,REF," Refill"_$S(REF'=1:"s",1:"")," Left"
"RTN","PSOP",72,0)
 Q
"RTN","PSOP",73,0)
LOOP F I=0:0 S I=$O(^PS(55,DFN,"P",I)) Q:'I  S J=+^(I,0) D  I $G(PSOPATOK),$D(^PSRX(J,0)),$P($G(^PSRX(J,"STA")),"^")'=13 S PRLBL=PSRT_"^PSOP2" D @PRLBL
"RTN","PSOP",74,0)
 .S PSOPATOK=1 I $P($G(^PSRX(+$G(J),0)),"^",2),DFN'=$P($G(^(0)),"^",2) K ^PS(55,DFN,"P",I,0) S:$P($G(^PS(55,DFN,"P",0)),"^",4) $P(^PS(55,DFN,"P",0),"^",4)=$P($G(^(0)),"^",4)-1 S PSOPATOK=0
"RTN","PSOP",75,0)
 Q
"RTN","PSOP1")
0^19^B25203140
"RTN","PSOP1",1,0)
PSOP1 ;BHAM ISC/SAB - prints short medication profile ;02/25/94
"RTN","PSOP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,46,103,132**;DEC 1997
"RTN","PSOP1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOP1",4,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOP1",5,0)
 K RX,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSOP1",6,0)
 D HD S DRUG="" F I=0:0 S DRUG=$O(^TMP($J,DRUG)) Q:DRUG=""!($G(PQT))  D  G:$D(DTOUT)!($D(DUOUT))!($D(DIROUT)) Q
"RTN","PSOP1",7,0)
 .F J=0:0 S J=$O(^TMP($J,DRUG,J)) Q:'J!($G(PQT))  S RX0=^(J),RX2=$G(^PSRX(J,2)),$P(RX0,"^",15)=$G(^("STA")),CP=$S(+$G(^PSRX(J,"IB")):"$",1:" ") S:$P(RX2,"^",15)&($P(RX2,"^",2)) RST($P(RX2,"^",2))=1 S:$P(RX0,"^",15)="" $P(RX0,"^",15)=-1 D W
"RTN","PSOP1",8,0)
 D:'$G(PQT) PEND^PSOP2,NVA^PSOP2
"RTN","PSOP1",9,0)
Q D ^%ZISC K ^TMP($J),PQT,PSODTCT,ST,D0,DIC,DIR,DIRUT,DUOUT,G,II,K,RXD,RXF,ZX,DRUG,X,DFN,PHYS,PSRT,CT,AL,I1,PLS,REF,LMI,PI,FN,Y,I,J,RX,DRX,ST,RX0,RX2,DA,PPPSTAT,PPP,EEEE,PPPCNT,PENDREX,PSOPEND,PPDIS,PPOI,PCOUNT,PP,FSIG S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOP1",10,0)
 K ZZZZ Q
"RTN","PSOP1",11,0)
W I $Y+6>IOSL,$E(IOST)="C" D DIR W @IOF Q:$D(PQT)  D HD
"RTN","PSOP1",12,0)
 U IO I IO'=IO(0),$Y+6>IOSL W @IOF D HD
"RTN","PSOP1",13,0)
 I $E(IOST)'="C",$Y+6>IOSL W @IOF D HD
"RTN","PSOP1",14,0)
 D STAT^PSOFUNC S STA="A^N^R^H^P^S^^^^^^E^DC^^DC^DE^PH",ST=$P(STA,"^",(ST0+1)) K STA
"RTN","PSOP1",15,0)
 W !,CP_$P(RX0,"^"),?13,$S($D(^PSDRUG(+$P(RX0,"^",6),0)):$P(^(0),"^"),1:"NOT ON FILE"),?54,$S($L(ST)=1:" "_ST,1:ST)
"RTN","PSOP1",16,0)
 S RXD=$P($G(^PSRX(J,3)),"^"),RXF=$P(RX0,"^",9) F II=0:0 S II=$O(^PSRX(J,1,II)) Q:'II  S RXF=RXF-1 S:$P(^PSRX(J,1,II,0),"^",16) RST($P(^(0),"^"))=1
"RTN","PSOP1",17,0)
 W ?58,$S($L(RXF)=1:" "_RXF,1:RXF)
"RTN","PSOP1",18,0)
 W ?61,$E($P(RX0,"^",13),4,5)_"-"_$E($P(RX0,"^",13),6,7)_"-"_$E($P(RX0,"^",13),2,3) W:RXD ?70,$E(RXD,4,5)_"-"_$E(RXD,6,7)_"-"_$E(RXD,2,3)_$S($G(RST(RXD)):"R",1:"")
"RTN","PSOP1",19,0)
 S PSOPRSIG=$P($G(^PSRX(J,"SIG")),"^",2) K FSIG,BSIG D
"RTN","PSOP1",20,0)
 .I PSOPRSIG D FSIG^PSOUTLA("R",J,50) Q
"RTN","PSOP1",21,0)
 .D EN2^PSOUTLA1(J,50) F GGGG=0:0 S GGGG=$O(BSIG(GGGG)) Q:'GGGG  S FSIG(GGGG)=BSIG(GGGG)
"RTN","PSOP1",22,0)
 K PSOPRSIG,GGGG,BSIG
"RTN","PSOP1",23,0)
 W !?5,"QTY: ",$P(RX0,"^",7),?24,"SIG: ",$G(FSIG(1)) D:$O(FSIG(1))
"RTN","PSOP1",24,0)
 .F GGGG=1:0 S GGGG=$O(FSIG(GGGG)) Q:'GGGG!($G(PQT))  W !,?29,$G(FSIG(GGGG)) D:$Y+5>IOSL&($E(IOST)="C") DIR Q:$G(PQT)  I '$G(PQT),($Y+5>IOSL) W @IOF D HD
"RTN","PSOP1",25,0)
 K GGGG,FSIG Q:$G(PQT)
"RTN","PSOP1",26,0)
 ;D SIG
"RTN","PSOP1",27,0)
 K RST Q
"RTN","PSOP1",28,0)
HD D:PAGE>1
"RTN","PSOP1",29,0)
 .W !,"Patient: "_$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP1",30,0)
 .W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP1",31,0)
 W !?57,"REF",!?1,"Rx#",?13,"Drug",?54,"ST",?57,"REM",?62,"Issued",?70,"Last Fill",!,PSOPLINE S PAGE=PAGE+1
"RTN","PSOP1",32,0)
 Q
"RTN","PSOP1",33,0)
SORT K DIR,DUOUT,DTOUT
"RTN","PSOP1",34,0)
 S DIR("B")="All",DIR("A",1)=" ",DIR("A")="All Medications or Selection (A/S): ",DIR(0)="SAM^A:All;S:Select Range",DIR("?",1)="Enter 'A' to Print Entire Medication Profile",DIR("?")="   or 'S' for Selection Range" D ^DIR
"RTN","PSOP1",35,0)
 K DIR Q:$D(DIRUT)!(Y="A")!(Y="E")  D @PSRT
"RTN","PSOP1",36,0)
 Q
"RTN","PSOP1",37,0)
DATE ;asks date range
"RTN","PSOP1",38,0)
 W ! K %DT S %DT="AEX",%DT("A")="Starting Date: " D ^%DT  I "^"[X S DUOUT=1 Q
"RTN","PSOP1",39,0)
 G:Y<0 DATE S SDT=+Y,%DT(0)=SDT,FR=$E(SDT,4,5)_"/"_$E(SDT,6,7)_"/"_$E(SDT,2,3)
"RTN","PSOP1",40,0)
EDT S %DT("A")="Ending Date: " D ^%DT  I "^"[X S DUOUT=1 Q
"RTN","PSOP1",41,0)
 G:Y<0 EDT S EDT=+Y,DTS=1,TO=$E(EDT,4,5)_"/"_$E(EDT,6,7)_"/"_$E(EDT,2,3)
"RTN","PSOP1",42,0)
 K %DT Q
"RTN","PSOP1",43,0)
DRUG ;asks drug list
"RTN","PSOP1",44,0)
 W ! S DIC("A")="Start with Drug: ",DIC(0)="AEMQ",DIC=50
"RTN","PSOP1",45,0)
 S DIC("S")="I $S('$D(^PSDRUG(Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),$S('$D(^PSDRUG(Y,2)):1,$P(^(2),""^"",3)'[""O"":0,1:1)"
"RTN","PSOP1",46,0)
 D ^DIC I "^"[X S DUOUT=1 K DIC Q
"RTN","PSOP1",47,0)
 G:Y<0 DRUG S FR=$P(Y,"^",2)
"RTN","PSOP1",48,0)
 F %=$L($E(FR,1,30)):-1:1 S M=$A(FR,%) I M>32 S Y1=$E(FR,1,%-1)_$C(M-1)_$C(122) Q
"RTN","PSOP1",49,0)
 S PSFR=Y1 K Y1,Y,X
"RTN","PSOP1",50,0)
TO S DIC("A")="To Drug: " D ^DIC I "^"[X S DUOUT=1 K DIC Q
"RTN","PSOP1",51,0)
 G:Y<0 TO I FR]$P(Y,"^",2) W !,$C(7),"Less Than 'Start' Value" K X,Y G TO
"RTN","PSOP1",52,0)
 S TO=$P(Y,"^",2),DRS=1
"RTN","PSOP1",53,0)
 F %=$L($E(TO,1,30)):-1:1 S M=$A(TO,%) I M>32 S Y1=$E(TO,1,%-1)_$C(M+1)_$C(122) Q
"RTN","PSOP1",54,0)
 S PSTO=Y1 K Y1,Y,X,DIC
"RTN","PSOP1",55,0)
 Q
"RTN","PSOP1",56,0)
CLSS ;asks drug class list
"RTN","PSOP1",57,0)
 W ! S DIC("A")="Start with Drug Class: ",DIC(0)="AEQ",DIC=50.605 D ^DIC I "^"[X S DUOUT=1 Q
"RTN","PSOP1",58,0)
 G:Y<0 CLSS S FR=$P(Y,"^",2)
"RTN","PSOP1",59,0)
 F %=$L($E(FR,1,30)):-1:1 S M=$A(FR,%) I M>32 S Y1=$E(FR,1,%-1)_$C(M-1)_$C(122) Q
"RTN","PSOP1",60,0)
 S PSFR=Y1 K Y1,Y,X
"RTN","PSOP1",61,0)
TO1 S DIC("A")="To Drug Class: " D ^DIC I "^"[X S DUOUT=1 Q
"RTN","PSOP1",62,0)
 G:Y<0 TO1 I FR]$P(Y,"^",2) W !,$C(7),"Less Than 'Start' Value" K X,Y G TO1
"RTN","PSOP1",63,0)
 S TO=$P(Y,"^",2)
"RTN","PSOP1",64,0)
 F %=$L($E(TO,1,30)):-1:1 S M=$A(TO,%) I M>32 S Y1=$E(TO,1,%-1)_$C(M+1)_$C(122) Q
"RTN","PSOP1",65,0)
 S PSTO=Y1,CLS=1 K Y,Y1,X
"RTN","PSOP1",66,0)
 Q
"RTN","PSOP1",67,0)
DIR K PQT,DTOUT,DUOUT,DIR,DIRUT S DIR(0)="E" D ^DIR S:$D(DUOUT)!($D(DTOUT)) PQT=1 Q
"RTN","PSOP1",68,0)
SIG I '$P(^PSRX(J,"SIG"),"^",2) D  Q
"RTN","PSOP1",69,0)
 .S X=$P(^PSRX(J,"SIG"),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOP1",70,0)
 .F SG=1:1:$L(SIG) W:($X+$L($P(SIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W:$P(SIG," ",SG)]"" $P(SIG," ",SG)_" "
"RTN","PSOP1",71,0)
 S MIG=$P(^PSRX(J,"SIG"),"^"),SIGOK=1 D
"RTN","PSOP1",72,0)
 .F SG=1:1:$L(MIG) Q:$P(MIG," ",SG)=""  W:($X+$L($P(MIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W $P(MIG," ",SG)_" "
"RTN","PSOP1",73,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^") D
"RTN","PSOP1",74,0)
 .F SG=1:1:$L(MIG) Q:$P(MIG," ",SG)=""  W:($X+$L($P(MIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W $P(MIG," ",SG)_" "
"RTN","PSOP1",75,0)
 Q
"RTN","PSOP2")
0^20^B32288266
"RTN","PSOP2",1,0)
PSOP2 ;BIR/SAB - medication profile long or short ;02/25/94
"RTN","PSOP2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,98,132**;DEC 1997
"RTN","PSOP2",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOP2",4,0)
 ;External reference to PSDRUG supported by DBIA 221
"RTN","PSOP2",5,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOP2",6,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOP2",7,0)
DATE I $G(DTS) D  Q:'$G(TRDT)
"RTN","PSOP2",8,0)
 .S:$P(^PSRX(J,0),"^",13)'<SDT&($P(^(0),"^",13)'>EDT) TRDT=1
"RTN","PSOP2",9,0)
 S X=$P(^PSRX(J,0),"^",13),X=999999999-X,^TMP($J,X,J)=^(0) K TRDT
"RTN","PSOP2",10,0)
 Q
"RTN","PSOP2",11,0)
DRUG Q:'$D(^PSDRUG(+$P(^PSRX(J,0),"^",6),0))  S DRG=$P(^(0),"^")
"RTN","PSOP2",12,0)
 I $G(DRS) D  Q:'$G(TRDR)
"RTN","PSOP2",13,0)
 .I DRG]PSFR,PSTO]DRG S TRDR=1
"RTN","PSOP2",14,0)
 I $P($G(^PSRX(J,3)),"^",5),$P($G(^PSRX(J,3)),"^",5)<PSODTCT,$P($G(^("STA")),"^")>11,$P($G(^("STA")),"^")'=16 K TRDR Q
"RTN","PSOP2",15,0)
 I $P($G(^PSRX(J,2)),"^",6)'<PSODTCT S ^TMP($J,$E(DRG,1,31),J)=^PSRX(J,0) K TRDR
"RTN","PSOP2",16,0)
 Q
"RTN","PSOP2",17,0)
CLSS Q:'$D(^PSDRUG(+$P(^PSRX(J,0),"^",6),0))  S DRG=$P(^(0),"^",2)
"RTN","PSOP2",18,0)
 I $G(CLS) D  Q:'$G(TRCL)
"RTN","PSOP2",19,0)
 .I DRG]PSFR,PSTO]DRG S TRCL=1
"RTN","PSOP2",20,0)
 I $P($G(^PSRX(J,3)),"^",5),$P($G(^PSRX(J,3)),"^",5)<PSODTCT,$P($G(^("STA")),"^")>11,$P($G(^("STA")),"^")'=16 K TRCL Q
"RTN","PSOP2",21,0)
 I $P($G(^PSRX(J,2)),"^",6)'<PSODTCT S ^TMP($J,$S(DRG]"":$E(DRG,1,31),1:"UNKNOWN"),J)=^PSRX(J,0) K TRCL
"RTN","PSOP2",22,0)
 Q
"RTN","PSOP2",23,0)
PEND ;list pending orders
"RTN","PSOP2",24,0)
 S PPPCNT=1 F PPP=0:0 S PPP=$O(^PS(52.41,"P",DFN,PPP)) Q:'PPP  S PPPSTAT=$P($G(^PS(52.41,PPP,0)),"^",3) I PPPSTAT="NW"!(PPPSTAT="HD")!(PPPSTAT="RNW") D
"RTN","PSOP2",25,0)
 .S PSOPEND(PPPCNT)=PPP_"^"_$S(+$P($G(^PS(52.41,PPP,0)),"^",9):"DD",1:"OI")_"^"_$P($G(^(0)),"^",5)_"^"_$P(^(0),"^",6)_"^"_$P(^(0),"^",10)_"^"_$P(^(0),"^",11) S PPPCNT=PPPCNT+1
"RTN","PSOP2",26,0)
 Q:PPPCNT=1  I $E(IOST)="C" D DIR^PSOP1 Q:$G(PQT)
"RTN","PSOP2",27,0)
 D HD1 S PPCOUNT=1 F EEEE=0:0 S EEEE=$O(PSOPEND(EEEE)) Q:'EEEE!($G(PQT))  D
"RTN","PSOP2",28,0)
 .S PENDREX=$P(PSOPEND(EEEE),"^"),PPDIS=$P($G(^PS(52.41,PENDREX,0)),"^",9),PPOI=$P($G(^(0)),"^",8)
"RTN","PSOP2",29,0)
 .W:PPCOUNT>1 ! W !,"Drug: ",$S($P(PSOPEND(EEEE),"^",2)="DD":$P($G(^PSDRUG(+PPDIS,0)),"^"),1:$P($G(^PS(50.7,+PPOI,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")),! S PPCOUNT=PPCOUNT+1
"RTN","PSOP2",30,0)
 .W ?1,"Eff. Date: ",$E($P(PSOPEND(EEEE),"^",4),4,5)_"-"_$E($P(PSOPEND(EEEE),"^",4),6,7)_"-"_$E($P(PSOPEND(EEEE),"^",4),2,3),?22,"Qty: ",$P(PSOPEND(EEEE),"^",5),?40,"Refills: ",$P(PSOPEND(EEEE),"^",6)
"RTN","PSOP2",31,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(PSOPEND(EEEE),"^",3) D ^DIC K DIC,X
"RTN","PSOP2",32,0)
 .W ?52,"Prov: "_$E($P(Y,"^",2),1,21)
"RTN","PSOP2",33,0)
 .D:($Y+5>IOSL)&($E(IOST)="C") DIR^PSOP1 Q:$G(PQT)  D:$Y+5>IOSL HD1
"RTN","PSOP2",34,0)
 .S PCOUNT=1 W !?1,"Sig: " F AAAA=0:0 S AAAA=$O(^PS(52.41,PENDREX,"SIG",AAAA)) Q:'AAAA!($G(PQT))  W:PCOUNT>1 ! W ?6,$G(^PS(52.41,PENDREX,"SIG",AAAA,0)) S PCOUNT=PCOUNT+1 D:($Y+5>IOSL)&($E(IOST)="C") DIR^PSOP1 Q:$G(PQT)  D:$Y+5>IOSL
"RTN","PSOP2",35,0)
 ..D HD1 S PPCOUNT=$S('$O(^PS(52.41,PENDREX,"SIG",AAAA)):1,1:PPCOUNT)
"RTN","PSOP2",36,0)
 I '$G(PQT),$E(IOST)="C" D DIR^PSOP1
"RTN","PSOP2",37,0)
 Q
"RTN","PSOP2",38,0)
HD1 ;W @IOF W !,?29,"PENDING ORDERS",!,PSOPLINE
"RTN","PSOP2",39,0)
 I $G(PLS)="L" S PAGE=PAGE+1
"RTN","PSOP2",40,0)
 W @IOF W !,"Patient: "_$P($G(^DPT(DFN,0)),"^")_" ("_$E($P($G(^DPT(DFN,0)),"^",9),6,9)_")",?70,"Page: "_PAGE,!?21,$S($G(NVA):"Non-VA MEDS (Not Dispensed by VA)",1:"Pending Outpatient Orders"),!,PSOPLINE
"RTN","PSOP2",41,0)
 I $G(PLS)="S" S PAGE=PAGE+1
"RTN","PSOP2",42,0)
 Q
"RTN","PSOP2",43,0)
NVA ;non-va meds
"RTN","PSOP2",44,0)
 Q:'$O(^PS(55,DFN,"NVA",0))
"RTN","PSOP2",45,0)
 W !!,PSOPLINE,!?(80-$L("Non-VA MEDS (Not Dispensed by VA)"))/2,"Non-VA MEDS (Not Dispensed by VA)",!
"RTN","PSOP2",46,0)
 K PQT S PCNT=1 F PPP=0:0 S PPP=$O(^PS(55,DFN,"NVA",PPP)) Q:'PPP!($G(PQT))  S NVAOR=^PS(55,DFN,"NVA",PPP,0),NVA=1 D
"RTN","PSOP2",47,0)
 .;I PCNT D HD1 S PCNT=0
"RTN","PSOP2",48,0)
 .Q:'$P(NVAOR,"^")
"RTN","PSOP2",49,0)
 .I $Y+10>IOSL,$E(IOST)="C" D DIR^PSOP1 Q:$D(PQT)  W @IOF
"RTN","PSOP2",50,0)
 .I $Y+11>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",51,0)
 .W !!,$S($P(NVAOR,"^",2):$P($G(^PSDRUG(+$P(NVAOR,"^",2),0)),"^"),1:$P($G(^PS(50.7,$P(NVAOR,"^"),0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^"))
"RTN","PSOP2",52,0)
 .I PLS="S" D  Q
"RTN","PSOP2",53,0)
 ..W !?2,"Dosage: "_$P(NVAOR,"^",3)
"RTN","PSOP2",54,0)
 ..W !?2,"Schedule: "_$P(NVAOR,"^",5)
"RTN","PSOP2",55,0)
 ..W !?2,"Date Documented: "
"RTN","PSOP2",56,0)
 ..W $E($P(NVAOR,"^",10),4,5)_"/"_$E($P(NVAOR,"^",10),6,7)_"/"_$E($P(NVAOR,"^",10),2,3)
"RTN","PSOP2",57,0)
 ..W !?2,"Status: "_$S($P(NVAOR,"^",7):"Discontinued ("_$E($P(NVAOR,"^",7),4,5)_"/"_$E($P(NVAOR,"^",7),6,7)_"/"_$E($P(NVAOR,"^",7),2,3)_")",1:"Active")
"RTN","PSOP2",58,0)
 .I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",59,0)
 .W !?2,"Dosage: "_$P(NVAOR,"^",3)
"RTN","PSOP2",60,0)
 .W !?2,"Schedule: "_$P(NVAOR,"^",5)
"RTN","PSOP2",61,0)
 .W !?2,"Route: "_$P(NVAOR,"^",4)
"RTN","PSOP2",62,0)
 .W !?2,"Status: "_$S($P(NVAOR,"^",7):"Discontinued ("_$E($P(NVAOR,"^",7),4,5)_"/"_$E($P(NVAOR,"^",7),6,7)_"/"_$E($P(NVAOR,"^",7),2,3)_")",1:"Active")
"RTN","PSOP2",63,0)
 .W !?2,"Start Date: "_$E($P(NVAOR,"^",9),4,5)_"/"_$E($P(NVAOR,"^",9),6,7)_"/"_$E($P(NVAOR,"^",9),2,3),?$X+5,"CPRS Order #: "_$P(NVAOR,"^",8)
"RTN","PSOP2",64,0)
 .W !?2,"Documented By: "_$S($G(^VA(200,$P(NVAOR,"^",11),0))]"":$P(^VA(200,$P(NVAOR,"^",11),0),"^"),1:"Unknown")_" on "_$E($P(NVAOR,"^",10),4,5)_"/"_$E($P(NVAOR,"^",10),6,7)_"/"_$E($P(NVAOR,"^",10),2,3)
"RTN","PSOP2",65,0)
 .I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",66,0)
 .I $O(^PS(55,DFN,"NVA",PPP,"OCK",0)) W !?2,"Order Check(s):" D
"RTN","PSOP2",67,0)
 ..I ($Y+5)>IOSL,$E(IOST)'="C" D HD1 W !?2,"Order Check(s):"
"RTN","PSOP2",68,0)
 ..F NVAP=0:0 S NVAP=$O(^PS(55,DFN,"NVA",PPP,"OCK",NVAP)) Q:'NVAP  W !?3,"#"_NVAP_". "_$P(^PS(55,DFN,"NVA",PPP,"OCK",NVAP,0),"^") S PRV=$P(^(0),"^",2) D  I ($Y+5)>IOSL,$E(IOST)'="C" D HD1 W !?2,"Order Check(s):"
"RTN","PSOP2",69,0)
 ...I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",70,0)
 ...I $O(^PS(55,DFN,"NVA",PPP,"OCK",NVAP,"OVR",0)) W !?5,"Override Reason: " D
"RTN","PSOP2",71,0)
 ....I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",72,0)
 ....F NVAPR=0:0 S NVAPR=$O(^PS(55,DFN,"NVA",PPP,"OCK",NVAP,"OVR",NVAPR)) Q:'NVAPR  W ?22,^PS(55,DFN,"NVA",PPP,"OCK",NVAP,"OVR",NVAPR,0),!
"RTN","PSOP2",73,0)
 ..W ?2,"Override Provider: "_$P(^VA(200,PRV,0),"^"),!
"RTN","PSOP2",74,0)
 .I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",75,0)
 .I $O(^PS(55,DFN,"NVA",PPP,"DSC",0)) W !?2,"Statement/Explanation/Comments: " D
"RTN","PSOP2",76,0)
 ..I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",77,0)
 ..F NVAP=0:0 S NVAP=$O(^PS(55,DFN,"NVA",PPP,"DSC",NVAP)) Q:'NVAP  W $P(^PS(55,DFN,"NVA",PPP,"DSC",NVAP,0),"^"),!?34
"RTN","PSOP2",78,0)
 W ! K NVA,NVAP,NVAPR,NVAOR
"RTN","PSOP2",79,0)
 Q
"RTN","PSOPOLY")
0^3^B40602112
"RTN","PSOPOLY",1,0)
PSOPOLY ;BHAM ISC/SAB - patients with a minimum amount of rx's within a # of days ;10/06/93
"RTN","PSOPOLY",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**19,28,132**;DEC 1997
"RTN","PSOPOLY",3,0)
 ;External reference ^PS(55 supported by DBIA# 2228
"RTN","PSOPOLY",4,0)
 ;External reference ^PSDRUG( supported by DBIA# 221
"RTN","PSOPOLY",5,0)
 ;External reference ^DPT( supported by DBIA# 10035
"RTN","PSOPOLY",6,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOPOLY",7,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOPOLY",8,0)
 K ^TMP($J),DIR S PG=0
"RTN","PSOPOLY",9,0)
 S DIR("A")="Number Of Days To Begin Search",DIR("?")="^D HLP^PSOPOLY",DIR(0)="N^1:730:0",DIR("B")=180 D ^DIR G:$D(DIRUT) END S DAYS=Y K DIR
"RTN","PSOPOLY",10,0)
 S DIR("A")="Minimum Number Of Rxs and Active Non-VA Meds",DIR("B")=7,DIR("?")="^D HLP1^PSOPOLY",DIR(0)="N^1:100:0" D ^DIR G:$D(DIRUT) END S RX=Y K DIR
"RTN","PSOPOLY",11,0)
PAT R !!,"Enter Patient's Name or ^ALL for All Patients: ",X:DTIME G:'$T END G:$E(X,1,2)="^A"!($E(X,1,2)="^a") ALL
"RTN","PSOPOLY",12,0)
 S DIC(0)="QEM",DIC="^DPT(" D ^DIC G:"^"[$E(X) END G:Y<0 PAT S (PSODFN,DFN)=+Y
"RTN","PSOPOLY",13,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) S ALL=0 D DEV G:$G(QP)!($D(ZTSK)) END
"RTN","PSOPOLY",14,0)
ENQ D CON,PID^VADPT S DFN=PSODFN I '$O(^PS(55,DFN,"P","A",PSDATE)),'$O(^PS(55,DFN,"NVA",0)) G NRX
"RTN","PSOPOLY",15,0)
BEG S RXS=0 S:$G(PSDATEX) PSDATE=PSDATEX
"RTN","PSOPOLY",16,0)
 F  S PSDATE=$O(^PS(55,DFN,"P","A",PSDATE)) Q:'PSDATE  S (P,J)=0 F  S J=$O(^PS(55,DFN,"P","A",PSDATE,J)) Q:'J  D:$D(^PSRX(J,0))
"RTN","PSOPOLY",17,0)
 .I 134'[$E(+$P($G(^PSRX(J,"STA")),"^")),$P($G(^PSDRUG($P($G(^PSRX(J,0)),"^",6),0)),"^",3)'["S" S RXS=RXS+1,RX(DFN,J)=+$P($G(^PSRX(J,"STA")),"^")
"RTN","PSOPOLY",18,0)
 N NVA F NVA=0:0 S NVA=$O(^PS(55,DFN,"NVA",NVA)) Q:'NVA  I '$P(^PS(55,DFN,"NVA",NVA,0),"^",7) S RXS=RXS+1
"RTN","PSOPOLY",19,0)
 I RXS'<RX F  S P=$O(RX(DFN,P)) Q:'P  S RX0=$S($D(^PSRX(P,0)):^(0),1:""),RX2=$S($D(^(2)):^(2),1:""),RX3=$S($D(^(3)):^(3),1:"") D
"RTN","PSOPOLY",20,0)
 .S STA=RX(DFN,P),DRUG=$S($D(^PSDRUG($P(RX0,"^",6),0)):$P(^PSDRUG($P(RX0,"^",6),0),"^"),1:"UNKNOWN"),CLASS=$S($P($G(^PSDRUG($P(RX0,"^",6),0)),"^",2)]"":$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOPOLY",21,0)
A .S STAT="A^N^R^H^N^S^^^^^^E^DC^^DC^DE^H^P^",STATUS=$P(STAT,"^",STA+1)
"RTN","PSOPOLY",22,0)
 .S FILLDATE=9999999-$P(^PSRX(P,2),"^",2)
"RTN","PSOPOLY",23,0)
 .S ^TMP($J,$P(^DPT(DFN,0),"^"),CLASS,DRUG,FILLDATE,P)=$P(^PSRX(P,0),"^",2)_"^"_RXS_"^"_$P(RX3,"^")_"^"_$P(RX0,"^",4)_"^"_STATUS_"^"_VA("BID")_"^"_DFN
"RTN","PSOPOLY",24,0)
 I RXS'<RX,$O(^TMP($J,$P(^DPT(DFN,0),"^"),""))="" S CLASS="NVA",^TMP($J,$P(^DPT(DFN,0),"^"),CLASS)=DFN_"^"_RXS
"RTN","PSOPOLY",25,0)
 S RXS=0 K RX(DFN),CLASS
"RTN","PSOPOLY",26,0)
 I 'ALL,'$D(^TMP($J)) G NRX
"RTN","PSOPOLY",27,0)
 I 'ALL D PRI G:$G(PSOTRUE) END D NVA G END
"RTN","PSOPOLY",28,0)
 Q
"RTN","PSOPOLY",29,0)
 ;
"RTN","PSOPOLY",30,0)
PRI S PG=0 D HDR S (DFN,ZDFN)="" D
"RTN","PSOPOLY",31,0)
 .F  S DFN=$O(^TMP($J,DFN)) Q:DFN=""  S (ZCLASS,CLASS)="" D  I ALL,$G(CLASS)="" D:'$G(PSOTRUE) NVA K PSOTRUE W ! F I=1:1:132 W "-"
"RTN","PSOPOLY",32,0)
 ..F  S CLASS=$O(^TMP($J,DFN,CLASS)) Q:CLASS=""  D
"RTN","PSOPOLY",33,0)
 ...I CLASS="NVA" S PSODFN=$P(^TMP($J,DFN,"NVA"),"^"),PSOTRUE=1 D NVA Q
"RTN","PSOPOLY",34,0)
 ...S DRUG="" F  S DRUG=$O(^TMP($J,DFN,CLASS,DRUG)) Q:DRUG=""  S FILLDATE="" F  S FILLDATE=$O(^TMP($J,DFN,CLASS,DRUG,FILLDATE)) Q:'FILLDATE  D
"RTN","PSOPOLY",35,0)
 ....F RNX=0:0 S RNX=$O(^TMP($J,DFN,CLASS,DRUG,FILLDATE,RNX)) Q:'RNX  S POLY=^(RNX),PSODFN=$P(POLY,"^",7) D
"RTN","PSOPOLY",36,0)
 .....I ($Y+5)>IOSL D HDR
"RTN","PSOPOLY",37,0)
 .....W ! W:ZDFN'=DFN !,DFN_" ("_$P(POLY,"^",6)_")" W:ZDFN'=DFN ?65,$J($P(POLY,"^",2),3),! W:ZCLASS'=CLASS ?2,$E(CLASS,1,16)
"RTN","PSOPOLY",38,0)
 .....W ?22,DRUG,?65,$P(POLY,"^",5) S Y=$P(POLY,"^",3) W ?77 D DT^DIQ S PROV=$P($G(^VA(200,$P(POLY,"^",4),0)),"^") W ?92,$E(PROV,1,25),?121,$P(^PSRX(RNX,0),"^") S ZCLASS=CLASS,ZDFN=DFN
"RTN","PSOPOLY",39,0)
 .....S TOTRX=$G(TOTRX)+1 S:'$D(^TMP($J,"PAT",DFN)) TOTP=$G(TOTP)+1,^TMP($J,"PAT",DFN)=""
"RTN","PSOPOLY",40,0)
 I ALL U IO W !!,"Total Number of Patients: "_TOTP,?40,"Total Number of Rxs: "_TOTRX,?80,"Average Rxs per Patient: "_(TOTRX\TOTP)
"RTN","PSOPOLY",41,0)
 Q
"RTN","PSOPOLY",42,0)
END W ! D ^%ZISC K QP,^TMP($J),DIR,DTOUT,DUOUT,DIRUT,DIROUT,%DT,ALL,CLASS,DAYS,DFN,DIC,DRUG,EDT,FILLDATE,PSDATEX,G,I,J,P,PSDATE,RX,RXS,RX0,RX2,RX3,SDT,X,Y,POLY,PROV,POP,RNX,Z0,Z1,Z2,ZCLASS,PG,ZDFN,ZTSK,STA,STAT,STATUS D KVA^VADPT
"RTN","PSOPOLY",43,0)
 K PSODFN,PAT,TOTRX,TOTP S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOPOLY",44,0)
 Q
"RTN","PSOPOLY",45,0)
ALL ;print all patients
"RTN","PSOPOLY",46,0)
 W ! S ALL=1,(TOTRX,TOTP)=0 D DEV G:$G(QP)!($D(ZTSK)) END
"RTN","PSOPOLY",47,0)
ALLP D CON
"RTN","PSOPOLY",48,0)
 F DFN=0:0 S DFN=$O(^PS(55,DFN)) Q:'DFN  S ALL=1 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) D PID^VADPT,BEG
"RTN","PSOPOLY",49,0)
 I '$D(^TMP($J)) G NRX
"RTN","PSOPOLY",50,0)
 D PRI,END
"RTN","PSOPOLY",51,0)
 Q
"RTN","PSOPOLY",52,0)
CON ;convert data to date
"RTN","PSOPOLY",53,0)
 S %DT="",X="T-"_DAYS D ^%DT S SDT=Y,(PSDATE,PSDATEX)=SDT-1,X="T" D ^%DT S EDT=Y,RXS=0
"RTN","PSOPOLY",54,0)
 Q
"RTN","PSOPOLY",55,0)
NRX ;prints no rx message
"RTN","PSOPOLY",56,0)
 D HDR U IO W:'ALL !,$P(^DPT(DFN,0),"^")_" ("_VA("BID")_")" W !?20,">>>> No Active Prescriptions and/or Non-VA Meds found within the Range <<<<" W @IOF G END
"RTN","PSOPOLY",57,0)
 Q
"RTN","PSOPOLY",58,0)
HLP ;help module
"RTN","PSOPOLY",59,0)
 W !!,$C(7),"Enter numeric value greater than zero.",!,"The value must a whole number, no decimals or fractions.",!!
"RTN","PSOPOLY",60,0)
 Q
"RTN","PSOPOLY",61,0)
HLP1 W !!,$C(7),"Enter a numeric value greater than zero.",!,"The number seven (7) is the default, no decimals or fractions.",!,"The count will include both Active Prescriptions and Non-VA Medications.",!!
"RTN","PSOPOLY",62,0)
 Q
"RTN","PSOPOLY",63,0)
DEV K %ZIS,IOP,ZTSK S %ZIS("B")="",PSOION=ION,%ZIS="QM" D ^%ZIS K %ZIS I POP S QP=1,IOP=PSOION D ^%ZIS K IOP,PSOION Q
"RTN","PSOPOLY",64,0)
 I $G(IOM)<132 W $C(7),!!,"Printout Must be 132 Columns.",!! G DEV
"RTN","PSOPOLY",65,0)
 K PSOION I $D(IO("Q")) D  K IO("Q") D ^%ZTLOAD W:$D(ZTSK) !,"Report is queued to print !",!
"RTN","PSOPOLY",66,0)
 .S ZTDESC="Poly Pharmacy Report",ZTRTN=$S('ALL:"ENQ^PSOPOLY",1:"ALLP^PSOPOLY") F G="ALL","RX","DAYS","DFN","PG","PSODFN" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOPOLY",67,0)
 Q
"RTN","PSOPOLY",68,0)
HDR ;report header
"RTN","PSOPOLY",69,0)
 S PG=PG+1 U IO W @IOF,?55,"Poly Pharmacy Report",!?50,$E(SDT,4,5)_"-"_$E(SDT,6,7)_"-"_($E(SDT,1,3)+1700)_"    to    "_$E(EDT,4,5)_"-"_$E(EDT,6,7)_"-"_($E(EDT,1,3)+1700)
"RTN","PSOPOLY",70,0)
 W !?37," for "_DAYS_" Days for "_RX_" or More Active Prescriptions and/or Non-VA Meds"
"RTN","PSOPOLY",71,0)
 W ?122,"Page "_PG,!,"Patient",?40,"ID#",?62,"Active Rx's",!,?2,"Class",?22,"Drug",?65,"Status",?77,"Last Filled",?92,"Provider",?121,"Rx Number"
"RTN","PSOPOLY",72,0)
 W ! F I=1:1:132 W "-"
"RTN","PSOPOLY",73,0)
 Q
"RTN","PSOPOLY",74,0)
NVA ;displays non-va meds
"RTN","PSOPOLY",75,0)
 Q:'$O(^PS(55,PSODFN,"NVA",0))  N TITLE
"RTN","PSOPOLY",76,0)
 S PSOSTA=">>>Non-VA MEDS (Not dispensed by VA)<<<"
"RTN","PSOPOLY",77,0)
 S STR=($L(PSOSTA)+IOM/2)-$L(PSOSTA),STP=IOM-(STR+$L(PSOSTA)) F I=1:1:STR S TITLE=$G(TITLE)_" "
"RTN","PSOPOLY",78,0)
 S TITLE=TITLE_PSOSTA F I=1:1:STP S TITLE=TITLE_" "
"RTN","PSOPOLY",79,0)
 ;S TITLE=TITLE_"*"
"RTN","PSOPOLY",80,0)
 D:($Y+7)>IOSL HDR W !!,TITLE
"RTN","PSOPOLY",81,0)
 I $G(CLASS)="NVA" W !,DFN_" ("_VA("BID")_")",?40,"Total Non-VA Meds: "_$P(^TMP($J,DFN,CLASS),"^",2)
"RTN","PSOPOLY",82,0)
 F NVAO=0:0 S NVAO=$O(^PS(55,PSODFN,"NVA",NVAO)) Q:'NVAO  D
"RTN","PSOPOLY",83,0)
 .Q:$P(^PS(55,PSODFN,"NVA",NVAO,0),"^",7)  Q:'$P(^PS(55,PSODFN,"NVA",NVAO,0),"^")
"RTN","PSOPOLY",84,0)
 .S DUPRX0=^PS(55,PSODFN,"NVA",NVAO,0)
"RTN","PSOPOLY",85,0)
 .I ($Y+7)>IOSL D HDR W !!,TITLE,!,$P(^DPT(PSODFN,0),"^")_" ("_VA("BID")_")"
"RTN","PSOPOLY",86,0)
 .S DOI=$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"))
"RTN","PSOPOLY",87,0)
 .W !?2,DOI_" "_$P(DUPRX0,"^",3)
"RTN","PSOPOLY",88,0)
 .W !?5,"Schedule: "_$P(DUPRX0,"^",5)
"RTN","PSOPOLY",89,0)
 .W !?5,"Start Date: "_$$FMTE^XLFDT($P(DUPRX0,"^",9)),?45," Documented: "_$$FMTE^XLFDT($P(DUPRX0,"^",10)) ;_"  Status: Active"
"RTN","PSOPOLY",90,0)
 K DUPRX0,NVA,STP,STR,PSOSTA,TITLE,DOI
"RTN","PSOPOLY",91,0)
 Q
"RTN","PSOPRF")
0^2^B36401491
"RTN","PSOPRF",1,0)
PSOPRF ;BHAM ISC/SAB - PRINTS A PROFILE ;11/18/92
"RTN","PSOPRF",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**19,132**;DEC 1997
"RTN","PSOPRF",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOPRF",4,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOPRF",5,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOPRF",6,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOPRF",7,0)
 ;PHARMACIST IN REVEIWING RX'S WHEN ADDING A 'NEW' RX
"RTN","PSOPRF",8,0)
Q D CUTDATE^PSOFUNC
"RTN","PSOPRF",9,0)
QOLD D PLBL^PSORXL
"RTN","PSOPRF",10,0)
 Q
"RTN","PSOPRF",11,0)
 ;
"RTN","PSOPRF",12,0)
DQ S:'$D(PFIO) PFIO=IO D START D KILL^%ZTLOAD Q
"RTN","PSOPRF",13,0)
 ;
"RTN","PSOPRF",14,0)
START D:('$D(PSOBMST)) EN1P^PSOBSET K Z S IOP=PFIO D ^%ZIS U IO I '$D(PSODTCUT) D CUTDATE^PSOFUNC
"RTN","PSOPRF",15,0)
 S:'$D(Z) Z=1 S:'$D(NEW1) (NEW1,NEW11)="^" S %DT="",X="T" D ^%DT S DT=Y S X1=DT,X2=-365 D C^%DTC S EXPS=X S X1=DT,X2=-182 D C^%DTC S EXP=X
"RTN","PSOPRF",16,0)
 K ^TMP($J,"PRF") S LINE="" F I=1:1:110 S LINE=LINE_"-"
"RTN","PSOPRF",17,0)
 F RXX=0:0 S RXX=$O(^PS(55,DFN,"P",RXX)) Q:'RXX  S RXNN=+^(RXX,0) I $D(^PSRX(RXNN,0)),$P($G(^("STA")),"^")'=13 S RXPX=^PSRX(RXNN,0),$P(RXPX,"^",15)=$P($G(^("STA")),"^"),RXPX2=^(2) D CHK
"RTN","PSOPRF",18,0)
 D HD I '$D(^TMP($J,"PRF")) W !!?Z+15,"****** NO RX DATA ******",! G PPP
"RTN","PSOPRF",19,0)
 ;
"RTN","PSOPRF",20,0)
SD F SD="A","C","S" W:SD="S" !,?Z+1,"SUPPLIES",$E(LINE,1,89) I $D(^TMP($J,"PRF",SD)) S DRNME="" D DRNME
"RTN","PSOPRF",21,0)
PPP D PEND,NVA
"RTN","PSOPRF",22,0)
 W !!,"NAME: "_$P(^DPT(DFN,0),"^"),!,"ID#: "_VA("PID"),!
"RTN","PSOPRF",23,0)
 W:IOF]"" @IOF K ^TMP($J,"PRF"),A,B,DRNME,DRP,EXP,EXPS,I,II,ISSD,J,LINE,LN,MESS,MJK,NEW1,NEW11,PHYS,POP,QTY,TTTT,RFL,RFS,RXF,RXNN,RXPX,RXPX2,RXPNO,RXX,SD,SIG,STA,X,X1,X2,Y,Z
"RTN","PSOPRF",24,0)
 Q
"RTN","PSOPRF",25,0)
 ;
"RTN","PSOPRF",26,0)
DRNME S DRNME=$O(^TMP($J,"PRF",SD,DRNME)) Q:DRNME=""  D ISSD G DRNME
"RTN","PSOPRF",27,0)
 ;
"RTN","PSOPRF",28,0)
ISSD F ISSD=0:0 S ISSD=$O(^TMP($J,"PRF",SD,DRNME,ISSD)) Q:'ISSD  S RXPNO="" D RXPNO
"RTN","PSOPRF",29,0)
 Q
"RTN","PSOPRF",30,0)
 ;
"RTN","PSOPRF",31,0)
RXPNO S RXPNO=$O(^TMP($J,"PRF",SD,DRNME,ISSD,RXPNO)) Q:RXPNO=""  S RXNN=^(RXPNO) I $D(^PSRX(RXNN,0)) S RXPX=^(0),RXPX2=^(2) D PRT G RXPNO
"RTN","PSOPRF",32,0)
 W "END***************"
"RTN","PSOPRF",33,0)
 ;
"RTN","PSOPRF",34,0)
CHK Q:PSODTCUT>$P(RXPX2,"^",6)
"RTN","PSOPRF",35,0)
 I $P(^PSRX(RXNN,"STA"),"^")=12 S II=RXNN D LAST^PSORFL Q:PSODTCUT>RFDATE
"RTN","PSOPRF",36,0)
 I $P(RXPX,"^",3)=7!($P(RXPX,"^",3)=8)&('PSOPRPAS) Q
"RTN","PSOPRF",37,0)
 S J="^"_RXNN_"^" Q:(NEW1[J)!(NEW11[J)  Q:$P(RXPX,"^",13)<EXPS  S RXPNO=$P(RXPX,"^"),ISSD=$P(RXPX,"^",13)
"RTN","PSOPRF",38,0)
 Q:'$D(^PSDRUG($P(RXPX,"^",6),0))  S DRP=^(0),SD=$S($P(DRP,"^",3)["S":"S",$P(RXPX,"^",15)=12:"C",1:"A"),DRNME=$P(DRP,"^"),^TMP($J,"PRF",SD,DRNME,ISSD,RXPNO)=RXNN
"RTN","PSOPRF",39,0)
 Q
"RTN","PSOPRF",40,0)
 ;
"RTN","PSOPRF",41,0)
PRT S RFS=$P(RXPX,"^",9),QTY=$P(RXPX,"^",7)
"RTN","PSOPRF",42,0)
 S PHYS=$S($D(^VA(200,$P(RXPX,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN"),II=RXNN D LAST^PSORFL S RXF=0 F MJK=0:0 S MJK=$O(^PSRX(RXNN,1,MJK)) Q:'MJK  S RXF=RXF+1
"RTN","PSOPRF",43,0)
 S STA=$S($P(^PSRX(RXNN,"STA"),"^")=14:"DC",$P(^PSRX(RXNN,"STA"),"^")=15:"DE",$P(^PSRX(RXNN,"STA"),"^")=16:"PH",1:$E("ANRHPS     ECD",(1+$P(^PSRX(RXNN,"STA"),"^")))),STA=$S(DT>$P(RXPX2,"^",6):"E",1:STA)
"RTN","PSOPRF",44,0)
 W !,?Z+1,RXPNO,?Z+15,DRNME,?Z+55,$E(ISSD,4,5),"/",$E(ISSD,6,7)," ",$E(RFL,1,5)," ",?Z+67,$J(RFS,2)," ",$J(RXF,2)," ",?Z+73,$J(QTY,12)," ",?Z+86,STA," ",?Z+88,$E(PHYS,1,20)
"RTN","PSOPRF",45,0)
 D SIG F TTTT=0:0 S TTTT=$O(FSIG(TTTT)) Q:'TTTT  W !,?Z+19,FSIG(TTTT)
"RTN","PSOPRF",46,0)
 Q
"RTN","PSOPRF",47,0)
 ;
"RTN","PSOPRF",48,0)
HD D PID^VADPT
"RTN","PSOPRF",49,0)
 W !,?Z+17,"PRESCRIPTION PROFILE AS OF ",$E(DT,4,5),"/",$E(DT,6,7),"/",($E(DT,1,3)+1700),!!,?Z+20,"NAME: "_$P(^DPT(DFN,0),"^"),!,?Z+20,"ID# : "_VA("PID")
"RTN","PSOPRF",50,0)
 I $D(^PS(55,DFN,1)) S MESS=^(1),LN=$L(MESS),A=0 W ! F B=1:1 Q:$P(MESS," ",B,99)=""  W:$X>(Z+63) ! W ?Z+31,$P(MESS," ",B)," "
"RTN","PSOPRF",51,0)
 S X="PPPGET7" X ^%ZOSF("TEST") I  I $$GETVIS^PPPGET7(DFN,"ZZ") K ZZ W !!,"THIS PATIENT HAS PRESCRIPTIONS AT OTHER FACILITIES" K ZZ
"RTN","PSOPRF",52,0)
 W !!?Z+20,"PHARMACIST: ___________________________  DATE: ____________"
"RTN","PSOPRF",53,0)
 W !!?Z+52,"   DATES   ",?Z+67,"REFS ",?Z+86,"S"
"RTN","PSOPRF",54,0)
 W !?Z+1,"RX #     ",?Z+15,"DRUG/STRENGTH/SIG",?Z+55,"ISSD  LAST ",?Z+67,"AL AC",?Z+77,"QTY",?Z+86,"T",?Z+93,"PROVIDER"
"RTN","PSOPRF",55,0)
 W !?Z+1,$E(LINE,1,12),?Z+15,$E(LINE,1,35),?Z+55,"----- -----",?Z+67,"-- --",?Z+73,"------------",?Z+86,"-",?Z+88,$E(LINE,1,20)
"RTN","PSOPRF",56,0)
 Q
"RTN","PSOPRF",57,0)
SIG ;Format Sig
"RTN","PSOPRF",58,0)
 S PSPROSIG=$P($G(^PSRX(RXNN,"SIG")),"^",2) K FSIG,BSIG D
"RTN","PSOPRF",59,0)
 .I PSPROSIG D FSIG^PSOUTLA("R",RXNN,80) Q
"RTN","PSOPRF",60,0)
 .D EN2^PSOUTLA1(RXNN,80) F GGGGG=0:0 S GGGGG=$O(BSIG(GGGGG)) Q:'GGGGG  S FSIG(GGGGG)=BSIG(GGGGG)
"RTN","PSOPRF",61,0)
 K PSPROSIG,GGGGG,BSIG Q
"RTN","PSOPRF",62,0)
PEND ;Print Pending Orders
"RTN","PSOPRF",63,0)
 N PSPCOUNT,PSPPEND,ZXXX,PSPSTAT,FSIGZZ,PZZDRUG,PSSODRUG,PZXZERO,PPPPP,GGGGG
"RTN","PSOPRF",64,0)
 S PSPCOUNT=1,PSPPEND="" F PPPPP=0:0 S PPPPP=$O(^PS(52.41,"P",DFN,PPPPP)) Q:'PPPPP  S PSPSTAT=$P($G(^PS(52.41,PPPPP,0)),"^",3) I PSPSTAT="NW"!(PSPSTAT="HD")!(PSPSTAT="RNW") S PSPPEND(PSPCOUNT)=PPPPP,PSPCOUNT=PSPCOUNT+1
"RTN","PSOPRF",65,0)
 Q:'$O(PSPPEND(0))
"RTN","PSOPRF",66,0)
 W !!,?48,"PENDING ORDERS",!,LINE,!
"RTN","PSOPRF",67,0)
 F ZXXX=0:0 S ZXXX=$O(PSPPEND(ZXXX)) Q:'ZXXX  S PZXZERO=$G(^PS(52.41,PSPPEND(ZXXX),0)) D:$P(PZXZERO,"^")
"RTN","PSOPRF",68,0)
 .S PZZDRUG=$P(PZXZERO,"^",9),PZZODRUG=$P(PZXZERO,"^",8)
"RTN","PSOPRF",69,0)
 .W !,"Drug: ",$S(PZZDRUG:$P($G(^PSDRUG(+PZZDRUG,0)),"^"),1:$P($G(^PS(50.7,+PZZODRUG,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^"))
"RTN","PSOPRF",70,0)
 .W !?3,"Eff. Date: ",$E($P(PZXZERO,"^",6),4,5)_"/"_$E($P(PZXZERO,"^",6),6,7)_"/"_($E($P(PZXZERO,"^",6),1,3)+1700)
"RTN","PSOPRF",71,0)
 .W ?25,"Qty: ",$P(PZXZERO,"^",10),?50,"Refills: ",$P(PZXZERO,"^",11),?65,"Provider: ",$P($G(^VA(200,+$P(PZXZERO,"^",5),0)),"^")
"RTN","PSOPRF",72,0)
 .D FSIG^PSOUTLA("P",PSPPEND(ZXXX),100) W !?3,"Sig: ",$G(FSIG(1)) F FSIGZZ=1:0 S FSIGZZ=$O(FSIG(FSIGZZ)) Q:'FSIGZZ  W !?8,$G(FSIG(FSIGZZ))
"RTN","PSOPRF",73,0)
 Q
"RTN","PSOPRF",74,0)
NVA ;displays non-va meds
"RTN","PSOPRF",75,0)
 Q:'$G(DFN)!('$O(^PS(55,DFN,"NVA",0)))
"RTN","PSOPRF",76,0)
 W !!?48,"Non-VA MEDS (Not dispensed by VA)",!,LINE
"RTN","PSOPRF",77,0)
 F NVA=0:0 S NVA=$O(^PS(55,DFN,"NVA",NVA)) Q:'NVA  D
"RTN","PSOPRF",78,0)
 .S DUPRX0=^PS(55,DFN,"NVA",NVA,0) Q:'$P(DUPRX0,"^")
"RTN","PSOPRF",79,0)
 .W !!,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_"   Drug: "_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSOPRF",80,0)
 .W !,"Status: "_$S($P(DUPRX0,"^",7):"Discontinued ("_$$FMTE^XLFDT($P($P(DUPRX0,"^",7),"."))_")",1:"Active")
"RTN","PSOPRF",81,0)
 .W !,"Drug Class: "_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^",2),1:"")
"RTN","PSOPRF",82,0)
 .W !,"Dosage: "_$P(DUPRX0,"^",3),!,"Schedule: "_$P(DUPRX0,"^",5),!,"Medication Route: "_$P(DUPRX0,"^",4)
"RTN","PSOPRF",83,0)
 .W !,"Start Date: "_$$FMTE^XLFDT($P(DUPRX0,"^",9)),?40,"CPRS Oder #: "_$P(DUPRX0,"^",8)
"RTN","PSOPRF",84,0)
 .W !,"Documented By: "_$P(^VA(200,$P(DUPRX0,"^",11),0),"^")_" on "_$$FMTE^XLFDT($P(DUPRX0,"^",10))
"RTN","PSOPRF",85,0)
 W ! K NVA,DUPRXO
"RTN","PSOPRF",86,0)
 Q
"RTN","PSOSD1")
0^21^B47474708
"RTN","PSOSD1",1,0)
PSOSD1 ;BHAM ISC/SAB/JMB - action or informational profile cont. ;11/18/92
"RTN","PSOSD1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,17,19,22,40,49,66,107,110,132**;DEC 1997
"RTN","PSOSD1",3,0)
 ;External reference to ^PS(59.7 is supported by DBIA 694
"RTN","PSOSD1",4,0)
 ;
"RTN","PSOSD1",5,0)
INIT S PRF="" F PSOI=0:0 S DIC="^DPT(",DIC(0)="QEAM" D ^DIC Q:Y<0  D
"RTN","PSOSD1",6,0)
 .S PRF=PRF_+Y_",",DFN=+Y D DEM^VADPT I +VADM(6) W !,"Patient Expired on "_$P(VADM(6),"^",2),! S DOD(DFN)=$P(VADM(6),"^",2) K DFN
"RTN","PSOSD1",7,0)
 .I $L(PRF)>240 W !,$C(7),"MAX NUMBER OF PATIENTS HAS BEEN REACHED" Q
"RTN","PSOSD1",8,0)
 Q:'$L(PRF)  D DAYS G:$D(DUOUT)!($D(DTOUT)) EXIT^PSOSD
"RTN","PSOSD1",9,0)
DEV N PSOBARS,PSOBAR0,PSOBAR1 K %ZIS,IOP,ZTSK,ZTQUEUED S PSOION=ION,%ZIS="QM",%ZIS("B")="",%ZIS("A")=$S(PSTYPE:"Select a Printer: ",1:"DEVICE: ") D ^%ZIS K %ZIS I POP S IOP=PSOION D ^%ZIS K IOP,PSOION G EXIT
"RTN","PSOSD1",10,0)
 I $E(IOST)["C",PSTYPE D ^%ZISC W $C(7),!!,"Action Profiles MUST BE SENT TO A PRINTER !!",!,"ONLY INFORMATIONAL PROFILES ARE ALLOWED TO PRINT TO SCREEN !!",! G DEV
"RTN","PSOSD1",11,0)
 S PSOIOS=IOS D DEVBAR^PSOBMST S PSOBAR2=PSOBAR0,PSOBAR3=PSOBAR1
"RTN","PSOSD1",12,0)
 S PSOBAR4=$G(PSOBAR3)]""&($G(PSOBAR2)]"")&(+$P($G(PSOPAR),"^"))
"RTN","PSOSD1",13,0)
 K PSOION I $D(IO("Q")) S ZTDESC="Outpatient Pharmacy Action Profile",ZTRTN="START^PSOSD1",ZTSAVE("ZTREQ")="@" D  D EXIT Q:$G(LM)  G ^PSOSD
"RTN","PSOSD1",14,0)
 .F G="PSORM","PSOPOL","PSONUM","PSOSYS","PSOINST","PSOBAR3","PSOBAR4","PSOBAR2","PSOPAR","PSOPAR7","PRF","PSDAYS","PSDATE","PSTYPE","PSOSITE","PSDATE","PSDAY" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOSD1",15,0)
 .S ZTSAVE("DOD*")="",ZTSAVE("PSOBAR*")="" D ^%ZTLOAD W:$D(ZTSK) !,"Report Queued to Print !!",! K:'$G(LM) ZTSK,IO("Q")
"RTN","PSOSD1",16,0)
 D START G:'$G(LM) ^PSOSD
"RTN","PSOSD1",17,0)
 Q
"RTN","PSOSD1",18,0)
START U IO S PSTYPE=$S($D(PSTYPE):PSTYPE,1:0),$P(LINE,"-",132)="-"
"RTN","PSOSD1",19,0)
 F PSIX=1:1 S DFN=$P(PRF,",",PSIX) G:DFN']"" EXIT D ELIG S PAGE=1 D  G:$G(PSQFLG)!($D(DTOUT))!($D(DUOUT)) EXIT
"RTN","PSOSD1",20,0)
 .D PAT^PSOSD Q:$D(DTOUT)!($D(DUOUT))  D  Q:PSQFLG  D RXPAD:PSTYPE W:'$G(PSTYPE)&('$D(^TMP("PSOD",$J))) @IOF D ENSTUFF^PSODACT
"RTN","PSOSD1",21,0)
 ..Q:$D(DUOUT)!($D(DTOUT))  S PSQFLG=0 D ^PSOSD3,NVA^PSOSD3
"RTN","PSOSD1",22,0)
EXIT I '$D(PSONOPG) W ! D ^%ZISC K DFN
"RTN","PSOSD1",23,0)
 W:$D(PSONOPG)&('$D(ORVP)) @IOF
"RTN","PSOSD1",24,0)
 K ^TMP($J,"PRF"),^("ACT"),ADDR,ADDRFL,CLASS,CNDT,CNT,DRUG,CLAPP,HDFL,I,II,J,L,LINE,P,PAGE,PSDOB,PSIIX,PSNAME,PSOI,PSQFLG,PSSN,DFN,PSIX,PAGE,PGM,LINE,PRF,PSTYPE,PSDATE,PSDAYS,VAL,VAR,RX,RX0,RX3,RX2,ST,ST0,PSDAY,RF,RFS,PSOBAR3,PSOBAR4,PSOBAR2
"RTN","PSOSD1",25,0)
 D KVA^VADPT K DOD,FILL,DIC,PSCNT,PSDT,PCLASS,PHYS,ZCLASS,PSOPRINT,RXNODE,DIR,X1,X2,PSONUM,PSOPOLP
"RTN","PSOSD1",26,0)
 Q
"RTN","PSOSD1",27,0)
 ;
"RTN","PSOSD1",28,0)
DAYS K DIR S DIR("A")="Profile Expiration/Discontinued Cutoff",DIR("B")=120,DIR(0)="N^0:9999:0",DIR("?",1)="Enter the number of days which will cut discontinued and expired Rx's from",DIR("?")="the profile."
"RTN","PSOSD1",29,0)
 D ^DIR Q:$D(DTOUT)!($D(DUOUT))  S PSDAYS=X K DIR S X1=DT,X2=-PSDAYS D C^%DTC S (PSDATE,PSDAY)=X
"RTN","PSOSD1",30,0)
 Q
"RTN","PSOSD1",31,0)
 ;
"RTN","PSOSD1",32,0)
DFN S:'$D(PSORM) PSORM=1
"RTN","PSOSD1",33,0)
 S PSOIOS=IOS D DEVBAR^PSOBMST S PSOBAR2=PSOBAR0,PSOBAR3=PSOBAR1
"RTN","PSOSD1",34,0)
 S PSOBAR4=$G(PSOBAR3)]""&($G(PSOBAR2)]"")&(+$P($G(PSOPAR),"^"))
"RTN","PSOSD1",35,0)
 W:$D(PSONOPG)&($G(PSONOPG)'=2) @IOF I '$G(PSOSITE) S PSOSITE=$O(^PS(59,0))
"RTN","PSOSD1",36,0)
 S PRF=DFN_"," D:'$G(PSDAYS)  G START
"RTN","PSOSD1",37,0)
 .S PSDAYS=120,X1=DT,X2=-PSDAYS D C^%DTC S (PSDATE,PSDAY)=X
"RTN","PSOSD1",38,0)
 Q
"RTN","PSOSD1",39,0)
 ;
"RTN","PSOSD1",40,0)
ELIG S PSOPRINT=""
"RTN","PSOSD1",41,0)
 D ELIG^VADPT
"RTN","PSOSD1",42,0)
 Q:'$D(VAEL(4))
"RTN","PSOSD1",43,0)
 Q:+VAEL(4)'=1
"RTN","PSOSD1",44,0)
 I $D(VAEL(3)),+VAEL(3)=1,($P(VAEL(3),"^",2)<50) S PSOPRINT="SC NSC"
"RTN","PSOSD1",45,0)
 D KVAR^VADPT
"RTN","PSOSD1",46,0)
 Q
"RTN","PSOSD1",47,0)
 ;
"RTN","PSOSD1",48,0)
RXPAD N K Q:$G(DOD(DFN))]""  D HD F CNT=1:1:4 S LF="!?45" D  Q:$Y+14>IOSL
"RTN","PSOSD1",49,0)
 .W !?4,"Name: "_PSNAME,?33,"ID#: "_PSSN,?58,"DOB: "_PSDOB
"RTN","PSOSD1",50,0)
 .W !!,CNT,?4,"Medication: ",LN,$E(LN,1,11),!!?4,"Outpatient Directions: ",LN,!?4
"RTN","PSOSD1",51,0)
 .W $E(LN,1,3),"SC",$E(LN,1,3),"NSC","  Quantity: _____    Days Supply _____   "
"RTN","PSOSD1",52,0)
 .W:'$G(PSORM) @LF W "Refills: 0 1 2 3 4 5 6 7 8 9 10 11"
"RTN","PSOSD1",53,0)
 .W !!?4,$E(LN,1,35)," ",$E(LN,1,14)," ",$E(LN,1,24)
"RTN","PSOSD1",54,0)
 .W !?4,"Provider's Signature",?40,"DEA #",?55,"Date/Time",!!,$E(LINE,1,$S('PSORM:80,1:IOM))
"RTN","PSOSD1",55,0)
 K LF Q
"RTN","PSOSD1",56,0)
 ;
"RTN","PSOSD1",57,0)
HD S FN=DFN S:'$D(PSORM) PSORM=1
"RTN","PSOSD1",58,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9)&(+VAPA(10)):"Temporary ",1:"")
"RTN","PSOSD1",59,0)
 I +VADM(6) S DOD(DFN)=$P(VADM(6),"^",2)
"RTN","PSOSD1",60,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2) I $D(IOF),$G(PAGE)'=1 W @IOF
"RTN","PSOSD1",61,0)
 W "Action Rx Profile",?47,"Run Date: " S Y=DT D DT^DIO2 W ?71,"Page: "_PAGE S PAGE=PAGE+1,X=$$SITE^VASITE
"RTN","PSOSD1",62,0)
 W !,"Sorted by drug classification for Rx's currently active"_$S('PSDAYS:" only.",1:"") W:PSDAYS !,"and for those Rx's that have been inactive less than "_PSDAYS_" days."
"RTN","PSOSD1",63,0)
 W @$S(PSORM:"?70",1:"!"),"Site: VAMC "_$P(X,"^",2)_" ("_$P(X,"^",3)_")",!,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD1",64,0)
 I $P(VAIN(4),"^",2)]"",+$P($G(^PS(59.7,1,40.1)),"^") W !,"Outpatient prescriptions are discontinued 72 hours after admission.",!
"RTN","PSOSD1",65,0)
 W !?1,"Name  : ",PSNAME,?30,"ID#: "_PSSN W ?58,"Action Date: ________" W !?1,"DOB   : "_PSDOB
"RTN","PSOSD1",66,0)
 W:ADDRFL]"" ?30,ADDRFL,! W ?30,"Address  : "
"RTN","PSOSD1",67,0)
 W ?41,VAPA(1) W:VAPA(2)]"" !?41,VAPA(2) W:VAPA(3)]"" !?41,VAPA(3) W !?41,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),!?30,"Phone    : "_VAPA(8)
"RTN","PSOSD1",68,0)
 I PSOBAR4 S X="S",X2=PSSN W @$S('PSORM:"!?30",1:"?$X+5") S X1=$X W @PSOBAR3,X2,@PSOBAR2,$C(13) S $X=0
"RTN","PSOSD1",69,0)
 S (WT,HT)="",X="GMRVUTL" X ^%ZOSF("TEST") I $T D
"RTN","PSOSD1",70,0)
 .F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSOSD1",71,0)
 .S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),$P(WT,"^",9)=Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),$P(HT,"^",9)=Y
"RTN","PSOSD1",72,0)
 W !!,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSOSD1",73,0)
 D GMRA^PSODEM W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!,"Instructions to the provider:",!,"A prescription blank (VA FORM 10-2577f) must be used for All Class II NARCOTICS."
"RTN","PSOSD1",74,0)
 S (ELN,LN,LINE)="",$P(LN,"_",53)="",$P(LINE,"-",132)=""
"RTN","PSOSD1",75,0)
 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!?4,"OTHER MEDICATIONS:",!
"RTN","PSOSD1",76,0)
 Q
"RTN","PSOSD1",77,0)
LM ;prints AP from listamn action
"RTN","PSOSD1",78,0)
 S X=$$SITE^VASITE,PSOINST=$P(X,"^",3) K X
"RTN","PSOSD1",79,0)
 K DIR S DIR("A")="Action or Informational (A or I): ",DIR("?",1)="Enter 'A' for action profile",DIR("?",2)="      'I' for informational profile",DIR("?")="      'E' to EXIT process",DIR("B")="A",DIR(0)="SAM^1:Action;0:Informational;E:Exit"
"RTN","PSOSD1",80,0)
 D ^DIR K DIR Q:Y="E"!($D(DIRUT))  S PSTYPE=Y,LM=1
"RTN","PSOSD1",81,0)
 I '$P($G(PSOSYS),"^",6) S PSOPOL=0 G ASK
"RTN","PSOSD1",82,0)
 K DIR S DIR("A")="Do you want generate a Polypharmacy report?: ",DIR("?",1)="Enter 'Y' to generate report",DIR("?",2)="      'N' if you do not want the report",DIR("?")="      'E' to EXIT process",DIR("B")="NO",DIR(0)="SA^1:YES;0:NO;E:Exit"
"RTN","PSOSD1",83,0)
 D ^DIR S PSOPOL=$S(Y:1,1:0) G:Y="E"!($D(DIRUT)) EXIT G:'PSOPOL ASK
"RTN","PSOSD1",84,0)
 K DIR S DIR("A")="Minimum Number of Active Prescriptions",DIR("B")=7,DIR(0)="N^1:100:0" D ^DIR S PSONUM=Y G:$D(DIRUT) EXIT
"RTN","PSOSD1",85,0)
 K DIR,DTOUT,DIRUT,DUOUT S DIR("A")="Do you want this Profile to print in 132 columns or 80 columns: ",DIR("B")="132",DIR(0)="SAM^1:132;8:80;E:Exit"
"RTN","PSOSD1",86,0)
 D ^DIR G:Y="E"!($D(DUOUT))!($D(DIRUT)) EXIT S PSORM=$S(Y=1:1,1:0) K DIR,X,Y
"RTN","PSOSD1",87,0)
ASK D DAYS S PRF=PSODFN_"," D DEV I $D(ZTSK) S VALMSG="Action Profile Queued to Printer."
"RTN","PSOSD1",88,0)
 D EXIT K LM
"RTN","PSOSD1",89,0)
 Q
"RTN","PSOSD3")
0^22^B40259023
"RTN","PSOSD3",1,0)
PSOSD3 ;BHAM ISC/RTR - Prints pending orders on action profile ;11/20/95
"RTN","PSOSD3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,19,107,110,132**;DEC 1997
"RTN","PSOSD3",3,0)
 ;External reference ^PS(50.7 - 2223
"RTN","PSOSD3",4,0)
 ;External reference ^PS(50.606 - 2174
"RTN","PSOSD3",5,0)
 ;External reference ^PSDRUG( - 221
"RTN","PSOSD3",6,0)
 ;External reference ^PS(59.7 - 694
"RTN","PSOSD3",7,0)
 ;External reference to ^PS(55 - 2228
"RTN","PSOSD3",8,0)
 ;
"RTN","PSOSD3",9,0)
START Q:$D(DUOUT)!($D(DTOUT))!('$G(DFN))
"RTN","PSOSD3",10,0)
 N MMM,PNDIS,PNDLINE,PNDREX,PNPOI,PPPP,PSOPRVD,PSCONT,PSOEFF,PSOQTY,PSOREFLS,PZSTAT,WWW
"RTN","PSOSD3",11,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9)&(+VAPA(10)):"Temporary ",1:"")
"RTN","PSOSD3",12,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSD3",13,0)
 K ^TMP($J,"PSOPEND") S $P(PNDLINE,"-",33)=""
"RTN","PSOSD3",14,0)
 S PSCONT=1 F MMM=0:0 S MMM=$O(^PS(52.41,"P",DFN,MMM)) Q:'MMM  S PZSTAT=$P($G(^PS(52.41,MMM,0)),"^",3) I PZSTAT="NW"!(PZSTAT="HD")!(PZSTAT="RNW") D
"RTN","PSOSD3",15,0)
 .S ^TMP($J,"PSOPEND",PSCONT)=MMM_"^"_$S(+$P($G(^PS(52.41,MMM,0)),"^",9):"DD",1:"OI") S PSCONT=PSCONT+1
"RTN","PSOSD3",16,0)
 I $Y+6>IOSL D HD1 S:$D(DTOUT)!($D(DUOUT)) PSQFLG=1 G:$G(PSQFLG) END
"RTN","PSOSD3",17,0)
 D HD
"RTN","PSOSD3",18,0)
 I PSCONT=1 W !?10,"No pending orders for this patient!",! G END
"RTN","PSOSD3",19,0)
 F WWW=0:0 S WWW=$O(^TMP($J,"PSOPEND",WWW)) Q:'WWW!($G(PSQFLG))  D
"RTN","PSOSD3",20,0)
 .S PNDREX=$P(^TMP($J,"PSOPEND",WWW),"^"),PNDIS=$P($G(^PS(52.41,PNDREX,0)),"^",9),PNPOI=$P($G(^(0)),"^",8),PSOEFF=$P($G(^(0)),"^",6),PSOQTY=$P($G(^(0)),"^",10),PSOREFLS=$P($G(^(0)),"^",11),PSOPRVD=$P($G(^(0)),"^",5)
"RTN","PSOSD3",21,0)
 .W !,"Drug: ",$S($P(^TMP($J,"PSOPEND",WWW),"^",2)="DD":$P($G(^PSDRUG(+PNDIS,0)),"^"),1:$P($G(^PS(50.7,+PNPOI,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")),!
"RTN","PSOSD3",22,0)
 .W ?1,"Eff. Date: ",$E(PSOEFF,4,5)_"-"_$E(PSOEFF,6,7)_"-"_($E(PSOEFF,1,3)+1700),?22,"Qty: ",PSOQTY,?40,"Refills: ",PSOREFLS,?52,"Prov: ",$E($P($G(^VA(200,+PSOPRVD,0)),"^"),1,21)
"RTN","PSOSD3",23,0)
 .S PSCONT=1 W !?1,"Sig: " F PPPP=0:0 S PPPP=$O(^PS(52.41,PNDREX,"SIG",PPPP)) Q:'PPPP!($G(PSQFLG))  W:PSCONT>1 ! W ?6,$G(^PS(52.41,PNDREX,"SIG",PPPP,0)) S PSCONT=PSCONT+1
"RTN","PSOSD3",24,0)
 .I $E(IOST)'="C" W !
"RTN","PSOSD3",25,0)
 .I $E(IOST)="C" D HD1 S:$D(DUOUT)!($D(DTOUT)) PSQFLG=1 Q:$G(PSQFLG)  D HD
"RTN","PSOSD3",26,0)
 .I $E(IOST)'="C" I $Y+9>IOSL D HD1 S:$D(DUOUT)!($D(DTOUT)) PSQFLG=1 Q:$G(PSQFLG)  D HD
"RTN","PSOSD3",27,0)
END K ^TMP($J,"PSOPEND") Q
"RTN","PSOSD3",28,0)
HD W !,PNDLINE,"PENDING ORDERS",PNDLINE,! Q
"RTN","PSOSD3",29,0)
 ;
"RTN","PSOSD3",30,0)
HD1 S FN=DFN
"RTN","PSOSD3",31,0)
 I $E(IOST)="C" K DIR S DIR(0)="E",DIR("A")="Press Return to Continue or ""^"" to Exit" D ^DIR Q:$D(DUOUT)!($D(DTOUT))
"RTN","PSOSD3",32,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9)&(+VAPA(10)):"Temporary ",1:"")
"RTN","PSOSD3",33,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSD3",34,0)
 I $D(IOF) W @IOF
"RTN","PSOSD3",35,0)
 W $S(PSTYPE:"Action",1:"Informational")_" Rx Profile",?47,"Run Date: " S Y=DT D DT^DIO2 W ?71,"Page: "_PAGE
"RTN","PSOSD3",36,0)
 W !,"Sorted by drug classification for Rx's currently active"_$S('PSDAYS:" only.",1:"") W:PSDAYS !,"and for those Rx's that have been inactive less than "_PSDAYS_" days."
"RTN","PSOSD3",37,0)
 S X=$$SITE^VASITE
"RTN","PSOSD3",38,0)
 W @$S(PSORM:"?70",1:"!"),"Site: VAMC "_$P(X,"^",2)_" ("_$P(X,"^",3)_")",!,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD3",39,0)
 I $P(VAIN(4),"^",2)]"",+$P($G(^PS(59.7,1,40.1)),"^") W !,"Outpatient prescriptions are discontinued 72 hours after admission.",!
"RTN","PSOSD3",40,0)
 I $D(CLINICX) W !?1,"Clinic: "_$E(CLINICX,1,28),?45,"Date/Time: " S Y=CLDT D DT^DIO2
"RTN","PSOSD3",41,0)
 W !?1,"Name  : ",PSNAME,?30,"ID#: "_PSSN W:PSTYPE ?58,"Action Date: ________" W !?1,"DOB   : "_PSDOB
"RTN","PSOSD3",42,0)
 W:ADDRFL]"" ?30,ADDRFL,! W ?30,"Address  : "
"RTN","PSOSD3",43,0)
 W ?41,VAPA(1) W:VAPA(2)]"" !?41,VAPA(2) W:VAPA(3)]"" !?41,VAPA(3)
"RTN","PSOSD3",44,0)
 W !?41,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),!?30,"Phone    : "_VAPA(8)
"RTN","PSOSD3",45,0)
 I PSOBAR4 S X="S",X2=PSSN W @$S('PSORM:"!?30",1:"?$X+5") S X1=$X W @PSOBAR3,X2,@PSOBAR2,$C(13) S $X=0
"RTN","PSOSD3",46,0)
 W:$G(DOD(DFN))]"" ?1,"**** Date of Death: "_DOD(DFN)_" ****",!
"RTN","PSOSD3",47,0)
 S (WT,HT)="",X="GMRVUTL" X ^%ZOSF("TEST") I $T D
"RTN","PSOSD3",48,0)
 .F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSOSD3",49,0)
 .S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),WT=WT_"^"_Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),HT=HT_"^"_Y
"RTN","PSOSD3",50,0)
 W !!,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSOSD3",51,0)
 S PAGE=PAGE+1 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD3",52,0)
 Q
"RTN","PSOSD3",53,0)
NVA ;displays non-va meds
"RTN","PSOSD3",54,0)
 Q:'$O(^PS(55,DFN,"NVA",0))
"RTN","PSOSD3",55,0)
 Q:$D(DUOUT)!($D(DTOUT))!('$G(DFN))
"RTN","PSOSD3",56,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9)&(+VAPA(10)):"Temporary ",1:"")
"RTN","PSOSD3",57,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2),$P(PNDLINE,"-",IOM)="",PSODFN=DFN
"RTN","PSOSD3",58,0)
 D HD1 W !,PNDLINE,!?25,"Non-VA Meds (Not dispensed by VA)",!,PNDLINE,!
"RTN","PSOSD3",59,0)
 F NVA=0:0 S NVA=$O(^PS(55,DFN,"NVA",NVA)) Q:'NVA  D  Q:$G(PSQFLG)
"RTN","PSOSD3",60,0)
 .I $Y+6>IOSL D HD1 S:$D(DTOUT)!($D(DUOUT)) PSQFLG=1 Q:$G(PSQFLG)
"RTN","PSOSD3",61,0)
 .Q:'$P(^PS(55,PSODFN,"NVA",NVA,0),"^")
"RTN","PSOSD3",62,0)
 .S DUPRX0=^PS(55,PSODFN,"NVA",NVA,0)
"RTN","PSOSD3",63,0)
 .W !,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSOSD3",64,0)
 .W !,"Drug: "_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSOSD3",65,0)
 .W !,"Status: "_$S($P(DUPRX0,"^",7):"Discontinued ("_$$FMTE^XLFDT($P($P(DUPRX0,"^",7),"."))_")",1:"Active")
"RTN","PSOSD3",66,0)
 .W !,"Dosage: "_$P(DUPRX0,"^",3)
"RTN","PSOSD3",67,0)
 .W !,"Schedule: "_$P(DUPRX0,"^",5),!,"Route: "_$P(DUPRX0,"^",4)
"RTN","PSOSD3",68,0)
 .W !,"Start Date: "_$$FMTE^XLFDT($P(DUPRX0,"^",9)),?40,"CPRS Oder #: "_$P(DUPRX0,"^",8)
"RTN","PSOSD3",69,0)
 .W !,"Documented By: "_$P(^VA(200,$P(DUPRX0,"^",11),0),"^")_" on "_$$FMTE^XLFDT($P(DUPRX0,"^",10))
"RTN","PSOSD3",70,0)
 .S RMLEN=$S('PSORM:75,1:IOM-5)
"RTN","PSOSD3",71,0)
 .F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",NVA,"OCK",I)) Q:'I  D  W !
"RTN","PSOSD3",72,0)
 ..S ORD=$P(^PS(55,PSODFN,"NVA",NVA,"OCK",I,0),"^"),ORP=$P(^(0),"^",2)
"RTN","PSOSD3",73,0)
 ..W !,"Order Check #"_I_": "
"RTN","PSOSD3",74,0)
 ..K OCK,LEN I $L(ORD)>RMLEN S (LEN,IEN)=1 D
"RTN","PSOSD3",75,0)
 ...F SG=1:1:$L(ORD) S:$L($G(OCK(IEN))_" "_$P(ORD," ",SG))>RMLEN&($P(ORD," ",SG)]"") IEN=IEN+1 S:$P(ORD," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(ORD," ",SG)
"RTN","PSOSD3",76,0)
 ...F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSOSD3",77,0)
 ..W:'$G(LEN) ORD K LEN,SG,IEN,II,OCK,ORD
"RTN","PSOSD3",78,0)
 ..W !,"Overriding Provider: "_$S($G(ORP):$P(^VA(200,ORP,0),"^"),1:"")
"RTN","PSOSD3",79,0)
 ..K ORP,OCK,REA W !,"Reason:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",NVA,"OCK",I,"OVR",SS)) Q:'SS  S REA(SS)=^PS(55,PSODFN,"NVA",NVA,"OCK",I,"OVR",SS,0)
"RTN","PSOSD3",80,0)
 ..S IEN=1 F II=0:0 S II=$O(REA(II)) Q:'II  D
"RTN","PSOSD3",81,0)
 ...F SG=1:1:$L(REA(II)) S:$L($G(OCK(IEN))_" "_$P(REA(II)," ",SG))>RMLEN&($P(REA(II)," ",SG)]"") IEN=IEN+1 S:$P(REA(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(REA(II)," ",SG)
"RTN","PSOSD3",82,0)
 ...K REA,IEN,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W OCK(II) I $O(OCK(II)) W !?5
"RTN","PSOSD3",83,0)
 .K OCK W !,"Statement/Explanation/Comments:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",NVA,"DSC",SS)) Q:'SS  S DSC(SS)=^PS(55,PSODFN,"NVA",NVA,"DSC",SS,0)
"RTN","PSOSD3",84,0)
 .S IEN=1 F II=0:0 S II=$O(DSC(II)) Q:'II  D
"RTN","PSOSD3",85,0)
 ..F SG=1:1:$L(DSC(II)) S:$L($G(OCK(IEN))_" "_$P(DSC(II)," ",SG))>RMLEN&($P(DSC(II)," ",SG)]"") IEN=IEN+1 S:$P(DSC(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(DSC(II)," ",SG)
"RTN","PSOSD3",86,0)
 .K IEN,DSC,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSOSD3",87,0)
 .W !! I $E(IOST)'="C" W !
"RTN","PSOSD3",88,0)
 K RMLEN
"RTN","PSOSD3",89,0)
 Q
"UP",55,55.05,-1)
55^NVA
"UP",55,55.05,0)
55.05
"UP",55,55.051,-2)
55^NVA
"UP",55,55.051,-1)
55.05^OCK
"UP",55,55.051,0)
55.051
"UP",55,55.0511,-3)
55^NVA
"UP",55,55.0511,-2)
55.05^OCK
"UP",55,55.0511,-1)
55.051^OVR
"UP",55,55.0511,0)
55.0511
"UP",55,55.052,-2)
55^NVA
"UP",55,55.052,-1)
55.05^DSC
"UP",55,55.052,0)
55.052
"UP",55,55.514,-2)
55^NVA
"UP",55,55.514,-1)
55.05^1
"UP",55,55.514,0)
55.514
"VER")
8.0^22.0
"^DD",55,55,52.2,0)
NON-VA MEDS^55.05P^^NVA;0
"^DD",55,55,52.2,21,0)
^.001^2^2^3030609^^^^
"^DD",55,55,52.2,21,1,0)
This is the Non-VA Meds order multiple. It will be used to store the 
"^DD",55,55,52.2,21,2,0)
Non-VA Med orders entered through the CPRS application.
"^DD",55,55,52.2,23,0)
^.001^1^1^3030609^^^^
"^DD",55,55,52.2,23,1,0)
This multiple field (#52.2) contains the Non-VA Med orders.
"^DD",55,55,52.2,"DT")
3030326
"^DD",55,55.05,0)
NON-VA MEDS SUB-FIELD^^14^15
"^DD",55,55.05,0,"DIK")
PSSJXR
"^DD",55,55.05,0,"DT")
3040407
"^DD",55,55.05,0,"IX","APSOD",55.05,5)

"^DD",55,55.05,0,"IX","B",55.05,.01)

"^DD",55,55.05,0,"NM","NON-VA MEDS")

"^DD",55,55.05,0,"UP")
55
"^DD",55,55.05,.01,0)
ORDERABLE ITEM^P50.7'^PS(50.7,^0;1^Q
"^DD",55,55.05,.01,1,0)
^.1
"^DD",55,55.05,.01,1,1,0)
55.05^B
"^DD",55,55.05,.01,1,1,1)
S ^PS(55,DA(1),"NVA","B",$E(X,1,30),DA)=""
"^DD",55,55.05,.01,1,1,2)
K ^PS(55,DA(1),"NVA","B",$E(X,1,30),DA)
"^DD",55,55.05,.01,21,0)
^^2^2^3030328^
"^DD",55,55.05,.01,21,1,0)
This is the orderable item that represents the Non-VA Med being taken by 
"^DD",55,55.05,.01,21,2,0)
the patient.
"^DD",55,55.05,.01,23,0)
^^1^1^3030328^
"^DD",55,55.05,.01,23,1,0)
This field points to the PHARMACY ORDERABLE ITEM (#50.7).
"^DD",55,55.05,.01,"DT")
3030328
"^DD",55,55.05,1,0)
DISPENSE DRUG^P50'^PSDRUG(^0;2^Q
"^DD",55,55.05,1,21,0)
^^2^2^3030328^
"^DD",55,55.05,1,21,1,0)
This is the dispense drug that represents the Non-VA Med being taken by 
"^DD",55,55.05,1,21,2,0)
the patient.
"^DD",55,55.05,1,23,0)
^^1^1^3030328^
"^DD",55,55.05,1,23,1,0)
This field is a pointer to the DRUG file (#50). 
"^DD",55,55.05,1,"DT")
3030328
"^DD",55,55.05,2,0)
DOSAGE^F^^0;3^K:$L(X)>80!($L(X)<1) X
"^DD",55,55.05,2,3)
Answer must be 1-80 characters in length
"^DD",55,55.05,2,21,0)
^^1^1^3030328^
"^DD",55,55.05,2,21,1,0)
This is the dosage of the Non-VA Med being taken by the patient.
"^DD",55,55.05,2,"DT")
3030328
"^DD",55,55.05,3,0)
MEDICATION ROUTE^F^^0;4^K:$L(X)>20!($L(X)<1) X
"^DD",55,55.05,3,3)
Answer must be 1-20 characters in length
"^DD",55,55.05,3,21,0)
^^1^1^3030328^
"^DD",55,55.05,3,21,1,0)
This is the route of the Non-VA Medication being taken by the patient.
"^DD",55,55.05,3,"DT")
3030328
"^DD",55,55.05,4,0)
SCHEDULE^F^^0;5^K:$L(X)>50!($L(X)<1) X
"^DD",55,55.05,4,3)
Answer must be 1-50 characters in length.
"^DD",55,55.05,4,21,0)
^.001^1^1^3040315^^
"^DD",55,55.05,4,21,1,0)
This is the schedule of the Non-VA Medication being taken by the patient.
"^DD",55,55.05,4,"DT")
3040315
"^DD",55,55.05,5,0)
STATUS^S^1:DISCONTINUED;2:DATE OF DEATH ENTERED;^0;6^Q
"^DD",55,55.05,5,1,0)
^.1
"^DD",55,55.05,5,1,1,0)
55.05^APSOD^MUMPS
"^DD",55,55.05,5,1,1,1)
S:$G(PSODEATH) ^PS(55,DA(1),"NVA","APSOD",DA)=""
"^DD",55,55.05,5,1,1,2)
K:$G(PSODEATH) ^PS(55,DA(1),"NVA","APSOD",DA)
"^DD",55,55.05,5,1,1,3)
DO NOT DELETE.
"^DD",55,55.05,5,1,1,"%D",0)
^.101^3^3^3031217^^
"^DD",55,55.05,5,1,1,"%D",1,0)
This xref will be set only when a Non-VA med is discontinued because 
"^DD",55,55.05,5,1,1,"%D",2,0)
a death of detah was entered.  This xref will be used to reinstate order
"^DD",55,55.05,5,1,1,"%D",3,0)
if date of death is deleted. ^PS(55,dfn,"nva","apsod",da).
"^DD",55,55.05,5,1,1,"DT")
3031217
"^DD",55,55.05,5,21,0)
^.001^1^1^3031217^^^
"^DD",55,55.05,5,21,1,0)
This is the status of the Non-VA Med order.
"^DD",55,55.05,5,23,0)
^.001^1^1^3031217^^
"^DD",55,55.05,5,23,1,0)
set of codes
"^DD",55,55.05,5,"DT")
3031217
"^DD",55,55.05,6,0)
DISCONTINUED DATE^D^^0;7^S %DT="ETX" D ^%DT S X=Y K:X<1 X
"^DD",55,55.05,6,3)
(No range limit on date)
"^DD",55,55.05,6,21,0)
^^1^1^3030328^
"^DD",55,55.05,6,21,1,0)
This is the date the patient stopped taking the Non-VA Medication.
"^DD",55,55.05,6,"DT")
3030328
"^DD",55,55.05,7,0)
ORDER NUMBER^P100'^OR(100,^0;8^Q
"^DD",55,55.05,7,3)
This is the CPRS order number.
"^DD",55,55.05,7,21,0)
^^1^1^3030328^
"^DD",55,55.05,7,21,1,0)
This is the CPRS order number.
"^DD",55,55.05,7,"DT")
3030328
"^DD",55,55.05,8,0)
START DATE^D^^0;9^S %DT="ET" D ^%DT S X=Y K:Y<1 X
"^DD",55,55.05,8,3)
(No range limit on date)
"^DD",55,55.05,8,21,0)
^.001^1^1^3040407^^
"^DD",55,55.05,8,21,1,0)
This is the date the patient started taking the Non-VA Medication.
"^DD",55,55.05,8,"DT")
3040407
"^DD",55,55.05,9,0)
ORDER CHECKS^55.051^^OCK;0
"^DD",55,55.05,10,0)
DISCLAIMER^55.052^^DSC;0
"^DD",55,55.05,10,21,0)
^^1^1^3030428^
"^DD",55,55.05,10,21,1,0)
 This is the multiple for the Non-VA Med Disclaimer (Statement/Explanation).
"^DD",55,55.05,11,0)
DOCUMENTED DATE^RD^^0;10^S %DT="ETX" D ^%DT S X=Y K:X<1 X
"^DD",55,55.05,11,1,0)
^.1
"^DD",55,55.05,11,1,1,0)
55^ADCDT
"^DD",55,55.05,11,1,1,1)
S ^PS(55,"ADCDT",$E(X,1,30),DA(1),DA)=""
"^DD",55,55.05,11,1,1,2)
K ^PS(55,"ADCDT",$E(X,1,30),DA(1),DA)
"^DD",55,55.05,11,1,1,"DT")
3030326
"^DD",55,55.05,11,3)
(No range limit on date)
"^DD",55,55.05,11,21,0)
^^1^1^3030328^
"^DD",55,55.05,11,21,1,0)
This is the date the Non-VA Med order was entered to the system.
"^DD",55,55.05,11,"DT")
3030328
"^DD",55,55.05,12,0)
DOCUMENTED BY^RP200'^VA(200,^0;11^Q
"^DD",55,55.05,12,21,0)
^^1^1^3030328^
"^DD",55,55.05,12,21,1,0)
This is the person responsible for documenting the Non-VA Med order.
"^DD",55,55.05,12,"DT")
3030328
"^DD",55,55.05,13,0)
CLINIC^P44'^SC(^0;12^Q
"^DD",55,55.05,13,"DT")
3030325
"^DD",55,55.05,14,0)
COMMENTS^55.514^^1;0
"^DD",55,55.051,0)
ORDER CHECKS SUB-FIELD^^2^3
"^DD",55,55.051,0,"DIK")
PSSJXR
"^DD",55,55.051,0,"DT")
3030710
"^DD",55,55.051,0,"IX","B",55.051,.01)

"^DD",55,55.051,0,"NM","ORDER CHECKS")

"^DD",55,55.051,0,"UP")
55.05
"^DD",55,55.051,.01,0)
ORDER CHECK NARRATIVE^F^^0;1^K:$L(X)>200!($L(X)<1) X
"^DD",55,55.051,.01,1,0)
^.1
"^DD",55,55.051,.01,1,1,0)
55.051^B
"^DD",55,55.051,.01,1,1,1)
S ^PS(55,DA(2),"NVA",DA(1),"OCK","B",$E(X,1,30),DA)=""
"^DD",55,55.051,.01,1,1,2)
K ^PS(55,DA(2),"NVA",DA(1),"OCK","B",$E(X,1,30),DA)
"^DD",55,55.051,.01,3)
Answer must be 1-200 characters in length.
"^DD",55,55.051,.01,21,0)
^.001^1^1^3030710^^^^
"^DD",55,55.051,.01,21,1,0)
This is the narrative of the order check(s) for the Non-VA Med order.
"^DD",55,55.051,.01,"DT")
3030710
"^DD",55,55.051,1,0)
OVERRIDING PROVIDER^P200'^VA(200,^0;2^Q
"^DD",55,55.051,1,3)

"^DD",55,55.051,1,21,0)
^^1^1^3030710^
"^DD",55,55.051,1,21,1,0)
This is the provider responsible for overriding the order check.
"^DD",55,55.051,1,"DT")
3030710
"^DD",55,55.051,2,0)
OVERRIDING REASON^55.0511^^OVR;0
"^DD",55,55.051,2,21,0)
^.001^1^1^3030414^^
"^DD",55,55.051,2,21,1,0)
This is the overriding reason description given by the Provider.
"^DD",55,55.0511,0)
OVERRIDING REASON SUB-FIELD^^.01^1
"^DD",55,55.0511,0,"DT")
3030414
"^DD",55,55.0511,0,"NM","OVERRIDING REASON")

"^DD",55,55.0511,0,"UP")
55.051
"^DD",55,55.0511,.01,0)
OVERRIDING REASON^W^^0;1^Q
"^DD",55,55.0511,.01,21,0)
^.001^1^1^3030414^^^
"^DD",55,55.0511,.01,21,1,0)
This is the overriding reason description given by the Provider.
"^DD",55,55.0511,.01,"DT")
3030414
"^DD",55,55.052,0)
DISCLAIMER SUB-FIELD^^.01^1
"^DD",55,55.052,0,"DT")
3030418
"^DD",55,55.052,0,"NM","DISCLAIMER")

"^DD",55,55.052,0,"UP")
55.05
"^DD",55,55.052,.01,0)
DISCLAIMER^W^^0;1^Q
"^DD",55,55.052,.01,21,0)
^.001^1^1^3030428^^
"^DD",55,55.052,.01,21,1,0)
This is the multiple for the Non-VA Med Disclaimer (Statement/Explanation)
"^DD",55,55.052,.01,"DT")
3030418
"^DD",55,55.514,0)
COMMENTS SUB-FIELD^^.01^1
"^DD",55,55.514,0,"DT")
3040317
"^DD",55,55.514,0,"NM","COMMENTS")

"^DD",55,55.514,0,"UP")
55.05
"^DD",55,55.514,.01,0)
COMMENTS^W^^0;1^Q
"^DD",55,55.514,.01,3)
Comment from CPRS.
"^DD",55,55.514,.01,21,0)
^^1^1^3040317^
"^DD",55,55.514,.01,21,1,0)
This field will store comments enter when placing the Non-VA med order.
"^DD",55,55.514,.01,"DT")
3040317
**END**
**END**
