Released PSA*3*11 SEQ #4
Extracted from mail message
**KIDS**:PSA*3.0*11^

**INSTALL NAME**
PSA*3.0*11
"BLD",570,0)
PSA*3.0*11^DRUG ACCOUNTABILITY^0^2980923^y
"BLD",570,1,0)
^^1^1^2980923^
"BLD",570,1,1,0)
A variable was mistakenly left out in the programming of patch PSA*3*8.
"BLD",570,4,0)
^9.64PA^^
"BLD",570,"KRN",0)
^9.67PA^^
"BLD",570,"KRN",.4,0)
.4
"BLD",570,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",570,"KRN",.401,0)
.401
"BLD",570,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",570,"KRN",.402,0)
.402
"BLD",570,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",570,"KRN",.403,0)
.403
"BLD",570,"KRN",.5,0)
.5
"BLD",570,"KRN",.84,0)
.84
"BLD",570,"KRN",3.6,0)
3.6
"BLD",570,"KRN",3.8,0)
3.8
"BLD",570,"KRN",9.2,0)
9.2
"BLD",570,"KRN",9.8,0)
9.8
"BLD",570,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",570,"KRN",9.8,"NM",1,0)
PSANDF^^0^B52669098
"BLD",570,"KRN",9.8,"NM","B","PSANDF",1)

"BLD",570,"KRN",19,0)
19
"BLD",570,"KRN",19.1,0)
19.1
"BLD",570,"KRN",101,0)
101
"BLD",570,"KRN",409.61,0)
409.61
"BLD",570,"KRN",771,0)
771
"BLD",570,"KRN",869.2,0)
869.2
"BLD",570,"KRN",870,0)
870
"BLD",570,"KRN",8994,0)
8994
"BLD",570,"KRN","B",.4,.4)

"BLD",570,"KRN","B",.401,.401)

"BLD",570,"KRN","B",.402,.402)

"BLD",570,"KRN","B",.403,.403)

"BLD",570,"KRN","B",.5,.5)

"BLD",570,"KRN","B",.84,.84)

"BLD",570,"KRN","B",3.6,3.6)

"BLD",570,"KRN","B",3.8,3.8)

"BLD",570,"KRN","B",9.2,9.2)

"BLD",570,"KRN","B",9.8,9.8)

"BLD",570,"KRN","B",19,19)

"BLD",570,"KRN","B",19.1,19.1)

"BLD",570,"KRN","B",101,101)

"BLD",570,"KRN","B",409.61,409.61)

"BLD",570,"KRN","B",771,771)

"BLD",570,"KRN","B",869.2,869.2)

"BLD",570,"KRN","B",870,870)

"BLD",570,"KRN","B",8994,8994)

"BLD",570,"QUES",0)
^9.62^^
"BLD",570,"REQB",0)
^9.611^1^1
"BLD",570,"REQB",1,0)
PSA*3.0*8^1
"BLD",570,"REQB","B","PSA*3.0*8",1)

"BLD",570,"REQG",0)
^9.611^^
"PKG",182,-1)
1^1
"PKG",182,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability/Inventory Interface^
"PKG",182,20,0)
^9.402P^^0
"PKG",182,22,0)
^9.49I^1^1
"PKG",182,22,1,0)
3.0^2971024^2970912^531
"PKG",182,22,1,"PAH",1,0)
11^2980923
"PKG",182,22,1,"PAH",1,1,0)
^^1^1^2981008
"PKG",182,22,1,"PAH",1,1,1,0)
A variable was mistakenly left out in the programming of patch PSA*3*8.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSANDF")
0^1^B52669098
"RTN","PSANDF",1,0)
PSANDF ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSANDF",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**8,11**; 10/24/97
"RTN","PSANDF",3,0)
 ;This routine searches NDF for the NDC. If it is not found, the user
"RTN","PSANDF",4,0)
 ;is asked to select the drug from the DRUG file.
"RTN","PSANDF",5,0)
 ;
"RTN","PSANDF",6,0)
 I PSANDC="",$P(PSADATA,"^",26)'="" D  Q
"RTN","PSANDF",7,0)
 .I +$P($P(PSADATA,"^",26),"~",2) D
"RTN","PSANDF",8,0)
 ..K PSASUP S PSASUP="S"_$P(PSADATA,"^",26),(PSACNT,PSAIEN50)=0
"RTN","PSANDF",9,0)
 ..F  S PSAIEN50=$O(^PSDRUG("C",PSASUP,PSAIEN50)) Q:PSAIEN50=""  D
"RTN","PSANDF",10,0)
 ...S PSASSUB=0 F  S PSASSUB=$O(^PSDRUG("C",PSASUP,PSAIEN50,PSASSUB)) Q:'PSASSUB  S PSACNT=PSACNT+1,PSASUP(PSACNT)=PSAIEN50_"^"_PSASSUB
"RTN","PSANDF",11,0)
 ..I 'PSACNT D  Q
"RTN","PSANDF",12,0)
 ...W !,"The vendor sent no NDC or UPC for the item."
"RTN","PSANDF",13,0)
 ...D ASKDRUG S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSANDF",14,0)
 ..I PSACNT=1 D  Q
"RTN","PSANDF",15,0)
 ...S PSAIEN=$P(PSASUP(1),"^"),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6)=PSAIEN,PSASUB=$P(PSASUP(1),"^",2),$P(^(PSALINE),"^",7)=PSASUB
"RTN","PSANDF",16,0)
 ...S PSANDC=PSASUP,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,PSAVSN=$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",4),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=PSAVSN
"RTN","PSANDF",17,0)
 ...S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSANDF",18,0)
 ..I PSACNT>1 S PSACNT=$O(PSASUP(0)) D:PSACNT MANYUPCS^PSAPROC5
"RTN","PSANDF",19,0)
 ;
"RTN","PSANDF",20,0)
LOOKNDF S PSACNT=0,X=$$PSA^PSNAPIS(PSANDC,.PSALIST),PSACNT=X
"RTN","PSANDF",21,0)
 K ^TMP("PSANDF",$J) S X=0 F  S X=$O(PSALIST(X)) Q:X'>0  S ^TMP("PSANDF",$J,X)=PSALIST(X)
"RTN","PSANDF",22,0)
 ;
"RTN","PSANDF",23,0)
 ;DAVEB (PSA*3*11)
"RTN","PSANDF",24,0)
 I $D(^TMP("PSANDF",$J)) S XX=$O(^TMP("PSANDF",$J,0)),PSAVAPN=$P($G(^PSDRUG(XX,"ND")),"^",2) K XX
"RTN","PSANDF",25,0)
 I $G(PSACNT)>0 S X=0 F  S X=$O(PSALIST(X)) Q:X'>0  I '$D(^PSDRUG(X,"I")) S ^TMP("PSANDF",$J,X)=$P(PSALIST(X),"^")
"RTN","PSANDF",26,0)
 I '$D(PSAVAPN),$D(PSALIST) S PSAVAPN=$O(PSALIST(0)),PSAVAPN=$S('$D(^PSDRUG(PSAVAPN,"ND")):"Unknown",1:$P($G(^PSDRUG(PSAVAPN,"ND")),"^",2))
"RTN","PSANDF",27,0)
 K PSALIST,X
"RTN","PSANDF",28,0)
NONE I 'PSACNT D  Q
"RTN","PSANDF",29,0)
 .I +$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4),"~",2)!($P($P(^(PSALINE),"^",4),"~",3)'="") D ^PSAPROC4
"RTN","PSANDF",30,0)
 .E  D ASKDRUG
"RTN","PSANDF",31,0)
 I PSACNT=1 S PSAVAPN=$P($G(^PSDRUG($O(^TMP("PSANDF",$J,0)),"ND")),"^",2) D ONE Q
"RTN","PSANDF",32,0)
 ;
"RTN","PSANDF",33,0)
MANY ;Display for selection if more than 1 drug is found for the Product Name
"RTN","PSANDF",34,0)
 W !!,"The NDC has the VA Product Name of "_PSAVAPN_".",!,"The following drugs have the same VA Product Name.",!
"RTN","PSANDF",35,0)
 S (PSACNT,PSAGET,PSAIEN50)=0 F  S PSAIEN50=+$O(^TMP("PSANDF",$J,PSAIEN50)) Q:'PSAIEN50  D  Q:PSAGET!(+$G(PSAIEN))
"RTN","PSANDF",36,0)
 .S PSACNT=PSACNT+1,^TMP("PSACNT",$J,PSACNT)=PSAIEN50
"RTN","PSANDF",37,0)
 .W !?2,PSACNT_". "_^TMP("PSANDF",$J,PSAIEN50)
"RTN","PSANDF",38,0)
 .I PSACNT#5=0 D  Q:PSAGET!($G(PSAIEN))
"RTN","PSANDF",39,0)
 ..W ! S DIR(0)="N^1:"_PSACNT,DIR("A",1)="Select the received drug or",DIR("A")="enter ""^"" to select the drug from the DRUG file.",DIR("?",1)="Choose the drug you received and assign it to the line item."
"RTN","PSANDF",40,0)
 ..S DIR("?")="To exit the list and select the drug from the DRUG file, enter ""^"".",DIR("??")="^D SELNDF^PSANDF1" D ^DIR K DIR I $G(DUOUT) S PSAGET=1 Q
"RTN","PSANDF",41,0)
 ..I $G(DTOUT) S PSAOUT=1 Q
"RTN","PSANDF",42,0)
 ..I +Y S PSAIEN=^TMP("PSACNT",$J,+Y),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=PSAIEN,$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT
"RTN","PSANDF",43,0)
 I '$G(PSAIEN),'PSAOUT,PSACNT#5'=0 D  G:Y="^" ASKDRUG Q:PSAOUT!($G(PSAIEN))
"RTN","PSANDF",44,0)
 .W ! S DIR(0)="N^1:"_PSACNT,DIR("A",1)="Select the received drug or",DIR("A")="enter ""^"" to select the drug from the DRUG file."
"RTN","PSANDF",45,0)
 .S DIR("?")="Select the drug you received or enter ""^""  to select the drug from the DRUG file.",DIR("??")="^D SELNDF^PSANDF1" D ^DIR K DIR Q:Y="^"
"RTN","PSANDF",46,0)
 .I $G(DTOUT) S PSAOUT=1 Q
"RTN","PSANDF",47,0)
 .S PSAIEN=^TMP("PSACNT",$J,+Y),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=PSAIEN,$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT,PSADATA=^(PSALINE) D EDITDISP^PSAUTL1
"RTN","PSANDF",48,0)
 K ^TMP("PSACNT",$J,PSACNT),^TMP("PSANDF",$J)
"RTN","PSANDF",49,0)
 Q:+$G(PSAIEN)!(PSAOUT)
"RTN","PSANDF",50,0)
 I +$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4),"~",2),$P($P(^(PSALINE),"^",4),"~",3)'="" G ^PSAPROC4
"RTN","PSANDF",51,0)
 ;
"RTN","PSANDF",52,0)
ASKDRUG ;If the NDC found by searching NDF is not correct OR if the NDC can't
"RTN","PSANDF",53,0)
 ;be found, the user is asked to select the drug.
"RTN","PSANDF",54,0)
 W !!,"If the item will never be in the DRUG, press the Return key then",!,"answer YES to the ""Is this a supply item?"" prompt. To bypass this",!,"line item, enter ""^"" then press the Return key.",!
"RTN","PSANDF",55,0)
 S (PSASKIP,PSAPASS)=0,DIC("A")="Select Drug: ",DIC(0)="AEMZQ",DIC="^PSDRUG("
"RTN","PSANDF",56,0)
 D ^DIC K DIC I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSANDF",57,0)
 S PSAREA=""
"RTN","PSANDF",58,0)
 I +Y=-1 D  Q:PSASUPP  Q:PSASKIP
"RTN","PSANDF",59,0)
 .D SUPPLY Q:PSAOUT
"RTN","PSANDF",60,0)
 .I 'PSASUPP S PSASKIP=1 Q
"RTN","PSANDF",61,0)
 .S PSAIEN=0,^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")=DUZ_"^"_DT_"^"_PSAREA,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",18)="P",PSADATA=^(PSALINE)
"RTN","PSANDF",62,0)
 S PSAIEN=+Y K ^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")
"RTN","PSANDF",63,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=+Y,$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT,PSADATA=^(PSALINE)
"RTN","PSANDF",64,0)
 D EDITDISP^PSAUTL1
"RTN","PSANDF",65,0)
 ;
"RTN","PSANDF",66,0)
CHECK I $G(PSANDC)'="" D  Q
"RTN","PSANDF",67,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,PSAFND=0
"RTN","PSANDF",68,0)
 .S PSASUB=0 F  S PSASUB=+$O(^PSDRUG(PSAIEN,1,PSASUB)) Q:'PSASUB  I $P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^")=PSANDC S PSAFND=1 Q
"RTN","PSANDF",69,0)
 .I PSAFND S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",7)=PSASUB
"RTN","PSANDF",70,0)
 ;
"RTN","PSANDF",71,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",7)="0~1"
"RTN","PSANDF",72,0)
 I $P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4),"~")="",$P($P(^(PSALINE),"^",26),"~")="" D
"RTN","PSANDF",73,0)
 .W !,"The vendor did not send a NDC or UPC for the drug. Enter the",!,"NDC if it is available. Enter the UPC if you do not know the NDC.",!
"RTN","PSANDF",74,0)
 .S DIR(0)="SA^N:NDC;U:UPC",DIR("A")="Will you enter the NDC or UPC? ",DIR("B")="N",DIR("??")="^D NDCUPC^PSANDF1" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSANDF",75,0)
 .I Y="N" D GETNDC Q:PSAOUT  S PSANDC=Y,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC
"RTN","PSANDF",76,0)
 .I Y="U" D GETUPC Q:PSAOUT  S PSANDC="S"_Y,PSAUPC=Y,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,$P(^(PSALINE),"^",26)=PSAUPC
"RTN","PSANDF",77,0)
 Q
"RTN","PSANDF",78,0)
 ;
"RTN","PSANDF",79,0)
ONE ;Display for selection if 1 drug is found for that Product Name.
"RTN","PSANDF",80,0)
 S PSAIEN50=$O(^TMP("PSANDF",$J,0))
"RTN","PSANDF",81,0)
 W !!,"The NDC has the VA Product Name of "_PSAVAPN_"."
"RTN","PSANDF",82,0)
 S DIR("A")="Is "_^TMP("PSANDF",$J,PSAIEN50)_" the drug you received",DIR(0)="Y",DIR("B")="N"
"RTN","PSANDF",83,0)
 S DIR("?",1)="Enter Yes if the drug is the one you received for this line item.",DIR("?")="Enter No if it is not the drug you received.",DIR("??")="^D NDFDRG^PSANDF1"
"RTN","PSANDF",84,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSANDF",85,0)
 I +Y S PSAIEN=+PSAIEN50,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=PSAIEN,$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT K ^TMP("PSANDF",$J) D EDITDISP^PSAUTL1 Q
"RTN","PSANDF",86,0)
 D ASKDRUG
"RTN","PSANDF",87,0)
 Q
"RTN","PSANDF",88,0)
 ;
"RTN","PSANDF",89,0)
GETNDC ;Gets NDC for selected drug.
"RTN","PSANDF",90,0)
 S DIR(0)="F^12:12",DIR("A")="NDC",DIR("?")="Enter the 12-digit National Drug Code. Do not enter dashes",DIR("??")="^D NDC^PSANDF1"
"RTN","PSANDF",91,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSANDF",92,0)
 I Y'?12N W !,"You must enter exactly twelve numbers." G GETNDC
"RTN","PSANDF",93,0)
 Q
"RTN","PSANDF",94,0)
GETUPC ;Gets UPC for selected drug.
"RTN","PSANDF",95,0)
 S DIR(0)="F^1:30",DIR("A")="UPC",DIR("?")="Enter the Universal Product Code",DIR("??")="^D UPC^PSANDF1"
"RTN","PSANDF",96,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSANDF",97,0)
 Q
"RTN","PSANDF",98,0)
SUPPLY ;Asks if item is a supply. If so, asks for supply info.
"RTN","PSANDF",99,0)
 S DIR(0)="Y",DIR("A")="Is this a supply item",DIR("?")="Enter YES if the item is not and will never be in the DRUG file",DIR("??")="^D SUP^PSANDF1" D ^DIR K DIR S PSASUPP=Y Q:$G(DIRUT)
"RTN","PSANDF",100,0)
 I 'PSASUPP S PSAPASS=1 Q
"RTN","PSANDF",101,0)
 W ! S DIR(0)="F^3:30",DIR("A",1)="Enter either a description of the item or",DIR("A")="the reason why the item is not in the DRUG file"
"RTN","PSANDF",102,0)
 S DIR("?",1)="If the item is a supply, enter the name of the supply",DIR("?")="or a reason why this item is not in the DRUG file.",DIR("??")="^D REA^PSANDF1" D ^DIR K DIR S PSAREA=Y I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1
"RTN","PSANDF",103,0)
 S:PSAREA="" PSAREA="SUPPLY ITEM"
"RTN","PSANDF",104,0)
 Q:$G(PSAVER)
"RTN","PSANDF",105,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)="",$P(^(PSALINE),"^",16)="",$P(^(PSALINE),"^",17)=""
"RTN","PSANDF",106,0)
 Q
"VER")
8.0^21.0
**END**
**END**
