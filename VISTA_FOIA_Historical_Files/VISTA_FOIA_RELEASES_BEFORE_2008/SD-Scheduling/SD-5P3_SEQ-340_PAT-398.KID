Released SD*5.3*398 SEQ #340
Extracted from mail message
**KIDS**:SD*5.3*398^

**INSTALL NAME**
SD*5.3*398
"BLD",5257,0)
SD*5.3*398^SCHEDULING^0^3050329^y
"BLD",5257,1,0)
^^1^1^3050105^
"BLD",5257,1,1,0)
BAD ADDRESS INDICATOR W/LETTERS.
"BLD",5257,4,0)
^9.64PA^^
"BLD",5257,"ABPKG")
n
"BLD",5257,"KRN",0)
^9.67PA^8989.52^19
"BLD",5257,"KRN",.4,0)
.4
"BLD",5257,"KRN",.401,0)
.401
"BLD",5257,"KRN",.402,0)
.402
"BLD",5257,"KRN",.403,0)
.403
"BLD",5257,"KRN",.5,0)
.5
"BLD",5257,"KRN",.84,0)
.84
"BLD",5257,"KRN",3.6,0)
3.6
"BLD",5257,"KRN",3.8,0)
3.8
"BLD",5257,"KRN",9.2,0)
9.2
"BLD",5257,"KRN",9.8,0)
9.8
"BLD",5257,"KRN",9.8,"NM",0)
^9.68A^11^11
"BLD",5257,"KRN",9.8,"NM",1,0)
SDC0^^0^B21843137
"BLD",5257,"KRN",9.8,"NM",2,0)
SDC1^^0^B4816918
"BLD",5257,"KRN",9.8,"NM",3,0)
SDC3^^0^B6506220
"BLD",5257,"KRN",9.8,"NM",4,0)
SDCNL^^0^B20520937
"BLD",5257,"KRN",9.8,"NM",5,0)
SDCNP1^^0^B17744899
"BLD",5257,"KRN",9.8,"NM",6,0)
SDCNP1A^^0^B27493071
"BLD",5257,"KRN",9.8,"NM",7,0)
SDL1^^0^B13310245
"BLD",5257,"KRN",9.8,"NM",8,0)
SDLT^^0^B15272019
"BLD",5257,"KRN",9.8,"NM",9,0)
SDN^^0^B23621975
"BLD",5257,"KRN",9.8,"NM",10,0)
SDN1^^0^B20411676
"BLD",5257,"KRN",9.8,"NM",11,0)
SDLTP^^0^B21425529
"BLD",5257,"KRN",9.8,"NM","B","SDC0",1)

"BLD",5257,"KRN",9.8,"NM","B","SDC1",2)

"BLD",5257,"KRN",9.8,"NM","B","SDC3",3)

"BLD",5257,"KRN",9.8,"NM","B","SDCNL",4)

"BLD",5257,"KRN",9.8,"NM","B","SDCNP1",5)

"BLD",5257,"KRN",9.8,"NM","B","SDCNP1A",6)

"BLD",5257,"KRN",9.8,"NM","B","SDL1",7)

"BLD",5257,"KRN",9.8,"NM","B","SDLT",8)

"BLD",5257,"KRN",9.8,"NM","B","SDLTP",11)

"BLD",5257,"KRN",9.8,"NM","B","SDN",9)

"BLD",5257,"KRN",9.8,"NM","B","SDN1",10)

"BLD",5257,"KRN",19,0)
19
"BLD",5257,"KRN",19.1,0)
19.1
"BLD",5257,"KRN",101,0)
101
"BLD",5257,"KRN",409.61,0)
409.61
"BLD",5257,"KRN",771,0)
771
"BLD",5257,"KRN",870,0)
870
"BLD",5257,"KRN",8989.51,0)
8989.51
"BLD",5257,"KRN",8989.52,0)
8989.52
"BLD",5257,"KRN",8994,0)
8994
"BLD",5257,"KRN","B",.4,.4)

"BLD",5257,"KRN","B",.401,.401)

"BLD",5257,"KRN","B",.402,.402)

"BLD",5257,"KRN","B",.403,.403)

"BLD",5257,"KRN","B",.5,.5)

"BLD",5257,"KRN","B",.84,.84)

"BLD",5257,"KRN","B",3.6,3.6)

"BLD",5257,"KRN","B",3.8,3.8)

"BLD",5257,"KRN","B",9.2,9.2)

"BLD",5257,"KRN","B",9.8,9.8)

"BLD",5257,"KRN","B",19,19)

"BLD",5257,"KRN","B",19.1,19.1)

"BLD",5257,"KRN","B",101,101)

"BLD",5257,"KRN","B",409.61,409.61)

"BLD",5257,"KRN","B",771,771)

"BLD",5257,"KRN","B",870,870)

"BLD",5257,"KRN","B",8989.51,8989.51)

"BLD",5257,"KRN","B",8989.52,8989.52)

"BLD",5257,"KRN","B",8994,8994)

"BLD",5257,"QUES",0)
^9.62^^
"BLD",5257,"REQB",0)
^9.611^4^4
"BLD",5257,"REQB",1,0)
SD*5.3*340^1
"BLD",5257,"REQB",2,0)
SD*5.3*407^1
"BLD",5257,"REQB",3,0)
SD*5.3*379^1
"BLD",5257,"REQB",4,0)
SD*5.3*356^1
"BLD",5257,"REQB","B","SD*5.3*340",1)

"BLD",5257,"REQB","B","SD*5.3*356",4)

"BLD",5257,"REQB","B","SD*5.3*379",3)

"BLD",5257,"REQB","B","SD*5.3*407",2)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2941102
"PKG",16,22,1,"PAH",1,0)
398^3050329^123456876
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^3050329
"PKG",16,22,1,"PAH",1,1,1,0)
BAD ADDRESS INDICATOR W/LETTERS.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","SDC0")
0^1^B21843137
"RTN","SDC0",1,0)
SDC0 ;MAN/GRR,ALB/TMP/LDB - Continuation of SDC (cancel a clinic) ; 16 JUL 2003  1:27 pm
"RTN","SDC0",2,0)
 ;;5.3;Scheduling;**303,330,379,398**;Aug 13, 1993
"RTN","SDC0",3,0)
CHKEND G:NOAP END
"RTN","SDC0",4,0)
 S %=1,DTOUT=0 W !,"WANT TO AUTO-REBOOK APPOINTMENTS NOW" D YN^DICN I '% W !,"REPLY YES (Y) OR NO (N)" G CHKEND
"RTN","SDC0",5,0)
 S ANS=$S('(%-1):"Y",1:"N") I %<0 W " NO" Q:'DTOUT
"RTN","SDC0",6,0)
ASKL S SDLT1="",%=1,(SDLET,SDFORM)="" W !,"WANT LETTERS PRINTED NOW" D YN^DICN I '% W !,"REPLY YES (Y) OR NO (N)" G ASKL
"RTN","SDC0",7,0)
 W:%<0 " NO" S ALS=$S('(%-1):"Y",1:"N") G:ALS'["Y" AOR
"RTN","SDC0",8,0)
EN Q:($P(^SC(SC,0),"^",3)'="C")!($D(SDVAUTC(+SC)))  S SDIV=$P(^SC(SC,0),"^",15),SDIV=$S(SDIV:SDIV,1:$O(^DG(40.8,0))) I $D(SDLT),SDIV'=SDV1 Q
"RTN","SDC0",9,0)
 K SDRE,SDIN I $D(SDLT)&($D(^SC(SC,"I"))) S SDIN=+^("I"),SDRE=+$P(^("I"),"^",2) I $D(SDIN),SDIN,SDIN'>SDBD&('$D(SDRE)!('SDRE)!(SDRE>SDED)) Q
"RTN","SDC0",10,0)
 S:'SDLT1 SDLET=$S($D(^SC(SC,"LTR")):$P(^("LTR"),"^",3),1:"") S ALS=$S(SDLET:"Y",1:"N")
"RTN","SDC0",11,0)
 I ALS="N"!(ANS="Y") S SDFFFF=1
"RTN","SDC0",12,0)
 I ALS="N" W !,"NO LETTERS ARE ASSIGNED TO THE ",$P(^SC(SC,0),"^")," CLINIC" Q:$D(SDLT)
"RTN","SDC0",13,0)
 I SDFORM="",$D(^DG(40.8,SDIV,"LTR")),^("LTR") S SDFORM=^("LTR")
"RTN","SDC0",14,0)
 I $D(SDLT),(ALS'="N") D CHK Q
"RTN","SDC0",15,0)
 Q:$D(SDLT)
"RTN","SDC0",16,0)
AOR G:ANS'["Y"&(ALS'["Y") END
"RTN","SDC0",17,0)
 I '$D(SDLT) S DGPGM="START^SDC0",DGVAR="SC^SI^CDATE^ALS^ANS^SDLET^SDTIME"_$S($D(SDIN):"^SDIN^SDRE",1:"")_"^SDFORM^SDV1^SDFFFF"
"RTN","SDC0",18,0)
 I '$D(SDLT) D FZIS^DGUTQ G:POP END
"RTN","SDC0",19,0)
START U IO I ANS'["Y"&('$D(SDLT)) D:ALS["Y" APP D END Q
"RTN","SDC0",20,0)
BEG1 N SDFIRST
"RTN","SDC0",21,0)
 I $D(SDLT) S SDAR=$S('VAUTC:"VAUTC",1:"^SC"),ANS="N",ALS="Y" D
"RTN","SDC0",22,0)
 .F SC=0:0 S SC=$O(@(SDAR_"("_SC_")")) Q:SC'>0  D
"RTN","SDC0",23,0)
 ..K SDOK1 D EN I $D(SDOK1),SDLET D
"RTN","SDC0",24,0)
 ...F SD=(SDBD-.1):0 S SD=$O(^SC(SC,"S",SD)) S CDATE=SD Q:SD>(SDED+.999999)!(SD'>0)  D
"RTN","SDC0",25,0)
 ....D DUP
"RTN","SDC0",26,0)
 S SDFIRST=$S($G(SDFFFF)=1:0,1:1)
"RTN","SDC0",27,0)
 I $D(SDLT),$D(^UTILITY("SDLT",$J)) D PR^SDC3,END Q
"RTN","SDC0",28,0)
 Q:$D(SDLT)  D ^SDAUT1
"RTN","SDC0",29,0)
 I MAX=0 W !,"AUTO-REBOOKING NOT ALLOWED FOR THIS CLINIC" G APP:ALS["Y",END
"RTN","SDC0",30,0)
 F GDATE=CDATE:0 S GDATE=$O(^SC(SC,"S",GDATE)) Q:GDATE=""!(GDATE>(CDATE+1))  F L=0:0 S L=$O(^SC(SC,"S",GDATE,1,L)) Q:L=""  S A=^(L,0) I $D(^DPT(+A,"S",GDATE,0)),$P(^(0),"^",2)="C",$P(^(0),"^",14)=SDTIME D ^SDAUT2,^SDCCP
"RTN","SDC0",31,0)
 D:ALS["Y" APP
"RTN","SDC0",32,0)
END K %,%DT,%H,%I,%DT,%IS,%ZIS,A,ALS,ANS,BY,CDATE,CHAR,DA,DFN,DH,DHD,DIC,DIS,DO,DOW,FLDS,FR,GDATE,I,L,LET,MAX,NOAP,P,POP,SI,SL,SS,ST,SDSTRTDT,TO,X,Y,ADDR,B,CLIN,HX,L0,L1,L2,LL,PDAT,S,TIME,Z,D,ENDATE,J,SM,STIME,X1,X2,SDX1,SDX2,SDRE,SDRE1,SDIN,FSW
"RTN","SDC0",33,0)
 K ^TMP("SDC0",$J),SDAP,SDAPNUM
"RTN","SDC0",34,0)
 K SC,SD,Z0,Z5,DGPGM,DUPE,J2,MESS,NDATE,SDDIF,SDFORM,SDINP,SDFORM,SDLET,SDLT1,SDNODE,SDRT,SDSOH,SDST,SDV1,DGVAR,SD1,SD8,SD81,SDANS,SDCNT,SDERR,SDHTO,SDJ,SDTIME,SDZ,STARTDAY,SD82,SDOK,SDOK1,SDLE,SDZ,SDOK1,TST,W,^UTILITY("SD")
"RTN","SDC0",35,0)
 K SDFFFF,DIW,DIWF,DIWL,DIWR,DIWT,DN,DUPE,J2,MESS,NDATE,SDADD,SDC,SDCL,SDDAT,SDDIF,SDFORM,SDHX,SDINP,SDIV,SDLET,SDNODE,SDRT,SDSOH,SDST,SDT0,TST,SDV1,^TMP($J,"BADADD") D CLOSE^DGUTQ Q
"RTN","SDC0",36,0)
CHK K SDOK1 I $D(^SC(SC,"SL")) S SL=^("SL"),%=$P(SL,"^",6),SI=$S(%="":4,%<3:4,%:%,1:4) S SDOK1=1 K SL,% E  W $P(^SC(SC,0),"^")," does not have an appointment length indicated."
"RTN","SDC0",37,0)
 Q
"RTN","SDC0",38,0)
 ;
"RTN","SDC0",39,0)
DUP ;SCREEN FOR DUPLICATE PATIENTS - SD*5.3*379
"RTN","SDC0",40,0)
 S SDAP="" F  S SDAP=$O(^SC(SC,"S",SD,SDAP)) Q:SDAP=""  D
"RTN","SDC0",41,0)
 .S SDAPNUM="" F  S SDAPNUM=$O(^SC(SC,"S",SD,SDAP,SDAPNUM)) Q:SDAPNUM=""  D
"RTN","SDC0",42,0)
 ..I $D(^SC(SC,"S",SD,SDAP,SDAPNUM,0)) D
"RTN","SDC0",43,0)
 ...S A=$P(^SC(SC,"S",SD,SDAP,SDAPNUM,0),"^",1)
"RTN","SDC0",44,0)
 ...I '$D(^TMP("SDC0",$J,SD,A)) S ^TMP("SDC0",$J,SD,A)="" D ^SDC3
"RTN","SDC0",45,0)
 Q
"RTN","SDC0",46,0)
APP I $G(SDFFFF)=1 S SDFIRST=0
"RTN","SDC0",47,0)
 F GDATE=CDATE:0 S GDATE=$O(^SC(+SC,"S",GDATE)) Q:GDATE=""!(GDATE>(CDATE+1))  F L=0:0 S L=$O(^SC(+SC,"S",GDATE,1,L)) Q:L=""  S A=^(L,0) D CHECK
"RTN","SDC0",48,0)
 I $D(^TMP($J,"BADADD")) D BADADD^SDLT K ^TMP($J,"BADADD")
"RTN","SDC0",49,0)
 Q
"RTN","SDC0",50,0)
CHK1 S (SDX,X)=GDATE D WRAPP^SDLT
"RTN","SDC0",51,0)
 I $P(S,"^",2)'["A" D REST^SDLT Q
"RTN","SDC0",52,0)
 S SDX=$P(S,"^",10) I '$D(^DPT(+A,"S",SDX,0)) D REST^SDLT Q
"RTN","SDC0",53,0)
 W !!,"The cancelled appointment(s) were rescheduled as follows:",!
"RTN","SDC0",54,0)
 S S=^DPT(+A,"S",SDX,0) D WRAPP^SDLT,REST^SDLT
"RTN","SDC0",55,0)
 Q
"RTN","SDC0",56,0)
CHECK I $$BADADR^DGUTL3(+A) S ^TMP($J,"BADADD",$P(^DPT(+A,0),"^"),+A)="" Q
"RTN","SDC0",57,0)
 ;
"RTN","SDC0",58,0)
 ;SCREEN FOR DUPLICATES - SD*5.3*379
"RTN","SDC0",59,0)
 ;
"RTN","SDC0",60,0)
 I $D(^TMP("SDC0",$J,GDATE,A)) Q
"RTN","SDC0",61,0)
 S ^TMP("SDC0",$J,GDATE,A)=""
"RTN","SDC0",62,0)
 I $S('$D(^DPT(+A,.35)):1,$P(^DPT(+A,.35),"^",1)']"":1,1:0),$D(^DPT(+A,"S",GDATE)),$P(^DPT(+A,"S",GDATE,0),"^",2)["C",$P(^(0),"^",14)=SDTIME!(SDTIME="*") S S=^DPT(+A,"S",GDATE,0) D ^SDLT,CHK1
"RTN","SDC1")
0^2^B4816918
"RTN","SDC1",1,0)
SDC1 ;ALB/GRR - PRINT CLINIC PRE-CANCELLATION LIST ;15NOV85
"RTN","SDC1",2,0)
 ;;5.3;Scheduling;**379,398**;Aug 13, 1993
"RTN","SDC1",3,0)
 K ^TMP("SDC1",$J) S DGVAR="SD^SC^SDTIME",DGPGM="START^SDC1" D ZIS^DGUTQ Q:POP
"RTN","SDC1",4,0)
START U IO S SDCNT=0 K DUOUT,DTOUT N SDBADD S SDBADD=0
"RTN","SDC1",5,0)
 F J=SD:0 S J=$O(^SC(SC,"S",J)) Q:J=""!(J\1-SD)!$D(DTOUT)!$D(DUOUT)  F J2=0:0 S J2=$O(^SC(SC,"S",J,1,J2)) Q:J2=""  S DFN=+^(J2,0),SDLE=$P(^(0),U,2) I $D(^DPT(DFN,"S",J,0)),$P(^(0),U,2)'["C"!($P(^(0),U,14)=SDTIME) D PLST Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDC1",6,0)
 Q:$D(DUOUT)!$D(DTOUT)  I SDCNT=0 S NOAP=1 W !,"NO APPOINTMENTS SCHEDULED"
"RTN","SDC1",7,0)
 I SDBADD D
"RTN","SDC1",8,0)
 . W !!,"* THIS PATIENT HAS BEEN FLAGGED WITH A BAD ADDRESS INDICATOR, NO LETTER"
"RTN","SDC1",9,0)
 . W !,"WILL BE PRINTED."
"RTN","SDC1",10,0)
 I $E(IOST,1,2)'="C-" W @IOF
"RTN","SDC1",11,0)
 K DUOUT,DTOUT,^TMP("SDC1",$J) W !! D CLOSE^DGUTQ Q
"RTN","SDC1",12,0)
PLST I SDCNT=0!($Y+2>IOSL) S DIR(0)="E" D:$E(IOST,1,2)="C-" ^DIR K DIR Q:$D(DTOUT)!$D(DUOUT)  D HED
"RTN","SDC1",13,0)
 ;
"RTN","SDC1",14,0)
 ;CHECK FOR DUPICATE ENTRY IN FILE 44 - SD*5.3*379
"RTN","SDC1",15,0)
 ;
"RTN","SDC1",16,0)
 I $D(^TMP("SDC1",$J,J,DFN)) Q
"RTN","SDC1",17,0)
 S ^TMP("SDC1",$J,J,DFN)=""
"RTN","SDC1",18,0)
 ;
"RTN","SDC1",19,0)
 N VA D PID^VADPT6
"RTN","SDC1",20,0)
 W ! I $$BADADR^DGUTL3(+DFN) W "*" S SDBADD=1
"RTN","SDC1",21,0)
 W $P(^DPT(DFN,0),"^",1),?30,VA("PID") S X=J D TM^SDROUT0 W ?43,$J(X,8),?58,SDLE W:$D(^DPT(DFN,.13)) ?64,$P(^(.13),"^",1)
"RTN","SDC1",22,0)
 S SDCNT=SDCNT+1 Q
"RTN","SDC1",23,0)
HED W @IOF,!,$P(^SC(SC,0),"^",1)," Clinic Pre-cancellation list",!,"PATIENT NAME",?34,"ID",?43,"APPT TIME",?56,"LENGTH",?64,"TELEPHONE"
"RTN","SDC1",24,0)
 W ! F I=1:1:79 W "-"
"RTN","SDC1",25,0)
 Q
"RTN","SDC3")
0^3^B6506220
"RTN","SDC3",1,0)
SDC3 ;ALB/LDB - CANCELLATION LETTERS; 23-DEC-88@12:30
"RTN","SDC3",2,0)
 ;;5.3;Scheduling;**330,340,398**;Aug 13, 1993
"RTN","SDC3",3,0)
EN N SDBAD F L1=0:0 S L1=$O(^SC(+SC,"S",SD,1,L1)) Q:L1'>0  S A=+^(L1,0) D CHECK,SET:$D(SDOK)
"RTN","SDC3",4,0)
 Q
"RTN","SDC3",5,0)
CHECK K SDOK I $S('$D(^DPT(+A,.35)):1,$P(^DPT(+A,.35),"^",1)']"":1,1:0),$D(^DPT(+A,"S",SD)),$P(^DPT(+A,"S",SD,0),"^",2)="C"!($P(^(0),"^",2)="CA") S SDOK=1
"RTN","SDC3",6,0)
 D B I SDBAD K SDOK
"RTN","SDC3",7,0)
 Q
"RTN","SDC3",8,0)
SET S ^UTILITY("SDLT",$J,+SDLET,+A,SD,+SC)="" I $P(^DPT(+A,"S",SD,0),"^",2)="CA"&($P(^(0),"^",10)]"") S SD8=$P(^(0),"^",10) I $D(^DPT(+A,"S",SD8,0)),$P(^(0),"^",2)'["C" S ^UTILITY("SDLT",$J,+SDLET,"A",+A,SD8,+SC)=""
"RTN","SDC3",9,0)
 Q
"RTN","SDC3",10,0)
PR F SD1=0:0 S SD1=$O(^UTILITY("SDLT",$J,SD1)) Q:SD1=""  S SDLET=SD1 D PR0
"RTN","SDC3",11,0)
 I $D(^TMP($J,"BADADD")) D BADADD^SDLT K ^TMP($J,"BADADD")
"RTN","SDC3",12,0)
 Q
"RTN","SDC3",13,0)
PR0 S S81=0 F SD8=0:0 D:SD8'=S81 PR1 S S81=SD8,SD8=$O(^UTILITY("SDLT",$J,SD1,SD8)) Q:SD8'>0  S A=SD8 D B Q:SDBAD  D ^SDLT F S82=0:0 S S82=$O(^UTILITY("SDLT",$J,SD1,SD8,S82)) Q:S82'>0  S SDC=$O(^(S82,-1)),SDX=S82,S=^DPT(+A,"S",S82,0) D WRAPP^SDLT
"RTN","SDC3",14,0)
 K SD8,S81,S82
"RTN","SDC3",15,0)
 Q
"RTN","SDC3",16,0)
PR1 I $D(^UTILITY("SDLT",$J,SD1,"A",SD8)),A=SD8 W !!,"The cancelled appointments have been rescheduled as follows:",! D PR2
"RTN","SDC3",17,0)
 D REST^SDLT Q
"RTN","SDC3",18,0)
PR2 F SD82=0:0 S SD82=$O(^UTILITY("SDLT",$J,SD1,"A",SD8,SD82)),SDX=SD82 Q:SD82'>0  S SC=$O(^(SD82,-1)),S=^DPT(+A,"S",SD82,0) D WRAPP^SDLT
"RTN","SDC3",19,0)
 K SD82
"RTN","SDC3",20,0)
 Q
"RTN","SDC3",21,0)
 ;CHECK FOR BAD ADDRESS
"RTN","SDC3",22,0)
B S SDBAD=$$BADADR^DGUTL3(+A)
"RTN","SDC3",23,0)
 S:SDBAD ^TMP($J,"BADADD",$P(^DPT(+A,0),"^"),+A)=""
"RTN","SDC3",24,0)
 Q
"RTN","SDCNL")
0^4^B20520937
"RTN","SDCNL",1,0)
SDCNL ;ALB/LDB - CANCELLED APPOINTMENT LETTER ; 25 MAR 88@13:00
"RTN","SDCNL",2,0)
 ;;5.3;Scheduling;**330,340,407,398**;Aug 13, 1993
"RTN","SDCNL",3,0)
 N SDBAD S (SDOK,SDV)=0 I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2) S SDV=1
"RTN","SDCNL",4,0)
 G:"Cc"[S1 ASDCN
"RTN","SDCNL",5,0)
PT S (SDPT,SDINP)=0 F B=0:0 S SDPT=$O(VAUTN(SDPT)) Q:SDPT=""  D
"RTN","SDCNL",6,0)
 .S SDBAD=$$BADADR^DGUTL3(SDPT) I SDBAD S ^TMP($J,"BADADD",$P(^DPT(+SDPT,0),"^"),+SDPT)="" Q
"RTN","SDCNL",7,0)
 .W:$D(^DPT(SDPT,.1)) !,$P(^DPT(SDPT,0),"^")," ",$P(^(0),"^",9)," is currently an inpatient!" S:$D(^DPT(SDPT,.1)) SDINP=1 D:'SDINP START S SDINP=0
"RTN","SDCNL",8,0)
 D:$O(^UTILITY($J,0)) PR Q
"RTN","SDCNL",9,0)
START F SDX=SDBD:0 S SDX=$O(^DPT(SDPT,"S",SDX)) Q:SDX>(SDED+.9999)!(SDX'>0)  S SDAP=^DPT(SDPT,"S",SDX,0),SDV2=0 I $P(SDAP,"^",2)["C" D MDIV I SDV2!'SDV S SDC=+SDAP D CHK1 I 'SDOK D CHK
"RTN","SDCNL",10,0)
 Q
"RTN","SDCNL",11,0)
PR N SDFIRST S SDFIRST=1
"RTN","SDCNL",12,0)
 S SDLET="" F A0=0:0 S SDLET=$O(^UTILITY($J,SDLET)) Q:'SDLET  S (B0,X7)="" F A1=0:0 S A5=B0,B0=$O(^UTILITY($J,SDLET,B0)) D:B0="" R Q:B0=""  D R:A5&(B0'=A5) S A=B0 D ^SDLT F A2=0:0 S X7=$O(^UTILITY($J,SDLET,B0,X7)) Q:X7=""  D S,WRAPP^SDLT
"RTN","SDCNL",13,0)
 I $D(^UTILITY($J,"NO")) D NO W:$D(DUZ) !!,"Printed by: ",$P(^VA(200,DUZ,0),"^")
"RTN","SDCNL",14,0)
 I $D(^TMP($J,"BADADD")) D BADADD^SDLT K ^TMP($J,"BADADD")
"RTN","SDCNL",15,0)
 D END
"RTN","SDCNL",16,0)
 Q
"RTN","SDCNL",17,0)
END D END^SDN1 K ^UTILITY($J),A0,A1,A3,A5,ALL,B0,SDA,SDINP,SDOK,SDS,SDV,SDV21,SDX,SDX1,SDX8,Z0,Z5,ZTSK,SDAP,X7,DIC,DGPGM,DGVAR,SDPT
"RTN","SDCNL",18,0)
 K BEGDATE,DTOUT,DUOUT,ENDDATE,SDBD,SDBD1,SDCP,SDED,SDLET,SDLET1,SDV,SDV2,X8,Y Q
"RTN","SDCNL",19,0)
MDIV S SDAP=^DPT(SDPT,"S",SDX,0),SDV=$P(^SC(+SDAP,0),"^",15) I SDV=SDV1 S SDV2=1 Q
"RTN","SDCNL",20,0)
 Q
"RTN","SDCNL",21,0)
CAN S SDAP=^DPT(SDPT,"S",SDX,0),SDC=+SDAP
"RTN","SDCNL",22,0)
 S SDLET="" I $D(^SC(SDC,"LTR")),'SDLT1 S SDLET=$S('SD9:$P(^("LTR"),"^",4),1:$P(^("LTR"),"^",3))
"RTN","SDCNL",23,0)
 I 'SDLET&'SDLT1 S ^UTILITY($J,"NO",SDPT,SDC,SDX)=""
"RTN","SDCNL",24,0)
 S SDAP=^DPT(SDPT,"S",SDX,0) I SDLET!SDLT1 S ^UTILITY($J,$S(SDLET:SDLET,1:SDLT1),SDPT,SDX)=SDC
"RTN","SDCNL",25,0)
 I (SDLET!SDLT1),$P(SDAP,"^",10),$D(^DPT(SDPT,"S",$P(SDAP,"^",10))),$P(^DPT(SDPT,"S",$P(SDAP,"^",10),0),"^",2)'["C" S ^UTILITY($J,$S(SDLET:SDLET,1:SDLT1),SDPT,SDX)=$P(SDAP,"^")_"^"_$P(SDAP,"^",10)
"RTN","SDCNL",26,0)
 Q
"RTN","SDCNL",27,0)
ASDCN I 'VAUTC S SDC=0 F Z=0:0 S SDC=$O(VAUTC(SDC)) Q:SDC=""  S SDAP=SDC D ASDCN1
"RTN","SDCNL",28,0)
 G:'VAUTC PR
"RTN","SDCNL",29,0)
 I VAUTC S SDC=0 F Z=0:0 S SDC=$O(^SC(SDC)) Q:'SDC  I $P(^SC(SDC,0),"^",3)="C",$S($P(^(0),"^",15)=SDV1:1,'$P(^(0),"^",15):1,1:0),'$D(SDVAUTC(SDC)) S SDAP=SDC D ASDCN1
"RTN","SDCNL",30,0)
 G:VAUTC PR
"RTN","SDCNL",31,0)
ASDCN1 S SDX=SDBD F W=0:0 S SDX=$O(^DPT("ASDCN",SDC,SDX)) Q:(SDX>(SDED+.9))!(SDX="")  S SDPT=0 F T=0:0 S SDPT=$O(^DPT("ASDCN",SDC,SDX,SDPT)) Q:SDPT=""  I $D(^DPT(SDPT,"S",SDX,0)),$P(^(0),"^")=SDC,'$D(^DPT(SDPT,.1)) D CHK1 D:'SDOK CHK
"RTN","SDCNL",32,0)
 Q
"RTN","SDCNL",33,0)
R S SDR=0,SDX8="",SDA=A5
"RTN","SDCNL",34,0)
 F A3=0:0 S SDX8=$O(^UTILITY($J,SDLET,A5,SDX8)) Q:SDX8=""  I ^(SDX8),$P(^(SDX8),"^",2) S SDX=$P(^(SDX8),"^",2),SDC=$P(^(SDX8),"^"),(DFN,A)=A5,SDS=^DPT(DFN,"S",SDX,0) W:'SDR !!,"The rescheduled appointment(s) follow:",! D WRAPP^SDLT S SDR=1
"RTN","SDCNL",35,0)
 D REST^SDLT Q
"RTN","SDCNL",36,0)
S S A=B0,SDX=X7,SDS=^DPT(A,"S",SDX,0),SDC=+^(0) Q
"RTN","SDCNL",37,0)
NO W @IOF S SDPT=""
"RTN","SDCNL",38,0)
 F A3=0:0 S SDPT=$O(^UTILITY($J,"NO",SDPT)) Q:SDPT=""  S SDC="" F A4=0:0 S SDC=$O(^UTILITY($J,"NO",SDPT,SDC)) Q:SDC=""  D NOAP S SDAP="" F A5=0:0 S SDAP=$O(^UTILITY($J,"NO",SDPT,SDC,SDAP)) D:SDAP="" NOAP2 Q:SDAP=""  W ! D NOAP1
"RTN","SDCNL",39,0)
 Q
"RTN","SDCNL",40,0)
NOAP W !!,$P(^DPT(SDPT,0),"^")," ",$P(^(0),"^",9),!,"has the following cancelled appointment(s) in ",$P(^SC(SDC,0),"^")," CLINIC" Q
"RTN","SDCNL",41,0)
NOAP1 S Y=SDAP D DT^DIQ Q
"RTN","SDCNL",42,0)
NOAP2 W !,"but no letter is assigned to the clinic" Q
"RTN","SDCNL",43,0)
 S Y=SDAP D DT^DIQ W ! Q
"RTN","SDCNL",44,0)
 Q
"RTN","SDCNL",45,0)
CHK S DFN=SDPT D DEM^VADPT I VADM(6) D KVAR^VADPT Q
"RTN","SDCNL",46,0)
 S SDBAD=$$BADADR^DGUTL3(SDPT) I SDBAD S ^TMP($J,"BADADD",$P(^DPT(+SDPT,0),"^"),+SDPT)="" Q
"RTN","SDCNL",47,0)
 D CAN:$D(^DPT("ASDCN",SDC,SDX,SDPT)),KVAR^VADPT Q
"RTN","SDCNL",48,0)
CHK1 S SDOK=0 I '$D(^SC(+SDAP,"S",SDX)) Q
"RTN","SDCNL",49,0)
 I $D(^SC(+SDAP,"S",SDX)) F P=0:0 S P=$O(^SC(+SDAP,"S",SDX,1,P)) Q:P'>0  I $P(^(P,0),"^")=SDPT S SDOK=1
"RTN","SDCNL",50,0)
 Q
"RTN","SDCNP1")
0^5^B17744899
"RTN","SDCNP1",1,0)
SDCNP1 ;ALB/LDB - CANCEL APPOINTMENT (cont.) ; 14 MAR 88@13:00
"RTN","SDCNP1",2,0)
 ;;5.3;Scheduling;**398**;Aug 13, 1993
"RTN","SDCNP1",3,0)
NOPE W !,*7,$S(CNT:CNT_" Appointment"_$S(CNT>1:"s",1:"")_" cancelled",1:"NOTHING CANCELLED")
"RTN","SDCNP1",4,0)
 S SDCNT=CNT,SDA=1,SDCNT1=0 I CNT,$S('$D(^DPT(DFN,.35)):1,'$P(^(.35),U):1,1:0) S (SDA,X8)=0 D ASK G:X8="^" END
"RTN","SDCNP1",5,0)
 I SDA,SDCNT W !,*7,"NO AUTO-REBOOKING --Patient has died."
"RTN","SDCNP1",6,0)
 I 'SDA,SDCNT S A=DFN D LOOP1^SDCNP1A,LET
"RTN","SDCNP1",7,0)
END K:'$D(DIROUT) DFN D END^SDCNP Q:$D(DIROUT)  G RD^SDCNP
"RTN","SDCNP1",8,0)
ASK S (SDCTR,SDCTRL)=0,%=2 W !!,"DO YOU WISH TO REBOOK ANY APPOINTMENT(S) THAT YOU HAVE CANCELLED" D YN^DICN D:'% REASK G:'% ASK I %-1 S CNT=0 S:%<0 X8="^" Q
"RTN","SDCNP1",9,0)
 W !!,"PLEASE NOTE THAT YOU MUST ENTER A DEVICE TO AUTO-REBOOK",!
"RTN","SDCNP1",10,0)
ZIS S %ZIS("A")="DEVICE TO OUTPUT REBOOKED APPT(S). :",%ZIS="QN" D ^%ZIS I POP S X8="^" Q
"RTN","SDCNP1",11,0)
 F L=0:0 S L=$N(^UTILITY($J,"SDCNP",L)) Q:L<0  I $P(^(L),U,4)="*** JUST CANCELLED ***" S ^UTILITY($J,"SDCNP1",DFN,$P(^(L),"^",2),$P(^(L),"^"))=^(L)
"RTN","SDCNP1",12,0)
 D SDLST
"RTN","SDCNP1",13,0)
LST F B=0:0 S B=$N(^UTILITY($J,"SDCNP2",DFN,B)) Q:B<0  W !!,$J($S(B\1=B:"("_$J(B,2)_") ",1:""),5) S AT=$S($P(^(B),"^",2)'?.N:1,1:0),Y=$P($P(^(B),"^"),".") D DT^SDM0 S X=$P(^(B),"^") X ^DD("FUNC",2,1) W " ",$J(X,8) S Z1(B)="" D MORE Q:SDCTRL
"RTN","SDCNP1",14,0)
 D WH
"RTN","SDCNP1",15,0)
 I B>0 G:SDCTRL&(A8']"") NOPE1 G:SDCTRL DEL
"RTN","SDCNP1",16,0)
 Q
"RTN","SDCNP1",17,0)
SDLST S L1=0 F Z5=0:0 S Z5=$N(^UTILITY($J,"SDCNP1",DFN,Z5)) Q:Z5'>0  F Z6=0:0 S Z7=Z6,Z6=$N(^UTILITY($J,"SDCNP1",DFN,Z5,Z6)) I Z6'>0 S L1=L1+1,^UTILITY($J,"SDCNP2",DFN,L1)=Z7_"^"_Z5_"^"_$P(^(Z7),"^",3,6) Q
"RTN","SDCNP1",18,0)
 Q
"RTN","SDCNP1",19,0)
MORE S SDCTR=SDCTR+2 I AT W ?41,$P(^UTILITY($J,"SDCNP2",B),"^",2) G OVR
"RTN","SDCNP1",20,0)
 S S5=^UTILITY($J,"SDCNP2",DFN,B) W " (",$P(S5,"^",6)," MINUTES)  ",$S($D(^SC($P(S5,"^",2),0)):$P(^(0),"^",1),1:"DELETED CLINIC"),$P(S5,"^",3) S M1=$P(^SC($P(S5,"^",2),"SDP"),"^",4) W !,?41,"Max days for rebooking= ",M1
"RTN","SDCNP1",21,0)
OVR I SDCTR>20,$N(^UTILITY($J,"SDCNP2",B))>0 S (SDCTRL,SDCTR)=0 W *7 D WH W:'SDCTRL @IOF
"RTN","SDCNP1",22,0)
 Q
"RTN","SDCNP1",23,0)
WH W !!,"SELECT APPOINTMENT(S) TO BE REBOOKED" W:B>0 " OR HIT RETURN TO CONTINUE DISPLAY" R ": ",A8:DTIME I '$T!(A8="^") S SDCTRL=1,A8="",X8="^" Q
"RTN","SDCNP1",24,0)
 I A8["?" X SDMSG G WH
"RTN","SDCNP1",25,0)
DEL S SDERR=0 F J=1:1 S SDDH=$P(A8,",",J) Q:SDDH']""  D MTCH
"RTN","SDCNP1",26,0)
 I SDERR G LST
"RTN","SDCNP1",27,0)
DEL1 S SDERR=0 F J=1:1 S SDDH=$P(A8,",",J) Q:SDDH']""  S SDDI=$P(SDDH,"-"),SDDM=$P(SDDH,"-",2) D CKK^SDCNP1A Q:SDERR  D CKK2^SDCNP1A Q:SDERR  F Z9=SDDI:1:$S(SDDM:SDDM,1:SDDI) D:SDDI REBK I 'SDDI S SDERR=1 Q
"RTN","SDCNP1",28,0)
 G:SDERR LST Q:A8["^"!(A8="")  S SDERR=0 D ^SDCNP1A Q:X8="^"
"RTN","SDCNP1",29,0)
 D:MAX QUE D NOPE1 Q
"RTN","SDCNP1",30,0)
LET S %=2 W !!,"DO YOU WISH TO PRINT LETTERS FOR THE CANCELLED APPOINTMENT(S)" D YN^DICN S ANS="Y" D:'% REASK G:'% LET Q:(%-1)
"RTN","SDCNP1",31,0)
 I $$BADADR^DGUTL3(+DFN) D  Q  ;display, don't print BAI list
"RTN","SDCNP1",32,0)
 . W *7,!,"** THIS PATIENT HAS BEEN FLAGGED WITH A BAD ADDRESS INDICATOR, NO LETTER"
"RTN","SDCNP1",33,0)
 . W !,"WILL BE PRINTED."
"RTN","SDCNP1",34,0)
 . S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1",35,0)
QUE2 S DGPGM="SDLET^SDCNP1A",DGVAR="SDCL#^DUZ^DFN^DT^A^SDWH" D ZIS^DGUTQ D:POP CLOSE^DGUTQ Q:POP  D SDLET^SDCNP1A Q
"RTN","SDCNP1",36,0)
QUE I IO'=IO(0) S DGPGM="^SDCNP2",DGVAR="SDCL#^NDATE^A^GDATE^DT^DUZ",IOP=IO,X="NOW" D Q1^DGUTQ Q
"RTN","SDCNP1",37,0)
 U IO I IO=IO(0),$E(IOST,1,2)="C-" S SDIO=1 D ^SDCNP2 Q
"RTN","SDCNP1",38,0)
NOPE1 W @IOF,!,*7,$S(SDCNT1:SDCNT1_" Appointment"_$S(SDCNT1>1:"s",1:"")_" rebooked",1:"NOTHING REBOOKED") Q
"RTN","SDCNP1",39,0)
REBK K ^UTILITY($J,"SDCNP") S ^UTILITY($J,"SDCNP2","REBK",DFN,Z9)=^UTILITY($J,"SDCNP2",DFN,Z9)
"RTN","SDCNP1",40,0)
 Q
"RTN","SDCNP1",41,0)
 F A9=SDDI,SDDM Q:'SDDM&(SDDI-A9)  I '$D(Z1(A9)) S SDERR=1 W !,*7,"There is no appointment number ",A9
"RTN","SDCNP1",42,0)
 Q
"RTN","SDCNP1",43,0)
REASK W !,"ANSWER (Y)ES OR (N)O" Q
"RTN","SDCNP1",44,0)
CLRK S $P(^DPT(DFN,"S",S,0),"^",19)=$P(SDNODE,"^",7),$P(^DPT(DFN,"S",S,0),"^",18)=$P(SDNODE,"^",6) Q
"RTN","SDCNP1",45,0)
MTCH Q:SDDH?1N.N!(SDDH?1.N1"-".N)  S SDERR=1 X SDMSG
"RTN","SDCNP1",46,0)
 Q
"RTN","SDCNP1A")
0^6^B27493071
"RTN","SDCNP1A",1,0)
SDCNP1A ;ALB/LDB - CANCEL APPT. (continued) ; 14 MAR 88@13:00
"RTN","SDCNP1A",2,0)
 ;;5.3;Scheduling;**167,340,398**;Aug 13, 1993
"RTN","SDCNP1A",3,0)
LOOP S SDCNT1=0 F SDAP=0:0 S SDAP=$O(^UTILITY($J,"SDCNP2","REBK",DFN,SDAP)) Q:SDAP'>0  S SDP1=^(SDAP),S1=$P(SDP1,"^",2),S9=$P(^SC(S1,0),"^") D SDDT Q:X8="^"  D RBK S MAX=1
"RTN","SDCNP1A",4,0)
 Q
"RTN","SDCNP1A",5,0)
SDDT W !!,"IN ",S9 D:'$D(DT) DT^SDUTL D DT S %DT="AEX",%DT("A")="START REBOOKING FROM WHAT DATE: "_D S %DT(0)=DT D ^%DT K %DT S X8=X Q:$D(DTOUT)!(X="^")  S:X8="" Y=DT G:Y<0 SDDT S SDDT=+Y\1 K X,Y,DIC S X1=SDDT,X2=DT D ^%DTC
"RTN","SDCNP1A",6,0)
 S (M8,MAX)=0,S1=$P(SDP1,"^",2),S2=$P(SDP1,"^"),M1=$S($D(^SC(S1,"SDP")):$P(^("SDP"),"^",4),1:0) D MAX G:M8 SDDT
"RTN","SDCNP1A",7,0)
 I S2>DT S X1=SDDT,X2=1 D C^%DTC S SDDT=X
"RTN","SDCNP1A",8,0)
 Q
"RTN","SDCNP1A",9,0)
MAX I X>M1 S M8=1 W !!,"Exceeds maximum number of days for rebooking in ",S9 S MAX=0
"RTN","SDCNP1A",10,0)
 Q
"RTN","SDCNP1A",11,0)
RBK S GDATE=S2,SC=S1,LEN=$P(SDP1,"^",6),A=DFN_"^"_LEN,(CDATE,DATE)=SDDT D OVR1,SDIN D ^SDAUT1 D:'MAX NRBK D:MAX ^SDAUT2,SDNP K SDIN Q
"RTN","SDCNP1A",12,0)
OVR1 N X S SL=$S($D(^SC(SC,"SL")):^("SL"),1:"") Q:'SL  S X=$P(SL,U,6),SI=$S(X="":4,X<3:4,X:X,1:4),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SDSTRTDT=$S(DT>DATE:DT,1:DATE),STIME=$S($D(^SC(SC,"SDP")):$P(^("SDP"),U,3),1:"0800"),SDSTRTDT=SDSTRTDT+2
"RTN","SDCNP1A",13,0)
 Q
"RTN","SDCNP1A",14,0)
SDIN I $D(^SC(SC,"I")) S SDIN=+^("I") Q
"RTN","SDCNP1A",15,0)
 Q
"RTN","SDCNP1A",16,0)
SDNP S SDCL(SDAP)=SC_"^"_GDATE_"^"_NDATE S:NDATE SDCNT1=SDCNT1+1 Q
"RTN","SDCNP1A",17,0)
NRBK W !,"NO REBOOKING ALLOWED FOR ",$P(^SC(SC,0),"^") Q
"RTN","SDCNP1A",18,0)
DT S X1=$P(DT,"."),X2=10 D C^%DTC S Y=X D D^DIQ S D=Y_"//" Q
"RTN","SDCNP1A",19,0)
PROT S SDPRT=0 I $D(^SC(+I,"SDPROT")),$P(^("SDPROT"),U)="Y",'$D(^SC(+I,"SDPRIV",DUZ)) W !,*7,"Appt. in ",$P(^SC(+I,0),"^")," NOT CANCELLED ",!,"Access to this clinic is restricted to only privileged users!",*7 S SDPRT=1 Q
"RTN","SDCNP1A",20,0)
 Q
"RTN","SDCNP1A",21,0)
FLEN S COV=$S($P(^DPT(DFN,"S",NDT,0),"^",11)=1:" (COLLATERAL) ",1:"") I $D(^SC(SC,"S",NDT)) F ZL=0:0 S ZL=$O(^SC(SC,"S",NDT,1,ZL)) Q:ZL'>0  I +^(ZL,0)=DFN S APL=$P(^(0),"^",2) Q
"RTN","SDCNP1A",22,0)
 Q
"RTN","SDCNP1A",23,0)
LOOP1 S SDCNT1=0 F L=0:0 S L=$O(^UTILITY($J,"SDCNP",L)) Q:L'>0  I ^(L)["JUST CANCELLED" S $P(SDCL(L),"^")=$P(^(L),"^",2),$P(SDCL(L),"^",2)=$P(^(L),"^")
"RTN","SDCNP1A",24,0)
 K ^UTILITY($J) Q
"RTN","SDCNP1A",25,0)
SDLET N NDT,GDT
"RTN","SDCNP1A",26,0)
 U IO D Q
"RTN","SDCNP1A",27,0)
 F SDP=0:0 S SDP=$O(SDCL(SDP)) Q:SDP'>0  D
"RTN","SDCNP1A",28,0)
 . S SDP1=SDCL(SDP),SDC=+SDP1,GDT=$P(SDP1,"^",2),NDT=$P(SDP1,"^",3),SDV1=$P(^SC(SDC,0),"^",15)
"RTN","SDCNP1A",29,0)
 . D B I (SDB)!(SDK) Q
"RTN","SDCNP1A",30,0)
 . S:'SDV1 SDV1=+$O(^DG(40.8,0))
"RTN","SDCNP1A",31,0)
 . D F S:SDLET ^UTILITY($J,SDLET,+A,GDT)=SDC_"^"_NDT
"RTN","SDCNP1A",32,0)
 F SDLET=0:0 S SDLET=$O(^UTILITY($J,SDLET)) Q:SDLET'>0  F B0=0:0 S A1=B0,B0=$O(^UTILITY($J,SDLET,B0)) D:'B0 R Q:'B0  D:A1&(A1'=B0) R S A=B0 D ^SDLT,APP
"RTN","SDCNP1A",33,0)
 I $D(^UTILITY($J,"NO")) W @IOF,! F SC=0:0 S SC=$O(^UTILITY($J,"NO",SC)) Q:SC'>0  W !,$P(^SC(SC,0),"^")," Clinic is not assigned a letter",!!
"RTN","SDCNP1A",34,0)
E I $D(^TMP($J,"BADADD")) D BADADD^SDLT K ^TMP($J,"BADADD") I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K ^DIR(0)
"RTN","SDCNP1A",35,0)
 ;I $G(SDB),SDB W !!,"BAD ADDRESS INDICATOR FOR THIS PATIENT. NO LETTER WILL BE PRINTED." S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1A",36,0)
 I $G(SDK),'SDK W !!,"NO LETTER CAN BE PRINTED FOR THIS PATIENT." S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1A",37,0)
 K A,SDCL D CLOSE^DGUTQ
"RTN","SDCNP1A",38,0)
Q K A1,SDFORM,SDLET,SDNDT,SDP1,SDV1,^UTILITY($J),SDB,SDK Q
"RTN","SDCNP1A",39,0)
F S SDFORM="" I $D(^DG(40.8,SDV1,"LTR")),^("LTR") S SDFORM=^("LTR")
"RTN","SDCNP1A",40,0)
 S SDLET="" I $D(^SC(SDC,"LTR")) S:SDWH["P" SDLET=$P(^("LTR"),"^",4) S:SDWH'["P" SDLET=$P(^("LTR"),"^",3)
"RTN","SDCNP1A",41,0)
 I 'SDLET S ^UTILITY($J,"NO",SDC)=""
"RTN","SDCNP1A",42,0)
 Q
"RTN","SDCNP1A",43,0)
R I $D(^UTILITY($J,"R",SDLET,A1)) W !!,"The appointment(s) have been rescheduled as follows:",! F A2=0:0 S A2=$O(^UTILITY($J,"R",SDLET,A1,A2)) Q:A2'>0  S (X,SDX)=A2,SDC=+^(A2),A=A1,SDS=^DPT(DFN,"S",SDX,0) D WRAPP^SDLT K X,SDX
"RTN","SDCNP1A",44,0)
 D REST^SDLT Q
"RTN","SDCNP1A",45,0)
APP F SDX=0:0 S SDX=$O(^UTILITY($J,SDLET,A,SDX)) Q:SDX'>0  S S=^DPT(+A,"S",SDX,0),SDC=+^(0) D WRAPP^SDLT I $P(^UTILITY($J,SDLET,A,SDX),"^",2) S ^UTILITY($J,"R",SDLET,A,$P(^UTILITY($J,SDLET,A,SDX),"^",2))=$P(^(SDX),"^")
"RTN","SDCNP1A",46,0)
 Q
"RTN","SDCNP1A",47,0)
CKK I $L(SDDI)>4!($L(SDDM)>4) S SDERR=1 W !,"There is no appointment number ",$S($L(SDDI)>5:SDDI,1:SDDM) Q
"RTN","SDCNP1A",48,0)
 Q
"RTN","SDCNP1A",49,0)
CKK1 F Z0=SDDI,SDDM Q:'SDDI!('SDDM&(SDDI-Z0))  S SDERR=0 S:$L(Z0)>5 SDERR=1 Q:SDERR  S:$L(SDDI)<5 SDDI=+SDDI S:$L(SDDM)<5 SDDM=+SDDM I $L(Z0)>5!('$D(^UTILITY($J,"SDCNP",Z0,"CNT"))) S SDERR=1 Q
"RTN","SDCNP1A",50,0)
 W:SDERR !,*7,"There is no appointment number ",Z0 H 2 Q
"RTN","SDCNP1A",51,0)
CKK2 F Z0=SDDI,SDDM Q:'SDDI!('SDDM&(SDDI-Z0))  S SDERR=0 S:$L(Z0)>5 SDERR=1 Q:SDERR  S:$L(SDDI)<5 SDDI=+SDDI S:$L(SDDM)<5 SDDM=+SDDM I $L(Z0)>5!('$D(^UTILITY($J,"SDCNP2",DFN,Z0))) S SDERR=1 Q
"RTN","SDCNP1A",52,0)
 W:SDERR !,*7,"There is no appointment number ",Z0 Q
"RTN","SDCNP1A",53,0)
B S SDB=$$BADADR^DGUTL3(+A)
"RTN","SDCNP1A",54,0)
 S:SDB ^TMP($J,"BADADD",$P(^DPT(+A,0),"^"),+A)=""
"RTN","SDCNP1A",55,0)
CHECK S SDK=0 I $S('$D(^DPT(+A,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(+A,"S",GDT,0)),$S($P(^(0),"^",2)["N":1,$D(SDCP)&$P(^(0),"^",2)["C":1,1:0),$P(^(0),"^",14)=SDTIME!(SDTIME="*"),'$D(^DPT(+A,.1)) S SDK=1
"RTN","SDCNP1A",56,0)
 Q
"RTN","SDL1")
0^7^B13310245
"RTN","SDL1",1,0)
SDL1 ;BSN/GRR,ALB/LDB - PRE-APPOINTMENT LETTERS ; 7/7/04 10:45am
"RTN","SDL1",2,0)
 ;;5.3;Scheduling;**106,330,340,407,398**;Aug 13, 1993
"RTN","SDL1",3,0)
 ;
"RTN","SDL1",4,0)
 ;******************MODIFICATIONS***********************************
"RTN","SDL1",5,0)
 ;
"RTN","SDL1",6,0)
 ;  DATE        PATCH       DEVELOPER    DESCRIPTION
"RTN","SDL1",7,0)
 ;  ----        -----       ---------    -----------
"RTN","SDL1",8,0)
 ;  12/12/2003  SD*5.3*330  JOHN LUNDEN  FIX FORM FEED LOGIC
"RTN","SDL1",9,0)
 ;
"RTN","SDL1",10,0)
 ;******************************************************************
"RTN","SDL1",11,0)
 ;
"RTN","SDL1",12,0)
 U IO N SDBAD K ^UTILITY($J) S SDLT1=SDLET G:"Pp"'[S1 BC
"RTN","SDL1",13,0)
 I $D(VAUTN) D
"RTN","SDL1",14,0)
 .F C=0:0 S C=$O(VAUTN(C)) Q:'C  S DFN=C D
"RTN","SDL1",15,0)
 ..D BAD Q:SDBAD  D DATE
"RTN","SDL1",16,0)
 D LST Q
"RTN","SDL1",17,0)
DATE F D=SDBD:0 S D=$O(^DPT(C,"S",D)) Q:'D!(D>(SDED+.9999))  I $D(^(D,0)),$P(^(0),"^",2)'["C",$S('$D(^DPT(C,.35)):1,$P(^(.35),"^",1)']"":1,1:0) S A1=C,B1=D,D1=+^DPT(C,"S",D,0) D SET
"RTN","SDL1",18,0)
 Q
"RTN","SDL1",19,0)
APP F J=0:0 S J=$O(^UTILITY($J,L,A,J)) Q:'J  S SDX=J,SDC=^(J),S=^DPT(+A,"S",J,0) D WRAPP^SDLT
"RTN","SDL1",20,0)
 D REST^SDLT Q
"RTN","SDL1",21,0)
BC S U="^" I $D(VAUTC),'VAUTC D CL G LST
"RTN","SDL1",22,0)
ALCL F C=0:0 S C=$O(^SC(C)) Q:'C  I '$D(SDVAUTC(C)),$P(^SC(C,0),U,3)="C",$S('$D(^("I")):1,'+^("I"):1,+^("I")<SDBD&('$P(^("I"),U,2)):0,+^("I")<SDBD&($P(^("I"),U,2)>SDED):0,1:1) D NCHECK I $T D D D:$D(SDD) OVER
"RTN","SDL1",23,0)
LST N SDFIRST S SDFIRST=1       ;SD*5.3*330. Flag to determine first pag
"RTN","SDL1",24,0)
 F L=0:0 S L=$O(^UTILITY($J,L)) Q:'L  D
"RTN","SDL1",25,0)
 .F A=0:0 S A=$O(^UTILITY($J,L,A)) Q:'A  D
"RTN","SDL1",26,0)
 ..S DFN=A D BAD Q:SDBAD
"RTN","SDL1",27,0)
 ..S SDLET=L D ^SDLT,APP
"RTN","SDL1",28,0)
 D NO,END,CLOSE^DGUTQ Q
"RTN","SDL1",29,0)
CL F C=0:0 S C=$O(VAUTC(C)) Q:'C  S:'SDLT1 SDLET=0 D OVER
"RTN","SDL1",30,0)
 Q
"RTN","SDL1",31,0)
OVER Q:'$D(^SC(C,"S"))
"RTN","SDL1",32,0)
 F SDT=SDBD:0 S SDT=$O(^SC(C,"S",SDT)) Q:'SDT!(SDT>(SDED+.9999))  D
"RTN","SDL1",33,0)
 .F K=0:0 S K=$O(^SC(C,"S",SDT,1,K)) Q:'K  D
"RTN","SDL1",34,0)
 ..S DFN=+^(K,0)
"RTN","SDL1",35,0)
 ..I $P(^(0),"^",9)'["C" D BAD Q:SDBAD  D CHECK
"RTN","SDL1",36,0)
 Q
"RTN","SDL1",37,0)
END W ! K %,%H,%I,%Y,%DT,%IS,%ZIS,A,B,C,D,DN,CLIN,CNN,DATE,DATEND,DFN,DIC,DIV,DOW,GDATE,SDHX,I,J,J1,K,L,L0,PDAT,S,S1,SC,SDADD,SDFORM,SDT,SDXX,TIME,X,Y,Z,Z0,Z5 Q
"RTN","SDL1",38,0)
CHECK I $S('$D(^DPT(DFN,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(DFN,"S",SDT,0)),$P(^(0),"^",2)'["C",'$D(^DPT(DFN,.1)) S A1=DFN,B1=SDT,D1=C D SET
"RTN","SDL1",39,0)
 Q
"RTN","SDL1",40,0)
SET I $D(^SC(D1,"LTR"))!(SDLT1) S:'SDLT1 SDLET=$P(^SC(D1,"LTR"),"^",2) I SDLET S ^UTILITY($J,SDLET,A1,B1)=D1 S:'SDLT1 SDLET=0 K A,A1,B1,D1 Q
"RTN","SDL1",41,0)
 I 'SDLET S ^UTILITY($J,"C",A1,D1)="" K A,A1,B1,D1 Q
"RTN","SDL1",42,0)
 Q
"RTN","SDL1",43,0)
NO I $D(VAUTN),'$O(^UTILITY($J,0)),'$D(^UTILITY($J,"C")) D
"RTN","SDL1",44,0)
 .I SDBAD Q  ;W !,"THIS PATIENT(S) HAS THE BAD ADDRESS INDICATOR SET AND PRE-APPOINTMENT LETTER(S) WILL NOT PRINT." Q
"RTN","SDL1",45,0)
 .W !,"NO ACTIVE APPOINTMENTS FOR THE PATIENT(S) DURING THAT TIME PERIOD!",*7
"RTN","SDL1",46,0)
 I $D(^UTILITY($J,"C")) W @IOF F X=0:0 S X=$O(^UTILITY($J,"C",X)) Q:'X  W !!,$P(^DPT(X,0),"^")," ",$P(^(0),"^",9)," HAS FUTURE APPTS., but" D NOCL
"RTN","SDL1",47,0)
 I $D(^TMP($J,"BADADD")) D BADADD^SDLT K ^TMP($J,"BADADD")
"RTN","SDL1",48,0)
 Q
"RTN","SDL1",49,0)
NOCL F XX=0:0 S XX=$O(^UTILITY($J,"C",X,XX)) Q:'XX  W !,$P(^SC(XX,0),"^")," Clinic is not assigned a PRE-APPOINTMENT LETTER"
"RTN","SDL1",50,0)
 Q
"RTN","SDL1",51,0)
D K SDD I ($P(^SC(C,0),"^",15)=SDV1)!(SDV1=$O(^DG(40.8,0))&($P(^SC(C,0),"^",15)="")) S SDD=1
"RTN","SDL1",52,0)
 Q
"RTN","SDL1",53,0)
NCHECK ;
"RTN","SDL1",54,0)
 N NOC S NOC=$P($G(^SC(C,0)),U,17)
"RTN","SDL1",55,0)
 I SDCONC="B" Q
"RTN","SDL1",56,0)
 I SDCONC="C"&(NOC="N") Q
"RTN","SDL1",57,0)
 I SDCONC="N"&(NOC="Y") Q
"RTN","SDL1",58,0)
 Q
"RTN","SDL1",59,0)
BAD S SDBAD=$$BADADR^DGUTL3(+DFN)
"RTN","SDL1",60,0)
 S:SDBAD ^TMP($J,"BADADD",$P(^DPT(+DFN,0),"^"),+DFN)=""
"RTN","SDL1",61,0)
 Q
"RTN","SDLT")
0^8^B15272019
"RTN","SDLT",1,0)
SDLT ;ALB/LDB - CANCELLATION LETTERS ; 14 Feb 2003
"RTN","SDLT",2,0)
 ;;5.3;Scheduling;**185,213,281,330,398**;Aug 13, 1993
"RTN","SDLT",3,0)
 ;
"RTN","SDLT",4,0)
 ;**************************************************************************
"RTN","SDLT",5,0)
 ;                          MODIFICATIONS
"RTN","SDLT",6,0)
 ;                          
"RTN","SDLT",7,0)
 ;   DATE      PATCH     DEVELOPER  DESCRIPTION OF CHANGES
"RTN","SDLT",8,0)
 ; --------  ----------  ---------  ----------------------------------------
"RTN","SDLT",9,0)
 ; 02/14/03  SD*5.3*281  SAUNDERS   Print letters to confidential address if
"RTN","SDLT",10,0)
 ;                                  requested
"RTN","SDLT",11,0)
 ; 12/2/03   SD*5.3*330  LUNDEN     Remove form feed from PRT+0
"RTN","SDLT",12,0)
 ;
"RTN","SDLT",13,0)
 ;**************************************************************************
"RTN","SDLT",14,0)
 ;
"RTN","SDLT",15,0)
 ;WRITE GREETING AND OPENING TEXT OF LETTER
"RTN","SDLT",16,0)
PRT S Y=DT D DTS^SDUTL
"RTN","SDLT",17,0)
 I +$G(SDFIRST)=0 W @IOF ;SD*5.3*330 Form feed only after letter #1
"RTN","SDLT",18,0)
 K SDFIRST
"RTN","SDLT",19,0)
 ;S SDFIRST=0
"RTN","SDLT",20,0)
 W !,?65,Y,!,?65,$$LAST4(A),!!!!
"RTN","SDLT",21,0)
 I 'SDFORM W !!!!! D ADDR W !!!!
"RTN","SDLT",22,0)
W1 W !,"Dear ",$S($P(^DPT(+A,0),"^",2)="M":"Mr. ",1:"Ms. ")
"RTN","SDLT",23,0)
 N DPTNAME
"RTN","SDLT",24,0)
 S DPTNAME("FILE")=2,DPTNAME("FIELD")=".01",DPTNAME("IENS")=(+A)_","
"RTN","SDLT",25,0)
 S X=$$NAMEFMT^XLFNAME(.DPTNAME,"G","M") W X,","
"RTN","SDLT",26,0)
 W !! K ^UTILITY($J,"W"),DIWF,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z0=0:0 S Z0=$O(^VA(407.5,SDLET,1,Z0)) Q:Z0'>0  S X=^(Z0,0) D ^DIWP
"RTN","SDLT",27,0)
 D ^DIWW K ^UTILITY($J,"W") Q
"RTN","SDLT",28,0)
WRAPP ;WRITE APPOINTMENT INFORMATION
"RTN","SDLT",29,0)
 S:$D(SC)&'$D(SDC) SDC=SC S SDCL=$P(^SC(+SDC,0),"^",1),SDCL=SDCL_" Clinic" D FORM
"RTN","SDLT",30,0)
 S SDX1=$S($D(SDX):SDX,1:X) S:$D(SDS) S=SDS F B=3,4,5 I $P(S,"^",B)]"" S SDCL=$S(B=3:"LAB",B=4:"XRAY",1:"EKG"),SDX=$P(S,"^",B) D FORM
"RTN","SDLT",31,0)
 S (SDX,X)=SDX1 Q
"RTN","SDLT",32,0)
FORM S:$D(SDX) X=SDX S SDHX=X D DW^%DTC S DOW=X,X=SDHX X ^DD("FUNC",2,1) S SDT0=X,SDDAT=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(SDHX,4,5))_" "_+$E(SDHX,6,7)_", "_(1700+$E(SDHX,1,3)) W !?4,DOW,?14,$J(SDDAT,12)
"RTN","SDLT",33,0)
 W ?27,$J(SDT0,8)," ",SDCL I $D(SDLT)&($Y>(IOSL-8)) W @IOF
"RTN","SDLT",34,0)
 Q
"RTN","SDLT",35,0)
REST ;WRITE THE REMAINDER OF LETTER
"RTN","SDLT",36,0)
 I SDLET W !?12 K ^UTILITY($J,"W"),DIWL,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z5=0:0 S Z5=$O(^VA(407.5,SDLET,2,Z5)) Q:Z5'>0  S X=^(Z5,0) D ^DIWP
"RTN","SDLT",37,0)
 D ^DIWW K ^UTILITY($J,"W") Q:'SDFORM
"RTN","SDLT",38,0)
 F I=$Y:1:IOSL-12 W !
"RTN","SDLT",39,0)
 D ADDR Q
"RTN","SDLT",40,0)
ADDR K VAHOW S DFN=+A W !?12,$$FML^DGNFUNC(DFN) S VAHOW=2
"RTN","SDLT",41,0)
 I $D(^DG(43,1,"BT")),'$P(^("BT"),"^",3) S VAPA("P")=""
"RTN","SDLT",42,0)
 S X1=DT,X2=5 D C^%DTC I '$D(VAPA("P")) S (VATEST("ADD",9),VATEST("ADD",10))=X
"RTN","SDLT",43,0)
 D ADD^VADPT D
"RTN","SDLT",44,0)
 .;CHANGE STATE TO ABBR.
"RTN","SDLT",45,0)
 .N SDIENS,X
"RTN","SDLT",46,0)
 .I $D(^UTILITY("VAPA",$J,5)) S SDIENS=+^UTILITY("VAPA",$J,5)_",",X=$$GET1^DIQ(5,SDIENS,1),$P(^UTILITY("VAPA",$J,5),U,2)=X
"RTN","SDLT",47,0)
 .K SDIENS Q
"RTN","SDLT",48,0)
 N SDCCACT1,SDCCACT2
"RTN","SDLT",49,0)
 S SDCCACT1=^UTILITY("VAPA",$J,12),SDCCACT2=$P($G(^UTILITY("VAPA",$J,22,2)),"^",3)
"RTN","SDLT",50,0)
 ;if confidential address is not active for scheduling/appointment letters, print to regular address
"RTN","SDLT",51,0)
 I ($G(SDCCACT1)=0)!($G(SDCCACT2)'="Y") D
"RTN","SDLT",52,0)
 .F LL=1:1:4 W:^UTILITY("VAPA",$J,LL)]"" !,?12,^UTILITY("VAPA",$J,LL)
"RTN","SDLT",53,0)
 .W:^UTILITY("VAPA",$J,4)']"" ! I ^UTILITY("VAPA",$J,5)]"" W ", ",$P(^UTILITY("VAPA",$J,5),"^",2)
"RTN","SDLT",54,0)
 .I ^UTILITY("VAPA",$J,11)]"" W "  ",$P(^UTILITY("VAPA",$J,11),U,2)
"RTN","SDLT",55,0)
 ;if confidential address is active for scheduling/appointment letters, print to confidential address
"RTN","SDLT",56,0)
 I $G(SDCCACT1)=1,$G(SDCCACT2)="Y" D
"RTN","SDLT",57,0)
 .F LL=13:1:16 W:^UTILITY("VAPA",$J,LL)]"" !,?12,^UTILITY("VAPA",$J,LL)
"RTN","SDLT",58,0)
 .W:^UTILITY("VAPA",$J,16)']"" ! I ^UTILITY("VAPA",$J,17)]"" W ", ",$P(^UTILITY("VAPA",$J,17),"^",2)
"RTN","SDLT",59,0)
 .I ^UTILITY("VAPA",$J,18)]"" W "  ",$P(^UTILITY("VAPA",$J,18),U,2)
"RTN","SDLT",60,0)
 W ! D KVAR^VADPT Q
"RTN","SDLT",61,0)
 ;
"RTN","SDLT",62,0)
 ;
"RTN","SDLT",63,0)
LAST4(DFN) ;Return patient "last four"
"RTN","SDLT",64,0)
 N SDX
"RTN","SDLT",65,0)
 S SDX=$G(^DPT(+DFN,0))
"RTN","SDLT",66,0)
 Q $E(SDX)_$E($P(SDX,U,9),6,9)
"RTN","SDLT",67,0)
 ;
"RTN","SDLT",68,0)
BADADD ;Print patients with a Bad Address Indicator
"RTN","SDLT",69,0)
 I '$D(^TMP($J,"BADADD")) Q
"RTN","SDLT",70,0)
 N SDHDR,SDHDR1
"RTN","SDLT",71,0)
 W @IOF,$TR($J("",IOM)," ","*")
"RTN","SDLT",72,0)
 S SDHDR="BAD ADDRESS INDICATOR LIST" W !,?(IOM-$L(SDHDR)/2),SDHDR,!
"RTN","SDLT",73,0)
 S SDHDR1="** THE LETTER FOR THESE PATIENT(S) DID NOT PRINT DUE TO A BAD ADDRESS INDICATOR."
"RTN","SDLT",74,0)
 W !,"Last 4",!,"of SSN",?10,"Patient Name",!
"RTN","SDLT",75,0)
 W $TR($J("",IOM)," ","*")
"RTN","SDLT",76,0)
 N SDNAM,SDDFN
"RTN","SDLT",77,0)
 S SDNAM="" F  S SDNAM=$O(^TMP($J,"BADADD",SDNAM)) Q:SDNAM=""  D
"RTN","SDLT",78,0)
 . S SDDFN=0 F  S SDDFN=$O(^TMP($J,"BADADD",SDNAM,SDDFN)) Q:'SDDFN  D
"RTN","SDLT",79,0)
 . . W !,$$LAST4(SDDFN),?10,SDNAM
"RTN","SDLT",80,0)
 W !!,SDHDR1
"RTN","SDLT",81,0)
 Q
"RTN","SDLTP")
0^11^B21425529
"RTN","SDLTP",1,0)
SDLTP ;ALB/LDB - PRINT SCHEDULING LETTERS ; 11/27/00 1:53pm
"RTN","SDLTP",2,0)
 ;;5.3;Scheduling;**79,106,170,80,356,398**;Aug 13, 1993
"RTN","SDLTP",3,0)
R D EXIT S SD9=0,SDLT=1,DIC=407.6,DIC(0)="AEQMZ",DIC("A")="SELECT THE TYPE OF LETTER TO PRINT: ",DIC("S")="I ""^A^C^N^P^""[(""^""_$P($G(^(0)),U)_""^"")" D ^DIC G:Y'>0 EXIT S L0=Y(0,0) K DIC,DA
"RTN","SDLTP",4,0)
R1 R !,"PRINT LETTER ASSIGNED TO THE CLINIC(S)" S %=1 D YN^DICN G:'% HELP1 G:%<0 EXIT I %=1 S SDLET=0 G DIV
"RTN","SDLTP",5,0)
R2 K DIC,X,Y S DIC=407.5,DIC("S")="I $P(^(0),""^"",2)="_""""_L0_"""",DIC(0)="AEQMZ" D ^DIC G:Y'>0 EXIT S SDLET=+Y
"RTN","SDLTP",6,0)
DIV S SDLT1=SDLET,SDV1=$O(^DG(40.8,0)) K DIC,X,Y I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2) S DIC=40.8,DIC(0)="AEQM" D @($S(L0="P":"PALST",L0="C":"CNLET",L0="N":"NSLET1",1:"PCNLET")_"^SDDIV") G:+Y<0 R S SDV1=+Y
"RTN","SDLTP",7,0)
 S VAUTD=0,VAUTD(SDV1)=$P(^DG(40.8,SDV1,0),"^"),SDFORM=0,SDTIME="*" I $D(^DG(40.8,SDV1,"LTR")),^("LTR") S SDFORM=1
"RTN","SDLTP",8,0)
L0 I L0="C" D IND G:$D(DTOUT)!(%=-1) R
"RTN","SDLTP",9,0)
 S VAUTNI=2 I "AP"[L0!(L0="C"&(SD9)) D PC G:S1=-1 R I "Pp"[S1 D PAT G R:Y<0,DATE
"RTN","SDLTP",10,0)
 S SDCONC="B" I L0="P" D NCOUNT^SDAL0 I SDCONC=U G R
"RTN","SDLTP",11,0)
 D NCLINIC^SDAL0 G:Y<0 R I VAUTC D EX G:%Y="^"!($D(DTOUT)) R I $D(X),X="^" G R
"RTN","SDLTP",12,0)
DATE N %DT I L0="P" S SDT00="AEF"
"RTN","SDLTP",13,0)
 D DATE^SDUTL G:POP&('$D(SDBD)) EXIT G:POP&(X="^") EXIT S:'$D(SDED) SDED=SDBD S L2=$S(L0="C"&('SD9):"BEG1^SDC0",L0="N":"BC^SDN1",L0="P":"^SDL1",1:"^SDCNL")
"RTN","SDLTP",14,0)
QUE S DGPGM=L2,DGVAR="SDCONC^SDLT^SDFORM^SDV1^SDLT1^SDLET^VAUTD#^SDBD^SDED"_$S($D(VAUTNALL):"^VAUTNALL",1:"")_$S($D(VAUTC):"^VAUTC#",1:"")_$S($D(VAUTN):"^VAUTN#",1:"")
"RTN","SDLTP",15,0)
 S DGVAR=DGVAR_$S(L2="^SDCNL":"^SD9",1:"^SDTIME")_$S($D(S1):"^S1",1:"")_$S($D(SDVAUTC):"^SDVAUTC#",1:"")
"RTN","SDLTP",16,0)
 D ZIS^DGUTQ G:POP EXIT
"RTN","SDLTP",17,0)
 U IO D @L2
"RTN","SDLTP",18,0)
EXIT K %,%Y,A2,BEGDATE,C,DIC,DGPGM,DGVAR,DIV,DIW,DIWF,DIWL,DIWR,DIWT,ENDDATE,ENDATE,L,LL,L0,L2,POP,S1,SD9,SDC,SDDAT,SDCL,SC,SDADD,SDARRAY,SDTADB,SDTADE,SDBD,SDCONC,SDCNT,SDD,SDED,SDHX,SDIV,SDFORM,SDLET,SDLT1,SDLT,SDMDT,SDT0,SDTIME,SDV,SDV1,SDX
"RTN","SDLTP",19,0)
 K SDX1,VAUTC,VAUTN,VAUTNI,VAUTD,SDVAUTC,X,XX,Y,W,Z0,Z5,^UTILITY("SDLT"),^UTILITY($J,"W"),^TMP($J,"BADADD") D CLOSE^DGUTQ Q
"RTN","SDLTP",20,0)
HELP W !,"LETTER TYPE MUST EXIST IN LETTERS TYPE FILE!" S DIC=407.6 K DIC("S") D ^DIC G R
"RTN","SDLTP",21,0)
HELP1 W !,"If you want to print another letter for the selected clinic(s), you must answer",!,"""N"""_" and select another letter of the appropriate type. If you do this, that ",!,"letter will print for (ALL) the selected clinic(s)." G R1
"RTN","SDLTP",22,0)
PC R !,"Enter 'P' for individual PATIENT letters or 'C' for letters by CLINIC: P// ",S1:DTIME S:S1["^"!('$T) S1=-1 Q:S1=-1  S:S1="" S1="P" I "PCpc"'[S1 W "??" D HELP2 G PC
"RTN","SDLTP",23,0)
 Q
"RTN","SDLTP",24,0)
HELP2 W !,"Entering 'P' will allow you to select PATIENT(S) and entering a 'C' will allow",!,"you to select CLINIC(S)." Q
"RTN","SDLTP",25,0)
PAT S VAUTNI=2,VAUTNALL=1 D PATIENT^VAUTOMA Q
"RTN","SDLTP",26,0)
EX S SDCNT=0 W !,"Do you want to exclude any Clinic(s)" S %=2 D YN^DICN I '% W !,"RESPOND YES OR NO" G EX
"RTN","SDLTP",27,0)
 K SDVAUTC Q:%-1
"RTN","SDLTP",28,0)
EXASK S DIC=44,DIC(0)="AEQM",DIC("S")="I $P(^(0),""^"",3)=""C"",'$G(^(""OOS""))",DIC("A")="Select Clinic to be excluded: " D ^DIC K DIC("A"),DIC("S") Q:"^"[X  G:Y<0 EXASK I $D(SDVAUTC(+Y)) W !,*7,"THIS CLINIC HAS ALREADY BEEN SELECTED!" G EXASK
"RTN","SDLTP",29,0)
 S SDCNT=SDCNT+1,SDVAUTC(+Y)="" W " ...OK" W:SDCNT'<10 !,*7,"ONLY TEN CLINICS ARE ALLOWED TO BE SELECTED!" G:SDCNT<10 EXASK
"RTN","SDLTP",30,0)
 Q
"RTN","SDLTP",31,0)
MAX W !,*7,"NO MORE THAN TEN CLINICS ALLOWED TO BE EXCLUDED" Q
"RTN","SDLTP",32,0)
IND S %=1,SD9=0 W !,"DID CLINIC CANCEL AVAILABILITY" D YN^DICN I '% D HLP3 G IND
"RTN","SDLTP",33,0)
 S:%-1 SD9=1 Q
"RTN","SDLTP",34,0)
HLP3 W !!,"If the clinic was cancelled for any length of time respond 'Y'.",!,"If individual appointments were cancelled without cancelling the clinic respond 'N'",! Q
"RTN","SDLTP",35,0)
 W !,"CLINIC CANCELLATION LETTERS will be selectable with 'C' response.",! Q
"RTN","SDN")
0^9^B23621975
"RTN","SDN",1,0)
SDN ;SF/GFT,ALB/LDB - RECORD NO SHOWS ; 05 MAR 84  1:40 pm
"RTN","SDN",2,0)
 ;;5.3;Scheduling;**32,79,398**;Aug 13, 1993
"RTN","SDN",3,0)
 N SDATA ; for evt driver
"RTN","SDN",4,0)
 S U="^" D NOW^%DTC S SDTIME=%,SDLT1="" K ^UTILITY($J),SDCP,SDLT D LO^DGUTL
"RTN","SDN",5,0)
 S SDDT=DT,SDV1=$N(^DG(40.8,0)) D DIV^SDUTL I $T S DIC=40.8,DIC(0)="AEQM" S SDLT=1 D NSLET1^SDDIV K SDLT G:Y<0 END^SDN0 S SDV1=DIV
"RTN","SDN",6,0)
7 R !!,"NO-SHOWS FOR WHAT DATE: ",X:DTIME Q:U[X  S %DT="EP",%DT(0)=-DT D ^%DT G 7:Y<0 S SDT=Y,SDYES=""
"RTN","SDN",7,0)
 S SM="S SDCT=0 F I=SD1:0:SD2 S I=$N(^DPT(+Y,""S"",I)) S:I<0!(I'<SD2) I=9999999 I I\1=SDT,$D(^(I,0)),+^(0)=SC,$P(^(0),U,2)'[""C"",'$$CODT^SDCOU(+Y,I,SC) Q"
"RTN","SDN",8,0)
 S SM1="S SDCT=0 F I=SD1:0 S I=$N(^DPT(+Y,""S"",I)) Q:I<0!(I'<SD2)  I I\1=SDT,$D(^(I,0)),+^(0)=SC,$P(^(0),""^"",2)'[""C"",'$$CODT^SDCOU(+Y,I,SC) S SDCT=SDCT+1,SDT(SDCT)=I"
"RTN","SDN",9,0)
71 W ! K DIC S SC=0,DIC="^SC(",DIC(0)="AEMQ",DIC("A")="Select CLINIC NAME: ",DIC("S")="I $P(^(0),""^"",3)=""C"",'$G(^(""OOS"")),$S($P(^(0),""^"",15)=SDV1:1,'$P(^(0),""^"",15):1,'SDV1:1,1:0)"
"RTN","SDN",10,0)
 D ^DIC K DIC("A"),DIC("S") G 73:Y<0 S SC=+Y,SD1=SDT,SD2=SDT+1 S SDMSG=" DOES NOT HAVE A NO-SHOW LETTER ASSIGNED TO IT!"
"RTN","SDN",11,0)
72 Q:$D(SDNSACT)  S SD1=SDT,DIC="^DPT(",DIC(0)="AEMQ",DIC("S")=SM
"RTN","SDN",12,0)
 K SDT S SDT=SD1
"RTN","SDN",13,0)
 D ^DIC K DIC("S") G 71:"^"[X,72:Y<0 S DFN=+Y X SM1 D SDMLT Q:'SDCT  S I=SDT(SDCT)
"RTN","SDN",14,0)
EN1 ; -- entry pt for protocol action
"RTN","SDN",15,0)
 S SDSTAT=$P(^DPT(+DFN,"S",I,0),U,2) I SDSTAT="I" D NS^SDN2 G 72
"RTN","SDN",16,0)
 I SDSTAT=""!(SDSTAT="NT") D  G 72
"RTN","SDN",17,0)
 .N SDNSHDL,SDDA S SDNSHDL=$$HANDLE^SDAMEVT(1),SDDA=$$FIND^SDAM2(DFN,I,SC)
"RTN","SDN",18,0)
 .S SDDTM=I D BEFORE^SDAMEVT(.SDATA,DFN,SDDTM,SC,SDDA,SDNSHDL)
"RTN","SDN",19,0)
 .S $P(^DPT(+DFN,"S",I,0),U,2)="N",$P(^(0),"^",14)=SDTIME S:$D(DUZ) $P(^(0),"^",12)=DUZ
"RTN","SDN",20,0)
 .S:'SDYES SDYES=1
"RTN","SDN",21,0)
 .S:'$D(^UTILITY($J,"CL",DFN,SC,I))&(SDSTAT'="C") ^(I)=""
"RTN","SDN",22,0)
 .W "...OK   New Status: ",$P($$STATUS^SDAM1(DFN,I,SC,^DPT(DFN,"S",I,0),SDDA),";",3)
"RTN","SDN",23,0)
 .D EVT K SDATA
"RTN","SDN",24,0)
 W:$P(^DPT(+DFN,"S",I,0),U,2)["A" *7,!,"THIS APPOINTMENT ALREADY A NO-SHOW AND REBOOKED... ARE YOU SURE YOU"
"RTN","SDN",25,0)
ALNS S %=2 W:$P(^DPT(+DFN,"S",I,0),U,2)'["A" !,*7,"  ALREADY RECORDED AS NO-SHOW..." W " WANT TO ERASE" D YN^DICN I '% W !,"RESPOND YES OR NO" G ALNS
"RTN","SDN",26,0)
 I (%-1) G 72
"RTN","SDN",27,0)
 I '(%-1) W "...NO LONGER A NO-SHOW!" D
"RTN","SDN",28,0)
 .N SDNSHDL,SDDA S SDNSHDL=$$HANDLE^SDAMEVT(1),SDDA=$$FIND^SDAM2(DFN,I,SC)
"RTN","SDN",29,0)
 .S SDDTM=I D BEFORE^SDAMEVT(.SDATA,DFN,SDDTM,SC,SDDA,SDNSHDL)
"RTN","SDN",30,0)
 .S SDINP=$$INP^SDAM2(DFN,SDDTM),X=I,Y=DFN
"RTN","SDN",31,0)
 .S $P(^DPT(+Y,"S",SDDTM,0),U,2)=$S(SDINP["I":SDINP,1:""),$P(^(0),"^",14)="",$P(^(0),"^",12)=""
"RTN","SDN",32,0)
 .I SDINP="",$$CHK^SDM1A(SC,SDDTM),+$$STATUS^SDAM1(DFN,SDDTM,SC,^DPT(DFN,"S",SDDTM,0),SDDA)'=1 S $P(^DPT(DFN,"S",SDDTM,0),U,2)="NT" ; not inpt and not ci
"RTN","SDN",33,0)
 .D EVT K SDATA
"RTN","SDN",34,0)
 .K SDINP,^UTILITY($J,"CL",+Y,SC,SDDTM),SDDTM
"RTN","SDN",35,0)
 G 72
"RTN","SDN",36,0)
73 ;
"RTN","SDN",37,0)
 G:SDYES ASKA G END^SDN0
"RTN","SDN",38,0)
CK1 S SD1=I X SM I I<SD2,$P(^DPT(+Y,"S",I,0),U,2)["C" S POP=1
"RTN","SDN",39,0)
 S:I'<SD2 POP=1 Q:'POP  I I'<SD2 S POP=1 Q
"RTN","SDN",40,0)
 G CK1
"RTN","SDN",41,0)
ASKA S %=2,DTOUT=0 W !,"WANT TO AUTO-REBOOK NO-SHOW APPOINTMENTS NOW" D YN^DICN I '% W !,"RESPOND YES (Y) OR NO (N)" G ASKA
"RTN","SDN",42,0)
 W:DTOUT " NO" S ANS=$S(%=1:"Y",1:"N"),(SDED,DATEND)=SDT+.9
"RTN","SDN",43,0)
 I $D(SDNSACT),'SDNSACT,%=1 S SDNSACT=1 ;No-show action flag
"RTN","SDN",44,0)
ASKL S %=1,DTOUT=0,SDLET="" W !,"WANT LETTERS PRINTED NOW" D YN^DICN I '% W !,"RESPOND YES (Y) OR NO (N)" G ASKL
"RTN","SDN",45,0)
 W:DTOUT " NO" S ALS=$S(%=1:"Y",1:"N")
"RTN","SDN",46,0)
 I $D(SDNSACT),(ALS="Y"),$$BADADR^DGUTL3(+DFN) D  ;display, don't print BAI list
"RTN","SDN",47,0)
 . W *7,!,"** THIS PATIENT HAS BEEN FLAGGED WITH A BAD ADDRESS INDICATOR, NO LETTER"
"RTN","SDN",48,0)
 . W !,"WILL BE PRINTED."
"RTN","SDN",49,0)
 . S ALS="N"
"RTN","SDN",50,0)
 . S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDN",51,0)
 I ALS'["Y"&(ANS'["Y") D DIS^SDNDIS G END^SDN0
"RTN","SDN",52,0)
RD1 I $D(SDNSACT) S Y=SC G RD2
"RTN","SDN",53,0)
 R !!,"FOR CLINIC: ALL// ",X:DTIME K C,DIC Q:X="^"  S X=$$UP^XLFSTR(X) G AOR:X="ALL"!(X="") I X?.E1"?" W !,?3,"ENTER A CLINIC NAME, OR 'ALL' FOR ALL CLINICS" G RD1
"RTN","SDN",54,0)
 S DIC(0)="QEM",DIC=44,DIC("S")="I $P(^(0),""^"",3)=""C""" D ^DIC K DIC("S") G:Y<0 RD1
"RTN","SDN",55,0)
RD2 S C=+Y I '$D(^SC(C,"LTR")) W !,$P(^SC(C,0),"^")_SDMSG S ALS="N"
"RTN","SDN",56,0)
 I $D(^SC(C,"LTR")),'+^("LTR") W !,$P(^SC(C,0),"^")_SDMSG S ALS="N"
"RTN","SDN",57,0)
 I $D(^SC(C,"LTR")),+^("LTR") S SDLET=+^("LTR")
"RTN","SDN",58,0)
AOR S:'$D(C) C="ALL" I ANS'["Y"&(ALS'["Y") D DIS^SDNDIS G END^SDN0
"RTN","SDN",59,0)
 D DIS^SDNDIS
"RTN","SDN",60,0)
 S DGPGM="START^SDN0",DGVAR="SC^SDDT^ALS^ANS^SDLET^SDV1^SDT^C^DATEND^SDTIME^SDLT1"
"RTN","SDN",61,0)
 S POP=0 D ZIS^DGUTQ G:POP END^SDN0
"RTN","SDN",62,0)
 G START^SDN0
"RTN","SDN",63,0)
SDMLT ;
"RTN","SDN",64,0)
 N SDCNT,SDSTAT
"RTN","SDN",65,0)
 S SDCNT=SDCT,SDCT=0
"RTN","SDN",66,0)
 F  S SDCT=$O(SDT(SDCT)) Q:'SDCT  D
"RTN","SDN",67,0)
 .S SDSTAT=$$STATUS^SDAM1(DFN,SDT(SDCT),SC,^DPT(DFN,"S",SDT(SDCT),0))
"RTN","SDN",68,0)
 .W !,SDCT,"). ",$$FTIME^VALM1(SDT(SDCT)),"   Status: ",$P(SDSTAT,";",3) W:$P(SDSTAT,";",4) *7
"RTN","SDN",69,0)
 S SDCT=SDCNT
"RTN","SDN",70,0)
ASK I SDCT>1!($P(SDSTAT,";",4)) R !!,"SELECT APPOINTMENT: ",SDCT:DTIME Q:'$T!(U[SDCT)  I SDCT["?"!('$D(SDT(SDCT))) W !,"Please enter one number to indicate which appointment." S SDCT=SDCNT G ASK
"RTN","SDN",71,0)
 W ! Q
"RTN","SDN",72,0)
 ;
"RTN","SDN",73,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDN",74,0)
 N I,SDINP,Y,SDSTAT,SDTIME,SDYES,SM,SM1,SD1,SD2,SDMSG,SDT,SDCT
"RTN","SDN",75,0)
 D NOSHOW^SDAMEVT(.SDATA,DFN,SDDTM,SC,SDDA,0,SDNSHDL)
"RTN","SDN",76,0)
 Q
"RTN","SDN",77,0)
 ;
"RTN","SDN1")
0^10^B20411676
"RTN","SDN1",1,0)
SDN1 ;BSN/GRR - NO-SHOW LETTERS ; 17 AUG 84  4:34 pm
"RTN","SDN1",2,0)
 ;;5.3;Scheduling;**330,340,398**;Aug 13, 1993
"RTN","SDN1",3,0)
 N SDBAD
"RTN","SDN1",4,0)
 I ANS["Y"&($D(C)) F A=0:0 S A=$O(^UTILITY($J,A)) Q:A'>0  F C=0:0 S C=$O(^(A,C)) Q:C'>0  S SC=+^(C),SDLET="" S:$D(^SC(SC,"LTR")) SDLET=+^("LTR") S:SDLET ^UTILITY($J,"SDLT",SDLET,A,C)=^UTILITY($J,A,C) S:'SDLET ^UTILITY($J,"NO",A,C)=SC D KLL
"RTN","SDN1",5,0)
 S SDFORM=$S($D(^DG(40.8,SDV1,"LTR")):^("LTR"),1:"") G:ANS["Y"&($D(C)) LST
"RTN","SDN1",6,0)
BC K:$D(SDLT) C S:$D(SDLT) SDT=SDBD,DATEND=SDED K ^UTILITY($J) I $D(C) K VAUTC S (VAUTC,VAUTC(C))=""
"RTN","SDN1",7,0)
 I $D(VAUTC),'VAUTC F C=0:0 S C=$O(VAUTC(C)) Q:C'>0  D:$D(SDLT) LT D CHECK1 I $T D OVER
"RTN","SDN1",8,0)
 I $D(VAUTC),'VAUTC G LST
"RTN","SDN1",9,0)
LST1 F C=0:0 S C=$O(^SC(C)) Q:C'>0  D LT,CHECK1 I $T,$S(SDV1="":1,SDV=SDV1:1,SDV="":1,1:0),'$D(SDVAUTC(+C)),$D(^SC(C,"S")) D OVER
"RTN","SDN1",10,0)
LST N SDFIRST S SDFIRST=1
"RTN","SDN1",11,0)
 F SDLET=0:0 S SDLET=$O(^UTILITY($J,"SDLT",SDLET)) Q:SDLET'>0  F A=0:0 S A=$O(^UTILITY($J,"SDLT",SDLET,A)) Q:A'>0  I $S('$D(^DPT(A,.35)):1,$P(^(.35),"^",1)']"":1,1:0) D ^SDLT,WR
"RTN","SDN1",12,0)
 I $D(^UTILITY($J,"NO")) W @IOF F A=0:0 S A=$O(^UTILITY($J,"NO",A)) Q:A'>0  F A1=0:0 S A1=$O(^(A,A1)) Q:A1'>0  Q:$$BADADR^DGUTL3(A)  W !,$P(^DPT(A,0),"^")," ",$P(^(0),"^",9)," has failed to keep the following appointment(s):" D NDT
"RTN","SDN1",13,0)
 W:$D(^UTILITY($J,"NO")) !,"However, there are no letters assigned to the clinic(s).",!!
"RTN","SDN1",14,0)
 I $D(^TMP($J,"BADADD")) D BADADD^SDLT K ^TMP($J,"BADADD")
"RTN","SDN1",15,0)
 G END
"RTN","SDN1",16,0)
OVER S GDATE=SDT Q:'$D(^SC(C,"S"))  F J=0:0 S GDATE=$O(^SC(C,"S",GDATE)) Q:GDATE=""!(GDATE>(DATEND+.9999))  F K=0:0 S K=$O(^SC(C,"S",GDATE,1,K)) Q:K=""  I $D(^(K,0)) S DFN=+^(0) D CHECK
"RTN","SDN1",17,0)
 Q
"RTN","SDN1",18,0)
END K %,%DT,%IS,A,A0,A1,A2,ALL,ALS,ANS,BY,C,CDATE,DA,DFN,DGPGM,DGVAR,DH,DHD,DIC,DIS,DIV,DIW,DIWF,DIWL,DIWR,DIWT,DO,DOW,DN,DUPE,FLDS,F,F1,FR,GDATE,I,I1,L,L0,LET,MAX,MESS,MIN,NOAP,P,POP,SC,SD,SDFOR,SDLET,SDTIME,SI,SL,SS,ST,SDSTRTDT,TO,X,Y,ADDR,B
"RTN","SDN1",19,0)
 K CLIN,HX,LL,PDAT,S,TIME,Z,D,NDATE,ENDATE,J,SDMDT,SDMSTIME,X1,X2,SDTADE,SDADTB,SDRE,SDRE1,SDIN,SDIS,SDYES,CNN,SDT,DATEND,SDV1,K,SDR,SDJ1,^UTILITY($J),SD1,SD2,SDADD,SDC,SDCL,SDCMAX,SDCONS,SDD,SDDAT,SDDIF,SDDT,SDED,SDFORM,SDHX,SDINP,SDIP
"RTN","SDN1",20,0)
 K %ZIS,Y1,SDBD,SDCT,SDVAUTC,VAUTC,SDX,SDX1,SDNOSH,SDLT1,SDMSG,SDNODE,SDQ,SDRT,SDSOH,SDSTAT,SDT0,SDZSC,SM,SM1,STARTDAY,STIME,SDV,Z0,Z5 D CLOSE^DGUTQ Q
"RTN","SDN1",21,0)
CHECK I $S('$D(^DPT(DFN,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(DFN,"S",GDATE,0)),$S($P(^(0),"^",2)["N":1,$D(SDCP)&$P(^(0),"^",2)["C":1,1:0),$P(^(0),"^",14)=SDTIME!(SDTIME="*"),'$D(^DPT(DFN,.1)) D BAD Q:SDBAD  D SET
"RTN","SDN1",22,0)
 Q
"RTN","SDN1",23,0)
SET I SDLT1!SDLET S ^UTILITY($J,"SDLT",$S(SDLT1:SDLT1,1:SDLET),DFN,GDATE)=C_"^"_$P(^DPT(DFN,"S",GDATE,0),"^",10) Q
"RTN","SDN1",24,0)
 S ^UTILITY($J,"NO",DFN,GDATE)=C Q
"RTN","SDN1",25,0)
CHECK1 S SDV=$P(^SC(C,0),"^",15) I $P(^(0),"^",3)="C",$S('$D(^SC(C,"I")):1,'(+^("I")):1,+^("I")>DATEND:1,+$P(^("I"),"^",2)'>DATEND&(+$P(^("I"),"^",2)):1,1:0)
"RTN","SDN1",26,0)
 Q
"RTN","SDN1",27,0)
WR K CNN F J=0:0 S J=$O(^UTILITY($J,"SDLT",SDLET,A,J)) Q:J=""  S SDR=0,SDX=J,CNN(J)=^(J),CLIN=$P(^SC(+$P(CNN(J),"^",1),0),"^",1),SDC=+CNN(J),S=$S($D(^DPT(A,"S",J,0)):^(0),1:"") D WRAPP^SDLT,SET1
"RTN","SDN1",28,0)
 D:SDR SDR D REST^SDLT Q
"RTN","SDN1",29,0)
SDR W !!,"The appointment(s) have been rescheduled as follows:",!
"RTN","SDN1",30,0)
 F J=0:0 S J=$O(CNN(J)) Q:J=""  S SDX=$P(CNN(J),"^",2),SDC=$P(CNN(J),"^") I SDX S S=$S($D(^DPT(A,"S",SDX,0)):^(0),1:"") D WRAPP^SDLT
"RTN","SDN1",31,0)
 Q
"RTN","SDN1",32,0)
SET1 S:'SDR SDR=$S($P(CNN(J),"^",2)]"":1,1:0) Q
"RTN","SDN1",33,0)
 Q
"RTN","SDN1",34,0)
LT S:'SDLT1 SDLET=0 I $D(^SC(C,"LTR")),^("LTR") S SDLET=+^("LTR")
"RTN","SDN1",35,0)
 Q
"RTN","SDN1",36,0)
NDT W !?15,$P(^SC(+^UTILITY($J,"NO",A,A1),0),"^")," on " S Y=A1 D DT^DIQ Q
"RTN","SDN1",37,0)
KLL K ^UTILITY($J,A,C) Q
"RTN","SDN1",38,0)
BAD S SDBAD=$$BADADR^DGUTL3(+DFN)
"RTN","SDN1",39,0)
 S:SDBAD ^TMP($J,"BADADD",$P(^DPT(+DFN,0),"^"),+DFN)=""
"RTN","SDN1",40,0)
 Q
"VER")
8.0^22.0
**END**
**END**
