Released DVBA*2.7*35 SEQ #35
Extracted from mail message
**KIDS**:DVBA*2.7*35^

**INSTALL NAME**
DVBA*2.7*35
"BLD",2605,0)
DVBA*2.7*35^AUTOMATED MED INFO EXCHANGE^0^3010621^y
"BLD",2605,1,0)
^^2^2^3010402^
"BLD",2605,1,1,0)
The changes included in this patch are described in the description
"BLD",2605,1,2,0)
section of patch DVBA*2.7*35 in the National Patch Module
"BLD",2605,4,0)
^9.64PA^^0
"BLD",2605,"ABPKG")
n
"BLD",2605,"INID")
n^n^n
"BLD",2605,"INIT")
POST^DVBA35P
"BLD",2605,"KRN",0)
^9.67PA^19^17
"BLD",2605,"KRN",.4,0)
.4
"BLD",2605,"KRN",.4,"NM",0)
^9.68A^^
"BLD",2605,"KRN",.401,0)
.401
"BLD",2605,"KRN",.401,"NM",0)
^9.68A^^
"BLD",2605,"KRN",.402,0)
.402
"BLD",2605,"KRN",.402,"NM",0)
^9.68A^^
"BLD",2605,"KRN",.403,0)
.403
"BLD",2605,"KRN",.403,"NM",0)
^9.68A^^
"BLD",2605,"KRN",.5,0)
.5
"BLD",2605,"KRN",.5,"NM",0)
^9.68A^^
"BLD",2605,"KRN",.84,0)
.84
"BLD",2605,"KRN",.84,"NM",0)
^9.68A^^
"BLD",2605,"KRN",3.6,0)
3.6
"BLD",2605,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",2605,"KRN",3.8,0)
3.8
"BLD",2605,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",2605,"KRN",9.2,0)
9.2
"BLD",2605,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",2605,"KRN",9.8,0)
9.8
"BLD",2605,"KRN",9.8,"NM",0)
^9.68A^27^22
"BLD",2605,"KRN",9.8,"NM",1,0)
DVBAB1^^0^B34682123
"BLD",2605,"KRN",9.8,"NM",4,0)
DVBAB3^^0^B4121760
"BLD",2605,"KRN",9.8,"NM",5,0)
DVBAB9^^0^B16359814
"BLD",2605,"KRN",9.8,"NM",7,0)
DVBAB51^^0^B22434564
"BLD",2605,"KRN",9.8,"NM",8,0)
DVBAB52^^0^B13032610
"BLD",2605,"KRN",9.8,"NM",9,0)
DVBAB53^^0^B20939933
"BLD",2605,"KRN",9.8,"NM",10,0)
DVBAB54^^0^B13667343
"BLD",2605,"KRN",9.8,"NM",12,0)
DVBAB56^^0^B20872408
"BLD",2605,"KRN",9.8,"NM",13,0)
DVBAB57^^0^B14107890
"BLD",2605,"KRN",9.8,"NM",14,0)
DVBAB58^^0^B15185844
"BLD",2605,"KRN",9.8,"NM",15,0)
DVBAB67^^0^B15630377
"BLD",2605,"KRN",9.8,"NM",16,0)
DVBAB68^^0^B14913222
"BLD",2605,"KRN",9.8,"NM",17,0)
DVBAB70^^0^B38683553
"BLD",2605,"KRN",9.8,"NM",18,0)
DVBAB71^^0^B26000515
"BLD",2605,"KRN",9.8,"NM",19,0)
DVBAB97^^0^B6819780
"BLD",2605,"KRN",9.8,"NM",20,0)
DVBAB98^^0^B16060500
"BLD",2605,"KRN",9.8,"NM",21,0)
DVBAB99^^0^B26361329
"BLD",2605,"KRN",9.8,"NM",22,0)
DVBAB96^^0^B27336892
"BLD",2605,"KRN",9.8,"NM",24,0)
DVBAB6^^0^B33770276
"BLD",2605,"KRN",9.8,"NM",25,0)
DVBAB5^^0^B2038503
"BLD",2605,"KRN",9.8,"NM",26,0)
DVBAB4^^0^B10717262
"BLD",2605,"KRN",9.8,"NM",27,0)
DVBAB2^^0^B16063275
"BLD",2605,"KRN",9.8,"NM","B","DVBAB1",1)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB2",27)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB3",4)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB4",26)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB5",25)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB51",7)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB52",8)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB53",9)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB54",10)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB56",12)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB57",13)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB58",14)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB6",24)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB67",15)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB68",16)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB70",17)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB71",18)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB9",5)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB96",22)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB97",19)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB98",20)

"BLD",2605,"KRN",9.8,"NM","B","DVBAB99",21)

"BLD",2605,"KRN",19,0)
19
"BLD",2605,"KRN",19,"NM",0)
^9.68A^2^1
"BLD",2605,"KRN",19,"NM",2,0)
DVBA CAPRI GUI^^0
"BLD",2605,"KRN",19,"NM","B","DVBA CAPRI GUI",2)

"BLD",2605,"KRN",19.1,0)
19.1
"BLD",2605,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",2605,"KRN",101,0)
101
"BLD",2605,"KRN",101,"NM",0)
^9.68A^^
"BLD",2605,"KRN",409.61,0)
409.61
"BLD",2605,"KRN",771,0)
771
"BLD",2605,"KRN",771,"NM",0)
^9.68A^^
"BLD",2605,"KRN",870,0)
870
"BLD",2605,"KRN",8994,0)
8994
"BLD",2605,"KRN",8994,"NM",0)
^9.68A^37^27
"BLD",2605,"KRN",8994,"NM",1,0)
DVBAB APPOINTMENT LIST^^0
"BLD",2605,"KRN",8994,"NM",2,0)
DVBAB CHECK CREDENTIALS^^0
"BLD",2605,"KRN",8994,"NM",3,0)
DVBAB FIND EXAMS^^0
"BLD",2605,"KRN",8994,"NM",5,0)
DVBAB INCREASE EXAM COUNT^^0
"BLD",2605,"KRN",8994,"NM",6,0)
DVBAB INST LIST^^0
"BLD",2605,"KRN",8994,"NM",9,0)
DVBAB PTINQ^^0
"BLD",2605,"KRN",8994,"NM",10,0)
DVBAB REPORT CHECKLIST^^0
"BLD",2605,"KRN",8994,"NM",12,0)
DVBAB SEND MSG^^0
"BLD",2605,"KRN",8994,"NM",13,0)
DVBAB DATETIME^^0
"BLD",2605,"KRN",8994,"NM",16,0)
DVBAB AMIS REPORT^^0
"BLD",2605,"KRN",8994,"NM",17,0)
DVBAB SC VETERAN REPORT^^0
"BLD",2605,"KRN",8994,"NM",19,0)
DVBAB PENDING C&P REPORT^^0
"BLD",2605,"KRN",8994,"NM",20,0)
DVBAB 2507 PENDING REPORT^^0
"BLD",2605,"KRN",8994,"NM",21,0)
DVBAB REPORT ADMINQ^^0
"BLD",2605,"KRN",8994,"NM",22,0)
DVBAB REPORT ADMISSIONS^^0
"BLD",2605,"KRN",8994,"NM",23,0)
DVBAB REPORT CPDETAILS^^0
"BLD",2605,"KRN",8994,"NM",24,0)
DVBAB REPORT DISCHARGE^^0
"BLD",2605,"KRN",8994,"NM",25,0)
DVBAB REPORT INCOMPVET^^0
"BLD",2605,"KRN",8994,"NM",26,0)
DVBAB REPORT PENDING7131^^0
"BLD",2605,"KRN",8994,"NM",27,0)
DVBAB REPORT READMIT^^0
"BLD",2605,"KRN",8994,"NM",28,0)
DVBAB REPORT EXAM CHKLIST^^0
"BLD",2605,"KRN",8994,"NM",32,0)
DVBAB REPORT 7131INQ^^0
"BLD",2605,"KRN",8994,"NM",33,0)
DVBAB LABLIST^^0
"BLD",2605,"KRN",8994,"NM",34,0)
DVBAB VERSION^^0
"BLD",2605,"KRN",8994,"NM",35,0)
DVBAB DIVISION^^0
"BLD",2605,"KRN",8994,"NM",36,0)
DVBAB REPORT LISTS^^0
"BLD",2605,"KRN",8994,"NM",37,0)
DVBAB HEALTH SUMMARY TEXT^^0
"BLD",2605,"KRN",8994,"NM","B","DVBAB 2507 PENDING REPORT",20)

"BLD",2605,"KRN",8994,"NM","B","DVBAB AMIS REPORT",16)

"BLD",2605,"KRN",8994,"NM","B","DVBAB APPOINTMENT LIST",1)

"BLD",2605,"KRN",8994,"NM","B","DVBAB CHECK CREDENTIALS",2)

"BLD",2605,"KRN",8994,"NM","B","DVBAB DATETIME",13)

"BLD",2605,"KRN",8994,"NM","B","DVBAB DIVISION",35)

"BLD",2605,"KRN",8994,"NM","B","DVBAB FIND EXAMS",3)

"BLD",2605,"KRN",8994,"NM","B","DVBAB HEALTH SUMMARY TEXT",37)

"BLD",2605,"KRN",8994,"NM","B","DVBAB INCREASE EXAM COUNT",5)

"BLD",2605,"KRN",8994,"NM","B","DVBAB INST LIST",6)

"BLD",2605,"KRN",8994,"NM","B","DVBAB LABLIST",33)

"BLD",2605,"KRN",8994,"NM","B","DVBAB PENDING C&P REPORT",19)

"BLD",2605,"KRN",8994,"NM","B","DVBAB PTINQ",9)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT 7131INQ",32)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT ADMINQ",21)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT ADMISSIONS",22)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT CHECKLIST",10)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT CPDETAILS",23)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT DISCHARGE",24)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT EXAM CHKLIST",28)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT INCOMPVET",25)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT LISTS",36)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT PENDING7131",26)

"BLD",2605,"KRN",8994,"NM","B","DVBAB REPORT READMIT",27)

"BLD",2605,"KRN",8994,"NM","B","DVBAB SC VETERAN REPORT",17)

"BLD",2605,"KRN",8994,"NM","B","DVBAB SEND MSG",12)

"BLD",2605,"KRN",8994,"NM","B","DVBAB VERSION",34)

"BLD",2605,"KRN","B",.4,.4)

"BLD",2605,"KRN","B",.401,.401)

"BLD",2605,"KRN","B",.402,.402)

"BLD",2605,"KRN","B",.403,.403)

"BLD",2605,"KRN","B",.5,.5)

"BLD",2605,"KRN","B",.84,.84)

"BLD",2605,"KRN","B",3.6,3.6)

"BLD",2605,"KRN","B",3.8,3.8)

"BLD",2605,"KRN","B",9.2,9.2)

"BLD",2605,"KRN","B",9.8,9.8)

"BLD",2605,"KRN","B",19,19)

"BLD",2605,"KRN","B",19.1,19.1)

"BLD",2605,"KRN","B",101,101)

"BLD",2605,"KRN","B",409.61,409.61)

"BLD",2605,"KRN","B",771,771)

"BLD",2605,"KRN","B",870,870)

"BLD",2605,"KRN","B",8994,8994)

"BLD",2605,"PRE")
DVBA35P
"BLD",2605,"QUES",0)
^9.62^^
"BLD",2605,"REQB",0)
^9.611^^
"INIT")
POST^DVBA35P
"KRN",19,9510,-1)
0^2
"KRN",19,9510,0)
DVBA CAPRI GUI^Capri GUI (Broker)^^B^^^^^^^^AUTOMATED MED INFO EXCHANGE
"KRN",19,9510,1,0)
^^2^2^3010621^
"KRN",19,9510,1,1,0)
This is the 'B' type option used by CAPRI GUI client application. It
"KRN",19,9510,1,2,0)
contains all the RPCs used by the CAPRI GUI application.
"KRN",19,9510,99.1)
58211,72404
"KRN",19,9510,"RPC",0)
^19.05P^57^56
"KRN",19,9510,"RPC",1,0)
DVBAB REPORT LISTS
"KRN",19,9510,"RPC",2,0)
DVBAB APPOINTMENT LIST
"KRN",19,9510,"RPC",3,0)
DVBAB CHECK CREDENTIALS
"KRN",19,9510,"RPC",4,0)
DVBAB FIND EXAMS
"KRN",19,9510,"RPC",5,0)
DVBAB PTINQ
"KRN",19,9510,"RPC",6,0)
DVBAB INCREASE EXAM COUNT
"KRN",19,9510,"RPC",7,0)
DVBAB SEND MSG
"KRN",19,9510,"RPC",8,0)
DVBAB REPORT CHECKLIST
"KRN",19,9510,"RPC",9,0)
DDR FILER
"KRN",19,9510,"RPC",10,0)
DDR LISTER
"KRN",19,9510,"RPC",11,0)
DDR VALIDATOR
"KRN",19,9510,"RPC",12,0)
DDR GETS ENTRY DATA
"KRN",19,9510,"RPC",14,0)
XWB GET VARIABLE VALUE
"KRN",19,9510,"RPC",15,0)
DVBAB HEALTH SUMMARY TEXT
"KRN",19,9510,"RPC",16,0)
TIU DOCUMENTS BY CONTEXT
"KRN",19,9510,"RPC",17,0)
TIU GET RECORD TEXT
"KRN",19,9510,"RPC",18,0)
ORQQCN LIST
"KRN",19,9510,"RPC",19,0)
ORQQCN DETAIL
"KRN",19,9510,"RPC",20,0)
DVBAB INST LIST
"KRN",19,9510,"RPC",22,0)
ORWRP REPORT TEXT
"KRN",19,9510,"RPC",23,0)
ORWORR AGET
"KRN",19,9510,"RPC",24,0)
ORWRA IMAGING EXAMS
"KRN",19,9510,"RPC",25,0)
ORWRP1 LISTNUTR
"KRN",19,9510,"RPC",26,0)
ORWMC PATIENT PROCEDURES
"KRN",19,9510,"RPC",27,0)
ORQQPL PROBLEM LIST
"KRN",19,9510,"RPC",28,0)
ORWORR GET4LST
"KRN",19,9510,"RPC",29,0)
ORWLR CUMULATIVE REPORT
"KRN",19,9510,"RPC",32,0)
DVBAB DATETIME
"KRN",19,9510,"RPC",34,0)
ORWPT ADMITLST
"KRN",19,9510,"RPC",35,0)
DVBAB SC VETERAN REPORT
"KRN",19,9510,"RPC",36,0)
ORQQVS VISITS/APPTS
"KRN",19,9510,"RPC",37,0)
ORWU DT
"KRN",19,9510,"RPC",38,0)
ORWLRR CHART
"KRN",19,9510,"RPC",39,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,9510,"RPC",40,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,9510,"RPC",41,0)
DVBAB REPORT EXAM CHKLIST
"KRN",19,9510,"RPC",42,0)
DVBAB REPORT ADMINQ
"KRN",19,9510,"RPC",43,0)
DVBAB REPORT INCOMPVET
"KRN",19,9510,"RPC",44,0)
DVBAB REPORT DISCHARGE
"KRN",19,9510,"RPC",45,0)
DVBAB REPORT READMIT
"KRN",19,9510,"RPC",46,0)
DVBAB REPORT ADMISSIONS
"KRN",19,9510,"RPC",47,0)
DVBAB REPORT 7131INQ
"KRN",19,9510,"RPC",48,0)
DVBAB PENDING C&P REPORT
"KRN",19,9510,"RPC",49,0)
DVBAB REPORT CPDETAILS
"KRN",19,9510,"RPC",50,0)
DVBAB AMIS REPORT
"KRN",19,9510,"RPC",51,0)
DVBAB REPORT PENDING7131
"KRN",19,9510,"RPC",52,0)
DVBAB LABLIST
"KRN",19,9510,"RPC",53,0)
DVBAB VERSION
"KRN",19,9510,"RPC",54,0)
DDR DELETE ENTRY
"KRN",19,9510,"RPC",55,0)
ORWRP REPORT LISTS
"KRN",19,9510,"RPC",57,0)
DVBAB DIVISION
"KRN",19,9510,"U")
CAPRI GUI (BROKER)
"KRN",8994,735,-1)
0^10
"KRN",8994,735,0)
DVBAB REPORT CHECKLIST^REPORT1^DVBAB9^2^^^^1
"KRN",8994,735,1,0)
^^1^1^3010621^
"KRN",8994,735,1,1,0)
Generates an exam worksheet.
"KRN",8994,736,-1)
0^2
"KRN",8994,736,0)
DVBAB CHECK CREDENTIALS^CHKCRED^DVBAB1^1
"KRN",8994,736,1,0)
^^1^1^3010621^
"KRN",8994,736,1,1,0)
Verifies the user has been granted access to AMIE II/CAPRI
"KRN",8994,736,2,0)
^8994.02A^^0
"KRN",8994,737,-1)
0^3
"KRN",8994,737,0)
DVBAB FIND EXAMS^FINDEXAM^DVBAB1^2^S
"KRN",8994,737,1,0)
^^2^2^3010621^
"KRN",8994,737,1,1,0)
Lists all of the patient's AMIE II C&P exam requests whether complete, new
"KRN",8994,737,1,2,0)
or pending.
"KRN",8994,737,2,0)
^8994.02A^1^1
"KRN",8994,737,2,1,0)
INPUT1^1^^1
"KRN",8994,737,2,"B","INPUT1",1)

"KRN",8994,738,-1)
0^12
"KRN",8994,738,0)
DVBAB SEND MSG^MSG^DVBAB1^1^S
"KRN",8994,738,1,0)
^^2^2^3010621^
"KRN",8994,738,1,1,0)
Used to generate e-mail messages for specific CAPRI actions, such as
"KRN",8994,738,1,2,0)
changing a C&P exam request.
"KRN",8994,738,2,0)
^8994.02A^4^4
"KRN",8994,738,2,1,0)
VAL1^1^8^1
"KRN",8994,738,2,1,1,0)
^^1^1^3000215^
"KRN",8994,738,2,1,1,1,0)
This is the cancelling users DUZ.
"KRN",8994,738,2,2,0)
VAL2^1^45^1
"KRN",8994,738,2,2,1,0)
^^1^1^3000215^
"KRN",8994,738,2,2,1,1,0)
This is the Subjecto of the message - XMSUB
"KRN",8994,738,2,3,0)
VAL3^2^^1
"KRN",8994,738,2,3,1,0)
^^1^1^3000216^^^^
"KRN",8994,738,2,3,1,1,0)
This is the text of the message  -  XMTEXT
"KRN",8994,738,2,4,0)
VAL4^1^30^1
"KRN",8994,738,2,4,1,0)
^^1^1^3000216^^
"KRN",8994,738,2,4,1,1,0)
This is the mail group name  -  MGN
"KRN",8994,738,2,"B","VAL1",1)

"KRN",8994,738,2,"B","VAL2",2)

"KRN",8994,738,2,"B","VAL3",3)

"KRN",8994,738,2,"B","VAL4",4)

"KRN",8994,739,-1)
0^1
"KRN",8994,739,0)
DVBAB APPOINTMENT LIST^DPA^DVBAB1^2
"KRN",8994,739,1,0)
^^1^1^3010621^
"KRN",8994,739,1,1,0)
Returns a list of past, future or all appointments.
"KRN",8994,739,2,0)
^8994.02A^2^2
"KRN",8994,739,2,1,0)
VAL1^1^10^1
"KRN",8994,739,2,1,1,0)
^^1^1^3000218^
"KRN",8994,739,2,1,1,1,0)
This is the DFN - the ien for the patient selected
"KRN",8994,739,2,2,0)
VAL2^1^1^1
"KRN",8994,739,2,2,1,0)
^^2^2^3000218^
"KRN",8994,739,2,2,1,1,0)
This is CHOICE - valid input is A (for All appointments), F (for Future
"KRN",8994,739,2,2,1,2,0)
Appointments, or P (for Past Appointments).
"KRN",8994,739,2,"B","VAL1",1)

"KRN",8994,739,2,"B","VAL2",2)

"KRN",8994,739,3,0)
^^1^1^3000218^
"KRN",8994,739,3,1,0)
Returns LIST of appointments for the patient based on value of CHOICE.
"KRN",8994,740,-1)
0^36
"KRN",8994,740,0)
DVBAB REPORT LISTS^LIST^DVBAB1^2^S
"KRN",8994,740,1,0)
^^5^5^3010621^
"KRN",8994,740,1,1,0)
This remote procedure call returns a list of reports,
"KRN",8994,740,1,2,0)
Health Summary types and date ranges that can be displayed
"KRN",8994,740,1,3,0)
at the workstation.
"KRN",8994,740,1,4,0)
 
"KRN",8994,740,1,5,0)
There are no input parameters for this RPC.
"KRN",8994,741,-1)
0^9
"KRN",8994,741,0)
DVBAB PTINQ^PTINQ^DVBAB1^4^^^^1
"KRN",8994,741,1,0)
^^1^1^3010621^
"KRN",8994,741,1,1,0)
Returns a patient inquiry text report.
"KRN",8994,742,-1)
0^5
"KRN",8994,742,0)
DVBAB INCREASE EXAM COUNT^INCEXAM^DVBAB1^1^R
"KRN",8994,742,1,0)
^^1^1^3010621^
"KRN",8994,742,1,1,0)
Used to record the number of exams pending for a specified patient.
"KRN",8994,742,2,0)
^8994.02A^^0
"KRN",8994,743,-1)
0^37
"KRN",8994,743,0)
DVBAB HEALTH SUMMARY TEXT^RPT^DVBAB1^4^S^^^1
"KRN",8994,743,1,0)
^8994.01^2^2^3010621^^^^
"KRN",8994,743,1,1,0)
This rpc retrieves the report text for a report selected on
"KRN",8994,743,1,2,0)
the Report tab.
"KRN",8994,743,1,3,0)
the report format on the roll 'n scroll version of CPRS.
"KRN",8994,743,1,4,0)

"KRN",8994,743,2,0)
^8994.02A^5^5
"KRN",8994,743,2,1,0)
DFN^1^20^1
"KRN",8994,743,2,1,1,0)
^^1^1^2961016^
"KRN",8994,743,2,1,1,1,0)
Internal entry number of entry in the Patient file.
"KRN",8994,743,2,2,0)
REPORT ID^1^20^1
"KRN",8994,743,2,2,1,0)
^^1^1^2961016^
"KRN",8994,743,2,2,1,1,0)
Identification number of the desired report.
"KRN",8994,743,2,3,0)
HEALTH SUMMARY TYPE^1^20^0
"KRN",8994,743,2,3,1,0)
^^4^4^2961016^
"KRN",8994,743,2,3,1,1,0)
Internal entry number of entry in the HEALTH SUMMARY TYPE file.
"KRN",8994,743,2,3,1,2,0)

"KRN",8994,743,2,3,1,3,0)
This parameter is only required for Health Summary reports.
"KRN",8994,743,2,3,1,4,0)

"KRN",8994,743,2,4,0)
DATE RANGE^1^5^0
"KRN",8994,743,2,4,1,0)
^^4^4^2961016^
"KRN",8994,743,2,4,1,1,0)
This parameter indicates the number of days from TODAY
"KRN",8994,743,2,4,1,2,0)
that the report should search for information.
"KRN",8994,743,2,4,1,3,0)

"KRN",8994,743,2,4,1,4,0)
This parameter is required for vital reports.
"KRN",8994,743,2,5,0)
REPORT SECTION^1^2^1
"KRN",8994,743,2,5,1,0)
^8994.021^7^7^3010621^^^^
"KRN",8994,743,2,5,1,1,0)
This parameter specifics which portion of the report should be
"KRN",8994,743,2,5,1,2,0)
retrieved.
"KRN",8994,743,2,5,1,3,0)

"KRN",8994,743,2,5,1,4,0)
If REPORT SECTION equals 0 then the entire report is re-compiled and the
"KRN",8994,743,2,5,1,5,0)
first section is passed back. If the report is large then it is
"KRN",8994,743,2,5,1,6,0)
necessary to divide it into sections. Currently, each section can
"KRN",8994,743,2,5,1,7,0)
not be more than be more than 20,000 characters
"KRN",8994,743,2,"B","DATE RANGE",4)

"KRN",8994,743,2,"B","DFN",1)

"KRN",8994,743,2,"B","HEALTH SUMMARY TYPE",3)

"KRN",8994,743,2,"B","REPORT ID",2)

"KRN",8994,743,2,"B","REPORT SECTION",5)

"KRN",8994,743,3,0)
^8994.03^4^4^3010621^^^^
"KRN",8994,743,3,1,0)
Text array for report section is returned.
"KRN",8994,743,3,2,0)

"KRN",8994,743,3,3,0)
Also, the first line of the text contains the following information:
"KRN",8994,743,3,4,0)
     <number of current section being passed> ^ <last section number>
"KRN",8994,744,-1)
0^20
"KRN",8994,744,0)
DVBAB 2507 PENDING REPORT^STRT^DVBAB6^4^S^^^0
"KRN",8994,744,1,0)
^^1^1^3010621^
"KRN",8994,744,1,1,0)
Generates a report based on the status of 2507 requests.
"KRN",8994,744,2,0)
^8994.02A^6^6
"KRN",8994,744,2,1,0)
DVBCSORT^1^1^1
"KRN",8994,744,2,1,1,0)
^^2^2^3000506^
"KRN",8994,744,2,1,1,1,0)
This is  the status.  Valid choices are: A (age), S (status), V (veteran
"KRN",8994,744,2,1,1,2,0)
name), or R (routing location).
"KRN",8994,744,2,2,0)
RSTAT^1^1^1
"KRN",8994,744,2,2,1,0)
^^2^2^3000506^
"KRN",8994,744,2,2,1,1,0)
This is the Request Status.  Valid choices are: A (all), P (pending), N
"KRN",8994,744,2,2,1,2,0)
(new), or T (transcribed).  If DVBCSORT=A,S, or V - RSTAT cannot be null.
"KRN",8994,744,2,3,0)
ERDAYS^1^3^1
"KRN",8994,744,2,3,1,0)
^^3^3^3000506^
"KRN",8994,744,2,3,1,1,0)
If DVBCSORT = A (age) this must be the earliest age to start with (ie. 30
"KRN",8994,744,2,3,1,2,0)
days old).  This goes with the next variable OLDAYS which is the oldest
"KRN",8994,744,2,3,1,3,0)
age (ie. 1 day old and cannot be 0).  ERDAYS must be < OLDAYS
"KRN",8994,744,2,4,0)
OLDAYS^1^3^1
"KRN",8994,744,2,4,1,0)
^^2^2^3000506^
"KRN",8994,744,2,4,1,1,0)
This is the Oldest age (ie 1 day) if DVBCSORT=A (age).  This goes with
"KRN",8994,744,2,4,1,2,0)
ERDAYS (earliest age - ie 30 days).  ERDAYS must be < OLDAYS
"KRN",8994,744,2,5,0)
ADIVNUM^1^3^1
"KRN",8994,744,2,5,1,0)
^^2^2^3000506^
"KRN",8994,744,2,5,1,1,0)
This is the regional office number - this is required only if DVBCSORT=R,
"KRN",8994,744,2,5,1,2,0)
otherwise send as null.
"KRN",8994,744,2,6,0)
ELTYP^1^1^1
"KRN",8994,744,2,6,1,0)
^8994.021^2^2^3010621^^^^
"KRN",8994,744,2,6,1,1,0)
This is the elapsed time.  Values are C (calendar days - default) or W
"KRN",8994,744,2,6,1,2,0)
(workdays).  If DVBCSORT=A,S, or V - this must not be null.
"KRN",8994,744,2,"B","ADIVNUM",5)

"KRN",8994,744,2,"B","DVBCSORT",1)

"KRN",8994,744,2,"B","ELTYP",6)

"KRN",8994,744,2,"B","ERDAYS",3)

"KRN",8994,744,2,"B","OLDAYS",4)

"KRN",8994,744,2,"B","RSTAT",2)

"KRN",8994,744,3,0)
^8994.03^1^1^3010621^^^
"KRN",8994,744,3,1,0)
MSG is returned.
"KRN",8994,745,-1)
0^6
"KRN",8994,745,0)
DVBAB INST LIST^INSTLIST^DVBAB1^4^S
"KRN",8994,745,1,0)
^^1^1^3010621^
"KRN",8994,745,1,1,0)
Returns a list of Institutions.
"KRN",8994,746,-1)
0^13
"KRN",8994,746,0)
DVBAB DATETIME^DTTM^DVBAB1^1^S
"KRN",8994,746,1,0)
^^1^1^3010621^
"KRN",8994,746,1,1,0)
Returns the current date/time from VistA
"KRN",8994,747,-1)
0^16
"KRN",8994,747,0)
DVBAB AMIS REPORT^STRT^DVBAB3^2^R^^^0
"KRN",8994,747,1,0)
^^1^1^3010621^
"KRN",8994,747,1,1,0)
Returns an AMIS report for specified search criteria.
"KRN",8994,747,2,0)
^8994.02A^5^5
"KRN",8994,747,2,1,0)
BDATE^1^^1
"KRN",8994,747,2,2,0)
EDATE^1^^1
"KRN",8994,747,2,3,0)
RONUM^1^^1
"KRN",8994,747,2,4,0)
SBULL^1^^1
"KRN",8994,747,2,5,0)
DUZ^1^^1
"KRN",8994,747,2,"B","BDATE",1)

"KRN",8994,747,2,"B","DUZ",5)

"KRN",8994,747,2,"B","EDATE",2)

"KRN",8994,747,2,"B","RONUM",3)

"KRN",8994,747,2,"B","SBULL",4)

"KRN",8994,748,-1)
0^17
"KRN",8994,748,0)
DVBAB SC VETERAN REPORT^EN^DVBAB4^2^S
"KRN",8994,748,1,0)
^^1^1^3010621^
"KRN",8994,748,1,1,0)
Generates a service-connected veterans report.
"KRN",8994,748,2,0)
^8994.02A^2^2
"KRN",8994,748,2,1,0)
INPUT1^1^^1^1
"KRN",8994,748,2,1,1,0)
^^1^1^3000619^
"KRN",8994,748,2,1,1,1,0)
START DATE
"KRN",8994,748,2,2,0)
INPUT2^1^^1^2
"KRN",8994,748,2,2,1,0)
^^1^1^3000619^
"KRN",8994,748,2,2,1,1,0)
STOP DATE
"KRN",8994,748,2,"B","INPUT1",1)

"KRN",8994,748,2,"B","INPUT2",2)

"KRN",8994,748,2,"PARAMSEQ",1,1)

"KRN",8994,748,2,"PARAMSEQ",2,2)

"KRN",8994,749,-1)
0^19
"KRN",8994,749,0)
DVBAB PENDING C&P REPORT^STRT^DVBAB6^4^R^^^0
"KRN",8994,749,1,0)
^^1^1^3010621^
"KRN",8994,749,1,1,0)
Generates a report containing the pending C&P exam requests.
"KRN",8994,749,2,0)
^8994.02A^6^6
"KRN",8994,749,2,1,0)
DVBCSORT^1
"KRN",8994,749,2,2,0)
RSTAT^1
"KRN",8994,749,2,3,0)
ERDAYS^1
"KRN",8994,749,2,4,0)
OLDAYS^1
"KRN",8994,749,2,5,0)
ADIVNUM^1
"KRN",8994,749,2,6,0)
ELTYP^1
"KRN",8994,749,2,"B","ADIVNUM",5)

"KRN",8994,749,2,"B","DVBCSORT",1)

"KRN",8994,749,2,"B","ELTYP",6)

"KRN",8994,749,2,"B","ERDAYS",3)

"KRN",8994,749,2,"B","OLDAYS",4)

"KRN",8994,749,2,"B","RSTAT",2)

"KRN",8994,750,-1)
0^28
"KRN",8994,750,0)
DVBAB REPORT EXAM CHKLIST^STRT^DVBAB4^2^R
"KRN",8994,750,1,0)
^^1^1^3010621^
"KRN",8994,750,1,1,0)
Generates an exam worksheet.
"KRN",8994,751,-1)
0^21
"KRN",8994,751,0)
DVBAB REPORT ADMINQ^STRT^DVBAB52^2^R
"KRN",8994,751,1,0)
^^1^1^3010621^
"KRN",8994,751,1,1,0)
Returns an admission inquiry report for the specified date range.
"KRN",8994,751,2,0)
^8994.02A^2^2
"KRN",8994,751,2,1,0)
BDATE^1^^1^1
"KRN",8994,751,2,2,0)
EDATE^1^^1^2
"KRN",8994,751,2,"B","BDATE",1)

"KRN",8994,751,2,"B","EDATE",2)

"KRN",8994,751,2,"PARAMSEQ",1,1)

"KRN",8994,751,2,"PARAMSEQ",2,2)

"KRN",8994,752,-1)
0^25
"KRN",8994,752,0)
DVBAB REPORT INCOMPVET^STRT^DVBAB51^2^R
"KRN",8994,752,1,0)
^^1^1^3010621^
"KRN",8994,752,1,1,0)
Generates an incompetent veteran report.
"KRN",8994,752,2,0)
^8994.02A^2^2
"KRN",8994,752,2,1,0)
BDATE^1^^1
"KRN",8994,752,2,2,0)
EDATE^1^^1
"KRN",8994,752,2,"B","BDATE",1)

"KRN",8994,752,2,"B","EDATE",2)

"KRN",8994,753,-1)
0^24
"KRN",8994,753,0)
DVBAB REPORT DISCHARGE^STRT^DVBAB53^2^R
"KRN",8994,753,1,0)
^^1^1^3010621^
"KRN",8994,753,1,1,0)
Generates a discharge report.
"KRN",8994,753,2,0)
^8994.02A^3^3
"KRN",8994,753,2,1,0)
BDATE^1^^1
"KRN",8994,753,2,2,0)
EDATE^1^^1
"KRN",8994,753,2,3,0)
ADTYPE^1^^1
"KRN",8994,753,2,"B","ADTYPE",3)

"KRN",8994,753,2,"B","BDATE",1)

"KRN",8994,753,2,"B","EDATE",2)

"KRN",8994,754,-1)
0^27
"KRN",8994,754,0)
DVBAB REPORT READMIT^STRT^DVBAB56^2^R
"KRN",8994,754,1,0)
^^1^1^3010621^
"KRN",8994,754,1,1,0)
Generates a re-admission report.
"KRN",8994,754,2,0)
^8994.02A^3^3
"KRN",8994,754,2,1,0)
BDATE^1^^1
"KRN",8994,754,2,2,0)
EDATE^1^^1
"KRN",8994,754,2,3,0)
DVBAH^1^^1
"KRN",8994,754,2,"B","BDATE",1)

"KRN",8994,754,2,"B","DVBAH",3)

"KRN",8994,754,2,"B","EDATE",2)

"KRN",8994,755,-1)
0^22
"KRN",8994,755,0)
DVBAB REPORT ADMISSIONS^STRT^DVBAB54^2^R
"KRN",8994,755,1,0)
^^1^1^3010621^
"KRN",8994,755,1,1,0)
Generates an admission report for the specified date range.
"KRN",8994,755,2,0)
^8994.02A^2^2
"KRN",8994,755,2,1,0)
BDATE^1^^1
"KRN",8994,755,2,2,0)
EDATE^1^^1
"KRN",8994,755,2,"B","BDATE",1)

"KRN",8994,755,2,"B","EDATE",2)

"KRN",8994,756,-1)
0^26
"KRN",8994,756,0)
DVBAB REPORT PENDING7131^STRT^DVBAB57^4^R
"KRN",8994,756,1,0)
^^1^1^3010621^
"KRN",8994,756,1,1,0)
Generates a list of pending 7131 requests.
"KRN",8994,756,2,0)
^8994.02A^2^2
"KRN",8994,756,2,1,0)
SELDIV^1^^1
"KRN",8994,756,2,2,0)
DIV^1^^1
"KRN",8994,756,2,"B","DIV",2)

"KRN",8994,756,2,"B","SELDIV",1)

"KRN",8994,757,-1)
0^23
"KRN",8994,757,0)
DVBAB REPORT CPDETAILS^STRT^DVBAB70^2^R
"KRN",8994,757,1,0)
^^1^1^3010621^
"KRN",8994,757,1,1,0)
Returns a detailed summary of a specific C&P request.
"KRN",8994,757,2,0)
^8994.02A^2^2
"KRN",8994,757,2,1,0)
DFN^1
"KRN",8994,757,2,2,0)
ZREQDA^1
"KRN",8994,757,2,"B","DFN",1)

"KRN",8994,757,2,"B","ZREQDA",2)

"KRN",8994,758,-1)
0^32
"KRN",8994,758,0)
DVBAB REPORT 7131INQ^STRT^DVBAB71^4^R
"KRN",8994,758,1,0)
^^1^1^3010621^
"KRN",8994,758,1,1,0)
Returns a 7131 inquiry report.
"KRN",8994,758,2,0)
^8994.02A^2^2
"KRN",8994,758,2,1,0)
ZDFN^1^^1^1
"KRN",8994,758,2,2,0)
RECIEN^1^^1
"KRN",8994,758,2,"B","RECIEN",2)

"KRN",8994,758,2,"B","ZDFN",1)

"KRN",8994,758,2,"PARAMSEQ",1,1)

"KRN",8994,759,-1)
0^33
"KRN",8994,759,0)
DVBAB LABLIST^LABLIST^DVBAB1^4^R
"KRN",8994,759,1,0)
^^1^1^3010621^
"KRN",8994,759,1,1,0)
Returns a list of the site's laboratory test names.
"KRN",8994,760,-1)
0^34
"KRN",8994,760,0)
DVBAB VERSION^VERSION^DVBAB1^1^R
"KRN",8994,760,1,0)
^^1^1^3010621^
"KRN",8994,760,1,1,0)
Used to ensure GUI and VISTA are on the same version of CAPRI.
"KRN",8994,1098,-1)
0^35
"KRN",8994,1098,0)
DVBAB DIVISION^DIVISION^DVBAB1^1^S
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^3010328
"PKG",223,22,1,"PAH",1,0)
35^3010621
"PKG",223,22,1,"PAH",1,1,0)
^^2^2^3010621
"PKG",223,22,1,"PAH",1,1,1,0)
The changes included in this patch are described in the description
"PKG",223,22,1,"PAH",1,1,2,0)
section of patch DVBA*2.7*35 in the National Patch Module
"PRE")
DVBA35P
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
23
"RTN","DVBA35P")
0^^B42131819
"RTN","DVBA35P",1,0)
DVBA35P ;ALB/PRH CAPRI CLEANUP POST-INS DVBA*2.7*35 ;03/02/01
"RTN","DVBA35P",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBA35P",3,0)
 ;
"RTN","DVBA35P",4,0)
 ; This routine contains pre & post subroutines for patch DVBA*2.7*35
"RTN","DVBA35P",5,0)
 ;
"RTN","DVBA35P",6,0)
 ; The post installation routine contains a cleanup routine
"RTN","DVBA35P",7,0)
 ; which will correct errors in the FORM 7131 file (#396).
"RTN","DVBA35P",8,0)
 ; These occurred initially when both the Division and Date were
"RTN","DVBA35P",9,0)
 ; stored in incorrect formats.
"RTN","DVBA35P",10,0)
 ; Division was stored as a name and should be converted to division
"RTN","DVBA35P",11,0)
 ; pointer number.
"RTN","DVBA35P",12,0)
 ; Date was stored as a text date and should be converted to
"RTN","DVBA35P",13,0)
 ; FileMan format.
"RTN","DVBA35P",14,0)
 ;
"RTN","DVBA35P",15,0)
 ; The fields in question (Both piece positions correspond) are;
"RTN","DVBA35P",16,0)
 ; Division - Node 6 - i.e. ^DVB(396,DA,6)
"RTN","DVBA35P",17,0)
 ; Date - Node 7 - i.e. ^DVB(396,DA,7)
"RTN","DVBA35P",18,0)
 ;
"RTN","DVBA35P",19,0)
 ; Div Field #  Date Field #    Position
"RTN","DVBA35P",20,0)
 ;    4.6           4.7             9
"RTN","DVBA35P",21,0)
 ;    5.6           5.7            11
"RTN","DVBA35P",22,0)
 ;    6.6           6.7            13
"RTN","DVBA35P",23,0)
 ;    7.6           7.7            15
"RTN","DVBA35P",24,0)
 ;    9.6           9.7            17
"RTN","DVBA35P",25,0)
 ;   11.6          11.7            19
"RTN","DVBA35P",26,0)
 ;   13.6          13.7            21
"RTN","DVBA35P",27,0)
 ;   15.6          15.7            23
"RTN","DVBA35P",28,0)
 ;   17.6          17.7             7
"RTN","DVBA35P",29,0)
 ;   18.6          18.7            26
"RTN","DVBA35P",30,0)
 ;   20.6          20.7            28
"RTN","DVBA35P",31,0)
 ;
"RTN","DVBA35P",32,0)
 ; In addition the post-install will also update the AMIE site
"RTN","DVBA35P",33,0)
 ; parameter (#396.1) file, field #.11 to extend the number
"RTN","DVBA35P",34,0)
 ; of days to keep the 2507 REQUEST file (#396.3) to 365 days
"RTN","DVBA35P",35,0)
 ;
"RTN","DVBA35P",36,0)
ENV ;Main entry point for Environment check point.
"RTN","DVBA35P",37,0)
 ;
"RTN","DVBA35P",38,0)
 S XPDABORT=""
"RTN","DVBA35P",39,0)
 D PROGCHK(.XPDABORT) ;checks programmer variables
"RTN","DVBA35P",40,0)
 I XPDABORT="" K XPDABORT
"RTN","DVBA35P",41,0)
 ;
"RTN","DVBA35P",42,0)
 Q
"RTN","DVBA35P",43,0)
 ;
"RTN","DVBA35P",44,0)
POST ;Main entry point for Post-init items
"RTN","DVBA35P",45,0)
 ;
"RTN","DVBA35P",46,0)
 D INIT
"RTN","DVBA35P",47,0)
 D POST1 ;Correct (#396) file entries
"RTN","DVBA35P",48,0)
 D POST2 ;Update (#396.1) file, field (#.11)
"RTN","DVBA35P",49,0)
 D POST3 ;Email totals
"RTN","DVBA35P",50,0)
 ;
"RTN","DVBA35P",51,0)
 Q
"RTN","DVBA35P",52,0)
 ;
"RTN","DVBA35P",53,0)
INIT ;Post-install Initialization
"RTN","DVBA35P",54,0)
 ;
"RTN","DVBA35P",55,0)
 ;The XTMP global will hold four variables
"RTN","DVBA35P",56,0)
 ;     Piece 1 = Date/Time run stared (FileMan format)
"RTN","DVBA35P",57,0)
 ;     Piece 2 = Number of Division entries modified - DVBCTR1
"RTN","DVBA35P",58,0)
 ;     Piece 3 = Number of date entries modified - DVBCTR2
"RTN","DVBA35P",59,0)
 ;     Piece 4 = History file updated? (0=No 1=Yes)
"RTN","DVBA35P",60,0)
 ;
"RTN","DVBA35P",61,0)
 K ^XTMP("DVBA35P")
"RTN","DVBA35P",62,0)
 S ^XTMP("DVBA35P",0)=$$NOW^XLFDT()_U_0_U_0_U_0
"RTN","DVBA35P",63,0)
 ;
"RTN","DVBA35P",64,0)
 Q
"RTN","DVBA35P",65,0)
 ;
"RTN","DVBA35P",66,0)
POST1 ;Correct (#396) file entries
"RTN","DVBA35P",67,0)
 ;
"RTN","DVBA35P",68,0)
 N DVBCTR1,DVBCTR2
"RTN","DVBA35P",69,0)
 ;
"RTN","DVBA35P",70,0)
 D BMES^XPDUTL("  >> starting Post-installation for DVBA*2.7*35")
"RTN","DVBA35P",71,0)
 ;
"RTN","DVBA35P",72,0)
 D LOOP
"RTN","DVBA35P",73,0)
 ;
"RTN","DVBA35P",74,0)
 I (DVBCTR1+DVBCTR2) D
"RTN","DVBA35P",75,0)
 . D BMES^XPDUTL("    "_DVBCTR1_" Division entries corrected in FORM 7131 file")
"RTN","DVBA35P",76,0)
 . D MES^XPDUTL("    "_DVBCTR2_" Date entries corrected in FORM 7131 file")
"RTN","DVBA35P",77,0)
 ;
"RTN","DVBA35P",78,0)
 S $P(^XTMP("DVBA35P",0),U,2,3)=DVBCTR1_U_DVBCTR2
"RTN","DVBA35P",79,0)
 ;
"RTN","DVBA35P",80,0)
 Q
"RTN","DVBA35P",81,0)
 ;
"RTN","DVBA35P",82,0)
POST2 ;Update (#396.1) file, field (#.11)
"RTN","DVBA35P",83,0)
 ;
"RTN","DVBA35P",84,0)
 ;Retain 2507 REQUEST (#396.3) file for 365 days
"RTN","DVBA35P",85,0)
 ;
"RTN","DVBA35P",86,0)
 N DA,DIE,DR,DVBARR,DVBERR
"RTN","DVBA35P",87,0)
 ;
"RTN","DVBA35P",88,0)
 ;First check how many days they retain at the moment
"RTN","DVBA35P",89,0)
 K DVBARR,DVBERR
"RTN","DVBA35P",90,0)
 D GETS^DIQ(396.1,1,.11,"I","DVBARR","DVBERR")
"RTN","DVBA35P",91,0)
 Q:$D(DVBERR)
"RTN","DVBA35P",92,0)
 I $G(DVBARR(396.1,"1,",.11,"I"))>364 D  Q  ;Already exceeds 364 days
"RTN","DVBA35P",93,0)
 . S $P(^XTMP("DVBA35P",0),U,4)=0 ;No change
"RTN","DVBA35P",94,0)
 ;
"RTN","DVBA35P",95,0)
 S DA=1,DIE="^DVB(396.1,",DR=".11///365"
"RTN","DVBA35P",96,0)
 D ^DIE
"RTN","DVBA35P",97,0)
 S $P(^XTMP("DVBA35P",0),U,4)=1 ;Updated
"RTN","DVBA35P",98,0)
 ;
"RTN","DVBA35P",99,0)
 D BMES^XPDUTL("  2507 REQUEST FILE (#396.3) History retention updated to 365 days")
"RTN","DVBA35P",100,0)
 D BMES^XPDUTL("  >> Post-installation completed")
"RTN","DVBA35P",101,0)
 ;
"RTN","DVBA35P",102,0)
 Q
"RTN","DVBA35P",103,0)
 ;
"RTN","DVBA35P",104,0)
POST3 ; send e-mail to user's
"RTN","DVBA35P",105,0)
 ;
"RTN","DVBA35P",106,0)
 ; if not in production account, do not send notification message (exit)
"RTN","DVBA35P",107,0)
 X ^%ZOSF("UCI") I Y'=^%ZOSF("PROD") Q
"RTN","DVBA35P",108,0)
 ;
"RTN","DVBA35P",109,0)
 N DIFROM,DVBCTR1,DVBCTR2,DVBSITE,DVBSTIME,DVBETIME,DVBSTR,DVBTEXT,DVBUPD,XMY,XMDUN,XMDUZ,XMSUB,XMTEXT,XMZ
"RTN","DVBA35P",110,0)
 S DVBSITE=$$SITE^VASITE
"RTN","DVBA35P",111,0)
 S DVBSTR=^XTMP("DVBA35P",0)
"RTN","DVBA35P",112,0)
 S DVBSTIME=$P(DVBSTR,U,1),DVBCTR1=$P(DVBSTR,U,2),DVBCTR2=$P(DVBSTR,U,3)
"RTN","DVBA35P",113,0)
 S DVBUPD=$P(DVBSTR,U,4)
"RTN","DVBA35P",114,0)
 S DVBETIME=$$NOW^XLFDT()      ;end date/time
"RTN","DVBA35P",115,0)
 S XMDUZ=.5,XMY(XMDUZ)="",XMY(DUZ)="",XMTEXT="DVBTEXT("
"RTN","DVBA35P",116,0)
 S XMY("G.PCMM TESTING@FORUM.VA.GOV")=""  ;e-mail all sites totals to
"RTN","DVBA35P",117,0)
 S XMSUB="Patch DVBA*2.7*35 Post Install Routine ("_$P(DVBSITE,U,3)_")"
"RTN","DVBA35P",118,0)
 ;
"RTN","DVBA35P",119,0)
 S DVBTEXT(1)=""
"RTN","DVBA35P",120,0)
 S DVBTEXT(2)="          Facility Name:  "_$P(DVBSITE,"^",2)
"RTN","DVBA35P",121,0)
 S DVBTEXT(3)="         Station Number:  "_$P(DVBSITE,"^",3)
"RTN","DVBA35P",122,0)
 S DVBTEXT(4)=""
"RTN","DVBA35P",123,0)
 S DVBTEXT(5)="  Date/Time job started:  "_$$FMTE^XLFDT(DVBSTIME)
"RTN","DVBA35P",124,0)
 S DVBTEXT(6)="  Date/Time job stopped:  "_$$FMTE^XLFDT(DVBETIME)
"RTN","DVBA35P",125,0)
 S DVBTEXT(7)=""
"RTN","DVBA35P",126,0)
 S DVBTEXT(8)=$J(DVBCTR1,5)_" Division entries corrected in FORM 7131 file"
"RTN","DVBA35P",127,0)
 S DVBTEXT(9)=$J(DVBCTR2,5)_" Date entries corrected in FORM 7131 file"
"RTN","DVBA35P",128,0)
 S DVBTEXT(10)=""
"RTN","DVBA35P",129,0)
 I DVBUPD S DVBTEXT(11)="  2507 REQUEST FILE (#396.3) History retention updated to 365 days"
"RTN","DVBA35P",130,0)
 S DVBTEXT(12)=""
"RTN","DVBA35P",131,0)
 S DVBTEXT(13)="  >> Post-installation completed"
"RTN","DVBA35P",132,0)
 S DVBTEXT(14)=""
"RTN","DVBA35P",133,0)
 ;
"RTN","DVBA35P",134,0)
 D ^XMD
"RTN","DVBA35P",135,0)
 ;
"RTN","DVBA35P",136,0)
 K ^XTMP("DVBA35P")
"RTN","DVBA35P",137,0)
 ;
"RTN","DVBA35P",138,0)
 Q
"RTN","DVBA35P",139,0)
 ;
"RTN","DVBA35P",140,0)
LOOP ;Loop ^DVB(396 file to find incorrect entries and correct them
"RTN","DVBA35P",141,0)
 ;
"RTN","DVBA35P",142,0)
 N CNTR,DA,DAX,DIE,DR,DVB6F,DVB7F,DVBARR,DVBERR,DVBDIV,DVBDIVN,DVBDAT,FLD,X,Y
"RTN","DVBA35P",143,0)
 ;
"RTN","DVBA35P",144,0)
 S (DA,DVBCTR1,DVBCTR2)=0,DIE="^DVB(396,"
"RTN","DVBA35P",145,0)
 ;
"RTN","DVBA35P",146,0)
 ;DVB6F = Relevant Division Fields
"RTN","DVBA35P",147,0)
 S DVB6F="4.6;5.6;6.6;7.6;9.6;11.6;13.6;15.6;17.6;18.6;20.6"
"RTN","DVBA35P",148,0)
 ;
"RTN","DVBA35P",149,0)
 ;DVB7F = Relevant Date Fields
"RTN","DVBA35P",150,0)
 S DVB7F="4.7;5.7;6.7;7.7;9.7;11.7;13.7;15.7;17.7;18.7;20.7"
"RTN","DVBA35P",151,0)
 ;
"RTN","DVBA35P",152,0)
 F  S DA=$O(^DVB(396,DA)) Q:'DA!(DA'?1.N)  D
"RTN","DVBA35P",153,0)
 . S DAX=DA_","
"RTN","DVBA35P",154,0)
 . I $D(^DVB(396,DA,6)) D                   ;Division string exists
"RTN","DVBA35P",155,0)
 . . K DVBARR,DVBERR
"RTN","DVBA35P",156,0)
 . . D GETS^DIQ(396,DAX,DVB6F,"I","DVBARR","DVBERR")
"RTN","DVBA35P",157,0)
 . . Q:$D(DVBERR)                           ;Error found
"RTN","DVBA35P",158,0)
 . . F CNTR=1:1:$L(DVB6F,";") S FLD=$P(DVB6F,";",CNTR) D
"RTN","DVBA35P",159,0)
 . . . S DVBDIV=$G(DVBARR(396,DAX,FLD,"I"))
"RTN","DVBA35P",160,0)
 . . . Q:DVBDIV=""                          ;No entry made
"RTN","DVBA35P",161,0)
 . . . Q:$E(DVBDIV,1)?1N                    ;Division correct format
"RTN","DVBA35P",162,0)
 . . . S DVBDIVN=$O(^DG(40.8,"B",DVBDIV,""))
"RTN","DVBA35P",163,0)
 . . . S DR=FLD_"///"_DVBDIVN
"RTN","DVBA35P",164,0)
 . . . D ^DIE
"RTN","DVBA35P",165,0)
 . . . S DVBCTR1=DVBCTR1+1
"RTN","DVBA35P",166,0)
 . ;Now check the Date
"RTN","DVBA35P",167,0)
 . I $D(^DVB(396,DA,7)) D  ;Date string exists
"RTN","DVBA35P",168,0)
 . . K DVBARR,DVBERR
"RTN","DVBA35P",169,0)
 . . D GETS^DIQ(396,DAX,DVB7F,"I","DVBARR","DVBERR")
"RTN","DVBA35P",170,0)
 . . Q:$D(DVBERR)                           ;Error found
"RTN","DVBA35P",171,0)
 . . F CNTR=1:1:$L(DVB7F,";") S FLD=$P(DVB7F,";",CNTR) D
"RTN","DVBA35P",172,0)
 . . . S DVBDAT=$G(DVBARR(396,DAX,FLD,"I"))
"RTN","DVBA35P",173,0)
 . . . Q:DVBDAT=""                          ;No entry made
"RTN","DVBA35P",174,0)
 . . . Q:$E(DVBDAT,1)?1N                    ;Date correct format
"RTN","DVBA35P",175,0)
 . . . S X=DVBDAT D ^%DT
"RTN","DVBA35P",176,0)
 . . . Q:Y=-1
"RTN","DVBA35P",177,0)
 . . . S DR=FLD_"///"_Y
"RTN","DVBA35P",178,0)
 . . . D ^DIE
"RTN","DVBA35P",179,0)
 . . . S DVBCTR2=DVBCTR2+1
"RTN","DVBA35P",180,0)
 ;
"RTN","DVBA35P",181,0)
 Q
"RTN","DVBA35P",182,0)
 ;
"RTN","DVBA35P",183,0)
PROGCHK(XPDABORT) ;checks for necessary programmer variables
"RTN","DVBA35P",184,0)
 ;
"RTN","DVBA35P",185,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","DVBA35P",186,0)
 . D BMES^XPDUTL("*****")
"RTN","DVBA35P",187,0)
 . D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","DVBA35P",188,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","DVBA35P",189,0)
 . D MES^XPDUTL("*****")
"RTN","DVBA35P",190,0)
 . S XPDABORT=2
"RTN","DVBA35P",191,0)
 ;
"RTN","DVBA35P",192,0)
 Q
"RTN","DVBA35P",193,0)
 ;
"RTN","DVBA35P",194,0)
PARMCHK(XPDABORT) ;checks for proper param file ien
"RTN","DVBA35P",195,0)
 ;
"RTN","DVBA35P",196,0)
 I '$D(^DVB(396.1,1)) D
"RTN","DVBA35P",197,0)
 . D BMES^XPDUTL("*****")
"RTN","DVBA35P",198,0)
 . D MES^XPDUTL("Parameter file (#396.1) does not have proper IEN (1).")
"RTN","DVBA35P",199,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","DVBA35P",200,0)
 . D MES^XPDUTL("*****")
"RTN","DVBA35P",201,0)
 . S XPDABORT=2
"RTN","DVBA35P",202,0)
 ;
"RTN","DVBA35P",203,0)
 Q
"RTN","DVBAB1")
0^1^B34682123
"RTN","DVBAB1",1,0)
DVBAB1 ;ALB/SPH - CAPRI UTILITIES ;01/01/00
"RTN","DVBAB1",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB1",3,0)
 ;
"RTN","DVBAB1",4,0)
VERSION(ZMSG) ;
"RTN","DVBAB1",5,0)
 ; Must have a letter at the end of the Version for Delphi
"RTN","DVBAB1",6,0)
 ; compatability
"RTN","DVBAB1",7,0)
 ; 1st piece is version description
"RTN","DVBAB1",8,0)
 ; 2nd piece can be YESOLD or NOOLD
"RTN","DVBAB1",9,0)
 ; YESOLD = Allow old GUI to run with new KID
"RTN","DVBAB1",10,0)
 ; NOOLD = Do not allow old GUI to run with newer version
"RTN","DVBAB1",11,0)
 S ZMSG="CAPRI GUI V2.7*35*18*H^NOOLD"
"RTN","DVBAB1",12,0)
 Q
"RTN","DVBAB1",13,0)
 ;
"RTN","DVBAB1",14,0)
DIVISION(Y) ; Returns Name for an Institution
"RTN","DVBAB1",15,0)
 N DVBARR,DVBERR
"RTN","DVBAB1",16,0)
 S Y=""
"RTN","DVBAB1",17,0)
 Q:$G(DUZ(2))=""
"RTN","DVBAB1",18,0)
 D GETS^DIQ(4,DUZ(2)_",0",".01","I","DVBARR","DVBERR")
"RTN","DVBAB1",19,0)
 Q:$D(DVBERR)
"RTN","DVBAB1",20,0)
 S Y=$G(DVBARR(4,DUZ(2)_",0,",.01,"I"))
"RTN","DVBAB1",21,0)
 Q
"RTN","DVBAB1",22,0)
 ;
"RTN","DVBAB1",23,0)
DT(Y,X1,X2)  ; Returns date X1 minus X2 days
"RTN","DVBAB1",24,0)
 ; change the '00:00' that could be passed so Fileman doesn't reject
"RTN","DVBAB1",25,0)
 ;C^%DTC(X1,X2)
"RTN","DVBAB1",26,0)
 ;S %DT=$G(%DT,"TS") D ^%DT K %DT
"RTN","DVBAB1",27,0)
 ;K %DT,X1,X2
"RTN","DVBAB1",28,0)
 ;Q
"RTN","DVBAB1",29,0)
DPA(LIST,DFN,CHOICE)       ;Display Patient Appointments
"RTN","DVBAB1",30,0)
 S DVBABCNT=1
"RTN","DVBAB1",31,0)
 S LIST=""
"RTN","DVBAB1",32,0)
 I '$D(DFN) S LIST="MISSING PATIENT NAME" Q
"RTN","DVBAB1",33,0)
 I '$D(CHOICE) S LIST="MISSING ALL, PAST, OR FUTURE" Q
"RTN","DVBAB1",34,0)
 I CHOICE["A" D
"RTN","DVBAB1",35,0)
 .S SDT=0
"RTN","DVBAB1",36,0)
 .S X="T+730" D ^%DT
"RTN","DVBAB1",37,0)
 .I Y<0 S LIST="ERROR IN CALCULATING ENDING DATE RANGE"
"RTN","DVBAB1",38,0)
 .S EDT=Y+.9
"RTN","DVBAB1",39,0)
 I CHOICE["F" D
"RTN","DVBAB1",40,0)
 .S X="T+1" D ^%DT
"RTN","DVBAB1",41,0)
 .I Y<0 S LIST="ERROR IN CALCULATING START DATE RANGE"
"RTN","DVBAB1",42,0)
 .S SDT=Y
"RTN","DVBAB1",43,0)
 .K X,Y
"RTN","DVBAB1",44,0)
 .S X="T+730" D ^%DT
"RTN","DVBAB1",45,0)
 .I Y<0 S LIST="ERROR IN CALCULATING ENDING DATE RANGE"
"RTN","DVBAB1",46,0)
 .S EDT=Y+.9
"RTN","DVBAB1",47,0)
 I CHOICE["P" D
"RTN","DVBAB1",48,0)
 .S X="T" D ^%DT
"RTN","DVBAB1",49,0)
 .I Y<0 S LIST="ERROR IN CALCULATING ENDING DATE RANGE"
"RTN","DVBAB1",50,0)
 .S EDT=Y+.9
"RTN","DVBAB1",51,0)
 .K X,Y
"RTN","DVBAB1",52,0)
 .S SDT=0
"RTN","DVBAB1",53,0)
 Q:LIST["ERROR"
"RTN","DVBAB1",54,0)
 I $O(^DPT(DFN,"S",SDT))'>0 S LIST="NO APPOINTMENTS FOUND FOR YOUR DATE RANGE" Q
"RTN","DVBAB1",55,0)
 F  S SDT=$O(^DPT(DFN,"S",SDT)) Q:'SDT!(SDT>EDT)  D
"RTN","DVBAB1",56,0)
 .S CLN=$P(^DPT(DFN,"S",SDT,0),"^")
"RTN","DVBAB1",57,0)
 .Q:'$D(^SC(CLN,0))
"RTN","DVBAB1",58,0)
 .S CLN=$P(^SC(CLN,0),"^")
"RTN","DVBAB1",59,0)
 .S ZZ=$L(CLN)
"RTN","DVBAB1",60,0)
 .I ZZ<31 D
"RTN","DVBAB1",61,0)
 ..F ZZZ=ZZ:1:30 S CLN=CLN_" "
"RTN","DVBAB1",62,0)
 .S Y=SDT X ^DD("DD")
"RTN","DVBAB1",63,0)
 .S ZZ2=$L(Y)
"RTN","DVBAB1",64,0)
 .I ZZ2<21 D
"RTN","DVBAB1",65,0)
 ..F ZZZ2=ZZ2:1:20 S Y=Y_" "
"RTN","DVBAB1",66,0)
 .S STATUS=$P(^DPT(DFN,"S",SDT,0),"^",2)
"RTN","DVBAB1",67,0)
 .I STATUS'="" D
"RTN","DVBAB1",68,0)
 ..I STATUS="N" S STATUS="NO-SHOW"
"RTN","DVBAB1",69,0)
 ..I STATUS="C" S STATUS="CANCELLED BY CLINIC"
"RTN","DVBAB1",70,0)
 ..I STATUS="CA" S STATUS="CANCELLED BY CLINIC & AUTO RE-BOOK"
"RTN","DVBAB1",71,0)
 ..I STATUS="NA" S STATUS="NO-SHOW & AUTO-REBOOK"
"RTN","DVBAB1",72,0)
 ..I STATUS="I" S STATUS="INPATIENT APPOINTMENT"
"RTN","DVBAB1",73,0)
 ..I STATUS="PC" S STATUS="CANCELLED BY PATIENT"
"RTN","DVBAB1",74,0)
 ..I STATUS="PCA" S STATUS="CANCELLED BY PATIENT & AUTO RE-BOOK"
"RTN","DVBAB1",75,0)
 ..I STATUS="NT" S STATUS="NO ACTION TAKEN"
"RTN","DVBAB1",76,0)
 .S LIST(DVBABCNT)=CLN_"  "_Y_" "_STATUS,DVBABCNT=DVBABCNT+1
"RTN","DVBAB1",77,0)
 .W !,LIST(DVBABCNT-1)
"RTN","DVBAB1",78,0)
 K DFN,X,%DT,CLN,CHOICE,Y,SDT,EDT
"RTN","DVBAB1",79,0)
 Q
"RTN","DVBAB1",80,0)
DTTM(Y) ;
"RTN","DVBAB1",81,0)
 S Y=$$HTE^XLFDT($H,"P")
"RTN","DVBAB1",82,0)
 Q
"RTN","DVBAB1",83,0)
CHKCRED(Y) ;KLB
"RTN","DVBAB1",84,0)
 S Y="[OK]"
"RTN","DVBAB1",85,0)
 I '$D(DUZ(2)) S Y="Your division number is missing." Q
"RTN","DVBAB1",86,0)
 I $D(DUZ)#2=0 S Y="Your user number is invalid." Q
"RTN","DVBAB1",87,0)
 I +DUZ(2)<1 S Y="Invalid division." Q
"RTN","DVBAB1",88,0)
 Q
"RTN","DVBAB1",89,0)
PTINQ(REF,DFN) ; Return formatted pt inquiry report
"RTN","DVBAB1",90,0)
 K ^TMP("ORDATA",$J,1)
"RTN","DVBAB1",91,0)
 D DGINQ^ORCXPND1(DFN)
"RTN","DVBAB1",92,0)
 S REF=$NA(^TMP("ORDATA",$J,1))
"RTN","DVBAB1",93,0)
 K DFN
"RTN","DVBAB1",94,0)
 Q
"RTN","DVBAB1",95,0)
LABLIST(Y) ; Returns list of LAB TEST NAMES
"RTN","DVBAB1",96,0)
 N DVBABCNT,DVBABIEN
"RTN","DVBAB1",97,0)
 S DVBABCNT=0,DVBABIEN=0
"RTN","DVBAB1",98,0)
 F  S DVBABIEN=$O(^LAB(60,DVBABIEN)) Q:'DVBABIEN  D
"RTN","DVBAB1",99,0)
 .S DVBABLNM=$P($G(^LAB(60,DVBABIEN,0)),"^",1)
"RTN","DVBAB1",100,0)
 .S ^TMP("DVBALAB1",DUZ,DVBABCNT)=DVBABLNM_"^"_DVBABIEN_$C(13),DVBABCNT=DVBABCNT+1
"RTN","DVBAB1",101,0)
 S Y=$NA(^TMP("DVBALAB1",DUZ))
"RTN","DVBAB1",102,0)
 K DVBABCNT,DVBABLNM,DVBABIEN
"RTN","DVBAB1",103,0)
 Q
"RTN","DVBAB1",104,0)
 ;
"RTN","DVBAB1",105,0)
INSTLIST(Y) ; Returns full list of Institutions
"RTN","DVBAB1",106,0)
 N DVBABCNT,DVBABIEN,DVBABNM,DVBABSTN,DVBABST,DVBABDS,DVBARR,DVBERR
"RTN","DVBAB1",107,0)
 K Y,^TMP("DVBAINST",DUZ)
"RTN","DVBAB1",108,0)
 S (DVBABCNT,DVBABIEN)=0
"RTN","DVBAB1",109,0)
 F  S DVBABIEN=$O(^DIC(4,DVBABIEN)) Q:'DVBABIEN  D 
"RTN","DVBAB1",110,0)
 . K DVBARR,DVBERR
"RTN","DVBAB1",111,0)
 . D GETS^DIQ(4,DVBABIEN_",0",".01:.02:.03","I","DVBARR","DVBERR")
"RTN","DVBAB1",112,0)
 . Q:$D(DVBERR)
"RTN","DVBAB1",113,0)
 . S DVBABNM=$G(DVBARR(4,DVBABIEN_",0,",.01,"I"))
"RTN","DVBAB1",114,0)
 . Q:DVBABNM=""
"RTN","DVBAB1",115,0)
 . S DVBABSTN=$G(DVBARR(4,DVBABIEN_",0,",.02,"I"))
"RTN","DVBAB1",116,0)
 . Q:DVBABSTN=""
"RTN","DVBAB1",117,0)
 . S DVBABDS=$G(DVBARR(4,DVBABIEN_",0,",.03,"I"))
"RTN","DVBAB1",118,0)
 . K DVBARR,DVBERR
"RTN","DVBAB1",119,0)
 . D GETS^DIQ(5,DVBABSTN_",0",.01,"I","DVBARR","DVBERR")
"RTN","DVBAB1",120,0)
 . Q:$D(DVBERR)
"RTN","DVBAB1",121,0)
 . S DVBABST=$G(DVBARR(5,DVBABSTN_",0,",.01,"I"))
"RTN","DVBAB1",122,0)
 . S ^TMP("DVBAINST",DUZ,DVBABCNT)=DVBABNM_"^"_DVBABST_"^"_DVBABDS_"^"_DVBABIEN_$C(13)
"RTN","DVBAB1",123,0)
 . S DVBABCNT=DVBABCNT+1
"RTN","DVBAB1",124,0)
 S Y=$NA(^TMP("DVBAINST",DUZ))
"RTN","DVBAB1",125,0)
 Q
"RTN","DVBAB1",126,0)
 ;
"RTN","DVBAB1",127,0)
INCEXAM(ZMSG) ;Increased exam # in file  and passes back the # to user
"RTN","DVBAB1",128,0)
 S ZMSG=+$G(^DVB(396.1,1,5))
"RTN","DVBAB1",129,0)
 S ZMSG=ZMSG+1
"RTN","DVBAB1",130,0)
 S ^DVB(396.1,1,5)=ZMSG
"RTN","DVBAB1",131,0)
 Q
"RTN","DVBAB1",132,0)
 ;
"RTN","DVBAB1",133,0)
MSG(ERR,DUZ,XMSUB,XMTEXT,MGN) ;Generate mail message;KLB
"RTN","DVBAB1",134,0)
 S ERR=""
"RTN","DVBAB1",135,0)
 K ^TMP($J,"AMIE")
"RTN","DVBAB1",136,0)
 I '$D(DUZ) S ERR="MISSING DUZ" Q
"RTN","DVBAB1",137,0)
 I '$D(XMSUB) S ERR="MISSING SUBJECT" Q
"RTN","DVBAB1",138,0)
 I '$D(XMTEXT) S ERR="MISSING TEXT" Q
"RTN","DVBAB1",139,0)
 I '$D(MGN) S ERR="MISSING MAIL GROUP NAME" Q
"RTN","DVBAB1",140,0)
 S XMDUZ=DUZ
"RTN","DVBAB1",141,0)
 S J=0
"RTN","DVBAB1",142,0)
 F  S J=$O(XWBS1(J)) Q:'J  S ^TMP($J,"AMIE",J)=$G(XWBS1(J))
"RTN","DVBAB1",143,0)
 S XMTEXT="^TMP($J,""AMIE"","
"RTN","DVBAB1",144,0)
 S DIC="^XMB(3.8,",DIC(0)="QM",X=MGN D ^DIC
"RTN","DVBAB1",145,0)
 S MG=+Y
"RTN","DVBAB1",146,0)
 I +Y<0 S ERR="INVALID MAIL GROUP NAME" Q
"RTN","DVBAB1",147,0)
 S ZZ=0,ZZ1=0
"RTN","DVBAB1",148,0)
 F  S ZZ=$O(^XMB(3.8,MG,1,"B",ZZ)) Q:'ZZ  D
"RTN","DVBAB1",149,0)
 .F  S ZZ1=$O(^XMB(3.8,MG,1,"B",ZZ,ZZ1)) Q:'ZZ1  S XMY(ZZ)=""
"RTN","DVBAB1",150,0)
 S XMY(XMDUZ)=""
"RTN","DVBAB1",151,0)
 D ^XMD
"RTN","DVBAB1",152,0)
 I $D(XMMG) S ERR=XMMG
"RTN","DVBAB1",153,0)
 I '$D(XMMG) S ERR="MESSAGE SENT"
"RTN","DVBAB1",154,0)
 K XMSUB,XMTEXT,MGN,DIC,DIC(0),ZZ,XMY,XWBS1,J,ZZ1,MG,^TMP($J,"AMIE"),XMMG,Y,XMDUZ
"RTN","DVBAB1",155,0)
 Q
"RTN","DVBAB1",156,0)
FINDEXAM(ZMSG,ZIEN) ;Returns list of exams in 396.4 that are linked to ZIEN in 396.3
"RTN","DVBAB1",157,0)
 N DVBABCNT,DVBABIEN
"RTN","DVBAB1",158,0)
 S DVBABCNT=0,DVBABIEN=0
"RTN","DVBAB1",159,0)
 F  S DVBABIEN=$O(^DVB(396.4,"C",ZIEN,DVBABIEN)) Q:'DVBABIEN  D
"RTN","DVBAB1",160,0)
 .S DVBABD1=$P($G(^DVB(396.4,DVBABIEN,0)),"^",2)
"RTN","DVBAB1",161,0)
 .S DVBABD2=$P($G(^DVB(396.6,+$P($G(^DVB(396.4,DVBABIEN,0)),"^",3),0)),"^",1)  ;Name of Exam
"RTN","DVBAB1",162,0)
 .S DVBABD3=$P($G(^DVB(396.4,DVBABIEN,0)),"^",4)
"RTN","DVBAB1",163,0)
 .I DVBABD3="O" S DVBABD3="[OPEN]"
"RTN","DVBAB1",164,0)
 .I DVBABD3="C" S DVBABD3="[COMPLETE]"
"RTN","DVBAB1",165,0)
 .I DVBABD3="X" S DVBABD3="[CANCELED BY MAS]"
"RTN","DVBAB1",166,0)
 .I DVBABD3="RX" S DVBABD3="[CANCELED BY RO]"
"RTN","DVBAB1",167,0)
 .I DVBABD3="T" S DVBABD3="[TRANSFERRED OUT]"
"RTN","DVBAB1",168,0)
 .I ZIEN=DVBABD1 D
"RTN","DVBAB1",169,0)
 ..S ZMSG(DVBABCNT)=DVBABIEN_"^"_DVBABD2_" "_DVBABD3
"RTN","DVBAB1",170,0)
 ..S DVBABCNT=DVBABCNT+1
"RTN","DVBAB1",171,0)
 K DVBABCNT,DVBABIEN,ZIEN,DVBABD1,DVBABD2,DVBABD3
"RTN","DVBAB1",172,0)
 Q
"RTN","DVBAB2")
0^27^B16063275
"RTN","DVBAB2",1,0)
DVBAB2 ;ALB/KLB - CAPRI RO AMIS REPORT CONT. ;05/01/00
"RTN","DVBAB2",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB2",3,0)
 ;
"RTN","DVBAB2",4,0)
DAY30 K ^TMP("DVBC",$J)
"RTN","DVBAB2",5,0)
 F FA=DTRPT-.1:0 S FA=$O(^DPT(PNAM,"S",FA)) Q:FA=""!(FA>EDATE)  I $D(^(FA,0)) S L=^(0),C=+L S YY=$P(L,U,2) I YY'="N"&(YY'="C")&(YY'="NA")&(YY'="CA")&(YY'="PC")&(YY'="PCA") I FA'>EDATE S ^TMP("DVBC",$J,9999999-FA,FA)=""
"RTN","DVBAB2",6,0)
 Q:'$D(^TMP("DVBC",$J))  S FB=$O(^TMP("DVBC",$J,0)),FA=$O(^TMP("DVBC",$J,FB,0)) I FA]"" S X2=FA,X1=$S(DTSCHEDC]"":DTSCHEDC,1:DVBCNOW) D ^%DTC I X>30 S TOT("30DAYEX")=TOT("30DAYEX")+1
"RTN","DVBAB2",7,0)
 Q
"RTN","DVBAB2",8,0)
 ;
"RTN","DVBAB2",9,0)
PENDCNT I X'<0&(X'>90) S TOT("P90")=TOT("P90")+1
"RTN","DVBAB2",10,0)
 I X>90&(X'>120) S TOT("P121")=TOT("P121")+1
"RTN","DVBAB2",11,0)
 I X>120&(X'>150) S TOT("P151")=TOT("P151")+1
"RTN","DVBAB2",12,0)
 I X>150&(X'>180) S TOT("P181")=TOT("P181")+1
"RTN","DVBAB2",13,0)
 I X>180&(X'>365) S TOT("P365")=TOT("P365")+1
"RTN","DVBAB2",14,0)
 I X>365 S TOT("P366")=TOT("P366")+1
"RTN","DVBAB2",15,0)
 Q
"RTN","DVBAB2",16,0)
 ;
"RTN","DVBAB2",17,0)
SET S DTA=^DVB(396.3,REQDA,0),DTREQ=$P(DTA,U,2),XRONUM=$P(DTA,U,3),XRONUM=$S($D(^DIC(4,+XRONUM,99)):$P(^(99),U,1),1:0) Q:XRONUM'=RONUM&(RONUM'="ALL")
"RTN","DVBAB2",18,0)
 K XRONUM S DTRPT=$P(DTA,U,5),DTSCHEDC=$P(DTA,U,6),DTRQCMP=$P(DTA,U,7),DTTRANS=$P(DTA,U,12),DTREL=$P(DTA,U,14),RQSTAT=$P(DTA,U,18),DTCAN=$P(DTA,U,19),PRIO=$P(DTA,U,10) K DTA
"RTN","DVBAB2",19,0)
 I DTRPT="",DTCAN]"" S DTRPT=DTCAN
"RTN","DVBAB2",20,0)
 Q:DTRPT=""  ;requests never printed
"RTN","DVBAB2",21,0)
 I DTREL'<BDATE,DTREL'>EDATE D DAY30
"RTN","DVBAB2",22,0)
 I DTRPT'<BDATE,DTRPT'>EDATE S TOT("SENT")=TOT("SENT")+1
"RTN","DVBAB2",23,0)
 I DTRPT'<BDATE,DTRPT'>EDATE,RQSTAT'["X" S X1=$S(DTSCHEDC]"":DTSCHEDC,1:DVBCNOW),X2=DTRPT D ^%DTC I X>3 S TOT("3DAYSCH")=TOT("3DAYSCH")+1
"RTN","DVBAB2",24,0)
 I DTREL'<BDATE&(DTREL'>EDATE),RQSTAT="C"!(RQSTAT="R") S:PRIO'="E" DVBCPCTM=$$PROCDAY^DVBCUTL2(REQDA) S:PRIO="E" DVBCPCTM=$$INSFTME^DVBCUTA1(REQDA) S TOT("DAYS")=TOT("DAYS")+DVBCPCTM K DVBCPCTM
"RTN","DVBAB2",25,0)
 I DTRPT'>EDATE,"^P^S^T"[RQSTAT S TOT("PENDADJ")=TOT("PENDADJ")+1,X1=EDATE,X2=DTRPT D ^%DTC,PENDCNT
"RTN","DVBAB2",26,0)
 I DTRPT'>EDATE,"^C^CT^R^RX^X^"[RQSTAT,(+DTREL>EDATE)!(+DTCAN>EDATE) S TOT("PENDADJ")=TOT("PENDADJ")+1,X1=EDATE,X2=DTRPT D ^%DTC,PENDCNT
"RTN","DVBAB2",27,0)
 I DTREL'<BDATE&(DTREL'>EDATE),RQSTAT["C"!(RQSTAT="R") S TOT("COMPLETED")=TOT("COMPLETED")+1
"RTN","DVBAB2",28,0)
 I DTRPT'<BDATE,DTRPT'>EDATE,PRIO="E" S TOT("INSUFF")=TOT("INSUFF")+1
"RTN","DVBAB2",29,0)
 I DTCAN'<BDATE&(DTCAN'>EDATE),RQSTAT="X"!(RQSTAT="RX") S TOT("INCOMPLETE")=TOT("INCOMPLETE")+1
"RTN","DVBAB2",30,0)
 K DTRPT Q
"RTN","DVBAB2",31,0)
 ;
"RTN","DVBAB2",32,0)
GO S DVBABCNT=0
"RTN","DVBAB2",33,0)
 S %DT="TS",X="NOW" D ^%DT S DVBCNOW=Y
"RTN","DVBAB2",34,0)
 S PNAM="" F JJ=0:0 S PNAM=$O(^DVB(396.3,"B",PNAM)) Q:PNAM=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",PNAM,REQDA)) Q:REQDA=""  D SET
"RTN","DVBAB2",35,0)
 S TOT("AVGDAYS")=0 I TOT("COMPLETED")>0 S TOT("AVGDAYS")=TOT("DAYS")/TOT("COMPLETED"),TOT("AVGDAYS")=$J(TOT("AVGDAYS"),5,1)
"RTN","DVBAB2",36,0)
 D BULLTXT^DVBCAMR1
"RTN","DVBAB2",37,0)
 F JI=0:0 S JI=$O(^TMP($J,JI)) Q:JI=""  S DVBABCNT=DVBABCNT+1,MSG(DVBABCNT)=^TMP($J,JI,0)
"RTN","DVBAB2",38,0)
 S:'$D(XMY) SBULL="N" I SBULL="Y" D SEND
"RTN","DVBAB2",39,0)
 ;
"RTN","DVBAB2",40,0)
EXIT K BDATE,%DT,DVBABCNT,C,DTCAN,DTREL,DTREQ,DTRQCMP,DTSCHEDC,DTTRANS,DVBCNOW,DVBCPCTM,EDATE,FA,FB,JI,JJ,L,PNAM,PRIO,REQDA,RONUM,RQSTAT,SBULL,TOT,X,X1,X2,XMDUZ,XMMG,Y,YY
"RTN","DVBAB2",41,0)
 Q
"RTN","DVBAB2",42,0)
 ;
"RTN","DVBAB2",43,0)
BULL S XMDUZ=$P(^VA(200,DUZ,0),U),XMMG=$S($D(^VA(200,DUZ,0)):$P(^(0),U,1),1:""),XMY(DUZ)=""
"RTN","DVBAB2",44,0)
 S XMSUB="RO AMIS 290 Report -  " S Y=BDATE X ^DD("DD") S XMSUB=XMSUB_Y S Y=EDATE X ^DD("DD") S XMSUB=XMSUB_" to "_Y,XMTEXT="^TMP($J,"
"RTN","DVBAB2",45,0)
 Q
"RTN","DVBAB2",46,0)
 ;
"RTN","DVBAB2",47,0)
SEND D ^XMD K XMY,XMTEXT,XMSUB
"RTN","DVBAB2",48,0)
 S MSG(1)=">>> Mail message transmitted. <<<"
"RTN","DVBAB2",49,0)
 Q
"RTN","DVBAB2",50,0)
 ;
"RTN","DVBAB3")
0^4^B4121760
"RTN","DVBAB3",1,0)
DVBAB3 ;ALB/KLB - CAPRI Amis Report ;05/01/00
"RTN","DVBAB3",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB3",3,0)
 ;
"RTN","DVBAB3",4,0)
STRT(MSG,BDATE,EDATE,RONUMB,SBULL,DUZ) ;
"RTN","DVBAB3",5,0)
 S CNT=0
"RTN","DVBAB3",6,0)
 K ^TMP($J)
"RTN","DVBAB3",7,0)
 S RONUM=0
"RTN","DVBAB3",8,0)
SETUP S UPDATE="N",PREVMO=$P(^DVB(396.1,1,0),U,11)
"RTN","DVBAB3",9,0)
 I '$D(DT) S DT=$$DT^XLFDT
"RTN","DVBAB3",10,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB3",11,0)
 F JI="3DAYSCH","30DAYEX","PENDADJ" S TOT(JI)=0
"RTN","DVBAB3",12,0)
 F JI="INSUFF","SENT","INCOMPLETE","DAYS","COMPLETED" S TOT(JI)=0
"RTN","DVBAB3",13,0)
 F JI="P90","P121","P151","P181","P365","P366" S TOT(JI)=0
"RTN","DVBAB3",14,0)
 S ^TMP($J,CNT)="REGIONAL OFFICE 2507 AMIS REPORT",CNT=CNT+1
"RTN","DVBAB3",15,0)
 ;
"RTN","DVBAB3",16,0)
EN S ^TMP($J,CNT)="",CNT=CNT+1,^TMP($J,CNT)="",CNT=CNT+1,^TMP($J,CNT)="",CNT=CNT+1
"RTN","DVBAB3",17,0)
 S:'$D(EDATE) MSG(1)="Please enter a ending date"
"RTN","DVBAB3",18,0)
 Q:'$D(EDATE)
"RTN","DVBAB3",19,0)
 S:'$D(BDATE) MSG(1)="Please enter a starting date"
"RTN","DVBAB3",20,0)
 Q:'$D(BDATE)
"RTN","DVBAB3",21,0)
 S BDATE1=BDATE-.1,EDATE1=EDATE+.5
"RTN","DVBAB3",22,0)
 S:EDATE<BDATE MSG(1)="Beginning date must be before ending date"
"RTN","DVBAB3",23,0)
 Q:EDATE<BDATE
"RTN","DVBAB3",24,0)
 S:'$D(RONUMB) MSG(1)="Please select a Regional Office number"
"RTN","DVBAB3",25,0)
 Q:'$D(RONUMB)
"RTN","DVBAB3",26,0)
 S RONUM=$O(^DIC(4,"B",RONUMB,RONUM))
"RTN","DVBAB3",27,0)
 S:'$D(^DIC(4,RONUM,99)) MSG(1)="Invalid Regional Office number"
"RTN","DVBAB3",28,0)
 Q:'$D(^DIC(4,RONUM,99))
"RTN","DVBAB3",29,0)
 S RONUM=$S($D(^DIC(4,RONUM,99)):$P(^(99),U,1),1:"000")
"RTN","DVBAB3",30,0)
 S RONAME=$P(^DIC(4,RONUM,0),U)
"RTN","DVBAB3",31,0)
 S:'$D(SBULL) MSG(1)="You need to say if you want a Bulletin or not"
"RTN","DVBAB3",32,0)
 Q:'$D(SBULL)
"RTN","DVBAB3",33,0)
 I SBULL="Y" D BULL^DVBAB2
"RTN","DVBAB3",34,0)
 ;
"RTN","DVBAB3",35,0)
 D GO^DVBAB2
"RTN","DVBAB3",36,0)
 K BDATE,BDATE1,DVBCDT,EDATE,CNT,EDATE1,JI,PREVMO,RONAME,RONUM,RONUMB,SBULL,TOT,UPDATE,X,Y,^TMP($J)
"RTN","DVBAB3",37,0)
 Q
"RTN","DVBAB4")
0^26^B10717262
"RTN","DVBAB4",1,0)
DVBAB4 ;ALB/KLB - CAPRI Exam checklist for RO ;03/01/00
"RTN","DVBAB4",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB4",3,0)
STRT(MSG) ;
"RTN","DVBAB4",4,0)
 K ^TMP($J,"CAPRI")
"RTN","DVBAB4",5,0)
 S CNT=1
"RTN","DVBAB4",6,0)
 S ^TMP($J,"CAPRI",CNT,0)=";;Exam Checklist for the Regional Office",CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1
"RTN","DVBAB4",7,0)
 S ^TMP($J,"CAPRI",CNT,0)=";;VA Regional Office - "_$$SITE^DVBCUTL4,CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1
"RTN","DVBAB4",8,0)
 S ^TMP($J,"CAPRI",CNT,0)=";;Compensation and Pension Examination Request Worksheet",CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1
"RTN","DVBAB4",9,0)
 S ^TMP($J,"CAPRI",CNT,0)=";;Veteran's Name: _______________________________________     VAMC: ____________________",CNT=CNT+1
"RTN","DVBAB4",10,0)
 S ^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)=";;C-Number: _______________         SSN: _______________",CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1
"RTN","DVBAB4",11,0)
 S ^TMP($J,"CAPRI",CNT,0)=";;Telephone-Day: _______________  Night: _______________     Power of Attorney: _______________",CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1
"RTN","DVBAB4",12,0)
 S ^TMP($J,"CAPRI",CNT,0)=";;Date Ordered: _______________                               By: _________________________",CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1
"RTN","DVBAB4",13,0)
 S ^TMP($J,"CAPRI",CNT,0)=";;Priority of Exam: _______________        (   ) Insufficient Exam Dated: _______________",CNT=CNT+1
"RTN","DVBAB4",14,0)
 S ^TMP($J,"CAPRI",CNT,0)="                                                                        ;;(See Remarks)",CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1
"RTN","DVBAB4",15,0)
 S ^TMP($J,"CAPRI",CNT,0)=";;(   ) General Medical Examination        (   ) Review of Pertinent Medical Records in",CNT=CNT+1
"RTN","DVBAB4",16,0)
 S ^TMP($J,"CAPRI",CNT,0)=";;                                               Claims Folder is Required Prior to Examinations",CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1,^TMP($J,"CAPRI",CNT,0)="",CNT=CNT+1
"RTN","DVBAB4",17,0)
 S DIF="^TMP($J,""CAPRI"",",XCNP=CNT
"RTN","DVBAB4",18,0)
 F ROU="DVBCEXM1" S X=ROU X ^%ZOSF("LOAD")
"RTN","DVBAB4",19,0)
 ;M MSG=^TMP($J,"CAPRI")
"RTN","DVBAB4",20,0)
 K DIF,XCNP,ROU
"RTN","DVBAB4",21,0)
 S A=0
"RTN","DVBAB4",22,0)
 F  S A=$O(^TMP($J,"CAPRI",A)) Q:'A  D
"RTN","DVBAB4",23,0)
 .S XXX=$G(^TMP($J,"CAPRI",A,0))
"RTN","DVBAB4",24,0)
 .I (XXX[";AMIE;")!(XXX["TOF")!(XXX["END") K ^TMP($J,"CAPRI",A,0)
"RTN","DVBAB4",25,0)
 .E  S MSG(A)=$P(XXX,";;",2)
"RTN","DVBAB4",26,0)
 K ^TMP($J,"CAPRI")
"RTN","DVBAB4",27,0)
 K A,CNT,X
"RTN","DVBAB4",28,0)
 Q
"RTN","DVBAB5")
0^25^B2038503
"RTN","DVBAB5",1,0)
DVBAB5 ;ALB/KLB - CAPRI PENDING REQUESTS CONT ;08/01/00
"RTN","DVBAB5",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB5",3,0)
 ;
"RTN","DVBAB5",4,0)
SORT S STAT=$P(^DVB(396.3,REQDA,0),U,18) Q:"^R^X^RX^C^CT^"[(U_STAT_U)  I DVBCSORT="S" Q:STAT'=RSTAT&(RSTAT'="A")
"RTN","DVBAB5",5,0)
 S PNAM=$S($D(^DPT(DFN,0)):$P(^(0),U,1),1:"Unknown"),ROUT=$S($D(^DVB(396.3,REQDA,1)):$P(^(1),U,4),1:0),RDATE=$P(^(0),U,5)
"RTN","DVBAB5",6,0)
 I DVBCSORT="V" S ^TMP($J,PNAM,DFN,REQDA)="" Q
"RTN","DVBAB5",7,0)
 I DVBCSORT="S" S ^TMP($J,STAT,PNAM,DFN,REQDA)="" Q
"RTN","DVBAB5",8,0)
 I DVBCSORT="R",$D(ADIVNUM),ROUT=ADIVNUM S ^TMP($J,ROUT,PNAM,DFN,REQDA)="" Q
"RTN","DVBAB5",9,0)
 I DVBCSORT="A" D ELAPSED I EDAYS'<ERDAYS,EDAYS'>OLDAYS S ^TMP($J,EDAYS,PNAM,DFN,REQDA)=""
"RTN","DVBAB5",10,0)
 Q
"RTN","DVBAB5",11,0)
 ;
"RTN","DVBAB5",12,0)
ELAPSED K EDAYS,X1,X2,X S X1=DT,(X2,X)=RDATE D:ELTYP="C" ^%DTC D:ELTYP="W" ^XUWORKDY S EDAYS=X
"RTN","DVBAB5",13,0)
 Q
"RTN","DVBAB51")
0^7^B22434564
"RTN","DVBAB51",1,0)
DVBAB51 ;ALB/VM - CAPRI INCOMPETENT PATIENT REPORT ;09/01/00
"RTN","DVBAB51",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB51",3,0)
 ;
"RTN","DVBAB51",4,0)
STRT(ZMSG,BDATE,EDATE) ;ENTER HERE
"RTN","DVBAB51",5,0)
 S DVBABCNT=0,RO="N",RONUM=0
"RTN","DVBAB51",6,0)
 K ^TMP($J) G TERM
"RTN","DVBAB51",7,0)
SET Q:'$D(^DPT(DA,.29))  S ICDAT=^(.29) Q:$P(ICDAT,U,12)'=1&(ICDAT']"")  S INCMP="" S:$P(ICDAT,U)]""!($P(ICDAT,U,12)=1) INCMP=1 Q:INCMP'=1  S ICDAT2=$P(ICDAT,U,2),ICDAT=$P(ICDAT,U)
"RTN","DVBAB51",8,0)
 S:ICDAT]"" ICDAT=$$FMTE^XLFDT(ICDAT,"5DZ")
"RTN","DVBAB51",9,0)
 S:ICDAT2]"" ICDAT2=$$FMTE^XLFDT(ICDAT2,"5DZ")
"RTN","DVBAB51",10,0)
 Q:'$D(^DPT(DA,0))  S DFN=DA D RCV^DVBAVDPT Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)
"RTN","DVBAB51",11,0)
 S ^TMP($J,XCN,CFLOC,MB,DA)=MA_U_RCVAA_U_RCVPEN_U_CNUM_U_ICDAT_U_ICDAT2_U_INCMP
"RTN","DVBAB51",12,0)
 Q
"RTN","DVBAB51",13,0)
 ;
"RTN","DVBAB51",14,0)
PRINTB S MA=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),ICDAT=$P(DATA,U,5),ICDAT2=$P(DATA,U,6),INCMP=$P(DATA,U,7),DFN=DA,QUIT1=1 D ADM^DVBAVDPT
"RTN","DVBAB51",15,0)
 S ADMDT=$$FMTE^XLFDT(ADMDT,"5DZ")
"RTN","DVBAB51",16,0)
 S DCHGDT=$$FMTE^XLFDT(DCHGDT,"5DZ")
"RTN","DVBAB51",17,0)
 S LADM=ADM,TDIS="UNKNOWN",TO="",DCHPTR=$P(^DGPM(LADM,0),U,17),TDIS=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U,18),1:"") I TDIS="" S TDIS="Unknown discharge type"
"RTN","DVBAB51",18,0)
 S:'$D(^DG(405.2,+TDIS,0)) TDIS="Unknown discharge type" I $D(^(0)) S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBAB51",19,0)
 S:(IOST?1"C-".E)!($D(DVBAON2)) ZMSG(DVBABCNT)=" ",DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",20,0)
 ;***vm-out*W !!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBAB51",21,0)
 S ZMSG(DVBABCNT)="  Patient Name:    "_PNAM,DVBABCNT=DVBABCNT+1,ZMSG(DVBABCNT)=" ",DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",22,0)
 S ZMSG(DVBABCNT)="           Claim No:   "_CNUM,DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",23,0)
 S ZMSG(DVBABCNT)="   Claim Folder Loc:   "_CFLOC,DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",24,0)
 S ZMSG(DVBABCNT)="      Social Sec No:   "_SSN,DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",25,0)
 S ZMSG(DVBABCNT)="     Admission Date:   "_ADMDT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",26,0)
 S ZMSG(DVBABCNT)="Admitting Diagnosis:   "_DIAG,DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",27,0)
 S ZMSG(DVBABCNT)="     Discharge Date:   "_DCHGDT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",28,0)
 I DCHGDT]"" S ZMSG(DVBABCNT)="     Type of Discharge:   "_TDIS_$S(TO]"":" TO "_$S($D(^DIC(4,+TO,0)):$P(^(0),U,1),1:""),1:""),DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",29,0)
 S ZMSG(DVBABCNT)="        Bed Service:   "_BEDSEC,DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",30,0)
 S ZMSG(DVBABCNT)="          Recv A&A?:   "_$S(RCVAA=0:"NO",RCVAA=1:"YES",1:"Not specified"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",31,0)
 S ZMSG(DVBABCNT)="           Pension?:   "_$S(RCVPEN=0:"NO",RCVPEN=1:"YES",1:"Not specified"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",32,0)
 ;***vm-out*D ELIG^DVBAVDPT
"RTN","DVBAB51",33,0)
ELIG S ELIG=DVBAELIG,INCMP=""
"RTN","DVBAB51",34,0)
 S ZMSG(DVBABCNT)="   Eligibility data:   "
"RTN","DVBAB51",35,0)
 I ELIG]"" S ELIG=ELIG_" ("_$S(DVBAELST="P":"Pend Ver",DVBAELST="R":"Pend Re-verif",DVBAELST="V":"Verified",1:"Not Verified")_")"
"RTN","DVBAB51",36,0)
 I $D(^DPT(DA,.29)) S INCMP=$S($P(^(.29),U,12)=1:"Incompetent",1:"")
"RTN","DVBAB51",37,0)
 S ZMSG(DVBABCNT)=ELIG_$S(ELIG]"":", ",1:"")_INCMP,DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",38,0)
 S ZMSG(DVBABCNT)="  DATE RULED INCOMP: "_$S($D(ICDAT)]"":ICDAT_" (VA)",1:"")_$S(ICDAT2]"":" - "_ICDAT2_" (CIVIL)",1:" "),DVBABCNT=DVBABCNT+1
"RTN","DVBAB51",39,0)
 ;***vm-out*I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) QUIT=1 I '$T S DVBAQUIT=1
"RTN","DVBAB51",40,0)
 S DVBAON2=""
"RTN","DVBAB51",41,0)
 Q
"RTN","DVBAB51",42,0)
 ;
"RTN","DVBAB51",43,0)
PRINT U IO S QUIT=""
"RTN","DVBAB51",44,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBAB51",45,0)
 Q
"RTN","DVBAB51",46,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DATA=^(DA) D PRINTB
"RTN","DVBAB51",47,0)
 Q
"RTN","DVBAB51",48,0)
 ;
"RTN","DVBAB51",49,0)
TERM ;D HOME^%ZIS K NOASK
"RTN","DVBAB51",50,0)
 K NOASK
"RTN","DVBAB51",51,0)
 ;
"RTN","DVBAB51",52,0)
SETUP ;W @IOF,!,"VARO INCOMPETENCY REPORT" D NOPARM^DVBAUTL2 
"RTN","DVBAB51",53,0)
NOPARM  ;check for AMIE parameter setup
"RTN","DVBAB51",54,0)
 I '$D(^DVB(396.1,1,0)) S ZMSG(DVBABCNT)="No site parameters have been set up in file 396.1.",DVBABCNT=DVBABCNT+1,ZMSG(DVBABCNT)="You must do this before running any reports." S DVBAQUIT=1 H 3
"RTN","DVBAB51",55,0)
 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB51",56,0)
 S HEAD="INCOMPETENCY REPORT",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAB51",57,0)
 ;***vm-out*W !,HEAD1
"RTN","DVBAB51",58,0)
EN1 ;***vm-out*W !!,"Please enter dates for search, oldest date first, most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,5) X ^DD("DD") W Y,!!
"RTN","DVBAB51",59,0)
 ;***vm-out*D DATE^DVBAUTIL G:X=""!(Y<0) KILL
"RTN","DVBAB51",60,0)
 S %ZIS="Q" D ^%ZIS K %ZIS G:POP KILL^DVBAUTIL
"RTN","DVBAB51",61,0)
 ;
"RTN","DVBAB51",62,0)
QUEUE ;***vm-out*I $D(IO("Q")) S ZTRTN="DEQUE^DVBACMRP",ZTIO=ION,NOASK=1,ZTDESC="AMIE INCOMPETENT VET REPORT" F I="FDT(0)","HEAD","HEAD1","BDATE","EDATE","TYPE","RO","RONUM","NOASK" S ZTSAVE(I)=""
"RTN","DVBAB51",63,0)
 ;***vm-out*I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",!! G KILL
"RTN","DVBAB51",64,0)
 ;
"RTN","DVBAB51",65,0)
GO S MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV1",MA)) Q:$P(MA,".")>EDATE!(MA="")  F DA=0:0 S DA=$O(^DGPM("AMV1",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV1",MA,DA,MB)) Q:MB=""  D SET I '$D(NOASK) W "."
"RTN","DVBAB51",66,0)
 I '$D(^TMP($J)) S ZMSG(DVBABCNT)="No data found for parameters entered." H 2 G KILL
"RTN","DVBAB51",67,0)
 I $D(^TMP($J)) D PRINT I $D(DVBAQUIT) K DVBAON2 G KILL^DVBAUTIL
"RTN","DVBAB51",68,0)
 ;
"RTN","DVBAB51",69,0)
KILL D ^%ZISC S X=5 K DVBAON2 D:$D(ZTQUEUED) KILL^%ZTLOAD G FINAL^DVBAUTIL
"RTN","DVBAB51",70,0)
 ;
"RTN","DVBAB51",71,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBAB52")
0^8^B13032610
"RTN","DVBAB52",1,0)
DVBAB52 ;ALB/SPH - CAPRI ADMISSION INQ BY DATE ;09/01/00
"RTN","DVBAB52",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB52",3,0)
 ;
"RTN","DVBAB52",4,0)
STRT(ZMSG,BDATE,EDATE) ;
"RTN","DVBAB52",5,0)
 S DVBABCNT=0
"RTN","DVBAB52",6,0)
 K ^TMP($J) G TERM
"RTN","DVBAB52",7,0)
SET Q:$D(^DPT(DA,0))  S DFN=DA D RCV^DVBAVDPT Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)
"RTN","DVBAB52",8,0)
 S ^TMP($J,XCN,CFLOC,MB,DA)=MA_U_RCVAA_U_RCVPEN_U_CNUM
"RTN","DVBAB52",9,0)
 Q
"RTN","DVBAB52",10,0)
 ;
"RTN","DVBAB52",11,0)
PRINTB S MA=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),DFN=DA,QUIT1=1 D ADM^DVBAVDPT
"RTN","DVBAB52",12,0)
 S:ADMDT]"" ADMDT=$$FMTE^XLFDT(ADMDT,"5DZ")
"RTN","DVBAB52",13,0)
 S:DCHGDT]"" DCHGDT=$$FMTE^XLFDT(DCHGDT,"5DZ")
"RTN","DVBAB52",14,0)
 W:(IOST?1"C-".E!($D(DVBAON2))) @IOF
"RTN","DVBAB52",15,0)
 S ZMSG(DVBABCNT)=""  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",16,0)
 S ZMSG(DVBABCNT)=""  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",17,0)
 S ZMSG(DVBABCNT)="          Patient Name:    "_PNAM  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",18,0)
 S ZMSG(DVBABCNT)="              Claim No:    "_CNUM  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",19,0)
 S ZMSG(DVBABCNT)="      Claim Folder Loc:    "_CFLOC  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",20,0)
 S ZMSG(DVBABCNT)="         Social Sec No:    "_SSN  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",21,0)
 S ZMSG(DVBABCNT)="        Admission Date:    "_ADMDT  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",22,0)
 S ZMSG(DVBABCNT)="   Admitting Diagnosis:    "_DIAG  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",23,0)
 S ZMSG(DVBABCNT)="        Discharge Date:    "_DCHGDT  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",24,0)
 S ZMSG(DVBABCNT)="           Bed Service:    "_BEDSEC  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",25,0)
 S ZMSG(DVBABCNT)="             Recv A&A?:    "_$S(RCVAA=0:"NO",RCVAA=1:"YES",1:"Not specified")  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",26,0)
 S ZMSG(DVBABCNT)="              Pension?:    "_$S(RCVPEN=0:"NO",RCVPEN=1:"YES",1:"Not specified")  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",27,0)
 ;
"RTN","DVBAB52",28,0)
 ;ELIG INFO...
"RTN","DVBAB52",29,0)
 S ELIG=DVBAELIG,INCMP=""
"RTN","DVBAB52",30,0)
 I ELIG]"" S ELIG=ELIG_" ("_$S(DVBAELST="P":"Pend Ver",DVBAELST="R":"Pend Re-verif",DVBAELST="V":"Verified",1:"Not Verified")_")"
"RTN","DVBAB52",31,0)
 I $D(^DPT(DA,.29)) S INCMP=$S($P(^(.29),U,12)=1:"Incompetent",1:"")
"RTN","DVBAB52",32,0)
 S ZMSG(DVBABCNT)="       Eligibility data:   "_ELIG_$S(ELIG]"":", ",1:"")
"RTN","DVBAB52",33,0)
 S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",34,0)
 W:$X>60 !?26 S ZMSG(DVBABCNT)=INCMP  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB52",35,0)
 Q
"RTN","DVBAB52",36,0)
 ;END OF ELIG INFO
"RTN","DVBAB52",37,0)
 ;
"RTN","DVBAB52",38,0)
PRINT U IO S QUIT="" K MA,MB
"RTN","DVBAB52",39,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBAB52",40,0)
 Q
"RTN","DVBAB52",41,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DATA=^(DA) D PRINTB
"RTN","DVBAB52",42,0)
 Q
"RTN","DVBAB52",43,0)
 ;
"RTN","DVBAB52",44,0)
TERM ;
"RTN","DVBAB52",45,0)
SETUP ;
"RTN","DVBAB52",46,0)
EN1 ;
"RTN","DVBAB52",47,0)
QUEUE ;
"RTN","DVBAB52",48,0)
 S RO="N"
"RTN","DVBAB52",49,0)
 S RONUM=0
"RTN","DVBAB52",50,0)
 S HEAD=""
"RTN","DVBAB52",51,0)
 S HEAD1=""
"RTN","DVBAB52",52,0)
GO S MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV1",MA)) Q:$P(MA,".")>EDATE!(MA="")  W:'$D(NOASK) "." F DA=0:0 S DA=$O(^DGPM("AMV1",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV1",MA,DA,MB)) Q:MB=""  I MA'>EDATE D SET
"RTN","DVBAB52",53,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found for parameters entered.",!! H 2 G KILL
"RTN","DVBAB52",54,0)
 I $D(^TMP($J)) D PRINT I $D(DVBAQUIT) K DVBAON2,DCHPTR,M,Y,J G KILL^DVBAUTIL
"RTN","DVBAB52",55,0)
 ;
"RTN","DVBAB52",56,0)
KILL D ^%ZISC S X=3 K DVBAON2,DCHPTR,M,Y,J D:$D(ZTQUEUED) KILL^%ZTLOAD G FINAL^DVBAUTIL
"RTN","DVBAB52",57,0)
 ;
"RTN","DVBAB52",58,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBAB53")
0^9^B20939933
"RTN","DVBAB53",1,0)
DVBAB53 ;ALB/SPH - CAPRI DISCHARGE REPORT ;09/06/00
"RTN","DVBAB53",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB53",3,0)
 ;
"RTN","DVBAB53",4,0)
STRT(ZMSG,BDATE,EDATE,ADTYPE)    ;
"RTN","DVBAB53",5,0)
 S DVBABCNT=0
"RTN","DVBAB53",6,0)
 S RONUM=0
"RTN","DVBAB53",7,0)
 S RO="N"
"RTN","DVBAB53",8,0)
 S HEAD="",HEAD1=""
"RTN","DVBAB53",9,0)
 K ^TMP($J) G TERM
"RTN","DVBAB53",10,0)
 ;
"RTN","DVBAB53",11,0)
SET Q:'$D(^DPT(DA,0))  S DFN=DA,DVBASC="" D RCV^DVBAVDPT Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)  Q:ADTYPE="S"&(DVBASC'="Y")  Q:ADTYPE="A"&(RCVAA'=1)  Q:ADTYPE="P"&(RCVPEN'="1")
"RTN","DVBAB53",12,0)
 S TDIS=$S($D(^DGPM(+MB,0)):$P(^(0),U,18),1:"")
"RTN","DVBAB53",13,0)
 I $D(^DG(405.2,+TDIS,0)) DO
"RTN","DVBAB53",14,0)
 .I '$D(^TMP("DVBA",$J,"DUP",+TDIS)) Q
"RTN","DVBAB53",15,0)
 .S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBAB53",16,0)
 .S ^TMP($J,XCN,CFLOC,MB,DA)=MA_U_RCVAA_U_RCVPEN_U_CNUM_U_TDIS
"RTN","DVBAB53",17,0)
 .Q
"RTN","DVBAB53",18,0)
 Q
"RTN","DVBAB53",19,0)
 ;
"RTN","DVBAB53",20,0)
PRINTB S MA=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),TDIS=$P(DATA,U,5),DFN=DA,QUIT1=1 D DCHGDT^DVBAVDPT
"RTN","DVBAB53",21,0)
 W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBAB53",22,0)
 W !!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBAB53",23,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",24,0)
 ;
"RTN","DVBAB53",25,0)
 S ZMSG(DVBABCNT)="          Patient Name:    "_PNAM  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",26,0)
 S ZMSG(DVBABCNT)="              Claim No:    "_CNUM  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",27,0)
 S ZMSG(DVBABCNT)="      Claim Folder Loc:    "_CFLOC  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",28,0)
 S ZMSG(DVBABCNT)="         Social Sec No:    "_SSN  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",29,0)
 S ZMSG(DVBABCNT)="        Discharge Date:    "_$$FMTE^XLFDT(DCHGDT,"5DZ"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",30,0)
 S ZMSG(DVBABCNT)="     Type of Discharge:    "_TDIS,DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",31,0)
 D LOS^DVBAUTIL
"RTN","DVBAB53",32,0)
 S ZMSG(DVBABCNT)="        Length of Stay:    "_LOS_$S(LOS="":"Discharged same day",LOS=1:" day",1:" days"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",33,0)
 S ZMSG(DVBABCNT)="           Bed Service:    "_BEDSEC,DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",34,0)
 S ZMSG(DVBABCNT)="             Recv A&A?:    "_$S(RCVAA="0":"NO",RCVAA="1":"YES",1:"Not specified"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",35,0)
 S ZMSG(DVBABCNT)="              Pension?:    "_$S(RCVPEN="0":"NO",RCVPEN="1":"YES",1:"Not specified"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",36,0)
 ;
"RTN","DVBAB53",37,0)
 ;
"RTN","DVBAB53",38,0)
 ; ELIG INFO...
"RTN","DVBAB53",39,0)
 S ELIG=DVBAELIG,INCMP=""
"RTN","DVBAB53",40,0)
 ;S ZMSG(DVBABCNT)="      Eligibility data:"
"RTN","DVBAB53",41,0)
 I ELIG]"" S ELIG=ELIG_" ("_$S(DVBAELST="P":"Pend Ver",DVBAELST="R":"Pend Re-verif",DVBAELST="V":"Verified",1:"Not Verified")_")"
"RTN","DVBAB53",42,0)
 I $D(^DPT(DA,.29)) S INCMP=$S($P(^(.29),U,12)=1:"Incompetent",1:"")
"RTN","DVBAB53",43,0)
 S ZMSG(DVBABCNT)="       Eligibility data:   "_ELIG_$S(ELIG]"":", ",1:"")  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",44,0)
 W:$X>60 !?26 S ZMSG(DVBABCNT)=INCMP  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",45,0)
 Q
"RTN","DVBAB53",46,0)
 ;END OF ELIG INFO
"RTN","DVBAB53",47,0)
 ;
"RTN","DVBAB53",48,0)
 ;I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) QUIT=1 I ANS=U S DVBAQUIT=1
"RTN","DVBAB53",49,0)
 S DVBAON2=""
"RTN","DVBAB53",50,0)
 Q
"RTN","DVBAB53",51,0)
 ;
"RTN","DVBAB53",52,0)
PRINT U IO S QUIT=""
"RTN","DVBAB53",53,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBAB53",54,0)
 Q
"RTN","DVBAB53",55,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DATA=^(DA) D PRINTB
"RTN","DVBAB53",56,0)
 Q
"RTN","DVBAB53",57,0)
 ;
"RTN","DVBAB53",58,0)
TERM ;D HOME^%ZIS K NOASK
"RTN","DVBAB53",59,0)
 ;
"RTN","DVBAB53",60,0)
SETUP ;W @IOF,!,"VARO DISCHARGE REPORT" D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB53",61,0)
 S DSRP=1
"RTN","DVBAB53",62,0)
 ;S HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0) W !,HEAD1
"RTN","DVBAB53",63,0)
 ;
"RTN","DVBAB53",64,0)
EN1 ;W !!,"Please enter dates for search, oldest date first, most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,4) X ^DD("DD") W Y,!!
"RTN","DVBAB53",65,0)
 ;D DATE^DVBAUTIL
"RTN","DVBAB53",66,0)
 ;G:X=""!(Y<0) KILL
"RTN","DVBAB53",67,0)
 ;
"RTN","DVBAB53",68,0)
ADTYPE ;D ADTYPE^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBAB53",69,0)
 ;W @IOF
"RTN","DVBAB53",70,0)
 ;K DVBACEPT
"RTN","DVBAB53",71,0)
 D EN^DVBAB99("DVBA DISCHARGE TYPES")
"RTN","DVBAB53",72,0)
 D ACCEPT^DVBALD
"RTN","DVBAB53",73,0)
 I '$D(DVBACEPT) D KILL^DVBAUTIL Q
"RTN","DVBAB53",74,0)
 I '$O(^TMP("DVBA",$J,"DUP",0)) D KILL^DVBAUTIL Q
"RTN","DVBAB53",75,0)
 ;
"RTN","DVBAB53",76,0)
 W !!! S %ZIS="Q" D ^%ZIS K %ZIS G:POP KILL^DVBAUTIL
"RTN","DVBAB53",77,0)
 ;
"RTN","DVBAB53",78,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBADSRT",ZTIO=ION,NOASK=1,ZTDESC="AMIE DISCHARGE REPORT" F I="^TMP(""DVBA"",$J,""DUP""","ADTYPE","DVBATYPS","BDATE","BDATE1","EDATE","FDT(0)","HEAD","HEAD1","HD","RO","RONUM","NOASK" S ZTSAVE(I)=""
"RTN","DVBAB53",79,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",! G KILL
"RTN","DVBAB53",80,0)
 ;
"RTN","DVBAB53",81,0)
GO S MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV3",MA)) Q:MA>EDATE!(MA="")  W:'$D(NOASK) "." F DA=0:0 S DA=$O(^DGPM("AMV3",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV3",MA,DA,MB)) Q:MB=""  D SET
"RTN","DVBAB53",82,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found for parameters entered.",!! H 2 G KILL
"RTN","DVBAB53",83,0)
 D PRINT I $D(DVBAQUIT) K DVBAON2 G KILL^DVBAUTIL
"RTN","DVBAB53",84,0)
 ;
"RTN","DVBAB53",85,0)
KILL D ^%ZISC D:$D(ZTQUEUED) KILL^%ZTLOAD S X=4 K DVBAON2 G FINAL^DVBAUTIL
"RTN","DVBAB53",86,0)
 ;
"RTN","DVBAB53",87,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBAB54")
0^10^B13667343
"RTN","DVBAB54",1,0)
DVBAB54 ;ALB/VM - CAPRI ADMISSION REPORT ;09/06/00
"RTN","DVBAB54",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB54",3,0)
 ;
"RTN","DVBAB54",4,0)
STRT(ZMSG,BDATE,EDATE)  ;ENTER HERE
"RTN","DVBAB54",5,0)
 S DVBABCNT=0,RO="N",RONUM=0
"RTN","DVBAB54",6,0)
 K ^TMP($J) G TERM
"RTN","DVBAB54",7,0)
SET Q:'$D(^DPT(DA,0))  S DFN=DA,DVBASC="" D SC^DVBAVDPT Q:DVBASC'="Y"  Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)  S ^TMP($J,XCN,CFLOC,MB,DA)=MA
"RTN","DVBAB54",8,0)
 Q
"RTN","DVBAB54",9,0)
 ;
"RTN","DVBAB54",10,0)
PRINTB S ADMDT=$P(DATA,U),DFN=DA D ADM^DVBAVDPT
"RTN","DVBAB54",11,0)
 ;W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBAB54",12,0)
 ;W !!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBAB54",13,0)
 S:ADMDT]"" ADMDT=$E(ADMDT,4,5)_"/"_$E(ADMDT,6,7)_"/"_$E(ADMDT,2,3) S:DCHGDT]"" DCHGDT=$E(DCHGDT,4,5)_"/"_$E(DCHGDT,6,7)_"/"_$E(DCHGDT,2,3)
"RTN","DVBAB54",14,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",15,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",16,0)
 S ZMSG(DVBABCNT)="          Patient Name:   "_PNAM,DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",17,0)
 S ZMSG(DVBABCNT)="              Claim No:   "_CNUM,DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",18,0)
 S ZMSG(DVBABCNT)="      Claim Folder Loc:   "_CFLOC,DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",19,0)
 S ZMSG(DVBABCNT)="         Social Sec No:   "_SSN,DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",20,0)
 S ZMSG(DVBABCNT)="        Admission Date:   "_ADMDT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",21,0)
 S ZMSG(DVBABCNT)="   Admitting Diagnosis:   "_DIAG,DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",22,0)
 S ZMSG(DVBABCNT)="        Discharge Date:   "_DCHGDT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",23,0)
 S ZMSG(DVBABCNT)="           Bed Service:   "_BEDSEC,DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",24,0)
 S ZMSG(DVBABCNT)="             Recv A&A?:   "_$S(RCVAA=0:"NO",RCVAA=1:"YES",1:"Not specified"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",25,0)
 S ZMSG(DVBABCNT)="              Pension?:   "_$S(RCVPEN=0:"NO",RCVPEN=1:"YES",1:"Not specified"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",26,0)
 ;D ELIG^DVBAVDPT
"RTN","DVBAB54",27,0)
ELIG S ELIG=DVBAELIG,INCMP=""
"RTN","DVBAB54",28,0)
 I ELIG]"" S ELIG=ELIG_" ("_$S(DVBAELST="P":"Pend Ver",DVBAELST="R":"Pend Re-verif",DVBAELST="V":"Verified",1:"Not Verified")_")"
"RTN","DVBAB54",29,0)
 I $D(^DPT(DA,.29)) S INCMP=$S($P(^(.29),U,12)=1:"Incompetent",1:"")
"RTN","DVBAB54",30,0)
 S ZMSG(DVBABCNT)="      Eligibility data:   "_ELIG_$S(ELIG]"":", ",1:""),DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",31,0)
 I $X>60 S ZMSG(DVBABCNT)=INCMP,DVBABCNT=DVBABCNT+1
"RTN","DVBAB54",32,0)
 ;Q
"RTN","DVBAB54",33,0)
 ;***VM-OUT*I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) QUIT=1 I '$T S DVBAQUIT=1
"RTN","DVBAB54",34,0)
 S DVBAON2=""
"RTN","DVBAB54",35,0)
 Q
"RTN","DVBAB54",36,0)
 ;
"RTN","DVBAB54",37,0)
PRINT K MA S QUIT=""
"RTN","DVBAB54",38,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBAB54",39,0)
 Q
"RTN","DVBAB54",40,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DATA=^(DA) D PRINTB
"RTN","DVBAB54",41,0)
 Q
"RTN","DVBAB54",42,0)
 ;
"RTN","DVBAB54",43,0)
TERM ;D HOME^%ZIS K NOASK
"RTN","DVBAB54",44,0)
 ;
"RTN","DVBAB54",45,0)
 ;W @IOF,!,"VARO SERVICE-CONNECTED ADMISSION REPORT" D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBAB54",46,0)
 S DTAR=^DVB(396.1,1,0),FDT(0)=$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)
"RTN","DVBAB54",47,0)
 S HEAD="SERVICE-CONNECTED ADMISSION REPORT",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAB54",48,0)
 ;W !,HEAD1
"RTN","DVBAB54",49,0)
 ;W !!,"Please enter dates for search, oldest date first, most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,8) X ^DD("DD") W Y,!!
"RTN","DVBAB54",50,0)
 ;D DATE^DVBAUTIL
"RTN","DVBAB54",51,0)
 ;G:X=""!(Y<0) KILL
"RTN","DVBAB54",52,0)
 ;S %ZIS="Q" D ^%ZIS K %ZIS G:POP KILL^DVBAUTIL
"RTN","DVBAB54",53,0)
 ;
"RTN","DVBAB54",54,0)
 ;I $D(IO("Q")) S ZTRTN="DEQUE^DVBASCRP",ZTIO=ION,NOASK=1,ZTDESC="AMIE SC ADMISSION REPORT" F I="FDT(0)","HEAD","HEAD1","BDATE","EDATE","TYPE","RO","RONUM","NOASK" S ZTSAVE(I)=""
"RTN","DVBAB54",55,0)
 ;I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",!! G KILL
"RTN","DVBAB54",56,0)
 ;
"RTN","DVBAB54",57,0)
GO S MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV1",MA)) Q:$P(MA,".")>EDATE!(MA="")  F DA=0:0 S DA=$O(^DGPM("AMV1",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV1",MA,DA,MB)) Q:MB=""  D SET W:'$D(NOASK) "."
"RTN","DVBAB54",58,0)
 I '$D(^TMP($J)) S ZMSG(DVBABCNT)="No data found for parameters entered." H 2 G KILL
"RTN","DVBAB54",59,0)
 D PRINT I $D(DVBAQUIT) K DVBAON2 D:$D(ZTQUEUED) KILL^%ZTLOAD G KILL^DVBAUTIL
"RTN","DVBAB54",60,0)
 ;
"RTN","DVBAB54",61,0)
KILL D:$D(ZTQUEUED) KILL^%ZTLOAD D ^%ZISC S X=8 K DVBAON2 G FINAL^DVBAUTIL
"RTN","DVBAB54",62,0)
 ;
"RTN","DVBAB54",63,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBAB56")
0^12^B20872408
"RTN","DVBAB56",1,0)
DVBAB56 ;ALB/SPH - CAPRI READMISSION REPORT ;09/05/00
"RTN","DVBAB56",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB56",3,0)
 ;
"RTN","DVBAB56",4,0)
STRT(ZMSG,BDATE,EDATE,DVBAH)    ;
"RTN","DVBAB56",5,0)
 S DVBABCNT=0
"RTN","DVBAB56",6,0)
 G TERM
"RTN","DVBAB56",7,0)
SORT D RCV^DVBAVDPT I $D(RONUM),$D(RO) Q:CFLOC'=RONUM&(RO="Y")
"RTN","DVBAB56",8,0)
 I RCVAA S ^TMP("DVBA",$J,"A&A",DFN)=""
"RTN","DVBAB56",9,0)
 I RCVPEN S ^TMP("DVBA",$J,"PEN",DFN)=""
"RTN","DVBAB56",10,0)
 Q
"RTN","DVBAB56",11,0)
 ;
"RTN","DVBAB56",12,0)
DCHGDT S (LADMDT,LDCHGDT)="",DCHPTR=$P(^DGPM(VY,0),U,17),LADMDT=$P(^(0),U,1) I DCHPTR]"",$D(^DGPM(+DCHPTR,0)) S LDCHGDT=$P(^DGPM(+DCHPTR,0),U,1)
"RTN","DVBAB56",13,0)
 Q
"RTN","DVBAB56",14,0)
 ;
"RTN","DVBAB56",15,0)
CAL S I="",ZI=1 F DVBAI=0:0 S I=$O(^DGPM("APID",DFN,I)) Q:I=""  F J=0:0 S J=$O(^DGPM("APID",DFN,I,J)) Q:J=""  S ZJ=$S($D(^DGPM(J,0)):^(0),1:"") I $P(ZJ,U,1)'>EDATE,$P(ZJ,U,2)=1 S ^TMP("DVBA",$J,"ADM",DFN,ZI,J)="",ZI=ZI+1
"RTN","DVBAB56",16,0)
 S VX=$O(^TMP("DVBA",$J,"ADM",DFN,1,0)) Q:VX=""  S CURADMDT=$P(^DGPM(VX,0),U,1) Q:CURADMDT=""
"RTN","DVBAB56",17,0)
 F VX=1:1 S VX=$O(^TMP("DVBA",$J,"ADM",DFN,VX)) Q:VX=""  F VY=0:0 S VY=$O(^TMP("DVBA",$J,"ADM",DFN,VX,VY)) Q:VY=""  D DCHGDT I CURADMDT["."&(LADMDT[".") D SET
"RTN","DVBAB56",18,0)
 Q
"RTN","DVBAB56",19,0)
TDIS S TDIS=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U,18),1:"") Q:TDIS=""
"RTN","DVBAB56",20,0)
 S:'$D(^DG(405.2,+TDIS,0)) TDIS="Unknown discharge type" I $D(^(0)) S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBAB56",21,0)
 Q
"RTN","DVBAB56",22,0)
 ;
"RTN","DVBAB56",23,0)
SET S X1=CURADMDT,X2=LDCHGDT D ^%DTC Q:X>185
"RTN","DVBAB56",24,0)
 S X2=LADMDT,X1=LDCHGDT D ^%DTC S LOS=X Q:LOS'>HOSPDAYS
"RTN","DVBAB56",25,0)
 I DVBAT="A&A" DO  ;**Check last admission for A&A vet
"RTN","DVBAB56",26,0)
 .S ADMDT=LADMDT
"RTN","DVBAB56",27,0)
 .D ADM^DVBAVDPT,TDIS
"RTN","DVBAB56",28,0)
 .I TDIS["IRREGULAR" DO  ;**Irregular discharge, set last admis info
"RTN","DVBAB56",29,0)
 ..S ^TMP("DVBA",DVBAT,$J,XCN,CFLOC,VY,DFN,"LADM")=LADMDT_U_TDIS
"RTN","DVBAB56",30,0)
 I $D(TDIS),(TDIS'["IRREGULAR"&(DVBAT="A&A")) Q  ;**Quit
"RTN","DVBAB56",31,0)
 S ADMDT=CURADMDT
"RTN","DVBAB56",32,0)
 D ADM^DVBAVDPT,TDIS
"RTN","DVBAB56",33,0)
 ;**Set current admis info
"RTN","DVBAB56",34,0)
 S ^TMP("DVBA",DVBAT,$J,XCN,CFLOC,VY,DFN)=CURADMDT_U_RCVAA_U_RCVPEN_U_CNUM_U_TDIS
"RTN","DVBAB56",35,0)
 I DVBAT="PEN" DO  ;**Set last admis info for Pension vet 
"RTN","DVBAB56",36,0)
 .S ADMDT=LADMDT
"RTN","DVBAB56",37,0)
 .D ADM^DVBAVDPT,TDIS
"RTN","DVBAB56",38,0)
 .S ^TMP("DVBA",DVBAT,$J,XCN,CFLOC,VY,DFN,"LADM")=LADMDT_U_TDIS
"RTN","DVBAB56",39,0)
 K DVBARADQ
"RTN","DVBAB56",40,0)
 S (VX,VY)=9999999
"RTN","DVBAB56",41,0)
 Q
"RTN","DVBAB56",42,0)
 ;
"RTN","DVBAB56",43,0)
TERM ;D HOME^%ZIS 
"RTN","DVBAB56",44,0)
 K ^TMP("DVBA",$J),^TMP("DVBA","PEN",$J),^TMP("DVBA","A&A",$J),NOASK
"RTN","DVBAB56",45,0)
 ;D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBAB56",46,0)
 ;
"RTN","DVBAB56",47,0)
SETUP ;W @IOF,!,"VARO RE-ADMISSION REPORT" 
"RTN","DVBAB56",48,0)
 S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB56",49,0)
 S HEAD="RE-ADMISSION REPORT",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAB56",50,0)
 ;W !,HEAD1
"RTN","DVBAB56",51,0)
EN1 ;W !!,"Please enter admission dates for search, oldest date first,",!,"most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,7) X ^DD("DD") W Y,!!
"RTN","DVBAB56",52,0)
 ;D DATE^DVBAUTIL G:Y<0 KILL^DVBAUTIL
"RTN","DVBAB56",53,0)
 S BDATE1=BDATE+.5,HEADDT="Date range: "_$$FMTE^XLFDT(BDATE1,"5DZ")_" to "_$$FMTE^XLFDT(EDATE,"5DZ")
"RTN","DVBAB56",54,0)
 ;
"RTN","DVBAB56",55,0)
ASK ;W !!,"Do you want (H)ospital or Hospital-(D)om   H// " R DVBAH:DTIME G:'$T!(DVBAH=U) KILL^DVBAUTIL
"RTN","DVBAB56",56,0)
 I DVBAH="" S DVBAH="H" W DVBAH
"RTN","DVBAB56",57,0)
 S:DVBAH="d" DVBAH="D"
"RTN","DVBAB56",58,0)
 S:DVBAH="h" DVBAH="H"
"RTN","DVBAB56",59,0)
 I DVBAH'?1"H"&(DVBAH'?1"D") W *7,!!,"Must be H for HOSPITAL or D for HOSPITAL-DOM",!! H 3 G ASK
"RTN","DVBAB56",60,0)
 S HEAD=HEAD_" ("_$S(DVBAH="H":"Hospital",DVBAH="D":"Hospital-Dom",1:"Unknown selection")_")"
"RTN","DVBAB56",61,0)
 S Z=$S(DVBAH="D":1,DVBAH="H":2,1:0) W $P("om^ospital",U,Z),!!
"RTN","DVBAB56",62,0)
 ;S %ZIS("B")="0;P-OTHER",%ZIS("A")="Printing device: ",%ZIS="AEQ" D ^%ZIS G:POP KILL^DVBAUTIL
"RTN","DVBAB56",63,0)
 I $D(IO("Q")) F I="NOASK","HEAD*","FDT(0)","DTAR","BDATE*","EDATE*","DVBAH" S ZTSAVE(I)=""
"RTN","DVBAB56",64,0)
 I  S NOASK=1,ZTRTN="DQ^DVBARADM",ZTDESC="AMIE Re-admission Report",ZTIO=ION D ^%ZTLOAD W:$D(ZTSK) !,"Request queued.",!! G KILL^DVBAUTIL
"RTN","DVBAB56",65,0)
GO I '$D(NOASK) W !!,"Looking for Pension and A&A cases ...",!!
"RTN","DVBAB56",66,0)
 F DVBADT=BDATE:0 S DVBADT=$O(^DGPM("AMV1",DVBADT)) Q:DVBADT=""!(DVBADT>EDATE)  W:'$D(NOASK) "." F DFN=0:0 S DFN=$O(^DGPM("AMV1",DVBADT,DFN)) Q:DFN=""  F ADM=0:0 S ADM=$O(^DGPM("AMV1",DVBADT,DFN,ADM)) Q:ADM=""  D SORT
"RTN","DVBAB56",67,0)
 I '$D(NOASK) W !!,"Examining cases found for re-admissions within 185 days ...",!!
"RTN","DVBAB56",68,0)
 F DVBAT="PEN","A&A" S HOSPDAYS=$S(DVBAT="PEN"&(DVBAH="H"):89,DVBAT="PEN"&(DVBAH="D"):59,1:29) F DFN=0:0 S DFN=$O(^TMP("DVBA",$J,DVBAT,DFN)) Q:DFN=""  D CAL W:'$D(NOASK) "+"
"RTN","DVBAB56",69,0)
 K ^TMP("DVBA",$J,"PEN"),^TMP("DVBA",$J,"A&A")
"RTN","DVBAB56",70,0)
 I '$D(^TMP("DVBA","PEN",$J))&('$D(^TMP("DVBA","A&A",$J))) W "No data found for parameters entered." H 2 D:$D(ZTQUEUED) KILL^%ZTLOAD G KILL^DVBAUTIL
"RTN","DVBAB56",71,0)
 G ^DVBAB98
"RTN","DVBAB56",72,0)
 ;
"RTN","DVBAB56",73,0)
DQ K ^TMP("DVBA",$J),^TMP("DVBA","PEN",$J),^TMP("DVBA","A&A",$J)
"RTN","DVBAB56",74,0)
 G GO
"RTN","DVBAB57")
0^13^B14107890
"RTN","DVBAB57",1,0)
DVBAB57 ;ALB/KLB - AMIE GUI PENDING 7131 REPORT ;09/7/00
"RTN","DVBAB57",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB57",3,0)
 ;
"RTN","DVBAB57",4,0)
STRT(MSG,SELDIV,DIV) ;
"RTN","DVBAB57",5,0)
 S RO="N"
"RTN","DVBAB57",6,0)
 S RONUM=0
"RTN","DVBAB57",7,0)
 S DIVNUM="",MSGCNT=1
"RTN","DVBAB57",8,0)
 K ^TMP($J)
"RTN","DVBAB57",9,0)
 I RO="Y",RONUM="" S MSG(1)="To sort by RO Number, please enter the RO Number."
"RTN","DVBAB57",10,0)
 I RO="Y",RONUM="" Q
"RTN","DVBAB57",11,0)
 I SELDIV="Y",DIV="" S MSG(1)="To sort by Division, please enter the Division."
"RTN","DVBAB57",12,0)
 I SELDIV="Y",DIV="" Q
"RTN","DVBAB57",13,0)
 I DIV'="" S DIVNUM=$O(^DG(40.8,"C",DIV,DIVNUM)),DIVNAM=$S($D(^DG(40.8,+DIVNUM,0)):$P(^(0),"^",1),1:"Unknown Division")
"RTN","DVBAB57",14,0)
SETUP D STM^DVBCUTL4
"RTN","DVBAB57",15,0)
 S FDT(0)=$$FMTE^XLFDT(DT,"5DZ"),(PG,DVBAQUIT)=0
"RTN","DVBAB57",16,0)
 S HEAD="PENDING REQUEST REPORT FOR "_$P(^DVB(396.1,1,0),U,1)
"RTN","DVBAB57",17,0)
 S HEAD2=$S(RO="Y":"FOR REGIONAL OFFICE "_RONUM,1:"ALL REGIONAL OFFICES")
"RTN","DVBAB57",18,0)
 S HEAD2=HEAD2_$S(SELDIV="Y":", FOR DIVISION "_DIVNAM,1:", ALL DIVISIONS")
"RTN","DVBAB57",19,0)
 S PROCDT="Processed on: "_FDT(0)
"RTN","DVBAB57",20,0)
 S QQ=1,NODTA=0
"RTN","DVBAB57",21,0)
 S ^TMP("CAPRI",MSGCNT)="Pending 7131 Report"_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",22,0)
 S ^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",23,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",24,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD2_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",25,0)
 S ^TMP("CAPRI",MSGCNT)=PROCDT_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",26,0)
 S ^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",27,0)
DATA N REQDTE S REQDTE=""
"RTN","DVBAB57",28,0)
 S:SELDIV="Y" ADIV=DIVNAM
"RTN","DVBAB57",29,0)
 F J=0:0 S REQDTE=$O(^DVB(396,"E",REQDTE)) Q:REQDTE=""  F DA=0:0 S DA=$O(^DVB(396,"E",REQDTE,DA)) Q:DA=""  I $D(^DVB(396,DA,1)),($P(^DVB(396,DA,1),U,12)="")  D:SELDIV="N" ADIV D MAKUTL
"RTN","DVBAB57",30,0)
 S (ADIV,REQDTE)=""
"RTN","DVBAB57",31,0)
 F L=0:0 S REQDTE=$O(^TMP($J,REQDTE)) Q:REQDTE=""  D LVL2LP
"RTN","DVBAB57",32,0)
 ;
"RTN","DVBAB57",33,0)
EXIT I NODTA=0 S MSG(1)="No pending requests found for parameters entered."
"RTN","DVBAB57",34,0)
 I NODTA>0 S MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB57",35,0)
 ;
"RTN","DVBAB57",36,0)
KILL S XRTN=$T(+0)
"RTN","DVBAB57",37,0)
 D SPM^DVBCUTL4
"RTN","DVBAB57",38,0)
 K ^TMP("DVBA","ADMIT",$J),^TMP($J),DVBAQUIT,SELDIV,DIVNUM,REQDTE,PROCDT,QQ,RO,RONUM,XRTN
"RTN","DVBAB57",39,0)
 K LPCNT1,PATDA,DIVNAM,XJ,XI,GDIVPTR,GDIVNUM,GINSTPT,GDIVNAM,GDIV,ADIV,CFLOC,DA,DIV,FDT,HEAD,HEAD2,J,L,MSGCNT,NODTA,PG
"RTN","DVBAB57",40,0)
 Q
"RTN","DVBAB57",41,0)
 ;
"RTN","DVBAB57",42,0)
LVL2LP  ;  ** 2nd level of the 2nd loop in the DATA tag - search ADIV **
"RTN","DVBAB57",43,0)
 F J=0:0 S ADIV=$O(^TMP($J,REQDTE,ADIV)) Q:ADIV=""  D LPLVL3
"RTN","DVBAB57",44,0)
 Q
"RTN","DVBAB57",45,0)
 ;
"RTN","DVBAB57",46,0)
LPLVL3 ;  **  2nd level of the loop in the LVL2LP tag - search DA **
"RTN","DVBAB57",47,0)
 F DA=0:0 S DA=$O(^TMP($J,REQDTE,ADIV,DA)) Q:DA=""  D PRINT^DVBAB67 S:DVBAQUIT=1 ADIV="ZZZZ",DA=999999999,REQDTE=9999999 S QQ=1
"RTN","DVBAB57",48,0)
 Q
"RTN","DVBAB57",49,0)
 ;
"RTN","DVBAB57",50,0)
MAKUTL ;  **  Sort on Request Date to set up a temporary utility global  **
"RTN","DVBAB57",51,0)
 S REQDTE=$P(^DVB(396,DA,1),"^",1),PATDA=$P(^DVB(396,DA,0),"^",1)
"RTN","DVBAB57",52,0)
 S CFLOC=$$STATION^DVBAUTL1(PATDA)
"RTN","DVBAB57",53,0)
 S:CFLOC=-1 CFLOC=0
"RTN","DVBAB57",54,0)
 I SELDIV="Y"&(RO="Y") I CFLOC=RONUM D CHKDIV D:$D(DVBAFND) SETARY
"RTN","DVBAB57",55,0)
 I SELDIV="Y"&(RO="N") D CHKDIV D:$D(DVBAFND) SETARY
"RTN","DVBAB57",56,0)
 I SELDIV="N"&(RO="Y") I CFLOC=RONUM D SETARY
"RTN","DVBAB57",57,0)
 I SELDIV="N"&(RO="N") D SETARY
"RTN","DVBAB57",58,0)
 K DVBAFND
"RTN","DVBAB57",59,0)
 QUIT
"RTN","DVBAB57",60,0)
 ;
"RTN","DVBAB57",61,0)
SETARY ;  ** Set temporary utility global **
"RTN","DVBAB57",62,0)
 S ^TMP($J,REQDTE,ADIV,DA)=""
"RTN","DVBAB57",63,0)
 QUIT
"RTN","DVBAB57",64,0)
 ;
"RTN","DVBAB57",65,0)
ADIV S ADIV=$S($D(^DVB(396,DA,2)):$P(^(2),U,9),1:"") S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBAB57",66,0)
 Q
"RTN","DVBAB57",67,0)
 ;
"RTN","DVBAB57",68,0)
CHKDIV ;**Check for selected Div
"RTN","DVBAB57",69,0)
 N FLDVAR
"RTN","DVBAB57",70,0)
 I $D(^DVB(396,DA,6)) DO
"RTN","DVBAB57",71,0)
 .F FLDVAR=7,9,11,13,15,17,19,21,23,26,28 Q:$D(DVBAFND)  DO
"RTN","DVBAB57",72,0)
 ..I ($P(^DVB(396,DA,6),U,FLDVAR)=DIVNUM) DO
"RTN","DVBAB57",73,0)
 ...I FLDVAR=7 S:$P(^DVB(396,DA,1),U,FLDVAR)="P" DVBAFND=""
"RTN","DVBAB57",74,0)
 ...I FLDVAR'=7 S:$P(^DVB(396,DA,0),U,FLDVAR)="P" DVBAFND=""
"RTN","DVBAB57",75,0)
 I $D(^DVB(396,DA,2)),('$D(DVBAFND)) DO  ;**Check Routing Loc Division
"RTN","DVBAB57",76,0)
 .I $D(^DVB(396,DA,1)) DO
"RTN","DVBAB57",77,0)
 ..I $P(^DVB(396,DA,2),U,9)=DIVNUM,($P(^DVB(396,DA,1),U,12)="") DO
"RTN","DVBAB57",78,0)
 ...S DVBAFND=""
"RTN","DVBAB57",79,0)
 Q
"RTN","DVBAB58")
0^14^B15185844
"RTN","DVBAB58",1,0)
DVBAB58 ;ALB/SPH - CAPRI INSUFF EXAM TRACKING REPORT ;09/06/00
"RTN","DVBAB58",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB58",3,0)
 ;
"RTN","DVBAB58",4,0)
STRT(ZMSG,BEGDT,ENDDT,RPTTYPE) ;
"RTN","DVBAB58",5,0)
MAIN ;**Select Dte Rng & Rpt Type; call report routine
"RTN","DVBAB58",6,0)
 F  Q:$D(DVBAOUT)  DO
"RTN","DVBAB58",7,0)
 .;D HOME^%ZIS
"RTN","DVBAB58",8,0)
 .;S TVAR(1,0)="0,0,1,2:2,1^Insufficient 2507 Exam Report"
"RTN","DVBAB58",9,0)
 .;D WR^DVBAUTL4("TVAR")
"RTN","DVBAB58",10,0)
 .;K TVAR
"RTN","DVBAB58",11,0)
 .;S RPTTYPE=$$RPTTYPE^DVBCUTA1()
"RTN","DVBAB58",12,0)
 .S:((RPTTYPE'="D")&(RPTTYPE'="S")) DVBAOUT=""
"RTN","DVBAB58",13,0)
 .;W:'$D(DVBAOUT) !!
"RTN","DVBAB58",14,0)
 .;D:'$D(DVBAOUT) DATE^DVBCUTL4(.BEGDT,.ENDDT)
"RTN","DVBAB58",15,0)
 .I $D(ENDDT),(+ENDDT>0) DO
"RTN","DVBAB58",16,0)
 ..S ENDDT=ENDDT_".2359"
"RTN","DVBAB58",17,0)
 ..I RPTTYPE="S" DO
"RTN","DVBAB58",18,0)
 ...D DEVSEL
"RTN","DVBAB58",19,0)
 ...I POP D SUMKILL
"RTN","DVBAB58",20,0)
 ...I 'POP DO
"RTN","DVBAB58",21,0)
 ....I $D(IO("Q")) DO
"RTN","DVBAB58",22,0)
 .....N DVBAI
"RTN","DVBAB58",23,0)
 .....S ZTRTN="SUM^DVBCIRPT",ZTIO=ION
"RTN","DVBAB58",24,0)
 .....S ZTDESC="Summary Insufficient Exam Report"
"RTN","DVBAB58",25,0)
 .....F DVBAI="BEGDT","ENDDT" S ZTSAVE(DVBAI)=""
"RTN","DVBAB58",26,0)
 .....D ^%ZTLOAD
"RTN","DVBAB58",27,0)
 .....N TSK S TSK=$S($D(ZTSK)=0:"C",1:"Y")
"RTN","DVBAB58",28,0)
 .....I TSK="Y" W !!,"Summary Report Queued. Task number: ",ZTSK
"RTN","DVBAB58",29,0)
 .....K ZTSK D CONTMES^DVBCUTL4
"RTN","DVBAB58",30,0)
 .....D SUMKILL
"RTN","DVBAB58",31,0)
 ....I '$D(IO("Q")) D SUM
"RTN","DVBAB58",32,0)
 ...D ^%ZISC
"RTN","DVBAB58",33,0)
 ..I RPTTYPE="D" DO
"RTN","DVBAB58",34,0)
 ...D DETSEL^DVBCIRP1 ;**Select the Reasons and Exams to report
"RTN","DVBAB58",35,0)
 ...I '$D(DVBAQTSL) DO
"RTN","DVBAB58",36,0)
 ....D DEVSEL
"RTN","DVBAB58",37,0)
 ....I POP D KVARS^DVBCIRP1
"RTN","DVBAB58",38,0)
 ....I 'POP DO
"RTN","DVBAB58",39,0)
 .....I $D(IO("Q")) DO
"RTN","DVBAB58",40,0)
 ......N DVBAI
"RTN","DVBAB58",41,0)
 ......S ZTRTN="DETAIL^DVBCIRP1",ZTIO=ION
"RTN","DVBAB58",42,0)
 ......S ZTDESC="Detailed Insufficient Exam Report"
"RTN","DVBAB58",43,0)
 ......F DVBAI="BEGDT","ENDDT","DVBAARY(""REASON"",","^TMP($J,""XMTYPE""," S ZTSAVE(DVBAI)=""
"RTN","DVBAB58",44,0)
 ......D ^%ZTLOAD
"RTN","DVBAB58",45,0)
 ......N TSK S TSK=$S($D(ZTSK)=0:"C",1:"Y")
"RTN","DVBAB58",46,0)
 ......I TSK="Y" W !!,"Detail Report Queued. Task number: ",ZTSK
"RTN","DVBAB58",47,0)
 ......K ZTSK D CONTMES^DVBCUTL4
"RTN","DVBAB58",48,0)
 ......D KVARS^DVBCIRP1
"RTN","DVBAB58",49,0)
 .....I '$D(IO("Q")) W:IOST?1"C-".E @IOF D DETAIL^DVBCIRP1
"RTN","DVBAB58",50,0)
 ....D ^%ZISC
"RTN","DVBAB58",51,0)
 ...K DVBAQTSL
"RTN","DVBAB58",52,0)
 ..D CLEANUP
"RTN","DVBAB58",53,0)
 D KVARS
"RTN","DVBAB58",54,0)
 Q
"RTN","DVBAB58",55,0)
 ;
"RTN","DVBAB58",56,0)
KVARS ;** Kill the variables used in report
"RTN","DVBAB58",57,0)
 K DVBAOUT,ENDDT,BEGDT,DTOUT,DUOUT,RPTTYPE,DVBACAN,DVBASTAT
"RTN","DVBAB58",58,0)
 D CLEANUP
"RTN","DVBAB58",59,0)
 Q
"RTN","DVBAB58",60,0)
 ;
"RTN","DVBAB58",61,0)
CLEANUP ;** Kill the variables used by the device handler
"RTN","DVBAB58",62,0)
 K %ZIS,POP,%IS,IOP
"RTN","DVBAB58",63,0)
 Q
"RTN","DVBAB58",64,0)
 ;
"RTN","DVBAB58",65,0)
DEVSEL ;** Select the device to report to
"RTN","DVBAB58",66,0)
 S %ZIS="AEQ"
"RTN","DVBAB58",67,0)
 S %ZIS("A")="Output device: "
"RTN","DVBAB58",68,0)
 D ^%ZIS
"RTN","DVBAB58",69,0)
 Q
"RTN","DVBAB58",70,0)
 ;
"RTN","DVBAB58",71,0)
SUM ;** Set up reason counter array, count all 2507's received
"RTN","DVBAB58",72,0)
 U IO
"RTN","DVBAB58",73,0)
 S (DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM)=0
"RTN","DVBAB58",74,0)
 S DVBACAN("REQ")=0,DVBACAN("EXM")=0
"RTN","DVBAB58",75,0)
 S DVBAENDL=ENDDT
"RTN","DVBAB58",76,0)
 ;
"RTN","DVBAB58",77,0)
 ;** Initialize reason counter array
"RTN","DVBAB58",78,0)
 F DVBARIFN=0:0 S DVBARIFN=$O(^DVB(396.94,DVBARIFN)) Q:+DVBARIFN'>0  DO
"RTN","DVBAB58",79,0)
 .S DVBAINXM(DVBARIFN)=0
"RTN","DVBAB58",80,0)
 S DVBAINXM("NO REASON")=0
"RTN","DVBAB58",81,0)
 ;
"RTN","DVBAB58",82,0)
 ;** Count the total and insufficient number of exams and 2507 requests
"RTN","DVBAB58",83,0)
 S DVBADTLP=BEGDT-.0001
"RTN","DVBAB58",84,0)
 F  S DVBADTLP=$O(^DVB(396.3,"ADP",DVBADTLP)) Q:(DVBADTLP=""!(DVBADTLP>ENDDT))  DO
"RTN","DVBAB58",85,0)
 .S DVBAPRIO=""
"RTN","DVBAB58",86,0)
 .F  S DVBAPRIO=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO)) Q:DVBAPRIO=""  DO
"RTN","DVBAB58",87,0)
 ..S DVBADALP=""
"RTN","DVBAB58",88,0)
 ..F  S DVBADALP=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO,DVBADALP)) Q:DVBADALP=""  DO
"RTN","DVBAB58",89,0)
 ...S DVBARQCT=DVBARQCT+1
"RTN","DVBAB58",90,0)
 ...K DVBAINSF
"RTN","DVBAB58",91,0)
 ...I DVBAPRIO="E" DO
"RTN","DVBAB58",92,0)
 ....S DVBAINRQ=DVBAINRQ+1
"RTN","DVBAB58",93,0)
 ....I $P(^DVB(396.3,DVBADALP,0),U,18)="RX" S DVBACAN("REQ")=DVBACAN("REQ")+1
"RTN","DVBAB58",94,0)
 ....S DVBAINSF=""
"RTN","DVBAB58",95,0)
 ...S DVBAXMDA=""
"RTN","DVBAB58",96,0)
 ...F  S DVBAXMDA=$O(^DVB(396.4,"C",DVBADALP,DVBAXMDA)) Q:DVBAXMDA=""  DO
"RTN","DVBAB58",97,0)
 ....S DVBAXMCT=DVBAXMCT+1
"RTN","DVBAB58",98,0)
 ....I $D(DVBAINSF) DO
"RTN","DVBAB58",99,0)
 .....S DVBAINXM=DVBAINXM+1
"RTN","DVBAB58",100,0)
 .....S DVBARIFN=$P(^DVB(396.4,DVBAXMDA,0),U,11),DVBASTAT=$P(^(0),U,4)
"RTN","DVBAB58",101,0)
 .....S:DVBARIFN="" DVBARIFN="NO REASON"
"RTN","DVBAB58",102,0)
 .....S DVBAINXM(DVBARIFN)=DVBAINXM(DVBARIFN)+1
"RTN","DVBAB58",103,0)
 .....I DVBASTAT="RX" S DVBACAN("EXM")=DVBACAN("EXM")+1
"RTN","DVBAB58",104,0)
 D SUMRPT^DVBCIRP1
"RTN","DVBAB58",105,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DVBAB58",106,0)
 D SUMKILL
"RTN","DVBAB58",107,0)
 D ^%ZISC
"RTN","DVBAB58",108,0)
 Q
"RTN","DVBAB58",109,0)
 ;
"RTN","DVBAB58",110,0)
SUMKILL ;** Kill the variables used in the summary report
"RTN","DVBAB58",111,0)
 K DVBADTLP,DVBAENDL,DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM
"RTN","DVBAB58",112,0)
 K DVBAPRIO,DVBADALP,DVBAXMDA,DVBAINSF,DVBARIFN
"RTN","DVBAB58",113,0)
 Q
"RTN","DVBAB6")
0^24^B33770276
"RTN","DVBAB6",1,0)
DVBAB6 ;ALB/KLB - CAPRI PENDING 2507 REQUEST ;08/01/00
"RTN","DVBAB6",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB6",3,0)
 ;
"RTN","DVBAB6",4,0)
STRT(MSG,DVBCSORT,RSTAT,ERDAYS,OLDAYS,ADIVNUM,ELTYP) ;
"RTN","DVBAB6",5,0)
 K ^TMP($J),^TMP("CAPRI")
"RTN","DVBAB6",6,0)
 S DVBCCNT=0,K="",KK="",DONE="NO",DVBABDIV=""
"RTN","DVBAB6",7,0)
 S DVBCCNT=0,MSGCNT=1
"RTN","DVBAB6",8,0)
 I ADIVNUM'="" S DVBABDIV=$O(^DG(40.8,"C",ADIVNUM,DVBABDIV)),ADIVNUM=DVBABDIV
"RTN","DVBAB6",9,0)
SETUP K ^TMP($J) S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ"),PG=1
"RTN","DVBAB6",10,0)
 S DVBCHDR=$S(DVBCSORT="V":"VETERAN NAME",DVBCSORT="R":"Routing location",DVBCSORT="S":"Status",DVBCSORT="A":"Age of request",1:"Unknown"),DVBCHDR="Sorted by "_DVBCHDR
"RTN","DVBAB6",11,0)
HEAD S HEAD="Pending 2507 Requests for "_$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Unknown site"),HEAD2="",PROCDT="Processed on: "_DVBCDT(0),NODATA=0
"RTN","DVBAB6",12,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",13,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD2_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)=PROCDT_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",14,0)
 F I=1:1:75 S K=K_"="
"RTN","DVBAB6",15,0)
 S ^TMP("CAPRI",MSGCNT)=K_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",16,0)
 S ^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="",MSGCNT=MSGCNT+1
"RTN","DVBAB6",17,0)
DATA S DFN="" F J=0:0 S DFN=$O(^DVB(396.3,"B",DFN)) Q:DFN=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",DFN,REQDA)) Q:REQDA=""  D SORT^DVBAB5
"RTN","DVBAB6",18,0)
 I DVBCSORT="V" S PNAM="" F I=0:0 S PNAM=$O(^TMP($J,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,PNAM,DFN)) Q:'DFN  F DA(1)=0:0 S DA(1)=$O(^TMP($J,PNAM,DFN,DA(1))) Q:'DA(1)  D PRINT I $D(OUT) S DA(1)=999999999,PNAM="ZZZ",DONE="YES" Q
"RTN","DVBAB6",19,0)
 I DVBCSORT="R"!(DVBCSORT="A") S PNAM="" F JX=-1:0 S JX=$O(^TMP($J,JX)) Q:'JX  F I=0:0 S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:'DFN  D NXT
"RTN","DVBAB6",20,0)
 I DVBCSORT="S" S (PNAM,JX)="" F ZX=0:0 S JX=$O(^TMP($J,JX)) Q:JX=""  F I=0:0 S PNAM=$O(^TMP($J,JX,PNAM)) Q:PNAM=""  F DFN=0:0 S DFN=$O(^TMP($J,JX,PNAM,DFN)) Q:DFN=""  D NXT
"RTN","DVBAB6",21,0)
 I DVBCCNT>0 S ^TMP("CAPRI",MSGCNT)="Total pending: "_DVBCCNT,DONE="YES"
"RTN","DVBAB6",22,0)
 ;
"RTN","DVBAB6",23,0)
EXIT I NODATA=0 S ^TMP("CAPRI",MSGCNT)="No pending request found for select parameters.",MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",24,0)
 I DONE="YES" D
"RTN","DVBAB6",25,0)
 .K MSG
"RTN","DVBAB6",26,0)
 .S MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB6",27,0)
 K ^TMP($J),ADIV,ADIVNUM,DVBABDIV,CNUM,DA,DA(1),DFN,DONE,DVBCCNT,DVBCDT,DVBCHDR,NODATA,STATUS,TST,TSTA1,STSAT,X,XX,ZS,ZZZ,ELTYP,ERDAYS,OLDAYS,HEAD,HEAD2,JX,K,KKMSGCNT,PG,PNAM,PRTNM,RDATE,RDATE1,REQDA,SSN,RONAME,DVBCSORT,EDAYS,I,J,OUT,OWNDOM
"RTN","DVBAB6",28,0)
 K PROCDT,REQSTR,RSTAT,TSTAT,ZX
"RTN","DVBAB6",29,0)
 Q
"RTN","DVBAB6",30,0)
 ;
"RTN","DVBAB6",31,0)
PRINT S ADIV=$S($D(^DVB(396.3,DA(1),1)):$P(^(1),U,4),1:"") Q:ADIV'=ADIVNUM&(DVBCSORT="R")  I ADIV]"" S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBAB6",32,0)
 S RDATE1=$P(^DVB(396.3,DA(1),0),U,2),RDATE=$P(^(0),U,5),SSN=$P(^DPT(DFN,0),U,9),CNUM=$S($D(^(.31)):$P(^(.31),U,3),1:"Unknown") D ELAPSED^DVBAB5
"RTN","DVBAB6",33,0)
 S STATUS="Unknown",^TMP("CAPRI",MSGCNT)="Division: "_ADIV_"^",MSGCNT=MSGCNT+1,XX=$P(^DVB(396.3,DA(1),0),U,18),STATUS=$S(XX="N":"New",XX="P":"Pending, reported",XX="S":"Pending, scheduled",XX="R":"Released to RO, not printed",1:"")
"RTN","DVBAB6",34,0)
 I STATUS="",$D(XX) S STATUS=$S(XX="C":"Completed, printed by RO",XX="X":"Cancelled by RO",XX="T":"Transcribed",XX="NT":"New,Transferred in",XX="CT":"Completed, Transferred out",1:"Unknown")
"RTN","DVBAB6",35,0)
 S ^TMP("CAPRI",MSGCNT)="Status: "_STATUS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",36,0)
 S ^TMP("CAPRI",MSGCNT)=PNAM_" ^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="SSN: "_SSN_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="Claim no: "_CNUM_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",37,0)
 S ^TMP("CAPRI",MSGCNT)="Request Date: "_$$FMTE^XLFDT(RDATE1,"5DZ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",38,0)
 S ^TMP("CAPRI",MSGCNT)="Elapsed days: "_EDAYS_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",39,0)
 S ^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",40,0)
 S X=$S($D(^DVB(396.3,DA(1),4)):^(4),1:"")
"RTN","DVBAB6",41,0)
 S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" S ^TMP("CAPRI",MSGCNT)="Transferred in from "_$S($D(^DIC(4.2,+OWNDOM,0)):$P(^(0),U,1),1:"Unknown Site")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",42,0)
 S ^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",43,0)
 S ^TMP("CAPRI",MSGCNT)="Exams requested:"_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",44,0)
 ;
"RTN","DVBAB6",45,0)
ITEMS D TST S NODATA=1,REQSTR=+$P(^DVB(396.3,DA(1),0),U,4)
"RTN","DVBAB6",46,0)
 S ZZZ="Requested by: "_$S($D(^VA(200,+REQSTR,0)):$P(^(0),U,1),1:" (Not specified) ")_" at "
"RTN","DVBAB6",47,0)
 S RONAME=$P(^DVB(396.3,DA(1),0),U,3),RONAME=$S(RONAME]"":$P(^DIC(4,+RONAME,0),U,1),1:"")
"RTN","DVBAB6",48,0)
 S ^TMP("CAPRI",MSGCNT)="^"_ZZZ_$S(RONAME]"":RONAME,1:" (Not specified) ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",49,0)
 S ^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",50,0)
 S KK="---------------------------------------------------------------------------"
"RTN","DVBAB6",51,0)
 S ^TMP("CAPRI",MSGCNT)=KK_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",52,0)
 S DVBCCNT=DVBCCNT+1,MSGCNT=MSGCNT+1
"RTN","DVBAB6",53,0)
 Q
"RTN","DVBAB6",54,0)
NXT F DA(1)=0:0 S DA(1)=$O(^TMP($J,JX,PNAM,DFN,DA(1))) Q:DA(1)=""  D PRINT I $D(OUT) S DA(1)="",PNAM="ZZZZ",JX=$S($A(JX)>57:PNAM,1:9999999),DONE="YES"
"RTN","DVBAB6",55,0)
 Q
"RTN","DVBAB6",56,0)
TST F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  K PRINT S TSTAT=$P(^DVB(396.4,DA,0),U,4),TST=$P(^DVB(396.4,DA,0),U,3),PRTNM=$S($D(^DVB(396.6,TST,0)):$P(^(0),U,2),1:"") D TST1
"RTN","DVBAB6",57,0)
 Q
"RTN","DVBAB6",58,0)
TST1 S TSTA1=""
"RTN","DVBAB6",59,0)
 I $D(^DVB(396.4,DA,"CAN")) S TSTA1=$P(^DVB(396.4,DA,"CAN"),U,3)
"RTN","DVBAB6",60,0)
 I $D(^DVB(396.4,DA,"TRAN")) S X=$P(^DVB(396.4,DA,"TRAN"),U,3)
"RTN","DVBAB6",61,0)
 S:TSTA1]"" TSTA1=$P(^DVB(396.5,TSTA1,0),U,1)
"RTN","DVBAB6",62,0)
 S ^TMP("CAPRI",MSGCNT)=$S(PRTNM]"":PRTNM,1:"Missing exam name")_$S(TSTA1]"":" -cancelled ("_TSTA1_")",TSTAT="T":" - Transferred",TSTAT="":" (Unknown status)",1:"")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB6",63,0)
 I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") S ^TMP("CAPRI",MSGCNT)=" to "_$P(X,".",1),MSGCNT=MSGCNT+1
"RTN","DVBAB6",64,0)
 ;S ^TMP("CAPRI",MSGCNT)=";",MSGCNT=MSGCNT+1
"RTN","DVBAB6",65,0)
 Q
"RTN","DVBAB67")
0^15^B15630377
"RTN","DVBAB67",1,0)
DVBAB67 ;ALB/KLB - CAPRI PENDING REPORT - PART 2 (called by DVBAB57) ;09/09/00
"RTN","DVBAB67",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB67",3,0)
 ;
"RTN","DVBAB67",4,0)
DCHGDT S DCHGDT="",DCHPTR=$P(^DGPM(XJ,0),U,17),XADMDT=$P(^(0),U,1) I DCHPTR]"",$D(^DGPM(+DCHPTR,0)) S DCHGDT=$P(^DGPM(+DCHPTR,0),U,1)
"RTN","DVBAB67",5,0)
 K DCHPTR
"RTN","DVBAB67",6,0)
 Q
"RTN","DVBAB67",7,0)
 ;
"RTN","DVBAB67",8,0)
PRINT S DOCTYPE=$S($D(^DVB(396,DA,2)):$P(^(2),U,10),1:""),DFN=$P(^DVB(396,DA,0),U,1),ADMDT=$P(^(0),U,4),RDATE=$P(^(1),U,1),PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9),CNUM=$S($D(^(.31)):$P(^(.31),U,3),1:"UNKNOWN")
"RTN","DVBAB67",9,0)
 I RO="Y" S CFLOC=$$STATION^DVBAUTL1(DFN),CFLOC=$S(CFLOC>0:CFLOC,1:9999) Q:CFLOC'=RONUM&(CFLOC'=0)&(CFLOC'=376)
"RTN","DVBAB67",10,0)
 K ^TMP("DVBA","ADMIT",$J)
"RTN","DVBAB67",11,0)
 F XI=0:0 S XI=$O(^DGPM("APTT1",DFN,XI)) Q:XI=""  F XJ=0:0 S XJ=$O(^DGPM("APTT1",DFN,XI,XJ)) Q:XJ=""  D DCHGDT S ^TMP("DVBA","ADMIT",$J,XADMDT,DFN)=XI_U_DCHGDT
"RTN","DVBAB67",12,0)
 S:SELDIV="Y" ^TMP("CAPRI",MSGCNT)="Division: "_ADIV_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",13,0)
 S:SELDIV="N" ^TMP("CAPRI",MSGCNT)="Original Division: "_ADIV_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",14,0)
 S ^TMP("CAPRI",MSGCNT)=PNAM_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="SSN: "_SSN_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="Claim no: "_CNUM_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",15,0)
 S ^TMP("CAPRI",MSGCNT)=$S(DOCTYPE="L":" Activity date: ",1:"Admission date: ")_$$FMTE^XLFDT(ADMDT,"5DZ")_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="Request date: "_$$FMTE^XLFDT(RDATE,"5DZ")_"^"
"RTN","DVBAB67",16,0)
 S DCHGDT=""
"RTN","DVBAB67",17,0)
 I $D(^TMP("DVBA","ADMIT",$J,+ADMDT,DFN)) S:DOCTYPE="A" DCHGDT=$P(^TMP("DVBA","ADMIT",$J,+ADMDT,DFN),U,2)
"RTN","DVBAB67",18,0)
 D ELAPSED
"RTN","DVBAB67",19,0)
 I DCHGDT]""_"^" S Y=DCHGDT X ^DD("DD") S ^TMP("CAPRI",MSGCNT)="",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="** Discharged: "_Y_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",20,0)
 S ^TMP("CAPRI",MSGCNT)="Elapsed days: "_EDAYS_"^",MSGCNT=MSGCNT+1,^TMP("CAPRI",MSGCNT)="Items Pending:"_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",21,0)
ITEMS F Q=9,11,13,15,17,19,21,23,26,28 I $P(^DVB(396,DA,0),U,Q)="P" D PRINT1 Q:DVBAQUIT=1
"RTN","DVBAB67",22,0)
 S Q=7 I $P(^DVB(396,DA,1),U,Q)="P" D PRINT1 Q:DVBAQUIT=1
"RTN","DVBAB67",23,0)
 S:$D(^DVB(396,DA,2)) ^TMP("CAPRI",MSGCNT)="Requested by: "_$S($P(^DVB(396,DA,2),U,8)]"":$P(^(2),U,8),1:" (Not specified) ")_" AT "_$S($P(^(2),U,7)]"":$P(^(2),U,7),1:" (Not specified) ")_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",24,0)
 S L="---------------------------------------------------------------------------"
"RTN","DVBAB67",25,0)
 S ^TMP("CAPRI",MSGCNT)=L_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",26,0)
 S ^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB67",27,0)
 Q:DVBAQUIT=1
"RTN","DVBAB67",28,0)
 Q
"RTN","DVBAB67",29,0)
 ;
"RTN","DVBAB67",30,0)
PRINT1 S:$D(^DVB(396,DA,6)) GDIVPTR=$P(^DVB(396,DA,6),"^",Q)
"RTN","DVBAB67",31,0)
 S:'$D(^DVB(396,DA,6)) GDIVPTR=$P(^DVB(396,DA,2),"^",9)
"RTN","DVBAB67",32,0)
 S:+GDIVPTR>0 GDIVNAM=$P(^DG(40.8,GDIVPTR,0),"^",1)
"RTN","DVBAB67",33,0)
 S:+GDIVPTR'>0 GDIVNAM=""
"RTN","DVBAB67",34,0)
 S NODTA=1 I QQ S MC=$T(@Q),MD=$P(MC,";;",2) S GDIV=" ("_$E(GDIVNAM,1,(9+(23-$L(MC))))_")" S ^TMP("CAPRI",MSGCNT)="        "_MD_GDIV_"^",MSGCNT=MSGCNT+1 S QQ='QQ Q
"RTN","DVBAB67",35,0)
 I 'QQ S MC=$T(@Q),MD=$P(MC,";;",2) S GDIV=" ("_$E(GDIVNAM,1,(9+(23-$L(MC))))_")" S ^TMP("CAPRI",MSGCNT)="                                    "_MD_GDIV_"^",MSGCNT=MSGCNT+1 S QQ='QQ I $Y>22 Q:DVBAQUIT=1
"RTN","DVBAB67",36,0)
 Q
"RTN","DVBAB67",37,0)
 ;
"RTN","DVBAB67",38,0)
ELAPSED K EDAYS,X1,X S X1=DT,X=RDATE D ^XUWORKDY
"RTN","DVBAB67",39,0)
 S EDAYS=X
"RTN","DVBAB67",40,0)
 Q
"RTN","DVBAB67",41,0)
 ;
"RTN","DVBAB68")
0^16^B14913222
"RTN","DVBAB68",1,0)
DVBAB68 ;ALB/SPH - CAPRI C&P EXAM DETAIL REPORT ;09/11/00
"RTN","DVBAB68",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB68",3,0)
 ;
"RTN","DVBAB68",4,0)
EN ;only need DFN to return data
"RTN","DVBAB68",5,0)
 I '$D(^DVB(396.4,"APE",DFN)) S ZMSG(DVBABCNT)="No Requests are currently on file.",DVBABCNT=DVBABCNT+1 Q
"RTN","DVBAB68",6,0)
 ;;;I '$D(^DVB(396.4,"APE",DFN)) W !!,"Press [RETURN] to continue"
"RTN","DVBAB68",7,0)
 ;;;I '$D(^DVB(396.4,"APE",DFN)) R DVBCIN:DTIME K DVBCIN Q
"RTN","DVBAB68",8,0)
 S ZMSG(DVBABCNT)="Requested exams currently on file:",DVBABCNT=DVBABCNT+1
"RTN","DVBAB68",9,0)
 D SORT
"RTN","DVBAB68",10,0)
 S ZMSG(DVBABCNT)="--------------------------------------------------------------------------------",DVBABCNT=DVBABCNT+1
"RTN","DVBAB68",11,0)
 K DVBAEXM,DVBAEXST,DVBADA,DVBADONE,DVBAPDT,DVBAST,DVBARO,JX,DVBCX
"RTN","DVBAB68",12,0)
 Q
"RTN","DVBAB68",13,0)
 ;
"RTN","DVBAB68",14,0)
STAT S DVBAST=$P(^DVB(396.4,DVBADA,0),U,4)
"RTN","DVBAB68",15,0)
 S:$D(^DVB(396.4,DVBADA,"TRAN")) DVBCX=$P(^("TRAN"),U,3)
"RTN","DVBAB68",16,0)
 S DVBAST=$S(DVBAST="C":"Completed",DVBAST="RX":"Cancelled by RO",DVBAST="X":"Cancelled by MAS",DVBAST="F":"Cancelled, failed to report",DVBAST="O":"Open",DVBAST="T":"Transferred",1:"Unknown status")
"RTN","DVBAB68",17,0)
 Q
"RTN","DVBAB68",18,0)
 ;
"RTN","DVBAB68",19,0)
CON I $Y>12,IOST?1"C-".E W !
"RTN","DVBAB68",20,0)
 ;!,"Press [RETURN] to continue or ""^"" to end display of existing exams" R ANS:DTIME W ! I '$T!(ANS=U) S DVBADONE=1
"RTN","DVBAB68",21,0)
 I $Y>12,IOST?1"C-".E ;W:(DVBADONE'=1) @IOF,"Exams currently on file, continued --",!!!
"RTN","DVBAB68",22,0)
 I ($Y>45),(IOST?1"P-".E) D HDR
"RTN","DVBAB68",23,0)
 Q
"RTN","DVBAB68",24,0)
 ;
"RTN","DVBAB68",25,0)
HDR S PG=PG+1
"RTN","DVBAB68",26,0)
 W @IOF,!,"Date: ",FDT(0),?(80-$L(PGHD)\2),PGHD,?71,"Page: ",PG,!,?(80-$L($$SITE^DVBCUTL4)\2),$$SITE^DVBCUTL4 I PG>1 W !!,"Name: ",PNAM,?44,"SSN: ",SSN,?63,"C-NUM: ",CNUM
"RTN","DVBAB68",27,0)
 W ! F XLINE=1:1:80 W "="
"RTN","DVBAB68",28,0)
 W !!,"Requested exams currently on file:",!
"RTN","DVBAB68",29,0)
 W ! Q
"RTN","DVBAB68",30,0)
 ;
"RTN","DVBAB68",31,0)
SORT ;  ** Explore 396.4 file; display exams already requested **
"RTN","DVBAB68",32,0)
 N DVBAEXM,DVBADA,DVBADONE,DVBAPDT,DVBAST,DVBARO,DVBARQDT
"RTN","DVBAB68",33,0)
 S (DVBAEXM,DVBADA,DVBADONE,DVBAPDT,DVBAST,DVBARO,DVBARQDT)=""
"RTN","DVBAB68",34,0)
 F  S DVBAEXM=$O(^DVB(396.4,"APE",DFN,DVBAEXM)) Q:DVBAEXM=""!(DVBADONE=1)  F  S DVBARQDT=$O(^DVB(396.4,"APE",DFN,DVBAEXM,DVBARQDT)) Q:DVBARQDT=""  D FLOOP Q:DVBADONE=1
"RTN","DVBAB68",35,0)
 Q
"RTN","DVBAB68",36,0)
 ;
"RTN","DVBAB68",37,0)
FLOOP ;  **  Final loop of "APE" index **
"RTN","DVBAB68",38,0)
 F  S DVBADA=$O(^DVB(396.4,"APE",DFN,DVBAEXM,DVBARQDT,DVBADA)) Q:DVBADA=""  D BLD,CON Q:DVBADONE=1  D PRINT
"RTN","DVBAB68",39,0)
 Q
"RTN","DVBAB68",40,0)
 ;
"RTN","DVBAB68",41,0)
BLD ;  ** Set variables to be printed to screen **
"RTN","DVBAB68",42,0)
 N DA,DIK,DATA,DVBAREQ,DVBASTAT,DVBATYPE
"RTN","DVBAB68",43,0)
 ;don't continue if record doesn't exist in file #396.4
"RTN","DVBAB68",44,0)
 I '$D(^DVB(396.4,DVBADA,0)) D  Q
"RTN","DVBAB68",45,0)
 .;kill xref if record doesn't exist
"RTN","DVBAB68",46,0)
 .K ^DVB(396.4,"APE",DFN,DVBAEXM,DVBARQDT,DVBADA)
"RTN","DVBAB68",47,0)
 ;don't continue if record doesn't exist in file #396.3
"RTN","DVBAB68",48,0)
 S DVBAREQ=$P(^DVB(396.4,DVBADA,0),U,2) D  Q:'DVBAREQ
"RTN","DVBAB68",49,0)
 .I '$D(^DVB(396.3,DVBAREQ)) D
"RTN","DVBAB68",50,0)
 ..;delete record in file #396.4 if its 'parent' in file #396.3 doesn't exist
"RTN","DVBAB68",51,0)
 ..;remove reference to file #396.3 so call to ^dik won't error out
"RTN","DVBAB68",52,0)
 ..S DATA=^DVB(396.4,DVBADA,0),$P(^(0),U,2)=""
"RTN","DVBAB68",53,0)
 ..;delete "c" xref and mumps xrefs manually because reference to file #396.3 was removed
"RTN","DVBAB68",54,0)
 ..S DVBATYPE=$P(DATA,U,3),DVBASTAT=$P(DATA,U,4)
"RTN","DVBAB68",55,0)
 ..K ^DVB(396.4,"C",DVBAREQ,DVBADA)
"RTN","DVBAB68",56,0)
 ..K ^DVB(396.4,"APE",DFN,DVBAEXM,DVBARQDT,DVBADA)
"RTN","DVBAB68",57,0)
 ..K ^DVB(396.4,"APS",DFN,DVBATYPE,DVBASTAT,DVBADA)
"RTN","DVBAB68",58,0)
 ..K ^DVB(396.4,"ARQ"_DVBAREQ,DVBATYPE,DVBADA)
"RTN","DVBAB68",59,0)
 ..;proceed with fm delete
"RTN","DVBAB68",60,0)
 ..S DIK="^DVB(396.4,",DA=DVBADA D ^DIK
"RTN","DVBAB68",61,0)
 ..S DVBAREQ=0
"RTN","DVBAB68",62,0)
 S Y=DVBARQDT X ^DD("DD") S DVBAPDT=Y
"RTN","DVBAB68",63,0)
 S DVBARO=$P(^DVB(396.3,DVBAREQ,0),U,3)
"RTN","DVBAB68",64,0)
 S DVBARO=$S($D(^DIC(4,+DVBARO,0)):$P(^(0),U,1),1:"Unknown RO")
"RTN","DVBAB68",65,0)
 D STAT
"RTN","DVBAB68",66,0)
 Q
"RTN","DVBAB68",67,0)
 ;
"RTN","DVBAB68",68,0)
PRINT ;  **  Print an entry from list of requested exams **
"RTN","DVBAB68",69,0)
 S ZMSG(DVBABCNT)=DVBAEXM,DVBABCNT=DVBABCNT+1
"RTN","DVBAB68",70,0)
 S ZMSG(DVBABCNT)="Requested on "_DVBAPDT_" by "_DVBARO_" - "_DVBAST,DVBABCNT=DVBABCNT+1
"RTN","DVBAB68",71,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB68",72,0)
 Q
"RTN","DVBAB70")
0^17^B38683553
"RTN","DVBAB70",1,0)
DVBAB70 ;ALB/SPH - CAPRI C&P EXAM INQUIRY ;09/08/00
"RTN","DVBAB70",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB70",3,0)
 ;
"RTN","DVBAB70",4,0)
STRT(ZMSG,DFN,ZREQDA) ;
"RTN","DVBAB70",5,0)
 S DVBABCNT=0
"RTN","DVBAB70",6,0)
 K ^TMP($J) S Y=DT X ^DD("DD") S FDT(0)=Y D HOME^%ZIS S FF=IOF
"RTN","DVBAB70",7,0)
 S DIC="^DVB(396.3,"
"RTN","DVBAB70",8,0)
 S DIC(0)="M"
"RTN","DVBAB70",9,0)
 S DIC(1)=ZREQDA
"RTN","DVBAB70",10,0)
 S Y=ZREQDA
"RTN","DVBAB70",11,0)
 S JI=$P(Y,U,2),(DA,DA(1),REQDA)=+Y
"RTN","DVBAB70",12,0)
 S (NAME,SSN,CNUM,ADR1,ADR2,ADR3,CITY,STATE,ZIP,HOMPHON,BUSPHON,OTHDIS)=""
"RTN","DVBAB70",13,0)
 D VARS^DVBCUTIL
"RTN","DVBAB70",14,0)
 G START
"RTN","DVBAB70",15,0)
CON ;
"RTN","DVBAB70",16,0)
 I IOST?1"P-".E,$Y>45 W @IOF D HDR
"RTN","DVBAB70",17,0)
 Q
"RTN","DVBAB70",18,0)
START S PGHD="",PG=0
"RTN","DVBAB70",19,0)
 S ZMSG(DVBABCNT)="                     COMPENSATION AND PENSION EXAM INQUIRY",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",20,0)
 S ZMSG(DVBABCNT)="                     -------------------------------------",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",21,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",22,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",23,0)
 S ZMSG(DVBABCNT)="            Name: "_PNAM,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",24,0)
 S ZMSG(DVBABCNT)="             SSN: "_SSN,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",25,0)
 S ZMSG(DVBABCNT)="        C-Number: "_CNUM,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",26,0)
 S Y=DOB X ^DD("DD")
"RTN","DVBAB70",27,0)
 S ZMSG(DVBABCNT)="             DOB: "_Y,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",28,0)
 S ZMSG(DVBABCNT)="         Address: "_ADR1,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",29,0)
 S ZMSG(DVBABCNT)="                  "_ADR2,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",30,0)
 S ZMSG(DVBABCNT)="                  "_ADR3,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",31,0)
 S ZMSG(DVBABCNT)="City,State,Zip+4: "_CITY_", "_STATE_" "_ZIP,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",32,0)
 S ZMSG(DVBABCNT)="       Res Phone: "_HOMPHON,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",33,0)
 S ZMSG(DVBABCNT)="       Bus Phone: "_BUSPHON,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",34,0)
 S EDTA=$S($D(^DPT(DFN,.32)):^(.32),1:""),EOD=$P(EDTA,U,6),RAD=$P(EDTA,U,7)
"RTN","DVBAB70",35,0)
 S Y=EOD X ^DD("DD") S:Y="" Y="Not specified"
"RTN","DVBAB70",36,0)
 S ZMSG(DVBABCNT)="Entered active service: "_Y,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",37,0)
 S Y=RAD X ^DD("DD") S:Y="" Y="Not specified"
"RTN","DVBAB70",38,0)
 S ZMSG(DVBABCNT)="Released active service: "_Y,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",39,0)
 S ZMSG(DVBABCNT)="================================================================================",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",40,0)
 W !! D CON Q:$D(OUT)  D ^DVBAB97,CON Q:$D(OUT)  D ^DVBAB68,CON Q:$D(OUT)  S REQDT=$P(^DVB(396.3,REQDA,0),U,2)
"RTN","DVBAB70",41,0)
 S Y=REQDT X ^DD("DD")
"RTN","DVBAB70",42,0)
 S ZMSG(DVBABCNT)="This request was initiated on "_$P(Y,"@",1)_" at "_$P(Y,"@",2),DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",43,0)
 S ZMSG(DVBABCNT)="Requester: "_REQN,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",44,0)
 S ZMSG(DVBABCNT)="Requesting Regional Office: "_RONAME,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",45,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",46,0)
 I $D(^DVB(396.4,"C",REQDA)) S ZMSG(DVBABCNT)="Exams on this request: ",DVBABCNT=DVBABCNT+1 D TST^DVBAB96 ;DVBCUTL2 
"RTN","DVBAB70",47,0)
 I '$D(^DVB(396.4,"C",REQDA)) S ZMSG(DVBABCNT)="(No exams have yet been entered)",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",48,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",49,0)
 S ZMSG(DVBABCNT)="** Status of request: ",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",50,0)
 S (XSTAT,STAT)=$P(^DVB(396.3,REQDA,0),U,18)
"RTN","DVBAB70",51,0)
 S STAT=$S(XSTAT="N":"New",XSTAT="P":"Pending, reported to MAS",XSTAT="T":"Transcribed",XSTAT="S":"Scheduled",XSTAT="R":"Released, not printed",XSTAT="C":"Completed",XSTAT="CT":"Completed, transferred out",XSTAT="NT":"New, transferred in",1:"")
"RTN","DVBAB70",52,0)
 I STAT]"" S ZMSG(DVBABCNT)=STAT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",53,0)
 I XSTAT="R"!(XSTAT="C") S Y=$P(^DVB(396.3,REQDA,0),U,14) X ^DD("DD") S RELBY=$P(^DVB(396.3,REQDA,0),U,15),RELBY=$S($D(^VA(200,+RELBY,0)):$P(^(0),U,1),1:"Unknown user") S ZMSG(DVBABCNT)="Released on "_Y_" by "_RELBY,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",54,0)
 I XSTAT="C" S Y=$P(^DVB(396.3,REQDA,0),U,16) X ^DD("DD") S PRBY=$P(^DVB(396.3,REQDA,0),U,17),PRBY=$S($D(^VA(200,+PRBY,0)):$P(^(0),U,1),1:"Unknown user") S ZMSG(DVBABCNT)="Printed by the RO on "_Y_" by "_PRBY,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",55,0)
 I STAT="" S STAT=$S(XSTAT="X":"Cancelled by MAS",XSTAT="RX":"Cancelled by RO",1:"Unknown") S ZMSG(DVBABCNT)=STAT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",56,0)
 I STAT["Cancelled" S CANDT=$P(^DVB(396.3,REQDA,0),U,19) S ZMSG(DVBABCNT)="  (Cancelled on "_$$FMTE^XLFDT(CANDT,"5DZ")_")",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",57,0)
 I $D(^DVB(396.3,REQDA,1)),$P(^(1),U,3)="Y" S ZMSG(DVBABCNT)="This request was faxed to the regional office.",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",58,0)
 S FEXAM=$P(^DVB(396.3,REQDA,0),U,9) I FEXAM="Y" S ZMSG(DVBABCNT)="*** Exams done on a FEE BASIS ***  ",DVBABCNT=DVBABCNT+1 K FEXAM
"RTN","DVBAB70",59,0)
 S ZMSG(DVBABCNT)="--------------------------------------------------------------------------------",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",60,0)
 D DDIS Q:$D(OUT)  D CON Q:$D(OUT)
"RTN","DVBAB70",61,0)
 I IOST?1"P-".E,$Y>45 W @IOF D HDR
"RTN","DVBAB70",62,0)
 S ZMSG(DVBABCNT)="Other Disabilities: "_OTHDIS,DVBABCNT=DVBABCNT+1 I $D(^DVB(396.3,REQDA,1)) S ZMSG(DVBABCNT)="                    "_OTHDIS1,DVBABCNT=DVBABCNT+1 S ZMSG(DVBABCNT)="                    "_OTHDIS2,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",63,0)
 S ZMSG(DVBABCNT)="General Remarks:",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",64,0)
 K ^UTILITY($J,"W")
"RTN","DVBAB70",65,0)
 F LINE=0:0 S LINE=$O(^DVB(396.3,REQDA,2,LINE)) Q:LINE=""  S X=^(LINE,0),DIWL=5,DIWR=75,DIWF="NW" D ^DIWP S ZMSG(DVBABCNT)=X,DVBABCNT=DVBABCNT+1 ;I IOST?1"C-".E,$Y>19 D CON ;W !!,"General Remarks, continued",!!!
"RTN","DVBAB70",66,0)
END    K ^TMP($J),TSTA1,TSTAT,XCNP
"RTN","DVBAB70",67,0)
 Q
"RTN","DVBAB70",68,0)
DDIS1 S ZMSG(DVBABCNT)=DX_"  "_$J(PCT,3,0)_" %",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",69,0)
 S ZMSG(DVBABCNT)="    Service-Connected? "_$S(SC=1:"Yes",1:"No")_"  DX Code: "_DXCOD,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",70,0)
 I $Y>19 D CON
"RTN","DVBAB70",71,0)
 Q
"RTN","DVBAB70",72,0)
DDIS I $Y>12 D CON Q:$D(OUT)
"RTN","DVBAB70",73,0)
 I '$D(^DPT(DFN,.372)) S ZMSG(DVBABCNT)="No rated disabilities on file",DVBABCNT=DVBABCNT+1 Q
"RTN","DVBAB70",74,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",75,0)
 S ZMSG(DVBABCNT)="RATED DISABILITIES:",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",76,0)
 F JII=0:0 S JII=$O(^DPT(DFN,.372,JII)) Q:JII=""  S DXNUM=$P(^DPT(DFN,.372,JII,0),U,1),PCT=$P(^(0),U,2),SC=$P(^(0),U,3),DX=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,1),1:"Unknown"),DXCOD=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,3),1:"Unknown") D DDIS1
"RTN","DVBAB70",77,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",78,0)
 Q
"RTN","DVBAB70",79,0)
HDR S PG=PG+1 W:(IOST?1"C-".E) @IOF
"RTN","DVBAB70",80,0)
 S ZMSG(DVBABCNT)="================================================================================",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",81,0)
 Q
"RTN","DVBAB71")
0^18^B26000515
"RTN","DVBAB71",1,0)
DVBAB71 ;ALB/KLB - CAPRI REQUEST STATUS INQUIRY ;09/11/00
"RTN","DVBAB71",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB71",3,0)
 ;
"RTN","DVBAB71",4,0)
STRT(MSG,DFN,RECIEN) ; 
"RTN","DVBAB71",5,0)
 S U="^"
"RTN","DVBAB71",6,0)
 K ^TMP("CAPRI")
"RTN","DVBAB71",7,0)
 I '$D(DFN) S MSG(1)="You must select a patient."
"RTN","DVBAB71",8,0)
 Q:'$D(DFN)
"RTN","DVBAB71",9,0)
 Q:DFN=""
"RTN","DVBAB71",10,0)
 S PTNAME=$E($P(^DPT(DFN,0),U),1,25)
"RTN","DVBAB71",11,0)
 ;S RECIEN=0,RECIEN=$O(^DVB(396,"B",DFN,RECIEN))
"RTN","DVBAB71",12,0)
 S DVB0=$G(^DVB(396,RECIEN,0)),DVB1=$G(^DVB(396,RECIEN,1)),DVB2=$G(^DVB(396,RECIEN,2)),DVB6=$G(^DVB(396,RECIEN,6))
"RTN","DVBAB71",13,0)
 S MCNT=1
"RTN","DVBAB71",14,0)
 ;S ^TMP("CAPRI",MCNT)="Patient Name: "_PTNAME_"^",MCNT=MCNT+1
"RTN","DVBAB71",15,0)
 I $P(DVB2,U,10)="L" S DOCTYP="ACTIVITY DATE: "
"RTN","DVBAB71",16,0)
 I $P(DVB2,U,10)="A" S DOCTYP="Admission Date: "
"RTN","DVBAB71",17,0)
 S Y=$P(DVB0,U,4) X ^DD("DD")
"RTN","DVBAB71",18,0)
 S ^TMP("CAPRI",MCNT)=" Patient Name: "_PTNAME_"             "_DOCTYP_Y_"^",MCNT=MCNT+1
"RTN","DVBAB71",19,0)
 ;S ^TMP("CAPRI",MCNT)="SSN: "_$P(^DPT(DFN,0),U,9)_"^",MCNT=MCNT+1
"RTN","DVBAB71",20,0)
 S ^TMP("CAPRI",MCNT)="          SSN: "_$P(^DPT(DFN,0),U,9)_"                  Claim Number: "_$P(^DPT(DFN,.31),U,3)_"^",MCNT=MCNT+1
"RTN","DVBAB71",21,0)
 S DIV=$P(DVB2,U,9) I DIV'="" S DIV=$P(^DG(40.8,DIV,0),U)
"RTN","DVBAB71",22,0)
 S ^TMP("CAPRI",MCNT)="Receiving Div: "_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",23,0)
 S ^TMP("CAPRI",MCNT)="  Requisition          Status      Status Date    Operator    Current Division"_"^",MCNT=MCNT+1
"RTN","DVBAB71",24,0)
 S Y=$P(DVB0,U,10) X ^DD("DD") S DIV=$P(DVB6,U,9),STAT=$P(DVB0,U,9) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STAT="              "
"RTN","DVBAB71",25,0)
 I DIV'="" S DIV=$P(^DG(40.8,DIV,0),U)
"RTN","DVBAB71",26,0)
 S ^TMP("CAPRI",MCNT)="---------------------------------------------------------------------------"_"^",MCNT=MCNT+1
"RTN","DVBAB71",27,0)
 S OP=$P(DVB1,U,13) I OP="" S OP="            "
"RTN","DVBAB71",28,0)
DATA S ^TMP("CAPRI",MCNT)="  Notice/Discharge:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",29,0)
 S Y=$P(DVB0,U,12) X ^DD("DD") S DIV=$P(DVB6,U,11)
"RTN","DVBAB71",30,0)
 S STAT=$P(DVB0,U,11) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STAT="              "
"RTN","DVBAB71",31,0)
 S OP=$P(DVB1,U,14) I OP="" S OP="            "
"RTN","DVBAB71",32,0)
 S ^TMP("CAPRI",MCNT)="  Hospital Summary:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",33,0)
 S Y=$P(DVB0,U,14) X ^DD("DD") S DIV=$P(DVB6,U,13)
"RTN","DVBAB71",34,0)
 S STAT=$P(DVB0,U,13) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STAT="              "
"RTN","DVBAB71",35,0)
 S OP=$P(DVB1,U,15) I OP="" S OP="            "
"RTN","DVBAB71",36,0)
 S ^TMP("CAPRI",MCNT)="21-day Certificate:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",37,0)
 S Y=$P(DVB1,U) X ^DD("DD") S DIV=$P(DVB6,U,15)
"RTN","DVBAB71",38,0)
 S STAT=$P(DVB0,U,15) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STATUS="              "
"RTN","DVBAB71",39,0)
 S OP=$P(DVB1,U,16) I OP="" S OP="            "
"RTN","DVBAB71",40,0)
 S ^TMP("CAPRI",MCNT)="       Other/Exam:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",41,0)
 S Y=$P(DVB1,U,3) X ^DD("DD") S DIV=$P(DVB6,U,17)
"RTN","DVBAB71",42,0)
 S STAT=$P(DVB0,U,17) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STAT="              "
"RTN","DVBAB71",43,0)
 S OP=$P(DVB1,U,17) I OP="" S OP="            "
"RTN","DVBAB71",44,0)
 S ^TMP("CAPRI",MCNT)="   Special Report:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",45,0)
 S Y=$P(DVB1,U,4) X ^DD("DD") S DIV=$P(DVB6,U,19)
"RTN","DVBAB71",46,0)
 S STAT=$P(DVB0,U,19) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STAT="              "
"RTN","DVBAB71",47,0)
 S OP=$P(DVB1,U,18) I OP="" S OP="            "
"RTN","DVBAB71",48,0)
 S ^TMP("CAPRI",MCNT)="Competency Report:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",49,0)
 S Y=$P(DVB1,U,5) X ^DD("DD") S DIV=$P(DVB6,U,21)
"RTN","DVBAB71",50,0)
 S STAT=$P(DVB0,U,21) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STAT="              "
"RTN","DVBAB71",51,0)
 S OP=$P(DVB2,U) I OP="" S OP="            "
"RTN","DVBAB71",52,0)
 S ^TMP("CAPRI",MCNT)="     Form 21-2680:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",53,0)
 S Y=$P(DVB1,U,6) X ^DD("DD") S DIV=$P(DVB6,U,23)
"RTN","DVBAB71",54,0)
 S STAT=$P(DVB0,U,23) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STAT="              "
"RTN","DVBAB71",55,0)
 S OP=$P(DVB2,U,2) I OP="" S OP="            "
"RTN","DVBAB71",56,0)
 S ^TMP("CAPRI",MCNT)="Asset Information:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",57,0)
 S Y=$P(DVB1,U,8) X ^DD("DD") S DIV=$P(DVB6,U,7)
"RTN","DVBAB71",58,0)
 S STAT=$P(DVB1,U,7) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STAT="              "
"RTN","DVBAB71",59,0)
 S OP=$P(DVB2,U,3) I OP="" S OP="            "
"RTN","DVBAB71",60,0)
 S ^TMP("CAPRI",MCNT)=" Admission Report:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",61,0)
 S Y=$P(DVB1,U,9) X ^DD("DD") S DIV=$P(DVB6,U,26)
"RTN","DVBAB71",62,0)
 S STAT=$P(DVB0,U,26) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STAT="              "
"RTN","DVBAB71",63,0)
 S OP=$P(DVB2,U,4) I OP="" S OP="            "
"RTN","DVBAB71",64,0)
 S ^TMP("CAPRI",MCNT)="OPT Treatment Rpt:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",65,0)
 S Y=$P(DVB1,U,10) X ^DD("DD") S DIV=$P(DVB6,U,28)
"RTN","DVBAB71",66,0)
 S STAT=$P(DVB0,U,28) I STAT="P" S STAT="PENDING        " I STAT="C" S STAT="COMPLETED     " I STAT="" S STAT="              "
"RTN","DVBAB71",67,0)
 S OP=$P(DVB2,U,5) I OP="" S OP="            "
"RTN","DVBAB71",68,0)
 S ^TMP("CAPRI",MCNT)="    Beg Date/Care:   "_STAT_Y_"    "_OP_DIV_"^",MCNT=MCNT+1
"RTN","DVBAB71",69,0)
 S ^TMP("CAPRI",MCNT)=""_"^",MCNT=MCNT+1
"RTN","DVBAB71",70,0)
 D REM
"RTN","DVBAB71",71,0)
 S ^TMP("CAPRI",MCNT)=""_"^"
"RTN","DVBAB71",72,0)
 S Y=$P(DVB1,U,12) X ^DD("DD")
"RTN","DVBAB71",73,0)
 S ^TMP("CAPRI",MCNT)="Requesting location: "_$E($P(DVB2,U,7),1,20)_"               Date of Request: "_Y,MCNT=MCNT+1
"RTN","DVBAB71",74,0)
 S ^TMP("CAPRI",MCNT)="       Requested by: "_$E($P(DVB2,U,8),1,25)_"          "_Y
"RTN","DVBAB71",75,0)
 S MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB71",76,0)
 ;F  S XX=$O(^TMP("CAPRI",XX)) Q:'XX  S MSG(XX)=$G(^TMP("CAPRI",XX))
"RTN","DVBAB71",77,0)
 K Y,PTNAME,DFN,DVB0,DVB1,DVB2,DVB6
"RTN","DVBAB71",78,0)
 Q
"RTN","DVBAB71",79,0)
REM S X=0,FLG=0
"RTN","DVBAB71",80,0)
 F  S X=$O(^DVB(396,RECIEN,5,X)) Q:'X  D
"RTN","DVBAB71",81,0)
 .I FLG=0 D
"RTN","DVBAB71",82,0)
 ..S ^TMP("CAPRI",MCNT)="REMARKS: "_$G(^DVB(396,RECIEN,5,X,0))_"^",MCNT=MCNT+1
"RTN","DVBAB71",83,0)
 ..S FLG=1
"RTN","DVBAB71",84,0)
 .I FLG=1&(X>1) D
"RTN","DVBAB71",85,0)
 ..S ^TMP("CAPRI",MCNT)=$G(^DVB(396,RECIEN,5,X,0))_"^",MCNT=MCNT+1
"RTN","DVBAB71",86,0)
 S ^TMP("CAPRI",MCNT)=""_"^"
"RTN","DVBAB71",87,0)
 Q
"RTN","DVBAB9")
0^5^B16359814
"RTN","DVBAB9",1,0)
DVBAB9 ;ALB/SPH - CAPRI DISCHARGE REPORT ;09/06/00
"RTN","DVBAB9",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB9",3,0)
 ;
"RTN","DVBAB9",4,0)
STRT(MSG,BDATE,EDATE,RONUM,DUZ) ;
"RTN","DVBAB9",5,0)
 S DVBACEPT=1  ; Force to find all d/c types
"RTN","DVBAB9",6,0)
 ;
"RTN","DVBAB9",7,0)
 K ^TMP($J) G TERM
"RTN","DVBAB9",8,0)
 ;
"RTN","DVBAB9",9,0)
SET Q:'$D(^DPT(DA,0))  S DFN=DA,DVBASC="" D RCV^DVBAVDPT Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)  Q:ADTYPE="S"&(DVBASC'="Y")  Q:ADTYPE="A"&(RCVAA'=1)  Q:ADTYPE="P"&(RCVPEN'="1")
"RTN","DVBAB9",10,0)
 S TDIS=$S($D(^DGPM(+MB,0)):$P(^(0),U,18),1:"")
"RTN","DVBAB9",11,0)
 I $D(^DG(405.2,+TDIS,0)) DO
"RTN","DVBAB9",12,0)
 .I '$D(^TMP("DVBA",$J,"DUP",+TDIS)) Q
"RTN","DVBAB9",13,0)
 .S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBAB9",14,0)
 .S ^TMP($J,XCN,CFLOC,MB,DA)=MA_U_RCVAA_U_RCVPEN_U_CNUM_U_TDIS
"RTN","DVBAB9",15,0)
 .Q
"RTN","DVBAB9",16,0)
 Q
"RTN","DVBAB9",17,0)
 ;
"RTN","DVBAB9",18,0)
PRINTB S MA=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),TDIS=$P(DATA,U,5),DFN=DA,QUIT1=1 D DCHGDT^DVBAVDPT
"RTN","DVBAB9",19,0)
 W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBAB9",20,0)
 W !!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBAB9",21,0)
 W ?10,"Patient Name:",?26,PNAM,!!,?14,"Claim No:",?26,CNUM,!,?6,"Claim Folder Loc:",?26,CFLOC,!,?9,"Social Sec No:",?26,SSN,!
"RTN","DVBAB9",22,0)
 W ?8,"Discharge Date:",?26,$$FMTE^XLFDT(DCHGDT,"5DZ"),!,?5,"Type of Discharge:",?26,TDIS,!
"RTN","DVBAB9",23,0)
 D LOS^DVBAUTIL W ?8,"Length of Stay:",?26,LOS_$S(LOS="":"Discharged same day",LOS=1:" day",1:" days"),!
"RTN","DVBAB9",24,0)
 W ?11,"Bed Service:",?26,BEDSEC,!
"RTN","DVBAB9",25,0)
 W ?13,"Recv A&A?:",?26,$S(RCVAA="0":"NO",RCVAA="1":"YES",1:"Not specified"),!
"RTN","DVBAB9",26,0)
 W ?14,"Pension?:",?26,$S(RCVPEN="0":"NO",RCVPEN="1":"YES",1:"Not specified"),! D ELIG^DVBAVDPT
"RTN","DVBAB9",27,0)
 I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) QUIT=1 I ANS=U S DVBAQUIT=1
"RTN","DVBAB9",28,0)
 S DVBAON2=""
"RTN","DVBAB9",29,0)
 Q
"RTN","DVBAB9",30,0)
 ;
"RTN","DVBAB9",31,0)
PRINT U IO S QUIT=""
"RTN","DVBAB9",32,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBAB9",33,0)
 Q
"RTN","DVBAB9",34,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DATA=^(DA) D PRINTB
"RTN","DVBAB9",35,0)
 Q
"RTN","DVBAB9",36,0)
 ;
"RTN","DVBAB9",37,0)
TERM D HOME^%ZIS K NOASK
"RTN","DVBAB9",38,0)
 ;
"RTN","DVBAB9",39,0)
SETUP W @IOF,!,"VARO DISCHARGE REPORT" D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB9",40,0)
 S DSRP=1,HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0) W !,HEAD1
"RTN","DVBAB9",41,0)
 ;
"RTN","DVBAB9",42,0)
EN1 ;W !!,"Please enter dates for search, oldest date first, most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,4) X ^DD("DD") W Y,!!
"RTN","DVBAB9",43,0)
 ;D DATE^DVBAUTIL
"RTN","DVBAB9",44,0)
 ;G:X=""!(Y<0) KILL
"RTN","DVBAB9",45,0)
 ;
"RTN","DVBAB9",46,0)
ADTYPE ;D ADTYPE^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBAB9",47,0)
 W @IOF
"RTN","DVBAB9",48,0)
 ;K DVBACEPT
"RTN","DVBAB9",49,0)
 ;D EN^VALM("DVBA DISCHARGE TYPES")
"RTN","DVBAB9",50,0)
 I '$D(DVBACEPT) D KILL^DVBAUTIL Q
"RTN","DVBAB9",51,0)
 I '$O(^TMP("DVBA",$J,"DUP",0)) D KILL^DVBAUTIL Q
"RTN","DVBAB9",52,0)
 ;
"RTN","DVBAB9",53,0)
 W !!! S %ZIS="Q" D ^%ZIS K %ZIS G:POP KILL^DVBAUTIL
"RTN","DVBAB9",54,0)
 ;
"RTN","DVBAB9",55,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBADSRT",ZTIO=ION,NOASK=1,ZTDESC="AMIE DISCHARGE REPORT" F I="^TMP(""DVBA"",$J,""DUP""","ADTYPE","DVBATYPS","BDATE","BDATE1","EDATE","FDT(0)","HEAD","HEAD1","HD","RO","RONUM","NOASK" S ZTSAVE(I)=""
"RTN","DVBAB9",56,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",! G KILL
"RTN","DVBAB9",57,0)
 ;
"RTN","DVBAB9",58,0)
GO S MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV3",MA)) Q:MA>EDATE!(MA="")  W:'$D(NOASK) "." F DA=0:0 S DA=$O(^DGPM("AMV3",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV3",MA,DA,MB)) Q:MB=""  D SET
"RTN","DVBAB9",59,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found for parameters entered.",!! H 2 G KILL
"RTN","DVBAB9",60,0)
 D PRINT I $D(DVBAQUIT) K DVBAON2 G KILL^DVBAUTIL
"RTN","DVBAB9",61,0)
 ;
"RTN","DVBAB9",62,0)
KILL D ^%ZISC D:$D(ZTQUEUED) KILL^%ZTLOAD S X=4 K DVBAON2 G FINAL^DVBAUTIL
"RTN","DVBAB9",63,0)
 ;
"RTN","DVBAB9",64,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBAB96")
0^22^B27336892
"RTN","DVBAB96",1,0)
DVBAB96 ;ALB/SPH - CAPRI CONVERSION OF DVBCUTL2 FOR SUPPORT ;09/11/00
"RTN","DVBAB96",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB96",3,0)
 ;
"RTN","DVBAB96",4,0)
KILL K %ZIS,BY,COLUMN,DVBCDT(0),EXAM,EXAMNM,HIST,FF,LABEL,LEVEL,LOC,MA,MB,NFINAL,NODE,OLDEXAM,OUT,PDATE,PDTA,PIECE,REAS,STAT1,TYPE,X1,X2,XDR,XST,JIJ,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK,ZW,JJY,VX,ADIV,ADIVNUM,DVBCDD,EDAYS,HEAD,HEAD2,ULINE,IO("Q")
"RTN","DVBAB96",5,0)
 K EXHD,XMTEXT,ZTDTH,OUT,CANC,DOTS,L,MG,REASON,SEND,XEXAM,XMDUZ,XMSUB,XMY,%X,%Y,JFLD,JX,JDR,DTREL,DTREQ,DTRQCMP,DTSCHEDC,DTTRANS,EDATE,ER,EXDATE,EXSTAT,RQSTAT,SBULL,TOT,XDT,XMDISPI,XMKK,XMLOC,XMLOCK,XMQF,XMR,XMT,XMTYP,XMZ,%H,K,NODATA,PNAM
"RTN","DVBAB96",6,0)
 K ANS,BDATE,PROCDT,QQ,RDATE,REQSTR,SADIV,OLDY,RQDT,RQDT2,PGM,SDATE,SDATE1,SDATE2,EDATE,EDATE1,EDATE2,CMPDIV,BY1,DAYS,FAX,PRTDIV,XMMG,ADEQ,EXMNM,PRTDATE,RUNDATE,RPTSITE,FEXAM,XSTAT,JZ,ZPR,REQDA,DVBCDT,FDT,RN,XIX,DVBCZ,EXDT,AGE
"RTN","DVBAB96",7,0)
 K COMP,DTOUT,DTSCH,DTSCH2,LNE,PG,PHYS,EXDA,DVBCDIV,%W,PRTNM,DIVNM,AW,AX,AY,BDATE1,CANDT,COL,DVBCJ,DVBCSEQ,DVBCSITE,ELTYP,EXPTR,EXSTAT,HD3,HEAD3,JJZ,JK,LVL,LX,NAME,OLDDA1,ORVP,PG,PRBY,RELBY,SEQNUM,TOTAL,TXT,TYP,DVBCXJI,PNM,PREF,NARR
"RTN","DVBAB96",8,0)
 G KILL^DVBCUTL3
"RTN","DVBAB96",9,0)
 ;
"RTN","DVBAB96",10,0)
DDIS1 ;display rated disabilities
"RTN","DVBAB96",11,0)
 S ZMSG(DVBABCNT)="  "_DX_"  "_$J(PCT,3,0)_" %"_"  "_$S(SC=1:"Yes",1:"No")_"  "_DXCOD,DVBABCNT=DVBABCNT+1
"RTN","DVBAB96",12,0)
 Q
"RTN","DVBAB96",13,0)
 ;
"RTN","DVBAB96",14,0)
DDIS I '$D(^DPT(DFN,.372)) S ZMSG(DVBABCNT)="No rated disabilities on file",DVBABCNT=DVBABCNT+1 Q
"RTN","DVBAB96",15,0)
 ;W ZMSG(DVBABCNT)="  Rated Disability"_"  "_"Percent"_,?50,"SC ?",?58,"Dx Code",! W ?2 F LINE=1:1:63 W "-"
"RTN","DVBAB96",16,0)
 W !! F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:I=""  S DXNUM=$P(^DPT(DFN,.372,I,0),U,1),PCT=$P(^(0),U,2),SC=$P(^(0),U,3),DX=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,1),1:"Unknown"),DXCOD=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,3),1:"Unknown") D DDIS1
"RTN","DVBAB96",17,0)
 W !! Q
"RTN","DVBAB96",18,0)
 ;
"RTN","DVBAB96",19,0)
HDR2 W @IOF,!,"C&P Final Report",?71,"Page: ",PG,!!,"Name: ",PNAM,?38,"SSN: ",SSN,?60,"C-number: ",CNUM,!,EXHD,!
"RTN","DVBAB96",20,0)
 F ZI=1:1:80 W "="
"RTN","DVBAB96",21,0)
 W !
"RTN","DVBAB96",22,0)
 Q
"RTN","DVBAB96",23,0)
 ;
"RTN","DVBAB96",24,0)
HDR3 W @IOF,!,"C&P Reprint of Final Report",?71,"Page: ",PG,!!,"Name: ",PNAM,?38,"SSN: ",SSN,?60,"C-number: ",CNUM,!,EXHD,!
"RTN","DVBAB96",25,0)
 F ZI=1:1:80 W "="
"RTN","DVBAB96",26,0)
 W !
"RTN","DVBAB96",27,0)
 Q
"RTN","DVBAB96",28,0)
 ;
"RTN","DVBAB96",29,0)
DUZ2 ;select station number
"RTN","DVBAB96",30,0)
 S DVBCD2=$S($D(^DIC(4,DUZ(2),99)):$P(^(99),U,1),1:0)
"RTN","DVBAB96",31,0)
 Q
"RTN","DVBAB96",32,0)
 ;
"RTN","DVBAB96",33,0)
TST F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  K PRINT S TSTAT=$P(^DVB(396.4,DA,0),U,4),TST=$P(^DVB(396.4,DA,0),U,3),PRTNM=$S($D(^DVB(396.6,TST,0)):$P(^(0),U,2),1:"") D TST1
"RTN","DVBAB96",34,0)
 Q
"RTN","DVBAB96",35,0)
TST1 S TSTA1=""
"RTN","DVBAB96",36,0)
 I $D(^DVB(396.4,DA,"CAN")) S TSTA1=$P(^DVB(396.4,DA,"CAN"),U,3)
"RTN","DVBAB96",37,0)
 I $D(^DVB(396.4,DA,"TRAN")) S X=$P(^DVB(396.4,DA,"TRAN"),U,3)
"RTN","DVBAB96",38,0)
 S:TSTA1]"" TSTA1=$P(^DVB(396.5,TSTA1,0),U,1) ;tsta1=cancellation reason
"RTN","DVBAB96",39,0)
 W:($L(PRTNM)+$L(TSTA1)+$X)>55 !?3 S ZMSG(DVBABCNT)=$S(PRTNM]"":PRTNM,1:"Missing exam name")_$S(TSTA1]"":" - cancelled ("_TSTA1_")",TSTAT="T":" - Transferred",TSTAT="":" (Unknown status)",1:""),DVBABCNT=DVBABCNT+1
"RTN","DVBAB96",40,0)
 I TSTAT="T" S X=$S($D(^DIC(4.2,+X,0)):$P(^(0),U,1),1:"unknown site") S ZMSG(DVBABCNT)=" to "_$P(X,".",1)_";",DVBABCNT=DVBABCNT+1
"RTN","DVBAB96",41,0)
 W "; "
"RTN","DVBAB96",42,0)
 Q
"RTN","DVBAB96",43,0)
 ;
"RTN","DVBAB96",44,0)
RQCODE ; ** Cancel an entire 2507 request after cancellation of last exam **
"RTN","DVBAB96",45,0)
 N LASTTME
"RTN","DVBAB96",46,0)
 S LASTTME=$O(^TMP("DVBA",$J,""))
"RTN","DVBAB96",47,0)
 S CCODE=^TMP("DVBA",$J,LASTTME)
"RTN","DVBAB96",48,0)
 D BULL^DVBCCNC1
"RTN","DVBAB96",49,0)
 Q
"RTN","DVBAB96",50,0)
 ;
"RTN","DVBAB96",51,0)
PROCDAY(REQDA) ; ** Calculate processing time for REQDA (v2.7 - Enhc 13)
"RTN","DVBAB96",52,0)
 ;** NOTICE: This tag is part of an implementation of a Nationally
"RTN","DVBAB96",53,0)
 ;**         Controlled Procedure.  Local modifications to this routine
"RTN","DVBAB96",54,0)
 ;**         are prohibited per VHA Directive 10-93-142
"RTN","DVBAB96",55,0)
 ;
"RTN","DVBAB96",56,0)
 ;**  PROCDAY receives the variable REQDA as the IEN of the 2507
"RTN","DVBAB96",57,0)
 ;**   request to calculate the processing time for
"RTN","DVBAB96",58,0)
 ;**  Processing time returned to calling routine via PROCTME
"RTN","DVBAB96",59,0)
 ;
"RTN","DVBAB96",60,0)
 N STOPDT,STARTDT,LSORVTRS,PRESTRT,DAY30CUT,PROCTME,ADJTME
"RTN","DVBAB96",61,0)
 N LPDT,LPDA,FSDTVTRS,LINKNODE
"RTN","DVBAB96",62,0)
 S (STOPDT,STARTDT,LSORVTRS,PRESTRT,FSDTVTRS)=0
"RTN","DVBAB96",63,0)
 ;
"RTN","DVBAB96",64,0)
 ;** FSDTVTRS is earliest date on 396.95 rec of
"RTN","DVBAB96",65,0)
 ;**  Current and Vet Resch dates
"RTN","DVBAB96",66,0)
 ;** Find FSDTVTRS for each 396.95 rec, PRESTRT is latest FSDTVTRS of
"RTN","DVBAB96",67,0)
 ;**  all 396.95 recs for request
"RTN","DVBAB96",68,0)
 S LPDT=""
"RTN","DVBAB96",69,0)
 F  S LPDT=$O(^DVB(396.95,"ARO",REQDA,LPDT)) Q:LPDT=""  DO
"RTN","DVBAB96",70,0)
 .F LPDA=0:0 S LPDA=$O(^DVB(396.95,"ARO",REQDA,LPDT,LPDA)) Q:LPDA=""  DO
"RTN","DVBAB96",71,0)
 ..S STOPDT=LPDT ;**Find the last original appt date (equals Stop Date)
"RTN","DVBAB96",72,0)
 ..S LINKNODE=^DVB(396.95,LPDA,0)
"RTN","DVBAB96",73,0)
 ..I +$P(LINKNODE,U,4)=1 DO  ;**FSDTVTRS=earliest of fields .03 and .05
"RTN","DVBAB96",74,0)
 ...S LSORVTRS=$P(LINKNODE,U,2) ;**'ARO' - Original; Vet rsch date latest
"RTN","DVBAB96",75,0)
 ...I $P(LINKNODE,U,3)<$P(LINKNODE,U,5) S FSDTVTRS=$P(LINKNODE,U,3)
"RTN","DVBAB96",76,0)
 ...I $P(LINKNODE,U,3)'<$P(LINKNODE,U,5) S FSDTVTRS=$P(LINKNODE,U,5)
"RTN","DVBAB96",77,0)
 ...S:FSDTVTRS>PRESTRT PRESTRT=FSDTVTRS ;**PRESTRT=latest FSDTVTRS
"RTN","DVBAB96",78,0)
 ;
"RTN","DVBAB96",79,0)
 ;** Calculate the Start Date
"RTN","DVBAB96",80,0)
 S PRESTRT=PRESTRT\1
"RTN","DVBAB96",81,0)
 S LSORVTRS=LSORVTRS\1
"RTN","DVBAB96",82,0)
 S STOPDT=STOPDT\1
"RTN","DVBAB96",83,0)
 S X1=LSORVTRS S X2=30 D C^%DTC S DAY30CUT=X K X,X1,X2 ;**30 day cut off
"RTN","DVBAB96",84,0)
 ;
"RTN","DVBAB96",85,0)
 ;** Find clock start date
"RTN","DVBAB96",86,0)
 ;** (Start can't be >30 days from latest original date on an
"RTN","DVBAB96",87,0)
 ;     appt reschd by vet)
"RTN","DVBAB96",88,0)
 S:DAY30CUT<PRESTRT STARTDT=DAY30CUT
"RTN","DVBAB96",89,0)
 S:DAY30CUT'<PRESTRT STARTDT=PRESTRT
"RTN","DVBAB96",90,0)
 S:STARTDT>$P(^DVB(396.3,REQDA,0),U,14)\1 STARTDT=$P(^DVB(396.3,REQDA,0),U,14)\1
"RTN","DVBAB96",91,0)
 S X1=STARTDT,X2=STOPDT D ^%DTC S ADJTME=X K X,X1,X2 ;**Days to subtract
"RTN","DVBAB96",92,0)
 S X2=($P(^DVB(396.3,REQDA,0),U,5)\1)
"RTN","DVBAB96",93,0)
 S X1=($P(^DVB(396.3,REQDA,0),U,14)\1)
"RTN","DVBAB96",94,0)
 D ^%DTC S PROCTME=X S:+ADJTME>0 PROCTME=PROCTME-ADJTME
"RTN","DVBAB96",95,0)
 K X,X1,X2
"RTN","DVBAB96",96,0)
 Q PROCTME
"RTN","DVBAB97")
0^19^B6819780
"RTN","DVBAB97",1,0)
DVBAB97 ;ALB/SPH - CAPRI CONVERSION OF DVBCENQ2 FOR SUPPORT ;09/11/00
"RTN","DVBAB97",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB97",3,0)
 ;
"RTN","DVBAB97",4,0)
 S ZMSG(DVBABCNT)=" >>> Future C&P Appointments <<<",DVBABCNT=DVBABCNT+1
"RTN","DVBAB97",5,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB97",6,0)
 ;
"RTN","DVBAB97",7,0)
FA S CT=0 W ! I $O(^DPT(DFN,"S",DT-.1))="" S ZMSG(DVBABCNT)="No future C & P appointments found.",DVBABCNT=DVBABCNT+1 G EXIT
"RTN","DVBAB97",8,0)
 K PRT F FA=DT-.1:0 S FA=$O(^DPT(DFN,"S",FA)) Q:FA=""  S L=^(FA,0),C=+L S YY=$P(L,U,2) I YY'="N"&(YY'="C")&(YY'="NA")&(YY'="CA")&(YY'="PC")&(YY'="PCA") D FA1
"RTN","DVBAB97",9,0)
 ;S ZMSG(DVBABCNT)="No future C&P appointments found.",DVBABCNT=DVBABCNT+1 G EXIT
"RTN","DVBAB97",10,0)
 G EXIT
"RTN","DVBAB97",11,0)
 ;
"RTN","DVBAB97",12,0)
FA1 S DVBCX=$P(^DPT(DFN,"S",FA,0),U,16) I $D(^SD(409.1,+DVBCX,0)) Q:$P(^(0),U,1)'["COMPENSATION"  ;compensation and pension exams only
"RTN","DVBAB97",13,0)
 S ZMSG(DVBABCNT)=$$FMTE^XLFDT(FA,"5DZ")_"  "_$J(+$E(FA_"00",9,10)_":"_$E(FA_"0000",11,12),6)_"  "_$E($P($S($D(^SC(C,0)):^(0),1:""),"^"),1,21)_"  ",DVBABCNT=DVBABCNT+1 D CAL S PRT=1
"RTN","DVBAB97",14,0)
 Q
"RTN","DVBAB97",15,0)
 ;
"RTN","DVBAB97",16,0)
EXIT S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB97",17,0)
 K YY,CT,FA,L,C,DVBCX,DATE,DVBCLNE W !!! Q
"RTN","DVBAB97",18,0)
 ;
"RTN","DVBAB97",19,0)
CONT ;I IOST?1"C-".E W !!,"Press [RETURN] to continue  " R ANS:DTIME
"RTN","DVBAB97",20,0)
 Q
"RTN","DVBAB97",21,0)
 ;
"RTN","DVBAB97",22,0)
HDR ;W ?(80-$L(DVBCLNE)\2),DVBCLNE,!!?0,"Date",?12,"Time",?18,"Clinic",?43,"  Lab",?56,"  X-Ray",?69,"  EKG",!?0 F I=0:1:79 W "-"
"RTN","DVBAB97",23,0)
 Q
"RTN","DVBAB97",24,0)
 ;
"RTN","DVBAB97",25,0)
CAL F J=3:1:5 I $P(L,U,J)]"" S DATE(J)=$E($P(L,U,J),4,7),DATE(J)=$E(DATE(J),1,2)_"/"_$E(DATE(J),3,4)_" ",TIME(J)=$P($P(L,U,J),".",2) D CAL1
"RTN","DVBAB97",26,0)
 Q
"RTN","DVBAB97",27,0)
 ;
"RTN","DVBAB97",28,0)
CAL1 S:TIME(J)=1 TIME(J)=10 S TIME(J)=$S($L(TIME(J))=2:TIME(J)_"00",$L(TIME(J))=3:TIME(J)_"0",1:TIME(J)),DATE(J)=DATE(J)_TIME(J)
"RTN","DVBAB97",29,0)
 I $D(DATE(3)) S DATE(3)=$E(DATE(3),1,6)_$E(DATE(3),7,8)_":"_$E(DATE(3),9,10) W:$D(DATE(3)) ?42,DATE(3)
"RTN","DVBAB97",30,0)
 I $D(DATE(4)) S DATE(4)=$E(DATE(4),1,6)_$E(DATE(4),7,8)_":"_$E(DATE(4),9,10) W:$D(DATE(4)) ?55,DATE(4)
"RTN","DVBAB97",31,0)
 I $D(DATE(5)) S DATE(5)=$E(DATE(5),1,6)_$E(DATE(5),7,8)_":"_$E(DATE(5),9,10) W:$D(DATE(5)) ?68,DATE(5)
"RTN","DVBAB97",32,0)
 I IOST?1"C-".E,$Y>18 D CONT,HDR
"RTN","DVBAB97",33,0)
 I IOST?1"P-".E,$Y>45 D HDR
"RTN","DVBAB97",34,0)
 K DATE,CONT
"RTN","DVBAB97",35,0)
 Q
"RTN","DVBAB98")
0^20^B16060500
"RTN","DVBAB98",1,0)
DVBAB98 ;ALB/SPH - CAPRI CONVERSION OF DVBARAD1 FOR SUPPORT ;09/06/00
"RTN","DVBAB98",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB98",3,0)
 ;
"RTN","DVBAB98",4,0)
 S ZX="PENSION   ",ZY="A & A     "
"RTN","DVBAB98",5,0)
 S MSG="" F ZZ=1:1:7 S MSG=MSG_ZX
"RTN","DVBAB98",6,0)
 S MSG1="" F ZZ=1:1:7 S MSG1=MSG1_ZY
"RTN","DVBAB98",7,0)
 U IO K DVBAQUIT
"RTN","DVBAB98",8,0)
 F DVBAT="PEN","A&A" W:((IOST?1"C-".E)!(IOST'?1"P-OTHER".E)) @IOF W !!!!!!!!!! D PRINT Q:$D(DVBAQUIT)
"RTN","DVBAB98",9,0)
 G KILL
"RTN","DVBAB98",10,0)
 ;
"RTN","DVBAB98",11,0)
PRINTB S DATA1=$S($D(^TMP("DVBA",DVBAT,$J,XCN,XCFLOC,K,DA,"LADM")):^("LADM"),1:"") S (LADMDT,ADMDT)=$P(DATA1,U),LTDIS=$P(DATA1,U,2),DFN=DA,QUIT1=1 K DATA1 D ADM^DVBAVDPT K QUIT1,DVBAQ
"RTN","DVBAB98",12,0)
 S LBEDSEC=BEDSEC,LDIAG=DIAG,LDCHGDT=DCHGDT,ADMDT=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),TDIS=$P(DATA,U,5) D ADM^DVBAVDPT
"RTN","DVBAB98",13,0)
 S RCVPEN=$S(RCVPEN=0:"NO",RCVPEN=1:"YES",1:"Not specified"),RCVAA=$S(RCVAA=0:"NO",RCVAA=1:"YES",1:"Not specified")
"RTN","DVBAB98",14,0)
 W @IOF,!!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!,?(80-$L(HEADDT)\2),HEADDT,!!!
"RTN","DVBAB98",15,0)
 S:ADMDT]"" ADMDT=$$FMTE^XLFDT(ADMDT,"5DZ")
"RTN","DVBAB98",16,0)
 S:DCHGDT]"" DCHGDT=$$FMTE^XLFDT(DCHGDT,"5DZ")
"RTN","DVBAB98",17,0)
 S:LADMDT]"" LADMDT=$$FMTE^XLFDT(LADMDT,"5DZ")
"RTN","DVBAB98",18,0)
 S:LDCHGDT]"" LDCHGDT=$$FMTE^XLFDT(LDCHGDT,"5DZ")
"RTN","DVBAB98",19,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",20,0)
 S ZMSG(DVBABCNT)="Patient: "_PNAM_"  SSN: "_SSN_"  Claim Folder Loc: "_CFLOC,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",21,0)
 S ZMSG(DVBABCNT)="Claim #: "_CNUM_"  Pension: "_RCVPEN_"  A&A: "_RCVAA,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",22,0)
 S ZMSG(DVBABCNT)="================================================================================",DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",23,0)
 D ELIG
"RTN","DVBAB98",24,0)
 S ZMSG(DVBABCNT)="Current Admission Data:",DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",25,0)
 S ZMSG(DVBABCNT)="-----------------------",DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",26,0)
 S ZMSG(DVBABCNT)="Admission Date:      "_ADMDT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",27,0)
 S ZMSG(DVBABCNT)="Admitting Diagnosis: "_DIAG,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",28,0)
 S ZMSG(DVBABCNT)="Discharge Date:      "_DCHGDT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",29,0)
 S ZMSG(DVBABCNT)="Discharge Type:      "_TDIS,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",30,0)
 S ZMSG(DVBABCNT)="Bed Service:         "_BEDSEC,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",31,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",32,0)
 S ZMSG(DVBABCNT)="Prior Admission Data:",DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",33,0)
 S ZMSG(DVBABCNT)="---------------------",DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",34,0)
 S ZMSG(DVBABCNT)="Admission Date:      "_LADMDT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",35,0)
 S ZMSG(DVBABCNT)="Admitting Diagnosis: "_LDIAG,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",36,0)
 S ZMSG(DVBABCNT)="Discharge Date:      "_LDCHGDT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",37,0)
 S ZMSG(DVBABCNT)="Discharge Type:      "_LTDIS,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",38,0)
 S ZMSG(DVBABCNT)="Bed Service:         "_LBEDSEC,DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",39,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB98",40,0)
 ;I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) XCN="ZZZZ" I '$T S DVBAQUIT=1
"RTN","DVBAB98",41,0)
 Q
"RTN","DVBAB98",42,0)
 ;
"RTN","DVBAB98",43,0)
PRINT S NODTA=1 S (XCN,XCFLOC,ANS)=""
"RTN","DVBAB98",44,0)
 I $D(^TMP("DVBA",DVBAT,$J)) F XLINE=1:1:5 W ?5,$S(DVBAT="PEN":MSG,DVBAT="A&A":MSG1,1:""),!!
"RTN","DVBAB98",45,0)
 F DVBAM=0:0 S XCN=$O(^TMP("DVBA",DVBAT,$J,XCN)) Q:XCN=""  F J=0:0 S XCFLOC=$O(^TMP("DVBA",DVBAT,$J,XCN,XCFLOC)) Q:XCFLOC=""  F K=0:0 S K=$O(^TMP("DVBA",DVBAT,$J,XCN,XCFLOC,K)) Q:K=""  D PRINTC
"RTN","DVBAB98",46,0)
 Q
"RTN","DVBAB98",47,0)
 ;
"RTN","DVBAB98",48,0)
PRINTC F DA=0:0 S DA=$O(^TMP("DVBA",DVBAT,$J,XCN,XCFLOC,K,DA)) Q:DA=""  S DATA=^(DA) D PRINTB
"RTN","DVBAB98",49,0)
 Q
"RTN","DVBAB98",50,0)
 ;
"RTN","DVBAB98",51,0)
KILL K ^TMP("DVBA","A&A",$J),^TMP("DVBA","PEN",$J)
"RTN","DVBAB98",52,0)
 D ^%ZISC S X=7 D:$D(ZTQUEUED) KILL^%ZTLOAD G FINAL^DVBAUTIL
"RTN","DVBAB98",53,0)
 ;
"RTN","DVBAB98",54,0)
ELIG S ELIG=DVBAELIG,INCMP=0
"RTN","DVBAB98",55,0)
 W "Eligibility: "
"RTN","DVBAB98",56,0)
 I ELIG]"" S ELIG=ELIG_" ("_$S(DVBAELST="P":"Pend Ver",DVBAELST="R":"Pend Re-verif",DVBAELST="V":"Verified",1:"Not Verified")_")"
"RTN","DVBAB98",57,0)
 I $D(^DPT(DA,.29)),$P(^(.29),U,1)]"" S INCMP=1 ;date ruled incomp, VA
"RTN","DVBAB98",58,0)
 I $D(^DPT(DA,.29)),$P(^(.29),U,12)=1 S INCMP=1 ;ruled incomp field
"RTN","DVBAB98",59,0)
 W ELIG_$S(ELIG]"":", ",1:"") W:$X>60 !?14 W $S(INCMP=1:"Incompetent",1:""),!
"RTN","DVBAB99")
0^21^B26361329
"RTN","DVBAB99",1,0)
DVBAB99 ;ALB/SPH - CAPRI CONVERSION OF VALM FOR SUPPORT GUI CALLS ;09/06/000
"RTN","DVBAB99",2,0)
 ;;2.7;AMIE;**35**;Apr 10, 1995
"RTN","DVBAB99",3,0)
 ;
"RTN","DVBAB99",4,0)
EN(NAME,PARMS) ; -- main entry point
"RTN","DVBAB99",5,0)
 ;  input:   NAME := free text name of list template or routine call
"RTN","DVBAB99",6,0)
 ;          PARMS := parameter list
"RTN","DVBAB99",7,0)
 ;
"RTN","DVBAB99",8,0)
 I $G(PARMS)["T" K VALMEVL ; kill if 'T'op level
"RTN","DVBAB99",9,0)
 D INIT^VALM0(.NAME,$G(PARMS)) G ENQ:$D(VALMQUIT)
"RTN","DVBAB99",10,0)
 ; -- build list of items
"RTN","DVBAB99",11,0)
 I $G(^TMP("VALM DATA",$J,VALMEVL,"INIT"))]"" X ^("INIT") G ENQ:$D(VALMQUIT)
"RTN","DVBAB99",12,0)
 ; -- start event loop
"RTN","DVBAB99",13,0)
 S VALMBCK="R" D ASK
"RTN","DVBAB99",14,0)
 X:$G(^TMP("VALM DATA",$J,VALMEVL,"FNL"))]"" ^("FNL")
"RTN","DVBAB99",15,0)
ENQ D POP^VALM0
"RTN","DVBAB99",16,0)
 Q
"RTN","DVBAB99",17,0)
 ;
"RTN","DVBAB99",18,0)
ASK ; -- event loop
"RTN","DVBAB99",19,0)
 S X=VALM("PROTOCOL") D XQORM
"RTN","DVBAB99",20,0)
 ;,EN^XQOR
"RTN","DVBAB99",21,0)
 ;I $D(VALMBCK),VALMBCK'="Q" G ASK
"RTN","DVBAB99",22,0)
ASKQ K XQORM,DTOUT,DIROUT,DUOUT Q
"RTN","DVBAB99",23,0)
 ;
"RTN","DVBAB99",24,0)
COL ; -- set up column dd array
"RTN","DVBAB99",25,0)
 K VALMDDF
"RTN","DVBAB99",26,0)
 S I=0 F  S I=$O(^SD(409.61,VALM("IFN"),"COL",I)) Q:'I  I $D(^(I,0)) S VALMDDF($P(^(0),U))=^(0)
"RTN","DVBAB99",27,0)
 Q
"RTN","DVBAB99",28,0)
 ;
"RTN","DVBAB99",29,0)
CAPTION() ; -- set up caption line of header
"RTN","DVBAB99",30,0)
 N X,COL,FLD
"RTN","DVBAB99",31,0)
 S $P(X,$S(VALMCC:" ",1:"-"),VALM("RM")+1)=""
"RTN","DVBAB99",32,0)
 S COL="" F  S COL=$O(VALMDDF(COL)) Q:COL=""  S FLD=VALMDDF(COL) D
"RTN","DVBAB99",33,0)
 .S X=$$SETSTR^VALM1($P(FLD,U,4),X,+$P(FLD,U,2),$S($L($P(FLD,U,4))<$P(FLD,U,3):$L($P(FLD,U,4)),1:+$P(FLD,U,3)))
"RTN","DVBAB99",34,0)
 Q X
"RTN","DVBAB99",35,0)
 ;
"RTN","DVBAB99",36,0)
CHGCAP(FLD,LABEL) ; -- change label on caption
"RTN","DVBAB99",37,0)
 ; input:  FLD := name of field
"RTN","DVBAB99",38,0)
 ;        LABEL := text for column header
"RTN","DVBAB99",39,0)
 S $P(VALMDDF(FLD),U,4)=LABEL,VALMCAP=$$CAPTION
"RTN","DVBAB99",40,0)
 Q
"RTN","DVBAB99",41,0)
 ;
"RTN","DVBAB99",42,0)
REFRESH ; -- refresh display
"RTN","DVBAB99",43,0)
 S VALMPGE=$$PAGE^VALM4(VALMBG,VALM("LINES"))
"RTN","DVBAB99",44,0)
 S X=0 X ^%ZOSF("RM")
"RTN","DVBAB99",45,0)
 D HDR:$G(VALMBCK)'["P",TBAR,LIST,LBAR
"RTN","DVBAB99",46,0)
 S VALMBCK=""
"RTN","DVBAB99",47,0)
 Q
"RTN","DVBAB99",48,0)
 ;
"RTN","DVBAB99",49,0)
HDR ; -- prt/display header
"RTN","DVBAB99",50,0)
 N X,I
"RTN","DVBAB99",51,0)
 I '$D(VALMHDR) X:$G(VALM("HDR"))]"" VALM("HDR")
"RTN","DVBAB99",52,0)
 ; -- prt hdr line
"RTN","DVBAB99",53,0)
 W:'$D(VALMPG1) @IOF K VALMPG1
"RTN","DVBAB99",54,0)
 W:VALMCC $C(13)_IOUON_$C(13)_IOINHI_$C(13)       ; -- turn on undln/hi
"RTN","DVBAB99",55,0)
 I $E(IOST,1,2)="C-" D IOXY^VALM4(0,0)            ; -- position cursor
"RTN","DVBAB99",56,0)
 W $E(VALM("TITLE"),1,30)                         ; -- prt title
"RTN","DVBAB99",57,0)
 W:VALMCC IOINORM,IOUON                           ; -- turn off hi
"RTN","DVBAB99",58,0)
 W $J("",30-$L(VALM("TITLE")))                    ; -- fill in w/blanks
"RTN","DVBAB99",59,0)
 I $E(IOST,1,2)="C-" W $C(13) D IOXY^VALM4(30,0)  ; -- position cursor
"RTN","DVBAB99",60,0)
 W $J("",((VALMWD-80)/2)),$$LOWER^VALM1($$NOW^VALM1),$J("",10+((VALMWD-80)/2)),"Page: ",$J(VALMPGE,4)," of ",$J($$PAGE^VALM4(VALMCNT,VALM("LINES")),4)_$S($D(VALMORE):"+",1:" ") ; -- prt rest of hdr
"RTN","DVBAB99",61,0)
 W:VALMCC IOUOFF I $E(IOST,1,2)="C-" D IOXY^VALM4(0,0) ; -- turn off undln
"RTN","DVBAB99",62,0)
 F I=1:1:VALM("TM")-3 W !,$S('$D(VALMHDR(I)):"",$L(VALMHDR(I))>(VALMWD-1):$$EXTRACT^VALM4($G(VALMHDR(I))),1:VALMHDR(I)) ; -- prt hdr
"RTN","DVBAB99",63,0)
 Q
"RTN","DVBAB99",64,0)
 ;
"RTN","DVBAB99",65,0)
TBAR ; -- print caption/top bar
"RTN","DVBAB99",66,0)
 N X
"RTN","DVBAB99",67,0)
 D CRT(0,VALM("TM")-3)
"RTN","DVBAB99",68,0)
 S VALMUP=(VALMBG>1),VALMCAP=$S(VALMUP:"+",VALMCC:" ",1:"-")_$E(VALMCAP,2,VALM("RM"))
"RTN","DVBAB99",69,0)
 S X=$E(VALMCAP,1,VALM("FIXED"))_$E(VALMCAP,VALMLFT,VALMLFT+VALMWD-1-VALM("FIXED"))
"RTN","DVBAB99",70,0)
 I VALM("TM")>2 D
"RTN","DVBAB99",71,0)
 .S:VALMCC X=IOUON_$C(13)_X_$C(13)_IOUOFF_$C(13)
"RTN","DVBAB99",72,0)
 .W !,X
"RTN","DVBAB99",73,0)
 Q
"RTN","DVBAB99",74,0)
 ;
"RTN","DVBAB99",75,0)
LIST ; -- list items
"RTN","DVBAB99",76,0)
 N I,LN,DY,DX
"RTN","DVBAB99",77,0)
 S DY=0
"RTN","DVBAB99",78,0)
 I $E(IOST,1,2)="C-" W ! S DX=0,DY=VALM("TM")-2 X IOXY
"RTN","DVBAB99",79,0)
 S I=VALMBG,VALMLST=I+VALM("LINES")-1 S:VALMLST>VALMCNT VALMLST=VALMCNT
"RTN","DVBAB99",80,0)
 F LN=1:1:VALM("LINES") D WRITE^VALM4(I,1,1,DY+LN) S I=I+1
"RTN","DVBAB99",81,0)
 Q
"RTN","DVBAB99",82,0)
 ;
"RTN","DVBAB99",83,0)
LBAR ; -- print low bar
"RTN","DVBAB99",84,0)
 N CHR,X
"RTN","DVBAB99",85,0)
 D CRT(0,VALM("BM")-1)
"RTN","DVBAB99",86,0)
 S CHR=$S(VALMCC:" ",1:"-")
"RTN","DVBAB99",87,0)
 K X S $P(X,CHR,VALMWD+1)=""
"RTN","DVBAB99",88,0)
 S X=$E(X,1,10)_$E($E($S($G(VALMSG)="":$$MSG(),1:VALMSG),1,50)_$E(X,11,75),1,65)_$E(X,76,VALMWD) K VALMSG
"RTN","DVBAB99",89,0)
 S VALMDN=(VALMLST<VALMCNT)
"RTN","DVBAB99",90,0)
 S X=$S(VALMDN:"+",1:CHR)_CHR_$S(VALMLFT>(VALM("FIXED")+1):"<<<",1:CHR_CHR_CHR)_$E(X,6,VALMWD-3)_$S((VALMLFT+(VALMWD-VALM("FIXED")))<VALM("RM"):">>>",1:CHR_CHR_CHR)
"RTN","DVBAB99",91,0)
 S:VALMCC X=$C(13)_IORVON_$C(13)_X_$C(13)_IORVOFF_$C(13)
"RTN","DVBAB99",92,0)
 W !,X
"RTN","DVBAB99",93,0)
 I $E(IOST,1,2)="C-" W !
"RTN","DVBAB99",94,0)
 Q
"RTN","DVBAB99",95,0)
 ;
"RTN","DVBAB99",96,0)
MSG() ;
"RTN","DVBAB99",97,0)
 Q "Enter ?? for more actions"
"RTN","DVBAB99",98,0)
 ;
"RTN","DVBAB99",99,0)
CRT(DX,DY) ;
"RTN","DVBAB99",100,0)
 I DX'<0,DY'<0,$E(IOST,1,2)="C-" W $C(13) D IOXY^VALM4(.DX,.DY)
"RTN","DVBAB99",101,0)
 Q
"RTN","DVBAB99",102,0)
 ;
"RTN","DVBAB99",103,0)
SHOW ; -- show items to user / main call back
"RTN","DVBAB99",104,0)
 W VALMCOFF
"RTN","DVBAB99",105,0)
 N DX,DY
"RTN","DVBAB99",106,0)
 S:'$D(VALMBG) VALMBG=1
"RTN","DVBAB99",107,0)
 S:'$D(VALMLFT) VALMLFT=VALM("FIXED")+1
"RTN","DVBAB99",108,0)
 S VALMPGE=$$PAGE^VALM4(VALMBG,VALM("LINES"))
"RTN","DVBAB99",109,0)
 I $G(VALMBCK)="R" D REFRESH
"RTN","DVBAB99",110,0)
 I $D(VALMSG) D MSG^VALM10(VALMSG) K VALMSG
"RTN","DVBAB99",111,0)
 I '$D(XQORM("B")),VALM("DEFS") S XQORM("B")=$S(VALMLST<VALMCNT:"Next Screen",1:"Quit")
"RTN","DVBAB99",112,0)
 I VALMCC D RESET^VALM4
"RTN","DVBAB99",113,0)
 S DX=0,DY=VALM("BM")-$S(VALM("TYPE")=2:0,1:VALMMENU) X IOXY
"RTN","DVBAB99",114,0)
 I VALMMENU D
"RTN","DVBAB99",115,0)
 .S X="?" D DISP^XQORM1
"RTN","DVBAB99",116,0)
 .W:VALMCC IOEDEOP
"RTN","DVBAB99",117,0)
 W VALMCON
"RTN","DVBAB99",118,0)
 D XQORM,KEYS K VALMBCK,VALMDY
"RTN","DVBAB99",119,0)
 Q
"RTN","DVBAB99",120,0)
 ;
"RTN","DVBAB99",121,0)
WP1(VALMREF) ; -- quick setup
"RTN","DVBAB99",122,0)
 S VALMCNT=+$P(@VALMREF@(0),U,4)
"RTN","DVBAB99",123,0)
 S VALM("ARRAY")=VALMREF
"RTN","DVBAB99",124,0)
 S:$D(VALMWPTL) VALM("TITLE")=VALMWPTL
"RTN","DVBAB99",125,0)
 Q
"RTN","DVBAB99",126,0)
 ;
"RTN","DVBAB99",127,0)
WP(VALMREF,VALMWPTL) ; -- quick entry to List Manager (c)
"RTN","DVBAB99",128,0)
 D EN("WP1^VALM(VALMREF)")
"RTN","DVBAB99",129,0)
 Q
"RTN","DVBAB99",130,0)
 ;
"RTN","DVBAB99",131,0)
XQORM ; -- set XQOR init vars
"RTN","DVBAB99",132,0)
 S XQORM(0)=VALM("MAX")_"AR\"
"RTN","DVBAB99",133,0)
 S XQORM("??")="D HELP^VALM2"
"RTN","DVBAB99",134,0)
 K DTOUT,DIROUT,DUOUT
"RTN","DVBAB99",135,0)
 Q
"RTN","DVBAB99",136,0)
 ;
"RTN","DVBAB99",137,0)
KEYS ; -- set XQOR auto-protocols
"RTN","DVBAB99",138,0)
 N I S I=0
"RTN","DVBAB99",139,0)
 F  S I=$O(VALMKEY(I)) Q:'I  S X=VALMKEY(I) S:$P(X,U,2)]"" XQORM("KEY",$P(X,U,2))=+X_"^1"
"RTN","DVBAB99",140,0)
 S XQORM("XLATE","LEFT")="<=1",XQORM("XLATE","RIGHT")=">=1"
"RTN","DVBAB99",141,0)
 S XQORM("XLATE","FIND")="SE",XQORM("XLATE","HELP")="??"
"RTN","DVBAB99",142,0)
 S XQORM("XLATE","DOWN")="DN",XQORM("XLATE","UP")="UP"
"RTN","DVBAB99",143,0)
 Q
"VER")
8.0^22.0
**END**
**END**
