Released GMTS*2.7*20 SEQ #23
Extracted from mail message
**KIDS**:GMTS*2.7*20^

**INSTALL NAME**
GMTS*2.7*20
"BLD",597,0)
GMTS*2.7*20^HEALTH SUMMARY^0^2980603^y
"BLD",597,1,0)
^^2^2^2980603^^
"BLD",597,1,1,0)
This is patch GMTS*2.7*20 for health summary.  Please see the 
"BLD",597,1,2,0)
National Patch Module for a complete description of this patch.
"BLD",597,4,0)
^9.64PA^^
"BLD",597,"ABPKG")
n
"BLD",597,"KRN",0)
^9.67PA^19^18
"BLD",597,"KRN",.4,0)
.4
"BLD",597,"KRN",.401,0)
.401
"BLD",597,"KRN",.402,0)
.402
"BLD",597,"KRN",.403,0)
.403
"BLD",597,"KRN",.5,0)
.5
"BLD",597,"KRN",.84,0)
.84
"BLD",597,"KRN",3.6,0)
3.6
"BLD",597,"KRN",3.8,0)
3.8
"BLD",597,"KRN",9.2,0)
9.2
"BLD",597,"KRN",9.8,0)
9.8
"BLD",597,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",597,"KRN",9.8,"NM",1,0)
GMTSVS^^0^B24025780
"BLD",597,"KRN",9.8,"NM",2,0)
GMTSVSS^^0^B40226956
"BLD",597,"KRN",9.8,"NM","B","GMTSVS",1)

"BLD",597,"KRN",9.8,"NM","B","GMTSVSS",2)

"BLD",597,"KRN",19,0)
19
"BLD",597,"KRN",19.1,0)
19.1
"BLD",597,"KRN",101,0)
101
"BLD",597,"KRN",409.61,0)
409.61
"BLD",597,"KRN",771,0)
771
"BLD",597,"KRN",869.2,0)
869.2
"BLD",597,"KRN",870,0)
870
"BLD",597,"KRN",8994,0)
8994
"BLD",597,"KRN","B",.4,.4)

"BLD",597,"KRN","B",.401,.401)

"BLD",597,"KRN","B",.402,.402)

"BLD",597,"KRN","B",.403,.403)

"BLD",597,"KRN","B",.5,.5)

"BLD",597,"KRN","B",.84,.84)

"BLD",597,"KRN","B",3.6,3.6)

"BLD",597,"KRN","B",3.8,3.8)

"BLD",597,"KRN","B",9.2,9.2)

"BLD",597,"KRN","B",9.8,9.8)

"BLD",597,"KRN","B",19,19)

"BLD",597,"KRN","B",19.1,19.1)

"BLD",597,"KRN","B",101,101)

"BLD",597,"KRN","B",409.61,409.61)

"BLD",597,"KRN","B",771,771)

"BLD",597,"KRN","B",869.2,869.2)

"BLD",597,"KRN","B",870,870)

"BLD",597,"KRN","B",8994,8994)

"BLD",597,"QUES",0)
^9.62^^
"BLD",597,"REQB",0)
^9.611^1^1
"BLD",597,"REQB",1,0)
GMTS*2.7*8^1
"BLD",597,"REQB","B","GMTS*2.7*8",1)

"OER",187,0)
187^GMTS^0^^
"OER",187,1,0)
^100.9951PA^1^1
"OER",187,1,1,0)
2025
"OER",187,1,1,1,0)
^100.99511PA^3^3
"OER",187,1,1,1,1,0)
231
"OER",187,1,1,1,2,0)
229
"OER",187,1,1,1,3,0)
230
"PKG",187,-1)
1^1
"PKG",187,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",187,20,0)
^9.402P^^
"PKG",187,22,0)
^9.49I^1^1
"PKG",187,22,1,0)
2.7^2951020^2960308
"PKG",187,22,1,"PAH",1,0)
20^2980603^125
"PKG",187,22,1,"PAH",1,1,0)
^^2^2^2980603
"PKG",187,22,1,"PAH",1,1,1,0)
This is patch GMTS*2.7*20 for health summary.  Please see the 
"PKG",187,22,1,"PAH",1,1,2,0)
National Patch Module for a complete description of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMTSVS")
0^1^B24025780
"RTN","GMTSVS",1,0)
GMTSVS ;SLC/TRS,SLC/AFE,HIRMFO/FT - Vital Signs Component ;4/10/97  13:52
"RTN","GMTSVS",2,0)
 ;;2.7;Health Summary;**8,20**;Oct 20, 1995
"RTN","GMTSVS",3,0)
 ;
"RTN","GMTSVS",4,0)
 ; This routine was modified by Frank Traxler@Hines CIOFO to print
"RTN","GMTSVS",5,0)
 ; new values, Body Mass Index (BMI) which will be computed, 
"RTN","GMTSVS",6,0)
 ; Central Venous Pressure (CVP), Circumference/Girth (CG) and
"RTN","GMTSVS",7,0)
 ; Pulse Oximetry (POx), if Vitals/Measurements v4.0 is installed.
"RTN","GMTSVS",8,0)
 ;
"RTN","GMTSVS",9,0)
OUTPAT ;Outpatient Vital Signs main control
"RTN","GMTSVS",10,0)
 N GMRVSTR
"RTN","GMTSVS",11,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSVS",12,0)
 E  S CNTR=100
"RTN","GMTSVS",13,0)
 K ^UTILITY($J,"GMRVD"),ARRAY
"RTN","GMTSVS",14,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0
"RTN","GMTSVS",15,0)
 S TN=0,LF=0,GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG",GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",16,0)
 S GMRVSTR("LT")="^C^" ;Set to only get Vital Sign for Clinics
"RTN","GMTSVS",17,0)
 D EN1^GMRVUT0
"RTN","GMTSVS",18,0)
 ;If no data, display message and get most recent inpatient measurements
"RTN","GMTSVS",19,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVS",20,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!
"RTN","GMTSVS",21,0)
 . S GMTSNDM=1
"RTN","GMTSVS",22,0)
 . D ENVS
"RTN","GMTSVS",23,0)
 D OUT,OUT5:GMTSVMVR>3,KILLVS Q
"RTN","GMTSVS",24,0)
ENVS ;SET UP FOR EXTRACTION ROUTINE
"RTN","GMTSVS",25,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSVS",26,0)
 E  S CNTR=100
"RTN","GMTSVS",27,0)
 K ^UTILITY($J,"GMRVD"),ARRAY
"RTN","GMTSVS",28,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0
"RTN","GMTSVS",29,0)
 S TN=0,LF=0,GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG",GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",30,0)
 D EN1^GMRVUT0
"RTN","GMTSVS",31,0)
 I '$D(^UTILITY($J,"GMRVD")) D KILLVS Q
"RTN","GMTSVS",32,0)
 D OUT,OUT5:GMTSVMVR>3,KILLVS Q
"RTN","GMTSVS",33,0)
OUT ;OUT-PUT
"RTN","GMTSVS",34,0)
 N GMW
"RTN","GMTSVS",35,0)
 S CNTR("HOLDER")=CNTR
"RTN","GMTSVS",36,0)
 S GMTSVMVR=$$VERSION^XPDUTL("GMRV") ;get vitals package version #
"RTN","GMTSVS",37,0)
 I GMTSVMVR'>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",38,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?20,"TEMP",?29,"PULSE",?36,"RESP",?45,"BP",?55,"HT",?68,"WT",!
"RTN","GMTSVS",39,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"F(C)",?55,"IN(CM)",?68,"LB(KG)",!
"RTN","GMTSVS",40,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"----",?29,"-----",?36,"----",?45,"--",?55,"------",?68,"------",!!
"RTN","GMTSVS",41,0)
 .Q
"RTN","GMTSVS",42,0)
 I GMTSVMVR>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",43,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?16,"TEMP",?28,"PULSE",?35,"RESP",?40,"BP",?51,"HT",?62,"WT",!
"RTN","GMTSVS",44,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?16,"F(C)",?51,"IN(CM)",?62,"LB(KG)[BMI]",!
"RTN","GMTSVS",45,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?16,"----",?28,"-----",?35,"----",?40,"--",?51,"------",?62,"-----------",!!
"RTN","GMTSVS",46,0)
 .Q
"RTN","GMTSVS",47,0)
 S GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D OUT1,OUT4
"RTN","GMTSVS",48,0)
 Q
"RTN","GMTSVS",49,0)
OUT1 S GMTSVT="" F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D OUT3
"RTN","GMTSVS",50,0)
 Q
"RTN","GMTSVS",51,0)
OUT3 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN)
"RTN","GMTSVS",52,0)
 S X=$P(GMTSVS,U,1) D REGDT^GMTSU S TDT=X
"RTN","GMTSVS",53,0)
 S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X
"RTN","GMTSVS",54,0)
 S TDT=TDT_" "_TI
"RTN","GMTSVS",55,0)
 S $P(ARRAY,U,1)=TDT
"RTN","GMTSVS",56,0)
 S GMTAB=$S(GMTSVT="T":2,GMTSVT="P":3,GMTSVT="R":4,GMTSVT="BP":5,GMTSVT="HT":6,GMTSVT="WT":7,1:0)
"RTN","GMTSVS",57,0)
 I GMTAB="2"!(GMTAB="6")!(GMTAB="7") S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)_"("_$P(GMTSVS,U,13)_")"
"RTN","GMTSVS",58,0)
 E  S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",59,0)
 I GMTAB=7,$P(GMTSVS,U,14)]"" S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"["_$P(GMTSVS,U,14)_"]"
"RTN","GMTSVS",60,0)
 Q
"RTN","GMTSVS",61,0)
OUT4 ;
"RTN","GMTSVS",62,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",63,0)
 I GMTSVMVR'>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?37,$P(ARRAY,U,4),?42,$P(ARRAY,U,5),?54,$P(ARRAY,U,6),?67,$P(ARRAY,U,7),!
"RTN","GMTSVS",64,0)
 I GMTSVMVR>3 W $P(ARRAY,U,1),?16,$P(ARRAY,U,2),?28,$P(ARRAY,U,3),?35,$P(ARRAY,U,4),?40,$P(ARRAY,U,5),?51,$P(ARRAY,U,6),?62,$P(ARRAY,U,7),!
"RTN","GMTSVS",65,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",66,0)
 K ARRAY
"RTN","GMTSVS",67,0)
 Q
"RTN","GMTSVS",68,0)
OUT5 ; display new v/m that came out with V/M v4.0
"RTN","GMTSVS",69,0)
 N GMW S END=0,CNTR=CNTR("HOLDER")
"RTN","GMTSVS",70,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",71,0)
 W !,"Measurement DT",?16,"CVP",?28,"PO2",?40,"CG"
"RTN","GMTSVS",72,0)
 W !,?16,"CMH20(MMHG)",?28,"(L/MIN)(%)",?40,"IN(CM)",!,?16,"-----------",?28,"----------",?40,"------",!!
"RTN","GMTSVS",73,0)
 S GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D OUT6,OUT8
"RTN","GMTSVS",74,0)
 Q
"RTN","GMTSVS",75,0)
OUT6 S GMTSVT="" F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D OUT7
"RTN","GMTSVS",76,0)
 Q
"RTN","GMTSVS",77,0)
OUT7 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN)
"RTN","GMTSVS",78,0)
 S X=$P(GMTSVS,U,1) D REGDT^GMTSU S TDT=X
"RTN","GMTSVS",79,0)
 S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X
"RTN","GMTSVS",80,0)
 S TDT=TDT_" "_TI
"RTN","GMTSVS",81,0)
 S $P(ARRAY,U,1)=TDT
"RTN","GMTSVS",82,0)
 S GMTAB=$S(GMTSVT="CVP":2,GMTSVT="PO2":3,GMTSVT="CG":4,1:0)
"RTN","GMTSVS",83,0)
 S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",84,0)
 I GMTAB=2 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$P(GMTSVS,U,13)_")"
"RTN","GMTSVS",85,0)
 I GMTAB=3 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$P(GMTSVS,U,15)_")("_$P(GMTSVS,U,16)_")"
"RTN","GMTSVS",86,0)
 I GMTAB=4 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$P(GMTSVS,U,13)_")"_$S($P(GMTSVS,U,17)]"":"["_$P(GMTSVS,U,17)_"]",1:"")
"RTN","GMTSVS",87,0)
 Q
"RTN","GMTSVS",88,0)
OUT8 ;
"RTN","GMTSVS",89,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",90,0)
 I GMTSNPG=1 D
"RTN","GMTSVS",91,0)
 .W !,"Measurement DT",?16,"CVP",?28,"PO2",?40,"CG"
"RTN","GMTSVS",92,0)
 .W !,?16,"CMH20(MMHG)",?28,"(L/MIN)(%)",?40,"IN(CM)",!,?16,"-----------",?28,"----------",?40,"------",!!
"RTN","GMTSVS",93,0)
 .Q
"RTN","GMTSVS",94,0)
 W $P(ARRAY,U,1),?16,$P(ARRAY,U,2),?28,$P(ARRAY,U,3),?40,$P(ARRAY,U,4),!
"RTN","GMTSVS",95,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",96,0)
 K ARRAY
"RTN","GMTSVS",97,0)
 Q
"RTN","GMTSVS",98,0)
KILLVS ;Kills variables
"RTN","GMTSVS",99,0)
 K CNTR,T1,T2,TDT,TI,END,TN,IEN,LF,GMTSVMVR,GMTSVS,GMTSVT,GMT,ARRAY,GMTAB,X
"RTN","GMTSVS",100,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVS",101,0)
 Q
"RTN","GMTSVSS")
0^2^B40226956
"RTN","GMTSVSS",1,0)
GMTSVSS ;SLC/TRS,SLC/AFE,HIRFO/FT - Selected Vital Signs Component ;3/12/98  16:53
"RTN","GMTSVSS",2,0)
 ;;2.7;Health Summary;**8,20**;Oct 20, 1995
"RTN","GMTSVSS",3,0)
 ; 
"RTN","GMTSVSS",4,0)
 ; This routine was modified by Frank Traxler@Hines CIOFO for changes
"RTN","GMTSVSS",5,0)
 ; made in V/M v4.0. The Health Summary will print Body Mass Index (BMI)
"RTN","GMTSVSS",6,0)
 ; which will be computed whenever WEIGHT is selected, Central Venous
"RTN","GMTSVSS",7,0)
 ; Pressure (CVP), Circumference/Girth (CG) and Pulse Oximetry (POx).
"RTN","GMTSVSS",8,0)
 ;
"RTN","GMTSVSS",9,0)
OUTPAT ; Outpatient Select Vitals Signs Main control
"RTN","GMTSVSS",10,0)
 N CNT,COL,COLL,HDR,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,GMRVSTR,LOOP,MAX,ROW,WIDTH
"RTN","GMTSVSS",11,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSS",12,0)
 I $D(GMTSNDM),GMTSNDM>0 S MAX=GMTSNDM
"RTN","GMTSVSS",13,0)
 E  S MAX=100
"RTN","GMTSVSS",14,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",15,0)
 I '$D(GMRVSTR) Q
"RTN","GMTSVSS",16,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",17,0)
 S GMRVSTR("LT")="^C^" ;Set to only get Vital Sign for Clinics
"RTN","GMTSVSS",18,0)
 D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",19,0)
 ; If no data, display message and get most recent inpatient measurements
"RTN","GMTSVSS",20,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVSS",21,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!
"RTN","GMTSVSS",22,0)
 .S GMTSNDM=1
"RTN","GMTSVSS",23,0)
 .D ENVS
"RTN","GMTSVSS",24,0)
 .Q
"RTN","GMTSVSS",25,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",26,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",27,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",28,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",29,0)
 .D NXTROW
"RTN","GMTSVSS",30,0)
 .W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",31,0)
 .S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",32,0)
 .Q
"RTN","GMTSVSS",33,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",34,0)
 Q
"RTN","GMTSVSS",35,0)
ENVS ; Set up for extraction routine
"RTN","GMTSVSS",36,0)
 N CNT,COL,COLL,HDR,HDR1,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,LOOP,MAX,ROW,WIDTH
"RTN","GMTSVSS",37,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSS",38,0)
 I $D(GMTSNDM),GMTSNDM>0 S MAX=GMTSNDM
"RTN","GMTSVSS",39,0)
 E  S MAX=100
"RTN","GMTSVSS",40,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",41,0)
 I '$D(GMRVSTR) Q
"RTN","GMTSVSS",42,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",43,0)
 D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",44,0)
 I '$D(^UTILITY($J,"GMRVD")) Q
"RTN","GMTSVSS",45,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",46,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",47,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",48,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",49,0)
 .D NXTROW
"RTN","GMTSVSS",50,0)
 .W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",51,0)
 .S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",52,0)
 .Q
"RTN","GMTSVSS",53,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",54,0)
 Q
"RTN","GMTSVSS",55,0)
BLDSTR ; Builds GMRVSTR string for extract call
"RTN","GMTSVSS",56,0)
 N DA,DIC,DIQ,DR,VIT
"RTN","GMTSVSS",57,0)
 S GMTSVMVR=+$$VERSION^XPDUTL("GMRV") ;get vitals package version #
"RTN","GMTSVSS",58,0)
 S DIQ="VIT(",DIQ(0)="E",DIC=120.51,DR="1",DA=GMTSDA
"RTN","GMTSVSS",59,0)
 D EN^DIQ1 S VIT=VIT(120.51,DA,1,"E")
"RTN","GMTSVSS",60,0)
 S GMRVSTR=$S($D(GMRVSTR):GMRVSTR_";"_VIT,1:VIT)
"RTN","GMTSVSS",61,0)
 Q
"RTN","GMTSVSS",62,0)
BLDHDR ; Builds the HDR array
"RTN","GMTSVSS",63,0)
 N ABB,GMTSI S COL=16
"RTN","GMTSVSS",64,0)
 F GMTSI=1:1:$L(GMRVSTR,";") D
"RTN","GMTSVSS",65,0)
 .S (HDR(GMTSI-1),ABB)=$P(GMRVSTR,";",GMTSI)
"RTN","GMTSVSS",66,0)
 .S HDR(GMTSI-1)=HDR(GMTSI-1)_U
"RTN","GMTSVSS",67,0)
 .S HDR(GMTSI-1)=HDR(GMTSI-1)_$S(ABB="BP":"BP",ABB="HT":"HEIGHT",ABB="WT":"WEIGHT",ABB="P":"PULSE",ABB="R":"RESP",ABB="T":"TEMP",1:ABB)
"RTN","GMTSVSS",68,0)
 .S WIDTH=$S($P(HDR(GMTSI-1),U)="T":13,$P(HDR(GMTSI-1),U)="P":7,$P(HDR(GMTSI-1),U)="R":6,$P(HDR(GMTSI-1),U)="WT":20,$P(HDR(GMTSI-1),U)="CG":20,1:12)
"RTN","GMTSVSS",69,0)
 .S COLL=$P(COL,U,GMTSI)+WIDTH
"RTN","GMTSVSS",70,0)
 .S COL=COL_U
"RTN","GMTSVSS",71,0)
 .S COL=COL_COLL
"RTN","GMTSVSS",72,0)
 .S HDR(GMTSI-1)=HDR(GMTSI-1)_U_COLL_U_WIDTH
"RTN","GMTSVSS",73,0)
 .Q
"RTN","GMTSVSS",74,0)
 S ROW=1,COL(ROW)=16,COLL=16,CNT=0
"RTN","GMTSVSS",75,0)
 F LOOP=0:1 Q:'$D(HDR(LOOP))  D
"RTN","GMTSVSS",76,0)
 .I $P(HDR(LOOP),U,4)+COLL'>80 D  Q
"RTN","GMTSVSS",77,0)
 ..S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",78,0)
 ..S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",79,0)
 ..S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",80,0)
 ..S CNT=CNT+1
"RTN","GMTSVSS",81,0)
 ..K HDR(LOOP)
"RTN","GMTSVSS",82,0)
 ..Q
"RTN","GMTSVSS",83,0)
 .S ROW=ROW+1,COL(ROW)=16,COLL=16,CNT=0
"RTN","GMTSVSS",84,0)
 .S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",85,0)
 .S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",86,0)
 .S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",87,0)
 .S CNT=CNT+1
"RTN","GMTSVSS",88,0)
 .K HDR(LOOP)
"RTN","GMTSVSS",89,0)
 .Q
"RTN","GMTSVSS",90,0)
 Q
"RTN","GMTSVSS",91,0)
WRTHDR ; Writes Header
"RTN","GMTSVSS",92,0)
 N GMI
"RTN","GMTSVSS",93,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT"
"RTN","GMTSVSS",94,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",95,0)
 .W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",96,0)
 .Q
"RTN","GMTSVSS",97,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",98,0)
 .W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",99,0)
 .Q
"RTN","GMTSVSS",100,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",101,0)
 Q
"RTN","GMTSVSS",102,0)
WRTHDR1 ;Writes 2nd line of header
"RTN","GMTSVSS",103,0)
 N GMI
"RTN","GMTSVSS",104,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",105,0)
 .I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",106,0)
 .I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)"
"RTN","GMTSVSS",107,0)
 .I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",108,0)
 .Q
"RTN","GMTSVSS",109,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",110,0)
 .I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",111,0)
 .I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)[BMI]"
"RTN","GMTSVSS",112,0)
 .I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",113,0)
 .I $P(HDR(GMI),U)="CVP" W ?$P(COL,U,GMI+1),"CMH20(MMHG)"
"RTN","GMTSVSS",114,0)
 .I $P(HDR(GMI),U)="PO2" W ?$P(COL,U,GMI+1),"(L/MIN)(%)"
"RTN","GMTSVSS",115,0)
 .I $P(HDR(GMI),U)="CG" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",116,0)
 .Q
"RTN","GMTSVSS",117,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSVSS",118,0)
 Q
"RTN","GMTSVSS",119,0)
WRT ; Writes vitals record for one observation time
"RTN","GMTSVSS",120,0)
 N GMLEN,GMTSBMI,GMTSI,GMTDT,GMTSVI,GMTSVT,GMTSMET,GMTSPERC,GMTSLMIN,IEN,X
"RTN","GMTSVSS",121,0)
 S GMTSVI="",X=9999999-GMTSDT D REGDTM^GMTSU S GMTDT=X
"RTN","GMTSVSS",122,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR,WRTHDR1 W GMTDT
"RTN","GMTSVSS",123,0)
 I GMTSVMVR'>3 F GMTSI=0:1:5 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",124,0)
 .S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",125,0)
 .I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",126,0)
 ..W ?$P(COL,U,GMTSI+1),$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",127,0)
 ..S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13) I GMTSMET'="" W "("_$P(^(+IEN),U,13)_")"
"RTN","GMTSVSS",128,0)
 ..Q
"RTN","GMTSVSS",129,0)
 .Q
"RTN","GMTSVSS",130,0)
 I GMTSVMVR>3 F GMTSI=0:1 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",131,0)
 .S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",132,0)
 .I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",133,0)
 ..W ?$P(COL,U,GMTSI+1),$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",134,0)
 ..S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13,17)
"RTN","GMTSVSS",135,0)
 ..S GMTSLMIN=$P(GMTSMET,U,3),GMTSPERC=$P(GMTSMET,U,4)
"RTN","GMTSVSS",136,0)
 ..S GMTSQUAL=$P(GMTSMET,U,5) S:GMTSQUAL]"" GMTSQUAL=$E(GMTSQUAL,1,5)
"RTN","GMTSVSS",137,0)
 ..S GMTSBMI=$P(GMTSMET,U,2),GMTSMET=$P(GMTSMET,U,1)
"RTN","GMTSVSS",138,0)
 ..I GMTSMET'="" W "("_GMTSMET_")" ;centigrade/kilos/centimeters
"RTN","GMTSVSS",139,0)
 ..I GMTSBMI'="" W "["_GMTSBMI_"]" ;body mass index
"RTN","GMTSVSS",140,0)
 ..I GMTSLMIN'="" W "["_GMTSLMIN_"]" ;liters/min supplemental O2
"RTN","GMTSVSS",141,0)
 ..I GMTSPERC'="" W "["_GMTSPERC_"]" ;% supplemental O2
"RTN","GMTSVSS",142,0)
 ..I GMTSVT="CG",GMTSQUAL]"" W "["_GMTSQUAL_"]" ;qualifiers
"RTN","GMTSVSS",143,0)
 ..Q
"RTN","GMTSVSS",144,0)
 .Q
"RTN","GMTSVSS",145,0)
 Q
"RTN","GMTSVSS",146,0)
NXTROW ; get the next row of vital signs
"RTN","GMTSVSS",147,0)
 Q:$G(ROW)'>0
"RTN","GMTSVSS",148,0)
 K HDR
"RTN","GMTSVSS",149,0)
 S %X="HDR1(ROW,",%Y="HDR(" D %XY^%RCR
"RTN","GMTSVSS",150,0)
 S COL=COL(ROW)
"RTN","GMTSVSS",151,0)
 K %X,%Y
"RTN","GMTSVSS",152,0)
 Q
"VER")
8.0^21.0
**END**
**END**
