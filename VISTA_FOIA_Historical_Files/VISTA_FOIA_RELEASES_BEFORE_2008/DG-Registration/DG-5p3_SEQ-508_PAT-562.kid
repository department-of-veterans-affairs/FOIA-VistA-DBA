Released DG*5.3*562 SEQ #508
Extracted from mail message
**KIDS**:DG*5.3*562^

**INSTALL NAME**
DG*5.3*562
"BLD",4834,0)
DG*5.3*562^REGISTRATION^0^3040330^y
"BLD",4834,4,0)
^9.64PA^^
"BLD",4834,"KRN",0)
^9.67PA^8989.52^19
"BLD",4834,"KRN",.4,0)
.4
"BLD",4834,"KRN",.401,0)
.401
"BLD",4834,"KRN",.402,0)
.402
"BLD",4834,"KRN",.403,0)
.403
"BLD",4834,"KRN",.5,0)
.5
"BLD",4834,"KRN",.84,0)
.84
"BLD",4834,"KRN",3.6,0)
3.6
"BLD",4834,"KRN",3.8,0)
3.8
"BLD",4834,"KRN",9.2,0)
9.2
"BLD",4834,"KRN",9.8,0)
9.8
"BLD",4834,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4834,"KRN",9.8,"NM",1,0)
DGMSRPT^^0^B60638218
"BLD",4834,"KRN",9.8,"NM",2,0)
DGMSRPT1^^0^B64963016
"BLD",4834,"KRN",9.8,"NM",3,0)
DGRPDT^^0^B60362179
"BLD",4834,"KRN",9.8,"NM",4,0)
DGMSRPT2^^0^B11081504
"BLD",4834,"KRN",9.8,"NM","B","DGMSRPT",1)

"BLD",4834,"KRN",9.8,"NM","B","DGMSRPT1",2)

"BLD",4834,"KRN",9.8,"NM","B","DGMSRPT2",4)

"BLD",4834,"KRN",9.8,"NM","B","DGRPDT",3)

"BLD",4834,"KRN",19,0)
19
"BLD",4834,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",4834,"KRN",19,"NM",1,0)
DG MS INCONSISTENCIES RPT^^0
"BLD",4834,"KRN",19,"NM",2,0)
DG SUPERVISOR MENU^^2
"BLD",4834,"KRN",19,"NM","B","DG MS INCONSISTENCIES RPT",1)

"BLD",4834,"KRN",19,"NM","B","DG SUPERVISOR MENU",2)

"BLD",4834,"KRN",19.1,0)
19.1
"BLD",4834,"KRN",101,0)
101
"BLD",4834,"KRN",409.61,0)
409.61
"BLD",4834,"KRN",771,0)
771
"BLD",4834,"KRN",870,0)
870
"BLD",4834,"KRN",8989.51,0)
8989.51
"BLD",4834,"KRN",8989.52,0)
8989.52
"BLD",4834,"KRN",8994,0)
8994
"BLD",4834,"KRN","B",.4,.4)

"BLD",4834,"KRN","B",.401,.401)

"BLD",4834,"KRN","B",.402,.402)

"BLD",4834,"KRN","B",.403,.403)

"BLD",4834,"KRN","B",.5,.5)

"BLD",4834,"KRN","B",.84,.84)

"BLD",4834,"KRN","B",3.6,3.6)

"BLD",4834,"KRN","B",3.8,3.8)

"BLD",4834,"KRN","B",9.2,9.2)

"BLD",4834,"KRN","B",9.8,9.8)

"BLD",4834,"KRN","B",19,19)

"BLD",4834,"KRN","B",19.1,19.1)

"BLD",4834,"KRN","B",101,101)

"BLD",4834,"KRN","B",409.61,409.61)

"BLD",4834,"KRN","B",771,771)

"BLD",4834,"KRN","B",870,870)

"BLD",4834,"KRN","B",8989.51,8989.51)

"BLD",4834,"KRN","B",8989.52,8989.52)

"BLD",4834,"KRN","B",8994,8994)

"BLD",4834,"QUES",0)
^9.62^^
"KRN",19,176,-1)
2^2
"KRN",19,176,0)
DG SUPERVISOR MENU^Supervisor ADT Menu^^M^.5^DG SUPERVISOR^^^^^^5
"KRN",19,176,10,0)
^19.01IP^31^16
"KRN",19,176,10,31,0)
11671
"KRN",19,176,10,31,"^")
DG MS INCONSISTENCIES RPT
"KRN",19,176,"U")
SUPERVISOR ADT MENU
"KRN",19,11671,-1)
0^1
"KRN",19,11671,0)
DG MS INCONSISTENCIES RPT^Military Service Data Inconsistencies Report^^R^^^^^^^^REGISTRATION
"KRN",19,11671,1,0)
^^13^13^3040210^
"KRN",19,11671,1,1,0)
This option will produce reports of inconsistencies found in veterans' 
"KRN",19,11671,1,2,0)
military service data.  There are two parts to this option:
"KRN",19,11671,1,3,0)
 
"KRN",19,11671,1,4,0)
Extract and Count Inconsistencies - this process will scan the veterans' 
"KRN",19,11671,1,5,0)
records in the Patient file and extract those that contain 
"KRN",19,11671,1,6,0)
inconsistencies.  At the completion of this process a mail message will 
"KRN",19,11671,1,7,0)
be sent with a summary report of the volume of inconsistencies found in
"KRN",19,11671,1,8,0)
various categories.  This process must be run before the detail report can
"KRN",19,11671,1,9,0)
be printed.
"KRN",19,11671,1,10,0)
 
"KRN",19,11671,1,11,0)
Print Inconsistencies Detail Report - this process will produce a detail
"KRN",19,11671,1,12,0)
report of inconsistencies found for individual veterans.  The report can
"KRN",19,11671,1,13,0)
be sorted by veteran name or SSN (terminal digits).
"KRN",19,11671,25)
EN^DGMSRPT
"KRN",19,11671,"U")
MILITARY SERVICE DATA INCONSIS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
562^3040330
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DGMSRPT")
0^1^B60638218
"RTN","DGMSRPT",1,0)
DGMSRPT ;ALB/LBD - Military Service Inconsistency Report; 01/05/04
"RTN","DGMSRPT",2,0)
 ;;5.3;Registration;**562**; Aug 13,1993
"RTN","DGMSRPT",3,0)
 ;
"RTN","DGMSRPT",4,0)
EN ; Called from DG MS INCONSISTENCIES RPT option
"RTN","DGMSRPT",5,0)
 ; Prompt user to select to run extract or print report
"RTN","DGMSRPT",6,0)
 N DGSEL
"RTN","DGMSRPT",7,0)
 S DGSEL=$$SEL Q:'DGSEL
"RTN","DGMSRPT",8,0)
 S DGSEL="SEL"_DGSEL
"RTN","DGMSRPT",9,0)
 G @DGSEL
"RTN","DGMSRPT",10,0)
 Q
"RTN","DGMSRPT",11,0)
 ;
"RTN","DGMSRPT",12,0)
SEL() ; Select action: Extract or Print
"RTN","DGMSRPT",13,0)
 ; INPUT: None
"RTN","DGMSRPT",14,0)
 ; OUTPUT: 1=Extract; 2=Print; 0=Quit
"RTN","DGMSRPT",15,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","DGMSRPT",16,0)
 W !!,"Military Service Data Inconsistencies Report"
"RTN","DGMSRPT",17,0)
 W !,"============================================"
"RTN","DGMSRPT",18,0)
 S DIR(0)="S^1:Extract and Count Inconsistencies;2:Print Inconsistencies Detail Report"
"RTN","DGMSRPT",19,0)
 S DIR("A")="Enter 1 or 2"
"RTN","DGMSRPT",20,0)
 S DIR("?",1)="(1) Extract and Count Inconsistences - selecting this option will queue a"
"RTN","DGMSRPT",21,0)
 S DIR("?",2)="    process to read through the Patient file and find records with"
"RTN","DGMSRPT",22,0)
 S DIR("?",3)="    inconsistent military service data.  The inconsistencies will be"
"RTN","DGMSRPT",23,0)
 S DIR("?",4)="    totaled by category in the Military Service Data Inconsistencies Volume"
"RTN","DGMSRPT",24,0)
 S DIR("?",5)="    Report that will be sent as a mail message to the DGEN ELIGIBILITY ALERT"
"RTN","DGMSRPT",25,0)
 S DIR("?",6)="    mail group.  This process must be run before the detail report can"
"RTN","DGMSRPT",26,0)
 S DIR("?",7)="    be printed, and can be rerun as necessary."
"RTN","DGMSRPT",27,0)
 S DIR("?",8)=""
"RTN","DGMSRPT",28,0)
 S DIR("?",9)="(2) Print Inconsistencies Detail Report - selecting this option will"
"RTN","DGMSRPT",29,0)
 S DIR("?",10)="    produce a detail report of the inconsistencies found for"
"RTN","DGMSRPT",30,0)
 S DIR("?",11)="    individual veterans.  The report can be sorted by veteran name"
"RTN","DGMSRPT",31,0)
 S DIR("?",12)="    or SSN (terminal digits)."
"RTN","DGMSRPT",32,0)
 S DIR("?")=" "
"RTN","DGMSRPT",33,0)
 D ^DIR I 'Y!($D(DTOUT))!($D(DUOUT)) Q 0
"RTN","DGMSRPT",34,0)
 Q Y
"RTN","DGMSRPT",35,0)
 ;
"RTN","DGMSRPT",36,0)
SEL1 ; Extract and count military service data inconsistencies from Patient
"RTN","DGMSRPT",37,0)
 ; file #2
"RTN","DGMSRPT",38,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","DGMSRPT",39,0)
 I '$$CHK W ! S DIR(0)="E" D ^DIR Q
"RTN","DGMSRPT",40,0)
 W !!
"RTN","DGMSRPT",41,0)
 S DIR(0)="Y",DIR("A")="Queue Extract",DIR("B")="NO"
"RTN","DGMSRPT",42,0)
 D ^DIR K DIR Q:'Y!($D(DTOUT))!($D(DUOUT))
"RTN","DGMSRPT",43,0)
 K ^XTMP("DGMSRPT")
"RTN","DGMSRPT",44,0)
 D EXTQUE
"RTN","DGMSRPT",45,0)
 W ! S DIR(0)="E" D ^DIR
"RTN","DGMSRPT",46,0)
 Q
"RTN","DGMSRPT",47,0)
SEL2 ; Print detail report of military service data inconsistencies
"RTN","DGMSRPT",48,0)
 ; extracted and stored in ^XTMP("DGMSRPT",
"RTN","DGMSRPT",49,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,DGTOT,DGBEG,DGEND,DGSRT
"RTN","DGMSRPT",50,0)
 I $P($G(^XTMP("DGMSRPT","DATE")),U,2)="" D  Q
"RTN","DGMSRPT",51,0)
 .W !!,*7,"*** The Extract of Military Service Data Inconsisistencies must be run"
"RTN","DGMSRPT",52,0)
 .W !,"    before the report can be printed."
"RTN","DGMSRPT",53,0)
 .W ! S DIR(0)="E" D ^DIR
"RTN","DGMSRPT",54,0)
 I '$$CHK W ! S DIR(0)="E" D ^DIR Q
"RTN","DGMSRPT",55,0)
 I +$G(^XTMP("DGMSRPT","MSINC","CNT","VET"))=0 W !!,*7,"There are no records to print.",! S DIR(0)="E" D ^DIR Q
"RTN","DGMSRPT",56,0)
 W !!
"RTN","DGMSRPT",57,0)
 S DIR(0)="Y",DIR("A")="Print Report",DIR("B")="YES"
"RTN","DGMSRPT",58,0)
 D ^DIR K DIR Q:'Y!($D(DTOUT))!($D(DUOUT))
"RTN","DGMSRPT",59,0)
 S DGTOT=+$G(^XTMP("DGMSRPT","MSINC","CNT","VET"))
"RTN","DGMSRPT",60,0)
 W !!,"Total veteran records to print: ",DGTOT
"RTN","DGMSRPT",61,0)
 S DGBEG=$$BEG(DGTOT) Q:'DGBEG
"RTN","DGMSRPT",62,0)
 S DGEND=$$END(DGBEG,DGTOT) Q:'DGEND
"RTN","DGMSRPT",63,0)
 S DGSRT=$$SRT Q:DGSRT=""
"RTN","DGMSRPT",64,0)
 D RPTQUE
"RTN","DGMSRPT",65,0)
 Q
"RTN","DGMSRPT",66,0)
CHK() ; Check if extract can be tasked to run
"RTN","DGMSRPT",67,0)
 ; INPUT: None
"RTN","DGMSRPT",68,0)
 ; OUTPUT: 1=Run Extract; 0=Don't run Extract
"RTN","DGMSRPT",69,0)
 N CHK S CHK=1
"RTN","DGMSRPT",70,0)
 I $G(^XTMP("DGMSRPT","RUNNING")) D  Q CHK
"RTN","DGMSRPT",71,0)
 .N ZTSK
"RTN","DGMSRPT",72,0)
 .S ZTSK=^XTMP("DGMSRPT","RUNNING") D STAT^%ZTLOAD
"RTN","DGMSRPT",73,0)
 .I ZTSK(1)=1!(ZTSK(1)=2) W !!,*7,"*** Extract is currently running or queued as task ",^XTMP("DGMSRPT","RUNNING") S CHK=0
"RTN","DGMSRPT",74,0)
 I $P($G(^XTMP("DGMSRPT","DATE")),U,2)'="" W !!,"Extract was last run ",$P(^XTMP("DGMSRPT","DATE"),U,2)
"RTN","DGMSRPT",75,0)
 Q CHK
"RTN","DGMSRPT",76,0)
 ;
"RTN","DGMSRPT",77,0)
BEG(TOT) ; Get starting record number to print
"RTN","DGMSRPT",78,0)
 ; INPUT: TOT - Total number of veteran records to print
"RTN","DGMSRPT",79,0)
 ; OUTPUT: Y - Starting record number
"RTN","DGMSRPT",80,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","DGMSRPT",81,0)
 I '$G(TOT) Q 0
"RTN","DGMSRPT",82,0)
 S DIR(0)="NA^1:"_TOT,DIR("A")="Print from record: ",DIR("B")=1
"RTN","DGMSRPT",83,0)
 D ^DIR I 'Y!($D(DTOUT))!($D(DUOUT)) Q 0
"RTN","DGMSRPT",84,0)
 Q Y
"RTN","DGMSRPT",85,0)
END(BEG,TOT) ; Get ending record number to print
"RTN","DGMSRPT",86,0)
 ; INPUT:  BEG - Starting record number to print
"RTN","DGMSRPT",87,0)
 ;         TOT - Total number of veteran records to print
"RTN","DGMSRPT",88,0)
 ; OUTPUT: Y - Ending record number
"RTN","DGMSRPT",89,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","DGMSRPT",90,0)
 I '$G(BEG),'$G(TOT) Q 0
"RTN","DGMSRPT",91,0)
 S DIR(0)="NA^"_BEG_":"_TOT,DIR("A")="      to record: ",DIR("B")=DGTOT
"RTN","DGMSRPT",92,0)
 D ^DIR I 'Y!($D(DTOUT))!($D(DUOUT)) Q 0
"RTN","DGMSRPT",93,0)
 Q Y
"RTN","DGMSRPT",94,0)
SRT() ; Get sort order
"RTN","DGMSRPT",95,0)
 ; OUPUT: Y - Sort (N=Name; S=SSN)
"RTN","DGMSRPT",96,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","DGMSRPT",97,0)
 S DIR(0)="SA^N:Name;S:SSN (Terminal digits)",DIR("A")="Sort report by Name or SSN (Terminal digits): ",DIR("B")="NAME"
"RTN","DGMSRPT",98,0)
 S DIR("?",1)="Indicate whether the report should be sorted by the"
"RTN","DGMSRPT",99,0)
 S DIR("?")="Veteran's Name or the terminal digits of the Veteran's SSN"
"RTN","DGMSRPT",100,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) Q ""
"RTN","DGMSRPT",101,0)
 Q Y
"RTN","DGMSRPT",102,0)
 ;
"RTN","DGMSRPT",103,0)
EXTQUE ; Queue extract task
"RTN","DGMSRPT",104,0)
 N ZTRTN,ZTDESC,ZTSK,ZTIO,ZTDTH,DIR
"RTN","DGMSRPT",105,0)
 S ZTRTN="EN^DGMSRPT1",ZTIO="",ZTDTH=""
"RTN","DGMSRPT",106,0)
 S ZTDESC="Extract Military Service Inconsistencies"
"RTN","DGMSRPT",107,0)
 D ^%ZTLOAD
"RTN","DGMSRPT",108,0)
 I $G(ZTSK) D  Q
"RTN","DGMSRPT",109,0)
 .S ^XTMP("DGMSRPT","RUNNING")=ZTSK
"RTN","DGMSRPT",110,0)
 .W !,"Extract queued as task ",ZTSK
"RTN","DGMSRPT",111,0)
 .W !!,"When the process is completed a message containing the Military Service Data"
"RTN","DGMSRPT",112,0)
 .W !,"Inconsistencies Volume Report will be sent to mail group DGEN ELIGIBILITY ALERT.",!
"RTN","DGMSRPT",113,0)
 W !,*7,"Extract could not be queued!"
"RTN","DGMSRPT",114,0)
 Q
"RTN","DGMSRPT",115,0)
 ;
"RTN","DGMSRPT",116,0)
RPTQUE ; Get report device. Queue report if requested.
"RTN","DGMSRPT",117,0)
 N POP,ZTRTN,ZTDESC,ZTSAVE,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","DGMSRPT",118,0)
 K IOP,%ZIS
"RTN","DGMSRPT",119,0)
 S %ZIS="MQ"
"RTN","DGMSRPT",120,0)
 W !
"RTN","DGMSRPT",121,0)
 D ^%ZIS I POP W !!,*7,"Report Cancelled!",! S DIR(0)="E" D ^DIR Q
"RTN","DGMSRPT",122,0)
 I $D(IO("Q")) D  Q
"RTN","DGMSRPT",123,0)
 .S ZTRTN="EN^DGMSRPT2(DGBEG,DGEND,DGSRT)"
"RTN","DGMSRPT",124,0)
 .S ZTDESC="Print Military Service Inconsistencies Report"
"RTN","DGMSRPT",125,0)
 .S (ZTSAVE("DGBEG"),ZTSAVE("DGEND"),ZTSAVE("DGSRT"))=""
"RTN","DGMSRPT",126,0)
 .D ^%ZTLOAD
"RTN","DGMSRPT",127,0)
 .W !!,"Report "_$S($D(ZTSK):"Queued!",1:"Cancelled!")
"RTN","DGMSRPT",128,0)
 .W ! S DIR(0)="E" D ^DIR
"RTN","DGMSRPT",129,0)
 .D HOME^%ZIS
"RTN","DGMSRPT",130,0)
 D EN^DGMSRPT2(DGBEG,DGEND,DGSRT)
"RTN","DGMSRPT",131,0)
 D ^%ZISC
"RTN","DGMSRPT",132,0)
 Q
"RTN","DGMSRPT",133,0)
 ;
"RTN","DGMSRPT",134,0)
MSG(DGXTMP) ; Send message with counts of inconsistencies when extract completes.
"RTN","DGMSRPT",135,0)
 ;INPUT:  DGXTMP - ^XTMP global reference
"RTN","DGMSRPT",136,0)
 N DGMSG,XMDUZ,XMSUB,XMTEXT,XMY,LN,SUB,SITE
"RTN","DGMSRPT",137,0)
 S:$G(DGXTMP)="" DGXTMP="^XTMP(""DGMSRPT"",""MSINC"")"
"RTN","DGMSRPT",138,0)
 S SITE=$P($$SITE^VASITE,U,3) S:SITE="" SITE="UNKNOWN"
"RTN","DGMSRPT",139,0)
 S XMDUZ="STATION #"_SITE
"RTN","DGMSRPT",140,0)
 I $$GET1^DIQ(869.3,"1,",.03,"I")'="P" S XMDUZ=XMDUZ_" [TEST]"
"RTN","DGMSRPT",141,0)
 S XMSUB="MILITARY SERVICE DATA INCONSISTENCIES VOLUME REPORT"
"RTN","DGMSRPT",142,0)
 S (XMY(DUZ),XMY("G.DGEN ELIGIBILITY ALERT"),XMY("HECDQSUPPORT@MED.VA.GOV"))="",XMTEXT="DGMSG("
"RTN","DGMSRPT",143,0)
 S DGMSG(1)="The extract of Military Service data inconsistencies has completed"
"RTN","DGMSRPT",144,0)
 S DGMSG(2)="successfully."
"RTN","DGMSRPT",145,0)
 S DGMSG(3)=""
"RTN","DGMSRPT",146,0)
 S DGMSG(4)="Extract process started: "_$P($G(^XTMP("DGMSRPT","DATE")),U,1)
"RTN","DGMSRPT",147,0)
 S DGMSG(5)="Extract process ended:   "_$P($G(^XTMP("DGMSRPT","DATE")),U,2)
"RTN","DGMSRPT",148,0)
 S DGMSG(6)=""
"RTN","DGMSRPT",149,0)
 S DGMSG(7)="Total Veterans with MS Data Inconsistencies: "_+@DGXTMP@("CNT","VET")
"RTN","DGMSRPT",150,0)
 S DGMSG(8)=""
"RTN","DGMSRPT",151,0)
 S DGMSG(9)=$$LJ^XLFSTR("    INCONSISTENCY CATEGORY",55)_$$RJ^XLFSTR("TOTAL",20)
"RTN","DGMSRPT",152,0)
 S DGMSG(10)=$$LJ^XLFSTR("",79,"=")
"RTN","DGMSRPT",153,0)
 S LN=10,SUB=""
"RTN","DGMSRPT",154,0)
 F  S SUB=$O(@DGXTMP@("CNT",SUB)) Q:'SUB  S LN=LN+1,DGMSG(LN)=$$LJ^XLFSTR($P(^(SUB),U,2),55)_$$RJ^XLFSTR($P(^(SUB),U,1),20)
"RTN","DGMSRPT",155,0)
 D ^XMD
"RTN","DGMSRPT",156,0)
 Q
"RTN","DGMSRPT",157,0)
 ;
"RTN","DGMSRPT",158,0)
INIT ; Set variables and initialize array for counts
"RTN","DGMSRPT",159,0)
 S DGXTMP="^XTMP(""DGMSRPT"",""MSINC"")"
"RTN","DGMSRPT",160,0)
 S @DGXTMP@("CNT",2)="0^Branch of Service=B.E.C."
"RTN","DGMSRPT",161,0)
 S @DGXTMP@("CNT",3)="0^Branch of Service=Merchant Seaman, No WWII Service"
"RTN","DGMSRPT",162,0)
 S @DGXTMP@("CNT",4)="0^Military Service Episode Data Missing"
"RTN","DGMSRPT",163,0)
 S @DGXTMP@("CNT",5)="0^Military Service Episode Date Imprecise"
"RTN","DGMSRPT",164,0)
 S @DGXTMP@("CNT",6)="0^Military Service Episode End Date Before Start Date"
"RTN","DGMSRPT",165,0)
 S @DGXTMP@("CNT",7)="0^Military Service Episodes Overlap"
"RTN","DGMSRPT",166,0)
 S @DGXTMP@("CNT",8)="0^Combat Data Missing"
"RTN","DGMSRPT",167,0)
 S @DGXTMP@("CNT",9)="0^Combat Date Imprecise"
"RTN","DGMSRPT",168,0)
 S @DGXTMP@("CNT",10)="0^Combat Date Not Valid for Location"
"RTN","DGMSRPT",169,0)
 S @DGXTMP@("CNT",11)="0^Combat Date Not Within MSE"
"RTN","DGMSRPT",170,0)
 S @DGXTMP@("CNT",12)="0^Conflict Data Missing"
"RTN","DGMSRPT",171,0)
 S @DGXTMP@("CNT",13)="0^Conflict Date Imprecise"
"RTN","DGMSRPT",172,0)
 S @DGXTMP@("CNT",14)="0^Conflict Date Not Valid for Location"
"RTN","DGMSRPT",173,0)
 S @DGXTMP@("CNT",15)="0^Conflict Date Not Within MSE"
"RTN","DGMSRPT",174,0)
 S @DGXTMP@("CNT",16)="0^Prisoner of War Data Missing"
"RTN","DGMSRPT",175,0)
 S @DGXTMP@("CNT",17)="0^Prisoner of War Date Imprecise"
"RTN","DGMSRPT",176,0)
 S @DGXTMP@("CNT",18)="0^Prisoner of War Date Not Valid for Location"
"RTN","DGMSRPT",177,0)
 S @DGXTMP@("CNT",19)="0^Prisoner of War Date Not Within MSE"
"RTN","DGMSRPT",178,0)
 S @DGXTMP@("CNT","VET")="0^Number of Veterans with Inconsistent MS Data"
"RTN","DGMSRPT",179,0)
 Q
"RTN","DGMSRPT1")
0^2^B64963016
"RTN","DGMSRPT1",1,0)
DGMSRPT1 ;ALB/LBD - Military Service Inconsistency Report; 01/05/04
"RTN","DGMSRPT1",2,0)
 ;;5.3;Registration;**562**; Aug 13,1993
"RTN","DGMSRPT1",3,0)
 ;
"RTN","DGMSRPT1",4,0)
 ; This routine scans the Patient file #2 and checks military service
"RTN","DGMSRPT1",5,0)
 ; data for inconsistencies.  The inconsistencies are stored in 
"RTN","DGMSRPT1",6,0)
 ; ^XTMP("DSMSRPT"). 
"RTN","DGMSRPT1",7,0)
 Q
"RTN","DGMSRPT1",8,0)
 ;
"RTN","DGMSRPT1",9,0)
EN ; Entry point called from ^DGMSRPT
"RTN","DGMSRPT1",10,0)
 ; Initialize ^XTMP global and set start date
"RTN","DGMSRPT1",11,0)
 S ^XTMP("DGMSRPT",0)=$$FMADD^XLFDT(DT,60)_U_DT_U_"DG MILITARY SERVICE INCONSISTENCY REPORT"
"RTN","DGMSRPT1",12,0)
 S $P(^XTMP("DGMSRPT","DATE"),U,1)=$$FMTE^XLFDT($$NOW^XLFDT(),"5P")
"RTN","DGMSRPT1",13,0)
 S:$G(ZTSK) ZTREQ="@"
"RTN","DGMSRPT1",14,0)
 D INIT^DGMSRPT
"RTN","DGMSRPT1",15,0)
 ; Loop through Patient file #2.  If patient meets report criteria, check
"RTN","DGMSRPT1",16,0)
 ; military service data for inconsistencies.
"RTN","DGMSRPT1",17,0)
 N DFN
"RTN","DGMSRPT1",18,0)
 S DFN=0 F  S DFN=$O(^DPT(DFN)) Q:'DFN  I $$CHK(DFN)  D MSINC(DFN)
"RTN","DGMSRPT1",19,0)
 ; Send message containing inconsistency counts, update stop date/time
"RTN","DGMSRPT1",20,0)
 S $P(^XTMP("DGMSRPT","DATE"),U,2)=$$FMTE^XLFDT($$NOW^XLFDT(),"5P")
"RTN","DGMSRPT1",21,0)
 D MSG^DGMSRPT(DGXTMP)
"RTN","DGMSRPT1",22,0)
 K ^XTMP("DGMSRPT","RUNNING"),DGXTMP
"RTN","DGMSRPT1",23,0)
 Q
"RTN","DGMSRPT1",24,0)
 ;
"RTN","DGMSRPT1",25,0)
CHK(DFN) ; Check if patient meets criteria to include in report
"RTN","DGMSRPT1",26,0)
 ; INPUT: DFN - Patient file IEN
"RTN","DGMSRPT1",27,0)
 ; OUTPUT: 1=Meets report criteria; 0=Doesn't meet report criteria
"RTN","DGMSRPT1",28,0)
 N CHK,ENR,ENRDT,UE,UESITE,SITE
"RTN","DGMSRPT1",29,0)
 S CHK=0 I '$G(DFN) Q CHK
"RTN","DGMSRPT1",30,0)
 ; Patient is a veteran
"RTN","DGMSRPT1",31,0)
 I $P($G(^DPT(DFN,"VET")),U)'="Y" Q CHK
"RTN","DGMSRPT1",32,0)
 ; Patient not deceased
"RTN","DGMSRPT1",33,0)
 I +$G(^DPT(DFN,.35)) Q CHK
"RTN","DGMSRPT1",34,0)
 ; Primary eligibility not 'Humanitarian Emergency', 'Sharing Agreement',
"RTN","DGMSRPT1",35,0)
 ; or 'Employee'
"RTN","DGMSRPT1",36,0)
 I "^8^9^14^"[(U_+$G(^DPT(DFN,.36))_U) Q CHK
"RTN","DGMSRPT1",37,0)
 ; User Enrollee of this facility
"RTN","DGMSRPT1",38,0)
 S UE=$P($G(^DPT(DFN,.361)),U,7) I UE="" Q CHK
"RTN","DGMSRPT1",39,0)
 S UESITE=$P($G(^DPT(DFN,.361)),U,8) I +UESITE=0 Q CHK
"RTN","DGMSRPT1",40,0)
 S SITE=$P($$SITE^VASITE,U,3),SITE=$$PSITE^EASUER(SITE)
"RTN","DGMSRPT1",41,0)
 I $P($G(^DIC(4,UESITE,99)),U)'=$P($G(^DIC(4,SITE,99)),U) Q CHK
"RTN","DGMSRPT1",42,0)
 ; Has a current enrollment record
"RTN","DGMSRPT1",43,0)
 I '$G(^DPT(DFN,"ENR")) Q CHK
"RTN","DGMSRPT1",44,0)
 ; Meets report criteria
"RTN","DGMSRPT1",45,0)
 S CHK=1
"RTN","DGMSRPT1",46,0)
 Q CHK
"RTN","DGMSRPT1",47,0)
 ;
"RTN","DGMSRPT1",48,0)
MSINC(DFN) ; Check military service data for inconsistencies.
"RTN","DGMSRPT1",49,0)
 N DGMS,NAM,SSN
"RTN","DGMSRPT1",50,0)
 Q:'$G(DFN)
"RTN","DGMSRPT1",51,0)
 ; Get veteran's military service data
"RTN","DGMSRPT1",52,0)
 D GETMS(DFN,.DGMS)
"RTN","DGMSRPT1",53,0)
 ; Check Military Service Episodes
"RTN","DGMSRPT1",54,0)
 D MSECHK(DFN,.DGMS)
"RTN","DGMSRPT1",55,0)
 ; Check Combat and POW data
"RTN","DGMSRPT1",56,0)
 D CMPWCHK(DFN,.DGMS)
"RTN","DGMSRPT1",57,0)
 ; Check Conflict data
"RTN","DGMSRPT1",58,0)
 D CONFCHK(DFN,.DGMS)
"RTN","DGMSRPT1",59,0)
 ; If inconsistencies were found, add 0 node and x-refs
"RTN","DGMSRPT1",60,0)
 I $D(@DGXTMP@(DFN)) D
"RTN","DGMSRPT1",61,0)
 .S NAM=$P($G(^DPT(DFN,0)),U,1),SSN=$P($G(^DPT(DFN,0)),U,9)
"RTN","DGMSRPT1",62,0)
 .S @DGXTMP@(DFN,0)=NAM_U_SSN
"RTN","DGMSRPT1",63,0)
 .I NAM'="" S @DGXTMP@("NAM",NAM,DFN)=""
"RTN","DGMSRPT1",64,0)
 .I SSN'="" S @DGXTMP@("SSN",+$E(SSN,8,9),+$E(SSN,6,9),+SSN,DFN)=""
"RTN","DGMSRPT1",65,0)
 .D SETCNT("VET")
"RTN","DGMSRPT1",66,0)
 Q
"RTN","DGMSRPT1",67,0)
 ;
"RTN","DGMSRPT1",68,0)
GETMS(DFN,DGMS) ; Build DGMS array of military service data
"RTN","DGMSRPT1",69,0)
 ; INPUT: DFN - Patient file IEN
"RTN","DGMSRPT1",70,0)
 ; OUTPUT: DGMS(CATEGORY,FIELD) - array of Military Service data
"RTN","DGMSRPT1",71,0)
 N MS,I,CAT,FLD
"RTN","DGMSRPT1",72,0)
 Q:'$G(DFN)
"RTN","DGMSRPT1",73,0)
 F I=.32,.321,.322,.52 S MS(I)=$G(^DPT(DFN,I))
"RTN","DGMSRPT1",74,0)
 S CAT="MSE1^MSE2^MSE3",FLD="DIS^BOS^FDT^TDT^NUM"
"RTN","DGMSRPT1",75,0)
 D ARRY(CAT,FLD,.32,4,18,.MS,.DGMS)
"RTN","DGMSRPT1",76,0)
 I $P(MS(.32),U,19)'="Y" K DGMS("MSE2")  ;Delete data for inactive MSE
"RTN","DGMSRPT1",77,0)
 I $P(MS(.32),U,20)'="Y" K DGMS("MSE3")  ;Delete data for inactive MSE
"RTN","DGMSRPT1",78,0)
 S CAT="LEB^GREN^PAN^GULF",FLD="IND^FDT^TDT"
"RTN","DGMSRPT1",79,0)
 D ARRY(CAT,FLD,.322,1,12,.MS,.DGMS)
"RTN","DGMSRPT1",80,0)
 S CAT="SOM^YUG"
"RTN","DGMSRPT1",81,0)
 D ARRY(CAT,FLD,.322,16,21,.MS,.DGMS)
"RTN","DGMSRPT1",82,0)
 S CAT="VIET",FLD="IND"
"RTN","DGMSRPT1",83,0)
 D ARRY(CAT,FLD,.321,1,1,.MS,.DGMS)
"RTN","DGMSRPT1",84,0)
 S FLD="FDT^TDT"
"RTN","DGMSRPT1",85,0)
 D ARRY(CAT,FLD,.321,4,5,.MS,.DGMS)
"RTN","DGMSRPT1",86,0)
 S CAT="POW",FLD="IND^LOC^FDT^TDT"
"RTN","DGMSRPT1",87,0)
 D ARRY(CAT,FLD,.52,5,8,.MS,.DGMS)
"RTN","DGMSRPT1",88,0)
 S CAT="COM"
"RTN","DGMSRPT1",89,0)
 D ARRY(CAT,FLD,.52,11,14,.MS,.DGMS)
"RTN","DGMSRPT1",90,0)
 Q
"RTN","DGMSRPT1",91,0)
 ;
"RTN","DGMSRPT1",92,0)
ARRY(CAT,FLD,SB,P1,P2,MS,DGMS) ; Set array
"RTN","DGMSRPT1",93,0)
 ; INPUT: CAT - MS categories (e.g. MSE1 = 1st Military Service Episode)
"RTN","DGMSRPT1",94,0)
 ;        FLD - MS fields (e.g. FDT = From Date, TDT = To Date)
"RTN","DGMSRPT1",95,0)
 ;        SB - MS array subscript
"RTN","DGMSRPT1",96,0)
 ;        P1 - Starting piece in MS string
"RTN","DGMSRPT1",97,0)
 ;        P2 - Ending piece in MS string
"RTN","DGMSRPT1",98,0)
 ;        MS( - Array with MS data from the Patient file
"RTN","DGMSRPT1",99,0)
 ; OUTPUT: DGMS( - Array returned with MS data grouped by category
"RTN","DGMSRPT1",100,0)
 N I,J,K
"RTN","DGMSRPT1",101,0)
 S J=1,K=0
"RTN","DGMSRPT1",102,0)
 F I=P1:1:P2 D
"RTN","DGMSRPT1",103,0)
 .I K=$L(FLD,U) S J=J+1,K=0
"RTN","DGMSRPT1",104,0)
 .S K=K+1
"RTN","DGMSRPT1",105,0)
 .I $P(MS(SB),U,I)'="" S DGMS($P(CAT,U,J),$P(FLD,U,K))=$P(MS(SB),U,I)
"RTN","DGMSRPT1",106,0)
 Q
"RTN","DGMSRPT1",107,0)
 ;
"RTN","DGMSRPT1",108,0)
MSECHK(DFN,DGMS) ; Check military service episodes for inconsistencies
"RTN","DGMSRPT1",109,0)
 ; INPUT: DFN - Patient file IEN
"RTN","DGMSRPT1",110,0)
 ;        DGMS( - MS data array
"RTN","DGMSRPT1",111,0)
 N DGTXT,CAT,DG,OVR,BOS
"RTN","DGMSRPT1",112,0)
 ; Is there MSE data for this veteran?
"RTN","DGMSRPT1",113,0)
 I '$D(DGMS("MSE1")),'$D(DGMS("MSE2")),'$D(DGMS("MSE3")) Q
"RTN","DGMSRPT1",114,0)
 F CAT="MSE1","MSE2","MSE3" K DGTXT S DG=1 I $D(DGMS(CAT)) D
"RTN","DGMSRPT1",115,0)
 .; Check Branch of Service (B.E.C. and Merchant Seaman)
"RTN","DGMSRPT1",116,0)
 .S BOS=+$G(DGMS(CAT,"BOS")),BOS=$P($G(^DIC(23,BOS,0)),U,1)
"RTN","DGMSRPT1",117,0)
 .I BOS="B.E.C." S DGTXT="BEC" D SETTXT(.DG,.DGTXT),SETCNT(2)
"RTN","DGMSRPT1",118,0)
 .I BOS="MERCHANT SEAMAN" D
"RTN","DGMSRPT1",119,0)
 ..Q:$$CNFLCTDT^DGRPDT($G(DGMS(CAT,"FDT")),$G(DGMS(CAT,"TDT")),"WWIIP")
"RTN","DGMSRPT1",120,0)
 ..S DGTXT="MERC SEA NO WWII SVC" D SETTXT(.DG,.DGTXT),SETCNT(3)
"RTN","DGMSRPT1",121,0)
 .; Check for missing data
"RTN","DGMSRPT1",122,0)
 .I $$MISS(CAT,"BOS^DIS^FDT^TDT") S DGTXT="DATA MISS" D SETTXT(.DG,.DGTXT),SETCNT(4)
"RTN","DGMSRPT1",123,0)
 .; Check for imprecise dates (year only)
"RTN","DGMSRPT1",124,0)
 .I $$IMPR(CAT,"FDT^TDT") S DGTXT="DT IMPR" D SETTXT(.DG,.DGTXT),SETCNT(5)
"RTN","DGMSRPT1",125,0)
 .; Check if To Date is before From Date
"RTN","DGMSRPT1",126,0)
 .I $G(DGMS(CAT,"FDT")),$G(DGMS(CAT,"TDT")),$$B4^DGRPDT(DGMS(CAT,"TDT"),DGMS(CAT,"FDT")) D
"RTN","DGMSRPT1",127,0)
 ..S DGTXT="END DT BEFORE START DT" D SETTXT(.DG,.DGTXT),SETCNT(6)
"RTN","DGMSRPT1",128,0)
 .; Check if dates overlap with another MSE
"RTN","DGMSRPT1",129,0)
 .S OVR=$$OVRLP(CAT) I OVR S DGTXT="DT OVRLP W/ "_$P(OVR,U,2) D SETTXT(.DG,.DGTXT),SETCNT(7)
"RTN","DGMSRPT1",130,0)
 .;If inconsistencies found, update ^XTMP("DGMSRPT","MSINC",DFN,
"RTN","DGMSRPT1",131,0)
 .I $D(DGTXT) D SETVET(DFN,CAT,.DGTXT)
"RTN","DGMSRPT1",132,0)
 Q
"RTN","DGMSRPT1",133,0)
 ;
"RTN","DGMSRPT1",134,0)
CMPWCHK(DFN,DGMS) ; Check Combat and POW data for inconsistencies
"RTN","DGMSRPT1",135,0)
 ; INPUT: DFN - Patient file IEN
"RTN","DGMSRPT1",136,0)
 ;        DGMS( - MS data array
"RTN","DGMSRPT1",137,0)
 N DGTXT,CAT,DG,LOC
"RTN","DGMSRPT1",138,0)
 F CAT="COM","POW" K DGTXT S DG=1 I $G(DGMS(CAT,"IND"))="Y" D
"RTN","DGMSRPT1",139,0)
 .; Check for missing data
"RTN","DGMSRPT1",140,0)
 .I $$MISS(CAT,"FDT^TDT^LOC") S DGTXT="DATA MISS" D SETTXT(.DG,.DGTXT),SETCNT($S(CAT="COM":8,1:16))
"RTN","DGMSRPT1",141,0)
 .; Check for imprecise dates (year only)
"RTN","DGMSRPT1",142,0)
 .I $$IMPR(CAT,"FDT^TDT") S DGTXT="DT IMPR" D SETTXT(.DG,.DGTXT),SETCNT($S(CAT="COM":9,1:17))
"RTN","DGMSRPT1",143,0)
 .; Check if dates are valid for the location
"RTN","DGMSRPT1",144,0)
 .I $G(DGMS(CAT,"LOC")) S LOC=$$LOC(DGMS(CAT,"LOC")) I LOC'="" D
"RTN","DGMSRPT1",145,0)
 ..Q:$$CNFLCTDT^DGRPDT($G(DGMS(CAT,"FDT")),$G(DGMS(CAT,"TDT")),LOC)
"RTN","DGMSRPT1",146,0)
 ..S DGTXT="DT INVALID FOR LOC" D SETTXT(.DG,.DGTXT),SETCNT($S(CAT="COM":10,1:18))
"RTN","DGMSRPT1",147,0)
 .; Check if dates are within a Military Service Episode
"RTN","DGMSRPT1",148,0)
 .I $G(DGMS(CAT,"FDT"))!($G(DGMS(CAT,"TDT"))) D
"RTN","DGMSRPT1",149,0)
 ..Q:$$OVRLPCHK^DGRPDT(DFN,$G(DGMS(CAT,"FDT")),$G(DGMS(CAT,"TDT")),-1)
"RTN","DGMSRPT1",150,0)
 ..S DGTXT="DT NOT W/IN MSE" D SETTXT(.DG,.DGTXT),SETCNT($S(CAT="COM":11,1:19))
"RTN","DGMSRPT1",151,0)
 .;If inconsistencies found, update ^XTMP("DGMSRPT","MSINC",DFN,
"RTN","DGMSRPT1",152,0)
 .I $D(DGTXT) D SETVET(DFN,CAT,.DGTXT)
"RTN","DGMSRPT1",153,0)
 Q
"RTN","DGMSRPT1",154,0)
 ;
"RTN","DGMSRPT1",155,0)
CONFCHK(DFN,DGMS) ; Check Conflict data for inconsistencies
"RTN","DGMSRPT1",156,0)
 ; INPUT: DFN - Patient file IEN
"RTN","DGMSRPT1",157,0)
 ;        DGMS( - MS data array
"RTN","DGMSRPT1",158,0)
 N DGTXT,CAT,DG
"RTN","DGMSRPT1",159,0)
 F CAT="VIET","LEB","GREN","PAN","GULF","SOM","YUG" K DGTXT S DG=1 I $G(DGMS(CAT,"IND"))="Y" D
"RTN","DGMSRPT1",160,0)
 .; Check for missing data
"RTN","DGMSRPT1",161,0)
 .I $$MISS(CAT,"FDT^TDT") S DGTXT="DATA MISS" D SETTXT(.DG,.DGTXT),SETCNT(12)
"RTN","DGMSRPT1",162,0)
 .; Check for imprecise dates (year only)
"RTN","DGMSRPT1",163,0)
 .I $$IMPR(CAT,"FDT^TDT") S DGTXT="DT IMPR" D SETTXT(.DG,.DGTXT),SETCNT(13)
"RTN","DGMSRPT1",164,0)
 .; Check if dates are valid for the location
"RTN","DGMSRPT1",165,0)
 .I $G(DGMS(CAT,"FDT"))!($G(DGMS(CAT,"TDT"))) D
"RTN","DGMSRPT1",166,0)
 ..Q:$$CNFLCTDT^DGRPDT($G(DGMS(CAT,"FDT")),$G(DGMS(CAT,"TDT")),CAT)
"RTN","DGMSRPT1",167,0)
 ..S DGTXT="DT INVALID FOR LOC" D SETTXT(.DG,.DGTXT),SETCNT(14)
"RTN","DGMSRPT1",168,0)
 .; Check if dates are within a Military Service Episode
"RTN","DGMSRPT1",169,0)
 .I $G(DGMS(CAT,"FDT"))!($G(DGMS(CAT,"TDT"))) D
"RTN","DGMSRPT1",170,0)
 ..Q:$$OVRLPCHK^DGRPDT(DFN,$G(DGMS(CAT,"FDT")),$G(DGMS(CAT,"TDT")),-1)
"RTN","DGMSRPT1",171,0)
 ..S DGTXT="DT NOT W/IN MSE" D SETTXT(.DG,.DGTXT),SETCNT(15)
"RTN","DGMSRPT1",172,0)
 .;If inconsistencies found, update ^XTMP("DGMSRPT","MSINC",DFN,
"RTN","DGMSRPT1",173,0)
 .I $D(DGTXT) D SETVET(DFN,CAT,.DGTXT)
"RTN","DGMSRPT1",174,0)
 Q
"RTN","DGMSRPT1",175,0)
 ;
"RTN","DGMSRPT1",176,0)
SETTXT(DG,DGTXT) ; Set array of MS inconsistency text DGTXT(
"RTN","DGMSRPT1",177,0)
 ; INPUT: DG - Subscript for DGTXT array
"RTN","DGMSRPT1",178,0)
 Q:'$G(DG)
"RTN","DGMSRPT1",179,0)
 I $G(DGTXT(DG))="" S DGTXT(DG)=DGTXT Q
"RTN","DGMSRPT1",180,0)
 I $L(DGTXT(DG)_"; "_DGTXT)>36 S DG=DG+1,DGTXT(DG)=DGTXT Q
"RTN","DGMSRPT1",181,0)
 S DGTXT(DG)=DGTXT(DG)_"; "_DGTXT
"RTN","DGMSRPT1",182,0)
 Q
"RTN","DGMSRPT1",183,0)
SETVET(DFN,CAT,DGTXT) ; Update ^XTMP("DGMSRPT","MSINC",DFN, with MS inconsistencies for veteran
"RTN","DGMSRPT1",184,0)
 ;
"RTN","DGMSRPT1",185,0)
 Q:'$G(DFN)  Q:'$D(CAT)  Q:'$D(DGTXT)
"RTN","DGMSRPT1",186,0)
 N DG S DG=0
"RTN","DGMSRPT1",187,0)
 F  S DG=$O(DGTXT(DG)) Q:'DG  S @DGXTMP@(DFN,CAT,DG)=DGTXT(DG)
"RTN","DGMSRPT1",188,0)
 Q
"RTN","DGMSRPT1",189,0)
SETCNT(SUB) ; Update ^XTMP("DGMSRPT","MSINC","CNT",
"RTN","DGMSRPT1",190,0)
 ; INPUT: SUB - Subscript in ^("CNT") array to increment
"RTN","DGMSRPT1",191,0)
 Q:$G(SUB)=""
"RTN","DGMSRPT1",192,0)
 S $P(@DGXTMP@("CNT",SUB),U,1)=+(@DGXTMP@("CNT",SUB))+1
"RTN","DGMSRPT1",193,0)
 Q
"RTN","DGMSRPT1",194,0)
 ;
"RTN","DGMSRPT1",195,0)
MISS(CAT,FLD) ; Check for missing data elements
"RTN","DGMSRPT1",196,0)
 ; INPUT: CAT - MS category, 1st subscript in DGMS array
"RTN","DGMSRPT1",197,0)
 ;        FLD - List of fields to check for missing data
"RTN","DGMSRPT1",198,0)
 ; OUTPUT: 1=Missing data; 0=No missing data
"RTN","DGMSRPT1",199,0)
 N MISS,I,X
"RTN","DGMSRPT1",200,0)
 S MISS=0
"RTN","DGMSRPT1",201,0)
 I $G(CAT)=""!($G(FLD)="") Q MISS
"RTN","DGMSRPT1",202,0)
 F I=1:1 S X=$P(FLD,U,I) Q:X=""  I '$D(DGMS(CAT,X)) S MISS=1 Q
"RTN","DGMSRPT1",203,0)
 Q MISS
"RTN","DGMSRPT1",204,0)
IMPR(CAT,FLD) ; Check for imprecise dates (year only)
"RTN","DGMSRPT1",205,0)
 ; INPUT: CAT - MS category, 1st subscript in DGMS array
"RTN","DGMSRPT1",206,0)
 ;        FLD - List of fields to check for imprecise dates
"RTN","DGMSRPT1",207,0)
 ; OUTPUT: 1=Imprecise date; 0=No imprecise date
"RTN","DGMSRPT1",208,0)
 N IMPR,I,X
"RTN","DGMSRPT1",209,0)
 S IMPR=0
"RTN","DGMSRPT1",210,0)
 I $G(CAT)=""!($G(FLD)="") Q IMPR
"RTN","DGMSRPT1",211,0)
 F I=1:1 S X=$P(FLD,U,I) Q:X=""  I $D(DGMS(CAT,X)),'$$MNTHYR^DGRPDT(DGMS(CAT,X)) S IMPR=1 Q
"RTN","DGMSRPT1",212,0)
 Q IMPR
"RTN","DGMSRPT1",213,0)
OVRLP(CAT) ; Check if MSE dates overlap with another MSE
"RTN","DGMSRPT1",214,0)
 ; INPUT: CAT - MS category, 1st subscript in DGMS array
"RTN","DGMSRPT1",215,0)
 ; OUTPUT: 0=No overlap; 1^X=Overlap^MSE that overlaps
"RTN","DGMSRPT1",216,0)
 N OVR,MSE,DGI,DGX
"RTN","DGMSRPT1",217,0)
 S OVR=0
"RTN","DGMSRPT1",218,0)
 I $G(CAT)="" Q OVR
"RTN","DGMSRPT1",219,0)
 S DGX=$E(CAT,4)
"RTN","DGMSRPT1",220,0)
 ; If MSE1, no check; if MSE2, check overlap with MSE1; if MSE3, check
"RTN","DGMSRPT1",221,0)
 ; overlap with MSE2 or MSE1
"RTN","DGMSRPT1",222,0)
 F DGI=(DGX-1):-1:1 S MSE="MSE"_DGI I $D(DGMS(MSE)) D  Q:OVR
"RTN","DGMSRPT1",223,0)
 .S OVR=$$WITHIN^DGRPDT($G(DGMS(CAT,"FDT")),$G(DGMS(CAT,"TDT")),$G(DGMS(MSE,"FDT"))) I OVR S OVR=+OVR_U_MSE Q
"RTN","DGMSRPT1",224,0)
 .S OVR=$$WITHIN^DGRPDT($G(DGMS(CAT,"FDT")),$G(DGMS(CAT,"TDT")),$G(DGMS(MSE,"TDT"))) I OVR S OVR=+OVR_U_MSE Q
"RTN","DGMSRPT1",225,0)
 Q OVR
"RTN","DGMSRPT1",226,0)
 ;
"RTN","DGMSRPT1",227,0)
LOC(LN) ; Return conflict location abbreviation to pass to $$CNFLCTDT^DGRPDT
"RTN","DGMSRPT1",228,0)
 ; INPUT: LN - POW Location file #22 IEN
"RTN","DGMSRPT1",229,0)
 ; OUTPUT: LOC - Conflict location abbreviation
"RTN","DGMSRPT1",230,0)
 N LOC
"RTN","DGMSRPT1",231,0)
 S LOC="" I '$G(LN) Q LOC
"RTN","DGMSRPT1",232,0)
 S LN=$P($G(^DIC(22,LN,0)),U,1) I LN="" Q LOC
"RTN","DGMSRPT1",233,0)
 I LN="WORLD WAR I" S LOC="WWI"
"RTN","DGMSRPT1",234,0)
 I LN["EUROPE" S LOC="WWIIE"
"RTN","DGMSRPT1",235,0)
 I LN["PACIFIC" S LOC="WWIIP"
"RTN","DGMSRPT1",236,0)
 I LN["KOREA" S LOC="KOR"
"RTN","DGMSRPT1",237,0)
 I LN["VIETNAM" S LOC="VIET"
"RTN","DGMSRPT1",238,0)
 I LN="OTHER" S LOC=""
"RTN","DGMSRPT1",239,0)
 I LN["GULF" S LOC="GULF"
"RTN","DGMSRPT1",240,0)
 I LN["YUGOSLAVIA" S LOC="YUG"
"RTN","DGMSRPT1",241,0)
 Q LOC
"RTN","DGMSRPT2")
0^4^B11081504
"RTN","DGMSRPT2",1,0)
DGMSRPT2 ;ALB/LBD - Military Service Inconsistency Report; 01/05/04
"RTN","DGMSRPT2",2,0)
 ;;5.3;Registration;**562**; Aug 13,1993
"RTN","DGMSRPT2",3,0)
 ;
"RTN","DGMSRPT2",4,0)
 ; This routine prints the Military Service Data Inconsistencies
"RTN","DGMSRPT2",5,0)
 ; report from the extracted data stored in ^XTMP("DSMSRPT").
"RTN","DGMSRPT2",6,0)
 ; 
"RTN","DGMSRPT2",7,0)
 ;
"RTN","DGMSRPT2",8,0)
EN(DGBEG,DGEND,DGSRT) ; Entry point called from ^DGMSRPT
"RTN","DGMSRPT2",9,0)
 ; INPUT:  DGBEG - Starting record number to print
"RTN","DGMSRPT2",10,0)
 ;         DGEND - Ending record number to print
"RTN","DGMSRPT2",11,0)
 ;         DGSRT - Sort order for report (Name or SSN)
"RTN","DGMSRPT2",12,0)
 N PG,LINE,RPTDT,CRT,OUT,DSH,CNT,MXLNE,DGXTMP,DGTOT,LOOP
"RTN","DGMSRPT2",13,0)
 S:$G(ZTSK) ZTREQ="@"
"RTN","DGMSRPT2",14,0)
 D PRTVAR
"RTN","DGMSRPT2",15,0)
 U IO D HDR
"RTN","DGMSRPT2",16,0)
 I 'DGTOT W !!,?10,"*** There are no records to print ***" S OUT=$$PAUSE Q
"RTN","DGMSRPT2",17,0)
 S LOOP="LOOP"_DGSRT
"RTN","DGMSRPT2",18,0)
 D @LOOP Q:OUT
"RTN","DGMSRPT2",19,0)
 D TOT Q:OUT
"RTN","DGMSRPT2",20,0)
 W ! S OUT=$$PAUSE
"RTN","DGMSRPT2",21,0)
 Q
"RTN","DGMSRPT2",22,0)
LOOPN ; Sort by name. Loop through ^XTMP("DGMSRPT","MSINC","NAM", x-ref
"RTN","DGMSRPT2",23,0)
 N NM,DFN
"RTN","DGMSRPT2",24,0)
 S NM=""
"RTN","DGMSRPT2",25,0)
 F  S NM=$O(@DGXTMP@("NAM",NM)) Q:NM=""!(CNT>DGEND)!OUT  S DFN="" F  S DFN=$O(@DGXTMP@("NAM",NM,DFN)) Q:DFN=""!(CNT>DGEND)!OUT  S CNT=CNT+1 I CNT'<DGBEG,CNT'>DGEND D PRINT
"RTN","DGMSRPT2",26,0)
 Q
"RTN","DGMSRPT2",27,0)
LOOPS ; Sort by SSN. Loop through ^XTMP("DGMSRPT","MSINC","SSN", x-ref
"RTN","DGMSRPT2",28,0)
 N S2,S4,S9,DFN
"RTN","DGMSRPT2",29,0)
 S S2=""
"RTN","DGMSRPT2",30,0)
 F  S S2=$O(@DGXTMP@("SSN",S2)) Q:S2=""!(CNT>DGEND)!OUT  S S4="" F  S S4=$O(@DGXTMP@("SSN",S2,S4)) Q:S4=""!(CNT>DGEND)!OUT  D
"RTN","DGMSRPT2",31,0)
 . S S9=""
"RTN","DGMSRPT2",32,0)
 . F  S S9=$O(@DGXTMP@("SSN",S2,S4,S9)) Q:S9=""!(CNT>DGEND)!OUT  S DFN="" F  S DFN=$O(@DGXTMP@("SSN",S2,S4,S9,DFN)) Q:DFN=""!(CNT>DGEND)!OUT  S CNT=CNT+1 I CNT'<DGBEG,CNT'>DGEND D PRINT
"RTN","DGMSRPT2",33,0)
 Q
"RTN","DGMSRPT2",34,0)
PRINT ; Print detail
"RTN","DGMSRPT2",35,0)
 N VET,CT,CAT,IN
"RTN","DGMSRPT2",36,0)
 Q:'$D(@DGXTMP@(DFN))
"RTN","DGMSRPT2",37,0)
 S VET=$G(@DGXTMP@(DFN,0))
"RTN","DGMSRPT2",38,0)
 I LINE>MXLNE S OUT=$$PAUSE Q:OUT  D HDR
"RTN","DGMSRPT2",39,0)
 W !,$P(VET,U,2),?12,$E($P(VET,U,1),1,25)
"RTN","DGMSRPT2",40,0)
 S LINE=LINE+1,CAT=0
"RTN","DGMSRPT2",41,0)
 F CT=1:1 S CAT=$O(@DGXTMP@(DFN,CAT)) Q:CAT=""!OUT  D
"RTN","DGMSRPT2",42,0)
 . I CT>1 D
"RTN","DGMSRPT2",43,0)
 . . I LINE>MXLNE S OUT=$$PAUSE Q:OUT  D HDR
"RTN","DGMSRPT2",44,0)
 . . W ! S LINE=LINE+1
"RTN","DGMSRPT2",45,0)
 . W ?37,CAT
"RTN","DGMSRPT2",46,0)
 . S IN="" F  S IN=$O(@DGXTMP@(DFN,CAT,IN)) Q:IN=""!OUT  D
"RTN","DGMSRPT2",47,0)
 . . I IN>1 D  Q:OUT
"RTN","DGMSRPT2",48,0)
 . . . I LINE>MXLNE S OUT=$$PAUSE Q:OUT  D HDR
"RTN","DGMSRPT2",49,0)
 . . . W ! S LINE=LINE+1
"RTN","DGMSRPT2",50,0)
 . . W ?43,@DGXTMP@(DFN,CAT,IN)
"RTN","DGMSRPT2",51,0)
 Q
"RTN","DGMSRPT2",52,0)
TOT ; Print total records at the end of the report
"RTN","DGMSRPT2",53,0)
 I LINE+5>MXLNE S OUT=$$PAUSE Q:OUT  D HDR
"RTN","DGMSRPT2",54,0)
 W !!,"    Starting Record #:",$$RJ^XLFSTR(DGBEG,7)
"RTN","DGMSRPT2",55,0)
 W !,"      Ending Record #:",$$RJ^XLFSTR(DGEND,7)
"RTN","DGMSRPT2",56,0)
 W !!,"Total Records Printed:",$$RJ^XLFSTR((DGEND-DGBEG)+1,7)," out of ",DGTOT
"RTN","DGMSRPT2",57,0)
 Q
"RTN","DGMSRPT2",58,0)
PRTVAR ; Set up variables needed to print report
"RTN","DGMSRPT2",59,0)
 S CRT=$S($E(IOST,1,2)="C-":1,1:0)
"RTN","DGMSRPT2",60,0)
 S DGXTMP="^XTMP(""DGMSRPT"",""MSINC"")"
"RTN","DGMSRPT2",61,0)
 S DGTOT=+$G(@DGXTMP@("CNT","VET"))
"RTN","DGMSRPT2",62,0)
 S:'$G(DGBEG) DGBEG=1 S:'$G(DGEND) DGEND=DGTOT
"RTN","DGMSRPT2",63,0)
 S:$G(DGSRT)="" DGSRT="N"
"RTN","DGMSRPT2",64,0)
 S (PG,CNT,OUT)=0,RPTDT=$$FMTE^XLFDT(DT),MXLNE=$S(CRT:15,1:52)
"RTN","DGMSRPT2",65,0)
 S DSH="",$P(DSH,"=",80)=""
"RTN","DGMSRPT2",66,0)
 Q
"RTN","DGMSRPT2",67,0)
HDR ; Print report header
"RTN","DGMSRPT2",68,0)
 S PG=PG+1,LINE=0
"RTN","DGMSRPT2",69,0)
 W @IOF
"RTN","DGMSRPT2",70,0)
 W ?0,"Report Date: ",RPTDT,?68,"Page: ",$$RJ^XLFSTR(PG,4)
"RTN","DGMSRPT2",71,0)
 W !,"Sorted By: "_$S(DGSRT="N":"Name",1:"SSN (Terminal Digits)")
"RTN","DGMSRPT2",72,0)
 W !!,$$CJ^XLFSTR("MILITARY SERVICE DATA INCONSISTENCIES DETAIL REPORT",80)
"RTN","DGMSRPT2",73,0)
 W !!,"SSN",?12,"Veteran's Name",?37,"Cat.  Inconsistencies"
"RTN","DGMSRPT2",74,0)
 W !,DSH
"RTN","DGMSRPT2",75,0)
 Q
"RTN","DGMSRPT2",76,0)
PAUSE() ; If report is sent to screen, prompt for next page or quit
"RTN","DGMSRPT2",77,0)
 N DIR,DIRUT,DUOUT,DTOUT,X,Y
"RTN","DGMSRPT2",78,0)
 I 'CRT Q 0
"RTN","DGMSRPT2",79,0)
 S DIR(0)="E"
"RTN","DGMSRPT2",80,0)
 D ^DIR I 'Y Q 1
"RTN","DGMSRPT2",81,0)
 Q 0
"RTN","DGRPDT")
0^3^B60362179
"RTN","DGRPDT",1,0)
DGRPDT ;ALB/BRM - MILITARY SERVICE DATE UTILITIES ; 3/22/04 2:00pm
"RTN","DGRPDT",2,0)
 ;;5.3;Registration;**562**;Aug 13, 1993
"RTN","DGRPDT",3,0)
 ;
"RTN","DGRPDT",4,0)
DTUTIL(DGNEWDT,DGOLDDT,MYFLG) ; Date precision comparision API
"RTN","DGRPDT",5,0)
 ;
"RTN","DGRPDT",6,0)
 ; INPUT: DGNEWDT - New Date in Fileman format
"RTN","DGRPDT",7,0)
 ;        DGOLDDT - Old Date in Fileman format (optional)
"RTN","DGRPDT",8,0)
 ;          MYFLG - Validate existence of month/year (binary,optional)
"RTN","DGRPDT",9,0)
 ;
"RTN","DGRPDT",10,0)
 ; OUTPUT: 1st piece - more/less precise (binary)
"RTN","DGRPDT",11,0)
 ;         2nd piece - reason (for troubleshooting only)
"RTN","DGRPDT",12,0)
 ;         Examples: 1^MORE PRECISE DAY
"RTN","DGRPDT",13,0)
 ;                   0^LESS PRECISE DAY
"RTN","DGRPDT",14,0)
 ;                   1^SAME PRECISION
"RTN","DGRPDT",15,0)
 ;
"RTN","DGRPDT",16,0)
 S:$G(DGOLDDT)="" DGOLDDT="0000000"
"RTN","DGRPDT",17,0)
 Q:'$$VALID(.DGNEWDT) "0^INVALID DATE PARAMETER"
"RTN","DGRPDT",18,0)
 I $L(DGOLDDT)<7 S DGOLDDT=DGOLDDT_$E("0000000",$L(DGOLDDT)+1,7)
"RTN","DGRPDT",19,0)
 N X,Y,EXACTO,EXACTN,I,RTN,MSDATE,MSG
"RTN","DGRPDT",20,0)
 S RTN="",EXACTO=$$CHKEXC(DGOLDDT),EXACTN=$$CHKEXC(DGNEWDT)
"RTN","DGRPDT",21,0)
 I $G(MYFLG) Q:'$$MNTHYR(DGNEWDT) "0^Date must contain month and year"
"RTN","DGRPDT",22,0)
 Q:EXACTO=EXACTN "1^Same Precision"
"RTN","DGRPDT",23,0)
 F I=1:1:3  Q:RTN'=""  D
"RTN","DGRPDT",24,0)
 .S:$E(EXACTN,I)<$E(EXACTO,I) RTN="0^ is Less Precise Than Previously Entered "
"RTN","DGRPDT",25,0)
 .S:$E(EXACTN,I)>$E(EXACTO,I) RTN="1^ is More Precise Than Previously Entered "
"RTN","DGRPDT",26,0)
 .S MSG=$S(I=1:"Year",I=2:"Month",I=3:"Day",1:"")
"RTN","DGRPDT",27,0)
 .S:RTN'="" $P(RTN,"^",2)=MSG_$P(RTN,"^",2)_MSG
"RTN","DGRPDT",28,0)
 Q $S($G(RTN)'="":RTN,1:"0^Unknown Precision")
"RTN","DGRPDT",29,0)
 ;
"RTN","DGRPDT",30,0)
CHKEXC(MSDATE) ; construct precision string (3 digit return value - YMD)
"RTN","DGRPDT",31,0)
 Q ($E(MSDATE,1,3)'="000")_($E(MSDATE,4,5)'="00")_($E(MSDATE,6,7)'="00")
"RTN","DGRPDT",32,0)
 ;
"RTN","DGRPDT",33,0)
MNTHYR(MSDATE) ; ensure month and year are not imprecise (binary return value)
"RTN","DGRPDT",34,0)
 Q ($E(MSDATE,1,3)'="000")&($E(MSDATE,4,5)'="00")
"RTN","DGRPDT",35,0)
 ;
"RTN","DGRPDT",36,0)
WITHIN(FRDT,TODT,CHKDT) ; is CHKDT within FRDT and TODT?
"RTN","DGRPDT",37,0)
 ;
"RTN","DGRPDT",38,0)
 ; INPUT:  FRDT - Beginning of Date Range (Fileman Date format)
"RTN","DGRPDT",39,0)
 ;         TODT - End of Date Range (Fileman Date format)
"RTN","DGRPDT",40,0)
 ;        CHKDT - Date to check within range (Fileman Date format) 
"RTN","DGRPDT",41,0)
 ;
"RTN","DGRPDT",42,0)
 ; OUTPUT: 1st piece - within date range? (binary)
"RTN","DGRPDT",43,0)
 ;         2nd piece - Reason (for troubleshooting only)
"RTN","DGRPDT",44,0)
 ;
"RTN","DGRPDT",45,0)
 Q:'$$VALID($G(CHKDT)) "0^Invalid Date"
"RTN","DGRPDT",46,0)
 Q:('$G(FRDT))!('$G(TODT)) "0^Missing Required Date Range"
"RTN","DGRPDT",47,0)
 Q:('$$VALID(FRDT)!'$$VALID(TODT)!'$$B4(FRDT,TODT)) "0^Invalid Date Range"
"RTN","DGRPDT",48,0)
 Q:('$$B4(FRDT,CHKDT,1)!'$$B4(CHKDT,TODT,1)) "0^Not Within Valid Date Range"
"RTN","DGRPDT",49,0)
 Q "1^Date is Within Date Range"
"RTN","DGRPDT",50,0)
 ;
"RTN","DGRPDT",51,0)
VALID(DATE) ; is this a valid Fileman date? (limits are from FR^XLFDT)
"RTN","DGRPDT",52,0)
 Q:'$D(DATE) 0
"RTN","DGRPDT",53,0)
 Q (1410102'>DATE)&(DATE'>4141015.235959)
"RTN","DGRPDT",54,0)
 ;
"RTN","DGRPDT",55,0)
B4(DATE1,DATE2,SAME) ;is DATE1 before DATE2?
"RTN","DGRPDT",56,0)
 N IMPRDT,X
"RTN","DGRPDT",57,0)
 S DATE1=$P($G(DATE1),"."),DATE2=$P($G(DATE2),".")
"RTN","DGRPDT",58,0)
 Q:DATE1=""!DATE2="" 1
"RTN","DGRPDT",59,0)
 I $G(SAME),DATE1=DATE2 Q 1
"RTN","DGRPDT",60,0)
 F X=DATE1,DATE2 I $$CHKEXC(X)'=111 S IMPRDT=1
"RTN","DGRPDT",61,0)
 I $G(IMPRDT),$E(DATE1,1,5)=$E(DATE2,1,5) Q 1
"RTN","DGRPDT",62,0)
 Q DATE1<DATE2
"RTN","DGRPDT",63,0)
 ;
"RTN","DGRPDT",64,0)
RWITHIN(FRDT,TODT,CHKDT1,CHKDT2) ;are CHKDT1 and CHKDT2 within FRDT and TODT?
"RTN","DGRPDT",65,0)
 ;
"RTN","DGRPDT",66,0)
 ; INPUT:  FRDT - Beginning of Date Range (Fileman Date format)
"RTN","DGRPDT",67,0)
 ;         TODT - End of Date Range (Fileman Date format)
"RTN","DGRPDT",68,0)
 ;       CHKDT1 - Beg Date to check within range (Fileman Date format)
"RTN","DGRPDT",69,0)
 ;       CHKDT2 - End Date to check within range (Fileman Date format)
"RTN","DGRPDT",70,0)
 ;
"RTN","DGRPDT",71,0)
 ; OUTPUT: 1st piece - within date range? (binary)
"RTN","DGRPDT",72,0)
 ;         2nd piece - Reason (for troubleshooting only)
"RTN","DGRPDT",73,0)
 ;
"RTN","DGRPDT",74,0)
 N CHK1,CHK2
"RTN","DGRPDT",75,0)
 S CHK1=$$WITHIN(.FRDT,.TODT,.CHKDT1) Q:'CHK1 CHK1
"RTN","DGRPDT",76,0)
 S CHK2=$$WITHIN(.FRDT,.TODT,.CHKDT2) Q:'CHK2 CHK2
"RTN","DGRPDT",77,0)
 Q "1^Both Date are Within Date Range"
"RTN","DGRPDT",78,0)
 ;
"RTN","DGRPDT",79,0)
COVRLP2(DFN,FRDT,TODT,IGNORE) ; check conflict with type 0 and 2 (see below)
"RTN","DGRPDT",80,0)
 ;
"RTN","DGRPDT",81,0)
 ;INPUT:   DFN - ien for the Patient file (#2)
"RTN","DGRPDT",82,0)
 ;        FRDT - From Date to check for overlap
"RTN","DGRPDT",83,0)
 ;        TODT - To Date to check for overlap
"RTN","DGRPDT",84,0)
 ;      IGNORE - field #(s) to ignore [optional- delimited by "^"]
"RTN","DGRPDT",85,0)
 ;
"RTN","DGRPDT",86,0)
 ;
"RTN","DGRPDT",87,0)
 ; OUTPUT: 1st piece - conflict ok? (binary)
"RTN","DGRPDT",88,0)
 ;         2nd piece - Reason (for troubleshooting only)
"RTN","DGRPDT",89,0)
 ;
"RTN","DGRPDT",90,0)
 Q:('$G(DFN))!('$D(^DPT(DFN))) "0^INVALID DFN"
"RTN","DGRPDT",91,0)
 S RTN=$$OVRLPCHK(DFN,.FRDT,.TODT,-1,$G(IGNORE))  ;check within MSE
"RTN","DGRPDT",92,0)
 Q:$P(RTN,"^")=0 RTN
"RTN","DGRPDT",93,0)
 S RTN=$$OVRLPCHK(DFN,.FRDT,.TODT,2,$G(IGNORE))  ;check overlap with other conflt
"RTN","DGRPDT",94,0)
 Q RTN
"RTN","DGRPDT",95,0)
 ;
"RTN","DGRPDT",96,0)
OVRLPCHK(DFN,FRDT,TODT,TYPE,IGNORE) ;check for overlapping date ranges
"RTN","DGRPDT",97,0)
 ;
"RTN","DGRPDT",98,0)
 ;INPUT:    DFN - ien for the Patient file (#2)
"RTN","DGRPDT",99,0)
 ;         FRDT - From Date to check for overlap
"RTN","DGRPDT",100,0)
 ;         TODT - To Date to check for overlap
"RTN","DGRPDT",101,0)
 ;         TYPE - type of date check (as listed below)
"RTN","DGRPDT",102,0)
 ;               -1 - CONFLICT WITHIN ANY MILITARY SERVICE EPISODE
"RTN","DGRPDT",103,0)
 ;                0 - CONFLICT WITHIN MILITARY SERVICE EPISODE (MSE)
"RTN","DGRPDT",104,0)
 ;                1 - MSE NOT OVERLAP WITH ANOTHER MSE
"RTN","DGRPDT",105,0)
 ;                2 - CONFLICT NOT OVERLAP WITH ANOTHER CONFLICT
"RTN","DGRPDT",106,0)
 ;       IGNORE - field #(s) to ignore [optional- delimited by "^"]
"RTN","DGRPDT",107,0)
 ;
"RTN","DGRPDT",108,0)
 ; OUTPUT: 1st piece - conflict ok? (binary)
"RTN","DGRPDT",109,0)
 ;         2nd piece - Reason (for troubleshooting only)
"RTN","DGRPDT",110,0)
 ;
"RTN","DGRPDT",111,0)
 N RTN1,DATA,NODE,RTN,FRDT1,MSG,SUBRNG,TODT1
"RTN","DGRPDT",112,0)
 Q:('$G(DFN))!('$D(^DPT(DFN))) "0^INVALID DFN"
"RTN","DGRPDT",113,0)
 I TYPE<2 S NODE(.32)=".326,.327,.3292,.3293,.3297,.3298"
"RTN","DGRPDT",114,0)
 E  S NODE(.321)=".32104,.32105",NODE(.322)=".3222,.3223,.3225,.3226,.3228,.3229,.322011,.322012,.322017,.322018,.32202,.322021",NODE(.52)=".5293,.5294"
"RTN","DGRPDT",115,0)
 D:$G(IGNORE)]"" IGNORE(.NODE,.IGNORE)
"RTN","DGRPDT",116,0)
 D GETDAT(DFN,.NODE,.DATA) Q:'$D(DATA) "1^CANNOT FIND PATIENT DATA"
"RTN","DGRPDT",117,0)
 Q:TYPE<0 $$MSEONLY(.DATA,FRDT,TODT)
"RTN","DGRPDT",118,0)
 S SUBRNG="" F  S SUBRNG=$O(DATA(SUBRNG)) Q:SUBRNG=""!($D(RTN))  D
"RTN","DGRPDT",119,0)
 .S FRDT1=$P(DATA(SUBRNG),"^"),TODT1=$P(DATA(SUBRNG),"^",2)
"RTN","DGRPDT",120,0)
 .I FRDT1="",TODT1="" Q
"RTN","DGRPDT",121,0)
 .;S:TODT1="" TODT1=$$DT^XLFDT
"RTN","DGRPDT",122,0)
 .I 'TYPE S:$$RWITHIN(FRDT1,TODT1,.FRDT,.TODT) RTN1=$G(RTN1)+1 Q
"RTN","DGRPDT",123,0)
 .S MSG=$S(TYPE=1:"Military Service Episode",1:"Conflict")
"RTN","DGRPDT",124,0)
 .I $$WITHIN(FRDT1,TODT1,.FRDT) S RTN="0^This "_MSG_" overlaps with another "_MSG
"RTN","DGRPDT",125,0)
 .I $$WITHIN(FRDT1,TODT1,.TODT) S RTN="0^This "_MSG_" overlaps with another "_MSG
"RTN","DGRPDT",126,0)
 .I $$RWITHIN(FRDT1,TODT1,.FRDT,.TODT) S RTN="0^This "_MSG_" is within another "_MSG
"RTN","DGRPDT",127,0)
 .I $$RWITHIN(.FRDT,.TODT,FRDT1,TODT1) S RTN="0^Another "_MSG_" is within this "_MSG
"RTN","DGRPDT",128,0)
 I ('TYPE),'$D(RTN1) Q "0^This conflict is not within a Military Service Episode"
"RTN","DGRPDT",129,0)
 Q:$D(RTN) RTN
"RTN","DGRPDT",130,0)
 Q "1^OK"
"RTN","DGRPDT",131,0)
 ;
"RTN","DGRPDT",132,0)
GETDAT(DFN,NODE,DATA) ;get data from the Patient (#2) file
"RTN","DGRPDT",133,0)
 ;
"RTN","DGRPDT",134,0)
 N LOOP,SUB,Z,TMPDAT,DATA1,ERR,DR
"RTN","DGRPDT",135,0)
 Q:('$D(NODE))!('$D(DFN))
"RTN","DGRPDT",136,0)
 S SUB="",Z=1
"RTN","DGRPDT",137,0)
 F  S SUB=$O(NODE(SUB)) Q:SUB=""  D
"RTN","DGRPDT",138,0)
 .S DR=$TR(NODE(SUB),",",";") Q:DR=""
"RTN","DGRPDT",139,0)
 .D GETS^DIQ(2,DFN_",",DR,"I","TMPDAT","ERR")
"RTN","DGRPDT",140,0)
 .S LOOP="F X="_$G(NODE(SUB))_" S DATA1(X)=$G(TMPDAT(2,DFN_"","",X,""I"")),Z=Z+1"
"RTN","DGRPDT",141,0)
 .X LOOP
"RTN","DGRPDT",142,0)
 ; military service info
"RTN","DGRPDT",143,0)
 S DATA("MSL")=$G(DATA1(.326))_"^"_$G(DATA1(.327))
"RTN","DGRPDT",144,0)
 S DATA("MSNL")=$G(DATA1(.3292))_"^"_$G(DATA1(.3293))
"RTN","DGRPDT",145,0)
 S DATA("MSNNL")=$G(DATA1(.3297))_"^"_$G(DATA1(.3298))
"RTN","DGRPDT",146,0)
 ; conflict info
"RTN","DGRPDT",147,0)
 S DATA("VIET")=$G(DATA1(.32104))_"^"_$G(DATA1(.32105))
"RTN","DGRPDT",148,0)
 S DATA("LEB")=$G(DATA1(.3222))_"^"_$G(DATA1(.3223))
"RTN","DGRPDT",149,0)
 S DATA("GREN")=$G(DATA1(.3225))_"^"_$G(DATA1(.3226))
"RTN","DGRPDT",150,0)
 S DATA("PAN")=$G(DATA1(.3228))_"^"_$G(DATA1(.3229))
"RTN","DGRPDT",151,0)
 S DATA("GULF")=$G(DATA1(.322011))_"^"_$G(DATA1(.322012))
"RTN","DGRPDT",152,0)
 S DATA("SOM")=$G(DATA1(.322017))_"^"_$G(DATA1(.322018))
"RTN","DGRPDT",153,0)
 S DATA("YUG")=$G(DATA1(.32202))_"^"_$G(DATA1(.322021))
"RTN","DGRPDT",154,0)
 S DATA("COMBAT")=$G(DATA1(.5294))_"^"_$G(DATA1(.5294))
"RTN","DGRPDT",155,0)
 Q
"RTN","DGRPDT",156,0)
 ;
"RTN","DGRPDT",157,0)
MSEONLY(DATA,FRDT,TODT) ; are these dats within the whole MSE period?
"RTN","DGRPDT",158,0)
 ;
"RTN","DGRPDT",159,0)
 N TO,FROM,SUBRNG,FRDT1,TODT1,MSEFR,MSETO
"RTN","DGRPDT",160,0)
 S SUBRNG="" F  S SUBRNG=$O(DATA(SUBRNG)) Q:SUBRNG=""  D
"RTN","DGRPDT",161,0)
 .S FRDT1=$P(DATA(SUBRNG),"^"),TODT1=$P(DATA(SUBRNG),"^",2)
"RTN","DGRPDT",162,0)
 .S:FRDT1 FROM(FRDT1)="" S:TODT1 TO(TODT1)=""
"RTN","DGRPDT",163,0)
 S MSEFR=$O(FROM("")),MSETO=$O(TO(""),-1)
"RTN","DGRPDT",164,0)
 I FRDT,'$$B4(MSEFR,FRDT,1) Q "0^Conflict From Date is Before the Earliest Military Service Episode"
"RTN","DGRPDT",165,0)
 I TODT,'$$B4(TODT,MSETO,1) Q "0^Conflict End Date is After the Latest Military Service Episode"
"RTN","DGRPDT",166,0)
 Q "1^OK"
"RTN","DGRPDT",167,0)
CNFLCTDT(FRDT,TODT,CNFLCT) ;are these dates valid for this conflict?
"RTN","DGRPDT",168,0)
 ;
"RTN","DGRPDT",169,0)
 ;INPUT:  FRDT - From Date to check for overlap
"RTN","DGRPDT",170,0)
 ;        TODT - To Date to check for overlap
"RTN","DGRPDT",171,0)
 ;      CNFLCT - conflict to check (acceptable values listed after the
"RTN","DGRPDT",172,0)
 ;               CNFLCT tag)
"RTN","DGRPDT",173,0)
 ;
"RTN","DGRPDT",174,0)
 ; OUTPUT: 1st piece - conflict ok? (binary)
"RTN","DGRPDT",175,0)
 ;         2nd piece - Reason (for troubleshooting only)
"RTN","DGRPDT",176,0)
 ;
"RTN","DGRPDT",177,0)
 Q:'$D(CNFLCT) "0^INVALID CONFLICT"
"RTN","DGRPDT",178,0)
 N CRNG
"RTN","DGRPDT",179,0)
 S CRNG=$$GETCNFDT(CNFLCT) Q:$TR(CRNG,"^")="" "0^INVALID CONFLICT"
"RTN","DGRPDT",180,0)
 Q:$P(CRNG,"^")=0 CRNG
"RTN","DGRPDT",181,0)
 I $G(FRDT)="" Q $$WITHIN($P(CRNG,"^"),$P(CRNG,"^",2),.TODT)_" for Conflict - "_$$FMTE^XLFDT($P(CRNG,"^"))_" through "_$$FMTE^XLFDT($P(CRNG,"^",2))
"RTN","DGRPDT",182,0)
 I $G(TODT)="" Q $$WITHIN($P(CRNG,"^"),$P(CRNG,"^",2),.FRDT)_" for Conflict - "_$$FMTE^XLFDT($P(CRNG,"^"))_" through "_$$FMTE^XLFDT($P(CRNG,"^",2))
"RTN","DGRPDT",183,0)
 Q $$RWITHIN($P(CRNG,"^"),$P(CRNG,"^",2),.FRDT,.TODT)_" for Conflict - "_$$FMTE^XLFDT($P(CRNG,"^"))_" through "_$$FMTE^XLFDT($P(CRNG,"^",2))
"RTN","DGRPDT",184,0)
 ;
"RTN","DGRPDT",185,0)
GETCNFDT(CNFLCT) ; get the date range for input conflict
"RTN","DGRPDT",186,0)
 ;
"RTN","DGRPDT",187,0)
 ;INPUT:
"RTN","DGRPDT",188,0)
 ;      CNFLCT - conflict to check (acceptable values listed after the
"RTN","DGRPDT",189,0)
 ;               CNFLCT tag)
"RTN","DGRPDT",190,0)
 ;
"RTN","DGRPDT",191,0)
 ;OUTPUT:
"RTN","DGRPDT",192,0)
 ;        error condition if "0^INVALID CONFLICT" otherwise
"RTN","DGRPDT",193,0)
 ;        1st piece = from date
"RTN","DGRPDT",194,0)
 ;        2nd piece = conflict to date (null if not yet ended)
"RTN","DGRPDT",195,0)
 ;
"RTN","DGRPDT",196,0)
 Q:'$D(CNFLCT) "0^INVALID CONFLICT"
"RTN","DGRPDT",197,0)
 N CRNG
"RTN","DGRPDT",198,0)
 S CRNG=$T(@(CNFLCT)) Q:CRNG']"" "0^INVALID CONFLICT"
"RTN","DGRPDT",199,0)
 S CRNG=$P(CRNG,";;",2) S:$P(CRNG,"^",2)="" $P(CRNG,"^",2)=$$DT^XLFDT
"RTN","DGRPDT",200,0)
 Q CRNG
"RTN","DGRPDT",201,0)
 ;
"RTN","DGRPDT",202,0)
IGNORE(NODE,IFLD) ; extract field to ignore when comparing
"RTN","DGRPDT",203,0)
 ;
"RTN","DGRPDT",204,0)
 N LOOP,QLOOP,RVAL,LSTPC,PC
"RTN","DGRPDT",205,0)
 S LOOP="",IFLD="^"_IFLD_"^"
"RTN","DGRPDT",206,0)
 F  S LOOP=$O(NODE(LOOP)) Q:LOOP=""  D
"RTN","DGRPDT",207,0)
 .I IFLD[("^"_$P(NODE(LOOP),",")_"^") S NODE(LOOP)=$P(NODE(LOOP),",",2,99),LOOP="" Q
"RTN","DGRPDT",208,0)
 .S LSTPC=$L($TR(NODE(LOOP),".0123456789"))+1
"RTN","DGRPDT",209,0)
 .I IFLD[("^"_$P(NODE(LOOP),",",LSTPC)_"^") S NODE(LOOP)=$P(NODE(LOOP),",",1,LSTPC-1),LOOP="" Q
"RTN","DGRPDT",210,0)
 .F PC=1:1:LSTPC Q:$G(QLOOP)  I IFLD[("^"_$P(NODE(LOOP),",",PC)_"^") S NODE(LOOP)=$P(NODE(LOOP),",",1,PC-1)_","_$P(NODE(LOOP),",",PC+1,99),LOOP="" Q
"RTN","DGRPDT",211,0)
 Q
"RTN","DGRPDT",212,0)
CNFLCT ;; ***  DO NOT REMOVE OR CHANGE BELOW CONFLICT VALUES  ***
"RTN","DGRPDT",213,0)
 ;;
"RTN","DGRPDT",214,0)
WWI ;;2170401^2181111
"RTN","DGRPDT",215,0)
WWIIE ;;2411211^2450508
"RTN","DGRPDT",216,0)
WWIIP ;;2411207^2450815
"RTN","DGRPDT",217,0)
KOR ;;2500627^2550131
"RTN","DGRPDT",218,0)
VIET ;;2610228^2750507
"RTN","DGRPDT",219,0)
LEB ;;2831001^
"RTN","DGRPDT",220,0)
GREN ;;2831023^2831121
"RTN","DGRPDT",221,0)
PAN ;;2891220^2900131
"RTN","DGRPDT",222,0)
GULF ;;2900802^
"RTN","DGRPDT",223,0)
SOM ;;2920928^
"RTN","DGRPDT",224,0)
YUG ;;2920622^
"RTN","DGRPDT",225,0)
OTHER ;;^
"VER")
8.0^22
**END**
**END**
