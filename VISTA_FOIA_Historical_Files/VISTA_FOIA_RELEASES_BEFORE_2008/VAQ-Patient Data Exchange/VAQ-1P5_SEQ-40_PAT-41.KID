Released VAQ*1.5*41 SEQ #40
Extracted from mail message
**KIDS**:VAQ*1.5*41^

**INSTALL NAME**
VAQ*1.5*41
"BLD",1086,0)
VAQ*1.5*41^PATIENT DATA EXCHANGE^0^3050614^y
"BLD",1086,1,0)
^^2^2^3050614^
"BLD",1086,1,1,0)
Patch VAQ*1.5*41. Please refere to the Description in Forum Patch Module 
"BLD",1086,1,2,0)
for details.
"BLD",1086,4,0)
^9.64PA^^
"BLD",1086,"ABPKG")
n
"BLD",1086,"INI")

"BLD",1086,"INIT")

"BLD",1086,"KRN",0)
^9.67PA^8989.52^19
"BLD",1086,"KRN",.4,0)
.4
"BLD",1086,"KRN",.401,0)
.401
"BLD",1086,"KRN",.402,0)
.402
"BLD",1086,"KRN",.403,0)
.403
"BLD",1086,"KRN",.5,0)
.5
"BLD",1086,"KRN",.84,0)
.84
"BLD",1086,"KRN",3.6,0)
3.6
"BLD",1086,"KRN",3.8,0)
3.8
"BLD",1086,"KRN",9.2,0)
9.2
"BLD",1086,"KRN",9.8,0)
9.8
"BLD",1086,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1086,"KRN",9.8,"NM",1,0)
VAQDBIP6^^0^B25574352
"BLD",1086,"KRN",9.8,"NM","B","VAQDBIP6",1)

"BLD",1086,"KRN",19,0)
19
"BLD",1086,"KRN",19.1,0)
19.1
"BLD",1086,"KRN",101,0)
101
"BLD",1086,"KRN",409.61,0)
409.61
"BLD",1086,"KRN",771,0)
771
"BLD",1086,"KRN",870,0)
870
"BLD",1086,"KRN",8989.51,0)
8989.51
"BLD",1086,"KRN",8989.52,0)
8989.52
"BLD",1086,"KRN",8994,0)
8994
"BLD",1086,"KRN","B",.4,.4)

"BLD",1086,"KRN","B",.401,.401)

"BLD",1086,"KRN","B",.402,.402)

"BLD",1086,"KRN","B",.403,.403)

"BLD",1086,"KRN","B",.5,.5)

"BLD",1086,"KRN","B",.84,.84)

"BLD",1086,"KRN","B",3.6,3.6)

"BLD",1086,"KRN","B",3.8,3.8)

"BLD",1086,"KRN","B",9.2,9.2)

"BLD",1086,"KRN","B",9.8,9.8)

"BLD",1086,"KRN","B",19,19)

"BLD",1086,"KRN","B",19.1,19.1)

"BLD",1086,"KRN","B",101,101)

"BLD",1086,"KRN","B",409.61,409.61)

"BLD",1086,"KRN","B",771,771)

"BLD",1086,"KRN","B",870,870)

"BLD",1086,"KRN","B",8989.51,8989.51)

"BLD",1086,"KRN","B",8989.52,8989.52)

"BLD",1086,"KRN","B",8994,8994)

"BLD",1086,"QUES",0)
^9.62^^
"BLD",1086,"REQB",0)
^9.611^1^1
"BLD",1086,"REQB",1,0)
SD*5.3*301^1
"BLD",1086,"REQB","B","SD*5.3*301",1)

"MBREQ")
0
"PKG",186,-1)
1^1
"PKG",186,0)
PATIENT DATA EXCHANGE^VAQ^Module used to manage patient information exchange
"PKG",186,20,0)
^9.402P^^
"PKG",186,22,0)
^9.49I^1^1
"PKG",186,22,1,0)
1.5^2931117^2941017
"PKG",186,22,1,"PAH",1,0)
41^3050614
"PKG",186,22,1,"PAH",1,1,0)
^^2^2^3050614
"PKG",186,22,1,"PAH",1,1,1,0)
Patch VAQ*1.5*41. Please refere to the Description in Forum Patch Module 
"PKG",186,22,1,"PAH",1,1,2,0)
for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","VAQDBIP6")
0^1^B25574352
"RTN","VAQDBIP6",1,0)
VAQDBIP6 ;ALB/JRP - CONTINUATIONS FOR VAQDBIP4;25-MAR-93
"RTN","VAQDBIP6",2,0)
 ;;1.5;PATIENT DATA EXCHANGE;**41**;NOV 17, 1993
"RTN","VAQDBIP6",3,0)
ELIG ;EXTRACT ELIGIBILITIES
"RTN","VAQDBIP6",4,0)
 ;  DECLARATIONS TAKEN CARE OF IN VAQDBIP4
"RTN","VAQDBIP6",5,0)
 S TMP=$T(ELIG+1^VAQDBII1)
"RTN","VAQDBIP6",6,0)
 S FLDS=$TR($P(TMP,";",4),",",";")
"RTN","VAQDBIP6",7,0)
 ;ENCRYPT PATIENT NAME
"RTN","VAQDBIP6",8,0)
 S STRING=$P($$PATINFO^VAQUTL1(DFN),"^",1)
"RTN","VAQDBIP6",9,0)
 S ENCSTR=STRING
"RTN","VAQDBIP6",10,0)
 I $$NCRPFLD^VAQUTL2(2,.01) X ENCRYPT
"RTN","VAQDBIP6",11,0)
 S NAME=ENCSTR
"RTN","VAQDBIP6",12,0)
 ;DETERMINE PRIMARY ELIGIBILITY
"RTN","VAQDBIP6",13,0)
 S DIC="^DPT("
"RTN","VAQDBIP6",14,0)
 S DA=DFN
"RTN","VAQDBIP6",15,0)
 S DR=.361
"RTN","VAQDBIP6",16,0)
 S DIQ(0)="E"
"RTN","VAQDBIP6",17,0)
 K ^UTILITY("DIQ1",$J)
"RTN","VAQDBIP6",18,0)
 D EN^DIQ1
"RTN","VAQDBIP6",19,0)
 S PRIME=$G(^UTILITY("DIQ1",$J,2,DFN,.361,"E"))
"RTN","VAQDBIP6",20,0)
 ;GET OTHER ELIGIBILITIES
"RTN","VAQDBIP6",21,0)
 S TMP=0
"RTN","VAQDBIP6",22,0)
 F  S TMP=$O(^DPT(DFN,"E",TMP)) Q:('TMP)  D
"RTN","VAQDBIP6",23,0)
 .S DIC="^DPT("
"RTN","VAQDBIP6",24,0)
 .S DA=DFN
"RTN","VAQDBIP6",25,0)
 .S DR=361
"RTN","VAQDBIP6",26,0)
 .S DIQ(0)="E"
"RTN","VAQDBIP6",27,0)
 .S DA(2.0361)=TMP
"RTN","VAQDBIP6",28,0)
 .S DR(2.0361)=FLDS
"RTN","VAQDBIP6",29,0)
 .K ^UTILITY("DIQ1",$J)
"RTN","VAQDBIP6",30,0)
 .D EN^DIQ1
"RTN","VAQDBIP6",31,0)
 .;SCREEN OUT PRIMARY ELIGIBILITY
"RTN","VAQDBIP6",32,0)
 .S Y=$G(^UTILITY("DIQ1",$J,2.0361,DA(2.0361),.01,"E"))
"RTN","VAQDBIP6",33,0)
 .Q:(Y=PRIME)
"RTN","VAQDBIP6",34,0)
 .S SEQ=$$GETSEQ^VAQDBIP(ARRAY,2.0361,.01)
"RTN","VAQDBIP6",35,0)
 .;ENCRYPT VALUE
"RTN","VAQDBIP6",36,0)
 .S STRING=Y
"RTN","VAQDBIP6",37,0)
 .S ENCSTR=STRING
"RTN","VAQDBIP6",38,0)
 .I $$NCRPFLD^VAQUTL2(2.0361,.01) X ENCRYPT
"RTN","VAQDBIP6",39,0)
 .S @ARRAY@("ID",2.0361,.01,SEQ)=NAME
"RTN","VAQDBIP6",40,0)
 .S @ARRAY@("VALUE",2.0361,.01,SEQ)=ENCSTR
"RTN","VAQDBIP6",41,0)
 .S Y=ENCSTR
"RTN","VAQDBIP6",42,0)
 .;MOVE INFORMATION INTO EXTRACTION ARRAY
"RTN","VAQDBIP6",43,0)
 .F X=1:1:$L(FLDS,";") D
"RTN","VAQDBIP6",44,0)
 ..S Z=$P(FLDS,";",X)
"RTN","VAQDBIP6",45,0)
 ..;STORE ID
"RTN","VAQDBIP6",46,0)
 ..S @ARRAY@("ID",2.0361,Z,SEQ)=Y
"RTN","VAQDBIP6",47,0)
 ..;ENCRYPT VALUE
"RTN","VAQDBIP6",48,0)
 ..S STRING=$G(^UTILITY("DIQ1",$J,2.0361,DA(2.0361),Z,"E"))
"RTN","VAQDBIP6",49,0)
 ..S ENCSTR=STRING
"RTN","VAQDBIP6",50,0)
 ..I $$NCRPFLD^VAQUTL2(2.0361,Z) X ENCRYPT
"RTN","VAQDBIP6",51,0)
 ..S @ARRAY@("VALUE",2.0361,Z,SEQ)=ENCSTR
"RTN","VAQDBIP6",52,0)
 .K ^UTILITY("DIQ1",$J)
"RTN","VAQDBIP6",53,0)
 Q
"RTN","VAQDBIP6",54,0)
 ;
"RTN","VAQDBIP6",55,0)
APPOINT ;EXTRACT APPOINTMENTS
"RTN","VAQDBIP6",56,0)
 N VAQDT
"RTN","VAQDBIP6",57,0)
 ;  DECLARATIONS TAKEN CARE OF IN VAQDBIP4
"RTN","VAQDBIP6",58,0)
 S TMP=$T(APPOINT+1^VAQDBII1)
"RTN","VAQDBIP6",59,0)
 S FLDS=$TR($P(TMP,";",4),",",";")
"RTN","VAQDBIP6",60,0)
 ;ENCRYPT PATIENT NAME
"RTN","VAQDBIP6",61,0)
 S STRING=$P($$PATINFO^VAQUTL1(DFN),"^",1)
"RTN","VAQDBIP6",62,0)
 S ENCSTR=STRING
"RTN","VAQDBIP6",63,0)
 I $$NCRPFLD^VAQUTL2(2,.01) X ENCRYPT
"RTN","VAQDBIP6",64,0)
 S NAME=ENCSTR
"RTN","VAQDBIP6",65,0)
 D APPGET ; Get last 5 appointments
"RTN","VAQDBIP6",66,0)
 S VAQDT="" ; Process in reverse order
"RTN","VAQDBIP6",67,0)
 F VAQDT=$O(^UTILITY("DIQ1",$J,2.98,VAQDT),-1) Q:VAQDT=""  D
"RTN","VAQDBIP6",68,0)
 .S Y=VAQDT D DD^%DT
"RTN","VAQDBIP6",69,0)
 .S SEQ=$$GETSEQ^VAQDBIP(ARRAY,2.98,.001)
"RTN","VAQDBIP6",70,0)
 .;ENCRYPT VALUE
"RTN","VAQDBIP6",71,0)
 .S STRING=Y
"RTN","VAQDBIP6",72,0)
 .S ENCSTR=STRING
"RTN","VAQDBIP6",73,0)
 .I $$NCRPFLD^VAQUTL2(2.98,.001) X ENCRYPT
"RTN","VAQDBIP6",74,0)
 .S @ARRAY@("ID",2.98,.001,SEQ)=NAME
"RTN","VAQDBIP6",75,0)
 .S @ARRAY@("VALUE",2.98,.001,SEQ)=ENCSTR
"RTN","VAQDBIP6",76,0)
 .S Y=ENCSTR
"RTN","VAQDBIP6",77,0)
 .;MOVE INFORMATION INTO EXTRACTION ARRAY
"RTN","VAQDBIP6",78,0)
 .F X=1:1:$L(FLDS,";") D
"RTN","VAQDBIP6",79,0)
 ..S Z=$P(FLDS,";",X)
"RTN","VAQDBIP6",80,0)
 ..;STORE ID
"RTN","VAQDBIP6",81,0)
 ..S @ARRAY@("ID",2.98,Z,SEQ)=Y
"RTN","VAQDBIP6",82,0)
 ..;ENCRYPT VALUE
"RTN","VAQDBIP6",83,0)
 ..S STRING=$G(^UTILITY("DIQ1",$J,2.98,VAQDT,Z,"E"))
"RTN","VAQDBIP6",84,0)
 ..S ENCSTR=STRING
"RTN","VAQDBIP6",85,0)
 ..I $$NCRPFLD^VAQUTL2(2.98,Z) X ENCRYPT
"RTN","VAQDBIP6",86,0)
 ..S @ARRAY@("VALUE",2.98,Z,SEQ)=ENCSTR
"RTN","VAQDBIP6",87,0)
 K ^UTILITY("DIQ1",$J)
"RTN","VAQDBIP6",88,0)
 Q
"RTN","VAQDBIP6",89,0)
APPGET ; Get last 5 appointments.
"RTN","VAQDBIP6",90,0)
 ; Prior to patch *41, we retrieved data directly from the APPOINTMENTS
"RTN","VAQDBIP6",91,0)
 ; subfile (#2.98) of the PATIENT file.  Now, we retrieve using the new
"RTN","VAQDBIP6",92,0)
 ; Scheduling Replacement API from a central database.
"RTN","VAQDBIP6",93,0)
 ; Fields requested:
"RTN","VAQDBIP6",94,0)
 ;  Old  Description       New
"RTN","VAQDBIP6",95,0)
 ;  ---  ----------------  ---
"RTN","VAQDBIP6",96,0)
 ; .001  Appt date/time      1
"RTN","VAQDBIP6",97,0)
 ;  .01  Clinic              2
"RTN","VAQDBIP6",98,0)
 ;    3  Status              3
"RTN","VAQDBIP6",99,0)
 ;    9  Purpose of Visit   18
"RTN","VAQDBIP6",100,0)
 ;  9.5  Appt type          10
"RTN","VAQDBIP6",101,0)
 N X,VAQSD,VAQDT,VAQREC
"RTN","VAQDBIP6",102,0)
 S VAQSD(4)=DFN
"RTN","VAQDBIP6",103,0)
 S VAQSD("FLDS")="1;2;3;18;10"
"RTN","VAQDBIP6",104,0)
 S VAQSD("SORT")="P" ; Sort by patient only (not clinic)
"RTN","VAQDBIP6",105,0)
 S VAQSD("MAX")=-5 ; Return last 5 appts.
"RTN","VAQDBIP6",106,0)
 S X=$$SDAPI^SDAMA301(.VAQSD)
"RTN","VAQDBIP6",107,0)
 ; For each of the last 5 appts, move to Utility global,
"RTN","VAQDBIP6",108,0)
 ; with VAQDT being the date/time of the appt.
"RTN","VAQDBIP6",109,0)
 K ^UTILITY("DIQ1",$J)
"RTN","VAQDBIP6",110,0)
 S VAQDT=""
"RTN","VAQDBIP6",111,0)
 F  S VAQDT=$O(^TMP($J,"SDAMA301",DFN,VAQDT)) Q:VAQDT=""  S VAQREC=^(VAQDT) D
"RTN","VAQDBIP6",112,0)
 . S ^UTILITY("DIQ1",$J,2.98,VAQDT,.01,"E")=$P($P(VAQREC,U,2),";",2)
"RTN","VAQDBIP6",113,0)
 . S ^UTILITY("DIQ1",$J,2.98,VAQDT,3,"E")=$P($P(VAQREC,U,3),";",2)
"RTN","VAQDBIP6",114,0)
 . S ^UTILITY("DIQ1",$J,2.98,VAQDT,9,"E")=$P($P(VAQREC,U,18),";",2)
"RTN","VAQDBIP6",115,0)
 . S ^UTILITY("DIQ1",$J,2.98,VAQDT,9.5,"E")=$P($P(VAQREC,U,10),";",2)
"RTN","VAQDBIP6",116,0)
 K ^TMP($J,"SDAMA301")
"RTN","VAQDBIP6",117,0)
 Q
"RTN","VAQDBIP6",118,0)
 ;
"RTN","VAQDBIP6",119,0)
DENTAL ;EXTRACT DENTAL APPOINTMENTS
"RTN","VAQDBIP6",120,0)
 ;  DECLARATIONS TAKEN CARE OF IN VAQDBIP4
"RTN","VAQDBIP6",121,0)
 S TMP=$T(DENTAL+1^VAQDBII1)
"RTN","VAQDBIP6",122,0)
 S FLDS=$TR($P(TMP,";",4),",",";")
"RTN","VAQDBIP6",123,0)
 ;ENCRYPT PATIENT NAME
"RTN","VAQDBIP6",124,0)
 S STRING=$P($$PATINFO^VAQUTL1(DFN),"^",1)
"RTN","VAQDBIP6",125,0)
 S ENCSTR=STRING
"RTN","VAQDBIP6",126,0)
 I $$NCRPFLD^VAQUTL2(2,.01) X ENCRYPT
"RTN","VAQDBIP6",127,0)
 S NAME=ENCSTR
"RTN","VAQDBIP6",128,0)
 ;PUT DENTAL APPOINTMENTS IN REVERS ORDER
"RTN","VAQDBIP6",129,0)
 S TMP=0
"RTN","VAQDBIP6",130,0)
 K ^TMP("VAQ",$J,$J)
"RTN","VAQDBIP6",131,0)
 F  S TMP=$O(^DPT(DFN,.37,TMP)) Q:('TMP)  D
"RTN","VAQDBIP6",132,0)
 .S X=+$G(^DPT(DFN,.37,TMP,0))
"RTN","VAQDBIP6",133,0)
 .Q:('X)
"RTN","VAQDBIP6",134,0)
 .S ^TMP("VAQ",$J,$J,(9999999-X))=TMP_"^"_X
"RTN","VAQDBIP6",135,0)
 S TMP=""
"RTN","VAQDBIP6",136,0)
 ;EXTRACT 5 DENTAL APPOINTMENTS
"RTN","VAQDBIP6",137,0)
 F LOOP=1:1:5 S TMP=$O(^TMP("VAQ",$J,$J,TMP)) Q:(TMP="")  D
"RTN","VAQDBIP6",138,0)
 .S DIC="^DPT("
"RTN","VAQDBIP6",139,0)
 .S DA=DFN
"RTN","VAQDBIP6",140,0)
 .S DR=.37
"RTN","VAQDBIP6",141,0)
 .S DIQ(0)="E"
"RTN","VAQDBIP6",142,0)
 .S DA(2.11)=+^TMP("VAQ",$J,$J,TMP)
"RTN","VAQDBIP6",143,0)
 .S DR(2.11)=FLDS
"RTN","VAQDBIP6",144,0)
 .K ^UTILITY("DIQ1",$J)
"RTN","VAQDBIP6",145,0)
 .D EN^DIQ1
"RTN","VAQDBIP6",146,0)
 .;MOVE DATE OF DENTAL APPOINTMENT INTO EXTRACTION ARRAY
"RTN","VAQDBIP6",147,0)
 .S Y=+$P(^TMP("VAQ",$J,$J,TMP),"^",2) D DD^%DT
"RTN","VAQDBIP6",148,0)
 .S SEQ=$$GETSEQ^VAQDBIP(ARRAY,2.11,.01)
"RTN","VAQDBIP6",149,0)
 .;ENCRYPT VALUE
"RTN","VAQDBIP6",150,0)
 .S STRING=Y
"RTN","VAQDBIP6",151,0)
 .S ENCSTR=STRING
"RTN","VAQDBIP6",152,0)
 .I $$NCRPFLD^VAQUTL2(2.11,.01) X ENCRYPT
"RTN","VAQDBIP6",153,0)
 .S @ARRAY@("ID",2.11,.01,SEQ)=NAME
"RTN","VAQDBIP6",154,0)
 .S @ARRAY@("VALUE",2.11,.01,SEQ)=ENCSTR
"RTN","VAQDBIP6",155,0)
 .S Y=STRING
"RTN","VAQDBIP6",156,0)
 .;MOVE INFO INTO EXTRACTION ARRAY
"RTN","VAQDBIP6",157,0)
 .F X=1:1:$L(FLDS,";") D
"RTN","VAQDBIP6",158,0)
 ..S Z=$P(FLDS,";",X)
"RTN","VAQDBIP6",159,0)
 ..Q:(Z=.01)
"RTN","VAQDBIP6",160,0)
 ..;STORE ID
"RTN","VAQDBIP6",161,0)
 ..S @ARRAY@("ID",2.11,Z,SEQ)=Y
"RTN","VAQDBIP6",162,0)
 ..;ENCRYPT VALUE
"RTN","VAQDBIP6",163,0)
 ..S STRING=$G(^UTILITY("DIQ1",$J,2.11,DA(2.11),Z,"E"))
"RTN","VAQDBIP6",164,0)
 ..S ENCSTR=STRING
"RTN","VAQDBIP6",165,0)
 ..I $$NCRPFLD^VAQUTL2(2.11,Z) X ENCRYPT
"RTN","VAQDBIP6",166,0)
 ..S @ARRAY@("VALUE",2.11,Z,SEQ)=ENCSTR
"RTN","VAQDBIP6",167,0)
 .K ^UTILITY("DIQ1",$J)
"RTN","VAQDBIP6",168,0)
 K ^TMP("VAQ",$J,$J)
"RTN","VAQDBIP6",169,0)
 Q
"VER")
8.0^22.0
"BLD",1086,6)
^SEQ #40
**END**
**END**
