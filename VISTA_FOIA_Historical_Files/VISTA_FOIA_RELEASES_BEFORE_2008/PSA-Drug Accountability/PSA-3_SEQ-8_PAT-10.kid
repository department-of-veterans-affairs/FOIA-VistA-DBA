Released PSA*3*10 SEQ #8
Extracted from mail message
**KIDS**:PSA*3.0*10^

**INSTALL NAME**
PSA*3.0*10
"BLD",560,0)
PSA*3.0*10^DRUG ACCOUNTABILITY^0^2981229^y
"BLD",560,1,0)
^^6^6^2990208^^^^
"BLD",560,1,1,0)
When the Receiving Directly into Drug Accountability [PSA RECEIVING]
"BLD",560,1,2,0)
option is used, the following error occurs:
"BLD",560,1,3,0)
$ZE= HEADER+3^PSAREPV:3, %DSM-E-UNDEF, undefined variable PSA(2)
"BLD",560,1,4,0)
 
"BLD",560,1,5,0)
Also, the problem of not being able to enter decimal digits for the
"BLD",560,1,6,0)
dispense units per order unit has been corrected.
"BLD",560,"KRN",0)
^9.67PA^^
"BLD",560,"KRN",.4,0)
.4
"BLD",560,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",560,"KRN",.401,0)
.401
"BLD",560,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",560,"KRN",.402,0)
.402
"BLD",560,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",560,"KRN",.403,0)
.403
"BLD",560,"KRN",.5,0)
.5
"BLD",560,"KRN",.84,0)
.84
"BLD",560,"KRN",3.6,0)
3.6
"BLD",560,"KRN",3.8,0)
3.8
"BLD",560,"KRN",9.2,0)
9.2
"BLD",560,"KRN",9.8,0)
9.8
"BLD",560,"KRN",9.8,"NM",0)
^9.68A^^0
"BLD",560,"KRN",9.8,"NM",1,0)
PSAREC^^0^B38750885
"BLD",560,"KRN",9.8,"NM","B","PSAREC",1)

"BLD",560,"KRN",19,0)
19
"BLD",560,"KRN",19.1,0)
19.1
"BLD",560,"KRN",101,0)
101
"BLD",560,"KRN",409.61,0)
409.61
"BLD",560,"KRN",771,0)
771
"BLD",560,"KRN",869.2,0)
869.2
"BLD",560,"KRN",870,0)
870
"BLD",560,"KRN",8994,0)
8994
"BLD",560,"KRN","B",.4,.4)

"BLD",560,"KRN","B",.401,.401)

"BLD",560,"KRN","B",.402,.402)

"BLD",560,"KRN","B",.403,.403)

"BLD",560,"KRN","B",.5,.5)

"BLD",560,"KRN","B",.84,.84)

"BLD",560,"KRN","B",3.6,3.6)

"BLD",560,"KRN","B",3.8,3.8)

"BLD",560,"KRN","B",9.2,9.2)

"BLD",560,"KRN","B",9.8,9.8)

"BLD",560,"KRN","B",19,19)

"BLD",560,"KRN","B",19.1,19.1)

"BLD",560,"KRN","B",101,101)

"BLD",560,"KRN","B",409.61,409.61)

"BLD",560,"KRN","B",771,771)

"BLD",560,"KRN","B",869.2,869.2)

"BLD",560,"KRN","B",870,870)

"BLD",560,"KRN","B",8994,8994)

"BLD",560,"QUES",0)
^9.62^^
"BLD",560,"REQG",0)
^9.611^^
"PKG",182,-1)
1^1
"PKG",182,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability/Inventory Interface^
"PKG",182,20,0)
^9.402P^^0
"PKG",182,22,0)
^9.49I^1^1
"PKG",182,22,1,0)
3.0^2971024^2970912^531
"PKG",182,22,1,"PAH",1,0)
10^2981229
"PKG",182,22,1,"PAH",1,1,0)
^^6^6^2990208
"PKG",182,22,1,"PAH",1,1,1,0)
When the Receiving Directly into Drug Accountability [PSA RECEIVING]
"PKG",182,22,1,"PAH",1,1,2,0)
option is used, the following error occurs:
"PKG",182,22,1,"PAH",1,1,3,0)
$ZE= HEADER+3^PSAREPV:3, %DSM-E-UNDEF, undefined variable PSA(2)
"PKG",182,22,1,"PAH",1,1,4,0)
 
"PKG",182,22,1,"PAH",1,1,5,0)
Also, the problem of not being able to enter decimal digits for the
"PKG",182,22,1,"PAH",1,1,6,0)
dispense units per order unit has been corrected.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSAREC")
0^1^B38750885
"RTN","PSAREC",1,0)
PSAREC ;BIR/LTL,JMB-Receiving Directly into Drug Accountability ;7/23/97
"RTN","PSAREC",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**10**; 10/24/97
"RTN","PSAREC",3,0)
 ;This routine receives non-prime vendor's drugs into pharmacy locations.
"RTN","PSAREC",4,0)
 ;The balances are incremented in the pharmacy location & the DRUG file.
"RTN","PSAREC",5,0)
 ;
"RTN","PSAREC",6,0)
SETUP S (PSACNT,PSAOUT)=0 D ^PSAUTL3 G:PSAOUT EXIT
"RTN","PSAREC",7,0)
 S PSACHK=$O(PSALOC(""))
"RTN","PSAREC",8,0)
 I PSACHK="",'PSALOC W !,"There are no active pharmacy locations." G EXIT
"RTN","PSAREC",9,0)
 S PSAPO=$P($G(^PSD(58.8,+PSALOC,0)),"^",9)
"RTN","PSAREC",10,0)
 I +$E($P($G(^PRC(442,+PSAPO,12)),"^",5),4,5)'=+$E(DT,4,5) W !!,"The current PO# for this location doesn't seem current.",! D  G:$D(DIRUT) EXIT
"RTN","PSAREC",11,0)
 .S DIR(0)="Y",DIR("A")="Would you like to correct it",DIR("B")="No",DIR("?")="You can store a obligation number and it will be presented as the default.",DIR("??")="^D CORRECT^PSAREC"
"RTN","PSAREC",12,0)
 .D ^DIR K DIR Q:$D(DIRUT)!(Y<1)
"RTN","PSAREC",13,0)
 .S DIE="^PSD(58.8,",DA=PSALOC,DR="13" D ^DIE K DIE
"RTN","PSAREC",14,0)
 .S DIC("B")=$P($G(^PRC(442,+$P($G(^PSD(58.8,+PSALOC,0)),"^",9),0)),"^")
"RTN","PSAREC",15,0)
PO S PSAOUT=0 W ! S DIC="^PRC(442,",DIC(0)="AEMQZ"
"RTN","PSAREC",16,0)
 S DIC("A")="Select Obligation Number: ",DIC("S")="I $P($G(^(0)),""^"",5)[822400" D ^DIC K DIC G:Y<1 EXIT S PSAPO=+Y,PSACON=$P($G(Y(0)),"^",12)
"RTN","PSAREC",17,0)
 S DIE="^PSD(58.8,",DA=PSALOC,DR="13///^S X="+PSAPO D ^DIE K DIE
"RTN","PSAREC",18,0)
PART D START G PO
"RTN","PSAREC",19,0)
 ;
"RTN","PSAREC",20,0)
EXIT K %,DA,DIE,DINUM,DIRUT,DR,DTOUT,DUOUT,PSA,PSA50SYN,PSACBAL,PSACHK,PSACNT,PSACOMB,PSACON,PSACOST,PSADASH,PSADRG,PSADRGN,PSADT,PSADUOU
"RTN","PSAREC",21,0)
 K PSAIEN,PSAIEN1,PSAISIT,PSAISITN,PSALEN,PSALINE,PSALOC,PSALOCN,PSANDC,PSANODE,PSANPDU,PSANPOU,PSAODASH,PSAONDC,PSAOSIT,PSAOSITN,PSAOU,PSAOUT
"RTN","PSAREC",22,0)
 K PSAPDU,PSAPO,PSAPOU,PSA(2),PSAREC,PSASEL,PSAT,PSATDRG,PSAVEND,X,Y
"RTN","PSAREC",23,0)
 Q
"RTN","PSAREC",24,0)
 ;
"RTN","PSAREC",25,0)
START S DIC="^PRCS(410,",DIC(0)="AEMQZ",DIC("A")="Select Pharmacy Transaction number: ",DIC("B")=$S($D(PSACON):$P($G(^PRCS(410,+PSACON,0)),"^"),1:""),DIC("S")="I $P($G(^(0)),""^"",2)=""O"",$P($G(^(3)),""^"",3)[822400"
"RTN","PSAREC",26,0)
 D ^DIC K DIC Q:Y<1  S PSACON=$S(Y>0:+Y,1:"")
"RTN","PSAREC",27,0)
 S DIR(0)="58.81,71O",DIR("A")="Invoice number",DIR("?")="The invoice will be stored, allowing look-ups for receipts against this invoice.",DIR("??")="^D INV^PSAREC"
"RTN","PSAREC",28,0)
 D ^DIR K DIR Q:Y'=""&($D(DIRUT))  S PSA(2)=Y
"RTN","PSAREC",29,0)
 I $G(PSA(2))'="",$O(^PSD(58.81,"PV",Y,"")) D  Q:$D(DIRUT)  G:Y=1 DEV^PSAREPV
"RTN","PSAREC",30,0)
 .W !!,"Previous receipts have been processed for this invoice.",!! S DIR(0)="Y",DIR("A")="Would you like to review",DIR("B")="Yes" D ^DIR K DIR
"RTN","PSAREC",31,0)
 ;
"RTN","PSAREC",32,0)
DRUG W !!,$G(PSALOCN),!
"RTN","PSAREC",33,0)
 F  S DIC="^PSDRUG(",DIC(0)="AEMQ",DA(1)=PSALOC D  Q:PSAOUT
"RTN","PSAREC",34,0)
 .D ^DIC K DIC I Y<0 S PSAOUT=1 Q
"RTN","PSAREC",35,0)
 .D GETDATA Q:$G(PSAOUT)
"RTN","PSAREC",36,0)
 Q
"RTN","PSAREC",37,0)
 ;
"RTN","PSAREC",38,0)
GETDATA ;Gets receipts data
"RTN","PSAREC",39,0)
 S PSADRG=+Y,PSADRGN=$P($G(^PSDRUG(+Y,0)),"^"),PSACBAL=$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",4)
"RTN","PSAREC",40,0)
NDC S DIR(0)="FO^1:15",DIR("A")="NDC",DIR("?")="Enter the National Drug Code for the drug received.",DIR("??")="^D NDCHELP^PSAREC"
"RTN","PSAREC",41,0)
 D ^DIR K DIR
"RTN","PSAREC",42,0)
 I $G(DIRUT) S (PSADASH,PSADUOU,PSANDC,PSAOU,PSAPOU)="",PSA50SYN=0 G OU
"RTN","PSAREC",43,0)
 S:Y'="" PSADASH=Y
"RTN","PSAREC",44,0)
 I PSADASH["-" S PSANDC=$E("000000",1,(6-$L($P(PSADASH,"-"))))_$P(PSADASH,"-")_$E("0000",1,(4-$L($P(PSADASH,"-",2))))_$P(PSADASH,"-",2)_$E("00",1,(2-$L($P(PSADASH,"-",3))))_$P(PSADASH,"-",3)
"RTN","PSAREC",45,0)
 E  S PSANDC=""
"RTN","PSAREC",46,0)
 S:PSANDC'?12N PSANDC="" S (PSAOU,PSADUOU,PSAPOU)=""
"RTN","PSAREC",47,0)
 I PSANDC'="",$O(^PSDRUG("C",PSANDC,PSADRG,0)) D
"RTN","PSAREC",48,0)
 .S PSA50SYN=+$O(^PSDRUG("C",PSANDC,PSADRG,0))
"RTN","PSAREC",49,0)
 .Q:'$D(^PSDRUG(PSADRG,1,PSA50SYN,0))
"RTN","PSAREC",50,0)
 .S PSAOU=$P($G(^PSDRUG(PSADRG,1,PSA50SYN,0)),"^",5),PSADUOU=$P($G(^(0)),"^",7),PSAPOU=$P($G(^(0)),"^",6)
"RTN","PSAREC",51,0)
 E  S PSA50SYN=0
"RTN","PSAREC",52,0)
OU S DIC(0)="QAEMZ",DIC="^DIC(51.5,",DIC("A")="Order Unit: ",DR=.01 S:PSAOU DIC("B")=PSAOU D ^DIC K DIC
"RTN","PSAREC",53,0)
 I Y<0 S PSAOUT=1 Q
"RTN","PSAREC",54,0)
 S PSAOU=+Y
"RTN","PSAREC",55,0)
 W !,"Dispense Units: "_$S($P($G(^PSDRUG(PSADRG,660)),"^",8)'="":$P(^PSDRUG(PSADRG,660),"^",8),1:"Unknown")
"RTN","PSAREC",56,0)
 ;
"RTN","PSAREC",57,0)
 ;DAVE B (PSA*3*10) decimal digits on Disp Units per OU
"RTN","PSAREC",58,0)
DUOU S DIR(0)="NO^::2",DIR("A")="Dispense Units per Order Unit" S:PSADUOU DIR("B")=PSADUOU
"RTN","PSAREC",59,0)
 S DIR("?")="Enter the number of dispense units contained in one order unit.",DIR("??")="^D DUOUHELP^PSAPROC3" D ^DIR K DIR
"RTN","PSAREC",60,0)
 I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAREC",61,0)
 S PSADUOU=+Y
"RTN","PSAREC",62,0)
PRICE S DIR(0)="NO^0:9999:4",DIR("A")="Price per Order Unit",DIR("?")="Enter the price for each order unit.",DIR("??")="^D PRICEHLP^PSAREC" S:PSAPOU DIR("B")=PSAPOU D ^DIR K DIR
"RTN","PSAREC",63,0)
 I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAREC",64,0)
 S PSAPOU=+Y S:+PSAPOU&(PSADUOU) PSAPDU=PSAPOU/PSADUOU
"RTN","PSAREC",65,0)
QTY S DIR(0)="N^0:9999999:0",DIR("A")="Quantity received",DIR("?")="Enter the number of order units you received.",DIR("??")="^D QTYHELP^PSAREC" D ^DIR K DIR
"RTN","PSAREC",66,0)
 I $D(DIRUT) S PSAOUT=1 Q
"RTN","PSAREC",67,0)
 S (PSAREC,PSAREC(1))=Y,PSAVEND=$P($G(^PRC(440,+$P($G(^PRC(442,PSAPO,1)),"^"),0)),"^"),PSACOST=PSAREC*PSAPOU,PSAREC=PSADUOU*PSAREC
"RTN","PSAREC",68,0)
DISP W ?50,"Converted quantity: ",PSAREC
"RTN","PSAREC",69,0)
 ;
"RTN","PSAREC",70,0)
 W ! S DIR(0)="Y",DIR("A")="Okay to post",DIR("B")="Yes",DIR("?",1)="Enter YES to add the received drug to the pharmacy location.",DIR("?")="Enter NO to cancel the receipt of the drug.",DIR("??")="^D POSTHELP^PSAREC"
"RTN","PSAREC",71,0)
 D ^DIR K DIR I $D(DIRUT) S PSAOUT=1 Q
"RTN","PSAREC",72,0)
 D:+Y POST^PSAREC1
"RTN","PSAREC",73,0)
 Q
"RTN","PSAREC",74,0)
 ;
"RTN","PSAREC",75,0)
CORRECT ;Extended help for 'Would you like to correct it'
"RTN","PSAREC",76,0)
 W !?5,"Enter YES to enter the current obligation number. It will be presented",!?5,"as the default the next time the obligation number prompt is displayed."
"RTN","PSAREC",77,0)
 W !!?5,"Enter NO to keep the current obligation number as the default."
"RTN","PSAREC",78,0)
 Q
"RTN","PSAREC",79,0)
 ;
"RTN","PSAREC",80,0)
INV ;Extended help for 'Invoice number'
"RTN","PSAREC",81,0)
 W !?5,"Enter the invoice number for the receipts."
"RTN","PSAREC",82,0)
 Q
"RTN","PSAREC",83,0)
NDCHELP ;Extended help for 'NDC'
"RTN","PSAREC",84,0)
 W !?5,"Enter the National Drug Code (NDC) for the received drug.",!?5,"Enter the NDC with dashes or 12-digits without dashes."
"RTN","PSAREC",85,0)
 Q
"RTN","PSAREC",86,0)
POSTHELP ;Extended help for 'Okay to post?'
"RTN","PSAREC",87,0)
 W !?5,"Enter YES to update the balances in the pharmacy location and DRUG file",!?5,"and add a transaction."
"RTN","PSAREC",88,0)
 W !?5,"Enter NO to abort receiving the drug."
"RTN","PSAREC",89,0)
 Q
"RTN","PSAREC",90,0)
PRICEHLP ;Extended help for 'Price per order unit'
"RTN","PSAREC",91,0)
 W !?5,"Enter the cost for each order unit."
"RTN","PSAREC",92,0)
 Q
"RTN","PSAREC",93,0)
QTYHELP ;
"RTN","PSAREC",94,0)
 W !?5,"The quantity entered will be multiplied by the dispense units",!?5,"per order unit to determine the number of dispense units received."
"RTN","PSAREC",95,0)
 Q
"VER")
8.0^21.0
**END**
**END**
