Released PSS*1*90 SEQ #98
Extracted from mail message
**KIDS**:PSS*1.0*90^

**INSTALL NAME**
PSS*1.0*90
"BLD",5099,0)
PSS*1.0*90^PHARMACY DATA MANAGEMENT^0^3060213^y
"BLD",5099,1,0)
^^135^135^3060213^^^^
"BLD",5099,1,1,0)
This project involves six different applications that have been significantly
"BLD",5099,1,2,0)
changed to enable VA Medical Centers to perform third party electronic billing
"BLD",5099,1,3,0)
for prescriptions. 
"BLD",5099,1,4,0)
 
"BLD",5099,1,5,0)
Below is a list of all the applications involved in this project along with
"BLD",5099,1,6,0)
their patch number:
"BLD",5099,1,7,0)
  
"BLD",5099,1,8,0)
   APPLICATION/VERSION                                  PATCH
"BLD",5099,1,9,0)
   -----------------------------------------------------------------
"BLD",5099,1,10,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*148
"BLD",5099,1,11,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*276
"BLD",5099,1,12,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*90
"BLD",5099,1,13,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0  PSX*2*48
"BLD",5099,1,14,0)
   ACCOUNTS RECEIVABLE (AR) V. 4.5                      PRCA*4.5*230
"BLD",5099,1,15,0)
   ELECTRONIC CLAIMS MANAGEMENT ENGINE (ECME) V. 1.0    BPS*1*1
"BLD",5099,1,16,0)
 
"BLD",5099,1,17,0)
Veterans Health Information Systems and Technology Architecture (VistA) 
"BLD",5099,1,18,0)
software applications and infrastructure were enhanced, in order to allow the
"BLD",5099,1,19,0)
electronic transmission of outpatient pharmacy prescription claims (WINDOW and
"BLD",5099,1,20,0)
MAIL fills) to third party payers via the network connections available
"BLD",5099,1,21,0)
through the Austin Automation Center (AAC). VistA will be enhanced to receive
"BLD",5099,1,22,0)
electronic adjudicated responses from the third party payers, which include
"BLD",5099,1,23,0)
real-time processing for Drug Review Utilization and Refill Too Soon rejects.
"BLD",5099,1,24,0)
Reject information will be displayed to the pharmacist as the prescription is
"BLD",5099,1,25,0)
being processed. The pharmacist will have the capability to take the
"BLD",5099,1,26,0)
appropriate action to ensure patient safety or to override the reject and
"BLD",5099,1,27,0)
resubmit the claim to the payer for payment. When a status of "PAYABLE" is
"BLD",5099,1,28,0)
returned by the payer for a released prescription, VistA will automatically 
"BLD",5099,1,29,0)
create the bill in IB, authorize it and immediately create the receivable in
"BLD",5099,1,30,0)
the AR application. Since the exact amount being paid by the payer is known,
"BLD",5099,1,31,0)
a decrease adjustment will be automatically generated and applied so that the
"BLD",5099,1,32,0)
receivable is equal to the net amount due from the payer.
"BLD",5099,1,33,0)
 
"BLD",5099,1,34,0)
The system also provides electronic payment matching capability (for
"BLD",5099,1,35,0)
electronically billable outpatient pharmacy prescriptions) using the existing
"BLD",5099,1,36,0)
Electronic Data Interchange (EDI) Lockbox functionality which processes other
"BLD",5099,1,37,0)
electronic payments from third party payers. This real-time electronic claims
"BLD",5099,1,38,0)
processing capability will be provided in accordance with the Healthcare
"BLD",5099,1,39,0)
Insurance Portability and Accountability Act (HIPAA), EDI transactions and 
"BLD",5099,1,40,0)
the National Council for Prescription Drug Programs (NCPDP) mandated format 
"BLD",5099,1,41,0)
standards, specifically NCPDP Telecommunication Standard V. 5.1. Additional 
"BLD",5099,1,42,0)
functionality delivered with this project includes: 
"BLD",5099,1,43,0)
 
"BLD",5099,1,44,0)
   . Auto-Release/Outpatient Pharmacy Automation Interface (OPAI) Integration.
"BLD",5099,1,45,0)
   . Back-billing capability to allow electronic billing of claims from within 
"BLD",5099,1,46,0)
     the IB application.
"BLD",5099,1,47,0)
   . Capability to MOVE a group of subscribers from one insurance plan to 
"BLD",5099,1,48,0)
     another while automatically "expiring" the old plan, which is a major
"BLD",5099,1,49,0)
     time saver.
"BLD",5099,1,50,0)
   . Pharmacy Dispensed As Written (DAW) prescription processing.
"BLD",5099,1,51,0)
  
"BLD",5099,1,52,0)
Overview of the Process:
"BLD",5099,1,53,0)
  
"BLD",5099,1,54,0)
When a prescription is about to be filled and dispensed by the pharmacy, the 
"BLD",5099,1,55,0)
OP application submits the prescription to the new ECME application. ECME then
"BLD",5099,1,56,0)
contacts IB to verify whether or not the prescription is electronically
"BLD",5099,1,57,0)
billable. If so, ECME gathers the information necessary to generate a NCPDP
"BLD",5099,1,58,0)
claim. The claim information is passed to the VistA Health Level Seven (HL7)
"BLD",5099,1,59,0)
package. The HL7 package then sends the billing information to the AAC, where
"BLD",5099,1,60,0)
it is routed to the corresponding third party insurance via Emdeon (formerly
"BLD",5099,1,61,0)
WebMD).
"BLD",5099,1,62,0)
  
"BLD",5099,1,63,0)
Once the payer processes the information, the response coming back from the
"BLD",5099,1,64,0)
payer is passed back to the site that made the request, and the information
"BLD",5099,1,65,0)
is stored in the ECME package. If the third party payer accepted the claim,
"BLD",5099,1,66,0)
the adjudicated information is passed along to IB. If the claim was rejected
"BLD",5099,1,67,0)
the problem can be worked on and a new claim can be submitted to the payer.
"BLD",5099,1,68,0)
  
"BLD",5099,1,69,0)
For electronically billable CMOP prescription processing, the third party
"BLD",5099,1,70,0)
claim is sent before the prescription information is transmitted to the
"BLD",5099,1,71,0)
CMOP facility to be filled. Once the adjudicating response is electronically 
"BLD",5099,1,72,0)
received from the third party payer, if there are no Drug Utilization Review
"BLD",5099,1,73,0)
or Refill Too Soon rejects, the prescription is then transmitted to the CMOP 
"BLD",5099,1,74,0)
facility. When the CMOP center sends the dispensing information back to VistA,
"BLD",5099,1,75,0)
the National Drug Code (NDC) information is checked against the NDC sent to 
"BLD",5099,1,76,0)
the third party payer and, if different, a new claim is generated in the 
"BLD",5099,1,77,0)
background and is sent to the third party payer. In case the CMOP facility 
"BLD",5099,1,78,0)
indicates that it is unable to fill a "PAYABLE  prescription fill, a reversal
"BLD",5099,1,79,0)
is automatically submitted to the third party payer for the corresponding 
"BLD",5099,1,80,0)
fill.
"BLD",5099,1,81,0)
   
"BLD",5099,1,82,0)
This patch modifies PDM V. 1.0 to support the other applications in the
"BLD",5099,1,83,0)
electronic claims generation process. It does not interface with the ECME
"BLD",5099,1,84,0)
application at all. The changes to this application are the following:
"BLD",5099,1,85,0)
 
"BLD",5099,1,86,0)
1. A new multiple field has been added to the DRUG file (#50) to store the
"BLD",5099,1,87,0)
   latest NDC numbers that have been dispensed at window as well as by CMOP
"BLD",5099,1,88,0)
   for a specific division. This way, when the next prescription is entered by
"BLD",5099,1,89,0)
   the division for the same drug, the last used NDC is automatically
"BLD",5099,1,90,0)
   retrieved from this new multiple, stored in the PRESCRIPTION file (#52) and
"BLD",5099,1,91,0)
   sent to the third party payer through ECME. Below is the multiple field and
"BLD",5099,1,92,0)
   the fields under it:
"BLD",5099,1,93,0)
  
"BLD",5099,1,94,0)
     32  NDC BY OUTPATIENT SITE
"BLD",5099,1,95,0)
         .01   OUTPATIENT SITE  
"BLD",5099,1,96,0)
           1   LAST LOCAL NDC        
"BLD",5099,1,97,0)
           2   LAST CMOP NDC   
"BLD",5099,1,98,0)
     
"BLD",5099,1,99,0)
2. A new field has been added to the DRUG file (#50) to store the DAW CODE
"BLD",5099,1,100,0)
   field (#81). When a new prescription is entered for a specific drug, the DAW
"BLD",5099,1,101,0)
   CODE from the drug is stored in the PRESCRIPTION file (#52) for each fill.
"BLD",5099,1,102,0)
   This field is solely being used for electronic billing purposes. It 
"BLD",5099,1,103,0)
   communicates to the third party payer that a drug has a special 
"BLD",5099,1,104,0)
   characteristic, which will hopefully prevent the payer from rejecting the
"BLD",5099,1,105,0)
   claim. Below are all 10 existing DAW CODES:
"BLD",5099,1,106,0)
 
"BLD",5099,1,107,0)
     0 - NO PRODUCT SELECTION INDICATED
"BLD",5099,1,108,0)
     1 - SUBSTITUTION NOT ALLOWED BY PRESCRIBER
"BLD",5099,1,109,0)
     2 - SUBSTITUTION ALLOWED-PATIENT REQUESTED PRODUCT DISPENSED
"BLD",5099,1,110,0)
     3 - SUBSTITUTION ALLOWED-PHARMACIST SELECTED PRODUCT DISPENSED
"BLD",5099,1,111,0)
     4 - SUBSTITUTION ALLOWED-GENERIC DRUG NOT IN STOCK
"BLD",5099,1,112,0)
     5 - SUBSTITUTION ALLOWED-BRAND DRUG DISPENSED AS A GENERIC
"BLD",5099,1,113,0)
     6 - OVERRIDE
"BLD",5099,1,114,0)
     7 - SUBSTITUTION NOT ALLOWED-BRAND DRUG MANDATED BY LAW
"BLD",5099,1,115,0)
     8 - SUBSTITUTION ALLOWED-GENERIC DRUG NOT AVAILABLE IN MARKETPLACE
"BLD",5099,1,116,0)
     9 - OTHER
"BLD",5099,1,117,0)
 
"BLD",5099,1,118,0)
   Note: The existing entries in the DRUG file (#50) will NOT be automatically
"BLD",5099,1,119,0)
         populated with a DAW CODE value upon installation of this patch.
"BLD",5099,1,120,0)
         However, the null value is automatically save as 0 (zero) - NO PRODUCT
"BLD",5099,1,121,0)
         SELECTION INDICATED in a prescription entered for a drug with a null
"BLD",5099,1,122,0)
         DAW CODE.
"BLD",5099,1,123,0)
   
"BLD",5099,1,124,0)
3. The Drug Enter/Edit [PSS DRUG ENTER/EDIT] option has been modified to allow
"BLD",5099,1,125,0)
   the user to associate a DAW CODE to a drug in the DRUG file (#50). 
"BLD",5099,1,126,0)
 
"BLD",5099,1,127,0)
4. The Lookup into Dispense Drug File [PSS LOOK] option has been modified to
"BLD",5099,1,128,0)
   display the DAW CODE field (#81) content for the drug being displayed.
"BLD",5099,1,129,0)
   Below is the exact point where the DAW CODE is displayed:
"BLD",5099,1,130,0)
   
"BLD",5099,1,131,0)
   ...
"BLD",5099,1,132,0)
   DEA, SPECIAL HDLG: 6                             NDC:     00172-4390-18
"BLD",5099,1,133,0)
   DAW CODE:  5 - SUBSTITUTION ALLOWED-BRAND DRUG DISPENSED AS A GENERIC
"BLD",5099,1,134,0)
   CS FEDERAL SCHEDULE:
"BLD",5099,1,135,0)
   ...
"BLD",5099,4,0)
^9.64PA^50^1
"BLD",5099,4,50,0)
50
"BLD",5099,4,50,2,0)
^9.641^50^2
"BLD",5099,4,50,2,50,0)
DRUG  (File-top level)
"BLD",5099,4,50,2,50,1,0)
^9.6411^81^1
"BLD",5099,4,50,2,50,1,81,0)
DAW CODE
"BLD",5099,4,50,2,50.032,0)
NDC BY OUTPATIENT SITE  (sub-file)
"BLD",5099,4,50,2,50.032,1,0)
^9.6411^^
"BLD",5099,4,50,222)
y^n^p^^^^n^^n
"BLD",5099,4,50,224)

"BLD",5099,4,"APDD",50,50)

"BLD",5099,4,"APDD",50,50,81)

"BLD",5099,4,"APDD",50,50.032)

"BLD",5099,4,"B",50,50)

"BLD",5099,"INID")
^
"BLD",5099,"INIT")

"BLD",5099,"KRN",0)
^9.67PA^8989.52^19
"BLD",5099,"KRN",.4,0)
.4
"BLD",5099,"KRN",.401,0)
.401
"BLD",5099,"KRN",.402,0)
.402
"BLD",5099,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",5099,"KRN",.402,"NM",1,0)
PSSCOMMON    FILE #50^50^0
"BLD",5099,"KRN",.402,"NM","B","PSSCOMMON    FILE #50",1)

"BLD",5099,"KRN",.403,0)
.403
"BLD",5099,"KRN",.5,0)
.5
"BLD",5099,"KRN",.84,0)
.84
"BLD",5099,"KRN",3.6,0)
3.6
"BLD",5099,"KRN",3.8,0)
3.8
"BLD",5099,"KRN",9.2,0)
9.2
"BLD",5099,"KRN",9.8,0)
9.8
"BLD",5099,"KRN",9.8,"NM",0)
^9.68A^8^6
"BLD",5099,"KRN",9.8,"NM",1,0)
PSSNDCUT^^0^B4760746
"BLD",5099,"KRN",9.8,"NM",4,0)
PSSLOOK^^0^B77383619
"BLD",5099,"KRN",9.8,"NM",5,0)
PSSDAWUT^^0^B474355
"BLD",5099,"KRN",9.8,"NM",6,0)
PSSDEE^^0^B90165251
"BLD",5099,"KRN",9.8,"NM",7,0)
PSSDEE1^^0^B23957466
"BLD",5099,"KRN",9.8,"NM",8,0)
PSSCLOZ^^0^B38089882
"BLD",5099,"KRN",9.8,"NM","B","PSSCLOZ",8)

"BLD",5099,"KRN",9.8,"NM","B","PSSDAWUT",5)

"BLD",5099,"KRN",9.8,"NM","B","PSSDEE",6)

"BLD",5099,"KRN",9.8,"NM","B","PSSDEE1",7)

"BLD",5099,"KRN",9.8,"NM","B","PSSLOOK",4)

"BLD",5099,"KRN",9.8,"NM","B","PSSNDCUT",1)

"BLD",5099,"KRN",19,0)
19
"BLD",5099,"KRN",19.1,0)
19.1
"BLD",5099,"KRN",101,0)
101
"BLD",5099,"KRN",409.61,0)
409.61
"BLD",5099,"KRN",771,0)
771
"BLD",5099,"KRN",870,0)
870
"BLD",5099,"KRN",8989.51,0)
8989.51
"BLD",5099,"KRN",8989.52,0)
8989.52
"BLD",5099,"KRN",8994,0)
8994
"BLD",5099,"KRN","B",.4,.4)

"BLD",5099,"KRN","B",.401,.401)

"BLD",5099,"KRN","B",.402,.402)

"BLD",5099,"KRN","B",.403,.403)

"BLD",5099,"KRN","B",.5,.5)

"BLD",5099,"KRN","B",.84,.84)

"BLD",5099,"KRN","B",3.6,3.6)

"BLD",5099,"KRN","B",3.8,3.8)

"BLD",5099,"KRN","B",9.2,9.2)

"BLD",5099,"KRN","B",9.8,9.8)

"BLD",5099,"KRN","B",19,19)

"BLD",5099,"KRN","B",19.1,19.1)

"BLD",5099,"KRN","B",101,101)

"BLD",5099,"KRN","B",409.61,409.61)

"BLD",5099,"KRN","B",771,771)

"BLD",5099,"KRN","B",870,870)

"BLD",5099,"KRN","B",8989.51,8989.51)

"BLD",5099,"KRN","B",8989.52,8989.52)

"BLD",5099,"KRN","B",8994,8994)

"BLD",5099,"QUES",0)
^9.62^^
"BLD",5099,"REQB",0)
^9.611^2^2
"BLD",5099,"REQB",1,0)
PSS*1.0*82^2
"BLD",5099,"REQB",2,0)
PSS*1.0*87^2
"BLD",5099,"REQB","B","PSS*1.0*82",1)

"BLD",5099,"REQB","B","PSS*1.0*87",2)

"FIA",50)
DRUG
"FIA",50,0)
^PSDRUG(
"FIA",50,0,0)
50I
"FIA",50,0,1)
y^n^p^^^^n^^n
"FIA",50,0,10)

"FIA",50,0,11)

"FIA",50,0,"RLRO")

"FIA",50,0,"VR")
1.0^PSS
"FIA",50,50)
1
"FIA",50,50,32)

"FIA",50,50,81)

"FIA",50,50.032)
0
"KRN",.402,1998,-1)
0^1
"KRN",.402,1998,0)
PSSCOMMON^3051108.1023^@^50^^@^3060118
"KRN",.402,1998,"DIAB",1,1,50.037,0)
ALL
"KRN",.402,1998,"DIAB",1,1,50.065,0)
ALL
"KRN",.402,1998,"DR",1,50)
.01;2;D PKIND^PSSDDUT2;3;81;D PKIND^PSSDDUT2;W !!,"NATIONAL FORMULARY INDICATOR: " W:$P($G(^PSDRUG(DA,"ND")),"^",11)=1 "YES" W:$P($G(^PSDRUG(DA,"ND")),"^",11)="" "Not Matched To NDF" W:$P($G(^PSDRUG(DA,"ND")),"^",11)=0 "NO";51;52;
"KRN",.402,1998,"DR",1,50,1)
37;65;9;101;102;6;31;100;S PSONEWW=$S($P($G(^PS(59.7,1,10)),"^",9)="N":1,1:0) W !!,"WARNING LABEL SOURCE is "_$S(PSONEWW:"'NEW'.",1:"not 'NEW'.");
"KRN",.402,1998,"DR",1,50,2)
I PSONEWW W !,"The following WARNING LABEL may continue to be used for a limited time for some external interfaces.";I 'PSONEWW W !,"WARNING LABEL will be used until the WARNING LABEL SOURCE is set to 'NEW'.";8;@5;
"KRN",.402,1998,"DR",1,50,3)
D WARN^PSSWRNB S:$G(WARNEDIT) Y="@10" I '$G(WARNEDIT) S Y="@15";@10;8.1;S Y="@5";@15;D GENDER2^PSSWRNA I GENDER="" S Y="@20";8.2;@20;12;13;14.5;15;
"KRN",.402,1998,"DR",2,50.037)
.01
"KRN",.402,1998,"DR",2,50.065)
.01
"KRN",.402,1998,"DR",2,50.1)
.01;1;2;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
90^3060213^10000000022
"PKG",517,22,1,"PAH",1,1,0)
^^135^135^3060213
"PKG",517,22,1,"PAH",1,1,1,0)
This project involves six different applications that have been significantly
"PKG",517,22,1,"PAH",1,1,2,0)
changed to enable VA Medical Centers to perform third party electronic billing
"PKG",517,22,1,"PAH",1,1,3,0)
for prescriptions. 
"PKG",517,22,1,"PAH",1,1,4,0)
 
"PKG",517,22,1,"PAH",1,1,5,0)
Below is a list of all the applications involved in this project along with
"PKG",517,22,1,"PAH",1,1,6,0)
their patch number:
"PKG",517,22,1,"PAH",1,1,7,0)
  
"PKG",517,22,1,"PAH",1,1,8,0)
   APPLICATION/VERSION                                  PATCH
"PKG",517,22,1,"PAH",1,1,9,0)
   -----------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,10,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*148
"PKG",517,22,1,"PAH",1,1,11,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*276
"PKG",517,22,1,"PAH",1,1,12,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*90
"PKG",517,22,1,"PAH",1,1,13,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0  PSX*2*48
"PKG",517,22,1,"PAH",1,1,14,0)
   ACCOUNTS RECEIVABLE (AR) V. 4.5                      PRCA*4.5*230
"PKG",517,22,1,"PAH",1,1,15,0)
   ELECTRONIC CLAIMS MANAGEMENT ENGINE (ECME) V. 1.0    BPS*1*1
"PKG",517,22,1,"PAH",1,1,16,0)
 
"PKG",517,22,1,"PAH",1,1,17,0)
Veterans Health Information Systems and Technology Architecture (VistA) 
"PKG",517,22,1,"PAH",1,1,18,0)
software applications and infrastructure were enhanced, in order to allow the
"PKG",517,22,1,"PAH",1,1,19,0)
electronic transmission of outpatient pharmacy prescription claims (WINDOW and
"PKG",517,22,1,"PAH",1,1,20,0)
MAIL fills) to third party payers via the network connections available
"PKG",517,22,1,"PAH",1,1,21,0)
through the Austin Automation Center (AAC). VistA will be enhanced to receive
"PKG",517,22,1,"PAH",1,1,22,0)
electronic adjudicated responses from the third party payers, which include
"PKG",517,22,1,"PAH",1,1,23,0)
real-time processing for Drug Review Utilization and Refill Too Soon rejects.
"PKG",517,22,1,"PAH",1,1,24,0)
Reject information will be displayed to the pharmacist as the prescription is
"PKG",517,22,1,"PAH",1,1,25,0)
being processed. The pharmacist will have the capability to take the
"PKG",517,22,1,"PAH",1,1,26,0)
appropriate action to ensure patient safety or to override the reject and
"PKG",517,22,1,"PAH",1,1,27,0)
resubmit the claim to the payer for payment. When a status of "PAYABLE" is
"PKG",517,22,1,"PAH",1,1,28,0)
returned by the payer for a released prescription, VistA will automatically 
"PKG",517,22,1,"PAH",1,1,29,0)
create the bill in IB, authorize it and immediately create the receivable in
"PKG",517,22,1,"PAH",1,1,30,0)
the AR application. Since the exact amount being paid by the payer is known,
"PKG",517,22,1,"PAH",1,1,31,0)
a decrease adjustment will be automatically generated and applied so that the
"PKG",517,22,1,"PAH",1,1,32,0)
receivable is equal to the net amount due from the payer.
"PKG",517,22,1,"PAH",1,1,33,0)
 
"PKG",517,22,1,"PAH",1,1,34,0)
The system also provides electronic payment matching capability (for
"PKG",517,22,1,"PAH",1,1,35,0)
electronically billable outpatient pharmacy prescriptions) using the existing
"PKG",517,22,1,"PAH",1,1,36,0)
Electronic Data Interchange (EDI) Lockbox functionality which processes other
"PKG",517,22,1,"PAH",1,1,37,0)
electronic payments from third party payers. This real-time electronic claims
"PKG",517,22,1,"PAH",1,1,38,0)
processing capability will be provided in accordance with the Healthcare
"PKG",517,22,1,"PAH",1,1,39,0)
Insurance Portability and Accountability Act (HIPAA), EDI transactions and 
"PKG",517,22,1,"PAH",1,1,40,0)
the National Council for Prescription Drug Programs (NCPDP) mandated format 
"PKG",517,22,1,"PAH",1,1,41,0)
standards, specifically NCPDP Telecommunication Standard V. 5.1. Additional 
"PKG",517,22,1,"PAH",1,1,42,0)
functionality delivered with this project includes: 
"PKG",517,22,1,"PAH",1,1,43,0)
 
"PKG",517,22,1,"PAH",1,1,44,0)
   . Auto-Release/Outpatient Pharmacy Automation Interface (OPAI) Integration.
"PKG",517,22,1,"PAH",1,1,45,0)
   . Back-billing capability to allow electronic billing of claims from within 
"PKG",517,22,1,"PAH",1,1,46,0)
     the IB application.
"PKG",517,22,1,"PAH",1,1,47,0)
   . Capability to MOVE a group of subscribers from one insurance plan to 
"PKG",517,22,1,"PAH",1,1,48,0)
     another while automatically "expiring" the old plan, which is a major
"PKG",517,22,1,"PAH",1,1,49,0)
     time saver.
"PKG",517,22,1,"PAH",1,1,50,0)
   . Pharmacy Dispensed As Written (DAW) prescription processing.
"PKG",517,22,1,"PAH",1,1,51,0)
  
"PKG",517,22,1,"PAH",1,1,52,0)
Overview of the Process:
"PKG",517,22,1,"PAH",1,1,53,0)
  
"PKG",517,22,1,"PAH",1,1,54,0)
When a prescription is about to be filled and dispensed by the pharmacy, the 
"PKG",517,22,1,"PAH",1,1,55,0)
OP application submits the prescription to the new ECME application. ECME then
"PKG",517,22,1,"PAH",1,1,56,0)
contacts IB to verify whether or not the prescription is electronically
"PKG",517,22,1,"PAH",1,1,57,0)
billable. If so, ECME gathers the information necessary to generate a NCPDP
"PKG",517,22,1,"PAH",1,1,58,0)
claim. The claim information is passed to the VistA Health Level Seven (HL7)
"PKG",517,22,1,"PAH",1,1,59,0)
package. The HL7 package then sends the billing information to the AAC, where
"PKG",517,22,1,"PAH",1,1,60,0)
it is routed to the corresponding third party insurance via Emdeon (formerly
"PKG",517,22,1,"PAH",1,1,61,0)
WebMD).
"PKG",517,22,1,"PAH",1,1,62,0)
  
"PKG",517,22,1,"PAH",1,1,63,0)
Once the payer processes the information, the response coming back from the
"PKG",517,22,1,"PAH",1,1,64,0)
payer is passed back to the site that made the request, and the information
"PKG",517,22,1,"PAH",1,1,65,0)
is stored in the ECME package. If the third party payer accepted the claim,
"PKG",517,22,1,"PAH",1,1,66,0)
the adjudicated information is passed along to IB. If the claim was rejected
"PKG",517,22,1,"PAH",1,1,67,0)
the problem can be worked on and a new claim can be submitted to the payer.
"PKG",517,22,1,"PAH",1,1,68,0)
  
"PKG",517,22,1,"PAH",1,1,69,0)
For electronically billable CMOP prescription processing, the third party
"PKG",517,22,1,"PAH",1,1,70,0)
claim is sent before the prescription information is transmitted to the
"PKG",517,22,1,"PAH",1,1,71,0)
CMOP facility to be filled. Once the adjudicating response is electronically 
"PKG",517,22,1,"PAH",1,1,72,0)
received from the third party payer, if there are no Drug Utilization Review
"PKG",517,22,1,"PAH",1,1,73,0)
or Refill Too Soon rejects, the prescription is then transmitted to the CMOP 
"PKG",517,22,1,"PAH",1,1,74,0)
facility. When the CMOP center sends the dispensing information back to VistA,
"PKG",517,22,1,"PAH",1,1,75,0)
the National Drug Code (NDC) information is checked against the NDC sent to 
"PKG",517,22,1,"PAH",1,1,76,0)
the third party payer and, if different, a new claim is generated in the 
"PKG",517,22,1,"PAH",1,1,77,0)
background and is sent to the third party payer. In case the CMOP facility 
"PKG",517,22,1,"PAH",1,1,78,0)
indicates that it is unable to fill a "PAYABLE  prescription fill, a reversal
"PKG",517,22,1,"PAH",1,1,79,0)
is automatically submitted to the third party payer for the corresponding 
"PKG",517,22,1,"PAH",1,1,80,0)
fill.
"PKG",517,22,1,"PAH",1,1,81,0)
   
"PKG",517,22,1,"PAH",1,1,82,0)
This patch modifies PDM V. 1.0 to support the other applications in the
"PKG",517,22,1,"PAH",1,1,83,0)
electronic claims generation process. It does not interface with the ECME
"PKG",517,22,1,"PAH",1,1,84,0)
application at all. The changes to this application are the following:
"PKG",517,22,1,"PAH",1,1,85,0)
 
"PKG",517,22,1,"PAH",1,1,86,0)
1. A new multiple field has been added to the DRUG file (#50) to store the
"PKG",517,22,1,"PAH",1,1,87,0)
   latest NDC numbers that have been dispensed at window as well as by CMOP
"PKG",517,22,1,"PAH",1,1,88,0)
   for a specific division. This way, when the next prescription is entered by
"PKG",517,22,1,"PAH",1,1,89,0)
   the division for the same drug, the last used NDC is automatically
"PKG",517,22,1,"PAH",1,1,90,0)
   retrieved from this new multiple, stored in the PRESCRIPTION file (#52) and
"PKG",517,22,1,"PAH",1,1,91,0)
   sent to the third party payer through ECME. Below is the multiple field and
"PKG",517,22,1,"PAH",1,1,92,0)
   the fields under it:
"PKG",517,22,1,"PAH",1,1,93,0)
  
"PKG",517,22,1,"PAH",1,1,94,0)
     32  NDC BY OUTPATIENT SITE
"PKG",517,22,1,"PAH",1,1,95,0)
         .01   OUTPATIENT SITE  
"PKG",517,22,1,"PAH",1,1,96,0)
           1   LAST LOCAL NDC        
"PKG",517,22,1,"PAH",1,1,97,0)
           2   LAST CMOP NDC   
"PKG",517,22,1,"PAH",1,1,98,0)
     
"PKG",517,22,1,"PAH",1,1,99,0)
2. A new field has been added to the DRUG file (#50) to store the DAW CODE
"PKG",517,22,1,"PAH",1,1,100,0)
   field (#81). When a new prescription is entered for a specific drug, the DAW
"PKG",517,22,1,"PAH",1,1,101,0)
   CODE from the drug is stored in the PRESCRIPTION file (#52) for each fill.
"PKG",517,22,1,"PAH",1,1,102,0)
   This field is solely being used for electronic billing purposes. It 
"PKG",517,22,1,"PAH",1,1,103,0)
   communicates to the third party payer that a drug has a special 
"PKG",517,22,1,"PAH",1,1,104,0)
   characteristic, which will hopefully prevent the payer from rejecting the
"PKG",517,22,1,"PAH",1,1,105,0)
   claim. Below are all 10 existing DAW CODES:
"PKG",517,22,1,"PAH",1,1,106,0)
 
"PKG",517,22,1,"PAH",1,1,107,0)
     0 - NO PRODUCT SELECTION INDICATED
"PKG",517,22,1,"PAH",1,1,108,0)
     1 - SUBSTITUTION NOT ALLOWED BY PRESCRIBER
"PKG",517,22,1,"PAH",1,1,109,0)
     2 - SUBSTITUTION ALLOWED-PATIENT REQUESTED PRODUCT DISPENSED
"PKG",517,22,1,"PAH",1,1,110,0)
     3 - SUBSTITUTION ALLOWED-PHARMACIST SELECTED PRODUCT DISPENSED
"PKG",517,22,1,"PAH",1,1,111,0)
     4 - SUBSTITUTION ALLOWED-GENERIC DRUG NOT IN STOCK
"PKG",517,22,1,"PAH",1,1,112,0)
     5 - SUBSTITUTION ALLOWED-BRAND DRUG DISPENSED AS A GENERIC
"PKG",517,22,1,"PAH",1,1,113,0)
     6 - OVERRIDE
"PKG",517,22,1,"PAH",1,1,114,0)
     7 - SUBSTITUTION NOT ALLOWED-BRAND DRUG MANDATED BY LAW
"PKG",517,22,1,"PAH",1,1,115,0)
     8 - SUBSTITUTION ALLOWED-GENERIC DRUG NOT AVAILABLE IN MARKETPLACE
"PKG",517,22,1,"PAH",1,1,116,0)
     9 - OTHER
"PKG",517,22,1,"PAH",1,1,117,0)
 
"PKG",517,22,1,"PAH",1,1,118,0)
   Note: The existing entries in the DRUG file (#50) will NOT be automatically
"PKG",517,22,1,"PAH",1,1,119,0)
         populated with a DAW CODE value upon installation of this patch.
"PKG",517,22,1,"PAH",1,1,120,0)
         However, the null value is automatically save as 0 (zero) - NO PRODUCT
"PKG",517,22,1,"PAH",1,1,121,0)
         SELECTION INDICATED in a prescription entered for a drug with a null
"PKG",517,22,1,"PAH",1,1,122,0)
         DAW CODE.
"PKG",517,22,1,"PAH",1,1,123,0)
   
"PKG",517,22,1,"PAH",1,1,124,0)
3. The Drug Enter/Edit [PSS DRUG ENTER/EDIT] option has been modified to allow
"PKG",517,22,1,"PAH",1,1,125,0)
   the user to associate a DAW CODE to a drug in the DRUG file (#50). 
"PKG",517,22,1,"PAH",1,1,126,0)
 
"PKG",517,22,1,"PAH",1,1,127,0)
4. The Lookup into Dispense Drug File [PSS LOOK] option has been modified to
"PKG",517,22,1,"PAH",1,1,128,0)
   display the DAW CODE field (#81) content for the drug being displayed.
"PKG",517,22,1,"PAH",1,1,129,0)
   Below is the exact point where the DAW CODE is displayed:
"PKG",517,22,1,"PAH",1,1,130,0)
   
"PKG",517,22,1,"PAH",1,1,131,0)
   ...
"PKG",517,22,1,"PAH",1,1,132,0)
   DEA, SPECIAL HDLG: 6                             NDC:     00172-4390-18
"PKG",517,22,1,"PAH",1,1,133,0)
   DAW CODE:  5 - SUBSTITUTION ALLOWED-BRAND DRUG DISPENSED AS A GENERIC
"PKG",517,22,1,"PAH",1,1,134,0)
   CS FEDERAL SCHEDULE:
"PKG",517,22,1,"PAH",1,1,135,0)
   ...
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PSSCLOZ")
0^8^B38089882^B37976478
"RTN","PSSCLOZ",1,0)
PSSCLOZ ;BIR/TTH-CLOZAPINE DRUG ENTER/EDIT CLOZAPINE ; 01/25/99
"RTN","PSSCLOZ",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**19,90**;9/30/97
"RTN","PSSCLOZ",3,0)
 ;
"RTN","PSSCLOZ",4,0)
 ;Reference to ^LAB(60 supported by DBIA #10054
"RTN","PSSCLOZ",5,0)
 ;Reference to ^LAB(61 supported by DBIA #10055
"RTN","PSSCLOZ",6,0)
 ;
"RTN","PSSCLOZ",7,0)
 Q:'$D(DISPDRG)
"RTN","PSSCLOZ",8,0)
 N DA,DIC,DIE,DIK,DINUM,DIR,DR,PSSANS,PSSANS2,PSSCIM,PSSCLO,PSSCNT,PSSCRN,PSSIEN,PSSLAB1,PSSLAB2,PSSLT,PSSLTN,PSSNN,PSSNUM,PSSOPP,PSSPTY,PSSPTYN,PSSSUB,PSSTOT,PSSTUFF,PSSTYP0,PSSXX,X,Y
"RTN","PSSCLOZ",9,0)
 K DIRUT,DUOUT
"RTN","PSSCLOZ",10,0)
 ;Mark drug for Clozapine and create "ACLOZ" cross-reference.
"RTN","PSSCLOZ",11,0)
 S DA=DISPDRG,DIE=50,DR="17.5///^S X=""PSOCLO1""" D ^DIE K DA,DIE
"RTN","PSSCLOZ",12,0)
 ;
"RTN","PSSCLOZ",13,0)
CLOZBEG I $D(DIRUT)!($D(DUOUT)) Q
"RTN","PSSCLOZ",14,0)
 S (PSSIEN,PSSCNT)=0
"RTN","PSSCLOZ",15,0)
 I $O(^PSDRUG(DISPDRG,"CLOZ2",0)) F PSSIEN=0:0 S PSSIEN=$O(^PSDRUG(DISPDRG,"CLOZ2",PSSIEN)) Q:'PSSIEN  D
"RTN","PSSCLOZ",16,0)
 .S PSSSUB=$P($G(^PSDRUG(DISPDRG,"CLOZ2",PSSIEN,0)),U),PSSTYP0=$P($G(^(0)),U,4),PSSCIM=$P($G(^(0)),U,3)
"RTN","PSSCLOZ",17,0)
 .K PSSLAB1,PSSLAB2 S PSSLAB1=$$GET1^DIQ(60,PSSSUB,.01,"I"),PSSLAB2=$$GET1^DIQ(61,PSSCIM,.01,"I")
"RTN","PSSCLOZ",18,0)
 .S PSSCNT=PSSCNT+1,PSSCLO(PSSCNT)=$S($D(PSSLAB1):PSSLAB1,1:"**Unknown Lab Test**")_"^"_PSSSUB_"^"_PSSIEN_"^"_PSSTYP0_"^"_$S($D(PSSLAB2):PSSLAB2,1:"**Unknown Lab Test**")
"RTN","PSSCLOZ",19,0)
 W !!,"Prescription of Clozapine requires identification of two",!,"laboratory tests, WBC and Absolute Neutrophil Count (ANC).",!!
"RTN","PSSCLOZ",20,0)
 I PSSCNT=0 W "You do not have any laboratory tests identified." W !! S DIR(0)="SOA^WBC:WBC;ANC:ANC",DIR("B")="WBC" S DIR("A")="Select Laboratory Test Type: " D ^DIR Q:$D(DIRUT)  S PSSTUFF=Y K DIR,X,Y G CLOZBG2
"RTN","PSSCLOZ",21,0)
 I PSSCNT=1 W "You have one laboratory type of "_$S(PSSTYP0=1:"WBC",PSSTYP0=2:"ANC",1:"**Unknown**")_" test identified." S PSSTUFF=$S(PSSTYP0=2:1,1:2)
"RTN","PSSCLOZ",22,0)
 I PSSCNT>1 W "You currently have both laboratory tests identified."
"RTN","PSSCLOZ",23,0)
 ;
"RTN","PSSCLOZ",24,0)
 D DISPLAY
"RTN","PSSCLOZ",25,0)
 ;
"RTN","PSSCLOZ",26,0)
CLOZBG2 I PSSCNT=0 S PSSANS="A" D CLOZSEL Q
"RTN","PSSCLOZ",27,0)
 S DIR("?")="Enter the letter that correspond with the function."
"RTN","PSSCLOZ",28,0)
 I PSSCNT=1 D  Q:$D(DIRUT)
"RTN","PSSCLOZ",29,0)
 .S PSSOPP=$S(PSSTYP0=2:"WBC",PSSTYP0=1:"ANC",1:"**Data Missing**")
"RTN","PSSCLOZ",30,0)
 .W !!,"A second laboratory type of "_PSSOPP_" test should be added.",! S DIR(0)="SOA^A:ADD;E:EDIT;D:DELETE",DIR("A")="(A)dd, (E)dit, or (D)elete entry? " D ^DIR Q:$D(DIRUT)
"RTN","PSSCLOZ",31,0)
 I PSSCNT>1 W !! S DIR(0)="SOA^E:EDIT;D:DELETE",DIR("A")="(E)dit or (D)elete entry? " D ^DIR Q:$D(DIRUT)
"RTN","PSSCLOZ",32,0)
 S PSSANS=Y D CLOZSEL Q:$D(DIRUT)
"RTN","PSSCLOZ",33,0)
 ;
"RTN","PSSCLOZ",34,0)
END ;Kill variables.
"RTN","PSSCLOZ",35,0)
 K DIC,DIE,DIK,DIR,DR,PSSANS,PSSANS2,PSSCNT,PSSSUB,PSSXX,X,Y
"RTN","PSSCLOZ",36,0)
 Q
"RTN","PSSCLOZ",37,0)
 ;
"RTN","PSSCLOZ",38,0)
DISPLAY ;Display lab test.
"RTN","PSSCLOZ",39,0)
 W !!!,?2,"Type of",!,?2,"Test",?12,"Lab Test Monitor",?55,"Specimen Type",!,?2,"-------",?12,"----------------",?55,"-------------"
"RTN","PSSCLOZ",40,0)
 Q:'$O(PSSCLO(0))  W ! F PSSXX=0:0 S PSSXX=$O(PSSCLO(PSSXX)) Q:'PSSXX  D
"RTN","PSSCLOZ",41,0)
 .S PSSTOT=$P($G(PSSCLO(PSSXX)),U,4)
"RTN","PSSCLOZ",42,0)
 .W !,?2,PSSXX_".  "_$S(PSSTOT=1:"WBC",PSSTOT=2:"ANC",1:"**Unknown**"),?12,$P(PSSCLO(PSSXX),U),?55,$E($P(PSSCLO(PSSXX),U,5),1,20)
"RTN","PSSCLOZ",43,0)
 Q
"RTN","PSSCLOZ",44,0)
 ;
"RTN","PSSCLOZ",45,0)
CLOZSEL ;Execute add, edit or delete submodule.
"RTN","PSSCLOZ",46,0)
 I PSSCNT>1,($G(PSSANS)'="A") D CLOZASK Q:$D(DIRUT)
"RTN","PSSCLOZ",47,0)
 I PSSANS="D" D:PSSCNT=1 CLOZASK D CLOZDEL Q
"RTN","PSSCLOZ",48,0)
 I PSSANS="E" D:PSSCNT=1 CLOZASK D CLOZEDT Q
"RTN","PSSCLOZ",49,0)
 ;
"RTN","PSSCLOZ",50,0)
CLOZADD ;Add Clozapine sub-entry
"RTN","PSSCLOZ",51,0)
 Q:$D(DIRUT)
"RTN","PSSCLOZ",52,0)
 D DISPLY2 Q:$D(DIRUT)  I Y=0 D END Q:$G(DIRUT)  W !! K PSSCLO G CLOZBEG
"RTN","PSSCLOZ",53,0)
CLOZAD2 K DIC,DD,DO S X=PSSLTN,DA(1)=DISPDRG,DIC="^PSDRUG("_DA(1)_",""CLOZ2"","
"RTN","PSSCLOZ",54,0)
 S DIC(0)="L",DIC("P")="50.02P"
"RTN","PSSCLOZ",55,0)
 S DIC("DR")="2///"_PSSPTYN_";3///"_PSSTUFF
"RTN","PSSCLOZ",56,0)
 D FILE^DICN K DD,DO I Y=-1 S (DUOUT,DIRUT)=1 K DIC,DA,X,Y Q
"RTN","PSSCLOZ",57,0)
 D END Q:$G(DIRUT)  W !! K PSSCLO G CLOZBEG
"RTN","PSSCLOZ",58,0)
 Q
"RTN","PSSCLOZ",59,0)
 ;
"RTN","PSSCLOZ",60,0)
CLOZEDT ;Edit Clozapine sub-entry
"RTN","PSSCLOZ",61,0)
 Q:$D(DIRUT)  K DIE,DR,X,Y S DA=PSSANS2
"RTN","PSSCLOZ",62,0)
 S DIE="^PSDRUG(DISPDRG,""CLOZ2"","
"RTN","PSSCLOZ",63,0)
 S DR=".01;2;3///"_PSSTUFF D ^DIE I $D(Y) S (DUOUT,DIRUT)=1 D CLOZDXX K ^PSDRUG(DISPDRG,"CLOZ2"),DIE,DR,X,Y Q
"RTN","PSSCLOZ",64,0)
 D END Q:$G(DIRUT)  W !! K PSSCLO G CLOZBEG
"RTN","PSSCLOZ",65,0)
 Q
"RTN","PSSCLOZ",66,0)
 ;
"RTN","PSSCLOZ",67,0)
CLOZDEL ;Delete Clozapine sub-entry
"RTN","PSSCLOZ",68,0)
 Q:$D(DIRUT)  I PSSCNT<3 W !,"You must have a test defined for WBC and ANC to dispense Clozapine.",!
"RTN","PSSCLOZ",69,0)
 S DIR("A")="Are you sure that you want to delete this test",DIR("?")="Enter YES to delete the laboratory test, NO to return to selection.",DIR(0)="Y",DIR("B")="NO" D ^DIR Q:$D(DIRUT)  I +Y=0 D END W !! K PSSCLO G CLOZBEG
"RTN","PSSCLOZ",70,0)
 ;
"RTN","PSSCLOZ",71,0)
CLOZDXX K DIK,X,Y
"RTN","PSSCLOZ",72,0)
 S DA(1)=DISPDRG,DA=PSSANS2,DIK="^PSDRUG(DISPDRG,""CLOZ2"","
"RTN","PSSCLOZ",73,0)
 D ^DIK  K DIK,X,Y
"RTN","PSSCLOZ",74,0)
 I PSSANS="E",PSSCNT>1 Q
"RTN","PSSCLOZ",75,0)
 Q:PSSANS="A"  W !!,"Deleting "_$P(PSSCLO(PSSNUM),U)_"...."
"RTN","PSSCLOZ",76,0)
 D END Q:$G(DIRUT)  W !! K PSSCLO G CLOZBEG
"RTN","PSSCLOZ",77,0)
 Q
"RTN","PSSCLOZ",78,0)
CLOZASK ;Select LAB Test number.
"RTN","PSSCLOZ",79,0)
 I $D(DIRUT)!($D(DUOUT)) Q
"RTN","PSSCLOZ",80,0)
 W ! K DIR,Y S DIR(0)="NA^1:"_PSSCNT_":1",DIR("A")="Select the Number of the test you want to "_$S(PSSANS="D":"delete",1:"edit")_" (1 or "_PSSCNT_"): "
"RTN","PSSCLOZ",81,0)
 S DIR("?")="Enter the number you want to delete or edit." D ^DIR Q:$D(DIRUT)
"RTN","PSSCLOZ",82,0)
 S PSSNUM=+Y,PSSANS2=$P(PSSCLO(PSSNUM),U,3) I PSSANS="E" S PSSTUFF=$P(PSSCLO(PSSNUM),U,4) I PSSCNT>1 D  Q:$D(DIRUT)  I Y=0 D END W !! K PSSCLO G CLOZBEG
"RTN","PSSCLOZ",83,0)
 .S PSSNN=$S(PSSNUM=1:2,1:1),PSSCRN=$P(PSSCLO(PSSNN),U,2)
"RTN","PSSCLOZ",84,0)
 .D DISPLY3 Q:$D(DIRUT)!(Y=0)
"RTN","PSSCLOZ",85,0)
 .D CLOZDXX ;Delete selected entry.
"RTN","PSSCLOZ",86,0)
 .D CLOZAD2 ;Add entry with new changes.
"RTN","PSSCLOZ",87,0)
 Q
"RTN","PSSCLOZ",88,0)
 ;
"RTN","PSSCLOZ",89,0)
DISPLY2 ;Display selection before adding to file.
"RTN","PSSCLOZ",90,0)
 Q:$D(DIRUT)  S PSSCRN=$P($G(PSSCLO(1)),U,2)
"RTN","PSSCLOZ",91,0)
DISPLY3 K DIR,X,Y W ! S DIR(0)="P^60:EMAQZ",DIR("S")="I PSSCRN'=+Y" D ^DIR Q:$D(DIRUT)  S PSSLTN=+Y,PSSLT=$P(Y,U,2)
"RTN","PSSCLOZ",92,0)
 K DIR,X,Y S DIR(0)="P^61:EMAQZ",DIR("A")="Select SPECIMEN TYPE" D ^DIR Q:$D(DIRUT)  S PSSPTYN=+Y,PSSPTY=$P(Y,U,2) K DIR,X,Y
"RTN","PSSCLOZ",93,0)
 W !!,"You have selected the following information for",!,"a Laboratory Type of "_$S(PSSTUFF=2:"ANC",1:"WBC")_" test."
"RTN","PSSCLOZ",94,0)
 W !!,?2,"Lab Test Monitor: "_PSSLT,!,?2,"Specimen Type   : "_PSSPTY
"RTN","PSSCLOZ",95,0)
 K DIR,X,Y W !! S DIR("A")="Is this correct",DIR("?")="Enter YES to accept, NO to reject.",DIR(0)="Y",DIR("B")="YES" D ^DIR
"RTN","PSSCLOZ",96,0)
 Q
"RTN","PSSCLOZ",97,0)
 ;
"RTN","PSSCLOZ",98,0)
CLOZMOV ;In File #50, move data CLOZ node to CLOZ2 node.
"RTN","PSSCLOZ",99,0)
 N PSSIEN,PSSGLO
"RTN","PSSCLOZ",100,0)
 S (PSSIEN,PSSGLO)=0
"RTN","PSSCLOZ",101,0)
 F PSSIEN=0:0 S PSSIEN=$O(^PSDRUG(PSSIEN)) Q:'PSSIEN  I $P($G(^PSDRUG(PSSIEN,"CLOZ1")),"^")="PSOCLO1" D
"RTN","PSSCLOZ",102,0)
 .S ^PSDRUG("ACLOZ",PSSIEN)="",PSSGLO=^PSDRUG(PSSIEN,"CLOZ")
"RTN","PSSCLOZ",103,0)
 .K DIC,DD,DO,X S (DA,DINUM)=1,DA(1)=PSSIEN,X=$P(PSSGLO,"^") Q:'X
"RTN","PSSCLOZ",104,0)
 .S DIC("P")="50.02P",DIC(0)="L"
"RTN","PSSCLOZ",105,0)
 .S DIC="^PSDRUG("_DA(1)_",""CLOZ2"","
"RTN","PSSCLOZ",106,0)
 .S DIC("DR")="1////"_$P(PSSGLO,"^",2)_";2////"_$P(PSSGLO,"^",3)_";3///1"
"RTN","PSSCLOZ",107,0)
 .D FILE^DICN K DIC,DA
"RTN","PSSCLOZ",108,0)
 Q
"RTN","PSSDAWUT")
0^5^B474355
"RTN","PSSDAWUT",1,0)
PSSDAWUT ;BIRM/MFR - ECME (BPS) Utilities ;10/15/04
"RTN","PSSDAWUT",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**90**;9/30/97
"RTN","PSSDAWUT",3,0)
 ;Reference to File #9002313.24 supported by DBIA 4715
"RTN","PSSDAWUT",4,0)
 ;
"RTN","PSSDAWUT",5,0)
DAWEXT(CODE) ; Returns description for DAW code (Dispense as Written)
"RTN","PSSDAWUT",6,0)
 N DIC,X,Y
"RTN","PSSDAWUT",7,0)
 S DIC=9002313.24,DIC(0)="Z",X=CODE D ^DIC
"RTN","PSSDAWUT",8,0)
 Q $P($G(Y(0)),"^",2)
"RTN","PSSDAWUT",9,0)
 ;
"RTN","PSSDAWUT",10,0)
INPUT ; Input Transform for DAW CODE
"RTN","PSSDAWUT",11,0)
 I $L(X)<1!($L(X)>2)!'$D(X) K X Q
"RTN","PSSDAWUT",12,0)
 I X="?" X ^DD(50,81,4) Q
"RTN","PSSDAWUT",13,0)
 S DIC(0)="QM",DIC="^BPS(9002313.24," D ^DIC
"RTN","PSSDAWUT",14,0)
 S X=$P(Y,U,2) K:Y<0 X
"RTN","PSSDAWUT",15,0)
 Q
"RTN","PSSDAWUT",16,0)
 ;
"RTN","PSSDAWUT",17,0)
HLP ; Executable help for DAW CODE field
"RTN","PSSDAWUT",18,0)
 N DIC,D,DO
"RTN","PSSDAWUT",19,0)
 S DIC="^BPS(9002313.24,",D="B",DIC(0)="" D DQ^DICQ
"RTN","PSSDAWUT",20,0)
 Q
"RTN","PSSDEE")
0^6^B90165251^B90135890
"RTN","PSSDEE",1,0)
PSSDEE ;BIR/WRT-MASTER DRUG ENTER/EDIT ROUTINE ;01/21/00
"RTN","PSSDEE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,5,15,16,20,22,28,32,34,33,38,57,47,68,61,82,90**;9/30/97
"RTN","PSSDEE",3,0)
 ;
"RTN","PSSDEE",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSDEE",5,0)
 ;Reference to REACT1^PSNOUT supported by DBIA #2080
"RTN","PSSDEE",6,0)
 ;Reference to $$UP^XLFSTR(X) supported by DBIA #10104
"RTN","PSSDEE",7,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDEE",8,0)
 ;
"RTN","PSSDEE",9,0)
BEGIN S PSSFLAG=0 D ^PSSDEE2 S PSSZ=1 F PSSXX=1:1 K DA D ASK Q:PSSFLAG
"RTN","PSSDEE",10,0)
DONE D ^PSSDEE2 K PSSFLAG Q
"RTN","PSSDEE",11,0)
ASK W ! S DIC="^PSDRUG(",DIC(0)="QEALMNTV",DLAYGO=50,DIC("T")="" D ^DIC K DIC I Y<0 S PSSFLAG=1 Q
"RTN","PSSDEE",12,0)
 S (FLG1,FLG2,FLG3,FLG4,FLG5,FLG6,FLG7,FLAG,FLGKY,FLGOI)=0 K ^TMP($J,"ADD"),^TMP($J,"SOL")
"RTN","PSSDEE",13,0)
 S DA=+Y,DISPDRG=DA L +^PSDRUG(DISPDRG):0 I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSDEE",14,0)
 S PSSHUIDG=1,PSSNEW=$P(Y,"^",3) D USE,NOPE,COMMON,DEA,MF K PSSHUIDG
"RTN","PSSDEE",15,0)
 ; if any outpatient site has a dispense machine running HL7 V.2.4, then
"RTN","PSSDEE",16,0)
 ; run the new routine and create message
"RTN","PSSDEE",17,0)
 N XX,DNSNAM,DNSPORT,DVER,DMFU S XX=""
"RTN","PSSDEE",18,0)
 F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSDEE",19,0)
 .S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSDEE",20,0)
 .S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007)
"RTN","PSSDEE",21,0)
 .D:DVER="2.4"&(DNSNAM'="")&(DMFU="YES") DRG^PSSDGUPD(DISPDRG,PSSNEW,DNSNAM,DNSPORT)
"RTN","PSSDEE",22,0)
 D DRG^PSSHUIDG(DISPDRG,PSSNEW) L -^PSDRUG(DISPDRG) K FLG3,PSSNEW
"RTN","PSSDEE",23,0)
 Q
"RTN","PSSDEE",24,0)
COMMON S DIE="^PSDRUG(",DR="[PSSCOMMON]" D ^DIE Q:$D(Y)!($D(DTOUT))  W:'$D(Y) !,"PRICE PER DISPENSE UNIT: " S:'$D(^PSDRUG(DA,660)) $P(^PSDRUG(DA,660),"^",6)="" W:'$D(Y) $P(^PSDRUG(DA,660),"^",6)
"RTN","PSSDEE",25,0)
 D DEA,CK,ASKND,OIKILL^PSSDEE1,COMMON1
"RTN","PSSDEE",26,0)
 Q
"RTN","PSSDEE",27,0)
COMMON1 W !,"Just a reminder...you are editing ",$P(^PSDRUG(DISPDRG,0),"^"),"." S (PSSVVDA,DA)=DISPDRG D DOSN^PSSDOS S DA=PSSVVDA K PSSVVDA D USE,APP,ORDITM^PSSDEE1
"RTN","PSSDEE",28,0)
 Q
"RTN","PSSDEE",29,0)
CK D DSPY^PSSDEE1 S FLGNDF=0
"RTN","PSSDEE",30,0)
 Q
"RTN","PSSDEE",31,0)
ASKND S %=-1 I $D(^XUSEC("PSNMGR",DUZ)) D MESSAGE^PSSDEE1 W !!,"Do you wish to match/rematch to NATIONAL DRUG file" S %=1 S:FLGMTH=1 %=2 D YN^DICN
"RTN","PSSDEE",32,0)
 I %=0 W !,"If you answer ""yes"", you will attempt to match to NDF." G ASKND
"RTN","PSSDEE",33,0)
 I %=2 K X,Y Q
"RTN","PSSDEE",34,0)
 I %<0 K X,Y Q
"RTN","PSSDEE",35,0)
 I %=1 D RSET^PSSDEE1,EN1^PSSUTIL(DISPDRG,1) S X="PSNOUT" X ^%ZOSF("TEST") I  D REACT1^PSNOUT S DA=DISPDRG I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)]"" D ONE
"RTN","PSSDEE",36,0)
 Q
"RTN","PSSDEE",37,0)
ONE S PSNP=$G(^PSDRUG(DA,"I")) I PSNP,PSNP<DT Q
"RTN","PSSDEE",38,0)
 W !,"You have just VERIFIED this match and MERGED the entry." D CKDF D EN2^PSSUTIL(DISPDRG,1) S:'$D(OLDDF) OLDDF="" I OLDDF'=NEWDF S FLGNDF=1 D WR
"RTN","PSSDEE",39,0)
 Q
"RTN","PSSDEE",40,0)
CKDF S NWND=^PSDRUG(DA,"ND"),NWPC1=$P(NWND,"^",1),NWPC3=$P(NWND,"^",3),DA=NWPC1,K=NWPC3 S X=$$PSJDF^PSNAPIS(DA,K) S NEWDF=$P(X,"^",2),DA=DISPDRG
"RTN","PSSDEE",41,0)
 N PSSK D PKIND^PSSDDUT2
"RTN","PSSDEE",42,0)
 Q
"RTN","PSSDEE",43,0)
NOPE S ZAPFLG=0 I '$D(^PSDRUG(DA,"ND")),$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",44,0)
 I '$D(^PSDRUG(DA,"ND")),'$D(^PSDRUG(DA,2)) D DFNULL
"RTN","PSSDEE",45,0)
 I $D(^PSDRUG(DA,"ND")),$P(^PSDRUG(DA,"ND"),"^",2)']"",$D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)']"" D DFNULL
"RTN","PSSDEE",46,0)
 Q
"RTN","PSSDEE",47,0)
DFNULL S OLDDF="",ZAPFLG=1
"RTN","PSSDEE",48,0)
 Q
"RTN","PSSDEE",49,0)
ZAPIT I $D(ZAPFLG),ZAPFLG=1,FLGNDF=1,OLDDF'=NEWDF D CKIV^PSSDEE1
"RTN","PSSDEE",50,0)
 Q
"RTN","PSSDEE",51,0)
APP W !!,"MARK THIS DRUG AND EDIT IT FOR: " D CHOOSE
"RTN","PSSDEE",52,0)
 Q
"RTN","PSSDEE",53,0)
CHOOSE I $D(^XUSEC("PSORPH",DUZ))!($D(^XUSEC("PSXCMOPMGR",DUZ))) W !,"O  - Outpatient" S FLG1=1
"RTN","PSSDEE",54,0)
 I $D(^XUSEC("PSJU MGR",DUZ)) W !,"U  - Unit Dose" S FLG2=1
"RTN","PSSDEE",55,0)
 I $D(^XUSEC("PSJI MGR",DUZ)) W !,"I  - IV" S FLG3=1
"RTN","PSSDEE",56,0)
 I $D(^XUSEC("PSGWMGR",DUZ)) W !,"W  - Ward Stock" S FLG4=1
"RTN","PSSDEE",57,0)
 I $D(^XUSEC("PSAMGR",DUZ))!($D(^XUSEC("PSA ORDERS",DUZ))) W !,"D  - Drug Accountability" S FLG5=1
"RTN","PSSDEE",58,0)
 I $D(^XUSEC("PSDMGR",DUZ)) W !,"C  - Controlled Substances" S FLG6=1
"RTN","PSSDEE",59,0)
 I $D(^XUSEC("PSORPH",DUZ)) W !,"X  - Non-VA Med" S FLG7=1
"RTN","PSSDEE",60,0)
 I FLG1,FLG2,FLG3,FLG4,FLG5,FLG6 S FLAG=1
"RTN","PSSDEE",61,0)
 I FLAG W !,"A  - ALL"
"RTN","PSSDEE",62,0)
 W !
"RTN","PSSDEE",63,0)
 I 'FLG1,'FLG2,'FLG3,'FLG4,'FLG5,'FLG6,'FLG7 W !,"You do not have the proper keys to continue. Sorry, this concludes your editing session.",! S FLGKY=1 K DIRUT,X Q
"RTN","PSSDEE",64,0)
 I FLGKY'=1 D
"RTN","PSSDEE",65,0)
 . K DIR S DIR(0)="FO^1:30"
"RTN","PSSDEE",66,0)
 . S DIR("A")="Enter your choice(s) separated by commas "
"RTN","PSSDEE",67,0)
 . F  D ^DIR Q:$$CHECK($$UP^XLFSTR(X))
"RTN","PSSDEE",68,0)
 . S PSSANS=X,PSSANS=$$UP^XLFSTR(PSSANS) D BRANCH,BRANCH1
"RTN","PSSDEE",69,0)
 Q
"RTN","PSSDEE",70,0)
 ;
"RTN","PSSDEE",71,0)
CHECK(X) ; Validates Application Use response
"RTN","PSSDEE",72,0)
 N CHECK,I,C
"RTN","PSSDEE",73,0)
 S CHECK=1 I X=""!(Y["^")!($D(DIRUT)) Q CHECK
"RTN","PSSDEE",74,0)
 F I=1:1:$L(X,",") D
"RTN","PSSDEE",75,0)
 . S C=$P(X,",",I) W !?43,C," - "
"RTN","PSSDEE",76,0)
 . I C="O",FLG1 W "Outpatient" Q
"RTN","PSSDEE",77,0)
 . I C="U",FLG2 W "Unit Dose" Q
"RTN","PSSDEE",78,0)
 . I C="I",FLG3 W "IV" Q
"RTN","PSSDEE",79,0)
 . I C="W",FLG4 W "Ward Stock" Q
"RTN","PSSDEE",80,0)
 . I C="D",FLG5 W "Drug Accountability" Q
"RTN","PSSDEE",81,0)
 . I C="C",FLG6 W "Controlled Substances" Q
"RTN","PSSDEE",82,0)
 . I C="X",FLG7 W "Non-VA Med" Q
"RTN","PSSDEE",83,0)
 . W "Invalid Entry",$C(7) S CHECK=0
"RTN","PSSDEE",84,0)
 Q CHECK
"RTN","PSSDEE",85,0)
BRANCH D:PSSANS["O" OP D:PSSANS["U" UD D:PSSANS["I" IV D:PSSANS["W" WS
"RTN","PSSDEE",86,0)
 D:PSSANS["D" DACCT D:PSSANS["C" CS D:PSSANS["X" NVM
"RTN","PSSDEE",87,0)
 Q
"RTN","PSSDEE",88,0)
BRANCH1 I FLAG,PSSANS["A" D OP,UD,IV,WS,DACCT,CS,NVM
"RTN","PSSDEE",89,0)
 Q
"RTN","PSSDEE",90,0)
OP I FLG1 D
"RTN","PSSDEE",91,0)
 . W !,"** You are NOW editing OUTPATIENT fields. **"
"RTN","PSSDEE",92,0)
 . S PSIUDA=DA,PSIUX="O^Outpatient Pharmacy" D ^PSSGIU
"RTN","PSSDEE",93,0)
 . I %=1 D
"RTN","PSSDEE",94,0)
 . . S DIE="^PSDRUG(",DR="[PSSOP]" D ^DIE K DIR D OPEI,ASKCMOP
"RTN","PSSDEE",95,0)
 . . S X="PSOCLO1" X ^%ZOSF("TEST") I  D ASKCLOZ S FLGOI=1
"RTN","PSSDEE",96,0)
 I FLG1 D CKCMOP
"RTN","PSSDEE",97,0)
 Q
"RTN","PSSDEE",98,0)
CKCMOP I $P($G(^PSDRUG(DISPDRG,2)),"^",3)'["O" S:$D(^PSDRUG(DISPDRG,3)) $P(^PSDRUG(DISPDRG,3),"^",1)=0 K:$D(^PSDRUG("AQ",DISPDRG)) ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG D ^PSSREF
"RTN","PSSDEE",99,0)
 Q
"RTN","PSSDEE",100,0)
UD I FLG2 W !,"** You are NOW editing UNIT DOSE fields. **" S PSIUDA=DA,PSIUX="U^Unit Dose" D ^PSSGIU I %=1 S DIE="^PSDRUG(",DR="62.05;212.2" D ^DIE S DIE="^PSDRUG(",DR="212",DR(2,50.0212)=".01;1" D ^DIE S FLGOI=1
"RTN","PSSDEE",101,0)
 Q
"RTN","PSSDEE",102,0)
IV I FLG3 W !,"** You are NOW editing IV fields. **" S (PSIUDA,PSSDA)=DA,PSIUX="I^IV" D ^PSSGIU I %=1 D IV1 S FLGOI=1
"RTN","PSSDEE",103,0)
 Q
"RTN","PSSDEE",104,0)
IV1 K PSSIVOUT ;This variable controls the selection process loop.
"RTN","PSSDEE",105,0)
 W !,"Edit Additives or Solutions: " K DIR S DIR(0)="SO^A:ADDITIVES;S:SOLUTIONS;" D ^DIR Q:$D(DIRUT)  S PSSASK=Y(0) D:PSSASK="ADDITIVES" ENA^PSSVIDRG D:PSSASK="SOLUTIONS" ENS^PSSVIDRG I '$D(PSSIVOUT) G IV1
"RTN","PSSDEE",106,0)
 K PSSIVOUT
"RTN","PSSDEE",107,0)
 Q
"RTN","PSSDEE",108,0)
WS I FLG4 W !,"** You are NOW editing WARD STOCK fields. **" S DIE="^PSDRUG(",DR="300;301;302" D ^DIE
"RTN","PSSDEE",109,0)
 Q
"RTN","PSSDEE",110,0)
DACCT I FLG5 W !,"** You are NOW editing DRUG ACCOUNTABILITY fields. **" S DIE="^PSDRUG(",DR="441" D ^DIE S DIE="^PSDRUG(",DR="9",DR(2,50.1)="1;2;400;401;402;403;404;405" D ^DIE
"RTN","PSSDEE",111,0)
 Q
"RTN","PSSDEE",112,0)
CS I FLG6 W !,"** You are NOW Marking/Unmarking for CONTROLLED SUBS. **" S PSIUDA=DA,PSIUX="N^Controlled Substances" D ^PSSGIU
"RTN","PSSDEE",113,0)
 Q
"RTN","PSSDEE",114,0)
NVM I FLG7 W !,"** You are NOW Marking/Unmarking for NON-VA MEDS. **" S PSIUDA=DA,PSIUX="X^Non-VA Med" D ^PSSGIU
"RTN","PSSDEE",115,0)
 Q
"RTN","PSSDEE",116,0)
ASKCMOP I $D(^XUSEC("PSXCMOPMGR",DUZ)) W !!,"Do you wish to mark to transmit to CMOP? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will attempt to mark this drug to transmit to CMOP."
"RTN","PSSDEE",117,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",118,0)
 I "Yy"[X S PSXFL=0 D TEXT^PSSMARK H 7 N PSXUDA S (PSXUM,PSXUDA)=DA,PSXLOC=$P(^PSDRUG(DA,0),"^"),PSXGOOD=0,PSXF=0,PSXBT=0 D BLD^PSSMARK,PICK2^PSSMARK S DA=PSXUDA
"RTN","PSSDEE",119,0)
 Q
"RTN","PSSDEE",120,0)
ASKCLOZ W !!,"Do you wish to mark/unmark as a LAB MONITOR or CLOZAPINE DRUG? " K DIR S DIR(0)="Y",DIR("?")="If you answer ""yes"", you will have the opportunity to edit LAB MONITOR or CLOZAPINE fields."
"RTN","PSSDEE",121,0)
 D ^DIR I "Nn"[X K X,Y,DIRUT Q
"RTN","PSSDEE",122,0)
 I "Yy"[X S NFLAG=0 D MONCLOZ
"RTN","PSSDEE",123,0)
 Q
"RTN","PSSDEE",124,0)
MONCLOZ K PSSAST D FLASH W !,"Mark/Unmark for Lab Monitor or Clozapine: " K DIR S DIR(0)="S^L:LAB MONITOR;C:CLOZAPINE;" D ^DIR Q:$D(DIRUT)  S PSSAST=Y(0) D:PSSAST="LAB MONITOR" ^PSSLAB D:PSSAST="CLOZAPINE" CLOZ
"RTN","PSSDEE",125,0)
 Q
"RTN","PSSDEE",126,0)
FLASH K LMFLAG,CLFALG,WHICH S WHICH=$P($G(^PSDRUG(DISPDRG,"CLOZ1")),"^"),LMFLAG=0,CLFLAG=0
"RTN","PSSDEE",127,0)
 I WHICH="PSOCLO1" S CLFLAG=1
"RTN","PSSDEE",128,0)
 I WHICH'="PSOCLO1" S:WHICH'="" LMFLAG=1
"RTN","PSSDEE",129,0)
 Q
"RTN","PSSDEE",130,0)
CLOZ Q:NFLAG  Q:$D(DTOUT)  Q:$D(DIRUT)  Q:$D(DUOUT)  W !,"** You are NOW editing CLOZAPINE fields. **" D ^PSSCLDRG
"RTN","PSSDEE",131,0)
 Q
"RTN","PSSDEE",132,0)
USE K PACK S PACK="" S:$P($G(^PSDRUG(DISPDRG,"PSG")),"^",2)]"" PACK="W" I $D(^PSDRUG(DISPDRG,2)) S PACK=PACK_$P(^PSDRUG(DISPDRG,2),"^",3)
"RTN","PSSDEE",133,0)
 I PACK'="" D
"RTN","PSSDEE",134,0)
 .W $C(7) N XX W !! F XX=1:1:79 W "*"
"RTN","PSSDEE",135,0)
 .W !,"This entry is marked for the following PHARMACY packages: "
"RTN","PSSDEE",136,0)
 .D USE1
"RTN","PSSDEE",137,0)
 Q
"RTN","PSSDEE",138,0)
USE1 W:PACK["O" !," Outpatient" W:PACK["U" !," Unit Dose" W:PACK["I" !," IV"
"RTN","PSSDEE",139,0)
 W:PACK["W" !," Ward Stock" W:PACK["D" !," Drug Accountability"
"RTN","PSSDEE",140,0)
 W:PACK["N" !," Controlled Substances" W:PACK["X" !," Non-VA Med"
"RTN","PSSDEE",141,0)
 W:'$D(PACK) !," NONE"
"RTN","PSSDEE",142,0)
 I PACK'["O",PACK'["U",PACK'["I",PACK'["W",PACK'["D",PACK'["N",PACK'["X" W !," NONE"
"RTN","PSSDEE",143,0)
 Q
"RTN","PSSDEE",144,0)
WR I ^XMB("NETNAME")'["CMOP-" W:OLDDF'="" !,"The dosage form has changed from "_OLDDF_" to "_NEWDF_" due to",!,"matching/rematching to NDF.",!,"You will need to rematch to Orderable Item.",!
"RTN","PSSDEE",145,0)
 Q
"RTN","PSSDEE",146,0)
PRIMDRG I $D(^PS(59.7,1,20)),$P(^PS(59.7,1,20),"^",1)=4!($P(^PS(59.7,1,20),"^",1)=4.5) I $D(^PSDRUG(DISPDRG,2)) S VAR=$P(^PSDRUG(DISPDRG,2),"^",3) I VAR["U"!(VAR["I") D PRIM1
"RTN","PSSDEE",147,0)
 Q
"RTN","PSSDEE",148,0)
PRIM1 W !!,"You need to match this drug to ""PRIMARY DRUG"" file as well.",! S DIE="^PSDRUG(",DR="64",DA=DISPDRG D ^DIE K VAR
"RTN","PSSDEE",149,0)
 Q
"RTN","PSSDEE",150,0)
MF I $P($G(^PS(59.7,1,80)),"^",2)>1 I $D(^PSDRUG(DISPDRG,2)) S PSSOR=$P(^PSDRUG(DISPDRG,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",151,0)
 Q
"RTN","PSSDEE",152,0)
MFA I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.6,ENTRY,0),"^",11),PSSDD=$P(^PS(52.6,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",153,0)
 Q
"RTN","PSSDEE",154,0)
MFS I $P($G(^PS(59.7,1,80)),"^",2)>1 S PSSOR=$P(^PS(52.7,ENTRY,0),"^",11),PSSDD=$P(^PS(52.7,ENTRY,0),"^",2) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP") D MFDD
"RTN","PSSDEE",155,0)
 Q
"RTN","PSSDEE",156,0)
MFDD I $D(^PSDRUG(PSSDD,2)) S PSSOR=$P(^PSDRUG(PSSDD,2),"^",1) I PSSOR]"" D EN^PSSPOIDT(PSSOR),EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSDEE",157,0)
 Q
"RTN","PSSDEE",158,0)
OPEI I $D(^PSDRUG(DISPDRG,"ND")),$P(^PSDRUG(DISPDRG,"ND"),"^",10)]"" S DIE="^PSDRUG(",DR="28",DA=DISPDRG D ^DIE
"RTN","PSSDEE",159,0)
 Q
"RTN","PSSDEE",160,0)
DEA ;
"RTN","PSSDEE",161,0)
 I $P($G(^PSDRUG(DISPDRG,3)),"^")=1,($P(^PSDRUG(DISPDRG,0),"^",3)[1!($P(^(0),"^",3)[2)) D DSH
"RTN","PSSDEE",162,0)
 Q
"RTN","PSSDEE",163,0)
DSH W !!,"****************************************************************************"
"RTN","PSSDEE",164,0)
 W !,"This entry contains a ""1"" or a ""2"" in the ""DEA, SPECIAL HDLG""",!,"field, therefore this item has been UNMARKED for CMOP transmission."
"RTN","PSSDEE",165,0)
 W !,"****************************************************************************",! S $P(^PSDRUG(DISPDRG,3),"^")=0 K ^PSDRUG("AQ",DISPDRG) S DA=DISPDRG N % D ^PSSREF
"RTN","PSSDEE",166,0)
 Q
"RTN","PSSDEE1")
0^7^B23957466^B23957466
"RTN","PSSDEE1",1,0)
PSSDEE1 ;BIR/WRT-PDM match routine ;09/01/98
"RTN","PSSDEE1",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**15,20,34,38,68,90**;9/30/97
"RTN","PSSDEE1",3,0)
 ;
"RTN","PSSDEE1",4,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSDEE1",5,0)
 ;
"RTN","PSSDEE1",6,0)
DSPY S FLGMTH=0 I $D(^PSDRUG(DA,"ND")) I $P(^PSDRUG(DA,"ND"),"^",2)]"" W !!,?5,"points to ",$P(^("ND"),"^",2)," in the National Drug file.",! S NDE=^PSDRUG(DA,"ND"),PC1=$P(NDE,"^",1),PC3=$P(NDE,"^",3),FLGMTH=1 D GETDF
"RTN","PSSDEE1",7,0)
 I $D(^PSDRUG(DA,2)),$P(^PSDRUG(DA,2),"^",1)]"" S PSSOITM=$P(^PSDRUG(DA,2),"^",1) I $D(^PS(50.7,PSSOITM,0)) S PTR=$P(^PS(50.7,PSSOITM,0),"^",2),OLDDF=$P(^PS(50.606,PTR,0),"^",1)
"RTN","PSSDEE1",8,0)
 Q
"RTN","PSSDEE1",9,0)
GETDF S DA=PC1,K=PC3,X=$$PSJDF^PSNAPIS(DA,K),OLDDF=$P(X,"^",2),DA=DISPDRG
"RTN","PSSDEE1",10,0)
 Q
"RTN","PSSDEE1",11,0)
MESSAGE ; REMATCH PROMPT
"RTN","PSSDEE1",12,0)
 I $D(^PSDRUG(DA,"ND")) W:$P(^PSDRUG(DA,"ND"),"^",2)]"" !!,"This drug has already been matched and classified with the National Drug",!,"file." D PART2
"RTN","PSSDEE1",13,0)
 I $D(^PSDRUG(DA,3)) W:$P(^PSDRUG(DA,3),"^",1)=1 !,"This drug has also been marked to transmit to CMOP.",!,"If you choose to rematch it, the drug will be marked NOT TO TRANSMIT to CMOP.",!
"RTN","PSSDEE1",14,0)
 I $D(^PSDRUG(DA,"ND")) W:$P(^PSDRUG(DA,"ND"),"^",2)']"" !!,"This drug has been manually classed but not matched (merged with NDF)."
"RTN","PSSDEE1",15,0)
 Q
"RTN","PSSDEE1",16,0)
RSET S:$D(^PSDRUG(DA,"ND")) PSNID=$P(^PSDRUG(DA,"ND"),"^",10)
"RTN","PSSDEE1",17,0)
 S PSNP=$G(^PSDRUG(DA,"I")) I PSNP,PSNP<DT W !,"This drug cannot be matched because it has an INACTIVE date.",! Q:$D(^PSDRUG(DA,"I"))
"RTN","PSSDEE1",18,0)
 S DA=DISPDRG D:$D(^PSDRUG(DA,"ND")) SETNULL  S:$D(^PSDRUG(DA,3)) $P(^PSDRUG(DA,3),"^",1)=0 K:$D(^PSDRUG("AQ",DA)) ^PSDRUG("AQ",DA) I $D(PSNID),PSNID]"" K ^PSDRUG("AQ1",PSNID,DA) K PSNID
"RTN","PSSDEE1",19,0)
 D ^PSSREF Q
"RTN","PSSDEE1",20,0)
SETNULL S ZXZX=$P(^PSDRUG(DA,"ND"),"^",2),$P(^PSDRUG(DA,"ND"),"^",1)="",$P(^PSDRUG(DA,"ND"),"^",2)="",$P(^PSDRUG(DA,"ND"),"^",3)="",$P(^PSDRUG(DA,"ND"),"^",4)="",$P(^PSDRUG(DA,"ND"),"^",5)="",$P(^PSDRUG(DA,"ND"),"^",10)="" D NULL1
"RTN","PSSDEE1",21,0)
 Q
"RTN","PSSDEE1",22,0)
NULL1 I ZXZX]"" S ZXZX=$E(ZXZX,1,30) I $D(^PSDRUG("VAPN",ZXZX,DA)) K ^PSDRUG("VAPN",ZXZX,DA) K ZXZX
"RTN","PSSDEE1",23,0)
 Q
"RTN","PSSDEE1",24,0)
PART2 W:$P(^PSDRUG(DA,"ND"),"^",2)]"" " In addition, if the dosage form changes as a result of rematching,",!,"you will have to match/rematch to Orderable Item."
"RTN","PSSDEE1",25,0)
 Q
"RTN","PSSDEE1",26,0)
ORDITM I FLGKY'=1 I $D(^PSDRUG(DISPDRG,2)) S APU=$P(^PSDRUG(DISPDRG,2),"^",3) I (APU["O")!(APU["I")!(APU["U")!(APU["X") D OICK
"RTN","PSSDEE1",27,0)
 Q
"RTN","PSSDEE1",28,0)
OICK I ^XMB("NETNAME")'["CMOP-",$D(^PS(59.7,1,80)),$P(^PS(59.7,1,80),"^",2)>1 D OIMESS S PSIEN=DISPDRG,PSNAME=$P(^PSDRUG(DISPDRG,0),"^",1),PSMASTER=1 D MAS^PSSPOIMN K PSIEN,PSNAME,PSMASTER
"RTN","PSSDEE1",29,0)
 Q
"RTN","PSSDEE1",30,0)
OIKILL I $D(FLGNDF),FLGNDF=1,$D(PSDRUG(DISPDRG,2)),$P(^PSDRUG(DISPDRG,2),"^",1)]"" D KMTCH
"RTN","PSSDEE1",31,0)
 Q
"RTN","PSSDEE1",32,0)
KMTCH S DIE="^PSDRUG(",DR="2.1///"_"@" D ^DIE D  D CKIV
"RTN","PSSDEE1",33,0)
 .;S PSSINSTX=$O(^PS(59.7,0)) I $P($G(^PS(59.7,+$G(PSSINSTX),80)),"^",3)<2 K PSSINSTX Q
"RTN","PSSDEE1",34,0)
 .K PSSINSTX W !!,"Deleting Local Possible Dosages.." K ^PSDRUG(DISPDRG,"DOS2")
"RTN","PSSDEE1",35,0)
 Q
"RTN","PSSDEE1",36,0)
OIMESS W !!,"** You are NOW in the ORDERABLE ITEM matching for the dispense drug. **",!
"RTN","PSSDEE1",37,0)
 Q
"RTN","PSSDEE1",38,0)
CKIV K ^TMP($J,"SOL"),^TMP($J,"ADD") ;D SOLIO
"RTN","PSSDEE1",39,0)
 ;D ADDIO
"RTN","PSSDEE1",40,0)
 Q
"RTN","PSSDEE1",41,0)
SOLIO I $D(^PS(52.7,"AC",DISPDRG)) F BBC=0:0 S BBC=$O(^PS(52.7,"AC",DISPDRG,BBC)) Q:'BBC  S SOLITM=$P(^PS(52.7,BBC,0),"^",11) I SOLITM]"" I $D(^PS(52.7,"AOI",SOLITM,BBC)) D SOLIO1
"RTN","PSSDEE1",42,0)
 Q
"RTN","PSSDEE1",43,0)
SOLIO1 S IVDFPTR=$P(^PS(50.7,SOLITM,0),"^",2),IVDF=$P(^PS(50.606,IVDFPTR,0),"^",1),SOLNM=$P(^PS(52.7,BBC,0),"^",1) D CP
"RTN","PSSDEE1",44,0)
 Q
"RTN","PSSDEE1",45,0)
CP I IVDF'=NEWDF S ^TMP($J,"SOL",BBC)=SOLNM I $P(^PS(52.7,BBC,0),"^",11)]"" S DA=BBC,DIE="^PS(52.7,",DR="9///"_"@" D ^DIE
"RTN","PSSDEE1",46,0)
 Q
"RTN","PSSDEE1",47,0)
SOLMESS ;I FLG3=1,PSSANS'["I",$D(^TMP($J,"SOL")) W !,"You have SOLUTIONS that need to rematched to ORDERABLE ITEM." F NUM=0:0 S NUM=$O(^TMP($J,"SOL",NUM)) Q:'NUM  S ENTRY=NUM D SOI^PSSVIDRG K ^TMP($J,"SOL",NUM)
"RTN","PSSDEE1",48,0)
 Q
"RTN","PSSDEE1",49,0)
ADDIO I $D(^PS(52.6,"AC",DISPDRG)) F BBC=0:0 S BBC=$O(^PS(52.6,"AC",DISPDRG,BBC)) Q:'BBC  S ADDITM=$P(^PS(52.6,BBC,0),"^",11) I ADDITM]"",$D(^PS(52.6,"AOI",ADDITM,BBC)) D ADDIO1
"RTN","PSSDEE1",50,0)
 Q
"RTN","PSSDEE1",51,0)
ADDIO1 S IVDFPTR=$P(^PS(50.7,ADDITM,0),"^",2),IVDF=$P(^PS(50.606,IVDFPTR,0),"^",1),ADDNM=$P(^PS(52.6,BBC,0),"^",1) D CP1
"RTN","PSSDEE1",52,0)
 Q
"RTN","PSSDEE1",53,0)
CP1 I IVDF'=NEWDF S ^TMP($J,"ADD",BBC)=ADDNM I $P(^PS(52.6,BBC,0),"^",11)]"" S DA=BBC,DIE="^PS(52.6,",DR="15///"_"@" D ^DIE
"RTN","PSSDEE1",54,0)
 Q
"RTN","PSSDEE1",55,0)
ADDMESS ;I FLG3=1,PSSANS'["I",$D(^TMP($J,"ADD")) W !!,"You have ADDITIVES that need to rematched to ORDERABLE ITEM." F NUM=0:0 S NUM=$O(^TMP($J,"ADD",NUM)) Q:'NUM  S ENTRY=NUM D ADDOI^PSSVIDRG K ^TMP($J,"ADD",NUM)
"RTN","PSSDEE1",56,0)
 Q
"RTN","PSSDEE1",57,0)
ADDMESS1 ;I FLG3=0,$D(^TMP($J,"ADD")) W !!,"The following ADDITIVES need to rematched to ORDERABLE ITEM, however you do",!,"not have the ""PSJI MGR"" IV key. These must be matched before they made be used.",! D MESSA
"RTN","PSSDEE1",58,0)
 Q
"RTN","PSSDEE1",59,0)
MESSA F NUM=0:0 S NUM=$O(^TMP($J,"ADD",NUM)) Q:'NUM  W !?3,$P(^TMP($J,"ADD",NUM),"^")
"RTN","PSSDEE1",60,0)
 Q
"RTN","PSSDEE1",61,0)
SOLMESS1 ;I FLG3=0,$D(^TMP($J,"SOL")) W !!,"The following SOLUTIONS need to rematched to ORDERABLE ITEM, however you do",!,"not have the ""PSJI MGR"" IV key. These must be matched before they may be used.",! D MESSS
"RTN","PSSDEE1",62,0)
 Q
"RTN","PSSDEE1",63,0)
MESSS F NUM=0:0 S NUM=$O(^TMP($J,"SOL",NUM)) Q:'NUM  W !?3,$P(^TMP($J,"SOL",NUM),"^")
"RTN","PSSDEE1",64,0)
 Q
"RTN","PSSDEE1",65,0)
ADDMESS2 ;I FLG3=1,PSSANS["I",$D(^TMP($J,"ADD")) W !!,"The following ADDITIVES need to rematched to ORDERABLE ITEM.",!,"These must be matched before they made be used.",! D MESSA
"RTN","PSSDEE1",66,0)
 Q
"RTN","PSSDEE1",67,0)
SOLMESS2 ;I FLG3=1,PSSANS["I",$D(^TMP($J,"SOL")) W !!,"The following SOLUTIONS need to rematched to ORDERABLE ITEM.",!,"These must be matched before they may be used.",! D MESSS
"RTN","PSSDEE1",68,0)
 Q
"RTN","PSSLOOK")
0^4^B77383619^B75247379
"RTN","PSSLOOK",1,0)
PSSLOOK ;BIR/WRT-Drug file lookup ;02/03/00
"RTN","PSSLOOK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,7,15,16,20,24,29,38,68,61,87,90**;9/30/97
"RTN","PSSLOOK",3,0)
 ;
"RTN","PSSLOOK",4,0)
 ;Reference to ^PS(50.605 supported by DBIA #2138
"RTN","PSSLOOK",5,0)
 ;Reference to ^PS(50.608 supported by DBIA #2136
"RTN","PSSLOOK",6,0)
 ;Reference to ^PS(50.609 supported by DBIA #2137
"RTN","PSSLOOK",7,0)
 ;Reference to ^PS(50.607 supported by DBIA #2221
"RTN","PSSLOOK",8,0)
 ;Reference to $$FORMRX^PSNAPIS(DA,K,.LIST) supported by DBIA #2574
"RTN","PSSLOOK",9,0)
 ;Reference to $$FORMI^PSNAPIS(P1,P3) supported by DBIA #2574
"RTN","PSSLOOK",10,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",11,0)
 ;Reference to $$PSJST^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",12,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",13,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSLOOK",14,0)
 ;Reference to ^PSNDF(50.68 supported by DBIA 3735
"RTN","PSSLOOK",15,0)
 ;
"RTN","PSSLOOK",16,0)
START S QUIT=0,PSSFG=0 D KILL F PSSXX=1:1 D PICK Q:PSSFG
"RTN","PSSLOOK",17,0)
DONE D KILL K PSSFG,PSSXX,QUIT,FM,FMS,Y2K
"RTN","PSSLOOK",18,0)
 Q
"RTN","PSSLOOK",19,0)
PICK W ! K DIC S DIC="^PSDRUG(",DIC(0)="QEAMN" D ^DIC K DIC I Y<0 S PSSFG=1 Q
"RTN","PSSLOOK",20,0)
 S IFN=+Y D NDDATA,GETDATA,INACT,NOD66,FORMAT,KILL
"RTN","PSSLOOK",21,0)
 Q
"RTN","PSSLOOK",22,0)
NDDATA I $D(^PSDRUG(IFN,"ND")) S CLPTR=$P(^PSDRUG(IFN,"ND"),"^",6) I $P(^PSDRUG(IFN,"ND"),"^",2)]"" S NDNODE=^PSDRUG(IFN,"ND"),VAGNPTR=$P(NDNODE,"^",1),VAPN=$P(NDNODE,"^",2),SZPTR=$P(NDNODE,"^",4),TYPTR=$P(NDNODE,"^",5) D NDF,NDF1
"RTN","PSSLOOK",23,0)
 Q
"RTN","PSSLOOK",24,0)
NDF S DA=VAGNPTR,X=$$VAGN^PSNAPIS(DA),VAGN=X,PS=$P(^PS(50.609,SZPTR,0),"^",1),PT=$P(^PS(50.608,TYPTR,0),"^",1),P3=$P(NDNODE,"^",3)
"RTN","PSSLOOK",25,0)
 K X S DA=VAGNPTR,K=P3,X=$$PROD2^PSNAPIS(DA,K) I X]"",$P(X,"^")]"" S VAPRN=$P(X,"^"),VADU=$P(X,"^",4),CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",26,0)
 S CSF="" I $P(NDNODE,"^",3) S CSF=$$GET1^DIQ(50.68,$P(NDNODE,"^",3),19,"I")
"RTN","PSSLOOK",27,0)
 Q
"RTN","PSSLOOK",28,0)
IT S CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",29,0)
 Q
"RTN","PSSLOOK",30,0)
NDF1 S X=$$PSJDF^PSNAPIS(DA,K),VADF=$P(X,"^",2)
"RTN","PSSLOOK",31,0)
 Q
"RTN","PSSLOOK",32,0)
INACT S ACT="" I $D(^PSDRUG(IFN,"I")) S Y=$P(^PSDRUG(IFN,"I"),"^",1) X ^DD("DD") S ACT=Y
"RTN","PSSLOOK",33,0)
 Q
"RTN","PSSLOOK",34,0)
GETDATA S NODE0=^PSDRUG(IFN,0),GN=$P(NODE0,"^",1),CL=$P(NODE0,"^",2),DEA=$P(NODE0,"^",3),WRN=$P(NODE0,"^",8),NF=$P(NODE0,"^",9),MESS=$P(NODE0,"^",10),VNF=$P(NODE0,"^",11),CLASS="",WARN="" S:NF=1 NF="N/F" S:VNF=1 VNF="V-N/F"
"RTN","PSSLOOK",35,0)
 S PSSNODE=$G(^PSDRUG(IFN,"DOS"))
"RTN","PSSLOOK",36,0)
 I CL]"" S CLASS=CL_"  "_$P(^PS(50.605,CLPTR,0),"^",2)
"RTN","PSSLOOK",37,0)
 I $D(^PSDRUG(IFN,3)) S:$P(^PSDRUG(IFN,3),"^")=0 CMOP="NO" S:$P(^PSDRUG(IFN,3),"^")=1 CMOP="YES"
"RTN","PSSLOOK",38,0)
 I $D(^PSDRUG(IFN,5)) S QDM=^PSDRUG(IFN,5)
"RTN","PSSLOOK",39,0)
 S OINM="" S NDC="" I $D(^PSDRUG(IFN,2)) S NODE2=^PSDRUG(IFN,2) S:$P(NODE2,"^",1)]"" OIPTR=$P(NODE2,"^",1) S NDC=$P(NODE2,"^",4) S:$P(NODE2,"^",6)]"" PDPTR=$P(NODE2,"^",6) S APP=$P(NODE2,"^",3),FM="" D TWOA
"RTN","PSSLOOK",40,0)
 Q
"RTN","PSSLOOK",41,0)
TWOA I $D(OIPTR) S OI=$P(^PS(50.7,OIPTR,0),"^",1),DFPTR=$P(^PS(50.7,OIPTR,0),"^",2),DF=$P(^PS(50.606,DFPTR,0),"^",1),FMS=$P(^PS(50.7,OIPTR,0),"^",12) S:FMS]"" FM=" (N/F)" S OINM=OI_" "_DF_FM
"RTN","PSSLOOK",42,0)
 ;I $D(PDPTR) S PD=$P(^PS(50.3,PDPTR,0),"^",1)
"RTN","PSSLOOK",43,0)
 Q
"RTN","PSSLOOK",44,0)
NOD66 S (DUPOU,PPDU,PPOU,DU,SS)="" I $D(^PSDRUG(IFN,660)) S NDE=^PSDRUG(IFN,660),OUPTR=$P(NDE,"^",2),PPOU=$P(NDE,"^",3),DUPOU=$P(NDE,"^",5),PPDU=$P(NDE,"^",6),SS=$P(NDE,"^",7),DU=$P(NDE,"^",8) I OUPTR]"" S OU=$P(^DIC(51.5,OUPTR,0),"^")
"RTN","PSSLOOK",45,0)
 Q
"RTN","PSSLOOK",46,0)
SYN I $D(^PSDRUG(IFN,1,0)) F ZZZ=0:0 S ZZZ=$O(^PSDRUG(IFN,1,ZZZ)) Q:'ZZZ  S SYNM=$P(^PSDRUG(IFN,1,ZZZ,0),"^",1),INT=$P(^PSDRUG(IFN,1,ZZZ,0),"^",3) D SYN1
"RTN","PSSLOOK",47,0)
 Q
"RTN","PSSLOOK",48,0)
SYN1 S INT=$S(INT=0:"Trade Name",INT=1:"Quick Code",INT="C":"Ctrl Substances",INT="D":"Drug Accountability",1:"") D FULL Q:$G(QUIT)  W ?14,SYNM,?55,INT,!
"RTN","PSSLOOK",49,0)
 Q
"RTN","PSSLOOK",50,0)
SYN2 S:INT=0 INT="Trade" S:INT=1 INT="Quick" S:INT="C" INT="Ctrl Subs" S:INT="D" INT="Drug Acct" W ?16,SYNM,?57,INT,!
"RTN","PSSLOOK",51,0)
 Q
"RTN","PSSLOOK",52,0)
IFCAP I $D(^PSDRUG(IFN,441,0)) F QQQ=0:0 S QQQ=$O(^PSDRUG(IFN,441,QQQ)) Q:'QQQ  S IFCAPNM=$P(^PSDRUG(IFN,441,QQQ,0),"^",1)
"RTN","PSSLOOK",53,0)
 Q
"RTN","PSSLOOK",54,0)
FORMAT ; BEGIN WRITING
"RTN","PSSLOOK",55,0)
 N DAW
"RTN","PSSLOOK",56,0)
 W @IOF,?21,GN,!
"RTN","PSSLOOK",57,0)
 F XX=1:1:77 W "="
"RTN","PSSLOOK",58,0)
 W !
"RTN","PSSLOOK",59,0)
 W:$D(VAPRN) "VA PRINT NAME: ",?17,VAPRN W:$D(CMOPID) ?60,"CMOP ID#: ",CMOPID W:$D(VAPN) !,"VA PRODUCT NAME: ",?17,VAPN W:$D(CMOP) ?60,"CMOP DISPENSE: ",CMOP
"RTN","PSSLOOK",60,0)
 W:$D(OINM) !,"ORDERABLE ITEM: ",?17,OINM W:$D(VAPN) ?60,"NDF DF: ",VADF
"RTN","PSSLOOK",61,0)
 I $D(OIPTR),OIPTR]"" W !,"ORDERABLE ITEM TEXT: ",! D OITXT
"RTN","PSSLOOK",62,0)
 W:$D(PD) !,"PRIMARY DRUG: ",?17,PD
"RTN","PSSLOOK",63,0)
 W !,"SYNONYM(S): " D SYN D FULL Q:$G(QUIT)  W !,"MESSAGE: ",MESS,!
"RTN","PSSLOOK",64,0)
 D FULL Q:$G(QUIT)  F XX=1:1:77 W "-"
"RTN","PSSLOOK",65,0)
 W !
"RTN","PSSLOOK",66,0)
 D FULL Q:$G(QUIT)  W "DEA, SPECIAL HDLG: ",DEA,?48,"NDC: ",?63,NDC
"RTN","PSSLOOK",67,0)
 S DAW=+$$GET1^DIQ(50,IFN,81)
"RTN","PSSLOOK",68,0)
 D FULL Q:$G(QUIT)  W !,"DAW CODE:  ",DAW," - ",$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSSLOOK",69,0)
 D FULL Q:$G(QUIT)  W !,"CS FEDERAL SCHEDULE: ",$G(CSF)
"RTN","PSSLOOK",70,0)
 D FULL Q:$G(QUIT)  W !,"INACTIVE DATE: ",ACT
"RTN","PSSLOOK",71,0)
 D FULL Q:$G(QUIT)  W:$D(QDM) !,"QUANTITY DISPENSE MESSAGE: ",QDM,!
"RTN","PSSLOOK",72,0)
 D FULL Q:$G(QUIT)  I WRN]"" W !,"WARNING LABEL: " S X=WRN F Z0=1:1 Q:$P(X,",",Z0,99)=""  S Z1=$P(X,",",Z0) W:$D(^PS(54,Z1,0)) ?19,$P(^(0),"^",1),! I '$D(^(0)) W ?19,"NO SUCH WARNING LABEL" K X Q
"RTN","PSSLOOK",73,0)
 D FULL Q:$G(QUIT)  S PSSLOOK=1 D
"RTN","PSSLOOK",74,0)
 .N DRUG
"RTN","PSSLOOK",75,0)
 .I $P($G(^PSDRUG(IFN,0)),"^")="" K PSSLOOK Q
"RTN","PSSLOOK",76,0)
 .S PSSWSITE=+$O(^PS(59.7,0)) W !,"WARNING LABEL SOURCE is " D
"RTN","PSSLOOK",77,0)
 ..I $P($G(^PS(59.7,PSSWSITE,10)),"^",9)="N" W "set to 'NEW'" Q
"RTN","PSSLOOK",78,0)
 ..W "not set to 'NEW'"
"RTN","PSSLOOK",79,0)
 .K PSSWRN
"RTN","PSSLOOK",80,0)
 .D FULL Q:$G(QUIT)  W !,"NEW WARNING LABEL:"
"RTN","PSSLOOK",81,0)
 .S ^TMP("PSSWRNB",$J,$P(^PSDRUG(IFN,0),"^"))="" D ^PSSWRNE
"RTN","PSSLOOK",82,0)
 .K PSSLOOK,^TMP("PSSWRNB",$J),PSSWRN
"RTN","PSSLOOK",83,0)
 D FULL Q:$G(QUIT)  W:'$D(QDM) ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",84,0)
 D FULL Q:$G(QUIT)  W !
"RTN","PSSLOOK",85,0)
 W "ORDER UNIT: ",?27 W:$D(OU) OU W ?40,"PRICE/ORDER UNIT: ",?67,PPOU
"RTN","PSSLOOK",86,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNIT: ",?27,DU W:$D(VADU) ?40,"VA DISPENSE UNIT: ",?67,VADU
"RTN","PSSLOOK",87,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNITS/ORDER UNIT: ",?21,DUPOU,?40,"PRICE/DISPENSE UNIT: ",?67,PPDU
"RTN","PSSLOOK",88,0)
 D FULL Q:$G(QUIT)  W !,"APPL PKG USE:" D PACK
"RTN","PSSLOOK",89,0)
 Q
"RTN","PSSLOOK",90,0)
PACK S APPL="" S:'$D(APP) APPL="  NONE"
"RTN","PSSLOOK",91,0)
 I $D(APP) D
"RTN","PSSLOOK",92,0)
 . S:APP["O" APPL=APPL_"  Outpatient" S:APP["U" APPL=APPL_"  Unit Dose"
"RTN","PSSLOOK",93,0)
 . S:APP["I" APPL=APPL_"  IV" S:APP["W" APPL=APPL_"  Ward Stock"
"RTN","PSSLOOK",94,0)
 . S:APP["N" APPL=APPL_"  Control Subs" S:APP["X" APPL=APPL_"  Non-VA Med"
"RTN","PSSLOOK",95,0)
 . S:APPL="" APPL="  NONE"
"RTN","PSSLOOK",96,0)
 W ?13,APPL
"RTN","PSSLOOK",97,0)
 I $P(PSSNODE,"^",2) S (PSSCALC,PSSUNIT)=$P($G(^PS(50.607,+$P(PSSNODE,U,2),0)),U),PSSSTR=$P(PSSNODE,"^")
"RTN","PSSLOOK",98,0)
 I $G(PSSUNIT)'="",$G(PSSUNIT)["/" D UNCALC
"RTN","PSSLOOK",99,0)
 D FULL Q:$G(QUIT)  W !,"STRENGTH: ",$P(PSSNODE,U),?35,"UNIT: ",$G(PSSCALC)
"RTN","PSSLOOK",100,0)
 D FULL Q:$G(QUIT)  W !,"POSSIBLE DOSAGES:"
"RTN","PSSLOOK",101,0)
 I $D(^PSDRUG(IFN,"DOS1",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS1",PDS)) Q:'PDS  D
"RTN","PSSLOOK",102,0)
 .S POSDOS=^PSDRUG(IFN,"DOS1",PDS,0)
"RTN","PSSLOOK",103,0)
 .D FULL Q:$G(QUIT)  W !,"   DISPENSE UNITS PER DOSE: ",$P(POSDOS,U),?40,"DOSE: ",$P(POSDOS,U,2),?55,"PACKAGE: ",$P(POSDOS,U,3)
"RTN","PSSLOOK",104,0)
 .D FULL Q:$G(QUIT)  W !,"       BCMA UNITS PER DOSE: ",$P(POSDOS,U,4)
"RTN","PSSLOOK",105,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL POSSIBLE DOSAGES:"
"RTN","PSSLOOK",106,0)
 I $D(^PSDRUG(IFN,"DOS2",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS2",PDS)) Q:'PDS  D
"RTN","PSSLOOK",107,0)
 .S LPDOS=^PSDRUG(IFN,"DOS2",PDS,0)
"RTN","PSSLOOK",108,0)
 .D FULL Q:$G(QUIT)  W !,"   LOCAL POSSIBLE DOSAGE: " D
"RTN","PSSLOOK",109,0)
 ..I $L($P(LPDOS,U))'>27 W $P(LPDOS,U),?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",110,0)
 ..E   W !,?10,$P(LPDOS,U),!,?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",111,0)
 ..D FULL Q:$G(QUIT)  W !,"     BCMA UNITS PER DOSE: ",$P(LPDOS,U,3)
"RTN","PSSLOOK",112,0)
 D FULL Q:$G(QUIT)  W ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",113,0)
 D FULL Q:$G(QUIT)  W !,"VA CLASS: ",$G(CLASS)
"RTN","PSSLOOK",114,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL NON-FORMULARY: ",$G(NF),"          ","VISN NON-FORMULARY: ",$G(VNF)
"RTN","PSSLOOK",115,0)
 N DA,K,LIST,PSXDN,PSXGN,PSXVP,X,XX1,XX2
"RTN","PSSLOOK",116,0)
 K PSXGN,PSXVP I $D(^PSDRUG(IFN,"ND")) S PSXDN=$G(^PSDRUG(IFN,"ND")),PSXGN=$P(PSXDN,"^"),PSXVP=$P(PSXDN,"^",3)
"RTN","PSSLOOK",117,0)
 I $G(PSXGN),$G(PSXVP) S X=$$PROD2^PSNAPIS(PSXGN,PSXVP),XX1=$$FORMI^PSNAPIS(PSXGN,PSXVP)
"RTN","PSSLOOK",118,0)
 D FULL Q:$G(QUIT)  W !,"National Formulary Indicator: "_$S($G(XX1)=1:"YES",$G(XX1)=0:"NO",1:"Not Matched to NDF")
"RTN","PSSLOOK",119,0)
 I $D(^PSDRUG(IFN,65,0)) D FULL Q:$G(QUIT)  W !,"FORMULARY ALTERNATIVES: ",! F FA=0:0 S FA=$O(^PSDRUG(IFN,65,FA)) Q:'FA  S LDFPTR=$P($G(^PSDRUG(IFN,65,FA,0)),"^") I LDFPTR D FULL Q:$G(QUIT)  W ?26,$P($G(^PSDRUG(LDFPTR,0)),"^"),!
"RTN","PSSLOOK",120,0)
 D FULL Q:$G(QUIT)  I $G(PSXGN),$G(PSXVP) W !,"National Restriction: " S XX2=$$FORMRX^PSNAPIS(PSXGN,PSXVP,.LIST) I $G(XX2)=1,$D(LIST) F XX2=0:0 S XX2=$O(LIST(XX2)) Q:'XX2  D FULL Q:$G(QUIT)  W !,LIST(XX2,0)
"RTN","PSSLOOK",121,0)
 W !,"Local Drug Text: ",! I $D(^PSDRUG(IFN,9,0)) D LDT
"RTN","PSSLOOK",122,0)
 Q
"RTN","PSSLOOK",123,0)
LDT F TXT1=0:0 S TXT1=$O(^PSDRUG(IFN,9,TXT1)) Q:'TXT1  S TEXPTR=^PSDRUG(IFN,9,TXT1,0) F PPP=0:0 S PPP=$O(^PS(51.7,TEXPTR,2,PPP)) Q:'PPP  S PST=$P($G(^PS(51.7,TEXPTR,0)),"^",2) I 'PST S WPT=^PS(51.7,TEXPTR,2,PPP,0) D FULL Q:$G(QUIT)  W WPT,!
"RTN","PSSLOOK",124,0)
 ;
"RTN","PSSLOOK",125,0)
 ;
"RTN","PSSLOOK",126,0)
KILL K IFN,APP,INT,VADU,VAGN,VAPN,VAPRN,P3,VAGNPTR,MESS,CLASS,DEA,ACT,CL,CLPTR,CMOP,DF,DFPTR,DU,DUPOUGN,IFCAPNM,NDC,NDE,NDNODE,NF,NODE0,NODE2,OI,OINM,OIPTR,OU,PD,PDPTR,PPDU,PPOU,PS,PT,NOD66,SYNM,SZPTR,TYPTR,WARN,WRN,XX,ZZZ,SS,OUPTR,CMOPID
"RTN","PSSLOOK",127,0)
 K DUPOU,QQQ,GN,QDM,APPL,VADF,DFP,DFRM,Y,Z0,Z1,DDD,PPP,TEXT,TXTPTR,TXT,TXT1,TEXPTR,VNF,WPT,FA,LDFPTR,TEXTPTR,QUIT,PST,D0,DA,K,DIR
"RTN","PSSLOOK",128,0)
 K PSSNODE,PSDOSUN,PDS,POSDOS,LPDOS,CSF
"RTN","PSSLOOK",129,0)
 Q
"RTN","PSSLOOK",130,0)
OITXT I $D(^PS(50.7,OIPTR,1,0)) F TXT=0:0 S TXT=$O(^PS(50.7,OIPTR,1,TXT)) Q:'TXT  S TEXTPTR=^PS(50.7,OIPTR,1,TXT,0) F DDD=0:0 S DDD=$O(^PS(51.7,TEXTPTR,2,DDD)) Q:'DDD  D IDATE I 'Y2K S TEXT=^PS(51.7,TEXTPTR,2,DDD,0) D FULL Q:$G(QUIT)  W TEXT,!
"RTN","PSSLOOK",131,0)
 Q
"RTN","PSSLOOK",132,0)
FULL D:($Y+5)>IOSL&('$G(QUIT)) FSCRN
"RTN","PSSLOOK",133,0)
 Q
"RTN","PSSLOOK",134,0)
FSCRN Q:$G(QUIT)  W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR W @IOF S:Y'=1 QUIT=1
"RTN","PSSLOOK",135,0)
 Q
"RTN","PSSLOOK",136,0)
IDATE S Y2K=$P($G(^PS(51.7,TEXTPTR,0)),"^",2)
"RTN","PSSLOOK",137,0)
 Q
"RTN","PSSLOOK",138,0)
UNCALC ;
"RTN","PSSLOOK",139,0)
 N PSSVA,PSSVA1,PSSVB,PSSVB1,PSSDASH,PSSNDFS,PSSDASH2,PSSDASH3,PSSDASH5 K PSSCALC
"RTN","PSSLOOK",140,0)
 S PSSDASH=0 S PSSNDFS=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(IFN,"ND")),"^"),+$P($G(^PSDRUG(IFN,"ND")),"^",3)) S PSSNDFS=+$P($G(PSSNDFS),"^",2)
"RTN","PSSLOOK",141,0)
 I $G(PSSNDFS),$G(PSSSTR),+$G(PSSSTR)'=+$G(PSSNDFS) S PSSDASH=1
"RTN","PSSLOOK",142,0)
 S PSSVA=$P(PSSUNIT,"/"),PSSVB=$P(PSSUNIT,"/",2),PSSVA1=+$G(PSSVA),PSSVB1=+$G(PSSVB)
"RTN","PSSLOOK",143,0)
 I $G(PSSDASH) S PSSDASH2=PSSSTR/PSSNDFS,PSSDASH3=PSSDASH2*$S($G(PSSVB1):PSSVB1,1:1) S PSSDASH5=$S('$G(PSSVB1):PSSDASH3_$G(PSSVB),1:PSSDASH3_$P(PSSVB,PSSVB1,2))
"RTN","PSSLOOK",144,0)
 S PSSCALC=$S($G(PSSDASH):$S('$G(PSSVA1):PSSVA,1:$P(PSSVA1,PSSVA1,2))_"/"_$G(PSSDASH5),1:PSSUNIT)
"RTN","PSSLOOK",145,0)
 Q
"RTN","PSSNDCUT")
0^1^B4760746
"RTN","PSSNDCUT",1,0)
PSSNDCUT ;BIRM/MFR - NDC Utilities ;10/15/04
"RTN","PSSNDCUT",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**90**;9/30/97
"RTN","PSSNDCUT",3,0)
 ;
"RTN","PSSNDCUT",4,0)
SAVNDC(DRG,SITE,NDC,CMP) ; Saves the NDC in the DRUG file (Format: 5-4-2)
"RTN","PSSNDCUT",5,0)
 ; Input: (r) DRG  - Drug IEN (#50)
"RTN","PSSNDCUT",6,0)
 ;        (r) SITE - Outpatient Site IEN (#59)
"RTN","PSSNDCUT",7,0)
 ;        (r) NDC  - NDC Number
"RTN","PSSNDCUT",8,0)
 ;        (o) CMP  - CMOP? (1-YES/0-NO)
"RTN","PSSNDCUT",9,0)
 N RFL,DIE,DIC,DA,DR,I,DD,DO,DINUM,X,Y
"RTN","PSSNDCUT",10,0)
 ;
"RTN","PSSNDCUT",11,0)
 S NDC=$$NDCFMT(NDC) I NDC="" Q
"RTN","PSSNDCUT",12,0)
 ;
"RTN","PSSNDCUT",13,0)
 ;- Saving the NDC in the DRUG file (#50)
"RTN","PSSNDCUT",14,0)
 I '$D(^PSDRUG(DRG,"NDCOP",SITE)) D
"RTN","PSSNDCUT",15,0)
 . S DIC="^PSDRUG("_DRG_",""NDCOP"","
"RTN","PSSNDCUT",16,0)
 . S (X,DINUM)=SITE,DA(1)=DRG,DIC(0)=""
"RTN","PSSNDCUT",17,0)
 . K DD,DO D FILE^DICN K DD,DO,DINUM,Y
"RTN","PSSNDCUT",18,0)
 ;
"RTN","PSSNDCUT",19,0)
 K DA,DIE,DR S DIE="^PSDRUG("_DRG_",""NDCOP"","
"RTN","PSSNDCUT",20,0)
 S DA(1)=DRG,DA=SITE,DR=$S($G(CMP):2,1:1)_"///"_NDC
"RTN","PSSNDCUT",21,0)
 D ^DIE
"RTN","PSSNDCUT",22,0)
 Q
"RTN","PSSNDCUT",23,0)
 ;
"RTN","PSSNDCUT",24,0)
GETNDC(DRG,SITE,CMOP) ; Retuns the NDC for a specific Drug/Site/CMOP or NON-CMOP
"RTN","PSSNDCUT",25,0)
 N NDC,NDF
"RTN","PSSNDCUT",26,0)
 ;
"RTN","PSSNDCUT",27,0)
 I '$D(CMOP) S CMOP=$S($D(^PSDRUG("AQ",DRG)):1,1:0)
"RTN","PSSNDCUT",28,0)
 ; - LOCAL NDC by DIVISION
"RTN","PSSNDCUT",29,0)
 I $G(SITE),'CMOP S NDC=$$NDCFMT($$GET1^DIQ(50.032,SITE_","_DRG,1)) I NDC'="" Q NDC
"RTN","PSSNDCUT",30,0)
 ; - CMOP NDC by DIVISION
"RTN","PSSNDCUT",31,0)
 I $G(SITE),CMOP S NDC=$$NDCFMT($$GET1^DIQ(50.032,SITE_","_DRG,2)) I NDC'="" Q NDC
"RTN","PSSNDCUT",32,0)
 ; - Drug File NDC
"RTN","PSSNDCUT",33,0)
 S NDC=$$NDCFMT($$GET1^DIQ(50,DRG,31)) I NDC'="" Q NDC
"RTN","PSSNDCUT",34,0)
 ; - National Drug File NDC
"RTN","PSSNDCUT",35,0)
 I NDC="" S NDF=+$$GET1^DIQ(50,DRG,22,"I") I NDF'="" S NDC=$$NDCFMT($$GET1^DIQ(50.68,NDF,13)) I NDC'="" Q NDC
"RTN","PSSNDCUT",36,0)
 Q NDC
"RTN","PSSNDCUT",37,0)
 ;
"RTN","PSSNDCUT",38,0)
NDCFMT(NDC) ; Formats NDC codes into 5-4-2
"RTN","PSSNDCUT",39,0)
 N S1,S2,S3
"RTN","PSSNDCUT",40,0)
 I '$$CHKCH(NDC) Q ""
"RTN","PSSNDCUT",41,0)
 I NDC?.N,NDC'?11N Q ""
"RTN","PSSNDCUT",42,0)
 I NDC?11N Q ($E(NDC,1,5)_"-"_$E(NDC,6,9)_"-"_$E(NDC,10,11))
"RTN","PSSNDCUT",43,0)
 ;
"RTN","PSSNDCUT",44,0)
 I $L(NDC,"-")'=3 Q ""
"RTN","PSSNDCUT",45,0)
 S S1=$P(NDC,"-"),S2=$P(NDC,"-",2),S3=$P(NDC,"-",3)
"RTN","PSSNDCUT",46,0)
 I '$L(S1)!'$L(S2)!'$L(S3) Q ""
"RTN","PSSNDCUT",47,0)
 I $L(S1)>6!($L(S2)>4)!($L(S3)>2) Q ""
"RTN","PSSNDCUT",48,0)
 ;
"RTN","PSSNDCUT",49,0)
 S:$L(S1)>5 S1=$E(S1,$L(S1)-4,$L(S1))
"RTN","PSSNDCUT",50,0)
 S:$L(S1)<5 S1=$E(S1+100000,2,6)
"RTN","PSSNDCUT",51,0)
 S S2=$E(S2+10000,2,5)
"RTN","PSSNDCUT",52,0)
 S S3=$E(S3+100,2,3)
"RTN","PSSNDCUT",53,0)
 ;
"RTN","PSSNDCUT",54,0)
 Q (S1_"-"_S2_"-"_S3)
"RTN","PSSNDCUT",55,0)
 ;
"RTN","PSSNDCUT",56,0)
CHKCH(STR)      ; Checks characters different from "-" and numbers
"RTN","PSSNDCUT",57,0)
 N CHKCH
"RTN","PSSNDCUT",58,0)
 I STR="" Q 0
"RTN","PSSNDCUT",59,0)
 S CHKCH=1 F I=1:1:$L(STR) I $E(STR,I)'?1N,$E(STR,I)'?1"-" S CHKCH=0 Q
"RTN","PSSNDCUT",60,0)
 Q CHKCH
"UP",50,50.032,-1)
50^NDCOP
"UP",50,50.032,0)
50.032
"VER")
8.0^22.0
"^DD",50,50,32,0)
NDC BY OUTPATIENT SITE^50.032P^^NDCOP;0
"^DD",50,50,81,0)
DAW CODE^NJ2,0X^^EPH;1^D INPUT^PSSDAWUT
"^DD",50,50,81,3)
Dispensed As Written code. This information is used for NCPDP electronic claim transmission to third party payers (insurance companies).
"^DD",50,50,81,4)
D HLP^PSSDAWUT
"^DD",50,50,81,21,0)
^.001^1^1^3051109^^^^
"^DD",50,50,81,21,1,0)
Dispensed As Written code. This information is used for NCPDP electronic claim transmission to third party payers (insurance companies).
"^DD",50,50,81,"DT")
3051108
"^DD",50,50.032,0)
NDC BY OUTPATIENT SITE SUB-FIELD^^2^3
"^DD",50,50.032,0,"DIK")
PSOXR
"^DD",50,50.032,0,"DT")
3041015
"^DD",50,50.032,0,"IX","B",50.032,.01)

"^DD",50,50.032,0,"NM","NDC BY OUTPATIENT SITE")

"^DD",50,50.032,0,"UP")
50
"^DD",50,50.032,.01,0)
OUTPATIENT SITE^P59'^PS(59,^0;1^Q
"^DD",50,50.032,.01,1,0)
^.1
"^DD",50,50.032,.01,1,1,0)
50.032^B
"^DD",50,50.032,.01,1,1,1)
S ^PSDRUG(DA(1),"NDCOP","B",$E(X,1,30),DA)=""
"^DD",50,50.032,.01,1,1,2)
K ^PSDRUG(DA(1),"NDCOP","B",$E(X,1,30),DA)
"^DD",50,50.032,.01,"DT")
3041015
"^DD",50,50.032,1,0)
LAST LOCAL NDC^F^^0;2^K:$L(X)>15!($L(X)<5) X
"^DD",50,50.032,1,3)
Answer must be 5-15 characters in length
"^DD",50,50.032,1,21,0)
^^5^5^3041015^^
"^DD",50,50.032,1,21,1,0)
This field contains the last NDC number dispensed from a window fill
"^DD",50,50.032,1,21,2,0)
for this drug by a specific Division. It is used to present a default
"^DD",50,50.032,1,21,3,0)
NDC number to the  finishing pharmacist.  They may use this number or
"^DD",50,50.032,1,21,4,0)
enter a different one  based on the NDC number on the bottle they are
"^DD",50,50.032,1,21,5,0)
filling the prescription.
"^DD",50,50.032,1,"DT")
3041015
"^DD",50,50.032,2,0)
LAST CMOP NDC^F^^0;3^K:$L(X)>15!($L(X)<5) X
"^DD",50,50.032,2,3)
Answer must be 5-15 characters in length
"^DD",50,50.032,2,21,0)
^^3^3^3041015^
"^DD",50,50.032,2,21,1,0)
This field contains the last NDC number dispensed by a CMOP Center for
"^DD",50,50.032,2,21,2,0)
this drug for a specific division. It is to as a default NDC Number for
"^DD",50,50.032,2,21,3,0)
the next CMOP prescription for the same drug and division. 
"^DD",50,50.032,2,"DT")
3041015
"BLD",5099,6)
^98
**END**
**END**
