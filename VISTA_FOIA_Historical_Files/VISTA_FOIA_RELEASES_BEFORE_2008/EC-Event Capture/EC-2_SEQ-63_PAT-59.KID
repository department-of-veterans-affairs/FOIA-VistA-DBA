Released EC*2*59 SEQ #63
Extracted from mail message
**KIDS**:EC*2.0*59^

**INSTALL NAME**
EC*2.0*59
"BLD",5368,0)
EC*2.0*59^EVENT CAPTURE^0^3040317^y
"BLD",5368,1,0)
^^2^2^3040301^^
"BLD",5368,1,1,0)
This patch addresses NOISes related to the Event Capture GUI and
"BLD",5368,1,2,0)
roll-n-scroll.
"BLD",5368,4,0)
^9.64PA^724^1
"BLD",5368,4,724,0)
724
"BLD",5368,4,724,2,0)
^9.641^724^1
"BLD",5368,4,724,2,724,0)
DSS UNIT  (File-top level)
"BLD",5368,4,724,2,724,1,0)
^9.6411^10^1
"BLD",5368,4,724,2,724,1,10,0)
CATEGORY (Y/N)
"BLD",5368,4,724,222)
y^y^p^^^^n^^n
"BLD",5368,4,724,224)

"BLD",5368,4,"APDD",724,724)

"BLD",5368,4,"APDD",724,724,10)

"BLD",5368,4,"B",724,724)

"BLD",5368,"KRN",0)
^9.67PA^8989.52^19
"BLD",5368,"KRN",.4,0)
.4
"BLD",5368,"KRN",.401,0)
.401
"BLD",5368,"KRN",.402,0)
.402
"BLD",5368,"KRN",.403,0)
.403
"BLD",5368,"KRN",.5,0)
.5
"BLD",5368,"KRN",.84,0)
.84
"BLD",5368,"KRN",3.6,0)
3.6
"BLD",5368,"KRN",3.8,0)
3.8
"BLD",5368,"KRN",9.2,0)
9.2
"BLD",5368,"KRN",9.8,0)
9.8
"BLD",5368,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5368,"KRN",9.8,"NM",1,0)
ECUERPC^^0^B50183608
"BLD",5368,"KRN",9.8,"NM","B","ECUERPC",1)

"BLD",5368,"KRN",19,0)
19
"BLD",5368,"KRN",19,"NM",0)
^9.68A^^
"BLD",5368,"KRN",19.1,0)
19.1
"BLD",5368,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5368,"KRN",101,0)
101
"BLD",5368,"KRN",409.61,0)
409.61
"BLD",5368,"KRN",771,0)
771
"BLD",5368,"KRN",870,0)
870
"BLD",5368,"KRN",8989.51,0)
8989.51
"BLD",5368,"KRN",8989.52,0)
8989.52
"BLD",5368,"KRN",8994,0)
8994
"BLD",5368,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",5368,"KRN","B",.4,.4)

"BLD",5368,"KRN","B",.401,.401)

"BLD",5368,"KRN","B",.402,.402)

"BLD",5368,"KRN","B",.403,.403)

"BLD",5368,"KRN","B",.5,.5)

"BLD",5368,"KRN","B",.84,.84)

"BLD",5368,"KRN","B",3.6,3.6)

"BLD",5368,"KRN","B",3.8,3.8)

"BLD",5368,"KRN","B",9.2,9.2)

"BLD",5368,"KRN","B",9.8,9.8)

"BLD",5368,"KRN","B",19,19)

"BLD",5368,"KRN","B",19.1,19.1)

"BLD",5368,"KRN","B",101,101)

"BLD",5368,"KRN","B",409.61,409.61)

"BLD",5368,"KRN","B",771,771)

"BLD",5368,"KRN","B",870,870)

"BLD",5368,"KRN","B",8989.51,8989.51)

"BLD",5368,"KRN","B",8989.52,8989.52)

"BLD",5368,"KRN","B",8994,8994)

"BLD",5368,"QUES",0)
^9.62^^
"BLD",5368,"REQB",0)
^9.611^1^1
"BLD",5368,"REQB",1,0)
EC*2.0*47^2
"BLD",5368,"REQB","B","EC*2.0*47",1)

"FIA",724)
DSS UNIT
"FIA",724,0)
^ECD(
"FIA",724,0,0)
724I
"FIA",724,0,1)
y^y^p^^^^n^^n
"FIA",724,0,10)

"FIA",724,0,11)

"FIA",724,0,"RLRO")

"FIA",724,0,"VR")
2.0^EC
"FIA",724,724)
1
"FIA",724,724,10)

"MBREQ")
0
"PKG",486,-1)
1^1
"PKG",486,0)
EVENT CAPTURE^EC^Event Capture Workload Capture System^
"PKG",486,20,0)
^9.402P^^
"PKG",486,22,0)
^9.49I^1^1
"PKG",486,22,1,0)
2.0^2960508^2981027^66481
"PKG",486,22,1,"PAH",1,0)
59^3040317
"PKG",486,22,1,"PAH",1,1,0)
^^2^2^3040317
"PKG",486,22,1,"PAH",1,1,1,0)
This patch addresses NOISes related to the Event Capture GUI and
"PKG",486,22,1,"PAH",1,1,2,0)
roll-n-scroll.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ECUERPC")
0^1^B50183608
"RTN","ECUERPC",1,0)
ECUERPC ;ALB/JAM;Event Capture Data Entry Broker Utilities ;Aug 16, 2000
"RTN","ECUERPC",2,0)
 ;;2.0; EVENT CAPTURE ;**25,32,33,46,47,59**;8 May 96
"RTN","ECUERPC",3,0)
 ;
"RTN","ECUERPC",4,0)
USRUNT(RESULTS,ECARY) ;
"RTN","ECUERPC",5,0)
 ;
"RTN","ECUERPC",6,0)
 ;This broker call returns an array of DSS units for a user & location
"RTN","ECUERPC",7,0)
 ;        RPC: EC GETUSRDSSUNIT
"RTN","ECUERPC",8,0)
 ;INPUTS        ECARY  - Contains the following subscripted elements
"RTN","ECUERPC",9,0)
 ;               1. ECL   - Location IEN (if define gives User's DSS 
"RTN","ECUERPC",10,0)
 ;                          units for a location)
"RTN","ECUERPC",11,0)
 ;               2. ECDUZ - New Person IEN (if define gives list of 
"RTN","ECUERPC",12,0)
 ;                          DSS Units available to user)
"RTN","ECUERPC",13,0)
 ;
"RTN","ECUERPC",14,0)
 ;OUTPUTS        RESULTS - Array of DSS Units. Data pieces as follows:-
"RTN","ECUERPC",15,0)
 ;               PIECE - Description
"RTN","ECUERPC",16,0)
 ;                 1     IEN of file 724
"RTN","ECUERPC",17,0)
 ;                 2     Name of DSS Unit
"RTN","ECUERPC",18,0)
 ;                 3     Send to PCE Flag
"RTN","ECUERPC",19,0)
 ;                 4     Data Entry Date/Time Default
"RTN","ECUERPC",20,0)
 N ECL,ECDUZ,CNT,STR,DPT,IEN
"RTN","ECUERPC",21,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",22,0)
 S ECL=$P(ECARY,U),ECDUZ=$P(ECARY,U,2) I ECL="",ECDUZ="" Q
"RTN","ECUERPC",23,0)
 ;S ECDUZ=$G(DUZ,U),ECL=$P(ECARY,U) I (ECDUZ="")!(ECL="") Q
"RTN","ECUERPC",24,0)
 K ^TMP($J,"ECUSRUNT") S (DPT,CNT)=0
"RTN","ECUERPC",25,0)
 I ECL'="",ECDUZ="" S ECDUZ=$G(DUZ,U) I ECDUZ="" Q
"RTN","ECUERPC",26,0)
 I $D(^XUSEC("ECALLU",ECDUZ)) S DPT="" D
"RTN","ECUERPC",27,0)
 .I ECL="" S ^TMP($J,"ECUSRUNT",CNT+1)="ALL^ALL" Q
"RTN","ECUERPC",28,0)
 .I ECL="ALL" S ECL=""
"RTN","ECUERPC",29,0)
 .F  S DPT=$O(^ECD("B",DPT))  Q:DPT=""  S IEN=0 D
"RTN","ECUERPC",30,0)
 ..F  S IEN=$O(^ECD("B",DPT,IEN)) Q:'IEN  D UNTCHK
"RTN","ECUERPC",31,0)
 E  D
"RTN","ECUERPC",32,0)
 .I ECL="ALL" S ECL=""
"RTN","ECUERPC",33,0)
 .F  S DPT=$O(^VA(200,ECDUZ,"EC",DPT)) Q:'DPT  S IEN=DPT D UNTCHK
"RTN","ECUERPC",34,0)
 S RESULTS=$NA(^TMP($J,"ECUSRUNT"))
"RTN","ECUERPC",35,0)
 Q
"RTN","ECUERPC",36,0)
UNTCHK ;Check if DSS unit exist as event code screen and if active
"RTN","ECUERPC",37,0)
 N DSSF,DFD
"RTN","ECUERPC",38,0)
 ;I '$D(^ECJ("AP",ECL,IEN))!($P($G(^ECD(IEN,0)),U,6)) Q
"RTN","ECUERPC",39,0)
 I ECL'="",'$D(^ECJ("AP",ECL,IEN)) Q
"RTN","ECUERPC",40,0)
 I ($P($G(^ECD(IEN,0)),U,6))!('$P($G(^ECD(IEN,0)),U,8)) Q
"RTN","ECUERPC",41,0)
 S DSSF=$P(^ECD(IEN,0),"^",14) S:DSSF="" DSSF="N"
"RTN","ECUERPC",42,0)
 S DFD=$S($P(^ECD(IEN,0),"^",12)="N":"N",1:"X") ; added by VMP
"RTN","ECUERPC",43,0)
 S CNT=CNT+1,STR=IEN_"^"_$P(^ECD(IEN,0),"^")_U_DSSF_"^"_DFD
"RTN","ECUERPC",44,0)
 S ^TMP($J,"ECUSRUNT",CNT)=STR
"RTN","ECUERPC",45,0)
 Q
"RTN","ECUERPC",46,0)
CAT(RESULTS,ECARY) ;
"RTN","ECUERPC",47,0)
 ;
"RTN","ECUERPC",48,0)
 ;This broker entry point returns an array of categories for an Event 
"RTN","ECUERPC",49,0)
 ;Code screen based on location and DSS unit.
"RTN","ECUERPC",50,0)
 ;        RPC: EC GETECSCATS
"RTN","ECUERPC",51,0)
 ;INPUTS        ECARY  - Contains the following values separated by "^"
"RTN","ECUERPC",52,0)
 ;               ECL  - Location IEN
"RTN","ECUERPC",53,0)
 ;               ECD  - DSS Unit IEN
"RTN","ECUERPC",54,0)
 ;               ECCSTA-Active or inactive category
"RTN","ECUERPC",55,0)
 ;                      A-ctive (default), I-nactive, B-oth
"RTN","ECUERPC",56,0)
 ;
"RTN","ECUERPC",57,0)
 ;OUTPUTS        RESULTS - Array of categories. Data pieces as follows:-
"RTN","ECUERPC",58,0)
 ;               PIECE - Description
"RTN","ECUERPC",59,0)
 ;                 1  - Category IEN
"RTN","ECUERPC",60,0)
 ;                 2  - Category description
"RTN","ECUERPC",61,0)
 ;
"RTN","ECUERPC",62,0)
 N ECL,ECD,ECC,CNT,DATA,ECCSTA
"RTN","ECUERPC",63,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",64,0)
 S ECL=$P(ECARY,U),ECD=$P(ECARY,U,2) I (ECL="")!(ECD="") Q
"RTN","ECUERPC",65,0)
 S ECCSTA=$P(ECARY,U,3)
"RTN","ECUERPC",66,0)
 K ^TMP($J,"ECSCATS")
"RTN","ECUERPC",67,0)
 D CATS^ECHECK1
"RTN","ECUERPC",68,0)
 M ^TMP($J,"ECSCATS")=ECC
"RTN","ECUERPC",69,0)
 S RESULTS=$NA(^TMP($J,"ECSCATS"))
"RTN","ECUERPC",70,0)
 Q
"RTN","ECUERPC",71,0)
PROC(RESULTS,ECARY) ;
"RTN","ECUERPC",72,0)
 ;
"RTN","ECUERPC",73,0)
 ;This broker entry point returns an array of procedures for an Event 
"RTN","ECUERPC",74,0)
 ;Code screen (file #720.3) based on location, DSS unit, and Category
"RTN","ECUERPC",75,0)
 ;        RPC: EC GETECSPROCS
"RTN","ECUERPC",76,0)
 ;INPUTS        ECARY  - Contains the following values separated by "^"
"RTN","ECUERPC",77,0)
 ;               ECL  - Location IEN
"RTN","ECUERPC",78,0)
 ;               ECD  - DSS Unit IEN
"RTN","ECUERPC",79,0)
 ;               ECC  - Category IEN
"RTN","ECUERPC",80,0)
 ;               ECDT - Procedure Date
"RTN","ECUERPC",81,0)
 ;
"RTN","ECUERPC",82,0)
 ;OUTPUTS        RESULTS - Array of procedures. Data pieces as follows:-
"RTN","ECUERPC",83,0)
 ;               PIECE - Description
"RTN","ECUERPC",84,0)
 ;                 1  - EC National Number SPACE Procedure Name SPACE
"RTN","ECUERPC",85,0)
 ;                   - [Synonym]
"RTN","ECUERPC",86,0)
 ;                 2  - Procedure Code
"RTN","ECUERPC",87,0)
 ;                 3  - CPT Code
"RTN","ECUERPC",88,0)
 ;                 4  - Default volume (1 if no default volume)
"RTN","ECUERPC",89,0)
 ;                 5  - Event code screen IEN
"RTN","ECUERPC",90,0)
 ;
"RTN","ECUERPC",91,0)
 N ECL,ECD,ECC,CNT,DATA,STR,ECCPT,PX
"RTN","ECUERPC",92,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",93,0)
 S ECL=$P(ECARY,U),ECD=$P(ECARY,U,2),ECC=$P(ECARY,U,3) S:ECC="" ECC=0
"RTN","ECUERPC",94,0)
 I (ECL="")!(ECD="") Q
"RTN","ECUERPC",95,0)
 S ECDT=$P(ECARY,U,4)
"RTN","ECUERPC",96,0)
 K ^TMP($J,"ECPRO")
"RTN","ECUERPC",97,0)
 D PROS^ECHECK1
"RTN","ECUERPC",98,0)
 S CNT=0 F  S CNT=$O(^TMP("ECPRO",$J,CNT)) Q:'CNT  D
"RTN","ECUERPC",99,0)
 .S DATA=^TMP("ECPRO",$J,CNT),PX=$P(DATA,U)
"RTN","ECUERPC",100,0)
 .S ECCPT=$S(PX["EC":$P($G(^EC(725,+PX,0)),"^",5),1:+PX)
"RTN","ECUERPC",101,0)
 .S STR=$P(DATA,U,5)_" "_$P(DATA,U,4)_" ["_$P(DATA,U,3)_"]"_U_PX
"RTN","ECUERPC",102,0)
 .S STR=STR_U_ECCPT_U_$S($P(DATA,U,6):+$P(DATA,U,6),1:1)_U_$P(DATA,U,2)
"RTN","ECUERPC",103,0)
 .S ^TMP($J,"ECPRO",CNT)=STR
"RTN","ECUERPC",104,0)
 S RESULTS=$NA(^TMP($J,"ECPRO"))
"RTN","ECUERPC",105,0)
 K ^TMP("ECPRO",$J)
"RTN","ECUERPC",106,0)
 Q
"RTN","ECUERPC",107,0)
ECPXMOD(RESULTS,ECARY) ;
"RTN","ECUERPC",108,0)
 ;
"RTN","ECUERPC",109,0)
 ;Broker call returns modifier entries for a CPT Procedure
"RTN","ECUERPC",110,0)
 ;        RPC: EC GETPXMODIFIER
"RTN","ECUERPC",111,0)
 ;INPUTS   ECARY  - Contains the following values separated by "^"
"RTN","ECUERPC",112,0)
 ;          ECCPT - CPT code ien (file #81)
"RTN","ECUERPC",113,0)
 ;          ECDT  - Procedure date and time (fileman format)
"RTN","ECUERPC",114,0)
 ;
"RTN","ECUERPC",115,0)
 ;OUTPUTS  RESULTS - Array of procedure modifiers
"RTN","ECUERPC",116,0)
 ;          2-character modifier^modifer name^modifier ien #81.3
"RTN","ECUERPC",117,0)
 ;
"RTN","ECUERPC",118,0)
 N CNT,SUB,ECCPT,ECDT,DATA,ECMOD
"RTN","ECUERPC",119,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",120,0)
 S ECCPT=$P(ECARY,U),ECDT=$P(ECARY,U,2) I ECDT="" D NOW^%DTC S ECDT=%
"RTN","ECUERPC",121,0)
 I ECCPT="" Q
"RTN","ECUERPC",122,0)
 K ^TMP($J,"ECPXMODS") S (SUB,CNT)=0
"RTN","ECUERPC",123,0)
 S DATA=$$CODM^ICPTCOD(ECCPT,"ECMOD","",ECDT) I +DATA<0 Q
"RTN","ECUERPC",124,0)
 F  S SUB=$O(ECMOD(SUB)) Q:SUB=""  D
"RTN","ECUERPC",125,0)
 . S CNT=CNT+1,^TMP($J,"ECPXMODS",CNT)=SUB_U_ECMOD(SUB)
"RTN","ECUERPC",126,0)
 S RESULTS=$NA(^TMP($J,"ECPXMODS"))
"RTN","ECUERPC",127,0)
 Q
"RTN","ECUERPC",128,0)
PRVDER(RESULTS,ECARY) ;
"RTN","ECUERPC",129,0)
 ;remove this rpc before release;JAM 6/4/01
"RTN","ECUERPC",130,0)
 ;This broker entry point returns an array of valid providers
"RTN","ECUERPC",131,0)
 ;        RPC: EC GETPROVIDER
"RTN","ECUERPC",132,0)
 ;INPUTS        ECARY  - Contains the following subscripted elements
"RTN","ECUERPC",133,0)
 ;               ECDT  - Procedure date
"RTN","ECUERPC",134,0)
 ;
"RTN","ECUERPC",135,0)
 ;OUTPUTS        RESULTS - Array of providers. Data pieces as follows:-
"RTN","ECUERPC",136,0)
 ;               PIECE - Description
"RTN","ECUERPC",137,0)
 ;                IEN of file 200^Provider Name^occupation^speciality^
"RTN","ECUERPC",138,0)
 ;                subspeciality
"RTN","ECUERPC",139,0)
 ;
"RTN","ECUERPC",140,0)
 N IEN,CNT,ECUTN,KEY,USR
"RTN","ECUERPC",141,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",142,0)
 S ECDT=$P($G(ECARY),U),ECDT=$S(ECDT="":DT,1:ECDT)
"RTN","ECUERPC",143,0)
 K ^TMP($J,"ECPRVDRS") S CNT=0
"RTN","ECUERPC",144,0)
 F KEY="PROVIDER" S IEN=0 D
"RTN","ECUERPC",145,0)
 .F  S IEN=$O(^XUSEC(KEY,IEN)) Q:'IEN  S USR=$G(^VA(200,IEN,0)) D:USR'=""
"RTN","ECUERPC",146,0)
 ..S ECUTN=$$GET^XUA4A72(IEN,ECDT) I +ECUTN'>0 Q
"RTN","ECUERPC",147,0)
 ..S CNT=CNT+1,^TMP($J,"ECPRVDRS",CNT)=IEN_U_$P(USR,U)_U_$P(ECUTN,2,4)
"RTN","ECUERPC",148,0)
 S RESULTS=$NA(^TMP($J,"ECPRVDRS"))
"RTN","ECUERPC",149,0)
 Q
"RTN","ECUERPC",150,0)
 ;
"RTN","ECUERPC",151,0)
ELIG(RESULTS,ECARY) ;
"RTN","ECUERPC",152,0)
 ;
"RTN","ECUERPC",153,0)
 ;Broker call returns a list of patient eligibilities
"RTN","ECUERPC",154,0)
 ;        RPC: EC GETPATELIG
"RTN","ECUERPC",155,0)
 ;INPUTS   ECARY  - Contains the following subscripted elements
"RTN","ECUERPC",156,0)
 ;          DFN - Patient ien (file #2)
"RTN","ECUERPC",157,0)
 ;
"RTN","ECUERPC",158,0)
 ;OUTPUTS  RESULTS - Array of eligibilities
"RTN","ECUERPC",159,0)
 ;          primary/secondary elig flag^elig ien^elig description
"RTN","ECUERPC",160,0)
 ;
"RTN","ECUERPC",161,0)
 N CNT,SUB,DFN,VAEL
"RTN","ECUERPC",162,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",163,0)
 S DFN=$P(ECARY,U) I DFN="" Q
"RTN","ECUERPC",164,0)
 K ^TMP($J,"ECPATELIG")
"RTN","ECUERPC",165,0)
 D ELIG^VADPT I $G(VAEL(1))="" Q
"RTN","ECUERPC",166,0)
 S ^TMP($J,"ECPATELIG",1)="1^"_VAEL(1),SUB=0,CNT=1
"RTN","ECUERPC",167,0)
 F  S SUB=$O(VAEL(1,SUB)) Q:SUB=""  D
"RTN","ECUERPC",168,0)
 . S CNT=CNT+1,^TMP($J,"ECPATELIG",CNT)="0^"_VAEL(1,SUB)
"RTN","ECUERPC",169,0)
 S RESULTS=$NA(^TMP($J,"ECPATELIG"))
"RTN","ECUERPC",170,0)
 Q
"RTN","ECUERPC",171,0)
PRDEFS(RESULTS,ECARY) ;
"RTN","ECUERPC",172,0)
 ;
"RTN","ECUERPC",173,0)
 ;This broker entry point returns the defaults for procedure data entry
"RTN","ECUERPC",174,0)
 ;        RPC: EC GETPRODEFS
"RTN","ECUERPC",175,0)
 ;INPUTS        ECARY  - Contains the following values separated by "^"
"RTN","ECUERPC",176,0)
 ;               ECL  - Location IEN
"RTN","ECUERPC",177,0)
 ;               ECD  - DSS Unit IEN
"RTN","ECUERPC",178,0)
 ;               ECC  - Category IEN
"RTN","ECUERPC",179,0)
 ;
"RTN","ECUERPC",180,0)
 ;OUTPUTS        RESULTS - Data pieces as follows:-
"RTN","ECUERPC",181,0)
 ;               PIECE - Description
"RTN","ECUERPC",182,0)
 ;                 1  - Associated Clinic IEN
"RTN","ECUERPC",183,0)
 ;                 2  - Associated Clinic
"RTN","ECUERPC",184,0)
 ;                 3  - Medical Speciality IEN
"RTN","ECUERPC",185,0)
 ;                 4  - Medical Speciality
"RTN","ECUERPC",186,0)
 ;
"RTN","ECUERPC",187,0)
 N ECL,ECD,ECC,ECP,IEN,ASC,ASCNM,MEDSP,MEDSPNM,ECCH
"RTN","ECUERPC",188,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",189,0)
 S ECL=$P(ECARY,U),ECD=$P(ECARY,U,2),ECC=$P(ECARY,U,3),ECP=$P(ECARY,U,4)
"RTN","ECUERPC",190,0)
 S:ECC="" ECC=0 I (ECL="")!(ECD="") Q
"RTN","ECUERPC",191,0)
 S (ASCNM,MEDSPNM)="",ECCH=ECL_"-"_ECD_"-"_ECC_"-"_ECP
"RTN","ECUERPC",192,0)
 I '$D(^ECJ("B",ECCH)) Q
"RTN","ECUERPC",193,0)
 S IEN=$O(^ECJ("B",ECCH,0)) I IEN="" Q
"RTN","ECUERPC",194,0)
 S ASC=$P($G(^ECJ(IEN,"PRO")),U,4) I ASC D
"RTN","ECUERPC",195,0)
 .S ASCNM=$$GET1^DIQ(44,ASC,.01,"I")
"RTN","ECUERPC",196,0)
 S MEDSP=$P($G(^ECD(ECD,0)),U,3) I MEDSP D 
"RTN","ECUERPC",197,0)
 .S MEDSPNM=$$GET1^DIQ(723,MEDSP,.01,"I")
"RTN","ECUERPC",198,0)
 S RESULTS=ASC_U_ASCNM_U_MEDSP_U_MEDSPNM
"RTN","ECUERPC",199,0)
 Q
"RTN","ECUERPC",200,0)
PATPROC(RESULTS,ECARY) ;
"RTN","ECUERPC",201,0)
 ;
"RTN","ECUERPC",202,0)
 ;Broker call returns the entries from EVENT CAPTURE PATIENT FILE #721
"RTN","ECUERPC",203,0)
 ;        RPC: EC GETPATPROCS
"RTN","ECUERPC",204,0)
 ;INPUTS   ECARY - Contains the following values separated by "^"
"RTN","ECUERPC",205,0)
 ;          ECLOC - Location ien
"RTN","ECUERPC",206,0)
 ;          ECPAT - Patient DFN ien
"RTN","ECUERPC",207,0)
 ;          ECUNT - DSS unit ien
"RTN","ECUERPC",208,0)
 ;          ECSD  - Start Date
"RTN","ECUERPC",209,0)
 ;          ECED  - End Date
"RTN","ECUERPC",210,0)
 ;
"RTN","ECUERPC",211,0)
 ;OUTPUTS  RESULTS - Array of Event Capture Patient entries contain
"RTN","ECUERPC",212,0)
 ;          721 IEN^Procedure date and time^Category^Procedure^Volume^
"RTN","ECUERPC",213,0)
 ;          Provider^ordering section^associated clinic^primary diagnoses
"RTN","ECUERPC",214,0)
 ;          Provider IEN
"RTN","ECUERPC",215,0)
 ;
"RTN","ECUERPC",216,0)
 N IEN,CNT,ECV,ECLOC,ECUNT,ECPAT,PX,NODE,DATA,PDT,PDX,PND,PDXD,CAT,ECI
"RTN","ECUERPC",217,0)
 N ORS,PRV,PRO
"RTN","ECUERPC",218,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",219,0)
 S ECV="ECLOC^ECPAT^ECUNT^ECSD^ECED"
"RTN","ECUERPC",220,0)
 D PARSE(ECV,ECARY) I (ECLOC="")!(ECPAT="")!(ECUNT="") Q
"RTN","ECUERPC",221,0)
 K ^TMP($J,"ECPATPX")
"RTN","ECUERPC",222,0)
 S ECSD=$G(ECSD,DT),ECED=$G(ECED,DT)
"RTN","ECUERPC",223,0)
 S %DT="X" F ECI="ECSD","ECED" S X=@ECI D ^%DT S @ECI=Y
"RTN","ECUERPC",224,0)
 K X,Y
"RTN","ECUERPC",225,0)
 S ECSD=$S(ECSD=-1:DT,1:ECSD)-.0001,ECED=$S(ECED=-1:DT,1:ECED)+.9999
"RTN","ECUERPC",226,0)
 Q:ECED'>ECSD  S PDT=ECSD,CNT=0
"RTN","ECUERPC",227,0)
 F  S PDT=$O(^ECH("ADT",ECLOC,ECPAT,ECUNT,PDT)) Q:'PDT!(PDT>ECED)  D
"RTN","ECUERPC",228,0)
 . S IEN=0 F  S IEN=$O(^ECH("ADT",ECLOC,ECPAT,ECUNT,PDT,IEN)) Q:'IEN  D
"RTN","ECUERPC",229,0)
 . . S NODE=$G(^ECH(IEN,0)),PND=$G(^ECH(IEN,"P")),PX=$P(NODE,U,9)
"RTN","ECUERPC",230,0)
 . . Q:NODE=""  S (PRV,CAT,ORS,ASC,PDXD)="",PDX=$P(PND,U,2)
"RTN","ECUERPC",231,0)
 . . I PX["EC" D
"RTN","ECUERPC",232,0)
 . . . S PRO=$G(^EC(725,$P(PX,";"),0)),PX=$P(PRO,U,2)_" "_$P(PRO,U)
"RTN","ECUERPC",233,0)
 . . E  S PRO=$$CPT^ICPTCOD($P(PX,";"),PDT) S PX=$P(PRO,U,2)_" "_$P(PRO,U,3)
"RTN","ECUERPC",234,0)
 . . S:$P(NODE,U,8) CAT=$$GET1^DIQ(726,$P(NODE,U,8),.01,"I")
"RTN","ECUERPC",235,0)
 . . S:$P(NODE,U,11) PRV=$$GET1^DIQ(200,$P(NODE,U,11),.01,"I")
"RTN","ECUERPC",236,0)
 . . S:$P(NODE,U,12) ORS=$$GET1^DIQ(723,$P(NODE,U,12),.01,"I")
"RTN","ECUERPC",237,0)
 . . S:$P(NODE,U,19) ASC=$$GET1^DIQ(44,$P(NODE,U,19),.01,"I")
"RTN","ECUERPC",238,0)
 . . S:PDX PDXD=$$ICDDX^ICDCODE(PDX,PDT),PDXD=$P(PDXD,U,2)_" "_$P(PDXD,U,4)
"RTN","ECUERPC",239,0)
 . . S DATA=$P(NODE,U)_U_$$FMTE^XLFDT($P(NODE,U,3),"2F")_U_CAT_U_PX
"RTN","ECUERPC",240,0)
 . . S DATA=DATA_U_$P(NODE,U,10)_U_PRV_U_ORS_U_ASC_U_PDXD_U_$P(NODE,U,11)
"RTN","ECUERPC",241,0)
 . . S CNT=CNT+1,^TMP($J,"ECPATPX",CNT)=DATA
"RTN","ECUERPC",242,0)
 S RESULTS=$NA(^TMP($J,"ECPATPX"))
"RTN","ECUERPC",243,0)
 Q
"RTN","ECUERPC",244,0)
PARSE(ECV,ECARY) ;Parse Variable
"RTN","ECUERPC",245,0)
 N I
"RTN","ECUERPC",246,0)
 F I=1:1:$L(ECARY,U) S @$P(ECV,U,I)=$P(ECARY,U,I)
"RTN","ECUERPC",247,0)
 Q
"VER")
8.0^22
"^DD",724,724,10,0)
CATEGORY (Y/N)^RS^1:YES;0:NO;^0;11^Q
"^DD",724,724,10,.1)
Category (Y/N)
"^DD",724,724,10,1,0)
^.1^^0
"^DD",724,724,10,3)
Enter "YES" or "1" to allow categories to group procedures during data entry.
"^DD",724,724,10,21,0)
^.001^10^10^3040212^^^
"^DD",724,724,10,21,1,0)
This field tracks the use of categories during an Event
"^DD",724,724,10,21,2,0)
Capture data entry session.
"^DD",724,724,10,21,3,0)
 
"^DD",724,724,10,21,4,0)
If you would like to utilize categories to group procedures
"^DD",724,724,10,21,5,0)
during data entry, this field should be set to "YES" or "1".
"^DD",724,724,10,21,6,0)
When set to "NO", "0", or a null, categories will not be
"^DD",724,724,10,21,7,0)
used during data entry.
"^DD",724,724,10,21,8,0)
Once event code screen(s) have been defined for the DSS Unit the
"^DD",724,724,10,21,9,0)
user cannot update the category field.  If event code screens
"^DD",724,724,10,21,10,0)
have not been defined then user can edit the category field.
"^DD",724,724,10,23,0)
^.001^7^7^3040212^^
"^DD",724,724,10,23,1,0)
Set of codes. "YES" or "1" allows use of categories
"^DD",724,724,10,23,2,0)
to group procedures during an Event Capture data
"^DD",724,724,10,23,3,0)
entry session. "NO", "0", or a null does not allow
"^DD",724,724,10,23,4,0)
the use of categories during data entry.
"^DD",724,724,10,23,5,0)
Once event code screen(s) have been defined for the DSS Unit the
"^DD",724,724,10,23,6,0)
user cannot update the category field.  If event code screens
"^DD",724,724,10,23,7,0)
have not been defined then user can edit the category field.
"^DD",724,724,10,"DT")
2970107
**END**
**END**
