Released DI*22*148 SEQ #130
Extracted from mail message
**KIDS**:DI*22.0*148^

**INSTALL NAME**
DI*22.0*148
"BLD",581,0)
DI*22.0*148^VA FILEMAN^0^3060410^y
"BLD",581,1,0)
^^2^2^3060410^
"BLD",581,1,1,0)
See patch DI*22*148 in the National Patch Module on FORUM for complete
"BLD",581,1,2,0)
information on this patch.
"BLD",581,4,0)
^9.64PA^^
"BLD",581,"INIT")
DIPOS148
"BLD",581,"KRN",0)
^9.67PA^8989.52^19
"BLD",581,"KRN",.4,0)
.4
"BLD",581,"KRN",.401,0)
.401
"BLD",581,"KRN",.402,0)
.402
"BLD",581,"KRN",.403,0)
.403
"BLD",581,"KRN",.5,0)
.5
"BLD",581,"KRN",.84,0)
.84
"BLD",581,"KRN",3.6,0)
3.6
"BLD",581,"KRN",3.8,0)
3.8
"BLD",581,"KRN",9.2,0)
9.2
"BLD",581,"KRN",9.8,0)
9.8
"BLD",581,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",581,"KRN",9.8,"NM",1,0)
DDBRZIS^^0^4633204
"BLD",581,"KRN",9.8,"NM","B","DDBRZIS",1)

"BLD",581,"KRN",19,0)
19
"BLD",581,"KRN",19.1,0)
19.1
"BLD",581,"KRN",101,0)
101
"BLD",581,"KRN",409.61,0)
409.61
"BLD",581,"KRN",771,0)
771
"BLD",581,"KRN",870,0)
870
"BLD",581,"KRN",8989.51,0)
8989.51
"BLD",581,"KRN",8989.52,0)
8989.52
"BLD",581,"KRN",8994,0)
8994
"BLD",581,"KRN","B",.4,.4)

"BLD",581,"KRN","B",.401,.401)

"BLD",581,"KRN","B",.402,.402)

"BLD",581,"KRN","B",.403,.403)

"BLD",581,"KRN","B",.5,.5)

"BLD",581,"KRN","B",.84,.84)

"BLD",581,"KRN","B",3.6,3.6)

"BLD",581,"KRN","B",3.8,3.8)

"BLD",581,"KRN","B",9.2,9.2)

"BLD",581,"KRN","B",9.8,9.8)

"BLD",581,"KRN","B",19,19)

"BLD",581,"KRN","B",19.1,19.1)

"BLD",581,"KRN","B",101,101)

"BLD",581,"KRN","B",409.61,409.61)

"BLD",581,"KRN","B",771,771)

"BLD",581,"KRN","B",870,870)

"BLD",581,"KRN","B",8989.51,8989.51)

"BLD",581,"KRN","B",8989.52,8989.52)

"BLD",581,"KRN","B",8994,8994)

"BLD",581,"QUES",0)
^9.62^^
"BLD",581,"REQB",0)
^9.611^1^1
"BLD",581,"REQB",1,0)
DI*22.0*145^2
"BLD",581,"REQB","B","DI*22.0*145",1)

"INIT")
DIPOS148
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
VA FILEMAN^DI^FM INIT
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
22.0^2990330^3051028^41
"PKG",5,22,1,"PAH",1,0)
148^3060410
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3060410
"PKG",5,22,1,"PAH",1,1,1,0)
See patch DI*22*148 in the National Patch Module on FORUM for complete
"PKG",5,22,1,"PAH",1,1,2,0)
information on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DDBRZIS")
0^1^B4633204^B5079022
"RTN","DDBRZIS",1,0)
DDBRZIS ;SFISC/DCL-BROWSER DEVICE UTILITIES ;4:50 AM  9 Apr 2006
"RTN","DDBRZIS",2,0)
 ;;22.0;VA FileMan;**145,148**;Mar 30, 1999
"RTN","DDBRZIS",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DDBRZIS",4,0)
OPEN ;
"RTN","DDBRZIS",5,0)
 ;DDBRZIS AND DDBDMSG ARE KILLED IN POST
"RTN","DDBRZIS",6,0)
 S DDBRZIS=1,DDBDMSG=$G(DDBDMSG)
"RTN","DDBRZIS",7,0)
 U IO(0)
"RTN","DDBRZIS",8,0)
 I $G(DDBDMSG)="" D  Q:DDBDMSG="$$DTOUT$$"
"RTN","DDBRZIS",9,0)
 .N DIR,X,Y
"RTN","DDBRZIS",10,0)
 .S DIR(0)="FUO^0:78",DIR("A")="BROWSER TITLE (optional)"
"RTN","DDBRZIS",11,0)
 .S DIR("B")="VA FileMan Browser"
"RTN","DDBRZIS",12,0)
 .S DIR("?")="Enter any free text, which will appear in the Title Bar"
"RTN","DDBRZIS",13,0)
 .D ^DIR
"RTN","DDBRZIS",14,0)
 .I $G(DTOUT) S DDBDMSG="$$DTOUT$$" K DTOUT,DUOUT,DIRUT,DIROUT Q
"RTN","DDBRZIS",15,0)
 .S DDBDMSG=$S(Y="":DDBDMSG,1:Y)
"RTN","DDBRZIS",16,0)
 .Q
"RTN","DDBRZIS",17,0)
 W !,"...one moment..."
"RTN","DDBRZIS",18,0)
 U IO
"RTN","DDBRZIS",19,0)
 Q:DDBDMSG]""
"RTN","DDBRZIS",20,0)
 I $G(DHD)="W """" D ^DIDH" S DDBDMSG="DATA DICTIONARY" Q
"RTN","DDBRZIS",21,0)
 S DDBDMSG="VA FileMan Browser"
"RTN","DDBRZIS",22,0)
 Q
"RTN","DDBRZIS",23,0)
 ;
"RTN","DDBRZIS",24,0)
CLOSE ;
"RTN","DDBRZIS",25,0)
 Q:$G(DDBDMSG)="$$DTOUT$$"
"RTN","DDBRZIS",26,0)
 S DDBRZIS=$G(DDBRZIS,1)
"RTN","DDBRZIS",27,0)
 N C,CHAR,DDBROS,EOF,X
"RTN","DDBRZIS",28,0)
 K ^TMP("DDB",$J)
"RTN","DDBRZIS",29,0)
 S DDBROS=^%ZOSF("OS"),EOF="EOF-End Of File"
"RTN","DDBRZIS",30,0)
 S CHAR="" F I=1:1:31 S CHAR=CHAR_$C(I)
"RTN","DDBRZIS",31,0)
 U IO W !,EOF,!
"RTN","DDBRZIS",32,0)
 S DDBRZIS("REWIND")=$$REWIND^%ZIS(IO,IOT,IOPAR)
"RTN","DDBRZIS",33,0)
 I 'DDBRZIS("REWIND") S DDBRZIS=0 U IO(0) W $C(7),!!?5,"<< UNABLE TO REWIND FILE>>",! H 3 Q
"RTN","DDBRZIS",34,0)
 U IO
"RTN","DDBRZIS",35,0)
 S C=0
"RTN","DDBRZIS",36,0)
 F  R X:2 Q:X="EOF-End Of File"  D
"RTN","DDBRZIS",37,0)
 .S X=$TR(X,CHAR)
"RTN","DDBRZIS",38,0)
 .S:X']"" X=" "
"RTN","DDBRZIS",39,0)
 .S C=C+1,^TMP("DDB",$J,C)=$E(X,1,255) Q
"RTN","DDBRZIS",40,0)
 .Q
"RTN","DDBRZIS",41,0)
 Q
"RTN","DDBRZIS",42,0)
 ;
"RTN","DDBRZIS",43,0)
POST ;
"RTN","DDBRZIS",44,0)
 I $G(DDBDMSG)="$$DTOUT$$" K DDBDMSG,DDBRZIS W $C(7) Q
"RTN","DDBRZIS",45,0)
 I $G(DDBRZIS) D BROWSE^DDBR("^TMP(""DDB"",$J)","NR",$G(DDBDMSG))
"RTN","DDBRZIS",46,0)
 ; *148* Moved to POST-CLOSE EXECUTE of BROWSER device
"RTN","DDBRZIS",47,0)
 ;I ^%ZOSF("OS")["OpenM",$G(IO("CLOSE"))]"" S DDBRZIS=$ZF(-1,"del "_ IO("CLOSE")_";*")
"RTN","DDBRZIS",48,0)
 K DDBRZIS,DDBDMSG
"RTN","DDBRZIS",49,0)
 Q
"RTN","DDBRZIS",50,0)
 ;
"RTN","DDBRZIS",51,0)
DEVICE(MSG) ;TEST IF BROWSER IS BEING INVOKED VIA DEVICE HANDLER
"RTN","DDBRZIS",52,0)
 ;EXTRINSIC FUNCTION
"RTN","DDBRZIS",53,0)
 I $D(DDBRZIS)#2,$G(MSG)]"" S DDBDMSG=MSG Q 1
"RTN","DDBRZIS",54,0)
 Q 0
"RTN","DDBRZIS",55,0)
 ;
"RTN","DDBRZIS",56,0)
MSG(TXT) ;PASS TEXT FOR BROWSER TITLE WHEN BROWSER INVOKED VIA DEVICE HANDLER
"RTN","DDBRZIS",57,0)
 ;PROCEDURE CALL
"RTN","DDBRZIS",58,0)
 S DDBDMSG=$G(TXT)
"RTN","DDBRZIS",59,0)
 Q
"RTN","DDBRZIS",60,0)
STR(X) ;  Remove windows
"RTN","DDBRZIS",61,0)
 N I,Y
"RTN","DDBRZIS",62,0)
 I $L(X,"|")'>2 Q X
"RTN","DDBRZIS",63,0)
 I X["|WRAP|"!(X["| NO WRAP|")!(X["|NOWRAP|") S Y="" F I=1:1:$L(X,"|") S:(I#2) Y=Y_$P(X,"|",I)
"RTN","DDBRZIS",64,0)
 Q $S(X'["|":X,1:$G(Y))
"RTN","DIPOS148")
0^^B4979574
"RTN","DIPOS148",1,0)
DIPOS148 ;SFISC/SO- RE-SET PRE-OPEN & POS-CLOSE FOR BROWSER ;12:50 PM  10 Apr 2006
"RTN","DIPOS148",2,0)
 ;;22.0;VA FileMan;**148**;Mar 30, 1999
"RTN","DIPOS148",3,0)
 N FDA,IEN,X,Y,DIERR,ZERR,Q
"RTN","DIPOS148",4,0)
 S Q=""""
"RTN","DIPOS148",5,0)
 D MES^XPDUTL("Begin post install DI*22*148...")
"RTN","DIPOS148",6,0)
 S IEN=+$$FIND1^DIC(3.5,"","X","BROWSER","B","","ZERR")
"RTN","DIPOS148",7,0)
 I 'IEN D  D CLEAN^DILF Q
"RTN","DIPOS148",8,0)
 . D MES^XPDUTL("Not able to find device named: BROWSER, no editing preformed.")
"RTN","DIPOS148",9,0)
 . D MES^XPDUTL("Finished  post install DI*22*148.")
"RTN","DIPOS148",10,0)
 . Q
"RTN","DIPOS148",11,0)
 S IEN=IEN_","
"RTN","DIPOS148",12,0)
 ; Set PRE-OPEN EXECUTE(#19.7)
"RTN","DIPOS148",13,0)
 S FDA(3.5,IEN,19.7)="N X S X=$$TEST^DDBRT S:X IO=$P(IO,"_Q_".TXT"_Q_")_$J_"_Q_".TXT"_Q_" I 'X S %ZISQUIT=1,X="_Q_"Browser not selectable from current terminal."_Q_" W $C(7),!,X"
"RTN","DIPOS148",14,0)
 S X=^%ZOSF("OS")
"RTN","DIPOS148",15,0)
 I X'["OpenM" D  Q
"RTN","DIPOS148",16,0)
 . D MES^XPDUTL("Not ""OpenM"", setting only the PRE-OPEN EXECUTE(#19.7).")
"RTN","DIPOS148",17,0)
 . D EDIT
"RTN","DIPOS148",18,0)
 . Q
"RTN","DIPOS148",19,0)
 D MES^XPDUTL("Setting only the PRE-OPEN EXECUTE(#19.7).")
"RTN","DIPOS148",20,0)
 S X=$ZV
"RTN","DIPOS148",21,0)
 ; Set POST-CLOSE EXECUTE(#19.8)
"RTN","DIPOS148",22,0)
 S Y="D POST^DDBRZIS I ^%ZOSF("_Q_"OS"_Q_")["_Q_"OpenM"_Q_",$G(IO("_Q_"CLOSE"_Q_"))'="_Q_Q_" N X S X=$ZV,X=$ZF(-1,"_Q_"del "_Q_"_IO("_Q_"CLOSE"_Q_")_$S(X["_Q_"VMS"_Q_":"_Q_";*"_Q_",1:"_Q_Q_"))"
"RTN","DIPOS148",23,0)
 S:X["VMS" FDA(3.5,IEN,19.8)=Y
"RTN","DIPOS148",24,0)
 S:X["Windows" FDA(3.5,IEN,19.8)=Y
"RTN","DIPOS148",25,0)
 I $D(FDA(3.5,IEN,19.8)) D MES^XPDUTL("Setting POST-CLOSE EXECUTE(#19.8).")
"RTN","DIPOS148",26,0)
EDIT D FILE^DIE("","FDA")
"RTN","DIPOS148",27,0)
 D CLEAN^DILF
"RTN","DIPOS148",28,0)
 D MES^XPDUTL("Finished  post install DI*22*148.")
"RTN","DIPOS148",29,0)
 Q
"VER")
8^22.0
"BLD",581,6)
^130
**END**
**END**
