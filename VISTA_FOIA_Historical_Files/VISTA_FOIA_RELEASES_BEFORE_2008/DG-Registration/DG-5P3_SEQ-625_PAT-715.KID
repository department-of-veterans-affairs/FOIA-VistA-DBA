Released DG*5.3*715 SEQ #625
Extracted from mail message
**KIDS**:DG*5.3*715^

**INSTALL NAME**
DG*5.3*715
"BLD",6670,0)
DG*5.3*715^REGISTRATION^0^3060523^y
"BLD",6670,4,0)
^9.64PA^^
"BLD",6670,"KRN",0)
^9.67PA^8989.52^19
"BLD",6670,"KRN",.4,0)
.4
"BLD",6670,"KRN",.401,0)
.401
"BLD",6670,"KRN",.402,0)
.402
"BLD",6670,"KRN",.403,0)
.403
"BLD",6670,"KRN",.5,0)
.5
"BLD",6670,"KRN",.84,0)
.84
"BLD",6670,"KRN",3.6,0)
3.6
"BLD",6670,"KRN",3.8,0)
3.8
"BLD",6670,"KRN",9.2,0)
9.2
"BLD",6670,"KRN",9.8,0)
9.8
"BLD",6670,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6670,"KRN",9.8,"NM",1,0)
DGPMV3^^0^B23327624
"BLD",6670,"KRN",9.8,"NM","B","DGPMV3",1)

"BLD",6670,"KRN",19,0)
19
"BLD",6670,"KRN",19,"NM",0)
^9.68A^^
"BLD",6670,"KRN",19.1,0)
19.1
"BLD",6670,"KRN",101,0)
101
"BLD",6670,"KRN",409.61,0)
409.61
"BLD",6670,"KRN",771,0)
771
"BLD",6670,"KRN",870,0)
870
"BLD",6670,"KRN",8989.51,0)
8989.51
"BLD",6670,"KRN",8989.52,0)
8989.52
"BLD",6670,"KRN",8994,0)
8994
"BLD",6670,"KRN","B",.4,.4)

"BLD",6670,"KRN","B",.401,.401)

"BLD",6670,"KRN","B",.402,.402)

"BLD",6670,"KRN","B",.403,.403)

"BLD",6670,"KRN","B",.5,.5)

"BLD",6670,"KRN","B",.84,.84)

"BLD",6670,"KRN","B",3.6,3.6)

"BLD",6670,"KRN","B",3.8,3.8)

"BLD",6670,"KRN","B",9.2,9.2)

"BLD",6670,"KRN","B",9.8,9.8)

"BLD",6670,"KRN","B",19,19)

"BLD",6670,"KRN","B",19.1,19.1)

"BLD",6670,"KRN","B",101,101)

"BLD",6670,"KRN","B",409.61,409.61)

"BLD",6670,"KRN","B",771,771)

"BLD",6670,"KRN","B",870,870)

"BLD",6670,"KRN","B",8989.51,8989.51)

"BLD",6670,"KRN","B",8989.52,8989.52)

"BLD",6670,"KRN","B",8994,8994)

"BLD",6670,"QUES",0)
^9.62^^
"BLD",6670,"REQB",0)
^9.611^1^1
"BLD",6670,"REQB",1,0)
DG*5.3*692^2
"BLD",6670,"REQB","B","DG*5.3*692",1)

"MBREQ")
0
"PKG",114,-1)
1^1
"PKG",114,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",114,20,0)
^9.402P^^
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
5.3^2930813^2930821
"PKG",114,22,1,"PAH",1,0)
715^3060523
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DGPMV3")
0^1^B23327624^B22721413
"RTN","DGPMV3",1,0)
DGPMV3 ;ALB/MIR - ENTER TRANSACTION INFORMATION; 8 MAY 89 ; 5/23/06 8:32am
"RTN","DGPMV3",2,0)
 ;;5.3;Registration;**34,54,62,95,692,715**;Aug 13, 1993
"RTN","DGPMV3",3,0)
 K ^UTILITY("DGPM",$J)
"RTN","DGPMV3",4,0)
 D NOW^%DTC S DGNOW=%,DGPMHY=DGPMY,DGPMOUT=0 G:'DGPMN DT S X=DGPMY
"RTN","DGPMV3",5,0)
 S DGPM0ND=DGPMY_"^"_DGPMT_"^"_DFN_"^^^^^^^^^^^"_$S("^1^4^"[("^"_DGPMT_"^"):"",1:DGPMCA)
"RTN","DGPMV3",6,0)
 ;
"RTN","DGPMV3",7,0)
 I DGPMT=1 S $P(DGPM0ND,"^",25)=$S(DGPMSA:1,1:0)
"RTN","DGPMV3",8,0)
 ;-- provider change
"RTN","DGPMV3",9,0)
 I DGPMT=6,$D(DGPMPC) S DGPM0ND=$$PRODAT(DGPM0ND)
"RTN","DGPMV3",10,0)
 D NEW G Q:Y'>0 S (DA,DGPMDA)=+Y
"RTN","DGPMV3",11,0)
 S:DGPMT=1!(DGPMT=4) DGPMCA=DA,DGPMAN=^DGPM(DA,0) D VAR G DR
"RTN","DGPMV3",12,0)
DT D VAR G:DGPM1X DR S (DGPMY,Y)=DGPMHY X ^DD("DD") W !,DGPMUC," DATE: ",Y,"// " R X:DTIME G Q:'$T!(X["^") I X="" G DR
"RTN","DGPMV3",13,0)
 S %DT="SRXE",%DT(0)="-NOW" I X["?"!(Y<0) D HELP^%DTC G DT
"RTN","DGPMV3",14,0)
 I X="@" G OKD
"RTN","DGPMV3",15,0)
 D ^%DT I Y<0 D HELP^%DTC G DT
"RTN","DGPMV3",16,0)
 K %DT S DGPMY=Y D CHK^DGPMV30:(X]"")&(DGPMY'=+DGPMP) I $D(DGPME) S DGPMY=DGPMHY W !,DGPME K DGPME G DT
"RTN","DGPMV3",17,0)
DR ;select input template for transaction type
"RTN","DGPMV3",18,0)
 S DIE="^DGPM(" I "^1^4^6^"[("^"_DGPMT_"^"),DGPMN S DIE("NO^")=""
"RTN","DGPMV3",19,0)
 S DGODSPT=$S('$D(^DGPM(DGPMCA,"ODS")):0,^("ODS"):1,1:0)
"RTN","DGPMV3",20,0)
 S DR=$S(DGPMT=1:"[DGPM ADMIT]",DGPMT=2:"[DGPM TRANSFER]",DGPMT=3:"[DGPM DISCHARGE]",DGPMT=4:"[DGPM CHECK-IN LODGER]",DGPMT=5:"[DGPM LODGER CHECK-OUT]",DGPMT=6:"[DGPM SPECIALTY TRANSFER]",1:"") G Q:DR="" K DQ,DG D ^DIE K DIE
"RTN","DGPMV3",21,0)
 I $D(Y)#2 S DGPMOUT=1
"RTN","DGPMV3",22,0)
 ;Modified in patch dg*5.3*692 to include privacy indicator node "DIR"
"RTN","DGPMV3",23,0)
 K DGZ S (^UTILITY("DGPM",$J,DGPMT,DGPMDA,"A"),DGPMA)=$S($D(^DGPM(DGPMDA,0)):^(0)_$S($G(^("DIR"))'="":U_^("DIR"),1:""),1:"")
"RTN","DGPMV3",24,0)
 D:DGPMT'=4 @("^DGPMV3"_DGPMT)
"RTN","DGPMV3",25,0)
 I DGPMT=4,$S('$D(^DGPM(DGPMDA,"LD")):1,'$P(^("LD"),"^",1):1,1:0) S DIK="^DGPM(",DA=DGPMDA W !,"Incomplete check-in...deleted" D ^DIK K DIK S DGPMA=""
"RTN","DGPMV3",26,0)
 S (^UTILITY("DGPM",$J,DGPMT,DGPMDA,"A"),DGPMA)=$G(^DGPM(DGPMDA,0))_$S($G(^("DIR"))'="":U_^("DIR"),1:"") I DGPMT=6 S Y=DGPMDA D AFTER^DGPMV36
"RTN","DGPMV3",27,0)
EVENTS ;
"RTN","DGPMV3",28,0)
 I DGPMT=4!(DGPMT=5) D RESET^DGPMDDLD
"RTN","DGPMV3",29,0)
 I DGPMT'=4&(DGPMT'=5) D RESET^DGPMDDCN I (DGPMT'=6) D SI^DGPMV33
"RTN","DGPMV3",30,0)
 D:DGPMA]"" START^DGPWB(DFN)
"RTN","DGPMV3",31,0)
 D EN^DGPMVBM ;notify building management if room-bed change
"RTN","DGPMV3",32,0)
 S DGOK=0 F I=0:0 S I=$O(^UTILITY("DGPM",$J,I)) Q:'I  F J=0:0 S J=$O(^UTILITY("DGPM",$J,I,J)) Q:'J  I ^(J,"A")'=^("P") S DGOK=1 Q
"RTN","DGPMV3",33,0)
 I DGOK D ^DGPMEVT ;Invoke Movement Event Driver
"RTN","DGPMV3",34,0)
Q S:$D(DGPMBYP) DGPMBYP=DGPMDA
"RTN","DGPMV3",35,0)
 K DGIDX,DGOWD,DGOTY ;variables set in DGPMGLC - G&L corrections
"RTN","DGPMV3",36,0)
 K DGODS,DGODSPT ;ods variables
"RTN","DGPMV3",37,0)
 K %DT,DA,DGER,DGNOW,DGOK,DGPM0,DGPM0ND,DGPM2,DGPMA,DGPMAB,DGPMABL,DGPMDA,DGPMER,DGPMHY,DGPMNI,DGPMOC,DGPMOS,DGPMOUT,DGPMP,DGPMPHY,DGPMPHY0,DGPMPTF,DGPMSP,DGPMTYP,DGPMTN,DGPMWD,DGT,DGSV,DGX,DGX1
"RTN","DGPMV3",38,0)
 K DIC,DIE,DIK,DR,I,I1,J,K,X,X1,X2,Y,^UTILITY("DGPM",$J) Q
"RTN","DGPMV3",39,0)
 ;
"RTN","DGPMV3",40,0)
OKD K %DT W ! S DGPMER=0,(^UTILITY("DGPM",$J,DGPMT,DGPMDA,"P"),DGPMP)=^DGPM(DGPMDA,0),Y=DGPMDA D:DGPMT=6 PRIOR^DGPMV36 D @("D"_DGPMT_"^DGPMVDL"_$S(DGPMT>2:1,1:"")) G Q:DGPMER
"RTN","DGPMV3",41,0)
 W !,"Are you sure you want to delete this movement" S %=2 D YN^DICN G Q:%<0,DT:%=2 I '% W !?5,"Answer yes to delete this ",DGPMUC," or no to continue" G OKD
"RTN","DGPMV3",42,0)
 D @(DGPMT_"^DGPMVDL"_$S(DGPMT>2:1,1:""))
"RTN","DGPMV3",43,0)
 I DGPMT'=3,(DGPMT'=5) S DIK="^DGPM(",DA=DGPMDA D ^DIK:DGPMDA
"RTN","DGPMV3",44,0)
 S (^UTILITY("DGPM",$J,DGPMT,DGPMDA,"A"),DGPMA)=$S($P(DGPMP,"^",18)'=47:"",1:^DGPM(+DGPMDA,0)) I DGPMT=6 S Y=DGPMDA D AFTER^DGPMV36
"RTN","DGPMV3",45,0)
 I DGPMDA,$O(^DGPM("APHY",DGPMDA,0)) S DIK="^DGPM(",DA=+$O(^(0)) I $D(^DGPM(+DA,0)) S ^UTILITY("DGPM",$J,6,DA,"P")=^(0),^("A")="",Y=DA D PRIOR^DGPMV36,^DIK S Y=DA D AFTER^DGPMV36
"RTN","DGPMV3",46,0)
 G EVENTS
"RTN","DGPMV3",47,0)
VAR ;Set up variables
"RTN","DGPMV3",48,0)
 ;Modified in patch dg*5.3*692 to include privacy indicator node "DIR"
"RTN","DGPMV3",49,0)
 S DA=DGPMDA,(^UTILITY("DGPM",$J,DGPMT,DGPMDA,"P"),DGPMP)=$S(DGPMN=1:"",1:$G(^DGPM(DA,0))_$S($G(^("DIR"))'="":U_^("DIR"),1:""),1:"") ;DGPMP=Before edit
"RTN","DGPMV3",50,0)
 I DGPMT=6 S Y=DGPMDA D PRIOR^DGPMV36
"RTN","DGPMV3",51,0)
 S DGX=DGPMY+($P(DGPMP,"^",22)/10000000)
"RTN","DGPMV3",52,0)
 S X=$O(^DGPM("APMV",DFN,DGPMCA,(9999999.9999999-DGX))),X1=$O(^DGPM("APMV",DFN,DGPMCA,+X,0)) S DGPM0=$S($D(^DGPM(+X1,0)):^(0),1:"") ;DGPM0=prior movement
"RTN","DGPMV3",53,0)
 S X=$O(^DGPM("APCA",DFN,DGPMCA,+DGX)),X=$O(^(+X,0)),DGPM2=$S($D(^DGPM(+X,0)):^(0),1:"") ;DGPM2=next movement
"RTN","DGPMV3",54,0)
 S DGPMABL=0 I DGPM2,$D(^DG(405.2,+$P(DGPM2,"^",18),"E")) S DGPMABL=+^("E") ;is the next movement an absence?
"RTN","DGPMV3",55,0)
 I DGPMT=6 S Y=DGPMDA D PRIOR^DGPMV36
"RTN","DGPMV3",56,0)
 Q
"RTN","DGPMV3",57,0)
NEW ;Entry point to add a new entry to ^DGPM
"RTN","DGPMV3",58,0)
 D NEW^DGPMV301 ; continuation of routine DGPMV3 in DGPMV301
"RTN","DGPMV3",59,0)
 Q
"RTN","DGPMV3",60,0)
 ;
"RTN","DGPMV3",61,0)
PRODAT(NODE) ;-- This function will add the ward and other data from the
"RTN","DGPMV3",62,0)
 ; previous TS movement to the provider TS movement.
"RTN","DGPMV3",63,0)
 ;
"RTN","DGPMV3",64,0)
 N X,Y
"RTN","DGPMV3",65,0)
 S Y=NODE,X=$O(^DGPM("ATS",DFN,DGPMCA,9999999.9999999-$P(NODE,U))) I X S X=$O(^(X,0)) I X S X=$O(^(X,0)) I X S X=^DGPM(X,0)
"RTN","DGPMV3",66,0)
 S $P(Y,U,4)=$P(X,U,4),$P(Y,U,9)=$P(X,U,9)
"RTN","DGPMV3",67,0)
 Q Y
"RTN","DGPMV3",68,0)
 ;
"VER")
8.0^22.0
"BLD",6670,6)
^625
**END**
**END**
