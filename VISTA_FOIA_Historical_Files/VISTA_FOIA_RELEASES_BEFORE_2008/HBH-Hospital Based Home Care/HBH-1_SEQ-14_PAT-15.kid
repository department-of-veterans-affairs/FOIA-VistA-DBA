Released HBH*1*15 SEQ #14
Extracted from mail message
**KIDS**:HBH*1.0*15^

**INSTALL NAME**
HBH*1.0*15
"BLD",2153,0)
HBH*1.0*15^HOSPITAL BASED HOME CARE^0^2991014^y
"BLD",2153,1,0)
^^1^1^2991014^^^^
"BLD",2153,1,1,0)
This is HBH*1.0*15
"BLD",2153,4,0)
^9.64PA^632^1
"BLD",2153,4,632,0)
632
"BLD",2153,4,632,222)
y^n^f^^^^n
"BLD",2153,4,"B",632,632)

"BLD",2153,"ABPKG")
n
"BLD",2153,"INID")
^y
"BLD",2153,"INIT")
HBHCPS15
"BLD",2153,"KRN",0)
^9.67PA^19^18
"BLD",2153,"KRN",.4,0)
.4
"BLD",2153,"KRN",.4,"NM",0)
^9.68A^^
"BLD",2153,"KRN",.401,0)
.401
"BLD",2153,"KRN",.401,"NM",0)
^9.68A^^
"BLD",2153,"KRN",.402,0)
.402
"BLD",2153,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",2153,"KRN",.403,0)
.403
"BLD",2153,"KRN",.403,"NM",0)
^9.68A^^
"BLD",2153,"KRN",.5,0)
.5
"BLD",2153,"KRN",.84,0)
.84
"BLD",2153,"KRN",3.6,0)
3.6
"BLD",2153,"KRN",3.8,0)
3.8
"BLD",2153,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",2153,"KRN",9.2,0)
9.2
"BLD",2153,"KRN",9.8,0)
9.8
"BLD",2153,"KRN",9.8,"NM",0)
^9.68A^11^11
"BLD",2153,"KRN",9.8,"NM",1,0)
HBHCPS15^^0^B1723504
"BLD",2153,"KRN",9.8,"NM",2,0)
HBHCRP3^^0^B14398836
"BLD",2153,"KRN",9.8,"NM",3,0)
HBHCUTL3^^0^B9865123
"BLD",2153,"KRN",9.8,"NM",4,0)
HBHCRP4^^0^B25423017
"BLD",2153,"KRN",9.8,"NM",5,0)
HBHCUTL4^^0^B15716623
"BLD",2153,"KRN",9.8,"NM",6,0)
HBHCXMV^^0^B23217539
"BLD",2153,"KRN",9.8,"NM",7,0)
HBHCXMV1^^0^B5422834
"BLD",2153,"KRN",9.8,"NM",8,0)
HBHCAPPT^^0^B26052746
"BLD",2153,"KRN",9.8,"NM",9,0)
HBHCR15A^^0^B17443050
"BLD",2153,"KRN",9.8,"NM",10,0)
HBHCR15B^^0^B32575172
"BLD",2153,"KRN",9.8,"NM",11,0)
HBHCRP21^^0^B50803846
"BLD",2153,"KRN",9.8,"NM","B","HBHCAPPT",8)

"BLD",2153,"KRN",9.8,"NM","B","HBHCPS15",1)

"BLD",2153,"KRN",9.8,"NM","B","HBHCR15A",9)

"BLD",2153,"KRN",9.8,"NM","B","HBHCR15B",10)

"BLD",2153,"KRN",9.8,"NM","B","HBHCRP21",11)

"BLD",2153,"KRN",9.8,"NM","B","HBHCRP3",2)

"BLD",2153,"KRN",9.8,"NM","B","HBHCRP4",4)

"BLD",2153,"KRN",9.8,"NM","B","HBHCUTL3",3)

"BLD",2153,"KRN",9.8,"NM","B","HBHCUTL4",5)

"BLD",2153,"KRN",9.8,"NM","B","HBHCXMV",6)

"BLD",2153,"KRN",9.8,"NM","B","HBHCXMV1",7)

"BLD",2153,"KRN",19,0)
19
"BLD",2153,"KRN",19,"NM",0)
^9.68A^^0
"BLD",2153,"KRN",19.1,0)
19.1
"BLD",2153,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",2153,"KRN",101,0)
101
"BLD",2153,"KRN",409.61,0)
409.61
"BLD",2153,"KRN",771,0)
771
"BLD",2153,"KRN",869.2,0)
869.2
"BLD",2153,"KRN",870,0)
870
"BLD",2153,"KRN",8994,0)
8994
"BLD",2153,"KRN","B",.4,.4)

"BLD",2153,"KRN","B",.401,.401)

"BLD",2153,"KRN","B",.402,.402)

"BLD",2153,"KRN","B",.403,.403)

"BLD",2153,"KRN","B",.5,.5)

"BLD",2153,"KRN","B",.84,.84)

"BLD",2153,"KRN","B",3.6,3.6)

"BLD",2153,"KRN","B",3.8,3.8)

"BLD",2153,"KRN","B",9.2,9.2)

"BLD",2153,"KRN","B",9.8,9.8)

"BLD",2153,"KRN","B",19,19)

"BLD",2153,"KRN","B",19.1,19.1)

"BLD",2153,"KRN","B",101,101)

"BLD",2153,"KRN","B",409.61,409.61)

"BLD",2153,"KRN","B",771,771)

"BLD",2153,"KRN","B",869.2,869.2)

"BLD",2153,"KRN","B",870,870)

"BLD",2153,"KRN","B",8994,8994)

"BLD",2153,"QUES",0)
^9.62^^
"BLD",2153,"REQB",0)
^9.611^^
"FIA",632)
HBHC VISIT
"FIA",632,0)
^HBHC(632,
"FIA",632,0,0)
632IP
"FIA",632,0,1)
y^n^f^^^^n
"FIA",632,0,10)

"FIA",632,0,11)

"FIA",632,0,"RLRO")

"FIA",632,0,"VR")
1.0^HBH
"FIA",632,632)
0
"FIA",632,632.032)
0
"FIA",632,632.321)
0
"INIT")
HBHCPS15
"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
HOSPITAL BASED HOME CARE^HBH^Hospital Based Home Care
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
1.0^2931101
"PKG",455,22,1,"PAH",1,0)
15^2991014^3779
"PKG",455,22,1,"PAH",1,1,0)
^^1^1^2991014
"PKG",455,22,1,"PAH",1,1,1,0)
This is HBH*1.0*15
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","HBHCAPPT")
0^8^B26052746
"RTN","HBHCAPPT",1,0)
HBHCAPPT ; LR VAMC(IRMS)/MJT-HBHC batch job to create ^HBHC(632) (visit) nodes from PCE module info => patient, appointment date/time, hospital location (clinic), provider, diagnosis code(s), & CPT code(s), calls ^HBHCCAN ;9908
"RTN","HBHCAPPT",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10,12,13,15**;NOV 01, 1993
"RTN","HBHCAPPT",3,0)
 ; Daily auto-queued option, also called from ^HBHCFILE, HBHCLSDT, last date to include in transmit set up in ^HBHCFILE
"RTN","HBHCAPPT",4,0)
 D START^HBHCAPP1
"RTN","HBHCAPPT",5,0)
SCAN ; Scan
"RTN","HBHCAPPT",6,0)
 N HBHCQRY
"RTN","HBHCAPPT",7,0)
 D OPEN^SDQ(.HBHCQRY)
"RTN","HBHCAPPT",8,0)
 D INDEX^SDQ(.HBHCQRY,"DATE/TIME","SET")
"RTN","HBHCAPPT",9,0)
 D DATE^SDQ(.HBHCQRY,HBHCBGDT,HBHCLSDT,"SET")
"RTN","HBHCAPPT",10,0)
 D SCANCB^SDQ(.HBHCQRY,"D CB^HBHCAPPT(Y,Y0,.SDSTOP)","SET")
"RTN","HBHCAPPT",11,0)
 D ACTIVE^SDQ(.HBHCQRY,"TRUE","SET")
"RTN","HBHCAPPT",12,0)
 D SCAN^SDQ(.HBHCQRY,"FORWARD")
"RTN","HBHCAPPT",13,0)
 D CLOSE^SDQ(.HBHCQRY)
"RTN","HBHCAPPT",14,0)
 I ($D(^HBHC(634.1,"B")))!($D(^HBHC(634.2,"B")))!($D(^HBHC(634.3,"B")))!($D(^HBHC(634.5,"B"))) D MAIL^HBHCAPP1
"RTN","HBHCAPPT",15,0)
 ; Delete File Update in Progress Flag
"RTN","HBHCAPPT",16,0)
 S $P(^HBHC(631.9,1,0),U,8)=""
"RTN","HBHCAPPT",17,0)
EXIT ; Exit module
"RTN","HBHCAPPT",18,0)
 D EXIT^HBHCAPP1
"RTN","HBHCAPPT",19,0)
 Q
"RTN","HBHCAPPT",20,0)
CB(HBHCOEP,HBHCSCE0,HBHCSTOP) ;
"RTN","HBHCAPPT",21,0)
 ; Omit Child encounter, (child if Parent Encounter field contains data)
"RTN","HBHCAPPT",22,0)
 Q:$P(HBHCSCE0,U,6)]""
"RTN","HBHCAPPT",23,0)
 ; Quit if invalid status for HBHC purposes
"RTN","HBHCAPPT",24,0)
 Q:($P(HBHCSCE0,U,12)=4)!($P(HBHCSCE0,U,12)=5)!($P(HBHCSCE0,U,12)=6)!($P(HBHCSCE0,U,12)=7)!($P(HBHCSCE0,U,12)=9)!($P(HBHCSCE0,U,12)=10)!($P(HBHCSCE0,U,12)=11)!($P(HBHCSCE0,U,12)=13)
"RTN","HBHCAPPT",25,0)
 ; Clinic missing
"RTN","HBHCAPPT",26,0)
 Q:$P(HBHCSCE0,U,4)=""
"RTN","HBHCAPPT",27,0)
 ; Include only HBHC clinics
"RTN","HBHCAPPT",28,0)
 Q:'$D(^HBHC(631.6,"B",$P(HBHCSCE0,U,4)))
"RTN","HBHCAPPT",29,0)
 S HBHCCLN=$P(HBHCSCE0,U,4)
"RTN","HBHCAPPT",30,0)
 D VERIFY I 'HBHCFLG D PROCESS D:$D(HBHCMSG) ERROR^HBHCAPP1
"RTN","HBHCAPPT",31,0)
 Q
"RTN","HBHCAPPT",32,0)
VERIFY ; Verify node doesn't already exist in ^HBHC(632) file
"RTN","HBHCAPPT",33,0)
 S HBHCFLG=0,HBHCDPT=$P(HBHCSCE0,U,2),HBHCAPDT=$P(HBHCSCE0,U)
"RTN","HBHCAPPT",34,0)
 I HBHCDPT="" S HBHCFLG=1 Q
"RTN","HBHCAPPT",35,0)
 S HBHCBXRF=0 F  S HBHCBXRF=$O(^HBHC(632,"B",HBHCDPT,HBHCBXRF)) Q:(HBHCBXRF'>0)!(HBHCFLG)  S:(HBHCAPDT=$P(^HBHC(632,HBHCBXRF,0),U,2))&('$D(^HBHC(632,"AC","C",HBHCBXRF))) HBHCFLG=1
"RTN","HBHCAPPT",36,0)
 Q
"RTN","HBHCAPPT",37,0)
PROCESS ; Process provider, diagnosis (Dx) (limit: 5), & CPT code data
"RTN","HBHCAPPT",38,0)
 ; Dx
"RTN","HBHCAPPT",39,0)
 K HBHCDXL
"RTN","HBHCAPPT",40,0)
 F HBHCI=1:1:5 S HBHCDX(HBHCI)="",HBHCCNT=1
"RTN","HBHCAPPT",41,0)
 D GETDX^SDOE(HBHCOEP,"HBHCDXL")
"RTN","HBHCAPPT",42,0)
 S HBHCDFN=0 F  S HBHCDFN=$O(HBHCDXL(HBHCDFN)) Q:(HBHCDFN'>0)!(HBHCCNT>5)  S:$P(HBHCDXL(HBHCDFN),U,12)="P" HBHCDX(1)=$P(HBHCDXL(HBHCDFN),U) S:$P(HBHCDXL(HBHCDFN),U,12)="S" HBHCCNT=HBHCCNT+1,HBHCDX(HBHCCNT)=$P(HBHCDXL(HBHCDFN),U)
"RTN","HBHCAPPT",43,0)
 ; Dx missing
"RTN","HBHCAPPT",44,0)
 I (+$G(HBHCDXL)'>0) S HBHCMSG=3 Q
"RTN","HBHCAPPT",45,0)
 ; Dx > 5
"RTN","HBHCAPPT",46,0)
 I (+$G(HBHCDXL)>5) S HBHCMSG=6 Q
"RTN","HBHCAPPT",47,0)
 ; provider, use Encounter Provider (field 1204, file 9000010.18) or V Provider (9000010.06) (if encounter provider doesn't exist), each provider within encounter will become a separate HBHC Visit record
"RTN","HBHCAPPT",48,0)
 K HBHCPRV1,HBHCPRVL
"RTN","HBHCAPPT",49,0)
 D GETPRV^SDOE(HBHCOEP,"HBHCPRVL")
"RTN","HBHCAPPT",50,0)
 S (HBHCPCNT,HBHCDFN,HBHCONE)=0 F  S HBHCDFN=$O(HBHCPRVL(HBHCDFN)) Q:HBHCDFN'>0  S HBHCPRV=$P(HBHCPRVL(HBHCDFN),U) D CHECK S:HBHCONE=1 HBHCPCNT=HBHCPCNT+1,HBHCPRV1(HBHCPRV)=""
"RTN","HBHCAPPT",51,0)
 ; Provider missing
"RTN","HBHCAPPT",52,0)
 I (+$G(HBHCPRVL)'>0) S HBHCMSG=2 Q
"RTN","HBHCAPPT",53,0)
 ; HBHC provider missing
"RTN","HBHCAPPT",54,0)
 I HBHCONE=0 S HBHCMSG=11 Q
"RTN","HBHCAPPT",55,0)
 ; Multiple HBHC provider numbers
"RTN","HBHCAPPT",56,0)
 I HBHCONE>1 S HBHCMSG=12 Q
"RTN","HBHCAPPT",57,0)
 ; CPT Code 
"RTN","HBHCAPPT",58,0)
 K HBHCCPTL,HBHCPRV
"RTN","HBHCAPPT",59,0)
 D GETCPT^SDOE(HBHCOEP,"HBHCCPTL")
"RTN","HBHCAPPT",60,0)
 S (HBHCDFN,HBHCONE)=0 F  S HBHCDFN=$O(HBHCCPTL(HBHCDFN)) Q:(HBHCDFN'>0)!($D(HBHCMSG))  S HBHCPRV=$P($G(^AUPNVCPT(HBHCDFN,12)),U,4) D:HBHCPRV]"" CHECK S HBHCNBR=$P(HBHCCPTL(HBHCDFN),U,16) D PROV
"RTN","HBHCAPPT",61,0)
 ; Provider mismatch
"RTN","HBHCAPPT",62,0)
 Q:$D(HBHCMSG)
"RTN","HBHCAPPT",63,0)
 ; Provider ambiguous
"RTN","HBHCAPPT",64,0)
 I $D(HBHCPRV("ZZ")) S HBHCMSG=5 Q
"RTN","HBHCAPPT",65,0)
 ; CPT Code missing
"RTN","HBHCAPPT",66,0)
 I (+$G(HBHCCPTL)=0) S HBHCMSG=4 Q
"RTN","HBHCAPPT",67,0)
 ; outpatient encounter must have 'checked-out' status (2) to ensure provider, Dx, & CPT data exist, or inpatient status (8)
"RTN","HBHCAPPT",68,0)
 I ($P(HBHCSCE0,U,12)'=2)&($P(HBHCSCE0,U,12)'=8) S HBHCMSG=1 Q
"RTN","HBHCAPPT",69,0)
SET ; Set node, call ^DIK to set cross-refs in ^HBHC(632) (visit) file
"RTN","HBHCAPPT",70,0)
 S HBHCPRV="" F  S HBHCPRV=$O(HBHCPRV(HBHCPRV)) Q:HBHCPRV=""  D SETLOOP
"RTN","HBHCAPPT",71,0)
 Q
"RTN","HBHCAPPT",72,0)
SETLOOP ; Set loop
"RTN","HBHCAPPT",73,0)
 S HBHC="" F  S HBHC=$O(^HBHC(631.4,"C",HBHCPRV,HBHC)) Q:(HBHC="")!('$D(^HBHC(631.4,"AC",1,HBHC)))
"RTN","HBHCAPPT",74,0)
 L +^HBHC(632,0) F  S HBHCDFN=$P(^HBHC(632,0),U,3)+1,$P(^HBHC(632,0),U,3)=HBHCDFN Q:'$D(^HBHC(632,HBHCDFN,0))
"RTN","HBHCAPPT",75,0)
 S $P(^HBHC(632,0),U,4)=$P(^HBHC(632,0),U,4)+1 L -^HBHC(632,0)
"RTN","HBHCAPPT",76,0)
 L +^HBHC(632,HBHCDFN,2) S HBHCCPT="" F  S HBHCCPT=$O(HBHCPRV(HBHCPRV,HBHCCPT)) Q:HBHCCPT=""  S HBHCNBR="" F  S HBHCNBR=$O(HBHCPRV(HBHCPRV,HBHCCPT,HBHCNBR)) Q:HBHCNBR=""  D SETCPT
"RTN","HBHCAPPT",77,0)
 L -^HBHC(632,HBHCDFN,2)
"RTN","HBHCAPPT",78,0)
 L +^HBHC(632,HBHCDFN,0) S ^HBHC(632,HBHCDFN,0)=HBHCDPT_U_HBHCAPDT_U_HBHCCLN_U_HBHC_U_U_U_U_"N"_U_U_U_U_U_U_U_U_U_HBHCDX(1)_U_HBHCDX(2)_U_HBHCDX(3)_U_HBHCDX(4)_U_HBHCDX(5)_U_HBHCOEP L -^HBHC(632,HBHCDFN,0)
"RTN","HBHCAPPT",79,0)
 K DIK S DIK="^HBHC(632,",DA=HBHCDFN D IX^DIK K DIK
"RTN","HBHCAPPT",80,0)
 Q
"RTN","HBHCAPPT",81,0)
PROV ; encounter provider & CPT code processing
"RTN","HBHCAPPT",82,0)
 S:HBHCPCNT=1 HBHCTXT="",HBHCTXT=$O(HBHCPRV1(HBHCTXT))
"RTN","HBHCAPPT",83,0)
 F HBHCJ=1:1:HBHCNBR S:HBHCPRV="" HBHCPRV($S(HBHCPCNT=1:HBHCTXT,1:"ZZ"),$P(HBHCCPTL(HBHCDFN),U),HBHCJ)="" I HBHCPRV]"" S:(HBHCONE=1)&($D(HBHCPRV1(HBHCPRV))) HBHCPRV(HBHCPRV,$P(HBHCCPTL(HBHCDFN),U),HBHCJ)="" S:'$D(HBHCPRV1(HBHCPRV)) HBHCMSG=13
"RTN","HBHCAPPT",84,0)
 Q
"RTN","HBHCAPPT",85,0)
CHECK ; Check to ensure provider only has 1 HBHC Provider Number (631.4) or if > 1, has others flagged as Inactive Provider Numbers
"RTN","HBHCAPPT",86,0)
 S (HBHCONE,HBHCIEN)=0 F  S HBHCIEN=$O(^HBHC(631.4,"C",HBHCPRV,HBHCIEN)) Q:(HBHCIEN'>0)!(HBHCONE>1)  S:'$D(^HBHC(631.4,"AC",1,HBHCIEN)) HBHCONE=HBHCONE+1
"RTN","HBHCAPPT",87,0)
 Q
"RTN","HBHCAPPT",88,0)
SETCPT ; Set CPT multiple
"RTN","HBHCAPPT",89,0)
 K DD,DO S DIC="^HBHC(632,",DIC(0)="L",DIC("P")=$P(^DD(632,32,0),U,2),DA(1)=HBHCDFN,X=HBHCCPT,DIC=DIC_DA(1)_",2," D FILE^DICN
"RTN","HBHCAPPT",90,0)
 Q
"RTN","HBHCPS15")
0^1^B1723504
"RTN","HBHCPS15",1,0)
HBHCPS15 ; LR VAMC(IRMS)/MJT-HBHC Patch 15 Post-installation conversion routine, Unlimited CPT Codes, Convert 10 CPT Code fields in node 1, to multiple, then kill node 1 ; 9907
"RTN","HBHCPS15",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**15**;NOV 01, 1993
"RTN","HBHCPS15",3,0)
 ; Loop thru HBHC(632, move CPT codes from node 1 to multiple, then kill node 1
"RTN","HBHCPS15",4,0)
 S HBHCIEN=0 F  S HBHCIEN=$O(^HBHC(632,HBHCIEN)) Q:HBHCIEN'>0  S HBHCINFO=$G(^HBHC(632,HBHCIEN,1)) I HBHCINFO]"" F HBHCI=1:1:10 Q:$P(HBHCINFO,U,HBHCI)=""  D SET K ^HBHC(632,HBHCIEN,1)
"RTN","HBHCPS15",5,0)
 S DIK="^DD(632,",DA(1)=632 F DA=21:1:30 D ^DIK
"RTN","HBHCPS15",6,0)
EXIT ; Exit module
"RTN","HBHCPS15",7,0)
 K DA,DD,DIC,DO,HBHCI,HBHCIEN,HBHCINFO,X
"RTN","HBHCPS15",8,0)
 Q
"RTN","HBHCPS15",9,0)
SET ; Set CPT multiple
"RTN","HBHCPS15",10,0)
 K DD,DO
"RTN","HBHCPS15",11,0)
 S DA(1)=HBHCIEN,DIC="^HBHC(632,DA(1),2,",DIC(0)="L",DIC("P")=$P(^DD(632,32,0),U,2),X=$P(HBHCINFO,U,HBHCI) D FILE^DICN
"RTN","HBHCPS15",12,0)
 Q
"RTN","HBHCR15A")
0^9^B17443050
"RTN","HBHCR15A",1,0)
HBHCR15A ;LR VAMC(IRMS)/MJT-HBHC rpt using file 634.6, user selects date/forms from last 12 transmit batchs, fields: form#, pat name, last 4, form date, + action on form 3, prov #, & prov name on visits, & Adm or D/C on form 6 ;2/5/98  15:23
"RTN","HBHCR15A",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,9,13,15**;NOV 01, 1993
"RTN","HBHCR15A",3,0)
 ; Calls HBHCR15B
"RTN","HBHCR15A",4,0)
 ; Report can also be generated by Transmit File option [HBHCXMT] if default printer is defined in sys param (631.9).  If no printer defined, no report.  User selects forms to include, date is transmit date
"RTN","HBHCR15A",5,0)
 ; HBHCXMT calls entry points:  PROMPT2^HBHCR15B & DQ^HBHCR15A
"RTN","HBHCR15A",6,0)
 I '$D(^HBHC(634.6,"C")) W *7,!,"No transmit history data on file." H 3 Q
"RTN","HBHCR15A",7,0)
 I $P(^HBHC(631.9,1,0),U,6)]"" W *7,!,"Transmission in progress; history data being updated.  Please try again later." H 3 Q
"RTN","HBHCR15A",8,0)
 D PROMPT1^HBHCR15B
"RTN","HBHCR15A",9,0)
 G:$D(DIRUT) EXIT
"RTN","HBHCR15A",10,0)
 S %ZIS="Q" D ^%ZIS G:POP EXIT
"RTN","HBHCR15A",11,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCR15A",ZTDESC="HBPC Transmit Report",ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCR15A",12,0)
DQ ; De-queue
"RTN","HBHCR15A",13,0)
 U IO
"RTN","HBHCR15A",14,0)
 S (HBHCPAGE,HBHCCNTA,HBHCCNTR,HBHCCNT4,HBHCCNT5,HBHCCNT6)=0,$P(HBHCY,"-",81)="",HBHCCOLM=(80-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCR15A",15,0)
 S HBHCHDR=$S(HBHCDIR="S":"W ?36,""Summary""",1:"W ?31,""Last"",!?4,""#"",?8,""Patient Name"",?31,""Four"",?38,""Date""")
"RTN","HBHCR15A",16,0)
LOOP ; Loop thru HBHC(634.6,"C" (transmit date) cross-ref to build report
"RTN","HBHCR15A",17,0)
 S HBHCIEN=0 F  S HBHCIEN=$O(^HBHC(634.6,"C",HBHCXMDT,HBHCIEN)) Q:HBHCIEN'>0  S HBHCINFO=$P(^HBHC(634.6,HBHCIEN,0),U) D PROCESS
"RTN","HBHCR15A",18,0)
 D END^HBHCR15B
"RTN","HBHCR15A",19,0)
EXIT ; Exit module
"RTN","HBHCR15A",20,0)
 D ^%ZISC
"RTN","HBHCR15A",21,0)
 K DIR,DIRUT,HBHC,HBHCACTN,HBHCCC,HBHCCNT,HBHCCNTA,HBHCCNTR,HBHCCNT4,HBHCCNT5,HBHCCNT6,HBHCCOLM,HBHCDATE,HBHCDFN,HBHCDIR,HBHCDSDT,HBHCFLG,HBHCFORM,HBHCHEAD,HBHCHDR,HBHCI,HBHCIEN,HBHCINFO,HBHCIOP,HBHCLST4,HBHCNAME,HBHCPAGE
"RTN","HBHCR15A",22,0)
 K HBHCPIEN,HBHCPRV,HBHCPRVN,HBHCTDY,HBHCTIME,HBHCTYPE,HBHCXMDT,HBHCY,HBHCY0,HBHCZ,X,Y,TMP,^TMP("HBHC",$J),^TMP($J)
"RTN","HBHCR15A",23,0)
 Q
"RTN","HBHCR15A",24,0)
PROCESS ; Process records
"RTN","HBHCR15A",25,0)
 S (HBHCACTN,HBHCPRV)="Z",(HBHCPRVN,HBHCTIME,HBHCTYPE)=""
"RTN","HBHCR15A",26,0)
 D:($E(HBHCINFO)=3)&((HBHCDIR=3)!(HBHCDIR="A")!(HBHCDIR="S")) FORM3
"RTN","HBHCR15A",27,0)
 D:($E(HBHCINFO)=4)&((HBHCDIR=4)!(HBHCDIR="A")!(HBHCDIR="S")) FORM4
"RTN","HBHCR15A",28,0)
 D:($E(HBHCINFO)=5)&((HBHCDIR=5)!(HBHCDIR="A")!(HBHCDIR="S")) FORM5
"RTN","HBHCR15A",29,0)
 D:($E(HBHCINFO)=6)&((HBHCDIR=6)!(HBHCDIR="A")!(HBHCDIR="S")) FORM6
"RTN","HBHCR15A",30,0)
 Q
"RTN","HBHCR15A",31,0)
FORM3 ; Process Form 3 (Admission) records
"RTN","HBHCR15A",32,0)
 S HBHCDATE=$E(HBHCINFO,18,25)
"RTN","HBHCR15A",33,0)
 S:$E(HBHCINFO,55)=1 HBHCCNTA=HBHCCNTA+1,HBHCACTN="Admit"
"RTN","HBHCR15A",34,0)
 S:$E(HBHCINFO,55)=2 HBHCCNTR=HBHCCNTR+1,HBHCACTN="Reject"
"RTN","HBHCR15A",35,0)
 Q:HBHCDIR="S"
"RTN","HBHCR15A",36,0)
 S HBHCFORM="A"
"RTN","HBHCR15A",37,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^DPT("SSN",$E(HBHCINFO,9,17),HBHCDFN)) Q:HBHCDFN=""  S HBHCNAME=$E($P(^DPT(HBHCDFN,0),U),1,20)
"RTN","HBHCR15A",38,0)
 S HBHCLST4=$E(HBHCINFO,14,17)
"RTN","HBHCR15A",39,0)
 D SET
"RTN","HBHCR15A",40,0)
 Q
"RTN","HBHCR15A",41,0)
FORM4 ; Process Form 4 (Visit) records
"RTN","HBHCR15A",42,0)
 S HBHCCNT4=HBHCCNT4+1
"RTN","HBHCR15A",43,0)
 S HBHCFORM="V"
"RTN","HBHCR15A",44,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^DPT("SSN",$E(HBHCINFO,9,17),HBHCDFN)) Q:HBHCDFN=""  S HBHCNAME=$E($P(^DPT(HBHCDFN,0),U),1,20)
"RTN","HBHCR15A",45,0)
 S HBHCLST4=$E(HBHCINFO,14,17)
"RTN","HBHCR15A",46,0)
 S HBHCDATE=$E(HBHCINFO,18,25)
"RTN","HBHCR15A",47,0)
 S HBHCTIME=$E(HBHCINFO,26,27)_":"_$E(HBHCINFO,28,29)
"RTN","HBHCR15A",48,0)
 S HBHCPRVN=+$E(HBHCINFO,30,33)
"RTN","HBHCR15A",49,0)
 S (HBHCFLG,HBHCPIEN)=0 F  S HBHCPIEN=$O(^HBHC(631.4,"B",HBHCPRVN,HBHCPIEN)) Q:HBHCPIEN'>0  D NAME
"RTN","HBHCR15A",50,0)
 D SET
"RTN","HBHCR15A",51,0)
 Q
"RTN","HBHCR15A",52,0)
NAME ; Form 4 Name
"RTN","HBHCR15A",53,0)
 I HBHCFLG=1 S HBHCPRV="**  Duplicate Prov #" Q
"RTN","HBHCR15A",54,0)
 S HBHCFLG=1,HBHCPRV=$E($P(^VA(200,$P(^HBHC(631.4,HBHCPIEN,0),U,2),0),U),1,20)
"RTN","HBHCR15A",55,0)
 Q
"RTN","HBHCR15A",56,0)
FORM5 ; Process Form 5 (Discharge) records
"RTN","HBHCR15A",57,0)
 S HBHCCNT5=HBHCCNT5+1
"RTN","HBHCR15A",58,0)
 Q:HBHCDIR="S"
"RTN","HBHCR15A",59,0)
 S HBHCFORM="D"
"RTN","HBHCR15A",60,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^DPT("SSN",$E(HBHCINFO,9,17),HBHCDFN)) Q:HBHCDFN=""  S HBHCNAME=$E($P(^DPT(HBHCDFN,0),U),1,20)
"RTN","HBHCR15A",61,0)
 S HBHCLST4=$E(HBHCINFO,14,17)
"RTN","HBHCR15A",62,0)
 S HBHCDATE=$E(HBHCINFO,18,25)
"RTN","HBHCR15A",63,0)
 D SET
"RTN","HBHCR15A",64,0)
 Q
"RTN","HBHCR15A",65,0)
FORM6 ; Process Form 6 (Correction) records
"RTN","HBHCR15A",66,0)
 S HBHCCNT6=HBHCCNT6+1
"RTN","HBHCR15A",67,0)
 Q:HBHCDIR="S"
"RTN","HBHCR15A",68,0)
 S HBHCFORM=6
"RTN","HBHCR15A",69,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^DPT("SSN",$E(HBHCINFO,9,17),HBHCDFN)) Q:HBHCDFN=""  S HBHCNAME=$E($P(^DPT(HBHCDFN,0),U),1,20)
"RTN","HBHCR15A",70,0)
 S HBHCLST4=$E(HBHCINFO,14,17)
"RTN","HBHCR15A",71,0)
 S HBHCDSDT=$TR($E(HBHCINFO,56,63)," ","")
"RTN","HBHCR15A",72,0)
 ; Use Discharge date if exists, otherwise use Admission date
"RTN","HBHCR15A",73,0)
 S HBHCDATE=$S(HBHCDSDT]"":HBHCDSDT,1:$E(HBHCINFO,18,25))
"RTN","HBHCR15A",74,0)
 S HBHCTYPE=$S(HBHCDSDT]"":"Discharge",1:"Evaluation/Admission")
"RTN","HBHCR15A",75,0)
 D SET
"RTN","HBHCR15A",76,0)
 Q
"RTN","HBHCR15A",77,0)
SET ; Set TMP node
"RTN","HBHCR15A",78,0)
 ; By design, records are processed/printed in the following order by form number:  6, 3 (A), 5 (D), 4 (V)
"RTN","HBHCR15A",79,0)
 S:HBHCDIR'="S" ^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME,HBHCLST4,HBHCDATE,HBHCPRV,HBHCIEN)=HBHCPRVN_U_HBHCTYPE_U_HBHCTIME
"RTN","HBHCR15A",80,0)
 S:HBHCFORM="V" ^TMP($J,HBHCNAME,HBHCLST4,HBHCDATE_HBHCTIME,HBHCPRV)=""
"RTN","HBHCR15A",81,0)
 Q
"RTN","HBHCR15B")
0^10^B32575172
"RTN","HBHCR15B",1,0)
HBHCR15B ;LR VAMC(IRMS)/MJT-HBHC rpt using file 634.6, called from HBHCR15A, entry points: PROMPT1 & END, & from HBHCXMT, entry point: PROMPT2 ;9804
"RTN","HBHCR15B",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,9,10,13,15**;NOV 01, 1993
"RTN","HBHCR15B",3,0)
PROMPT1 ; Prompt user for which transmit date from last 12 batchs to include, default is Most Recent; uses transmit date cross-ref to obtain batch dates 
"RTN","HBHCR15B",4,0)
 S HBHCDATE="" F  S HBHCDATE=$O(^HBHC(634.6,"C",HBHCDATE)) Q:HBHCDATE=""  S HBHC(-HBHCDATE)=""
"RTN","HBHCR15B",5,0)
 S HBHCDATE="" F HBHCI=1:1 S HBHCDATE=$O(HBHC(HBHCDATE)) Q:(HBHCDATE="")!(HBHCI>12)  S Y=$E(HBHCDATE,2,9) D DD^%DT S TMP(HBHCI)=$E(HBHCDATE,2,9) W !,$J(HBHCI,2),".",?6,Y
"RTN","HBHCR15B",6,0)
 W !
"RTN","HBHCR15B",7,0)
 K DIR,DIRUT
"RTN","HBHCR15B",8,0)
 S DIR(0)="N^",DIR("A")="Select Transmit Date",DIR("B")=1,DIR("?")="Select transmit date by number.  Press return for 'Most Recent' transmit date"
"RTN","HBHCR15B",9,0)
 D ^DIR Q:$D(DIRUT)
"RTN","HBHCR15B",10,0)
 I '$D(TMP(Y)) W *7,!!,"Please select number from list.",! H 1 G PROMPT1
"RTN","HBHCR15B",11,0)
 S HBHCXMDT=TMP(Y)
"RTN","HBHCR15B",12,0)
PROMPT2 ; Prompt user for which forms to include, default is Summary
"RTN","HBHCR15B",13,0)
 S HBHCCC=0
"RTN","HBHCR15B",14,0)
 D TODAY^HBHCUTL
"RTN","HBHCR15B",15,0)
 S:'$D(HBHCXMDT) HBHCXMDT=DT
"RTN","HBHCR15B",16,0)
 S:$P(^HBHC(631.9,1,0),U,7)]"" HBHCIOP=$P(^%ZIS(1,$P(^HBHC(631.9,1,0),U,7),0),U)
"RTN","HBHCR15B",17,0)
 K DIR,DIRUT
"RTN","HBHCR15B",18,0)
 S DIR(0)="S^3:Admission;4:Visit;5:Discharge;6:Correction;A:All;S:Summary;",DIR("A")="Select Forms to Include",DIR("B")="Summary",DIR("?")="Select form type to be included in report.  Press return for 'Summary'."
"RTN","HBHCR15B",19,0)
 D ^DIR Q:$D(DIRUT)
"RTN","HBHCR15B",20,0)
 S HBHCDIR=Y,HBHCY0=Y(0)
"RTN","HBHCR15B",21,0)
 S Y=HBHCXMDT D DD^%DT S HBHCHEAD=$S(HBHCDIR="S":Y_" Transmit, "_HBHCY0,1:Y_" Transmit, "_HBHCY0_" Forms,")
"RTN","HBHCR15B",22,0)
 Q
"RTN","HBHCR15B",23,0)
END ; End of report processing
"RTN","HBHCR15B",24,0)
 ; Count number of visits
"RTN","HBHCR15B",25,0)
 S HBHCCNT=0,HBHCNAME="" F  S HBHCNAME=$O(^TMP($J,HBHCNAME)) Q:HBHCNAME=""  S HBHCLST4=0 F  S HBHCLST4=$O(^TMP($J,HBHCNAME,HBHCLST4)) Q:HBHCLST4'>0  S HBHCDATE=0 F  S HBHCDATE=$O(^TMP($J,HBHCNAME,HBHCLST4,HBHCDATE)) Q:HBHCDATE'>0  D CONT
"RTN","HBHCR15B",26,0)
 D:IO'=IO(0)!($D(IO("S"))) HDRPAGE^HBHCUTL
"RTN","HBHCR15B",27,0)
 I '$D(IO("S")),IO=IO(0) S HBHCCC=HBHCCC+1 W @IOF D HDRPAGE^HBHCUTL
"RTN","HBHCR15B",28,0)
 D:HBHCDIR'="S" PRTLOOP
"RTN","HBHCR15B",29,0)
 I HBHCDIR="A" S HBHCHDR="W ?36,""Summary""" W @IOF D HDRPAGE^HBHCUTL
"RTN","HBHCR15B",30,0)
 W:(HBHCDIR'="A")&(HBHCDIR'="S") !
"RTN","HBHCR15B",31,0)
 W:(HBHCDIR=3)!(HBHCDIR="A")!(HBHCDIR="S") !,"Admit Eval/Adm Form 3 Total:",?32,$J(HBHCCNTA,5),!,"Reject Eval/Adm Form 3 Total:",?32,$J(HBHCCNTR,5)
"RTN","HBHCR15B",32,0)
 W:HBHCDIR=3 !?32,"-----",!,"All Eval/Adm Forms Total:",?31,$J(HBHCCNTA+HBHCCNTR,6),!
"RTN","HBHCR15B",33,0)
 W:(HBHCDIR=4)!(HBHCDIR="A")!(HBHCDIR="S") !,"Visit Form 4 Total:",?32,$J(HBHCCNT4,5)
"RTN","HBHCR15B",34,0)
 W:(HBHCDIR=5)!(HBHCDIR="A")!(HBHCDIR="S") !,"Discharge Form 5 Total:",?32,$J(HBHCCNT5,5)
"RTN","HBHCR15B",35,0)
 W:(HBHCDIR=6)!(HBHCDIR="A")!(HBHCDIR="S") !,"Correction Form 6 Total:",?32,$J(HBHCCNT6,5)
"RTN","HBHCR15B",36,0)
 W:(HBHCDIR="A")!(HBHCDIR="S") !?32,"-----",!,"All Forms Total:",?31,$J(HBHCCNTA+HBHCCNTR+HBHCCNT4+HBHCCNT5+HBHCCNT6,6)
"RTN","HBHCR15B",37,0)
 W:(HBHCDIR=4)!(HBHCDIR="A")!(HBHCDIR="S") !!,"Number of Visits Total:",?32,$J(HBHCCNT,5)
"RTN","HBHCR15B",38,0)
 D ENDRPT^HBHCUTL1
"RTN","HBHCR15B",39,0)
 Q
"RTN","HBHCR15B",40,0)
CONT ; Continue count of visits loop
"RTN","HBHCR15B",41,0)
 S HBHCPRV="" F  S HBHCPRV=$O(^TMP($J,HBHCNAME,HBHCLST4,HBHCDATE,HBHCPRV)) Q:HBHCPRV=""  S HBHCCNT=HBHCCNT+1
"RTN","HBHCR15B",42,0)
 Q
"RTN","HBHCR15B",43,0)
PRTLOOP ; Print loop
"RTN","HBHCR15B",44,0)
 S HBHCFORM="" F  S HBHCFORM=$O(^TMP("HBHC",$J,HBHCFORM)) Q:HBHCFORM=""  D HEADER,PRTLOOP2,SUB
"RTN","HBHCR15B",45,0)
 Q
"RTN","HBHCR15B",46,0)
PRTLOOP2 ; Print loop continued
"RTN","HBHCR15B",47,0)
 S HBHCACTN="" F  S HBHCACTN=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN)) Q:HBHCACTN=""  S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME)) Q:HBHCNAME=""  D PRTLOOP3
"RTN","HBHCR15B",48,0)
 Q
"RTN","HBHCR15B",49,0)
PRTLOOP3 ; Print loop continued (again)
"RTN","HBHCR15B",50,0)
 S HBHCLST4=0 F  S HBHCLST4=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME,HBHCLST4)) Q:HBHCLST4'>0  S HBHCDATE="" F  S HBHCDATE=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME,HBHCLST4,HBHCDATE)) Q:HBHCDATE=""  D PRTLOOP4
"RTN","HBHCR15B",51,0)
 Q
"RTN","HBHCR15B",52,0)
PRTLOOP4 ; Print loop continued (again & again)
"RTN","HBHCR15B",53,0)
 S HBHCPRV="" F  S HBHCPRV=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME,HBHCLST4,HBHCDATE,HBHCPRV)) Q:HBHCPRV=""  S HBHCIEN="" F  S HBHCIEN=$O(^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME,HBHCLST4,HBHCDATE,HBHCPRV,HBHCIEN)) Q:HBHCIEN=""  D PRINT
"RTN","HBHCR15B",54,0)
 Q
"RTN","HBHCR15B",55,0)
PRINT ; Print report
"RTN","HBHCR15B",56,0)
 S HBHCINFO=^TMP("HBHC",$J,HBHCFORM,HBHCACTN,HBHCNAME,HBHCLST4,HBHCDATE,HBHCPRV,HBHCIEN)
"RTN","HBHCR15B",57,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<10) W:HBHCPAGE>0 @IOF D HDRPAGE^HBHCUTL,HEADER
"RTN","HBHCR15B",58,0)
 W !?4,$S(HBHCFORM="A":3,HBHCFORM="V":4,HBHCFORM="D":5,1:6),?8,HBHCNAME,?31,HBHCLST4,?38,$E(HBHCDATE,1,2),"-",$E(HBHCDATE,3,4),"-",$E(HBHCDATE,7,8) W:$P(HBHCINFO,U,3)]"" ?46,"@"_$P(HBHCINFO,U,3)
"RTN","HBHCR15B",59,0)
 W ?55,$S(HBHCFORM=6:$P(HBHCINFO,U,2),HBHCFORM="A":HBHCACTN,HBHCFORM="V":$P(HBHCINFO,U),1:"") W:HBHCFORM="V" ?60,HBHCPRV
"RTN","HBHCR15B",60,0)
 Q
"RTN","HBHCR15B",61,0)
HEADER ; Sub-header module
"RTN","HBHCR15B",62,0)
 W !,$S(HBHCFORM=6:"Correction Form 6",HBHCFORM="A":"Evaluation/Admission Form 3",HBHCFORM="D":"Discharge Form 5",1:"Visit Form 4")_" Records",?55,$S(HBHCFORM=6:"Type",HBHCFORM="A":"Action",HBHCFORM="V":"Provider",1:""),!
"RTN","HBHCR15B",63,0)
 Q
"RTN","HBHCR15B",64,0)
SUB ; Sub-total module
"RTN","HBHCR15B",65,0)
 W:(HBHCDIR="A")&(HBHCFORM=6) !!?4,"Correction Form 6 Total:",?37,$J(HBHCCNT6,5),!,HBHCY
"RTN","HBHCR15B",66,0)
 W:(HBHCDIR="A")&(HBHCFORM="A") !!?4,"Admit Eval/Adm Form 3 Total:",?37,$J(HBHCCNTA,5),!?4,"Reject Eval/Adm Form 3 Total:",?37,$J(HBHCCNTR,5),!?37,"-----",!?4,"All Eval/Adm Forms Total:",?36,$J(HBHCCNTA+HBHCCNTR,6),!,HBHCY
"RTN","HBHCR15B",67,0)
 W:(HBHCDIR="A")&(HBHCFORM="D") !!?4,"Discharge Form 5 Total:",?37,$J(HBHCCNT5,5),!,HBHCY
"RTN","HBHCR15B",68,0)
 W:(HBHCDIR="A")&(HBHCFORM="V") !!?4,"Visit Form 4 Total:",?30,$J(HBHCCNT4,5)
"RTN","HBHCR15B",69,0)
 W:(HBHCDIR="A")&(HBHCFORM="V") !!?4,"Number of Visits Total:",?30,$J(HBHCCNT,5),!,HBHCY
"RTN","HBHCR15B",70,0)
 Q
"RTN","HBHCRP21")
0^11^B50803846
"RTN","HBHCRP21",1,0)
HBHCRP21 ; LR VAMC(IRMS)/MJT-HBHC report on file 632, number of pat visits by date range, with total pats & total visits, user selectable alpha or number of visits sort, number of visits has subtotals & summary, calls CPT^HBHCUTL3 ;9909
"RTN","HBHCRP21",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**13,15**;NOV 01, 1993
"RTN","HBHCRP21",3,0)
 D START^HBHCUTL
"RTN","HBHCRP21",4,0)
 G:(HBHCBEG1=-1)!(HBHCEND1=-1) EXIT
"RTN","HBHCRP21",5,0)
 W !,"Visits containing any of the following CPT Codes are omitted from report:"
"RTN","HBHCRP21",6,0)
 W !!?2,"99358  PROLONGED SERV, W/O CONTACT"
"RTN","HBHCRP21",7,0)
 W !?2,"99359  PROLONGED SERV, W/O CONTACT"
"RTN","HBHCRP21",8,0)
 W !?2,"99361  PHYSICIAN/TEAM CONFERENCE"
"RTN","HBHCRP21",9,0)
 W !?2,"99362  PHYSICIAN/TEAM CONFERENCE"
"RTN","HBHCRP21",10,0)
 W !?2,"99371  PHYSICIAN PHONE CONSULTATION"
"RTN","HBHCRP21",11,0)
 W !?2,"99372  PHYSICIAN PHONE CONSULTATION"
"RTN","HBHCRP21",12,0)
 W !?2,"99373  PHYSICIAN PHONE CONSULTATION"
"RTN","HBHCRP21",13,0)
 W !?2,"99374  HOME HEALTH CARE SUPERVISION"
"RTN","HBHCRP21",14,0)
 W !?2,"99375  HOME HEALTH CARE SUPERVISION"
"RTN","HBHCRP21",15,0)
 W !?2,"99376  CARE PLAN OVERSIGHT/OVER 60",!
"RTN","HBHCRP21",16,0)
PROMPT ; Prompt user for CPT code
"RTN","HBHCRP21",17,0)
 K DIR S DIR(0)="PO^81",DIR("A")="Enter any other CPT code you wish to omit",DIR("?")="Enter 5 digit CPT code you wish to omit from report." D ^DIR
"RTN","HBHCRP21",18,0)
 G:$D(DTOUT) EXIT I '$D(DUOUT) I X'="" S HBHCCPTL(X)="" G PROMPT
"RTN","HBHCRP21",19,0)
 W !
"RTN","HBHCRP21",20,0)
 ; Prompt user for sort preference
"RTN","HBHCRP21",21,0)
 K DIR S DIR(0)="SM^A:Alphabetical;V:Number of Visits",DIR("A")="Sort Preference",DIR("B")="V",DIR("?")="Sort report alphabetically by patient (A), or by number of visits (V).  Visit sort includes subtotals & summary." D ^DIR
"RTN","HBHCRP21",22,0)
 G:$D(DIRUT) EXIT
"RTN","HBHCRP21",23,0)
 ; HBHCFLG exists if visit sort selected
"RTN","HBHCRP21",24,0)
 S:X="V" HBHCFLG=1
"RTN","HBHCRP21",25,0)
 S %ZIS="Q",HBHCCC=0 K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP21",26,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP21",ZTDESC=$S($D(HBHCFLG):"HBPC Total Visits by Date Range Report,Visit Sort",1:"HBPC Total Visits by Date Range Report"),ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP21",27,0)
DQ ; De-queue
"RTN","HBHCRP21",28,0)
 ; CPT codes omitted from inclusion on report
"RTN","HBHCRP21",29,0)
 S HBHCCPTL(99358)="",HBHCCPTL(99359)="",HBHCCPTL(99361)="",HBHCCPTL(99362)="",HBHCCPTL(99371)="",HBHCCPTL(99372)="",HBHCCPTL(99373)="",HBHCCPTL(99374)="",HBHCCPTL(99375)="",HBHCCPTL(99376)=""
"RTN","HBHCRP21",30,0)
 U IO
"RTN","HBHCRP21",31,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCRP21",32,0)
 S $P(HBHCY,"-",81)="",$P(HBHCZ,"=",81)="",(HBHCCNT,HBHCCNT1,HBHCTOT)=0
"RTN","HBHCRP21",33,0)
 S HBHCHEAD=$S($D(HBHCFLG):"Total Visits by Date Range, Visit Sort",1:"Total Visits by Date Range")
"RTN","HBHCRP21",34,0)
 S HBHCHDR="W !?31,""Last"",?40,""Visit"",?68,""Discharge"",!,""Patient Name"",?31,""Four"",?40,""Total"",?50,""Date"",?68,""Date""",HBHCCOLM=(80-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP21",35,0)
LOOP ; Loop thru ^HBHC(632) "C" (appointment date) cross-ref to build report
"RTN","HBHCRP21",36,0)
 S X1=HBHCBEG1,X2=-1 D C^%DTC S HBHCAPDT=X_.9999,HBHCEND1=HBHCEND1_.9999
"RTN","HBHCRP21",37,0)
 F  S HBHCAPDT=$O(^HBHC(632,"C",HBHCAPDT)) Q:(HBHCAPDT="")!(HBHCAPDT>HBHCEND1)  S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"C",HBHCAPDT,HBHCDFN)) Q:HBHCDFN=""  S HBHCNOD0=^HBHC(632,HBHCDFN,0) D:$P(HBHCNOD0,U,7)="" PROCESS
"RTN","HBHCRP21",38,0)
 D TODAY^HBHCUTL D:IO'=IO(0)!($D(IO("S"))) HDRRANGE^HBHCUTL
"RTN","HBHCRP21",39,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 D HDRRANGE^HBHCUTL
"RTN","HBHCRP21",40,0)
 W:'$D(^TMP("HBHC",$J)) !!,"No Visits found for Date Range selected."
"RTN","HBHCRP21",41,0)
 I $D(^TMP("HBHC",$J)) W !!,"Visits containing any of the following CPT Codes are omitted from report:",! S HBHCCPT="" F  S HBHCCPT=$O(HBHCCPTL(HBHCCPT)) Q:HBHCCPT=""  S HBHC=^ICPT(HBHCCPT,0) W !?2,$P(HBHC,U)_"  "_$P(HBHC,U,2)
"RTN","HBHCRP21",42,0)
 I $D(^TMP("HBHC",$J)) W !!,HBHCY D:$D(HBHCFLG) SORT,PRTLOOP,SUMMARY I '$D(HBHCFLG) D APRTLOOP W !!,"Total Patients:  ",$J(HBHCCNT,4),!!,"Total Visits:  ",$J(HBHCTOT,6)
"RTN","HBHCRP21",43,0)
 D ENDRPT^HBHCUTL1
"RTN","HBHCRP21",44,0)
EXIT ; Exit module
"RTN","HBHCRP21",45,0)
 D ^%ZISC
"RTN","HBHCRP21",46,0)
 K DIR,HBHC,HBHCADDT,HBHCAPDT,HBHCBEG1,HBHCBEG2,HBHCCC,HBHCCNT,HBHCCNT1,HBHCCOLM,HBHCCPT,HBHCCPTL,HBHCDFN,HBHCDPT0,HBHCDSDT,HBHCEND1,HBHCEND2,HBHCFLAG,HBHCFLG,HBHCHEAD,HBHCHDR,HBHCI,HBHCIEN,HBHCINFO,HBHCNAME,HBHCNBR,HBHCNOD0
"RTN","HBHCRP21",47,0)
 K HBHCPAGE,HBHCLST4,HBHCTDY,HBHCTOT,HBHCY,HBHCZ,X,X1,X2,Y,^TMP("HBHC",$J)
"RTN","HBHCRP21",48,0)
 Q
"RTN","HBHCRP21",49,0)
PROCESS ; Process record & build ^TMP("HBHC",$J) global
"RTN","HBHCRP21",50,0)
 ; Quit if no CPT codes
"RTN","HBHCRP21",51,0)
 D CPT^HBHCUTL3 Q:'$D(HBHCCPTA)
"RTN","HBHCRP21",52,0)
 ; Quit if contains CPT code to be omitted
"RTN","HBHCRP21",53,0)
 K HBHCFLAG
"RTN","HBHCRP21",54,0)
 S HBHCI="" F  S HBHCI=$O(HBHCCPTA(HBHCI)) Q:(HBHCI="")!($D(HBHCFLAG))  S HBHCCPT=$P(HBHCCPTA(HBHCI),"  ") S:$D(HBHCCPTL(HBHCCPT)) HBHCFLAG=1
"RTN","HBHCRP21",55,0)
 Q:$D(HBHCFLAG)
"RTN","HBHCRP21",56,0)
 S HBHCDPT0=^DPT($P(HBHCNOD0,U),0),HBHCNAME=$P(HBHCDPT0,U),HBHCLST4=$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9)
"RTN","HBHCRP21",57,0)
 S (HBHCADDT,HBHCDSDT)=""
"RTN","HBHCRP21",58,0)
 S HBHCIEN=0 F  S HBHCIEN=$O(^HBHC(631,"B",$P(HBHCNOD0,U),HBHCIEN)) Q:HBHCIEN'>0  S HBHCINFO=^HBHC(631,HBHCIEN,0),HBHCADDT=$P(HBHCINFO,U,18),HBHCDSDT=$P(HBHCINFO,U,40)
"RTN","HBHCRP21",59,0)
 ; patient not in HBHC(631
"RTN","HBHCRP21",60,0)
 S:HBHCADDT="" HBHCADDT="n/a"
"RTN","HBHCRP21",61,0)
 S:HBHCDSDT="" HBHCDSDT="n/a"
"RTN","HBHCRP21",62,0)
 I $D(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)) S ^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)=^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)+1
"RTN","HBHCRP21",63,0)
 S:'$D(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)) ^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)=1
"RTN","HBHCRP21",64,0)
 Q
"RTN","HBHCRP21",65,0)
SORT ; Sort TMP according to number of visits
"RTN","HBHCRP21",66,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCNAME)) Q:HBHCNAME=""  S HBHCLST4="" F  S HBHCLST4=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4)) Q:HBHCLST4=""  D SORTLOOP
"RTN","HBHCRP21",67,0)
 Q
"RTN","HBHCRP21",68,0)
SORTLOOP ; Sort loop
"RTN","HBHCRP21",69,0)
 S HBHCADDT="" F  S HBHCADDT=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT)) Q:HBHCADDT=""  S HBHCDSDT="" F  S HBHCDSDT=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)) Q:HBHCDSDT=""  D SET
"RTN","HBHCRP21",70,0)
 Q
"RTN","HBHCRP21",71,0)
SET ; Set TMP in re-sorted order by number of visits, kill old TMP node
"RTN","HBHCRP21",72,0)
 S HBHCNBR=^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)
"RTN","HBHCRP21",73,0)
 S ^TMP("HBHC",$J,HBHCNBR,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)=HBHCNBR
"RTN","HBHCRP21",74,0)
 K ^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)
"RTN","HBHCRP21",75,0)
 Q
"RTN","HBHCRP21",76,0)
PRTLOOP ; Print loop
"RTN","HBHCRP21",77,0)
 S HBHCNBR="" F  S HBHCNBR=$O(^TMP("HBHC",$J,HBHCNBR)) Q:HBHCNBR=""  D PRTLOOP2 W:HBHCCNT1>0 !!?5,"Total Patients with ",HBHCNBR," Visit(s):  ",HBHCCNT1,!!,HBHCY S HBHC(HBHCNBR)=HBHCCNT1,HBHCCNT1=0
"RTN","HBHCRP21",78,0)
 Q
"RTN","HBHCRP21",79,0)
PRTLOOP2 ; Print loop continued
"RTN","HBHCRP21",80,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCNBR,HBHCNAME)) Q:HBHCNAME=""  S HBHCLST4="" F  S HBHCLST4=$O(^TMP("HBHC",$J,HBHCNBR,HBHCNAME,HBHCLST4)) Q:HBHCLST4=""  D PRTLOOP3
"RTN","HBHCRP21",81,0)
 Q
"RTN","HBHCRP21",82,0)
PRTLOOP3 ; Print loop continued again
"RTN","HBHCRP21",83,0)
 S HBHCADDT="" F  S HBHCADDT=$O(^TMP("HBHC",$J,HBHCNBR,HBHCNAME,HBHCLST4,HBHCADDT)) Q:HBHCADDT=""  S HBHCDSDT="" F  S HBHCDSDT=$O(^TMP("HBHC",$J,HBHCNBR,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)) Q:HBHCDSDT=""  D PRINT
"RTN","HBHCRP21",84,0)
 Q
"RTN","HBHCRP21",85,0)
APRTLOOP ; Print loop for alphabetic sort
"RTN","HBHCRP21",86,0)
 S HBHCNAME="" F  S HBHCNAME=$O(^TMP("HBHC",$J,HBHCNAME)) Q:HBHCNAME=""  S HBHCLST4="" F  S HBHCLST4=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4)) Q:HBHCLST4=""  D APRTLP2
"RTN","HBHCRP21",87,0)
 Q
"RTN","HBHCRP21",88,0)
APRTLP2 ; Print loop for alphabetic sort continued
"RTN","HBHCRP21",89,0)
 S HBHCADDT="" F  S HBHCADDT=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT)) Q:HBHCADDT=""  S HBHCDSDT="" F  S HBHCDSDT=$O(^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)) Q:HBHCDSDT=""  D PRINT
"RTN","HBHCRP21",90,0)
 Q
"RTN","HBHCRP21",91,0)
PRINT ; Print report
"RTN","HBHCRP21",92,0)
 S HBHCCNT=HBHCCNT+1
"RTN","HBHCRP21",93,0)
 S:$D(HBHCFLG) HBHCINFO=^TMP("HBHC",$J,HBHCNBR,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT),HBHCCNT1=HBHCCNT1+1
"RTN","HBHCRP21",94,0)
 S:'$D(HBHCFLG) HBHCINFO=^TMP("HBHC",$J,HBHCNAME,HBHCLST4,HBHCADDT,HBHCDSDT)
"RTN","HBHCRP21",95,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<7) W @IOF D HDRRANGE^HBHCUTL
"RTN","HBHCRP21",96,0)
 S HBHCTOT=HBHCTOT+($P(HBHCINFO,U))
"RTN","HBHCRP21",97,0)
 W !,$E(HBHCNAME,1,25),?31,$E(HBHCLST4,8,11),?41,$J($P(HBHCINFO,U),3)
"RTN","HBHCRP21",98,0)
 S Y=HBHCADDT D DD^%DT W ?50,Y
"RTN","HBHCRP21",99,0)
 S Y=HBHCDSDT D DD^%DT W ?68,$S(Y'="n/a":Y,1:"")
"RTN","HBHCRP21",100,0)
 W !,HBHCY
"RTN","HBHCRP21",101,0)
 Q
"RTN","HBHCRP21",102,0)
SUMMARY ; Print report summary
"RTN","HBHCRP21",103,0)
 W @IOF,HBHCZ,!?22,"******  Total Visits Summary  ******",!,HBHCZ,!
"RTN","HBHCRP21",104,0)
 S HBHCNBR=0 F  S HBHCNBR=$O(HBHC(HBHCNBR)) Q:HBHCNBR'>0  W !,"Total Patients with ",$J(HBHCNBR,3)," Visit(s):  ",$J(HBHC(HBHCNBR),4)
"RTN","HBHCRP21",105,0)
 W !?34,"------",!,"Total Patients:  ",?35,$J(HBHCCNT,4),!!,"Total Visits:  ",?33,$J(HBHCTOT,6)
"RTN","HBHCRP21",106,0)
 Q
"RTN","HBHCRP3")
0^2^B14398836
"RTN","HBHCRP3",1,0)
HBHCRP3 ; LR VAMC(IRMS)/MJT-HBHC report on file 632, individual patient visit data by date range, includes all fields, calls DX^HBHCUTL3,CPT^HBHCUTL3 ;9907
"RTN","HBHCRP3",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,15**;NOV 01, 1993
"RTN","HBHCRP3",3,0)
PROMPT ; Prompt user for patient name
"RTN","HBHCRP3",4,0)
 K DIC S DIC="^DPT(",DIC(0)="AEMQ",HBHCCC=0 D ^DIC
"RTN","HBHCRP3",5,0)
 G:Y=-1 EXIT
"RTN","HBHCRP3",6,0)
 S HBHCDPT=+Y
"RTN","HBHCRP3",7,0)
 I '$D(^HBHC(632,"B",HBHCDPT)) W *7,!!,"This patient has no visits on file.",!! H 3 G PROMPT
"RTN","HBHCRP3",8,0)
 D START^HBHCUTL
"RTN","HBHCRP3",9,0)
 G:(HBHCBEG1=-1)!(HBHCEND1=-1) EXIT
"RTN","HBHCRP3",10,0)
 S %ZIS="Q",HBHCCC=0 K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP3",11,0)
 S $P(HBHCY,"-",133)="",$P(HBHCZ,"=",133)=""
"RTN","HBHCRP3",12,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP3",ZTDESC="HBPC Patient Visit Data Report",ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP3",13,0)
DQ ; De-queue
"RTN","HBHCRP3",14,0)
 U IO
"RTN","HBHCRP3",15,0)
 S $P(HBHCSP2," ",3)="",HBHCDPT0=^DPT(HBHCDPT,0),HBHCINFO=$P(HBHCDPT0,U)_HBHCSP2_$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9),HBHCHEAD="Patient:  "_HBHCINFO_"  Visit Data"
"RTN","HBHCRP3",16,0)
 S HBHCMSG="(continued from previous page...)",HBHCHDR="W ""Visit"",?11,""Prov"",!,""Date"",?11,""No."",?18,""Provider Name"",?56,""Diagnosis"",?97,""CPT Code""",HBHCCOLM=(132-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP3",17,0)
 D:IO'=IO(0)!($D(IO("S"))) HDR132^HBHCUTL
"RTN","HBHCRP3",18,0)
 I '$D(IO("S")),IO=IO(0) S HBHCCC=HBHCCC+1 D HDR132^HBHCUTL
"RTN","HBHCRP3",19,0)
LOOP ; Loop thru ^HBHC(632) "B" cross-ref to build report
"RTN","HBHCRP3",20,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"B",HBHCDPT,HBHCDFN)) Q:HBHCDFN=""  S HBHCNOD0=^HBHC(632,HBHCDFN,0) D:$P(HBHCNOD0,U,7)="" PROCESS
"RTN","HBHCRP3",21,0)
 D END132^HBHCUTL1
"RTN","HBHCRP3",22,0)
EXIT ; Exit module
"RTN","HBHCRP3",23,0)
 D ^%ZISC
"RTN","HBHCRP3",24,0)
 K DIC,HBHCBEG1,HBHCBEG2,HBHCCC,HBHCCNT,HBHCCOLM,HBHCCPT,HBHCCPTA,HBHCDFN,HBHCDPT,HBHCDPT0,HBHCDX1,HBHCDX2,HBHCDX3,HBHCDX4,HBHCDX5,HBHCEND1,HBHCEND2,HBHCHDR,HBHCHEAD,HBHCI,HBHCINFO,HBHCMSG,HBHCNOD0,HBHCPAGE,HBHCPRV,HBHCSP2
"RTN","HBHCRP3",25,0)
 K HBHCTDY,HBHCY,HBHCZ,X,Y
"RTN","HBHCRP3",26,0)
 Q
"RTN","HBHCRP3",27,0)
PROCESS ; Process record
"RTN","HBHCRP3",28,0)
 Q:($E($P(HBHCNOD0,U,2),1,7)<HBHCBEG1)!($E($P(HBHCNOD0,U,2),1,7)>HBHCEND1)
"RTN","HBHCRP3",29,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<5) W @IOF D HDR132^HBHCUTL
"RTN","HBHCRP3",30,0)
 S HBHCPRV=$S($P(HBHCNOD0,U,4)]"":$P(^VA(200,$P(^HBHC(631.4,$P(HBHCNOD0,U,4),0),U,2),0),U),1:"")
"RTN","HBHCRP3",31,0)
 D DX^HBHCUTL3,CPT^HBHCUTL3
"RTN","HBHCRP3",32,0)
 W !,$S($P(HBHCNOD0,U,2)]"":$E($P(HBHCNOD0,U,2),4,5)_"-"_$E($P(HBHCNOD0,U,2),6,7)_"-"_$E($P(HBHCNOD0,U,2),2,3),1:""),?11,$P(^HBHC(631.4,$P(HBHCNOD0,U,4),0),U),?18,HBHCPRV,?56,HBHCDX1,?97,HBHCCPTA(1)
"RTN","HBHCRP3",33,0)
 ; HBHCI must be initialized to 1, since HBHCCPTA(1) has already been printed above
"RTN","HBHCRP3",34,0)
 S (HBHCCNT,HBHCI)=1 F  S HBHCI=$O(HBHCCPTA(HBHCI)) Q:HBHCI'>0  D WRITE
"RTN","HBHCRP3",35,0)
 I $D(HBHCDX2) W:HBHCDX2]"" !?56,HBHCDX2
"RTN","HBHCRP3",36,0)
 I $D(HBHCDX3) W:HBHCDX3]"" !?56,HBHCDX3
"RTN","HBHCRP3",37,0)
 I $D(HBHCDX4) W:HBHCDX4]"" !?56,HBHCDX4
"RTN","HBHCRP3",38,0)
 I $D(HBHCDX5) W:HBHCDX5]"" !?56,HBHCDX5
"RTN","HBHCRP3",39,0)
 W !,HBHCY
"RTN","HBHCRP3",40,0)
 Q
"RTN","HBHCRP3",41,0)
WRITE ; Write DX & CPT info
"RTN","HBHCRP3",42,0)
 S HBHCCNT=HBHCCNT+1
"RTN","HBHCRP3",43,0)
 I (IOSL-$Y)<5 W @IOF D HDR132^HBHCUTL W !,$S($P(HBHCNOD0,U,2)]"":$E($P(HBHCNOD0,U,2),4,5)_"-"_$E($P(HBHCNOD0,U,2),6,7)_"-"_$E($P(HBHCNOD0,U,2),2,3),1:""),?11,$P(^HBHC(631.4,$P(HBHCNOD0,U,4),0),U),?18,HBHCPRV,?67,HBHCMSG
"RTN","HBHCRP3",44,0)
 W !
"RTN","HBHCRP3",45,0)
 I HBHCCNT=2 W:(HBHCDX2]"") ?56,HBHCDX2 K HBHCDX2
"RTN","HBHCRP3",46,0)
 I HBHCCNT=3 W:(HBHCDX3]"") ?56,HBHCDX3 K HBHCDX3
"RTN","HBHCRP3",47,0)
 I HBHCCNT=4 W:(HBHCDX4]"") ?56,HBHCDX4 K HBHCDX4
"RTN","HBHCRP3",48,0)
 I HBHCCNT=5 W:(HBHCDX5]"") ?56,HBHCDX5 K HBHCDX5
"RTN","HBHCRP3",49,0)
 W ?97,HBHCCPTA(HBHCI)
"RTN","HBHCRP3",50,0)
 Q
"RTN","HBHCRP4")
0^4^B25423017
"RTN","HBHCRP4",1,0)
HBHCRP4 ; LR VAMC(IRMS)/MJT-HBHC report on file 632, visit data by date range, sorted by provider, then by visit date, includes all fields, & total, calls DX^HBHCUTL3 & CPT^HBHCUTL3 ;9907
"RTN","HBHCRP4",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,15**;NOV 01, 1993
"RTN","HBHCRP4",3,0)
 D START^HBHCUTL
"RTN","HBHCRP4",4,0)
 G:(HBHCBEG1=-1)!(HBHCEND1=-1) EXIT
"RTN","HBHCRP4",5,0)
 S %ZIS="Q",HBHCCC=0 K IOP,ZTIO,ZTSAVE D ^%ZIS G:POP EXIT
"RTN","HBHCRP4",6,0)
 I $D(IO("Q")) S ZTRTN="DQ^HBHCRP4",ZTDESC="HBPC Visit Data Date Range Report",ZTSAVE("HBHC*")="" D ^%ZTLOAD G EXIT
"RTN","HBHCRP4",7,0)
DQ ; De-queue
"RTN","HBHCRP4",8,0)
 U IO
"RTN","HBHCRP4",9,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCRP4",10,0)
 S HBHCHEAD="Visit Data by Date Range",HBHCHDR="W ""Prov"",!,""No."",?7,""Date"",?18,""Patient Name"",?42,""SSN"",?56,""Diagnosis"",?97,""CPT Code""",HBHCCOLM=(132-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCRP4",11,0)
 S HBHCTOT=0,$P(HBHCY,"-",133)="",$P(HBHCZ,"=",133)=""
"RTN","HBHCRP4",12,0)
LOOP ; Loop thru ^HBHC(632) "C" (visit date) cross-ref to build report
"RTN","HBHCRP4",13,0)
 S X1=HBHCBEG1,X2=-1 D C^%DTC S HBHCDATE=X_.9999
"RTN","HBHCRP4",14,0)
 F  S HBHCDATE=$O(^HBHC(632,"C",HBHCDATE)) Q:(HBHCDATE="")!($P(HBHCDATE,".")>HBHCEND1)  S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"C",HBHCDATE,HBHCDFN)) Q:HBHCDFN=""  D PROCESS
"RTN","HBHCRP4",15,0)
 D:IO'=IO(0)!($D(IO("S"))) HDR132^HBHCUTL
"RTN","HBHCRP4",16,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 D HDR132^HBHCUTL
"RTN","HBHCRP4",17,0)
 W:'$D(^TMP("HBHC",$J)) !!,"No Visits found for Date Range selected."
"RTN","HBHCRP4",18,0)
 I $D(^TMP("HBHC",$J)) D PRTLOOP W !!,HBHCZ,!,"Total Visits: ",HBHCTOT,!,HBHCZ
"RTN","HBHCRP4",19,0)
 D END132^HBHCUTL1
"RTN","HBHCRP4",20,0)
EXIT ; Exit module
"RTN","HBHCRP4",21,0)
 D ^%ZISC
"RTN","HBHCRP4",22,0)
 K DIC,HBHCBEG1,HBHCBEG2,HBHCCC,HBHCCCC,HBHCCNT,HBHCCOLM,HBHCCPT,HBHCCPTA,HBHCDATE,HBHCDFN,HBHCDPT0,HBHCDX1,HBHCDX2,HBHCDX3,HBHCDX4,HBHCDX5,HBHCEND1,HBHCEND2,HBHCHDR,HBHCHEAD,HBHCI,HBHCNOD0,HBHCPAGE,HBHCPRV,HBHCSUB,HBHCTDY
"RTN","HBHCRP4",23,0)
 K HBHCTMP,HBHCTOT,HBHCY,HBHCZ,X,X1,X2,Y,^TMP("HBHC",$J)
"RTN","HBHCRP4",24,0)
 Q
"RTN","HBHCRP4",25,0)
PROCESS ; Process record & create ^TMP("HBHC",$J global
"RTN","HBHCRP4",26,0)
 S HBHCNOD0=^HBHC(632,HBHCDFN,0),HBHCDPT0=^DPT($P(HBHCNOD0,U),0)
"RTN","HBHCRP4",27,0)
 Q:$P(HBHCNOD0,U,7)]""
"RTN","HBHCRP4",28,0)
 S HBHCPRV=$S($P(HBHCNOD0,U,4)]"":$P(^HBHC(631.4,$P(HBHCNOD0,U,4),0),U),1:"None")
"RTN","HBHCRP4",29,0)
 D DX^HBHCUTL3,CPT^HBHCUTL3
"RTN","HBHCRP4",30,0)
 S ^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,1)=$E($P(HBHCDPT0,U),1,21)_U_$E($P(HBHCDPT0,U,9),1,3)_"-"_$E($P(HBHCDPT0,U,9),4,5)_"-"_$E($P(HBHCDPT0,U,9),6,9)_U_HBHCDX1_U_HBHCCPTA(1)
"RTN","HBHCRP4",31,0)
 S:HBHCDX2]"" ^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,2)=HBHCDX2_U_HBHCDX3_U_HBHCDX4_U_HBHCDX5
"RTN","HBHCRP4",32,0)
 S HBHCCNT=0,HBHCSUB=3,HBHCI=1 F  S HBHCI=$O(HBHCCPTA(HBHCI)) Q:HBHCI'>0  S:HBHCCNT>4 HBHCCNT=0,HBHCSUB=HBHCSUB+1 D SET
"RTN","HBHCRP4",33,0)
 Q
"RTN","HBHCRP4",34,0)
SET ; Set TMP global
"RTN","HBHCRP4",35,0)
 S:$D(^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,HBHCSUB)) ^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,HBHCSUB)=^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,HBHCSUB)_HBHCCPTA(HBHCI)_U
"RTN","HBHCRP4",36,0)
 S:'$D(^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,HBHCSUB)) ^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,HBHCSUB)=HBHCCPTA(HBHCI)_U
"RTN","HBHCRP4",37,0)
 S HBHCCNT=HBHCCNT+1
"RTN","HBHCRP4",38,0)
 Q
"RTN","HBHCRP4",39,0)
PRTLOOP ; Print loop
"RTN","HBHCRP4",40,0)
 S HBHCPRV=""
"RTN","HBHCRP4",41,0)
 F  S HBHCPRV=$O(^TMP("HBHC",$J,HBHCPRV)) Q:HBHCPRV=""  S HBHCDATE="" F  S HBHCDATE=$O(^TMP("HBHC",$J,HBHCPRV,HBHCDATE)) Q:HBHCDATE=""  S HBHCDFN="" F  S HBHCDFN=$O(^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN)) Q:HBHCDFN=""  D PRINT
"RTN","HBHCRP4",42,0)
 Q
"RTN","HBHCRP4",43,0)
PRINT ; Print report
"RTN","HBHCRP4",44,0)
 K HBHCTMP
"RTN","HBHCRP4",45,0)
 S HBHCTMP(1)=^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,1)
"RTN","HBHCRP4",46,0)
 S HBHCTMP(2)=$G(^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,2))
"RTN","HBHCRP4",47,0)
 ; HBHCI must be initialized to 2, since nodes 1 & 2 are hardcoded above
"RTN","HBHCRP4",48,0)
 S HBHCI=2 F  S HBHCI=$O(^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,HBHCI))  Q:HBHCI'>0  S HBHCTMP(HBHCI)=^TMP("HBHC",$J,HBHCPRV,HBHCDATE,HBHCDFN,HBHCI)
"RTN","HBHCRP4",49,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<5) W @IOF D HDR132^HBHCUTL
"RTN","HBHCRP4",50,0)
 W !,HBHCPRV,?7,$E(HBHCDATE,4,5)_"-"_$E(HBHCDATE,6,7)_"-"_$E(HBHCDATE,2,3),?18,$P(HBHCTMP(1),U),?42,$P(HBHCTMP(1),U,2),?56,$P(HBHCTMP(1),U,3),?97,$P(HBHCTMP(1),U,4) S HBHCTOT=HBHCTOT+1
"RTN","HBHCRP4",51,0)
 ; Set DX fields
"RTN","HBHCRP4",52,0)
 S HBHCDX2=$P(HBHCTMP(2),U)
"RTN","HBHCRP4",53,0)
 S HBHCDX3=$P(HBHCTMP(2),U,2)
"RTN","HBHCRP4",54,0)
 S HBHCDX4=$P(HBHCTMP(2),U,3)
"RTN","HBHCRP4",55,0)
 S HBHCDX5=$P(HBHCTMP(2),U,4)
"RTN","HBHCRP4",56,0)
 ; HBHCI must be initialized to 2, since nodes 1 & 2 are hardcoded above
"RTN","HBHCRP4",57,0)
 S HBHCI=2 F  S HBHCI=$O(HBHCTMP(HBHCI)) Q:HBHCI'>0  D WRITE
"RTN","HBHCRP4",58,0)
 I $D(HBHCDX2) W:HBHCDX2]"" !?56,HBHCDX2
"RTN","HBHCRP4",59,0)
 I $D(HBHCDX3) W:HBHCDX3]"" !?56,HBHCDX3
"RTN","HBHCRP4",60,0)
 I $D(HBHCDX4) W:HBHCDX4]"" !?56,HBHCDX4
"RTN","HBHCRP4",61,0)
 I $D(HBHCDX5) W:HBHCDX5]"" !?56,HBHCDX5
"RTN","HBHCRP4",62,0)
 W !,HBHCY
"RTN","HBHCRP4",63,0)
 Q
"RTN","HBHCRP4",64,0)
WRITE ; Write DX & CPT info
"RTN","HBHCRP4",65,0)
 I (IOSL-$Y)<5 W @IOF D HDR132^HBHCUTL W !,HBHCPRV,?7,$E(HBHCDATE,4,5)_"-"_$E(HBHCDATE,6,7)_"-"_$E(HBHCDATE,2,3),?18,$P(HBHCTMP(1),U),?42,$P(HBHCTMP(1),U,2),?67,"(continued from previous page...)"
"RTN","HBHCRP4",66,0)
 I $P(HBHCTMP(HBHCI),U)]"" W:$D(HBHCDX2) !?56,HBHCDX2 W:'$D(HBHCDX2) ! W ?97,$P(HBHCTMP(HBHCI),U) K HBHCDX2
"RTN","HBHCRP4",67,0)
 I $P(HBHCTMP(HBHCI),U,2)]"" W:$D(HBHCDX3) !?56,HBHCDX3 W:'$D(HBHCDX3) ! W ?97,$P(HBHCTMP(HBHCI),U,2) K HBHCDX3
"RTN","HBHCRP4",68,0)
 I $P(HBHCTMP(HBHCI),U,3)]"" W:$D(HBHCDX4) !?56,HBHCDX4 W:'$D(HBHCDX4) ! W ?97,$P(HBHCTMP(HBHCI),U,3) K HBHCDX4
"RTN","HBHCRP4",69,0)
 I $P(HBHCTMP(HBHCI),U,4)]"" W:$D(HBHCDX5) !?56,HBHCDX5 W:'$D(HBHCDX5) ! W ?97,$P(HBHCTMP(HBHCI),U,4) K HBHCDX5
"RTN","HBHCRP4",70,0)
 I $P(HBHCTMP(HBHCI),U,5)]"" W !?97,$P(HBHCTMP(HBHCI),U,5)
"RTN","HBHCRP4",71,0)
 Q
"RTN","HBHCUTL3")
0^3^B9865123
"RTN","HBHCUTL3",1,0)
HBHCUTL3 ; LR VAMC(IRMS)/MJT-HBHC Utility module, Entry points:  PSEUDO, PCEMSG, DX, & CPT ;9907
"RTN","HBHCUTL3",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10,15**;NOV 01, 1993
"RTN","HBHCUTL3",3,0)
PSEUDO ; Print pseudo SSN message
"RTN","HBHCUTL3",4,0)
 W *7,!!,"Patient visit records with pseudo social security numbers (SSNs) exist.",!,"Print the 'Pseudo Social Security Number Report' located on the HBHC Reports"
"RTN","HBHCUTL3",5,0)
 W !,"Menu to obtain a list of patients with invalid SSNs.  HBHC must determine",!,"what corrective action is appropriate to eliminate these records from the",!,"HBHC Information System.",!! H 5
"RTN","HBHCUTL3",6,0)
 Q
"RTN","HBHCUTL3",7,0)
PCEMSG ; Print PCE correction of errors message
"RTN","HBHCUTL3",8,0)
 W !!,"Note:  Please use Appointment Management to Correct Visit Errors.  Run",!?7,"Edit Form Errors Data option when corrections are complete."
"RTN","HBHCUTL3",9,0)
 Q
"RTN","HBHCUTL3",10,0)
DX ; Process Diagnosis (DX), HBHCNOD0=^HBHC(632,HBHCDFN,0), HBHCNOD0 must be defined prior to call, returns code plus text
"RTN","HBHCUTL3",11,0)
 ; Dx
"RTN","HBHCUTL3",12,0)
 S $P(HBHCSP5," ",6)=""
"RTN","HBHCUTL3",13,0)
 S HBHCDX1=$S($P(HBHCNOD0,U,17)]"":$P(^ICD9($P(HBHCNOD0,U,17),0),U)_$E(HBHCSP5,1,(8-$L($P(^ICD9($P(HBHCNOD0,U,17),0),U))))_$P(^ICD9($P(HBHCNOD0,U,17),0),U,3),1:"")
"RTN","HBHCUTL3",14,0)
 S HBHCDX2=$S($P(HBHCNOD0,U,18)]"":$P(^ICD9($P(HBHCNOD0,U,18),0),U)_$E(HBHCSP5,1,(8-$L($P(^ICD9($P(HBHCNOD0,U,18),0),U))))_$P(^ICD9($P(HBHCNOD0,U,18),0),U,3),1:"")
"RTN","HBHCUTL3",15,0)
 S HBHCDX3=$S($P(HBHCNOD0,U,19)]"":$P(^ICD9($P(HBHCNOD0,U,19),0),U)_$E(HBHCSP5,1,(8-$L($P(^ICD9($P(HBHCNOD0,U,19),0),U))))_$P(^ICD9($P(HBHCNOD0,U,19),0),U,3),1:"")
"RTN","HBHCUTL3",16,0)
 S HBHCDX4=$S($P(HBHCNOD0,U,20)]"":$P(^ICD9($P(HBHCNOD0,U,20),0),U)_$E(HBHCSP5,1,(8-$L($P(^ICD9($P(HBHCNOD0,U,20),0),U))))_$P(^ICD9($P(HBHCNOD0,U,20),0),U,3),1:"")
"RTN","HBHCUTL3",17,0)
 S HBHCDX5=$S($P(HBHCNOD0,U,21)]"":$P(^ICD9($P(HBHCNOD0,U,21),0),U)_$E(HBHCSP5,1,(8-$L($P(^ICD9($P(HBHCNOD0,U,21),0),U))))_$P(^ICD9($P(HBHCNOD0,U,21),0),U,3),1:"")
"RTN","HBHCUTL3",18,0)
 K HBHCSP5
"RTN","HBHCUTL3",19,0)
 Q
"RTN","HBHCUTL3",20,0)
CPT ; CPT code info, returns code plus text in local array HBHCCPTA
"RTN","HBHCUTL3",21,0)
 K HBHCCPTA S HBHCI=0 F  S HBHCI=$O(^HBHC(632,HBHCDFN,2,HBHCI)) Q:HBHCI'>0  S HBHCCPT=^HBHC(632,HBHCDFN,2,HBHCI,0),HBHCCPTA(HBHCI)=$P(^ICPT(HBHCCPT,0),U)_"  "_$P(^ICPT(HBHCCPT,0),U,2)
"RTN","HBHCUTL3",22,0)
 Q
"RTN","HBHCUTL4")
0^5^B15716623
"RTN","HBHCUTL4",1,0)
HBHCUTL4 ; LR VAMC(IRMS)/MJT-HBHC report on file 632, user selected date range, CPT code(s) (can be range of CPTs), & Provider, with summary totals, calls: CPT^HBHCUTL3, called from: ^HBHCRP17 & ^HBHCRP22, entry points: EN1, EN2 & KILL ;9910
"RTN","HBHCUTL4",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**11,15**;NOV 01, 1993
"RTN","HBHCUTL4",3,0)
EN1 ; Entry point 1
"RTN","HBHCUTL4",4,0)
 D START^HBHCUTL
"RTN","HBHCUTL4",5,0)
 G:(HBHCBEG1=-1)!(HBHCEND1=-1) EXIT
"RTN","HBHCUTL4",6,0)
 S HBHCMSG="CPT Code must contain 5 numerics for use in a range."
"RTN","HBHCUTL4",7,0)
 W ! K DIR,DIRUT S DIR(0)="YO",DIR("A")="Will CPT Codes selected be a Range of codes  (Y/N)",DIR("?")="Enter 'Y' for Yes, a range of CPT Codes is requested, 'N' for No, individual CPT codes will be selected." D ^DIR G:$D(DIRUT) EXIT S HBHCDIR=Y
"RTN","HBHCUTL4",8,0)
 W ! K DIC,DTOUT,DUOUT S DIC="^ICPT(",DIC(0)="AEMNQZ",DIC("A")="Select Beginning CPT Code:  "
"RTN","HBHCUTL4",9,0)
BEGCPT ; Prompt for beginning CPT code of range
"RTN","HBHCUTL4",10,0)
 I HBHCDIR=1 D ^DIC G:(Y=-1)!($D(DTOUT))!($D(DUOUT)) EXIT I +$P(Y,U)'?3.5N W $C(7),!!,HBHCMSG,! G BEGCPT
"RTN","HBHCUTL4",11,0)
 S:HBHCDIR=1 HBHCCPTB=$P(Y,U),DIC("A")="Select Ending CPT Code:  "
"RTN","HBHCUTL4",12,0)
ENDCPT ; Prompt for Ending CPT Code of range
"RTN","HBHCUTL4",13,0)
 I HBHCDIR=1 D ^DIC G:(Y=-1)!($D(DTOUT))!($D(DUOUT)) EXIT I +$P(Y,U)'?3.5N W $C(7),!!,HBHCMSG,! G ENDCPT
"RTN","HBHCUTL4",14,0)
 I HBHCDIR=1 S:($P(Y,U)'<HBHCCPTB) HBHCCPTE=$P(Y,U) I ($P(Y,U)<HBHCCPTB) W $C(7),!!,"Ending CPT Code in range must be greater than the Beginning CPT Code",! G ENDCPT
"RTN","HBHCUTL4",15,0)
 I HBHCDIR=0 K DIC("A"),HBHCTMP
"RTN","HBHCUTL4",16,0)
CPT ; Prompt for CPT code(s)
"RTN","HBHCUTL4",17,0)
 I HBHCDIR=0 D ^DIC G:(Y=-1)!($D(DTOUT))!($D(DUOUT)) EXIT S HBHCTMP(""_$P(Y(0),U)_"")=$P(Y(0),U,2) G CPT
"RTN","HBHCUTL4",18,0)
 Q
"RTN","HBHCUTL4",19,0)
EN2 ; Entry point 2
"RTN","HBHCUTL4",20,0)
 U IO
"RTN","HBHCUTL4",21,0)
 K ^TMP("HBHC",$J)
"RTN","HBHCUTL4",22,0)
 S HBHCCC=0,HBHCHDR="W !,""CPT Code"",?39,""Total""",HBHCCOLM=(80-(30+$L(HBHCHEAD))\2) S:HBHCCOLM'>0 HBHCCOLM=1
"RTN","HBHCUTL4",23,0)
 S HBHCTOT=0,$P(HBHCY,"-",81)=""
"RTN","HBHCUTL4",24,0)
LOOP ; Loop thru ^HBHC(632) "C" (visit date) cross-ref to build report
"RTN","HBHCUTL4",25,0)
 S X1=HBHCBEG1,X2=-1 D C^%DTC S HBHCDATE=X_.9999
"RTN","HBHCUTL4",26,0)
 F  S HBHCDATE=$O(^HBHC(632,"C",HBHCDATE)) Q:(HBHCDATE="")!($P(HBHCDATE,".")>HBHCEND1)  S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"C",HBHCDATE,HBHCDFN)) Q:HBHCDFN=""  S HBHCNOD0=^HBHC(632,HBHCDFN,0) D:$P(HBHCNOD0,U,7)="" PROCESS
"RTN","HBHCUTL4",27,0)
 D:IO'=IO(0)!($D(IO("S"))) HDRRANGE^HBHCUTL
"RTN","HBHCUTL4",28,0)
 I '$D(IO("S")),(IO=IO(0)) S HBHCCC=HBHCCC+1 D HDRRANGE^HBHCUTL
"RTN","HBHCUTL4",29,0)
 W:'$D(^TMP("HBHC",$J)) !!,"No Visits containing CPT codes requested found for Date Range selected."
"RTN","HBHCUTL4",30,0)
 I $D(^TMP("HBHC",$J)) D PRTLOOP
"RTN","HBHCUTL4",31,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<5) W @IOF D HDRRANGE^HBHCUTL
"RTN","HBHCUTL4",32,0)
 W !!,HBHCZ,!,"Total CPT Codes:  ",$J(HBHCTOT,6),!,HBHCZ
"RTN","HBHCUTL4",33,0)
 D ENDRPT^HBHCUTL1
"RTN","HBHCUTL4",34,0)
EXIT ; Exit module
"RTN","HBHCUTL4",35,0)
 Q
"RTN","HBHCUTL4",36,0)
PROCESS ; Process record & create ^TMP("HBHC",$J global
"RTN","HBHCUTL4",37,0)
 ; Quit if not provider requested, only relevant from ^HBHCRP22
"RTN","HBHCUTL4",38,0)
 I $D(HBHCPRV) Q:$P(HBHCNOD0,U,4)'=HBHCPRV
"RTN","HBHCUTL4",39,0)
 S HBHCDPT0=^DPT($P(HBHCNOD0,U),0)
"RTN","HBHCUTL4",40,0)
 D CPT^HBHCUTL3
"RTN","HBHCUTL4",41,0)
 S HBHCI=0 F  S HBHCI=$O(HBHCCPTA(HBHCI)) Q:HBHCI'>0  S HBHCCPT=HBHCCPTA(HBHCI) D SET
"RTN","HBHCUTL4",42,0)
 Q
"RTN","HBHCUTL4",43,0)
SET ; Set TMP node for CPTs
"RTN","HBHCUTL4",44,0)
 I HBHCDIR=1 Q:(($P(HBHCCPT,"  "))<HBHCCPTB)!(($P(HBHCCPT,"  "))>HBHCCPTE)
"RTN","HBHCUTL4",45,0)
 Q:(HBHCDIR=0)&('$D(HBHCTMP($P(HBHCCPT,"  "))))
"RTN","HBHCUTL4",46,0)
 S:$D(^TMP("HBHC",$J,HBHCCPT)) ^TMP("HBHC",$J,HBHCCPT)=^TMP("HBHC",$J,HBHCCPT)+1
"RTN","HBHCUTL4",47,0)
 S:'$D(^TMP("HBHC",$J,HBHCCPT)) ^TMP("HBHC",$J,HBHCCPT)=1
"RTN","HBHCUTL4",48,0)
 Q
"RTN","HBHCUTL4",49,0)
PRTLOOP ; Print loop
"RTN","HBHCUTL4",50,0)
 S HBHCCPT="" F  S HBHCCPT=$O(^TMP("HBHC",$J,HBHCCPT)) Q:HBHCCPT=""  D PRINT
"RTN","HBHCUTL4",51,0)
 Q
"RTN","HBHCUTL4",52,0)
PRINT ; Print report
"RTN","HBHCUTL4",53,0)
 S HBHCCNT=^TMP("HBHC",$J,HBHCCPT)
"RTN","HBHCUTL4",54,0)
 S HBHCTOT=HBHCTOT+HBHCCNT
"RTN","HBHCUTL4",55,0)
 I ($D(ZTRTN)!(HBHCCC=0))&((IOSL-$Y)<5) W @IOF D HDRRANGE^HBHCUTL
"RTN","HBHCUTL4",56,0)
 W !,HBHCCPT,?39,$J(HBHCCNT,5)
"RTN","HBHCUTL4",57,0)
 W !,HBHCY
"RTN","HBHCUTL4",58,0)
 Q
"RTN","HBHCUTL4",59,0)
KILL ; Kill variables
"RTN","HBHCUTL4",60,0)
 K DIR,DIRUT,HBHCBEG2,HBHCCC,HBHCCNT,HBHCCOLM,HBHCCPTA,HBHCCPT,HBHCDATE,HBHCDFN,HBHCDIR,HBHCDPT0,HBHCEND2,HBHCHDR,HBHCI,HBHCMSG,HBHCNOD0,HBHCPAGE,HBHCTDY,HBHCTMP,HBHCTOT,HBHCY,HBHCZ,X,X1,X2,^TMP("HBHC",$J)
"RTN","HBHCUTL4",61,0)
 Q
"RTN","HBHCXMV")
0^6^B23217539
"RTN","HBHCXMV",1,0)
HBHCXMV ; LR VAMC(IRMS)/MJT-HBHC populate ^HBHC(634 with Visit Data, or ^HBHC(634.5, file of recs in ^HBHC(632 w/pseudo SSNs, called by ^HBHCFILE, calls HBHCXMV1 ;9908
"RTN","HBHCXMV",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,5,6,9,12,15**;NOV 01, 1993
"RTN","HBHCXMV",3,0)
 D START^HBHCXMV1
"RTN","HBHCXMV",4,0)
LOOP ; Loop thru ^HBHC(632) "AC","N" cross-ref to create nodes in ^HBHC(634) => transmit
"RTN","HBHCXMV",5,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"AC","N",HBHCDFN)) Q:HBHCDFN=""  D SETNODE
"RTN","HBHCXMV",6,0)
EXIT ; Exit module
"RTN","HBHCXMV",7,0)
 D EXIT^HBHCXMV1
"RTN","HBHCXMV",8,0)
 Q
"RTN","HBHCXMV",9,0)
SETNODE ; Set node in ^HBHC(634) (Transmit)
"RTN","HBHCXMV",10,0)
 S HBHCINFO=^HBHC(632,HBHCDFN,0),HBHCXMT4=$P(HBHCINFO,U,8),HBHCAPDT=$P(HBHCINFO,U,2),HBHCSSN=$P(^DPT($P(HBHCINFO,U),0),U,9)
"RTN","HBHCXMV",11,0)
 Q:$P(HBHCINFO,U,7)]""  ; cancelled/no show appointment
"RTN","HBHCXMV",12,0)
 Q:HBHCAPDT>HBHCLSDT  ; Visit appointment date > HBHCLSDT (last date to include in transmit set up in ^HBHCFILE)
"RTN","HBHCXMV",13,0)
 I HBHCAPDT<2961001 D PCE^HBHCXMV1 Q
"RTN","HBHCXMV",14,0)
 I HBHCSSN'?9N D PSSN^HBHCXMV1 Q
"RTN","HBHCXMV",15,0)
 S HBHCPRV=+^HBHC(631.4,$P(HBHCINFO,U,4),0) S:$L(HBHCPRV)'=4 HBHCPRV=HBHCPRV_HBHCSP1
"RTN","HBHCXMV",16,0)
 S HBHCTIME=$P(HBHCAPDT,".",2) S:$L(HBHCTIME)<4 HBHCTIME=HBHCTIME_$E(HBHCZRO4,1,(4-($L(HBHCTIME)))) S:$L(HBHCTIME)>4 HBHCTIME=$E(HBHCTIME,1,4)
"RTN","HBHCXMV",17,0)
 S HBHCDATE=$E(HBHCAPDT,4,5)_$E(HBHCAPDT,6,7)_(1700+$E(HBHCAPDT,1,3))_HBHCTIME
"RTN","HBHCXMV",18,0)
 S HBHCLNME=$P($P(^DPT($P(HBHCINFO,U),0),U),",") S:$L(HBHCLNME)'=11 HBHCLNME=$S($L(HBHCLNME)<11:HBHCLNME_$E(HBHCSP10,1,11-$L(HBHCLNME)),1:$E(HBHCLNME,1,11))
"RTN","HBHCXMV",19,0)
 S HBHCQAI=$S(($L($P(HBHCINFO,U,16))=1)&($E(HBHCINFO,U,16)=""):HBHCSP1_$P(HBHCINFO,U,16),($L($P(HBHCINFO,U,16))=1)&($E(HBHCINFO,U,16)]""):$P(HBHCINFO,U,16)_HBHCSP1,$L($P(HBHCINFO,U,16))=2:$P(HBHCINFO,U,16),1:HBHCSP2)
"RTN","HBHCXMV",20,0)
 ; Dx
"RTN","HBHCXMV",21,0)
 S HBHCDX1=$S($P(HBHCINFO,U,17)]"":$P($P($G(^ICD9($P(HBHCINFO,U,17),0)),U),".")_$P($P($G(^ICD9($P(HBHCINFO,U,17),0)),U),".",2),1:HBHCSP6) S:$L(HBHCDX1)'=6 HBHCDX1=HBHCDX1_$E(HBHCSP6,1,6-$L(HBHCDX1))
"RTN","HBHCXMV",22,0)
 S HBHCDX2=$S($P(HBHCINFO,U,18)]"":$P($P($G(^ICD9($P(HBHCINFO,U,18),0)),U),".")_$P($P($G(^ICD9($P(HBHCINFO,U,18),0)),U),".",2),1:HBHCSP6) S:$L(HBHCDX2)'=6 HBHCDX2=HBHCDX2_$E(HBHCSP6,1,6-$L(HBHCDX2))
"RTN","HBHCXMV",23,0)
 S HBHCDX3=$S($P(HBHCINFO,U,19)]"":$P($P($G(^ICD9($P(HBHCINFO,U,19),0)),U),".")_$P($P($G(^ICD9($P(HBHCINFO,U,19),0)),U),".",2),1:HBHCSP6) S:$L(HBHCDX3)'=6 HBHCDX3=HBHCDX3_$E(HBHCSP6,1,6-$L(HBHCDX3))
"RTN","HBHCXMV",24,0)
 S HBHCDX4=$S($P(HBHCINFO,U,20)]"":$P($P($G(^ICD9($P(HBHCINFO,U,20),0)),U),".")_$P($P($G(^ICD9($P(HBHCINFO,U,20),0)),U),".",2),1:HBHCSP6) S:$L(HBHCDX4)'=6 HBHCDX4=HBHCDX4_$E(HBHCSP6,1,6-$L(HBHCDX4))
"RTN","HBHCXMV",25,0)
 S HBHCDX5=$S($P(HBHCINFO,U,21)]"":$P($P($G(^ICD9($P(HBHCINFO,U,21),0)),U),".")_$P($P($G(^ICD9($P(HBHCINFO,U,21),0)),U),".",2),1:HBHCSP6) S:$L(HBHCDX5)'=6 HBHCDX5=HBHCDX5_$E(HBHCSP6,1,6-$L(HBHCDX5))
"RTN","HBHCXMV",26,0)
 ; CPT Codes
"RTN","HBHCXMV",27,0)
 S (HBHCCNT,HBHCI)=0 F  S HBHCI=$O(^HBHC(632,HBHCDFN,2,HBHCI)) Q:HBHCI'>0  D:HBHCCNT=0 INIT S HBHCNOD2=^HBHC(632,HBHCDFN,2,HBHCI,0),HBHCCNT=HBHCCNT+1 D SET D:HBHCCNT=10 WRITE
"RTN","HBHCXMV",28,0)
 D:'HBHCFLAG WRITE
"RTN","HBHCXMV",29,0)
 Q
"RTN","HBHCXMV",30,0)
INIT ; Initialize variables
"RTN","HBHCXMV",31,0)
 S HBHCFLAG=0,HBHCCP10=HBHCSP5
"RTN","HBHCXMV",32,0)
 F HBHCJ=1:1:9 S @("HBHCCPT"_HBHCJ)=HBHCSP5
"RTN","HBHCXMV",33,0)
 Q
"RTN","HBHCXMV",34,0)
SET ; Set CPT variables
"RTN","HBHCXMV",35,0)
 S:HBHCCNT<10 @("HBHCCPT"_HBHCCNT)=$S($P(HBHCNOD2,U)]"":$E($P($G(^ICPT($P(HBHCNOD2,U),0)),U),1,5),1:HBHCSP5) S:$L(@("HBHCCPT"_HBHCCNT))'=5 @("HBHCCPT"_HBHCCNT)=@("HBHCCPT"_HBHCCNT)_$E(HBHCSP5,1,5-$L(@("HBHCCPT"_HBHCCNT)))
"RTN","HBHCXMV",36,0)
 S:HBHCCNT=10 HBHCCP10=$S($P(HBHCNOD2,U)]"":$E($P($G(^ICPT($P(HBHCNOD2,U),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCP10)'=5 HBHCCP10=HBHCCP10_$E(HBHCSP5,1,5-$L(HBHCCP10))
"RTN","HBHCXMV",37,0)
 Q
"RTN","HBHCXMV",38,0)
WRITE ; Write transmit record, separate records containing max 10 CPTs each are generated for same visit if > 10 CPTs exist
"RTN","HBHCXMV",39,0)
 L +^HBHC(634,0) S HBHCNDX1=$P(^HBHC(634,0),U,3)+1 F  Q:'$D(^HBHC(634,HBHCNDX1))  S HBHCNDX1=HBHCNDX1+1
"RTN","HBHCXMV",40,0)
 S $P(^HBHC(634,0),U,3)=HBHCNDX1,$P(^HBHC(634,0),U,4)=$P(^HBHC(634,0),U,4)+1 L -^HBHC(634,0)
"RTN","HBHCXMV",41,0)
 S HBHCREC=HBHCFORM_HBHCHOSP_HBHCSSN_HBHCDATE_HBHCPRV_HBHCLNME_HBHCQAI_HBHCDX1_HBHCDX2_HBHCDX3_HBHCDX4_HBHCDX5_HBHCCPT1_HBHCCPT2_HBHCCPT3_HBHCCPT4_HBHCCPT5_HBHCCPT6_HBHCCPT7_HBHCCPT8_HBHCCPT9_HBHCCP10_HBHCSP4
"RTN","HBHCXMV",42,0)
 S ^HBHC(634,HBHCNDX1,0)=HBHCREC,^HBHC(634,"B",$E(HBHCREC,1,30),HBHCNDX1)=""
"RTN","HBHCXMV",43,0)
 ; Flag record as filed
"RTN","HBHCXMV",44,0)
 L +^HBHC(632,HBHCDFN,0) K:HBHCXMT4]"" ^HBHC(632,"AC",HBHCXMT4,HBHCDFN) S $P(^HBHC(632,HBHCDFN,0),U,8)="F",^HBHC(632,"AC","F",HBHCDFN)="",$P(^HBHC(632,HBHCDFN,0),U,9)=HBHCTDY L -^HBHC(632,HBHCDFN,0)
"RTN","HBHCXMV",45,0)
 ; Initialize QAI & DX fields to spaces after 1st record written to avoid multiple count(s) of same data when > 10 CPTs exist
"RTN","HBHCXMV",46,0)
 S HBHCQAI=HBHCSP2
"RTN","HBHCXMV",47,0)
 F HBHCK=1:1:5 S @("HBHCDX"_HBHCK)=HBHCSP6
"RTN","HBHCXMV",48,0)
 ; Reset CNT & set FLAG
"RTN","HBHCXMV",49,0)
 S HBHCCNT=0,HBHCFLAG=1
"RTN","HBHCXMV",50,0)
 Q
"RTN","HBHCXMV1")
0^7^B5422834
"RTN","HBHCXMV1",1,0)
HBHCXMV1 ; LR VAMC(IRMS)/MJT-HBHC, called by ^HBHCXMV, entry points:  START, PCE, PSSN, & EXIT ;9908
"RTN","HBHCXMV1",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,15**;NOV 01, 1993
"RTN","HBHCXMV1",3,0)
START ; Initialization
"RTN","HBHCXMV1",4,0)
 W !,"Processing Visit/Form 4 Data"
"RTN","HBHCXMV1",5,0)
 K ^HBHC(634.5) S ^HBHC(634.5,0)="HBHC PSEUDO SSN ERROR(S)^634.5P^"
"RTN","HBHCXMV1",6,0)
 S HBHCFORM=4,$P(HBHCSP1," ",2)="",$P(HBHCSP2," ",3)="",$P(HBHCSP4," ",5)="",$P(HBHCSP5," ",6)="",$P(HBHCSP6," ",7)="",$P(HBHCSP10," ",11)="",$P(HBHCZRO4,"0",5)=""
"RTN","HBHCXMV1",7,0)
 S HBHCHOSP=$P($G(^DIC(4,$P(^HBHC(631.9,1,0),U,5),99)),U) S:$L(HBHCHOSP)'=7 HBHCHOSP=HBHCHOSP_$E(HBHCSP4,1,(7-($L(HBHCHOSP))))
"RTN","HBHCXMV1",8,0)
 K %DT S X="T" D ^%DT S HBHCTDY=Y
"RTN","HBHCXMV1",9,0)
 Q
"RTN","HBHCXMV1",10,0)
PCE ; Appointment pre-dates Patient Care Encounter (PCE)
"RTN","HBHCXMV1",11,0)
 S DIE="^HBHC(632,",DA=HBHCDFN,DR="7///O" D ^DIE
"RTN","HBHCXMV1",12,0)
 Q
"RTN","HBHCXMV1",13,0)
PSSN ; Patient has pseudo SSN
"RTN","HBHCXMV1",14,0)
 K DD,DO S DIC="^HBHC(634.5,",DIC(0)="MN",(X,DINUM)=$P(HBHCINFO,U) D FILE^DICN
"RTN","HBHCXMV1",15,0)
 Q
"RTN","HBHCXMV1",16,0)
EXIT ; Exit module
"RTN","HBHCXMV1",17,0)
 K DA,DIC,DIE,DINUM,DR,DTOUT,HBHCAPDT,HBHCCNT,HBHCCPT1,HBHCCPT2,HBHCCPT3,HBHCCPT4,HBHCCPT5,HBHCCPT6,HBHCCPT7,HBHCCPT8,HBHCCPT9,HBHCCP10,HBHCDATE,HBHCDFN,HBHCDX1,HBHCDX2,HBHCDX3,HBHCDX4,HBHCDX5,HBHCFLAG,HBHCFORM,HBHCHOSP,HBHCI
"RTN","HBHCXMV1",18,0)
 K HBHCINFO,HBHCJ,HBHCK,HBHCLNME,HBHCNDX1,HBHCNDX2,HBHCNOD2,HBHCPRV,HBHCREC,HBHCQAI,HBHCSP1,HBHCSP10,HBHCSP2,HBHCSP4,HBHCSP5,HBHCSP6,HBHCSSN,HBHCSTDT,HBHCTDY,HBHCTIME,HBHCXMT4,HBHCZRO4,X,Y,%DT
"RTN","HBHCXMV1",19,0)
 Q
"VER")
8.0^22.0
"^DD",632,632,0)
FIELD^^32^23
"^DD",632,632,0,"DDA")
N
"^DD",632,632,0,"DT")
2991005
"^DD",632,632,0,"ID",1)
W "   ",$E($P(^(0),U,2),4,5)_"-"_$E($P(^(0),U,2),6,7)_"-"_$E($P(^(0),U,2),2,3)
"^DD",632,632,0,"ID",2)
S %I=Y,Y=$S('$D(^(0)):"",$D(^SC(+$P(^(0),U,3),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(44,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",632,632,0,"IX","AC",632,7)

"^DD",632,632,0,"IX","AD",632,10)

"^DD",632,632,0,"IX","B",632,.01)

"^DD",632,632,0,"IX","C",632,1)

"^DD",632,632,0,"NM","HBHC VISIT")

"^DD",632,632,0,"PT",634.2,1)

"^DD",632,632,0,"VRPK")
HBH
"^DD",632,632,.01,0)
PATIENT NAME^RP2'^DPT(^0;1^Q
"^DD",632,632,.01,1,0)
^.1
"^DD",632,632,.01,1,1,0)
632^B
"^DD",632,632,.01,1,1,1)
S ^HBHC(632,"B",$E(X,1,30),DA)=""
"^DD",632,632,.01,1,1,2)
K ^HBHC(632,"B",$E(X,1,30),DA)
"^DD",632,632,.01,1,1,"%D",0)
^^2^2^2921229^^
"^DD",632,632,.01,1,1,"%D",1,0)
This cross-reference represents regular 'B' file index of HBHC Visit (632)
"^DD",632,632,.01,1,1,"%D",2,0)
file, Patient Name (.01) field, which references Patient (2) file entries.
"^DD",632,632,.01,3)
Answer using last name, first name, middle name format, or enter first letter of last name and last four digits of social security number  (e.g. A1234).
"^DD",632,632,.01,21,0)
^^2^2^2921215^^^
"^DD",632,632,.01,21,1,0)
This field represents patient's name in Patient (2) file.  Patient must
"^DD",632,632,.01,21,2,0)
exist in DPT for HBHC selection, since LAYGO is not allowed.
"^DD",632,632,.01,"DT")
2921216
"^DD",632,632,1,0)
DATE^D^^0;2^S %DT="ETX" D ^%DT S X=Y K:2770101>X X
"^DD",632,632,1,1,0)
^.1
"^DD",632,632,1,1,1,0)
632^C
"^DD",632,632,1,1,1,1)
S ^HBHC(632,"C",$E(X,1,30),DA)=""
"^DD",632,632,1,1,1,2)
K ^HBHC(632,"C",$E(X,1,30),DA)
"^DD",632,632,1,1,1,"%D",0)
^^2^2^2921230^^^
"^DD",632,632,1,1,1,"%D",1,0)
This cross-reference represents regular 'C' file index of HBHC Visit (632)
"^DD",632,632,1,1,1,"%D",2,0)
file, Date (1) field.  Date field updated by package only, no user input.
"^DD",632,632,1,1,1,"DT")
2920413
"^DD",632,632,1,3)
Answer is date of HBHC visit.  Answer must be 1/1/1977 or later.  Field updated by package only, no user input.
"^DD",632,632,1,21,0)
^^3^3^2921218^^^
"^DD",632,632,1,21,1,0)
This field represents date of HBHC visit.  Date range allowed is
"^DD",632,632,1,21,2,0)
1/1/1977 or later.  Field updated by package only,
"^DD",632,632,1,21,3,0)
no user input.
"^DD",632,632,1,"DT")
2921218
"^DD",632,632,2,0)
CLINIC NUMBER^P44'^SC(^0;3^Q
"^DD",632,632,2,3)
Answer is clinic that exists in Hospital Location file.  Field updated only by package, no user input.
"^DD",632,632,2,21,0)
^^3^3^2921211^^
"^DD",632,632,2,21,1,0)
This field represents HBHC Clinic number in Hospital Location (44) file.
"^DD",632,632,2,21,2,0)
Clinic must exist in Hospital Location file, since LAYGO is not allowed.
"^DD",632,632,2,21,3,0)
Field updated by package only, no user input.
"^DD",632,632,2,"DT")
2910820
"^DD",632,632,3,0)
PROVIDER^P631.4'^HBHC(631.4,^0;4^Q
"^DD",632,632,3,3)
Answer with provider name or provider number that exists in HBHC Provider file.
"^DD",632,632,3,21,0)
^^3^3^2921203^^
"^DD",632,632,3,21,1,0)
This field represents HBHC provider number, referencing HBHC Provider
"^DD",632,632,3,21,2,0)
(631.4) file entries.  Provider must exist in HBHC Provider file, since
"^DD",632,632,3,21,3,0)
LAYGO is not allowed.
"^DD",632,632,3,"DT")
2910820
"^DD",632,632,4,0)
TYPE OF VISIT^P631.5'^HBHC(631.5,^0;5^Q
"^DD",632,632,4,3)
Answer with 1 digit numeric code representing type of visit.
"^DD",632,632,4,21,0)
^^2^2^2921211^
"^DD",632,632,4,21,1,0)
This field represents 1 digit numeric code for HBHC Type of Visit,
"^DD",632,632,4,21,2,0)
referencing HBHC Type of Visit (631.5) file entries.
"^DD",632,632,4,"DT")
2920427
"^DD",632,632,5,0)
COMMENTS^F^^0;6^K:$L(X)>30!($L(X)<1) X
"^DD",632,632,5,3)
Answer must be 1-30 characters in length.
"^DD",632,632,5,21,0)
^^2^2^2921216^^^
"^DD",632,632,5,21,1,0)
This field represents comments pertaining to this visit.  Field allows
"^DD",632,632,5,21,2,0)
1-30 characters of free text. 
"^DD",632,632,5,"DT")
2910820
"^DD",632,632,6,0)
CANCELLED APPOINTMENT^F^^0;7^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",632,632,6,1,0)
^.1^^0
"^DD",632,632,6,3)
Field updated only by package, no user input.  Answer must be 1-30 characters in length.
"^DD",632,632,6,21,0)
^^2^2^2921215^^
"^DD",632,632,6,21,1,0)
This field represents cancelled appointment codes.  Field updated by
"^DD",632,632,6,21,2,0)
package only, no user input.
"^DD",632,632,6,"DT")
2950109
"^DD",632,632,7,0)
FORM 4 TRANSMIT STATUS^S^C:Record Contains Cancelled Appointment;F:Record in Transmit File;N:Record Needs Transmitting;P:Record Prior to Package Startup Date;T:Record Transmitted;O:Record Omitted, Pre-dates 10/1/96 PCE Usage;^0;8^Q
"^DD",632,632,7,1,0)
^.1
"^DD",632,632,7,1,1,0)
632^AC
"^DD",632,632,7,1,1,1)
S ^HBHC(632,"AC",$E(X,1,30),DA)=""
"^DD",632,632,7,1,1,2)
K ^HBHC(632,"AC",$E(X,1,30),DA)
"^DD",632,632,7,1,1,"%D",0)
^^3^3^2921230^^^
"^DD",632,632,7,1,1,"%D",1,0)
This cross-reference represents regular 'AC' file index of HBHC Visit (632)
"^DD",632,632,7,1,1,"%D",2,0)
file, Form 4 (Visit) Transmit Status (7) field.  Form 4 Transmit Status
"^DD",632,632,7,1,1,"%D",3,0)
field updated by package only, no user input.
"^DD",632,632,7,1,1,"DT")
2920427
"^DD",632,632,7,3)
Field updated only by package, no user input.
"^DD",632,632,7,21,0)
^^5^5^2970313^^^^
"^DD",632,632,7,21,1,0)
This field represents Form 4 (Visit) Transmit Status.  Field will contain
"^DD",632,632,7,21,2,0)
either 'C' (Record Contains Cancelled Appointment), 'F' (Record in Transmit
"^DD",632,632,7,21,3,0)
File), 'N' (Record Needs Transmitting), 'O' (Record Omitted, Pre-dates 10/1/96
"^DD",632,632,7,21,4,0)
PCE Usage), 'P' (Record Prior to Package Startup Date),  or 'T' (Record
"^DD",632,632,7,21,5,0)
Transmitted).  Field updated by package only, no user input.
"^DD",632,632,7,"DT")
2970313
"^DD",632,632,8,0)
FORM 4 FILED IN HBHC(634) DATE^D^^0;9^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",632,632,8,3)
Date Form 4 filed in Transmit file.  Field updated only by package, no user input.
"^DD",632,632,8,21,0)
^^2^2^2921216^^
"^DD",632,632,8,21,1,0)
This field represents date Form 4 (Visit) record filed in Transmit
"^DD",632,632,8,21,2,0)
(634) file.  Field updated by package only, no user input.
"^DD",632,632,8,"DT")
2920429
"^DD",632,632,9,0)
FORM 4 BATCH INITIAL MM MSG #^F^^0;10^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>15!($L(X)<3) X
"^DD",632,632,9,1,0)
^.1^^0
"^DD",632,632,9,3)
Field updated only by package, no user input.  Number represents first MM msg # in transmission batch.  Record may be transmitted in different msg, if multiple msgs transmitted.
"^DD",632,632,9,21,0)
^^4^4^2921215^
"^DD",632,632,9,21,1,0)
This field represents MailMan message number of 'First' MailMan message
"^DD",632,632,9,21,2,0)
in Austin transmission batch.  Record 'may' be transmitted in different
"^DD",632,632,9,21,3,0)
message, if multiple messages are transmitted in one transmission batch.
"^DD",632,632,9,21,4,0)
Field updated by package only, no user input.
"^DD",632,632,9,"DT")
2920626
"^DD",632,632,10,0)
FORM 4 MAIL MESSAGE DATE^D^^0;11^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",632,632,10,1,0)
^.1
"^DD",632,632,10,1,1,0)
632^AD
"^DD",632,632,10,1,1,1)
S ^HBHC(632,"AD",$E(X,1,30),DA)=""
"^DD",632,632,10,1,1,2)
K ^HBHC(632,"AD",$E(X,1,30),DA)
"^DD",632,632,10,1,1,"%D",0)
^^3^3^2921230^^^
"^DD",632,632,10,1,1,"%D",1,0)
This cross-reference represents regular 'AD' file index of HBHC Visit (632)
"^DD",632,632,10,1,1,"%D",2,0)
file, Form 4 (Visit) Mail Message Date (10) field.  Form 4 Mail Message Date
"^DD",632,632,10,1,1,"%D",3,0)
field updated by package only, no user input.
"^DD",632,632,10,1,1,"DT")
2920504
"^DD",632,632,10,3)
Field updated only by package, no user input.
"^DD",632,632,10,21,0)
^^2^2^2921215^
"^DD",632,632,10,21,1,0)
This field represents date of Form 4 (Visit) record transmission via
"^DD",632,632,10,21,2,0)
MailMan to Austin.  Field updated by package only, no user input.
"^DD",632,632,10,"DT")
2920504
"^DD",632,632,11,0)
FORM 4 TRANSMIT FLAG EDIT DATE^D^^0;12^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",632,632,11,3)
Field updated only by package, no user input.  Field is updated with current date when user requests Form 4 Transmit Status flag be reset (allowing editing of transmitted record).
"^DD",632,632,11,21,0)
^^3^3^2921216^^
"^DD",632,632,11,21,1,0)
This field represents date Form 4 (Visit) Transmit Status flag was
"^DD",632,632,11,21,2,0)
requested by user to be reset (allowing editing of previously transmitted
"^DD",632,632,11,21,3,0)
record).  Field updated by package only, no user input.
"^DD",632,632,11,"DT")
2920429
"^DD",632,632,12,0)
FORM 4 TRANSMIT FLAG EDIT DUZ^P200'^VA(200,^0;13^Q
"^DD",632,632,12,3)
Field updated only by package, no user input.  Field is updated with user's DUZ when user requests Form 4 Transmit Status flag be reset (allowing editing of transmitted record).
"^DD",632,632,12,21,0)
^^3^3^2921215^
"^DD",632,632,12,21,1,0)
This field represents DUZ of user requesting Form 4 (Visit) Transmit
"^DD",632,632,12,21,2,0)
Status flag be reset (allowing editing of previously transmitted
"^DD",632,632,12,21,3,0)
record).  Field updated by package only, no user input.
"^DD",632,632,12,"DT")
2920429
"^DD",632,632,13,0)
FORM 4 RE-TRANS BATCH MM MSG #^F^^0;14^K:$L(X)>15!($L(X)<3) X
"^DD",632,632,13,3)
Field updated only by package, no user input.  Number represents first MM msg # in re-transmission batch.  Record may be transmitted in different msg, if multiple msgs transmitted.
"^DD",632,632,13,21,0)
^^4^4^2921215^
"^DD",632,632,13,21,1,0)
This field represents MailMan message number of 'First' MailMan message
"^DD",632,632,13,21,2,0)
in re-transmission batch to Austin.  Record 'may' be transmitted in
"^DD",632,632,13,21,3,0)
different message, if multiple messages are transmitted in one
"^DD",632,632,13,21,4,0)
re-transmission batch.  Field updated by package only, no user input.
"^DD",632,632,13,"DT")
2920626
"^DD",632,632,14,0)
FORM 4 RE-TRANSMIT DATE^D^^0;15^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",632,632,14,3)
Field updated only by package, no user input.
"^DD",632,632,14,21,0)
^^2^2^2921215^
"^DD",632,632,14,21,1,0)
This field represents date of Form 4 (Visit) record re-transmission via
"^DD",632,632,14,21,2,0)
MailMan to Austin.  Field updated by package only, no user input.
"^DD",632,632,14,"DT")
2920504
"^DD",632,632,15,0)
QA INDICATOR^F^^0;16^K:$L(X)>2!($L(X)<1) X
"^DD",632,632,15,3)
Answer must be 1-2 characters in length.  Refer to directions from Office of Geriatrics & Extended Care for current QA Indicator data value instructions.
"^DD",632,632,15,21,0)
^^4^4^2930702^^
"^DD",632,632,15,21,1,0)
This field represents a generic QA Indicator.  The Office of Geriatrics &
"^DD",632,632,15,21,2,0)
Extended Care supplies HBHC programs with current QA Indicator information.
"^DD",632,632,15,21,3,0)
The QA Indicator & corresponding data value for the field will change
"^DD",632,632,15,21,4,0)
periodically at the discretion of the Geriatrics & Extended Care office.
"^DD",632,632,15,"DT")
2930702
"^DD",632,632,16,0)
DIAGNOSIS 1^RP80'O^ICD9(^0;17^Q
"^DD",632,632,16,2)
S Y(0)=Y Q:Y=""  S Z0=$S($D(^HBHC(632,D0,0)):$P(^(0),U,17),1:"") Q:'Z0  S Y=$S($D(^ICD9(Z0,0)):$P(^ICD9(Z0,0),U)_"  "_$P(^ICD9(Z0,0),U,3),1:"")
"^DD",632,632,16,2.1)
Q:Y=""  S Z0=$S($D(^HBHC(632,D0,0)):$P(^(0),U,17),1:"") Q:'Z0  S Y=$S($D(^ICD9(Z0,0)):$P(^ICD9(Z0,0),U)_"  "_$P(^ICD9(Z0,0),U,3),1:"")
"^DD",632,632,16,3)
Field updated by package only, no user input.
"^DD",632,632,16,21,0)
^^2^2^2970214^^^
"^DD",632,632,16,21,1,0)
This field represents primary diagnosis (ICD9 code) for this visit.  Field
"^DD",632,632,16,21,2,0)
updated by package only, no user input. 
"^DD",632,632,16,"DT")
2970307
"^DD",632,632,17,0)
DIAGNOSIS 2^P80'O^ICD9(^0;18^Q
"^DD",632,632,17,2)
S Y(0)=Y Q:Y=""  S Z0=$S($D(^HBHC(632,D0,0)):$P(^(0),U,18),1:"") Q:'Z0  S Y=$S($D(^ICD9(Z0,0)):$P(^ICD9(Z0,0),U)_"  "_$P(^ICD9(Z0,0),U,3),1:"")
"^DD",632,632,17,2.1)
Q:Y=""  S Z0=$S($D(^HBHC(632,D0,0)):$P(^(0),U,18),1:"") Q:'Z0  S Y=$S($D(^ICD9(Z0,0)):$P(^ICD9(Z0,0),U)_"  "_$P(^ICD9(Z0,0),U,3),1:"")
"^DD",632,632,17,3)
Field updated by package only, no user input.
"^DD",632,632,17,21,0)
^^2^2^2970214^^^
"^DD",632,632,17,21,1,0)
This field represents diagnosis number two (ICD9 code) for this visit.  Field
"^DD",632,632,17,21,2,0)
updated by package only, no user input. 
"^DD",632,632,17,"DT")
2970307
"^DD",632,632,18,0)
DIAGNOSIS 3^P80'O^ICD9(^0;19^Q
"^DD",632,632,18,2)
S Y(0)=Y Q:Y=""  S Z0=$S($D(^HBHC(632,D0,0)):$P(^(0),U,19),1:"") Q:'Z0  S Y=$S($D(^ICD9(Z0,0)):$P(^ICD9(Z0,0),U)_"  "_$P(^ICD9(Z0,0),U,3),1:"")
"^DD",632,632,18,2.1)
Q:Y=""  S Z0=$S($D(^HBHC(632,D0,0)):$P(^(0),U,19),1:"") Q:'Z0  S Y=$S($D(^ICD9(Z0,0)):$P(^ICD9(Z0,0),U)_"  "_$P(^ICD9(Z0,0),U,3),1:"")
"^DD",632,632,18,3)
Field updated by package only, no user input.
"^DD",632,632,18,21,0)
^^2^2^2970214^^^^
"^DD",632,632,18,21,1,0)
This field represents diagnosis number three (ICD9 code) for this visit.  Field
"^DD",632,632,18,21,2,0)
updated by package only, no user input. 
"^DD",632,632,18,"DT")
2970307
"^DD",632,632,19,0)
DIAGNOSIS 4^P80'O^ICD9(^0;20^Q
"^DD",632,632,19,2)
S Y(0)=Y Q:Y=""  S Z0=$S($D(^HBHC(632,D0,0)):$P(^(0),U,20),1:"") Q:'Z0  S Y=$S($D(^ICD9(Z0,0)):$P(^ICD9(Z0,0),U)_"  "_$P(^ICD9(Z0,0),U,3),1:"")
"^DD",632,632,19,2.1)
Q:Y=""  S Z0=$S($D(^HBHC(632,D0,0)):$P(^(0),U,20),1:"") Q:'Z0  S Y=$S($D(^ICD9(Z0,0)):$P(^ICD9(Z0,0),U)_"  "_$P(^ICD9(Z0,0),U,3),1:"")
"^DD",632,632,19,3)
Field updated by package only, no user input.
"^DD",632,632,19,21,0)
^^2^2^2970214^^^^
"^DD",632,632,19,21,1,0)
This field represents diagnosis number four (ICD9 code) for this visit.  Field
"^DD",632,632,19,21,2,0)
updated by package only, no user input.
"^DD",632,632,19,"DT")
2970307
"^DD",632,632,20,0)
DIAGNOSIS 5^P80'O^ICD9(^0;21^Q
"^DD",632,632,20,2)
S Y(0)=Y Q:Y=""  S Z0=$S($D(^HBHC(632,D0,0)):$P(^(0),U,21),1:"") Q:'Z0  S Y=$S($D(^ICD9(Z0,0)):$P(^ICD9(Z0,0),U)_"  "_$P(^ICD9(Z0,0),U,3),1:"")
"^DD",632,632,20,2.1)
Q:Y=""  S Z0=$S($D(^HBHC(632,D0,0)):$P(^(0),U,21),1:"") Q:'Z0  S Y=$S($D(^ICD9(Z0,0)):$P(^ICD9(Z0,0),U)_"  "_$P(^ICD9(Z0,0),U,3),1:"")
"^DD",632,632,20,3)
Field updated by package only, no user input.
"^DD",632,632,20,21,0)
^^2^2^2970214^
"^DD",632,632,20,21,1,0)
This field represents diagnosis number five (ICD9 code) for this visit.  Field
"^DD",632,632,20,21,2,0)
updated by package only, no user input.
"^DD",632,632,20,"DT")
2970307
"^DD",632,632,31,0)
OUTPATIENT ENCOUNTER^P409.68'^SCE(^0;22^Q
"^DD",632,632,31,3)
Field updated by package only, no user input.
"^DD",632,632,31,21,0)
^^2^2^2970702^^^^
"^DD",632,632,31,21,1,0)
This field represents outpatient encounter record in ^SCE (#409.68) file. 
"^DD",632,632,31,21,2,0)
Field updated by package only, no user input. 
"^DD",632,632,31,"DT")
2970310
"^DD",632,632,32,0)
CPT^632.032PA^^2;0
"^DD",632,632.032,0)
CPT SUB-FIELD^^1^2
"^DD",632,632.032,0,"DT")
2991005
"^DD",632,632.032,0,"IX","B",632.032,.01)

"^DD",632,632.032,0,"NM","CPT")

"^DD",632,632.032,0,"UP")
632
"^DD",632,632.032,.01,0)
CPT^RP81'^ICPT(^0;1^Q
"^DD",632,632.032,.01,1,0)
^.1
"^DD",632,632.032,.01,1,1,0)
632.032^B
"^DD",632,632.032,.01,1,1,1)
S ^HBHC(632,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",632,632.032,.01,1,1,2)
K ^HBHC(632,DA(1),2,"B",$E(X,1,30),DA)
"^DD",632,632.032,.01,3)
Field updated by package only, no user input.
"^DD",632,632.032,.01,21,0)
^^2^2^2990812^^^^
"^DD",632,632.032,.01,21,1,0)
This field represents the CPT code(s) performed during the encounter. 
"^DD",632,632.032,.01,21,2,0)
Field updated by package only, no user input. 
"^DD",632,632.032,.01,"DT")
2990804
"^DD",632,632.032,1,0)
CPT MODIFIER^632.321PA^^1;0
"^DD",632,632.032,1,12)
Screen prevents selection of modifier inappropriate for CPT Code.
"^DD",632,632.032,1,12.1)
S DIC("S")="I $$OTH^SROMOD"
"^DD",632,632.321,0)
CPT MODIFIER SUB-FIELD^^.01^1
"^DD",632,632.321,0,"DT")
2991005
"^DD",632,632.321,0,"IX","B",632.321,.01)

"^DD",632,632.321,0,"NM","CPT MODIFIER")

"^DD",632,632.321,0,"UP")
632.032
"^DD",632,632.321,.01,0)
CPT MODIFIER^P81.3'^DIC(81.3,^0;1^Q
"^DD",632,632.321,.01,1,0)
^.1
"^DD",632,632.321,.01,1,1,0)
632.321^B
"^DD",632,632.321,.01,1,1,1)
S ^HBHC(632,DA(2),2,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",632,632.321,.01,1,1,2)
K ^HBHC(632,DA(2),2,DA(1),1,"B",$E(X,1,30),DA)
"^DD",632,632.321,.01,3)
Field updated by package only, no user input.
"^DD",632,632.321,.01,21,0)
^^2^2^2991005^^
"^DD",632,632.321,.01,21,1,0)
This field contains CPT Modifier(s) related to the CPT Code(s) for the 
"^DD",632,632.321,.01,21,2,0)
visit.  Field updated by package only, no user input.
"^DD",632,632.321,.01,"DT")
2991005
"^DIC",632,632,0)
HBHC VISIT
"^DIC",632,632,0,"GL")
^HBHC(632,
"^DIC",632,632,"%D",0)
^^2^2^2931015^^^^
"^DIC",632,632,"%D",1,0)
This file is the HBHC Visit file and includes visit and record transmission
"^DIC",632,632,"%D",2,0)
data.
"^DIC",632,"B","HBHC VISIT",632)

**END**
**END**
