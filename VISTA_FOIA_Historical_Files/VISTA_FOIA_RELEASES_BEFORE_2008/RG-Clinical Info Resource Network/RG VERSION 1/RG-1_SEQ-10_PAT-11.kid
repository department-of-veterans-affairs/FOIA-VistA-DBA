EMERGENCY Released RG*1*11 SEQ #10
Extracted from mail message
**KIDS**:RG*1.0*11^

**INSTALL NAME**
RG*1.0*11
"BLD",1085,0)
RG*1.0*11^CLINICAL INFO RESOURCE NETWORK^0^3001116^y
"BLD",1085,1,0)
^9.61A^3^3^3001108^^
"BLD",1085,1,1,0)
MPI/PD EXCEPTION MESSAGE SCREENING
"BLD",1085,1,2,0)
Refer to patch RG*1*11 in the FORUM Patch Module for a complete
"BLD",1085,1,3,0)
description.
"BLD",1085,4,0)
^9.64PA^^
"BLD",1085,"ABNS",0)
^9.66A^^
"BLD",1085,"ABPKG")
^^
"BLD",1085,"KRN",0)
^9.67PA^19^17
"BLD",1085,"KRN",.4,0)
.4
"BLD",1085,"KRN",.401,0)
.401
"BLD",1085,"KRN",.402,0)
.402
"BLD",1085,"KRN",.403,0)
.403
"BLD",1085,"KRN",.5,0)
.5
"BLD",1085,"KRN",.84,0)
.84
"BLD",1085,"KRN",3.6,0)
3.6
"BLD",1085,"KRN",3.8,0)
3.8
"BLD",1085,"KRN",9.2,0)
9.2
"BLD",1085,"KRN",9.8,0)
9.8
"BLD",1085,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1085,"KRN",9.8,"NM",1,0)
RGHLLOG^^0^B19915096
"BLD",1085,"KRN",9.8,"NM","B","RGHLLOG",1)

"BLD",1085,"KRN",19,0)
19
"BLD",1085,"KRN",19.1,0)
19.1
"BLD",1085,"KRN",101,0)
101
"BLD",1085,"KRN",409.61,0)
409.61
"BLD",1085,"KRN",771,0)
771
"BLD",1085,"KRN",870,0)
870
"BLD",1085,"KRN",8994,0)
8994
"BLD",1085,"KRN","B",.4,.4)

"BLD",1085,"KRN","B",.401,.401)

"BLD",1085,"KRN","B",.402,.402)

"BLD",1085,"KRN","B",.403,.403)

"BLD",1085,"KRN","B",.5,.5)

"BLD",1085,"KRN","B",.84,.84)

"BLD",1085,"KRN","B",3.6,3.6)

"BLD",1085,"KRN","B",3.8,3.8)

"BLD",1085,"KRN","B",9.2,9.2)

"BLD",1085,"KRN","B",9.8,9.8)

"BLD",1085,"KRN","B",19,19)

"BLD",1085,"KRN","B",19.1,19.1)

"BLD",1085,"KRN","B",101,101)

"BLD",1085,"KRN","B",409.61,409.61)

"BLD",1085,"KRN","B",771,771)

"BLD",1085,"KRN","B",870,870)

"BLD",1085,"KRN","B",8994,8994)

"BLD",1085,"QUES",0)
^9.62^^
"BLD",1085,"REQB",0)
^9.611^1^1
"BLD",1085,"REQB",1,0)
RG*1.0*3^2
"BLD",1085,"REQB","B","RG*1.0*3",1)

"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
11^3001116
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3001116
"PKG",272,22,1,"PAH",1,1,1,0)
MPI/PD EXCEPTION MESSAGE SCREENING
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*11 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","RGHLLOG")
0^1^B19915096
"RTN","RGHLLOG",1,0)
RGHLLOG ;CAIRO/DKM-LOG MESSAGE PROCESSING INFO ;09/04/98
"RTN","RGHLLOG",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,11**;30 Apr 99
"RTN","RGHLLOG",3,0)
 ;=================================================================
"RTN","RGHLLOG",4,0)
 ; Log information about message processing and exceptions
"RTN","RGHLLOG",5,0)
 ; in CIRN HL7 Exception Log file.
"RTN","RGHLLOG",6,0)
 ;=================================================================
"RTN","RGHLLOG",7,0)
 ; Start time for run log
"RTN","RGHLLOG",8,0)
START(RGMSG,RGDC,RGPARAM) ;
"RTN","RGHLLOG",9,0)
 ;This entry point starts the log process in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",10,0)
 ;file (#991.1), if the (#6) MINIMAL EXCEPTION LOGGING? field in
"RTN","RGHLLOG",11,0)
 ;File #990.8 is set to 0.
"RTN","RGHLLOG",12,0)
 ; Input: Required
"RTN","RGHLLOG",13,0)
 ;   RGMSG - IEN of message entry in File #773, usually HLMTIEN
"RTN","RGHLLOG",14,0)
 ;        Optional
"RTN","RGHLLOG",15,0)
 ;   RGDC - Event Class, associated with an entry in File #
"RTN","RGHLLOG",16,0)
 ;   RGPARAM - reprocessing routine
"RTN","RGHLLOG",17,0)
 S U="^"
"RTN","RGHLLOG",18,0)
 K RGLOG
"RTN","RGHLLOG",19,0)
 S RGLOG(3)=$G(RGMSG),RGLOG(5)=$G(RGDC),RGLOG(4)=$G(RGPARAM),RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",20,0)
 I '$P(^RGSITE("COR",1,0),U,8) S RGLOG=$$CREATE
"RTN","RGHLLOG",21,0)
 Q
"RTN","RGHLLOG",22,0)
 ; Create a log entry
"RTN","RGHLLOG",23,0)
CREATE() Q:$G(RGLOG) RGLOG
"RTN","RGHLLOG",24,0)
 L +^RGHL7(991.1,0):10
"RTN","RGHLLOG",25,0)
 S RGLOG=$O(^RGHL7(991.1,$C(32)),-1)+1
"RTN","RGHLLOG",26,0)
 S:$G(RGLOG(1))="" RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",27,0)
 S RGLOG(3)=$S($G(RGLOG(3))=0:0,$G(HL("MID"))="":"",1:$$IEN773($G(HL("MID"))))
"RTN","RGHLLOG",28,0)
 S (DA,X)=RGLOG,DIC="^RGHL7(991.1,",DIC(0)="L",DLAYGO=991.1,DIC("DR")="1///"_$G(RGLOG(1))_";3////"_$G(RGLOG(3))_";5///"_$G(RGLOG(5))_";4////"_$G(RGLOG(4)) K DD,DO D FILE^DICN K DIC,DA,X,DLAYGO
"RTN","RGHLLOG",29,0)
 L -^RGHL7(991.1,0)
"RTN","RGHLLOG",30,0)
 Q RGLOG
"RTN","RGHLLOG",31,0)
 ; Log time run completed
"RTN","RGHLLOG",32,0)
STOP(RGQUIT) ;
"RTN","RGHLLOG",33,0)
 ;This entry point completes the logging process
"RTN","RGHLLOG",34,0)
 ; Input: required
"RTN","RGHLLOG",35,0)
 ;    RGQUIT - 0 for success and 1 for failure
"RTN","RGHLLOG",36,0)
 ;
"RTN","RGHLLOG",37,0)
 Q:'$G(RGLOG)
"RTN","RGHLLOG",38,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",39,0)
 S DIE="^RGHL7(991.1,",DR="1.5///NOW;1.6///^S X=$G(RGQUIT)",DA=RGLOG D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",40,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",41,0)
 K RGLOG,RGQUIT,X,Y,DIC,DIE
"RTN","RGHLLOG",42,0)
 Q
"RTN","RGHLLOG",43,0)
 ; Log unclassified exception (old entry point)
"RTN","RGHLLOG",44,0)
ERR(RGERR,RGSEV) ;
"RTN","RGHLLOG",45,0)
 D EXC(18,RGERR)
"RTN","RGHLLOG",46,0)
 S RGQUIT=$G(RGQUIT)!$G(RGSEV)
"RTN","RGHLLOG",47,0)
 Q
"RTN","RGHLLOG",48,0)
 ; Log an exception
"RTN","RGHLLOG",49,0)
EXC(RGEXC,RGERR,RGDFN) ;
"RTN","RGHLLOG",50,0)
 ;This entry point logs exceptions in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",51,0)
 ;file (#991.1)
"RTN","RGHLLOG",52,0)
 ; Input: Required
"RTN","RGHLLOG",53,0)
 ;   RGEXC - Exception type in File #991.11
"RTN","RGHLLOG",54,0)
 ;   RGERR - Supplemental text
"RTN","RGHLLOG",55,0)
 ;        Optional
"RTN","RGHLLOG",56,0)
 ;   RGDFN - IEN in the PATIENT file (#2)
"RTN","RGHLLOG",57,0)
 ;
"RTN","RGHLLOG",58,0)
 I $L($G(HL("MID"))) Q:$$INVEXC(HL("MID"))  ; is the exception valid?
"RTN","RGHLLOG",59,0)
 N RGI,RGZ
"RTN","RGHLLOG",60,0)
 S U="^"
"RTN","RGHLLOG",61,0)
 S:RGEXC[U RGERR=$P(RGEXC,U,2,999),RGEXC=+RGEXC
"RTN","RGHLLOG",62,0)
 S:RGEXC'=+RGEXC RGERR=RGEXC,RGEXC=18
"RTN","RGHLLOG",63,0)
 S:'$D(^RGHL7(991.11,RGEXC)) RGEXC=18
"RTN","RGHLLOG",64,0)
 L +^RGHL7(991.11,RGEXC):10
"RTN","RGHLLOG",65,0)
 S RGZ=$G(^RGHL7(991.11,RGEXC,0))
"RTN","RGHLLOG",66,0)
 S:$L(RGZ) $P(^RGHL7(991.11,RGEXC,0),U,5)=$P(RGZ,U,5)+1
"RTN","RGHLLOG",67,0)
 S:$P(RGZ,U,2)>1 RGQUIT=1
"RTN","RGHLLOG",68,0)
 L -^RGHL7(991.11,RGEXC)
"RTN","RGHLLOG",69,0)
 S RGLOG=$$CREATE
"RTN","RGHLLOG",70,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",71,0)
 S RGI=$O(^RGHL7(991.1,RGLOG,1,$C(32)),-1)+1
"RTN","RGHLLOG",72,0)
 S RGERR=$E($G(RGERR),1,250)
"RTN","RGHLLOG",73,0)
 S DIC="^RGHL7(991.1,"_RGLOG_",1,"
"RTN","RGHLLOG",74,0)
 S X=RGI,DA(1)=RGLOG,DIC(0)="FL",DLAYGO=991.12,DIC("P")=$P(^DD(991.1,2,0),"^",2)
"RTN","RGHLLOG",75,0)
 D ^DIC
"RTN","RGHLLOG",76,0)
 S DIE=DIC
"RTN","RGHLLOG",77,0)
 K DIC,DA,DR,DLAYGO
"RTN","RGHLLOG",78,0)
 S STAT=0
"RTN","RGHLLOG",79,0)
 S DIC="3.8",DIC(0)="Z",X="MPIF EXCEPTIONS" D ^DIC K DIC
"RTN","RGHLLOG",80,0)
 S RGMG=$P($G(Y),"^",1)
"RTN","RGHLLOG",81,0)
 I $P(^RGHL7(991.11,RGEXC,0),U,4)=RGMG S STAT=1
"RTN","RGHLLOG",82,0)
 S DA(1)=RGLOG,DA=RGI,DR="2///"_$G(RGEXC)_";3///"_$G(RGDFN)_";6///"_$G(STAT)_";10///"_$G(RGERR)
"RTN","RGHLLOG",83,0)
 D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",84,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",85,0)
 S RGI=$P(RGZ,U,3),RGZ=$P(RGZ,U,4)
"RTN","RGHLLOG",86,0)
 Q:'RGI!'RGZ
"RTN","RGHLLOG",87,0)
 ;quit and don't send messages for exception types that are now being
"RTN","RGHLLOG",88,0)
 ;handled through the CIRN Exception Handling option.
"RTN","RGHLLOG",89,0)
 Q:RGEXC=209!((RGEXC>212)&(RGEXC<219))
"RTN","RGHLLOG",90,0)
 S DIC="^XMB(3.8,",DIC(0)="NZ",X="`"_RGZ D ^DIC K DIC Q:+Y<1  S RGZ=$P(Y,U,2) K Y
"RTN","RGHLLOG",91,0)
 Q:RGZ=""!$P($G(^RGSITE("COR",1,0)),U,7)
"RTN","RGHLLOG",92,0)
 S RGERR=$$EXC^RGHLEXC(RGEXC,RGERR),RGZ="G."_RGZ
"RTN","RGHLLOG",93,0)
 I RGI=2 D ALERT^RGRSUTL2(RGERR,RGZ) Q
"RTN","RGHLLOG",94,0)
 D MAIL^RGRSUTL2(RGERR,RGZ,"CIRN Exception: "_$$EXC^RGHLEXC(RGEXC),"MPI/PD exception notification")
"RTN","RGHLLOG",95,0)
 Q
"RTN","RGHLLOG",96,0)
 ;
"RTN","RGHLLOG",97,0)
INVEXC(RGMID) ; determine if this exception needs to be sent to MPI/PD
"RTN","RGHLLOG",98,0)
 ; personnel via FORUM. Return 1 to avoid messaging to FORUM, else 0.
"RTN","RGHLLOG",99,0)
 ; IA#:3244 is applied in this functionality
"RTN","RGHLLOG",100,0)
 N RGFLG,RGIEN S RGFLG=1
"RTN","RGHLLOG",101,0)
 S RGIEN=$$IEN773(RGMID) Q:'RGIEN RGFLG
"RTN","RGHLLOG",102,0)
 S RGIEN("SND")=$$GET1^DIQ(773,RGIEN_",",13)
"RTN","RGHLLOG",103,0)
 S RGIEN("REC")=$$GET1^DIQ(773,RGIEN_",",14)
"RTN","RGHLLOG",104,0)
 ; check the sending application (fld:13, 0;11) & the receiving
"RTN","RGHLLOG",105,0)
 ; application (fld:14, 0;12) to see if they are related to the MPI/PD
"RTN","RGHLLOG",106,0)
 ; project.
"RTN","RGHLLOG",107,0)
 I RGIEN("SND")]""!(RGIEN("REC")]"") D  Q RGFLG
"RTN","RGHLLOG",108,0)
 .S RGFLG=$$APP(RGIEN("SND")) Q:'RGFLG
"RTN","RGHLLOG",109,0)
 .S RGFLG=$$APP(RGIEN("REC"))
"RTN","RGHLLOG",110,0)
 .Q
"RTN","RGHLLOG",111,0)
 ; Only if the sending/receiving applications cannot be determined from
"RTN","RGHLLOG",112,0)
 ; the data in their respective fields, do I check the MSH multiple for
"RTN","RGHLLOG",113,0)
 ; the MSH segment. I identify the sending/receiving application from
"RTN","RGHLLOG",114,0)
 ; this segment. 
"RTN","RGHLLOG",115,0)
 E  D
"RTN","RGHLLOG",116,0)
 .N RG,RG1,RGMSH
"RTN","RGHLLOG",117,0)
 .D GETS^DIQ(773,RGIEN_",",200,,"RGMSH") ;check MSH mult for snd/rec app
"RTN","RGHLLOG",118,0)
 .Q:'($D(RGMSH)\10)  ; no data in "MSH" multiple for file 773
"RTN","RGHLLOG",119,0)
 .S RGIEN=RGIEN_",",RG="RGMSH(773,"""_RGIEN_""","_200_")"
"RTN","RGHLLOG",120,0)
 .S RG1=0 F  S RG1=$O(@RG@(RG1)) Q:RG1'>0  D  Q:$E($G(@RG@(RG1)),1,3)="MSH"
"RTN","RGHLLOG",121,0)
 ..I $E($G(@RG@(RG1)),1,3)="MSH" D
"RTN","RGHLLOG",122,0)
 ...S RG(0)=$G(@RG@(RG1)),RGFS=$E(RG(0),4)
"RTN","RGHLLOG",123,0)
 ...S:$P(RG(0),RGFS,3)]"" RGFLG=$$APP($P(RG(0),RGFS,3)) Q:'RGFLG
"RTN","RGHLLOG",124,0)
 ...S:$P(RG(0),RGFS,5)]"" RGFLG=$$APP($P(RG(0),RGFS,5))
"RTN","RGHLLOG",125,0)
 ...Q
"RTN","RGHLLOG",126,0)
 ..Q
"RTN","RGHLLOG",127,0)
 .Q
"RTN","RGHLLOG",128,0)
 Q RGFLG
"RTN","RGHLLOG",129,0)
APP(X) ; check if the sending/receiving application is relevant to the
"RTN","RGHLLOG",130,0)
 ; MPI/PD team.  Returns 1 if a non-relevant namespace, else 0
"RTN","RGHLLOG",131,0)
 I $E(X,1,2)="RG"!($E(X,1,2)="VA")!($E(X,1,3)="MPI") Q 0
"RTN","RGHLLOG",132,0)
 Q 1
"RTN","RGHLLOG",133,0)
 ;
"RTN","RGHLLOG",134,0)
IEN773(RGMID) ; find the ien of the record in the HL7 MESSAGE ADMINISTRATION
"RTN","RGHLLOG",135,0)
 ; (#773) file based on the Message ID.  Input: Message ID
"RTN","RGHLLOG",136,0)
 ; Output: null, no record in 773, else 773 record ien.  IA#: 3244
"RTN","RGHLLOG",137,0)
 Q:$G(RGMID)="" ""
"RTN","RGHLLOG",138,0)
 Q $O(^HLMA("C",RGMID,0))
"VER")
8.0^22.0
**END**
**END**
