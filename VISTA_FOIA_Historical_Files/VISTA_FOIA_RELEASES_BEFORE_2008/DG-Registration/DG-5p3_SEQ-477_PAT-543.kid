Released DG*5.3*543 SEQ #477
Extracted from mail message
**KIDS**:DG*5.3*543^

**INSTALL NAME**
DG*5.3*543
"BLD",4994,0)
DG*5.3*543^REGISTRATION^0^3030916^y
"BLD",4994,1,0)
^^1^1^3030815^
"BLD",4994,1,1,0)
This is the cleanup of the Name Component file #20.
"BLD",4994,4,0)
^9.64PA^^
"BLD",4994,"INIT")
CLEANUP^DG53P543
"BLD",4994,"KRN",0)
^9.67PA^8989.52^19
"BLD",4994,"KRN",.4,0)
.4
"BLD",4994,"KRN",.401,0)
.401
"BLD",4994,"KRN",.402,0)
.402
"BLD",4994,"KRN",.403,0)
.403
"BLD",4994,"KRN",.5,0)
.5
"BLD",4994,"KRN",.84,0)
.84
"BLD",4994,"KRN",3.6,0)
3.6
"BLD",4994,"KRN",3.8,0)
3.8
"BLD",4994,"KRN",9.2,0)
9.2
"BLD",4994,"KRN",9.8,0)
9.8
"BLD",4994,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4994,"KRN",9.8,"NM",1,0)
DG53P543^^0^B44649199
"BLD",4994,"KRN",9.8,"NM","B","DG53P543",1)

"BLD",4994,"KRN",19,0)
19
"BLD",4994,"KRN",19.1,0)
19.1
"BLD",4994,"KRN",101,0)
101
"BLD",4994,"KRN",409.61,0)
409.61
"BLD",4994,"KRN",771,0)
771
"BLD",4994,"KRN",870,0)
870
"BLD",4994,"KRN",8989.51,0)
8989.51
"BLD",4994,"KRN",8989.52,0)
8989.52
"BLD",4994,"KRN",8994,0)
8994
"BLD",4994,"KRN","B",.4,.4)

"BLD",4994,"KRN","B",.401,.401)

"BLD",4994,"KRN","B",.402,.402)

"BLD",4994,"KRN","B",.403,.403)

"BLD",4994,"KRN","B",.5,.5)

"BLD",4994,"KRN","B",.84,.84)

"BLD",4994,"KRN","B",3.6,3.6)

"BLD",4994,"KRN","B",3.8,3.8)

"BLD",4994,"KRN","B",9.2,9.2)

"BLD",4994,"KRN","B",9.8,9.8)

"BLD",4994,"KRN","B",19,19)

"BLD",4994,"KRN","B",19.1,19.1)

"BLD",4994,"KRN","B",101,101)

"BLD",4994,"KRN","B",409.61,409.61)

"BLD",4994,"KRN","B",771,771)

"BLD",4994,"KRN","B",870,870)

"BLD",4994,"KRN","B",8989.51,8989.51)

"BLD",4994,"KRN","B",8989.52,8989.52)

"BLD",4994,"KRN","B",8994,8994)

"BLD",4994,"PRE")
DG53P543
"BLD",4994,"QUES",0)
^9.62^^
"BLD",4994,"REQB",0)
^9.611^1^1
"BLD",4994,"REQB",1,0)
DG*5.3*547^1
"BLD",4994,"REQB","B","DG*5.3*547",1)

"INIT")
CLEANUP^DG53P543
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
543^3030916^100850
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3030916
"PKG",5,22,1,"PAH",1,1,1,0)
This is the cleanup of the Name Component file #20.
"PRE")
DG53P543
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DG53P543")
0^1^B44649199
"RTN","DG53P543",1,0)
DG53P543 ;BAY/JT - cleanup of file 20 ; 9/16/03 4:56pm
"RTN","DG53P543",2,0)
 ;;5.3;Registration;**543**;Aug 13, 1993
"RTN","DG53P543",3,0)
 ; patient name .01 only
"RTN","DG53P543",4,0)
 ;
"RTN","DG53P543",5,0)
ENV ; do environment check
"RTN","DG53P543",6,0)
 S XPDABORT=""
"RTN","DG53P543",7,0)
 D PROGCHK(.XPDABORT)
"RTN","DG53P543",8,0)
 I XPDABORT="" K XPDABORT
"RTN","DG53P543",9,0)
 Q
"RTN","DG53P543",10,0)
PROGCHK(XPDABORT) ; checks for necessary programmer variables
"RTN","DG53P543",11,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","DG53P543",12,0)
 .D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","DG53P543",13,0)
 .D MES^XPDUTL("Installation aborted.")
"RTN","DG53P543",14,0)
 .S XPDABORT=2
"RTN","DG53P543",15,0)
 Q
"RTN","DG53P543",16,0)
 ;
"RTN","DG53P543",17,0)
CLEANUP N DGIEN,DGFULLNM,DGLINK,DGFND,DGDPT,DGNAME,DGZERO,DGONE,DGERR,CNT,DGMID,DGTOT,DGUPDT,DGNOLINK,DGLINK0,DGLINK1,DGCONC,DGOTHERS,DGGLOBAL,X1,X2
"RTN","DG53P543",18,0)
 K ^XTMP("DG53P543")
"RTN","DG53P543",19,0)
 S X1=DT,X2=90 D C^%DTC
"RTN","DG53P543",20,0)
 S ^XTMP("DG53P543",0)=X_"^"_DT_"^Problems w/file 2 links w/file 20"
"RTN","DG53P543",21,0)
 S (DGIEN,DGTOT,DGERR,DGUPDT,DGNOLINK,DGLINK0,DGLINK1,DGOTHERS)=0
"RTN","DG53P543",22,0)
 D BMES^XPDUTL("Beginning clean-up...Reading thru entire Patient File...")
"RTN","DG53P543",23,0)
 F  S DGIEN=$O(^DPT(DGIEN)) Q:'DGIEN  D
"RTN","DG53P543",24,0)
 .S DGTOT=DGTOT+1
"RTN","DG53P543",25,0)
 .Q:$P($G(^DPT(DGIEN,0)),U)["MERGING INTO"
"RTN","DG53P543",26,0)
 .Q:$D(^DPT(DGIEN,-9))
"RTN","DG53P543",27,0)
 .S DGFULLNM=$P($G(^DPT(DGIEN,0)),U)
"RTN","DG53P543",28,0)
 .S DGLINK=+$P($G(^DPT(DGIEN,"NAME")),U)
"RTN","DG53P543",29,0)
 .I 'DGLINK D NOLINK Q
"RTN","DG53P543",30,0)
 .S DGZERO=$G(^VA(20,DGLINK,0))
"RTN","DG53P543",31,0)
 .I DGZERO="" D NOZERO Q
"RTN","DG53P543",32,0)
 .I $P(DGZERO,U)'=2!($P(DGZERO,U,2)'=".01")!(+$P(DGZERO,U,3)'=DGIEN) D BADZERO Q
"RTN","DG53P543",33,0)
 .S DGONE=$G(^VA(20,DGLINK,1))
"RTN","DG53P543",34,0)
 .I DGONE="" D NOONE Q
"RTN","DG53P543",35,0)
 .;
"RTN","DG53P543",36,0)
 .S DGERR=0
"RTN","DG53P543",37,0)
 .; skip if "error" in family name
"RTN","DG53P543",38,0)
 .I $P(DGFULLNM,",",1)["ERROR" Q
"RTN","DG53P543",39,0)
 .; compare family name
"RTN","DG53P543",40,0)
 .I $P(DGFULLNM,",",1)'=$P(DGONE,U) S DGERR=1 S ^XTMP("DG53P543",DGIEN,DGLINK,DGERR)=$P(DGFULLNM,",",1)_U_$P(DGONE,U) S DGUPDT=DGUPDT+1 Q
"RTN","DG53P543",41,0)
 .; skip if no first name
"RTN","DG53P543",42,0)
 .I $P(DGFULLNM,",",2)="",$P(DGONE,U,2)="" Q
"RTN","DG53P543",43,0)
 .; if comma in first name, skip if everything equal
"RTN","DG53P543",44,0)
 .I $P(DGONE,U,2)["," S DGCONC=$P(DGONE,U)_","_$P(DGONE,U,2) I DGCONC=DGFULLNM Q
"RTN","DG53P543",45,0)
 .; compare first name
"RTN","DG53P543",46,0)
 .S CNT=$L($P(DGONE,U,2))
"RTN","DG53P543",47,0)
 .I $E($P(DGFULLNM,",",2),1,CNT)'=$P(DGONE,U,2) S DGERR=2 S ^XTMP("DG53P543",DGIEN,DGLINK,DGERR)=DGFULLNM_"///"_$P(DGONE,U,1,5) S DGOTHERS=DGOTHERS+1 Q
"RTN","DG53P543",48,0)
 .;compare middle names and suffixes
"RTN","DG53P543",49,0)
 .S DGMID=$P($P(DGFULLNM,",",2)," ",2)
"RTN","DG53P543",50,0)
 .I DGMID=$P(DGONE,U,3)!(DGMID=$P(DGONE,U,5)) Q
"RTN","DG53P543",51,0)
 .S DGMID=$P($P(DGFULLNM,",",2)," ",2,99)
"RTN","DG53P543",52,0)
 .I $P(DGONE,U,3)'="",DGMID[$P(DGONE,U,3) Q
"RTN","DG53P543",53,0)
 .I $P(DGONE,U,5)'="",DGMID[$P(DGONE,U,5) Q
"RTN","DG53P543",54,0)
 .S DGERR=3
"RTN","DG53P543",55,0)
 .S ^XTMP("DG53P543",DGIEN,DGLINK,DGERR)=DGFULLNM_"///"_$P(DGONE,U,1,5) S DGOTHERS=DGOTHERS+1
"RTN","DG53P543",56,0)
 .Q
"RTN","DG53P543",57,0)
 ;
"RTN","DG53P543",58,0)
 D MES^XPDUTL("Total # of Patient File records read: "_DGTOT)
"RTN","DG53P543",59,0)
 D MES^XPDUTL("Total # of Name Component file #20 records needing cleanup: "_DGUPDT)
"RTN","DG53P543",60,0)
 I DGUPDT D
"RTN","DG53P543",61,0)
 .D MES^XPDUTL("I will now update these records ...")
"RTN","DG53P543",62,0)
 .D UPDATE
"RTN","DG53P543",63,0)
 .D MES^XPDUTL("Done !")
"RTN","DG53P543",64,0)
 I DGOTHERS!(DGNOLINK)!(DGLINK0)!(DGLINK1) D
"RTN","DG53P543",65,0)
 .D MES^XPDUTL("I also found other records that need attention:")
"RTN","DG53P543",66,0)
 .I DGOTHERS D MES^XPDUTL("  # of records needing reformatting: "_DGOTHERS)
"RTN","DG53P543",67,0)
 .I DGNOLINK D MES^XPDUTL("  # of records with no link: "_DGNOLINK)
"RTN","DG53P543",68,0)
 .I DGLINK0 D MES^XPDUTL("  # of records with no or bad zero node: "_DGLINK0)
"RTN","DG53P543",69,0)
 .I DGLINK1 D MES^XPDUTL("  # of records with no '1' node: "_DGLINK1)
"RTN","DG53P543",70,0)
 .S DGGLOBAL="^XTMP(""DG53P543"""
"RTN","DG53P543",71,0)
 .D MES^XPDUTL("  For more details, please see the "_DGGLOBAL_" global")
"RTN","DG53P543",72,0)
 .D MES^XPDUTL("  or print the report PRTRPT^DG53P543")
"RTN","DG53P543",73,0)
 D BMES^XPDUTL("Clean-up is complete")
"RTN","DG53P543",74,0)
 Q
"RTN","DG53P543",75,0)
NOLINK ;
"RTN","DG53P543",76,0)
 S DGNOLINK=DGNOLINK+1
"RTN","DG53P543",77,0)
 I DGFULLNM="" S ^XTMP("DG53P543",DGIEN,0)="no name on patient file" Q
"RTN","DG53P543",78,0)
 I '$D(^VA(20,"C",DGFULLNM)) S ^XTMP("DG53P543",DGIEN,0)="no link to file 20" Q
"RTN","DG53P543",79,0)
 S DGFND=0
"RTN","DG53P543",80,0)
 F  S DGFND=$O(^VA(20,"C",DGFULLNM,DGFND)) Q:'DGFND  D
"RTN","DG53P543",81,0)
 .S DGDPT=+$P($G(^VA(20,DGFND,0)),U,3)
"RTN","DG53P543",82,0)
 .I DGDPT S DGNAME=$P($G(^DPT(DGDPT,0)),U) I DGNAME'="",DGNAME=DGFULLNM S ^XTMP("DG53P543",DGIEN,0)=DGFND_" points to Patient file "_DGDPT
"RTN","DG53P543",83,0)
 Q
"RTN","DG53P543",84,0)
NOZERO ;
"RTN","DG53P543",85,0)
 S DGLINK0=DGLINK0+1
"RTN","DG53P543",86,0)
 S ^XTMP("DG53P543",DGIEN,DGLINK)="no zero node on file 20"
"RTN","DG53P543",87,0)
 Q
"RTN","DG53P543",88,0)
BADZERO ;
"RTN","DG53P543",89,0)
 S DGLINK0=DGLINK0+1
"RTN","DG53P543",90,0)
 S ^XTMP("DG53P543",DGIEN,DGLINK)="bad zero node on file 20"
"RTN","DG53P543",91,0)
 Q
"RTN","DG53P543",92,0)
NOONE ;
"RTN","DG53P543",93,0)
 S DGLINK1=DGLINK1+1
"RTN","DG53P543",94,0)
 S ^XTMP("DG53P543",DGIEN,DGLINK)="no '1' node on file 20"
"RTN","DG53P543",95,0)
 Q
"RTN","DG53P543",96,0)
UPDATE ;
"RTN","DG53P543",97,0)
 Q:'$D(^XTMP("DG53P543"))
"RTN","DG53P543",98,0)
 N DG20NAME,DA,DR,DIE,X
"RTN","DG53P543",99,0)
 S DGIEN=0
"RTN","DG53P543",100,0)
 F  S DGIEN=$O(^XTMP("DG53P543",DGIEN)) Q:'DGIEN  D
"RTN","DG53P543",101,0)
 .S DGLINK=0
"RTN","DG53P543",102,0)
 .F  S DGLINK=$O(^XTMP("DG53P543",DGIEN,DGLINK)) Q:'DGLINK  D
"RTN","DG53P543",103,0)
 ..S DGERR=0
"RTN","DG53P543",104,0)
 ..F  S DGERR=$O(^XTMP("DG53P543",DGIEN,DGLINK,DGERR)) Q:'DGERR  D
"RTN","DG53P543",105,0)
 ...I DGERR'=1 Q
"RTN","DG53P543",106,0)
 ...S DG20NAME=$P($G(^DPT(DGIEN,0)),U) I DG20NAME'="" D
"RTN","DG53P543",107,0)
 ....S DIE="^DPT(",DA=DGIEN,DR=".01///^S X=DG20NAME" D ^DIE
"RTN","DG53P543",108,0)
 ....D MES^XPDUTL("Record # "_DGIEN_" for "_$P(^DPT(DGIEN,0),U)_" has been updated")
"RTN","DG53P543",109,0)
 ....K ^XTMP("DG53P543",DGIEN,DGLINK,DGERR)
"RTN","DG53P543",110,0)
 ....K DG20NAME
"RTN","DG53P543",111,0)
 Q
"RTN","DG53P543",112,0)
 ;
"RTN","DG53P543",113,0)
PRTRPT ;
"RTN","DG53P543",114,0)
 I $$DEVICE() D PRINT
"RTN","DG53P543",115,0)
 Q
"RTN","DG53P543",116,0)
DEVICE() ; choose device and whether to queue.
"RTN","DG53P543",117,0)
 N OK,IOP,POP,%ZIS,DGX
"RTN","DG53P543",118,0)
 S OK=1
"RTN","DG53P543",119,0)
 S %ZIS="MQ"
"RTN","DG53P543",120,0)
 D ^%ZIS
"RTN","DG53P543",121,0)
 S:POP OK=0
"RTN","DG53P543",122,0)
 I OK,$D(IO("Q")) D
"RTN","DG53P543",123,0)
 .N ZTRTN,ZTDESC,ZTSKM,ZTREQ,ZTSTOP
"RTN","DG53P543",124,0)
 .S ZTRTN="PRINT^DG53P543"
"RTN","DG53P543",125,0)
 .S ZTDESC="Print of XTMP global for DG53P543."
"RTN","DG53P543",126,0)
 .F DGX=1:1:20 D ^%ZTLOAD Q:$G(ZTSK)
"RTN","DG53P543",127,0)
 .W !,$S($D(ZTSK):"Request "_ZTSK_" queued!",1:"Request Cancelled!"),!
"RTN","DG53P543",128,0)
 .D HOME^%ZIS
"RTN","DG53P543",129,0)
 .S OK=0
"RTN","DG53P543",130,0)
 Q OK
"RTN","DG53P543",131,0)
 ;
"RTN","DG53P543",132,0)
PRINT ;
"RTN","DG53P543",133,0)
 U IO
"RTN","DG53P543",134,0)
 N DGIEN,DGLINK,DGERR,DGQUIT,DGPG,DGDDT
"RTN","DG53P543",135,0)
 S (DGQUIT,DGPG)=0
"RTN","DG53P543",136,0)
 S DGDDT=$$FMTE^XLFDT($$NOW^XLFDT,"D")
"RTN","DG53P543",137,0)
 D HEAD
"RTN","DG53P543",138,0)
 S DGIEN=0,DGIEN=$O(^XTMP("DG53P543",DGIEN))
"RTN","DG53P543",139,0)
 I DGIEN="" D  Q
"RTN","DG53P543",140,0)
 .W !!!,?20,"*** No records to report ***"
"RTN","DG53P543",141,0)
 ;
"RTN","DG53P543",142,0)
 S DGIEN=0
"RTN","DG53P543",143,0)
 F  S DGIEN=$O(^XTMP("DG53P543",DGIEN)) Q:'DGIEN  D  Q:DGQUIT
"RTN","DG53P543",144,0)
 .I $D(^XTMP("DG53P543",DGIEN,0)) D 
"RTN","DG53P543",145,0)
 ..I $Y>(IOSL-4) D HEAD
"RTN","DG53P543",146,0)
 ..W "# ",DGIEN,?11,^XTMP("DG53P543",DGIEN,0),!
"RTN","DG53P543",147,0)
 .S DGLINK=0
"RTN","DG53P543",148,0)
 .F  S DGLINK=$O(^XTMP("DG53P543",DGIEN,DGLINK)) Q:'DGLINK  D
"RTN","DG53P543",149,0)
 ..I $D(^XTMP("DG53P543",DGIEN,DGLINK))=1 D
"RTN","DG53P543",150,0)
 ...I $Y>(IOSL-4) D HEAD
"RTN","DG53P543",151,0)
 ...W "# ",DGIEN,?11,$P(^DPT(DGIEN,0),U),?40,^XTMP("DG53P543",DGIEN,DGLINK),?69,"# ",DGLINK,!
"RTN","DG53P543",152,0)
 ..S DGERR=0
"RTN","DG53P543",153,0)
 ..F  S DGERR=$O(^XTMP("DG53P543",DGIEN,DGLINK,DGERR)) Q:'DGERR  D
"RTN","DG53P543",154,0)
 ...I $Y>(IOSL-4) D HEAD
"RTN","DG53P543",155,0)
 ...W "# ",DGIEN,?11,^XTMP("DG53P543",DGIEN,DGLINK,DGERR),?69,"# ",DGLINK,!
"RTN","DG53P543",156,0)
 ;
"RTN","DG53P543",157,0)
 I DGQUIT W:$D(ZTQUEUED) !!,"Report stopped at user's request" Q
"RTN","DG53P543",158,0)
 I $G(DGPG)>0,$E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:+Y=0 DGQUIT=1
"RTN","DG53P543",159,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","DG53P543",160,0)
 Q
"RTN","DG53P543",161,0)
HEAD ;
"RTN","DG53P543",162,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S (ZTSTOP,DGQUIT)=1 Q
"RTN","DG53P543",163,0)
 I $G(DGPG)>0,$E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:+Y=0 DGQUIT=1
"RTN","DG53P543",164,0)
 Q:DGQUIT
"RTN","DG53P543",165,0)
 S DGPG=$G(DGPG)+1
"RTN","DG53P543",166,0)
 W @IOF,!,DGDDT,?15,"DG*5.3*543 File #20 Cleanup Utility",?70,"Page:",$J(DGPG,5),! K X S $P(X,"-",81)="" W X,!
"RTN","DG53P543",167,0)
 W !,"File 2 IEN",?11,"Patient Name///Component Last^First^Middle^Prefix^Suffix",?69,"File 20 IEN",!
"RTN","DG53P543",168,0)
 S $P(X,"-",81)="" W X,!
"RTN","DG53P543",169,0)
 Q
"VER")
8.0^22
**END**
**END**
