Released RMPR*3*132 SEQ #108
Extracted from mail message
**KIDS**:RMPR*3.0*132^

**INSTALL NAME**
RMPR*3.0*132
"BLD",6296,0)
RMPR*3.0*132^PROSTHETICS^0^3070208^y
"BLD",6296,1,0)
^^6^6^3061012^
"BLD",6296,1,1,0)
1.  Issue with P.O. continuation page
"BLD",6296,1,2,0)
2.  Prosthetics Inventory message for ROP levels ignores partially filled
"BLD",6296,1,3,0)
    orders as outstanding.
"BLD",6296,1,4,0)
3a. Inventory Order Report does not acknowledge partially filled orders.
"BLD",6296,1,5,0)
3b. Partially filled orders cannot be later updated with receipts that
"BLD",6296,1,6,0)
    may be received.
"BLD",6296,4,0)
^9.64PA^^
"BLD",6296,6.3)
13
"BLD",6296,"ABPKG")
n
"BLD",6296,"KRN",0)
^9.67PA^8989.52^19
"BLD",6296,"KRN",.4,0)
.4
"BLD",6296,"KRN",.401,0)
.401
"BLD",6296,"KRN",.402,0)
.402
"BLD",6296,"KRN",.403,0)
.403
"BLD",6296,"KRN",.5,0)
.5
"BLD",6296,"KRN",.84,0)
.84
"BLD",6296,"KRN",3.6,0)
3.6
"BLD",6296,"KRN",3.8,0)
3.8
"BLD",6296,"KRN",9.2,0)
9.2
"BLD",6296,"KRN",9.8,0)
9.8
"BLD",6296,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",6296,"KRN",9.8,"NM",1,0)
RMPR4P21^^0^B31454912
"BLD",6296,"KRN",9.8,"NM",2,0)
RMPR4P22^^0^B25413275
"BLD",6296,"KRN",9.8,"NM",3,0)
RMPR5NU^^0^B18326517
"BLD",6296,"KRN",9.8,"NM",4,0)
RMPRPIUD^^0^B12700187
"BLD",6296,"KRN",9.8,"NM",5,0)
RMPRPIYY^^0^B21846868
"BLD",6296,"KRN",9.8,"NM",6,0)
RMPRPI09^^0^B34634157
"BLD",6296,"KRN",9.8,"NM",7,0)
RMPRPIYG^^0^B51597493
"BLD",6296,"KRN",9.8,"NM","B","RMPR4P21",1)

"BLD",6296,"KRN",9.8,"NM","B","RMPR4P22",2)

"BLD",6296,"KRN",9.8,"NM","B","RMPR5NU",3)

"BLD",6296,"KRN",9.8,"NM","B","RMPRPI09",6)

"BLD",6296,"KRN",9.8,"NM","B","RMPRPIUD",4)

"BLD",6296,"KRN",9.8,"NM","B","RMPRPIYG",7)

"BLD",6296,"KRN",9.8,"NM","B","RMPRPIYY",5)

"BLD",6296,"KRN",19,0)
19
"BLD",6296,"KRN",19,"NM",0)
^9.68A^^
"BLD",6296,"KRN",19.1,0)
19.1
"BLD",6296,"KRN",101,0)
101
"BLD",6296,"KRN",409.61,0)
409.61
"BLD",6296,"KRN",771,0)
771
"BLD",6296,"KRN",870,0)
870
"BLD",6296,"KRN",8989.51,0)
8989.51
"BLD",6296,"KRN",8989.52,0)
8989.52
"BLD",6296,"KRN",8994,0)
8994
"BLD",6296,"KRN","B",.4,.4)

"BLD",6296,"KRN","B",.401,.401)

"BLD",6296,"KRN","B",.402,.402)

"BLD",6296,"KRN","B",.403,.403)

"BLD",6296,"KRN","B",.5,.5)

"BLD",6296,"KRN","B",.84,.84)

"BLD",6296,"KRN","B",3.6,3.6)

"BLD",6296,"KRN","B",3.8,3.8)

"BLD",6296,"KRN","B",9.2,9.2)

"BLD",6296,"KRN","B",9.8,9.8)

"BLD",6296,"KRN","B",19,19)

"BLD",6296,"KRN","B",19.1,19.1)

"BLD",6296,"KRN","B",101,101)

"BLD",6296,"KRN","B",409.61,409.61)

"BLD",6296,"KRN","B",771,771)

"BLD",6296,"KRN","B",870,870)

"BLD",6296,"KRN","B",8989.51,8989.51)

"BLD",6296,"KRN","B",8989.52,8989.52)

"BLD",6296,"KRN","B",8994,8994)

"BLD",6296,"QUES",0)
^9.62^^
"BLD",6296,"REQB",0)
^9.611^2^2
"BLD",6296,"REQB",1,0)
RMPR*3.0*61^2
"BLD",6296,"REQB",2,0)
RMPR*3.0*115^2
"BLD",6296,"REQB","B","RMPR*3.0*115",2)

"BLD",6296,"REQB","B","RMPR*3.0*61",1)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
132^3070208
"PKG",101,22,1,"PAH",1,1,0)
^^6^6^3070208
"PKG",101,22,1,"PAH",1,1,1,0)
1.  Issue with P.O. continuation page
"PKG",101,22,1,"PAH",1,1,2,0)
2.  Prosthetics Inventory message for ROP levels ignores partially filled
"PKG",101,22,1,"PAH",1,1,3,0)
    orders as outstanding.
"PKG",101,22,1,"PAH",1,1,4,0)
3a. Inventory Order Report does not acknowledge partially filled orders.
"PKG",101,22,1,"PAH",1,1,5,0)
3b. Partially filled orders cannot be later updated with receipts that
"PKG",101,22,1,"PAH",1,1,6,0)
    may be received.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","RMPR4P21")
0^1^B31454912^B31209591
"RTN","RMPR4P21",1,0)
RMPR4P21 ;PHX/HNC,RVD -PRINT PURCHASE CARD ORDER ;3/1/1996
"RTN","RMPR4P21",2,0)
 ;;3.0;PROSTHETICS;**3,15,19,26,55,90,132**;Feb 09, 1996;Build 13
"RTN","RMPR4P21",3,0)
 ;
"RTN","RMPR4P21",4,0)
 ; ODJ - patch 55 - 1/29/01 - replace hard code mail route symbol 121
"RTN","RMPR4P21",5,0)
 ;                            with extrinsic call to read site param.
"RTN","RMPR4P21",6,0)
 ;                            (nois AUG-1097-32118)
"RTN","RMPR4P21",7,0)
 ;
"RTN","RMPR4P21",8,0)
 G:$D(RMPRA)&($G(RMPRA)'>0) EN I '$D(RMPR)!'$D(RMPRSITE) D DIV4^RMPRSIT G:$D(X) EX
"RTN","RMPR4P21",9,0)
 I +$P(^RMPR(669.9,RMPRSITE,0),U,5) I $D(RMPRA)&($D(^%ZIS(1,$P(^RMPR(669.9,RMPRSITE,0),U,5),0))) S IOP="Q;"_$P(^(0),U,1) S %ZIS="MQ" D ^%ZIS G:POP EX S ZTIO=ION G PT
"RTN","RMPR4P21",10,0)
 I $D(RMPRA)&('$P(^RMPR(669.9,RMPRSITE,0),U,5)) G ZIS
"RTN","RMPR4P21",11,0)
EN1(RMPRPTR) ;
"RTN","RMPR4P21",12,0)
 I $D(RMPRPTR) I $D(RMPRA)&($D(^%ZIS(1,RMPRPTR,0))) S IOP="Q;"_$P(^(0),U,1) S %ZIS="MQ" D ^%ZIS G:POP EX S ZTIO=ION G PT
"RTN","RMPR4P21",13,0)
EN ;ENTRY POINT FOR REPRINTING- Modified in patch 90 HNC
"RTN","RMPR4P21",14,0)
 I '$D(RMPR)!'$D(RMPRSITE) D DIV4^RMPRSIT G:$D(X) EX
"RTN","RMPR4P21",15,0)
 S RMPRACT=1,DIC="^RMPR(664,",DIC(0)="AEQM",DIC("A")="Select Transaction or Patient Name: ",RMPRF=2
"RTN","RMPR4P21",16,0)
 S DIC("S")="I $D(^(4)) I ('$P(^(0),U,5)),($P(^(0),U,14)=RMPR(""STA""))"
"RTN","RMPR4P21",17,0)
 S DIC("W")="D EN2^RMPR4D1"
"RTN","RMPR4P21",18,0)
 D ^DIC G:Y<0 EX
"RTN","RMPR4P21",19,0)
 S RMPRA=+Y
"RTN","RMPR4P21",20,0)
 ;I $P(^RMPR(664,+Y,0),U,5) D M2^RMPRM
"RTN","RMPR4P21",21,0)
 D PR^RMPR421A I %'>0 G EX
"RTN","RMPR4P21",22,0)
 ;I +$P(^RMPR(669.9,RMPRSITE,0),U,5) I $D(RMPRA)&($D(^%ZIS(1,$P(^RMPR(669.9,RMPRSITE,0),U,5),0))) S IOP="Q;"_$P(^(0),U,1),%ZIS="Q" D ^%ZIS G:POP EX S ZTIO=ION G PT
"RTN","RMPR4P21",23,0)
ZIS S %ZIS="QM" D ^%ZIS G:POP EX
"RTN","RMPR4P21",24,0)
 I '$D(IO("Q")) U IO G PRT
"RTN","RMPR4P21",25,0)
 S ZTIO=ION
"RTN","RMPR4P21",26,0)
PT S ZTDTH=$H,ZTSAVE("RMPRPN")="",ZTSAVE("RMPRA")="",ZTSAVE("RMPRSITE")="",ZTSAVE("RMPR(")="",ZTRTN="PRT^RMPR4P21",ZTDESC="PURCHASE CARD ORDER"
"RTN","RMPR4P21",27,0)
  S:$D(RMPRPRIV) ZTSAVE("RMPRPRIV")="" D ^%ZTLOAD W !,$S($D(ZTSK):"<REQUEST QUEUED>",1:"<REQUEST NOT QUEUED>") D HOME^%ZIS H 3 G EX
"RTN","RMPR4P21",28,0)
PRT ;ENTRY POINT TO PRINT
"RTN","RMPR4P21",29,0)
 S %X="^RMPR(664,RMPRA,",%Y="R664(" D %XY^%RCR K %X,%Y
"RTN","RMPR4P21",30,0)
 S RDUZ=$P(R664(0),U,9),RDUZ=$P(^VA(200,RDUZ,0),U,1),DFN=$P(R664(0),U,2),RTN=$P(R664(0),U,7),CP=$P(R664(0),U,6),RMPRPAGE=2
"RTN","RMPR4P21",31,0)
 D ADD^VADPT,DEM^VADPT,ELIG^VADPT
"RTN","RMPR4P21",32,0)
 W:$Y>0 @IOF W ?20,"OMB Number 2900-0188",?50,"PO#: ",$P($G(^RMPR(664,RMPRA,4)),U,5)
"RTN","RMPR4P21",33,0)
 W !!?7,"***ORIGINAL COPY AND COMMERCIAL INVOICE MUST BE SUBMITTED***",!?15,"TO THE VAMC PROSTHETIC ACTIVITY LISTED BELOW"
"RTN","RMPR4P21",34,0)
HDR ;PRINT HEADER FOR 2421 ADDRESS INFO
"RTN","RMPR4P21",35,0)
 S (RMPRT,RMPRB)="",$P(RMPRT,"_",IOM)="",$P(RMPRB,"-",IOM)="" W !,RMPRT,!,"Department of Veterans Affairs"_"|"_"Prosthetic Authorization for Items or Services",!,RMPRB
"RTN","RMPR4P21",36,0)
 W !,"1. Name and Address of Vendor",?40,"2. Name and Address of VA Facility"
"RTN","RMPR4P21",37,0)
 S RMPRV=$P(R664(0),U,4),RMPRST=""
"RTN","RMPR4P21",38,0)
 I $D(^PRC(440,RMPRV,0)) S RMPRV=^PRC(440,RMPRV,0) D
"RTN","RMPR4P21",39,0)
 .S RMPRST=$P(RMPRV,U,7),RMPRPHON=$P(RMPRV,U,10)
"RTN","RMPR4P21",40,0)
 .S RMPRAD1=$P(RMPRV,U,2),RMPRAD2=$P(RMPRV,U,3)
"RTN","RMPR4P21",41,0)
 .S RMPRCITY=$P(RMPRV,U,6),RMPR90IP=$P(RMPRV,U,8)
"RTN","RMPR4P21",42,0)
 .S RMPRVACN=$P($G(^PRC(440,$P(R664(0),U,4),2)),U,1)
"RTN","RMPR4P21",43,0)
 I $D(^DIC(5,+RMPRST,0)) S RMPRST=$P(^(0),U,2)
"RTN","RMPR4P21",44,0)
 E  S RMPRST="NO STATE ON FILE"
"RTN","RMPR4P21",45,0)
 W !,?5,$E($P(RMPRV,U,1),1,30),?40
"RTN","RMPR4P21",46,0)
 W $E(RMPR("NAME"),1,28)," ","(",$$STA^RMPRUTIL,"/",$$ROU^RMPRUTIL(RMPRSITE),")"
"RTN","RMPR4P21",47,0)
 W !,?5,$E(RMPRAD1,1,35),?40,$E(RMPR("ADD"),1,39)
"RTN","RMPR4P21",48,0)
 I RMPRAD2'="" W !,?5,$E(RMPRAD2,1,35),?40,RMPR("CITY")
"RTN","RMPR4P21",49,0)
 I RMPRAD2="" W !?5,RMPRCITY_","_RMPRST_" "_RMPR90IP,?40,RMPR("CITY")
"RTN","RMPR4P21",50,0)
 I RMPRAD2'="" W !?5,RMPRCITY_","_RMPRST_" "_RMPR90IP
"RTN","RMPR4P21",51,0)
 W !,?5,RMPRPHON
"RTN","RMPR4P21",52,0)
 ;W:$G(RMPRVACN)'="" ?22,"ACCT # ",RMPRVACN
"RTN","RMPR4P21",53,0)
 W ?40,$P(^RMPR(669.9,RMPRSITE,0),U,4),!,RMPRB
"RTN","RMPR4P21",54,0)
 W !,"3. Veterans Name (Last, First, MI)",?40,"4. Date of Authorization"
"RTN","RMPR4P21",55,0)
 W !,?5,VADM(1) S Y=$P(R664(0),U,1) D DD^%DT W ?45,Y
"RTN","RMPR4P21",56,0)
 I $D(RMPRMOR) W !,RMPRB D HDR1 Q
"RTN","RMPR4P21",57,0)
 W !,RMPRB S RMPRODTE=Y
"RTN","RMPR4P21",58,0)
 S RMPRDELD="" I $D(R664(3)),$P(R664(3),U,2)]"" S Y=$P(R664(3),U,2) D DD^%DT S RMPRDELD=Y
"RTN","RMPR4P21",59,0)
 W !,"5. Veterans Address",?40,"6. Date Required",!,?5,VAPA(1),?45,RMPRDELD,!
"RTN","RMPR4P21",60,0)
 I VAPA(2)="" W ?5,VAPA(4)_","_$P(VAPA(5),U,2)_" "_VAPA(6),?40,$E(RMPRB,1,40),!,?40,"9. Authority For Issuance  CFR 17.115",!,?5,VAPA(8),?43,"CHARGE MEDICAL APPROPRIATION"
"RTN","RMPR4P21",61,0)
 I VAPA(2)'="" W ?5,VAPA(2),?40,$E(RMPRB,1,40),!,?5,VAPA(4)_","_$P(VAPA(5),U,2)_" "_VAPA(6),?40,"9. Authority For Issuance  CFR 17.115",!,?5,VAPA(8),?43,"CHARGE MEDICAL APPROPRIATION"
"RTN","RMPR4P21",62,0)
 W !,RMPRB
"RTN","RMPR4P21",63,0)
 W !,"7. Claim Number"_" "_VAEL(7),?40,"8. ID #:"_" "_$P($P(VADM(2),U,2),"-",3),!,RMPRB,!,"10. Statistical Data",?30,"11. FOB Point",?46,"12. Discount",?61,"13. Delivery Time"
"RTN","RMPR4P21",64,0)
 S R664("E")=$O(R664(1,0)),CAT=$P(R664(1,R664("E"),0),U,10)
"RTN","RMPR4P21",65,0)
 S RMPRCAT=$S(CAT=1:"SC/OP",CAT=2:"SC/IP",CAT=3:"NSC/IP",CAT=4:"NSC/OP",1:"")
"RTN","RMPR4P21",66,0)
 S SPE=$P(R664(1,R664("E"),0),U,11)
"RTN","RMPR4P21",67,0)
 S RMPRSCAT=$S(SPE=1:"SPECIAL LEGISLATION",SPE=2:"A&A",SPE=3:"PHC",SPE=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPR4P21",68,0)
 W !,RMPRCAT_" "_RMPRSCAT S:+$P(R664(0),U,10) RMPRFOB=$P(R664(0),U,10) W ?34,$S($D(RMPRFOB):"ORIGIN",1:"DEST"),?49,"% " I $D(R664(2)) W $P(R664(2),U,6)
"RTN","RMPR4P21",69,0)
 I $D(R664(3)) W ?66,$P(R664(3),U,3)_" Days"
"RTN","RMPR4P21",70,0)
 W !,?30,$E(RMPRB,1,50),!,?30,"14. Delivery To: " W:$D(R664(3)) $P(R664(3),U)
"RTN","RMPR4P21",71,0)
 W !,?36,"Attention: "_$P(R664(3),U,4) W !,RMPRB
"RTN","RMPR4P21",72,0)
HDR1 ;HEADER FOR 10-2421
"RTN","RMPR4P21",73,0)
 W !?17,"15. DESCRIPTION OF ITEMS OR SERVICES AUTHORIZED",!,RMPRB,!,"ITEM NUMBER",?23,"DESCRIPTION",?50,"QUANTITY",?60,"UNIT",?66,"UNIT",?73,"AMOUNT",!,?50,"ORDERED",?66,"PRICE",!,RMPRB Q:$D(RMPRMOR)
"RTN","RMPR4P21",74,0)
 D ^RMPR4P22 D:'$D(RMPRMOR1) CON^RMPR4P22
"RTN","RMPR4P21",75,0)
 S RMPRK=RMPRA
"RTN","RMPR4P21",76,0)
 D:$D(RMPRPRIV) ^RMPR4P23
"RTN","RMPR4P21",77,0)
 W:$G(RMPRPN)=1 @IOF,$$EN^RMPR4P24(RMPRK)
"RTN","RMPR4P21",78,0)
EX ;Common Exit Point
"RTN","RMPR4P21",79,0)
 K VADM,CP,DFN,CAT,DIC,R664,RMPRA,RMPACT,RMPRAD1,RMPRAD2,RMPRAMT,RMPRAMT1,RMPRB,RMPRCAT,RMPRCH,RMPRCITY,RMPRDELD,RMPRI,RMPRI1,RMPRIT,RMPRN,RMPRODTE,RMPRST,RMPRPHON,RMPRT,RMPRTOT,RMPRUT,RMPRV,RMPR90IP,RO,RP,J1,RTN,RMPRMOR1,RMPRPRIV
"RTN","RMPR4P21",80,0)
 K SPE,VA,VAEL,VAPA,VAERR,RZZZ,RX,RX1,RDUZ,RC,RMPRACT,RMPRSCAT,RMPRDISC,RMPRAMTN,DIR,DIRUT,RMPRAMT2,RMPRFOB,RMPRDA,RMPRMOR,RMPRPAGE,RMPRPRIV,RMPRX,RMPR90,J,K,N D ^%ZISC Q
"RTN","RMPR4P22")
0^2^B25413275^B22130893
"RTN","RMPR4P22",1,0)
RMPR4P22 ;PHX/HNC/RVD-CONT PURCHASE CARD ;3/1/1996
"RTN","RMPR4P22",2,0)
 ;;3.0;PROSTHETICS;**3,20,26,90,115,132**;Feb 09, 1996;Build 13
"RTN","RMPR4P22",3,0)
 S RO=0,J2=0 F I=1:1 S RO=$O(R664(1,RO)) Q:RO'>0  D  Q:$D(J1)
"RTN","RMPR4P22",4,0)
 .I I>2 S J1=1 W !!,?9,"***SEE ATTACHED CONTINUATION SHEET FOR ITEM DESCRIPTION(S)***",! Q
"RTN","RMPR4P22",5,0)
 .I $D(R664(1,RO,1,0)) S RP=0 F J=1:1 S RP=$O(R664(1,RO,1,RP)) Q:RP=""  S J2=J2+1 D  Q:$D(J1)
"RTN","RMPR4P22",6,0)
 ..I J2+I>2 S J1=1 W !!,?9,"***SEE ATTACHED CONTINUATION SHEET FOR ITEM DESCRIPTION(S)***",! Q
"RTN","RMPR4P22",7,0)
 .Q:$D(J1)
"RTN","RMPR4P22",8,0)
 .S RMPRCNT=0
"RTN","RMPR4P22",9,0)
 .S RMPRSSM(1)=$P($G(R664(1,RO,0)),U,15)
"RTN","RMPR4P22",10,0)
 .S RMPRSSM(2)=$P($G(R664(1,RO,2)),U,1)
"RTN","RMPR4P22",11,0)
 .S RMPRSSM(3)=$P($G(R664(1,RO,2)),U,2)
"RTN","RMPR4P22",12,0)
 .S RMPRSSM(4)=$P($G(R664(1,RO,2)),U,3)
"RTN","RMPR4P22",13,0)
 .F II=1:1:4 S:RMPRSSM(II)'="" RMPRCNT=RMPRCNT+1
"RTN","RMPR4P22",14,0)
 .K II I J2+I+(RMPRCNT+1\2)>2 S J1=1 W !!,?9,"***SEE ATTACHED CONTINUATION SHEET FOR ITEM DESCRIPTION(S)***",!
"RTN","RMPR4P22",15,0)
 D ADD
"RTN","RMPR4P22",16,0)
 S RO=0 F  S RO=$O(R664(1,RO)) Q:RO'>0  D:'$D(RMPRMOR)&($Y>36) CONT D:$D(RMPRMOR)&($Y>56) CONT D:'$D(RMPRMOR) ADD D START
"RTN","RMPR4P22",17,0)
 I '$D(RMPRMOR)&($Y<37) F  W ! Q:$Y>36
"RTN","RMPR4P22",18,0)
 Q
"RTN","RMPR4P22",19,0)
START W !,"#"_RO_"."
"RTN","RMPR4P22",20,0)
 S RMPRI=$S($P(R664(1,RO,0),U,7)'="":$P(R664(1,RO,0),U,7),1:$P(R664(1,RO,0),U,3))
"RTN","RMPR4P22",21,0)
 W ?4,$P(R664(1,RO,0),U,2)
"RTN","RMPR4P22",22,0)
 W ?50,$J($P(R664(1,RO,0),U,4),6) S RMPRUT=$P(R664(1,RO,0),U,5) W:$D(^PRCD(420.5,+RMPRUT,0)) ?61,$P(^PRCD(420.5,+RMPRUT,0),U,1),?65,$J($FN(RMPRI,"P",2),6)
"RTN","RMPR4P22",23,0)
ZWE S RMPRTOT=RMPRI*$P(R664(1,RO,0),U,4) W ?72,$J($FN(RMPRTOT,"P",2),8) D EXT
"RTN","RMPR4P22",24,0)
 Q
"RTN","RMPR4P22",25,0)
EXT ;CHECKING FOR EXTENDED DESCRIPTION
"RTN","RMPR4P22",26,0)
 ;serial number
"RTN","RMPR4P22",27,0)
 N RMPRCNT,RMPRSSM,LNCT
"RTN","RMPR4P22",28,0)
 S RMPRCNT=0,LNCT=0
"RTN","RMPR4P22",29,0)
 S RMPRSSM(1)=$P($G(R664(1,RO,0)),U,15)
"RTN","RMPR4P22",30,0)
 S RMPRSSM(2)=$P($G(R664(1,RO,2)),U,1)
"RTN","RMPR4P22",31,0)
 S RMPRSSM(3)=$P($G(R664(1,RO,2)),U,2)
"RTN","RMPR4P22",32,0)
 S RMPRSSM(4)=$P($G(R664(1,RO,2)),U,3)
"RTN","RMPR4P22",33,0)
 I RMPRSSM(1)'="" D
"RTN","RMPR4P22",34,0)
 .I LNCT#2=0 D:$D(RMPRMOR)&($Y>56) CONT W !
"RTN","RMPR4P22",35,0)
 .W "    Serial Number: "_RMPRSSM(1) S LNCT=LNCT+1
"RTN","RMPR4P22",36,0)
 I RMPRSSM(4)'="" D
"RTN","RMPR4P22",37,0)
 .I LNCT#2=0 D:$D(RMPRMOR)&($Y>56) CONT W !
"RTN","RMPR4P22",38,0)
 .W "    Lot #: "_RMPRSSM(4) S LNCT=LNCT+1
"RTN","RMPR4P22",39,0)
 I RMPRSSM(3)'="" D
"RTN","RMPR4P22",40,0)
 .I LNCT#2=0 D:$D(RMPRMOR)&($Y>56) CONT W !
"RTN","RMPR4P22",41,0)
 .W "    Model: "_RMPRSSM(3) S LNCT=LNCT+1
"RTN","RMPR4P22",42,0)
 I RMPRSSM(2)'="" D
"RTN","RMPR4P22",43,0)
 .I LNCT#2=0 D:$D(RMPRMOR)&($Y>56) CONT W !
"RTN","RMPR4P22",44,0)
 .W "    Make: "_RMPRSSM(2)
"RTN","RMPR4P22",45,0)
 K RMPRSSM,RMPRCNT,LNCT
"RTN","RMPR4P22",46,0)
 ;
"RTN","RMPR4P22",47,0)
 S RMPRCH=$G(R664(1,RO,1,0))
"RTN","RMPR4P22",48,0)
 I RMPRCH="" Q
"RTN","RMPR4P22",49,0)
 ;S (RMPR90,RMPRX)=$Q(R664(1,RO,0,0))
"RTN","RMPR4P22",50,0)
 ;S RMPRX=$E(RMPRX,1,10)
"RTN","RMPR4P22",51,0)
 ;Q:RMPR90=""
"RTN","RMPR4P22",52,0)
 S RMPR90=0
"RTN","RMPR4P22",53,0)
 F  S RMPR90=$O(R664(1,RO,1,RMPR90)) Q:RMPR90=""  D
"RTN","RMPR4P22",54,0)
 .D:$D(RMPRMOR)&($Y>56) CONT
"RTN","RMPR4P22",55,0)
 .D:'$D(RMPRMOR)&($Y>36) CONT
"RTN","RMPR4P22",56,0)
 .W !,R664(1,RO,1,RMPR90,0)
"RTN","RMPR4P22",57,0)
 ;F  S RMPR90=$Q(@RMPR90) Q:RMPRX'=$E(RMPR90,1,10)  D:$D(RMPRMOR)&($Y>57) CONT D:'$D(RMPRMOR)&($Y>36) CONT
"RTN","RMPR4P22",58,0)
 ;D WRI
"RTN","RMPR4P22",59,0)
 Q
"RTN","RMPR4P22",60,0)
WRI ;CONTINUATION OF 10-2421
"RTN","RMPR4P22",61,0)
 W !,@RMPR90
"RTN","RMPR4P22",62,0)
 Q
"RTN","RMPR4P22",63,0)
CONT D:'$D(RMPRMOR) CON
"RTN","RMPR4P22",64,0)
 I $G(RMPRMOR)=1 W !!,?9,"***CONTINUATION OF PURCHASE CARD ITEMS ON NEXT PAGE***"
"RTN","RMPR4P22",65,0)
 W @IOF,!,"CONTINUATION OF PURCHASE CARD ",?27,"ORDER NUMBER: ",$P($G(^RMPR(664,RMPRA,4)),U,5),?71,"PAGE ",RMPRPAGE S RMPRMOR=1,RMPRPAGE=RMPRPAGE+1 D HDR^RMPR4P21
"RTN","RMPR4P22",66,0)
 Q
"RTN","RMPR4P22",67,0)
ADD S (RMPRAMT2,RMPRAMT,RMPRAMT1,RMPRAMTN)=0
"RTN","RMPR4P22",68,0)
 S RMSHI=$S($P(R664(0),U,11)'="":$P(R664(0),U,11),1:$P(R664(0),U,10))
"RTN","RMPR4P22",69,0)
 S RC=0 F  S RC=$O(R664(1,RC)) Q:RC=""!(RC["B")  S RMPRI=$S($P(R664(1,RC,0),U,7)'="":$P(R664(1,RC,0),U,7),1:$P(R664(1,RC,0),U,3)) D ADD1
"RTN","RMPR4P22",70,0)
 I $D(R664(2)) S RMPRDISC=$S($P(R664(2),U,6)'="":$P(R664(2),U,6),1:"") I $D(RMPRDISC) S RMPRAMT2=$J(RMPRDISC*RMPRAMT/100,0,2),RMPRAMTN=RMPRAMT-$J(RMPRAMT2,0,2),RMPRAMTN=$J(RMPRAMTN+RMSHI,0,2) Q
"RTN","RMPR4P22",71,0)
 Q
"RTN","RMPR4P22",72,0)
ADD1 S RMPRAMT1=$J($P(R664(1,RC,0),U,4)*RMPRI,0,2) S RMPRAMT=RMPRAMT+RMPRAMT1 Q
"RTN","RMPR4P22",73,0)
CON ;CONTINUATION OF 2421
"RTN","RMPR4P22",74,0)
 W !,RMPRB,!,"16. Contract Number: " S RO("C")=$O(R664(1,0)) W:RO("C") $P(R664(1,RO("C"),0),U,14) W ?61,"Subtotal: ",$J($FN(RMPRAMT,"P",2),8)
"RTN","RMPR4P22",75,0)
 W !,"    ACCT.#: ",RMPRVACN K RMPRVACN
"RTN","RMPR4P22",76,0)
 W ?28,"Discount $" I $D(RMPRAMT2) W $J($FN(RMPRAMT2,"P",2),7)
"RTN","RMPR4P22",77,0)
 W ?45,"Shipping: ",$J($FN(RMSHI,"P",2),5)
"RTN","RMPR4P22",78,0)
 W ?62,"Total",?69,"$",$J($FN(RMPRAMTN,"P",2),9)
"RTN","RMPR4P22",79,0)
 W !,RMPRB,!,"17. Signature of"
"RTN","RMPR4P22",80,0)
 W ?28,"18. DATE",?39,"19. Signature and Title of",?70,"20. Date"
"RTN","RMPR4P22",81,0)
 W !,?5,"Requesting Official",?39,"Contracting/Accountable Officer"
"RTN","RMPR4P22",82,0)
 W !!,?5,RDUZ,?39,RMPR("SIG")
"RTN","RMPR4P22",83,0)
 W !,RMPRB,!?25,"Order and Receipt Action",!,RMPRB
"RTN","RMPR4P22",84,0)
 W !,"21. Order Number",?18,"22. Exp Date",?37,"23. Date Item Received",?62,"24. Date Delivered"
"RTN","RMPR4P22",85,0)
 I DUZ=$P(^RMPR(664,RMPRA,0),U,9)!($D(^XUSEC("RMPR FCP MANAGER",DUZ)))  D
"RTN","RMPR4P22",86,0)
 .;W !,"************"
"RTN","RMPR4P22",87,0)
 .N RMPRPRCD
"RTN","RMPR4P22",88,0)
 .S RMPRPRCD=$$DEC^RMPR4LI($P(^RMPR(664,RMPRA,4),U,1),$P(^RMPR(664,RMPRA,0),U,9),RMPRA)
"RTN","RMPR4P22",89,0)
 .;W $E(RMPRPRCD,13,16)
"RTN","RMPR4P22",90,0)
 .W !,RMPRPRCD
"RTN","RMPR4P22",91,0)
 E  W !,?3,"encrypted"
"RTN","RMPR4P22",92,0)
 ;W !,?3,$$DEC^RMPR4LI($P(^RMPR(664,RMPRA,4),U,1),DUZ,RMPRA)
"RTN","RMPR4P22",93,0)
 ;DATE REMOVED
"RTN","RMPR4P22",94,0)
 W !,RMPRB
"RTN","RMPR4P22",95,0)
 W !,"25. The articles or services listed herein have been received, or rendered",!,"ordered in the quantity and quality specified originally or as shown by"
"RTN","RMPR4P22",96,0)
 W !,"authenticated changes, except as noted.",!!?40,"Signature of Veteran or VA Official",!,RMPRB
"RTN","RMPR4P22",97,0)
 ;W !?30,"VOUCHER AUDIT BLOCK (For use by VA Facility only)",!,RMPRB
"RTN","RMPR4P22",98,0)
 ;W !,"Bank Authorization Number: ",$P(^RMPR(664,RMPRA,4),U,2)
"RTN","RMPR4P22",99,0)
 W !,?$X+6,"Acct. Symbol ",$$STA^RMPRUTIL,"-"_$P($G(^RMPR(664,RMPRA,4)),U,5)
"RTN","RMPR4P22",100,0)
 W !,RMPRB,!,?52,"ADP Form 10-2421PC  APR 1991" S RMPRMOR1=1
"RTN","RMPR4P22",101,0)
 Q
"RTN","RMPR5NU")
0^3^B18326517^B17140479
"RTN","RMPR5NU",1,0)
RMPR5NU ;HIN/RVD-PROS INVENTORY SITE PARAMETERS UTILITY ;2/11/98
"RTN","RMPR5NU",2,0)
 ;;3.0;PROSTHETICS;**33,38,52,61,132**;Feb 09, 1996;Build 13
"RTN","RMPR5NU",3,0)
 ;
"RTN","RMPR5NU",4,0)
 ;DBIA #10090 - file #4.
"RTN","RMPR5NU",5,0)
 ; ODJ - patch 52 - 10/17/00 - if a 661.3 record is corrupted with a null
"RTN","RMPR5NU",6,0)
 ;                             HCPC code then put message in report and
"RTN","RMPR5NU",7,0)
 ;                             prevent routine from crashing.
"RTN","RMPR5NU",8,0)
 ;                             (see nois NYH-0900-12030)
"RTN","RMPR5NU",9,0)
 ;
"RTN","RMPR5NU",10,0)
 ; RVD - patch #61 - used new files for inventory balance task job.
"RTN","RMPR5NU",11,0)
 ;
"RTN","RMPR5NU",12,0)
ADD ;add/edit inventory SITE PARAMETER
"RTN","RMPR5NU",13,0)
 S DIC("A")="Select Prosthetics Site Name : "
"RTN","RMPR5NU",14,0)
 S DIR("A")="Would you like to ACTIVATE this Item (Y/N) ",DIC=669.9,DIR(0)="Y"
"RTN","RMPR5NU",15,0)
 S DIC(0)="AEMQ" D ^DIC G:Y'>0 EXIT G:$D(DTOUT) EXIT S DA=+Y
"RTN","RMPR5NU",16,0)
 ;
"RTN","RMPR5NU",17,0)
 ;I $P(^RMPR(661,RMDA,1),U,9)'=1 W !!,$C(7),"*** Item is inactive ***" D ^DIR S:Y=1 $P(^RMPR(661,RMDA,1),U,9)=1 G:Y=0 ADD
"RTN","RMPR5NU",18,0)
 S DIE=DIC,DR="35" D ^DIE
"RTN","RMPR5NU",19,0)
 G ADD
"RTN","RMPR5NU",20,0)
 ;
"RTN","RMPR5NU",21,0)
TASK ;entry point for task job to check balances.
"RTN","RMPR5NU",22,0)
 K ^TMP($J)
"RTN","RMPR5NU",23,0)
 S IO=0
"RTN","RMPR5NU",24,0)
 S Y=DT D DD^%DT S RMRDAT=Y
"RTN","RMPR5NU",25,0)
 S RMERR=$$MES^RMPRPIUD("")
"RTN","RMPR5NU",26,0)
 ;a TMP($J global created for mail message.
"RTN","RMPR5NU",27,0)
 Q:$G(RMERR)
"RTN","RMPR5NU",28,0)
 D PROC S RMSUBI=5
"RTN","RMPR5NU",29,0)
 I $D(^TMP($J,"RMX")) D BUILD
"RTN","RMPR5NU",30,0)
MAIL D:$D(^XMB(3.8,"B","RMPR INVENTORY")) MES1,MES2
"RTN","RMPR5NU",31,0)
 ;set Notification Date in file #669.9
"RTN","RMPR5NU",32,0)
 S RS=0
"RTN","RMPR5NU",33,0)
 F  S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  S $P(^RMPR(669.9,RS,"INV"),U,3)=DT
"RTN","RMPR5NU",34,0)
 ;D WRI ;for printing to a designated inventory printer.
"RTN","RMPR5NU",35,0)
 G EXIT
"RTN","RMPR5NU",36,0)
 ;
"RTN","RMPR5NU",37,0)
PROC ;process
"RTN","RMPR5NU",38,0)
 F I=0:0 S I=$O(^TMP($J,"RMPRPIUD",I)) Q:I'>0  S J="" F  S J=$O(^TMP($J,"RMPRPIUD",I,J)) Q:J=""  F K=0:0 S K=$O(^TMP($J,"RMPRPIUD",I,J,K)) Q:K'>0  D
"RTN","RMPR5NU",39,0)
 .F L=0:0 S L=$O(^TMP($J,"RMPRPIUD",I,J,K,"L",L)) Q:L'>0  D
"RTN","RMPR5NU",40,0)
 ..S RMDATA=$G(^TMP($J,"RMPRPIUD",I,J,K,"L",L))
"RTN","RMPR5NU",41,0)
 ..S RMREOR=$P(RMDATA,U,1)
"RTN","RMPR5NU",42,0)
 ..S RMQUAN=$P(RMDATA,U,2) I RMQUAN="" S RMQUAN=0
"RTN","RMPR5NU",43,0)
 ..I RMREOR>RMQUAN D
"RTN","RMPR5NU",44,0)
 ...S RM11=$O(^RMPR(661.11,"ASHI",I,J,K,0))
"RTN","RMPR5NU",45,0)
 ...S RMITEM="xxxx"
"RTN","RMPR5NU",46,0)
 ...I RM11,$D(^RMPR(661.11,RM11,0)) Q:$P(^RMPR(661.11,RM11,0),U,9)  S RMITEM=$P(^RMPR(661.11,RM11,0),U,3)
"RTN","RMPR5NU",47,0)
 ...S RML="****"
"RTN","RMPR5NU",48,0)
 ...I L,$D(^RMPR(661.5,L,0)) S RML=$P(^RMPR(661.5,L,0),U,1)
"RTN","RMPR5NU",49,0)
 ...S ^TMP($J,"RMX",I,RML,RMITEM)=RMITEM_"^"_RMREOR_"^"_RMQUAN_"^"_J_"-"_K
"RTN","RMPR5NU",50,0)
 ...I $D(^TMP($J,"RMPRPIUD",I,J,K,"M")) D
"RTN","RMPR5NU",51,0)
 ....F RMI=0:0 S RMI=$O(^TMP($J,"RMPRPIUD",I,J,K,"M",RMI)) Q:RMI'>0  D
"RTN","RMPR5NU",52,0)
 .....S RMLEFT=0
"RTN","RMPR5NU",53,0)
 .....F RMJ=0:0 S RMJ=$O(^TMP($J,"RMPRPIUD",I,J,K,"M",RMI,RMJ)) Q:RMJ'>0  S RM41=^TMP($J,"RMPRPIUD",I,J,K,"M",RMI,RMJ) D
"RTN","RMPR5NU",54,0)
 ......S RMORD=$P(RM41,U,1)
"RTN","RMPR5NU",55,0)
 ......S RMDATO=$P(RM41,U,2),RMRECV=$P(RM41,U,3),RMWDS=""
"RTN","RMPR5NU",56,0)
 ......S:RMRECV RMWDS="  ...received to-date: "_RMRECV
"RTN","RMPR5NU",57,0)
 ......;S RMLEF=RMORD-RMREC
"RTN","RMPR5NU",58,0)
 ......;I $G(RMLEF) S RMLEFT=RMLEFT+RMLEF
"RTN","RMPR5NU",59,0)
 ......I $G(RMORD) S ^TMP($J,"RMX",I,RML,RMITEM,"M",RMJ)="   **** Quantity = "_RMORD_" has been ordered for item..."_RMITEM_" on "_RMDATO_RMWDS
"RTN","RMPR5NU",60,0)
 ;
"RTN","RMPR5NU",61,0)
 Q
"RTN","RMPR5NU",62,0)
MES1 ;
"RTN","RMPR5NU",63,0)
 S XMY("G.RMPR INVENTORY")="",XMDUZ=.5,XMTEXT="RMX("
"RTN","RMPR5NU",64,0)
 S XMSUB="PROSTHETICS INVENTORY MESSAGE"
"RTN","RMPR5NU",65,0)
 S RMX(1)="Run Date: "_RMRDAT
"RTN","RMPR5NU",66,0)
 S RMX(2)="This is a notification from the Prosthetics Department........"
"RTN","RMPR5NU",67,0)
 S RMX(3)=""
"RTN","RMPR5NU",68,0)
 S RMX(4)="The current balance for the following item(s) is/are below the reorder level:"
"RTN","RMPR5NU",69,0)
 S RMX(5)="[Site] [Location]       [Item]                      [HCPCS] [Reorder Lvl] [Bal] "
"RTN","RMPR5NU",70,0)
 Q
"RTN","RMPR5NU",71,0)
MES2 ;
"RTN","RMPR5NU",72,0)
 S RMX(RMSUBI+2)=""
"RTN","RMPR5NU",73,0)
 S RMX(RMSUBI+3)=""
"RTN","RMPR5NU",74,0)
 S RMX(RMSUBI+4)="Thank You!!!"
"RTN","RMPR5NU",75,0)
 S RMX(RMSUBI+5)=""
"RTN","RMPR5NU",76,0)
 S RMX(RMSUBI+6)="PROSTHETICS DEPARTMENT"
"RTN","RMPR5NU",77,0)
 D ^XMD
"RTN","RMPR5NU",78,0)
 Q
"RTN","RMPR5NU",79,0)
 ;
"RTN","RMPR5NU",80,0)
BUILD S I=""
"RTN","RMPR5NU",81,0)
 F  S I=$O(^TMP($J,"RMX",I)) Q:I=""  S J="" F  S J=$O(^TMP($J,"RMX",I,J)) Q:J=""  S K="" F  S K=$O(^TMP($J,"RMX",I,J,K)) Q:K=""  S RM0=^TMP($J,"RMX",I,J,K) D
"RTN","RMPR5NU",82,0)
 .S RML=$P(RM0,U,2),RMB=$P(RM0,U,3),RMSTA=I,RMLO=J,RMITEM=K,RMHCPC=$P(RM0,U,4)_"  "
"RTN","RMPR5NU",83,0)
 .S RMITEM=RMITEM_"                             "
"RTN","RMPR5NU",84,0)
 .S RMSUBI=RMSUBI+1,RMLO=RMLO_"                    "
"RTN","RMPR5NU",85,0)
 .S RMX(RMSUBI)=$E($P(^DIC(4,RMSTA,0),U,1),1,6)_" "_$E(RMLO,1,16)_" "_$E(RMITEM,1,28)_" "_$E(RMHCPC,1,9)_" "_$J(RML,5)_"      "_$J(RMB,5)
"RTN","RMPR5NU",86,0)
 .;S RMXI(RMSUBI)=RMX(RMSUBI)_"^"_I_"^"_J_"^"_K
"RTN","RMPR5NU",87,0)
 .I $D(^TMP($J,"RMX",I,J,K,"M")) D
"RTN","RMPR5NU",88,0)
 ..S RMJ=0
"RTN","RMPR5NU",89,0)
 ..F  S RMJ=$O(^TMP($J,"RMX",I,J,K,"M",RMJ)) Q:RMJ=""  D
"RTN","RMPR5NU",90,0)
 ...S RMSUBI=RMSUBI+1,RMX(RMSUBI)=^TMP($J,"RMX",I,J,K,"M",RMJ)
"RTN","RMPR5NU",91,0)
 Q
"RTN","RMPR5NU",92,0)
 ;
"RTN","RMPR5NU",93,0)
WRI ;PRINT NOTIFICATION LETTER IN SUPPLY PRINTER. This functionality is not included with this released.
"RTN","RMPR5NU",94,0)
 ;S RMDEV=$P(^RMPR(669.9,RS,"INV"),U,1)
"RTN","RMPR5NU",95,0)
 ;S RMIOS=IO,IO=$P(^%ZIS(1,RMDEV,0),U,2)
"RTN","RMPR5NU",96,0)
 ;D NOW^%DTC
"RTN","RMPR5NU",97,0)
 ;O IO U IO W !,"Run Date: ",RMRDAT,!!,"This is a notification from the Prosthetics Department..."
"RTN","RMPR5NU",98,0)
 ;W !!,"The current balance for the following item(s) is/are below the reorder level:"
"RTN","RMPR5NU",99,0)
 ;W !,"[Location]        [Item]              [HCPCS] [Reorder Level] [Current Balance]"
"RTN","RMPR5NU",100,0)
 ;F I=0:0 S I=$O(RMXI(I)) Q:I'>0  D
"RTN","RMPR5NU",101,0)
 ;.S RMLO=$P(RMXI(I),U,2),RMI=$P(RMXI(I),U,3)
"RTN","RMPR5NU",102,0)
 ;.W !,$P(RMXI(I),U,1)
"RTN","RMPR5NU",103,0)
 ;.S $P(^RMPR(661.3,RMLO,1,RMI,0),U,7)=%
"RTN","RMPR5NU",104,0)
 ;W !!!,"Thank You!!!!!"
"RTN","RMPR5NU",105,0)
 ;W !!,"PROSTHETICS DEPARTMENT"
"RTN","RMPR5NU",106,0)
 ;S $P(^RMPR(669.9,RS,"INV"),U,3)=DT
"RTN","RMPR5NU",107,0)
 ;D ^%ZISC S IO=RMIOS O IO U IO
"RTN","RMPR5NU",108,0)
 ;K RMB,RMD,RMI,RML,RMDO,RMDATI,RMLOCI,RMXI,I,J,XMTEXT,RMGROUP,RMHCPC
"RTN","RMPR5NU",109,0)
 ;Q
"RTN","RMPR5NU",110,0)
 ;
"RTN","RMPR5NU",111,0)
EXIT ;MAIN EXIT POINT
"RTN","RMPR5NU",112,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPR5NU",113,0)
 K ^TMP($J)
"RTN","RMPR5NU",114,0)
 Q
"RTN","RMPRPI09")
0^6^B34634157^B30171234
"RTN","RMPRPI09",1,0)
RMPRPI09 ;HIN/RVD-PRINT ORDER AND RECIEVE ITEM REPORT ;9/18/02  15:13
"RTN","RMPRPI09",2,0)
 ;;3.0;PROSTHETICS;**61,132**;Feb 09, 1996;Build 13
"RTN","RMPRPI09",3,0)
 ;
"RTN","RMPRPI09",4,0)
 ;DBIA #800 - global read of file #440.
"RTN","RMPRPI09",5,0)
 ;
"RTN","RMPRPI09",6,0)
 D DIV4^RMPRSIT I $D(Y),(Y<0) Q
"RTN","RMPRPI09",7,0)
 S X="NOW" D ^%DT D DD^%DT S RMDAT=Y
"RTN","RMPRPI09",8,0)
 ;
"RTN","RMPRPI09",9,0)
EN K RMPRI S RMPREND=0 D HOME^%ZIS
"RTN","RMPRPI09",10,0)
 ;
"RTN","RMPRPI09",11,0)
TYPE ;select type of report
"RTN","RMPRPI09",12,0)
 K DIR
"RTN","RMPRPI09",13,0)
 S DIR(0)="S^1:30 Days Old or Less;2:60 Days Old or Less;3:90 Days Old or Less;4:Over 90 Days Old or Less "
"RTN","RMPRPI09",14,0)
 S DIR("A")="Select number of days old",DIR("B")="30 Days Old or Less"
"RTN","RMPRPI09",15,0)
 D ^DIR
"RTN","RMPRPI09",16,0)
 I Y="",$D(DTOUT) G EXIT1
"RTN","RMPRPI09",17,0)
 I Y="^"!(Y="^^") G EXIT1
"RTN","RMPRPI09",18,0)
 S RMTY=Y
"RTN","RMPRPI09",19,0)
 ;
"RTN","RMPRPI09",20,0)
 ;
"RTN","RMPRPI09",21,0)
CAT ;select STATUS of report
"RTN","RMPRPI09",22,0)
 K DIR
"RTN","RMPRPI09",23,0)
 S DIR(0)="S^O:OPEN;R:RECIEVED;C:CANCEL"
"RTN","RMPRPI09",24,0)
 S DIR("A")="Select Category of report",DIR("B")="OPEN"
"RTN","RMPRPI09",25,0)
 D ^DIR
"RTN","RMPRPI09",26,0)
 I Y="",$D(DTOUT) G EXIT1
"RTN","RMPRPI09",27,0)
 I Y="^"!(Y="^^") G EXIT1
"RTN","RMPRPI09",28,0)
 S RMCAT=Y
"RTN","RMPRPI09",29,0)
 K DIR
"RTN","RMPRPI09",30,0)
 ;
"RTN","RMPRPI09",31,0)
DT ;
"RTN","RMPRPI09",32,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT1
"RTN","RMPRPI09",33,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRPI09",34,0)
 K IO("Q") S ZTDESC="PIP ORDER AND RECEIVE ITEM REPORT"
"RTN","RMPRPI09",35,0)
 S ZTRTN="PRINT^RMPRPI09",ZTIO=ION,ZTSAVE("RMPR(")=""
"RTN","RMPRPI09",36,0)
 S ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMDAT")=""
"RTN","RMPRPI09",37,0)
 S ZTSAVE("RMTY")="",ZTSAVE("RMDRA")="",ZTSAVE("RMCAT")=""
"RTN","RMPRPI09",38,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT1
"RTN","RMPRPI09",39,0)
 ;
"RTN","RMPRPI09",40,0)
PRINT I $E(IOST)["C" W !!,"Processing report....."
"RTN","RMPRPI09",41,0)
 K RMPRT,RMPRFLG,^TMP($J)
"RTN","RMPRPI09",42,0)
 S RMCAL=$S(RMTY=1:30,RMTY=2:60,RMTY=3:90,RMTY=4:"OVER 90")
"RTN","RMPRPI09",43,0)
 S X="T-"_RMCAL D ^%DT S RDT=Y-1 K Y S:'RDT RDT=0
"RTN","RMPRPI09",44,0)
 S RMCAY=$S(RMCAT="O":"OPEN",RMCAT="R":"RECIEVED",RMCAT="C":"CANCEL")
"RTN","RMPRPI09",45,0)
 S RS=RMPR("STA")
"RTN","RMPRPI09",46,0)
 S RMPAGE=1,RMPREND=0
"RTN","RMPRPI09",47,0)
 W:$E(IOST)["C" @IOF
"RTN","RMPRPI09",48,0)
 D HEAD
"RTN","RMPRPI09",49,0)
 G:RMCAT="R" REC
"RTN","RMPRPI09",50,0)
 ;
"RTN","RMPRPI09",51,0)
OPCA ;for open and cancel order
"RTN","RMPRPI09",52,0)
 S RI=""
"RTN","RMPRPI09",53,0)
 F STS=RMCAT,"R" Q:STS="R"&(RMCAT="C")  F  S RI=$O(^RMPR(661.41,"ASSHID",RS,STS,RI)) Q:RI=""!RMPREND=1  F RK=0:0 S RK=$O(^RMPR(661.41,"ASSHID",RS,STS,RI,RK)) Q:RK'>0!RMPREND=1  D
"RTN","RMPRPI09",54,0)
 .F RM=RDT:0 S RM=$O(^RMPR(661.41,"ASSHID",RS,STS,RI,RK,RM)) Q:RM'>0!RMPREND=1  D
"RTN","RMPRPI09",55,0)
 ..F RN=0:0 S RN=$O(^RMPR(661.41,"ASSHID",RS,STS,RI,RK,RM,RN)) Q:RN'>0!RMPREND=1  D
"RTN","RMPRPI09",56,0)
 ...S RM3=$G(^RMPR(661.41,RN,0))
"RTN","RMPRPI09",57,0)
 ...I $P(RM3,U,8)-$P(RM3,U,9)<1 Q
"RTN","RMPRPI09",58,0)
 ...S ^TMP($J,"RMPRPI09",RS,RMCAT,RI,RK,RM,RN)=""
"RTN","RMPRPI09",59,0)
 ...Q
"RTN","RMPRPI09",60,0)
 S RI=""
"RTN","RMPRPI09",61,0)
 F  S RI=$O(^TMP($J,"RMPRPI09",RS,RMCAT,RI)) Q:RI=""!RMPREND=1  F RK=0:0 S RK=$O(^TMP($J,"RMPRPI09",RS,RMCAT,RI,RK)) Q:RK'>0!RMPREND=1  D
"RTN","RMPRPI09",62,0)
 .F RM=RDT:0 S RM=$O(^TMP($J,"RMPRPI09",RS,RMCAT,RI,RK,RM)) Q:RM'>0!RMPREND=1  D
"RTN","RMPRPI09",63,0)
 ..F RN=0:0 S RN=$O(^TMP($J,"RMPRPI09",RS,RMCAT,RI,RK,RM,RN)) Q:RN'>0!RMPREND=1  D
"RTN","RMPRPI09",64,0)
 ...S RM3=$G(^RMPR(661.41,RN,0))
"RTN","RMPRPI09",65,0)
 ...S (RMVNAM,RMIDE)=""
"RTN","RMPRPI09",66,0)
 ...S RMDOR=$P(RM3,U,1)
"RTN","RMPRPI09",67,0)
 ...S RMIT=$P(RM3,U,2)
"RTN","RMPRPI09",68,0)
 ...S RMVEN=$P(RM3,U,5)
"RTN","RMPRPI09",69,0)
 ...S RMHCPC=$P(RM3,U,6)
"RTN","RMPRPI09",70,0)
 ...S RMDRE=$P(RM3,U,7)
"RTN","RMPRPI09",71,0)
 ...S RMQOR=$P(RM3,U,8)
"RTN","RMPRPI09",72,0)
 ...S RMQRE=$P(RM3,U,9)
"RTN","RMPRPI09",73,0)
 ...S RMCOM=$P(RM3,U,10)
"RTN","RMPRPI09",74,0)
 ...S RMSTA=$P(RM3,U,11)
"RTN","RMPRPI09",75,0)
 ...I '$D(RMPRFLG) D HEAD1
"RTN","RMPRPI09",76,0)
 ...S:RMDOR RMDOR=$E(RMDOR,4,5)_"/"_$E(RMDOR,6,7)_"/"_$E(RMDOR,2,3)
"RTN","RMPRPI09",77,0)
 ...S:RMDRE RMDRE=$E(RMDRE,4,5)_"/"_$E(RMDRE,6,7)_"/"_$E(RMDRE,2,3)
"RTN","RMPRPI09",78,0)
 ...S:RMVEN RMVNAM=$P($G(^PRC(440,RMVEN,0)),U,1)
"RTN","RMPRPI09",79,0)
 ...S RMIDA=$O(^RMPR(661.11,"ASHI",RS,RMHCPC,RMIT,0))
"RTN","RMPRPI09",80,0)
 ...S:RMIDA RMIDE=$P($G(^RMPR(661.11,RMIDA,0)),U,3)
"RTN","RMPRPI09",81,0)
 ...W !,RMHCPC_"-"_RMIT,?10,$E(RMIDE,1,20),?31,$E(RMVNAM,1,11),?44,RMDOR,?54,RMDRE,?64,$J(RMQOR,6),?72,$J(RMQRE,6)
"RTN","RMPRPI09",82,0)
 ...W:RMCOM'="" !,?5,"Comment: ",RMCOM
"RTN","RMPRPI09",83,0)
 ...S (RMPRFLG,RMPRT)=1
"RTN","RMPRPI09",84,0)
 ...I $E(IOST)["C",($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD,HEAD1 Q
"RTN","RMPRPI09",85,0)
 ...I $Y>(IOSL-6) W @IOF D HEAD,HEAD1 Q
"RTN","RMPRPI09",86,0)
 W:$G(RMPRT) !,RMPR("L"),!,"<End of Report>"
"RTN","RMPRPI09",87,0)
 G EXIT
"RTN","RMPRPI09",88,0)
 ;
"RTN","RMPRPI09",89,0)
REC ;process a Recieved order.
"RTN","RMPRPI09",90,0)
 S RI=""
"RTN","RMPRPI09",91,0)
 F  S RI=$O(^RMPR(661.6,"ASTHIDS",RS,1,RI)) Q:RI=""!RMPREND=1  F RK=0:0 S RK=$O(^RMPR(661.6,"ASTHIDS",RS,1,RI,RK)) Q:RK'>0!RMPREND=1  D
"RTN","RMPRPI09",92,0)
 .F RM=RDT:0 S RM=$O(^RMPR(661.6,"ASTHIDS",RS,1,RI,RK,RM)) Q:RM'>0!RMPREND=1  D
"RTN","RMPRPI09",93,0)
 ..F RN=0:0 S RN=$O(^RMPR(661.6,"ASTHIDS",RS,1,RI,RK,RM,RN)) Q:RN'>0!RMPREND=1  F RP=0:0 S RP=$O(^RMPR(661.6,"ASTHIDS",RS,1,RI,RK,RM,RN,RP)) Q:RP'>0!RMPREND=1  D
"RTN","RMPRPI09",94,0)
 ...S RM3=$G(^RMPR(661.6,RP,0))
"RTN","RMPRPI09",95,0)
 ...S (RMVNAM,RMIDE)=""
"RTN","RMPRPI09",96,0)
 ...S RMDOR=$P(RM3,U,1)
"RTN","RMPRPI09",97,0)
 ...S RMIT=RK
"RTN","RMPRPI09",98,0)
 ...S RMVEN=$P(RM3,U,12)
"RTN","RMPRPI09",99,0)
 ...S RMHCPC=RI
"RTN","RMPRPI09",100,0)
 ...S RMDRE=RM
"RTN","RMPRPI09",101,0)
 ...S RMQOR=""
"RTN","RMPRPI09",102,0)
 ...S RMQRE=$P(RM3,U,5)
"RTN","RMPRPI09",103,0)
 ...S RMCOM=$P(RM3,U,8)
"RTN","RMPRPI09",104,0)
 ...S RMSTA=RS
"RTN","RMPRPI09",105,0)
 ...I '$D(RMPRFLG) D HEAD1
"RTN","RMPRPI09",106,0)
 ...;S:RMDOR RMDOR=$E(RMDOR,4,5)_"/"_$E(RMDOR,6,7)_"/"_$E(RMDOR,2,3)
"RTN","RMPRPI09",107,0)
 ...S:RMDRE RMDRE=$E(RMDRE,4,5)_"/"_$E(RMDRE,6,7)_"/"_$E(RMDRE,2,3)
"RTN","RMPRPI09",108,0)
 ...S:RMVEN RMVNAM=$P($G(^PRC(440,RMVEN,0)),U,1)
"RTN","RMPRPI09",109,0)
 ...S RMIDA=$O(^RMPR(661.11,"ASHI",RS,RMHCPC,RMIT,0))
"RTN","RMPRPI09",110,0)
 ...S:RMIDA RMIDE=$P($G(^RMPR(661.11,RMIDA,0)),U,3)
"RTN","RMPRPI09",111,0)
 ...W !,RMHCPC_"-"_RMIT,?10,$E(RMIDE,1,20),?31,$E(RMVNAM,1,11),?54,RMDRE,?64,$J(RMQOR,6),?72,$J(RMQRE,6)
"RTN","RMPRPI09",112,0)
 ...W:RMCOM'="" !,?5,"Comment: ",RMCOM
"RTN","RMPRPI09",113,0)
 ...S (RMPRFLG,RMPRT)=1
"RTN","RMPRPI09",114,0)
 ...I $E(IOST)["C",($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD,HEAD1 Q
"RTN","RMPRPI09",115,0)
 ...I $Y>(IOSL-6) W @IOF D HEAD,HEAD1 Q
"RTN","RMPRPI09",116,0)
 W:$G(RMPRT) !,RMPR("L"),!,"<End of Report>"
"RTN","RMPRPI09",117,0)
 G EXIT
"RTN","RMPRPI09",118,0)
 ;
"RTN","RMPRPI09",119,0)
HEAD W !,"*** PIP ORDER AND RECEIVE ITEM REPORT ***"," for ",RMCAL," days old or Less,  ",RMCAY," order"
"RTN","RMPRPI09",120,0)
 W !,"Station: ",$E($P($G(^DIC(4,RS,0)),U,1),1,20),?30,"Run Date: ",RMDAT
"RTN","RMPRPI09",121,0)
 W ?68,"PAGE: ",RMPAGE
"RTN","RMPRPI09",122,0)
 S RMPAGE=RMPAGE+1
"RTN","RMPRPI09",123,0)
 Q
"RTN","RMPRPI09",124,0)
 ;
"RTN","RMPRPI09",125,0)
HEAD1 I $E(IOST)["C",($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD
"RTN","RMPRPI09",126,0)
 I $E(IOST)'["C",($Y>(IOSL-6)) W @IOF D HEAD
"RTN","RMPRPI09",127,0)
 W !,RMPR("L")
"RTN","RMPRPI09",128,0)
 W !,?45,"DATE",?56,"DATE",?66,"QTY",?75,"QTY"
"RTN","RMPRPI09",129,0)
 W !,"HCPCS",?10,"ITEM",?31,"VENDOR",?44,"ORDERED",?54,"RECIEVED"
"RTN","RMPRPI09",130,0)
 W ?64,"ORDERED",?72,"RECIEVED"
"RTN","RMPRPI09",131,0)
 W !,"-----",?10,"----",?31,"------",?44,"-------",?54,"--------"
"RTN","RMPRPI09",132,0)
 W ?64,"-------",?72,"--------"
"RTN","RMPRPI09",133,0)
 S RMPRFLG=1
"RTN","RMPRPI09",134,0)
 Q
"RTN","RMPRPI09",135,0)
 ;
"RTN","RMPRPI09",136,0)
EXIT W:'$G(RMPRT) !,RMPR("L"),!!,"No DATA to print !!!"
"RTN","RMPRPI09",137,0)
 I $E(IOST)["C",'RMPREND W ! S DIR(0)="E" D ^DIR
"RTN","RMPRPI09",138,0)
 ;
"RTN","RMPRPI09",139,0)
EXIT1 D ^%ZISC
"RTN","RMPRPI09",140,0)
 K ^TMP($J)
"RTN","RMPRPI09",141,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPRPI09",142,0)
 Q
"RTN","RMPRPIUD")
0^4^B12700187^B12009714
"RTN","RMPRPIUD",1,0)
RMPRPIUD ;HINCIO/ODJ - 661.4 APIs ;3/8/01
"RTN","RMPRPIUD",2,0)
 ;;3.0;PROSTHETICS;**61,132**;Feb 09, 1996;Build 13
"RTN","RMPRPIUD",3,0)
 Q
"RTN","RMPRPIUD",4,0)
 ;
"RTN","RMPRPIUD",5,0)
 ; LEV - check re-order level for Station, Location, HCPCS Item
"RTN","RMPRPIUD",6,0)
LEV(RMPR) ;
"RTN","RMPRPIUD",7,0)
 N RMPRERR
"RTN","RMPRPIUD",8,0)
 S RMPRERR=0
"RTN","RMPRPIUD",9,0)
LEVX Q RMPRERR
"RTN","RMPRPIUD",10,0)
 ;
"RTN","RMPRPIUD",11,0)
 ; MES - generate MailMan message if item below re-order level
"RTN","RMPRPIUD",12,0)
 ;       at a given location.
"RTN","RMPRPIUD",13,0)
 ;       this version uses the same business rules as the old
"RTN","RMPRPIUD",14,0)
 ;       PIP routine RMPR5NU
"RTN","RMPRPIUD",15,0)
 ;
"RTN","RMPRPIUD",16,0)
 ; Inputs:
"RTN","RMPRPIUD",17,0)
 ;    XMY
"RTN","RMPRPIUD",18,0)
MES(XMY) ;
"RTN","RMPRPIUD",19,0)
 N RMPRERR,RMPRLINE,RMPRNM,RMPRGBL,RMPRSTR,RMPROBAL,RMPRLEV,RMPRQOH
"RTN","RMPRPIUD",20,0)
 N XMSUB,XMDUZ,XMZ,RMPRTXT,RMPR5,RMPR11,RMPRORQ,X,Y,DA
"RTN","RMPRPIUD",21,0)
 S RMPRERR=0
"RTN","RMPRPIUD",22,0)
 S RMPRNM="RMPRPIUD"
"RTN","RMPRPIUD",23,0)
 K ^TMP($J,RMPRNM)
"RTN","RMPRPIUD",24,0)
 S RMPRERR=$$ALL(RMPRNM)
"RTN","RMPRPIUD",25,0)
MESX Q RMPRERR
"RTN","RMPRPIUD",26,0)
 ;
"RTN","RMPRPIUD",27,0)
 ; Generate reorder notification for all Stations
"RTN","RMPRPIUD",28,0)
ALL(RMPRNM) ;
"RTN","RMPRPIUD",29,0)
 N RMPRSTN,RMPRERR,I,J,RMITEM,RMLOC,RMQUA,RMSTN
"RTN","RMPRPIUD",30,0)
 S RMPRERR=0
"RTN","RMPRPIUD",31,0)
 I $G(RMPRNM)="" S RMPRNM="ALL-RMPRPIUD"
"RTN","RMPRPIUD",32,0)
 S (I,RMPRSTN)=""
"RTN","RMPRPIUD",33,0)
 ;get current inventory from 661.7 for all HCPCS
"RTN","RMPRPIUD",34,0)
 F  S I=$O(^RMPR(661.7,"B",I)) Q:I=""  F J=0:0 S J=$O(^RMPR(661.7,"B",I,J)) Q:J'>0  D
"RTN","RMPRPIUD",35,0)
 .I $D(^RMPR(661.7,J,0)) S RMD7=^RMPR(661.7,J,0) D
"RTN","RMPRPIUD",36,0)
 ..S RMITEM=$P(RMD7,U,4),RMLOC=$P(RMD7,U,6),RMSTN=$P(RMD7,U,5)
"RTN","RMPRPIUD",37,0)
 ..S RMQUA=$P(RMD7,U,7)
"RTN","RMPRPIUD",38,0)
 ..I $D(^TMP($J,RMPRNM,RMSTN,I,RMITEM,"L",RMLOC)) S $P(^TMP($J,RMPRNM,RMSTN,I,RMITEM,"L",RMLOC),U,2)=$P(^TMP($J,RMPRNM,RMSTN,I,RMITEM,"L",RMLOC),U,2)+RMQUA
"RTN","RMPRPIUD",39,0)
 ..E  S $P(^TMP($J,RMPRNM,RMSTN,I,RMITEM,"L",RMLOC),U,2)=RMQUA
"RTN","RMPRPIUD",40,0)
 ;get reorder level for all HCPCS
"RTN","RMPRPIUD",41,0)
 F  S RMPRSTN=$O(^RMPR(661.4,"XSHIL",RMPRSTN)) Q:RMPRSTN=""  D
"RTN","RMPRPIUD",42,0)
 . S RMPRERR=$$STN(RMPRNM,RMPRSTN)
"RTN","RMPRPIUD",43,0)
 . Q
"RTN","RMPRPIUD",44,0)
ALLX Q RMPRERR
"RTN","RMPRPIUD",45,0)
 ;
"RTN","RMPRPIUD",46,0)
 ; Generate reorder/order position for single Station
"RTN","RMPRPIUD",47,0)
STN(RMPRNM,RMPRSTN) ;
"RTN","RMPRPIUD",48,0)
 N RMPRERR,RMPRH,RMPRI,RMPRL,RMPRK,RMPROLD,RMPREOF,RMPRQFOR,RMPR7E
"RTN","RMPRPIUD",49,0)
 N RMPR7I,RMPRTQOH,RMPRTORQ,RMPRTREO,RMPRD,RMPR11,RMPR41,RMPRIEN,RML,RME
"RTN","RMPRPIUD",50,0)
 N RMDATA,RMREQUAN
"RTN","RMPRPIUD",51,0)
 S RMPRERR=0
"RTN","RMPRPIUD",52,0)
 I $G(RMPRNM)="" S RMPRNM="STN-RMPRPIUD"
"RTN","RMPRPIUD",53,0)
 S RMPRH=""
"RTN","RMPRPIUD",54,0)
 F  S RMPRH=$O(^RMPR(661.4,"XSHIL",RMPRSTN,RMPRH)) Q:RMPRH=""  D
"RTN","RMPRPIUD",55,0)
 . F RMPRI=0:0 S RMPRI=$O(^RMPR(661.4,"XSHIL",RMPRSTN,RMPRH,RMPRI)) Q:RMPRI'>0  D
"RTN","RMPRPIUD",56,0)
 .. ;set initial balance of re-order quantity
"RTN","RMPRPIUD",57,0)
 .. F RML=0:0 S RML=$O(^RMPR(661.4,"XSHIL",RMPRSTN,RMPRH,RMPRI,RML)) Q:RML'>0  D
"RTN","RMPRPIUD",58,0)
 ... F RME=0:0 S RME=$O(^RMPR(661.4,"XSHIL",RMPRSTN,RMPRH,RMPRI,RML,RME)) Q:RME'>0  D
"RTN","RMPRPIUD",59,0)
 .... I RME,$D(^RMPR(661.4,RME,0)) S RMDATA=$G(^RMPR(661.4,RME,0))
"RTN","RMPRPIUD",60,0)
 .... S RMREQUAN=$P(RMDATA,U,4) Q:'$G(RMREQUAN)
"RTN","RMPRPIUD",61,0)
 .... S $P(^TMP($J,RMPRNM,RMPRSTN,RMPRH,RMPRI,"L",RML),U,1)=$G(RMREQUAN)
"RTN","RMPRPIUD",62,0)
 .. ;
"RTN","RMPRPIUD",63,0)
 .. ; Loop on open orders
"RTN","RMPRPIUD",64,0)
 .. F STS="O","R" S RMPRD="" F  S RMPRD=$O(^RMPR(661.41,"ASSHID",RMPRSTN,STS,RMPRH,RMPRI,RMPRD)) Q:RMPRD=""  D  Q:RMPRERR
"RTN","RMPRPIUD",65,0)
 ... S RMPRIEN=""
"RTN","RMPRPIUD",66,0)
 ... F  S RMPRIEN=$O(^RMPR(661.41,"ASSHID",RMPRSTN,STS,RMPRH,RMPRI,RMPRD,RMPRIEN)) Q:RMPRIEN=""  D  Q:RMPRERR
"RTN","RMPRPIUD",67,0)
 .... K RMPR41 S RMPR41("IEN")=RMPRIEN
"RTN","RMPRPIUD",68,0)
 .... S RMPRERR=$$GET^RMPRPIXN(.RMPR41,)
"RTN","RMPRPIUD",69,0)
 .... I RMPRERR S RMPRERR=99 Q
"RTN","RMPRPIUD",70,0)
 .... I RMPR41("BALANCE QTY")<1 Q
"RTN","RMPRPIUD",71,0)
 .... S ^TMP($J,RMPRNM,RMPRSTN,RMPRH,RMPRI,"M",RMPRD,RMPRIEN)=RMPR41("ORDER QTY")_"^"_RMPR41("DATE ORDER")_"^"_RMPR41("RECEIVE QTY")
"RTN","RMPRPIUD",72,0)
 .... Q
"RTN","RMPRPIUD",73,0)
 ... Q
"RTN","RMPRPIUD",74,0)
 .. Q
"RTN","RMPRPIUD",75,0)
 . Q
"RTN","RMPRPIUD",76,0)
STNX Q RMPRERR
"RTN","RMPRPIYG")
0^7^B51597493^B51586715
"RTN","RMPRPIYG",1,0)
RMPRPIYG ;HINCIO/ODJ - RC - PIP Receive Stock ;3/8/01
"RTN","RMPRPIYG",2,0)
 ;;3.0;PROSTHETICS;**61,132**;Feb 09, 1996;Build 13
"RTN","RMPRPIYG",3,0)
 Q
"RTN","RMPRPIYG",4,0)
 ;
"RTN","RMPRPIYG",5,0)
 ;***** RC - Replaces RC option in old PIP
"RTN","RMPRPIYG",6,0)
 ;           RMPR INV RECEIVE
"RTN","RMPRPIYG",7,0)
 ;           cf. REC^RMPR5NOR
"RTN","RMPRPIYG",8,0)
 ;           Callable from VISTA menu, no vars required other than
"RTN","RMPRPIYG",9,0)
 ;           global VISTA vars (DUZ, etc)
"RTN","RMPRPIYG",10,0)
 ;
"RTN","RMPRPIYG",11,0)
RC N RMPRERR,RMPRSTN,RMPRLCN,RMPREXC,RMPR5,RMPR1,RMPR11,RMPROVAL
"RTN","RMPRPIYG",12,0)
 N RMPRVEND,RMPRQTY,RMPRTVAL,RMPR4,RMPRUCST,RMPRQ,RMPRIOP,RMPRNLAB
"RTN","RMPRPIYG",13,0)
 N RMPRBARC,RMPRITXT,RMPRBCP,RMPR41,RMPR41N,RMPRYN
"RTN","RMPRPIYG",14,0)
 ;
"RTN","RMPRPIYG",15,0)
 ;***** STN - prompt for Site/Station
"RTN","RMPRPIYG",16,0)
STN S RMPROVAL=$G(RMPRSTN("IEN"))
"RTN","RMPRPIYG",17,0)
 W @IOF S RMPRERR=$$STN^RMPRPIY1(.RMPRSTN,.RMPREXC)
"RTN","RMPRPIYG",18,0)
 I RMPRERR G RCX
"RTN","RMPRPIYG",19,0)
 I RMPREXC'="" G RCX
"RTN","RMPRPIYG",20,0)
 I RMPROVAL'=RMPRSTN("IEN") K RMPR1,RMPR11
"RTN","RMPRPIYG",21,0)
 S RMPR("NAME")=RMPRSTN("SITE NAME")
"RTN","RMPRPIYG",22,0)
 ;
"RTN","RMPRPIYG",23,0)
 ;***** HCPCS - prompt for HCPCS
"RTN","RMPRPIYG",24,0)
HCPCS W !!,"Receive an Item from Supply, Vendor or Veteran.",!
"RTN","RMPRPIYG",25,0)
 K RMPR6,RMPRTVAL,RMPRQTY,RMPRUCST,RMPRBCP,RMPRQ,RMPRIOP,RMPRNLAB
"RTN","RMPRPIYG",26,0)
 K RMPRBARC,RMPRITXT,RMPR41N,RMPR41,RMPRVEND,RMPR1,RMPR11,RMPRUNI
"RTN","RMPRPIYG",27,0)
HCPCS2 D HCPCS^RMPRPIY7(RMPRSTN("IEN"),$G(RMPR1("HCPCS")),.RMPR1,.RMPR11,.RMPREXC)
"RTN","RMPRPIYG",28,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",29,0)
 I RMPREXC="P"!(RMPREXC="^") D  G RCX
"RTN","RMPRPIYG",30,0)
 . W !,"** No HCPCS selected." H 1
"RTN","RMPRPIYG",31,0)
 . Q
"RTN","RMPRPIYG",32,0)
 I $G(RMPR11("IEN"))'="" G HCPCS4
"RTN","RMPRPIYG",33,0)
HCPCS3 D ITEM^RMPRPIYP(RMPRSTN("IEN"),RMPR1("HCPCS"),.RMPR11,.RMPREXC)
"RTN","RMPRPIYG",34,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",35,0)
 I RMPREXC="P"!(RMPREXC="^") G HCPCS
"RTN","RMPRPIYG",36,0)
 S RMPR11("STATION")=RMPRSTN("IEN")
"RTN","RMPRPIYG",37,0)
 S RMPR11("STATION IEN")=RMPRSTN("IEN")
"RTN","RMPRPIYG",38,0)
 ;
"RTN","RMPRPIYG",39,0)
 ; display selected HCPCS and item and continue
"RTN","RMPRPIYG",40,0)
HCPCS4 W !!,"HCPCS: "_$G(RMPR1("HCPCS"))_" "_$G(RMPR1("SHORT DESC"))
"RTN","RMPRPIYG",41,0)
 W !!,"IFCAP Item: ",$G(RMPR11("ITEM MASTER"))
"RTN","RMPRPIYG",42,0)
 W !!,"PIP Item desc.: ",$G(RMPR11("DESCRIPTION"))
"RTN","RMPRPIYG",43,0)
 ;
"RTN","RMPRPIYG",44,0)
 ; call module to display and select orders
"RTN","RMPRPIYG",45,0)
PORD D PORD^RMPRPIYY(RMPRSTN("IEN"),RMPR1("HCPCS"),RMPR11("ITEM"),.RMPR41,.RMPREXC)
"RTN","RMPRPIYG",46,0)
 I RMPREXC="P" G HCPCS
"RTN","RMPRPIYG",47,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",48,0)
 I RMPREXC="",+$G(RMPR41("IEN")) D
"RTN","RMPRPIYG",49,0)
 . S RMPRQTY=RMPR41("BALANCE QTY")
"RTN","RMPRPIYG",50,0)
 . K RMPRVEND
"RTN","RMPRPIYG",51,0)
 . S RMPRVEND("IEN")=RMPR41("VENDOR IEN")
"RTN","RMPRPIYG",52,0)
 . Q
"RTN","RMPRPIYG",53,0)
 ;
"RTN","RMPRPIYG",54,0)
 ;***** QTY - call prompt for Quantity
"RTN","RMPRPIYG",55,0)
QTY K RMPR41N("ORDER QTY")
"RTN","RMPRPIYG",56,0)
 W ! D QTY^RMPRPIY5(.RMPRQTY,.RMPREXC)
"RTN","RMPRPIYG",57,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",58,0)
 I RMPREXC="^" D MESS G HCPCS
"RTN","RMPRPIYG",59,0)
 I RMPREXC="P" G HCPCS
"RTN","RMPRPIYG",60,0)
 S RMPRQTY=+$G(RMPRQTY)
"RTN","RMPRPIYG",61,0)
 I 'RMPRQTY D  G HCPCS
"RTN","RMPRPIYG",62,0)
 . W !,"No quantity entered!"
"RTN","RMPRPIYG",63,0)
 . H 3
"RTN","RMPRPIYG",64,0)
 . Q
"RTN","RMPRPIYG",65,0)
 I +$G(RMPR41("IEN")),RMPRQTY>RMPR41("BALANCE QTY") G QTYA
"RTN","RMPRPIYG",66,0)
 G UCST
"RTN","RMPRPIYG",67,0)
 ;
"RTN","RMPRPIYG",68,0)
 ; If receive quantity is greater than o/s order balance ask if
"RTN","RMPRPIYG",69,0)
 ; changing the order qty
"RTN","RMPRPIYG",70,0)
QTYA D YNQTY(.RMPRYN,.RMPREXC)
"RTN","RMPRPIYG",71,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",72,0)
 I RMPREXC="^" D MESS G HCPCS
"RTN","RMPRPIYG",73,0)
 I RMPREXC="P" G QTY
"RTN","RMPRPIYG",74,0)
 I RMPRYN="N" G QTY
"RTN","RMPRPIYG",75,0)
 S RMPR41N("ORDER QTY")=RMPR41("ORDER QTY")+(RMPRQTY-RMPR41("BALANCE QTY"))
"RTN","RMPRPIYG",76,0)
 ;
"RTN","RMPRPIYG",77,0)
 ;***** UCST - call prompt for Unit Cost
"RTN","RMPRPIYG",78,0)
UCST D UCST^RMPRPIY5(.RMPRUCST,.RMPREXC)
"RTN","RMPRPIYG",79,0)
 I RMPREXC="P" G QTY
"RTN","RMPRPIYG",80,0)
 I RMPREXC="^" D MESS G HCPCS
"RTN","RMPRPIYG",81,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",82,0)
 S RMPRUCST=+$G(RMPRUCST)
"RTN","RMPRPIYG",83,0)
 ;
"RTN","RMPRPIYG",84,0)
 ;***** TVAL - Total Value - use if Unit Cost not used
"RTN","RMPRPIYG",85,0)
TVAL I RMPRUCST D  G VEND
"RTN","RMPRPIYG",86,0)
 . S RMPRTVAL=$J(RMPRQTY*RMPRUCST,0,2)
"RTN","RMPRPIYG",87,0)
 . W !,"TOTAL COST OF QUANTITY: "_RMPRTVAL
"RTN","RMPRPIYG",88,0)
 . Q
"RTN","RMPRPIYG",89,0)
 D TVAL^RMPRPIY5(.RMPRTVAL,.RMPREXC)
"RTN","RMPRPIYG",90,0)
 I RMPREXC="P" G UCST
"RTN","RMPRPIYG",91,0)
 I RMPREXC="^" D MESS G HCPCS
"RTN","RMPRPIYG",92,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",93,0)
 ;
"RTN","RMPRPIYG",94,0)
 ;***** VEND - prompt for Vendor
"RTN","RMPRPIYG",95,0)
VEND K RMPR41N("VENDOR IEN")
"RTN","RMPRPIYG",96,0)
 D VEND^RMPRPIY5(.RMPRVEND,.RMPREXC)
"RTN","RMPRPIYG",97,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",98,0)
 I RMPREXC="^" D MESS G HCPCS
"RTN","RMPRPIYG",99,0)
 I RMPREXC="P" G UCST
"RTN","RMPRPIYG",100,0)
 I RMPRVEND("IEN")=$G(RMPR41("VENDOR IEN")) G UNIT
"RTN","RMPRPIYG",101,0)
 ;
"RTN","RMPRPIYG",102,0)
 ;***** VENDA - vendor not same as order vendor so asK if changing
"RTN","RMPRPIYG",103,0)
 D YNVND(.RMPRYN,.RMPREXC)
"RTN","RMPRPIYG",104,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",105,0)
 I RMPREXC="^" D MESS G HCPCS
"RTN","RMPRPIYG",106,0)
 I RMPREXC="P" G VEND
"RTN","RMPRPIYG",107,0)
 I RMPRYN="N" G UNIT
"RTN","RMPRPIYG",108,0)
 S RMPR41N("VENDOR IEN")=RMPRVEND("IEN")
"RTN","RMPRPIYG",109,0)
 ;
"RTN","RMPRPIYG",110,0)
 ;***** UNIT - call prompt for UNIT OF ISSUE
"RTN","RMPRPIYG",111,0)
UNIT D UNIT^RMPRPIY5(.RMPRUNI,.RMPREXC)
"RTN","RMPRPIYG",112,0)
 I RMPREXC="P" G UCST
"RTN","RMPRPIYG",113,0)
 I RMPREXC="^" D MESS G HCPCS
"RTN","RMPRPIYG",114,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",115,0)
 S RMPRUNI("UNIT")=RMPRUNI("IEN")
"RTN","RMPRPIYG",116,0)
 ;
"RTN","RMPRPIYG",117,0)
 ;***** LOCN - prompt for location (if more than 1)
"RTN","RMPRPIYG",118,0)
LOCN S RMPRLCN=$$LOC1^RMPRPIYB(RMPRSTN("IEN"))
"RTN","RMPRPIYG",119,0)
 I RMPRLCN D  G TRANS
"RTN","RMPRPIYG",120,0)
 . K RMPR5
"RTN","RMPRPIYG",121,0)
 . S RMPR5("IEN")=RMPRLCN
"RTN","RMPRPIYG",122,0)
 . S RMPRERR=$$GET^RMPRPIX5(.RMPR5)
"RTN","RMPRPIYG",123,0)
 . W !,"Location: "_RMPR5("NAME")
"RTN","RMPRPIYG",124,0)
 . Q
"RTN","RMPRPIYG",125,0)
 D LOCNM^RMPRPIY7(RMPRSTN("IEN"),.RMPR5,.RMPREXC)
"RTN","RMPRPIYG",126,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",127,0)
 I RMPREXC="^" D MESS G HCPCS
"RTN","RMPRPIYG",128,0)
 I RMPREXC="P" G UCST
"RTN","RMPRPIYG",129,0)
 ;
"RTN","RMPRPIYG",130,0)
 ;***** TRANS - Now create receipt transaction
"RTN","RMPRPIYG",131,0)
TRANS S RMPR11("STATION")=RMPRSTN("IEN")
"RTN","RMPRPIYG",132,0)
 S RMPR11("STATION IEN")=RMPRSTN("IEN")
"RTN","RMPRPIYG",133,0)
 I '$D(^RMPR(661.4,"ASLHI",RMPRSTN("IEN"),RMPR5("IEN"),RMPR11("HCPCS"),RMPR11("ITEM"))) D
"RTN","RMPRPIYG",134,0)
 . S RMPR4("RE-ORDER QTY")=0
"RTN","RMPRPIYG",135,0)
 . S RMPRERR=$$CRE^RMPRPIX4(.RMPR4,.RMPR11,.RMPR5)
"RTN","RMPRPIYG",136,0)
 . Q
"RTN","RMPRPIYG",137,0)
 S RMPR11("STATION")=RMPRSTN("IEN")
"RTN","RMPRPIYG",138,0)
 S RMPR11("STATION IEN")=RMPRSTN("IEN")
"RTN","RMPRPIYG",139,0)
 S RMPR6("QUANTITY")=RMPRQTY
"RTN","RMPRPIYG",140,0)
 S RMPR6("VALUE")=RMPRTVAL
"RTN","RMPRPIYG",141,0)
 S RMPR6("VENDOR")=RMPRVEND("IEN")
"RTN","RMPRPIYG",142,0)
 S RMPR6("UNIT")=RMPRUNI("UNIT")
"RTN","RMPRPIYG",143,0)
 I $D(RMPR41N("ORDER QTY")) S RMPR41("ORDER QTY")=RMPR41N("ORDER QTY")
"RTN","RMPRPIYG",144,0)
 I $D(RMPR41N("VENDOR IEN")) S RMPR41("VENDOR IEN")=RMPR41N("VENDOR IEN")
"RTN","RMPRPIYG",145,0)
 S RMPRERR=$$REC^RMPRPIU8(.RMPR6,.RMPR11,.RMPR5,1,.RMPR41) ;receipt API
"RTN","RMPRPIYG",146,0)
 I RMPRERR D  G RCX
"RTN","RMPRPIYG",147,0)
 . W !!,"** Item could not be received, please contact support."
"RTN","RMPRPIYG",148,0)
 . H 3
"RTN","RMPRPIYG",149,0)
 . Q
"RTN","RMPRPIYG",150,0)
 E  D
"RTN","RMPRPIYG",151,0)
 . W !!,"** Item has been received and inventory updated."
"RTN","RMPRPIYG",152,0)
 . W !,"   If you are using barcoding you should now print labels"
"RTN","RMPRPIYG",153,0)
 . W !,"   for the items received.",!
"RTN","RMPRPIYG",154,0)
 . Q
"RTN","RMPRPIYG",155,0)
 ;
"RTN","RMPRPIYG",156,0)
 ;***** NLAB - call prompt for number of labels to print
"RTN","RMPRPIYG",157,0)
NLAB S RMPRNLAB=RMPR6("QUANTITY")
"RTN","RMPRPIYG",158,0)
 W ! D NLABP^RMPRPIYS(.RMPRNLAB,RMPR6("QUANTITY"),.RMPREXC)
"RTN","RMPRPIYG",159,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYG",160,0)
 I RMPREXC="P" G RCNX
"RTN","RMPRPIYG",161,0)
 I RMPREXC="^" G RCNX
"RTN","RMPRPIYG",162,0)
 I RMPRNLAB=0 G RCNX
"RTN","RMPRPIYG",163,0)
 ;
"RTN","RMPRPIYG",164,0)
 ;***** SELP - call prompt for barcode print device
"RTN","RMPRPIYG",165,0)
SELP ;W ! D SELP^RMPRPI11(.RMPRBCP,.RMPREXC,.RMPRQ,.RMPRIOP)
"RTN","RMPRPIYG",166,0)
 ;I RMPREXC'="" G NLAB
"RTN","RMPRPIYG",167,0)
 S RMPRBARC=RMPR11("HCPCS")_"-"_$P(RMPR6("DATE&TIME"),".",1)_$P(RMPR6("DATE&TIME"),".",2)
"RTN","RMPRPIYG",168,0)
 S RMPRITXT("DATE")=$E(RMPR6("DATE&TIME"),4,5)_"/"_$E(RMPR6("DATE&TIME"),6,7)_"/"_(1700+$E(RMPR6("DATE&TIME"),1,3))
"RTN","RMPRPIYG",169,0)
 S RMPRITXT("ITEM")=RMPR11("HCPCS-ITEM")
"RTN","RMPRPIYG",170,0)
 S RMPRITXT("ITEM DESC")=RMPR11("DESCRIPTION")
"RTN","RMPRPIYG",171,0)
 S RMPRITXT("MASTER DESC")=RMPR11("ITEM MASTER")
"RTN","RMPRPIYG",172,0)
 S RMPRITXT("UNIT PRICE")=RMPRUCST
"RTN","RMPRPIYG",173,0)
 S RMPRITXT("VENDOR")=RMPRVEND("NAME")
"RTN","RMPRPIYG",174,0)
 S RMPRITXT("LOCATION")=RMPR5("NAME")
"RTN","RMPRPIYG",175,0)
 D PRINT^RMPRPIYS
"RTN","RMPRPIYG",176,0)
RCNX K RMPR6,RMPRTVAL,RMPRQTY,RMPRUCST,RMPRBCP,RMPRQ,RMPRIOP,RMPRNLAB
"RTN","RMPRPIYG",177,0)
 K RMPRBARC,RMPRITXT,RMPR41N,RMPR41,RMPRVEND
"RTN","RMPRPIYG",178,0)
 G HCPCS
"RTN","RMPRPIYG",179,0)
RCX D KILL^XUSCLEAN
"RTN","RMPRPIYG",180,0)
 Q
"RTN","RMPRPIYG",181,0)
 ;
"RTN","RMPRPIYG",182,0)
MESS W !!,"*** NOTHING RECEIVE !!!",!
"RTN","RMPRPIYG",183,0)
 Q
"RTN","RMPRPIYG",184,0)
 ;
"RTN","RMPRPIYG",185,0)
 ; Y/N Prompt to confirm change of order qty
"RTN","RMPRPIYG",186,0)
YNQTY(RMPRYN,RMPREXC) ;
"RTN","RMPRPIYG",187,0)
 N DIR,X,Y,DA,DUOUT,DTOUT,DIROUT,DIRUT
"RTN","RMPRPIYG",188,0)
 S RMPRYN="N"
"RTN","RMPRPIYG",189,0)
 S RMPREXC=""
"RTN","RMPRPIYG",190,0)
 S DIR(0)="Y"
"RTN","RMPRPIYG",191,0)
 S DIR("A",1)="The entered quantity is greater than the outstanding balance ("_RMPR41("BALANCE QTY")_")"
"RTN","RMPRPIYG",192,0)
 S DIR("A",2)="still on order."
"RTN","RMPRPIYG",193,0)
 S DIR("A")="Do you want to increase the original order quantity"
"RTN","RMPRPIYG",194,0)
 D ^DIR
"RTN","RMPRPIYG",195,0)
 I $D(DTOUT) S RMPREXC="T" G YNQTYX
"RTN","RMPRPIYG",196,0)
 I $D(DIROUT) S RMPREXC="P" G YNQTYX
"RTN","RMPRPIYG",197,0)
 I X=""!(X["^")!($D(DUOUT)) S RMPREXC="^" G YNQTYX
"RTN","RMPRPIYG",198,0)
 S:Y RMPRYN="Y"
"RTN","RMPRPIYG",199,0)
YNQTYX Q
"RTN","RMPRPIYG",200,0)
 ;
"RTN","RMPRPIYG",201,0)
 ; Y/N Prompt to confirm change of order Vendor
"RTN","RMPRPIYG",202,0)
YNVND(RMPRYN,RMPREXC) ;
"RTN","RMPRPIYG",203,0)
 N DIR,X,Y,DA,DUOUT,DTOUT,DIROUT,DIRUT
"RTN","RMPRPIYG",204,0)
 S RMPRYN="N"
"RTN","RMPRPIYG",205,0)
 S RMPREXC=""
"RTN","RMPRPIYG",206,0)
 S DIR(0)="Y"
"RTN","RMPRPIYG",207,0)
 S DIR("A",1)="The entered Vendor is not the same as on the original order"
"RTN","RMPRPIYG",208,0)
 S DIR("A")="Do you want to change the Vendor on the order"
"RTN","RMPRPIYG",209,0)
 D ^DIR
"RTN","RMPRPIYG",210,0)
 I $D(DTOUT) S RMPREXC="T" G YNVNDX
"RTN","RMPRPIYG",211,0)
 I $D(DIROUT) S RMPREXC="P" G YNVNDX
"RTN","RMPRPIYG",212,0)
 I X=""!(X["^")!($D(DUOUT)) S RMPREXC="^" G YNVNDX
"RTN","RMPRPIYG",213,0)
 S:Y RMPRYN="Y"
"RTN","RMPRPIYG",214,0)
YNVNDX Q
"RTN","RMPRPIYY")
0^5^B21846868^B17959585
"RTN","RMPRPIYY",1,0)
RMPRPIYY ;HINCIO/ODJ - PIP EDIT - PROMPTS AND BARCODE ;3/8/01
"RTN","RMPRPIYY",2,0)
 ;;3.0;PROSTHETICS;**61,132**;Feb 09, 1996;Build 13
"RTN","RMPRPIYY",3,0)
 Q
"RTN","RMPRPIYY",4,0)
 ; The following subroutines are for selecting Orders (661.41)
"RTN","RMPRPIYY",5,0)
 ;
"RTN","RMPRPIYY",6,0)
 ;***** OK - Prompt for an OK
"RTN","RMPRPIYY",7,0)
OK(RMPRYN,RMPREXC) ;
"RTN","RMPRPIYY",8,0)
 N DIR,X,Y,DA,DUOUT,DTOUT,DIROUT,DIRUT
"RTN","RMPRPIYY",9,0)
 S RMPREXC=""
"RTN","RMPRPIYY",10,0)
 S RMPRYN="N"
"RTN","RMPRPIYY",11,0)
 S DIR("A")="         ...OK"
"RTN","RMPRPIYY",12,0)
 S DIR("B")="Yes"
"RTN","RMPRPIYY",13,0)
 S DIR(0)="Y"
"RTN","RMPRPIYY",14,0)
 D ^DIR
"RTN","RMPRPIYY",15,0)
 I $D(DTOUT) S RMPREXC="T" G OKX
"RTN","RMPRPIYY",16,0)
 I $D(DIROUT) S RMPREXC="P" G OKX
"RTN","RMPRPIYY",17,0)
 I X=""!(X["^") S RMPREXC="^" G OKX
"RTN","RMPRPIYY",18,0)
 S RMPRYN="N" S:Y RMPRYN="Y"
"RTN","RMPRPIYY",19,0)
OKX Q
"RTN","RMPRPIYY",20,0)
 ;
"RTN","RMPRPIYY",21,0)
 ;***** PVEN - Prompt for an Open order
"RTN","RMPRPIYY",22,0)
PORD(RMPRSTN,RMPRHCPC,RMPRITM,RMPR41,RMPREXC) ;
"RTN","RMPRPIYY",23,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DA,DIRUT,RMPRA,RMPRGBLR,RMPRIEN1
"RTN","RMPRPIYY",24,0)
 N RMPRMAX,RMPRLIN,RMPRGBL,RMPR41I,RMPRS,STS,RMPROCNT,RMPRIEN,RMPRD
"RTN","RMPRPIYY",25,0)
 S (RMPRERR,RMPROCNT)=0
"RTN","RMPRPIYY",26,0)
 S RMPREXC=""
"RTN","RMPRPIYY",27,0)
 S RMPRMAX=15
"RTN","RMPRPIYY",28,0)
 S RMPRLIN=0
"RTN","RMPRPIYY",29,0)
 K RMPR41
"RTN","RMPRPIYY",30,0)
 ;
"RTN","RMPRPIYY",31,0)
 ; See if just 1 record - no need to list if there is
"RTN","RMPRPIYY",32,0)
 ; Loop on open orders
"RTN","RMPRPIYY",33,0)
 K RMPRORD,RMPRIEN1
"RTN","RMPRPIYY",34,0)
 F STS="O","R" S RMPRD="" F  S RMPRD=$O(^RMPR(661.41,"ASSHID",RMPRSTN,STS,RMPRHCPC,RMPRITM,RMPRD)) Q:RMPRD=""  D  Q:RMPRERR
"RTN","RMPRPIYY",35,0)
 . S RMPRIEN=""
"RTN","RMPRPIYY",36,0)
 . F  S RMPRIEN=$O(^RMPR(661.41,"ASSHID",RMPRSTN,STS,RMPRHCPC,RMPRITM,RMPRD,RMPRIEN)) Q:RMPRIEN=""  D  Q:RMPRERR
"RTN","RMPRPIYY",37,0)
 .. K RMPR41 S RMPR41("IEN")=RMPRIEN
"RTN","RMPRPIYY",38,0)
 .. S RMPRERR=$$GET^RMPRPIXN(.RMPR41,)
"RTN","RMPRPIYY",39,0)
 .. I RMPRERR S RMPRERR=99 Q
"RTN","RMPRPIYY",40,0)
 .. I RMPR41("BALANCE QTY")<1 Q
"RTN","RMPRPIYY",41,0)
 .. S RMPRORD(RMPRD,RMPRIEN)=STS,RMPRIEN1=RMPRIEN,RMPROCNT=RMPROCNT+1
"RTN","RMPRPIYY",42,0)
 .. Q
"RTN","RMPRPIYY",43,0)
 . Q
"RTN","RMPRPIYY",44,0)
 I RMPROCNT=0 K RMPR41 G PORDX
"RTN","RMPRPIYY",45,0)
 I RMPROCNT=1 S RMPR41("IEN")=RMPRIEN1 G PORDG
"RTN","RMPRPIYY",46,0)
 ;
"RTN","RMPRPIYY",47,0)
 ; Selection list of current stock records
"RTN","RMPRPIYY",48,0)
PORDL1 S RMPRD=0
"RTN","RMPRPIYY",49,0)
PORDL1A S RMPRD=$O(RMPRORD(RMPRD)) I RMPRD="" G:'RMPRLIN PORDX G PORDP
"RTN","RMPRPIYY",50,0)
PORDL1B S RMPRIEN=$O(RMPRORD(RMPRD,RMPRIEN)) G:RMPRIEN="" PORDL1A
"RTN","RMPRPIYY",51,0)
 K RMPR41,RMPR41I
"RTN","RMPRPIYY",52,0)
 S RMPR41("IEN")=RMPRIEN
"RTN","RMPRPIYY",53,0)
 S RMPR41I("IEN")=RMPR41("IEN")
"RTN","RMPRPIYY",54,0)
 S RMPRERR=$$GETI^RMPRPIXN(.RMPR41I,)
"RTN","RMPRPIYY",55,0)
 S RMPRERR=$$GET^RMPRPIXN(.RMPR41,)
"RTN","RMPRPIYY",56,0)
 I RMPRLIN,'(RMPRLIN#RMPRMAX) D  G PORDP
"RTN","RMPRPIYY",57,0)
 . S DIR("A",1)="Press <RETURN> to see more, '^' to exit this list, or"
"RTN","RMPRPIYY",58,0)
 . Q
"RTN","RMPRPIYY",59,0)
PORDL2 S RMPRLIN=RMPRLIN+1
"RTN","RMPRPIYY",60,0)
 I RMPRLIN=1 D PORDH
"RTN","RMPRPIYY",61,0)
 S RMPRS=$P(RMPR41I("DATE ORDER"),".",1)
"RTN","RMPRPIYY",62,0)
 W !,$J(RMPRLIN,2)," ",$E(RMPRS,4,5)_"/"_$E(RMPRS,6,7)_"/"_$E(RMPRS,2,3)
"RTN","RMPRPIYY",63,0)
 W ?11,$J(RMPR41("ORDER QTY"),5,0)
"RTN","RMPRPIYY",64,0)
 W ?18,$E(RMPR41("VENDOR"),1,30)
"RTN","RMPRPIYY",65,0)
 I +RMPR41("RECEIVE QTY") D
"RTN","RMPRPIYY",66,0)
 . W ?49,$J(RMPR41("RECEIVE QTY"),5,0)
"RTN","RMPRPIYY",67,0)
 . S RMPRS=$P(RMPR41I("DATE RECEIVE"),".",1)
"RTN","RMPRPIYY",68,0)
 . W "  ",$E(RMPRS,4,5)_"/"_$E(RMPRS,6,7)_"/"_$E(RMPRS,2,3)
"RTN","RMPRPIYY",69,0)
 . Q
"RTN","RMPRPIYY",70,0)
 S RMPRA(RMPRLIN)=RMPR41("IEN")
"RTN","RMPRPIYY",71,0)
 K RMPR41,RMPR41I
"RTN","RMPRPIYY",72,0)
 G PORDL1B
"RTN","RMPRPIYY",73,0)
 ;
"RTN","RMPRPIYY",74,0)
 ; Prompt for selection
"RTN","RMPRPIYY",75,0)
PORDP S DIR(0)="FAO"
"RTN","RMPRPIYY",76,0)
 S DIR("A")="Choose 1 - "_RMPRLIN_" : "
"RTN","RMPRPIYY",77,0)
 D ^DIR
"RTN","RMPRPIYY",78,0)
 I $D(DTOUT) S RMPREXC="T" G PORDX
"RTN","RMPRPIYY",79,0)
 I $D(DIROUT) S RMPREXC="P" G PORDX
"RTN","RMPRPIYY",80,0)
 I X="",$D(DIR("A",1)) K DIR("A",1) D PORDH G PORDL2
"RTN","RMPRPIYY",81,0)
 I X="" S RMPREXC="^" G PORDX
"RTN","RMPRPIYY",82,0)
 I X["^"!($D(DUOUT)) S RMPREXC="^" G PORDX
"RTN","RMPRPIYY",83,0)
 I '$D(RMPRA(X)) D  G PORDP
"RTN","RMPRPIYY",84,0)
 . W !,"Please select a stock order record"
"RTN","RMPRPIYY",85,0)
 . W !,"by entering a line number in range 1 - "
"RTN","RMPRPIYY",86,0)
 . W RMPRLIN
"RTN","RMPRPIYY",87,0)
 . Q
"RTN","RMPRPIYY",88,0)
 S RMPR41("IEN")=RMPRA(X)
"RTN","RMPRPIYY",89,0)
PORDG K RMPR41I
"RTN","RMPRPIYY",90,0)
 S RMPR41I("IEN")=RMPR41("IEN")
"RTN","RMPRPIYY",91,0)
 S RMPRERR=$$GETI^RMPRPIXN(.RMPR41I,)
"RTN","RMPRPIYY",92,0)
 S RMPRERR=$$GET^RMPRPIXN(.RMPR41,)
"RTN","RMPRPIYY",93,0)
 S RMPR41("VENDOR IEN")=RMPR41I("VENDOR")
"RTN","RMPRPIYY",94,0)
PORDX Q
"RTN","RMPRPIYY",95,0)
PORDE() ;
"RTN","RMPRPIYY",96,0)
 Q:$QS(RMPRGBL,1)'=661.41 1
"RTN","RMPRPIYY",97,0)
 Q:$QS(RMPRGBL,2)'="ASSHID" 1
"RTN","RMPRPIYY",98,0)
 Q:$QS(RMPRGBL,3)'=RMPRSTN 1
"RTN","RMPRPIYY",99,0)
 Q:$QS(RMPRGBL,4)'="O" 1
"RTN","RMPRPIYY",100,0)
 Q:$QS(RMPRGBL,5)'=RMPRHCPC 1
"RTN","RMPRPIYY",101,0)
 Q:$QS(RMPRGBL,6)'=RMPRITM 1
"RTN","RMPRPIYY",102,0)
 Q 0
"RTN","RMPRPIYY",103,0)
PORDH W !
"RTN","RMPRPIYY",104,0)
 W !,"Select a current stock order record, or ^ if not receiving against an order.",!
"RTN","RMPRPIYY",105,0)
 W ?3,"Date",?13,"Qty",?18,"Vendor",?49,"Received"
"RTN","RMPRPIYY",106,0)
 Q
"RTN","RMPRPIYY",107,0)
 ;
"RTN","RMPRPIYY",108,0)
 ;***** NLAB - call prompt for number of labels to print
"RTN","RMPRPIYY",109,0)
NLAB S RMPRNLAB=RMPR6("QUANTITY")
"RTN","RMPRPIYY",110,0)
 W ! D NLABP^RMPRPIYS(.RMPRNLAB,RMPR6("QUANTITY"),.RMPREXC)
"RTN","RMPRPIYY",111,0)
 I RMPREXC="T" G RCX
"RTN","RMPRPIYY",112,0)
 I RMPREXC="P" G RCNX
"RTN","RMPRPIYY",113,0)
 I RMPREXC="^" G RCNX
"RTN","RMPRPIYY",114,0)
 I RMPRNLAB=0 G RCNX
"RTN","RMPRPIYY",115,0)
 ;
"RTN","RMPRPIYY",116,0)
 ;***** SELP - call prompt for barcode print device
"RTN","RMPRPIYY",117,0)
SELP ;
"RTN","RMPRPIYY",118,0)
 I RMPREXC'="" G NLAB
"RTN","RMPRPIYY",119,0)
 ;K RMPR7I
"RTN","RMPRPIYY",120,0)
 ;S RMPRERR=$$ETOI^RMPRPIX7(.RMPR7,.RMPR7I)
"RTN","RMPRPIYY",121,0)
 S RMPRBARC=RMPR11("HCPCS")_"-"_$P(RMPR6("DATE&TIME"),".",1)_$P(RMPR6("DATE&TIME"),".",2)
"RTN","RMPRPIYY",122,0)
 S RMPRITXT("DATE")=$E(RMPR6("DATE&TIME"),4,5)_"/"_$E(RMPR6("DATE&TIME"),6,7)_"/"_(1700+$E(RMPR6("DATE&TIME"),1,3))
"RTN","RMPRPIYY",123,0)
 S RMPRITXT("ITEM")=RMPR11("HCPCS-ITEM")
"RTN","RMPRPIYY",124,0)
 S RMPRITXT("ITEM DESC")=RMPR11("DESCRIPTION")
"RTN","RMPRPIYY",125,0)
 S RMPRITXT("MASTER DESC")=RMPR11("ITEM MASTER")
"RTN","RMPRPIYY",126,0)
 S RMPRITXT("UNIT PRICE")=RMPRUCST
"RTN","RMPRPIYY",127,0)
 S RMPRITXT("VENDOR")=RMPRVEND("NAME")
"RTN","RMPRPIYY",128,0)
 S RMPRITXT("LOCATION")=RMPR5("NAME")
"RTN","RMPRPIYY",129,0)
 D PRINT^RMPRPIYS
"RTN","RMPRPIYY",130,0)
RCNX ;K RMPR6,RMPRTVAL,RMPRQTY,RMPRUCST,RMPRBCP,RMPRQ,RMPRIOP,RMPRNLAB
"RTN","RMPRPIYY",131,0)
 ;K RMPRBARC,RMPRITXT,RMPR41N,RMPR41,RMPRVEND
"RTN","RMPRPIYY",132,0)
RCX Q
"VER")
8.0^22.0
"BLD",6296,6)
^108
**END**
**END**
