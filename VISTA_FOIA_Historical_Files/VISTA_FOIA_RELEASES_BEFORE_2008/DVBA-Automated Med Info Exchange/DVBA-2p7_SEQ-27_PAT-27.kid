Released DVBA*2.7*27 SEQ #27
Extracted from mail message
**KIDS**:DVBA*2.7*27^

**INSTALL NAME**
DVBA*2.7*27
"BLD",2013,0)
DVBA*2.7*27^AUTOMATED MED INFO EXCHANGE^0^2990804^y
"BLD",2013,1,0)
^^2^2^2990804^
"BLD",2013,1,1,0)
This patch makes it possible to queue Insufficient Exam Report to a
"BLD",2013,1,2,0)
printer.
"BLD",2013,4,0)
^9.64PA^^
"BLD",2013,"ABPKG")
n
"BLD",2013,"KRN",0)
^9.67PA^19^18
"BLD",2013,"KRN",.4,0)
.4
"BLD",2013,"KRN",.401,0)
.401
"BLD",2013,"KRN",.402,0)
.402
"BLD",2013,"KRN",.403,0)
.403
"BLD",2013,"KRN",.5,0)
.5
"BLD",2013,"KRN",.84,0)
.84
"BLD",2013,"KRN",3.6,0)
3.6
"BLD",2013,"KRN",3.8,0)
3.8
"BLD",2013,"KRN",9.2,0)
9.2
"BLD",2013,"KRN",9.8,0)
9.8
"BLD",2013,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",2013,"KRN",9.8,"NM",1,0)
DVBCIRPT^^0^B15932212
"BLD",2013,"KRN",9.8,"NM",2,0)
DVBCIRP1^^0^B26898303
"BLD",2013,"KRN",9.8,"NM","B","DVBCIRP1",2)

"BLD",2013,"KRN",9.8,"NM","B","DVBCIRPT",1)

"BLD",2013,"KRN",19,0)
19
"BLD",2013,"KRN",19,"NM",0)
^9.68A^^
"BLD",2013,"KRN",19.1,0)
19.1
"BLD",2013,"KRN",101,0)
101
"BLD",2013,"KRN",409.61,0)
409.61
"BLD",2013,"KRN",771,0)
771
"BLD",2013,"KRN",869.2,0)
869.2
"BLD",2013,"KRN",870,0)
870
"BLD",2013,"KRN",8994,0)
8994
"BLD",2013,"KRN","B",.4,.4)

"BLD",2013,"KRN","B",.401,.401)

"BLD",2013,"KRN","B",.402,.402)

"BLD",2013,"KRN","B",.403,.403)

"BLD",2013,"KRN","B",.5,.5)

"BLD",2013,"KRN","B",.84,.84)

"BLD",2013,"KRN","B",3.6,3.6)

"BLD",2013,"KRN","B",3.8,3.8)

"BLD",2013,"KRN","B",9.2,9.2)

"BLD",2013,"KRN","B",9.8,9.8)

"BLD",2013,"KRN","B",19,19)

"BLD",2013,"KRN","B",19.1,19.1)

"BLD",2013,"KRN","B",101,101)

"BLD",2013,"KRN","B",409.61,409.61)

"BLD",2013,"KRN","B",771,771)

"BLD",2013,"KRN","B",869.2,869.2)

"BLD",2013,"KRN","B",870,870)

"BLD",2013,"KRN","B",8994,8994)

"BLD",2013,"QUES",0)
^9.62^^
"MBREQ")
0
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^2950508
"PKG",223,22,1,"PAH",1,0)
27^2990804
"PKG",223,22,1,"PAH",1,1,0)
^^2^2^2990804
"PKG",223,22,1,"PAH",1,1,1,0)
This patch makes it possible to queue Insufficient Exam Report to a
"PKG",223,22,1,"PAH",1,1,2,0)
printer.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DVBCIRP1")
0^2^B26898303
"RTN","DVBCIRP1",1,0)
DVBCIRP1 ;ALB/GTS-AMIE INSUFFICIENT 2507 RPT -CONT 1 ; 11/10/94  1:30 PM
"RTN","DVBCIRP1",2,0)
 ;;2.7;AMIE;**13,19,27**;Apr 10, 1995
"RTN","DVBCIRP1",3,0)
 ;
"RTN","DVBCIRP1",4,0)
 ;** Version Changes
"RTN","DVBCIRP1",5,0)
 ;   2.7 - New routine (Enhc 15)
"RTN","DVBCIRP1",6,0)
 ;
"RTN","DVBCIRP1",7,0)
SUMRPT ;**Output the summary report
"RTN","DVBCIRP1",8,0)
 W:IOST?1"C-".E @IOF
"RTN","DVBCIRP1",9,0)
 D SUMHD
"RTN","DVBCIRP1",10,0)
 ;print request data
"RTN","DVBCIRP1",11,0)
 W !?3,"Total 2507 requests received for date range:",?71,$J(DVBARQCT,5)
"RTN","DVBCIRP1",12,0)
 W !?3,"Total insufficient 2507 requests received for date range:",?71,$J(DVBAINRQ,5)
"RTN","DVBCIRP1",13,0)
 W !?3,"Total insufficient 2507 requests cancelled by RO for date range:",?71,$J(DVBACAN("REQ"),5)
"RTN","DVBCIRP1",14,0)
 I DVBARQCT>0 D
"RTN","DVBCIRP1",15,0)
 .S PERCENT=(DVBAINRQ/DVBARQCT)*100
"RTN","DVBCIRP1",16,0)
 .W !?3,"% of insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP1",17,0)
 .S PERCENT=((DVBAINRQ-DVBACAN("REQ"))/DVBARQCT)*100
"RTN","DVBCIRP1",18,0)
 .W !?3,"% of uncancelled insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP1",19,0)
 I DVBARQCT'>0 D
"RTN","DVBCIRP1",20,0)
 .S PERCENT=0
"RTN","DVBCIRP1",21,0)
 .W !?3,"% of insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP1",22,0)
 .W !?3,"% of uncancelled insufficient requests per total requests received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP1",23,0)
 ;print exam data
"RTN","DVBCIRP1",24,0)
 W !!?3,"Total 2507 exams received for date range:",?71,$J(DVBAXMCT,5)
"RTN","DVBCIRP1",25,0)
 W !?3,"Total insufficient 2507 exams received for date range:",?71,$J(DVBAINXM,5)
"RTN","DVBCIRP1",26,0)
 W !?3,"Total insufficient 2507 exams cancelled by RO for date range:",?71,$J(DVBACAN("EXM"),5)
"RTN","DVBCIRP1",27,0)
 I DVBAXMCT>0 D
"RTN","DVBCIRP1",28,0)
 .S PERCENT=(DVBAINXM/DVBAXMCT)*100
"RTN","DVBCIRP1",29,0)
 .W !?3,"% of insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP1",30,0)
 .S PERCENT=((DVBAINXM-DVBACAN("EXM"))/DVBAXMCT)*100
"RTN","DVBCIRP1",31,0)
 .W !?3,"% of uncancelled insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP1",32,0)
 I DVBAXMCT'>0 D
"RTN","DVBCIRP1",33,0)
 .S PERCENT=0
"RTN","DVBCIRP1",34,0)
 .W !?3,"% of insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP1",35,0)
 .W !?3,"% of uncancelled insufficient exams per total exams received:",?71,$J(PERCENT,5,1)_"%"
"RTN","DVBCIRP1",36,0)
 ;print insufficient reason data
"RTN","DVBCIRP1",37,0)
 I IOST?1"C-".E DO
"RTN","DVBCIRP1",38,0)
 .K DTOUT,DUOUT
"RTN","DVBCIRP1",39,0)
 .W !!
"RTN","DVBCIRP1",40,0)
 .D PAUSE^DVBCUTL4
"RTN","DVBCIRP1",41,0)
 .I '$D(DTOUT),('$D(DUOUT)) DO
"RTN","DVBCIRP1",42,0)
 ..W @IOF
"RTN","DVBCIRP1",43,0)
 ..D SUMHD
"RTN","DVBCIRP1",44,0)
 I '$D(DTOUT),('$D(DUOUT)) DO
"RTN","DVBCIRP1",45,0)
 .W:IOST'?1"C-".E !!
"RTN","DVBCIRP1",46,0)
 .W !?15,"Summary of insufficient exams per Reason",!
"RTN","DVBCIRP1",47,0)
 .W !?3,"Reason",?53,"Num",?59,"Percent"
"RTN","DVBCIRP1",48,0)
 .N DVBARSLP S DVBARSLP=""
"RTN","DVBCIRP1",49,0)
 .F  S DVBARSLP=$O(DVBAINXM(DVBARSLP)) Q:DVBARSLP=""  DO  ;**Reason tot's
"RTN","DVBCIRP1",50,0)
 ..W:+DVBARSLP>0 !?3,$P(^DVB(396.94,DVBARSLP,0),U,3),?53,DVBAINXM(DVBARSLP)
"RTN","DVBCIRP1",51,0)
 ..I +DVBARSLP'>0,(+DVBAINXM(DVBARSLP)>0) W !?3,"Exams without insufficient reason indicated",?53,DVBAINXM(DVBARSLP)
"RTN","DVBCIRP1",52,0)
 ..W:(+DVBAINXM(DVBARSLP)>0&(DVBAINXM>0)) ?59,($P(((DVBAINXM(DVBARSLP)/DVBAINXM)*100),".",1))_$S($E($P(((DVBAINXM(DVBARSLP)/DVBAINXM)*100),".",2),1,1)'="":"."_$E($P(((DVBAINXM(DVBARSLP)/DVBAINXM)*100),".",2),1,1),1:"")_" %"
"RTN","DVBCIRP1",53,0)
 .I IOST?1"C-".E DO
"RTN","DVBCIRP1",54,0)
 ..D CONTMES^DVBCUTL4
"RTN","DVBCIRP1",55,0)
 Q
"RTN","DVBCIRP1",56,0)
 ;
"RTN","DVBCIRP1",57,0)
SUMHD ;** Output Summary Report heading
"RTN","DVBCIRP1",58,0)
 N STRTDT,LSTDT
"RTN","DVBCIRP1",59,0)
 W !?15,"Summary Insufficient Exam Report for ",$$SITE^DVBCUTL4(),!
"RTN","DVBCIRP1",60,0)
 S Y=$P(BEGDT,".",1) X ^DD("DD") S STRTDT=Y K Y
"RTN","DVBCIRP1",61,0)
 S Y=$P(ENDDT,".",1) X ^DD("DD") S LSTDT=Y K Y
"RTN","DVBCIRP1",62,0)
 W !?16,"For Date Range: "_STRTDT_" to "_LSTDT,!
"RTN","DVBCIRP1",63,0)
 Q
"RTN","DVBCIRP1",64,0)
 ;
"RTN","DVBCIRP1",65,0)
DETAIL ;** Output reason, exam type and exam info
"RTN","DVBCIRP1",66,0)
 N STRTDT,LSTDT
"RTN","DVBCIRP1",67,0)
 S Y=$P(BEGDT,".",1) X ^DD("DD") S STRTDT=Y K Y
"RTN","DVBCIRP1",68,0)
 S Y=$P(ENDDT,".",1) X ^DD("DD") S LSTDT=Y K Y
"RTN","DVBCIRP1",69,0)
 U IO
"RTN","DVBCIRP1",70,0)
 S DVBADTLP=BEGDT
"RTN","DVBCIRP1",71,0)
 S DVBAENDL=ENDDT
"RTN","DVBCIRP1",72,0)
 D DETHD^DVBCIUTL
"RTN","DVBCIRP1",73,0)
 S RSDA=""
"RTN","DVBCIRP1",74,0)
 S DVBAPG1=""
"RTN","DVBCIRP1",75,0)
 F  S RSDA=$O(DVBAARY("REASON",RSDA)) Q:(RSDA=""!($D(GETOUT)))  DO
"RTN","DVBCIRP1",76,0)
 .K DVBARSPT
"RTN","DVBCIRP1",77,0)
 .S TPDA=""
"RTN","DVBCIRP1",78,0)
 .F  S TPDA=$O(^TMP($J,"XMTYPE",TPDA)) Q:(TPDA=""!($D(GETOUT)))  DO
"RTN","DVBCIRP1",79,0)
 ..K DVBAXMPT
"RTN","DVBCIRP1",80,0)
 ..S XMDA=""
"RTN","DVBCIRP1",81,0)
 ..F  S XMDA=$O(^DVB(396.4,"AIT",RSDA,TPDA,XMDA)) Q:(XMDA=""!($D(GETOUT)))  DO
"RTN","DVBCIRP1",82,0)
 ...I $P(^DVB(396.3,$P(^DVB(396.4,XMDA,0),U,2),0),U,5)>DVBADTLP,($P(^DVB(396.3,$P(^DVB(396.4,XMDA,0),U,2),0),U,5)<DVBAENDL) D EXMOUT^DVBCIUTL
"RTN","DVBCIRP1",83,0)
 I '$D(GETOUT),(IOST?1"C-".E) D CONTMES^DVBCUTL4
"RTN","DVBCIRP1",84,0)
 D ^%ZISC
"RTN","DVBCIRP1",85,0)
 D KVARS ;**KILL the variables used by DETAIL
"RTN","DVBCIRP1",86,0)
 Q
"RTN","DVBCIRP1",87,0)
 ;
"RTN","DVBCIRP1",88,0)
KVARS ;** Final Kill for Detail report
"RTN","DVBCIRP1",89,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DVBCIRP1",90,0)
 K ^TMP($J),DVBAARY,DVBANAME,DVBASSN,DVBACNUM,RSDA,TPDA,XMDA,DVBADTLP
"RTN","DVBCIRP1",91,0)
 K DVBAENDL,DVBARSPT,DVBAXMPT,REQDA,DFN,DVBAORXM,DVBAXMTP,DVBACMND
"RTN","DVBCIRP1",92,0)
 K DVBAORPV,DVBAORP1,DVBADTWK,DVBADTE,DVBAORDT,DVBANAM1,GETOUT
"RTN","DVBCIRP1",93,0)
 K DVBAARY,DVBAPG1,DVBARQDT,DVBAXDT,DVBAXRS
"RTN","DVBCIRP1",94,0)
 Q
"RTN","DVBCIRP1",95,0)
 ;
"RTN","DVBCIRP1",96,0)
DETSEL ;** Select the details to report
"RTN","DVBCIRP1",97,0)
 D RSEL^DVBCIUTL
"RTN","DVBCIRP1",98,0)
 I '$D(DVBAARY("REASON")) S DVBAQTSL=""
"RTN","DVBCIRP1",99,0)
 I $D(DVBAQTSL) DO
"RTN","DVBCIRP1",100,0)
 .S DIR("A",1)="You have not selected Insufficient reasons to report."
"RTN","DVBCIRP1",101,0)
 .S DIR("A",2)="This is required to print the Detailed report."
"RTN","DVBCIRP1",102,0)
 .S DIR("A",3)=" "
"RTN","DVBCIRP1",103,0)
 .S DIR(0)="FAO^1:1",DIR("A")="Hit Return to continue." D ^DIR K DIR,X,Y
"RTN","DVBCIRP1",104,0)
 I '$D(DVBAQTSL) DO
"RTN","DVBCIRP1",105,0)
 .D XMSEL^DVBCIUTL
"RTN","DVBCIRP1",106,0)
 .I '$D(^TMP($J,"XMTYPE")) S DVBAQTSL=""
"RTN","DVBCIRP1",107,0)
 .I $D(DVBAQTSL) DO
"RTN","DVBCIRP1",108,0)
 ..S DIR("A",1)="You have not selected Exams to report."
"RTN","DVBCIRP1",109,0)
 ..S DIR("A",2)="This is required to print the Detailed report."
"RTN","DVBCIRP1",110,0)
 ..S DIR("A",3)=" "
"RTN","DVBCIRP1",111,0)
 ..S DIR(0)="FAO^1:1",DIR("A")="Hit Return to continue." D ^DIR K DIR,X,Y
"RTN","DVBCIRP1",112,0)
 ..K DVBAARY("REASON")
"RTN","DVBCIRP1",113,0)
 Q
"RTN","DVBCIRP1",114,0)
 ;
"RTN","DVBCIRPT")
0^1^B15932212
"RTN","DVBCIRPT",1,0)
DVBCIRPT ;ALB/GTS-AMIE C&P INSUFF EXAM TRACKING RPT ; 11/9/94  2:00 PM
"RTN","DVBCIRPT",2,0)
 ;;2.7;AMIE;**13,19,27**;Apr 10, 1995
"RTN","DVBCIRPT",3,0)
 ;
"RTN","DVBCIRPT",4,0)
 ;** Version Changes
"RTN","DVBCIRPT",5,0)
 ;   2.7 - New routine (Enhc 15)
"RTN","DVBCIRPT",6,0)
 ;
"RTN","DVBCIRPT",7,0)
MAIN ;**Select Dte Rng & Rpt Type; call report routine
"RTN","DVBCIRPT",8,0)
 F  Q:$D(DVBAOUT)  DO
"RTN","DVBCIRPT",9,0)
 .D HOME^%ZIS
"RTN","DVBCIRPT",10,0)
 .S TVAR(1,0)="0,0,1,2:2,1^Insufficient 2507 Exam Report"
"RTN","DVBCIRPT",11,0)
 .D WR^DVBAUTL4("TVAR")
"RTN","DVBCIRPT",12,0)
 .K TVAR
"RTN","DVBCIRPT",13,0)
 .S RPTTYPE=$$RPTTYPE^DVBCUTA1()
"RTN","DVBCIRPT",14,0)
 .S:((RPTTYPE'="D")&(RPTTYPE'="S")) DVBAOUT=""
"RTN","DVBCIRPT",15,0)
 .W:'$D(DVBAOUT) !!
"RTN","DVBCIRPT",16,0)
 .D:'$D(DVBAOUT) DATE^DVBCUTL4(.BEGDT,.ENDDT)
"RTN","DVBCIRPT",17,0)
 .I $D(ENDDT),(+ENDDT>0) DO
"RTN","DVBCIRPT",18,0)
 ..S ENDDT=ENDDT_".2359"
"RTN","DVBCIRPT",19,0)
 ..I RPTTYPE="S" DO
"RTN","DVBCIRPT",20,0)
 ...D DEVSEL
"RTN","DVBCIRPT",21,0)
 ...I POP D SUMKILL
"RTN","DVBCIRPT",22,0)
 ...I 'POP DO
"RTN","DVBCIRPT",23,0)
 ....I $D(IO("Q")) DO
"RTN","DVBCIRPT",24,0)
 .....N DVBAI
"RTN","DVBCIRPT",25,0)
 .....S ZTRTN="SUM^DVBCIRPT",ZTIO=ION
"RTN","DVBCIRPT",26,0)
 .....S ZTDESC="Summary Insufficient Exam Report"
"RTN","DVBCIRPT",27,0)
 .....F DVBAI="BEGDT","ENDDT" S ZTSAVE(DVBAI)=""
"RTN","DVBCIRPT",28,0)
 .....D ^%ZTLOAD
"RTN","DVBCIRPT",29,0)
 .....N TSK S TSK=$S($D(ZTSK)=0:"C",1:"Y")
"RTN","DVBCIRPT",30,0)
 .....I TSK="Y" W !!,"Summary Report Queued. Task number: ",ZTSK
"RTN","DVBCIRPT",31,0)
 .....K ZTSK D CONTMES^DVBCUTL4
"RTN","DVBCIRPT",32,0)
 .....D SUMKILL
"RTN","DVBCIRPT",33,0)
 ....I '$D(IO("Q")) D SUM
"RTN","DVBCIRPT",34,0)
 ...D ^%ZISC
"RTN","DVBCIRPT",35,0)
 ..I RPTTYPE="D" DO
"RTN","DVBCIRPT",36,0)
 ...D DETSEL^DVBCIRP1 ;**Select the Reasons and Exams to report
"RTN","DVBCIRPT",37,0)
 ...I '$D(DVBAQTSL) DO
"RTN","DVBCIRPT",38,0)
 ....D DEVSEL
"RTN","DVBCIRPT",39,0)
 ....I POP D KVARS^DVBCIRP1
"RTN","DVBCIRPT",40,0)
 ....I 'POP DO
"RTN","DVBCIRPT",41,0)
 .....I $D(IO("Q")) DO
"RTN","DVBCIRPT",42,0)
 ......N DVBAI
"RTN","DVBCIRPT",43,0)
 ......S ZTRTN="DETAIL^DVBCIRP1",ZTIO=ION
"RTN","DVBCIRPT",44,0)
 ......S ZTDESC="Detailed Insufficient Exam Report"
"RTN","DVBCIRPT",45,0)
 ......F DVBAI="BEGDT","ENDDT","DVBAARY(""REASON"",","^TMP($J,""XMTYPE""," S ZTSAVE(DVBAI)=""
"RTN","DVBCIRPT",46,0)
 ......D ^%ZTLOAD
"RTN","DVBCIRPT",47,0)
 ......N TSK S TSK=$S($D(ZTSK)=0:"C",1:"Y")
"RTN","DVBCIRPT",48,0)
 ......I TSK="Y" W !!,"Detail Report Queued. Task number: ",ZTSK
"RTN","DVBCIRPT",49,0)
 ......K ZTSK D CONTMES^DVBCUTL4
"RTN","DVBCIRPT",50,0)
 ......D KVARS^DVBCIRP1
"RTN","DVBCIRPT",51,0)
 .....I '$D(IO("Q")) W:IOST?1"C-".E @IOF D DETAIL^DVBCIRP1
"RTN","DVBCIRPT",52,0)
 ....D ^%ZISC
"RTN","DVBCIRPT",53,0)
 ...K DVBAQTSL
"RTN","DVBCIRPT",54,0)
 ..D CLEANUP
"RTN","DVBCIRPT",55,0)
 D KVARS
"RTN","DVBCIRPT",56,0)
 Q
"RTN","DVBCIRPT",57,0)
 ;
"RTN","DVBCIRPT",58,0)
KVARS ;** Kill the variables used in report
"RTN","DVBCIRPT",59,0)
 K DVBAOUT,ENDDT,BEGDT,DTOUT,DUOUT,RPTTYPE,DVBACAN,DVBASTAT
"RTN","DVBCIRPT",60,0)
 D CLEANUP
"RTN","DVBCIRPT",61,0)
 Q
"RTN","DVBCIRPT",62,0)
 ;
"RTN","DVBCIRPT",63,0)
CLEANUP ;** Kill the variables used by the device handler
"RTN","DVBCIRPT",64,0)
 K %ZIS,POP,%IS,IOP
"RTN","DVBCIRPT",65,0)
 K IOBS,IOHG,IOPAR,IOUPAR,IOXY,POP,%DT,%YY,%XX,ION,IOPAR
"RTN","DVBCIRPT",66,0)
 Q
"RTN","DVBCIRPT",67,0)
 ;
"RTN","DVBCIRPT",68,0)
DEVSEL ;** Select the device to report to
"RTN","DVBCIRPT",69,0)
 S %ZIS="AEQ"
"RTN","DVBCIRPT",70,0)
 S %ZIS("A")="Output device: "
"RTN","DVBCIRPT",71,0)
 D ^%ZIS
"RTN","DVBCIRPT",72,0)
 Q
"RTN","DVBCIRPT",73,0)
 ;
"RTN","DVBCIRPT",74,0)
SUM ;** Set up reason counter array, count all 2507's received
"RTN","DVBCIRPT",75,0)
 U IO
"RTN","DVBCIRPT",76,0)
 S (DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM)=0
"RTN","DVBCIRPT",77,0)
 S DVBACAN("REQ")=0,DVBACAN("EXM")=0
"RTN","DVBCIRPT",78,0)
 S DVBAENDL=ENDDT
"RTN","DVBCIRPT",79,0)
 ;
"RTN","DVBCIRPT",80,0)
 ;** Initialize reason counter array
"RTN","DVBCIRPT",81,0)
 F DVBARIFN=0:0 S DVBARIFN=$O(^DVB(396.94,DVBARIFN)) Q:+DVBARIFN'>0  DO
"RTN","DVBCIRPT",82,0)
 .S DVBAINXM(DVBARIFN)=0
"RTN","DVBCIRPT",83,0)
 S DVBAINXM("NO REASON")=0
"RTN","DVBCIRPT",84,0)
 ;
"RTN","DVBCIRPT",85,0)
 ;** Count the total and insufficient number of exams and 2507 requests
"RTN","DVBCIRPT",86,0)
 S DVBADTLP=BEGDT-.0001
"RTN","DVBCIRPT",87,0)
 F  S DVBADTLP=$O(^DVB(396.3,"ADP",DVBADTLP)) Q:(DVBADTLP=""!(DVBADTLP>ENDDT))  DO
"RTN","DVBCIRPT",88,0)
 .S DVBAPRIO=""
"RTN","DVBCIRPT",89,0)
 .F  S DVBAPRIO=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO)) Q:DVBAPRIO=""  DO
"RTN","DVBCIRPT",90,0)
 ..S DVBADALP=""
"RTN","DVBCIRPT",91,0)
 ..F  S DVBADALP=$O(^DVB(396.3,"ADP",DVBADTLP,DVBAPRIO,DVBADALP)) Q:DVBADALP=""  DO
"RTN","DVBCIRPT",92,0)
 ...S DVBARQCT=DVBARQCT+1
"RTN","DVBCIRPT",93,0)
 ...K DVBAINSF
"RTN","DVBCIRPT",94,0)
 ...I DVBAPRIO="E" DO
"RTN","DVBCIRPT",95,0)
 ....S DVBAINRQ=DVBAINRQ+1
"RTN","DVBCIRPT",96,0)
 ....I $P(^DVB(396.3,DVBADALP,0),U,18)="RX" S DVBACAN("REQ")=DVBACAN("REQ")+1
"RTN","DVBCIRPT",97,0)
 ....S DVBAINSF=""
"RTN","DVBCIRPT",98,0)
 ...S DVBAXMDA=""
"RTN","DVBCIRPT",99,0)
 ...F  S DVBAXMDA=$O(^DVB(396.4,"C",DVBADALP,DVBAXMDA)) Q:DVBAXMDA=""  DO
"RTN","DVBCIRPT",100,0)
 ....S DVBAXMCT=DVBAXMCT+1
"RTN","DVBCIRPT",101,0)
 ....I $D(DVBAINSF) DO
"RTN","DVBCIRPT",102,0)
 .....S DVBAINXM=DVBAINXM+1
"RTN","DVBCIRPT",103,0)
 .....S DVBARIFN=$P(^DVB(396.4,DVBAXMDA,0),U,11),DVBASTAT=$P(^(0),U,4)
"RTN","DVBCIRPT",104,0)
 .....S:DVBARIFN="" DVBARIFN="NO REASON"
"RTN","DVBCIRPT",105,0)
 .....S DVBAINXM(DVBARIFN)=DVBAINXM(DVBARIFN)+1
"RTN","DVBCIRPT",106,0)
 .....I DVBASTAT="RX" S DVBACAN("EXM")=DVBACAN("EXM")+1
"RTN","DVBCIRPT",107,0)
 D SUMRPT^DVBCIRP1
"RTN","DVBCIRPT",108,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","DVBCIRPT",109,0)
 D SUMKILL
"RTN","DVBCIRPT",110,0)
 D ^%ZISC
"RTN","DVBCIRPT",111,0)
 Q
"RTN","DVBCIRPT",112,0)
 ;
"RTN","DVBCIRPT",113,0)
SUMKILL ;** Kill the variables used in the summary report
"RTN","DVBCIRPT",114,0)
 K DVBADTLP,DVBAENDL,DVBARQCT,DVBAINRQ,DVBAXMCT,DVBAINXM
"RTN","DVBCIRPT",115,0)
 K DVBAPRIO,DVBADALP,DVBAXMDA,DVBAINSF,DVBARIFN
"RTN","DVBCIRPT",116,0)
 Q
"VER")
8.0^21.0
**END**
**END**
