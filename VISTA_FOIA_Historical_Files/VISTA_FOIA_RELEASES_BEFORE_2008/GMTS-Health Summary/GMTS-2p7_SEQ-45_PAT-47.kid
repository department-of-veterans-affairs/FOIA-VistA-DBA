Released GMTS*2.7*47 SEQ #45
Extracted from mail message
**KIDS**:GMTS*2.7*47^

**INSTALL NAME**
GMTS*2.7*47
"BLD",2973,0)
GMTS*2.7*47^HEALTH SUMMARY^0^3010921^y
"BLD",2973,1,0)
^^2^2^3010424^
"BLD",2973,1,1,0)
The description of this build is found in the National Patch Module under 
"BLD",2973,1,2,0)
patch GMTS*2.7*47.
"BLD",2973,4,0)
^9.64PA^142^2
"BLD",2973,4,142,0)
142
"BLD",2973,4,142,2,0)
^9.641^142^1
"BLD",2973,4,142,2,142,0)
HEALTH SUMMARY TYPE  (File-top level)
"BLD",2973,4,142,2,142,1,0)
^9.6411^.01^1
"BLD",2973,4,142,2,142,1,.01,0)
NAME
"BLD",2973,4,142,222)
y^y^p^^^^n
"BLD",2973,4,142.98,0)
142.98
"BLD",2973,4,142.98,222)
y^y^f^^^^n
"BLD",2973,4,"APDD",142,142)

"BLD",2973,4,"APDD",142,142,.01)

"BLD",2973,4,"B",142,142)

"BLD",2973,4,"B",142.98,142.98)

"BLD",2973,"INID")
^y
"BLD",2973,"INIT")
POST^GMTSP47
"BLD",2973,"KRN",0)
^9.67PA^19^17
"BLD",2973,"KRN",.4,0)
.4
"BLD",2973,"KRN",.4,"NM",0)
^9.68A^3^3
"BLD",2973,"KRN",.4,"NM",1,0)
GMTS TYPE INQ    FILE #142^142^0
"BLD",2973,"KRN",.4,"NM",2,0)
GMTS TYPE INQ HEADER    FILE #142^142^0
"BLD",2973,"KRN",.4,"NM",3,0)
GMTS TYPE INQ FOOTER    FILE #142^142^0
"BLD",2973,"KRN",.4,"NM","B","GMTS TYPE INQ    FILE #142",1)

"BLD",2973,"KRN",.4,"NM","B","GMTS TYPE INQ FOOTER    FILE #142",3)

"BLD",2973,"KRN",.4,"NM","B","GMTS TYPE INQ HEADER    FILE #142",2)

"BLD",2973,"KRN",.401,0)
.401
"BLD",2973,"KRN",.402,0)
.402
"BLD",2973,"KRN",.403,0)
.403
"BLD",2973,"KRN",.5,0)
.5
"BLD",2973,"KRN",.84,0)
.84
"BLD",2973,"KRN",3.6,0)
3.6
"BLD",2973,"KRN",3.8,0)
3.8
"BLD",2973,"KRN",9.2,0)
9.2
"BLD",2973,"KRN",9.8,0)
9.8
"BLD",2973,"KRN",9.8,"NM",0)
^9.68A^53^53
"BLD",2973,"KRN",9.8,"NM",1,0)
GMTSRAI^^0^B8075283
"BLD",2973,"KRN",9.8,"NM",2,0)
GMTSXA^^0^B17389628
"BLD",2973,"KRN",9.8,"NM",3,0)
GMTSXAB^^0^B8402043
"BLD",2973,"KRN",9.8,"NM",4,0)
GMTSXAC^^0^B29712865
"BLD",2973,"KRN",9.8,"NM",5,0)
GMTSXAD^^0^B26430744
"BLD",2973,"KRN",9.8,"NM",6,0)
GMTSXAL^^0^B47713538
"BLD",2973,"KRN",9.8,"NM",7,0)
GMTSXAO^^0^B8753258
"BLD",2973,"KRN",9.8,"NM",8,0)
GMTSXAP^^0^B58274118
"BLD",2973,"KRN",9.8,"NM",9,0)
GMTSXAP2^^0^B31822874
"BLD",2973,"KRN",9.8,"NM",10,0)
GMTSXAW^^0^B24594346
"BLD",2973,"KRN",9.8,"NM",11,0)
GMTSXAW2^^0^B20754336
"BLD",2973,"KRN",9.8,"NM",12,0)
GMTSPXOP^^0^B47881208
"BLD",2973,"KRN",9.8,"NM",13,0)
GMTSDGCH^^0^B21163584
"BLD",2973,"KRN",9.8,"NM",14,0)
GMTSDGC1^^0^B12185517
"BLD",2973,"KRN",9.8,"NM",15,0)
GMTSRM^^0^B15567698
"BLD",2973,"KRN",9.8,"NM",16,0)
GMTSRM2^^0^B10129036
"BLD",2973,"KRN",9.8,"NM",17,0)
GMTSPD^^0^B16848741
"BLD",2973,"KRN",9.8,"NM",18,0)
GMTSPL^^0^B25267337
"BLD",2973,"KRN",9.8,"NM",19,0)
GMTSLRAE^^0^B28526176
"BLD",2973,"KRN",9.8,"NM",20,0)
GMTSLRA^^0^B15741122
"BLD",2973,"KRN",9.8,"NM",21,0)
GMTSLRCP^^0^B26103948
"BLD",2973,"KRN",9.8,"NM",22,0)
GMTSLRM^^0^B24007882
"BLD",2973,"KRN",9.8,"NM",23,0)
GMTSLRMB^^0^B21099281
"BLD",2973,"KRN",9.8,"NM",24,0)
GMTSLRS^^0^B7423038
"BLD",2973,"KRN",9.8,"NM",25,0)
GMTSLRS7^^0^B11792281
"BLD",2973,"KRN",9.8,"NM",26,0)
GMTSLRSC^^0^B11892340
"BLD",2973,"KRN",9.8,"NM",27,0)
GMTSLRSE^^0^B7379227
"BLD",2973,"KRN",9.8,"NM",28,0)
GMTSPN^^0^B64160267
"BLD",2973,"KRN",9.8,"NM",29,0)
GMTSPN2^^0^B51711119
"BLD",2973,"KRN",9.8,"NM",30,0)
GMTSDS^^0^B2113585
"BLD",2973,"KRN",9.8,"NM",31,0)
GMTSDSB^^0^B2299171
"BLD",2973,"KRN",9.8,"NM",32,0)
GMTSLRC^^0^B5580058
"BLD",2973,"KRN",9.8,"NM",33,0)
GMTSORC3^^0^B10670476
"BLD",2973,"KRN",9.8,"NM",34,0)
GMTSPP^^0^B21869344
"BLD",2973,"KRN",9.8,"NM",35,0)
GMTSMCMA^^0^B26406266
"BLD",2973,"KRN",9.8,"NM",36,0)
GMTSLROS^^0^B3076639
"BLD",2973,"KRN",9.8,"NM",37,0)
GMTSULT^^0^B71331926
"BLD",2973,"KRN",9.8,"NM",38,0)
GMTSULT7^^0^B29646296
"BLD",2973,"KRN",9.8,"NM",39,0)
GMTSXAW3^^0^B25968976
"BLD",2973,"KRN",9.8,"NM",40,0)
GMTSU^^0^B52089849
"BLD",2973,"KRN",9.8,"NM",41,0)
GMTSADH^^0^B15780387
"BLD",2973,"KRN",9.8,"NM",42,0)
GMTSADH1^^0^B17194984
"BLD",2973,"KRN",9.8,"NM",43,0)
GMTSADHC^^0^B19179293
"BLD",2973,"KRN",9.8,"NM",44,0)
GMTSADOR^^0^B12035733
"BLD",2973,"KRN",9.8,"NM",45,0)
GMTSORC^^0^B2015928
"BLD",2973,"KRN",9.8,"NM",46,0)
GMTSRAS^^0^B43059243
"BLD",2973,"KRN",9.8,"NM",47,0)
GMTSRAE^^0^B54499362
"BLD",2973,"KRN",9.8,"NM",48,0)
GMTSUP^^0^B14910426
"BLD",2973,"KRN",9.8,"NM",49,0)
GMTSUP1^^0^B18024579
"BLD",2973,"KRN",9.8,"NM",50,0)
GMTSLROE^^0^B11334514
"BLD",2973,"KRN",9.8,"NM",51,0)
GMTSCNB^^0^B47434020
"BLD",2973,"KRN",9.8,"NM",52,0)
GMTSLRB^^0^B2674647
"BLD",2973,"KRN",9.8,"NM",53,0)
GMTSLRT^^0^B4287822
"BLD",2973,"KRN",9.8,"NM","B","GMTSADH",41)

"BLD",2973,"KRN",9.8,"NM","B","GMTSADH1",42)

"BLD",2973,"KRN",9.8,"NM","B","GMTSADHC",43)

"BLD",2973,"KRN",9.8,"NM","B","GMTSADOR",44)

"BLD",2973,"KRN",9.8,"NM","B","GMTSCNB",51)

"BLD",2973,"KRN",9.8,"NM","B","GMTSDGC1",14)

"BLD",2973,"KRN",9.8,"NM","B","GMTSDGCH",13)

"BLD",2973,"KRN",9.8,"NM","B","GMTSDS",30)

"BLD",2973,"KRN",9.8,"NM","B","GMTSDSB",31)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRA",20)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRAE",19)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRB",52)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRC",32)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRCP",21)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRM",22)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRMB",23)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLROE",50)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLROS",36)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRS",24)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRS7",25)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRSC",26)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRSE",27)

"BLD",2973,"KRN",9.8,"NM","B","GMTSLRT",53)

"BLD",2973,"KRN",9.8,"NM","B","GMTSMCMA",35)

"BLD",2973,"KRN",9.8,"NM","B","GMTSORC",45)

"BLD",2973,"KRN",9.8,"NM","B","GMTSORC3",33)

"BLD",2973,"KRN",9.8,"NM","B","GMTSPD",17)

"BLD",2973,"KRN",9.8,"NM","B","GMTSPL",18)

"BLD",2973,"KRN",9.8,"NM","B","GMTSPN",28)

"BLD",2973,"KRN",9.8,"NM","B","GMTSPN2",29)

"BLD",2973,"KRN",9.8,"NM","B","GMTSPP",34)

"BLD",2973,"KRN",9.8,"NM","B","GMTSPXOP",12)

"BLD",2973,"KRN",9.8,"NM","B","GMTSRAE",47)

"BLD",2973,"KRN",9.8,"NM","B","GMTSRAI",1)

"BLD",2973,"KRN",9.8,"NM","B","GMTSRAS",46)

"BLD",2973,"KRN",9.8,"NM","B","GMTSRM",15)

"BLD",2973,"KRN",9.8,"NM","B","GMTSRM2",16)

"BLD",2973,"KRN",9.8,"NM","B","GMTSU",40)

"BLD",2973,"KRN",9.8,"NM","B","GMTSULT",37)

"BLD",2973,"KRN",9.8,"NM","B","GMTSULT7",38)

"BLD",2973,"KRN",9.8,"NM","B","GMTSUP",48)

"BLD",2973,"KRN",9.8,"NM","B","GMTSUP1",49)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXA",2)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXAB",3)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXAC",4)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXAD",5)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXAL",6)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXAO",7)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXAP",8)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXAP2",9)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXAW",10)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXAW2",11)

"BLD",2973,"KRN",9.8,"NM","B","GMTSXAW3",39)

"BLD",2973,"KRN",19,0)
19
"BLD",2973,"KRN",19,"NM",0)
^9.68A^10^9
"BLD",2973,"KRN",19,"NM",1,0)
GMTS GUI HS LIST DEFAULTS^^0
"BLD",2973,"KRN",19,"NM",2,0)
GMTS GUI HS LIST METHOD^^0
"BLD",2973,"KRN",19,"NM",3,0)
GMTS GUI HS LIST PARAMETERS^^0
"BLD",2973,"KRN",19,"NM",4,0)
GMTS GUI HS LIST PRECEDENCE^^0
"BLD",2973,"KRN",19,"NM",5,0)
GMTS GUI REPORTS LIST MENU^^0
"BLD",2973,"KRN",19,"NM",6,0)
GMTS COORDINATOR^^2
"BLD",2973,"KRN",19,"NM",7,0)
GMTS ENHANCED USER^^2
"BLD",2973,"KRN",19,"NM",9,0)
GMTS IRM/ADPAC MAINT MENU^^2
"BLD",2973,"KRN",19,"NM",10,0)
GMTS USER^^2
"BLD",2973,"KRN",19,"NM","B","GMTS COORDINATOR",6)

"BLD",2973,"KRN",19,"NM","B","GMTS ENHANCED USER",7)

"BLD",2973,"KRN",19,"NM","B","GMTS GUI HS LIST DEFAULTS",1)

"BLD",2973,"KRN",19,"NM","B","GMTS GUI HS LIST METHOD",2)

"BLD",2973,"KRN",19,"NM","B","GMTS GUI HS LIST PARAMETERS",3)

"BLD",2973,"KRN",19,"NM","B","GMTS GUI HS LIST PRECEDENCE",4)

"BLD",2973,"KRN",19,"NM","B","GMTS GUI REPORTS LIST MENU",5)

"BLD",2973,"KRN",19,"NM","B","GMTS IRM/ADPAC MAINT MENU",9)

"BLD",2973,"KRN",19,"NM","B","GMTS USER",10)

"BLD",2973,"KRN",19.1,0)
19.1
"BLD",2973,"KRN",101,0)
101
"BLD",2973,"KRN",409.61,0)
409.61
"BLD",2973,"KRN",771,0)
771
"BLD",2973,"KRN",870,0)
870
"BLD",2973,"KRN",8994,0)
8994
"BLD",2973,"KRN","B",.4,.4)

"BLD",2973,"KRN","B",.401,.401)

"BLD",2973,"KRN","B",.402,.402)

"BLD",2973,"KRN","B",.403,.403)

"BLD",2973,"KRN","B",.5,.5)

"BLD",2973,"KRN","B",.84,.84)

"BLD",2973,"KRN","B",3.6,3.6)

"BLD",2973,"KRN","B",3.8,3.8)

"BLD",2973,"KRN","B",9.2,9.2)

"BLD",2973,"KRN","B",9.8,9.8)

"BLD",2973,"KRN","B",19,19)

"BLD",2973,"KRN","B",19.1,19.1)

"BLD",2973,"KRN","B",101,101)

"BLD",2973,"KRN","B",409.61,409.61)

"BLD",2973,"KRN","B",771,771)

"BLD",2973,"KRN","B",870,870)

"BLD",2973,"KRN","B",8994,8994)

"BLD",2973,"QUES",0)
^9.62^^
"BLD",2973,"REQB",0)
^9.611^7^6
"BLD",2973,"REQB",1,0)
GMTS*2.7*36^2
"BLD",2973,"REQB",3,0)
GMTS*2.7*29^2
"BLD",2973,"REQB",4,0)
GMTS*2.7*45^2
"BLD",2973,"REQB",5,0)
GMTS*2.7*46^2
"BLD",2973,"REQB",6,0)
GMTS*2.7*40^2
"BLD",2973,"REQB",7,0)
OR*3.0*109^2
"BLD",2973,"REQB","B","GMTS*2.7*29",3)

"BLD",2973,"REQB","B","GMTS*2.7*36",1)

"BLD",2973,"REQB","B","GMTS*2.7*40",6)

"BLD",2973,"REQB","B","GMTS*2.7*45",4)

"BLD",2973,"REQB","B","GMTS*2.7*46",5)

"BLD",2973,"REQB","B","OR*3.0*109",7)

"FIA",142)
HEALTH SUMMARY TYPE
"FIA",142,0)
^GMT(142,
"FIA",142,0,0)
142
"FIA",142,0,1)
y^y^p^^^^n
"FIA",142,0,10)

"FIA",142,0,11)

"FIA",142,0,"RLRO")

"FIA",142,0,"VR")
2.7^GMTS
"FIA",142,142)
1
"FIA",142,142,.01)

"FIA",142.98)
HEALTH SUMMARY USER PREFERENCES
"FIA",142.98,0)
^GMT(142.98,
"FIA",142.98,0,0)
142.98P
"FIA",142.98,0,1)
y^y^f^^^^n
"FIA",142.98,0,10)

"FIA",142.98,0,11)

"FIA",142.98,0,"RLRO")

"FIA",142.98,0,"VR")
2.7^GMTS
"FIA",142.98,142.98)
0
"INIT")
POST^GMTSP47
"IX",142,142,"HST",0)
142^HST^Uniqueness Index for Key 'A' of File #142^R^^F^IR^I^142^^^^^LS
"IX",142,142,"HST",1)
S ^GMT(142,"HST",X,DA)=""
"IX",142,142,"HST",2)
K ^GMT(142,"HST",X,DA)
"IX",142,142,"HST",2.5)
K ^GMT(142,"HST")
"IX",142,142,"HST",11.1,0)
^.114IA^1^1
"IX",142,142,"HST",11.1,1,0)
1^F^142^.01^^1
"KEY",142,142,"A",0)
142^A^P^90
"KEY",142,142,"A",2,0)
^.312IA^1^1
"KEY",142,142,"A",2,1,0)
.01^142^1
"KEYPTR",142,142,"A")
142^HST
"KRN",.4,206,-1)
0^2
"KRN",.4,206,0)
GMTS TYPE INQ HEADER^3000821.1101^^142^^^3010917
"KRN",.4,206,"F",1)
"HEALTH SUMMARY TYPE INQUIRY";C24~"         Type Name:";C1;S1~.01~"             Title:";C1~.02~"             Owner:";C1~.06~"";C44~
"KRN",.4,206,"F",2)
W:$P($G(^GMT(142,D0,0)),"^",2)'="" "LOCK: ";Z;"W:$P($G(^GMT(142,D0,0)),"^",2)'="" "LOCK: ""~.05;C53;L25~
"KRN",.4,206,"F",3)
"SUPPRESS PRINT OF COMPONENTS WITHOUT DATA:";C1~.08~"                                   Max        Hos  ICD   Pro  CPT";C1;S1~
"KRN",.4,206,"F",4)
"Abb   Ord    Component Name        Occ  Time  Loc  Text  Nar  Mod  Selection";C1~
"KRN",.4,206,"F",5)
"------------------------------------------------------------------------------";C1~
"KRN",.4,206,"H")
@
"KRN",.4,206,"SUB")
1
"KRN",.4,207,-1)
0^1
"KRN",.4,207,0)
GMTS TYPE INQ^3000821.1057^^142^^^3010917^
"KRN",.4,207,"DXS")
3
"KRN",.4,207,"DXS",1,9.2)
S I(1,0)=$S($D(D1):D1,1:""),I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^GMT(142,D0,1,D1,0)):^(0),1:""),D0=$P(DIP(1),U,2) S:'$D(^GMT(142.1,+D0,0)) D0=-1
"KRN",.4,207,"DXS",2,9)
W $S($L($P(X,U,5)):$E($P(X,U,5),1,20),$P(^GMT(142.1,$P(X,U,2),0),U,9)]"":$E($P(^(0),U,9),1,20),1:$E($P(^GMT(142.1,$P(X,U,2),0),U),1,20))
"KRN",.4,207,"F",1)
1,X DXS(1,9.2) S DIP(101)=$S($D(^GMT(142.1,D0,0)):^(0),1:"") S X=$P(DIP(101),U,4) S D0=I(0,0) S D1=I(1,0) W X K DIP;C1;L4;Z;"COMPONENT:ABBREV"~
"KRN",.4,207,"F",2)
1,.01;C7;L4~1,"";C10~1,I $P(X,U,2),$P(^GMT(142.1,$P(X,U,2),0),U,6)'="" W "*";Z;"I $P(X,U,2),$P(^GMT(142.1,$P(X,U,2),0),U,6)'="" W "*""~1,"";C13~
"KRN",.4,207,"F",3)
1,X DXS(2,9);Z;"W $S($L($P(X,U,5)):$E($P(X,U,5),1,20),$P(^GMT(142.1,$P(X,U,2),0),U,9)]"":$E($P(^(0),U,9),1,20),1:$E($P(^GMT(142.1,$P(X,U,2),0),U),1,20))"~
"KRN",.4,207,"F",4)
1,2;C36;L3~1,3;C41;L4~1,6;C47;L3~1,7;C52;L5~1,8;C58;L3~1,9;C63;L3~1,4,.01;C68;L(IOM-68)~
"KRN",.4,207,"H")
[GMTS TYPE INQ HEADER]-[GMTS TYPE INQ FOOTER]
"KRN",.4,208,-1)
0^3
"KRN",.4,208,0)
GMTS TYPE INQ FOOTER^2901011.1808^^142^^^3010917^
"KRN",.4,208,"F",2)
"               * = Disabled Components";C1~
"KRN",.4,208,"H")
@
"KRN",.4,208,"SUB")
1
"KRN",19,1988,-1)
2^6
"KRN",19,1988,0)
GMTS COORDINATOR^Health Summary Coordinator's Menu^^M^.5^^^^^^^126
"KRN",19,1988,10,0)
^19.01IP^5^5
"KRN",19,1988,10,5,0)
8529^5^5
"KRN",19,1988,10,5,"^")
GMTS GUI REPORTS LIST MENU
"KRN",19,1988,"U")
HEALTH SUMMARY COORDINATOR'S M
"KRN",19,1990,-1)
2^10
"KRN",19,1990,0)
GMTS USER^Health Summary Menu^^M^.5^^^^^^^
"KRN",19,1990,10,0)
^19.01IP^7^7
"KRN",19,1990,10,7,0)
8529^7^7
"KRN",19,1990,10,7,"^")
GMTS GUI REPORTS LIST MENU
"KRN",19,1990,"U")
HEALTH SUMMARY MENU
"KRN",19,2005,-1)
2^7
"KRN",19,2005,0)
GMTS ENHANCED USER^Health Summary Enhanced Menu^^M^.5^^^^^^^126
"KRN",19,2005,10,0)
^19.01IP^19^9
"KRN",19,2005,10,19,0)
8529^9^9
"KRN",19,2005,10,19,"^")
GMTS GUI REPORTS LIST MENU
"KRN",19,2005,"U")
HEALTH SUMMARY ENHANCED MENU
"KRN",19,4157,-1)
2^9
"KRN",19,4157,0)
GMTS IRM/ADPAC MAINT MENU^Health Summary Maintenance Menu^^M^.5^^^^^^y^126
"KRN",19,4157,10,0)
^19.01IP^8^8
"KRN",19,4157,10,8,0)
8529^8^8
"KRN",19,4157,10,8,"^")
GMTS GUI REPORTS LIST MENU
"KRN",19,4157,"U")
HEALTH SUMMARY MAINTENANCE MEN
"KRN",19,8529,-1)
0^5
"KRN",19,8529,0)
GMTS GUI REPORTS LIST MENU^CPRS Reports Tab 'Health Summary Types List' Menu^^M^^^^^^^^
"KRN",19,8529,10,0)
^19.01IP^4^4
"KRN",19,8529,10,1,0)
8530^1^1
"KRN",19,8529,10,1,"^")
GMTS GUI HS LIST DEFAULTS
"KRN",19,8529,10,2,0)
8531^2^2
"KRN",19,8529,10,2,"^")
GMTS GUI HS LIST PRECEDENCE
"KRN",19,8529,10,3,0)
8532^3^3
"KRN",19,8529,10,3,"^")
GMTS GUI HS LIST METHOD
"KRN",19,8529,10,4,0)
8533^4^4
"KRN",19,8529,10,4,"^")
GMTS GUI HS LIST PARAMETERS
"KRN",19,8529,99)
58461,58758
"KRN",19,8529,"U")
CPRS REPORTS TAB 'HEALTH SUMMA
"KRN",19,8530,-1)
0^1
"KRN",19,8530,0)
GMTS GUI HS LIST DEFAULTS^Display 'Health Summary Types List' Defaults^^R^^^^^^^^
"KRN",19,8530,25)
DISP^GMTSXA
"KRN",19,8530,"U")
DISPLAY 'HEALTH SUMMARY TYPES 
"KRN",19,8531,-1)
0^4
"KRN",19,8531,0)
GMTS GUI HS LIST PRECEDENCE^Precedence of 'Health Summary Types List'^^R^^^^^^^^
"KRN",19,8531,25)
PREC^GMTSXA
"KRN",19,8531,"U")
PRECEDENCE OF 'HEALTH SUMMARY 
"KRN",19,8532,-1)
0^2
"KRN",19,8532,0)
GMTS GUI HS LIST METHOD^Method of compiling 'Health Summary Types List'^^R^^^^^^^^
"KRN",19,8532,25)
METH^GMTSXA
"KRN",19,8532,"U")
METHOD OF COMPILING 'HEALTH SU
"KRN",19,8533,-1)
0^3
"KRN",19,8533,0)
GMTS GUI HS LIST PARAMETERS^Edit 'Health Summary Types List' Parameters^^R^^^^^^^^
"KRN",19,8533,25)
EDIT^GMTSXA
"KRN",19,8533,"U")
EDIT 'HEALTH SUMMARY TYPES LIS
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools^^^3010208
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2951020^11
"PKG",126,22,1,"PAH",1,0)
47^3010921
"PKG",126,22,1,"PAH",1,1,0)
^^2^2^3010921
"PKG",126,22,1,"PAH",1,1,1,0)
The description of this build is found in the National Patch Module under 
"PKG",126,22,1,"PAH",1,1,2,0)
patch GMTS*2.7*47.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
54
"RTN","GMTSADH")
0^41^B15780387
"RTN","GMTSADH",1,0)
GMTSADH ;SLC/JER,MAM - Ad Hoc Summary Driver ; 09/21/2001
"RTN","GMTSADH",2,0)
 ;;2.7;Health Summary;**30,35,47**;Oct 20, 1995
"RTN","GMTSADH",3,0)
 ;
"RTN","GMTSADH",4,0)
 ; External References
"RTN","GMTSADH",5,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSADH",6,0)
 ;   DBIA   148  PATIENT^ORU1
"RTN","GMTSADH",7,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSADH",8,0)
 ;   DBIA    82  EN^XQORM
"RTN","GMTSADH",9,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSADH",10,0)
 ;   DBIA 10102  DISP^XQORM1
"RTN","GMTSADH",11,0)
 ;                 
"RTN","GMTSADH",12,0)
MAIN ; Ad Hoc Health Summary Driver
"RTN","GMTSADH",13,0)
 N C,DFN,GMTSEG,GMTSEGI,GMTSEGC,GMTSQIT,GMTSTYP,GMTSTITL,GMW,X,Y,DIC,DIPGM,I,POP,%,DIROUT,DUOUT,DTOUT,ZTRTN,GMTSQIT,FROM,GMI,I1,ISVALID,LRDFN,PTR,SEX,TO,VAOA,VASD,VASV
"RTN","GMTSADH",14,0)
 I $L($T(PATIENT^ORU1)),($$VERSION^XPDUTL("OR")>2.19) D MAIN^GMTSADHC Q
"RTN","GMTSADH",15,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION",Y=$$TYPE^GMTSULT K DIC S GMTSTYP=+Y,GMTSTITL="AD HOC"
"RTN","GMTSADH",16,0)
 F  K GMTSEG,GMTSEGI,GMTSEGC D BUILD D  Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT) 
"RTN","GMTSADH",17,0)
 . N GMPAT,DFN,GMTSMULT F  D  Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)!(+$D(GMPAT)'>0)
"RTN","GMTSADH",18,0)
 . . Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSADH",19,0)
 . . K GMPAT,GMTSMULT F  Q:$D(DIROUT)  K DFN W ! D SELPT^GMTS Q:+($G(DFN))'>0  D
"RTN","GMTSADH",20,0)
 . . . N GMNAME S GMNAME=$P($G(^DPT(+DFN,0)),U) Q:GMNAME=""  S GMPAT(GMNAME,+($G(DFN)))=+($G(DFN))
"RTN","GMTSADH",21,0)
 . . Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)!(+$D(GMPAT)'>0)
"RTN","GMTSADH",22,0)
 . . D RESUB^GMTSDVR(.GMPAT) S ZTRTN="PQ^GMTS" N DUOUT D HSOUT^GMTSDVR,END^GMTS W !
"RTN","GMTSADH",23,0)
 Q
"RTN","GMTSADH",24,0)
BUILD ; Conducts Dialogue to build Ad Hoc Summary
"RTN","GMTSADH",25,0)
 N GMI,GMJ,GMW,X,XQORM,Y Q:$D(GMTSQIT)!($D(DIROUT))  W @IOF
"RTN","GMTSADH",26,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")",XQORM("M")=6
"RTN","GMTSADH",27,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="AD",XQORM("A")="Select NEW set of COMPONENT(S): ",XQORM("??")="D HELP^GMTSADH" D EN^XQORM I Y'>0 S DIROUT=1 Q
"RTN","GMTSADH",28,0)
 G:+Y&(X?1"^^".E) BUILD S GMTSEGC=Y,(X,GMI,GMJ)=0 F  S GMI=$O(Y(GMI)) Q:'GMI  D LOAD
"RTN","GMTSADH",29,0)
 D GETLIM^GMTSADH1
"RTN","GMTSADH",30,0)
 Q
"RTN","GMTSADH",31,0)
LOAD ; Load enabled components 
"RTN","GMTSADH",32,0)
 N SREC,STRN S STRN=+Y(GMI),SREC=^GMT(142,GMTSTYP,1,STRN,0)
"RTN","GMTSADH",33,0)
LOAD1 ; Load array GMTSEG and GMTSEGI
"RTN","GMTSADH",34,0)
 S GMJ=GMJ+1,GMTSEG(GMJ)=SREC,GMTSEGI($P(SREC,U,2))=GMJ D LOADSEL
"RTN","GMTSADH",35,0)
 Q
"RTN","GMTSADH",36,0)
LOADSEL ; Loads GMTSEG(J,FN,IFN)   (Selection Items)
"RTN","GMTSADH",37,0)
 N S2,SJ,SEL,SR,SF S S2=0,SJ=GMJ
"RTN","GMTSADH",38,0)
 F  S S2=$O(^GMT(142,GMTSTYP,1,STRN,1,S2)) Q:'S2  D
"RTN","GMTSADH",39,0)
 . S SEL=^(S2,0),SR=U_$P(SEL,";",2) Q:SR="^"
"RTN","GMTSADH",40,0)
 . S SF=+$P(@(SR_"0)"),U,2) Q:+SF=0
"RTN","GMTSADH",41,0)
 . S GMTSEG(GMJ,SF,S2)=$P(SEL,";"),GMTSEG(GMJ,SF,0)=SR
"RTN","GMTSADH",42,0)
 Q
"RTN","GMTSADH",43,0)
HELP ; Display Help Text
"RTN","GMTSADH",44,0)
 N GMJ,GMTSTXT,HLP S HLP=$S(X="??":"HTX2",X="?":"HTX1",1:"") I $L(HLP) W ! F GMJ=1:1 S GMTSTXT=$T(@HLP+GMJ) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSADH",45,0)
 I X="???" W !! D HELP2^GMTSUP1
"RTN","GMTSADH",46,0)
 D REDISP
"RTN","GMTSADH",47,0)
 Q
"RTN","GMTSADH",48,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSADH",49,0)
 N I,DIR,X,Y S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y
"RTN","GMTSADH",50,0)
 W @IOF D DISP^XQORM1 W !
"RTN","GMTSADH",51,0)
 Q
"RTN","GMTSADH",52,0)
HTX1 ;; Help Text for "?" and "??"
"RTN","GMTSADH",53,0)
 ;; Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADH",54,0)
 ;;
"RTN","GMTSADH",55,0)
 ;; Enter: ??  to see HELP for MULTIPLE SELECTION
"RTN","GMTSADH",56,0)
 ;;        ??? to see HELP for "^^"-jump
"RTN","GMTSADH",57,0)
 ;;
"RTN","GMTSADH",58,0)
 ;;ZZZZ
"RTN","GMTSADH",59,0)
HTX2 ;; Help Text for ??
"RTN","GMTSADH",60,0)
 ;;
"RTN","GMTSADH",61,0)
 ;; The Health Summary components you select at this prompt create
"RTN","GMTSADH",62,0)
 ;; an ADHOC Health Summary.
"RTN","GMTSADH",63,0)
 ;;
"RTN","GMTSADH",64,0)
 ;; Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADH",65,0)
 ;;
"RTN","GMTSADH",66,0)
 ;; ALL items may be selected by typing "ALL".
"RTN","GMTSADH",67,0)
 ;;
"RTN","GMTSADH",68,0)
 ;; EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSADH",69,0)
 ;;   For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSADH",70,0)
 ;;
"RTN","GMTSADH",71,0)
 ;; NOTE: Menu items are ordered alphabetically by the Component NAME.
"RTN","GMTSADH",72,0)
 ;;       However, the displayed text is the Header Name which generally 
"RTN","GMTSADH",73,0)
 ;;       is different from the Component Name. Component may be picked
"RTN","GMTSADH",74,0)
 ;;       by their abbreviation, Header Name or Component Name.
"RTN","GMTSADH",75,0)
 ;;
"RTN","GMTSADH",76,0)
 ;;ZZZZ
"RTN","GMTSADH1")
0^42^B17194984
"RTN","GMTSADH1",1,0)
GMTSADH1 ;SLC/JER,MAM - Ad Hoc Summary Driver ; 09/21/2001
"RTN","GMTSADH1",2,0)
 ;;2.7;Health Summary;**1,37,47**;Oct 20, 1995
"RTN","GMTSADH1",3,0)
 ;
"RTN","GMTSADH1",4,0)
 ; External References
"RTN","GMTSADH1",5,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSADH1",6,0)
 ;   DBIA 10140  EN^XQORM
"RTN","GMTSADH1",7,0)
 ;                  
"RTN","GMTSADH1",8,0)
GETLIM ; Get Limits/Flags (external entry)
"RTN","GMTSADH1",9,0)
 ;              
"RTN","GMTSADH1",10,0)
 ;   Time 
"RTN","GMTSADH1",11,0)
 ;   Occurrence
"RTN","GMTSADH1",12,0)
 ;   Selection Items
"RTN","GMTSADH1",13,0)
 ;   Hospital Location Display
"RTN","GMTSADH1",14,0)
 ;   ICD Text Display
"RTN","GMTSADH1",15,0)
 ;   Provider Narrative Display
"RTN","GMTSADH1",16,0)
 ;   CPT Modifier Display
"RTN","GMTSADH1",17,0)
 ;                  
"RTN","GMTSADH1",18,0)
 N LISTFLG,GMCHANGE,GMW,QUIT S GMCHANGE=0 D LIST
"RTN","GMTSADH1",19,0)
 F  S LISTFLG=0 D ASKCMPS Q:$D(QUIT)!$D(DIROUT)
"RTN","GMTSADH1",20,0)
 Q
"RTN","GMTSADH1",21,0)
LIST ; Lists defaults for Ad Hoc Summary
"RTN","GMTSADH1",22,0)
 S LISTFLG=1,GMCHANGE=0
"RTN","GMTSADH1",23,0)
 W @IOF,!,"                      Default Limits and Selection Items",!!
"RTN","GMTSADH1",24,0)
 W "     Component              Occ    Time   Hosp  ICD  Prov  CPT  Selection",!
"RTN","GMTSADH1",25,0)
 W "                            Limit  Limit  Loc   Txt  Narr  Mod  Item(s)",!
"RTN","GMTSADH1",26,0)
 N FLG,DTOUT S FLG=0
"RTN","GMTSADH1",27,0)
LIST1 ; Called by GMTSUP to list components
"RTN","GMTSADH1",28,0)
 ;   FLG=1 for Ad Hoc Health Summary Type
"RTN","GMTSADH1",29,0)
 ;   FLG=2 for other Health Summary Types
"RTN","GMTSADH1",30,0)
 N GMI,DIR,DUOUT,GMW S DIR(0)="E"
"RTN","GMTSADH1",31,0)
 S GMI=0 F  S GMI=$O(GMTSEG(GMI)) Q:GMI'>0  D SCRNLNTH Q:$D(DUOUT)!($D(DTOUT))  D LISTLIM D:($D(GMTSEG(GMI))=11)&('FLG) LISTSEL Q:$D(DUOUT)!($D(DTOUT))
"RTN","GMTSADH1",32,0)
 Q
"RTN","GMTSADH1",33,0)
SCRNLNTH ; Checks screen length
"RTN","GMTSADH1",34,0)
 I $Y>(IOSL-4) W ! D ^DIR S:$D(DTOUT) DIROUT="" Q:$D(DUOUT)!($D(DTOUT))  W @IOF
"RTN","GMTSADH1",35,0)
 Q
"RTN","GMTSADH1",36,0)
 ;                     
"RTN","GMTSADH1",37,0)
LISTLIM ; List Components and Limits for GMTSET() array
"RTN","GMTSADH1",38,0)
 ;   Component Abbreviation
"RTN","GMTSADH1",39,0)
 ;   Component Name
"RTN","GMTSADH1",40,0)
 ;   If not called by GMTSUP:
"RTN","GMTSADH1",41,0)
 ;      Time Limits
"RTN","GMTSADH1",42,0)
 ;      Occurrence Limits
"RTN","GMTSADH1",43,0)
 ;      Hospital Location
"RTN","GMTSADH1",44,0)
 ;      ICD Text
"RTN","GMTSADH1",45,0)
 ;      Provider Narrative
"RTN","GMTSADH1",46,0)
 ;      CPT Modifier
"RTN","GMTSADH1",47,0)
 ;                  
"RTN","GMTSADH1",48,0)
 N CREC S CREC=^GMT(142.1,$P(GMTSEG(GMI),U,2),0) W ! I FLG=2 D STAR
"RTN","GMTSADH1",49,0)
 W $P(CREC,U,4),?5,$S($L($P(GMTSEG(GMI),U,5)):$P(GMTSEG(GMI),U,5),$L($P(CREC,U,9)):$P(CREC,U,9),1:$E($P(CREC,U),1,24))
"RTN","GMTSADH1",50,0)
 W:'FLG ?28,$P(GMTSEG(GMI),U,3),?35,$P(GMTSEG(GMI),U,4)
"RTN","GMTSADH1",51,0)
 W:'FLG ?42,$P(GMTSEG(GMI),U,6),?48,$E($P(GMTSEG(GMI),U,7),1,5)
"RTN","GMTSADH1",52,0)
 W:'FLG ?53,$P(GMTSEG(GMI),U,8),?59,$P(GMTSEG(GMI),U,9)
"RTN","GMTSADH1",53,0)
 Q
"RTN","GMTSADH1",54,0)
STAR ; Writes * to indicate added component when called by
"RTN","GMTSADH1",55,0)
 ; GMTSUP for Health Summary Type other than AD HOC
"RTN","GMTSADH1",56,0)
 I $D(^GMT(142,+($G(GMTSTYP)),1,"C",$P(GMTSEG(GMI),U,2))) W " "
"RTN","GMTSADH1",57,0)
 E  W "*"
"RTN","GMTSADH1",58,0)
 Q
"RTN","GMTSADH1",59,0)
LISTSEL ; Lists default selection items
"RTN","GMTSADH1",60,0)
 N GMW,GMJ,GML S GMJ=$O(GMTSEG(GMI,0)),GML=0
"RTN","GMTSADH1",61,0)
 F GMW=1:1 S GML=$O(GMTSEG(GMI,GMJ,GML)) Q:GML=""  D SCRNLNTH Q:$D(DUOUT)!($D(DTOUT))  W:GMW'=1 ! W ?64,$E($P(@(GMTSEG(GMI,GMJ,0)_GMTSEG(GMI,GMJ,GML)_",0)"),U),1,15)
"RTN","GMTSADH1",62,0)
 Q
"RTN","GMTSADH1",63,0)
ASKCMPS ; Asks for components for new limits/sel items
"RTN","GMTSADH1",64,0)
 N GMI,GMW,GMX,ASKCPQIT,DIC,X,XQORM,Y I LISTFLG D
"RTN","GMTSADH1",65,0)
 . W !!,"To change limits, selection items, hospital location display, ICD"
"RTN","GMTSADH1",66,0)
 . W !,"text display, provider narrative display, or CPT Modifiers, enter "
"RTN","GMTSADH1",67,0)
 . W !,"components, one at a time or more than one, separated by commas."
"RTN","GMTSADH1",68,0)
 . W !,"You may select new components if you wish."
"RTN","GMTSADH1",69,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM("??")="D HELP^GMTSADH3"
"RTN","GMTSADH1",70,0)
 S XQORM(0)="A",XQORM("A")="Select COMPONENT(S) to EDIT or other COMPONENT(S) to ADD: "
"RTN","GMTSADH1",71,0)
 D EN^XQORM S:$D(DTOUT)!(X="^^") (DIROUT,QUIT)=1 I $D(DIROUT) Q
"RTN","GMTSADH1",72,0)
 I +Y,(X?1"^^".E) G ASKCMPS
"RTN","GMTSADH1",73,0)
 I $S(X="^":1,X=""&(GMCHANGE=0):1,1:0) S QUIT="" Q
"RTN","GMTSADH1",74,0)
 I X="",GMCHANGE D ASKLIST Q
"RTN","GMTSADH1",75,0)
 I X["^" W "  ??" Q
"RTN","GMTSADH1",76,0)
 S GMCHANGE=1,GMI=0 F  S GMI=$O(Y(GMI)) Q:GMI=""  S GMX=^GMT(142,+GMTSTYP,1,+Y(GMI),0) W !!,$P(Y(GMI),U,3) D CMPCOND Q:$D(DUOUT)!($D(DIROUT))
"RTN","GMTSADH1",77,0)
 S:'$D(DIROUT) LISTFLG=1
"RTN","GMTSADH1",78,0)
 Q
"RTN","GMTSADH1",79,0)
CMPCOND ; Checks component for new limits/sel items
"RTN","GMTSADH1",80,0)
 N OLD,SBS,CREC,SREC,STRN,CPCDQIT S OLD=0 I $D(GMTSEGI($P(GMX,U,2))) S SBS=GMTSEGI($P(GMX,U,2)),OLD=1
"RTN","GMTSADH1",81,0)
 S CREC=^GMT(142.1,$P(GMX,U,2),0)
"RTN","GMTSADH1",82,0)
 I OLD=0 S GMTSEGC=GMTSEGC+1,SREC=GMX,STRN=+GMX D LOAD1^GMTSADH S SBS=GMJ
"RTN","GMTSADH1",83,0)
 D CMPLIM^GMTSADH2
"RTN","GMTSADH1",84,0)
 Q
"RTN","GMTSADH1",85,0)
ASKLIST ; Asks whether to relist Component
"RTN","GMTSADH1",86,0)
 N DIR,X,Y S DIR(0)="YA",DIR("A")="Would you like to see Component Limits and Selection Items again?  (Y/N): ",DIR("B")="NO" W !
"RTN","GMTSADH1",87,0)
 D ^DIR I Y'>0,(GMCHANGE=1) S QUIT=1 Q
"RTN","GMTSADH1",88,0)
 S:$D(DTOUT) DIROUT=1 I $D(DIROUT) Q
"RTN","GMTSADH1",89,0)
 I $D(DIRUT),'$D(DUOUT) W "  ??"
"RTN","GMTSADH1",90,0)
 I $D(DIRUT)!(Y=0) Q
"RTN","GMTSADH1",91,0)
 D LIST
"RTN","GMTSADH1",92,0)
 Q
"RTN","GMTSADHC")
0^43^B19179293
"RTN","GMTSADHC",1,0)
GMTSADHC ; SLC/KER - Ad Hoc Summary Driver ; 09/21/2001
"RTN","GMTSADHC",2,0)
 ;;2.7;Health Summary;**6,27,28,30,31,35,47**;Oct 20, 1995
"RTN","GMTSADHC",3,0)
 ;
"RTN","GMTSADHC",4,0)
 ; External References
"RTN","GMTSADHC",5,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMTSADHC",6,0)
 ;   DBIA  2160  ^XUTL("OR")
"RTN","GMTSADHC",7,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSADHC",8,0)
 ;   DBIA   148  PATIENT^ORU1
"RTN","GMTSADHC",9,0)
 ;   DBIA    82  EN^XQORM
"RTN","GMTSADHC",10,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSADHC",11,0)
 ;   DBIA 10102  DISP^XQORM1
"RTN","GMTSADHC",12,0)
 ;                          
"RTN","GMTSADHC",13,0)
MAIN ; Ad Hoc Summary Driver
"RTN","GMTSADHC",14,0)
 N I,XQORSPEW,%T S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION",Y=$$TYPE^GMTSULT K DIC Q:+Y'>0  S GMTSTYP=+Y,GMTSTITL="AD HOC"
"RTN","GMTSADHC",15,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!'$D(GMTSEG)
"RTN","GMTSADHC",16,0)
 . K GMTSEG,GMTSEGI,GMTSEGC D BUILD Q:$D(DUOUT)!$D(DIROUT)!'$D(GMTSEG)
"RTN","GMTSADHC",17,0)
 . N GMPAT,GMP F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)!+$G(ORVP)
"RTN","GMTSADHC",18,0)
 . . K GMP,GMPAT
"RTN","GMTSADHC",19,0)
 . . I +$G(ORVP) S GMPAT(1)=+ORVP
"RTN","GMTSADHC",20,0)
 . . E  F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PTPC Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,$P($G(^VA(200,DUZ,100.1)),U,6)]"":1,1:0)  D
"RTN","GMTSADHC",21,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSADHC",22,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSADHC",23,0)
 . . D RESUB^GMTSDVR(.GMPAT) S ZTRTN="PQ^GMTSADHC" W !
"RTN","GMTSADHC",24,0)
 . . D HSOUT^GMTSDVR
"RTN","GMTSADHC",25,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSADHC",26,0)
 Q
"RTN","GMTSADHC",27,0)
PTPC ; Combined Patient/Patient Copy
"RTN","GMTSADHC",28,0)
 N GMTSPRO,GMTSVER S GMTSVER=+($$VERSION^XPDUTL("OR")),GMTSPRO=+($$PROK^GMTSU("ORU1",11))
"RTN","GMTSADHC",29,0)
 D:GMTSVER>2.9&(GMTSPRO) PATIENT^ORU1(.GMP,,"I  $P($G(^(""OOS"")),""^"")")
"RTN","GMTSADHC",30,0)
 D:GMTSVER'>2.9!('GMTSPRO) PATIENT^ORU1(.GMP) D PATCOPY^GMTSDVR(.GMP,.GMPAT)
"RTN","GMTSADHC",31,0)
 Q
"RTN","GMTSADHC",32,0)
PQ ; Queued subroutine to print Ad Hoc HS for each patient
"RTN","GMTSADHC",33,0)
 N GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPHDR,GMTSPNM,GMTSRB,GMTSSN,GMTSTOF,GMTSWARD,VADM,VAERR,VAIN,VAROOT
"RTN","GMTSADHC",34,0)
 S GMPAT=0 F  S GMPAT=$O(GMPAT(GMPAT)) Q:GMPAT'>0  D  Q:$D(GMTSQIT)!$D(DIROUT)
"RTN","GMTSADHC",35,0)
 . S DFN=+$G(GMPAT(GMPAT)) D EN^GMTS1
"RTN","GMTSADHC",36,0)
 Q
"RTN","GMTSADHC",37,0)
BUILD ; Conducts Dialogue to build ad hoc summary
"RTN","GMTSADHC",38,0)
 N GMI,GMJ,X,XQORM,Y Q:$D(GMTSQIT)!($D(DIROUT))  W @IOF
"RTN","GMTSADHC",39,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")",XQORM("M")=6
"RTN","GMTSADHC",40,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="AD",XQORM("A")="Select NEW set of COMPONENT(S): ",XQORM("??")="D HELP^GMTSADH" D EN^XQORM I Y'>0 S GMTSQIT="" Q
"RTN","GMTSADHC",41,0)
 I +Y,(X?1"^^".E) G BUILD
"RTN","GMTSADHC",42,0)
 S GMTSEGC=Y
"RTN","GMTSADHC",43,0)
 S (X,GMI,GMJ)=0 F  S GMI=$O(Y(GMI)) Q:'GMI  D LOAD
"RTN","GMTSADHC",44,0)
 D GETLIM^GMTSADH1
"RTN","GMTSADHC",45,0)
 Q
"RTN","GMTSADHC",46,0)
LOAD ; Load enabled components
"RTN","GMTSADHC",47,0)
 N SREC,STRN S STRN=+Y(GMI),SREC=^GMT(142,GMTSTYP,1,STRN,0)
"RTN","GMTSADHC",48,0)
LOAD1 ; Load GMTSEG and GMTSEGI arrays
"RTN","GMTSADHC",49,0)
 S GMJ=GMJ+1,GMTSEG(GMJ)=SREC,GMTSEGI($P(SREC,U,2))=GMJ D LOADSEL
"RTN","GMTSADHC",50,0)
 Q
"RTN","GMTSADHC",51,0)
LOADSEL ; Loads GMTSEG(J,FN,IFN)   (Selection Items)
"RTN","GMTSADHC",52,0)
 N SR,SF,S2,SEL S S2=0 F  S S2=$O(^GMT(142,GMTSTYP,1,STRN,1,S2)) Q:'S2  D
"RTN","GMTSADHC",53,0)
 . S SEL=^(S2,0),SR=U_$P(SEL,";",2) Q:SR="^"
"RTN","GMTSADHC",54,0)
 . S SF=+$P(@(SR_"0)"),U,2) Q:+SF=0
"RTN","GMTSADHC",55,0)
 . S GMTSEG(GMJ,SF,S2)=$P(SEL,";"),GMTSEG(GMI,SF,0)=SR
"RTN","GMTSADHC",56,0)
 Q
"RTN","GMTSADHC",57,0)
HELP ; Display Help Text 
"RTN","GMTSADHC",58,0)
 N GMJ,GMTSTXT,HLP S HLP=$S(X="??":"HTX2",X="?":"HTX1",1:"") I $L(HLP) W ! F GMJ=1:1 S GMTSTXT=$T(@HLP+GMJ) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSADHC",59,0)
 I X="???" W !! D HELP2^GMTSUP1
"RTN","GMTSADHC",60,0)
 D REDISP
"RTN","GMTSADHC",61,0)
 Q
"RTN","GMTSADHC",62,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSADHC",63,0)
 N I,DIR,X,Y S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y  W @IOF
"RTN","GMTSADHC",64,0)
 D DISP^XQORM1 W !
"RTN","GMTSADHC",65,0)
 Q
"RTN","GMTSADHC",66,0)
HTX1 ; Help Text for "?" and "??"
"RTN","GMTSADHC",67,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADHC",68,0)
 ;;
"RTN","GMTSADHC",69,0)
 ;;Enter: ??  to see HELP for MULTIPLE SELECTION
"RTN","GMTSADHC",70,0)
 ;;       ??? to see HELP for "^^"-jump
"RTN","GMTSADHC",71,0)
 ;;
"RTN","GMTSADHC",72,0)
 ;;ZZZZ
"RTN","GMTSADHC",73,0)
HTX2 ; Help Text for ??
"RTN","GMTSADHC",74,0)
 ;;
"RTN","GMTSADHC",75,0)
 ;;The Health Summary components you select at this prompt create
"RTN","GMTSADHC",76,0)
 ;;an ADHOC Health Summary.
"RTN","GMTSADHC",77,0)
 ;;
"RTN","GMTSADHC",78,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADHC",79,0)
 ;;
"RTN","GMTSADHC",80,0)
 ;;ALL items may be selected by typing "ALL".
"RTN","GMTSADHC",81,0)
 ;;
"RTN","GMTSADHC",82,0)
 ;;EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSADHC",83,0)
 ;;  For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSADHC",84,0)
 ;;
"RTN","GMTSADHC",85,0)
 ;;NOTE: Menu items are ordered alphabetically by the Component NAME.
"RTN","GMTSADHC",86,0)
 ;;      However, the displayed text is the Header Name which generally 
"RTN","GMTSADHC",87,0)
 ;;      is different from the Component Name. Component may be picked
"RTN","GMTSADHC",88,0)
 ;;      by their abbreviation, Header Name or Component Name.
"RTN","GMTSADHC",89,0)
 ;;
"RTN","GMTSADHC",90,0)
 ;;ZZZZ
"RTN","GMTSADOR")
0^44^B12035733
"RTN","GMTSADOR",1,0)
GMTSADOR ;SLC/KER - Ad Hoc Summary Driver ; 09/21/2001
"RTN","GMTSADOR",2,0)
 ;;2.7;Health Summary;**30,35,47**;Oct 20, 1995
"RTN","GMTSADOR",3,0)
 ;                     
"RTN","GMTSADOR",4,0)
 ; External References
"RTN","GMTSADOR",5,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSADOR",6,0)
 ;   DBIA 10140  EN^XQORM
"RTN","GMTSADOR",7,0)
 ;   DBIA 10102  DISP^XQORM1
"RTN","GMTSADOR",8,0)
 ;                     
"RTN","GMTSADOR",9,0)
MAIN ; External call to allow user to define components and
"RTN","GMTSADOR",10,0)
 ; defaults through the AD Hoc menu interface and print
"RTN","GMTSADOR",11,0)
 ; health summaries for a programmer-specified patient 
"RTN","GMTSADOR",12,0)
 ; and device. Called with:
"RTN","GMTSADOR",13,0)
 ;                     
"RTN","GMTSADOR",14,0)
 ;    DFN = Patient internal file record number (optional)
"RTN","GMTSADOR",15,0)
 ;          For OE/RR interface sets DFN to Patient DFN in
"RTN","GMTSADOR",16,0)
 ;          the ORVP variable.  If not defined a patient 
"RTN","GMTSADOR",17,0)
 ;          will be prompted for.
"RTN","GMTSADOR",18,0)
 ;                     
"RTN","GMTSADOR",19,0)
 N C,GMTSEG,GMTSEGI,GMTSEGC,GMTSQIT,GMTSTYP,GMTSTITL,GMW,X,Y,DIC,DIPGM,I,POP,%,GMTSMULT,DIROUT,DUOUT,DTOUT,ZTRTN
"RTN","GMTSADOR",20,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION" S Y=$$TYPE^GMTSULT K DIC Q:+Y'>0  S GMTSTYP=+Y,GMTSTITL="AD HOC"
"RTN","GMTSADOR",21,0)
 I $G(DFN)'>0 S DFN=$S($D(ORVP):$P(ORVP,";"),1:"") D:+DFN'>0 SELPT^GMTS
"RTN","GMTSADOR",22,0)
 Q:+($G(DFN))'>0  F  K GMTSEG,GMTSEGI,GMTSEGC D BUILD Q:$D(GMTSQIT)!($D(DIROUT))  D HSOUT^GMTS,END^GMTS S:$D(DTOUT) GMTSQIT="" Q:$D(GMTSQIT)!($D(DIROUT))
"RTN","GMTSADOR",23,0)
 D END
"RTN","GMTSADOR",24,0)
 Q
"RTN","GMTSADOR",25,0)
BUILD ; Conducts Dialogue to build Ad Hoc Summary
"RTN","GMTSADOR",26,0)
 N GMI,GMJ,GMW,X,XQORM,Y Q:$D(GMTSQIT)!($D(DIROUT))  W @IOF
"RTN","GMTSADOR",27,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""Y"")"
"RTN","GMTSADOR",28,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="DA",XQORM("A")="Select COMPONENT(S): ",XQORM("??")="D HELP^GMTSADH" D EN^XQORM I Y'>0 S GMTSQIT="" Q
"RTN","GMTSADOR",29,0)
 G:+Y&(X?1"^^".E) BUILD S GMTSEGC=Y,(X,GMI,GMJ)=0 F  S GMI=$O(Y(GMI)) Q:'GMI  D LOAD
"RTN","GMTSADOR",30,0)
 D GETLIM^GMTSADH1
"RTN","GMTSADOR",31,0)
 Q
"RTN","GMTSADOR",32,0)
LOAD ; Load enabled components
"RTN","GMTSADOR",33,0)
 N SREC,STRN S STRN=+Y(GMI),SREC=^GMT(142,GMTSTYP,1,STRN,0)
"RTN","GMTSADOR",34,0)
LOAD1 ; Load array GMTSEG
"RTN","GMTSADOR",35,0)
 S GMJ=GMJ+1,GMTSEG(GMJ)=SREC,GMTSEGI($P(SREC,U,2))=GMJ D LOADSEL
"RTN","GMTSADOR",36,0)
 Q
"RTN","GMTSADOR",37,0)
LOADSEL ; Loads GMTSEG(J,FN,IFN)  (Selection Items)
"RTN","GMTSADOR",38,0)
 N S2,SEL,SR,SF S S2=0 F  S S2=$O(^GMT(142,GMTSTYP,1,STRN,1,S2)) Q:'S2  D
"RTN","GMTSADOR",39,0)
 . S SEL=^(S2,0),SR=U_$P(SEL,";",2) Q:SR="^"
"RTN","GMTSADOR",40,0)
 . S SF=+$P(@(SR_"0)"),U,2) Q:+SF=0
"RTN","GMTSADOR",41,0)
 . S GMTSEG(GMJ,SF,S2)=$P(SEL,";"),GMTSEG(GMJ,SF,0)=SR
"RTN","GMTSADOR",42,0)
 Q
"RTN","GMTSADOR",43,0)
END ; Cleans up any residual locals
"RTN","GMTSADOR",44,0)
 K GMTSQIT,FROM,GMI,I1,ISVALID,LRDFN,PTR,SEX,TO,VAOA,VASD,VASV,X Q
"RTN","GMTSADOR",45,0)
HELP ; Display Help Text
"RTN","GMTSADOR",46,0)
 N GMJ,GMTSTXT,HLP S HLP=$S(X="??":"HTX2",X="?":"HTX1",1:"") I $L(HLP) W ! F GMJ=1:1 S GMTSTXT=$T(@HLP+GMJ) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSADOR",47,0)
 I X="???" W !! D HELP2^GMTSUP1
"RTN","GMTSADOR",48,0)
 D REDISP
"RTN","GMTSADOR",49,0)
 Q
"RTN","GMTSADOR",50,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSADOR",51,0)
 N I,DIR,X,Y S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y  W @IOF
"RTN","GMTSADOR",52,0)
 D DISP^XQORM1 W !
"RTN","GMTSADOR",53,0)
 Q
"RTN","GMTSADOR",54,0)
HTX1 ; Help Text for "?"
"RTN","GMTSADOR",55,0)
 ;; Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADOR",56,0)
 ;;
"RTN","GMTSADOR",57,0)
 ;; Enter: ??  to see HELP for MULTIPLE SELECTION
"RTN","GMTSADOR",58,0)
 ;;        ??? to see HELP for "^^"-jump
"RTN","GMTSADOR",59,0)
 ;;
"RTN","GMTSADOR",60,0)
 ;;ZZZZ
"RTN","GMTSADOR",61,0)
HTX2 ; Help Text for ??
"RTN","GMTSADOR",62,0)
 ;;
"RTN","GMTSADOR",63,0)
 ;; The Health Summary components you select at this prompt create
"RTN","GMTSADOR",64,0)
 ;; an ADHOC Health Summary.
"RTN","GMTSADOR",65,0)
 ;;
"RTN","GMTSADOR",66,0)
 ;; Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADOR",67,0)
 ;;
"RTN","GMTSADOR",68,0)
 ;; ALL items may be selected by typing "ALL".
"RTN","GMTSADOR",69,0)
 ;;
"RTN","GMTSADOR",70,0)
 ;; EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSADOR",71,0)
 ;;  For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSADOR",72,0)
 ;;
"RTN","GMTSADOR",73,0)
 ;;ZZZZ
"RTN","GMTSCNB")
0^51^B47434020
"RTN","GMTSCNB",1,0)
GMTSCNB ; SLC/KER - Consults Components Brief          ; 09/21/2001
"RTN","GMTSCNB",2,0)
 ;;2.7;Health Summary;**46,47**;Oct 20, 1995
"RTN","GMTSCNB",3,0)
 ; 
"RTN","GMTSCNB",4,0)
 ; External References
"RTN","GMTSCNB",5,0)
 ;   DBIA  3358  ^GMR(123,
"RTN","GMTSCNB",6,0)
 ;   DBIA 10040  ^SC(
"RTN","GMTSCNB",7,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSCNB",8,0)
 ;   DBIA  2056  $$GET1^DIQ     (file 123.1, 44)
"RTN","GMTSCNB",9,0)
 ;   DBIA  2056  GETS^DIQ       (file 123)
"RTN","GMTSCNB",10,0)
 ;   DBIA  2051  LIST^DIC       (file 123.02)
"RTN","GMTSCNB",11,0)
 ;                     
"RTN","GMTSCNB",12,0)
 Q
"RTN","GMTSCNB",13,0)
MAIN ; Consults - Brief
"RTN","GMTSCNB",14,0)
 K ^TMP("GMTSCN")
"RTN","GMTSCNB",15,0)
 N GMTSMAX,GMTSNMC,GMTSI,GMTSDFN S GMTSDFN=+($G(DFN))
"RTN","GMTSCNB",16,0)
 S:'$L($G(GMTS1)) GMTS1=6666666 S:'$L($G(GMTS2)) GMTS2=9999999
"RTN","GMTSCNB",17,0)
 S GMTS1=+($G(GMTS1)),GMTS2=+($G(GMTS2)),GMTSMAX=+($G(GMTSNDM)) S:GMTSMAX'>0 GMTSMAX=999999999
"RTN","GMTSCNB",18,0)
 S GMTSDFN=+($G(GMTSDFN)) Q:GMTSDFN=0  Q:'$D(^GMR(123,"AD",GMTSDFN))
"RTN","GMTSCNB",19,0)
 S:GMTS2>GMTS1 GMTSI=GMTS1,GMTS1=GMTS2,GMTS2=GMTSI S GMTSI=GMTS2-.00000001
"RTN","GMTSCNB",20,0)
 F  S GMTSI=$O(^GMR(123,"AD",GMTSDFN,GMTSI)) Q:+GMTSI=0!(GMTSI>GMTS1)  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",21,0)
 . S GMTSIEN=0 F  S GMTSIEN=$O(^GMR(123,"AD",GMTSDFN,GMTSI,GMTSIEN)) Q:+GMTSIEN=0  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",22,0)
 . . Q:+($G(GMTSNMC))>+($G(GMTSMAX))  K ^TMP("GMTSCN",$J)
"RTN","GMTSCNB",23,0)
 . . D EXT(GMTSIEN,GMTSI) Q:$D(GMTSQIT)  D BCD Q:$D(GMTSQIT)
"RTN","GMTSCNB",24,0)
 Q
"RTN","GMTSCNB",25,0)
BCD ;   Brief Consults Display
"RTN","GMTSCNB",26,0)
 Q:'$D(^TMP("GMTSCN",$J))  S GMTSNMC=+($G(GMTSNMC))+1
"RTN","GMTSCNB",27,0)
 D:GMTSNMC=1 BHDR Q:$D(GMTSQIT)
"RTN","GMTSCNB",28,0)
 N GMTSID,GMTSFI,GMTSIE S GMTSID=0
"RTN","GMTSCNB",29,0)
 F  S GMTSID=$O(^TMP("GMTSCN",$J,GMTSID)) Q:+GMTSID=0  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",30,0)
 . S GMTSFI=123,GMTSIE="" F  S GMTSIE=$O(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE)) Q:GMTSIE=""  D  Q:$D(GMTSQIT)
"RTN","GMTSCNB",31,0)
 . . N GMTSNB,GMTSRD,GMTSTO,GMTSVC,GMTSFM,GMTSLA,GMTSAD
"RTN","GMTSCNB",32,0)
 . . S GMTSNB=+($G(GMTSIE)) S:+GMTSNB=0 GMTSNB="?"
"RTN","GMTSCNB",33,0)
 . . S GMTSRD=$G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,3,"I"))
"RTN","GMTSCNB",34,0)
 . . S GMTSRD=$$UP^XLFSTR($S(+GMTSRD>0:$$ED^GMTSU(+GMTSRD),1:"UNKNOWN"))
"RTN","GMTSCNB",35,0)
 . . S GMTSFM=$$UP^XLFSTR($G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,2,"E")))
"RTN","GMTSCNB",36,0)
 . . S GMTSTO=$$UP^XLFSTR($G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,1,"E")))
"RTN","GMTSCNB",37,0)
 . . S GMTSLA=$$UP^XLFSTR($G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,40,1,1,"E")))
"RTN","GMTSCNB",38,0)
 . . S GMTSLD=$G(^TMP("GMTSCN",$J,GMTSID,GMTSFI,GMTSIE,40,1,2,"I"))
"RTN","GMTSCNB",39,0)
 . . S GMTSLD=$$UP^XLFSTR($S(+GMTSLD>0:$$ED^GMTSU(+GMTSLD),1:"UNKNOWN"))
"RTN","GMTSCNB",40,0)
 . . D WRT
"RTN","GMTSCNB",41,0)
 Q
"RTN","GMTSCNB",42,0)
BHDR ;   Brief Header
"RTN","GMTSCNB",43,0)
 N GMTSL S $P(GMTSL,"-",79)=""
"RTN","GMTSCNB",44,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Request Date/",?15,"Request From"
"RTN","GMTSCNB",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Number",?15,"Request To",?52,"Last Action",?67,"Action Date"
"RTN","GMTSCNB",46,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSL
"RTN","GMTSCNB",47,0)
 Q
"RTN","GMTSCNB",48,0)
WRT ;   Write Brief Consult
"RTN","GMTSCNB",49,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$E(GMTSRD,1,10),?15,GMTSFM,?52,GMTSLA,?67,GMTSLD
"RTN","GMTSCNB",50,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSNB,?15,GMTSTO
"RTN","GMTSCNB",51,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSCNB",52,0)
 Q
"RTN","GMTSCNB",53,0)
EXT(X,Y) ; Extract Consults
"RTN","GMTSCNB",54,0)
 K ^TMP("GMTSCN",$J),^UTILITY("DIQ1",$J) N DIC,DIQ,DR,GMTSFM,GMTSI
"RTN","GMTSCNB",55,0)
 N GMTSIEN,GMTSIENS,GMTSLA,GMTSRT,GMTSTY,GMTSVC
"RTN","GMTSCNB",56,0)
 S GMTSIEN=+($G(X)) Q:GMTSIEN=0  S GMTSI=+($G(Y))
"RTN","GMTSCNB",57,0)
 S DIC=123,GMTSIENS=+($G(GMTSIEN))_","
"RTN","GMTSCNB",58,0)
 S GMTSRT="^TMP(""GMTSCN"","_$J_","_GMTSI_")"
"RTN","GMTSCNB",59,0)
 S DIQ(0)="IE",DR=".01;1;2;3;9" D GETS^DIQ(123,GMTSIENS,DR,"EI",GMTSRT,"MSG")
"RTN","GMTSCNB",60,0)
 S GMTSFM=+($G(^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"I"))) S:+GMTSFM=0 GMTSFM=""
"RTN","GMTSCNB",61,0)
 S GMTSVC="" S:+GMTSFM>0 GMTSVC=$$GET1^DIQ(44,GMTSFM,9,"E") S:$G(GMTSVC)="NONE" GMTSVC=""
"RTN","GMTSCNB",62,0)
 S:$L(GMTSVC) ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"SVC")=GMTSVC
"RTN","GMTSCNB",63,0)
 S GMTSTY="" S:+GMTSFM>0 GMTSTY=$$GET1^DIQ(44,GMTSFM,2,"E")
"RTN","GMTSCNB",64,0)
 S GMTSFM=$$FM(($G(^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"E"))_"^"_GMTSTY_"^"_GMTSVC))
"RTN","GMTSCNB",65,0)
 S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,2,"E")=GMTSFM
"RTN","GMTSCNB",66,0)
 S GMTSLA=+($G(^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,9,"I")))
"RTN","GMTSCNB",67,0)
 S:+GMTSLA'>9 ^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,9,"E")=""
"RTN","GMTSCNB",68,0)
 I +GMTSLA>0 D
"RTN","GMTSCNB",69,0)
 . S GMTSLA=$$GET1^DIQ(123.1,GMTSLA,7,"E")
"RTN","GMTSCNB",70,0)
 . S ^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,9,"E")=GMTSLA
"RTN","GMTSCNB",71,0)
 S ^TMP("GMTSCN",$J,GMTSI,DIC,GMTSIENS,0)=(9999999-GMTSI)_"^"_$S(GMTSI>0:$$EDT^GMTSU((9999999-GMTSI)),1:"")
"RTN","GMTSCNB",72,0)
 D ACT
"RTN","GMTSCNB",73,0)
 Q
"RTN","GMTSCNB",74,0)
FM(X) ; From Service/Ward
"RTN","GMTSCNB",75,0)
 S X=$G(X) N GMTSTY,GMTSV S GMTSTY=$P(X,"^",2),GMTSV=$P(X,"^",3),X=$P(X,"^",1)
"RTN","GMTSCNB",76,0)
 I $L(X) S:+X>0&(GMTSTY="WARD")&(X'["WARD") X="WARD "_X S:+X'>0&(GMTSTY="WARD")&(X'["WARD") X=X_" WARD"
"RTN","GMTSCNB",77,0)
 S:($L(X)+$L(GMTSV)+3)'>30&($L(GMTSV))&(X'[GMTSV) X=X_" ("_GMTSV_")"
"RTN","GMTSCNB",78,0)
 S X=$$UP^XLFSTR(X)
"RTN","GMTSCNB",79,0)
 Q X
"RTN","GMTSCNB",80,0)
ACT ; Activity
"RTN","GMTSCNB",81,0)
 N GMTSL,GMTSFL,GMTSFLA,GMTSFLD,GMTSLA,GMTSLD,GMTSLR,GMTSAM,GMTSLM,GMTSLP,GMTSC,GMTSDI,Y,DR,GMTSIENL,GMTSIENS,GMTSMSG K ^TMP("DILIST",$J)
"RTN","GMTSCNB",82,0)
 S GMTSIENS=+GMTSIEN_",",GMTSIENL=","_GMTSIENS
"RTN","GMTSCNB",83,0)
 S DR="1I;2I;8;9;10"
"RTN","GMTSCNB",84,0)
 D LIST^DIC(123.02,GMTSIENL,DR,,"*",,,,,,.GMTSDI,.GMTSMSG)
"RTN","GMTSCNB",85,0)
 K:+($G(^TMP("DILIST",$J,0)))=0 ^TMP("DILIST",$J) Q:+($G(^TMP("DILIST",$J,0)))=0
"RTN","GMTSCNB",86,0)
 S GMTSLA="",GMTSLD=0,GMTSLR="",GMTSAM="",GMTSLP="",GMTSC=0
"RTN","GMTSCNB",87,0)
 S GMTSL=0
"RTN","GMTSCNB",88,0)
 F  S GMTSL=$O(^TMP("DILIST",$J,"ID",GMTSL)) Q:+GMTSL=0  D
"RTN","GMTSCNB",89,0)
 . I +($G(^TMP("DILIST",$J,"ID",GMTSL,2)))'<GMTSLD,+($G(^TMP("DILIST",$J,"ID",GMTSL,2)))>0 D
"RTN","GMTSCNB",90,0)
 . . S GMTSLP=$G(^TMP("DILIST",$J,"ID",GMTSL,8))
"RTN","GMTSCNB",91,0)
 . . S GMTSLA=+($G(^TMP("DILIST",$J,"ID",GMTSL,1)))
"RTN","GMTSCNB",92,0)
 . . S GMTSLD=+($G(^TMP("DILIST",$J,"ID",GMTSL,2)))
"RTN","GMTSCNB",93,0)
 . . S GMTSLR=$G(^TMP("DILIST",$J,"ID",GMTSL,9))
"RTN","GMTSCNB",94,0)
 . . S GMTSLM=$G(^TMP("DILIST",$J,"ID",GMTSL,10))
"RTN","GMTSCNB",95,0)
 I +($G(GMTSFLA))>0,+($G(GMTSFLD))>0,+($G(GMTSFL))>0,+($G(GMTSR))'>0 S GMTSC=0,GMTSLA=GMTSFLA,GMTSLD=GMTSFLA D AAC
"RTN","GMTSCNB",96,0)
 I GMTSLA>0,GMTSLD>0 S GMTSC=1 D AAC
"RTN","GMTSCNB",97,0)
 K ^TMP("DILIST",$J)
"RTN","GMTSCNB",98,0)
 Q
"RTN","GMTSCNB",99,0)
AAC ;   Add Activity
"RTN","GMTSCNB",100,0)
 N GMTSEA,GMTSEP,GMTSEL,GMTSOR,GMTSW,I S GMTSC=+($G(GMTSC))
"RTN","GMTSCNB",101,0)
 S GMTSOR=$$UP^XLFSTR($$GET1^DIQ(123.1,GMTSLA,1,"I"))
"RTN","GMTSCNB",102,0)
 S GMTSEP=$$UP^XLFSTR($$GET1^DIQ(123.1,GMTSLA,7,"E"))
"RTN","GMTSCNB",103,0)
 S GMTSEA=$$UP^XLFSTR($$GET1^DIQ(123.1,GMTSLA,.01,"E"))
"RTN","GMTSCNB",104,0)
 S GMTSEL=$$AL(GMTSEA,GMTSEP) Q:'$L(GMTSEL)
"RTN","GMTSCNB",105,0)
 S GMTSEA=$$AN(GMTSEA,GMTSEP) Q:'$L(GMTSEA)
"RTN","GMTSCNB",106,0)
 I GMTSC>0 D
"RTN","GMTSCNB",107,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,1,"I")=GMTSLA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,1,"E")=GMTSEA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,1,"L")=GMTSEL
"RTN","GMTSCNB",108,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,2,"I")=GMTSLD,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,GMTSC,2,"E")=$$EDT^GMTSU(GMTSLD)
"RTN","GMTSCNB",109,0)
 I GMTSC'>0 D
"RTN","GMTSCNB",110,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LA","I")=GMTSLA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LA","E")=GMTSEA,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LA","L")=GMTSEL
"RTN","GMTSCNB",111,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LD","I")=GMTSLD,^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"LD","E")=$$EDT^GMTSU(GMTSLD)
"RTN","GMTSCNB",112,0)
 . S ^TMP("GMTSCN",$J,GMTSI,123,GMTSIENS,40,"WR","E")=$G(^TMP("DILIST",$J,"ID",GMTSFL,3))
"RTN","GMTSCNB",113,0)
 Q
"RTN","GMTSCNB",114,0)
AN(X,Y) ;   Activity Name
"RTN","GMTSCNB",115,0)
 N GMTSW,GMTSP,GMTSA S GMTSA=$G(X),GMTSP=$G(Y) S X=$$SN((GMTSA_" "_GMTSP)) S X=$E(X,1,11) Q X
"RTN","GMTSCNB",116,0)
AL(X,Y) ;   Activity Name
"RTN","GMTSCNB",117,0)
 N GMTSP,GMTSA S GMTSA=$G(X),GMTSP=$G(Y) S:GMTSA["RECEIVE" (GMTSA,GMTSP)="RECEIVED"
"RTN","GMTSCNB",118,0)
 S:GMTSA="ENTERED IN CPRS"!(GMTSA["CPRS RELEASED") (GMTSA,GMTSP)="DATA ENTRY" S:GMTSA="EDIT BEFORE RELEASE" (GMTSA,GMTSP)="EDITITED"
"RTN","GMTSCNB",119,0)
 S X="" S:$L(GMTSA)&($L(GMTSP)) X=$S($L(GMTSP)>$L(GMTSA):GMTSP,1:GMTSA) S:'$L(GMTSA)!('$L(GMTSP)) X=$S('$L(GMTSP)&($L(GMTSA)):GMTSA,$L(GMTSP)&('$L(GMTSA)):GMTSP,1:"")
"RTN","GMTSCNB",120,0)
 Q X
"RTN","GMTSCNB",121,0)
SN(X) ;
"RTN","GMTSCNB",122,0)
 S X=$G(X) Q:X="" "UNKNOWN" Q:X["ENTERED"!(X["RELEASED") "ENTERED" Q:X["STATUS" "STAT CHG"
"RTN","GMTSCNB",123,0)
 Q:X["SIGNIF" "SIG FIND" Q:X["DISCONT" "DISCONT'D" Q:X["SCHEDUL" "SCHEDULED" Q:X["INCOMPL" "INCOMPLETE" Q:X["COMPLET" "COMPLETE"
"RTN","GMTSCNB",124,0)
 Q:X["EDIT" "EDITED" Q:X["DISASSO" "DISASSOC'D" Q:X["ADDENDUM" "ADDENDUM" Q:X["NEW NOTE" "NEW NOTE"
"RTN","GMTSCNB",125,0)
 Q:X["SERVICE" "SVC ENTER" Q:X["FORWARD" "FORWARDED" Q:X["CANCELLED" "CANCELLED" Q:X["COMMENT" "COMMENT" Q:X["RECEIVED" "RECEIVED" Q:X["PRINTED" "PRINTED"
"RTN","GMTSCNB",126,0)
 Q "UNKNOWN"
"RTN","GMTSDGC1")
0^14^B12185517
"RTN","GMTSDGC1",1,0)
GMTSDGC1 ; SLC/KER/SBW - Subroutines for Ext ADT Hist    ; 09/21/2001
"RTN","GMTSDGC1",2,0)
 ;;2.7;Health Summary;**5,35,47**;Oct 20, 1995
"RTN","GMTSDGC1",3,0)
 ;
"RTN","GMTSDGC1",4,0)
 ; External References
"RTN","GMTSDGC1",5,0)
 ;    DBIA    17  ^DGPM(
"RTN","GMTSDGC1",6,0)
 ;    DBIA  1372  ^DGPT( fields 71,73,75 Read w/Fileman
"RTN","GMTSDGC1",7,0)
 ;    DBIA 10082  ^ICD9( fields .01,3  Read w/Fileman
"RTN","GMTSDGC1",8,0)
 ;    DBIA   512  ^DGPMLOS
"RTN","GMTSDGC1",9,0)
 ;    DBIA 10015  EN^DIQ1 (file #45 and #80)
"RTN","GMTSDGC1",10,0)
 ;    DBIA 10011  ^DIWP
"RTN","GMTSDGC1",11,0)
 ;                     
"RTN","GMTSDGC1",12,0)
OTHER(DFN,PTF,CODE,GMVAIP,MDA) ; Additional data to include
"RTN","GMTSDGC1",13,0)
 N LOS,ICD,DGPMIFN,GMI,GMX,NODIAG,GMTO,GMTNO,BD,BDSC,ATTN,WARD,AWS
"RTN","GMTSDGC1",14,0)
 N DP,DSPL,OP,OPTR
"RTN","GMTSDGC1",15,0)
 I CODE=1 D  Q  ;Other data for Admission entries
"RTN","GMTSDGC1",16,0)
 . Q:$G(GMVAIP("DN",1))'=""
"RTN","GMTSDGC1",17,0)
 . D GETDATA
"RTN","GMTSDGC1",18,0)
 . I $G(GMVAIP("MF"))]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Adm. Diag: ",GMVAIP("MF")
"RTN","GMTSDGC1",19,0)
 . W ?64,"LOS: ",LOS,!
"RTN","GMTSDGC1",20,0)
 . Q:'$D(ICD)
"RTN","GMTSDGC1",21,0)
 . S GMI=0
"RTN","GMTSDGC1",22,0)
 . F  S GMI=$O(ICD(GMI)) Q:'GMI  D CKP^GMTSUP Q:$D(GMTSQIT)  S GMX="" F  S GMX=$O(ICD(GMI,80,GMX)) Q:'GMX  D NXTICD
"RTN","GMTSDGC1",23,0)
 I CODE=2 D  Q  ;Other data for Transfer entries
"RTN","GMTSDGC1",24,0)
 . N TRFAC
"RTN","GMTSDGC1",25,0)
 . S TRFAC=$P(^DGPM(MDA,0),U,5)
"RTN","GMTSDGC1",26,0)
 . I $P($G(GMVAIP("WL")),U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?19,$S($P(VAIP("MT"),U,2)'["TO":"To ",1:""),$P(VAIP("WL"),U,2),$S($L(TRFAC):"  at "_TRFAC,1:""),!
"RTN","GMTSDGC1",27,0)
 I CODE=3 D  Q  ;Other data for Discharge entries
"RTN","GMTSDGC1",28,0)
 . ; Discharge data
"RTN","GMTSDGC1",29,0)
 . D GETDATA
"RTN","GMTSDGC1",30,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Bedsection: ",BDSC,?64,"LOS: ",LOS,!
"RTN","GMTSDGC1",31,0)
 . S NODIAG=1,GMI=0
"RTN","GMTSDGC1",32,0)
 . F  S GMI=$O(ICD(GMI)) Q:GMI'>0  S GMX=0 F  S GMX=$O(ICD(GMI,80,GMX)) Q:GMX'>0  D NXTICD
"RTN","GMTSDGC1",33,0)
 . I NODIAG D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSDGC1",34,0)
 . . W ?7,"Principal Diag: No discharge diagnosis available.",!
"RTN","GMTSDGC1",35,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Disposition Place: ",DSPL,!
"RTN","GMTSDGC1",36,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Outpat. Treatment: ",OPTR,!
"RTN","GMTSDGC1",37,0)
 . I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGC1",38,0)
 I CODE=6 D  Q  ;Other data for Treating Specialty entries
"RTN","GMTSDGC1",39,0)
 . N DIWL,DIWF,DIWR,GMJ,GMJ1
"RTN","GMTSDGC1",40,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSDGC1",41,0)
 . S DIWL=22,DIWR=78,DIWF="C56"
"RTN","GMTSDGC1",42,0)
 . I $D(^DGPM(MDA,"DX")) D
"RTN","GMTSDGC1",43,0)
 . . F GMJ=1:1:$P(^DGPM(MDA,"DX",0),"^",4) S X=^DGPM(MDA,"DX",GMJ,0) D ^DIWP
"RTN","GMTSDGC1",44,0)
 . I $D(^UTILITY($J,"W")) D
"RTN","GMTSDGC1",45,0)
 . . S GMJ=$O(^UTILITY($J,"W",0)) Q:'GMJ
"RTN","GMTSDGC1",46,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14,"TS Diag: "
"RTN","GMTSDGC1",47,0)
 . . S GMJ1=0
"RTN","GMTSDGC1",48,0)
 . . F  S GMJ1=$O(^UTILITY($J,"W",GMJ,GMJ1)) Q:'GMJ1  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,^UTILITY($J,"W",GMJ,GMJ1,0),!
"RTN","GMTSDGC1",49,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSDGC1",50,0)
 Q
"RTN","GMTSDGC1",51,0)
GETDATA ; Gets LOS, ICD and bedsection data
"RTN","GMTSDGC1",52,0)
 N DIC,DR,DA,DIQ,GMTSI,X,PTFA
"RTN","GMTSDGC1",53,0)
 S DGPMIFN=$G(GMVAIP("AN"))
"RTN","GMTSDGC1",54,0)
 I DGPMIFN D ^DGPMLOS S LOS=+X
"RTN","GMTSDGC1",55,0)
 I '$D(^DGPT(PTF,70)) D  Q
"RTN","GMTSDGC1",56,0)
 . S (BDSC,DSPL,OPTR)="UNKNOWN"
"RTN","GMTSDGC1",57,0)
 S DIC=45,DA=+PTF,DR="71;73;75;",DIQ="PTFA(" D EN^DIQ1
"RTN","GMTSDGC1",58,0)
 S BDSC=$S(PTFA(45,+DA,71)]"":PTFA(45,+DA,71),1:"UNKNOWN")
"RTN","GMTSDGC1",59,0)
 S OPTR=$S(PTFA(45,+DA,73)]"":PTFA(45,+DA,73),1:"UNKNOWN")
"RTN","GMTSDGC1",60,0)
 S DSPL=$S(PTFA(45,+DA,75)]"":PTFA(45,+DA,75),1:"UNKNOWN")
"RTN","GMTSDGC1",61,0)
 Q:'$D(^ICD9)
"RTN","GMTSDGC1",62,0)
 S ICD=^DGPT(PTF,70),DIC=80,DR=".01;3"
"RTN","GMTSDGC1",63,0)
 I $P(ICD,U,11)'="" S DA=$P(ICD,U,11),DIQ="ICD(1," D EN^DIQ1
"RTN","GMTSDGC1",64,0)
 I $P(ICD,U,10)'="" S DA=$P(ICD,U,10),DIQ="ICD(2," D EN^DIQ1
"RTN","GMTSDGC1",65,0)
 F GMTSI=16:1:24 I $P(ICD,U,GMTSI)'="" S DA=$P(ICD,U,GMTSI),DIQ="ICD((GMTSI-13)," D EN^DIQ1
"RTN","GMTSDGC1",66,0)
 Q
"RTN","GMTSDGC1",67,0)
NXTICD ; Print the next ICD
"RTN","GMTSDGC1",68,0)
 S (GMTO,GMTNO)="" S GMTO=$G(ICD(GMI,80,GMX,3)),GMTNO=$G(ICD(GMI,80,GMX,.01))
"RTN","GMTSDGC1",69,0)
 W:GMI=1 ?7,"Principal Diag: "
"RTN","GMTSDGC1",70,0)
 W:GMI=2 ?17,"DXLS: "
"RTN","GMTSDGC1",71,0)
 W:GMI=3 ?15,"ICD DX: "
"RTN","GMTSDGC1",72,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,GMTO,?62,GMTNO,!
"RTN","GMTSDGC1",73,0)
 S NODIAG=0
"RTN","GMTSDGC1",74,0)
 Q
"RTN","GMTSDGCH")
0^13^B21163584
"RTN","GMTSDGCH",1,0)
GMTSDGCH ; SLC/KER/NDBI - Extended ADT Hist ; 09/21/2001
"RTN","GMTSDGCH",2,0)
 ;;2.7;Health Summary;**28,35,47**;Oct 20, 1995
"RTN","GMTSDGCH",3,0)
 ;
"RTN","GMTSDGCH",4,0)
 ; External References
"RTN","GMTSDGCH",5,0)
 ;    DBIA    17  ^DGPM("APCA"
"RTN","GMTSDGCH",6,0)
 ;    DBIA    17  ^DGPM("ATID1"
"RTN","GMTSDGCH",7,0)
 ;    DBIA    17  ^DGPM("ATS"
"RTN","GMTSDGCH",8,0)
 ;    DBIA 10035  ^DPT( fields .01,2,3 Read w/Fileman
"RTN","GMTSDGCH",9,0)
 ;    DBIA  2929  DSP^A7RHSM (NDBI)
"RTN","GMTSDGCH",10,0)
 ;    DBIA  2929  LST^A7RHSM (NDBI)
"RTN","GMTSDGCH",11,0)
 ;    DBIA 10015  EN^DIQ1 (file #2)
"RTN","GMTSDGCH",12,0)
 ;    DBIA 10061  ELIG^VADPT
"RTN","GMTSDGCH",13,0)
 ;    DBIA 10061  IN5^VADPT
"RTN","GMTSDGCH",14,0)
 ;    DBIA 10061  KVAR^VADPT
"RTN","GMTSDGCH",15,0)
 ;                        
"RTN","GMTSDGCH",16,0)
MAIN ; Loop through admissions starting from most recent
"RTN","GMTSDGCH",17,0)
 N FLAG,IN,IM,ADA,ADM,MDA,MDM,X,DOC,CNTR,CODE,TYPE,TT,SPEC,ITS,TS,TSDM,TSDA,VAHOW,VA200,GMC,GMMDA,PTF K VAIP
"RTN","GMTSDGCH",18,0)
 S CNTR=$S(+($G(GMTSNDM))>0:GMTSNDM,1:100),VA200=1,VAHOW=1,FLAG=-1,ADM=GMTS1,GMC=0
"RTN","GMTSDGCH",19,0)
 D DISAB,FADM
"RTN","GMTSDGCH",20,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) LST^A7RHSM(DFN,.A7RHS)
"RTN","GMTSDGCH",21,0)
 F  S ADM=$O(^DGPM("ATID1",DFN,ADM)) D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) DSP^A7RHSM(ADM) Q:('ADM)!(ADM>GMTS2)!(CNTR=0)!('DFN)  D
"RTN","GMTSDGCH",22,0)
 . S GMC=0 D MVTS I GMC>0 D
"RTN","GMTSDGCH",23,0)
 . . D ICDP^GMTSDGC2(DFN,+($G(PTF))),ICDS^GMTSDGC2(DFN,+($G(PTF)))
"RTN","GMTSDGCH",24,0)
 D KVAR^VADPT K ^UTILITY($J)
"RTN","GMTSDGCH",25,0)
 K A7RHS
"RTN","GMTSDGCH",26,0)
 Q
"RTN","GMTSDGCH",27,0)
MVTS ; Loop through mvts chronologically, per admission
"RTN","GMTSDGCH",28,0)
 S ADA=0,ADA=$O(^DGPM("ATID1",DFN,ADM,ADA)) Q:'ADA
"RTN","GMTSDGCH",29,0)
 N VAIP,PREVDR,PREVSP,PREVAP,PREVWD
"RTN","GMTSDGCH",30,0)
 K ^UTILITY($J)
"RTN","GMTSDGCH",31,0)
 S (VAIP("E"),GMMDA)=ADA D IN5^VADPT
"RTN","GMTSDGCH",32,0)
 I $D(VAIP) D CKP^GMTSUP Q:$D(GMTSQIT)  W:FLAG>0 ! D PRNT
"RTN","GMTSDGCH",33,0)
 D SETUTL
"RTN","GMTSDGCH",34,0)
 S MDM=""
"RTN","GMTSDGCH",35,0)
 F  S MDM=$O(^UTILITY($J,"GMTSMVTS",MDM)) Q:'MDM  D GET
"RTN","GMTSDGCH",36,0)
 S CNTR=CNTR-1
"RTN","GMTSDGCH",37,0)
 K ^UTILITY($J)
"RTN","GMTSDGCH",38,0)
 Q
"RTN","GMTSDGCH",39,0)
GET ; D IN5^VADPT for each mvt, print info
"RTN","GMTSDGCH",40,0)
 I ^UTILITY($J,"GMTSMVTS",MDM)=ADA Q
"RTN","GMTSDGCH",41,0)
 K VAIP
"RTN","GMTSDGCH",42,0)
 S (VAIP("E"),GMMDA)=^UTILITY($J,"GMTSMVTS",MDM) D IN5^VADPT
"RTN","GMTSDGCH",43,0)
 I $D(VAIP) D PRNT
"RTN","GMTSDGCH",44,0)
 Q
"RTN","GMTSDGCH",45,0)
PRNT ; output line of data
"RTN","GMTSDGCH",46,0)
 S X=+$P(VAIP("MD"),U) D REGDTM4^GMTSU
"RTN","GMTSDGCH",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGCH",48,0)
 N DOC,TYPE,CODE,SPEC,ATTN,WARD
"RTN","GMTSDGCH",49,0)
 S DOC=$E($P($G(VAIP("DR")),U,2),1,30),TYPE=$P($G(VAIP("MT")),U,2)
"RTN","GMTSDGCH",50,0)
 S CODE=+$P($G(VAIP("TT")),U),SPEC=$P(VAIP(("TS")),U,2)
"RTN","GMTSDGCH",51,0)
 S PTF=+$G(VAIP("PT"))
"RTN","GMTSDGCH",52,0)
 S TT=$S(CODE=0:"NON",CODE=1:"ADM",CODE=2:"TR ",CODE=3:"DC ",CODE=4:"CIL",CODE=5:"COL",CODE=6:"TS ",1:"   ")
"RTN","GMTSDGCH",53,0)
 S GMC=1
"RTN","GMTSDGCH",54,0)
 W X,?18,TT,?23,$E(TYPE,1,56),!
"RTN","GMTSDGCH",55,0)
 I $G(DOC)'=$G(PREVDR)!($G(SPEC)'=$G(PREVSP)) D
"RTN","GMTSDGCH",56,0)
 . N AWS S AWS="Provider/Specialty: "_DOC
"RTN","GMTSDGCH",57,0)
 . W ?3,AWS,?56,SPEC,!
"RTN","GMTSDGCH",58,0)
 . S PREVDR=$G(DOC),PREVSP=$G(SPEC)
"RTN","GMTSDGCH",59,0)
 S ATTN=$P($G(VAIP("AP")),"^",2)
"RTN","GMTSDGCH",60,0)
 S WARD=$P($G(VAIP("WL")),"^",2)
"RTN","GMTSDGCH",61,0)
 I $L(ATTN),($G(ATTN)'=$G(PREVAP)!($G(WARD)'=$G(PREVWD))) D
"RTN","GMTSDGCH",62,0)
 . S AWS="Attending/Ward: "_ATTN
"RTN","GMTSDGCH",63,0)
 . W ?7,AWS,?56,WARD,!
"RTN","GMTSDGCH",64,0)
 . S PREVAP=$G(ATTN),PREVWD=$G(WARD)
"RTN","GMTSDGCH",65,0)
 D OTHER^GMTSDGC1(DFN,PTF,CODE,.VAIP,$G(GMMDA))
"RTN","GMTSDGCH",66,0)
 S FLAG=2
"RTN","GMTSDGCH",67,0)
 Q
"RTN","GMTSDGCH",68,0)
SETUTL ; Set ^UTILITY array
"RTN","GMTSDGCH",69,0)
 S (TSDM,MDM)=0
"RTN","GMTSDGCH",70,0)
 F  S TSDM=$O(^DGPM("ATS",DFN,ADA,TSDM)) Q:'TSDM  D NEXT1
"RTN","GMTSDGCH",71,0)
 F  S MDM=$O(^DGPM("APCA",DFN,ADA,MDM)) Q:'MDM  D NEXT2
"RTN","GMTSDGCH",72,0)
 Q
"RTN","GMTSDGCH",73,0)
NEXT1 ; Next ^UTILITY($J,"GMTSMVTS",<inverse date>) - "ATS"
"RTN","GMTSDGCH",74,0)
 S TS="",TS=$O(^DGPM("ATS",DFN,ADA,TSDM,TS)) Q:'TS
"RTN","GMTSDGCH",75,0)
 S TSDA=0,TSDA=$O(^DGPM("ATS",DFN,ADA,TSDM,TS,TSDA)) Q:'TSDA
"RTN","GMTSDGCH",76,0)
 S ^UTILITY($J,"GMTSMVTS",9999999-TSDM)=TSDA
"RTN","GMTSDGCH",77,0)
 Q
"RTN","GMTSDGCH",78,0)
NEXT2 ; Next ^UTILITY($J,"GMTSMVTS",<date>)  - "APCA"
"RTN","GMTSDGCH",79,0)
 S MDA=0,MDA=$O(^DGPM("APCA",DFN,ADA,MDM,MDA)) Q:'MDA
"RTN","GMTSDGCH",80,0)
 I MDA'=ADA S ^UTILITY($J,"GMTSMVTS",MDM)=MDA
"RTN","GMTSDGCH",81,0)
 Q
"RTN","GMTSDGCH",82,0)
DISAB ; Disability Display
"RTN","GMTSDGCH",83,0)
 N GMW,GMTSI,VA,VADM,VAEL,VAERR,VAPA
"RTN","GMTSDGCH",84,0)
 D ELIG^VADPT I +$G(VAEL("EL")) D
"RTN","GMTSDGCH",85,0)
 . S FLAG=2
"RTN","GMTSDGCH",86,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Eligibility: ",$E($P(VAEL("EL"),U,2),1,40)
"RTN","GMTSDGCH",87,0)
 . W:VAEL("ES")]"" ?56,$P(VAEL("ES"),U,2)
"RTN","GMTSDGCH",88,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W:+VAEL("SC") !,"Total S/C %: ",$P(VAEL("SC"),U,2)
"RTN","GMTSDGCH",89,0)
 . I '$D(^DPT(DFN,.372)) D  Q
"RTN","GMTSDGCH",90,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"   No rated disabilities"
"RTN","GMTSDGCH",91,0)
 . S GMTSI=0
"RTN","GMTSDGCH",92,0)
 . F  S GMTSI=$O(^DPT(DFN,.372,GMTSI)) Q:GMTSI'>0  D
"RTN","GMTSDGCH",93,0)
 . . N DA,DIQ,DR,DIC,GMTSDIS
"RTN","GMTSDGCH",94,0)
 . . S DIC="^DPT("_DFN_",.372,",DA=GMTSI,DR=".01;2;3",DIQ="GMTSDIS",DIQ(0)="E"
"RTN","GMTSDGCH",95,0)
 . . D EN^DIQ1
"RTN","GMTSDGCH",96,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?3,GMTSDIS(2.04,DA,.01,"E"),?51,$J(GMTSDIS(2.04,DA,2,"E"),3),"%",?60,$S(GMTSDIS(2.04,DA,3,"E")="YES":"S/C",1:"NSC")
"RTN","GMTSDGCH",97,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGCH",98,0)
 Q
"RTN","GMTSDGCH",99,0)
FADM ; Future Admissions
"RTN","GMTSDGCH",100,0)
 N GMDT,NODE,X
"RTN","GMTSDGCH",101,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGCH",102,0)
 D GETFADM^GMTSDGA2
"RTN","GMTSDGCH",103,0)
 Q:'$D(^TMP("GMFADM",$J))
"RTN","GMTSDGCH",104,0)
 S GMDT=0
"RTN","GMTSDGCH",105,0)
 F  S GMDT=$O(^TMP("GMFADM",$J,GMDT)) Q:GMDT'>0  D
"RTN","GMTSDGCH",106,0)
 . S NODE=$G(^TMP("GMFADM",$J,GMDT))
"RTN","GMTSDGCH",107,0)
 . S X=$P(NODE,U) D REGDT4^GMTSU
"RTN","GMTSDGCH",108,0)
 . I FLAG>0 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGCH",109,0)
 . E  S FLAG=2
"RTN","GMTSDGCH",110,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W X,?16,"Scheduled Admission",?56,$E($P(NODE,U,5),1,12),?69,$E($P(NODE,U,3),1,10),!
"RTN","GMTSDGCH",111,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGCH",112,0)
 . I $P(NODE,U,2)]"" W ?11,"Adm. Diag.: ",$P(NODE,U,2)
"RTN","GMTSDGCH",113,0)
 . I $P(NODE,U,6)>0 W ?56,"Expected LOS: ",$P(NODE,U,6),!
"RTN","GMTSDGCH",114,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGCH",115,0)
 . I $P(NODE,U,4)]"" W ?14,"Surgery: ",$P(NODE,U,4),!
"RTN","GMTSDGCH",116,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGCH",117,0)
 Q
"RTN","GMTSDS")
0^30^B2113585
"RTN","GMTSDS",1,0)
GMTSDS ; SLC/KER - Discharge Summary              ; 09/21/2001
"RTN","GMTSDS",2,0)
 ;;2.7;Health Summary;**12,28,35,45,47**;Oct 20, 1995
"RTN","GMTSDS",3,0)
 ;                          
"RTN","GMTSDS",4,0)
 ; External References
"RTN","GMTSDS",5,0)
 ;    DBIA  2902  MAIN^TIULAPIC
"RTN","GMTSDS",6,0)
 ;    DBIA 10006  ^DIC (file #8935.1)
"RTN","GMTSDS",7,0)
 ;                        
"RTN","GMTSDS",8,0)
MAIN ; Control branching
"RTN","GMTSDS",9,0)
 N ADATE,ADMIT,ASUB,ATDATE,ATTNDNG,ATTYPE,ATYPE,AUTHOR,CHILD,CONEED
"RTN","GMTSDS",10,0)
 N COSAME,COSGEDBY,COSIG,CURIEN,DISCHG,GMTSA,GMTSAI,GMTSAII,GMTSCNT
"RTN","GMTSDS",11,0)
 N GMTSD,GMTSDIC,GMTSEXSG,GMTSI,GMTSIEN,GMTSII,GMTSIQ,GMTSJ,GMTSK
"RTN","GMTSDS",12,0)
 N GMTSODIC,GMTSPDIC,GMTSTDIC,GMTSPR,GMTSREC,GMTST,GMTSX,GMTSXTRA
"RTN","GMTSDS",13,0)
 N I,PARIEN,PDATE,PN,PSUB,PTYPE,REASON,SIGNEDBY,STATUS,TSPEC,TYPE
"RTN","GMTSDS",14,0)
 N TIUTYPE,TIUFPRIV,TIUNAM,GMTSTIUC,DIC,X,Y S (TIUNAM,X)="DISCHARGE SUMMARY",GMTSTIUC="DCS"
"RTN","GMTSDS",15,0)
 S DIC="^TIU(8925.1,",DIC(0)="X",DIC("S")="I $P($G(^(0)),U,4)=""CL"",$P($G(^(0)),U)=TIUNAM"
"RTN","GMTSDS",16,0)
 D ^DIC Q:+($G(Y))=0  S TIUTYPE=+Y K ^TMP("TIU",$J)
"RTN","GMTSDS",17,0)
 D MAIN^TIULAPIC(DFN,TIUTYPE,GMTS1,GMTS2,GMTSNDM,1)
"RTN","GMTSDS",18,0)
 Q:'$D(^TMP("TIU",$J))  D PNOTE^GMTSPN Q
"RTN","GMTSDSB")
0^31^B2299171
"RTN","GMTSDSB",1,0)
GMTSDSB ; SLC/KER - Brief Discharge Summary ; 09/21/2001
"RTN","GMTSDSB",2,0)
 ;;2.7;Health Summary;**12,28,35,45,47**;Oct 20, 1995
"RTN","GMTSDSB",3,0)
 ;                          
"RTN","GMTSDSB",4,0)
 ; External References
"RTN","GMTSDSB",5,0)
 ;    DBIA  2902  MAIN^TIULAPIC
"RTN","GMTSDSB",6,0)
 ;    DBIA 10006  ^DIC (file #8925.1)
"RTN","GMTSDSB",7,0)
 ;                        
"RTN","GMTSDSB",8,0)
MAIN ; Control branching
"RTN","GMTSDSB",9,0)
 N ADATE,ADMIT,ASUB,ATDATE,ATTNDNG,ATTYPE,ATYPE,AUTHOR,CHILD,CONEED
"RTN","GMTSDSB",10,0)
 N COSAME,COSGEDBY,COSIG,CURIEN,DISCHG,GMTSA,GMTSAI,GMTSAII,GMTSCNT
"RTN","GMTSDSB",11,0)
 N GMTSD,GMTSDIC,GMTSEXSG,GMTSI,GMTSIEN,GMTSII,GMTSIQ,GMTSJ,GMTSK
"RTN","GMTSDSB",12,0)
 N GMTSODIC,GMTSPDIC,GMTSTDIC,GMTSPR,GMTSREC,GMTST,GMTSX,GMTSXTRA
"RTN","GMTSDSB",13,0)
 N I,PARIEN,PDATE,PN,PSUB,PTYPE,REASON,SIGNEDBY,STATUS,TSPEC,TYPE
"RTN","GMTSDSB",14,0)
 N TIUTYPE,TIUFPRIV,TIUNAM,GMTSTIUC,DIC,X,Y S (TIUNAM,X)="DISCHARGE SUMMARY",GMTSTIUC="DSB"
"RTN","GMTSDSB",15,0)
 S DIC="^TIU(8925.1,",DIC(0)="X",DIC("S")="I $P($G(^(0)),U,4)=""CL"",$P($G(^(0)),U)=TIUNAM"
"RTN","GMTSDSB",16,0)
 D ^DIC Q:+($G(Y))=0  S TIUTYPE=+Y,TIUNAM="DISCHARGE SUMMARY BRIEF" K ^TMP("TIU",$J)
"RTN","GMTSDSB",17,0)
 D MAIN^TIULAPIC(DFN,TIUTYPE,GMTS1,GMTS2,GMTSNDM,1)
"RTN","GMTSDSB",18,0)
 Q:'$D(^TMP("TIU",$J))  D PNOTE^GMTSPN Q
"RTN","GMTSLRA")
0^20^B15741122
"RTN","GMTSLRA",1,0)
GMTSLRA ; SLC/JER,KER - Surgical Pathology Component ; 09/21/2001
"RTN","GMTSLRA",2,0)
 ;;2.7;Health Summary;**28,47**;Oct 20, 1995
"RTN","GMTSLRA",3,0)
 ;
"RTN","GMTSLRA",4,0)
 ; External References
"RTN","GMTSLRA",5,0)
 ;    DBIA 10035  ^DPT( field 63 Read w/Fileman
"RTN","GMTSLRA",6,0)
 ;    DBIA  2056  $$GET1^DIQ (file 2)
"RTN","GMTSLRA",7,0)
 ;                       
"RTN","GMTSLRA",8,0)
MAIN ; Surgical Pathology
"RTN","GMTSLRA",9,0)
 N GMI,MAX,LRDFN,IX,X,SP,IX0
"RTN","GMTSLRA",10,0)
 S LRDFN=+($$GET1^DIQ(2,(+($G(DFN))_","),63,"I")) Q:+LRDFN=0
"RTN","GMTSLRA",11,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999) D ^GMTSLRAE
"RTN","GMTSLRA",12,0)
 I '$D(^TMP("LRA",$J)) Q
"RTN","GMTSLRA",13,0)
 S IX=0 F GMI=1:1:MAX S IX=$O(^TMP("LRA",$J,IX)) Q:$D(GMTSQIT)  Q:IX'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRA",14,0)
 . D:GMI>1 CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>1&('GMTSNPG) ! D
"RTN","GMTSLRA",15,0)
 . . S IX0="" F  S IX0=$O(^TMP("LRA",$J,IX,IX0)) Q:IX0=""!(IX0?1A)  D
"RTN","GMTSLRA",16,0)
 . . . S X=^TMP("LRA",$J,IX,IX0)
"RTN","GMTSLRA",17,0)
 . . . S SP=$G(^TMP("LRA",$J,IX,"SPP")) D WRT
"RTN","GMTSLRA",18,0)
 . . I $D(^TMP("LRA",$J,IX,1.2)) D SUPPR
"RTN","GMTSLRA",19,0)
 K ^TMP("LRA",$J)
"RTN","GMTSLRA",20,0)
 Q
"RTN","GMTSLRA",21,0)
WRT ; Writes Surgical Pathology Record
"RTN","GMTSLRA",22,0)
 N IX1,GMJ
"RTN","GMTSLRA",23,0)
 I IX0=0 D  Q
"RTN","GMTSLRA",24,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRA",25,0)
 . W ?8,"Collected:",?19,$P(X,U),?31,"Acc:",?36,$P(X,U,2),!
"RTN","GMTSLRA",26,0)
 . Q:'$L($G(SP))  D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRA",27,0)
 . W "Surgeon/Physician:",?19,$G(SP),!
"RTN","GMTSLRA",28,0)
 I IX0=.1 D WRTSPC Q
"RTN","GMTSLRA",29,0)
 I $S(IX0=.2:1,IX0=1:1,IX0=1.1:1,IX0=1.3:1,IX0=1.4:1,1:0) D TEXT Q
"RTN","GMTSLRA",30,0)
 I IX0=2 S IX1=0 F  S IX1=$O(^TMP("LRA",$J,IX,IX0,IX1)) Q:IX1'>0  S X=^(IX1) D WRTTM,WRTP
"RTN","GMTSLRA",31,0)
 Q
"RTN","GMTSLRA",32,0)
WRTSPC ; Writes Specimen field entries
"RTN","GMTSLRA",33,0)
 N GMS
"RTN","GMTSLRA",34,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Specimen:"
"RTN","GMTSLRA",35,0)
 S GMS=0
"RTN","GMTSLRA",36,0)
 F  S GMS=$O(^TMP("LRA",$J,IX,.1,GMS)) Q:GMS'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?19,^TMP("LRA",$J,IX,.1,GMS),!
"RTN","GMTSLRA",37,0)
 Q
"RTN","GMTSLRA",38,0)
TEXT ; Handles GROSS DESCRIPTION & MICROSCOPIC EXAM/DX Print
"RTN","GMTSLRA",39,0)
 N LN,GMTSLN,GMTSLNI
"RTN","GMTSLRA",40,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?(17-$L(X)),X_":",!
"RTN","GMTSLRA",41,0)
 S LN=0
"RTN","GMTSLRA",42,0)
 F  S LN=$O(^TMP("LRA",$J,IX,IX0,LN)) Q:LN'>0  S GMTSLN=^(LN) D
"RTN","GMTSLRA",43,0)
 .I $L(GMTSLN)>78 S GMTSLN=$$WRAP^GMTSORC(GMTSLN,78)
"RTN","GMTSLRA",44,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSLN,"|"),! D
"RTN","GMTSLRA",45,0)
 ..F GMTSLNI=2:1:$L(GMTSLN,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSLN,"|",GMTSLNI)]"" $P(GMTSLN,"|",GMTSLNI),!
"RTN","GMTSLRA",46,0)
 Q
"RTN","GMTSLRA",47,0)
SUPPR ; Writes Supplementary Report
"RTN","GMTSLRA",48,0)
 N GMTSR,SRDATE,GMTSRL,GMTSRLI,X
"RTN","GMTSLRA",49,0)
 S IX1=0
"RTN","GMTSLRA",50,0)
 F  S IX1=$O(^TMP("LRA",$J,IX,1.2,IX1)) Q:IX1'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  S SRDATE=^TMP("LRA",$J,IX,1.2,IX1,0) S X=SRDATE D REGDTM4^GMTSU W "Supplementary Rpt: ",X,! D
"RTN","GMTSLRA",51,0)
 .S GMTSR=0
"RTN","GMTSLRA",52,0)
 .F  S GMTSR=$O(^TMP("LRA",$J,IX,1.2,IX1,GMTSR)) Q:GMTSR'>0  S GMTSRL=^(GMTSR) D
"RTN","GMTSLRA",53,0)
 ..I $L(GMTSRL)>78 S GMTSRL=$$WRAP^GMTSORC(GMTSRL,78)
"RTN","GMTSLRA",54,0)
 ..W $P(GMTSRL,"|"),! D
"RTN","GMTSLRA",55,0)
 ...F GMTSRLI=2:1:$L(GMTSRL,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSRL,"|",GMTSRLI)]"" $P(GMTSRL,"|",GMTSRLI),!
"RTN","GMTSLRA",56,0)
 Q
"RTN","GMTSLRA",57,0)
WRTTM ; Writes Topography and Morphology
"RTN","GMTSLRA",58,0)
 N GMT,GMD,GME
"RTN","GMTSLRA",59,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Topography:",?19,$P(X,U),!
"RTN","GMTSLRA",60,0)
 I $O(^TMP("LRA",$J,IX,IX0,IX1,1,0)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRA",61,0)
 S GMD=0
"RTN","GMTSLRA",62,0)
 F  S GMD=$O(^TMP("LRA",$J,IX,IX0,IX1,1,GMD)) Q:GMD'>0  W:GMD=1 ?9,"Disease:" W ?21,^TMP("LRA",$J,IX,IX0,IX1,1,GMD),! Q
"RTN","GMTSLRA",63,0)
 I $O(^TMP("LRA",$J,IX,IX0,IX1,2,0)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRA",64,0)
 S GMT=0
"RTN","GMTSLRA",65,0)
 F  S GMT=$O(^TMP("LRA",$J,IX,IX0,IX1,2,GMT)) Q:GMT'>0  D
"RTN","GMTSLRA",66,0)
 .I GMT'=4 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRA",67,0)
 .I  W ?7,"Morphology:",?21,^TMP("LRA",$J,IX,IX0,IX1,2,GMT),! D  Q
"RTN","GMTSLRA",68,0)
 ..S GME=0
"RTN","GMTSLRA",69,0)
 ..F  S GME=$O(^TMP("LRA",$J,IX,IX0,IX1,2,GMT,1,GME)) Q:GME'>0  D
"RTN","GMTSLRA",70,0)
 ...D CKP^GMTSUP Q:$D(GMTSQIT)  W:GME=1 ?9,"Etiology:" W ?23,^TMP("LRA",$J,IX,IX0,IX1,2,GMT,1,GME),! Q
"RTN","GMTSLRA",71,0)
 Q
"RTN","GMTSLRA",72,0)
WRTP ; Writes Procedure field
"RTN","GMTSLRA",73,0)
 N GMQ,GMK
"RTN","GMTSLRA",74,0)
 I $O(^TMP("LRA",$J,IX,IX0,IX1,4,0)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Procedures:"
"RTN","GMTSLRA",75,0)
 S GMT=0
"RTN","GMTSLRA",76,0)
 F  S GMT=$O(^TMP("LRA",$J,IX,IX0,IX1,4,GMT)) Q:GMT'>0  D
"RTN","GMTSLRA",77,0)
 .S GMQ=$P(^TMP("LRA",$J,IX,IX0,IX1,4,GMT),U)
"RTN","GMTSLRA",78,0)
 .I $L(GMQ)>56 S GMQ=$$WRAP^GMTSORC(GMQ,56)
"RTN","GMTSLRA",79,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(GMQ,"|"),! D
"RTN","GMTSLRA",80,0)
 ..F GMK=2:1:$L(GMQ,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMQ,"|",GMK)]"" ?23,$P(GMQ,"|",GMK),!
"RTN","GMTSLRA",81,0)
 Q
"RTN","GMTSLRAE")
0^19^B28526176
"RTN","GMTSLRAE",1,0)
GMTSLRAE ; SLC/JER,KER - Surgical Pathology Extract ; 09/21/2001
"RTN","GMTSLRAE",2,0)
 ;;2.7;Health Summary;**3,28,47**;Oct 20, 1995
"RTN","GMTSLRAE",3,0)
 ;
"RTN","GMTSLRAE",4,0)
 ; External References
"RTN","GMTSLRAE",5,0)
 ;    DBIA   525  ^LR( all fields
"RTN","GMTSLRAE",6,0)
 ;    DBIA 10060  ^VA(200, field .01 Read w/Fileman
"RTN","GMTSLRAE",7,0)
 ;    DBIA  2056  $$GET1^DIQ (file #200)
"RTN","GMTSLRAE",8,0)
 ;    DBIA 10015  EN^DIQ1 (file 63)
"RTN","GMTSLRAE",9,0)
 ;    DBIA 10011  ^DIWP
"RTN","GMTSLRAE",10,0)
 ;                      
"RTN","GMTSLRAE",11,0)
XTRCT ; Extract Surgical Pathology
"RTN","GMTSLRAE",12,0)
 N IX0,IX,DIWF,DIWL,DIWR K ^TMP("LRA",$J)
"RTN","GMTSLRAE",13,0)
 S IX=GMTS1 F IX0=1:0:MAX S IX=$O(^LR(LRDFN,"SP",IX)) Q:IX'>0!(IX>GMTS2)  D APSET
"RTN","GMTSLRAE",14,0)
 K AP
"RTN","GMTSLRAE",15,0)
 Q
"RTN","GMTSLRAE",16,0)
APSET ; Sets ^TMP("LRA",$J
"RTN","GMTSLRAE",17,0)
 N ACC,CDT,DA,DIC,DIQ,DR,GMW,SN,X,YR,SPP
"RTN","GMTSLRAE",18,0)
 S CDT=$P(^LR(LRDFN,"SP",IX,0),U),SPP=$P(^LR(LRDFN,"SP",IX,0),U,7),SPP=$$GET1^DIQ(200,(+SPP_","),.01),ACC=$P(^LR(LRDFN,"SP",IX,0),U,6)
"RTN","GMTSLRAE",19,0)
 I $S(+$P(^LR(LRDFN,"SP",IX,0),U)'>0:1,+$P(^(0),U,11)'>0:1,1:0) Q
"RTN","GMTSLRAE",20,0)
 I $D(ACC) S IX0=IX0+1
"RTN","GMTSLRAE",21,0)
 S X=CDT D REGDTM4^GMTSU S CDT=X K X
"RTN","GMTSLRAE",22,0)
 S ^TMP("LRA",$J,IX,0)=CDT_U_ACC
"RTN","GMTSLRAE",23,0)
 S:$L($G(SPP)) ^TMP("LRA",$J,IX,"SPP")=$G(SPP)
"RTN","GMTSLRAE",24,0)
 I $D(^LR(LRDFN,"SP",IX,.1)) S ^TMP("LRA",$J,IX,.1)="Site/Specimen"
"RTN","GMTSLRAE",25,0)
 S SN=0 F  S SN=$O(^LR(LRDFN,"SP",IX,.1,SN)) Q:SN'>0  S ^TMP("LRA",$J,IX,.1,SN)=$P(^LR(LRDFN,"SP",IX,.1,SN,0),U)
"RTN","GMTSLRAE",26,0)
 I $D(^LR(LRDFN,"SP",IX,.2,0)),($P(^(0),U,3)]"") D CLHX
"RTN","GMTSLRAE",27,0)
 I $D(^LR(LRDFN,"SP",IX,1,0)),($P(^(0),U,3)]"") D GROSS
"RTN","GMTSLRAE",28,0)
 I $D(^LR(LRDFN,"SP",IX,1.1,0)),($P(^(0),U,3)]"") D MIC
"RTN","GMTSLRAE",29,0)
 I $D(^LR(LRDFN,"SP",IX,1.2,0)),($P(^(0),U,3)]"") D SUPPR
"RTN","GMTSLRAE",30,0)
 I $D(^LR(LRDFN,"SP",IX,1.3,0)),($P(^(0),U,3)]"") D FROZ
"RTN","GMTSLRAE",31,0)
 I $D(^LR(LRDFN,"SP",IX,1.4,0)),($P(^(0),U,3)]"") D SPDX
"RTN","GMTSLRAE",32,0)
 Q
"RTN","GMTSLRAE",33,0)
MPD ; Morphology, Procedure data and Disease data (not used)
"RTN","GMTSLRAE",34,0)
 S DIC=63,DIQ="AP",DIQ(0)="E",DR(63.08)=10,DR(63.12)=".01;1.5;3;4"
"RTN","GMTSLRAE",35,0)
 S DR(63.16)=".01;1",DR(63.82)=.01,DR(63.17)=.01
"RTN","GMTSLRAE",36,0)
 S DA(63.12)=0,DA(63.08)=IX
"RTN","GMTSLRAE",37,0)
 F  S DA(63.12)=$O(^LR(LRDFN,"SP",IX,2,DA(63.12))) Q:DA(63.12)=""  D M,P,D
"RTN","GMTSLRAE",38,0)
 Q
"RTN","GMTSLRAE",39,0)
M ; Morphology data
"RTN","GMTSLRAE",40,0)
 N AP S DR=8,DA=LRDFN D EN^DIQ1 I $D(AP(63.12)) S ^TMP("LRA",$J,IX,2)="Topography Data",^(2,DA(63.12))=$S($D(AP(63.12,DA(63.12),.01,"E")):AP(63.12,DA(63.12),.01,"E"),1:"")
"RTN","GMTSLRAE",41,0)
 S DA(63.16)=0 F  S DA(63.16)=$O(^LR(LRDFN,"SP",IX,2,DA(63.12),2,DA(63.16))) Q:DA(63.16)=""  D EN^DIQ1 I $D(AP(63.16)) D MSET
"RTN","GMTSLRAE",42,0)
 K DA(63.16)
"RTN","GMTSLRAE",43,0)
 Q
"RTN","GMTSLRAE",44,0)
MSET ; Save Morphology data
"RTN","GMTSLRAE",45,0)
 S ^TMP("LRA",$J,IX,2,DA(63.12),2,DA(63.16))=$S($D(AP(63.16,DA(63.16),.01,"E")):AP(63.16,DA(63.16),.01,"E"),1:"") D
"RTN","GMTSLRAE",46,0)
 . S DA(63.17)=0 F  S DA(63.17)=$O(^LR(LRDFN,"SP",IX,2,DA(63.12),2,DA(63.16),1,DA(63.17))) Q:DA(63.17)=""  D EN^DIQ1 I $D(AP(63.17)) D
"RTN","GMTSLRAE",47,0)
 . . S ^TMP("LRA",$J,IX,2,DA(63.12),2,DA(63.16),1,DA(63.17))=$S($D(AP(63.17,DA(63.17),.01,"E")):AP(63.17,DA(63.17),.01,"E"),1:"")
"RTN","GMTSLRAE",48,0)
 K DA(63.17)
"RTN","GMTSLRAE",49,0)
 Q
"RTN","GMTSLRAE",50,0)
D ; Disease data
"RTN","GMTSLRAE",51,0)
 S DA(63.15)=0 F  S DA(63.15)=$O(^LR(LRDFN,"SP",IX,2,DA(63.12),1,DA(63.15))) Q:DA(63.15)=""  D EN^DIQ1 I $D(AP(63.15)) D
"RTN","GMTSLRAE",52,0)
 .S ^TMP("LRA",$J,IX,2,DA(63.12),1,DA(63.15))=$S($D(AP(63.15,DA(63.15),.01,"E")):AP(63.15,DA(63.15),.01,"E"),1:"")
"RTN","GMTSLRAE",53,0)
 K DA(63.15)
"RTN","GMTSLRAE",54,0)
 Q
"RTN","GMTSLRAE",55,0)
P ; Procedure data
"RTN","GMTSLRAE",56,0)
 N AP
"RTN","GMTSLRAE",57,0)
 S DA(63.82)=0
"RTN","GMTSLRAE",58,0)
 S DA(63.82)=0 F  S DR=8,DA=LRDFN,DA(63.82)=$O(^LR(LRDFN,"SP",IX,2,DA(63.12),4,DA(63.82))) Q:DA(63.82)=""  D EN^DIQ1 I $D(AP(63.82)) D PSET
"RTN","GMTSLRAE",59,0)
 K DA(63.82)
"RTN","GMTSLRAE",60,0)
 Q
"RTN","GMTSLRAE",61,0)
PSET ; Save Procedure data
"RTN","GMTSLRAE",62,0)
 S ^TMP("LRA",$J,IX,4)="Procedure Field"
"RTN","GMTSLRAE",63,0)
 S ^TMP("LRA",$J,IX,2,DA(63.12),4,DA(63.82))=$S($D(AP(63.82,DA(63.82),.01,"E")):AP(63.82,DA(63.82),.01,"E"),1:"")
"RTN","GMTSLRAE",64,0)
 Q
"RTN","GMTSLRAE",65,0)
CLHX ; Brief Clinical History text
"RTN","GMTSLRAE",66,0)
 N LN
"RTN","GMTSLRAE",67,0)
 S ^TMP("LRA",$J,IX,.2)="Brief Clinical Hx"
"RTN","GMTSLRAE",68,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"SP",IX,.2,LN)) Q:LN'>0  S X=^LR(LRDFN,"SP",IX,.2,LN,0) D FORMAT
"RTN","GMTSLRAE",69,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,.2,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",70,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",71,0)
 Q
"RTN","GMTSLRAE",72,0)
GROSS ; Gross Description text
"RTN","GMTSLRAE",73,0)
 N LN
"RTN","GMTSLRAE",74,0)
 S ^TMP("LRA",$J,IX,1)="Gross Description"
"RTN","GMTSLRAE",75,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"SP",IX,1,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"SP",IX,1,LN,0),U) D FORMAT
"RTN","GMTSLRAE",76,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",77,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",78,0)
 Q
"RTN","GMTSLRAE",79,0)
MIC ; Microscopic Exam/Diagnosis text
"RTN","GMTSLRAE",80,0)
 N LN
"RTN","GMTSLRAE",81,0)
 S ^TMP("LRA",$J,IX,1.1)="Microscopic Exam"
"RTN","GMTSLRAE",82,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"SP",IX,1.1,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"SP",IX,1.1,LN,0),U) D FORMAT
"RTN","GMTSLRAE",83,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,1.1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",84,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",85,0)
 Q
"RTN","GMTSLRAE",86,0)
SUPPR ; Supplementary Report date/text
"RTN","GMTSLRAE",87,0)
 N SP1 S ^TMP("LRA",$J,IX,1.2)="Supplementary Report"
"RTN","GMTSLRAE",88,0)
 S SP1=0 F  S SP1=$O(^LR(LRDFN,"SP",IX,1.2,SP1)) Q:SP1'>0  D
"RTN","GMTSLRAE",89,0)
 . Q:+$P($G(^LR(LRDFN,"SP",IX,1.2,SP1,0)),U,2)'>0
"RTN","GMTSLRAE",90,0)
 . S ^TMP("LRA",$J,IX,1.2,SP1,0)=$P($G(^LR(LRDFN,"SP",IX,1.2,SP1,0)),U)
"RTN","GMTSLRAE",91,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSLRAE",92,0)
 . S SR=0
"RTN","GMTSLRAE",93,0)
 . F  S SR=$O(^LR(LRDFN,"SP",IX,1.2,SP1,1,SR)) Q:SR'>0  D
"RTN","GMTSLRAE",94,0)
 . . S X=$P($G(^LR(LRDFN,"SP",IX,1.2,SP1,1,SR,0)),U) D FORMAT
"RTN","GMTSLRAE",95,0)
 . I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,1.2,SP1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",96,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",97,0)
 Q
"RTN","GMTSLRAE",98,0)
FROZ ; Frozen Section text
"RTN","GMTSLRAE",99,0)
 N LN
"RTN","GMTSLRAE",100,0)
 S ^TMP("LRA",$J,IX,1.3)="Frozen Section"
"RTN","GMTSLRAE",101,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"SP",IX,1.3,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"SP",IX,1.3,LN,0),U) D FORMAT
"RTN","GMTSLRAE",102,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,1.3,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",103,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",104,0)
 Q
"RTN","GMTSLRAE",105,0)
SPDX ; Surgical Pathology DX text
"RTN","GMTSLRAE",106,0)
 N LN
"RTN","GMTSLRAE",107,0)
 S ^TMP("LRA",$J,IX,1.4)="Surgical Path Dx"
"RTN","GMTSLRAE",108,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"SP",IX,1.4,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"SP",IX,1.4,LN,0),U) D FORMAT
"RTN","GMTSLRAE",109,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LRA",$J,IX,1.4,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLRAE",110,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRAE",111,0)
 Q
"RTN","GMTSLRAE",112,0)
FORMAT ; Format text - Left Margin 3/Right Margin 78
"RTN","GMTSLRAE",113,0)
 S DIWF="N",DIWL=3,DIWR=78 D ^DIWP
"RTN","GMTSLRAE",114,0)
 Q
"RTN","GMTSLRB")
0^52^B2674647
"RTN","GMTSLRB",1,0)
GMTSLRB ; SLC/JER,KER - Blood Availability Component ; 09/21/2001
"RTN","GMTSLRB",2,0)
 ;;2.7;Health Summary;**17,47**;Oct 20, 1995
"RTN","GMTSLRB",3,0)
 ;                                      
"RTN","GMTSLRB",4,0)
 ; External References
"RTN","GMTSLRB",5,0)
 ;   DBIA   525  ^LR( all fields
"RTN","GMTSLRB",6,0)
 ;   DBIA  2056  $$GET1^DIQ (file 2)
"RTN","GMTSLRB",7,0)
 ;   DBIA  3177  AVUNIT^VBECA4()  Blood Bank Pkg
"RTN","GMTSLRB",8,0)
 ;                         
"RTN","GMTSLRB",9,0)
MAIN ; Blood Availability 
"RTN","GMTSLRB",10,0)
 N GMI,MAX,LRDFN,IX,X,LOC
"RTN","GMTSLRB",11,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999),LOC="LRB"
"RTN","GMTSLRB",12,0)
 S LRDFN=$$GET1^DIQ(2,+($G(DFN)),63,"I") Q:+LRDFN=0!('$D(^LR(+LRDFN)))
"RTN","GMTSLRB",13,0)
 ;                 
"RTN","GMTSLRB",14,0)
 ; Get Available Units
"RTN","GMTSLRB",15,0)
 ;   Blood Bank Package  AVUNIT^VBECA4
"RTN","GMTSLRB",16,0)
 ;   Lab Package         ^GMTSLRBE    
"RTN","GMTSLRB",17,0)
 ;                 
"RTN","GMTSLRB",18,0)
 ; The next two lines support new Blood Bank Package VBEC
"RTN","GMTSLRB",19,0)
 ;    D:+($$ROK^GMTSU("VBECA4"))>0 AVUNIT^VBECA4(DFN,LOC,GMTS1,GMTS2,MAX)
"RTN","GMTSLRB",20,0)
 ;    D:+($$ROK^GMTSU("VBECA4"))'>0 ^GMTSLRBE
"RTN","GMTSLRB",21,0)
 ;                 
"RTN","GMTSLRB",22,0)
 ; And should replace D ^GMTSLRBE
"RTN","GMTSLRB",23,0)
 D ^GMTSLRBE
"RTN","GMTSLRB",24,0)
 ;                 
"RTN","GMTSLRB",25,0)
 Q:'$D(^TMP("LRB",$J))
"RTN","GMTSLRB",26,0)
 D WRTBTYP
"RTN","GMTSLRB",27,0)
 S IX=0 F  S IX=$O(^TMP("LRB",$J,IX)) Q:IX=""  D
"RTN","GMTSLRB",28,0)
 . S X=^TMP("LRB",$J,IX) D WRT
"RTN","GMTSLRB",29,0)
 K ^TMP("LRB",$J)
"RTN","GMTSLRB",30,0)
 Q
"RTN","GMTSLRB",31,0)
WRTBTYP ; Writes Blood Type (Added 03/31/1994)
"RTN","GMTSLRB",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRB",33,0)
 W ?1,"Patient Blood Type:",?22,$P(^TMP("LRB",$J,0),U,1)
"RTN","GMTSLRB",34,0)
 W ?25,$P(^TMP("LRB",$J,0),U,2),!!
"RTN","GMTSLRB",35,0)
 Q
"RTN","GMTSLRB",36,0)
WRT ; Writes Blood Availability Record
"RTN","GMTSLRB",37,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRB",38,0)
 W $P(X,U),?2,$P(X,U,2),?11,$P(X,U,3),?22,$P(X,U,4)
"RTN","GMTSLRB",39,0)
 W ?62,$J($P(X,U,6),2),?65,$P(X,U,7),?69,$P(X,U,8),!
"RTN","GMTSLRB",40,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRB",41,0)
 W ?6,"Unit Location:"
"RTN","GMTSLRB",42,0)
 W ?22,$S($L($P(X,U,10)):$P(X,U,10),1:"Blood Bank"),!
"RTN","GMTSLRB",43,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRB",44,0)
 W ?6,"Unit Division:",?22,$P(X,U,9),!
"RTN","GMTSLRB",45,0)
 I $L($P(X,U,8)) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSLRB",46,0)
 . W ?6,"Donation Type:",?22,$P(X,U,8),!
"RTN","GMTSLRB",47,0)
 Q
"RTN","GMTSLRC")
0^32^B5580058
"RTN","GMTSLRC",1,0)
GMTSLRC ; SLC/JER,KER - Chemistry & Hematology Comp Dvr ; 09/21/2001
"RTN","GMTSLRC",2,0)
 ;;2.7;Health Summary;**28,47**;Oct 20, 1995
"RTN","GMTSLRC",3,0)
 ;
"RTN","GMTSLRC",4,0)
 ; External References
"RTN","GMTSLRC",5,0)
 ;    DBIA   525  ^LR( all fields
"RTN","GMTSLRC",6,0)
 ;    DBIA 10035  ^DPT( field 63 Read w/Fileman
"RTN","GMTSLRC",7,0)
 ;    DBIA  2056  $$GET1^DIQ (file 2)
"RTN","GMTSLRC",8,0)
 ;                       
"RTN","GMTSLRC",9,0)
MAIN ; Chemisty and Hematology
"RTN","GMTSLRC",10,0)
 N GMCFLAG,GMCMNT,IX0,IX,LRDFN,MAX,CNT,PTR,RWIDTH
"RTN","GMTSLRC",11,0)
 S LRDFN=+($$GET1^DIQ(2,(+($G(DFN))_","),63,"I")) Q:+LRDFN=0  Q:'$D(^LR(LRDFN))
"RTN","GMTSLRC",12,0)
 I $D(GMTSNDM),(GMTSNDM>0) S MAX=GMTSNDM
"RTN","GMTSLRC",13,0)
 E  S MAX=999
"RTN","GMTSLRC",14,0)
 S RWIDTH=8 ;Optional variable used in ^GMTSLRCE
"RTN","GMTSLRC",15,0)
 D ^GMTSLRCE
"RTN","GMTSLRC",16,0)
 I '$D(^TMP("LRC",$J)) Q
"RTN","GMTSLRC",17,0)
 D WRTHDR S GMCMNT=$S($P($G(^GMT(142.99,1,0)),U,3)="Y":1,1:0)
"RTN","GMTSLRC",18,0)
 S IX=GMTS1 F IX0=1:1:MAX S IX=$O(^TMP("LRC",$J,IX)) Q:IX=""!(IX>GMTS2)  S (PTR,CNT)=0 F  S PTR=$O(^TMP("LRC",$J,IX,PTR)) Q:PTR=""  S CNT=CNT+1 D WRT
"RTN","GMTSLRC",19,0)
 I +$G(GMCFLAG) D
"RTN","GMTSLRC",20,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSLRC",21,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "!!  Indicates COMMENTS AVAILABLE...Refer to Interim Lab Report.",!
"RTN","GMTSLRC",22,0)
 K ^TMP("LRC",$J)
"RTN","GMTSLRC",23,0)
 Q
"RTN","GMTSLRC",24,0)
WRTHDR ; Prints columnar header
"RTN","GMTSLRC",25,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Collection DT",?18,"Specimen",?29,"Test Name",?48,"Result",?58,"Units",?68,"Ref Range",!!
"RTN","GMTSLRC",26,0)
 S GMTSNPG=1
"RTN","GMTSLRC",27,0)
 Q
"RTN","GMTSLRC",28,0)
WRT ; Writes Chemistry & Hematology Component
"RTN","GMTSLRC",29,0)
 N GMI,GMX
"RTN","GMTSLRC",30,0)
 I PTR="C",'+$G(GMCMNT) Q
"RTN","GMTSLRC",31,0)
 I PTR="C",($D(^TMP("LRC",$J,IX,"C"))>9),+$G(GMCMNT) D  Q
"RTN","GMTSLRC",32,0)
 . S GMI=0 F  S GMI=$O(^TMP("LRC",$J,IX,"C",GMI)) Q:GMI'>0  D
"RTN","GMTSLRC",33,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Comment: ",^TMP("LRC",$J,IX,"C",GMI),!
"RTN","GMTSLRC",34,0)
 S GMX=^TMP("LRC",$J,IX,PTR)
"RTN","GMTSLRC",35,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR
"RTN","GMTSLRC",36,0)
 W:CNT=1!(GMTSNPG) $P(GMX,U),?18,$E($P(GMX,U,2),1,10)
"RTN","GMTSLRC",37,0)
 W:CNT>1&'(GMTSNPG) ?3,"""",?12,"""",?20,""""
"RTN","GMTSLRC",38,0)
 I $D(^TMP("LRC",$J,IX,"C"))>9,'+$G(GMCMNT) W ?24,"!! " S GMCFLAG=1
"RTN","GMTSLRC",39,0)
 W ?29,$E($P(GMX,U,3),1,17),?46,$P(GMX,U,4)," ",$P(GMX,U,5),?58,$P(GMX,U,6),?68,$J($P(GMX,U,7),4),?73,"-",?74,$J($P(GMX,U,8),4),!
"RTN","GMTSLRC",40,0)
 Q
"RTN","GMTSLRCP")
0^21^B26103948
"RTN","GMTSLRCP",1,0)
GMTSLRCP ; SLC/JER,KER - Cytopathology Comp Dvr ; 09/21/2001
"RTN","GMTSLRCP",2,0)
 ;;2.7;Health Summary;**28,47**;Oct 20, 1995
"RTN","GMTSLRCP",3,0)
 ;
"RTN","GMTSLRCP",4,0)
 ; External References
"RTN","GMTSLRCP",5,0)
 ;    DBIA   525  ^LR( all fields
"RTN","GMTSLRCP",6,0)
 ;    DBIA 10035  ^DPT( field 63 Read w/Fileman
"RTN","GMTSLRCP",7,0)
 ;    DBIA  2056  $$GET1^DIQ (file 2)
"RTN","GMTSLRCP",8,0)
 ;                   
"RTN","GMTSLRCP",9,0)
MAIN ; Cytopathology
"RTN","GMTSLRCP",10,0)
 N GMI,IX,IX0,IX1,MAX,LRDFN
"RTN","GMTSLRCP",11,0)
 S LRDFN=+($$GET1^DIQ(2,(+($G(DFN))_","),63,"I")) Q:+LRDFN=0  Q:'$D(^LR(LRDFN))
"RTN","GMTSLRCP",12,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999) D ^GMTSLRPE
"RTN","GMTSLRCP",13,0)
 Q:'$D(^TMP("LRCY",$J))  S IX=""
"RTN","GMTSLRCP",14,0)
 F GMI=1:1:MAX S IX=$O(^TMP("LRCY",$J,IX)) Q:IX=""  D  Q:$D(GMTSQIT)
"RTN","GMTSLRCP",15,0)
 . D:GMI>1 CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>1&'GMTSNPG ! S IX0=""
"RTN","GMTSLRCP",16,0)
 . F  S IX0=$O(^TMP("LRCY",$J,IX,IX0)) Q:IX0=""  D  Q:$D(GMTSQIT)
"RTN","GMTSLRCP",17,0)
 . . D TRVRS
"RTN","GMTSLRCP",18,0)
 K ^TMP("LRCY",$J)
"RTN","GMTSLRCP",19,0)
 Q
"RTN","GMTSLRCP",20,0)
TRVRS ; Traverses/Interprets ^TMP("LRCY",$J,
"RTN","GMTSLRCP",21,0)
 N GMS,SPEC
"RTN","GMTSLRCP",22,0)
 I IX0=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Collected:",?19,$P(^TMP("LRCY",$J,IX,IX0),U),?31,"Acc:",?36,$P(^TMP("LRCY",$J,IX,IX0),U,2),! Q
"RTN","GMTSLRCP",23,0)
 I IX0=1 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Specimen:" S GMS=0 F  S GMS=$O(^TMP("LRCY",$J,IX,IX0,GMS)) Q:GMS'>0  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?19,^TMP("LRCY",$J,IX,IX0,GMS),!
"RTN","GMTSLRCP",24,0)
 I IX0=1,($P(^TMP("LRCY",$J,IX,IX0),U,2)'>0) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"** REPORT NOT YET RELEASED **",!
"RTN","GMTSLRCP",25,0)
 Q:IX0=1  D @$E(IX0,1,2)
"RTN","GMTSLRCP",26,0)
 Q
"RTN","GMTSLRCP",27,0)
AH ; Writes clinical history
"RTN","GMTSLRCP",28,0)
 N GMTSH,GMTSHL,GMTSHLI
"RTN","GMTSLRCP",29,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Brief Clinical Hx:",!
"RTN","GMTSLRCP",30,0)
 S GMTSH=0
"RTN","GMTSLRCP",31,0)
 F  S GMTSH=$O(^TMP("LRCY",$J,IX,IX0,GMTSH)) Q:+GMTSH'>0  S GMTSHL=^(GMTSH) D
"RTN","GMTSLRCP",32,0)
 .I $L(GMTSHL)>78 S GMTSHL=$$WRAP^GMTSORC(GMTSHL,78)
"RTN","GMTSLRCP",33,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSHL,"|"),! D
"RTN","GMTSLRCP",34,0)
 ..F GMTSHLI=2:1:$L(GMTSHL,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSHL,"|",GMTSHLI)]"" $P(GMTSHL,"|",GMTSHLI),!
"RTN","GMTSLRCP",35,0)
 Q
"RTN","GMTSLRCP",36,0)
G ; Writes Gross Description
"RTN","GMTSLRCP",37,0)
 N GMTSG,GMTSGL,GMTSGLI
"RTN","GMTSLRCP",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Gross Description:",!
"RTN","GMTSLRCP",39,0)
 S GMTSG=0
"RTN","GMTSLRCP",40,0)
 F  S GMTSG=$O(^TMP("LRCY",$J,IX,IX0,GMTSG)) Q:GMTSG'>0  S GMTSGL=^(GMTSG) D
"RTN","GMTSLRCP",41,0)
 .I $L(GMTSGL)>78 S GMTSGL=$$WRAP^GMTSORC(GMTSGL,78)
"RTN","GMTSLRCP",42,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSGL,"|"),! D
"RTN","GMTSLRCP",43,0)
 ..F GMTSGLI=2:1:$L(GMTSGL,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSGL,"|",GMTSGLI)]"" $P(GMTSGL,"|",GMTSGLI),!
"RTN","GMTSLRCP",44,0)
 Q
"RTN","GMTSLRCP",45,0)
MI ; Writes Microscopic exam/diagnosis field
"RTN","GMTSLRCP",46,0)
 N GMTSM,GMTSML,GMTSMLI
"RTN","GMTSLRCP",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Microscopic exam:",!
"RTN","GMTSLRCP",48,0)
 S GMTSM=0
"RTN","GMTSLRCP",49,0)
 F  S GMTSM=$O(^TMP("LRCY",$J,IX,IX0,GMTSM)) Q:GMTSM'>0  S GMTSML=^(GMTSM) D
"RTN","GMTSLRCP",50,0)
 . I $L(GMTSML)>78 S GMTSML=$$WRAP^GMTSORC(GMTSML,78)
"RTN","GMTSLRCP",51,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSML,"|"),! D
"RTN","GMTSLRCP",52,0)
 . . F GMTSMLI=2:1:$L(GMTSML,"|") D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSML,"|",GMTSMLI)]"" $P(GMTSML,"|",GMTSMLI),!
"RTN","GMTSLRCP",53,0)
 Q
"RTN","GMTSLRCP",54,0)
SR ; Writes Supplementary Reports
"RTN","GMTSLRCP",55,0)
 N GMTSLINE,GMTSL,GMTSR,SRDATE,X S IX1=0
"RTN","GMTSLRCP",56,0)
 F  S IX1=$O(^TMP("LRCY",$J,IX,IX0,IX1)) Q:IX1'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRCP",57,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  S SRDATE=^TMP("LRCY",$J,IX,IX0,IX1,0)
"RTN","GMTSLRCP",58,0)
 . S X=SRDATE D REGDTM4^GMTSU W !,"Supplementary Rpt: ",X,!
"RTN","GMTSLRCP",59,0)
 . S GMTSR=0
"RTN","GMTSLRCP",60,0)
 . F  S GMTSR=$O(^TMP("LRCY",$J,IX,IX0,IX1,GMTSR)) Q:GMTSR'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRCP",61,0)
 . . S GMTSLINE=^TMP("LRCY",$J,IX,IX0,IX1,GMTSR) I $L(GMTSLINE)>78 S GMTSLINE=$$WRAP^GMTSORC(GMTSLINE,78)
"RTN","GMTSLRCP",62,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSLINE,"|"),! D
"RTN","GMTSLRCP",63,0)
 . . . F GMTSL=2:1:$L(GMTSLINE,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSLRCP",64,0)
 . . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRCP",65,0)
 . . . . W:$P(GMTSLINE,"|",GMTSL)]"" $P(GMTSLINE,"|",GMTSL),!
"RTN","GMTSLRCP",66,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSLRCP",67,0)
 Q
"RTN","GMTSLRCP",68,0)
ND ; Writes Diagnosis field
"RTN","GMTSLRCP",69,0)
 N GMTSD,GMTSDL,GMTSDLI
"RTN","GMTSLRCP",70,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !," Cytopathology Dx:",!
"RTN","GMTSLRCP",71,0)
 S GMTSD=0
"RTN","GMTSLRCP",72,0)
 F  S GMTSD=$O(^TMP("LRCY",$J,IX,IX0,GMTSD)) Q:GMTSD'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRCP",73,0)
 . S GMTSDL=^(GMTSD)
"RTN","GMTSLRCP",74,0)
 . I $L(GMTSDL)>78 S GMTSDL=$$WRAP^GMTSORC(GMTSDL,78)
"RTN","GMTSLRCP",75,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMTSDL,"|"),!
"RTN","GMTSLRCP",76,0)
 . F GMTSDLI=2:1:$L(GMTSDL,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSLRCP",77,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRCP",78,0)
 . . W:$P(GMTSDL,"|",GMTSDLI)]"" $P(GMTSDL,"|",GMTSDLI),!
"RTN","GMTSLRCP",79,0)
 Q
"RTN","GMTSLRCP",80,0)
OT ; Traverses/Interprets Organ/Tissue Subarray
"RTN","GMTSLRCP",81,0)
 N OT S OT=0 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRCP",82,0)
 W ?7,"Topography:",?19,^TMP("LRCY",$J,IX,IX0,OT),!
"RTN","GMTSLRCP",83,0)
 F  S OT=$O(^TMP("LRCY",$J,IX,IX0,OT)) Q:OT=""  D @$E(OT,1)
"RTN","GMTSLRCP",84,0)
 Q
"RTN","GMTSLRCP",85,0)
D ; Writes Disease Field
"RTN","GMTSLRCP",86,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRCP",87,0)
 W:OT="D1"!(GMTSNPG) ?9,"Diseases:"
"RTN","GMTSLRCP",88,0)
 W ?21,^TMP("LRCY",$J,IX,IX0,OT),!
"RTN","GMTSLRCP",89,0)
 Q
"RTN","GMTSLRCP",90,0)
M ; Writes Morphology Field
"RTN","GMTSLRCP",91,0)
 N GME
"RTN","GMTSLRCP",92,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRCP",93,0)
 W ?7,"Morphology:",?21,$P(^TMP("LRCY",$J,IX,IX0,OT),U),!
"RTN","GMTSLRCP",94,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRCP",95,0)
 S GME="" F  S GME=$O(^TMP("LRCY",$J,IX,IX0,OT,GME)) Q:GME=""  D  Q:$D(GMTSQIT)
"RTN","GMTSLRCP",96,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRCP",97,0)
 . W:GME[1!(GMTSNPG) ?9,"Etiology:"
"RTN","GMTSLRCP",98,0)
 . W ?23,^TMP("LRCY",$J,IX,IX0,OT,GME),!
"RTN","GMTSLRCP",99,0)
 Q
"RTN","GMTSLRCP",100,0)
P ; Writes Procedure Field
"RTN","GMTSLRCP",101,0)
 N GMTSJ,GMK S GMTSJ=$P(^TMP("LRCY",$J,IX,IX0,OT),U)
"RTN","GMTSLRCP",102,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRCP",103,0)
 I $L(GMTSJ)>56 S GMTSJ=$$WRAP^GMTSORC(GMTSJ,56)
"RTN","GMTSLRCP",104,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:((OT="P1")!(GMTSNPG)) ?7,"Procedures:"
"RTN","GMTSLRCP",105,0)
 W ?21,$P(GMTSJ,"|"),!
"RTN","GMTSLRCP",106,0)
 F GMK=2:1:$L(GMTSJ,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSLRCP",107,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRCP",108,0)
 . W:$P(GMTSJ,"|",GMK)]"" ?23,$P(GMTSJ,"|",GMK),!
"RTN","GMTSLRCP",109,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLRCP",110,0)
 Q
"RTN","GMTSLRCP",111,0)
XI ; Writes ICD diagnoses
"RTN","GMTSLRCP",112,0)
 N GMTSDX D CKP^GMTSUP Q:$D(GMTSQIT)  W "  ICD-9 Diagnoses:" S GMTSDX=0
"RTN","GMTSLRCP",113,0)
 F  S GMTSDX=$O(^TMP("LRCY",$J,IX,IX0,GMTSDX)) Q:GMTSDX=""  D  Q:$D(GMTSQIT)
"RTN","GMTSLRCP",114,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMTSNPG ?2,"ICD-9 Diagnoses:"
"RTN","GMTSLRCP",115,0)
 . W ?19,$P(^TMP("LRCY",$J,IX,IX0,GMTSDX),U)
"RTN","GMTSLRCP",116,0)
 . W ?28,$P(^TMP("LRCY",$J,IX,IX0,GMTSDX),U,2),!
"RTN","GMTSLRCP",117,0)
 Q
"RTN","GMTSLRM")
0^22^B24007882
"RTN","GMTSLRM",1,0)
GMTSLRM ; SLC/JER,KER - Microbiology Component Driver ; 09/21/2001
"RTN","GMTSLRM",2,0)
 ;;2.7;Health Summary;**28,47**;Oct 20, 1995
"RTN","GMTSLRM",3,0)
 ;
"RTN","GMTSLRM",4,0)
 ; External References
"RTN","GMTSLRM",5,0)
 ;    DBIA   525  ^LR( all fields
"RTN","GMTSLRM",6,0)
 ;    DBIA 10035  ^DPT( field 63 Read w/Fileman
"RTN","GMTSLRM",7,0)
 ;    DBIA  2056  $$GET1^DIQ (file 2)
"RTN","GMTSLRM",8,0)
 ;                         
"RTN","GMTSLRM",9,0)
MAIN ; Microbiology
"RTN","GMTSLRM",10,0)
 N IX0,IX,LRDFN,MAX,D1,D2,D3
"RTN","GMTSLRM",11,0)
 S LRDFN=+($$GET1^DIQ(2,(+($G(DFN))_","),63,"I")) Q:+LRDFN=0  Q:'$D(^LR(LRDFN))
"RTN","GMTSLRM",12,0)
 Q:+($S('$D(^LR(LRDFN,"MI",0)):1,'$O(^LR(LRDFN,"MI",GMTS1)):1,$O(^(GMTS1))>GMTS2:1,1:0))
"RTN","GMTSLRM",13,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999),IX=GMTS1
"RTN","GMTSLRM",14,0)
 F IX0=1:1:MAX S IX=$O(^LR(LRDFN,"MI",IX)) Q:+IX'>0!(IX>GMTS2)!$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  D  Q:$D(GMTSQIT)
"RTN","GMTSLRM",15,0)
 . D ^GMTSLRME I $D(^TMP("LRM",$J)) D:IX0>1 CKP^GMTSUP Q:$D(GMTSQIT)  W:IX0>1 ! D INTRP
"RTN","GMTSLRM",16,0)
 . K ^TMP("LRM",$J)
"RTN","GMTSLRM",17,0)
 Q
"RTN","GMTSLRM",18,0)
INTRP ; Interprets ^TMP("LRM",$J
"RTN","GMTSLRM",19,0)
 N GMZ,GMK S (GMZ,GMK)=""
"RTN","GMTSLRM",20,0)
 F  S GMZ=$O(^TMP("LRM",$J,GMZ)) Q:GMZ=""  D RDNODE  Q:$D(GMTSQIT)
"RTN","GMTSLRM",21,0)
 Q
"RTN","GMTSLRM",22,0)
RDNODE ; Reads current node of ^TMP("LRM",$J
"RTN","GMTSLRM",23,0)
 N GMABX,COM S GMABX=0 I GMZ=0 D  Q
"RTN","GMTSLRM",24,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?10,"Collected:",?21,$P(^TMP("LRM",$J,GMZ),U),?43,"Acc:",?48,$P(^TMP("LRM",$J,GMZ),U,2),!
"RTN","GMTSLRM",25,0)
 . I $P(^TMP("LRM",$J,GMZ),U,6)'=$P(^(GMZ),U,3) D
"RTN","GMTSLRM",26,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?2,"Collection Sample:",?21,$P(^TMP("LRM",$J,GMZ),U,6),!
"RTN","GMTSLRM",27,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?6,"Site/Specimen:",?21,$TR($P(^TMP("LRM",$J,GMZ),U,3),"|"," "),!
"RTN","GMTSLRM",28,0)
 . S COM=$P(^TMP("LRM",$J,GMZ),U,7)
"RTN","GMTSLRM",29,0)
 . I COM]"" D
"RTN","GMTSLRM",30,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",31,0)
 . . W "Comment on Specimen:"
"RTN","GMTSLRM",32,0)
 . . I $L(COM)>58 S COM=$$WRAP^GMTSORC(COM,58)
"RTN","GMTSLRM",33,0)
 . . W ?21,$P(COM,"|"),!
"RTN","GMTSLRM",34,0)
 . . I $L($P(COM,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?22,$P(COM,"|",2),!
"RTN","GMTSLRM",35,0)
 . D WRTTEST^GMTSLRM1
"RTN","GMTSLRM",36,0)
 S GMK="" F  S GMK=$O(^TMP("LRM",$J,GMZ,GMK)) Q:GMK=""  D WRTNODE Q:$D(GMTSQIT)
"RTN","GMTSLRM",37,0)
 Q
"RTN","GMTSLRM",38,0)
WRTNODE ; Writes current node of ^TMP("LRM",$J
"RTN","GMTSLRM",39,0)
 N GML,SMEAR,QTY,ORG,GMN,RSMEAR
"RTN","GMTSLRM",40,0)
 I GMZ="BSTER" D  Q
"RTN","GMTSLRM",41,0)
 . I GMK=0 D  Q
"RTN","GMTSLRM",42,0)
 . . Q:$P(^TMP("LRM",$J,"BSTER",GMK),U)']""
"RTN","GMTSLRM",43,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",44,0)
 . .  W ?2,"Sterility Control:",?21,$P(^TMP("LRM",$J,"BSTER",GMK),U),! Q
"RTN","GMTSLRM",45,0)
 . D CKP^GMTSUP I $D(GMTSQIT)
"RTN","GMTSLRM",46,0)
 . W ?13,"Number:",?21,GMK,?34,"Sterility Results: ",$P(^TMP("LRM",$J,GMZ,GMK),U),!
"RTN","GMTSLRM",47,0)
 I GMK=0 S GMN=$G(^TMP("LRM",$J,GMZ,GMK)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,$S(GMZ="BACT":"    Bact ",GMZ="TB":"Mycobact ",GMZ="MYCO":"Mycology ",GMZ="PARA":"Parasite ",GMZ="VIRO":"Virology ",1:"         ")_"Report:",?21,$P(GMN,U),! D  Q
"RTN","GMTSLRM",48,0)
 . I GMZ="BACT" D  Q:$D(GMTSQIT)
"RTN","GMTSLRM",49,0)
 . . I $P(GMN,U,3)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?7,"Urine Screen: ",$P(GMN,U,3),!
"RTN","GMTSLRM",50,0)
 . . I $P(GMN,U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?6,"Sputum Screen: ",$P(GMN,U,2),!
"RTN","GMTSLRM",51,0)
 . I GMZ="TB" D  Q:$D(GMTSQIT)
"RTN","GMTSLRM",52,0)
 . . I $P(GMN,U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Acid Fast Stain: ",$E($P(GMN,U,2),1,20) D
"RTN","GMTSLRM",53,0)
 . . . S QTY=$P(GMN,U,3)
"RTN","GMTSLRM",54,0)
 . . . I $L(QTY)>35 S QTY=$$WRAP^GMTSORC(QTY,35)
"RTN","GMTSLRM",55,0)
 . . . W ?44,$P(QTY,"|"),!
"RTN","GMTSLRM",56,0)
 . . . I $L($P(QTY,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?44,$P(QTY,"|",2),!
"RTN","GMTSLRM",57,0)
 I GMZ="GRAM" D WRTGRM^GMTSLRM1 Q
"RTN","GMTSLRM",58,0)
 I GMK="SMEAR" D  Q
"RTN","GMTSLRM",59,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",60,0)
 . W ?9,"Smear/Prep:"
"RTN","GMTSLRM",61,0)
 . S SMEAR=0
"RTN","GMTSLRM",62,0)
 . F  S SMEAR=$O(^TMP("LRM",$J,GMZ,GMK,SMEAR)) Q:SMEAR'>0  D  I +$O(^TMP("LRM",$J,GMK,SMEAR)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",63,0)
 . . S RSMEAR=^TMP("LRM",$J,GMZ,GMK,SMEAR)
"RTN","GMTSLRM",64,0)
 . . I $L(RSMEAR)>58 S RSMEAR=$$WRAP^GMTSORC(RSMEAR,58)
"RTN","GMTSLRM",65,0)
 . . W ?21,$P(RSMEAR,"|"),!
"RTN","GMTSLRM",66,0)
 . . I $L($P(RSMEAR,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?22,$P(RSMEAR,"|",2),!
"RTN","GMTSLRM",67,0)
 I GMK="R" D REMARKS^GMTSLRM1 Q
"RTN","GMTSLRM",68,0)
 I GMZ'="CABXL" D  Q:$D(GMTSQIT)
"RTN","GMTSLRM",69,0)
 . S ORG=$P(^TMP("LRM",$J,GMZ,GMK),U),QTY=$P(^(GMK),U,2)
"RTN","GMTSLRM",70,0)
 . I $L(ORG)>58 S ORG=$$WRAP^GMTSORC(ORG,58)
"RTN","GMTSLRM",71,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",72,0)
 . W ?11,"Organism:"
"RTN","GMTSLRM",73,0)
 . W ?21,$P(ORG,"|",1),!
"RTN","GMTSLRM",74,0)
 . I $L($P(ORG,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,$P(ORG,"|",2),!
"RTN","GMTSLRM",75,0)
 . I QTY]"" W ?11,"Quantity:" D
"RTN","GMTSLRM",76,0)
 . . I $L(QTY)>58 S QTY=$$WRAP^GMTSORC(QTY,58)
"RTN","GMTSLRM",77,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(QTY,"|"),!
"RTN","GMTSLRM",78,0)
 . . I $L($P(QTY,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,$P(QTY,"|",2),!
"RTN","GMTSLRM",79,0)
 . D COMMENT^GMTSLRM1 Q:$D(GMTSQIT)
"RTN","GMTSLRM",80,0)
 . I GMZ="TB" D TBSUSC^GMTSLRM1
"RTN","GMTSLRM",81,0)
 I GMZ="CABXL" D
"RTN","GMTSLRM",82,0)
 . I GMK=1!(GMABX=1) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Ser Abx Lev:"
"RTN","GMTSLRM",83,0)
 . W ?21,$E($P(^TMP("LRM",$J,GMZ,GMK),U),1,20),?45,$$DRAW($P(^TMP("LRM",$J,GMZ,GMK),U,2)),?55,$P(^TMP("LRM",$J,GMZ,GMK),U,3)," ug/ml",! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",84,0)
 I GMZ="BACT",$D(^TMP("LRM",$J,GMZ,GMK,"SUSC")) D ANTIBX^GMTSLRM1 Q
"RTN","GMTSLRM",85,0)
 I GMZ="PARA",$D(^TMP("LRM",$J,GMZ,GMK))=11 D
"RTN","GMTSLRM",86,0)
 . S GML=0
"RTN","GMTSLRM",87,0)
 . F  S GML=$O(^TMP("LRM",$J,GMZ,GMK,GML)) Q:GML'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRM",88,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRM",89,0)
 . . W ?23,$P(^TMP("LRM",$J,GMZ,GMK,GML),U)
"RTN","GMTSLRM",90,0)
 . . S QTY=$P(^TMP("LRM",$J,GMZ,GMK,GML),U,2)
"RTN","GMTSLRM",91,0)
 . . I $L(QTY)>34 S QTY=$$WRAP^GMTSORC(QTY,34)
"RTN","GMTSLRM",92,0)
 . . W ?45,$P(QTY,"|"),!
"RTN","GMTSLRM",93,0)
 . . I $L($P(QTY,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?45,$P(QTY,"|",2),!
"RTN","GMTSLRM",94,0)
 . . D PARACOMM^GMTSLRM1
"RTN","GMTSLRM",95,0)
 Q
"RTN","GMTSLRM",96,0)
DRAW(CODE) ; Peak/Trough/Random Abx level
"RTN","GMTSLRM",97,0)
 Q $S(CODE="P":"PEAK",CODE="T":"TROUGH",1:"RANDOM")
"RTN","GMTSLRMB")
0^23^B21099281
"RTN","GMTSLRMB",1,0)
GMTSLRMB ; SLC/JER,KER - Microbiology Component Dvr ; 09/21/2001
"RTN","GMTSLRMB",2,0)
 ;;2.7;Health Summary;**25,28,47**;Oct 20, 1995
"RTN","GMTSLRMB",3,0)
 ;
"RTN","GMTSLRMB",4,0)
 ; External References
"RTN","GMTSLRMB",5,0)
 ;    DBIA   525  ^LR( all fields
"RTN","GMTSLRMB",6,0)
 ;    DBIA 10035  ^DPT( field 63 Read w/Fileman
"RTN","GMTSLRMB",7,0)
 ;    DBIA  2056  $$GET1^DIQ (file 2)
"RTN","GMTSLRMB",8,0)
 ;                       
"RTN","GMTSLRMB",9,0)
MAIN ; Microbioloby Brief
"RTN","GMTSLRMB",10,0)
 N IX0,IX,LRDFN,MAX,D1,D2,D3
"RTN","GMTSLRMB",11,0)
 S LRDFN=+($$GET1^DIQ(2,(+($G(DFN))_","),63,"I")) Q:+LRDFN=0  Q:'$D(^LR(LRDFN))
"RTN","GMTSLRMB",12,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999)
"RTN","GMTSLRMB",13,0)
 S IX=GMTS1 F IX0=1:1:MAX S IX=$O(^LR(LRDFN,"MI",IX)) Q:+IX'>0!(IX>GMTS2)  D CKP^GMTSUP Q:$D(GMTSQIT)  D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",14,0)
 . D ^GMTSLRME I $D(^TMP("LRM",$J)) D
"RTN","GMTSLRMB",15,0)
 . . D:IX0>1 CKP^GMTSUP Q:$D(GMTSQIT)  W:IX0>1&'GMTSNPG ! D INTRP
"RTN","GMTSLRMB",16,0)
 . K ^TMP("LRM",$J)
"RTN","GMTSLRMB",17,0)
 Q
"RTN","GMTSLRMB",18,0)
INTRP ; Interprets ^TMP("LRM",$J
"RTN","GMTSLRMB",19,0)
 N GMTSJ,GMK,GMW,SMEAR,GMABX
"RTN","GMTSLRMB",20,0)
 S (GMTSJ,GMK)=""
"RTN","GMTSLRMB",21,0)
 F  S GMTSJ=$O(^TMP("LRM",$J,GMTSJ)) Q:GMTSJ=""!$D(GMTSQIT)  D RDNODE
"RTN","GMTSLRMB",22,0)
 Q
"RTN","GMTSLRMB",23,0)
RDNODE ; Reads current node of ^TMP("LRM",$J
"RTN","GMTSLRMB",24,0)
 Q:GMTSJ="BSTER"
"RTN","GMTSLRMB",25,0)
 I GMTSJ=0 D  Q
"RTN","GMTSLRMB",26,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W $P($P(^TMP("LRM",$J,GMTSJ),U)," "),?12,$P(^TMP("LRM",$J,GMTSJ),U,3),!
"RTN","GMTSLRMB",27,0)
 . D WRTTEST
"RTN","GMTSLRMB",28,0)
 S GMK=""
"RTN","GMTSLRMB",29,0)
 F  S GMK=$O(^TMP("LRM",$J,GMTSJ,GMK)) Q:GMK=""!$D(GMTSQIT)  D WRTNODE
"RTN","GMTSLRMB",30,0)
 I GMTSJ="TB" D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",31,0)
 . I $P(^TMP("LRM",$J,GMTSJ,0),U,2)]"" D
"RTN","GMTSLRMB",32,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",33,0)
 . . W "AFB Sme:",?12,$E($P(^TMP("LRM",$J,GMTSJ,0),U,2),1,20),!
"RTN","GMTSLRMB",34,0)
 . . I $P(^TMP("LRM",$J,GMTSJ,0),U,3)]"" D
"RTN","GMTSLRMB",35,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",36,0)
 . . . W ?12,$P(^TMP("LRM",$J,GMTSJ,0),U,3),!
"RTN","GMTSLRMB",37,0)
 I $D(^TMP("LRM",$J,GMTSJ,"SMEAR")) D
"RTN","GMTSLRMB",38,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",39,0)
 . W ?2,"Smear:"
"RTN","GMTSLRMB",40,0)
 . S SMEAR=0
"RTN","GMTSLRMB",41,0)
 . F  S SMEAR=$O(^TMP("LRM",$J,GMTSJ,"SMEAR",SMEAR)) Q:SMEAR'>0  W ?12,^(SMEAR),! I +$O(^TMP("LRM",$J,"SMEAR",SMEAR)) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",42,0)
 Q
"RTN","GMTSLRMB",43,0)
WRTNODE ; Writes current node of ^TMP("LRM",$J
"RTN","GMTSLRMB",44,0)
 N GML,QTY
"RTN","GMTSLRMB",45,0)
 I GMK=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?1,"Report:",?12,$P(^TMP("LRM",$J,GMTSJ,GMK),U),! Q
"RTN","GMTSLRMB",46,0)
 I GMTSJ="GRAM" D WRTGRM Q
"RTN","GMTSLRMB",47,0)
 Q:GMK="SMEAR"
"RTN","GMTSLRMB",48,0)
 I GMK="R" D REMARKS Q
"RTN","GMTSLRMB",49,0)
 I GMTSJ'="CABXL" D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",50,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Organsm:",?12,$P(^TMP("LRM",$J,GMTSJ,GMK),U),!
"RTN","GMTSLRMB",51,0)
 . I $P(^TMP("LRM",$J,GMTSJ,GMK),U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"QTY:",?12,$P(^TMP("LRM",$J,GMTSJ,GMK),U,2),!
"RTN","GMTSLRMB",52,0)
 I GMTSJ="CABXL" D
"RTN","GMTSLRMB",53,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",54,0)
 . W:GMK=1 "Ser Abx:"
"RTN","GMTSLRMB",55,0)
 . W ?12,$E($P(^TMP("LRM",$J,GMTSJ,GMK),U),1,18),?30,$$DRAW^GMTSLRM($P(^TMP("LRM",$J,GMTSJ,GMK),U,2)),?38,$P(^(GMK),U,3)," ug/ml",!
"RTN","GMTSLRMB",56,0)
 I GMTSJ="BACT",$D(^TMP("LRM",$J,GMTSJ,GMK,"SUSC")) D ANTIBX Q
"RTN","GMTSLRMB",57,0)
 I GMTSJ="PARA",$D(^TMP("LRM",$J,GMTSJ,GMK))=11 D
"RTN","GMTSLRMB",58,0)
 . S GML=""
"RTN","GMTSLRMB",59,0)
 . F  S GML=$O(^TMP("LRM",$J,GMTSJ,GMK,GML)) Q:GML'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",60,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",61,0)
 . . W ?12,$P(^TMP("LRM",$J,GMTSJ,GMK,GML),U)
"RTN","GMTSLRMB",62,0)
 . . S QTY=$P(^TMP("LRM",$J,GMTSJ,GMK,GML),U,2)
"RTN","GMTSLRMB",63,0)
 . . I $L(QTY)>46 S QTY=$$WRAP^GMTSORC(QTY,46)
"RTN","GMTSLRMB",64,0)
 . . W ?35,$P(QTY,"|"),!
"RTN","GMTSLRMB",65,0)
 . . I $L($P(QTY,"|",2)) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?35,$P(QTY,"|",2),!
"RTN","GMTSLRMB",66,0)
 Q
"RTN","GMTSLRMB",67,0)
REMARKS ; Write remarks
"RTN","GMTSLRMB",68,0)
 N NUM,FIRST
"RTN","GMTSLRMB",69,0)
 S NUM="",FIRST=1
"RTN","GMTSLRMB",70,0)
 F  S NUM=$O(^TMP("LRM",$J,GMTSJ,GMK,NUM)) Q:+NUM'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",71,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",72,0)
 . W:$X>0 !
"RTN","GMTSLRMB",73,0)
 . I FIRST W "Remarks:" S FIRST=0
"RTN","GMTSLRMB",74,0)
 . W ?12,^TMP("LRM",$J,GMTSJ,GMK,NUM),!
"RTN","GMTSLRMB",75,0)
 Q
"RTN","GMTSLRMB",76,0)
WRTGRM ; Writes Gram Stain Results
"RTN","GMTSLRMB",77,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:$X>0 ! W:GMK=1 ?3,"Gram:" W ?12,$E(^TMP("LRM",$J,GMTSJ,GMK),1,69),!
"RTN","GMTSLRMB",78,0)
 Q
"RTN","GMTSLRMB",79,0)
ANTIBX ; Writes Antibiotic susceptability data
"RTN","GMTSLRMB",80,0)
 N GML,GMCNT,ANAM,ANLEN,ANEXT,GMSUB
"RTN","GMTSLRMB",81,0)
 S GMABX=1
"RTN","GMTSLRMB",82,0)
 F GMSUB="S","I","R","O" D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",83,0)
 . Q:+$D(^TMP("LRM",$J,GMTSJ,GMK,"SUSC",GMSUB))'>0
"RTN","GMTSLRMB",84,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRMB",85,0)
 . W:GMSUB="S" "Susc to:    "
"RTN","GMTSLRMB",86,0)
 . W:GMSUB="I" "Interme:    "
"RTN","GMTSLRMB",87,0)
 . W:GMSUB="R" "Resista:    "
"RTN","GMTSLRMB",88,0)
 . W:GMSUB="O" "  Other:    "
"RTN","GMTSLRMB",89,0)
 . S ANLEN=10,GML=""
"RTN","GMTSLRMB",90,0)
 . F  S GML=$O(^TMP("LRM",$J,GMTSJ,GMK,"SUSC",GMSUB,GML)) Q:GML=""  S ANAM=$P($P(^(GML),U),";",2)_$S(GMSUB="O":"("_$P(^(GML),U,2)_"/"_$P(^(GML),U,3)_")",1:""),ANEXT=$O(^(GML)) D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",91,0)
 . . I $L(ANAM)+ANLEN>79 D CKP^GMTSUP Q:$D(GMTSQIT)  W:'GMTSNPG ! W ?12 S ANLEN=10
"RTN","GMTSLRMB",92,0)
 . . W ANAM,$S(ANEXT]"":", ",1:"") S ANLEN=ANLEN+$L(ANAM)+2
"RTN","GMTSLRMB",93,0)
 . W !
"RTN","GMTSLRMB",94,0)
 Q
"RTN","GMTSLRMB",95,0)
WRTTEST ; Writes Lab Test for Accession
"RTN","GMTSLRMB",96,0)
 N GML,GMCNT,TNAM,TLEN,TNEXT
"RTN","GMTSLRMB",97,0)
 Q:'$D(^TMP("LRM",$J,GMTSJ,"TEST"))
"RTN","GMTSLRMB",98,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Test(s):    "
"RTN","GMTSLRMB",99,0)
 S TLEN=10,GML=""
"RTN","GMTSLRMB",100,0)
 F  S GML=$O(^TMP("LRM",$J,GMTSJ,"TEST",GML)) Q:GML=""  S TNAM=$P($G(^(GML)),U),TNEXT=$O(^(GML)) D  Q:$D(GMTSQIT)
"RTN","GMTSLRMB",101,0)
 . I $L(TNAM)+TLEN>79 D CKP^GMTSUP Q:$D(GMTSQIT)  W:'GMTSNPG ! W ?12 S TLEN=10
"RTN","GMTSLRMB",102,0)
 . W TNAM,$S(TNEXT]"":", ",1:"") S TLEN=TLEN+$L(TNAM)+2
"RTN","GMTSLRMB",103,0)
 W !
"RTN","GMTSLRMB",104,0)
 Q
"RTN","GMTSLROE")
0^50^B11334514
"RTN","GMTSLROE",1,0)
GMTSLROE ; SLC/JER,KER - Lab Orders Extract Routine ; 09/21/2001
"RTN","GMTSLROE",2,0)
 ;;2.7;Health Summary;**9,28,47**;Oct 20, 1995
"RTN","GMTSLROE",3,0)
 ;
"RTN","GMTSLROE",4,0)
 ; External References
"RTN","GMTSLROE",5,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSLROE",6,0)
 ;   DBIA   525  ^LR(
"RTN","GMTSLROE",7,0)
 ;   DBIA   532  ^LRO(69,
"RTN","GMTSLROE",8,0)
 ;   DBIA   524  ^LAB(61,
"RTN","GMTSLROE",9,0)
 ;   DBIA    67  ^LAB(60
"RTN","GMTSLROE",10,0)
 ;   DBIA   530  ^LAB(62.05,
"RTN","GMTSLROE",11,0)
 ;   DBIA   531  ^LRO(68,
"RTN","GMTSLROE",12,0)
 ;   DBIA 10142  $$VERSION^XPDUTL
"RTN","GMTSLROE",13,0)
 ;                 
"RTN","GMTSLROE",14,0)
XTRCT ; Gets lab orders and loads them into GMTSLRO local array
"RTN","GMTSLROE",15,0)
 N LRDFN,GMI,CD,ID,SN,TN K ^TMP("LROI",$J)
"RTN","GMTSLROE",16,0)
 K ^TMP("LRO",$J)
"RTN","GMTSLROE",17,0)
 Q:'$D(^DPT(DFN,"LR"))  S LRDFN=+^DPT(DFN,"LR") Q:'$D(^LR(LRDFN))
"RTN","GMTSLROE",18,0)
 S CD=GMTSBEG-.1
"RTN","GMTSLROE",19,0)
 F  S CD=$O(^LRO(69,"D",LRDFN,CD)) Q:CD'>0!(CD>GMTSEND)  S SN=0 F  S SN=$O(^LRO(69,"D",LRDFN,CD,SN)) Q:SN'>0  S TN=0 F  S TN=$O(^LRO(69,CD,1,SN,2,TN)) Q:TN'>0  S ^TMP("LROI",$J,9999999-CD,SN,TN)=""
"RTN","GMTSLROE",20,0)
 S (GMI,ID)=0 F  S ID=$O(^TMP("LROI",$J,ID)) Q:ID'>0!(GMI=MAX)  S CD=9999999-ID,SN=0 F  S SN=$O(^TMP("LROI",$J,ID,SN)) Q:SN'>0!(GMI=MAX)  S TN=0 F  S TN=$O(^TMP("LROI",$J,ID,SN,TN)) Q:TN'>0!(GMI=MAX)  D SET
"RTN","GMTSLROE",21,0)
 K ^TMP("LROI",$J)
"RTN","GMTSLROE",22,0)
 Q
"RTN","GMTSLROE",23,0)
SET ; Sets ^TMP("LRO",$J, w/appropriate data
"RTN","GMTSLROE",24,0)
 N SPST,CST,OS,CDT,SPST,FST,RDT,SITE,SPEC,TST,IDT,COLL,ODT,MD,CS,URG,ACC
"RTN","GMTSLROE",25,0)
 N RL,TEST
"RTN","GMTSLROE",26,0)
 I $D(^LRO(69,CD,1,SN,0)) S SPST=^(0) D ORDER
"RTN","GMTSLROE",27,0)
 I $D(^LRO(69,CD,1,SN,1)) S CST=^(1) D COLLECT I 1
"RTN","GMTSLROE",28,0)
 E  S OS="ORDERED",X=$P(^LRO(69,CD,1,SN,0),U,8),IDT=9999999-X D REGDTM4^GMTSU S CDT=X K X
"RTN","GMTSLROE",29,0)
 I $D(^LRO(69,CD,1,SN,3)) S FST=^(3) D RESULT I 1
"RTN","GMTSLROE",30,0)
 E  S RDT="UNKNOWN"
"RTN","GMTSLROE",31,0)
 S SITE=+$G(^LRO(69,CD,1,SN,4,+$O(^LRO(69,CD,1,SN,4,0)),0)),SPEC=$S(SITE>0:SITE_";"_$P(^LAB(61,SITE,0),U),1:";UNKNOWN")
"RTN","GMTSLROE",32,0)
 I $D(^LRO(69,CD,1,SN,2,TN,0)) S TST=^(0) S:$P(TST,"^",9)="CA" OS="CANCELED" D TEST
"RTN","GMTSLROE",33,0)
 I $D(BADTEST) K BADTEST Q
"RTN","GMTSLROE",34,0)
 I $D(IDT),$D(SN),$D(TN) S ^TMP("LRO",$J,IDT,SN_TN)=CDT_U_TEST_U_SPEC_U_URG_U_OS_U_MD_U_ODT_U_ACC_U_RDT_U_COLL_U_CD,GMI=GMI+1
"RTN","GMTSLROE",35,0)
 Q
"RTN","GMTSLROE",36,0)
ORDER ; Get Orders
"RTN","GMTSLROE",37,0)
 N IFN,FNF,FILE,NM,NSPACE,PKG,X
"RTN","GMTSLROE",38,0)
 S COLL=$S($L($P(SPST,U,4)):$P(SPST,U,4),1:"UNKNOWN")
"RTN","GMTSLROE",39,0)
 S:"LW"[COLL COLL=$S(COLL="L":"LAB",1:"WARD")
"RTN","GMTSLROE",40,0)
 S X=$P(SPST,U,5) D REGDTM4^GMTSU S ODT=X
"RTN","GMTSLROE",41,0)
 S (MD,IFN)=$P(SPST,U,6),FNF=0,NSPACE="LR"
"RTN","GMTSLROE",42,0)
 S PKG=$$VERSION^XPDUTL(NSPACE),FILE=$S($G(PKG)<5.2:6,1:200)
"RTN","GMTSLROE",43,0)
 S NM=$$NAME^GMTSU(MD,0,10) S MD=MD_";"_NM
"RTN","GMTSLROE",44,0)
 S RL=$P(SPST,U,7) Q
"RTN","GMTSLROE",45,0)
COLLECT ; Collection Date and Time
"RTN","GMTSLROE",46,0)
 N X S X=$P(CST,U),IDT=9999999-X D REGDTM4^GMTSU S CDT=X,CS=$P(CST,U,4),OS="COLLECTED"
"RTN","GMTSLROE",47,0)
 Q
"RTN","GMTSLROE",48,0)
RESULT ; Result Date and Time
"RTN","GMTSLROE",49,0)
 N X S X=$P(FST,U,2) D REGDTM4^GMTSU S RDT=X
"RTN","GMTSLROE",50,0)
 Q
"RTN","GMTSLROE",51,0)
TEST ; Lab Test Ordered
"RTN","GMTSLROE",52,0)
 N TPTR,UPTR,ACCD,ACCA,ACCN
"RTN","GMTSLROE",53,0)
 S TPTR=+TST,UPTR=$P(TST,U,2),ACCD=$P(TST,U,3)
"RTN","GMTSLROE",54,0)
 I $D(TPTR),(TPTR'>0) S BADTEST=1 Q
"RTN","GMTSLROE",55,0)
 S ACCA=$P(TST,U,4),ACCN=$P(TST,U,5)
"RTN","GMTSLROE",56,0)
 S TEST=TPTR_";"_$S($L($P(^LAB(60,TPTR,0),U))<21:$P(^(0),U),1:$P(^(.1),U))
"RTN","GMTSLROE",57,0)
 S URG=$E($S($D(^LAB(62.05,+UPTR,0)):$P(^(0),U),1:""),1,7)
"RTN","GMTSLROE",58,0)
 I $S('$D(ACCD):1,'$L(ACCA):1,'$L(ACCD):1,1:0) S ACC="NONE" Q
"RTN","GMTSLROE",59,0)
 S ACC=$S($D(^LRO(68,+ACCA,1,+ACCD,1,+ACCN,.2)):^(.2),1:"NONE")
"RTN","GMTSLROE",60,0)
 I $D(^LRO(68,+ACCA,1,+ACCD,1,+ACCN,4,TPTR,0)) S X=$P(^(0),U,5) S OS=$S('$L(X):"PROCESSING",1:"COMPLETED")
"RTN","GMTSLROE",61,0)
 Q
"RTN","GMTSLROS")
0^36^B3076639
"RTN","GMTSLROS",1,0)
GMTSLROS ; SLC/JER,KER - Lab Order Status Summary ; 09/21/2001
"RTN","GMTSLROS",2,0)
 ;;2.7;Health Summary;**28,47**;Oct 20, 1995
"RTN","GMTSLROS",3,0)
 ;
"RTN","GMTSLROS",4,0)
MAIN ; Lab Order Status
"RTN","GMTSLROS",5,0)
 N GMW,GMX,ICD,MAX,OC,SN
"RTN","GMTSLROS",6,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999)
"RTN","GMTSLROS",7,0)
 D ^GMTSLROE I '$D(^TMP("LRO",$J)) Q
"RTN","GMTSLROS",8,0)
 S (ICD,OC)=0 F  S ICD=$O(^TMP("LRO",$J,ICD)) Q:'ICD!(OC'<MAX)  S SN=0 F  S SN=$O(^TMP("LRO",$J,ICD,SN)) Q:'SN!(OC'<MAX)  D GET
"RTN","GMTSLROS",9,0)
 K ^TMP("LRO",$J)
"RTN","GMTSLROS",10,0)
 Q
"RTN","GMTSLROS",11,0)
GET ; Get Data from ^TMP("LRO",$J
"RTN","GMTSLROS",12,0)
 S GMX=^TMP("LRO",$J,ICD,SN),OC=OC+1
"RTN","GMTSLROS",13,0)
 I ICD>GMTS1,(ICD'>GMTS2) D CKP^GMTSUP Q:$D(GMTSQIT)  W:OC>1&'(GMTSNPG) ! D WRT
"RTN","GMTSLROS",14,0)
 Q
"RTN","GMTSLROS",15,0)
WRT ; Write Data
"RTN","GMTSLROS",16,0)
 N GMI,TSET,TEST S TSET="",$P(GMX,U,3)=$E($P(GMX,U,3),1,10)
"RTN","GMTSLROS",17,0)
 F GMI=1:1:3 S $P(TEST,"-",GMI)=$S(GMI=3:$P(GMX,U,GMI+1),1:$P($P(GMX,U,GMI+1),";",2))
"RTN","GMTSLROS",18,0)
 F  Q:$L(TEST)<23  S TSET=$P(TEST,"-",$L(TEST,"-"))_" "_TSET,TEST=$P(TEST,"-",1,$L(TEST,"-")-1)
"RTN","GMTSLROS",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W $P(GMX,U),?18,$E(TEST,1,20),?39,"Prov: ",$E($P($P(GMX,U,6),";",2),1,10),?56,"Ord'd: ",$P(GMX,U,7),!
"RTN","GMTSLROS",20,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG WRT W ?18,$E(TSET,1,20),?39,"# ",$E($P(GMX,U,8),1,15),?56,"Avail: ",$P(GMX,U,9),!
"RTN","GMTSLROS",21,0)
 Q
"RTN","GMTSLRS")
0^24^B7423038
"RTN","GMTSLRS",1,0)
GMTSLRS ; SLC/JER,KER - Sel Lab Component w/Selection Items ; 09/21/2001
"RTN","GMTSLRS",2,0)
 ;;2.7;Health Summary;**16,28,47**;Oct 20, 1995
"RTN","GMTSLRS",3,0)
 ;
"RTN","GMTSLRS",4,0)
 ; External References
"RTN","GMTSLRS",5,0)
 ;    DBIA    67  ^LAB(60
"RTN","GMTSLRS",6,0)
 ;    DBIA   525  ^LR( all fields
"RTN","GMTSLRS",7,0)
 ;    DBIA 10035  ^DPT( field 63 Read w/Fileman
"RTN","GMTSLRS",8,0)
 ;    DBIA  2056  $$GET1^DIQ (file 2)
"RTN","GMTSLRS",9,0)
 ;                       
"RTN","GMTSLRS",10,0)
MAIN ; Selected Lab w/Selection Items
"RTN","GMTSLRS",11,0)
 N GMTSI,GMW,GMX,LRDFN,MAX,IT,IX,PTEST,TEST,BEGIN,END,CNT,RWIDTH,GMLINE,GMCMNT,GMCFLAG
"RTN","GMTSLRS",12,0)
 S RWIDTH=8,LRDFN=+($$GET1^DIQ(2,(+($G(DFN))_","),63,"I")) Q:+LRDFN=0  Q:'$D(^LR(LRDFN))
"RTN","GMTSLRS",13,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999) Q:'$O(GMTSEG(GMTSEGN,60,0))
"RTN","GMTSLRS",14,0)
 S GMCMNT=$S($P($G(^GMT(142.99,1,0)),U,3)="Y":1,1:0)
"RTN","GMTSLRS",15,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,60,GMTSI)) Q:GMTSI'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS",16,0)
 . S (PTEST,TEST)=GMTSEG(GMTSEGN,60,GMTSI)
"RTN","GMTSLRS",17,0)
 . D @$S($L($P(^LAB(60,TEST,0),U,5)):"^GMTSLRSE",1:"PANEL")
"RTN","GMTSLRS",18,0)
 Q:'$D(^TMP("LRS",$J))  D WRTHDR Q:$D(GMTSQIT)
"RTN","GMTSLRS",19,0)
 S IT=0 F  S IT=$O(^TMP("LRS",$J,IT)) Q:+IT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS",20,0)
 . S IX="" F  S IX=$O(^TMP("LRS",$J,IT,IX)) Q:'IX!(IX>GMTS2)  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS",21,0)
 . . S GMX=^TMP("LRS",$J,IT,IX) D WRT
"RTN","GMTSLRS",22,0)
 I +$G(GMCFLAG) D
"RTN","GMTSLRS",23,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSLRS",24,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRS",25,0)
 . W "!!  Indicates COMMENTS AVAILABLE...Refer to Interim Lab Report.",!
"RTN","GMTSLRS",26,0)
 K ^TMP("LRS",$J)
"RTN","GMTSLRS",27,0)
 Q
"RTN","GMTSLRS",28,0)
PANEL ; Visits "PANEL" multiple to get pointers to atomic tests
"RTN","GMTSLRS",29,0)
 N TEST,GMW,INDX
"RTN","GMTSLRS",30,0)
 S INDX=0 F  S INDX=$O(^LAB(60,PTEST,2,INDX)) Q:'INDX  S TEST=^(INDX,0) S:'$L($P(^LAB(60,TEST,0),U,5)) PTEST=TEST D @$S($L($P(^LAB(60,TEST,0),U,5)):"^GMTSLRSE",1:"PANEL")
"RTN","GMTSLRS",31,0)
 Q
"RTN","GMTSLRS",32,0)
WRTHDR ; Prints columnar header
"RTN","GMTSLRS",33,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Collection DT",?18,"Specimen",?29,"Test Name",?48,"Result",?58,"Units",?68,"Ref Range",!!
"RTN","GMTSLRS",34,0)
 Q
"RTN","GMTSLRS",35,0)
WRT ; Writes the Lab Record
"RTN","GMTSLRS",36,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSLRS",37,0)
 . D:GMTSNPG WRTHDR
"RTN","GMTSLRS",38,0)
 . W $P(GMX,U),?18,$P($P(GMX,U,2),";",2)
"RTN","GMTSLRS",39,0)
 . I $D(^TMP("LRS",$J,"C",IX))>9,'+$G(GMCMNT) W ?24,"!! " S GMCFLAG=1
"RTN","GMTSLRS",40,0)
 . W ?29,$E($P($P(GMX,U,3),";",2),1,17),?46,$P(GMX,U,4)," ",$P(GMX,U,5),?58,$P(GMX,U,6),?68,$J($P(GMX,U,7),4),?73,"-",?74,$J($P(GMX,U,8),4),!
"RTN","GMTSLRS",41,0)
 I +$G(GMCMNT),$D(^TMP("LRS",$J,"C",IX))>9,'$D(^TMP("LRS",$J,+$O(^TMP("LRS",$J,IT)),IX)) D  Q
"RTN","GMTSLRS",42,0)
 . S GMLINE=0
"RTN","GMTSLRS",43,0)
 . F  S GMLINE=$O(^TMP("LRS",$J,"C",IX,GMLINE)) Q:GMLINE'>0  D
"RTN","GMTSLRS",44,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRS",45,0)
 . . W "Comment: ",^TMP("LRS",$J,"C",IX,GMLINE),!
"RTN","GMTSLRS",46,0)
 Q
"RTN","GMTSLRS7")
0^25^B11792281
"RTN","GMTSLRS7",1,0)
GMTSLRS7 ; SLC/JER,KER - Sel Cum Lab Comp w/Sel Items ; 09/21/2001
"RTN","GMTSLRS7",2,0)
 ;;2.7;Health Summary;**28,47**;Oct 20, 1995
"RTN","GMTSLRS7",3,0)
 ;
"RTN","GMTSLRS7",4,0)
 ; External References
"RTN","GMTSLRS7",5,0)
 ;    DBIA    67  ^LAB(60
"RTN","GMTSLRS7",6,0)
 ;    DBIA   525  ^LR( all fields
"RTN","GMTSLRS7",7,0)
 ;    DBIA 10035  ^DPT( field 63 Read w/Fileman
"RTN","GMTSLRS7",8,0)
 ;    DBIA  2056  $$GET1^DIQ (file 2)
"RTN","GMTSLRS7",9,0)
 ;                        
"RTN","GMTSLRS7",10,0)
MAIN ; Selected Cumulative Lab w/Selection Items
"RTN","GMTSLRS7",11,0)
 N GMTSI,GMW,HDR,LRDFN,MAX,TEST,RWIDTH,GMCMNT,COMMNBR,GMCOM,TAB
"RTN","GMTSLRS7",12,0)
 S LRDFN=+($$GET1^DIQ(2,(+($G(DFN))_","),63,"I")) Q:+LRDFN=0  Q:'$D(^LR(LRDFN))
"RTN","GMTSLRS7",13,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999) Q:'$O(GMTSEG(GMTSEGN,60,0))
"RTN","GMTSLRS7",14,0)
 S RWIDTH=4,GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,60,GMTSI)) Q:GMTSI'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",15,0)
 . S TEST=GMTSEG(GMTSEGN,60,GMTSI) D ^GMTSLRSE
"RTN","GMTSLRS7",16,0)
 Q:'$D(^TMP("LRS",$J))  S GMCMNT=$S($P($G(^GMT(142.99,1,0)),U,3)="Y":1,1:0),COMMNBR=0
"RTN","GMTSLRS7",17,0)
 D DISPLAY I GMCMNT,'$D(GMTSQIT) D WRTCOMM
"RTN","GMTSLRS7",18,0)
 K ^TMP("LRS",$J),^TMP("LRSR",$J)
"RTN","GMTSLRS7",19,0)
 Q
"RTN","GMTSLRS7",20,0)
DISPLAY ; Displays up to 7 tests across page
"RTN","GMTSLRS7",21,0)
 N HDR,TST,GMI,GMX,GMW,IT,IX D INVRT S IT=""
"RTN","GMTSLRS7",22,0)
 F GMI=0:1:6 S IT=$O(^TMP("LRS",$J,IT)) Q:'IT  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",23,0)
 . S IX="" F  S IX=$O(^(IT,IX)) Q:IX'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",24,0)
 . . S TST=+$P(^(IX),U,3)
"RTN","GMTSLRS7",25,0)
 . . S HDR(GMI)=$S(TST'="":$E($P($G(^LAB(60,TST,.1)),U),1,7),1:"")
"RTN","GMTSLRS7",26,0)
 . . K ^TMP("LRS",$J,IT)
"RTN","GMTSLRS7",27,0)
 Q:$D(GMTSQIT)  D WRTHDR S IX=""
"RTN","GMTSLRS7",28,0)
 F GMW=1:1:MAX S IX=$O(^TMP("LRSR",$J,IX)) Q:+IX'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",29,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR
"RTN","GMTSLRS7",30,0)
 . S IT="" F GMI=0:1:6 S IT=$O(^TMP("LRSR",$J,IX,IT)) Q:IT=""  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",31,0)
 . . D WRT I '$O(^TMP("LRSR",$J,IX,IT)) W !
"RTN","GMTSLRS7",32,0)
 Q:$D(GMTSQIT)
"RTN","GMTSLRS7",33,0)
 I (+$G(GMW)=+$G(MAX)),(+IX>0),$O(^TMP("LRSR",$J,IX)) D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",34,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRS7",35,0)
 . W $C(7),!?10,"** Additional Results available outside occurrence limit **",!
"RTN","GMTSLRS7",36,0)
 Q
"RTN","GMTSLRS7",37,0)
WRTHDR ; Writes Column Header
"RTN","GMTSLRS7",38,0)
 N GMI D CKP^GMTSUP Q:$D(GMTSQIT)  W "Collection DT"
"RTN","GMTSLRS7",39,0)
 W ?19,$S(+$G(GMCMNT):" ",1:""),"Spec"
"RTN","GMTSLRS7",40,0)
 F GMI=0:1:6 D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",41,0)
 . D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))
"RTN","GMTSLRS7",42,0)
 . W ?(((8*GMI+25)+(7-$L(HDR(GMI))\2))),$E(HDR(GMI),1,7)
"RTN","GMTSLRS7",43,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSLRS7",44,0)
 Q
"RTN","GMTSLRS7",45,0)
WRT ; Writes the Lab Record
"RTN","GMTSLRS7",46,0)
 S GMX=^TMP("LRSR",$J,IX,IT),TAB=$P(GMX,U)
"RTN","GMTSLRS7",47,0)
 I GMI=0!(GMTSNPG) D
"RTN","GMTSLRS7",48,0)
 . I +$G(GMCMNT),$D(^TMP("LRS",$J,"C",IX))>0,$D(GMCOM("DT",IX))'>0,COMMNBR<26 D
"RTN","GMTSLRS7",49,0)
 . . S GMLTR=$C(97+COMMNBR) S COMMNBR=COMMNBR+1
"RTN","GMTSLRS7",50,0)
 . . S GMCOM("DT",IX)=GMLTR,GMCOM("LTR",GMLTR)=IX
"RTN","GMTSLRS7",51,0)
 . I +$G(GMCMNT) W $E($G(GMCOM("DT",IX)),1),?2,$P(GMX,U,2),?19,$E($P($P(GMX,U,3),";",2),1,5) Q
"RTN","GMTSLRS7",52,0)
 . W $P(GMX,U,2),?19,$E($P($P(GMX,U,3),";",2),1,5)
"RTN","GMTSLRS7",53,0)
 W ?(8*TAB+25),$P(GMX,U,4)," ",$P(GMX,U,5)
"RTN","GMTSLRS7",54,0)
 Q
"RTN","GMTSLRS7",55,0)
WRTCOMM ; Writes the lab Comments
"RTN","GMTSLRS7",56,0)
 N GMLTR,GMLINE
"RTN","GMTSLRS7",57,0)
 Q:$D(GMCOM)'>0
"RTN","GMTSLRS7",58,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "COMMENTS:",!
"RTN","GMTSLRS7",59,0)
 S GMLTR=""
"RTN","GMTSLRS7",60,0)
 F  S GMLTR=$O(GMCOM("LTR",GMLTR)) Q:GMLTR']""  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",61,0)
 . S IX=$G(GMCOM("LTR",GMLTR)),GMLINE=0
"RTN","GMTSLRS7",62,0)
 . F  S GMLINE=$O(^TMP("LRS",$J,"C",+IX,GMLINE)) Q:GMLINE'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRS7",63,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  I GMTSNPG W "COMMENTS:",!
"RTN","GMTSLRS7",64,0)
 . . W:GMLINE=1!GMTSNPG GMLTR_"."
"RTN","GMTSLRS7",65,0)
 . . W ?3,$G(^TMP("LRS",$J,"C",+IX,GMLINE)),!
"RTN","GMTSLRS7",66,0)
 Q
"RTN","GMTSLRS7",67,0)
 ;                   
"RTN","GMTSLRS7",68,0)
INVRT ; Inverts Global Array
"RTN","GMTSLRS7",69,0)
 ;                     
"RTN","GMTSLRS7",70,0)
 ; From: ^TMP("LRS",$J,IT,IX)=CDT^SPC^TNM^RSLT^FLAG^UNIT^LO^HI
"RTN","GMTSLRS7",71,0)
 ; To:   ^TMP("LRSR",$J,IX,IT)=GMI,CDT,SPC,RSLT,FLAG
"RTN","GMTSLRS7",72,0)
 ;
"RTN","GMTSLRS7",73,0)
 N GMI,GMW,IT,IX S IT=""
"RTN","GMTSLRS7",74,0)
 F GMI=0:1:6 S IT=$O(^TMP("LRS",$J,IT)) Q:IT'>0  S IX="" F  S IX=$O(^TMP("LRS",$J,IT,IX)) Q:IX=""  S ^TMP("LRSR",$J,IX,IT)=GMI_U_$P(^TMP("LRS",$J,IT,IX),U,1,2)_U_$P(^TMP("LRS",$J,IT,IX),U,4,5)
"RTN","GMTSLRS7",75,0)
 Q
"RTN","GMTSLRSC")
0^26^B11892340
"RTN","GMTSLRSC",1,0)
GMTSLRSC ; SLC/JER,KER - Sel Cum Lab Comp w/Sel Items ; 09/21/2001
"RTN","GMTSLRSC",2,0)
 ;;2.7;Health Summary;**28,47**;Oct 20, 1995
"RTN","GMTSLRSC",3,0)
 ;
"RTN","GMTSLRSC",4,0)
 ; External References
"RTN","GMTSLRSC",5,0)
 ;    DBIA 10035  ^DPT(
"RTN","GMTSLRSC",6,0)
 ;    DBIA    67  ^LAB(60
"RTN","GMTSLRSC",7,0)
 ;    DBIA   525  ^LR(
"RTN","GMTSLRSC",8,0)
 ;                           
"RTN","GMTSLRSC",9,0)
MAIN ; Selected Cumulative Lab w/Selection Items
"RTN","GMTSLRSC",10,0)
 N GMTSI,LRDFN,MAX,TEST,RWIDTH,GMCMNT,COMMNBR,GMCOM,TAB
"RTN","GMTSLRSC",11,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999) Q:'$D(^DPT(DFN,"LR"))
"RTN","GMTSLRSC",12,0)
 Q:'$D(^DPT(DFN,"LR"))  S LRDFN=+^DPT(DFN,"LR") Q:'$D(^LR(LRDFN))  Q:'$O(GMTSEG(GMTSEGN,60,0))
"RTN","GMTSLRSC",13,0)
 S RWIDTH=4,GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,60,GMTSI)) Q:GMTSI'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRSC",14,0)
 . S TEST=GMTSEG(GMTSEGN,60,GMTSI) D ^GMTSLRSE
"RTN","GMTSLRSC",15,0)
 Q:'$D(^TMP("LRS",$J))  S GMCMNT=$S($P($G(^GMT(142.99,1,0)),U,3)="Y":1,1:0),COMMNBR=0
"RTN","GMTSLRSC",16,0)
 F  D DISPLAY Q:$O(^TMP("LRS",$J,0))'>0  Q:$D(GMTSQIT)
"RTN","GMTSLRSC",17,0)
 I GMCMNT,'$D(GMTSQIT) D WRTCOMM
"RTN","GMTSLRSC",18,0)
 K ^TMP("LRS",$J),^TMP("LRSR",$J)
"RTN","GMTSLRSC",19,0)
 Q
"RTN","GMTSLRSC",20,0)
DISPLAY ; Displays up to 7 tests across page
"RTN","GMTSLRSC",21,0)
 N GMC,GMN,GMI,GMW,GMX,HDR,TST,IT,IX,MORE,RES
"RTN","GMTSLRSC",22,0)
 D INVRT Q:$D(GMTSQIT)  S IT="" F GMI=0:1:6 S IT=$O(^TMP("LRS",$J,IT)) Q:'IT  D
"RTN","GMTSLRSC",23,0)
 . S IX="" F  S IX=$O(^(IT,IX)) Q:IX'>0  D
"RTN","GMTSLRSC",24,0)
 . . S TST=+$P(^(IX),U,3),HDR(GMI)=$S(TST'="":$E($P($G(^LAB(60,TST,.1)),U),1,7),1:"")
"RTN","GMTSLRSC",25,0)
 . . K ^TMP("LRS",$J,IT)
"RTN","GMTSLRSC",26,0)
 D WRTHDR S RES=$$RES,MORE=$S(+($G(RES))>+($G(MAX)):1,1:0)
"RTN","GMTSLRSC",27,0)
 S IX="" F GMW=1:1:MAX S IX=$O(^TMP("LRSR",$J,IX)) Q:+IX'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRSC",28,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR
"RTN","GMTSLRSC",29,0)
 . S IT="" F GMI=0:1 S IT=$O(^TMP("LRSR",$J,IX,IT)) Q:IT=""  D  Q:$D(GMTSQIT)
"RTN","GMTSLRSC",30,0)
 . . D WRT I '$O(^TMP("LRSR",$J,IX,IT)) W !
"RTN","GMTSLRSC",31,0)
 I +($G(MORE)) D
"RTN","GMTSLRSC",32,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT) 
"RTN","GMTSLRSC",33,0)
 . W $C(7),!?10,"** Additional Results available outside occurrence limit **",!
"RTN","GMTSLRSC",34,0)
 K ^TMP("LRSR",$J) W:$D(^TMP("LRS",$J)) !
"RTN","GMTSLRSC",35,0)
 Q
"RTN","GMTSLRSC",36,0)
WRTHDR ; Writes Column Header
"RTN","GMTSLRSC",37,0)
 N GMI
"RTN","GMTSLRSC",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Collection DT"
"RTN","GMTSLRSC",39,0)
 W ?19,$S(+$G(GMCMNT):" ",1:""),"Spec"
"RTN","GMTSLRSC",40,0)
 F GMI=0:1:6 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  W ?(((8*GMI+25)+(7-$L(HDR(GMI))\2))),$E(HDR(GMI),1,7)
"RTN","GMTSLRSC",41,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSLRSC",42,0)
 Q
"RTN","GMTSLRSC",43,0)
WRT ; Writes the Lab Record
"RTN","GMTSLRSC",44,0)
 S GMX=^TMP("LRSR",$J,IX,IT),TAB=$P(GMX,U)
"RTN","GMTSLRSC",45,0)
 I GMI=0!(GMTSNPG) D
"RTN","GMTSLRSC",46,0)
 . I +$G(GMCMNT),$D(^TMP("LRS",$J,"C",IX))>0,$D(GMCOM("DT",IX))'>0,COMMNBR<26 D
"RTN","GMTSLRSC",47,0)
 . . S GMLTR=$C(97+COMMNBR) S COMMNBR=COMMNBR+1
"RTN","GMTSLRSC",48,0)
 . . S GMCOM("DT",IX)=GMLTR,GMCOM("LTR",GMLTR)=IX
"RTN","GMTSLRSC",49,0)
 . I +$G(GMCMNT) D  Q
"RTN","GMTSLRSC",50,0)
 . . W $E($G(GMCOM("DT",IX)),1),?2,$P(GMX,U,2),?19,$E($P($P(GMX,U,3),";",2),1,5)
"RTN","GMTSLRSC",51,0)
 . W $P(GMX,U,2),?19,$E($P($P(GMX,U,3),";",2),1,5)
"RTN","GMTSLRSC",52,0)
 W ?(8*TAB+25),$P(GMX,U,4)," ",$P(GMX,U,5)
"RTN","GMTSLRSC",53,0)
 Q
"RTN","GMTSLRSC",54,0)
WRTCOMM ; Writes the lab Comments
"RTN","GMTSLRSC",55,0)
 N GMLTR,GMLINE
"RTN","GMTSLRSC",56,0)
 Q:$D(GMCOM)'>0
"RTN","GMTSLRSC",57,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "COMMENTS:",!
"RTN","GMTSLRSC",58,0)
 S GMLTR=""
"RTN","GMTSLRSC",59,0)
 F  S GMLTR=$O(GMCOM("LTR",GMLTR)) Q:GMLTR']""  D  Q:$D(GMTSQIT)
"RTN","GMTSLRSC",60,0)
 . S IX=$G(GMCOM("LTR",GMLTR)),GMLINE=0
"RTN","GMTSLRSC",61,0)
 . F  S GMLINE=$O(^TMP("LRS",$J,"C",+IX,GMLINE)) Q:GMLINE'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSLRSC",62,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  I GMTSNPG W "COMMENTS:",!
"RTN","GMTSLRSC",63,0)
 . . W:GMLINE=1!GMTSNPG GMLTR_"."
"RTN","GMTSLRSC",64,0)
 . . W ?3,$G(^TMP("LRS",$J,"C",+IX,GMLINE)),!
"RTN","GMTSLRSC",65,0)
 Q
"RTN","GMTSLRSC",66,0)
 ;                     
"RTN","GMTSLRSC",67,0)
RES(X) ; Results
"RTN","GMTSLRSC",68,0)
 N NN,NC S X=0,NN="^TMP(""LRSR"","_$J_")",NC="^TMP(""LRSR"","_$J_","
"RTN","GMTSLRSC",69,0)
 F  S NN=$Q(@NN) Q:NN=""!(NN'[NC)  S X=X+1
"RTN","GMTSLRSC",70,0)
 Q X
"RTN","GMTSLRSC",71,0)
INVRT ; Inverts Global Array
"RTN","GMTSLRSC",72,0)
 ;                     
"RTN","GMTSLRSC",73,0)
 ;  From: ^TMP("LRS",$J,IT,IX)=CDT^SPC^TNM^RSLT^FLAG^UNIT^LO^HI
"RTN","GMTSLRSC",74,0)
 ;  To:   ^TMP("LRSR",$J,IX,IT)=GMI,CDT,SPC,RSLT,FLAG
"RTN","GMTSLRSC",75,0)
 ;
"RTN","GMTSLRSC",76,0)
 N GMI,IT,IX
"RTN","GMTSLRSC",77,0)
 S IT=""
"RTN","GMTSLRSC",78,0)
 F GMI=0:1:6 S IT=$O(^TMP("LRS",$J,IT)) Q:IT'>0  D
"RTN","GMTSLRSC",79,0)
 . S IX="" F  S IX=$O(^TMP("LRS",$J,IT,IX)) Q:IX=""  D
"RTN","GMTSLRSC",80,0)
 . . S ^TMP("LRSR",$J,IX,IT)=GMI_U_$P(^TMP("LRS",$J,IT,IX),U,1,2)_U_$P(^TMP("LRS",$J,IT,IX),U,4,5)
"RTN","GMTSLRSC",81,0)
 Q
"RTN","GMTSLRSE")
0^27^B7379227
"RTN","GMTSLRSE",1,0)
GMTSLRSE ; SLC/JER,KER - Selected Lab Test Extract ; 09/21/2001
"RTN","GMTSLRSE",2,0)
 ;;2.7;Health Summary;**28,36,47**;Oct 20, 1995
"RTN","GMTSLRSE",3,0)
 ;
"RTN","GMTSLRSE",4,0)
 ; External References
"RTN","GMTSLRSE",5,0)
 ;    DBIA    67   ^LAB(60
"RTN","GMTSLRSE",6,0)
 ;    DBIA   524   ^LAB(61
"RTN","GMTSLRSE",7,0)
 ;    DBIA   525   ^LR( 
"RTN","GMTSLRSE",8,0)
 ;                         
"RTN","GMTSLRSE",9,0)
XTRCT ; Extract Selected Lab Test
"RTN","GMTSLRSE",10,0)
 ;                 
"RTN","GMTSLRSE",11,0)
 ; Call with    LRDFN    lab patient
"RTN","GMTSLRSE",12,0)
 ;              GMTS1    begin date
"RTN","GMTSLRSE",13,0)
 ;              GMTS2    end date
"RTN","GMTSLRSE",14,0)
 ;              MAX      occurence limit
"RTN","GMTSLRSE",15,0)
 ;              SEX      "M" or "F"
"RTN","GMTSLRSE",16,0)
 ;              TEST     IFN to ^LAB(60)
"RTN","GMTSLRSE",17,0)
 ;              RWIDTH   optional
"RTN","GMTSLRSE",18,0)
 ;                     
"RTN","GMTSLRSE",19,0)
 ; Returns      ^TMP("LRS",$J,GMTSI,IDRWDT)=
"RTN","GMTSLRSE",20,0)
 ;              DRWDT^SPEC^TEST^RESULT^FLAG^UNIT^LO^HI
"RTN","GMTSLRSE",21,0)
 ;                     
"RTN","GMTSLRSE",22,0)
 ; Where        GMTSI=Order (1 to MAX)
"RTN","GMTSLRSE",23,0)
 ;              IDRWDT=9999999-Draw Date/time
"RTN","GMTSLRSE",24,0)
 ;              DRWDT=Draw Date/Time (internal)
"RTN","GMTSLRSE",25,0)
 ;              SPEC=Specimen (int;ext)
"RTN","GMTSLRSE",26,0)
 ;              TEST=Test (int;ext)
"RTN","GMTSLRSE",27,0)
 ;              RESULT=Numeric Result
"RTN","GMTSLRSE",28,0)
 ;              FLAG=Reference flag (H,*H,L,*L)
"RTN","GMTSLRSE",29,0)
 ;              UNIT=Unit of measure (ext)
"RTN","GMTSLRSE",30,0)
 ;              LO=Reference/Therapeutic Lower bound
"RTN","GMTSLRSE",31,0)
 ;              HI=Ref/Ther Upper Bound
"RTN","GMTSLRSE",32,0)
 ;                       
"RTN","GMTSLRSE",33,0)
 N CNT,AGE,COM,GMI,X K ^TMP("LRS",$J,GMTSI) I $S("BO"'[$P(^LAB(60,TEST,0),U,3):1,1:0) Q
"RTN","GMTSLRSE",34,0)
 D DEM^GMTSU S AGE=GMTSAGE S CNT=0 D CHEM:$P(^LAB(60,TEST,0),U,4)="CH"
"RTN","GMTSLRSE",35,0)
 Q
"RTN","GMTSLRSE",36,0)
CHEM ; Gets all Chemistry tests w/in time/occurrence constraints
"RTN","GMTSLRSE",37,0)
 N PTR,IDRWDT S PTR=+$P($P(^LAB(60,+TEST,0),U,5),";",2),IDRWDT=GMTS1
"RTN","GMTSLRSE",38,0)
 F  S IDRWDT=$O(^LR(LRDFN,"CH",IDRWDT)) Q:'IDRWDT!(IDRWDT>GMTS2)!(CNT'<MAX)  I $P(^(IDRWDT,0),U,3),($D(^(PTR))) S CNT=CNT+1 D:CNT'>MAX CHSET
"RTN","GMTSLRSE",39,0)
 Q
"RTN","GMTSLRSE",40,0)
CHSET ; Sets Chemistry locals for printing
"RTN","GMTSLRSE",41,0)
 N RESULT,FLAG,DRWDT,SITE,SPEC,TNM,DESCR,THER,UNIT,HI,LO,GMIDT
"RTN","GMTSLRSE",42,0)
 S RESULT=$P(^LR(LRDFN,"CH",IDRWDT,PTR),U),FLAG=$P(^(PTR),U,2),DRWDT=9999999-IDRWDT
"RTN","GMTSLRSE",43,0)
 S RESULT=$$RESULT^GMTSLRCE(TEST,RESULT,$G(RWIDTH))
"RTN","GMTSLRSE",44,0)
 S X=DRWDT D REGDTM4^GMTSU S DRWDT=X K X
"RTN","GMTSLRSE",45,0)
 S SITE=$P(^LR(LRDFN,"CH",IDRWDT,0),U,5),SPEC=SITE_";"_$P(^LAB(61,SITE,0),U)
"RTN","GMTSLRSE",46,0)
 S TNM=TEST_";"_$S($L($P(^LAB(60,TEST,0),U))<21:$P(^(0),U),1:$P(^(.1),U))
"RTN","GMTSLRSE",47,0)
 S DESCR=$S($D(^LAB(60,TEST,1,SITE,0)):^(0),1:""),THER=$S($L($P(DESCR,U,11,12))>1:1,1:0)
"RTN","GMTSLRSE",48,0)
 S UNIT=$P(DESCR,U,7),LO=$S(THER:$P(DESCR,U,11),1:$P(DESCR,U,2)),HI=$S(THER:$P(DESCR,U,12),1:$P(DESCR,U,3))
"RTN","GMTSLRSE",49,0)
 S @("LO="_$S($L(LO):LO,1:"""""")),@("HI="_$S($L(HI):HI,1:""""""))
"RTN","GMTSLRSE",50,0)
 I $D(^TMP("LRS",$J,GMTSI,IDRWDT)) S GMIDT=IDRWDT+.0001
"RTN","GMTSLRSE",51,0)
 S GMIDT=IDRWDT
"RTN","GMTSLRSE",52,0)
 S ^TMP("LRS",$J,GMTSI,GMIDT)=DRWDT_U_$E(SPEC,1,10)_U_TNM_U_RESULT_U_FLAG_U_UNIT_U_LO_U_HI
"RTN","GMTSLRSE",53,0)
 I $D(^LR(LRDFN,"CH",IDRWDT,1,0)) D
"RTN","GMTSLRSE",54,0)
 . S COM=0
"RTN","GMTSLRSE",55,0)
 . F GMI=1:1 S COM=$O(^LR(LRDFN,"CH",IDRWDT,1,COM)) Q:+COM'>0  S ^TMP("LRS",$J,"C",GMIDT,GMI)=^LR(LRDFN,"CH",IDRWDT,1,COM,0)
"RTN","GMTSLRSE",56,0)
 Q
"RTN","GMTSLRT")
0^53^B4287822
"RTN","GMTSLRT",1,0)
GMTSLRT ; SLC/JER,KER - Blood Bank Transfusion       ; 09/21/2001
"RTN","GMTSLRT",2,0)
 ;;2.7;Health Summary;**28,47**;Oct 20, 1995
"RTN","GMTSLRT",3,0)
 ;                   
"RTN","GMTSLRT",4,0)
 ; External References
"RTN","GMTSLRT",5,0)
 ;   DBIA    525  ^LR( all fields
"RTN","GMTSLRT",6,0)
 ;   DBIA   2056  $$GET1^DIQ (file 2)
"RTN","GMTSLRT",7,0)
 ;   DBIA   3176  TRAN^VBECA4
"RTN","GMTSLRT",8,0)
 ;                   
"RTN","GMTSLRT",9,0)
MAIN ; Blood Transfusion
"RTN","GMTSLRT",10,0)
 N GMA,GMI,GMR,IX,MAX,A,R,TD,BPN,LOC
"RTN","GMTSLRT",11,0)
 S LOC="LRT",LRDFN=$$GET1^DIQ(2,+($G(DFN)),63,"I")
"RTN","GMTSLRT",12,0)
 ;                    
"RTN","GMTSLRT",13,0)
 ; Get Transfusion Records
"RTN","GMTSLRT",14,0)
 ;   Blood Bank Package  TRANS^VBECA4
"RTN","GMTSLRT",15,0)
 ;   Lab Package         ^GMTSLRTE
"RTN","GMTSLRT",16,0)
 ;                    
"RTN","GMTSLRT",17,0)
 ; The next two lines support new Blood Bank Package VBEC
"RTN","GMTSLRT",18,0)
 ;    D:+($$ROK^GMTSU("VBECA4"))>0 TRAN^VBECA4(DFN,LOC,GMTS1,GMTS2)
"RTN","GMTSLRT",19,0)
 ;    D:+($$ROK^GMTSU("VBECA4"))'>0 ^GMTSLRTE
"RTN","GMTSLRT",20,0)
 ;                 
"RTN","GMTSLRT",21,0)
 ; And should replace D ^GMTSLRTE
"RTN","GMTSLRT",22,0)
 D ^GMTSLRTE
"RTN","GMTSLRT",23,0)
 ;                      
"RTN","GMTSLRT",24,0)
 Q:'$D(^TMP("LRT",$J))
"RTN","GMTSLRT",25,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:999),IX=GMTS1
"RTN","GMTSLRT",26,0)
 F GMI=1:1:MAX S IX=$O(^TMP("LRT",$J,IX)) Q:IX=""!(IX>GMTS2)  D
"RTN","GMTSLRT",27,0)
 . S GMR=^TMP("LRT",$J,IX) D PRSREC,WRT
"RTN","GMTSLRT",28,0)
 I $O(^TMP("LRT",$J,"A"))'="" D
"RTN","GMTSLRT",29,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSLRT",30,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W " Blood Product Key: "
"RTN","GMTSLRT",31,0)
 S GMI="A" F  S GMI=$O(^TMP("LRT",$J,GMI)) Q:GMI=""  D
"RTN","GMTSLRT",32,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRT",33,0)
 . W ?21,GMI," = ",$G(^TMP("LRT",$J,GMI)),!
"RTN","GMTSLRT",34,0)
 K ^TMP("LRT",$J)
"RTN","GMTSLRT",35,0)
 Q
"RTN","GMTSLRT",36,0)
PRSREC ; Parses Record for presentation
"RTN","GMTSLRT",37,0)
 N GMI,X S X=$P(GMR,U) D REGDT4^GMTSU S TD=X
"RTN","GMTSLRT",38,0)
 S GMA(1)=$P(GMR,U,2),BPN=$L(GMA(1),";")
"RTN","GMTSLRT",39,0)
 I $P(GMA(1),";",BPN)="" S BPN=BPN-1
"RTN","GMTSLRT",40,0)
 F GMI=2:1:BPN S GMA(GMI)="("_$P($P(GMA(1),";",GMI),"\")_") "_$P($P(GMA(1),";",GMI),"\",2)
"RTN","GMTSLRT",41,0)
 S GMA(1)="("_$P($P(GMA(1),";",1),"\")_") "_$P($P(GMA(1),";",1),"\",2)
"RTN","GMTSLRT",42,0)
 Q
"RTN","GMTSLRT",43,0)
WRT ; Writes the Transfusion Record for each day
"RTN","GMTSLRT",44,0)
 N GML,GMI1,GMI2,GMM,GMJ S GMM=$S(BPN#4:1,1:0),GML=BPN\4+GMM
"RTN","GMTSLRT",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W TD
"RTN","GMTSLRT",46,0)
 F GMI1=1:1:GML D  Q:$D(GMTSQIT)
"RTN","GMTSLRT",47,0)
 . F GMI2=1:1:($S((GMI1=GML)&(BPN#4):BPN#4,1:4)) D  Q:$D(GMTSQIT)
"RTN","GMTSLRT",48,0)
 . . S GMJ=((GMI1-1)*4)+GMI2 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSLRT",49,0)
 . . W ?(((GMI2-1)*15)+10),GMA(GMJ)
"RTN","GMTSLRT",50,0)
 . . I $S(GMI2#4=0:1,GMI2=BPN:1,GMI2+(4*(GMI1-1))=BPN:1,1:0) W !
"RTN","GMTSLRT",51,0)
 Q
"RTN","GMTSMCMA")
0^35^B26406266
"RTN","GMTSMCMA",1,0)
GMTSMCMA ;WISC/DCB - Medicine 2.2 interface routine ; 09/21/2001
"RTN","GMTSMCMA",2,0)
 ;;2.7;Health Summary;**4,47**;Oct 20, 1995
"RTN","GMTSMCMA",3,0)
 ;                   
"RTN","GMTSMCMA",4,0)
 ; External Refernces
"RTN","GMTSMCMA",5,0)
 ;    DBIA 10064  KILL^XM
"RTN","GMTSMCMA",6,0)
 ;    DBIA 10070  ^XMD
"RTN","GMTSMCMA",7,0)
 ;    DBIA  1236  $$HL7^MCORMN
"RTN","GMTSMCMA",8,0)
 ;    DBIA 10090  ^DIC(4,
"RTN","GMTSMCMA",9,0)
 ;    DBIA 10000  NOW^%DTC
"RTN","GMTSMCMA",10,0)
 ;    DBIA 10106  $$HLDATE^HLFNC
"RTN","GMTSMCMA",11,0)
 ;    DBIA 10106  $$HLNAME^HLFNC
"RTN","GMTSMCMA",12,0)
 ;    DBIA 10017  ^DD("DD")
"RTN","GMTSMCMA",13,0)
 ;    DBIA 10106  $$FMDATE^HLFNC
"RTN","GMTSMCMA",14,0)
 ;    DBIA 10106  $$FMNAME^HLFNC
"RTN","GMTSMCMA",15,0)
 ;    DBIA 10072  REMSBMSG^XMA1C
"RTN","GMTSMCMA",16,0)
 ;                  
"RTN","GMTSMCMA",17,0)
HSUM(PATID,BDATE,EDATE,OCC,WH,ATYPE) ; Health Summary API
"RTN","GMTSMCMA",18,0)
 N ARRAY,MESSAGE,MSH,HLECH,ST,ORD,MSTR,LOOP,MSTR,SAP,SNF,RAP,RNF,MST,PCI,VID
"RTN","GMTSMCMA",19,0)
 N REC,LOC,QID,XDEST,WSF,MWDDC,WDC,QRL,BUILDER,LOOP,MESS1,MESS2,TMP,SUB
"RTN","GMTSMCMA",20,0)
 N XMDUZ,XMTEXT,XMSUB,XMY,XMZ,XMDUN
"RTN","GMTSMCMA",21,0)
 S ARRAY="TMP(""HS"",$J)"
"RTN","GMTSMCMA",22,0)
 S XMTEXT="TMP(""HS"",$J,"
"RTN","GMTSMCMA",23,0)
 S MSTR="|^~\&",HLECH=$E(MSTR,2,4)
"RTN","GMTSMCMA",24,0)
 F LOOP=1:1:5 S ST(LOOP)=$E(MSTR,LOOP,LOOP)
"RTN","GMTSMCMA",25,0)
 S MESSAGE="TMP",SAP="HEALTH SUMMARY",RAP="MEDICINE",VID=2.1
"RTN","GMTSMCMA",26,0)
 S REC=+$O(^DIC(4,"D",DUZ(2),"")),LOC=$P($G(^DIC(4,REC,0)),U,1)
"RTN","GMTSMCMA",27,0)
 S (RNF,SNF)=LOC,RAP="Medicine",SAP="Health Summary",MST="HS",PCI="P"
"RTN","GMTSMCMA",28,0)
 S @ARRAY@(1,0)=$$MSH(MSTR,SAP,SNF,RAP,RNF,MST,PCI,VID)
"RTN","GMTSMCMA",29,0)
 S ATYPE=$S(ATYPE="F":"RD",ATYPE="C":"RD",1:"PG")
"RTN","GMTSMCMA",30,0)
 S QRL=$$CONVERT("D",BDATE)_ST(2)_$$CONVERT("D",EDATE)
"RTN","GMTSMCMA",31,0)
 S QFC="R",QLR=ATYPE_ST(2)_OCC,WSF=PATID,WDDC=WH
"RTN","GMTSMCMA",32,0)
 S @ARRAY@(2,0)=$$QRD(WSF,WDDC,QFC,QLR,QRL)
"RTN","GMTSMCMA",33,0)
 S XMSUB="Health Summary Request",XMDUN="HEALTH SUMMARY"
"RTN","GMTSMCMA",34,0)
 S XMY("G.MC MESSAGING SERVER")=""
"RTN","GMTSMCMA",35,0)
 S XMDUZ=".5" ;Needs to be set so dots aren't displayed
"RTN","GMTSMCMA",36,0)
 D ^XMD I +($G(XMZ))=0 D KILL^XM Q
"RTN","GMTSMCMA",37,0)
 S MESS1=XMZ
"RTN","GMTSMCMA",38,0)
 D KILL^XM
"RTN","GMTSMCMA",39,0)
 S ARRY=$$HL7^MCORMN(MESS1) Q:+ARRY=0
"RTN","GMTSMCMA",40,0)
 K ^TMP("MCAR",$J)
"RTN","GMTSMCMA",41,0)
 D SLIT(ARRY)
"RTN","GMTSMCMA",42,0)
 D REMOVE(MESS1,ARRY)
"RTN","GMTSMCMA",43,0)
 Q
"RTN","GMTSMCMA",44,0)
SLIT(ARRY) ; Reformat Array
"RTN","GMTSMCMA",45,0)
 N LOOP,COUNT,BASE,MCOUNT,BUILDER
"RTN","GMTSMCMA",46,0)
 S BUILDER="^XMB(3.9,"_ARRY_",2)"
"RTN","GMTSMCMA",47,0)
 S LOOP=0,(MCOUNT,COUNT)=0,SUB=1,BASE="^TMP(""MCAR"",$J)"
"RTN","GMTSMCMA",48,0)
 F  S LOOP=$O(@BUILDER@(LOOP)) Q:LOOP=""  D SLITTER
"RTN","GMTSMCMA",49,0)
 Q
"RTN","GMTSMCMA",50,0)
SLITTER ; This will slit the message in a usable form
"RTN","GMTSMCMA",51,0)
 N VALUE,ROY,ROUT,LINE
"RTN","GMTSMCMA",52,0)
 S VALUE=@BUILDER@(LOOP,0),ROY=$E(VALUE,1,3)
"RTN","GMTSMCMA",53,0)
 S ROUT=$S(ROY="MSH":"SMSH",ROY="PID":"SPID",ROY="OBR":"SOBR",ROY="OBX":"SOBX",ROY="MSH":"SMSH",1:"OTHER")
"RTN","GMTSMCMA",54,0)
 ;S LINE="D "_ROUT_"("""_VALUE_""")"
"RTN","GMTSMCMA",55,0)
 S LINE="D "_ROUT_"(VALUE)"
"RTN","GMTSMCMA",56,0)
 X LINE
"RTN","GMTSMCMA",57,0)
 Q
"RTN","GMTSMCMA",58,0)
SMSH(VALUE) ; Slit the message header
"RTN","GMTSMCMA",59,0)
 N PROC,LOOP
"RTN","GMTSMCMA",60,0)
 S MSTR=$E(VALUE,4,8),SUB=1
"RTN","GMTSMCMA",61,0)
 F LOOP=1:1:5 S ST(LOOP)=$E(MSTR,LOOP,LOOP)
"RTN","GMTSMCMA",62,0)
 S MCOUNT=MCOUNT+1,COUNT=1
"RTN","GMTSMCMA",63,0)
 S PROC=$P($P(VALUE,ST(1),3),U,1)
"RTN","GMTSMCMA",64,0)
 S @BASE@(MCOUNT,COUNT,1)="PROCEDURE"_U_U_PROC
"RTN","GMTSMCMA",65,0)
 D SETREF(MCOUNT,COUNT,"PROCEDURE")
"RTN","GMTSMCMA",66,0)
 Q
"RTN","GMTSMCMA",67,0)
SPID(VALUE) ; Slit the PID
"RTN","GMTSMCMA",68,0)
 S SUB=1
"RTN","GMTSMCMA",69,0)
 Q
"RTN","GMTSMCMA",70,0)
SOBR(VALUE) ; Slit the OBR
"RTN","GMTSMCMA",71,0)
 N TEMP,XDATE
"RTN","GMTSMCMA",72,0)
 S TEMP=$$CONVERTA("D",$P(VALUE,ST(1),8))
"RTN","GMTSMCMA",73,0)
 S XDATE=TEMP,COUNT=COUNT+1,SUB=1
"RTN","GMTSMCMA",74,0)
 S @BASE@(MCOUNT,COUNT,1)="DATE/TIME"_U_U_TEMP
"RTN","GMTSMCMA",75,0)
 D SETREF(MCOUNT,COUNT,"DATE/TIME")
"RTN","GMTSMCMA",76,0)
 S TEMP=$$CONVERTA("P200",$P(VALUE,ST(1),33))
"RTN","GMTSMCMA",77,0)
 I TEMP'="" S COUNT=COUNT+1,@BASE@(MCOUNT,COUNT,1)="PRINCIPAL RESUILT INTERPRETER"_U_U_TEMP D SETREF(MCOUNT,COUNT,"PRINCIPAL RESULT INTERPRETER") S COUNT=COUNT+1
"RTN","GMTSMCMA",78,0)
 S TEMP=$$CONVERTA("P200",$P(VALUE,ST(1),34))
"RTN","GMTSMCMA",79,0)
 I TEMP'="" S COUNT=COUNT+1,@BASE@(MCOUNT,COUNT,1)="ASSISTANT RESUILT INTERPRETER"_U_U_TEMP  D SETREF(MCOUNT,COUNT,"ASSISTANT RESULT") S COUNT=COUNT+1
"RTN","GMTSMCMA",80,0)
 S TEMP=$$CONVERTA("P200",$P(VALUE,ST(1),35))
"RTN","GMTSMCMA",81,0)
 I TEMP'="" S COUNT=COUNT+1,@BASE@(MCOUNT,COUNT,1)="TECHNICIAN"_U_U_TEMP  D SETREF(MCOUNT,COUNT,"TECHNICIAN") S COUNT=COUNT+1
"RTN","GMTSMCMA",82,0)
 Q
"RTN","GMTSMCMA",83,0)
SOBX(VALUE) ; Slit the OBX
"RTN","GMTSMCMA",84,0)
 N XDES,TEMP,FLDTYPE,UNITS,VAL
"RTN","GMTSMCMA",85,0)
 S COUNT=COUNT+1
"RTN","GMTSMCMA",86,0)
 S SUB=1,TEMP=$P(VALUE,ST(1),4),XDES=$P(TEMP,ST(2),2)
"RTN","GMTSMCMA",87,0)
 S TEMP=$P(TEMP,ST(2),1),FLDTYPE=$P(TEMP,ST(3),3)
"RTN","GMTSMCMA",88,0)
 S:FLDTYPE=+FLDTYPE XDES=XDES_";W"
"RTN","GMTSMCMA",89,0)
 S VAL=$$CONVERTA(FLDTYPE,$P(VALUE,ST(1),6))
"RTN","GMTSMCMA",90,0)
 S UNITS=$P(TEMP,ST(1),7)
"RTN","GMTSMCMA",91,0)
 S @BASE@(MCOUNT,COUNT,1)=XDES_U_UNITS_U_VAL
"RTN","GMTSMCMA",92,0)
 D SETREF(MCOUNT,COUNT,XDES)
"RTN","GMTSMCMA",93,0)
 Q
"RTN","GMTSMCMA",94,0)
OTHER(VALUE) ; Set the next sub node if the lines continue
"RTN","GMTSMCMA",95,0)
 N TEMP,UNITS
"RTN","GMTSMCMA",96,0)
 S TEMP=$P(VALUE,ST(1),1),UNITS=$P(VALUE,ST(1),2),SUB=SUB+1
"RTN","GMTSMCMA",97,0)
 S @BASE@(MCOUNT,COUNT,SUB)=U_U_TEMP
"RTN","GMTSMCMA",98,0)
 S:UNITS'="" $P(@BASE@(MCOUNT,COUNT,1),U,2)=UNITS
"RTN","GMTSMCMA",99,0)
 Q
"RTN","GMTSMCMA",100,0)
MSH(MSTR,SAP,SNF,RAP,RNF,MST,PCI,VID) ; MSH Messaging Line
"RTN","GMTSMCMA",101,0)
 N MSH,Y,%,%I
"RTN","GMTSMCMA",102,0)
 S MSH="MSH"_MSTR,$P(MSH,ST(1),3)=SAP,$P(MSH,ST(1),4)=SNF
"RTN","GMTSMCMA",103,0)
 D NOW^%DTC S $P(MSH,ST(1),8)=$$CONVERT("D",%)
"RTN","GMTSMCMA",104,0)
 S $P(MSH,ST(1),5)=RAP,$P(MSH,ST(1),6)=RNF,$P(MSH,ST(1),9)=MST
"RTN","GMTSMCMA",105,0)
 S $P(MSH,ST(1),10)=PCI,$P(MSH,ST(1),11)=VID
"RTN","GMTSMCMA",106,0)
 Q MSH
"RTN","GMTSMCMA",107,0)
QRD(WSF,WDDC,QFC,QLR,QRL) ; QRD Messaging Line
"RTN","GMTSMCMA",108,0)
 N QRD,Y,%,%I
"RTN","GMTSMCMA",109,0)
 S QRD="QRD"
"RTN","GMTSMCMA",110,0)
 D NOW^%DTC S $P(ORD,ST(1),2)=$$CONVERT("D",%)
"RTN","GMTSMCMA",111,0)
 S $P(QRD,ST(1),3)=QFC,$P(QRD,ST(1),4)="I"
"RTN","GMTSMCMA",112,0)
 S $P(QRD,ST(1),6)=$J,$P(QRD,ST(1),8)=QLR
"RTN","GMTSMCMA",113,0)
 S $P(QRD,ST(1),9)=WSF,$P(QRD,ST(1),11)=WDDC,$P(QRD,ST(1),12)=QRL
"RTN","GMTSMCMA",114,0)
 Q QRD
"RTN","GMTSMCMA",115,0)
CONVERT(FILETYPE,RST) ; Convert FileMan to HL7
"RTN","GMTSMCMA",116,0)
 N TEMP
"RTN","GMTSMCMA",117,0)
 S TEMP=RST
"RTN","GMTSMCMA",118,0)
 S:FILETYPE="D" TEMP=$$HLDATE^HLFNC(RST,"TS")
"RTN","GMTSMCMA",119,0)
 S:FILETYPE="P" TEMP=$$HLNAME^HLFNC(RST)
"RTN","GMTSMCMA",120,0)
 Q TEMP
"RTN","GMTSMCMA",121,0)
CONVERTA(FILETYPE,RST) ; Convert HL7 to FileMan
"RTN","GMTSMCMA",122,0)
 N TEMP,Y
"RTN","GMTSMCMA",123,0)
 S TEMP=RST
"RTN","GMTSMCMA",124,0)
 I FILETYPE["D" S Y=$$FMDATE^HLFNC(RST) X ^DD("DD") S TEMP=Y
"RTN","GMTSMCMA",125,0)
 S:(FILETYPE["P200")!(FILETYPE["P690") TEMP=$$FMNAME^HLFNC(RST)
"RTN","GMTSMCMA",126,0)
 Q TEMP
"RTN","GMTSMCMA",127,0)
REMOVE(MESS1,MESS2) ; Remove messages from the server basket
"RTN","GMTSMCMA",128,0)
 N LOOP,XMSER
"RTN","GMTSMCMA",129,0)
 F LOOP=MESS1,MESS2 S XMSER="S.MCHL7SERVER" S XMZ=LOOP D:LOOP'=0 REMSBMSG^XMA1C
"RTN","GMTSMCMA",130,0)
 D KILL^XM
"RTN","GMTSMCMA",131,0)
 Q
"RTN","GMTSMCMA",132,0)
SETREF(MCOUNT,COUNT,XDES) ; Set Count
"RTN","GMTSMCMA",133,0)
 S:XDES'="" @BASE@(MCOUNT,"B",XDES,COUNT)=""
"RTN","GMTSMCMA",134,0)
 Q
"RTN","GMTSORC")
0^45^B2015928
"RTN","GMTSORC",1,0)
GMTSORC ; SLC/JER,KER - Current Orders (V2.5) ; 09/21/2001
"RTN","GMTSORC",2,0)
 ;;2.7;Health Summary;**15,28,47**;Oct 20, 1995
"RTN","GMTSORC",3,0)
 ;                 
"RTN","GMTSORC",4,0)
 ; External References
"RTN","GMTSORC",5,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSORC",6,0)
 ;                 
"RTN","GMTSORC",7,0)
MAIN ; Controls branching and execution
"RTN","GMTSORC",8,0)
 I $$VERSION^XPDUTL("OR")'<3 G MAIN^GMTSORC3
"RTN","GMTSORC",9,0)
 Q
"RTN","GMTSORC",10,0)
 ;                 
"RTN","GMTSORC",11,0)
WRAP(TEXT,LENGTH) ; Breaks text string into substrings
"RTN","GMTSORC",12,0)
 ;                
"RTN","GMTSORC",13,0)
 ;    Input
"RTN","GMTSORC",14,0)
 ;       TEXT = Text String
"RTN","GMTSORC",15,0)
 ;       LENGTH = Maximum Length of Substrings
"RTN","GMTSORC",16,0)
 ;                            
"RTN","GMTSORC",17,0)
 ;    Output vertical bar delimted text
"RTN","GMTSORC",18,0)
 ;       substring|substring|substring|substring|substring
"RTN","GMTSORC",19,0)
 ;                            
"RTN","GMTSORC",20,0)
 N GMTI,GMTJ,LINE,GMX,GMX1,GMX2,GMY
"RTN","GMTSORC",21,0)
 I $G(TEXT)']"" Q ""
"RTN","GMTSORC",22,0)
 F GMTI=1:1 D  Q:GMTI=$L(TEXT," ")
"RTN","GMTSORC",23,0)
 . S GMX=$P(TEXT," ",GMTI)
"RTN","GMTSORC",24,0)
 . I $L(GMX)>LENGTH D
"RTN","GMTSORC",25,0)
 . . S GMX1=$E(GMX,1,LENGTH),GMX2=$E(GMX,LENGTH+1,$L(GMX))
"RTN","GMTSORC",26,0)
 . . S $P(TEXT," ",GMTI)=GMX1_" "_GMX2
"RTN","GMTSORC",27,0)
 S LINE=1,GMX(1)=$P(TEXT," ")
"RTN","GMTSORC",28,0)
 F GMTI=2:1 D  Q:GMTI'<$L(TEXT," ")
"RTN","GMTSORC",29,0)
 . S:$L($G(GMX(LINE))_" "_$P(TEXT," ",GMTI))>LENGTH LINE=LINE+1,GMY=1
"RTN","GMTSORC",30,0)
 . S GMX(LINE)=$G(GMX(LINE))_$S(+$G(GMY):"",1:" ")_$P(TEXT," ",GMTI),GMY=0
"RTN","GMTSORC",31,0)
 S GMTJ=0,TEXT="" F GMTI=1:1 S GMTJ=$O(GMX(GMTJ)) Q:+GMTJ'>0  S TEXT=TEXT_$S(GMTI=1:"",1:"|")_GMX(GMTJ)
"RTN","GMTSORC",32,0)
 Q TEXT
"RTN","GMTSORC3")
0^33^B10670476
"RTN","GMTSORC3",1,0)
GMTSORC3 ; SLC/JER,KER - Current Orders (V3) ; 09/21/2001
"RTN","GMTSORC3",2,0)
 ;;2.7;Health Summary;**15,28,47**;Oct 20, 1995
"RTN","GMTSORC3",3,0)
 ;
"RTN","GMTSORC3",4,0)
 ; External References
"RTN","GMTSORC3",5,0)
 ;   DBIA 10096    ^%ZOSF("TEST")
"RTN","GMTSORC3",6,0)
 ;   DBIA 10011    ^DIWP
"RTN","GMTSORC3",7,0)
 ;   DBIA  3154    EN^ORQ1
"RTN","GMTSORC3",8,0)
 ;                             
"RTN","GMTSORC3",9,0)
MAIN ; Current Orders (v3)
"RTN","GMTSORC3",10,0)
 N DIWF,DIWL,DIWR,GMTSDATA,GMTSDGRP,GMTSI,GMTSJ,GMTSK,GMTSLINE,GMTSORNM,GMTSSTAT,GMTSSTOP,GMTSSTRT,GMTSTTAB,GMTSWHEN,ORLIST,X S X="ORQ1" X ^%ZOSF("TEST") G:'$T EXIT D EXIT
"RTN","GMTSORC3",11,0)
 ;
"RTN","GMTSORC3",12,0)
 ; Call 
"RTN","GMTSORC3",13,0)
 ;  EN^ORQ1(PAT,GROUP,FLG,EXPAND,SDATE,EDATE,DETAIL,MULT,XREF,GETKID)
"RTN","GMTSORC3",14,0)
 ;     PAT    = #;DPT(     Patient VP
"RTN","GMTSORC3",15,0)
 ;     GROUP  = 1          Display Group
"RTN","GMTSORC3",16,0)
 ;     FLG    = 2          Active Current Orders
"RTN","GMTSORC3",17,0)
 ;     EXPAND = ""         IEN of Parent Order
"RTN","GMTSORC3",18,0)
 ;     SDATE  = GMTSBEG    Start Date
"RTN","GMTSORC3",19,0)
 ;     EDATE  = GMTSEND    End Date
"RTN","GMTSORC3",20,0)
 ;     DETAIL = 1          Return Details of Order
"RTN","GMTSORC3",21,0)
 ;     MULT   = 1          Allow Multiple Occurrences
"RTN","GMTSORC3",22,0)
 ;           
"RTN","GMTSORC3",23,0)
 D EN^ORQ1(DFN_";DPT(",1,2,"",GMTSBEG,GMTSEND,1,1,,1) G:'$D(^TMP("ORR",$J)) EXIT D HEAD S GMTSI=0
"RTN","GMTSORC3",24,0)
 F  S GMTSI=$O(^TMP("ORR",$J,ORLIST,GMTSI)) Q:GMTSI'>0!$D(GMTSQIT)  D PRT
"RTN","GMTSORC3",25,0)
EXIT ; Clean-up and quit
"RTN","GMTSORC3",26,0)
 K ^TMP("ORR",$J),^UTILITY($J,"W") Q
"RTN","GMTSORC3",27,0)
PRT ; Get the data
"RTN","GMTSORC3",28,0)
 S GMTSDATA=$G(^TMP("ORR",$J,ORLIST,GMTSI)),GMTSORNM=$P(GMTSDATA,U,1),GMTSDGRP=$P(GMTSDATA,U,2),GMTSWHEN=$P(GMTSDATA,U,3),GMTSSTRT=$P(GMTSDATA,U,4),GMTSSTOP=$P(GMTSDATA,U,5)
"RTN","GMTSORC3",29,0)
 I $L($P(GMTSDATA,U,7)) S GMTSSTAT=$P(GMTSDATA,U,7)
"RTN","GMTSORC3",30,0)
 E  S GMTSSTAT=$E($P(GMTSDATA,U,6),1,4)
"RTN","GMTSORC3",31,0)
 S GMTSSTRT=$$REGDTM(GMTSSTRT),GMTSSTOP=$$REGDTM(GMTSSTOP)
"RTN","GMTSORC3",32,0)
 I $O(^TMP("ORR",$J,ORLIST,GMTSI,"TX",0))'>0 D
"RTN","GMTSORC3",33,0)
 . S ^TMP("ORR",$J,ORLIST,GMTSI,"TX")=1,^TMP("ORR",$J,ORLIST,GMTSI,"TX",1)="*** Unknown ***"
"RTN","GMTSORC3",34,0)
 S GMTSJ=0,DIWL=1,DIWR=36,DIWF="" K ^UTILITY($J,"W",DIWL)
"RTN","GMTSORC3",35,0)
 F  S GMTSJ=$O(^TMP("ORR",$J,ORLIST,GMTSI,"TX",GMTSJ)) Q:GMTSJ'>0  D
"RTN","GMTSORC3",36,0)
 . S X=$G(^TMP("ORR",$J,ORLIST,GMTSI,"TX",GMTSJ)) D ^DIWP
"RTN","GMTSORC3",37,0)
 S (GMTSK,GMTSLINE,GMTSTTAB)=0
"RTN","GMTSORC3",38,0)
 F  S GMTSK=$O(^UTILITY($J,"W",DIWL,GMTSK)) Q:GMTSK'>0!$D(GMTSQIT)  D
"RTN","GMTSORC3",39,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  I GMTSNPG D HEAD S GMTSLINE=0
"RTN","GMTSORC3",40,0)
 . S GMTSLINE=GMTSLINE+1
"RTN","GMTSORC3",41,0)
 . W ?GMTSTTAB,$G(^UTILITY($J,"W",DIWL,GMTSK,0)) S GMTSTTAB=2
"RTN","GMTSORC3",42,0)
 . W:GMTSLINE=1 ?39,GMTSSTAT,?45,GMTSSTRT,?63,GMTSSTOP W !
"RTN","GMTSORC3",43,0)
 Q
"RTN","GMTSORC3",44,0)
HEAD ; Print the header
"RTN","GMTSORC3",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Item Ordered",?38,"Status",?45,"Start Date",?63,"Stop Date",!! Q
"RTN","GMTSORC3",46,0)
REGDTM(X) ; Convert an internal to an external date/time
"RTN","GMTSORC3",47,0)
 D:X]"" REGDTM4^GMTSU Q X
"RTN","GMTSORC3",48,0)
WRAP(TEXT,LENGTH) ; Breaks text string into substrings
"RTN","GMTSORC3",49,0)
 ;                
"RTN","GMTSORC3",50,0)
 ;    Input
"RTN","GMTSORC3",51,0)
 ;       TEXT = Text String
"RTN","GMTSORC3",52,0)
 ;       LENGTH = Maximum Length of Substrings
"RTN","GMTSORC3",53,0)
 ;                            
"RTN","GMTSORC3",54,0)
 ;    Output vertical bar delimted text
"RTN","GMTSORC3",55,0)
 ;       substring|substring|substring|substring|substring
"RTN","GMTSORC3",56,0)
 ;                            
"RTN","GMTSORC3",57,0)
 N GMTI,GMTJ,LINE,GMX,GMX1,GMX2,GMY I $G(TEXT)']"" Q ""
"RTN","GMTSORC3",58,0)
 F GMTI=1:1 D  Q:GMTI=$L(TEXT," ")
"RTN","GMTSORC3",59,0)
 . S GMX=$P(TEXT," ",GMTI)
"RTN","GMTSORC3",60,0)
 . I $L(GMX)>LENGTH D
"RTN","GMTSORC3",61,0)
 . . S GMX1=$E(GMX,1,LENGTH),GMX2=$E(GMX,LENGTH+1,$L(GMX)),$P(TEXT," ",GMTI)=GMX1_" "_GMX2
"RTN","GMTSORC3",62,0)
 S LINE=1,GMX(1)=$P(TEXT," ") F GMTI=2:1 D  Q:GMTI'<$L(TEXT," ")
"RTN","GMTSORC3",63,0)
 . S:$L($G(GMX(LINE))_" "_$P(TEXT," ",GMTI))>LENGTH LINE=LINE+1,GMY=1
"RTN","GMTSORC3",64,0)
 . S GMX(LINE)=$G(GMX(LINE))_$S(+$G(GMY):"",1:" ")_$P(TEXT," ",GMTI),GMY=0
"RTN","GMTSORC3",65,0)
 S GMTJ=0,TEXT="" F GMTI=1:1 S GMTJ=$O(GMX(GMTJ)) Q:+GMTJ'>0  S TEXT=TEXT_$S(GMTI=1:"",1:"|")_GMX(GMTJ)
"RTN","GMTSORC3",66,0)
 Q TEXT
"RTN","GMTSP47")
0^^B74950247
"RTN","GMTSP47",1,0)
GMTSP47 ; SLC/KER - Post Install ; 09/21/2001
"RTN","GMTSP47",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSP47",3,0)
 ;
"RTN","GMTSP47",4,0)
 ; External References
"RTN","GMTSP47",5,0)
 ;    DBIA 10018  ^DIE (file #142.1)
"RTN","GMTSP47",6,0)
 ;    DBIA 10141  BMES^XPDUTL
"RTN","GMTSP47",7,0)
 ;    DBIA 10141  MES^XPDUTL
"RTN","GMTSP47",8,0)
 ;    DBIA 10096  ^%ZOSF("TEST")
"RTN","GMTSP47",9,0)
 ;                      
"RTN","GMTSP47",10,0)
POST ; Post Install GMTS*2.7*47
"RTN","GMTSP47",11,0)
 N GMTSBLD,GMTSINST,GMTSHORT
"RTN","GMTSP47",12,0)
 D RE,OH,RK,BUILD^GMTSXPD3 I +$$ROK("GMTSXPS1")>0 S GMTSHORT=1,GMTSINST="",GMTSBLD="GMTS*2.7*47" D SEND^GMTSXPS1
"RTN","GMTSP47",13,0)
 Q
"RTN","GMTSP47",14,0)
 ;
"RTN","GMTSP47",15,0)
RE ; Rename Radiology
"RTN","GMTSP47",16,0)
 N GMTSC,GMTSI,GMTST,GMTSON,GMTSNN,GMTSOA,GMTSNA S GMTSC=0 F GMTSI=1:1 S GMTST=$T(@("RA+"_GMTSI)) Q:GMTST=""  Q:$P(GMTST,";",5)=""  D
"RTN","GMTSP47",17,0)
 . S GMTSON=$P(GMTST,";",2) Q:'$L(GMTSON)  S GMTSOA=$P(GMTST,";",3) Q:'$L(GMTSOA)  S GMTSNN=$P(GMTST,";",4) Q:'$L(GMTSNN)  S GMTSNA=$P(GMTST,";",5) Q:'$L(GMTSNA)  S GMTSIEN=$O(^GMT(142.1,"B",$E(GMTSON,1,30),0)) Q:+GMTSIEN=0
"RTN","GMTSP47",18,0)
 . N DIE,DA,DR,DIDEL,DTOUT,GMTSE S GMTSE=0 D ERA
"RTN","GMTSP47",19,0)
 Q
"RTN","GMTSP47",20,0)
UN ; Uninstall Imaging
"RTN","GMTSP47",21,0)
 N GMTSC,GMTSI,GMTST,GMTSON,GMTSNN,GMTSOA,GMTSNA S GMTSC=0 F GMTSI=1:1 S GMTST=$T(@("UI+"_GMTSI)) Q:GMTST=""  Q:$P(GMTST,";",5)=""  D
"RTN","GMTSP47",22,0)
 . S GMTSON=$P(GMTST,";",2) Q:'$L(GMTSON)  S GMTSOA=$P(GMTST,";",3) Q:'$L(GMTSOA)  S GMTSNN=$P(GMTST,";",4) Q:'$L(GMTSNN)  S GMTSNA=$P(GMTST,";",5) Q:'$L(GMTSNA)  S GMTSIEN=$O(^GMT(142.1,"B",$E(GMTSON,1,30),0)) Q:+GMTSIEN=0
"RTN","GMTSP47",23,0)
 . N DIE,DA,DR,DIDEL,DTOUT,GMTSE S GMTSE=0 D ERA
"RTN","GMTSP47",24,0)
 Q
"RTN","GMTSP47",25,0)
ERA ; Edit Radiology (to imaging)
"RTN","GMTSP47",26,0)
 S GMTSC=GMTSC+1 D:GMTSC=1 BM(" Editing Health Summary Components:") D:GMTSC=1 BM(("     "_$G(GMTSON))) D:GMTSC>1 M(("     "_$G(GMTSON)))
"RTN","GMTSP47",27,0)
 N GMTST S GMTST=0,DIE="^GMT(142.1,",DA=+GMTSIEN,DR=".01///^S X=$G(GMTSNN);3///^S X=$G(GMTSNA)"
"RTN","GMTSP47",28,0)
LOCK ; Lock Record to Edit
"RTN","GMTSP47",29,0)
 L +^GMT(142.1,+GMTSIEN):0
"RTN","GMTSP47",30,0)
 I $T D ^DIE L -^GMT(142.1,+GMTSIEN) Q
"RTN","GMTSP47",31,0)
 H 5 S GMTST=GMTST+1 G:GMTST<3 LOCK Q
"RTN","GMTSP47",32,0)
 Q
"RTN","GMTSP47",33,0)
UI ; Uninstall Imaging
"RTN","GMTSP47",34,0)
 ;IMAGING IMPRESSION;II;RADIOLOGY IMPRESSION;RI
"RTN","GMTSP47",35,0)
 ;IMAGING IMPRESSION SELECTED;SII;RADIOLOGY IMPRESSION SELECTED;SRI
"RTN","GMTSP47",36,0)
 ;IMAGING PROFILE;IP;RADIOLOGY PROFILE;RP
"RTN","GMTSP47",37,0)
 ;IMAGING STATUS;IS;RADIOLOGY STATUS;RS
"RTN","GMTSP47",38,0)
RA ; Rename Radiology
"RTN","GMTSP47",39,0)
 ;RADIOLOGY IMPRESSION;RI;IMAGING IMPRESSION;II
"RTN","GMTSP47",40,0)
 ;RADIOLOGY IMPRESSION SELECTED;SRI;IMAGING IMPRESSION SELECTED;SII
"RTN","GMTSP47",41,0)
 ;RADIOLOGY PROFILE;RP;IMAGING PROFILE;IP
"RTN","GMTSP47",42,0)
 ;RADIOLOGY STATUS;RS;IMAGING STATUS;IS
"RTN","GMTSP47",43,0)
 ;;
"RTN","GMTSP47",44,0)
OH ; On-line Help
"RTN","GMTSP47",45,0)
 N GMTSF,GMTSIEN S GMTSF=0
"RTN","GMTSP47",46,0)
 S GMTSIEN=+($O(^GMT(142.1,"C","PN",0))) I +GMTSIEN>0 D
"RTN","GMTSP47",47,0)
 . D OHT("Progress Notes") K ^GMT(142.1,+GMTSIEN,3.5)
"RTN","GMTSP47",48,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,0)="12^142.35^9^9^3010530^^^^"
"RTN","GMTSP47",49,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,1,0)="This component contains progress notes entered using the Text Integration "
"RTN","GMTSP47",50,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,2,0)="Utilities (TIU) and Mental Health packages.  Time and maximum occurrence "
"RTN","GMTSP47",51,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,3,0)="limits apply to this component.  Data presented include:  Progress note "
"RTN","GMTSP47",52,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,4,0)="date/time written, title, text of note, electronic signature block "
"RTN","GMTSP47",53,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,5,0)="(including possible cosignature and cosigner comments), and the note's"
"RTN","GMTSP47",54,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,6,0)="correction text and correction date/time."
"RTN","GMTSP47",55,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,7,0)="    "
"RTN","GMTSP47",56,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,8,0)="Only those notes which have been signed with an electronic signature"
"RTN","GMTSP47",57,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,9,0)="or electronically marked signed on chart will be reported." H 1
"RTN","GMTSP47",58,0)
 S GMTSIEN=+($O(^GMT(142.1,"C","BPN",0))) I +GMTSIEN>0 D
"RTN","GMTSP47",59,0)
 . D OHT("Brief Progress Notes") K ^GMT(142.1,+GMTSIEN,3.5)
"RTN","GMTSP47",60,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,0)="^142.35^7^7^3010530^^^^"
"RTN","GMTSP47",61,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,1,0)="This component contains limited information from progress notes entered "
"RTN","GMTSP47",62,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,2,0)="using the Text Integration Utility (TIU) or the Mental Health packages."
"RTN","GMTSP47",63,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,3,0)="Time and maximum occurrence limits apply.  Data presented includes:  "
"RTN","GMTSP47",64,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,4,0)="Progress note date/time, title, author and last correction date/time."
"RTN","GMTSP47",65,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,5,0)="    "
"RTN","GMTSP47",66,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,6,0)="Only those notes which have been signed with an electronic signature"
"RTN","GMTSP47",67,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,7,0)="or electronically marked signed on chart will be listed." H 1
"RTN","GMTSP47",68,0)
 S GMTSIEN=+($O(^GMT(142.1,"C","SPN",0))) I +GMTSIEN>0 D
"RTN","GMTSP47",69,0)
 . D OHT("Selected Progress Notes") K ^GMT(142.1,+GMTSIEN,3.5)
"RTN","GMTSP47",70,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,0)="^142.35^9^9^3010530^^^^"
"RTN","GMTSP47",71,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,1,0)="This component allows for the selection of specific progress notes by "
"RTN","GMTSP47",72,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,2,0)="document title.  These progress notes were entered using the Text Integration"
"RTN","GMTSP47",73,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,3,0)="Utilities (TIU).  Data presented include:  Progress note date/time written, "
"RTN","GMTSP47",74,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,4,0)="title, text of note, electronic signature block (including possible "
"RTN","GMTSP47",75,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,5,0)="cosignature and cosigner comments), and the note's correction text and "
"RTN","GMTSP47",76,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,6,0)="correction date/time."
"RTN","GMTSP47",77,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,7,0)="      "
"RTN","GMTSP47",78,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,8,0)="Only those notes which have been signed with an electronic signature or "
"RTN","GMTSP47",79,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,9,0)="electronically marked signed on chart will be reported." H 1
"RTN","GMTSP47",80,0)
 S GMTSIEN=+($O(^GMT(142.1,"C","CW",0))) I +GMTSIEN>0 D
"RTN","GMTSP47",81,0)
 . D OHT("Clinical Warnings") K ^GMT(142.1,+GMTSIEN,3.5)
"RTN","GMTSP47",82,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,0)="^142.35^9^9^3010530^^^^"
"RTN","GMTSP47",83,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,1,0)="This component contains clinical warning notes entered using the Text "
"RTN","GMTSP47",84,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,2,0)="Integration Utility (TIU).  Clinical Warnings are a type of progress note"
"RTN","GMTSP47",85,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,3,0)="which includes clinical information which clinicians need to be alerted to."
"RTN","GMTSP47",86,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,4,0)="No time or maximum occurrence limits apply to this component."
"RTN","GMTSP47",87,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,5,0)=""
"RTN","GMTSP47",88,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,6,0)="If this component is printed out on a CRT, information will include title,"
"RTN","GMTSP47",89,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,7,0)="text of note, electronic signature block, and date posted.  If the printout"
"RTN","GMTSP47",90,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,8,0)="is to another device type, information will include electronic signature"
"RTN","GMTSP47",91,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,9,0)="block and date posted to ensure security of information." H 1
"RTN","GMTSP47",92,0)
 S GMTSIEN=+($O(^GMT(142.1,"C","CN",0))) I +GMTSIEN>0 D
"RTN","GMTSP47",93,0)
 . D OHT("Crisis Notes") K ^GMT(142.1,+GMTSIEN,3.5)
"RTN","GMTSP47",94,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,0)="^142.35^9^9^3010530^^^^"
"RTN","GMTSP47",95,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,1,0)="This component contains crisis notes entered using the Text Integration "
"RTN","GMTSP47",96,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,2,0)="Utility (TIU).  Crisis Notes are a type of progress note which contains "
"RTN","GMTSP47",97,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,3,0)="important information for anyone who deals with a patient.  No time or "
"RTN","GMTSP47",98,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,4,0)="maximum occurrence limits apply to this component."
"RTN","GMTSP47",99,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,5,0)=""
"RTN","GMTSP47",100,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,6,0)="If this component is printed out on a CRT, information will include title,"
"RTN","GMTSP47",101,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,7,0)="text of note, electronic signature block, and date posted. If the printout"
"RTN","GMTSP47",102,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,8,0)="is to another device type, information will include electronic signature"
"RTN","GMTSP47",103,0)
 . S ^GMT(142.1,+GMTSIEN,3.5,9,0)="block and date posted to insure security of information." H 1
"RTN","GMTSP47",104,0)
 S GMTSIEN=+($O(^GMT(142.1,"C","CD",0))) I +GMTSIEN>0 D
"RTN","GMTSP47",105,0)
 . D OHT("Advanced Directive") K ^GMT(142.1,+GMTSIEN,3.5)
"RTN","GMTSP47",106,0)
 . S ^GMT(142.1,25,3.5,0)="^142.35^9^9^3010530^^^^"
"RTN","GMTSP47",107,0)
 . S ^GMT(142.1,25,3.5,1,0)="This component contains advance directive notes entered using the Text"
"RTN","GMTSP47",108,0)
 . S ^GMT(142.1,25,3.5,2,0)="Integration Utilities (TIU).  Advance Directives are a type a progress "
"RTN","GMTSP47",109,0)
 . S ^GMT(142.1,25,3.5,3,0)="note which includes clinical information that clinicians need to be "
"RTN","GMTSP47",110,0)
 . S ^GMT(142.1,25,3.5,4,0)="alerted to.  Time and maximum occurrent limits apply to this"
"RTN","GMTSP47",111,0)
 . S ^GMT(142.1,25,3.5,5,0)="component."
"RTN","GMTSP47",112,0)
 . S ^GMT(142.1,25,3.5,6,0)="    "
"RTN","GMTSP47",113,0)
 . S ^GMT(142.1,25,3.5,7,0)="If this component is printed to either a CRT or another device type,"
"RTN","GMTSP47",114,0)
 . S ^GMT(142.1,25,3.5,8,0)="information will include title, text of note, electronic signature block," H 1
"RTN","GMTSP47",115,0)
 . S ^GMT(142.1,25,3.5,9,0)="and date/time posted."
"RTN","GMTSP47",116,0)
 Q
"RTN","GMTSP47",117,0)
OHT(X) ; On-Line Help Title
"RTN","GMTSP47",118,0)
 D:+($G(GMTSF))=0 BM(" Removing references to 'Generic Progress Notes'"),M(" package from on-line help"),M("    ")
"RTN","GMTSP47",119,0)
 S GMTSF=1 D:$L($G(X)) M(("      "_$G(X)))
"RTN","GMTSP47",120,0)
 Q
"RTN","GMTSP47",121,0)
RK ; Remove LRSUPER key from 'LAB SURGICAL PATHOLOGY'
"RTN","GMTSP47",122,0)
 N GMTSKEY,GMTSCOM,GMTSABR
"RTN","GMTSP47",123,0)
 S GMTSCOM="LAB SURGICAL PATHOLOGY",GMTSABR="SP"
"RTN","GMTSP47",124,0)
 S GMTSCOM=+($O(^GMT(142.1,"B",GMTSCOM,0)))
"RTN","GMTSP47",125,0)
 S GMTSABR=+($O(^GMT(142.1,"C",GMTSABR,0)))
"RTN","GMTSP47",126,0)
 Q:GMTSCOM=0  Q:GMTSCOM'=GMTSABR
"RTN","GMTSP47",127,0)
 S GMTSKEY=$P($G(^GMT(142.1,GMTSCOM,0)),"^",7)
"RTN","GMTSP47",128,0)
 D BM(" Removing LRSUPER Key from 'LAB SURGICAL PATHOLOGY' component")
"RTN","GMTSP47",129,0)
 Q:GMTSKEY'="LRSUPER"
"RTN","GMTSP47",130,0)
 S $P(^GMT(142.1,GMTSCOM,0),"^",7)=""
"RTN","GMTSP47",131,0)
 D BM(" Removed LRSUPER Key from 'LAB SURGICAL PATHOLOGY' component")
"RTN","GMTSP47",132,0)
 Q
"RTN","GMTSP47",133,0)
BM(X) ; Blank Line with Message
"RTN","GMTSP47",134,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSP47",135,0)
M(X) ; Message
"RTN","GMTSP47",136,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSP47",137,0)
ROK(X) ; Routine OK
"RTN","GMTSP47",138,0)
 S X=$G(X) Q:'$L(X) 0 Q:$L(X)>8 0 X ^%ZOSF("TEST") Q:$T 1 Q 0
"RTN","GMTSPD")
0^17^B16848741
"RTN","GMTSPD",1,0)
GMTSPD ; SLC/JER,KER - Interactive Print-by-Location ; 09/21/2001
"RTN","GMTSPD",2,0)
 ;;2.7;Health Summary;**28,30,47**;Oct 20, 1995
"RTN","GMTSPD",3,0)
 ;
"RTN","GMTSPD",4,0)
 ; External
"RTN","GMTSPD",5,0)
 ;    DBIA 10039  ^DIC(42
"RTN","GMTSPD",6,0)
 ;    DBIA   510  ^DISV(
"RTN","GMTSPD",7,0)
 ;    DBIA 10035  ^DPT("CN"
"RTN","GMTSPD",8,0)
 ;    DBIA 10040  ^SC(
"RTN","GMTSPD",9,0)
 ;    DBIA   641  ^SRF("AOR"
"RTN","GMTSPD",10,0)
 ;    DBIA   185  ^SRS("B"
"RTN","GMTSPD",11,0)
 ;    DBIA 10000  C^%DTC
"RTN","GMTSPD",12,0)
 ;    DBIA 10000  NOW^%DTC
"RTN","GMTSPD",13,0)
 ;    DBIA 10006  ^DIC (file #42 and #44)
"RTN","GMTSPD",14,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSPD",15,0)
 ;                           
"RTN","GMTSPD",16,0)
MAIN ; Interactive Print by Location
"RTN","GMTSPD",17,0)
 N GMPSAP,GMTSCDT,GMTSTYP,GMLOC,GMTSSC,GMTSTN
"RTN","GMTSPD",18,0)
 S GMTSTYP=0 K DIROUT
"RTN","GMTSPD",19,0)
 F  D  Q:+GMTSTYP'>0!$D(DIROUT)
"RTN","GMTSPD",20,0)
 . S GMTSTYP=+($$SELTYP) Q:+GMTSTYP'>0!$D(DIROUT)
"RTN","GMTSPD",21,0)
 . F  D  Q:+$G(GMTSSC)'>0!$D(DIROUT)!$D(DUOUT)
"RTN","GMTSPD",22,0)
 . . K GMTSSC
"RTN","GMTSPD",23,0)
 . . D SELLOC(.GMTSSC) Q:+$G(GMTSSC)'>0!$D(DIROUT)!$D(DUOUT)
"RTN","GMTSPD",24,0)
 . . D CHKLOC(.GMTSSC) Q:$O(GMTSSC(0))'>0!$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",25,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSPD",26,0)
 . . N DIROUT
"RTN","GMTSPD",27,0)
 . . D HSOUT^GMTSPD2 W !
"RTN","GMTSPD",28,0)
 Q
"RTN","GMTSPD",29,0)
SELTYP() ; Select Health Summary type
"RTN","GMTSPD",30,0)
 N DIC,X,Y
"RTN","GMTSPD",31,0)
 I $D(^DISV(DUZ,"^GMT(142,")),+$G(GMTSTYP)=0 S DIC("B")=$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U)
"RTN","GMTSPD",32,0)
 S DIC=142,DIC("A")="Select Health Summary Type: "
"RTN","GMTSPD",33,0)
 S DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSPD",34,0)
 S Y=$$TYPE^GMTSULT I +Y'>0,X="^^" S DIROUT=1
"RTN","GMTSPD",35,0)
 I +Y>0,$S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) D
"RTN","GMTSPD",36,0)
 . W !,"This Summary Type includes no components...Please choose another."
"RTN","GMTSPD",37,0)
 Q Y
"RTN","GMTSPD",38,0)
SELLOC(GMX) ; Select multiple Hospital Location
"RTN","GMTSPD",39,0)
 N DIC,LOC,Y,X
"RTN","GMTSPD",40,0)
 S DIC=44,DIC(0)="AEMQZ",DIC("A")="Select Hospital Location: "
"RTN","GMTSPD",41,0)
 S DIC("S")="I ""WCOR""[$P(^(0),U,3)"
"RTN","GMTSPD",42,0)
 F  D  Q:+$G(GMX(+$G(Y)))'>0!$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",43,0)
 . D ^DIC
"RTN","GMTSPD",44,0)
 . I +Y'>0 S:X="^^" DIROUT=1 Q
"RTN","GMTSPD",45,0)
 . S GMX(+Y)=$P(Y,U,1,2)_U_$P(Y(0),U,3)
"RTN","GMTSPD",46,0)
 . S $P(GMX,U)=+Y
"RTN","GMTSPD",47,0)
 . I "COR"[$P(Y(0),U,3) S $P(GMX,U,3)="COR"
"RTN","GMTSPD",48,0)
 . S DIC("A")="Select Next Hospital Location: "
"RTN","GMTSPD",49,0)
 Q
"RTN","GMTSPD",50,0)
CHKLOC(LOC) ; Get date range for Clinics/ORs
"RTN","GMTSPD",51,0)
 I $P($G(LOC),U,3)="COR" D  Q:$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",52,0)
 . S $P(LOC,U,4)=$$SELDATE
"RTN","GMTSPD",53,0)
 W ! S GMLOC=0 F  S GMLOC=$O(LOC(GMLOC)) Q:+GMLOC'>0  D
"RTN","GMTSPD",54,0)
 . I "COR"[$P(LOC(+GMLOC),U,3) S $P(LOC(+GMLOC),U,4)=$P(LOC,U,4,5)
"RTN","GMTSPD",55,0)
 . I $$CKPAT(LOC(+GMLOC))'>0 D
"RTN","GMTSPD",56,0)
 . . W !,"No patients found at ",$$LOCTXT^GMTSPD2($P(LOC(+GMLOC),U,3))," ",$P(LOC(+GMLOC),U,2)
"RTN","GMTSPD",57,0)
 . . N GMB,GME
"RTN","GMTSPD",58,0)
 . . I $P(LOC(+GMLOC),U,4)>0 D
"RTN","GMTSPD",59,0)
 . . . S X=$P(LOC(+GMLOC),U,4) D REGDT4^GMTSU S GMB=X
"RTN","GMTSPD",60,0)
 . . I $P(LOC(+GMLOC),U,5)>0 D
"RTN","GMTSPD",61,0)
 . . . S X=$P(LOC(+GMLOC),U,5) D REGDT4^GMTSU S GME=X
"RTN","GMTSPD",62,0)
 . . W $S($G(GME)]"":" on "_GMB_" to "_GME,$G(GMB)]"":" on "_GMB,1:"")
"RTN","GMTSPD",63,0)
 . . W "."
"RTN","GMTSPD",64,0)
 . . K LOC(+GMLOC)
"RTN","GMTSPD",65,0)
 W !
"RTN","GMTSPD",66,0)
 Q
"RTN","GMTSPD",67,0)
SELDATE() ; Visit/Surgery date range for Print-by-Clinic
"RTN","GMTSPD",68,0)
 N %,%H,%I,DIR,DEFDT,X,Y,GMBEG,GMEND
"RTN","GMTSPD",69,0)
 S (GMBEG,GMEND)=0
"RTN","GMTSPD",70,0)
 D NOW^%DTC S (X,DT)=$P(%,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPD",71,0)
 S DIR(0)="D^::EX",DIR("B")=DEFDT
"RTN","GMTSPD",72,0)
 S DIR("A")="Please enter the beginning Visit or Surgery date"
"RTN","GMTSPD",73,0)
 D ^DIR
"RTN","GMTSPD",74,0)
 I Y="^^" S DIROUT=1
"RTN","GMTSPD",75,0)
 S GMBEG=Y
"RTN","GMTSPD",76,0)
 I +GMBEG>0 D
"RTN","GMTSPD",77,0)
 . S X=$P(GMBEG,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPD",78,0)
 . S DIR(0)="DO^::EX",DIR("B")=DEFDT
"RTN","GMTSPD",79,0)
 . S DIR("A")="Please enter the ending Visit or Surgery date"
"RTN","GMTSPD",80,0)
 . D ^DIR
"RTN","GMTSPD",81,0)
 . I Y="^^" S DIROUT=1
"RTN","GMTSPD",82,0)
 . S GMEND=Y
"RTN","GMTSPD",83,0)
 Q $S(+GMEND>0&(GMEND>GMBEG):GMBEG_U_GMEND,+GMEND>0&(GMEND<GMBEG):GMEND_U_GMBEG,+GMEND>0&(GMEND=GMBEG):GMBEG,1:0)
"RTN","GMTSPD",84,0)
CKPAT(LOC) ; Checks for patients at selected location
"RTN","GMTSPD",85,0)
 N %,%H,%T,LTYPE,X1,X2,X,Y,GMY,GMBEG
"RTN","GMTSPD",86,0)
 S LTYPE=$P(LOC,U,3)
"RTN","GMTSPD",87,0)
 I LTYPE="W" D
"RTN","GMTSPD",88,0)
 . S LOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U)
"RTN","GMTSPD",89,0)
 . S GMY=$S($G(LOC)']"":0,$O(^DPT("CN",LOC,0)):1,1:0)
"RTN","GMTSPD",90,0)
 I $L(LOC,U)=4!($L(LOC,U)=5) D
"RTN","GMTSPD",91,0)
 . S GMY=0
"RTN","GMTSPD",92,0)
 . I +$P(LOC,U,5) S X1=$P(LOC,U,5),X2=1 D C^%DTC
"RTN","GMTSPD",93,0)
 . I +$P(LOC,U,5)'>0 S X1=$P(LOC,U,4),X2=1 D C^%DTC
"RTN","GMTSPD",94,0)
 . I LTYPE="C",+$O(^SC(+LOC,"S",$P(LOC,U,4))),(+$O(^($P(LOC,U,4)))'>X) S GMY=1
"RTN","GMTSPD",95,0)
 . I LTYPE="OR" D
"RTN","GMTSPD",96,0)
 . . N OLOC S GMY=0,OLOC=+$O(^SRS("B",+LOC,0))
"RTN","GMTSPD",97,0)
 . . I +OLOC,+$P(LOC,U,5)'>0,$O(^SRF("AOR",+OLOC,+$P(LOC,U,4),0)) S GMY=1
"RTN","GMTSPD",98,0)
 . . I +OLOC,+$P(LOC,U,5) D
"RTN","GMTSPD",99,0)
 . . . S GMBEG=$P(LOC,U,4)
"RTN","GMTSPD",100,0)
 . . . F  D  Q:GMBEG>$P(LOC,U,5)!(GMY>0)
"RTN","GMTSPD",101,0)
 . . . . I $O(^SRF("AOR",+OLOC,+GMBEG,0)) S GMY=1
"RTN","GMTSPD",102,0)
 . . . . E  S X1=GMBEG,X2=1 D C^%DTC S GMBEG=X
"RTN","GMTSPD",103,0)
 Q $G(GMY)
"RTN","GMTSPL")
0^18^B25267337
"RTN","GMTSPL",1,0)
GMTSPL ; SLC/JER,KER - Print/Queue HS for Patient Lists ; 09/21/2001
"RTN","GMTSPL",2,0)
 ;;2.7;Health Summary;**7,27,28,30,47**;Oct 20, 1995
"RTN","GMTSPL",3,0)
 ;
"RTN","GMTSPL",4,0)
 ; External References
"RTN","GMTSPL",5,0)
 ;    DBIA 10090  ^DIC(4
"RTN","GMTSPL",6,0)
 ;    DBIA 10039  ^DIC(42
"RTN","GMTSPL",7,0)
 ;    DBIA 10035  ^DPT(
"RTN","GMTSPL",8,0)
 ;    DBIA 10035  ^DPT("CN"
"RTN","GMTSPL",9,0)
 ;    DBIA 10040  ^SC(
"RTN","GMTSPL",10,0)
 ;    DBIA    16  ^SRF(
"RTN","GMTSPL",11,0)
 ;    DBIA   641  ^SRF("AOR"
"RTN","GMTSPL",12,0)
 ;    DBIA   185  ^SRS("B"
"RTN","GMTSPL",13,0)
 ;    DBIA 10091  ^XMB(1
"RTN","GMTSPL",14,0)
 ;    DBIA 10000  C^%DTC
"RTN","GMTSPL",15,0)
 ;    DBIA 10000  NOW^%DTC
"RTN","GMTSPL",16,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSPL",17,0)
 ;    DBIA   183  DFN^PSOSD1
"RTN","GMTSPL",18,0)
 ;    DBIA 10104  $$UP^XLFSTR
"RTN","GMTSPL",19,0)
 ;                          
"RTN","GMTSPL",20,0)
MAIN ; Print/Queue for Patient Lists
"RTN","GMTSPL",21,0)
 ;                          
"RTN","GMTSPL",22,0)
 ; Call with:  
"RTN","GMTSPL",23,0)
 ;            GMTSTYP  = Pointer to file 142
"RTN","GMTSPL",24,0)
 ;            GMTSSC   = Pointer to file 44^Hosp Loc Name^
"RTN","GMTSPL",25,0)
 ;                       Hosp Loc Type^Opt begin Visit/Surg Date^
"RTN","GMTSPL",26,0)
 ;                       Opt end Visit/Surgery Date
"RTN","GMTSPL",27,0)
 ;            GMTSSC() = GMTSSC - An array for multiple locations
"RTN","GMTSPL",28,0)
 ;            [GMPSAP] = Optional flag set to 1 if OP Rx Action
"RTN","GMTSPL",29,0)
 ;                       Profile is to print
"RTN","GMTSPL",30,0)
 ;                        
"RTN","GMTSPL",31,0)
 N MULTLOC
"RTN","GMTSPL",32,0)
 I +$O(GMTSSC(0))'>0 D MAINCTRL
"RTN","GMTSPL",33,0)
 I +$O(GMTSSC(0)) D
"RTN","GMTSPL",34,0)
 . S MULTLOC=0
"RTN","GMTSPL",35,0)
 . F  S MULTLOC=$O(GMTSSC(MULTLOC)) Q:+MULTLOC'>0!$D(DIROUT)  D
"RTN","GMTSPL",36,0)
 . . S GMTSSC=GMTSSC(+MULTLOC)
"RTN","GMTSPL",37,0)
 . . D MAINCTRL
"RTN","GMTSPL",38,0)
 Q
"RTN","GMTSPL",39,0)
MAINCTRL ; Controls Branching
"RTN","GMTSPL",40,0)
 N DFN,GMTDFN,GMLTYPE,GMTSLTR,GMPNM,PSOPAR,PSONOPG,PSOINST,PSTYPE
"RTN","GMTSPL",41,0)
 K ^TMP("GMTSPL",$J)
"RTN","GMTSPL",42,0)
 U IO
"RTN","GMTSPL",43,0)
 S GMLTYPE=$P(GMTSSC,U,3)
"RTN","GMTSPL",44,0)
 I GMLTYPE="C" D CLINIC(GMTSSC)
"RTN","GMTSPL",45,0)
 I GMLTYPE="W" D WARD(GMTSSC)
"RTN","GMTSPL",46,0)
 I GMLTYPE="OR" D OR(GMTSSC)
"RTN","GMTSPL",47,0)
 I $L($P(GMTSSC,U,2)),($E(IOST,1)'="C") S GMTSLTR=$E($P(GMTSSC,U,2),1,10) D ^GMTSLTR
"RTN","GMTSPL",48,0)
 I $O(^TMP("GMTSPL",$J,0))="" D NOPAT($P(GMTSSC,U,2)) Q
"RTN","GMTSPL",49,0)
 S GMPNM="" F  S GMPNM=$O(^TMP("GMTSPL",$J,GMPNM)) Q:(GMPNM="")!($D(DIROUT))  D
"RTN","GMTSPL",50,0)
 . S GMTDFN=0 F  S GMTDFN=$O(^TMP("GMTSPL",$J,GMPNM,GMTDFN)) Q:(GMTDFN'>0)!($D(DIROUT))  D
"RTN","GMTSPL",51,0)
 . . N GMDUOUT
"RTN","GMTSPL",52,0)
 . . S DFN=GMTDFN D DRIVER Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSPL",53,0)
 . . I +$G(GMPSAP) D
"RTN","GMTSPL",54,0)
 . . . S (PSTYPE,PSONOPG)=1
"RTN","GMTSPL",55,0)
 . . . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSPL",56,0)
 . . . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSPL",57,0)
 . . . D DFN^PSOSD1,PAGE
"RTN","GMTSPL",58,0)
 K ^TMP("GMTSPL",$J)
"RTN","GMTSPL",59,0)
 Q
"RTN","GMTSPL",60,0)
PAGE ; Pause at BOP for interactive users
"RTN","GMTSPL",61,0)
 N DIR,X,Y
"RTN","GMTSPL",62,0)
 Q:$E(IOST)'="C"!(IOT="HFS")!((IOSL>998)&($G(GMPAT(+$O(GMPAT(""),-1)))'=$G(DFN)))
"RTN","GMTSPL",63,0)
 I IOSL>($Y+5) F  W ! Q:IOSL<($Y+6)!($Y'<22)
"RTN","GMTSPL",64,0)
 S DIR(0)="FO^1:1",DIR("A")="Press RETURN to continue or '^' to exit"
"RTN","GMTSPL",65,0)
 S DIR("?")="Enter '^' to quit present report or '^^' to quit to menu"
"RTN","GMTSPL",66,0)
 D ^DIR
"RTN","GMTSPL",67,0)
 Q
"RTN","GMTSPL",68,0)
NOPAT(LOC) ; Handles unpopulated Hospital location
"RTN","GMTSPL",69,0)
 N %,%H,%I,%T,%Y,GMTS,GMTSDTM,GMTSTN,GMTSHDR,GMTSPG,GMTSTITL,GMTSDTM,GMTSLFG,X,Y
"RTN","GMTSPL",70,0)
 D NOW^%DTC S X=% D REGDTM4^GMTSU S GMTSDTM=X,GMTSTN=$P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)
"RTN","GMTSPL",71,0)
 S DIC=142,DIC(0)="NXF",X=GMTSTN S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSPL",72,0)
 S GMTSTITL=$S($D(^GMT(142,+Y,"T")):^("T"),1:$P(Y,U,2)),GMTSLFG=1
"RTN","GMTSPL",73,0)
 W @IOF D HEADER^GMTSUP W !!,"No Patients found at ",LOC," location.",!
"RTN","GMTSPL",74,0)
 Q
"RTN","GMTSPL",75,0)
CLINIC(LOC) ; Gets list of next-day appointments for clinic
"RTN","GMTSPL",76,0)
 N %,%H,%I,%T,%Y,DFN,GMI,GMJ,X,X1,X2,VDT,Y,GMPNM,GMDT,GMBDT,GMEDT
"RTN","GMTSPL",77,0)
 S VDT=+$P(LOC,U,4)
"RTN","GMTSPL",78,0)
 I 'VDT D NOW^%DTC S VDT=X
"RTN","GMTSPL",79,0)
 S X=+VDT D REGDT4^GMTSU S GMBDT=X
"RTN","GMTSPL",80,0)
 S X=+$P(LOC,U,5) D REGDT4^GMTSU S GMEDT=X
"RTN","GMTSPL",81,0)
 S X1=$S(+$P(LOC,U,5)>0:$P(LOC,U,5),1:VDT),X2=1 D C^%DTC
"RTN","GMTSPL",82,0)
 S GMI=VDT F  S GMI=$O(^SC(+LOC,"S",GMI)) Q:+GMI'>0!(GMI>X)  D
"RTN","GMTSPL",83,0)
 . S GMJ=0 F  S GMJ=$O(^SC(+LOC,"S",GMI,1,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSPL",84,0)
 . . I '$L($P($G(^SC(+LOC,"S",GMI,1,GMJ,0)),U,9)) D
"RTN","GMTSPL",85,0)
 . . . S DFN=+$G(^SC(+LOC,"S",GMI,1,GMJ,0)) Q:DFN'>0
"RTN","GMTSPL",86,0)
 . . . S GMPNM=$P($G(^DPT(+DFN,0)),U)
"RTN","GMTSPL",87,0)
 . . . N X
"RTN","GMTSPL",88,0)
 . . . S X=+GMI D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",89,0)
 . . . S ^TMP("GMTSPL",$J,GMPNM,+DFN)=$S($D(^TMP("GMTSPL",$J,GMPNM,+DFN)):GMBDT_" TO "_GMEDT,1:GMDT)
"RTN","GMTSPL",90,0)
 Q
"RTN","GMTSPL",91,0)
WARD(LOC) ; Gets list of patients for a ward
"RTN","GMTSPL",92,0)
 N DFN,GMLOC,X,Y,GMDT
"RTN","GMTSPL",93,0)
 S GMLOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U)
"RTN","GMTSPL",94,0)
 I $S('$L(GMLOC):1,'$O(^DPT("CN",GMLOC,0)):1,1:0) Q
"RTN","GMTSPL",95,0)
 S DFN=0 F  S DFN=$O(^DPT("CN",GMLOC,DFN)) Q:+DFN'>0  D
"RTN","GMTSPL",96,0)
 . N X
"RTN","GMTSPL",97,0)
 . S X=+$G(DT) D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",98,0)
 . S ^TMP("GMTSPL",$J,$P($G(^DPT(+DFN,0)),U),+DFN)=GMDT
"RTN","GMTSPL",99,0)
 Q
"RTN","GMTSPL",100,0)
OR(LOC) ; Gets list of patients scheduled for surgery
"RTN","GMTSPL",101,0)
 N GMBEG,GMEND,DFN,GMI,GMJ,GMPNM,GMDT,%,%H,%I,%T,%Y,X,X1,X2,Y
"RTN","GMTSPL",102,0)
 S GMI=+$O(^SRS("B",+LOC,0)) I +GMI'>0 G ORX
"RTN","GMTSPL",103,0)
 S GMBEG=$P(LOC,U,4)-.0001,GMEND=$S(+$P(LOC,U,5)>0:$P(LOC,U,5),1:$P(LOC,U,4))
"RTN","GMTSPL",104,0)
 F  S GMBEG=$O(^SRF("AOR",+GMI,+GMBEG)) Q:+GMBEG'>0!(+GMBEG>+GMEND)  D
"RTN","GMTSPL",105,0)
 . S GMJ=0 F  S GMJ=$O(^SRF("AOR",+GMI,+GMBEG,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSPL",106,0)
 . . S DFN=+$G(^SRF(+GMJ,0)) Q:DFN'>0
"RTN","GMTSPL",107,0)
 . . S GMPNM=$P($G(^DPT(+DFN,0)),U)
"RTN","GMTSPL",108,0)
 . . N X
"RTN","GMTSPL",109,0)
 . . S X=+GMBEG D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",110,0)
 . . S ^TMP("GMTSPL",$J,GMPNM,+DFN)=$S($D(^TMP("GMTSPL",$J,GMPNM,+DFN)):^(+DFN)_", "_GMDT,1:GMDT)
"RTN","GMTSPL",111,0)
ORX ; Exit Surgery
"RTN","GMTSPL",112,0)
 Q
"RTN","GMTSPL",113,0)
DRIVER ; Sets variables for GMTS1 and calls ^%ZTLOAD
"RTN","GMTSPL",114,0)
 N %T,C,D0,GMTS,GMTS0,GMTS1,GMTS2,GMTSDOB,GMTSDTM,GMTSLO,GMTSLOCK,GMTSLPG
"RTN","GMTSPL",115,0)
 N GMTSEG,GMTSEGC,GMTSTN,GMTSEGI,GMTSPNM,GMTSRB,GMTSSN,GMTSTITL,GMTSWARD,GMTSX
"RTN","GMTSPL",116,0)
 N GMTSPHDR,GMTSAGE,GMTSTOF,GMTSCDT,GMW,I,SEX,VA,VADM,VAIN,VAINDT,VAROOT,X,Y
"RTN","GMTSPL",117,0)
 S GMTSCDT(0)=^TMP("GMTSPL",$J,GMPNM,+DFN),GMTSTN=$P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)
"RTN","GMTSPL",118,0)
 S DIC=142,DIC(0)="NXF",X=GMTSTN S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSPL",119,0)
 S GMTSTITL=$$UP^XLFSTR($S($G(^GMT(142,+Y,"T"))]"":^("T"),1:$P(Y,U,2)))
"RTN","GMTSPL",120,0)
 D:$D(GMTSEG)'>9 SELTYP1^GMTS D EN^GMTS1
"RTN","GMTSPL",121,0)
 Q
"RTN","GMTSPN")
0^28^B64160267
"RTN","GMTSPN",1,0)
GMTSPN ; SLC/KER - Progress Note                     ; 09/21/2001
"RTN","GMTSPN",2,0)
 ;;2.7;Health Summary;**12,28,33,35,45,47**;Oct 20, 1995
"RTN","GMTSPN",3,0)
 ;                          
"RTN","GMTSPN",4,0)
 ; External References
"RTN","GMTSPN",5,0)
 ;    DBIA  2902  VISIT^TIULAPIC
"RTN","GMTSPN",6,0)
 ;    DBIA  2902  MAIN^TIULAPIC
"RTN","GMTSPN",7,0)
 ;    DBIA 10006  ^DIC
"RTN","GMTSPN",8,0)
 ;                        
"RTN","GMTSPN",9,0)
PN ; Progress Note Health Summary Component
"RTN","GMTSPN",10,0)
 N TIUSTAT,TIUTYPE,TIUNAM,DIC,TIUFPRIV,TIUXREF,GMTSTIUC,X,Y,GMTSREF
"RTN","GMTSPN",11,0)
 S TIUFPRIV=1,TIUSTAT="ALL",TIUXREF="""APT""",GMTSTIUC="P",(TIUNAM,X)="PROGRESS NOTES"
"RTN","GMTSPN",12,0)
 S DIC="^TIU(8925.1,",DIC(0)="X",DIC("S")="I $P($G(^(0)),U,4)=""CL"""
"RTN","GMTSPN",13,0)
 D ^DIC K DIC("S") S:Y>0 TIUTYPE=+Y S GMTSREF="" D MAIN K GMTSREF
"RTN","GMTSPN",14,0)
 Q
"RTN","GMTSPN",15,0)
MAIN ; Control branching
"RTN","GMTSPN",16,0)
 N ADATE,ADMIT,ASUB,ATDATE,ATTNDNG,ATTYPE,ATYPE,AUTHOR,CHILD,CONEED
"RTN","GMTSPN",17,0)
 N COSAME,COSGEDBY,COSIG,CURIEN,DISCHG,GMTSA,GMTSAI,GMTSAII,GMTSCNT
"RTN","GMTSPN",18,0)
 N GMTSD,GMTSDIC,GMTSEXSG,GMTSI,GMTSIEN,GMTSID,GMTSIDC,GMTSII,GMTSIQ
"RTN","GMTSPN",19,0)
 N GMTSJ,GMTSK,GMTSODIC,GMTSPDIC,GMTSTDIC,GMTSPR,GMTSREC,GMTST,GMTSX
"RTN","GMTSPN",20,0)
 N GMTSXTRA,I,PARIEN,PDATE,PN,PSUB,PTYPE,REASON,SIGNEDBY,STATUS,TSPEC
"RTN","GMTSPN",21,0)
 N TYPE,X,Y
"RTN","GMTSPN",22,0)
 K ^TMP("TIU",$J) S GMTSX=1 D EXTIU Q:'$D(^TMP("TIU",$J))  D PNOTE
"RTN","GMTSPN",23,0)
 K ^TMP("TIU",$J),PN Q
"RTN","GMTSPN",24,0)
 ;                      
"RTN","GMTSPN",25,0)
 ; Progress Notes
"RTN","GMTSPN",26,0)
 ; 
"RTN","GMTSPN",27,0)
 ; ^TMP("TIU",$J,IDT,0)
"RTN","GMTSPN",28,0)
 ; ^TMP("TIU",$J,IDT,IEN,FLD,"E")
"RTN","GMTSPN",29,0)
 ; ^TMP("TIU",$J,IDT,IEN,FLD,"I")
"RTN","GMTSPN",30,0)
 ; ^TMP("TIU",$J,IDT,IEN,"TEXT",0)
"RTN","GMTSPN",31,0)
 ; ^TMP("TIU",$J,IDT,IEN,"TEXT",#,0)
"RTN","GMTSPN",32,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",33,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",34,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",35,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",36,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZAD",0)
"RTN","GMTSPN",37,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,FLD,"E")
"RTN","GMTSPN",38,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,FLD,"I")
"RTN","GMTSPN",39,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"TEXT",0)
"RTN","GMTSPN",40,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"TEXT",#,0)
"RTN","GMTSPN",41,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",42,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",43,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",44,0)
 ; ^TMP("TIU",$J,IDT,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",45,0)
 ; 
"RTN","GMTSPN",46,0)
 ; Selected Progress Notes
"RTN","GMTSPN",47,0)
 ; 
"RTN","GMTSPN",48,0)
 ; ^TMP("TIU",$J,IDT,#,0)
"RTN","GMTSPN",49,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,FLD,"E")
"RTN","GMTSPN",50,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,FLD,"I")
"RTN","GMTSPN",51,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"TEXT",0)
"RTN","GMTSPN",52,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"TEXT",#,0)
"RTN","GMTSPN",53,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",54,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",55,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",56,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",57,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",0)
"RTN","GMTSPN",58,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,FLD,"E")
"RTN","GMTSPN",59,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,FLD,"I")
"RTN","GMTSPN",60,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"TEXT",0)
"RTN","GMTSPN",61,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"TEXT",#,0)
"RTN","GMTSPN",62,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"E")
"RTN","GMTSPN",63,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,FLD,"I")
"RTN","GMTSPN",64,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",0)
"RTN","GMTSPN",65,0)
 ; ^TMP("TIU",$J,IDT,#,IEN,"ZZID",#,IEN,"ZADD",IEN,"TEXT",#,0)
"RTN","GMTSPN",66,0)
 ;                           
"RTN","GMTSPN",67,0)
PNOTE ; Progress Notes
"RTN","GMTSPN",68,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S GMTSD=0 F  S GMTSD=$O(^TMP("TIU",$J,GMTSD)) Q:+GMTSD=0  D
"RTN","GMTSPN",69,0)
 . S GMTSODIC="^TMP(""TIU"","_$J_","_GMTSD_"," D NOTE
"RTN","GMTSPN",70,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSPN",71,0)
SNOTE ; Selected Progress Notes
"RTN","GMTSPN",72,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S GMTSD=0 F  S GMTSD=$O(^TMP("TIU",$J,GMTSD)) Q:+GMTSD=0  D
"RTN","GMTSPN",73,0)
 . N GMTSS S GMTSS=0 F  S GMTSS=$O(^TMP("TIU",$J,GMTSD,GMTSS)) Q:+GMTSS=0  D
"RTN","GMTSPN",74,0)
 . . S GMTSODIC="^TMP(""TIU"","_$J_","_GMTSD_","_GMTSS_"," D NOTE
"RTN","GMTSPN",75,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSPN",76,0)
 ;                
"RTN","GMTSPN",77,0)
NOTE ;   Primary Note
"RTN","GMTSPN",78,0)
 N GMTSTDIC,GMTSI,GMTSXTRA S GMTSI=0
"RTN","GMTSPN",79,0)
 F  S GMTSI=$O(@(GMTSODIC_GMTSI_")")) Q:+GMTSI=0  D
"RTN","GMTSPN",80,0)
 . S (GMTSTDIC,GMTSPDIC,GMTSDIC)=GMTSODIC,(PARIEN,CURIEN)=GMTSI
"RTN","GMTSPN",81,0)
 . S CHILD=+($G(@(GMTSDIC_CURIEN_",""ZZID"",0)"))),TYPE="",GMTSID=0
"RTN","GMTSPN",82,0)
 . S:$D(@(GMTSDIC_CURIEN_",""ZZID"")")) TYPE="Parent Interdisciplinary Note",GMTSID=1
"RTN","GMTSPN",83,0)
 . K PN S PN("#")=CURIEN,PN("#",0)="NOTE"
"RTN","GMTSPN",84,0)
 . D FLDS(GMTSDIC,CURIEN) D:$D(@(GMTSDIC_CURIEN_",""ZZID"")")) ST^GMTSPN1("Begin Interdisciplinary Note")
"RTN","GMTSPN",85,0)
 . D WARN1^GMTSPN2 D:$E($G(GMTSTIUC),1)'["D" WH^GMTSPN1
"RTN","GMTSPN",86,0)
 . D:$G(GMTSTIUC)="DCS" WDH^GMTSPN1
"RTN","GMTSPN",87,0)
 . D:GMTSCNT=1&($G(GMTSTIUC)="DSB") WDBH^GMTSPN1
"RTN","GMTSPN",88,0)
 . I $G(GMTSTIUC)="DSB" D WDB^GMTSPN1(GMTSDIC,CURIEN) Q
"RTN","GMTSPN",89,0)
 . D:$D(@(GMTSDIC_CURIEN_",""PROBLEM"")")) WP^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",90,0)
 . D WT^GMTSPN1(GMTSDIC,CURIEN),WS^GMTSPN2(GMTSDIC,CURIEN),WARN2^GMTSPN2
"RTN","GMTSPN",91,0)
 . D:+($G(PN("AMENDMNT")))>0 AM^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",92,0)
 . D BL^GMTSPN2 N GMTSODIC S GMTSODIC=GMTSTDIC_CURIEN_"," D ANOTE,INOTE
"RTN","GMTSPN",93,0)
 . I GMTSID D ST^GMTSPN1("End Interdisciplinary Note") S GMTSID=0
"RTN","GMTSPN",94,0)
 Q
"RTN","GMTSPN",95,0)
ANOTE ;   Addendum to a Progress Note
"RTN","GMTSPN",96,0)
 N GMTSAI,GMTSXTRA S GMTSAI=0
"RTN","GMTSPN",97,0)
 F  S GMTSAI=$O(@(GMTSODIC_"""ZADD"","_GMTSAI_")")) Q:+GMTSAI=0  D
"RTN","GMTSPN",98,0)
 . S (GMTSTDIC,GMTSDIC)=GMTSODIC_"""ZADD"",",CURIEN=GMTSAI
"RTN","GMTSPN",99,0)
 . K PN S PN("#")=GMTSI_"^"_CURIEN,PN("#",0)="ADDENDUM TO A NOTE",TYPE=""
"RTN","GMTSPN",100,0)
 . S:$D(@(GMTSPDIC_PARIEN_",""ZZID"")")) TYPE="Addendum to a Parent Interdisciplinary Note"
"RTN","GMTSPN",101,0)
 . D FLDS(GMTSDIC,CURIEN),WARN1^GMTSPN2,WAH^GMTSPN1
"RTN","GMTSPN",102,0)
 . D WT^GMTSPN1(GMTSDIC,CURIEN),WS^GMTSPN2(GMTSDIC,CURIEN),WARN2^GMTSPN2,BL^GMTSPN2
"RTN","GMTSPN",103,0)
 Q
"RTN","GMTSPN",104,0)
INOTE ;   Interdisciplinary Progress Note
"RTN","GMTSPN",105,0)
 Q:+($G(@(GMTSODIC_"""ZZID"",0)")))'>0
"RTN","GMTSPN",106,0)
 N GMTSIQ,GMTSII,GMTSXTRA S GMTSIQ=0
"RTN","GMTSPN",107,0)
 F  S GMTSIQ=$O(@(GMTSODIC_"""ZZID"","_GMTSIQ_")")) Q:+GMTSIQ=0  D
"RTN","GMTSPN",108,0)
 . S GMTSTDIC=GMTSODIC N GMTSODIC S GMTSODIC=GMTSTDIC_"""ZZID"","_GMTSIQ_","
"RTN","GMTSPN",109,0)
 . S GMTSII=0 F  S GMTSII=$O(@(GMTSODIC_GMTSII_")")) Q:+GMTSII=0  D
"RTN","GMTSPN",110,0)
 . . S GMTSDIC=GMTSODIC,CURIEN=GMTSII
"RTN","GMTSPN",111,0)
 . . K PN S PN("#")=GMTSI_"^"_CURIEN,PN("#",0)="INTERDISCIPLINARY NOTE"
"RTN","GMTSPN",112,0)
 . . S TYPE="Child Interdisciplinary Note"
"RTN","GMTSPN",113,0)
 . . D FLDS(GMTSDIC,CURIEN),ST^GMTSPN1("Interdisciplinary Note Cont.")
"RTN","GMTSPN",114,0)
 . . D WARN1^GMTSPN2,WIH^GMTSPN1 D:$D(@(GMTSDIC_CURIEN_",""PROBLEM"")")) WP^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",115,0)
 . . D WT^GMTSPN1(GMTSDIC,CURIEN),WS^GMTSPN2(GMTSDIC,CURIEN)
"RTN","GMTSPN",116,0)
 . . D WARN2^GMTSPN2 D:+($G(PN("AMENDMNT")))>0 AM^GMTSPN1(GMTSDIC,CURIEN) D BL^GMTSPN2
"RTN","GMTSPN",117,0)
 . . S GMTSTDIC=GMTSODIC N GMTSODIC S GMTSODIC=GMTSTDIC_GMTSII_",""ZADD"","
"RTN","GMTSPN",118,0)
 . . D AINOTE
"RTN","GMTSPN",119,0)
 Q
"RTN","GMTSPN",120,0)
AINOTE ;   Addendum to an Interdisciplinary Progress Note
"RTN","GMTSPN",121,0)
 N GMTSAII,GMTSXTRA S GMTSAII=0
"RTN","GMTSPN",122,0)
 F  S GMTSAII=$O(@(GMTSODIC_GMTSAII_")")) Q:+GMTSAII=0  D
"RTN","GMTSPN",123,0)
 . S GMTSDIC=GMTSODIC,CURIEN=GMTSAII
"RTN","GMTSPN",124,0)
 . K PN S PN("#")=GMTSI_"^"_GMTSII_"^"_CURIEN
"RTN","GMTSPN",125,0)
 . S PN("#",0)="ADDENDUM TO AN INTERDISCIPLINARY NOTE"
"RTN","GMTSPN",126,0)
 . S TYPE="Addendum to a Child Interdisciplinary Note"
"RTN","GMTSPN",127,0)
 . D FLDS(GMTSDIC,CURIEN),WARN1^GMTSPN2,WAIH^GMTSPN1,WT^GMTSPN1(GMTSDIC,CURIEN)
"RTN","GMTSPN",128,0)
 . D WS^GMTSPN2(GMTSDIC,CURIEN),WARN2^GMTSPN2,BL^GMTSPN2
"RTN","GMTSPN",129,0)
 Q
"RTN","GMTSPN",130,0)
 ;                           
"RTN","GMTSPN",131,0)
 ; Get Data
"RTN","GMTSPN",132,0)
EXTIU ;   Extract Patient/Visit VIA TIU
"RTN","GMTSPN",133,0)
 S DFN=+($G(DFN)) Q:DFN=0  S TIUTYPE=+($G(TIUTYPE)) Q:TIUTYPE=0  S GMTS1=+($G(GMTS1)) Q:GMTS1=0  S GMTS2=+($G(GMTS2)) Q:GMTS2=0  S GMTSNDM=+($G(GMTSNDM)) Q:GMTSNDM=0  S GMTSX=+($G(GMTSX))
"RTN","GMTSPN",134,0)
 I +($G(GMTSPXGO))>0,$L($T(VISIT^TIULAPIC)) D VISIT^TIULAPIC(DFN,TIUTYPE,GMTS1,GMTS2,GMTSNDM,+($G(GMTSX))) Q
"RTN","GMTSPN",135,0)
 D MAIN^TIULAPIC(DFN,TIUTYPE,GMTS1,GMTS2,GMTSNDM,+($G(GMTSX)))
"RTN","GMTSPN",136,0)
 Q
"RTN","GMTSPN",137,0)
FLDS(X,I) ; Get Fields
"RTN","GMTSPN",138,0)
 N GMTSDIC,GMTSIEN
"RTN","GMTSPN",139,0)
 S GMTSDIC=$G(X),GMTSIEN=$G(I) Q:'$L(GMTSIEN)
"RTN","GMTSPN",140,0)
 Q:$E($P(GMTSDIC,$J,1),1,11)'="^TMP(""TIU"","
"RTN","GMTSPN",141,0)
 Q:'$D(@($P(GMTSDIC,",",1,($L(GMTSDIC,",")-1))_")"))
"RTN","GMTSPN",142,0)
 Q:'$D(@(GMTSDIC_GMTSIEN_")"))
"RTN","GMTSPN",143,0)
 S GMTSDIC=GMTSDIC_GMTSIEN_","
"RTN","GMTSPN",144,0)
 N GMTSXTRA S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPN",145,0)
 S X=$G(@(GMTSDIC_".07,""I"")")) D REGDT4^GMTSU S ADMIT=X
"RTN","GMTSPN",146,0)
 S X=$G(@(GMTSDIC_".08,""I"")")) D REGDT4^GMTSU S DISCHG=X
"RTN","GMTSPN",147,0)
 S:+DISCHG'>0 DISCHG="Present"
"RTN","GMTSPN",148,0)
 S:+ADMIT'>0 ADMIT="Unknown"
"RTN","GMTSPN",149,0)
 S AUTHOR=$G(@(GMTSDIC_"1202,""E"")"))
"RTN","GMTSPN",150,0)
 S ATTNDNG=$G(@(GMTSDIC_"1209,""E"")"))
"RTN","GMTSPN",151,0)
 S TSPEC=$G(@(GMTSDIC_"1402,""E"")"))
"RTN","GMTSPN",152,0)
 S STATUS=$G(@(GMTSDIC_".05,""E"")"))
"RTN","GMTSPN",153,0)
 S PN("DATE")=$G(@(GMTSDIC_"1301,""I"")"))
"RTN","GMTSPN",154,0)
 I PN("DATE")]"" S PN("DATE")=$$EDT^GMTSU(PN("DATE"))
"RTN","GMTSPN",155,0)
 S REASON="",PN("DOCTYPE")=$G(@(GMTSDIC_".01,""E"")"))
"RTN","GMTSPN",156,0)
 S PN("STATUS")=$G(@(GMTSDIC_".05,""E"")"))
"RTN","GMTSPN",157,0)
 S PN("AUTHOR")=$G(@(GMTSDIC_"1202,""E"")"))
"RTN","GMTSPN",158,0)
 S PN("EXPSIGNR")=$G(@(GMTSDIC_"1204,""E"")"))
"RTN","GMTSPN",159,0)
 S PN("LOC")=$G(@(GMTSDIC_"1205,""E"")"))
"RTN","GMTSPN",160,0)
 S PN("EXPCOSNR")=$G(@(GMTSDIC_"1208,""E"")"))
"RTN","GMTSPN",161,0)
 S:$G(@(GMTSDIC_"1307,""I"")"))'="" PN("DDATE")=$$ED^GMTSU($G(@(GMTSDIC_"1307,""I"")")))
"RTN","GMTSPN",162,0)
 S:$G(@(GMTSDIC_"1501,""I"")"))'="" PN("SIGNDATE")=$$ED^GMTSU($G(@(GMTSDIC_"1501,""I"")")))
"RTN","GMTSPN",163,0)
 S PN("SIGDT")=$G(@(GMTSDIC_"1501,""I"")"))
"RTN","GMTSPN",164,0)
 I PN("SIGDT")]"" S PN("SIGDT")=$$EDT^GMTSU(PN("SIGDT"))
"RTN","GMTSPN",165,0)
 S SIGNEDBY=$G(@(GMTSDIC_"1502,""I"")"))
"RTN","GMTSPN",166,0)
 S PN("SIGBLK")=$G(@(GMTSDIC_"1503,""E"")"))
"RTN","GMTSPN",167,0)
 S PN("STITLE")=$G(@(GMTSDIC_"1504,""E"")"))
"RTN","GMTSPN",168,0)
 S PN("COSDT")=$G(@(GMTSDIC_"1507,""I"")"))
"RTN","GMTSPN",169,0)
 I PN("COSDT")]"" S (COSIG,PN("COSDT"))=$$EDT^GMTSU(PN("COSDT"))
"RTN","GMTSPN",170,0)
 S COSGEDBY=$G(@(GMTSDIC_"1508,""I"")"))
"RTN","GMTSPN",171,0)
 S CONEED=0 S:+($G(COSGEDBY))>0 CONEED=1
"RTN","GMTSPN",172,0)
 S PN("COBLK")=$G(@(GMTSDIC_"1509,""E"")"))
"RTN","GMTSPN",173,0)
 S PN("COTITLE")=$G(@(GMTSDIC_"1510,""E"")"))
"RTN","GMTSPN",174,0)
 S COSAME=$S(+($G(SIGNEDBY))>0&(+($G(SIGNEDBY))=+($G(COSGEDBY))):1,1:0)
"RTN","GMTSPN",175,0)
 S:CONEED>0 CONEED=$S(COSAME=1:0,1:CONEED)
"RTN","GMTSPN",176,0)
 S PN("SUBJ")=$G(@(GMTSDIC_"1701,""E"")"))
"RTN","GMTSPN",177,0)
 I $G(@(GMTSDIC_"1505,""I"")"))="C" D
"RTN","GMTSPN",178,0)
 . S PN("SCHART")="Signed on Chart by:",PN("SCHARTBY")="."
"RTN","GMTSPN",179,0)
 . S:$G(@(GMTSDIC_"1512,""E"")"))'="" PN("SCHARTBY")=$G(@(GMTSDIC_"1512,""E"")"))
"RTN","GMTSPN",180,0)
 I $E($G(GMTSTIUC),1)'["D",$G(@(GMTSDIC_"1511,""I"")"))="C" D
"RTN","GMTSPN",181,0)
 . S PN("COCHART")="Cosigned on Chart by:",PN("COCHARTBY")="."
"RTN","GMTSPN",182,0)
 . S:$G(@(GMTSDIC_"1513,""E"")"))'="" PN("COCHARTBY")=$G(@(GMTSDIC_"1513,""E"")"))
"RTN","GMTSPN",183,0)
 I $E($G(GMTSTIUC),1)["D",CONEED,$G(@(GMTSDIC_"1511,""I"")"))="C" D
"RTN","GMTSPN",184,0)
 . S PN("COCHART")="Cosigned on Chart by:",PN("COCHARTBY")="."
"RTN","GMTSPN",185,0)
 . S:$G(@(GMTSDIC_"1513,""E"")"))'="" PN("COCHARTBY")=$G(@(GMTSDIC_"1513,""E"")"))
"RTN","GMTSPN",186,0)
 S:$G(@(GMTSDIC_"1202,""I"")"))'=$G(@(GMTSDIC_"1502,""I"")")) PN("AUTH")="AUTHOR:  "_PN("AUTHOR")
"RTN","GMTSPN",187,0)
 S PN("AMENDMNT")=+($G(@(GMTSDIC_"1601,""I"")")))
"RTN","GMTSPN",188,0)
 Q
"RTN","GMTSPN2")
0^29^B51711119
"RTN","GMTSPN2",1,0)
GMTSPN2 ; SLC/KER - Progress Note Signatures           ; 09/21/2001
"RTN","GMTSPN2",2,0)
 ;;2.7;Health Summary;**45,47**;Oct 20, 1995
"RTN","GMTSPN2",3,0)
 Q
"RTN","GMTSPN2",4,0)
 ;                          
"RTN","GMTSPN2",5,0)
 ; External References
"RTN","GMTSPN2",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPN2",7,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSPN2",8,0)
 ;   DBIA 10060  ^VA(200, .137
"RTN","GMTSPN2",9,0)
 ;   DBIA 10060  ^VA(200, .138
"RTN","GMTSPN2",10,0)
 ;                     
"RTN","GMTSPN2",11,0)
WS(X,I) ; Write Signatures 
"RTN","GMTSPN2",12,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPN2",13,0)
 N GMTSDIC,GMTSIEN,GMTSA,GMTSG S GMTSDIC=$G(X),GMTSIEN=$G(I)
"RTN","GMTSPN2",14,0)
 Q:'$L(GMTSIEN)  Q:$E($P(GMTSDIC,$J,1),1,11)'="^TMP(""TIU"","
"RTN","GMTSPN2",15,0)
 Q:'$D(@($P(GMTSDIC,",",1,($L(GMTSDIC,",")-1))_")"))
"RTN","GMTSPN2",16,0)
 Q:'$D(@(GMTSDIC_GMTSIEN_")"))
"RTN","GMTSPN2",17,0)
 S GMTSDIC=GMTSDIC_GMTSIEN_","
"RTN","GMTSPN2",18,0)
 D UNS,SOC,SIG,UNC,COC,COS,EXT
"RTN","GMTSPN2",19,0)
 Q
"RTN","GMTSPN2",20,0)
UNS ;   Unsigned/Draft Copy
"RTN","GMTSPN2",21,0)
 Q:$D(GMTSQIT)  N GMTST S GMTST=$G(@(GMTSDIC_"1501,""I"")"))
"RTN","GMTSPN2",22,0)
 D:GMTST="" UNSIG
"RTN","GMTSPN2",23,0)
 Q
"RTN","GMTSPN2",24,0)
 ;
"RTN","GMTSPN2",25,0)
SOC ;   Signed on Chart
"RTN","GMTSPN2",26,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB
"RTN","GMTSPN2",27,0)
 S GMTSP=$G(PN("SCHART")),GMTSB=$G(PN("SCHARTBY")) Q:'$L(GMTSP)  Q:'$L(GMTSB)
"RTN","GMTSPN2",28,0)
 D BL Q:$D(GMTSQIT)  D BY(GMTSP,"",GMTSB) Q:$D(GMTSQIT)
"RTN","GMTSPN2",29,0)
 Q
"RTN","GMTSPN2",30,0)
SIG ;   Signature Block, Name, Title and Date
"RTN","GMTSPN2",31,0)
 Q:$D(GMTSQIT)  N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB
"RTN","GMTSPN2",32,0)
 S GMTSP="Signed by:"
"RTN","GMTSPN2",33,0)
 S GMTSE=$G(@(GMTSDIC_"1505,""I"")"))
"RTN","GMTSPN2",34,0)
 S GMTSB=$G(PN("SIGBLK")) Q:'$L(GMTSB)
"RTN","GMTSPN2",35,0)
 S GMTST=$G(PN("STITLE"))
"RTN","GMTSPN2",36,0)
 S GMTSD=$G(PN("SIGDT"))
"RTN","GMTSPN2",37,0)
 S GMTSA=$$GET1^DIQ(200,+($G(SIGNEDBY)),.137)
"RTN","GMTSPN2",38,0)
 S GMTSG=$$GET1^DIQ(200,+($G(SIGNEDBY)),.138)
"RTN","GMTSPN2",39,0)
 D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",40,0)
 D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)
"RTN","GMTSPN2",41,0)
 D SB(GMTST,GMTSD) Q:$D(GMTSQIT)
"RTN","GMTSPN2",42,0)
 D PG(GMTSA,GMTSG) Q:$D(GMTSQIT)
"RTN","GMTSPN2",43,0)
 Q
"RTN","GMTSPN2",44,0)
UNC ;   Uncosigned - Requires Cosignature
"RTN","GMTSPN2",45,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB
"RTN","GMTSPN2",46,0)
 S GMTSP=$G(@(GMTSDIC_".05,""E"")")) Q:GMTSP'="UNCOSIGNED"
"RTN","GMTSPN2",47,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)
"RTN","GMTSPN2",48,0)
 D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",49,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27,"** REQUIRES COSIGNATURE **"
"RTN","GMTSPN2",50,0)
 Q
"RTN","GMTSPN2",51,0)
COC ;   Cosigned on Chart
"RTN","GMTSPN2",52,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB
"RTN","GMTSPN2",53,0)
 S GMTSP=$G(PN("COCHART")),GMTSB=$G(PN("COCHARTBY")) Q:'$L(GMTSP)  Q:'$L(GMTSB)
"RTN","GMTSPN2",54,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)
"RTN","GMTSPN2",55,0)
 D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",56,0)
 D BY(GMTSP,"",GMTSB)
"RTN","GMTSPN2",57,0)
 Q
"RTN","GMTSPN2",58,0)
COS ;   Co-Signature Block, Name, Title and Date
"RTN","GMTSPN2",59,0)
 Q:$D(GMTSQIT)  N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB
"RTN","GMTSPN2",60,0)
 S GMTSP="Cosigned by:",GMTSE=$G(@(GMTSDIC_"1511,""I"")")),GMTSB=$G(PN("COBLK")) Q:'$L(GMTSB)
"RTN","GMTSPN2",61,0)
 S GMTST=$G(PN("COTITLE")),GMTSD=$G(PN("COSDT"))
"RTN","GMTSPN2",62,0)
 S GMTSA=$$GET1^DIQ(200,+($G(COSGEDBY)),.137),GMTSG=$$GET1^DIQ(200,+($G(COSGEDBY)),.138)
"RTN","GMTSPN2",63,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)
"RTN","GMTSPN2",64,0)
 D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",65,0)
 D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)
"RTN","GMTSPN2",66,0)
 D SB(GMTST,GMTSD) Q:$D(GMTSQIT)
"RTN","GMTSPN2",67,0)
 D PG(GMTSA,GMTSG)
"RTN","GMTSPN2",68,0)
 Q
"RTN","GMTSPN2",69,0)
EXT ;   Extra Signatures
"RTN","GMTSPN2",70,0)
 ;     Receipt Acknowledged by:
"RTN","GMTSPN2",71,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPN2",72,0)
 I +$O(@(GMTSDIC_"""EXTRASGNR"",0)")) D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",73,0)
 . D BL Q:$D(GMTSQIT)  D BY("Receipt Acknowledged by:","","")
"RTN","GMTSPN2",74,0)
 ;     Extra Signature Block, Name, Title and Date
"RTN","GMTSPN2",75,0)
 N GMTSXTRA S GMTSXTRA=0
"RTN","GMTSPN2",76,0)
 F  S GMTSXTRA=+$O(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_")")) Q:+GMTSXTRA'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",77,0)
 . N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB,GMTSI,GMTSC
"RTN","GMTSPN2",78,0)
 . S GMTSC=+($G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""DATE"")")))
"RTN","GMTSPN2",79,0)
 . I GMTSC'>0 W ?27,"* AWAITING SIGNATURE *" D BL Q
"RTN","GMTSPN2",80,0)
 . S GMTSP="",GMTSE="/es/",GMTSB=$G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""NAME"")")) Q:'$L(GMTSB)
"RTN","GMTSPN2",81,0)
 . S GMTST=$G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""TITLE"")"))
"RTN","GMTSPN2",82,0)
 . S GMTSD=$$EDT^GMTSU(GMTSC)
"RTN","GMTSPN2",83,0)
 . S GMTSI=+($G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""EXTRA"")")))
"RTN","GMTSPN2",84,0)
 . S GMTSA=$$GET1^DIQ(200,+($G(GMTSI)),.137)
"RTN","GMTSPN2",85,0)
 . S GMTSG=$$GET1^DIQ(200,+($G(GMTSI)),.138)
"RTN","GMTSPN2",86,0)
 . I +($G(GMTSXTRA))>1 D BL Q:$D(GMTSQIT)  D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",87,0)
 . D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)
"RTN","GMTSPN2",88,0)
 . D SB(GMTST,GMTSD) Q:$D(GMTSQIT)
"RTN","GMTSPN2",89,0)
 . D PG(GMTSA,GMTSG) Q:$D(GMTSQIT)
"RTN","GMTSPN2",90,0)
 Q
"RTN","GMTSPN2",91,0)
 ;                      
"RTN","GMTSPN2",92,0)
UNSIG ; Unsigned Note
"RTN","GMTSPN2",93,0)
 N GMTS,GMTS1,GMTS1,GMTST,GMTSB S GMTST="<  THE ABOVE NOTE IS UNSIGNED  >",GMTS=""
"RTN","GMTSPN2",94,0)
 S $P(GMTS," ",((79-$L(GMTST))\2)\2)=" ",$P(GMTS1," ",((79-$L(GMTST))\2)\2)=" "
"RTN","GMTSPN2",95,0)
 S GMTS2=GMTS_GMTS1,GMTS1=GMTS1_GMTS,GMTSB=GMTS1_GMTST_GMTS2
"RTN","GMTSPN2",96,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",97,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"- DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY -"
"RTN","GMTSPN2",98,0)
 Q
"RTN","GMTSPN2",99,0)
 ;                        
"RTN","GMTSPN2",100,0)
 ; Warnings
"RTN","GMTSPN2",101,0)
WARN1 ;   Beginning of Note
"RTN","GMTSPN2",102,0)
 N GMTSD,GMTSW S GMTSW=1,GMTSD=0 D DEL1,RETR1 D:GMTSD BL Q
"RTN","GMTSPN2",103,0)
WARN2 ;   End of Note
"RTN","GMTSPN2",104,0)
 N GMTSD,GMTSW S GMTSW=2,GMTSD=0 D DEL2,RETR2 Q
"RTN","GMTSPN2",105,0)
DEL1 ;     Deleted Note (begin)
"RTN","GMTSPN2",106,0)
 Q:($G(STATUS)'="DELETED")&($G(PN("STATUS"))'="DELETED")
"RTN","GMTSPN2",107,0)
 N GMTST,GMTST2 S GMTST="<  THE FOLLOWING ENTRY HAS BEEN DELETED >",GMTST2="<<<<< DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED >>>>>" D WARN3 Q
"RTN","GMTSPN2",108,0)
DEL2 ;     Deleted Note (end)
"RTN","GMTSPN2",109,0)
 Q:($G(STATUS)'="DELETED")&($G(PN("STATUS"))'="DELETED")
"RTN","GMTSPN2",110,0)
 N GMTST,GMTST2 S GMTST="<  THE ABOVE ENTRY HAS BEEN DELETED >",GMTST2="<<<<< DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED >>>>>" D WARN3 Q
"RTN","GMTSPN2",111,0)
RETR1 ;     Retracted Note (begin)
"RTN","GMTSPN2",112,0)
 Q:($G(STATUS)'="RETRACTED")&($G(PN("STATUS"))'="RETRACTED")
"RTN","GMTSPN2",113,0)
 N GMTST,GMTST2 S GMTST="<  THE FOLLOWING ENTRY HAS BEEN RETRACTED >",GMTST2="<<<<<< RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED >>>>>>" D WARN3 Q
"RTN","GMTSPN2",114,0)
RETR2 ;     Retracted Note (end)
"RTN","GMTSPN2",115,0)
 Q:($G(STATUS)'="RETRACTED")&($G(PN("STATUS"))'="RETRACTED")
"RTN","GMTSPN2",116,0)
 N GMTST,GMTST2 S GMTST="<  THE ABOVE ENTRY HAS BEEN RETRACTED >",GMTST2="<<<<<< RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED >>>>>>" D WARN3 Q
"RTN","GMTSPN2",117,0)
WARN3 ;   Warning Display (display)
"RTN","GMTSPN2",118,0)
 N GMTS,GMTS1,GMTS2,GMTSB S GMTS="",GMTST=$G(GMTST),GMTST2=$G(GMTST2) Q:'$L(GMTST)  Q:'$L(GMTST2)
"RTN","GMTSPN2",119,0)
 S $P(GMTS,"<",((79-$L(GMTST))\2)\2)="<"
"RTN","GMTSPN2",120,0)
 S $P(GMTS1,"<",((79-$L(GMTST))\2)\2)="<",GMTS1=GMTS_GMTS1,GMTS=""
"RTN","GMTSPN2",121,0)
 S $P(GMTS,">",((79-$L(GMTST))\2)\2)=">"
"RTN","GMTSPN2",122,0)
 S $P(GMTS2,">",((79-$L(GMTST))\2)\2)=">",GMTS2=GMTS2_GMTS,GMTS=""
"RTN","GMTSPN2",123,0)
 S GMTSB=GMTS1_GMTST_GMTS2 F  Q:$L(GMTSB)'<$L(GMTST2)  S GMTSB=GMTSB_">"
"RTN","GMTSPN2",124,0)
 I +($G(GMTSW))=2 D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",125,0)
 I +($G(GMTSW))=1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",126,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTST2 S:$D(GMTSD) GMTSD=1
"RTN","GMTSPN2",127,0)
 I +($G(GMTSW))=2 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",128,0)
 Q
"RTN","GMTSPN2",129,0)
 ;                   
"RTN","GMTSPN2",130,0)
 ; Miscelaneous
"RTN","GMTSPN2",131,0)
BY(GMTSH,GMTSE,GMTSN) ; Signed by
"RTN","GMTSPN2",132,0)
 S GMTSH=$$TRIM($G(GMTSH)),GMTSE=$G(GMTSE),GMTSN=$G(GMTSN) Q:'$L((GMTSH_GMTSN))
"RTN","GMTSPN2",133,0)
 S:$L(GMTSH) GMTSH=GMTSH_"  " S GMTSE=$S(GMTSE="E":"/es/  ",GMTSE["/es/":"/es/  ",1:"") S:GMTSN="."&(GMTSH[" by:") GMTSH=$P(GMTSH," by:",1)_".",GMTSN="" S:GMTSN="." GMTSN=""
"RTN","GMTSPN2",134,0)
 I $L($$TRIM(GMTSH)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("",(27-$L(GMTSH))),GMTSH
"RTN","GMTSPN2",135,0)
 W ?27,GMTSE,GMTSN
"RTN","GMTSPN2",136,0)
 Q
"RTN","GMTSPN2",137,0)
SB(GMTSB,GMTSD) ; Signature Block
"RTN","GMTSPN2",138,0)
 K ^UTILITY($J,"W") N X,DIWT,DIWL,DIWR,DIWF,GMTSI
"RTN","GMTSPN2",139,0)
 S (X,GMTSB)=$G(GMTSB),GMTSD=$G(GMTSD) Q:'$L((GMTSB_GMTSD))
"RTN","GMTSPN2",140,0)
 S GMTSI=1,DIWL=0,DIWF="C35" D ^DIWP S GMTSB=$$TRIM($G(^UTILITY($J,"W",0,1,0))) K:'$L(GMTSB) ^UTILITY($J,"W")
"RTN","GMTSPN2",141,0)
 I $L(GMTSD),'$L(GMTSB) K ^UTILITY($J,"W") D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?27,GMTSD Q
"RTN","GMTSPN2",142,0)
 Q:'$L(GMTSB)  D CKP^GMTSUP K:$D(GMTSQIT) ^UTILITY($J,"W") Q:$D(GMTSQIT)  W !,?27,GMTSB,"  ",GMTSD
"RTN","GMTSPN2",143,0)
 F  S GMTSI=$O(^UTILITY($J,"W",0,GMTSI)) Q:+GMTSI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",144,0)
 . S GMTSB=$$TRIM($G(^UTILITY($J,"W",0,GMTSI,0))) Q:'$L(GMTSB)
"RTN","GMTSPN2",145,0)
 . D CKP^GMTSUP K:$D(GMTSQIT) ^UTILITY($J,"W") Q:$D(GMTSQIT)  W !,?27,GMTSB,"  "
"RTN","GMTSPN2",146,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPN2",147,0)
 Q
"RTN","GMTSPN2",148,0)
PG(GMTSA,GMTSD) ; Pagers
"RTN","GMTSPN2",149,0)
 N GMTS S GMTS=0,GMTSA=$G(GMTSA),GMTSD=$G(GMTSD) Q:'$L((GMTSA_GMTSD))  Q:(+GMTSA+GMTSD)'>0
"RTN","GMTSPN2",150,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I $L(GMTSA),+GMTSA>0 D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",151,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",GMTSA S GMTS=1
"RTN","GMTSPN2",152,0)
 I $L(GMTSD),+GMTSD>0 D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",153,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",GMTSD S GMTS=1
"RTN","GMTSPN2",154,0)
 Q
"RTN","GMTSPN2",155,0)
BL ;   Blank Line
"RTN","GMTSPN2",156,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSPN2",157,0)
TRIM(X) ;   Trim Spaces from String
"RTN","GMTSPN2",158,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSPN2",159,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSPN2",160,0)
 Q X
"RTN","GMTSPP")
0^34^B21869344
"RTN","GMTSPP",1,0)
GMTSPP ;SLC/KER - Define HS Print-by-Location Parameters ; 09/21/2001
"RTN","GMTSPP",2,0)
 ;;2.7;Health Summary;**2,30,47**;Oct 20, 1995
"RTN","GMTSPP",3,0)
 ;
"RTN","GMTSPP",4,0)
 ; External References
"RTN","GMTSPP",5,0)
 ;    DBIA 10003  DD^%DT
"RTN","GMTSPP",6,0)
 ;    DBIA 10006  ^DIC
"RTN","GMTSPP",7,0)
 ;    DBIA  2051  FIND^DIC
"RTN","GMTSPP",8,0)
 ;    DBIA 10018  ^DIE
"RTN","GMTSPP",9,0)
 ;    DBIA  2056  $$GET1^DIQ
"RTN","GMTSPP",10,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSPP",11,0)
 ;                  
"RTN","GMTSPP",12,0)
MAIN ; Print by Location
"RTN","GMTSPP",13,0)
 K DIC,DIE,DIR
"RTN","GMTSPP",14,0)
 S DIC=19.2,DIC(0)="F",X="GMTS TASK STARTUP" S Y=$$SDT(X)
"RTN","GMTSPP",15,0)
 I Y<0 D ALERT K X,Y G MAIN1
"RTN","GMTSPP",16,0)
 I Y>DT D QUEOK K Y G MAIN1
"RTN","GMTSPP",17,0)
 D ALERT
"RTN","GMTSPP",18,0)
MAIN1 ; Controls Branching
"RTN","GMTSPP",19,0)
 F  D GETDATA Q:$D(PPQIT)!$D(DTOUT)
"RTN","GMTSPP",20,0)
 K CLINIC,DIROUT,DIRUT,DTOUT,DUOUT,GMTSIFN,GMTSLOC,J1,J2,NEWTYP,PPQIT,X,B,C,D0,DI,DIJ,DISYS,DP,DQ,P
"RTN","GMTSPP",21,0)
 Q
"RTN","GMTSPP",22,0)
QUEOK ; Informs user of print time if queued to print
"RTN","GMTSPP",23,0)
 D DD^%DT S QTIM=Y K Y
"RTN","GMTSPP",24,0)
 W !!,"For your information:",!
"RTN","GMTSPP",25,0)
 W "Health Summary Batches are queued to print nightly at ",QTIM,!
"RTN","GMTSPP",26,0)
 W "and should be available for distribution by early morning.",!
"RTN","GMTSPP",27,0)
 K QTIM
"RTN","GMTSPP",28,0)
 Q
"RTN","GMTSPP",29,0)
ALERT ; Warns user that summaries have not been queued
"RTN","GMTSPP",30,0)
 W !!,"                                ***Alert***",!!
"RTN","GMTSPP",31,0)
 W "Health Summary batches have not been queued to print or date is not current.",!
"RTN","GMTSPP",32,0)
 W "Please ask your IRM SERVICE to queue option GMTS TASK STARTUP",!
"RTN","GMTSPP",33,0)
 W "to run nightly.  Parameters may be set now but will not produce",!
"RTN","GMTSPP",34,0)
 W "Health Summaries until option is queued."
"RTN","GMTSPP",35,0)
 Q
"RTN","GMTSPP",36,0)
GETDATA ; Selects Location/Health Summary Type and Edits parameters
"RTN","GMTSPP",37,0)
 S DIC=44,DIC(0)="AEMQZ",DIC("A")="Select Hospital Location: ",DIC("S")="I ""WCOR""[$P(^(0),U,3)" W ! D ^DIC K DIC
"RTN","GMTSPP",38,0)
 I Y=-1 K X,Y S PPQIT=1 Q
"RTN","GMTSPP",39,0)
 S GMTSLOC=+Y,GMTSLNM=$P(Y,U,2),CLINIC=$S("COR"[$P(Y(0),U,3):1,1:0) K X,Y
"RTN","GMTSPP",40,0)
 I $O(^GMT(142,"D",GMTSLOC,0)) D DISPLAY
"RTN","GMTSPP",41,0)
 K GMTSLNM
"RTN","GMTSPP",42,0)
 S DIC=142,DIC(0)="AEQ",DIC("A")="Select Health Summary Type: " S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSPP",43,0)
 I X="" K X,Y Q
"RTN","GMTSPP",44,0)
 I Y=-1 K X,Y S PPQIT=1 Q
"RTN","GMTSPP",45,0)
 S GMTSIFN=+Y,NEWTYP=1,TYP1=0
"RTN","GMTSPP",46,0)
 F  S TYP1=$O(^GMT(142,"D",GMTSLOC,TYP1)) Q:TYP1=""  I GMTSIFN=TYP1 S NEWTYP=0 Q
"RTN","GMTSPP",47,0)
 S GMTSUM=$P(Y,U,2),GMTSNEW=0,EXISTS=1,GMTSQIT=0 K X,Y D LIST^GMTSRM
"RTN","GMTSPP",48,0)
 K GMTSNEW,EXISTS,GMTSQIT,GMTSUM,TYP1
"RTN","GMTSPP",49,0)
 Q:$D(DUOUT)  I $D(DIRUT) S PPQIT=1 Q
"RTN","GMTSPP",50,0)
 I NEWTYP=1 D NEW Q
"RTN","GMTSPP",51,0)
 S DIR(0)="Y",DIR("A")="Do you wish to delete this Health Summary Type from the nightly print",DIR("B")="NO"
"RTN","GMTSPP",52,0)
 W ! D ^DIR K DIR
"RTN","GMTSPP",53,0)
 Q:$D(DUOUT)  I $D(DIRUT) S PPQIT=1 Q
"RTN","GMTSPP",54,0)
 S DIE="^GMT(142,"_GMTSIFN_",20,",DIE("NO^")="OUTOK",DA(1)=GMTSIFN
"RTN","GMTSPP",55,0)
 S DA=$O(^GMT(142,"D",GMTSLOC,GMTSIFN,0)),DEL=0
"RTN","GMTSPP",56,0)
 I Y=1 S DR=".01///@",DEL=1
"RTN","GMTSPP",57,0)
 K X,Y
"RTN","GMTSPP",58,0)
 E  S:CLINIC DR=".02;I $P($G(^GMT(142.99,1,0)),U,2)'=""Y"" S Y=""@1"";.03;@1;.04//0" S:'CLINIC DR=".02;I $P($G(^GMT(142.99,1,0)),U,2)'=""Y"" S Y=0;.03" W !
"RTN","GMTSPP",59,0)
 D ^DIE
"RTN","GMTSPP",60,0)
 I DEL W !!,"**Print for Health Summary Type deleted**"
"RTN","GMTSPP",61,0)
 K DIE,DA,DR,X,Y,DEL
"RTN","GMTSPP",62,0)
 Q
"RTN","GMTSPP",63,0)
DISPLAY ; Displays Health Summary Types associated with Location
"RTN","GMTSPP",64,0)
 W !!,"At present the following Health Summary Types are printed for ",GMTSLNM,":"
"RTN","GMTSPP",65,0)
 W !?70,"Action",!?2,"Type",?32,"Device" W:CLINIC ?54,"Days Ahead" W ?70,"Profile",!
"RTN","GMTSPP",66,0)
 S DEVFLG=0
"RTN","GMTSPP",67,0)
 S TYP=0 F J1=1:1 S TYP=$O(^GMT(142,"D",GMTSLOC,TYP)) Q:TYP=""  D WRITE
"RTN","GMTSPP",68,0)
 I DEVFLG W !!,"*This Type will not print since Device is invalid or has not been entered"
"RTN","GMTSPP",69,0)
 W !!,"You may edit a Health Summary Type from the list or enter a new Type",!
"RTN","GMTSPP",70,0)
 K TYP,DEVFLG
"RTN","GMTSPP",71,0)
 Q
"RTN","GMTSPP",72,0)
WRITE ; Writes Health Summary Type with parameters
"RTN","GMTSPP",73,0)
 S TYPNM=$P(^GMT(142,TYP,0),U),LOCIFN=$O(^GMT(142,"D",GMTSLOC,TYP,0))
"RTN","GMTSPP",74,0)
 S DATA=^GMT(142,TYP,20,LOCIFN,0),DEV=$P(DATA,U,2)
"RTN","GMTSPP",75,0)
 S X="`"_DEV,DIC=3.5,DIC(0)="" D ^DIC
"RTN","GMTSPP",76,0)
 I +Y'>0 S DEVFLG=1
"RTN","GMTSPP",77,0)
 S DEVNM=$S(+Y>0:$P(Y,U,2),DEV="":"None",1:DEV_" (Invalid)")
"RTN","GMTSPP",78,0)
 W !,$S(+Y'>0:"*",1:" "),TYPNM,?32,$E(DEVNM,1,21),?59,$P(DATA,U,4),?72,$S($P(DATA,U,3)="Y":"Yes",1:"No") K DIC,X,Y
"RTN","GMTSPP",79,0)
 K DATA,DAYS,DEV,DEVNM,LOCIFN,TYPNM
"RTN","GMTSPP",80,0)
 Q
"RTN","GMTSPP",81,0)
NEW ; Sets parameters for new Health Summary Type
"RTN","GMTSPP",82,0)
 S (NI,LI)=0 I $D(^GMT(142,GMTSIFN,20,0)) F  S NI=$O(^GMT(142,GMTSIFN,20,NI)) Q:NI'>0  S LI=NI
"RTN","GMTSPP",83,0)
 S:'$D(^GMT(142,GMTSIFN,20,0)) ^(0)="^142.2P^^"
"RTN","GMTSPP",84,0)
 S DIE="^GMT(142,"_GMTSIFN_",20,",DA(1)=GMTSIFN,DA=LI+1,DIE("NO^")="OUTOK"
"RTN","GMTSPP",85,0)
 I CLINIC S DR=".01////"_GMTSLOC_";.02;I $P($G(^GMT(142.99,1,0)),U,2)'=""Y"" S Y=""@1"";.03;@1;.04//0"
"RTN","GMTSPP",86,0)
 E  S DR=".01////"_GMTSLOC_";.02;I $P($G(^GMT(142.99,1,0)),U,2)'=""Y"" S Y=0;.03"
"RTN","GMTSPP",87,0)
 W ! D ^DIE K DIE,DA,DR,X,Y,NI,LI,J3
"RTN","GMTSPP",88,0)
 Q
"RTN","GMTSPP",89,0)
SDT(X) ; Get the last schedule date/time
"RTN","GMTSPP",90,0)
 N GMTSM,GMTSR,GMTSI,GMTSE,GMTSDA S (GMTSI,GMTSM)=0
"RTN","GMTSPP",91,0)
 D FIND^DIC(19.2,,,"X",X,5,,,,"GMTSDA")
"RTN","GMTSPP",92,0)
 F  S GMTSI=$O(GMTSDA("DILIST",2,GMTSI)) Q:GMTSI'>0  D
"RTN","GMTSPP",93,0)
 . S GMTSE=GMTSDA("DILIST",2,GMTSI) Q:+GMTSE'>0
"RTN","GMTSPP",94,0)
 . S GMTSR=$$GET1^DIQ(19.2,(GMTSE_","),2,"I")
"RTN","GMTSPP",95,0)
 . S:+GMTSR>GMTSM GMTSM=+GMTSR
"RTN","GMTSPP",96,0)
 S X=$S(+($G(GMTSM))>0:+($G(GMTSM)),1:-1) Q X
"RTN","GMTSPXOP")
0^12^B47881208
"RTN","GMTSPXOP",1,0)
GMTSPXOP ; SLC/SBW,KER - PCE Outpatient Encounter comp ; 09/21/2001
"RTN","GMTSPXOP",2,0)
 ;;2.7;Health Summary;**8,10,28,37,47**;Oct 20, 1995
"RTN","GMTSPXOP",3,0)
 ;
"RTN","GMTSPXOP",4,0)
 ; External References
"RTN","GMTSPXOP",5,0)
 ;    DBIA  1238  VISIT^PXRHS01
"RTN","GMTSPXOP",6,0)
 ;    DBIA  1996  $$MOD^ICPTMOD
"RTN","GMTSPXOP",7,0)
 ;    DBIA 10103  $$DT^XLFDT
"RTN","GMTSPXOP",8,0)
 ;    DBIA 10011  ^DIWP
"RTN","GMTSPXOP",9,0)
 ;                      
"RTN","GMTSPXOP",10,0)
PURPOSE ; Encounters with ICD9 and providers
"RTN","GMTSPXOP",11,0)
 N DTYPE S DTYPE="DP" D MAIN Q
"RTN","GMTSPXOP",12,0)
OUTPT ; Encounters with ICD9, CPT, and providers
"RTN","GMTSPXOP",13,0)
 N DTYPE S DTYPE="CDP" D MAIN Q
"RTN","GMTSPXOP",14,0)
MAIN ; Entry for Purpose of Visit and Outpatient Encounters
"RTN","GMTSPXOP",15,0)
 N GMTSIVD,GMTSDAT,GMTSDTU,GMTSOVT,GMTSLOC,DIWL,GMTAB,GMTSN,GMCKP,GMTSX
"RTN","GMTSPXOP",16,0)
 N GMTSITE,GMTSINS,GMTSEVT,GMTSHIS,GMTSICL,GMTSLOC,GMTSELIG,X,GMTSVDF
"RTN","GMTSPXOP",17,0)
 N GMTSCPTM,GMICL
"RTN","GMTSPXOP",18,0)
 ;                     
"RTN","GMTSPXOP",19,0)
 ; GMTSCPTM    Component uses CPT Modifiers 1 yes 0 no
"RTN","GMTSPXOP",20,0)
 S GMTSCPTM=+($$CPT^GMTSU(+($G(GMTSEGN)))) S:$G(GMPXCMOD)="N" GMTSCPTM=0
"RTN","GMTSPXOP",21,0)
 ; GMTSICL     # of blank left columns for support data of a visit
"RTN","GMTSPXOP",22,0)
 S GMTSICL=14
"RTN","GMTSPXOP",23,0)
 ; DIWL        Used in TXTFMT call & to print returned data
"RTN","GMTSPXOP",24,0)
 S DIWL=0
"RTN","GMTSPXOP",25,0)
 ; GMTAB       Used to offset data from TXTFMT call after 1st line
"RTN","GMTSPXOP",26,0)
 S GMTAB=2
"RTN","GMTSPXOP",27,0)
 ; GMTSOVT     This is the set of Service Categories for AICTSORE
"RTN","GMTSPXOP",28,0)
 ;                     
"RTN","GMTSPXOP",29,0)
 ;                A  Ambulatory
"RTN","GMTSPXOP",30,0)
 ;                I  Inpatient
"RTN","GMTSPXOP",31,0)
 ;                C  Chart Review
"RTN","GMTSPXOP",32,0)
 ;                T  Telecommunications
"RTN","GMTSPXOP",33,0)
 ;                S  Day Surgery
"RTN","GMTSPXOP",34,0)
 ;                O  Observation
"RTN","GMTSPXOP",35,0)
 ;                R  Nursing Home Encounters
"RTN","GMTSPXOP",36,0)
 ;                E  Event (Historical)
"RTN","GMTSPXOP",37,0)
 ;                  
"RTN","GMTSPXOP",38,0)
 ;            Note:  Hospitalization and Ancillary 
"RTN","GMTSPXOP",39,0)
 ;                   encounters are not included
"RTN","GMTSPXOP",40,0)
 S GMTSOVT="AICTSORE"
"RTN","GMTSPXOP",41,0)
 ;
"RTN","GMTSPXOP",42,0)
 D VISIT^PXRHS01(DFN,GMTSEND,GMTSBEG,GMTSNDM,GMTSOVT,DTYPE,1)
"RTN","GMTSPXOP",43,0)
 Q:'$D(^TMP("PXHSV",$J))
"RTN","GMTSPXOP",44,0)
 S GMTSIVD=0
"RTN","GMTSPXOP",45,0)
 F  S GMTSIVD=$O(^TMP("PXHSV",$J,GMTSIVD)) Q:GMTSIVD']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",46,0)
 . S GMTSVDF=0
"RTN","GMTSPXOP",47,0)
 . F  S GMTSVDF=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF)) Q:GMTSVDF'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",48,0)
 . . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,0))
"RTN","GMTSPXOP",49,0)
 . . S GMTSEVT=$P(GMTSN,U,4),GMTSHIS=$S(GMTSEVT["HISTORICAL":1,1:0)
"RTN","GMTSPXOP",50,0)
 . . S X=$P(GMTSN,U,1) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXOP",51,0)
 . . S GMTSDTU=0,(GMTSITE,GMTSLOC)=""
"RTN","GMTSPXOP",52,0)
 . . S GMTSINS=$S($P(GMTSN,U,3)]"":$E($P(GMTSN,U,3),1,10),$P(GMTSN,U,8)]"":$E($P(GMTSN,U,8),1,10),1:""),GMTSITE=GMTSINS
"RTN","GMTSPXOP",53,0)
 . . I $G(GMPXHLOC)="Y" S GMTSLOC=$E($P(GMTSN,U,6),1,30)
"RTN","GMTSPXOP",54,0)
 . . I '$L(GMTSLOC) S GMTSLOC=$P(GMTSN,U,9)
"RTN","GMTSPXOP",55,0)
 . . S GMTSELIG=$E($P(GMTSN,U,12),1,17)
"RTN","GMTSPXOP",56,0)
 . . S:GMTSITE=""&('GMTSHIS) GMTSLOC=""
"RTN","GMTSPXOP",57,0)
 . . I GMTSHIS D
"RTN","GMTSPXOP",58,0)
 . . . S:GMTSLOC'=""&(GMTSITE'="") GMTSLOC=GMTSLOC_" (Historical Event)"
"RTN","GMTSPXOP",59,0)
 . . . S:GMTSLOC=""&(GMTSITE'="") GMTSITE=GMTSITE_" (Historical Event)"
"RTN","GMTSPXOP",60,0)
 . . . S:GMTSLOC'=""&(GMTSITE="") GMTSITE=GMTSLOC_" (Historical Event)",GMTSLOC=""
"RTN","GMTSPXOP",61,0)
 . . . S:GMTSLOC=""&(GMTSITE="") GMTSITE="Historical Event"
"RTN","GMTSPXOP",62,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS,DSPPROV Q:$D(GMTSQIT)
"RTN","GMTSPXOP",63,0)
 . . D DSPPOV Q:$D(GMTSQIT)  D DSPCPT W !
"RTN","GMTSPXOP",64,0)
 K ^TMP("PXHSV",$J)
"RTN","GMTSPXOP",65,0)
 Q
"RTN","GMTSPXOP",66,0)
 ;                     
"RTN","GMTSPXOP",67,0)
DSPPOV ; Display Purpose of visit
"RTN","GMTSPXOP",68,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",""))=""
"RTN","GMTSPXOP",69,0)
 Q:$G(GMPXICDF)="N"&($G(GMPXNARR)="N")
"RTN","GMTSPXOP",70,0)
 N GMTSN,GMTSMOD,GMTSICD,GMTSNARR,GMTSPDN,GMTS,GMTSQTY,GMTSPRI,COMMENT
"RTN","GMTSPXOP",71,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3,"Diagnosis:"
"RTN","GMTSPXOP",72,0)
 S GMCKP=0,GMTSPDN="",GMTSQTY=""
"RTN","GMTSPXOP",73,0)
 F  S GMTSPDN=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN)) Q:GMTSPDN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",74,0)
 . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN))
"RTN","GMTSPXOP",75,0)
 . S GMTSMOD=$P(GMTSN,U,2)
"RTN","GMTSPXOP",76,0)
 . S GMTSICD=$P(GMTSN,U) D GETICDDX^GMTSPXU1(.GMTSICD,$G(GMPXICDF),GMTSMOD)
"RTN","GMTSPXOP",77,0)
 . S GMTSNARR=""
"RTN","GMTSPXOP",78,0)
 . S:$G(GMPXNARR)'="N" GMTSNARR=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN,"N"))
"RTN","GMTSPXOP",79,0)
 . I $P(GMTSICD,"-",2,10)=$G(GMTSNARR) S GMTSNARR=""
"RTN","GMTSPXOP",80,0)
 . S GMTSPRI="" I $P(GMTSN,U,5)]"",$E($P(GMTSN,U,5),1)="P" S GMTSPRI=" (P)"
"RTN","GMTSPXOP",81,0)
 . D TXTFMT^GMTSPXU1(GMTSICD,$G(GMTSNARR),GMTSICL,GMTAB,DIWL,GMTSQTY,GMTSPRI)
"RTN","GMTSPXOP",82,0)
 . I '$D(^UTILITY($J,"W")) Q
"RTN","GMTSPXOP",83,0)
 . S GMTSX=0
"RTN","GMTSPXOP",84,0)
 . F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0!$D(GMTSQIT)  D
"RTN","GMTSPXOP",85,0)
 . . I GMCKP>0 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS
"RTN","GMTSPXOP",86,0)
 . . S GMCKP=1
"RTN","GMTSPXOP",87,0)
 . . W ?GMTSICL+$S(GMTSX>1:GMTAB,1:0),$G(^UTILITY($J,"W",DIWL,GMTSX,0)),!
"RTN","GMTSPXOP",88,0)
 . S COMMENT="",COMMENT=$P($G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"D",GMTSPDN,"COM")),U)
"RTN","GMTSPXOP",89,0)
 . I COMMENT]"" S GMICL=20,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",90,0)
 . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXOP",91,0)
 Q
"RTN","GMTSPXOP",92,0)
DSPCPT ; Display Procedures performed during the visit
"RTN","GMTSPXOP",93,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",""))=""
"RTN","GMTSPXOP",94,0)
 N GMTSNARR,GMTSPDN,GMTSN,GMTSICD,GMTSNARR,GMTSCPT,GMTSQTY,GMTSPRIM,GMTSPRI
"RTN","GMTSPXOP",95,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3,"Procedure:"
"RTN","GMTSPXOP",96,0)
 S GMCKP=0,GMTSPDN="",GMTSPRI=""
"RTN","GMTSPXOP",97,0)
 F  S GMTSPDN=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN)) Q:GMTSPDN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",98,0)
 . S GMTSN=$G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN))
"RTN","GMTSPXOP",99,0)
 . S GMTSNARR=$P(GMTSN,U,2),GMTSQTY=$P(GMTSN,U,3),GMTSPRIM=$P(GMTSN,U,4)
"RTN","GMTSPXOP",100,0)
 . S GMTSCPT=$$GETCPT^GMTSPXU1($P(GMTSN,U)) I $P(GMTSCPT,"-",2,10)=GMTSNARR S GMTSNARR=""
"RTN","GMTSPXOP",101,0)
 . S GMTSPRI="" S:$G(GMTSQTY)]"" GMTSQTY=" ("_GMTSQTY_")" S:$G(GMTSPRIM)="Y" GMTSPRI="(P)"
"RTN","GMTSPXOP",102,0)
 . D TXTFMT^GMTSPXU1(GMTSCPT,GMTSNARR,GMTSICL,GMTAB,DIWL,GMTSQTY,GMTSPRI)
"RTN","GMTSPXOP",103,0)
 . Q:'$D(^UTILITY($J,"W"))  D DCPT
"RTN","GMTSPXOP",104,0)
 Q
"RTN","GMTSPXOP",105,0)
DCPT ; Display CPT Comments
"RTN","GMTSPXOP",106,0)
 N GMTSLN,GMTSMOK,GMTSX S (GMTSMOK,GMTSX)=0
"RTN","GMTSPXOP",107,0)
 F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",108,0)
 . I GMCKP>0 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS Q:$D(GMTSQIT)
"RTN","GMTSPXOP",109,0)
 . S (GMTSMOK,GMCKP)=1 W ?GMTSICL+$S(GMTSX>1:GMTAB,1:0)
"RTN","GMTSPXOP",110,0)
 . W $G(^UTILITY($J,"W",DIWL,GMTSX,0))
"RTN","GMTSPXOP",111,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPXOP",112,0)
 Q:DTYPE="DP"
"RTN","GMTSPXOP",113,0)
 S COMMENT=$P($G(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN,"COM")),U)
"RTN","GMTSPXOP",114,0)
 I COMMENT]"" W !,COMMENT,! S GMICL=20,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",115,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXOP",116,0)
 S:+($G(GMTSCPTM))=0 GMTSMOK=0 D:GMTSMOK DMOD
"RTN","GMTSPXOP",117,0)
 Q
"RTN","GMTSPXOP",118,0)
DMOD ; Display CPT Modifier Comments
"RTN","GMTSPXOP",119,0)
 N GMTSM S GMTSM=0
"RTN","GMTSPXOP",120,0)
 F  S GMTSM=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"C",GMTSPDN,GMTSM)) Q:+GMTSM=0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXOP",121,0)
 . N COMMENT S COMMENT=$$FCM(+GMTSM) Q:'$L(COMMENT)
"RTN","GMTSPXOP",122,0)
 . S GMICL=26,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXOP",123,0)
 . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE2 Q:$D(GMTSQIT)
"RTN","GMTSPXOP",124,0)
 Q
"RTN","GMTSPXOP",125,0)
DSPPROV ; Display Providers for visit
"RTN","GMTSPXOP",126,0)
 Q:$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"P",""))=""
"RTN","GMTSPXOP",127,0)
 N GMCNT,GMPROV
"RTN","GMTSPXOP",128,0)
 D ORDERPRO^GMTSPXU1(.GMPROV,20)
"RTN","GMTSPXOP",129,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS W ?3," Provider:"
"RTN","GMTSPXOP",130,0)
 S GMCNT=0
"RTN","GMTSPXOP",131,0)
 F  S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0  D  Q:GMCNT'>0!$D(GMTSQIT)
"RTN","GMTSPXOP",132,0)
 . I GMCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  D DSPVIS
"RTN","GMTSPXOP",133,0)
 . W ?GMTSICL,GMPROV(GMCNT) S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0
"RTN","GMTSPXOP",134,0)
 . W ?37,GMPROV(GMCNT) S GMCNT=$O(GMPROV(GMCNT)) Q:GMCNT'>0
"RTN","GMTSPXOP",135,0)
 . W ?60,GMPROV(GMCNT)
"RTN","GMTSPXOP",136,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W:$O(GMPROV(GMCNT)) !
"RTN","GMTSPXOP",137,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPXOP",138,0)
 Q
"RTN","GMTSPXOP",139,0)
DSPVIS ; Display outpatient visit data
"RTN","GMTSPXOP",140,0)
 Q:GMTSNPG'>0&(GMTSDTU>0)  D:GMTSNPG HDR I GMTSNPG!(+GMTSDTU'>0) D
"RTN","GMTSPXOP",141,0)
 . W GMTSDAT,?14,GMTSITE,?29,GMTSLOC,?61,GMTSELIG
"RTN","GMTSPXOP",142,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPXOP",143,0)
 . S GMTSDTU=1
"RTN","GMTSPXOP",144,0)
 Q
"RTN","GMTSPXOP",145,0)
HDR ; Display header
"RTN","GMTSPXOP",146,0)
 W ?3,"Date",?14,"Facility",?29,"Hospital Location",?61,"Encounter Elig.",!!
"RTN","GMTSPXOP",147,0)
 Q
"RTN","GMTSPXOP",148,0)
FORMAT ; Formats Diagnosis/Procedure line of text
"RTN","GMTSPXOP",149,0)
 N DIWR,DIWF,X S DIWL=3,DIWR=80-(GMICL+GMTAB) K ^UTILITY($J,"W") S X=COMMENT D ^DIWP
"RTN","GMTSPXOP",150,0)
 Q
"RTN","GMTSPXOP",151,0)
FCM(X) ; Format CPT Modifier comment
"RTN","GMTSPXOP",152,0)
 N Y,%,%H,GMTSIEN,GMTSC,GMTSS,GMTST S GMTSIEN=+($G(X)) Q:GMTSIEN=0 ""
"RTN","GMTSPXOP",153,0)
 S:'$D(DT)!(+($G(DT))=0) DT=$$DT^XLFDT
"RTN","GMTSPXOP",154,0)
 S X=$$MOD^ICPTMOD(GMTSIEN,"I",)
"RTN","GMTSPXOP",155,0)
 S GMTSC=$P(X,"^",2),GMTSS=$P(X,"^",3)
"RTN","GMTSPXOP",156,0)
 S GMTST=$$EN2^GMTSUMX(GMTSS) S Y=""
"RTN","GMTSPXOP",157,0)
 S:$L(GMTST)&($L(GMTSC)) Y=GMTSC_"-"_GMTST
"RTN","GMTSPXOP",158,0)
 S:'$L(GMTST)&($L(GMTSS))&($L(GMTSC)) Y=GMTSC_"-"_GMTSS
"RTN","GMTSPXOP",159,0)
 S:'$L(GMTST)&('$L(GMTSS))&($L(GMTSC)) Y=GMTSC
"RTN","GMTSPXOP",160,0)
 S:Y["-" Y="Modifier "_Y S X=Y
"RTN","GMTSPXOP",161,0)
 Q X
"RTN","GMTSPXOP",162,0)
LINE ; Writes formatted lines
"RTN","GMTSPXOP",163,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,^UTILITY($J,"W",DIWL,GMTSLN,0),! Q
"RTN","GMTSPXOP",164,0)
LINE2 ; Writes indented formatted lines
"RTN","GMTSPXOP",165,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  N GMTST S GMTST=20 S:+($G(GMTSLN))>1 GMTST=31 W ?GMTST,^UTILITY($J,"W",DIWL,GMTSLN,0),! Q
"RTN","GMTSRAE")
0^47^B54499362
"RTN","GMTSRAE",1,0)
GMTSRAE ;SLC/JER HIN/GJC Selected Radiology Extract ; 09/21/2001
"RTN","GMTSRAE",2,0)
 ;;2.7;Health Summary;**14,25,30,37,40,47**;Oct 20, 1995
"RTN","GMTSRAE",3,0)
 ;
"RTN","GMTSRAE",4,0)
 ; External References
"RTN","GMTSRAE",5,0)
 ;   DBIA  3125  ^RADPT( file 70
"RTN","GMTSRAE",6,0)
 ;   DBIA   501  ^RARPT( file 74, fields 5, 200, 300 and 400
"RTN","GMTSRAE",7,0)
 ;   DBIA  3417  ^RA(72, file 72, field 3 pending
"RTN","GMTSRAE",8,0)
 ;   DBIA   502  ^RAMIS(71, file 71, field 9
"RTN","GMTSRAE",9,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMTSRAE",10,0)
 ;   DBIA  2056  $$GET1^DIQ (files 71, 72, and 74)
"RTN","GMTSRAE",11,0)
 ;   DBIA  2056  GETS^DIQ (file 70, subfile 70.03)
"RTN","GMTSRAE",12,0)
 ;   DBIA  1995  $$CPT^ICPTCOD
"RTN","GMTSRAE",13,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSRAE",14,0)
 ;   DBIA  1996  $$MOD^ICPTMOD
"RTN","GMTSRAE",15,0)
 ;   DBIA 10005  DT^DICRW
"RTN","GMTSRAE",16,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSRAE",17,0)
 ;                        
"RTN","GMTSRAE",18,0)
MAINSEL(MODE,TEST) ; Entry for Selection Items
"RTN","GMTSRAE",19,0)
 N GMTSIDT,GMTSIDT2,GMTSCNT,GMTSPN,GMTSMAX K ^TMP("RAE",$J) S GMTSCNT=0,GMTSMAX=$S(+$G(GMTSNDM)>0:GMTSNDM,1:999)
"RTN","GMTSRAE",20,0)
 S GMTSIDT=+GMTS1,GMTSIDT2=+($P(+GMTS2,".",1)) S:+($G(GMTSPXGO))=0 GMTSIDT=$P(GMTS1,".",1)+.76,GMTSIDT2=$P(GMTS2,".",1)
"RTN","GMTSRAE",21,0)
 F  S GMTSIDT=$O(^RADPT(DFN,"DT","AP",TEST,GMTSIDT)) Q:GMTSIDT'>0!(GMTSIDT>GMTSIDT2)!(GMTSCNT=GMTSMAX)  D
"RTN","GMTSRAE",22,0)
 . Q:'$D(^RADPT(DFN,"DT",GMTSIDT,0))  N GMTS7002,GMTSPSET,GMTSXSET
"RTN","GMTSRAE",23,0)
 . S GMTS7002=$G(^RADPT(DFN,"DT",GMTSIDT,0))
"RTN","GMTSRAE",24,0)
 . S GMTSXSET=+$P(GMTS7002,"^",5)
"RTN","GMTSRAE",25,0)
 . S GMTSPN=0 F  S GMTSPN=$O(^RADPT(DFN,"DT","AP",TEST,GMTSIDT,GMTSPN)) Q:GMTSPN'>0!(GMTSCNT=GMTSMAX)  D
"RTN","GMTSRAE",26,0)
 . . S GMTSCNT=GMTSCNT+1 D GET
"RTN","GMTSRAE",27,0)
 Q
"RTN","GMTSRAE",28,0)
MAIN(MODE) ; Main Entry
"RTN","GMTSRAE",29,0)
 N GMTSIDT,GMTSCNT,GMTSPN,GMTSMAX
"RTN","GMTSRAE",30,0)
 K ^TMP("RAE",$J) S GMTSCNT=0,GMTSMAX=$S(+$G(GMTSNDM)>0:GMTSNDM,1:999)
"RTN","GMTSRAE",31,0)
 S GMTSIDT=+GMTS1,GMTSIDT2=+($P(+GMTS2,".",1)) S:+($G(GMTSPXGO))=0 GMTSIDT=$P(GMTS1,".",1)+.76,GMTSIDT2=$P(GMTS2,".",1)
"RTN","GMTSRAE",32,0)
 F  S GMTSIDT=$O(^RADPT(DFN,"DT",GMTSIDT)) Q:GMTSIDT'>0!(GMTSIDT>GMTSIDT2)!(GMTSCNT=GMTSMAX)  D
"RTN","GMTSRAE",33,0)
 . Q:'$D(^RADPT(DFN,"DT",GMTSIDT,0))  N GMTS7002,GMTSPSET,GMTSXSET
"RTN","GMTSRAE",34,0)
 . S GMTS7002=$G(^RADPT(DFN,"DT",GMTSIDT,0))
"RTN","GMTSRAE",35,0)
 . S GMTSXSET=+$P(GMTS7002,"^",5)
"RTN","GMTSRAE",36,0)
 . S GMTSPN=0 F  S GMTSPN=$O(^RADPT(DFN,"DT",GMTSIDT,"P",GMTSPN)) Q:GMTSPN'>0!(+GMTSCNT'<GMTSMAX)  D
"RTN","GMTSRAE",37,0)
 . . S GMTSCNT=GMTSCNT+1 D GET
"RTN","GMTSRAE",38,0)
 Q
"RTN","GMTSRAE",39,0)
 ;                   
"RTN","GMTSRAE",40,0)
GET ; Gets data associated with study and sets global array
"RTN","GMTSRAE",41,0)
 ; ^TMP("RAE",$J, where:
"RTN","GMTSRAE",42,0)
 ;           
"RTN","GMTSRAE",43,0)
 ;    GMTSIDT = inverse exam date/time
"RTN","GMTSRAE",44,0)
 ;    GMTSPN  = Case IEN
"RTN","GMTSRAE",45,0)
 ;           
"RTN","GMTSRAE",46,0)
 ; ^TMP("RAE",$J,GMTSIDT,GMTSPN,0)= <exam date> ^ 
"RTN","GMTSRAE",47,0)
 ; <procedure> ^ <exam status> ^ <report status> ^ 
"RTN","GMTSRAE",48,0)
 ; <prim interpret resident> ^ <prim interpret staff> ^
"RTN","GMTSRAE",49,0)
 ; <CPT code> ^ <technologist> ^ <case number> ^
"RTN","GMTSRAE",50,0)
 ; < exam status order >
"RTN","GMTSRAE",51,0)
 ;           
"RTN","GMTSRAE",52,0)
 ; ^TMP("RAE",$J,GMTSIDT,"EXAMSET") Indicates if all 
"RTN","GMTSRAE",53,0)
 ; exams for this date/time are part of an exam set
"RTN","GMTSRAE",54,0)
 ;           
"RTN","GMTSRAE",55,0)
 ; ^TMP("RAE",$J,GMTSIDT,"PRINTSET") Indicates if all 
"RTN","GMTSRAE",56,0)
 ; exams for this exam set share the same report
"RTN","GMTSRAE",57,0)
 ;           
"RTN","GMTSRAE",58,0)
 ; Only if the report is verified -OR- released will 
"RTN","GMTSRAE",59,0)
 ; these nodes be set
"RTN","GMTSRAE",60,0)
 ;                  
"RTN","GMTSRAE",61,0)
 ; ^TMP("RAE",$J,IDT,PN,"D",seq #) = Dx codes
"RTN","GMTSRAE",62,0)
 ;     Sequence # = 1   Primary Dx
"RTN","GMTSRAE",63,0)
 ;     Sequence # > 1   Secondary Dx
"RTN","GMTSRAE",64,0)
 ; ^TMP("RAE",$J,IDT,PN,"H",line #)= Clinical History line #
"RTN","GMTSRAE",65,0)
 ; ^TMP("RAE",$J,IDT,PN,"I",line #)= Impression Text line #
"RTN","GMTSRAE",66,0)
 ; ^TMP("RAE",$J,IDT,PN,"R",line #)= Report Text line #
"RTN","GMTSRAE",67,0)
 ;           
"RTN","GMTSRAE",68,0)
 N DA,DIC,DIQ,%,D0,DIW,DIWI,DIWT,DIWTC,DIWX,DIWF,DIWL,DIWR,DN,DR
"RTN","GMTSRAE",69,0)
 N I,J,Y,Z,GMTSCPT,GMTSED,GMTSCN,GMTSRP,GMTSRPI,GMTSST,GMTSPTR
"RTN","GMTSRAE",70,0)
 N GMTSTA,GMTSTAI,GMTSI,GMTSRAD,GMTSRRAD,GMTSSRAD,GMTSTC,GMTSSTO
"RTN","GMTSRAE",71,0)
 S GMTSED=+$P(GMTS7002,"^")
"RTN","GMTSRAE",72,0)
 S:GMTSXSET&('$D(^TMP("RAE",$J,GMTSIDT,"EXAMSET"))) ^TMP("RAE",$J,GMTSIDT,"EXAMSET")=""
"RTN","GMTSRAE",73,0)
 ;   Get
"RTN","GMTSRAE",74,0)
 ;     Exam Date    $P($G(^RADPT(DFN,"DT",GMTSIDT,0)),"^",1)
"RTN","GMTSRAE",75,0)
 ;     Exam Set     $P($G(^RADPT(DFN,"DT",GMTSIDT,0)),"^",5)
"RTN","GMTSRAE",76,0)
 ;     Case Number             70.03   .01   GMTSCN
"RTN","GMTSRAE",77,0)
 ;     Procedure               70.03    2    GMTSRP/GMTSRPI
"RTN","GMTSRAE",78,0)
 ;     Exam Status             70.03    3    GMTSST
"RTN","GMTSRAE",79,0)
 ;     Prim Interpret Resident 70.03   12    GMTSRRAD
"RTN","GMTSRAE",80,0)
 ;     Prim Diagnostic Code    70.03   13    GMTSDX
"RTN","GMTSRAE",81,0)
 ;     Prim Interpreting Staff 70.03   15    GMTSSRAD
"RTN","GMTSRAE",82,0)
 ;     Report Text             70.03   17    
"RTN","GMTSRAE",83,0)
 ;     Member of Set           70.03   25
"RTN","GMTSRAE",84,0)
 ;     Exam Status Order       72       3    GMTSSTO
"RTN","GMTSRAE",85,0)
 ;           
"RTN","GMTSRAE",86,0)
 S DIC="^RADPT("_DFN_",""DT"","_GMTSIDT_",""P"",",DA=GMTSPN,DIQ="GMTSRAD("
"RTN","GMTSRAE",87,0)
 S DIQ(0)="IE",DR=".01;2;3;12;13;15;17;25" D TECH
"RTN","GMTSRAE",88,0)
 D EN^DIQ1
"RTN","GMTSRAE",89,0)
 S GMTSCN=$G(GMTSRAD(70.03,GMTSPN,.01,"E"))
"RTN","GMTSRAE",90,0)
 S GMTSRP=$G(GMTSRAD(70.03,GMTSPN,2,"E"))
"RTN","GMTSRAE",91,0)
 S GMTSRPI=$G(GMTSRAD(70.03,GMTSPN,2,"I"))
"RTN","GMTSRAE",92,0)
 S GMTSST=$G(GMTSRAD(70.03,GMTSPN,3,"E"))
"RTN","GMTSRAE",93,0)
 S GMTSSTO=$G(GMTSRAD(70.03,GMTSPN,3,"I"))
"RTN","GMTSRAE",94,0)
 S GMTSSTO=$$GET1^DIQ(72,+GMTSSTO,3,"I")
"RTN","GMTSRAE",95,0)
 I GMTSTC S GMTSTC(0)=$E($G(GMTSRAD(70.12,GMTSTC,.01,"E")),1,18)
"RTN","GMTSRAE",96,0)
 S GMTSRRAD=$E($G(GMTSRAD(70.03,GMTSPN,12,"E")),1,18)
"RTN","GMTSRAE",97,0)
 S GMTSSRAD=$E($G(GMTSRAD(70.03,GMTSPN,15,"E")),1,18)
"RTN","GMTSRAE",98,0)
 S GMTSPTR=$G(GMTSRAD(70.03,GMTSPN,17,"I"))
"RTN","GMTSRAE",99,0)
 ; Exam Set/Report
"RTN","GMTSRAE",100,0)
 ;           
"RTN","GMTSRAE",101,0)
 ;     If GMTSPSET = ""   single exam
"RTN","GMTSRAE",102,0)
 ;     If GMTSPSET = 1    exam set, single report
"RTN","GMTSRAE",103,0)
 ;     If GMTSPSET = 2    exam set, combined report
"RTN","GMTSRAE",104,0)
 ;           
"RTN","GMTSRAE",105,0)
 S GMTSPSET=$G(GMTSRAD(70.03,GMTSPN,25,"I"))
"RTN","GMTSRAE",106,0)
 D PMOD,CMOD I +GMTSPTR>0 S DIC="^RARPT(",DA=GMTSPTR,DIQ="GMTSRAD(",DIQ(0)="IE",DR="5" D EN^DIQ1
"RTN","GMTSRAE",107,0)
 S GMTSTA=$G(GMTSRAD(74,+GMTSPTR,5,"E"))
"RTN","GMTSRAE",108,0)
 S GMTSTAI=$G(GMTSRAD(74,+GMTSPTR,5,"I"))
"RTN","GMTSRAE",109,0)
 I $L(GMTSTAI),("VR"[$E(GMTSTAI)) D GETDX(GMTSPN_","_GMTSIDT_","_DFN_",")
"RTN","GMTSRAE",110,0)
 S GMTSCPT=$$GET1^DIQ(71,+GMTSRPI,9,"I")
"RTN","GMTSRAE",111,0)
 S GMTSCPT=$S(+GMTSCPT>0:$P($$CPT^ICPTCOD(+GMTSCPT),"^",2),1:"")
"RTN","GMTSRAE",112,0)
 S ^TMP("RAE",$J,GMTSIDT,GMTSPN,0)=GMTSED_U_GMTSRP_U_GMTSST_U_GMTSTA_U_GMTSRRAD_U_GMTSSRAD_U_GMTSCPT_U_$G(GMTSTC(0))_U_GMTSCN_U_$G(GMTSSTO)
"RTN","GMTSRAE",113,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSRAD(70.1,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSRAE",114,0)
 . S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"M",GMTSI)=$G(GMTSRAD(70.1,GMTSI,.01,"E"))
"RTN","GMTSRAE",115,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSRAD(70.1,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSRAE",116,0)
 . S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"M",GMTSI)=$G(GMTSRAD(70.1,GMTSI,.01,"E"))
"RTN","GMTSRAE",117,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSRAD(70.3135,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSRAE",118,0)
 . Q:'$L($G(GMTSRAD(70.3135,GMTSI,.01,"M")))  Q:'$L($G(GMTSRAD(70.3135,GMTSI,.01,"N")))  N I S I=+($G(^TMP("RAE",$J,GMTSIDT,GMTSPN,"CM",0)))+1
"RTN","GMTSRAE",119,0)
 . S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"CM",I)=$G(GMTSRAD(70.3135,GMTSI,.01,"M"))_"^"_$$UP^XLFSTR($G(GMTSRAD(70.3135,GMTSI,.01,"N")))_"^"_$G(GMTSRAD(70.3135,GMTSI,.01,"N")),^TMP("RAE",$J,GMTSIDT,GMTSPN,"CM",0)=I
"RTN","GMTSRAE",120,0)
 ;   Only verified reports can be printed
"RTN","GMTSRAE",121,0)
 I GMTSTAI'="V",($E(IOST)="P") D  Q
"RTN","GMTSRAE",122,0)
 . S:GMTSPSET=2 ^TMP("RAE",$J,GMTSIDT,"PRINTSET")=""
"RTN","GMTSRAE",123,0)
 ;   Only verified & Released/Unverified can viewed
"RTN","GMTSRAE",124,0)
 I $S(GMTSTAI="V":0,GMTSTAI="R":0,1:1) D  Q
"RTN","GMTSRAE",125,0)
 . S:GMTSPSET=2 ^TMP("RAE",$J,GMTSIDT,"PRINTSET")=""
"RTN","GMTSRAE",126,0)
 Q:$D(^TMP("RAE",$J,GMTSIDT,"PRINTSET"))
"RTN","GMTSRAE",127,0)
 D GETIMP D:$G(MODE)=2 GETHIS,GETREP
"RTN","GMTSRAE",128,0)
 S:GMTSPSET=2 ^TMP("RAE",$J,GMTSIDT,"PRINTSET")=""
"RTN","GMTSRAE",129,0)
 Q
"RTN","GMTSRAE",130,0)
 ;           
"RTN","GMTSRAE",131,0)
GETIMP ; Gets Radiologist's Impression
"RTN","GMTSRAE",132,0)
 N X,GMTSLN S X=$$GET1^DIQ(74,GMTSPTR,300,,"GMTST")
"RTN","GMTSRAE",133,0)
 K ^UTILITY($J,"W") N X,GMTSI S GMTSI=0 F  S GMTSI=$O(GMTST(GMTSI)) Q:+GMTSI=0  S X=$G(GMTST(GMTSI)) D FORMAT
"RTN","GMTSRAE",134,0)
 I $D(^UTILITY($J,"W")) F GMTSLN=1:1:^UTILITY($J,"W",3) S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"I",GMTSLN)=^UTILITY($J,"W",3,GMTSLN,0)
"RTN","GMTSRAE",135,0)
 K ^UTILITY($J,"W"),GMTST Q
"RTN","GMTSRAE",136,0)
GETHIS ; Gets Clinical History
"RTN","GMTSRAE",137,0)
 N X,GMTSLN S X=$$GET1^DIQ(74,GMTSPTR,400,,"GMTST")
"RTN","GMTSRAE",138,0)
 K ^UTILITY($J,"W") N X,GMTSI S GMTSI=0 F  S GMTSI=$O(GMTST(GMTSI)) Q:+GMTSI=0  S X=$G(GMTST(GMTSI)) D FORMAT
"RTN","GMTSRAE",139,0)
 I $D(^UTILITY($J,"W")) F GMTSLN=1:1:^UTILITY($J,"W",3) S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"H",GMTSLN)=^UTILITY($J,"W",3,GMTSLN,0)
"RTN","GMTSRAE",140,0)
 K ^UTILITY($J,"W"),GMTST Q
"RTN","GMTSRAE",141,0)
GETREP ; Gets Radiologist's Report
"RTN","GMTSRAE",142,0)
 N X,GMTSLN S X=$$GET1^DIQ(74,GMTSPTR,200,,"GMTST")
"RTN","GMTSRAE",143,0)
 K ^UTILITY($J,"W") N X,I S GMTSI=0 F  S GMTSI=$O(GMTST(GMTSI)) Q:+GMTSI=0  S X=$G(GMTST(GMTSI)) D FORMAT
"RTN","GMTSRAE",144,0)
 I $D(^UTILITY($J,"W")) F GMTSLN=1:1:^UTILITY($J,"W",3) S ^TMP("RAE",$J,GMTSIDT,GMTSPN,"R",GMTSLN)=^UTILITY($J,"W",3,GMTSLN,0)
"RTN","GMTSRAE",145,0)
 K ^UTILITY($J,"W"),GMTST Q
"RTN","GMTSRAE",146,0)
PMOD ; Procedure Modifiers
"RTN","GMTSRAE",147,0)
 N GMTS,GMTSI S GMTS=$G(DIC) Q:'$L(DIC)  S GMTSI=+($G(DA)) Q:+GMTSI=0
"RTN","GMTSRAE",148,0)
 N DIC,DA,DR S DIC=GMTS_GMTSI_",""M"","
"RTN","GMTSRAE",149,0)
 S DA=0 F  S DA=$O(@(DIC_DA_")")) Q:+DA'>0  S DR=".01" D
"RTN","GMTSRAE",150,0)
 . D EN^DIQ1
"RTN","GMTSRAE",151,0)
 Q
"RTN","GMTSRAE",152,0)
CMOD ; CPT Modifiers
"RTN","GMTSRAE",153,0)
 N GMTS,GMTSI,GMTSC,GMTSCM,GMTSCN S GMTS=$G(DIC) Q:'$L(DIC)  S GMTSI=+($G(DA)) Q:+GMTSI=0
"RTN","GMTSRAE",154,0)
 D DT^DICRW N DIC,DA,DR S DIC=GMTS_GMTSI_",""CMOD"","
"RTN","GMTSRAE",155,0)
 S DA=0 F  S DA=$O(@(DIC_DA_")")) Q:+DA'>0  S DR=".01" D EN^DIQ1
"RTN","GMTSRAE",156,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSRAD(70.3135,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRAE",157,0)
 . S GMTSC=$G(GMTSRAD(70.3135,GMTSI,.01,"I")) Q:+GMTSC=0
"RTN","GMTSRAE",158,0)
 . S GMTSCM=$$MOD^ICPTMOD(GMTSC,"I",)
"RTN","GMTSRAE",159,0)
 . S GMTSCN=$P(GMTSCM,"^",3),GMTSCM=$P(GMTSCM,"^",2)
"RTN","GMTSRAE",160,0)
 . S GMTSRAD(70.3135,GMTSI,.01,"M")=GMTSCM
"RTN","GMTSRAE",161,0)
 . S GMTSRAD(70.3135,GMTSI,.01,"N")=$$EN2^GMTSUMX(GMTSCN)
"RTN","GMTSRAE",162,0)
 Q
"RTN","GMTSRAE",163,0)
TECH ; Technician
"RTN","GMTSRAE",164,0)
 S GMTSTC=+$O(^RADPT(DFN,"DT",GMTSIDT,"P",GMTSPN,"TC",0))
"RTN","GMTSRAE",165,0)
 I GMTSTC S DR=$G(DR)_";175",DR(70.12)=.01,DA(70.12)=GMTSTC F  Q:$E(DR,1)'=";"  S DR=$E(DR,2,$L(DR))
"RTN","GMTSRAE",166,0)
 Q
"RTN","GMTSRAE",167,0)
FORMAT ; Calls ^DIWP to format each line of text
"RTN","GMTSRAE",168,0)
 N DIWL,DIWR,DIWF S DIWL=3,DIWR=($S(MODE=1:76,1:80))
"RTN","GMTSRAE",169,0)
 D ^DIWP Q
"RTN","GMTSRAE",170,0)
 ;               
"RTN","GMTSRAE",171,0)
GETDX(GMTSIEN) ; Set the data node with diagnostic code info.
"RTN","GMTSRAE",172,0)
 ;              
"RTN","GMTSRAE",173,0)
 ; Input:  GMTSIEN = Case IEN_","_exam date_","_DFN_","
"RTN","GMTSRAE",174,0)
 ; Output: ^TMP("RAE",$J,GMTSIDT,GMTSPN,"D",seq #) = Dx codes
"RTN","GMTSRAE",175,0)
 ;           
"RTN","GMTSRAE",176,0)
 ; Sequence # = 1   Primary Dx
"RTN","GMTSRAE",177,0)
 ; Sequence # > 1   Secondary Dx
"RTN","GMTSRAE",178,0)
 S ^TMP("RAE",$J,$P(GMTSIEN,",",2),$P(GMTSIEN,","),"D",1)=$G(GMTSRAD(70.03,$P(GMTSIEN,","),13,"E"))
"RTN","GMTSRAE",179,0)
 N GMTSI,GMTSII,GMTSDX S GMTSI=1 D GETS^DIQ(70.03,GMTSIEN,"13.1*","E","GMTSDX")
"RTN","GMTSRAE",180,0)
 S GMTSII="" F  S GMTSII=$O(GMTSDX(70.14,GMTSII)) Q:GMTSII=""  D
"RTN","GMTSRAE",181,0)
 . S GMTSI=GMTSI+1 S ^TMP("RAE",$J,$P(GMTSIEN,",",2),$P(GMTSIEN,","),"D",GMTSI)=$G(GMTSDX(70.14,GMTSII,.01,"E"))
"RTN","GMTSRAE",182,0)
 Q
"RTN","GMTSRAI")
0^1^B8075283
"RTN","GMTSRAI",1,0)
GMTSRAI ; SLC/JER,KER - Radiology Impression Comp       ; 09/21/2001
"RTN","GMTSRAI",2,0)
 ;;2.7;Health Summary;**28,37,47**;Oct 20, 1995
"RTN","GMTSRAI",3,0)
 ;
"RTN","GMTSRAI",4,0)
 ; External References
"RTN","GMTSRAI",5,0)
 ;   DBIA  3125  ^RADPT( file 70
"RTN","GMTSRAI",6,0)
 ;   DBIA  2056  $$GET1^DIQ (file 70)
"RTN","GMTSRAI",7,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSRAI",8,0)
 ;                        
"RTN","GMTSRAI",9,0)
ENSRA ; Controls branching
"RTN","GMTSRAI",10,0)
 Q:+($G(DFN))=0  Q:+($G(DFN))'=+($$RP(+($G(DFN))))
"RTN","GMTSRAI",11,0)
 K ^TMP("RAE",$J)
"RTN","GMTSRAI",12,0)
 N GMDATA,GMTSCP D MAIN^GMTSRAE(1) Q:'$D(^TMP("RAE",$J))
"RTN","GMTSRAI",13,0)
 D LOOP K ^TMP("RAE",$J)
"RTN","GMTSRAI",14,0)
 Q
"RTN","GMTSRAI",15,0)
LOOP ; Loops through ^TMP("RAE",$J,
"RTN","GMTSRAI",16,0)
 N GMTSIDT,GMTSPN,GMTSPC S (GMTSIDT,GMTSPC)=0 F  S GMTSIDT=$O(^TMP("RAE",$J,GMTSIDT)) Q:GMTSIDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSRAI",17,0)
 . S GMTSPN=0 F  S GMTSPN=$O(^TMP("RAE",$J,GMTSIDT,GMTSPN)) Q:GMTSPN'>0  D WRT  Q:$D(GMTSQIT)
"RTN","GMTSRAI",18,0)
 Q
"RTN","GMTSRAI",19,0)
WRT ; Writes component data
"RTN","GMTSRAI",20,0)
 Q:$D(GMTSQIT)  N X,GMTSEDT S GMDATA=1,X=+^TMP("RAE",$J,GMTSIDT,GMTSPN,0) D REGDT4^GMTSU S GMTSEDT=X
"RTN","GMTSRAI",21,0)
 D HD S GMTSPC=+($G(GMTSCP))+1 Q:$D(GMTSQIT)  D HD Q:$D(GMTSQIT)  W GMTSEDT D PRO,IMP Q
"RTN","GMTSRAI",22,0)
 Q
"RTN","GMTSRAI",23,0)
PRO ; Procedure
"RTN","GMTSRAI",24,0)
 N GMTSPRO,GMTSEST,GMTSTA,GMTSCPT,GMTSI,GMTSCN
"RTN","GMTSRAI",25,0)
 S GMTSPRO=$P(^TMP("RAE",$J,GMTSIDT,GMTSPN,0),"^",2),GMTSEST=$P(^(0),"^",3),GMTSTA=$P(^(0),"^",4),GMTSCPT=$P(^(0),"^",7),GMTSCN=$P(^(0),"^",9)
"RTN","GMTSRAI",26,0)
 S GMTSTA=$S(GMTSTA="RELEASED/NOT VERIFIED":"REL/NOT VER",GMTSTA="PROBLEM DRAFT":"PROB DRAFT",1:GMTSTA)
"RTN","GMTSRAI",27,0)
 S GMTSTA=$S(GMTSEST["CANCEL":"CANCELLED",1:GMTSTA)
"RTN","GMTSRAI",28,0)
 S GMTSTA=$$EN2^GMTSUMX(GMTSTA)
"RTN","GMTSRAI",29,0)
 I $L(GMTSPRO)>31 S GMTSPRO=$$WRAP^GMTSORC(GMTSPRO,31)
"RTN","GMTSRAI",30,0)
 D HD Q:$D(GMTSQIT) 
"RTN","GMTSRAI",31,0)
 W ?12,$P(GMTSPRO,"|"),?46,GMTSCPT,?52,$E(GMTSTA,1,11),?64,$G(GMTSCN),!
"RTN","GMTSRAI",32,0)
 F GMTSI=2:1:$L(GMTSPRO,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRAI",33,0)
 . D HD Q:$D(GMTSQIT)  W:$P(GMTSPRO,"|",GMTSI)]"" ?14,$P(GMTSPRO,"|",GMTSI),!
"RTN","GMTSRAI",34,0)
 Q
"RTN","GMTSRAI",35,0)
IMP ; Impression
"RTN","GMTSRAI",36,0)
 Q:$D(GMTSQIT)  N GMTSI,GMTST,DIWF,DIWL,DIWR
"RTN","GMTSRAI",37,0)
 S GMTST=12 Q:'$D(^TMP("RAE",$J,GMTSIDT,GMTSPN,"I"))  K ^UTILITY($J,"W")
"RTN","GMTSRAI",38,0)
 S DIWF="C"_(78-GMTST),DIWL=0,DIWR=0,GMTSI=0
"RTN","GMTSRAI",39,0)
 F  S GMTSI=$O(^TMP("RAE",$J,GMTSIDT,GMTSPN,"I",GMTSI)) Q:+GMTSI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSRAI",40,0)
 . S X=$G(^TMP("RAE",$J,GMTSIDT,GMTSPN,"I",GMTSI)) D ^DIWP
"RTN","GMTSRAI",41,0)
 S GMTSI=0 F  S GMTSI=$O(^UTILITY($J,"W",0,GMTSI)) Q:+GMTSI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSRAI",42,0)
 . D HD Q:$D(GMTSQIT)  W ?GMTST,$G(^UTILITY($J,"W",0,GMTSI,0)),!
"RTN","GMTSRAI",43,0)
 K ^UTILITY($J,"W")
"RTN","GMTSRAI",44,0)
 Q
"RTN","GMTSRAI",45,0)
HD ; Header/Page Check
"RTN","GMTSRAI",46,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  Q:+($G(GMTSNPG))=0&(+($G(GMTSPC))>0)
"RTN","GMTSRAI",47,0)
 W "Date",?12,"Procedure",?46,"CPT",?52,"Status",?64,"Case #",!
"RTN","GMTSRAI",48,0)
 Q
"RTN","GMTSRAI",49,0)
RP(X) ; Radiology Patient
"RTN","GMTSRAI",50,0)
 N Y S X=+($G(X)) S Y=$$GET1^DIQ(70,X,.01,"I") S X=Y Q X
"RTN","GMTSRAS")
0^46^B43059243
"RTN","GMTSRAS",1,0)
GMTSRAS ; SLC/JER,KER HIN/GJC - Radiology Profile       ; 09/21/2001
"RTN","GMTSRAS",2,0)
 ;;2.7;Health Summary;**14,25,28,37,47**;Oct 20, 1995
"RTN","GMTSRAS",3,0)
 ;              
"RTN","GMTSRAS",4,0)
 ; External References
"RTN","GMTSRAS",5,0)
 ;   DBIA  3125  ^RADPT( file 70
"RTN","GMTSRAS",6,0)
 ;   DBIA  2056  $$GET1^DIQ (file 70)
"RTN","GMTSRAS",7,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSRAS",8,0)
 ;                        
"RTN","GMTSRAS",9,0)
ENSRA ; Controls branching
"RTN","GMTSRAS",10,0)
 Q:+($G(DFN))=0  Q:+($G(DFN))'=+($$RP(+($G(DFN))))
"RTN","GMTSRAS",11,0)
 N GMDATA D MAIN^GMTSRAE(2) Q:'$D(^TMP("RAE",$J))
"RTN","GMTSRAS",12,0)
 D LOOP K ^TMP("RAE",$J) Q
"RTN","GMTSRAS",13,0)
LOOP ; Loops through ^TMP("RAE",$J,
"RTN","GMTSRAS",14,0)
 N GMW,GMTSORD,GMTSIDT,GMTSPN,GMLN,GMPSET,GMXSET S GMTSIDT=0
"RTN","GMTSRAS",15,0)
 F  S GMTSIDT=$O(^TMP("RAE",$J,GMTSIDT)) Q:GMTSIDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSRAS",16,0)
 . S GMPSET=$S($D(^TMP("RAE",$J,GMTSIDT,"PRINTSET")):1,1:0)
"RTN","GMTSRAS",17,0)
 . S GMXSET=$S($D(^TMP("RAE",$J,GMTSIDT,"EXAMSET")):1,1:0)
"RTN","GMTSRAS",18,0)
 . S GMTSPN=0 F  S GMTSPN=$O(^TMP("RAE",$J,GMTSIDT,GMTSPN)) Q:GMTSPN'>0  D
"RTN","GMTSRAS",19,0)
 . . S GMTSORD=+($P($G(^TMP("RAE",$J,GMTSIDT,GMTSPN,0)),"^",10))
"RTN","GMTSRAS",20,0)
 . . D WRT D:+$O(^TMP("RAE",$J,GMTSIDT,GMTSPN)) BL Q:$D(GMTSQIT)
"RTN","GMTSRAS",21,0)
 . D:+$O(^TMP("RAE",$J,GMTSIDT)) BL Q:$D(GMTSQIT)
"RTN","GMTSRAS",22,0)
 Q
"RTN","GMTSRAS",23,0)
WRT ; Writes component data
"RTN","GMTSRAS",24,0)
 Q:$D(GMTSQIT)  N X,GMI,GMTMP S GMDATA=1,GMTMP=$G(^TMP("RAE",$J,GMTSIDT,GMTSPN,0))
"RTN","GMTSRAS",25,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",26,0)
 D DAT,PRO D:'GMPSET SSET D:GMPSET PSET
"RTN","GMTSRAS",27,0)
 Q
"RTN","GMTSRAS",28,0)
 ;            
"RTN","GMTSRAS",29,0)
SSET ; Output for Non-Printsets (single exam) (GMPSET=0)
"RTN","GMTSRAS",30,0)
 ;               
"RTN","GMTSRAS",31,0)
 ;  Procedure Modifiers, Procedure Status, 
"RTN","GMTSRAS",32,0)
 ;  CPT Code, CPT Modifiers, Interpreting Staff,
"RTN","GMTSRAS",33,0)
 ;  Interpreting Resident, Report Status, 
"RTN","GMTSRAS",34,0)
 ;  Technologist, Report Text
"RTN","GMTSRAS",35,0)
 ;            
"RTN","GMTSRAS",36,0)
 D:$D(^TMP("RAE",$J,GMTSIDT,GMTSPN,"M")) PMD D CPT,CMD,INS,INR,CAS,EST,STT,RPT
"RTN","GMTSRAS",37,0)
 Q
"RTN","GMTSRAS",38,0)
PSET ; Output for Printsets (GMPSET=1)
"RTN","GMTSRAS",39,0)
 ;                
"RTN","GMTSRAS",40,0)
 ;  Procedure Modifiers, Procedure Status, 
"RTN","GMTSRAS",41,0)
 ;  CPT Code, CPT Modifier, Report Status, 
"RTN","GMTSRAS",42,0)
 ;  Technologist
"RTN","GMTSRAS",43,0)
 ;            
"RTN","GMTSRAS",44,0)
 D:$D(^TMP("RAE",$J,GMTSIDT,GMTSPN,"M")) PMD D CPT,CMD
"RTN","GMTSRAS",45,0)
 D:'+$O(^TMP("RAE",$J,GMTSIDT,GMTSPN)) LSET
"RTN","GMTSRAS",46,0)
 Q
"RTN","GMTSRAS",47,0)
LSET ; Last Set/Case in Printset
"RTN","GMTSRAS",48,0)
 ;            
"RTN","GMTSRAS",49,0)
 ;  Interpreting Staff, Interpreting Resident, Report Status, 
"RTN","GMTSRAS",50,0)
 ;  Technologist, Report Text
"RTN","GMTSRAS",51,0)
 ;            
"RTN","GMTSRAS",52,0)
 D BL,INS,INR,CAS,EST,STT N GMTSPN S GMTSPN=$O(^TMP("RAE",$J,GMTSIDT,0)) D:GMTSPN RPT
"RTN","GMTSRAS",53,0)
 Q
"RTN","GMTSRAS",54,0)
 ; Data Elements
"RTN","GMTSRAS",55,0)
DAT ;   Date                                  +1
"RTN","GMTSRAS",56,0)
 Q:'$L($G(GMTMP))  Q:+($G(GMTMP))=0  Q:'$D(GMXSET)  Q:'$D(GMTSPN)  Q:+($G(GMTSIDT))=0
"RTN","GMTSRAS",57,0)
 N X,GMTSDT S X=+GMTMP D REGDT4^GMTSU S GMTSDT=X
"RTN","GMTSRAS",58,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:+($G(GMXSET))=0 GMTSDT
"RTN","GMTSRAS",59,0)
 W:(+($G(GMXSET))>0)&(GMTSPN=$O(^TMP("RAE",$J,GMTSIDT,0))) GMTSDT
"RTN","GMTSRAS",60,0)
 Q
"RTN","GMTSRAS",61,0)
PRO ;   Procedure                              2
"RTN","GMTSRAS",62,0)
 Q:'$L($G(GMTMP))  N GMTSA,GMTSB S GMTSA=$P($G(GMTMP),"^",2)
"RTN","GMTSRAS",63,0)
 S:$L(GMTSA)>65 GMTSA=$$WRAP^GMTSORC(GMTSA,65)
"RTN","GMTSRAS",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,$P(GMTSA,"|"),!
"RTN","GMTSRAS",65,0)
 F GMTSB=2:1:$L(GMTSA,"|") D  Q:$D(GMTSQIT) 
"RTN","GMTSRAS",66,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",67,0)
 . W:$P(GMTSA,"|",GMTSB)]"" ?23,$P(GMTSA,"|",GMTSB),!
"RTN","GMTSRAS",68,0)
 Q
"RTN","GMTSRAS",69,0)
CAS ;   Case Number                            9
"RTN","GMTSRAS",70,0)
 Q:'$L($G(GMTMP))  N GMTSA S GMTSA=$P(GMTMP,"^",9) Q:GMTSA=""
"RTN","GMTSRAS",71,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",72,0)
 W ?12,"Exam Case Number:",?33,GMTSA,!
"RTN","GMTSRAS",73,0)
 Q
"RTN","GMTSRAS",74,0)
EST ;   Exam Status                            3
"RTN","GMTSRAS",75,0)
 Q:'$L($G(GMTMP))  N GMTSA S GMTSA=$P(GMTMP,"^",3) Q:GMTSA=""
"RTN","GMTSRAS",76,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",77,0)
 W ?12,"Exam Status:",?33,GMTSA,!
"RTN","GMTSRAS",78,0)
 Q
"RTN","GMTSRAS",79,0)
RST ;   Report Status                          4
"RTN","GMTSRAS",80,0)
 Q:'$L($G(GMTMP))  N GMTSA S GMTSA=$P(GMTMP,"^",4) Q:GMTSA=""
"RTN","GMTSRAS",81,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",82,0)
 W ?12,"Rpt Status:  ",GMTSA,!
"RTN","GMTSRAS",83,0)
 Q
"RTN","GMTSRAS",84,0)
INR ;   Interpreting Resident                  5
"RTN","GMTSRAS",85,0)
 Q:'$L($G(GMTMP))  N GMTSA S GMTSA=$P(GMTMP,"^",5) Q:GMTSA=""
"RTN","GMTSRAS",86,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",87,0)
 W ?12,"Interpreting Res.:",?33,GMTSA,!
"RTN","GMTSRAS",88,0)
 Q
"RTN","GMTSRAS",89,0)
INS ;   Interpreting Staff                     6
"RTN","GMTSRAS",90,0)
 Q:'$L($G(GMTMP))  N GMTSA S GMTSA=$P(GMTMP,"^",6) Q:GMTSA=""
"RTN","GMTSRAS",91,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",92,0)
 W ?12,"Interpreting Staff:",?33,GMTSA,!
"RTN","GMTSRAS",93,0)
 Q
"RTN","GMTSRAS",94,0)
CPT ;   CPT Code                               7
"RTN","GMTSRAS",95,0)
 Q:'$L($G(GMTMP))  N GMTSA S GMTSA=$P($G(GMTMP),"^",7)
"RTN","GMTSRAS",96,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",97,0)
 W ?12,"CPT Code:",?25,GMTSA,!
"RTN","GMTSRAS",98,0)
 Q
"RTN","GMTSRAS",99,0)
TEC ;   Technologist                           8
"RTN","GMTSRAS",100,0)
 Q:'$L($G(GMTMP))  N GMTSA S GMTSA=$P($G(GMTMP),"^",8) Q:GMTSA=""
"RTN","GMTSRAS",101,0)
 Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",102,0)
 W ?12," Technologist: ",GMTSA,!
"RTN","GMTSRAS",103,0)
 Q
"RTN","GMTSRAS",104,0)
STT ;   Report Status/Technologist            4/8
"RTN","GMTSRAS",105,0)
 Q:'$L($G(GMTMP))  N GMTSA,GMTSB S GMTSA=$P(GMTMP,"^",4),GMTSB=$P(GMTMP,"^",8)
"RTN","GMTSRAS",106,0)
 Q:($G(GMTSA)_$G(GMTSB))=""  Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",107,0)
 W ?12,"Rpt Status:  ",$E($G(GMTSA),1,18) W ?45," Technologist: ",$G(GMTSB),!
"RTN","GMTSRAS",108,0)
 Q
"RTN","GMTSRAS",109,0)
CMD ;   CPT Modifiers
"RTN","GMTSRAS",110,0)
 N GMTSCPTM
"RTN","GMTSRAS",111,0)
 S GMTSCPTM=+($$CPT^GMTSU(+($G(GMTSEGN)))) S:$G(GMPXCMOD)="N" GMTSCPTM=0
"RTN","GMTSRAS",112,0)
 Q:'GMTSCPTM  Q:'$L($G(GMTMP))  N GMTSC,GMTSCM,GMTSCT,GMTSI,GMTSCNT S (GMTSC,GMTSCNT)=0
"RTN","GMTSRAS",113,0)
 F  S GMTSC=$O(^TMP("RAE",$J,GMTSIDT,GMTSPN,"CM",GMTSC)) Q:+GMTSC=0  D
"RTN","GMTSRAS",114,0)
 . S GMTSCM=$P($G(^TMP("RAE",$J,GMTSIDT,GMTSPN,"CM",GMTSC)),"^",1) Q:'$L(GMTSCM)
"RTN","GMTSRAS",115,0)
 . S GMTSCT=$P($G(^TMP("RAE",$J,GMTSIDT,GMTSPN,"CM",GMTSC)),"^",3) Q:'$L(GMTSCT)
"RTN","GMTSRAS",116,0)
 . S GMTSCT=GMTSCM_" - "_GMTSCT
"RTN","GMTSRAS",117,0)
 . S GMTSCNT=GMTSCNT+1
"RTN","GMTSRAS",118,0)
 . S:$L(GMTSCT)>47 GMTSCT=$$WRAP^GMTSORC(GMTSCT,47)
"RTN","GMTSRAS",119,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",120,0)
 . W:GMTSCNT=1 ?12,"CPT Modifier:" W ?28,$P(GMTSCT,"|"),!
"RTN","GMTSRAS",121,0)
 . F GMTSI=2:1:$L(GMTSCT,"|") D  Q:$D(GMTSQIT)
"RTN","GMTSRAS",122,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(GMTSCT,"|",GMTSI)]"" ?33,$P(GMTSCT,"|",GMTSI),!
"RTN","GMTSRAS",123,0)
 Q
"RTN","GMTSRAS",124,0)
PMD ;   Procedure Modifiers
"RTN","GMTSRAS",125,0)
 Q:'$L($G(GMTMP))  D CKP^GMTSUP Q:$D(GMTSQIT)  W:+($O(^TMP("RAE",$J,GMTSIDT,GMTSPN,"M",0)))>0 ?12,"Procedure Modifier:"
"RTN","GMTSRAS",126,0)
 S GMI=0 F  S GMI=$O(^TMP("RAE",$J,GMTSIDT,GMTSPN,"M",GMI)) Q:+GMI'>0  D
"RTN","GMTSRAS",127,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSRAS",128,0)
 . W ?33,^TMP("RAE",$J,GMTSIDT,GMTSPN,"M",GMI),!
"RTN","GMTSRAS",129,0)
 Q
"RTN","GMTSRAS",130,0)
 ;            
"RTN","GMTSRAS",131,0)
RPT ; Report Text
"RTN","GMTSRAS",132,0)
 N GMTSL F GMTSL="H","R","I","D" D TXT(GMTSL)
"RTN","GMTSRAS",133,0)
 Q
"RTN","GMTSRAS",134,0)
TXT(X) ;   Report Text Lines
"RTN","GMTSRAS",135,0)
 N GMTST S GMTST=$E($G(X),1) Q:(GMTST="")!("^H^R^I^D^"'[GMTST)!(GMTST="^")  Q:+($G(GMTSIDT))=0  Q:+($G(GMTSPN))=0  Q:'$D(^TMP("RAE",$J,GMTSIDT,GMTSPN,GMTST))
"RTN","GMTSRAS",136,0)
 K ^UTILITY($J,"W") N GMTSI,GMTSII,GMTSIND,DIWF,DIWL,DIWR S GMTSIND=12,DIWF="C"_(78-(GMTSIND+2)),DIWL=0,DIWR=0,GMTSI=0
"RTN","GMTSRAS",137,0)
 D:$O(^TMP("RAE",$J,GMTSIDT,GMTSPN,GMTST,0))>0 BL
"RTN","GMTSRAS",138,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?GMTSIND,$S(GMTST="H":"History: ",GMTST="R":"Report: ",GMTST="I":"Impression: ",GMTST="D":"DX Codes: ",1:"Text:"),!
"RTN","GMTSRAS",139,0)
 I GMTST'="D" D
"RTN","GMTSRAS",140,0)
 . S GMTSI=0 F  S GMTSI=$O(^TMP("RAE",$J,GMTSIDT,GMTSPN,GMTST,GMTSI)) Q:GMTSI'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSRAS",141,0)
 . . S X=$G(^TMP("RAE",$J,GMTSIDT,GMTSPN,GMTST,GMTSI)) D ^DIWP
"RTN","GMTSRAS",142,0)
 I GMTST="D" D
"RTN","GMTSRAS",143,0)
 . S GMTSI=0 F  S GMTSI=$O(^TMP("RAE",$J,GMTSIDT,GMTSPN,GMTST,GMTSI)) Q:GMTSI'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSRAS",144,0)
 . . S X=$G(^TMP("RAE",$J,GMTSIDT,GMTSPN,GMTST,GMTSI)) S:$L(X)>(78-(GMTSIND+4)) X=$$WRAP^GMTSORC(X,(78-(GMTSIND+4)))
"RTN","GMTSRAS",145,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?(GMTSIND+2),$P(X,"|",1),! F GMTSII=2:1:$L(X,"|") D  Q:$D(GMTSQIT) 
"RTN","GMTSRAS",146,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)  W:$P(X,"|",GMTSII)]"" ?(GMTSIND+4),$P(X,"|",GMTSII),!
"RTN","GMTSRAS",147,0)
 I $D(^UTILITY($J,"W")) D
"RTN","GMTSRAS",148,0)
 . S GMTSI=0 F  S GMTSI=$O(^UTILITY($J,"W",0,GMTSI)) Q:+GMTSI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSRAS",149,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?(GMTSIND+2),$G(^UTILITY($J,"W",0,GMTSI,0)),!
"RTN","GMTSRAS",150,0)
 K ^UTILITY($J,"W")
"RTN","GMTSRAS",151,0)
 Q
"RTN","GMTSRAS",152,0)
BL ;   Report Blank Lines
"RTN","GMTSRAS",153,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSRAS",154,0)
 ;               
"RTN","GMTSRAS",155,0)
RP(X) ; Radiology Patient
"RTN","GMTSRAS",156,0)
 N Y S X=+($G(X)) S Y=$$GET1^DIQ(70,X,.01,"I") S X=Y Q X
"RTN","GMTSRM")
0^15^B15567698
"RTN","GMTSRM",1,0)
GMTSRM ; SLC/KER - Edit HS Type ; 09/21/2001
"RTN","GMTSRM",2,0)
 ;;2.7;Health Summary;**30,35,47**;Oct 20, 1995
"RTN","GMTSRM",3,0)
 ;
"RTN","GMTSRM",4,0)
 ; External References
"RTN","GMTSRM",5,0)
 ;    DBIA 10076  ^XUSEC(
"RTN","GMTSRM",6,0)
 ;    DBIA 10076  ^XUSEC("GMTSMGR"
"RTN","GMTSRM",7,0)
 ;    DBIA 10018  ^DIE
"RTN","GMTSRM",8,0)
 ;    DBIA 10010  EN1^DIP
"RTN","GMTSRM",9,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSRM",10,0)
 ;                   
"RTN","GMTSRM",11,0)
MAIN ; Main loop to modify multiple health summary types
"RTN","GMTSRM",12,0)
 N %,DTOUT,DUOUT,DIRUT,EXISTS,GMTSFUNC,GMTSQIT,P
"RTN","GMTSRM",13,0)
 S GMTSQIT=0 F  S EXISTS=0 D SELTYP Q:GMTSQIT
"RTN","GMTSRM",14,0)
 Q
"RTN","GMTSRM",15,0)
SELTYP ; Select Health Summary Type to Edit
"RTN","GMTSRM",16,0)
 N CHANGE,DA,DIC,DIE,DLAYGO,DR,DUOUT,EXISTS,GMTSUM,GMTSNEW,GMTSMGR
"RTN","GMTSRM",17,0)
 N GMTSEG,GMTSIFN,SELCNT,X,Y
"RTN","GMTSRM",18,0)
 W ! S U="^",DIC="^GMT(142,",DIC(0)="AEMQL"
"RTN","GMTSRM",19,0)
 S DIC("A")="Select Health Summary Type: "
"RTN","GMTSRM",20,0)
 S DIC("S")="I +($$AHST^GMTSULT(+($G(Y))))" S DLAYGO=142
"RTN","GMTSRM",21,0)
 S Y=$$TYPE^GMTSULT K DIC S:+Y'>0 GMTSQIT=1 Q:+Y'>0  S (GMTSIFN,DA)=+Y
"RTN","GMTSRM",22,0)
 S GMTSUM=$P(Y,U,2),GMTSNEW=+$P(Y,U,3),GMTSMGR=$S($D(^XUSEC("GMTSMGR",DUZ)):1,1:0)
"RTN","GMTSRM",23,0)
 I 'GMTSMGR,($P(^GMT(142,+DA,0),U,2)]"") D  Q:'GMTSMGR
"RTN","GMTSRM",24,0)
 . S GMTSMGR=$D(^XUSEC($P(^(0),U,2),DUZ))
"RTN","GMTSRM",25,0)
 . W:'GMTSMGR !,$C(7),"This summary report is currently locked to prevent alteration.",!
"RTN","GMTSRM",26,0)
 I 'GMTSMGR,'GMTSNEW,($P(^GMT(142,+DA,0),U,3)'=DUZ) W !,$C(7),"Alteration of this summary report is restricted to its owner.",!,"See the Clinical Coordinator if you need additional help." Q
"RTN","GMTSRM",27,0)
 S DIE="^GMT(142,",(GMTSIFN,DA)=+Y,DR="[GMTS EDIT HLTH SUM TYPE]" D ^DIE
"RTN","GMTSRM",28,0)
 I '$D(^GMT(142,+GMTSIFN,0))!$D(Y)!$D(DUOUT)!$D(DIROUT)!$D(DTOUT) D  Q
"RTN","GMTSRM",29,0)
 . S GMTSQIT=1 D CHKDEL Q
"RTN","GMTSRM",30,0)
 I 'GMTSNEW,($O(^GMT(142,+GMTSIFN,1,0))) S EXISTS=1 D LIST,EXISTS Q
"RTN","GMTSRM",31,0)
 D SELCMP^GMTSRM5 Q:GMTSQIT  D LIST:EXISTS,EXISTS D CHKDEL
"RTN","GMTSRM",32,0)
 Q
"RTN","GMTSRM",33,0)
CHKDEL ; Check for Possible Deletion (New Type without Component)
"RTN","GMTSRM",34,0)
 Q:+($G(GMTSIFN))'>0  Q:'$D(^GMT(142,+($G(GMTSIFN)),0))  D:GMTSMGR!(GMTSNEW)!($P(^GMT(142,+GMTSIFN,0),U,3)'=$G(DUZ)) ADEL^GMTSRM2(+($G(GMTSIFN)))
"RTN","GMTSRM",35,0)
 Q
"RTN","GMTSRM",36,0)
ENADHOC ; Entry point for AD HOC edit
"RTN","GMTSRM",37,0)
 N %,C,CHANGE,DA,DIC,DIE,DR,DUOUT,EXISTS,I,GMTSIFN,GMTSN,GMTSNCNT,GMTSNEW
"RTN","GMTSRM",38,0)
 N GMTSIFN,GMTSUM,P,SELCNT
"RTN","GMTSRM",39,0)
 N GMTSQIT,GMTSFUNC,X,Y
"RTN","GMTSRM",40,0)
 W !!,">>> EDITING the GMTS HS ADHOC OPTION Health Summary Type"
"RTN","GMTSRM",41,0)
 S (GMTSNEW,GMTSQIT)=0
"RTN","GMTSRM",42,0)
 S DIC=142,DIC(0)="XZF",X="GMTS HS ADHOC OPTION"
"RTN","GMTSRM",43,0)
 S Y=$$TYPE^GMTSULT I +Y'>0 D ^GMTSLOAD Q:$D(DIRUT)!$D(DIROUT)  G ENADHOC
"RTN","GMTSRM",44,0)
 S GMTSIFN=+Y,GMTSUM=$P(Y,U,2),EXISTS=1
"RTN","GMTSRM",45,0)
 S DIE="^GMT(142,",DA=GMTSIFN,DR=".08T" D ^DIE
"RTN","GMTSRM",46,0)
 Q:$D(Y)
"RTN","GMTSRM",47,0)
 D LIST,EXISTS
"RTN","GMTSRM",48,0)
 Q
"RTN","GMTSRM",49,0)
EXISTS ; Edit an existing health summary type
"RTN","GMTSRM",50,0)
 N CNT,NXTCMP Q:$D(DUOUT)  S NXTCMP=0,NXTCMP(0)=0
"RTN","GMTSRM",51,0)
 F CNT=$$GETCNT(GMTSIFN):0 D NXTCMP^GMTSRM1,LIST:GMTSQIT Q:GMTSQIT!($D(DUOUT))  K GMTSQIT,GMTSNEW,TWEENER,SOACTION
"RTN","GMTSRM",52,0)
 I NXTCMP>0 W !,"Please hold on while I resequence the summary order" D COPY^GMTSRN,RNMBR^GMTSRN:CHANGE
"RTN","GMTSRM",53,0)
 Q
"RTN","GMTSRM",54,0)
LIST ; Lists existing summary parameters
"RTN","GMTSRM",55,0)
 N B,DIC,DIR,IOP,Y,FR,TO,BY,DHD,FLDS,L
"RTN","GMTSRM",56,0)
 I GMTSQIT'=2 Q:($D(DUOUT)!(GMTSQIT=1))
"RTN","GMTSRM",57,0)
 I GMTSQIT=2,(NXTCMP=0) S GMTSQIT=0 Q
"RTN","GMTSRM",58,0)
 I 'GMTSNEW W ! S DIC=142,DIR(0)="Y",DIR("A")="Do you wish to review the Summary Type structure before continuing",DIR("B")="NO" D ^DIR K DIR I 'Y S:GMTSQIT=2 DUOUT="" S:GMTSQIT=2 GMTSQIT="D" S:$D(DUOUT) GMTSQIT=1 Q
"RTN","GMTSRM",59,0)
 I $D(GMTSQIT),GMTSQIT=2 S GMTSQIT=0
"RTN","GMTSRM",60,0)
 S IOP="HOME",DIC=142,(FR,TO)=GMTSUM,BY=".01",DHD="[GMTS TYPE INQ HEADER]-[GMTS TYPE INQ FOOTER]",FLDS="[GMTS TYPE INQ]",L=0 D EN1^DIP
"RTN","GMTSRM",61,0)
 Q
"RTN","GMTSRM",62,0)
GETCNT(GMTSIFN) ; Determine default summary order for new component
"RTN","GMTSRM",63,0)
 N LI,LCNT S LI=0,LCNT=5 F  S LI=$O(^GMT(142,+GMTSIFN,1,LI)) Q:+LI'>0  S LCNT=$P(LI,".")+5
"RTN","GMTSRM",64,0)
 Q LCNT
"RTN","GMTSRM2")
0^16^B10129036
"RTN","GMTSRM2",1,0)
GMTSRM2 ; SLC/DLT - Edit HS Type - Help/Dupe/Delete  ; 09/21/2001
"RTN","GMTSRM2",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSRM2",3,0)
 ;
"RTN","GMTSRM2",4,0)
 ; External Calls
"RTN","GMTSRM2",5,0)
 ;    DBIA 10013  ^DIK
"RTN","GMTSRM2",6,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSRM2",7,0)
 ;    DBIA 10102  DISP^XQORM1
"RTN","GMTSRM2",8,0)
 ;                      
"RTN","GMTSRM2",9,0)
HELP ; Display Help Text
"RTN","GMTSRM2",10,0)
 N GMI,GMTSTXT,HLP
"RTN","GMTSRM2",11,0)
 S HLP=$S(X="??":"HTX1",1:"HTX1") W ! F GMI=1:1 S GMTSTXT=$T(@HLP+GMI) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSRM2",12,0)
 D REDISP
"RTN","GMTSRM2",13,0)
 Q
"RTN","GMTSRM2",14,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSRM2",15,0)
 N I,DIR,X,Y
"RTN","GMTSRM2",16,0)
 S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y
"RTN","GMTSRM2",17,0)
 W @IOF
"RTN","GMTSRM2",18,0)
 D DISP^XQORM1 W !
"RTN","GMTSRM2",19,0)
 Q
"RTN","GMTSRM2",20,0)
HTX1 ; Help Text for "?" and "??"
"RTN","GMTSRM2",21,0)
 ;;
"RTN","GMTSRM2",22,0)
 ;; Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSRM2",23,0)
 ;;
"RTN","GMTSRM2",24,0)
 ;; ALL items may be selected by typing "ALL".
"RTN","GMTSRM2",25,0)
 ;;
"RTN","GMTSRM2",26,0)
 ;; EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSRM2",27,0)
 ;;   For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSRM2",28,0)
 ;;
"RTN","GMTSRM2",29,0)
 ;;ZZZZ
"RTN","GMTSRM2",30,0)
 ;;
"RTN","GMTSRM2",31,0)
 Q
"RTN","GMTSRM2",32,0)
ADEL(X) ; Ask to Delete
"RTN","GMTSRM2",33,0)
 N GMTSIEN,GMTSN,ADEL,DIR S GMTSIEN=+($G(X)),ADEL=""  Q:GMTSIEN=0  Q:'$D(^GMT(142,GMTSIEN,0))  Q:$D(^GMT(142,GMTSIEN,1,"B"))
"RTN","GMTSRM2",34,0)
 S GMTSN=$P($G(^GMT(142,GMTSIEN,0)),"^",1) Q:'$L(GMTSN)  S DIR("A",1)=" Health Summary Type '"_GMTSN_"' has no Components",DIR("A")=" Do you want to delete this type?  (Y/N)  ",DIR("B")="Yes",DIR(0)="YAO",DIR("?")="     Enter either 'Y' or 'N'."
"RTN","GMTSRM2",35,0)
 W ! D ^DIR D:Y>0 DEL(+($G(GMTSIEN)))
"RTN","GMTSRM2",36,0)
 Q
"RTN","GMTSRM2",37,0)
DEL(X) ; Delete
"RTN","GMTSRM2",38,0)
 N DIK,DA,GMTSN S DA=+($G(X))
"RTN","GMTSRM2",39,0)
 Q:DA=0  Q:'$D(^GMT(142,DA,0))  S DIK="^GMT(142,",GMTSN=$P($G(^GMT(142,DA,0)),"^",1) Q:'$L(GMTSN)  D ^DIK I '$D(^GMT(142,DA,0)) W:$D(ADEL) "  < deleted >" W:'$D(ADEL) !,?2,GMTSN,"  < deleted >"
"RTN","GMTSRM2",40,0)
 Q
"RTN","GMTSRM2",41,0)
DUP(X) ; Look for a Duplicate 1 = duplicate found, 0 = unique
"RTN","GMTSRM2",42,0)
 Q:'$L($G(X)) 1  S X=$G(X) N TYPE,UTYPE S TYPE=X,UTYPE=$$UP(TYPE)
"RTN","GMTSRM2",43,0)
 N TYPES,TYPEO,TYPEI,TYPEN S TYPEO=$E(UTYPE,1,30),TYPEO=$E(TYPEO,1,($L(TYPEO)-1))_$C($A($E(TYPEO,$L(TYPEO)))-1)_"~"
"RTN","GMTSRM2",44,0)
 F  S TYPEO=$O(^GMT(142,"AB",TYPEO)) Q:TYPEO=0!(TYPEO'[$E(UTYPE,1,30))  D
"RTN","GMTSRM2",45,0)
 . S TYPEI=0 F  S TYPEI=$O(^GMT(142,"AB",TYPEO,TYPEI)) Q:+TYPEI=0  D
"RTN","GMTSRM2",46,0)
 . . S TYPEN=$$UP($P($G(^GMT(142,TYPEI,0)),"^",1)) Q:TYPEN'=UTYPE  Q:TYPEI=+($G(DA))
"RTN","GMTSRM2",47,0)
 . . S TYPES(TYPEI)=TYPEN_"^"_TYPE
"RTN","GMTSRM2",48,0)
 Q $S($O(TYPES(0))>0:1,1:0)
"RTN","GMTSRM2",49,0)
UP(X) Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSU")
0^40^B52089849
"RTN","GMTSU",1,0)
GMTSU ; SLC/JER,KER/NDBI - Health Summary Utilities ; 09/21/2001
"RTN","GMTSU",2,0)
 ;;2.7;Health Summary;**27,28,31,35,37,43,47**;Oct 20, 1995
"RTN","GMTSU",3,0)
 ;
"RTN","GMTSU",4,0)
 ; External References
"RTN","GMTSU",5,0)
 ;   DBIA 10096  ^%ZOSF("TEST")
"RTN","GMTSU",6,0)
 ;   DBIA  2934  ^A7RCP (NDBI Global)
"RTN","GMTSU",7,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSU",8,0)
 ;   DBIA 10103  $$FMTHL7^XLFDT
"RTN","GMTSU",9,0)
 ;   DBIA 10103  $$HL7TFM^XLFDT
"RTN","GMTSU",10,0)
 ;   DBIA 10061  OERR^VADPT
"RTN","GMTSU",11,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSU",12,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSU",13,0)
 ;   DBIA  2052  FILE^DID
"RTN","GMTSU",14,0)
 ;   DBIA 10022  %XY^%RCR
"RTN","GMTSU",15,0)
 ;   DBIA  2055  $$VFIELD^DILFD
"RTN","GMTSU",16,0)
 ;   DBIA  2052  $$GET1^DID
"RTN","GMTSU",17,0)
 ;                              
"RTN","GMTSU",18,0)
PROK(X,Y) ; Routine and Patch # OK (in UCI)
"RTN","GMTSU",19,0)
 N GMTS,GMTSI,GMTSO S X=$G(X),Y=$G(Y) Q:'$L(X) 0 Q:Y'=""&(+Y=0)
"RTN","GMTSU",20,0)
 S Y=+Y,GMTS=$$ROK(X) Q:'GMTS 0 Q:+Y=0 1 S GMTSO=0,GMTS=$T(@("+2^"_X)),GMTS=$P($P(GMTS,"**",2),"**",1)
"RTN","GMTSU",21,0)
 F GMTSI=1:1:$L(GMTS,",") S:+($P(GMTS,",",GMTSI))=Y GMTSO=1 Q:GMTSO=1
"RTN","GMTSU",22,0)
 S X=GMTSO Q X
"RTN","GMTSU",23,0)
ROK(X) ; Routine OK (in UCI) (NDBI)
"RTN","GMTSU",24,0)
 S X=$G(X) Q:'$L(X) 0  Q:$L(X)>8 0  X ^%ZOSF("TEST") Q:$T 1  Q 0
"RTN","GMTSU",25,0)
NDBI(X) ; National Database Integration site 1 = yes  0 = no
"RTN","GMTSU",26,0)
 N R,G S X="A7RDUP" X ^%ZOSF("TEST") S R=$T,G=$S($D(^A7RCP):1,1:0),X=R+G,X=$S(X=2:1,1:0) Q X
"RTN","GMTSU",27,0)
 ;                
"RTN","GMTSU",28,0)
CPT(X) ; Use CPT Modifiers  Needs GMTSEG Array
"RTN","GMTSU",29,0)
 S X=+($G(X)) N GMTSN,GMTSC,GMTSM,GMTSA,GMTSI S GMTSN=$G(GMTSEG(X)) S GMTSC=+($P(GMTSN,"^",2)) Q:'GMTSC 0
"RTN","GMTSU",30,0)
 S GMTSM=$S($P(GMTSN,"^",9)="N":0,$P(GMTSN,"^",9)="":1,1:1) Q:'GMTSM 0
"RTN","GMTSU",31,0)
 S GMTSA=$S(+($$CMU(+GMTSC))>0:1,1:0) Q:'GMTSA 0
"RTN","GMTSU",32,0)
 Q 1
"RTN","GMTSU",33,0)
CMU(X) ; Component Uses CPT Modifiers
"RTN","GMTSU",34,0)
 N GMTSA,GMTSN,GMTSI S X=$G(X) Q:'$L(X) 0 S GMTSI=+X,GMTSA=$O(^GMT(142.1,"C",X,0)),GMTSN=$O(^GMT(142.1,"D",X,0)) S:GMTSI=0&(+GMTSA>0) GMTSI=GMTSA S:GMTSI=0&(+GMTSN>0) GMTSI=GMTSN
"RTN","GMTSU",35,0)
 Q:+GMTSI=0 0 S GMTSA=$S($P($G(^GMT(142.1,+GMTSI,0)),"^",14)="Y":1,1:0) Q:'GMTSA 0
"RTN","GMTSU",36,0)
 Q 1
"RTN","GMTSU",37,0)
 ;            
"RTN","GMTSU",38,0)
 ; Dates and Time
"RTN","GMTSU",39,0)
ED(X) ;   Health Summary External Date
"RTN","GMTSU",40,0)
 S X=$G(X) Q:'$L(X) ""  D REGDT4 Q X
"RTN","GMTSU",41,0)
EDT(X) ;   Health Summary External Date and Time
"RTN","GMTSU",42,0)
 S X=$G(X) Q:'$L(X) ""  D REGDTM4 Q X
"RTN","GMTSU",43,0)
REGDT ;   Receives X FM date and returns X in MM/DD/YY format
"RTN","GMTSU",44,0)
 S X=$TR($$FMTE^XLFDT(X,"2DZ"),"@"," ") Q
"RTN","GMTSU",45,0)
REGDT4 ;   Receives X FM date and returns X in MM/DD/YYYY format
"RTN","GMTSU",46,0)
 S X=$TR($$FMTE^XLFDT(X,"5DZ"),"@"," ") Q
"RTN","GMTSU",47,0)
REGDTM ;   Receives X FM date and returns X in MM/DD/YY TT:TT
"RTN","GMTSU",48,0)
 S X=$TR($$FMTE^XLFDT(X,"2ZM"),"@"," ") Q
"RTN","GMTSU",49,0)
REGDTM4 ;   Receives X FM date and returns X in MM/DD/YYYY TT:TT
"RTN","GMTSU",50,0)
 S X=$TR($$FMTE^XLFDT(X,"5ZM"),"@"," ") Q
"RTN","GMTSU",51,0)
SIDT ;   Receives X FM date and returns X in DD MMM YY
"RTN","GMTSU",52,0)
 N MON,MM S X=$P(X,".") S:'X X="" Q:'$L(X)
"RTN","GMTSU",53,0)
 S MON="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"
"RTN","GMTSU",54,0)
 S MM=$E(X,4,5),MM=$S(MM:$P(MON,U,+MM),1:"")
"RTN","GMTSU",55,0)
 S X=$E(X,6,7)_" "_MM_" "_$E(X,2,3) Q
"RTN","GMTSU",56,0)
MTIM ;   Convert Time from X=2890313.1304 to X=13:04
"RTN","GMTSU",57,0)
 S X=$P(X,".",2) Q:'$L(X)  S X=$S(X:$E(X,1,2)_$E("00",0,2-$L($E(X,1,2)))_":"_$E(X,3,4)_$E("00",0,2-$L($E(X,3,4))),1:"")
"RTN","GMTSU",58,0)
 Q
"RTN","GMTSU",59,0)
 ;            
"RTN","GMTSU",60,0)
HF(X) ; Host File - Used to distinguish from Host Files that
"RTN","GMTSU",61,0)
 ; are intended for Printers and Host Files for other
"RTN","GMTSU",62,0)
 ; purposes (windows/files)
"RTN","GMTSU",63,0)
 ;                
"RTN","GMTSU",64,0)
 ;   1 - if Device Type is HFS and not a TCP/IP Printer
"RTN","GMTSU",65,0)
 ;   0 - if Device Type is not HFS or device is a Printer
"RTN","GMTSU",66,0)
 ;            
"RTN","GMTSU",67,0)
 ; Check Device
"RTN","GMTSU",68,0)
 ;   Check Host File Server
"RTN","GMTSU",69,0)
 Q:$G(IOT)'="HFS" 0
"RTN","GMTSU",70,0)
 ;   Check ORWINDEV (Post OR*3.0*85)
"RTN","GMTSU",71,0)
 N GMTS85 S GMTS85=$$PROK("ORWRP",85)
"RTN","GMTSU",72,0)
 Q:+($G(GMTS85))>0&(+($G(ORWINDEV))>0) 0
"RTN","GMTSU",73,0)
 ;   Host File for GUI Scrollable Window
"RTN","GMTSU",74,0)
 Q:$E($G(ION),1,14)["OR WORKSTATION" 1
"RTN","GMTSU",75,0)
 ;   TCP/IP Printer
"RTN","GMTSU",76,0)
 Q:$G(IO)["$PRT"!($G(IO)["PRN|") 0
"RTN","GMTSU",77,0)
 ;   Windows Printer
"RTN","GMTSU",78,0)
 Q:$E($G(ION),1,14)["OR WINDOWS HFS" 0
"RTN","GMTSU",79,0)
 ;   Host Files (file or unspecifed printer)
"RTN","GMTSU",80,0)
 S X=0 S:$G(ION)["HOST FILE" X=1
"RTN","GMTSU",81,0)
 S:$E($G(IOST),1,5)["P-OTH" X=1
"RTN","GMTSU",82,0)
 Q X
"RTN","GMTSU",83,0)
 ;            
"RTN","GMTSU",84,0)
FMHL7DTM ; Convert X - int date/time to HL7 CCYYMMDDHHMM-HHHH
"RTN","GMTSU",85,0)
 S X=$$FMTHL7^XLFDT(+($G(X))) Q
"RTN","GMTSU",86,0)
HL7FMDTM ; Convert X - HL7 CCYYMMDDHHMM-HHHH to int date/time local
"RTN","GMTSU",87,0)
 S X=$$HL7TFM^XLFDT($G(X),"L") Q
"RTN","GMTSU",88,0)
 ;            
"RTN","GMTSU",89,0)
DEM ; Gets Demographic Data from VADPT
"RTN","GMTSU",90,0)
 ;            
"RTN","GMTSU",91,0)
 ;    Input    DFN
"RTN","GMTSU",92,0)
 ;            
"RTN","GMTSU",93,0)
 ;    Output   GMTSPNM     Patient Name
"RTN","GMTSU",94,0)
 ;             GMTSSN      Social Security Number
"RTN","GMTSU",95,0)
 ;             GMTSDOB     Date of Birth
"RTN","GMTSU",96,0)
 ;             SEX         Sex
"RTN","GMTSU",97,0)
 ;             GMTSWARD    Ward
"RTN","GMTSU",98,0)
 ;             GMTSRB      Bed
"RTN","GMTSU",99,0)
 ;             GMTSAGE     Age
"RTN","GMTSU",100,0)
 ;             VADM()      Demographic Array
"RTN","GMTSU",101,0)
 ;             VAIN()      Inpatient Array
"RTN","GMTSU",102,0)
 ;             GMTSPHDR()  Report Header Array
"RTN","GMTSU",103,0)
 ;            
"RTN","GMTSU",104,0)
 K VAHOW D OERR^VADPT S GMTSPNM=VADM(1),GMTSSN=$S($D(VA("PID")):VA("PID"),1:$P(VADM(2),"^",2))
"RTN","GMTSU",105,0)
 S GMTSAGE=$S(+VADM(4)>0:+VADM(4),1:99),SEX=$P(VADM(5),"^")
"RTN","GMTSU",106,0)
 S GMTSWARD=$P(VAIN(4),"^",2),GMTSRB=VAIN(5)
"RTN","GMTSU",107,0)
 S X=$P(VADM(3),"^") D REGDT4 S GMTSDOB=X K VA,GMTSPHDR N DOB,LWARDRB,NMSSN,NMSSNE,WARDRB,WARDRBE,WARDRBS
"RTN","GMTSU",108,0)
 S NMSSN=GMTSPNM_"    "_GMTSSN,NMSSNE=$L(NMSSN)+2,WARDRB=GMTSWARD_" "_GMTSRB
"RTN","GMTSU",109,0)
 S LWARDRB=$L(WARDRB),WARDRBS=40-(LWARDRB/2),WARDRBE=WARDRBS+LWARDRB
"RTN","GMTSU",110,0)
 S DOB="DOB: "_GMTSDOB,GMTSPHDR("NMSSN")=NMSSN,GMTSPHDR("WARDRB")=WARDRB
"RTN","GMTSU",111,0)
 S GMTSPHDR("WARDRBS")=WARDRBS,GMTSPHDR("DOB")=DOB,GMTSPHDR("DOBS")=64
"RTN","GMTSU",112,0)
 I (NMSSNE'<WARDRBS)!(WARDRBE'<64) S GMTSPHDR("TWO")=1
"RTN","GMTSU",113,0)
 Q
"RTN","GMTSU",114,0)
 ;                 
"RTN","GMTSU",115,0)
NAME(X,Y,L) ; Format name
"RTN","GMTSU",116,0)
 ;            
"RTN","GMTSU",117,0)
 ; Input 
"RTN","GMTSU",118,0)
 ;    X    Internal Entry Number of NEW PERSON file 200
"RTN","GMTSU",119,0)
 ;    Y    Flag to specify the first name format
"RTN","GMTSU",120,0)
 ;            0 for First Name Initial (only)
"RTN","GMTSU",121,0)
 ;            1 for First Name
"RTN","GMTSU",122,0)
 ;    L    Maximum Length of Name
"RTN","GMTSU",123,0)
 ;          
"RTN","GMTSU",124,0)
 ; Output  Last,First (name/initial) to specified length
"RTN","GMTSU",125,0)
 ;            
"RTN","GMTSU",126,0)
 N RAWNM,LAST,FIRST,ALPHA,PSN,CH,IEN,FNF,LEN
"RTN","GMTSU",127,0)
 S IEN=+($G(X)),FNF=+($G(Y)),LEN=+($G(L)) S RAWNM=$$UNAM^GMTSU2(+IEN) S:LEN=0 LEN=$L(RAWNM) S RAWNM=$S($L(RAWNM):RAWNM,1:"UNKNOWN")
"RTN","GMTSU",128,0)
 S LAST=$P(RAWNM,","),FIRST=$P(RAWNM,",",2),ALPHA=0 I $L(FIRST) F PSN=1:1 S CH=$E(FIRST,PSN) Q:CH?1A  S ALPHA=PSN
"RTN","GMTSU",129,0)
 S:ALPHA>0 FIRST=$E(FIRST,ALPHA+1,$L(FIRST)) S:'FNF FIRST=$E(FIRST,1) S X=$S($L(FIRST):LAST_","_FIRST,1:LAST),X=$E(X,1,LEN)
"RTN","GMTSU",130,0)
 Q X
"RTN","GMTSU",131,0)
GETRANGE(FROMDATE,TODATE) ; Select Date Range (from and to dates)
"RTN","GMTSU",132,0)
 N DIR,X,Y,DTOUT,DIRUT S DIR(0)="DO^:DT",DIR("A")="Enter Beginning Date (MM/DD/YY)" W !
"RTN","GMTSU",133,0)
 D ^DIR I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) W ! Q
"RTN","GMTSU",134,0)
 S FROMDATE=Y I +FROMDATE>0 D
"RTN","GMTSU",135,0)
 . W "  (",$$UP^XLFSTR($$FMTE^XLFDT(+FROMDATE,1)),")"
"RTN","GMTSU",136,0)
 . N DIR,X,Y S DIR(0)="DO^::EX",DIR("A")="Enter Ending Date (MM/DD/YY)" S DIR("B")="TODAY"
"RTN","GMTSU",137,0)
 . D ^DIR I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) K FROMDATE Q
"RTN","GMTSU",138,0)
 . I Y'>0 K FROMDATE Q
"RTN","GMTSU",139,0)
 . S TODATE=Y Q:TODATE>FROMDATE!(TODATE=FROMDATE) 
"RTN","GMTSU",140,0)
 . N FRDT S FRDT=FROMDATE,FROMDATE=TODATE,TODATE=FRDT
"RTN","GMTSU",141,0)
 W !
"RTN","GMTSU",142,0)
 Q
"RTN","GMTSU",143,0)
 ;                
"RTN","GMTSU",144,0)
OED() ; Other Editor - DIC("S")
"RTN","GMTSU",145,0)
 N COMP,OTHER,OWNER,OWNN,USER,AUSER,NAT S COMP=+($G(DA(1))) Q:'$D(^GMT(142,+COMP,0)) 0
"RTN","GMTSU",146,0)
 S OWNER=$P($G(^GMT(142,+COMP,0)),"^",3),OWNN=$$UNAM^GMTSU2(OWNER),NAT=+($P($G(^GMT(142,+COMP,"VA")),"^",1)),USER=+($G(DUZ)),AUSER=$$UACT^GMTSU2(+USER),OTHER=+($G(X))
"RTN","GMTSU",147,0)
 ;   If National Component and Uneditable
"RTN","GMTSU",148,0)
 W:+NAT=2 !!,"  Nationally exported Health Summary Type (uneditable)",! Q:+NAT=2 0
"RTN","GMTSU",149,0)
 ;   If OWNER is special case (national, uneditable)
"RTN","GMTSU",150,0)
 W:+OWNER>0&(OWNER<1)&(NAT'=1) !!,"  OWNER does not allow 'OTHER EDITORS'",! Q:+OWNER>0&(OWNER<1)&(NAT'=1) 0
"RTN","GMTSU",151,0)
 ;   If OWNER is special case (national, editable)
"RTN","GMTSU",152,0)
 Q:+OWNER>0&(OWNER<1)&(OWNER=USER)&(NAT=1) 1
"RTN","GMTSU",153,0)
 ;   If DUZ is inactive, or not the owner, quit
"RTN","GMTSU",154,0)
 W:+AUSER=0!(+OWNER=0)!(+OWNER'=+USER) !!,"  Only the OWNER may assign 'OTHER EDITORS'",! Q:+AUSER=0!(+OWNER=0)!(+OWNER'=+USER) 0
"RTN","GMTSU",155,0)
 ;   If OTHER is inactive user, quit
"RTN","GMTSU",156,0)
 S AUSER=$$UACT^GMTSU2(OTHER) W:+AUSER=0!(+OTHER'>.999999999) !!,"  Selected 'OTHER EDITOR' is not an active user",! Q:+AUSER=0!(+OTHER'>.999999999) 0
"RTN","GMTSU",157,0)
 ;   If OTHER=OWNER, quit
"RTN","GMTSU",158,0)
 W:+OTHER=+OWNER !!,"  ",OWNN," is the OWNER",! Q:+OTHER=+OWNER 0
"RTN","GMTSU",159,0)
 Q 1
"RTN","GMTSU",160,0)
 ;                
"RTN","GMTSU",161,0)
FCLR(X) ; File Closed Root
"RTN","GMTSU",162,0)
 S X=$G(X) Q:+X=0 "" N GMTSL S GMTSL=$$FLOC(X),X=$S($E(GMTSL,$L(GMTSL))=",":$P(GMTSL,",")_")",1:$E(GMTSL,1,$L(GMTSL)-1)) Q:'$L(X) "" S:'$D(@X) X=""
"RTN","GMTSU",163,0)
 Q X
"RTN","GMTSU",164,0)
FSFN(X) ; File/Sub-File Name
"RTN","GMTSU",165,0)
 N FI,FR,%X,%Y S FI=$G(X) Q:+X=0 "" N DIERR,GMTSN,GMTSE D FILE^DID(+FI,"N","NAME","GMTSN","GMTSE")
"RTN","GMTSU",166,0)
 S X="" S:'$D(DIERR) X=$$UP^XLFSTR($G(GMTSN("NAME"))) Q:$L(X) X
"RTN","GMTSU",167,0)
 K FR S %X="^DD("_+($G(FI))_",0,""NM"",",%Y="FR(" D %XY^%RCR S X=$$UP^XLFSTR($O(FR(""))) S:+X>0 X="" S:$L(X) X=X_" SUB-FILE" Q X
"RTN","GMTSU",168,0)
FNAM(X) ; File Name
"RTN","GMTSU",169,0)
 S X=$G(X) Q:+X=0 "" N DIERR,GMTSN,GMTSE D FILE^DID(+X,"N","NAME","GMTSN","GMTSE") S X="" S:'$D(DIERR) X=$G(GMTSN("NAME")) Q X
"RTN","GMTSU",170,0)
FLOC(X) ; File location
"RTN","GMTSU",171,0)
 S X=$G(X) Q:+X=0 "" N DIERR,GMTSN,GMTSE D FILE^DID(+X,"N","GLOBAL NAME","GMTSN","GMTSE") S X="" S:'$D(DIERR) X=$G(GMTSN("GLOBAL NAME")) Q X
"RTN","GMTSU",172,0)
FHDD(X) ; File has a DD?
"RTN","GMTSU",173,0)
 S X=+($G(X)) Q:+($G(X))=0 0 S X=$$VFIELD^DILFD(X,.01),X=$S($L(X):1,1:0) Q X
"RTN","GMTSU",174,0)
FLDN(X,Y) ; Field Name
"RTN","GMTSU",175,0)
 Q:+($G(X))=0!(+($G(Y))=0) "" S X=$$GET1^DID(+($G(X)),+($G(Y)),,"LABEL") Q X
"RTN","GMTSU",176,0)
FLDS(X,Y) ; Field Set of Codes
"RTN","GMTSU",177,0)
 Q:+($G(X))=0!(+($G(Y))=0) "" Q:$$GET1^DID(+($G(X)),+($G(Y)),,"TYPE")'="SET" "" S X=$$GET1^DID(+($G(X)),+($G(Y)),,"POINTER") Q X
"RTN","GMTSU",178,0)
FLDI(X,Y) ; Field Input Transform
"RTN","GMTSU",179,0)
 Q:+($G(X))=0!(+($G(Y))=0) "" S X=$$GET1^DID(+($G(X)),+($G(Y)),,"INPUT TRANSFORM") Q X
"RTN","GMTSULT")
0^37^B71331926
"RTN","GMTSULT",1,0)
GMTSULT ; SLC/KER - HS Type Lookup                      ; 09/21/2001
"RTN","GMTSULT",2,0)
 ;;2.7;Health Summary;**30,35,29,47**;Oct 20, 1995
"RTN","GMTSULT",3,0)
 ;
"RTN","GMTSULT",4,0)
 ; External References
"RTN","GMTSULT",5,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMTSULT",6,0)
 ;   DBIA  2056  $$GET1^DIQ (file 200)
"RTN","GMTSULT",7,0)
 ;   DBIA  2055  RECALL^DILFD
"RTN","GMTSULT",8,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSULT",9,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSULT",10,0)
 ;   DBIA 10029  ^DIWW
"RTN","GMTSULT",11,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSULT",12,0)
 ;   DBIA 10016  ^DIM
"RTN","GMTSULT",13,0)
 ;   DBIA 10076  ^XUSEC(
"RTN","GMTSULT",14,0)
 ;   DBIA  1131  ^XMB("NETNAME")
"RTN","GMTSULT",15,0)
 ;   DBIA  2198  $$BROKER^XWBLIB
"RTN","GMTSULT",16,0)
 ;   DBIA 10006  ^DIC (file #142)
"RTN","GMTSULT",17,0)
 ;   DBIA 10096  ^%ZOSF("TEST")
"RTN","GMTSULT",18,0)
 ;            
"RTN","GMTSULT",19,0)
 N DIC,DTOUT,DUOUT,DIRUT D DICHK S DIC(0)="AEMQZ" S Y=$$TYPE^GMTSULT Q
"RTN","GMTSULT",20,0)
EN ; Lookup (general)
"RTN","GMTSULT",21,0)
 Q:$G(DIC(0))["I"
"RTN","GMTSULT",22,0)
 K DTOUT,DUOUT N GMTSDICW,GMTSDICS,GMTSDIC,GMTSLGO,GMTSDIC0,GMTSDICB,GMTSDEF,GMTSWY,GMTSDISV,GMTSDICA,GMTSLERR,GMTSE,GMTSQ,GMTSX,DIR,DIRUT,DIROUT,GMTS
"RTN","GMTSULT",23,0)
 S GMTSE=$$ECHO D LD S U="^"
"RTN","GMTSULT",24,0)
 S (GMTSDEF,GMTSQ)=0,GMTSX=$G(X) S:$L(GMTSDIC0)&(GMTSDIC0'["A") GMTSQ=1 K Y
"RTN","GMTSULT",25,0)
 ;   Get X
"RTN","GMTSULT",26,0)
 ;     Ask the entry          DIC(0)["A" (INPUT^GMTSULT5)
"RTN","GMTSULT",27,0)
 S:GMTSDIC0'["A"&($L(GMTSX)) X=GMTSX
"RTN","GMTSULT",28,0)
 K GMTSLERR S:GMTSDIC0["A"!('$L(GMTSX)) X=$$INPUT^GMTSULT5
"RTN","GMTSULT",29,0)
 I $D(DTOUT)!($D(DUOUT)) S Y=-1 S:$D(DTOUT) DTOUT=1 S:$D(DUOUT) DUOUT=1 Q
"RTN","GMTSULT",30,0)
 ;     Is X an IEN            From Spacebar-Return
"RTN","GMTSULT",31,0)
 I +($$XIEN(X))>0 D  Q
"RTN","GMTSULT",32,0)
 . K Y S Y=+($$XIEN(X))
"RTN","GMTSULT",33,0)
 . D Y^GMTSULT6(+Y),RD,CLR
"RTN","GMTSULT",34,0)
 . I ($G(GMTSDIC0)["Q"!($G(DIC(0))["Q")),+($G(Y))<0 W " ??"
"RTN","GMTSULT",35,0)
 ;     No Input or Error      X="" or X["^" or '$D(X)
"RTN","GMTSULT",36,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT))!($G(X)="")!($G(X)["^") D  Q
"RTN","GMTSULT",37,0)
 . K Y W !!,?5 W:'$L($G(GMTSLERR)) "No Health Summary Type selected"
"RTN","GMTSULT",38,0)
 . W:$L($G(GMTSLERR)) GMTSLERR W ! S Y=-1 D RD,CLR
"RTN","GMTSULT",39,0)
 ;     Exact Match Required   DIC(0)["X"
"RTN","GMTSULT",40,0)
 I GMTSDIC0["X",$L(X) D  Q
"RTN","GMTSULT",41,0)
 . K Y S Y=-1,GMTSX=$$EM^GMTSULT2(X) D:+GMTSX>0 Y^GMTSULT6(+GMTSX) D RD,CLR
"RTN","GMTSULT",42,0)
 ;   Select
"RTN","GMTSULT",43,0)
 ;     Get Selection List
"RTN","GMTSULT",44,0)
 D LIST^GMTSULT2(X)
"RTN","GMTSULT",45,0)
 ;     Select from multiple entries
"RTN","GMTSULT",46,0)
 D:+($G(^TMP("GMTSULT",$J,0)))>1 MULTI^GMTSULT6
"RTN","GMTSULT",47,0)
 ;     Select from one entry
"RTN","GMTSULT",48,0)
 D:+($G(^TMP("GMTSULT",$J,0)))=1 ONE^GMTSULT6
"RTN","GMTSULT",49,0)
 S:'$D(Y)!(+($G(Y))'>0) Y=-1
"RTN","GMTSULT",50,0)
 ;          
"RTN","GMTSULT",51,0)
 ; DLAYGO allowed
"RTN","GMTSULT",52,0)
 ;   Add entry
"RTN","GMTSULT",53,0)
 I $L(X),Y=-1,$G(GMTSDIC0)["L",+($G(GMTSLGO))=142 D
"RTN","GMTSULT",54,0)
 . Q:$L(X)<3!($L(X)>30)  K Y(0) N DLAYGO,GMTSOD0,GMTSOX S GMTSOD0=DIC(0),GMTSOX=X
"RTN","GMTSULT",55,0)
 . N X,DA,DIC,DIK S DIC(0)="LM",(DIK,DIC)="^GMT(142,",DLAYGO=142,X=GMTSOX
"RTN","GMTSULT",56,0)
 . L +^GMT(142):2 W:'$T !,"  Can not add Health Summary Type, the file is in ",!,"  use by another user.  Please try again later."
"RTN","GMTSULT",57,0)
 . D:$T ADD L -^GMT(142) S (GMTSDIC0,DIC(0))=GMTSOD0
"RTN","GMTSULT",58,0)
 D RD,CLR
"RTN","GMTSULT",59,0)
 Q
"RTN","GMTSULT",60,0)
ADD ;   Add Health Summary Type
"RTN","GMTSULT",61,0)
 N GMTSOK,GMTSU,GMTSD,GMTSMSG S GMTSMSG=$$MSG
"RTN","GMTSULT",62,0)
 S GMTSU=$$GET1^DIQ(200,+($G(DUZ)),.01) I '$L(GMTSU) D  S Y=-1 Q
"RTN","GMTSULT",63,0)
 . W !!,"  Undefined/Invalid User",!
"RTN","GMTSULT",64,0)
 S GMTSU=+($$GET1^DIQ(200,+($G(DUZ)),9.2,"I")),GMTSD=$$NOW^XLFDT
"RTN","GMTSULT",65,0)
 I GMTSU>0&(GMTSU<GMTSD) D  S Y=-1 Q
"RTN","GMTSULT",66,0)
 . W !!,"  Terminated Users may not add a Health Summary",!
"RTN","GMTSULT",67,0)
 S GMTSOK=+($$ASKA(X)) Q:'GMTSOK
"RTN","GMTSULT",68,0)
 S DA=$$DA I DA'>0!($D(^GMT(142,DA))) S Y=-1 Q
"RTN","GMTSULT",69,0)
 S $P(^GMT(142,DA,0),"^",1)=X,$P(^GMT(142,DA,0),"^",3)=+($G(DUZ))
"RTN","GMTSULT",70,0)
 D SI I '$D(^GMT(142,"B",$E(X,1,30),DA)) D KI K ^GMT(142,DA) S Y=-1 Q
"RTN","GMTSULT",71,0)
 S Y=DA_"^"_X_"^1"
"RTN","GMTSULT",72,0)
 Q
"RTN","GMTSULT",73,0)
 ;          
"RTN","GMTSULT",74,0)
DA(X) ; Get IEN
"RTN","GMTSULT",75,0)
 S X=$O(^GMT(142,"4999999"),-1) F  Q:'$D(^GMT(142,X))  S X=X+1
"RTN","GMTSULT",76,0)
 Q:X<5000000 X  Q:X>5000999 X
"RTN","GMTSULT",77,0)
 S X=$O(^GMT(142,"!"),-1) F  Q:'$D(^GMT(142,X))  S X=X+1
"RTN","GMTSULT",78,0)
 S:X>4999999&(X<6000000) X=6000000 Q X
"RTN","GMTSULT",79,0)
ET(T) ; Error Text
"RTN","GMTSULT",80,0)
 I $D(DIEV0) D  Q:+($G(DIQUIET))>0
"RTN","GMTSULT",81,0)
 . N I,E,A S I=+($G(DIERR)) S:I=0 I=1 S A=$G(GMTSMSG) S:A="" A="GMTSE" S E=$O(@(A_"(""GMTSERR"","_I_","" "")"),-1)+1,@(A_"(""GMTSERR"","_I_","_+E_")")=$G(T),@(A_"(""GMTSENV"")")=1
"RTN","GMTSULT",82,0)
 Q:$D(GMTSETQ)  N %,X,Y,Z,I,DIW,DIWF,DIWL,DIWR,DIWT,DN S X=T,DIWL=6,DIWR=78,DIWF="W" D ^DIWP D:$D(^UTILITY($J)) ^DIWW W ?5 Q
"RTN","GMTSULT",83,0)
BL ; Blank Line
"RTN","GMTSULT",84,0)
 Q:+($G(DIQUIET))>0  Q:$D(GMTSETQ)  W !,?5 Q
"RTN","GMTSULT",85,0)
MSG() ; Message
"RTN","GMTSULT",86,0)
 Q:$L($G(DIMSG)) $G(DIMSG) Q:$L($G(DIMSGA)) $G(DIMSGA) Q:$L($G(DIOUTAR)) $G(DIOUTAR) Q:$L($G(DIEFOUT)) $G(DIEFOUT) Q:$L($G(GMTSMS)) $G(GMTSMS)
"RTN","GMTSULT",87,0)
 Q "TMP"
"RTN","GMTSULT",88,0)
ASKA(X) ; Ask if adding
"RTN","GMTSULT",89,0)
 N GMTSN,GMTSN,GMTSNX S GMTSN=$G(X) Q:'$L(X) 0  Q:+($$DUP^GMTSULT7(X))>0 0
"RTN","GMTSULT",90,0)
 N DIR,DTOUT,DIROUT,DIRUT,DUOUT S GMTSNX=+($$N)+1,GMTSNX=$S(GMTSNX=0:"",GMTSNX=1:(GMTSNX_"st"),GMTSNX=2:(GMTSNX_"nd"),GMTSNX=3:(GMTSNX_"rd"),1:(GMTSNX_"th"))
"RTN","GMTSULT",91,0)
 S DIR(0)="YAO",DIR("A",1)="Are you adding '"_GMTSN_"' as ",DIR("A")="    a new HEALTH SUMMARY TYPE"_$S($L(GMTSNX):(" (the "_GMTSNX_")"),1:"")_"?   ",DIR("B")="No"
"RTN","GMTSULT",92,0)
 W ! D ^DIR S:$D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) X="^" S:X["^" X="^" Q:X="^" 0
"RTN","GMTSULT",93,0)
 S X=+($G(Y)) S:+X'>0 X=0 Q X
"RTN","GMTSULT",94,0)
N(X) ; Number of Types
"RTN","GMTSULT",95,0)
 N I S (I,X)=0 F  S I=$O(^GMT(142,I)) Q:+I=0  S X=X+1
"RTN","GMTSULT",96,0)
 Q X
"RTN","GMTSULT",97,0)
SI ; Set Indexes
"RTN","GMTSULT",98,0)
 D MS N GMTS,GMTSX,GMTSO,GMTSC S GMTS=+($G(DA)),GMTSO=$G(X) Q:GMTS'>0  Q:'$D(^GMT(142,GMTS,0))  Q:'$L(X)  N X,DA
"RTN","GMTSULT",99,0)
 S DA=GMTS,GMTSX=0 F  S GMTSX=$O(^TMP($J,142,.01,1,GMTSX)) Q:+GMTSX=0  D
"RTN","GMTSULT",100,0)
 . S X=$G(^TMP($J,142,.01,1,GMTSX,1)) D ^DIM Q:'$D(X)  S GMTSC=X,X=GMTSO,DA=GMTS X GMTSC
"RTN","GMTSULT",101,0)
 D MK Q
"RTN","GMTSULT",102,0)
KI ; Kill Indexes
"RTN","GMTSULT",103,0)
 D MS N GMTS,GMTSX,GMTSO,GMTSC S GMTS=+($G(DA)),GMTSO=$G(X) N X,DA
"RTN","GMTSULT",104,0)
 S DA=GMTS,GMTSX=0 F  S GMTSX=$O(^TMP($J,142,.01,1,GMTSX)) Q:+GMTSX=0  D
"RTN","GMTSULT",105,0)
 . S X=$G(^TMP($J,142,.01,1,GMTSX,2)) D ^DIM Q:'$D(X)
"RTN","GMTSULT",106,0)
 . S GMTSC=X,X=GMTSO W !,GMTSC,?60,X,?70,DA
"RTN","GMTSULT",107,0)
 D MK Q
"RTN","GMTSULT",108,0)
MS ; Merge Set
"RTN","GMTSULT",109,0)
 M ^TMP($J,142,.01,1)=@("^DD("_142_",.01,1)") Q
"RTN","GMTSULT",110,0)
MK ; Merge Kill
"RTN","GMTSULT",111,0)
 K ^TMP($J,142,.01,1) Q
"RTN","GMTSULT",112,0)
TYPE(GMTSI) ; Get Health Summary Type  $$TYPE^GMTSULT
"RTN","GMTSULT",113,0)
 ;   Needs DIC(0)
"RTN","GMTSULT",114,0)
 ;   Optional DIC("A"), DIC("B"), DLAYGO
"RTN","GMTSULT",115,0)
 ;   Returns IEN
"RTN","GMTSULT",116,0)
 K Y S:$L($G(X)) X=$G(X)
"RTN","GMTSULT",117,0)
 D EN^GMTSULT S GMTSI=-1 S:+($G(Y))>0&($D(^GMT(142,+($G(Y)),0))) GMTSI=$G(Y) Q GMTSI
"RTN","GMTSULT",118,0)
XIEN(X) ; Is X in a Y or `IEN format  Quit +IEN
"RTN","GMTSULT",119,0)
 N GMTSX,GMTSL,GMTSI,GMTSN,GMTSY,GMTSOK
"RTN","GMTSULT",120,0)
 S GMTSX=$G(X),GMTSL=$E(GMTSX,1),GMTSI=$E(GMTSX,2,$L(GMTSX))
"RTN","GMTSULT",121,0)
 S GMTSOK=$$DICS^GMTSULT2($G(GMTSDICS),$P($G(^GMT(142,+GMTSI,0)),"^",1),+GMTSI) Q:'GMTSOK -1
"RTN","GMTSULT",122,0)
 I GMTSL="`",+GMTSI>0,+GMTSI=GMTSI,$D(^GMT(142,+GMTSI,0)),$L($P($G(^GMT(142,+GMTSI,0)),"^",1)) S X=GMTSI Q X
"RTN","GMTSULT",123,0)
 S GMTSI=$S($D(^GMT(142,+GMTSX,0)):+X,1:-1)
"RTN","GMTSULT",124,0)
 S GMTSN=$P($G(^GMT(142,+GMTSX,0)),"^",1)
"RTN","GMTSULT",125,0)
 I GMTSI=+GMTSX&(GMTSN=$P(GMTSX,"^",2)) S X=GMTSI Q X
"RTN","GMTSULT",126,0)
 Q 0
"RTN","GMTSULT",127,0)
LD ; Load DIC Variables
"RTN","GMTSULT",128,0)
 D DICHK S (DIC,GMTSDIC)="^GMT(142,",GMTSDIC0="AEM" S:$L($G(DLAYGO)) GMTSLGO=$G(DLAYGO) S GMTSDICA="Select HEALTH SUMMARY TYPE:  " K Y
"RTN","GMTSULT",129,0)
 S:$L($G(DIC("W"))) GMTSDICW=DIC("W") S:$L($G(DIC("S"))) GMTSDICS=DIC("S") S:$L($G(DIC("A"))) GMTSDICA=DIC("A") S:$L($G(DIC("B"))) GMTSDICB=DIC("B") S:$L($G(DIC(0))) GMTSDIC0=DIC(0)
"RTN","GMTSULT",130,0)
 Q
"RTN","GMTSULT",131,0)
 ;          
"RTN","GMTSULT",132,0)
 ; Lookup Screens - DIC("S")="I +$$..
"RTN","GMTSULT",133,0)
EOK(X) ;   Edit OK
"RTN","GMTSULT",134,0)
 N OK,GMTS S X=+($G(X)),OK=1 S:'$D(^GMT(142,+X,0)) OK=0 S:$P($G(^GMT(142,+X,"VA")),U)=2 OK=0 S X=OK Q X
"RTN","GMTSULT",135,0)
EST(X) ;   Edit Health Summary Type (other than Adhoc)
"RTN","GMTSULT",136,0)
 N GMTSI,GMTSO,GMTS S X=+($G(X))
"RTN","GMTSULT",137,0)
 ;     Invalid User
"RTN","GMTSULT",138,0)
 Q:'$L($P($G(^VA(200,+($G(DUZ)),0)),U)) 0 Q:+($G(DUZ(2)))=0 0
"RTN","GMTSULT",139,0)
 ;     Invalid Type
"RTN","GMTSULT",140,0)
 S GMTSI=$P($G(^GMT(142,+X,0)),U) Q:GMTSI="GMTS HS ADHOC OPTION"!(GMTSI="GMTS HS REMOTE ADHOC OPTION") 0
"RTN","GMTSULT",141,0)
 ;     National Uneditable/Developer
"RTN","GMTSULT",142,0)
 S GMTSI=+($P($G(^GMT(142,+X,"VA")),U)),GMTSO=$G(^XMB("NETNAME")) Q:GMTSI=2&'(GMTSO["ISC-SLC"&(+($G(DUZ(2)))=5000)) 0 Q:GMTSI=2&(GMTSO["ISC-SLC"&(+($G(DUZ(2)))=5000)) 1
"RTN","GMTSULT",143,0)
 ;     Owner
"RTN","GMTSULT",144,0)
 S GMTSI=+($P($G(^GMT(142,+X,0)),U,3)) Q:GMTSI>0&(GMTSI=+($G(DUZ))) 1
"RTN","GMTSULT",145,0)
 ;     Locked from Edit
"RTN","GMTSULT",146,0)
 S GMTSI=$P($G(^GMT(142,+X,0)),U,2),GMTSO=0 S:$L(GMTSI) GMTSO=$S(((+($G(DUZ))>0)&('$D(^XUSEC(GMTSI,+($G(DUZ)))))):1,1:0) Q:GMTSO=1 0
"RTN","GMTSULT",147,0)
 ;     Not the Owner, but Other Editor
"RTN","GMTSULT",148,0)
 S GMTSI=+($P($G(^GMT(142,+X,0)),U,3)),GMTSO=$D(^GMT(142,+X,2,"B",+($G(DUZ)))) Q:GMTSI>0&(+($G(DUZ))>0)&(GMTSI'=+($G(DUZ)))&(+GMTSO>0) 1
"RTN","GMTSULT",149,0)
 ;     Not the Owner
"RTN","GMTSULT",150,0)
 S GMTSI=+($P($G(^GMT(142,+X,0)),U,3)) Q:GMTSI>0&(GMTSI'=+($G(DUZ))) 0
"RTN","GMTSULT",151,0)
 ;     Has the Key
"RTN","GMTSULT",152,0)
 S GMTSI=$P($G(^GMT(142,+X,0)),U,2),GMTSO=0 S:$L(GMTSI) GMTSO=$S(((+($G(DUZ))>0)&($D(^XUSEC(GMTSI,+($G(DUZ)))))):1,1:0) Q:GMTSO=1 1
"RTN","GMTSULT",153,0)
 Q 1
"RTN","GMTSULT",154,0)
HST(X) ;   Health Summary Type
"RTN","GMTSULT",155,0)
 N GMTS S X=+($G(X)),GMTS=1 S:$P($G(^GMT(142,+X,0)),U)="GMTS HS ADHOC OPTION" GMTS=0 S:$P($G(^GMT(142,+X,0)),U)="GMTS HS REMOTE ADHOC OPTION" GMTS=0 S:+($G(^GMT(142,+X,"VA")))>0 GMTS=0
"RTN","GMTSULT",156,0)
 S X=GMTS Q X
"RTN","GMTSULT",157,0)
AHST(X) ;   Add Health Summary Type
"RTN","GMTSULT",158,0)
 N GMTS S X=+($G(X)),GMTS=1 S:$P($G(^GMT(142,+X,0)),U)="GMTS HS ADHOC OPTION" GMTS=0 S:$P($G(^GMT(142,+X,0)),U)="GMTS HS REMOTE ADHOC OPTION" GMTS=0
"RTN","GMTSULT",159,0)
 S:((+X>4999999)&(+X<6000000)) GMTS=0 S:+($G(^GMT(142,+X,"VA")))>0 GMTS=0
"RTN","GMTSULT",160,0)
 S X=GMTS Q X
"RTN","GMTSULT",161,0)
ADH(X) ;   Adhoc
"RTN","GMTSULT",162,0)
 N GMTS S X=+($G(X)),GMTS=1 S:$P($G(^GMT(142,+X,0)),U)'="GMTS HS ADHOC OPTION" GMTS=0 S X=GMTS Q X
"RTN","GMTSULT",163,0)
REM(X) ;   Remote Adhoc
"RTN","GMTSULT",164,0)
 N GMTS S X=+($G(X)),GMTS=1 S:$P($G(^GMT(142,+X,0)),U)'="GMTS HS REMOTE ADHOC OPTION" GMTS=0 S X=GMTS Q X
"RTN","GMTSULT",165,0)
 Q
"RTN","GMTSULT",166,0)
 ;          
"RTN","GMTSULT",167,0)
DICHK ; Check DIC variables
"RTN","GMTSULT",168,0)
 K DIC("DR"),DIC("P"),DIC("V"),DINUM,DTOUT,DUOUT
"RTN","GMTSULT",169,0)
 S:'$L($G(DIC(0))) DIC(0)="AEMZB" S:'$L($G(DIC)) DIC="^GMT(142,"
"RTN","GMTSULT",170,0)
 I +($G(GMTSE))=0 F  Q:DIC(0)'["E"  S DIC(0)=$P(DIC(0),"E",1)_$P(DIC(0),"E",2)
"RTN","GMTSULT",171,0)
 S:'$L($G(DIC("A"))) DIC("A")="Select HEALTH SUMMARY TYPE:  "
"RTN","GMTSULT",172,0)
 Q
"RTN","GMTSULT",173,0)
RD ; Restore DIC Variables
"RTN","GMTSULT",174,0)
 S:$L($G(GMTSDIC)) DIC=GMTSDIC S:$L($G(GMTSDICS)) DIC("S")=GMTSDICS
"RTN","GMTSULT",175,0)
 S:$L($G(GMTSDICW)) DIC("W")=GMTSDICW S:$L($G(GMTSDICA)) DIC("A")=GMTSDICA
"RTN","GMTSULT",176,0)
 S:$L($G(GMTSDICB)) DIC("B")=GMTSDICB S:$L($G(GMTSDIC0)) DIC(0)=GMTSDIC0
"RTN","GMTSULT",177,0)
 I $L($G(X)),X["`" D
"RTN","GMTSULT",178,0)
 . N GMTSI,GMTSL S GMTSL=$E(X,1),GMTSI=$E(X,2,$L(X))
"RTN","GMTSULT",179,0)
 . I GMTSL="`",+GMTSI>0,$D(^GMT(142,+GMTSI,0)),$L($P($G(^GMT(142,+GMTSI,0)),"^",1)) S X=$P($G(^GMT(142,+GMTSI,0)),"^",1)
"RTN","GMTSULT",180,0)
 K GMTSDICS,GMTSDIC,GMTSDIC0,GMTSDICB,GMTS,GMTSDISV,GMTSDICA Q
"RTN","GMTSULT",181,0)
ECHO(X) ; Echo Results (writes/reads)
"RTN","GMTSULT",182,0)
 S X=$$ROK("XWBLIB") Q:'X 1 S X=$$BROKER^XWBLIB Q:X 0 Q 1
"RTN","GMTSULT",183,0)
SDISV(Y) ; Set DISV (IEN)
"RTN","GMTSULT",184,0)
 Q:+($G(DUZ))=0!(+($G(Y))=0)
"RTN","GMTSULT",185,0)
 D RECALL^DILFD(142,+($G(Y))_",",+($G(DUZ))) Q
"RTN","GMTSULT",186,0)
RDISV(X) ; Read DISV
"RTN","GMTSULT",187,0)
 Q:+($G(DUZ))=0 ""
"RTN","GMTSULT",188,0)
 N DIC,Y S DIC=142,DIC(0)="Z",X=" " D ^DIC S X=$S(+Y>0:Y,1:"") Q X
"RTN","GMTSULT",189,0)
ROK(X) ; Routine OK
"RTN","GMTSULT",190,0)
 S X=$G(X) Q:'$L(X) 0 Q:$L(X)>8 0 X ^%ZOSF("TEST") Q:$T 1 Q 0
"RTN","GMTSULT",191,0)
CLR ;   Kill ^TMP("GMTS*
"RTN","GMTSULT",192,0)
 K ^TMP("GMTSULT",$J),^TMP("GMTSULT2",$J) Q
"RTN","GMTSULT",193,0)
CLEAN ;   Kill ^TMP("GMTSULT2")
"RTN","GMTSULT",194,0)
 K ^TMP("GMTSULT2",$J) Q
"RTN","GMTSULT7")
0^38^B29646296
"RTN","GMTSULT7",1,0)
GMTSULT7 ; SLC/KER - HS Type Lookup ("B" index)     ; 09/21/2001
"RTN","GMTSULT7",2,0)
 ;;2.7;Health Summary;**30,47**;Oct 20, 1995
"RTN","GMTSULT7",3,0)
 ;
"RTN","GMTSULT7",4,0)
 ; External References
"RTN","GMTSULT7",5,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMTSULT7",6,0)
 ;                      
"RTN","GMTSULT7",7,0)
 Q
"RTN","GMTSULT7",8,0)
B ; Search "B" Index
"RTN","GMTSULT7",9,0)
 ;                      
"RTN","GMTSULT7",10,0)
 ;   Needs GMTSEQ and GMTSEO
"RTN","GMTSULT7",11,0)
 ;                      
"RTN","GMTSULT7",12,0)
 ;     GMTSEQ=1 Exact match reqired
"RTN","GMTSULT7",13,0)
 ;              Stop search if found
"RTN","GMTSULT7",14,0)
 ;              Continue partial-exact search if not found
"RTN","GMTSULT7",15,0)
 ;                      
"RTN","GMTSULT7",16,0)
 ;     GMTSEO=1 Exact match, only one entry
"RTN","GMTSULT7",17,0)
 ;              Stop search if found and return single entry
"RTN","GMTSULT7",18,0)
 ;              Do not continue if not found
"RTN","GMTSULT7",19,0)
 ;                      
"RTN","GMTSULT7",20,0)
 D CLR^GMTSULT S X=$G(X) Q:'$L(X)  N GMTSKL1,GMTSKL2,GMTSIV,GMTSIEN,GMTSDS,GMTSD0,GMTSDW,GMTSC,GMTSE
"RTN","GMTSULT7",21,0)
 S GMTSKL1=$$LO($E(X,1)),GMTSKL2=$$UP(GMTSKL1),U="^",(GMTSE,GMTSC)=0
"RTN","GMTSULT7",22,0)
 S:$L($G(DIC("S")))&('$L($G(GMTSDICS))) GMTSDICS=$G(DIC("S")),GMTSDS=1
"RTN","GMTSULT7",23,0)
 S:$L($G(DIC(0)))&('$L($G(GMTSDIC0))) GMTSDIC0=$G(DIC(0)),GMTSD0=1
"RTN","GMTSULT7",24,0)
 S:$L($G(DIC("W")))&('$L($G(GMTSDICW))) GMTSDICW=$G(DIC("W")),GMTSDW=1
"RTN","GMTSULT7",25,0)
 D:$G(GMTSDIC0)'["M" CLR^GMTSULT
"RTN","GMTSULT7",26,0)
 S GMTSIV=$C($A(GMTSKL1)-1)_"~" F  S GMTSIV=$O(^GMT(142,"B",GMTSIV)) Q:GMTSIV=""!($E(GMTSIV,1)'=GMTSKL1)  Q:GMTSE  D  Q:GMTSE
"RTN","GMTSULT7",27,0)
 . Q:$$UP($E(X,1,30))'=$$UP($E(GMTSIV,1,$L(X)))  S GMTSIEN=0 F  S GMTSIEN=$O(^GMT(142,"B",GMTSIV,GMTSIEN)) Q:+GMTSIEN=0  Q:GMTSE  D CK  Q:GMTSE
"RTN","GMTSULT7",28,0)
 S GMTSIV=$C($A(GMTSKL2)-1)_"~" F  S GMTSIV=$O(^GMT(142,"B",GMTSIV)) Q:GMTSIV=""!($E(GMTSIV,1)'=GMTSKL2)  Q:GMTSE  D  Q:GMTSE
"RTN","GMTSULT7",29,0)
 . Q:$$UP($E(X,1,30))'=$$UP($E(GMTSIV,1,$L(X)))  S GMTSIEN=0 F  S GMTSIEN=$O(^GMT(142,"B",GMTSIV,GMTSIEN)) Q:+GMTSIEN=0  Q:GMTSE  D CK  Q:GMTSE
"RTN","GMTSULT7",30,0)
BQ ; Quit "B" Index search
"RTN","GMTSULT7",31,0)
 K:+($G(GMTSDS))>0 GMTSDICS K:+($G(GMTSD0))>0 GMTSDIC0 K:+($G(GMTSDW))>0 GMTSDICW
"RTN","GMTSULT7",32,0)
 D REO
"RTN","GMTSULT7",33,0)
 Q
"RTN","GMTSULT7",34,0)
 ;                      
"RTN","GMTSULT7",35,0)
 ; Build list
"RTN","GMTSULT7",36,0)
CK ;   Check Entry
"RTN","GMTSULT7",37,0)
 N GMTSCK,GMTSNM,GMTSTL,GMTSOW,GMTSCMP,GMTSOKS,GMTSDT,GMTSDT2 S GMTSTL=$P($G(^GMT(142,+GMTSIEN,"T")),U,1),GMTSNM=$P($G(^GMT(142,+GMTSIEN,0)),U,1)
"RTN","GMTSULT7",38,0)
 S GMTSDT=GMTSNM S:$$UP(GMTSNM)'=$$UP(GMTSTL)&($L(GMTSTL)) GMTSDT=GMTSNM_" ("_GMTSTL_")"
"RTN","GMTSULT7",39,0)
 S GMTSOW=+($P($G(^GMT(142,+GMTSIEN,0)),U,3)) S:GMTSOW<1 GMTSOW="" S:+GMTSOW>0 GMTSOW=$P($G(^VA(200,+GMTSOW,0)),U,1)
"RTN","GMTSULT7",40,0)
 S GMTSCMP=$$CM^GMTSULT2(GMTSIEN) S:$D(GMTSDICW) GMTSDT=GMTSNM S GMTSDT=$$MX(GMTSDT),GMTSOKS=+($$DICS^GMTSULT2($G(GMTSDICS),GMTSNM,+GMTSIEN)) Q:'GMTSOKS  S GMTSCK="GMTSNM"
"RTN","GMTSULT7",41,0)
 I +($G(GMTSEO)) I $L($G(X))>0,$$UP($G(X))=$$UP($G(GMTSNM)) S GMTSE=1,GMTSCK="GMTSNM" D EA Q
"RTN","GMTSULT7",42,0)
 I $L($G(X))>0,$$UP($G(X))=$$UP($G(GMTSNM)) S GMTSCK="GMTSNM" D EA Q
"RTN","GMTSULT7",43,0)
 D MA Q
"RTN","GMTSULT7",44,0)
MA ;   Add Match
"RTN","GMTSULT7",45,0)
 Q:$D(^TMP("GMTSULT2",$J,"IEN",+GMTSIEN))
"RTN","GMTSULT7",46,0)
 S GMTSC=+($G(GMTSC))+1,^TMP("GMTSULT2",$J,GMTSC)=$$ASM,^TMP("GMTSULT2",$J,0)=GMTSC,^TMP("GMTSULT2",$J,"B",(GMTSNM_" "),GMTSC)=""
"RTN","GMTSULT7",47,0)
 Q
"RTN","GMTSULT7",48,0)
EA ;   Add Exact Match
"RTN","GMTSULT7",49,0)
 S GMTSC=+($G(GMTSC))+1 S GMTSCMP=$$CM^GMTSULT2(GMTSIEN) S ^TMP("GMTSULT2",$J,"EM")=+GMTSIEN,^TMP("GMTSULT2",$J,"IEN",+GMTSIEN)="",^TMP("GMTSULT2",$J,"B",(GMTSNM_" "),GMTSC)="",^TMP("GMTSULT2",$J,"EMI")=GMTSC
"RTN","GMTSULT7",50,0)
 S ^TMP("GMTSULT2",$J,"EMB")=GMTSNM_" ",^TMP("GMTSULT2",$J,GMTSC)=$$ASM,^TMP("GMTSULT2",$J,0)=GMTSC,^TMP("GMTSULT2",$J,"B",(GMTSNM_" "))=""
"RTN","GMTSULT7",51,0)
 Q
"RTN","GMTSULT7",52,0)
ASM(X) ;   Assemble string to store in list
"RTN","GMTSULT7",53,0)
 N GMTST S GMTST=$G(GMTSTL) S:$L($G(GMTSDT))&($G(GMTSDT)'=$G(GMTST)) GMTST=GMTSDT
"RTN","GMTSULT7",54,0)
 S X=+($G(GMTSIEN)),X=X_U_$G(GMTSNM)_U_$G(GMTSTL)_U_$G(GMTSOW)_U_U_$G(GMTSCMP)_U_GMTST
"RTN","GMTSULT7",55,0)
 Q X
"RTN","GMTSULT7",56,0)
 ;                      
"RTN","GMTSULT7",57,0)
REO ; Reorder List
"RTN","GMTSULT7",58,0)
 N GMTSC,GMTSFND,GMTSG,GMTSI,GMTSIEN,GMTSKEY,GMTSL,GMTSCMP,GMTSOW,GMTSTTL,GMTSLOC,GMTSMN,GMTSNM
"RTN","GMTSULT7",59,0)
 S GMTSI=0,GMTSFND=""
"RTN","GMTSULT7",60,0)
 ;   Add exact match to the top of the selection list
"RTN","GMTSULT7",61,0)
 I '$D(^TMP("GMTSULT2",$J,"EMI")),+($G(GMTSEO)) K ^TMP("GMTSULT2",$J)
"RTN","GMTSULT7",62,0)
 I $D(^TMP("GMTSULT2",$J,"EMI")) D
"RTN","GMTSULT7",63,0)
 . S GMTSI=0,GMTSC=$G(^TMP("GMTSULT2",$J,"EMI")) D ADD
"RTN","GMTSULT7",64,0)
 . S ^TMP("GMTSULT",$J,0)=GMTSI K ^TMP("GMTSULT2",$J,"EMI")
"RTN","GMTSULT7",65,0)
 . ;   Kill global (quit) if Exact Match is found
"RTN","GMTSULT7",66,0)
 . ;     and DIR(0) either contains OE or X
"RTN","GMTSULT7",67,0)
 . K:+($G(GMTSEQ)) ^TMP("GMTSULT2",$J) K:+($G(GMTSEO)) ^TMP("GMTSULT2",$J)
"RTN","GMTSULT7",68,0)
 ;   Kill global (quit) if Exact Match is not 
"RTN","GMTSULT7",69,0)
 ;     found and DIR(0)["OE"
"RTN","GMTSULT7",70,0)
 I '$D(^TMP("GMTSULT2",$J,"EMI")),+($G(GMTSEO)) K ^TMP("GMTSULT2",$J)
"RTN","GMTSULT7",71,0)
 ;   Add other entries in Alphabetical Order
"RTN","GMTSULT7",72,0)
 S GMTSFND=0 Q:'$D(^TMP("GMTSULT2",$J,"B"))  F  S GMTSFND=$O(^TMP("GMTSULT2",$J,"B",GMTSFND)) Q:GMTSFND=""  D
"RTN","GMTSULT7",73,0)
 . S GMTSC=0 F  S GMTSC=$O(^TMP("GMTSULT2",$J,"B",GMTSFND,GMTSC)) Q:+GMTSC=0  D ADD
"RTN","GMTSULT7",74,0)
 D CLEAN^GMTSULT
"RTN","GMTSULT7",75,0)
 Q
"RTN","GMTSULT7",76,0)
ADD ;   Add to the reordered list
"RTN","GMTSULT7",77,0)
 N GMTS0,GMTS1,GMTS2,GMTS3,GMTS4,GMTS5,GMTS6,GMTS7
"RTN","GMTSULT7",78,0)
 S GMTSI=+($G(GMTSI))+1,GMTS0=$G(^TMP("GMTSULT2",$J,GMTSC)) S (GMTSG,GMTSMN,GMTS2)=$$MX($P(GMTS0,U,2)) S (GMTS1,GMTSIEN)=+($P(GMTS0,U,1)) S GMTSNM=$$UP(GMTSMN)
"RTN","GMTSULT7",79,0)
 S (GMTS4,GMTSOW)=$$MX($P(GMTS0,U,4)),GMTSOW=GMTSOW_")" S (GMTS3,GMTSTTL)=$$MX($P(GMTS0,U,3)),GMTSTTL=GMTSTTL_")" S (GMTS5,GMTSLOC)=$$MX($P(GMTS0,U,5)),GMTSLOC=GMTSLOC_")"
"RTN","GMTSULT7",80,0)
 S (GMTS6,GMTSCMP)=$P(GMTS0,U,6),GMTSL=$P(GMTS0,U,4),GMTSG=$P(GMTS0,U,7)
"RTN","GMTSULT7",81,0)
 S:$L(GMTSG)&(GMTSG'[")")&(GMTSG'["(")&(+GMTS6=0)&($L(GMTS6)) GMTSG=GMTSG_" ("_GMTS6_")"
"RTN","GMTSULT7",82,0)
 S GMTS7=GMTSG S ^TMP("GMTSULT",$J,GMTSI)=GMTS1_U_GMTS2_U_GMTS3_U_GMTS4_U_GMTS5_U_GMTS6_U_GMTS7
"RTN","GMTSULT7",83,0)
 S ^TMP("GMTSULT",$J,0)=GMTSI
"RTN","GMTSULT7",84,0)
 Q
"RTN","GMTSULT7",85,0)
 ;                  
"RTN","GMTSULT7",86,0)
 ; Miscellaneous
"RTN","GMTSULT7",87,0)
UP(X) ;   Uppercase
"RTN","GMTSULT7",88,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSULT7",89,0)
LO(X) ;   Lowercase
"RTN","GMTSULT7",90,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","GMTSULT7",91,0)
MX(X) ;   Mix Case
"RTN","GMTSULT7",92,0)
 Q $$EN^GMTSUMX(X)
"RTN","GMTSULT7",93,0)
DUP(X) ; Check for Duplicate
"RTN","GMTSULT7",94,0)
 S X=$G(X) Q:'$L(X) 0  N GMTSE,GMTSI S (GMTSE,GMTSI)=0
"RTN","GMTSULT7",95,0)
 F  S GMTSI=$O(^GMT(142,"B",$E(X,1,30),GMTSI)) Q:+GMTSI=0  D  Q:GMTSE
"RTN","GMTSULT7",96,0)
 . S GMTSN=$P($G(^GMT(142,+GMTSI,0)),"^",1) S:$$UP^GMTSULT2(X)=$$UP^GMTSULT2(GMTSN) GMTSE=1
"RTN","GMTSULT7",97,0)
 S X=+($G(GMTSE)) Q X
"RTN","GMTSUP")
0^48^B14910426
"RTN","GMTSUP",1,0)
GMTSUP ; SLC/KER - Utilities for Paging HS           ; 09/21/2001
"RTN","GMTSUP",2,0)
 ;;2.7;Health Summary;**2,7,21,27,28,30,35,47**;Oct 20, 1995
"RTN","GMTSUP",3,0)
 ;
"RTN","GMTSUP",4,0)
 ; External References
"RTN","GMTSUP",5,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSUP",6,0)
 ;   DBIA    82  EN^XQORM
"RTN","GMTSUP",7,0)
 ;                       
"RTN","GMTSUP",8,0)
CKP ; Check page position, pause and prompt
"RTN","GMTSUP",9,0)
 Q:$D(GMTSQIT)  S GMTSNPG=0 I $G(GMTSWRIT)=1 D BREAK S GMTSWRIT=0
"RTN","GMTSUP",10,0)
 I +($$HF^GMTSU) D BREAK:(GMTSEGN'=$G(GMTSLCMP)) Q
"RTN","GMTSUP",11,0)
 Q:+$G(GMTSLPG)'>0&($Y'>(IOSL-GMTSLO))
"RTN","GMTSUP",12,0)
 I $E(IOST,1)="C" S:'$D(GMTSTOF) GMTSTOF=1 D CKP1
"RTN","GMTSUP",13,0)
 I '$D(GMTSQIT) W @IOF D HEADER,BREAK S GMTSNPG=1,GMTSTOF=GMTSEGN
"RTN","GMTSUP",14,0)
 I $D(GMTSQIT),(GMTSQIT]""),($D(GMTSTYP)) W @IOF D HEADER S GMTSTOF=GMTSEGN
"RTN","GMTSUP",15,0)
 Q
"RTN","GMTSUP",16,0)
CKP1 ; Help Display of Optional Components for Navigation
"RTN","GMTSUP",17,0)
 N DA,I,J,K,L,X,XQORM,Y,GMTSY,TYP,DIC
"RTN","GMTSUP",18,0)
 I $S('$D(GMTSTYP):1,$D(GMTOPT):1,1:0) N DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!(GMTSLPG) GMTSQIT="" Q
"RTN","GMTSUP",19,0)
 S TYP=GMTSTYP
"RTN","GMTSUP",20,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION" S Y=$$TYPE^GMTSULT
"RTN","GMTSUP",21,0)
 S GMTSTYP=+Y K DIC,X,Y
"RTN","GMTSUP",22,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="1AF\+",XQORM("A")="Press <RET> to continue, ^ to exit, or select component: "
"RTN","GMTSUP",23,0)
 S XQORM("??")="D HELP^GMTSUP1" I GMTSLPG W "* END * "
"RTN","GMTSUP",24,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")"
"RTN","GMTSUP",25,0)
 D EN^XQORM W ! D @$S(Y=1:"BRNCH",1:"EVAL")
"RTN","GMTSUP",26,0)
 I $D(GMTSY),(GMTSY=0) K GMTSY G CKP1
"RTN","GMTSUP",27,0)
 S GMTSTYP=TYP
"RTN","GMTSUP",28,0)
 Q
"RTN","GMTSUP",29,0)
BREAK ; Writes the component header
"RTN","GMTSUP",30,0)
 S:'$D(GMTSLCMP) GMTSLCMP=0
"RTN","GMTSUP",31,0)
 S GMTS="",GMTSNPG=1,$P(GMTS,"-",79-$L(GMTSEGH_GMTSEGL)/2)="",GMTS=GMTS_" "_GMTSEGH_GMTSEGL_" "_GMTS
"RTN","GMTSUP",32,0)
 I $Y'>(IOSL-GMTSLO)!(+($$HF^GMTSU)) W !,GMTS,! W:$Y'>(IOSL-GMTSLO) ?34,$S(GMTSEGN=GMTSLCMP:"(continued)",1:""),! S GMTSLCMP=GMTSEGN
"RTN","GMTSUP",33,0)
 Q
"RTN","GMTSUP",34,0)
HEADER ; Print Running Header
"RTN","GMTSUP",35,0)
 N GMTSVDT,DATA S DATA="" I +$G(GMTSPXD1)&+$G(GMTSPXD2) D
"RTN","GMTSUP",36,0)
 . S DATA="Printed for data " I GMTSPXD1=GMTSPXD2 S DATA=DATA_"on "_GMTSPXD1 Q
"RTN","GMTSUP",37,0)
 . S DATA=DATA_"from "_GMTSPXD2_" to "_GMTSPXD1
"RTN","GMTSUP",38,0)
 I $D(GMTSCDT(0)) S GMTSVDT=GMTSCDT(0) S:GMTSDTM'["Printed:" GMTSDTM="Printed: "_GMTSDTM
"RTN","GMTSUP",39,0)
 W !,$S($L($P($G(GMTSSC),U,2)):"Location: "_$P(GMTSSC,U,2)_" ",1:""),$S($D(GMTSVDT):GMTSVDT,1:""),DATA,?(79-$L(GMTSDTM)),GMTSDTM
"RTN","GMTSUP",40,0)
 S:'$D(GMTSPG) GMTSPG=0 S GMTSPG=GMTSPG+1,GMTSHDR=" CONFIDENTIAL "_GMTSTITL_" SUMMARY "_$S($E(IOST,1)="C":"",1:"  pg. "_GMTSPG) S GMTS="",$P(GMTS,"*",(77-$L(GMTSHDR))\2)="*" S GMTSHDR=GMTS_" "_GMTSHDR_" "_GMTS
"RTN","GMTSUP",41,0)
 W !,GMTSHDR,"*" I '$D(GMTSLFG) D
"RTN","GMTSUP",42,0)
 . I $G(GMTSPHDR("TWO")) D
"RTN","GMTSUP",43,0)
 . . W !,GMTSPHDR("NMSSN"),?GMTSPHDR("DOBS"),GMTSPHDR("DOB"),!?GMTSPHDR("WARDRBS"),GMTSPHDR("WARDRB"),!
"RTN","GMTSUP",44,0)
 . E  W !,GMTSPHDR("NMSSN"),?GMTSPHDR("WARDRBS"),GMTSPHDR("WARDRB"),?GMTSPHDR("DOBS"),GMTSPHDR("DOB"),!
"RTN","GMTSUP",45,0)
 W:+$G(VADM(6)) ?26,"** DECEASED   "_$P(VADM(6),U,2)_" **"
"RTN","GMTSUP",46,0)
 Q
"RTN","GMTSUP",47,0)
BRNCH ; Checks abbreviation to branch to a different component
"RTN","GMTSUP",48,0)
 N GMTINX,LIM,CREC,SBS
"RTN","GMTSUP",49,0)
 I Y,("+-"[X) S:X="-" GMTSEGN=GMTSTOF-1 S (GMTSY,GMTSQIT)=1,GMTSLPG=0 Q
"RTN","GMTSUP",50,0)
 I X="^^" S DIROUT=1,GMTSQIT="" Q
"RTN","GMTSUP",51,0)
 I Y,(X?1"^^".E) Q
"RTN","GMTSUP",52,0)
 S GMTINX=$S($D(^GMT(142,GMTSTYP,1,+Y(1),0)):$P(^(0),U,2),1:"")
"RTN","GMTSUP",53,0)
 I 'GMTINX S GMTSY=0 Q
"RTN","GMTSUP",54,0)
 I '$D(GMTSEGI(GMTINX)) N GMI,GMJ,GMTSDFLT S GMI=1,GMJ=GMTSEGC,GMTSDFLT=1 D LOAD^GMTSADH S GMTSEGC=GMTSEGC+1
"RTN","GMTSUP",55,0)
 I '$D(GMTSEGI(GMTINX)) S GMTINX="",GMTSY=0 Q
"RTN","GMTSUP",56,0)
 S LIM=$P(Y(1),U,4) I LIM'["=" G NOLIM
"RTN","GMTSUP",57,0)
 S CREC=^GMT(142.1,GMTINX,0),SBS=GMTSEGI(GMTINX) D CMPLIM^GMTSADH2
"RTN","GMTSUP",58,0)
 I $D(DIROUT) S GMTSQIT="" Q
"RTN","GMTSUP",59,0)
NOLIM ; No limits
"RTN","GMTSUP",60,0)
 S GMTSEGN=GMTSEGI(GMTINX)-1,(GMTSY,GMTSQIT)=1,GMTSLPG=0
"RTN","GMTSUP",61,0)
 Q
"RTN","GMTSUP",62,0)
 ;
"RTN","GMTSUP",63,0)
EVAL ; Evaluate input to determine quit or continue
"RTN","GMTSUP",64,0)
 Q:'$D(X)
"RTN","GMTSUP",65,0)
 S:$D(GMTSEXIT) GMTSEXIT=$G(X)
"RTN","GMTSUP",66,0)
 S:$D(DTOUT) DIROUT=1 I $S(X="^^":1,GMTSLPG:1,$D(DIROUT):1,X="^":1,1:0) S GMTSQIT=""
"RTN","GMTSUP",67,0)
 I +$G(GMPSAP),(X="^") S GMDUOUT=1
"RTN","GMTSUP",68,0)
 Q
"RTN","GMTSUP1")
0^49^B18024579
"RTN","GMTSUP1",1,0)
GMTSUP1 ; SLC/JER,KER - Utilities for Paging HS ; 09/21/2001
"RTN","GMTSUP1",2,0)
 ;;2.7;Health Summary;**28,29,47**;Oct 20, 1995
"RTN","GMTSUP1",3,0)
 ;
"RTN","GMTSUP1",4,0)
 ; External References
"RTN","GMTSUP1",5,0)
 ;   DBIA 10102  DISP^XQORM1
"RTN","GMTSUP1",6,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSUP1",7,0)
 ;                 
"RTN","GMTSUP1",8,0)
RJUMP ; XQOR for "^^"-jump is no longer supported
"RTN","GMTSUP1",9,0)
 N GMDFN,GMTSAV W !,"Jumping not allowed.",! H 1 G RETURN
"RTN","GMTSUP1",10,0)
RETURN ; Return to Health Summary without Jump
"RTN","GMTSUP1",11,0)
 W:$G(GMTSAV)'["?" !,">>>  Returning to Health Summary",! H 1
"RTN","GMTSUP1",12,0)
 Q
"RTN","GMTSUP1",13,0)
HELP ; Offers help to confused individuals
"RTN","GMTSUP1",14,0)
 N GMQUIT
"RTN","GMTSUP1",15,0)
 W @IOF
"RTN","GMTSUP1",16,0)
 I X="?",GMTSTYP=TYP W "These components have been selected for Ad Hoc.",! S FLG=1 D LIST K FLG Q:$D(DTOUT)  D HELP1 W ! Q
"RTN","GMTSUP1",17,0)
 I X="?",GMTSTYP'=TYP W "These components are part of ",GMTSTITL," Health Summary Type",!,"or have been temporarily added.  Added components are indicated by *.",! S FLG=2 D LIST K FLG Q:$D(DTOUT)  D HELP1 W ! Q
"RTN","GMTSUP1",18,0)
 I X="??" W "These components may be temporarily added (use ""=C"" to change limits)." D DISP^XQORM1 W !!
"RTN","GMTSUP1",19,0)
 I X="???" D HELP2
"RTN","GMTSUP1",20,0)
 Q
"RTN","GMTSUP1",21,0)
HELP1 ; Writes part of help prompt
"RTN","GMTSUP1",22,0)
 D SCRNLNTH Q:$D(GMQUIT)  W !!
"RTN","GMTSUP1",23,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "To leave display order and jump to a different component, select any component",!
"RTN","GMTSUP1",24,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "from the  above list,  or select  any additional  component to  be temporarily",!
"RTN","GMTSUP1",25,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "added  to the display.   Add ""=C"" to  component to change  limits or selection",!
"RTN","GMTSUP1",26,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "items.  EXAMPLE: LO=C",!!
"RTN","GMTSUP1",27,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "Enter: ??    to see additional components.",!
"RTN","GMTSUP1",28,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"???   to see HELP for ""^^""-jump.",!
"RTN","GMTSUP1",29,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"<RET> to continue display.",!
"RTN","GMTSUP1",30,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"+     to proceed to next component.",!
"RTN","GMTSUP1",31,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"-     to return to preceeding component.",!
"RTN","GMTSUP1",32,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"^     to quit present patient's summary.",!
"RTN","GMTSUP1",33,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?7,"^^    to quit and return to menu.",!!
"RTN","GMTSUP1",34,0)
 Q
"RTN","GMTSUP1",35,0)
HELP2 ; Help for "^^"-jump
"RTN","GMTSUP1",36,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?22,"Navigation OUTSIDE of Health Summary",!!
"RTN","GMTSUP1",37,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "You may also enter ""^^"" followed by the name, partial name or synonym for",!
"RTN","GMTSUP1",38,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "any of a  variety of options  OUTSIDE of Health Summary  to which you can",!
"RTN","GMTSUP1",39,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "jump.  Partial matches will allow you to select from a subset of options.",!!
"RTN","GMTSUP1",40,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "For example:  ^^?    will list ALL available options.",!
"RTN","GMTSUP1",41,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?14,"^^PN   will show you all of the PROGRESS NOTES options, or",!
"RTN","GMTSUP1",42,0)
 D SCRNLNTH Q:$D(GMQUIT)  W ?14,"^^OR   will show you all of the ORDER ENTRY options.",!!
"RTN","GMTSUP1",43,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "You may also  order a wide variety of LABORATORY tests using this syntax.",!
"RTN","GMTSUP1",44,0)
 D SCRNLNTH Q:$D(GMQUIT)  W "e.g., ^^CHEM 7 will allow you to ADD an order for that test.",!!
"RTN","GMTSUP1",45,0)
 Q
"RTN","GMTSUP1",46,0)
LIST ; List components
"RTN","GMTSUP1",47,0)
 N GMI,DUOUT
"RTN","GMTSUP1",48,0)
 S GMI=0 F  S GMI=$O(GMTSEG(GMI)) Q:GMI'>0  D SCRNLNTH Q:$D(DUOUT)!($D(DTOUT))  D LIST1 Q:$D(DUOUT)!($D(DTOUT))
"RTN","GMTSUP1",49,0)
 Q
"RTN","GMTSUP1",50,0)
SCRNLNTH ; Checks screen length
"RTN","GMTSUP1",51,0)
 N DIR
"RTN","GMTSUP1",52,0)
 Q:$Y'>(IOSL-4)
"RTN","GMTSUP1",53,0)
 S DIR(0)="E"
"RTN","GMTSUP1",54,0)
 D ^DIR I $S($D(DUOUT):1,$D(DTOUT):1,1:0) S GMQUIT=""
"RTN","GMTSUP1",55,0)
 W:'$D(GMQUIT) @IOF
"RTN","GMTSUP1",56,0)
 Q
"RTN","GMTSUP1",57,0)
LIST1 ; Lists component information
"RTN","GMTSUP1",58,0)
 N CREC S CREC=^GMT(142.1,$P(GMTSEG(GMI),U,2),0)
"RTN","GMTSUP1",59,0)
 W:GMI#2 ! W ?$S(GMI#2:0,1:40) D:FLG=2 STAR W $P(CREC,U,4),?$S(GMI#2:8,1:48),$E($S($L($P(GMTSEG(GMI),U,5)):$P(GMTSEG(GMI),U,5),$L($P(CREC,U,9)):$P(CREC,U,9),1:$P(CREC,U)),1,24)
"RTN","GMTSUP1",60,0)
 Q
"RTN","GMTSUP1",61,0)
STAR ; Writes * to indicate added component when called by GMTSUP
"RTN","GMTSUP1",62,0)
 ; for HST other than AD HOC
"RTN","GMTSUP1",63,0)
 W $S($D(^GMT(142,TYP,1,"C",$P(GMTSEG(GMI),U,2))):" ",1:"*")
"RTN","GMTSUP1",64,0)
 Q
"RTN","GMTSXA")
0^2^B17389628
"RTN","GMTSXA",1,0)
GMTSXA ; SLC/KER - List Parameters                       ; 09/21/2001
"RTN","GMTSXA",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXA",3,0)
 Q
"RTN","GMTSXA",4,0)
 ;                                
"RTN","GMTSXA",5,0)
 ; External References in GMTSXA
"RTN","GMTSXA",6,0)
 ;                                  
"RTN","GMTSXA",7,0)
 ;   DBIA  2336  EDITPAR^XPAREDIT
"RTN","GMTSXA",8,0)
 ;   DBIA  2336  EDIT^XPAREDIT
"RTN","GMTSXA",9,0)
 ;   DBIA  2343  $$ACTIVE^XUSER
"RTN","GMTSXA",10,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","GMTSXA",11,0)
 ;                        
"RTN","GMTSXA",12,0)
DISP ; Display User Defaults
"RTN","GMTSXA",13,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0  S GMTSMGR=$$MGR^GMTSXAW3 D:+GMTSMGR>0 DM D:+GMTSMGR'>0 DU Q
"RTN","GMTSXA",14,0)
DU ;   Display - User Entry Point
"RTN","GMTSXA",15,0)
 N GMTSENV S GMTSENV=$$ENV Q:+GMTSENV'>0  D EN^GMTSXAD Q
"RTN","GMTSXA",16,0)
DM ;   Display - Manager Entry Point
"RTN","GMTSXA",17,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0  S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXA",18,0)
 S GMTSUSR=$$USR^GMTSXAW3("Display defaults for user:  ") W:+GMTSUSR>0 ! D:+GMTSUSR>0 EN2^GMTSXAD(GMTSUSR) Q
"RTN","GMTSXA",19,0)
 ;                                 
"RTN","GMTSXA",20,0)
PREC ; Set Precedence
"RTN","GMTSXA",21,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0  S GMTSMGR=$$MGR^GMTSXAW3 D:+GMTSMGR>0 PM D:+GMTSMGR'>0 PU Q
"RTN","GMTSXA",22,0)
PU ;   Precedence - User Entry Point
"RTN","GMTSXA",23,0)
 N GMTSENV S GMTSENV=$$ENV Q:+GMTSENV'>0  D EN^GMTSXAP Q
"RTN","GMTSXA",24,0)
PM ;   Precedence - Manager Entry Point
"RTN","GMTSXA",25,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0  S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXA",26,0)
 S GMTSUSR=$$USR^GMTSXAW3("Set Health Summary Precedence for user:  ") W:+GMTSUSR>0 ! D:+GMTSUSR>0 EN2^GMTSXAP(GMTSUSR) Q
"RTN","GMTSXA",27,0)
 ;                                 
"RTN","GMTSXA",28,0)
METH ; Set Method of Building List
"RTN","GMTSXA",29,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0  S GMTSMGR=$$MGR^GMTSXAW3 D:+GMTSMGR>0 MM D:+GMTSMGR'>0 MU Q
"RTN","GMTSXA",30,0)
MU ;   Method - User Entry Point
"RTN","GMTSXA",31,0)
 N GMTSENV S GMTSENV=$$ENV Q:+GMTSENV'>0  D EN^GMTSXAO Q
"RTN","GMTSXA",32,0)
MM ;   Method - Manager Entry Point
"RTN","GMTSXA",33,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0  S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXA",34,0)
 S GMTSUSR=$$USR^GMTSXAW3("Set Method of Building list for user:  ") W:+GMTSUSR>0 ! D:+GMTSUSR>0 EN2^GMTSXAO(GMTSUSR) Q
"RTN","GMTSXA",35,0)
 ;                                 
"RTN","GMTSXA",36,0)
 ;
"RTN","GMTSXA",37,0)
EDIT ; Edit Type List
"RTN","GMTSXA",38,0)
 N GMTSENV,GMTSMGR S GMTSENV=$$ENV Q:+GMTSENV'>0  S GMTSMGR=$$MGR^GMTSXAW3 D:+GMTSMGR>0 EM D:+GMTSMGR'>0 EU Q
"RTN","GMTSXA",39,0)
EU ;   Edit List - User Entry Point
"RTN","GMTSXA",40,0)
 N GMTSENV S GMTSENV=$$ENV Q:+GMTSENV'>0  D EL(+($G(DUZ))) Q
"RTN","GMTSXA",41,0)
EM ;   Edit List - Manager Entry Point
"RTN","GMTSXA",42,0)
 N GMTSENV,GMTSMGR,GMTSLST S GMTSENV=$$ENV Q:+GMTSENV'>0
"RTN","GMTSXA",43,0)
 S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXA",44,0)
 W ! D EDITPAR^XPAREDIT("ORWRP HEALTH SUMMARY TYPE LIST")
"RTN","GMTSXA",45,0)
 Q
"RTN","GMTSXA",46,0)
EL(X) ;   Edit List
"RTN","GMTSXA",47,0)
 N GMTSENT,GMTSVEN,GMTSPAR,GMTSUSR,GMTSACT S GMTSUSR=+($G(X))
"RTN","GMTSXA",48,0)
 Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))
"RTN","GMTSXA",49,0)
 S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP^GMTSXAP2(+GMTSUSR) Q:+GMTSACT'>0
"RTN","GMTSXA",50,0)
 S GMTSPAR=$$PDI^GMTSXAW3("ORWRP HEALTH SUMMARY TYPE LIST") Q:+GMTSPAR'>0
"RTN","GMTSXA",51,0)
 S GMTSENT=$$ETI^GMTSXAW3("USR") Q:+GMTSENT'>0  S GMTSVEN=$$UVP^GMTSXAW3(+($G(GMTSUSR)))
"RTN","GMTSXA",52,0)
 W !!,"Edit the CPRS Health Summary Types list on the reports tab"
"RTN","GMTSXA",53,0)
 D EDIT^XPAREDIT(GMTSVEN,(+GMTSPAR_"^GUI Health Summary Type List")) W !
"RTN","GMTSXA",54,0)
 Q
"RTN","GMTSXA",55,0)
 ;                                 
"RTN","GMTSXA",56,0)
 ; Miscellaneous
"RTN","GMTSXA",57,0)
ENV(X) ;   Environment check
"RTN","GMTSXA",58,0)
 D HOME^%ZIS S U="^" Q:'$L($$UNM^GMTSXAW3(+($G(DUZ)))) 0
"RTN","GMTSXA",59,0)
 Q 1
"RTN","GMTSXA",60,0)
LP ;   List Preferences
"RTN","GMTSXA",61,0)
 N GMTSN,GMTSI,GMTSM,GMTSP,GMTSC,GMTSNUM
"RTN","GMTSXA",62,0)
 S GMTSN="",GMTSC=0
"RTN","GMTSXA",63,0)
 F  S GMTSN=$O(^GMT(142.98,"AB",GMTSN)) Q:GMTSN=""  D
"RTN","GMTSXA",64,0)
 . S GMTSI=0  F  S GMTSI=$O(^GMT(142.98,"AB",GMTSN,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXA",65,0)
 . . S GMTSM=$G(^GMT(142.98,+GMTSI,1)),GMTSP=$P(GMTSM,"^",2),GMTSM=$S(+GMTSM=1:"Append   ",1:"Overwrite")
"RTN","GMTSXA",66,0)
 . . S GMTSNUM=$$NUM^GMTSXAL(+GMTSI) S GMTSC=GMTSC+1 I GMTSC=1 D
"RTN","GMTSXA",67,0)
 . . . W !!,"User Preferences",!!,"  Name ",?24," Method",?36," Precedence",?59,"  Types"
"RTN","GMTSXA",68,0)
 . . . W !,"  --------------------",?24," ---------",?36," -------------------",?59,"  -----"
"RTN","GMTSXA",69,0)
 . . . N GMTSD S GMTSD=$$DAL^GMTSXAP2 I $L(GMTSD) D
"RTN","GMTSXA",70,0)
 . . . . W !,"  <default>",?24," Overwrite",?36," ",GMTSD,?59,"  <all>"
"RTN","GMTSXA",71,0)
 . . W !,?2,$E(GMTSN,1,20),?24," ",GMTSM,?36," ",GMTSP,?59,"   ",$J(+GMTSNUM,2)
"RTN","GMTSXA",72,0)
 Q
"RTN","GMTSXA",73,0)
TRIM(X,Y,I) ;   Trim Character
"RTN","GMTSXA",74,0)
 S X=$G(X),Y=$G(Y),I=+($G(I)) Q:'$L(X) X
"RTN","GMTSXA",75,0)
 S:'$L(Y) Y=" " S:I=0 I=3 F  Q:$E(X,1)'=Y  S X=$E(X,2,$L(X))
"RTN","GMTSXA",76,0)
 I +I>1 F  Q:$E(X,$L(X))'=Y  S X=$E(X,1,($L(X)-1))
"RTN","GMTSXA",77,0)
 I I>2 F  Q:X'[(Y_Y)  S X=$P(X,(Y_Y),1)_Y_$P(X,(Y_Y),2,229)
"RTN","GMTSXA",78,0)
 Q X
"RTN","GMTSXA",79,0)
UP(X) ;   Uppercase
"RTN","GMTSXA",80,0)
 Q $TR($G(X),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXAB")
0^3^B8402043
"RTN","GMTSXAB",1,0)
GMTSXAB ; SLC/KER - List Parameters/Build List            ; 09/21/2001
"RTN","GMTSXAB",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXAB",3,0)
 Q
"RTN","GMTSXAB",4,0)
 ;                                 
"RTN","GMTSXAB",5,0)
 ; External References
"RTN","GMTSXAB",6,0)
 ;                                 
"RTN","GMTSXAB",7,0)
 ;   None
"RTN","GMTSXAB",8,0)
 ;                                    
"RTN","GMTSXAB",9,0)
 ; This routine expects:
"RTN","GMTSXAB",10,0)
 ;                                 
"RTN","GMTSXAB",11,0)
 ;   GMTSCPL    Compile Method   1 = Append  0 = Overwrite
"RTN","GMTSXAB",12,0)
 ;   GMTSPRE    Precedence       USR;SYS;NAT
"RTN","GMTSXAB",13,0)
 ;   GMTSTYP(   List             Input Array
"RTN","GMTSXAB",14,0)
 ;   GMTSL(     List             Output Array
"RTN","GMTSXAB",15,0)
 ;                            
"RTN","GMTSXAB",16,0)
BUILD ; Build list of User/System Parameters and National Types
"RTN","GMTSXAB",17,0)
 N GMTSC,GMTSOK,GMTSI,GMTSID,GMTSE,GMTSEI,GMTSV,GMTSVI,GMTSVN,GMTSAT,GMTSOVR
"RTN","GMTSXAB",18,0)
 S GMTSOVR=$S(+($G(GMTSCPL))'>0:1,1:0),GMTSOK=0
"RTN","GMTSXAB",19,0)
 S GMTSC=+($O(GMTSL(" "),-1))
"RTN","GMTSXAB",20,0)
 F GMTSEI=1:1 Q:$P($G(GMTSPRE),";",GMTSEI)=""  S GMTSE=$P($G(GMTSPRE),";",GMTSEI) D
"RTN","GMTSXAB",21,0)
 . Q:'$L(GMTSE)  I GMTSE="NAT" D NAT Q
"RTN","GMTSXAB",22,0)
 . Q:+GMTSOK>0  S GMTSID="" D ADH,ENT
"RTN","GMTSXAB",23,0)
 Q
"RTN","GMTSXAB",24,0)
NAT ;   Add National Health Summary Types to the List
"RTN","GMTSXAB",25,0)
 Q:+($G(GMTSCPL))>1  N GMTSC,GMTSI,GMTSID,GMTSVI,GMTSVN,GMTSV
"RTN","GMTSXAB",26,0)
 S GMTSI=0,GMTSID=""
"RTN","GMTSXAB",27,0)
 S GMTSC=+($O(GMTSL(" "),-1))
"RTN","GMTSXAB",28,0)
 F  S GMTSID=$O(GMTSTYP("NAT","B",GMTSID)) Q:GMTSID=""  D
"RTN","GMTSXAB",29,0)
 . S GMTSI=0 F  S GMTSI=$O(GMTSTYP("NAT","B",GMTSID,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",30,0)
 . . S GMTSV=$G(GMTSTYP("NAT",GMTSI))
"RTN","GMTSXAB",31,0)
 . . Q:'$L(GMTSV)  Q:+GMTSV=0  Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))
"RTN","GMTSXAB",32,0)
 . . Q:$D(GMTSL("B",GMTSV))
"RTN","GMTSXAB",33,0)
 . . S GMTSC=GMTSC+1
"RTN","GMTSXAB",34,0)
 . . S GMTSL(GMTSC)=GMTSV,GMTSL("B",GMTSV,GMTSC)=""
"RTN","GMTSXAB",35,0)
 . . S GMTSL("C",GMTSC)="NAT"
"RTN","GMTSXAB",36,0)
 K GMTSTYP("NAT")
"RTN","GMTSXAB",37,0)
 Q
"RTN","GMTSXAB",38,0)
ADH ;   Add Adhoc Health Summary Types to the List
"RTN","GMTSXAB",39,0)
 N GMTSC S GMTSC=+($O(GMTSL(" "),-1)) F GMTSAT="ADH","RAD" S GMTSI=0 D
"RTN","GMTSXAB",40,0)
 . F  S GMTSI=$O(GMTSTYP(GMTSE,GMTSAT,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",41,0)
 . . S GMTSV=$G(GMTSTYP(GMTSE,GMTSAT,GMTSI)) Q:'$L(GMTSV)
"RTN","GMTSXAB",42,0)
 . . Q:+GMTSV=0  Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))
"RTN","GMTSXAB",43,0)
 . . Q:$D(GMTSL("B",GMTSV))  S GMTSC=GMTSC+1,GMTSL(GMTSC)=GMTSV,GMTSL("B",GMTSV,GMTSC)="",GMTSL("C",GMTSC)=$G(GMTSE)
"RTN","GMTSXAB",44,0)
 Q
"RTN","GMTSXAB",45,0)
ENT ;   Add Entity Parameters (System/User) to the List
"RTN","GMTSXAB",46,0)
 N GMTSC S GMTSC=+($O(GMTSL(" "),-1)) F  S GMTSID=$O(GMTSTYP(GMTSE,"B",GMTSID)) Q:GMTSID=""  D
"RTN","GMTSXAB",47,0)
 . Q:'$L(GMTSID)  S GMTSI=0 F  S GMTSI=$O(GMTSTYP(GMTSE,"B",GMTSID,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",48,0)
 . . S GMTSV=$G(GMTSTYP(GMTSE,GMTSI)) Q:'$L(GMTSV)  Q:+GMTSV=0
"RTN","GMTSXAB",49,0)
 . . Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))  K:$D(GMTSL("B",GMTSV)) GMTSTYP(GMTSE,GMTSI)
"RTN","GMTSXAB",50,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSTYP(GMTSE,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",51,0)
 . S GMTSV=$G(GMTSTYP(GMTSE,GMTSI)) Q:'$L(GMTSV)
"RTN","GMTSXAB",52,0)
 . Q:+GMTSV=0  Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))
"RTN","GMTSXAB",53,0)
 . Q:$D(GMTSL("B",GMTSV))
"RTN","GMTSXAB",54,0)
 . S GMTSC=GMTSC+1,GMTSL(GMTSC)=GMTSV,GMTSL("B",GMTSV,GMTSC)="",GMTSL("C",GMTSC)=$G(GMTSE)
"RTN","GMTSXAB",55,0)
 . S:+($G(GMTSOVR))>0 GMTSOK=1
"RTN","GMTSXAB",56,0)
 S:+($G(GMTSOVR))>0&($D(GMTSL("B"))) GMTSOK=1
"RTN","GMTSXAB",57,0)
 K GMTSTYP(GMTSE)
"RTN","GMTSXAB",58,0)
 Q
"RTN","GMTSXAC")
0^4^B29712865
"RTN","GMTSXAC",1,0)
GMTSXAC ; SLC/KER - List Parameters/Compile Method        ; 09/21/2001
"RTN","GMTSXAC",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXAC",3,0)
 Q
"RTN","GMTSXAC",4,0)
 ;                        
"RTN","GMTSXAC",5,0)
 ; External References
"RTN","GMTSXAC",6,0)
 ;                        
"RTN","GMTSXAC",7,0)
 ;   None
"RTN","GMTSXAC",8,0)
 ;                        
"RTN","GMTSXAC",9,0)
 ; This routine expects:
"RTN","GMTSXAC",10,0)
 ;                                 
"RTN","GMTSXAC",11,0)
 ;   GMTSUSR    Pointer to User
"RTN","GMTSXAC",12,0)
 ;                        
"RTN","GMTSXAC",13,0)
EN ; Main Entry
"RTN","GMTSXAC",14,0)
 N GMTSG D CPL,SH Q
"RTN","GMTSXAC",15,0)
EN1 ; Display Compile Method - Single ? Help
"RTN","GMTSXAC",16,0)
 N GMTSG S GMTSG=1 D CPLH Q
"RTN","GMTSXAC",17,0)
EN2 ; Display Compile Method - Double ?? Help
"RTN","GMTSXAC",18,0)
 N GMTSG S GMTSG=1 D CPL Q
"RTN","GMTSXAC",19,0)
EN3 ; Display Preferred Compile Method
"RTN","GMTSXAC",20,0)
 N GMTSG D CPL Q
"RTN","GMTSXAC",21,0)
 ;                                      
"RTN","GMTSXAC",22,0)
CPL ; Compile Method
"RTN","GMTSXAC",23,0)
 N GMTSPRE,GMTSCPL,GMTSCPA,GMTSCPI,GMTSM,GMTSALW,GMTSU D EN^GMTSXAW
"RTN","GMTSXAC",24,0)
 S GMTSU=+($G(GMTSUSR)) S:+GMTSU=0 GMTSU=+($G(DUZ)) N GMTSUSR S GMTSUSR=GMTSU
"RTN","GMTSXAC",25,0)
 S GMTSPRE=$$PRE^GMTSXAL(+($G(GMTSUSR))),GMTSM=$L(GMTSPRE,";") Q:'$L(GMTSPRE)  S GMTSCPL=$$CPL^GMTSXAL(+($G(GMTSUSR)))
"RTN","GMTSXAC",26,0)
 I +($G(GMTSG))'>0 D:+GMTSCPL>0 CPLA D:+GMTSCPL'>0 CPLO D BL
"RTN","GMTSXAC",27,0)
 I +($G(GMTSG))>0 D CPLH,BL,CPLA,BL,TL("   OR ---"),BL,CPLO
"RTN","GMTSXAC",28,0)
 Q
"RTN","GMTSXAC",29,0)
CPLH ;   Compile Help - Header
"RTN","GMTSXAC",30,0)
 D TL("   Health Summary Types may be added to CPRS reports tab by either appending")
"RTN","GMTSXAC",31,0)
 D TL("   them to the list or by overwriting existing Health Summaries on the list.") Q
"RTN","GMTSXAC",32,0)
CPLA ;   Compile = Append
"RTN","GMTSXAC",33,0)
 N GMTSI,GMTSC,GMTSH,GMTSN,GMTSE,GMTSA,GMTST,GMTSP,GMTSL,GMTSM S GMTSP=$G(GMTSPRE) Q:$L(GMTSP,";")'>1  S (GMTSC,GMTSL)=0,GMTSM="A"
"RTN","GMTSXAC",34,0)
 F GMTSI=1:1 S GMTST=$P($G(GMTSP),";",GMTSI) Q:'$L(GMTST)  D
"RTN","GMTSXAC",35,0)
 . S:$P($G(GMTSP),";",(GMTSI+1))="" GMTSL=1
"RTN","GMTSXAC",36,0)
 . I GMTST="NAT" S GMTSC=GMTSC+1,GMTSN="National",GMTSA=GMTST D:GMTSC=1&(+($G(GMTSG))'>0) CPLT D CPLP Q
"RTN","GMTSXAC",37,0)
 . S GMTSE=+($O(GMTSALW("B",GMTST,0))) Q:+GMTSE=0  S GMTSE=$G(GMTSALW(+GMTSE))
"RTN","GMTSXAC",38,0)
 . S GMTSA=$P(GMTSE,"^",1) Q:'$L(GMTSA)  S GMTSN=$P(GMTSE,"^",4) Q:'$L(GMTSN)  S GMTSC=GMTSC+1 D:GMTSC=1&(+($G(GMTSG))'>0) CPLT D CPLP
"RTN","GMTSXAC",39,0)
 Q
"RTN","GMTSXAC",40,0)
CPLO ;   Compile = Overwrite
"RTN","GMTSXAC",41,0)
 N GMTSI,GMTSC,GMTSH,GMTSN,GMTSE,GMTSA,GMTST,GMTSP,GMTSL,GMTSM,GMTSNAT S GMTSP=$G(GMTSPRE) Q:$L(GMTSP,";")'>1  S (GMTSNAT,GMTSL,GMTSC)=0,GMTSM="O"
"RTN","GMTSXAC",42,0)
 F GMTSI=$L(GMTSP,";"):-1 S GMTST=$P($G(GMTSP),";",GMTSI) Q:'$L(GMTST)  Q:GMTSI=0  D
"RTN","GMTSXAC",43,0)
 . S:$P($G(GMTSP),";",(GMTSI-1))="" GMTSL=1 S:GMTSI-1=0 GMTSL=1 I GMTST="NAT" S GMTSNAT=1 Q
"RTN","GMTSXAC",44,0)
 . S GMTSE=+($O(GMTSALW("B",GMTST,0))) Q:+GMTSE=0  S GMTSE=$G(GMTSALW(+GMTSE))
"RTN","GMTSXAC",45,0)
 . S GMTSA=$P(GMTSE,"^",1) Q:'$L(GMTSA)  S GMTSN=$P(GMTSE,"^",4) Q:'$L(GMTSN)
"RTN","GMTSXAC",46,0)
 . S GMTSC=GMTSC+1 D:GMTSC=1&(+($G(GMTSG))'>0) CPLT D CPLP
"RTN","GMTSXAC",47,0)
 I +GMTSNAT>0 S GMTSC=+($G(GMTSC))+1,GMTSN="National",(GMTSA,GMTST)="NAT" D:GMTSC=1&(+($G(GMTSG))'>0) CPLT D CPLP
"RTN","GMTSXAC",48,0)
 D:$G(GMTSP)["NAT" INDP
"RTN","GMTSXAC",49,0)
 Q
"RTN","GMTSXAC",50,0)
CPLP ;   Compile Parameter
"RTN","GMTSXAC",51,0)
 Q:'$L($G(GMTST))  Q:'$L($G(GMTSN))  Q:'$L($G(GMTSA))  Q:'$L(GMTSM)
"RTN","GMTSXAC",52,0)
 N GMTSP S:GMTSM="A" GMTSH=$S(+($G(GMTSC))=1:"Add",1:"Append with") S:GMTSM="O" GMTSH=$S(+($G(GMTSC))=1:"Add",1:"Overwrite with")
"RTN","GMTSXAC",53,0)
 S GMTSL=+($G(GMTSL)) S:GMTST="NAT"&(GMTSC>1) GMTSH="Add" S:GMTST'="NAT" GMTSP="     "_GMTSH_" "_GMTSN_" Defined Summary Types" S:GMTST="NAT" GMTSP="     "_GMTSH_" National Defined Summary Types"
"RTN","GMTSXAC",54,0)
 S:+($G(GMTSC))>1 GMTSP=GMTSP_" (if found)" S:+($G(GMTSC))=1 GMTSP=GMTSP_" to the list" S:+GMTSL'>0 GMTSP=GMTSP_", then" D TL(GMTSP)
"RTN","GMTSXAC",55,0)
 Q
"RTN","GMTSXAC",56,0)
CPLT ;   Compile Title
"RTN","GMTSXAC",57,0)
 D BL,TL(" Method for building the List:    "),AL(($S(+($G(GMTSCPL))'>0:"Overwrite",1:"Append"))),BL Q
"RTN","GMTSXAC",58,0)
INDP ;   Independent Types
"RTN","GMTSXAC",59,0)
 N GMTSI,GMTSPA,GMTSPT,GMTSPI,GMTSPE,GMTSMSG,GMTSX,GMTST,GMTSL,GMTSR,GMTSS,GMTSN
"RTN","GMTSXAC",60,0)
 S GMTSN="       ",GMTSPT=$$DALW^GMTSXAL
"RTN","GMTSXAC",61,0)
 F GMTSI=1:1 S GMTSPA=$P(GMTSPT,";",GMTSI) Q:'$L(GMTSPA)  D
"RTN","GMTSXAC",62,0)
 . S GMTSPI=$$ETI^GMTSXAW3(GMTSPA),GMTSPE=$$EMC^GMTSXAW3(+($G(GMTSPI))),GMTSX=$G(GMTSX)_", "_GMTSPE
"RTN","GMTSXAC",63,0)
 S:$E(GMTSX,1,2)=", " GMTSX=$E(GMTSX,3,$L(GMTSX)) S:$L(GMTSX,", ")>1 GMTSX=$P(GMTSX,", ",1,($L(GMTSX,", ")-1))_" and "_$P(GMTSX,", ",$L(GMTSX,", "))
"RTN","GMTSXAC",64,0)
 S GMTST="National Health Summary Types are added to the list",GMTSL=$L(GMTST),GMTST="Note:  "_GMTST,GMTST=GMTSN_GMTST D BL,TL(GMTST)
"RTN","GMTSXAC",65,0)
 S GMTSN=GMTSN_"       ",GMTST="independently of "_$S($L(GMTSX):GMTSX,1:"other")_" defined types, and placed on the list in the order specified by the precedence."
"RTN","GMTSXAC",66,0)
 D INDPT
"RTN","GMTSXAC",67,0)
 Q
"RTN","GMTSXAC",68,0)
INDPT ;   Independent Types (text)
"RTN","GMTSXAC",69,0)
 I $L(GMTST)'>GMTSL S GMTST=GMTSN_GMTST D TL(GMTST) Q
"RTN","GMTSXAC",70,0)
 F  Q:'$L(GMTST)  D INDPL
"RTN","GMTSXAC",71,0)
 Q
"RTN","GMTSXAC",72,0)
INDPL ;   Independent Types (long text)
"RTN","GMTSXAC",73,0)
 I $L(GMTST)'>GMTSL D TL((GMTSN_GMTST)) S GMTST="" Q
"RTN","GMTSXAC",74,0)
 N GMTSREM,GMTSSTO,GMTSI F GMTSI=1:1 Q:$L($P(GMTST," ",1,GMTSI))>GMTSL  Q:'$L($P(GMTST," ",GMTSI))
"RTN","GMTSXAC",75,0)
 S GMTSSTO=$$TRIM^GMTSXA($P(GMTST," ",1,(GMTSI-1))," "),GMTSREM=$$TRIM^GMTSXA($P(GMTST," ",GMTSI,299)," ")
"RTN","GMTSXAC",76,0)
 D:$L(GMTSSTO) TL((GMTSN_GMTSSTO)) S GMTST=GMTSREM
"RTN","GMTSXAC",77,0)
 Q
"RTN","GMTSXAC",78,0)
 ;                               
"RTN","GMTSXAC",79,0)
 ; Miscellaneous
"RTN","GMTSXAC",80,0)
SH ;   Show ^TMP Global
"RTN","GMTSXAC",81,0)
 N GMTSN,GMTSC,GMTSW S GMTSN="^TMP(""GMTSXAD"","_$J_",0)",GMTSC="^TMP(""GMTSXAD"","_$J_",",GMTSW="^TMP(""GMTSXAD"","_$J_",0)"
"RTN","GMTSXAC",82,0)
 F  S GMTSN=$Q(@GMTSN) Q:GMTSN=""!(GMTSN'[GMTSC)  W:GMTSN'[GMTSW !,@GMTSN
"RTN","GMTSXAC",83,0)
 K ^TMP("GMTSXAD",$J)
"RTN","GMTSXAC",84,0)
 Q
"RTN","GMTSXAC",85,0)
BL ;   Blank Line
"RTN","GMTSXAC",86,0)
 D TL("") Q
"RTN","GMTSXAC",87,0)
TL(X) ;   Text Line
"RTN","GMTSXAC",88,0)
 I +($G(GMTSG))>0 W !,$G(X) Q
"RTN","GMTSXAC",89,0)
 N GMTSC S X=$G(X),GMTSC=+($G(^TMP("GMTSXAD",$J,0))),GMTSC=GMTSC+1,^TMP("GMTSXAD",$J,GMTSC,0)=X,^TMP("GMTSXAD",$J,0)=GMTSC Q
"RTN","GMTSXAC",90,0)
AL(X) ;   Append Line
"RTN","GMTSXAC",91,0)
 I +($G(GMTSG))>0 W $G(X) Q
"RTN","GMTSXAC",92,0)
 N GMTSC S X=$G(X),GMTSC=+($G(^TMP("GMTSXAD",$J,0))),^TMP("GMTSXAD",$J,GMTSC,0)=$G(^TMP("GMTSXAD",$J,GMTSC,0))_X,^TMP("GMTSXAD",$J,0)=GMTSC Q
"RTN","GMTSXAD")
0^5^B26430744
"RTN","GMTSXAD",1,0)
GMTSXAD ; SLC/KER - List Parameters/Display               ; 09/21/2001
"RTN","GMTSXAD",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXAD",3,0)
 Q
"RTN","GMTSXAD",4,0)
 ;                                  
"RTN","GMTSXAD",5,0)
 ; External References in GMTSXAD
"RTN","GMTSXAD",6,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSXAD",7,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","GMTSXAD",8,0)
 ;   DBIA 10086  ^%ZIS
"RTN","GMTSXAD",9,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","GMTSXAD",10,0)
 ;   DBIA 10089  ^%ZISC
"RTN","GMTSXAD",11,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSXAD",12,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSXAD",13,0)
 ;                           
"RTN","GMTSXAD",14,0)
EN ; Main Entry Point
"RTN","GMTSXAD",15,0)
 D EN2(+($G(DUZ))) Q
"RTN","GMTSXAD",16,0)
EN2(X) ; Entry for User
"RTN","GMTSXAD",17,0)
 K ^TMP("GMTSXAD",$J) N GMTSENV,ZTRTN,GMTSNM S ZTRTN="RPT^GMTSXAD",GMTSENV=$$ENV Q:+GMTSENV=0
"RTN","GMTSXAD",18,0)
 N GMTSUSR S GMTSUSR=+($G(X)) S GMTSNM=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(GMTSNM)
"RTN","GMTSXAD",19,0)
 W !!,"Display user default Health Summary Type list for ",GMTSNM
"RTN","GMTSXAD",20,0)
 D PRE,CPL,LIST,DISP
"RTN","GMTSXAD",21,0)
 Q
"RTN","GMTSXAD",22,0)
 ;                          
"RTN","GMTSXAD",23,0)
 ; Report
"RTN","GMTSXAD",24,0)
PRE ;   Precedence
"RTN","GMTSXAD",25,0)
 N GMTSPRE,GMTSM S GMTSPRE=$$PRE^GMTSXAL(GMTSUSR),GMTSM=$L(GMTSPRE,";")
"RTN","GMTSXAD",26,0)
 Q:'$L(GMTSPRE)
"RTN","GMTSXAD",27,0)
 N GMTSI,GMTSE,GMTST,GMTSA,GMTSN,GMTSP,GMTSH,GMTSC,GMTSALW D EN^GMTSXAW
"RTN","GMTSXAD",28,0)
 S (GMTSC,GMTSI)=0 F GMTSI=1:1 Q:$P(GMTSPRE,";",GMTSI)=""  D
"RTN","GMTSXAD",29,0)
 . S GMTSA=$P(GMTSPRE,";",GMTSI) Q:'$L(GMTSA)  S GMTSE=$O(GMTSALW("B",GMTSA,0))
"RTN","GMTSXAD",30,0)
 . S GMTST=$P($G(GMTSALW("B",GMTSA,+GMTSE)),"^",4) Q:GMTSA'="NAT"&('$L(GMTST))
"RTN","GMTSXAD",31,0)
 . S GMTST=$S(GMTSA="USR":(GMTST_" preferences"),GMTSA="NAT":"National Health Summary Types",1:(GMTST_" defined"))
"RTN","GMTSXAD",32,0)
 . S GMTSC=GMTSC+1 D:GMTSC=1 PRE2 D TL(("     "_GMTSC_"  "_GMTST))
"RTN","GMTSXAD",33,0)
 Q
"RTN","GMTSXAD",34,0)
PRE2 ;     Precedence Title
"RTN","GMTSXAD",35,0)
 D TL(" Precedence of Parameters:        "),AL($G(GMTSPRE)),BL Q
"RTN","GMTSXAD",36,0)
CPL ;   Compile Method
"RTN","GMTSXAD",37,0)
 D EN3^GMTSXAC Q
"RTN","GMTSXAD",38,0)
LIST ;   Health Summary Types List 
"RTN","GMTSXAD",39,0)
 N GMTS,GMTSALW D GETILIST^GMTSXAL(.GMTS,GMTSUSR),EN^GMTSXAW
"RTN","GMTSXAD",40,0)
 N GMTS1,GMTS2,GMTST,GMTSA,GMTSI,GMTSN,GMTSEN,GMTSC,GMTSS S GMTSC=0 F  Q:$L($G(GMTSS))>29  S GMTSS=$G(GMTSS)_" "
"RTN","GMTSXAD",41,0)
 S GMTS1=0 F  S GMTS1=$O(GMTS("AB",GMTS1)) Q:+GMTS1=0  D
"RTN","GMTSXAD",42,0)
 . S GMTS2=0 F  S GMTS2=$O(GMTS("AB",GMTS1,GMTS2)) Q:+GMTS2=0  D
"RTN","GMTSXAD",43,0)
 . . S GMTSA=$P($G(GMTS("AB",GMTS1,GMTS2)),"^",1) Q:'$L(GMTSA)
"RTN","GMTSXAD",44,0)
 . . S GMTSI=+($P($G(GMTS("AB",GMTS1,GMTS2)),"^",2)) Q:+GMTSI'>0
"RTN","GMTSXAD",45,0)
 . . S GMTSN=$$UP^GMTSXA($P($G(GMTS("AB",GMTS1,GMTS2)),"^",3)) Q:'$L(GMTSN)
"RTN","GMTSXAD",46,0)
 . . S GMTSEN=+($O(GMTSALW("B",GMTSA,0))) Q:+GMTSEN'>0&(GMTSA'="NAT")
"RTN","GMTSXAD",47,0)
 . . S GMTSEN=$P($G(GMTSALW("B",GMTSA,GMTSEN)),"^",4) Q:'$L(GMTSEN)&(GMTSA'="NAT")
"RTN","GMTSXAD",48,0)
 . . S GMTSEN=GMTSEN_" defined types" S:GMTSA="NAT" GMTSEN="National types" S GMTSC=GMTSC+1 S GMTSEN="     "_GMTSEN F  Q:$L(GMTSEN)>29  S GMTSEN=GMTSEN_" "
"RTN","GMTSXAD",49,0)
 . . D:GMTSC=1 LIST2
"RTN","GMTSXAD",50,0)
 . . D TL($S(+GMTS2=1:GMTSEN,1:GMTSS))
"RTN","GMTSXAD",51,0)
 . . D AL(($J(GMTSC,2)_"  "_GMTSN))
"RTN","GMTSXAD",52,0)
 Q
"RTN","GMTSXAD",53,0)
LIST2 ;     List Title
"RTN","GMTSXAD",54,0)
 D TL(" The Health Summary Types box will list the following Health Summary Types:"),BL Q
"RTN","GMTSXAD",55,0)
 ;                             
"RTN","GMTSXAD",56,0)
DISP ; Display Report
"RTN","GMTSXAD",57,0)
 I '$L($G(ZTRTN)) K ^TMP("GMTSXAD",$J) Q
"RTN","GMTSXAD",58,0)
 N POP D DEV,HOME^%ZIS Q
"RTN","GMTSXAD",59,0)
DEV ;   Device for Display
"RTN","GMTSXAD",60,0)
 W ! N %ZIS,IOP S %ZIS="PQ" D ^%ZIS Q:POP  I $D(IO("Q")) D QUE Q
"RTN","GMTSXAD",61,0)
NOQUE ;   Do not Queue Report
"RTN","GMTSXAD",62,0)
 W:IOST["C-" @IOF D @ZTRTN,^%ZISC Q
"RTN","GMTSXAD",63,0)
QUE ;   Queue Report
"RTN","GMTSXAD",64,0)
 N %,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTSK I '$D(ZTRTN) K ^TMP("GMTSXAD",$J) Q
"RTN","GMTSXAD",65,0)
 K IO("Q"),ZTSAVE S ZTSAVE("^TMP(""GMTSXAD"",$J,")=""
"RTN","GMTSXAD",66,0)
 S ZTDESC="Health Summary Types List User Defaults",ZTIO=$G(ION),ZTDTH=$H
"RTN","GMTSXAD",67,0)
 D ^%ZTLOAD I $D(ZTSK) W !!,"Request queued",! H 3 W @IOF
"RTN","GMTSXAD",68,0)
 I '$D(ZTSK) W !!,"Request not queued",! H 3 W @IOF
"RTN","GMTSXAD",69,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC Q
"RTN","GMTSXAD",70,0)
 ;                     
"RTN","GMTSXAD",71,0)
RPT ; Report
"RTN","GMTSXAD",72,0)
 W ! Q:'$D(^TMP("GMTSXAD",$J))
"RTN","GMTSXAD",73,0)
 N GMTSHDR,GMTSLC,GMTSI,GMTST,GMTSEXIT S (GMTSI,GMTSLC)=0 D HDRP
"RTN","GMTSXAD",74,0)
 F  S GMTSI=$O(^TMP("GMTSXAD",$J,GMTSI)) Q:+($G(GMTSEXIT))>0  Q:+GMTSI=0  D  Q:+($G(GMTSEXIT))>0
"RTN","GMTSXAD",75,0)
 . S GMTST=$G(^TMP("GMTSXAD",$J,GMTSI,0)),GMTSLC=GMTSLC+1 W !,GMTST
"RTN","GMTSXAD",76,0)
 . D:$G(IOST)["C-"&(GMTSLC>(+($G(IOSL))-4)) CONT
"RTN","GMTSXAD",77,0)
 . K:+($G(GMTSEXIT))>0 ^TMP("GMTSXAD",$J)
"RTN","GMTSXAD",78,0)
 W:$G(IOST)["P-"&($L($G(IOF))) @IOF
"RTN","GMTSXAD",79,0)
 K ^TMP("GMTSXAD",$J)
"RTN","GMTSXAD",80,0)
 Q
"RTN","GMTSXAD",81,0)
CONT ;   Page Break/Continue Report
"RTN","GMTSXAD",82,0)
 I $G(IOST)["P-" W:$L($G(IOF)) @IOF S GMTSLC=0 D HDRP Q
"RTN","GMTSXAD",83,0)
 N GMTSCONT S GMTSCONT="" I $G(IOST)["C-" S GMTSCONT=$$PG W:$L($G(IOF)) @IOF W:'$L($G(IOF)) !! S GMTSLC=0 D HDRP
"RTN","GMTSXAD",84,0)
 S:GMTSCONT["^" GMTSEXIT=1
"RTN","GMTSXAD",85,0)
 Q
"RTN","GMTSXAD",86,0)
PG(X) ;   Page Break
"RTN","GMTSXAD",87,0)
 N DIR,DTOUT,DIRUT,DIROUT,DUOUT S DIR(0)="EA",DIR("A")="    Press <Return> to continue  ",(DIR("?"),DIR("??"))="^W !,""        Enter either <Return> or '^'"""
"RTN","GMTSXAD",88,0)
 W ! D ^DIR S X=$S((+($G(DTOUT))+($G(DUOUT))+($G(DIRUT)))>0:"^",1:"") Q X
"RTN","GMTSXAD",89,0)
HDRP ;   Page/Report Header
"RTN","GMTSXAD",90,0)
 N GMTS1,GMTS2,GMTS3,GMTSL
"RTN","GMTSXAD",91,0)
 S GMTS1=" Health Summary Types list for CPRS Reports Tab" S:+($G(GMTSHDR))>0 GMTS1=GMTS1_"    <continued> "
"RTN","GMTSXAD",92,0)
 S GMTS2=$$UP^GMTSXA($P($$FMTE^XLFDT($$NOW^XLFDT,"ZM"),"@",1)) F  Q:$L(GMTS1)'<(78-$L(GMTS2))  S GMTS1=GMTS1_" "
"RTN","GMTSXAD",93,0)
 S GMTS1=GMTS1_GMTS2 S GMTSL=" -" F  Q:$L(GMTSL)'<$L(GMTS1)  S GMTSL=GMTSL_"-"
"RTN","GMTSXAD",94,0)
 W !,GMTS1,!,GMTSL,! S GMTSLC=+($G(GMTSLC))+3
"RTN","GMTSXAD",95,0)
 Q
"RTN","GMTSXAD",96,0)
 ;                                 
"RTN","GMTSXAD",97,0)
 ; Miscellaneous
"RTN","GMTSXAD",98,0)
ENV(X) ;   Environment check
"RTN","GMTSXAD",99,0)
 D HOME^%ZIS Q:'$L($$UNM^GMTSXAW3(+($G(DUZ)))) 0
"RTN","GMTSXAD",100,0)
 Q 1
"RTN","GMTSXAD",101,0)
 ;   Add Report Lines
"RTN","GMTSXAD",102,0)
BL ;     Blank Line
"RTN","GMTSXAD",103,0)
 D TL("") Q
"RTN","GMTSXAD",104,0)
TL(X) ;     Text Line
"RTN","GMTSXAD",105,0)
 N GMTSC S X=$G(X),GMTSC=+($G(^TMP("GMTSXAD",$J,0))),GMTSC=GMTSC+1,^TMP("GMTSXAD",$J,GMTSC,0)=X,^TMP("GMTSXAD",$J,0)=GMTSC Q
"RTN","GMTSXAD",106,0)
AL(X) ;     Append Line
"RTN","GMTSXAD",107,0)
 N GMTSC S X=$G(X),GMTSC=+($G(^TMP("GMTSXAD",$J,0))),^TMP("GMTSXAD",$J,GMTSC,0)=$G(^TMP("GMTSXAD",$J,GMTSC,0))_X,^TMP("GMTSXAD",$J,0)=GMTSC Q
"RTN","GMTSXAL")
0^6^B47713538
"RTN","GMTSXAL",1,0)
GMTSXAL ; SLC/KER - List Parameters/Get List              ; 09/21/2001
"RTN","GMTSXAL",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXAL",3,0)
 Q
"RTN","GMTSXAL",4,0)
 ;                          
"RTN","GMTSXAL",5,0)
 ; External References in GMTSXAL
"RTN","GMTSXAL",6,0)
 ;   DBIA  2992  ^XTV(8989.5,
"RTN","GMTSXAL",7,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSXAL",8,0)
 ;   DBIA  2263  GETLST^XPAR
"RTN","GMTSXAL",9,0)
 ;                
"RTN","GMTSXAL",10,0)
GETLIST(GMTSL,GMTSUSR) ; Get Health Summary Type Parameter List
"RTN","GMTSXAL",11,0)
 N GMTSCP,GMTSCPL,GMTSPRE,GMTSDEF
"RTN","GMTSXAL",12,0)
 S GMTSUSR=+($G(GMTSUSR)) Q:+GMTSUSR'>0  Q:'$L($$UNM^GMTSXAW3(GMTSUSR))
"RTN","GMTSXAL",13,0)
 S GMTSCPL=$$CPL(GMTSUSR),GMTSPRE=$$PRE(GMTSUSR)
"RTN","GMTSXAL",14,0)
 ;S GMTSCP=$$DEF(GMTSUSR) Q:GMTSCP=""  I GMTSCP="^" D  Q
"RTN","GMTSXAL",15,0)
 ;. N DUZ S DUZ=GMTSUSR D GETLST^XPAR(.GMTSL,"ALL","ORWRP HEALTH SUMMARY TYPE LIST","N")
"RTN","GMTSXAL",16,0)
 D GETLST(.GMTSL,GMTSUSR,GMTSCPL,GMTSPRE)
"RTN","GMTSXAL",17,0)
 I $D(GMTSIDX) D
"RTN","GMTSXAL",18,0)
 . S GMTSL("AC","PRE")=GMTSPRE,GMTSL("AC","CPL")=GMTSCPL_"^"_$S(+($G(GMTSCPL))'>0:"Overwrite",1:"Append")
"RTN","GMTSXAL",19,0)
 . N GMTSI,GMTST,GMTSTO,GMTSTC,GMTSTCT,GMTSV,GMTSC S GMTSTO="",(GMTSC,GMTSTC,GMTSTCT,GMTSI)=0 F  S GMTSI=$O(GMTSL(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAL",20,0)
 . . S GMTSV=$G(GMTSL(GMTSI)),GMTST=$G(GMTSL("C",GMTSI)) Q:'$L(GMTST)
"RTN","GMTSXAL",21,0)
 . . S GMTSC=GMTSC+1,GMTSL("A",GMTST,0)=GMTSC,GMTSL("A",GMTST,GMTSC)=GMTSV S:GMTST'=GMTSTO GMTSTC=GMTSTC+1,GMTSTCT=0 S GMTSTCT=GMTSTCT+1
"RTN","GMTSXAL",22,0)
 . . S GMTSL("AB",0)=GMTSTC,GMTSL("AB",+GMTSTC,0)=GMTSTCT,GMTSL("AB",+GMTSTC,GMTSTCT)=GMTST_"^"_GMTSV,GMTSTO=GMTST
"RTN","GMTSXAL",23,0)
 . K GMTSL("B"),GMTSL("C") S GMTST="" F  S GMTST=$O(GMTSL("A",GMTST)) Q:GMTST=""  D
"RTN","GMTSXAL",24,0)
 . . S GMTSI=0 F  S GMTSI=$O(GMTSL("A",GMTST,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAL",25,0)
 . . . S GMTSC=+($G(GMTSL("A",GMTST,GMTSI)))
"RTN","GMTSXAL",26,0)
 . . . S GMTSV=$P($G(GMTSL("A",GMTST,GMTSI)),"^",2)
"RTN","GMTSXAL",27,0)
 . . . S:+GMTSC>0 GMTSL("B",+GMTSC,GMTSI)=""
"RTN","GMTSXAL",28,0)
 . . . S:$L(GMTSV)>0 GMTSL("BA",GMTSV,GMTSI)=""
"RTN","GMTSXAL",29,0)
 Q
"RTN","GMTSXAL",30,0)
 ;                            
"RTN","GMTSXAL",31,0)
GETILIST(GMTSL,GMTSUSR) ; Get Indexed Health Summary Types Parameter List
"RTN","GMTSXAL",32,0)
 S GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0  Q:'$L($$UNM^GMTSXAW3(GMTSUSR))
"RTN","GMTSXAL",33,0)
 N GMTSIDX S GMTSIDX=1 D GETLIST(.GMTSL,GMTSUSR)
"RTN","GMTSXAL",34,0)
 Q
"RTN","GMTSXAL",35,0)
 ;                            
"RTN","GMTSXAL",36,0)
GETLST(GMTSL,GMTSUSR,GMTSCPL,GMTSPRE) ; Get List
"RTN","GMTSXAL",37,0)
 ;                            
"RTN","GMTSXAL",38,0)
 ; Health Summary Version of call in GETHS^ORWRP:
"RTN","GMTSXAL",39,0)
 ;                         
"RTN","GMTSXAL",40,0)
 ;   D GETLST^XPAR(.ORHSPARM,"ALL",
"RTN","GMTSXAL",41,0)
 ;                   "ORWRP HEALTH SUMMARY TYPE LIST","N")
"RTN","GMTSXAL",42,0)
 ;                            
"RTN","GMTSXAL",43,0)
 ; Merges Health Summary Parameters for display in the
"RTN","GMTSXAL",44,0)
 ; Health Summary Types box on the Reports Tab.  National
"RTN","GMTSXAL",45,0)
 ; Health Summary Types (remote data views) are grouped 
"RTN","GMTSXAL",46,0)
 ; together and added to the list separately.  For a 
"RTN","GMTSXAL",47,0)
 ; National Health Summary Type to be included on the list,
"RTN","GMTSXAL",48,0)
 ; it must first be defined in the parameters file.
"RTN","GMTSXAL",49,0)
 ; The merge of parameters is accomplished by either 
"RTN","GMTSXAL",50,0)
 ; appending or over-writing the parameters to the list.
"RTN","GMTSXAL",51,0)
 ;                            
"RTN","GMTSXAL",52,0)
 ; Input Variables
"RTN","GMTSXAL",53,0)
 ;                    
"RTN","GMTSXAL",54,0)
 ;   GMTSL    Local Array of Health Summary Parameters 
"RTN","GMTSXAL",55,0)
 ;                            
"RTN","GMTSXAL",56,0)
 ;   GMTSCPL  Compile Method
"RTN","GMTSXAL",57,0)
 ;                            
"RTN","GMTSXAL",58,0)
 ;     GMTSCPL=1   Append Parameters to List
"RTN","GMTSXAL",59,0)
 ;     GMTSCPL=0   <DEFAULT>  Overwrite Parameters (by entity)
"RTN","GMTSXAL",60,0)
 ;                            
"RTN","GMTSXAL",61,0)
 ;   GMTSPRE  Precedence of Entities
"RTN","GMTSXAL",62,0)
 ;                            
"RTN","GMTSXAL",63,0)
 ;     Having defined how the list is to be created using
"RTN","GMTSXAL",64,0)
 ;     GMTSCPL (Append or Overwrite), this variable 
"RTN","GMTSXAL",65,0)
 ;     defines the order that each entity will be 
"RTN","GMTSXAL",66,0)
 ;     referenced (first, second, etc.)
"RTN","GMTSXAL",67,0)
 ;                            
"RTN","GMTSXAL",68,0)
 ;       FORMAT   Series of 3 Characters, Uppercase taken
"RTN","GMTSXAL",69,0)
 ;                from the PARAMETER ENTITY file delimited
"RTN","GMTSXAL",70,0)
 ;                by semi-colons
"RTN","GMTSXAL",71,0)
 ;                            
"RTN","GMTSXAL",72,0)
 ;                Default value:  "USR;SYS;NAT"
"RTN","GMTSXAL",73,0)
 ;                            
"RTN","GMTSXAL",74,0)
LST ; Create List
"RTN","GMTSXAL",75,0)
 ;
"RTN","GMTSXAL",76,0)
 N DIC,DTOUT,DUOUT,GMTSE,GMTSENT,GMTSER,GMTSI,GMTSLI,GMTSLL,GMTSLN
"RTN","GMTSXAL",77,0)
 N GMTSPAR,GMTSYS,GMTSAD,GMTSAR,GMTST,GMTSTYP,GMTSV,GMTSVAL,GMTSII
"RTN","GMTSXAL",78,0)
 N GMTSUP,GMTSEI,GMTSIV,GMTSEV,GMTSN,GMTSCHK,X,Y
"RTN","GMTSXAL",79,0)
 S GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0  Q:'$L($$UNM^GMTSXAW3(GMTSUSR))
"RTN","GMTSXAL",80,0)
 S GMTSCPL=$G(GMTSCPL),GMTSPRE=$G(GMTSPRE)
"RTN","GMTSXAL",81,0)
 S:'$L(GMTSCPL) GMTSCPL=0 S:'$L(GMTSPRE) GMTSPRE=$$DPRE
"RTN","GMTSXAL",82,0)
 S (GMTSPAR,X)="ORWRP HEALTH SUMMARY TYPE LIST"
"RTN","GMTSXAL",83,0)
 S GMTSAD="GMTS HS ADHOC OPTION",GMTSAR="GMTS HS REMOTE ADHOC OPTION"
"RTN","GMTSXAL",84,0)
 S GMTSYS=$$SYSV^GMTSXAW3,GMTSUP=$$UVP^GMTSXAW3(+GMTSUSR),GMTSPAR=+($$PDI^GMTSXAW3(GMTSPAR)) Q:GMTSPAR'>0  S GMTSENT="",U="^"
"RTN","GMTSXAL",85,0)
 D CHK^GMTSXAW(.GMTSCHK,GMTSUSR,"GMTS")
"RTN","GMTSXAL",86,0)
 F  S GMTSENT=$O(^XTV(8989.5,"AC",GMTSPAR,GMTSENT)) Q:GMTSENT=""  D BYE
"RTN","GMTSXAL",87,0)
 K GMTSL D BUILD^GMTSXAB
"RTN","GMTSXAL",88,0)
 K:'$D(GMTSIDX) GMTSL("B"),GMTSL("C") S (GMTSI,GMTSN)=0
"RTN","GMTSXAL",89,0)
 F  S GMTSI=$O(GMTSL(GMTSI)) Q:+GMTSI=0  S GMTSN=GMTSN+1
"RTN","GMTSXAL",90,0)
 S:+GMTSN>0 GMTSL=GMTSN
"RTN","GMTSXAL",91,0)
 Q
"RTN","GMTSXAL",92,0)
BYE ;   By Entity
"RTN","GMTSXAL",93,0)
 Q:'$L(GMTSENT)  Q:GMTSENT'[";"  Q:+GMTSENT=0  Q:'$L($P(GMTSENT,";",2))  Q:'$D(GMTSCHK("CHK",GMTSENT))
"RTN","GMTSXAL",94,0)
 S GMTSVAL=$P($G(@(U_$P(GMTSENT,";",2)_+($P(GMTSENT,";",1))_",0)")),U,1)
"RTN","GMTSXAL",95,0)
 Q:'$L(GMTSVAL)  K GMTSL,GMTSER Q:'$L($G(GMTSPAR))  Q:'$L($G(GMTSENT))
"RTN","GMTSXAL",96,0)
 D GETLST^XPAR(.GMTSL,GMTSENT,GMTSPAR,"B",.GMTSER) Q:+($G(GMTSER))>0
"RTN","GMTSXAL",97,0)
 S GMTSLI=0 F  S GMTSLI=$O(GMTSL(GMTSLI)) Q:+GMTSLI=0  D BYP
"RTN","GMTSXAL",98,0)
 Q
"RTN","GMTSXAL",99,0)
BYP ;   By Parameter
"RTN","GMTSXAL",100,0)
 S GMTST=$$ABR^GMTSXAW3(GMTSENT) N GMTSII,GMTSEI,GMTSIV,GMTSEV,GMTSIEN,GMTSVAL,GMTSND,GMTSNM,GMTSHT
"RTN","GMTSXAL",101,0)
 S GMTSII=$P($G(GMTSL(GMTSLI,"N")),"^",1) Q:'$L(GMTSII)
"RTN","GMTSXAL",102,0)
 S GMTSEI=$P($G(GMTSL(GMTSLI,"N")),"^",2) Q:'$L(GMTSEI)
"RTN","GMTSXAL",103,0)
 S GMTSIV=$P($G(GMTSL(GMTSLI,"V")),"^",1) Q:'$L(GMTSIV)
"RTN","GMTSXAL",104,0)
 S GMTSEV=$P($G(GMTSL(GMTSLI,"V")),"^",2) Q:'$L(GMTSEV)
"RTN","GMTSXAL",105,0)
 S GMTST=$S(GMTSPRE["NAT"&(+($G(^GMT(142,+GMTSIV,"VA")))>0):"NAT",1:$G(GMTST))
"RTN","GMTSXAL",106,0)
 S GMTSND=$S(GMTSPRE["NAT"&(+($G(^GMT(142,+GMTSIV,"VA")))>0):"GMTSLN",1:"GMTSLL")
"RTN","GMTSXAL",107,0)
 D SAV
"RTN","GMTSXAL",108,0)
 Q
"RTN","GMTSXAL",109,0)
SAV ;   Save Parameters
"RTN","GMTSXAL",110,0)
 N GMTSI Q:'$L($G(GMTSL(GMTSLI,"V")))  S GMTSVAL=GMTSL(GMTSLI,"V"),GMTSHT=+GMTSVAL,GMTSNM=$P(GMTSVAL,"^",2)
"RTN","GMTSXAL",111,0)
 S GMTSI=(+($O(@(GMTSND_"("" "")"),-1)+1))
"RTN","GMTSXAL",112,0)
 I GMTSNM=GMTSAD!(GMTSNM=GMTSAR) D SAVD Q
"RTN","GMTSXAL",113,0)
 S @(GMTSND_"("_GMTSI_",""N"")")=$G(GMTSL(GMTSLI,"N"))
"RTN","GMTSXAL",114,0)
 S @(GMTSND_"("_GMTSI_",""V"")")=$G(GMTSVAL)
"RTN","GMTSXAL",115,0)
 S @(GMTSND_"("_GMTSI_",""E"")")=$G(GMTSENT)
"RTN","GMTSXAL",116,0)
 S GMTSTYP(GMTST,GMTSI)=$G(GMTSVAL)
"RTN","GMTSXAL",117,0)
 S:$L(GMTSNM) GMTSTYP(GMTST,"B",GMTSNM,GMTSI)=""
"RTN","GMTSXAL",118,0)
 S:GMTSHT>0 GMTSTYP(GMTST,"C",GMTSHT,GMTSI)=""
"RTN","GMTSXAL",119,0)
 Q
"RTN","GMTSXAL",120,0)
SAVD ;   Save Adhoc and Remote Adhoc Parameters
"RTN","GMTSXAL",121,0)
 N GMTSAT,GMTSC,GMTSI S GMTSND=$G(GMTSND) Q:'$L(GMTSND)  Q:GMTSND="GMTSLN"
"RTN","GMTSXAL",122,0)
 I GMTSNM=GMTSAD S GMTSI=(+($O(@(GMTSND_"(""ADH"","" "")"),-1)+1)),GMTSAT="ADH"
"RTN","GMTSXAL",123,0)
 I GMTSNM=GMTSAR S GMTSI=(+($O(@(GMTSND_"(""RAD"","" "")"),-1)+1)),GMTSAT="RAD"
"RTN","GMTSXAL",124,0)
 Q:'$L($G(GMTST))  Q:'$L($G(GMTSAT))  Q:'$L($G(GMTSNM))  Q:'$L($G(GMTSVAL))  Q:'$L($G(GMTSHT))  Q:$D(GMTSTYP(GMTST,GMTSAT,"B",GMTSNM))
"RTN","GMTSXAL",125,0)
 S @(GMTSND_"("""_GMTSAT_""","_GMTSI_",""N"")")=$G(GMTSL(GMTSLI,"N"))
"RTN","GMTSXAL",126,0)
 S @(GMTSND_"("""_GMTSAT_""","_GMTSI_",""V"")")=$G(GMTSL(GMTSLI,"V"))
"RTN","GMTSXAL",127,0)
 S @(GMTSND_"("""_GMTSAT_""","_GMTSI_",""E"")")=$G(GMTSENT)
"RTN","GMTSXAL",128,0)
 S @(GMTSND_"("""_GMTSAT_""",""B"","""_GMTSVAL_""","_GMTSI_")")=""
"RTN","GMTSXAL",129,0)
 S @(GMTSND_"("""_GMTSAT_""",""C"","""_GMTSEI_"^"_GMTSVAL_""","_GMTSI_")")=""
"RTN","GMTSXAL",130,0)
 S GMTSC=+($O(@(GMTSND_"("""_GMTST_""","""_GMTSAT_""","" "")"),-1))+1
"RTN","GMTSXAL",131,0)
 S GMTSTYP(GMTST,GMTSAT,GMTSC)=$G(GMTSVAL)
"RTN","GMTSXAL",132,0)
 S:$L(GMTSNM) GMTSTYP(GMTST,GMTSAT,"B",GMTSNM,GMTSC)=""
"RTN","GMTSXAL",133,0)
 S:GMTSHT>0 GMTSTYP(GMTST,GMTSAT,"C",GMTSHT,GMTSC)=""
"RTN","GMTSXAL",134,0)
 Q
"RTN","GMTSXAL",135,0)
 ;                            
"RTN","GMTSXAL",136,0)
 ; Miscellaneous
"RTN","GMTSXAL",137,0)
NUM(X) ;   Number of Types for User X
"RTN","GMTSXAL",138,0)
 N GMTSUSR,GMTSL,GMTSI,GMTSN S GMTSUSR=+($G(X)),(GMTSI,GMTSN)=0 Q:GMTSUSR=0 0 Q:'$L($$UNM^GMTSXAW3(GMTSUSR)) 0
"RTN","GMTSXAL",139,0)
 D GETLIST(.GMTSL,GMTSUSR) Q:+($G(GMTSL))>0 +($G(GMTSL))
"RTN","GMTSXAL",140,0)
 F  S GMTSI=$O(GMTSL(GMTSI)) Q:+GMTSI=0  S GMTSN=GMTSN+1
"RTN","GMTSXAL",141,0)
 S X=GMTSN Q X
"RTN","GMTSXAL",142,0)
DEF(X) ;
"RTN","GMTSXAL",143,0)
 N DIERR,GMTSUSR,GMTSCPL,GMTSPRE S GMTSUSR=+($G(X)),X="" Q:+GMTSUSR=0 ""
"RTN","GMTSXAL",144,0)
 S GMTSCPL=$$GET1^DIQ(142.98,(GMTSUSR_","),10,"I"),GMTSPRE=$$GET1^DIQ(142.98,(GMTSUSR_","),11),X=GMTSCPL_"^"_GMTSPRE
"RTN","GMTSXAL",145,0)
 Q X
"RTN","GMTSXAL",146,0)
CPL(X) ;   Compile Method
"RTN","GMTSXAL",147,0)
 N DIERR,GMTSUSR,GMTSCPL S GMTSUSR=+($G(X)),X="" Q:+GMTSUSR=0 1
"RTN","GMTSXAL",148,0)
 S GMTSCPL=$$GET1^DIQ(142.98,(GMTSUSR_","),10,"I")
"RTN","GMTSXAL",149,0)
 S:'$L(GMTSCPL) GMTSCPL=1 S X=GMTSCPL
"RTN","GMTSXAL",150,0)
 Q X
"RTN","GMTSXAL",151,0)
PRE(X) ;   Precedence
"RTN","GMTSXAL",152,0)
 N GMTSUSR,GMTSPRE,GMTSDEF,GMTSC,GMTSI,GMTSA,GMTS S GMTSUSR=+($G(X)),(GMTSDEF,X)=$$DPRE Q:+GMTSUSR=0 X
"RTN","GMTSXAL",153,0)
 S GMTSPRE=$$GET1^DIQ(142.98,(GMTSUSR_","),11),GMTSC="^"_$TR($$DEF^GMTSXAW,";","^")_"^"
"RTN","GMTSXAL",154,0)
 S GMTS="" F GMTSI=1:1 Q:GMTSI>$L(GMTSPRE,";")  D
"RTN","GMTSXAL",155,0)
 . S GMTSA=$P($G(GMTSPRE),";",GMTSI) Q:$L(GMTSA)'=3  Q:GMTSC'[("^"_GMTSA_"^")  Q:GMTS[(";"_GMTSA)  S GMTS=GMTS_";"_GMTSA
"RTN","GMTSXAL",156,0)
 S GMTSPRE=$$TRIM^GMTSXA(GMTS,";") S:'$L(GMTSPRE) GMTSPRE=GMTSDEF S X=GMTSPRE
"RTN","GMTSXAL",157,0)
 Q X
"RTN","GMTSXAL",158,0)
DPRE(X) ;   Default Precedence
"RTN","GMTSXAL",159,0)
 S X=$$UP^GMTSXA($$DEF^GMTSXAW) S X=$$TRIM^GMTSXA(X,";") Q X
"RTN","GMTSXAL",160,0)
DALW(X) ;   Default Allowable
"RTN","GMTSXAL",161,0)
 S X=$$UP^GMTSXA($$DEF^GMTSXAW) S X=$$TRIM^GMTSXA(X,";") Q X
"RTN","GMTSXAO")
0^7^B8753258
"RTN","GMTSXAO",1,0)
GMTSXAO ; SLC/KER - List Parameters/Overwrite             ; 09/21/2001
"RTN","GMTSXAO",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXAO",3,0)
 Q
"RTN","GMTSXAO",4,0)
 ;                        
"RTN","GMTSXAO",5,0)
 ; External References
"RTN","GMTSXAO",6,0)
 ;    DBIA  2343  $$ACTIVE^XUSER
"RTN","GMTSXAO",7,0)
 ;    DBIA 10006  ^DIC
"RTN","GMTSXAO",8,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSXAO",9,0)
 ;    DBIA 10018  ^DIE
"RTN","GMTSXAO",10,0)
 ;    DBIA 10013  ^DIK
"RTN","GMTSXAO",11,0)
 ;                        
"RTN","GMTSXAO",12,0)
EN ; Main Entry Point for Health Summary
"RTN","GMTSXAO",13,0)
 N GMTSUSR,GMTSACT S GMTSUSR=+($G(DUZ)) D PREF Q
"RTN","GMTSXAO",14,0)
 ;
"RTN","GMTSXAO",15,0)
EN2(X) ; Entry Point for User
"RTN","GMTSXAO",16,0)
 N GMTSUSR,GMTSACT S GMTSUSR=+($G(X)) D PREF Q
"RTN","GMTSXAO",17,0)
 ;                                   
"RTN","GMTSXAO",18,0)
PREF ; Get Preference - Append/Overwrite
"RTN","GMTSXAO",19,0)
 Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))  S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0 
"RTN","GMTSXAO",20,0)
 N GMTSEL,GMTSALW,GMTSPRE,GMTSCPL S GMTSEL=$P($G(^GMT(142.98,+($G(GMTSUSR)),1)),"^",2)
"RTN","GMTSXAO",21,0)
 D EN2^GMTSXAW(+($G(GMTSUSR))) S:'$L(GMTSEL)&($L($G(GMTSALW("ALLOWABLE")))>2) GMTSEL=$G(GMTSALW("ALLOWABLE"))_";NAT"
"RTN","GMTSXAO",22,0)
 S X=$$CPL(GMTSEL),X=$S(X="O":0,X="A":1,1:"") D:$L(X) EDIT(GMTSUSR,X)
"RTN","GMTSXAO",23,0)
 Q
"RTN","GMTSXAO",24,0)
 ;                        
"RTN","GMTSXAO",25,0)
CPL(X) ; Compile List (Append or Overwrite)
"RTN","GMTSXAO",26,0)
 Q:'$L($G(X)) 0  Q:$L($G(X),";")<2 0
"RTN","GMTSXAO",27,0)
 N Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT,GMTSPRE,GMTSI,GMTST,GMTSA,GMTSO S GMTSPRE=$G(X)
"RTN","GMTSXAO",28,0)
 W !,"CPRS Reports Tab, Health Summary Type List (Order)",!
"RTN","GMTSXAO",29,0)
 W !,?3,"Append selected Health Summary Types to the list",!,?3,"Overwrite selected Health Summary Types to the list",!
"RTN","GMTSXAO",30,0)
 S DIR(0)="SAO^A:Append;O:Overwrite",DIR("A")="Select Append/Overwrite (A/O):  "
"RTN","GMTSXAO",31,0)
 S DIR("B")="A",DIR("?")="^D EN1^GMTSXAC",DIR("??")="^D EN2^GMTSXAC"
"RTN","GMTSXAO",32,0)
 D ^DIR S X=Y
"RTN","GMTSXAO",33,0)
 Q X
"RTN","GMTSXAO",34,0)
 ;                                 
"RTN","GMTSXAO",35,0)
EDIT(GMTSUXR,X) ; Edit "Append/Overwrite"
"RTN","GMTSXAO",36,0)
 N DIC,DIE,DTOUT,DUOUT,Y,DR,DA,GMTSACT,GMTSDAT,GMTSPREF,GMTSA
"RTN","GMTSXAO",37,0)
 S GMTSDAT=+($G(X)),GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0
"RTN","GMTSXAO",38,0)
 S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0
"RTN","GMTSXAO",39,0)
 S GMTSPREF=$$PENT(GMTSUSR) Q:+GMTSPREF'>0
"RTN","GMTSXAO",40,0)
 S DIE="^GMT(142.98,",DA=+($G(GMTSUSR)),DR="10///^S X=+GMTSDAT"
"RTN","GMTSXAO",41,0)
ED ;   Lock Record, Edit Entry
"RTN","GMTSXAO",42,0)
 L +^GMT(142.98,+GMTSPREF):0 I $T D ^DIE L -^GMT(142.98,+GMTSPREF) Q
"RTN","GMTSXAO",43,0)
 S GMTSA=+($G(GMTSA))+1 Q:GMTSA>3  H 1 G ED
"RTN","GMTSXAO",44,0)
 Q
"RTN","GMTSXAO",45,0)
 ;                           
"RTN","GMTSXAO",46,0)
 ; Miscellaneous
"RTN","GMTSXAO",47,0)
PENT(GMTSUSR) ;   Get User Preferred Entry
"RTN","GMTSXAO",48,0)
 N DIC,DTOUT,DUOUT,GMTSACT,DLAYGO S GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0 -1
"RTN","GMTSXAO",49,0)
 S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0 -1
"RTN","GMTSXAO",50,0)
 S X=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(X) -1
"RTN","GMTSXAO",51,0)
 S DIC="^GMT(142.98,",DIC(0)="LM",DLAYGO=142.98 D ^DIC
"RTN","GMTSXAO",52,0)
 S X=+($G(Y)) Q X
"RTN","GMTSXAO",53,0)
DP(X) ;   Delete User Preferece of Inactive User
"RTN","GMTSXAO",54,0)
 N DA,DIK,DIC,DTOUT,DUOUT,GMTSUSR S GMTSUSR=+($G(X)),X=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(X)
"RTN","GMTSXAO",55,0)
 S DIC="^GMT(142.98,",DIC(0)="M" D ^DIC I +Y>0 S DIK=DIC,DA=+Y D ^DIK
"RTN","GMTSXAO",56,0)
 Q
"RTN","GMTSXAP")
0^8^B58274118
"RTN","GMTSXAP",1,0)
GMTSXAP ; SLC/KER - List Parameters/Precedence            ; 09/21/2001
"RTN","GMTSXAP",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXAP",3,0)
 Q
"RTN","GMTSXAP",4,0)
 ;                          
"RTN","GMTSXAP",5,0)
 ; External References in GMTSXAP
"RTN","GMTSXAP",6,0)
 ;   DBIA  2343  $$ACTIVE^XUSER
"RTN","GMTSXAP",7,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSXAP",8,0)
 ;                          
"RTN","GMTSXAP",9,0)
EN ; Main Entry Point for Health Summary
"RTN","GMTSXAP",10,0)
 N GMTSUSR S GMTSUSR=+($G(DUZ)) D PREF Q
"RTN","GMTSXAP",11,0)
EN2(X) ; Entry Point for User
"RTN","GMTSXAP",12,0)
 N GMTSUSR S GMTSUSR=+($G(X)) D PREF Q
"RTN","GMTSXAP",13,0)
 ;                          
"RTN","GMTSXAP",14,0)
PREF ; Get Preference - Precedence
"RTN","GMTSXAP",15,0)
 N GMTSACT Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))
"RTN","GMTSXAP",16,0)
 S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP^GMTSXAP2(GMTSUSR)
"RTN","GMTSXAP",17,0)
 Q:+GMTSACT'>0  S X=$$PRE(GMTSUSR) D:$L(X) EDIT^GMTSXAP2(GMTSUSR,X) Q
"RTN","GMTSXAP",18,0)
 ;                                  
"RTN","GMTSXAP",19,0)
PRE(GMTSUSR) ; Precedence of Parameter Entities
"RTN","GMTSXAP",20,0)
 ;                          
"RTN","GMTSXAP",21,0)
 ;   Input    User, pointer to NEW PERSON file
"RTN","GMTSXAP",22,0)
 ;
"RTN","GMTSXAP",23,0)
 ;   Output   String of Selected Entity Abbreviations,
"RTN","GMTSXAP",24,0)
 ;            delimited by a semi-colon, and arranged in
"RTN","GMTSXAP",25,0)
 ;            the order they should be used.
"RTN","GMTSXAP",26,0)
 ;                          
"RTN","GMTSXAP",27,0)
 ;               Example:  USR;SYS;NAT
"RTN","GMTSXAP",28,0)
 ;                          
"RTN","GMTSXAP",29,0)
 ;             Use "User" defined Health Summary Types, 
"RTN","GMTSXAP",30,0)
 ;             "System" defined Health Summary Types and
"RTN","GMTSXAP",31,0)
 ;             "National" Health Summary Types in that order.
"RTN","GMTSXAP",32,0)
 ;                          
"RTN","GMTSXAP",33,0)
 N GMTSEL,GMTSORD,GMTS,GMTSDEF,GMTSEXIT,GMTSINC,GMTSIN,GMTSCPL,GMTSPRE
"RTN","GMTSXAP",34,0)
 S GMTSUSR=+($G(GMTSUSR)),GMTSEXIT=0 Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR)))) ""
"RTN","GMTSXAP",35,0)
 W !,"GUI Reports Tab, Health Summary Type List (Contents)",!
"RTN","GMTSXAP",36,0)
 D INA S GMTSIN=0 F  S GMTSIN=$O(GMTSINC(GMTSIN)) Q:+GMTSIN=0  Q:+($G(GMTSEXIT))>0  D INC(GMTSINC(GMTSIN)) Q:+($G(GMTSEXIT))>0
"RTN","GMTSXAP",37,0)
 I +GMTSEXIT>0,$D(GMTSEL("@")) D ADEL^GMTSXAP2
"RTN","GMTSXAP",38,0)
 Q:+($G(GMTSEXIT))>0 "" S X="" I '$D(GMTSEL)!($O(GMTSEL(0))'>0) Q X
"RTN","GMTSXAP",39,0)
 I $D(GMTSEL),$O(GMTSEL(0))>0 D ORD
"RTN","GMTSXAP",40,0)
 I +GMTSEXIT>0,$D(GMTSORD("@")) D ADEL^GMTSXAP2
"RTN","GMTSXAP",41,0)
 S:+($G(GMTSEXIT))=0 X=$$CPL
"RTN","GMTSXAP",42,0)
 I +GMTSEXIT>0,$D(GMTSCPL("@")) D ADEL^GMTSXAP2
"RTN","GMTSXAP",43,0)
 Q X
"RTN","GMTSXAP",44,0)
 ; Include Health Summary Types
"RTN","GMTSXAP",45,0)
INA ;   Input Array (from Parameter File)
"RTN","GMTSXAP",46,0)
 N GMTSI,GMTST,GMTSA,GMTSN,GMTSP,GMTSH,GMTSC,GMTSALW D EN^GMTSXAW S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSALW(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",47,0)
 . S GMTST=$G(GMTSALW(GMTSI)) Q:'$L(GMTST)  S GMTSA=$P(GMTST,"^",1) Q:$L(GMTSA)'=3  S GMTSN=$P(GMTST,"^",4) Q:'$L(GMTSN)
"RTN","GMTSXAP",48,0)
 . ; Include User Preferred Health Summary Types:  (Y/N)  Y// ES
"RTN","GMTSXAP",49,0)
 . ; Include System Defined Health Summary Types:  (Y/N)  Y// ES
"RTN","GMTSXAP",50,0)
 . ; Group National Types together (Remote Data Views):  (Y/N)  Y// ES
"RTN","GMTSXAP",51,0)
 . S GMTSP="Include "_GMTSN_" Defined Health Summary Types"
"RTN","GMTSXAP",52,0)
 . S GMTSH=GMTSN_" Level Health Summary Types"
"RTN","GMTSXAP",53,0)
 . S:GMTSA="USR" GMTSP="Include "_GMTSN_" Preferred Health Summary Types",GMTSH=GMTSN_" Preferred Health Summary Types"
"RTN","GMTSXAP",54,0)
 . S GMTSC=GMTSC+1,GMTSINC(GMTSC)=GMTSA_"^"_GMTSP_"^"_GMTSH
"RTN","GMTSXAP",55,0)
 S GMTSC=GMTSC+1,GMTSA="NAT",GMTSN="National"
"RTN","GMTSXAP",56,0)
 S GMTSP="Group "_GMTSN_" Types together (Remote Data View)"
"RTN","GMTSXAP",57,0)
 S GMTSH="Nationally Exported Health Summary Types"
"RTN","GMTSXAP",58,0)
 S GMTSINC(GMTSC)=GMTSA_"^"_GMTSP_"^"_GMTSH
"RTN","GMTSXAP",59,0)
 Q
"RTN","GMTSXAP",60,0)
INC(X) ;   Select Health Summary Types to Include
"RTN","GMTSXAP",61,0)
 Q:+($G(GMTSEXIT))>0  N Y,DIR,%,%P,DTOUT,DUOUT,DIRUT,DIROUT,GMTSI,GMTST,GMTSA,GMTSO S GMTST=$G(X)
"RTN","GMTSXAP",62,0)
 S GMTSA=$P(GMTST,"^",1),GMTSO=$P(GMTST,"^",3),GMTST=$P(GMTST,"^",2) Q:'$L(GMTST)  Q:GMTSA'?3U
"RTN","GMTSXAP",63,0)
 S GMTSI=+($O(GMTSDEF(" "),-1))+1,GMTSDEF(GMTSI)=GMTSA_"^"_GMTST_"^"_GMTSO
"RTN","GMTSXAP",64,0)
 S DIR(0)="YAO",DIR("A")="  "_GMTST_":" F  Q:$L(DIR("A"))>51  S DIR("A")=DIR("A")_" "
"RTN","GMTSXAP",65,0)
 S DIR("A")=DIR("A")_" (Y/N)  " S:$L(GMTSO) DIR("A")="  "_DIR("A")
"RTN","GMTSXAP",66,0)
 S DIR("B")="Y",DIR("?")="^D INH1^GMTSXAP",DIR("??")="^D INH2^GMTSXAP"
"RTN","GMTSXAP",67,0)
 D ^DIR I Y="",X="@" D
"RTN","GMTSXAP",68,0)
 . N GMTSD S GMTSD=$P($G(^GMT(142.98,+($G(GMTSUSR)),1)),"^",2)
"RTN","GMTSXAP",69,0)
 . S GMTSEXIT="1^"_$S($L(GMTSD):"",1:"exiting")
"RTN","GMTSXAP",70,0)
 . S Y="@" K GMTSEL S GMTSEL("@")=""
"RTN","GMTSXAP",71,0)
 S:Y["^"!($D(DUOUT))!($D(DIROUT)) GMTSEXIT="1^exiting"
"RTN","GMTSXAP",72,0)
 S:$D(DTOUT) GMTSEXIT="1^try later"
"RTN","GMTSXAP",73,0)
 I +($G(GMTSEXIT))>0 W $S($L($P(GMTSEXIT,"^",2)):"...",1:""),$P(GMTSEXIT,"^",2) Q
"RTN","GMTSXAP",74,0)
 I +Y>0 S GMTSI=+($O(GMTSEL(" "),-1))+1,GMTSEL(GMTSI)=GMTSA_"^"_GMTST_"^"_GMTSO
"RTN","GMTSXAP",75,0)
 Q
"RTN","GMTSXAP",76,0)
INH1 ;     Include Help - Single ?
"RTN","GMTSXAP",77,0)
 W !,"        Enter either 'Y' or 'N'" D INH3 Q
"RTN","GMTSXAP",78,0)
INH2 ;     Include Help - Double ??
"RTN","GMTSXAP",79,0)
 W !,"        Select specified groups of Health Summary Types to include in the"
"RTN","GMTSXAP",80,0)
 W !,"        Health Summary Types list on the CPRS Reports Tab.  Groups include:",!
"RTN","GMTSXAP",81,0)
 W !,"            USR   User Preferred Health Summary Types in the Parameters file"
"RTN","GMTSXAP",82,0)
 W !,"            SYS   System Defined Summary Types in the parameters file"
"RTN","GMTSXAP",83,0)
 W !,"            NAT   National Health Summary Types (Remote Data Views)" D INH3 Q
"RTN","GMTSXAP",84,0)
INH3 ;     Include Help - Prompt
"RTN","GMTSXAP",85,0)
 I $L($G(DIR("A"))),$G(DIR("A"))'["Include",$G(DIR("A"))=$G(%P) D
"RTN","GMTSXAP",86,0)
 . N GMTSL S GMTSL="            ",GMTSL=$S($G(DIR("A"))[GMTSL:"  ",1:"")
"RTN","GMTSXAP",87,0)
 . S (%P,DIR("A"))=GMTSL_"  Include "_$$TRIM^GMTSXA(DIR("A")," ",1)
"RTN","GMTSXAP",88,0)
 Q
"RTN","GMTSXAP",89,0)
 ;                              
"RTN","GMTSXAP",90,0)
ORD ; Order of Health Summaries in List
"RTN","GMTSXAP",91,0)
 N GMTSI,GMTST,GMTSC,GMTSCNT,GMTSTOT,GMTSREM,GMTSSO,GMTSNXT,GMTSNXC
"RTN","GMTSXAP",92,0)
 S (GMTSSO,GMTSCNT,GMTSI)=0,(GMTSTOT,GMTST)=$$SLT^GMTSXAP2
"RTN","GMTSXAP",93,0)
 ;   One Selected
"RTN","GMTSXAP",94,0)
 I GMTST=1 D  Q
"RTN","GMTSXAP",95,0)
 . S (GMTSI,GMTSC)=0 F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",96,0)
 . . S GMTST=$P($G(GMTSEL(GMTSI)),"^",1)
"RTN","GMTSXAP",97,0)
 . . S:GMTST?3U GMTSC=GMTSC+1,GMTSORD(GMTSC)=GMTSEL(GMTSI)
"RTN","GMTSXAP",98,0)
 ;   Multiple Selected
"RTN","GMTSXAP",99,0)
 W !!!," You have selected multiple Health Summary types to be listed on the CPRS",!," reports tab, in the Health Summary Types box.  Now you must select the",!," order in which you want these to be displayed."
"RTN","GMTSXAP",100,0)
 F  Q:+($G(GMTSEXIT))>0  D SO Q:+($G(GMTSEXIT))>0  Q:'$D(GMTSEL)
"RTN","GMTSXAP",101,0)
 Q
"RTN","GMTSXAP",102,0)
SO ;   Select Order
"RTN","GMTSXAP",103,0)
 N GMTSI,GMTSC,GMTSMAX,GMTSREO S GMTSI=0,GMTSREM=$$SLT^GMTSXAP2
"RTN","GMTSXAP",104,0)
 S GMTSCNT=GMTSTOT-GMTSREM,GMTSNXT=GMTSCNT+1,GMTSSO=+($G(GMTSSO))+1
"RTN","GMTSXAP",105,0)
 S GMTSNXC=$S(GMTSNXT=1:(GMTSNXT_"st"),GMTSNXT=2:(GMTSNXT_"nd"),GMTSNXT=3:(GMTSNXT_"rd"),1:(GMTSNXT_"th"))
"RTN","GMTSXAP",106,0)
 I +GMTSREM=1 D  Q
"RTN","GMTSXAP",107,0)
 . S Y=+GMTSREM D SET
"RTN","GMTSXAP",108,0)
 W ! D:+($G(GMTSSO))=1 SOHD D SOL,REO S (GMTSC,GMTSI)=0
"RTN","GMTSXAP",109,0)
 S GMTSMAX=GMTSREM
"RTN","GMTSXAP",110,0)
 W ! N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","GMTSXAP",111,0)
 S DIR(0)="NAO^1:"_GMTSMAX_":0"
"RTN","GMTSXAP",112,0)
 S DIR("?")="^D SOH1^GMTSXAP"
"RTN","GMTSXAP",113,0)
 S DIR("??")="^D SOH2^GMTSXAP"
"RTN","GMTSXAP",114,0)
 S DIR("A")="         Select the "_GMTSNXC_" to be listed:  "
"RTN","GMTSXAP",115,0)
 K DIR("B") S:+($O(GMTSREO(0)))>0 DIR("B")=+($O(GMTSREO(0)))
"RTN","GMTSXAP",116,0)
 D ^DIR I Y="",X="@" D
"RTN","GMTSXAP",117,0)
 . N GMTSD S GMTSD=$P($G(^GMT(142.98,+($G(GMTSUSR)),1)),"^",2)
"RTN","GMTSXAP",118,0)
 . S GMTSEXIT="1^"_$S($L(GMTSD):"",1:"exiting")
"RTN","GMTSXAP",119,0)
 . S Y="@" K GMTSORD S GMTSORD("@")=""
"RTN","GMTSXAP",120,0)
 S:Y["^"!($D(DUOUT))!($D(DIROUT)) GMTSEXIT="1^exiting" S:$D(DTOUT) GMTSEXIT="1^try later"
"RTN","GMTSXAP",121,0)
 I +($G(GMTSEXIT))>0 W $S($L($P(GMTSEXIT,"^",2)):"...",1:""),$P(GMTSEXIT,"^",2) Q
"RTN","GMTSXAP",122,0)
 I +Y>0,+Y'>GMTSREM D SET
"RTN","GMTSXAP",123,0)
 Q
"RTN","GMTSXAP",124,0)
SOL ;     List - Included Health Summaries
"RTN","GMTSXAP",125,0)
 N GMTSC,GMTSI S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",126,0)
 . S GMTSC=GMTSC+1 W !,?9,$J(GMTSC,4),"  ",$P(GMTSEL(GMTSI),"^",3)
"RTN","GMTSXAP",127,0)
 Q
"RTN","GMTSXAP",128,0)
SOHD ;     Help Text
"RTN","GMTSXAP",129,0)
 W !,"    Order to Display Included Health Summary Types",! Q
"RTN","GMTSXAP",130,0)
SOH1 ;     Help - Single ?
"RTN","GMTSXAP",131,0)
 N GMTSC,GMTSI,GMTSN,GMTSCT S (GMTSC,GMTSI)=0,GMTSCT=+($G(GMTSNXT)) F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  S GMTSC=GMTSC+1
"RTN","GMTSXAP",132,0)
 S GMTSN=$S(GMTSCT=1:"first",GMTSCT=2:"second",GMTSCT=3:"third",GMTSCT=4:"fourth",GMTSCT=5:"fifty",GMTSCT=6:"sixth",GMTSCT=7:"seventh",GMTSCT=8:"eighth",GMTSCT=9:"nineth",1:"")
"RTN","GMTSXAP",133,0)
 I '$L(GMTSN),+GMTSC>1 W !,?9,"Select a group of Health Summary Types to list (1-",GMTSC,")",!
"RTN","GMTSXAP",134,0)
 I $L(GMTSN),+GMTSC>1 W !,?9,"Select a group of Health Summary Types to list ",GMTSN," (1-",GMTSC,")",!
"RTN","GMTSXAP",135,0)
 D SOL
"RTN","GMTSXAP",136,0)
 Q
"RTN","GMTSXAP",137,0)
SOH2 ;     Help - Double ??
"RTN","GMTSXAP",138,0)
 W !,"         You have included multiple Health Summary types to be"
"RTN","GMTSXAP",139,0)
 W !,"         listed on the CPRS reports tab, Health Summary Types box."
"RTN","GMTSXAP",140,0)
 W !,"         Now you must select the order in which you want these"
"RTN","GMTSXAP",141,0)
 W !,"         to be listed.",!
"RTN","GMTSXAP",142,0)
 D SOL
"RTN","GMTSXAP",143,0)
 Q
"RTN","GMTSXAP",144,0)
 ;                                 
"RTN","GMTSXAP",145,0)
 ; Arrange
"RTN","GMTSXAP",146,0)
SET ;   Set Order
"RTN","GMTSXAP",147,0)
 D REO N GMTSO S GMTSO=+($O(GMTSORD(" "),-1))+1
"RTN","GMTSXAP",148,0)
 S:$L($G(GMTSREO(+$G(Y)))) GMTSORD(GMTSO)=$G(GMTSREO(+Y))
"RTN","GMTSXAP",149,0)
 S (GMTSC,GMTSI)=0
"RTN","GMTSXAP",150,0)
 F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",151,0)
 . S GMTSC=GMTSC+1 I GMTSC=+Y K GMTSEL(GMTSI),GMTSREO(GMTSC)
"RTN","GMTSXAP",152,0)
 Q
"RTN","GMTSXAP",153,0)
REO ;   Re-order
"RTN","GMTSXAP",154,0)
 K GMTSREO N GMTSC,GMTSI S (GMTSC,GMTSI)=0
"RTN","GMTSXAP",155,0)
 F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",156,0)
 . S GMTSC=GMTSC+1 S GMTSREO(GMTSC)=$G(GMTSEL(GMTSI))
"RTN","GMTSXAP",157,0)
 Q
"RTN","GMTSXAP",158,0)
CPL(X) ;   Compile Order
"RTN","GMTSXAP",159,0)
 Q:+($G(GMTSEXIT))>0 ""
"RTN","GMTSXAP",160,0)
 N GMTSI,GMTSA,GMTSOK,GMTSNEW S X="",GMTSI=0 F  S GMTSI=$O(GMTSORD(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAP",161,0)
 . S GMTSA=$$UP^GMTSXA($P($G(GMTSORD(GMTSI)),"^",1)) S:GMTSA?3U X=$G(X)_";"_GMTSA
"RTN","GMTSXAP",162,0)
 S (GMTSNEW,X)=$$TRIM^GMTSXA(X,";",3) S GMTSOK=$$OK^GMTSXAP2 Q:GMTSOK'>0 ""
"RTN","GMTSXAP",163,0)
 Q X
"RTN","GMTSXAP2")
0^9^B31822874
"RTN","GMTSXAP2",1,0)
GMTSXAP2 ; SLC/KER - List Parameters/Precedence 2         ; 09/21/2001
"RTN","GMTSXAP2",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXAP2",3,0)
 Q
"RTN","GMTSXAP2",4,0)
 ;                          
"RTN","GMTSXAP2",5,0)
 ; External References in GMTSXAP2
"RTN","GMTSXAP2",6,0)
 ;    DBIA  2056  $$GET1^DIQ
"RTN","GMTSXAP2",7,0)
 ;    DBIA  2343  $$ACTIVE^XUSER
"RTN","GMTSXAP2",8,0)
 ;    DBIA 10006  ^DIC
"RTN","GMTSXAP2",9,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSXAP2",10,0)
 ;    DBIA 10018  ^DIE
"RTN","GMTSXAP2",11,0)
 ;    DBIA 10013  ^DIK
"RTN","GMTSXAP2",12,0)
 ;                        
"RTN","GMTSXAP2",13,0)
 ; Check to see if Compiled Order is correct
"RTN","GMTSXAP2",14,0)
OK(X) ;   Ask if Ok
"RTN","GMTSXAP2",15,0)
 N Y,DIR,GMTSTOT,GMTSOLD S GMTSNEW=$G(GMTSNEW),GMTSOLD=$$OLD
"RTN","GMTSXAP2",16,0)
 S GMTSTOT=$$ORT S:GMTSTOT=1 X=$$OKO S:GMTSTOT>1 X=$$OKM S:GMTSTOT'>0 X=0
"RTN","GMTSXAP2",17,0)
 Q X
"RTN","GMTSXAP2",18,0)
OKM(X) ;     Multiple entities selected     i.e. USR;SYS
"RTN","GMTSXAP2",19,0)
 N DIR,Y,DIROUT,DUOUT,DTOUT S X=1 D OKA Q:'$D(DIR) 0
"RTN","GMTSXAP2",20,0)
 D YND
"RTN","GMTSXAP2",21,0)
 Q X
"RTN","GMTSXAP2",22,0)
OKO(X) ;     Only one entity selected       i.e. USR
"RTN","GMTSXAP2",23,0)
 I '$L($G(GMTSORD(1)))!($L($P(GMTSORD(1),"^",1))'=3)!($L($P(GMTSORD(1),"^",3))'>0) Q 0
"RTN","GMTSXAP2",24,0)
 N DIR,Y,DIROUT,DUOUT,DTOUT D OKA Q:'$D(DIR) 0
"RTN","GMTSXAP2",25,0)
 D YND
"RTN","GMTSXAP2",26,0)
 Q X
"RTN","GMTSXAP2",27,0)
OKA ;   Set up Prompts - DIR("A")
"RTN","GMTSXAP2",28,0)
 N GMTSC,GMTSI,GMTST S (GMTSC,GMTSI)=0 S GMTST=$$ORT
"RTN","GMTSXAP2",29,0)
MUL ;     Multiple Entities
"RTN","GMTSXAP2",30,0)
 I GMTST>1 D  Q
"RTN","GMTSXAP2",31,0)
 . K DIR N GMTSTC,GMTSA,GMTSC S GMTSC=0,GMTSA=GMTST+4 S GMTSTC=$S(GMTST=2:"two",GMTST=3:"three",1:"several")
"RTN","GMTSXAP2",32,0)
 . S DIR("A",1)="",DIR("A",2)=" You have selected "_GMTSTC_" Health Summary Types, arranged "
"RTN","GMTSXAP2",33,0)
 . S DIR("A",3)=" in the following order:",DIR("A",4)=""
"RTN","GMTSXAP2",34,0)
 . F GMTSA=1:1:GMTST S DIR("A",(4+GMTSA))="  "_$J(GMTSA,2)_"    "_$P($G(GMTSORD(+GMTSA)),"^",3)
"RTN","GMTSXAP2",35,0)
 . S GMTSA=+($O(DIR("A"," "),-1))+1,DIR("A",GMTSA)="",DIR("A")=" Is this precedence correct?  (Y/N)  ",DIR(0)="YAO",DIR("B")="Y"
"RTN","GMTSXAP2",36,0)
ONE ;     One Entity
"RTN","GMTSXAP2",37,0)
 I GMTST=1 D  Q
"RTN","GMTSXAP2",38,0)
 . I $L($G(GMTSORD(1))),$L($P(GMTSORD(1),"^",1))=3,$L($P(GMTSORD(1),"^",3))>0 D  Q
"RTN","GMTSXAP2",39,0)
 . . K DIR S DIR("A",1)=""
"RTN","GMTSXAP2",40,0)
 . . S DIR("A",2)=" You have selected one Health Summary Type"
"RTN","GMTSXAP2",41,0)
 . . S DIR("A",3)=""
"RTN","GMTSXAP2",42,0)
 . . S DIR("A",4)="    "_$P($G(GMTSORD(1)),"^",3)
"RTN","GMTSXAP2",43,0)
 . . S DIR("A",5)=""
"RTN","GMTSXAP2",44,0)
 . . S DIR("A")=" Is this correct?  (Y/N)  "
"RTN","GMTSXAP2",45,0)
 . . S DIR(0)="YAO",DIR("B")="Y"
"RTN","GMTSXAP2",46,0)
 . K DIR
"RTN","GMTSXAP2",47,0)
 K DIR
"RTN","GMTSXAP2",48,0)
 Q
"RTN","GMTSXAP2",49,0)
 ;            
"RTN","GMTSXAP2",50,0)
YND ; Yes/No/Delete
"RTN","GMTSXAP2",51,0)
 W ! S X=$G(X) S:$L($G(DIR("A"))) DIR("A")=" Is this correct?  (Y/N)  "
"RTN","GMTSXAP2",52,0)
 S (DIR("?"),DIR("??"))="^D YNDH^GMTSXAP2"
"RTN","GMTSXAP2",53,0)
 S DIR(0)="FAO^1;3^K:$$YNDI^GMTSXAP2(X)'>0 X",DIR("B")="Y"
"RTN","GMTSXAP2",54,0)
 D ^DIR S X=$$YNDO(X) S:X["^" GMTSEXIT=1 S:X="@" GMTSEXIT=1,GMTSCPL("@")=""
"RTN","GMTSXAP2",55,0)
 S:X="N"&($L(GMTSNEW))&(GMTSNEW=GMTSOLD) GMTSEXIT=1,GMTSCPL("@")=""
"RTN","GMTSXAP2",56,0)
 S X=$S(X="Y":1,X="N":0,1:-1)
"RTN","GMTSXAP2",57,0)
 Q
"RTN","GMTSXAP2",58,0)
YNDI(X) ;   Input Transform
"RTN","GMTSXAP2",59,0)
 N GMTS S GMTS=$$UP^GMTSXA($G(X)) Q:$L(GMTS)&("^Y^YE^YES^N^NO^@^^^^^"'[("^"_GMTS_"^")) 0 Q 1
"RTN","GMTSXAP2",60,0)
YNDO(X) ;   Output Transform
"RTN","GMTSXAP2",61,0)
 N GMTS S GMTS=$$UP^GMTSXA($G(X)) S X=$S($E(GMTS,1)="Y":"Y",$E(GMTS,1)="N":"N",$E(GMTS,1)="@":"@",GMTS["^^":"^^",1:"^")
"RTN","GMTSXAP2",62,0)
 S X=$S($D(DUOUT):"^",1:X),X=$S($D(DTOUT):"^^",$D(DIROUT):"^^",1:X) Q X
"RTN","GMTSXAP2",63,0)
YNDH ;   Help
"RTN","GMTSXAP2",64,0)
 W !,"    Enter either 'Y'es, 'N'o, or '^' to exit" Q
"RTN","GMTSXAP2",65,0)
 Q
"RTN","GMTSXAP2",66,0)
 ;            
"RTN","GMTSXAP2",67,0)
EDIT(GMTSUXR,X) ; Edit "Append/Overwrite"
"RTN","GMTSXAP2",68,0)
 N DIC,DIE,DTOUT,DUOUT,Y,DR,DA,GMTSACT,GMTSDAT,GMTSPREF,GMTSA
"RTN","GMTSXAP2",69,0)
 S GMTSDAT=$G(X),GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0  S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0
"RTN","GMTSXAP2",70,0)
 S GMTSPREF=$$PENT(GMTSUSR) Q:+GMTSPREF'>0
"RTN","GMTSXAP2",71,0)
 S DIE="^GMT(142.98,",DA=+($G(GMTSUSR)),DR="11///^S X=GMTSDAT"
"RTN","GMTSXAP2",72,0)
ED ;   Lock Record, Edit Entry
"RTN","GMTSXAP2",73,0)
 L +^GMT(142.98,+GMTSPREF):0 I $T D ^DIE L -^GMT(142.98,+GMTSPREF) Q
"RTN","GMTSXAP2",74,0)
 S GMTSA=+($G(GMTSA))+1 Q:GMTSA>3  H 1 G ED
"RTN","GMTSXAP2",75,0)
 Q
"RTN","GMTSXAP2",76,0)
 ;            
"RTN","GMTSXAP2",77,0)
 ; Deletions
"RTN","GMTSXAP2",78,0)
ADEL ;   Ask for Deletion of Precedence
"RTN","GMTSXAP2",79,0)
 N X,Y,GMTSU,GMTSACT,GMTSDEF S GMTSU=$G(GMTSUSR),GMTSACT=$$ACTIVE^XUSER(+GMTSU) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0  S X=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(X)
"RTN","GMTSXAP2",80,0)
 Q:'$D(^GMT(142.98,+GMTSUSR,1))  S GMTSDEF=$P($G(^GMT(142.98,+GMTSUSR,1)),"^",2) Q:'$L(GMTSDEF)
"RTN","GMTSXAP2",81,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,GMTSA S DIR("B")="N",(GMTSA,DIR("A"))="Delete '"_GMTSDEF_"'?  (Y/N)  " S:$D(GMTSEL("@")) DIR("A")="    "_GMTSA S:$D(GMTSORD("@")) DIR("A")="         "_GMTSA
"RTN","GMTSXAP2",82,0)
 S:$D(GMTSCPL("@")) DIR("A")=" "_GMTSA K GMTSEL("@"),GMTSORD("@"),GMTSCPL("@")
"RTN","GMTSXAP2",83,0)
 S DIR(0)="YAO" W ! D ^DIR S:+Y>0 $P(^GMT(142.98,+GMTSUSR,1),"^",2)=""
"RTN","GMTSXAP2",84,0)
 Q
"RTN","GMTSXAP2",85,0)
DP(X) ;   Delete Record of Inactive User
"RTN","GMTSXAP2",86,0)
 N DA,DIK,DIC,DTOUT,DUOUT,GMTSUSR S GMTSUSR=+($G(X))
"RTN","GMTSXAP2",87,0)
 S X=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(X)
"RTN","GMTSXAP2",88,0)
 S DIC="^GMT(142.98,",DIC(0)="M" D ^DIC I +Y>0 S DIK=DIC,DA=+Y D ^DIK
"RTN","GMTSXAP2",89,0)
 Q
"RTN","GMTSXAP2",90,0)
 ;            
"RTN","GMTSXAP2",91,0)
 ; Miscellaneous
"RTN","GMTSXAP2",92,0)
OLD(X) ;   Old Entry
"RTN","GMTSXAP2",93,0)
 Q $$GET1^DIQ(142.98,+($G(GMTSUSR)),11)
"RTN","GMTSXAP2",94,0)
ORT(X) ;   Total Entities Ordered
"RTN","GMTSXAP2",95,0)
 N GMTSI S (X,GMTSI)=0 F  S GMTSI=$O(GMTSORD(GMTSI)) Q:+GMTSI=0  S X=X+1
"RTN","GMTSXAP2",96,0)
 Q X
"RTN","GMTSXAP2",97,0)
SLT(X) ;   Total Selected
"RTN","GMTSXAP2",98,0)
 N GMTSI S (X,GMTSI)=0 F  S GMTSI=$O(GMTSEL(GMTSI)) Q:+GMTSI=0  S X=X+1
"RTN","GMTSXAP2",99,0)
 Q X
"RTN","GMTSXAP2",100,0)
PENT(GMTSUSR) ;   Get User Preference Entry
"RTN","GMTSXAP2",101,0)
 N DIC,DTOUT,DUOUT,GMTSACT,DLAYGO S GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0 -1
"RTN","GMTSXAP2",102,0)
 S GMTSACT=$$ACTIVE^XUSER(+GMTSUSR) D:+GMTSACT'>0 DP(GMTSUSR) Q:+GMTSACT'>0 -1
"RTN","GMTSXAP2",103,0)
 S X=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(X) -1
"RTN","GMTSXAP2",104,0)
 S DIC="^GMT(142.98,",DIC(0)="LM",DLAYGO=142.98 D ^DIC
"RTN","GMTSXAP2",105,0)
 S X=+($G(Y)) Q X
"RTN","GMTSXAP2",106,0)
PIT(X) ;   Precedence Input Transform
"RTN","GMTSXAP2",107,0)
 N GMTSIN S GMTSIN=$$UP^GMTSXA($G(X)) Q:GMTSIN="" 1 N GMTSC,GMTSI,GMTSA,GMTS S GMTSC="^NAT^SYS^USR^",GMTS="" F GMTSI=1:1 Q:GMTSI>$L(GMTSIN,";")  D
"RTN","GMTSXAP2",108,0)
 . S GMTSA=$P($G(GMTSIN),";",GMTSI) Q:$L(GMTSA)'=3  Q:GMTSC'[("^"_GMTSA_"^")  Q:GMTS[(";"_GMTSA)  S GMTS=GMTS_";"_GMTSA
"RTN","GMTSXAP2",109,0)
 S GMTS=$$TRIM^GMTSXA(GMTS,";",3),X=$S(GMTS=GMTSIN:1,1:0) Q X
"RTN","GMTSXAP2",110,0)
USRD(X) ;   User Precedence/Default
"RTN","GMTSXAP2",111,0)
 N GMTSUSR S GMTSUSR=$G(X),X=$P($G(^GMT(142.98,+($G(GMTSUSR)),1)),"^",2) S:X="" X=$$DAL(GMTSUSR) Q X
"RTN","GMTSXAP2",112,0)
DAL(X) ;   Default Allowable
"RTN","GMTSXAP2",113,0)
 N GMTSUSR,GMTSALW S GMTSUSR=$G(X) I '$L($$UNM^GMTSXAW3(+($G(GMTSUSR)))) D  Q X
"RTN","GMTSXAP2",114,0)
 . S X="USR;SYS;NAT",GMTSALW=$$DEF^GMTSXAW Q:'$L(GMTSALW)  S X=GMTSALW S:X'["NAT" X=X_";NAT"
"RTN","GMTSXAP2",115,0)
 D EN2^GMTSXAW(GMTSUSR) S X=$G(GMTSALW("ALLOWABLE"))
"RTN","GMTSXAP2",116,0)
 S:'$L(X) X="USR;SYS;NAT" S:X["USR" X=$P(X,"USR",1)_$P(X,"USR",2,299) S X="USR;"_X S:X'["NAT" X=X_";NAT" S X=$$TRIM^GMTSXA(X,";",3) Q X
"RTN","GMTSXAW")
0^10^B24594346
"RTN","GMTSXAW",1,0)
GMTSXAW ; SLC/KER - List Parameters/Allowable             ; 09/21/2001
"RTN","GMTSXAW",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXAW",3,0)
 Q
"RTN","GMTSXAW",4,0)
 ;                                
"RTN","GMTSXAW",5,0)
EN ; Main Entry Point for Health Summary
"RTN","GMTSXAW",6,0)
 K GMTSALW Q:'$L($$UNM^GMTSXAW3(+($G(DUZ))))
"RTN","GMTSXAW",7,0)
 D ALW("ORWRP HEALTH SUMMARY TYPE LIST",.GMTSALW,+($G(DUZ)),"GMTS") Q
"RTN","GMTSXAW",8,0)
EN2(X) ; Entry for User X
"RTN","GMTSXAW",9,0)
 K GMTSALW N GMTSUSR S GMTSUSR=+($G(X)) Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))
"RTN","GMTSXAW",10,0)
 D ALW("ORWRP HEALTH SUMMARY TYPE LIST",.GMTSALW,GMTSUSR,"GMTS") Q
"RTN","GMTSXAW",11,0)
DEF(X) ; Default Entities for HS Typye List
"RTN","GMTSXAW",12,0)
 N GMTSI,GMTSEP,GMTSES,GMTSEA,GMTSC,GMTSPAR,GMTSDEF,GMTSMSG,GMTSALW
"RTN","GMTSXAW",13,0)
 S (GMTSI,GMTSC)=0,GMTSDEF="",GMTSPAR=$$HSD^GMTSXAW3 Q:+GMTSPAR=0 ""
"RTN","GMTSXAW",14,0)
 D LST^GMTSXAW3(GMTSPAR,.GMTSALW)
"RTN","GMTSXAW",15,0)
 F  S GMTSI=$O(^TMP("DILIST",$J,"ID",GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAW",16,0)
 . S GMTSES=+($G(^TMP("DILIST",$J,"ID",GMTSI,.01))) Q:+GMTSES'>0
"RTN","GMTSXAW",17,0)
 . S GMTSEP=+($G(^TMP("DILIST",$J,"ID",GMTSI,.02))) Q:+GMTSEP'>0
"RTN","GMTSXAW",18,0)
 . S GMTSEA=$$EAB^GMTSXAW3(+($G(GMTSEP))) Q:$L(GMTSEA)'=3
"RTN","GMTSXAW",19,0)
 . S GMTSC=GMTSC+1,GMTSDEF(GMTSC)=GMTSEA S:GMTSEA="SYS" GMTSDEF("SYS")=""
"RTN","GMTSXAW",20,0)
 S:$D(GMTSDEF("SYS")) GMTSDEF="SYS" S GMTSI=0 F  S GMTSI=$O(GMTSDEF(GMTSI)) Q:+GMTSI=0  S:$G(GMTSDEF(GMTSI))'["SYS" GMTSDEF=GMTSDEF_";"_$G(GMTSDEF(GMTSI))
"RTN","GMTSXAW",21,0)
 K ^TMP("DILIST",$J) S X=$$TRIM^GMTSXA(GMTSDEF,";")
"RTN","GMTSXAW",22,0)
 Q X
"RTN","GMTSXAW",23,0)
 ;            
"RTN","GMTSXAW",24,0)
ALW(GMTSPAR,GMTSALW,GMTSUSR,GMTSPKG) ; Allowable Entities
"RTN","GMTSXAW",25,0)
 ;            
"RTN","GMTSXAW",26,0)
 ;   GMTSPAR     Parameter Name                     Required
"RTN","GMTSXAW",27,0)
 ;  .GMTSALW     Output Ary for Allowable Entities  Required
"RTN","GMTSXAW",28,0)
 ;   GMTSUSR     User (pointer)                     Required
"RTN","GMTSXAW",29,0)
 ;   GMTSPKG     Package Prefix (text)              Optional
"RTN","GMTSXAW",30,0)
 ;            
"RTN","GMTSXAW",31,0)
 N GMTSPDEF,GMTSI,GMTSEC,GMTSPV,GMTSLL,GMTSUN,GMTSCALL
"RTN","GMTSXAW",32,0)
 S GMTSPKG=$G(GMTSPKG),GMTSPAR=$G(GMTSPAR),GMTSUSR=$G(GMTSUSR)
"RTN","GMTSXAW",33,0)
 Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))
"RTN","GMTSXAW",34,0)
 S GMTSPDEF=$$PDI^GMTSXAW3(GMTSPAR) Q:+GMTSPDEF=0  D ALWD(GMTSPDEF,.GMTSALW) S GMTSI=""
"RTN","GMTSXAW",35,0)
 F  S GMTSI=$O(GMTSALW("B",GMTSI)) Q:GMTSI=""  D
"RTN","GMTSXAW",36,0)
 . S GMTSEC=+($O(GMTSALW("B",GMTSI,0))) Q:GMTSEC=0  D
"RTN","GMTSXAW",37,0)
 . . S GMTSLL=GMTSI,GMTSCALL=GMTSLL_"^GMTSXAW2" D GET
"RTN","GMTSXAW",38,0)
 Q
"RTN","GMTSXAW",39,0)
CHK(GMTSALW,GMTSUSR,GMTSPKG) ; Check values Only
"RTN","GMTSXAW",40,0)
 ;            
"RTN","GMTSXAW",41,0)
 ;  .GMTSALW     Output Array for values            Required
"RTN","GMTSXAW",42,0)
 ;   GMTSUSR     User (pointer)                     Required
"RTN","GMTSXAW",43,0)
 ;   GMTSPKG     Package Prefix (namespace)         Optional
"RTN","GMTSXAW",44,0)
 ;            
"RTN","GMTSXAW",45,0)
 N GMTSCHK S GMTSCHK=1 D V2
"RTN","GMTSXAW",46,0)
 Q
"RTN","GMTSXAW",47,0)
VAL(GMTSALW,GMTSUSR,GMTSPKG) ; All Values and Pointers
"RTN","GMTSXAW",48,0)
 ;            
"RTN","GMTSXAW",49,0)
 ;  .GMTSALW     Output Array for values            Required
"RTN","GMTSXAW",50,0)
 ;   GMTSUSR     User (pointer)                     Required
"RTN","GMTSXAW",51,0)
 ;   GMTSPKG     Package Prefix (namespace)         Optional
"RTN","GMTSXAW",52,0)
 ;            
"RTN","GMTSXAW",53,0)
V2 ; Get Values and Pointers
"RTN","GMTSXAW",54,0)
 N GMTSU,GMTSPV S GMTSU=+($G(GMTSUSR)) S:+($G(GMTSUSR))=0 GMTSU=+($G(DUZ))
"RTN","GMTSXAW",55,0)
 N GMTSUSR S GMTSUSR=GMTSU Q:'$L($$UNM^GMTSXAW3(+($G(GMTSUSR))))
"RTN","GMTSXAW",56,0)
 N GMTST,GMTSI,GMTSEC,GMTSLL,GMTSCALL,GMTSVAL S GMTSPKG=$G(GMTSPKG),GMTSVAL=1
"RTN","GMTSXAW",57,0)
 S GMTSEC=0,GMTST="DEV;DIV;SYS;PKG;LOC;SRV;OTL;USR;CLS"
"RTN","GMTSXAW",58,0)
 F GMTSI=1:1 Q:'$L($P(GMTST,";",GMTSI))  S GMTSLL=$P(GMTST,";",GMTSI),GMTSCALL=GMTSLL_"^GMTSXAW2" D GET
"RTN","GMTSXAW",59,0)
 Q
"RTN","GMTSXAW",60,0)
 ;            
"RTN","GMTSXAW",61,0)
ALWD(X,Y) ; Get Allowed Entities for Parameter 
"RTN","GMTSXAW",62,0)
 ;            
"RTN","GMTSXAW",63,0)
 ;   X       Parameter (pointer)                    Required
"RTN","GMTSXAW",64,0)
 ;  .Y       Output Array for Allowed Entities      Required
"RTN","GMTSXAW",65,0)
 ;            
"RTN","GMTSXAW",66,0)
 N GMTSPIEN,GMTSNAM,GMTSMSG,GMTSALW,GMTSLST,GMTSENT,GMTSPRE,GMTSCT,GMTSAL
"RTN","GMTSXAW",67,0)
 S GMTSAL="",GMTSCT=0,GMTSPIEN=+($G(X)) Q:X=0  K ^TMP("DILIST",$J)
"RTN","GMTSXAW",68,0)
 S GMTSNAM=$$PDN^GMTSXAW3(+GMTSPIEN) Q:'$L(GMTSNAM)
"RTN","GMTSXAW",69,0)
 D LST^GMTSXAW3(GMTSPIEN,.GMTSALW)
"RTN","GMTSXAW",70,0)
 S GMTSLST=0 F  S GMTSLST=$O(^TMP("DILIST",$J,"ID",GMTSLST)) Q:+GMTSLST=0  D
"RTN","GMTSXAW",71,0)
 . S GMTSENT=+($G(^TMP("DILIST",$J,"ID",GMTSLST,.02)))
"RTN","GMTSXAW",72,0)
 . S GMTSPRE=$$EAB^GMTSXAW3(+($G(GMTSENT))) Q:'$L(GMTSPRE)  S GMTSCT=GMTSCT+1
"RTN","GMTSXAW",73,0)
 . S Y(GMTSCT)=GMTSPRE_"^"_$$EFN^GMTSXAW3(+($G(GMTSENT)))_"^"_$$ENM^GMTSXAW3(+($G(GMTSENT)))_"^"_$$EMC^GMTSXAW3(+($G(GMTSENT)))
"RTN","GMTSXAW",74,0)
 . S Y("B",GMTSPRE,GMTSCT)=$G(Y(GMTSCT)),GMTSAL=GMTSAL_";"_$$UP^GMTSXA(GMTSPRE)
"RTN","GMTSXAW",75,0)
 K ^TMP("DILIST",$J) S Y("ALLOWABLE")=$$TRIM^GMTSXA(GMTSAL,";"),Y(0)=GMTSCT
"RTN","GMTSXAW",76,0)
 Q
"RTN","GMTSXAW",77,0)
 ; Parameter Entites
"RTN","GMTSXAW",78,0)
GET ;   Get Entities
"RTN","GMTSXAW",79,0)
 S GMTSLL=$G(GMTSLL),GMTSCALL=$G(GMTSCALL) Q:'$L($T(@GMTSCALL))  K GMTSPV D @GMTSCALL
"RTN","GMTSXAW",80,0)
 N GMTS,GMTSA,GMTSP,GMTSN,GMTSC,GMTSV S GMTS=0
"RTN","GMTSXAW",81,0)
 F  S GMTS=$O(GMTSPV(GMTS)) Q:+GMTS=0  D
"RTN","GMTSXAW",82,0)
 . S GMTSA=$G(GMTSPV(GMTS)),GMTSP=$P(GMTSA,"^",2)
"RTN","GMTSXAW",83,0)
 . Q:GMTSP'[";"  S GMTSN=$P(GMTSA,"^",3) Q:'$L(GMTSN)
"RTN","GMTSXAW",84,0)
 . S GMTSC=+($G(GMTSEC)),GMTSV=+($G(GMTSVAL))+($G(GMTSCHK))
"RTN","GMTSXAW",85,0)
 . S GMTSA=$P(GMTSA,"^",1) Q:$L(GMTSA)'=3
"RTN","GMTSXAW",86,0)
 . D SET^GMTSXAW3(GMTSA,GMTSP,GMTSN,.GMTSALW,GMTSC,GMTSV)
"RTN","GMTSXAW",87,0)
 Q
"RTN","GMTSXAW",88,0)
TST ;   Test entry
"RTN","GMTSXAW",89,0)
 N GMTSEC,GMTSI,GMTSLL,GMTSCALL,GMTSU,GMTSPV,GMTSPKG,GMTSN,GMTSC,GMTSA,GMTSP,GMTST,GMTSV
"RTN","GMTSXAW",90,0)
 S GMTSEC=0,GMTSPKG="GMTS" S:'$L($G(GMTST)) GMTST="DEV;DIV;SYS;PKG;LOC;SRV;OTL;USR;CLS",GMTSPKG="GMTS"
"RTN","GMTSXAW",91,0)
 S GMTSU=+($G(GMTSUSR)) S:GMTSU'>0 GMTSU=+($G(DUZ)) Q:GMTSU'>0  N GMTSUSR S GMTSUSR=GMTSU
"RTN","GMTSXAW",92,0)
 F GMTSI=1:1 Q:'$L($P(GMTST,";",GMTSI))  D
"RTN","GMTSXAW",93,0)
 . S GMTSLL=$P(GMTST,";",GMTSI),GMTSCALL=GMTSLL_"^GMTSXAW2"
"RTN","GMTSXAW",94,0)
 . W !!,GMTSLL,?8,$$EMC^GMTSXAW3($$ETI^GMTSXAW3(GMTSLL))
"RTN","GMTSXAW",95,0)
 . Q:'$L($T(@GMTSCALL))  K GMTSPV D @GMTSCALL Q:'$D(GMTSPV)
"RTN","GMTSXAW",96,0)
 . S GMTSEC=0 S:$L(GMTSLL) GMTSEC=+($O(GMTSALW("B",GMTSLL,0)))
"RTN","GMTSXAW",97,0)
 . S GMTSN="GMTSPV(0)",GMTSC="GMTSPV("
"RTN","GMTSXAW",98,0)
 . F  S GMTSN=$Q(@GMTSN) Q:GMTSN=""!(GMTSN'[GMTSC)  W !,GMTSN,"=",@GMTSN
"RTN","GMTSXAW",99,0)
 . N GMTS S GMTS=0 F  S GMTS=$O(GMTSPV(GMTS)) Q:+GMTS=0  D
"RTN","GMTSXAW",100,0)
 . . S GMTSA=$G(GMTSPV(GMTS)),GMTSP=$P(GMTSA,"^",2)
"RTN","GMTSXAW",101,0)
 . . Q:GMTSP'[";"  S GMTSN=$P(GMTSA,"^",3) Q:'$L(GMTSN)
"RTN","GMTSXAW",102,0)
 . . S GMTSC=+($G(GMTSEC)),GMTSV=+($G(GMTSVAL))+($G(GMTSCHK))
"RTN","GMTSXAW",103,0)
 . . S GMTSA=$P(GMTSA,"^",1) Q:$L(GMTSA)'=3
"RTN","GMTSXAW",104,0)
 . . D SET^GMTSXAW3(GMTSA,GMTSP,GMTSN,.GMTSALW,GMTSC,GMTSV)
"RTN","GMTSXAW",105,0)
 Q
"RTN","GMTSXAW2")
0^11^B20754336
"RTN","GMTSXAW2",1,0)
GMTSXAW2 ; SLC/KER - List Parameters/Entities              ; 09/21/2001
"RTN","GMTSXAW2",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXAW2",3,0)
 Q
"RTN","GMTSXAW2",4,0)
 ;                                
"RTN","GMTSXAW2",5,0)
 ; External References
"RTN","GMTSXAW2",6,0)
 ;   DBIA 10112  $$SITE^VASITE
"RTN","GMTSXAW2",7,0)
 ;                             
"RTN","GMTSXAW2",8,0)
DEV ; Device
"RTN","GMTSXAW2",9,0)
 K GMTSPV N GMTSE,GMTSA,GMTSEN,GMTSIE,GMTSVP,GMTSNM
"RTN","GMTSXAW2",10,0)
 S GMTSE=+($$ETI^GMTSXAW3("DEV")) Q:+GMTSE=0
"RTN","GMTSXAW2",11,0)
 S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",12,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",13,0)
 S GMTSIE=+($G(IO("HOME"))) Q:+GMTSIE'>0  S GMTSVP=+GMTSIE_";%ZIS(1,"
"RTN","GMTSXAW2",14,0)
 S GMTSNM=$$DEV^GMTSXAW3(+($G(GMTSIE)))
"RTN","GMTSXAW2",15,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",16,0)
 Q
"RTN","GMTSXAW2",17,0)
DIV ; Division
"RTN","GMTSXAW2",18,0)
 K GMTSPV N GMTSIE,GMTSVP,GMTSNM,GMTSE,GMTSA,GMTSEN
"RTN","GMTSXAW2",19,0)
 S GMTSE=+($$ETI^GMTSXAW3("DIV")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",20,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",21,0)
 S GMTSIE=+($$SITE^VASITE) Q:+GMTSIE'>0
"RTN","GMTSXAW2",22,0)
 S GMTSVP=+GMTSIE_";DIC(4,",GMTSNM=$$DIV^GMTSXAW3(+($G(GMTSIE)))
"RTN","GMTSXAW2",23,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",24,0)
SYS ; System 
"RTN","GMTSXAW2",25,0)
 K GMTSPV N GMTSIE,GMTSVP,GMTSNM,GMTSE,GMTSA,GMTSEN
"RTN","GMTSXAW2",26,0)
 S GMTSE=+($$ETI^GMTSXAW3("SYS")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",27,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",28,0)
 S GMTSIE=$$SI^GMTSXAW3 Q:+GMTSIE'>0
"RTN","GMTSXAW2",29,0)
 S GMTSVP=+GMTSIE_";DIC(4.2,",GMTSNM=$$SYS^GMTSXAW3(+($G(GMTSIE)))
"RTN","GMTSXAW2",30,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",31,0)
PKG ; Package               Needs GMTSPKG
"RTN","GMTSXAW2",32,0)
 K GMTSPV Q:'$L($G(GMTSPKG))
"RTN","GMTSXAW2",33,0)
 N GMTSIE,GMTSVP,GMTSNM,GMTSE,GMTSA,GMTSEN
"RTN","GMTSXAW2",34,0)
 S GMTSE=+($$ETI^GMTSXAW3("PKG")) Q:+GMTSE=0
"RTN","GMTSXAW2",35,0)
 S GMTSA=$$EAB^GMTSXAW3(GMTSE),GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",36,0)
 S GMTSIE=$$PK^GMTSXAW3(GMTSPKG) Q:+GMTSIE'>0  S GMTSVP=+GMTSIE_";DIC(9.4,"
"RTN","GMTSXAW2",37,0)
 S GMTSNM=$$PKG^GMTSXAW3(+($G(GMTSIE)))
"RTN","GMTSXAW2",38,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",39,0)
LOC ; Hospital Location     <none>
"RTN","GMTSXAW2",40,0)
 K GMTSPV Q
"RTN","GMTSXAW2",41,0)
SRV ; Service               Needs GMTSUSR
"RTN","GMTSXAW2",42,0)
 K GMTSPV N GMTSIE,GMTSVP,GMTSNM,GMTSE,GMTSA,GMTSEN
"RTN","GMTSXAW2",43,0)
 S GMTSE=+($$ETI^GMTSXAW3("SRV")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",44,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",45,0)
 S GMTSIE=$$SRI^GMTSXAW3(+($G(GMTSUSR))) Q:+GMTSIE'>0
"RTN","GMTSXAW2",46,0)
 S GMTSVP=+GMTSIE_";DIC(49,",GMTSNM=$$SRV^GMTSXAW3(+GMTSIE)
"RTN","GMTSXAW2",47,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",48,0)
OTL ; OERR Team List        Needs GMTSUSR
"RTN","GMTSXAW2",49,0)
 K GMTSPV N GMTSE,GMTSA,GMTSEN,GMTSNM,GMTSPVC,GMTSI,GMTSIE,GMTSVP,GMTSOTL
"RTN","GMTSXAW2",50,0)
 S GMTSE=+($$ETI^GMTSXAW3("OTL")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",51,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",52,0)
 S GMTSNM=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(GMTSNM)
"RTN","GMTSXAW2",53,0)
 D OTL^GMTSXAW3(GMTSNM,.GMTSOTL) S (GMTSPVC,GMTSI)=0
"RTN","GMTSXAW2",54,0)
 F  S GMTSI=$O(GMTSOTL("DILIST",2,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAW2",55,0)
 . S GMTSIE=$G(GMTSOTL("DILIST",2,GMTSI)) Q:+GMTSIE=0
"RTN","GMTSXAW2",56,0)
 . S GMTSVP=+GMTSIE_";OR(100.21,",GMTSNM=$G(GMTSOTL("DILIST",1,GMTSI))
"RTN","GMTSXAW2",57,0)
 . Q:'$L(GMTSNM)  S GMTSPVC=+($G(GMTSPVC))+1
"RTN","GMTSXAW2",58,0)
 . S GMTSPV(GMTSPVC)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH
"RTN","GMTSXAW2",59,0)
 Q
"RTN","GMTSXAW2",60,0)
USR ; User                  Needs GMTSUSR
"RTN","GMTSXAW2",61,0)
 K GMTSPV N GMTSIE,GMTSVP,GMTSNM,GMTSE,GMTSA,GMTSEN
"RTN","GMTSXAW2",62,0)
 S GMTSE=+($$ETI^GMTSXAW3("USR")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE)
"RTN","GMTSXAW2",63,0)
 S GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",64,0)
 S GMTSIE=+($G(GMTSUSR)) Q:+GMTSIE'>0  S GMTSVP=$$UVP^GMTSXAW3(+GMTSIE)
"RTN","GMTSXAW2",65,0)
 S GMTSNM=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(GMTSNM)
"RTN","GMTSXAW2",66,0)
 S GMTSPV(1)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH Q
"RTN","GMTSXAW2",67,0)
TEA ; Team                  <none>
"RTN","GMTSXAW2",68,0)
 K GMTSPV Q
"RTN","GMTSXAW2",69,0)
BED ; Room/Bed              <none>
"RTN","GMTSXAW2",70,0)
 K GMTSPV Q
"RTN","GMTSXAW2",71,0)
CLS ; User Class            Needs GMTSUSR
"RTN","GMTSXAW2",72,0)
 K GMTSPV N GMTSIE,GMTSNM,GMTSE,GMTSA,GMTSEN,GMTSPVC,GMTSCD,GMTSED,GMTSCLS,GMTSMEM,GMTSMSG,GMTSI,GMTSU,GMTSIE
"RTN","GMTSXAW2",73,0)
 S GMTSE=+($$ETI^GMTSXAW3("CLS")) Q:+GMTSE=0  S GMTSA=$$EAB^GMTSXAW3(GMTSE),GMTSEN=$$EMC^GMTSXAW3(GMTSE) Q:$L(GMTSA)'=3  Q:'$L(GMTSEN)
"RTN","GMTSXAW2",74,0)
 S GMTSNM=$$UNM^GMTSXAW3(+($G(GMTSUSR))) Q:'$L(GMTSNM)  S GMTSCD=DT,GMTSU=0 D UCL^GMTSXAW3(GMTSUSR,.GMTSMEM)
"RTN","GMTSXAW2",75,0)
 F  S GMTSU=$O(GMTSMEM("ID",GMTSU)) Q:+GMTSU=0  D
"RTN","GMTSXAW2",76,0)
 . S GMTSED=+($G(GMTSMEM("ID",GMTSU,.03))),GMTSED=+($P(GMTSED,".",1)) Q:+GMTSED=0  Q:+GMTSED>+GMTSCD
"RTN","GMTSXAW2",77,0)
 . S GMTSED=+($G(GMTSMEM("ID",GMTSU,.04))) Q:+GMTSED>0&(+GMTSCD>+GMTSED)
"RTN","GMTSXAW2",78,0)
 . I +($G(GMTSMEM("ID",GMTSU,.02)))>0 D
"RTN","GMTSXAW2",79,0)
 . . S GMTSIE=+($G(GMTSMEM("ID",GMTSU,.02))),GMTSVP=GMTSIE_";USR(8930,",GMTSNM=$$CLS^GMTSXAW3(+GMTSIE)
"RTN","GMTSXAW2",80,0)
 . . Q:'$L(GMTSNM)  S GMTSPVC=+($G(GMTSPVC))+1,GMTSPV(GMTSPVC)=GMTSA_"^"_GMTSVP_"^"_GMTSNM_"^"_GMTSEN D OTH
"RTN","GMTSXAW2",81,0)
 Q
"RTN","GMTSXAW2",82,0)
OTH ; Other Elements
"RTN","GMTSXAW2",83,0)
 S:$L($G(GMTSVP)) GMTSPV("VP",$G(GMTSVP))=""
"RTN","GMTSXAW2",84,0)
 S:$L($P($G(GMTSVP),";",2)) GMTSPV("GL",$P($G(GMTSVP),";",2))=""
"RTN","GMTSXAW2",85,0)
 S:$L($G(GMTSA)) GMTSPV("AB",$G(GMTSA))=""
"RTN","GMTSXAW2",86,0)
 Q
"RTN","GMTSXAW3")
0^39^B25968976
"RTN","GMTSXAW3",1,0)
GMTSXAW3 ; SLC/KER - List Parameters/Allowable 2           ; 09/21/2001
"RTN","GMTSXAW3",2,0)
 ;;2.7;Health Summary;**47**;Oct 20, 1995
"RTN","GMTSXAW3",3,0)
 ;
"RTN","GMTSXAW3",4,0)
 ; External References in GMTSXAW2
"RTN","GMTSXAW3",5,0)
 ;   DBIA  2051  FIND^DIC
"RTN","GMTSXAW3",6,0)
 ;   DBIA  2051  $$FIND1^DIC
"RTN","GMTSXAW3",7,0)
 ;   DBIA  2051  LIST^DIC
"RTN","GMTSXAW3",8,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSXAW3",9,0)
 ;   DBIA  2541  $$KSP^XUPARAM
"RTN","GMTSXAW3",10,0)
 ;   DBIA  2324  $$CLNAME^USRLM
"RTN","GMTSXAW3",11,0)
 ;   DBIA  2324  WHATIS^USRLM
"RTN","GMTSXAW3",12,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSXAW3",13,0)
 ;   DBIA  2054  $$CREF^DILF
"RTN","GMTSXAW3",14,0)
 ;   DBIA 10076  ^XUSEC("GMTSMGR")
"RTN","GMTSXAW3",15,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMTSXAW3",16,0)
 ;   DBIA 10114  ^%ZIS(1,
"RTN","GMTSXAW3",17,0)
 ;   DBIA 10048  ^DIC(9.4,
"RTN","GMTSXAW3",18,0)
 ;   DBIA 10090  ^DIC(4,
"RTN","GMTSXAW3",19,0)
 ;   DBIA 10093  ^DIC(49,
"RTN","GMTSXAW3",20,0)
 ;   DBIA  3005  ^OR(100.21
"RTN","GMTSXAW3",21,0)
 ;   DBIA  1996  ^DIC(4.2,
"RTN","GMTSXAW3",22,0)
 ;   DBIA  2324  ^USR(8930.3,
"RTN","GMTSXAW3",23,0)
 ;   DBIA  2324  ^USR(8930,
"RTN","GMTSXAW3",24,0)
 ;   DBIA  3407  ^XTV(8989.51,     Pending
"RTN","GMTSXAW3",25,0)
 ;   DBIA  3408  ^XTV(8989.518,    Pending
"RTN","GMTSXAW3",26,0)
 ;            
"RTN","GMTSXAW3",27,0)
 Q
"RTN","GMTSXAW3",28,0)
SET(GMTSA,GMTSP,GMTSN,GMTSALW,GMTSI,GMTSF) ; Create Array Entry
"RTN","GMTSXAW3",29,0)
 ;            
"RTN","GMTSXAW3",30,0)
 ;   GMTSA    Identifier    SYS          USR           Req
"RTN","GMTSXAW3",31,0)
 ;   GMTSP    Variable Ptr  97;DIC(4.2,  1118;VA(200,  Req
"RTN","GMTSXAW3",32,0)
 ;   GMTSN    Name          System       User          Req
"RTN","GMTSXAW3",33,0)
 ;  .GMTSALW  Array Root    GMTSALW(                   Req
"RTN","GMTSXAW3",34,0)
 ;   GMTSI    Array IEN     GMTSALW(GMTSI)             Req
"RTN","GMTSXAW3",35,0)
 ;   GMTSF    Value Flag    Include only values        Opt
"RTN","GMTSXAW3",36,0)
 ;            
"RTN","GMTSXAW3",37,0)
 Q:'$L(GMTSA)  Q:'$L(GMTSP)  Q:'$L(GMTSN)  I +($G(GMTSF))>0 D  Q
"RTN","GMTSXAW3",38,0)
 . N GMTSD S GMTSD=";"_$P(GMTSP,";",2)
"RTN","GMTSXAW3",39,0)
 . S GMTSALW("CHK",GMTSP,GMTSD)="" Q:+($G(GMTSF))>1
"RTN","GMTSXAW3",40,0)
 . S GMTSALW("ENT",GMTSA,GMTSP)=""
"RTN","GMTSXAW3",41,0)
 . S GMTSALW("VAL",GMTSP,GMTSA)=""
"RTN","GMTSXAW3",42,0)
 N GMTS2 S GMTSI=+($G(GMTSI)) Q:GMTSI=0
"RTN","GMTSXAW3",43,0)
 S GMTS2=$O(GMTSALW(GMTSI,GMTSA," "),-1)+1
"RTN","GMTSXAW3",44,0)
 S GMTSALW(GMTSI,GMTSA,GMTS2)=GMTSP_"^"_GMTSN
"RTN","GMTSXAW3",45,0)
 S GMTSALW(GMTSI,GMTSA,"VAL",GMTSP,GMTS2)=""
"RTN","GMTSXAW3",46,0)
 S GMTSALW("ENT",GMTSA,GMTSP,GMTSI,GMTS2)=""
"RTN","GMTSXAW3",47,0)
 S GMTSALW("VAL",GMTSP,GMTSI,GMTS2)=GMTSA
"RTN","GMTSXAW3",48,0)
 Q
"RTN","GMTSXAW3",49,0)
 ; Lookups
"RTN","GMTSXAW3",50,0)
LST(X,Y) ;   Default Entities  8989.513  Lookup    .01, .02
"RTN","GMTSXAW3",51,0)
 Q:+($G(X))'>0  N GMTSM,GMTSP S GMTSP=+($G(X)) Q:+($G(GMTSP))'>0
"RTN","GMTSXAW3",52,0)
 D LIST^DIC(8989.513,(","_+GMTSP_","),".01;.02","I","*",,,,,.Y,.GMTSM)
"RTN","GMTSXAW3",53,0)
 Q
"RTN","GMTSXAW3",54,0)
OTL(X,GMTSOTL) ;   OR Team List      100.21    Lookup    .01
"RTN","GMTSXAW3",55,0)
 N GMTSNM S GMTSNM=$G(X) Q:'$L($G(GMTSNM))  N GMTSM
"RTN","GMTSXAW3",56,0)
 D FIND^DIC(100.21,,".01",,GMTSNM,"*","C",,,"GMTSOTL","GMTSM")
"RTN","GMTSXAW3",57,0)
 Q
"RTN","GMTSXAW3",58,0)
UCL(X,GMTS) ;   User Classes      8930.3    Lookup    .01, .02, .03, .04
"RTN","GMTSXAW3",59,0)
 N USRT S X=+($G(X)) Q:X=0  D WHATIS^USRLM(X,"USRT")
"RTN","GMTSXAW3",60,0)
 N GMTSNM,GMTSCT,GMTSI,GMTSIEN,GMTSC,GMTSCLS,GMTSEFF,GMTSEXP,GMTSCLN,GMTSU,GMTSUN
"RTN","GMTSXAW3",61,0)
 S GMTSU=+($G(USRT(0))),GMTSUN=$P($G(USRT(0)),"^",2),GMTSC=$P($G(USRT(0)),"^",3)
"RTN","GMTSXAW3",62,0)
 S GMTSC=0,GMTSI="" F  S GMTSI=$O(USRT(GMTSI)) Q:GMTSI=""  D
"RTN","GMTSXAW3",63,0)
 . S GMTSIEN=$P($G(USRT(GMTSI)),"^",2) Q:+GMTSIEN=0  S GMTSCLS=$P($G(USRT(GMTSI)),"^",1),GMTSEFF=$P($G(USRT(GMTSI)),"^",4),GMTSEXP=$P($G(USRT(GMTSI)),"^",5),GMTSCLN=$P($G(USRT(GMTSI)),"^",3)
"RTN","GMTSXAW3",64,0)
 . S GMTSC=GMTSC+1,GMTS("ID",GMTSC,.01)=GMTSUN,GMTS("ID",GMTSC,.01,"E")=GMTSU,GMTS("ID",GMTSC,.02)=GMTSCLS,GMTS("ID",GMTSC,.03)=GMTSEFF,GMTS("ID",GMTSC,.04)=GMTSEXP,GMTS("ID",GMTSC,"IEN")=GMTSIEN
"RTN","GMTSXAW3",65,0)
 Q
"RTN","GMTSXAW3",66,0)
HSD(X) ;   HS Definition
"RTN","GMTSXAW3",67,0)
 S X=$$PDI("ORWRP HEALTH SUMMARY TYPE LIST") Q X
"RTN","GMTSXAW3",68,0)
SI(X) ;   System Infor      4.2       Lookup
"RTN","GMTSXAW3",69,0)
 Q $$FIND1^DIC(4.2,"","QX",$$KSP^XUPARAM("WHERE"))
"RTN","GMTSXAW3",70,0)
ABR(X) ;   Abbreviation      8989.518  .02
"RTN","GMTSXAW3",71,0)
 N GMTS S X=$G(X) Q:'$L(X) "XXX"
"RTN","GMTSXAW3",72,0)
 S:X[";" X=$P(X,";",2) S:X'["^" X="^"_X
"RTN","GMTSXAW3",73,0)
 S:$E(X,$L(X))'="("&(X["(")&(X'[",") X=X_"," S X=X_"0"
"RTN","GMTSXAW3",74,0)
 S GMTS=$$CREF^DILF(X) I X'=GMTS,GMTS["0" D  Q X
"RTN","GMTSXAW3",75,0)
 . S X=+($P($G(@GMTS),"^",2)) I +X'>0 S X="XXX" Q
"RTN","GMTSXAW3",76,0)
 . S X=$$UP^GMTSXA($$GET1^DIQ(8989.518,(X_","),.02))
"RTN","GMTSXAW3",77,0)
 . S:$L(X)'=3 X="XXX"
"RTN","GMTSXAW3",78,0)
 Q "XXX"
"RTN","GMTSXAW3",79,0)
ETI(X) ;   Entity IEN        8989.518  Lookup
"RTN","GMTSXAW3",80,0)
 Q:$L($G(X))'=3 0 N GMTSM
"RTN","GMTSXAW3",81,0)
 Q $$FIND1^DIC(8989.518,,"CO",$G(X),"C",,.GMTSM)
"RTN","GMTSXAW3",82,0)
EFN(X) ;   Entity File #     8989.518  .001
"RTN","GMTSXAW3",83,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.001)
"RTN","GMTSXAW3",84,0)
ENM(X) ;   Entity Name       8989.518  .01
"RTN","GMTSXAW3",85,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.01)
"RTN","GMTSXAW3",86,0)
EAB(X) ;   Entity Abbrv      8989.518  .02
"RTN","GMTSXAW3",87,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.02)
"RTN","GMTSXAW3",88,0)
EMC(X) ;   Entity Mix Case   8989.518  .03
"RTN","GMTSXAW3",89,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.03)
"RTN","GMTSXAW3",90,0)
PDI(X) ;   Param Def IEN     8989.51    Lookup
"RTN","GMTSXAW3",91,0)
 S X=$G(X) Q:'$L(X) "" N DIC,DTOUT,DUOUT,Y,GMTSM
"RTN","GMTSXAW3",92,0)
 Q $$FIND1^DIC(8989.51,,"CO",$G(X),.GMTSM)
"RTN","GMTSXAW3",93,0)
PDN(X) ;   Param Def Name    8989.51   .01
"RTN","GMTSXAW3",94,0)
 Q $$GET1^DIQ(8989.51,(+($G(X))_","),.01)
"RTN","GMTSXAW3",95,0)
UVP(X) ;   User Var Ptr      200
"RTN","GMTSXAW3",96,0)
 N GMTS S GMTS=+($G(X)) Q:'$L($$UNM(GMTS)) ""
"RTN","GMTSXAW3",97,0)
 S X=GMTS_";VA(200," Q X
"RTN","GMTSXAW3",98,0)
USR(X) ;   Get User          200       Lookup
"RTN","GMTSXAW3",99,0)
 N DIC,Y,DTOUT,DUOUT,GMTSN,GMTSP S GMTSN=$$UNM(+($G(DUZ))),GMTSP=$G(X),DIC="^VA(200,",DIC(0)="AEMQ",DIC("A")="Select User:  "
"RTN","GMTSXAW3",100,0)
 S:$L(GMTSP) DIC("A")=GMTSP S DIC("S")="I $$ACTIVE^XUSER(+($G(Y)))>0" S:$L(GMTSN) DIC("B")=GMTSN D ^DIC S X=+Y
"RTN","GMTSXAW3",101,0)
 Q X
"RTN","GMTSXAW3",102,0)
UNM(X) ;   User Name         200       .01
"RTN","GMTSXAW3",103,0)
 Q $$GET1^DIQ(200,(+($G(X))_","),.01)
"RTN","GMTSXAW3",104,0)
MGR(X) ;   HS Manager
"RTN","GMTSXAW3",105,0)
 Q $S(((+($G(DUZ))>0)&($D(^XUSEC("GMTSMGR",+($G(DUZ)))))):1,1:0)
"RTN","GMTSXAW3",106,0)
PK(X) ;   Package           9.4       Lookup
"RTN","GMTSXAW3",107,0)
 S X=$G(X) Q:'$L(X) "" N DIC,DTOUT,DUOUT,Y,GMTSM
"RTN","GMTSXAW3",108,0)
 Q $$FIND1^DIC(9.4,,"CO",$G(X),"C",,.GMTSM)
"RTN","GMTSXAW3",109,0)
DEV(X) ;   Device Name       3.5       .01
"RTN","GMTSXAW3",110,0)
 Q $$GET1^DIQ(3.5,(+($G(X))_","),.01)
"RTN","GMTSXAW3",111,0)
DIV(X) ;   Division Name     4         .01
"RTN","GMTSXAW3",112,0)
 Q $$GET1^DIQ(4,(+($G(X))_","),.01)
"RTN","GMTSXAW3",113,0)
SYS(X) ;   System Name       4.2       .01
"RTN","GMTSXAW3",114,0)
 Q $$GET1^DIQ(4.2,(+($G(X))_","),.01)
"RTN","GMTSXAW3",115,0)
PKG(X) ;   Package Name      9.4       .01
"RTN","GMTSXAW3",116,0)
 Q $$GET1^DIQ(9.4,(+($G(X))_","),.01)
"RTN","GMTSXAW3",117,0)
SRI(X) ;   Service (I)       200        29
"RTN","GMTSXAW3",118,0)
 Q $$GET1^DIQ(200,(+($G(X))_","),29,"I")
"RTN","GMTSXAW3",119,0)
SRV(X) ;   Service Name      49        .01
"RTN","GMTSXAW3",120,0)
 Q $$GET1^DIQ(49,(+($G(X))_","),.01)
"RTN","GMTSXAW3",121,0)
CLS(X) ;   User Class Name   8930      .01
"RTN","GMTSXAW3",122,0)
 Q $$UP^GMTSXA($$CLNAME^USRLM(+($G(X))))
"RTN","GMTSXAW3",123,0)
SYSV(X) ;   System Var Ptr
"RTN","GMTSXAW3",124,0)
 N GMTSYS S GMTSYS=$$KSP^XUPARAM("WHERE") I $L(GMTSYS) D  Q:'$L(GMTSYS)
"RTN","GMTSXAW3",125,0)
 . N DIC,DTOUT,DUOUT,X,Y S DIC="^DIC(4.2,",X=GMTSYS,DIC(0)="MXO"
"RTN","GMTSXAW3",126,0)
 . D ^DIC S GMTSYS=+Y S:GMTSYS'>0 GMTSYS="" S GMTSYS=$S(+GMTSYS>0:(GMTSYS_";"_$P(DIC,"^",2)),1:"")
"RTN","GMTSXAW3",127,0)
 S X=GMTSYS Q X
"RTN","GMTSXAW3",128,0)
USRV(X) ;   User Var Ptr
"RTN","GMTSXAW3",129,0)
 N GMTSU,GMTSUV S GMTSU=$G(X) I $L($$UNM(+($G(X)))) S X=+($G(X))_";VA(200," Q X
"RTN","GMTSXAW3",130,0)
 N DIC,DTOUT,DUOUT,X,Y S DIC="^VA(200,",X=GMTSU,DIC(0)="MXO" D ^DIC S GMTSU=+Y,GMTSUV=""
"RTN","GMTSXAW3",131,0)
 S:GMTSU'>0 GMTSUV="" S:GMTSU>0 GMTSUV=GMTSU_";"_$P(DIC,"^",2) S X=GMTSUV Q X
"SEC","^DIC",142.98,142.98,0,"AUDIT")
@
"SEC","^DIC",142.98,142.98,0,"DD")
@
"SEC","^DIC",142.98,142.98,0,"DEL")
@
"SEC","^DIC",142.98,142.98,0,"LAYGO")
@
"SEC","^DIC",142.98,142.98,0,"RD")
@
"SEC","^DIC",142.98,142.98,0,"WR")
@
"VER")
8.0^22.0
"^DD",142,142,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",142,142,.01,1,0)
^.1
"^DD",142,142,.01,1,1,0)
142^B
"^DD",142,142,.01,1,1,1)
S ^GMT(142,"B",$E(X,1,30),DA)=""
"^DD",142,142,.01,1,1,2)
K ^GMT(142,"B",$E(X,1,30),DA)
"^DD",142,142,.01,1,1,"%D",0)
^^2^2^2950731^^
"^DD",142,142,.01,1,1,"%D",1,0)
This REGULAR "B" cross-reference is used for Health Summary Type look-up
"^DD",142,142,.01,1,1,"%D",2,0)
by name.
"^DD",142,142,.01,1,2,0)
142^AW^MUMPS
"^DD",142,142,.01,1,2,1)
D STNT^GMTSUIX
"^DD",142,142,.01,1,2,2)
D KTNT^GMTSUIX
"^DD",142,142,.01,1,2,"DT")
2981214
"^DD",142,142,.01,1,3,0)
142^AB^MUMPS
"^DD",142,142,.01,1,3,1)
S ^GMT(142,"AB",$$UP^XLFSTR($E(X,1,30)),DA)=""
"^DD",142,142,.01,1,3,2)
K ^GMT(142,"AB",$$UP^XLFSTR($E(X,1,30)),DA)
"^DD",142,142,.01,1,3,"%D",0)
^^3^3^2990201^
"^DD",142,142,.01,1,3,"%D",1,0)
^GMT(142,"AB",UP,IEN) - Where UP is an uppercase version of the Health 
"^DD",142,142,.01,1,3,"%D",2,0)
Summary Type and IEN is the location where the Health Summary Type is 
"^DD",142,142,.01,1,3,"%D",3,0)
stored.
"^DD",142,142,.01,1,3,"DT")
2990201
"^DD",142,142,.01,3)
Answer must be a unique name, 3-30 characters in length.
"^DD",142,142,.01,21,0)
^^7^7^2950728^^^^
"^DD",142,142,.01,21,1,0)
Enter the NAME of the Health Summary Type.  This name will appear
"^DD",142,142,.01,21,2,0)
in the health summary header.  The word "CONFIDENTIAL" will appear
"^DD",142,142,.01,21,3,0)
in front of this name and the word "SUMMARY" will appear at the end
"^DD",142,142,.01,21,4,0)
to complete the header.  For example:
"^DD",142,142,.01,21,5,0)
 
"^DD",142,142,.01,21,6,0)
    Name entered: ICU
"^DD",142,142,.01,21,7,0)
Generated header: CONFIDENTIAL ICU SUMMARY
"^DD",142,142,.01,"DEL",1,0)
I $P(^GMT(142,DA,0),U,4)="Y" W $C(7),!,"CANNOT DELETE THIS HEALTH SUMMARY TYPE!!  IT IS USED BY THE AD HOC OPTION"
"^DD",142,142,.01,"DT")
3010723
"^DD",142.98,142.98,0)
FIELD^^11^3
"^DD",142.98,142.98,0,"DT")
3010116
"^DD",142.98,142.98,0,"IX","AB",142.98,.01)

"^DD",142.98,142.98,0,"IX","B",142.98,.01)

"^DD",142.98,142.98,0,"NM","HEALTH SUMMARY USER PREFERENCES")

"^DD",142.98,142.98,.01,0)
USER^RP200'^VA(200,^0;1^K:$$ACTIVE^XUSER(+($G(X)))=0 X S:$D(X) DINUM=X
"^DD",142.98,142.98,.01,1,0)
^.1
"^DD",142.98,142.98,.01,1,1,0)
142.98^B
"^DD",142.98,142.98,.01,1,1,1)
S ^GMT(142.98,"B",$E(X,1,30),DA)=""
"^DD",142.98,142.98,.01,1,1,2)
K ^GMT(142.98,"B",$E(X,1,30),DA)
"^DD",142.98,142.98,.01,1,2,0)
142.98^AB^MUMPS
"^DD",142.98,142.98,.01,1,2,1)
S:$L($$GET1^DIQ(200,+($G(X)),.01)) ^GMT(142.98,"AB",$$GET1^DIQ(200,+($G(X)),.01),DA)=""
"^DD",142.98,142.98,.01,1,2,2)
K:$L($$GET1^DIQ(200,+($G(X)),.01)) ^GMT(142.98,"AB",$$GET1^DIQ(200,+($G(X)),.01),DA)
"^DD",142.98,142.98,.01,1,2,"DT")
3010109
"^DD",142.98,142.98,.01,3)

"^DD",142.98,142.98,.01,"DT")
3010109
"^DD",142.98,142.98,10,0)
HEALTH SUMMARY LIST BUILD^S^0:OVERWRITE;1:APPEND;^1;1^Q
"^DD",142.98,142.98,10,21,0)
^.001^8^8^3010116^^
"^DD",142.98,142.98,10,21,1,0)
This field determines how the list of Health Summary Types for the CPRS GUI 
"^DD",142.98,142.98,10,21,2,0)
report tab is to be organized (APPEND or OVERWRITE) for user selection.  
"^DD",142.98,142.98,10,21,3,0)
There are three major classes of Health Summary types, National (remote data 
"^DD",142.98,142.98,10,21,4,0)
view), user defined and system defined.  User and system Health Summary 
"^DD",142.98,142.98,10,21,5,0)
Types are defined in the Kernel Parameters file.  Append creates a single 
"^DD",142.98,142.98,10,21,6,0)
list, removing duplicates, and keeps the National Health Summary types group 
"^DD",142.98,142.98,10,21,7,0)
together.  Overwrite stops building the list once a single group of Health
"^DD",142.98,142.98,10,21,8,0)
Summary Types (User or System) is added to the list.
"^DD",142.98,142.98,10,"DT")
3010116
"^DD",142.98,142.98,11,0)
HEALTH SUMMARY LIST PRIORITY^F^^1;2^K:$L(X)>40!($L(X)<3) X
"^DD",142.98,142.98,11,3)
Answer must be 3-40 characters in length.
"^DD",142.98,142.98,11,21,0)
^.001^4^4^3010102^^
"^DD",142.98,142.98,11,21,1,0)
There are three major classes of Health Summary types, National (remote data
"^DD",142.98,142.98,11,21,2,0)
view), user defined and system defined.  This field provides order in which 
"^DD",142.98,142.98,11,21,3,0)
these groups of Health Summary Types are added to the Health Summary Types 
"^DD",142.98,142.98,11,21,4,0)
list for the CPRS GUI reports tab. 
"^DD",142.98,142.98,11,"DT")
3010102
"^DIC",142.98,142.98,0)
HEALTH SUMMARY USER PREFERENCES^142.98
"^DIC",142.98,142.98,0,"GL")
^GMT(142.98,
"^DIC",142.98,"B","HEALTH SUMMARY USER PREFERENCES",142.98)

**END**
**END**
