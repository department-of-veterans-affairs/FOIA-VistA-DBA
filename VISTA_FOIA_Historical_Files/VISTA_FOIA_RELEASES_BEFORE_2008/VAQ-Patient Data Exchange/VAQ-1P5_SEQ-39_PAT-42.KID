Released VAQ*1.5*42 SEQ #39
Extracted from mail message
**KIDS**:VAQ*1.5*42^

**INSTALL NAME**
VAQ*1.5*42
"BLD",1088,0)
VAQ*1.5*42^PATIENT DATA EXCHANGE^0^3050119^y
"BLD",1088,1,0)
^^64^64^3040518^^^^
"BLD",1088,1,1,0)
Patch VAQ*1.5*42
"BLD",1088,1,2,0)
 
"BLD",1088,1,3,0)
NOIS: none
"BLD",1088,1,4,0)
Test Sites: Oklahoma City, OK; Madison, WI; Milwaukee, WI; Tomah, WI;
"BLD",1088,1,5,0)
            Montana HCS
"BLD",1088,1,6,0)

"BLD",1088,1,7,0)
This patch alters PDX to use the new API from IB (Integrated Billing),
"BLD",1088,1,8,0)
introduced in patch IB*2.0*256, to access billing (insurance) data.
"BLD",1088,1,9,0)

"BLD",1088,1,10,0)
NOTE: This patch should be installed during off hours, when user activity
"BLD",1088,1,11,0)
is at a minimum.  It requires patch IB*2.0*267.  It also requires patch
"BLD",1088,1,12,0)
VAQ*1.5*13.  (KIDS will not check for this patch because it predates KIDS.
"BLD",1088,1,13,0)
You must check manually.)
"BLD",1088,1,14,0)
==========================================================================
"BLD",1088,1,15,0)
 
"BLD",1088,1,16,0)
ROUTINES:
"BLD",1088,1,17,0)
The second line of the routine now looks like:
"BLD",1088,1,18,0)
       ;;1.5;PATIENT DATA EXCHANGE;**[patch list]**;NOV 17, 1993
"BLD",1088,1,19,0)
 
"BLD",1088,1,20,0)
             Before        After
"BLD",1088,1,21,0)
Name       Checksum     Checksum     Patch List
"BLD",1088,1,22,0)
-----------------------------------------------------------------
"BLD",1088,1,23,0)
VAQDBIP7    3165540     11036802     13,42
"BLD",1088,1,24,0)

"BLD",1088,1,25,0)
* Checksums produced by CHECK^XTSUMBLD
"BLD",1088,1,26,0)

"BLD",1088,1,27,0)
This patch introduces no new routines.
"BLD",1088,1,28,0)
==========================================================================
"BLD",1088,1,29,0)
 
"BLD",1088,1,30,0)
INSTALLATION:
"BLD",1088,1,31,0)
NOTE: This patch should be installed during off hours, when user activity
"BLD",1088,1,32,0)
is at a minimum.  It requires patch IB*2.0*267.  It also requires patch
"BLD",1088,1,33,0)
VAQ*1.5*13.  (KIDS will not check for this patch because it predates KIDS.
"BLD",1088,1,34,0)
You must check manually.)
"BLD",1088,1,35,0)
1.  Users may be on the system during installation of this patch.
"BLD",1088,1,36,0)
2.  DSM Sites: If any of these routines is mapped, disable mapping for the
"BLD",1088,1,37,0)
    affected routine(s).  
"BLD",1088,1,38,0)
3.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option.
"BLD",1088,1,39,0)
    This loads the patch into a Transport Global on your system.  
"BLD",1088,1,40,0)
4.  You do not need to stop TaskMan.
"BLD",1088,1,41,0)
    Users may be on the system.
"BLD",1088,1,42,0)
5.  On the KIDS:Installation menu, use the following options to install
"BLD",1088,1,43,0)
    the Transport Global.
"BLD",1088,1,44,0)
       Verify Checksums in Transport Global
"BLD",1088,1,45,0)
       Print Transport Global
"BLD",1088,1,46,0)
       Compare Transport Global to Current System
"BLD",1088,1,47,0)
       Backup a Transport Global
"BLD",1088,1,48,0)
       Install Package(s)
"BLD",1088,1,49,0)
 Select INSTALL NAME:   VAQ*1.5*42   Loaded from Distribution <date/time>
"BLD",1088,1,50,0)
                        ==========
"BLD",1088,1,51,0)
 Install Questions:
"BLD",1088,1,52,0)
 Want KIDS to INHIBIT LOGONs during the install? YES// NO
"BLD",1088,1,53,0)
                                                       ==
"BLD",1088,1,54,0)
 Want to DISABLE Scheduled Options, Menu Options, and Protocols? YES// NO
"BLD",1088,1,55,0)
                                                                       ==
"BLD",1088,1,56,0)
 Enter the Device you want to print the Install messages.
"BLD",1088,1,57,0)
 You can queue the install by enter a 'Q' at the device prompt.
"BLD",1088,1,58,0)
 Enter a '^' to abort the install.
"BLD",1088,1,59,0)
 
"BLD",1088,1,60,0)
 DEVICE: HOME// <It's up to you.  You may queue it if you wish.>
"BLD",1088,1,61,0)
                ------------------------------------------------
"BLD",1088,1,62,0)
6.  DSM Sites: After patch has installed, rebuild your map set, if
"BLD",1088,1,63,0)
    necessary.
"BLD",1088,1,64,0)
==========================================================================
"BLD",1088,4,0)
^9.64PA^^
"BLD",1088,"INI")

"BLD",1088,"INIT")

"BLD",1088,"KRN",0)
^9.67PA^8989.52^19
"BLD",1088,"KRN",.4,0)
.4
"BLD",1088,"KRN",.401,0)
.401
"BLD",1088,"KRN",.402,0)
.402
"BLD",1088,"KRN",.403,0)
.403
"BLD",1088,"KRN",.5,0)
.5
"BLD",1088,"KRN",.84,0)
.84
"BLD",1088,"KRN",3.6,0)
3.6
"BLD",1088,"KRN",3.8,0)
3.8
"BLD",1088,"KRN",9.2,0)
9.2
"BLD",1088,"KRN",9.8,0)
9.8
"BLD",1088,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1088,"KRN",9.8,"NM",1,0)
VAQDBIP7^^0^B38645185
"BLD",1088,"KRN",9.8,"NM","B","VAQDBIP7",1)

"BLD",1088,"KRN",19,0)
19
"BLD",1088,"KRN",19.1,0)
19.1
"BLD",1088,"KRN",101,0)
101
"BLD",1088,"KRN",409.61,0)
409.61
"BLD",1088,"KRN",771,0)
771
"BLD",1088,"KRN",870,0)
870
"BLD",1088,"KRN",8989.51,0)
8989.51
"BLD",1088,"KRN",8989.52,0)
8989.52
"BLD",1088,"KRN",8994,0)
8994
"BLD",1088,"KRN","B",.4,.4)

"BLD",1088,"KRN","B",.401,.401)

"BLD",1088,"KRN","B",.402,.402)

"BLD",1088,"KRN","B",.403,.403)

"BLD",1088,"KRN","B",.5,.5)

"BLD",1088,"KRN","B",.84,.84)

"BLD",1088,"KRN","B",3.6,3.6)

"BLD",1088,"KRN","B",3.8,3.8)

"BLD",1088,"KRN","B",9.2,9.2)

"BLD",1088,"KRN","B",9.8,9.8)

"BLD",1088,"KRN","B",19,19)

"BLD",1088,"KRN","B",19.1,19.1)

"BLD",1088,"KRN","B",101,101)

"BLD",1088,"KRN","B",409.61,409.61)

"BLD",1088,"KRN","B",771,771)

"BLD",1088,"KRN","B",870,870)

"BLD",1088,"KRN","B",8989.51,8989.51)

"BLD",1088,"KRN","B",8989.52,8989.52)

"BLD",1088,"KRN","B",8994,8994)

"BLD",1088,"QUES",0)
^9.62^^
"BLD",1088,"REQB",0)
^9.611^1^1
"BLD",1088,"REQB",1,0)
IB*2.0*267^1
"BLD",1088,"REQB","B","IB*2.0*267",1)

"MBREQ")
0
"PKG",186,-1)
1^1
"PKG",186,0)
PATIENT DATA EXCHANGE^VAQ^Module used to manage patient information exchange
"PKG",186,20,0)
^9.402P^^
"PKG",186,22,0)
^9.49I^1^1
"PKG",186,22,1,0)
1.5^2931117^2941017
"PKG",186,22,1,"PAH",1,0)
42^3050119
"PKG",186,22,1,"PAH",1,1,0)
^^64^64^3050119
"PKG",186,22,1,"PAH",1,1,1,0)
Patch VAQ*1.5*42
"PKG",186,22,1,"PAH",1,1,2,0)
 
"PKG",186,22,1,"PAH",1,1,3,0)
NOIS: none
"PKG",186,22,1,"PAH",1,1,4,0)
Test Sites: Oklahoma City, OK; Madison, WI; Milwaukee, WI; Tomah, WI;
"PKG",186,22,1,"PAH",1,1,5,0)
            Montana HCS
"PKG",186,22,1,"PAH",1,1,6,0)

"PKG",186,22,1,"PAH",1,1,7,0)
This patch alters PDX to use the new API from IB (Integrated Billing),
"PKG",186,22,1,"PAH",1,1,8,0)
introduced in patch IB*2.0*256, to access billing (insurance) data.
"PKG",186,22,1,"PAH",1,1,9,0)

"PKG",186,22,1,"PAH",1,1,10,0)
NOTE: This patch should be installed during off hours, when user activity
"PKG",186,22,1,"PAH",1,1,11,0)
is at a minimum.  It requires patch IB*2.0*267.  It also requires patch
"PKG",186,22,1,"PAH",1,1,12,0)
VAQ*1.5*13.  (KIDS will not check for this patch because it predates KIDS.
"PKG",186,22,1,"PAH",1,1,13,0)
You must check manually.)
"PKG",186,22,1,"PAH",1,1,14,0)
==========================================================================
"PKG",186,22,1,"PAH",1,1,15,0)
 
"PKG",186,22,1,"PAH",1,1,16,0)
ROUTINES:
"PKG",186,22,1,"PAH",1,1,17,0)
The second line of the routine now looks like:
"PKG",186,22,1,"PAH",1,1,18,0)
       ;;1.5;PATIENT DATA EXCHANGE;**[patch list]**;NOV 17, 1993
"PKG",186,22,1,"PAH",1,1,19,0)
 
"PKG",186,22,1,"PAH",1,1,20,0)
             Before        After
"PKG",186,22,1,"PAH",1,1,21,0)
Name       Checksum     Checksum     Patch List
"PKG",186,22,1,"PAH",1,1,22,0)
-----------------------------------------------------------------
"PKG",186,22,1,"PAH",1,1,23,0)
VAQDBIP7    3165540     11036802     13,42
"PKG",186,22,1,"PAH",1,1,24,0)

"PKG",186,22,1,"PAH",1,1,25,0)
* Checksums produced by CHECK^XTSUMBLD
"PKG",186,22,1,"PAH",1,1,26,0)

"PKG",186,22,1,"PAH",1,1,27,0)
This patch introduces no new routines.
"PKG",186,22,1,"PAH",1,1,28,0)
==========================================================================
"PKG",186,22,1,"PAH",1,1,29,0)
 
"PKG",186,22,1,"PAH",1,1,30,0)
INSTALLATION:
"PKG",186,22,1,"PAH",1,1,31,0)
NOTE: This patch should be installed during off hours, when user activity
"PKG",186,22,1,"PAH",1,1,32,0)
is at a minimum.  It requires patch IB*2.0*267.  It also requires patch
"PKG",186,22,1,"PAH",1,1,33,0)
VAQ*1.5*13.  (KIDS will not check for this patch because it predates KIDS.
"PKG",186,22,1,"PAH",1,1,34,0)
You must check manually.)
"PKG",186,22,1,"PAH",1,1,35,0)
1.  Users may be on the system during installation of this patch.
"PKG",186,22,1,"PAH",1,1,36,0)
2.  DSM Sites: If any of these routines is mapped, disable mapping for the
"PKG",186,22,1,"PAH",1,1,37,0)
    affected routine(s).  
"PKG",186,22,1,"PAH",1,1,38,0)
3.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option.
"PKG",186,22,1,"PAH",1,1,39,0)
    This loads the patch into a Transport Global on your system.  
"PKG",186,22,1,"PAH",1,1,40,0)
4.  You do not need to stop TaskMan.
"PKG",186,22,1,"PAH",1,1,41,0)
    Users may be on the system.
"PKG",186,22,1,"PAH",1,1,42,0)
5.  On the KIDS:Installation menu, use the following options to install
"PKG",186,22,1,"PAH",1,1,43,0)
    the Transport Global.
"PKG",186,22,1,"PAH",1,1,44,0)
       Verify Checksums in Transport Global
"PKG",186,22,1,"PAH",1,1,45,0)
       Print Transport Global
"PKG",186,22,1,"PAH",1,1,46,0)
       Compare Transport Global to Current System
"PKG",186,22,1,"PAH",1,1,47,0)
       Backup a Transport Global
"PKG",186,22,1,"PAH",1,1,48,0)
       Install Package(s)
"PKG",186,22,1,"PAH",1,1,49,0)
 Select INSTALL NAME:   VAQ*1.5*42   Loaded from Distribution <date/time>
"PKG",186,22,1,"PAH",1,1,50,0)
                        ==========
"PKG",186,22,1,"PAH",1,1,51,0)
 Install Questions:
"PKG",186,22,1,"PAH",1,1,52,0)
 Want KIDS to INHIBIT LOGONs during the install? YES// NO
"PKG",186,22,1,"PAH",1,1,53,0)
                                                       ==
"PKG",186,22,1,"PAH",1,1,54,0)
 Want to DISABLE Scheduled Options, Menu Options, and Protocols? YES// NO
"PKG",186,22,1,"PAH",1,1,55,0)
                                                                       ==
"PKG",186,22,1,"PAH",1,1,56,0)
 Enter the Device you want to print the Install messages.
"PKG",186,22,1,"PAH",1,1,57,0)
 You can queue the install by enter a 'Q' at the device prompt.
"PKG",186,22,1,"PAH",1,1,58,0)
 Enter a '^' to abort the install.
"PKG",186,22,1,"PAH",1,1,59,0)
 
"PKG",186,22,1,"PAH",1,1,60,0)
 DEVICE: HOME// <It's up to you.  You may queue it if you wish.>
"PKG",186,22,1,"PAH",1,1,61,0)
                ------------------------------------------------
"PKG",186,22,1,"PAH",1,1,62,0)
6.  DSM Sites: After patch has installed, rebuild your map set, if
"PKG",186,22,1,"PAH",1,1,63,0)
    necessary.
"PKG",186,22,1,"PAH",1,1,64,0)
==========================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","VAQDBIP7")
0^1^B38645185
"RTN","VAQDBIP7",1,0)
VAQDBIP7 ;ALB/JRP - CONTINUATION FOR VAQDBIP4: 3/17/2004
"RTN","VAQDBIP7",2,0)
 ;;1.5;PATIENT DATA EXCHANGE;**13,42**;NOV 17, 1993
"RTN","VAQDBIP7",3,0)
INSURE ;INSURANCE EXTRACTION (ALL NON-EXPIRED)
"RTN","VAQDBIP7",4,0)
 ;  DECLARATIONS DONE IN VAQDBIP4
"RTN","VAQDBIP7",5,0)
 ;GET LIST OF FIELDS TO EXTRACT
"RTN","VAQDBIP7",6,0)
 S TMP=$T(INSURE+1^VAQDBII1)
"RTN","VAQDBIP7",7,0)
 S FLDS(1)=$TR($P(TMP,";",4),",",";")
"RTN","VAQDBIP7",8,0)
 S TMP=$T(INSURE+2^VAQDBII1)
"RTN","VAQDBIP7",9,0)
 S FLDS(2)=$TR($P(TMP,";",4),",",";")
"RTN","VAQDBIP7",10,0)
 S TMP=$T(INSURE+3^VAQDBII1)
"RTN","VAQDBIP7",11,0)
 S FLDS(3)=$TR($P(TMP,";",4),",",";")
"RTN","VAQDBIP7",12,0)
 ;ENCRYPT PATIENT NAME (ID FOR INSURANCE COMPANY & GROUP PLAN)
"RTN","VAQDBIP7",13,0)
 S STRING=$P($$PATINFO^VAQUTL1(DFN),U,1)
"RTN","VAQDBIP7",14,0)
 S ENCSTR=STRING
"RTN","VAQDBIP7",15,0)
 I $$NCRPFLD^VAQUTL2(2,.01) X ENCRYPT
"RTN","VAQDBIP7",16,0)
 S NAME=ENCSTR
"RTN","VAQDBIP7",17,0)
 N VAQINS
"RTN","VAQDBIP7",18,0)
 ;DETERMINE IF COVERED BY HEALTH INSURANCE & ENCRYPT
"RTN","VAQDBIP7",19,0)
 ;S TMP=$$INSUR^IBBAPI(DFN,DT,"R",.VAQINS,"1,2,3,4,5,6,8,10,11,12,13,14,18") ; Get all active (not expired) insurance, reimbursable or not
"RTN","VAQDBIP7",20,0)
 S TMP=$$INSUR^IBBAPI(DFN,"","ARB",.VAQINS,"1,2,3,4,5,6,8,10,11,12,13,14,18") ; Get all insurance, expired or not, reimbursable or not
"RTN","VAQDBIP7",21,0)
 S STRING=$S(TMP:"YES",1:"NO")
"RTN","VAQDBIP7",22,0)
 S ENCSTR=STRING
"RTN","VAQDBIP7",23,0)
 I $$NCRPFLD^VAQUTL2(2,.3192) X ENCRYPT
"RTN","VAQDBIP7",24,0)
 ;GET SEQUENCE NUMBER & STORE INFO
"RTN","VAQDBIP7",25,0)
 S SEQ=$$GETSEQ^VAQDBIP(ARRAY,2,.3192)
"RTN","VAQDBIP7",26,0)
 S @ARRAY@("ID",2,.3192,SEQ)=NAME
"RTN","VAQDBIP7",27,0)
 S @ARRAY@("VALUE",2,.3192,SEQ)=ENCSTR
"RTN","VAQDBIP7",28,0)
 ;EXTRACT DATA
"RTN","VAQDBIP7",29,0)
 K ^UTILITY("DIQ1",$J)
"RTN","VAQDBIP7",30,0)
 S TMP=0
"RTN","VAQDBIP7",31,0)
 F  S TMP=$O(VAQINS("IBBAPI","INSUR",TMP)) Q:'TMP  D
"RTN","VAQDBIP7",32,0)
 .;EXTRACT INSURANCE INFO
"RTN","VAQDBIP7",33,0)
 .;Prior to patch *42, we took the info directly from file 2.
"RTN","VAQDBIP7",34,0)
 .;Now we get it from the IB API call.
"RTN","VAQDBIP7",35,0)
 .;PATIENT (#2) file
"RTN","VAQDBIP7",36,0)
 .;INSURANCE TYPE (#2.312) Subfile             API field equivalent
"RTN","VAQDBIP7",37,0)
 .;------------------------------------------  --------------------
"RTN","VAQDBIP7",38,0)
 .;.01 INSURANCE TYPE (ptr to file 36)          1 insurance company name
"RTN","VAQDBIP7",39,0)
 .;.18 GROUP PLAN (ptr to file 355.3)          --
"RTN","VAQDBIP7",40,0)
 .;1   SUBSCRIBER ID                           14 subscriber ID
"RTN","VAQDBIP7",41,0)
 .;2   *GROUP NUMBER                           --
"RTN","VAQDBIP7",42,0)
 .;3   INSURANCE EXPIRATION DATE               11 expiration date
"RTN","VAQDBIP7",43,0)
 .;6   WHOSE INSURANCE (v=vet;s=spouse;o=other)12 subscriber relationship
"RTN","VAQDBIP7",44,0)
 .;7   *RENEWAL DATE                           --
"RTN","VAQDBIP7",45,0)
 .;8   EFFECTIVE DATE OF POLICY                10 effective date
"RTN","VAQDBIP7",46,0)
 .;16  PT. RELATIONSHIP TO INSURED             12 subscriber relationship
"RTN","VAQDBIP7",47,0)
 .;17  NAME OF INSURED                         13 subscriber name
"RTN","VAQDBIP7",48,0)
 .S ^UTILITY("DIQ1",$J,2.312,TMP,.01,"E")=$P(VAQINS("IBBAPI","INSUR",TMP,1),U,2)
"RTN","VAQDBIP7",49,0)
 .S ^UTILITY("DIQ1",$J,2.312,TMP,1,"E")=VAQINS("IBBAPI","INSUR",TMP,14)
"RTN","VAQDBIP7",50,0)
 .S ^UTILITY("DIQ1",$J,2.312,TMP,3,"E")=$$FMTE^XLFDT(VAQINS("IBBAPI","INSUR",TMP,11))
"RTN","VAQDBIP7",51,0)
 .I VAQINS("IBBAPI","INSUR",TMP,12)[U S ^UTILITY("DIQ1",$J,2.312,TMP,6,"E")=$P(VAQINS("IBBAPI","INSUR",TMP,12),U,2)
"RTN","VAQDBIP7",52,0)
 .E  S ^UTILITY("DIQ1",$J,2.312,TMP,6,"E")=VAQINS("IBBAPI","INSUR",TMP,12)
"RTN","VAQDBIP7",53,0)
 .S ^UTILITY("DIQ1",$J,2.312,TMP,8,"E")=$$FMTE^XLFDT(VAQINS("IBBAPI","INSUR",TMP,10))
"RTN","VAQDBIP7",54,0)
 .S ^UTILITY("DIQ1",$J,2.312,TMP,16,"E")=^UTILITY("DIQ1",$J,2.312,TMP,6,"E")
"RTN","VAQDBIP7",55,0)
 .S ^UTILITY("DIQ1",$J,2.312,TMP,17,"E")=VAQINS("IBBAPI","INSUR",TMP,13)
"RTN","VAQDBIP7",56,0)
 .;EXTRACT INFO ABOUT INSURANCE COMPANY
"RTN","VAQDBIP7",57,0)
 .;Prior to patch *42, we took the info directly from file 36.
"RTN","VAQDBIP7",58,0)
 .;Now we get it from the IB API call.
"RTN","VAQDBIP7",59,0)
 .;INSURANCE COMPANY (#36) file                API field equivalent
"RTN","VAQDBIP7",60,0)
 .;------------------------------------------  --------------------
"RTN","VAQDBIP7",61,0)
 .;.01  NAME                                   1 insurance company name
"RTN","VAQDBIP7",62,0)
 .;.111 STREET ADDRESS [LINE 1]                2 street address
"RTN","VAQDBIP7",63,0)
 .;.112 STREET ADDRESS [LINE 2]                -
"RTN","VAQDBIP7",64,0)
 .;.113 STREET ADDRESS [LINE 3]                -
"RTN","VAQDBIP7",65,0)
 .;.114 CITY                                   3 city
"RTN","VAQDBIP7",66,0)
 .;.115 STATE                                  4 state
"RTN","VAQDBIP7",67,0)
 .;.316 ZIP                                    5 zip
"RTN","VAQDBIP7",68,0)
 .;.131 PHONE NUMBER                           6 phone number
"RTN","VAQDBIP7",69,0)
 .S ^UTILITY("DIQ1",$J,36,TMP,.01,"E")=$P(VAQINS("IBBAPI","INSUR",TMP,1),U,2)
"RTN","VAQDBIP7",70,0)
 .S ^UTILITY("DIQ1",$J,36,TMP,.111,"E")=VAQINS("IBBAPI","INSUR",TMP,2)
"RTN","VAQDBIP7",71,0)
 .S ^UTILITY("DIQ1",$J,36,TMP,.114,"E")=VAQINS("IBBAPI","INSUR",TMP,3)
"RTN","VAQDBIP7",72,0)
 .S ^UTILITY("DIQ1",$J,36,TMP,.115,"E")=$P(VAQINS("IBBAPI","INSUR",TMP,4),U,2)
"RTN","VAQDBIP7",73,0)
 .S ^UTILITY("DIQ1",$J,36,TMP,.316,"E")=VAQINS("IBBAPI","INSUR",TMP,5)
"RTN","VAQDBIP7",74,0)
 .S ^UTILITY("DIQ1",$J,36,TMP,.131,"E")=VAQINS("IBBAPI","INSUR",TMP,6)
"RTN","VAQDBIP7",75,0)
 .;EXTRACT INFO ABOUT GROUP PLAN
"RTN","VAQDBIP7",76,0)
 .;Prior to patch *42, we took the info directly from file 355.3.
"RTN","VAQDBIP7",77,0)
 .;Now we get it from the IB API call.
"RTN","VAQDBIP7",78,0)
 .;GROUP INSURANCE PLAN (#355.3) file          API field equivalent
"RTN","VAQDBIP7",79,0)
 .;------------------------------------------  --------------------
"RTN","VAQDBIP7",80,0)
 .;.01 INSURANCE COMPANY (ptr to file 36)       1 insurance company name
"RTN","VAQDBIP7",81,0)
 .;.02 IS THIS A GROUP POLICY? (1=yes/0=no)     -
"RTN","VAQDBIP7",82,0)
 .;.03 GROUP NAME                               8 policy IEN and name
"RTN","VAQDBIP7",83,0)
 .;.04 GROUP NUMBER                            18 policy number
"RTN","VAQDBIP7",84,0)
 .;.1  INDIVIDUAL POLICY PATIENT (ptr to file 2)-
"RTN","VAQDBIP7",85,0)
 .S ^UTILITY("DIQ1",$J,355.3,TMP,.01,"E")=$P(VAQINS("IBBAPI","INSUR",TMP,1),U,2)
"RTN","VAQDBIP7",86,0)
 .S ^UTILITY("DIQ1",$J,355.3,TMP,.03,"E")=$P(VAQINS("IBBAPI","INSUR",TMP,8),U,2)
"RTN","VAQDBIP7",87,0)
 .S ^UTILITY("DIQ1",$J,355.3,TMP,.04,"E")=VAQINS("IBBAPI","INSUR",TMP,18)
"RTN","VAQDBIP7",88,0)
 .;GET SEQUENCE NUMBER FOR INSURANCE
"RTN","VAQDBIP7",89,0)
 .S SEQ=$$GETSEQ^VAQDBIP(ARRAY,2.312,.01)
"RTN","VAQDBIP7",90,0)
 .;ENCRYPT COMPANY NAME
"RTN","VAQDBIP7",91,0)
 .S STRING=$G(^UTILITY("DIQ1",$J,2.312,TMP,.01,"E"))
"RTN","VAQDBIP7",92,0)
 .S ENCSTR=STRING
"RTN","VAQDBIP7",93,0)
 .I $$NCRPFLD^VAQUTL2(2.312,.01) X ENCRYPT
"RTN","VAQDBIP7",94,0)
 .S PRIME=ENCSTR
"RTN","VAQDBIP7",95,0)
 .;STORE COMPANY NAME/ID
"RTN","VAQDBIP7",96,0)
 .S @ARRAY@("ID",2.312,.01,SEQ)=NAME
"RTN","VAQDBIP7",97,0)
 .S @ARRAY@("VALUE",2.312,.01,SEQ)=PRIME
"RTN","VAQDBIP7",98,0)
 .F X=1:1:$L(FLDS(1),";") D
"RTN","VAQDBIP7",99,0)
 ..S Z=$P(FLDS(1),";",X)
"RTN","VAQDBIP7",100,0)
 ..Q:(Z=.01)
"RTN","VAQDBIP7",101,0)
 ..;STORE ID (COMPANY NAME)
"RTN","VAQDBIP7",102,0)
 ..S @ARRAY@("ID",2.312,Z,SEQ)=PRIME
"RTN","VAQDBIP7",103,0)
 ..;ENCRYPT/STORE VALUE
"RTN","VAQDBIP7",104,0)
 ..S STRING=$G(^UTILITY("DIQ1",$J,2.312,TMP,Z,"E"))
"RTN","VAQDBIP7",105,0)
 ..S ENCSTR=STRING
"RTN","VAQDBIP7",106,0)
 ..I $$NCRPFLD^VAQUTL2(2.312,Z) X ENCRYPT
"RTN","VAQDBIP7",107,0)
 ..S @ARRAY@("VALUE",2.312,Z,SEQ)=ENCSTR
"RTN","VAQDBIP7",108,0)
 .;GET SEQUENCE NUMBER FOR COMPANY
"RTN","VAQDBIP7",109,0)
 .S SEQ=$$GETSEQ^VAQDBIP(ARRAY,36,.01)
"RTN","VAQDBIP7",110,0)
 .;ENCRYPT COMPANY NAME
"RTN","VAQDBIP7",111,0)
 .S STRING=$G(^UTILITY("DIQ1",$J,36,TMP,.01,"E"))
"RTN","VAQDBIP7",112,0)
 .S ENCSTR=STRING
"RTN","VAQDBIP7",113,0)
 .I $$NCRPFLD^VAQUTL2(36,.01) X ENCRYPT
"RTN","VAQDBIP7",114,0)
 .S PRIME=ENCSTR
"RTN","VAQDBIP7",115,0)
 .;STORE COMPANY NAME/ID
"RTN","VAQDBIP7",116,0)
 .S @ARRAY@("ID",36,.01,SEQ)=NAME
"RTN","VAQDBIP7",117,0)
 .S @ARRAY@("VALUE",36,.01,SEQ)=PRIME
"RTN","VAQDBIP7",118,0)
 .F X=1:1:$L(FLDS(2),";") D
"RTN","VAQDBIP7",119,0)
 ..S Z=$P(FLDS(2),";",X)
"RTN","VAQDBIP7",120,0)
 ..Q:(Z=.01)
"RTN","VAQDBIP7",121,0)
 ..;STORE ID (COMPANY NAME)
"RTN","VAQDBIP7",122,0)
 ..S @ARRAY@("ID",36,Z,SEQ)=PRIME
"RTN","VAQDBIP7",123,0)
 ..;ENCRYPT/STORE VALUE
"RTN","VAQDBIP7",124,0)
 ..S STRING=$G(^UTILITY("DIQ1",$J,36,TMP,Z,"E"))
"RTN","VAQDBIP7",125,0)
 ..S ENCSTR=STRING
"RTN","VAQDBIP7",126,0)
 ..I $$NCRPFLD^VAQUTL2(36,Z) X ENCRYPT
"RTN","VAQDBIP7",127,0)
 ..S @ARRAY@("VALUE",36,Z,SEQ)=ENCSTR
"RTN","VAQDBIP7",128,0)
 .;GET SEQUENCE NUMBER FOR GROUP PLAN
"RTN","VAQDBIP7",129,0)
 .S SEQ=$$GETSEQ^VAQDBIP(ARRAY,355.3,.01)
"RTN","VAQDBIP7",130,0)
 .;ENCRYPT PLAN NAME
"RTN","VAQDBIP7",131,0)
 .S STRING=$G(^UTILITY("DIQ1",$J,355.3,TMP,.01,"E"))
"RTN","VAQDBIP7",132,0)
 .S ENCSTR=STRING
"RTN","VAQDBIP7",133,0)
 .I $$NCRPFLD^VAQUTL2(355.3,.01) X ENCRYPT
"RTN","VAQDBIP7",134,0)
 .S PRIME=ENCSTR
"RTN","VAQDBIP7",135,0)
 .;STORE PLAN NAME/ID
"RTN","VAQDBIP7",136,0)
 .S @ARRAY@("ID",355.3,.01,SEQ)=NAME
"RTN","VAQDBIP7",137,0)
 .S @ARRAY@("VALUE",355.3,.01,SEQ)=PRIME
"RTN","VAQDBIP7",138,0)
 .F X=1:1:$L(FLDS(3),";") D
"RTN","VAQDBIP7",139,0)
 ..S Z=$P(FLDS(3),";",X)
"RTN","VAQDBIP7",140,0)
 ..Q:(Z=.01)
"RTN","VAQDBIP7",141,0)
 ..;STORE ID (PLAN NAME)
"RTN","VAQDBIP7",142,0)
 ..S @ARRAY@("ID",355.3,Z,SEQ)=PRIME
"RTN","VAQDBIP7",143,0)
 ..;ENCRYPT/STORE VALUE
"RTN","VAQDBIP7",144,0)
 ..S STRING=$G(^UTILITY("DIQ1",$J,355.3,TMP,Z,"E"))
"RTN","VAQDBIP7",145,0)
 ..S ENCSTR=STRING
"RTN","VAQDBIP7",146,0)
 ..I $$NCRPFLD^VAQUTL2(355.3,Z) X ENCRYPT
"RTN","VAQDBIP7",147,0)
 ..S @ARRAY@("VALUE",355.3,Z,SEQ)=ENCSTR
"RTN","VAQDBIP7",148,0)
 .K ^UTILITY("DIQ1",$J)
"RTN","VAQDBIP7",149,0)
 Q
"VER")
8.0^22.0
**END**
**END**
