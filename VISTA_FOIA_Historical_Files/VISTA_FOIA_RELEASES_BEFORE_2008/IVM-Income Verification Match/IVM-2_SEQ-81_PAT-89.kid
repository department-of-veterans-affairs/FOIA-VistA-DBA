EMERGENCY Released IVM*2*89 SEQ #81
Extracted from mail message
**KIDS**:IVM*2.0*89^

**INSTALL NAME**
IVM*2.0*89
"BLD",5351,0)
IVM*2.0*89^INCOME VERIFICATION MATCH^0^3040311^y
"BLD",5351,4,0)
^9.64PA^^0
"BLD",5351,"INIT")
IVM289A
"BLD",5351,"KRN",0)
^9.67PA^8989.52^19
"BLD",5351,"KRN",.4,0)
.4
"BLD",5351,"KRN",.401,0)
.401
"BLD",5351,"KRN",.402,0)
.402
"BLD",5351,"KRN",.403,0)
.403
"BLD",5351,"KRN",.5,0)
.5
"BLD",5351,"KRN",.84,0)
.84
"BLD",5351,"KRN",3.6,0)
3.6
"BLD",5351,"KRN",3.8,0)
3.8
"BLD",5351,"KRN",9.2,0)
9.2
"BLD",5351,"KRN",9.8,0)
9.8
"BLD",5351,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",5351,"KRN",9.8,"NM",1,0)
IVMCZMT^^0^B49588288
"BLD",5351,"KRN",9.8,"NM",2,0)
IVMPTRN^^0^B42649370
"BLD",5351,"KRN",9.8,"NM",3,0)
IVM289A^^0^B6478247
"BLD",5351,"KRN",9.8,"NM",4,0)
IVM289M^^0^B5345779
"BLD",5351,"KRN",9.8,"NM",5,0)
IVMCDD^^0^B7519403
"BLD",5351,"KRN",9.8,"NM",6,0)
IVMPMTE^^0^B8709812
"BLD",5351,"KRN",9.8,"NM",7,0)
IVMPTRN8^^0^B51723284
"BLD",5351,"KRN",9.8,"NM","B","IVM289A",3)

"BLD",5351,"KRN",9.8,"NM","B","IVM289M",4)

"BLD",5351,"KRN",9.8,"NM","B","IVMCDD",5)

"BLD",5351,"KRN",9.8,"NM","B","IVMCZMT",1)

"BLD",5351,"KRN",9.8,"NM","B","IVMPMTE",6)

"BLD",5351,"KRN",9.8,"NM","B","IVMPTRN",2)

"BLD",5351,"KRN",9.8,"NM","B","IVMPTRN8",7)

"BLD",5351,"KRN",19,0)
19
"BLD",5351,"KRN",19,"NM",0)
^9.68A^^
"BLD",5351,"KRN",19.1,0)
19.1
"BLD",5351,"KRN",101,0)
101
"BLD",5351,"KRN",409.61,0)
409.61
"BLD",5351,"KRN",771,0)
771
"BLD",5351,"KRN",870,0)
870
"BLD",5351,"KRN",8989.51,0)
8989.51
"BLD",5351,"KRN",8989.52,0)
8989.52
"BLD",5351,"KRN",8994,0)
8994
"BLD",5351,"KRN","B",.4,.4)

"BLD",5351,"KRN","B",.401,.401)

"BLD",5351,"KRN","B",.402,.402)

"BLD",5351,"KRN","B",.403,.403)

"BLD",5351,"KRN","B",.5,.5)

"BLD",5351,"KRN","B",.84,.84)

"BLD",5351,"KRN","B",3.6,3.6)

"BLD",5351,"KRN","B",3.8,3.8)

"BLD",5351,"KRN","B",9.2,9.2)

"BLD",5351,"KRN","B",9.8,9.8)

"BLD",5351,"KRN","B",19,19)

"BLD",5351,"KRN","B",19.1,19.1)

"BLD",5351,"KRN","B",101,101)

"BLD",5351,"KRN","B",409.61,409.61)

"BLD",5351,"KRN","B",771,771)

"BLD",5351,"KRN","B",870,870)

"BLD",5351,"KRN","B",8989.51,8989.51)

"BLD",5351,"KRN","B",8989.52,8989.52)

"BLD",5351,"KRN","B",8994,8994)

"BLD",5351,"QUES",0)
^9.62^^
"BLD",5351,"REQB",0)
^9.611^3^3
"BLD",5351,"REQB",1,0)
IVM*2.0*79^2
"BLD",5351,"REQB",2,0)
IVM*2.0*81^2
"BLD",5351,"REQB",3,0)
IVM*2.0*85^2
"BLD",5351,"REQB","B","IVM*2.0*79",1)

"BLD",5351,"REQB","B","IVM*2.0*81",2)

"BLD",5351,"REQB","B","IVM*2.0*85",3)

"INIT")
IVM289A
"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
89^3040311^123456798
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","IVM289A")
0^3^B6478247
"RTN","IVM289A",1,0)
IVM289A ;ALB/RMM IVM Patient File Xref Cleanup Utility ; 01/27/2004
"RTN","IVM289A",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**89**;21-OCT-94
"RTN","IVM289A",3,0)
 ;
"RTN","IVM289A",4,0)
 ; Global Counter Storage Details:
"RTN","IVM289A",5,0)
 ; ^XTMP("IVM289",0,"IVM")   Count of invalid 301.5 pointers
"RTN","IVM289A",6,0)
 ; ^XTMP("IVM289",0,"DGMT")  Count of invalid 408.31 pointers
"RTN","IVM289A",7,0)
 ; ^XTMP("IVM289",0,"DUP")   Count of Duplicate xref entries
"RTN","IVM289A",8,0)
 ; ^XTMP("IVM289",0,"TOT")   Total count of all xrefs
"RTN","IVM289A",9,0)
 ; ^XTMP("IVM289",0,"DEL")   Total count of all xrefs purged
"RTN","IVM289A",10,0)
 ;
"RTN","IVM289A",11,0)
EN ; Begin processing
"RTN","IVM289A",12,0)
 ; Write message to installation device and to INSTALL file (#9.7)
"RTN","IVM289A",13,0)
 D BMES^XPDUTL("IVM Patient File Xref Cleanup Post Install")
"RTN","IVM289A",14,0)
 D MES^XPDUTL("When the the cleanup has completed, a MailMan message")
"RTN","IVM289A",15,0)
 D MES^XPDUTL("messawill bt containing a recap of the deleted")
"RTN","IVM289A",16,0)
 D MES^XPDUTL("cross references.")
"RTN","IVM289A",17,0)
 D BMES^XPDUTL("Beginning clean-up process "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","IVM289A",18,0)
 ;
"RTN","IVM289A",19,0)
INIT ; Initialize tracking global (See text above for description)
"RTN","IVM289A",20,0)
 N %,X,X1,X2,I
"RTN","IVM289A",21,0)
 S X1=DT,X2=120 D C^%DTC
"RTN","IVM289A",22,0)
 S ^XTMP("IVM289",0)=X_"^"_$$DT^XLFDT_"^IVM Patient File Xref Cleanup"
"RTN","IVM289A",23,0)
 ;
"RTN","IVM289A",24,0)
 F I="IVM","DGMT","DUP","TOT","DEL" S ^XTMP("IVM289",0,I)=0
"RTN","IVM289A",25,0)
 ;
"RTN","IVM289A",26,0)
START ;
"RTN","IVM289A",27,0)
 N TYPE,FDATE,IVMPAT,MTIEN
"RTN","IVM289A",28,0)
 F TYPE="AC","AD" D
"RTN","IVM289A",29,0)
 .S FDATE=0
"RTN","IVM289A",30,0)
 .F  S FDATE=$O(^IVM(301.5,TYPE,FDATE)) Q:('FDATE)  D
"RTN","IVM289A",31,0)
 ..S IVMPAT=0
"RTN","IVM289A",32,0)
 ..F  S IVMPAT=$O(^IVM(301.5,TYPE,FDATE,IVMPAT)) Q:'IVMPAT  D
"RTN","IVM289A",33,0)
 ...S MTIEN=$O(^IVM(301.5,TYPE,FDATE,IVMPAT,""),-1)
"RTN","IVM289A",34,0)
 ...;
"RTN","IVM289A",35,0)
 ...D CKMULT
"RTN","IVM289A",36,0)
 ...I FDATE<DT D DUP,TOT,DEL,DELX(MTIEN) Q
"RTN","IVM289A",37,0)
 ...;
"RTN","IVM289A",38,0)
 ...I '$D(^IVM(301.5,IVMPAT,0)) D IVM,TOT,DEL,DELX(MTIEN) Q
"RTN","IVM289A",39,0)
 ...;
"RTN","IVM289A",40,0)
 ...I '$D(^DGMT(408.31,MTIEN,0)) D DGMT,TOT,DEL,DELX(MTIEN) Q
"RTN","IVM289A",41,0)
 ...;
"RTN","IVM289A",42,0)
 ...D TOT
"RTN","IVM289A",43,0)
 ;
"RTN","IVM289A",44,0)
 ;
"RTN","IVM289A",45,0)
 ; Send a mailman msg to the user with the results
"RTN","IVM289A",46,0)
 D MAIL^IVM289M
"RTN","IVM289A",47,0)
 D MES^XPDUTL(" >>clean-up process completed "_$$FMTE^XLFDT($$NOW^XLFDT))
"RTN","IVM289A",48,0)
 Q
"RTN","IVM289A",49,0)
 ;
"RTN","IVM289A",50,0)
CKMULT ; Remove duplicate entries from cross reference, leaving last entry
"RTN","IVM289A",51,0)
 N MTREC S MTREC=0
"RTN","IVM289A",52,0)
 F  S MTREC=$O(^IVM(301.5,TYPE,FDATE,IVMPAT,MTREC)) Q:(MTREC=MTIEN!('MTREC))  D DUP,TOT,DEL,DELX(MTREC)
"RTN","IVM289A",53,0)
 Q
"RTN","IVM289A",54,0)
 ;
"RTN","IVM289A",55,0)
 ; Delete Cross Reference
"RTN","IVM289A",56,0)
DELX(MTIEN) K ^IVM(301.5,TYPE,FDATE,IVMPAT,MTIEN) Q
"RTN","IVM289A",57,0)
 ;
"RTN","IVM289A",58,0)
 ; Increment Global Counters
"RTN","IVM289A",59,0)
IVM S ^XTMP("IVM289",0,"IVM")=^XTMP("IVM289",0,"IVM")+1 Q
"RTN","IVM289A",60,0)
DGMT S ^XTMP("IVM289",0,"DGMT")=^XTMP("IVM289",0,"DGMT")+1 Q
"RTN","IVM289A",61,0)
DUP S ^XTMP("IVM289",0,"DUP")=^XTMP("IVM289",0,"DUP")+1 Q
"RTN","IVM289A",62,0)
TOT S ^XTMP("IVM289",0,"TOT")=^XTMP("IVM289",0,"TOT")+1 Q
"RTN","IVM289A",63,0)
DEL S ^XTMP("IVM289",0,"DEL")=^XTMP("IVM289",0,"DEL")+1 Q
"RTN","IVM289A",64,0)
 Q
"RTN","IVM289M")
0^4^B5345779
"RTN","IVM289M",1,0)
IVM289M ;ALB/RMM IVM Patient File Xref Cleanup Mailman Msg ; 01/27/2004
"RTN","IVM289M",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**89**:21-OCT-94
"RTN","IVM289M",3,0)
 ;
"RTN","IVM289M",4,0)
 ; This routine was created to handle MailMan message for the
"RTN","IVM289M",5,0)
 ; Cleanup in Patch IVM*2*89
"RTN","IVM289M",6,0)
 ;
"RTN","IVM289M",7,0)
MAIL ; Send a mailman msg to user with results
"RTN","IVM289M",8,0)
 N DIFROM,%,X,XMDUZ,XMSUB,XMTEXT,XMY,Y,MSG
"RTN","IVM289M",9,0)
 N LNCNT
"RTN","IVM289M",10,0)
 ;
"RTN","IVM289M",11,0)
 K ^TMP("IVM289",$J)
"RTN","IVM289M",12,0)
 S XMSUB="IVM Patient File Xref Cleanup"
"RTN","IVM289M",13,0)
 S XMDUZ="IVM Cleanup Package",XMY(DUZ)=""
"RTN","IVM289M",14,0)
 S XMTEXT="MSG("
"RTN","IVM289M",15,0)
 ;
"RTN","IVM289M",16,0)
BLDHD ; Build the message head section of the report
"RTN","IVM289M",17,0)
 S LNCNT=0
"RTN","IVM289M",18,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)="        IVM Patient File Xref Cleanup"
"RTN","IVM289M",19,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)="        Patch IVM*2.0*89 Post Install"
"RTN","IVM289M",20,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)=$$REPEAT^XLFSTR("=",50)
"RTN","IVM289M",21,0)
 ;
"RTN","IVM289M",22,0)
BLDBDY ; Build the data section of the report
"RTN","IVM289M",23,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)=" Recap of Purged Xrefs for Future Dated"
"RTN","IVM289M",24,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)="            Income Tests"
"RTN","IVM289M",25,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)=$$REPEAT^XLFSTR("-",50)
"RTN","IVM289M",26,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)="      Invalid 301.5 record pointers: "_$$RJ^XLFSTR($FN(^XTMP("IVM289",0,"IVM"),","),6)
"RTN","IVM289M",27,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)="     Invalid 408.31 record pointers: "_$$RJ^XLFSTR($FN(^XTMP("IVM289",0,"DGMT"),","),6)
"RTN","IVM289M",28,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)="             Duplicate xref entries: "_$$RJ^XLFSTR($FN(^XTMP("IVM289",0,"DUP"),","),6)
"RTN","IVM289M",29,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)=$$REPEAT^XLFSTR("-",50)
"RTN","IVM289M",30,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)="                Total xrefs checked: "_$$RJ^XLFSTR($FN(^XTMP("IVM289",0,"TOT"),","),6)
"RTN","IVM289M",31,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)="                Total xrefs deleted: "_$$RJ^XLFSTR($FN(^XTMP("IVM289",0,"DEL"),","),6)
"RTN","IVM289M",32,0)
 S LNCNT=LNCNT+1,MSG(LNCNT)=$$REPEAT^XLFSTR("-",50)
"RTN","IVM289M",33,0)
 ;
"RTN","IVM289M",34,0)
SNDMSG ; Send the MailMan message
"RTN","IVM289M",35,0)
 D ^XMD
"RTN","IVM289M",36,0)
 ;
"RTN","IVM289M",37,0)
 Q
"RTN","IVMCDD")
0^5^B7519403
"RTN","IVMCDD",1,0)
IVMCDD ;ALB/CJM - DATA DICTIONARY FUNCTIONS ; 01/30/2004
"RTN","IVMCDD",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**17,89**;21-OCT-94
"RTN","IVMCDD",3,0)
 ;
"RTN","IVMCDD",4,0)
FUTMT(IVMPAT,MTIEN) ;
"RTN","IVMCDD",5,0)
 ;Sets the "AC" x-ref on the IVM Patient file
"RTN","IVMCDD",6,0)
 ;Input - 
"RTN","IVMCDD",7,0)
 ;  IVMPAT - ien of IVM Patient file record
"RTN","IVMCDD",8,0)
 ;  MTIEN - ien of record in Annual Means Test file
"RTN","IVMCDD",9,0)
 ;
"RTN","IVMCDD",10,0)
 Q:'$G(IVMPAT)
"RTN","IVMCDD",11,0)
 Q:'$G(MTIEN)
"RTN","IVMCDD",12,0)
 Q:'(+$G(^DGMT(408.31,MTIEN,0)))
"RTN","IVMCDD",13,0)
 Q:+$G(^DGMT(408.31,MTIEN,0))'>DT
"RTN","IVMCDD",14,0)
 S ^IVM(301.5,"AC",+$G(^DGMT(408.31,MTIEN,0)),IVMPAT,MTIEN)=""
"RTN","IVMCDD",15,0)
 Q
"RTN","IVMCDD",16,0)
 ;
"RTN","IVMCDD",17,0)
NOFUTMT(IVMPAT,MTIEN) ;
"RTN","IVMCDD",18,0)
 ;Kill logic for the "AC" x-ref on the IVM Patient file
"RTN","IVMCDD",19,0)
 ;Input - 
"RTN","IVMCDD",20,0)
 ;  IVMPAT - ien of IVM Patient file record
"RTN","IVMCDD",21,0)
 ;  MTIEN - ien of record in Annual Means Test file
"RTN","IVMCDD",22,0)
 ;
"RTN","IVMCDD",23,0)
 Q:'$G(IVMPAT)
"RTN","IVMCDD",24,0)
 Q:'$G(MTIEN)
"RTN","IVMCDD",25,0)
 Q:'(+$G(^DGMT(408.31,MTIEN,0)))
"RTN","IVMCDD",26,0)
 K ^IVM(301.5,"AC",+$G(^DGMT(408.31,MTIEN,0)),IVMPAT,MTIEN)
"RTN","IVMCDD",27,0)
 Q
"RTN","IVMCDD",28,0)
 ;
"RTN","IVMCDD",29,0)
FUTRX(IVMPAT,MTIEN) ;
"RTN","IVMCDD",30,0)
 ;Sets the "AD" x-ref on the IVM Patient file
"RTN","IVMCDD",31,0)
 ;Input - 
"RTN","IVMCDD",32,0)
 ;  IVMPAT - ien of IVM Patient file record
"RTN","IVMCDD",33,0)
 ;  MTIEN - ien of record in Annual Means Test file
"RTN","IVMCDD",34,0)
 ;
"RTN","IVMCDD",35,0)
 Q:'$G(IVMPAT)
"RTN","IVMCDD",36,0)
 Q:'$G(MTIEN)
"RTN","IVMCDD",37,0)
 Q:'(+$G(^DGMT(408.31,MTIEN,0)))
"RTN","IVMCDD",38,0)
 Q:+$G(^DGMT(408.31,MTIEN,0))'>DT
"RTN","IVMCDD",39,0)
 S ^IVM(301.5,"AD",+$G(^DGMT(408.31,MTIEN,0)),IVMPAT,MTIEN)=""
"RTN","IVMCDD",40,0)
 Q
"RTN","IVMCDD",41,0)
 ;
"RTN","IVMCDD",42,0)
NOFUTRX(IVMPAT,MTIEN) ;
"RTN","IVMCDD",43,0)
 ;Kill logic for the "AD" x-ref on the IVM Patient file
"RTN","IVMCDD",44,0)
 ;Input - 
"RTN","IVMCDD",45,0)
 ;  IVMPAT - ien of IVM Patient file record
"RTN","IVMCDD",46,0)
 ;  MTIEN - ien of record in Annual Means Test file
"RTN","IVMCDD",47,0)
 ;
"RTN","IVMCDD",48,0)
 Q:'$G(IVMPAT)
"RTN","IVMCDD",49,0)
 Q:'$G(MTIEN)
"RTN","IVMCDD",50,0)
 Q:'(+$G(^DGMT(408.31,MTIEN,0)))
"RTN","IVMCDD",51,0)
 K ^IVM(301.5,"AD",+$G(^DGMT(408.31,MTIEN,0)),IVMPAT,MTIEN)
"RTN","IVMCDD",52,0)
 Q
"RTN","IVMCDD",53,0)
AESET(IVMPAT,MTIEN) ;
"RTN","IVMCDD",54,0)
 ;Sets the "AE" x-ref on the IVM Patient file
"RTN","IVMCDD",55,0)
 ;Input - 
"RTN","IVMCDD",56,0)
 ;  IVMPAT - ien of IVM Patient file record
"RTN","IVMCDD",57,0)
 ;  MTIEN - ien of record in Annual Means Test file
"RTN","IVMCDD",58,0)
 ;
"RTN","IVMCDD",59,0)
 ;s ^IVM(301.5,"AE",dfn,date of means test,means test ien,ivm patient ien)
"RTN","IVMCDD",60,0)
 Q:'$G(IVMPAT)
"RTN","IVMCDD",61,0)
 Q:'$G(MTIEN)
"RTN","IVMCDD",62,0)
 Q:'(+$G(^IVM(301.5,IVMPAT,0)))
"RTN","IVMCDD",63,0)
 Q:'(+$G(^DGMT(408.31,MTIEN,0)))
"RTN","IVMCDD",64,0)
 Q:+$G(^DGMT(408.31,MTIEN,0))'>DT
"RTN","IVMCDD",65,0)
 S ^IVM(301.5,"AE",+$G(^IVM(301.5,IVMPAT,0)),+$G(^DGMT(408.31,MTIEN,0)),MTIEN,IVMPAT)=""
"RTN","IVMCDD",66,0)
 Q
"RTN","IVMCDD",67,0)
 ;
"RTN","IVMCDD",68,0)
AEKILL(IVMPAT,MTIEN) ;
"RTN","IVMCDD",69,0)
 ;Kill logic for the "AE" x-ref on the IVM Patient file
"RTN","IVMCDD",70,0)
 ;Input - 
"RTN","IVMCDD",71,0)
 ;  IVMPAT - ien of IVM Patient file record
"RTN","IVMCDD",72,0)
 ;  MTIEN - ien of record in Annual Means Test file
"RTN","IVMCDD",73,0)
 ;
"RTN","IVMCDD",74,0)
 ;K ^IVM(301.5,"AE",dfn,date of means test,means test ien,ivm patient ien)
"RTN","IVMCDD",75,0)
 Q:'$G(IVMPAT)
"RTN","IVMCDD",76,0)
 Q:'$G(MTIEN)
"RTN","IVMCDD",77,0)
 Q:'(+$G(^DGMT(408.31,MTIEN,0)))
"RTN","IVMCDD",78,0)
 Q:'(+$G(^IVM(301.5,IVMPAT,0)))
"RTN","IVMCDD",79,0)
 K ^IVM(301.5,"AE",+$G(^IVM(301.5,IVMPAT,0)),+$G(^DGMT(408.31,MTIEN,0)),MTIEN,IVMPAT)
"RTN","IVMCDD",80,0)
 Q
"RTN","IVMCDD",81,0)
 ;
"RTN","IVMCDD",82,0)
AFSET(IVMPAT,MTIEN) ;
"RTN","IVMCDD",83,0)
 ;Sets the "AF" x-ref on the IVM Patient file
"RTN","IVMCDD",84,0)
 ;Input - 
"RTN","IVMCDD",85,0)
 ;  IVMPAT - ien of IVM Patient file record
"RTN","IVMCDD",86,0)
 ;  MTIEN - ien of record in Annual Means Test file
"RTN","IVMCDD",87,0)
 ;
"RTN","IVMCDD",88,0)
 ;s ^IVM(301.5,"AF",dfn,date of copay test,copay test ien,ivm patient ien)
"RTN","IVMCDD",89,0)
 Q:'$G(IVMPAT)
"RTN","IVMCDD",90,0)
 Q:'$G(MTIEN)
"RTN","IVMCDD",91,0)
 Q:'(+$G(^DGMT(408.31,MTIEN,0)))
"RTN","IVMCDD",92,0)
 Q:'(+$G(^IVM(301.5,IVMPAT,0)))
"RTN","IVMCDD",93,0)
 Q:+$G(^DGMT(408.31,MTIEN,0))'>DT
"RTN","IVMCDD",94,0)
 S ^IVM(301.5,"AF",+$G(^IVM(301.5,IVMPAT,0)),+$G(^DGMT(408.31,MTIEN,0)),MTIEN,IVMPAT)=""
"RTN","IVMCDD",95,0)
 Q
"RTN","IVMCDD",96,0)
 ;
"RTN","IVMCDD",97,0)
AFKILL(IVMPAT,MTIEN) ;
"RTN","IVMCDD",98,0)
 ;Kill logic for the "AF" x-ref on the IVM Patient file
"RTN","IVMCDD",99,0)
 ;Input - 
"RTN","IVMCDD",100,0)
 ;  IVMPAT - ien of IVM Patient file record
"RTN","IVMCDD",101,0)
 ;  MTIEN - ien of record in Annual Means Test file
"RTN","IVMCDD",102,0)
 ;
"RTN","IVMCDD",103,0)
 ;K ^IVM(301.5,"AF",dfn,date of copay test,copay test ien,ivm patient ien)
"RTN","IVMCDD",104,0)
 Q:'$G(IVMPAT)
"RTN","IVMCDD",105,0)
 Q:'$G(MTIEN)
"RTN","IVMCDD",106,0)
 Q:'(+$G(^DGMT(408.31,MTIEN,0)))
"RTN","IVMCDD",107,0)
 Q:'(+$G(^IVM(301.5,IVMPAT,0)))
"RTN","IVMCDD",108,0)
 K ^IVM(301.5,"AF",+$G(^IVM(301.5,IVMPAT,0)),+$G(^DGMT(408.31,MTIEN,0)),MTIEN,IVMPAT)
"RTN","IVMCDD",109,0)
 Q
"RTN","IVMCZMT")
0^1^B49588288
"RTN","IVMCZMT",1,0)
IVMCZMT ;ALB/MLI/LD/CKN/TDM - Creation of  HL7 ZMT (means test) segment ; 01/26/2004
"RTN","IVMCZMT",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**17,53,49,58,81,89**;21-OCT-94
"RTN","IVMCZMT",3,0)
 ;
"RTN","IVMCZMT",4,0)
 ; This routine returns the ZMT segment which contains means test
"RTN","IVMCZMT",5,0)
 ; data for a selected patient. It differs from the standard segment
"RTN","IVMCZMT",6,0)
 ; builder in that it will add default values where needed for
"RTN","IVMCZMT",7,0)
 ; fields added by means test sharing - these fields may not have
"RTN","IVMCZMT",8,0)
 ; values for old tests, though for new tests the values should be there.
"RTN","IVMCZMT",9,0)
 ; 
"RTN","IVMCZMT",10,0)
 ;
"RTN","IVMCZMT",11,0)
 ;
"RTN","IVMCZMT",12,0)
EN(DFN,VAFSTR,VAFMTDT,VAFTYPE,SETID,DELETE,LIMIT) ; Entry point to get ZMT segment
"RTN","IVMCZMT",13,0)
 ;
"RTN","IVMCZMT",14,0)
 ;  Input:
"RTN","IVMCZMT",15,0)
 ;      DFN - as the IEN or corresponding patient in the PATIENT file
"RTN","IVMCZMT",16,0)
 ;   VAFSTR - as string of segment fields needed separated by commas
"RTN","IVMCZMT",17,0)
 ;  VAFMTDT - (optional) as date of desired means test (defaults to latest MT)
"RTN","IVMCZMT",18,0)
 ;  VAFTYPE - (optional) as type of test:  1 - Means Test (default=1)
"RTN","IVMCZMT",19,0)
 ;                                         2 - Copay Test
"RTN","IVMCZMT",20,0)
 ;                                         4 - LTC Copay Exemption Test
"RTN","IVMCZMT",21,0)
 ;  SETID -  (optional) value to use for SEQ 1, the set id field (1 used
"RTN","IVMCZMT",22,0)
 ;            as default if not passed.)
"RTN","IVMCZMT",23,0)
 ;  DELETE - (optional, pass by reference) This array is used to
"RTN","IVMCZMT",24,0)
 ;           indicate whether the segment is being used to notify of the
"RTN","IVMCZMT",25,0)
 ;           the deletion of a means test, pharmacy copay test, or a 
"RTN","IVMCZMT",26,0)
 ;           hardship determinatin.  If a means test or hardship is being
"RTN","IVMCZMT",27,0)
 ;           deleted, then VAFTYPE must equal 1.  If an Rx copay test is
"RTN","IVMCZMT",28,0)
 ;           being deleted, then VAFTYPE must equal 2.  The subscripts
"RTN","IVMCZMT",29,0)
 ;           are as follows:
"RTN","IVMCZMT",30,0)
 ;           DELETE("DATE OF TEST")=<date of test> - indicates
"RTN","IVMCZMT",31,0)
 ;                  the income year of the test that the deletion flags
"RTN","IVMCZMT",32,0)
 ;                  refer to
"RTN","IVMCZMT",33,0)
 ;           DELETE("HARDSHIP") -  if $G(DELETE("HARDSHIP"))=1 then the
"RTN","IVMCZMT",34,0)
 ;                  segment will be created to delete the hardship.
"RTN","IVMCZMT",35,0)
 ;           DELETE("MT") - if $G(DELETE("MT"))=1 then
"RTN","IVMCZMT",36,0)
 ;                  the segment will be created to delete a means test.
"RTN","IVMCZMT",37,0)
 ;           DELETE("RX")= if $G(DELETE("RX"))=1 then
"RTN","IVMCZMT",38,0)
 ;                  the segment will be created to delete a pharmacy
"RTN","IVMCZMT",39,0)
 ;                  copay test.
"RTN","IVMCZMT",40,0)
 ;           DELETE("LTC")= if $G(DELETE("LTC"))=1 then
"RTN","IVMCZMT",41,0)
 ;                  the segment will be created to delete a Long term
"RTN","IVMCZMT",42,0)
 ;                  care copay exemption test.
"RTN","IVMCZMT",43,0)
 ;  LIMIT - (optional) if $G(LIMIT)=1 then this indicates that a test in
"RTN","IVMCZMT",44,0)
 ;           an income year other than indicated in the IVM Patient File
"RTN","IVMCZMT",45,0)
 ;           should NOT be returned in the ZMT segment
"RTN","IVMCZMT",46,0)
 ;
"RTN","IVMCZMT",47,0)
 ;      ****Also assumes all HL7 variables are defined as returned ****
"RTN","IVMCZMT",48,0)
 ;          by the INIT^HLTRANS call
"RTN","IVMCZMT",49,0)
 ;
"RTN","IVMCZMT",50,0)
 ; Output - string in the form of the DHCP HL7 ZMT segment
"RTN","IVMCZMT",51,0)
 ;
"RTN","IVMCZMT",52,0)
 ;
"RTN","IVMCZMT",53,0)
 N NODE,PRIM,X,Y,VAFY,NODE2,MTIEN
"RTN","IVMCZMT",54,0)
 ;
"RTN","IVMCZMT",55,0)
 I '$G(DFN)!($G(VAFSTR)']"") G QUIT
"RTN","IVMCZMT",56,0)
 S $P(VAFY,HLFS,22)="",VAFSTR=","_VAFSTR_","
"RTN","IVMCZMT",57,0)
 S VAFTYPE=$S($G(VAFTYPE):VAFTYPE,1:1)
"RTN","IVMCZMT",58,0)
 S VAFMTDT=$S($G(VAFMTDT):VAFMTDT,1:DT)
"RTN","IVMCZMT",59,0)
 S $P(VAFY,HLFS,1)=$S($G(SETID):SETID,1:1)
"RTN","IVMCZMT",60,0)
 S (NODE,NODE2,PRIM)=""
"RTN","IVMCZMT",61,0)
 ;
"RTN","IVMCZMT",62,0)
 ;handle deletions of a test
"RTN","IVMCZMT",63,0)
 I ($G(DELETE("MT"))=1),VAFTYPE=1 D  G QUIT
"RTN","IVMCZMT",64,0)
 .S $P(VAFY,HLFS,2)=$$HLDATE^HLFNC(DELETE("DATE OF TEST")) ; MT Date
"RTN","IVMCZMT",65,0)
 .S $P(VAFY,HLFS,3)=HLQ
"RTN","IVMCZMT",66,0)
 .I ($G(DELETE("HARDSHIP"))=1) S $P(VAFY,HLFS,24)=HLQ
"RTN","IVMCZMT",67,0)
 .S $P(VAFY,HLFS,17)=VAFTYPE ; Type Of Test
"RTN","IVMCZMT",68,0)
 ;
"RTN","IVMCZMT",69,0)
 I ($G(DELETE("RX"))=1),VAFTYPE=2 D  G QUIT
"RTN","IVMCZMT",70,0)
 .S $P(VAFY,HLFS,2)=$$HLDATE^HLFNC(DELETE("DATE OF TEST")) ; MT Date
"RTN","IVMCZMT",71,0)
 .S $P(VAFY,HLFS,3)=HLQ
"RTN","IVMCZMT",72,0)
 .S $P(VAFY,HLFS,17)=VAFTYPE ; Type Of Test
"RTN","IVMCZMT",73,0)
 ;
"RTN","IVMCZMT",74,0)
 I ($G(DELETE("LTC"))=1),VAFTYPE=4 D  G QUIT
"RTN","IVMCZMT",75,0)
 .S $P(VAFY,HLFS,2)=$$HLDATE^HLFNC(DELETE("DATE OF TEST")) ; MT Date
"RTN","IVMCZMT",76,0)
 .S $P(VAFY,HLFS,3)=HLQ
"RTN","IVMCZMT",77,0)
 .S $P(VAFY,HLFS,17)=VAFTYPE ; Type Of Test
"RTN","IVMCZMT",78,0)
 ;
"RTN","IVMCZMT",79,0)
 ; Income Year requiring transmission from IVM Patient File (301.5)
"RTN","IVMCZMT",80,0)
 S IVMIY=$S($D(IVMIY):IVMIY,1:(VAFMTDT-10000))
"RTN","IVMCZMT",81,0)
 ;
"RTN","IVMCZMT",82,0)
 ; Check for a future dated Income Test
"RTN","IVMCZMT",83,0)
 S MTIEN=+$$FUT^DGMTU(DFN,"",$S($G(VAFTYPE):VAFTYPE,1:1))
"RTN","IVMCZMT",84,0)
 I MTIEN S NODE=$G(^DGMT(408.31,MTIEN,0)),PRIM=$G(^("PRIM")),NODE2=$G(^DGMT(408.31,MTIEN,2))
"RTN","IVMCZMT",85,0)
 ;
"RTN","IVMCZMT",86,0)
 ;if $$FUT of ^DGMTU returned the wrong income yr, disregard it
"RTN","IVMCZMT",87,0)
 I ($G(LIMIT)=1),($E(IVMIY,1,3)+1)'=$E(+NODE,1,3) S (NODE,NODE2,MTIEN,PRIM)=""
"RTN","IVMCZMT",88,0)
 ;
"RTN","IVMCZMT",89,0)
 ; Check for a current Primary Income Test
"RTN","IVMCZMT",90,0)
 I 'MTIEN S MTIEN=+$$LST^DGMTU(DFN,VAFMTDT,$S($G(VAFTYPE):VAFTYPE,1:1))
"RTN","IVMCZMT",91,0)
 S:(NODE="") NODE=$G(^DGMT(408.31,MTIEN,0)),PRIM=$G(^("PRIM")),NODE2=$G(^DGMT(408.31,MTIEN,2))
"RTN","IVMCZMT",92,0)
 ;
"RTN","IVMCZMT",93,0)
 I NODE'="" D
"RTN","IVMCZMT",94,0)
 .;add default values to new means test sharing fields
"RTN","IVMCZMT",95,0)
 .N STATUS,CODE,TDSTATUS,TDCODE,HARDSHIP,DATA,SOURCE,TIME
"RTN","IVMCZMT",96,0)
 .S TDSTATUS=$P(NODE2,"^",3)
"RTN","IVMCZMT",97,0)
 .S HARDSHIP=$P(NODE,"^",20)
"RTN","IVMCZMT",98,0)
 .I TDSTATUS="" D
"RTN","IVMCZMT",99,0)
 ..S STATUS=$P(NODE,"^",3)
"RTN","IVMCZMT",100,0)
 ..Q:'STATUS
"RTN","IVMCZMT",101,0)
 ..S CODE=$$GETCODE^DGMTH(STATUS)
"RTN","IVMCZMT",102,0)
 ..I CODE'="","ABCEGMP"[CODE D
"RTN","IVMCZMT",103,0)
 ...I VAFTYPE=1,HARDSHIP D
"RTN","IVMCZMT",104,0)
 ....I "AG"[CODE D  Q
"RTN","IVMCZMT",105,0)
 .....I CODE="A",($P(NODE,"^",4)'>$P(NODE,"^",27)) S TDSTATUS=$$GETSTAT^DGMTH("G",1) Q  ;Income <= GMT Threshold
"RTN","IVMCZMT",106,0)
 .....S TDSTATUS=$$GETSTAT^DGMTH("C",1)
"RTN","IVMCZMT",107,0)
 ....S TDSTATUS=STATUS
"RTN","IVMCZMT",108,0)
 ...S DATA(2.03)=TDSTATUS,$P(NODE2,"^",3)=TDSTATUS
"RTN","IVMCZMT",109,0)
 .S SOURCE=$P(NODE,"^",23)
"RTN","IVMCZMT",110,0)
 .I SOURCE=1 D
"RTN","IVMCZMT",111,0)
 ..S TIME=$P(NODE2,"^",2)
"RTN","IVMCZMT",112,0)
 ..I TIME="" S TIME=$$NOW^XLFDT,$P(NODE2,"^",2)=TIME,DATA(2.02)=TIME
"RTN","IVMCZMT",113,0)
 ..I $P(NODE2,"^",5)="",$P(NODE,"^",6) S $P(NODE2,"^",5)=$$GETSITE^DGMTU4($P(NODE,"^",6)),DATA(2.05)=$P(NODE2,"^",5)
"RTN","IVMCZMT",114,0)
 .I HARDSHIP,$P(NODE2,"^",4)="",$P(NODE,"^",22) S $P(NODE2,"^",4)=$$GETSITE^DGMTU4($P(NODE,"^",22)),DATA(2.04)=$P(NODE2,"^",4)
"RTN","IVMCZMT",115,0)
 .I $D(DATA),$$UPD^DGENDBS(408.31,MTIEN,.DATA)
"RTN","IVMCZMT",116,0)
 .;
"RTN","IVMCZMT",117,0)
 I VAFSTR[",2," S $P(VAFY,HLFS,2)=$S(+NODE:$$HLDATE^HLFNC(+NODE),1:HLQ) ; MT Date
"RTN","IVMCZMT",118,0)
 I VAFSTR[",3," S X=$P($G(^DG(408.32,+$P(NODE,"^",3),0)),"^",2),$P(VAFY,HLFS,3)=$S(X]"":X,1:"") ; MT Status
"RTN","IVMCZMT",119,0)
 I VAFSTR[",4," S $P(VAFY,HLFS,4)=$S($P(NODE,"^",4)]"":$P(NODE,"^",4),1:HLQ) ; Income
"RTN","IVMCZMT",120,0)
 I VAFSTR[",5," S $P(VAFY,HLFS,5)=$S($P(NODE,"^",5)]"":$P(NODE,"^",5),1:HLQ) ; Net Worth
"RTN","IVMCZMT",121,0)
 I VAFSTR[",6," S $P(VAFY,HLFS,6)=$S($P(NODE,"^",10):$$HLDATE^HLFNC($P(NODE,"^",10)),1:HLQ) ; Adjudication Date/Time
"RTN","IVMCZMT",122,0)
 I VAFSTR[",7," S $P(VAFY,HLFS,7)=$$YN^VAFHLFNC($P(NODE,"^",11)) ; Agreed To Pay
"RTN","IVMCZMT",123,0)
 I VAFSTR[",8," S $P(VAFY,HLFS,8)=$S($P(NODE,"^",12):$P(NODE,"^",12),1:HLQ) ; Threshold A
"RTN","IVMCZMT",124,0)
 I VAFSTR[",9," S $P(VAFY,HLFS,9)=$S($P(NODE,"^",15)]"":$P(NODE,"^",15),1:HLQ) ; Deductible Expenses
"RTN","IVMCZMT",125,0)
 I VAFSTR[",10," S $P(VAFY,HLFS,10)=$S($P(NODE,"^",7):$$HLDATE^HLFNC($P(NODE,"^",7)),1:HLQ) ; Date/Time Completed
"RTN","IVMCZMT",126,0)
 I VAFSTR[",11," S $P(VAFY,HLFS,11)=$$YN^VAFHLFNC($P(NODE,"^",16)) ; Previous Year Means Test Threshold Flag
"RTN","IVMCZMT",127,0)
 I VAFSTR[",12," S $P(VAFY,HLFS,12)=$S($P(NODE,"^",18)]"":$P(NODE,"^",18),1:HLQ) ; Total Dependents
"RTN","IVMCZMT",128,0)
 I VAFSTR[",13," S $P(VAFY,HLFS,13)=$$YN^VAFHLFNC($P(NODE,"^",20)) ; Hardship
"RTN","IVMCZMT",129,0)
 I VAFSTR[",14," S $P(VAFY,HLFS,14)=$S($P(NODE,"^",21):$$HLDATE^HLFNC($P(NODE,"^",21)),1:HLQ) ; Hardship Review Date
"RTN","IVMCZMT",130,0)
 I VAFSTR[",15," S $P(VAFY,HLFS,15)=$S($P(NODE,"^",24):$$HLDATE^HLFNC($P(NODE,"^",24)),1:HLQ) ; Date Vet Signed Test
"RTN","IVMCZMT",131,0)
 I VAFSTR[",16," S $P(VAFY,HLFS,16)=$$YN^VAFHLFNC($P(NODE,"^",14)) ; Declines To Give Income Info
"RTN","IVMCZMT",132,0)
 I VAFSTR[",17," S $P(VAFY,HLFS,17)=$S($P(NODE,"^",19):$P(NODE,"^",19),1:VAFTYPE) ; Type Of Test
"RTN","IVMCZMT",133,0)
 I VAFSTR[",18," S $P(VAFY,HLFS,18)=$S($P(NODE,"^",23)]"":$P(NODE,"^",23),1:HLQ) ; Source Of Test
"RTN","IVMCZMT",134,0)
 I VAFSTR[",19," S $P(VAFY,HLFS,19)=$$YN^VAFHLFNC(PRIM) ; Primary Test?
"RTN","IVMCZMT",135,0)
 I VAFSTR[",20," S $P(VAFY,HLFS,20)=$S($P(NODE,"^",25):$$HLDATE^HLFNC($P(NODE,"^",25)),1:HLQ) ; Date IVM Verified MT Completed
"RTN","IVMCZMT",136,0)
 I VAFSTR[",21," S $P(VAFY,HLFS,21)=$$YN^VAFHLFNC($P(NODE,"^",26)) ; Refused To Sign
"RTN","IVMCZMT",137,0)
 ;
"RTN","IVMCZMT",138,0)
 ;
"RTN","IVMCZMT",139,0)
 I VAFSTR[",22," S $P(VAFY,HLFS,22)=$P(NODE2,"^",5) ;Site Conducting Test
"RTN","IVMCZMT",140,0)
 I VAFSTR[",23," S $P(VAFY,HLFS,23)=$P(NODE2,"^",4) ;Site Granting Hardship
"RTN","IVMCZMT",141,0)
 I VAFSTR[",24," S $P(VAFY,HLFS,24)=$S($P(NODE2,"^"):$$HLDATE^HLFNC($P(NODE2,"^")),1:"") ;Hardship Effective Date
"RTN","IVMCZMT",142,0)
 I VAFSTR[",25," S $P(VAFY,HLFS,25)=$S($P(NODE2,"^",2):$$HLDATE^HLFNC($P(NODE2,"^",2)),1:"") ;Dt/Tm Test Last Edited
"RTN","IVMCZMT",143,0)
 I VAFSTR[",26," S $P(VAFY,HLFS,26)=$S($P(NODE2,"^",3):$$GETCODE^DGMTH($P(NODE2,"^",3)),1:"") ; Test Determined Status
"RTN","IVMCZMT",144,0)
 I VAFSTR[",28," S $P(VAFY,HLFS,28)=$P(NODE,"^",27)  ;GMT Threshold
"RTN","IVMCZMT",145,0)
 I VAFSTR[",29," S $P(VAFY,HLFS,29)=$P(NODE2,"^",9)  ;Hardship Reason
"RTN","IVMCZMT",146,0)
 ;
"RTN","IVMCZMT",147,0)
 ;can only transmit the deletion of a hardship if the segment is for a means test - and the income years must match if there is a means test
"RTN","IVMCZMT",148,0)
 ;
"RTN","IVMCZMT",149,0)
 I VAFTYPE=1,($G(DELETE("HARDSHIP"))=1),('(+NODE)!($E(DELETE("DATE OF TEST"),1,3)=$E((+NODE),1,3))) S $P(VAFY,HLFS,24)=HLQ
"RTN","IVMCZMT",150,0)
 ;
"RTN","IVMCZMT",151,0)
QUIT Q "ZMT"_HLFS_$G(VAFY)
"RTN","IVMPMTE")
0^6^B8709812
"RTN","IVMPMTE",1,0)
IVMPMTE ;ALB/KCL/CJM/JAN - MEANS TEST EVENT DRIVER INTERFACE ; 07-MAR-01
"RTN","IVMPMTE",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**1,9,17,39,49,89**;21-OCT-94
"RTN","IVMPMTE",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMPMTE",4,0)
 ;
"RTN","IVMPMTE",5,0)
 ;  Input - DFN the patient's internal entry number.
"RTN","IVMPMTE",6,0)
 ;          DGMTI the Means Test internal entry number.
"RTN","IVMPMTE",7,0)
 ;          DGMTINF the Means Test Interactive/Non-interactive flag.
"RTN","IVMPMTE",8,0)
 ;          DGMTACT the Means Test event type
"RTN","IVMPMTE",9,0)
 ;          DGMTP annual Means Test 0th node prior to Add, Edit
"RTN","IVMPMTE",10,0)
 ;                or Delete.
"RTN","IVMPMTE",11,0)
 ;          DGMTA annual Means Test 0th node after Add, Edit or Delete.
"RTN","IVMPMTE",12,0)
 ;
"RTN","IVMPMTE",13,0)
 ; Output - None.
"RTN","IVMPMTE",14,0)
 ;
"RTN","IVMPMTE",15,0)
 ;
"RTN","IVMPMTE",16,0)
EN ; Entry point
"RTN","IVMPMTE",17,0)
 N EVENTS,IVMDA
"RTN","IVMPMTE",18,0)
 S EVENTS("IVM")=1
"RTN","IVMPMTE",19,0)
 ;
"RTN","IVMPMTE",20,0)
 ; Quit if supported Means Test variables are not defined
"RTN","IVMPMTE",21,0)
 Q:'$D(DFN)!('$D(DGMTA))!('$D(DGMTP))!('$D(DGMTINF))!('$D(DGMTACT))
"RTN","IVMPMTE",22,0)
 ;
"RTN","IVMPMTE",23,0)
 ; - no processing required when uploading or deleting
"RTN","IVMPMTE",24,0)
 ; - an IVM-verified Means Test
"RTN","IVMPMTE",25,0)
 Q:DGMTACT="UPL"!(DGMTACT="DUP")
"RTN","IVMPMTE",26,0)
 I DGMTP]"",DGMTA]"",DGMTACT="DEL" Q
"RTN","IVMPMTE",27,0)
 ;
"RTN","IVMPMTE",28,0)
 ; Prevent DCD/other income tests uploaded from HEC to trigger a
"RTN","IVMPMTE",29,0)
 ; transmission back to HEC (quit if source of test isn't VAMC)
"RTN","IVMPMTE",30,0)
 N DGST S DGST=$S(+DGMTA:+$P(DGMTA,U,23),1:+$P(DGMTP,U,23))
"RTN","IVMPMTE",31,0)
 Q:$P($G(^DG(408.34,DGST,0)),"^")'="VAMC"&(DGMTACT'="CAT")
"RTN","IVMPMTE",32,0)
 ;
"RTN","IVMPMTE",33,0)
 W:'DGMTINF !,"Checking Income Verification Match (IVM) for changes..."
"RTN","IVMPMTE",34,0)
 S IVMMTDT=$S(DGMTA:+DGMTA,1:+DGMTP) Q:'IVMMTDT  S IVMDT=$$LYR^DGMTSCU1(IVMMTDT)
"RTN","IVMPMTE",35,0)
 S IVMNEW=0 S IVMDA=$O(^IVM(301.5,"APT",DFN,IVMDT,0)) I 'IVMDA S IVMNEW=1 ; Check for entry/previous year in IVM PATIENT file
"RTN","IVMPMTE",36,0)
 I 'IVMNEW D CHK ; If entry in IVM PATIENT file check for Means Test changes
"RTN","IVMPMTE",37,0)
 I IVMNEW,$$IVM^IVMUFNC(DFN,IVMMTDT),($E(IVMDT,1,3)=($E(DT,1,3)-1)) I $$LOG^IVMPLOG(DFN,IVMDT,.EVENTS) ; new & meets crtieria & current year
"RTN","IVMPMTE",38,0)
 ;
"RTN","IVMPMTE",39,0)
 ;log patient for transmission if patient meets DCD criteria
"RTN","IVMPMTE",40,0)
 D LOGDCD^IVMCUC(DFN,IVMMTDT)
"RTN","IVMPMTE",41,0)
 ;
"RTN","IVMPMTE",42,0)
 ; Quit when uploading Future Means Tests
"RTN","IVMPMTE",43,0)
 Q:$G(IVM1)>DT
"RTN","IVMPMTE",44,0)
 ;
"RTN","IVMPMTE",45,0)
 ; Update cross references when editing Future Dated Tests
"RTN","IVMPMTE",46,0)
 I $D(DGMTI),+$G(DGMT0)>DT,$D(IVMDA) D
"RTN","IVMPMTE",47,0)
 .I DGMTYPT=1,$P(^IVM(301.5,IVMDA,0),U,6)'="",+DGMTA'>DT S DATA(.06)="" I $$UPD^DGENDBS(301.5,IVMDA,.DATA) K DATA,^IVM(301.5,"AC",+DGMT0,IVMDA,DGMTI)
"RTN","IVMPMTE",48,0)
 .I DGMTYPT=2,$P(^IVM(301.5,IVMDA,0),U,7)'="",+DGMTA'>DT S DATA(.07)="" I $$UPD^DGENDBS(301.5,IVMDA,.DATA) K DATA,^IVM(301.5,"AD",+DGMT0,IVMDA,DGMTI)
"RTN","IVMPMTE",49,0)
 ;
"RTN","IVMPMTE",50,0)
ENQ ; Cleanup
"RTN","IVMPMTE",51,0)
 W:'DGMTINF "completed."
"RTN","IVMPMTE",52,0)
 K DA,DIC,DIE,DLAYGO,DR,IVMDA,IVMDT,IVMFLG,IVMMTDT,IVMNEW,X,Y
"RTN","IVMPMTE",53,0)
 Q
"RTN","IVMPMTE",54,0)
CHK ; Check if Means Test has been ADDED, DELETED, or EDITED
"RTN","IVMPMTE",55,0)
 S IVMFLG=0
"RTN","IVMPMTE",56,0)
 F X=1,2,3,4,5,7,10,12,15,18 Q:IVMFLG=1  D
"RTN","IVMPMTE",57,0)
 .I $P(DGMTA,"^",X)'=$P(DGMTP,"^",X) S IVMFLG=1 I $$SETSTAT^IVMPLOG(IVMDA,.EVENTS) ; If MT changes then edit IVM PATIENT file
"RTN","IVMPMTE",58,0)
 Q
"RTN","IVMPTRN")
0^2^B42649370
"RTN","IVMPTRN",1,0)
IVMPTRN ;ALB/MLI,SEK,RTK,BRM - IVM BACKGROUND JOB/TRANSMISSIONS TO IVM CENTER; 01/26/04
"RTN","IVMPTRN",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**1,9,11,12,17,28,34,74,79,89**;21-OCT-94
"RTN","IVMPTRN",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMPTRN",4,0)
 ;
"RTN","IVMPTRN",5,0)
 ; This routine is run nightly to send HL7 messages to the IVM Center for
"RTN","IVMPTRN",6,0)
 ; processing.
"RTN","IVMPTRN",7,0)
 ;
"RTN","IVMPTRN",8,0)
BGJ ; - IVM Nightly Background Job
"RTN","IVMPTRN",9,0)
 ;
"RTN","IVMPTRN",10,0)
 ;for tests being held for the future, make them primary if now effective
"RTN","IVMPTRN",11,0)
 D FUTUREMT,FUTURERX
"RTN","IVMPTRN",12,0)
 ;
"RTN","IVMPTRN",13,0)
 ; - retransmit enrollment/eligibility queries with no reply
"RTN","IVMPTRN",14,0)
 D BATCH^DGENQRY1
"RTN","IVMPTRN",15,0)
 ;
"RTN","IVMPTRN",16,0)
 ; - retransmit income test (financial) queries with no reply
"RTN","IVMPTRN",17,0)
 D MONITOR^IVMCQ2
"RTN","IVMPTRN",18,0)
 ;
"RTN","IVMPTRN",19,0)
 ; - current year and previous year
"RTN","IVMPTRN",20,0)
 S IVMCURYR=$$LYR^DGMTSCU1(DT),IVMPREYR=$$LYR^DGMTSCU1(IVMCURYR)
"RTN","IVMPTRN",21,0)
 ;
"RTN","IVMPTRN",22,0)
 ;
"RTN","IVMPTRN",23,0)
 ; - Master Query Processing
"RTN","IVMPTRN",24,0)
 ;
"RTN","IVMPTRN",25,0)
 ; - respond to Master Query for previous year, if necessary
"RTN","IVMPTRN",26,0)
 S IVMREC=$$QRY(IVMPREYR) I IVMREC D RESP(IVMPREYR,+IVMREC),END
"RTN","IVMPTRN",27,0)
 ;
"RTN","IVMPTRN",28,0)
 ; - respond to Master Query for current year, if necessary
"RTN","IVMPTRN",29,0)
 S IVMREC=$$QRY(IVMCURYR) I IVMREC D RESP(IVMCURYR,+IVMREC),END
"RTN","IVMPTRN",30,0)
 ;
"RTN","IVMPTRN",31,0)
 ; - send regular 'nightly' transmissions
"RTN","IVMPTRN",32,0)
 D REG,END
"RTN","IVMPTRN",33,0)
 ;
"RTN","IVMPTRN",34,0)
 ; - perform retransmission processing
"RTN","IVMPTRN",35,0)
 D ENTRY^IVMPTRN4,END
"RTN","IVMPTRN",36,0)
 ;
"RTN","IVMPTRN",37,0)
 ; - process billing activity
"RTN","IVMPTRN",38,0)
 D EN^IVMPTRN5
"RTN","IVMPTRN",39,0)
 ;
"RTN","IVMPTRN",40,0)
 ; - auto-upload address changes from #301.5 if >14 days old
"RTN","IVMPTRN",41,0)
 ; - auto-delete non address changes from #301.5 if >30 days old
"RTN","IVMPTRN",42,0)
 N ADDRDT S ADDRDT(0)=30,ADDRDT(1)=14 D EN^IVMLDEMC(.ADDRDT)
"RTN","IVMPTRN",43,0)
 ;
"RTN","IVMPTRN",44,0)
END ; - cleanup
"RTN","IVMPTRN",45,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IVMPTRN",46,0)
 K DA,DFN,DIE,DIK,DR,IVMCT,IVMDA,IVMDT,IVMGTOT,IVMINCYR,IVMINS,IVMMTDT
"RTN","IVMPTRN",47,0)
 K IVMNODE,IVMPAT,IVMPID,IVMQDT,IVMREC,IVMSTAT,X,%,VAFPID,IVMPREYR,IVMIY
"RTN","IVMPTRN",48,0)
 D CLEAN^IVMUFNC
"RTN","IVMPTRN",49,0)
 Q
"RTN","IVMPTRN",50,0)
 ;
"RTN","IVMPTRN",51,0)
REG ; Creates FULL query transmission for patient's
"RTN","IVMPTRN",52,0)
 ;         that exist in file (#301.5) "ATR" x-ref
"RTN","IVMPTRN",53,0)
 ;
"RTN","IVMPTRN",54,0)
 ;
"RTN","IVMPTRN",55,0)
 ; - initialize variables for HL7/IVM
"RTN","IVMPTRN",56,0)
 S HLMTN="ORU"
"RTN","IVMPTRN",57,0)
 S HLEID="VAMC "_$P($$SITE^VASITE,"^",3)_" "_HLMTN_"-Z07 SERVER"
"RTN","IVMPTRN",58,0)
 S HLEID=$O(^ORD(101,"B",HLEID,0))
"RTN","IVMPTRN",59,0)
 D INIT^IVMUFNC(HLEID,.HL)
"RTN","IVMPTRN",60,0)
 ;
"RTN","IVMPTRN",61,0)
 ; - roll thru ATR x-ref for patients that require transmission
"RTN","IVMPTRN",62,0)
 K IVMQUERY("LTD"),IVMQUERY("OVIS") ;Variables needed to open/close last visit date and outpt visit QUERIES
"RTN","IVMPTRN",63,0)
 S IVMIY=0
"RTN","IVMPTRN",64,0)
 F  S IVMIY=$O(^IVM(301.5,"ATR",0,IVMIY)) Q:'IVMIY  D
"RTN","IVMPTRN",65,0)
 .S IVMDA=0
"RTN","IVMPTRN",66,0)
 .F  S IVMDA=$O(^IVM(301.5,"ATR",0,IVMIY,IVMDA)) Q:'IVMDA  D
"RTN","IVMPTRN",67,0)
 ..;
"RTN","IVMPTRN",68,0)
 ..N EVENTS
"RTN","IVMPTRN",69,0)
 ..; - get node, income year, dfn
"RTN","IVMPTRN",70,0)
 ..S IVMNODE=$G(^IVM(301.5,+IVMDA,0)),IVMDT=+$P(IVMNODE,"^",2),DFN=+IVMNODE
"RTN","IVMPTRN",71,0)
 ..I 'DFN!'IVMDT Q
"RTN","IVMPTRN",72,0)
 ..;
"RTN","IVMPTRN",73,0)
 ..Q:($$STATUS^IVMPLOG(IVMDA,.EVENTS)=1)
"RTN","IVMPTRN",74,0)
 ..;
"RTN","IVMPTRN",75,0)
 ..S IVMMTDT=$P($$LST^DGMTU(DFN,($E(IVMDT,1,3)+1)_"1231.9999"),"^",2)
"RTN","IVMPTRN",76,0)
 ..;
"RTN","IVMPTRN",77,0)
 ..; - prepare FULL transmission
"RTN","IVMPTRN",78,0)
 ..D FULL^IVMPTRN7(DFN,IVMMTDT,.EVENTS,.IVMCT,.IVMGTOT,,,,.IVMQUERY)
"RTN","IVMPTRN",79,0)
 ;
"RTN","IVMPTRN",80,0)
 F Z="LTD","OVIS" I $G(IVMQUERY(Z)) D CLOSE^SDQ(IVMQUERY(Z)) K IVMQUERY(Z)
"RTN","IVMPTRN",81,0)
 ; - transmit remaining records
"RTN","IVMPTRN",82,0)
 D
"RTN","IVMPTRN",83,0)
 .N IVMEVENT
"RTN","IVMPTRN",84,0)
 .; event code for Full Data Transmission
"RTN","IVMPTRN",85,0)
 .S IVMEVENT="Z07"
"RTN","IVMPTRN",86,0)
 .D FILE^IVMPTRN3
"RTN","IVMPTRN",87,0)
 Q
"RTN","IVMPTRN",88,0)
 ;
"RTN","IVMPTRN",89,0)
RESP(IVMINCYR,IVMREC) ; Response to the Master Query.
"RTN","IVMPTRN",90,0)
 ;
"RTN","IVMPTRN",91,0)
 ; Input: IVMINCYR -  The income year for which the query was sent
"RTN","IVMPTRN",92,0)
 ;        IVMREC   -  Internal entry number of query to be updated
"RTN","IVMPTRN",93,0)
 ;
"RTN","IVMPTRN",94,0)
 N DFN,IVMDA,IVMMTDT,DA,DR,DIE,EVENTS
"RTN","IVMPTRN",95,0)
 ;
"RTN","IVMPTRN",96,0)
 ; - initialize variables for HL7/IVM
"RTN","IVMPTRN",97,0)
 S HLMTN="ORF"
"RTN","IVMPTRN",98,0)
 S HLEID="VAMC "_$P($$SITE^VASITE,"^",3)_" "_HLMTN_"-Z07 SERVER"
"RTN","IVMPTRN",99,0)
 S HLEID=$O(^ORD(101,"B",HLEID,0))
"RTN","IVMPTRN",100,0)
 D INIT^IVMUFNC(HLEID,.HL)
"RTN","IVMPTRN",101,0)
 ;
"RTN","IVMPTRN",102,0)
 ; - roll thru AYR x-ref
"RTN","IVMPTRN",103,0)
 F DFN=0:0 S DFN=$O(^IVM(301.5,"AYR",IVMINCYR,DFN)) Q:'DFN  D
"RTN","IVMPTRN",104,0)
 .F IVMDA=0:0 S IVMDA=$O(^IVM(301.5,"AYR",IVMINCYR,DFN,IVMDA)) Q:'IVMDA  D
"RTN","IVMPTRN",105,0)
 ..;
"RTN","IVMPTRN",106,0)
 ..; - check for STOP FLAG in file #301.5.
"RTN","IVMPTRN",107,0)
 ..I '$$CLOSED^IVMPLOG(IVMDA) D
"RTN","IVMPTRN",108,0)
 ...;
"RTN","IVMPTRN",109,0)
 ...; if means test was deleted, -10000 could be entered as income year
"RTN","IVMPTRN",110,0)
 ...; in ^IVM(301.5.  close case if deleted.
"RTN","IVMPTRN",111,0)
 ...S IVMMTDT=$P($$LST^DGMTU(DFN,($E(IVMINCYR,1,3)+1)_"1231.9999"),"^",2)
"RTN","IVMPTRN",112,0)
 ...I IVMMTDT="" D CLOSE^IVMPTRN1(IVMINCYR,DFN,1,3) Q
"RTN","IVMPTRN",113,0)
 ...;
"RTN","IVMPTRN",114,0)
 ...;get EVENTS() array
"RTN","IVMPTRN",115,0)
 ...I $$STATUS^IVMPLOG(+IVMDA,.EVENTS)
"RTN","IVMPTRN",116,0)
 ...;
"RTN","IVMPTRN",117,0)
 ...; - prepare FULL transmission
"RTN","IVMPTRN",118,0)
 ...; note: 6th parameter is IVMFLL (=1 to include MSA segment)
"RTN","IVMPTRN",119,0)
 ...D FULL^IVMPTRN7(DFN,IVMMTDT,.EVENTS,.IVMCT,.IVMGTOT,1,,$G(IVMREC),.IVMQUERY)
"RTN","IVMPTRN",120,0)
 ;
"RTN","IVMPTRN",121,0)
 ; - transmit remaining records
"RTN","IVMPTRN",122,0)
 D
"RTN","IVMPTRN",123,0)
 .N IVMEVENT
"RTN","IVMPTRN",124,0)
 .; event code for Full Data Transmission
"RTN","IVMPTRN",125,0)
 .S IVMEVENT="Z07"
"RTN","IVMPTRN",126,0)
 .D FILE1^IVMPTRN3  ; added for v1.6 because of MSA segment (note: the original call was to FILE^IVMPTRN3)
"RTN","IVMPTRN",127,0)
 ;
"RTN","IVMPTRN",128,0)
 ;
"RTN","IVMPTRN",129,0)
 ; - update multiple in file #301.9. Stuff (.03) field with date/time
"RTN","IVMPTRN",130,0)
 ;   of FULL query transmission.
"RTN","IVMPTRN",131,0)
 S DIE="^IVM(301.9,1,10,",DA=+IVMREC,DA(1)=1,DR=".03////"_$$NOW^XLFDT D ^DIE
"RTN","IVMPTRN",132,0)
 Q
"RTN","IVMPTRN",133,0)
 ;
"RTN","IVMPTRN",134,0)
QRY(YEAR) ; See if Master Query has been satisfied for YEAR.
"RTN","IVMPTRN",135,0)
 ;  Input: YEAR - The income year being checked
"RTN","IVMPTRN",136,0)
 ;
"RTN","IVMPTRN",137,0)
 ; Output: 1^2, where   1 =  0, if query does not need a response
"RTN","IVMPTRN",138,0)
 ;                          >0, if query needs a response (value
"RTN","IVMPTRN",139,0)
 ;                              equal to ien of sub-file entry
"RTN","IVMPTRN",140,0)
 ;                              in #301.9
"RTN","IVMPTRN",141,0)
 ;                      2 =  0, if the request has not been received
"RTN","IVMPTRN",142,0)
 ;                           1, if the request has been received
"RTN","IVMPTRN",143,0)
 N IVM,X,Y,Z
"RTN","IVMPTRN",144,0)
 I '$G(YEAR) S X="0^0" G QRYQ
"RTN","IVMPTRN",145,0)
 S Y=$O(^IVM(301.9,1,10,"AB",YEAR,"")) I 'Y S X="0^0" G QRYQ
"RTN","IVMPTRN",146,0)
 S IVM=$O(^IVM(301.9,1,10,"AB",YEAR,Y,0)) I 'IVM S X="0^0" G QRYQ
"RTN","IVMPTRN",147,0)
 S Z=$P($G(^IVM(301.9,1,10,+IVM,0)),"^",3)
"RTN","IVMPTRN",148,0)
 S X=$S(Z:0,1:IVM)_"^1"
"RTN","IVMPTRN",149,0)
QRYQ Q X
"RTN","IVMPTRN",150,0)
 ;
"RTN","IVMPTRN",151,0)
FUTUREMT ;
"RTN","IVMPTRN",152,0)
 ;Find future tests, and if now effective then make them primary.  Will
"RTN","IVMPTRN",153,0)
 ;call the MT event driver unless NOT required, in which case the status
"RTN","IVMPTRN",154,0)
 ;will have the status will be changed to NO LONGER REQUIRED
"RTN","IVMPTRN",155,0)
 ;and may auto-create a Rx copay test
"RTN","IVMPTRN",156,0)
 ;
"RTN","IVMPTRN",157,0)
 N FDATE,IVMPAT,MTIEN,NODE,DFN,DATA
"RTN","IVMPTRN",158,0)
 ;
"RTN","IVMPTRN",159,0)
 S FDATE=0
"RTN","IVMPTRN",160,0)
 F  S FDATE=$O(^IVM(301.5,"AC",FDATE)) Q:('FDATE)  Q:(FDATE>DT)  D
"RTN","IVMPTRN",161,0)
 .S IVMPAT=0
"RTN","IVMPTRN",162,0)
 .F  S IVMPAT=$O(^IVM(301.5,"AC",FDATE,IVMPAT)) Q:'IVMPAT  D
"RTN","IVMPTRN",163,0)
 ..S MTIEN=$O(^IVM(301.5,"AC",FDATE,IVMPAT,""),-1)
"RTN","IVMPTRN",164,0)
 ..I '$$FUTURECK("AC",FDATE,IVMPAT,MTIEN) K ^IVM(301.5,"AC",FDATE,IVMPAT,MTIEN)
"RTN","IVMPTRN",165,0)
 ..K DATA S DATA(.06)="" I $$UPD^DGENDBS(301.5,IVMPAT,.DATA)
"RTN","IVMPTRN",166,0)
 ..S DFN=+$G(^IVM(301.5,IVMPAT,0))
"RTN","IVMPTRN",167,0)
 ..I DFN S NODE=$$LST^DGMTU(DFN,DT_.9999,1) I $E($P(NODE,"^",2),1,3)=$E(DT,1,3),$P(NODE,"^",4)'="","R"'=$P(NODE,"^",4) K ^IVM(301.5,"AC",FDATE,IVMPAT,MTIEN) Q
"RTN","IVMPTRN",168,0)
 ..D MTPRIME^DGMTU4(MTIEN)
"RTN","IVMPTRN",169,0)
 Q
"RTN","IVMPTRN",170,0)
 ;
"RTN","IVMPTRN",171,0)
FUTURERX ;
"RTN","IVMPTRN",172,0)
 ;Find future COPAY tests, and if now effective then make it primary.
"RTN","IVMPTRN",173,0)
 ;Will change the status to NO LONGER APPLICABLE if the vet is not
"RTN","IVMPTRN",174,0)
 ;subject to pharmacy copayments
"RTN","IVMPTRN",175,0)
 ;
"RTN","IVMPTRN",176,0)
 N FDATE,IVMPAT,MTIEN,NODE,DFN,DATA
"RTN","IVMPTRN",177,0)
 ;
"RTN","IVMPTRN",178,0)
 S FDATE=0
"RTN","IVMPTRN",179,0)
 F  S FDATE=$O(^IVM(301.5,"AD",FDATE)) Q:('FDATE)  Q:(FDATE>DT)  D
"RTN","IVMPTRN",180,0)
 .S IVMPAT=0
"RTN","IVMPTRN",181,0)
 .F  S IVMPAT=$O(^IVM(301.5,"AD",FDATE,IVMPAT)) Q:'IVMPAT  D
"RTN","IVMPTRN",182,0)
 ..S MTIEN=$O(^IVM(301.5,"AD",FDATE,IVMPAT,""),-1)
"RTN","IVMPTRN",183,0)
 ..I '$$FUTURECK("AD",FDATE,IVMPAT,MTIEN) K ^IVM(301.5,"AD",FDATE,IVMPAT,MTIEN)
"RTN","IVMPTRN",184,0)
 ..K DATA S DATA(.07)="" I $$UPD^DGENDBS(301.5,IVMPAT,.DATA)
"RTN","IVMPTRN",185,0)
 ..S DFN=+$G(^IVM(301.5,IVMPAT,0))
"RTN","IVMPTRN",186,0)
 ..I DFN S NODE=$$LST^DGMTU(DFN,DT_.9999,2) I $E($P(NODE,"^",2),1,3)=$E(DT,1,3),$P(NODE,"^",4)'="" K ^IVM(301.5,"AD",FDATE,IVMPAT,MTIEN) Q
"RTN","IVMPTRN",187,0)
 ..D RXPRIME^DGMTU4(MTIEN)
"RTN","IVMPTRN",188,0)
 Q
"RTN","IVMPTRN",189,0)
 ;
"RTN","IVMPTRN",190,0)
FUTURECK(TYPE,FDATE,IVMPAT,MTIEN) ;
"RTN","IVMPTRN",191,0)
 ; Check the Future MT or CP xref for a valid income test entry,
"RTN","IVMPTRN",192,0)
 ; and Delete all invalid xref entries.
"RTN","IVMPTRN",193,0)
 N VALID,MTREC S VALID=1,MTREC=0
"RTN","IVMPTRN",194,0)
 ;
"RTN","IVMPTRN",195,0)
 ; Remove duplicate entries from cross reference, leaving last entry
"RTN","IVMPTRN",196,0)
 F  S MTREC=$O(^IVM(301.5,TYPE,FDATE,IVMPAT,MTREC)) Q:(MTREC=MTIEN!('MTREC))  K ^IVM(301.5,TYPE,FDATE,IVMPAT,MTREC)
"RTN","IVMPTRN",197,0)
 ;
"RTN","IVMPTRN",198,0)
 I '$D(^IVM(301.5,IVMPAT,0)) S VALID=0 Q VALID
"RTN","IVMPTRN",199,0)
 I '$D(^DGMT(408.31,MTIEN,0)) S VALID=0 Q VALID
"RTN","IVMPTRN",200,0)
 I FDATE'=+(^DGMT(408.31,MTIEN,0)) S VALID=0 Q VALID
"RTN","IVMPTRN",201,0)
 ;
"RTN","IVMPTRN",202,0)
 Q VALID
"RTN","IVMPTRN8")
0^7^B51723284
"RTN","IVMPTRN8",1,0)
IVMPTRN8 ;ALB/RKS/PDJ/BRM/TDM - HL7 FULL DATA TRANSMISSION (Z07) BUILDER ; 03/10/2004
"RTN","IVMPTRN8",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**9,11,19,12,21,17,24,36,37,47,48,42,34,77,76,75,79,85,89**; 21-OCT-94
"RTN","IVMPTRN8",3,0)
 ;
"RTN","IVMPTRN8",4,0)
 ;
"RTN","IVMPTRN8",5,0)
BUILD(DFN,IVMMTDT,IVMCT,IVMQUERY) ; --
"RTN","IVMPTRN8",6,0)
 ;  Description: This entry point will be used to create an HL7 
"RTN","IVMPTRN8",7,0)
 ;  "Full Data Transmission" message for a patient.
"RTN","IVMPTRN8",8,0)
 ;
"RTN","IVMPTRN8",9,0)
 ;  Input:
"RTN","IVMPTRN8",10,0)
 ;        DFN - Patient IEN
"RTN","IVMPTRN8",11,0)
 ;    IVMMTDT - date of the patient's Means Test or Copay Test
"RTN","IVMPTRN8",12,0)
 ;      IVMCT - count of hl7 segments transmitted, pass by reference
"RTN","IVMPTRN8",13,0)
 ;   IVMQUERY - array passed in by reference where
"RTN","IVMPTRN8",14,0)
 ;    IVMQUERY("LTD") -- # of the QUERY that is currently open or
"RTN","IVMPTRN8",15,0)
 ;                undefined, zero, or null if no QUERY opened for
"RTN","IVMPTRN8",16,0)
 ;                last treatment date
"RTN","IVMPTRN8",17,0)
 ;    IVMQUERY("OVIS") -- # of the QUERY that is currently open or
"RTN","IVMPTRN8",18,0)
 ;                undefined, zero, or null if no QUERY opened for
"RTN","IVMPTRN8",19,0)
 ;                finding outpatient visits
"RTN","IVMPTRN8",20,0)
 ;
"RTN","IVMPTRN8",21,0)
 ;  HL7 variables as defined by call to INIT^IVMUFNC:
"RTN","IVMPTRN8",22,0)
 ;      HLEVN - HL7 message event counter 
"RTN","IVMPTRN8",23,0)
 ;      HLSDT - a flag that indicates that the data to be sent is
"RTN","IVMPTRN8",24,0)
 ;              stored in the ^TMP("HLS") global array.
"RTN","IVMPTRN8",25,0)
 ;
"RTN","IVMPTRN8",26,0)
 ;  The following variables returned by the INIT^HLTRANS entry point:
"RTN","IVMPTRN8",27,0)
 ;    HLNDAP - Non-DHCP Application Pointer from file 770
"RTN","IVMPTRN8",28,0)
 ;   HLNDAP0 - Zero node from file 770 corresponding to HLNDAP
"RTN","IVMPTRN8",29,0)
 ;     HLDAP - DHCP Application Pointer from file 771
"RTN","IVMPTRN8",30,0)
 ;     HLDAN - The DHCP Application Name (.01 field, file 771) for HLDAP
"RTN","IVMPTRN8",31,0)
 ;     HLPID - HL7 processing ID from file 770
"RTN","IVMPTRN8",32,0)
 ;     HLVER - HL7 version number from file 770
"RTN","IVMPTRN8",33,0)
 ;      HLFS - HL7 Field Separator from the 'FS' node of file 771
"RTN","IVMPTRN8",34,0)
 ;     HLECH - HL7 Encoding Characters from the 'EC' node of file 771
"RTN","IVMPTRN8",35,0)
 ;       HLQ - Double quotes ("") for use in building HL7 segments
"RTN","IVMPTRN8",36,0)
 ;     HLERR - if an error is encountered, an error message is returned
"RTN","IVMPTRN8",37,0)
 ;             in the HLERR variable.
"RTN","IVMPTRN8",38,0)
 ;      HLDA - the internal entry number for the entry created in
"RTN","IVMPTRN8",39,0)
 ;             file #772.
"RTN","IVMPTRN8",40,0)
 ;      HLDT - transmission date/time (associated with the entry in file
"RTN","IVMPTRN8",41,0)
 ;             #772 identified by HLDA) in internal VA FileMan format.
"RTN","IVMPTRN8",42,0)
 ;     HLDT1 - the same transmission date/time as the HLDT variable, 
"RTN","IVMPTRN8",43,0)
 ;             only in HL7 format.
"RTN","IVMPTRN8",44,0)
 ;
"RTN","IVMPTRN8",45,0)
 ; Output:
"RTN","IVMPTRN8",46,0)
 ;  ^TMP("HLS",$J,IVMCT) - global array containing all segments of the HL7 message that the VistA application wishes to send.  The HLSDT variable is defined above and the IVMCT variable is a sequential number incremented by 1.
"RTN","IVMPTRN8",47,0)
 ;
"RTN","IVMPTRN8",48,0)
 ;
"RTN","IVMPTRN8",49,0)
 N DGINC,DGIR,DGREL,I,IVMNTE,IVMPID,IVMSUB,IVMZRD,VAFPID,VAFZEL,FBZFE,IVMZCD,DELETE,NODE,IVMPIEN,TEST,IVMPNODE,TESTTYPE,SEQS,TESTCODE,HARDSHIP,ACTVIEN,IVMZMH,IVMSEQ
"RTN","IVMPTRN8",50,0)
 N EDBMTZ06
"RTN","IVMPTRN8",51,0)
 ;
"RTN","IVMPTRN8",52,0)
 ; create (PID) Patient Identification segment
"RTN","IVMPTRN8",53,0)
 S IVMSEQ="3,5,7,8,11,12,13,14,19"
"RTN","IVMPTRN8",54,0)
 ; do not transmit seq 11 and 12 if the Bad Address Indicator is set
"RTN","IVMPTRN8",55,0)
 ; or other address filters do not pass
"RTN","IVMPTRN8",56,0)
 S:$$FILTER^IVMPTRN9(DFN) IVMSEQ="3,5,7,8,13,14,19"
"RTN","IVMPTRN8",57,0)
 S IVMPID=$$EN^VAFHLPID(DFN,"1,"_IVMSEQ)        ;add SEQ 1 for PID
"RTN","IVMPTRN8",58,0)
 ;
"RTN","IVMPTRN8",59,0)
 ; **** Add ICN to 2nd piece PID segment for MPI@HEC.
"RTN","IVMPTRN8",60,0)
 S IVMCMOR="1,2"
"RTN","IVMPTRN8",61,0)
 ; check to see if site is a legacy site.  If not add ICN to PID segment.
"RTN","IVMPTRN8",62,0)
 I '$D(^PPP(1020.128,"AC",$P($$SITE^VASITE,"^",3))) D
"RTN","IVMPTRN8",63,0)
 .I +$$GETICN^MPIF001(DFN)>0,($$IFLOCAL^MPIF001(DFN)=0) S IVMPID=$$EN^VAFCPID(DFN,"1,2,"_IVMSEQ),IVMCMOR="1,2,3"  ;add SEQ 1 and 2 for PID
"RTN","IVMPTRN8",64,0)
 ;
"RTN","IVMPTRN8",65,0)
 I $D(VAFPID(1)) S IVMPID(1)=VAFPID(1)
"RTN","IVMPTRN8",66,0)
 ; send SSN indicating pseudo
"RTN","IVMPTRN8",67,0)
 ; I $P(IVMPID_$G(IVMPID(1)),HLFS,20)["P" D PSEUDO^IVMPTRN1  ; strip 'P' from pseudo SSNs
"RTN","IVMPTRN8",68,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=IVMPID
"RTN","IVMPTRN8",69,0)
 I $D(IVMPID(1)) S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=IVMPID(1)
"RTN","IVMPTRN8",70,0)
 ;
"RTN","IVMPTRN8",71,0)
 ; **** create (PD1) Patient CMOR segment for MPI@HEC.
"RTN","IVMPTRN8",72,0)
 S:'$D(HL("FS")) HL("FS")=HLFS
"RTN","IVMPTRN8",73,0)
 S:'$D(HL("ECH")) HL("ECH")=HLECH
"RTN","IVMPTRN8",74,0)
 S:'$D(HL("Q")) HL("Q")=HLQ
"RTN","IVMPTRN8",75,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLPD1(DFN,IVMCMOR)
"RTN","IVMPTRN8",76,0)
 ;
"RTN","IVMPTRN8",77,0)
 ; create (ZPD) Patient Dependent Info. segment
"RTN","IVMPTRN8",78,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN1^VAFHLZPD(DFN,"1,8,9,11,12,13,17,19,31,32"),IVMINS=$P(^(IVMCT),HLFS,12)
"RTN","IVMPTRN8",79,0)
 ;
"RTN","IVMPTRN8",80,0)
 ; create (ZTA) Temporary Address segment
"RTN","IVMPTRN8",81,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZTA(DFN,"1,2,3,4,5,6,7")
"RTN","IVMPTRN8",82,0)
 ;
"RTN","IVMPTRN8",83,0)
 ; create (ZIE) Ineligible segment
"RTN","IVMPTRN8",84,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZIE(DFN,"1,2,3",1)
"RTN","IVMPTRN8",85,0)
 ;
"RTN","IVMPTRN8",86,0)
 ; create (ZEL) Eligibility segment(s) 
"RTN","IVMPTRN8",87,0)
 ; **** Add 5th piece to ZEL to correct consistency check
"RTN","IVMPTRN8",88,0)
 D EN1^VAFHLZEL(DFN,"1,2,5,6,7,10,11,13,14,15,16,17,18,19,20,21,23,24,25,34,35",2,.VAFZEL)
"RTN","IVMPTRN8",89,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$G(VAFZEL(1))  ; Primary Eligibility
"RTN","IVMPTRN8",90,0)
 ; - other entitled eligibilities
"RTN","IVMPTRN8",91,0)
 F IVMSUB=1:0 S IVMSUB=+$O(VAFZEL(IVMSUB)) Q:'IVMSUB  D
"RTN","IVMPTRN8",92,0)
 .S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$G(VAFZEL(+IVMSUB))
"RTN","IVMPTRN8",93,0)
 ;
"RTN","IVMPTRN8",94,0)
 ; create (ZEN) Enrollment segment
"RTN","IVMPTRN8",95,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZEN(DFN)
"RTN","IVMPTRN8",96,0)
 ;
"RTN","IVMPTRN8",97,0)
 ; create (ZCD) Catastrophic Disability segment(s)
"RTN","IVMPTRN8",98,0)
 D BUILD^VAFHLZCD(.IVMZCD,DFN,,HLQ,HLFS)
"RTN","IVMPTRN8",99,0)
 F IVMSUB=0:0 S IVMSUB=+$O(IVMZCD(IVMSUB)) Q:'IVMSUB  D
"RTN","IVMPTRN8",100,0)
 .S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$G(IVMZCD(+IVMSUB))
"RTN","IVMPTRN8",101,0)
 ;
"RTN","IVMPTRN8",102,0)
 ; Optionally create (ZMH) Military History segment for Purple Heart
"RTN","IVMPTRN8",103,0)
 D ENTER^VAFHLZMH(DFN,"IVMZMH","13")
"RTN","IVMPTRN8",104,0)
 I $P(IVMZMH(1,0),HLFS,3)="PH","YN"[$E($P(IVMZMH(1,0),HLFS,4)) S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=IVMZMH(1,0)
"RTN","IVMPTRN8",105,0)
 ;
"RTN","IVMPTRN8",106,0)
 ; create (ZRD) Rated Disabilities segment(s)
"RTN","IVMPTRN8",107,0)
 D EN^VAFHLZRD(DFN,"1,2,3,4",HLQ,HLFS,"IVMZRD")
"RTN","IVMPTRN8",108,0)
 F IVMSUB=0:0 S IVMSUB=+$O(IVMZRD(IVMSUB)) Q:'IVMSUB  D
"RTN","IVMPTRN8",109,0)
 .S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$G(IVMZRD(+IVMSUB,0))
"RTN","IVMPTRN8",110,0)
 ;
"RTN","IVMPTRN8",111,0)
 ; create (ZCT) Emergency Contact segment
"RTN","IVMPTRN8",112,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZCT(DFN,"1,2,3,4,5,6,7")
"RTN","IVMPTRN8",113,0)
 ;
"RTN","IVMPTRN8",114,0)
 ; create (ZEM) Employment Info. segment for (1) Patient & (2) Spouse
"RTN","IVMPTRN8",115,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZEM(DFN,"1,2,3")
"RTN","IVMPTRN8",116,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZEM(DFN,"1,2,3",2,2)
"RTN","IVMPTRN8",117,0)
 ;
"RTN","IVMPTRN8",118,0)
 ; create (ZGD) Guardian segment for (1) VA & (2) Civil 
"RTN","IVMPTRN8",119,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZGD(DFN,"1,2,3,4,5,6,7,8",1)
"RTN","IVMPTRN8",120,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZGD(DFN,"1,2,3,4,5,6,7,8",2)
"RTN","IVMPTRN8",121,0)
 ;
"RTN","IVMPTRN8",122,0)
 ; Income Year requiring transmission from IVM Patient File (301.5)
"RTN","IVMPTRN8",123,0)
 S IVMIY=$S($D(IVMIY):IVMIY,1:(IVMMTDT-10000))
"RTN","IVMPTRN8",124,0)
 N MTINFO S MTINFO=$$FUT^DGMTU(DFN)
"RTN","IVMPTRN8",125,0)
 I ($E(IVMIY,1,3)+1)=$E($P(MTINFO,U,2),1,3) S IVMMTDT=$P(MTINFO,U,2)
"RTN","IVMPTRN8",126,0)
 ;get the primary test for the income year
"RTN","IVMPTRN8",127,0)
 S TESTTYPE=$$GETTYPE^IVMPTRN9(DFN,IVMMTDT,.TESTCODE,.HARDSHIP,.ACTVIEN)
"RTN","IVMPTRN8",128,0)
 ;
"RTN","IVMPTRN8",129,0)
 ; The following function call returns:
"RTN","IVMPTRN8",130,0)
 ;   - Patient Relation IEN array in DGREL
"RTN","IVMPTRN8",131,0)
 ;   - Individual Annual Income IEN array in DGINC
"RTN","IVMPTRN8",132,0)
 ;   - Income Relation IEN array in DGINR
"RTN","IVMPTRN8",133,0)
 D ALL^DGMTU21(DFN,"VSC",IVMMTDT,"IPR",ACTVIEN)
"RTN","IVMPTRN8",134,0)
 ;
"RTN","IVMPTRN8",135,0)
 S EDBMTZ06=0 I $$VERZ06^EASPTRN1(DFN) S EDBMTZ06=1
"RTN","IVMPTRN8",136,0)
 ; create (ZIC) Income segment for veteran
"RTN","IVMPTRN8",137,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZIC(+$G(DGINC("V")),"1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20")
"RTN","IVMPTRN8",138,0)
 I EDBMTZ06 S ^TMP("HLS",$J,IVMCT)="ZIC^"_$P(^TMP("HLS",$J,IVMCT),"^",2,3)
"RTN","IVMPTRN8",139,0)
 I $P(^TMP("HLS",$J,IVMCT),"^",3)=HLQ S $P(^TMP("HLS",$J,IVMCT),"^",3)=$$HLDATE^HLFNC($E(IVMMTDT,1,3)-1_"0000")
"RTN","IVMPTRN8",140,0)
 ;
"RTN","IVMPTRN8",141,0)
 ; create (ZIR) Income Relation segment for veteran
"RTN","IVMPTRN8",142,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZIR(+$G(DGINR("V")),"1,2,3,4,5,10")
"RTN","IVMPTRN8",143,0)
 I EDBMTZ06 S ^TMP("HLS",$J,IVMCT)="ZIR^1"
"RTN","IVMPTRN8",144,0)
 ;
"RTN","IVMPTRN8",145,0)
 ; create (ZDP) Patient Dependent Info. segment for spouse
"RTN","IVMPTRN8",146,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZDP(+$G(DGREL("S")),"1,2,3,4,5,6,7,8,9")
"RTN","IVMPTRN8",147,0)
 I $P(^TMP("HLS",$J,IVMCT),HLFS,3)'=HLQ,($P($G(^(IVMCT)),HLFS,6)=HLQ) D
"RTN","IVMPTRN8",148,0)
 .; - pass non-existant SSNs as 0s
"RTN","IVMPTRN8",149,0)
 .S $P(X,HLFS,6)="000000000"
"RTN","IVMPTRN8",150,0)
 ;
"RTN","IVMPTRN8",151,0)
 ; create (ZIC) Income segment for spouse
"RTN","IVMPTRN8",152,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZIC(+$G(DGINC("S")),"1,2,3,4,5,6,7,8,9,10,11,12,16,17,18,19,20")
"RTN","IVMPTRN8",153,0)
 I EDBMTZ06 S ^TMP("HLS",$J,IVMCT)="ZIC^"_$P(^TMP("HLS",$J,IVMCT),"^",2,3)
"RTN","IVMPTRN8",154,0)
 ;
"RTN","IVMPTRN8",155,0)
 ; create (ZIR) Income Relation segment for spouse
"RTN","IVMPTRN8",156,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZIR(+$G(DGINR("S")),"1,2,3")
"RTN","IVMPTRN8",157,0)
 I EDBMTZ06 S ^TMP("HLS",$J,IVMCT)="ZIR^"_$P(^TMP("HLS",$J,IVMCT),"^",2)
"RTN","IVMPTRN8",158,0)
 ;
"RTN","IVMPTRN8",159,0)
 ;
"RTN","IVMPTRN8",160,0)
 ; create ZDP, ZIC, and ZIR segments for all Means Test dependents
"RTN","IVMPTRN8",161,0)
 F IVMSUB=0:0 S IVMSUB=$O(DGREL("C",IVMSUB)) Q:'IVMSUB  D
"RTN","IVMPTRN8",162,0)
 .;
"RTN","IVMPTRN8",163,0)
 .; - create (ZDP) Dependent Info. segment for dependent child
"RTN","IVMPTRN8",164,0)
 .S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZDP(+$G(DGREL("C",IVMSUB)),"1,2,3,4,5,6,7,9")
"RTN","IVMPTRN8",165,0)
 .I $P(^TMP("HLS",$J,IVMCT),HLFS,3)'=HLQ,($P($G(^(IVMCT)),HLFS,6)=HLQ) D
"RTN","IVMPTRN8",166,0)
 ..; - pass non-existant SSNs as 0s
"RTN","IVMPTRN8",167,0)
 ..S $P(X,HLFS,6)="000000000"
"RTN","IVMPTRN8",168,0)
 .;
"RTN","IVMPTRN8",169,0)
 .; - create (ZIC) Income segment for dependent child
"RTN","IVMPTRN8",170,0)
 .S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZIC(+$G(DGINC("C",IVMSUB)),"1,2,3,4,5,6,7,8,9,10,11,12,15")
"RTN","IVMPTRN8",171,0)
 .I EDBMTZ06 S ^TMP("HLS",$J,IVMCT)="ZIC^"_$P(^TMP("HLS",$J,IVMCT),"^",2,3)
"RTN","IVMPTRN8",172,0)
 .;
"RTN","IVMPTRN8",173,0)
 .; - create (ZIR) Income Relation segment for dependent child
"RTN","IVMPTRN8",174,0)
 .S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$EN^VAFHLZIR(+$G(DGINR("C",IVMSUB)),"1,2,3,6,7,8,9")
"RTN","IVMPTRN8",175,0)
 .I EDBMTZ06 S ^TMP("HLS",$J,IVMCT)="ZIR^"_$P(^TMP("HLS",$J,IVMCT),"^",2)
"RTN","IVMPTRN8",176,0)
 .; 
"RTN","IVMPTRN8",177,0)
 ;
"RTN","IVMPTRN8",178,0)
 ; create (ZIO) Inpatient/Outpatient segment for veteran
"RTN","IVMPTRN8",179,0)
 S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)="ZIO^1^"_$$EN^IVMUFNC1(DFN,IVMMTDT,.IVMQUERY)_"^"_$$LTD^IVMUFNC(DFN,.IVMQUERY)
"RTN","IVMPTRN8",180,0)
 ;
"RTN","IVMPTRN8",181,0)
 ; create (NTE) Notes and Comments segment
"RTN","IVMPTRN8",182,0)
 D NTE^IVMUFNC4(DFN,.IVMNTE,IVMMTDT)
"RTN","IVMPTRN8",183,0)
 I '$D(IVMNTE) D
"RTN","IVMPTRN8",184,0)
 .S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)="NTE^1"
"RTN","IVMPTRN8",185,0)
 I $D(IVMNTE) D
"RTN","IVMPTRN8",186,0)
 .; - get notes and comments
"RTN","IVMPTRN8",187,0)
 .F IVMSUB=0:0 S IVMSUB=$O(IVMNTE(IVMSUB)) Q:'IVMSUB  D
"RTN","IVMPTRN8",188,0)
 ..S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=IVMNTE(IVMSUB)
"RTN","IVMPTRN8",189,0)
 ;
"RTN","IVMPTRN8",190,0)
 ; create (IN1) Insurance segment(s) for all active insurance
"RTN","IVMPTRN8",191,0)
 K ^TMP("VAFIN1",$J)
"RTN","IVMPTRN8",192,0)
 D EN^VAFHLIN1(DFN,"1,4,5,7,8,9,12,13,15,16,17,28,36")
"RTN","IVMPTRN8",193,0)
 F IVMSUB=0:0 S IVMSUB=$O(^TMP("VAFIN1",$J,IVMSUB)) Q:'IVMSUB  D
"RTN","IVMPTRN8",194,0)
 .S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=^TMP("VAFIN1",$J,+IVMSUB,0)
"RTN","IVMPTRN8",195,0)
 ;
"RTN","IVMPTRN8",196,0)
 D GOTO^IVMPTRN9
"RTN","IVMPTRN8",197,0)
 Q
"VER")
8.0^22
**END**
**END**
