Released XU*8*436 SEQ #356
Extracted from mail message
**KIDS**:XU*8.0*436^

**INSTALL NAME**
XU*8.0*436
"BLD",974,0)
XU*8.0*436^KERNEL^0^3061011^y
"BLD",974,1,0)
^^2^2^3061011^
"BLD",974,1,1,0)
See patch XU*8*436 in the National Patch Module on FORUM for complete
"BLD",974,1,2,0)
information on this patch.
"BLD",974,4,0)
^9.64PA^^
"BLD",974,6.3)
2
"BLD",974,"INIT")
XU8P436
"BLD",974,"KRN",0)
^9.67PA^8989.52^19
"BLD",974,"KRN",.4,0)
.4
"BLD",974,"KRN",.401,0)
.401
"BLD",974,"KRN",.402,0)
.402
"BLD",974,"KRN",.403,0)
.403
"BLD",974,"KRN",.5,0)
.5
"BLD",974,"KRN",.84,0)
.84
"BLD",974,"KRN",3.6,0)
3.6
"BLD",974,"KRN",3.8,0)
3.8
"BLD",974,"KRN",9.2,0)
9.2
"BLD",974,"KRN",9.8,0)
9.8
"BLD",974,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",974,"KRN",9.8,"NM",1,0)
XUSTERM1^^0^B24052516
"BLD",974,"KRN",9.8,"NM","B","XUSTERM1",1)

"BLD",974,"KRN",19,0)
19
"BLD",974,"KRN",19.1,0)
19.1
"BLD",974,"KRN",101,0)
101
"BLD",974,"KRN",409.61,0)
409.61
"BLD",974,"KRN",771,0)
771
"BLD",974,"KRN",870,0)
870
"BLD",974,"KRN",8989.51,0)
8989.51
"BLD",974,"KRN",8989.52,0)
8989.52
"BLD",974,"KRN",8994,0)
8994
"BLD",974,"KRN","B",.4,.4)

"BLD",974,"KRN","B",.401,.401)

"BLD",974,"KRN","B",.402,.402)

"BLD",974,"KRN","B",.403,.403)

"BLD",974,"KRN","B",.5,.5)

"BLD",974,"KRN","B",.84,.84)

"BLD",974,"KRN","B",3.6,3.6)

"BLD",974,"KRN","B",3.8,3.8)

"BLD",974,"KRN","B",9.2,9.2)

"BLD",974,"KRN","B",9.8,9.8)

"BLD",974,"KRN","B",19,19)

"BLD",974,"KRN","B",19.1,19.1)

"BLD",974,"KRN","B",101,101)

"BLD",974,"KRN","B",409.61,409.61)

"BLD",974,"KRN","B",771,771)

"BLD",974,"KRN","B",870,870)

"BLD",974,"KRN","B",8989.51,8989.51)

"BLD",974,"KRN","B",8989.52,8989.52)

"BLD",974,"KRN","B",8994,8994)

"BLD",974,"QUES",0)
^9.62^^
"BLD",974,"REQB",0)
^9.611^1^1
"BLD",974,"REQB",1,0)
XU*8.0*384^2
"BLD",974,"REQB","B","XU*8.0*384",1)

"INIT")
XU8P436
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3051215^2970507^.5
"PKG",3,22,1,"PAH",1,0)
436^3061011
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3061011
"PKG",3,22,1,"PAH",1,1,1,0)
See patch XU*8*436 in the National Patch Module on FORUM for complete
"PKG",3,22,1,"PAH",1,1,2,0)
information on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XU8P436")
0^^B408399^n/a
"RTN","XU8P436",1,0)
XU8P436 ;SFISC/SO- SET AUSER XREF FOR HOLDERS OF XUORES KEY ;6:56 AM  11 Oct 2006
"RTN","XU8P436",2,0)
 ;;8.0;KERNEL;**436**;Jul 10, 1995;Build 2
"RTN","XU8P436",3,0)
 ;
"RTN","XU8P436",4,0)
 D MES^XPDUTL("Begin post install...")
"RTN","XU8P436",5,0)
 N IEN S IEN=0
"RTN","XU8P436",6,0)
 F  S IEN=$O(^XUSEC("XUORES",IEN)) Q:'IEN  D
"RTN","XU8P436",7,0)
 . I '$D(^VA(200,IEN,0))#2 Q
"RTN","XU8P436",8,0)
 . N NAME S NAME=$P(^VA(200,IEN,0),U)
"RTN","XU8P436",9,0)
 . S ^VA(200,"AUSER",NAME,IEN)=""
"RTN","XU8P436",10,0)
 . Q
"RTN","XU8P436",11,0)
 D MES^XPDUTL("Finished post install.")
"RTN","XU8P436",12,0)
 Q
"RTN","XUSTERM1")
0^1^B24052516^B24004727
"RTN","XUSTERM1",1,0)
XUSTERM1 ;SEA/WDE - DEACTIVATE USER ;6:40 AM  11 Oct 2006
"RTN","XUSTERM1",2,0)
 ;;8.0;KERNEL;**102,180,208,222,274,313,332,360,384,436**;Jul 10, 1995;Build 2
"RTN","XUSTERM1",3,0)
ENALL ;Interactive scan all
"RTN","XUSTERM1",4,0)
 S U="^",DTIME=$G(DTIME,60)
"RTN","XUSTERM1",5,0)
 W !!,"This option can purge all access & verify codes, mail baskets, messages,",!,"authorized senders access, keys, and electronic signature codes of users who have been terminated."
"RTN","XUSTERM1",6,0)
RD1 W !!,"Do you wish to proceed "
"RTN","XUSTERM1",7,0)
 S %=2 D YN^DICN G:%=2!(%=-1) END I %=0 S XQH="XUUSER-PURGEATT" D EN^XQH G RD1
"RTN","XUSTERM1",8,0)
RD2 W !,"Do you wish to verify each user "
"RTN","XUSTERM1",9,0)
 S %=2,XUVE=0 D YN^DICN S:%=1 XUVE=1 G:%=1 CHECK G:%=-1 END I %=0 S XQH="XUUSER-PURGEATT-VER" D EN^XQH G RD2
"RTN","XUSTERM1",10,0)
QUE W !,"Do you wish to have this queued for a later time "
"RTN","XUSTERM1",11,0)
 S %=1 D YN^DICN I %=1 D  Q
"RTN","XUSTERM1",12,0)
 . S ZTDESC="USER DEACTIVATION",ZTRTN="CHECK^XUSTERM1",ZTIO="",ZTSAVE("DUZ*")=""
"RTN","XUSTERM1",13,0)
 . D ^%ZTLOAD
"RTN","XUSTERM1",14,0)
 . Q
"RTN","XUSTERM1",15,0)
 I %=0 K X,XUVE Q
"RTN","XUSTERM1",16,0)
 ;Fall thru if user doesn't queue
"RTN","XUSTERM1",17,0)
CHECK ;Entry point for taskman.
"RTN","XUSTERM1",18,0)
 N XUDT540,XUDT90,XUDT30,FDA,XUDT
"RTN","XUSTERM1",19,0)
 S U="^",DT=$$DT^XLFDT(),XUDT90=$$HTFM^XLFDT($H-90,1),XUDT30=$$HTFM^XLFDT($H-30,1)
"RTN","XUSTERM1",20,0)
 S XUDT540=$$HTFM^XLFDT($H-540,1) ;*p332
"RTN","XUSTERM1",21,0)
 S XUDA=.6,XUVE=$G(XUVE,0)
"RTN","XUSTERM1",22,0)
 F  S XUDA=$O(^VA(200,XUDA)) Q:XUDA'>0  S XUJ=$G(^(XUDA,0)) D
"RTN","XUSTERM1",23,0)
 . S XUDT=$P(XUJ,U,11)
"RTN","XUSTERM1",24,0)
 . I $P(XUJ,U,3)]"",$L(XUDT),(XUDT'>DT) D
"RTN","XUSTERM1",25,0)
 . . D GET
"RTN","XUSTERM1",26,0)
 . . I 'XUEMP K Y D:XUVE DISP Q:$D(Y)  D ACT ;XUEMP=any data to remove
"RTN","XUSTERM1",27,0)
 . . Q
"RTN","XUSTERM1",28,0)
 . I $P(XUJ,U,3)]"",'$P(XUJ,U,8),$$NOSIGNON D DISUSER(XUDA)
"RTN","XUSTERM1",29,0)
 . I $P(XUJ,U,7) D AUSER(XUDA) ;*p332
"RTN","XUSTERM1",30,0)
 . Q
"RTN","XUSTERM1",31,0)
 ;
"RTN","XUSTERM1",32,0)
END K XUEMP,XUDA,XUI,XUJ,XUK,XUACT,XUKEY,XUGRP,XUSUR,XUNAM,XUF,XUDT,XUIN,XUVE,X,DIC,XUDB,XUDC,XUDP
"RTN","XUSTERM1",33,0)
 Q
"RTN","XUSTERM1",34,0)
 ;
"RTN","XUSTERM1",35,0)
DISUSER(XUDA) ;Set DISUSER flag and reason, Remove last menu option
"RTN","XUSTERM1",36,0)
 Q:$P(XUJ,U,7)  ;DISUSER already set *p332
"RTN","XUSTERM1",37,0)
 N %,FDA S %=XUDA_","
"RTN","XUSTERM1",38,0)
 S FDA(200,%,7)=1,FDA(200,%,9.4)="User Inactive for too long"
"RTN","XUSTERM1",39,0)
 D FILE^DIE("","FDA"),CONTCL(XUDA) ;Set Disuser
"RTN","XUSTERM1",40,0)
 Q
"RTN","XUSTERM1",41,0)
 ;
"RTN","XUSTERM1",42,0)
AUSER(XUDA) ;If DISUSERed and Last Sign > 540[18Mo.*30] days, then remove"AUSER" xref
"RTN","XUSTERM1",43,0)
 I $D(^XUSEC("XUORES",XUDA)) Q  ;Owner of XUORES key ;p*436
"RTN","XUSTERM1",44,0)
 N Q S Q=$P($G(^VA(200,XUDA,1.1)),U) ;Get last sign-on
"RTN","XUSTERM1",45,0)
 I $L(Q),Q<XUDT540 K ^VA(200,"AUSER",$P(XUJ,U),XUDA) ;*p360;*p384
"RTN","XUSTERM1",46,0)
 Q
"RTN","XUSTERM1",47,0)
 ;
"RTN","XUSTERM1",48,0)
NOSIGNON() ;Check last signon. Return 1 if should disable account
"RTN","XUSTERM1",49,0)
 N Q S Q=$P($G(^VA(200,XUDA,1.1)),U) ;Get last sign-on
"RTN","XUSTERM1",50,0)
 I $L(Q),Q>XUDT90 Q 0 ;Last sign-on within 90 days
"RTN","XUSTERM1",51,0)
 S Q=$P($G(^VA(200,XUDA,1.1)),U,4) ;Get last Edit date
"RTN","XUSTERM1",52,0)
 I $L(Q),Q>XUDT30 Q 0 ;User edited in last 30 days
"RTN","XUSTERM1",53,0)
 S Q=$P($G(^VA(200,XUDA,1)),U,7) ;Create Date
"RTN","XUSTERM1",54,0)
 I $L(Q),Q>XUDT30 Q 0 ;User set up in last 30 days
"RTN","XUSTERM1",55,0)
 S Q=$P($G(^VA(200,XUDA,.1)),U) ;Get verify code change date
"RTN","XUSTERM1",56,0)
 I $L(Q),(Q+30)>$H Q 0 ;Verify code changed in last 30 days
"RTN","XUSTERM1",57,0)
 Q 1
"RTN","XUSTERM1",58,0)
 ;
"RTN","XUSTERM1",59,0)
CONTCL(XUDA) ;Clear the fields for Menu "Continue"
"RTN","XUSTERM1",60,0)
 N FDA
"RTN","XUSTERM1",61,0)
 S FDA(200,XUDA_",",202.1)="@",FDA(200,XUDA_",",202.2)="@"
"RTN","XUSTERM1",62,0)
 D FILE^DIE("","FDA") ;Clear 202.1 and 202.2
"RTN","XUSTERM1",63,0)
 Q
"RTN","XUSTERM1",64,0)
 ;
"RTN","XUSTERM1",65,0)
ACT ;
"RTN","XUSTERM1",66,0)
 D ACT^XUSTERM
"RTN","XUSTERM1",67,0)
 S XUJ=^VA(200,XUDA,0) ;Get new copy of zero node
"RTN","XUSTERM1",68,0)
 Q
"RTN","XUSTERM1",69,0)
 ;
"RTN","XUSTERM1",70,0)
GET ;Kill ^DISV entries each time, should get all CPUs at some point
"RTN","XUSTERM1",71,0)
 N XUJ
"RTN","XUSTERM1",72,0)
 D GET^XUSTERM K ^DISV(XUDA),Y
"RTN","XUSTERM1",73,0)
 Q
"RTN","XUSTERM1",74,0)
DISP ;Display info and get responses.
"RTN","XUSTERM1",75,0)
 N DA,DIE,DR,XUJ
"RTN","XUSTERM1",76,0)
 S DA=XUDA
"RTN","XUSTERM1",77,0)
 L +^VA(200,DA,0):6 D DISP2 L -^VA(200,DA,0)
"RTN","XUSTERM1",78,0)
 Q
"RTN","XUSTERM1",79,0)
DISP2 ;Do the work.
"RTN","XUSTERM1",80,0)
 W !!,$S(XUTX1(1)["User":XUNAM_$P(XUTX1(1),"User",2),1:XUTX1(1)) ;*p360
"RTN","XUSTERM1",81,0)
 S DR="9.21//YES",DIE=200 D ^DIE Q:$D(Y)  G:'$D(XUSUR) KEYS
"RTN","XUSTERM1",82,0)
 W !!,XUNAM," acts as surrogate for the following users:"
"RTN","XUSTERM1",83,0)
 S XUJ=0,XUI=3 F XUK=0:1 S XUJ=$O(XUSUR(XUJ)) Q:XUJ'>0  W:'(XUK#XUI) ! W ?(XUK#XUI*26),$P(^VA(200,XUJ,0),U,1) W !,"These surrogate privileges will be deleted on deactivation."
"RTN","XUSTERM1",84,0)
KEYS ;This section checks for authorized senders of mail groups and security keys.
"RTN","XUSTERM1",85,0)
 W !,"User will no longer be an authorized sender to any mail groups."
"RTN","XUSTERM1",86,0)
 I '$D(XUKEY) W !!,XUNAM," currently holds no keys." G KEYS1
"RTN","XUSTERM1",87,0)
 W !!,XUNAM," holds the following keys: "
"RTN","XUSTERM1",88,0)
 S XUJ=0,XUI=5 F XUK=0:1 S XUJ=$O(XUKEY(XUJ)) Q:XUJ'>0  W:'(XUK#XUI) ! W ?(XUK#XUI*15),$P($G(^DIC(19.1,XUJ,0)),U,1)
"RTN","XUSTERM1",89,0)
KEYS1 W ! S DR="9.22//YES" D ^DIE Q:$D(Y)
"RTN","XUSTERM1",90,0)
GROUP I '$D(XUGRP) W !!,XUNAM," currently is not a member of any MAIL GROUP." G GROUP1
"RTN","XUSTERM1",91,0)
 W !!,XUNAM," is a member of the following Mail Groups:"
"RTN","XUSTERM1",92,0)
 S XUI="" F XUI=0:0 S XUI=$O(XUGRP(XUI)) Q:XUI'>0  D
"RTN","XUSTERM1",93,0)
 . S XUJ=XUGRP(XUI)
"RTN","XUSTERM1",94,0)
 . I $P(XUJ,U,2)="PU"!$D(^XMB(3.8,"AB",XUDA,XUI)) W !?2,$P(XUJ,U,1) W:$P(XUJ,U,3) " (Organizer)" W ?40,$S(($P(XUJ,U,2)="PR"):"(Private)",1:"(Public)")
"RTN","XUSTERM1",95,0)
 . Q
"RTN","XUSTERM1",96,0)
GROUP1 W ! S DR="9.23//YES" D ^DIE Q:$D(Y)
"RTN","XUSTERM1",97,0)
 Q
"RTN","XUSTERM1",98,0)
 ;
"RTN","XUSTERM1",99,0)
DQ1 ;Terminate one person.
"RTN","XUSTERM1",100,0)
 N XUJ,XUDT,XUVE
"RTN","XUSTERM1",101,0)
 S XUJ=$G(^VA(200,XUDA,0)),XUDT=$P(XUJ,U,11) I XUDT,(XUDT'>DT) D
"RTN","XUSTERM1",102,0)
 . S XUVE=0 D GET I 'XUEMP D ACT
"RTN","XUSTERM1",103,0)
 . Q
"RTN","XUSTERM1",104,0)
 Q
"RTN","XUSTERM1",105,0)
 ;
"RTN","XUSTERM1",106,0)
SEND ; send deactivated message to assigned mail group
"RTN","XUSTERM1",107,0)
 K XMB,XMY
"RTN","XUSTERM1",108,0)
 S XMB(1)=$P(XUJ,"^",1)
"RTN","XUSTERM1",109,0)
 S XMB(2)=$$GET1^DIQ(200,XUDA,8)
"RTN","XUSTERM1",110,0)
 S XMB(3)=$$GET1^DIQ(200,XUDA,29)
"RTN","XUSTERM1",111,0)
 S XMB(4)=$$FMTE^XLFDT(XUDT)
"RTN","XUSTERM1",112,0)
 S XMB="XUSERDEAC" D ^XMB:$D(^XMB(3.6,"B",XMB))
"RTN","XUSTERM1",113,0)
 K XMB
"RTN","XUSTERM1",114,0)
 Q
"VER")
8.0^22.0
"BLD",974,6)
^356
**END**
**END**
