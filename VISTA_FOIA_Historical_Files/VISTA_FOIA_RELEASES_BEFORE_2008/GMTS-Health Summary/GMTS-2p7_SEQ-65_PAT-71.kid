Released GMTS*2.7*71 SEQ #65
Extracted from mail message
**KIDS**:GMTS*2.7*71^

**INSTALL NAME**
GMTS*2.7*71
"BLD",4989,0)
GMTS*2.7*71^HEALTH SUMMARY^0^3040825^y
"BLD",4989,1,0)
^^2^2^3040324^
"BLD",4989,1,1,0)
Please see the National Patch Module for details of the enhancements 
"BLD",4989,1,2,0)
included in this patch.
"BLD",4989,4,0)
^9.64PA^^
"BLD",4989,"KRN",0)
^9.67PA^8989.52^19
"BLD",4989,"KRN",.4,0)
.4
"BLD",4989,"KRN",.401,0)
.401
"BLD",4989,"KRN",.402,0)
.402
"BLD",4989,"KRN",.403,0)
.403
"BLD",4989,"KRN",.5,0)
.5
"BLD",4989,"KRN",.84,0)
.84
"BLD",4989,"KRN",3.6,0)
3.6
"BLD",4989,"KRN",3.8,0)
3.8
"BLD",4989,"KRN",9.2,0)
9.2
"BLD",4989,"KRN",9.8,0)
9.8
"BLD",4989,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",4989,"KRN",9.8,"NM",1,0)
GMTSDCB^^0^B5567666
"BLD",4989,"KRN",9.8,"NM",2,0)
GMTSDGA^^0^B9637322
"BLD",4989,"KRN",9.8,"NM",3,0)
GMTSDGC1^^0^B13343413
"BLD",4989,"KRN",9.8,"NM",4,0)
GMTSPXU1^^0^B13346814
"BLD",4989,"KRN",9.8,"NM",5,0)
GMTSDGC2^^0^B5767179
"BLD",4989,"KRN",9.8,"NM",6,0)
GMTSDGP^^0^B11105682
"BLD",4989,"KRN",9.8,"NM",7,0)
GMTSROE^^0^B55542130
"BLD",4989,"KRN",9.8,"NM","B","GMTSDCB",1)

"BLD",4989,"KRN",9.8,"NM","B","GMTSDGA",2)

"BLD",4989,"KRN",9.8,"NM","B","GMTSDGC1",3)

"BLD",4989,"KRN",9.8,"NM","B","GMTSDGC2",5)

"BLD",4989,"KRN",9.8,"NM","B","GMTSDGP",6)

"BLD",4989,"KRN",9.8,"NM","B","GMTSPXU1",4)

"BLD",4989,"KRN",9.8,"NM","B","GMTSROE",7)

"BLD",4989,"KRN",19,0)
19
"BLD",4989,"KRN",19.1,0)
19.1
"BLD",4989,"KRN",101,0)
101
"BLD",4989,"KRN",409.61,0)
409.61
"BLD",4989,"KRN",771,0)
771
"BLD",4989,"KRN",870,0)
870
"BLD",4989,"KRN",8989.51,0)
8989.51
"BLD",4989,"KRN",8989.52,0)
8989.52
"BLD",4989,"KRN",8994,0)
8994
"BLD",4989,"KRN","B",.4,.4)

"BLD",4989,"KRN","B",.401,.401)

"BLD",4989,"KRN","B",.402,.402)

"BLD",4989,"KRN","B",.403,.403)

"BLD",4989,"KRN","B",.5,.5)

"BLD",4989,"KRN","B",.84,.84)

"BLD",4989,"KRN","B",3.6,3.6)

"BLD",4989,"KRN","B",3.8,3.8)

"BLD",4989,"KRN","B",9.2,9.2)

"BLD",4989,"KRN","B",9.8,9.8)

"BLD",4989,"KRN","B",19,19)

"BLD",4989,"KRN","B",19.1,19.1)

"BLD",4989,"KRN","B",101,101)

"BLD",4989,"KRN","B",409.61,409.61)

"BLD",4989,"KRN","B",771,771)

"BLD",4989,"KRN","B",870,870)

"BLD",4989,"KRN","B",8989.51,8989.51)

"BLD",4989,"KRN","B",8989.52,8989.52)

"BLD",4989,"KRN","B",8994,8994)

"BLD",4989,"QUES",0)
^9.62^^
"BLD",4989,"REQB",0)
^9.611^2^2
"BLD",4989,"REQB",1,0)
GMTS*2.7*60^2
"BLD",4989,"REQB",2,0)
GMTS*2.7*57^2
"BLD",4989,"REQB","B","GMTS*2.7*57",2)

"BLD",4989,"REQB","B","GMTS*2.7*60",1)

"MBREQ")
0
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools^^^3010208
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2951020^11
"PKG",126,22,1,"PAH",1,0)
71^3040825^1118
"PKG",126,22,1,"PAH",1,1,0)
^^2^2^3040825
"PKG",126,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements 
"PKG",126,22,1,"PAH",1,1,2,0)
included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","GMTSDCB")
0^1^B5567666
"RTN","GMTSDCB",1,0)
GMTSDCB ; SLC/TRS,KER - Brief Discharge ; 03/24/2004
"RTN","GMTSDCB",2,0)
 ;;2.7;Health Summary;**28,49,71**;Oct 20, 1995
"RTN","GMTSDCB",3,0)
 ;                
"RTN","GMTSDCB",4,0)
 ; External References
"RTN","GMTSDCB",5,0)
 ;   DBIA  3390  $$ICDDX^ICDCODE
"RTN","GMTSDCB",6,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSDCB",7,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDCB",8,0)
 ;   DBIA 10082  ^ICD9(
"RTN","GMTSDCB",9,0)
 ;   DBIA 10015  EN^DIQ1 (file #45)
"RTN","GMTSDCB",10,0)
 ;   DBIA  3145 ^DIC(42.4,
"RTN","GMTSDCB",11,0)
 ;   DBIA  3146 ^DIC(45.6,
"RTN","GMTSDCB",12,0)
 ;                     
"RTN","GMTSDCB",13,0)
ENDC ; Brief Discharge (no captions)
"RTN","GMTSDCB",14,0)
 S N="",ADM=GMTS1,GMC=0,LF=0
"RTN","GMTSDCB",15,0)
 I $D(GMTSNDM),(GMTSNDM>0) S CNTR=GMTSNDM
"RTN","GMTSDCB",16,0)
 E  S CNTR=100
"RTN","GMTSDCB",17,0)
 S T1=GMTSEND,T2=GMTSBEG
"RTN","GMTSDCB",18,0)
 F  S ADM=$O(^DPT(DFN,"DA","AA",ADM)) Q:'ADM!(ADM>GMTS2)  F  S N=$O(^DPT(DFN,"DA","AA",ADM,N)) Q:'N  D PROC I CNTR=0 Q
"RTN","GMTSDCB",19,0)
 D KILLADM Q
"RTN","GMTSDCB",20,0)
PROC ; Process Admissions
"RTN","GMTSDCB",21,0)
 S AD0=^DPT(DFN,"DA",N,0),PTF=$P(AD0,U,12)
"RTN","GMTSDCB",22,0)
 S CNTR=CNTR-1 I CNTR=0 Q
"RTN","GMTSDCB",23,0)
 I $S('PTF:1,1:'$D(^DGPT(PTF,70))) S GMC=-1 Q
"RTN","GMTSDCB",24,0)
 S:$D(^DGPT(PTF,70)) ICD=^DGPT(PTF,70)
"RTN","GMTSDCB",25,0)
 I $P(ICD,"^",1)="" S GMC=-1 Q
"RTN","GMTSDCB",26,0)
 S DATE=$P((ICD),"^",1) I (DATE'<T1)!(DATE'>T2) Q:GMC  S GMC=-1 Q
"RTN","GMTSDCB",27,0)
 S GMC=2 S X=DATE D REGDT4^GMTSU S XD=X
"RTN","GMTSDCB",28,0)
 I $P(ICD,U,10)'="" N ICDX S ICDX=$$ICDDX^ICDCODE($P(ICD,U,10)),DXL=$P(ICDX,"^",4)
"RTN","GMTSDCB",29,0)
 I $P((ICD),"^",2)'="" S BS=$P((ICD),"^",2),BS=$S($D(^DIC(42.4,BS,0)):^DIC(42.4,BS,0),1:"") S BDS=$S($P((BS),"^",2)'="":$P(BS,U,2),$P(BS,U,1)'="":$P(BS,U,1),1:"UNKNOWN")
"RTN","GMTSDCB",30,0)
 I $P(ICD,"^",3)'="" S DIC="^DGPT(",DR=72,DA=PTF,DIQ="ARRAY",DIQ(0)="E" D EN^DIQ1 S SDS=ARRAY(45,DA,72,"E")
"RTN","GMTSDCB",31,0)
 S DP=$S($P((ICD),"^",6)'="":$P(ICD,U,6),1:""),DP=$S(DP'="":^DIC(45.6,DP,0),1:"")
"RTN","GMTSDCB",32,0)
 S OT=$P(ICD,"^",4),OP=$S(OT=3:"NO",OT="":"UNKNOWN",1:"YES")
"RTN","GMTSDCB",33,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,XD,?21,SDS,!
"RTN","GMTSDCB",34,0)
 I $D(DXL) D CKP^GMTSUP Q:$D(GMTSQIT)  W ?15,"DXLS: ",DXL,!
"RTN","GMTSDCB",35,0)
 K DXL,BS,BDS,ICD,DATE
"RTN","GMTSDCB",36,0)
 Q
"RTN","GMTSDCB",37,0)
KILLADM ; Kills Admission variables
"RTN","GMTSDCB",38,0)
 K END,TDT,HH,MM,TN,LF,DATE,AT,ITR,TRT,TI,TO,N,CNTR,BDS,SDS,GMC,ARRAY,DXL,TOM,TR,T1,T2,DATE,I,A,AD0,ADM,BS,D,DA,DP,DR,ICD,OP,OT,PTF,X,XD,DIQ,DIC
"RTN","GMTSDCB",39,0)
 Q
"RTN","GMTSDGA")
0^2^B9637322
"RTN","GMTSDGA",1,0)
GMTSDGA ; SLC/MKB,KER/NDBI - Admissions for HS ; 03/24/2004
"RTN","GMTSDGA",2,0)
 ;;2.7;Health Summary;**28,49,71**;Oct 20, 1995
"RTN","GMTSDGA",3,0)
 ;                   
"RTN","GMTSDGA",4,0)
 ; External Reference
"RTN","GMTSDGA",5,0)
 ;   DBIA  3390  $$ICDDX^ICDCODE
"RTN","GMTSDGA",6,0)
 ;   DBIA    17  ^DGPM("ATID"
"RTN","GMTSDGA",7,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGA",8,0)
 ;   DBIA 10082  ^ICD9(
"RTN","GMTSDGA",9,0)
 ;   DBIA  2929  DSP^A7RHSM
"RTN","GMTSDGA",10,0)
 ;   DBIA  2929  LST^A7RHSM
"RTN","GMTSDGA",11,0)
 ;   DBIA   512  ^DGPMLOS
"RTN","GMTSDGA",12,0)
 ;   DBIA 10061  IN5^VADPT
"RTN","GMTSDGA",13,0)
 ;   DBIA 10061  KVAR^VADPT
"RTN","GMTSDGA",14,0)
 ;                    
"RTN","GMTSDGA",15,0)
ENAD ; Gets Admission Information 
"RTN","GMTSDGA",16,0)
 S TT=1,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",17,0)
 D PATINFO Q
"RTN","GMTSDGA",18,0)
ENDC ; Discharge Information
"RTN","GMTSDGA",19,0)
 S TT=3,FLGDC=1,FLGDX=0
"RTN","GMTSDGA",20,0)
 D PATINFO Q
"RTN","GMTSDGA",21,0)
ENDX ; PTF Discharge Diagnosis
"RTN","GMTSDGA",22,0)
 S TT=3,FLGDX=1,FLGDC=0
"RTN","GMTSDGA",23,0)
 D PATINFO Q
"RTN","GMTSDGA",24,0)
ENTS ; Treating Speciality Information
"RTN","GMTSDGA",25,0)
 S TT=6,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",26,0)
 D PATINFO Q
"RTN","GMTSDGA",27,0)
ENTR ; Transfers
"RTN","GMTSDGA",28,0)
 S TT=2,FLGDX=0,FLGDC=0
"RTN","GMTSDGA",29,0)
 D PATINFO Q
"RTN","GMTSDGA",30,0)
PATINFO ; Patient Information
"RTN","GMTSDGA",31,0)
 S VA200=1 K DIQ
"RTN","GMTSDGA",32,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGA",33,0)
 E  S CNTR=100
"RTN","GMTSDGA",34,0)
 S GMC=-1,GMN="",ADM=GMTS1,FLAG=0
"RTN","GMTSDGA",35,0)
 I TT=1 D FADM^GMTSDGA2
"RTN","GMTSDGA",36,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) LST^A7RHSM(DFN,.A7RHS)
"RTN","GMTSDGA",37,0)
 F  S ADM=$O(^DGPM("ATID"_TT,DFN,ADM)) D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) DSP^A7RHSM(ADM) Q:('ADM!(ADM>GMTS2)!($D(GMTSQIT)))  D GET Q:$D(GMTSQIT)!($G(CNTR)<0)
"RTN","GMTSDGA",38,0)
 D KILLADM K:$$NDBI^GMTSU A7RHS
"RTN","GMTSDGA",39,0)
 Q
"RTN","GMTSDGA",40,0)
GET ; Admission Data
"RTN","GMTSDGA",41,0)
 N VAHOW
"RTN","GMTSDGA",42,0)
 S ADA=$O(^DGPM("ATID"_TT,DFN,ADM,0)) Q:'ADA
"RTN","GMTSDGA",43,0)
 S CNTR=CNTR-1 I CNTR<0 Q
"RTN","GMTSDGA",44,0)
 S VAIP("E")=ADA D IN5^VADPT
"RTN","GMTSDGA",45,0)
 S (X,ADATE)=+VAIP(3) D REGDT4^GMTSU S ADT=X
"RTN","GMTSDGA",46,0)
 K DGPMIFN S:TT=1 DGPMIFN=ADA S:TT'=1 DGPMIFN=VAIP(13)
"RTN","GMTSDGA",47,0)
 S GMC=2
"RTN","GMTSDGA",48,0)
 D CONTGET
"RTN","GMTSDGA",49,0)
 S LIN=$S(TT=2:"TROUT^GMTSDGA1",FLGDX:"DXOUT^GMTSDGA1",FLGDC:"DCOUT^GMTSDGA1",TT=6:"TSOUT^GMTSDGA2",TT=1:"ADOUT^GMTSDGA1") D @LIN
"RTN","GMTSDGA",50,0)
 K ICD(ADM)
"RTN","GMTSDGA",51,0)
 Q
"RTN","GMTSDGA",52,0)
CONTGET ; ICD and LOS info only needed for certain MAS components
"RTN","GMTSDGA",53,0)
 Q:TT=2  Q:TT=6  N ICDX,ICDI I DGPMIFN D ^DGPMLOS S LOS=+X
"RTN","GMTSDGA",54,0)
 S PTF=$S($D(VAIP(12)):VAIP(12),1:"") Q:'$D(^ICD9)  Q:PTF=""  Q:'$D(^DGPT(PTF,70))
"RTN","GMTSDGA",55,0)
 S ICD=^DGPT(PTF,70)
"RTN","GMTSDGA",56,0)
 S ICDI=+$P(ICD,U,11) I ICDI>0 D
"RTN","GMTSDGA",57,0)
 . S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGA",58,0)
 . S ICD(ADM,1,80,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGA",59,0)
 . S ICD(ADM,1,80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGA",60,0)
 S ICDI=+$P(ICD,U,10) I ICDI>0 D
"RTN","GMTSDGA",61,0)
 . S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGA",62,0)
 . S ICD(ADM,2,80,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGA",63,0)
 . S ICD(ADM,2,80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGA",64,0)
 F GMTSI=16:1:24 S ICDI=+$P(ICD,U,GMTSI) I ICDI>0 D
"RTN","GMTSDGA",65,0)
 . S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGA",66,0)
 . S ICD(ADM,(GMTSI-13),80,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGA",67,0)
 . S ICD(ADM,(GMTSI-13),80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGA",68,0)
 Q
"RTN","GMTSDGA",69,0)
KILLADM ; Kill Admission variables
"RTN","GMTSDGA",70,0)
 D KVAR^VADPT
"RTN","GMTSDGA",71,0)
 K ADA,ADATE,ADT,BD,BDSC,DA,DIC,DDT,DP,DSPL,GMJ,GMJ1,OP,OPTR,FLAG,FLGDX,FLGDC,X,DR,GMI,GMTO,GMTNO,GMTSI,GMX,ADM,CNTR,GMC,GMZ,GMN,ICD,PTF,PTF70,PTFLG,LOS,II,DGPMIFN,IN,LIN,TI,TT,TS,SPEC
"RTN","GMTSDGA",72,0)
 Q
"RTN","GMTSDGC1")
0^3^B13343413
"RTN","GMTSDGC1",1,0)
GMTSDGC1 ; SLC/KER/SBW - Subroutines for Ext ADT Hist    ; 03/24/2004 [8/25/04 9:59am]
"RTN","GMTSDGC1",2,0)
 ;;2.7;Health Summary;**5,35,47,71**;Oct 20, 1995
"RTN","GMTSDGC1",3,0)
 ;
"RTN","GMTSDGC1",4,0)
 ; External References
"RTN","GMTSDGC1",5,0)
 ;   DBIA  3390  $$ICDDX^ICDCODE
"RTN","GMTSDGC1",6,0)
 ;   DBIA    17  ^DGPM(
"RTN","GMTSDGC1",7,0)
 ;   DBIA  1372  ^DGPT( fields 71,73,75 Read w/Fileman
"RTN","GMTSDGC1",8,0)
 ;   DBIA   512  ^DGPMLOS
"RTN","GMTSDGC1",9,0)
 ;   DBIA 10015  EN^DIQ1 (file #45)
"RTN","GMTSDGC1",10,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSDGC1",11,0)
 ;                     
"RTN","GMTSDGC1",12,0)
OTHER(DFN,PTF,CODE,GMVAIP,MDA) ; Additional data to include
"RTN","GMTSDGC1",13,0)
 N LOS,ICD,DGPMIFN,GMI,GMX,NODIAG,GMTO,GMTNO,BD,BDSC,ATTN,WARD,AWS
"RTN","GMTSDGC1",14,0)
 N DP,DSPL,OP,OPTR
"RTN","GMTSDGC1",15,0)
 I CODE=1 D  Q  ;Other data for Admission entries
"RTN","GMTSDGC1",16,0)
 . Q:$G(GMVAIP("DN",1))'=""
"RTN","GMTSDGC1",17,0)
 . D GETDATA
"RTN","GMTSDGC1",18,0)
 . I $G(GMVAIP("MF"))]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Adm. Diag: ",GMVAIP("MF")
"RTN","GMTSDGC1",19,0)
 . W ?64,"LOS: ",LOS,!
"RTN","GMTSDGC1",20,0)
 . Q:'$D(ICD)
"RTN","GMTSDGC1",21,0)
 . S GMI=0
"RTN","GMTSDGC1",22,0)
 . F  S GMI=$O(ICD(GMI)) Q:'GMI  D CKP^GMTSUP Q:$D(GMTSQIT)  S GMX="" F  S GMX=$O(ICD(GMI,80,GMX)) Q:'GMX  D NXTICD
"RTN","GMTSDGC1",23,0)
 I CODE=2 D  Q  ;Other data for Transfer entries
"RTN","GMTSDGC1",24,0)
 . N TRFAC
"RTN","GMTSDGC1",25,0)
 . S TRFAC=$P(^DGPM(MDA,0),U,5)
"RTN","GMTSDGC1",26,0)
 . I $P($G(GMVAIP("WL")),U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?19,$S($P(VAIP("MT"),U,2)'["TO":"To ",1:""),$P(VAIP("WL"),U,2),$S($L(TRFAC):"  at "_TRFAC,1:""),!
"RTN","GMTSDGC1",27,0)
 I CODE=3 D  Q  ;Other data for Discharge entries
"RTN","GMTSDGC1",28,0)
 . ; Discharge data
"RTN","GMTSDGC1",29,0)
 . D GETDATA
"RTN","GMTSDGC1",30,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?11,"Bedsection: ",BDSC,?64,"LOS: ",LOS,!
"RTN","GMTSDGC1",31,0)
 . S NODIAG=1,GMI=0
"RTN","GMTSDGC1",32,0)
 . F  S GMI=$O(ICD(GMI)) Q:GMI'>0  S GMX=0 F  S GMX=$O(ICD(GMI,80,GMX)) Q:GMX'>0  D NXTICD
"RTN","GMTSDGC1",33,0)
 . I NODIAG D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSDGC1",34,0)
 . . W ?7,"Principal Diag: No discharge diagnosis available.",!
"RTN","GMTSDGC1",35,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Disposition Place: ",DSPL,!
"RTN","GMTSDGC1",36,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?4,"Outpat. Treatment: ",OPTR,!
"RTN","GMTSDGC1",37,0)
 . I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGC1",38,0)
 I CODE=6 D  Q  ;Other data for Treating Specialty entries
"RTN","GMTSDGC1",39,0)
 . N DIWL,DIWF,DIWR,GMJ,GMJ1
"RTN","GMTSDGC1",40,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSDGC1",41,0)
 . S DIWL=22,DIWR=78,DIWF="C56"
"RTN","GMTSDGC1",42,0)
 . I $D(^DGPM(MDA,"DX")) D
"RTN","GMTSDGC1",43,0)
 . . F GMJ=1:1:$P(^DGPM(MDA,"DX",0),"^",4) S X=^DGPM(MDA,"DX",GMJ,0) D ^DIWP
"RTN","GMTSDGC1",44,0)
 . I $D(^UTILITY($J,"W")) D
"RTN","GMTSDGC1",45,0)
 . . S GMJ=$O(^UTILITY($J,"W",0)) Q:'GMJ
"RTN","GMTSDGC1",46,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?14,"TS Diag: "
"RTN","GMTSDGC1",47,0)
 . . S GMJ1=0
"RTN","GMTSDGC1",48,0)
 . . F  S GMJ1=$O(^UTILITY($J,"W",GMJ,GMJ1)) Q:'GMJ1  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,^UTILITY($J,"W",GMJ,GMJ1,0),!
"RTN","GMTSDGC1",49,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSDGC1",50,0)
 Q
"RTN","GMTSDGC1",51,0)
GETDATA ; Gets LOS, ICD and bedsection data
"RTN","GMTSDGC1",52,0)
 N DIC,DR,DA,DIQ,GMTSI,X,PTFA
"RTN","GMTSDGC1",53,0)
 S DGPMIFN=$G(GMVAIP("AN"))
"RTN","GMTSDGC1",54,0)
 I DGPMIFN D ^DGPMLOS S LOS=+X
"RTN","GMTSDGC1",55,0)
 I '$D(^DGPT(PTF,70)) D  Q
"RTN","GMTSDGC1",56,0)
 . S (BDSC,DSPL,OPTR)="UNKNOWN"
"RTN","GMTSDGC1",57,0)
 S DIC=45,DA=+PTF,DR="71;73;75;",DIQ="PTFA(" D EN^DIQ1
"RTN","GMTSDGC1",58,0)
 S BDSC=$S(PTFA(45,+DA,71)]"":PTFA(45,+DA,71),1:"UNKNOWN")
"RTN","GMTSDGC1",59,0)
 S OPTR=$S(PTFA(45,+DA,73)]"":PTFA(45,+DA,73),1:"UNKNOWN")
"RTN","GMTSDGC1",60,0)
 S DSPL=$S(PTFA(45,+DA,75)]"":PTFA(45,+DA,75),1:"UNKNOWN")
"RTN","GMTSDGC1",61,0)
 Q:'$D(^ICD9)
"RTN","GMTSDGC1",62,0)
 S ICD=^DGPT(PTF,70),DIC=80,DR=".01;3"
"RTN","GMTSDGC1",63,0)
 S ICDI=+$P(ICD,U,10) I +ICDI>0 D
"RTN","GMTSDGC1",64,0)
 . S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGC1",65,0)
 . S ICD(1,80,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGC1",66,0)
 . S ICD(1,80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGC1",67,0)
 S ICDI=+$P(ICD,U,11) Q:+ICDI'>0
"RTN","GMTSDGC1",68,0)
 S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGC1",69,0)
 S ICD(2,80,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGC1",70,0)
 S ICD(2,80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGC1",71,0)
 F GMTSI=16:1:24 S ICDI=+$P(ICD,U,GMTSI) I ICDI>0 D
"RTN","GMTSDGC1",72,0)
 . S ICDX=$$ICDDX^ICDCODE(ICDI)
"RTN","GMTSDGC1",73,0)
 . S ICD((GMTSI-13),80,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGC1",74,0)
 . S ICD((GMTSI-13),80,ICDI,3)=$P(ICDX,"^",4)
"RTN","GMTSDGC1",75,0)
 Q
"RTN","GMTSDGC1",76,0)
NXTICD ; Print the next ICD
"RTN","GMTSDGC1",77,0)
 S (GMTO,GMTNO)="" S GMTO=$G(ICD(GMI,80,GMX,3)),GMTNO=$G(ICD(GMI,80,GMX,.01))
"RTN","GMTSDGC1",78,0)
 W:GMI=1 ?7,"Principal Diag: "
"RTN","GMTSDGC1",79,0)
 W:GMI=2 ?17,"DXLS: "
"RTN","GMTSDGC1",80,0)
 W:GMI=3 ?15,"ICD DX: "
"RTN","GMTSDGC1",81,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?23,GMTO,?69,GMTNO,!
"RTN","GMTSDGC1",82,0)
 S NODIAG=0
"RTN","GMTSDGC1",83,0)
 Q
"RTN","GMTSDGC2")
0^5^B5767179
"RTN","GMTSDGC2",1,0)
GMTSDGC2 ; SLC/SBW,KER - Extended ADT Hist (cont) ; 03/24/2004
"RTN","GMTSDGC2",2,0)
 ;;2.7;Health Summary;**28,49,71**;Oct 20, 1995
"RTN","GMTSDGC2",3,0)
 ;                   
"RTN","GMTSDGC2",4,0)
 ; External References
"RTN","GMTSDGC2",5,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGC2",6,0)
 ;   DBIA  3390  $$ICDOP^ICDCODE
"RTN","GMTSDGC2",7,0)
 ;                     
"RTN","GMTSDGC2",8,0)
ICDP(DFN,PTF) ; Module For History of PTF Procedures
"RTN","GMTSDGC2",9,0)
 Q:'$D(^DGPT(PTF,"P"))
"RTN","GMTSDGC2",10,0)
 N II,PRX,X,IX,GMP,GTA,O,O1,LN1
"RTN","GMTSDGC2",11,0)
 S II=0
"RTN","GMTSDGC2",12,0)
 F  S II=$O(^DGPT(PTF,"P",II)) Q:'II  S PRX=^DGPT(PTF,"P",II,0),X=$P(PRX,U,1),IX=9999999-X D REGDT4^GMTSU D
"RTN","GMTSDGC2",13,0)
 . S GMP(IX)="Procedure "_X F GTA=5:1:9 D
"RTN","GMTSDGC2",14,0)
 . . N ICDP,ICDI,ICDX Q:$P(PRX,U,GTA)=""
"RTN","GMTSDGC2",15,0)
 . . S ICDI=+($P(PRX,U,GTA)) Q:+ICDI'>0
"RTN","GMTSDGC2",16,0)
 . . S ICDX=$$ICDOP^ICDCODE(+ICDI)
"RTN","GMTSDGC2",17,0)
 . . S ICDP(80.1,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGC2",18,0)
 . . S ICDP(80.1,ICDI,4)=$P(ICDX,"^",5)
"RTN","GMTSDGC2",19,0)
 . . I $D(ICDP(80.1,ICDI)) D
"RTN","GMTSDGC2",20,0)
 . . . S GMP(IX,GTA)=$E(ICDP(80.1,ICDI,4),1,45)_U_ICDP(80.1,ICDI,.01)
"RTN","GMTSDGC2",21,0)
 I $D(GMP) S O=0 F  S O=$O(GMP(O)) Q:O=""  D
"RTN","GMTSDGC2",22,0)
 . S O1=0,LN1=1
"RTN","GMTSDGC2",23,0)
 . F  S O1=$O(GMP(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 ?2,GMP(O) W ?23,$P(GMP(O,O1),U),?69,$P(GMP(O,O1),U,2),! S LN1=0
"RTN","GMTSDGC2",24,0)
 Q
"RTN","GMTSDGC2",25,0)
ICDS(DFN,PTF) ; Module for history of PTF surgery episodes
"RTN","GMTSDGC2",26,0)
 Q:'$D(^DGPT(PTF,"S"))
"RTN","GMTSDGC2",27,0)
 N II,SURG,X,IX,GMS,GMA,O,O1,LN1
"RTN","GMTSDGC2",28,0)
 S II=0
"RTN","GMTSDGC2",29,0)
 F  S II=$O(^DGPT(PTF,"S",II)) Q:'II  S SURG=^DGPT(PTF,"S",II,0),X=$P(SURG,U,1),IX=9999999-X D REGDT4^GMTSU D
"RTN","GMTSDGC2",30,0)
 . ;   Load Surgery entries into GMS array in inverted sequence
"RTN","GMTSDGC2",31,0)
 . S GMS(IX)="  Surgery "_X F GMA=8:1:12 D
"RTN","GMTSDGC2",32,0)
 . . ;   Surgery Line
"RTN","GMTSDGC2",33,0)
 . . N ICDS,ICDI,ICDX
"RTN","GMTSDGC2",34,0)
 . . S ICDI=+($P(SURG,U,GMA)) Q:+ICDI'>0
"RTN","GMTSDGC2",35,0)
 . . S ICDX=$$ICDOP^ICDCODE(+ICDI)
"RTN","GMTSDGC2",36,0)
 . . S ICDS(80.1,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGC2",37,0)
 . . S ICDS(80.1,ICDI,4)=$P(ICDX,"^",5)
"RTN","GMTSDGC2",38,0)
 . . I $D(ICDS(80.1,ICDI)) S GMS(IX,GMA)=$E(ICDS(80.1,ICDI,4),1,45)_U_ICDS(80.1,ICDI,.01)
"RTN","GMTSDGC2",39,0)
 I $D(GMS) S O=0 F  S O=$O(GMS(O)) Q:O=""  D
"RTN","GMTSDGC2",40,0)
 . S O1=0,LN1=1
"RTN","GMTSDGC2",41,0)
 . F  S O1=$O(GMS(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 ?2,GMS(O) W ?23,$P(GMS(O,O1),U),?69,$P(GMS(O,O1),U,2),! S LN1=0
"RTN","GMTSDGC2",42,0)
 Q
"RTN","GMTSDGP")
0^6^B11105682
"RTN","GMTSDGP",1,0)
GMTSDGP ; SLC/TRS,KER/NDBI - PTF Surgeries/Procedures ; 03/24/2004 [4/1/04 2:55pm]
"RTN","GMTSDGP",2,0)
 ;;2.7;Health Summary;**28,49,60,71**;Oct 20, 1995
"RTN","GMTSDGP",3,0)
 ;                    
"RTN","GMTSDGP",4,0)
 ; External References
"RTN","GMTSDGP",5,0)
 ;   DBIA  3390  $$ICDOP^ICDCODE
"RTN","GMTSDGP",6,0)
 ;   DBIA  1372  ^DGPT(
"RTN","GMTSDGP",7,0)
 ;   DBIA  1372  ^DGPT("B"
"RTN","GMTSDGP",8,0)
 ;   DBIA  2929  OPC^A7RHSM
"RTN","GMTSDGP",9,0)
 ;   DBIA  2929  PRC^A7RHSM
"RTN","GMTSDGP",10,0)
 ;                    
"RTN","GMTSDGP",11,0)
ENS ; Module For History of PTF Surgery Episodes
"RTN","GMTSDGP",12,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGP",13,0)
 E  S CNTR=100
"RTN","GMTSDGP",14,0)
 S T1=GMTSEND,T2=GMTSBEG,GMCZ=0
"RTN","GMTSDGP",15,0)
 S PTF=0
"RTN","GMTSDGP",16,0)
 F  S PTF=$O(^DGPT("B",DFN,PTF)) Q:PTF=""  D ICDS
"RTN","GMTSDGP",17,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) OPC^A7RHSM
"RTN","GMTSDGP",18,0)
 I $D(GMS) S O=0 F I=1:1 S O=$O(GMS(O)) Q:O=""  Q:'CNTR  S CNTR=CNTR-1 S O1=0,LN1=1 F I=1:1 S O1=$O(GMS(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 GMS(O) W ?21,$P(GMS(O,O1),U),?68,$P(GMS(O,O1),U,2),! S LN1=0
"RTN","GMTSDGP",19,0)
 D KILLADM Q
"RTN","GMTSDGP",20,0)
ICDS ;   ICD Surgery
"RTN","GMTSDGP",21,0)
 N GMCZ,GMA,D0,DA,DR,DIC,II,IX,SURG,ZI Q:'$D(^DGPT(PTF,"S"))
"RTN","GMTSDGP",22,0)
 S II=0 F ZI=1:1 S II=$O(^DGPT(PTF,"S",II)) Q:'II  S SURG=^DGPT(PTF,"S",II,0),X=$P(SURG,U,1),IX=9999999-X I X>T2&(X<T1) D REGDT4^GMTSU D ICDS1
"RTN","GMTSDGP",23,0)
 Q
"RTN","GMTSDGP",24,0)
ICDS1 ;   Load Surgery entries into GMS array (inverted)
"RTN","GMTSDGP",25,0)
 S GMCZ=2 S GMS(IX)="  Surgery  "_X F GMA=8:1:12 D SGY
"RTN","GMTSDGP",26,0)
 Q
"RTN","GMTSDGP",27,0)
SGY ;   Surgery Line
"RTN","GMTSDGP",28,0)
 N ICDP,ICDI,ICDX
"RTN","GMTSDGP",29,0)
 S ICDI=+$P(SURG,U,GMA) Q:ICDI'>0
"RTN","GMTSDGP",30,0)
 S ICDX=$$ICDOP^ICDCODE(+ICDI)
"RTN","GMTSDGP",31,0)
 S ICDS(80.1,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGP",32,0)
 S ICDS(80.1,ICDI,4)=$P(ICDX,"^",5)
"RTN","GMTSDGP",33,0)
 I $D(ICDS(80.1,ICDI)) D
"RTN","GMTSDGP",34,0)
 . S GMS(IX,GMA)=$E($G(ICDS(80.1,ICDI,4)),1,45)_U_$G(ICDS(80.1,ICDI,.01))
"RTN","GMTSDGP",35,0)
 Q
"RTN","GMTSDGP",36,0)
 ;                    
"RTN","GMTSDGP",37,0)
ENP ; Module For History of PTF Procedures
"RTN","GMTSDGP",38,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGP",39,0)
 E  S CNTR=100
"RTN","GMTSDGP",40,0)
 S T1=GMTSEND,T2=GMTSBEG,GMCZ=0
"RTN","GMTSDGP",41,0)
 S PTF=0
"RTN","GMTSDGP",42,0)
 F  S PTF=$O(^DGPT("B",DFN,PTF)) Q:PTF=""  D ICDP
"RTN","GMTSDGP",43,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) PRC^A7RHSM
"RTN","GMTSDGP",44,0)
 I $D(GMP) S O=0 F I=1:1 S O=$O(GMP(O)) Q:O=""  Q:'CNTR  S CNTR=CNTR-1 S O1=0,LN1=1 F I=1:1 S O1=$O(GMP(O,O1)) Q:O1=""  D CKP^GMTSUP Q:$D(GMTSQIT)  S:GMTSNPG LN1=1 W:LN1 GMP(O) W ?21,$P(GMP(O,O1),U),?68,$P(GMP(O,O1),U,2),! S LN1=0
"RTN","GMTSDGP",45,0)
 D KILLADM Q
"RTN","GMTSDGP",46,0)
 Q
"RTN","GMTSDGP",47,0)
ICDP ;   ICD Procedures
"RTN","GMTSDGP",48,0)
 N D0,DA,DIC,DR,GMCZ,GTA,II,IX,PRX,ZI Q:'$D(^DGPT(PTF,"P"))
"RTN","GMTSDGP",49,0)
 S II=0 F ZI=1:1 S II=$O(^DGPT(PTF,"P",II)) Q:'II  S PRX=^DGPT(PTF,"P",II,0),X=$P(PRX,U,1),IX=9999999-X I X>T2&(X<T1) D REGDT4^GMTSU D ICDP1
"RTN","GMTSDGP",50,0)
 Q
"RTN","GMTSDGP",51,0)
ICDP1 ;   Load Procedure entries into GMP array (inverted)
"RTN","GMTSDGP",52,0)
 S GMCZ=2 S GMP(IX)="Procedure  "_X F GTA=5:1:9 D PXGY
"RTN","GMTSDGP",53,0)
 Q
"RTN","GMTSDGP",54,0)
PXGY ;   Procedure Line
"RTN","GMTSDGP",55,0)
 N ICDP,ICDI,ICDX
"RTN","GMTSDGP",56,0)
 S ICDI=+$P(PRX,U,GTA) Q:ICDI'>0
"RTN","GMTSDGP",57,0)
 S ICDX=$$ICDOP^ICDCODE(+ICDI)
"RTN","GMTSDGP",58,0)
 S ICDP(80.1,ICDI,.01)=$P(ICDX,"^",2)
"RTN","GMTSDGP",59,0)
 S ICDP(80.1,ICDI,4)=$P(ICDX,"^",5)
"RTN","GMTSDGP",60,0)
 I $D(ICDP(80.1,ICDI)) D
"RTN","GMTSDGP",61,0)
 . S GMP(IX,GTA)=$E($G(ICDP(80.1,ICDI,4)),1,45)_U_$G(ICDP(80.1,ICDI,.01))
"RTN","GMTSDGP",62,0)
 Q
"RTN","GMTSDGP",63,0)
 ;                    
"RTN","GMTSDGP",64,0)
KILLADM ; Kills Admission variables
"RTN","GMTSDGP",65,0)
 K CNTR,GMCZ,LN1,IX,X,ZA,N,ICD,ICD0,PTF,GMC,O,O1,GMS,T1,T2,SURG,SURGY,PRX,PRXY,DATE,D1,I,IMT,GMA,GTA,II,ZI,GMP
"RTN","GMTSDGP",66,0)
 K ICDP,ICDS
"RTN","GMTSDGP",67,0)
 Q
"RTN","GMTSPXU1")
0^4^B13346814
"RTN","GMTSPXU1",1,0)
GMTSPXU1 ; SLC/SBW - PCE Utilities sub-routines ; 03/24/2004 [8/24/04 8:28am]
"RTN","GMTSPXU1",2,0)
 ;;2.7;Health Summary;**10,37,71**;Oct 20, 1995
"RTN","GMTSPXU1",3,0)
 ;
"RTN","GMTSPXU1",4,0)
 ; External References
"RTN","GMTSPXU1",5,0)
 ;   DBIA  3390  $$ICDDX^ICDCODE
"RTN","GMTSPXU1",6,0)
 ;   DBIA  3390  $$ICDOP^ICDCODE
"RTN","GMTSPXU1",7,0)
 ;   DBIA  3390  $$ICDD^ICDCODE
"RTN","GMTSPXU1",8,0)
 ;   DBIA  1995  $$CPT^ICPTCOD
"RTN","GMTSPXU1",9,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSPXU1",10,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPXU1",11,0)
 ;                       
"RTN","GMTSPXU1",12,0)
GETICDDX(GMTSICD,GMTSICF,GMMOD) ; Entry point to get ICD9 data
"RTN","GMTSPXU1",13,0)
 N REC,CODE,NAME,DESC,ICDX,ICDI,ICDA
"RTN","GMTSPXU1",14,0)
 S GMTSICD=$G(GMTSICD),GMTSICF=$G(GMTSICF),GMMOD=$G(GMMOD)
"RTN","GMTSPXU1",15,0)
 S ICDX=$$ICDDX^ICDCODE(+GMTSICD)
"RTN","GMTSPXU1",16,0)
 S REC(80,GMTSICD,.01,"E")=$P(ICDX,"^",2)
"RTN","GMTSPXU1",17,0)
 S REC(80,GMTSICD,.01,"I")=$P(ICDX,"^",2)
"RTN","GMTSPXU1",18,0)
 S REC(80,GMTSICD,3,"E")=$P(ICDX,"^",4)
"RTN","GMTSPXU1",19,0)
 S REC(80,GMTSICD,3,"I")=$P(ICDX,"^",4)
"RTN","GMTSPXU1",20,0)
 S ICDI=$$ICDD^ICDCODE($P(ICDX,"^",2),"ICDA")
"RTN","GMTSPXU1",21,0)
 S REC(80,GMTSICD,10,"E")=$G(ICDA(1))
"RTN","GMTSPXU1",22,0)
 S REC(80,GMTSICD,10,"I")=$G(ICDA(1))
"RTN","GMTSPXU1",23,0)
 S CODE=REC(80,GMTSICD,.01,"I")
"RTN","GMTSPXU1",24,0)
 S NAME=REC(80,GMTSICD,3,"E")
"RTN","GMTSPXU1",25,0)
 S DESC=REC(80,GMTSICD,10,"E")
"RTN","GMTSPXU1",26,0)
 S:GMTSICF="L"!(GMTSICF="") GMTSICD=CODE_"-"_DESC
"RTN","GMTSPXU1",27,0)
 S:GMTSICF="S" GMTSICD=CODE_"-"_NAME
"RTN","GMTSPXU1",28,0)
 S:GMTSICF="C" GMTSICD=CODE
"RTN","GMTSPXU1",29,0)
 S:GMTSICF="T" GMTSICD=DESC
"RTN","GMTSPXU1",30,0)
 I $G(GMMOD)]"" S GMMOD=$P(GMMOD,","),GMTSICD=GMMOD_" "_GMTSICD
"RTN","GMTSPXU1",31,0)
 S:GMTSICF="N" GMTSICD=""
"RTN","GMTSPXU1",32,0)
 Q
"RTN","GMTSPXU1",33,0)
 ;
"RTN","GMTSPXU1",34,0)
GETICDOP(GMTSICD,GMTSICF,GMMOD) ; Entry point to get ICD0 data
"RTN","GMTSPXU1",35,0)
 S GMTSICD=$G(GMTSICD),GMTSICF=$G(GMTSICF),GMMOD=$G(GMMOD)
"RTN","GMTSPXU1",36,0)
 N REC,CODE,NAME,DESC,ICDX,ICDI,ICDA
"RTN","GMTSPXU1",37,0)
 S ICDX=$$ICDOP^ICDCODE(+GMTSICD)
"RTN","GMTSPXU1",38,0)
 S REC(80.1,GMTSICD,.01,"E")=$P(ICDX,"^",2)
"RTN","GMTSPXU1",39,0)
 S REC(80.1,GMTSICD,.01,"I")=$P(ICDX,"^",2)
"RTN","GMTSPXU1",40,0)
 S REC(80.1,GMTSICD,4,"E")=$P(ICDX,"^",5)
"RTN","GMTSPXU1",41,0)
 S REC(80.1,GMTSICD,4,"I")=$P(ICDX,"^",5)
"RTN","GMTSPXU1",42,0)
 S ICDI=$$ICDD^ICDCODE($P(ICDX,"^",2),"ICDA")
"RTN","GMTSPXU1",43,0)
 S REC(80.1,GMTSICD,10,"E")=$G(ICDA(1))
"RTN","GMTSPXU1",44,0)
 S REC(80.1,GMTSICD,10,"I")=$G(ICDA(1))
"RTN","GMTSPXU1",45,0)
 S CODE=REC(80.1,GMTSICD,.01,"I")
"RTN","GMTSPXU1",46,0)
 S NAME=REC(80.1,GMTSICD,4,"E")
"RTN","GMTSPXU1",47,0)
 S DESC=REC(80.1,GMTSICD,10,"E")
"RTN","GMTSPXU1",48,0)
 S:GMTSICF="L"!(GMTSICF="") GMTSICD=CODE_"-"_DESC
"RTN","GMTSPXU1",49,0)
 S:GMTSICF="S" GMTSICD=CODE_"-"_NAME
"RTN","GMTSPXU1",50,0)
 S:GMTSICF="C" GMTSICD=CODE
"RTN","GMTSPXU1",51,0)
 S:GMTSICF="T" GMTSICD=DESC
"RTN","GMTSPXU1",52,0)
 S:GMTSICF="N" GMTSICD=""
"RTN","GMTSPXU1",53,0)
 Q
"RTN","GMTSPXU1",54,0)
 ;
"RTN","GMTSPXU1",55,0)
GETCPT(GMTSCPT) ; Entry point to get CPT data
"RTN","GMTSPXU1",56,0)
 N ICPT S GMTSCPT=+($G(GMTSCPT)) Q:GMTSCPT=0 ""
"RTN","GMTSPXU1",57,0)
 S ICPT=$$CPT^ICPTCOD(+GMTSCPT),ICPT=$P(ICPT,"^",2)_"-"_$P(ICPT,"^",3)
"RTN","GMTSPXU1",58,0)
 Q ICPT
"RTN","GMTSPXU1",59,0)
 ;
"RTN","GMTSPXU1",60,0)
TXTFMT(GMTSICD,GMTSNARR,GMICL,GMTAB,DIWL,GMTSQTY,GMTSPRIM) ; Formats GMTSICD & GMTSNARR together
"RTN","GMTSPXU1",61,0)
 I GMTSICD="",GMTSNARR="" Q
"RTN","GMTSPXU1",62,0)
 N DIWR,DIWF,X
"RTN","GMTSPXU1",63,0)
 S DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXU1",64,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXU1",65,0)
 I $G(GMTSICD)]"" S X=GMTSICD S:$G(GMTSNARR)]"" X=X_"; "
"RTN","GMTSPXU1",66,0)
 I $G(GMTSNARR)]"" S X=$G(X)_GMTSNARR D
"RTN","GMTSPXU1",67,0)
 . I $G(GMTSPRIM)]"" S X=X_GMTSPRIM
"RTN","GMTSPXU1",68,0)
 . I $G(GMTSQTY)]"" S X=X_GMTSQTY
"RTN","GMTSPXU1",69,0)
 . D ^DIWP
"RTN","GMTSPXU1",70,0)
 I $G(GMTSNARR)']"" D
"RTN","GMTSPXU1",71,0)
 . I $G(GMTSQTY)]"" S X=$G(X)_GMTSQTY
"RTN","GMTSPXU1",72,0)
 . I $G(GMTSPRIM)]"" S X=X_GMTSPRIM
"RTN","GMTSPXU1",73,0)
 . D ^DIWP
"RTN","GMTSPXU1",74,0)
 Q
"RTN","GMTSPXU1",75,0)
 ;
"RTN","GMTSPXU1",76,0)
ORDERPRO(GMPROV,GMLEN) ; Re-order and format providers for visit
"RTN","GMTSPXU1",77,0)
 N GMCNT,GMTSP,GMNODE,GMP
"RTN","GMTSPXU1",78,0)
 S GMCNT=0
"RTN","GMTSPXU1",79,0)
 F GMP="P","S","Z" S GMTSP="" F  S GMTSP=$O(^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"P",GMP,GMTSP)) Q:GMTSP'>0  D
"RTN","GMTSPXU1",80,0)
 . S GMNODE=^TMP("PXHSV",$J,GMTSIVD,GMTSVDF,"P",GMP,GMTSP)
"RTN","GMTSPXU1",81,0)
 . Q:GMNODE']""
"RTN","GMTSPXU1",82,0)
 . S GMCNT=GMCNT+1
"RTN","GMTSPXU1",83,0)
 . S GMPROV(GMCNT)=$E($P(GMNODE,U),1,GMLEN-4)_$S(GMP="P"!(GMP="S"):" ("_GMP_")",1:"")
"RTN","GMTSPXU1",84,0)
 Q
"RTN","GMTSPXU1",85,0)
 ;                              
"RTN","GMTSPXU1",86,0)
 ; The following code segments are called from "ROUTINE" type
"RTN","GMTSPXU1",87,0)
 ; Menu Options to display items in a file
"RTN","GMTSPXU1",88,0)
 ;                           
"RTN","GMTSPXU1",89,0)
LM ;   Entry Point - for GMTS Measurement Panel
"RTN","GMTSPXU1",90,0)
 S GMTSLST="^GMT(142.7," G DSPLST
"RTN","GMTSPXU1",91,0)
 ;
"RTN","GMTSPXU1",92,0)
DSPLST ;   Common code for Health Summary MNX Lists
"RTN","GMTSPXU1",93,0)
 K DIR
"RTN","GMTSPXU1",94,0)
 I '$D(@(GMTSLST_"""B"")")) W !,"NO ",$P(@(GMTSLST_"0)"),U),"S DEFINED.",! Q
"RTN","GMTSPXU1",95,0)
 W @IOF,!!,"Existing ",$P(@(GMTSLST_"0)"),U),"S:",! S GMTSCNT=""
"RTN","GMTSPXU1",96,0)
CONT ;   Continue
"RTN","GMTSPXU1",97,0)
 F  S GMTSCNT=$O(@(GMTSLST_"""B"",GMTSCNT)")) Q:GMTSCNT=""  D  G:1'[$G(Y)&($L($G(Y))) QUIT
"RTN","GMTSPXU1",98,0)
 . N DIR K Y W !,?5,GMTSCNT I (IOSL-3)<$Y S DIR(0)="E" D
"RTN","GMTSPXU1",99,0)
 . . D ^DIR W @IOF
"RTN","GMTSPXU1",100,0)
 K DIR S DIR(0)="E" D ^DIR W !
"RTN","GMTSPXU1",101,0)
QUIT ;   Quit
"RTN","GMTSPXU1",102,0)
 K DIR,X,Y,GMTSLST,GMTSCNT
"RTN","GMTSPXU1",103,0)
 Q
"RTN","GMTSROE")
0^7^B55542130
"RTN","GMTSROE",1,0)
GMTSROE ; SLC/KER - Surgery Extract                   ; 06/24/2002 [7/28/04 8:40am]
"RTN","GMTSROE",2,0)
 ;;2.7;Health Summary;**37,57,71**;Oct 20, 1995
"RTN","GMTSROE",3,0)
 ;
"RTN","GMTSROE",4,0)
 ; External References
"RTN","GMTSROE",5,0)
 ;   DBIA   2491  ^SRF(  file #130
"RTN","GMTSROE",6,0)
 ;   DBIA  10103  $$HTFM^XLFDT
"RTN","GMTSROE",7,0)
 ;   DBIA  10015  EN^DIQ1
"RTN","GMTSROE",8,0)
 ;   DBIA   1996  $$CPT^ICPTCOD
"RTN","GMTSROE",9,0)
 ;   DBIA  10011  ^DIWP
"RTN","GMTSROE",10,0)
 ;   DBIA   2056  $$GET1^DIQ  (file #81.3)
"RTN","GMTSROE",11,0)
 ;   DBIA   2056  $$GET1^DIQ  (file #81)
"RTN","GMTSROE",12,0)
 ;   DBIA   2056  $$GET1^DIQ  (file #130)
"RTN","GMTSROE",13,0)
 ;   DBIA   2052  FILE^DID
"RTN","GMTSROE",14,0)
 ;                  
"RTN","GMTSROE",15,0)
 Q
"RTN","GMTSROE",16,0)
ONE(X) ; Extract One Surgery Report
"RTN","GMTSROE",17,0)
 K REC N GMTSCPTM,GMSG,DA,DR,DIC,DIQ,IEN,IENS,FILE,FLD,FLDS,FLDI
"RTN","GMTSROE",18,0)
 N FLDA,FLDB,FLDR,FLDRT,IEN,GMTSI,GMTSRT,GMTST,GMTSS,GMTSC,GMTSCS
"RTN","GMTSROE",19,0)
 S GMTSCPTM=+($$CPT^GMTSU(+($G(GMTSEGN)))) S:$G(GMPXCMOD)="N" GMTSCPTM=0
"RTN","GMTSROE",20,0)
 Q:'$D(^SRF(X,0))  S (IENS,IEN,X)=+($G(X)),U="^"
"RTN","GMTSROE",21,0)
 S:'$D(DT) DT=$$HTFM^XLFDT($H,1) S:'$D(DTIME) DTIME=300
"RTN","GMTSROE",22,0)
 S (FILE,DIC)=130,DA=+($G(X)),DIQ="REC(",DIQ(0)="IE"
"RTN","GMTSROE",23,0)
 S GMSG=$$SG(IEN),REC(130,IEN,118,"E")=$S(GMSG=0:"YES",1:""),REC(130,IEN,118,"I")=$S(GMSG=0:"Y",1:"")
"RTN","GMTSROE",24,0)
 S:+GMSG DR=".09;.04;.14;.205;.22;.23;.31;1.15;10;15;17;26;27;32;34;36;39;43;49"
"RTN","GMTSROE",25,0)
 S:'GMSG DR=".09;.31;26;27;33;55;59;66;1.15;121;122;123;124;125"
"RTN","GMTSROE",26,0)
 D EN^DIQ1 S REC(130,IEN,"STATUS")=$$OS(IEN) S:+GMSG REC(130,IEN,"VERIFIED")=$S($G(REC(130,IEN,43,"I"))'="Y":"(Unverified)",1:"")
"RTN","GMTSROE",27,0)
 S GMTSM=$G(REC(130,IEN,27,"I")) I GMTSM>0 D
"RTN","GMTSROE",28,0)
 . S GMTSC=$$CPT^ICPTCOD(GMTSM),(GMTSCS,GMTSS)=$$EN2^GMTSUMX($P(GMTSC,"^",3))
"RTN","GMTSROE",29,0)
 . S REC(130,IEN,27,"X")=$P(GMTSC,"^",2)_"^"_$P(GMTSC,"^",3)
"RTN","GMTSROE",30,0)
 . S GMTSC=$P(GMTSC,"^",2),GMTST=$$EN2^GMTSUMX($G(REC(130,IEN,26,"E")))
"RTN","GMTSROE",31,0)
 . S:$L(GMTSS)&(GMTSS'=GMTST) GMTST=GMTST_" - "_GMTSS
"RTN","GMTSROE",32,0)
 . S:$L(GMTSC)=5 GMTST=GMTST_" (CPT "_GMTSC_")",GMTSCS=GMTSCS_" (CPT "_GMTSC_")"
"RTN","GMTSROE",33,0)
 . S REC(130,IEN,27,"N")=GMTSS
"RTN","GMTSROE",34,0)
 . S (REC(130,IEN,26,"S"),REC(130,IEN,27,"S"))=GMTST
"RTN","GMTSROE",35,0)
 . S REC(130,IEN,27,"S")=GMTSCS
"RTN","GMTSROE",36,0)
 D SUB
"RTN","GMTSROE",37,0)
 S:$D(REC(130,IEN,32)) REC(130,IEN,32,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,32,"E")))
"RTN","GMTSROE",38,0)
 S:$D(REC(130,IEN,33)) REC(130,IEN,33,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,33,"E")))
"RTN","GMTSROE",39,0)
 S:$D(REC(130,IEN,34)) REC(130,IEN,34,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,34,"E")))
"RTN","GMTSROE",40,0)
 S:$D(REC(130,IEN,.04)) REC(130,IEN,.04,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,.04,"E")))
"RTN","GMTSROE",41,0)
 S:$D(REC(130,IEN,125)) REC(130,IEN,125,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,125,"E")))
"RTN","GMTSROE",42,0)
 I $L($G(REC(130,IEN,33,"S"))) D
"RTN","GMTSROE",43,0)
 . S:'$L($G(REC(130,IEN,66,"E"))) REC(130,IEN,33,"S")=$G(REC(130,IEN,33,"S"))_" (Unknown)"
"RTN","GMTSROE",44,0)
 . S:$L($G(REC(130,IEN,66,"E"))) REC(130,IEN,33,"S")=$G(REC(130,IEN,33,"S"))_" (ICD "_$G(REC(130,IEN,66,"E"))_")"
"RTN","GMTSROE",45,0)
 S:+($G(REC(130,IEN,.09,"I")))>0 REC(130,IEN,.09,"S")=$$ED^GMTSU($G(REC(130,IEN,.09,"I")))
"RTN","GMTSROE",46,0)
 S:+($G(REC(130,IEN,15,"I")))>0 REC(130,IEN,15,"S")=$$EDT^GMTSU($G(REC(130,IEN,15,"I")))
"RTN","GMTSROE",47,0)
 S:+($G(REC(130,IEN,39,"I"))) REC(130,IEN,39,"S")=$$EDT^GMTSU($G(REC(130,IEN,39,"I")))
"RTN","GMTSROE",48,0)
 S:+GMSG REC(130,IEN,"LAB")=$S($O(REC(130,IEN,49,0))>0:"Yes",1:"")
"RTN","GMTSROE",49,0)
 I 'GMSG D:+($O(REC(130,IEN,55,0)))>0 WP(IEN,55,58) D:+($O(REC(130,IEN,59,0)))>0 WP(IEN,59,58)
"RTN","GMTSROE",50,0)
 Q
"RTN","GMTSROE",51,0)
WP(X,Y,Z) ; Word Processing
"RTN","GMTSROE",52,0)
 N GMTSI,GMTSF,GMTSW,GMI,DIWF,DIWL,DIWR
"RTN","GMTSROE",53,0)
 S GMTSI=+($G(X)) Q:GMTSI=0!('$D(REC(130,GMTSI)))
"RTN","GMTSROE",54,0)
 S GMTSF=+($G(Y)) Q:GMTSF=0!('$D(REC(130,GMTSI,GMTSF)))
"RTN","GMTSROE",55,0)
 S GMTSW=+($G(Z)) Q:GMTSW'>0!(GMTSW>79)
"RTN","GMTSROE",56,0)
 Q:+($O(REC(130,GMTSI,GMTSF,0)))'>0
"RTN","GMTSROE",57,0)
 K ^UTILITY($J,"W") S DIWF="C"_GMTSW,DIWL=0,DIWR=0,GMI=0
"RTN","GMTSROE",58,0)
 F  S GMI=$O(REC(130,GMTSI,GMTSF,GMI)) Q:+GMI=0  D
"RTN","GMTSROE",59,0)
 . S X=$G(REC(130,GMTSI,GMTSF,GMI)) D ^DIWP
"RTN","GMTSROE",60,0)
 S GMI=0 F  S GMI=$O(^UTILITY($J,"W",0,GMI)) Q:+GMI=0  D
"RTN","GMTSROE",61,0)
 . S REC(130,GMTSI,GMTSF,"S",GMI)=$G(^UTILITY($J,"W",0,GMI,0))
"RTN","GMTSROE",62,0)
 . S REC(130,GMTSI,GMTSF,"S",0)=$G(REC(130,GMTSI,GMTSF,"S",0))+1
"RTN","GMTSROE",63,0)
 K ^UTILITY($J,"W")
"RTN","GMTSROE",64,0)
 Q
"RTN","GMTSROE",65,0)
OS(X) ; Obtains status for OR procedures
"RTN","GMTSROE",66,0)
 N GMN S GMN=+($G(X)) S X="" I $G(REC(130,GMN,118,"I"))="Y" D  Q X
"RTN","GMTSROE",67,0)
 . S:+($G(REC(130,GMN,122,"I")))>0 X="(Completed)"
"RTN","GMTSROE",68,0)
 . S:+($G(REC(130,GMN,121,"I")))>0&(+($G(REC(130,GMN,122,"I")))'>0) X="Incomplete"
"RTN","GMTSROE",69,0)
 . S:X="" X="Unknown"
"RTN","GMTSROE",70,0)
 I +($G(REC(130,GMN,17,"I")))>0 D  Q X
"RTN","GMTSROE",71,0)
 . S X=$S(+($G(REC(130,GMN,.205,"I")))>0:"(Aborted)",1:"Cancelled")
"RTN","GMTSROE",72,0)
 I +($G(REC(130,GMN,.23,"I")))>0 S X="(Completed)" Q X
"RTN","GMTSROE",73,0)
 I +($G(REC(130,GMN,.22,"I")))>0 S X="Incomplete" Q X
"RTN","GMTSROE",74,0)
 I +($G(REC(130,GMN,10,"I")))>0 S X="Scheduled" Q X
"RTN","GMTSROE",75,0)
 I +($G(REC(130,GMN,36,"I")))>0,+($G(REC(130,GMN,.22,"I")))'>0 S X="Requested" Q X
"RTN","GMTSROE",76,0)
 S X="Unknown"
"RTN","GMTSROE",77,0)
 Q X
"RTN","GMTSROE",78,0)
SUB ; Surgery Subfiles 
"RTN","GMTSROE",79,0)
 N DA,DR,DIC,DIQ,IENS,FILE,FLD,FLDS,FLDI,FLDA,FLDB,FLDR,FLDRT,GMTSM,GMTSC,GMTSI,GMTSJ,STXT,SNAM,SCOD,SUB
"RTN","GMTSROE",80,0)
 I +GMSG D
"RTN","GMTSROE",81,0)
 . ; ^SRF(DO,14,I)                .72
"RTN","GMTSROE",82,0)
 . ;   Other Preop Diagnosis      14;0  130.17
"RTN","GMTSROE",83,0)
 . ; $P(^SRF(DO,14,I,0),U)        .01
"RTN","GMTSROE",84,0)
 . ;   Other Preop Diagnosis       0;1  Text
"RTN","GMTSROE",85,0)
 . S DA=IEN,(FILE,DIC)=130,SUB=130.17,DR=.72,DR(SUB)=".01",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","GMTSROE",86,0)
 . K REC(SUB) S GMTSI=0 F  S GMTSI=$O(^SRF(+($G(IEN)),14,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSROE",87,0)
 . . S DA(SUB)=GMTSI D EN^DIQ1
"RTN","GMTSROE",88,0)
 . . S REC(130,IEN,130.17,GMTSI,.01,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,130.17,GMTSI,.01,"E")))
"RTN","GMTSROE",89,0)
 . ; ^SRF(DO,15,I)                .74
"RTN","GMTSROE",90,0)
 . ;   Other Postop Diagnosis     15;0  130.18
"RTN","GMTSROE",91,0)
 . ; $P(^SRF(DO,15,I,0),U)        .01
"RTN","GMTSROE",92,0)
 . ;   Other Postop Diagnosis      0;1  Text
"RTN","GMTSROE",93,0)
 . S DA=IEN,(FILE,DIC)=130,SUB=130.18,DR=.74,DR(SUB)=".01",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","GMTSROE",94,0)
 . K REC(SUB) S GMTSI=0 F  S GMTSI=$O(^SRF(+($G(IEN)),15,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSROE",95,0)
 . . S DA(SUB)=GMTSI D EN^DIQ1
"RTN","GMTSROE",96,0)
 . . S REC(130,IEN,130.18,GMTSI,.01,"S")=$$EN2^GMTSUMX($G(REC(130,IEN,130.18,GMTSI,.01,"E")))
"RTN","GMTSROE",97,0)
 ; ^SRF(GMN,"OPMOD",I)           28
"RTN","GMTSROE",98,0)
 ;   Primary Proc CPT Mod   OPMOD;0  130.028
"RTN","GMTSROE",99,0)
 ; $P(^SRF(GMN,"OPMOD",I,0),U)  .01
"RTN","GMTSROE",100,0)
 ;   Primary Proc CPT Mod       0;1  Ptr 81.3
"RTN","GMTSROE",101,0)
 I GMTSCPTM D
"RTN","GMTSROE",102,0)
 . S DA=IEN,(FILE,DIC)=130,SUB=130.028,DR=28,DR(SUB)=".01",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","GMTSROE",103,0)
 . K REC(SUB) S GMTSI=0 F  S GMTSI=$O(^SRF(+($G(IEN)),"OPMOD",GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSROE",104,0)
 . . S DA(SUB)=GMTSI D EN^DIQ1
"RTN","GMTSROE",105,0)
 . . S GMTSM=+($G(REC(130,+($G(IEN)),SUB,+($G(GMTSI)),.01,"I")))
"RTN","GMTSROE",106,0)
 . . I GMTSM>0 D
"RTN","GMTSROE",107,0)
 . . . N GMTSMOD S GMTSMOD=$$MOD^ICPTMOD(+GMTSM)
"RTN","GMTSROE",108,0)
 . . . S GMTSC=$P(GMTSMOD,"^",2)
"RTN","GMTSROE",109,0)
 . . . S GMTSS=$P(GMTSMOD,"^",3)
"RTN","GMTSROE",110,0)
 . . . S REC(130,IEN,SUB,GMTSI,.01,"MID")=GMTSC
"RTN","GMTSROE",111,0)
 . . . S REC(130,IEN,SUB,GMTSI,.01,"MOD")=GMTSS
"RTN","GMTSROE",112,0)
 . . . S GMTST=$$EN2^GMTSUMX(GMTSS)
"RTN","GMTSROE",113,0)
 . . . S:$L(GMTSC) GMTST=GMTST_" (CPT Mod "_GMTSC_")"
"RTN","GMTSROE",114,0)
 . . . S REC(130,IEN,SUB,GMTSI,.01,"S")=GMTST
"RTN","GMTSROE",115,0)
 ; ^SRF(DO,13,I)                .42
"RTN","GMTSROE",116,0)
 ;   Other Proc                13;0  130.16
"RTN","GMTSROE",117,0)
 ; $P(^SRF(DO,13,I,0),U)        .01
"RTN","GMTSROE",118,0)
 ;   Other Proc                 0;1  Text      
"RTN","GMTSROE",119,0)
 ; $P(^SRF(DO,13,I,2),U)          3
"RTN","GMTSROE",120,0)
 ;   Other Proc CPT Code        2;1  Ptr 81
"RTN","GMTSROE",121,0)
 S DA=IEN,(FILE,DIC)=130,SUB=130.16,DR=.42,DR(SUB)=".01;3",DIQ="REC(130,"_IEN_",",DIQ(0)="IE"
"RTN","GMTSROE",122,0)
 K REC(SUB) S GMTSI=0 F  S GMTSI=$O(^SRF(+($G(IEN)),13,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSROE",123,0)
 . N GMTSCPT S DA(SUB)=GMTSI
"RTN","GMTSROE",124,0)
 . D EN^DIQ1 S GMTSM=+($G(REC(130,IEN,130.16,GMTSI,3,"I")))
"RTN","GMTSROE",125,0)
 . S GMTSCPT=$$CPT^ICPTCOD(+GMTSM)
"RTN","GMTSROE",126,0)
 . S:GMTSM>0 REC(130,IEN,130.16,GMTSI,3,"N")=$P(GMTSCPT,"^",3)
"RTN","GMTSROE",127,0)
 . N GMTST,GMTSS,GMTSC S GMTSM=$G(REC(130,IEN,130.16,GMTSI,3,"I")) I GMTSM>0 D
"RTN","GMTSROE",128,0)
 . . S GMTSC=$$CPT^ICPTCOD(GMTSM),(GMTSCS,GMTSS)=$$EN2^GMTSUMX($P(GMTSC,"^",3))
"RTN","GMTSROE",129,0)
 . . S REC(130,IEN,130.16,GMTSI,3,"X")=$P(GMTSC,"^",2)_"^"_$P(GMTSC,"^",3)
"RTN","GMTSROE",130,0)
 . . S GMTSC=$P(GMTSC,"^",2)
"RTN","GMTSROE",131,0)
 . . S GMTST=$$EN2^GMTSUMX($G(REC(130,IEN,130.16,GMTSI,.01,"E")))
"RTN","GMTSROE",132,0)
 . . S:$L(GMTSS)&(GMTSS'=GMTST) GMTST=GMTST_" - "_$$EN2^GMTSUMX(GMTSS)
"RTN","GMTSROE",133,0)
 . . S:$L(GMTSC)=5 GMTST=GMTST_" (CPT "_GMTSC_")",GMTSCS=GMTSCS_" (CPT "_GMTSC_")"
"RTN","GMTSROE",134,0)
 . . S REC(130,IEN,130.16,GMTSI,3,"N")=GMTSS
"RTN","GMTSROE",135,0)
 . . S REC(130,IEN,130.16,GMTSI,.01,"S")=GMTST
"RTN","GMTSROE",136,0)
 . . S REC(130,IEN,130.16,GMTSI,3,"S")=GMTSCS
"RTN","GMTSROE",137,0)
 . ;     ^SRF(8,13,2,"MOD",0)       4
"RTN","GMTSROE",138,0)
 . ;       Oth Proc CPT Mod     MOD;0  130.164
"RTN","GMTSROE",139,0)
 . ;     ^SRF(8,13,2,"MOD",1,0)   .01
"RTN","GMTSROE",140,0)
 . ;       Oth Proc CPT Mod       0;1  Ptr 81.3
"RTN","GMTSROE",141,0)
 . I GMTSCPTM D
"RTN","GMTSROE",142,0)
 . . N GMTSJ S GMTSJ=0 F  S GMTSJ=$O(^SRF(+($G(IEN)),13,GMTSI,"MOD",GMTSJ)) Q:+GMTSJ=0  D
"RTN","GMTSROE",143,0)
 . . . N DA,FILE,DIC,SUB,DR,DIQ S DA=IEN,DR=.42,FILE=130,SUB=130.16,DR(SUB)="4",DA(SUB)=GMTSI,SUB=130.164,DR(SUB)=".01",DA(SUB)=GMTSJ,DIC=130,DIQ="REC(130,"_IEN_",130.16,"_GMTSI_",",DIQ(0)="IE"
"RTN","GMTSROE",144,0)
 . . . D EN^DIQ1
"RTN","GMTSROE",145,0)
 . . . S GMTSM=+($G(REC(130,IEN,130.16,GMTSI,130.164,GMTSJ,.01,"I")))
"RTN","GMTSROE",146,0)
 . . . I GMTSM>0 D
"RTN","GMTSROE",147,0)
 . . . . N GMTSMOD S GMTSMOD=$$MOD^ICPTMOD(+GMTSM)
"RTN","GMTSROE",148,0)
 . . . . S GMTSC=$P(GMTSMOD,"^",2)
"RTN","GMTSROE",149,0)
 . . . . S GMTSS=$P(GMTSMOD,"^",3)
"RTN","GMTSROE",150,0)
 . . . . S REC(130,IEN,130.16,GMTSI,SUB,GMTSJ,.01,"MID")=GMTSC
"RTN","GMTSROE",151,0)
 . . . . S REC(130,IEN,130.16,GMTSI,SUB,GMTSJ,.01,"MOD")=GMTSS
"RTN","GMTSROE",152,0)
 . . . . S REC(130,IEN,130.16,GMTSI,SUB,GMTSJ,.01,"X")=GMTSC_"^"_GMTSS
"RTN","GMTSROE",153,0)
 . . . . S GMTST=$$EN2^GMTSUMX(GMTSS) S:$L(GMTSC) GMTST=GMTST_" (CPT Mod "_GMTSC_")"
"RTN","GMTSROE",154,0)
 . . . . S REC(130,IEN,130.16,GMTSI,SUB,GMTSJ,.01,"S")=GMTST
"RTN","GMTSROE",155,0)
 . . . K REC(130,IEN,130.16,GMTSI,130)
"RTN","GMTSROE",156,0)
 Q
"RTN","GMTSROE",157,0)
SORT ; Sort surgeries by inverted date
"RTN","GMTSROE",158,0)
 N GMDT S GMDT=$P(^SRF(GMN,0),U,9) I GMDT>GMTSBEG&(GMDT<GMTSEND) D
"RTN","GMTSROE",159,0)
 . F  Q:'$D(SURG(9999999-GMDT))  S GMDT=GMDT+.0001
"RTN","GMTSROE",160,0)
 . S SURG(9999999-GMDT)=GMN
"RTN","GMTSROE",161,0)
 Q
"RTN","GMTSROE",162,0)
GL(X) ; Global Location
"RTN","GMTSROE",163,0)
 N FIL D FILE^DID(130,"N","GLOBAL NAME","FIL","FIL(""ERR"")") S X=$G(FIL("GLOBAL NAME"))
"RTN","GMTSROE",164,0)
 S:$E(X,1)'="^"!($E(X,2,$L(X))["^")!($L($E(X,2,$L(X)))<2)!($L($E(X,2,$L(X)))>8)!($E(X,2,$L(X))'["(") X=""
"RTN","GMTSROE",165,0)
 I $L(X) S:'$D(@($P(X,"(",1))) X=""
"RTN","GMTSROE",166,0)
 Q X
"RTN","GMTSROE",167,0)
SG(X) ; Surgical (Operative) Record
"RTN","GMTSROE",168,0)
 S X=$$GET1^DIQ(130,+($G(X)),118,"I") S X=$S(X["Y":0,1:1) Q X
"VER")
8.0^22.0
**END**
**END**
