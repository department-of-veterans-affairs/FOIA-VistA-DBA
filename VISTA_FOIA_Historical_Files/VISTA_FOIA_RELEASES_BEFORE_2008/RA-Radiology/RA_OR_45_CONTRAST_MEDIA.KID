KIDS Distribution saved on Apr 05, 2005@10:05:06
latest version of the multi-build adressing order check issues
**KIDS**:RA_OR_CONTRAST MEDIA 1.0^OR*3.0*211^RA*5.0*45^

**INSTALL NAME**
RA_OR_CONTRAST MEDIA 1.0
"BLD",5376,0)
RA_OR_CONTRAST MEDIA 1.0^^1^3050405^y
"BLD",5376,1,0)
^^7^7^3050128^^
"BLD",5376,1,1,0)
This patch consists of two patches that work together; in order of 
"BLD",5376,1,2,0)
install, they are:
"BLD",5376,1,3,0)
   OR*3.0*211
"BLD",5376,1,4,0)
   RA*5.0*45
"BLD",5376,1,5,0)
 
"BLD",5376,1,6,0)
Please refer to the patch description of RA*5.0*45 in FORUM
"BLD",5376,1,7,0)
regarding the installation of 'RA_OR_CONTRAST MEDIA 1.0'.
"BLD",5376,10,0)
^9.63^2^2
"BLD",5376,10,1,0)
OR*3.0*211^1
"BLD",5376,10,2,0)
RA*5.0*45^1
"BLD",5376,10,"B","OR*3.0*211",1)

"BLD",5376,10,"B","RA*5.0*45",2)

"BLD",5376,"KRN",0)
^9.67PA^8989.52^19
"BLD",5376,"KRN",.4,0)
.4
"BLD",5376,"KRN",.401,0)
.401
"BLD",5376,"KRN",.402,0)
.402
"BLD",5376,"KRN",.403,0)
.403
"BLD",5376,"KRN",.5,0)
.5
"BLD",5376,"KRN",.84,0)
.84
"BLD",5376,"KRN",3.6,0)
3.6
"BLD",5376,"KRN",3.8,0)
3.8
"BLD",5376,"KRN",9.2,0)
9.2
"BLD",5376,"KRN",9.8,0)
9.8
"BLD",5376,"KRN",19,0)
19
"BLD",5376,"KRN",19.1,0)
19.1
"BLD",5376,"KRN",101,0)
101
"BLD",5376,"KRN",409.61,0)
409.61
"BLD",5376,"KRN",771,0)
771
"BLD",5376,"KRN",870,0)
870
"BLD",5376,"KRN",8989.51,0)
8989.51
"BLD",5376,"KRN",8989.52,0)
8989.52
"BLD",5376,"KRN",8994,0)
8994
"BLD",5376,"KRN","B",.4,.4)

"BLD",5376,"KRN","B",.401,.401)

"BLD",5376,"KRN","B",.402,.402)

"BLD",5376,"KRN","B",.403,.403)

"BLD",5376,"KRN","B",.5,.5)

"BLD",5376,"KRN","B",.84,.84)

"BLD",5376,"KRN","B",3.6,3.6)

"BLD",5376,"KRN","B",3.8,3.8)

"BLD",5376,"KRN","B",9.2,9.2)

"BLD",5376,"KRN","B",9.8,9.8)

"BLD",5376,"KRN","B",19,19)

"BLD",5376,"KRN","B",19.1,19.1)

"BLD",5376,"KRN","B",101,101)

"BLD",5376,"KRN","B",409.61,409.61)

"BLD",5376,"KRN","B",771,771)

"BLD",5376,"KRN","B",870,870)

"BLD",5376,"KRN","B",8989.51,8989.51)

"BLD",5376,"KRN","B",8989.52,8989.52)

"BLD",5376,"KRN","B",8994,8994)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22
**INSTALL NAME**
OR*3.0*211
"BLD",5375,0)
OR*3.0*211^ORDER ENTRY/RESULTS REPORTING^0^3050405^y
"BLD",5375,4,0)
^9.64PA^101.43^1
"BLD",5375,4,101.43,0)
101.43
"BLD",5375,4,101.43,2,0)
^9.641^101.43^1
"BLD",5375,4,101.43,2,101.43,0)
ORDERABLE ITEMS  (File-top level)
"BLD",5375,4,101.43,2,101.43,1,0)
^9.6411^71.1^1
"BLD",5375,4,101.43,2,101.43,1,71.1,0)
CONTRAST MEDIA
"BLD",5375,4,101.43,222)
y^n^p^^^^n^^n
"BLD",5375,4,101.43,224)

"BLD",5375,4,"APDD",101.43,101.43)

"BLD",5375,4,"APDD",101.43,101.43,71.1)

"BLD",5375,4,"B",101.43,101.43)

"BLD",5375,"ABPKG")
n
"BLD",5375,"INID")
^n
"BLD",5375,"INIT")
ORY211ES
"BLD",5375,"KRN",0)
^9.67PA^8989.52^19
"BLD",5375,"KRN",.4,0)
.4
"BLD",5375,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5375,"KRN",.401,0)
.401
"BLD",5375,"KRN",.402,0)
.402
"BLD",5375,"KRN",.403,0)
.403
"BLD",5375,"KRN",.5,0)
.5
"BLD",5375,"KRN",.84,0)
.84
"BLD",5375,"KRN",3.6,0)
3.6
"BLD",5375,"KRN",3.8,0)
3.8
"BLD",5375,"KRN",9.2,0)
9.2
"BLD",5375,"KRN",9.8,0)
9.8
"BLD",5375,"KRN",9.8,"NM",0)
^9.68A^14^14
"BLD",5375,"KRN",9.8,"NM",1,0)
ORY2110^^0^B15649558
"BLD",5375,"KRN",9.8,"NM",2,0)
ORY21101^^0^B71483541
"BLD",5375,"KRN",9.8,"NM",3,0)
ORY21102^^0^B77921019
"BLD",5375,"KRN",9.8,"NM",4,0)
ORY21103^^0^B82140148
"BLD",5375,"KRN",9.8,"NM",5,0)
ORY21104^^0^B76434439
"BLD",5375,"KRN",9.8,"NM",6,0)
ORY21105^^0^B57814848
"BLD",5375,"KRN",9.8,"NM",7,0)
ORY21106^^0^B68575871
"BLD",5375,"KRN",9.8,"NM",8,0)
ORY21107^^0^B65528220
"BLD",5375,"KRN",9.8,"NM",9,0)
ORY21108^^0^B62474513
"BLD",5375,"KRN",9.8,"NM",10,0)
ORY2111^^0^B40557571
"BLD",5375,"KRN",9.8,"NM",11,0)
ORY2112^^0^B26766060
"BLD",5375,"KRN",9.8,"NM",12,0)
ORY2113^^0^B12993982
"BLD",5375,"KRN",9.8,"NM",13,0)
ORY2114^^0^B13523737
"BLD",5375,"KRN",9.8,"NM",14,0)
ORY211ES^^0^B12630975
"BLD",5375,"KRN",9.8,"NM","B","ORY2110",1)

"BLD",5375,"KRN",9.8,"NM","B","ORY21101",2)

"BLD",5375,"KRN",9.8,"NM","B","ORY21102",3)

"BLD",5375,"KRN",9.8,"NM","B","ORY21103",4)

"BLD",5375,"KRN",9.8,"NM","B","ORY21104",5)

"BLD",5375,"KRN",9.8,"NM","B","ORY21105",6)

"BLD",5375,"KRN",9.8,"NM","B","ORY21106",7)

"BLD",5375,"KRN",9.8,"NM","B","ORY21107",8)

"BLD",5375,"KRN",9.8,"NM","B","ORY21108",9)

"BLD",5375,"KRN",9.8,"NM","B","ORY2111",10)

"BLD",5375,"KRN",9.8,"NM","B","ORY2112",11)

"BLD",5375,"KRN",9.8,"NM","B","ORY2113",12)

"BLD",5375,"KRN",9.8,"NM","B","ORY2114",13)

"BLD",5375,"KRN",9.8,"NM","B","ORY211ES",14)

"BLD",5375,"KRN",19,0)
19
"BLD",5375,"KRN",19,"NM",0)
^9.68A^^
"BLD",5375,"KRN",19.1,0)
19.1
"BLD",5375,"KRN",101,0)
101
"BLD",5375,"KRN",409.61,0)
409.61
"BLD",5375,"KRN",771,0)
771
"BLD",5375,"KRN",870,0)
870
"BLD",5375,"KRN",8989.51,0)
8989.51
"BLD",5375,"KRN",8989.52,0)
8989.52
"BLD",5375,"KRN",8994,0)
8994
"BLD",5375,"KRN","B",.4,.4)

"BLD",5375,"KRN","B",.401,.401)

"BLD",5375,"KRN","B",.402,.402)

"BLD",5375,"KRN","B",.403,.403)

"BLD",5375,"KRN","B",.5,.5)

"BLD",5375,"KRN","B",.84,.84)

"BLD",5375,"KRN","B",3.6,3.6)

"BLD",5375,"KRN","B",3.8,3.8)

"BLD",5375,"KRN","B",9.2,9.2)

"BLD",5375,"KRN","B",9.8,9.8)

"BLD",5375,"KRN","B",19,19)

"BLD",5375,"KRN","B",19.1,19.1)

"BLD",5375,"KRN","B",101,101)

"BLD",5375,"KRN","B",409.61,409.61)

"BLD",5375,"KRN","B",771,771)

"BLD",5375,"KRN","B",870,870)

"BLD",5375,"KRN","B",8989.51,8989.51)

"BLD",5375,"KRN","B",8989.52,8989.52)

"BLD",5375,"KRN","B",8994,8994)

"BLD",5375,"QUES",0)
^9.62^^
"BLD",5375,"REQB",0)
^9.611^1^1
"BLD",5375,"REQB",1,0)
OR*3.0*190^2
"BLD",5375,"REQB","B","OR*3.0*190",1)

"FIA",101.43)
ORDERABLE ITEMS
"FIA",101.43,0)
^ORD(101.43,
"FIA",101.43,0,0)
101.43
"FIA",101.43,0,1)
y^n^p^^^^n^^n
"FIA",101.43,0,10)

"FIA",101.43,0,11)

"FIA",101.43,0,"RLRO")

"FIA",101.43,0,"VR")
3.0^OR
"FIA",101.43,101.43)
1
"FIA",101.43,101.43,71.1)

"INIT")
ORY211ES
"MBREQ")
1
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
211^3050405^1866
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","ORY2110")
0^1^B15649558
"RTN","ORY2110",1,0)
ORY2110 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY2110",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY2110",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY2110",4,0)
 ;
"RTN","ORY2110",5,0)
S ;
"RTN","ORY2110",6,0)
 ;
"RTN","ORY2110",7,0)
 Q
"RTN","ORY2110",8,0)
 ;
"RTN","ORY2110",9,0)
WARN(RTN,MSG,LINES) ;
"RTN","ORY2110",10,0)
 ;
"RTN","ORY2110",11,0)
 Q:$G(OCXAUTO)
"RTN","ORY2110",12,0)
 ;
"RTN","ORY2110",13,0)
 N DASH,LINE,NLINE,PLINE
"RTN","ORY2110",14,0)
 ;
"RTN","ORY2110",15,0)
 S DASH="",$P(DASH,"-",(55-$L(MSG)-2))="-"
"RTN","ORY2110",16,0)
 W !!,"--------------",MSG,DASH
"RTN","ORY2110",17,0)
 ;
"RTN","ORY2110",18,0)
 W !,RTN,?10,"[DEVCUR.FO-SLC.MED.VA.GOV] -> [",$$NETNAME^OCXSEND,"] Line"
"RTN","ORY2110",19,0)
 ;
"RTN","ORY2110",20,0)
 I $O(LINES($O(LINES(0)))) W "s: "
"RTN","ORY2110",21,0)
 E  W ": "
"RTN","ORY2110",22,0)
 ;
"RTN","ORY2110",23,0)
 S LINE=0 F  S LINE=$O(LINES(LINE)) Q:'LINE  D
"RTN","ORY2110",24,0)
 .W:($X>60) !,?40
"RTN","ORY2110",25,0)
 .S NLINE=LINE F  S PLINE=NLINE,NLINE=$O(LINES(NLINE)) Q:(NLINE-PLINE-1)
"RTN","ORY2110",26,0)
 .I (PLINE=LINE) W " ",LINE
"RTN","ORY2110",27,0)
 .E  W " ",LINE,"-",PLINE S LINE=PLINE
"RTN","ORY2110",28,0)
 ;
"RTN","ORY2110",29,0)
 W ! Q
"RTN","ORY2110",30,0)
 ;
"RTN","ORY2110",31,0)
TEXT(RTN,LINE) ;
"RTN","ORY2110",32,0)
 ;
"RTN","ORY2110",33,0)
 N TEXT X "S TEXT=$T(+"_(+LINE)_"^"_RTN_")" Q TEXT
"RTN","ORY2110",34,0)
 ;
"RTN","ORY2110",35,0)
HEADER ;
"RTN","ORY2110",36,0)
 ;
"RTN","ORY2110",37,0)
 W !," Created: APR 5,2005 at 08:07  at  DEVCUR.FO-SLC.MED.VA.GOV"
"RTN","ORY2110",38,0)
 W !," Current Date: ",$$NOW,"  at  ",$$NETNAME^OCXSEND,!!
"RTN","ORY2110",39,0)
 S LASTFILE=0 K ^TMP("OCXRULE",$J)
"RTN","ORY2110",40,0)
 S ^TMP("OCXRULE",$J)=($P($H,",",2)+($H*86400)+(1*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","ORY2110",41,0)
 Q
"RTN","ORY2110",42,0)
 ;
"RTN","ORY2110",43,0)
GETFILE(FILE,RECNAME,ARRAY) ;
"RTN","ORY2110",44,0)
 ;
"RTN","ORY2110",45,0)
 N CHECK,GLNEXT,GLREF,LINES,REC,DD,FLD
"RTN","ORY2110",46,0)
 S REC=$$LOOKUP(FILE,RECNAME)
"RTN","ORY2110",47,0)
 I 'REC W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME Q 0
"RTN","ORY2110",48,0)
 I (REC=-1) W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME,"  duplicate local entries.",! Q 0
"RTN","ORY2110",49,0)
 I (REC=-2) W !!,$$FILENAME^OCXSENDD(FILE)," (",FILE,") local file not found." W ! Q:$$PAUSE -10 Q REC
"RTN","ORY2110",50,0)
 I (REC<0) W !!,$$FILENAME^OCXSENDD(FILE),": ",RECNAME,"  unknown lookup error." W ! Q:$$PAUSE -10 Q REC
"RTN","ORY2110",51,0)
 I (REC>0) D
"RTN","ORY2110",52,0)
 .S CHECK=0,LINES=0
"RTN","ORY2110",53,0)
 .D GETREC($$FILE^OCXSENDD(FILE,"GLOBAL NAME"),"ARRAY(",REC,.ARRAY)
"RTN","ORY2110",54,0)
 .S GLREF="ARRAY" F  S GLREF=$Q(@GLREF) Q:'$L(GLREF)  Q:'($E(GLREF,1,6)="ARRAY(")  K:'$L(@GLREF) @GLREF
"RTN","ORY2110",55,0)
 ;
"RTN","ORY2110",56,0)
 Q REC
"RTN","ORY2110",57,0)
 ;
"RTN","ORY2110",58,0)
LKUPARRY(DD,KEY,ARRAY) ;
"RTN","ORY2110",59,0)
 ;
"RTN","ORY2110",60,0)
 N D0 S D0=0 F  S D0=$O(ARRAY(DD,D0)) Q:'D0  Q:($G(ARRAY(DD,D0,.01,"E"))=KEY)
"RTN","ORY2110",61,0)
 Q D0
"RTN","ORY2110",62,0)
 ;
"RTN","ORY2110",63,0)
LOOKUP(FILE,KEY) ;
"RTN","ORY2110",64,0)
 I $O(^TMP("OCXRULE",$J,"B",FILE,KEY,0)) Q 0
"RTN","ORY2110",65,0)
 N RECNAM,REC,D0,CNT,SHORT S (REC,CNT)=0
"RTN","ORY2110",66,0)
 S GL=$$FILE^OCXSENDD(FILE,"GLOBAL NAME") Q:'$L(GL) -2 S GL=$E(GL,1,$L(GL)-1)_")"
"RTN","ORY2110",67,0)
 S SHORT=$E(KEY,1,30),RECNAM=SHORT D  F  S RECNAM=$O(@GL@("B",RECNAM)) Q:'$L(RECNAM)  Q:'($E(RECNAM,1,$L(SHORT))=SHORT)  D
"RTN","ORY2110",68,0)
 .S D0=0 F  S D0=$O(@GL@("B",RECNAM,D0)) Q:'D0  I ($P($G(@GL@(D0,0)),U,1)=KEY) S CNT=CNT+1,REC=D0_U_RECNAME
"RTN","ORY2110",69,0)
 Q:(CNT>1) -1
"RTN","ORY2110",70,0)
 S:$L($P(REC,U,2)) ^TMP("OCXRULE",$J,"A",FILE,$P(REC,U,2))=""
"RTN","ORY2110",71,0)
 Q +REC
"RTN","ORY2110",72,0)
 ;
"RTN","ORY2110",73,0)
GETREC(GL,PATH,D0,REM) ;
"RTN","ORY2110",74,0)
 ;
"RTN","ORY2110",75,0)
 Q:'($P($G(@(GL_"0)")),U,2))
"RTN","ORY2110",76,0)
 N S1,DATA,DD
"RTN","ORY2110",77,0)
 S DATA="" D DIQ(GL,D0,.DATA)
"RTN","ORY2110",78,0)
 S DD=$O(DATA(0)) Q:'DD
"RTN","ORY2110",79,0)
 ;
"RTN","ORY2110",80,0)
 I $L($$FILE^OCXSENDD(DD,"NAME")) S PATH=PATH_""""_DD_":"_D0_""""
"RTN","ORY2110",81,0)
 I '$L($$FILE^OCXSENDD(DD,"NAME")) S PATH=PATH_","""_DD_":"_D0_""""
"RTN","ORY2110",82,0)
 M @(PATH_")")=DATA(DD,D0)
"RTN","ORY2110",83,0)
 ;
"RTN","ORY2110",84,0)
 S S1="" F  S S1=$O(@(GL_D0_","_$$SUB(S1)_")")) Q:'$L(S1)  I ($D(@(GL_D0_","_$$SUB(S1)_")"))>3) D
"RTN","ORY2110",85,0)
 .N D1,GLREF S GLREF=GL_D0_","_$$SUB(S1)_","
"RTN","ORY2110",86,0)
 .S D1=0 F  S D1=$O(@(GLREF_D1_")")) Q:'D1  D GETREC(GLREF,PATH,D1,.REM)
"RTN","ORY2110",87,0)
 ;
"RTN","ORY2110",88,0)
 Q
"RTN","ORY2110",89,0)
 ;
"RTN","ORY2110",90,0)
SUB(X) Q:'(X=+X) """"_X_"""" Q X
"RTN","ORY2110",91,0)
 ;
"RTN","ORY2110",92,0)
DIQ(DIC,DA,OCXARY) ;
"RTN","ORY2110",93,0)
 N DR,DIQ S DR=".01:99999",DIQ="OCXARY(",DIQ(0)="EN" D EN^DIQ1
"RTN","ORY2110",94,0)
 Q
"RTN","ORY2110",95,0)
 ;
"RTN","ORY2110",96,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY2110",97,0)
 ;
"RTN","ORY2110",98,0)
NOW() N X,Y,%DT S X="N",%DT="T" D ^%DT S Y=$$DATE^OCXSENDD(Y) S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2) Q Y
"RTN","ORY2110",99,0)
 ;
"RTN","ORY21101")
0^2^B71483541
"RTN","ORY21101",1,0)
ORY21101 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY21101",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY21101",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY21101",4,0)
 ;
"RTN","ORY21101",5,0)
S ;
"RTN","ORY21101",6,0)
 ;
"RTN","ORY21101",7,0)
 D DOT^ORY211ES
"RTN","ORY21101",8,0)
 ;
"RTN","ORY21101",9,0)
 ;
"RTN","ORY21101",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY21101",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY21101",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY21101",13,0)
 ;
"RTN","ORY21101",14,0)
 G ^ORY21102
"RTN","ORY21101",15,0)
 ;
"RTN","ORY21101",16,0)
 Q
"RTN","ORY21101",17,0)
 ;
"RTN","ORY21101",18,0)
DATA ;
"RTN","ORY21101",19,0)
 ;
"RTN","ORY21101",20,0)
 ;;ROOT^OCXS(860.2,0)^ORDER CHECK RULE^860.2I
"RTN","ORY21101",21,0)
 ;;ROOT^OCXS(860.3,0)^ORDER CHECK ELEMENT^860.3
"RTN","ORY21101",22,0)
 ;;ROOT^OCXS(860.4,0)^ORDER CHECK DATA FIELD^860.4I
"RTN","ORY21101",23,0)
 ;;ROOT^OCXS(860.5,0)^ORDER CHECK DATA SOURCE^860.5
"RTN","ORY21101",24,0)
 ;;ROOT^OCXS(860.6,0)^ORDER CHECK DATA CONTEXT^860.6
"RTN","ORY21101",25,0)
 ;;ROOT^OCXS(860.8,0)^ORDER CHECK COMPILER FUNCTIONS^860.8
"RTN","ORY21101",26,0)
 ;;ROOT^OCXS(860.9,0)^ORDER CHECK NATIONAL TERM^860.9
"RTN","ORY21101",27,0)
 ;;ROOT^OCXS(863,0)^OCX MDD CLASS^863
"RTN","ORY21101",28,0)
 ;;ROOT^OCXS(863.1,0)^OCX MDD APPLICATION^863.1
"RTN","ORY21101",29,0)
 ;;ROOT^OCXS(863.2,0)^OCX MDD SUBJECT^863.2
"RTN","ORY21101",30,0)
 ;;ROOT^OCXS(863.3,0)^OCX MDD LINK^863.3I
"RTN","ORY21101",31,0)
 ;;ROOT^OCXS(863.4,0)^OCX MDD ATTRIBUTE^863.4
"RTN","ORY21101",32,0)
 ;;ROOT^OCXS(863.5,0)^OCX MDD VALUES^863.5
"RTN","ORY21101",33,0)
 ;;ROOT^OCXS(863.6,0)^OCX MDD METHOD^863.6
"RTN","ORY21101",34,0)
 ;;ROOT^OCXS(863.7,0)^OCX MDD PUBLIC FUNCTION^863.7
"RTN","ORY21101",35,0)
 ;;ROOT^OCXS(863.8,0)^OCX MDD PARAMETER^863.8
"RTN","ORY21101",36,0)
 ;;ROOT^OCXS(863.9,0)^OCX MDD CONDITION/FUNCTION^863.9I
"RTN","ORY21101",37,0)
 ;;ROOT^OCXS(864,0)^OCX MDD SITE PREFERENCES^864P
"RTN","ORY21101",38,0)
 ;;ROOT^OCXS(864.1,0)^OCX MDD DATATYPE^864.1
"RTN","ORY21101",39,0)
 ;;ROOT^OCXD(860.1,0)^ORDER CHECK PATIENT ACTIVE DATA^860.1P
"RTN","ORY21101",40,0)
 ;;ROOT^OCXD(860.7,0)^ORDER CHECK PATIENT RULE EVENT^860.7P
"RTN","ORY21101",41,0)
 ;;ROOT^OCXD(861,0)^ORDER CHECK RAW DATA LOG^861
"RTN","ORY21101",42,0)
 ;;SOF^863.8  OCX MDD PARAMETER
"RTN","ORY21101",43,0)
 ;;KEY^863.8:^COMPARISON VALUE
"RTN","ORY21101",44,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",45,0)
 ;;D^COMPARISON VALUE
"RTN","ORY21101",46,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",47,0)
 ;;D^CVAL
"RTN","ORY21101",48,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",49,0)
 ;;D^ 
"RTN","ORY21101",50,0)
 ;;R^"863.8:",1,2
"RTN","ORY21101",51,0)
 ;;D^   This is a value to be compared with PRIMARY DATA FIELD
"RTN","ORY21101",52,0)
 ;;R^"863.8:",1,3
"RTN","ORY21101",53,0)
 ;;D^ in a truth conditional.
"RTN","ORY21101",54,0)
 ;;R^"863.8:",1,4
"RTN","ORY21101",55,0)
 ;;D^ 
"RTN","ORY21101",56,0)
 ;;EOR^
"RTN","ORY21101",57,0)
 ;;KEY^863.8:^DATA TYPE
"RTN","ORY21101",58,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",59,0)
 ;;D^DATA TYPE
"RTN","ORY21101",60,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",61,0)
 ;;D^DATA TYPE
"RTN","ORY21101",62,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",63,0)
 ;;D^An MDD data type; i.e., an entry in the OCX MDD DATA TYPE file.
"RTN","ORY21101",64,0)
 ;;R^"863.8:","863.84:6",.01,"E"
"RTN","ORY21101",65,0)
 ;;D^QUERY
"RTN","ORY21101",66,0)
 ;;R^"863.8:","863.84:6",1,"E"
"RTN","ORY21101",67,0)
 ;;D^Enter the datatype
"RTN","ORY21101",68,0)
 ;;R^"863.8:","863.84:7",.01,"E"
"RTN","ORY21101",69,0)
 ;;D^DIC
"RTN","ORY21101",70,0)
 ;;R^"863.8:","863.84:7",1,"E"
"RTN","ORY21101",71,0)
 ;;D^864.1
"RTN","ORY21101",72,0)
 ;;R^"863.8:","863.84:8",.01,"E"
"RTN","ORY21101",73,0)
 ;;D^DATA TYPE
"RTN","ORY21101",74,0)
 ;;R^"863.8:","863.84:8",1,"E"
"RTN","ORY21101",75,0)
 ;;D^POINTER TO A FILEMAN FILE
"RTN","ORY21101",76,0)
 ;;R^"863.8:","863.84:9",.01,"E"
"RTN","ORY21101",77,0)
 ;;D^DIC LOOKUP INDEX STRING
"RTN","ORY21101",78,0)
 ;;R^"863.8:","863.84:9",1,"E"
"RTN","ORY21101",79,0)
 ;;D^B^C
"RTN","ORY21101",80,0)
 ;;EOR^
"RTN","ORY21101",81,0)
 ;;KEY^863.8:^DIC
"RTN","ORY21101",82,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",83,0)
 ;;D^DIC
"RTN","ORY21101",84,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",85,0)
 ;;D^DIC
"RTN","ORY21101",86,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",87,0)
 ;;D^An open reference used to specify the file in a DIC lookup
"RTN","ORY21101",88,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY21101",89,0)
 ;;D^DATA TYPE
"RTN","ORY21101",90,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY21101",91,0)
 ;;D^POINTER TO A FILEMAN FILE
"RTN","ORY21101",92,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY21101",93,0)
 ;;D^DIC
"RTN","ORY21101",94,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY21101",95,0)
 ;;D^1
"RTN","ORY21101",96,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY21101",97,0)
 ;;D^QUERY
"RTN","ORY21101",98,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY21101",99,0)
 ;;D^Enter the name of the file you are pointing to
"RTN","ORY21101",100,0)
 ;;EOR^
"RTN","ORY21101",101,0)
 ;;KEY^863.8:^DIC LOOKUP INDEX STRING
"RTN","ORY21101",102,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",103,0)
 ;;D^DIC LOOKUP INDEX STRING
"RTN","ORY21101",104,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",105,0)
 ;;D^DICIX
"RTN","ORY21101",106,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",107,0)
 ;;D^Contains the names of indices to be used in a DIC lookup in a comma
"RTN","ORY21101",108,0)
 ;;R^"863.8:",1,2
"RTN","ORY21101",109,0)
 ;;D^delimited string.
"RTN","ORY21101",110,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY21101",111,0)
 ;;D^DATA TYPE
"RTN","ORY21101",112,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY21101",113,0)
 ;;D^FREE TEXT
"RTN","ORY21101",114,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY21101",115,0)
 ;;D^QUERY
"RTN","ORY21101",116,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY21101",117,0)
 ;;D^Enter a DIC lookup index string
"RTN","ORY21101",118,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY21101",119,0)
 ;;D^HELP MESSAGE
"RTN","ORY21101",120,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY21101",121,0)
 ;;D^This is an '^' delimited string which contains the names of indices which are to be used in a DIC lookup; e.g., B^C^DOB.
"RTN","ORY21101",122,0)
 ;;EOR^
"RTN","ORY21101",123,0)
 ;;KEY^863.8:^FILE
"RTN","ORY21101",124,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",125,0)
 ;;D^FILE
"RTN","ORY21101",126,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",127,0)
 ;;D^FILE
"RTN","ORY21101",128,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",129,0)
 ;;D^The internal entry number of a file.
"RTN","ORY21101",130,0)
 ;;R^"863.8:","863.84:6",.01,"E"
"RTN","ORY21101",131,0)
 ;;D^QUERY
"RTN","ORY21101",132,0)
 ;;R^"863.8:","863.84:6",1,"E"
"RTN","ORY21101",133,0)
 ;;D^File
"RTN","ORY21101",134,0)
 ;;R^"863.8:","863.84:7",.01,"E"
"RTN","ORY21101",135,0)
 ;;D^DATA TYPE
"RTN","ORY21101",136,0)
 ;;R^"863.8:","863.84:7",1,"E"
"RTN","ORY21101",137,0)
 ;;D^POINTER TO A FILEMAN FILE
"RTN","ORY21101",138,0)
 ;;R^"863.8:","863.84:8",.01,"E"
"RTN","ORY21101",139,0)
 ;;D^DIC
"RTN","ORY21101",140,0)
 ;;R^"863.8:","863.84:8",1,"E"
"RTN","ORY21101",141,0)
 ;;D^1
"RTN","ORY21101",142,0)
 ;;EOR^
"RTN","ORY21101",143,0)
 ;;KEY^863.8:^FM MASK
"RTN","ORY21101",144,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",145,0)
 ;;D^FM MASK
"RTN","ORY21101",146,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",147,0)
 ;;D^FM MASK
"RTN","ORY21101",148,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",149,0)
 ;;D^Tag^routine where code is located to parse the FM DD and override the parameter value
"RTN","ORY21101",150,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY21101",151,0)
 ;;D^QUERY
"RTN","ORY21101",152,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY21101",153,0)
 ;;D^Enter tag^routine where the FM MASK parser is located
"RTN","ORY21101",154,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY21101",155,0)
 ;;D^DATA TYPE
"RTN","ORY21101",156,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY21101",157,0)
 ;;D^LINE TAG
"RTN","ORY21101",158,0)
 ;;EOR^
"RTN","ORY21101",159,0)
 ;;KEY^863.8:^FREE TEXT MAXIMUM LENGTH
"RTN","ORY21101",160,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",161,0)
 ;;D^FREE TEXT MAXIMUM LENGTH
"RTN","ORY21101",162,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",163,0)
 ;;D^FMAX
"RTN","ORY21101",164,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",165,0)
 ;;D^Maximum string length allowed
"RTN","ORY21101",166,0)
 ;;R^"863.8:",2,"E"
"RTN","ORY21101",167,0)
 ;;D^245
"RTN","ORY21101",168,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY21101",169,0)
 ;;D^QUERY
"RTN","ORY21101",170,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY21101",171,0)
 ;;D^Maximum text string length allowed
"RTN","ORY21101",172,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY21101",173,0)
 ;;D^FM MASK
"RTN","ORY21101",174,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY21101",175,0)
 ;;D^FMAX^OCXF6
"RTN","ORY21101",176,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY21101",177,0)
 ;;D^DATA TYPE
"RTN","ORY21101",178,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY21101",179,0)
 ;;D^POSITIVE INTEGER
"RTN","ORY21101",180,0)
 ;;EOR^
"RTN","ORY21101",181,0)
 ;;KEY^863.8:^HELP MESSAGE
"RTN","ORY21101",182,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",183,0)
 ;;D^HELP MESSAGE
"RTN","ORY21101",184,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",185,0)
 ;;D^HELP
"RTN","ORY21101",186,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",187,0)
 ;;D^A text string 1-250 characters long which overrides the Fileman help
"RTN","ORY21101",188,0)
 ;;R^"863.8:",1,2
"RTN","ORY21101",189,0)
 ;;D^message.
"RTN","ORY21101",190,0)
 ;;R^"863.8:","863.84:10",.01,"E"
"RTN","ORY21101",191,0)
 ;;D^QUERY
"RTN","ORY21101",192,0)
 ;;R^"863.8:","863.84:10",1,"E"
"RTN","ORY21101",193,0)
 ;;D^Enter a brief help message
"RTN","ORY21101",194,0)
 ;;R^"863.8:","863.84:8",.01,"E"
"RTN","ORY21101",195,0)
 ;;D^DATA TYPE
"RTN","ORY21101",196,0)
 ;;R^"863.8:","863.84:8",1,"E"
"RTN","ORY21101",197,0)
 ;;D^FREE TEXT
"RTN","ORY21101",198,0)
 ;;R^"863.8:","863.84:9",.01,"E"
"RTN","ORY21101",199,0)
 ;;D^FM MASK
"RTN","ORY21101",200,0)
 ;;R^"863.8:","863.84:9",1,"E"
"RTN","ORY21101",201,0)
 ;;D^HELP^OCXF6
"RTN","ORY21101",202,0)
 ;;EOR^
"RTN","ORY21101",203,0)
 ;;KEY^863.8:^LOOP QUERY
"RTN","ORY21101",204,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",205,0)
 ;;D^LOOP QUERY
"RTN","ORY21101",206,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",207,0)
 ;;D^LOOP QUERY
"RTN","ORY21101",208,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",209,0)
 ;;D^Alternate query used when repeated answers are required
"RTN","ORY21101",210,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY21101",211,0)
 ;;D^DATA TYPE
"RTN","ORY21101",212,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY21101",213,0)
 ;;D^FREE TEXT
"RTN","ORY21101",214,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY21101",215,0)
 ;;D^QUERY
"RTN","ORY21101",216,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY21101",217,0)
 ;;D^Enter loop query text
"RTN","ORY21101",218,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY21101",219,0)
 ;;D^HELP MESSAGE
"RTN","ORY21101",220,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY21101",221,0)
 ;;D^This is the query text for all entries after the first one
"RTN","ORY21101",222,0)
 ;;EOR^
"RTN","ORY21101",223,0)
 ;;KEY^863.8:^MANDATORY MESSAGE
"RTN","ORY21101",224,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",225,0)
 ;;D^MANDATORY MESSAGE
"RTN","ORY21101",226,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",227,0)
 ;;D^MAND MSG
"RTN","ORY21101",228,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",229,0)
 ;;D^Message sent to user telling him that his entry is mandatory
"RTN","ORY21101",230,0)
 ;;R^"863.8:",2,"E"
"RTN","ORY21101",231,0)
 ;;D^Mandatory answer.  You must enter a value or '^' to exit.
"RTN","ORY21101",232,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY21101",233,0)
 ;;D^QUERY
"RTN","ORY21101",234,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY21101",235,0)
 ;;D^Enter message
"RTN","ORY21101",236,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY21101",237,0)
 ;;D^DATA TYPE
"RTN","ORY21101",238,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY21101",239,0)
 ;;D^FREE TEXT
"RTN","ORY21101",240,0)
 ;;EOR^
"RTN","ORY21101",241,0)
 ;;KEY^863.8:^OCXO DATA DRIVE SOURCE
"RTN","ORY21101",242,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",243,0)
 ;;D^OCXO DATA DRIVE SOURCE
"RTN","ORY21101",244,0)
 ;;EOR^
"RTN","ORY21101",245,0)
 ;;KEY^863.8:^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY21101",246,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",247,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY21101",248,0)
 ;;EOR^
"RTN","ORY21101",249,0)
 ;;KEY^863.8:^OCXO FILE POINTER
"RTN","ORY21101",250,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",251,0)
 ;;D^OCXO FILE POINTER
"RTN","ORY21101",252,0)
 ;;EOR^
"RTN","ORY21101",253,0)
 ;;KEY^863.8:^OCXO GENERATE CODE FUNCTION
"RTN","ORY21101",254,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",255,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY21101",256,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",257,0)
 ;;D^GEN
"RTN","ORY21101",258,0)
 ;;EOR^
"RTN","ORY21101",259,0)
 ;;KEY^863.8:^OCXO HL7 SEGMENT ID
"RTN","ORY21101",260,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",261,0)
 ;;D^OCXO HL7 SEGMENT ID
"RTN","ORY21101",262,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",263,0)
 ;;D^HL7SEGID
"RTN","ORY21101",264,0)
 ;;EOR^
"RTN","ORY21101",265,0)
 ;;KEY^863.8:^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY21101",266,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",267,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY21101",268,0)
 ;;EOR^
"RTN","ORY21101",269,0)
 ;;KEY^863.8:^OCXO VARIABLE NAME
"RTN","ORY21101",270,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",271,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY21101",272,0)
 ;;EOR^
"RTN","ORY21101",273,0)
 ;;KEY^863.8:^OCXO VT-BAR PIECE NUMBER
"RTN","ORY21101",274,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",275,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY21101",276,0)
 ;;EOR^
"RTN","ORY21101",277,0)
 ;;KEY^863.8:^PRIMARY DATA FIELD
"RTN","ORY21101",278,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21101",279,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY21101",280,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21101",281,0)
 ;;D^PDFLD
"RTN","ORY21101",282,0)
 ;;R^"863.8:",1,1
"RTN","ORY21101",283,0)
 ;;D^ 
"RTN","ORY21101",284,0)
 ;;R^"863.8:",1,2
"RTN","ORY21101",285,0)
 ;1;
"RTN","ORY21101",286,0)
 ;
"RTN","ORY21102")
0^3^B77921019
"RTN","ORY21102",1,0)
ORY21102 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY21102",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY21102",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY21102",4,0)
 ;
"RTN","ORY21102",5,0)
S ;
"RTN","ORY21102",6,0)
 ;
"RTN","ORY21102",7,0)
 D DOT^ORY211ES
"RTN","ORY21102",8,0)
 ;
"RTN","ORY21102",9,0)
 ;
"RTN","ORY21102",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY21102",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY21102",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY21102",13,0)
 ;
"RTN","ORY21102",14,0)
 G ^ORY21103
"RTN","ORY21102",15,0)
 ;
"RTN","ORY21102",16,0)
 Q
"RTN","ORY21102",17,0)
 ;
"RTN","ORY21102",18,0)
DATA ;
"RTN","ORY21102",19,0)
 ;
"RTN","ORY21102",20,0)
 ;;D^  Primary data field in a comparison expression that
"RTN","ORY21102",21,0)
 ;;R^"863.8:",1,3
"RTN","ORY21102",22,0)
 ;;D^ is to be tested.
"RTN","ORY21102",23,0)
 ;;R^"863.8:",1,4
"RTN","ORY21102",24,0)
 ;;D^ 
"RTN","ORY21102",25,0)
 ;;EOR^
"RTN","ORY21102",26,0)
 ;;KEY^863.8:^QUERY
"RTN","ORY21102",27,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21102",28,0)
 ;;D^QUERY
"RTN","ORY21102",29,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21102",30,0)
 ;;D^QUERY
"RTN","ORY21102",31,0)
 ;;R^"863.8:",1,1
"RTN","ORY21102",32,0)
 ;;D^Used with methods that manage interactive dialogues.  Equivalent to DIC("A")
"RTN","ORY21102",33,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY21102",34,0)
 ;;D^DATA TYPE
"RTN","ORY21102",35,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY21102",36,0)
 ;;D^FREE TEXT
"RTN","ORY21102",37,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY21102",38,0)
 ;;D^QUERY
"RTN","ORY21102",39,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY21102",40,0)
 ;;D^Enter the query (free text string)
"RTN","ORY21102",41,0)
 ;;EOR^
"RTN","ORY21102",42,0)
 ;;KEY^863.8:^REPEAT THE QUERY
"RTN","ORY21102",43,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21102",44,0)
 ;;D^REPEAT THE QUERY
"RTN","ORY21102",45,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21102",46,0)
 ;;D^LOOP
"RTN","ORY21102",47,0)
 ;;R^"863.8:",1,1
"RTN","ORY21102",48,0)
 ;;D^Set this = 1 to repetitively ask the user to enter a value
"RTN","ORY21102",49,0)
 ;;R^"863.8:","863.84:1",.01,"E"
"RTN","ORY21102",50,0)
 ;;D^DATA TYPE
"RTN","ORY21102",51,0)
 ;;R^"863.8:","863.84:1",1,"E"
"RTN","ORY21102",52,0)
 ;;D^YES NO
"RTN","ORY21102",53,0)
 ;;R^"863.8:","863.84:2",.01,"E"
"RTN","ORY21102",54,0)
 ;;D^HELP MESSAGE
"RTN","ORY21102",55,0)
 ;;R^"863.8:","863.84:2",1,"E"
"RTN","ORY21102",56,0)
 ;;D^Answer 'YES' if you want the user to repetitively enter a value.
"RTN","ORY21102",57,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY21102",58,0)
 ;;D^QUERY
"RTN","ORY21102",59,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY21102",60,0)
 ;;D^Is the query repetitive
"RTN","ORY21102",61,0)
 ;;EOR^
"RTN","ORY21102",62,0)
 ;;KEY^863.8:^TERMINATOR
"RTN","ORY21102",63,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21102",64,0)
 ;;D^TERMINATOR
"RTN","ORY21102",65,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21102",66,0)
 ;;D^TERMINATOR
"RTN","ORY21102",67,0)
 ;;R^"863.8:",1,1
"RTN","ORY21102",68,0)
 ;;D^A text string terminator; e.g., '?', ': ', '=>'
"RTN","ORY21102",69,0)
 ;;R^"863.8:",2,"E"
"RTN","ORY21102",70,0)
 ;;D^:
"RTN","ORY21102",71,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY21102",72,0)
 ;;D^QUERY
"RTN","ORY21102",73,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY21102",74,0)
 ;;D^Enter text string terminator
"RTN","ORY21102",75,0)
 ;;R^"863.8:","863.84:5",.01,"E"
"RTN","ORY21102",76,0)
 ;;D^DATA TYPE
"RTN","ORY21102",77,0)
 ;;R^"863.8:","863.84:5",1,"E"
"RTN","ORY21102",78,0)
 ;;D^FREE TEXT
"RTN","ORY21102",79,0)
 ;;R^"863.8:","863.84:6",.01,"E"
"RTN","ORY21102",80,0)
 ;;D^FREE TEXT MAXIMUM LENGTH
"RTN","ORY21102",81,0)
 ;;R^"863.8:","863.84:6",1,"E"
"RTN","ORY21102",82,0)
 ;;D^9
"RTN","ORY21102",83,0)
 ;;EOR^
"RTN","ORY21102",84,0)
 ;;KEY^863.8:^VALUE CALL
"RTN","ORY21102",85,0)
 ;;R^"863.8:",.01,"E"
"RTN","ORY21102",86,0)
 ;;D^VALUE CALL
"RTN","ORY21102",87,0)
 ;;R^"863.8:",.02,"E"
"RTN","ORY21102",88,0)
 ;;D^VAL CALL
"RTN","ORY21102",89,0)
 ;;R^"863.8:",.03,"E"
"RTN","ORY21102",90,0)
 ;;D^NO
"RTN","ORY21102",91,0)
 ;;R^"863.8:",1,1
"RTN","ORY21102",92,0)
 ;;D^tag^routine which manages the dialogue for collecting and validating a value
"RTN","ORY21102",93,0)
 ;;R^"863.8:","863.84:3",.01,"E"
"RTN","ORY21102",94,0)
 ;;D^QUERY
"RTN","ORY21102",95,0)
 ;;R^"863.8:","863.84:3",1,"E"
"RTN","ORY21102",96,0)
 ;;D^Enter tag^routine
"RTN","ORY21102",97,0)
 ;;R^"863.8:","863.84:4",.01,"E"
"RTN","ORY21102",98,0)
 ;;D^DATA TYPE
"RTN","ORY21102",99,0)
 ;;R^"863.8:","863.84:4",1,"E"
"RTN","ORY21102",100,0)
 ;;D^LINE TAG
"RTN","ORY21102",101,0)
 ;;EOR^
"RTN","ORY21102",102,0)
 ;;EOF^OCXS(863.8)^1
"RTN","ORY21102",103,0)
 ;;SOF^864.1  OCX MDD DATATYPE
"RTN","ORY21102",104,0)
 ;;KEY^864.1:^BOOLEAN
"RTN","ORY21102",105,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY21102",106,0)
 ;;D^BOOLEAN
"RTN","ORY21102",107,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY21102",108,0)
 ;;D^BOOL
"RTN","ORY21102",109,0)
 ;;EOR^
"RTN","ORY21102",110,0)
 ;;KEY^864.1:^FREE TEXT
"RTN","ORY21102",111,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY21102",112,0)
 ;;D^FREE TEXT
"RTN","ORY21102",113,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY21102",114,0)
 ;;D^FT
"RTN","ORY21102",115,0)
 ;;R^"864.1:",2,"E"
"RTN","ORY21102",116,0)
 ;;D^GENERIC
"RTN","ORY21102",117,0)
 ;;R^"864.1:","864.11:1",.01,"E"
"RTN","ORY21102",118,0)
 ;;D^VALUE CALL
"RTN","ORY21102",119,0)
 ;;R^"864.1:","864.11:1",1,"E"
"RTN","ORY21102",120,0)
 ;;D^FT^OCXFDFT
"RTN","ORY21102",121,0)
 ;;R^"864.1:","864.11:2",.01,"E"
"RTN","ORY21102",122,0)
 ;;D^QUERY
"RTN","ORY21102",123,0)
 ;;R^"864.1:","864.11:2",1,"E"
"RTN","ORY21102",124,0)
 ;;D^Enter a free text string
"RTN","ORY21102",125,0)
 ;;R^"864.1:","864.11:3",.01,"E"
"RTN","ORY21102",126,0)
 ;;D^FREE TEXT MAXIMUM LENGTH
"RTN","ORY21102",127,0)
 ;;R^"864.1:","864.11:3",1,"E"
"RTN","ORY21102",128,0)
 ;;D^240
"RTN","ORY21102",129,0)
 ;;R^"864.1:","864.11:4",.01,"E"
"RTN","ORY21102",130,0)
 ;;D^HELP MESSAGE
"RTN","ORY21102",131,0)
 ;;R^"864.1:","864.11:4",1,"E"
"RTN","ORY21102",132,0)
 ;;D^Enter a free text string.  Do not use control characters.  |FTMM HELP|
"RTN","ORY21102",133,0)
 ;;R^"864.1:","864.11:5",.01,"E"
"RTN","ORY21102",134,0)
 ;;D^LOOP QUERY
"RTN","ORY21102",135,0)
 ;;R^"864.1:","864.11:5",1,"E"
"RTN","ORY21102",136,0)
 ;;D^Enter another free text string
"RTN","ORY21102",137,0)
 ;;R^"864.1:","864.11:6",.01,"E"
"RTN","ORY21102",138,0)
 ;;D^REPEAT THE QUERY
"RTN","ORY21102",139,0)
 ;;R^"864.1:","864.11:6",1,"E"
"RTN","ORY21102",140,0)
 ;;D^0
"RTN","ORY21102",141,0)
 ;;EOR^
"RTN","ORY21102",142,0)
 ;;KEY^864.1:^GENERIC
"RTN","ORY21102",143,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY21102",144,0)
 ;;D^GENERIC
"RTN","ORY21102",145,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY21102",146,0)
 ;;D^GENERIC
"RTN","ORY21102",147,0)
 ;;R^"864.1:","864.11:11",.01,"E"
"RTN","ORY21102",148,0)
 ;;D^MANDATORY MESSAGE
"RTN","ORY21102",149,0)
 ;;R^"864.1:","864.11:11",1,"E"
"RTN","ORY21102",150,0)
 ;;D^This answer is mandatory.  Enter a response or press '^' to exit.
"RTN","ORY21102",151,0)
 ;;R^"864.1:","864.11:12",.01,"E"
"RTN","ORY21102",152,0)
 ;;D^TERMINATOR
"RTN","ORY21102",153,0)
 ;;R^"864.1:","864.11:12",1,"E"
"RTN","ORY21102",154,0)
 ;;D^:
"RTN","ORY21102",155,0)
 ;;R^"864.1:","864.11:13",.01,"E"
"RTN","ORY21102",156,0)
 ;;D^LOOP QUERY
"RTN","ORY21102",157,0)
 ;;R^"864.1:","864.11:13",1,"E"
"RTN","ORY21102",158,0)
 ;;D^Enter another value
"RTN","ORY21102",159,0)
 ;;R^"864.1:","864.11:7",.01,"E"
"RTN","ORY21102",160,0)
 ;;D^VALUE CALL
"RTN","ORY21102",161,0)
 ;;R^"864.1:","864.11:7",1,"E"
"RTN","ORY21102",162,0)
 ;;D^GEN^OCXFDMOM
"RTN","ORY21102",163,0)
 ;;R^"864.1:","864.11:8",.01,"E"
"RTN","ORY21102",164,0)
 ;;D^QUERY
"RTN","ORY21102",165,0)
 ;;R^"864.1:","864.11:8",1,"E"
"RTN","ORY21102",166,0)
 ;;D^Enter a value
"RTN","ORY21102",167,0)
 ;;R^"864.1:","864.11:9",.01,"E"
"RTN","ORY21102",168,0)
 ;;D^HELP MESSAGE
"RTN","ORY21102",169,0)
 ;;R^"864.1:","864.11:9",1,"E"
"RTN","ORY21102",170,0)
 ;;D^ 
"RTN","ORY21102",171,0)
 ;;EOR^
"RTN","ORY21102",172,0)
 ;;KEY^864.1:^NUMERIC
"RTN","ORY21102",173,0)
 ;;R^"864.1:",.01,"E"
"RTN","ORY21102",174,0)
 ;;D^NUMERIC
"RTN","ORY21102",175,0)
 ;;R^"864.1:",.02,"E"
"RTN","ORY21102",176,0)
 ;;D^NUMERIC
"RTN","ORY21102",177,0)
 ;;R^"864.1:",2,"E"
"RTN","ORY21102",178,0)
 ;;D^GENERIC
"RTN","ORY21102",179,0)
 ;;R^"864.1:","864.11:1",.01,"E"
"RTN","ORY21102",180,0)
 ;;D^VALUE CALL
"RTN","ORY21102",181,0)
 ;;R^"864.1:","864.11:1",1,"E"
"RTN","ORY21102",182,0)
 ;;D^NU^OCXFDNU
"RTN","ORY21102",183,0)
 ;;R^"864.1:","864.11:2",.01,"E"
"RTN","ORY21102",184,0)
 ;;D^QUERY
"RTN","ORY21102",185,0)
 ;;R^"864.1:","864.11:2",1,"E"
"RTN","ORY21102",186,0)
 ;;D^Enter a number
"RTN","ORY21102",187,0)
 ;;R^"864.1:","864.11:3",.01,"E"
"RTN","ORY21102",188,0)
 ;;D^LOOP QUERY
"RTN","ORY21102",189,0)
 ;;R^"864.1:","864.11:3",1,"E"
"RTN","ORY21102",190,0)
 ;;D^Enter another number
"RTN","ORY21102",191,0)
 ;;R^"864.1:","864.11:4",.01,"E"
"RTN","ORY21102",192,0)
 ;;D^REPEAT THE QUERY
"RTN","ORY21102",193,0)
 ;;R^"864.1:","864.11:4",1,"E"
"RTN","ORY21102",194,0)
 ;;D^0
"RTN","ORY21102",195,0)
 ;;EOR^
"RTN","ORY21102",196,0)
 ;;EOF^OCXS(864.1)^1
"RTN","ORY21102",197,0)
 ;;SOF^863.7  OCX MDD PUBLIC FUNCTION
"RTN","ORY21102",198,0)
 ;;KEY^863.7:^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY21102",199,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY21102",200,0)
 ;;D^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY21102",201,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY21102",202,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY21102",203,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY21102",204,0)
 ;;D^FALSE^OCXF23
"RTN","ORY21102",205,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY21102",206,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY21102",207,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY21102",208,0)
 ;;D^1
"RTN","ORY21102",209,0)
 ;;EOR^
"RTN","ORY21102",210,0)
 ;;KEY^863.7:^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY21102",211,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY21102",212,0)
 ;;D^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY21102",213,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY21102",214,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY21102",215,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY21102",216,0)
 ;;D^TRUE^OCXF23
"RTN","ORY21102",217,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY21102",218,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY21102",219,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY21102",220,0)
 ;;D^1
"RTN","ORY21102",221,0)
 ;;EOR^
"RTN","ORY21102",222,0)
 ;;KEY^863.7:^GCC FREE TEXT CONTAINS ELEMENT IN SET
"RTN","ORY21102",223,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY21102",224,0)
 ;;D^GCC FREE TEXT CONTAINS ELEMENT IN SET
"RTN","ORY21102",225,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY21102",226,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY21102",227,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY21102",228,0)
 ;;D^CONSET^OCXF22
"RTN","ORY21102",229,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY21102",230,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY21102",231,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY21102",232,0)
 ;;D^1
"RTN","ORY21102",233,0)
 ;;R^"863.7:","863.74:2",.01,"E"
"RTN","ORY21102",234,0)
 ;;D^COMPARISON VALUE
"RTN","ORY21102",235,0)
 ;;R^"863.7:","863.74:2",1.1,"E"
"RTN","ORY21102",236,0)
 ;;D^2
"RTN","ORY21102",237,0)
 ;;EOR^
"RTN","ORY21102",238,0)
 ;;KEY^863.7:^GCC FREE TEXT EQUALS
"RTN","ORY21102",239,0)
 ;;R^"863.7:",.01,"E"
"RTN","ORY21102",240,0)
 ;;D^GCC FREE TEXT EQUALS
"RTN","ORY21102",241,0)
 ;;R^"863.7:",.02,"E"
"RTN","ORY21102",242,0)
 ;;D^EXTRINSIC FUNCTION
"RTN","ORY21102",243,0)
 ;;R^"863.7:",3,"E"
"RTN","ORY21102",244,0)
 ;;D^AEQ^OCXF22
"RTN","ORY21102",245,0)
 ;;R^"863.7:","863.74:1",.01,"E"
"RTN","ORY21102",246,0)
 ;;D^PRIMARY DATA FIELD
"RTN","ORY21102",247,0)
 ;;R^"863.7:","863.74:1",1.1,"E"
"RTN","ORY21102",248,0)
 ;;D^1
"RTN","ORY21102",249,0)
 ;;R^"863.7:","863.74:2",.01,"E"
"RTN","ORY21102",250,0)
 ;;D^COMPARISON VALUE
"RTN","ORY21102",251,0)
 ;;R^"863.7:","863.74:2",1.1,"E"
"RTN","ORY21102",252,0)
 ;;D^2
"RTN","ORY21102",253,0)
 ;;EOR^
"RTN","ORY21102",254,0)
 ;;EOF^OCXS(863.7)^1
"RTN","ORY21102",255,0)
 ;;SOF^863.9  OCX MDD CONDITION/FUNCTION
"RTN","ORY21102",256,0)
 ;;KEY^863.9:^CONTAINS ELEMENT IN SET
"RTN","ORY21102",257,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY21102",258,0)
 ;;D^CONTAINS ELEMENT IN SET
"RTN","ORY21102",259,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY21102",260,0)
 ;;D^FREE TEXT
"RTN","ORY21102",261,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY21102",262,0)
 ;;D^CONTAINS AN ELEMENT IN THE SET
"RTN","ORY21102",263,0)
 ;;R^"863.9:","863.91:1",.01,"E"
"RTN","ORY21102",264,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY21102",265,0)
 ;;R^"863.9:","863.91:1",1,"E"
"RTN","ORY21102",266,0)
 ;;D^GCC FREE TEXT CONTAINS ELEMENT IN SET
"RTN","ORY21102",267,0)
 ;;EOR^
"RTN","ORY21102",268,0)
 ;;KEY^863.9:^EQ FREE TEXT
"RTN","ORY21102",269,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY21102",270,0)
 ;;D^EQ FREE TEXT
"RTN","ORY21102",271,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY21102",272,0)
 ;;D^FREE TEXT
"RTN","ORY21102",273,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY21102",274,0)
 ;;D^IS EQUAL TO
"RTN","ORY21102",275,0)
 ;;R^"863.9:","863.91:3",.01,"E"
"RTN","ORY21102",276,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY21102",277,0)
 ;;R^"863.9:","863.91:3",1,"E"
"RTN","ORY21102",278,0)
 ;;D^GCC FREE TEXT EQUALS
"RTN","ORY21102",279,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY21102",280,0)
 ;;D^EQUALS
"RTN","ORY21102",281,0)
 ;;EOR^
"RTN","ORY21102",282,0)
 ;;KEY^863.9:^LOGICAL FALSE
"RTN","ORY21102",283,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY21102",284,0)
 ;;D^LOGICAL FALSE
"RTN","ORY21102",285,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY21102",286,0)
 ;;D^BOOLEAN
"RTN","ORY21102",287,0)
 ;;R^"863.9:",.03,"E"
"RTN","ORY21102",288,0)
 ;;D^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY21102",289,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY21102",290,0)
 ;;D^IS FALSE
"RTN","ORY21102",291,0)
 ;;R^"863.9:","863.91:1",.01,"E"
"RTN","ORY21102",292,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY21102",293,0)
 ;;R^"863.9:","863.91:1",1,"E"
"RTN","ORY21102",294,0)
 ;;D^GCC BOOLEAN LOGICAL FALSE
"RTN","ORY21102",295,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY21102",296,0)
 ;;D^FALSE
"RTN","ORY21102",297,0)
 ;;EOR^
"RTN","ORY21102",298,0)
 ;;KEY^863.9:^LOGICAL TRUE
"RTN","ORY21102",299,0)
 ;;R^"863.9:",.01,"E"
"RTN","ORY21102",300,0)
 ;;D^LOGICAL TRUE
"RTN","ORY21102",301,0)
 ;;R^"863.9:",.02,"E"
"RTN","ORY21102",302,0)
 ;;D^BOOLEAN
"RTN","ORY21102",303,0)
 ;;R^"863.9:",.03,"E"
"RTN","ORY21102",304,0)
 ;;D^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY21102",305,0)
 ;;R^"863.9:",.04,"E"
"RTN","ORY21102",306,0)
 ;;D^IS TRUE
"RTN","ORY21102",307,0)
 ;;R^"863.9:","863.91:1",.01,"E"
"RTN","ORY21102",308,0)
 ;;D^OCXO GENERATE CODE FUNCTION
"RTN","ORY21102",309,0)
 ;;R^"863.9:","863.91:1",1,"E"
"RTN","ORY21102",310,0)
 ;;D^GCC BOOLEAN LOGICAL TRUE
"RTN","ORY21102",311,0)
 ;;R^"863.9:","863.92:1",.01,"E"
"RTN","ORY21102",312,0)
 ;;D^TRUE
"RTN","ORY21102",313,0)
 ;;EOR^
"RTN","ORY21102",314,0)
 ;;EOF^OCXS(863.9)^1
"RTN","ORY21102",315,0)
 ;;SOF^863.4  OCX MDD ATTRIBUTE
"RTN","ORY21102",316,0)
 ;;KEY^863.4:^BIOCHEMICAL RESULTS
"RTN","ORY21102",317,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21102",318,0)
 ;;D^BIOCHEMICAL RESULTS
"RTN","ORY21102",319,0)
 ;1;
"RTN","ORY21102",320,0)
 ;
"RTN","ORY21103")
0^4^B82140148
"RTN","ORY21103",1,0)
ORY21103 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY21103",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY21103",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY21103",4,0)
 ;
"RTN","ORY21103",5,0)
S ;
"RTN","ORY21103",6,0)
 ;
"RTN","ORY21103",7,0)
 D DOT^ORY211ES
"RTN","ORY21103",8,0)
 ;
"RTN","ORY21103",9,0)
 ;
"RTN","ORY21103",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY21103",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY21103",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY21103",13,0)
 ;
"RTN","ORY21103",14,0)
 G ^ORY21104
"RTN","ORY21103",15,0)
 ;
"RTN","ORY21103",16,0)
 Q
"RTN","ORY21103",17,0)
 ;
"RTN","ORY21103",18,0)
DATA ;
"RTN","ORY21103",19,0)
 ;
"RTN","ORY21103",20,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",21,0)
 ;;D^DATA TYPE
"RTN","ORY21103",22,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",23,0)
 ;;D^FREE TEXT
"RTN","ORY21103",24,0)
 ;;EOR^
"RTN","ORY21103",25,0)
 ;;KEY^863.4:^CM_CREATININE DAYS
"RTN","ORY21103",26,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",27,0)
 ;;D^CM_CREATININE DAYS
"RTN","ORY21103",28,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",29,0)
 ;;D^DATA TYPE
"RTN","ORY21103",30,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",31,0)
 ;;D^NUMERIC
"RTN","ORY21103",32,0)
 ;;EOR^
"RTN","ORY21103",33,0)
 ;;KEY^863.4:^CM_CREATININE FLAG
"RTN","ORY21103",34,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",35,0)
 ;;D^CM_CREATININE FLAG
"RTN","ORY21103",36,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",37,0)
 ;;D^DATA TYPE
"RTN","ORY21103",38,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",39,0)
 ;;D^BOOLEAN
"RTN","ORY21103",40,0)
 ;;EOR^
"RTN","ORY21103",41,0)
 ;;KEY^863.4:^CONTRAST MEDIA CODE
"RTN","ORY21103",42,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",43,0)
 ;;D^CONTRAST MEDIA CODE
"RTN","ORY21103",44,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",45,0)
 ;;D^DATA TYPE
"RTN","ORY21103",46,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",47,0)
 ;;D^FREE TEXT
"RTN","ORY21103",48,0)
 ;;EOR^
"RTN","ORY21103",49,0)
 ;;KEY^863.4:^CURRENT GLUCOPHAGE FLAG
"RTN","ORY21103",50,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",51,0)
 ;;D^CURRENT GLUCOPHAGE FLAG
"RTN","ORY21103",52,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",53,0)
 ;;D^DATA TYPE
"RTN","ORY21103",54,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",55,0)
 ;;D^BOOLEAN
"RTN","ORY21103",56,0)
 ;;EOR^
"RTN","ORY21103",57,0)
 ;;KEY^863.4:^FILLER
"RTN","ORY21103",58,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",59,0)
 ;;D^FILLER
"RTN","ORY21103",60,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",61,0)
 ;;D^DATA TYPE
"RTN","ORY21103",62,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",63,0)
 ;;D^FREE TEXT
"RTN","ORY21103",64,0)
 ;;EOR^
"RTN","ORY21103",65,0)
 ;;KEY^863.4:^HL7 FILLER
"RTN","ORY21103",66,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",67,0)
 ;;D^HL7 FILLER
"RTN","ORY21103",68,0)
 ;;R^"863.4:",.02,"E"
"RTN","ORY21103",69,0)
 ;;D^HL7FILLR
"RTN","ORY21103",70,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",71,0)
 ;;D^DATA TYPE
"RTN","ORY21103",72,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",73,0)
 ;;D^FREE TEXT
"RTN","ORY21103",74,0)
 ;;EOR^
"RTN","ORY21103",75,0)
 ;;KEY^863.4:^IEN
"RTN","ORY21103",76,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",77,0)
 ;;D^IEN
"RTN","ORY21103",78,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",79,0)
 ;;D^DATA TYPE
"RTN","ORY21103",80,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",81,0)
 ;;D^NUMERIC
"RTN","ORY21103",82,0)
 ;;EOR^
"RTN","ORY21103",83,0)
 ;;KEY^863.4:^ORDER MODE
"RTN","ORY21103",84,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",85,0)
 ;;D^ORDER MODE
"RTN","ORY21103",86,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",87,0)
 ;;D^DATA TYPE
"RTN","ORY21103",88,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",89,0)
 ;;D^FREE TEXT
"RTN","ORY21103",90,0)
 ;;EOR^
"RTN","ORY21103",91,0)
 ;;KEY^863.4:^ORDER PATIENT
"RTN","ORY21103",92,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",93,0)
 ;;D^ORDER PATIENT
"RTN","ORY21103",94,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",95,0)
 ;;D^DATA TYPE
"RTN","ORY21103",96,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",97,0)
 ;;D^NUMERIC
"RTN","ORY21103",98,0)
 ;;EOR^
"RTN","ORY21103",99,0)
 ;;KEY^863.4:^ORDERABLE ITEM IEN
"RTN","ORY21103",100,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",101,0)
 ;;D^ORDERABLE ITEM IEN
"RTN","ORY21103",102,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",103,0)
 ;;D^DATA TYPE
"RTN","ORY21103",104,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",105,0)
 ;;D^NUMERIC
"RTN","ORY21103",106,0)
 ;;EOR^
"RTN","ORY21103",107,0)
 ;;KEY^863.4:^RENAL TEST ABNORMAL FLAG
"RTN","ORY21103",108,0)
 ;;R^"863.4:",.01,"E"
"RTN","ORY21103",109,0)
 ;;D^RENAL TEST ABNORMAL FLAG
"RTN","ORY21103",110,0)
 ;;R^"863.4:","863.41:1",.01,"E"
"RTN","ORY21103",111,0)
 ;;D^DATA TYPE
"RTN","ORY21103",112,0)
 ;;R^"863.4:","863.41:1",1,"E"
"RTN","ORY21103",113,0)
 ;;D^BOOLEAN
"RTN","ORY21103",114,0)
 ;;EOR^
"RTN","ORY21103",115,0)
 ;;EOF^OCXS(863.4)^1
"RTN","ORY21103",116,0)
 ;;SOF^863.2  OCX MDD SUBJECT
"RTN","ORY21103",117,0)
 ;;KEY^863.2:^PATIENT
"RTN","ORY21103",118,0)
 ;;R^"863.2:",.01,"E"
"RTN","ORY21103",119,0)
 ;;D^PATIENT
"RTN","ORY21103",120,0)
 ;;R^"863.2:","863.21:1",.01,"E"
"RTN","ORY21103",121,0)
 ;;D^FILE
"RTN","ORY21103",122,0)
 ;;R^"863.2:","863.21:1",1,"E"
"RTN","ORY21103",123,0)
 ;;D^2
"RTN","ORY21103",124,0)
 ;;EOR^
"RTN","ORY21103",125,0)
 ;;EOF^OCXS(863.2)^1
"RTN","ORY21103",126,0)
 ;;SOF^863.3  OCX MDD LINK
"RTN","ORY21103",127,0)
 ;;KEY^863.3:^PATIENT.CM_CREAT_DAYS
"RTN","ORY21103",128,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",129,0)
 ;;D^PATIENT.CM_CREAT_DAYS
"RTN","ORY21103",130,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",131,0)
 ;;D^PATIENT
"RTN","ORY21103",132,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",133,0)
 ;;D^CM_CREATININE DAYS
"RTN","ORY21103",134,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",135,0)
 ;;D^7789
"RTN","ORY21103",136,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",137,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY21103",138,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21103",139,0)
 ;;D^CMCDAYS^ORKRA(|PATIENT IEN|)
"RTN","ORY21103",140,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21103",141,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY21103",142,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY21103",143,0)
 ;;D^1
"RTN","ORY21103",144,0)
 ;;EOR^
"RTN","ORY21103",145,0)
 ;;KEY^863.3:^PATIENT.CM_CREAT_FLAG
"RTN","ORY21103",146,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",147,0)
 ;;D^PATIENT.CM_CREAT_FLAG
"RTN","ORY21103",148,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",149,0)
 ;;D^PATIENT
"RTN","ORY21103",150,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",151,0)
 ;;D^CM_CREATININE FLAG
"RTN","ORY21103",152,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",153,0)
 ;;D^5677
"RTN","ORY21103",154,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",155,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY21103",156,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21103",157,0)
 ;;D^RECCREAT(|PATIENT IEN|,|CM-CREAT DAYS|)
"RTN","ORY21103",158,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21103",159,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY21103",160,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY21103",161,0)
 ;;D^1
"RTN","ORY21103",162,0)
 ;;EOR^
"RTN","ORY21103",163,0)
 ;;KEY^863.3:^PATIENT.CONTR_MED_CODE
"RTN","ORY21103",164,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",165,0)
 ;;D^PATIENT.CONTR_MED_CODE
"RTN","ORY21103",166,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",167,0)
 ;;D^PATIENT
"RTN","ORY21103",168,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",169,0)
 ;;D^CONTRAST MEDIA CODE
"RTN","ORY21103",170,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",171,0)
 ;;D^99
"RTN","ORY21103",172,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",173,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY21103",174,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21103",175,0)
 ;;D^CM^ORQQRA(|ORDERABLE ITEM IEN|)
"RTN","ORY21103",176,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21103",177,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY21103",178,0)
 ;;EOR^
"RTN","ORY21103",179,0)
 ;;KEY^863.3:^PATIENT.HL7_FILLER
"RTN","ORY21103",180,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",181,0)
 ;;D^PATIENT.HL7_FILLER
"RTN","ORY21103",182,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",183,0)
 ;;D^PATIENT
"RTN","ORY21103",184,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY21103",185,0)
 ;;D^HL7
"RTN","ORY21103",186,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",187,0)
 ;;D^HL7 FILLER
"RTN","ORY21103",188,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",189,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY21103",190,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21103",191,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY21103",192,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY21103",193,0)
 ;;D^2
"RTN","ORY21103",194,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY21103",195,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY21103",196,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY21103",197,0)
 ;;D^OCXODATA("ORC",3)
"RTN","ORY21103",198,0)
 ;;R^"863.3:","863.32:4",.01,"E"
"RTN","ORY21103",199,0)
 ;;D^OCXO HL7 SEGMENT ID
"RTN","ORY21103",200,0)
 ;;R^"863.3:","863.32:5",.01,"E"
"RTN","ORY21103",201,0)
 ;;D^OCXO DATA DRIVE SOURCE
"RTN","ORY21103",202,0)
 ;;R^"863.3:","863.32:5",1,"E"
"RTN","ORY21103",203,0)
 ;;D^HL7
"RTN","ORY21103",204,0)
 ;;R^"863.3:","863.32:6",.01,"E"
"RTN","ORY21103",205,0)
 ;;D^OCXO FILE POINTER
"RTN","ORY21103",206,0)
 ;;EOR^
"RTN","ORY21103",207,0)
 ;;KEY^863.3:^PATIENT.HL7_PATIENT_ID
"RTN","ORY21103",208,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",209,0)
 ;;D^PATIENT.HL7_PATIENT_ID
"RTN","ORY21103",210,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",211,0)
 ;;D^PATIENT
"RTN","ORY21103",212,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY21103",213,0)
 ;;D^HL7
"RTN","ORY21103",214,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",215,0)
 ;;D^IEN
"RTN","ORY21103",216,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",217,0)
 ;;D^99
"RTN","ORY21103",218,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",219,0)
 ;;D^OCXO HL7 SEGMENT ID
"RTN","ORY21103",220,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21103",221,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY21103",222,0)
 ;;R^"863.3:","863.32:3",.01,"E"
"RTN","ORY21103",223,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY21103",224,0)
 ;;R^"863.3:","863.32:3",1,"E"
"RTN","ORY21103",225,0)
 ;;D^OCXODATA("PID",3)
"RTN","ORY21103",226,0)
 ;;EOR^
"RTN","ORY21103",227,0)
 ;;KEY^863.3:^PATIENT.IEN
"RTN","ORY21103",228,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",229,0)
 ;;D^PATIENT.IEN
"RTN","ORY21103",230,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",231,0)
 ;;D^PATIENT
"RTN","ORY21103",232,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",233,0)
 ;;D^IEN
"RTN","ORY21103",234,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",235,0)
 ;;D^99
"RTN","ORY21103",236,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",237,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY21103",238,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21103",239,0)
 ;;D^DFN
"RTN","ORY21103",240,0)
 ;;EOR^
"RTN","ORY21103",241,0)
 ;;KEY^863.3:^PATIENT.OERR_ORDER_PATIENT
"RTN","ORY21103",242,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",243,0)
 ;;D^PATIENT.OERR_ORDER_PATIENT
"RTN","ORY21103",244,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",245,0)
 ;;D^PATIENT
"RTN","ORY21103",246,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",247,0)
 ;;D^ORDER PATIENT
"RTN","ORY21103",248,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",249,0)
 ;;D^5567
"RTN","ORY21103",250,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",251,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY21103",252,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21103",253,0)
 ;;D^OCXORD
"RTN","ORY21103",254,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21103",255,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY21103",256,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY21103",257,0)
 ;;D^1
"RTN","ORY21103",258,0)
 ;;EOR^
"RTN","ORY21103",259,0)
 ;;KEY^863.3:^PATIENT.OPS_FILLER
"RTN","ORY21103",260,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",261,0)
 ;;D^PATIENT.OPS_FILLER
"RTN","ORY21103",262,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",263,0)
 ;;D^PATIENT
"RTN","ORY21103",264,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY21103",265,0)
 ;;D^OPS
"RTN","ORY21103",266,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",267,0)
 ;;D^FILLER
"RTN","ORY21103",268,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",269,0)
 ;;D^99
"RTN","ORY21103",270,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",271,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY21103",272,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21103",273,0)
 ;;D^OCXPSD
"RTN","ORY21103",274,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21103",275,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY21103",276,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY21103",277,0)
 ;;D^1
"RTN","ORY21103",278,0)
 ;;EOR^
"RTN","ORY21103",279,0)
 ;;KEY^863.3:^PATIENT.OPS_ORD_MODE
"RTN","ORY21103",280,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",281,0)
 ;;D^PATIENT.OPS_ORD_MODE
"RTN","ORY21103",282,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",283,0)
 ;;D^PATIENT
"RTN","ORY21103",284,0)
 ;;R^"863.3:",.04,"E"
"RTN","ORY21103",285,0)
 ;;D^OPS
"RTN","ORY21103",286,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",287,0)
 ;;D^ORDER MODE
"RTN","ORY21103",288,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",289,0)
 ;;D^99
"RTN","ORY21103",290,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",291,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY21103",292,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21103",293,0)
 ;;D^OCXPSM
"RTN","ORY21103",294,0)
 ;;EOR^
"RTN","ORY21103",295,0)
 ;;KEY^863.3:^PATIENT.ORDER_ITEM_IEN
"RTN","ORY21103",296,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",297,0)
 ;;D^PATIENT.ORDER_ITEM_IEN
"RTN","ORY21103",298,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",299,0)
 ;;D^PATIENT
"RTN","ORY21103",300,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",301,0)
 ;;D^ORDERABLE ITEM IEN
"RTN","ORY21103",302,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",303,0)
 ;;D^99
"RTN","ORY21103",304,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",305,0)
 ;;D^OCXO VARIABLE NAME
"RTN","ORY21103",306,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21103",307,0)
 ;;D^OCXPSD
"RTN","ORY21103",308,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21103",309,0)
 ;;D^OCXO VT-BAR PIECE NUMBER
"RTN","ORY21103",310,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY21103",311,0)
 ;;D^0
"RTN","ORY21103",312,0)
 ;;EOR^
"RTN","ORY21103",313,0)
 ;;KEY^863.3:^PATIENT.REC_RENAL_ABNORM_FLAG
"RTN","ORY21103",314,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",315,0)
 ;;D^PATIENT.REC_RENAL_ABNORM_FLAG
"RTN","ORY21103",316,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",317,0)
 ;;D^PATIENT
"RTN","ORY21103",318,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",319,0)
 ;;D^RENAL TEST ABNORMAL FLAG
"RTN","ORY21103",320,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",321,0)
 ;;D^999
"RTN","ORY21103",322,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",323,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY21103",324,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21103",325,0)
 ;;D^ABREN(|PATIENT IEN|)
"RTN","ORY21103",326,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21103",327,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY21103",328,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY21103",329,0)
 ;;D^1
"RTN","ORY21103",330,0)
 ;;EOR^
"RTN","ORY21103",331,0)
 ;;KEY^863.3:^PATIENT.REC_RENAL_ABNORM_RES
"RTN","ORY21103",332,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21103",333,0)
 ;;D^PATIENT.REC_RENAL_ABNORM_RES
"RTN","ORY21103",334,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21103",335,0)
 ;;D^PATIENT
"RTN","ORY21103",336,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21103",337,0)
 ;;D^BIOCHEMICAL RESULTS
"RTN","ORY21103",338,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21103",339,0)
 ;;D^999
"RTN","ORY21103",340,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21103",341,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY21103",342,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21103",343,0)
 ;1;
"RTN","ORY21103",344,0)
 ;
"RTN","ORY21104")
0^5^B76434439
"RTN","ORY21104",1,0)
ORY21104 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY21104",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY21104",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY21104",4,0)
 ;
"RTN","ORY21104",5,0)
S ;
"RTN","ORY21104",6,0)
 ;
"RTN","ORY21104",7,0)
 D DOT^ORY211ES
"RTN","ORY21104",8,0)
 ;
"RTN","ORY21104",9,0)
 ;
"RTN","ORY21104",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY21104",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY21104",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY21104",13,0)
 ;
"RTN","ORY21104",14,0)
 G ^ORY21105
"RTN","ORY21104",15,0)
 ;
"RTN","ORY21104",16,0)
 Q
"RTN","ORY21104",17,0)
 ;
"RTN","ORY21104",18,0)
DATA ;
"RTN","ORY21104",19,0)
 ;
"RTN","ORY21104",20,0)
 ;;D^ABREN(|PATIENT IEN|)
"RTN","ORY21104",21,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21104",22,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY21104",23,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY21104",24,0)
 ;;D^2
"RTN","ORY21104",25,0)
 ;;EOR^
"RTN","ORY21104",26,0)
 ;;KEY^863.3:^PATIENT.TAKING_GLUCOPHAGE
"RTN","ORY21104",27,0)
 ;;R^"863.3:",.01,"E"
"RTN","ORY21104",28,0)
 ;;D^PATIENT.TAKING_GLUCOPHAGE
"RTN","ORY21104",29,0)
 ;;R^"863.3:",.02,"E"
"RTN","ORY21104",30,0)
 ;;D^PATIENT
"RTN","ORY21104",31,0)
 ;;R^"863.3:",.05,"E"
"RTN","ORY21104",32,0)
 ;;D^CURRENT GLUCOPHAGE FLAG
"RTN","ORY21104",33,0)
 ;;R^"863.3:",.06,"E"
"RTN","ORY21104",34,0)
 ;;D^999
"RTN","ORY21104",35,0)
 ;;R^"863.3:","863.32:1",.01,"E"
"RTN","ORY21104",36,0)
 ;;D^OCXO EXTERNAL FUNCTION CALL
"RTN","ORY21104",37,0)
 ;;R^"863.3:","863.32:1",1,"E"
"RTN","ORY21104",38,0)
 ;;D^TAKEMED^ORKPS(|PATIENT IEN|,"^GLUCOPHAGE^METFORMIN^AVANDAMET^METAGLIP")
"RTN","ORY21104",39,0)
 ;;R^"863.3:","863.32:2",.01,"E"
"RTN","ORY21104",40,0)
 ;;D^OCXO UP-ARROW PIECE NUMBER
"RTN","ORY21104",41,0)
 ;;R^"863.3:","863.32:2",1,"E"
"RTN","ORY21104",42,0)
 ;;D^1
"RTN","ORY21104",43,0)
 ;;EOR^
"RTN","ORY21104",44,0)
 ;;EOF^OCXS(863.3)^1
"RTN","ORY21104",45,0)
 ;;SOF^860.9  ORDER CHECK NATIONAL TERM
"RTN","ORY21104",46,0)
 ;;KEY^860.9:^ANGIOGRAM (PERIPHERAL)
"RTN","ORY21104",47,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",48,0)
 ;;D^ANGIOGRAM (PERIPHERAL)
"RTN","ORY21104",49,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",50,0)
 ;;D^101.43
"RTN","ORY21104",51,0)
 ;;EOR^
"RTN","ORY21104",52,0)
 ;;KEY^860.9:^BLOOD SPECIMEN
"RTN","ORY21104",53,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",54,0)
 ;;D^BLOOD SPECIMEN
"RTN","ORY21104",55,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",56,0)
 ;;D^61
"RTN","ORY21104",57,0)
 ;;EOR^
"RTN","ORY21104",58,0)
 ;;KEY^860.9:^DANGEROUS MEDS FOR PTS > 64
"RTN","ORY21104",59,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",60,0)
 ;;D^DANGEROUS MEDS FOR PTS > 64
"RTN","ORY21104",61,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",62,0)
 ;;D^101.43
"RTN","ORY21104",63,0)
 ;;R^"860.9:",2,"E"
"RTN","ORY21104",64,0)
 ;;D^I $P($G(^ORD(100.98,$P($G(^ORD(101.43,+Y,0)),U,5),0)),U)="PHARMACY"
"RTN","ORY21104",65,0)
 ;;EOR^
"RTN","ORY21104",66,0)
 ;;KEY^860.9:^DNR
"RTN","ORY21104",67,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",68,0)
 ;;D^DNR
"RTN","ORY21104",69,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",70,0)
 ;;D^101.43
"RTN","ORY21104",71,0)
 ;;EOR^
"RTN","ORY21104",72,0)
 ;;KEY^860.9:^EGFR
"RTN","ORY21104",73,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",74,0)
 ;;D^EGFR
"RTN","ORY21104",75,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",76,0)
 ;;D^60
"RTN","ORY21104",77,0)
 ;;EOR^
"RTN","ORY21104",78,0)
 ;;KEY^860.9:^FOOD-DRUG INTERACTION MED
"RTN","ORY21104",79,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",80,0)
 ;;D^FOOD-DRUG INTERACTION MED
"RTN","ORY21104",81,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",82,0)
 ;;D^101.43
"RTN","ORY21104",83,0)
 ;;R^"860.9:",2,"E"
"RTN","ORY21104",84,0)
 ;;D^I $P($G(^ORD(100.98,$P($G(^ORD(101.43,+Y,0)),U,5),0)),U)="PHARMACY"
"RTN","ORY21104",85,0)
 ;;EOR^
"RTN","ORY21104",86,0)
 ;;KEY^860.9:^NPO
"RTN","ORY21104",87,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",88,0)
 ;;D^NPO
"RTN","ORY21104",89,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",90,0)
 ;;D^101.43
"RTN","ORY21104",91,0)
 ;;EOR^
"RTN","ORY21104",92,0)
 ;;KEY^860.9:^ONE TIME MED
"RTN","ORY21104",93,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",94,0)
 ;;D^ONE TIME MED
"RTN","ORY21104",95,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",96,0)
 ;;D^51.1
"RTN","ORY21104",97,0)
 ;;R^"860.9:",2,"E"
"RTN","ORY21104",98,0)
 ;;D^I $E($P(^(0),U,4),1,2)="PS"
"RTN","ORY21104",99,0)
 ;;EOR^
"RTN","ORY21104",100,0)
 ;;KEY^860.9:^PARTIAL THROMBOPLASTIN TIME
"RTN","ORY21104",101,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",102,0)
 ;;D^PARTIAL THROMBOPLASTIN TIME
"RTN","ORY21104",103,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",104,0)
 ;;D^101.43
"RTN","ORY21104",105,0)
 ;;EOR^
"RTN","ORY21104",106,0)
 ;;KEY^860.9:^PROTHROMBIN TIME
"RTN","ORY21104",107,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",108,0)
 ;;D^PROTHROMBIN TIME
"RTN","ORY21104",109,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",110,0)
 ;;D^101.43
"RTN","ORY21104",111,0)
 ;;EOR^
"RTN","ORY21104",112,0)
 ;;KEY^860.9:^SERUM CREATININE
"RTN","ORY21104",113,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",114,0)
 ;;D^SERUM CREATININE
"RTN","ORY21104",115,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",116,0)
 ;;D^60
"RTN","ORY21104",117,0)
 ;;EOR^
"RTN","ORY21104",118,0)
 ;;KEY^860.9:^SERUM SPECIMEN
"RTN","ORY21104",119,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",120,0)
 ;;D^SERUM SPECIMEN
"RTN","ORY21104",121,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",122,0)
 ;;D^61
"RTN","ORY21104",123,0)
 ;;EOR^
"RTN","ORY21104",124,0)
 ;;KEY^860.9:^SERUM UREA NITROGEN
"RTN","ORY21104",125,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",126,0)
 ;;D^SERUM UREA NITROGEN
"RTN","ORY21104",127,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",128,0)
 ;;D^60
"RTN","ORY21104",129,0)
 ;;EOR^
"RTN","ORY21104",130,0)
 ;;KEY^860.9:^WBC
"RTN","ORY21104",131,0)
 ;;R^"860.9:",.01,"E"
"RTN","ORY21104",132,0)
 ;;D^WBC
"RTN","ORY21104",133,0)
 ;;R^"860.9:",.02,"E"
"RTN","ORY21104",134,0)
 ;;D^60
"RTN","ORY21104",135,0)
 ;;EOR^
"RTN","ORY21104",136,0)
 ;;EOF^OCXS(860.9)^1
"RTN","ORY21104",137,0)
 ;;SOF^860.8  ORDER CHECK COMPILER FUNCTIONS
"RTN","ORY21104",138,0)
 ;;KEY^860.8:^CONVERT DATE FROM FILEMAN FORMAT TO OCX FORMAT
"RTN","ORY21104",139,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21104",140,0)
 ;;D^CONVERT DATE FROM FILEMAN FORMAT TO OCX FORMAT
"RTN","ORY21104",141,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21104",142,0)
 ;;D^DT2INT
"RTN","ORY21104",143,0)
 ;;R^"860.8:",1,1
"RTN","ORY21104",144,0)
 ;;D^  ;DT2INT(OCXDT) ;      This Local Extrinsic Function converts a date into an integer
"RTN","ORY21104",145,0)
 ;;R^"860.8:",1,2
"RTN","ORY21104",146,0)
 ;;D^  ; ; By taking the Years, Months, Days, Hours and Minutes converting
"RTN","ORY21104",147,0)
 ;;R^"860.8:",1,3
"RTN","ORY21104",148,0)
 ;;D^  ; ; Them into Seconds and then adding them all together into one big integer
"RTN","ORY21104",149,0)
 ;;R^"860.8:",100,1
"RTN","ORY21104",150,0)
 ;;D^  ;DT2INT(OCXDT) ;      This Local Extrinsic Function converts a date into an integer
"RTN","ORY21104",151,0)
 ;;R^"860.8:",100,2
"RTN","ORY21104",152,0)
 ;;D^  ; ; By taking the Years, Months, Days, Hours and Minutes converting
"RTN","ORY21104",153,0)
 ;;R^"860.8:",100,3
"RTN","ORY21104",154,0)
 ;;D^  ; ; Them into Seconds and then adding them all together into one big integer
"RTN","ORY21104",155,0)
 ;;R^"860.8:",100,4
"RTN","ORY21104",156,0)
 ;;D^  ; ;
"RTN","ORY21104",157,0)
 ;;R^"860.8:",100,5
"RTN","ORY21104",158,0)
 ;;D^  ; Q:'$L($G(OCXDT)) ""
"RTN","ORY21104",159,0)
 ;;R^"860.8:",100,6
"RTN","ORY21104",160,0)
 ;;D^  ; N OCXDIFF,OCXVAL S (OCXDIFF,OCXVAL)=0
"RTN","ORY21104",161,0)
 ;;R^"860.8:",100,7
"RTN","ORY21104",162,0)
 ;;D^  ; ;
"RTN","ORY21104",163,0)
 ;;R^"860.8:",100,8
"RTN","ORY21104",164,0)
 ;;D^  ; I $L(OCXDT),'OCXDT,(OCXDT[" at ") D  ; EXTERNAL EXPERT SYSTEM FORMAT 1 TO EXTERNAL FORMAT
"RTN","ORY21104",165,0)
 ;;R^"860.8:",100,9
"RTN","ORY21104",166,0)
 ;;D^  ; .N OCXHR,OCXMIN,OCXTIME
"RTN","ORY21104",167,0)
 ;;R^"860.8:",100,10
"RTN","ORY21104",168,0)
 ;;D^  ; .S OCXTIME=$P($P(OCXDT," at ",2),".",1),OCXHR=$P(OCXTIME,":",1),OCXMIN=$P(OCXTIME,":",2)
"RTN","ORY21104",169,0)
 ;;R^"860.8:",100,11
"RTN","ORY21104",170,0)
 ;;D^  ; .S:(OCXDT["Midnight") OCXHR=00
"RTN","ORY21104",171,0)
 ;;R^"860.8:",100,12
"RTN","ORY21104",172,0)
 ;;D^  ; .S:(OCXDT["PM") OCXHR=OCXHR+12
"RTN","ORY21104",173,0)
 ;;R^"860.8:",100,13
"RTN","ORY21104",174,0)
 ;;D^  ; .S OCXDT=$P(OCXDT," at ")_"@"_$E(OCXHR+100,2,3)_$E(OCXMIN+100,2,3)
"RTN","ORY21104",175,0)
 ;;R^"860.8:",100,14
"RTN","ORY21104",176,0)
 ;;D^  ; ;
"RTN","ORY21104",177,0)
 ;;R^"860.8:",100,15
"RTN","ORY21104",178,0)
 ;;D^  ; I $L(OCXDT),(OCXDT?1.2N1"/"1.2N.1" ".2N.1":".2N) D  ; EXTERNAL EXPERT SYSTEM FORMAT 2 TO EXTERNAL FORMAT
"RTN","ORY21104",179,0)
 ;;R^"860.8:",100,16
"RTN","ORY21104",180,0)
 ;;D^  ; .N OCXMON
"RTN","ORY21104",181,0)
 ;;R^"860.8:",100,17
"RTN","ORY21104",182,0)
 ;;D^  ; .S OCXMON=$P("January^February^March^April^May^June^July^August^September^October^November^December",U,$P(OCXDT,"/",1))
"RTN","ORY21104",183,0)
 ;;R^"860.8:",100,18
"RTN","ORY21104",184,0)
 ;;D^  ; .I $L($P(OCXDT," ",2)) S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)_"@"_$TR($P(OCXDT," ",2),":","")
"RTN","ORY21104",185,0)
 ;;R^"860.8:",100,19
"RTN","ORY21104",186,0)
 ;;D^  ; .E  S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)
"RTN","ORY21104",187,0)
 ;;R^"860.8:",100,20
"RTN","ORY21104",188,0)
 ;;D^  ; ;
"RTN","ORY21104",189,0)
 ;;R^"860.8:",100,21
"RTN","ORY21104",190,0)
 ;;D^  ; I $L(OCXDT),(OCXDT?1.2N1"/"1.2N1"/"1.2N.1" ".2N.1":".2N) D  ; EXTERNAL EXPERT SYSTEM FORMAT 3 TO EXTERNAL FORMAT
"RTN","ORY21104",191,0)
 ;;R^"860.8:",100,22
"RTN","ORY21104",192,0)
 ;;D^  ; .N OCXMON
"RTN","ORY21104",193,0)
 ;;R^"860.8:",100,23
"RTN","ORY21104",194,0)
 ;;D^  ; .S OCXMON=$P("January^February^March^April^May^June^July^August^September^October^November^December",U,$P(OCXDT,"/",1))
"RTN","ORY21104",195,0)
 ;;R^"860.8:",100,24
"RTN","ORY21104",196,0)
 ;;D^  ; .I $L($P(OCXDT," ",2)) S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)_","_$P($P(OCXDT," ",1),"/",3)_"@"_$TR($P(OCXDT," ",2),":","")
"RTN","ORY21104",197,0)
 ;;R^"860.8:",100,25
"RTN","ORY21104",198,0)
 ;;D^  ; .E  S OCXDT=OCXMON_" "_$P($P(OCXDT," ",1),"/",2)_", "_$P($P(OCXDT," ",1),"/",3)
"RTN","ORY21104",199,0)
 ;;R^"860.8:",100,26
"RTN","ORY21104",200,0)
 ;;D^  ; ;
"RTN","ORY21104",201,0)
 ;;R^"860.8:",100,27
"RTN","ORY21104",202,0)
 ;;D^  ; I $L(OCXDT),'OCXDT D  ; EXTERNAL FORMAT TO INTERNAL FILEMAN FORMAT
"RTN","ORY21104",203,0)
 ;;R^"860.8:",100,28
"RTN","ORY21104",204,0)
 ;;D^  ; .I (OCXDT["@0000") S OCXDT=$P(OCXDT,"@",1),OCXDIFF=1
"RTN","ORY21104",205,0)
 ;;R^"860.8:",100,29
"RTN","ORY21104",206,0)
 ;;D^  ; .N %DT,X,Y S X=OCXDT,%DT="" S:(OCXDT["@")!(OCXDT="N") %DT="T" D ^%DT S OCXDT=+Y
"RTN","ORY21104",207,0)
 ;;R^"860.8:",100,30
"RTN","ORY21104",208,0)
 ;;D^  ; ;
"RTN","ORY21104",209,0)
 ;;R^"860.8:",100,31
"RTN","ORY21104",210,0)
 ;;D^  ; I ($L(OCXDT\1)>7) S OCXDT=$$HL7TFM^XLFDT(OCXDT)  ; HL7 FORMAT TO INTERNAL FILEMAN FORMAT
"RTN","ORY21104",211,0)
 ;;R^"860.8:",100,32
"RTN","ORY21104",212,0)
 ;;D^  ; ;
"RTN","ORY21104",213,0)
 ;;R^"860.8:",100,33
"RTN","ORY21104",214,0)
 ;;D^  ; I ($L(OCXDT\1)=7) S OCXDT=$$FMTH^XLFDT(+OCXDT)   ; INTERNAL FILEMAN FORMAT TO $H FORMAT
"RTN","ORY21104",215,0)
 ;;R^"860.8:",100,34
"RTN","ORY21104",216,0)
 ;;D^  ; ;
"RTN","ORY21104",217,0)
 ;;R^"860.8:",100,35
"RTN","ORY21104",218,0)
 ;;D^  ; I (OCXDT?5N1","1.5N) S OCXVAL=(OCXDT*86400)+$P(OCXDT,",",2)     ;  $H FORMAT TO EXPERT SYSTEM INTERNAL FORMAT
"RTN","ORY21104",219,0)
 ;;R^"860.8:",100,36
"RTN","ORY21104",220,0)
 ;;D^  ; ;
"RTN","ORY21104",221,0)
 ;;R^"860.8:",100,37
"RTN","ORY21104",222,0)
 ;;D^  ; Q OCXVAL
"RTN","ORY21104",223,0)
 ;;R^"860.8:",100,38
"RTN","ORY21104",224,0)
 ;;D^  ; ;
"RTN","ORY21104",225,0)
 ;;EOR^
"RTN","ORY21104",226,0)
 ;;KEY^860.8:^CONVERT DATE FROM OCX FORMAT TO READABLE FORMAT
"RTN","ORY21104",227,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21104",228,0)
 ;;D^CONVERT DATE FROM OCX FORMAT TO READABLE FORMAT
"RTN","ORY21104",229,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21104",230,0)
 ;;D^INT2DT
"RTN","ORY21104",231,0)
 ;;R^"860.8:",1,1
"RTN","ORY21104",232,0)
 ;;D^  ;INT2DT(OCXDT,OCXF) ;      This Local Extrinsic Function converts an OCX internal format
"RTN","ORY21104",233,0)
 ;;R^"860.8:",1,2
"RTN","ORY21104",234,0)
 ;;D^  ; ; date into an Externl Format (Human Readable) date.   'OCXF=SHORT FORMAT OCXF=LONG FORMAT
"RTN","ORY21104",235,0)
 ;;R^"860.8:",1,3
"RTN","ORY21104",236,0)
 ;;D^  ; ;
"RTN","ORY21104",237,0)
 ;;R^"860.8:",100,1
"RTN","ORY21104",238,0)
 ;;D^  ;INT2DT(OCXDT,OCXF) ;      This Local Extrinsic Function converts an OCX internal format
"RTN","ORY21104",239,0)
 ;;R^"860.8:",100,2
"RTN","ORY21104",240,0)
 ;;D^  ; ; date into an Externl Format (Human Readable) date.   'OCXF=SHORT FORMAT OCXF=LONG FORMAT
"RTN","ORY21104",241,0)
 ;;R^"860.8:",100,3
"RTN","ORY21104",242,0)
 ;;D^  ; ;
"RTN","ORY21104",243,0)
 ;;R^"860.8:",100,4
"RTN","ORY21104",244,0)
 ;;D^  ; Q:'$L($G(OCXDT)) "" S OCXF=+$G(OCXF)
"RTN","ORY21104",245,0)
 ;1;
"RTN","ORY21104",246,0)
 ;
"RTN","ORY21105")
0^6^B57814848
"RTN","ORY21105",1,0)
ORY21105 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY21105",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY21105",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY21105",4,0)
 ;
"RTN","ORY21105",5,0)
S ;
"RTN","ORY21105",6,0)
 ;
"RTN","ORY21105",7,0)
 D DOT^ORY211ES
"RTN","ORY21105",8,0)
 ;
"RTN","ORY21105",9,0)
 ;
"RTN","ORY21105",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY21105",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY21105",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY21105",13,0)
 ;
"RTN","ORY21105",14,0)
 G ^ORY21106
"RTN","ORY21105",15,0)
 ;
"RTN","ORY21105",16,0)
 Q
"RTN","ORY21105",17,0)
 ;
"RTN","ORY21105",18,0)
DATA ;
"RTN","ORY21105",19,0)
 ;
"RTN","ORY21105",20,0)
 ;;R^"860.8:",100,5
"RTN","ORY21105",21,0)
 ;;D^  ; N OCXYR,OCXLPYR,OCXMON,OCXDAY,OCXHR,OCXMIN,OCXSEC,OCXCYR
"RTN","ORY21105",22,0)
 ;;R^"860.8:",100,6
"RTN","ORY21105",23,0)
 ;;D^  ; S (OCXYR,OCXLPYR,OCXMON,OCXDAY,OCXHR,OCXMIN,OCXSEC,OCXAP)=""
"RTN","ORY21105",24,0)
 ;;R^"860.8:",100,7
"RTN","ORY21105",25,0)
 ;;D^  ; S OCXSEC=$E(OCXDT#60+100,2,3),OCXDT=OCXDT\60
"RTN","ORY21105",26,0)
 ;;R^"860.8:",100,8
"RTN","ORY21105",27,0)
 ;;D^  ; S OCXMIN=$E(OCXDT#60+100,2,3),OCXDT=OCXDT\60
"RTN","ORY21105",28,0)
 ;;R^"860.8:",100,9
"RTN","ORY21105",29,0)
 ;;D^  ; S OCXHR=$E(OCXDT#24+100,2,3),OCXDT=OCXDT\24
"RTN","ORY21105",30,0)
 ;;R^"860.8:",100,10
"RTN","ORY21105",31,0)
 ;;D^  ; S OCXCYR=($H\1461)*4+1841+(($H#1461)\365)
"RTN","ORY21105",32,0)
 ;;R^"860.8:",100,11
"RTN","ORY21105",33,0)
 ;;D^  ; S OCXYR=(OCXDT\1461)*4+1841,OCXDT=OCXDT#1461
"RTN","ORY21105",34,0)
 ;;R^"860.8:",100,12
"RTN","ORY21105",35,0)
 ;;D^  ; S OCXLPYR=(OCXDT\365),OCXDT=OCXDT-(OCXLPYR*365),OCXYR=OCXYR+OCXLPYR
"RTN","ORY21105",36,0)
 ;;R^"860.8:",100,13
"RTN","ORY21105",37,0)
 ;;D^  ; S OCXCNT="031^059^090^120^151^181^212^243^273^304^334^365"
"RTN","ORY21105",38,0)
 ;;R^"860.8:",100,14
"RTN","ORY21105",39,0)
 ;;D^  ; S:(OCXLPYR=3) OCXCNT="031^060^091^121^152^182^213^244^274^305^335^366"
"RTN","ORY21105",40,0)
 ;;R^"860.8:",100,15
"RTN","ORY21105",41,0)
 ;;D^  ; F OCXMON=1:1:12 Q:(OCXDT<$P(OCXCNT,U,OCXMON))
"RTN","ORY21105",42,0)
 ;;R^"860.8:",100,16
"RTN","ORY21105",43,0)
 ;;D^  ; S OCXDAY=OCXDT-$P(OCXCNT,U,OCXMON-1)+1
"RTN","ORY21105",44,0)
 ;;R^"860.8:",100,17
"RTN","ORY21105",45,0)
 ;;D^  ; I OCXF S OCXMON=$P("January^February^March^April^May^June^July^August^September^October^November^December",U,OCXMON)
"RTN","ORY21105",46,0)
 ;;R^"860.8:",100,18
"RTN","ORY21105",47,0)
 ;;D^  ; E  S OCXMON=$E(OCXMON+100,2,3)
"RTN","ORY21105",48,0)
 ;;R^"860.8:",100,19
"RTN","ORY21105",49,0)
 ;;D^  ; S OCXAP=$S('OCXHR:"Midnight",(OCXHR=12):"Noon",(OCXHR<12):"AM",1:"PM")
"RTN","ORY21105",50,0)
 ;;R^"860.8:",100,20
"RTN","ORY21105",51,0)
 ;;D^  ; I OCXF S OCXHR=OCXHR#12 S:'OCXHR OCXHR=12
"RTN","ORY21105",52,0)
 ;;R^"860.8:",100,21
"RTN","ORY21105",53,0)
 ;;D^  ; Q:'OCXF $E(OCXMON+100,2,3)_"/"_$E(OCXDAY+100,2,3)_$S((OCXCYR=OCXYR):" "_OCXHR_":"_OCXMIN,1:"/"_$E(OCXYR,3,4))
"RTN","ORY21105",54,0)
 ;;R^"860.8:",100,22
"RTN","ORY21105",55,0)
 ;;D^  ; Q:(OCXHR+OCXMIN+OCXSEC) OCXMON_" "_OCXDAY_","_OCXYR_" at "_OCXHR_":"_OCXMIN_"."_OCXSEC_" "_OCXAP
"RTN","ORY21105",56,0)
 ;;R^"860.8:",100,23
"RTN","ORY21105",57,0)
 ;;D^  ; Q OCXMON_" "_OCXDAY_","_OCXYR
"RTN","ORY21105",58,0)
 ;;R^"860.8:",100,24
"RTN","ORY21105",59,0)
 ;;D^  ; ;
"RTN","ORY21105",60,0)
 ;;EOR^
"RTN","ORY21105",61,0)
 ;;KEY^860.8:^DETERMINE IF RENAL LAB RESULTS ARE ABNORMAL HIGH OR LOW
"RTN","ORY21105",62,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21105",63,0)
 ;;D^DETERMINE IF RENAL LAB RESULTS ARE ABNORMAL HIGH OR LOW
"RTN","ORY21105",64,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21105",65,0)
 ;;D^ABREN
"RTN","ORY21105",66,0)
 ;;R^"860.8:",100,1
"RTN","ORY21105",67,0)
 ;;D^  ;ABREN(DFN) ;
"RTN","ORY21105",68,0)
 ;;R^"860.8:",100,2
"RTN","ORY21105",69,0)
 ;;D^  ; ;
"RTN","ORY21105",70,0)
 ;;R^"860.8:",100,3
"RTN","ORY21105",71,0)
 ;;D^  ; N OCXFLAG,OCXVAL,OCXLIST,OCXTEST,UNAV,OCXTLIST,OCXTERM,OCXSLIST,OCXSPEC
"RTN","ORY21105",72,0)
 ;;R^"860.8:",100,4
"RTN","ORY21105",73,0)
 ;;D^  ; S (OCXLIST,OCXTLIST)="",UNAV="0^<Unavailable>"
"RTN","ORY21105",74,0)
 ;;R^"860.8:",100,5
"RTN","ORY21105",75,0)
 ;;D^  ; S OCXSLIST="" Q:'$$TERMLKUP("SERUM SPECIMEN",.OCXSLIST) UNAV
"RTN","ORY21105",76,0)
 ;;R^"860.8:",100,6
"RTN","ORY21105",77,0)
 ;;D^  ; F OCXTERM="SERUM CREATININE","SERUM UREA NITROGEN" D  Q:($L(OCXLIST)>130)
"RTN","ORY21105",78,0)
 ;;R^"860.8:",100,7
"RTN","ORY21105",79,0)
 ;;D^  ; .Q:'$$TERMLKUP(OCXTERM,.OCXTLIST)
"RTN","ORY21105",80,0)
 ;;R^"860.8:",100,8
"RTN","ORY21105",81,0)
 ;;D^  ; .S OCXTEST=0 F  S OCXTEST=$O(OCXTLIST(OCXTEST)) Q:'OCXTEST  D  Q:($L(OCXLIST)>130)
"RTN","ORY21105",82,0)
 ;;R^"860.8:",100,9
"RTN","ORY21105",83,0)
 ;;D^  ; ..S OCXSPEC=0 F  S OCXSPEC=$O(OCXSLIST(OCXSPEC)) Q:'OCXSPEC  D  Q:($L(OCXLIST)>130)
"RTN","ORY21105",84,0)
 ;;R^"860.8:",100,10
"RTN","ORY21105",85,0)
 ;;D^  ; ...S OCXVAL=$$LOCL^ORQQLR1(DFN,OCXTEST,OCXSPEC),OCXFLAG=$P(OCXVAL,U,5)
"RTN","ORY21105",86,0)
 ;;R^"860.8:",100,11
"RTN","ORY21105",87,0)
 ;;D^  ; ...I $L(OCXVAL),((OCXFLAG["H")!(OCXFLAG["L")) D 
"RTN","ORY21105",88,0)
 ;;R^"860.8:",100,12
"RTN","ORY21105",89,0)
 ;;D^  ; ....N OCXY S OCXY=""
"RTN","ORY21105",90,0)
 ;;R^"860.8:",100,13
"RTN","ORY21105",91,0)
 ;;D^  ; ....S OCXY=$P(OCXVAL,U,2)_": "_$P(OCXVAL,U,3)_" "_$P(OCXVAL,U,4)
"RTN","ORY21105",92,0)
 ;;R^"860.8:",100,14
"RTN","ORY21105",93,0)
 ;;D^  ; ....S OCXY=OCXY_" "_$S($L(OCXFLAG):"["_OCXFLAG_"]",1:"")
"RTN","ORY21105",94,0)
 ;;R^"860.8:",100,15
"RTN","ORY21105",95,0)
 ;;D^  ; ....S OCXY=OCXY_" "_$$FMTE^XLFDT($P(OCXVAL,U,7),"2P")
"RTN","ORY21105",96,0)
 ;;R^"860.8:",100,16
"RTN","ORY21105",97,0)
 ;;D^  ; ....S:$L(OCXLIST) OCXLIST=OCXLIST_" " S OCXLIST=OCXLIST_OCXY
"RTN","ORY21105",98,0)
 ;;R^"860.8:",100,17
"RTN","ORY21105",99,0)
 ;;D^  ; Q:'$L(OCXLIST) UNAV  Q 1_U_OCXLIST
"RTN","ORY21105",100,0)
 ;;R^"860.8:",100,18
"RTN","ORY21105",101,0)
 ;;D^  ; ;  
"RTN","ORY21105",102,0)
 ;;EOR^
"RTN","ORY21105",103,0)
 ;;KEY^860.8:^ELAPSED ORDER CHECK TIME LOGGER
"RTN","ORY21105",104,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21105",105,0)
 ;;D^ELAPSED ORDER CHECK TIME LOGGER
"RTN","ORY21105",106,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21105",107,0)
 ;;D^TIMELOG
"RTN","ORY21105",108,0)
 ;;R^"860.8:",100,1
"RTN","ORY21105",109,0)
 ;;D^  ;TIMELOG(OCXMODE,OCXCALL) ; Log an entry in the Elapsed time log.
"RTN","ORY21105",110,0)
 ;;R^"860.8:",100,2
"RTN","ORY21105",111,0)
 ;;D^  ; ;
"RTN","ORY21105",112,0)
 ;;R^"860.8:",100,3
"RTN","ORY21105",113,0)
 ;;D^  ; ;
"RTN","ORY21105",114,0)
 ;;R^"860.8:",100,4
"RTN","ORY21105",115,0)
 ;;D^  ; Q 0
"RTN","ORY21105",116,0)
 ;;R^"860.8:",100,5
"RTN","ORY21105",117,0)
 ;;D^  ; ;
"RTN","ORY21105",118,0)
 ;;EOR^
"RTN","ORY21105",119,0)
 ;;KEY^860.8:^EQUALS TERM OPERATOR
"RTN","ORY21105",120,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21105",121,0)
 ;;D^EQUALS TERM OPERATOR
"RTN","ORY21105",122,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21105",123,0)
 ;;D^EQTERM
"RTN","ORY21105",124,0)
 ;;R^"860.8:",100,1
"RTN","ORY21105",125,0)
 ;;D^  ;EQTERM(DATA,TERM) ;
"RTN","ORY21105",126,0)
 ;;R^"860.8:",100,2
"RTN","ORY21105",127,0)
 ;;D^  ; ;
"RTN","ORY21105",128,0)
 ;;R^"860.8:",100,3
"RTN","ORY21105",129,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20," Execution trace  DATA: ",$G(DATA),"   TERM: ",$G(TERM)
"RTN","ORY21105",130,0)
 ;;R^"860.8:",100,4
"RTN","ORY21105",131,0)
 ;;D^  ; N OCXF,OCXL
"RTN","ORY21105",132,0)
 ;;R^"860.8:",100,5
"RTN","ORY21105",133,0)
 ;;D^  ; ;
"RTN","ORY21105",134,0)
 ;;R^"860.8:",100,6
"RTN","ORY21105",135,0)
 ;;D^  ; S OCXL="",OCXF=$$TERMLKUP(TERM,.OCXL)
"RTN","ORY21105",136,0)
 ;;R^"860.8:",100,7
"RTN","ORY21105",137,0)
 ;;D^T-; Q:'OCXF 0
"RTN","ORY21105",138,0)
 ;;R^"860.8:",100,8
"RTN","ORY21105",139,0)
 ;;D^T+; I 'OCXF W:$G(OCXTRACE) !,"%%%%",?20," Term '",TERM,"' not in Order Check National Term File" Q 0
"RTN","ORY21105",140,0)
 ;;R^"860.8:",100,9
"RTN","ORY21105",141,0)
 ;;D^T+; I '$O(OCXL(0)) W:$G(OCXTRACE) !,"%%%%",?20," There are no local terms listed for the National Term '",TERM,"'." Q 0
"RTN","ORY21105",142,0)
 ;;R^"860.8:",100,10
"RTN","ORY21105",143,0)
 ;;D^T+; I ($D(OCXL(DATA))!$D(OCXL("B",DATA))) W:$G(OCXTRACE) !,"%%%%",?20," Data equals Term" Q 1
"RTN","ORY21105",144,0)
 ;;R^"860.8:",100,11
"RTN","ORY21105",145,0)
 ;;D^T-; I ($D(OCXL(DATA))!$D(OCXL("B",DATA))) Q 1
"RTN","ORY21105",146,0)
 ;;R^"860.8:",100,12
"RTN","ORY21105",147,0)
 ;;D^T-; Q 0
"RTN","ORY21105",148,0)
 ;;R^"860.8:",100,13
"RTN","ORY21105",149,0)
 ;;D^T+; W:$G(OCXTRACE) !,"%%%%",?20," Data does not equal Term" Q 0
"RTN","ORY21105",150,0)
 ;;R^"860.8:",100,14
"RTN","ORY21105",151,0)
 ;;D^  ; ;
"RTN","ORY21105",152,0)
 ;;EOR^
"RTN","ORY21105",153,0)
 ;;KEY^860.8:^FILE DATA IN PATIENT ACTIVE DATA FILE
"RTN","ORY21105",154,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21105",155,0)
 ;;D^FILE DATA IN PATIENT ACTIVE DATA FILE
"RTN","ORY21105",156,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21105",157,0)
 ;;D^FILE
"RTN","ORY21105",158,0)
 ;;R^"860.8:",1,1
"RTN","ORY21105",159,0)
 ;;D^  ;FILE(DFN,OCXELE,OCXDFL) ;     This Local Extrinsic Function files data
"RTN","ORY21105",160,0)
 ;;R^"860.8:",1,2
"RTN","ORY21105",161,0)
 ;;D^  ; ;     in the Order Check Patient Data File
"RTN","ORY21105",162,0)
 ;;R^"860.8:",1,3
"RTN","ORY21105",163,0)
 ;;D^  ; ;
"RTN","ORY21105",164,0)
 ;;R^"860.8:",100,1
"RTN","ORY21105",165,0)
 ;;D^  ;FILE(DFN,OCXELE,OCXDFL) ;     This Local Extrinsic Function logs a validated event/element.
"RTN","ORY21105",166,0)
 ;;R^"860.8:",100,2
"RTN","ORY21105",167,0)
 ;;D^  ; ;
"RTN","ORY21105",168,0)
 ;;R^"860.8:",100,3
"RTN","ORY21105",169,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20," Execution trace  DFN: ",DFN,"   OCXELE: ",+$G(OCXELE),"   OCXDFL: ",$G(OCXDFL)
"RTN","ORY21105",170,0)
 ;;R^"860.8:",100,4
"RTN","ORY21105",171,0)
 ;;D^  ; N OCXTIMN,OCXTIML,OCXTIMT1,OCXTIMT2,OCXDATA,OCXPC,OCXPC,OCXVAL,OCXSUB,OCXDFI
"RTN","ORY21105",172,0)
 ;;R^"860.8:",100,5
"RTN","ORY21105",173,0)
 ;;D^  ; S DFN=+$G(DFN),OCXELE=+$G(OCXELE)
"RTN","ORY21105",174,0)
 ;;R^"860.8:",100,6
"RTN","ORY21105",175,0)
 ;;D^  ; ;
"RTN","ORY21105",176,0)
 ;;R^"860.8:",100,7
"RTN","ORY21105",177,0)
 ;;D^  ; Q:'DFN 1 Q:'OCXELE 1 K OCXDATA
"RTN","ORY21105",178,0)
 ;;R^"860.8:",100,8
"RTN","ORY21105",179,0)
 ;;D^  ; ;
"RTN","ORY21105",180,0)
 ;;R^"860.8:",100,9
"RTN","ORY21105",181,0)
 ;;D^  ; S OCXDATA(DFN,OCXELE)=1
"RTN","ORY21105",182,0)
 ;;R^"860.8:",100,10
"RTN","ORY21105",183,0)
 ;;D^  ; F OCXPC=1:1:$L(OCXDFL,",") S OCXDFI=$P(OCXDFL,",",OCXPC) I OCXDFI D
"RTN","ORY21105",184,0)
 ;;R^"860.8:",100,11
"RTN","ORY21105",185,0)
 ;;D^  ; .S OCXVAL=$G(OCXDF(+OCXDFI)),OCXDATA(DFN,OCXELE,+OCXDFI)=OCXVAL
"RTN","ORY21105",186,0)
 ;;R^"860.8:",100,12
"RTN","ORY21105",187,0)
 ;;D^T+; .I $G(OCXTRACE) W !,"%%%%",?20,"   ",$P($G(^OCXS(860.4,+OCXDFI,0)),U,1)," = """,OCXVAL,""""
"RTN","ORY21105",188,0)
 ;;R^"860.8:",100,13
"RTN","ORY21105",189,0)
 ;;D^  ; ;
"RTN","ORY21105",190,0)
 ;;R^"860.8:",100,14
"RTN","ORY21105",191,0)
 ;;D^  ; M ^TMP("OCXCHK",$J,DFN)=OCXDATA(DFN)
"RTN","ORY21105",192,0)
 ;;R^"860.8:",100,15
"RTN","ORY21105",193,0)
 ;;D^  ; ;
"RTN","ORY21105",194,0)
 ;;R^"860.8:",100,16
"RTN","ORY21105",195,0)
 ;;D^  ; Q 0
"RTN","ORY21105",196,0)
 ;;R^"860.8:",100,17
"RTN","ORY21105",197,0)
 ;;D^  ; ;
"RTN","ORY21105",198,0)
 ;;EOR^
"RTN","ORY21105",199,0)
 ;;KEY^860.8:^GENERATE STRING CHECKSUM
"RTN","ORY21105",200,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21105",201,0)
 ;;D^GENERATE STRING CHECKSUM
"RTN","ORY21105",202,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21105",203,0)
 ;;D^CKSUM
"RTN","ORY21105",204,0)
 ;;R^"860.8:",100,1
"RTN","ORY21105",205,0)
 ;;D^  ;CKSUM(STR) ;
"RTN","ORY21105",206,0)
 ;;R^"860.8:",100,2
"RTN","ORY21105",207,0)
 ;;D^  ; ;
"RTN","ORY21105",208,0)
 ;;R^"860.8:",100,3
"RTN","ORY21105",209,0)
 ;;D^  ; N CKSUM,PTR,ASC S CKSUM=0
"RTN","ORY21105",210,0)
 ;;R^"860.8:",100,4
"RTN","ORY21105",211,0)
 ;;D^  ; S STR=$TR(STR,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ORY21105",212,0)
 ;;R^"860.8:",100,5
"RTN","ORY21105",213,0)
 ;;D^  ; F PTR=$L(STR):-1:1 S ASC=$A(STR,PTR)-42 I (ASC>0),(ASC<51) S CKSUM=CKSUM*2+ASC
"RTN","ORY21105",214,0)
 ;1;
"RTN","ORY21105",215,0)
 ;
"RTN","ORY21106")
0^7^B68575871
"RTN","ORY21106",1,0)
ORY21106 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY21106",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY21106",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY21106",4,0)
 ;
"RTN","ORY21106",5,0)
S ;
"RTN","ORY21106",6,0)
 ;
"RTN","ORY21106",7,0)
 D DOT^ORY211ES
"RTN","ORY21106",8,0)
 ;
"RTN","ORY21106",9,0)
 ;
"RTN","ORY21106",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY21106",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY21106",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY21106",13,0)
 ;
"RTN","ORY21106",14,0)
 G ^ORY21107
"RTN","ORY21106",15,0)
 ;
"RTN","ORY21106",16,0)
 Q
"RTN","ORY21106",17,0)
 ;
"RTN","ORY21106",18,0)
DATA ;
"RTN","ORY21106",19,0)
 ;
"RTN","ORY21106",20,0)
 ;;R^"860.8:",100,6
"RTN","ORY21106",21,0)
 ;;D^  ; Q +CKSUM
"RTN","ORY21106",22,0)
 ;;R^"860.8:",100,7
"RTN","ORY21106",23,0)
 ;;D^  ; ;
"RTN","ORY21106",24,0)
 ;;EOR^
"RTN","ORY21106",25,0)
 ;;KEY^860.8:^GET DATA FROM THE ACTIVE DATA FILE
"RTN","ORY21106",26,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21106",27,0)
 ;;D^GET DATA FROM THE ACTIVE DATA FILE
"RTN","ORY21106",28,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21106",29,0)
 ;;D^GETDATA
"RTN","ORY21106",30,0)
 ;;R^"860.8:",100,1
"RTN","ORY21106",31,0)
 ;;D^  ;GETDATA(DFN,OCXL,OCXDFI) ;     This Local Extrinsic Function returns runtime data
"RTN","ORY21106",32,0)
 ;;R^"860.8:",100,2
"RTN","ORY21106",33,0)
 ;;D^  ; ;
"RTN","ORY21106",34,0)
 ;;R^"860.8:",100,3
"RTN","ORY21106",35,0)
 ;;D^  ; N OCXE,VAL,PC S VAL=""
"RTN","ORY21106",36,0)
 ;;R^"860.8:",100,4
"RTN","ORY21106",37,0)
 ;;D^  ; F PC=1:1:$L(OCXL,U) S OCXE=$P(OCXL,U,PC) I OCXE S VAL=$G(^TMP("OCXCHK",$J,DFN,OCXE,OCXDFI)) Q:$L(VAL)
"RTN","ORY21106",38,0)
 ;;R^"860.8:",100,5
"RTN","ORY21106",39,0)
 ;;D^  ; Q VAL
"RTN","ORY21106",40,0)
 ;;R^"860.8:",100,6
"RTN","ORY21106",41,0)
 ;;D^  ; ;
"RTN","ORY21106",42,0)
 ;;EOR^
"RTN","ORY21106",43,0)
 ;;KEY^860.8:^IN LIST OPERATOR
"RTN","ORY21106",44,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21106",45,0)
 ;;D^IN LIST OPERATOR
"RTN","ORY21106",46,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21106",47,0)
 ;;D^LIST
"RTN","ORY21106",48,0)
 ;;R^"860.8:",100,1
"RTN","ORY21106",49,0)
 ;;D^  ;LIST(DATA,LIST) ;   IS THE DATA FIELD IN THE LIST
"RTN","ORY21106",50,0)
 ;;R^"860.8:",100,2
"RTN","ORY21106",51,0)
 ;;D^  ; ;
"RTN","ORY21106",52,0)
 ;;R^"860.8:",100,3
"RTN","ORY21106",53,0)
 ;;D^T+; W:$G(OCXTRACE) !,"%%%%",?20,"     $$LIST(""",DATA,""",""",LIST,""")"
"RTN","ORY21106",54,0)
 ;;R^"860.8:",100,4
"RTN","ORY21106",55,0)
 ;;D^  ; S:'($E(LIST,1)=",") LIST=","_LIST S:'($E(LIST,$L(LIST))=",") LIST=LIST_"," S DATA=","_DATA_","
"RTN","ORY21106",56,0)
 ;;R^"860.8:",100,5
"RTN","ORY21106",57,0)
 ;;D^  ; Q (LIST[DATA)
"RTN","ORY21106",58,0)
 ;;R^"860.8:",100,6
"RTN","ORY21106",59,0)
 ;;D^  ; ;
"RTN","ORY21106",60,0)
 ;;EOR^
"RTN","ORY21106",61,0)
 ;;KEY^860.8:^LOCAL TERM LOOKUP
"RTN","ORY21106",62,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21106",63,0)
 ;;D^LOCAL TERM LOOKUP
"RTN","ORY21106",64,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21106",65,0)
 ;;D^TERMLKUP
"RTN","ORY21106",66,0)
 ;;R^"860.8:",1,1
"RTN","ORY21106",67,0)
 ;;D^ 
"RTN","ORY21106",68,0)
 ;;R^"860.8:",1,2
"RTN","ORY21106",69,0)
 ;;D^  This function allows a local site to define to Order Checking
"RTN","ORY21106",70,0)
 ;;R^"860.8:",1,3
"RTN","ORY21106",71,0)
 ;;D^ a term specific to that site. (ie. Lab Test Name, Radiology
"RTN","ORY21106",72,0)
 ;;R^"860.8:",1,4
"RTN","ORY21106",73,0)
 ;;D^ procedure name, etc.)
"RTN","ORY21106",74,0)
 ;;R^"860.8:",1,5
"RTN","ORY21106",75,0)
 ;;D^ 
"RTN","ORY21106",76,0)
 ;;R^"860.8:",100,1
"RTN","ORY21106",77,0)
 ;;D^  ;TERMLKUP(OCXTERM,OCXFILE) ;
"RTN","ORY21106",78,0)
 ;;R^"860.8:",100,2
"RTN","ORY21106",79,0)
 ;;D^  ; ;
"RTN","ORY21106",80,0)
 ;;R^"860.8:",100,3
"RTN","ORY21106",81,0)
 ;;D^  ; Q
"RTN","ORY21106",82,0)
 ;;R^"860.8:",100,4
"RTN","ORY21106",83,0)
 ;;D^  ; ;
"RTN","ORY21106",84,0)
 ;;EOR^
"RTN","ORY21106",85,0)
 ;;KEY^860.8:^NEW RULE MESSAGE
"RTN","ORY21106",86,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21106",87,0)
 ;;D^NEW RULE MESSAGE
"RTN","ORY21106",88,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21106",89,0)
 ;;D^NEWRULE
"RTN","ORY21106",90,0)
 ;;R^"860.8:",100,1
"RTN","ORY21106",91,0)
 ;;D^  ;NEWRULE(OCXDFN,OCXORD,OCXRUL,OCXREL,OCXNOTF,OCXMESS) ; Has this rule already been triggered for this order number
"RTN","ORY21106",92,0)
 ;;R^"860.8:",100,2
"RTN","ORY21106",93,0)
 ;;D^  ; ;
"RTN","ORY21106",94,0)
 ;;R^"860.8:",100,3
"RTN","ORY21106",95,0)
 ;;D^L+; S OCXERR=$$TIMELOG("M","NEWRULE("_(+$G(OCXDFN))_","_(+$G(OCXORD))_","_(+$G(OCXRUL))_","_(+$G(OCXREL))_","_(+$G(OCXNOTF))_","_$G(OCXMESS)_")")
"RTN","ORY21106",96,0)
 ;;R^"860.8:",100,4
"RTN","ORY21106",97,0)
 ;;D^  ; ;
"RTN","ORY21106",98,0)
 ;;R^"860.8:",100,5
"RTN","ORY21106",99,0)
 ;;D^  ; Q:'$G(OCXDFN) 0 Q:'$G(OCXRUL) 0
"RTN","ORY21106",100,0)
 ;;R^"860.8:",100,6
"RTN","ORY21106",101,0)
 ;;D^  ; Q:'$G(OCXREL) 0  Q:'$G(OCXNOTF) 0  Q:'$L($G(OCXMESS)) 0
"RTN","ORY21106",102,0)
 ;;R^"860.8:",100,7
"RTN","ORY21106",103,0)
 ;;D^  ; S OCXORD=+$G(OCXORD),OCXDFN=+OCXDFN
"RTN","ORY21106",104,0)
 ;;R^"860.8:",100,8
"RTN","ORY21106",105,0)
 ;;D^  ; ;
"RTN","ORY21106",106,0)
 ;;R^"860.8:",100,9
"RTN","ORY21106",107,0)
 ;;D^  ; N OCXNDX,OCXDATA,OCXDFI,OCXELE,OCXGR,OCXTIME,OCXCKSUM,OCXTSP,OCXTSPL
"RTN","ORY21106",108,0)
 ;;R^"860.8:",100,10
"RTN","ORY21106",109,0)
 ;;D^  ; ;
"RTN","ORY21106",110,0)
 ;;R^"860.8:",100,11
"RTN","ORY21106",111,0)
 ;;D^  ; S OCXTIME=(+$H)
"RTN","ORY21106",112,0)
 ;;R^"860.8:",100,12
"RTN","ORY21106",113,0)
 ;;D^  ; S OCXCKSUM=$$CKSUM(OCXMESS)
"RTN","ORY21106",114,0)
 ;;R^"860.8:",100,13
"RTN","ORY21106",115,0)
 ;;D^  ; ;
"RTN","ORY21106",116,0)
 ;;R^"860.8:",100,14
"RTN","ORY21106",117,0)
 ;;D^  ; S OCXTSP=($H*86400)+$P($H,",",2)
"RTN","ORY21106",118,0)
 ;;R^"860.8:",100,15
"RTN","ORY21106",119,0)
 ;;D^  ; S OCXTSPI=300
"RTN","ORY21106",120,0)
 ;;R^"860.8:",100,16
"RTN","ORY21106",121,0)
 ;;D^  ; S OCXTSPL=($G(^OCXD(860.7,"AT",OCXTIME,OCXDFN,OCXRUL,+OCXORD,OCXCKSUM))+$G(OCXTSPI))
"RTN","ORY21106",122,0)
 ;;R^"860.8:",100,17
"RTN","ORY21106",123,0)
 ;;D^  ; ;
"RTN","ORY21106",124,0)
 ;;R^"860.8:",100,18
"RTN","ORY21106",125,0)
 ;;D^  ; Q:(OCXTSPL>OCXTSP) 0
"RTN","ORY21106",126,0)
 ;;R^"860.8:",100,19
"RTN","ORY21106",127,0)
 ;;D^  ; ;
"RTN","ORY21106",128,0)
 ;;R^"860.8:",100,20
"RTN","ORY21106",129,0)
 ;;D^  ; K OCXDATA
"RTN","ORY21106",130,0)
 ;;R^"860.8:",100,21
"RTN","ORY21106",131,0)
 ;;D^  ; S OCXDATA(OCXDFN,0)=OCXDFN
"RTN","ORY21106",132,0)
 ;;R^"860.8:",100,22
"RTN","ORY21106",133,0)
 ;;D^  ; S OCXDATA("B",OCXDFN,OCXDFN)=""
"RTN","ORY21106",134,0)
 ;;R^"860.8:",100,23
"RTN","ORY21106",135,0)
 ;;D^  ; S OCXDATA("AT",OCXTIME,OCXDFN,OCXRUL,+OCXORD,OCXCKSUM)=OCXTSP
"RTN","ORY21106",136,0)
 ;;R^"860.8:",100,24
"RTN","ORY21106",137,0)
 ;;D^  ; ;
"RTN","ORY21106",138,0)
 ;;R^"860.8:",100,25
"RTN","ORY21106",139,0)
 ;;D^  ; S OCXGR="^OCXD(860.7"
"RTN","ORY21106",140,0)
 ;;R^"860.8:",100,26
"RTN","ORY21106",141,0)
 ;;D^T+; D SETAP(OCXGR_")",0,"Patient",$P($G(^DPT(OCXDFN,0)),U,1),.OCXDATA,OCXDFN)
"RTN","ORY21106",142,0)
 ;;R^"860.8:",100,27
"RTN","ORY21106",143,0)
 ;;D^T-; D SETAP(OCXGR_")",0,.OCXDATA,OCXDFN)
"RTN","ORY21106",144,0)
 ;;R^"860.8:",100,28
"RTN","ORY21106",145,0)
 ;;D^  ; ;
"RTN","ORY21106",146,0)
 ;;R^"860.8:",100,29
"RTN","ORY21106",147,0)
 ;;D^  ; K OCXDATA
"RTN","ORY21106",148,0)
 ;;R^"860.8:",100,30
"RTN","ORY21106",149,0)
 ;;D^  ; S OCXDATA(OCXRUL,0)=OCXRUL_U_(OCXTIME)_U_(+OCXORD)
"RTN","ORY21106",150,0)
 ;;R^"860.8:",100,31
"RTN","ORY21106",151,0)
 ;;D^  ; S OCXDATA(OCXRUL,"M")=OCXMESS
"RTN","ORY21106",152,0)
 ;;R^"860.8:",100,32
"RTN","ORY21106",153,0)
 ;;D^  ; S OCXDATA("B",OCXRUL,OCXRUL)=""
"RTN","ORY21106",154,0)
 ;;R^"860.8:",100,33
"RTN","ORY21106",155,0)
 ;;D^  ; S OCXGR=OCXGR_","_OCXDFN_",1"
"RTN","ORY21106",156,0)
 ;;R^"860.8:",100,34
"RTN","ORY21106",157,0)
 ;;D^T+; D SETAP(OCXGR_")","860.71P","Rule",$P($G(^OCXS(860.2,OCXRUL,0)),U,1),.OCXDATA,OCXRUL)
"RTN","ORY21106",158,0)
 ;;R^"860.8:",100,35
"RTN","ORY21106",159,0)
 ;;D^T-; D SETAP(OCXGR_")","860.71P",.OCXDATA,OCXRUL)
"RTN","ORY21106",160,0)
 ;;R^"860.8:",100,36
"RTN","ORY21106",161,0)
 ;;D^  ; ;
"RTN","ORY21106",162,0)
 ;;R^"860.8:",100,37
"RTN","ORY21106",163,0)
 ;;D^  ; K OCXDATA
"RTN","ORY21106",164,0)
 ;;R^"860.8:",100,38
"RTN","ORY21106",165,0)
 ;;D^  ; S OCXDATA(OCXREL,0)=OCXREL
"RTN","ORY21106",166,0)
 ;;R^"860.8:",100,39
"RTN","ORY21106",167,0)
 ;;D^  ; S OCXDATA("B",OCXREL,OCXREL)=""
"RTN","ORY21106",168,0)
 ;;R^"860.8:",100,40
"RTN","ORY21106",169,0)
 ;;D^  ; S OCXGR=OCXGR_","_OCXRUL_",1"
"RTN","ORY21106",170,0)
 ;;R^"860.8:",100,41
"RTN","ORY21106",171,0)
 ;;D^T+; D SETAP(OCXGR_")","860.712","Relation",OCXREL,.OCXDATA,OCXREL)
"RTN","ORY21106",172,0)
 ;;R^"860.8:",100,42
"RTN","ORY21106",173,0)
 ;;D^T-; D SETAP(OCXGR_")","860.712",.OCXDATA,OCXREL)
"RTN","ORY21106",174,0)
 ;;R^"860.8:",100,43
"RTN","ORY21106",175,0)
 ;;D^  ; ;
"RTN","ORY21106",176,0)
 ;;R^"860.8:",100,44
"RTN","ORY21106",177,0)
 ;;D^  ; S OCXELE=0 F  S OCXELE=$O(^OCXS(860.2,OCXRUL,"C","C",OCXELE)) Q:'OCXELE  D
"RTN","ORY21106",178,0)
 ;;R^"860.8:",100,45
"RTN","ORY21106",179,0)
 ;;D^  ; .;
"RTN","ORY21106",180,0)
 ;;R^"860.8:",100,46
"RTN","ORY21106",181,0)
 ;;D^  ; .N OCXGR1
"RTN","ORY21106",182,0)
 ;;R^"860.8:",100,47
"RTN","ORY21106",183,0)
 ;;D^  ; .S OCXGR1=OCXGR_","_OCXREL_",1"
"RTN","ORY21106",184,0)
 ;;R^"860.8:",100,48
"RTN","ORY21106",185,0)
 ;;D^  ; .K OCXDATA
"RTN","ORY21106",186,0)
 ;;R^"860.8:",100,49
"RTN","ORY21106",187,0)
 ;;D^  ; .S OCXDATA(OCXELE,0)=OCXELE
"RTN","ORY21106",188,0)
 ;;R^"860.8:",100,50
"RTN","ORY21106",189,0)
 ;;D^  ; .S OCXDATA(OCXELE,"TIME")=OCXTIME
"RTN","ORY21106",190,0)
 ;;R^"860.8:",100,51
"RTN","ORY21106",191,0)
 ;;D^  ; .S OCXDATA(OCXELE,"LOG")=$G(OCXOLOG)
"RTN","ORY21106",192,0)
 ;;R^"860.8:",100,52
"RTN","ORY21106",193,0)
 ;;D^  ; .S OCXDATA("B",OCXELE,OCXELE)=""
"RTN","ORY21106",194,0)
 ;;R^"860.8:",100,53
"RTN","ORY21106",195,0)
 ;;D^  ; .K ^OCXD(860.7,OCXDFN,1,OCXRUL,1,OCXREL,1,OCXELE)
"RTN","ORY21106",196,0)
 ;;R^"860.8:",100,54
"RTN","ORY21106",197,0)
 ;;D^T+; .D SETAP(OCXGR1_")","860.7122P","Element",$P($G(^OCXS(860.3,OCXELE,0)),U,1),.OCXDATA,OCXELE)
"RTN","ORY21106",198,0)
 ;;R^"860.8:",100,55
"RTN","ORY21106",199,0)
 ;;D^T-; .D SETAP(OCXGR1_")","860.7122P",.OCXDATA,OCXELE)
"RTN","ORY21106",200,0)
 ;;R^"860.8:",100,56
"RTN","ORY21106",201,0)
 ;;D^  ; .;
"RTN","ORY21106",202,0)
 ;;R^"860.8:",100,57
"RTN","ORY21106",203,0)
 ;;D^  ; .S OCXDFI=0 F  S OCXDFI=$O(^TMP("OCXCHK",$J,OCXDFN,OCXELE,OCXDFI)) Q:'OCXDFI  D
"RTN","ORY21106",204,0)
 ;;R^"860.8:",100,58
"RTN","ORY21106",205,0)
 ;;D^  ; ..N OCXGR2
"RTN","ORY21106",206,0)
 ;;R^"860.8:",100,59
"RTN","ORY21106",207,0)
 ;;D^  ; ..S OCXGR2=OCXGR1_","_OCXELE_",1"
"RTN","ORY21106",208,0)
 ;;R^"860.8:",100,60
"RTN","ORY21106",209,0)
 ;;D^  ; ..K OCXDATA
"RTN","ORY21106",210,0)
 ;;R^"860.8:",100,61
"RTN","ORY21106",211,0)
 ;;D^  ; ..S OCXDATA(OCXDFI,0)=OCXDFI
"RTN","ORY21106",212,0)
 ;;R^"860.8:",100,62
"RTN","ORY21106",213,0)
 ;;D^  ; ..S OCXDATA(OCXDFI,"VAL")=^TMP("OCXCHK",$J,OCXDFN,OCXELE,OCXDFI)
"RTN","ORY21106",214,0)
 ;;R^"860.8:",100,63
"RTN","ORY21106",215,0)
 ;;D^  ; ..S OCXDATA("B",OCXDFI,OCXDFI)=""
"RTN","ORY21106",216,0)
 ;;R^"860.8:",100,64
"RTN","ORY21106",217,0)
 ;;D^T+; ..D SETAP(OCXGR2_")","860.71223P","Data Field",$P($G(^OCXS(860.4,OCXDFI,0)),U,1),.OCXDATA,OCXDFI)
"RTN","ORY21106",218,0)
 ;;R^"860.8:",100,65
"RTN","ORY21106",219,0)
 ;;D^T-; ..D SETAP(OCXGR2_")","860.71223P",.OCXDATA,OCXDFI)
"RTN","ORY21106",220,0)
 ;;R^"860.8:",100,66
"RTN","ORY21106",221,0)
 ;;D^  ; ;
"RTN","ORY21106",222,0)
 ;;R^"860.8:",100,67
"RTN","ORY21106",223,0)
 ;;D^  ; Q 1
"RTN","ORY21106",224,0)
 ;;R^"860.8:",100,68
"RTN","ORY21106",225,0)
 ;;D^  ; ;
"RTN","ORY21106",226,0)
 ;;R^"860.8:",100,69
"RTN","ORY21106",227,0)
 ;;D^T+;SETAP(ROOT,DD,ITEM,ITEMNAME,DATA,DA) ;  Set Rule Event data
"RTN","ORY21106",228,0)
 ;;R^"860.8:",100,70
"RTN","ORY21106",229,0)
 ;;D^T-;SETAP(ROOT,DD,DATA,DA) ;  Set Rule Event data
"RTN","ORY21106",230,0)
 ;;R^"860.8:",100,71
"RTN","ORY21106",231,0)
 ;;D^  ; M @ROOT=DATA
"RTN","ORY21106",232,0)
 ;;R^"860.8:",100,72
"RTN","ORY21106",233,0)
 ;;D^  ; I +$G(DD) S @ROOT@(0)="^"_($G(DD))_"^"_($P($G(@ROOT@(0)),U,3)+1)_"^"_$G(DA)
"RTN","ORY21106",234,0)
 ;;R^"860.8:",100,73
"RTN","ORY21106",235,0)
 ;;D^  ; I '$G(DD) S $P(@ROOT@(0),U,3,4)=($P($G(@ROOT@(0)),U,3)+1)_"^"_$G(DA)
"RTN","ORY21106",236,0)
 ;;R^"860.8:",100,74
"RTN","ORY21106",237,0)
 ;;D^T+; W:$G(OCXTRACE) !,"File Active Data ",$G(ITEM),": ",$G(ITEMNAME)
"RTN","ORY21106",238,0)
 ;;R^"860.8:",100,75
"RTN","ORY21106",239,0)
 ;;D^  ; ;
"RTN","ORY21106",240,0)
 ;;R^"860.8:",100,76
"RTN","ORY21106",241,0)
 ;;D^  ; Q
"RTN","ORY21106",242,0)
 ;;R^"860.8:",100,77
"RTN","ORY21106",243,0)
 ;;D^  ; ;
"RTN","ORY21106",244,0)
 ;;R^"860.8:",100,78
"RTN","ORY21106",245,0)
 ;;D^  ; ;
"RTN","ORY21106",246,0)
 ;;EOR^
"RTN","ORY21106",247,0)
 ;;KEY^860.8:^RECENT CREATININE LAB PROCEDURE
"RTN","ORY21106",248,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21106",249,0)
 ;;D^RECENT CREATININE LAB PROCEDURE
"RTN","ORY21106",250,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21106",251,0)
 ;;D^RECCREAT
"RTN","ORY21106",252,0)
 ;;R^"860.8:",100,1
"RTN","ORY21106",253,0)
 ;;D^   ;RECCREAT(ORDFN,ORDAYS)  ;extrinsic function to return most recent 
"RTN","ORY21106",254,0)
 ;1;
"RTN","ORY21106",255,0)
 ;
"RTN","ORY21107")
0^8^B65528220
"RTN","ORY21107",1,0)
ORY21107 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY21107",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY21107",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY21107",4,0)
 ;
"RTN","ORY21107",5,0)
S ;
"RTN","ORY21107",6,0)
 ;
"RTN","ORY21107",7,0)
 D DOT^ORY211ES
"RTN","ORY21107",8,0)
 ;
"RTN","ORY21107",9,0)
 ;
"RTN","ORY21107",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY21107",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY21107",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY21107",13,0)
 ;
"RTN","ORY21107",14,0)
 G ^ORY21108
"RTN","ORY21107",15,0)
 ;
"RTN","ORY21107",16,0)
 Q
"RTN","ORY21107",17,0)
 ;
"RTN","ORY21107",18,0)
DATA ;
"RTN","ORY21107",19,0)
 ;
"RTN","ORY21107",20,0)
 ;;R^"860.8:",100,2
"RTN","ORY21107",21,0)
 ;;D^   ; ;SERUM CREATININE within <ORDAYS> in format:
"RTN","ORY21107",22,0)
 ;;R^"860.8:",100,3
"RTN","ORY21107",23,0)
 ;;D^   ; ; test id^result units flag ref range collection d/t
"RTN","ORY21107",24,0)
 ;;R^"860.8:",100,4
"RTN","ORY21107",25,0)
 ;;D^   ; N BDT,CDT,ORY,ORX,ORZ,X,ORI,ORJ,CREARSLT,LABFILE,SPECFILE
"RTN","ORY21107",26,0)
 ;;R^"860.8:",100,5
"RTN","ORY21107",27,0)
 ;;D^   ; Q:'$L($G(ORDFN)) "0^"
"RTN","ORY21107",28,0)
 ;;R^"860.8:",100,6
"RTN","ORY21107",29,0)
 ;;D^   ; Q:'$L($G(ORDAYS)) "0^"
"RTN","ORY21107",30,0)
 ;;R^"860.8:",100,7
"RTN","ORY21107",31,0)
 ;;D^   ; D NOW^%DTC
"RTN","ORY21107",32,0)
 ;;R^"860.8:",100,8
"RTN","ORY21107",33,0)
 ;;D^   ; S BDT=$$FMADD^XLFDT(%,"-"_ORDAYS,"","","")
"RTN","ORY21107",34,0)
 ;;R^"860.8:",100,9
"RTN","ORY21107",35,0)
 ;;D^   ; K %
"RTN","ORY21107",36,0)
 ;;R^"860.8:",100,10
"RTN","ORY21107",37,0)
 ;;D^   ; Q:'$L($G(BDT)) "0^"
"RTN","ORY21107",38,0)
 ;;R^"860.8:",100,11
"RTN","ORY21107",39,0)
 ;;D^   ; S LABFILE=$$TERMLKUP("SERUM CREATININE",.ORY)
"RTN","ORY21107",40,0)
 ;;R^"860.8:",100,12
"RTN","ORY21107",41,0)
 ;;D^   ; Q:$G(LABFILE)'=60 "0^"
"RTN","ORY21107",42,0)
 ;;R^"860.8:",100,13
"RTN","ORY21107",43,0)
 ;;D^   ; Q:+$D(ORY)<1 "0^"
"RTN","ORY21107",44,0)
 ;;R^"860.8:",100,14
"RTN","ORY21107",45,0)
 ;;D^   ; S SPECFILE=$$TERMLKUP("SERUM SPECIMEN",.ORX)
"RTN","ORY21107",46,0)
 ;;R^"860.8:",100,15
"RTN","ORY21107",47,0)
 ;;D^   ; Q:$G(SPECFILE)'=61 "0^"
"RTN","ORY21107",48,0)
 ;;R^"860.8:",100,16
"RTN","ORY21107",49,0)
 ;;D^   ; Q:+$D(ORX)<1 "0^"
"RTN","ORY21107",50,0)
 ;;R^"860.8:",100,17
"RTN","ORY21107",51,0)
 ;;D^   ; S ORI=0 F  S ORI=$O(ORY(ORI)) Q:'ORI  I +$G(CREARSLT)<1 D
"RTN","ORY21107",52,0)
 ;;R^"860.8:",100,18
"RTN","ORY21107",53,0)
 ;;D^   ; .S ORJ=0 F  S ORJ=$O(ORX(ORJ)) Q:'ORJ  I +$G(CREARSLT)<1 D
"RTN","ORY21107",54,0)
 ;;R^"860.8:",100,19
"RTN","ORY21107",55,0)
 ;;D^   ; ..S ORZ=$$LOCL^ORQQLR1(ORDFN,ORI,ORJ)
"RTN","ORY21107",56,0)
 ;;R^"860.8:",100,20
"RTN","ORY21107",57,0)
 ;;D^   ; ..Q:'$L($G(ORZ))
"RTN","ORY21107",58,0)
 ;;R^"860.8:",100,21
"RTN","ORY21107",59,0)
 ;;D^   ; ..S CDT=$P(ORZ,U,7)
"RTN","ORY21107",60,0)
 ;;R^"860.8:",100,22
"RTN","ORY21107",61,0)
 ;;D^   ; ..I CDT'<BDT S CREARSLT=1
"RTN","ORY21107",62,0)
 ;;R^"860.8:",100,23
"RTN","ORY21107",63,0)
 ;;D^   ; Q:+$G(CREARSLT)<1 "0^"
"RTN","ORY21107",64,0)
 ;;R^"860.8:",100,24
"RTN","ORY21107",65,0)
 ;;D^   ; Q $P(ORZ,U)_U_$P(ORZ,U,3)_" "_$P(ORZ,U,4)_" "_$P(ORZ,U,5)_" ("_$P(ORZ,U,6)_")  "_$$FMTE^XLFDT(CDT,"2P")_U_$P(ORZ,U,3)
"RTN","ORY21107",66,0)
 ;;EOR^
"RTN","ORY21107",67,0)
 ;;KEY^860.8:^RETURN POINTED TO VALUE
"RTN","ORY21107",68,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21107",69,0)
 ;;D^RETURN POINTED TO VALUE
"RTN","ORY21107",70,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21107",71,0)
 ;;D^POINTER
"RTN","ORY21107",72,0)
 ;;R^"860.8:",1,1
"RTN","ORY21107",73,0)
 ;;D^  ;POINTER(OCXFILE,D0) ;    This Local Extrinsic Function gets the value of the name field
"RTN","ORY21107",74,0)
 ;;R^"860.8:",1,2
"RTN","ORY21107",75,0)
 ;;D^  ; ;  of record D0 in file OCXFILE
"RTN","ORY21107",76,0)
 ;;R^"860.8:",100,1
"RTN","ORY21107",77,0)
 ;;D^  ;POINTER(OCXFILE,D0) ;    This Local Extrinsic Function gets the value of the name field
"RTN","ORY21107",78,0)
 ;;R^"860.8:",100,2
"RTN","ORY21107",79,0)
 ;;D^  ; ;  of record D0 in file OCXFILE
"RTN","ORY21107",80,0)
 ;;R^"860.8:",100,3
"RTN","ORY21107",81,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20,"   FILE: ",$G(OCXFILE),"  D0: ",$G(D0)
"RTN","ORY21107",82,0)
 ;;R^"860.8:",100,4
"RTN","ORY21107",83,0)
 ;;D^  ; Q:'$G(D0) "" Q:'$L($G(OCXFILE)) ""
"RTN","ORY21107",84,0)
 ;;R^"860.8:",100,5
"RTN","ORY21107",85,0)
 ;;D^  ; N GLREF
"RTN","ORY21107",86,0)
 ;;R^"860.8:",100,6
"RTN","ORY21107",87,0)
 ;;D^  ; I '(OCXFILE=(+OCXFILE)) S GLREF=U_OCXFILE
"RTN","ORY21107",88,0)
 ;;R^"860.8:",100,7
"RTN","ORY21107",89,0)
 ;;D^  ; E  S GLREF=$$FILE^OCXBDTD(+OCXFILE,"GLOBAL NAME") Q:'$L(GLREF) ""
"RTN","ORY21107",90,0)
 ;;R^"860.8:",100,8
"RTN","ORY21107",91,0)
 ;;D^T+; I $G(OCXTRACE) W !,"%%%%",?20," GLREF: ",GLREF,"  RESOLVES TO: ",$P($G(@(GLREF_(+D0)_",0)")),U,1)
"RTN","ORY21107",92,0)
 ;;R^"860.8:",100,9
"RTN","ORY21107",93,0)
 ;;D^  ; Q $P($G(@(GLREF_(+D0)_",0)")),U,1)
"RTN","ORY21107",94,0)
 ;;R^"860.8:",100,10
"RTN","ORY21107",95,0)
 ;;D^  ; ;
"RTN","ORY21107",96,0)
 ;;EOR^
"RTN","ORY21107",97,0)
 ;;KEY^860.8:^STRING CONTAINS ONE OF A LIST OF VALUES
"RTN","ORY21107",98,0)
 ;;R^"860.8:",.01,"E"
"RTN","ORY21107",99,0)
 ;;D^STRING CONTAINS ONE OF A LIST OF VALUES
"RTN","ORY21107",100,0)
 ;;R^"860.8:",.02,"E"
"RTN","ORY21107",101,0)
 ;;D^CLIST
"RTN","ORY21107",102,0)
 ;;R^"860.8:",100,1
"RTN","ORY21107",103,0)
 ;;D^  ;CLIST(DATA,LIST) ;   DOES THE DATA FIELD CONTAIN AN ELEMENT IN THE LIST
"RTN","ORY21107",104,0)
 ;;R^"860.8:",100,2
"RTN","ORY21107",105,0)
 ;;D^  ; ;
"RTN","ORY21107",106,0)
 ;;R^"860.8:",100,3
"RTN","ORY21107",107,0)
 ;;D^T+; W:$G(OCXTRACE) !!,"$$CLIST(",DATA,",""",LIST,""")"
"RTN","ORY21107",108,0)
 ;;R^"860.8:",100,4
"RTN","ORY21107",109,0)
 ;;D^  ; N PC F PC=1:1:$L(LIST,","),0 I PC,$L($P(LIST,",",PC)),(DATA[$P(LIST,",",PC)) Q
"RTN","ORY21107",110,0)
 ;;R^"860.8:",100,5
"RTN","ORY21107",111,0)
 ;;D^  ; Q ''PC
"RTN","ORY21107",112,0)
 ;;EOR^
"RTN","ORY21107",113,0)
 ;;EOF^OCXS(860.8)^1
"RTN","ORY21107",114,0)
 ;;SOF^860.6  ORDER CHECK DATA CONTEXT
"RTN","ORY21107",115,0)
 ;;KEY^860.6:^CPRS ORDER PRESCAN
"RTN","ORY21107",116,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY21107",117,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY21107",118,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY21107",119,0)
 ;;D^OEPS
"RTN","ORY21107",120,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY21107",121,0)
 ;;D^DATA DRIVEN
"RTN","ORY21107",122,0)
 ;;EOR^
"RTN","ORY21107",123,0)
 ;;KEY^860.6:^CPRS ORDER PROTOCOL
"RTN","ORY21107",124,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY21107",125,0)
 ;;D^CPRS ORDER PROTOCOL
"RTN","ORY21107",126,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY21107",127,0)
 ;;D^OERR
"RTN","ORY21107",128,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY21107",129,0)
 ;;D^DATA DRIVEN
"RTN","ORY21107",130,0)
 ;;EOR^
"RTN","ORY21107",131,0)
 ;;KEY^860.6:^DATABASE LOOKUP
"RTN","ORY21107",132,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY21107",133,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21107",134,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY21107",135,0)
 ;;D^DL
"RTN","ORY21107",136,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY21107",137,0)
 ;;D^PACKAGE LOOKUP
"RTN","ORY21107",138,0)
 ;;EOR^
"RTN","ORY21107",139,0)
 ;;KEY^860.6:^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY21107",140,0)
 ;;R^"860.6:",.01,"E"
"RTN","ORY21107",141,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY21107",142,0)
 ;;R^"860.6:",.02,"E"
"RTN","ORY21107",143,0)
 ;;D^HL7
"RTN","ORY21107",144,0)
 ;;R^"860.6:",1,"E"
"RTN","ORY21107",145,0)
 ;;D^DATA DRIVEN
"RTN","ORY21107",146,0)
 ;;EOR^
"RTN","ORY21107",147,0)
 ;;EOF^OCXS(860.6)^1
"RTN","ORY21107",148,0)
 ;;SOF^860.5  ORDER CHECK DATA SOURCE
"RTN","ORY21107",149,0)
 ;;KEY^860.5:^DATABASE LOOKUP
"RTN","ORY21107",150,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY21107",151,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21107",152,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY21107",153,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21107",154,0)
 ;;EOR^
"RTN","ORY21107",155,0)
 ;;KEY^860.5:^HL7 COMMON ORDER SEGMENT
"RTN","ORY21107",156,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY21107",157,0)
 ;;D^HL7 COMMON ORDER SEGMENT
"RTN","ORY21107",158,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY21107",159,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY21107",160,0)
 ;;EOR^
"RTN","ORY21107",161,0)
 ;;KEY^860.5:^HL7 PATIENT ID SEGMENT
"RTN","ORY21107",162,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY21107",163,0)
 ;;D^HL7 PATIENT ID SEGMENT
"RTN","ORY21107",164,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY21107",165,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY21107",166,0)
 ;;EOR^
"RTN","ORY21107",167,0)
 ;;KEY^860.5:^OERR ORDER EVENT FLAG PROTOCOL
"RTN","ORY21107",168,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY21107",169,0)
 ;;D^OERR ORDER EVENT FLAG PROTOCOL
"RTN","ORY21107",170,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY21107",171,0)
 ;;D^CPRS ORDER PROTOCOL
"RTN","ORY21107",172,0)
 ;;EOR^
"RTN","ORY21107",173,0)
 ;;KEY^860.5:^ORDER ENTRY ORDER PRESCAN
"RTN","ORY21107",174,0)
 ;;R^"860.5:",.01,"E"
"RTN","ORY21107",175,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY21107",176,0)
 ;;R^"860.5:",.02,"E"
"RTN","ORY21107",177,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY21107",178,0)
 ;;EOR^
"RTN","ORY21107",179,0)
 ;;EOF^OCXS(860.5)^1
"RTN","ORY21107",180,0)
 ;;SOF^860.4  ORDER CHECK DATA FIELD
"RTN","ORY21107",181,0)
 ;;KEY^860.4:^ABNORMAL RENAL BIOCHEM RESULTS
"RTN","ORY21107",182,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY21107",183,0)
 ;;D^ABNORMAL RENAL BIOCHEM RESULTS
"RTN","ORY21107",184,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY21107",185,0)
 ;;D^FREE TEXT
"RTN","ORY21107",186,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY21107",187,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21107",188,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY21107",189,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21107",190,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY21107",191,0)
 ;;D^PATIENT.REC_RENAL_ABNORM_RES
"RTN","ORY21107",192,0)
 ;;EOR^
"RTN","ORY21107",193,0)
 ;;KEY^860.4:^CONTRAST MEDIA CODE
"RTN","ORY21107",194,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY21107",195,0)
 ;;D^CONTRAST MEDIA CODE
"RTN","ORY21107",196,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY21107",197,0)
 ;;D^CMC
"RTN","ORY21107",198,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY21107",199,0)
 ;;D^FREE TEXT
"RTN","ORY21107",200,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY21107",201,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21107",202,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY21107",203,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21107",204,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY21107",205,0)
 ;;D^PATIENT.CONTR_MED_CODE
"RTN","ORY21107",206,0)
 ;;EOR^
"RTN","ORY21107",207,0)
 ;;KEY^860.4:^FILLER
"RTN","ORY21107",208,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY21107",209,0)
 ;;D^FILLER
"RTN","ORY21107",210,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY21107",211,0)
 ;;D^FILL
"RTN","ORY21107",212,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY21107",213,0)
 ;;D^FREE TEXT
"RTN","ORY21107",214,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.01,"E"
"RTN","ORY21107",215,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY21107",216,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.02,"E"
"RTN","ORY21107",217,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY21107",218,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",1,"E"
"RTN","ORY21107",219,0)
 ;;D^PATIENT.OPS_FILLER
"RTN","ORY21107",220,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.01,"E"
"RTN","ORY21107",221,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY21107",222,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.02,"E"
"RTN","ORY21107",223,0)
 ;;D^HL7 COMMON ORDER SEGMENT
"RTN","ORY21107",224,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",1,"E"
"RTN","ORY21107",225,0)
 ;;D^PATIENT.HL7_FILLER
"RTN","ORY21107",226,0)
 ;;EOR^
"RTN","ORY21107",227,0)
 ;;KEY^860.4:^MOST RECENT RENAL TEST ABNORMAL FLAG
"RTN","ORY21107",228,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY21107",229,0)
 ;;D^MOST RECENT RENAL TEST ABNORMAL FLAG
"RTN","ORY21107",230,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY21107",231,0)
 ;;D^BOOLEAN
"RTN","ORY21107",232,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY21107",233,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21107",234,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY21107",235,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21107",236,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY21107",237,0)
 ;;D^PATIENT.REC_RENAL_ABNORM_FLAG
"RTN","ORY21107",238,0)
 ;;EOR^
"RTN","ORY21107",239,0)
 ;;KEY^860.4:^ORDER MODE
"RTN","ORY21107",240,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY21107",241,0)
 ;;D^ORDER MODE
"RTN","ORY21107",242,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY21107",243,0)
 ;;D^FREE TEXT
"RTN","ORY21107",244,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.01,"E"
"RTN","ORY21107",245,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY21107",246,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.02,"E"
"RTN","ORY21107",247,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY21107",248,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",1,"E"
"RTN","ORY21107",249,0)
 ;;D^PATIENT.OPS_ORD_MODE
"RTN","ORY21107",250,0)
 ;;EOR^
"RTN","ORY21107",251,0)
 ;;KEY^860.4:^ORDERABLE ITEM IEN
"RTN","ORY21107",252,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY21107",253,0)
 ;;D^ORDERABLE ITEM IEN
"RTN","ORY21107",254,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY21107",255,0)
 ;;D^NUMERIC
"RTN","ORY21107",256,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.01,"E"
"RTN","ORY21107",257,0)
 ;1;
"RTN","ORY21107",258,0)
 ;
"RTN","ORY21108")
0^9^B62474513
"RTN","ORY21108",1,0)
ORY21108 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY21108",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY21108",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY21108",4,0)
 ;
"RTN","ORY21108",5,0)
S ;
"RTN","ORY21108",6,0)
 ;
"RTN","ORY21108",7,0)
 D DOT^ORY211ES
"RTN","ORY21108",8,0)
 ;
"RTN","ORY21108",9,0)
 ;
"RTN","ORY21108",10,0)
 K REMOTE,LOCAL,OPCODE,REF
"RTN","ORY21108",11,0)
 F LINE=1:1:500 S TEXT=$P($T(DATA+LINE),";",2,999) Q:TEXT  I $L(TEXT) D  Q:QUIT
"RTN","ORY21108",12,0)
 .S ^TMP("OCXRULE",$J,$O(^TMP("OCXRULE",$J,"A"),-1)+1)=TEXT
"RTN","ORY21108",13,0)
 ;
"RTN","ORY21108",14,0)
 ;
"RTN","ORY21108",15,0)
 ;
"RTN","ORY21108",16,0)
 Q
"RTN","ORY21108",17,0)
 ;
"RTN","ORY21108",18,0)
DATA ;
"RTN","ORY21108",19,0)
 ;
"RTN","ORY21108",20,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY21108",21,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",.02,"E"
"RTN","ORY21108",22,0)
 ;;D^ORDER ENTRY ORDER PRESCAN
"RTN","ORY21108",23,0)
 ;;R^"860.4:","860.41:CPRS ORDER PRESCAN^860.6",1,"E"
"RTN","ORY21108",24,0)
 ;;D^PATIENT.ORDER_ITEM_IEN
"RTN","ORY21108",25,0)
 ;;EOR^
"RTN","ORY21108",26,0)
 ;;KEY^860.4:^PATIENT CURRENTLY ON GLUCOPHAGE
"RTN","ORY21108",27,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY21108",28,0)
 ;;D^PATIENT CURRENTLY ON GLUCOPHAGE
"RTN","ORY21108",29,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY21108",30,0)
 ;;D^BOOLEAN
"RTN","ORY21108",31,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY21108",32,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21108",33,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY21108",34,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21108",35,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY21108",36,0)
 ;;D^PATIENT.TAKING_GLUCOPHAGE
"RTN","ORY21108",37,0)
 ;;EOR^
"RTN","ORY21108",38,0)
 ;;KEY^860.4:^PATIENT IEN
"RTN","ORY21108",39,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY21108",40,0)
 ;;D^PATIENT IEN
"RTN","ORY21108",41,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY21108",42,0)
 ;;D^NUMERIC
"RTN","ORY21108",43,0)
 ;;R^"860.4:","860.41:CPRS ORDER PROTOCOL^860.6",.01,"E"
"RTN","ORY21108",44,0)
 ;;D^CPRS ORDER PROTOCOL
"RTN","ORY21108",45,0)
 ;;R^"860.4:","860.41:CPRS ORDER PROTOCOL^860.6",.02,"E"
"RTN","ORY21108",46,0)
 ;;D^OERR ORDER EVENT FLAG PROTOCOL
"RTN","ORY21108",47,0)
 ;;R^"860.4:","860.41:CPRS ORDER PROTOCOL^860.6",1,"E"
"RTN","ORY21108",48,0)
 ;;D^PATIENT.OERR_ORDER_PATIENT
"RTN","ORY21108",49,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY21108",50,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21108",51,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY21108",52,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21108",53,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY21108",54,0)
 ;;D^PATIENT.IEN
"RTN","ORY21108",55,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.01,"E"
"RTN","ORY21108",56,0)
 ;;D^GENERIC HL7 MESSAGE ARRAY
"RTN","ORY21108",57,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",.02,"E"
"RTN","ORY21108",58,0)
 ;;D^HL7 PATIENT ID SEGMENT
"RTN","ORY21108",59,0)
 ;;R^"860.4:","860.41:GENERIC HL7 MESSAGE ARRAY^860.6",1,"E"
"RTN","ORY21108",60,0)
 ;;D^PATIENT.HL7_PATIENT_ID
"RTN","ORY21108",61,0)
 ;;EOR^
"RTN","ORY21108",62,0)
 ;;KEY^860.4:^RECENT CONTRAST MEDIA CREATININE DAYS
"RTN","ORY21108",63,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY21108",64,0)
 ;;D^RECENT CONTRAST MEDIA CREATININE DAYS
"RTN","ORY21108",65,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY21108",66,0)
 ;;D^CM-CREAT DAYS
"RTN","ORY21108",67,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY21108",68,0)
 ;;D^NUMERIC
"RTN","ORY21108",69,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY21108",70,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21108",71,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY21108",72,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21108",73,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY21108",74,0)
 ;;D^PATIENT.CM_CREAT_DAYS
"RTN","ORY21108",75,0)
 ;;EOR^
"RTN","ORY21108",76,0)
 ;;KEY^860.4:^RECENT CONTRAST MEDIA CREATININE FLAG
"RTN","ORY21108",77,0)
 ;;R^"860.4:",.01,"E"
"RTN","ORY21108",78,0)
 ;;D^RECENT CONTRAST MEDIA CREATININE FLAG
"RTN","ORY21108",79,0)
 ;;R^"860.4:",1,"E"
"RTN","ORY21108",80,0)
 ;;D^CM-CREAT FLAG
"RTN","ORY21108",81,0)
 ;;R^"860.4:",101,"E"
"RTN","ORY21108",82,0)
 ;;D^BOOLEAN
"RTN","ORY21108",83,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.01,"E"
"RTN","ORY21108",84,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21108",85,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",.02,"E"
"RTN","ORY21108",86,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21108",87,0)
 ;;R^"860.4:","860.41:DATABASE LOOKUP^860.6",1,"E"
"RTN","ORY21108",88,0)
 ;;D^PATIENT.CM_CREAT_FLAG
"RTN","ORY21108",89,0)
 ;;EOR^
"RTN","ORY21108",90,0)
 ;;EOF^OCXS(860.4)^1
"RTN","ORY21108",91,0)
 ;;SOF^860.3  ORDER CHECK ELEMENT
"RTN","ORY21108",92,0)
 ;;KEY^860.3:^ABNORMAL RENAL RESULTS
"RTN","ORY21108",93,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY21108",94,0)
 ;;D^ABNORMAL RENAL RESULTS
"RTN","ORY21108",95,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY21108",96,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY21108",97,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY21108",98,0)
 ;;D^1
"RTN","ORY21108",99,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY21108",100,0)
 ;;D^MOST RECENT RENAL TEST ABNORMAL FLAG
"RTN","ORY21108",101,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY21108",102,0)
 ;;D^LOGICAL TRUE
"RTN","ORY21108",103,0)
 ;;EOR^
"RTN","ORY21108",104,0)
 ;;KEY^860.3:^CONTRAST MEDIA ORDER
"RTN","ORY21108",105,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY21108",106,0)
 ;;D^CONTRAST MEDIA ORDER
"RTN","ORY21108",107,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY21108",108,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY21108",109,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY21108",110,0)
 ;;D^1
"RTN","ORY21108",111,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY21108",112,0)
 ;;D^ORDER MODE
"RTN","ORY21108",113,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY21108",114,0)
 ;;D^EQ FREE TEXT
"RTN","ORY21108",115,0)
 ;;R^"860.3:","860.31:1",3,"E"
"RTN","ORY21108",116,0)
 ;;D^SELECT
"RTN","ORY21108",117,0)
 ;;R^"860.3:","860.31:4",.01,"E"
"RTN","ORY21108",118,0)
 ;;D^4
"RTN","ORY21108",119,0)
 ;;R^"860.3:","860.31:4",1,"E"
"RTN","ORY21108",120,0)
 ;;D^CONTRAST MEDIA CODE
"RTN","ORY21108",121,0)
 ;;R^"860.3:","860.31:4",2,"E"
"RTN","ORY21108",122,0)
 ;;D^CONTAINS ELEMENT IN SET
"RTN","ORY21108",123,0)
 ;;R^"860.3:","860.31:4",3,"E"
"RTN","ORY21108",124,0)
 ;;D^M,I,N
"RTN","ORY21108",125,0)
 ;;EOR^
"RTN","ORY21108",126,0)
 ;;KEY^860.3:^NO CREAT RESULTS W/IN X DAYS
"RTN","ORY21108",127,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY21108",128,0)
 ;;D^NO CREAT RESULTS W/IN X DAYS
"RTN","ORY21108",129,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY21108",130,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY21108",131,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY21108",132,0)
 ;;D^1
"RTN","ORY21108",133,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY21108",134,0)
 ;;D^RECENT CONTRAST MEDIA CREATININE FLAG
"RTN","ORY21108",135,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY21108",136,0)
 ;;D^LOGICAL FALSE
"RTN","ORY21108",137,0)
 ;;EOR^
"RTN","ORY21108",138,0)
 ;;KEY^860.3:^PATIENT WITH GLUCOPHAGE MED
"RTN","ORY21108",139,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY21108",140,0)
 ;;D^PATIENT WITH GLUCOPHAGE MED
"RTN","ORY21108",141,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY21108",142,0)
 ;;D^DATABASE LOOKUP
"RTN","ORY21108",143,0)
 ;;R^"860.3:","860.31:1",.01,"E"
"RTN","ORY21108",144,0)
 ;;D^1
"RTN","ORY21108",145,0)
 ;;R^"860.3:","860.31:1",1,"E"
"RTN","ORY21108",146,0)
 ;;D^PATIENT CURRENTLY ON GLUCOPHAGE
"RTN","ORY21108",147,0)
 ;;R^"860.3:","860.31:1",2,"E"
"RTN","ORY21108",148,0)
 ;;D^LOGICAL TRUE
"RTN","ORY21108",149,0)
 ;;EOR^
"RTN","ORY21108",150,0)
 ;;KEY^860.3:^RADIOLOGY PROCEDURE CONTAINS NON-BARIUM CONTRAST MEDIA
"RTN","ORY21108",151,0)
 ;;R^"860.3:",.01,"E"
"RTN","ORY21108",152,0)
 ;;D^RADIOLOGY PROCEDURE CONTAINS NON-BARIUM CONTRAST MEDIA
"RTN","ORY21108",153,0)
 ;;R^"860.3:",.02,"E"
"RTN","ORY21108",154,0)
 ;;D^CPRS ORDER PRESCAN
"RTN","ORY21108",155,0)
 ;;R^"860.3:","860.31:2",.01,"E"
"RTN","ORY21108",156,0)
 ;;D^2
"RTN","ORY21108",157,0)
 ;;R^"860.3:","860.31:2",1,"E"
"RTN","ORY21108",158,0)
 ;;D^ORDER MODE
"RTN","ORY21108",159,0)
 ;;R^"860.3:","860.31:2",2,"E"
"RTN","ORY21108",160,0)
 ;;D^EQ FREE TEXT
"RTN","ORY21108",161,0)
 ;;R^"860.3:","860.31:2",3,"E"
"RTN","ORY21108",162,0)
 ;;D^SELECT
"RTN","ORY21108",163,0)
 ;;R^"860.3:","860.31:3",.01,"E"
"RTN","ORY21108",164,0)
 ;;D^3
"RTN","ORY21108",165,0)
 ;;R^"860.3:","860.31:3",1,"E"
"RTN","ORY21108",166,0)
 ;;D^FILLER
"RTN","ORY21108",167,0)
 ;;R^"860.3:","860.31:3",2,"E"
"RTN","ORY21108",168,0)
 ;;D^EQ FREE TEXT
"RTN","ORY21108",169,0)
 ;;R^"860.3:","860.31:3",3,"E"
"RTN","ORY21108",170,0)
 ;;D^RA
"RTN","ORY21108",171,0)
 ;;R^"860.3:","860.31:4",.01,"E"
"RTN","ORY21108",172,0)
 ;;D^4
"RTN","ORY21108",173,0)
 ;;R^"860.3:","860.31:4",1,"E"
"RTN","ORY21108",174,0)
 ;;D^CONTRAST MEDIA CODE
"RTN","ORY21108",175,0)
 ;;R^"860.3:","860.31:4",2,"E"
"RTN","ORY21108",176,0)
 ;;D^CONTAINS ELEMENT IN SET
"RTN","ORY21108",177,0)
 ;;R^"860.3:","860.31:4",3,"E"
"RTN","ORY21108",178,0)
 ;;D^M,I,N
"RTN","ORY21108",179,0)
 ;;EOR^
"RTN","ORY21108",180,0)
 ;;EOF^OCXS(860.3)^1
"RTN","ORY21108",181,0)
 ;;SOF^860.2  ORDER CHECK RULE
"RTN","ORY21108",182,0)
 ;;KEY^860.2:^BIOCHEM ABNORMALITIES/CONTRAST MEDIA CHECK
"RTN","ORY21108",183,0)
 ;;R^"860.2:",.01,"E"
"RTN","ORY21108",184,0)
 ;;D^BIOCHEM ABNORMALITIES/CONTRAST MEDIA CHECK
"RTN","ORY21108",185,0)
 ;;R^"860.2:","860.21:1",.01,"E"
"RTN","ORY21108",186,0)
 ;;D^CONTRAST MEDIA ORDER
"RTN","ORY21108",187,0)
 ;;R^"860.2:","860.21:1",.02,"E"
"RTN","ORY21108",188,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY21108",189,0)
 ;;R^"860.2:","860.21:1",1,"E"
"RTN","ORY21108",190,0)
 ;;D^CONTRAST MEDIA ORDER
"RTN","ORY21108",191,0)
 ;;R^"860.2:","860.21:2",.01,"E"
"RTN","ORY21108",192,0)
 ;;D^ABNORMAL RENAL RESULTS
"RTN","ORY21108",193,0)
 ;;R^"860.2:","860.21:2",.02,"E"
"RTN","ORY21108",194,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY21108",195,0)
 ;;R^"860.2:","860.21:2",1,"E"
"RTN","ORY21108",196,0)
 ;;D^ABNORMAL RENAL RESULTS
"RTN","ORY21108",197,0)
 ;;R^"860.2:","860.21:3",.01,"E"
"RTN","ORY21108",198,0)
 ;;D^NO CREAT RESULTS W/IN X DAYS
"RTN","ORY21108",199,0)
 ;;R^"860.2:","860.21:3",.02,"E"
"RTN","ORY21108",200,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY21108",201,0)
 ;;R^"860.2:","860.21:3",1,"E"
"RTN","ORY21108",202,0)
 ;;D^NO CREAT RESULTS W/IN X DAYS
"RTN","ORY21108",203,0)
 ;;R^"860.2:","860.22:1",.01,"E"
"RTN","ORY21108",204,0)
 ;;D^1
"RTN","ORY21108",205,0)
 ;;R^"860.2:","860.22:1",1,"E"
"RTN","ORY21108",206,0)
 ;;D^CONTRAST MEDIA ORDER AND ABNORMAL RENAL RESULTS
"RTN","ORY21108",207,0)
 ;;R^"860.2:","860.22:1",2,"E"
"RTN","ORY21108",208,0)
 ;;D^BIOCHEM ABNORMALITY FOR CONTRAST MEDIA
"RTN","ORY21108",209,0)
 ;;R^"860.2:","860.22:1",6,"E"
"RTN","ORY21108",210,0)
 ;;D^Procedure uses intravenous contrast media - abnormal biochem result:  |ABNORMAL RENAL BIOCHEM RESULTS|
"RTN","ORY21108",211,0)
 ;;R^"860.2:","860.22:2",.01,"E"
"RTN","ORY21108",212,0)
 ;;D^2
"RTN","ORY21108",213,0)
 ;;R^"860.2:","860.22:2",1,"E"
"RTN","ORY21108",214,0)
 ;;D^CONTRAST MEDIA ORDER AND NO CREAT RESULTS W/IN X DAYS
"RTN","ORY21108",215,0)
 ;;R^"860.2:","860.22:2",2,"E"
"RTN","ORY21108",216,0)
 ;;D^BIOCHEM ABNORMALITY FOR CONTRAST MEDIA
"RTN","ORY21108",217,0)
 ;;R^"860.2:","860.22:2",6,"E"
"RTN","ORY21108",218,0)
 ;;D^Procedure uses intravenous contrast media - no creatinine results within |CM-CREAT DAYS| days
"RTN","ORY21108",219,0)
 ;;EOR^
"RTN","ORY21108",220,0)
 ;;KEY^860.2:^GLUCOPHAGE - CONTRAST MEDIA
"RTN","ORY21108",221,0)
 ;;R^"860.2:",.01,"E"
"RTN","ORY21108",222,0)
 ;;D^GLUCOPHAGE - CONTRAST MEDIA
"RTN","ORY21108",223,0)
 ;;R^"860.2:","860.21:1",.01,"E"
"RTN","ORY21108",224,0)
 ;;D^PROC USES NON-BARIUM MEDIA
"RTN","ORY21108",225,0)
 ;;R^"860.2:","860.21:1",.02,"E"
"RTN","ORY21108",226,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY21108",227,0)
 ;;R^"860.2:","860.21:1",1,"E"
"RTN","ORY21108",228,0)
 ;;D^RADIOLOGY PROCEDURE CONTAINS NON-BARIUM CONTRAST MEDIA
"RTN","ORY21108",229,0)
 ;;R^"860.2:","860.21:2",.01,"E"
"RTN","ORY21108",230,0)
 ;;D^PATIENT TAKING GLUCOPHAGE
"RTN","ORY21108",231,0)
 ;;R^"860.2:","860.21:2",.02,"E"
"RTN","ORY21108",232,0)
 ;;D^SIMPLE DEFINITION
"RTN","ORY21108",233,0)
 ;;R^"860.2:","860.21:2",1,"E"
"RTN","ORY21108",234,0)
 ;;D^PATIENT WITH GLUCOPHAGE MED
"RTN","ORY21108",235,0)
 ;;R^"860.2:","860.22:1",.01,"E"
"RTN","ORY21108",236,0)
 ;;D^1
"RTN","ORY21108",237,0)
 ;;R^"860.2:","860.22:1",1,"E"
"RTN","ORY21108",238,0)
 ;;D^IF PROC USES NON-BARIUM MEDIA AND PATIENT TAKING GLUCOPHAGE 
"RTN","ORY21108",239,0)
 ;;R^"860.2:","860.22:1",2,"E"
"RTN","ORY21108",240,0)
 ;;D^GLUCOPHAGE-CONTRAST MEDIA
"RTN","ORY21108",241,0)
 ;;R^"860.2:","860.22:1",6,"E"
"RTN","ORY21108",242,0)
 ;;D^Procedure uses intravenous contrast media and patient is taking metformin.
"RTN","ORY21108",243,0)
 ;;EOR^
"RTN","ORY21108",244,0)
 ;;EOF^OCXS(860.2)^1
"RTN","ORY21108",245,0)
 ;1;
"RTN","ORY21108",246,0)
 ;
"RTN","ORY2111")
0^10^B40557571
"RTN","ORY2111",1,0)
ORY2111 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY2111",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY2111",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY2111",4,0)
 ;
"RTN","ORY2111",5,0)
S ;
"RTN","ORY2111",6,0)
 ;
"RTN","ORY2111",7,0)
 Q
"RTN","ORY2111",8,0)
 ;
"RTN","ORY2111",9,0)
 ;
"RTN","ORY2111",10,0)
COMPARE(L,R) ;
"RTN","ORY2111",11,0)
 ;
"RTN","ORY2111",12,0)
 Q:$$RES("R") 1
"RTN","ORY2111",13,0)
 ;
"RTN","ORY2111",14,0)
 Q:'$L($O(L(""))) $$ADDREC^ORY2112("R")
"RTN","ORY2111",15,0)
 ;
"RTN","ORY2111",16,0)
 N C,OCXDD M C=L,C=R S OCXDD=$O(C("")) Q $$MULT("C",OCXDD)
"RTN","ORY2111",17,0)
 ;
"RTN","ORY2111",18,0)
 Q 0
"RTN","ORY2111",19,0)
 ;
"RTN","ORY2111",20,0)
RES(REF) ;
"RTN","ORY2111",21,0)
 ;
"RTN","ORY2111",22,0)
 N QUIT,SUB
"RTN","ORY2111",23,0)
 S QUIT=0
"RTN","ORY2111",24,0)
 S SUB="" F  S SUB=$O(@REF@(SUB)) Q:'$L(SUB)  I (SUB[":") D  Q:QUIT
"RTN","ORY2111",25,0)
 .N DD,DA
"RTN","ORY2111",26,0)
 .S DD=$P(SUB,":",1),DA=$P(SUB,":",2)
"RTN","ORY2111",27,0)
 .I $L(DA),'(DA=+DA) D  Q:QUIT
"RTN","ORY2111",28,0)
 ..N DANEW,SUBNEW
"RTN","ORY2111",29,0)
 ..S DANEW=$O(^OCXS($P(DA,U,2),"B",$P(DA,U,1),0))
"RTN","ORY2111",30,0)
 ..I 'DANEW W !!,$P($G(^OCXS(+$P(DA,U,2),0)),U,1),": ",$P(DA,U,1),"  could not resolve name.",!!,"    End Transport." S QUIT=1 Q
"RTN","ORY2111",31,0)
 ..S SUBNEW=DD_":"_DANEW
"RTN","ORY2111",32,0)
 ..I $D(@REF@(SUBNEW)) W !!," multiple #",DANEW," already existed." S QUIT=1 Q
"RTN","ORY2111",33,0)
 ..M @REF@(SUBNEW)=@REF@(SUB)
"RTN","ORY2111",34,0)
 ..K @REF@(SUB)
"RTN","ORY2111",35,0)
 ..S SUB=""
"RTN","ORY2111",36,0)
 .I $L(SUB),($D(@REF@(SUB))>9) S QUIT=$$RES($NA(@REF@(SUB)))
"RTN","ORY2111",37,0)
 ;
"RTN","ORY2111",38,0)
 Q QUIT
"RTN","ORY2111",39,0)
 ;
"RTN","ORY2111",40,0)
MULT(CREF,OCXDD) ;
"RTN","ORY2111",41,0)
 ;
"RTN","ORY2111",42,0)
 N OCXSUB,LREF,RREF,QUIT,OCXFLD
"RTN","ORY2111",43,0)
 S LREF="L"_$E(CREF,2,$L(CREF)),RREF="R"_$E(CREF,2,$L(CREF))
"RTN","ORY2111",44,0)
 ;
"RTN","ORY2111",45,0)
 S QUIT=0,OCXFLD="" F  S OCXFLD=$O(@CREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  D  Q:QUIT
"RTN","ORY2111",46,0)
 .I (OCXFLD[":") D  Q:QUIT
"RTN","ORY2111",47,0)
 ..Q:$$EXFLD(+OCXFLD,0)
"RTN","ORY2111",48,0)
 ..I '$D(@LREF@(OCXDD,OCXFLD,.01,"E")) D  M @LREF@(OCXDD,OCXFLD)=@RREF@(OCXDD,OCXFLD)
"RTN","ORY2111",49,0)
 ...D WARN("Missing multiple:",CREF,OCXDD,OCXFLD)
"RTN","ORY2111",50,0)
 ...S QUIT=$$ADDMULT^ORY2113(CREF,OCXDD,OCXFLD)
"RTN","ORY2111",51,0)
 ..I '$D(@RREF@(OCXDD,OCXFLD,.01,"E")) D  M @RREF@(OCXDD,OCXFLD)=@LREF@(OCXDD,OCXFLD)
"RTN","ORY2111",52,0)
 ...D WARN("Extra multiple:",CREF,OCXDD,OCXFLD)
"RTN","ORY2111",53,0)
 ...S QUIT=$$DELMULT^ORY2113($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","ORY2111",54,0)
 .;
"RTN","ORY2111",55,0)
 .I (OCXFLD=+OCXFLD),'$$EXFLD(+OCXDD,OCXFLD) D
"RTN","ORY2111",56,0)
 ..I ($O(@CREF@(OCXDD,OCXFLD,""))="E") D  Q
"RTN","ORY2111",57,0)
 ...I $L($G(@RREF@(OCXDD,OCXFLD,"E"))),'$L($G(@LREF@(OCXDD,OCXFLD,"E"))) D  Q
"RTN","ORY2111",58,0)
 ....D WARN("Data Value Missing in "_$$NETNAME^OCXSEND,CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2111",59,0)
 ....S QUIT=$$EDITFLD^ORY2114(CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2111",60,0)
 ...I $L($G(@LREF@(OCXDD,OCXFLD,"E"))),'$L($G(@RREF@(OCXDD,OCXFLD,"E"))) D  Q
"RTN","ORY2111",61,0)
 ....D WARN("Extra Data Value in "_$$NETNAME^OCXSEND,CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2111",62,0)
 ....S QUIT=$$DELFLD^ORY2114(CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2111",63,0)
 ...I '(@LREF@(OCXDD,OCXFLD,"E")=@RREF@(OCXDD,OCXFLD,"E")) D
"RTN","ORY2111",64,0)
 ....D WARN("Inconsistent Data",CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2111",65,0)
 ....S QUIT=$$EDITFLD^ORY2114(CREF,OCXDD,OCXFLD,"E")
"RTN","ORY2111",66,0)
 ..S OCXSUB=0 F  Q:QUIT  S OCXSUB=$O(@CREF@(OCXDD,OCXFLD,OCXSUB)) Q:'OCXSUB  I '($G(@RREF@(OCXDD,OCXFLD,OCXSUB))=$G(@LREF@(OCXDD,OCXFLD,OCXSUB))) D  Q
"RTN","ORY2111",67,0)
 ...D WARN("Inconsistent word Data",CREF,OCXDD,OCXFLD,OCXSUB)
"RTN","ORY2111",68,0)
 ...S QUIT=$$LOADWORD^ORY2112(RREF,OCXDD,OCXFLD,OCXSUB)
"RTN","ORY2111",69,0)
 .;
"RTN","ORY2111",70,0)
 .I 'QUIT,(OCXFLD[":") S QUIT=$$MULT($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","ORY2111",71,0)
 Q QUIT
"RTN","ORY2111",72,0)
 ;
"RTN","ORY2111",73,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY2111",74,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY2111",75,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY2111",76,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY2111",77,0)
 ;
"RTN","ORY2111",78,0)
EXFLD(FILE,OCXFLD) ;
"RTN","ORY2111",79,0)
 N OCXFNAM
"RTN","ORY2111",80,0)
 S OCXFNAM=$$FIELD^OCXSENDD(FILE,OCXFLD,"LABEL")
"RTN","ORY2111",81,0)
 I (OCXFNAM["UNIQUE OBJECT IDENTIFIER") Q 1
"RTN","ORY2111",82,0)
 I (FILE=860.2),(OCXFLD=.02) Q 1
"RTN","ORY2111",83,0)
 I (FILE=860.22),(OCXFLD=4) Q 1
"RTN","ORY2111",84,0)
 I (FILE=860.3),(OCXFLD=3) Q 1
"RTN","ORY2111",85,0)
 I (FILE=860.9),(OCXFLD=1) Q 1
"RTN","ORY2111",86,0)
 I (FILE=860.91) Q 1
"RTN","ORY2111",87,0)
 I (FILE=860.801) Q 1
"RTN","ORY2111",88,0)
 I (FILE=860.81) Q 1
"RTN","ORY2111",89,0)
 I (FILE=861.01) Q 1
"RTN","ORY2111",90,0)
 I (FILE=863.02) Q 1
"RTN","ORY2111",91,0)
 I (FILE=863.54) Q 1
"RTN","ORY2111",92,0)
 I (FILE=863.61) Q 1
"RTN","ORY2111",93,0)
 I (FILE=863.72) Q 1
"RTN","ORY2111",94,0)
 I (FILE=863.81) Q 1
"RTN","ORY2111",95,0)
 I ($E(OCXFNAM,1)="*") Q 1
"RTN","ORY2111",96,0)
 Q 0
"RTN","ORY2111",97,0)
 ;
"RTN","ORY2111",98,0)
WARN(MSG,CREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY2111",99,0)
 ;
"RTN","ORY2111",100,0)
 Q:$G(OCXAUTO)
"RTN","ORY2111",101,0)
 ;
"RTN","ORY2111",102,0)
 N D0,DASH,OCXDDPTH,OCXDPTR,FILE,FILEID,LREF,OCXPTR,RREF
"RTN","ORY2111",103,0)
 ;
"RTN","ORY2111",104,0)
 S DASH="",$P(DASH,"-",(55-$L(MSG)))="-"
"RTN","ORY2111",105,0)
 W !!,"------------",MSG,DASH
"RTN","ORY2111",106,0)
 D DSPHDR(CREF,OCXDD,OCXFLD)
"RTN","ORY2111",107,0)
 I $D(OCXSUB) D DSPFLD(CREF,OCXDD,OCXFLD,OCXSUB)
"RTN","ORY2111",108,0)
 I '$D(OCXSUB) D DSPREC(CREF,OCXDD,OCXFLD)
"RTN","ORY2111",109,0)
 ;
"RTN","ORY2111",110,0)
 W ! Q
"RTN","ORY2111",111,0)
 ;
"RTN","ORY2111",112,0)
DSPREC(CREF,OCXDD,OCXFLD) ;
"RTN","ORY2111",113,0)
 ;
"RTN","ORY2111",114,0)
 N OCXDPTR,OCXDDPTH,LEVL,OCXCREF,OCXSUB
"RTN","ORY2111",115,0)
 S OCXCREF=$$APPEND($$APPEND(CREF,OCXDD),OCXFLD)
"RTN","ORY2111",116,0)
 S OCXDDPTH=$P($P(OCXCREF,"(",2),")",1),LEVL=$L(OCXDDPTH,",")
"RTN","ORY2111",117,0)
 S OCXSUB="" F  S OCXSUB=$O(@OCXCREF@(OCXSUB)) Q:'$L(OCXSUB)  D
"RTN","ORY2111",118,0)
 .;
"RTN","ORY2111",119,0)
 .I '(OCXSUB[":"),'((OCXSUB=.01)&$O(@OCXCREF@(OCXSUB))) D
"RTN","ORY2111",120,0)
 ..N LINE
"RTN","ORY2111",121,0)
 ..Q:$$EXFLD(+OCXFLD,OCXSUB)
"RTN","ORY2111",122,0)
 ..I OCXFLD W !,?(5+((LEVL)*4)),$$FIELD^OCXSENDD(+OCXFLD,OCXSUB,"LABEL"),": ",$G(@OCXCREF@(OCXSUB,"E"))
"RTN","ORY2111",123,0)
 ..S LINE=0 F  S LINE=$O(@OCXCREF@(OCXSUB,LINE)) Q:'LINE  D
"RTN","ORY2111",124,0)
 ...W !,?(5+(LEVL*4)),$J(LINE,3),">",@OCXCREF@(OCXSUB,LINE)
"RTN","ORY2111",125,0)
 .;
"RTN","ORY2111",126,0)
 .I (OCXSUB[":") D
"RTN","ORY2111",127,0)
 ..N D0,OCXDD,FILENAME
"RTN","ORY2111",128,0)
 ..S D0=+$P(OCXSUB,":",2),OCXDD=+OCXSUB
"RTN","ORY2111",129,0)
 ..S FILENAME=$$FILENAME^OCXSENDD(OCXDD)
"RTN","ORY2111",130,0)
 ..I $L(FILENAME) W !,?(5+($L(LEVL)*4)),FILENAME
"RTN","ORY2111",131,0)
 ..E  W !!,?(5+(LEVL*4)),FILENAME
"RTN","ORY2111",132,0)
 ..W " ",D0,": ",$G(@OCXCREF@(OCXSUB,.01,"E"))
"RTN","ORY2111",133,0)
 ..D DSPREC($$APPEND(CREF,OCXDD),OCXFLD,OCXSUB)
"RTN","ORY2111",134,0)
 ;
"RTN","ORY2111",135,0)
 Q
"RTN","ORY2111",136,0)
 ;
"RTN","ORY2111",137,0)
DSPHDR(CREF,OCXDD,OCXFLD) ;
"RTN","ORY2111",138,0)
 ;
"RTN","ORY2111",139,0)
 N D0,FILE,FILEID,OCXPTR,OCXDDPTH
"RTN","ORY2111",140,0)
 S OCXDDPTH=$P($P($$APPEND($$APPEND(CREF,OCXDD),OCXFLD),"(",2),")",1)
"RTN","ORY2111",141,0)
 S FILE="" F OCXPTR=1:1:$L(OCXDDPTH,",") D
"RTN","ORY2111",142,0)
 .N OCXDD,D0,FILEID
"RTN","ORY2111",143,0)
 .S FILEID=$P(OCXDDPTH,",",OCXPTR)
"RTN","ORY2111",144,0)
 .I (FILEID[":") D
"RTN","ORY2111",145,0)
 ..S D0=+$P(FILEID,":",2),OCXDD=+$E(FILEID,2,$L(FILEID))
"RTN","ORY2111",146,0)
 ..W !,?(5+(OCXPTR*4)),$$FILENAME^OCXSENDD(OCXDD)
"RTN","ORY2111",147,0)
 ..S:$L(FILE) FILE=FILE_"," S FILE=FILE_FILEID
"RTN","ORY2111",148,0)
 ..I $D(@("L("_FILE_",.01,""E"")")) W ": ",@("L("_FILE_",.01,""E"")") W:D0 " [",D0,"]"
"RTN","ORY2111",149,0)
 ..E  I $D(@("R("_FILE_",.01,""E"")")) W ": ",@("R("_FILE_",.01,""E"")") W:D0 " [",D0,"]"
"RTN","ORY2111",150,0)
 ;
"RTN","ORY2111",151,0)
 Q
"RTN","ORY2111",152,0)
 ;
"RTN","ORY2111",153,0)
DSPFLD(CREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY2111",154,0)
 ;
"RTN","ORY2111",155,0)
 N OCXDPTR,LREF,RREF,OCXDDPTH
"RTN","ORY2111",156,0)
 ;
"RTN","ORY2111",157,0)
 S OCXDDPTH=$P($P($$APPEND(CREF,OCXDD),"(",2),")",1)
"RTN","ORY2111",158,0)
 S LREF="L("_OCXDDPTH_")",RREF="R("_OCXDDPTH_")"
"RTN","ORY2111",159,0)
 W !,?(5+(($L(OCXDDPTH,",")+1)*4)),$$FIELD^OCXSENDD(OCXDD,OCXFLD,"LABEL")," field [",OCXFLD,"]"
"RTN","ORY2111",160,0)
 I OCXSUB W " Line #",OCXSUB
"RTN","ORY2111",161,0)
 ;
"RTN","ORY2111",162,0)
 W:($D(@RREF@(OCXFLD,OCXSUB))) !,?(5+(($L(OCXDDPTH,",")+2)*4)),"(R) DEVCUR.FO-SLC.MED.VA.GOV: ",@RREF@(OCXFLD,OCXSUB)
"RTN","ORY2111",163,0)
 W:($D(@LREF@(OCXFLD,OCXSUB))) !,?(5+(($L(OCXDDPTH,",")+2)*4)),"(L) ",$$NETNAME^OCXSEND,": ",@LREF@(OCXFLD,OCXSUB)
"RTN","ORY2111",164,0)
 ;
"RTN","ORY2111",165,0)
 Q
"RTN","ORY2111",166,0)
 ;
"RTN","ORY2111",167,0)
 W !,?10 Q 0 Q $$PAUSE
"RTN","ORY2111",168,0)
 ;
"RTN","ORY2111",169,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY2111",170,0)
 ;
"RTN","ORY2111",171,0)
NOW() N X,Y,%DT S X="N",%DT="T" D ^%DT S Y=$$DATE^OCXSENDD(Y) S:(Y["@") Y=$P(Y,"@",1)_" at "_$P(Y,"@",2) Q Y
"RTN","ORY2111",172,0)
 ;
"RTN","ORY2112")
0^11^B26766060
"RTN","ORY2112",1,0)
ORY2112 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY2112",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY2112",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY2112",4,0)
 ;
"RTN","ORY2112",5,0)
S ;
"RTN","ORY2112",6,0)
 ;  Record Utilities
"RTN","ORY2112",7,0)
 Q
"RTN","ORY2112",8,0)
 ;
"RTN","ORY2112",9,0)
ADDREC(OCXCREF) ;
"RTN","ORY2112",10,0)
 ;
"RTN","ORY2112",11,0)
 N QUIT,OCXDD,OCXDA,OCXGREF,OCXNAME
"RTN","ORY2112",12,0)
 S OCXDD=$O(@OCXCREF@("")) Q:'OCXDD 0
"RTN","ORY2112",13,0)
 S OCXNAME=$G(@OCXCREF@(OCXDD,.01,"E"))
"RTN","ORY2112",14,0)
 ;
"RTN","ORY2112",15,0)
 W "   record missing..."
"RTN","ORY2112",16,0)
 I (OCXFLAG["D") Q 0
"RTN","ORY2112",17,0)
 ;
"RTN","ORY2112",18,0)
 S OCXDA=0 D CREATE(OCXCREF,OCXDD,.OCXDA,0)
"RTN","ORY2112",19,0)
 S:$L(OCXNAME) ^TMP("OCXRULE",$J,"A",+OCXDD,OCXNAME)=""
"RTN","ORY2112",20,0)
 ;
"RTN","ORY2112",21,0)
 Q 0
"RTN","ORY2112",22,0)
 ;
"RTN","ORY2112",23,0)
CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY2112",24,0)
 ;
"RTN","ORY2112",25,0)
 N OCXFLD,OCXGREF,OCXKEY
"RTN","ORY2112",26,0)
 ;
"RTN","ORY2112",27,0)
 I $L(OCXDA),'(OCXDA=+OCXDA) W !!,"Unresolved subscript." Q
"RTN","ORY2112",28,0)
 ;
"RTN","ORY2112",29,0)
 S OCXKEY=@OCXCREF@(OCXDD,.01,"E")
"RTN","ORY2112",30,0)
 S OCXGREF=$$GETREF(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)
"RTN","ORY2112",31,0)
 I 'OCXDA D
"RTN","ORY2112",32,0)
 .S OCXDA=$O(^TMP("OCXRULE",$J,"B",+OCXDD,OCXKEY,0)) Q:OCXDA
"RTN","ORY2112",33,0)
 .S OCXDA=$O(@(OCXGREF_""" "")"),-1)+1
"RTN","ORY2112",34,0)
 .F OCXDA=OCXDA:1 Q:'$D(@(OCXGREF_OCXDA_",0)"))
"RTN","ORY2112",35,0)
 .I $D(@(OCXGREF_OCXDA_",0)")) S OCXDA=0
"RTN","ORY2112",36,0)
 ;
"RTN","ORY2112",37,0)
 I 'OCXDA W !!,"Error adding record..." Q
"RTN","ORY2112",38,0)
 ;
"RTN","ORY2112",39,0)
 I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","ORY2112",40,0)
 ;
"RTN","ORY2112",41,0)
 S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^ORY2111(+OCXDD,OCXFLD) D
"RTN","ORY2112",42,0)
 .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","ORY2112",43,0)
 .I $O(@OCXCREF@(OCXDD,OCXFLD,0)) D WORD(OCXDD,OCXGREF,OCXFLD,.OCXDA,OCXCREF)
"RTN","ORY2112",44,0)
 ;
"RTN","ORY2112",45,0)
 D PUSH(.OCXDA)
"RTN","ORY2112",46,0)
 S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","ORY2112",47,0)
 .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","ORY2112",48,0)
 D POP(.OCXDA)
"RTN","ORY2112",49,0)
 Q
"RTN","ORY2112",50,0)
 ;
"RTN","ORY2112",51,0)
LOADWORD(RREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY2112",52,0)
 ;
"RTN","ORY2112",53,0)
 N QUIT,DDPATH,INDEX,OCXDA,OCXGREF
"RTN","ORY2112",54,0)
 S DDPATH=$P($P($$APPEND(RREF,OCXDD),"(",2),")",1)
"RTN","ORY2112",55,0)
 F INDEX=1:1:$L(DDPATH,",") S OCXDA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","ORY2112",56,0)
 S OCXDA=$G(OCXDA(0)) K OCXDA(0)
"RTN","ORY2112",57,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY2112",58,0)
 I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to reload the local '"_$$FIELD^OCXSENDD(+OCXDD,+OCXFLD,"LABEL")_"' field ?","YES") Q:'QUIT (QUIT[U)
"RTN","ORY2112",59,0)
 S OCXGREF=$$GETREF(+OCXDD,.OCXDA,$L(DDPATH,",")-1) Q:'$L(OCXGREF)
"RTN","ORY2112",60,0)
 D WORD(OCXDD,OCXGREF,OCXFLD,.OCXDA,RREF)
"RTN","ORY2112",61,0)
 Q 0
"RTN","ORY2112",62,0)
 ;
"RTN","ORY2112",63,0)
GETREF(OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY2112",64,0)
 ;
"RTN","ORY2112",65,0)
 Q:'OCXDD ""
"RTN","ORY2112",66,0)
 ;
"RTN","ORY2112",67,0)
 N OCXIENS,OCXERR,OCXX
"RTN","ORY2112",68,0)
 S OCXIENS=$$IENS^DILF(.OCXDA),OCXERR=""
"RTN","ORY2112",69,0)
 S OCXX=$$ROOT^DILFD(OCXDD,OCXIENS,0,OCXERR)
"RTN","ORY2112",70,0)
 Q OCXX
"RTN","ORY2112",71,0)
 ;
"RTN","ORY2112",72,0)
WORD(DD,GREF,FLD,DA,RREF) ;
"RTN","ORY2112",73,0)
 ;
"RTN","ORY2112",74,0)
 N SUB,GLROOT,LINE
"RTN","ORY2112",75,0)
 S SUB=$P($$FIELD^OCXSENDD(+DD,FLD,"GLOBAL SUBSCRIPT LOCATION"),";",1) S:'(SUB=+SUB) SUB=""""_SUB_""""
"RTN","ORY2112",76,0)
 S GLROOT=GREF_DA_","_SUB_")" K @GLROOT
"RTN","ORY2112",77,0)
 S LINE=0 F  S LINE=$O(@RREF@(DD,FLD,LINE)) Q:'LINE  D
"RTN","ORY2112",78,0)
 .S @GLROOT@($O(@GLROOT@(""),-1)+1,0)=@RREF@(DD,FLD,LINE)
"RTN","ORY2112",79,0)
 S LINE=$O(@GLROOT@(""),-1),@GLROOT@(0)=U_U_LINE_U_LINE_U_$$DATE("T")_U
"RTN","ORY2112",80,0)
 ;
"RTN","ORY2112",81,0)
 Q
"RTN","ORY2112",82,0)
 ;
"RTN","ORY2112",83,0)
DATE(X) N %DT,Y S %DT="" D ^%DT Q +Y
"RTN","ORY2112",84,0)
 ;
"RTN","ORY2112",85,0)
DIE(OCXDD,OCXDIC,OCXFLD,OCXVAL,OCXDA,OCXLVL) ;
"RTN","ORY2112",86,0)
 ;
"RTN","ORY2112",87,0)
 N DIC,DIE,X,Y,DR,DA,OCXDVAL,OCXPTR,OCXGREF,D0,OCXSCR
"RTN","ORY2112",88,0)
 S (D0,DA)=OCXDA,(DIC,DIE)=OCXDIC,DR=""
"RTN","ORY2112",89,0)
 S:OCXLVL D0=OCXDA(1),DR="S DA(1)="_(+D0)_",D0="_(+D0)_";"
"RTN","ORY2112",90,0)
 S:OCXVAL="?" OCXVAL="? " S DR=DR_OCXFLD_"///^S X=OCXVAL"
"RTN","ORY2112",91,0)
 I '(OCXVAL="@") W !,?(OCXLVL*5),$$FIELD^OCXSENDD(+OCXDD,OCXFLD,"LABEL"),": ",OCXVAL
"RTN","ORY2112",92,0)
 ;
"RTN","ORY2112",93,0)
 I '(OCXVAL="@") D
"RTN","ORY2112",94,0)
 .N OCXIEN,SHORT
"RTN","ORY2112",95,0)
 .S OCXPTR=+$P($$FIELD^OCXSENDD(+OCXDD,OCXFLD,"SPECIFIER"),"P",2)
"RTN","ORY2112",96,0)
 .Q:'OCXPTR
"RTN","ORY2112",97,0)
 .S OCXGREF="^"_$$FIELD^OCXSENDD(+OCXDD,OCXFLD,"POINTER")
"RTN","ORY2112",98,0)
 .I '($E(OCXGREF,1,4)="^OCX"),'(OCXGREF="^ORD(100.9,"),'(OCXGREF="^ORD(100.8,") Q
"RTN","ORY2112",99,0)
 .Q:$$DIC(OCXGREF,OCXVAL,0)
"RTN","ORY2112",100,0)
 .S OCXIEN=$$DIC(OCXGREF,OCXVAL,1)
"RTN","ORY2112",101,0)
 .S ^TMP("OCXRULE",$J,"B",OCXPTR,OCXVAL,OCXIEN)=""
"RTN","ORY2112",102,0)
 ;
"RTN","ORY2112",103,0)
 S OCXSCR=1
"RTN","ORY2112",104,0)
 D ^DIE
"RTN","ORY2112",105,0)
 ;
"RTN","ORY2112",106,0)
 ; I $D(Y) -> DIE FILER ERROR
"RTN","ORY2112",107,0)
 I $D(Y) W "   ^DIE filer data error..." S OCXDIER=$G(OCXDIER)+1
"RTN","ORY2112",108,0)
 I '$D(Y) W "    ...Correct data Filed"
"RTN","ORY2112",109,0)
 ;
"RTN","ORY2112",110,0)
 Q
"RTN","ORY2112",111,0)
 ;
"RTN","ORY2112",112,0)
DIC(DIC,X,OCXADD) N OCXSCR S DIC(0)="",OCXSCR=1 S:OCXADD DIC(0)="L" D ^DIC Q:(+Y>0) +Y Q 0
"RTN","ORY2112",113,0)
 ;
"RTN","ORY2112",114,0)
PUSH(OCXDA) ;
"RTN","ORY2112",115,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","ORY2112",116,0)
 S OCXDA(1)=OCXDA,OCXDA=0
"RTN","ORY2112",117,0)
 Q
"RTN","ORY2112",118,0)
 ;
"RTN","ORY2112",119,0)
POP(OCXDA) ;
"RTN","ORY2112",120,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","ORY2112",121,0)
 S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","ORY2112",122,0)
 Q
"RTN","ORY2112",123,0)
 ;
"RTN","ORY2112",124,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY2112",125,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY2112",126,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY2112",127,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY2112",128,0)
 ;
"RTN","ORY2112",129,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY2112",130,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY2112",131,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY2112",132,0)
 S DIR(0)=OCXZ0
"RTN","ORY2112",133,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY2112",134,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY2112",135,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY2112",136,0)
 D ^DIR
"RTN","ORY2112",137,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY2112",138,0)
 Q Y
"RTN","ORY2112",139,0)
 ;
"RTN","ORY2112",140,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY2112",141,0)
 ;
"RTN","ORY2113")
0^12^B12993982
"RTN","ORY2113",1,0)
ORY2113 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY2113",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY2113",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY2113",4,0)
 ;
"RTN","ORY2113",5,0)
S ;
"RTN","ORY2113",6,0)
 ;  Multiple Utilities
"RTN","ORY2113",7,0)
 Q
"RTN","ORY2113",8,0)
 ;
"RTN","ORY2113",9,0)
ADDMULT(OCXCREF,OCXDD,OCXFLD) ;
"RTN","ORY2113",10,0)
 ;
"RTN","ORY2113",11,0)
 ;
"RTN","ORY2113",12,0)
 N QUIT,OCXDA,OCXGREF,OCXNAME,DDPATH,INDEX
"RTN","ORY2113",13,0)
 ;
"RTN","ORY2113",14,0)
 S DDPATH=$P($P($$APPEND($$APPEND(OCXCREF,OCXDD),OCXFLD),"(",2),")",1)
"RTN","ORY2113",15,0)
 F INDEX=1:1:$L(DDPATH,",") S OCXDA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","ORY2113",16,0)
 S OCXDA=$G(OCXDA(0)) K OCXDA(0)
"RTN","ORY2113",17,0)
 ;
"RTN","ORY2113",18,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY2113",19,0)
 I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to add a local '"_$$FILENAME^OCXSENDD(+OCXFLD)_"' multiple ?","YES") Q:'QUIT (QUIT[U)
"RTN","ORY2113",20,0)
 ;
"RTN","ORY2113",21,0)
 S OCXGREF=$$GETREF^ORY2112(+OCXFLD,.OCXDA,1)
"RTN","ORY2113",22,0)
 D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,1)
"RTN","ORY2113",23,0)
 ;
"RTN","ORY2113",24,0)
 Q 0
"RTN","ORY2113",25,0)
 ;
"RTN","ORY2113",26,0)
DELMULT(OCXCREF,OCXDD) ;
"RTN","ORY2113",27,0)
 ;
"RTN","ORY2113",28,0)
 N QUIT,OCXGREF,DA,INDEX,DDPATH
"RTN","ORY2113",29,0)
 ;
"RTN","ORY2113",30,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY2113",31,0)
 I (OCXFLAG["A") S QUIT=$$READ("Y"," Do you want to delete the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' multiple ?","YES") Q:'QUIT (QUIT[U)
"RTN","ORY2113",32,0)
 ;
"RTN","ORY2113",33,0)
 S DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","ORY2113",34,0)
 F INDEX=1:1:$L(DDPATH,",") S DA($L(DDPATH,",")-INDEX)=+$P($P(DDPATH,",",INDEX),":",2)
"RTN","ORY2113",35,0)
 S DA=$G(DA(0)) K DA(0)
"RTN","ORY2113",36,0)
 S OCXGREF=$$GETREF^ORY2112(+OCXDD,.DA,1)
"RTN","ORY2113",37,0)
 ;
"RTN","ORY2113",38,0)
 D DIE^ORY2112(+OCXDD,OCXGREF,.01,"@",.DA,$L(DDPATH,",")-1)
"RTN","ORY2113",39,0)
 K @OCXCREF@(OCXDD) W !!,"  deleted..."
"RTN","ORY2113",40,0)
 ;
"RTN","ORY2113",41,0)
 Q 0
"RTN","ORY2113",42,0)
 ;
"RTN","ORY2113",43,0)
CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY2113",44,0)
 ;
"RTN","ORY2113",45,0)
 N OCXFLD,OCXGREF
"RTN","ORY2113",46,0)
 ;
"RTN","ORY2113",47,0)
 S OCXGREF=$$GETREF^ORY2112(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)  S:'OCXDA OCXDA=$O(@(OCXGREF_"""@"")"),-1)+1
"RTN","ORY2113",48,0)
 ;
"RTN","ORY2113",49,0)
 I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","ORY2113",50,0)
 ;
"RTN","ORY2113",51,0)
 S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^ORY2111(+OCXDD,OCXFLD) D
"RTN","ORY2113",52,0)
 .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE^ORY2112(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","ORY2113",53,0)
 ;
"RTN","ORY2113",54,0)
 D PUSH(.OCXDA)
"RTN","ORY2113",55,0)
 S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","ORY2113",56,0)
 .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","ORY2113",57,0)
 D POP(.OCXDA)
"RTN","ORY2113",58,0)
 Q
"RTN","ORY2113",59,0)
 ;
"RTN","ORY2113",60,0)
PUSH(OCXDA) ;
"RTN","ORY2113",61,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","ORY2113",62,0)
 S OCXDA(1)=OCXDA,OCXDA=0
"RTN","ORY2113",63,0)
 Q
"RTN","ORY2113",64,0)
 ;
"RTN","ORY2113",65,0)
POP(OCXDA) ;
"RTN","ORY2113",66,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","ORY2113",67,0)
 S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","ORY2113",68,0)
 Q
"RTN","ORY2113",69,0)
 ;
"RTN","ORY2113",70,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY2113",71,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY2113",72,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY2113",73,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY2113",74,0)
 ;
"RTN","ORY2113",75,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY2113",76,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY2113",77,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY2113",78,0)
 S DIR(0)=OCXZ0
"RTN","ORY2113",79,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY2113",80,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY2113",81,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY2113",82,0)
 D ^DIR
"RTN","ORY2113",83,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY2113",84,0)
 Q Y
"RTN","ORY2113",85,0)
 ;
"RTN","ORY2113",86,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY2113",87,0)
 ;
"RTN","ORY2114")
0^13^B13523737
"RTN","ORY2114",1,0)
ORY2114 ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY2114",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY2114",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY2114",4,0)
 ;
"RTN","ORY2114",5,0)
S ;
"RTN","ORY2114",6,0)
 ;  Field Utilities
"RTN","ORY2114",7,0)
 Q
"RTN","ORY2114",8,0)
 ;
"RTN","ORY2114",9,0)
EDITFLD(OCXCREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY2114",10,0)
 ;
"RTN","ORY2114",11,0)
 N DDPATH,OCXDA,OCXPC,OCXLVL,QUIT
"RTN","ORY2114",12,0)
 ;
"RTN","ORY2114",13,0)
 S QUIT=0,DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","ORY2114",14,0)
 S OCXLVL=$L(DDPATH,",")
"RTN","ORY2114",15,0)
 F OCXPC=1:1:OCXLVL S OCXDA(OCXLVL-OCXPC)=+$P($P(DDPATH,",",OCXPC),":",2)
"RTN","ORY2114",16,0)
 S OCXDA=OCXDA(0) K OCXDA(0)
"RTN","ORY2114",17,0)
 I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D
"RTN","ORY2114",18,0)
 .N RESP
"RTN","ORY2114",19,0)
 .Q:(OCXFLAG["D")
"RTN","ORY2114",20,0)
 .I (OCXFLAG["A") S RESP=$$READ("Y"," Do you want to change the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' field ?","YES") I 'RESP S QUIT=(RESP[U) Q
"RTN","ORY2114",21,0)
 .S OCXGREF=$$GETREF^ORY2112(+OCXDD,.OCXDA,OCXLVL-1) Q:'$L(OCXGREF)
"RTN","ORY2114",22,0)
 .D DIE^ORY2112(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL-1)
"RTN","ORY2114",23,0)
 ;
"RTN","ORY2114",24,0)
 Q QUIT
"RTN","ORY2114",25,0)
 ;
"RTN","ORY2114",26,0)
DELFLD(OCXCREF,OCXDD,OCXFLD,OCXSUB) ;
"RTN","ORY2114",27,0)
 ;
"RTN","ORY2114",28,0)
 N DDPATH,OCXDA,OCXPC,OCXLVL,QUIT,RESP
"RTN","ORY2114",29,0)
 ;
"RTN","ORY2114",30,0)
 S QUIT=0,DDPATH=$P($P($$APPEND(OCXCREF,OCXDD),"(",2),")",1)
"RTN","ORY2114",31,0)
 S OCXLVL=$L(DDPATH,",")
"RTN","ORY2114",32,0)
 F OCXPC=1:1:OCXLVL S OCXDA(OCXLVL-OCXPC)=+$P($P(DDPATH,",",OCXPC),":",2)
"RTN","ORY2114",33,0)
 S OCXDA=OCXDA(0) K OCXDA(0)
"RTN","ORY2114",34,0)
 Q:(OCXFLAG["D") 0
"RTN","ORY2114",35,0)
 I (OCXFLAG["A") S RESP=$$READ("Y"," Do you want to Delete the local '"_$$FILENAME^OCXSENDD(+OCXDD)_"' value ?","YES") I 'RESP S QUIT=(RESP[U) Q QUIT
"RTN","ORY2114",36,0)
 S OCXGREF=$$GETREF^ORY2112(+OCXDD,.OCXDA,OCXLVL-1) Q:'$L(OCXGREF)
"RTN","ORY2114",37,0)
 D DIE^ORY2112(OCXDD,OCXGREF,OCXFLD,"@",.OCXDA,OCXLVL-1)
"RTN","ORY2114",38,0)
 ;
"RTN","ORY2114",39,0)
 Q QUIT
"RTN","ORY2114",40,0)
 ;
"RTN","ORY2114",41,0)
CREATE(OCXCREF,OCXDD,OCXDA,OCXLVL) ;
"RTN","ORY2114",42,0)
 ;
"RTN","ORY2114",43,0)
 N OCXFLD,OCXGREF
"RTN","ORY2114",44,0)
 ;
"RTN","ORY2114",45,0)
 S OCXGREF=$$GETREF^ORY2112(+OCXDD,.OCXDA,OCXLVL) Q:'$L(OCXGREF)  S:'OCXDA OCXDA=$O(@(OCXGREF_"""@"")"),-1)+1
"RTN","ORY2114",46,0)
 ;
"RTN","ORY2114",47,0)
 I '$D(@(OCXGREF_"0)")) S @(OCXGREF_"0)")=U_$$FILEHDR^OCXSENDD(+OCXDD)_U_U
"RTN","ORY2114",48,0)
 ;
"RTN","ORY2114",49,0)
 S OCXFLD=0 F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'OCXFLD  Q:(OCXFLD[":")  I '$$EXFLD^ORY2111(+OCXDD,OCXFLD) D
"RTN","ORY2114",50,0)
 .I $L($G(@OCXCREF@(OCXDD,OCXFLD,"E"))) D DIE^ORY2112(OCXDD,OCXGREF,OCXFLD,@OCXCREF@(OCXDD,OCXFLD,"E"),.OCXDA,OCXLVL)
"RTN","ORY2114",51,0)
 ;
"RTN","ORY2114",52,0)
 D PUSH(.OCXDA)
"RTN","ORY2114",53,0)
 S OCXFLD="" F  S OCXFLD=$O(@OCXCREF@(OCXDD,OCXFLD)) Q:'$L(OCXFLD)  I (OCXFLD[":") D
"RTN","ORY2114",54,0)
 .S OCXDA=$P(OCXFLD,":",2) W ! D CREATE($$APPEND(OCXCREF,OCXDD),OCXFLD,.OCXDA,OCXLVL+1)
"RTN","ORY2114",55,0)
 D POP(.OCXDA)
"RTN","ORY2114",56,0)
 Q
"RTN","ORY2114",57,0)
 ;
"RTN","ORY2114",58,0)
PUSH(OCXDA) ;
"RTN","ORY2114",59,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB),-1) Q:'OCXSUB  S OCXDA(OCXSUB+1)=OCXDA(OCXSUB)
"RTN","ORY2114",60,0)
 S OCXDA(1)=OCXDA,OCXDA=0
"RTN","ORY2114",61,0)
 Q
"RTN","ORY2114",62,0)
 ;
"RTN","ORY2114",63,0)
POP(OCXDA) ;
"RTN","ORY2114",64,0)
 N OCXSUB S OCXSUB="" F  S OCXSUB=$O(OCXDA(OCXSUB)) Q:'OCXSUB  S OCXDA(OCXSUB)=$G(OCXDA(OCXSUB+1))
"RTN","ORY2114",65,0)
 S OCXDA=OCXDA(1) K OCXDA($O(OCXDA(""),-1))
"RTN","ORY2114",66,0)
 Q
"RTN","ORY2114",67,0)
 ;
"RTN","ORY2114",68,0)
APPEND(ARRAY,OCXSUB) ;
"RTN","ORY2114",69,0)
 S:'(OCXSUB=+OCXSUB) OCXSUB=""""_OCXSUB_""""
"RTN","ORY2114",70,0)
 Q:'(ARRAY["(") ARRAY_"("_OCXSUB_")"
"RTN","ORY2114",71,0)
 Q $E(ARRAY,1,$L(ARRAY)-1)_","_OCXSUB_")"
"RTN","ORY2114",72,0)
 ;
"RTN","ORY2114",73,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY2114",74,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY2114",75,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY2114",76,0)
 S DIR(0)=OCXZ0
"RTN","ORY2114",77,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY2114",78,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY2114",79,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY2114",80,0)
 D ^DIR
"RTN","ORY2114",81,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY2114",82,0)
 Q Y
"RTN","ORY2114",83,0)
 ;
"RTN","ORY2114",84,0)
PAUSE() W "  Press Enter " R X:DTIME W ! Q (X[U)
"RTN","ORY2114",85,0)
 ;
"RTN","ORY211ES")
0^14^B12630975
"RTN","ORY211ES",1,0)
ORY211ES ;SLC/RJS,CLA - OCX PACKAGE RULE TRANSPORT ROUTINE (Delete after Install of OR*3*211) ;APR 5,2005 at 08:07
"RTN","ORY211ES",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**211**;Dec 17,1997
"RTN","ORY211ES",3,0)
 ;;  ;;ORDER CHECK EXPERT version 1.01 released OCT 29,1998
"RTN","ORY211ES",4,0)
 ;
"RTN","ORY211ES",5,0)
S ;
"RTN","ORY211ES",6,0)
 ;
"RTN","ORY211ES",7,0)
 N OCXDIER,QUIT,LINE,TEXT,REMOTE,LOCAL,D0,OPCODE,REF,OCXFLAG S QUIT=0
"RTN","ORY211ES",8,0)
 N OCXAUTO,OCZSCR
"RTN","ORY211ES",9,0)
 ;
"RTN","ORY211ES",10,0)
 D DOT
"RTN","ORY211ES",11,0)
 I $L($T(VERSION^OCXOCMP)),($$VERSION^OCXOCMP="ORDER CHECK EXPERT version 1.01 released OCT 29,1998"),1
"RTN","ORY211ES",12,0)
 E  D  Q
"RTN","ORY211ES",13,0)
 .W !
"RTN","ORY211ES",14,0)
 .W !,"Rule Transport aborted, version mismatch."
"RTN","ORY211ES",15,0)
 .W !,"Current Local version: ",$$VERSION^OCXOCMP
"RTN","ORY211ES",16,0)
 .W !,"   Rule Transport Version: ORDER CHECK EXPERT version 1.01 released OCT 29,1998"
"RTN","ORY211ES",17,0)
 I '$D(DTIME) W !!,"DTIME not defined !!",!! Q
"RTN","ORY211ES",18,0)
 W !!,"Order Check Expert System Rule Transporter"
"RTN","ORY211ES",19,0)
 W !," Created: APR 5,2005 at 08:07  at  DEVCUR.FO-SLC.MED.VA.GOV"
"RTN","ORY211ES",20,0)
 W !," Current Date: ",$$NOW^ORY2110,"  at  ",$$NETNAME^OCXSEND,!!
"RTN","ORY211ES",21,0)
 S LASTFILE=0 K ^TMP("OCXRULE",$J)
"RTN","ORY211ES",22,0)
 S ^TMP("OCXRULE",$J)=($P($H,",",2)+($H*86400)+(1*60*60))_" <- ^TMP ENTRY EXPIRATION DATE FOR ^OCXOPURG"
"RTN","ORY211ES",23,0)
 S OCXFLAG="O"
"RTN","ORY211ES",24,0)
 ;
"RTN","ORY211ES",25,0)
RUN ;
"RTN","ORY211ES",26,0)
 ;
"RTN","ORY211ES",27,0)
 W !,"Loading Data " D ^ORY21101
"RTN","ORY211ES",28,0)
 ;
"RTN","ORY211ES",29,0)
 S LINE=0 F  S LINE=$O(^TMP("OCXRULE",$J,LINE)) Q:'LINE   D  Q:QUIT
"RTN","ORY211ES",30,0)
 .D:'(LINE#50) STATUS^OCXOPOST(LINE,$O(^TMP("OCXRULE",$J," "),-1))
"RTN","ORY211ES",31,0)
 .S TEXT=$G(^TMP("OCXRULE",$J,LINE)) I $L(TEXT) D  Q:QUIT
"RTN","ORY211ES",32,0)
 ..S TEXT=$P(TEXT,";",2,999),OPCODE=$P(TEXT,U,1),TEXT=$P(TEXT,U,2,999)
"RTN","ORY211ES",33,0)
 ..;
"RTN","ORY211ES",34,0)
 ..I OPCODE="KEY" D DOT S LOCAL="",D0=$$GETFILE^ORY2110(+$P(TEXT,U,1),$P(TEXT,U,2),.LOCAL) S QUIT=(D0=(-10)) Q
"RTN","ORY211ES",35,0)
 ..I OPCODE="R" S REF="REMOTE("_$P(TEXT,":",1)_":"_D0_$P(TEXT,":",2,99)_")" Q
"RTN","ORY211ES",36,0)
 ..I OPCODE="D",$D(REF) S @REF=$P(TEXT,U,1,999) K REF Q
"RTN","ORY211ES",37,0)
 ..;
"RTN","ORY211ES",38,0)
 ..I OPCODE="EOR" S QUIT=$$COMPARE^ORY2111(.LOCAL,.REMOTE) K LOCAL,REMOTE Q
"RTN","ORY211ES",39,0)
 ..I OPCODE="EOF" K LOCAL,REMOTE Q
"RTN","ORY211ES",40,0)
 ..I OPCODE="SOF" W !,"  Installing '",TEXT,"' records... " Q
"RTN","ORY211ES",41,0)
 ..I OPCODE="ROOT" D  Q
"RTN","ORY211ES",42,0)
 ...N FILE,DATA
"RTN","ORY211ES",43,0)
 ...S FILE=U_$P(TEXT,U,1),DATA=$P(TEXT,U,2,3)
"RTN","ORY211ES",44,0)
 ...I ($P($G(@FILE),U,1,2)=DATA) Q
"RTN","ORY211ES",45,0)
 ...S $P(@FILE,U,1,2)=DATA
"RTN","ORY211ES",46,0)
 ...W !,"  Restoring file #",(+$P(DATA,U,2))," zero node"
"RTN","ORY211ES",47,0)
 ..;
"RTN","ORY211ES",48,0)
 ..W !,"Unknown OpCode: ",OPCODE,"  in: ",TEXT S QUIT=$$PAUSE^ORY2110 W !
"RTN","ORY211ES",49,0)
 ;
"RTN","ORY211ES",50,0)
 K ^TMP("OCXRULE",$J)
"RTN","ORY211ES",51,0)
 ;
"RTN","ORY211ES",52,0)
 I $D(^OCXS) D
"RTN","ORY211ES",53,0)
 .N FILE,DO,PD0,CNT
"RTN","ORY211ES",54,0)
 .S FILE=0 F  S FILE=$O(^OCXS(FILE)) Q:'FILE  D
"RTN","ORY211ES",55,0)
 ..S D0=0 F CNT=0:1 S PD0=D0,D0=$O(^OCXS(FILE,D0)) Q:'D0
"RTN","ORY211ES",56,0)
 ..S $P(^OCXS(FILE,0),U,3,4)=CNT_U_PD0
"RTN","ORY211ES",57,0)
 ;
"RTN","ORY211ES",58,0)
 I $G(OCXDIER) D
"RTN","ORY211ES",59,0)
 .W !!!!!!!
"RTN","ORY211ES",60,0)
 .W !,?5,"******************** Warning ******************** "
"RTN","ORY211ES",61,0)
 .W !,?7,+$G(OCXDIER)," data filing error",$S(($G(OCXDIER)=1):"",1:"s"),"."
"RTN","ORY211ES",62,0)
 .W !,?7,"Some expert system rules may be incomplete."
"RTN","ORY211ES",63,0)
 .W !,?5,"******************** Warning ******************** "
"RTN","ORY211ES",64,0)
 I '$G(OCXDIER) W !!,?5," No data filing errors."
"RTN","ORY211ES",65,0)
 W !!,"Transport Finished..."
"RTN","ORY211ES",66,0)
 ;
"RTN","ORY211ES",67,0)
 D
"RTN","ORY211ES",68,0)
 .N OCXOETIM
"RTN","ORY211ES",69,0)
 .D BMES^XPDUTL("---Creating Order Check Routines-----------------------------------")
"RTN","ORY211ES",70,0)
 .D AUTO^OCXOCMP
"RTN","ORY211ES",71,0)
 ;
"RTN","ORY211ES",72,0)
 Q
"RTN","ORY211ES",73,0)
 ;
"RTN","ORY211ES",74,0)
DOT Q:$G(OCXAUTO)  W:($X>70) ! W " ." Q
"RTN","ORY211ES",75,0)
 ;
"RTN","ORY211ES",76,0)
READ(OCXZ0,OCXZA,OCXZB,OCXZL) ;
"RTN","ORY211ES",77,0)
 N OCXLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORY211ES",78,0)
 Q:'$L($G(OCXZ0)) U
"RTN","ORY211ES",79,0)
 S DIR(0)=OCXZ0
"RTN","ORY211ES",80,0)
 S:$L($G(OCXZA)) DIR("A")=OCXZA
"RTN","ORY211ES",81,0)
 S:$L($G(OCXZB)) DIR("B")=OCXZB
"RTN","ORY211ES",82,0)
 F OCXLINE=1:1:($G(OCXZL)-1) W !
"RTN","ORY211ES",83,0)
 D ^DIR
"RTN","ORY211ES",84,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","ORY211ES",85,0)
 Q Y
"RTN","ORY211ES",86,0)
 ;
"VER")
8.0^22
"^DD",101.43,101.43,71.1,0)
CONTRAST MEDIA^F^^RA;1^K:$L(X)>3!($L(X)<1) X
"^DD",101.43,101.43,71.1,3)
Enter the contrast media used in this procedure.
"^DD",101.43,101.43,71.1,21,0)
^^14^14^3050106^
"^DD",101.43,101.43,71.1,21,1,0)
This field indicates what contrast media, if any, is used by this
"^DD",101.43,101.43,71.1,21,2,0)
radiologic procedure where:
"^DD",101.43,101.43,71.1,21,3,0)
 
"^DD",101.43,101.43,71.1,21,4,0)
      I = Ionic Iodinated
"^DD",101.43,101.43,71.1,21,5,0)
      N = Non-ionic Iodinated
"^DD",101.43,101.43,71.1,21,6,0)
      L = Gadolinium
"^DD",101.43,101.43,71.1,21,7,0)
      C = Cholecystographic
"^DD",101.43,101.43,71.1,21,8,0)
      G = Gastrografin
"^DD",101.43,101.43,71.1,21,9,0)
      B = Barium
"^DD",101.43,101.43,71.1,21,10,0)
      M = Unspecified contrast media
"^DD",101.43,101.43,71.1,21,11,0)
 
"^DD",101.43,101.43,71.1,21,12,0)
This value may consist of as many of these flags as are appropriate for
"^DD",101.43,101.43,71.1,21,13,0)
this procedure; if empty, no contrast media is assumed.  This field is 
"^DD",101.43,101.43,71.1,21,14,0)
used primarily for Order Checking.
"^DD",101.43,101.43,71.1,"DT")
3050106
**INSTALL NAME**
RA*5.0*45
"BLD",4828,0)
RA*5.0*45^RADIOLOGY/NUCLEAR MEDICINE^0^3050405^y
"BLD",4828,4,0)
^9.64PA^71.1^3
"BLD",4828,4,70,0)
70
"BLD",4828,4,70,2,0)
^9.641^70.3225^3
"BLD",4828,4,70,2,70.03,0)
EXAMINATIONS  (sub-file)
"BLD",4828,4,70,2,70.03,1,0)
^9.6411^10^1
"BLD",4828,4,70,2,70.03,1,10,0)
CONTRAST MEDIA USED
"BLD",4828,4,70,2,70.16,0)
CONTRAST MEDIA ACTIVITY LOG  (sub-file)
"BLD",4828,4,70,2,70.16,1,0)
^9.6411^^
"BLD",4828,4,70,2,70.3225,0)
CONTRAST MEDIA  (sub-file)
"BLD",4828,4,70,2,70.3225,1,0)
^9.6411^^0
"BLD",4828,4,70,222)
y^n^p^^^^n^^n
"BLD",4828,4,70,224)

"BLD",4828,4,71,0)
71
"BLD",4828,4,71,2,0)
^9.641^71.03^4
"BLD",4828,4,71,2,71,0)
RAD/NUC MED PROCEDURES  (File-top level)
"BLD",4828,4,71,2,71,1,0)
^9.6411^20^1
"BLD",4828,4,71,2,71,1,20,0)
CONTRAST MEDIA USED
"BLD",4828,4,71,2,71.0125,0)
CONTRAST MEDIA  (sub-file)
"BLD",4828,4,71,2,71.0125,1,0)
^9.6411^^
"BLD",4828,4,71,2,71.03,0)
AMIS CODES  (sub-file)
"BLD",4828,4,71,2,71.03,1,0)
^9.6411^.01^1
"BLD",4828,4,71,2,71.03,1,.01,0)
AMIS CODE
"BLD",4828,4,71,2,71.06,0)
CONTRAST MEDIA ACTIVITY LOG  (sub-file)
"BLD",4828,4,71,2,71.06,1,0)
^9.6411^^
"BLD",4828,4,71,222)
y^n^p^^^^n^^n
"BLD",4828,4,71,224)

"BLD",4828,4,71.1,0)
71.1
"BLD",4828,4,71.1,2,0)
^9.641^71.1^1
"BLD",4828,4,71.1,2,71.1,0)
MAJOR RAD/NUC MED AMIS CODES  (File-top level)
"BLD",4828,4,71.1,2,71.1,1,0)
^9.6411^.001^2
"BLD",4828,4,71.1,2,71.1,1,.001,0)
MAJOR AMIS CODE
"BLD",4828,4,71.1,2,71.1,1,.01,0)
DESCRIPTION
"BLD",4828,4,71.1,222)
y^n^p^^^^n^^n
"BLD",4828,4,71.1,224)

"BLD",4828,4,"APDD",70,70.03)

"BLD",4828,4,"APDD",70,70.03,10)

"BLD",4828,4,"APDD",70,70.16)

"BLD",4828,4,"APDD",70,70.3225)

"BLD",4828,4,"APDD",71,71)

"BLD",4828,4,"APDD",71,71,20)

"BLD",4828,4,"APDD",71,71.0125)

"BLD",4828,4,"APDD",71,71.03)

"BLD",4828,4,"APDD",71,71.03,.01)

"BLD",4828,4,"APDD",71,71.06)

"BLD",4828,4,"APDD",71.1,71.1)

"BLD",4828,4,"APDD",71.1,71.1,.001)

"BLD",4828,4,"APDD",71.1,71.1,.01)

"BLD",4828,4,"B",70,70)

"BLD",4828,4,"B",71,71)

"BLD",4828,4,"B",71.1,71.1)

"BLD",4828,"ABPKG")
n
"BLD",4828,"INIT")
RA45PST
"BLD",4828,"KRN",0)
^9.67PA^8989.52^19
"BLD",4828,"KRN",.4,0)
.4
"BLD",4828,"KRN",.4,"NM",0)
^9.68A^4^4
"BLD",4828,"KRN",.4,"NM",1,0)
RA PROCEDURE LIST    FILE #71^71^0
"BLD",4828,"KRN",.4,"NM",2,0)
RA PROCEDURE SHORT LIST    FILE #71^71^0
"BLD",4828,"KRN",.4,"NM",3,0)
RA ALPHA LIST OF ACTIVES    FILE #71^71^0
"BLD",4828,"KRN",.4,"NM",4,0)
RA PARENT PROCEDURE LIST    FILE #71^71^0
"BLD",4828,"KRN",.4,"NM","B","RA ALPHA LIST OF ACTIVES    FILE #71",3)

"BLD",4828,"KRN",.4,"NM","B","RA PARENT PROCEDURE LIST    FILE #71",4)

"BLD",4828,"KRN",.4,"NM","B","RA PROCEDURE LIST    FILE #71",1)

"BLD",4828,"KRN",.4,"NM","B","RA PROCEDURE SHORT LIST    FILE #71",2)

"BLD",4828,"KRN",.401,0)
.401
"BLD",4828,"KRN",.402,0)
.402
"BLD",4828,"KRN",.402,"NM",0)
^9.68A^3^3
"BLD",4828,"KRN",.402,"NM",1,0)
RA PROCEDURE EDIT    FILE #71^71^0
"BLD",4828,"KRN",.402,"NM",2,0)
RA STATUS CHANGE    FILE #70^70^0
"BLD",4828,"KRN",.402,"NM",3,0)
RA EXAM EDIT    FILE #70^70^0
"BLD",4828,"KRN",.402,"NM","B","RA EXAM EDIT    FILE #70",3)

"BLD",4828,"KRN",.402,"NM","B","RA PROCEDURE EDIT    FILE #71",1)

"BLD",4828,"KRN",.402,"NM","B","RA STATUS CHANGE    FILE #70",2)

"BLD",4828,"KRN",.403,0)
.403
"BLD",4828,"KRN",.5,0)
.5
"BLD",4828,"KRN",.84,0)
.84
"BLD",4828,"KRN",3.6,0)
3.6
"BLD",4828,"KRN",3.8,0)
3.8
"BLD",4828,"KRN",9.2,0)
9.2
"BLD",4828,"KRN",9.8,0)
9.8
"BLD",4828,"KRN",9.8,"NM",0)
^9.68A^37^35
"BLD",4828,"KRN",9.8,"NM",1,0)
RACMHIS^^0^B19686346
"BLD",4828,"KRN",9.8,"NM",2,0)
RADEM1^^0^B19574388
"BLD",4828,"KRN",9.8,"NM",3,0)
RAO7UTL^^0^B24997892
"BLD",4828,"KRN",9.8,"NM",6,0)
RAMAIN2^^0^B45749858
"BLD",4828,"KRN",9.8,"NM",7,0)
RAMAINP1^^0^B24954066
"BLD",4828,"KRN",9.8,"NM",8,0)
RAMAINU^^0^B21859709
"BLD",4828,"KRN",9.8,"NM",9,0)
RAO7PC1A^^0^B39556954
"BLD",4828,"KRN",9.8,"NM",10,0)
RAORD1^^0^B41078286
"BLD",4828,"KRN",9.8,"NM",11,0)
RAUTL2^^0^B39107271
"BLD",4828,"KRN",9.8,"NM",12,0)
RAUTL8^^0^B35832037
"BLD",4828,"KRN",9.8,"NM",13,0)
RAORD3^^0^B23672293
"BLD",4828,"KRN",9.8,"NM",14,0)
RAORD6^^0^B44182217
"BLD",4828,"KRN",9.8,"NM",15,0)
RAO7MFN^^0^B40096491
"BLD",4828,"KRN",9.8,"NM",16,0)
RAEDCN^^0^B54472977
"BLD",4828,"KRN",9.8,"NM",17,0)
RAEDCN1^^0^B13671032
"BLD",4828,"KRN",9.8,"NM",18,0)
RAO7PC1^^0^B25997110
"BLD",4828,"KRN",9.8,"NM",19,0)
RAPROD^^0^B40468374
"BLD",4828,"KRN",9.8,"NM",20,0)
RAPROD2^^0^B17368908
"BLD",4828,"KRN",9.8,"NM",21,0)
RAPROD1^^0^B41351989
"BLD",4828,"KRN",9.8,"NM",22,0)
RAPINFO^^0^B29510727
"BLD",4828,"KRN",9.8,"NM",23,0)
RAEDPT^^0^B9185618
"BLD",4828,"KRN",9.8,"NM",24,0)
RASTED^^0^B45805107
"BLD",4828,"KRN",9.8,"NM",25,0)
RAORD61^^0^B6446942
"BLD",4828,"KRN",9.8,"NM",26,0)
RAORD2^^0^B43792586
"BLD",4828,"KRN",9.8,"NM",27,0)
RAORD5^^0^B27398038
"BLD",4828,"KRN",9.8,"NM",28,0)
RAO7PC4^^0^B39691653
"BLD",4828,"KRN",9.8,"NM",29,0)
RA45PST^^0^B8354086
"BLD",4828,"KRN",9.8,"NM",30,0)
RA45PST1^^0^B16417290
"BLD",4828,"KRN",9.8,"NM",31,0)
RA45PST2^^0^B27667631
"BLD",4828,"KRN",9.8,"NM",32,0)
RAMAINU1^^0^B13645290
"BLD",4828,"KRN",9.8,"NM",33,0)
RAO7PC2^^0^B43565991
"BLD",4828,"KRN",9.8,"NM",34,0)
RART3^^0^B21497929
"BLD",4828,"KRN",9.8,"NM",35,0)
RARTR3^^0^B17132620
"BLD",4828,"KRN",9.8,"NM",36,0)
RARTE^^0^B27555135
"BLD",4828,"KRN",9.8,"NM",37,0)
RAUTL21^^0^B14822471
"BLD",4828,"KRN",9.8,"NM","B","RA45PST",29)

"BLD",4828,"KRN",9.8,"NM","B","RA45PST1",30)

"BLD",4828,"KRN",9.8,"NM","B","RA45PST2",31)

"BLD",4828,"KRN",9.8,"NM","B","RACMHIS",1)

"BLD",4828,"KRN",9.8,"NM","B","RADEM1",2)

"BLD",4828,"KRN",9.8,"NM","B","RAEDCN",16)

"BLD",4828,"KRN",9.8,"NM","B","RAEDCN1",17)

"BLD",4828,"KRN",9.8,"NM","B","RAEDPT",23)

"BLD",4828,"KRN",9.8,"NM","B","RAMAIN2",6)

"BLD",4828,"KRN",9.8,"NM","B","RAMAINP1",7)

"BLD",4828,"KRN",9.8,"NM","B","RAMAINU",8)

"BLD",4828,"KRN",9.8,"NM","B","RAMAINU1",32)

"BLD",4828,"KRN",9.8,"NM","B","RAO7MFN",15)

"BLD",4828,"KRN",9.8,"NM","B","RAO7PC1",18)

"BLD",4828,"KRN",9.8,"NM","B","RAO7PC1A",9)

"BLD",4828,"KRN",9.8,"NM","B","RAO7PC2",33)

"BLD",4828,"KRN",9.8,"NM","B","RAO7PC4",28)

"BLD",4828,"KRN",9.8,"NM","B","RAO7UTL",3)

"BLD",4828,"KRN",9.8,"NM","B","RAORD1",10)

"BLD",4828,"KRN",9.8,"NM","B","RAORD2",26)

"BLD",4828,"KRN",9.8,"NM","B","RAORD3",13)

"BLD",4828,"KRN",9.8,"NM","B","RAORD5",27)

"BLD",4828,"KRN",9.8,"NM","B","RAORD6",14)

"BLD",4828,"KRN",9.8,"NM","B","RAORD61",25)

"BLD",4828,"KRN",9.8,"NM","B","RAPINFO",22)

"BLD",4828,"KRN",9.8,"NM","B","RAPROD",19)

"BLD",4828,"KRN",9.8,"NM","B","RAPROD1",21)

"BLD",4828,"KRN",9.8,"NM","B","RAPROD2",20)

"BLD",4828,"KRN",9.8,"NM","B","RART3",34)

"BLD",4828,"KRN",9.8,"NM","B","RARTE",36)

"BLD",4828,"KRN",9.8,"NM","B","RARTR3",35)

"BLD",4828,"KRN",9.8,"NM","B","RASTED",24)

"BLD",4828,"KRN",9.8,"NM","B","RAUTL2",11)

"BLD",4828,"KRN",9.8,"NM","B","RAUTL21",37)

"BLD",4828,"KRN",9.8,"NM","B","RAUTL8",12)

"BLD",4828,"KRN",19,0)
19
"BLD",4828,"KRN",19,"NM",0)
^9.68A^5^5
"BLD",4828,"KRN",19,"NM",1,0)
RA CMAUDIT HISTORY^^0
"BLD",4828,"KRN",19,"NM",2,0)
RA PROCMEDIA^^0
"BLD",4828,"KRN",19,"NM",3,0)
RA PROCLISTS^^2
"BLD",4828,"KRN",19,"NM",4,0)
RA VIEWCN^^0
"BLD",4828,"KRN",19,"NM",5,0)
RA DELETEXAM^^0
"BLD",4828,"KRN",19,"NM","B","RA CMAUDIT HISTORY",1)

"BLD",4828,"KRN",19,"NM","B","RA DELETEXAM",5)

"BLD",4828,"KRN",19,"NM","B","RA PROCLISTS",3)

"BLD",4828,"KRN",19,"NM","B","RA PROCMEDIA",2)

"BLD",4828,"KRN",19,"NM","B","RA VIEWCN",4)

"BLD",4828,"KRN",19.1,0)
19.1
"BLD",4828,"KRN",101,0)
101
"BLD",4828,"KRN",409.61,0)
409.61
"BLD",4828,"KRN",771,0)
771
"BLD",4828,"KRN",870,0)
870
"BLD",4828,"KRN",8989.51,0)
8989.51
"BLD",4828,"KRN",8989.52,0)
8989.52
"BLD",4828,"KRN",8994,0)
8994
"BLD",4828,"KRN","B",.4,.4)

"BLD",4828,"KRN","B",.401,.401)

"BLD",4828,"KRN","B",.402,.402)

"BLD",4828,"KRN","B",.403,.403)

"BLD",4828,"KRN","B",.5,.5)

"BLD",4828,"KRN","B",.84,.84)

"BLD",4828,"KRN","B",3.6,3.6)

"BLD",4828,"KRN","B",3.8,3.8)

"BLD",4828,"KRN","B",9.2,9.2)

"BLD",4828,"KRN","B",9.8,9.8)

"BLD",4828,"KRN","B",19,19)

"BLD",4828,"KRN","B",19.1,19.1)

"BLD",4828,"KRN","B",101,101)

"BLD",4828,"KRN","B",409.61,409.61)

"BLD",4828,"KRN","B",771,771)

"BLD",4828,"KRN","B",870,870)

"BLD",4828,"KRN","B",8989.51,8989.51)

"BLD",4828,"KRN","B",8989.52,8989.52)

"BLD",4828,"KRN","B",8994,8994)

"BLD",4828,"QUES",0)
^9.62^^
"BLD",4828,"REQB",0)
^9.611^1^1
"BLD",4828,"REQB",1,0)
RA*5.0*51^2
"BLD",4828,"REQB","B","RA*5.0*51",1)

"FIA",70)
RAD/NUC MED PATIENT
"FIA",70,0)
^RADPT(
"FIA",70,0,0)
70IP
"FIA",70,0,1)
y^n^p^^^^n^^n
"FIA",70,0,10)

"FIA",70,0,11)

"FIA",70,0,"RLRO")

"FIA",70,0,"VR")
5.0^RA
"FIA",70,70)
1
"FIA",70,70.03)
1
"FIA",70,70.03,10)

"FIA",70,70.03,225)

"FIA",70,70.03,250)

"FIA",70,70.16)
0
"FIA",70,70.3225)
0
"FIA",71)
RAD/NUC MED PROCEDURES
"FIA",71,0)
^RAMIS(71,
"FIA",71,0,0)
71I
"FIA",71,0,1)
y^n^p^^^^n^^n
"FIA",71,0,10)

"FIA",71,0,11)

"FIA",71,0,"RLRO")

"FIA",71,0,"VR")
5.0^RA
"FIA",71,71)
1
"FIA",71,71,20)

"FIA",71,71,125)

"FIA",71,71,175)

"FIA",71,71,250)

"FIA",71,71.0125)
0
"FIA",71,71.03)
1
"FIA",71,71.03,.01)

"FIA",71,71.06)
0
"FIA",71.1)
MAJOR RAD/NUC MED AMIS CODES
"FIA",71.1,0)
^RAMIS(71.1,
"FIA",71.1,0,0)
71.1
"FIA",71.1,0,1)
y^n^p^^^^n^^n
"FIA",71.1,0,10)

"FIA",71.1,0,11)

"FIA",71.1,0,"RLRO")

"FIA",71.1,0,"VR")
5.0^RA
"FIA",71.1,71.1)
1
"FIA",71.1,71.1,.001)

"FIA",71.1,71.1,.01)

"INIT")
RA45PST
"KRN",.4,335,-1)
0^1
"KRN",.4,335,0)
RA PROCEDURE LIST^3031113.0859^^71^^^3040809
"KRN",.4,335,"%D",0)
^.4001^1^1^3020603^^^^
"KRN",.4,335,"%D",1,0)
This template is used in the generation of long procedure listings.
"KRN",.4,335,"DXS",1,9.2)
S I(1,0)=$G(D1),I(0,0)=$G(D0),DIP(1)=$S($D(^RAMIS(71,D0,"DCM",D1,0)):^(0),1:""),D0=$P(DIP(1),U,1) S:'D0!'$D(^DIC(81.3,+D0,0)) D0=-1 S DIP(101)=$S($D(^DIC(81.3,D0,0)):^(0),1:"")
"KRN",.4,335,"DXS",2,9)
W:$D(RADIO(0)) !?5,"Default Radiopharmaceutical: ",?39,$$GET1^DIQ(50,+$P(RADIO(0),"^")_",",.01)
"KRN",.4,335,"DXS",3,9)
W:$D(RADIO(0)) !?5," Dflt Administration Route : ",?39,$$GET1^DIQ(71.6,+$P(RADIO(0),"^",3)_",",.01)
"KRN",.4,335,"DXS",4,9)
W:$D(RADIO(0)) !?5," Dflt Administration Site  : ",?39,$$GET1^DIQ(71.7,+$P(RADIO(0),"^",4)_",",.01)
"KRN",.4,335,"DXS",5,9)
W:$D(RADIO(0)) !?5," Default Form              : ",?39,$$GET1^DIQ(71.08,D1_","_D0_",",7)
"KRN",.4,335,"DXS",6,9)
W:$D(RAPHARM(0)) !?5,"Default Medication         : ",?39,$$GET1^DIQ(50,+$P(RAPHARM(0),"^")_",",.01)
"KRN",.4,335,"DXS",7,9)
S RA1=0 F  S RA1=$O(^RAMIS(71,D0,"MDL",RA1)) Q:'RA1  S RA2=+^(RA1,0) W ?39,$P(^RAMIS(73.1,RA2,0),U),?44,$P(^(0),U,2) W:$O(^RAMIS(71,D0,"MDL",RA1)) !," "
"KRN",.4,335,"F",1)

"KRN",.4,335,"F",2)
S:$P($G(^RA(79.2,+$P($G(^RAMIS(71,D0,0)),"^",12),0)),"^",5)="Y" RADIO="";"";Z;"S:$P($G(^RA(79.2,+$P($G(^RAMIS(71,D0,0)),"^",12),0)),"^",5)="Y" RADIO="""~
"KRN",.4,335,"F",3)
9;C1~.01;C10;"PROCEDURE / CPT MODIFIER";L30~
"KRN",.4,335,"F",4)
175,S DIP(1)=$S($D(^RAMIS(71,D0,2,D1,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X W X K DIP;C45;X;Z;"INTERNAL(AMIS CODE)"~175,"-";C48;X~175,.01;C50;L30~
"KRN",.4,335,"F",5)
175,2;C85;"MULTIPLIER"~175,3;C100;"BILATERAL"~175,4;C115;"CT HEAD/BODY"~135,.01;C7;""~135,"(";C10~
"KRN",.4,335,"F",6)
135,X DXS(1,9.2) S X=$P(DIP(101),U,2),DIP(102)=$G(X) S X="  ",X=$P(DIP(102),X) S D0=I(0,0) S D1=I(1,0) W X K DIP;C11;"";Z;"$P(.01:NAME,"  ")"~135,")";X~
"KRN",.4,335,"F",7)
W !!?5,"Type of Procedure          : ";X;Z;"W !!?5,"Type of Procedure          : ""~6;C40;""~
"KRN",.4,335,"F",8)
D:+$O(^RAMIS(71,D0,"CM",0)) CMDISP^RAMAINP1(D0);"";Z;"D:+$O(^RAMIS(71,D0,"CM",0)) CMDISP^RAMAINP1(D0)"~
"KRN",.4,335,"F",9)
W !?5,"Required Flash Card Printer: ";X;"";Z;"W !?5,"Required Flash Card Printer: ""~3;C40;""~
"KRN",.4,335,"F",10)
W !?5,"Required Flash Card Format : ";X;Z;"W !?5,"Required Flash Card Format : ""~4;C40;""~
"KRN",.4,335,"F",11)
W !?5,"Cost of Procedure          : ";X;Z;"W !?5,"Cost of Procedure          : ""~10;C40;L10;""~
"KRN",.4,335,"F",12)
W !?5,"Health Summary With Request: ";X;Z;"W !?5,"Health Summary With Request: ""~13;C40;""~
"KRN",.4,335,"F",13)
W !?5,"Staff Review of Reports Req: ";X;Z;"W !?5,"Staff Review of Reports Req: ""~7;C40;""~
"KRN",.4,335,"F",14)
W !?5,"Rad Approval of Request Req: ";X;Z;"W !?5,"Rad Approval of Request Req: ""~11;C40;""~
"KRN",.4,335,"F",15)
W !?5,"Type of Imaging            : ";X;Z;"W !?5,"Type of Imaging            : ""~12;C40;""~
"KRN",.4,335,"F",16)
W:$D(RADIO) !?5,"Ask Radiopharmaceutical    :     ";X;Z;"W:$D(RADIO) !?5,"Ask Radiopharmaceutical    :     ""~
"KRN",.4,335,"F",17)
W:$D(RADIO) ?39,$$GET1^DIQ(71,D0_",",2);X;Z;"W:$D(RADIO) ?39,$$GET1^DIQ(71,D0_",",2)"~
"KRN",.4,335,"F",18)
W:$D(RADIO) !?5,"Prompt for Radiopharm RX   : ";X;Z;"W:$D(RADIO) !?5,"Prompt for Radiopharm RX   : ""~
"KRN",.4,335,"F",19)
W:$D(RADIO) ?39,$$GET1^DIQ(71,D0_",",19);X;Z;"W:$D(RADIO) ?39,$$GET1^DIQ(71,D0_",",19)"~
"KRN",.4,335,"F",20)
50,S:$D(RADIO) RADIO(0)=$G(^RAMIS(71,D0,"NUC",D1,0));"";m;Z;"S:$D(RADIO) RADIO(0)=$G(^RAMIS(71,D0,"NUC",D1,0))"~
"KRN",.4,335,"F",21)
50,X DXS(2,9);X;Z;"W:$D(RADIO(0)) !?5,"Default Radiopharmaceutical: ",?39,$$GET1^DIQ(50,+$P(RADIO(0),"^")_",",.01)"~
"KRN",.4,335,"F",22)
50,W:$D(RADIO(0)) !?5," Usual Dose                : ",?39,$P(RADIO(0),"^",2);X;Z;"W:$D(RADIO(0)) !?5," Usual Dose                : ",?39,$P(RADIO(0),"^",2)"~
"KRN",.4,335,"F",23)
50,X DXS(3,9);X;Z;"W:$D(RADIO(0)) !?5," Dflt Administration Route : ",?39,$$GET1^DIQ(71.6,+$P(RADIO(0),"^",3)_",",.01)"~
"KRN",.4,335,"F",24)
50,X DXS(4,9);X;Z;"W:$D(RADIO(0)) !?5," Dflt Administration Site  : ",?39,$$GET1^DIQ(71.7,+$P(RADIO(0),"^",4)_",",.01)"~
"KRN",.4,335,"F",25)
50,W:$D(RADIO(0)) !?5," High Adult Dose           : ",?39,$P(RADIO(0),"^",5);X;Z;"W:$D(RADIO(0)) !?5," High Adult Dose           : ",?39,$P(RADIO(0),"^",5)"~
"KRN",.4,335,"F",26)
50,W:$D(RADIO(0)) !?5," Low Adult Dose            : ",?39,$P(RADIO(0),"^",6);X;Z;"W:$D(RADIO(0)) !?5," Low Adult Dose            : ",?39,$P(RADIO(0),"^",6)"~
"KRN",.4,335,"F",27)
50,X DXS(5,9);X;Z;"W:$D(RADIO(0)) !?5," Default Form              : ",?39,$$GET1^DIQ(71.08,D1_","_D0_",",7)"~
"KRN",.4,335,"F",28)
W !?5,"Prompt for Medication?     : ",?39,$$GET1^DIQ(71,D0_",",5);X;Z;"W !?5,"Prompt for Medication?     : ",?39,$$GET1^DIQ(71,D0_",",5)"~
"KRN",.4,335,"F",29)
55,S RAPHARM(0)=$G(^RAMIS(71,D0,"P",D1,0));"";X;Z;"S RAPHARM(0)=$G(^RAMIS(71,D0,"P",D1,0))"~
"KRN",.4,335,"F",30)
55,X DXS(6,9);X;Z;"W:$D(RAPHARM(0)) !?5,"Default Medication         : ",?39,$$GET1^DIQ(50,+$P(RAPHARM(0),"^")_",",.01)"~
"KRN",.4,335,"F",31)
55,W:$D(RAPHARM(0)) !?5," Default Dose              : ",?39,$P(RAPHARM(0),"^",2);X;Z;"W:$D(RAPHARM(0)) !?5," Default Dose              : ",?39,$P(RAPHARM(0),"^",2)"~
"KRN",.4,335,"F",32)
W !?5,"Descendents                :";"";X;Z;"W !?5,"Descendents                :""~300,.01;C40;X~300,S RAZ71=+X;"";Z;"S RAZ71=+X"~
"KRN",.4,335,"F",33)
300,D:+$O(^RAMIS(71,RAZ71,"CM",0)) CMDISP^RAMAINP1(RAZ71);"";Z;"D:+$O(^RAMIS(71,RAZ71,"CM",0)) CMDISP^RAMAINP1(RAZ71)"~
"KRN",.4,335,"F",34)
W !?5,"Procedure Message          :";X;Z;"W !?5,"Procedure Message          :""~200,.01;C40;W35;"";X~"Educational Description    :";C6;L28;""~
"KRN",.4,335,"F",35)
500,.01;C40;""~W ?5,"Modality",?32,":";"";Z;"W ?5,"Modality",?32,":""~
"KRN",.4,335,"F",36)
X DXS(7,9);"";X;Z;"S RA1=0 F  S RA1=$O(^RAMIS(71,D0,"MDL",RA1)) Q:'RA1  S RA2=+^(RA1,0) W ?39,$P(^RAMIS(73.1,RA2,0),U),?44,$P(^(0),U,2) W:$O(^RAMIS(71,D0,"MDL",RA1)) !," ""~
"KRN",.4,335,"F",37)
K RAZ71;Z;"K RAZ71"~
"KRN",.4,335,"H")
Imaging Procedure List
"KRN",.4,336,-1)
0^2
"KRN",.4,336,0)
RA PROCEDURE SHORT LIST^3031113.1133^^71^^^3040809
"KRN",.4,336,"%D",0)
^^1^1^2940607^^
"KRN",.4,336,"%D",1,0)
Used to generate the inactive short procedure listings.
"KRN",.4,336,"DXS",1,9.2)
S I(0,0)=$G(D0),DIP(1)=$S($D(^RAMIS(71,D0,0)):^(0),1:""),D0=$P(DIP(1),U,12) S:'D0!'$D(^RA(79.2,+D0,0)) D0=-1 S DIP(101)=$S($D(^RA(79.2,D0,0)):^(0),1:"")
"KRN",.4,336,"DXS",2,9)
S RA1=0 F  S RA1=$O(^RAMIS(71,D0,"MDL",RA1)) Q:'RA1  S RA2=+^(RA1,0) W $P(^RAMIS(73.1,RA2,0),U) W:$X>(IOM-3)&($O(^RAMIS(71,D0,"MDL",RA1))) !?116 W:$O(^RAMIS(71,D0,"MDL",RA1)) "," W:$X>(IOM-3) ?116
"KRN",.4,336,"F",1)
9;C1~.01;C10;"PROCEDURE";L40~175,S DIP(1)=$S($D(^RAMIS(71,D0,2,D1,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X W X K DIP;C55;X;Z;"INTERNAL(AMIS CODE)"~
"KRN",.4,336,"F",2)
175,"-";C58;X~175,.01;C60;L30~175,2;L3;C93;"MULT"~175,3;C99;"BI- LAT"~175,4;C105;"CT"~
"KRN",.4,336,"F",3)
X DXS(1,9.2) S X=$P(DIP(101),U,3) S D0=I(0,0) W X K DIP;C111;"IMG TYPE";L5;Z;"TYPE OF IMAGING:ABBREV"~
"KRN",.4,336,"F",4)
X DXS(2,9);"MODALITY";C117;Z;"S RA1=0 F  S RA1=$O(^RAMIS(71,D0,"MDL",RA1)) Q:'RA1  S RA2=+^(RA1,0) W $P(^RAMIS(73.1,RA2,0),U) W:$X>(IOM-3)&($O(^RAMIS(71,D0,"MDL",RA1))) !?116 W:$O(^RAMIS(71,D0,"MDL",RA1)) "," W:$X>(IOM-3) ?116"~
"KRN",.4,336,"F",5)
D:+$O(^RAMIS(71,D0,"CM",0)) CMDISP^RAMAINP1(D0);"";Z;"D:+$O(^RAMIS(71,D0,"CM",0)) CMDISP^RAMAINP1(D0)"~
"KRN",.4,336,"F",6)
"----------------------------------------------------------------------------------------------------------------------------------";C1;""~
"KRN",.4,336,"H")
Imaging Procedure Quick List
"KRN",.4,338,-1)
0^3
"KRN",.4,338,0)
RA ALPHA LIST OF ACTIVES^3031113.1346^^71^^^3040809
"KRN",.4,338,"%D",0)
^^1^1^2940608^
"KRN",.4,338,"%D",1,0)
Produces an alphabetic listing of all active imaging procedures.
"KRN",.4,338,"DXS",1,9.2)
S I(0,0)=$G(D0),DIP(1)=$S($D(^RAMIS(71,D0,0)):^(0),1:""),D0=$P(DIP(1),U,12) S:'D0!'$D(^RA(79.2,+D0,0)) D0=-1 S DIP(101)=$S($D(^RA(79.2,D0,0)):^(0),1:"")
"KRN",.4,338,"DXS",2,9)
S RA1=0 F  S RA1=$O(^RAMIS(71,D0,"MDL",RA1)) Q:'RA1  S RA2=+^(RA1,0) W $P(^RAMIS(73.1,RA2,0),U) W:$X>(IOM-3)&($O(^RAMIS(71,D0,"MDL",RA1))) !?116 W:$O(^RAMIS(71,D0,"MDL",RA1)) "," W:$X>(IOM-3) ?116
"KRN",.4,338,"F",1)
.01;L40;C1~9;C45~175,S DIP(1)=$S($D(^RAMIS(71,D0,2,D1,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X W X K DIP;L3;C55;"";Z;"INTERNAL(AMIS CODE)"~175,.01;C60;L30~
"KRN",.4,338,"F",2)
175,2;L3;C93;"MULT"~175,3;C99;"BI- LAT"~175,4;L4;C105;"CT"~
"KRN",.4,338,"F",3)
X DXS(1,9.2) S X=$P(DIP(101),U,3) S D0=I(0,0) W X K DIP;C111;"IMG TYPE";L5;Z;"TYPE OF IMAGING:ABBREV"~
"KRN",.4,338,"F",4)
X DXS(2,9);"MODALITY";C117;Z;"S RA1=0 F  S RA1=$O(^RAMIS(71,D0,"MDL",RA1)) Q:'RA1  S RA2=+^(RA1,0) W $P(^RAMIS(73.1,RA2,0),U) W:$X>(IOM-3)&($O(^RAMIS(71,D0,"MDL",RA1))) !?116 W:$O(^RAMIS(71,D0,"MDL",RA1)) "," W:$X>(IOM-3) ?116"~
"KRN",.4,338,"F",5)
D:+$O(^RAMIS(71,D0,"CM",0)) CMDISP^RAMAINP1(D0);"";Z;"D:+$O(^RAMIS(71,D0,"CM",0)) CMDISP^RAMAINP1(D0)"~
"KRN",.4,338,"F",6)
"----------------------------------------------------------------------------------------------------------------------------------";C1~
"KRN",.4,338,"H")
Alpha Listing of Active Procedures
"KRN",.4,1708,-1)
0^4
"KRN",.4,1708,0)
RA PARENT PROCEDURE LIST^3031107.141^@^71^^@^3041215
"KRN",.4,1708,"DXS",1,9.2)
S I(1,0)=$G(D1),I(0,0)=$G(D0),DIP(1)=$S($D(^RAMIS(71,D0,4,D1,0)):^(0),1:""),D0=$P(DIP(1),U,1) S:'D0!'$D(^RAMIS(71,+D0,0)) D0=-1 S DIP(101)=$S($D(^RAMIS(71,D0,0)):^(0),1:"")
"KRN",.4,1708,"DXS",2,9)
S RA1=0 F  S RA1=$O(^RAMIS(71,RAZ71,"MDL",RA1)) Q:'RA1  S RA3=^(RA1,0) W $P(^RAMIS(73.1,RA3,0),U) W:$O(^RAMIS(71,RAZ71,"MDL",RA1)) ","
"KRN",.4,1708,"F",1)
S:+$G(^RAMIS(71,D0,"I"))>0&(+$G(^RAMIS(71,D0,"I"))'>DT) RAINACT="";X;Z;"S:+$G(^RAMIS(71,D0,"I"))>0&(+$G(^RAMIS(71,D0,"I"))'>DT) RAINACT="""~
"KRN",.4,1708,"F",2)
S REM="Set flag so inactivated date prints";X;Z;"S REM="Set flag so inactivated date prints""~.01;C10;"Parent Name";L60~
"KRN",.4,1708,"F",3)
W !?5,"Single Report       : ";X;Z;"W !?5,"Single Report       : ""~18;C28;""~W !?5,"Hlth Summary w Req. : ";X;Z;"W !?5,"Hlth Summary w Req. : ""~
"KRN",.4,1708,"F",4)
13;C28;""~W:$D(RAINACT) !?5,"Inactivation Date   : ";X;Z;"W:$D(RAINACT) !?5,"Inactivation Date   : ""~
"KRN",.4,1708,"F",5)
W:$D(RAINACT) ?27,$$FMTE^XLFDT(+$G(^RAMIS(71,D0,"I")));X;Z;"W:$D(RAINACT) ?27,$$FMTE^XLFDT(+$G(^RAMIS(71,D0,"I")))"~
"KRN",.4,1708,"F",6)
W !?5,"Rad Approval of Req.: ";X;Z;"W !?5,"Rad Approval of Req.: ""~11;C28;""~W !?5,"Type of Imaging     :";X;Z;"W !?5,"Type of Imaging     :""~
"KRN",.4,1708,"F",7)
12;C28;""~W !?5,"Descendants         : ";X;Z;"W !?5,"Descendants         : ""~300,W "(";C28;L1;"";Z;"W "(""~
"KRN",.4,1708,"F",8)
300,X DXS(1,9.2) S X=$P($G(^ICPT(+$P(DIP(101),U,9),0)),U) S D0=I(0,0) S D1=I(1,0) W X K DIP;C29;L5;"";Z;".01:9"~300,W ")";C34;L1;"";Z;"W ")""~
"KRN",.4,1708,"F",9)
300,.01;C36;L44;""~300,S RAZ71=+X;"";Z;"S RAZ71=+X"~
"KRN",.4,1708,"F",10)
300,W:$O(^RAMIS(71,RAZ71,"MDL",0)) ?81,"Modality: ";"";Z;"W:$O(^RAMIS(71,RAZ71,"MDL",0)) ?81,"Modality: ""~
"KRN",.4,1708,"F",11)
300,X DXS(2,9);"";X;Z;"S RA1=0 F  S RA1=$O(^RAMIS(71,RAZ71,"MDL",RA1)) Q:'RA1  S RA3=^(RA1,0) W $P(^RAMIS(73.1,RA3,0),U) W:$O(^RAMIS(71,RAZ71,"MDL",RA1)) ",""~
"KRN",.4,1708,"F",12)
300,D:+$O(^RAMIS(71,RAZ71,"CM",0)) CMDISP^RAMAINP1(RAZ71);"";Z;"D:+$O(^RAMIS(71,RAZ71,"CM",0)) CMDISP^RAMAINP1(RAZ71)"~
"KRN",.4,1708,"F",13)
W !?5,"Procedure Message   :";X;Z;"W !?5,"Procedure Message   :""~200,.01;C28;W35;""~
"KRN",.4,1708,"F",14)
W !?5,"Educational Desc    : ";X;Z;"W !?5,"Educational Desc    : ""~500,.01;C28;W35;""~K RAINACT,RAZ71,REM;"";Z;"K RAINACT,RAZ71,REM"~
"KRN",.4,1708,"H")
Parent Procedure List
"KRN",.402,220,-1)
0^1
"KRN",.402,220,0)
RA PROCEDURE EDIT^3040726.0931^^71^^^3050401
"KRN",.402,220,"DIAB",1,0,71,9)
17;"DISPLAY EDUCATIONAL DESCRIPTION WHEN ORDERED"
"KRN",.402,220,"DIAB",1,1,71.01,0)
ALL
"KRN",.402,220,"DIAB",1,1,71.0125,0)
ALL
"KRN",.402,220,"DIAB",1,1,71.0135,0)
ALL
"KRN",.402,220,"DIAB",1,1,71.04,0)
ALL
"KRN",.402,220,"DIAB",1,1,71.0731,0)
ALL
"KRN",.402,220,"DIAB",2,1,71.08,0)
6;T
"KRN",.402,220,"DIAB",4,1,71.08,0)
5;T
"KRN",.402,220,"DIAB",7,1,71.08,0)
2;T
"KRN",.402,220,"DR",1,71)
S DIE("NO^")="BACKOUTOK";S:$P(^RAMIS(71,DA,0),U,8)="Y" Y="@01";.01;@01;12;S RAIMAG=$$IMAG^RASITE(+X);K RADIO;S:$P($G(^RA(79.2,+$P($G(^RAMIS(71,DA,0)),"^",12),0)),"^",5)="Y" RADIO="";6//BROAD;S RAPTY=$E(X);K DIE("NO^");
"KRN",.402,220,"DR",1,71,1)
S:(RAPTY="B")!(RAPTY="P") Y="@7";20//NO;S RAREM="check if user answered 'no' to 'CM Used'" K RAREM;S:$P($G(^RAMIS(71,DA,0)),U,20)="Y" Y="@5";N RADELCMQ S RAREM="if 'no' or null to 'CM Used' kill CM data" K RAREM;
"KRN",.402,220,"DR",1,71,2)
S:+$O(^RAMIS(71,DA,"CM",0))=0 Y="@6";S RADELCMQ=$$DELCM^RAUTL2(DA);S:$G(RADELCMQ)="^" Y="@999";S:$G(RADELCMQ)="N" Y="@5";K ^RAMIS(71,DA,"CM") S Y="@6";@5;125;@6;731;@7;S:RAPTY'="P" Y="@10";18;@10;13;150;S:"BP"[RAPTY Y="@50";5;55;
"KRN",.402,220,"DR",1,71,3)
S:'$D(RADIO) Y="@50";@20;W !!?3,"Reminder --";W !!?3,"Selection of 'Suppress' for 'SUPPRESS RADIOPHARM PROMPT' will result in";W !?3,"the deletion of all default radiopharmaceutical information for this";W !?3,"procedure.",!;2;
"KRN",.402,220,"DR",1,71,4)
S:X'=1 Y="@40";S:'$O(^RAMIS(71,DA,"NUC",0))&($P(^RAMIS(71,DA,0),U,19)="") Y="@70";W:$O(^RAMIS(71,DA,"NUC",0)) !!?3,"Radiopharmaceutical information entered previously",!?3,"for this procedure will be delete.",$C(7);
"KRN",.402,220,"DR",1,71,5)
W:$P(^RAMIS(71,DA,0),U,19)]"" !!?3,"PROMPT FOR RADIOPHARM RX will be deleted.",$C(7);S RAASK="" R !!,"Are you sure you want those data deleted ? : N//",RAASK;S:$E(RAASK)=""!("Yy"'[$E(RAASK)) Y="@20";
"KRN",.402,220,"DR",1,71,6)
S RAREM="default radiopharms will be deleted from calling rtn RAMAIN2" K RAREM;19///@;S:RAPTY="B" Y="@150";S:RAPTY="P" Y="@200";S Y="@70";@40;19;@50;S:RAPTY="B" Y="@150";S:RAPTY="P" Y="@200";S:'$D(RADIO) Y="@70";50;@70;175;
"KRN",.402,220,"DR",1,71,7)
S RAREM="edit CPT for new records only RAPNM=proc. name" K RAREM;S:'RANEW71 Y="@15";D CPT^RAMAINU(DA,RAPNM);@15;W:'RANEW71 !,"CPT CODE// "_$P($$NAMCODE^RACPTMSC($P(^RAMIS(71,DA,0),U,9),DT),U)_" (no editing)";
"KRN",.402,220,"DR",1,71,8)
D:$T(DISDCM^RACPTMSC)]"" DISDCM^RACPTMSC;135;7//NO;11//NO;@150;3;4;75;@200;S:"BP"'[RAPTY Y="@250";11//NO;@250;200;S:RAPTY'="P" Y="@290";300;@290;500;S:'$O(^RAMIS(71,DA,"EDU",0)) Y="@300";
"KRN",.402,220,"DR",1,71,9)
17DISPLAY EDUCATIONAL DESCRIPTION WHEN ORDERED~;@300;100//^S X=$S(RAPTY="P"&('$O(^RAMIS(71,DA,4,0))):DT,1:"");@999;K RADIO,RAMIS,RAPTY,RAIMAG;
"KRN",.402,220,"DR",2,71.01)
.01
"KRN",.402,220,"DR",2,71.0125)
.01
"KRN",.402,220,"DR",2,71.0135)
.01
"KRN",.402,220,"DR",2,71.02)
.01;2;
"KRN",.402,220,"DR",2,71.03)
.01;S RAMIS=X;2;S:$P(RAIMAG,U,3)="NM" Y="@99";3;S:RAMIS'=21 Y="@99";4;@99;
"KRN",.402,220,"DR",2,71.04)
.01
"KRN",.402,220,"DR",2,71.05)
.01;
"KRN",.402,220,"DR",2,71.055)
.01;2;
"KRN",.402,220,"DR",2,71.0731)
.01
"KRN",.402,220,"DR",2,71.08)
.01;6T~;S X=X;5T~;S X=X;D EN^DDIOL("Input a 'Usual Dose' value within the range of: "_$$RANGE^RADD2(.DA),"","!?5");2T~;S X=X;3;S RAROUTE=+$G(X);S:'$O(^RAMIS(71.6,RAROUTE,"SITE",0)) Y="@49";
"KRN",.402,220,"DR",2,71.08,1)
S:$P(^RAMIS(71.6,RAROUTE,0),U,3)="Y" Y="@49";4;S Y="@55";@49;4///@;@55;7;
"KRN",.402,230,-1)
0^2
"KRN",.402,230,0)
RA STATUS CHANGE^3050127.0755^^70^^^3050303
"KRN",.402,230,"%D",0)
^^2^2^2940607^^^
"KRN",.402,230,"%D",1,0)
 
"KRN",.402,230,"%D",2,0)
This template is used for the Status Tracking of Exams option.
"KRN",.402,230,"DIAB",1,2,70.03,10)
500:
"KRN",.402,230,"DIAB",1,3,70.09,0)
ALL
"KRN",.402,230,"DIAB",1,3,70.1,0)
ALL
"KRN",.402,230,"DIAB",1,3,70.11,0)
ALL
"KRN",.402,230,"DIAB",1,3,70.12,0)
ALL
"KRN",.402,230,"DIAB",1,3,70.3135,0)
ALL
"KRN",.402,230,"DIAB",1,3,70.3225,0)
ALL
"KRN",.402,230,"DIAB",1,4,70.21,5)
7//^S X=$P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",4);T
"KRN",.402,230,"DIAB",7,2,70.03,1)
2;REQ
"KRN",.402,230,"DR",1,70)
I '$D(RANEXT)!('$D(RADTE))!('$D(RACN))!('$D(RASK))!('$D(RAMDV))!('$D(DUZ))!('$D(RANXT72))!('$D(RACN0)) W !,$C(7),"Must have RANEXT, RADTE, RACN, RASK, RAMDV, RANXT72, RACN0 and DUZ defined to use this template" S Y="@99";
"KRN",.402,230,"DR",1,70,1)
2///^S X=RADTE;@99;S RAREM="let calling rtn kill RA- vars, due early out from exm status not changed";
"KRN",.402,230,"DR",2,70.02)
50///^S X=RACN;
"KRN",.402,230,"DR",3,70.03)
S RANXT72(.6)=$G(^RA(72,RANXT72,.6));S RAOPRC=$P($G(^RADPT(DA(2),"DT",DA(1),"P",DA,0)),U,2);S:'$D(RAPRI) RAPRI=RAOPRC;S:$P(RASK,"^",2)'["Y" Y="@03";I $G(RAPRTSET) D WHY1^RASTED S Y="@03";12;I X="" S Y=15;70;@15;15;
"KRN",.402,230,"DR",3,70.03,1)
I X="",$P(RAMDV,"^",28) W !,"     Primary Interpreting Staff required for this division",$C(7),! S Y="@15";I X="" S Y="@03";60;@03;S:$P(RASK,"^",3)'["Y" Y="@049";@05;2R~;S RAPRI=+X;S RAREM="did user change the procedure ?";
"KRN",.402,230,"DR",3,70.03,2)
I RAPRI=RAOPRC S Y="@049";S RAREM="if procedures change, make sure CM associations are preserved...";D CHGPRC^RAUTL21(RAOPRC,RAPRI,.DA);D WARNPRC^RAUTL;I RAWHICH=0 S Y="@049";I RAWHICH=2 S Y="@047";
"KRN",.402,230,"DR",3,70.03,3)
W !,"... Deleting radiopharms ...",!;500///@;@047;I RAWHICH=1 S Y="@049";W !,"... Deleting medications ...",!;K ^RADPT(DA(2),"DT",DA(1),"P",DA,"RX");@049;I '$P(RAMDV,U,7)!($P(^RAMIS(71,RAPRI,0),U,6)'="B") S Y="@051";
"KRN",.402,230,"DR",3,70.03,4)
W !?3,$C(7),"A 'detailed' procedure or a 'series' of procedures is required!";2///@;S Y="@05";@051;S:'$$FUTC^RACPTCSV Y="@05";S RAREM="determine if CM is used for this procedure";S RAZCM=$O(^RAMIS(71,RAPRI,"CM","B",""));
"KRN",.402,230,"DR",3,70.03,5)
10//^S X=$S(RAZCM'="":"YES",1:"NO");S RAZCM(0)=X;S:$E(RAZCM(0))="N" Y=$$PRGCM^RAMAINU(.DA);D:$E(RAZCM(0))="Y"&('+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))) STUFCM70^RAMAINU(.DA,RAPRI);S X=X;225;
"KRN",.402,230,"DR",3,70.03,6)
D:+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))=0 UPXCM^RAMAINU(.DA,"N");@225;S:$P(RASK,"^",13)'["Y" Y="@063";125;@063;S:$P(RASK,"^",14)'["Y" Y="@067";@065;D:$T(DISCMOD^RACPTMSC)]"" DISCMOD^RACPTMSC;135;
"KRN",.402,230,"DR",3,70.03,7)
S:'$$FUTCMOD^RACPTCSV Y="@065";@067;S:$P(RASK,"^",4)'["Y" Y="@09";50;@09;S:$P(RASK,"^",5)'["Y" Y="@12";I $G(RAPRTSET) D WHY2^RASTED S Y="@12";13;I X="" S Y="@12";13.1;@12;S:$P(RASK,"^",6)'["Y" Y="@25";18;@25;Q;
"KRN",.402,230,"DR",3,70.03,8)
S:$P(RASK,"^")'["Y" Y="@11";175;S RATCXX=$$TCPROMPT^RAO7XX;@11;S:'($P(RASK,"^",7)["Y"&($P(^RAMIS(71,RAPRI,0),"^",5)="y")) Y="@14";200;@14;S:$P($G(^RA(79.2,+$P(RADT0,"^",2),0)),"^",5)'="Y" Y="@75";
"KRN",.402,230,"DR",3,70.03,9)
S:$$NORADIO^RASTREQN(RAPRI,.RANXT72) Y="@75";S RAIEN702=$$EN1^RANMPT1(RADFN,RADTE,RACN);S:RAIEN702=-1 Y="@75";500////^S X=RAIEN702;
"KRN",.402,230,"DR",3,70.03,10)
^70.2^RADPTN(^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^RADPT(D0,"DT",D1,"P",D2,0)):^(0),1:"") S X=$P(Y(1),U,28),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@75;S:$O(^RADPTN(+$G(RAIEN702),"NUC",0)) Y="@80";K RAIEN702;500///@;
"KRN",.402,230,"DR",3,70.03,11)
@80;3///^S X=$P(RANEXT,"^");S RA70033=X;
"KRN",.402,230,"DR",4,70.04)
.01:2;
"KRN",.402,230,"DR",4,70.09)
.01
"KRN",.402,230,"DR",4,70.1)
.01
"KRN",.402,230,"DR",4,70.11)
.01
"KRN",.402,230,"DR",4,70.12)
.01
"KRN",.402,230,"DR",4,70.14)
.01;
"KRN",.402,230,"DR",4,70.15)
.01;2;S:$P(RASK,"^",8)'["Y" Y="@13";Q;3//^S X="NOW";4//^S X=$P($G(^VA(200,DUZ,0)),"^");@13;
"KRN",.402,230,"DR",4,70.2)
D DISDEF^RASTREQN(RAIEN702);100;
"KRN",.402,230,"DR",4,70.3135)
.01
"KRN",.402,230,"DR",4,70.3225)
.01
"KRN",.402,230,"DR",5,70.21)
.01;S RAPSDRUG=+X;S RADIOPH=$O(^RAMIS(71,RAPRI,"NUC","B",+$G(RAPSDRUG),0)),(RAHI,RALOW)="";S RADIOPH=$G(^RAMIS(71,RAPRI,"NUC",+$G(RADIOPH),0)),RAHI=$P(RADIOPH,"^",5),RALOW=$P(RADIOPH,"^",6);S:"Y"'[$P(RANXT72(.6),"^",3) Y="@1005";
"KRN",.402,230,"DR",5,70.21,1)
@1000;W:RAHI]""!(RALOW]"")!($P(RADIOPH,"^",2)]"") !!;W:RAHI]"" "High Dose: ",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose: ",RALOW_" mCi" W:$P(RADIOPH,"^",2)]"" ?53,"Usual Dose: ",$P(RADIOPH,"^",2)_" mCi";
"KRN",.402,230,"DR",5,70.21,2)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,"^",2)]"") !;4;S Y=$$VALDOS^RASTREQN(RALOW,RAHI,X,"@1000","@1005","@99",0);@1005;S:"Y"'[$P(RANXT72(.6),"^",4) Y="@1010";5//^S X="NOW";6//^S X=$P($G(^VA(200,DUZ,0)),"^");@1010;
"KRN",.402,230,"DR",5,70.21,3)
S:"Y"'[$P(RANXT72(.6),"^") Y="@1020";@1015;W:RAHI]""!(RALOW]"")!($P(RADIOPH,"^",2)]"") !!;
"KRN",.402,230,"DR",5,70.21,4)
W:RAHI]"" "High Dose: ",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose: ",RALOW_" mCi" W:$P(RADIOPH,"^",2)]"" ?53,"Usual Dose: ",$P(RADIOPH,"^",2)_" mCi";W:RAHI]""!(RALOW]"")!($P(RADIOPH,"^",2)]"") !;
"KRN",.402,230,"DR",5,70.21,5)
7T~//^S X=$P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",4);S RADOSE=X;S Y=$$VALDOS^RASTREQN(RALOW,RAHI,RADOSE,"@1015","@1020","@99",1);@1020;S:'$D(RADOSE) RADOSE=$P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",7);
"KRN",.402,230,"DR",5,70.21,6)
S RANM702=$G(^RADPTN(DA(1),"NUC",DA,0));S:$P(^RAMIS(71,RAPRI,0),"^",19)'="y"!('RADOSE) Y="@1030";S:$P(RANM702,"^",2)]""&($P(RANM702,"^",3)]"") Y="@1030";3;2;@1030;S:"Y"'[$P(RANXT72(.6),"^",5) Y="@1040";
"KRN",.402,230,"DR",5,70.21,7)
8//^S X=$S($P($G(RANM702),"^",5)]"":$$FMTE^XLFDT($P(RANM702,"^",5),1),1:"NOW");9//^S X=$P($G(^VA(200,DUZ,0)),"^");@1040;S:$P(RANM702,"^",10)]""!($P($G(^RAMIS(71,RAPRI,0)),"^",19)'="y") Y="@1050";10;@1050;
"KRN",.402,230,"DR",5,70.21,8)
S:"Y"'[$P(RANXT72(.6),"^",7) Y="@1060";11//^S X=$$GET1^DIQ(71.6,+$P(RADIOPH,"^",3)_",",.01);S RAR1=+X;S:'+$O(^RAMIS(71.6,RAR1,"SITE",0)) Y="@1070";12//^S X=$$GET1^DIQ(71.7,+$P(RADIOPH,"^",4)_",",.01);@1070;
"KRN",.402,230,"DR",5,70.21,9)
S:'($P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",11)]""&($P($G(^RAMIS(71.6,RAR1,0)),"^",3)="Y")) Y="@1080";12.5;@1080;@1060;S:"Y"'[$P(RANXT72(.6),"^",8) Y="@1090";13;@1090;S:"Y"'[$P(RANXT72(.6),"^",9) Y="@1100";14;
"KRN",.402,230,"DR",5,70.21,10)
15//^S X=$$EXTERNAL^DILFD(71.08,7,"",$P(RADIOPH,"^",7));@1100;
"KRN",.402,230,"ROUOLD")
RACTTK
"KRN",.402,235,-1)
0^3
"KRN",.402,235,0)
RA EXAM EDIT^3050128.0758^^70^^^3050331
"KRN",.402,235,"%D",0)
^^1^1^2961105^^^
"KRN",.402,235,"%D",1,0)
This template is used to edit exams.
"KRN",.402,235,"DIAB",1,2,70.03,11)
500:
"KRN",.402,235,"DIAB",1,3,70.1,0)
ALL
"KRN",.402,235,"DIAB",1,3,70.12,0)
ALL
"KRN",.402,235,"DIAB",1,3,70.3135,0)
ALL
"KRN",.402,235,"DIAB",1,3,70.3225,0)
ALL
"KRN",.402,235,"DIAB",1,4,70.21,5)
7//^S X=RADRAWN;T
"KRN",.402,235,"DIAB",2,4,70.21,3)
4;T
"KRN",.402,235,"DIAB",3,2,70.03,1)
2;REQ
"KRN",.402,235,"DIAB",4,2,70.03,8)
9;REQ
"KRN",.402,235,"DIAB",6,4,70.21,6)
2;T
"KRN",.402,235,"DIAB",7,2,70.03,8)
8;REQ
"KRN",.402,235,"DIAB",9,2,70.03,7)
6;REQ
"KRN",.402,235,"DIAB",10,2,70.03,7)
7;REQ
"KRN",.402,235,"DIAB",11,2,70.03,7)
19;REQ
"KRN",.402,235,"DIAB",14,2,70.03,7)
9.5;REQ
"KRN",.402,235,"DR",1,70)
I '$D(RADTE)!('$D(RACN))!('$D(RAQUICK))!('$D(RAMDV)) W !?3,$C(7),"You must have the variables for 'Case Number','Exam Date' and",!?3,"'Rad/Nuc Med Division' defined to continue!" S Y="@999";S RAPOP=0 D USER^RAUTL S:RAPOP Y="@999";
"KRN",.402,235,"DR",1,70,1)
2///^S X=RADTE;@999;K RAY,RAR,RA0,RACAT,RAI,RAIEN702,RANUZD1;
"KRN",.402,235,"DR",2,70.02)
50///^S X=RACN;@800;
"KRN",.402,235,"DR",3,70.03)
S RAREM="RANUZD1 = case's Img typ's 'Radiopharm Used'";S:$P($G(^RA(79.2,+$P($G(^RADPT(DA(2),"DT",DA(1),0)),"^",2),0)),"^",5)="Y" RANUZD1="";S RAY=^RADPT(DA(2),"DT",DA(1),"P",DA,0) F RAI=1:1:18 S RA0(RAI)=$P(RAY,U,RAI);
"KRN",.402,235,"DR",3,70.03,1)
S RAR=$S($D(^RADPT(DA(2),"DT",DA(1),"P",DA,"R")):^("R"),1:"");@20;2R~;S RAPRI=+X;S RAREM="did user change the procedure ?";I RAPRI=RA0(2) S Y="@19";S RAREM="if procedures change, make sure CM associations are preserved...";
"KRN",.402,235,"DR",3,70.03,2)
D CHGPRC^RAUTL21(RA0(2),RAPRI,.DA);D WARNPRC^RAUTL;I RAWHICH=0 S Y="@19";I RAWHICH=2 S Y="@17";W !,"... Deleting radiopharms ...",!;500///@;@17;I RAWHICH=1 S Y="@19";W !,"... Deleting Medications ...",!;
"KRN",.402,235,"DR",3,70.03,3)
K ^RADPT(DA(2),"DT",DA(1),"P",DA,"RX");@19;I '$P(RAMDV,U,7)!($P(^RAMIS(71,+RAPRI,0),U,6)'="B") S Y="@21";W !?3,$C(7),"A 'detailed' procedure or a 'series' of procedures is required!";2///@;S Y="@20";@21;S:'$$FUTC^RACPTCSV Y="@20";
"KRN",.402,235,"DR",3,70.03,4)
S RAREM="determine if CM is used for this procedure";S RAZCM=$O(^RAMIS(71,RAPRI,"CM","B",""));10//^S X=$S(RAZCM'="":"YES",1:"NO");S RAZCM(0)=X;S:$E(RAZCM(0))="N" Y=$$PRGCM^RAMAINU(.DA);
"KRN",.402,235,"DR",3,70.03,5)
D:$E(RAZCM(0))="Y"&('+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))) STUFCM70^RAMAINU(.DA,RAPRI);S X=X;225;D:+$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))=0 UPXCM^RAMAINU(.DA,"N");@225;Q;125;@37;
"KRN",.402,235,"DR",3,70.03,6)
D:$T(DISCMOD^RACPTMSC)]"" DISCMOD^RACPTMSC;135;S:'$$FUTCMOD^RACPTCSV Y="@37";4;S RACAT=X;S:RA0(4)=RACAT Y="@4";S:RA0(8)']"" Y="@1";8///@;@1;S:RA0(9)']"" Y="@2";9///@;@2;S:RA0(6)']"" Y="@10";6///@;@10;S:RA0(7)']"" Y="@11";7///@;@11;
"KRN",.402,235,"DR",3,70.03,7)
S:$P(RAY,"^",19)']"" Y="@3";19///@;@3;S:RAR']"" Y="@4";9.5///@;@4;S Y=$S(RACAT="I":"@5",RACAT="E":"@12",RACAT="R":"@6","CS"[RACAT:"@7",1:"@8");@5;6R~;7R~;19R~;S Y="@100";@6;9.5R~;@12;
"KRN",.402,235,"DR",3,70.03,8)
I '$D(VADMVT) S DFN=DA(2),VAINDT=9999999.9999-DA(1) D ADM^VADPT2;S Y=$S(VADMVT:"@5",1:"@8");@7;9R~;S Y="@100";@8;8R~;@100;14;175;S RATCXX=$$TCPROMPT^RAO7XX;16//^S X=$S($D(^RA(78.1,"B","NO COMPLICATION")):"NO COMPLICATION",1:"");
"KRN",.402,235,"DR",3,70.03,9)
S:'$D(^RA(78.1,+X,0)) Y="@130";S:$P(^RA(78.1,+X,0),U)="NO COMPLICATION" Y="@130";16.5;@130;S:'$P(RAMDV,U,9) Y="@140";18;@140;50;Q;@99;Q;S:'$D(RANUZD1) Y="@700";
"KRN",.402,235,"DR",3,70.03,10)
S RAREM="skip radio section if case' Img Typ's 'RADIO...USED' is NEVER";S:$P(^RAMIS(71,+RAPRI,0),U,2)=1 Y="@700";S RAIEN702=$$EN1^RANMPT1(RADFN,RADTE,RACN);S:RAIEN702=-1 Y="@700";500////^S X=RAIEN702;
"KRN",.402,235,"DR",3,70.03,11)
^70.2^RADPTN(^^S I(2,0)=D2 S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^RADPT(D0,"DT",D1,"P",D2,0)):^(0),1:"") S X=$P(Y(1),U,28),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@700;S RA00=$O(^RADPTN("AA",RADFN,RADTE,RACN,0));S:'RA00 Y="@710";
"KRN",.402,235,"DR",3,70.03,12)
S:$O(^RADPTN(RA00,"NUC",0)) Y="@710";K RAIEN702;500///@;@710;S RACT=$S(RAQUICK:"C",1:"P");100///^S X="""NOW""";S RAREM="here, DIE is ^RADPT(-,'DT',-,'P',";S RA00=$O(@(DIE_DA_",""RX"","_"0)"));
"KRN",.402,235,"DR",3,70.03,13)
S RA00=$G(@(DIE_DA_",""RX"","_+RA00_",0)"));S:RA00]"" Y="@720";S RASKMEDS=$P(^RAMIS(71,+RAPRI,0),U,5) S:RASKMEDS=""!("Yy"'[RASKMEDS) Y="@790";@720;200;@790;
"KRN",.402,235,"DR",4,70.04)
.01;2;
"KRN",.402,235,"DR",4,70.07)
2///^S X=RACT;3////^S X=RADUZ;4///^S X=RATCXX;S:RATCXX'="" Y="@18";4///@;K ^RADPT(RADFN,"DT",RADTI,"P",RACNI,"L",DA,"TCOM");@18;K RATCXX;
"KRN",.402,235,"DR",4,70.1)
.01
"KRN",.402,235,"DR",4,70.12)
.01
"KRN",.402,235,"DR",4,70.15)
.01;2;S:$P(RA00,U,3)="" Y="@740";3//^S X="NOW";@740;S:$P(RA00,U,4)="" Y="@750";4//^S X=$P($G(^VA(200,DUZ,0)),"^");@750;
"KRN",.402,235,"DR",4,70.2)
D DISDEF^RASTREQN(RAIEN702);100;@600;
"KRN",.402,235,"DR",4,70.3135)
.01
"KRN",.402,235,"DR",4,70.3225)
.01
"KRN",.402,235,"DR",5,70.21)
.01;Q;S RAPSDRUG=X;S:'$G(D0) Y="@500";S RAREM="NOTE: here, DIE is ^RADPTN(D0,'NUC',";S:DIE'[",""NUC""" Y="@500";S RA00=$G(@(DIE_DA_",0)"));S:RA00="" Y="@500";@210;
"KRN",.402,235,"DR",5,70.21,1)
S RADIOPH=$O(^RAMIS(71,$G(RAPRI),"NUC","B",+$G(RAPSDRUG),0)),(RALOW,RAHI,RADRAWN,RADOSE,RASKMEDS)="";S:'RADIOPH Y="@220";S RADIOPH=$G(^RAMIS(71,$G(RAPRI),"NUC",RADIOPH,0)),RALOW=$P(RADIOPH,U,6),RAHI=$P(RADIOPH,U,5);@220;
"KRN",.402,235,"DR",5,70.21,2)
S:$P(RA00,U,4)="" Y="@230";@225;W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !! W:RAHI]"" "High Dose :",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose :",RALOW_" mCi" W:$P(RADIOPH,U,2)]"" ?53,"Usual Dose :",$P(RADIOPH,U,2)_" mCi";
"KRN",.402,235,"DR",5,70.21,3)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !;4T~;S RADRAWN=X;S Y=$$VALDOS^RASTREQN(RALOW,RAHI,RADRAWN,"@225","@230","@999",0);@230;S:$P(RA00,U,5)="" Y="@240";Q;5;@240;S:$P(RA00,U,6)="" Y="@250";6;@250;
"KRN",.402,235,"DR",5,70.21,4)
W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !! W:RAHI]"" "High Dose: ",RAHI_" mCi" W:RALOW]"" ?27,"Low Dose: ",RALOW_" mCi" W:$P(RADIOPH,U,2)]"" ?53,"Usual Dose: ",$P(RADIOPH,U,2)," mCi";W:RAHI]""!(RALOW]"")!($P(RADIOPH,U,2)]"") !;
"KRN",.402,235,"DR",5,70.21,5)
7T~//^S X=RADRAWN;S RADOSE=X;S:RALOW]""&(X<RALOW)&(X'="") Y="@255";S:RAHI]""&(X>RAHI) Y="@255";S Y="@258";@255;D WARN^RANMED1;R !!,"OK to continue (Y/N) ?: N//",RAASK;W !;S RAASK=$E(RAASK);S:"Yy"'[RAASK!(RAASK="") Y="@250";
"KRN",.402,235,"DR",5,70.21,6)
S RAREM="is fil 71's PROMPT FOR RADIOPHARM RX yes ?";@258;S RAASK=$P($G(^RAMIS(71,+RAPRI,0)),U,19) S:RAASK=""!("Yy"'[RAASK) Y="@270";@260;3;2T~;@270;Q;8//^S X=$S($P($G(^RADPTN(DA(1),"NUC",DA,0)),"^",5)]"":$P(^(0),"^",5),1:"NOW");
"KRN",.402,235,"DR",5,70.21,7)
9//^S X=$P(^VA(200,+$G(DUZ),0),U);@290;S:$P(RA00,U,6)="" Y="@310";6;@310;S RAREM="Note: 'RAASK' may not be defined, hit global for 'Prompt For Radiopharm RX'";S:$P($G(^RAMIS(71,RAPRI,0)),"^",19)'="y" Y="@320";10;@320;
"KRN",.402,235,"DR",5,70.21,8)
S:$P(RA00,U,11)="" Y="@330";11;@330;S:$P(RA00,U,12)="" Y="@335";12;@335;S:'$D(@(DIE_DA_",""SITX"")")) Y="@340";12.5;@340;S:$P(RA00,U,13)="" Y="@350";13;@350;S:$P(RA00,U,14)="" Y="@360";14;@360;S:$P(RA00,U,15)="" Y="@500";15;@500;
"KRN",.402,235,"ROUOLD")
RACTEX
"KRN",19,1687,-1)
0^4
"KRN",19,1687,0)
RA VIEWCN^View Exam by Case No.^^R^^^^^^^^^^1^1
"KRN",19,1687,1,0)
^^3^3^2940606^^^^
"KRN",19,1687,1,1,0)
This function allows the user to examine a case by viewing all 
"KRN",19,1687,1,2,0)
the vital information about the case.  This function also displays
"KRN",19,1687,1,3,0)
an activity log, status tracking log, and exam report text.
"KRN",19,1687,15)
K RANOSCRN
"KRN",19,1687,20)
S RANOSCRN=""
"KRN",19,1687,25)
VIEW^RAEDCN1
"KRN",19,1687,99)
56384,29759
"KRN",19,1687,99.1)
58531,48797
"KRN",19,1687,"U")
VIEW EXAM BY CASE NO.
"KRN",19,1692,-1)
0^5
"KRN",19,1692,0)
RA DELETEXAM^Exam Deletion^^R^^RA MGR^^^^^^^^1^1
"KRN",19,1692,1,0)
^^16^16^2990624^^
"KRN",19,1692,1,1,0)
This function allows the coordinator to delete exams from
"KRN",19,1692,1,2,0)
the system. This function should only be used by the
"KRN",19,1692,1,3,0)
coordinator.
"KRN",19,1692,1,4,0)
 
"KRN",19,1692,1,5,0)
When this function is executed, a bulletin is sent to members of the
"KRN",19,1692,1,6,0)
appropriate mail group to notify them of the exam deletion.
"KRN",19,1692,1,7,0)
 
"KRN",19,1692,1,8,0)
Deletion of an exam is prohibited if the exam has an associated
"KRN",19,1692,1,9,0)
report.  The report must be deleted first before the exam can be
"KRN",19,1692,1,10,0)
deleted.
"KRN",19,1692,1,11,0)
 
"KRN",19,1692,1,12,0)
Once the examination is 'DELETED', the user will be prompted to
"KRN",19,1692,1,13,0)
answer with a 'YES'or 'NO' to cancel the request associated with
"KRN",19,1692,1,14,0)
this exam. If 'YES', the request will also be cancelled and the request
"KRN",19,1692,1,15,0)
status updated to 'CANCELLED'. If 'NO', the request status will be
"KRN",19,1692,1,16,0)
updated to 'HOLD' and may be selected for registration at a future date.
"KRN",19,1692,15)
K RANOSCRN,RAOPT("DELETEXAM")
"KRN",19,1692,20)
S RANOSCRN="",RAOPT("DELETEXAM")=""
"KRN",19,1692,25)
DEL^RAEDCN1
"KRN",19,1692,99)
56384,33979
"KRN",19,1692,"U")
EXAM DELETION
"KRN",19,1745,-1)
2^3
"KRN",19,1745,0)
RA PROCLISTS^Procedure File Listings^^M^^^^^^^^
"KRN",19,1745,10,0)
^19.01IP^13^12
"KRN",19,1745,10,12,0)
11920
"KRN",19,1745,10,12,"^")
RA PROCMEDIA
"KRN",19,1745,10,13,0)
11949^HIST
"KRN",19,1745,10,13,"^")
RA CMAUDIT HISTORY
"KRN",19,1745,"U")
PROCEDURE FILE LISTINGS
"KRN",19,11920,-1)
0^2
"KRN",19,11920,0)
RA PROCMEDIA^List of Procedures with Contrast^^R^^^^^^^y^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,11920,1,0)
^19.06^8^8^3040803^^
"KRN",19,11920,1,1,0)
This option allows the supervisor to generate a list of procedures, which 
"KRN",19,11920,1,2,0)
are associated with contrast media or medium. The option allows the user 
"KRN",19,11920,1,3,0)
to select procedures by imaging type and whether the procedures are active
"KRN",19,11920,1,4,0)
or inactive.
"KRN",19,11920,1,5,0)
 
"KRN",19,11920,1,6,0)
The format of the report includes: Procedure Name, CPT Code, CPT 
"KRN",19,11920,1,7,0)
Modifier(s), Procedure Type, Imaging Type, and Inactivation Date (if 
"KRN",19,11920,1,8,0)
applicable).
"KRN",19,11920,25)
CMPRT^RAMAINP1
"KRN",19,11920,"U")
LIST OF PROCEDURES WITH CONTRA
"KRN",19,11949,-1)
0^1
"KRN",19,11949,0)
RA CMAUDIT HISTORY^Display Rad/NM Procedure Contrast Media History^^R^^^^^^^y^RADIOLOGY/NUCLEAR MEDICINE
"KRN",19,11949,1,0)
^19.06^2^2^3040804^^^^
"KRN",19,11949,1,1,0)
This option allows the user to look back at the prior contrast medium/
"KRN",19,11949,1,2,0)
media data associated with a Rad/Nuc Med Procedure.
"KRN",19,11949,25)
EN^RACMHIS
"KRN",19,11949,"U")
DISPLAY RAD/NM PROCEDURE CONTR
"MBREQ")
1
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3011017^2980407^50
"PKG",18,22,1,"PAH",1,0)
45^3050405
"PKG",18,22,1,"PAH",1,1,0)
^^2^2^3041029
"PKG",18,22,1,"PAH",1,1,1,0)
Please refer to the patch description on FORUM for additional information 
"PKG",18,22,1,"PAH",1,1,2,0)
regarding patch RA*5.0*45.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
35
"RTN","RA45PST")
0^29^B8354086
"RTN","RA45PST",1,0)
RA45PST ;Hines OI/GJC - Post-init Driver, patch 45 ;10/10/03  06:32
"RTN","RA45PST",2,0)
VERSION ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RA45PST",3,0)
 ;
"RTN","RA45PST",4,0)
EN ;Need to convert the data in the old 'BARIUM USED?' (#5) field in
"RTN","RA45PST",5,0)
 ;the 70.03 data dictionary to the CONTRAST MEDIA (#225) multiple
"RTN","RA45PST",6,0)
 ;70.3225. If 'Yes' to 'BARIUM USED?' then 'Barium' will be added
"RTN","RA45PST",7,0)
 ;as a record to the new CONTRAST MEDIA field. The 'BARIUM USED?'
"RTN","RA45PST",8,0)
 ;field will be deleted. This will be a background process queued
"RTN","RA45PST",9,0)
 ;to run by the RA*5*45 post-init.
"RTN","RA45PST",10,0)
 I '$D(^DD(70.03,5,0))#2 D
"RTN","RA45PST",11,0)
 .S RATXT(1)="'BARIUM USED?' (sub-dd: 70.03, fld: 5) field has been deleted in the"
"RTN","RA45PST",12,0)
 .S RATXT(2)="past; no further action taken regarding this data dictionary."
"RTN","RA45PST",13,0)
 .D MES^XPDUTL(.RATXT) K RATXT
"RTN","RA45PST",14,0)
 .Q
"RTN","RA45PST",15,0)
 E  D
"RTN","RA45PST",16,0)
 .N RATXT,ZTDESC,ZTDTH,ZTIO,ZTRTN
"RTN","RA45PST",17,0)
 .S ZTIO="",ZTRTN="ENQ1^RA45PST1"
"RTN","RA45PST",18,0)
 .S ZTDESC="RA*5.0*45: 'BARIUM USED?' (dd: 70.03;fld: 5) field cleanup"
"RTN","RA45PST",19,0)
 .S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT(),0,0,2,0) ;add 2 minutes to 'now'
"RTN","RA45PST",20,0)
 .D ^%ZTLOAD S RATXT(1)=" "
"RTN","RA45PST",21,0)
 .S RATXT(2)="RA*5.0*45: delete 'BARIUM USED?' field, convert data to CONTRAST MEDIA (70.3225) multiple"
"RTN","RA45PST",22,0)
 .S:$G(ZTSK)>0 RATXT(3)="Task: "_ZTSK_"."
"RTN","RA45PST",23,0)
 .S RATXT(4)=" " D MES^XPDUTL(.RATXT)
"RTN","RA45PST",24,0)
 .Q
"RTN","RA45PST",25,0)
 ;
"RTN","RA45PST",26,0)
SEED71 ;The second process must be tasked off that will identify all the
"RTN","RA45PST",27,0)
 ;Rad/Nuc Med orderable items (OI) in file 101.43 checking them to
"RTN","RA45PST",28,0)
 ;see if barium, oral cholecystogram or unspecified contrast media
"RTN","RA45PST",29,0)
 ;happen to be associated contrasts.
"RTN","RA45PST",30,0)
 ;
"RTN","RA45PST",31,0)
 ;If no associations move onto the next OI and check for CMs
"RTN","RA45PST",32,0)
 ;
"RTN","RA45PST",33,0)
 ;If yes, update the procedure in file 71; add barium, oral
"RTN","RA45PST",34,0)
 ;cholecystografic or unspecified contrast media to the CONTRAST MEDIA
"RTN","RA45PST",35,0)
 ;(#125) multiple in file 71. All successful and unsuccessful updates
"RTN","RA45PST",36,0)
 ;will be presented to the user in the form of an email message.
"RTN","RA45PST",37,0)
 ;(Failure to update occurs when a record cannot be locked)
"RTN","RA45PST",38,0)
 ;
"RTN","RA45PST",39,0)
 ;Finally, the Rad/Nuc Med Procedure (71) file will be synchronized with
"RTN","RA45PST",40,0)
 ;the Orderable Items (101.43) file.
"RTN","RA45PST",41,0)
 ;
"RTN","RA45PST",42,0)
 N RATXT,ZTDESC,ZTDTH,ZTIO,ZTRTN
"RTN","RA45PST",43,0)
 S ZTIO="",ZTRTN="ENQ2^RA45PST2"
"RTN","RA45PST",44,0)
 S ZTDESC="RA*5.0*45: seed new CONTRAST MEDIA (#125) field in file 71"
"RTN","RA45PST",45,0)
 S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT(),0,0,2,0) ;add 2 minutes to 'now'
"RTN","RA45PST",46,0)
 D ^%ZTLOAD S RATXT(1)=" "
"RTN","RA45PST",47,0)
 S RATXT(2)="RA*5.0*45: seed new CONTRAST MEDIA (#125) field in file 71"
"RTN","RA45PST",48,0)
 S:$G(ZTSK)>0 RATXT(3)="Task: "_ZTSK_"."
"RTN","RA45PST",49,0)
 S RATXT(4)=" " D MES^XPDUTL(.RATXT)
"RTN","RA45PST",50,0)
 Q
"RTN","RA45PST",51,0)
 ;
"RTN","RA45PST",52,0)
MAILQ2(FORMAT,SUBJECT) ;Update users via email; let the user(s) know which
"RTN","RA45PST",53,0)
 ;Rad/NM Procedures have been updated according to their Orderable Item
"RTN","RA45PST",54,0)
 ;equivalents.
"RTN","RA45PST",55,0)
 ;input: FORMAT='1' for Orderable Item CM definitions applied to Rad/Nuc
"RTN","RA45PST",56,0)
 ;             Med procedure, '2' for sychronization between Rad/Nuc Med
"RTN","RA45PST",57,0)
 ;             Procedure and the Orderable Items file (Rad/Nuc Med
"RTN","RA45PST",58,0)
 ;             function)
"RTN","RA45PST",59,0)
 ;      SUBJECT=subject of the email
"RTN","RA45PST",60,0)
 ;
"RTN","RA45PST",61,0)
 Q:FORMAT'=1&(FORMAT'=2)  Q:$G(SUBJECT)=""  NEW RAX
"RTN","RA45PST",62,0)
 S:FORMAT=1 $P(RAX," ",81)="",$E(RAX,1,6)="Status",$E(RAX,10,18)="Procedure",$E(RAX,52,55)="CPT",$E(RAX,60,67)="Contrast"
"RTN","RA45PST",63,0)
 S:FORMAT=2 $P(RAX," ",81)="",$E(RAX,1,6)="Status",$E(RAX,10,18)="Procedure",$E(RAX,55,58)="CPT",$E(RAX,65,72)="Contrast"
"RTN","RA45PST",64,0)
 S ^TMP("RA PROC UPDATE 45",$J,.3)=RAX
"RTN","RA45PST",65,0)
 S $P(^TMP("RA PROC UPDATE 45",$J,.6),"-",81)="" ;80 dashes
"RTN","RA45PST",66,0)
 N XMDUZ,XMSUB,XMTEXT,XMY S XMDUZ=.5
"RTN","RA45PST",67,0)
 S XMTEXT="^TMP(""RA PROC UPDATE 45"",$J,",XMSUB=SUBJECT
"RTN","RA45PST",68,0)
 I '$$GOTLOCAL^XMXAPIG("G.RAD PERFORMANCE INDICATOR") D
"RTN","RA45PST",69,0)
 .S XMY(DUZ)=""
"RTN","RA45PST",70,0)
 E  S XMY("G.RAD PERFORMANCE INDICATOR")=""
"RTN","RA45PST",71,0)
 D ^XMD
"RTN","RA45PST",72,0)
 Q
"RTN","RA45PST",73,0)
 ;
"RTN","RA45PST1")
0^30^B16417290
"RTN","RA45PST1",1,0)
RA45PST1 ;Hines OI/GJC - Post-init 'A', patch 45 ;10/10/03  06:32
"RTN","RA45PST1",2,0)
VERSION ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RA45PST1",3,0)
 ;
"RTN","RA45PST1",4,0)
ENQ1 ;Need to convert the data in the old 'BARIUM USED?' (#5) field in
"RTN","RA45PST1",5,0)
 ;the 70.03 data dictionary to the CONTRAST MEDIA (#225) multiple
"RTN","RA45PST1",6,0)
 ;70.3225. If 'Yes' to 'BARIUM USED?' then 'Barium' will be added
"RTN","RA45PST1",7,0)
 ;as a record to the new CONTRAST MEDIA field. The 'BARIUM USED?'
"RTN","RA45PST1",8,0)
 ;field will be deleted. This will be a background process queued
"RTN","RA45PST1",9,0)
 ;to run by the RA*5*45 post-init.
"RTN","RA45PST1",10,0)
 ;
"RTN","RA45PST1",11,0)
 ;IAs used in this subroutine: 4381 ("RA" node file 101.43), 4382
"RTN","RA45PST1",12,0)
 ;("S.XRAY" xref), & 1995 ($$cpt^icptcod)
"RTN","RA45PST1",13,0)
 ;IA 10035 used to obtain patient name
"RTN","RA45PST1",14,0)
 ;
"RTN","RA45PST1",15,0)
 ;called from EN^RA45PST, queued...
"RTN","RA45PST1",16,0)
 K ^TMP("RA*5*45 BARIUM USED",$J)
"RTN","RA45PST1",17,0)
 S:$D(ZTQUEUED) ZTREQ="@" S (RACT,RADFN,ZTSTOP)=0
"RTN","RA45PST1",18,0)
 F  S RADFN=$O(^RADPT(RADFN)) Q:'RADFN  D  Q:ZTSTOP
"RTN","RA45PST1",19,0)
 .S RADTI=0
"RTN","RA45PST1",20,0)
 .F  S RADTI=$O(^RADPT(RADFN,"DT",RADTI)) Q:'RADTI  D  Q:ZTSTOP
"RTN","RA45PST1",21,0)
 ..S RACNI=0
"RTN","RA45PST1",22,0)
 ..F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:'RACNI  D  Q:ZTSTOP
"RTN","RA45PST1",23,0)
 ...S Y=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),RACT=RACT+1
"RTN","RA45PST1",24,0)
 ...S:RACT#500=0 ZTSTOP=$$S^%ZTLOAD() Q:ZTSTOP
"RTN","RA45PST1",25,0)
 ...;------------------------------------------------------------------
"RTN","RA45PST1",26,0)
 ...;Indicate that barium was used by updating the new CONTRAST MEDIA
"RTN","RA45PST1",27,0)
 ...;field (multiple, sub-file 70.3225)
"RTN","RA45PST1",28,0)
 ...I $E($$UP^XLFSTR($P(Y,"^",5)))="Y" D
"RTN","RA45PST1",29,0)
 ....;------- update fields: CONTRAST MEDIA USED & BARIUM USED? -------
"RTN","RA45PST1",30,0)
 ....L +^RADPT(RADFN,"DT",RADTI,"P",RACNI,0):30 ;lock xam record
"RTN","RA45PST1",31,0)
 ....I '$T D TRACK Q  ;track the record that could not be updated
"RTN","RA45PST1",32,0)
 ....S RAD3=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",$C(32)),-1)+1
"RTN","RA45PST1",33,0)
 ....S RAIEN="+"_RAD3_","_RACNI_","_RADTI_","_RADFN_","
"RTN","RA45PST1",34,0)
 ....S RAFDA(70.3225,RAIEN,.01)="B" D UPDATE^DIE("","RAFDA","RAIEN")
"RTN","RA45PST1",35,0)
 ....K RAD3,RAFDA,RAIEN
"RTN","RA45PST1",36,0)
 ....S RAIEN=RACNI_","_RADTI_","_RADFN_","
"RTN","RA45PST1",37,0)
 ....S RAFDA(70.03,RAIEN,5)="@" ;delete data in BARIUM USED?
"RTN","RA45PST1",38,0)
 ....S RAFDA(70.03,RAIEN,10)="Y" ;set CONTRAST MEDIA USED field to YES
"RTN","RA45PST1",39,0)
 ....D FILE^DIE("","RAFDA") K RAFDA,RAIEN
"RTN","RA45PST1",40,0)
 ....L -^RADPT(RADFN,"DT",RADTI,"P",RACNI,0) ;unlock; on to next record
"RTN","RA45PST1",41,0)
 ....Q
"RTN","RA45PST1",42,0)
 ...;------------------------------------------------------------------
"RTN","RA45PST1",43,0)
 ...Q
"RTN","RA45PST1",44,0)
 ..Q
"RTN","RA45PST1",45,0)
 .Q
"RTN","RA45PST1",46,0)
 ;
"RTN","RA45PST1",47,0)
 ;delete the 'BARIUM USED?' data dictionary 70.03, field #5 only if
"RTN","RA45PST1",48,0)
 ;the user did not stop the task
"RTN","RA45PST1",49,0)
 I ZTSTOP=0 K DA,DIK S DIK="^DD(70.03,",DA(1)=70.03,DA=5 D ^DIK
"RTN","RA45PST1",50,0)
 ;
"RTN","RA45PST1",51,0)
 ;if the user stopped the task, note that event
"RTN","RA45PST1",52,0)
 D:ZTSTOP=1 STOP
"RTN","RA45PST1",53,0)
 ;
"RTN","RA45PST1",54,0)
 ;if examination records failed to get updated, if the user terminated
"RTN","RA45PST1",55,0)
 ;the post-init through TaskMan, or if both conditions are true inform
"RTN","RA45PST1",56,0)
 ;the user via email
"RTN","RA45PST1",57,0)
 D:+$O(^TMP("RA*5*45 BARIUM USED",$J,0)) MAIL
"RTN","RA45PST1",58,0)
 ;
"RTN","RA45PST1",59,0)
KILLQ1 ;Kill and clean up symbol table
"RTN","RA45PST1",60,0)
 K %,DA,DIC,DIK,RACNI,RADFN,RADTI,RAIEN,X,Y
"RTN","RA45PST1",61,0)
 K ^TMP("RA*5*45 BARIUM USED",$J)
"RTN","RA45PST1",62,0)
 Q
"RTN","RA45PST1",63,0)
 ;
"RTN","RA45PST1",64,0)
MAIL ;generate the email message informing the user of the following events:
"RTN","RA45PST1",65,0)
 ;A) some examination records were not properly updated
"RTN","RA45PST1",66,0)
 ;B) the process was stopped by the user via TaskMan
"RTN","RA45PST1",67,0)
 ;C) both events A & B are true
"RTN","RA45PST1",68,0)
 S ^TMP("RA*5*45 BARIUM USED",$J,.1)="The following patient(s) failed to have their exam records (70.03) updated"
"RTN","RA45PST1",69,0)
 S ^TMP("RA*5*45 BARIUM USED",$J,.2)="accordingly because another user was editing the same record."
"RTN","RA45PST1",70,0)
 S ^TMP("RA*5*45 BARIUM USED",$J,.3)=""
"RTN","RA45PST1",71,0)
 S ^TMP("RA*5*45 BARIUM USED",$J,.4)="Format: patient name ^ exam date/time ^ case # ^ procedure name (truncated to"
"RTN","RA45PST1",72,0)
 S ^TMP("RA*5*45 BARIUM USED",$J,.5)="forty characters)"
"RTN","RA45PST1",73,0)
 S ^TMP("RA*5*45 BARIUM USED",$J,.6)=""
"RTN","RA45PST1",74,0)
 N XMDUZ,XMSUB,XMTEXT,XMY S XMDUZ=.5
"RTN","RA45PST1",75,0)
 S XMTEXT="^TMP(""RA*5*45 BARIUM USED"",$J,"
"RTN","RA45PST1",76,0)
 S XMSUB="RA*5*45: 'Barium Used?' post-init issue detected"
"RTN","RA45PST1",77,0)
 I '$$GOTLOCAL^XMXAPIG("G.RAD PERFORMANCE INDICATOR") D
"RTN","RA45PST1",78,0)
 .S XMY(DUZ)=""
"RTN","RA45PST1",79,0)
 E  S XMY("G.RAD PERFORMANCE INDICATOR")=""
"RTN","RA45PST1",80,0)
 D ^XMD
"RTN","RA45PST1",81,0)
 Q
"RTN","RA45PST1",82,0)
 ;
"RTN","RA45PST1",83,0)
STOP ;inform the user that the task has been stopped
"RTN","RA45PST1",84,0)
 S ^TMP("RA*5*45 BARIUM USED",$J,$$SUB())="RA*5*45's 'BARIUM USED?' data dictionary cleanup terminated prematurely"
"RTN","RA45PST1",85,0)
 Q
"RTN","RA45PST1",86,0)
 ;
"RTN","RA45PST1",87,0)
TRACK ;track the record that could not be locked for updating
"RTN","RA45PST1",88,0)
 ;by patient name, date/time of exam, case number, & procedure
"RTN","RA45PST1",89,0)
 ;Note: RADFN, RADTI, & RACNI are global in scope.
"RTN","RA45PST1",90,0)
 ;
"RTN","RA45PST1",91,0)
 ;format: pat. name^exam date/time^case #^procedure name (trunc'd to 40)
"RTN","RA45PST1",92,0)
 ;
"RTN","RA45PST1",93,0)
 N RAEXAM S RAEXAM=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RA45PST1",94,0)
 S ^TMP("RA*5*45 BARIUM USED",$J,$$SUB())=$$GET1^DIQ(2,RADFN,.01)_U_$$FMTE^XLFDT((9999999.9999-RADTI),"1P")_U_$P(RAEXAM,U)_U_$E($$GET1^DIQ(71,+$P(RAEXAM,U,2),.01),1,40)
"RTN","RA45PST1",95,0)
 Q
"RTN","RA45PST1",96,0)
 ;
"RTN","RA45PST1",97,0)
SUB() ;return the next available subscript (arithmetic progression)
"RTN","RA45PST1",98,0)
 Q +$O(^TMP("RA*5*45 BARIUM USED",$J,$C(32)),-1)+1
"RTN","RA45PST1",99,0)
 ;
"RTN","RA45PST2")
0^31^B27667631
"RTN","RA45PST2",1,0)
RA45PST2 ;Hines OI/GJC - Post-init 'B', patch 45 ;10/10/03  06:32
"RTN","RA45PST2",2,0)
VERSION ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RA45PST2",3,0)
 ;
"RTN","RA45PST2",4,0)
ENQ2 ;The second process must be tasked off that will identify all the
"RTN","RA45PST2",5,0)
 ;non-parent Rad/Nuc Med orderable items (OI) in file 101.43 checking
"RTN","RA45PST2",6,0)
 ;them to see if barium, oral cholecystogram or unspecified contrast
"RTN","RA45PST2",7,0)
 ;media happen to be associated contrasts.
"RTN","RA45PST2",8,0)
 ;
"RTN","RA45PST2",9,0)
 ;If no associations move onto the next OI and check for CMs
"RTN","RA45PST2",10,0)
 ;
"RTN","RA45PST2",11,0)
 ;If yes, update the procedure in file 71; add barium, oral
"RTN","RA45PST2",12,0)
 ;cholecystografic or unspecified contrast media to the CONTRAST MEDIA
"RTN","RA45PST2",13,0)
 ;(#125) multiple in file 71. All successful and unsuccessful updates
"RTN","RA45PST2",14,0)
 ;will be presented to the user in the form of an email message.
"RTN","RA45PST2",15,0)
 ;(Failure to update occurs when a record cannot be locked)
"RTN","RA45PST2",16,0)
 ;
"RTN","RA45PST2",17,0)
 ;Finally, the Rad/Nuc Med Procedure (71) file will be synchronized with
"RTN","RA45PST2",18,0)
 ;the Orderable Items (101.43) file.
"RTN","RA45PST2",19,0)
 ;
"RTN","RA45PST2",20,0)
 ;Note: since parent procedure records resident in the OI file prior
"RTN","RA45PST2",21,0)
 ;to RA*5*45 did not have CM associations synchronizing files 101.43 &
"RTN","RA45PST2",22,0)
 ;71 will occur just before processing is finished.
"RTN","RA45PST2",23,0)
 ;
"RTN","RA45PST2",24,0)
 S:$D(ZTQUEUED) ZTREQ="@" S RAX="",(RACT,ZTSTOP)=0
"RTN","RA45PST2",25,0)
 F  S RAX=$O(^ORD(101.43,"S.XRAY",RAX)) Q:RAX=""  D  Q:ZTSTOP
"RTN","RA45PST2",26,0)
 .S RAY=0 F  S RAY=$O(^ORD(101.43,"S.XRAY",RAX,RAY)) Q:'RAY  D
"RTN","RA45PST2",27,0)
 ..S RAOIRA=$G(^ORD(101.43,RAY,"RA")),RAOICM=$P(RAOIRA,U) Q:RAOICM=""
"RTN","RA45PST2",28,0)
 ..S RAOIPT=$P(RAOIRA,U,2) Q:("^B^P^")[("^"_RAOIPT_"^")
"RTN","RA45PST2",29,0)
 ..;parents have no descendents in 101.43 & broads have no CPTs quit
"RTN","RA45PST2",30,0)
 ..S RAOI=$G(^ORD(101.43,RAY,0)),RAOI(2)=$P(RAOI,U,2)
"RTN","RA45PST2",31,0)
 ..Q:$P(RAOI(2),";",2)'="99RAP"  ;just to be on the safe side...
"RTN","RA45PST2",32,0)
 ..;update file 71 with CM data, lock the record if lock fails quit
"RTN","RA45PST2",33,0)
 ..;record will not be updated in this case
"RTN","RA45PST2",34,0)
 ..L +^RAMIS(71,+RAOI(2)):30
"RTN","RA45PST2",35,0)
 ..I '$T D SETMP(+RAOI(2),$E($P(RAOI,U),1,40),"",RAOICM,"*failed*",1) Q
"RTN","RA45PST2",36,0)
 ..F RAI=1:1:$L(RAOICM) D FILECM(+RAOI(2),$E(RAOICM,RAI),RAI)
"RTN","RA45PST2",37,0)
 ..L -^RAMIS(71,+RAOI(2)) ;unlock
"RTN","RA45PST2",38,0)
 ..;identify those records in file 71 that have been updated; the
"RTN","RA45PST2",39,0)
 ..;user will be made aware of rad/nuc med procedure updates via email
"RTN","RA45PST2",40,0)
 ..S RAMIS(0)=$G(^RAMIS(71,+RAOI(2),0)),RAPNAME=$P(RAMIS(0),U)
"RTN","RA45PST2",41,0)
 ..S RACT=RACT+1 S:RACT#200=0 ZTSTOP=$$S^%ZTLOAD()
"RTN","RA45PST2",42,0)
 ..S RACPT=$P($$CPT^ICPTCOD($P(RAMIS(0),U,9)),U),RACPT=$S(RACPT=-1:"none",1:RACPT)
"RTN","RA45PST2",43,0)
 ..D SETMP(+RAOI(2),$E(RAPNAME,1,40),RACPT,RAOICM,"*done*",1)
"RTN","RA45PST2",44,0)
 ..Q
"RTN","RA45PST2",45,0)
 .Q
"RTN","RA45PST2",46,0)
 ;
"RTN","RA45PST2",47,0)
 ;if the user stopped this process via TaskMan (TM) inform the user
"RTN","RA45PST2",48,0)
 D:ZTSTOP=1 STOP
"RTN","RA45PST2",49,0)
 ;
"RTN","RA45PST2",50,0)
 ;if there has been data updated, let the user know through an email
"RTN","RA45PST2",51,0)
 ;even if the user stopped the task via TaskMan (TM)
"RTN","RA45PST2",52,0)
 I +$O(^TMP("RA PROC UPDATE 45",$J,0)) D MAILQ2^RA45PST(1,"RA*5*45: Update Rad/NM CM definitions from Ord. Item CM definitions")
"RTN","RA45PST2",53,0)
 ;
"RTN","RA45PST2",54,0)
 ;user stopped the process, do not proceed kill variables and quit
"RTN","RA45PST2",55,0)
 I ZTSTOP=1 D KILLQ2 Q
"RTN","RA45PST2",56,0)
 ;
"RTN","RA45PST2",57,0)
 ;make sure the all from file 71 get updated in file 101.43; ZTSTOP
"RTN","RA45PST2",58,0)
 ;exists and is set to zero.
"RTN","RA45PST2",59,0)
 ;RAO7MFN takes care of: skipping broad procedures, skipping inactive
"RTN","RA45PST2",60,0)
 ;procedures, & flagging parent procedure with contrasts if a non-broad
"RTN","RA45PST2",61,0)
 ;descendent has contrasts.
"RTN","RA45PST2",62,0)
 S (RACT,RAY)=0 K ^TMP("RA PROC UPDATE 45",$J)
"RTN","RA45PST2",63,0)
 F  S RAY=$O(^RAMIS(71,RAY)) Q:'RAY  D  Q:ZTSTOP
"RTN","RA45PST2",64,0)
 .S RAMIS(0)=$G(^RAMIS(71,RAY,0)),RAPNAME=$E($P(RAMIS(0),U),1,40)
"RTN","RA45PST2",65,0)
 .S RASTAT=+$G(^RAMIS(71,RAY,"I")),RASTAT=$S(RASTAT=0:1,RASTAT>DT:1,1:0)
"RTN","RA45PST2",66,0)
 .S RAPTY=$P(RAMIS(0),U,6),RAPTY=$S(RAPTY="P":"(p)",1:"")
"RTN","RA45PST2",67,0)
 .S RACPTB=$P($$CPT^ICPTCOD($P(RAMIS(0),U,9)),U),RACPTB=$S(RACPTB=-1:"none",1:RACPTB),RAPNAME=RAPNAME_RAPTY
"RTN","RA45PST2",68,0)
 .;build Rad/Nuc Med procedure file based contrast media string
"RTN","RA45PST2",69,0)
 .S (I,RACM)=""
"RTN","RA45PST2",70,0)
 .F  S I=$O(^RAMIS(71,RAY,"CM","B",I)) Q:I=""  S RACM=RACM_I
"RTN","RA45PST2",71,0)
 .;
"RTN","RA45PST2",72,0)
 .;update file 71 with CM data; attempt lock, if lock fails quit
"RTN","RA45PST2",73,0)
 .;record will not be updated if a lock attempt fails
"RTN","RA45PST2",74,0)
 .K I S RACT=RACT+1 S:RACT#50=0 ZTSTOP=$$S^%ZTLOAD()
"RTN","RA45PST2",75,0)
 .Q:ZTSTOP  L +^RAMIS(71,RAY):30
"RTN","RA45PST2",76,0)
 .I '$T D SETMP(RAY,RAPNAME,RACPTB,RACM,"*failed*",2) Q
"RTN","RA45PST2",77,0)
 .D PROC^RAO7MFN(0,71,"1^"_RASTAT,RAY_"^"_RAPNAME)
"RTN","RA45PST2",78,0)
 .;1st parameter (param) indicates a single procedure update; 2nd param
"RTN","RA45PST2",79,0)
 .;indicates the file being edited (RAD/NUC MED PROCEDURE); 3rd param
"RTN","RA45PST2",80,0)
 .;indicates the 'before & after' status of the procedure after an
"RTN","RA45PST2",81,0)
 .;edit event ('before' status always active to guarantee unconditional
"RTN","RA45PST2",82,0)
 .;OI file updates); 4th param indicates the IEN (1st piece) and name
"RTN","RA45PST2",83,0)
 .;(2nd piece) of the procedure in file 71
"RTN","RA45PST2",84,0)
 .L -^RAMIS(71,RAY) ;unlock...
"RTN","RA45PST2",85,0)
 .D SETMP(RAY,RAPNAME,RACPTB,RACM,"*done*",2)
"RTN","RA45PST2",86,0)
 .Q
"RTN","RA45PST2",87,0)
 ;
"RTN","RA45PST2",88,0)
 ;if the user stopped this process via TaskMan (TM) inform the user
"RTN","RA45PST2",89,0)
 D:ZTSTOP=1 STOP
"RTN","RA45PST2",90,0)
 ;
"RTN","RA45PST2",91,0)
 ;if there has been data updated, let the user know through an email
"RTN","RA45PST2",92,0)
 I +$O(^TMP("RA PROC UPDATE 45",$J,0)) D MAILQ2^RA45PST(2,"RA*5*45: Synch up the Rad/Nuc Med Procedure & Orderable Item files")
"RTN","RA45PST2",93,0)
 ;
"RTN","RA45PST2",94,0)
KILLQ2 ;kill & quit
"RTN","RA45PST2",95,0)
 K RACM,RACT,RACPT,RACPTB,RAI,RAMIS,RAOI,RAOICM,RAOIPT,RAOIRA,RAPNAME
"RTN","RA45PST2",96,0)
 K RAPTY,RASTAT,RAX,RAY,ZTSTOP,^TMP("RA PROC UPDATE 45",$J)
"RTN","RA45PST2",97,0)
 Q
"RTN","RA45PST2",98,0)
 ;
"RTN","RA45PST2",99,0)
FILECM(RAIEN,RACM,RAI) ;Files contrast medium into the CONTRAST MEDIA (#125)
"RTN","RA45PST2",100,0)
 ;field in the RAD/NUC MED PROCEDURE (#71) file. Set the 'CONTRAST MEDIA
"RTN","RA45PST2",101,0)
 ;USED' field (20) to 'Y'es on the initial pass into FILECM (when RAI=1)
"RTN","RA45PST2",102,0)
 ;Input
"RTN","RA45PST2",103,0)
 ; RAIEN=IEN of rad/nuc med procedure in file 71
"RTN","RA45PST2",104,0)
 ;  RACM=I (Iodinated ionic); N (Iodinated non-ionic); L (Gadolinium);
"RTN","RA45PST2",105,0)
 ;       C (Oral Cholecystographic); G (Gastrografin); B (Barium);
"RTN","RA45PST2",106,0)
 ;       M (unspecified contrast media)
"RTN","RA45PST2",107,0)
 ;   RAI=position of a particular character in a data string 
"RTN","RA45PST2",108,0)
 ;
"RTN","RA45PST2",109,0)
 Q:$D(^RAMIS(71,RAIEN,"CM","B",RACM))\10  ;prevents duplicate records
"RTN","RA45PST2",110,0)
 K RAFDA S RAD1=+$O(^RAMIS(71,RAIEN,"CM",$C(32)),-1)+1
"RTN","RA45PST2",111,0)
 S:RAI=1 RAFDA(71,RAIEN_",",20)="Y"
"RTN","RA45PST2",112,0)
 S RAFDA(71.0125,"+"_RAD1_","_RAIEN_",",.01)=RACM
"RTN","RA45PST2",113,0)
 D UPDATE^DIE("","RAFDA") K RAD1,RAFDA
"RTN","RA45PST2",114,0)
 Q
"RTN","RA45PST2",115,0)
 ;
"RTN","RA45PST2",116,0)
SETMP(SUB,NME,CPT,CMU,MSG,FMT) ;set the ^TMP("RA PROC UPDATE 45",$J) global
"RTN","RA45PST2",117,0)
 ;with procedure information
"RTN","RA45PST2",118,0)
 ;input: SUB=IEN of Rad/Nuc Med Procedure (Orderable Item ID fld value)
"RTN","RA45PST2",119,0)
 ;       NME=procedure name
"RTN","RA45PST2",120,0)
 ;       CPT=procedure CPT
"RTN","RA45PST2",121,0)
 ;       CMU=contrast media (see RACM definition for FILECM subroutine)
"RTN","RA45PST2",122,0)
 ;       MSG=indicator *done* or *failed*
"RTN","RA45PST2",123,0)
 ;       FMT=format for data in email(column position 80 chars wide max) 
"RTN","RA45PST2",124,0)
 N I,RAX,RAY S $P(RAY," ",81)="",RAX=""
"RTN","RA45PST2",125,0)
 F I=1:1:$L(CMU) S RAX=RAX_$E(CMU,I)_$S($L(CMU)>I:",",1:"")
"RTN","RA45PST2",126,0)
 S $E(RAY,1,8)=$G(MSG),$E(RAY,10,50)=$G(NME)
"RTN","RA45PST2",127,0)
 S:FMT=1 $E(RAY,52,59)=$G(CPT)
"RTN","RA45PST2",128,0)
 S:FMT=2 $E(RAY,55,60)=$G(CPT)
"RTN","RA45PST2",129,0)
 S:FMT=1 $E(RAY,60,70)=$G(RAX)
"RTN","RA45PST2",130,0)
 S:FMT=2 $E(RAY,65,77)=$G(RAX)
"RTN","RA45PST2",131,0)
 S ^TMP("RA PROC UPDATE 45",$J,SUB)=RAY
"RTN","RA45PST2",132,0)
 Q
"RTN","RA45PST2",133,0)
 ;
"RTN","RA45PST2",134,0)
STOP ;inform the user that the task has been stopped
"RTN","RA45PST2",135,0)
 S ^TMP("RA PROC UPDATE 45",$J,$$SUB())="RA*5*45's Orderable Items-Rad/Nuc Med Proc. synchronization has been terminated prematurely"
"RTN","RA45PST2",136,0)
 Q
"RTN","RA45PST2",137,0)
 ;
"RTN","RA45PST2",138,0)
SUB() ;return the next available subscript (arithmetic progression)
"RTN","RA45PST2",139,0)
 Q +$O(^TMP("RA PROC UPDATE 45",$J,$C(32)),-1)+1
"RTN","RA45PST2",140,0)
 ;
"RTN","RACMHIS")
0^1^B19686346
"RTN","RACMHIS",1,0)
RACMHIS ;HISC/GJC-Radiology Contrast Media History option (driver)
"RTN","RACMHIS",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RACMHIS",3,0)
 ;Note: new routine with the release of RA*5*45
"RTN","RACMHIS",4,0)
 ;
"RTN","RACMHIS",5,0)
EN ;begin; find all procedures with a CM audit history
"RTN","RACMHIS",6,0)
 S RADIC="^RAMIS(71,",RADIC(0)="EMQZ",RADIC("A")="Select Procedure: "
"RTN","RACMHIS",7,0)
 S RADIC("S")="I $O(^RAMIS(71,+Y,""AUD"",0))",RAUTIL="RA PROC W/CM"
"RTN","RACMHIS",8,0)
 K ^TMP($J,"RA PROC W/CM") D EN1^RASELCT(.RADIC,RAUTIL,"",1)
"RTN","RACMHIS",9,0)
 I $O(^TMP($J,"RA PROC W/CM",""))="" D  D KILL Q
"RTN","RACMHIS",10,0)
 .W !?3,"No procedures have been selected, exiting this option." Q
"RTN","RACMHIS",11,0)
 ;
"RTN","RACMHIS",12,0)
STRTDT ;Prompt for Starting Date
"RTN","RACMHIS",13,0)
 W ! K DIR S DIR(0)="DA^:"_DT_":PEA"
"RTN","RACMHIS",14,0)
 S DIR("A")="Enter the start date for the search: "
"RTN","RACMHIS",15,0)
 S DIR("?",1)="This is the date from which our search will begin."
"RTN","RACMHIS",16,0)
 S DIR("?",2)="Think of it in terms of 'FROM' and 'TO'. This date is our 'FROM'."
"RTN","RACMHIS",17,0)
 S DIR("?",3)="The starting date must not exceed: "_$$FMTE^XLFDT(DT,"1P")_"."
"RTN","RACMHIS",18,0)
 S DIR("?")="Dates associated with a time will not be accepted."
"RTN","RACMHIS",19,0)
 D ^DIR K DIR
"RTN","RACMHIS",20,0)
 I $D(DIRUT) D KILL Q
"RTN","RACMHIS",21,0)
 ;int. date/time ^ ext. date/time ^ int. date/time minus one second
"RTN","RACMHIS",22,0)
 S RASTRT=Y_"^"_Y(0)_"^"_$$FMADD^XLFDT(Y,"","","",-1)
"RTN","RACMHIS",23,0)
 ;
"RTN","RACMHIS",24,0)
ENDDT ;Prompt for Ending Date
"RTN","RACMHIS",25,0)
 W ! K DIR S DIR(0)="DA^"_$P(RASTRT,U)_":"_DT_":PEA"
"RTN","RACMHIS",26,0)
 S DIR("A")="Enter the ending date for the search: "
"RTN","RACMHIS",27,0)
 S DIR("?",1)="This is the date in which our search will end."
"RTN","RACMHIS",28,0)
 S DIR("?",2)="Think of it in terms of 'FROM' and 'TO'. This date is our 'TO'."
"RTN","RACMHIS",29,0)
 S DIR("?",3)="The ending date must not exceed: "_$$FMTE^XLFDT(DT,"1P")_"."
"RTN","RACMHIS",30,0)
 S DIR("?",4)="The ending date must not precede: "_$P(RASTRT,U,2)_"."
"RTN","RACMHIS",31,0)
 S DIR("?")="Dates associated with a time will not be accepted."
"RTN","RACMHIS",32,0)
 D ^DIR K DIR
"RTN","RACMHIS",33,0)
 I $D(DIRUT) D KILL Q
"RTN","RACMHIS",34,0)
 ;int. date/time ^ ext. date/time ^ int. date/time plus 23hrs, 59 min,
"RTN","RACMHIS",35,0)
 ;& 59 seconds
"RTN","RACMHIS",36,0)
 S RASTOP=Y_"^"_Y(0)_"^"_(Y+.235959)
"RTN","RACMHIS",37,0)
 ;
"RTN","RACMHIS",38,0)
 F I="RASTRT","RASTOP","^TMP($J," S ZTSAVE(I)=""
"RTN","RACMHIS",39,0)
 K I D EN^XUTMDEVQ("START^RACMHIS","Rad/Nuc Med: Contrast Media History report",.ZTSAVE,,1)
"RTN","RACMHIS",40,0)
 I +$G(ZTSK)>0 W !!,"Task Number: "_ZTSK,!
"RTN","RACMHIS",41,0)
 ;
"RTN","RACMHIS",42,0)
KILL ;clean up symbol table
"RTN","RACMHIS",43,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT,POP,RADIC,RAQUIT,RASTOP,RASTRT,RAUTIL,X
"RTN","RACMHIS",44,0)
 K Y,ZTSAVE,ZTSK,^TMP($J,"RA PROC W/CM")
"RTN","RACMHIS",45,0)
 Q
"RTN","RACMHIS",46,0)
 ;
"RTN","RACMHIS",47,0)
START ;main body
"RTN","RACMHIS",48,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RACMHIS",49,0)
 S RAHD="Contrast Media Edit History By Procedure"
"RTN","RACMHIS",50,0)
 S $P(RALINE,"-",(IOM+1))="",RAPG=0,RADT=$$FMTE^XLFDT(DT,"1P")
"RTN","RACMHIS",51,0)
 W:$E(IOST,1,2)="C-" @IOF ;clear screen
"RTN","RACMHIS",52,0)
 D HDR S RAXIT=0,RAPNME=""
"RTN","RACMHIS",53,0)
 F  S RAPNME=$O(^TMP($J,"RA PROC W/CM",RAPNME)) Q:RAPNME=""  D  Q:RAXIT
"RTN","RACMHIS",54,0)
 .S RAXIT=$$S^%ZTLOAD() S:RAXIT ZTSTOP=1 Q:RAXIT
"RTN","RACMHIS",55,0)
 .S RAY=0
"RTN","RACMHIS",56,0)
 .F  S RAY=$O(^TMP($J,"RA PROC W/CM",RAPNME,RAY)) Q:'RAY  D  Q:RAXIT
"RTN","RACMHIS",57,0)
 ..S RAXIT=$$S^%ZTLOAD() S:RAXIT ZTSTOP=1 Q:RAXIT
"RTN","RACMHIS",58,0)
 ..S RAS=$P(RASTRT,U,3)
"RTN","RACMHIS",59,0)
 ..F  S RAS=$O(^RAMIS(71,RAY,"AUD","B",RAS)) Q:'RAS!(RAS>$P(RASTOP,U,3))  D  Q:RAXIT
"RTN","RACMHIS",60,0)
 ...S RAIEN=0
"RTN","RACMHIS",61,0)
 ...F  S RAIEN=$O(^RAMIS(71,RAY,"AUD","B",RAS,RAIEN)) Q:'RAIEN  D  Q:RAXIT
"RTN","RACMHIS",62,0)
 ....;get changed date/time, CM value, & user
"RTN","RACMHIS",63,0)
 ....S RAY(0)=$G(^RAMIS(71,RAY,"AUD",RAIEN,0))
"RTN","RACMHIS",64,0)
 ....S RAADT=$$FMTE^XLFDT($P(RAY(0),U),"1P"),RACMU=$P(RAY(0),U,2)
"RTN","RACMHIS",65,0)
 ....S RAX=$S($L(RACMU):$$CONTRAST(RACMU),1:"**User deleted all contrast media data**")
"RTN","RACMHIS",66,0)
 ....S:+$P(RAY(0),U,3) RAAU=$$GET1^DIQ(200,$P(RAY(0),U,3)_",",.01)
"RTN","RACMHIS",67,0)
 ....I $Y>(IOSL-4) D EOS Q:RAXIT
"RTN","RACMHIS",68,0)
 ....W !,$E(RAPNME,1,32),?33,RAADT,?55,$E($G(RAAU),1,24)
"RTN","RACMHIS",69,0)
 ....I $Y>(IOSL-4) D EOS Q:RAXIT
"RTN","RACMHIS",70,0)
 ....;display the past CM data value or that CM data has been deleted 
"RTN","RACMHIS",71,0)
 ....S X=RAX,DIWL=3,DIWR=70,DIWF="W" D ^DIWP,^DIWW K ^UTILITY($J,"W")
"RTN","RACMHIS",72,0)
 ....Q
"RTN","RACMHIS",73,0)
 ...Q
"RTN","RACMHIS",74,0)
 ..Q
"RTN","RACMHIS",75,0)
 .Q
"RTN","RACMHIS",76,0)
EXIT ;clean up symbol table, message to user
"RTN","RACMHIS",77,0)
 ;if there are no records to print, alert user
"RTN","RACMHIS",78,0)
 W:'$D(RAY(0))#2 !,$$CJ^XLFSTR("*** No Records To Print ***",IOM)
"RTN","RACMHIS",79,0)
 K DIW,DIWF,DIWL,DIWR,DIWT,DN,I,RAADT,RAAU,RACMU,RADT,RAHD,RAI,RAIEN
"RTN","RACMHIS",80,0)
 K RALINE,RAPG,RAPNME,RAS,RAXIT,RAX,RAY,X,Y,Z
"RTN","RACMHIS",81,0)
 Q
"RTN","RACMHIS",82,0)
 ;
"RTN","RACMHIS",83,0)
EOS ; end of screen dialog
"RTN","RACMHIS",84,0)
 I $E(IOST,1,2)="C-" D  Q:RAXIT
"RTN","RACMHIS",85,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","RACMHIS",86,0)
 .S DIR(0)="E" D ^DIR S:$D(DIRUT) RAXIT=1
"RTN","RACMHIS",87,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","RACMHIS",88,0)
 .Q
"RTN","RACMHIS",89,0)
 ;
"RTN","RACMHIS",90,0)
 ;'falls' into HDR...
"RTN","RACMHIS",91,0)
 ;
"RTN","RACMHIS",92,0)
HDR ; print header
"RTN","RACMHIS",93,0)
 W:RAPG @IOF S RAPG=RAPG+1
"RTN","RACMHIS",94,0)
 W !,$$CJ^XLFSTR(RAHD,IOM),!,"Run Date: ",RADT,?25,"From: ",$P(RASTRT,U,2),?45,"To: ",$P(RASTOP,U,2),?68,"Page ",RAPG
"RTN","RACMHIS",95,0)
 W !,"Procedure",?34,"Date/Time Changed",?55,"User",!?2,"Contrast Media"
"RTN","RACMHIS",96,0)
 W !,$$CJ^XLFSTR(RALINE,IOM)
"RTN","RACMHIS",97,0)
 Q
"RTN","RACMHIS",98,0)
 ;
"RTN","RACMHIS",99,0)
CONTRAST(RACMU) ;Return the current CM definition for this procedure delimited
"RTN","RACMHIS",100,0)
 ;by commas.
"RTN","RACMHIS",101,0)
 ;input: RACMU=internal value of CM; multiple CM references per string
"RTN","RACMHIS",102,0)
 ;             are possible
"RTN","RACMHIS",103,0)
 ;return: the external format of CM delimited by commas
"RTN","RACMHIS",104,0)
 N RAI,RAX S RAX=""
"RTN","RACMHIS",105,0)
 F RAI=1:1:$L(RACMU) D
"RTN","RACMHIS",106,0)
 .S RAX=RAX_$$EXTERNAL^DILFD(71.0125,.01,"",$E(RACMU,RAI))_", "
"RTN","RACMHIS",107,0)
 .Q
"RTN","RACMHIS",108,0)
 Q $P(RAX,", ",1,($L(RAX,", ")-1)) ;strip off that last ", "
"RTN","RACMHIS",109,0)
 ;
"RTN","RADEM1")
0^2^B19574388
"RTN","RADEM1",1,0)
RADEM1 ;HISC/GJC-Display Patient Demographics ;4/19/96  08:17
"RTN","RADEM1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RADEM1",3,0)
EXAM D HDR S RAXIT=0
"RTN","RADEM1",4,0)
 S X1=DT,X2=-7 D C^%DTC S RACHKDT=X,X1=DT,X2=-3 D C^%DTC S RACHKDT1=X
"RTN","RADEM1",5,0)
 S (RADTE,RASEQ)=0 F RADTI=0:0 Q:(RASEQ>4)&(RADTE<RACHKDT)!RAXIT  S RADTI=$O(^RADPT(RADFN,"DT",RADTI)) Q:RADTI'>0!RAXIT  I $D(^(RADTI,0)) S Y=^(0),RALOC=+$P(Y,"^",4),(RADTE,Y)=+Y Q:(RASEQ>4)&(RADTE<RACHKDT)  D D^RAUTL S RADATE=Y D RACN
"RTN","RADEM1",6,0)
 I $G(RAXIT) G Q
"RTN","RADEM1",7,0)
 D ORDER ;Check for outstanding orders
"RTN","RADEM1",8,0)
 W:'RASEQ !!?5,"No registered exams filed for this patient.",!
"RTN","RADEM1",9,0)
 W:$D(RABARFL) !?2,"  *Exam with Barium performed in last 7 days."
"RTN","RADEM1",10,0)
 W:$D(RAORFL) !?2," **Oral Cholecystographic medium used in last 7 days."
"RTN","RADEM1",11,0)
 I $D(RACNFL) D
"RTN","RADEM1",12,0)
 .N DIWF,DIWL,DIWR,DIWT,X K ^UTILITY($J,"W")
"RTN","RADEM1",13,0)
 .S:'$D(RAZDFN)#2 X="***Exam with contrast media performed in last 3 days."
"RTN","RADEM1",14,0)
 .S:$D(RAZDFN)#2 X="***Exam with "_$$CM(RAZDFN,RAZDTI,RAZCNI)_" performed in last 3 days."
"RTN","RADEM1",15,0)
 .S DIWL=3,DIWF="C60" D ^DIWP,^DIWW ;UTILITY($J,"W") killed in DIWW
"RTN","RADEM1",16,0)
 .Q
"RTN","RADEM1",17,0)
 I '$D(RACONT),('+$G(RAXIT)) R !!,"Press <RETURN> key to continue.",X:DTIME
"RTN","RADEM1",18,0)
Q K %,%H,DIC,POP,RACNFL,RAORFL,RACODE,RACONT,RABAR,RABARFL,RACHKDT,RACHKDT1,RACN,RACNI,RADATE,RADTE,RADTI,RAPR1,RAPRI,RASEQ,RAST,RASTI,RAXIT,RAZDFN,RAZDTI,RAZCNI Q
"RTN","RADEM1",19,0)
 ;
"RTN","RADEM1",20,0)
RACN S RALOC=$S($D(^RA(79.1,RALOC,0)):$P(^(0),"^"),1:"") S RALOC=$S($D(^SC(+RALOC,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RADEM1",21,0)
 F RACNI=0:0 Q:(RASEQ>4)&(RADTE<RACHKDT)!RAXIT  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:RACNI'>0!RAXIT  I $D(^(RACNI,0)) S Y=^(0) D PRT
"RTN","RADEM1",22,0)
 Q
"RTN","RADEM1",23,0)
 ;
"RTN","RADEM1",24,0)
PRT N RAESITY,RAITYPE
"RTN","RADEM1",25,0)
 S RAPRI=+$P(Y,"^",2),RAPR1=99 S:$D(^RAMIS(71,RAPRI,0)) RAPR1=$P(^(0),"^") S RABAR=0
"RTN","RADEM1",26,0)
 I $P(Y,U,10)="Y" D
"RTN","RADEM1",27,0)
 .I RADTE'<RACHKDT,($O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM","B",""))="B") S (RABAR,RABARFL)=1,RACODE="  *"
"RTN","RADEM1",28,0)
 .I RADTE'<RACHKDT,(+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM","B","C",0))>0) S (RABAR,RAORFL)=1,RACODE=" **"
"RTN","RADEM1",29,0)
 .I RADTE'<RACHKDT1 D
"RTN","RADEM1",30,0)
 ..S (RABAR,RACNFL)=1,RACODE="***"
"RTN","RADEM1",31,0)
 ..I +$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",0)) S RAZDFN=RADFN,RAZDTI=RADTI,RAZCNI=RACNI
"RTN","RADEM1",32,0)
 ..Q
"RTN","RADEM1",33,0)
 .Q
"RTN","RADEM1",34,0)
 S RASTI=+$P(Y,"^",3)
"RTN","RADEM1",35,0)
 S RAST=$S($D(^RA(72,RASTI,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RADEM1",36,0)
 S RAESITY=+$P($G(^RA(72,RASTI,0)),U,7)
"RTN","RADEM1",37,0)
 S RAITYPE=$P($G(^RA(79.2,RAESITY,0)),U)
"RTN","RADEM1",38,0)
 S RAITYPE=$S(RAITYPE]"":RAITYPE,1:"Unknown")
"RTN","RADEM1",39,0)
 S RACN=$S($D(^RA(72,"AA",RAITYPE,9,RASTI)):"",1:+Y)
"RTN","RADEM1",40,0)
 ; flag if print set and if lowest case of set
"RTN","RADEM1",41,0)
 N RAPRTSET,RAMEMLOW,RADISP D EN1^RAUTL20
"RTN","RADEM1",42,0)
 S RADISP=$S(RAMEMLOW&(RAPRTSET):"+",RAPRTSET:".",1:" ")
"RTN","RADEM1",43,0)
 S RASEQ=RASEQ+1 W:RASEQ<6!(RABAR) !,RACN,?6,RADISP,?7,$S(RABAR:RACODE,1:""),?10,$E(RAPR1,1,28),?39,$E(RADATE,1,11),?51,$E(RAST,1,12),?67,$E(RALOC,1,12)
"RTN","RADEM1",44,0)
 I $E(IOST,1,2)="C-",($Y>(IOSL-4)) D
"RTN","RADEM1",45,0)
 . N DIR S DIR(0)="E" D ^DIR S RAXIT=$S(Y'>0:1,1:0)
"RTN","RADEM1",46,0)
 . I 'RAXIT W @IOF D HDR
"RTN","RADEM1",47,0)
 . Q
"RTN","RADEM1",48,0)
 Q
"RTN","RADEM1",49,0)
ORDER ; Check for pat rad orders before registering a patient in rad
"RTN","RADEM1",50,0)
 ; Created by GJC@1/3/94
"RTN","RADEM1",51,0)
 N RALP,RA751,DIROUT,DIRUT,DTOUT,DUOUT S (RALP,RAXIT)=0
"RTN","RADEM1",52,0)
 F  S RALP=$O(^RAO(75.1,"B",RADFN,RALP)) Q:RALP'>0!(RAXIT)  D
"RTN","RADEM1",53,0)
 . Q:$D(^RADPT("AO",RALP,RADFN))\10  ;Check for entry in file 70.
"RTN","RADEM1",54,0)
 . Q:+$P($G(^RAO(75.1,RALP,0)),U,5)<3
"RTN","RADEM1",55,0)
 . S RA751(0)=$G(^RAO(75.1,RALP,0)),RA751(2)=$P(RA751(0),U,2)
"RTN","RADEM1",56,0)
 . S RA751(16)=$P(RA751(0),U,16),RA751(20)=$P(RA751(0),U,20)
"RTN","RADEM1",57,0)
 . S RA751(5)=+$P(RA751(0),U,5) Q:RA751(5)=1  ;GJC@4/4/94 Cancelled xam
"RTN","RADEM1",58,0)
 . S Y=RA751(2),C=$P($G(^DD(75.1,2,0)),U,2) D:Y]"" Y^DIQ S RA751(2)=Y
"RTN","RADEM1",59,0)
 . S Y=RA751(20),C=$P($G(^DD(75.1,20,0)),U,2) D:Y]"" Y^DIQ S RA751(20)=Y
"RTN","RADEM1",60,0)
 . W !?10,$E(RA751(2),1,28),?51,"Ord "
"RTN","RADEM1",61,0)
 . W $S(RA751(16)]"":$$FMTE^XLFDT(RA751(16),"2D"),1:"")
"RTN","RADEM1",62,0)
 . W ?67,$E(RA751(20),1,12) ; prints 'SUBMIT REQUEST TO' data
"RTN","RADEM1",63,0)
 . I $E(IOST,1,2)="C-",($Y>(IOSL-4)) D
"RTN","RADEM1",64,0)
 .. K DIR S DIR(0)="E" D ^DIR K DIR S:'+Y RAXIT=1
"RTN","RADEM1",65,0)
 .. I 'RAXIT W @IOF D HDR
"RTN","RADEM1",66,0)
 .. Q
"RTN","RADEM1",67,0)
 . Q
"RTN","RADEM1",68,0)
 Q
"RTN","RADEM1",69,0)
HDR ; Header
"RTN","RADEM1",70,0)
 ; Created by GJC@1/3/94
"RTN","RADEM1",71,0)
 ; The variable: RAOPT("ORDEREXAM") is defined in the entry action of
"RTN","RADEM1",72,0)
 ; the option RA ORDEREXAM.  It is subsequently kill in the exit action
"RTN","RADEM1",73,0)
 ; of the option.
"RTN","RADEM1",74,0)
 D HOME^%ZIS W:$D(RAOPT("ORDEREXAM"))#2 @IOF
"RTN","RADEM1",75,0)
 W !!,"Case #",?10,"Last 5 Procedures/New Orders",?39,"Exam Date",?51,"Status of Exam",?67,"Imaging Loc."
"RTN","RADEM1",76,0)
 W !,"------",?10,"----------------------------",?39,"---------",?51,"--------------",?67,"------------"
"RTN","RADEM1",77,0)
 Q
"RTN","RADEM1",78,0)
 ;
"RTN","RADEM1",79,0)
CM(RADFN,RADTI,RACNI) ;Return the contrast media used while performing an
"RTN","RADEM1",80,0)
 ;exam.
"RTN","RADEM1",81,0)
 ;Input: RADFN=patient DFN
"RTN","RADEM1",82,0)
 ;       RADTI=inverse date/time of exam
"RTN","RADEM1",83,0)
 ;       RACNI=IEN of an individual case
"RTN","RADEM1",84,0)
 ;Return: contrast media used with exam delimited by ', '.
"RTN","RADEM1",85,0)
 N I,X S X="",I=0
"RTN","RADEM1",86,0)
 F  S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",I)) Q:'I  D
"RTN","RADEM1",87,0)
 .S I(0)=$P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",I,0),U)
"RTN","RADEM1",88,0)
 .S X=X_$$EXTERNAL^DILFD(70.3225,.01,"",I(0))_", "
"RTN","RADEM1",89,0)
 .Q
"RTN","RADEM1",90,0)
 I $L(X,", ")'>2 S X=$P(X,", ")
"RTN","RADEM1",91,0)
 E  S X=$P(X,", ",1,($L(X,", ")-1))
"RTN","RADEM1",92,0)
 Q X
"RTN","RADEM1",93,0)
 ;
"RTN","RAEDCN")
0^16^B54472977
"RTN","RAEDCN",1,0)
RAEDCN ;HISC/CAH,FPT,GJC,SS AISC/MJK,RMO-Edit Exams by Case Number ;1/11/02  11:15
"RTN","RAEDCN",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,13,10,18,28,31,34,45**;Mar 16, 1998
"RTN","RAEDCN",3,0)
 ;last modified by SS JUNE 21,2000 for P18
"RTN","RAEDCN",4,0)
START D SET^RAPSET1 I $D(XQUIT) K XQUIT,RAFLG,RADR,POP,RAQUICK Q
"RTN","RAEDCN",5,0)
START1 D ^RACNLU G Q:X="^"
"RTN","RAEDCN",6,0)
 I RADR="[RA DIAGNOSTIC BY CASE]" N RAPRTSET,RAMEMARR,RA3 D EN2^RAUTL20(.RAMEMARR) S RA3=99 I RAPRTSET W ! D WHYMSG2^RASTED G Q  ;skip edit because member of set =2
"RTN","RAEDCN",7,0)
 I $D(^RA(72,"AA",RAIMGTY,9,+RAST)),'$D(^XUSEC("RA MGR",+$G(DUZ))) W !!?3,$C(7),"You do not have the appropriate access privileges to edit completed exams." G START1
"RTN","RAEDCN",8,0)
 I $D(^RA(72,"AA",RAIMGTY,0,+RAST)) W !!?3,$C(7),"Exam has been 'cancelled' therefore it cannot be edited." G START1
"RTN","RAEDCN",9,0)
 I RADR="[RA DIAGNOSTIC BY CASE]",$D(^RARPT(RARPT,0)),$P(^(0),"^",5)="V" W !!?3,$C(7),"A report has been verified for this exam, therefore it cannot be edited.",! G START
"RTN","RAEDCN",10,0)
 S DA=RADFN,DIE("NO^")="OUTOK",DIE="^RADPT(",DR=RADR
"RTN","RAEDCN",11,0)
 I $D(RAFLG("EDIT"))!($D(RAFLG("DIAG"))) D  G:+$G(RAXIT) START1
"RTN","RAEDCN",12,0)
 . S RADADA=RADTI,RADIE="^RADPT("_RADFN_",""DT"","
"RTN","RAEDCN",13,0)
 . S RAXIT=$$LOCK^RAUTL12(RADIE,RADADA)
"RTN","RAEDCN",14,0)
 . Q
"RTN","RAEDCN",15,0)
 I RADR="[RA EXAM EDIT]" D
"RTN","RAEDCN",16,0)
 . N RADISPLY
"RTN","RAEDCN",17,0)
 . S RADISPLY=$G(^RAMIS(71,+$P($G(^RADPT(+RADFN,"DT",+RADTI,"P",+RACNI,0)),U,2),0)) ; set $ZR to 71 for prccpt^radd1, not call raprod since diff col
"RTN","RAEDCN",18,0)
 . S RADISPLY=$$PRCCPT^RADD1()
"RTN","RAEDCN",19,0)
 . W !,?24,RADISPLY
"RTN","RAEDCN",20,0)
 .;
"RTN","RAEDCN",21,0)
 .;save 'before' CM data value to compare against the possible 'after'
"RTN","RAEDCN",22,0)
 .;value
"RTN","RAEDCN",23,0)
 .D TRK70CMB^RAMAINU(RADFN,RADTI,RACNI,.RATRKCMB) ;RA*5*45
"RTN","RAEDCN",24,0)
 .;
"RTN","RAEDCN",25,0)
 . Q
"RTN","RAEDCN",26,0)
 D:RADR'="[RA NO PURGE SPECIFICATION]" SVBEFOR^RAO7XX(RADFN,RADTI,RACNI) ;P18 save before edit to compare it in RAUTL1 later
"RTN","RAEDCN",27,0)
 D ^DIE K DIE("NO^"),DE,DQ,DIE,DR,RAZCM
"RTN","RAEDCN",28,0)
 D:RADR'="[RA NO PURGE SPECIFICATION]" UP1^RAUTL1
"RTN","RAEDCN",29,0)
 ;
"RTN","RAEDCN",30,0)
 ;1) check data consistency between 'CONTRAST MEDIA USED' & 'CONTRAST
"RTN","RAEDCN",31,0)
 ;MEDIA'
"RTN","RAEDCN",32,0)
 ;2) check 'before' CM data against 'after' CM data, file in audit log
"RTN","RAEDCN",33,0)
 ;if necessary. Remember, contrast media asked when in input template:
"RTN","RAEDCN",34,0)
 ;RA EXAM EDIT (RA*5*45)
"RTN","RAEDCN",35,0)
 I RADR="[RA EXAM EDIT]" D
"RTN","RAEDCN",36,0)
 .S RACMDA=RACNI,RACMDA(1)=RADTI,RACMDA(2)=RADFN
"RTN","RAEDCN",37,0)
 .D XCMINTEG^RAMAINU1(.RACMDA) ;1
"RTN","RAEDCN",38,0)
 .D TRK70CMA^RAMAINU(RADFN,RADTI,RACNI,RATRKCMB) ;2
"RTN","RAEDCN",39,0)
 .K RACMDA Q
"RTN","RAEDCN",40,0)
 ;
"RTN","RAEDCN",41,0)
 I $D(RAFLG("EDIT"))!($D(RAFLG("DIAG"))) D UNLOCK^RAUTL12(RADIE,RADADA)
"RTN","RAEDCN",42,0)
 K RATRKCMB,RADUZ,RAZZ W ! G START1:'+$G(RAXIT)
"RTN","RAEDCN",43,0)
 ;
"RTN","RAEDCN",44,0)
Q K %,%DT,%W,%X,%Y,%Y1,A,C,D0,D1,D2,DA,DIC,DIE,DIV,DK,I,ORIFN,ORVP,POP,RACN,RACNI,RACS,RACT,RADADA,RADATE,RADFN,RADIE,RADIV,RADR,RADTE,RADTI,RAEXFM,RAEXLBLS,RAFIN,RAFL,RAFLG,RAFLH,RAFLHFL,RAHEAD,RAI,RAJ
"RTN","RAEDCN",45,0)
 K RAMES,RANME,RANUM,RAOIFN,RAOR,RAORDIFN,RAOREA,RAORIFN,RAOSEL,RAOSTS,RAPOP,RAPRI,RAPRC,RAQUICK,RAPRIT,RARPT,RARPTZ,RASN,RASSN,RAST,RASTI,RAVW,X,XQUIT,VAINDT,VADMVT,Y,^TMP($J,"RAEX")
"RTN","RAEDCN",46,0)
 K %H,%I,D,D3,DDER,DI,DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,GMRAL
"RTN","RAEDCN",47,0)
 K J,SDCLST,R1,RA,RACANC,RACN0,RACPT,RACPTNDE,RADA,RAEND,RAFELIG,RAFST
"RTN","RAEDCN",48,0)
 K RAIX,RAN,RAOBR4,RAPRCNDE,RAPROC,RAPROCIT,RAPRV,RAXIT,VA,VADM,VAERR,Z
"RTN","RAEDCN",49,0)
 K DFN,DIPGM,DISYS,DQ,DR,HLN,HLRESLT,HLSAN,RAAFTER,RABEFORE,X0
"RTN","RAEDCN",50,0)
 K DLAYGO,DDH,RADFLTP
"RTN","RAEDCN",51,0)
 Q
"RTN","RAEDCN",52,0)
 ;
"RTN","RAEDCN",53,0)
DIAG N RADIAG,RAXIT
"RTN","RAEDCN",54,0)
 S RAXIT=0,RAFLG("DIAG")="",RADR="[RA DIAGNOSTIC BY CASE]" G START
"RTN","RAEDCN",55,0)
 ;
"RTN","RAEDCN",56,0)
SAVE S RADR="[RA NO PURGE SPECIFICATION]" G START
"RTN","RAEDCN",57,0)
 ;
"RTN","RAEDCN",58,0)
EDIT ; Case No. Exam Edit
"RTN","RAEDCN",59,0)
 N RAEDIT,RAXIT
"RTN","RAEDCN",60,0)
 N RAREM,RANUZD1,RAPSDRUG,RA00,RADIOPH,RALOW,RAHI,RADRAWN,RAASK,RADOSE,RASKMEDS,RAWHICH ;these are used by the edit template
"RTN","RAEDCN",61,0)
 S RAXIT=0,RAFLG("EDIT")="",RAQUICK=1,RADR="[RA EXAM EDIT]" G START
"RTN","RAEDCN",62,0)
 ;
"RTN","RAEDCN",63,0)
CANCEL D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RAEDCN",64,0)
 S RAXIT=$$CKREASON^RAEDCN1("C") I RAXIT K RAXIT Q  ;P18
"RTN","RAEDCN",65,0)
 D ^RACNLU G Q:X="^" I $D(^RA(72,"AA",RAIMGTY,0,+RAST)) W !?3,$C(7),"This exam has already been cancelled!" G Q
"RTN","RAEDCN",66,0)
 I $D(^RA(72,+RAST,0)),$P(^(0),"^",6)'="y" W !?3,$C(7),"This exam is in the '",$P(^(0),"^"),"' status and cannot be 'CANCELLED'." G Q
"RTN","RAEDCN",67,0)
ASKIMG I RARPT,($$STUB^RAEDCN1(RARPT)) D  G:"Nn"[$E(X) Q G:"Yy"[$E(X) ASKCAN W:X'["?" $C(7) W !!?3,"Enter 'YES' to cancel an exam with images, or 'NO' not to." G ASKIMG
"RTN","RAEDCN",68,0)
 . S X=RANME_"'s Case No. "_$E(RADTE,4,7)_$E(RADTE,1,2)_"-"_RACN
"RTN","RAEDCN",69,0)
 . W !!?10,"----------------------------------",$C(7)
"RTN","RAEDCN",70,0)
 . W !?10,X
"RTN","RAEDCN",71,0)
 . W !?10,"This exam has associated images.",$C(7)
"RTN","RAEDCN",72,0)
 . W !?10,"----------------------------------",$C(7)
"RTN","RAEDCN",73,0)
 . I '$D(^XUSEC("RA MGR",DUZ)) D  S X="N" Q
"RTN","RAEDCN",74,0)
 .. W !!?3,"** You do not have the  RA MGR  key to cancel an exam with images. **",$C(7)
"RTN","RAEDCN",75,0)
 .. R !!?10,"Press RETURN to continue.",X:DTIME
"RTN","RAEDCN",76,0)
 .. Q
"RTN","RAEDCN",77,0)
 . R !!,"Do you really want to cancel this exam with images? NO//",X:DTIME S:'$T!(X="")!(X["^") X="N"
"RTN","RAEDCN",78,0)
 . Q
"RTN","RAEDCN",79,0)
 I RARPT W !?3,$C(7),"A report has been filed for this case. Therefore cancellation is not allowed!" G Q
"RTN","RAEDCN",80,0)
ASKCAN R !!,"Do you wish to cancel this exam now? NO// ",X:DTIME S:'$T!(X="")!(X["^") X="N" G Q:"Nn"[$E(X) I "Yy"'[$E(X) W:X'["?" $C(7) W !!?3,"Enter 'YES' to cancel this exam, or 'NO' not to." G ASKCAN
"RTN","RAEDCN",81,0)
 N REM ;used for remarks within edit template
"RTN","RAEDCN",82,0)
 L +^RADPT(RADFN):1 I '$T W !,$C(7),"Someone else is editing the patient you selected",!,"Please try later" K RADTE,RACN,RAPOP,RADUZ G Q
"RTN","RAEDCN",83,0)
 S DA=RADFN,DR="[RA CANCEL]",DIE="^RADPT(" D ^DIE K DE,DQ,DIE,DR
"RTN","RAEDCN",84,0)
 K RADTE,RACN,RAPOP,RADUZ ;moved from edit template
"RTN","RAEDCN",85,0)
PACS I '$D(Y),$D(RAFIN) W !?10,"...cancellation complete." D DELPNT^RAUTL20(RADFN,RADTI,RACNI),^RAORDC,CANCEL^RAHLRPC
"RTN","RAEDCN",86,0)
 L -^RADPT(RADFN)
"RTN","RAEDCN",87,0)
 G Q
"RTN","RAEDCN",88,0)
 ;
"RTN","RAEDCN",89,0)
DUP ; Option: RA FLASH
"RTN","RAEDCN",90,0)
 N RAREGX,RAYN D SET^RAPSET1 I $D(XQUIT) K XQUIT,POP Q
"RTN","RAEDCN",91,0)
DUP1 D ^RACNLU G Q:X="^"
"RTN","RAEDCN",92,0)
 G Q:'$D(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAEDCN",93,0)
 S RAREGX(0)=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAEDCN",94,0)
 S RAREGX(4)=+$P(RAREGX(0),"^",4)
"RTN","RAEDCN",95,0)
 I +$G(RAMLC)'=RAREGX(4) D  I $P(RAYN,"^",2) D Q QUIT
"RTN","RAEDCN",96,0)
 . W !!?3,"Your sign-on location is: "
"RTN","RAEDCN",97,0)
 . W $P($G(^SC(+$G(^RA(79.1,+$G(RAMLC),0)),0)),"^")_".  The location"
"RTN","RAEDCN",98,0)
 . W !?3,"of case ",RACN," is "
"RTN","RAEDCN",99,0)
 . W $P($G(^SC(+$G(^RA(79.1,RAREGX(4),0)),0)),"^"),".",!
"RTN","RAEDCN",100,0)
 . K DIR,DIROUT,DIRUT,DTOUT,DUOUT S DIR(0)="Y",DIR("B")="Yes"
"RTN","RAEDCN",101,0)
 . S DIR("?")="Enter 'Y'es to switch locations or 'N'o exit the option."
"RTN","RAEDCN",102,0)
 . S DIR("A")="Do you wish to switch Imaging Locations" D ^DIR
"RTN","RAEDCN",103,0)
 . S RAYN=+Y_"^"_$S($D(DIRUT):1,1:0)
"RTN","RAEDCN",104,0)
 . K DIR,DIROUT,DIRUT,DTOUT,DUOUT  Q:'+RAYN  ; quit if no
"RTN","RAEDCN",105,0)
 . D KILL^RAPSET1,SET^RAPSET1 ; else switch locations
"RTN","RAEDCN",106,0)
 . I $D(XQUIT) S $P(RAYN,"^",2)=1 K XQUIT
"RTN","RAEDCN",107,0)
 . Q
"RTN","RAEDCN",108,0)
 S ION=$P(RAMLC,"^",3) ; imaging location flash card printer (if any)
"RTN","RAEDCN",109,0)
 G Q:'$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) S Y=^(0),Y=$S($D(^RAMIS(71,+$P(Y,"^",2),0)):$P(^(0),"^",3),1:"")
"RTN","RAEDCN",110,0)
 ; if Y, then convert the pointer value 'Y' to the .01 value of
"RTN","RAEDCN",111,0)
 ; the procedure flash card printer (if any)
"RTN","RAEDCN",112,0)
 I Y]"",$D(^%ZIS(1,+Y,0)) D
"RTN","RAEDCN",113,0)
 . S Y(0)=$$GET1^DIQ(3.5,+Y,.01) ; .01 value for proc flash card printer
"RTN","RAEDCN",114,0)
 . S:Y(0)'=$P(RAMLC,"^",3) ION=Y(0) K Y(0)
"RTN","RAEDCN",115,0)
 . ; if flash card printer for the imaging location differs from
"RTN","RAEDCN",116,0)
 . ; the procedure flash card printer, default (print to) to the flash
"RTN","RAEDCN",117,0)
 . ; card printer for the procedure.
"RTN","RAEDCN",118,0)
 . Q
"RTN","RAEDCN",119,0)
 S RAMES="W !!,""Duplicates queued to print on "",ION,"".""",RAFLH=$S($P(RAMLC,"^",7):$P(RAMLC,"^",7),1:1),RAEXFM=$S($P(RAMLC,"^",9):$P(RAMLC,"^",9),1:1),RAFLHFL=RACNI
"RTN","RAEDCN",120,0)
FLH ; Flash Cards
"RTN","RAEDCN",121,0)
 R !,"How many flash cards? 1// ",X:DTIME G DUP1:'$T!(X["^") S:X="" X=1 S RANUM=X I '(RANUM?.N)!(RANUM>20) W !?3,$C(7),"Must be a whole number less than 21!" G FLH
"RTN","RAEDCN",122,0)
EXM ; Exam Labels
"RTN","RAEDCN",123,0)
 R !,"How many exam labels? 1// ",X:DTIME G DUP1:'$T!(X["^") S:X="" X=1 S RAEXLBLS=X I '(RAEXLBLS?.N)!(RAEXLBLS>20) W !?3,$C(7),"Must be a whole number less than 21!" G EXM
"RTN","RAEDCN",124,0)
 S IOP="Q" S:ION]"" RADFLTP=ION
"RTN","RAEDCN",125,0)
 K RAFL D Q^RAFLH,Q G DUP1
"RTN","RAEDCN",126,0)
 ;
"RTN","RAEDCN",127,0)
SETVARS ; Setup key Rad/Nuc Med variables
"RTN","RAEDCN",128,0)
 I $O(RACCESS(DUZ,""))="" D SETVARS^RAPSET1(0)
"RTN","RAEDCN",129,0)
 Q:'($D(RACCESS(DUZ))\10)  ; user does not have location access
"RTN","RAEDCN",130,0)
 I $G(RAIMGTY)="" D SETVARS^RAPSET1(1) K:$G(RAIMGTY)="" XQUIT
"RTN","RAEDCN",131,0)
 Q
"RTN","RAEDCN1")
0^17^B13671032
"RTN","RAEDCN1",1,0)
RAEDCN1 ;HISC/GJC-Utility routine for RAEDCN ;9/18/97  13:49
"RTN","RAEDCN1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,45**;Mar 16, 1998
"RTN","RAEDCN1",3,0)
 ; last modif by SS for P18
"RTN","RAEDCN1",4,0)
UNDEF ; Message for undefined imaging types
"RTN","RAEDCN1",5,0)
 I '+$G(RAMLC) D  Q
"RTN","RAEDCN1",6,0)
 . W !?5,"Imaging Location data is not defined, "
"RTN","RAEDCN1",7,0)
 . W "contact IRM.",$C(7)
"RTN","RAEDCN1",8,0)
 . Q
"RTN","RAEDCN1",9,0)
 W !?5,"An Imaging Type was not defined for the following Imaging"
"RTN","RAEDCN1",10,0)
 W !?5,"Location: "_$P(^SC($P($G(^RA(79.1,+RAMLC,0)),U),0),U)_"."
"RTN","RAEDCN1",11,0)
 Q
"RTN","RAEDCN1",12,0)
STUB(RARPT) ; Determine if this is an imaging stub report.
"RTN","RAEDCN1",13,0)
 ; Input: RARPT-ien of the report record
"RTN","RAEDCN1",14,0)
 ; Output: 1 if an imaging stub rpt, else 0
"RTN","RAEDCN1",15,0)
 N RA0 S RA0=$O(^RARPT(RARPT,"L",""),-1) ; most recent activity on rpt
"RTN","RAEDCN1",16,0)
 I RA0>0,$P($G(^RARPT(RARPT,"L",RA0,0)),U,2)="C",$P(^RARPT(RARPT,0),U,5)="",$O(^RARPT(RARPT,2005,0)),'$D(^RARPT(RARPT,"I")),'$D(^("P")),'$D(^("R")) Q 1 ; rpt is an image stub
"RTN","RAEDCN1",17,0)
 Q 0 ; (non-stub rpt record)
"RTN","RAEDCN1",18,0)
 ;
"RTN","RAEDCN1",19,0)
PSET(RADFN,RADTI,RACNI) ; Determine if this exam is part of a printset.
"RTN","RAEDCN1",20,0)
 ; Input: RADFN-patient dfn <-> RADTI-exam timestamp <-> RACNI-exam ien
"RTN","RAEDCN1",21,0)
 ; Output: 1 if part of a printset, else 0
"RTN","RAEDCN1",22,0)
 Q $S($P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",25)=2:1,1:0)
"RTN","RAEDCN1",23,0)
 ;
"RTN","RAEDCN1",24,0)
CKREASON(X) ;check file 75.2 ; P18 moved it from RAEDCN because the routine's length exceeded limit
"RTN","RAEDCN1",25,0)
 ; 0=OKAY, 1=BAD
"RTN","RAEDCN1",26,0)
 ; don't check for var RAOREA, because it's not set this early
"RTN","RAEDCN1",27,0)
 I X="C",$O(^RA(75.2,"B","EXAM CANCELLED",0)) Q 0
"RTN","RAEDCN1",28,0)
 I X="D",$O(^RA(75.2,"B","EXAM DELETED",0)) Q 0
"RTN","RAEDCN1",29,0)
 W !!?5,$S(X="C":"Cancellation",1:"Deletion")," cannot be done, because your file #75.2,"
"RTN","RAEDCN1",30,0)
 W !?5,"RAD/NUC MED REASON, does not have ""EXAM ",$S(X="C":"CANCELLED",1:"DELETED"),"""","."
"RTN","RAEDCN1",31,0)
 W !!?5,"Please notify your ADPAC.",!
"RTN","RAEDCN1",32,0)
 K DIR S DIR(0)="E",DIR("A")="Press RETURN for menu options" D ^DIR K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAEDCN1",33,0)
 Q 1
"RTN","RAEDCN1",34,0)
 ;
"RTN","RAEDCN1",35,0)
DEL ; 'Exam Deletion' option (RA DELETEXAM)
"RTN","RAEDCN1",36,0)
 D SETVARS^RAEDCN Q:'($D(RACCESS(DUZ))\10)!('$D(RAIMGTY))
"RTN","RAEDCN1",37,0)
 S RAXIT=$$CKREASON^RAEDCN1("D") I RAXIT K RAXIT Q  ;P18
"RTN","RAEDCN1",38,0)
DEL1 D ^RACNLU G Q^RAEDCN:X="^"
"RTN","RAEDCN1",39,0)
 I RARPT W !?3,$C(7),"A report has been filed for this case. Therefore deletion is not allowed!" G DEL1
"RTN","RAEDCN1",40,0)
ASKDEL R !!,"Do you wish to delete this exam? NO// ",X:DTIME S:'$T!(X="")!(X["^") X="N" G DEL1:"Nn"[$E(X) I "Yy"'[$E(X) W:X'["?" $C(7) W !!,"Enter 'YES' to delete this exam, or 'NO' not to." G ASKDEL
"RTN","RAEDCN1",41,0)
 L +^RADPT(RADFN,"DT",RADTI):1 I '$T W !,$C(7),"Someone else is editing an exam for this patient on the date/time",!,"you selected. Please try Later" G DEL1
"RTN","RAEDCN1",42,0)
 S RADELFLG="" D ^RAORDC
"RTN","RAEDCN1",43,0)
 ; trigger RA CANCEL protocol on xam delete if xam not already cancelled
"RTN","RAEDCN1",44,0)
 S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),X=+$P(RA7003,"^",3)
"RTN","RAEDCN1",45,0)
 ; no rpt filed, xam status exists & not cancelled -OR- xam status
"RTN","RAEDCN1",46,0)
 ; non-existent.
"RTN","RAEDCN1",47,0)
 I $P($G(^RA(72,X,0)),U,3)'=0 D
"RTN","RAEDCN1",48,0)
 . K RAIENS,RAERR S RAIENS=""_RACNI_","_RADTI_","_RADFN_","_"",RAFDA(70.03,RAIENS,3)="CANCELLED" D FILE^DIE("KSE","RAFDA","RAERR") K RAIENS,RAERR,RAFDA D CANCEL^RAHLRPC
"RTN","RAEDCN1",49,0)
 . Q
"RTN","RAEDCN1",50,0)
 K RA7003 S RABULL="",DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RAEDCN1",51,0)
 S DIK="^RADPT(DA(2),""DT"",DA(1),""P""," D ^DIK
"RTN","RAEDCN1",52,0)
 W !?10,"...deletion of exam complete."
"RTN","RAEDCN1",53,0)
 K %,D,D0,D1,D2,DA,DIC,DIK,RADELFLG,RABULL,RAPRTZ,RAAFTER,RABEFORE
"RTN","RAEDCN1",54,0)
 ; Check if one exam or multiple exams exists below "DT" node.
"RTN","RAEDCN1",55,0)
 ; If no exams are present, delete "DT" node.
"RTN","RAEDCN1",56,0)
 I '+$O(^RADPT(RADFN,"DT",RADTI,"P",0)) D
"RTN","RAEDCN1",57,0)
 . K DA,DIK S DA(1)=RADFN,DA=RADTI
"RTN","RAEDCN1",58,0)
 . S DIK="^RADPT(DA(1),""DT""," D ^DIK
"RTN","RAEDCN1",59,0)
 . K DA,DIK Q
"RTN","RAEDCN1",60,0)
 L -^RADPT(RADFN,"DT",RADTI)
"RTN","RAEDCN1",61,0)
 G DEL1
"RTN","RAEDCN1",62,0)
 ;
"RTN","RAEDCN1",63,0)
VIEW ; 'View Exam by Case No.' option (RA VIEWCN)
"RTN","RAEDCN1",64,0)
 D SETVARS^RAEDCN Q:'($D(RACCESS(DUZ))\10)!('$D(RAIMGTY))
"RTN","RAEDCN1",65,0)
 S RAVW="" D ^RACNLU G Q^RAEDCN:X="^" K RAFL D ^RAPROD D Q^RAEDCN G VIEW
"RTN","RAEDCN1",66,0)
 ;
"RTN","RAEDPT")
0^23^B9185618
"RTN","RAEDPT",1,0)
RAEDPT ;HISC/FPT,GJC,SS AISC/MJK,RMO-Edit Exams by Patient ;4/21/97  10:47
"RTN","RAEDPT",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,18,28,45**;Mar 16, 1998
"RTN","RAEDPT",3,0)
 ;last modification by SS JUNE 19,2000
"RTN","RAEDPT",4,0)
CASE D SET^RAPSET1 I $D(XQUIT) K XQUIT,POP Q
"RTN","RAEDPT",5,0)
 S RAXIT=0,DIC(0)="AEMQ" D ^RADPA G Q:Y<0
"RTN","RAEDPT",6,0)
 S RADFN=+Y,RAHEAD="**** Edit Exams By Patient ****"
"RTN","RAEDPT",7,0)
 D ^RAPTLU G CASE:"^"[X
"RTN","RAEDPT",8,0)
 W !!,"Case No.:",RACN,?15,"Procedure:",$E(RAPRC,1,30),?57,"Date:",RADATE
"RTN","RAEDPT",9,0)
 N RADISPLY
"RTN","RAEDPT",10,0)
 S RADISPLY=$G(^RAMIS(71,+$P($G(^RADPT(+RADFN,"DT",+RADTI,"P",+RACNI,0)),U,2),0)) ; set $ZR to 71 for prccpt^radd1, not call raprod since diff col
"RTN","RAEDPT",11,0)
 S RADISPLY=$$PRCCPT^RADD1()
"RTN","RAEDPT",12,0)
 W !,?25,RADISPLY
"RTN","RAEDPT",13,0)
 I $D(^RA(72,"AA",RAIMGTY,9,+RAST)),'$D(^XUSEC("RA MGR",DUZ)) W !!?3,$C(7),"You do not have the appropriate access privilege to edit completed exams.",! G CASE
"RTN","RAEDPT",14,0)
 I $D(^RA(72,"AA",RAIMGTY,0,+RAST)) W !!?3,$C(7),"Exam has been 'cancelled' therefore it cannot be edited." G CASE
"RTN","RAEDPT",15,0)
 S RAQUICK=0,DA=RADFN,DIE("NO^")="OUTOK"
"RTN","RAEDPT",16,0)
 S RADADA=RADTI ; RADTI defined in ^RAPTLU
"RTN","RAEDPT",17,0)
 S DIE="^RADPT(",DR="[RA EXAM EDIT]"
"RTN","RAEDPT",18,0)
 S RADIE="^RADPT("_RADFN_",""DT"","
"RTN","RAEDPT",19,0)
 S RAXIT=$$LOCK^RAUTL12(RADIE,RADADA) I RAXIT G CASE
"RTN","RAEDPT",20,0)
 N RAREM,RANUZD1,RAPSDRUG,RA00,RADIOPH,RALOW,RAHI,RADRAWN,RAASK,RADOSE,RASKMEDS,RAWHICH ;these are used by the edit template
"RTN","RAEDPT",21,0)
 ;
"RTN","RAEDPT",22,0)
 ;save 'before' CM data value to compare against the possible 'after'
"RTN","RAEDPT",23,0)
 ;value
"RTN","RAEDPT",24,0)
 D TRK70CMB^RAMAINU(RADFN,RADTI,RACNI,.RATRKCMB) ;RA*5*45
"RTN","RAEDPT",25,0)
 ;
"RTN","RAEDPT",26,0)
 D SVBEFOR^RAO7XX(RADFN,RADTI,RACNI) ;P18 save before edit to compare later in RAUTL1
"RTN","RAEDPT",27,0)
 D ^DIE K DE,DQ,DIE,DR,RAZCM
"RTN","RAEDPT",28,0)
 S:$D(RAPRI) RAPRIT=RAPRI D UP1^RAUTL1
"RTN","RAEDPT",29,0)
 ;
"RTN","RAEDPT",30,0)
 ;1) check data consistency between 'CONTRAST MEDIA USED' & 'CONTRAST
"RTN","RAEDPT",31,0)
 ;MEDIA'
"RTN","RAEDPT",32,0)
 ;2) check 'before' CM data against 'after' CM data, file in audit log
"RTN","RAEDPT",33,0)
 ;if necessary. Remember, contrast media asked when in input template:
"RTN","RAEDPT",34,0)
 ;RA EXAM EDIT (RA*5*45)
"RTN","RAEDPT",35,0)
 S RACMDA=RACNI,RACMDA(1)=RADTI,RACMDA(2)=RADFN
"RTN","RAEDPT",36,0)
 D XCMINTEG^RAMAINU1(.RACMDA) ;1
"RTN","RAEDPT",37,0)
 D TRK70CMA^RAMAINU(RADFN,RADTI,RACNI,RATRKCMB) ;2
"RTN","RAEDPT",38,0)
 K RACMDA
"RTN","RAEDPT",39,0)
 ;
"RTN","RAEDPT",40,0)
 D UNLOCK^RAUTL12(RADIE,RADADA) ;modif P18 by SS
"RTN","RAEDPT",41,0)
 K RATRKCMB,RADADA,RADIE,RADUZ W ! G CASE ;modif P18 by SS
"RTN","RAEDPT",42,0)
 ;
"RTN","RAEDPT",43,0)
Q K %,%DT,%Y,A,C,D0,D1,D2,DA,DIC,I,RACN,RACNI,RACNT,RACT,RADADA,RADATE,RADATI,RADFN,RADIE,RADTE,RADTI,RAHEAD,RAMES,RANME,RAOR,RAORDIFN,RAPOP,RAPRC,RAPRI,RAQUICK,RARPT,RASN,RASSN,RAST,RASTI,RAXIT,XQUIT,VAINDT,VADMVT,X,Y
"RTN","RAEDPT",44,0)
 K ^TMP($J,"RAEX")
"RTN","RAEDPT",45,0)
 K %W,%Y1,D,D3,DDER,DI,DK,DL,POP,DISYS,DUOUT,RAI
"RTN","RAEDPT",46,0)
 Q
"RTN","RAMAIN2")
0^6^B45749858
"RTN","RAMAIN2",1,0)
RAMAIN2 ;HISC/GJC-Radiology Utility File Maintenance (Part Two) ;10/29/97  13:13
"RTN","RAMAIN2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RAMAIN2",3,0)
2 ;;Procedure Enter/Edit
"RTN","RAMAIN2",4,0)
 ; *** This subroutine once resided in RAMAIN i.e, '2^RAMAIN'. ***
"RTN","RAMAIN2",5,0)
 ; RA PROCEDURE option
"RTN","RAMAIN2",6,0)
 N RACTIVE,RAENALL,RAY,RAFILE,RASTAT,RAXIT
"RTN","RAMAIN2",7,0)
 S (RAENALL,RANEW71,RAXIT)=0
"RTN","RAMAIN2",8,0)
 N RADIO,RAPTY,RAASK,RAROUTE ;used by the edit template
"RTN","RAMAIN2",9,0)
 F  D  Q:$G(RAXIT)
"RTN","RAMAIN2",10,0)
 . K DA,DD,DIC,DINUM,DLAYGO,DO,RACMDIFF,RATRKCMA,RATRKCMB
"RTN","RAMAIN2",11,0)
 . S DIC="^RAMIS(71,",DIC(0)="QEAMLZ",DLAYGO=71,DIC("DR")=6
"RTN","RAMAIN2",12,0)
 . W ! D ^DIC K D,DD,DIC,DINUM,DLAYGO,DO
"RTN","RAMAIN2",13,0)
 . S:+Y<0 RAXIT=1 I $G(RAXIT) K D,X,Y Q
"RTN","RAMAIN2",14,0)
 . S (DA,RADA)=+Y,RAY=Y,RAFILE=71
"RTN","RAMAIN2",15,0)
 . S:$P(Y,U,3)=1 RANEW71=1 ;used in template, edit CPT Code if new rec.
"RTN","RAMAIN2",16,0)
 . L +^RAMIS(RAFILE,RADA):5
"RTN","RAMAIN2",17,0)
 . I '$T D  Q
"RTN","RAMAIN2",18,0)
 .. W !?5,"This record is currently being edited by another user."
"RTN","RAMAIN2",19,0)
 .. W !?5,"Try again later!",$C(7) S RAXIT=1
"RTN","RAMAIN2",20,0)
 .. Q
"RTN","RAMAIN2",21,0)
 . S RAPNM=$P($G(Y(0)),U) ;proc. name for display purposes in template
"RTN","RAMAIN2",22,0)
 . S RACTIVE=$P($G(^RAMIS(71,RADA,"I")),"^")
"RTN","RAMAIN2",23,0)
 . S RASTAT=$S(RACTIVE="":1,RACTIVE>DT:1,1:0)
"RTN","RAMAIN2",24,0)
 . D TRKCMB^RAMAINU(DA,.RATRKCMB) ;tracks existing
"RTN","RAMAIN2",25,0)
 . ; CM definition before editing. RATRKCMB ids the before CM values
"RTN","RAMAIN2",26,0)
 . S DIE="^RAMIS(71,",DR="[RA PROCEDURE EDIT]" D ^DIE
"RTN","RAMAIN2",27,0)
 . K RAPNM S RAPROC(0)=$G(^RAMIS(71,RADA,0))
"RTN","RAMAIN2",28,0)
 . ;
"RTN","RAMAIN2",29,0)
 . ;check for data consistency between the 'CONTRAST MEDIA USED' &
"RTN","RAMAIN2",30,0)
 . ;'CONTRAST MEDIA' fields.
"RTN","RAMAIN2",31,0)
 . D CMINTEG^RAMAINU1(RADA,RAPROC(0))
"RTN","RAMAIN2",32,0)
 . ;
"RTN","RAMAIN2",33,0)
 . D TRKCMA^RAMAINU(RADA,RATRKCMB,.RATRKCMA,.RACMDIFF)
"RTN","RAMAIN2",34,0)
 . I $O(^RAMIS(71,RADA,"NUC",0)),($P(RAPROC(0),"^",2)=1) D DELRADE(RADA)
"RTN","RAMAIN2",35,0)
 . S RACTIVE=$P($G(^RAMIS(71,RADA,"I")),"^")
"RTN","RAMAIN2",36,0)
 . S RASTAT=RASTAT_"^"_$S(RACTIVE="":1,RACTIVE>DT:1,1:0)
"RTN","RAMAIN2",37,0)
 . I RAPROC(0)]"",("^B^P^"'[(U_$P(RAPROC(0),"^",6)_U)),('+$P(RAPROC(0),"^",9)) D
"RTN","RAMAIN2",38,0)
 .. K %,C,D0,DE,DI,DIE,DQ,DR
"RTN","RAMAIN2",39,0)
 .. W !?5,$C(7),"...no CPT code entered..."
"RTN","RAMAIN2",40,0)
 .. W !?5,"...will change type to a 'broad' procedure.",!
"RTN","RAMAIN2",41,0)
 .. S DA=RADA,DIE="^RAMIS(71,",DR="6///B" D ^DIE
"RTN","RAMAIN2",42,0)
 .. Q
"RTN","RAMAIN2",43,0)
 . ;if an active parent w/o descendants, inactivate the parent
"RTN","RAMAIN2",44,0)
 . I $P(RASTAT,U,2),($P(RAPROC(0),U,6)="P"),('$O(^RAMIS(71,RADA,4,0))) D
"RTN","RAMAIN2",45,0)
 .. K D,D0,D1,DA,DI,DIC,DIE,DQ,DR
"RTN","RAMAIN2",46,0)
 .. W !!?5,"Inactivating this parent procedure - no descendents.",!,$C(7)
"RTN","RAMAIN2",47,0)
 .. S DA=RADA,DIE="^RAMIS(71,",DR="100///"_$S($D(DT):DT,1:$$DT^XLFDT())
"RTN","RAMAIN2",48,0)
 .. D ^DIE K D,D0,D1,DA,DI,DIC,DIE,DQ,DR S $P(RASTAT,U,2)=0 ;inactive
"RTN","RAMAIN2",49,0)
 .. Q
"RTN","RAMAIN2",50,0)
 . I $P($G(^RA(79.2,+$P(RAPROC(0),U,12),0)),U,5)="Y",(+$O(^RAMIS(71,RADA,"NUC",0))) D VRDIO(RADA)
"RTN","RAMAIN2",51,0)
 . I "^B^P^"[(U_$P(RAPROC(0),U,6)_U),($P(RAPROC(0),U,9)]"") D
"RTN","RAMAIN2",52,0)
 .. K %,D,D0,DA,DE,DIC,DIE,DQ,DR
"RTN","RAMAIN2",53,0)
 .. S DA=RADA,DIE="^RAMIS(71,",DR="9///@" D ^DIE
"RTN","RAMAIN2",54,0)
 .. W !!?5,"...CPT code deleted because "_$S($P(RAPROC(0),U,6)="B":"Broad",1:"Parent")_" procedures",!?5,"should not have CPT codes.",!,$C(7)
"RTN","RAMAIN2",55,0)
 .. Q
"RTN","RAMAIN2",56,0)
 . K %,%X,%Y,C,D,D0,D1,DA,DE,DI,DIE,DQ,DR,RAIMAG,RAMIS,RAPROC,X,Y
"RTN","RAMAIN2",57,0)
 .;send Orderable Item HL7 msg to CPRS if the ORDER DIALOG (#101.41)
"RTN","RAMAIN2",58,0)
 .;file exists unconditionally
"RTN","RAMAIN2",59,0)
 .D:$$ORQUIK^RAORDU()=1 PROC^RAO7MFN(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAMAIN2",60,0)
 .;
"RTN","RAMAIN2",61,0)
 . L -^RAMIS(RAFILE,RADA) K RADA
"RTN","RAMAIN2",62,0)
 .;unconditionally update the parent procedure if the descendent
"RTN","RAMAIN2",63,0)
 .I $O(^RAMIS(71,"ADESC",+RAY,0)) D UPDATP^RAO7UTL(RAY)
"RTN","RAMAIN2",64,0)
 .;has been edited
"RTN","RAMAIN2",65,0)
 . Q
"RTN","RAMAIN2",66,0)
 K DIR,RACMDIFF,RATRKCMA,RATRKCMB
"RTN","RAMAIN2",67,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","RAMAIN2",68,0)
 S DIR("A")="Want to run a validity check on CPT and stop codes? "
"RTN","RAMAIN2",69,0)
 S DIR("?",1)="Answer 'YES' to print a list of Radiology/Nuclear Medicine Procedures"
"RTN","RAMAIN2",70,0)
 S DIR("?",2)="with missing or invalid CPT's and/or Credit Clinic Stop Code(s)."
"RTN","RAMAIN2",71,0)
 S DIR("?",3)="Broad procedures with invalid codes are included for information"
"RTN","RAMAIN2",72,0)
 S DIR("?",4)="only.  Inactive procedures are not required to have valid codes."
"RTN","RAMAIN2",73,0)
 S DIR("?",5)="To be valid, Stop Codes must be in the Imaging Stop Codes file 71.5;"
"RTN","RAMAIN2",74,0)
 S DIR("?",6)="CPT's must be nationally active."
"RTN","RAMAIN2",75,0)
 S DIR("?")="Please answer 'YES' or 'NO'."
"RTN","RAMAIN2",76,0)
 W ! D ^DIR K DIR G:$D(DIRUT) EXIT
"RTN","RAMAIN2",77,0)
 D:Y ^RAPERR
"RTN","RAMAIN2",78,0)
EXIT K RADA,RANEW71,X,Y
"RTN","RAMAIN2",79,0)
 Q
"RTN","RAMAIN2",80,0)
13 ;;Rad/Nuc Med Common Procedure File Enter/Edit
"RTN","RAMAIN2",81,0)
 ; RA COMMON PROCEDURE option
"RTN","RAMAIN2",82,0)
 N RADA,RAENALL,RAY,RAFILE,RALOW,RAMIS713,RASTAT,RAIMGTYI S RAENALL=0
"RTN","RAMAIN2",83,0)
 W ! D EN1^RAUTL17 G:Y'>0 Q13 S RAIMGTYI=Y
"RTN","RAMAIN2",84,0)
131 S DIC="^RAMIS(71.3,",DIC(0)="AELMQZ",DLAYGO=71.3
"RTN","RAMAIN2",85,0)
 S DIC("S")="N RA S RA=+$P(^(0),U) I RAIMGTYI=$P($G(^RAMIS(71,RA,0)),U,12)"
"RTN","RAMAIN2",86,0)
 S DIC("W")="N RA4 S RA4=$P($G(^(0)),""^"",4) W:RA4]"""" ""   (""_RA4_"")"" W:RA4']"""" ""   (no sequence number)"""
"RTN","RAMAIN2",87,0)
 W ! D ^DIC K DIC,DLAYGO,D,X
"RTN","RAMAIN2",88,0)
 I Y<0 D Q13 G RESEQ
"RTN","RAMAIN2",89,0)
 ; If a sequence # exists, the Common Proc. is active
"RTN","RAMAIN2",90,0)
 S RADA=+Y,RAY=Y,RAFILE=71.3 L +^RAMIS(RAFILE,RADA):5
"RTN","RAMAIN2",91,0)
 I '$T D  G Q13
"RTN","RAMAIN2",92,0)
 . W !?5,"This record is currently being edited by another user."
"RTN","RAMAIN2",93,0)
 . W !?5,"Try again later!",$C(7)
"RTN","RAMAIN2",94,0)
 . Q
"RTN","RAMAIN2",95,0)
 S RASTAT=$S($P(Y(0),"^",4)]"":1,1:0)_"^"
"RTN","RAMAIN2",96,0)
 I '+$P(RASTAT,"^") S RALOW=$$LOW(RAIMGTYI)
"RTN","RAMAIN2",97,0)
 S DA=RADA,DIE="^RAMIS(71.3,",DR="[RA COMMON PROCEDURE EDIT]" D ^DIE
"RTN","RAMAIN2",98,0)
 S RAMIS713(0)=$G(^RAMIS(71.3,RADA,0))
"RTN","RAMAIN2",99,0)
 ; If the procedure is different than the one originally selected and
"RTN","RAMAIN2",100,0)
 ; the CPRS Order Dialog file exists, send the Orderable Item Update
"RTN","RAMAIN2",101,0)
 ; message to CPRS.
"RTN","RAMAIN2",102,0)
 I $P(RAMIS713(0),"^")'=$P(RAY,"^",2),($$ORQUIK^RAORDU()=1) D
"RTN","RAMAIN2",103,0)
 . S RASTAT=RASTAT_0 D PROC^RAO7MFN(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAMAIN2",104,0)
 . S RAY=RADA_"^"_$P($G(^RAMIS(71.3,RADA,0)),"^")_"^"_1,RASTAT=0_"^"
"RTN","RAMAIN2",105,0)
 . Q
"RTN","RAMAIN2",106,0)
 K %,%X,%Y,C,D,D0,DA,DE,DI,DIE,DQ,DR,X,Y
"RTN","RAMAIN2",107,0)
 S RASTAT=RASTAT_$S($P($G(^RAMIS(71.3,+RAY,0)),"^",4)]"":1,1:0)
"RTN","RAMAIN2",108,0)
 ; If before & after statuses differ, and the CPRS Order Dialog file
"RTN","RAMAIN2",109,0)
 ; exists, send the Orderable Item Update message to CPRS.
"RTN","RAMAIN2",110,0)
 I $$ORQUIK^RAORDU()=1,(($P(RASTAT,"^")+$P(RASTAT,"^",2))=1) D
"RTN","RAMAIN2",111,0)
 . D PROC^RAO7MFN(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAMAIN2",112,0)
 . Q
"RTN","RAMAIN2",113,0)
 L -^RAMIS(RAFILE,RADA)
"RTN","RAMAIN2",114,0)
 G 131
"RTN","RAMAIN2",115,0)
Q13 K DDC,DDH,DISYS,I,POP,RA713
"RTN","RAMAIN2",116,0)
 Q
"RTN","RAMAIN2",117,0)
RESEQ ;Resequence the common procedure list
"RTN","RAMAIN2",118,0)
 N D,D0,DI,DQ,H,I,J,CNT,DIC,DIE,DR,DA,TXT,X
"RTN","RAMAIN2",119,0)
 I $D(XPDNM) D  ; if called during package install
"RTN","RAMAIN2",120,0)
 . S TXT(1)=" "
"RTN","RAMAIN2",121,0)
 . S TXT(2)="Resequencing the Rad/Nuc Med Common Procedure List."
"RTN","RAMAIN2",122,0)
 . Q
"RTN","RAMAIN2",123,0)
 E  W !!?5,"Resequencing the Rad/Nuc Med Common Procedure List"
"RTN","RAMAIN2",124,0)
 S DIE="^RAMIS(71.3,",(I,CNT)=0
"RTN","RAMAIN2",125,0)
 F  S I=$O(^RAMIS(71.3,"AA",RAIMGTYI,I)) Q:I'>0  D
"RTN","RAMAIN2",126,0)
 . S J=0
"RTN","RAMAIN2",127,0)
 . F  S J=$O(^RAMIS(71.3,"AA",RAIMGTYI,I,J)) Q:J'>0  I $D(^RAMIS(71.3,J,0)) D
"RTN","RAMAIN2",128,0)
 .. S DA=J,CNT=CNT+1 N I,J
"RTN","RAMAIN2",129,0)
 .. S DR="3////^S X=CNT" D ^DIE W:'$D(XPDNM) "."
"RTN","RAMAIN2",130,0)
 .. Q
"RTN","RAMAIN2",131,0)
 . Q
"RTN","RAMAIN2",132,0)
 I $D(XPDNM) D  ; if called during package install
"RTN","RAMAIN2",133,0)
 . S TXT(2)=$G(TXT(2))_"  Done!"
"RTN","RAMAIN2",134,0)
 . D MES^XPDUTL(.TXT)
"RTN","RAMAIN2",135,0)
 . Q
"RTN","RAMAIN2",136,0)
 E  W "  Done!"
"RTN","RAMAIN2",137,0)
 Q
"RTN","RAMAIN2",138,0)
LOW(X) ; Find the lowest available sequence number for a procedure within
"RTN","RAMAIN2",139,0)
 ; a specific Imaging Type.  Seq. #'s range from 1 to 40.  If the
"RTN","RAMAIN2",140,0)
 ; range changes in the DD i.e, ^DD(71.3,3, this code as well as the 
"RTN","RAMAIN2",141,0)
 ; code if EN3^RAUTL18 must also be altered.
"RTN","RAMAIN2",142,0)
 ; If RAHIT is passed back as "", there is no available sequence number.
"RTN","RAMAIN2",143,0)
 N RA,RAHIT S RAHIT=""
"RTN","RAMAIN2",144,0)
 F RA=1:1:40 D  Q:RAHIT
"RTN","RAMAIN2",145,0)
 . Q:$D(^RAMIS(71.3,"AA",X,RA))
"RTN","RAMAIN2",146,0)
 . S:RAHIT="" RAHIT=RA
"RTN","RAMAIN2",147,0)
 . Q
"RTN","RAMAIN2",148,0)
 Q RAHIT
"RTN","RAMAIN2",149,0)
VRDIO(RADA) ; Validate the 'Usual Dose' field within the 'Default Radiopha-
"RTN","RAMAIN2",150,0)
 ; rmaceuticals' multiple.  'Usual Dose' must fall within the 'Low Adult
"RTN","RAMAIN2",151,0)
 ; Dose' & 'High Adult Dose' range.  This subroutine will display the
"RTN","RAMAIN2",152,0)
 ; Radiopharmaceutical in question along with the values in question if
"RTN","RAMAIN2",153,0)
 ; inconsistencies are found.
"RTN","RAMAIN2",154,0)
 ;
"RTN","RAMAIN2",155,0)
 ; Input Variable: 'RADA' the ien of the Procedure
"RTN","RAMAIN2",156,0)
 N RANUC S RADA(1)=RADA,RADA=0 D EN^DDIOL("","","!")
"RTN","RAMAIN2",157,0)
 F  S RADA=$O(^RAMIS(71,RADA(1),"NUC",RADA)) Q:RADA'>0  D
"RTN","RAMAIN2",158,0)
 . S RANUC(0)=$G(^RAMIS(71,RADA(1),"NUC",RADA,0))
"RTN","RAMAIN2",159,0)
 . Q:$P(RANUC(0),"^",2)=""  ; no need to validate, nothing input
"RTN","RAMAIN2",160,0)
 . I '$$USUAL^RADD2(.RADA,$P(RANUC(0),"^",2)) D
"RTN","RAMAIN2",161,0)
 .. N RARRY S RARRY(1)="For Radiopharmaceutical: "
"RTN","RAMAIN2",162,0)
 .. S RARRY(1)=RARRY(1)_$$GET1^DIQ(50,+$P(RANUC(0),"^")_",",.01)_$C(7)
"RTN","RAMAIN2",163,0)
 .. S RARRY(2)="" D EN^DDIOL(.RARRY,"")
"RTN","RAMAIN2",164,0)
 .. Q
"RTN","RAMAIN2",165,0)
 . Q
"RTN","RAMAIN2",166,0)
 Q
"RTN","RAMAIN2",167,0)
DELRADE(RADA) ; Delete the Default Radiopharmaceuticals multiple 
"RTN","RAMAIN2",168,0)
 N RADA1 S RADA1=0
"RTN","RAMAIN2",169,0)
 W !!?3,"Deleting default radiopharmaceuticals for this procedure...",!
"RTN","RAMAIN2",170,0)
 F  S RADA1=$O(^RAMIS(71,RADA,"NUC",RADA1)) Q:RADA1'>0  D
"RTN","RAMAIN2",171,0)
 . K %,%X,%Y,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RAMAIN2",172,0)
 . S DA(1)=RADA,DA=RADA1,DIE="^RAMIS(71,"_RADA_",""NUC"","
"RTN","RAMAIN2",173,0)
 . S DR=".01///@" D ^DIE
"RTN","RAMAIN2",174,0)
 . Q
"RTN","RAMAIN2",175,0)
 K %,%X,%Y,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RAMAIN2",176,0)
 Q
"RTN","RAMAIN2",177,0)
 ;
"RTN","RAMAINP1")
0^7^B24954066
"RTN","RAMAINP1",1,0)
RAMAINP1 ;HISC/GJC AISC/TMP,RMO-Utility Files Print ;9/22/98  15:26
"RTN","RAMAINP1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**3,45**;Mar 16, 1998
"RTN","RAMAINP1",3,0)
18 ;;Parent Procedure List
"RTN","RAMAINP1",4,0)
 N RA1,RA2,RA3
"RTN","RAMAINP1",5,0)
 D KILL^RAMAINP N RAX,RAY S RAX=$$IMG^RAUTL12() Q:'RAX
"RTN","RAMAINP1",6,0)
 S RASTAT=$$ACTIVE()
"RTN","RAMAINP1",7,0)
 I RASTAT="^" K RASTAT Q
"RTN","RAMAINP1",8,0)
 S DIC="^RAMIS(71,",L=0,FLDS="[RA PARENT PROCEDURE LIST]"
"RTN","RAMAINP1",9,0)
 S BY="12,.01",DHD=$S(RASTAT="B":"Active/Inactive",RASTAT="A":"Active",1:"Inactive")_" Parent Procedure List"
"RTN","RAMAINP1",10,0)
 S:RASTAT="B" DIS(0)="I $P($G(^RAMIS(71,D0,0)),U,6)=""P"",$$IMG^RAMAINP(D0)"
"RTN","RAMAINP1",11,0)
 S:RASTAT="A" DIS(0)="I $P($G(^RAMIS(71,D0,0)),U,6)=""P"",$$IMG^RAMAINP(D0),(+$G(^RAMIS(71,D0,""I""))=0!(+$G(^RAMIS(71,D0,""I""))>DT))"
"RTN","RAMAINP1",12,0)
 S:RASTAT="I" DIS(0)="I $P($G(^RAMIS(71,D0,0)),U,6)=""P"",$$IMG^RAMAINP(D0),+$G(^RAMIS(71,D0,""I""))>0,+$G(^RAMIS(71,D0,""I""))'>DT"
"RTN","RAMAINP1",13,0)
 S (FR,TO)="" K RASTAT S DHIT="S $P(RALINE,""-"",(IOM+1))="""" W !,RALINE"
"RTN","RAMAINP1",14,0)
 W ! D 132^RAMAINP S RAPOP=$$ZIS^RAMAINP("Rad/Nuc Med Parent Procedure Listing")
"RTN","RAMAINP1",15,0)
 I +RAPOP D HOME^%ZIS,KILL^RAMAINP Q  ; device selection failed
"RTN","RAMAINP1",16,0)
 I +$P(RAPOP,"^",2) D KILL^RAMAINP Q
"RTN","RAMAINP1",17,0)
 E  D ENTASK^RAMAINP
"RTN","RAMAINP1",18,0)
 Q
"RTN","RAMAINP1",19,0)
 ;
"RTN","RAMAINP1",20,0)
CMPRT ; Entry Point: print procedures that are associated with contrast
"RTN","RAMAINP1",21,0)
 ; media/medium.
"RTN","RAMAINP1",22,0)
 ; kill ^TMP($J) and select procedure i-types
"RTN","RAMAINP1",23,0)
 K ^TMP($J,"RA I-TYPE") S RAX=$$IMG^RAUTL12() I 'RAX K RAX Q
"RTN","RAMAINP1",24,0)
 S RAITYP="^",RAX=""
"RTN","RAMAINP1",25,0)
 F  S RAX=$O(^TMP($J,"RA I-TYPE",RAX)) Q:RAX=""  D
"RTN","RAMAINP1",26,0)
 .S RAY=$O(^TMP($J,"RA I-TYPE",RAX,0)),RAITYP=RAITYP_RAY_"^"
"RTN","RAMAINP1",27,0)
 .K ^TMP($J,"RA I-TYPE",RAX)
"RTN","RAMAINP1",28,0)
 .Q
"RTN","RAMAINP1",29,0)
 ; ask if active, inactive, or both active & inactive procedures are
"RTN","RAMAINP1",30,0)
 ; to be included.
"RTN","RAMAINP1",31,0)
 S RASTAT=$$ACTIVE()
"RTN","RAMAINP1",32,0)
 I RASTAT="^" K RAITYP,RASTAT,RAX,RAY Q
"RTN","RAMAINP1",33,0)
 ; save off user input parameters
"RTN","RAMAINP1",34,0)
 F I="RAITYP","RASTAT" S ZTSAVE(I)=""
"RTN","RAMAINP1",35,0)
 K I D EN^XUTMDEVQ("PRTCM^RAMAINP1","Rad/Nuc Med: print procedure contrast media association",.ZTSAVE,,1)
"RTN","RAMAINP1",36,0)
 I +$G(ZTSK)>0 W !!,"Task Number: "_ZTSK,!
"RTN","RAMAINP1",37,0)
 K %L,%X,%Y,DDH,POP,RAITYP,RASTAT,RAX,RAY,X,Y,ZTSAVE,ZTSK
"RTN","RAMAINP1",38,0)
 Q
"RTN","RAMAINP1",39,0)
 ;
"RTN","RAMAINP1",40,0)
PRTCM ; Print procedures that are associated with contrast media/medium.
"RTN","RAMAINP1",41,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RAMAINP1",42,0)
 S RAHD="Rad/Nuc Med Procedures with Contrast Media/Medium"
"RTN","RAMAINP1",43,0)
 S RAHD=$S(RASTAT="A":"Active ",RASTAT="I":"Inactive ",1:"")_RAHD
"RTN","RAMAINP1",44,0)
 S $P(RALINE,"-",(IOM+1))=""
"RTN","RAMAINP1",45,0)
 S RAPG=0,RADT=$$FMTE^XLFDT(DT,"1P")
"RTN","RAMAINP1",46,0)
 W:$E(IOST,1,2)="C-" @IOF ;clear screen
"RTN","RAMAINP1",47,0)
 D HDR S (RAY,RAXIT)=0
"RTN","RAMAINP1",48,0)
 ;only want procedure with contrast media/medium associations
"RTN","RAMAINP1",49,0)
 F  S RAY=$O(^RAMIS(71,"CM","Y",RAY)) Q:'RAY  D  Q:RAXIT
"RTN","RAMAINP1",50,0)
 .S RAXIT=$$S^%ZTLOAD() S:RAXIT ZTSTOP=1 Q:RAXIT
"RTN","RAMAINP1",51,0)
 .S RAY(0)=$G(^RAMIS(71,RAY,0))
"RTN","RAMAINP1",52,0)
 .;does the procedure have an i-type specified by the user?
"RTN","RAMAINP1",53,0)
 .Q:RAITYP'[("^"_$P(RAY(0),U,12)_"^")
"RTN","RAMAINP1",54,0)
 .S RAY("I")=+$G(^RAMIS(71,RAY,"I"))
"RTN","RAMAINP1",55,0)
 .;if inactive proc are desired, and the inact. date is in the future
"RTN","RAMAINP1",56,0)
 .;(the field will accept future dates), quit
"RTN","RAMAINP1",57,0)
 .I RASTAT="I",RAY("I"),RAY("I")>DT Q
"RTN","RAMAINP1",58,0)
 .;if inactive proc are desired, and no inact. date, quit
"RTN","RAMAINP1",59,0)
 .I RASTAT="I",'RAY("I") Q
"RTN","RAMAINP1",60,0)
 .;if active proc are desired, and the inact. date is today or in the
"RTN","RAMAINP1",61,0)
 .;past, quit
"RTN","RAMAINP1",62,0)
 .I RASTAT="A",RAY("I"),RAY("I")'>DT Q
"RTN","RAMAINP1",63,0)
 .;if both inactive & active procedures are desired all records qualify 
"RTN","RAMAINP1",64,0)
 .W !!,$P($$NAMCODE^RACPTMSC($P(RAY(0),U,9),DT),U),?19,$P(RAY(0),U)
"RTN","RAMAINP1",65,0)
 .I $Y>(IOSL-4) D EOS Q:RAXIT
"RTN","RAMAINP1",66,0)
 .W ! S (RACM,RADCM)=.001
"RTN","RAMAINP1",67,0)
 .F  D  Q:('RACM&'RADCM)!RAXIT  W !
"RTN","RAMAINP1",68,0)
 ..S:RADCM RADCM=$O(^RAMIS(71,RAY,"DCM",RADCM)) W:RADCM ?2,$E($P($$BASICMOD^RACPTMSC(+$G(^(RADCM,0)),DT),U,3),1,47)
"RTN","RAMAINP1",69,0)
 ..S:RACM RACM=$O(^RAMIS(71,RAY,"CM",RACM)) W:RACM ?50,$$EXTERNAL^DILFD(71.0125,.01,"",$P($G(^(RACM,0)),U))
"RTN","RAMAINP1",70,0)
 ..I $Y>(IOSL-4) D EOS Q:RAXIT
"RTN","RAMAINP1",71,0)
 ..Q
"RTN","RAMAINP1",72,0)
 .Q:RAXIT  I $Y>(IOSL-4) D EOS
"RTN","RAMAINP1",73,0)
 .W $$EXTERNAL^DILFD(71,6,"",$P(RAY(0),U,6)),?24,$$EXTERNAL^DILFD(71,12,"",$P(RAY(0),U,12))
"RTN","RAMAINP1",74,0)
 .I RASTAT'="A",(RAY("I")>0) W ?52,$$EXTERNAL^DILFD(71,100,"",RAY("I"))
"RTN","RAMAINP1",75,0)
 .Q
"RTN","RAMAINP1",76,0)
 ;
"RTN","RAMAINP1",77,0)
KILL ; kill and quit
"RTN","RAMAINP1",78,0)
 ;if there are no records to print, alert user
"RTN","RAMAINP1",79,0)
 W:'$D(RAY(0))#2 !,$$CJ^XLFSTR("*** No Records To Print ***",IOM)
"RTN","RAMAINP1",80,0)
 ;
"RTN","RAMAINP1",81,0)
 K RACM,RADCM,RADT,RAHD,RAITYP,RALINE,RAPG,RAXIT,RAY
"RTN","RAMAINP1",82,0)
 Q
"RTN","RAMAINP1",83,0)
 ;
"RTN","RAMAINP1",84,0)
ACTIVE() ; Use the ^DIR call to ask the user if active, inactive, or
"RTN","RAMAINP1",85,0)
 ; both inactive & active procedures are to be included.
"RTN","RAMAINP1",86,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT,X N Y
"RTN","RAMAINP1",87,0)
 S DIR(0)="S^A:Active;I:Inactive;B:Both",DIR("A")="Select Procedure Status",DIR("B")="A"
"RTN","RAMAINP1",88,0)
 S DIR("?",1)="Enter 'A' for active procedures, 'I' for inactive proceduRes,"
"RTN","RAMAINP1",89,0)
 S DIR("?")="or 'B' for both active and inactive procedures."
"RTN","RAMAINP1",90,0)
 W ! D ^DIR S:$D(DIRUT) Y="^"
"RTN","RAMAINP1",91,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT,X
"RTN","RAMAINP1",92,0)
 Q Y
"RTN","RAMAINP1",93,0)
 ;
"RTN","RAMAINP1",94,0)
EOS ; end of screen dialog
"RTN","RAMAINP1",95,0)
 I $E(IOST,1,2)="C-" D  Q:RAXIT
"RTN","RAMAINP1",96,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","RAMAINP1",97,0)
 .S DIR(0)="E" D ^DIR S:$D(DIRUT) RAXIT=1
"RTN","RAMAINP1",98,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","RAMAINP1",99,0)
 .Q
"RTN","RAMAINP1",100,0)
 ;
"RTN","RAMAINP1",101,0)
HDR ; print header
"RTN","RAMAINP1",102,0)
 W:RAPG @IOF S RAPG=RAPG+1
"RTN","RAMAINP1",103,0)
 W !,$$CJ^XLFSTR(RAHD,IOM),!,"Date: ",RADT,?69,"Page ",RAPG
"RTN","RAMAINP1",104,0)
 W !,"CPT",?19,"Procedure",!?2,"CPT Modifiers",?50,"Contrast Media",!,"Procedure Type",?24,"Imaging Type"
"RTN","RAMAINP1",105,0)
 W:RASTAT'="A" ?52,"Inactivation Date"
"RTN","RAMAINP1",106,0)
 W !,$$CJ^XLFSTR(RALINE,IOM)
"RTN","RAMAINP1",107,0)
 Q
"RTN","RAMAINP1",108,0)
 ;
"RTN","RAMAINP1",109,0)
CMDISP(RAZ71) ;Display contrast media data for descendents when the 'Parent
"RTN","RAMAINP1",110,0)
 ;Procedure List' [RA PROCPARENT] option is exercised
"RTN","RAMAINP1",111,0)
 ;function called from print template: [RA PARENT PROCEDURE LIST]
"RTN","RAMAINP1",112,0)
 ;input-RAZ71 internal entry number of the descendent
"RTN","RAMAINP1",113,0)
 ;formatting issues; differ for print options
"RTN","RAMAINP1",114,0)
 W !?7,"Contrast Medium"
"RTN","RAMAINP1",115,0)
 N RALBL,RAX,RAY S (RALBL,RAY)=0
"RTN","RAMAINP1",116,0)
 F  S RAY=$O(^RAMIS(71,RAZ71,"CM",RAY)) Q:'RAY  D
"RTN","RAMAINP1",117,0)
 .S RAX=$P($G(^RAMIS(71,RAZ71,"CM",RAY,0)),U) ;RAX=CM value (internal)
"RTN","RAMAINP1",118,0)
 .W:RALBL ! W ?40,$$EXTERNAL^DILFD(71.0125,.01,"",RAX) S RALBL=RAY
"RTN","RAMAINP1",119,0)
 .Q
"RTN","RAMAINP1",120,0)
 Q
"RTN","RAMAINP1",121,0)
 ;
"RTN","RAMAINU")
0^8^B21859709
"RTN","RAMAINU",1,0)
RAMAINU ;HISC/GJC-Radiology Utility File Maintenance (utility)
"RTN","RAMAINU",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RAMAINU",3,0)
 ;Note: new routine with the release of RA*5*45
"RTN","RAMAINU",4,0)
 ;
"RTN","RAMAINU",5,0)
CPT(DA,RAX) ;Ask for CPT Code when the 'Procedure Enter/Edit' option
"RTN","RAMAINU",6,0)
 ;is exercised. Called from input template: RA PROCEDURE EDIT
"RTN","RAMAINU",7,0)
 ;Input: DA=ien of new record being edited & RAX=procedure name
"RTN","RAMAINU",8,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,RAFDA,RAYN,X,Y S RAYN=0
"RTN","RAMAINU",9,0)
 F  D  Q:+RAYN!($D(DIRUT)#2)
"RTN","RAMAINU",10,0)
 .K X,Y S DIR(0)="71,9" D ^DIR Q:$D(DIRUT)#2
"RTN","RAMAINU",11,0)
 .;Y=N^S where N=record ien & S=.01 value of the record
"RTN","RAMAINU",12,0)
 .W !!,"Note: If an erroneous CPT Code is accepted it cannot be changed; the",!,"procedure must be inactivated."
"RTN","RAMAINU",13,0)
 .W !!,"Are you adding '"_$P(Y,U,2)_"' as the CPT Code for the new Rad/Nuc Med Procedure",!,"'"_RAX_"'? NO// "
"RTN","RAMAINU",14,0)
 .R RAYN:DTIME
"RTN","RAMAINU",15,0)
 .I '$T!(RAYN["^") S RAYN=-1 Q
"RTN","RAMAINU",16,0)
 .S RAYN=$E(RAYN) S:RAYN="" RAYN="N"
"RTN","RAMAINU",17,0)
 .I "YyNn"'[RAYN W !?3,"Enter 'Y' to accept the CPT Code, or 'N' to reject the CPT Code or '^' to",!?3,"exit without selecting a CPT Code."
"RTN","RAMAINU",18,0)
 .I  W !?5,"Note: If an erroneous CPT Code is accepted it cannot be changed; the",!?5,"procedure must be inactivated."
"RTN","RAMAINU",19,0)
 .S:"Yy"[RAYN RAYN="1^Y"
"RTN","RAMAINU",20,0)
 .S:"Nn"[RAYN RAYN=0
"RTN","RAMAINU",21,0)
 .Q
"RTN","RAMAINU",22,0)
 I $P(RAYN,U,2)="Y" S RAFDA(71,DA_",",9)=$P(Y,U) D FILE^DIE("","RAFDA")
"RTN","RAMAINU",23,0)
 Q
"RTN","RAMAINU",24,0)
 ;
"RTN","RAMAINU",25,0)
TRKCMB(DA,RACMB4) ;Contrast Medium/Media is used with this procedure.
"RTN","RAMAINU",26,0)
 ;Track the editing of this data. This subroutine saves off the 'before'
"RTN","RAMAINU",27,0)
 ;values in a local variable. The 'before' and 'after' values will be
"RTN","RAMAINU",28,0)
 ;compared. If they differ, then the 'before' value will be filed in
"RTN","RAMAINU",29,0)
 ;the audit log.
"RTN","RAMAINU",30,0)
 ; input: DA=IEN of the Rad/Nuc Med Procedure record
"RTN","RAMAINU",31,0)
 ;output: RACMB4=CM definitions for this procedure before edit
"RTN","RAMAINU",32,0)
 N I S I=0,RACMB4=""
"RTN","RAMAINU",33,0)
 F  S I=$O(^RAMIS(71,DA,"CM",I)) Q:'I  D
"RTN","RAMAINU",34,0)
 .S RACMB4=RACMB4_$P($G(^RAMIS(71,DA,"CM",I,0)),U)
"RTN","RAMAINU",35,0)
 .Q
"RTN","RAMAINU",36,0)
 Q
"RTN","RAMAINU",37,0)
 ;
"RTN","RAMAINU",38,0)
TRK70CMB(RADFN,RADTI,RACNI,RACMB4) ;Contrast Medium/Media is used with
"RTN","RAMAINU",39,0)
 ;this procedure. Track the editing of this data. This subroutine saves
"RTN","RAMAINU",40,0)
 ;off the 'before' values in a local variable. The 'before' and 'after'
"RTN","RAMAINU",41,0)
 ;values will be compared. If they differ, then the 'before' value will
"RTN","RAMAINU",42,0)
 ;be filed in the audit log.
"RTN","RAMAINU",43,0)
 ;input: RADFN=DFN of the Rad/Nuc Med patient (file 2)
"RTN","RAMAINU",44,0)
 ;       RADTI=exam date/time (inverse)
"RTN","RAMAINU",45,0)
 ;       RACNI=ien of exam record (examinations sub-file 70.03)
"RTN","RAMAINU",46,0)
 ;output: RACMB4=CM definitions for this procedure before edit
"RTN","RAMAINU",47,0)
 N I S I=0,RACMB4=""
"RTN","RAMAINU",48,0)
 F  S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",I)) Q:'I  D
"RTN","RAMAINU",49,0)
 .S RACMB4=RACMB4_$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",I,0)),U)
"RTN","RAMAINU",50,0)
 .Q
"RTN","RAMAINU",51,0)
 Q
"RTN","RAMAINU",52,0)
 ;
"RTN","RAMAINU",53,0)
TRKCMA(DA,RATRKCMB,RATRKCMA,RACMDIF) ;Contrast Medium/Media is used with this
"RTN","RAMAINU",54,0)
 ;procedure. Tracks the editing of this data. This subroutine saves
"RTN","RAMAINU",55,0)
 ;off the 'before' values.
"RTN","RAMAINU",56,0)
 ; input: DA=IEN of the Rad/Nuc Med Procedure record
"RTN","RAMAINU",57,0)
 ;        RATRKCMB=CM definitions for this procedure before edit
"RTN","RAMAINU",58,0)
 ;return: RATRKCMA=CM definitions for this procedure after edit
"RTN","RAMAINU",59,0)
 ;        RACMDIF=if before & after CM values differ, set to 1 else 0
"RTN","RAMAINU",60,0)
 N I,J S (I,RACMDIF)=0,RATRKCMA=""
"RTN","RAMAINU",61,0)
 F  S I=$O(^RAMIS(71,DA,"CM",I)) Q:'I  D
"RTN","RAMAINU",62,0)
 .S RATRKCMA=RATRKCMA_$P($G(^RAMIS(71,DA,"CM",I,0)),U)
"RTN","RAMAINU",63,0)
 .Q
"RTN","RAMAINU",64,0)
 ;
"RTN","RAMAINU",65,0)
 ;If the before & after values are null, no CM definitions exist.
"RTN","RAMAINU",66,0)
 I $L(RATRKCMB)=0,$L(RATRKCMA)=0 S RACMDIF=0 Q
"RTN","RAMAINU",67,0)
 ;
"RTN","RAMAINU",68,0)
 ;If the before value is null and the after value is not null file
"RTN","RAMAINU",69,0)
 ;the after value
"RTN","RAMAINU",70,0)
 I $L(RATRKCMB)=0,($L(RATRKCMA)>0) D  Q
"RTN","RAMAINU",71,0)
 .S RACMDIF=1 D FILEAU^RAMAINU1(DA,RATRKCMA)
"RTN","RAMAINU",72,0)
 .Q
"RTN","RAMAINU",73,0)
 ;
"RTN","RAMAINU",74,0)
 ;If the before value is not null and the after value is null file
"RTN","RAMAINU",75,0)
 ;the after value (indicates that CM data has been deleted)
"RTN","RAMAINU",76,0)
 I $L(RATRKCMB)>0,($L(RATRKCMA)=0) D  Q
"RTN","RAMAINU",77,0)
 .S RACMDIF=1 D FILEAU^RAMAINU1(DA,RATRKCMA)
"RTN","RAMAINU",78,0)
 .Q
"RTN","RAMAINU",79,0)
 ;
"RTN","RAMAINU",80,0)
 ;If the before and after values are non-null and the number of
"RTN","RAMAINU",81,0)
 ;characters differ between strings, store the after value and exit.
"RTN","RAMAINU",82,0)
 I $L(RATRKCMB)'=$L(RATRKCMA) S RACMDIF=1 D FILEAU^RAMAINU1(DA,RATRKCMA) Q
"RTN","RAMAINU",83,0)
 ;
"RTN","RAMAINU",84,0)
 ;If the before and after values have definition (non-null) and are of
"RTN","RAMAINU",85,0)
 ;the same length, check to see if they have the same characters in
"RTN","RAMAINU",86,0)
 ;their respective strings (character position not important). Only if
"RTN","RAMAINU",87,0)
 ;characters differ between the two strings do we file the after data.
"RTN","RAMAINU",88,0)
 F I=1:1:$L(RATRKCMB) D  Q:RACMDIF
"RTN","RAMAINU",89,0)
 .S J=$E(RATRKCMB,I) S:RATRKCMA'[J RACMDIF=1
"RTN","RAMAINU",90,0)
 .Q
"RTN","RAMAINU",91,0)
 D:RACMDIF FILEAU^RAMAINU1(DA,RATRKCMA)
"RTN","RAMAINU",92,0)
 Q
"RTN","RAMAINU",93,0)
 ;
"RTN","RAMAINU",94,0)
TRK70CMA(RADFN,RADTI,RACNI,RATRKCMB) ;Contrast Medium/Media is used with
"RTN","RAMAINU",95,0)
 ;this exam.
"RTN","RAMAINU",96,0)
 ;Tracks the editing of this data. This subroutine saves off the
"RTN","RAMAINU",97,0)
 ;'before' values.
"RTN","RAMAINU",98,0)
 ;input: RADFN=DFN of the Rad/Nuc Med patient (file 2)
"RTN","RAMAINU",99,0)
 ;       RADTI=exam date/time (inverse)
"RTN","RAMAINU",100,0)
 ;       RACNI=ien of exam record (examinations sub-file 70.03)
"RTN","RAMAINU",101,0)
 ;       RATRKCMB=the before contrast media definition
"RTN","RAMAINU",102,0)
 N I,J,K S (I,K)=0,RATRKCMA=""
"RTN","RAMAINU",103,0)
 F  S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",I)) Q:'I  D
"RTN","RAMAINU",104,0)
 .S RATRKCMA=RATRKCMA_$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",I,0)),U)
"RTN","RAMAINU",105,0)
 .Q
"RTN","RAMAINU",106,0)
 ;
"RTN","RAMAINU",107,0)
 ;If the before & after values are null, no CM definitions exist.
"RTN","RAMAINU",108,0)
 I $L(RATRKCMB)=0,$L(RATRKCMA)=0 Q
"RTN","RAMAINU",109,0)
 ;
"RTN","RAMAINU",110,0)
 ;If the before value is null and the after value is not null file
"RTN","RAMAINU",111,0)
 ;the after value
"RTN","RAMAINU",112,0)
 I $L(RATRKCMB)=0,($L(RATRKCMA)>0) D AUD70^RAMAINU1(RADFN,RADTI,RACNI,RATRKCMA) Q
"RTN","RAMAINU",113,0)
 ;
"RTN","RAMAINU",114,0)
 ;If the before value is not null and the after value is null file
"RTN","RAMAINU",115,0)
 ;the after value (indicates that CM data has been deleted)
"RTN","RAMAINU",116,0)
 I $L(RATRKCMB)>0,($L(RATRKCMA)=0) D AUD70^RAMAINU1(RADFN,RADTI,RACNI,RATRKCMA) Q
"RTN","RAMAINU",117,0)
 ;
"RTN","RAMAINU",118,0)
 ;If the before and after values are non-null and the number of
"RTN","RAMAINU",119,0)
 ;characters differ between strings, store the after value and exit.
"RTN","RAMAINU",120,0)
 I $L(RATRKCMB)'=$L(RATRKCMA) D AUD70^RAMAINU1(RADFN,RADTI,RACNI,RATRKCMA) Q
"RTN","RAMAINU",121,0)
 ;
"RTN","RAMAINU",122,0)
 ;If the before and after values have definition (non-null) and are of
"RTN","RAMAINU",123,0)
 ;the same length, check to see if they have the same characters in
"RTN","RAMAINU",124,0)
 ;their respective strings (character position not important). Only if
"RTN","RAMAINU",125,0)
 ;characters differ between the two strings do we file the after data.
"RTN","RAMAINU",126,0)
 F I=1:1:$L(RATRKCMB) D  Q:K
"RTN","RAMAINU",127,0)
 .S J=$E(RATRKCMB,I) S:RATRKCMA'[J K=1
"RTN","RAMAINU",128,0)
 .Q
"RTN","RAMAINU",129,0)
 D:K AUD70^RAMAINU1(RADFN,RADTI,RACNI,RATRKCMA)
"RTN","RAMAINU",130,0)
 Q
"RTN","RAMAINU",131,0)
 ;
"RTN","RAMAINU",132,0)
PRGCM(DA) ;Purge contrast media data related to an exam when the user
"RTN","RAMAINU",133,0)
 ;answers 'No' to the 'CONTRAST MEDIA USED?' field (#10) prompt when
"RTN","RAMAINU",134,0)
 ;'CONTRAST MEDIA USED?' is presented to the user by the 'RA EXAM EDIT'
"RTN","RAMAINU",135,0)
 ;& 'RA STATUS CHANGE' input templates.
"RTN","RAMAINU",136,0)
 ;
"RTN","RAMAINU",137,0)
 ;input: DA=expressed as DA(2), DA(1), & DA IENs for file and sub-files
"RTN","RAMAINU",138,0)
 ;returns: placeholder for input template
"RTN","RAMAINU",139,0)
 ;
"RTN","RAMAINU",140,0)
 I +$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0)) D
"RTN","RAMAINU",141,0)
 .W !?3,$C(7),"Deleting contrast media data associated with this exam.",!
"RTN","RAMAINU",142,0)
 .K ^RADPT(DA(2),"DT",DA(1),"P",DA,"CM") ;'B' xrefs deleted too!
"RTN","RAMAINU",143,0)
 .Q
"RTN","RAMAINU",144,0)
 Q "@225"
"RTN","RAMAINU",145,0)
 ;
"RTN","RAMAINU",146,0)
UPXCM(DA,X) ;set the 'CONTRAST MEDIA USED?' (#10) field to 'No' if contrast
"RTN","RAMAINU",147,0)
 ;media data is not associated with this exam.
"RTN","RAMAINU",148,0)
 ;called from the 'RA EXAM EDIT' & 'RA STATUS CHANGE' input templates.
"RTN","RAMAINU",149,0)
 ;
"RTN","RAMAINU",150,0)
 ;input: DA=expressed as DA(2), DA(1), & DA IENs for file and sub-files
"RTN","RAMAINU",151,0)
 ;        X='Y' for 'Yes', 'N' for 'No'
"RTN","RAMAINU",152,0)
 ;
"RTN","RAMAINU",153,0)
 K RASFM S RAIENS=DA_","_DA(1)_","_DA(2)_","
"RTN","RAMAINU",154,0)
 S RASFM(70.03,RAIENS,10)=X D UPDATE^DIE("","RASFM","RAIENS")
"RTN","RAMAINU",155,0)
 K RAIENS,RASFM
"RTN","RAMAINU",156,0)
 Q
"RTN","RAMAINU",157,0)
 ;
"RTN","RAMAINU",158,0)
STUFCM70(DA,RAPRI) ;If the exam record indicates that a contrast medium
"RTN","RAMAINU",159,0)
 ;or media was used, and the exam record does not identify the CM,
"RTN","RAMAINU",160,0)
 ;assume the CM definition of the procedure and stuff the exam
"RTN","RAMAINU",161,0)
 ;record (usually done initially while editing the exam record for the
"RTN","RAMAINU",162,0)
 ;first time).
"RTN","RAMAINU",163,0)
 ;
"RTN","RAMAINU",164,0)
 ;Called from the following input templates:
"RTN","RAMAINU",165,0)
 ; RA EXAM EDIT & RA STATUS CHANGE
"RTN","RAMAINU",166,0)
 ;
"RTN","RAMAINU",167,0)
 ;input: DA array; DA(2)-RADFN, DA(1)-RADTI, & DA-RACNI
"RTN","RAMAINU",168,0)
 ;       RAPRI: IEN of the procedure being performed
"RTN","RAMAINU",169,0)
 ;
"RTN","RAMAINU",170,0)
 N I K RAD3,RAIENS,RASFM
"RTN","RAMAINU",171,0)
 S I=0 F  S I=$O(^RAMIS(71,RAPRI,"CM",I)) Q:'I  D
"RTN","RAMAINU",172,0)
 .S RAD3=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",$C(32)),-1)+1
"RTN","RAMAINU",173,0)
 .S RAIENS="+"_RAD3_","_DA_","_DA(1)_","_DA(2)_","
"RTN","RAMAINU",174,0)
 .S RASFM(70.3225,RAIENS,.01)=$P($G(^RAMIS(71,RAPRI,"CM",I,0)),U)
"RTN","RAMAINU",175,0)
 .D UPDATE^DIE("","RASFM","RAD3") K RAD3,RAIENS,RASFM
"RTN","RAMAINU",176,0)
 .Q
"RTN","RAMAINU",177,0)
 Q
"RTN","RAMAINU",178,0)
 ;
"RTN","RAMAINU1")
0^32^B13645290
"RTN","RAMAINU1",1,0)
RAMAINU1 ;HISC/GJC-Radiology Utility File Maintenance (utility)
"RTN","RAMAINU1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RAMAINU1",3,0)
 ;Note: new routine with the release of RA*5*45
"RTN","RAMAINU1",4,0)
 ;
"RTN","RAMAINU1",5,0)
FILEAU(RAD0,RATRKCMB) ;File the 'when, where, and who' data when the contrast
"RTN","RAMAINU1",6,0)
 ;media definitions for our Rad/Nuc Med Procedure change via an edit.
"RTN","RAMAINU1",7,0)
 ;input: RADA=IEN of the Rad/Nuc Med Procedure record
"RTN","RAMAINU1",8,0)
 ;       RATRKCMB=the before contrast media definition
"RTN","RAMAINU1",9,0)
 S RAD1=$O(^RAMIS(71,RAD0,"AUD",$C(32)),-1)+1
"RTN","RAMAINU1",10,0)
 ;It is important to know when the user purges cm associations
"RTN","RAMAINU1",11,0)
 ;related to a procedure. In this case, we want to audit file to
"RTN","RAMAINU1",12,0)
 ;track subsequent cm purge events ignoring the case when the user
"RTN","RAMAINU1",13,0)
 ;initially associates cm with a procedure.
"RTN","RAMAINU1",14,0)
 I RAD1=1,RATRKCMB="" K RAD1 Q
"RTN","RAMAINU1",15,0)
 S RASFM(71.06,"+"_RAD1_","_RAD0_",",.01)=+$E($$NOW^XLFDT(),1,12)
"RTN","RAMAINU1",16,0)
 S RASFM(71.06,"+"_RAD1_","_RAD0_",",2)=RATRKCMB
"RTN","RAMAINU1",17,0)
 S RASFM(71.06,"+"_RAD1_","_RAD0_",",3)=$G(DUZ)
"RTN","RAMAINU1",18,0)
 D UPDATE^DIE("","RASFM","RAD1") K RAD1,RASFM
"RTN","RAMAINU1",19,0)
 Q
"RTN","RAMAINU1",20,0)
 ;
"RTN","RAMAINU1",21,0)
AUD70(RADFN,RADTI,RACNI,RATRKCMB) ;File the 'when, where, and who' data
"RTN","RAMAINU1",22,0)
 ;when the contrast media definitions for our Rad/Nuc Med exam change
"RTN","RAMAINU1",23,0)
 ;via an edit.
"RTN","RAMAINU1",24,0)
 ;input: RADFN=DFN of the Rad/Nuc Med patient (file 2)
"RTN","RAMAINU1",25,0)
 ;       RADTI=exam date/time (inverse)
"RTN","RAMAINU1",26,0)
 ;       RACNI=ien of exam record (examinations sub-file 70.03)
"RTN","RAMAINU1",27,0)
 ;       RATRKCMB=the before contrast media definition
"RTN","RAMAINU1",28,0)
 S RAD3=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"AUD",$C(32)),-1)+1
"RTN","RAMAINU1",29,0)
 ;It is important to know when the user purges cm associations related
"RTN","RAMAINU1",30,0)
 ;to an exam. In this case, we want to audit file to track subsequent
"RTN","RAMAINU1",31,0)
 ;cm purge events ignoring the case when the user initially associates
"RTN","RAMAINU1",32,0)
 ;cm with an exam.
"RTN","RAMAINU1",33,0)
 I RAD3=1,RATRKCMB="" K RAD3 Q
"RTN","RAMAINU1",34,0)
 S RAIENS="+"_RAD3_","_RACNI_","_RADTI_","_RADFN_","
"RTN","RAMAINU1",35,0)
 S RASFM(70.16,RAIENS,.01)=+$E($$NOW^XLFDT(),1,12)
"RTN","RAMAINU1",36,0)
 S RASFM(70.16,RAIENS,2)=RATRKCMB
"RTN","RAMAINU1",37,0)
 S RASFM(70.16,RAIENS,3)=$G(DUZ)
"RTN","RAMAINU1",38,0)
 D UPDATE^DIE("","RASFM","RAD3") K RAD3,RAIENS,RASFM
"RTN","RAMAINU1",39,0)
 Q
"RTN","RAMAINU1",40,0)
 ;
"RTN","RAMAINU1",41,0)
UPPCM(DA,X) ;Check that if contrast media data is associated with this
"RTN","RAMAINU1",42,0)
 ;procedure that the 'CONTRAST MEDIA USED' (#20) field is set
"RTN","RAMAINU1",43,0)
 ;to 'Yes'. If contrast media data is not associated with this
"RTN","RAMAINU1",44,0)
 ;procedure check that the 'CONTRAST MEDIA USED' field is set
"RTN","RAMAINU1",45,0)
 ;to 'No'. Called immediately after exiting the 'RA PROCEDURE EDIT'
"RTN","RAMAINU1",46,0)
 ;input template in RAMAIN2.
"RTN","RAMAINU1",47,0)
 ;
"RTN","RAMAINU1",48,0)
 ;input: DA=IEN of the record in file 71
"RTN","RAMAINU1",49,0)
 ;        X=the internal value; 'N' - No, 'Y' - Yes, or '@' - delete
"RTN","RAMAINU1",50,0)
 ;
"RTN","RAMAINU1",51,0)
 K RASFM S RASFM(71,DA_",",20)=X
"RTN","RAMAINU1",52,0)
 D UPDATE^DIE("","RASFM") K RASFM
"RTN","RAMAINU1",53,0)
 Q
"RTN","RAMAINU1",54,0)
 ;
"RTN","RAMAINU1",55,0)
CMINTEG(DA,X) ;ensure data consistency between the 'CONTRAST MEDIA USED' &
"RTN","RAMAINU1",56,0)
 ;'CONTRAST MEDIA' fields for file 71.
"RTN","RAMAINU1",57,0)
 ;
"RTN","RAMAINU1",58,0)
 ;input: DA=ien of the record in file 71
"RTN","RAMAINU1",59,0)
 ;        X=zero node of RAD/NUC MED PROCEDURE record
"RTN","RAMAINU1",60,0)
 S RACM471=$O(^RAMIS(71,DA,"CM",0))
"RTN","RAMAINU1",61,0)
 I RACM471,$P(X,U,20)'="Y" D  ;cm assoc, contrast media used 'no'
"RTN","RAMAINU1",62,0)
 .W !!?3,"'"_$E($P(X,U),1,45)_"' has contrast media associations:"
"RTN","RAMAINU1",63,0)
 .S RAI=0 F  S RAI=$O(^RAMIS(71,DA,"CM",RAI)) Q:'RAI  D  ;display CM
"RTN","RAMAINU1",64,0)
 ..S RAI(0)=$G(^RAMIS(71,DA,"CM",RAI,0))
"RTN","RAMAINU1",65,0)
 ..W !?5,$$EXTERNAL^DILFD(71.0125,.01,"",$P(RAI(0),U))
"RTN","RAMAINU1",66,0)
 ..Q
"RTN","RAMAINU1",67,0)
 .W !?3,"Updating the 'CONTRAST MEDIA USED' field to 'Yes'."
"RTN","RAMAINU1",68,0)
 .D UPPCM(DA,"Y") K RAI
"RTN","RAMAINU1",69,0)
 .Q
"RTN","RAMAINU1",70,0)
 I 'RACM471,$P(X,U,20)="Y" D  ;no cm assoc, contrast media used 'yes'
"RTN","RAMAINU1",71,0)
 .W !!?3,"'"_$E($P(X,U),1,45)_"' doesn't have contrast media associations;"
"RTN","RAMAINU1",72,0)
 .W !?3,"updating the 'CONTRAST MEDIA USED' field to 'No'."
"RTN","RAMAINU1",73,0)
 .D UPPCM(DA,"N")
"RTN","RAMAINU1",74,0)
 .Q
"RTN","RAMAINU1",75,0)
 K RACM471 Q
"RTN","RAMAINU1",76,0)
 ;
"RTN","RAMAINU1",77,0)
XCMINTEG(DA) ;ensure data consistency between the 'CONTRAST MEDIA USED' &
"RTN","RAMAINU1",78,0)
 ;'CONTRAST MEDIA' fields for file 70.
"RTN","RAMAINU1",79,0)
 ;
"RTN","RAMAINU1",80,0)
 ;input: DA=ien of the record in file 70 array; DA, DA(1), & DA(2)
"RTN","RAMAINU1",81,0)
 ;
"RTN","RAMAINU1",82,0)
 S RAXCM0=$G(^RADPT(DA(2),"DT",DA(1),"P",DA,0))
"RTN","RAMAINU1",83,0)
 S RAXCMP=$P(RAXCM0,U,2),RAXCMP=$$EXTERNAL^DILFD(70.03,2,"",RAXCMP)
"RTN","RAMAINU1",84,0)
 S RACM470=$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",0))
"RTN","RAMAINU1",85,0)
 I RACM470,$P(RAXCM0,U,10)'="Y" D  ;cm assoc, contrast media used 'no'
"RTN","RAMAINU1",86,0)
 .W !!?3,"'"_$E(RAXCMP,1,45)_"' has contrast media associations:"
"RTN","RAMAINU1",87,0)
 .S RAI=0
"RTN","RAMAINU1",88,0)
 .F  S RAI=$O(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",RAI)) Q:'RAI  D  ;display CM
"RTN","RAMAINU1",89,0)
 ..S RAI(0)=$G(^RADPT(DA(2),"DT",DA(1),"P",DA,"CM",RAI,0))
"RTN","RAMAINU1",90,0)
 ..W !?5,$$EXTERNAL^DILFD(70.3225,.01,"",$P(RAI(0),U))
"RTN","RAMAINU1",91,0)
 ..Q
"RTN","RAMAINU1",92,0)
 .W !?3,"Updating the 'CONTRAST MEDIA USED' field to 'Yes'."
"RTN","RAMAINU1",93,0)
 .D UPXCM^RAMAINU(.DA,"Y") K RAI
"RTN","RAMAINU1",94,0)
 .Q
"RTN","RAMAINU1",95,0)
 I 'RACM470,$P(RAXCM0,U,10)="Y" D  ;no cm assoc, contrast media used 'yes'
"RTN","RAMAINU1",96,0)
 .W !!?3,"'"_$E(RAXCMP,1,45)_"' doesn't have contrast media associations;"
"RTN","RAMAINU1",97,0)
 .W !?3,"updating the 'CONTRAST MEDIA USED' field to 'No'."
"RTN","RAMAINU1",98,0)
 .D UPXCM^RAMAINU(.DA,"N")
"RTN","RAMAINU1",99,0)
 .Q
"RTN","RAMAINU1",100,0)
 K RACM470,RAXCM0,RAXCMP Q
"RTN","RAMAINU1",101,0)
 ;
"RTN","RAO7MFN")
0^15^B40096491
"RTN","RAO7MFN",1,0)
RAO7MFN ;HISC/GJC-Create MFN orderable item update msg ;6/11/97  08:47
"RTN","RAO7MFN",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,6,10,18,45**;Mar 16, 1998
"RTN","RAO7MFN",3,0)
 ;Last midification by SS for P18 JUN 19, 2000
"RTN","RAO7MFN",4,0)
 ;Last modification: 12.16.03 patch 45 Contrast Media by CPT gjc
"RTN","RAO7MFN",5,0)
PROC(RAENALL,RAFILE,RASTAT,RAY) ; Entry point to update a single procedure.
"RTN","RAO7MFN",6,0)
 ; 'RAY'    <> is the same as 'Y' when passed back from DIC after
"RTN","RAO7MFN",7,0)
 ;             lookup on file 71 & file 71.3
"RTN","RAO7MFN",8,0)
 ; 'RAENALL'<> single procedure (0) or whole file update (1) flag
"RTN","RAO7MFN",9,0)
 ; 'RAFILE' <> file # of the file being edited (71 or 71.3)
"RTN","RAO7MFN",10,0)
 ; 'RASTAT' <> Procedure file (71) status: 0 inactive^1 active
"RTN","RAO7MFN",11,0)
 ;             Com. Proc. file (71.3) Seq. # status: 0 inactive^1 active
"RTN","RAO7MFN",12,0)
 ;             1st piece: status before edit, 2nd piece: status after
"RTN","RAO7MFN",13,0)
 ;                        edit.
"RTN","RAO7MFN",14,0)
 ; This entry point can be called from 2^RAMAIN2 or 13^RAMAIN2
"RTN","RAO7MFN",15,0)
 ; This routine assumes that RAVAR is defined as an array or global
"RTN","RAO7MFN",16,0)
 ;  root in which to place the output.
"RTN","RAO7MFN",17,0)
 ;
"RTN","RAO7MFN",18,0)
 Q:'$D(RAY)!('$D(RAFILE))!('$D(RASTAT))!('$D(RAENALL))
"RTN","RAO7MFN",19,0)
 S RAFNUM=71,RAFNAME=$P($G(^DIC(RAFNUM,0)),"^"),RAXIT=0
"RTN","RAO7MFN",20,0)
 S:'$D(RATSTMP) RATSTMP=$$NOW^XLFDT()
"RTN","RAO7MFN",21,0)
 S:'$D(RACNT) RACNT=0 S:'$D(RAINCR) RAINCR="S RACNT=RACNT+1"
"RTN","RAO7MFN",22,0)
 S:'$D(RASUB) RASUB="""RAO7"""
"RTN","RAO7MFN",23,0)
 D:'$D(RAHLFS)!('$D(RAECH)) EN1^RAO7UTL
"RTN","RAO7MFN",24,0)
 I 'RAENALL,('$D(RAVAR)) D
"RTN","RAO7MFN",25,0)
 . S RAVAR="^TMP("_RASUB_","_RATSTMP_","
"RTN","RAO7MFN",26,0)
 . S RAVARBLE="^TMP("_RASUB_","_RATSTMP_")"
"RTN","RAO7MFN",27,0)
 . Q
"RTN","RAO7MFN",28,0)
 I RAFILE=71 D
"RTN","RAO7MFN",29,0)
 . S RA71(0)=$G(^RAMIS(RAFILE,+RAY,0))
"RTN","RAO7MFN",30,0)
 . S RA71("I")=$G(^RAMIS(RAFILE,+RAY,"I"))
"RTN","RAO7MFN",31,0)
 . I $D(^RAMIS(71.3,"B",+RAY)) D
"RTN","RAO7MFN",32,0)
 .. S RA713(0)=$G(^RAMIS(71.3,+$O(^RAMIS(71.3,"B",+RAY,0)),0))
"RTN","RAO7MFN",33,0)
 .. Q
"RTN","RAO7MFN",34,0)
 . Q
"RTN","RAO7MFN",35,0)
 I RAFILE=71.3 D
"RTN","RAO7MFN",36,0)
 . S RA713(0)=$G(^RAMIS(RAFILE,+RAY,0))
"RTN","RAO7MFN",37,0)
 . ; if RA713(0)="" then the common procedure was deleted
"RTN","RAO7MFN",38,0)
 . S RASVIEN=$S(+RA713(0)>0:+RA713(0),1:+$P(RAY,"^",2))
"RTN","RAO7MFN",39,0)
 . S RA71(0)=$G(^RAMIS(71,RASVIEN,0))
"RTN","RAO7MFN",40,0)
 . S RA71("I")=$G(^RAMIS(71,RASVIEN,"I"))
"RTN","RAO7MFN",41,0)
 . K RASVIEN
"RTN","RAO7MFN",42,0)
 . Q
"RTN","RAO7MFN",43,0)
 Q:$$PROCNDE^RAO7UTL(.RA71)  ; Does the Proc. have Proc-Types & I-Types
"RTN","RAO7MFN",44,0)
 I RAFILE=71 D
"RTN","RAO7MFN",45,0)
 .I +$P(RAY,"^",3) D
"RTN","RAO7MFN",46,0)
 ..;new entry, add to master file whether active or inactive
"RTN","RAO7MFN",47,0)
 ..S RAMFE="MAD"
"RTN","RAO7MFN",48,0)
 ..Q
"RTN","RAO7MFN",49,0)
 .I '+$P(RAY,"^",3),(+$P(RASTAT,"^",2)) D
"RTN","RAO7MFN",50,0)
 ..;now active regardless of prior status, update master file
"RTN","RAO7MFN",51,0)
 ..S RAMFE="MUP"
"RTN","RAO7MFN",52,0)
 ..Q
"RTN","RAO7MFN",53,0)
 .I '+$P(RAY,"^",3),('+$P(RASTAT,"^",2)) D
"RTN","RAO7MFN",54,0)
 ..;now inactive regardless of prior status, deactivate master file
"RTN","RAO7MFN",55,0)
 ..S RAMFE="MDC"
"RTN","RAO7MFN",56,0)
 ..Q
"RTN","RAO7MFN",57,0)
 .Q
"RTN","RAO7MFN",58,0)
 ; If RAMFE is still not defined, must be an addition to common orders
"RTN","RAO7MFN",59,0)
 ; 'Update' to OE since procedure is already in their master file
"RTN","RAO7MFN",60,0)
 I RAFILE=71.3 S RAMFE="MUP"
"RTN","RAO7MFN",61,0)
 ;
"RTN","RAO7MFN",62,0)
 ; If parent with no descendents, send deactivate msg even if active
"RTN","RAO7MFN",63,0)
 I $P($G(RA71(0)),"^",6)="P",'$O(^RAMIS(71,$S(RAFILE=71.3:+$P(RAY,"^",2),1:+RAY),4,0)) S RAMFE="MDC"
"RTN","RAO7MFN",64,0)
 ;
"RTN","RAO7MFN",65,0)
 S RACPT(0)=$$NAMCODE^RACPTMSC(+$P(RA71(0),"^",9),DT)
"RTN","RAO7MFN",66,0)
 S:RAFILE=71 RAIEN71=+RAY S:RAFILE=71.3 RAIEN71=+$P(RAY,"^",2)
"RTN","RAO7MFN",67,0)
 S RAXT71=$P(RA71(0),"^")
"RTN","RAO7MFN",68,0)
 S RAIMGAB=$P($G(^RA(79.2,+$P(RA71(0),"^",12),0)),"^",3)
"RTN","RAO7MFN",69,0)
 S RAPHYAP=$S($P(RA71(0),"^",11)="":"","Yy"[$P(RA71(0),"^",11):"Y",1:"N")
"RTN","RAO7MFN",70,0)
 S RACOST=$P(RA71(0),"^",10),RAPRCTY=$P(RA71(0),"^",6)
"RTN","RAO7MFN",71,0)
 S RACMNOR=$S($P($G(RA713(0)),"^",4)]"":"Y",1:"N") ;can't be an active common w/o a seq #
"RTN","RAO7MFN",72,0)
 ;determine CM associations for active & inactive procedures
"RTN","RAO7MFN",73,0)
 S RACMCODE=$$CMEDIA^RAO7UTL(RAIEN71,$P(RA71(0),U,6)) ;ien, proc. type
"RTN","RAO7MFN",74,0)
 S RAINACT=$S(RA71("I")]"":$$HLDATE^HLFNC(RA71("I"),"DT"),1:"")
"RTN","RAO7MFN",75,0)
 I 'RAENALL D
"RTN","RAO7MFN",76,0)
 . X RAINCR
"RTN","RAO7MFN",77,0)
 . S @(RAVAR_RACNT_")")=$$MSH^RAO7UTL("MFN^M01") X RAINCR ;P18 event type
"RTN","RAO7MFN",78,0)
 . D MFI^RAO7UTL("UPD") ;P18
"RTN","RAO7MFN",79,0)
 . Q
"RTN","RAO7MFN",80,0)
 S @(RAVAR_RACNT_")")="MFE"_RAHLFS_RAMFE_RAHLFS_RAHLFS_RAINACT_RAHLFS
"RTN","RAO7MFN",81,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_$P(RACPT(0),"^")
"RTN","RAO7MFN",82,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)
"RTN","RAO7MFN",83,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_$P(RACPT(0),"^",2)
"RTN","RAO7MFN",84,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)_"CPT4"
"RTN","RAO7MFN",85,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)_RAIEN71
"RTN","RAO7MFN",86,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)_RAXT71
"RTN","RAO7MFN",87,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)_"99RAP"
"RTN","RAO7MFN",88,0)
 K RAINACT X RAINCR
"RTN","RAO7MFN",89,0)
 S @(RAVAR_RACNT_")")="ZRA"_RAHLFS_RAIMGAB_RAHLFS_RAPHYAP
"RTN","RAO7MFN",90,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAHLFS_RACOST_RAHLFS
"RTN","RAO7MFN",91,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_$G(RACMCODE)_RAHLFS
"RTN","RAO7MFN",92,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RACMNOR_RAHLFS
"RTN","RAO7MFN",93,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAPRCTY_RAHLFS
"RTN","RAO7MFN",94,0)
 ; Check the synonym (1), message (3) and the Education Description
"RTN","RAO7MFN",95,0)
 ; "EDU" multiples for data
"RTN","RAO7MFN",96,0)
 N I,J,K,RAPMSG S RAPMSG=0
"RTN","RAO7MFN",97,0)
 F RAMULT="^RAMIS(71,"_RAIEN71_",1,","^RAMIS(71,"_RAIEN71_",3,","^RAMIS(71,"_RAIEN71_",""EDU""," D
"RTN","RAO7MFN",98,0)
 . I RAMULT=("^RAMIS(71,"_RAIEN71_",""EDU"","),($$UP^XLFSTR($P(RA71(0),"^",17))'="Y") Q  ; display Ed Descr not set to yes, quit
"RTN","RAO7MFN",99,0)
 . Q:'+$O(@(RAMULT_"0)"))  ; no data for 1 synonym, 3 message, "EDU" desc multiple
"RTN","RAO7MFN",100,0)
 . S (I,J)=0,K=""
"RTN","RAO7MFN",101,0)
 . F  S J=$O(@(RAMULT_J_")")) Q:J'>0  D
"RTN","RAO7MFN",102,0)
 .. S K=$G(@(RAMULT_J_",0)"))
"RTN","RAO7MFN",103,0)
 .. I RAMULT=("^RAMIS(71,"_RAIEN71_",1,") D  Q
"RTN","RAO7MFN",104,0)
 ... X RAINCR S I=I+1
"RTN","RAO7MFN",105,0)
 ... S @(RAVAR_RACNT_")")="ZSY"_RAHLFS_I_RAHLFS_$P(K,"^")
"RTN","RAO7MFN",106,0)
 ... Q
"RTN","RAO7MFN",107,0)
 .. I RAMULT=("^RAMIS(71,"_RAIEN71_",3,") D
"RTN","RAO7MFN",108,0)
 ... X RAINCR S I=I+1,RAPMSG=1
"RTN","RAO7MFN",109,0)
 ... S @(RAVAR_RACNT_")")="NTE"_RAHLFS_I_RAHLFS_RAHLFS_$P($G(^RAMIS(71.4,+K,0)),"^")
"RTN","RAO7MFN",110,0)
 ... Q
"RTN","RAO7MFN",111,0)
 .. I RAMULT=("^RAMIS(71,"_RAIEN71_",""EDU"",") D
"RTN","RAO7MFN",112,0)
 ... I RAPMSG D
"RTN","RAO7MFN",113,0)
 .... X RAINCR S I=I+1
"RTN","RAO7MFN",114,0)
 .... S @(RAVAR_RACNT_")")="NTE"_RAHLFS_I_RAHLFS_RAHLFS_" "
"RTN","RAO7MFN",115,0)
 .... S RAPMSG=0
"RTN","RAO7MFN",116,0)
 .... Q
"RTN","RAO7MFN",117,0)
 ... X RAINCR S I=I+1
"RTN","RAO7MFN",118,0)
 ... S @(RAVAR_RACNT_")")="NTE"_RAHLFS_I_RAHLFS_RAHLFS_K
"RTN","RAO7MFN",119,0)
 ... Q
"RTN","RAO7MFN",120,0)
 .. Q
"RTN","RAO7MFN",121,0)
 . Q
"RTN","RAO7MFN",122,0)
 I 'RAENALL D
"RTN","RAO7MFN",123,0)
 . D MSG^XQOR("RA ORDERABLE ITEM UPDATE",RAVARBLE)
"RTN","RAO7MFN",124,0)
 . D PURGE^RAO7UTL
"RTN","RAO7MFN",125,0)
 . Q
"RTN","RAO7MFN",126,0)
 X:RAENALL RAINCR
"RTN","RAO7MFN",127,0)
 Q
"RTN","RAO7MFN",128,0)
ENALL ; Whole Rad/Nuc Med Procedure file update.  Called only when Rad/Nuc
"RTN","RAO7MFN",129,0)
 ; Med or OE/RR are being installed.
"RTN","RAO7MFN",130,0)
 Q:'$D(XPDNM)  ; quit if not KIDS, xists during pre/post inits
"RTN","RAO7MFN",131,0)
 ; & environment check routines.
"RTN","RAO7MFN",132,0)
 L +^RAMIS(71.3):300 D ^RACOMDEL L -^RAMIS(71.3)
"RTN","RAO7MFN",133,0)
 L +^RAMIS(71):300
"RTN","RAO7MFN",134,0)
 I '$T D  Q
"RTN","RAO7MFN",135,0)
 . N TXT S TXT(1)=" "
"RTN","RAO7MFN",136,0)
 . S TXT(2)="Another user is editing a record in the "
"RTN","RAO7MFN",137,0)
 . S TXT(2)=TXT(2)_$P($G(^DIC(71,0)),"^")
"RTN","RAO7MFN",138,0)
 . S TXT(3)="file.  Try again later!"
"RTN","RAO7MFN",139,0)
 . S XPDQUIT=1 D MES^XPDUTL(.TXT)
"RTN","RAO7MFN",140,0)
 . Q
"RTN","RAO7MFN",141,0)
 N RA,RACNT,RAECH,RAENALL,RAFILE,RAFNAME,RAFNUM,RAHLFS,RAINCR,RASTAT
"RTN","RAO7MFN",142,0)
 N RASUB,RATSTMP,RAVAR,RAXIT,RAY
"RTN","RAO7MFN",143,0)
 S (RA,RACNT)=0,RAENALL=1,RATSTMP=$$NOW^XLFDT(),RAINCR="S RACNT=RACNT+1"
"RTN","RAO7MFN",144,0)
 S RASUB="""RAO7""",RAVAR="^TMP("_RASUB_","_RATSTMP_","
"RTN","RAO7MFN",145,0)
 S RAVARBLE="^TMP("_RASUB_","_RATSTMP_")"
"RTN","RAO7MFN",146,0)
 D EN1^RAO7UTL ; sets up RAECH & RAHLFS
"RTN","RAO7MFN",147,0)
 S (RAFILE,RAFNUM)=71,RAFNAME=$P($G(^DIC(RAFNUM,0)),"^"),RASTAT="0^1"
"RTN","RAO7MFN",148,0)
 X RAINCR S @(RAVAR_RACNT_")")=$$MSH^RAO7UTL("MFN^M01") X RAINCR ;P18 event type
"RTN","RAO7MFN",149,0)
 D MFI^RAO7UTL("REP")
"RTN","RAO7MFN",150,0)
 F  S RA=$O(^RAMIS(71,RA)) Q:RA'>0  D  D PURGE1^RAO7UTL
"RTN","RAO7MFN",151,0)
 . S RA(0)=$G(^RAMIS(71,RA,0)),RA("I")=$G(^RAMIS(71,RA,"I"))
"RTN","RAO7MFN",152,0)
 . Q:$P(RA("I"),"^")]""&($P(RA("I"),"^")'>DT)  ; inactive date present
"RTN","RAO7MFN",153,0)
 . S RAY=RA_"^"_$P(RA(0),"^")_"^"_1 D PROC(RAENALL,RAFILE,RASTAT,RAY)
"RTN","RAO7MFN",154,0)
 . Q
"RTN","RAO7MFN",155,0)
 D EN^ORMFN(RAVARBLE) K @RAVARBLE,RAVARBLE
"RTN","RAO7MFN",156,0)
 L -^RAMIS(71) ; unlock whole file
"RTN","RAO7MFN",157,0)
PARM ;Send Div params for SUBMIT TO prompt and allowing BROAD procedures
"RTN","RAO7MFN",158,0)
 ;to OE3 so they can populate their OE/RR Parameter Instance file
"RTN","RAO7MFN",159,0)
 N DIK S DIK="^RA(79,",DIK(1)=".121^AC1" D ENALL^DIK
"RTN","RAO7MFN",160,0)
 N DIK S DIK="^RA(79,",DIK(1)=".17^AC" D ENALL^DIK
"RTN","RAO7MFN",161,0)
 Q
"RTN","RAO7PC1")
0^18^B25997110
"RTN","RAO7PC1",1,0)
RAO7PC1 ;HISC/GJC,SS-Procedure Call utilities. ;12/9/02  08:41
"RTN","RAO7PC1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,16,18,26,36,45**;Mar 16, 1998
"RTN","RAO7PC1",3,0)
 ;
"RTN","RAO7PC1",4,0)
EN1(RADFN,RABDT,RAEDT,RAEXN,RACINC) ;
"RTN","RAO7PC1",5,0)
 ;
"RTN","RAO7PC1",6,0)
 ; DBIA#2043 - Return list of exams within date range
"RTN","RAO7PC1",7,0)
 ;
"RTN","RAO7PC1",8,0)
 ; ** See routines RAO7PC1A and RAO7PC2 for additional comments **
"RTN","RAO7PC1",9,0)
 ; ** and output node descriptions                              **
"RTN","RAO7PC1",10,0)
 ;
"RTN","RAO7PC1",11,0)
 ; Input: RADFN-> Patient IEN        RABDT-> beginning date
"RTN","RAO7PC1",12,0)
 ;        RAEDT-> ending date        RAEXN-> max # of exams
"RTN","RAO7PC1",13,0)
 ;        RACINC-> include cancelled exams? (1 if yes, default no)
"RTN","RAO7PC1",14,0)
 ;
"RTN","RAO7PC1",15,0)
 ; Output:
"RTN","RAO7PC1",16,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID)=Procedure name^Case number^
"RTN","RAO7PC1",17,0)
 ;       Report status^Abnormal alert flag^Report ien^
"RTN","RAO7PC1",18,0)
 ;       Exam status order #~Exam status name^
"RTN","RAO7PC1",19,0)
 ;       Imaging location name^Imaging type abbr~
"RTN","RAO7PC1",20,0)
 ;       Imaging type name^abnormal results flag^CPT Code
"RTN","RAO7PC1",21,0)
 ;       ^CPRS Order ien^Images exist flag
"RTN","RAO7PC1",22,0)
 ;
"RTN","RAO7PC1",23,0)
 ;if there are one or more CPT modifiers:
"RTN","RAO7PC1",24,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID,"CMOD",n)=CPT Mod^CPT Mod Name
"RTN","RAO7PC1",25,0)
 ;                                         n+1)=CPT Mod^CPT Mod Name
"RTN","RAO7PC1",26,0)
 ;
"RTN","RAO7PC1",27,0)
 ;if CPRS asks to display parent procs, and case is descendent of parent:
"RTN","RAO7PC1",28,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID,"CPRS")=memb of set^parent prc name
"RTN","RAO7PC1",29,0)
 ;
"RTN","RAO7PC1",30,0)
 ; Note: It is possible for the ^TMP global data returned to contain
"RTN","RAO7PC1",31,0)
 ;       'No Report' and a Report file ien for the same exam.  This is
"RTN","RAO7PC1",32,0)
 ;       because Imaging can create a report stub in the Report file,
"RTN","RAO7PC1",33,0)
 ;       but no report interpretation exists and no status is assigned
"RTN","RAO7PC1",34,0)
 ;       to the report record.
"RTN","RAO7PC1",35,0)
 ;
"RTN","RAO7PC1",36,0)
 ; Exam ID: exam date/time (inverse) concatenated with the case IEN
"RTN","RAO7PC1",37,0)
 ; Abnormal alert flag:  Y or blank
"RTN","RAO7PC1",38,0)
 ; Abnormal results flag:  Y or blank, may be turned on even if
"RTN","RAO7PC1",39,0)
 ;     abnormal alert flag is not
"RTN","RAO7PC1",40,0)
 ;
"RTN","RAO7PC1",41,0)
 Q:'RADFN!('RABDT)!('RAEDT)
"RTN","RAO7PC1",42,0)
 N RAEXNP S RAEXNP=RAEXN ;save original value of RAEXN
"RTN","RAO7PC1",43,0)
 ; if last char RAEXNP has "P", then count max no. by parent and 
"RTN","RAO7PC1",44,0)
 ; single, not by individual cases
"RTN","RAO7PC1",45,0)
 S RACINC=+$G(RACINC)
"RTN","RAO7PC1",46,0)
 Q:RABDT>RAEDT  ; quit if ending date before beginning date
"RTN","RAO7PC1",47,0)
 K ^TMP($J,"RAE1") S RAEXN=+$G(RAEXN)
"RTN","RAO7PC1",48,0)
 S:$P(RABDT,".",2) RABDT=RABDT\1 S:$P(RAEDT,".",2) RAEDT=RAEDT\1
"RTN","RAO7PC1",49,0)
 N RABNOR,RACNST,RACNT,RACPT,RACSE,RADIAG,RAIBDT,RAIEDT,RAILOC,RAITY
"RTN","RAO7PC1",50,0)
 N RANO,RAPRC,RAREX,RARPT,RARPTST
"RTN","RAO7PC1",51,0)
 N RAXAM,RAXID,RAXIT,RAXSTAT,RABNORMR,RASHOCAN
"RTN","RAO7PC1",52,0)
 S RACNST=9999999.9999
"RTN","RAO7PC1",53,0)
 S RAIBDT=RACNST-(RAEDT+.9999),RAIEDT=RACNST-(RABDT-.0001)
"RTN","RAO7PC1",54,0)
 S (RACNT,RAXIT)=0
"RTN","RAO7PC1",55,0)
 F  S RAIBDT=$O(^RADPT(RADFN,"DT",RAIBDT)) Q:RAIBDT'>0!(RAIBDT>RAIEDT)  D  Q:RAXIT
"RTN","RAO7PC1",56,0)
 . D SETDATA^RAO7PC1A ; obtain exam data, set ^TMP($J,"RAE1",Patient IEN,Exam ID)
"RTN","RAO7PC1",57,0)
 . Q
"RTN","RAO7PC1",58,0)
 Q
"RTN","RAO7PC1",59,0)
EN2(RADFN) ;
"RTN","RAO7PC1",60,0)
 ;
"RTN","RAO7PC1",61,0)
 ; DBIA#2012 - Return last 7 days of non-cancelled exams
"RTN","RAO7PC1",62,0)
 ;
"RTN","RAO7PC1",63,0)
 ; Input: RADFN-> Patient IEN
"RTN","RAO7PC1",64,0)
 ;
"RTN","RAO7PC1",65,0)
 ; Output:
"RTN","RAO7PC1",66,0)
 ; ^TMP($J,"RAE7",Patient IEN,Exam ID)=procedure name^case number^
"RTN","RAO7PC1",67,0)
 ;       report status^imaging location IEN^imaging location name^
"RTN","RAO7PC1",68,0)
 ;       contrast medium or media used
"RTN","RAO7PC1",69,0)
 ;       Note: Single characters in parenthesis indicate contrast
"RTN","RAO7PC1",70,0)
 ;       involvement: (I)=Iodinated ionic; (N)=Iodinated non-ionic;
"RTN","RAO7PC1",71,0)
 ;        (L)=Gadolinium; (C)=Oral Cholecystographic; (G)=Gastrografin;
"RTN","RAO7PC1",72,0)
 ;        (B)=Barium; (M)=unspecified contrast media
"RTN","RAO7PC1",73,0)
 ;
"RTN","RAO7PC1",74,0)
 ; Exam ID: exam date/time (inverse) concatenated with the case IEN
"RTN","RAO7PC1",75,0)
 ;
"RTN","RAO7PC1",76,0)
 Q:'RADFN  D EN2^RAO7PC1A Q
"RTN","RAO7PC1",77,0)
 ;
"RTN","RAO7PC1",78,0)
EN3(X) ; DBIA#2265 - Return narrative text for exam(s)
"RTN","RAO7PC1",79,0)
 ; Input:
"RTN","RAO7PC1",80,0)
 ; X-> Exam id in one of two forms:
"RTN","RAO7PC1",81,0)
 ;   1) Pat. DFN^inv. exam date^Case IEN
"RTN","RAO7PC1",82,0)
 ;      Retrieves a single report for a single exam
"RTN","RAO7PC1",83,0)
 ;   2) Pat. DFN^inv. exam date^
"RTN","RAO7PC1",84,0)
 ;      Retrieves all reports for a set of exams ordered on one order
"RTN","RAO7PC1",85,0)
 ;
"RTN","RAO7PC1",86,0)
 ; Note:  Input delimiter can be any of the following: ^~\&;-
"RTN","RAO7PC1",87,0)
 ;        a delimiter may be a single space i.e, " "
"RTN","RAO7PC1",88,0)
 ;
"RTN","RAO7PC1",89,0)
 ; Output:
"RTN","RAO7PC1",90,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name)=report status^
"RTN","RAO7PC1",91,0)
 ; abnormal alert flag^CPRS Order ien^amended?
"RTN","RAO7PC1",92,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"D",n)=diagnostic
"RTN","RAO7PC1",93,0)
 ; code (n=1, this is the primary code)
"RTN","RAO7PC1",94,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"H",n)=clin history
"RTN","RAO7PC1",95,0)
 ; (a line of text)
"RTN","RAO7PC1",96,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"I",n)=impression
"RTN","RAO7PC1",97,0)
 ; (a line of text)
"RTN","RAO7PC1",98,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"M",n)=modifier
"RTN","RAO7PC1",99,0)
 ; (external format)
"RTN","RAO7PC1",100,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"P")=primary
"RTN","RAO7PC1",101,0)
 ; interpreting staff IEN^primary interpreting resident IEN^date
"RTN","RAO7PC1",102,0)
 ; report entered
"RTN","RAO7PC1",103,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"R",n)=report
"RTN","RAO7PC1",104,0)
 ; (a line of text)
"RTN","RAO7PC1",105,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"CM",n)=contrast
"RTN","RAO7PC1",106,0)
 ; media used during exam (internal)^contrast media used during exam
"RTN","RAO7PC1",107,0)
 ; (external)
"RTN","RAO7PC1",108,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"V",n)=verifier IEN
"RTN","RAO7PC1",109,0)
 ; ^signature block name
"RTN","RAO7PC1",110,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"TCOM",1)=techno-
"RTN","RAO7PC1",111,0)
 ; logist comment (a line of text)
"RTN","RAO7PC1",112,0)
 ; ^TMP($J,"RAE2",Patient IEN,"PRINT_SET")=null (IFF this is a printset)
"RTN","RAO7PC1",113,0)
 ; ^TMP($J,"RAE2",Patient IEN,"ORD")=name of ordered procedure for
"RTN","RAO7PC1",114,0)
 ;  examsets and printsets
"RTN","RAO7PC1",115,0)
 ; ^TMP($J,"RAE2",Patient IEN,"ORD",case IEN)=name of ordered procedure
"RTN","RAO7PC1",116,0)
 ;  for that case; not part of an examset or printset
"RTN","RAO7PC1",117,0)
 ;
"RTN","RAO7PC1",118,0)
 K RAU,^TMP($J,"RAE2") S RAU=$$DEL(X)
"RTN","RAO7PC1",119,0)
 I RAU="" K RAU Q
"RTN","RAO7PC1",120,0)
 Q:'$P(X,RAU)!('$P(X,RAU,2))  ; Quit if no Pat. DFN -or- no inv. exam DT
"RTN","RAO7PC1",121,0)
 N RACIEN,RADFN,RAINVXDT,RAPSET,Y S RAPSET=0
"RTN","RAO7PC1",122,0)
 S RADFN=$P(X,RAU),RAINVXDT=$P(X,RAU,2),RACIEN=+$P(X,RAU,3)
"RTN","RAO7PC1",123,0)
 K RAU Q:'($D(^RADPT(RADFN,"DT",RAINVXDT,0))#2)
"RTN","RAO7PC1",124,0)
SS I RACIEN D CASE^RAO7PC2(RACIEN) D SVTCOM^RAUTL11(RADFN,RAINVXDT,RACIEN) Q  ;P18 mod by SS
"RTN","RAO7PC1",125,0)
 S Y=0
"RTN","RAO7PC1",126,0)
 F  S Y=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y)) Q:Y'>0  D
"RTN","RAO7PC1",127,0)
 . D CASE^RAO7PC2(Y)
"RTN","RAO7PC1",128,0)
 . D SVTCOM^RAUTL11(RADFN,RAINVXDT,Y) ;P18 save TCOM in ^TMP
"RTN","RAO7PC1",129,0)
 . S RAPSET=0 ;P18 modified 
"RTN","RAO7PC1",130,0)
 . Q
"RTN","RAO7PC1",131,0)
 Q
"RTN","RAO7PC1",132,0)
 ;
"RTN","RAO7PC1",133,0)
EN30(RAOIFN) ; DBIA#2266 - Return narrative text for exam(s). To be used
"RTN","RAO7PC1",134,0)
 ; with the EN3 entry point above.
"RTN","RAO7PC1",135,0)
 ; Input: RAOIFN -> the ien of Rad/Nuc Med Order
"RTN","RAO7PC1",136,0)
 Q:'RAOIFN  ; order passed in as 0 or null
"RTN","RAO7PC1",137,0)
 Q:'$D(^RAO(75.1,RAOIFN,0))  ; no such order
"RTN","RAO7PC1",138,0)
 Q:'$D(^RADPT("AO",RAOIFN))  ; no exam associated with this order
"RTN","RAO7PC1",139,0)
 N RADFN,RADTI,RACNI,RAXSET
"RTN","RAO7PC1",140,0)
 S RADFN=+$O(^RADPT("AO",RAOIFN,0)) Q:'RADFN
"RTN","RAO7PC1",141,0)
 S RADTI=+$O(^RADPT("AO",RAOIFN,RADFN,0)) Q:'RADTI
"RTN","RAO7PC1",142,0)
 S RAXSET=+$P($G(^RADPT(RADFN,"DT",RADTI,0)),"^",5) ; set if RAXSET=1
"RTN","RAO7PC1",143,0)
 I RAXSET D EN3(RADFN_"^"_RADTI_"^") Q  ; exam set, hit EN3 code
"RTN","RAO7PC1",144,0)
 ; the following code is executed for non-exam set examinations
"RTN","RAO7PC1",145,0)
 S RACNI=+$O(^RADPT("AO",RAOIFN,RADFN,RADTI,0)) Q:'RACNI
"RTN","RAO7PC1",146,0)
 D EN3(RADFN_"^"_RADTI_"^"_RACNI)
"RTN","RAO7PC1",147,0)
 Q
"RTN","RAO7PC1",148,0)
EN4(RABBRV,RAARY) ; Return Imaging Locations
"RTN","RAO7PC1",149,0)
 ; Input: RABBRV-> Abbreviation for I-Type    RAARY-> data storage array
"RTN","RAO7PC1",150,0)
 ;
"RTN","RAO7PC1",151,0)
 ; Output:
"RTN","RAO7PC1",152,0)
 ; array name(location IEN)=File 79.1 IEN^File 44 name^division IEN
"RTN","RAO7PC1",153,0)
 ; ^division name
"RTN","RAO7PC1",154,0)
 ;
"RTN","RAO7PC1",155,0)
 Q:RABBRV']""  ; quit no I-Type abbreviation
"RTN","RAO7PC1",156,0)
 Q:RAARY']""  ;  quit no data storage array
"RTN","RAO7PC1",157,0)
 N RADIV,RAITY,RALOC,RAX
"RTN","RAO7PC1",158,0)
 S RAITY=+$O(^RA(79.2,"C",RABBRV,0)) Q:'RAITY
"RTN","RAO7PC1",159,0)
 S RAX=0 F  S RAX=$O(^RA(79.1,"BIMG",RAITY,RAX)) Q:RAX'>0  D
"RTN","RAO7PC1",160,0)
 . S RADIV(79)=$G(^RA(79.1,RAX,"DIV"))
"RTN","RAO7PC1",161,0)
 . S RALOC(0)=$G(^RA(79.1,RAX,0))
"RTN","RAO7PC1",162,0)
 . Q:$P(RALOC(0),"^",19)]""  ;inactive DT present, can't be a future DT
"RTN","RAO7PC1",163,0)
 . S RALOC=$P($G(^SC(+RALOC(0),0)),U)
"RTN","RAO7PC1",164,0)
 . S RALOC=$S(RALOC]"":RALOC,1:"Unknown")
"RTN","RAO7PC1",165,0)
 . S RADIV=+$P($G(^RA(79,+RADIV(79),0)),U),RADIV(4)=$G(^DIC(4,RADIV,0))
"RTN","RAO7PC1",166,0)
 . S RADIV=$S($P(RADIV(4),U)]"":$P(RADIV(4),U),1:"Unknown")
"RTN","RAO7PC1",167,0)
 . S @(RAARY_"("_RAX_")")=RAX_U_RALOC_U_+RADIV(79)_U_RADIV
"RTN","RAO7PC1",168,0)
 . Q
"RTN","RAO7PC1",169,0)
 Q
"RTN","RAO7PC1",170,0)
CASE(RAOIFN,RARRAY) ; Return the case numbers and the total number of
"RTN","RAO7PC1",171,0)
 ; case numbers associated with a particular order.
"RTN","RAO7PC1",172,0)
 ; Input: RAOIFN-order ien (75.1)
"RTN","RAO7PC1",173,0)
 ;        RARRAY-data storage (local array)
"RTN","RAO7PC1",174,0)
 ; Return: RATTL-n^x where n is the number of cases in the array
"RTN","RAO7PC1",175,0)
 ;               x=PRINTSET if a single report covers many cases.
"RTN","RAO7PC1",176,0)
 ;               -1 if error (invalid order ien)
"RTN","RAO7PC1",177,0)
 ;               -2 no registered case to date -OR- case(s) cancelled
"RTN","RAO7PC1",178,0)
 ;               If -1 or -2, second piece of RATTL gives the reason
"RTN","RAO7PC1",179,0)
 ;         RARRAY-local data array, array_name(case #)
"RTN","RAO7PC1",180,0)
 N RATTL S RATTL="" D CASE^RAO7PC1A
"RTN","RAO7PC1",181,0)
 Q RATTL
"RTN","RAO7PC1",182,0)
DEL(X) ; Determine the delimiter used to seperate the data
"RTN","RAO7PC1",183,0)
 ; Input: 'X'-> data seperated by a delimiter (first & second pieces
"RTN","RAO7PC1",184,0)
 ; will follow null)
"RTN","RAO7PC1",185,0)
 N Y,Z
"RTN","RAO7PC1",186,0)
 F Y="^","~","\","&",";","-"," " S Z=$F(X,Y) I +Z Q
"RTN","RAO7PC1",187,0)
 Q $S(+Z>0:Y,1:"") ; pass back the delimiter used, or null if not found
"RTN","RAO7PC1A")
0^9^B39556954
"RTN","RAO7PC1A",1,0)
RAO7PC1A ;HISC/GJC-Procedure Call utilities (cont) ;1/22/03  12:41
"RTN","RAO7PC1A",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,10,26,31,36,45**;Mar 16, 1998
"RTN","RAO7PC1A",3,0)
SETDATA ; Called from within the EN1 subroutine of RAO7PC1
"RTN","RAO7PC1A",4,0)
 ; Sets the ^TMP($J,"RAE1",patient ien,Exam ID) node.
"RTN","RAO7PC1A",5,0)
 ; See EN1^RAO7PC1 for further explanation.
"RTN","RAO7PC1A",6,0)
 ;
"RTN","RAO7PC1A",7,0)
 ; Output (new) :
"RTN","RAO7PC1A",8,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID,"CMOD",1)=cptmod^cptmodname
"RTN","RAO7PC1A",9,0)
 ;                                          ,2)=cptmod^cptmodname
"RTN","RAO7PC1A",10,0)
 N RA,RA1,RA2,RA3
"RTN","RAO7PC1A",11,0)
 S RANO=0,RAREX(0)=$G(^RADPT(RADFN,"DT",RAIBDT,0))
"RTN","RAO7PC1A",12,0)
 S RAITY=+$P(RAREX(0),"^",2),RAILOC=+$P(RAREX(0),"^",4)
"RTN","RAO7PC1A",13,0)
 S RAILOC=$P($G(^SC(+$P($G(^RA(79.1,RAILOC,0)),"^"),0)),"^")
"RTN","RAO7PC1A",14,0)
 S RAITY(0)=$G(^RA(79.2,RAITY,0))
"RTN","RAO7PC1A",15,0)
 F  S RANO=$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO)) Q:RANO'>0  D  Q:RAXIT
"RTN","RAO7PC1A",16,0)
 . S RAXAM(0)=$G(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,0))
"RTN","RAO7PC1A",17,0)
 . Q:RAXAM(0)=""
"RTN","RAO7PC1A",18,0)
 . S RAORDER=+$P(RAXAM(0),"^",11)
"RTN","RAO7PC1A",19,0)
 . ; quit if exam is WAITING and its order status isn't ACTIVE
"RTN","RAO7PC1A",20,0)
 . ; because this means exam hasn't finished being registered
"RTN","RAO7PC1A",21,0)
 . I $P($G(^RA(72,+$P(RAXAM(0),U,3),0)),U,3)=1,$P($G(^RAO(75.1,RAORDER,0)),U,5)'=6 Q
"RTN","RAO7PC1A",22,0)
 . S RAORDER(7)=$P($G(^RAO(75.1,RAORDER,0)),"^",7) ; CPRS order ien
"RTN","RAO7PC1A",23,0)
 . S RAXSTAT=+$P(RAXAM(0),"^",3),RAXSTAT(0)=$G(^RA(72,RAXSTAT,0))
"RTN","RAO7PC1A",24,0)
 . S RAXID=RAIBDT_"-"_RANO
"RTN","RAO7PC1A",25,0)
 . S RACSE=$S($P(RAXAM(0),U)]"":$P(RAXAM(0),U),1:"Unknown")
"RTN","RAO7PC1A",26,0)
 . S RAPRC=$G(^RAMIS(71,+$P(RAXAM(0),U,2),0))
"RTN","RAO7PC1A",27,0)
 . S RACPT=+$P(RAPRC,"^",9) ; pntr to 81
"RTN","RAO7PC1A",28,0)
 . S RACPT=$$NAMCODE^RACPTMSC(RACPT,DT)
"RTN","RAO7PC1A",29,0)
 . S RACPT=$S($P(RACPT,"^",2)]"":$P(RACPT,"^"),1:"")
"RTN","RAO7PC1A",30,0)
 . S RAPRC=$S($P(RAPRC,U)]"":$P(RAPRC,U),1:"Unknown")
"RTN","RAO7PC1A",31,0)
 . ; quit if cancelled exam, and cancelled exams not requested
"RTN","RAO7PC1A",32,0)
 . I ('$G(RACINC)),($P($G(^RA(72,+$P(RAXAM(0),"^",3),0)),"^",3)=0) Q
"RTN","RAO7PC1A",33,0)
 . S RADIAG=+$P(RAXAM(0),U,13),RARPT=+$P(RAXAM(0),U,17)
"RTN","RAO7PC1A",34,0)
 .; E3R 17541, 15507
"RTN","RAO7PC1A",35,0)
 .; if want cancel'd cases returned, and this case is cancelled, then
"RTN","RAO7PC1A",36,0)
 .; also require div param ALLOW RPTS ON CANCELLED CASES? = Y and
"RTN","RAO7PC1A",37,0)
 .; presence of report, else skip this case
"RTN","RAO7PC1A",38,0)
 . I $G(RACINC),($P($G(^RA(72,+$P(RAXAM(0),"^",3),0)),"^",3)=0) D  Q:RASHOCAN=0
"RTN","RAO7PC1A",39,0)
 .. S RASHOCAN=0
"RTN","RAO7PC1A",40,0)
 .. I $P($G(^RA(79,+$P(RAREX(0),"^",3),.1)),"^",22)="Y",RARPT S RASHOCAN=1
"RTN","RAO7PC1A",41,0)
 .. Q
"RTN","RAO7PC1A",42,0)
 . S RABNOR=$$UP^XLFSTR($P($G(^RA(78.3,RADIAG,0)),U,4))
"RTN","RAO7PC1A",43,0)
 . S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC1A",44,0)
 . S RABNORMR=$$UP^XLFSTR($P($G(^RA(78.3,RADIAG,0)),U,3))
"RTN","RAO7PC1A",45,0)
 . S:RABNORMR'="Y" RABNORMR=""
"RTN","RAO7PC1A",46,0)
 . S RARPTST=$P($G(^RARPT(RARPT,0)),U,5)
"RTN","RAO7PC1A",47,0)
 . S RARPTST=$S(RARPTST="V":"Verified",RARPTST="R":"Released/Not verified",RARPTST="D":"Draft",RARPTST="PD":"Problem Draft",1:"No Report")
"RTN","RAO7PC1A",48,0)
 . S ^TMP($J,"RAE1",RADFN,RAXID)=RAPRC_U_RACSE_U_RARPTST_U_RABNOR_U_$S(RARPT=0:"",1:RARPT)_U_$P(RAXSTAT(0),"^",3)_"~"_$P(RAXSTAT(0),"^")_U_RAILOC_U_$P(RAITY(0),"^",3)_"~"_$P(RAITY(0),"^")_U_RABNORMR_U_RACPT_U_$G(RAORDER(7))
"RTN","RAO7PC1A",49,0)
 . S ^TMP($J,"RAE1",RADFN,RAXID)=^TMP($J,"RAE1",RADFN,RAXID)_U_$S($O(^RARPT(RARPT,2005,0)):"Y",1:"N")
"RTN","RAO7PC1A",50,0)
 . D CPTMOD
"RTN","RAO7PC1A",51,0)
 . S RACNT=RACNT+1
"RTN","RAO7PC1A",52,0)
 .;
"RTN","RAO7PC1A",53,0)
 .; Condensed Radiology Display in CPRS GUI:
"RTN","RAO7PC1A",54,0)
 .; subtract from count if counting parent; count only 1 case from printset
"RTN","RAO7PC1A",55,0)
 .; and
"RTN","RAO7PC1A",56,0)
 .; store values of MEMBER OF SET and ordered parent procedure name
"RTN","RAO7PC1A",57,0)
 . I $D(RAEXNP),$E(RAEXNP,$L(RAEXNP))="P" D
"RTN","RAO7PC1A",58,0)
 .. I $P(RAXAM(0),U,25)="2",$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO),-1) S RACNT=RACNT-1
"RTN","RAO7PC1A",59,0)
 .. I $P(RAXAM(0),U,25) D
"RTN","RAO7PC1A",60,0)
 ... S RA3=$S('RAORDER:"",1:$P($G(^RAMIS(71,+$P($G(^RAO(75.1,+RAORDER,0)),U,2),0)),U))
"RTN","RAO7PC1A",61,0)
 ... S RA3=$S(RA3'="":RA3,1:"PARENT PROCEDURE")
"RTN","RAO7PC1A",62,0)
 ... S ^TMP($J,"RAE1",RADFN,RAXID,"CPRS")=$P(RAXAM(0),U,25)_U_RA3
"RTN","RAO7PC1A",63,0)
 ... Q
"RTN","RAO7PC1A",64,0)
 .. Q
"RTN","RAO7PC1A",65,0)
 . S:RACNT=RAEXN RAXIT=1
"RTN","RAO7PC1A",66,0)
 .; Condensed Radiology Display in CPRS GUI:
"RTN","RAO7PC1A",67,0)
 .; do not exit until all cases of printset have been stored
"RTN","RAO7PC1A",68,0)
 . I $D(RAEXNP),$E(RAEXNP,$L(RAEXNP))="P",$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO)) S RAXIT=0
"RTN","RAO7PC1A",69,0)
 . K RAXSTAT,RAORDER
"RTN","RAO7PC1A",70,0)
 . Q
"RTN","RAO7PC1A",71,0)
 K RAILOC,RAITY
"RTN","RAO7PC1A",72,0)
 Q
"RTN","RAO7PC1A",73,0)
CASE ; Return the case numbers and the total number of case numbers
"RTN","RAO7PC1A",74,0)
 ; associated with a particular order.  Called from CASE^RAO7PC1.
"RTN","RAO7PC1A",75,0)
 ; Sets RARRAY(case #)="" for all cases associated with an order.
"RTN","RAO7PC1A",76,0)
 ; Sets first piece of RATTL to the number of cases found for an
"RTN","RAO7PC1A",77,0)
 ; order, and the second piece is PRINTSET if the report covers
"RTN","RAO7PC1A",78,0)
 ; multiple cases.  See CASE^RAO7PC1 for more information.
"RTN","RAO7PC1A",79,0)
 I '$D(^RAO(75.1,RAOIFN,0))#2 S RATTL="-1^invalid order ien" Q
"RTN","RAO7PC1A",80,0)
 I '$D(^RADPT("AO",RAOIFN)) D  Q  ; case has yet to be registered
"RTN","RAO7PC1A",81,0)
 . S RATTL="-2^no case registered to date"
"RTN","RAO7PC1A",82,0)
 . Q
"RTN","RAO7PC1A",83,0)
 N RACNI,RADFN,RADTI,RAEXAM S RADFN=0
"RTN","RAO7PC1A",84,0)
 F  S RADFN=$O(^RADPT("AO",RAOIFN,RADFN)) Q:RADFN'>0  D
"RTN","RAO7PC1A",85,0)
 . S RADTI=0
"RTN","RAO7PC1A",86,0)
 . F  S RADTI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI)) Q:RADTI'>0  D
"RTN","RAO7PC1A",87,0)
 .. S RACNI=0
"RTN","RAO7PC1A",88,0)
 .. F  S RACNI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI,RACNI)) Q:RACNI'>0  D
"RTN","RAO7PC1A",89,0)
 ... S RAEXAM=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAO7PC1A",90,0)
 ... Q:$P($G(^RA(72,+$P(RAEXAM,"^",3),0)),"^",3)=0  ; xam cancelled
"RTN","RAO7PC1A",91,0)
 ... S RATTL=+$G(RATTL)+1,@(RARRAY_"("_+RAEXAM_")")=""
"RTN","RAO7PC1A",92,0)
 ... Q
"RTN","RAO7PC1A",93,0)
 .. Q
"RTN","RAO7PC1A",94,0)
 . Q
"RTN","RAO7PC1A",95,0)
 I 'RATTL S RATTL="-2^cases cancelled" Q
"RTN","RAO7PC1A",96,0)
 S:$P(RAEXAM,"^",25)=2 RATTL=RATTL_"^PRINTSET" ; combined reports
"RTN","RAO7PC1A",97,0)
 Q
"RTN","RAO7PC1A",98,0)
 ;
"RTN","RAO7PC1A",99,0)
EN2 ; IA: 2012, Return last 7 days of non-cancelled exams
"RTN","RAO7PC1A",100,0)
 ; Required: RADFN (valid patient ien) called from EN2^RAO7PC1
"RTN","RAO7PC1A",101,0)
 ; Output:
"RTN","RAO7PC1A",102,0)
 ; ^TMP($J,"RAE7",Patient IEN,Exam ID)=procedure name^case number^
"RTN","RAO7PC1A",103,0)
 ;       report status^imaging location IEN^imaging location name^
"RTN","RAO7PC1A",104,0)
 ;       contrast medium or media used
"RTN","RAO7PC1A",105,0)
 ;       Note: Single characters in parenthesis indicate contrast
"RTN","RAO7PC1A",106,0)
 ;       involvement: (I)=Iodinated ionic; (N)=Iodinated non-ionic;
"RTN","RAO7PC1A",107,0)
 ;        (L)=Gadolinium; (C)=Oral Cholecystographic; (G)=Gastrografin;
"RTN","RAO7PC1A",108,0)
 ;        (B)=Barium; (M)=unspecified contrast media
"RTN","RAO7PC1A",109,0)
 ;
"RTN","RAO7PC1A",110,0)
 ; Exam ID: exam date/time (inverse) concatenated with the case IEN
"RTN","RAO7PC1A",111,0)
 ;
"RTN","RAO7PC1A",112,0)
 Q:'$D(RADFN)  Q:'RADFN  K ^TMP($J,"RAE7")
"RTN","RAO7PC1A",113,0)
 N I,RABDT,RACNST,RACSE,RADT,RAEDT,RAIBDT,RAIEDT,RALOC,RACMEDIA,RANO
"RTN","RAO7PC1A",114,0)
 N RAPRC,RAREX,RARPT,RARPTST,RAXAM,RAXID,RAXSTAT
"RTN","RAO7PC1A",115,0)
 S RADT=$S($D(DT)#2:DT,1:$$DT^XLFDT()),RACNST=9999999.9999
"RTN","RAO7PC1A",116,0)
 S RABDT=$$FMADD^XLFDT(RADT,-7,0,0,0),RAEDT=RADT
"RTN","RAO7PC1A",117,0)
 S RAIBDT=RACNST-(RAEDT+.9999),RAIEDT=RACNST-(RABDT-.0001)
"RTN","RAO7PC1A",118,0)
 F  S RAIBDT=$O(^RADPT(RADFN,"DT",RAIBDT)) Q:RAIBDT'>0!(RAIBDT>RAIEDT)  D
"RTN","RAO7PC1A",119,0)
 . S RANO=0,RAREX(0)=$G(^RADPT(RADFN,"DT",RAIBDT,0))
"RTN","RAO7PC1A",120,0)
 . S RALOC=+$P(RAREX(0),U,4),RALOC(0)=$G(^RA(79.1,RALOC,0))
"RTN","RAO7PC1A",121,0)
 . S RALOC=$P($G(^SC(+RALOC(0),0)),"^")
"RTN","RAO7PC1A",122,0)
 . F  S RANO=$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO)) Q:RANO'>0  D
"RTN","RAO7PC1A",123,0)
 .. S RAXAM(0)=$G(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,0))
"RTN","RAO7PC1A",124,0)
 .. S RAXID=RAIBDT_"-"_RANO
"RTN","RAO7PC1A",125,0)
 .. S RACSE=$S($P(RAXAM(0),U)]"":$P(RAXAM(0),U),1:"Unknown")
"RTN","RAO7PC1A",126,0)
 .. S RAPRC=$G(^RAMIS(71,+$P(RAXAM(0),U,2),0))
"RTN","RAO7PC1A",127,0)
 .. S RAPRC=$S($P(RAPRC,U)]"":$P(RAPRC,U),1:"Unknown")
"RTN","RAO7PC1A",128,0)
 .. Q:$P($G(^RA(72,+$P(RAXAM(0),"^",3),0)),"^",3)=0  ; cancelled xam
"RTN","RAO7PC1A",129,0)
 .. S I=0,RACMEDIA="" F  S I=$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,"CM",I)) Q:'I  S RACMEDIA=RACMEDIA_$P(^(I,0),U) ;RA*5*45
"RTN","RAO7PC1A",130,0)
 .. S RARPT=+$P(RAXAM(0),U,17)
"RTN","RAO7PC1A",131,0)
 .. S RARPTST=$P($G(^RARPT(RARPT,0)),U,5)
"RTN","RAO7PC1A",132,0)
 .. S RARPTST=$S(RARPTST="V":"Verified",RARPTST="R":"Released/Not verified",RARPTST="D":"Draft",RARPTST="PD":"Problem Draft",1:"No Report")
"RTN","RAO7PC1A",133,0)
 .. S ^TMP($J,"RAE7",RADFN,RAXID)=RAPRC_U_RACSE_U_RARPTST_U_+RALOC(0)_U_RALOC_U_RACMEDIA
"RTN","RAO7PC1A",134,0)
 .. Q
"RTN","RAO7PC1A",135,0)
 . Q
"RTN","RAO7PC1A",136,0)
 Q
"RTN","RAO7PC1A",137,0)
CPTMOD ;extract cpt modifiers if any
"RTN","RAO7PC1A",138,0)
 ;RA loop var, RA1 counter, RA2 intermed vars
"RTN","RAO7PC1A",139,0)
 Q:'$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,"CMOD",0))
"RTN","RAO7PC1A",140,0)
 S RA=0,RA1=1
"RTN","RAO7PC1A",141,0)
 F  S RA=$O(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,"CMOD",RA)) Q:'RA  I $D(^(RA,0)) D
"RTN","RAO7PC1A",142,0)
 . S RA2=$P(^RADPT(RADFN,"DT",RAIBDT,"P",RANO,"CMOD",RA,0),"^")
"RTN","RAO7PC1A",143,0)
 . S RA2=$$BASICMOD^RACPTMSC(RA2,+RAREX(0)) Q:+RA2<0
"RTN","RAO7PC1A",144,0)
 . S ^TMP($J,"RAE1",RADFN,RAXID,"CMOD",RA1)=$P(RA2,"^",2)_"^"_$P(RA2,"^",3),RA1=RA1+1
"RTN","RAO7PC1A",145,0)
 Q
"RTN","RAO7PC2")
0^33^B43565991
"RTN","RAO7PC2",1,0)
RAO7PC2 ;HISC/GJC-Part two for Return Narrative (EN3^RAO7PC1);1/17/95 ;9/13/01  10:39
"RTN","RAO7PC2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,11,14,16,22,27,45**;Mar 16, 1998
"RTN","RAO7PC2",3,0)
CASE(Y) ; Retrieve exam data for specified inverse exam date range.
"RTN","RAO7PC2",4,0)
 ; 'Y'-> Exam node IEN
"RTN","RAO7PC2",5,0)
 N RABNOR,RACNT,RAEXAM,RAI,RAIMPRES,RAINCLUD,RAOPRC,RAORD,RAPDIAG
"RTN","RAO7PC2",6,0)
 N RAPIST,RAPIRE,RAPROC,RARDE,RADTI,RACNI,RADUPHX
"RTN","RAO7PC2",7,0)
 N RARPT,RARPTST,RARPTXT,RASBN,RASDIAG,RAVER,RAERRFLG,Z,Z1,Z2
"RTN","RAO7PC2",8,0)
 S RACNT=1
"RTN","RAO7PC2",9,0)
 S RAEXAM(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,0)) Q:RAEXAM(0)']""
"RTN","RAO7PC2",10,0)
 S:$P(RAEXAM(0),"^",25)=2 RAPSET=1
"RTN","RAO7PC2",11,0)
 S:RAPSET=1 ^TMP($J,"RAE2",RADFN,"PRINT_SET")="" ; xam set with same rpt
"RTN","RAO7PC2",12,0)
 S RAPROC(0)=$G(^RAMIS(71,+$P(RAEXAM(0),"^",2),0))
"RTN","RAO7PC2",13,0)
 S RAPROC=$S($P(RAPROC(0),"^")]"":$P(RAPROC(0),"^"),1:"Unknown")
"RTN","RAO7PC2",14,0)
 S RAORD(0)=$G(^RAO(75.1,+$P(RAEXAM(0),"^",11),0))
"RTN","RAO7PC2",15,0)
 S RAORD(7)=$P(RAORD(0),"^",7) ; CPRS order ien
"RTN","RAO7PC2",16,0)
 S RAOPRC(0)=$G(^RAMIS(71,+$P(RAORD(0),"^",2),0))
"RTN","RAO7PC2",17,0)
 S RAOPRC=$S($P(RAOPRC(0),"^")]"":$P(RAOPRC(0),"^"),1:"Unknown")
"RTN","RAO7PC2",18,0)
 S RAPDIAG(0)=$G(^RA(78.3,+$P(RAEXAM(0),"^",13),0))
"RTN","RAO7PC2",19,0)
 S RAPDIAG=$P(RAPDIAG(0),"^"),RARPT=+$P(RAEXAM(0),"^",17)
"RTN","RAO7PC2",20,0)
 S RARPT(0)=$G(^RARPT(RARPT,0)),RARPTST=$P(RARPT(0),"^",5)
"RTN","RAO7PC2",21,0)
 S RARPTST=$S(RARPTST="V":"Verified",RARPTST="R":"Released/Not verified",RARPTST="D":"Draft",RARPTST="PD":"Problem Draft",1:"No Report")
"RTN","RAO7PC2",22,0)
 ; set the following flag variable: RAINCLUD
"RTN","RAO7PC2",23,0)
 ; RAINCLUD=$S(RPT STATUS=verif'd or released/unverif'd:1,1:0)
"RTN","RAO7PC2",24,0)
 S RAINCLUD=$S("RV"[$E(RARPTST):1,1:0)
"RTN","RAO7PC2",25,0)
 I $E(RARPTST)="V",(RAPSET'<0) D
"RTN","RAO7PC2",26,0)
 . S RAVER=$P(RARPT(0),"^",9),RASBN=$P($G(^VA(200,+RAVER,20)),"^",2)
"RTN","RAO7PC2",27,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"V")=RAVER_"^"_RASBN
"RTN","RAO7PC2",28,0)
 . Q
"RTN","RAO7PC2",29,0)
 S RABNOR=$$UP^XLFSTR($P(RAPDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC2",30,0)
 I RAPDIAG]"",(RAINCLUD),(RAPSET'<0) D  ; if diag & verif'd or released/unverif'd & first pass if part of xam set (many xams - one rpt)
"RTN","RAO7PC2",31,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"D",RACNT)=RAPDIAG
"RTN","RAO7PC2",32,0)
 . Q
"RTN","RAO7PC2",33,0)
 ; 1st, get clnhist from file70. 2nd, get addl clnhist form file74
"RTN","RAO7PC2",34,0)
 ; 1st:
"RTN","RAO7PC2",35,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",0)) D
"RTN","RAO7PC2",36,0)
 . N RAI S (RAI,Z)=0
"RTN","RAO7PC2",37,0)
 . F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",Z)) Q:Z'>0  D
"RTN","RAO7PC2",38,0)
 .. S RAI=RAI+1
"RTN","RAO7PC2",39,0)
 .. S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"H",RAI)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",Z,0))
"RTN","RAO7PC2",40,0)
 .. Q
"RTN","RAO7PC2",41,0)
 . Q
"RTN","RAO7PC2",42,0)
 ;2nd:
"RTN","RAO7PC2",43,0)
 S RADTI=RAINVXDT,RACNI=Y D CHKDUPHX^RART1 ;chk if file74 clnhist is dupl
"RTN","RAO7PC2",44,0)
 I 'RADUPHX,$O(^RARPT(RARPT,"H",0)) S Z="H" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",45,0)
 ;
"RTN","RAO7PC2",46,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",0)) D  ; save modifiers
"RTN","RAO7PC2",47,0)
 . N RAI S (RAI,Z)=0
"RTN","RAO7PC2",48,0)
 . F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",Z)) Q:Z'>0  D
"RTN","RAO7PC2",49,0)
 .. S RAI=RAI+1
"RTN","RAO7PC2",50,0)
 .. S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"M",RAI)=$P($G(^RAMIS(71.2,+$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",Z,0)),0)),"^")
"RTN","RAO7PC2",51,0)
 .. Q
"RTN","RAO7PC2",52,0)
 . Q
"RTN","RAO7PC2",53,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",0)),(RAPSET'<0) D
"RTN","RAO7PC2",54,0)
 . S Z=0 F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",Z)) Q:Z'>0  D
"RTN","RAO7PC2",55,0)
 .. S RASDIAG=+$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",Z,0))
"RTN","RAO7PC2",56,0)
 .. S RASDIAG(0)=$G(^RA(78.3,RASDIAG,0)),RASDIAG(1)=$P(RASDIAG(0),"^")
"RTN","RAO7PC2",57,0)
 .. I RASDIAG(1)]"",(RAINCLUD) D
"RTN","RAO7PC2",58,0)
 ... S RACNT=RACNT+1,^TMP($J,"RAE2",RADFN,Y,RAPROC,"D",RACNT)=RASDIAG(1)
"RTN","RAO7PC2",59,0)
 ... I RABNOR'="Y" D
"RTN","RAO7PC2",60,0)
 .... S RABNOR=$$UP^XLFSTR($P(RASDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC2",61,0)
 .... Q
"RTN","RAO7PC2",62,0)
 ... Q
"RTN","RAO7PC2",63,0)
 .. Q
"RTN","RAO7PC2",64,0)
 . Q
"RTN","RAO7PC2",65,0)
 I RAINCLUD,(RAPSET'<0) D
"RTN","RAO7PC2",66,0)
 . I +$O(^RARPT(RARPT,"I",0)) S Z="I" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",67,0)
 . I +$O(^RARPT(RARPT,"R",0)) S Z="R" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",68,0)
 . Q
"RTN","RAO7PC2",69,0)
 I $P(RAEXAM(0),"^",25) S ^TMP($J,"RAE2",RADFN,"ORD")=RAOPRC
"RTN","RAO7PC2",70,0)
 I '$P(RAEXAM(0),"^",25) S ^TMP($J,"RAE2",RADFN,"ORD",Y)=RAOPRC
"RTN","RAO7PC2",71,0)
 ;
"RTN","RAO7PC2",72,0)
 ; Check to see if amended report
"RTN","RAO7PC2",73,0)
 I RAPSET'<0,+$O(^RARPT(RARPT,"ERR",0)) S RAERRFLG="A"
"RTN","RAO7PC2",74,0)
 ;
"RTN","RAO7PC2",75,0)
 S:RAPSET'<0 ^TMP($J,"RAE2",RADFN,Y,RAPROC)=RARPTST_"^"_$G(RABNOR)_"^"_$G(RAORD(7))_"^"_$G(RAERRFLG)
"RTN","RAO7PC2",76,0)
 S:RAPSET<0 ^TMP($J,"RAE2",RADFN,Y,RAPROC)=""
"RTN","RAO7PC2",77,0)
 S:RAPSET=1 RAPSET=-1
"RTN","RAO7PC2",78,0)
 ;
"RTN","RAO7PC2",79,0)
 I RARPTST'="No Report" D
"RTN","RAO7PC2",80,0)
 .; Add Prim Int Staff, Prim Int Resident & Reported Date
"RTN","RAO7PC2",81,0)
 .S RAPIST=$P(RAEXAM(0),"^",15)
"RTN","RAO7PC2",82,0)
 .S RAPIRE=$P(RAEXAM(0),"^",12)
"RTN","RAO7PC2",83,0)
 .S RARDE=$P(RARPT(0),"^",8)
"RTN","RAO7PC2",84,0)
 .S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"P")=RAPIST_"^"_RAPIRE_"^"_RARDE
"RTN","RAO7PC2",85,0)
 ;If contrast media was involved in the exam pass that information.
"RTN","RAO7PC2",86,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",0)) S (RACNT,RAI)=0 D
"RTN","RAO7PC2",87,0)
 .F  S RAI=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",RAI)) Q:'RAI  D
"RTN","RAO7PC2",88,0)
 ..S RACNT=RACNT+1
"RTN","RAO7PC2",89,0)
 ..S RAI(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",RAI,0))
"RTN","RAO7PC2",90,0)
 ..S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"CM",RACNT)=$P(RAI(0),U)_"^"_$$EXTERNAL^DILFD(70.3225,.01,"",$P(RAI(0),U))
"RTN","RAO7PC2",91,0)
 ..Q
"RTN","RAO7PC2",92,0)
 Q
"RTN","RAO7PC2",93,0)
 ;
"RTN","RAO7PC2",94,0)
RPTXT(RARPT,Z) ; Retrieve report text & store in ^TMP
"RTN","RAO7PC2",95,0)
 ; 'RARPT' -> Report IEN
"RTN","RAO7PC2",96,0)
 ; 'Z'     -> "I":Impression Text <> "R":Report Text
"RTN","RAO7PC2",97,0)
 S (Z1,Z2)=0
"RTN","RAO7PC2",98,0)
 ;file 74's "H" nodes are now additional clinical history
"RTN","RAO7PC2",99,0)
 I Z="H" S Z2=$O(^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,""),-1) I $O(^RARPT(RARPT,Z,Z1)) S Z2=Z2+1,^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,Z2)="Additional Clinical History:"
"RTN","RAO7PC2",100,0)
 F  S Z1=$O(^RARPT(RARPT,Z,Z1)) Q:Z1'>0  D
"RTN","RAO7PC2",101,0)
 . S Z1(0)=$G(^RARPT(RARPT,Z,Z1,0)),Z2=Z2+1
"RTN","RAO7PC2",102,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,Z2)=Z1(0)
"RTN","RAO7PC2",103,0)
 . Q
"RTN","RAO7PC2",104,0)
 Q
"RTN","RAO7PC2",105,0)
 ;
"RTN","RAO7PC2",106,0)
CLIN(DFN,PROCLIST) ;Radiology and Clinical Reminders API
"RTN","RAO7PC2",107,0)
 ;
"RTN","RAO7PC2",108,0)
 ; Created by Cameron Taylor March 1999
"RTN","RAO7PC2",109,0)
 ; 
"RTN","RAO7PC2",110,0)
 ; This API recieves a patient and a list of procedures. For each 
"RTN","RAO7PC2",111,0)
 ; Procedure, the details of the last 'complete' procedure and/or the
"RTN","RAO7PC2",112,0)
 ; last 'cancelled' & 'in progress' procedure details and returns them 
"RTN","RAO7PC2",113,0)
 ; in ^TMP($J,"RADPROC"
"RTN","RAO7PC2",114,0)
 N XX,PROC,DATE,STATUS,PROVIDER,EXAM,X,Y,EXAMIEN,RADPTIEN,ORDER,SUCCESS
"RTN","RAO7PC2",115,0)
 ; 
"RTN","RAO7PC2",116,0)
 S DFN=$G(DFN)  ; Patient Name
"RTN","RAO7PC2",117,0)
 S PROCLIST=$G(PROCLIST)  ; List of Procedures (separated by '^')
"RTN","RAO7PC2",118,0)
 K ^TMP($J,"RADPROC")
"RTN","RAO7PC2",119,0)
 ;
"RTN","RAO7PC2",120,0)
 S RADPTIEN=$O(^RADPT("B",DFN,""))
"RTN","RAO7PC2",121,0)
 I (RADPTIEN="")!(RADPTIEN=0) D  Q
"RTN","RAO7PC2",122,0)
 .S ^TMP($J,"RADPROC")="Invalid/Unknown Radiology Patient"
"RTN","RAO7PC2",123,0)
 ;
"RTN","RAO7PC2",124,0)
 F XX=1:1 S PROC=$P(PROCLIST,U,XX) Q:PROC=""  D
"RTN","RAO7PC2",125,0)
 .S SUCCESS=0  ; Quit searching if SUCCESS=3 (comp, canc & in prog)
"RTN","RAO7PC2",126,0)
 .S DATE=0 F  S DATE=$O(^RADPT(RADPTIEN,"DT",DATE)) Q:DATE'?7N1".".N!(SUCCESS=3)  D
"RTN","RAO7PC2",127,0)
 ..S EXAMIEN=0 F  S EXAMIEN=$O(^RADPT(RADPTIEN,"DT",DATE,"P",EXAMIEN)) Q:'EXAMIEN!(SUCCESS=3)  D
"RTN","RAO7PC2",128,0)
 ...S EXAM=$G(^RADPT(RADPTIEN,"DT",DATE,"P",EXAMIEN,0))
"RTN","RAO7PC2",129,0)
 ...Q:$P(EXAM,U,2)'=PROC
"RTN","RAO7PC2",130,0)
 ...;
"RTN","RAO7PC2",131,0)
 ...; Continue, get STATUS and ORDER 
"RTN","RAO7PC2",132,0)
 ...; (0 is cancelled, 1-8 in progress & 9 is COMPLETE)
"RTN","RAO7PC2",133,0)
 ...; (ignore if null)
"RTN","RAO7PC2",134,0)
 ...;
"RTN","RAO7PC2",135,0)
 ...S STATUS=$P(EXAM,U,3)
"RTN","RAO7PC2",136,0)
 ...I STATUS'="" D
"RTN","RAO7PC2",137,0)
 ....S ORDER=$P(^RA(72,STATUS,0),U,3)
"RTN","RAO7PC2",138,0)
 ....S STATUS=$P(^RA(72,STATUS,0),U) ; description
"RTN","RAO7PC2",139,0)
 ...; 
"RTN","RAO7PC2",140,0)
 ...; Only one of each type (ORDER)
"RTN","RAO7PC2",141,0)
 ...;
"RTN","RAO7PC2",142,0)
 ...Q:ORDER=""
"RTN","RAO7PC2",143,0)
 ...I ORDER=0 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"CANCELLED"))  S ORDER="CANCELLED"
"RTN","RAO7PC2",144,0)
 ...I ORDER=9 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"COMPLETE"))  S ORDER="COMPLETE"
"RTN","RAO7PC2",145,0)
 ...I ORDER<9,ORDER>0 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"IN PROGRESS"))  S ORDER="IN PROGRESS"
"RTN","RAO7PC2",146,0)
 ...;
"RTN","RAO7PC2",147,0)
 ...; Now for the PROVIDER. Check PRIMARY INTERPRETING STAFF 
"RTN","RAO7PC2",148,0)
 ...; if none, then default to PRIMARY INTERPRETING RESIDENT.
"RTN","RAO7PC2",149,0)
 ...;
"RTN","RAO7PC2",150,0)
 ...S PROVIDER=$P(EXAM,U,15)
"RTN","RAO7PC2",151,0)
 ...S:PROVIDER="" PROVIDER=$P(EXAM,U,12)
"RTN","RAO7PC2",152,0)
 ...S:PROVIDER'="" PROVIDER=$P($G(^VA(200,PROVIDER,0)),U,1) ; description
"RTN","RAO7PC2",153,0)
 ...;
"RTN","RAO7PC2",154,0)
 ...; Create return info. on ^TMP (1st manipulate DATE)
"RTN","RAO7PC2",155,0)
 ...;
"RTN","RAO7PC2",156,0)
 ...S Y=9999999.9999-DATE
"RTN","RAO7PC2",157,0)
 ...S ^TMP($J,"RADPROC",RADPTIEN,PROC,ORDER)=Y_U_STATUS_U_PROVIDER
"RTN","RAO7PC2",158,0)
 ...S SUCCESS=SUCCESS+1
"RTN","RAO7PC2",159,0)
 .;
"RTN","RAO7PC2",160,0)
 .; Finished searching Patient file. Any Procedures with no activity?
"RTN","RAO7PC2",161,0)
 .;
"RTN","RAO7PC2",162,0)
 .I '$D(^TMP($J,"RADPROC",RADPTIEN,PROC)) S ^TMP($J,"RADPROC",RADPTIEN,PROC,"NONE")=""
"RTN","RAO7PC2",163,0)
 Q
"RTN","RAO7PC2",164,0)
 ;
"RTN","RAO7PC4")
0^28^B39691653
"RTN","RAO7PC4",1,0)
RAO7PC4 ;HISC/SWM-utilities ;11/19/01  10:23
"RTN","RAO7PC4",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**28,32,31,45**;Mar 16, 1998
"RTN","RAO7PC4",3,0)
 Q
"RTN","RAO7PC4",4,0)
EN1 ; api for CPRS notification alert #67
"RTN","RAO7PC4",5,0)
 Q:'$D(XQADATA)
"RTN","RAO7PC4",6,0)
 D SET1 ;  set up ^TMP nodes
"RTN","RAO7PC4",7,0)
 D DISP1 ; convert and display ^TMP nodes
"RTN","RAO7PC4",8,0)
 D KIL1 ;  kill ^TMP nodes
"RTN","RAO7PC4",9,0)
 Q
"RTN","RAO7PC4",10,0)
SET1 N RADFN,RADTI,RACNI,RAPROC1,RAPROC2,RAPHY1,RAPHY2,RAPMOD1,RAPMOD2,RAACNT
"RTN","RAO7PC4",11,0)
 N RAPATNAM,RASSN,RASTR,I,J,RACMU
"RTN","RAO7PC4",12,0)
 S RADFN=$P(XQADATA,"/") ; ien patient
"RTN","RAO7PC4",13,0)
 S RAACNT=0 ; counter
"RTN","RAO7PC4",14,0)
 S RADTI=$P(XQADATA,"/",2) ; inverse date of exam
"RTN","RAO7PC4",15,0)
 S RACNI=$P(XQADATA,"/",3) ; ien case
"RTN","RAO7PC4",16,0)
 S RAPROC1=$P(XQADATA,"/",4) ; ien 71, before
"RTN","RAO7PC4",17,0)
 S RAPROC2=$P(XQADATA,"/",5) ; ien 71, after
"RTN","RAO7PC4",18,0)
 S RAPHY1=$P(XQADATA,"/",6) ; ien 200 requesting physician, before
"RTN","RAO7PC4",19,0)
 S RAPHY2=$P(XQADATA,"/",7) ; ien 200 requesting physician, after
"RTN","RAO7PC4",20,0)
 S RAPMOD1=$P(XQADATA,"/",8) ;string of proc mod iens, before
"RTN","RAO7PC4",21,0)
 S RAPMOD2=$P(XQADATA,"/",9) ;string of proc mod iens, after
"RTN","RAO7PC4",22,0)
 K ^TMP($J,"RAE4")
"RTN","RAO7PC4",23,0)
 Q:'$D(^DPT(RADFN,0))
"RTN","RAO7PC4",24,0)
 S RAPATNAM=$P(^DPT(RADFN,0),"^") S RASSN=$$SSN^RAUTL() S:RASSN="" RASSN="Unkn"
"RTN","RAO7PC4",25,0)
 S RACMU=$S(+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",0))>0:" (CM w/exam)",1:"")
"RTN","RAO7PC4",26,0)
 S ^TMP($J,"RAE4",1)="Imaging Exam for "_RAPATNAM_" ("_RASSN_") changed:"
"RTN","RAO7PC4",27,0)
 I 'RAPROC2,RAPROC1 D
"RTN","RAO7PC4",28,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))=" "
"RTN","RAO7PC4",29,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))="For procedure "_$E($P(^RAMIS(71,RAPROC1,0),"^"),1,53)_RACMU
"RTN","RAO7PC4",30,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))=" "
"RTN","RAO7PC4",31,0)
 I RAPROC2 D
"RTN","RAO7PC4",32,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))=" Procedure changed"
"RTN","RAO7PC4",33,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))="  From: "_$E($P(^RAMIS(71,RAPROC1,0),"^"),1,53)
"RTN","RAO7PC4",34,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))="  To:   "_$E($P(^RAMIS(71,RAPROC2,0),"^"),1,53)_RACMU
"RTN","RAO7PC4",35,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))=""
"RTN","RAO7PC4",36,0)
 I RAPHY2 D
"RTN","RAO7PC4",37,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))=" Requesting Physician changed"
"RTN","RAO7PC4",38,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))="  From: "_$$GET1^DIQ(200,RAPHY1,.01)
"RTN","RAO7PC4",39,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))="  To:   "_$$GET1^DIQ(200,RAPHY2,.01)
"RTN","RAO7PC4",40,0)
 I RAPMOD2!(('RAPMOD2)&(RAPMOD1)) D
"RTN","RAO7PC4",41,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))=" Procedure Modifier changed"
"RTN","RAO7PC4",42,0)
 .S RASTR=""
"RTN","RAO7PC4",43,0)
 .F I=1:1:($L(RAPMOD1)/2) S J=$P(RAPMOD1,",",I) Q:J=""  S RASTR=RASTR_$$GET1^DIQ(71.2,J,.01)_", " Q:$L(RASTR)>240
"RTN","RAO7PC4",44,0)
 .S RASTR=$E(RASTR,1,$L(RASTR)-2) ;rid trailing comma and blank
"RTN","RAO7PC4",45,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))="  From: "_RASTR
"RTN","RAO7PC4",46,0)
 .S RASTR=""
"RTN","RAO7PC4",47,0)
 .F I=1:1:($L(RAPMOD2)/2) S J=$P(RAPMOD2,",",I) Q:J=""  S RASTR=RASTR_$$GET1^DIQ(71.2,J,.01)_", " Q:$L(RASTR)>240
"RTN","RAO7PC4",48,0)
 .S RASTR=$E(RASTR,1,$L(RASTR)-2) ;rid trailing comma
"RTN","RAO7PC4",49,0)
 .S ^TMP($J,"RAE4",$$INCR^RAUTL4(RAACNT))="  To:   "_RASTR
"RTN","RAO7PC4",50,0)
 Q
"RTN","RAO7PC4",51,0)
DISP1 N RARRAY
"RTN","RAO7PC4",52,0)
 MERGE RARRAY=^TMP($J,"RAE4")
"RTN","RAO7PC4",53,0)
 D EN^DDIOL(.RARRAY)
"RTN","RAO7PC4",54,0)
 Q
"RTN","RAO7PC4",55,0)
KIL1 K ^TMP($J,"RAE4")
"RTN","RAO7PC4",56,0)
 Q
"RTN","RAO7PC4",57,0)
 ;
"RTN","RAO7PC4",58,0)
SETALERT ;
"RTN","RAO7PC4",59,0)
 Q:'$D(RASTRING)
"RTN","RAO7PC4",60,0)
 N RAPHY1,RAPHY2,RAPNAM,RAPSSN
"RTN","RAO7PC4",61,0)
 S RADFN=$P(RASTRING,"/") ; ien patient
"RTN","RAO7PC4",62,0)
 S RAPNAM=$$GET1^DIQ(70,+RADFN,.01) S:RAPNAM="" RAPNAM="UNKNOWN"
"RTN","RAO7PC4",63,0)
 S RAPSSN=$$GET1^DIQ(70,+RADFN,.09) S:RAPSSN="" RAPSSN="UNKNOWN"
"RTN","RAO7PC4",64,0)
 S RAPHY1=$P(RASTRING,"/",6) ; ien 200 requesting physician, before
"RTN","RAO7PC4",65,0)
 S RAPHY2=$P(RASTRING,"/",7) ; ien 200 requesting physician, after
"RTN","RAO7PC4",66,0)
 ;
"RTN","RAO7PC4",67,0)
 S XQA(RAPHY1)="",XQAID=$J_","_$H S:$G(RAPHY2)]"" XQA(RAPHY2)=""
"RTN","RAO7PC4",68,0)
 S XQAMSG=$E(RAPNAM,1,9)_" ("_$E(RAPNAM,1)_$E(RAPSSN,6,9)_"): Imaging Exam Changed: "_$S($P(RASTRING,"/",5):"Proc., ",1:"")_$S($P(RASTRING,"/",7):"Rqstr, ",1:"")_$S($P(RASTRING,"/",9):"Proc Mod",1:"")
"RTN","RAO7PC4",69,0)
 S:$E(XQAMSG,($L(XQAMSG)-1))="," XQAMSG=$E(XQAMSG,1,($L(XQAMSG)-2))
"RTN","RAO7PC4",70,0)
 S XQADATA=RASTRING
"RTN","RAO7PC4",71,0)
 S XQAROU="ZZ^RAO7PC4(XQADATA)"
"RTN","RAO7PC4",72,0)
 D SETUP^XQALERT
"RTN","RAO7PC4",73,0)
 Q
"RTN","RAO7PC4",74,0)
 ;
"RTN","RAO7PC4",75,0)
ZZ(RASTRING) ; Additional text for display when processing alert.
"RTN","RAO7PC4",76,0)
 ;
"RTN","RAO7PC4",77,0)
 N RADFN,RADTI,RACMU,RACNI,RAPROC1,RAPROC2,RAPHY1,RAPHY2,RAPMOD1,RAPMOD2
"RTN","RAO7PC4",78,0)
 N RAPNAM,RAPSSN,I,RAPRFR,RAPRTO,RAPHYFR,RAPHYTO,RASTR
"RTN","RAO7PC4",79,0)
 S RADFN=$P(RASTRING,"/") ; ien patient
"RTN","RAO7PC4",80,0)
 S RADTI=$P(RASTRING,"/",2) ; inverse date of exam
"RTN","RAO7PC4",81,0)
 S RACNI=$P(RASTRING,"/",3) ; ien case
"RTN","RAO7PC4",82,0)
 S RAPROC1=$P(RASTRING,"/",4) ; ien 71, before
"RTN","RAO7PC4",83,0)
 S RAPROC2=$P(RASTRING,"/",5) ; ien 71, after
"RTN","RAO7PC4",84,0)
 S RAPHY1=$P(RASTRING,"/",6) ; ien 200 requesting physician, before
"RTN","RAO7PC4",85,0)
 S RAPHY2=$P(RASTRING,"/",7) ; ien 200 requesting physician, after
"RTN","RAO7PC4",86,0)
 S RAPMOD1=$P(RASTRING,"/",8) ;string of proc mod iens, before
"RTN","RAO7PC4",87,0)
 S RAPMOD2=$P(RASTRING,"/",9) ;string of proc mod iens, after
"RTN","RAO7PC4",88,0)
 ;
"RTN","RAO7PC4",89,0)
 S RAPNAM=$$GET1^DIQ(70,+RADFN,.01) S:RAPNAM="" RAPNAM="UNKNOWN"
"RTN","RAO7PC4",90,0)
 S RAPSSN=$$GET1^DIQ(70,+RADFN,.09) S:RAPSSN="" RAPSSN="UNKNOWN"
"RTN","RAO7PC4",91,0)
 D EN^DDIOL("Imaging Exam For "_$E(RAPNAM,1,30)_" ("_RAPSSN_") Changed:",,"!!?4")
"RTN","RAO7PC4",92,0)
 ;
"RTN","RAO7PC4",93,0)
 S RACMU=$S(+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",0))>0:" (CM w/exam)",1:"")
"RTN","RAO7PC4",94,0)
 I 'RAPROC2,RAPROC1 D
"RTN","RAO7PC4",95,0)
 .S RAPRFR=$E($$GET1^DIQ(71,+RAPROC1,.01),1,50) S:RAPRFR="" RAPRFR="UNKNOWN"
"RTN","RAO7PC4",96,0)
 .S RAPRFR=RAPRFR_RACMU D EN^DDIOL("For procedure "_RAPRFR_RACMU,,"!?4")
"RTN","RAO7PC4",97,0)
 .D EN^DDIOL(" ",,"!")
"RTN","RAO7PC4",98,0)
 .Q
"RTN","RAO7PC4",99,0)
 I RAPROC2 D
"RTN","RAO7PC4",100,0)
 .S RAPRFR=$E($$GET1^DIQ(71,+RAPROC1,.01),1,53) S:RAPRFR="" RAPRFR="UNKNOWN"
"RTN","RAO7PC4",101,0)
 .S RAPRTO=$E($$GET1^DIQ(71,+RAPROC2,.01),1,53) S:RAPRTO="" RAPRTO="UNKNOWN"
"RTN","RAO7PC4",102,0)
 .D EN^DDIOL("Procedure changed",,"!?4")
"RTN","RAO7PC4",103,0)
 .D EN^DDIOL("From: "_RAPRFR,,"!?8")
"RTN","RAO7PC4",104,0)
 .D EN^DDIOL("To:   "_RAPRTO_RACMU,,"!?8")
"RTN","RAO7PC4",105,0)
 .Q
"RTN","RAO7PC4",106,0)
 I RAPHY2 D
"RTN","RAO7PC4",107,0)
 .S RAPHYFR=$$GET1^DIQ(200,RAPHY1,.01) S:RAPHYFR="" RAPHYFR="UNKNOWN"
"RTN","RAO7PC4",108,0)
 .S RAPHYTO=$$GET1^DIQ(200,RAPHY2,.01) S:RAPHYTO="" RAPHYTO="UNKNOWN"
"RTN","RAO7PC4",109,0)
 .D EN^DDIOL("Requesting Physician changed",,"!?4")
"RTN","RAO7PC4",110,0)
 .D EN^DDIOL("From: "_RAPHYFR,,"!?8")
"RTN","RAO7PC4",111,0)
 .D EN^DDIOL("To:   "_RAPHYTO,,"!?8")
"RTN","RAO7PC4",112,0)
 .Q
"RTN","RAO7PC4",113,0)
 I RAPMOD2!('(RAPMOD2)&(RAPMOD1)) D
"RTN","RAO7PC4",114,0)
 .D EN^DDIOL("Procedure Modifier changed",,"!?4")
"RTN","RAO7PC4",115,0)
 .S RASTR=""
"RTN","RAO7PC4",116,0)
 .F I=1:1:($L(RAPMOD1)/2) S J=$P(RAPMOD1,",",I) Q:J=""  S RASTR=RASTR_$$GET1^DIQ(71.2,J,.01)_", " Q:$L(RASTR)>240
"RTN","RAO7PC4",117,0)
 .S RASTR=$E(RASTR,1,$L(RASTR)-2) ;rid trailing comma
"RTN","RAO7PC4",118,0)
 .D EN^DDIOL("From: "_RASTR,,"!?8")
"RTN","RAO7PC4",119,0)
 .S RASTR=""
"RTN","RAO7PC4",120,0)
 .F I=1:1:($L(RAPMOD2)/2) S J=$P(RAPMOD2,",",I) Q:J=""  S RASTR=RASTR_$$GET1^DIQ(71.2,J,.01)_", " Q:$L(RASTR)>240
"RTN","RAO7PC4",121,0)
 .S RASTR=$E(RASTR,1,$L(RASTR)-2) ;rid trailing comma
"RTN","RAO7PC4",122,0)
 .D EN^DDIOL("To:   "_RASTR,,"!?8")
"RTN","RAO7PC4",123,0)
 .Q
"RTN","RAO7PC4",124,0)
 Q
"RTN","RAO7PC4",125,0)
 ;
"RTN","RAO7PC4",126,0)
SETNOTIF(RAIEN751) ; called by RAO7XX if patch OR*3.0*112 is installed
"RTN","RAO7PC4",127,0)
 ;so that the CPRS notification system can be used to set the alert
"RTN","RAO7PC4",128,0)
 Q:'$D(RASTRING)
"RTN","RAO7PC4",129,0)
 ;RASTRING is : dfn^invdt^caseien^befproc^aftproc^befphy^aftphy
"RTN","RAO7PC4",130,0)
 ;              ^befpmodA,pmodF,etc^aftpmodF,pmodH,etc
"RTN","RAO7PC4",131,0)
 N RAREQPHY
"RTN","RAO7PC4",132,0)
 S:+$P(RASTRING,"/",6) RAREQPHY(+$P(RASTRING,"/",6))=""
"RTN","RAO7PC4",133,0)
 S:+$P(RASTRING,"/",7) RAREQPHY(+$P(RASTRING,"/",7))=""
"RTN","RAO7PC4",134,0)
 S RAMSG="Imaging Exam Changed: "_$S($P(RASTRING,"/",5):"Proc., ",1:"")_$S($P(RASTRING,"/",7):"Rqstr, ",1:"")_$S($L($P(RASTRING,"/",8,9))>1:"Proc Mod",1:"")
"RTN","RAO7PC4",135,0)
 S:$E(RAMSG,$L(RAMSG)-1)="," RAMSG=$E(RAMSG,1,($L(RAMSG)-2))
"RTN","RAO7PC4",136,0)
 D EN^ORB3(67,+RASTRING,RAIEN751,.RAREQPHY,RAMSG,RASTRING)
"RTN","RAO7PC4",137,0)
 ;ORN mustbe 67,dfn,ienfile75.1,reqphys,messagetitle,string for api
"RTN","RAO7PC4",138,0)
 Q
"RTN","RAO7UTL")
0^3^B24997892
"RTN","RAO7UTL",1,0)
RAO7UTL ;HISC/GJC,SS-Utilities for HL7 messages. ;9/5/97  08:55
"RTN","RAO7UTL",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,45**;Mar 16, 1998
"RTN","RAO7UTL",3,0)
 ;modified by SS JUN 19,2000 for P18
"RTN","RAO7UTL",4,0)
EN1 ; Entry point to define some basic HL7 variables
"RTN","RAO7UTL",5,0)
 N I S RAHLFS="|",RAECH="^~\&"
"RTN","RAO7UTL",6,0)
 S $P(RAHLFS(0),RAHLFS,51)=""
"RTN","RAO7UTL",7,0)
 F I=1:1:$L(RAECH) S RAECH(I)=$E(RAECH,I)
"RTN","RAO7UTL",8,0)
 Q
"RTN","RAO7UTL",9,0)
 ;
"RTN","RAO7UTL",10,0)
CMEDIA(IEN,RAPTYPE) ;Called from RAO7MFN when a procedure is updated
"RTN","RAO7UTL",11,0)
 ;Input: IEN=ien of proc. in file 71
"RTN","RAO7UTL",12,0)
 ;   RAPTYPE=procedure type; broad, parent, series, or detailed.
"RTN","RAO7UTL",13,0)
 ;Return: J=a string with some combination of the following indicators:
"RTN","RAO7UTL",14,0)
 ;I for Iodinated ionic, N for Iodinated non-ionic, L for Gadolinium
"RTN","RAO7UTL",15,0)
 ;C for Oral Cholecystographic, G for Gastrografin, B for Barium or
"RTN","RAO7UTL",16,0)
 ;NULL if none of the indicators apply to this procedure.
"RTN","RAO7UTL",17,0)
 ;
"RTN","RAO7UTL",18,0)
 ;'Broad' procedures have no contrast media definition, return null
"RTN","RAO7UTL",19,0)
 Q:RAPTYPE="B" ""
"RTN","RAO7UTL",20,0)
 ;if 'detailed' or 'series' & no contrast media data return null
"RTN","RAO7UTL",21,0)
 I RAPTYPE'="P",'($O(^RAMIS(71,IEN,"CM",0))) Q ""
"RTN","RAO7UTL",22,0)
 NEW I,INA,J S J=""
"RTN","RAO7UTL",23,0)
 I RAPTYPE="P" D
"RTN","RAO7UTL",24,0)
 .S I=0 F  S I=$O(^RAMIS(71,IEN,4,I)) Q:'I  D
"RTN","RAO7UTL",25,0)
 ..S I(0)=+$G(^RAMIS(71,IEN,4,I,0)) Q:'I(0)
"RTN","RAO7UTL",26,0)
 ..S INA=$P($G(^RAMIS(71,I(0),"I")),"^")
"RTN","RAO7UTL",27,0)
 ..S INA=$S(INA="":1,INA>DT:1,1:0)
"RTN","RAO7UTL",28,0)
 ..D:INA NONPAR(I(0))
"RTN","RAO7UTL",29,0)
 ..Q
"RTN","RAO7UTL",30,0)
 .Q
"RTN","RAO7UTL",31,0)
 E  D NONPAR(IEN)
"RTN","RAO7UTL",32,0)
 Q J
"RTN","RAO7UTL",33,0)
 ;
"RTN","RAO7UTL",34,0)
NONPAR(IEN) ;obtain contrast media data for a 'detailed' or 'series' proc
"RTN","RAO7UTL",35,0)
 ; Input: IEN=ien of the non-parent, non-broad procedure
"RTN","RAO7UTL",36,0)
 ;Return: J=data string (return)
"RTN","RAO7UTL",37,0)
 ;variable definition: I=ien of sub-file rec
"RTN","RAO7UTL",38,0)
 NEW H,I S I=0
"RTN","RAO7UTL",39,0)
 F  S I=$O(^RAMIS(71,IEN,"CM",I)) Q:I'>0  D
"RTN","RAO7UTL",40,0)
 .S H=$P($G(^RAMIS(71,IEN,"CM",I,0)),U) Q:H=""
"RTN","RAO7UTL",41,0)
 .S:J'[H J=J_H
"RTN","RAO7UTL",42,0)
 .Q
"RTN","RAO7UTL",43,0)
 Q
"RTN","RAO7UTL",44,0)
 ;
"RTN","RAO7UTL",45,0)
MSH(X) ; Set up the 'MSH' segment.
"RTN","RAO7UTL",46,0)
 ; 'X' is passed in and identifies the message type.
"RTN","RAO7UTL",47,0)
 S:X']"" X="Message Type Error"
"RTN","RAO7UTL",48,0)
 Q "MSH"_RAHLFS_RAECH_RAHLFS_"RADIOLOGY"_RAHLFS_$P($G(^DIC(4,+$G(DUZ(2)),99)),"^")_$$STR(3)_$$HLDATE^HLFNC($$NOW^XLFDT(),"TS")_$$STR(2)_X
"RTN","RAO7UTL",49,0)
 ;
"RTN","RAO7UTL",50,0)
MSA(X,Y) ; Set up the 'MSA' segment. P18 
"RTN","RAO7UTL",51,0)
 ; 'X' is passed in and identifies the message ID.
"RTN","RAO7UTL",52,0)
 ; 'Y' is acknowledgement code
"RTN","RAO7UTL",53,0)
 S:X']"" X="Message ID Error"
"RTN","RAO7UTL",54,0)
 Q "MSA"_RAHLFS_Y_RAHLFS_$E(X,1,20)_$$STR(4)
"RTN","RAO7UTL",55,0)
MFI(X) ; Set up the 'MFI' segment
"RTN","RAO7UTL",56,0)
 S @(RAVAR_RACNT_")")="MFI"_RAHLFS_RAFNUM
"RTN","RAO7UTL",57,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAECH(1)_RAFNAME_RAECH(1)
"RTN","RAO7UTL",58,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_"99DD"_RAHLFS_RAHLFS_X ;P18
"RTN","RAO7UTL",59,0)
 S @(RAVAR_RACNT_")")=@(RAVAR_RACNT_")")_RAHLFS_RAHLFS_RAHLFS_"ER"
"RTN","RAO7UTL",60,0)
 X RAINCR ; increment counter
"RTN","RAO7UTL",61,0)
 Q
"RTN","RAO7UTL",62,0)
PID(Y) ; Create 'pid' segment
"RTN","RAO7UTL",63,0)
 Q "PID"_$$STR(3)_+$P(Y,"^")_$$STR(2)_$P($G(^DPT(+$P(Y,"^"),0)),"^")
"RTN","RAO7UTL",64,0)
 ;
"RTN","RAO7UTL",65,0)
PV1(Y) ; Create 'pv1' segment
"RTN","RAO7UTL",66,0)
 N DFN,RA,RARMBED,RAWARD,VAIP
"RTN","RAO7UTL",67,0)
 S DFN=+$P(Y,"^"),VAIP("D")=$P(Y,"^",21)
"RTN","RAO7UTL",68,0)
 S RA("PV1",2)="O",RA("PV1",3)=+$P(Y,"^",22)
"RTN","RAO7UTL",69,0)
 D IN5^VADPT S RAWARD=$G(VAIP(5)),RARMBED=$G(VAIP(6))
"RTN","RAO7UTL",70,0)
 I RAWARD]"" D
"RTN","RAO7UTL",71,0)
 . S RA("PV1",2)="I",RAWARD(44)=$P($G(^DIC(42,+RAWARD,44)),"^")
"RTN","RAO7UTL",72,0)
 . S RA("PV1",3)=+RAWARD(44)_U_$P(RARMBED,"^",2)
"RTN","RAO7UTL",73,0)
 . Q
"RTN","RAO7UTL",74,0)
 Q "PV1"_$$STR(2)_RA("PV1",2)_RAHLFS_RA("PV1",3)_$$STR(16) ;_"Visit #" was truncated for P18
"RTN","RAO7UTL",75,0)
 ;
"RTN","RAO7UTL",76,0)
PURGE K RAHLFS,RACNT,RAECH,RAFNAME,RAFNUM,RAINCR,RASUB,RATSTMP,RAVAR,RAXIT
"RTN","RAO7UTL",77,0)
PURGE1 ; kill only whole file update variables
"RTN","RAO7UTL",78,0)
 K RA71,RA713,RACMCODE,RACMNOR,RACOST,RACPT,RAIEN71,RAIMGAB,RAMFE,RAMULT
"RTN","RAO7UTL",79,0)
 K RAPHYAP,RAPRCTY,RAXT71
"RTN","RAO7UTL",80,0)
 Q
"RTN","RAO7UTL",81,0)
DIAG(X,Y,Z) ; Pass back an "A" if any Dx code has 'Yes' in the 'Generate
"RTN","RAO7UTL",82,0)
 ;         Abnormal Alert' field.
"RTN","RAO7UTL",83,0)
 N A,AAH,RA7003,RA783 S AAH=""
"RTN","RAO7UTL",84,0)
 S RA7003=$G(^RADPT(X,"DT",Y,"P",Z,0)),RA7003(13)=+$P(RA7003,"^",13)
"RTN","RAO7UTL",85,0)
 S RA783(0)=$G(^RA(78.3,RA7003(13),0))
"RTN","RAO7UTL",86,0)
 S RA783(4)=$$UP^XLFSTR($P(RA783(0),"^",4))
"RTN","RAO7UTL",87,0)
 S:RA783(4)="Y" AAH="A"
"RTN","RAO7UTL",88,0)
 Q:AAH]"" AAH
"RTN","RAO7UTL",89,0)
 S A=0 F  S A=$O(^RADPT(X,"DT",Y,"P",Z,"DX",A)) Q:A'>0  D  Q:AAH]""
"RTN","RAO7UTL",90,0)
 . S RA783=+$G(^RADPT(X,"DT",Y,"P",Z,"DX",A,0))
"RTN","RAO7UTL",91,0)
 . S RA783(0)=$G(^RA(78.3,RA783,0))
"RTN","RAO7UTL",92,0)
 . S RA783(4)=$$UP^XLFSTR($P(RA783(0),"^",4))
"RTN","RAO7UTL",93,0)
 . I RA783(4)="Y" S AAH="A"
"RTN","RAO7UTL",94,0)
 . Q
"RTN","RAO7UTL",95,0)
 Q AAH
"RTN","RAO7UTL",96,0)
PROCNDE(X) ; Check if the procedure has both an I-Type & Proc. Type
"RTN","RAO7UTL",97,0)
 ;         assigned. Pass back '1' if either the I-Type -or- Proc. Type
"RTN","RAO7UTL",98,0)
 ;         data is missing.  '0' if everything is ok.
"RTN","RAO7UTL",99,0)
 I $P(X(0),U,6)]"",($P(X(0),U,12)]"") Q 0
"RTN","RAO7UTL",100,0)
 Q 1
"RTN","RAO7UTL",101,0)
STR(X) ; Pass back a predetermined # of '|' or other field separator
"RTN","RAO7UTL",102,0)
 Q:$G(RAHLFS(0))']""!(+X=0) "" ; Quit if parent string i.e, 'RAHLFS(0)'
"RTN","RAO7UTL",103,0)
 ;                               does not exist or +X evaluates to null.
"RTN","RAO7UTL",104,0)
 ;
"RTN","RAO7UTL",105,0)
 S:X<0 X=$$ABS^XLFMTH(X) ;       If passed in negative, take absolute
"RTN","RAO7UTL",106,0)
 ;                               value.  Quit if 'X' is greater than the
"RTN","RAO7UTL",107,0)
 ;                               length of our parent string.
"RTN","RAO7UTL",108,0)
 ;
"RTN","RAO7UTL",109,0)
 S:X["." X=X\1 ;                 If a non-integer, remove mantissa.
"RTN","RAO7UTL",110,0)
 ;
"RTN","RAO7UTL",111,0)
 Q:X>($L(RAHLFS(0))) "" ;        If parameter greater than length of
"RTN","RAO7UTL",112,0)
 ;                               string, pass back null.
"RTN","RAO7UTL",113,0)
 Q $E(RAHLFS(0),1,X)
"RTN","RAO7UTL",114,0)
 ;
"RTN","RAO7UTL",115,0)
CHKUSR(RADUZ) ; Check user status to 'DC' an order.
"RTN","RAO7UTL",116,0)
 ; pass back '0' if non-active Rad/Nuc Med user
"RTN","RAO7UTL",117,0)
 ; pass back '1' if active Rad/Nuc Med user
"RTN","RAO7UTL",118,0)
 N RAINADT S RAINADT=+$P($G(^VA(200,RADUZ,"PS")),"^",4) ;inactivation DT
"RTN","RAO7UTL",119,0)
 Q $S('($D(RADUZ)#2):0,'$D(^VA(200,RADUZ,0)):0,'$D(^("RAC")):0,'RAINADT:1,'$D(DT):0,DT'>RAINADT:1,1:0)
"RTN","RAO7UTL",120,0)
 ;
"RTN","RAO7UTL",121,0)
ERR(RATXT,RAMSG,RAVAR) ; Call CPRS utility to log 'soft' errors.
"RTN","RAO7UTL",122,0)
 ; Input: RATXT-text description of the error
"RTN","RAO7UTL",123,0)
 ;        RAMSG-HL7 message array
"RTN","RAO7UTL",124,0)
 ;        RAVAR-variables to be saved off
"RTN","RAO7UTL",125,0)
 D EN^ORERR(RATXT,.RAMSG,.RAVAR)
"RTN","RAO7UTL",126,0)
 Q
"RTN","RAO7UTL",127,0)
 ;
"RTN","RAO7UTL",128,0)
MSG(RAPROTO,RAMSG) ; ship HL7 messages to CPRS from this entry point
"RTN","RAO7UTL",129,0)
 ; input: RAPROTO - protocol to execute
"RTN","RAO7UTL",130,0)
 ;          RAMSG - message (in HL7 format)
"RTN","RAO7UTL",131,0)
 D MSG^XQOR(RAPROTO,.RAMSG)
"RTN","RAO7UTL",132,0)
 Q
"RTN","RAO7UTL",133,0)
 ;
"RTN","RAO7UTL",134,0)
UPDATP(RAY) ;update the parent procedure when a descendent is
"RTN","RAO7UTL",135,0)
 ;updated. Called from RAMAIN2 (procedure entry/edit)
"RTN","RAO7UTL",136,0)
 ;input: RAY=ien of desc.^name of desc. (if existing record)
"RTN","RAO7UTL",137,0)
 ;       RAY=ien of desc.^name of desc.^1 (if new record)
"RTN","RAO7UTL",138,0)
 W !!,$P(RAY,U,2)_" is a descendent procedure, updating parent(s)..."
"RTN","RAO7UTL",139,0)
 N RAPIEN,RAQUIT S (RAPIEN,RAQUIT)=0
"RTN","RAO7UTL",140,0)
 F  S RAPIEN=$O(^RAMIS(71,"ADESC",+RAY,RAPIEN)) Q:'RAPIEN  D  Q:RAQUIT
"RTN","RAO7UTL",141,0)
 .S RAPIEN(0)=$G(^RAMIS(71,RAPIEN,0))
"RTN","RAO7UTL",142,0)
 .W !?2,"Updating parent: "_$E($P(RAPIEN(0),U),1,50)
"RTN","RAO7UTL",143,0)
 .S RAPIEN("I")=$P($G(^RAMIS(71,RAPIEN,"I")),"^")
"RTN","RAO7UTL",144,0)
 .S RAPIEN("S")=$S(RAPIEN("I")="":1,RAPIEN("I")>DT:1,1:0)
"RTN","RAO7UTL",145,0)
 .L +^RAMIS(71,RAPIEN):300
"RTN","RAO7UTL",146,0)
 .I '$T S RAQUIT=1 D  Q
"RTN","RAO7UTL",147,0)
 ..W !?2,"Parent Procedure: "_$E($P(RAPIEN(0),U),1,50)
"RTN","RAO7UTL",148,0)
 ..W !?2,"being edited by another user, try again later!",$C(7)
"RTN","RAO7UTL",149,0)
 ..Q
"RTN","RAO7UTL",150,0)
 .D PROC^RAO7MFN(0,71,RAPIEN("S")_"^"_RAPIEN("S"),RAPIEN)
"RTN","RAO7UTL",151,0)
 .L -^RAMIS(71,RAPIEN)
"RTN","RAO7UTL",152,0)
 .Q
"RTN","RAO7UTL",153,0)
 Q
"RTN","RAO7UTL",154,0)
 ;
"RTN","RAORD1")
0^10^B41078286
"RTN","RAORD1",1,0)
RAORD1 ;HISC/CAH,FPT,GJC AISC/RMO-Request An Exam ;3/13/98  12:16
"RTN","RAORD1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,45**;Mar 16, 1998
"RTN","RAORD1",3,0)
 S RAPKG="" N RAPTLKUP,RAGMTS
"RTN","RAORD1",4,0)
 G ADDORD:$D(RAVSTFLG)&($D(RALIFN))&($D(RAPIFN))
"RTN","RAORD1",5,0)
 I '$D(RAREGFLG),'$D(RAVSTFLG) N RAPTLOCK K RAWARD D  G:'RAPTLKUP Q
"RTN","RAORD1",6,0)
PAT . S DIC="^DPT(",DIC(0)="AEMQ" W ! D ^DIC K DIC
"RTN","RAORD1",7,0)
 . I Y<0 S RAPTLKUP=0 Q
"RTN","RAORD1",8,0)
 . I $$ORVR^RAORDU()'<3 D  G:'RAPTLOCK PAT
"RTN","RAORD1",9,0)
 .. S RAPTLOCK=$$LK^RAUTL19(+Y_";DPT(")
"RTN","RAORD1",10,0)
 .. Q
"RTN","RAORD1",11,0)
 . S (DFN,RADFN)=+Y,(VA200,RAPTLKUP)=1
"RTN","RAORD1",12,0)
 . W ! D IN5^VADPT S:VAIP(1) RAWARD=$P(VAIP(5),"^",2)
"RTN","RAORD1",13,0)
 . Q
"RTN","RAORD1",14,0)
PL S DIC("A")="Patient Location: ",DIC("B")=$S($D(RAWARD):RAWARD,1:""),DIC="^SC(",DIC(0)="AEMQ",DIC("S")="I $$SCREEN^RAORD1A()"
"RTN","RAORD1",15,0)
 D ^DIC K DIC K:'$D(RAREGFLG) RAWARD G Q:Y<0 S RALIFN=+Y
"RTN","RAORD1",16,0)
 S DIC("A")="Person Requesting Order: ",DIC("S")="I $S('$D(^(""PS"")):1,'$P(^(""PS""),U,4):1,DT'>$P(^(""PS""),U,4):1,1:0)&($D(^XUSEC(""PROVIDER"",Y)))",DIC="^VA(200,",DIC(0)="AEMQ" S:$D(^XUSEC("PROVIDER",DUZ)) DIC("B")=$P(^VA(200,DUZ,0),"^",1)
"RTN","RAORD1",17,0)
 D ^DIC K DIC G Q:Y<0 S RAPIFN=+Y K DD,DO,VA200,VAERR,VAIP G ADDORD:$D(RAVSTFLG)
"RTN","RAORD1",18,0)
 ;
"RTN","RAORD1",19,0)
ENADD ;OE/RR Entry Point for the ACTION Option
"RTN","RAORD1",20,0)
 K ORSTOP,ORTO,ORCOST,ORPURG
"RTN","RAORD1",21,0)
 I '$D(RAPKG) G Q:'$D(ORVP)!('$D(ORL))!('$D(ORNP)) S (DFN,RADFN)=+ORVP,RALIFN=+ORL,RAPIFN=$S(+ORNP:+ORNP,$D(RAPIFN):RAPIFN,1:+ORNP),RAFOERR=""
"RTN","RAORD1",22,0)
 ; RAFOERR is used as a flag to track when a user enters this option
"RTN","RAORD1",23,0)
 ; from OE/RR (frontdoor).  If this variable exists when a request is
"RTN","RAORD1",24,0)
 ; being printed, exam information is omitted from the request.
"RTN","RAORD1",25,0)
 S RANME=^DPT(RADFN,0),RASEX=$P(RANME,"^",2),RANME=$P(RANME,"^") D EXAM^RADEM1:'$D(RAREGFLG)&($D(RAPKG)) I '$D(RAREGFLG) S VA200=1 D IN5^VADPT S:VAIP(1) RAWARD=$P(VAIP(5),"^",2)
"RTN","RAORD1",26,0)
 D SAVE ; save off original value of RAMDV!
"RTN","RAORD1",27,0)
 S RAL0=$S($D(^SC(RALIFN,0)):^(0),1:0)
"RTN","RAORD1",28,0)
 S RADIV=+$$SITE^VASITE(DT,+$P(RAL0,"^",15)) S:RADIV<0 RADIV=0
"RTN","RAORD1",29,0)
 S RADIV=$S($D(^RA(79,RADIV,0)):RADIV,1:$O(^RA(79,0)))
"RTN","RAORD1",30,0)
 S RAMDV=$TR($G(^RA(79,+RADIV,.1)),"YyNn","1100")
"RTN","RAORD1",31,0)
 S RACAT=$S($D(RACAT):RACAT,$D(RAWARD):"INPATIENT",$P(RAL0,"^",2)="PERSONNEL HEALTH":"EMPLOYEE",'$D(^RADPT(RADFN,0)):"OUTPATIENT",$P(^(0),"^",4)]"":$P($P(^DD(70,.04,0),$P(^RADPT(RADFN,0),"^",4)_":",2),";"),1:"OUTPATIENT")
"RTN","RAORD1",32,0)
 I "IO"[$E(RACAT,1) D
"RTN","RAORD1",33,0)
 . S RASTRNG=$$MATCH^RAORD1A(RACAT,RALIFN)
"RTN","RAORD1",34,0)
 . ;if necessary, change category of exam to match type of requesting
"RTN","RAORD1",35,0)
 . ;location and display msg to user
"RTN","RAORD1",36,0)
 . S RACAT=$P(RASTRNG,"^"),RAWARD=$P(RASTRNG,"^",2)
"RTN","RAORD1",37,0)
 . Q
"RTN","RAORD1",38,0)
 K:$D(RAWARD)&($E(RACAT,1)="O") RAWARD
"RTN","RAORD1",39,0)
 K RASTRNG
"RTN","RAORD1",40,0)
 ; clear clin hist if:
"RTN","RAORD1",41,0)
 ;   rad backdoor, or
"RTN","RAORD1",42,0)
 ;   oe/rr's first order (quick or not)
"RTN","RAORD1",43,0)
 I $D(RAPKG) K ^TMP($J,"RAWP")
"RTN","RAORD1",44,0)
 I '$D(RAPKG),$G(XQORS)>1,$G(^TMP("XQORS",$J,XQORS-1,"ITM"))=1 K ^TMP($J,"RAWP")
"RTN","RAORD1",45,0)
 ;
"RTN","RAORD1",46,0)
ADDORD I $D(RADR1) D ALLERGY,CREATE1 G Q
"RTN","RAORD1",47,0)
 ; Set flag variable 'RASTOP' to track if procedure messages (if any)
"RTN","RAORD1",48,0)
 ; have been displayed.  Value altered in EN2+1^RAPRI & DISP+12^RAORDU1.
"RTN","RAORD1",49,0)
 D DISP^RAPRI G:RAIMGTYI'>0 Q
"RTN","RAORD1",50,0)
ADDORD1 W !,"Select Procedure",$S(RACNT:" (1-"_RACNT_") ",1:" "),"or enter '?' for help: "
"RTN","RAORD1",51,0)
 R RARX:DTIME
"RTN","RAORD1",52,0)
 S:'$T RARX="^" G Q:RARX=""!($E(RARX)="^")
"RTN","RAORD1",53,0)
 S:RARX=" " RARX=$S($D(RASX):RASX,1:RARX)
"RTN","RAORD1",54,0)
 I $E(RARX)="?"!(RARX=0)!(RARX=" ")!(RARX?.E1N1"-"1N.E)!(RARX?.E1".".E) D HELP^RAPRI G Q:Y'=1 D DISP1^RAPRI G ADDORD1
"RTN","RAORD1",55,0)
 S RAEXMUL=1 K RAHSMULT
"RTN","RAORD1",56,0)
 F RAJ=1:1 S X=$P(RARX,",",RAJ) Q:X=""  S RASTOP=0 W !!!,"Processing procedure: ",$S(+X&(+X'>RACNT):$P($G(RAPRC(X)),"^"),$E(X)'="`":X,1:"") D LOOKUP^RAPRI Q:$D(RAOUT)  S:RAPRI>0 RASX="`"_RAPRI D:RAPRI>0 ALLERGY,CREATE Q:$D(RAOUT)  K RAPRI
"RTN","RAORD1",57,0)
 I $D(RAREASK),'$D(RAOUT) K RAREASK D DISP1^RAPRI G ADDORD1
"RTN","RAORD1",58,0)
Q ; Kill, unlock if locked, and quit
"RTN","RAORD1",59,0)
 D KILL^RAORD
"RTN","RAORD1",60,0)
 D SAVE ; reset RAMDV to its original value!
"RTN","RAORD1",61,0)
 I $$ORVR^RAORDU()'<3,(+$G(RAPTLOCK)),(+$G(RADFN)) D
"RTN","RAORD1",62,0)
 . D ULK^RAUTL19(RADFN_";DPT(")
"RTN","RAORD1",63,0)
 K:'$D(RAREGFLG)&('$D(RAVSTFLG)) RACAT,RADFN,RANME,RAWARD
"RTN","RAORD1",64,0)
 I '$D(RAPKG) K RAMDIV,RAMDV,RAMLC
"RTN","RAORD1",65,0)
 I $D(RAPKG) K ORIFN,ORIT,ORL,ORNP,ORNS,ORPCL,ORPK,ORPV,ORPURG,ORSTS,ORTX,ORVP,RAPKG
"RTN","RAORD1",66,0)
 K RAHSMULT,RAPOP,RAIMAG,RAREQLOC
"RTN","RAORD1",67,0)
 K C,DI,DIG,DIH,DISYS,DIU,DIW,DIWF,DIWL,DIWR,DIWT,DN,I,ORCHART,POP,RAMDVZZ,RASCI,RASERIES
"RTN","RAORD1",68,0)
 Q
"RTN","RAORD1",69,0)
CREATE S RACT=0 D MODS Q:$D(RAOUT)
"RTN","RAORD1",70,0)
CREATE1 S RAWHEN=$$DESDT^RAUTL12(RAPRI) Q:$D(RAOUT)
"RTN","RAORD1",71,0)
 ; Ask pregnant if age is between 12 & 55.  Ask once for mult requests
"RTN","RAORD1",72,0)
 ; RASKPREG is the variable used to track if the pregnant prompt has
"RTN","RAORD1",73,0)
 ; been asked.  Ask only once for multiple requests.
"RTN","RAORD1",74,0)
 S:'$D(RASKPREG) RAPREG=$$PREG^RAORD1A(RADFN,$G(DT)),RASKPREG="" Q:$D(RAOUT)
"RTN","RAORD1",75,0)
 D CH^RAUTL5 Q:$D(RAOUT)  I '$D(RADR1) D DISP^RAORDU1 Q:$D(RAOUT)
"RTN","RAORD1",76,0)
 S X=RADFN,DIC="^RAO(75.1,",DIC(0)="L",DLAYGO=75.1 D FILE^DICN K DIC Q:Y<0  S RAOIFN=+Y K DLAYGO
"RTN","RAORD1",77,0)
 I $D(RAREGFLG)!($D(RAVSTFLG)) S RANUM=$S('$D(RANUM):1,1:RANUM+1),RAORDS(RANUM)=RAOIFN
"RTN","RAORD1",78,0)
 I $D(^RA(79,+RADIV,.1)),$P(^(.1),"^",21)="y" S RALOCFLG=""
"RTN","RAORD1",79,0)
 W ! S DA=RAOIFN,DIE="^RAO(75.1,",DIE("NO^")="OUTOK",DR=$S($D(RADR1):"[RA QUICK EXAM ORDER]",$D(RADR2):"[RA ORDER EXAM]",$D(RAEXMUL)&($D(RAFIN1)):"[RA QUICK EXAM ORDER]",1:"[RA ORDER EXAM]") D ^DIE K DIE("NO^"),DE,DQ,DIE,DR,RADR1,RADR2
"RTN","RAORD1",80,0)
 I $D(RAFIN),$D(^RAO(75.1,RAOIFN,0)) S RAORD0=^(0) D SETORD^RAORDU D OERR^RAORDU:'$D(RAPKG) D ^RAORDQ:$D(RAPKG) K RAORD0
"RTN","RAORD1",81,0)
 I '$D(RAFIN) W !?3,$C(7),"Request not complete. Must Delete..." S DA=RAOIFN,DIK="^RAO(75.1," D ^DIK W "...deletion complete!" I $D(RAREGFLG)!($D(RAVSTFLG)) K RAORDS(RANUM)
"RTN","RAORD1",82,0)
 I '$D(RAFIN),('$D(^RAO(75.1,RAOIFN,0))#2) Q  ; record deleted!
"RTN","RAORD1",83,0)
 K RAFIN
"RTN","RAORD1",84,0)
 ; check if the 'stat' or 'urgent' alert is to be sent.
"RTN","RAORD1",85,0)
 N RALOC,RAORD0
"RTN","RAORD1",86,0)
 S RAORD0=$G(^RAO(75.1,RAOIFN,0)),RALOC=+$P(RAORD0,"^",20)
"RTN","RAORD1",87,0)
 Q:'RALOC  ; if no 'SUBMIT TO' location, can't send stat/urgent alerts
"RTN","RAORD1",88,0)
 I $P(RAORD0,"^",6)=1!(($P(RAORD0,"^",6)=2)&($P(^RA(79.1,RALOC,0),"^",20)="Y")) D
"RTN","RAORD1",89,0)
 . ; If 6th piece of RAORD0=1 *stat*, =2 *urgent*
"RTN","RAORD1",90,0)
 . Q:$$ORVR^RAORDU()<3
"RTN","RAORD1",91,0)
 . ; needs OE/RR 3.0 or greater for stat/urgent alerts to fire
"RTN","RAORD1",92,0)
 . D OENO^RAUTL19(RAOIFN)
"RTN","RAORD1",93,0)
 . Q
"RTN","RAORD1",94,0)
 Q
"RTN","RAORD1",95,0)
 ;
"RTN","RAORD1",96,0)
MODS ;RAPRI= Procedure IEN, RAIMAG=Imaging Type for the procedure.
"RTN","RAORD1",97,0)
 ;Edited 4/19/94, Type of Imaging is now a multiple in file 71.2. CEW
"RTN","RAORD1",98,0)
 S RAIMAG=+$$ITYPE^RASITE(RAPRI),DIC(0)="AEQMZ",DIC="^RAMIS(71.2,",DIC("A")="Select "_$P($G(^DIC(71.2,0)),"^")_": "
"RTN","RAORD1",99,0)
 S DIC("S")="I +$D(^RAMIS(71.2,""AB"",RAIMAG,+Y)),$S('$G(RASERIES):1,$P(^RAMIS(71.2,+Y,0),U,2)="""":1,1:0),$$INIMOD^RAORD1A($P($G(^RAMIS(71.2,+Y,0)),""^""))"
"RTN","RAORD1",100,0)
 D ^DIC K DIC,RAIMAG S:$D(DTOUT)!($D(DUOUT)) RAOUT=1 Q:$D(RAOUT)!(X="^")!(X="")  I Y<1 W $C(7),"  ??" G MODS
"RTN","RAORD1",101,0)
 S RACT=RACT+1,RAMOD(RACT)=$P(Y,"^",2) G MODS
"RTN","RAORD1",102,0)
 Q
"RTN","RAORD1",103,0)
 ;
"RTN","RAORD1",104,0)
ALLERGY ; If patient has had a previous contrast media allergic reaction
"RTN","RAORD1",105,0)
 ; check procedure RAPRI for specific contrast media associations
"RTN","RAORD1",106,0)
 ; (new with RA*5*45)
"RTN","RAORD1",107,0)
 Q:'$$ORCHK^GMRAOR(RADFN,"CM")
"RTN","RAORD1",108,0)
 S RAPRI(0)=$G(^RAMIS(71,RAPRI,0))
"RTN","RAORD1",109,0)
 I $P(RAPRI(0),U,6)'="P" D  ;not a parent check lone procedure
"RTN","RAORD1",110,0)
 .D CONTRAST^RAUTL2(RAPRI)
"RTN","RAORD1",111,0)
 .Q
"RTN","RAORD1",112,0)
 E  S I=0 D  ;check descendent procedures for CM
"RTN","RAORD1",113,0)
 .F  S I=$O(^RAMIS(71,RAPRI,4,I)) Q:'I  D CONTRAST^RAUTL2(+$G(^(I,0)))
"RTN","RAORD1",114,0)
 .K I
"RTN","RAORD1",115,0)
 .Q
"RTN","RAORD1",116,0)
 K RAPRI(0)
"RTN","RAORD1",117,0)
 Q
"RTN","RAORD1",118,0)
 ;
"RTN","RAORD1",119,0)
SAVE ; Save original value of RAMDV before it is altered in the ENADD sub-
"RTN","RAORD1",120,0)
 ; routine.  This code will also reset RAMDV to the sign-on value.
"RTN","RAORD1",121,0)
 Q:'$D(RAPKG)  ; entered through OE/RR (RAMDV will not be set)
"RTN","RAORD1",122,0)
 Q:'$D(RAMDV)&('$D(RAMDVZZ))  ;entered through 'Request an Exam' option used stand-alone outside of Rad/NM pkg
"RTN","RAORD1",123,0)
 I '$D(RAMDVZZ) S RAMDVZZ=RAMDV
"RTN","RAORD1",124,0)
 E  S RAMDV=RAMDVZZ
"RTN","RAORD1",125,0)
 Q
"RTN","RAORD2")
0^26^B43792586
"RTN","RAORD2",1,0)
RAORD2 ;HISC/CAH,FPT,GJC,DAD AISC/RMO-Detailed Request Display ;9/3/99  13:48
"RTN","RAORD2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,10,51,45**;Mar 16, 1998
"RTN","RAORD2",3,0)
 K XQADATA
"RTN","RAORD2",4,0)
 D HOME^%ZIS K DIC S DIC="^DPT(",DIC(0)="AEMQ"
"RTN","RAORD2",5,0)
 W ! D ^DIC G Q:Y<0
"RTN","RAORD2",6,0)
 S RADFN=+Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAORD2",7,0)
 S RAOFNS="Display",RAOVSTS="1;2;3;5;6;8" D LOCATN I $G(RAQUIT) D Q Q
"RTN","RAORD2",8,0)
 I RAONE]"" S ^TMP($J,"RA L-TYPE",$P(RAONE,"^"),$P(RAONE,"^",2))=""
"RTN","RAORD2",9,0)
 S ^TMP($J,"RA L-TYPE","Unknown")=""
"RTN","RAORD2",10,0)
 I '$D(^TMP($J,"RA L-TYPE")) D ERROR^RAUTL7A D Q QUIT
"RTN","RAORD2",11,0)
 S X=0 W !!,"Imaging Location(s) included:"
"RTN","RAORD2",12,0)
 F  S X=$O(^TMP($J,"RA L-TYPE",X)) Q:X']""  D
"RTN","RAORD2",13,0)
 . W:($X+$L(X)+2)'<IOM !?$L("Imaging Location(s) included:") W ?($X+3),X
"RTN","RAORD2",14,0)
 . Q
"RTN","RAORD2",15,0)
 W ! K DIR S DIR(0)="E" D ^DIR K DIR I $D(DUOUT)!($D(DTOUT)) D Q Q
"RTN","RAORD2",16,0)
 D ^RAORDS G Q:'$D(RAORDS)
"RTN","RAORD2",17,0)
OERR ; Entry Point for OE/RR Cancel/Hold Alert
"RTN","RAORD2",18,0)
 I $D(XQADATA) D
"RTN","RAORD2",19,0)
 . S RAORDS(1)=+XQADATA
"RTN","RAORD2",20,0)
 . I $P(XQADATA,",",2)'="" S RADFN=$P(XQADATA,",",2)
"RTN","RAORD2",21,0)
 S RAPKG="",RAOSTSYM="dc^c^h^^p^^^s",$P(RALNE,"-",79)="",RAX=""
"RTN","RAORD2",22,0)
 F RAOLP=1:1 S RAOIFN=$S($D(RAORDS(RAOLP)):RAORDS(RAOLP),1:0) Q:'RAOIFN!(RAX=U)  D DISORD
"RTN","RAORD2",23,0)
 ;
"RTN","RAORD2",24,0)
 K:RAX="^" XQAID,XQAKILL I $D(XQAID) S DFN=$P(XQAID,",",2) D DELETE^XQALERT
"RTN","RAORD2",25,0)
Q K %,DIC,I,OREND,RA,RACI,RACNI,RADFN,RADIV,RADIVPAR,RADPT0,RADTI,RALNE
"RTN","RAORD2",26,0)
 K RANME,RAOFNS,RAOIFN,RAOLP,RAORD0,RAORDS,RAOSTS,RAOSTSYM,RAOVSTS,RAPKG
"RTN","RAORD2",27,0)
 K RAONE,RAQUIT,RASSN,X,XQAID,XQALERT,Y,RAX,VA200,VAERR,VAIP
"RTN","RAORD2",28,0)
 K RAPARENT,RACMFLG
"RTN","RAORD2",29,0)
 K DFN,DIPGM,DISYS,DIW,DIWI,DIWT,DIWTC,DIWX,DN,RA6,RA7,POP,^TMP($J,"PRO-ORD")
"RTN","RAORD2",30,0)
 K ^TMP($J,"RA L-TYPE"),^TMP($J,"RAORDS"),^TMP($J,"RA DIFF PRC") Q
"RTN","RAORD2",31,0)
 ;
"RTN","RAORD2",32,0)
 ;
"RTN","RAORD2",33,0)
DISORD Q:'$D(^DPT(RADFN,0))  S RADPT0=^(0),RA("NME")=$P(RADPT0,"^"),RA("DOB")=$P(RADPT0,"^",3),RASSN=$$SSN^RAUTL Q:'$D(^RAO(75.1,RAOIFN,0))  S RAORD0=^(0)
"RTN","RAORD2",34,0)
 ;determine if ordered procedure has CM assoc.; return null if none
"RTN","RAORD2",35,0)
 S RAZPRC0=$G(^RAMIS(71,+$P(RAORD0,U,2),0))
"RTN","RAORD2",36,0)
 S RACMFLG("O")=$$CMEDIA^RAO7UTL(+$P(RAORD0,U,2),$P(RAZPRC0,U,6))
"RTN","RAORD2",37,0)
 K RAZPRC0
"RTN","RAORD2",38,0)
 I $D(^RADPT("AO",RAOIFN,RADFN)) D DPRC(RAOIFN,RADFN)
"RTN","RAORD2",39,0)
 S RA("PROC. NODE")=$G(^RAMIS(71,+$P(RAORD0,U,2),0))
"RTN","RAORD2",40,0)
 S RA("PRC")=$E($P(RA("PROC. NODE"),U),1,36)
"RTN","RAORD2",41,0)
 S RA("PRCTY")=$P(RA("PROC. NODE"),U,6)
"RTN","RAORD2",42,0)
 S RA("PRCTY")=$$XTERNAL^RAUTL5(RA("PRCTY"),$P($G(^DD(71,6,0)),U,2))
"RTN","RAORD2",43,0)
 S RA("PRCTY")=$E(RA("PRCTY"))_$$LOW^XLFSTR($E(RA("PRCTY"),2,99))
"RTN","RAORD2",44,0)
 S RA("CPT")=+$P(RA("PROC. NODE"),U,9)
"RTN","RAORD2",45,0)
 ; don't find CPT code if procedure has type = Parent
"RTN","RAORD2",46,0)
 S RA("CPT")=$S($E(RA("PRCTY"))="P":"",1:$P($$NAMCODE^RACPTMSC(RA("CPT"),DT),U))
"RTN","RAORD2",47,0)
 S RA("PRCIT")=+$P(RA("PROC. NODE"),U,12)
"RTN","RAORD2",48,0)
 S RA("PRCIT")=$P($G(^RA(79.2,RA("PRCIT"),0)),U,3)
"RTN","RAORD2",49,0)
 S RA("PROC INFO")="",$E(RA("PROC INFO"),1,36)=RA("PRC")
"RTN","RAORD2",50,0)
 S RA("CNCAT")="("_RA("PRCIT")_" "_RA("PRCTY")_" "_RA("CPT")_")"
"RTN","RAORD2",51,0)
 S $E(RA("PROC INFO"),38,60)=RA("CNCAT") K RA("CNCAT"),RA("PRCIT")
"RTN","RAORD2",52,0)
 K RA("PRCTY"),RA("CPT")
"RTN","RAORD2",53,0)
 K RA("MOD") F I=0:0 S I=$O(^RAO(75.1,RAOIFN,"M","B",I)) Q:'I  I $D(^RAMIS(71.2,+I,0)) S RA("MOD")=$S('$D(RA("MOD")):$P(^(0),"^"),1:RA("MOD")_", "_$P(^(0),"^"))
"RTN","RAORD2",54,0)
 S RA("OST")=$P($P(^DD(75.1,5,0),$P(RAORD0,"^",5)_":",2),";")_$S($P(RAOSTSYM,"^",$P(RAORD0,"^",5))="":"",1:" ("_$P(RAOSTSYM,"^",$P(RAORD0,"^",5))_")")
"RTN","RAORD2",55,0)
 S RA("PHY")=$S($D(^VA(200,+$P(RAORD0,"^",14),0)):$P(^(0),"^"),1:"")
"RTN","RAORD2",56,0)
 ; Requesting Physician phone/pager info
"RTN","RAORD2",57,0)
 D PHONE^RAORD5("R",+$P(RAORD0,"^",14))
"RTN","RAORD2",58,0)
 S RA("HLC")=$S($D(^SC(+$P(RAORD0,"^",22),0)):$P(^(0),"^"),1:"")
"RTN","RAORD2",59,0)
 S DFN=RADFN,VA200=1 D IN5^VADPT I VAIP(1) S RA("ROOM-BED")=$S(+VAIP(6):$P(VAIP(6),"^",2),1:"")
"RTN","RAORD2",60,0)
 K RA("ODT") S X=$P(RAORD0,"^",16) I X S:$P(X,".",2) X=$P(X,".")_"."_$$NOSECNDS^RAORD3($P(X,".",2)) S RA("ODT")=$$FMTE^XLFDT(X,"1P")
"RTN","RAORD2",61,0)
 S RA("USR")=$S($D(^VA(200,+$P(RAORD0,"^",15),0)):$P(^(0),"^"),1:"")
"RTN","RAORD2",62,0)
 D HDR ; display a header
"RTN","RAORD2",63,0)
 W !,"Requested :",?12,RA("PROC INFO")
"RTN","RAORD2",64,0)
 I $D(^TMP($J,"RA DIFF PRC")) D
"RTN","RAORD2",65,0)
 .N CRTN,I S CRTN=0,I="" W !,"Registered:"
"RTN","RAORD2",66,0)
 .F  S I=$O(^TMP($J,"RA DIFF PRC",I)) Q:I']""  D
"RTN","RAORD2",67,0)
 ..W:CRTN ! W ?12,I S CRTN=1
"RTN","RAORD2",68,0)
 .Q
"RTN","RAORD2",69,0)
 I $G(RACMFLG("O"))'="" W:$X ! W ?12,"** The requested procedure has contrast media assigned **"
"RTN","RAORD2",70,0)
 I $G(RACMFLG("R"))'="" W:$X ! W ?12,"** A registered procedure uses contrast media **"
"RTN","RAORD2",71,0)
 W:$D(RA("MOD")) !,"Procedure Modifiers:",?22,RA("MOD")
"RTN","RAORD2",72,0)
 W !!,"Current Status:",?22,$E(RA("OST"),1,24)
"RTN","RAORD2",73,0)
 W !,"Requester:",?22,$E(RA("PHY"),1,24)
"RTN","RAORD2",74,0)
 W !?1,"Tel/Page/Dig Page: ",RA("RPHOINFO")
"RTN","RAORD2",75,0)
 W !,"Patient Location:",?22,$E(RA("HLC"),1,20)
"RTN","RAORD2",76,0)
 W:$D(RA("ROOM-BED")) !,"Room-Bed:",?22,$E(RA("ROOM-BED"),1,20)
"RTN","RAORD2",77,0)
 W !,"Entered:",?22,$S($D(RA("ODT")):RA("ODT"),1:""),"  by ",$E(RA("USR"),1,20)
"RTN","RAORD2",78,0)
 ;
"RTN","RAORD2",79,0)
ENDIS ;OE/RR Entry Point for the PRINT ACTION Option
"RTN","RAORD2",80,0)
 I '$D(RAPKG) Q:'$D(ORPK)  S RAOIFN=+ORPK Q:'$D(^RAO(75.1,RAOIFN,0))  S RAORD0=^(0),RADFN=+$P(RAORD0,"^")
"RTN","RAORD2",81,0)
 S RA("TRAN")=$S($P(RAORD0,"^",19)']"":"",1:$P($P(^DD(75.1,19,0),$P(RAORD0,"^",19)_":",2),";"))
"RTN","RAORD2",82,0)
 K RA("ST") I $D(^RADPT("AO",RAOIFN,RADFN)) S RADTI=+$O(^(RADFN,0)),RACNI=+$O(^(RADTI,0)) I $D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) S RA(0)=^(0) I $D(^RA(72,+$P(RA(0),"^",3),0)) S RA("ST")=$P(^(0),"^")
"RTN","RAORD2",83,0)
 I '$D(RAPKG) D DPRC(RAOIFN,RADFN) K ^TMP($J,"RA DIFF PRC")
"RTN","RAORD2",84,0)
 S RADIV(0)=$G(^SC(+$P(RAORD0,"^",22),0))
"RTN","RAORD2",85,0)
 S RADIV=+$$SITE^VASITE(DT,+$P(RADIV(0),"^",15)) S:RADIV<0 RADIV=0
"RTN","RAORD2",86,0)
 S RADIV=$S($D(^RA(79,RADIV,0)):RADIV,1:$O(^RA(79,0)))
"RTN","RAORD2",87,0)
 S RADIVPAR=$S($D(^RA(79,+RADIV,.1)):^(.1),1:"")
"RTN","RAORD2",88,0)
 K RA("RDT") S Y=$P(RAORD0,"^",21) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("RDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD2",89,0)
 K RA("PDT") S Y=$P(RAORD0,"^",12) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("PDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD2",90,0)
 K RA("VDT") S Y=$P(RAORD0,"^",17) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("VDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD2",91,0)
 K RA("SDT") S Y=$P(RAORD0,"^",23) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("SDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD2",92,0)
 S RA("ILC")=$S('$P(RAORD0,"^",20):"UNKNOWN",'$D(^RA(79.1,+$P(RAORD0,"^",20),0)):"UNKNOWN",$D(^SC(+^(0),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","RAORD2",93,0)
 I $S('$D(XQORNOD(0)):0,$P(XQORNOD(0),"^",3)'="Results Display":0,1:1),$D(RA(0)) D ^RAORR3 Q
"RTN","RAORD2",94,0)
 D ^RAORD3 K RA,RACI,RACNI,RADIV,RADIVPAR,RADPT0,RADTI,RAORD0,RAOSTS,X,Y I '$D(RAPKG) K RADFN,RAOIFN
"RTN","RAORD2",95,0)
 Q
"RTN","RAORD2",96,0)
LOCATN ; Select or default to a Rad/Nuc Med location.
"RTN","RAORD2",97,0)
 S RAONE=$$LOC1() Q:RAONE]""
"RTN","RAORD2",98,0)
 S RADIC="^RA(79.1,",RADIC(0)="QEAMZ"
"RTN","RAORD2",99,0)
 S RADIC("A")="Select Rad/Nuc Med Location: "
"RTN","RAORD2",100,0)
 S RADIC("B")="All",RAUTIL="RA L-TYPE"
"RTN","RAORD2",101,0)
 W !! D EN1^RASELCT(.RADIC,RAUTIL) K DIC,RADIC,RAUTIL,X,Y
"RTN","RAORD2",102,0)
 Q
"RTN","RAORD2",103,0)
LOC1() ; Checking for only one Imaging Location
"RTN","RAORD2",104,0)
 ; Pass back null if more that one entry exists in 79.1 
"RTN","RAORD2",105,0)
 ; If one entry, pass back: external Hosp. Loc. file_"^"_IEN of file 79.1
"RTN","RAORD2",106,0)
 N X,Y S X=""
"RTN","RAORD2",107,0)
 I $P($G(^RA(79.1,0)),"^",4)=1 D
"RTN","RAORD2",108,0)
 . S Y=+$O(^RA(79.1,0)) Q:'Y
"RTN","RAORD2",109,0)
 . S Y(0)=$G(^RA(79.1,Y,0)),Y(1)=+$P(Y(0),"^")
"RTN","RAORD2",110,0)
 . S Y(44)=$P($G(^SC(Y(1),0)),"^"),X=Y(44)_"^"_Y
"RTN","RAORD2",111,0)
 . Q
"RTN","RAORD2",112,0)
 Q X
"RTN","RAORD2",113,0)
HDR ; Header for the 'Detailed Request Display' option.  Called from above
"RTN","RAORD2",114,0)
 ; (D HDR) and from RAORD3
"RTN","RAORD2",115,0)
 W @IOF,?22,"**** Detailed Display ****",!!,"Name: ",RA("NME"),"    (",RASSN,")" S Y=RA("DOB") D D^RAUTL W ?45,"Date of Birth: ",Y,!,RALNE
"RTN","RAORD2",116,0)
 Q
"RTN","RAORD2",117,0)
 ;
"RTN","RAORD2",118,0)
DPRC(RAOIFN,RADFN) ; If the ordered procedure has been registered check
"RTN","RAORD2",119,0)
 ;if this is an examset. If not an examset, find the status of the exam
"RTN","RAORD2",120,0)
 ;RA("ST"). Also, check if the ordered procedure has been changed at
"RTN","RAORD2",121,0)
 ;time of registration (DPROC^RAUTL15). If it has, store the data off
"RTN","RAORD2",122,0)
 ;in ^TMP($J,"RA DIFF PRC").
"RTN","RAORD2",123,0)
 ;
"RTN","RAORD2",124,0)
 ; NOTE: The only time we don't set ^TMP($J,"RA DIFF PRC") is when
"RTN","RAORD2",125,0)
 ; we are using the 'Detailed Request Display' option and the ordered
"RTN","RAORD2",126,0)
 ; procedure is the same as the registered procedure.  All other
"RTN","RAORD2",127,0)
 ; Request display options output the ordered procedure, the
"RTN","RAORD2",128,0)
 ; registered procedure and exam case number if the order
"RTN","RAORD2",129,0)
 ; is active.
"RTN","RAORD2",130,0)
 ;
"RTN","RAORD2",131,0)
 ;Set the variable RACMFLG("R") to "Y" if an exam, either a single or
"RTN","RAORD2",132,0)
 ;descendant, has used contrast media during the examination.
"RTN","RAORD2",133,0)
 ;
"RTN","RAORD2",134,0)
 N RA7003,RACNI,RADTI,RAFLG K RA("ST"),^TMP($J,"RA DIFF PRC")
"RTN","RAORD2",135,0)
 S (RADTI,RAFLG)=0
"RTN","RAORD2",136,0)
 F  S RADTI=+$O(^RADPT("AO",RAOIFN,RADFN,RADTI)) Q:RADTI'>0  D
"RTN","RAORD2",137,0)
 . S RACNI=0
"RTN","RAORD2",138,0)
 . F  S RACNI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI,RACNI)) Q:RACNI'>0  D
"RTN","RAORD2",139,0)
 .. I $D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) D
"RTN","RAORD2",140,0)
 ... S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),RAFLG=RAFLG+1
"RTN","RAORD2",141,0)
 ... S:$G(RACMFLG("R"))="" RACMFLG("R")=$S($P(RA7003,U,10)="Y":"Y",1:"")
"RTN","RAORD2",142,0)
 ... S RA("ST")=$$GET1^DIQ(72,+$P(RA7003,"^",3)_",",.01)
"RTN","RAORD2",143,0)
 ... N RAPRC S RAPRC=$$DPROC^RAUTL15(RADFN,RADTI,RACNI,RAOIFN)
"RTN","RAORD2",144,0)
 ... S:RAPRC]"" ^TMP($J,"RA DIFF PRC",RAPRC)=""
"RTN","RAORD2",145,0)
 ... Q
"RTN","RAORD2",146,0)
 .. Q
"RTN","RAORD2",147,0)
 . Q
"RTN","RAORD2",148,0)
 K:RAFLG>1 RA("ST") ; >1 reg. xam for this order, RA("ST") not valid
"RTN","RAORD2",149,0)
 Q
"RTN","RAORD3")
0^13^B23672293
"RTN","RAORD3",1,0)
RAORD3 ;HISC/CAH,FPT,GJC AISC/RMO-Detailed Request Display Cont. ;11/27/98  16:00
"RTN","RAORD3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,15,21,27,45**;Mar 16, 1998
"RTN","RAORD3",3,0)
 I $P(RADPT0,U,2)="F" D  ;display pregnancy status for females ptch 45
"RTN","RAORD3",4,0)
 .W !,"Pregnancy Status: ",?22,$S($P(RAORD0,"^",13)="y":"Patient is Pregnant",$P(RAORD0,"^",13)="n":"Patient not pregnant at time of order",1:"Unknown")
"RTN","RAORD3",5,0)
 .Q
"RTN","RAORD3",6,0)
 W:$P(RAORD0,"^",24)="y" !?12,"*** Universal Isolation Precautions ***" W:$D(RA("VDT")) !?8,$C(7),"** Note:  Request Associated with Visit on ",RA("VDT")," **"
"RTN","RAORD3",7,0)
 W:$D(RA("RDT"))&($D(RAPKG)) !,"Desired Date:",?22,RA("RDT") W:$D(RA("PDT")) !,"Pre-op Scheduled:",?22,RA("PDT") S RAOSTS=$P(RAORD0,"^",5) I RAOSTS=8,$D(RA("SDT")) W !,"Exam Scheduled:",?22,RA("SDT")
"RTN","RAORD3",8,0)
 I RAOSTS=1 D USERCAN
"RTN","RAORD3",9,0)
 W !,"Transport:",?22,RA("TRAN")
"RTN","RAORD3",10,0)
 I $O(^RAO(75.1,RAOIFN,"H",0)) D  Q:$G(OREND)=1!($G(RAX)="^")
"RTN","RAORD3",11,0)
 . D CHIST(RAOIFN)
"RTN","RAORD3",12,0)
 . Q
"RTN","RAORD3",13,0)
 I RAOSTS=1!(RAOSTS=3) W !,"Reason ",$S(RAOSTS=1:"Cancelled",1:"Held"),":",?22,$S($D(^RA(75.2,+$P(RAORD0,"^",10),0)):$E($P(^(0),"^"),1,50),$P(RAORD0,"^",27)]"":$E($P(RAORD0,"^",27),1,50),1:"UNKNOWN") D TEXT:RAOSTS=3
"RTN","RAORD3",14,0)
 W:$D(RA("ST")) !,"Exam Status:",?22,RA("ST") W:$D(RA("ILC")) !,"Request Submitted to: ",RA("ILC")
"RTN","RAORD3",15,0)
 G A:$P(RAORD0,"^",11)'="y",A:'$D(RADTI)!('$D(RACNI))
"RTN","RAORD3",16,0)
 W !!?7,$C(7),"** Note:  Request has been changed by the Imaging Service **"
"RTN","RAORD3",17,0)
A I $D(^RAO(75.1,RAOIFN,"T")) D ASK:$E(IOST,1,2)="C-" I $D(DIRUT) S RAX="^" K DIRUT
"RTN","RAORD3",18,0)
 Q:Y'=1  I $D(RAPKG),RAX'="^" R !!,"Press return to continue or ""^"" to escape ",X:DTIME S RAX=$E(X)
"RTN","RAORD3",19,0)
 Q
"RTN","RAORD3",20,0)
 ;
"RTN","RAORD3",21,0)
ASK W ! S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to display request status tracking log",DIR("?")="Enter 'YES' if status tracking log should be displayed, or 'NO' if not." D ^DIR K DIR S:$D(DIRUT) OREND=1 Q:$D(DIRUT)!(Y=0)
"RTN","RAORD3",22,0)
 W !!?20,"*** Request Status Tracking Log ***",!,"Date/Time",?18,"Status",?31,"User",?44,"Reason",!,"-----------------",?18,"------------",?31,"-----------",?44,"------------------------------------"
"RTN","RAORD3",23,0)
 F RALNB=0:0 S RALNB=$O(^RAO(75.1,RAOIFN,"T",RALNB)) Q:'RALNB  I $D(^(RALNB,0)) S RATORD0=^(0) D PRTLOG
"RTN","RAORD3",24,0)
Q K RALNB,RATORD0,RATODT,RATOST,RATREA,RATUSR Q
"RTN","RAORD3",25,0)
 ;
"RTN","RAORD3",26,0)
PRTLOG S (X,RATODT)=$P(RATORD0,"^") I X S RATODT=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) I $P(X,".",2) D TIME^RAUTL1 S RATODT=RATODT_" "_X
"RTN","RAORD3",27,0)
 S RATOST=$P($P(^DD(75.12,2,0),$P(RATORD0,"^",2)_":",2),";"),RATUSR=$S($D(^VA(200,+$P(RATORD0,"^",3),0)):$P(^(0),"^"),1:"")
"RTN","RAORD3",28,0)
 S RATREA=$S($D(^RA(75.2,+$P(RATORD0,"^",4),0)):$P(^(0),"^"),1:"")
"RTN","RAORD3",29,0)
 W !,RATODT,?18,$E(RATOST,1,12),?31,$E(RATUSR,1,11),?44,$E(RATREA,1,35) I $E(RATREA,36,70)'="" W !,?44,$E(RATREA,36,70)
"RTN","RAORD3",30,0)
 Q
"RTN","RAORD3",31,0)
TEXT ; display Hold Description text
"RTN","RAORD3",32,0)
 Q:'$O(^RAO(75.1,RAOIFN,1,0))
"RTN","RAORD3",33,0)
 W !,"Hold Description:",!
"RTN","RAORD3",34,0)
 K ^UTILITY($J,"W"),^(1) S DIWL=22,DIWR=75,DIWF="W"
"RTN","RAORD3",35,0)
 F RARR=0:0 S RARR=$O(^RAO(75.1,RAOIFN,1,RARR)) Q:RARR'>0  S X=^(RARR,0) D ^DIWP
"RTN","RAORD3",36,0)
 D ^DIWW
"RTN","RAORD3",37,0)
 Q
"RTN","RAORD3",38,0)
CHIST(RAY) ; display Clinical History (if applicable)
"RTN","RAORD3",39,0)
 Q:RAY'?1N.N  Q:'$O(^RAO(75.1,RAY,"H",0))
"RTN","RAORD3",40,0)
 N DIWF,DIWL,DIWR,RABAN,RARR,RAXIT
"RTN","RAORD3",41,0)
 K ^UTILITY($J,"W") S DIWL=22,DIWR=75,DIWF="",RARR=0
"RTN","RAORD3",42,0)
 F  S RARR=$O(^RAO(75.1,RAY,"H",RARR)) Q:RARR'>0  D
"RTN","RAORD3",43,0)
 . ; store into ^UTILITY($J,"W")
"RTN","RAORD3",44,0)
 . S X=$G(^RAO(75.1,RAY,"H",RARR,0)) D ^DIWP
"RTN","RAORD3",45,0)
 . Q
"RTN","RAORD3",46,0)
 S (RARR,RAXIT)=0,RABAN="Clinical History: "
"RTN","RAORD3",47,0)
 I $Y>(IOSL-4) D
"RTN","RAORD3",48,0)
 . S RAXIT=$$EOS()
"RTN","RAORD3",49,0)
 . I 'RAXIT,('$D(RAPKG)) W @IOF
"RTN","RAORD3",50,0)
 . I 'RAXIT,($D(RAPKG)) D HDR^RAORD2
"RTN","RAORD3",51,0)
 . Q
"RTN","RAORD3",52,0)
 I RAXIT S:$D(RAPKG) RAX="^" K ^UTILITY($J,"W") Q
"RTN","RAORD3",53,0)
 W !,RABAN
"RTN","RAORD3",54,0)
 F  S RARR=$O(^UTILITY($J,"W",DIWL,RARR)) Q:RARR'>0  D  Q:RAXIT
"RTN","RAORD3",55,0)
 . S X=$G(^UTILITY($J,"W",DIWL,RARR,0)) W ?22,X,!
"RTN","RAORD3",56,0)
 . I $Y>(IOSL-4) D
"RTN","RAORD3",57,0)
 .. S RAXIT=$$EOS()
"RTN","RAORD3",58,0)
 .. I 'RAXIT,('$D(RAPKG)) W @IOF
"RTN","RAORD3",59,0)
 .. I 'RAXIT,($D(RAPKG)) D HDR^RAORD2 W !
"RTN","RAORD3",60,0)
 .. Q
"RTN","RAORD3",61,0)
 . Q
"RTN","RAORD3",62,0)
 S:RAXIT&($D(RAPKG)) RAX="^" K ^UTILITY($J,"W") ; kill global
"RTN","RAORD3",63,0)
 Q
"RTN","RAORD3",64,0)
EOS() ; End of screen check for both OE/RR & Rad/Nuc Med
"RTN","RAORD3",65,0)
 ; Var List: $D(RAPKG) entry through Rad/Nuc Med, else through OE/RR
"RTN","RAORD3",66,0)
 ; Passes back 'Y', Y=1 do not continue, Y=0 continue
"RTN","RAORD3",67,0)
 ; NOTE: Sets OREND if code entered through OE/RR.  This code may be
"RTN","RAORD3",68,0)
 ;       hit when the user accesses the 'Act On Existing Orders' through
"RTN","RAORD3",69,0)
 ;       OE/RR.  'Detailed Order Display' (8^RAORR) hits ENDIS^RAORD2
"RTN","RAORD3",70,0)
 ;       which mimics (hits same code) the Rad/Nuc Med 'Detailed Request
"RTN","RAORD3",71,0)
 ;       Display' option.  The old PGBRK^ORUHDR code set OREND to 0
"RTN","RAORD3",72,0)
 ;       initially, (even though it is set to 0 upon entering this
"RTN","RAORD3",73,0)
 ;       sub-routine) and re-set it to 1 if the user enters an '^' at
"RTN","RAORD3",74,0)
 ;       the "Enter RETURN to continue or '^' to exit:" prompt.
"RTN","RAORD3",75,0)
 S Y=$$EOS^RAUTL5() S:'$D(RAPKG) OREND=Y
"RTN","RAORD3",76,0)
 Q Y
"RTN","RAORD3",77,0)
USERCAN ;user who cancelled this request
"RTN","RAORD3",78,0)
 Q:$P($G(^RAO(75.1,RAOIFN,0)),U,5)'=1  ;only look at 'discontinued'
"RTN","RAORD3",79,0)
 N RA8,RA9 S RA8=0
"RTN","RAORD3",80,0)
 F  S RA8=$O(^RAO(75.1,RAOIFN,"T",RA8)) Q:'RA8  I $G(^(RA8,0))]"",$P(^(0),U,2)=1 S RA9=RA8 ; find latest ien of 'discontinued'
"RTN","RAORD3",81,0)
 S RA("ODT")="",RA("USR")=""
"RTN","RAORD3",82,0)
 I $G(RA9) D USERCAN1
"RTN","RAORD3",83,0)
 E  D USERCAN2
"RTN","RAORD3",84,0)
 W !,"Cancelled:",?22,RA("ODT") W:RA("USR")]"" "  by ",RA("USR")
"RTN","RAORD3",85,0)
 K RA("ODT"),RA("USR")
"RTN","RAORD3",86,0)
 Q
"RTN","RAORD3",87,0)
USERCAN1 ;use request track times to get when and who cancelled
"RTN","RAORD3",88,0)
 S X=$P(^RAO(75.1,RAOIFN,"T",RA9,0),U) D:X TRDT
"RTN","RAORD3",89,0)
 S RA("USR")=$P($G(^VA(200,+$P(^RAO(75.1,RAOIFN,"T",RA9,0),U,3),0)),U)
"RTN","RAORD3",90,0)
 Q
"RTN","RAORD3",91,0)
USERCAN2 ;use vars DUZ and RAORD0 to get "who" and "when" cancelled
"RTN","RAORD3",92,0)
 S X=$P($G(RAORD0),U,18) D:X TRDT
"RTN","RAORD3",93,0)
 ; don't use  duz  if within any one of 3 rad request options
"RTN","RAORD3",94,0)
 Q:$D(RASCREEN)  Q:$D(RAOPT("ORDERPRINTS"))  Q:$D(RAOPT("ORDERPRINTPAT"))
"RTN","RAORD3",95,0)
 S RA("USR")=$P($G(^VA(200,$G(DUZ),0)),U)
"RTN","RAORD3",96,0)
 Q
"RTN","RAORD3",97,0)
TRDT S:$P(X,".",2) X=$P(X,".")_"."_$$NOSECNDS($P(X,".",2))
"RTN","RAORD3",98,0)
 S RA("ODT")=$$FMTE^XLFDT(X,"1P")
"RTN","RAORD3",99,0)
 Q
"RTN","RAORD3",100,0)
NOSECNDS(X) ; If a timestamp is associated with a date, strip off seconds.
"RTN","RAORD3",101,0)
 ; Input : X-timestamp (153048)
"RTN","RAORD3",102,0)
 ; Output: (1530)
"RTN","RAORD3",103,0)
 Q $E(X,1,4)
"RTN","RAORD5")
0^27^B27398038
"RTN","RAORD5",1,0)
RAORD5 ;HISC/CAH,FPT,GJC AISC/RMO-Print A Request ;8/4/97  14:47
"RTN","RAORD5",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,10,15,31,45**;Mar 16, 1998
"RTN","RAORD5",3,0)
 ; Input:  RADFN= Internal Number to Rad/Nuc Med Patient File #70
"RTN","RAORD5",4,0)
 ;         RAOIFN= Internal Number to Rad/Nuc Med Orders File #75.1
"RTN","RAORD5",5,0)
 ;         RAX= Null (Used to check for an '^')
"RTN","RAORD5",6,0)
 ;         RAPGE= 0 (Used as a page counter)
"RTN","RAORD5",7,0)
 ;
"RTN","RAORD5",8,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RAORD5",9,0)
 G Q:'$D(^DPT(RADFN,0)) S RADPT0=^(0) G Q:'$D(^RAO(75.1,RAOIFN,0)) S RAORD0=^(0)
"RTN","RAORD5",10,0)
 K ^UTILITY($J,"W"),^(1) S RAOSTSYM="dc^c^h^^p^^^s",$P(RALNE,"-",79)="",$P(RALNE1,"=",79)="",DIWL=5,DIWR=75,DIWF="WC75"
"RTN","RAORD5",11,0)
 S RA("NME")=$P(RADPT0,"^"),RA("SEX")=$P(RADPT0,"^",2),RA("DOB")=$P(RADPT0,"^",3),RASSN=$$SSN^RAUTL
"RTN","RAORD5",12,0)
 S X="NOW",%DT="T" D ^%DT K %DT S X1=Y,X2=RA("DOB") D ^%DTC S RA("AGE")=X\365.25
"RTN","RAORD5",13,0)
 S:$E(Y,4,7)=$E(RA("DOB"),4,7) RA("AGE")=RA("AGE")+1 ; today is birthday
"RTN","RAORD5",14,0)
 S RA("PRC NODE")=$G(^RAMIS(71,+$P(RAORD0,U,2),0))
"RTN","RAORD5",15,0)
 S RA("PRC")=$E($P(RA("PRC NODE"),U),1,36)
"RTN","RAORD5",16,0)
 S RA("PRC")=$S(RA("PRC")]"":RA("PRC"),1:"UNKNOWN")
"RTN","RAORD5",17,0)
 S RA("PRCTY")=$P(RA("PRC NODE"),U,6)
"RTN","RAORD5",18,0)
 S RA("PRCTY")=$$XTERNAL^RAUTL5(RA("PRCTY"),$P($G(^DD(71,6,0)),U,2))
"RTN","RAORD5",19,0)
 S RA("PRCTY")=$E(RA("PRCTY"))_$$LOW^XLFSTR($E(RA("PRCTY"),2,99))
"RTN","RAORD5",20,0)
 S RA("CPT")=+$P(RA("PRC NODE"),U,9)
"RTN","RAORD5",21,0)
 S RA("CPT")=$P($$NAMCODE^RACPTMSC(RA("CPT"),DT),U)
"RTN","RAORD5",22,0)
 S RA("PRCIT")=+$P(RA("PRC NODE"),U,12)
"RTN","RAORD5",23,0)
 S RA("PRCIT")=$P($G(^RA(79.2,RA("PRCIT"),0)),U,3)
"RTN","RAORD5",24,0)
 S RA("CNCAT")="("_RA("PRCIT")_" "_RA("PRCTY")_" "_RA("CPT")_")"
"RTN","RAORD5",25,0)
 S RA("PRC INFO")="",$E(RA("PRC INFO"),1,36)=RA("PRC")
"RTN","RAORD5",26,0)
 S $E(RA("PRC INFO"),38,60)=RA("CNCAT") K RA("CNCAT")
"RTN","RAORD5",27,0)
 S RA("PRC MSG")=$S(+$O(^RAMIS(71,+$P(RAORD0,"^",2),3,0))>0:1,1:0)
"RTN","RAORD5",28,0)
 S RA("OUG")=$P($P(^DD(75.1,6,0),$P(RAORD0,"^",6)_":",2),";")
"RTN","RAORD5",29,0)
 K RA("MOD") F I=0:0 S I=$O(^RAO(75.1,RAOIFN,"M","B",I)) Q:'I  I $D(^RAMIS(71.2,+I,0)) S RA("MOD")=$S('$D(RA("MOD")):$P(^(0),"^"),1:RA("MOD")_", "_$P(^(0),"^")) S:$P($G(^(0)),U,2)="p" RA("PORTABLE")=""
"RTN","RAORD5",30,0)
 S RA("OST")=$$GET1^DIQ(75.1,RAOIFN_",",5)_$S($P(RAOSTSYM,"^",$P(RAORD0,"^",5))="":"",1:" ("_$P(RAOSTSYM,"^",$P(RAORD0,"^",5))_")")
"RTN","RAORD5",31,0)
 S RA("PHY")=$S($D(^VA(200,+$P(RAORD0,"^",14),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","RAORD5",32,0)
 ; Requesting Physician Phone info
"RTN","RAORD5",33,0)
 D:RA("PHY")'="UNKNOWN" PHONE("R",+$P(RAORD0,"^",14))
"RTN","RAORD5",34,0)
 ; Get current primary and attending physicians
"RTN","RAORD5",35,0)
 S DFN=RADFN,VA200=1 D IN5^VADPT K VA200 S:'$D(VAIP(18)) VAIP(18)=""
"RTN","RAORD5",36,0)
 I '+$G(VAIP(7)) D
"RTN","RAORD5",37,0)
 . ; If the Primary Physician is not found (based on inpatient episode)
"RTN","RAORD5",38,0)
 . ; find the current Primary Care Practitioner (See patch SD*5.3*30)
"RTN","RAORD5",39,0)
 . ; VAIP(7) is null at this point.  VAIP(7) will exit this DO block
"RTN","RAORD5",40,0)
 . ; set to the Primary Care Practitioner or null.
"RTN","RAORD5",41,0)
 . N X S X="SDUTL3" X ^%ZOSF("TEST")
"RTN","RAORD5",42,0)
 . S:$T VAIP(7)=$$OUTPTPR^SDUTL3(RADFN)
"RTN","RAORD5",43,0)
 . Q
"RTN","RAORD5",44,0)
 ; Get Current Primary and Attending Physician Phone info
"RTN","RAORD5",45,0)
 S RA("ATTEN")=$S($P(VAIP(18),"^",2)]"":$P(VAIP(18),"^",2),1:"UNKNOWN")
"RTN","RAORD5",46,0)
 D:RA("ATTEN")'="UNKNOWN" PHONE("A",+$G(VAIP(18)))
"RTN","RAORD5",47,0)
 S RA("PRIM")=$S($P(VAIP(7),"^",2)]"":$P(VAIP(7),"^",2),1:"UNKNOWN")
"RTN","RAORD5",48,0)
 D:RA("PRIM")'="UNKNOWN" PHONE("P",+$G(VAIP(7)))
"RTN","RAORD5",49,0)
 ; Requesting location, room-bed
"RTN","RAORD5",50,0)
 S RA("HLC")=$S($D(^SC(+$P(RAORD0,"^",22),0)):$P(^(0),"^"),1:"UNKNOWN"),RA("HPH")=$S($D(^SC(+$P(RAORD0,"^",22),99)):$P(^(99),"^"),1:"") I VAIP(1) S RA("ROOM-BED")=$S(+VAIP(6):$P(VAIP(6),"^",2),1:"")
"RTN","RAORD5",51,0)
 ; Get primary and attending phys as of order date and their phone, etc.
"RTN","RAORD5",52,0)
 K RA("ODT") S Y=$P(RAORD0,"^",16) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("ODT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD5",53,0)
 K VAIP S DFN=RADFN,VAIP("D")=+$P(RAORD0,"^",16),VA200=1 D:VAIP("D") IN5^VADPT K VA200
"RTN","RAORD5",54,0)
 S RA("OATTEN")=$S($P($G(VAIP(18)),"^",2)]"":$P(VAIP(18),"^",2),1:"UNKNOWN")
"RTN","RAORD5",55,0)
 D:RA("OATTEN")'="UNKNOWN" PHONE("OA",+$G(VAIP(18)))
"RTN","RAORD5",56,0)
 S RA("OPRIM")=$S($P($G(VAIP(7)),"^",2)]"":$P(VAIP(7),"^",2),1:"UNKNOWN")
"RTN","RAORD5",57,0)
 D:RA("OPRIM")'="UNKNOWN" PHONE("OP",+$G(VAIP(7)))
"RTN","RAORD5",58,0)
 ; Get other order info (orderer, transport mode, etc.)
"RTN","RAORD5",59,0)
 S RA("USR")=$S($D(^VA(200,+$P(RAORD0,"^",15),0)):$P(^(0),"^"),1:"UNKNOWN"),RA("TRAN")=$S($P(RAORD0,"^",19)']"":"UNKNOWN",1:$P($P(^DD(75.1,19,0),$P(RAORD0,"^",19)_":",2),";")) S:$P(RAORD0,"^",19)="p" RA("PORTABLE")=""
"RTN","RAORD5",60,0)
 K RA("ST"),^TMP($J,"RA DIFF PRC")
"RTN","RAORD5",61,0)
 ;determine if ordered procedure has CM assoc.; return null if none
"RTN","RAORD5",62,0)
 S RACMFLG("O")=$$CMEDIA^RAO7UTL(+$P(RAORD0,U,2),$P(RA("PRC NODE"),U,6))
"RTN","RAORD5",63,0)
 ; If appropriate, determine exam status and descendant exams
"RTN","RAORD5",64,0)
 I $D(^RADPT("AO",RAOIFN,RADFN)) D DPRC^RAORD2(RAOIFN,RADFN)
"RTN","RAORD5",65,0)
 S RADIV(0)=$G(^SC(+$P(RAORD0,"^",22),0))
"RTN","RAORD5",66,0)
 S RADIV=+$$SITE^VASITE(DT,+$P(RADIV(0),"^",15)) S:RADIV<0 RADIV=0
"RTN","RAORD5",67,0)
 S RADIV=$S($D(^RA(79,RADIV,0)):RADIV,1:$O(^RA(79,0)))
"RTN","RAORD5",68,0)
 S RADIVPAR=$S($D(^RA(79,+RADIV,.1)):^(.1),1:"")
"RTN","RAORD5",69,0)
 K RA("RDT") S Y=$P(RAORD0,"^",21) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("RDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD5",70,0)
 K RA("PDT") S Y=$P(RAORD0,"^",12) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("PDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD5",71,0)
 K RA("VDT") S Y=$P(RAORD0,"^",17) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("VDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD5",72,0)
 K RA("SDT") S Y=$P(RAORD0,"^",23) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("SDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD5",73,0)
 S RA("ILC")=$S('$P(RAORD0,"^",20):"UNKNOWN",'$D(^RA(79.1,+$P(RAORD0,"^",20),0)):"UNKNOWN",$D(^SC(+^(0),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","RAORD5",74,0)
 D ^RAORD6
"RTN","RAORD5",75,0)
 ;
"RTN","RAORD5",76,0)
Q K DIWF,DIWL,DIWR,I,RA,RABARC,RABARC0,RABARC1,RADIV,RADIVPAR,RADPT0,RALNE,RALNE1,RAORD0,RAOSTSYM,RATAB,RAV,RASSN,RAXX,VA200,VAERR,VAIP,X,X1,X2,X3,Y,ZZ
"RTN","RAORD5",77,0)
 K RACMFLG,RALOC,^TMP($J,"RA DIFF PRC")
"RTN","RAORD5",78,0)
 Q
"RTN","RAORD5",79,0)
PHONE(X,Y) ; Setup phone information for Resident Physicians, Attending
"RTN","RAORD5",80,0)
 ; Physicians, and Primary Physicians.
"RTN","RAORD5",81,0)
 ; 'X' -> $S('A':'Attending','OA':'Old Attending','OP':'Old Primary',
"RTN","RAORD5",82,0)
 ; ,'P':'Primary','R':'Resident')
"RTN","RAORD5",83,0)
 ; 'Y' -> ien for file 200
"RTN","RAORD5",84,0)
 ; RA(X_"PHON")=Phone node  <> RA(X_"OPHO")=Office phone
"RTN","RAORD5",85,0)
 ; RA(X_"VPGR")=Voice pager <> RA(X_"DPGR")=Digital pager
"RTN","RAORD5",86,0)
 ; RA(X_"PHOINFO")=office phone/voice pager/digital pager
"RTN","RAORD5",87,0)
 S RA(X_"PHON")=$G(^VA(200,+Y,.13))
"RTN","RAORD5",88,0)
 S RA(X_"OPHO")=$P(RA(X_"PHON"),U,2),RA(X_"VPGR")=$P(RA(X_"PHON"),U,7)
"RTN","RAORD5",89,0)
 S RA(X_"DPGR")=$P(RA(X_"PHON"),U,8)
"RTN","RAORD5",90,0)
 S RA(X_"PHOINFO")=RA(X_"OPHO")_" / "_RA(X_"VPGR")_" / "_RA(X_"DPGR")
"RTN","RAORD5",91,0)
 S:RA(X_"PHOINFO")=" /  / " RA(X_"PHOINFO")="Unknown"
"RTN","RAORD5",92,0)
 Q
"RTN","RAORD6")
0^14^B44182217
"RTN","RAORD6",1,0)
RAORD6 ;HISC/CAH,FPT,GJC AISC/RMO-Print A Request Cont. ;2/2/98  15:28
"RTN","RAORD6",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,10,15,18,27,45**;Mar 16, 1998
"RTN","RAORD6",3,0)
 D HD Q:RAX["^"
"RTN","RAORD6",4,0)
 I $P(RADPT0,U,2)="F" D  ;display pregnancy status for females ptch 45
"RTN","RAORD6",5,0)
 .W !,"Pregnancy Status: ",?22,$S($P(RAORD0,"^",13)="y":"Patient is Pregnant",$P(RAORD0,"^",13)="n":"Patient not pregnant at time of order",1:"Unknown")
"RTN","RAORD6",6,0)
 .Q
"RTN","RAORD6",7,0)
 W:$P(RAORD0,"^",24)="y" !!?12,"*** Universal Isolation Precautions ***"
"RTN","RAORD6",8,0)
 W:$D(RA("VDT")) !!?8,"** Note Request Associated with Visit on ",RA("VDT")," **"
"RTN","RAORD6",9,0)
 W !!,"Requested:",?18,RA("PRC INFO")
"RTN","RAORD6",10,0)
 I $D(^TMP($J,"RA DIFF PRC")),('$D(RAFOERR)),('$D(RAOPT("REG"))),('$D(RAOPT("ORDEREXAM"))),('$D(RAOPT("ADDEXAM"))) D  Q:RAX["^"
"RTN","RAORD6",11,0)
 . ; don't print registered procedure info (CPT, Proc Type, Imaging
"RTN","RAORD6",12,0)
 . ; Type) if entering through 'Request An Exam', 'Register Patient
"RTN","RAORD6",13,0)
 . ; for Exams' or 'Add Exams To Last Visit'.  Don't print if ordered
"RTN","RAORD6",14,0)
 . ; through ANY version of OE/RR.  If ordered through OE/RR, RAFOERR
"RTN","RAORD6",15,0)
 . ; will be defined. (Set in RAORD1 & RAO7RO)
"RTN","RAORD6",16,0)
 . N RAT,RA18NLIN S RAT="",RA18NLIN=0 W !,"Registered:"
"RTN","RAORD6",17,0)
 . F  S RAT=$O(^TMP($J,"RA DIFF PRC",RAT)) Q:RAT=""  D  Q:RAX["^"
"RTN","RAORD6",18,0)
 .. D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",19,0)
 .. W:RA18NLIN ! W ?12,RAT
"RTN","RAORD6",20,0)
 .. S RA18NLIN=1
"RTN","RAORD6",21,0)
 .. Q
"RTN","RAORD6",22,0)
 . Q
"RTN","RAORD6",23,0)
 I $G(RACMFLG("O"))'="" W !?12,"** The requested procedure has contrast media assigned **"
"RTN","RAORD6",24,0)
 I $G(RACMFLG("R"))'="" W !?12,"** A registered procedure uses contrast media **"
"RTN","RAORD6",25,0)
 W:$D(RA("MOD")) !,"Procedure Modifiers:",?22,RA("MOD")
"RTN","RAORD6",26,0)
 I RA("PRC MSG") D  Q:RAX["^"
"RTN","RAORD6",27,0)
 . N A,B,C,X S (A,C)=0 W !,"Procedure Message: ",!
"RTN","RAORD6",28,0)
 . F  S A=$O(^RAMIS(71,+$P(RAORD0,"^",2),3,A)) Q:A'>0!(RAX["^")  D
"RTN","RAORD6",29,0)
 .. S B=+$G(^RAMIS(71,+$P(RAORD0,"^",2),3,A,0))
"RTN","RAORD6",30,0)
 .. S X=$G(^RAMIS(71.4,B,0))
"RTN","RAORD6",31,0)
 .. W:'C ?3,"-" W:C !?3,"-"
"RTN","RAORD6",32,0)
 .. D OUTTEXT^RAUTL9(X,"",5,80,4,"","!")
"RTN","RAORD6",33,0)
 .. D HD:($Y+6)>IOSL S C=C+1
"RTN","RAORD6",34,0)
 .. Q
"RTN","RAORD6",35,0)
 . Q
"RTN","RAORD6",36,0)
 W !,"Request Status:",?22,$E(RA("OST"),1,24)
"RTN","RAORD6",37,0)
 I $P(RAORD0,"^",5)=1!($P(RAORD0,"^",5)=3) D  Q:RAX["^"
"RTN","RAORD6",38,0)
 . W !,"Reason ",$S($P(RAORD0,"^",5)=1:"Cancelled",1:"Held"),":"
"RTN","RAORD6",39,0)
 . W ?22,$S($D(^RA(75.2,+$P(RAORD0,"^",10),0)):$E($P(^(0),"^"),1,50),$P(RAORD0,"^",27)]"":$E($P(RAORD0,"^",27),1,50),1:"UNKNOWN")
"RTN","RAORD6",40,0)
 . D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",41,0)
 . I $D(^RAO(75.1,RAOIFN,1)) D  Q:RAX["^"
"RTN","RAORD6",42,0)
 .. N X,I,RAXX
"RTN","RAORD6",43,0)
 .. K ^UTILITY($J,"W")
"RTN","RAORD6",44,0)
 .. W !,"Hold Description:",!
"RTN","RAORD6",45,0)
 .. S I=0 F  S I=$O(^RAO(75.1,RAOIFN,1,I)) Q:'I  S (RAXX,X)=^(I,0) D HD:($Y+6)>IOSL Q:RAX["^"  S X=RAXX D ^DIWP
"RTN","RAORD6",46,0)
 .. Q:RAX["^"
"RTN","RAORD6",47,0)
 .. D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",48,0)
 .. D ^DIWW:$D(RAXX)
"RTN","RAORD6",49,0)
 .. D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",50,0)
 . I $P(RAORD0,"^",5)=1 D
"RTN","RAORD6",51,0)
 .. W !!,?(IOM-(IOM/2+15)),"*********************",!,?(IOM-(IOM/2+15)),"* C A N C E L L E D *",!,?(IOM-(IOM/2+15)),"*********************"
"RTN","RAORD6",52,0)
 W:$P(RAORD0,"^",5)=6&($D(RA("ST"))) !,"Exam Status:",?22,RA("ST")
"RTN","RAORD6",53,0)
 W:$P(RAORD0,"^",5)=8&($D(RA("SDT"))) !,"Exam Scheduled:",?22,RA("SDT")
"RTN","RAORD6",54,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",55,0)
 W !!,"Requester:",?22,$E(RA("PHY"),1,20)
"RTN","RAORD6",56,0)
 W:RA("PHY")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("RPHOINFO"))
"RTN","RAORD6",57,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",58,0)
 W !,"Attend Phy Current:",?22,$E(RA("ATTEN"),1,20)
"RTN","RAORD6",59,0)
 W:RA("ATTEN")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("APHOINFO"))
"RTN","RAORD6",60,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",61,0)
 W !,"Prim Phy Current:",?22,$E(RA("PRIM"),1,20)
"RTN","RAORD6",62,0)
 W:RA("PRIM")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("PPHOINFO"))
"RTN","RAORD6",63,0)
 K RAPASS1,RAPASS2
"RTN","RAORD6",64,0)
 S RAPASS1=RA("ATTEN"),RAPASS2=RA("OATTEN")
"RTN","RAORD6",65,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",66,0)
 I $$ID^RAORD6(RAPASS1,RAPASS2) D
"RTN","RAORD6",67,0)
 . W !,"Attend Phy At Order:",?22,$E(RA("OATTEN"),1,20)
"RTN","RAORD6",68,0)
 . W:RA("OATTEN")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("OAPHOINFO"))
"RTN","RAORD6",69,0)
 . Q
"RTN","RAORD6",70,0)
 S RAPASS1=RA("PRIM"),RAPASS2=RA("OPRIM")
"RTN","RAORD6",71,0)
 I $$ID^RAORD6(RAPASS1,RAPASS2) D
"RTN","RAORD6",72,0)
 . W !,"Prim Phy At Order:",?22,$E(RA("OPRIM"),1,20)
"RTN","RAORD6",73,0)
 . W:RA("OPRIM")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("OPPHOINFO"))
"RTN","RAORD6",74,0)
 . Q
"RTN","RAORD6",75,0)
 K RAPASS1,RAPASS2
"RTN","RAORD6",76,0)
 I +$P(RAORD0,"^",8) D
"RTN","RAORD6",77,0)
 . N RAPPRAD S RAPPRAD=+$P(RAORD0,"^",8)
"RTN","RAORD6",78,0)
 . S:$P($G(^VA(200,RAPPRAD,20)),"^",2)]"" RAPPRAD=$P(^(20),"^",2)
"RTN","RAORD6",79,0)
 . S:RAPPRAD=+RAPPRAD RAPPRAD=$P(^VA(200,RAPPRAD,0),"^")
"RTN","RAORD6",80,0)
 . W !,"Approved by: ",?22,RAPPRAD
"RTN","RAORD6",81,0)
 . Q
"RTN","RAORD6",82,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",83,0)
 W !,"Date/Time Ordered:",?22,$S($D(RA("ODT")):RA("ODT"),1:""),"  by ",$E(RA("USR"),1,20)
"RTN","RAORD6",84,0)
 W:$D(RA("RDT")) !,"Date Desired:",?22,RA("RDT")
"RTN","RAORD6",85,0)
 D:$P(RAORD0,"^",5)=1 USERCAN^RAORD3
"RTN","RAORD6",86,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",87,0)
 W:$D(RA("PDT")) !,"Pre-op Date/Time:",?22,RA("PDT"),!!?26,"**** P R E - O P ****",!
"RTN","RAORD6",88,0)
BAR ;Print bar-coded SSN on request form if term type has bar code setup
"RTN","RAORD6",89,0)
 I $G(RASSN)'?3N1"-"2N1"-".E G CONT
"RTN","RAORD6",90,0)
 S X3=$E(RASSN,1,3)_$E(RASSN,5,6)_$E(RASSN,8,11)
"RTN","RAORD6",91,0)
 D PSET^%ZISP I IOBARON]"",(IOBAROFF]"") W !?49,@IOBARON,X3,@IOBAROFF,!
"RTN","RAORD6",92,0)
 D PKILL^%ZISP
"RTN","RAORD6",93,0)
 ;
"RTN","RAORD6",94,0)
CONT D HD:($Y+6)>IOSL Q:RAX["^"  K ^UTILITY($J,"W"),^(1) W !!,"Clinical History:",! K RAXX F RAV=0:0 S RAV=$O(^RAO(75.1,RAOIFN,"H",RAV)) Q:'RAV  I $D(^(RAV,0)) S RAXX=^(0) D HD:($Y+6)>IOSL Q:RAX["^"  S X=RAXX D ^DIWP
"RTN","RAORD6",95,0)
 Q:RAX["^"  D HD:($Y+6)>IOSL Q:RAX["^"  D ^DIWW:$D(RAXX),HD:($Y+6)>IOSL Q:RAX["^"  D WORK ;always print bottom section of form 012601
"RTN","RAORD6",96,0)
 W ! S BOT=IOSL-($Y+4) S:($E(IOST,1,6)="P-BROW"&($D(DDBRZIS))) BOT=5 F BT=1:1:BOT W !
"RTN","RAORD6",97,0)
 K BOT,BT
"RTN","RAORD6",98,0)
 W !,"VA Form 519a-ADP"
"RTN","RAORD6",99,0)
 Q
"RTN","RAORD6",100,0)
 ;
"RTN","RAORD6",101,0)
WORK W !,RALNE,!,"Date Performed: ________________________",?46
"RTN","RAORD6",102,0)
 I $O(^RADPT("AO",RAOIFN,0))="" W "Case No.: ______________________"
"RTN","RAORD6",103,0)
 E  W "Case No.: ______see above_______"
"RTN","RAORD6",104,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",105,0)
 W !,"Technologist Initials: _________________"
"RTN","RAORD6",106,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",107,0)
 W !?46,"Number/Size Films: _____________",!,"Interpreting Phys. Initials: ___________",?65,"_____________",!?65,"_____________",!
"RTN","RAORD6",108,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",109,0)
 W !,"Comments:"
"RTN","RAORD6",110,0)
 ;
"RTN","RAORD6",111,0)
TC D EN30^RAO7PC1(RAOIFN),TC^RAORD61 Q:RAX["^"
"RTN","RAORD6",112,0)
 ;
"RTN","RAORD6",113,0)
DASHLN W ! F I=1:1:5 D HD:($Y+6)>IOSL Q:RAX["^"  W !,RALNE ;P18
"RTN","RAORD6",114,0)
 Q
"RTN","RAORD6",115,0)
 ;
"RTN","RAORD6",116,0)
HD S:'$D(RAPGE) RAPGE=0 D CRCHK Q:$G(RAX)["^"  S RATAB=$S($D(RA("ILC")):1,1:16)
"RTN","RAORD6",117,0)
 W:$Y @IOF W !?RATAB,">>"_$S($D(RACRHD):"Discontinued ",1:"")_"Rad/Nuc Med Consultation" W:$D(RA("ILC")) " for ",$E(RA("ILC"),1,17) W "<<" S X="NOW",%DT="T" D ^%DT K %DT D D^RAUTL W ?52,Y ;P18
"RTN","RAORD6",118,0)
 S RAPGE=RAPGE+1 W ?71,"Page ",RAPGE ;P18
"RTN","RAORD6",119,0)
 W !,RALNE1,!,"Name         : ",RA("NME"),?46,"Urgency    : ",RA("OUG") W:$D(RA("PORTABLE")) "  *PORTABLE*"
"RTN","RAORD6",120,0)
 W !,"Pt ID Num    : ",RASSN,?46,"Transport  : ",RA("TRAN")
"RTN","RAORD6",121,0)
 S Y=RA("DOB") D D^RAUTL W !,"Date of Birth: ",Y,?46,"Patient Loc: ",$E(RA("HLC"),1,20)
"RTN","RAORD6",122,0)
 W !,"Age          : ",RA("AGE"),?46,"Phone Ext  : ",RA("HPH")
"RTN","RAORD6",123,0)
 W !,"Sex          : ",$S(RA("SEX")="M":"MALE",1:"FEMALE") W:$D(RA("ROOM-BED")) ?46,"Room-Bed   : ",RA("ROOM-BED") W !,RALNE1
"RTN","RAORD6",124,0)
 W:$P(RAORD0,U,5)=1 !,"***C A N C E L L E D***",?56,"***C A N C E L L E D***"
"RTN","RAORD6",125,0)
 Q
"RTN","RAORD6",126,0)
 ;
"RTN","RAORD6",127,0)
CRCHK I RAPGE,$E(IOST)="C" W !!,$C(7),"Press RETURN to continue or '^' to stop " R X:DTIME S RAX=X
"RTN","RAORD6",128,0)
 Q
"RTN","RAORD6",129,0)
ID(X,Y) ; Checks for the following condition:
"RTN","RAORD6",130,0)
 ; 1) Attending Phy. Current & Attending Phy. At Order are the same.
"RTN","RAORD6",131,0)
 ; 2) Primary Phy. Current & Primary Phy. At Order are the same.
"RTN","RAORD6",132,0)
 ; Input Variables:
"RTN","RAORD6",133,0)
 ; 'X'-> Attending/Primary Phy. Current
"RTN","RAORD6",134,0)
 ; 'Y'-> Attending/Primary Phy. At Order
"RTN","RAORD6",135,0)
 I X']""!(Y']"") Q 0
"RTN","RAORD6",136,0)
 I $$UP^XLFSTR(X)="UNKNOWN",($$UP^XLFSTR(Y)="UNKNOWN") Q 0
"RTN","RAORD6",137,0)
 N A,B,Z S A=+$O(^VA(200,"B",X,"")),B=+$O(^VA(200,"B",Y,""))
"RTN","RAORD6",138,0)
 I A>0,(B>0),(A=B) S Z=0
"RTN","RAORD6",139,0)
 E  S Z=1
"RTN","RAORD6",140,0)
 Q Z ; $S(Z=1:"different physician",Z=0:"same physician")
"RTN","RAORD61")
0^25^B6446942
"RTN","RAORD61",1,0)
RAORD61 ;HISC/GJC-Print A Request Cont. ;2/2/98  15:28
"RTN","RAORD61",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RAORD61",3,0)
 ;
"RTN","RAORD61",4,0)
TC ;technologist information & comment (called from RAORD6)
"RTN","RAORD61",5,0)
 N RA18FL,RA18ARR,RA18EX,RA18CNI,RA18DTI,RA18PRC,RA18ND,RA18TC S RA18EX=0,RA18CNI=0
"RTN","RAORD61",6,0)
 S RA18DTI=$O(^RADPT("AO",RAOIFN,RADFN,0)) G:RA18DTI="" DASHLN^RAORD6
"RTN","RAORD61",7,0)
 F  S RA18CNI=$O(^TMP($J,"RAE2",RADFN,RA18CNI)) Q:+RA18CNI=0  D  Q:RAX["^"
"RTN","RAORD61",8,0)
 . S RA18PRC=""
"RTN","RAORD61",9,0)
 . F  S RA18PRC=$O(^TMP($J,"RAE2",RADFN,RA18CNI,RA18PRC)) Q:RA18PRC=""  D  Q:RAX["^"
"RTN","RAORD61",10,0)
 .. ;case info
"RTN","RAORD61",11,0)
 .. W !,"Case No: "_$P($G(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,0)),"^")
"RTN","RAORD61",12,0)
 .. S RA18FL=0,RA18ARR("FT")=""
"RTN","RAORD61",13,0)
 .. S RA18TC=0 F  S RA18TC=$O(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,"F",RA18TC)) Q:RA18TC=""  S RA18ARR("F")=$G(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,"F",RA18TC,0),0) D  Q:$L(RA18ARR("FT"))>32
"RTN","RAORD61",14,0)
 ... I RA18ARR("F")'=0 S RA18ARR("FT")=RA18ARR("FT")_$P($G(RA18ARR("F")),"^",2)_"-"_$P($G(^RA(78.4,$P($G(RA18ARR("F")),"^",1),0)),"^",1)_";"
"RTN","RAORD61",15,0)
 .. S RA18TC=0 F  S RA18TC=$O(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,"TC",RA18TC)) Q:RA18TC=""  S RA18ARR("T",RA18TC,0)=$G(^RADPT(RADFN,"DT",RA18DTI,"P",RA18CNI,"TC",RA18TC,0),0) D
"RTN","RAORD61",16,0)
 ... I RA18ARR("T",RA18TC,0)'=0 W:RA18FL>0 ! W ?14,"Tech: " I RA18ARR("T",RA18TC,0)'="" S RA18ARR("N")=$$GET1^DIQ(200,RA18ARR("T",RA18TC,0),.01) W $E($P(RA18ARR("N"),"^",1),1,18)
"RTN","RAORD61",17,0)
 ... W:(RA18FL'>0) ?38,"  Film: "_$E(RA18ARR("FT"),1,32)
"RTN","RAORD61",18,0)
 ... S RA18FL=RA18FL+1
"RTN","RAORD61",19,0)
 .. I '$D(RA18ARR("T")) W ?14,"Tech: ",?38,"  Film: "_$E(RA18ARR("FT"),1,32)
"RTN","RAORD61",20,0)
 .. K RA18ARR("T"),RA18ARR("F"),RA18ARR("N")
"RTN","RAORD61",21,0)
 .. I $O(^TMP($J,"RAE2",RADFN,RA18CNI,RA18PRC,"TCOM",0))>0 D  Q
"RTN","RAORD61",22,0)
 ... ;tech comm
"RTN","RAORD61",23,0)
 ... W !
"RTN","RAORD61",24,0)
 ... S RA18EX=$$TXTOUT^RAUTL11(^TMP($J,"RAE2",RADFN,RA18CNI,RA18PRC,"TCOM",1),1,70,-1,"",4,1,1,1)
"RTN","RAORD61",25,0)
 ... D HD^RAORD6:($Y+6)>IOSL
"RTN","RAORD61",26,0)
 Q
"RTN","RAORD61",27,0)
 ;
"RTN","RAPINFO")
0^22^B29510727
"RTN","RAPINFO",1,0)
RAPINFO ;HIRMFO/GJC - Display Imaging Procedure Rad/Nuc Med info ;11/5/99  12:32
"RTN","RAPINFO",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,45**;Mar 16, 1998
"RTN","RAPINFO",3,0)
EN1 ; Associated option: [DISPLAY IMAGING PROCEDURE RAD/NUC MED INFORMATION]
"RTN","RAPINFO",4,0)
 N RADIC,RAINA,RAITYPE,RAQUIT,RAUTIL
"RTN","RAPINFO",5,0)
 K ^TMP($J,"RA PROCEDURES") W !
"RTN","RAPINFO",6,0)
 S DIC="^RA(79.2,",DIC(0)="QEAMNZ",DIC("A")="Select an Imaging Type: "
"RTN","RAPINFO",7,0)
 S DIC("W")="D DICW^RAPINFO"
"RTN","RAPINFO",8,0)
 S DIC("S")="I ($D(^RAMIS(71,""AIMG"",+Y))\10)"
"RTN","RAPINFO",9,0)
 D ^DIC K DIC
"RTN","RAPINFO",10,0)
 I Y'>0 D KILL Q
"RTN","RAPINFO",11,0)
 S RAITYPE=Y ; 'RAITYPE' = ien of entry in 79.2 ^ .01 value in 79.2
"RTN","RAPINFO",12,0)
 ;
"RTN","RAPINFO",13,0)
PROC ; Procedure selection O-M-A
"RTN","RAPINFO",14,0)
 S RADIC="^RAMIS(71,",RADIC("A")="Select a Rad/Nuc Med Procedure: "
"RTN","RAPINFO",15,0)
 S RADIC(0)="QEANMZ",RADIC("S")="I $$DICS^RAPINFO(RAITYPE,+Y)"
"RTN","RAPINFO",16,0)
 S RAUTIL="RA PROCEDURES" D EN1^RASELCT(.RADIC,RAUTIL)
"RTN","RAPINFO",17,0)
 I '($D(^TMP($J,"RA PROCEDURES"))\10) D KILL Q  ; quit, nothing selected
"RTN","RAPINFO",18,0)
DEV ; Device selection
"RTN","RAPINFO",19,0)
 W ! S %ZIS="QM",%ZIS("A")="Select a Device: " D ^%ZIS W !
"RTN","RAPINFO",20,0)
 I POP K %ZIS D KILL Q
"RTN","RAPINFO",21,0)
 I $D(IO("Q")) D  D KILL Q
"RTN","RAPINFO",22,0)
 . S ZTRTN="START^RAPINFO"
"RTN","RAPINFO",23,0)
 . S ZTSAVE("^TMP($J,""RA PROCEDURES"",")=""
"RTN","RAPINFO",24,0)
 . S ZTDESC="Rad/Nuc Med Display Imaging Procedure information"
"RTN","RAPINFO",25,0)
 . D ^%ZTLOAD
"RTN","RAPINFO",26,0)
 . I +$G(ZTSK("D"))>0 D
"RTN","RAPINFO",27,0)
 .. W !?5,"Request Queued, Task #: ",+$G(ZTSK)
"RTN","RAPINFO",28,0)
 .. Q
"RTN","RAPINFO",29,0)
 . E  W !?5,"Request cancelled!"
"RTN","RAPINFO",30,0)
 . D HOME^%ZIS K IO("Q")
"RTN","RAPINFO",31,0)
 . Q
"RTN","RAPINFO",32,0)
START ; Start processing data & printing to the device here.
"RTN","RAPINFO",33,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RAPINFO",34,0)
 U IO N I,J,RA0,RA1,RA2,RA71,RADD,RAHDR,RAIDFIER,RALN,RAMAX,RANOW,RAPG
"RTN","RAPINFO",35,0)
 N RARUNDT,RAXIT S RA0="",(RAMAX,RAPG,RAXIT)=0
"RTN","RAPINFO",36,0)
 S RAHDR="Radiology/Nuclear Medicine Procedure Information"
"RTN","RAPINFO",37,0)
 S $P(RALN,"-",(IOM+1))=""
"RTN","RAPINFO",38,0)
 S RADD=$P($G(^DD(71,6,0)),"^",3)
"RTN","RAPINFO",39,0)
 F I=1:1:$L(RADD,";") S J=$P($P(RADD,";",I),":",2) Q:J']""  D
"RTN","RAPINFO",40,0)
 . S:$L(J)>RAMAX RAMAX=$L(J)
"RTN","RAPINFO",41,0)
 . Q
"RTN","RAPINFO",42,0)
 S RANOW=$$NOW^XLFDT(),RANOW=$P(RANOW,".")_"."_$E($P(RANOW,".",2),1,4)
"RTN","RAPINFO",43,0)
 S RARUNDT=$$FMTE^XLFDT(RANOW,"1P") D HDR^RAPINFO G:RAXIT KILL
"RTN","RAPINFO",44,0)
 F  S RA0=$O(^TMP($J,"RA PROCEDURES",RA0)) Q:RA0=""  D  Q:RAXIT
"RTN","RAPINFO",45,0)
 . S RA1=0
"RTN","RAPINFO",46,0)
 . F  S RA1=$O(^TMP($J,"RA PROCEDURES",RA0,RA1)) Q:RA1'>0  D  Q:RAXIT
"RTN","RAPINFO",47,0)
 .. S RA71=$G(^RAMIS(71,RA1,0)) Q:RA71']""
"RTN","RAPINFO",48,0)
 .. S RAIDFIER=$$BLD^RAPINFO(RA1)
"RTN","RAPINFO",49,0)
 .. I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  D HDR^RAPINFO
"RTN","RAPINFO",50,0)
 .. Q:RAXIT  W !,$E(RA0,1,30),?34,RAIDFIER
"RTN","RAPINFO",51,0)
 ..;
"RTN","RAPINFO",52,0)
 ..;check if the descendents have CM relations
"RTN","RAPINFO",53,0)
 ..I $P(RA71,U,6)="P" D  Q:RAXIT
"RTN","RAPINFO",54,0)
 ...S RA2=0 F  S RA2=$O(^RAMIS(71,RA1,4,RA2)) Q:'RA2  D  Q:RAXIT
"RTN","RAPINFO",55,0)
 ....S RA21=+$G(^RAMIS(71,RA1,4,RA2,0)) D DESC(RA21,"P")
"RTN","RAPINFO",56,0)
 ....Q
"RTN","RAPINFO",57,0)
 ...K RA2,RA21 Q
"RTN","RAPINFO",58,0)
 ..;
"RTN","RAPINFO",59,0)
 ..;check if the non-parent has CM relations
"RTN","RAPINFO",60,0)
 ..E  D:$O(^RAMIS(71,RA1,"CM",0)) DESC(RA1,"") Q:RAXIT
"RTN","RAPINFO",61,0)
 ..;
"RTN","RAPINFO",62,0)
 .. I $O(^RAMIS(71,RA1,"EDU",0)) D
"RTN","RAPINFO",63,0)
 ... S DIWF="W",DIWL=1,DIWR=$S(IOM=132:100,1:76)
"RTN","RAPINFO",64,0)
 ... S RA2=0 K ^UTILITY($J,"W") S X="Educational Desc: "
"RTN","RAPINFO",65,0)
 ... F  S RA2=$O(^RAMIS(71,RA1,"EDU",RA2)) Q:RA2'>0  D  K X Q:RAXIT
"RTN","RAPINFO",66,0)
 .... I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  D HDR^RAPINFO
"RTN","RAPINFO",67,0)
 .... Q:RAXIT  S X=$G(X)_$G(^RAMIS(71,RA1,"EDU",RA2,0)) Q:X']""  D ^DIWP
"RTN","RAPINFO",68,0)
 .... Q
"RTN","RAPINFO",69,0)
 ... D:'RAXIT ^DIWW ; *** procedure message text to be printed
"RTN","RAPINFO",70,0)
 ... Q  ;             *** once procedure messages are changed to WP
"RTN","RAPINFO",71,0)
 .. E  W ! ;          *** from pointers to 71.4 ***
"RTN","RAPINFO",72,0)
 .. Q
"RTN","RAPINFO",73,0)
 . Q
"RTN","RAPINFO",74,0)
 W ! D ^%ZISC,KILL
"RTN","RAPINFO",75,0)
 Q
"RTN","RAPINFO",76,0)
BLD(RA1) ; Build procedure identifier string
"RTN","RAPINFO",77,0)
 ; input: 'RA1' = ien of entry in Rad/Nuc Med Procedures file 
"RTN","RAPINFO",78,0)
 N RA,RACPT,RAIABRV,RAPTYPE,RASTR S RASTR="("
"RTN","RAPINFO",79,0)
 S RA(0)=$G(^RAMIS(71,RA1,0)),RA("I")=$G(^RAMIS(71,RA1,"I"))
"RTN","RAPINFO",80,0)
 S RAIABRV(0)=+$P(RA(0),"^",12)
"RTN","RAPINFO",81,0)
 S RAIABRV(1)=$P($G(^RA(79.2,RAIABRV(0),0)),"^",3)
"RTN","RAPINFO",82,0)
 S RAIABRV=$S(RAIABRV(1)]"":RAIABRV(1),1:"Unknown")
"RTN","RAPINFO",83,0)
 I RA("I"),(RA("I")'>DT) S RAPTYPE="Inactive"
"RTN","RAPINFO",84,0)
 I $D(RAPTYPE)[0 D
"RTN","RAPINFO",85,0)
 . S RAPTYPE=$$XTERNAL^RAUTL5($P(RA(0),"^",6),$P($G(^DD(71,6,0)),"^",2))
"RTN","RAPINFO",86,0)
 . S RAPTYPE=$E(RAPTYPE)_$$LOW^XLFSTR($E(RAPTYPE,2,99999))
"RTN","RAPINFO",87,0)
 . S:RAPTYPE']"" RAPTYPE="Unknown"
"RTN","RAPINFO",88,0)
 . Q
"RTN","RAPINFO",89,0)
 S:$L(RAPTYPE)<RAMAX RAPTYPE=RAPTYPE_$E("        ",1,(RAMAX-$L(RAPTYPE)))
"RTN","RAPINFO",90,0)
 S RACPT(0)=+$P(RA(0),"^",9) S:'RACPT(0) RACPT="Unknown"
"RTN","RAPINFO",91,0)
 S:$E(RAPTYPE)="P" RACPT="See Descendents"
"RTN","RAPINFO",92,0)
 I '($D(RACPT)#2) D
"RTN","RAPINFO",93,0)
 . S RACPT=$P($$NAMCODE^RACPTMSC(RACPT(0),DT),"^")
"RTN","RAPINFO",94,0)
 . S:RACPT="" RACPT="Unknown"
"RTN","RAPINFO",95,0)
 . Q
"RTN","RAPINFO",96,0)
 S RASTR=RASTR_RAIABRV_"  "_RAPTYPE_") CPT:"_RACPT
"RTN","RAPINFO",97,0)
 Q RASTR
"RTN","RAPINFO",98,0)
 ;
"RTN","RAPINFO",99,0)
DICS(RAY,Y) ; Display active procedures within an imaging type.
"RTN","RAPINFO",100,0)
 ; Input : RAY - Imaging Type
"RTN","RAPINFO",101,0)
 ;           Y - ien of the procedure
"RTN","RAPINFO",102,0)
 ; Output: 1 if a valid selection, 0 if invalid
"RTN","RAPINFO",103,0)
 Q:'$D(^RAMIS(71,"AIMG",+RAITYPE,+Y))#2 0 ; not valid, wrong i-type
"RTN","RAPINFO",104,0)
 N RA71ACT S RA71ACT=$G(^RAMIS(71,+Y,"I"))
"RTN","RAPINFO",105,0)
 Q $S(RA71ACT="":1,RA71ACT>DT:1,1:0)
"RTN","RAPINFO",106,0)
 ;
"RTN","RAPINFO",107,0)
DICW ; Display abbreviation with the I-Type
"RTN","RAPINFO",108,0)
 N RA792,RABBRV
"RTN","RAPINFO",109,0)
 S RA792=$G(^RA(79.2,+Y,0)),RABBRV=$P(RA792,"^",3)
"RTN","RAPINFO",110,0)
 S RABBRV(1)=$S(RABBRV]"":"   "_RABBRV,1:"   Unknown")
"RTN","RAPINFO",111,0)
 S RABBRV(1,"F")="?0" D EN^DDIOL(.RABBRV)
"RTN","RAPINFO",112,0)
 Q
"RTN","RAPINFO",113,0)
HDR ; Header for our report
"RTN","RAPINFO",114,0)
 W:$Y @IOF S RAPG=RAPG+1
"RTN","RAPINFO",115,0)
 W !?(IOM-$L(RAHDR)\2),RAHDR
"RTN","RAPINFO",116,0)
 W !!,"Run Date/Time: ",RARUNDT,?($S(IOM=132:121,1:68)),"Page: ",RAPG
"RTN","RAPINFO",117,0)
 W !,RALN
"RTN","RAPINFO",118,0)
 I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAXIT=1
"RTN","RAPINFO",119,0)
 Q
"RTN","RAPINFO",120,0)
KILL ; Kill and quit the application
"RTN","RAPINFO",121,0)
 K ^TMP($J,"RA PROCEDURES"),%X,%XX,%Y,%YY
"RTN","RAPINFO",122,0)
 K C,DDH,DIROUT,DIRUT,DIW,DIWF,DIWL,DIWR,DIWT,DN,DTOUT,DUOUT,X,Y
"RTN","RAPINFO",123,0)
 K Z,ZTDESC,ZTRTN,ZTSAVE,I,POP,DISYS
"RTN","RAPINFO",124,0)
 Q
"RTN","RAPINFO",125,0)
 ;
"RTN","RAPINFO",126,0)
DESC(RAPRC,RAFLG) ; display the descendants associated with the
"RTN","RAPINFO",127,0)
 ; parent procedure
"RTN","RAPINFO",128,0)
 ;input: RAPRC-IEN of the procedure in the Rad/Nuc Med Procedure file
"RTN","RAPINFO",129,0)
 ;       RAFLG-indicates procedure type; "P" if parent, else null
"RTN","RAPINFO",130,0)
 I RAFLG="P" D  Q:RAXIT
"RTN","RAPINFO",131,0)
 .S RAIDFIER=$$BLD^RAPINFO(RAPRC)
"RTN","RAPINFO",132,0)
 .I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  D HDR^RAPINFO
"RTN","RAPINFO",133,0)
 .Q:RAXIT  W:$X ! W ?2,$E($P($G(^RAMIS(71,RAPRC,0)),U),1,30),?34,RAIDFIER
"RTN","RAPINFO",134,0)
 .Q
"RTN","RAPINFO",135,0)
 Q:+$O(^RAMIS(71,RAPRC,"CM",0))=0
"RTN","RAPINFO",136,0)
CMEDIA ; display the contrast media associated with the parent procedure
"RTN","RAPINFO",137,0)
 K X,^UTILITY($J,"W") S RA3=0,X="Contrast Media: "
"RTN","RAPINFO",138,0)
 S DIWF="W",DIWL=3,DIWR=$S(IOM=132:100,1:76)
"RTN","RAPINFO",139,0)
 F  S RA3=$O(^RAMIS(71,RAPRC,"CM",RA3)) Q:RA3'>0  D
"RTN","RAPINFO",140,0)
 .S RA3(0)=$P($G(^RAMIS(71,RAPRC,"CM",RA3,0)),U)
"RTN","RAPINFO",141,0)
 .S X=X_$$EXTERNAL^DILFD(71.0125,.01,"",RA3(0))_", "
"RTN","RAPINFO",142,0)
 .Q
"RTN","RAPINFO",143,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  D HDR^RAPINFO
"RTN","RAPINFO",144,0)
 S X=$P(X,", ",1,$L(X,", ")-1) D ^DIWP,^DIWW
"RTN","RAPINFO",145,0)
 K ^UTILITY($J,"W"),DIWF,DIWL,DIWR,RA3,X
"RTN","RAPINFO",146,0)
 Q
"RTN","RAPINFO",147,0)
 ;
"RTN","RAPROD")
0^19^B40468374
"RTN","RAPROD",1,0)
RAPROD ;HISC/FPT,GJC AISC/MJK-Detailed Exam View ;8/1/97  11:13
"RTN","RAPROD",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,35,45**;Mar 16, 1998
"RTN","RAPROD",3,0)
START S RADI=^RADPT(RADFN,"DT",RADTI,0) S:$D(^("P",RACNI,"COMP")) RA("COMP")=^("COMP") S RA("REA")=$S($D(^("R")):^("R"),1:"")
"RTN","RAPROD",4,0)
 S RA("TECH")=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0)) I RA("TECH") S RA("TECH")=$S($D(^VA(200,+^(RA("TECH"),0),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD",5,0)
 S X=$P(Y(0),"^",4),RA("CAT")=$S(X="I":"INPATIENT",X="O":"OUTPATIENT",X="S":"SHARING",X="C":"CONTRACT",X="R":"RESEARCH",X="E":"EMPLOYEE",1:"UNKNOWN")
"RTN","RAPROD",6,0)
 S X=$S($D(^RARPT(+RARPT,0)):$P(^(0),"^",5),1:""),RA("RST")=$S(X="D":"DRAFT",X="V":"VERIFIED",X="R":"RELEASED/NOT VERIFIED",X="PD":"PROBLEM DRAFT",1:"NO REPORT")
"RTN","RAPROD",7,0)
 F I=1:1:13 S Y=$T(LIST+I),@$P(Y,";",3)=$S($D(@($P(Y,";",4)_+$P(@$P(Y,";",5),"^",$P(Y,";",6))_",0)")):$P(^(0),"^"),1:"")
"RTN","RAPROD",8,0)
 ;
"RTN","RAPROD",9,0)
 N RAOPRC ; this will be the Requested Procedure defined only if it
"RTN","RAPROD",10,0)
 ; differs from the Registered Procedure
"RTN","RAPROD",11,0)
 I +$P(Y(0),U,11),($$DPROC^RAUTL15(RADFN,RADTI,RACNI,+$P(Y(0),U,11))]"") D
"RTN","RAPROD",12,0)
 . S RAOPRC=$$GET1^DIQ(75.1,+$P(Y(0),"^",11)_",",2)
"RTN","RAPROD",13,0)
 . Q
"RTN","RAPROD",14,0)
VIEW W @IOF S X="",$P(X,"=",80)="" W X K X
"RTN","RAPROD",15,0)
 W !?2,"Name        : ",RANME,"    ",RASSN
"RTN","RAPROD",16,0)
 W !?2,"Division    : ",$E(RA("DIV"),1,20),?40,"Category     : ",RA("CAT")
"RTN","RAPROD",17,0)
 W !?2,"Location    : ",$S($D(^SC(+RA("LOC"),0)):$P(^(0),"^"),1:"Unknown"),?40,"Ward         : ",$E(RA("WRD"),1,24)
"RTN","RAPROD",18,0)
 W !?2,"Exam Date   : ",RADATE,?40,"Service      : ",$E(RA("SERV"),1,24)
"RTN","RAPROD",19,0)
 W !?2,"Case No.    : ",RACN W ?40,"Bedsection   : ",$E(RA("BED"),1,24)
"RTN","RAPROD",20,0)
 W !?40,"Clinic       : ",$E(RA("CL"),1,24)
"RTN","RAPROD",21,0)
 S Y=$E(RA("CAT")) I "CSR"[Y W !?40,$E($S("C"=Y:"Contract     : "_RA("CONT"),"S"=Y:"Sharing      : "_RA("CONT"),"R"=Y:"Research     : "_RA("REA"),1:""),1,38)
"RTN","RAPROD",22,0)
 W:$X>1 ! S X="",$P(X,"-",80)="" W X K X
"RTN","RAPROD",23,0)
 W !?2,"Registered    : ",$E(RAPRC,1,60) D PRCCPT
"RTN","RAPROD",24,0)
 W:$G(RAOPRC)]"" !?2,"Requested     : ",$E(RAOPRC,1,60)
"RTN","RAPROD",25,0)
 W !?2,"Requesting Phy: ",$E(RA("PHY"),1,20),?40,"Exam Status  : ",$S($D(^RA(72,RAST,0)):$E($P(^(0),"^"),1,24),1:"")
"RTN","RAPROD",26,0)
 W !?2,"Int'g Resident: ",$E(RA("RES"),1,20),?40,"Report Status: ",$E(RA("RST"),1,21)
"RTN","RAPROD",27,0)
 S RAPREVER=+$P($G(^RARPT(RARPT,0)),"^",13)
"RTN","RAPROD",28,0)
 W !?2,"Pre-Verified  : ",$E($S($D(^VA(200,RAPREVER,0)):$P(^(0),"^",1),1:"NO"),1,20),?40,"Cam/Equip/Rm : ",$E(RA("RM"),1,20) K RAPREVER
"RTN","RAPROD",29,0)
 W !?2,"Int'g Staff   : ",$E(RA("STAFF"),1,20),?40,"Diagnosis    : ",$E(RA("DIA"),1,24)
"RTN","RAPROD",30,0)
 W !?2,"Technologist  : ",$E(RA("TECH"),1,20),?40,"Complication : ",$E(RA("CMP"),1,24)
"RTN","RAPROD",31,0)
 I $D(RA("COMP")) W !?2,"Comment       : " F I=1:60 Q:$E(RA("COMP"),I,I+59)']""  W ?18,$E(RA("COMP"),I,I+59),!
"RTN","RAPROD",32,0)
 W:$X>1 !
"RTN","RAPROD",33,0)
 K RAFL W ?40,"Films        :" F I=0:0 S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"F",I)) Q:I'>0  I $D(^(I,0)) S X=^(0) W ?55,$S($D(^RA(78.4,+$P(X,"^"),0)):$P(^(0),"^"),1:"Unknown")," - ",+$P(X,"^",2),!
"RTN","RAPROD",34,0)
 W:$X>1 ! S X="",$P(X,"-",34)="" W X
"RTN","RAPROD",35,0)
 W "Modifiers" W $E(X,1,32) K X
"RTN","RAPROD",36,0)
 W !?2,"Proc Modifiers:" D MODS^RAUTL2 F I=1:1 Q:$P(Y,", ",I)']""  W ?18,$P(Y,", ",I),!
"RTN","RAPROD",37,0)
 N J
"RTN","RAPROD",38,0)
 W !?2,"CPT Modifiers : " W:Y(1)="None" Y(1),!
"RTN","RAPROD",39,0)
 I Y(1)'="None" F I=1:1 Q:$P(Y(2),", ",I)']""  S J=$P(Y(2),", ",I),J=$$BASICMOD^RACPTMSC(J,DT) W ?18,$P(J,"^",2)," ",$P(J,"^",3),! I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF W !
"RTN","RAPROD",40,0)
 Q:+$G(RAXIT)
"RTN","RAPROD",41,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF W !
"RTN","RAPROD",42,0)
 Q:+$G(RAXIT)
"RTN","RAPROD",43,0)
 ;
"RTN","RAPROD",44,0)
 ;check for Contrast Media data, print it if it exists.
"RTN","RAPROD",45,0)
 I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",0)) D
"RTN","RAPROD",46,0)
 .W !?2,"Contrast Media: " S RACM=1
"RTN","RAPROD",47,0)
 .N DIWF,DIWL,DIWR,DIWT,X,Z
"RTN","RAPROD",48,0)
 .S X=$$CM^RADEM1(RADFN,RADTI,RACNI),DIWL=20,DIWF="C50"
"RTN","RAPROD",49,0)
 .D ^DIWP S Z=0
"RTN","RAPROD",50,0)
 .F  S Z=$O(^UTILITY($J,"W",DIWL,Z)) Q:'Z  D
"RTN","RAPROD",51,0)
 ..W ?18,^UTILITY($J,"W",DIWL,Z,0)
"RTN","RAPROD",52,0)
 ..W:+$O(^UTILITY($J,"W",DIWL,Z)) !
"RTN","RAPROD",53,0)
 ..Q
"RTN","RAPROD",54,0)
 .K ^UTILITY($J,"W")
"RTN","RAPROD",55,0)
 .Q
"RTN","RAPROD",56,0)
 ;
"RTN","RAPROD",57,0)
 I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) D PHARM^RAPROD2(RACNI_","_RADTI_","_RADFN_",") W ! ; display pharmaceutical data
"RTN","RAPROD",58,0)
 I +$G(RAXIT) K RAXIT Q
"RTN","RAPROD",59,0)
 I +$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),"^",28) D RDIO^RAPROD2(+$P(^(0),"^",28)) W ! ; display radiopharm data
"RTN","RAPROD",60,0)
 I +$G(RAXIT) K RAXIT Q
"RTN","RAPROD",61,0)
 W:$X>1 ! S X="",$P(X,"=",80)="" W X K X
"RTN","RAPROD",62,0)
 G ^RAPROD1
"RTN","RAPROD",63,0)
 ;
"RTN","RAPROD",64,0)
PRCCPT ; display Proc's abbrv, proc type, CPT
"RTN","RAPROD",65,0)
 Q:$G(RADTI)=""  Q:$G(RACNI)=""
"RTN","RAPROD",66,0)
 ;
"RTN","RAPROD",67,0)
 N RADISPLY
"RTN","RAPROD",68,0)
 S RADISPLY=$G(^RAMIS(71,+$P($G(^RADPT(+RADFN,"DT",+RADTI,"P",+RACNI,0)),U,2),0)) ; set $ZR to file 71 before calling prccpt^radd1
"RTN","RAPROD",69,0)
 S RADISPLY=$$PRCCPT^RADD1()
"RTN","RAPROD",70,0)
 W ?54,RADISPLY
"RTN","RAPROD",71,0)
 Q
"RTN","RAPROD",72,0)
SETL ;Set long display preference
"RTN","RAPROD",73,0)
 N RA1,RA2,DIR
"RTN","RAPROD",74,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPROD",75,0)
 S RA2=$O(^RA(79,RA1,"LDIS","B",DUZ,0))
"RTN","RAPROD",76,0)
 I RA2 D  Q
"RTN","RAPROD",77,0)
 . W !!,"Your preference for Long Display of Procedures has already been set."
"RTN","RAPROD",78,0)
 . S DIR(0)="Y",DIR("A")="Do you want to delete your preference ",DIR("B")="No"
"RTN","RAPROD",79,0)
 . S DIR("?",1)="If you answer 'Yes', then all Radiology reports requested by you will"
"RTN","RAPROD",80,0)
 . S DIR("?",2)="will default to the condensed display, which means that repeated procedures"
"RTN","RAPROD",81,0)
 . S DIR("?")="and associated modifiers will only be listed once."
"RTN","RAPROD",82,0)
 . D ^DIR
"RTN","RAPROD",83,0)
 . Q:'Y
"RTN","RAPROD",84,0)
 . D DEL150
"RTN","RAPROD",85,0)
 . Q
"RTN","RAPROD",86,0)
 W !
"RTN","RAPROD",87,0)
 S DIR(0)="Y",DIR("A",1)="Do you want to set your preference for Long Display of Procedures"
"RTN","RAPROD",88,0)
 S DIR("A")="in all Radiology reports ",DIR("B")="No"
"RTN","RAPROD",89,0)
 S DIR("?",1)="If you answer 'Yes', then all Radiology reports requested by you will"
"RTN","RAPROD",90,0)
 S DIR("?",2)="list all repeated procedures and associated modifiers instead of"
"RTN","RAPROD",91,0)
 S DIR("?")="listing repeated procedures only once, which is the condensed (default) format."
"RTN","RAPROD",92,0)
 D ^DIR
"RTN","RAPROD",93,0)
 Q:'Y
"RTN","RAPROD",94,0)
 D STUF150
"RTN","RAPROD",95,0)
 Q
"RTN","RAPROD",96,0)
DEL150 ;Delete user ien from 1st record in file 79's field 150
"RTN","RAPROD",97,0)
 ; note: DIK utility looks for DA(1) here
"RTN","RAPROD",98,0)
 Q:'$D(DUZ)#2
"RTN","RAPROD",99,0)
 S DA(1)=$O(^RA(79,0)) Q:'DA(1)
"RTN","RAPROD",100,0)
 S DIK="^RA(79,"_DA(1)_",""LDIS"","
"RTN","RAPROD",101,0)
 S DA=$O(^RA(79,DA(1),"LDIS","B",DUZ,0))
"RTN","RAPROD",102,0)
 Q:'DA
"RTN","RAPROD",103,0)
 D ^DIK
"RTN","RAPROD",104,0)
 K DIK,DA
"RTN","RAPROD",105,0)
 W !!,"Your preference for Long Display of Procedures has been removed.",!
"RTN","RAPROD",106,0)
 Q
"RTN","RAPROD",107,0)
STUF150 ;Stuff user ien into 1st record in file 79's field 150
"RTN","RAPROD",108,0)
 Q:'$D(DUZ)#2
"RTN","RAPROD",109,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPROD",110,0)
 K RAFDA,RAIEN,RAMSG
"RTN","RAPROD",111,0)
 S RAFDA(79.03,"?+2,"_RA1_",",.01)=DUZ
"RTN","RAPROD",112,0)
 D UPDATE^DIE("","RAFDA","RAIEN","RAMSG")
"RTN","RAPROD",113,0)
 W !!,"Your preference for Long Display of Procedures has been set.",!
"RTN","RAPROD",114,0)
 Q
"RTN","RAPROD",115,0)
CDIS ; set up RACDIS array to store 1st non-duplicate proc+pmod+cptmod
"RTN","RAPROD",116,0)
 N N1,N2,R1,RA71,Y
"RTN","RAPROD",117,0)
 K RACDIS
"RTN","RAPROD",118,0)
 D LDIS
"RTN","RAPROD",119,0)
 S N1=0
"RTN","RAPROD",120,0)
 F  S N1=$O(^RADPT(RADFN,"DT",RADTI,"P",N1)) Q:'N1  S R1=$G(^(N1,0)) D:R1]""
"RTN","RAPROD",121,0)
 . S RA71=$P(R1,U,2),RACNI=N1
"RTN","RAPROD",122,0)
 . D MODS^RAUTL2
"RTN","RAPROD",123,0)
 . S RACDIS("B",RA71,Y,Y(1),N1)=""
"RTN","RAPROD",124,0)
 . S N2=$O(RACDIS("B",RA71,Y,Y(1),0))
"RTN","RAPROD",125,0)
 . S RACDIS(N2)=$G(RACDIS(N2))+1 ;increment lowest ien of same proc+pmod+cptmod
"RTN","RAPROD",126,0)
 . S:RACDIS(N2)>1 RACDIS("RAFLDUP")=1 ;>1 same proc+pmod+cptmod
"RTN","RAPROD",127,0)
 . Q
"RTN","RAPROD",128,0)
 Q
"RTN","RAPROD",129,0)
LDIS ; See if user prefers Long Display of Procedures
"RTN","RAPROD",130,0)
 N RA1
"RTN","RAPROD",131,0)
 S RA1=$O(^RA(79,0)) Q:'RA1
"RTN","RAPROD",132,0)
 S:$O(^RA(79,RA1,"LDIS","B",DUZ,0)) RALDIS=1
"RTN","RAPROD",133,0)
 Q
"RTN","RAPROD",134,0)
LIST ;
"RTN","RAPROD",135,0)
 ;;RA("DIV");^DIC(4,;RADI;3
"RTN","RAPROD",136,0)
 ;;RA("LOC");^RA(79.1,;RADI;4
"RTN","RAPROD",137,0)
 ;;RA("WRD");^DIC(42,;Y(0);6
"RTN","RAPROD",138,0)
 ;;RA("SERV");^DIC(49,;Y(0);7
"RTN","RAPROD",139,0)
 ;;RA("CL");^SC(;Y(0);8
"RTN","RAPROD",140,0)
 ;;RA("CONT");^DIC(34,;Y(0);9
"RTN","RAPROD",141,0)
 ;;RA("RES");^VA(200,;Y(0);12
"RTN","RAPROD",142,0)
 ;;RA("DIA");^RA(78.3,;Y(0);13
"RTN","RAPROD",143,0)
 ;;RA("PHY");^VA(200,;Y(0);14
"RTN","RAPROD",144,0)
 ;;RA("STAFF");^VA(200,;Y(0);15
"RTN","RAPROD",145,0)
 ;;RA("CMP");^RA(78.1,;Y(0);16
"RTN","RAPROD",146,0)
 ;;RA("RM");^RA(78.6,;Y(0);18
"RTN","RAPROD",147,0)
 ;;RA("BED");^DIC(42.4,;Y(0);19
"RTN","RAPROD1")
0^21^B41351989
"RTN","RAPROD1",1,0)
RAPROD1 ;HISC/FPT,GJC AISC/MJK,RMO-Detailed Exam View ;11/26/96  08:24
"RTN","RAPROD1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**15,18,45**;Mar 16, 1998
"RTN","RAPROD1",3,0)
 ;last mof by SS for P18 JUN 29 ,00
"RTN","RAPROD1",4,0)
PER ; Display personnel information.
"RTN","RAPROD1",5,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT N Y
"RTN","RAPROD1",6,0)
 S DIR(0)="Y",DIR("B")="No"
"RTN","RAPROD1",7,0)
 S DIR("A")="Do you wish to display all personnel involved"
"RTN","RAPROD1",8,0)
 D ^DIR S:$D(DIRUT) X="^"
"RTN","RAPROD1",9,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT I X="^" D Q QUIT
"RTN","RAPROD1",10,0)
 G:+Y=0 ACT ; (Y=1:Yes,Y=0:No)
"RTN","RAPROD1",11,0)
 S RAXIT=0 D PERHDR
"RTN","RAPROD1",12,0)
 S RAXIT=$$PERINFO(RADFN,RADTI,RACNI)
"RTN","RAPROD1",13,0)
 I RAXIT D Q QUIT
"RTN","RAPROD1",14,0)
 I $D(RACM) D CMHIST^RAPROD2(RADFN,RADTI,RACNI)
"RTN","RAPROD1",15,0)
 I RAXIT D Q QUIT
"RTN","RAPROD1",16,0)
ACT R !!,"Do you wish to display activity log? No// ",X:DTIME S X=$E(X) S:'$T X="^" G Q:X="^" S:X="" X="N" G STAT:"Nn"[X I "Yy"'[X W:X'="?" $C(7) W !!?3,"Enter 'YES' if activity log should be displayed, or 'NO' if not." G ACT
"RTN","RAPROD1",17,0)
 W !!?23,"*** Exam Activity Log ***",!?2,"Date/Time",?25,"Action",?60,"Computer User",!?3,"Technologist comment",!?2,"---------------------",?25,"------",?60,"-------------"
"RTN","RAPROD1",18,0)
 N RA18RET S RADD=70.07 F I=0:0 S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"L",I)) Q:I'>0  I $D(^(I,0)) S RAY=^(0),Y=+RAY D ACT1 S RA18RET=$$PUTTCOM3^RAUTL11(RADFN,RADTI,RACNI,I,"",3,78,7,0,1,6,0) S:RA18RET=-1 RAXIT=1 Q:RA18RET=-1  ;P18
"RTN","RAPROD1",19,0)
 I $D(RAXIT) I RAXIT D Q QUIT  ;P18
"RTN","RAPROD1",20,0)
 G STAT:'RARPT W !!?22,"*** Report Activity Log ***",!?2,"Date/Time",?25,"Action",?60,"Computer User",!?2,"---------",?25,"------",?60,"-------------"
"RTN","RAPROD1",21,0)
 S RADD=74.01 F I=0:0 S I=$O(^RARPT(RARPT,"L",I)) Q:I'>0  I $D(^(I,0)) S RAY=^(0),Y=+RAY D ACT1
"RTN","RAPROD1",22,0)
 W ! S X="",$P(X,"=",80)="" W X K X
"RTN","RAPROD1",23,0)
 G STAT
"RTN","RAPROD1",24,0)
ACT1 D D^RAUTL W !?2,Y,?25,$E($P($P(^DD(RADD,2,0),$P(RAY,"^",2)_":",2),";"),1,33),?60,$E($S($D(^VA(200,+$P(RAY,"^",3),0)):$P(^(0),"^"),1:"Unknown"),1,18) Q
"RTN","RAPROD1",25,0)
 ;
"RTN","RAPROD1",26,0)
STAT G TEXT:'$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"T"))
"RTN","RAPROD1",27,0)
ASKSTA R !!,"Do you wish to display exam status tracking log? No// ",X:DTIME S X=$E(X) S:'$T X="^" G Q:X="^" S:X="" X="N" G TEXT:"Nn"[X I "Yy"'[X W:X'="?" $C(7) D  G ASKSTA
"RTN","RAPROD1",28,0)
 . W !!?3,"Enter 'YES' if exam status tracking log should be displayed, or 'NO' if not."
"RTN","RAPROD1",29,0)
 . Q
"RTN","RAPROD1",30,0)
 S RAXIT=0 D STATHDR ; print header
"RTN","RAPROD1",31,0)
 K RAX2 S RACUM=""
"RTN","RAPROD1",32,0)
 F I=0:0 S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"T",I)) Q:I'>0  I $D(^(I,0)) S RA=^(0),RAX1=+RA D STAT1 Q:$D(RAX2)&('$D(RAMTIME))  Q:RAXIT  S RAX2=RAX1
"RTN","RAPROD1",33,0)
 Q:RAXIT  W ! S X="",$P(X,"=",80)="" W X K X
"RTN","RAPROD1",34,0)
TEXT S X=$E(RA("RST")) G Q:X="P"!(X="N")!(X="D")
"RTN","RAPROD1",35,0)
ASKTXT R !!,"Do you wish to display exam report text? No// ",X:DTIME S X=$E(X) S:'$T!(X="")!(X="^") X="N" G Q:"Nn"[X I "Yy"'[X W:X'="?" $C(7) W !!?3,"Enter 'YES' if report text should be displayed, or 'NO' if not." G ASKTXT
"RTN","RAPROD1",36,0)
 D DISP^RART1
"RTN","RAPROD1",37,0)
Q ; kill and quit
"RTN","RAPROD1",38,0)
 K I,J,POP,RAMTIME,RAPRC,RAPRT,RADFN,RADTI,RACNI,RARPT,RANME,RASSN,RADATE,RADTE,RAST,RACN,RA,RAY,RACI,RADD,RADI,RAMOD,RAX,RAX1,RAX2,RAELAP,RACUM,Z
"RTN","RAPROD1",39,0)
 K RAXIT,RACM
"RTN","RAPROD1",40,0)
 Q
"RTN","RAPROD1",41,0)
STAT1 ; display status tracking info
"RTN","RAPROD1",42,0)
 K RAELAP I $D(RAX2) S X1=RAX1,X=RAX2 D ELAPSED^RAUTL1 Q:'$D(RAMTIME)  S RAELAP=Y D CUMUL
"RTN","RAPROD1",43,0)
 S Y=RAX1 D D^RAUTL
"RTN","RAPROD1",44,0)
 W:$D(RAELAP) ?49,RAELAP,?65,RACUM
"RTN","RAPROD1",45,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  D STATHDR
"RTN","RAPROD1",46,0)
 W !?2,$S($D(^RA(72,+$P(RA,"^",2),0)):$E($P(^(0),"^"),1,20),1:"Unknown"),?25,Y
"RTN","RAPROD1",47,0)
 Q
"RTN","RAPROD1",48,0)
CUMUL ; calculate time frame
"RTN","RAPROD1",49,0)
 Q:$E(Y)="N"  F RAI=1:1:3 S RA(RAI)=+$P(RACUM,":",RAI)+$P(Y,":",RAI)
"RTN","RAPROD1",50,0)
 F RAI=3:-1:2 S:RA(RAI)>59 RA(RAI-1)=RA(RAI-1)+1,RA(RAI)=RA(RAI)-60
"RTN","RAPROD1",51,0)
 S RACUM=$E(RA(1)+100,2,3)_":"_$E(RA(2)+100,2,3)_":"_$E(RA(3)+100,2,3) K RAI,RA(1),RA(2),RA(3)
"RTN","RAPROD1",52,0)
 Q
"RTN","RAPROD1",53,0)
STATHDR ; Print status tracking header
"RTN","RAPROD1",54,0)
 D:'$D(IOF) HOME^%ZIS W @IOF
"RTN","RAPROD1",55,0)
 W !!,?23,"*** Exam Status Tracking Log ***",!,?47,"Elapsed Time",?61,"Cumulative Time",!,?2,"Status",?25,"Date/Time",?48,"(DD:HH:MM)",?64,"(DD:HH:MM)",!,?2,"------",?25,"---------",?47,"------------",?61,"---------------"
"RTN","RAPROD1",56,0)
 Q
"RTN","RAPROD1",57,0)
PERHDR ; Print personnel header
"RTN","RAPROD1",58,0)
 D:'$D(IOF) HOME^%ZIS W @IOF
"RTN","RAPROD1",59,0)
 N X,Y S X="*** Imaging Personnel ***"
"RTN","RAPROD1",60,0)
 S $P(Y,"-",(IOM+1))="" W !?(IOM-$L(X)\2),X,!,Y
"RTN","RAPROD1",61,0)
 Q
"RTN","RAPROD1",62,0)
PERINFO(RADFN,RADTI,RACNI) ; Personnel information
"RTN","RAPROD1",63,0)
 ; Pass back 0 if ok, 1 if interrupt
"RTN","RAPROD1",64,0)
 Q:'$L(RADFN)!('$L(RADTI))!('$L(RACNI)) 1
"RTN","RAPROD1",65,0)
 N RA70,RAHD1,RAHD2,RAHD3,RAPIR,RAPIS,RAPRE,RARP,RARPT,RASIR,RASIS
"RTN","RAPROD1",66,0)
 N RATECH,RATRAN,RAVER
"RTN","RAPROD1",67,0)
 S RA70=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPROD1",68,0)
 S RARPT=+$P(RA70,"^",17) S:'RARPT RATRAN="No Report"
"RTN","RAPROD1",69,0)
 S:'RARPT (RAPRE,RAVER,RAPRE("DT"),RAVER("DT"))=""
"RTN","RAPROD1",70,0)
 I RARPT D
"RTN","RAPROD1",71,0)
 . S RARPT(0)=$G(^RARPT(RARPT,0))
"RTN","RAPROD1",72,0)
 . S RARPT("T")=$G(^RARPT(RARPT,"T"))
"RTN","RAPROD1",73,0)
 . S RATRAN=$S($D(^VA(200,+RARPT("T"),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD1",74,0)
 . S RAPRE=$S($D(^VA(200,+$P(RARPT(0),"^",13),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD1",75,0)
 . S RAVER=$S($D(^VA(200,+$P(RARPT(0),"^",9),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD1",76,0)
 . S RAPRE("DT")=$TR($$FMTE^XLFDT($P(RARPT(0),"^",12),"2F")," /","0")
"RTN","RAPROD1",77,0)
 . S RAVER("DT")=$TR($$FMTE^XLFDT($P(RARPT(0),"^",7),"2F")," /","0")
"RTN","RAPROD1",78,0)
 . Q
"RTN","RAPROD1",79,0)
 S RAPIR=$S($D(^VA(200,+$P(RA70,"^",12),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD1",80,0)
 S RAPIS=$S($D(^VA(200,+$P(RA70,"^",15),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD1",81,0)
 S RASIR=+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",0))
"RTN","RAPROD1",82,0)
 S RASIS=+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",0))
"RTN","RAPROD1",83,0)
 S RATECH=+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0))
"RTN","RAPROD1",84,0)
 W !,"Primary Int'g Resident: ",RAPIR
"RTN","RAPROD1",85,0)
 W !,"Primary Int'g Staff   : ",RAPIS
"RTN","RAPROD1",86,0)
 W !,"Pre-Verifier: ",RAPRE,"  ",RAPRE("DT")
"RTN","RAPROD1",87,0)
 W !,"Verifier    : ",RAVER,"  ",RAVER("DT"),!
"RTN","RAPROD1",88,0)
 S RAHD1="W !,""Secondary Interpreting Resident"",?40,""Secondary Interpreting Staff"""
"RTN","RAPROD1",89,0)
 S RAHD2="W !,""-------------------------------"",?40,""----------------------------"""
"RTN","RAPROD1",90,0)
 X RAHD1,RAHD2
"RTN","RAPROD1",91,0)
 I 'RASIR,('RASIS) W !,"None",?40,"None"
"RTN","RAPROD1",92,0)
 E  D  Q:RAXIT 1
"RTN","RAPROD1",93,0)
 . S (RASIR,RASIS)=.001
"RTN","RAPROD1",94,0)
 . F  D  Q:(('RASIR)&('RASIS))!(RAXIT)
"RTN","RAPROD1",95,0)
 .. I $Y>(IOSL-4) D  Q:RAXIT
"RTN","RAPROD1",96,0)
 ... S RAXIT=$$EOS^RAUTL5()
"RTN","RAPROD1",97,0)
 ... I 'RAXIT D PERHDR X RAHD1,RAHD2
"RTN","RAPROD1",98,0)
 ... Q
"RTN","RAPROD1",99,0)
 .. W ! D SECRES:RASIR,SECSTF:RASIS
"RTN","RAPROD1",100,0)
 .. Q
"RTN","RAPROD1",101,0)
 . Q
"RTN","RAPROD1",102,0)
 I $Y>(IOSL-4) D  Q:RAXIT 1
"RTN","RAPROD1",103,0)
 . S RAXIT=$$EOS^RAUTL5()
"RTN","RAPROD1",104,0)
 . D:'RAXIT PERHDR
"RTN","RAPROD1",105,0)
 . Q
"RTN","RAPROD1",106,0)
 W ! S RAHD3="W !,""Technologist(s)                         Transcriptionist"",!,""---------------                         ----------------""" X RAHD3
"RTN","RAPROD1",107,0)
 I 'RATECH W !,"None",?40,RATRAN
"RTN","RAPROD1",108,0)
 E  D  Q:RAXIT 1
"RTN","RAPROD1",109,0)
 . N RA S RA=0
"RTN","RAPROD1",110,0)
 . F  S RA=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",RA)) Q:RA'>0  D  Q:RAXIT
"RTN","RAPROD1",111,0)
 .. S RATECH(0)=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",RA,0))
"RTN","RAPROD1",112,0)
 .. S RATECH=$S($D(^VA(200,+RATECH(0),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD1",113,0)
 .. I $Y>(IOSL-4) D  Q:RAXIT
"RTN","RAPROD1",114,0)
 ... S RAXIT=$$EOS^RAUTL5()
"RTN","RAPROD1",115,0)
 ... I 'RAXIT D PERHDR X RAHD3
"RTN","RAPROD1",116,0)
 ... Q
"RTN","RAPROD1",117,0)
 .. W !,RATECH W:RATRAN'=99 ?40,RATRAN S RATRAN=99
"RTN","RAPROD1",118,0)
 .. Q
"RTN","RAPROD1",119,0)
 . Q
"RTN","RAPROD1",120,0)
 Q 0
"RTN","RAPROD1",121,0)
SECRES ; Secondary Resident data
"RTN","RAPROD1",122,0)
 S:RASIR=.001 RATXT="None"
"RTN","RAPROD1",123,0)
 S RASIR=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",RASIR))
"RTN","RAPROD1",124,0)
 I $D(RATXT),('+RASIR) W RATXT
"RTN","RAPROD1",125,0)
 E  D
"RTN","RAPROD1",126,0)
 . S RASIR(0)=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",RASIR,0))
"RTN","RAPROD1",127,0)
 . W $S($D(^VA(200,+RASIR(0),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD1",128,0)
 . Q
"RTN","RAPROD1",129,0)
 K RATXT
"RTN","RAPROD1",130,0)
 Q
"RTN","RAPROD1",131,0)
SECSTF ; Secondary Staff data
"RTN","RAPROD1",132,0)
 S:RASIS=.001 RATXT="None"
"RTN","RAPROD1",133,0)
 S RASIS=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",RASIS))
"RTN","RAPROD1",134,0)
 I $D(RATXT),('+RASIS) W ?40,RATXT
"RTN","RAPROD1",135,0)
 E  D
"RTN","RAPROD1",136,0)
 . S RASIS(0)=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",RASIS,0))
"RTN","RAPROD1",137,0)
 . W ?40,$S($D(^VA(200,+RASIS(0),0)):$P(^(0),"^"),1:"")
"RTN","RAPROD1",138,0)
 . Q
"RTN","RAPROD1",139,0)
 K RATXT
"RTN","RAPROD1",140,0)
 Q
"RTN","RAPROD2")
0^20^B17368908
"RTN","RAPROD2",1,0)
RAPROD2 ;HIRMFO/GJC-Display Med & Radiopharm values for exams ;12/12/96  13:35
"RTN","RAPROD2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RAPROD2",3,0)
 ;
"RTN","RAPROD2",4,0)
PHARM(RADA) ; Display Pharmaceutical default data for Exam displays
"RTN","RAPROD2",5,0)
 ; Input: RADA -> ien for the Examinations (50) multiple.
"RTN","RAPROD2",6,0)
 ;        in the following format: RACNI_","_RADTI_","_RADFN_","
"RTN","RAPROD2",7,0)
 ; *** Called only if $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) ***
"RTN","RAPROD2",8,0)
 N RA1,RACNT,RAHDR,RAPHARM,RASUB S RA1="",RASUB=70.15,RAXIT=0
"RTN","RAPROD2",9,0)
 D GETS^DIQ(70.03,RADA,"200*","NE","RAPHARM") Q:'$D(RAPHARM)
"RTN","RAPROD2",10,0)
 S RAHDR=$$CJ^XLFSTR("Medications",IOM,"-")
"RTN","RAPROD2",11,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF
"RTN","RAPROD2",12,0)
 W !,RAHDR,!
"RTN","RAPROD2",13,0)
 F  S RA1=$O(RAPHARM(RASUB,RA1)) Q:RA1']""  D  Q:RAXIT
"RTN","RAPROD2",14,0)
 . S RACNT=0
"RTN","RAPROD2",15,0)
 . I $G(RAPHARM(RASUB,RA1,.01,"E"))]"" D
"RTN","RAPROD2",16,0)
 .. W "Med: ",$E($G(RAPHARM(RASUB,RA1,.01,"E")),1,32)
"RTN","RAPROD2",17,0)
 .. S RACNT=RACNT+1
"RTN","RAPROD2",18,0)
 .. Q
"RTN","RAPROD2",19,0)
 . I $G(RAPHARM(RASUB,RA1,2,"E"))]"" D
"RTN","RAPROD2",20,0)
 .. N RAX S RAX="""Dose Adm'd: "",$E($G(RAPHARM(RASUB,RA1,2,""E"")),1,32)"
"RTN","RAPROD2",21,0)
 .. S RACNT=RACNT+1 W:RACNT=1 @RAX W:RACNT=2 ?39,@RAX
"RTN","RAPROD2",22,0)
 .. Q
"RTN","RAPROD2",23,0)
 . I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  D HDR
"RTN","RAPROD2",24,0)
 . I RACNT=2 W ! S RACNT=0
"RTN","RAPROD2",25,0)
 . I $G(RAPHARM(RASUB,RA1,4,"E"))]"" D
"RTN","RAPROD2",26,0)
 .. N RAX S RAX="""Adm'd By: "",$E($G(RAPHARM(RASUB,RA1,4,""E"")),1,28)"
"RTN","RAPROD2",27,0)
 .. S RACNT=RACNT+1 W:RACNT=1 @RAX W:RACNT=2 ?39,@RAX
"RTN","RAPROD2",28,0)
 .. Q
"RTN","RAPROD2",29,0)
 . I RACNT=2 W ! S RACNT=0
"RTN","RAPROD2",30,0)
 . I $G(RAPHARM(RASUB,RA1,3,"E"))]"" D
"RTN","RAPROD2",31,0)
 .. N RAX S RAX="""Date Adm'd: "",$E($G(RAPHARM(RASUB,RA1,3,""E"")),1,30)"
"RTN","RAPROD2",32,0)
 .. S RACNT=RACNT+1 W:RACNT=1 @RAX W:RACNT=2 ?39,@RAX
"RTN","RAPROD2",33,0)
 .. Q
"RTN","RAPROD2",34,0)
 . W:$O(RAPHARM(RASUB,RA1)) !!
"RTN","RAPROD2",35,0)
 . Q
"RTN","RAPROD2",36,0)
 Q
"RTN","RAPROD2",37,0)
RDIO(RADA) ; Display Radiopharmaceutical default data for Exam displays
"RTN","RAPROD2",38,0)
 ; Input: RADA -> ien of the Nuc Med Exam Data record (file 70.2)
"RTN","RAPROD2",39,0)
 ; *** Called only if $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,28)>0 ***
"RTN","RAPROD2",40,0)
 N RACNT,RADARY,RAFLDS,RAHDR,RAIENS,RAOPUT,X,Y
"RTN","RAPROD2",41,0)
 S RAIENS="",RAXIT=0 D GETS^DIQ(70.2,RADA_",","**","NE","RADARY")
"RTN","RAPROD2",42,0)
 Q:'$D(RADARY)  S RAHDR=$$CJ^XLFSTR("Radiopharmaceuticals",IOM,"-")
"RTN","RAPROD2",43,0)
 I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF
"RTN","RAPROD2",44,0)
 W !,RAHDR,!
"RTN","RAPROD2",45,0)
 F  S RAIENS=$O(RADARY(70.21,RAIENS)) Q:RAIENS=""  D  Q:RAXIT
"RTN","RAPROD2",46,0)
 . S (RACNT,RAFLDS)=0
"RTN","RAPROD2",47,0)
 . F  S RAFLDS=$O(RADARY(70.21,RAIENS,RAFLDS)) Q:RAFLDS'>0  D  Q:RAXIT
"RTN","RAPROD2",48,0)
 .. Q:$G(RADARY(70.21,RAIENS,RAFLDS,"E"))']""
"RTN","RAPROD2",49,0)
 .. I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  D HDR
"RTN","RAPROD2",50,0)
 .. S RAOPUT=$$TRN1(RAFLDS)_$G(RADARY(70.21,RAIENS,RAFLDS,"E"))_$S(RAFLDS=2:" mCi",RAFLDS=4:" mCi",RAFLDS=7:" mCi",1:""),RACNT=RACNT+1
"RTN","RAPROD2",51,0)
 .. W:RACNT=1 $E(RAOPUT,1,38) W:RACNT=2 ?39,$E(RAOPUT,1,39)
"RTN","RAPROD2",52,0)
 .. W:RACNT=2 ! S:RACNT=2 RACNT=0
"RTN","RAPROD2",53,0)
 .. Q
"RTN","RAPROD2",54,0)
 . W:$O(RADARY(70.21,RAIENS)) !!
"RTN","RAPROD2",55,0)
 . Q
"RTN","RAPROD2",56,0)
 Q
"RTN","RAPROD2",57,0)
TRN1(X) ; Translate Radiopharmaceutical field name to a shorter length.
"RTN","RAPROD2",58,0)
 Q:X=.01 "Rpharm: " Q:X=2 "Dose (MD Override): " Q:X=3 "Prescriber: "
"RTN","RAPROD2",59,0)
 Q:X=4 "Activity Drawn: " Q:X=5 "Drawn: " Q:X=6 "Measured By: "
"RTN","RAPROD2",60,0)
 Q:X=7 "Dose Adm'd: " Q:X=8 "Date Adm'd: " Q:X=9 "Adm'd By: "
"RTN","RAPROD2",61,0)
 Q:X=10 "Witness: " Q:X=11 "Route: " Q:X=12 "Site: "
"RTN","RAPROD2",62,0)
 Q:X=12.5 "Site Text: " Q:X=13 "Lot #: " Q:X=14 "Volume: "
"RTN","RAPROD2",63,0)
 Q:X=15 "Form: "
"RTN","RAPROD2",64,0)
HDR ; Pharmaceutical/Radiopharmaceutical Header
"RTN","RAPROD2",65,0)
 W @IOF,!,RAHDR,! S RACNT=0
"RTN","RAPROD2",66,0)
 Q
"RTN","RAPROD2",67,0)
 ;
"RTN","RAPROD2",68,0)
CMHIST(RADFN,RADTI,RACNI) ;main body
"RTN","RAPROD2",69,0)
 ;input: RADFN=DFN of the Rad/Nuc Med patient (file 2)
"RTN","RAPROD2",70,0)
 ;       RADTI=exam date/time (inverse)
"RTN","RAPROD2",71,0)
 ;       RACNI=ien of exam record (examinations sub-file 70.03)
"RTN","RAPROD2",72,0)
 ;
"RTN","RAPROD2",73,0)
 N X S RAHD="Contrast Media Edit History"
"RTN","RAPROD2",74,0)
 S $P(RALINE,"-",(IOM+1))=""
"RTN","RAPROD2",75,0)
 S RAPG=0 W:$E(IOST,1,2)="C-" @IOF ;clear screen
"RTN","RAPROD2",76,0)
 D CMHDR S (RACMDT,RAXIT)=0
"RTN","RAPROD2",77,0)
 ;$O down 'B' xref in ascending chronological order
"RTN","RAPROD2",78,0)
 F  S RACMDT=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"AUD","B",RACMDT)) Q:'RACMDT  D  Q:RAXIT
"RTN","RAPROD2",79,0)
 .S RAIEN=+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"AUD","B",RACMDT,0))
"RTN","RAPROD2",80,0)
 .;get_changed date/time, get_previous CM value, get_user
"RTN","RAPROD2",81,0)
 .S RAY(0)=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"AUD",RAIEN,0))
"RTN","RAPROD2",82,0)
 .S RAADT=$$FMTE^XLFDT($P(RAY(0),U),"1P"),RACMU=$P(RAY(0),U,2)
"RTN","RAPROD2",83,0)
 .S:+$P(RAY(0),U,3) RAAU=$$GET1^DIQ(200,$P(RAY(0),U,3)_",",.01)
"RTN","RAPROD2",84,0)
 .S X=$S($L(RACMU):$$CONTRAST^RACMHIS(RACMU),1:"")
"RTN","RAPROD2",85,0)
 .I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  D CMHDR
"RTN","RAPROD2",86,0)
 .W !,RAADT,?40,$E($G(RAAU),1,35) W:X="" !
"RTN","RAPROD2",87,0)
 .I $Y>(IOSL-4) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  D CMHDR
"RTN","RAPROD2",88,0)
 .I X'="" D  D ^DIWW K ^UTILITY($J,"W")
"RTN","RAPROD2",89,0)
 ..S DIWL=3,DIWR=70,DIWF="W" D ^DIWP
"RTN","RAPROD2",90,0)
 ..Q
"RTN","RAPROD2",91,0)
 .Q
"RTN","RAPROD2",92,0)
EXIT ;clean up symbol table, message to user
"RTN","RAPROD2",93,0)
 ;if there are no records to print, alert user
"RTN","RAPROD2",94,0)
 W:'$D(RAY(0))#2 !,$$CJ^XLFSTR("*** No Records To Print ***",IOM)
"RTN","RAPROD2",95,0)
 K RAADT,RAAU,RACH2,RACHNG2,RACMU,RAHD,RAIEN,RALINE,RAPG
"RTN","RAPROD2",96,0)
 K RACMDT,RAY
"RTN","RAPROD2",97,0)
 Q
"RTN","RAPROD2",98,0)
 ;
"RTN","RAPROD2",99,0)
CMHDR ; print header
"RTN","RAPROD2",100,0)
 W:RAPG @IOF S RAPG=RAPG+1
"RTN","RAPROD2",101,0)
 W !,$$CJ^XLFSTR(RAHD,IOM)
"RTN","RAPROD2",102,0)
 W !,"Date/Time Changed",?40,"User",!?2,"Contrast Media"
"RTN","RAPROD2",103,0)
 W !,$$CJ^XLFSTR(RALINE,IOM)
"RTN","RAPROD2",104,0)
 Q
"RTN","RAPROD2",105,0)
 ;
"RTN","RART3")
0^34^B21497929
"RTN","RART3",1,0)
RART3 ;HISC/GJC,SWM-Reporting Menu (Part 2) ;8/31/99  13:57
"RTN","RART3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,10,18,27,35,45**;Mar 16, 1998
"RTN","RART3",3,0)
 ; continue from RART1
"RTN","RART3",4,0)
 ; last modif by SS for P18
"RTN","RART3",5,0)
QRPT ; Queue the report to run
"RTN","RART3",6,0)
 N X K IOP,%ZIS S %ZIS="Q",%ZIS("B")=""
"RTN","RART3",7,0)
 S %ZIS("S")="I $E($P($G(^%ZIS(2,+$P($G(^(""SUBTYPE"")),""^""),0)),""^""),1,2)=""P-"""
"RTN","RART3",8,0)
 W ! D ^%ZIS
"RTN","RART3",9,0)
 I POP D Q6^RART1 Q
"RTN","RART3",10,0)
 I $E(IOST,1,2)="P-",('$D(IO("Q"))) D
"RTN","RART3",11,0)
 . D PRT^RARTR
"RTN","RART3",12,0)
 . Q
"RTN","RART3",13,0)
 I $D(IO("Q")) D
"RTN","RART3",14,0)
 . K RANME,RAPRC,Y S U="^",DT=$S($G(DT)]"":DT,1:$$DT^XLFDT())
"RTN","RART3",15,0)
 . S ZTDESC="Rad/Nuc Med Abnormal Report Alert",ZTRTN="PRT^RARTR"
"RTN","RART3",16,0)
 . S:$D(RARTMES) ZTSAVE("RARTMES")=""
"RTN","RART3",17,0)
 . F I="DT","RARPT","U" S ZTSAVE(I)=""
"RTN","RART3",18,0)
 . D ^%ZTLOAD W:$D(ZTSK) "   Task # ",ZTSK
"RTN","RART3",19,0)
 . K IO("Q"),ZTDESC,ZTRTN,ZTSAVE
"RTN","RART3",20,0)
 . Q
"RTN","RART3",21,0)
 W ! D ^%ZISC,HOME^%ZIS
"RTN","RART3",22,0)
 D Q6^RART1,EXIT^RART
"RTN","RART3",23,0)
 Q
"RTN","RART3",24,0)
PHYS N RA2ND,R1,R2,RASTR
"RTN","RART3",25,0)
 S (R1,R2)=0 F  S R2=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",R2)) Q:'R2  S:+$G(^(R2,0)) R1=R1+1,RA2ND("SRR",R1)=+^(0),RA2ND("SRR",R1)=$E($P($G(^VA(200,RA2ND("SRR",R1),0)),"^"),1,20)
"RTN","RART3",26,0)
 S (R1,R2)=0 F  S R2=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",R2)) Q:'R2  S:+$G(^(R2,0)) R1=R1+1,RA2ND("SSR",R1)=+^(0),RA2ND("SSR",R1)=$E($P($G(^VA(200,RA2ND("SSR",R1),0)),"^"),1,20)
"RTN","RART3",27,0)
 S R1=$E($P($G(^VA(200,+$P(R3,"^",15),0)),"^"),1,15)
"RTN","RART3",28,0)
 S RASTR="Staff Phys: "_R1 S:R1]"" RASTR=RASTR_" (P)"
"RTN","RART3",29,0)
PHYS1 I '$O(RA2ND("SSR",0)) W !,RASTR G PHYS2
"RTN","RART3",30,0)
 S R1=0
"RTN","RART3",31,0)
PHYS11 S R1=$O(RA2ND("SSR",R1)) G:R1="" PHYS19
"RTN","RART3",32,0)
 I $L(RASTR)+$L(RA2ND("SSR",R1))>79 W !,RASTR,";" S RASTR="   "
"RTN","RART3",33,0)
 S:RASTR]"   " RASTR=RASTR_"; " S RASTR=RASTR_RA2ND("SSR",R1) G PHYS11
"RTN","RART3",34,0)
PHYS19 W:RASTR]"" !,RASTR
"RTN","RART3",35,0)
PHYS2 S R1=$E($P($G(^VA(200,+$P(R3,"^",12),0)),"^"),1,15)
"RTN","RART3",36,0)
 S RASTR="Residents : "_R1 S:R1]"" RASTR=RASTR_" (P)"
"RTN","RART3",37,0)
 I '$O(RA2ND("SRR",0)) W !,RASTR Q
"RTN","RART3",38,0)
 S R1=0
"RTN","RART3",39,0)
PHYS21 S R1=$O(RA2ND("SRR",R1)) G:R1="" PHYS29
"RTN","RART3",40,0)
 I $L(RASTR)+$L(RA2ND("SRR",R1))>79 W !,RASTR,";" S RASTR="   "
"RTN","RART3",41,0)
 S:RASTR]"   " RASTR=RASTR_"; " S RASTR=RASTR_RA2ND("SRR",R1) G PHYS21
"RTN","RART3",42,0)
PHYS29 W:RASTR]"" !,RASTR
"RTN","RART3",43,0)
 Q
"RTN","RART3",44,0)
MODSET ; print modifiers of all cases of print set
"RTN","RART3",45,0)
 N RACDIS,RALDIS,RACNISAV,RAMEMARR,R1
"RTN","RART3",46,0)
 D EN2^RAUTL20(.RAMEMARR) Q:'$O(RAMEMARR(0))
"RTN","RART3",47,0)
 S RACNISAV=RACNI,RACNI=0
"RTN","RART3",48,0)
 D CDIS^RAPROD S RACNI=0
"RTN","RART3",49,0)
 F  S RACNI=$O(RAMEMARR(RACNI)) Q:'RACNI  D  Q:$L($G(X))  I $G(RAXIT) S X="^" Q
"RTN","RART3",50,0)
 . S R1=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RART3",51,0)
 . D MODS^RAUTL2
"RTN","RART3",52,0)
 . ; If printing page at a time we need to check the length - RA*5*8
"RTN","RART3",53,0)
 . I $Y>(IOSL-6),'$D(RARTVERF) S RAP="" D WAIT^RART1 I X="^"!(X="P")!(X="T") Q
"RTN","RART3",54,0)
 . K X
"RTN","RART3",55,0)
 . D OUT1
"RTN","RART3",56,0)
 . S:+$P(R1,"^",28) X=$$RDIO1^RARTUTL1(+$P(R1,"^",28))  Q:$L($G(X))
"RTN","RART3",57,0)
 . S:+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) X=$$PHARM1^RARTUTL(RACNI_","_RADTI_","_RADFN_",")
"RTN","RART3",58,0)
 . Q
"RTN","RART3",59,0)
 S RACNI=RACNISAV
"RTN","RART3",60,0)
 W !
"RTN","RART3",61,0)
 Q
"RTN","RART3",62,0)
OUT1 ; print Procedure name, CPT code, Procedure modifier, and CPT Modifiers
"RTN","RART3",63,0)
 ; $O(RAMEMARR(0)) may be defined, if previously called MODSET^RART3
"RTN","RART3",64,0)
 ; RALDIS flags long display wanted, comes from certain output options
"RTN","RART3",65,0)
 ; RACDIS(n) exists if case n is to be displayed
"RTN","RART3",66,0)
 ; RACDIS(n) not set for dupl proc+pmod+cptmod so don't display
"RTN","RART3",67,0)
 ; If printset, skip if not long format or case not marked for cond.displ
"RTN","RART3",68,0)
 I $O(RAMEMARR(0)),'$G(RALDIS),'$D(RACDIS(RACNI)) Q
"RTN","RART3",69,0)
 N I,J
"RTN","RART3",70,0)
 N RA18RET S RA18RET=0 ;P18
"RTN","RART3",71,0)
 S R1=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RART3",72,0)
 ; Check if cancelled and not part of this report
"RTN","RART3",73,0)
 I $P(^RA(72,+$P(R1,"^",3),0),"^",3)=0,($P(R1,"^",17)="") Q
"RTN","RART3",74,0)
 I $P(^RA(72,+$P(R1,"^",3),0),"^",3)=0 D
"RTN","RART3",75,0)
 .W !,$S($G(RALDIS):"",'$D(RACDIS):"",$G(RACDIS(RACNI))=1:"",1:RACDIS(RACNI)_"x"),?4,$E($P($G(^RAMIS(71,+$P(R1,"^",2),0)),"^"),1,42)_" (cancelled)"
"RTN","RART3",76,0)
 E  W !,$S($G(RALDIS):"",'$D(RACDIS):"",$G(RACDIS(RACNI))=1:"",1:RACDIS(RACNI)_"x"),?4,$P($G(^RAMIS(71,+$P(R1,"^",2),0)),"^")
"RTN","RART3",77,0)
 D PRCCPT^RAPROD ;disp proc. abbr, proc type, & CPT
"RTN","RART3",78,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RART3",79,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RART3",80,0)
 I $L(RACMDATA) D
"RTN","RART3",81,0)
 .W !?5,"Contrast Media :"
"RTN","RART3",82,0)
 .F RAIZ=1:1 Q:$P(RACMDATA,", ",RAIZ)=""  D
"RTN","RART3",83,0)
 ..W ?22,$P(RACMDATA,", ",RAIZ) W:$P(RACMDATA,", ",RAIZ+1)'="" !
"RTN","RART3",84,0)
 ..I '$D(RARTVERF),$Y>(IOSL-5) S RAXIT=$$EOS^RAUTL5() S:RAXIT RA18RET=-1 Q:RAXIT  W @IOF W !
"RTN","RART3",85,0)
 ..Q
"RTN","RART3",86,0)
 .K RAIZ
"RTN","RART3",87,0)
 .QUIT
"RTN","RART3",88,0)
 K RACMDATA Q:RA18RET=-1  ;P18
"RTN","RART3",89,0)
 W:Y'="None" !?5,"Proc Modifiers : ",Y
"RTN","RART3",90,0)
 W:Y(1)'="None" !?5,"CPT Modifiers  :"
"RTN","RART3",91,0)
 I Y(1)'="None" F I=1:1 Q:$P(Y(2),", ",I)']""  S J=$P(Y(2),", ",I),J=$$BASICMOD^RACPTMSC(J,DT) W ?22,$P(J,"^",2)," ",$P(J,"^",3) W:$P(Y(2),", ",I+1)]"" ! I '$D(RARTVERF),$Y>(IOSL-5) S RAXIT=$$EOS^RAUTL5() S:RAXIT RA18RET=-1 Q:RAXIT  W @IOF W !
"RTN","RART3",92,0)
 Q:RA18RET=-1
"RTN","RART3",93,0)
 ;RATECHCO is defined in OPTION FILE's  ENTRY/EXIT ACTION
"RTN","RART3",94,0)
 I $D(RATECHCO) W:$G(Y(1))="None" ! S RA18RET=$$PUTTCOM^RAUTL11(RADFN,RADTI,RACNI,"     Tech.Comment   : ",22,70,7,0,0,2,0) S:RA18RET=-1 RAXIT=1 Q:RA18RET=-1  ;P18
"RTN","RART3",95,0)
 Q
"RTN","RARTE")
0^36^B27555135
"RTN","RARTE",1,0)
RARTE ;HISC/FPT,GJC AISC/MJK,RMO-Edit/Delete Reports ;8/4/97  09:09
"RTN","RARTE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,34,45**;Mar 16, 1998
"RTN","RARTE",3,0)
 ; last modification by SS for P18 June 14,2000
"RTN","RARTE",4,0)
 D SET^RAPSET1 I $D(XQUIT) K XQUIT Q
"RTN","RARTE",5,0)
 N RAXIT,RADRS,RASUBY0 S RAXIT=0 ;RADRS=copy (1=diag, 2=resid,staff)
"RTN","RARTE",6,0)
 I $D(RANOSCRN) S X=$$DIVLOC^RAUTL7() I X D Q^RARTE4 QUIT
"RTN","RARTE",7,0)
 ;
"RTN","RARTE",8,0)
 ;1. DO NOT KILL the RASIG variable; the RASIG() array is needed in
"RTN","RARTE",9,0)
 ;   the edit template [RA REPORT EDIT] later
"RTN","RARTE",10,0)
 ;2. The RAELESIG canNOT store file 74's ien, as no rpt has been picked
"RTN","RARTE",11,0)
 ;   from this call to ES^RASIGU
"RTN","RARTE",12,0)
 ;
"RTN","RARTE",13,0)
 I $D(^XUSEC("RA VERIFY",DUZ)),($$GET1^DIQ(200,DUZ_",",20.4)]""),($D(^VA(200,"ARC","R",DUZ))!($D(^VA(200,"ARC","S",DUZ)))) D  Q:'$D(RAELESIG)
"RTN","RARTE",14,0)
 . W ! D ES^RASIGU S:%=1 RAELESIG=""
"RTN","RARTE",15,0)
 . K:'$D(RAELESIG) %,%W,%Y,%Y1,C,X,X1,X2
"RTN","RARTE",16,0)
 . Q
"RTN","RARTE",17,0)
 K RABTCH I $P(RAMDV,"^",13) D ASKBTCH^RARTE1 G Q1^RARTE4:X["^" D 1^RABTCH:"Yy"[$E(X) I '$D(RABTCH) W " ...no batch selected",!
"RTN","RARTE",18,0)
START K RAVER S RAVW="",RAREPORT=1 D ^RACNLU G Q^RARTE4:"^"[X
"RTN","RARTE",19,0)
 S RASUBY0=Y(0) ; save value of y(0)
"RTN","RARTE",20,0)
 G:$P(^RA(72,+RAST,0),"^",3)>0 DISPLAY
"RTN","RARTE",21,0)
 I $D(^XUSEC("RA MGR",DUZ)) G DISPLAY
"RTN","RARTE",22,0)
 G:$P(RAMDV,"^",22)=1 DISPLAY
"RTN","RARTE",23,0)
 W $C(7),!!,"The STATUS for this case is CANCELLED. You may not enter a report.",!! D INCRPT^RARTE4 G START
"RTN","RARTE",24,0)
 ;
"RTN","RARTE",25,0)
DISPLAY ; Display exam specific info, edit/enter the report
"RTN","RARTE",26,0)
 N RA18EX S RA18EX=0 ;P18 for quit if uparrow inside PUTTCOM
"RTN","RARTE",27,0)
 I '($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))#2) D  D Q^RARTE4 QUIT
"RTN","RARTE",28,0)
 . W !!?2,"Case #: ",RACN," for ",RANME S RAXIT=1
"RTN","RARTE",29,0)
 . W !?2,"Procedure: '",$E(RAPRC,1,45),"' has been deleted"
"RTN","RARTE",30,0)
 . W !?2,"by another user!",$C(7)
"RTN","RARTE",31,0)
 . Q
"RTN","RARTE",32,0)
 ;Lock case node so no one else can edit rpt pointer during this session
"RTN","RARTE",33,0)
 S RAPNODE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE",34,0)
 S RAXIT=$$LOCK^RAUTL12(RAPNODE,RACNI) I RAXIT D INCRPT^RARTE4 G START
"RTN","RARTE",35,0)
 S RAI="",$P(RAI,"-",80)="" W !,RAI
"RTN","RARTE",36,0)
 W !?1,"Name     : ",$E(RANME,1,25),?40,"Pt ID       : ",RASSN
"RTN","RARTE",37,0)
 W !?1,"Case No. : ",RACN,?18,"Exm. St: ",$E($P($G(^RA(72,+RAST,0)),"^"),1,12),?40,"Procedure   : ",$E(RAPRC,1,25)
"RTN","RARTE",38,0)
        ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTE",39,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTE",40,0)
 D:$L(RACMDATA) CMEDIA(RACMDATA)
"RTN","RARTE",41,0)
 K RACMDATA
"RTN","RARTE",42,0)
 S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,RACN," Tech.Comment: ",15,70,-1,0) ;P18
"RTN","RARTE",43,0)
 I RA18EX=-1 Q  ;P18
"RTN","RARTE",44,0)
 N RAPRTSET,RAMEMARR,RA1
"RTN","RARTE",45,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RARTE",46,0)
 I RAPRTSET D
"RTN","RARTE",47,0)
 . S RA1=""
"RTN","RARTE",48,0)
 . F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""!(RA18EX=-1)  I RA1'=RACNI D
"RTN","RARTE",49,0)
 .. W !,?1,"Case No. : ",+RAMEMARR(RA1)
"RTN","RARTE",50,0)
 .. W:$P(RAMEMARR(RA1),"^",4)]"" ?18,"Exm. St: ",$E($P($G(^RA(72,$P(RAMEMARR(RA1),"^",4),0)),"^"),1,12)
"RTN","RARTE",51,0)
 .. W ?40,"Procedure   : ",$E($P($G(^RAMIS(71,+$P(RAMEMARR(RA1),"^",2),0)),"^"),1,26)
"RTN","RARTE",52,0)
 ..;check printset for contrast media; display if CM data exists
"RTN","RARTE",53,0)
 ..S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RA1)
"RTN","RARTE",54,0)
 ..D:$L(RACMDATA) CMEDIA(RACMDATA)
"RTN","RARTE",55,0)
 ..K RACMDATA
"RTN","RARTE",56,0)
 .. S RA18EX=$$PUTTCOM2^RAUTL11(RADFN,RADTI,+RAMEMARR(RA1)," Tech.Comment: ",15,70,-1,0) Q:RA18EX=-1  ;P18
"RTN","RARTE",57,0)
 .. Q
"RTN","RARTE",58,0)
 . Q
"RTN","RARTE",59,0)
SS1 I RA18EX=-1 Q  ;P18
"RTN","RARTE",60,0)
 S Y(0)=RASUBY0
"RTN","RARTE",61,0)
 W !?1,"Exam Date: ",RADATE,?40,"Technologist: " I $O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"TC",0))>0,$D(^VA(200,+^($O(^(0)),0),0)) W $E($P(^(0),"^"),1,25)
"RTN","RARTE",62,0)
 W !?40,"Req Phys    : ",$E($S($D(^VA(200,+$P(Y(0),"^",14),0)):$P(^(0),"^"),1:""),1,25),!,RAI
"RTN","RARTE",63,0)
 I $D(^RARPT(+RARPT,0)),$P(^(0),"^",5)="V" W !?3,$C(7),"Report has already been verified!",! D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",64,0)
 ;Create new rpt, or skip to IN to edit existing report
"RTN","RARTE",65,0)
 G IN^RARTE4:$D(^RARPT(+RARPT,0))
"RTN","RARTE",66,0)
 G:'RAPRTSET NEW G:$P(^RA(72,+RAST,0),"^",3)>0 NEW
"RTN","RARTE",67,0)
 ; case is part of a print set, AND is cancelled
"RTN","RARTE",68,0)
 N RA2 S (RA1,RA2)=""
"RTN","RARTE",69,0)
 F  S RA1=$O(RAMEMARR(RA1)) Q:RA1=""  S:$P(RAMEMARR(RA1),"^",3)]"" RA2=$P(RAMEMARR(RA1),"^",3)
"RTN","RARTE",70,0)
 G:RA2="" NEW
"RTN","RARTE",71,0)
 W !!,$C(7),"Other cases of this cancelled case ",RACN,"'s print set are entered in a report already",!!,"You may NOT create a new report for this cancelled case,",!,"but you may include this cancelled case in the existing report."
"RTN","RARTE",72,0)
 W !!,"Do you want to include this cancelled case in the same report",!,"as the others in the print set ?"
"RTN","RARTE",73,0)
 S %=2 D YN^DICN
"RTN","RARTE",74,0)
 W:%>0 "...",$S(%=1:"Include",1:"Skip")," this case"
"RTN","RARTE",75,0)
 I %=1 S $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),"^",17)=RA2,RARPT=RA2,RARPTN=$P(^RARPT(RARPT,0),"^"),RA1=RACN D INSERT^RARTE2
"RTN","RARTE",76,0)
 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",77,0)
NEW G:'RAPRTSET NEW1
"RTN","RARTE",78,0)
 L +^RADPT(RADFN,"DT",RADTI):0 G:$T NEW1
"RTN","RARTE",79,0)
 W !!?10,$C(7),"** This case belongs to a printset,",?68,"**",!?10,"** and someone else is currently doing REPORT ENTRY/EDIT",?68,"**"
"RTN","RARTE",80,0)
 W !?10,"** on another case for this same printset,",?68,"**",!?10,"** so you may not enter a new report.",?68,"**"
"RTN","RARTE",81,0)
 H 2 D UNLOCK^RAUTL12(RAPNODE,RACNI) D INCRPT^RARTE4 G START
"RTN","RARTE",82,0)
NEW1 S RARPTN=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_RACN
"RTN","RARTE",83,0)
 W !?3,"...report not entered for this exam...",!?10,"...will now initialize report entry..."
"RTN","RARTE",84,0)
 S I=+$P(^RARPT(0),"^",3)
"RTN","RARTE",85,0)
 G LOCK^RARTE4
"RTN","RARTE",86,0)
 Q
"RTN","RARTE",87,0)
 ;
"RTN","RARTE",88,0)
CMEDIA(X) ;check if contrast media is associated with the report (exam)
"RTN","RARTE",89,0)
 ;variables assumed to exist X: the string of contrast media used
"RTN","RARTE",90,0)
 ;delimited by the comma.
"RTN","RARTE",91,0)
 N Y W !," Contrast :"
"RTN","RARTE",92,0)
 F Y=1:1 Q:$P(X,", ",Y)=""  W ?12,$P(X,", ",Y) W:$P(X,", ",Y+1)'="" !
"RTN","RARTE",93,0)
 Q
"RTN","RARTR3")
0^35^B17132620
"RTN","RARTR3",1,0)
RARTR3 ;HIRMFO/SWM-Queue/print Radiology Reports (utility) ;8/31/99  13:57
"RTN","RARTR3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,10,19,27,35,45**;Mar 16, 1998
"RTN","RARTR3",3,0)
MEMS1 ;--- modifiers --- handle cases within print set
"RTN","RARTR3",4,0)
 N RACNISAV,RAY3SAV,RAMEMARR,RACDIS,RALDIS
"RTN","RARTR3",5,0)
 D EN2^RAUTL20(.RAMEMARR) Q:'$O(RAMEMARR(0))
"RTN","RARTR3",6,0)
 S RACNISAV=RACNI,RAY3SAV=RAY3,RACNI=0
"RTN","RARTR3",7,0)
 D CDIS^RAPROD S RACNI=0
"RTN","RARTR3",8,0)
 F  S RACNI=$O(RAMEMARR(RACNI)) Q:'RACNI  D  S:$G(RAXIT) RAOOUT=1  Q:$D(RAOOUT)
"RTN","RARTR3",9,0)
 . S RAY3=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARTR3",10,0)
 . ;Check if cancelled & not part of printset
"RTN","RARTR3",11,0)
 . I $P(^RA(72,+$P(RAY3,"^",3),0),"^",3)=0,($P(RAY3,"^",17)="") Q
"RTN","RARTR3",12,0)
 . D MODS^RAUTL2
"RTN","RARTR3",13,0)
 . ; If printing page at a time we need to check the length - RA*5*8
"RTN","RARTR3",14,0)
 . I '$D(RAUTOE),$Y>(IOSL-6),IOST["C-" S RAP="" D WAIT^RART1 I X="^"!(X="P")!(X="T") S RAOOUT=1 Q
"RTN","RARTR3",15,0)
 . D OUT1 Q:$G(RAXIT)
"RTN","RARTR3",16,0)
 . D:+$P(RAY3,"^",28) RDIO^RARTUTL(+$P(RAY3,"^",28)) Q:$D(RAOOUT)
"RTN","RARTR3",17,0)
 . D:+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) PHARM^RARTUTL(RACNI_","_RADTI_","_RADFN_",")
"RTN","RARTR3",18,0)
 . Q
"RTN","RARTR3",19,0)
 S RACNI=RACNISAV,RAY3=RAY3SAV
"RTN","RARTR3",20,0)
 Q
"RTN","RARTR3",21,0)
OUT1 ;
"RTN","RARTR3",22,0)
 ; $O(RAMEMARR(0)) may be defined, if previously called MEMS1^RARTR3
"RTN","RARTR3",23,0)
 ; RALDIS flags long display wanted, comes from certain output options
"RTN","RARTR3",24,0)
 ; RACDIS(n) exists if case n is to be displayed
"RTN","RARTR3",25,0)
 ; RACDIS(n) not set for dupl proc+pmod+cptmod so don't display
"RTN","RARTR3",26,0)
 I $O(RAMEMARR(0)),'$G(RALDIS),'$D(RACDIS(RACNI)) Q
"RTN","RARTR3",27,0)
 I $D(RAUTOE) G MAIL1
"RTN","RARTR3",28,0)
 W !,$$XAM()
"RTN","RARTR3",29,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTR3",30,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTR3",31,0)
 I $L(RACMDATA) D
"RTN","RARTR3",32,0)
 .W !?5,"Contrast Media :"
"RTN","RARTR3",33,0)
 .F RAIZ=1:1 Q:$P(RACMDATA,", ",RAIZ)=""  D
"RTN","RARTR3",34,0)
 ..W ?22,$P(RACMDATA,", ",RAIZ)
"RTN","RARTR3",35,0)
 ..W:$P(RACMDATA,", ",RAIZ+1)'="" !
"RTN","RARTR3",36,0)
 ..I $Y>(IOSL-5) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF W !
"RTN","RARTR3",37,0)
 ..Q
"RTN","RARTR3",38,0)
 .K RAIZ
"RTN","RARTR3",39,0)
 .QUIT
"RTN","RARTR3",40,0)
 K RACMDATA Q:$G(RAXIT)
"RTN","RARTR3",41,0)
 W:Y'="None" !?RATAB,"Proc Modifiers : ",Y
"RTN","RARTR3",42,0)
 N I,J
"RTN","RARTR3",43,0)
 W:Y(1)'="None" !?RATAB,"CPT Modifiers  : "
"RTN","RARTR3",44,0)
 I Y(1)'="None" F I=1:1 Q:$P(Y(2),", ",I)']""  S J=$P(Y(2),", ",I),J=$$BASICMOD^RACPTMSC(J,DT) W ?22,$P(J,"^",2)," ",$P(J,"^",3) W:$P(Y(2),", ",I+1)]"" ! I $Y>(IOSL-5) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF W !
"RTN","RARTR3",45,0)
 Q
"RTN","RARTR3",46,0)
 ;
"RTN","RARTR3",47,0)
MAIL1 S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR3",48,0)
 S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=$$XAM()
"RTN","RARTR3",49,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTR3",50,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTR3",51,0)
 I $L(RACMDATA) D
"RTN","RARTR3",52,0)
 .S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="     Contrast Media : "_$P(RACMDATA,", ")
"RTN","RARTR3",53,0)
 .F RAIZ=2:1 Q:$P(RACMDATA,", ",RAIZ)=""  S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="                      "_$P(RACMDATA,", ",RAIZ)
"RTN","RARTR3",54,0)
 .K RAIZ
"RTN","RARTR3",55,0)
 .QUIT
"RTN","RARTR3",56,0)
 K RACMDATA
"RTN","RARTR3",57,0)
 S:Y'="None" ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="     Proc Modifiers : "_Y
"RTN","RARTR3",58,0)
 Q:Y(1)="None"
"RTN","RARTR3",59,0)
 S J=$P(Y(2),", ",1),J=$$BASICMOD^RACPTMSC(J,DT) S:+J<0 $P(J,"^",2,3)="None^"
"RTN","RARTR3",60,0)
 S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="     CPT Modifiers  : "_$S(J]"":$P(J,"^",2)_" "_$P(J,"^",3),1:"")
"RTN","RARTR3",61,0)
 F I=2:1 Q:$P(Y(2),", ",I)']""  S J=$P(Y(2),", ",I),J=$$BASICMOD^RACPTMSC(J,DT) S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="                      "_$P(J,"^",2)_" "_$P(J,"^",3)
"RTN","RARTR3",62,0)
 Q
"RTN","RARTR3",63,0)
 ;
"RTN","RARTR3",64,0)
XAM() ; Return exam data information.  Case number, exam status & procedure
"RTN","RARTR3",65,0)
 ; name build into one string.  Assumes RAY3 is the 0 node for exam data
"RTN","RARTR3",66,0)
 Q:$G(RAY3)="" "" ; no exam information present.
"RTN","RARTR3",67,0)
 N RAPROC,RAXAMSTR S RAXAMSTR=""
"RTN","RARTR3",68,0)
 I $G(RALDIS)!('$O(RAMEMARR(0)))!($O(RAMEMARR(0))&($G(RACDIS(RACNI))=1)) D
"RTN","RARTR3",69,0)
 . S $E(RAXAMSTR,1,5)="(Case"
"RTN","RARTR3",70,0)
 . S $E(RAXAMSTR,7,(7+$L(+RAY3)))=+RAY3
"RTN","RARTR3",71,0)
 . S $E(RAXAMSTR,$L(RAXAMSTR)+2,79)=$S($D(^RA(72,+$P(RAY3,"^",3),0)):$E($P(^(0),"^"),1,8)_")",1:"Unknown)")
"RTN","RARTR3",72,0)
 . Q
"RTN","RARTR3",73,0)
 E  S:$G(RACDIS(RACNI)) $E(RAXAMSTR,1)="(",$E(RAXAMSTR,9,14)=RACDIS(RACNI)_"x",$E(RAXAMSTR,20)=")"
"RTN","RARTR3",74,0)
 S RAPROC=$G(^RAMIS(71,+$P(RAY3,"^",2),0))
"RTN","RARTR3",75,0)
 S $E(RAXAMSTR,22,54)=$S($P(RAPROC,"^")]"":$E($P(RAPROC,"^"),1,33),1:"Unknown")
"RTN","RARTR3",76,0)
 N RADISPLY
"RTN","RARTR3",77,0)
 S RADISPLY=$G(^RAMIS(71,+$P($G(^RADPT(+RADFN,"DT",+RADTI,"P",+RACNI,0)),U,2),0)) ; set $ZR to 71 for prccpt^radd1, not call raprod since store result
"RTN","RARTR3",78,0)
 S RADISPLY=$$PRCCPT^RADD1()
"RTN","RARTR3",79,0)
 S $E(RAXAMSTR,55,79)=RADISPLY
"RTN","RARTR3",80,0)
 Q RAXAMSTR
"RTN","RASTED")
0^24^B45805107
"RTN","RASTED",1,0)
RASTED ;HISC/CAH,FPT,GJC,SS AISC/TMP,TAC,RMO-Edits for status tracking ;6/2/98  15:43
"RTN","RASTED",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,10,18,28,45**;Mar 16, 1998
"RTN","RASTED",3,0)
 ;last modif by SS for P18 JUN 19,2000
"RTN","RASTED",4,0)
 ; *** 'RASTED' is called from the routine; 'CASE^RASTEXT1'. ***
"RTN","RASTED",5,0)
 ;last modification by SS May 12,2000
"RTN","RASTED",6,0)
 S RAL=X F I2=1:1 S X=$P(RAL,",",I2) Q:X=""  S RAVW="" W !!,"Case # being tracked: ",X D SEL^RACNLU D:'RACNT KEY D START:RACNT&((X'="^")&(X'=""))
"RTN","RASTED",7,0)
 K RAL,RAI,RAPRI,I2,I3,RAVW,RAEND,RANME,RAPRC,RARPT,RADTE,RADT0,RANEXT,RANXT72,RASK,RACN,RACN0,RADFN,RADUZ,RAPOP,RAST,RAST0,RAFL,RAFST,RAIX,RASSN,RACOMP,X Q
"RTN","RASTED",8,0)
 ;RACOMP defined if [RA STATUS CHANGE] was processed completely
"RTN","RASTED",9,0)
START F I3=1:1:11 S @$P("RADFN^RADTI^RACNI^RANME^RASSN^RADATE^RADTE^RACN^RAPRC^RARPT^RAST","^",I3)=$P(Y,"^",I3)
"RTN","RASTED",10,0)
 I '$D(^RA(72,+RAST,0)) W $C(7),"Invalid status for case #: ",RACN R X:3 Q
"RTN","RASTED",11,0)
 S RAST0=^RA(72,+RAST,0) I $P(RAST0,"^",3)=9 W $C(7),!,"Exam is already complete!!" R X:3 Q
"RTN","RASTED",12,0)
 S X1=""
"RTN","RASTED",13,0)
 I $D(^RA(72,+$P(RAST0,"^",2),0)) S RANEXT=^(0),RASK=$S($D(^(.2)):^(.2),1:""),RANXT72=+$P(RAST0,"^",2)
"RTN","RASTED",14,0)
NEXT I '$D(RANEXT) S DIC("A")="Enter Next Status: ",DIC="^RA(72,",DIC(0)="AEFQZ",DIC("S")="I $P(^(0),U,3),$P(^(0),U,7)=$O(^RA(79.2,""B"",RAIMGTY,0))" D ^DIC K DIC Q:Y'>0  S RANEXT=Y(0),RASK=$S($D(^RA(72,+Y,.2)):^(.2),1:""),RANXT72=+Y
"RTN","RASTED",15,0)
 I $P(RANEXT,"^")=$P(RAST0,"^") W $C(7),!,"Status has already been set to ",$P(RANEXT,"^") R X:3 Q
"RTN","RASTED",16,0)
 I $$LKUP^XPDKEY(+$P(RANEXT,"^",4))]"",'$D(^XUSEC($$LKUP^XPDKEY(+$P(RANEXT,"^",4)),DUZ)) W $C(7),!,"You are not authorized to change to this status" R X:3 Q
"RTN","RASTED",17,0)
 ; check if next status has order field filled in
"RTN","RASTED",18,0)
 G:$P(RANEXT,U,3)]"" OK2
"RTN","RASTED",19,0)
 N RANXTIEN,RALINE S RANXTIEN=$P(RAST0,U,2),$P(RALINE,"_",50)=""
"RTN","RASTED",20,0)
 W !!?15,$C(7),RALINE
"RTN","RASTED",21,0)
 W !!?15,$C(7),"Default Next Status (",$P(RANEXT,U),") is *NOT* active.",!?15,$C(7),RALINE,!
"RTN","RASTED",22,0)
NXT S RANXTIEN=$P(^RA(72,RANXTIEN,0),U,2)
"RTN","RASTED",23,0)
 G:$P($G(^RA(72,+RANXTIEN,0)),U,3)=9 OK0 ;next default status is COMPLETE
"RTN","RASTED",24,0)
 G:RANXTIEN="" BAD ;no next default status pointer
"RTN","RASTED",25,0)
 G:'$D(^RA(72,RANXTIEN,0)) BAD ;no next default status record
"RTN","RASTED",26,0)
 G:$P($G(^RA(72,RANXTIEN,0)),U,3)="" NXT ;no order data, so loop back
"RTN","RASTED",27,0)
 G OK0
"RTN","RASTED",28,0)
BAD W !?15,$C(7),RALINE
"RTN","RASTED",29,0)
 W !!?18,$C(7),"There is no valid higher status to advance to.",!?15,$C(7),RALINE
"RTN","RASTED",30,0)
KEY W !! K DIR S DIR(0)="E",DIR("A")="Press Return key to continue " D ^DIR
"RTN","RASTED",31,0)
 K DIR,DIRUT,DUOUT Q
"RTN","RASTED",32,0)
OK0 S RANEXT=$G(^RA(72,RANXTIEN,0)),RANXT72=RANXTIEN
"RTN","RASTED",33,0)
OK1 W !?15,$C(7),RALINE,!!?18,"Next valid status is : ",$P(RANEXT,U),!?15,$C(7),RALINE
"RTN","RASTED",34,0)
OK2 S RADT0=^RADPT(RADFN,"DT",RADTI,0),RACN0=^("P",RACNI,0),RACS=$P(RACN0,"^",24),RAPRIT=$P(RACN0,"^",2)
"RTN","RASTED",35,0)
CHANGE W !!,"Name: ",RANME,?40,"Case #  : ",RACN,!,"Division : ",$S($D(^DIC(4,+$P(RADT0,"^",3),0)):$P(^(0),"^"),1:"")
"RTN","RASTED",36,0)
 W ?40,"Location: ",$S('$D(^RA(79.1,+$P(RADT0,"^",4),0)):"",$D(^SC(+^(0),0)):$P(^(0),"^"),1:"")
"RTN","RASTED",37,0)
 W !,"Procedure: ",RAPRC
"RTN","RASTED",38,0)
 D PRCCPT^RAPROD
"RTN","RASTED",39,0)
 W !,"   ***** Old Status: ",$P(RAST0,"^"),!,"   ***** New Status: ",$P(RANEXT,"^")
"RTN","RASTED",40,0)
 I RAPRC="Unknown" W !!?5,$C(7),"This record is corrupted -- the procedure is missing,",!?5,"please contact your ADPAC or IRM",! K DIR S DIR(0)="E",DIR("A")="Press RETURN to Continue" D ^DIR K DIR,DIROUT,DIRUT,DTOUT,DUOUT Q
"RTN","RASTED",41,0)
ASK R !,"Do you wish to continue? YES// ",X1:DTIME S:X1="" X1="Y" Q:'$T!(X1["^")!("nN"[X1)
"RTN","RASTED",42,0)
 I X1["?" W !!,"Answer 'Yes' or 'No'.",! G ASK
"RTN","RASTED",43,0)
 S RADUZ=DUZ I '$P(RAMDV,"^",6)!($P(RASK,"^",11)["Y") S RAPOP=0 D USER Q:RAPOP
"RTN","RASTED",44,0)
 N RAPRTSET,RAMEMARR D EN2^RAUTL20(.RAMEMARR) ;is this a print set ?
"RTN","RASTED",45,0)
 N RAWHICH,RAREM,RABEFORE,RAAFTER
"RTN","RASTED",46,0)
 S DIE("NO^")="BACKOUTOK",DR="[RA STATUS CHANGE]"
"RTN","RASTED",47,0)
 S DA=RADFN,RADADA=RADTI,DIE="^RADPT(",RADIE="^RADPT("_RADFN_",""DT"","
"RTN","RASTED",48,0)
 S RAXIT=$$LOCK^RAUTL12(RADIE,RADADA) Q:RAXIT
"RTN","RASTED",49,0)
 ;
"RTN","RASTED",50,0)
 ;save 'before' CM data value to compare against the possible 'after'
"RTN","RASTED",51,0)
 ;value
"RTN","RASTED",52,0)
 D TRK70CMB^RAMAINU(RADFN,RADTI,RACNI,.RATRKCMB) ;RA*5*45
"RTN","RASTED",53,0)
 ;
"RTN","RASTED",54,0)
 D SVBEFOR^RAO7XX(RADFN,RADTI,RACNI) ;P18 save before edit to compare later
"RTN","RASTED",55,0)
 K RACOMP D ^DIE
"RTN","RASTED",56,0)
 ;P18. $D(RABEFORE)=0 means that RASTREQ was not run - the user has interrupted input or timeout happened. So we must call it, then check result (is status changed) and if so - update 70.03 #3 and set RA70033=X
"RTN","RASTED",57,0)
 I '$D(RABEFORE) K DA S X=RANXT72 D:X ^RASTREQ  I $D(X)#2 S RA70033=X D U70033^RADD3(RADFN,RADTI,RACNI,X)
"RTN","RASTED",58,0)
 ;
"RTN","RASTED",59,0)
 ;1) check data consistency between 'CONTRAST MEDIA USED' & 'CONTRAST
"RTN","RASTED",60,0)
 ;MEDIA'
"RTN","RASTED",61,0)
 ;2) check 'before' CM data against 'after' CM data, file in audit log
"RTN","RASTED",62,0)
 ;if necessary. Remember, contrast media asked when in input template:
"RTN","RASTED",63,0)
 ;RA EXAM EDIT (RA*5*45)
"RTN","RASTED",64,0)
 S RACMDA=RACNI,RACMDA(1)=RADTI,RACMDA(2)=RADFN
"RTN","RASTED",65,0)
 D XCMINTEG^RAMAINU1(.RACMDA) ;1
"RTN","RASTED",66,0)
 D TRK70CMA^RAMAINU(RADFN,RADTI,RACNI,RATRKCMB) ;2
"RTN","RASTED",67,0)
 K RACMDA,RAOPRC
"RTN","RASTED",68,0)
 ;
"RTN","RASTED",69,0)
 K DIE("NO^"),DQ,DE,RATRKCMB,RAZCM
"RTN","RASTED",70,0)
 K RANM702,RADIOPH,RADOSE,RAIEN702,RAHI,RALOW,RAPRI,RAMIS,RAI,RAPSDRUG,RAR1
"RTN","RASTED",71,0)
 ;
"RTN","RASTED",72,0)
 ; if EXAM STATUS didn't process, still go thru status-change-logic
"RTN","RASTED",73,0)
 ; variables
"RTN","RASTED",74,0)
 ; ---------
"RTN","RASTED",75,0)
 ;   RA70033: is set in the RA STATUS CHANGE input template after the
"RTN","RASTED",76,0)
 ;             update to the EXAMINATION STATUS field (70.03;3)
"RTN","RASTED",77,0)
 ;    RATCXX: are technologist comments (if any) input by the user
"RTN","RASTED",78,0)
 ;     RAMDV: division parameters, piece 10; store the date/time
"RTN","RASTED",79,0)
 ;            of an exam status change (1 for yes, 0 for no)
"RTN","RASTED",80,0)
 ;
"RTN","RASTED",81,0)
 D:$D(RA70033)&($P(RAMDV,"^",10)) X7005^RADD3(RADFN,RADTI,RACNI,RAMDV,"",RA70033,$S($D(RADUZ):RADUZ,1:DUZ))
"RTN","RASTED",82,0)
 D A7007^RADD3(RADFN,RADTI,RACNI,$S($D(RADUZ):RADUZ,1:DUZ),$G(RATCXX))
"RTN","RASTED",83,0)
 D UNLOCK^RAUTL12(RADIE,RADADA) K RADADA,RADIE
"RTN","RASTED",84,0)
 K RA70033,RADUZ,RATCXX
"RTN","RASTED",85,0)
 N RACN0A ; updated version of the exam node after status updates
"RTN","RASTED",86,0)
 W !,"...Status ",$S($D(RAAFTER)&($G(RABEFORE)=$G(RAAFTER)):"unchanged",$G(RABEFORE)>$G(RAAFTER):"backed down",1:"successfully changed")," for case #: ",RACN
"RTN","RASTED",87,0)
 I $D(RAAFTER),$G(RABEFORE)=$G(RAAFTER) R X:3 D  Q  ;exit if no change
"RTN","RASTED",88,0)
 .D CMPAFTR^RAO7XX(1) Q  ;P18 compares if procedure was changed sends XX message
"RTN","RASTED",89,0)
 ;
"RTN","RASTED",90,0)
 ; if status got backed down, RANEXT is re-defined inside rtn RASTREQ
"RTN","RASTED",91,0)
 ; when the above edit template gets to the EXAM STATUS field
"RTN","RASTED",92,0)
 ;
"RTN","RASTED",93,0)
 D ^RAORDC I +$P(RANEXT,"^",3)>1,RACS'="Y",$S($P(RACN0,"^",6)']"":1,$P(^DIC(42,+$P(RACN0,"^",6),0),U,3)="D":1,1:0) D EN^RAUTL0
"RTN","RASTED",94,0)
 S RACN0A=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) ; updated 0 node!
"RTN","RASTED",95,0)
 ; Do we need to 'Generate Exam Alert' based on the exam status?
"RTN","RASTED",96,0)
 I $D(^RA(72,+$P(RACN0A,"^",3),"ALERT")),($P(^("ALERT"),"^")="y") D
"RTN","RASTED",97,0)
 . ; fire off the 'Rad Patient Examined' alert.
"RTN","RASTED",98,0)
 . N RAPRIT,RAORDIFN
"RTN","RASTED",99,0)
 . S RAPRIT=+$P(RACN0A,"^",2) ; possible call to OERR3^RAORDU1
"RTN","RASTED",100,0)
 . S RAORDIFN=+$P(RACN0A,"^",11) ; possible call to OERR^RAORDU1
"RTN","RASTED",101,0)
 . D:$$ORVR^RAORDU()=2.5 OERR^RAUTL1
"RTN","RASTED",102,0)
 . D:$$ORVR^RAORDU()'<3 OERR3^RAUTL1
"RTN","RASTED",103,0)
 . Q
"RTN","RASTED",104,0)
 I $P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,30)="" D EXM^RAHLRPC
"RTN","RASTED",105,0)
 ;
"RTN","RASTED",106,0)
 R X:3
"RTN","RASTED",107,0)
 D CMPAFTR^RAO7XX(1) ;P18 compares -if procedure was changed - sends XX message
"RTN","RASTED",108,0)
 Q
"RTN","RASTED",109,0)
USER S %="A",%DUZ=DUZ W ! D ^XUVERIFY G USERQ:%=-1 I %'=1 W $C(7)," ??" G USER
"RTN","RASTED",110,0)
 Q
"RTN","RASTED",111,0)
USERQ K RADUZ S RAPOP=1 Q
"RTN","RASTED",112,0)
WHY1 ;explain why prim/sec resid/staff, diagnoses prompts are skipped
"RTN","RASTED",113,0)
 Q:$G(DA)<1!($G(DA(1))<1)!($G(DA(2))<1)
"RTN","RASTED",114,0)
 N RA0,RA1,RA2,RA5 N:'$D(RA3)#2 RA3 N:'$D(RA4)#2 RA4
"RTN","RASTED",115,0)
 S RA0=$G(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q:'RA0  S RA2=0
"RTN","RASTED",116,0)
 I $G(RA3)=13 D WHY11 G WHYMSG ;diagnoses
"RTN","RASTED",117,0)
 S RA3=12,RA4=70 D WHY11 ;residents
"RTN","RASTED",118,0)
 S RA3=15,RA4=60 D WHY11 ;staff
"RTN","RASTED",119,0)
WHYMSG W:'RA2 !!?12,"No data have been entered for ",$S(RA3'=13:"residents/staff",1:"diagnoses")," yet.",!
"RTN","RASTED",120,0)
WHYMSG2 W !?12,$C(7),"The selected case belongs to a print set,",!?12,"Please use the 'Report Enter/Edit' option",!?12,"to enter data for ",$S(RA3=99:"residents/staff/diagnoses",RA3'=13:"residents/staff",1:"diagnoses"),".",!!
"RTN","RASTED",121,0)
 Q
"RTN","RASTED",122,0)
WHY11 Q:'+$P(RA0,"^",RA3)
"RTN","RASTED",123,0)
 S RA2=1 W !!?2,$P(^DD(70.03,RA3,0),"^")," :",?35
"RTN","RASTED",124,0)
 W:RA3'=13 $P(^VA(200,+$P(RA0,"^",RA3),0),"^") W:RA3=13 $P(^RA(78.3,+$P(RA0,"^",RA3),0),"^") W !
"RTN","RASTED",125,0)
 S RA5=$P($P(^DD(70.03,RA4,0),"^",4),";") Q:'$O(^RADPT(DA(2),"DT",DA(1),"P",DA,RA5,0))
"RTN","RASTED",126,0)
 S RA1=0 W !?4,$P(^DD(70.03,RA4,0),"^")," :"
"RTN","RASTED",127,0)
 F  S RA1=$O(^RADPT(DA(2),"DT",DA(1),"P",DA,RA5,RA1)) Q:'RA1  I +^(RA1,0) W ?37 W:RA3'=13 $P($G(^VA(200,+^(0),0)),"^") W:RA3=13 $P($G(^RA(78.3,+^(0),0)),"^") W !
"RTN","RASTED",128,0)
 Q
"RTN","RASTED",129,0)
WHY2 ;explain why diags prompts are skipped
"RTN","RASTED",130,0)
 N RA3 S RA3=13,RA4=13.1 G WHY1
"RTN","RAUTL2")
0^11^B39107271
"RTN","RAUTL2",1,0)
RAUTL2 ;HISC/CAH,FPT,GJC AISC/MJK,RMO-Utility Routine ;11/10/97  11:18
"RTN","RAUTL2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,26,45**;Mar 16, 1998
"RTN","RAUTL2",3,0)
 ;
"RTN","RAUTL2",4,0)
 ;Called from many points within Rad/Nuc Med package ;ch
"RTN","RAUTL2",5,0)
 ;INPUT VARIABLES:  Y=IEN of Rad Report file #74
"RTN","RAUTL2",6,0)
 ;  XRT0,XRT1 If set, will do some response time checks
"RTN","RAUTL2",7,0)
 ;OUTPUT VARIABLES:
"RTN","RAUTL2",8,0)
 ;  RADFN=Patient DFN, RADTE=Exam date/time (FM format), 
"RTN","RAUTL2",9,0)
 ;  RACN=long case number, RADTI=reverse exam date/time,
"RTN","RAUTL2",10,0)
 ;  RACNI=short case number, RADATE=Exam date/time (external format)
"RTN","RAUTL2",11,0)
 ;  Y=If active case, zeroeth node of case record in file #70
"RTN","RAUTL2",12,0)
RASET D:$D(XRTL) T0^%ZOSV S Y=$S($D(^RARPT(+Y,0)):^(0),1:"") Q:'Y  S RADFN=+$P(Y,"^",2),RADTE=+$P(Y,"^",3),RACN=+$P(Y,"^",4),RADTI=9999999.9999-RADTE,RACNI=$O(^RADPT("ADC",$P(Y,"^"),RADFN,RADTI,0)) S Y=RADTE D D^RAUTL S RADATE=Y
"RTN","RAUTL2",13,0)
 S Y="" I RACNI,$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) S Y=^(0)
"RTN","RAUTL2",14,0)
 I $D(XRT0) S XRTN=$T(+0) D T1^%ZOSV
"RTN","RAUTL2",15,0)
 Q
"RTN","RAUTL2",16,0)
 ;
"RTN","RAUTL2",17,0)
 ;Called from 2 x-refs on file #74, Rpt Status fld 5 ;ch
"RTN","RAUTL2",18,0)
 ;Does sets and kills for  'ARES', and 'ASTF' xrefs
"RTN","RAUTL2",19,0)
 ; ** CAUTION ** 1st RARAD=12 or 15, 2nd RARAD=ien for file 200
"RTN","RAUTL2",20,0)
XREF Q:'$D(^RARPT(DA,0))  S RADFNZ=^(0),RADTIZ=9999999.9999-$P(RADFNZ,"^",3),RACNIZ=$O(^RADPT(+$P(RADFNZ,"^",2),"DT",RADTIZ,"P","B",+$P(RADFNZ,"^",4),0)),RADFNZ=+$P(RADFNZ,"^",2),RADA=DA G Q:'RACNIZ
"RTN","RAUTL2",21,0)
 S RARADOLD=RARAD ;save 1st value of rarad
"RTN","RAUTL2",22,0)
 G Q:'$D(^RADPT(RADFNZ,"DT",RADTIZ,"P",RACNIZ,0)) S RARAD=+$P(^(0),"^",RARAD) G Q:'RARAD
"RTN","RAUTL2",23,0)
 ; ** CAUTION ** next line is reached 2 ways : from line above,
"RTN","RAUTL2",24,0)
 ;    and also from file 70.03, fld 15's "ASTF" xref
"RTN","RAUTL2",25,0)
 ;    thus RARAD's 2nd meaning must be preserved for XREF1
"RTN","RAUTL2",26,0)
XREF1 S:$D(RASET) ^RARPT(RAXREF,RARAD,RADA)="" K:$D(RAKILL) ^RARPT(RAXREF,RARAD,RADA) D XPRI^RAUTL20
"RTN","RAUTL2",27,0)
Q K RADA,RADFNZ,RADTIZ,RACNIZ,RARADOLD Q
"RTN","RAUTL2",28,0)
 ;
"RTN","RAUTL2",29,0)
 ;Checks for CONTRAST MEDIA given the necessary subscripts
"RTN","RAUTL2",30,0)
 ;to access a record in File #70.
"RTN","RAUTL2",31,0)
 ;RADFN, RADTI, RACNI must be set.
"RTN","RAUTL2",32,0)
 ;Output is Y=a string delimited by commas containing all
"RTN","RAUTL2",33,0)
 ;applicable items in externally formatted text (ex:  If exam was
"RTN","RAUTL2",34,0)
 ;done with contrast media Y="CONTRAST MEDIA USED"
"RTN","RAUTL2",35,0)
 ;06/16/99 remove obsolete RAF2
"RTN","RAUTL2",36,0)
 ;         add CPT Modifiers string
"RTN","RAUTL2",37,0)
 ; output Y = procedure modifiers string
"RTN","RAUTL2",38,0)
 ;        Y(1)= CPT modifiers string, external
"RTN","RAUTL2",39,0)
 ;        Y(2)= CPT modifiers string, internal
"RTN","RAUTL2",40,0)
MODS ;get procedure modifiers
"RTN","RAUTL2",41,0)
 S (Y,Y(1),Y(2))="" Q:'$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))  S X=^(0)
"RTN","RAUTL2",42,0)
 F I=0:0 S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"M",I)) Q:I'>0  I $D(^RAMIS(71.2,+^(I,0),0)) S X1=$P(^(0),"^") D MODS1
"RTN","RAUTL2",43,0)
 S:$P(X,"^",10)["Y" X1="CONTRAST MEDIA USED"
"RTN","RAUTL2",44,0)
 ;
"RTN","RAUTL2",45,0)
MODS0 ;falls through from MODS; get CPT modifiers
"RTN","RAUTL2",46,0)
 S:Y="" Y="None"
"RTN","RAUTL2",47,0)
 S X=^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),I=0
"RTN","RAUTL2",48,0)
 F  S I=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CMOD",I)) Q:I'>0  S X1=$$BASICMOD^RACPTMSC(+$G(^(I,0)),DT) I +X1>0 S Y(1)=Y(1)_$S(Y(1)="":"",1:", ")_$P(X1,"^",2),Y(2)=Y(2)_$S(Y(2)="":"",1:", ")_$P(X1,"^")
"RTN","RAUTL2",49,0)
 S:Y(1)="" Y(1)="None"
"RTN","RAUTL2",50,0)
 K I,X,X1 Q
"RTN","RAUTL2",51,0)
 ;
"RTN","RAUTL2",52,0)
MODS1 ;builds procedure modifier string (called from MODS above)
"RTN","RAUTL2",53,0)
 S Y=Y_$S(Y="":"",1:", ")_X1 Q
"RTN","RAUTL2",54,0)
 ;
"RTN","RAUTL2",55,0)
 ;called to do some order checks - takes appropriate action if:
"RTN","RAUTL2",56,0)
 ;  procedure requested needs Rad/NM physician approval (File 71, fld 11)
"RTN","RAUTL2",57,0)
 ;  there are other outstanding orders for this procedure for this pt
"RTN","RAUTL2",58,0)
 ;  user is inactivated (file 200, "I" node)
"RTN","RAUTL2",59,0)
ORDPRC I $D(^RAMIS(71,+X,0)),$P(^(0),"^",11)["y" D CHKUSR I 'RAMSG W !!,"Please contact appropriate Imaging Service to request this procedure!  " K X,RAMSG Q
"RTN","RAUTL2",60,0)
 S RAS3=+$P(^RAO(75.1,DA,0),"^")
"RTN","RAUTL2",61,0)
ORDPRC1 Q:'$D(^RAO(75.1,"AP",RAS3,X))  S RAS4=X,RASCNT=0 K RAX
"RTN","RAUTL2",62,0)
 F RAS5=0:0 S RAS5=$O(^RAO(75.1,"AP",RAS3,RAS4,RAS5)) Q:'RAS5  F RAS6=0:0 S RAS6=$O(^RAO(75.1,"AP",RAS3,RAS4,RAS5,RAS6)) Q:'RAS6  I $D(^RAO(75.1,RAS6,0)) S RAT=+$P(^(0),"^",5) I RAT>2 S RASCNT=RASCNT+1 D:$S('$D(RAQUIT):1,1:RASCNT>1) ORDMES
"RTN","RAUTL2",63,0)
 I $D(RAX),'$D(RAQUIT) D ORDMES1
"RTN","RAUTL2",64,0)
 K:$D(RAX) RAQUIT K RAMSG,RAS3,RAS4,RAS5,RAS6,RASCNT,RAT,RAX Q
"RTN","RAUTL2",65,0)
 ;
"RTN","RAUTL2",66,0)
CHKUSR ; Check if valid user
"RTN","RAUTL2",67,0)
 N RAINADT,RAC
"RTN","RAUTL2",68,0)
 S RAINADT=+$P($G(^VA(200,+$G(DUZ),"PS")),"^",4)
"RTN","RAUTL2",69,0)
 S RAC=$O(^VA(200,+$G(DUZ),"RAC",0))
"RTN","RAUTL2",70,0)
 S RAMSG=$S('($D(DUZ)#2):0,'$D(^VA(200,DUZ,0)):0,'RAC:0,'RAINADT:1,'$D(DT):0,DT'>RAINADT:1,1:0)
"RTN","RAUTL2",71,0)
 Q
"RTN","RAUTL2",72,0)
ORDMES W:'$D(RAX) !!,*7,"The following requests are already on file for this procedure:",!
"RTN","RAUTL2",73,0)
 W !?3,"A request dated " S Y=9999999.9999-RAS5 D DT^DIO2 W " is already ",$S(RAT=3:"on ",1:""),$P($P(^DD(75.1,5,0),RAT_":",2),";")," for this procedure." S RAX=1 Q
"RTN","RAUTL2",74,0)
ORDMES1 W !!?3,"Is it ok to continue? No// " R RAX:DTIME S:'$T!(RAX="")!(RAX["^") RAX="N"
"RTN","RAUTL2",75,0)
 I "Nn"[$E(RAX) K X S RAPRI=0
"RTN","RAUTL2",76,0)
 I $D(X),"Yy"'[$E(RAX) W !!?3,"Enter 'YES' to request this procedure for this patient, or 'NO' not to.",! G ORDMES1
"RTN","RAUTL2",77,0)
 Q
"RTN","RAUTL2",78,0)
 ;
"RTN","RAUTL2",79,0)
 ;Called (from RAPSET) to determine if at least one division and at
"RTN","RAUTL2",80,0)
 ;least one location are set up.  Can't use pkg unless these are set up.
"RTN","RAUTL2",81,0)
CHKSP S RADV=$S($O(^RA(79,0))>0:1,1:0),RALC=$S($D(^RA(79.1,+$O(^RA(79,"AL",0)),0)):1,1:0)
"RTN","RAUTL2",82,0)
 Q
"RTN","RAUTL2",83,0)
 ;
"RTN","RAUTL2",84,0)
KILLVAR ;This call will clean up possible variables left after execution
"RTN","RAUTL2",85,0)
 ;of the Label print fields in file 78.7
"RTN","RAUTL2",86,0)
 K RAY0,RAY1,RAY2,RAY3,RAGE,RACSE,RANOW,RADOB,RAEXDT,RATRAN,RARPDT,RADIAG,RAMOD,RAINST,RAEXLST,RAVST,RALCSE,RANM,RAPAGE,RAPR,RAL,RARST,RAREA,RADOC,RARAD,RASSN
"RTN","RAUTL2",87,0)
 K RASTAFF,RASIGS,RATECH,RACTY,RASIGVES,RAVER,RASIGVS,RASIGVSB,RASIGR,RASERV,RASEX,RAS,RAII,RAFMT,RASV
"RTN","RAUTL2",88,0)
 Q
"RTN","RAUTL2",89,0)
 ;
"RTN","RAUTL2",90,0)
CONTRAST(RAZ71) ;Display the contrast media/medium associated with a Rad/Nuc
"RTN","RAUTL2",91,0)
 ;Med Procedure. Called from: PRC1^RAUTL8 & ALLERGY^RAORD1
"RTN","RAUTL2",92,0)
 ;input: RAZ71=ien of the non-parent procedure in file 71
"RTN","RAUTL2",93,0)
 ;
"RTN","RAUTL2",94,0)
 K RAZCM S RAZ71(0)=$G(^RAMIS(71,RAZ71,0))
"RTN","RAUTL2",95,0)
 S RAZCMU=$P(RAZ71(0),"^",20) ;is contrast media used?
"RTN","RAUTL2",96,0)
 I RAZCMU'="Y" K RAZCMU Q
"RTN","RAUTL2",97,0)
 D GETS^DIQ(71,RAZ71_",","125*","E","RAZCM")
"RTN","RAUTL2",98,0)
 ; The RAZCM(71.0125,x,.01,"E") array will be one or more of following
"RTN","RAUTL2",99,0)
 ; values: I:Iodinated contrast, ionic;N:Iodinated contrast, non-ionic
"RTN","RAUTL2",100,0)
 ;         L:Gadolinium, C:Cholecystogram;G:Gastrografin;B:Barium
"RTN","RAUTL2",101,0)
 ;
"RTN","RAUTL2",102,0)
 S:$O(RAZCM(71.0125,$C(126)),-1)=$O(RAZCM(71.0125,"")) RAZTAG="medium"
"RTN","RAUTL2",103,0)
 S:'$D(RAZTAG)#2 RAZTAG="media"
"RTN","RAUTL2",104,0)
 S RAPMSG(1)="**************   Patient reaction to contrast "_RAZTAG_"   *************"
"RTN","RAUTL2",105,0)
 S RAPMSG(2)=$E($P(RAZ71(0),"^"),1,47)_" uses contrast "_RAZTAG_": "
"RTN","RAUTL2",106,0)
 S RAPMSG(2,"F")="!",RAZI="",RAZSUB=$O(RAPMSG($C(32)),-1)
"RTN","RAUTL2",107,0)
 F  S RAZI=$O(RAZCM(71.0125,RAZI)) Q:RAZI=""  D
"RTN","RAUTL2",108,0)
 .S:$L($G(RAPMSG(RAZSUB)))+$L(RAZCM(71.0125,RAZI,.01,"E"))>69 RAZSUB=RAZSUB+1
"RTN","RAUTL2",109,0)
 .S RAPMSG(RAZSUB)=$G(RAPMSG(RAZSUB))_RAZCM(71.0125,RAZI,.01,"E")_", "
"RTN","RAUTL2",110,0)
 .Q
"RTN","RAUTL2",111,0)
 ; The reverse dollar order (R$O) is used to strip off the ", " string
"RTN","RAUTL2",112,0)
 ; from the last printable subscript containing CM data. I also use the
"RTN","RAUTL2",113,0)
 ; R$O to set my last printable array element to '*'s to box off the
"RTN","RAUTL2",114,0)
 ; warning.
"RTN","RAUTL2",115,0)
 S RAPMSG($O(RAPMSG($C(32)),-1))=$E(RAPMSG($O(RAPMSG($C(32)),-1)),1,$L(RAPMSG($O(RAPMSG($C(32)),-1)))-2) ;strips off the ", "
"RTN","RAUTL2",116,0)
 S $P(RAPMSG($O(RAPMSG($C(32)),-1)+1),"*",69)="",RAPMSG(99)=" "
"RTN","RAUTL2",117,0)
 D EN^DDIOL(.RAPMSG)
"RTN","RAUTL2",118,0)
 K RAPMSG,RAZCM,RAZCMU,RAZI,RAZTAG,RAZSUB
"RTN","RAUTL2",119,0)
 Q
"RTN","RAUTL2",120,0)
 ;
"RTN","RAUTL2",121,0)
DELCM(DA) ;Ask the user if he/she is sure that deletion of contrast media
"RTN","RAUTL2",122,0)
 ;is intended. If the user enter '^' exit editng the template
"RTN","RAUTL2",123,0)
 ; input: DA=the ien of the record in file 71
"RTN","RAUTL2",124,0)
 ;output: RAYN=response to 'Are you sure?'; either 'Y', 'N', or '^'  
"RTN","RAUTL2",125,0)
 ;Called from the RA PROCEDURE EDIT input template (RA*5*45)
"RTN","RAUTL2",126,0)
 N RAYN W !?3,"*** Deleting all contrast media data associated with this procedure. ***"
"RTN","RAUTL2",127,0)
 F  D  Q:$L($G(RAYN))
"RTN","RAUTL2",128,0)
 .R !!?3,"All contrast relationships with this procedure will be deleted.",!?3,"Are you sure you want to delete? N// ",RAYN:DTIME
"RTN","RAUTL2",129,0)
 .S:'$T!(RAYN["^") RAYN="^" Q:RAYN="^"
"RTN","RAUTL2",130,0)
 .S:RAYN="" RAYN="N" Q:RAYN="N"
"RTN","RAUTL2",131,0)
 .S RAYN=$$UP^XLFSTR($E(RAYN)) Q:RAYN="Y"!(RAYN="N")
"RTN","RAUTL2",132,0)
 .I RAYN["?" W !?3,"Enter 'Y'es to delete associated contrasts, or 'N'o to preserve associated",!?3,"contrasts." K RAYN Q
"RTN","RAUTL2",133,0)
 .K RAYN W !?3,"Please enter 'Y' for yes, or 'N' for no."
"RTN","RAUTL2",134,0)
 .Q
"RTN","RAUTL2",135,0)
 ;The user does not want to delete associated cm data or has '^' out of
"RTN","RAUTL2",136,0)
 ;the option. We must reset the CONTRAST MEDIA USED (#20) field back to
"RTN","RAUTL2",137,0)
 ;yes from no.
"RTN","RAUTL2",138,0)
 I RAYN'="Y" D
"RTN","RAUTL2",139,0)
 .K RAFDA S RAFDA(71,DA_",",20)="Y" D FILE^DIE("","RAFDA")
"RTN","RAUTL2",140,0)
 .K RAFDA Q
"RTN","RAUTL2",141,0)
 Q RAYN
"RTN","RAUTL2",142,0)
 ;
"RTN","RAUTL21")
0^37^B14822471
"RTN","RAUTL21",1,0)
RAUTL21 ;HOIFO/SWM,CRT;list & delete unneeded ^RARPT("ASTF" & "ARES" ;2/12/99  16:01
"RTN","RAUTL21",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**26,45**;Mar 16, 1998
"RTN","RAUTL21",3,0)
 ;
"RTN","RAUTL21",4,0)
EN1 N RA1,RA2,RACNT,RAKILREF,RALL,RATOT
"RTN","RAUTL21",5,0)
 S U="^"
"RTN","RAUTL21",6,0)
 S $P(RADL,"=",32)=""
"RTN","RAUTL21",7,0)
 S $P(RASL,"-",26)=""
"RTN","RAUTL21",8,0)
 S RATOT=0 ; total # of superfluous x-refs
"RTN","RAUTL21",9,0)
 S RAKILREF=0 ; flag to control kill of x-refs and display
"RTN","RAUTL21",10,0)
 ;
"RTN","RAUTL21",11,0)
 D EN^DDIOL("RAD/NUC MED UTILITY TO LIST/DELETE LEFT-OVER REPORT X-REFS",,"!?3")
"RTN","RAUTL21",12,0)
 D EN^DDIOL(" ",,"!!")
"RTN","RAUTL21",13,0)
 ;
"RTN","RAUTL21",14,0)
 S DIR(0)="Y"
"RTN","RAUTL21",15,0)
 S DIR("B")="YES"
"RTN","RAUTL21",16,0)
 S DIR("A")="  Do you want to print a list of left-over x-refs?"
"RTN","RAUTL21",17,0)
 D ^DIR K DIR
"RTN","RAUTL21",18,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","RAUTL21",19,0)
 I Y=1 D
"RTN","RAUTL21",20,0)
 .N %ZIS
"RTN","RAUTL21",21,0)
 .S %ZIS("A")="Select Device: "
"RTN","RAUTL21",22,0)
 .D ^%ZIS I POP K STOUT,DUOUT,POP Q
"RTN","RAUTL21",23,0)
 .U IO
"RTN","RAUTL21",24,0)
 .F RAXREF="ARES","ASTF" D L1
"RTN","RAUTL21",25,0)
 .S:RATOT=0 RATOT=-1
"RTN","RAUTL21",26,0)
 .D ^%ZISC,HOME^%ZIS
"RTN","RAUTL21",27,0)
 ;
"RTN","RAUTL21",28,0)
 Q:RATOT<0
"RTN","RAUTL21",29,0)
 D EN^DDIOL(" ",,"!!")
"RTN","RAUTL21",30,0)
 S DIR(0)="Y"
"RTN","RAUTL21",31,0)
 S DIR("A")="  Do you want to clean up the"_$S(RATOT:"se "_RATOT,1:"")_" left-over x-refs?"
"RTN","RAUTL21",32,0)
 S DIR("B")="NO"
"RTN","RAUTL21",33,0)
 D ^DIR K DIR
"RTN","RAUTL21",34,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","RAUTL21",35,0)
 I Y=1 D
"RTN","RAUTL21",36,0)
 .S RAKILREF=1
"RTN","RAUTL21",37,0)
 .F RAXREF="ARES","ASTF" D L1
"RTN","RAUTL21",38,0)
 Q
"RTN","RAUTL21",39,0)
 ;
"RTN","RAUTL21",40,0)
L1 ; Loop through left-over x-refs
"RTN","RAUTL21",41,0)
 ;
"RTN","RAUTL21",42,0)
 N WAIT
"RTN","RAUTL21",43,0)
 ;
"RTN","RAUTL21",44,0)
 I 'RAKILREF D HEAD
"RTN","RAUTL21",45,0)
 ;
"RTN","RAUTL21",46,0)
 S WAIT=""
"RTN","RAUTL21",47,0)
 S RA1=0 F  S RA1=$O(^RARPT(RAXREF,RA1)) Q:'RA1  D  Q:WAIT="^"
"RTN","RAUTL21",48,0)
 . S RACNT=0
"RTN","RAUTL21",49,0)
 . S RA2=0 F  S RA2=$O(^RARPT(RAXREF,RA1,RA2)) Q:'RA2  D  Q:WAIT="^"
"RTN","RAUTL21",50,0)
 .. I $D(^RARPT(RA2,0)),$P(^RARPT(RA2,0),U,5)'="V" Q
"RTN","RAUTL21",51,0)
 .. S RACNT=RACNT+1 ; Total for this physician
"RTN","RAUTL21",52,0)
 .. S RATOT=RATOT+1
"RTN","RAUTL21",53,0)
 .. I 'RAKILREF D  Q:WAIT="^"
"RTN","RAUTL21",54,0)
 ... I $Y>(IOSL-3) D WAIT Q:WAIT="^"  S WAIT="" W @IOF D HEAD S RACNT=1
"RTN","RAUTL21",55,0)
 ... D EN^DDIOL($S(RACNT=1:$E($P($G(^VA(200,RA1,0)),U),1,30),1:"  "),,"!?3")
"RTN","RAUTL21",56,0)
 ... D EN^DDIOL($S($D(^RARPT(RA2,0)):$P(^(0),U),1:"Unknown report #"_RA2),,"?40")
"RTN","RAUTL21",57,0)
 .. I RAKILREF D
"RTN","RAUTL21",58,0)
 ... D EN^DDIOL("^RARPT("""_RAXREF_""","_RA1_","_RA2_") deleted","","!?3")
"RTN","RAUTL21",59,0)
 ... K ^RARPT(RAXREF,RA1,RA2)
"RTN","RAUTL21",60,0)
 Q:WAIT="^"
"RTN","RAUTL21",61,0)
 I RATOT=0 D EN^DDIOL("< There are no left-over """_RAXREF_""" x-refs found. >","","!?10")
"RTN","RAUTL21",62,0)
 Q
"RTN","RAUTL21",63,0)
 ;
"RTN","RAUTL21",64,0)
HEAD ;
"RTN","RAUTL21",65,0)
 D EN^DDIOL("LEFT-OVER ^RARPT("""_RAXREF_""") X-REFS",,"!!?20")
"RTN","RAUTL21",66,0)
 D EN^DDIOL(RADL,,"!?20")
"RTN","RAUTL21",67,0)
 D EN^DDIOL($S(RAXREF="ARES":"RESIDENT",1:"STAFF")_" PHYSICIAN",,"!!?3")
"RTN","RAUTL21",68,0)
 D EN^DDIOL("CASE # OF LEFT-OVER X-REF",,"?40")
"RTN","RAUTL21",69,0)
 D EN^DDIOL($S(RAXREF="ARES":$E(RASL,1,18),1:$E(RASL,1,15)),,"!?3")
"RTN","RAUTL21",70,0)
 D EN^DDIOL(RASL,,"?40")
"RTN","RAUTL21",71,0)
 D EN^DDIOL(" ",,"!")
"RTN","RAUTL21",72,0)
 Q
"RTN","RAUTL21",73,0)
 ;
"RTN","RAUTL21",74,0)
WAIT ;
"RTN","RAUTL21",75,0)
 I $E(IOST,1,2)'="C-" S WAIT="" Q  ;Don't prompt if report not to screen
"RTN","RAUTL21",76,0)
 ;
"RTN","RAUTL21",77,0)
 N DIR
"RTN","RAUTL21",78,0)
 S DIR(0)="E"
"RTN","RAUTL21",79,0)
 S (DIR("?"),DIR("??"))=""
"RTN","RAUTL21",80,0)
 D ^DIR K DIR
"RTN","RAUTL21",81,0)
 I Y=""!(Y=0) S WAIT="^"
"RTN","RAUTL21",82,0)
 Q
"RTN","RAUTL21",83,0)
 ;
"RTN","RAUTL21",84,0)
CHGPRC(RAOPRC,RANPRC,DA) ;If a procedure is changed during
"RTN","RAUTL21",85,0)
 ;exam edits, ensure that CM associations of the "changed to"
"RTN","RAUTL21",86,0)
 ;procedure are associated with the exam. If the "changed to"
"RTN","RAUTL21",87,0)
 ;procedure does not have CM associations, make sure the exam
"RTN","RAUTL21",88,0)
 ;does not have CM associations from the "changed from" procedure.
"RTN","RAUTL21",89,0)
 ;
"RTN","RAUTL21",90,0)
 ;called from the RA STATUS CHANGE & RA EXAM EDIT input templates
"RTN","RAUTL21",91,0)
 ;Input: RAOPRC=the IEN of the "changed from" procedure
"RTN","RAUTL21",92,0)
 ;       RANPRC=the IEN of the "changed to" procedure
"RTN","RAUTL21",93,0)
 ;        DA(2)=the IEN of the patient in the PATIENT (#2) file (RADFN)
"RTN","RAUTL21",94,0)
 ;        DA(1)=the inverse date/time of the exam (RADTI)
"RTN","RAUTL21",95,0)
 ;           DA=the IEN of case (RACNI)
"RTN","RAUTL21",96,0)
 ;
"RTN","RAUTL21",97,0)
 I +$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",0)) D
"RTN","RAUTL21",98,0)
 .W !!?3,"Deleting the contrast media with this exam for procedure:",!?3,"'"_$P($G(^RAMIS(71,RAOPRC,0)),U)_"'."
"RTN","RAUTL21",99,0)
 .K ^RADPT(DA(2),"DT",DA(1),"P",DA,"CM") ;kills both data and 'B' xref
"RTN","RAUTL21",100,0)
 .D UPXCM^RAMAINU(.DA,"N") ;set CONTRAST MEDIA USED field to 'no'
"RTN","RAUTL21",101,0)
 .Q
"RTN","RAUTL21",102,0)
 I +$O(^RAMIS(71,RANPRC,"CM",0)) D
"RTN","RAUTL21",103,0)
 .W !!?3,"Adding the contrast media to this exam for procedure:",!?3,"'"_$P($G(^RAMIS(71,RANPRC,0)),U)_"'."
"RTN","RAUTL21",104,0)
 .D STUFCM70^RAMAINU(.DA,RANPRC)
"RTN","RAUTL21",105,0)
 .D UPXCM^RAMAINU(.DA,"Y") ;set CONTRAST MEDIA USED field to 'yes'
"RTN","RAUTL21",106,0)
 .Q
"RTN","RAUTL21",107,0)
 Q
"RTN","RAUTL8")
0^12^B35832037
"RTN","RAUTL8",1,0)
RAUTL8 ;HISC/CAH-Utility routines ;10/3/97  16:02
"RTN","RAUTL8",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**45**;Mar 16, 1998
"RTN","RAUTL8",3,0)
 ;
"RTN","RAUTL8",4,0)
 ;Called by File 70, Exam subfile, Procedure Fld 2 Input transform
"RTN","RAUTL8",5,0)
 ;RA*5*45: modified -  logic in PRC1, ASK, ASK1, & MES1 subroutines
"RTN","RAUTL8",6,0)
 ;          removed -  MES subroutine
"RTN","RAUTL8",7,0)
 ;
"RTN","RAUTL8",8,0)
PRC G PRC1:'$D(^RADPT(DA(2),"DT","AP",X)) ; check for C.M. reaction
"RTN","RAUTL8",9,0)
 N RADUP S RADUP=+$$DPDT^RAUTL8(X,.DA)
"RTN","RAUTL8",10,0)
 I RADUP D ASK Q:'$D(X)
"RTN","RAUTL8",11,0)
PRC1 ; Check for C.M. reaction on this patient
"RTN","RAUTL8",12,0)
 ; +X is the IEN of the Rad/Nuc Med Procedure in file 71
"RTN","RAUTL8",13,0)
 Q:$$ORCHK^GMRAOR(DA(2),"CM")'=1  ;no contrast media reaction
"RTN","RAUTL8",14,0)
 D CONTRAST^RAUTL2(+X) ;displays contrast(s) associated with procedure
"RTN","RAUTL8",15,0)
 ;use RAPMSG for CONTRAST REACTION MESSAGE field 25, file 79
"RTN","RAUTL8",16,0)
 S RAPMSG=$G(^RA(79,+$P(^RADPT(DA(2),"DT",DA(1),0),"^",3),"CON"))
"RTN","RAUTL8",17,0)
 D:RAPMSG'="" EN^DDIOL("..."_RAPMSG_"...","","!?3")
"RTN","RAUTL8",18,0)
 D EN^DDIOL("","","!") ;line feed
"RTN","RAUTL8",19,0)
 K RAPMSG
"RTN","RAUTL8",20,0)
 D:$P($G(^RAMIS(71,+X,0)),U,20)="Y" MES1 ;message only if CM used
"RTN","RAUTL8",21,0)
 Q
"RTN","RAUTL8",22,0)
ASK ; Prompt user for yes/no response
"RTN","RAUTL8",23,0)
 N RAX D EN^DDIOL("Procedure is already entered for this date. Is it ok to continue? No// ","","!!?3")
"RTN","RAUTL8",24,0)
ASK1 R RAX:DTIME
"RTN","RAUTL8",25,0)
 S:'$T!(RAX="")!(RAX["^")!("Nn"[$E(RAX)) RAX="N"
"RTN","RAUTL8",26,0)
 K:RAX="N" X Q:'$D(X)
"RTN","RAUTL8",27,0)
 I "Yy"'[$E(RAX) S RAPMSG(1)="Enter 'YES' to register patient for this procedure, or 'NO' to edit the",RAPMSG(2)="above procedure. No// ",RAPMSG(1,"F")="!!?3",RAPMSG(2,"F")="!?3" D EN^DDIOL(.RAPMSG) K RAPMSG G ASK1
"RTN","RAUTL8",28,0)
 Q
"RTN","RAUTL8",29,0)
 ;
"RTN","RAUTL8",30,0)
MES1 ; display procedure acceptance message
"RTN","RAUTL8",31,0)
 R !?5,"...Type 'OK' to acknowledge or '^' to select another procedure   ==> ",RAX:DTIME
"RTN","RAUTL8",32,0)
 S RAX=$$UP^XLFSTR(RAX)
"RTN","RAUTL8",33,0)
 I '$T!(RAX["^")!(RAX="OK") K:RAX'="OK" X K RAX,RAI Q
"RTN","RAUTL8",34,0)
 G MES1
"RTN","RAUTL8",35,0)
 ;
"RTN","RAUTL8",36,0)
STATSEL ;Select one or more order statuses
"RTN","RAUTL8",37,0)
 ;INPUT VARIABLES:
"RTN","RAUTL8",38,0)
 ;   RANO() array contains status codes prohibited from selection
"RTN","RAUTL8",39,0)
 ;OUTPUT VARIABLES:
"RTN","RAUTL8",40,0)
 ;   RAST is a string of status codes selected (ex: 1^3^8)
"RTN","RAUTL8",41,0)
 ;   RAORST() is an array of selected status codes and status names
"RTN","RAUTL8",42,0)
 ;     (ex:   RAORST(1)="DISCONTINUED", RAORST(3)="HOLD", ... )
"RTN","RAUTL8",43,0)
 K RAST,RAORST W ! S RAORSTS=$P(^DD(75.1,5,0),U,3) F I=1:1 S X=$P(RAORSTS,";",I) Q:X=""  S X1=$P(X,":",1) I '$D(RANO(X1)) S X2=$P(X,":",2),RAORST(X1)=X2
"RTN","RAUTL8",44,0)
 W !!,"Select statuses to include on report.",! S X1="" F  S X1=$O(RAORST(X1)) Q:X1=""  W !?5,$J(X1,2,0)_"   "_RAORST(X1)
"RTN","RAUTL8",45,0)
STAT W ! K DIR S DIR(0)="L" D ^DIR Q:'$D(Y(0))
"RTN","RAUTL8",46,0)
 S RAST="" F I=1:1 S RASTX=$P(Y(0),",",I) Q:RASTX=""  I $D(RAORST(RASTX)) S RAST=RAST_"^"_RASTX
"RTN","RAUTL8",47,0)
 S RAST=$E(RAST,2,99) I RAST="" W !,"  ?? Sorry, invalid status selection.  Please try again.",! G STAT
"RTN","RAUTL8",48,0)
 S I="" F  S I=$O(RAORST(I)) Q:I=""  I RAST'[I K RAORST(I)
"RTN","RAUTL8",49,0)
 K RASTX,I,X,X1,X2 Q
"RTN","RAUTL8",50,0)
 ;
"RTN","RAUTL8",51,0)
 ;INPUT TRANSFORM FOR SECONDARY INTERPRETING RESIDENT
"RTN","RAUTL8",52,0)
S() ; do not enter primary OR SAME SEC in secondary interpreting resident
"RTN","RAUTL8",53,0)
 I '$D(X)!('$D(DA(3))) G S2
"RTN","RAUTL8",54,0)
 I '$D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0)) G S2
"RTN","RAUTL8",55,0)
 I $D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),"SRR","B",+Y)) Q 0 ;SAME SEC RES
"RTN","RAUTL8",56,0)
 I $P(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0),"^",12)=+Y Q 0
"RTN","RAUTL8",57,0)
 Q 1
"RTN","RAUTL8",58,0)
S2 I '$D(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q 0
"RTN","RAUTL8",59,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SRR","B",+Y)) Q 0 ;SAME SEC RES
"RTN","RAUTL8",60,0)
 I $P(^RADPT(DA(2),"DT",DA(1),"P",DA,0),"^",12)=+Y Q 0
"RTN","RAUTL8",61,0)
 Q 1
"RTN","RAUTL8",62,0)
 ;INPUT TRANSFORM FOR SECONDARY INTERPRETING STAFF
"RTN","RAUTL8",63,0)
SSR() ; do not enter primary OR SAME SEC in secondary interpreting staff
"RTN","RAUTL8",64,0)
 I '$D(X)!('$D(DA(3))) G SSR2
"RTN","RAUTL8",65,0)
 I '$D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0)) G SSR2
"RTN","RAUTL8",66,0)
 I $D(^RADPT(DA(3),"DT",DA(2),"P",DA(1),"SSR","B",+Y)) Q 0 ;SAME SEC STF
"RTN","RAUTL8",67,0)
 I $P(^RADPT(DA(3),"DT",DA(2),"P",DA(1),0),"^",15)=+Y Q 0
"RTN","RAUTL8",68,0)
 Q 1
"RTN","RAUTL8",69,0)
SSR2 I '$D(^RADPT(DA(2),"DT",DA(1),"P",DA,0)) Q 0
"RTN","RAUTL8",70,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SSR","B",+Y)) Q 0 ;SAME SEC STF
"RTN","RAUTL8",71,0)
 I $P(^RADPT(DA(2),"DT",DA(1),"P",DA,0),"^",15)=+Y Q 0
"RTN","RAUTL8",72,0)
 Q 1
"RTN","RAUTL8",73,0)
 ;INPUT TRANSFORM FOR PRIMARY INTERPRETING RESIDENT
"RTN","RAUTL8",74,0)
 ; *** NOT USED - See EN ***
"RTN","RAUTL8",75,0)
PRRS() ; do not enter secondary into primary interpreting resident screen
"RTN","RAUTL8",76,0)
 ; called from input transform ^DD(70.03,12,0)
"RTN","RAUTL8",77,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SRR","B",+Y)) Q 0
"RTN","RAUTL8",78,0)
 Q 1
"RTN","RAUTL8",79,0)
 ;INPUT TRANSFORM FOR PRIMARY INTERPRETING STAFF
"RTN","RAUTL8",80,0)
 ; *** NOT USED - See EN ***
"RTN","RAUTL8",81,0)
PSRS() ; do not enter secondary into primary interpreting staff screen
"RTN","RAUTL8",82,0)
 ; called from input transform ^DD(70.03,15,0)
"RTN","RAUTL8",83,0)
 I $D(^RADPT(DA(2),"DT",DA(1),"P",DA,"SSR","B",+Y)) Q 0
"RTN","RAUTL8",84,0)
 Q 1
"RTN","RAUTL8",85,0)
EN(X,FLD,RA) ;Input transform screen for Primary Staff, Primary Res
"RTN","RAUTL8",86,0)
 ;Used by fields 70.03,12 & 70.03,15.  If 'Primary' is found in
"RTN","RAUTL8",87,0)
 ; the 'Secondary' multiple then delete the 'Secondary' entry.
"RTN","RAUTL8",88,0)
 ; X = 'Primary' IEN,  FLD = 'Secondary' mult. to check,  RA = DA array
"RTN","RAUTL8",89,0)
 N DA,DEL,HDR,IEN,NODE,SAVEX,SUBDD,XREF
"RTN","RAUTL8",90,0)
 S NODE=$S(FLD=60:"SSR",FLD=70:"SRR",1:""),SAVEX=X
"RTN","RAUTL8",91,0)
 S SUBDD=$S(FLD=60:70.11,FLD=70:70.09,1:""),(IEN,DEL)=0
"RTN","RAUTL8",92,0)
 I (NODE="")!(X'>0)!(FLD'>0)!(SUBDD'>0) Q
"RTN","RAUTL8",93,0)
 F  S IEN=$O(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,"B",X,IEN)) Q:IEN'>0  D
"RTN","RAUTL8",94,0)
 . S XREF=0
"RTN","RAUTL8",95,0)
 . F  S XREF=$O(^DD(SUBDD,.01,1,XREF)) Q:XREF'>0  D
"RTN","RAUTL8",96,0)
 .. S (D0,DA(3))=RA(2),(D1,DA(2))=RA(1),(D2,DA(1))=RA,(D3,DA)=IEN,X=SAVEX
"RTN","RAUTL8",97,0)
 .. I $G(^DD(SUBDD,.01,1,XREF,2))]"" X ^(2)
"RTN","RAUTL8",98,0)
 .. Q
"RTN","RAUTL8",99,0)
 . K ^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,IEN,0) S DEL=DEL+1
"RTN","RAUTL8",100,0)
 . Q
"RTN","RAUTL8",101,0)
 I DEL D
"RTN","RAUTL8",102,0)
 . S HDR=$G(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0)) Q:HDR=""
"RTN","RAUTL8",103,0)
 . S HDR(3)=+$O(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0))
"RTN","RAUTL8",104,0)
 . S HDR(4)=$P(HDR,U,4)-DEL
"RTN","RAUTL8",105,0)
 . S:HDR(3)'>0 HDR(3)="" S:HDR(4)'>0 HDR(4)=""
"RTN","RAUTL8",106,0)
 . S $P(^RADPT(RA(2),"DT",RA(1),"P",RA,NODE,0),U,3,4)=HDR(3)_U_HDR(4)
"RTN","RAUTL8",107,0)
 . Q
"RTN","RAUTL8",108,0)
 S X=SAVEX
"RTN","RAUTL8",109,0)
 Q
"RTN","RAUTL8",110,0)
DPDT(RAPRC,RAY) ; Check for registration of duplicate procedures on the same
"RTN","RAUTL8",111,0)
 ; date/time.  Called from PRC above.
"RTN","RAUTL8",112,0)
 ; INPUT VARIABLES
"RTN","RAUTL8",113,0)
 ; 'RAPRC' --> IEN of the procedure (71)
"RTN","RAUTL8",114,0)
 ; 'RAY'   --> DA array i.e, DA, DA(1), & DA(2)
"RTN","RAUTL8",115,0)
 ; OUTPUT VARIABLES
"RTN","RAUTL8",116,0)
 ; 'RAFLG' --> RAFLG=1 procedure registered for this date/time
"RTN","RAUTL8",117,0)
 ;         --> RAFLG=0 initial registration for procedure@date/time
"RTN","RAUTL8",118,0)
 N RA72,RABDT,RACIEN,RAEDT,RAFLG,RAI S RAFLG=0
"RTN","RAUTL8",119,0)
 S RABDT=RAY(1)\1,RAEDT=RABDT_".9999",RAI=RABDT-.0000001
"RTN","RAUTL8",120,0)
 F  S RAI=$O(^RADPT(RAY(2),"DT","AP",RAPRC,RAI)) Q:RAI'>0!(RAI>RAEDT)  D  Q:RAFLG
"RTN","RAUTL8",121,0)
 . Q:RAI=RAY(1)  ; At this point our exam status is 'WAITING FOR EXAM'
"RTN","RAUTL8",122,0)
 . S RACIEN=$O(^RADPT(RAY(2),"DT","AP",RAPRC,RAI,0)) Q:'RACIEN
"RTN","RAUTL8",123,0)
 . S RA72=+$P($G(^RADPT(RAY(2),"DT",RAI,"P",RACIEN,0)),U,3) ;xam stat
"RTN","RAUTL8",124,0)
 . S RA72(3)=$P($G(^RA(72,RA72,0)),U,3)
"RTN","RAUTL8",125,0)
 . I RA72(3)'=0 S RAFLG=1 ; cancelled exams are not taken into account
"RTN","RAUTL8",126,0)
 . Q
"RTN","RAUTL8",127,0)
 Q RAFLG
"RTN","RAUTL8",128,0)
SCRN(RADA,RARS,Y,RALVL) ; check if the primary or secondary int'ng staff
"RTN","RAUTL8",129,0)
 ; or resident has access to a location or locations which have
"RTN","RAUTL8",130,0)
 ; an imaging type which match the imaging type of the examination.
"RTN","RAUTL8",131,0)
 ; This screen will also check the classification of the individual to 
"RTN","RAUTL8",132,0)
 ; ensure that they are active and valid for the field being edited.
"RTN","RAUTL8",133,0)
 ;
"RTN","RAUTL8",134,0)
 ; Called from DD's: ^DD(70.03,12 - ^DD(70.03,15  - ^DD(70.03,60
"RTN","RAUTL8",135,0)
 ;                   ^DD(70.03,70 - ^DD(70.09,.01 - ^DD(70.11,.01
"RTN","RAUTL8",136,0)
 ;
"RTN","RAUTL8",137,0)
 ; Input variables:  RADA-> DA array, maps to RADFN, RADTI & RACNI
"RTN","RAUTL8",138,0)
 ;                   RARS-> Classification: Resident("R") or Staff("S")
"RTN","RAUTL8",139,0)
 ;                      Y-> selected resident/staff
"RTN","RAUTL8",140,0)
 ;                   RALVL-> "PRI"=Primary physician, "SEC"=Secondary
"RTN","RAUTL8",141,0)
 ;
"RTN","RAUTL8",142,0)
 ; Output variable: $S(1:I-Types & classification match, resident/staff
"RTN","RAUTL8",143,0)
 ;                      ok,0:no match re-select resident/staff)
"RTN","RAUTL8",144,0)
 ;
"RTN","RAUTL8",145,0)
 I $S('$D(^VA(200,+Y,"RA")):1,'$P(^("RA"),U,3):1,DT'>$P(^("RA"),U,3):1,1:0),($D(^VA(200,"ARC",RARS,+Y)))
"RTN","RAUTL8",146,0)
 Q:'$T 0 ; failed the classification part of the screen
"RTN","RAUTL8",147,0)
 Q:$D(^XUSEC("RA ALLOC",+Y)) 1 ; Resident/Staff has access to all loc's!
"RTN","RAUTL8",148,0)
 N RA7002,RACCESS
"RTN","RAUTL8",149,0)
 ; adjust RADA() due Fileman's unpredictable retention of DA() levels
"RTN","RAUTL8",150,0)
 I RALVL="SEC" D
"RTN","RAUTL8",151,0)
 . I '$D(RADA(3)) S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",152,0)
 . I $D(RADA(3)),(RADA(2)'=RADA(3)) S RA7002=$G(^RADPT(RADA(3),"DT",RADA(2),0))
"RTN","RAUTL8",153,0)
 . I $D(RADA(3)),(RADA(2)=RADA(3)) S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",154,0)
 I RALVL="PRI" S RA7002=$G(^RADPT(RADA(2),"DT",RADA(1),0))
"RTN","RAUTL8",155,0)
 D VARACC^RAUTL6(+Y) ; set-up access array for selected resident/staff
"RTN","RAUTL8",156,0)
 Q:'$D(RACCESS(+Y,"IMG",+$P(RA7002,"^",2))) 0 ; no i-type match
"RTN","RAUTL8",157,0)
 Q 1
"RTN","RAUTL8",158,0)
 ;
"RTN","RAUTL8",159,0)
CMEDIA(RADFN,RADTI,RACNI) ;return the CM used with an exam
"RTN","RAUTL8",160,0)
 ;input: RADFN=patient DFN, RADTI=inv. date/time of exam, RACNI=exam IEN
"RTN","RAUTL8",161,0)
 ;return: contrast media administered to the patient during an exam
"RTN","RAUTL8",162,0)
 N RAI,RAS S RAI=0,RAS=""
"RTN","RAUTL8",163,0)
 F  S RAI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",RAI)) Q:'RAI  D
"RTN","RAUTL8",164,0)
 .S RAI(0)=$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CM",RAI,0)),U)
"RTN","RAUTL8",165,0)
 .S RAS=RAS_$$EXTERNAL^DILFD(70.3225,.01,"",RAI(0))_", "
"RTN","RAUTL8",166,0)
 Q $P(RAS,", ",1,($L(RAS,", ")-1))
"RTN","RAUTL8",167,0)
 ;
"UP",70,70.03,-2)
70^DT
"UP",70,70.03,-1)
70.02^P
"UP",70,70.03,0)
70.03
"UP",70,70.16,-3)
70^DT
"UP",70,70.16,-2)
70.02^P
"UP",70,70.16,-1)
70.03^AUD
"UP",70,70.16,0)
70.16
"UP",70,70.3225,-3)
70^DT
"UP",70,70.3225,-2)
70.02^P
"UP",70,70.3225,-1)
70.03^CM
"UP",70,70.3225,0)
70.3225
"UP",71,71.0125,-1)
71^CM
"UP",71,71.0125,0)
71.0125
"UP",71,71.03,-1)
71^2
"UP",71,71.03,0)
71.03
"UP",71,71.06,-1)
71^AUD
"UP",71,71.06,0)
71.06
"VER")
8.0^22
"^DD",70,70.03,10,0)
CONTRAST MEDIA USED^S^Y:YES;N:NO;^0;10^Q
"^DD",70,70.03,10,.1)
CONTRAST MEDIA USED IN THIS RAD/NUC MED EXAM?
"^DD",70,70.03,10,3)
Enter YES if a contrast was used during this exam.
"^DD",70,70.03,10,10)
RAD/NUC MED TECHNOLOGIST
"^DD",70,70.03,10,21,0)
^.001^11^11^3031217^^
"^DD",70,70.03,10,21,1,0)
This field contains a value to indicate if a contrast medium was, or if 
"^DD",70,70.03,10,21,2,0)
contrast media were used during this Rad/Nuc Med exam.  Available values
"^DD",70,70.03,10,21,3,0)
are: 'Y' for YES and 'N' for NO.
"^DD",70,70.03,10,21,4,0)
 
"^DD",70,70.03,10,21,5,0)
If the Rad/Nuc Med procedure does not involve the use of a contrast, the
"^DD",70,70.03,10,21,6,0)
field is automatically filled in with NO by the system but the user is
"^DD",70,70.03,10,21,7,0)
prompted with this question.
"^DD",70,70.03,10,21,8,0)
 
"^DD",70,70.03,10,21,9,0)
Conversely, if the Rad/Nuc Med procedure does not involve the use of a 
"^DD",70,70.03,10,21,10,0)
contrast, the field is automatically filled in with NO by the system but
"^DD",70,70.03,10,21,11,0)
the user is prompted with this question.
"^DD",70,70.03,10,23,0)
^^1^1^3031217^
"^DD",70,70.03,10,23,1,0)
Modified, description and help text only, with the release of RA*5*45.
"^DD",70,70.03,10,"DT")
2940517
"^DD",70,70.03,225,0)
CONTRAST MEDIA^70.3225S^^CM;0
"^DD",70,70.03,250,0)
CONTRAST MEDIA ACTIVITY LOG^70.16DA^^AUD;0
"^DD",70,70.16,0)
CONTRAST MEDIA ACTIVITY LOG SUB-FIELD^^3^3
"^DD",70,70.16,0,"DT")
3031231
"^DD",70,70.16,0,"IX","B",70.16,.01)

"^DD",70,70.16,0,"NM","CONTRAST MEDIA ACTIVITY LOG")

"^DD",70,70.16,0,"UP")
70.03
"^DD",70,70.16,.01,0)
DATE/TIME EDITED^D^^0;1^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",70,70.16,.01,1,0)
^.1
"^DD",70,70.16,.01,1,1,0)
70.16^B
"^DD",70,70.16,.01,1,1,1)
S ^RADPT(DA(3),"DT",DA(2),"P",DA(1),"AUD","B",$E(X,1,30),DA)=""
"^DD",70,70.16,.01,1,1,2)
K ^RADPT(DA(3),"DT",DA(2),"P",DA(1),"AUD","B",$E(X,1,30),DA)
"^DD",70,70.16,.01,3)
This field contains a system generated date/time of when the contrast medium or media was edited for this Rad/Nuc Med exam.
"^DD",70,70.16,.01,21,0)
^.001^2^2^3031231^^
"^DD",70,70.16,.01,21,1,0)
This field tracks the date/time the contrast medium or media data was
"^DD",70,70.16,.01,21,2,0)
edited for this specific Rad/Nuc Med exam.
"^DD",70,70.16,.01,23,0)
^^1^1^3031231^
"^DD",70,70.16,.01,23,1,0)
Added with the release of RA*5*45
"^DD",70,70.16,.01,"DT")
3031231
"^DD",70,70.16,2,0)
PRIOR CONTRAST MEDIA VALUE^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",70,70.16,2,3)
This field contains the system generated contrast medium or media data of the Rad/Nuc Med exam prior to edit.
"^DD",70,70.16,2,21,0)
^^2^2^3031231^
"^DD",70,70.16,2,21,1,0)
This field tracks the contrast media of the Rad/Nuc Med exam before the
"^DD",70,70.16,2,21,2,0)
edit occurs.
"^DD",70,70.16,2,"DT")
3031231
"^DD",70,70.16,3,0)
USER WHO EDITED CONTRAST^P200'^VA(200,^0;3^Q
"^DD",70,70.16,3,3)
This is a system generated field that tracks the name of the person editing the contrast media data for this Rad/Nuc Med exam.
"^DD",70,70.16,3,21,0)
^^2^2^3031231^
"^DD",70,70.16,3,21,1,0)
This field tracks the person editing the contrast media data for this
"^DD",70,70.16,3,21,2,0)
Rad/Nuc Med exam.
"^DD",70,70.16,3,"DT")
3040107
"^DD",70,70.3225,0)
CONTRAST MEDIA SUB-FIELD^^.01^1
"^DD",70,70.3225,0,"DT")
3041207
"^DD",70,70.3225,0,"IX","B",70.3225,.01)

"^DD",70,70.3225,0,"NM","CONTRAST MEDIA")

"^DD",70,70.3225,0,"UP")
70.03
"^DD",70,70.3225,.01,0)
CONTRAST MEDIA^MS^I:Ionic Iodinated;N:Non-ionic Iodinated;L:Gadolinium;C:Cholecystographic;G:Gastrografin;B:Barium;M:unspecified contrast media;^0;1^Q
"^DD",70,70.3225,.01,1,0)
^.1
"^DD",70,70.3225,.01,1,1,0)
70.3225^B
"^DD",70,70.3225,.01,1,1,1)
S ^RADPT(DA(3),"DT",DA(2),"P",DA(1),"CM","B",$E(X,1,30),DA)=""
"^DD",70,70.3225,.01,1,1,2)
K ^RADPT(DA(3),"DT",DA(2),"P",DA(1),"CM","B",$E(X,1,30),DA)
"^DD",70,70.3225,.01,3)
Enter the contrast agent(s) associated with this exam.
"^DD",70,70.3225,.01,7.5)
S X=$$UP^XLFSTR(X)
"^DD",70,70.3225,.01,21,0)
^.001^2^2^3041207^^^^
"^DD",70,70.3225,.01,21,1,0)
This field identifies the contrast agent(s) associated with this Rad/Nuc 
"^DD",70,70.3225,.01,21,2,0)
Med exam.
"^DD",70,70.3225,.01,23,0)
^.001^1^1^3041207^^^^
"^DD",70,70.3225,.01,23,1,0)
This field was added with RA*5*45.
"^DD",70,70.3225,.01,"DT")
3041207
"^DD",71,71,20,0)
CONTRAST MEDIA USED^S^Y:Yes;N:No;^0;20^Q
"^DD",71,71,20,1,0)
^.1
"^DD",71,71,20,1,1,0)
71^CM
"^DD",71,71,20,1,1,1)
S ^RAMIS(71,"CM",$E(X,1,30),DA)=""
"^DD",71,71,20,1,1,2)
K ^RAMIS(71,"CM",$E(X,1,30),DA)
"^DD",71,71,20,1,1,3)
Please do not delete.
"^DD",71,71,20,1,1,"%D",0)
^^4^4^3031031^
"^DD",71,71,20,1,1,"%D",1,0)
Tracks which Rad/Nuc Med Procedures have associated contrast media or 
"^DD",71,71,20,1,1,"%D",2,0)
medium. This cross-reference is used to display the procedure/contrast 
"^DD",71,71,20,1,1,"%D",3,0)
media or medium link as efficiently (by not hitting every record) as
"^DD",71,71,20,1,1,"%D",4,0)
possible.
"^DD",71,71,20,1,1,"DT")
3031031
"^DD",71,71,20,3)
Enter 'Yes' if a contrast agent is used with this procedure.
"^DD",71,71,20,21,0)
^.001^3^3^3031106^^^
"^DD",71,71,20,21,1,0)
This field contains a value to indicate if a contrast agent is used
"^DD",71,71,20,21,2,0)
with this Rad/Nuc Med procedure. Acceptable values are: 'Y' for 'Yes'
"^DD",71,71,20,21,3,0)
and 'N' for 'No'.
"^DD",71,71,20,23,0)
^^1^1^3031106^
"^DD",71,71,20,23,1,0)
Added with RA*5*45
"^DD",71,71,20,"DT")
3031031
"^DD",71,71,125,0)
CONTRAST MEDIA^71.0125S^^CM;0
"^DD",71,71,125,21,0)
^.001^2^2^3031216^^^^
"^DD",71,71,125,21,1,0)
This field identifies the contrast agent(s) associated with this
"^DD",71,71,125,21,2,0)
Rad/Nuc Med procedure.
"^DD",71,71,125,23,0)
^.001^1^1^3031216^^^
"^DD",71,71,125,23,1,0)
This field was added with RA*5*45.
"^DD",71,71,175,0)
AMIS CODES^71.03PA^^2;0
"^DD",71,71,175,.1)
AMIS CODES SUB-FIELD
"^DD",71,71,175,21,0)
^^2^2^2940608^^^^
"^DD",71,71,175,21,1,0)
This is a multiple field containing information for the AMIS codes
"^DD",71,71,175,21,2,0)
associated with this procedure.
"^DD",71,71,250,0)
CONTRAST MEDIA ACTIVITY LOG^71.06DA^^AUD;0
"^DD",71,71.0125,0)
CONTRAST MEDIA SUB-FIELD^^.01^1
"^DD",71,71.0125,0,"DT")
3041207
"^DD",71,71.0125,0,"IX","B",71.0125,.01)

"^DD",71,71.0125,0,"NM","CONTRAST MEDIA")

"^DD",71,71.0125,0,"UP")
71
"^DD",71,71.0125,.01,0)
CONTRAST MEDIA^MS^I:Ionic Iodinated;N:Non-ionic Iodinated;L:Gadolinium;C:Cholecystographic;G:Gastrografin;B:Barium;M:unspecified contrast media;^0;1^Q
"^DD",71,71.0125,.01,1,0)
^.1
"^DD",71,71.0125,.01,1,1,0)
71.0125^B
"^DD",71,71.0125,.01,1,1,1)
S ^RAMIS(71,DA(1),"CM","B",$E(X,1,30),DA)=""
"^DD",71,71.0125,.01,1,1,2)
K ^RAMIS(71,DA(1),"CM","B",$E(X,1,30),DA)
"^DD",71,71.0125,.01,3)
Enter the contrast agent(s) associated with this procedure. 
"^DD",71,71.0125,.01,7.5)
S X=$$UP^XLFSTR(X)
"^DD",71,71.0125,.01,21,0)
^.001^2^2^3041207^^
"^DD",71,71.0125,.01,21,1,0)
This field identifies the contrast agent(s) associated with this Rad/Nuc
"^DD",71,71.0125,.01,21,2,0)
Med procedure.
"^DD",71,71.0125,.01,"DT")
3041207
"^DD",71,71.03,0)
AMIS CODES SUB-FIELD^NL^4^4
"^DD",71,71.03,0,"NM","AMIS CODES")

"^DD",71,71.03,.01,0)
AMIS CODE^MP71.1'X^RAMIS(71.1,^0;1^D DD71^RASITE Q
"^DD",71,71.03,.01,.1)
AMIS CODE FOR THIS PROCEDURE
"^DD",71,71.03,.01,1,0)
^.1^^-1
"^DD",71,71.03,.01,1,1,0)
71^AC
"^DD",71,71.03,.01,1,1,1)
S ^RAMIS(71,"AC",$E(X,1,30),DA(1),DA)=""
"^DD",71,71.03,.01,1,1,2)
K ^RAMIS(71,"AC",$E(X,1,30),DA(1),DA)
"^DD",71,71.03,.01,1,1,"%D",0)
^^2^2^3040721^
"^DD",71,71.03,.01,1,1,"%D",1,0)
This cross reference is used to determine the AMIS codes associated with
"^DD",71,71.03,.01,1,1,"%D",2,0)
a procedure.
"^DD",71,71.03,.01,1,1,"DT")
2910624
"^DD",71,71.03,.01,3)
Enter a valid AMIS code for this procedure.
"^DD",71,71.03,.01,10)
RAD/NUC MED COORDINATOR
"^DD",71,71.03,.01,21,0)
^^7^7^2941019^
"^DD",71,71.03,.01,21,1,0)
This field contains the valid AMIS code(s) (from the Major AMIS Codes
"^DD",71,71.03,.01,21,2,0)
File) associated with this exam procedure.
"^DD",71,71.03,.01,21,3,0)
 
"^DD",71,71.03,.01,21,4,0)
There may be more than one AMIS code associated with each procedure.  If the
"^DD",71,71.03,.01,21,5,0)
procedure type is 'Detailed', there will be one AMIS code.  If the 
"^DD",71,71.03,.01,21,6,0)
procedure type is 'Series', there will be more than one AMIS code.  'Broad'
"^DD",71,71.03,.01,21,7,0)
types of procedures have no AMIS code.
"^DD",71,71.03,.01,"DT")
2921112
"^DD",71,71.06,0)
CONTRAST MEDIA ACTIVITY LOG SUB-FIELD^^3^3
"^DD",71,71.06,0,"DT")
3031202
"^DD",71,71.06,0,"IX","B",71.06,.01)

"^DD",71,71.06,0,"NM","CONTRAST MEDIA ACTIVITY LOG")

"^DD",71,71.06,0,"UP")
71
"^DD",71,71.06,.01,0)
DATE/TIME EDITED^D^^0;1^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",71,71.06,.01,1,0)
^.1
"^DD",71,71.06,.01,1,1,0)
71.06^B
"^DD",71,71.06,.01,1,1,1)
S ^RAMIS(71,DA(1),"AUD","B",$E(X,1,30),DA)=""
"^DD",71,71.06,.01,1,1,2)
K ^RAMIS(71,DA(1),"AUD","B",$E(X,1,30),DA)
"^DD",71,71.06,.01,1,1,3)
Do not delete; used in the generation of the contrast media history report.
"^DD",71,71.06,.01,1,1,"%D",0)
^.101^2^2^3031205^^
"^DD",71,71.06,.01,1,1,"%D",1,0)
This cross-reference is used to generate a report that displays the 
"^DD",71,71.06,.01,1,1,"%D",2,0)
Contrast Media history for Rad/Nuc Med Procedure (#71) file records. 
"^DD",71,71.06,.01,1,1,"DT")
3031205
"^DD",71,71.06,.01,3)
This field contains a system generated date/time of when the contrast medium or media data was edited for this Rad/Nuc Med Procedure file record.
"^DD",71,71.06,.01,21,0)
^.001^2^2^3031202^^
"^DD",71,71.06,.01,21,1,0)
This field tracks the date/time the contrast medium or media data was edited
"^DD",71,71.06,.01,21,2,0)
for this specific Rad/Nuc Med Procedure file record.
"^DD",71,71.06,.01,23,0)
^.001^4^4^3031202^^
"^DD",71,71.06,.01,23,1,0)
The data in this sub-file will be triggered from a M cross-reference on 
"^DD",71,71.06,.01,23,2,0)
the CONTRAST MEDIA field resident in the CONTRAST MEDIA sub-file.
"^DD",71,71.06,.01,23,3,0)
 
"^DD",71,71.06,.01,23,4,0)
The CONTRAST MEDIA sub-file is: 71.0125, .01 is the field.
"^DD",71,71.06,.01,"DT")
3031205
"^DD",71,71.06,2,0)
PRIOR CONTRAST MEDIA VALUE^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",71,71.06,2,3)
This field contains the system generated contrast medium or media data of the Rad/Nuc Med Procedure record prior to edit.
"^DD",71,71.06,2,21,0)
^^2^2^3031202^
"^DD",71,71.06,2,21,1,0)
This field tracks the contrast media of the procedure before the edit
"^DD",71,71.06,2,21,2,0)
occurs.
"^DD",71,71.06,2,"DT")
3031202
"^DD",71,71.06,3,0)
USER WHO EDITED CONTRAST^P200'^VA(200,^0;3^Q
"^DD",71,71.06,3,3)
This is a system generated field that tracks the name of the person editing the contrast media data for this procedure.
"^DD",71,71.06,3,21,0)
^^2^2^3031202^
"^DD",71,71.06,3,21,1,0)
This field tracks the person editing the contrast media data for this
"^DD",71,71.06,3,21,2,0)
procedure.
"^DD",71,71.06,3,"DT")
3031202
"^DD",71.1,71.1,.001,0)
MAJOR AMIS CODE^NJ2,0^^ ^K:+X'=X!(X>27)!(X<1)!(X?.E1"."1N.N) X
"^DD",71.1,71.1,.001,.1)
MAJOR RAD/NUC MED AMIS CODE
"^DD",71.1,71.1,.001,3)
Type a Number between 1 and 27, 0 Decimal Digits
"^DD",71.1,71.1,.001,10)
CENTRAL OFFICE
"^DD",71.1,71.1,.001,21,0)
^^5^5^3040203^
"^DD",71.1,71.1,.001,21,1,0)
This field contains the number, between 1 and 27, of this major AMIS code.
"^DD",71.1,71.1,.001,21,2,0)
AMIS codes are used in the compilation of various workload reports, 
"^DD",71.1,71.1,.001,21,3,0)
including the AMIS Report. On certain reports that are sorted by
"^DD",71.1,71.1,.001,21,4,0)
procedure, the sort is actually done by the AMIS category of the
"^DD",71.1,71.1,.001,21,5,0)
procedure.
"^DD",71.1,71.1,.001,"DT")
2940518
"^DD",71.1,71.1,.01,0)
DESCRIPTION^RF^^0;1^K:$L(X)>50!($L(X)<3)!'(X'?1P.E)!(X'?.ANP) X
"^DD",71.1,71.1,.01,.1)
DESCRIPTION OF THIS MAJOR AMIS CODE
"^DD",71.1,71.1,.01,1,0)
^.1
"^DD",71.1,71.1,.01,1,1,0)
71.1^B
"^DD",71.1,71.1,.01,1,1,1)
S ^RAMIS(71.1,"B",$E(X,1,30),DA)=""
"^DD",71.1,71.1,.01,1,1,2)
K ^RAMIS(71.1,"B",$E(X,1,30),DA)
"^DD",71.1,71.1,.01,1,1,"%D",0)
^^1^1^2940518^
"^DD",71.1,71.1,.01,1,1,"%D",1,0)
     Regular 'B' crosss reference assigned by FileMan.
"^DD",71.1,71.1,.01,3)
Enter a brief description, between 3 and 50 characters, of this AMIS code.
"^DD",71.1,71.1,.01,10)
CENTRAL OFFICE
"^DD",71.1,71.1,.01,21,0)
^^6^6^2941025^
"^DD",71.1,71.1,.01,21,1,0)
This field contains a brief description, 3-50 characters, of this AMIS code.
"^DD",71.1,71.1,.01,21,2,0)
AMIS codes are used in the compilation of various workload reports,
"^DD",71.1,71.1,.01,21,3,0)
including the AMIS Report.
"^DD",71.1,71.1,.01,21,4,0)
 
"^DD",71.1,71.1,.01,21,5,0)
Since the AMIS codes are assigned by the Radiology Central Office, they
"^DD",71.1,71.1,.01,21,6,0)
should not be changed without the approval of the Central Office.
"^DD",71.1,71.1,.01,"DEL",1,0)
I 1 D EN^DDIOL("Major AMIS codes can not be deleted.",,"!,$C(7)")
"^DD",71.1,71.1,.01,"DT")
2940608
**END**
**END**
