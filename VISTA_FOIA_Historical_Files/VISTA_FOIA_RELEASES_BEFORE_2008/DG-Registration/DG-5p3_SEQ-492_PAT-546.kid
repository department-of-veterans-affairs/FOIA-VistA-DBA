Released DG*5.3*546 SEQ #492
Extracted from mail message
**KIDS**:DG*5.3*546^

**INSTALL NAME**
DG*5.3*546
"BLD",4923,0)
DG*5.3*546^REGISTRATION^0^3040113^y
"BLD",4923,1,0)
^^2^2^3031021^^^^
"BLD",4923,1,1,0)
The Patch (DG*5.3*546) fixes problems related to Insurance Data, Primary and
"BLD",4923,1,2,0)
Secondary IDs.
"BLD",4923,4,0)
^9.64PA^^
"BLD",4923,"INIT")
POST^DG53546P
"BLD",4923,"KRN",0)
^9.67PA^8989.52^19
"BLD",4923,"KRN",.4,0)
.4
"BLD",4923,"KRN",.401,0)
.401
"BLD",4923,"KRN",.402,0)
.402
"BLD",4923,"KRN",.403,0)
.403
"BLD",4923,"KRN",.5,0)
.5
"BLD",4923,"KRN",.84,0)
.84
"BLD",4923,"KRN",3.6,0)
3.6
"BLD",4923,"KRN",3.8,0)
3.8
"BLD",4923,"KRN",9.2,0)
9.2
"BLD",4923,"KRN",9.8,0)
9.8
"BLD",4923,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",4923,"KRN",9.8,"NM",1,0)
DGRP1^^0^B21511165
"BLD",4923,"KRN",9.8,"NM",2,0)
DGRPV^^0^B16031996
"BLD",4923,"KRN",9.8,"NM",3,0)
DGPREP0^^0^B30683896
"BLD",4923,"KRN",9.8,"NM",5,0)
DG53546P^^0^B2251428
"BLD",4923,"KRN",9.8,"NM","B","DG53546P",5)

"BLD",4923,"KRN",9.8,"NM","B","DGPREP0",3)

"BLD",4923,"KRN",9.8,"NM","B","DGRP1",1)

"BLD",4923,"KRN",9.8,"NM","B","DGRPV",2)

"BLD",4923,"KRN",19,0)
19
"BLD",4923,"KRN",19,"NM",0)
^9.68A^^
"BLD",4923,"KRN",19.1,0)
19.1
"BLD",4923,"KRN",101,0)
101
"BLD",4923,"KRN",409.61,0)
409.61
"BLD",4923,"KRN",771,0)
771
"BLD",4923,"KRN",870,0)
870
"BLD",4923,"KRN",8989.51,0)
8989.51
"BLD",4923,"KRN",8989.52,0)
8989.52
"BLD",4923,"KRN",8994,0)
8994
"BLD",4923,"KRN","B",.4,.4)

"BLD",4923,"KRN","B",.401,.401)

"BLD",4923,"KRN","B",.402,.402)

"BLD",4923,"KRN","B",.403,.403)

"BLD",4923,"KRN","B",.5,.5)

"BLD",4923,"KRN","B",.84,.84)

"BLD",4923,"KRN","B",3.6,3.6)

"BLD",4923,"KRN","B",3.8,3.8)

"BLD",4923,"KRN","B",9.2,9.2)

"BLD",4923,"KRN","B",9.8,9.8)

"BLD",4923,"KRN","B",19,19)

"BLD",4923,"KRN","B",19.1,19.1)

"BLD",4923,"KRN","B",101,101)

"BLD",4923,"KRN","B",409.61,409.61)

"BLD",4923,"KRN","B",771,771)

"BLD",4923,"KRN","B",870,870)

"BLD",4923,"KRN","B",8989.51,8989.51)

"BLD",4923,"KRN","B",8989.52,8989.52)

"BLD",4923,"KRN","B",8994,8994)

"BLD",4923,"PRE")
DG53546P
"BLD",4923,"QUES",0)
^9.62^^
"BLD",4923,"REQB",0)
^9.611^2^2
"BLD",4923,"REQB",1,0)
DG*5.3*244^1
"BLD",4923,"REQB",2,0)
DG*5.3*489^1
"BLD",4923,"REQB","B","DG*5.3*244",1)

"BLD",4923,"REQB","B","DG*5.3*489",2)

"INIT")
POST^DG53546P
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
546^3040113^100850
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3040113
"PKG",5,22,1,"PAH",1,1,1,0)
The Patch (DG*5.3*546) fixes problems related to Insurance Data, Primary and
"PKG",5,22,1,"PAH",1,1,2,0)
Secondary IDs.
"PRE")
DG53546P
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DG53546P")
0^5^B2251428
"RTN","DG53546P",1,0)
DG53546P ; BAY/KAM- Patch DG*5.3*546 Install Utility Routine ; 9/29/03 4:46pm
"RTN","DG53546P",2,0)
 ;;5.3;Registration;**546**;AUG 13, 1993
"RTN","DG53546P",3,0)
 ;
"RTN","DG53546P",4,0)
ENV ;Main entry point for Environment check point.
"RTN","DG53546P",5,0)
 ;
"RTN","DG53546P",6,0)
 S XPDABORT=""
"RTN","DG53546P",7,0)
 D PROGCHK(.XPDABORT) ;checks programmer variables
"RTN","DG53546P",8,0)
 I XPDABORT="" K XPDABORT
"RTN","DG53546P",9,0)
 Q
"RTN","DG53546P",10,0)
PRE ;Main entry point for Pre-install items.
"RTN","DG53546P",11,0)
 Q
"RTN","DG53546P",12,0)
 ;
"RTN","DG53546P",13,0)
 ;
"RTN","DG53546P",14,0)
POST ;Main entry point for Post-install items.
"RTN","DG53546P",15,0)
 ;
"RTN","DG53546P",16,0)
 D POST1
"RTN","DG53546P",17,0)
 Q
"RTN","DG53546P",18,0)
POST1 ; Update DIC(8  Eligibility Code for TRICARE/CHAMPUS
"RTN","DG53546P",19,0)
 ; NOIS CALLS CHY-0703-52232, PHI-0600-21416, MAC-1101-61117,
"RTN","DG53546P",20,0)
 ;            MAC-0201-61637, EKH-0600-41137
"RTN","DG53546P",21,0)
 N ELGIEN,NATIEN,DA,DR,DIE
"RTN","DG53546P",22,0)
 S ELGIEN=0
"RTN","DG53546P",23,0)
 F  S ELGIEN=$O(^DIC(8,ELGIEN)) Q:ELGIEN=""!(ELGIEN'?1.N)  D
"RTN","DG53546P",24,0)
 . S NATIEN=$P(^DIC(8,ELGIEN,0),"^",9)
"RTN","DG53546P",25,0)
 . I $P(^DIC(8.1,NATIEN,0),"^")="TRICARE/CHAMPUS" D 
"RTN","DG53546P",26,0)
 .. S DIE="^DIC(8,",DA=ELGIEN,DR="9///VA STANDARD"
"RTN","DG53546P",27,0)
 .. D ^DIE
"RTN","DG53546P",28,0)
 Q
"RTN","DG53546P",29,0)
PROGCHK(XPDABORT)       ;checks for necessary programmer variables
"RTN","DG53546P",30,0)
 ;
"RTN","DG53546P",31,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","DG53546P",32,0)
 . D BMES^XPDUTL("*****")
"RTN","DG53546P",33,0)
 . D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","DG53546P",34,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","DG53546P",35,0)
 . D MES^XPDUTL("*****")
"RTN","DG53546P",36,0)
 . S XPDABORT=2
"RTN","DG53546P",37,0)
 Q
"RTN","DGPREP0")
0^3^B30683896
"RTN","DGPREP0",1,0)
DGPREP0 ;Boise/WRL/ALB/SCK-Program to Display Pre-Registration List ; 1/13/04 9:16am
"RTN","DGPREP0",2,0)
 ;;5.3;Registration;**109,546**;Aug 13, 1993
"RTN","DGPREP0",3,0)
 Q
"RTN","DGPREP0",4,0)
 ;
"RTN","DGPREP0",5,0)
EN ; -- main entry point
"RTN","DGPREP0",6,0)
 N VAUTD,X1,DGDFN
"RTN","DGPREP0",7,0)
 ;
"RTN","DGPREP0",8,0)
 I '$D(^XUSEC("DGPRE EDIT",DUZ))&('$D(^XUSEC("DGPRE SUPV",DUZ))) D  G ENQ
"RTN","DGPREP0",9,0)
 . W !!,"You do not have the DG PREREGISTRATION EDIT Key allocated, contact your Supervisor."
"RTN","DGPREP0",10,0)
 ;  *** Select Divisions
"RTN","DGPREP0",11,0)
 I $P($G(^DG(43,1,"GL")),U,2) D
"RTN","DGPREP0",12,0)
 . D DIVISION^VAUTOMA
"RTN","DGPREP0",13,0)
 E  D
"RTN","DGPREP0",14,0)
 . S DGSNGLDV=1
"RTN","DGPREP0",15,0)
 . S VAUTD=1
"RTN","DGPREP0",16,0)
 ;
"RTN","DGPREP0",17,0)
 D EN^VALM("DGPRE RG")
"RTN","DGPREP0",18,0)
ENQ Q
"RTN","DGPREP0",19,0)
 ;
"RTN","DGPREP0",20,0)
HDR ; -- header code
"RTN","DGPREP0",21,0)
 ; Variables
"RTN","DGPREP0",22,0)
 ;   DGPSRT  - Sort Method for call list display
"RTN","DGPREP0",23,0)
 ;
"RTN","DGPREP0",24,0)
 N DGPSRT
"RTN","DGPREP0",25,0)
 I $D(VAUTD) S VALMHDR(1)="Call List sorted by Division and then "
"RTN","DGPREP0",26,0)
 S DGPSRT=$P($G(^DG(43,1,"DGPRE")),U)
"RTN","DGPREP0",27,0)
 S VALMHDR(1)=$G(VALMHDR(1))_"Sorted by "_$S(DGPSRT="P":"Patient Name",DGPSRT="S":"Medical Service")_"."
"RTN","DGPREP0",28,0)
 I $G(VAUTD) S VALMHDR(2)="All Divisions selected."
"RTN","DGPREP0",29,0)
 Q
"RTN","DGPREP0",30,0)
 ;
"RTN","DGPREP0",31,0)
INIT ; -- Retrieve data from call list and build TMP global for sorting Call lsit
"RTN","DGPREP0",32,0)
 ;  Variables
"RTN","DGPREP0",33,0)
 ;    DGPNR    - 
"RTN","DGPREP0",34,0)
 ;    DGPDATA  - 0 Node from ^DGS(41.42,X
"RTN","DGPREP0",35,0)
 ;    DGPDATA1 - 1 Node from ^DGS(41.42,X
"RTN","DGPREP0",36,0)
 ;    DGPDIV   - Division IEN from ^DGS(41.42,
"RTN","DGPREP0",37,0)
 ;    DGPDVN   - Division Name
"RTN","DGPREP0",38,0)
 ;    DGPSV    - Medical Service for appointment clinic
"RTN","DGPREP0",39,0)
 ;    DGPAT    - Appt. date/time
"RTN","DGPREP0",40,0)
 ;    DGPPN    - Patients name
"RTN","DGPREP0",41,0)
 ;    DGPNR    - Index No. for LM
"RTN","DGPREP0",42,0)
 ;    DGPSRT   - Call list sort method
"RTN","DGPREP0",43,0)
 ;    DGPN0,DGPN1,DGPNX - Local Var's for $O
"RTN","DGPREP0",44,0)
 ;
"RTN","DGPREP0",45,0)
 N DGQ,DGPDATA,DGPDATA1,DGPDIV,DGPDVN,DGPNX,DGPN1,DGPN2
"RTN","DGPREP0",46,0)
 N DGDFN,DGKFLAG,DGHLOC,DGTDAY,DGOB,DGAPDT
"RTN","DGPREP0",47,0)
 ;
"RTN","DGPREP0",48,0)
 K ^TMP("DGPRERG",$J)
"RTN","DGPREP0",49,0)
 K ^TMP($J)
"RTN","DGPREP0",50,0)
 S DGPSRT=$P($G(^DG(43,1,"DGPRE")),U)
"RTN","DGPREP0",51,0)
 I $P($G(^DGS(41.42,0)),U,4)>1 W !!,"Sorting Entries..."
"RTN","DGPREP0",52,0)
 ;
"RTN","DGPREP0",53,0)
 D NOW^%DTC S DGTDAY=$P(%,".")
"RTN","DGPREP0",54,0)
 S DGPN1=0 F  S DGPN1=$O(^DGS(41.42,DGPN1)) Q:'DGPN1  D
"RTN","DGPREP0",55,0)
 . S DGPDATA=$G(^DGS(41.42,DGPN1,0)),DGPDATA1=$G(^DGS(41.42,DGPN1,1))
"RTN","DGPREP0",56,0)
 . Q:DGPDATA']""!(DGPDATA1']"")
"RTN","DGPREP0",57,0)
 . ; ****  Division handling
"RTN","DGPREP0",58,0)
 . S DGPDIV=$P(DGPDATA,U,2)
"RTN","DGPREP0",59,0)
 . I +DGPDIV'>0 D
"RTN","DGPREP0",60,0)
 .. I $G(DGSNGLDV) S DGPDIV=$S($D(^DG(40.8,1)):1,1:0) Q
"RTN","DGPREP0",61,0)
 .. S DGPDIV=-1
"RTN","DGPREP0",62,0)
 . K DGQ
"RTN","DGPREP0",63,0)
 . I '$G(DGSNGLDV) D  Q:$G(DGQ)
"RTN","DGPREP0",64,0)
 .. I '$G(VAUTD),'$D(VAUTD(DGPDIV)) S DGQ=1
"RTN","DGPREP0",65,0)
 . ;
"RTN","DGPREP0",66,0)
 . S DGPSV=$P(DGPDATA1,U)
"RTN","DGPREP0",67,0)
 . S DGPAT=$P(DGPDATA,U,8)
"RTN","DGPREP0",68,0)
 . ;
"RTN","DGPREP0",69,0)
 . ; Check Appointment for Cancellation and not show on Report
"RTN","DGPREP0",70,0)
 . S DGDFN=$P(DGPDATA,U)
"RTN","DGPREP0",71,0)
 . S DGKFLAG=1,DGHLOC=$P(DGPDATA,"^",7)
"RTN","DGPREP0",72,0)
 . S DGAPDT=%-1
"RTN","DGPREP0",73,0)
 . I $G(DGHLOC)'="" F  S DGAPDT=$O(^SC(DGHLOC,"S",DGAPDT)) Q:DGAPDT=""   D
"RTN","DGPREP0",74,0)
 .. S DGOB=0
"RTN","DGPREP0",75,0)
 .. F  S DGOB=$O(^SC(DGHLOC,"S",DGAPDT,DGOB)) Q:DGOB=""!(DGAPDT<DGTDAY)  D
"RTN","DGPREP0",76,0)
 ... I $P($G(^SC(DGHLOC,"S",DGAPDT,DGOB,1,0)),"^")=DGDFN S DGKFLAG=0 Q
"RTN","DGPREP0",77,0)
 . I DGKFLAG S DIK="^DGS(41.42,",DA=DGPN1 D ^DIK K DIK Q
"RTN","DGPREP0",78,0)
 . ;
"RTN","DGPREP0",79,0)
 . S DGPPN=$P(^DPT($P(^DGS(41.42,DGPN1,0),U),0),U)
"RTN","DGPREP0",80,0)
 . ;
"RTN","DGPREP0",81,0)
 . I DGPSRT="S" D
"RTN","DGPREP0",82,0)
 .. I DGPSV']"" W !,"NO SERVICE ENTRY FOR RECORD# ",DGPN1 Q
"RTN","DGPREP0",83,0)
 .. S ^TMP($J,DGPDIV,DGPSV,DGPN1)=$P(^DGS(41.42,DGPN1,0),U)
"RTN","DGPREP0",84,0)
 . ;
"RTN","DGPREP0",85,0)
 . I DGPSRT="P" D
"RTN","DGPREP0",86,0)
 .. I DGPPN']"" W !,"NO PATIENT ENTRY FOR RECORD# ",DGPN1 Q
"RTN","DGPREP0",87,0)
 .. S ^TMP($J,DGPDIV,DGPPN,DGPN1)=$P($G(^DGS(41.42,DGPN1,0)),U)
"RTN","DGPREP0",88,0)
 . ;
"RTN","DGPREP0",89,0)
 . I DGPSRT']"" D
"RTN","DGPREP0",90,0)
 .. I DGPPN']"" W !,"NO PATIENT ENTRY FOR RECORD# ",DGPN1 Q
"RTN","DGPREP0",91,0)
 .. S ^TMP($J,DGPDIV,DGPPN,DGPN1)=$P(^DGS(41.42,DGPN1,0),U)
"RTN","DGPREP0",92,0)
 . W "."
"RTN","DGPREP0",93,0)
 ;
"RTN","DGPREP0",94,0)
 I $D(^TMP($J)) W !!,"Loading Sorted Entries into List..."
"RTN","DGPREP0",95,0)
 E  D
"RTN","DGPREP0",96,0)
 . W *7,!!,"No appointments were found for the selected divisions"
"RTN","DGPREP0",97,0)
 . K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","DGPREP0",98,0)
 ;
"RTN","DGPREP0",99,0)
 ; Retreive sorted call list form ^TMP and build LM arrays
"RTN","DGPREP0",100,0)
 ;
"RTN","DGPREP0",101,0)
 S DGPNR=1
"RTN","DGPREP0",102,0)
 S DGPN0="" F  S DGPN0=$O(^TMP($J,DGPN0)) Q:DGPN0=""  D
"RTN","DGPREP0",103,0)
 . S DGPN1="" F  S DGPN1=$O(^TMP($J,DGPN0,DGPN1)) Q:DGPN1=""  D
"RTN","DGPREP0",104,0)
 .. S DGPNX="" F  S DGPNX=$O(^TMP($J,DGPN0,DGPN1,DGPNX)) Q:DGPNX=""  D
"RTN","DGPREP0",105,0)
 ... S DGPDATA=$G(^DGS(41.42,DGPNX,0))
"RTN","DGPREP0",106,0)
 ... S DGPDATA1=$G(^DGS(41.42,DGPNX,1))
"RTN","DGPREP0",107,0)
 ... S DGPSV=$P(DGPDATA1,U)
"RTN","DGPREP0",108,0)
 ... S X=$$SETFLD^VALM1(DGPNR,"","INDEX")
"RTN","DGPREP0",109,0)
 ... S X=$$SETFLD^VALM1($E($P(^DPT($P(DGPDATA,U),0),U),1,30),X,"PATIENT")
"RTN","DGPREP0",110,0)
 ... S DGPDFN=$P(DGPDATA,U)
"RTN","DGPREP0",111,0)
 ... D BLDHIST
"RTN","DGPREP0",112,0)
 ... S X=$$SETFLD^VALM1($P(DGPDATA1,U,2),X,"SSN")
"RTN","DGPREP0",113,0)
 ... S X=$$SETFLD^VALM1(DGPSV,X,"SVC")
"RTN","DGPREP0",114,0)
 ... S X=$$SETFLD^VALM1($E($P(DGPDATA1,U,3),1,18),X,"PHONE")
"RTN","DGPREP0",115,0)
 ... S X=$$SETFLD^VALM1($$FMTE^XLFDT($P(DGPDATA,U,5),"2D"),X,"LAST")
"RTN","DGPREP0",116,0)
 ... I $P(DGPDATA,U,6)="Y" D
"RTN","DGPREP0",117,0)
 .... ;S X=$$SETFLD^VALM1("*",X,"CALL")
"RTN","DGPREP0",118,0)
 ... S DGPDVN=$S(+$G(DGPN0)>0:$P(^DG(40.8,DGPN0,0),U),DGPN0<0:"",1:DGPN0)
"RTN","DGPREP0",119,0)
 ... S X=$$SETFLD^VALM1($E(DGPDVN,1,20),X,"DIVISION")
"RTN","DGPREP0",120,0)
 ... S ^TMP("DGPRERG",$J,DGPNR,0)=X
"RTN","DGPREP0",121,0)
 ... S ^TMP("DGPRERG",$J,"DA",DGPNR,DGPN1)=""
"RTN","DGPREP0",122,0)
 ... S ^TMP("DGPRERG",$J,"DFN",DGPNR,DGPDFN)=""
"RTN","DGPREP0",123,0)
 ... S ^TMP("DGPRERG",$J,"SSN",DGPNR,$P(DGPDATA1,U,2))=""
"RTN","DGPREP0",124,0)
 ... S ^TMP("DGPRERG",$J,"IDX",DGPNR,DGPNR)=""
"RTN","DGPREP0",125,0)
 ... S ^TMP("DGPRERG",$J,"DIV",DGPNR,DGPN0)=""
"RTN","DGPREP0",126,0)
 ... S DGPNR=DGPNR+1
"RTN","DGPREP0",127,0)
 ... W "."
"RTN","DGPREP0",128,0)
 S VALMCNT=DGPNR-1
"RTN","DGPREP0",129,0)
 I VALMCNT'>0 S VALMQUIT=1
"RTN","DGPREP0",130,0)
 Q
"RTN","DGPREP0",131,0)
 ;
"RTN","DGPREP0",132,0)
HELP ; -- help code
"RTN","DGPREP0",133,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","DGPREP0",134,0)
 Q
"RTN","DGPREP0",135,0)
 ;
"RTN","DGPREP0",136,0)
EXIT ; -- Exit code
"RTN","DGPREP0",137,0)
 K ^TMP("DGPRERG",$J)
"RTN","DGPREP0",138,0)
 K DGPAT,DGPCH,DGPCL,DGPDA,DGPDATA,DGPDATA1,DGPDFN,DGPEDIT,DGPENT,DGPFLG,DGPIFN
"RTN","DGPREP0",139,0)
 K DGPLOC,DGPN0,DGPN1,DGPN2,DGPN3,DGPNR,DGPP1,DGPP2,DGPP3,DGPPN
"RTN","DGPREP0",140,0)
 K DGPPSRT,DGPST,DGPSV,DGPTAT,DA,X,Y,DIR,DIC,DIE,%
"RTN","DGPREP0",141,0)
 D FULL^VALM1
"RTN","DGPREP0",142,0)
 D CLEAN^VALM10
"RTN","DGPREP0",143,0)
 Q
"RTN","DGPREP0",144,0)
 ;
"RTN","DGPREP0",145,0)
BLDHIST ;  Build history of call attempts from ^DGS(41.43, Call log
"RTN","DGPREP0",146,0)
 N DGPN2,DGPN3
"RTN","DGPREP0",147,0)
 ;
"RTN","DGPREP0",148,0)
 S DGPN2=0 F  S DGPN2=$O(^DGS(41.43,"C",DGPDFN,DGPN2)) Q:'DGPN2  D
"RTN","DGPREP0",149,0)
 . S:$P(^DGS(41.43,DGPN2,0),U,4)]"" ^TMP("STAT",$J,$P(^DGS(41.43,DGPN2,0),U,1))=$P(^DGS(41.43,DGPN2,0),U,4)
"RTN","DGPREP0",150,0)
 I $D(^TMP("STAT",$J)) D
"RTN","DGPREP0",151,0)
 . S DGPTAT=""
"RTN","DGPREP0",152,0)
 . S DGPN3=9999999.999999 F  S DGPN3=$O(^TMP("STAT",$J,DGPN3),-1) Q:'DGPN3  D
"RTN","DGPREP0",153,0)
 .. S DGPTAT=DGPTAT_^TMP("STAT",$J,DGPN3)
"RTN","DGPREP0",154,0)
 . S X=$$SETFLD^VALM1(DGPTAT,X,"HIST")
"RTN","DGPREP0",155,0)
 . K ^TMP("STAT",$J)
"RTN","DGPREP0",156,0)
 Q
"RTN","DGRP1")
0^1^B21511165
"RTN","DGRP1",1,0)
DGRP1 ;ALB/MRL - DEMOGRAPHIC DATA ; 7/24/03 11:46am
"RTN","DGRP1",2,0)
 ;;5.3;Registration;**109,161,506,244,546**;Aug 13, 1993
"RTN","DGRP1",3,0)
 ;
"RTN","DGRP1",4,0)
EN S (DGRPS,DGRPW)=1 D H^DGRPU F I=0,.11,.121,.13,.15,.24,57 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRP1",5,0)
 I $P(DGRP(.15),"^",2)]"" S Z="APPLICANT IS LISTED AS 'INELIGIBLE' FOR TREATMENT!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",6,0)
 I $P(DGRP(.15),"^",3)]"" S Z="APPLICANT IS LISTED AS 'MISSING'.  NOTIFY APPROPRIATE PERSONNEL!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",7,0)
 W ! S Z=1 D WW^DGRPV W "    Name: " S Z=$P(DGRP(0),"^",1),Z1=31 D WW1^DGRPV W "SS: " S X=$P(DGRP(0),"^",9),Z=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),Z1=13 D WW1^DGRPV S Y=$P(DGRP(0),"^",3) X ^DD("DD") W "DOB: ",Y
"RTN","DGRP1",8,0)
 D GETNCAL  ;Display name component and alias information
"RTN","DGRP1",9,0)
 S Z=3,DGRPX=DGRP(0) D WW^DGRPV W " Remarks: ",$S($P(DGRPX,"^",10)]"":$E($P(DGRPX,"^",10),1,65),1:"NO REMARKS ENTERED FOR THIS PATIENT") S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU I $P(DGRP(.121),"^",9)="Y" S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU
"RTN","DGRP1",10,0)
 S Z=4 D WW^DGRPV W " Permanent Address: " S Z=" ",Z1=17
"RTN","DGRP1",11,0)
 D WW1^DGRPV S Z=5,DGRPW=0 D WW^DGRPV W " Temporary Address: "
"RTN","DGRP1",12,0)
 W !?11
"RTN","DGRP1",13,0)
 S Z1=40,Z=$S($D(DGA(1)):DGA(1),1:"NONE ON FILE") D WW1^DGRPV W $S($D(DGA(2)):DGA(2),1:"NO TEMPORARY ADDRESS")
"RTN","DGRP1",14,0)
 S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>50) !?11 W:'(I#2) ?51 W DGA(I)
"RTN","DGRP1",15,0)
 S DGCC=$S($D(^DIC(5,+$P(DGRP(.11),U,5),1,+$P(DGRP(.11),U,7),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU) W !?3,"County: ",DGCC K DGCC
"RTN","DGRP1",16,0)
 S DGCC=$S($P(DGRP(.121),U,9)'="Y":"NOT APPLICABLE",$D(^DIC(5,+$P(DGRP(.121),U,5),1,+$P(DGRP(.121),U,11),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU) W ?43,"County: ",DGCC K DGCC
"RTN","DGRP1",17,0)
 W !?4,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGRPU),?44,"Phone: ",$S($P(DGRP(.121),U,9)'="Y":"NOT APPLICABLE",$P(DGRP(.121),U,10)]"":$P(DGRP(.121),U,10),1:DGRPU)
"RTN","DGRP1",18,0)
 S X="NOT APPLICABLE" I $P(DGRP(.121),U,9)="Y" S Y=$P(DGRP(.121),U,7) X:Y]"" ^DD("DD") S X=$S(Y]"":Y,1:DGRPU)_"-",Y=$P(DGRP(.121),U,8) X:Y]"" ^DD("DD") S X=X_$S(Y]"":Y,1:DGRPU)
"RTN","DGRP1",19,0)
 W !?3,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGRPU),?42,"From/To: ",X
"RTN","DGRP1",20,0)
 W !?1,"Bad Addr: ",$$EXTERNAL^DILFD(2,.121,"",$P(DGRP(.11),U,16))
"RTN","DGRP1",21,0)
 ;
"RTN","DGRP1",22,0)
 ; ***  Additional displays added for Pre-Registration
"RTN","DGRP1",23,0)
 I $G(DGPRFLG)=1 D
"RTN","DGRP1",24,0)
 . W !
"RTN","DGRP1",25,0)
 . N I,MIS1,X,X1,SA1,TP1,X2,X3,ES1
"RTN","DGRP1",26,0)
 . I $D(^DIA(2,"B",DFN)) S X="" F I=1:1 S X=$O(^DIA(2,"B",DFN,X)) Q:X<1  I $P(^DIA(2,X,0),U,3)=.05 S MIS1=$P(^DIA(2,X,0),U,2)
"RTN","DGRP1",27,0)
 . W:$D(MIS1)>0 !," [MARITAL STATUS CHANGED:] "_$$FMTE^XLFDT(MIS1,"5D")
"RTN","DGRP1",28,0)
 . I $D(^DIA(2,"B",DFN)) S X1="" F I=1:1 S X1=$O(^DIA(2,"B",DFN,X1)) Q:X1<1  S:$P(^DIA(2,X1,0),U,3)=.111 SA1=$P(^DIA(2,X1,0),U,2)
"RTN","DGRP1",29,0)
 . W:$D(SA1)>0 !," [STREET ADDRESS LAST CHANGED:] "_$$FMTE^XLFDT(SA1,"5D")
"RTN","DGRP1",30,0)
 . I $D(^DIA(2,"B",DFN)) S X2="" F I=1:1 S X2=$O(^DIA(2,"B",DFN,X2)) Q:X2<1  S:$P(^DIA(2,X2,0),U,3)=.131 TP1=$P(^DIA(2,X2,0),U,2)
"RTN","DGRP1",31,0)
 . W:$D(TP1)>0 !," [HOME PHONE NUMBER CHANGED:] "_$$FMTE^XLFDT(TP1,"5D")
"RTN","DGRP1",32,0)
 . I $D(^DIA(2,"B",DFN)) S X3="" F I=1:1 S X3=$O(^DIA(2,"B",DFN,X3)) Q:X3<1  S:$P(^DIA(2,X3,0),U,3)=.31115 ES1=$P(^DIA(2,X3,0),U,2)
"RTN","DGRP1",33,0)
 . W:$D(ES1)>0 !," [EMPLOYMENT STATUS CHANGED:] "_$$FMTE^XLFDT(ES1,"5D")
"RTN","DGRP1",34,0)
 . I $D(^DPT(DFN,.312,0)) S IN1=0 F  S IN1=$O(^DPT(DFN,.312,IN1)) Q:'IN1  S IN2=$P($G(^DPT(DFN,.312,IN1,0)),U) S INN=$S($D(^DIC(36,IN2,0)):$P(^DIC(36,IN2,0),U),1:"UNKNOWN") D
"RTN","DGRP1",35,0)
 .. S IND=$P($G(^DPT(DFN,.312,IN1,1)),U) W !," [INSURANCE:] "_INN_"  DATE ENTERED: "_$S(IND]"":$$FMTE^XLFDT(IND,"5D"),1:"")
"RTN","DGRP1",36,0)
 .. I $P($G(^DPT(DFN,.312,IN1,1)),U,5) S INE=$P($G(^DPT(DFN,.312,IN1,1)),U,5) W " DATE EDITED: "_$S(INE]"":$$FMTE^XLFDT(INE,"5D"),1:"")
"RTN","DGRP1",37,0)
 ;
"RTN","DGRP1",38,0)
 G ^DGRPP
"RTN","DGRP1",39,0)
 ;
"RTN","DGRP1",40,0)
GETNCAL ;Get name component values
"RTN","DGRP1",41,0)
 N DGCOMP,DGNC,DGI,DGA,DGALIAS,DGX,DGRPW
"RTN","DGRP1",42,0)
 S DGNC="Family^Given^Middle^Prefix^Suffix^Degree"
"RTN","DGRP1",43,0)
 S DGCOMP=+$G(^DPT(DFN,"NAME"))_","
"RTN","DGRP1",44,0)
 I DGCOMP D GETS^DIQ(20,DGCOMP,"1:6",,"DGCOMP")
"RTN","DGRP1",45,0)
 ;Get alias values
"RTN","DGRP1",46,0)
 S DGA=0 F DGI=1:1:6 D  Q:'$D(DGALIAS(DGI))
"RTN","DGRP1",47,0)
A2 .S DGA=$O(^DPT(DFN,.01,DGA))
"RTN","DGRP1",48,0)
 .I 'DGA D:DGI=1  Q
"RTN","DGRP1",49,0)
 ..S DGALIAS(DGI)="< No alias entries on file >" Q
"RTN","DGRP1",50,0)
 .I DGI=6 S DGALIAS(DGI)="< More alias entries on file >" Q
"RTN","DGRP1",51,0)
 .S DGX=$G(^DPT(DFN,.01,DGA,0)) G:'$L(DGX) A2
"RTN","DGRP1",52,0)
 .S DGALIAS(DGI)=$P(DGX,U),DGX=$P(DGX,U,2)
"RTN","DGRP1",53,0)
 .I $L(DGX) D
"RTN","DGRP1",54,0)
 ..S DGX=" "_$E(DGX,1,3)_"-"_$E(DGX,4,5)_"-"_$E(DGX,6,9)
"RTN","DGRP1",55,0)
 ..S $E(DGALIAS(DGI),20)=DGX Q
"RTN","DGRP1",56,0)
 .S DGALIAS(DGI)=$E(DGALIAS(DGI),1,31)
"RTN","DGRP1",57,0)
 .Q
"RTN","DGRP1",58,0)
 ;Display name component and alias data
"RTN","DGRP1",59,0)
 F DGI=1:1:6 D
"RTN","DGRP1",60,0)
 .W !?5,$J($P(DGNC,U,DGI),6),": ",$E($G(DGCOMP(20,DGCOMP,DGI)),1,$S(DGI=1:23,1:27))
"RTN","DGRP1",61,0)
 .I DGI=1 S DGRPW=0,Z=2 W ?37 D WW^DGRPV W " Alias: "
"RTN","DGRP1",62,0)
 .W ?48,$G(DGALIAS(DGI))
"RTN","DGRP1",63,0)
 .Q
"RTN","DGRP1",64,0)
 Q
"RTN","DGRPV")
0^2^B16031996
"RTN","DGRPV",1,0)
DGRPV ;ALB/MRL,RTK - REGISTRATION DEFINE VARIABLES ON ENTRY ; 12/2/03 3:19pm
"RTN","DGRPV",2,0)
 ;;5.3;Registration;**109,114,247,190,327,365,343,397,415,489,546**;Aug 13, 1993
"RTN","DGRPV",3,0)
 ;
"RTN","DGRPV",4,0)
 ;
"RTN","DGRPV",5,0)
 ;set up variables for registration screen processing
"RTN","DGRPV",6,0)
 ;
"RTN","DGRPV",7,0)
 ;DGRPVV   :string of 15 ones and zeros each character corresponding to
"RTN","DGRPV",8,0)
 ;          a particular screen (0 means allow edit, 1 means don't)
"RTN","DGRPV",9,0)
 ;
"RTN","DGRPV",10,0)
 ;DGRPVV(n):where n=screen number.  String of x ones and zeros where
"RTN","DGRPV",11,0)
 ;          x is the number of elements on screen n (0=edit, 1=don't)
"RTN","DGRPV",12,0)
 ;
"RTN","DGRPV",13,0)
 ;DGVI     :Turn on high intensity
"RTN","DGRPV",14,0)
 ;DGVO     :Turn off high intensity
"RTN","DGRPV",15,0)
 ;
"RTN","DGRPV",16,0)
EN D DT^DICRW I '$D(DVBGUI) D HOME^%ZIS
"RTN","DGRPV",17,0)
 S (DGVI,DGVO)="""""" I $S('$D(IOST(0)):1,'$D(^DG(43,1,0)):1,'$P(^DG(43,1,0),"^",36):1,$D(^DG(43,1,"TERM",IOST(0))):1,1:0) G M ;goto M if not high intensity
"RTN","DGRPV",18,0)
 I $D(^%ZIS(2,IOST(0),7)) S I=^(7),X=$S($P(I,"^",3)]"":3,1:2) I $L($P(I,"^",1)),$L($P(I,"^",X)) S DGVI=$P(I,"^",1),DGVO=$P(I,"^",X)
"RTN","DGRPV",19,0)
M I $L(DGVI_DGVO)>4 S X=132 X ^%ZOSF("RM")
"RTN","DGRPV",20,0)
 S DGRPW=1,DGRPCM=0,DGRPU="UNANSWERED",DGRPNA="NOT APPLICABLE",DGRPV=$S($D(DGRPV):DGRPV,1:1)
"RTN","DGRPV",21,0)
SC7 S X=$S('$D(^DPT(DFN,"TYPE")):0,1:+^("TYPE")) S:'$D(DGELVER) DGELVER=0
"RTN","DGRPV",22,0)
 S DGRPTYPE=$S($D(^DG(391,+X,0)):^(0),1:""),(DGRPSC,DGRPSCE,DGRPSCE1)="" S:'$D(DGELVER) DGELVER=0
"RTN","DGRPV",23,0)
 I DGRPTYPE'="" S DGRPSC=$G(^DG(391,+X,"S")),DGRPSCE=$G(^("E")),DGRPSCE1=$G(^("E10"))
"RTN","DGRPV",24,0)
 ;
"RTN","DGRPV",25,0)
 S DGPH=$P($G(^DPT(DFN,.53)),U)  ;Purple Heart Indicator
"RTN","DGRPV",26,0)
 I $G(DGPRFLG)=1 D
"RTN","DGRPV",27,0)
 . S DGRPVV="000001111111111"
"RTN","DGRPV",28,0)
 E  D
"RTN","DGRPV",29,0)
 . S DGRPVV="000000000000000"
"RTN","DGRPV",30,0)
 S X="5^3^5^2^3^17^4^2^10^2^4^5^5^2^1"
"RTN","DGRPV",31,0)
 F I=1:1:15 S J=+$P(X,"^",I),DGRPVV(I)=$S((I<12)!(I=15):$E("00000000000000000",1,J),1:$E("11111111111111111",1,J))
"RTN","DGRPV",32,0)
 S DGRPVV(1.1)=0
"RTN","DGRPV",33,0)
 I $G(DGPH)]"" S $E(DGRPVV(6),16)=1
"RTN","DGRPV",34,0)
 I $$GETSTAT^DGNTAPI1(DFN)>2,'$D(^XUSEC("DGNT VERIFY",DUZ)) D
"RTN","DGRPV",35,0)
 . S $E(DGRPVV(6),17)=1
"RTN","DGRPV",36,0)
 ;
"RTN","DGRPV",37,0)
 F I=3,6,8,9,10,11 S J=+$P(DGRPSC,"^",I) I 'J S DGRPVV=$E(DGRPVV,0,I-1)_1_$E(DGRPVV,I+1,99)
"RTN","DGRPV",38,0)
 ;
"RTN","DGRPV",39,0)
 ;-- if patient type is TRICARE then turn off screens 2,4
"RTN","DGRPV",40,0)
 ;
"RTN","DGRPV",41,0)
 ;-- modified 08/20/2003 for NOIS Calls MAC-0400-61574 & AMA-0700-71769 
"RTN","DGRPV",42,0)
 ;-- commented the line to allow screens 2 & 4 to display for Tricare
"RTN","DGRPV",43,0)
 ;I DGRPTYPE["TRICARE" F I=2,4 S J=+$P(DGRPSC,"^",I) I 'J S DGRPVV=$E(DGRPVV,0,I-1)_1_$E(DGRPVV,I+1,99)
"RTN","DGRPV",44,0)
 ;
"RTN","DGRPV",45,0)
 F I=31:0 S I=$O(^DD(391,I)) Q:I=""!(I>99)  I $D(^(I,0)),($E(^(0),1)'="*"),'+$P(DGRPSCE,"^",I) S X1=$E(I),X2=$E(I,2) I +X1 S DGRPVV(X1)=$E(DGRPVV(X1),0,X2-1)_1_$E(DGRPVV(X1),X2+1,99)
"RTN","DGRPV",46,0)
 I $G(^DPT(DFN,.35)),(^(.35)<+($E(DT,1,3)_"0000")) S DGRPVV=$E(DGRPVV,0,7)_11_$E(DGRPVV,10,99)
"RTN","DGRPV",47,0)
 K DIRUT,DUOUT,DTOUT
"RTN","DGRPV",48,0)
 ;
"RTN","DGRPV",49,0)
 ;Fields are numbered screen_item and put in that piece position.
"RTN","DGRPV",50,0)
 ;Because FM does not allow more than 100 pieces on a node, it was
"RTN","DGRPV",51,0)
 ;necessary to start a new node E10 for fields on screens 10 or higher.
"RTN","DGRPV",52,0)
 ;In these instances, the piece position will be screen_item-100 so,
"RTN","DGRPV",53,0)
 ;for example, screen 11, item 2 would be field 112, but piece 12.
"RTN","DGRPV",54,0)
 ;Items on screens <10 will be found on node E.
"RTN","DGRPV",55,0)
 ;
"RTN","DGRPV",56,0)
 F I=100:0 S I=$O(^DD(391,I)) Q:I=""!(I>150)  I $D(^(I,0)),($E(^(0),1)'="*"),'+$P(DGRPSCE1,"^",I-100) S X1=$E(I,1,2),X2=$E(I,3) I +X1 S DGRPVV(X1)=$E(DGRPVV(X1),0,X2-1)_1_$E(DGRPVV(X1),X2+1,99)
"RTN","DGRPV",57,0)
 ;
"RTN","DGRPV",58,0)
 I $S('($D(DUZ)#2):0,'$D(^XUSEC("DG ELIGIBILITY",DUZ)):0,1:1) G ELVER ;if user holds eligibility key, skip
"RTN","DGRPV",59,0)
 F I=.3,.32,.361 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRPV",60,0)
 S DGRPVV(10)=11 I $P(DGRP(.361),"^",1)="V" S DGRPVV(7)=111,DGRPVV(1)=1_$E(DGRPVV(1),2,99) ;if elig verified, can't edit elig data, name, ssn, or dob
"RTN","DGRPV",61,0)
 I $P(DGRP(.3),"^",6)]"" S DGRPVV(8)=11 ;if monetary ben. verified, can't edit income screening data
"RTN","DGRPV",62,0)
 I $P(DGRP(.32),"^",2)]"" S DGRPVV(6)=11111111111111111 ;if service data verified, can't edit service screen
"RTN","DGRPV",63,0)
 ;
"RTN","DGRPV",64,0)
ELVER ;set up variables for eligibility verification
"RTN","DGRPV",65,0)
 ;if elig ver option, only edit screens 1, 2, and 7 (and 6, 8, 9, 10,
"RTN","DGRPV",66,0)
 ;   and 11 if they're turned on).
"RTN","DGRPV",67,0)
 ;
"RTN","DGRPV",68,0)
 I $P($G(^DPT(DFN,.361)),U,3)="H" S DGRPVV(10)=10,DGRPVV(11)=1001
"RTN","DGRPV",69,0)
 S:'DGELVER DGRPLAST=$S($G(DGPRFLG)=1:5,1:15)
"RTN","DGRPV",70,0)
 I DGELVER S DGRPVV="00111"_$E(DGRPVV,6,11)_"1111" F I=1:1:11 S J=$E(DGRPVV,I) I 'J S DGRPLAST=I
"RTN","DGRPV",71,0)
Q K DGRPSC,DGRPSCE
"RTN","DGRPV",72,0)
 Q
"RTN","DGRPV",73,0)
 ;
"RTN","DGRPV",74,0)
WW ;Write number on screens for display and/or edit (Z=number)
"RTN","DGRPV",75,0)
 W:DGRPW ! S Z=$S(DGRPCM:Z,DGRPV:"<"_Z_">",$E(DGRPVV(DGRPS),Z):"<"_Z_">",1:"["_Z_"]")
"RTN","DGRPV",76,0)
 I DGRPCM!($E(Z)="[") W @DGVI,Z,@DGVO
"RTN","DGRPV",77,0)
 I 'DGRPCM&($E(Z)'="[") W Z
"RTN","DGRPV",78,0)
 Q
"RTN","DGRPV",79,0)
 ;
"RTN","DGRPV",80,0)
WW1 ;spacing for screen display (Z=item to print)
"RTN","DGRPV",81,0)
 F Z2=1:1:(Z1-$L(Z)) S Z=Z_" "
"RTN","DGRPV",82,0)
 W Z K Z2
"RTN","DGRPV",83,0)
 Q
"VER")
8.0^22
**END**
**END**
