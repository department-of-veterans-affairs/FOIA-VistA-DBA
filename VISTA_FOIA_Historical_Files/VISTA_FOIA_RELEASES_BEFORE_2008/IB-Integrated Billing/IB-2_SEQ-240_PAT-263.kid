Released IB*2*263 SEQ #240
Extracted from mail message
**KIDS**:IB*2.0*263^

**INSTALL NAME**
IB*2.0*263
"BLD",5357,0)
IB*2.0*263^INTEGRATED BILLING^0^3040211^y
"BLD",5357,1,0)
^^8^8^3040209^^^
"BLD",5357,1,1,0)
This patch corrects a problem in the CLAIMS STATUS AWAITING RESOLUTION
"BLD",5357,1,2,0)
option where a <NULSUBSCR> error ocurred when trying to view an EOB
"BLD",5357,1,3,0)
and none existed.
"BLD",5357,1,4,0)
See NOIS SBY-0104-30665.
"BLD",5357,1,5,0)
This patch also corrects a second issue where active insurance
"BLD",5357,1,6,0)
company names were not listed when entering data into the
"BLD",5357,1,7,0)
insurance buffer.
"BLD",5357,1,8,0)
See NOIS MIN-0104-41017
"BLD",5357,4,0)
^9.64PA^^
"BLD",5357,"ABPKG")
n
"BLD",5357,"KRN",0)
^9.67PA^8989.52^19
"BLD",5357,"KRN",.4,0)
.4
"BLD",5357,"KRN",.401,0)
.401
"BLD",5357,"KRN",.402,0)
.402
"BLD",5357,"KRN",.403,0)
.403
"BLD",5357,"KRN",.5,0)
.5
"BLD",5357,"KRN",.84,0)
.84
"BLD",5357,"KRN",3.6,0)
3.6
"BLD",5357,"KRN",3.8,0)
3.8
"BLD",5357,"KRN",9.2,0)
9.2
"BLD",5357,"KRN",9.8,0)
9.8
"BLD",5357,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5357,"KRN",9.8,"NM",1,0)
IBCECSA5^^0^B45817940
"BLD",5357,"KRN",9.8,"NM",2,0)
IBCNBU1^^0^B27592089
"BLD",5357,"KRN",9.8,"NM","B","IBCECSA5",1)

"BLD",5357,"KRN",9.8,"NM","B","IBCNBU1",2)

"BLD",5357,"KRN",19,0)
19
"BLD",5357,"KRN",19.1,0)
19.1
"BLD",5357,"KRN",101,0)
101
"BLD",5357,"KRN",409.61,0)
409.61
"BLD",5357,"KRN",771,0)
771
"BLD",5357,"KRN",870,0)
870
"BLD",5357,"KRN",8989.51,0)
8989.51
"BLD",5357,"KRN",8989.52,0)
8989.52
"BLD",5357,"KRN",8994,0)
8994
"BLD",5357,"KRN","B",.4,.4)

"BLD",5357,"KRN","B",.401,.401)

"BLD",5357,"KRN","B",.402,.402)

"BLD",5357,"KRN","B",.403,.403)

"BLD",5357,"KRN","B",.5,.5)

"BLD",5357,"KRN","B",.84,.84)

"BLD",5357,"KRN","B",3.6,3.6)

"BLD",5357,"KRN","B",3.8,3.8)

"BLD",5357,"KRN","B",9.2,9.2)

"BLD",5357,"KRN","B",9.8,9.8)

"BLD",5357,"KRN","B",19,19)

"BLD",5357,"KRN","B",19.1,19.1)

"BLD",5357,"KRN","B",101,101)

"BLD",5357,"KRN","B",409.61,409.61)

"BLD",5357,"KRN","B",771,771)

"BLD",5357,"KRN","B",870,870)

"BLD",5357,"KRN","B",8989.51,8989.51)

"BLD",5357,"KRN","B",8989.52,8989.52)

"BLD",5357,"KRN","B",8994,8994)

"BLD",5357,"QUES",0)
^9.62^^
"BLD",5357,"REQB",0)
^9.611^2^2
"BLD",5357,"REQB",1,0)
IB*2.0*135^2
"BLD",5357,"REQB",2,0)
IB*2.0*184^2
"BLD",5357,"REQB","B","IB*2.0*135",1)

"BLD",5357,"REQB","B","IB*2.0*184",2)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
263^3040211
"PKG",200,22,1,"PAH",1,1,0)
^^8^8^3040211
"PKG",200,22,1,"PAH",1,1,1,0)
This patch corrects a problem in the CLAIMS STATUS AWAITING RESOLUTION
"PKG",200,22,1,"PAH",1,1,2,0)
option where a <NULSUBSCR> error ocurred when trying to view an EOB
"PKG",200,22,1,"PAH",1,1,3,0)
and none existed.
"PKG",200,22,1,"PAH",1,1,4,0)
See NOIS SBY-0104-30665.
"PKG",200,22,1,"PAH",1,1,5,0)
This patch also corrects a second issue where active insurance
"PKG",200,22,1,"PAH",1,1,6,0)
company names were not listed when entering data into the
"PKG",200,22,1,"PAH",1,1,7,0)
insurance buffer.
"PKG",200,22,1,"PAH",1,1,8,0)
See NOIS MIN-0104-41017
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IBCECSA5")
0^1^B45817940
"RTN","IBCECSA5",1,0)
IBCECSA5 ;ALB/CXW - VIEW EOB SCREEN ;01-OCT-1999
"RTN","IBCECSA5",2,0)
 ;;2.0;INTEGRATED BILLING;**137,135,263**;21-MAR-94
"RTN","IBCECSA5",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCECSA5",4,0)
 ;
"RTN","IBCECSA5",5,0)
EN ; -- main entry point for VIEW EOB
"RTN","IBCECSA5",6,0)
 N VALMCNT,VALMBG,VALMHDR
"RTN","IBCECSA5",7,0)
 S VALMCNT=0,VALMBG=1
"RTN","IBCECSA5",8,0)
 D EN^VALM("IBCEM VIEW EOB")
"RTN","IBCECSA5",9,0)
 Q
"RTN","IBCECSA5",10,0)
 ;
"RTN","IBCECSA5",11,0)
INIT ; -- init variables and list array
"RTN","IBCECSA5",12,0)
 I '$G(IBIFN) S VALMQUIT="" G INITQ
"RTN","IBCECSA5",13,0)
 D HDR^IBCEOB2,BLD^IBCEOB2
"RTN","IBCECSA5",14,0)
 K IBCNT,IBONE,^TMP("IBCECSD",$J)
"RTN","IBCECSA5",15,0)
 S IBONE=0
"RTN","IBCECSA5",16,0)
 M ^TMP("IBCECSD",$J)=^TMP("IBCEOB",$J)
"RTN","IBCECSA5",17,0)
 ;
"RTN","IBCECSA5",18,0)
 ; 4/7/03 - If only 1 EOB record found for this bill, then set the
"RTN","IBCECSA5",19,0)
 ;          IBCNT variable, the IBONE one-time flag, and build the
"RTN","IBCECSA5",20,0)
 ;          detail sections of this list.
"RTN","IBCECSA5",21,0)
 I $G(VALMCNT)=1 S IBCNT=$P($G(^TMP("IBCECSD",$J,1)),U,2),IBONE=1 I IBCNT D BLD^IBCECSA6
"RTN","IBCECSA5",22,0)
 ;
"RTN","IBCECSA5",23,0)
INITQ Q
"RTN","IBCECSA5",24,0)
 ;
"RTN","IBCECSA5",25,0)
HELP ; -- help code
"RTN","IBCECSA5",26,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBCECSA5",27,0)
 Q
"RTN","IBCECSA5",28,0)
 ;
"RTN","IBCECSA5",29,0)
EXIT ; -- exit code
"RTN","IBCECSA5",30,0)
 K ^TMP("IBCECSD",$J)
"RTN","IBCECSA5",31,0)
 D CLEAR^VALM1,CLEAN^VALM10
"RTN","IBCECSA5",32,0)
 Q
"RTN","IBCECSA5",33,0)
MIN ;
"RTN","IBCECSA5",34,0)
 N IBREC1,IBRM1,IBRM2,IBRM3,IBRM4,IBRM5,IBRL,IBTYPE,IBT,IBTX,IBD
"RTN","IBCECSA5",35,0)
 S IBTYPE=$$INPAT^IBCEF(+IBREC)
"RTN","IBCECSA5",36,0)
 I $G(IBSRC) Q:'$D(^IBM(361.1,IBCNT,4))
"RTN","IBCECSA5",37,0)
 S IB=$$SETSTR^VALM1("MEDICARE INFORMATION:","",1,50)
"RTN","IBCECSA5",38,0)
 D SET(IB)
"RTN","IBCECSA5",39,0)
 I '$G(IBSRC) D
"RTN","IBCECSA5",40,0)
 . D CNTRL^VALM10(VALMCNT,1,21,IORVON,IORVOFF)
"RTN","IBCECSA5",41,0)
 . S ^TMP("IBCECSD",$J,"X",5)=VALMCNT
"RTN","IBCECSA5",42,0)
 I '$D(^IBM(361.1,IBCNT,4)) Q
"RTN","IBCECSA5",43,0)
 I 'IBTYPE Q
"RTN","IBCECSA5",44,0)
 D SET(" INPATIENT:")
"RTN","IBCECSA5",45,0)
 S IBREC1=$G(^IBM(361.1,IBCNT,4)),(IB,IBRL)=""
"RTN","IBCECSA5",46,0)
 ;
"RTN","IBCECSA5",47,0)
 F IBT=2:1 S IBTX=$P($T(MINDAT+IBT),";",3) Q:IBTX=""  D
"RTN","IBCECSA5",48,0)
 . S IBD=$P(IBREC1,"^",+IBTX)
"RTN","IBCECSA5",49,0)
 . I $L($P(IBTX,"^",4)) X $P(IBTX,"^",4) E  N IBFULL S IBFULL=1
"RTN","IBCECSA5",50,0)
 . I $S(IBFULL:1,1:IBD) D
"RTN","IBCECSA5",51,0)
 .. I $L($P(IBTX,"^",4)) X $P(IBTX,"^",4) I  Q
"RTN","IBCECSA5",52,0)
 .. X "S IBD="_$S($L($P(IBTX,"^",3)):$P(IBTX,"^",3),1:"$$A10(IBD)")
"RTN","IBCECSA5",53,0)
 .. S IB=$$SETSTR^VALM1($P(IBTX,"^",2)_IBD,IB,$S('IBRL:4,1:37),$S('IBRL:41,1:38))
"RTN","IBCECSA5",54,0)
 .. S IBRL=$S(IBRL:0,1:1)
"RTN","IBCECSA5",55,0)
 .. I 'IBRL D SET(IB,IBRL) S IB=""
"RTN","IBCECSA5",56,0)
 ;
"RTN","IBCECSA5",57,0)
 D:IBRL'="" SET(IB)
"RTN","IBCECSA5",58,0)
 Q
"RTN","IBCECSA5",59,0)
 ;
"RTN","IBCECSA5",60,0)
MINDAT ; data for MIN tag
"RTN","IBCECSA5",61,0)
 ; format:  piece^lable^special format code^special decision for disp
"RTN","IBCECSA5",62,0)
 ;;1^Cov Days/Visit Ct  : ^$$RJ(+IBD)^I $G(IBSRC)
"RTN","IBCECSA5",63,0)
 ;;3^Claim DRG Amt      : 
"RTN","IBCECSA5",64,0)
 ;;2^Lifetm Psych Dy Ct : ^$$RJ(IBD)
"RTN","IBCECSA5",65,0)
 ;;5^Disprop Share Amt  : ^^I IBTYPE
"RTN","IBCECSA5",66,0)
 ;;4^Cap Exception Amt  : 
"RTN","IBCECSA5",67,0)
 ;;7^PPS Capital Amt    : 
"RTN","IBCECSA5",68,0)
 ;;6^MSP Pass Thru Amt  : 
"RTN","IBCECSA5",69,0)
 ;;9^PPS Cap HSP-DRG Amt: ^^I IBTYPE
"RTN","IBCECSA5",70,0)
 ;;8^PPS Cap FSP-DRG Amt: ^^I IBTYPE
"RTN","IBCECSA5",71,0)
 ;;11^Old Capital Amt    : ^^I IBTYPE
"RTN","IBCECSA5",72,0)
 ;;10^PPS Cap DSH-DRG Amt: ^^I IBTYPE
"RTN","IBCECSA5",73,0)
 ;;13^PPS Op Hos DRG Amt : 
"RTN","IBCECSA5",74,0)
 ;;12^PPS Capital IME Amt: ^^I IBTYPE
"RTN","IBCECSA5",75,0)
 ;;15^PPS Op Fed DRG Amt : ^^I IBTYPE
"RTN","IBCECSA5",76,0)
 ;;14^Cost Report Day Ct : ^$$RJ(IBD)
"RTN","IBCECSA5",77,0)
 ;;17^Indirect Teach Amt : 
"RTN","IBCECSA5",78,0)
 ;;16^PPS Cap Outlier Amt: 
"RTN","IBCECSA5",79,0)
 ;;18^Non-Pay Prof Comp  : ^$$RJ(IBD)
"RTN","IBCECSA5",80,0)
 ;;19^Non-Covered Days Ct: ^$$RJ(+IBD)^I $G(IBSRC)
"RTN","IBCECSA5",81,0)
 ;;
"RTN","IBCECSA5",82,0)
 ;
"RTN","IBCECSA5",83,0)
REMARK ; set up remarks and line level details
"RTN","IBCECSA5",84,0)
 N IBREC1,IBP,IBT,IBX
"RTN","IBCECSA5",85,0)
 S IBREC1=$S($$INPAT^IBCEF(+IBREC):$G(^IBM(361.1,IBCNT,5)),1:$P($G(^IBM(361.1,IBCNT,3)),"^",3,7))
"RTN","IBCECSA5",86,0)
 I $TR(IBREC1,U)'=""!'$G(IBSRC) D
"RTN","IBCECSA5",87,0)
 . D SET("  REMARK:")
"RTN","IBCECSA5",88,0)
 . D SET("   CODE    SHORT DESCRIPTION")
"RTN","IBCECSA5",89,0)
 . F IBP=1:1:5 I $L($P(IBREC1,"^",IBP))!($L($G(^IBM(361.1,IBCNT,"RM"_IBP)))) S IBT(IBP)=$S($L($P(IBREC1,"^",IBP)):$P(IBREC1,"^",IBP),1:"    ")_"   "_$G(^("RM"_IBP)) D TXT1(.IBT,4,79) S IBX=0 F  S IBX=$O(IBT(IBX)) Q:IBX<1  D SET(IBT(IBX))
"RTN","IBCECSA5",90,0)
 . D SET(" ")
"RTN","IBCECSA5",91,0)
MRALLA S IB=$$SETSTR^VALM1("LINE LEVEL ADJUSTMENTS:","",1,50)
"RTN","IBCECSA5",92,0)
 D SET(IB)
"RTN","IBCECSA5",93,0)
 I '$G(IBSRC) D
"RTN","IBCECSA5",94,0)
 . D CNTRL^VALM10(VALMCNT,1,23,IORVON,IORVOFF)
"RTN","IBCECSA5",95,0)
 . S ^TMP("IBCECSD",$J,"X",7)=VALMCNT
"RTN","IBCECSA5",96,0)
 I '$D(^IBM(361.1,IBCNT,15,0)) D SET("NONE") Q  ; only if there is info
"RTN","IBCECSA5",97,0)
 ;
"RTN","IBCECSA5",98,0)
 ; look up all billed data
"RTN","IBCECSA5",99,0)
 N IBZDATA,IBFORM,IBX2,IBX3,IBREC2,IBREC3,IBTX
"RTN","IBCECSA5",100,0)
 S IBFORM=0                             ; hcfa-1500
"RTN","IBCECSA5",101,0)
 I $$FT^IBCEF(+IBREC)=3 S IBFORM=1      ; ub92
"RTN","IBCECSA5",102,0)
 D F^IBCEF("N-"_$S(IBFORM:"UB92",1:"HCFA 1500")_" SERVICE LINE (EDI)","IBZDATA",,+IBREC)
"RTN","IBCECSA5",103,0)
 ;
"RTN","IBCECSA5",104,0)
 D SET("  #   SV DT   REVCD  PROC  MOD  UNITS  BILLED  DEDUCT  COINS    ALLOW     PYMT")
"RTN","IBCECSA5",105,0)
 S IBX=0 F  S IBX=$O(^IBM(361.1,IBCNT,15,IBX)) Q:IBX<1  S IBREC1=^IBM(361.1,IBCNT,15,IBX,0) D
"RTN","IBCECSA5",106,0)
 . NEW RVL
"RTN","IBCECSA5",107,0)
 . S RVL=+$P(IBREC1,U,12)       ; referenced Vista line#
"RTN","IBCECSA5",108,0)
 . I 'RVL S RVL=IBX             ; use the EOB line# if not there
"RTN","IBCECSA5",109,0)
 . S IBT=$$RJ($P(IBREC1,"^"),3) ;             line number
"RTN","IBCECSA5",110,0)
 . S IBT=IBT_" "_$$DAT1^IBOUTL($P($P(IBREC1,"^",16),".")) ; service date
"RTN","IBCECSA5",111,0)
 . S IBT=IBT_" "_$$RJ($$EXTERNAL^DILFD(361.115,.1,"",$P(IBREC1,"^",10)),6) ;                                                revcd
"RTN","IBCECSA5",112,0)
 . S IBT=IBT_" "_$$RJ($P(IBREC1,"^",4),5) ;   procedure
"RTN","IBCECSA5",113,0)
 . S IBT=IBT_" "_$$RJ($P($G(^IBM(361.1,IBCNT,15,IBX,2,1,0)),"^"),3)_$S($D(^IBM(361.1,IBCNT,15,IBX,2,2,0)):"+",1:" ") ;      modifiers
"RTN","IBCECSA5",114,0)
 . S IBT=IBT_" "_$$RJ($FN($P(IBREC1,"^",11),"",0),5) ; units
"RTN","IBCECSA5",115,0)
 . S IBT=IBT_" "_$$RJ($FN($S(IBFORM:$P($G(IBZDATA(RVL)),"^",5),1:$P($G(IBZDATA(RVL)),"^",8)*$P($G(IBZDATA(RVL)),"^",9)),"",2),8) ;    billed
"RTN","IBCECSA5",116,0)
 . S IBT=IBT_" "_$$RJ($FN($P($G(^IBM(361.1,IBCNT,15,IBX,1,+$O(^IBM(361.1,IBCNT,15,IBX,1,"B","PR",0)),1,+$O(^IBM(361.1,IBCNT,15,IBX,1,+$O(^IBM(361.1,IBCNT,15,IBX,1,"B","PR",0)),1,"B",1,0)),0)),"^",2),"",2),7) ;  deduct
"RTN","IBCECSA5",117,0)
 . S IBT=IBT_" "_$$RJ($FN($P($G(^IBM(361.1,IBCNT,15,IBX,1,+$O(^IBM(361.1,IBCNT,15,IBX,1,"B","PR",0)),1,+$O(^IBM(361.1,IBCNT,15,IBX,1,+$O(^IBM(361.1,IBCNT,15,IBX,1,"B","PR",0)),1,"B",2,0)),0)),"^",2),"",2),6) ;   coins
"RTN","IBCECSA5",118,0)
 . S IBT=IBT_" "_$$RJ($FN($P(IBREC1,"^",13),"",2),8) ; allow
"RTN","IBCECSA5",119,0)
 . S IBT=IBT_" "_$$RJ($FN($P(IBREC1,"^",3),"",2),8) ;  payment
"RTN","IBCECSA5",120,0)
 . D SET(IBT)
"RTN","IBCECSA5",121,0)
 . S IBX2=0 F  S IBX2=$O(^IBM(361.1,IBCNT,15,IBX,1,IBX2)) Q:IBX2<1  D
"RTN","IBCECSA5",122,0)
 .. S IBREC2=^IBM(361.1,IBCNT,15,IBX,1,IBX2,0),IBX3=0
"RTN","IBCECSA5",123,0)
 .. F  S IBX3=$O(^IBM(361.1,IBCNT,15,IBX,1,IBX2,1,IBX3)) Q:IBX3<1  D
"RTN","IBCECSA5",124,0)
 ... S IBREC3=^IBM(361.1,IBCNT,15,IBX,1,IBX2,1,IBX3,0)
"RTN","IBCECSA5",125,0)
 ... S IBTX(1)="ADJ: "_$P(IBREC2,"^")_"  "_$P(IBREC3,"^")_"  "_$P(IBREC3,"^",4) D TXT1(.IBTX,0,79) S IBT=0 F  S IBT=$O(IBTX(IBT)) Q:IBT<1  D SET(IBTX(IBT))
"RTN","IBCECSA5",126,0)
 ... K IBTX
"RTN","IBCECSA5",127,0)
 ... D SET("ADJ AMT: "_$FN($P(IBREC3,"^",2),"",2))
"RTN","IBCECSA5",128,0)
 . S IBREC2=$G(^IBM(361.1,IBCNT,15,IBX,3))
"RTN","IBCECSA5",129,0)
 . I $L(IBREC2) S IBTX(1)="REMARK CODE: "_$P(IBREC2,"^")_"  "_$P(IBREC2,"^",2) D TXT1(.IBTX,0,79) S IBT=0 F  S IBT=$O(IBTX(IBT)) Q:IBT<1  D SET(IBTX(IBT))
"RTN","IBCECSA5",130,0)
 . D SET(" ")
"RTN","IBCECSA5",131,0)
 D SET(" ")
"RTN","IBCECSA5",132,0)
 Q
"RTN","IBCECSA5",133,0)
 ;
"RTN","IBCECSA5",134,0)
TXT(IBRM,IBLN,IBXY) ;display text over 79 chars
"RTN","IBCECSA5",135,0)
 ;IBRM - text, IBLN - length, IBXY - position
"RTN","IBCECSA5",136,0)
 S IBRM=$E(IBRM,IBLN+1,999)
"RTN","IBCECSA5",137,0)
REP I $E(IBRM,1,IBLN)'="" S IB=$$SETSTR^VALM1($E(IBRM,1,IBLN),"",IBXY,IBLN) D SET(IB) S IBRM=$E(IBRM,IBLN+1,999) G REP
"RTN","IBCECSA5",138,0)
 Q
"RTN","IBCECSA5",139,0)
 ;
"RTN","IBCECSA5",140,0)
SET(IB,IBSAV) ;
"RTN","IBCECSA5",141,0)
 I '$G(IBSAV) D SET^IBCECSA6($G(IBSRC),IB,CNT,IBCNT)
"RTN","IBCECSA5",142,0)
 Q
"RTN","IBCECSA5",143,0)
 ;
"RTN","IBCECSA5",144,0)
A10(X) ;
"RTN","IBCECSA5",145,0)
 Q $$A10^IBCECSA6(X)
"RTN","IBCECSA5",146,0)
 ;
"RTN","IBCECSA5",147,0)
A7(X) ; returns a dollar amount right justified to 7 characters
"RTN","IBCECSA5",148,0)
 Q $$RJ($FN(X,"",2),7)
"RTN","IBCECSA5",149,0)
 ;
"RTN","IBCECSA5",150,0)
TXT1(IBT,DIWL,DIWR) ; sets up text for over 79 chars
"RTN","IBCECSA5",151,0)
 ; IBT - pass by ref, array of text to be formatted back in array
"RTN","IBCECSA5",152,0)
 ; DIWL - left margin, DIWR = right margin
"RTN","IBCECSA5",153,0)
 N IBX,X,DIWF,IBS K ^UTILITY($J,"W")
"RTN","IBCECSA5",154,0)
 S DIWF="|I"_DIWL
"RTN","IBCECSA5",155,0)
 S IBX=0 F  S IBX=$O(IBT(IBX)) Q:IBX<1  S X=IBT(IBX) D ^DIWP
"RTN","IBCECSA5",156,0)
 K IBT F  S IBX=$O(^UTILITY($J,"W",DIWL,IBX)) Q:IBX<1  S IBT(IBX)=^UTILITY($J,"W",DIWL,IBX,0)
"RTN","IBCECSA5",157,0)
 K ^UTILITY($J,"W")
"RTN","IBCECSA5",158,0)
 Q
"RTN","IBCECSA5",159,0)
 ;
"RTN","IBCECSA5",160,0)
RJ(X,Y) ; right just, default is 10
"RTN","IBCECSA5",161,0)
 Q $$RJ^XLFSTR(X,$G(Y,10)," ")
"RTN","IBCECSA5",162,0)
 ;
"RTN","IBCNBU1")
0^2^B27592089
"RTN","IBCNBU1",1,0)
IBCNBU1 ;ALB/ARH-Ins Buffer: Utilities ;1 Jun 97
"RTN","IBCNBU1",2,0)
 ;;2.0;INTEGRATED BILLING;**82,184,263**;21-MAR-94
"RTN","IBCNBU1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNBU1",4,0)
 ;
"RTN","IBCNBU1",5,0)
BUFFER(DFN) ; returns IFN of first buffer entry found for the patient, 0 otherwise
"RTN","IBCNBU1",6,0)
 Q +$O(^IBA(355.33,"C",+$G(DFN),0))
"RTN","IBCNBU1",7,0)
 ;
"RTN","IBCNBU1",8,0)
SELINS() ; user select an insurance company
"RTN","IBCNBU1",9,0)
 N IBX,DIE,DTOUT,DUOUT,DIC,X,Y S IBX=0
"RTN","IBCNBU1",10,0)
 S DIC="^DIC(36,",DIC(0)="AEQ",DIC("A")="Select INSURANCE COMPANY: ",DIC("S")="I '$P(^(0),U,5)" D ^DIC
"RTN","IBCNBU1",11,0)
 I +Y>0 S IBX=Y
"RTN","IBCNBU1",12,0)
 Q IBX
"RTN","IBCNBU1",13,0)
 ;
"RTN","IBCNBU1",14,0)
SELGRP(IBINSDA) ; given a specific insurance company, allow user to choose a group/plan
"RTN","IBCNBU1",15,0)
 N IBX,DIE,DTOUT,DUOUT,DIC,X,Y,IBINSNM S IBX=0
"RTN","IBCNBU1",16,0)
 S IBINSNM=$P($G(^DIC(36,+IBINSDA,0)),U,1)
"RTN","IBCNBU1",17,0)
 W !,IBINSNM
"RTN","IBCNBU1",18,0)
 S X=IBINSNM,DIC="^IBA(355.3,",DIC(0)="EQ",DIC("S")="I +^(0)="_+IBINSDA_"&('$P(^(0),U,11))" D ^DIC
"RTN","IBCNBU1",19,0)
 I +Y>0 S IBX=Y
"RTN","IBCNBU1",20,0)
 Q IBX
"RTN","IBCNBU1",21,0)
 ;
"RTN","IBCNBU1",22,0)
SELEXT(DFN) ; user select existing ins co, group, and if the patient is a member of the group also return the policy
"RTN","IBCNBU1",23,0)
 N IBX,IBINSDA,IBGRPDA,IBPOLDA S (IBINSDA,IBGRPDA,IBPOLDA)=""
"RTN","IBCNBU1",24,0)
 S IBINSDA=$$SELINS() S IBX=+IBINSDA
"RTN","IBCNBU1",25,0)
 I +IBINSDA S IBGRPDA=$$SELGRP(+IBINSDA) I +IBGRPDA S IBX=IBX_U_+IBGRPDA
"RTN","IBCNBU1",26,0)
 I +IBGRPDA,+$G(DFN) S IBPOLDA=$$PTGRP(DFN,IBINSDA,IBGRPDA) I +IBPOLDA S IBX=IBX_U_+IBPOLDA
"RTN","IBCNBU1",27,0)
 Q IBX
"RTN","IBCNBU1",28,0)
 ;
"RTN","IBCNBU1",29,0)
PTGRP(DFN,IBINSDA,IBGRPDA) ; return policy ifn if patient is a member of this group plan
"RTN","IBCNBU1",30,0)
 N IBX,IBY S IBX=0,DFN=+$G(DFN),IBINSDA=+$G(IBINSDA),IBGRPDA=+$G(IBGRPDA)
"RTN","IBCNBU1",31,0)
 S IBY=0 F  S IBY=$O(^DPT(DFN,.312,"B",IBINSDA,IBY)) Q:'IBY  I +$P($G(^DPT(DFN,.312,IBY,0)),U,18)=IBGRPDA S IBX=IBY
"RTN","IBCNBU1",32,0)
 Q IBX
"RTN","IBCNBU1",33,0)
 ;
"RTN","IBCNBU1",34,0)
DISPBUF(IBBUFDA) ; display summary info on a buffer entry
"RTN","IBCNBU1",35,0)
 ;
"RTN","IBCNBU1",36,0)
 Q:'$G(IBBUFDA)
"RTN","IBCNBU1",37,0)
 N IB0,IB60 S IB0=$G(^IBA(355.33,IBBUFDA,0)) Q:IB0=""  S IB60=$G(^IBA(355.33,IBBUFDA,60))
"RTN","IBCNBU1",38,0)
 ;
"RTN","IBCNBU1",39,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCNBU1",40,0)
 W !,?2,"Entered: ",?15,$$FMTE^XLFDT(+IB0,2),?50,"Source: ",?60,$$EXPAND^IBTRE(355.33,.03,$P(IB0,U,3))
"RTN","IBCNBU1",41,0)
 W !,?2,"Entered By: ",?15,$$EXPAND^IBTRE(355.33,.02,+$P(IB0,U,2)),?50,"Verified: ",?60,$$FMTE^XLFDT($P(IB0,U,10),2)
"RTN","IBCNBU1",42,0)
 I +$P(IB0,U,10) W !,?50,"Verif By: ",?60,$E($$EXPAND^IBTRE(355.33,.11,$P(IB0,U,11)),1,20)
"RTN","IBCNBU1",43,0)
 W !!,?2,"Patient: ",?15,$$EXPAND^IBTRE(355.33,60.01,$P(IB60,U,1)),?50,"Sub Id: ",?60,$P(IB60,U,4)
"RTN","IBCNBU1",44,0)
 W !,?2,"Insurance: ",?15,$P($G(^IBA(355.33,+IBBUFDA,20)),U,1),?50,"Group #: ",?60,$P($G(^IBA(355.33,+IBBUFDA,40)),U,3)
"RTN","IBCNBU1",45,0)
 W !,?15,$P($G(^IBA(355.33,+IBBUFDA,21)),U,1)
"RTN","IBCNBU1",46,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","IBCNBU1",47,0)
 Q
"RTN","IBCNBU1",48,0)
 ;
"RTN","IBCNBU1",49,0)
LOCK(IBBUFDA,DISP,TO) ; return true if able to lock the buffer entry, if not an DISP is true then will display a message
"RTN","IBCNBU1",50,0)
 ; TO - lock attempt time out & hang time in seconds, default to 4
"RTN","IBCNBU1",51,0)
 N IBX S IBX=0
"RTN","IBCNBU1",52,0)
 S TO=$G(TO,4)
"RTN","IBCNBU1",53,0)
 I +$G(IBBUFDA) L +^IBA(355.33,+IBBUFDA):TO I +$T S IBX=1
"RTN","IBCNBU1",54,0)
 I 'IBX,+$G(DISP) W !!,"Another user is currently editing/processing this entry, please try again later.",! H TO
"RTN","IBCNBU1",55,0)
 Q IBX
"RTN","IBCNBU1",56,0)
 ;
"RTN","IBCNBU1",57,0)
UNLOCK(IBBUFDA) ; unlock a Buffer entry
"RTN","IBCNBU1",58,0)
 L -^IBA(355.33,+IBBUFDA)
"RTN","IBCNBU1",59,0)
 Q
"RTN","IBCNBU1",60,0)
 ;
"RTN","IBCNBU1",61,0)
DICINS(INSNAME,IBSCACT,IBLISTN) ; user search/selection of existing Insurance Company Names, does not list duplicates, based on names and synonyms
"RTN","IBCNBU1",62,0)
 ;
"RTN","IBCNBU1",63,0)
 ; Input parameters
"RTN","IBCNBU1",64,0)
 ;    INSNAME - user input; partial name match of insurance company
"RTN","IBCNBU1",65,0)
 ;    IBSCACT - 0/1 flag indicating if inactive insurance companies
"RTN","IBCNBU1",66,0)
 ;              should get screened out during the list building
"RTN","IBCNBU1",67,0)
 ;              Default is 0 (no screen)
"RTN","IBCNBU1",68,0)
 ;    IBLISTN - number of entries to display in the lister before
"RTN","IBCNBU1",69,0)
 ;              giving the user a chance to select. Default is 4.
"RTN","IBCNBU1",70,0)
 ; Output
"RTN","IBCNBU1",71,0)
 ;    returns Ins name, or -1 if ^, or 0 if none selected
"RTN","IBCNBU1",72,0)
 ;
"RTN","IBCNBU1",73,0)
 S IBSCACT=$G(IBSCACT,0)  ; flag to screen out inactive ins
"RTN","IBCNBU1",74,0)
 S IBLISTN=$G(IBLISTN,4)  ; number of list entries before user selection
"RTN","IBCNBU1",75,0)
 ;
"RTN","IBCNBU1",76,0)
 N IBX,IBINB,IBCX,IBSEL,IBXRF,IBNAME,IBSYNM,IBCNT,IBC1,IBINSIEN,IBLINE
"RTN","IBCNBU1",77,0)
 S IBSEL=0 K ^TMP($J,"IBINSS"),^TMP($J,"IBINSSB") I INSNAME="" G DINSQ
"RTN","IBCNBU1",78,0)
 ;
"RTN","IBCNBU1",79,0)
 S INSNAME=$$UP^XLFSTR(INSNAME),IBX=$L(INSNAME),IBINB=$E(INSNAME,1,(IBX-1))_$C($A($E(INSNAME,IBX))-1)_"~"
"RTN","IBCNBU1",80,0)
 ;
"RTN","IBCNBU1",81,0)
 F IBCX="C","B" S IBXRF=IBINB D
"RTN","IBCNBU1",82,0)
 . F  S IBXRF=$O(^DIC(36,IBCX,IBXRF)) Q:IBXRF=""!($E(IBXRF,1,IBX)'=INSNAME)  D
"RTN","IBCNBU1",83,0)
 .. S IBINSIEN=0
"RTN","IBCNBU1",84,0)
 .. F  S IBINSIEN=+$O(^DIC(36,IBCX,IBXRF,IBINSIEN)) Q:'IBINSIEN  D
"RTN","IBCNBU1",85,0)
 ... I '$D(^DIC(36,IBINSIEN,0)) Q  ; bad xref entry?
"RTN","IBCNBU1",86,0)
 ... I IBSCACT,$P($G(^DIC(36,IBINSIEN,0)),U,5) Q   ; inactive
"RTN","IBCNBU1",87,0)
 ... I IBSCACT,$P($G(^DIC(36,IBINSIEN,5)),U,1) Q   ; scheduled for deletion
"RTN","IBCNBU1",88,0)
 ... S IBNAME=$P($G(^DIC(36,IBINSIEN,0)),U,1)
"RTN","IBCNBU1",89,0)
 ... I IBNAME="" Q
"RTN","IBCNBU1",90,0)
 ... I $D(^TMP($J,"IBINSSB",IBNAME)) Q
"RTN","IBCNBU1",91,0)
 ... S ^TMP($J,"IBINSSB",IBNAME)=$S(IBNAME=IBXRF:"",1:IBXRF)
"RTN","IBCNBU1",92,0)
 ... Q
"RTN","IBCNBU1",93,0)
 ;
"RTN","IBCNBU1",94,0)
 S IBCNT=0,IBX="" F  S IBX=$O(^TMP($J,"IBINSSB",IBX)) Q:IBX=""  S IBCNT=IBCNT+1,^TMP($J,"IBINSS",IBCNT)=IBX
"RTN","IBCNBU1",95,0)
 ;
"RTN","IBCNBU1",96,0)
 S (IBCNT,IBC1)=0 F  S IBCNT=$O(^TMP($J,"IBINSS",IBCNT)) Q:'IBCNT  D  I +IBSEL Q
"RTN","IBCNBU1",97,0)
 . S IBNAME=^TMP($J,"IBINSS",IBCNT) Q:IBNAME=""  S IBSYNM=$G(^TMP($J,"IBINSSB",IBNAME))
"RTN","IBCNBU1",98,0)
 . S IBLINE=$J(IBCNT,7)_"   "_$$FO^IBCNEUT1(IBNAME,40)_IBSYNM
"RTN","IBCNBU1",99,0)
 . DO EN^DDIOL(IBLINE)
"RTN","IBCNBU1",100,0)
 . S IBC1=IBC1+1 I '(IBCNT#IBLISTN) S IBSEL=$$DIR(IBC1)
"RTN","IBCNBU1",101,0)
 . Q
"RTN","IBCNBU1",102,0)
 ;
"RTN","IBCNBU1",103,0)
 I 'IBSEL,+(IBC1#IBLISTN) S IBSEL=$$DIR(IBC1)
"RTN","IBCNBU1",104,0)
 ;
"RTN","IBCNBU1",105,0)
 I IBSEL>0 S IBSEL=$G(^TMP($J,"IBINSS",IBSEL))
"RTN","IBCNBU1",106,0)
 ;
"RTN","IBCNBU1",107,0)
DINSQ K ^TMP($J,"IBINSS"),^TMP($J,"IBCNSSB")
"RTN","IBCNBU1",108,0)
 Q IBSEL
"RTN","IBCNBU1",109,0)
 ;
"RTN","IBCNBU1",110,0)
DIR(MAX) ; DIR call for DICINS search for insurance company name
"RTN","IBCNBU1",111,0)
 N DIR,DIRUT,DTOUT,DUOUT,IBX,X,Y S IBX=0,DIR(0)="LOA^1:"_MAX_"^K:X'>0!(X>"_MAX_") X",DIR("A")="CHOOSE 1-"_MAX_": "
"RTN","IBCNBU1",112,0)
 I $G(MAX)>0 D ^DIR K DIR S IBX=$S($D(DTOUT)!$D(DUOUT):-1,+Y:+Y,1:0)
"RTN","IBCNBU1",113,0)
 Q IBX
"RTN","IBCNBU1",114,0)
 ;
"RTN","IBCNBU1",115,0)
DICBUF(INSNAME,DFN,IBDUZ) ; display list of editable buffer entries based on insurance name, may specify patient and/or enterer
"RTN","IBCNBU1",116,0)
 ; (non-MCCR people: only the person that created an entry should be able to edit it, everyone else should create new ones)
"RTN","IBCNBU1",117,0)
 N X,Y,IBX,DIC,DA,DR,DIR,DIRUT,DTOUT,DUOUT,D S IBX=0
"RTN","IBCNBU1",118,0)
 ;
"RTN","IBCNBU1",119,0)
 S DIC("W")="W ""   "",$P($G(^(20)),U,1),""   "",$P($G(^(21)),U,1)"
"RTN","IBCNBU1",120,0)
 S DIC("S")="I $P(^(0),U,4)=""E""&('$P(^(0),U,10))" S:+$G(IBDUZ) DIC("S")=DIC("S")_"&(+$P(^(0),U,2)="_IBDUZ_")" S:+$G(DFN) DIC("S")=DIC("S")_"&(+$G(^(60))="_DFN_")"
"RTN","IBCNBU1",121,0)
 S DIC="^IBA(355.33,",DIC(0)="EM",X=$$UP^XLFSTR($G(INSNAME)),D="D" D IX^DIC I '$D(DTOUT),'$D(DUOUT),+Y>0 S IBX=+Y
"RTN","IBCNBU1",122,0)
 Q IBX
"VER")
8.0^22
**END**
**END**
