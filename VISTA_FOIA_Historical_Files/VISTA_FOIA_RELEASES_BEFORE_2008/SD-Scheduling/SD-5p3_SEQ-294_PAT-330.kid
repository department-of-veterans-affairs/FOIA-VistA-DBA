Released SD*5.3*330 SEQ #294
Extracted from mail message
**KIDS**:SD*5.3*330^

**INSTALL NAME**
SD*5.3*330
"BLD",5268,0)
SD*5.3*330^SCHEDULING^0^3040219^y
"BLD",5268,1,0)
^^3^3^3040219^
"BLD",5268,1,1,0)
Remove form feed before the each patient appointment letter when printing 
"BLD",5268,1,2,0)
scheduling letters. Change the state printed in the address to the 2 
"BLD",5268,1,3,0)
letter abbreviation.
"BLD",5268,4,0)
^9.64PA^^
"BLD",5268,"KRN",0)
^9.67PA^8989.52^19
"BLD",5268,"KRN",.4,0)
.4
"BLD",5268,"KRN",.401,0)
.401
"BLD",5268,"KRN",.402,0)
.402
"BLD",5268,"KRN",.403,0)
.403
"BLD",5268,"KRN",.5,0)
.5
"BLD",5268,"KRN",.84,0)
.84
"BLD",5268,"KRN",3.6,0)
3.6
"BLD",5268,"KRN",3.8,0)
3.8
"BLD",5268,"KRN",9.2,0)
9.2
"BLD",5268,"KRN",9.8,0)
9.8
"BLD",5268,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",5268,"KRN",9.8,"NM",1,0)
SDLT^^0^B12114077
"BLD",5268,"KRN",9.8,"NM",2,0)
SDL1^^0^B11816562
"BLD",5268,"KRN",9.8,"NM",3,0)
SDC0^^0^B19569246
"BLD",5268,"KRN",9.8,"NM",4,0)
SDN1^^0^B18937902
"BLD",5268,"KRN",9.8,"NM",5,0)
SDCNL^^0^B19562850
"BLD",5268,"KRN",9.8,"NM","B","SDC0",3)

"BLD",5268,"KRN",9.8,"NM","B","SDCNL",5)

"BLD",5268,"KRN",9.8,"NM","B","SDL1",2)

"BLD",5268,"KRN",9.8,"NM","B","SDLT",1)

"BLD",5268,"KRN",9.8,"NM","B","SDN1",4)

"BLD",5268,"KRN",19,0)
19
"BLD",5268,"KRN",19.1,0)
19.1
"BLD",5268,"KRN",101,0)
101
"BLD",5268,"KRN",409.61,0)
409.61
"BLD",5268,"KRN",771,0)
771
"BLD",5268,"KRN",870,0)
870
"BLD",5268,"KRN",8989.51,0)
8989.51
"BLD",5268,"KRN",8989.52,0)
8989.52
"BLD",5268,"KRN",8994,0)
8994
"BLD",5268,"KRN","B",.4,.4)

"BLD",5268,"KRN","B",.401,.401)

"BLD",5268,"KRN","B",.402,.402)

"BLD",5268,"KRN","B",.403,.403)

"BLD",5268,"KRN","B",.5,.5)

"BLD",5268,"KRN","B",.84,.84)

"BLD",5268,"KRN","B",3.6,3.6)

"BLD",5268,"KRN","B",3.8,3.8)

"BLD",5268,"KRN","B",9.2,9.2)

"BLD",5268,"KRN","B",9.8,9.8)

"BLD",5268,"KRN","B",19,19)

"BLD",5268,"KRN","B",19.1,19.1)

"BLD",5268,"KRN","B",101,101)

"BLD",5268,"KRN","B",409.61,409.61)

"BLD",5268,"KRN","B",771,771)

"BLD",5268,"KRN","B",870,870)

"BLD",5268,"KRN","B",8989.51,8989.51)

"BLD",5268,"KRN","B",8989.52,8989.52)

"BLD",5268,"KRN","B",8994,8994)

"BLD",5268,"QUES",0)
^9.62^^
"BLD",5268,"REQB",0)
^9.611^5^5
"BLD",5268,"REQB",1,0)
SD*5.3*185^2
"BLD",5268,"REQB",2,0)
SD*5.3*213^2
"BLD",5268,"REQB",3,0)
SD*5.3*281^2
"BLD",5268,"REQB",4,0)
SD*5.3*106^2
"BLD",5268,"REQB",5,0)
SD*5.3*303^2
"BLD",5268,"REQB","B","SD*5.3*106",4)

"BLD",5268,"REQB","B","SD*5.3*185",1)

"BLD",5268,"REQB","B","SD*5.3*213",2)

"BLD",5268,"REQB","B","SD*5.3*281",3)

"BLD",5268,"REQB","B","SD*5.3*303",5)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
330^3040219
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3040219
"PKG",16,22,1,"PAH",1,1,1,0)
Remove form feed before the each patient appointment letter when printing 
"PKG",16,22,1,"PAH",1,1,2,0)
scheduling letters. Change the state printed in the address to the 2 
"PKG",16,22,1,"PAH",1,1,3,0)
letter abbreviation.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","SDC0")
0^3^B19569246
"RTN","SDC0",1,0)
SDC0 ;MAN/GRR,ALB/TMP/LDB - Continuation of SDC (cancel a clinic) ; 16 JUL 2003  1:27 pm
"RTN","SDC0",2,0)
 ;;5.3;Scheduling;**303,330**;Aug 13, 1993
"RTN","SDC0",3,0)
CHKEND G:NOAP END
"RTN","SDC0",4,0)
 S %=1,DTOUT=0 W !,"WANT TO AUTO-REBOOK APPOINTMENTS NOW" D YN^DICN I '% W !,"REPLY YES (Y) OR NO (N)" G CHKEND
"RTN","SDC0",5,0)
 S ANS=$S('(%-1):"Y",1:"N") I %<0 W " NO" Q:'DTOUT
"RTN","SDC0",6,0)
ASKL S SDLT1="",%=1,(SDLET,SDFORM)="" W !,"WANT LETTERS PRINTED NOW" D YN^DICN I '% W !,"REPLY YES (Y) OR NO (N)" G ASKL
"RTN","SDC0",7,0)
 W:%<0 " NO" S ALS=$S('(%-1):"Y",1:"N") G:ALS'["Y" AOR
"RTN","SDC0",8,0)
EN Q:($P(^SC(SC,0),"^",3)'="C")!($D(SDVAUTC(+SC)))  S SDIV=$P(^SC(SC,0),"^",15),SDIV=$S(SDIV:SDIV,1:$N(^DG(40.8,0))) I $D(SDLT),SDIV'=SDV1 Q
"RTN","SDC0",9,0)
 K SDRE,SDIN I $D(SDLT)&($D(^SC(SC,"I"))) S SDIN=+^("I"),SDRE=+$P(^("I"),"^",2) I $D(SDIN),SDIN,SDIN'>SDBD&('$D(SDRE)!('SDRE)!(SDRE>SDED)) Q
"RTN","SDC0",10,0)
 S:'SDLT1 SDLET=$S($D(^SC(SC,"LTR")):$P(^("LTR"),"^",3),1:"") S ALS=$S(SDLET:"Y",1:"N")
"RTN","SDC0",11,0)
 I ALS="N"!(ANS="Y") S SDFFFF=1
"RTN","SDC0",12,0)
 I ALS="N" W !,"NO LETTERS ARE ASSIGNED TO THE ",$P(^SC(SC,0),"^")," CLINIC" Q:$D(SDLT)
"RTN","SDC0",13,0)
 I SDFORM="",$D(^DG(40.8,SDIV,"LTR")),^("LTR") S SDFORM=^("LTR")
"RTN","SDC0",14,0)
 I $D(SDLT),(ALS'="N") D CHK Q
"RTN","SDC0",15,0)
 Q:$D(SDLT)
"RTN","SDC0",16,0)
AOR G:ANS'["Y"&(ALS'["Y") END
"RTN","SDC0",17,0)
 I '$D(SDLT) S DGPGM="START^SDC0",DGVAR="SC^SI^CDATE^ALS^ANS^SDLET^SDTIME"_$S($D(SDIN):"^SDIN^SDRE",1:"")_"^SDFORM^SDV1^SDFFFF"
"RTN","SDC0",18,0)
 I '$D(SDLT) D FZIS^DGUTQ G:POP END
"RTN","SDC0",19,0)
START U IO I ANS'["Y"&('$D(SDLT)) D:ALS["Y" APP D END Q
"RTN","SDC0",20,0)
BEG1 N SDFIRST
"RTN","SDC0",21,0)
 I $D(SDLT) S SDARRAY=$S('VAUTC:"VAUTC",1:"^SC"),ANS="N",ALS="Y" F SC=0:0 S SC=$N(@(SDARRAY_"("_SC_")")) Q:SC'>0  K SDOK1 D EN I $D(SDOK1),SDLET F SD=(SDBD-.1):0 S SD=$N(^SC(SC,"S",SD)) S CDATE=SD Q:SD>(SDED+.999999)!(SD'>0)  D ^SDC3
"RTN","SDC0",22,0)
 S SDFIRST=$S($G(SDFFFF)=1:0,1:1)
"RTN","SDC0",23,0)
 I $D(SDLT),$D(^UTILITY("SDLT")) D PR^SDC3,END Q
"RTN","SDC0",24,0)
 Q:$D(SDLT)  D ^SDAUT1
"RTN","SDC0",25,0)
 I MAX=0 W !,"AUTO-REBOOKING NOT ALLOWED FOR THIS CLINIC" G APP:ALS["Y",END
"RTN","SDC0",26,0)
 F GDATE=CDATE:0 S GDATE=$N(^SC(SC,"S",GDATE)) Q:GDATE<0!(GDATE>(CDATE+1))  F L=0:0 S L=$N(^SC(SC,"S",GDATE,1,L)) Q:L<0  S A=^(L,0) I $D(^DPT(+A,"S",GDATE,0)),$P(^(0),"^",2)="C",$P(^(0),"^",14)=SDTIME D ^SDAUT2,^SDCCP
"RTN","SDC0",27,0)
 D:ALS["Y" APP
"RTN","SDC0",28,0)
END K %,%DT,%H,%I,%DT,%IS,%ZIS,A,ALS,ANS,BY,CDATE,CHAR,DA,DFN,DH,DHD,DIC,DIS,DO,DOW,FLDS,FR,GDATE,I,L,LET,MAX,NOAP,P,POP,SI,SL,SS,ST,SDSTRTDT,TO,X,Y,ADDR,B,CLIN,HX,L0,L1,L2,LL,PDAT,S,TIME,Z,D,ENDATE,J,SM,STIME,X1,X2,SDX1,SDX2,SDRE,SDRE1,SDIN,FSW
"RTN","SDC0",29,0)
 K SC,SD,Z0,Z5,DGPGM,DUPE,J2,MESS,NDATE,SDDIF,SDFORM,SDINP,SDFORM,SDLET,SDLT1,SDNODE,SDRT,SDSOH,SDST,SDV1,DGVAR,SD1,SD8,SD81,SDANS,SDCNT,SDERR,SDHTO,SDJ,SDTIME,SDZ,STARTDAY,SD82,SDOK,SDOK1,SDLE,SDZ,SDOK1,TST,W,^UTILITY("SD")
"RTN","SDC0",30,0)
 K SDFFFF,DIW,DIWF,DIWL,DIWR,DIWT,DN,DUPE,J2,MESS,NDATE,SDADD,SDC,SDCL,SDDAT,SDDIF,SDFORM,SDHX,SDINP,SDIV,SDLET,SDNODE,SDRT,SDSOH,SDST,SDT0,TST,SDV1 D CLOSE^DGUTQ Q
"RTN","SDC0",31,0)
CHK K SDOK1 I $D(^SC(SC,"SL")) S SL=^("SL"),%=$P(SL,"^",6),SI=$S(%="":4,%<3:4,%:%,1:4) S SDOK1=1 K SL,% E  W $P(^SC(SC,0),"^")," does not have an appointment length indicated."
"RTN","SDC0",32,0)
 Q
"RTN","SDC0",33,0)
APP I $G(SDFFFF)=1 S SDFIRST=0
"RTN","SDC0",34,0)
 F GDATE=CDATE:0 S GDATE=$N(^SC(+SC,"S",GDATE)) Q:GDATE<0!(GDATE>(CDATE+1))  F L=0:0 S L=$N(^SC(+SC,"S",GDATE,1,L)) Q:L<0  S A=^(L,0) D CHECK
"RTN","SDC0",35,0)
 Q
"RTN","SDC0",36,0)
CHK1 S (SDX,X)=GDATE D WRAPP^SDLT
"RTN","SDC0",37,0)
 I $P(S,"^",2)'["A" D REST^SDLT Q
"RTN","SDC0",38,0)
 S SDX=$P(S,"^",10) I '$D(^DPT(+A,"S",SDX,0)) D REST^SDLT Q
"RTN","SDC0",39,0)
 W !!,"The cancelled appointment(s) were rescheduled as follows:",!
"RTN","SDC0",40,0)
 S S=^DPT(+A,"S",SDX,0) D WRAPP^SDLT,REST^SDLT
"RTN","SDC0",41,0)
 Q
"RTN","SDC0",42,0)
CHECK I $S('$D(^DPT(+A,.35)):1,$P(^DPT(+A,.35),"^",1)']"":1,1:0),$D(^DPT(+A,"S",GDATE)),$P(^DPT(+A,"S",GDATE,0),"^",2)["C",$P(^(0),"^",14)=SDTIME!(SDTIME="*") S S=^DPT(+A,"S",GDATE,0) D ^SDLT,CHK1
"RTN","SDC0",43,0)
 Q
"RTN","SDCNL")
0^5^B19562850
"RTN","SDCNL",1,0)
SDCNL ;ALB/LDB - CANCELLED APPOINTMENT LETTER ; 25 MAR 88@13:00
"RTN","SDCNL",2,0)
 ;;5.3;Scheduling;**330**;Aug 13, 1993
"RTN","SDCNL",3,0)
 S (SDOK,SDV)=0 I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2) S SDV=1
"RTN","SDCNL",4,0)
 G:"Cc"[S1 ASDCN
"RTN","SDCNL",5,0)
PT S (SDPT,SDINP)=0 F B=0:0 S SDPT=$O(VAUTN(SDPT)) Q:SDPT=""  W:$D(^DPT(SDPT,.1)) !,$P(^DPT(SDPT,0),"^")," ",$P(^(0),"^",9)," is currently an inpatient!" S:$D(^DPT(SDPT,.1)) SDINP=1 D:'SDINP START S SDINP=0
"RTN","SDCNL",6,0)
 D:$O(^UTILITY($J,0)) PR Q
"RTN","SDCNL",7,0)
START F SDX=SDBD:0 S SDX=$N(^DPT(SDPT,"S",SDX)) Q:SDX>(SDED+.9999)!(SDX'>0)  S SDAP=^DPT(SDPT,"S",SDX,0),SDV2=0 I $P(SDAP,"^",2)["C" D MDIV I SDV2!'SDV S SDC=+SDAP D CHK1 I 'SDOK D CHK
"RTN","SDCNL",8,0)
 Q
"RTN","SDCNL",9,0)
PR N SDFIRST S SDFIRST=1
"RTN","SDCNL",10,0)
 S SDLET="" F A0=0:0 S SDLET=$O(^UTILITY($J,SDLET)) Q:'SDLET  S (B0,X7)="" F A1=0:0 S A5=B0,B0=$O(^UTILITY($J,SDLET,B0)) D:B0="" R Q:B0=""  D R:A5&(B0'=A5) S A=B0 D ^SDLT F A2=0:0 S X7=$O(^UTILITY($J,SDLET,B0,X7)) Q:X7=""  D S,WRAPP^SDLT
"RTN","SDCNL",11,0)
 I $D(^UTILITY($J,"NO")) D NO W:$D(DUZ) !!,"Printed by: ",$P(^VA(200,DUZ,0),"^")
"RTN","SDCNL",12,0)
 D END
"RTN","SDCNL",13,0)
 Q
"RTN","SDCNL",14,0)
END D END^SDN1 K ^UTILITY($J),A0,A1,A3,A5,ALL,B0,SDA,SDINP,SDOK,SDS,SDV,SDV21,SDX,SDX1,SDX8,Z0,Z5,ZTSK,SDAP,X7,DIC,DGPGM,DGVAR,SDPT
"RTN","SDCNL",15,0)
 K BEGDATE,DTOUT,DUOUT,ENDDATE,SDBD,SDBD1,SDCP,SDED,SDLET,SDLET1,SDV,SDV2,X8,Y Q
"RTN","SDCNL",16,0)
MDIV S SDAP=^DPT(SDPT,"S",SDX,0),SDV=$P(^SC(+SDAP,0),"^",15) I SDV=SDV1 S SDV2=1 Q
"RTN","SDCNL",17,0)
 Q
"RTN","SDCNL",18,0)
CAN S SDAP=^DPT(SDPT,"S",SDX,0),SDC=+SDAP
"RTN","SDCNL",19,0)
 S SDLET="" I $D(^SC(SDC,"LTR")),'SDLT1 S SDLET=$S('SD9:$P(^("LTR"),"^",4),1:$P(^("LTR"),"^",3))
"RTN","SDCNL",20,0)
 I 'SDLET&'SDLT1 S ^UTILITY($J,"NO",SDPT,SDC,SDX)=""
"RTN","SDCNL",21,0)
 S SDAP=^DPT(SDPT,"S",SDX,0) I SDLET!SDLT1 S ^UTILITY($J,$S(SDLET:SDLET,1:SDLT1),SDPT,SDX)=SDC
"RTN","SDCNL",22,0)
 I (SDLET!SDLT1),$P(SDAP,"^",10),$D(^DPT(SDPT,"S",$P(SDAP,"^",10))),$P(^DPT(SDPT,"S",$P(SDAP,"^",10),0),"^",2)'["C" S ^UTILITY($J,$S(SDLET:SDLET,1:SDLT1),SDPT,SDX)=$P(SDAP,"^")_"^"_$P(SDAP,"^",10)
"RTN","SDCNL",23,0)
 Q
"RTN","SDCNL",24,0)
ASDCN I 'VAUTC S SDC=0 F Z=0:0 S SDC=$O(VAUTC(SDC)) Q:SDC=""  S SDAP=SDC D ASDCN1
"RTN","SDCNL",25,0)
 G:'VAUTC PR
"RTN","SDCNL",26,0)
 I VAUTC S SDC=0 F Z=0:0 S SDC=$O(^SC(SDC)) Q:'SDC  I $P(^SC(SDC,0),"^",3)="C",$S($P(^(0),"^",15)=SDV1:1,'$P(^(0),"^",15):1,1:0),'$D(SDVAUTC(SDC)) S SDAP=SDC D ASDCN1
"RTN","SDCNL",27,0)
 G:VAUTC PR
"RTN","SDCNL",28,0)
ASDCN1 S SDX=SDBD F W=0:0 S SDX=$O(^DPT("ASDCN",SDC,SDX)) Q:(SDX>(SDED+.9))!(SDX="")  S SDPT=0 F T=0:0 S SDPT=$O(^DPT("ASDCN",SDC,SDX,SDPT)) Q:SDPT=""  I $D(^DPT(SDPT,"S",SDX,0)),$P(^(0),"^")=SDC,'$D(^DPT(SDPT,.1)) D CHK1 D:'SDOK CHK
"RTN","SDCNL",29,0)
 Q
"RTN","SDCNL",30,0)
R S SDR=0,SDX8="",SDA=A5
"RTN","SDCNL",31,0)
 F A3=0:0 S SDX8=$O(^UTILITY($J,SDLET,A5,SDX8)) Q:SDX8=""  I ^(SDX8),$P(^(SDX8),"^",2) S SDX=$P(^(SDX8),"^",2),SDC=$P(^(SDX8),"^"),(DFN,A)=A5,SDS=^DPT(DFN,"S",SDX,0) W:'SDR !!,"The rescheduled appointment(s) follow:",! D WRAPP^SDLT S SDR=1
"RTN","SDCNL",32,0)
 D REST^SDLT Q
"RTN","SDCNL",33,0)
S S A=B0,SDX=X7,SDS=^DPT(A,"S",SDX,0),SDC=+^(0) Q
"RTN","SDCNL",34,0)
NO W @IOF S SDPT=""
"RTN","SDCNL",35,0)
 F A3=0:0 S SDPT=$O(^UTILITY($J,"NO",SDPT)) Q:SDPT=""  S SDC="" F A4=0:0 S SDC=$O(^UTILITY($J,"NO",SDPT,SDC)) Q:SDC=""  D NOAP S SDAP="" F A5=0:0 S SDAP=$O(^UTILITY($J,"NO",SDPT,SDC,SDAP)) D:SDAP="" NOAP2 Q:SDAP=""  W ! D NOAP1
"RTN","SDCNL",36,0)
 Q
"RTN","SDCNL",37,0)
NOAP W !!,$P(^DPT(SDPT,0),"^")," ",$P(^(0),"^",9),!,"has the following cancelled appointment(s) in ",$P(^SC(SDC,0),"^")," CLINIC" Q
"RTN","SDCNL",38,0)
NOAP1 S Y=SDAP D DT^DIQ Q
"RTN","SDCNL",39,0)
NOAP2 W !,"but no letter is assigned to the clinic" Q
"RTN","SDCNL",40,0)
 S Y=SDAP D DT^DIQ W ! Q
"RTN","SDCNL",41,0)
 Q
"RTN","SDCNL",42,0)
CHK S DFN=SDPT D DEM^VADPT I VADM(6) D KVAR^VADPT Q
"RTN","SDCNL",43,0)
 D CAN:$D(^DPT("ASDCN",SDC,SDX,SDPT)),KVAR^VADPT Q
"RTN","SDCNL",44,0)
CHK1 S SDOK=0 I '$D(^SC(+SDAP,"S",SDX)) Q
"RTN","SDCNL",45,0)
 I $D(^SC(+SDAP,"S",SDX)) F P=0:0 S P=$N(^SC(+SDAP,"S",SDX,1,P)) Q:P'>0  I $P(^(P,0),"^")=SDPT S SDOK=1
"RTN","SDCNL",46,0)
 Q
"RTN","SDL1")
0^2^B11816562
"RTN","SDL1",1,0)
SDL1 ;BSN/GRR,ALB/LDB - PRE-APPOINTMENT LETTERS ; 14 SEP 84  3:48 pm
"RTN","SDL1",2,0)
 ;;5.3;Scheduling;**106,330**;Aug 13, 1993
"RTN","SDL1",3,0)
 ;
"RTN","SDL1",4,0)
 ;******************MODIFICATIONS***********************************
"RTN","SDL1",5,0)
 ;
"RTN","SDL1",6,0)
 ;  DATE        PATCH       DEVELOPER    DESCRIPTION
"RTN","SDL1",7,0)
 ;  ----        -----       ---------    -----------
"RTN","SDL1",8,0)
 ;  12/12/2003  SD*5.3*330  JOHN LUNDEN  FIX FORM FEED LOGIC
"RTN","SDL1",9,0)
 ;
"RTN","SDL1",10,0)
 ;******************************************************************
"RTN","SDL1",11,0)
 ;
"RTN","SDL1",12,0)
START U IO K ^UTILITY($J) S SDLT1=SDLET G:"Pp"'[S1 BC
"RTN","SDL1",13,0)
 I $D(VAUTN) F C=0:0 S C=$O(VAUTN(C)) Q:'C  S DFN=C D DATE
"RTN","SDL1",14,0)
 D LST Q
"RTN","SDL1",15,0)
DATE F D=SDBD:0 S D=$O(^DPT(C,"S",D)) Q:'D!(D>(SDED+.9999))  I $D(^(D,0)),$P(^(0),"^",2)'["C",$S('$D(^DPT(C,.35)):1,$P(^(.35),"^",1)']"":1,1:0) S A1=C,B1=D,D1=+^DPT(C,"S",D,0) D SET
"RTN","SDL1",16,0)
 Q
"RTN","SDL1",17,0)
APP F J=0:0 S J=$O(^UTILITY($J,L,A,J)) Q:'J  S SDX=J,SDC=^(J),S=^DPT(+A,"S",J,0) D WRAPP^SDLT
"RTN","SDL1",18,0)
 D REST^SDLT Q
"RTN","SDL1",19,0)
BC S U="^" I $D(VAUTC),'VAUTC D CL G LST
"RTN","SDL1",20,0)
ALCL F C=0:0 S C=$O(^SC(C)) Q:'C  I '$D(SDVAUTC(C)),$P(^SC(C,0),U,3)="C",$S('$D(^("I")):1,'+^("I"):1,+^("I")<SDBD&('$P(^("I"),U,2)):0,+^("I")<SDBD&($P(^("I"),U,2)>SDED):0,1:1) D NCHECK I $T D D D:$D(SDD) OVER
"RTN","SDL1",21,0)
LST N SDFIRST S SDFIRST=1       ;SD*5.3*330. Flag to determine first pag
"RTN","SDL1",22,0)
 F L=0:0 S L=$O(^UTILITY($J,L)) Q:'L  D
"RTN","SDL1",23,0)
 .F A=0:0 S A=$O(^UTILITY($J,L,A)) Q:'A  D
"RTN","SDL1",24,0)
 ..S SDLET=L D ^SDLT,APP
"RTN","SDL1",25,0)
 D NO,END,CLOSE^DGUTQ Q
"RTN","SDL1",26,0)
CL F C=0:0 S C=$O(VAUTC(C)) Q:'C  S:'SDLT1 SDLET=0 D OVER
"RTN","SDL1",27,0)
 Q
"RTN","SDL1",28,0)
OVER Q:'$D(^SC(C,"S"))  F SDT=SDBD:0 S SDT=$O(^SC(C,"S",SDT)) Q:'SDT!(SDT>(SDED+.9999))  F K=0:0 S K=$O(^SC(C,"S",SDT,1,K)) Q:'K  S DFN=+^(K,0) I $P(^(0),"^",9)'["C" D CHECK
"RTN","SDL1",29,0)
 Q
"RTN","SDL1",30,0)
END W ! K %,%H,%I,%Y,%DT,%IS,%ZIS,A,B,C,D,DN,CLIN,CNN,DATE,DATEND,DFN,DIC,DIV,DOW,GDATE,SDHX,I,J,J1,K,L,L0,PDAT,S,S1,SC,SDADD,SDFORM,SDT,SDXX,TIME,X,Y,Z,Z0,Z5 Q
"RTN","SDL1",31,0)
CHECK I $S('$D(^DPT(DFN,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(DFN,"S",SDT,0)),$P(^(0),"^",2)'["C",'$D(^DPT(DFN,.1)) S A1=DFN,B1=SDT,D1=C D SET
"RTN","SDL1",32,0)
 Q
"RTN","SDL1",33,0)
SET I $D(^SC(D1,"LTR"))!(SDLT1) S:'SDLT1 SDLET=$P(^SC(D1,"LTR"),"^",2) I SDLET S ^UTILITY($J,SDLET,A1,B1)=D1 S:'SDLT1 SDLET=0 K A,A1,B1,D1 Q
"RTN","SDL1",34,0)
 I 'SDLET S ^UTILITY($J,"C",A1,D1)="" K A,A1,B1,D1 Q
"RTN","SDL1",35,0)
 Q
"RTN","SDL1",36,0)
NO I $D(VAUTN),'$O(^UTILITY($J,0)),'$D(^UTILITY($J,"C")) W !,"NO ACTIVE APPOINTMENTS FOR THE PATIENT(S) DURING THAT TIME PERIOD!",*7
"RTN","SDL1",37,0)
 I $D(^UTILITY($J,"C")) W @IOF F X=0:0 S X=$O(^UTILITY($J,"C",X)) Q:'X  W !!,$P(^DPT(X,0),"^")," ",$P(^(0),"^",9)," HAS FUTURE APPTS., but" D NOCL
"RTN","SDL1",38,0)
 Q
"RTN","SDL1",39,0)
NOCL F XX=0:0 S XX=$O(^UTILITY($J,"C",X,XX)) Q:'XX  W !,$P(^SC(XX,0),"^")," Clinic is not assigned a PRE-APPOINTMENT LETTER"
"RTN","SDL1",40,0)
 Q
"RTN","SDL1",41,0)
D K SDD I ($P(^SC(C,0),"^",15)=SDV1)!(SDV1=$O(^DG(40.8,0))&($P(^SC(C,0),"^",15)="")) S SDD=1
"RTN","SDL1",42,0)
 Q
"RTN","SDL1",43,0)
NCHECK ;
"RTN","SDL1",44,0)
 N NOC S NOC=$P($G(^SC(C,0)),U,17)
"RTN","SDL1",45,0)
 I SDCONC="B" Q
"RTN","SDL1",46,0)
 I SDCONC="C"&(NOC="N") Q
"RTN","SDL1",47,0)
 I SDCONC="N"&(NOC="Y") Q
"RTN","SDL1",48,0)
 Q
"RTN","SDLT")
0^1^B12114077
"RTN","SDLT",1,0)
SDLT ;ALB/LDB - CANCELLATION LETTERS ; 14 Feb 2003
"RTN","SDLT",2,0)
 ;;5.3;Scheduling;**185,213,281,330**;Aug 13, 1993
"RTN","SDLT",3,0)
 ;
"RTN","SDLT",4,0)
 ;**************************************************************************
"RTN","SDLT",5,0)
 ;                          MODIFICATIONS
"RTN","SDLT",6,0)
 ;                          
"RTN","SDLT",7,0)
 ;   DATE      PATCH     DEVELOPER  DESCRIPTION OF CHANGES
"RTN","SDLT",8,0)
 ; --------  ----------  ---------  ----------------------------------------
"RTN","SDLT",9,0)
 ; 02/14/03  SD*5.3*281  SAUNDERS   Print letters to confidential address if
"RTN","SDLT",10,0)
 ;                                  requested
"RTN","SDLT",11,0)
 ; 12/2/03   SD*5.3*330  LUNDEN     Remove form feed from PRT+0
"RTN","SDLT",12,0)
 ;
"RTN","SDLT",13,0)
 ;**************************************************************************
"RTN","SDLT",14,0)
 ;
"RTN","SDLT",15,0)
 ;WRITE GREETING AND OPENING TEXT OF LETTER
"RTN","SDLT",16,0)
PRT S Y=DT D DTS^SDUTL
"RTN","SDLT",17,0)
 I +$G(SDFIRST)=0 W @IOF ;SD*5.3*330 Form feed only after letter #1
"RTN","SDLT",18,0)
 K SDFIRST
"RTN","SDLT",19,0)
 ;S SDFIRST=0
"RTN","SDLT",20,0)
 W !,?65,Y,!,?65,$$LAST4(A),!!!!
"RTN","SDLT",21,0)
 I 'SDFORM W !!!!! D ADDR W !!!!
"RTN","SDLT",22,0)
W1 W !,"Dear ",$S($P(^DPT(+A,0),"^",2)="M":"Mr. ",1:"Ms. ")
"RTN","SDLT",23,0)
 N DPTNAME
"RTN","SDLT",24,0)
 S DPTNAME("FILE")=2,DPTNAME("FIELD")=".01",DPTNAME("IENS")=(+A)_","
"RTN","SDLT",25,0)
 S X=$$NAMEFMT^XLFNAME(.DPTNAME,"G","M") W X,","
"RTN","SDLT",26,0)
 W !! K ^UTILITY($J,"W"),DIWF,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z0=0:0 S Z0=$O(^VA(407.5,SDLET,1,Z0)) Q:Z0'>0  S X=^(Z0,0) D ^DIWP
"RTN","SDLT",27,0)
 D ^DIWW K ^UTILITY($J,"W") Q
"RTN","SDLT",28,0)
WRAPP ;WRITE APPOINTMENT INFORMATION
"RTN","SDLT",29,0)
 S:$D(SC)&'$D(SDC) SDC=SC S SDCL=$P(^SC(+SDC,0),"^",1),SDCL=SDCL_" Clinic" D FORM
"RTN","SDLT",30,0)
 S SDX1=$S($D(SDX):SDX,1:X) S:$D(SDS) S=SDS F B=3,4,5 I $P(S,"^",B)]"" S SDCL=$S(B=3:"LAB",B=4:"XRAY",1:"EKG"),SDX=$P(S,"^",B) D FORM
"RTN","SDLT",31,0)
 S (SDX,X)=SDX1 Q
"RTN","SDLT",32,0)
FORM S:$D(SDX) X=SDX S SDHX=X D DW^%DTC S DOW=X,X=SDHX X ^DD("FUNC",2,1) S SDT0=X,SDDAT=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(SDHX,4,5))_" "_+$E(SDHX,6,7)_", "_(1700+$E(SDHX,1,3)) W !?4,DOW,?14,$J(SDDAT,12)
"RTN","SDLT",33,0)
 W ?27,$J(SDT0,8)," ",SDCL I $D(SDLT)&($Y>(IOSL-8)) W @IOF
"RTN","SDLT",34,0)
 Q
"RTN","SDLT",35,0)
REST ;WRITE THE REMAINDER OF LETTER
"RTN","SDLT",36,0)
 I SDLET W !?12 K ^UTILITY($J,"W"),DIWL,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z5=0:0 S Z5=$O(^VA(407.5,SDLET,2,Z5)) Q:Z5'>0  S X=^(Z5,0) D ^DIWP
"RTN","SDLT",37,0)
 D ^DIWW K ^UTILITY($J,"W") Q:'SDFORM
"RTN","SDLT",38,0)
 F I=$Y:1:IOSL-12 W !
"RTN","SDLT",39,0)
 D ADDR Q
"RTN","SDLT",40,0)
ADDR K VAHOW S DFN=+A W !?12,$$FML^DGNFUNC(DFN) S VAHOW=2
"RTN","SDLT",41,0)
 I $D(^DG(43,1,"BT")),'$P(^("BT"),"^",3) S VAPA("P")=""
"RTN","SDLT",42,0)
 S X1=DT,X2=5 D C^%DTC I '$D(VAPA("P")) S (VATEST("ADD",9),VATEST("ADD",10))=X
"RTN","SDLT",43,0)
 D ADD^VADPT D
"RTN","SDLT",44,0)
 .;CHANGE STATE TO ABBR.
"RTN","SDLT",45,0)
 .N SDIENS,X
"RTN","SDLT",46,0)
 .I $D(^UTILITY("VAPA",$J,5)) S SDIENS=+^UTILITY("VAPA",$J,5)_",",X=$$GET1^DIQ(5,SDIENS,1),$P(^UTILITY("VAPA",$J,5),U,2)=X
"RTN","SDLT",47,0)
 .K SDIENS Q
"RTN","SDLT",48,0)
 N SDCCACT1,SDCCACT2
"RTN","SDLT",49,0)
 S SDCCACT1=^UTILITY("VAPA",$J,12),SDCCACT2=$P($G(^UTILITY("VAPA",$J,22,2)),"^",3)
"RTN","SDLT",50,0)
 ;if confidential address is not active for scheduling/appointment letters, print to regular address
"RTN","SDLT",51,0)
 I ($G(SDCCACT1)=0)!($G(SDCCACT2)'="Y") D
"RTN","SDLT",52,0)
 .F LL=1:1:4 W:^UTILITY("VAPA",$J,LL)]"" !,?12,^UTILITY("VAPA",$J,LL)
"RTN","SDLT",53,0)
 .W:^UTILITY("VAPA",$J,4)']"" ! I ^UTILITY("VAPA",$J,5)]"" W ", ",$P(^UTILITY("VAPA",$J,5),"^",2)
"RTN","SDLT",54,0)
 .I ^UTILITY("VAPA",$J,11)]"" W "  ",$P(^UTILITY("VAPA",$J,11),U,2)
"RTN","SDLT",55,0)
 ;if confidential address is active for scheduling/appointment letters, print to confidential address
"RTN","SDLT",56,0)
 I $G(SDCCACT1)=1,$G(SDCCACT2)="Y" D
"RTN","SDLT",57,0)
 .F LL=13:1:16 W:^UTILITY("VAPA",$J,LL)]"" !,?12,^UTILITY("VAPA",$J,LL)
"RTN","SDLT",58,0)
 .W:^UTILITY("VAPA",$J,16)']"" ! I ^UTILITY("VAPA",$J,17)]"" W ", ",$P(^UTILITY("VAPA",$J,17),"^",2)
"RTN","SDLT",59,0)
 .I ^UTILITY("VAPA",$J,18)]"" W "  ",$P(^UTILITY("VAPA",$J,18),U,2)
"RTN","SDLT",60,0)
 W ! D KVAR^VADPT Q
"RTN","SDLT",61,0)
 ;
"RTN","SDLT",62,0)
 ;
"RTN","SDLT",63,0)
LAST4(DFN) ;Return patient "last four"
"RTN","SDLT",64,0)
 N SDX
"RTN","SDLT",65,0)
 S SDX=$G(^DPT(+DFN,0))
"RTN","SDLT",66,0)
 Q $E(SDX)_$E($P(SDX,U,9),6,9)
"RTN","SDN1")
0^4^B18937902
"RTN","SDN1",1,0)
SDN1 ;BSN/GRR - NO-SHOW LETTERS ; 17 AUG 84  4:34 pm
"RTN","SDN1",2,0)
 ;;5.3;Scheduling;**330**;Aug 13, 1993
"RTN","SDN1",3,0)
 I ANS["Y"&($D(C)) F A=0:0 S A=$N(^UTILITY($J,A)) Q:A'>0  F C=0:0 S C=$N(^(A,C)) Q:C'>0  S SC=+^(C),SDLET="" S:$D(^SC(SC,"LTR")) SDLET=+^("LTR") S:SDLET ^UTILITY($J,"SDLT",SDLET,A,C)=^UTILITY($J,A,C) S:'SDLET ^UTILITY($J,"NO",A,C)=SC D KLL
"RTN","SDN1",4,0)
 S SDFORM=$S($D(^DG(40.8,SDV1,"LTR")):^("LTR"),1:"") G:ANS["Y"&($D(C)) LST
"RTN","SDN1",5,0)
BC K:$D(SDLT) C S:$D(SDLT) SDT=SDBD,DATEND=SDED K ^UTILITY($J) I $D(C) K VAUTC S (VAUTC,VAUTC(C))=""
"RTN","SDN1",6,0)
 I $D(VAUTC),'VAUTC F C=0:0 S C=$N(VAUTC(C)) Q:C'>0  D:$D(SDLT) LT D CHECK1 I $T D OVER
"RTN","SDN1",7,0)
 I $D(VAUTC),'VAUTC G LST
"RTN","SDN1",8,0)
LST1 F C=0:0 S C=$N(^SC(C)) Q:C'>0  D LT,CHECK1 I $T,$S(SDV1="":1,SDV=SDV1:1,SDV="":1,1:0),'$D(SDVAUTC(+C)),$D(^SC(C,"S")) D OVER
"RTN","SDN1",9,0)
LST N SDFIRST S SDFIRST=1
"RTN","SDN1",10,0)
 F SDLET=0:0 S SDLET=$N(^UTILITY($J,"SDLT",SDLET)) Q:SDLET'>0  F A=0:0 S A=$N(^UTILITY($J,"SDLT",SDLET,A)) Q:A'>0  I $S('$D(^DPT(A,.35)):1,$P(^(.35),"^",1)']"":1,1:0) D ^SDLT,WR
"RTN","SDN1",11,0)
 I $D(^UTILITY($J,"NO")) W @IOF F A=0:0 S A=$N(^UTILITY($J,"NO",A)) Q:A'>0  F A1=0:0 S A1=$N(^(A,A1)) Q:A1'>0  W !,$P(^DPT(A,0),"^")," ",$P(^(0),"^",9)," has failed to keep the following appointment(s):" D NDT
"RTN","SDN1",12,0)
 W:$D(^UTILITY($J,"NO")) !,"However, there are no letters assigned to the clinic(s).",!! G END
"RTN","SDN1",13,0)
OVER S GDATE=SDT Q:'$D(^SC(C,"S"))  F J=0:0 S GDATE=$N(^SC(C,"S",GDATE)) Q:GDATE<0!(GDATE>(DATEND+.9999))  F K=0:0 S K=$N(^SC(C,"S",GDATE,1,K)) Q:K<0  I $D(^(K,0)) S DFN=+^(0) D CHECK
"RTN","SDN1",14,0)
 Q
"RTN","SDN1",15,0)
END K %,%DT,%IS,A,A0,A1,A2,ALL,ALS,ANS,BY,C,CDATE,DA,DFN,DGPGM,DGVAR,DH,DHD,DIC,DIS,DIV,DIW,DIWF,DIWL,DIWR,DIWT,DO,DOW,DN,DUPE,FLDS,F,F1,FR,GDATE,I,I1,L,L0,LET,MAX,MESS,MIN,NOAP,P,POP,SC,SD,SDFOR,SDLET,SDTIME,SI,SL,SS,ST,SDSTRTDT,TO,X,Y,ADDR,B
"RTN","SDN1",16,0)
 K CLIN,HX,LL,PDAT,S,TIME,Z,D,NDATE,ENDATE,J,SDMDT,SDMSTIME,X1,X2,SDTADE,SDADTB,SDRE,SDRE1,SDIN,SDIS,SDYES,CNN,SDT,DATEND,SDV1,K,SDR,SDJ1,^UTILITY($J),SD1,SD2,SDADD,SDC,SDCL,SDCMAX,SDCONS,SDD,SDDAT,SDDIF,SDDT,SDED,SDFORM,SDHX,SDINP,SDIP
"RTN","SDN1",17,0)
 K %ZIS,Y1,SDBD,SDCT,SDVAUTC,VAUTC,SDX,SDX1,SDNOSH,SDLT1,SDMSG,SDNODE,SDQ,SDRT,SDSOH,SDSTAT,SDT0,SDZSC,SM,SM1,STARTDAY,STIME,SDV,Z0,Z5 D CLOSE^DGUTQ Q
"RTN","SDN1",18,0)
CHECK I $S('$D(^DPT(DFN,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(DFN,"S",GDATE,0)),$S($P(^(0),"^",2)["N":1,$D(SDCP)&$P(^(0),"^",2)["C":1,1:0),$P(^(0),"^",14)=SDTIME!(SDTIME="*"),'$D(^DPT(DFN,.1)) D SET
"RTN","SDN1",19,0)
 Q
"RTN","SDN1",20,0)
SET I SDLT1!SDLET S ^UTILITY($J,"SDLT",$S(SDLT1:SDLT1,1:SDLET),DFN,GDATE)=C_"^"_$P(^DPT(DFN,"S",GDATE,0),"^",10) Q
"RTN","SDN1",21,0)
 S ^UTILITY($J,"NO",DFN,GDATE)=C Q
"RTN","SDN1",22,0)
CHECK1 S SDV=$P(^SC(C,0),"^",15) I $P(^(0),"^",3)="C",$S('$D(^SC(C,"I")):1,'(+^("I")):1,+^("I")>DATEND:1,+$P(^("I"),"^",2)'>DATEND&(+$P(^("I"),"^",2)):1,1:0)
"RTN","SDN1",23,0)
 Q
"RTN","SDN1",24,0)
WR K CNN F J=0:0 S J=$N(^UTILITY($J,"SDLT",SDLET,A,J)) Q:J<0  S SDR=0,SDX=J,CNN(J)=^(J),CLIN=$P(^SC(+$P(CNN(J),"^",1),0),"^",1),SDC=+CNN(J),S=$S($D(^DPT(A,"S",J,0)):^(0),1:"") D WRAPP^SDLT,SET1
"RTN","SDN1",25,0)
 D:SDR SDR D REST^SDLT Q
"RTN","SDN1",26,0)
SDR W !!,"The appointment(s) have been rescheduled as follows:",!
"RTN","SDN1",27,0)
 F J=0:0 S J=$N(CNN(J)) Q:J<0  S SDX=$P(CNN(J),"^",2),SDC=$P(CNN(J),"^") I SDX S S=$S($D(^DPT(A,"S",SDX,0)):^(0),1:"") D WRAPP^SDLT
"RTN","SDN1",28,0)
 Q
"RTN","SDN1",29,0)
SET1 S:'SDR SDR=$S($P(CNN(J),"^",2)]"":1,1:0) Q
"RTN","SDN1",30,0)
 Q
"RTN","SDN1",31,0)
LT S:'SDLT1 SDLET=0 I $D(^SC(C,"LTR")),^("LTR") S SDLET=+^("LTR")
"RTN","SDN1",32,0)
 Q
"RTN","SDN1",33,0)
NDT W !?15,$P(^SC(+^UTILITY($J,"NO",A,A1),0),"^")," on " S Y=A1 D DT^DIQ Q
"RTN","SDN1",34,0)
KLL K ^UTILITY($J,A,C) Q
"VER")
8.0^22
**END**
**END**
