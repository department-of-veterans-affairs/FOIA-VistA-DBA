Released LR*5.2*359 SEQ #276
Extracted from mail message
**KIDS**:LR*5.2*359^

**INSTALL NAME**
LR*5.2*359
"BLD",6333,0)
LR*5.2*359^LAB SERVICE^0^3060715^y
"BLD",6333,4,0)
^9.64PA^^
"BLD",6333,"KRN",0)
^9.67PA^8989.52^19
"BLD",6333,"KRN",.4,0)
.4
"BLD",6333,"KRN",.401,0)
.401
"BLD",6333,"KRN",.402,0)
.402
"BLD",6333,"KRN",.403,0)
.403
"BLD",6333,"KRN",.5,0)
.5
"BLD",6333,"KRN",.84,0)
.84
"BLD",6333,"KRN",3.6,0)
3.6
"BLD",6333,"KRN",3.8,0)
3.8
"BLD",6333,"KRN",9.2,0)
9.2
"BLD",6333,"KRN",9.8,0)
9.8
"BLD",6333,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",6333,"KRN",9.8,"NM",1,0)
LRBEBA2^^0^B78928949
"BLD",6333,"KRN",9.8,"NM",2,0)
LRBEBA21^^0^B40326837
"BLD",6333,"KRN",9.8,"NM",3,0)
LRBEBA3^^0^B62466006
"BLD",6333,"KRN",9.8,"NM",4,0)
LRBEBA4^^0^B61044712
"BLD",6333,"KRN",9.8,"NM",5,0)
LRBEBAO^^0^B71311928
"BLD",6333,"KRN",9.8,"NM",6,0)
LRBEPRPT^^0^B38192060
"BLD",6333,"KRN",9.8,"NM",7,0)
LRCAPPH1^^0^B56348077
"BLD",6333,"KRN",9.8,"NM",8,0)
LRORDST^^0^B30181718
"BLD",6333,"KRN",9.8,"NM","B","LRBEBA2",1)
 
"BLD",6333,"KRN",9.8,"NM","B","LRBEBA21",2)
 
"BLD",6333,"KRN",9.8,"NM","B","LRBEBA3",3)
 
"BLD",6333,"KRN",9.8,"NM","B","LRBEBA4",4)
 
"BLD",6333,"KRN",9.8,"NM","B","LRBEBAO",5)
 
"BLD",6333,"KRN",9.8,"NM","B","LRBEPRPT",6)
 
"BLD",6333,"KRN",9.8,"NM","B","LRCAPPH1",7)
 
"BLD",6333,"KRN",9.8,"NM","B","LRORDST",8)
 
"BLD",6333,"KRN",19,0)
19
"BLD",6333,"KRN",19.1,0)
19.1
"BLD",6333,"KRN",101,0)
101
"BLD",6333,"KRN",409.61,0)
409.61
"BLD",6333,"KRN",771,0)
771
"BLD",6333,"KRN",870,0)
870
"BLD",6333,"KRN",8989.51,0)
8989.51
"BLD",6333,"KRN",8989.52,0)
8989.52
"BLD",6333,"KRN",8994,0)
8994
"BLD",6333,"KRN","B",.4,.4)
 
"BLD",6333,"KRN","B",.401,.401)
 
"BLD",6333,"KRN","B",.402,.402)
 
"BLD",6333,"KRN","B",.403,.403)
 
"BLD",6333,"KRN","B",.5,.5)
 
"BLD",6333,"KRN","B",.84,.84)
 
"BLD",6333,"KRN","B",3.6,3.6)
 
"BLD",6333,"KRN","B",3.8,3.8)
 
"BLD",6333,"KRN","B",9.2,9.2)
 
"BLD",6333,"KRN","B",9.8,9.8)
 
"BLD",6333,"KRN","B",19,19)
 
"BLD",6333,"KRN","B",19.1,19.1)
 
"BLD",6333,"KRN","B",101,101)
 
"BLD",6333,"KRN","B",409.61,409.61)
 
"BLD",6333,"KRN","B",771,771)
 
"BLD",6333,"KRN","B",870,870)
 
"BLD",6333,"KRN","B",8989.51,8989.51)
 
"BLD",6333,"KRN","B",8989.52,8989.52)
 
"BLD",6333,"KRN","B",8994,8994)
 
"BLD",6333,"QUES",0)
^9.62^^
"BLD",6333,"REQB",0)
^9.611^1^1
"BLD",6333,"REQB",1,0)
LR*5.2*291^2
"BLD",6333,"REQB","B","LR*5.2*291",1)
 
"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)
 
"PKG",26,20,"B",2,1)
 
"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2981028^66481
"PKG",26,22,1,"PAH",1,0)
359^3060715
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","LRBEBA2")
0^1^B78928949^B81298476
"RTN","LRBEBA2",1,0)
LRBEBA2 ;DALOI/JAH/FHS - ORDERING AND RESULTING OUTPATIENT ;8/10/04
"RTN","LRBEBA2",2,0)
 ;;5.2;LAB SERVICE;**291,359**;Sep 27, 1994
"RTN","LRBEBA2",3,0)
 ;
"RTN","LRBEBA2",4,0)
DG1(LRBESTG) ; Set the DG1 segment into the ^TMP
"RTN","LRBEBA2",5,0)
 N LRBEDGX,LRBETNUM
"RTN","LRBEBA2",6,0)
 S LRBETNUM=$O(^TMP("OR",$J,"LROT",STARTDT,TYPE,SAMP,SPEC,LRSX,"LRBEDGX",""),-1)
"RTN","LRBEBA2",7,0)
 S LRBETNUM=$G(LRBETNUM)+1
"RTN","LRBEBA2",8,0)
 S LRBEDGX=$P($P(LRBESTG,"|",4),"^",1)
"RTN","LRBEBA2",9,0)
 S ^TMP("OR",$J,"LROT",STARTDT,TYPE,SAMP,SPEC,LRSX,"LRBEDGX",LRBETNUM)=LRBEDGX
"RTN","LRBEBA2",10,0)
 Q
"RTN","LRBEBA2",11,0)
ZCL(LRBESTG) ; Set the ZCL segment into the ^TMP
"RTN","LRBEBA2",12,0)
 N LRBEX,LRBETNUM,LRBEIND
"RTN","LRBEBA2",13,0)
 S LRBETNUM=$O(^TMP("OR",$J,"LROT",STARTDT,TYPE,SAMP,SPEC,LRSX,"LRBEDGX",""),-1)
"RTN","LRBEBA2",14,0)
 S LRBEX=$P(LRBESTG,"|",3),LRBEIND=$P(LRBESTG,"|",4)
"RTN","LRBEBA2",15,0)
 S $P(^TMP("OR",$J,"LROT",STARTDT,TYPE,SAMP,SPEC,LRSX,"LRBEDGX",LRBETNUM),U,LRBEX+1)=LRBEIND
"RTN","LRBEBA2",16,0)
 Q
"RTN","LRBEBA2",17,0)
 ;
"RTN","LRBEBA2",18,0)
SDGX69(J,LRBEIEN) ; Set the diagnosis into #69
"RTN","LRBEBA2",19,0)
 N LRBEDGX,LRBEFIL,LRFDA,LRFDAIEN,LRBESEQ,LRBEPTDT,LRBEIEN2
"RTN","LRBEBA2",20,0)
 S LRBESEQ="",LRBEFIL=69.05
"RTN","LRBEBA2",21,0)
 F  S LRBESEQ=$O(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC,J,"LRBEDGX",LRBESEQ)) Q:LRBESEQ=""  D
"RTN","LRBEBA2",22,0)
 .S LRBEPTDT=$G(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC,J,"LRBEDGX",LRBESEQ))
"RTN","LRBEBA2",23,0)
 .S LRBEIEN2=LRBESEQ_","_LRBEIEN
"RTN","LRBEBA2",24,0)
 .I '$D(^LRO(69,LRODT,1,LRSN,2,$P(LRBEIEN,",",1),2,"B",$P(LRBEPTDT,U,1))) S LRBEIEN2="+"_LRBEIEN2
"RTN","LRBEBA2",25,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,.01)=$P(LRBEPTDT,U,1),LRFDAIEN(LRBESEQ)=LRBESEQ
"RTN","LRBEBA2",26,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,1)=$P(LRBEPTDT,U,4)   ;SC
"RTN","LRBEBA2",27,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,2)=$P(LRBEPTDT,U,8)   ;CV
"RTN","LRBEBA2",28,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,3)=$P(LRBEPTDT,U,2)   ;AO
"RTN","LRBEBA2",29,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,4)=$P(LRBEPTDT,U,3)   ;IR
"RTN","LRBEBA2",30,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,5)=$P(LRBEPTDT,U,5)   ;EC
"RTN","LRBEBA2",31,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,6)=$P(LRBEPTDT,U,6)   ;MST
"RTN","LRBEBA2",32,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,7)=$P(LRBEPTDT,U,7)   ;HNC
"RTN","LRBEBA2",33,0)
 .S:LRBESEQ=1 LRFDA(99,LRBEFIL,LRBEIEN2,8)=1         ;Is Primary?
"RTN","LRBEBA2",34,0)
 D UPDATE^DIE("","LRFDA(99)","LRFDAIEN","LRERR")
"RTN","LRBEBA2",35,0)
 Q
"RTN","LRBEBA2",36,0)
 ;
"RTN","LRBEBA2",37,0)
GDG1(LRODT,SN,IFN) ; diagnosis and indicators back to CPRS
"RTN","LRBEBA2",38,0)
 N LRBECNT,LRBEDGX,LRBESEQ,LRBEPTDT
"RTN","LRBEBA2",39,0)
 S LRBECNT=2
"RTN","LRBEBA2",40,0)
 S LRBESEQ=0 F  S LRBESEQ=$O(^LRO(69,LRODT,1,SN,2,IFN,2,LRBESEQ)) Q:LRBESEQ<1  D
"RTN","LRBEBA2",41,0)
 .S LRBEPTDT=$G(^LRO(69,LRODT,1,SN,2,IFN,2,LRBESEQ,0))
"RTN","LRBEBA2",42,0)
 .Q:'$G(LRBEPTDT)
"RTN","LRBEBA2",43,0)
 .S:$P(LRBEPTDT,"^",9)=1 ^TMP("LRX",$J,69,IFN,"LRBEDGX",1)=LRBEPTDT
"RTN","LRBEBA2",44,0)
 .S:$P(LRBEPTDT,"^",9)'=1 ^TMP("LRX",$J,69,IFN,"LRBEDGX",LRBECNT)=LRBEPTDT,LRBECNT=LRBECNT+1
"RTN","LRBEBA2",45,0)
 Q
"RTN","LRBEBA2",46,0)
 ;
"RTN","LRBEBA2",47,0)
SDG1(IFN,CTR,LRBEMSG) ; Setup the DG1 segment For CPRS
"RTN","LRBEBA2",48,0)
 N LRBEX,LRBEDGX,LRBEIEN,LRBESEQ,LRBEPTDT,LRBEXMSG
"RTN","LRBEBA2",49,0)
 S LRBESEQ="" F  S LRBESEQ=$O(^TMP("LRX",$J,69,IFN,"LRBEDGX",LRBESEQ)) Q:LRBESEQ=""  D
"RTN","LRBEBA2",50,0)
 .S LRBEPTDT=$G(^TMP("LRX",$J,69,IFN,"LRBEDGX",LRBESEQ))
"RTN","LRBEBA2",51,0)
 .S LRBEDGX=$$GET1^DIQ(80,$P(LRBEPTDT,U,1)_",",.01,"I")
"RTN","LRBEBA2",52,0)
 .S LRBEXMSG=$$GET1^DIQ(80,$P(LRBEPTDT,U,1)_",",3,"I")
"RTN","LRBEBA2",53,0)
 .S LRBEX=$P(LRBEPTDT,U,1)_"^"_LRBEXMSG_"^80^"_LRBEDGX_"^"_LRBEXMSG_"^ICD9"
"RTN","LRBEBA2",54,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="DG1|"_LRBESEQ_"||"_LRBEX_"|||||||||||||"
"RTN","LRBEBA2",55,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|1|"_$P(LRBEPTDT,U,4)
"RTN","LRBEBA2",56,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|2|"_$P(LRBEPTDT,U,5)
"RTN","LRBEBA2",57,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|3|"_$P(LRBEPTDT,U,2)
"RTN","LRBEBA2",58,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|4|"_$P(LRBEPTDT,U,6)
"RTN","LRBEBA2",59,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|5|"_$P(LRBEPTDT,U,7)
"RTN","LRBEBA2",60,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|6|"_$P(LRBEPTDT,U,8)
"RTN","LRBEBA2",61,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|7|"_$P(LRBEPTDT,U,3)
"RTN","LRBEBA2",62,0)
 Q
"RTN","LRBEBA2",63,0)
 ;
"RTN","LRBEBA2",64,0)
GMOD(LRBEAA,LRBECPT) ; Get mod
"RTN","LRBEBA2",65,0)
 ;input LRBECPT - ien to #81, not required
"RTN","LRBEBA2",66,0)
 N LRBEMOD
"RTN","LRBEBA2",67,0)
 S LRBECPT=$G(LRBECPT)
"RTN","LRBEBA2",68,0)
 S LRBEMOD=$$GMOD^LRBEBA21(LRBEAA,LRBECPT)
"RTN","LRBEBA2",69,0)
 Q LRBEMOD
"RTN","LRBEBA2",70,0)
 ;
"RTN","LRBEBA2",71,0)
GOPRO(LRODT,LRSN) ; Get the Ordering Provider
"RTN","LRBEBA2",72,0)
 N X,Y,DIC,LRBEPRO
"RTN","LRBEBA2",73,0)
 S LRBEPRO=$$GET1^DIQ(69.01,LRSN_","_LRODT_",",7,"I")
"RTN","LRBEBA2",74,0)
 I $$GET^XUA4A72(LRBEPRO,DT)<0 S LRBEPRO=0 D
"RTN","LRBEBA2",75,0)
 .S X=$$GET1^DIQ(69.9,1,617,"I")
"RTN","LRBEBA2",76,0)
 .I $$GET^XUA4A72(X,DT)>0 S LRBEPRO=X
"RTN","LRBEBA2",77,0)
 Q LRBEPRO
"RTN","LRBEBA2",78,0)
 ;
"RTN","LRBEBA2",79,0)
SACC(LRODT,LRSN,LRTN,LRSAMP,LRSPEC,LRTSTS,LRBEX) ; Set Accession 
"RTN","LRBEBA2",80,0)
 N LRBEZ
"RTN","LRBEBA2",81,0)
 D CARR(.LRBEX,.LRBEZ,LRSAMP,LRSPEC,LRTSTS)
"RTN","LRBEBA2",82,0)
 D SDG1^LRBEBA(LRODT,LRSN,LRTN,LRSAMP,LRSPEC,LRTSTS,.LRBEZ)
"RTN","LRBEBA2",83,0)
 Q
"RTN","LRBEBA2",84,0)
 ;
"RTN","LRBEBA2",85,0)
CARR(LRBEAR,LRBEARR,LRBESAMP,LRBESPEC,LRTSTS) ; Change the array to only
"RTN","LRBEBA2",86,0)
 ; the specimen that needs to go
"RTN","LRBEBA2",87,0)
 N LRBEDFN,LRBETS,LRBESMP,LRBESPC
"RTN","LRBEBA2",88,0)
 M LRBEARR=LRBEAR
"RTN","LRBEBA2",89,0)
 I '$D(DFN) S LRBEDFN=$$GET1^DIQ(63,LRDFN,.03,"I")
"RTN","LRBEBA2",90,0)
 S:$D(DFN) LRBEDFN=DFN
"RTN","LRBEBA2",91,0)
 S LRBESMP=""
"RTN","LRBEBA2",92,0)
 F  S LRBESMP=$O(LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP)) Q:LRBESMP=""  D
"RTN","LRBEBA2",93,0)
 .I LRBESAMP'=LRBESMP D  Q
"RTN","LRBEBA2",94,0)
 ..K LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP)
"RTN","LRBEBA2",95,0)
  .S LRBESPC=""
"RTN","LRBEBA2",96,0)
 .F  S LRBESPC=$O(LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC)) Q:LRBESPC=""  D
"RTN","LRBEBA2",97,0)
 ..I LRBESPEC'=LRBESPC D  Q
"RTN","LRBEBA2",98,0)
 ...K LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC)
"RTN","LRBEBA2",99,0)
 ..S LRBETS=""
"RTN","LRBEBA2",100,0)
 ..F  S LRBETS=$O(LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETS)) Q:LRBETS=""  D
"RTN","LRBEBA2",101,0)
 ...I LRBETS'=LRTSTS K LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETS)
"RTN","LRBEBA2",102,0)
 Q
"RTN","LRBEBA2",103,0)
 ;
"RTN","LRBEBA2",104,0)
BLDAR(LRBEDFN,LRODT,LRSN,LRTN,LRBESMP,LRBESPC,LRBETST,LRBEAR) ; Build array
"RTN","LRBEBA2",105,0)
 ;                                     with diagnosis and indicator info
"RTN","LRBEBA2",106,0)
 K LRBEMSG,LRBESEQ,LRBEPTDT,LRBEODT,LRBEDMSG,LRDBEDGX,LRD
"RTN","LRBEBA2",107,0)
 S LRBEODT=$P(LRODT,"."),LRBEPTDT=""
"RTN","LRBEBA2",108,0)
 S LRTN=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETST,0))
"RTN","LRBEBA2",109,0)
 Q:'$G(LRTN)
"RTN","LRBEBA2",110,0)
 S LRBESEQ=0 F  S LRBESEQ=$O(^LRO(69,LRODT,1,LRSN,2,LRTN,2,LRBESEQ)) Q:LRBESEQ<1  D
"RTN","LRBEBA2",111,0)
 . I LRBESEQ,$D(^LRO(69,LRODT,1,LRSN,2,LRTN,2,LRBESEQ,0)) S LRD=^(0) D
"RTN","LRBEBA2",112,0)
 . . S LRBEMSG=+LRD_"^^^"_$P(LRD,U,4)_U_$P(LRD,U,5)_U_$P(LRD,U,2)
"RTN","LRBEBA2",113,0)
 . . S LRBEMSG=LRBEMSG_U_$P(LRD,U,6)_U_$P(LRD,U,7)_U_$P(LRD,U,8)
"RTN","LRBEBA2",114,0)
 . . S LRBEMSG=LRBEMSG_U_$P(LRD,U,3)_U_$P(LRD,U,9)
"RTN","LRBEBA2",115,0)
 . . S LRBEDGX=+LRD
"RTN","LRBEBA2",116,0)
 . S LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,LRBEDGX)=LRBEMSG
"RTN","LRBEBA2",117,0)
 ;if test has no dx, sc/ei, then find default dx, sc/ei
"RTN","LRBEBA2",118,0)
 S LRBESEQ=$O(^LRO(69,LRODT,1,LRSN,2,LRTN,2,0)) I 'LRBESEQ D
"RTN","LRBEBA2",119,0)
 . D DEFAULT^LRBEBA4 Q:$G(LRBENO)
"RTN","LRBEBA2",120,0)
 . Q:'$G(LRDBEDGX)
"RTN","LRBEBA2",121,0)
 . S LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,LRDBEDGX)=LRBEDMSG
"RTN","LRBEBA2",122,0)
 N LRTNX,LRI,LRTNXID
"RTN","LRBEBA2",123,0)
 D BLDAR2(LRBETST,LRBETST,LRBESMP,LRBESPC)
"RTN","LRBEBA2",124,0)
 S LRI=0 F  S LRI=$O(^LAB(60,LRBETST,2,LRI)) Q:LRI<1  D
"RTN","LRBEBA2",125,0)
 . S LRTNX=+$G(^LAB(60,LRBETST,2,LRI,0)) Q:'LRTNX
"RTN","LRBEBA2",126,0)
 . S LRTNXID=$P($P(^LAB(60,LRTNX,0),U,5),";",2)
"RTN","LRBEBA2",127,0)
 . I LRTNXID="" D BLDAR2(LRBETST,LRTNX,LRBESMP,LRBESPC)
"RTN","LRBEBA2",128,0)
 Q
"RTN","LRBEBA2",129,0)
 ;
"RTN","LRBEBA2",130,0)
BLDAR2(LRBETST,XTEST,LRBESMP,LRBESPC) ;
"RTN","LRBEBA2",131,0)
 N LRTNX,LRI,DGX,LRX
"RTN","LRBEBA2",132,0)
 S LRI=0
"RTN","LRBEBA2",133,0)
 F  S LRI=$O(^LAB(60,XTEST,2,LRI)) Q:LRI<1  D
"RTN","LRBEBA2",134,0)
 . S LRTNX=+$G(^LAB(60,XTEST,2,LRI,0)) Q:'LRTNX  D
"RTN","LRBEBA2",135,0)
 . . S DGX=0 F  S DGX=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,DGX)) Q:DGX<1  D
"RTN","LRBEBA2",136,0)
 . . . S LRX=$G(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,DGX))
"RTN","LRBEBA2",137,0)
 . . . Q:'LRX
"RTN","LRBEBA2",138,0)
 . . . S LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRTNX,DGX)=LRX
"RTN","LRBEBA2",139,0)
 Q
"RTN","LRBEBA2",140,0)
 ;
"RTN","LRBEBA2",141,0)
STDN(LRODT,LRBESN,LRBETEST,LRBEAR1) ;  Test and Data Number
"RTN","LRBEBA2",142,0)
 N LRBEA,LRBEB,LRBEC,LRBED,LRBEDX,LRBEPTDT,X,Y
"RTN","LRBEBA2",143,0)
 S LRBEA="" F  S LRBEA=$O(LRBETEST(LRBEA)) Q:LRBEA=""  D
"RTN","LRBEBA2",144,0)
 .S DIC="^LRO(69,"_LRODT_","_1_","_LRBESN_","_"2,",DIC(0)="MZ"
"RTN","LRBEBA2",145,0)
 .S X=$P(LRBETEST(LRBEA),U,2) D ^DIC K DIC I +Y<1 Q
"RTN","LRBEBA2",146,0)
 .S LRBEB=0 F  S LRBEB=$O(^LRO(69,LRODT,1,LRBESN,2,+Y,2,"B",LRBEB)) Q:LRBEB<1  D
"RTN","LRBEBA2",147,0)
 ..S LRBEC=0 F  S LRBEC=$O(^LRO(69,LRODT,1,LRBESN,2,+Y,2,"B",LRBEB,LRBEC)) Q:'LRBEC  D
"RTN","LRBEBA2",148,0)
 ...S LRBED="" F  S LRBED=$O(LRBEAR1($P(LRBETEST(LRBEA),U,1),LRBED)) Q:LRBED=""  D
"RTN","LRBEBA2",149,0)
 ....S LRBEAR1($P(LRBETEST(LRBEA),U,1),LRBED,LRBEC)=LRBEB
"RTN","LRBEBA2",150,0)
 Q
"RTN","LRBEBA2",151,0)
 ;
"RTN","LRBEBA2",152,0)
SOP(LRBEDFN,LRBESB,LRBEAR1,LRBEPAN,LRBEROLL) ;Outpatient Resulting 
"RTN","LRBEBA2",153,0)
 ; Information in CIDC Array
"RTN","LRBEBA2",154,0)
 N DIC,LRBEDN,LRBESTG,LRBEDGX,LRBEEDT,LRBEEPRO,LRBEOPRO,LRBEQTY,LRBETST
"RTN","LRBEBA2",155,0)
 N LRBEPOS,LRORREFN,LRBE21
"RTN","LRBEBA2",156,0)
 ;LRBERES=Resend PCE date flag
"RTN","LRBEBA2",157,0)
 K LRBECPT S (LRBECPT,LRBEEDT,LRBEEPRO,LRBEOPRO,LRBEQTY,LRORREFN)=""
"RTN","LRBEBA2",158,0)
 S LRBEEPRO=$$GEPRO(LRAA),LRBEOPRO=$$GOPRO^LRBEBA2(LRODT,LRSN)
"RTN","LRBEBA2",159,0)
 S LRBETST=0 F  S LRBETST=$O(LRBEAR1(LRBETST)) Q:'LRBETST  D
"RTN","LRBEBA2",160,0)
 . S LRBE21=0
"RTN","LRBEBA2",161,0)
 . ;process AMA/billable panel CPT codes
"RTN","LRBEBA2",162,0)
 . I $D(LRBEPAN(LRBETST)) D EN^LRBEBA21(.LRBE21)
"RTN","LRBEBA2",163,0)
 . ;otherwise process atomic test(s) CPT codes
"RTN","LRBEBA2",164,0)
 . I 'LRBE21 D
"RTN","LRBEBA2",165,0)
 . . S LRY=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETST,0))
"RTN","LRBEBA2",166,0)
 . . Q:'LRY
"RTN","LRBEBA2",167,0)
 . . S LRY=LRY_","_LRSN_","_LRODT_","
"RTN","LRBEBA2",168,0)
 . . Q:$$GET1^DIQ(69.03,LRY,10,"I")
"RTN","LRBEBA2",169,0)
 . . I $G(ORIEN),$$GET1^DIQ(69.03,LRY,6,"I")'=ORIEN Q
"RTN","LRBEBA2",170,0)
 . . S LRBECDT=$$GET1^DIQ(69.03,LRY,22,"I")
"RTN","LRBEBA2",171,0)
 . . Q:'LRBECDT
"RTN","LRBEBA2",172,0)
 . . S LRBEDN="" F  S LRBEDN=$O(LRBEAR1(LRBETST,LRBEDN)) Q:LRBEDN=""  D SOP2
"RTN","LRBEBA2",173,0)
 . . I $D(LRBECPT)=11 S LRFDA(1,69.03,LRY,11)=1 D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA2",174,0)
 Q
"RTN","LRBEBA2",175,0)
 ;
"RTN","LRBEBA2",176,0)
SOP2 ;Process atomic test CPT code
"RTN","LRBEBA2",177,0)
 N OUT,LRBETSTX
"RTN","LRBEBA2",178,0)
 I $G(LRBESB(LRBEDN))'="" D
"RTN","LRBEBA2",179,0)
 . I $P(LRBESB(LRBEDN),U)="pending" Q
"RTN","LRBEBA2",180,0)
 . I $P(LRBESB(LRBEDN),U)="canc" Q
"RTN","LRBEBA2",181,0)
 . I '$G(LRBERES) Q:$P($G(LRBESB(LRBEDN)),U,13)
"RTN","LRBEBA2",182,0)
 . S LRBEQTY=1
"RTN","LRBEBA2",183,0)
 . D GPRO^LRBEBA4(LRBEDN,LRBECDT,LRSPEC,.LRBETSTX) I $G(LRBETSTX),$O(LRBECPT(LRBETSTX,0)) D
"RTN","LRBEBA2",184,0)
 . . D GOREF^LRBEBA21(LRODT,LRSN,LRBEDN,.LRBEAR1,.LRORREFN)
"RTN","LRBEBA2",185,0)
 . . S OUT=0 I $G(LRDFN),$G(LRIDT),$D(^LR(LRDFN,LRSS,LRIDT,$G(LRBEDN))) D
"RTN","LRBEBA2",186,0)
 . . . ;test already sent to PCE
"RTN","LRBEBA2",187,0)
 . . . I '$G(LRBERES) S OUT=$P(^LR(LRDFN,LRSS,LRIDT,$G(LRBEDN)),U,13) Q:OUT
"RTN","LRBEBA2",188,0)
 . . . ;otherwise, mark it as sent to PCE
"RTN","LRBEBA2",189,0)
 . . . S $P(^LR(LRDFN,LRSS,LRIDT,$G(LRBEDN)),U,13)=1
"RTN","LRBEBA2",190,0)
 . . ;don't continue if test already sent to PCE and not re-sending from WORK^LRBEBA4
"RTN","LRBEBA2",191,0)
 . . Q:OUT
"RTN","LRBEBA2",192,0)
 . . S LRI=0 F  S LRI=$O(LRBECPT(LRBETSTX,LRI)) Q:LRI<1  D
"RTN","LRBEBA2",193,0)
 . . . S LRBECPT=$O(LRBECPT(LRBETSTX,LRI,0))
"RTN","LRBEBA2",194,0)
 . . . S LRBEMOD=$$GMOD^LRBEBA2(LRAA,LRBECPT)
"RTN","LRBEBA2",195,0)
 . . . S LRBEPOS=$$GPOS(.LRBESB,LRBEDN)
"RTN","LRBEBA2",196,0)
 . . . D GDGX^LRBEBA21(LRBETST,LRBEDN,.LRBEAR,.LRBEAR1,.LRBEDGX)
"RTN","LRBEBA2",197,0)
 . . . S LRBESTG=LRBECPT_U_LRBEMOD_U_$G(LRBEDGX(LRBETST,1))_U_$G(LRBEDGX(LRBETST,2))_U_$G(LRBEDGX(LRBETST,3))
"RTN","LRBEBA2",198,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,4))_U_LRBECDT_U_LRBEEPRO_U_LRBEOPRO_U_LRBEQTY_U_LRBEPOS
"RTN","LRBEBA2",199,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,5))_U_$G(LRBEDGX(LRBETST,6))_U_$G(LRBEDGX(LRBETST,7))
"RTN","LRBEBA2",200,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,8))_U_LRORREFN
"RTN","LRBEBA2",201,0)
 . . . I $G(LRBECPT(LRBETSTX,LRI,LRBECPT,"COUNT")) S $P(LRBESTG,U,20)=LRBECPT(LRBETSTX,LRI,LRBECPT,"COUNT")+1
"RTN","LRBEBA2",202,0)
 . . . S LRBEAR(LRBEDFN,"LRBEDGX",LRI,LRBEDN)=LRBESTG
"RTN","LRBEBA2",203,0)
 Q
"RTN","LRBEBA2",204,0)
 ;
"RTN","LRBEBA2",205,0)
GEPRO(LRBEAA) ; Provider - Responsible Official
"RTN","LRBEBA2",206,0)
 N X,LRBEPRO
"RTN","LRBEBA2",207,0)
 S LRBEPRO=$$GET1^DIQ(68,LRBEAA_",",.1,"I")
"RTN","LRBEBA2",208,0)
 I $$GET^XUA4A72(LRBEPRO,DT)<0 S LRBEPRO=$$GET1^DIQ(69.9,1,617,"I")
"RTN","LRBEBA2",209,0)
 Q LRBEPRO
"RTN","LRBEBA2",210,0)
 ;
"RTN","LRBEBA2",211,0)
GPOS(LRBESB,LRBEDN) ; Get the Place of Service
"RTN","LRBEBA2",212,0)
 Q $P($G(LRBESB(LRBEDN)),U,9)
"RTN","LRBEBA2",213,0)
 ;
"RTN","LRBEBA2",214,0)
SLROT(LRXST,LRTEST,LRBEOT) ;LROT array
"RTN","LRBEBA2",215,0)
 D SLROT^LRBEBA3(.LRXST,.LRTEST,.LRBEOT)
"RTN","LRBEBA2",216,0)
 Q
"RTN","LRBEBA21")
0^2^B40326837^B34208057
"RTN","LRBEBA21",1,0)
LRBEBA21 ;DALOI/JAH/FHS - PROCESS PANEL CPT CODE ;8/10/04
"RTN","LRBEBA21",2,0)
 ;;5.2;LAB SERVICE;**291,359**;Sep 27, 1994
"RTN","LRBEBA21",3,0)
 ;Continued LRBEBA2
"RTN","LRBEBA21",4,0)
 ;Process panel test for CPT
"RTN","LRBEBA21",5,0)
 ;Set 13th piece of LRSB(X) to prevent double counting
"RTN","LRBEBA21",6,0)
EN(LRBE21) ;LRBEAR1(LRBETST,
"RTN","LRBEBA21",7,0)
 ;Returns LRBE21
"RTN","LRBEBA21",8,0)
 ;        0 = process as atomic test
"RTN","LRBEBA21",9,0)
 ;        1 = processed (or will be processed in future) as panel
"RTN","LRBEBA21",10,0)
 N LRI,LRY,LRTST,LRNOP,LRNP,LRPEND,LRCANC,LRBSB,LRFDA,ERR,OK
"RTN","LRBEBA21",11,0)
 N LRBECDT,LRBEEDT,LRORREFN,LRPCECNT,LRBEQTY,LRNOREQ,LRBESTG
"RTN","LRBEBA21",12,0)
 S (LRBE21,LRPCECNT,LRNP,LRNOP,LRPEND,LRCANC)=0
"RTN","LRBEBA21",13,0)
 I $D(LRBEAR1(LRBETST)) D
"RTN","LRBEBA21",14,0)
 . ;must be AMA/billable panel
"RTN","LRBEBA21",15,0)
 . Q:'($D(LRBEPAN(LRBETST)))
"RTN","LRBEBA21",16,0)
 . S LRY=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETST,0))
"RTN","LRBEBA21",17,0)
 . Q:'LRY
"RTN","LRBEBA21",18,0)
 . S LRY=LRY_","_LRSN_","_LRODT_","
"RTN","LRBEBA21",19,0)
 . ;canceled test
"RTN","LRBEBA21",20,0)
 . I $$GET1^DIQ(69.03,LRY,8,"I")="CA" K LRY Q
"RTN","LRBEBA21",21,0)
 . S LRBECDT=$$GET1^DIQ(69.03,LRY,22,"I")
"RTN","LRBEBA21",22,0)
 . I 'LRBECDT K LRY Q
"RTN","LRBEBA21",23,0)
 . I '$G(LRBERES) S LRPCECNT=$$GET1^DIQ(69.03,LRY,11,"I")
"RTN","LRBEBA21",24,0)
 . I LRPCECNT K LRY Q
"RTN","LRBEBA21",25,0)
 . S LRORREFN=$$GET1^DIQ(69.03,LRY,6,"I")
"RTN","LRBEBA21",26,0)
 . I $G(ORIEN),LRORREFN'=ORIEN K LRY Q
"RTN","LRBEBA21",27,0)
 . ;check status of atomic tests
"RTN","LRBEBA21",28,0)
 . S LRNOREQ=1
"RTN","LRBEBA21",29,0)
 . S LRBSB=0 F  S LRBSB=$O(LRBEAR1(LRBETST,LRBSB)) Q:'LRBSB  I $G(LRIDT) D
"RTN","LRBEBA21",30,0)
 . . ;check only 'required' atomic tests
"RTN","LRBEBA21",31,0)
 . . Q:'$D(LRBEAR1(LRBETST,LRBSB,"R"))
"RTN","LRBEBA21",32,0)
 . . S LRTST=+LRBEAR1(LRBETST,LRBSB,"R")
"RTN","LRBEBA21",33,0)
 . . S X=$G(LRBESB(LRBSB)) I 'LRTST S LRTST=+$P($P(X,"^",3),"!",7)
"RTN","LRBEBA21",34,0)
 . . I X="" S X=$G(^LR(LRDFN,LRSS,LRIDT,LRBSB)) S:(X'="") LRBESB(LRBSB)=X S:(X="") X="pending"
"RTN","LRBEBA21",35,0)
 . . ;check for not performed tests
"RTN","LRBEBA21",36,0)
 . . I $P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRTST,0)),U,6)="*Not Performed" S LRNP=1
"RTN","LRBEBA21",37,0)
 . . ;check for tests already sent to pce
"RTN","LRBEBA21",38,0)
 . . I $P(X,U,13)=1 S LRNOP=1 Q
"RTN","LRBEBA21",39,0)
 . . ;check for cancelled tests
"RTN","LRBEBA21",40,0)
 . . I $P(X,U,1)="canc" S LRCANC=1
"RTN","LRBEBA21",41,0)
 . . ;check for tests still pending
"RTN","LRBEBA21",42,0)
 . . I $P(X,U,1)="pending" S LRPEND=1
"RTN","LRBEBA21",43,0)
 . . S LRNOREQ=0
"RTN","LRBEBA21",44,0)
 . ;quit if any 'required' atomic tests not performed or cancelled
"RTN","LRBEBA21",45,0)
 . Q:((LRNOREQ=0)&(LRNP!LRCANC))
"RTN","LRBEBA21",46,0)
 . ;check for resulted tests in panel with no 'required' tests
"RTN","LRBEBA21",47,0)
 . S OK=0
"RTN","LRBEBA21",48,0)
 . I LRNOREQ S LRBSB=0 F  S LRBSB=$O(LRBEAR1(LRBETST,LRBSB)) Q:'LRBSB!($G(LRNP))  D
"RTN","LRBEBA21",49,0)
 . . S X=$G(LRBESB(LRBSB)),LRTST=+$P($P(X,"^",3),"!",7)
"RTN","LRBEBA21",50,0)
 . . I $P(X,U,1)'="",$P(X,U,1)'="canc",$P(X,U,1)'="pending" S OK=1
"RTN","LRBEBA21",51,0)
 . . ;check for not performed tests
"RTN","LRBEBA21",52,0)
 . . I $P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRTST,0)),U,6)="*Not Performed" S LRNP=1
"RTN","LRBEBA21",53,0)
 . ;quit if no 'required' tests on panel and no resulted tests
"RTN","LRBEBA21",54,0)
 . Q:(LRNOREQ&'OK)
"RTN","LRBEBA21",55,0)
 . ;if not roll-up to PCE, proceed to panel CPT; 
"RTN","LRBEBA21",56,0)
 . ;including case where none of atomic tests are 'required' (if results available)
"RTN","LRBEBA21",57,0)
 . I '$G(LRBEROLL) D PANEL^LRBEBA4 I $O(LRBECPT(LRBETST,0)) D
"RTN","LRBEBA21",58,0)
 . . S LRI=0 F  S LRI=$O(LRBECPT(LRBETST,LRI)) Q:LRI<1  D
"RTN","LRBEBA21",59,0)
 . . . S LRBECPT=$O(LRBECPT(LRBETST,LRI,0))
"RTN","LRBEBA21",60,0)
 . . . S LRBEMOD=$$GMOD^LRBEBA2(LRAA,LRBECPT)
"RTN","LRBEBA21",61,0)
 . . . S LRBEPOS=DUZ,LRBEQTY=1,LRBEDN=+$O(LRBEAR1(LRBETST,0))
"RTN","LRBEBA21",62,0)
 . . . D GDGX^LRBEBA21(LRBETST,LRBEDN,.LRBEAR,.LRBEAR1,.LRBEDGX)
"RTN","LRBEBA21",63,0)
 . . . S LRBESTG=LRBECPT_U_$G(LRBEMOD)_U_$G(LRBEDGX(LRBETST,1))_U_$G(LRBEDGX(LRBETST,2))_U_$G(LRBEDGX(LRBETST,3))
"RTN","LRBEBA21",64,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,4))_U_LRBECDT_U_LRBEEPRO_U_LRBEOPRO_U_LRBEQTY_U_LRBEPOS
"RTN","LRBEBA21",65,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,5))_U_$G(LRBEDGX(LRBETST,6))_U_$G(LRBEDGX(LRBETST,7))
"RTN","LRBEBA21",66,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,8))_U_LRORREFN
"RTN","LRBEBA21",67,0)
 . . . I $G(LRBECPT(LRBETST,LRI,LRBECPT,"COUNT")) S $P(LRBESTG,U,20)=LRBECPT(LRBETST,LRI,LRBECPT,"COUNT")+1
"RTN","LRBEBA21",68,0)
 . . . S LRBEAR(LRBEDFN,"LRBEDGX",LRI,LRBETST)=LRBESTG
"RTN","LRBEBA21",69,0)
 ;
"RTN","LRBEBA21",70,0)
 Q:$G(LRY)=""
"RTN","LRBEBA21",71,0)
 ;
"RTN","LRBEBA21",72,0)
 ;if PCE rollup, then 'unbundled' in SOP2^LRBEBA2
"RTN","LRBEBA21",73,0)
 I $G(LRBEROLL) D  Q
"RTN","LRBEBA21",74,0)
 . K LRBECPT(LRBETST)
"RTN","LRBEBA21",75,0)
 . ;clear 'pending panel' xref
"RTN","LRBEBA21",76,0)
 . S LRFDA(1,69.03,LRY,22.1)=0
"RTN","LRBEBA21",77,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",78,0)
 ;
"RTN","LRBEBA21",79,0)
 ;if no required tests on panel and panel CPT exists, at least one resulted atomic,
"RTN","LRBEBA21",80,0)
 ;then mark panel as processed; retain LRBECPT array for BAWRK^LRBEBA;
"RTN","LRBEBA21",81,0)
 ;set return to "1" to avoid 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",82,0)
 I $O(LRBECPT(LRBETST,0)),LRNOREQ D  Q
"RTN","LRBEBA21",83,0)
 . S LRBE21=1
"RTN","LRBEBA21",84,0)
 . D LRSB
"RTN","LRBEBA21",85,0)
 . S LRFDA(1,69.03,LRY,11)=1
"RTN","LRBEBA21",86,0)
 . ;clear 'pending panel' xref
"RTN","LRBEBA21",87,0)
 . S LRFDA(1,69.03,LRY,22.1)=0
"RTN","LRBEBA21",88,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",89,0)
 ;
"RTN","LRBEBA21",90,0)
 ;if no required tests on panel and panel has no CPT or inactive CPT,
"RTN","LRBEBA21",91,0)
 ;then return is "0" for 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",92,0)
 I '$O(LRBECPT(LRBETST,0)),LRNOREQ Q
"RTN","LRBEBA21",93,0)
 ;
"RTN","LRBEBA21",94,0)
 ;if resending (from WORK^LRBEBA4) and panel CPT determined,
"RTN","LRBEBA21",95,0)
 ;then return "1" to avoid 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",96,0)
 I $G(LRBERES)&LRNOP&('LRPEND)&($O(LRBECPT(LRBETST,0))) S LRBE21=1 Q
"RTN","LRBEBA21",97,0)
 ;
"RTN","LRBEBA21",98,0)
 ;if required atomic tests not performed, previously sent, or cancelled,
"RTN","LRBEBA21",99,0)
 ;then return is "0" for 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",100,0)
 I (LRNP!LRNOP!LRCANC) D  Q
"RTN","LRBEBA21",101,0)
 . K LRBECPT(LRBETST)
"RTN","LRBEBA21",102,0)
 . ;clear 'pending panel' xref
"RTN","LRBEBA21",103,0)
 . S LRFDA(1,69.03,LRY,22.1)=0
"RTN","LRBEBA21",104,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",105,0)
 ;
"RTN","LRBEBA21",106,0)
 ;if panel has CPT and no required atomic test still pending,
"RTN","LRBEBA21",107,0)
 ;then mark panel as processed; retain LRBECPT array for BAWRK^LRBEBA;
"RTN","LRBEBA21",108,0)
 ;set return to "1" to avoid 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",109,0)
 I $O(LRBECPT(LRBETST,0)),'LRPEND D  Q
"RTN","LRBEBA21",110,0)
 . S LRBE21=1
"RTN","LRBEBA21",111,0)
 . D LRSB
"RTN","LRBEBA21",112,0)
 . S LRFDA(1,69.03,LRY,11)=1
"RTN","LRBEBA21",113,0)
 . ;clear 'pending panel' xref
"RTN","LRBEBA21",114,0)
 . S LRFDA(1,69.03,LRY,22.1)=0
"RTN","LRBEBA21",115,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",116,0)
 ;
"RTN","LRBEBA21",117,0)
 ;if panel has no CPT or inactive CPT, but required atomic test still pending,
"RTN","LRBEBA21",118,0)
 ;then set return to "1" to avoid 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",119,0)
 I '$O(LRBECPT(LRBETST,0)),LRPEND D  Q
"RTN","LRBEBA21",120,0)
 . S LRBE21=1
"RTN","LRBEBA21",121,0)
 . ;set 'pending panel' xref
"RTN","LRBEBA21",122,0)
 . S LRFDA(1,69.03,LRY,22.1)=1
"RTN","LRBEBA21",123,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",124,0)
 ;
"RTN","LRBEBA21",125,0)
 ;if panel has CPT, but required atomic test still pending,
"RTN","LRBEBA21",126,0)
 ;then kill cpt to avoid transmission to PCE,
"RTN","LRBEBA21",127,0)
 ;set return to "1" to avoid 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",128,0)
 I $O(LRBECPT(LRBETST,0)),LRPEND D
"RTN","LRBEBA21",129,0)
 . S LRBE21=1
"RTN","LRBEBA21",130,0)
 . S LRI=$O(LRBECPT(LRBETST,0)) K LRBEAR(LRBEDFN,"LRBEDGX",LRI,LRBETST)
"RTN","LRBEBA21",131,0)
 . K LRBECPT(LRBETST)
"RTN","LRBEBA21",132,0)
 . ;set 'pending panel' xref
"RTN","LRBEBA21",133,0)
 . S LRFDA(1,69.03,LRY,22.1)=1
"RTN","LRBEBA21",134,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",135,0)
 ;
"RTN","LRBEBA21",136,0)
 Q
"RTN","LRBEBA21",137,0)
 ;
"RTN","LRBEBA21",138,0)
LRSB ;Set LRBESB(TEST) 13th piece to 1, counted as part of panel.
"RTN","LRBEBA21",139,0)
 ;Set 13th piece of LRBESB(X) to prevent double counting
"RTN","LRBEBA21",140,0)
 N LRSBX
"RTN","LRBEBA21",141,0)
 S LRSBX=0 F  S LRSBX=$O(LRBEAR1(LRBETST,LRSBX)) Q:LRSBX<1  D
"RTN","LRBEBA21",142,0)
 . I $D(LRBESB(LRSBX))#2 S $P(LRBESB(LRSBX),U,13)=1
"RTN","LRBEBA21",143,0)
 . I $G(LRIDT),$D(^LR(LRDFN,LRSS,LRIDT,LRSBX)) S $P(^(LRSBX),U,13)=1
"RTN","LRBEBA21",144,0)
 Q
"RTN","LRBEBA21",145,0)
 ;
"RTN","LRBEBA21",146,0)
GDGX(LRBETST,LRBEDN,LRBEAR,LRBEAR1,LRBEDGX) ; Set diagnosis LRBEDGX
"RTN","LRBEBA21",147,0)
 N LRBEPOV,LRBEPTDT,LRBETNUM
"RTN","LRBEBA21",148,0)
 S (LRBEPOV,LRBETNUM)=""  F  S LRBEPOV=$O(LRBEAR1(LRBETST,LRBEDN,LRBEPOV)) Q:'LRBEPOV  D
"RTN","LRBEBA21",149,0)
 . S LRBEPTDT=$G(LRBEAR1(LRBETST,LRBEDN,LRBEPOV))
"RTN","LRBEBA21",150,0)
 . S LRBETNUM=$G(LRBETNUM)+1,LRBEDGX(LRBETST,LRBETNUM)=$P(LRBEPTDT,U,1)
"RTN","LRBEBA21",151,0)
  Q:$D(LRBEDGX(LRBETST,1))
"RTN","LRBEBA21",152,0)
 N DGX S DGX=0
"RTN","LRBEBA21",153,0)
 F  S DGX=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRSAMP,LRSPEC,LRBETST,DGX)) Q:DGX<1  D
"RTN","LRBEBA21",154,0)
 . S LRBETNUM=$G(LRBETNUM)+1,LRBEDGX(LRBETST,LRBETNUM)=DGX
"RTN","LRBEBA21",155,0)
 Q
"RTN","LRBEBA21",156,0)
GOREF(LRODT,LRSN,LRBEDN,LRBEAR1,LRORREFN) ;
"RTN","LRBEBA21",157,0)
 ;Get the OERR INTERNAL FILE #
"RTN","LRBEBA21",158,0)
 N LRX1,LRBEIEN1,LRBETST
"RTN","LRBEBA21",159,0)
 S LRBETST=""
"RTN","LRBEBA21",160,0)
 F  S LRBETST=$O(LRBEAR1(LRBETST)) Q:LRBETST=""  D
"RTN","LRBEBA21",161,0)
 .Q:'$D(LRBEAR1(LRBETST,LRBEDN))
"RTN","LRBEBA21",162,0)
 .S LRX1=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETST,0))
"RTN","LRBEBA21",163,0)
 .I $G(LRX1) D  Q
"RTN","LRBEBA21",164,0)
 ..S LRBEIEN1=LRX1_","_LRSN_","_LRODT_","
"RTN","LRBEBA21",165,0)
 ..S LRORREFN=$$GET1^DIQ(69.03,LRBEIEN1,6,"I")
"RTN","LRBEBA21",166,0)
 .S LRORREFN=""
"RTN","LRBEBA21",167,0)
 Q
"RTN","LRBEBA21",168,0)
 ;
"RTN","LRBEBA21",169,0)
GMOD(LRBEAA,LRBECPT) ; Get external service modifier
"RTN","LRBEBA21",170,0)
 ;input LRBECPT - ien to #81, not required
"RTN","LRBEBA21",171,0)
 N DIC,LRBEESA,LRBEMOD,MOD,STAT,X,Y
"RTN","LRBEBA21",172,0)
 S LRBEESA=$$GET1^DIQ(68,LRBEAA_",",12,"I"),LRBEMOD=""
"RTN","LRBEBA21",173,0)
 I LRBEESA D
"RTN","LRBEBA21",174,0)
 .S X=90,DIC="^DIC(81.3,",DIC(0)="Z" D ^DIC
"RTN","LRBEBA21",175,0)
 .I +Y<0 K DIC Q
"RTN","LRBEBA21",176,0)
 .S LRBEMOD=$P(Y,U,2),MOD=+Y
"RTN","LRBEBA21",177,0)
 .;if cpt/hcpcs provided, check if modifier is valid to use
"RTN","LRBEBA21",178,0)
 .I $G(LRBECPT) D
"RTN","LRBEBA21",179,0)
 ..S STAT=$$MODP^ICPTMOD(LRBECPT,MOD,"I",DT)
"RTN","LRBEBA21",180,0)
 ..I +STAT=0 S LRBEMOD=""
"RTN","LRBEBA21",181,0)
 Q LRBEMOD
"RTN","LRBEBA3")
0^3^B62466006^B24961895
"RTN","LRBEBA3",1,0)
LRBEBA3 ;DALOI/JAH/FHS - ORDERING AND RESULTING OUTPATIENT ;8/10/04
"RTN","LRBEBA3",2,0)
 ;;5.2;LAB SERVICE;**291,359**;Sep 27, 1994
"RTN","LRBEBA3",3,0)
 ;
"RTN","LRBEBA3",4,0)
BLDAR(LRBEDFN,LRODT,LRSN,LRBEAR,LRBEY,LRBETEST,LRBEPAN,LRBEDEL) ; Build LRBEAR array with
"RTN","LRBEBA3",5,0)
 ; CIDC information
"RTN","LRBEBA3",6,0)
 N LRBEODT,LRBEIEN,LRBETST,LRBETS,LRJ,N,NX,P,X,XX,REQX,OK
"RTN","LRBEBA3",7,0)
 S LRBEAR(LRBEDFN,"DSS ID")=LROOS
"RTN","LRBEBA3",8,0)
 S LRBEAR(LRBEDFN,"ORDGX")="O"
"RTN","LRBEBA3",9,0)
 S LRBEAR(LRBEDFN,"DOS")=LRBECDT
"RTN","LRBEBA3",10,0)
 S LRBEAR(LRBEDFN,"PAT")=$G(LRBEDFN)
"RTN","LRBEBA3",11,0)
 S LRBEAR(LRBEDFN,"POS")=LROOS
"RTN","LRBEBA3",12,0)
 S LRBEAR(LRBEDFN,"DEL")=LRBEDEL
"RTN","LRBEBA3",13,0)
 S LRBEAR(LRBEDFN,"USR")=DUZ
"RTN","LRBEBA3",14,0)
 S LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEBA3",15,0)
 S LRBEAR(LRBEDFN,"ORDPRO")=$$GET1^DIQ(69.01,LRBEIEN,7,"I")
"RTN","LRBEBA3",16,0)
 S:'+$G(LRSAMP) LRSAMP=$$GET1^DIQ(69.01,LRBEIEN,3,"I")
"RTN","LRBEBA3",17,0)
 ;reset LRBETEST, LRBEY for panel tests
"RTN","LRBEBA3",18,0)
 S LRBETS="" F  S LRBETS=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETS)) Q:'LRBETS  D
"RTN","LRBEBA3",19,0)
 .S LRJ=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETS,0))
"RTN","LRBEBA3",20,0)
 .Q:($P(^LRO(69,LRODT,1,LRSN,2,LRJ,0),U,9)="CA")
"RTN","LRBEBA3",21,0)
 .I $G(ORIEN),$P(^LRO(69,LRODT,1,LRSN,2,LRJ,0),U,7)'=ORIEN Q
"RTN","LRBEBA3",22,0)
 .I ($G(^LAB(60,LRBETS,12))),($D(^LAB(60,LRBETS,0))#2),'$L($P($G(^LAB(60,LRBETS,0)),U,5)) S LRBEPAN(LRBETS)=""
"RTN","LRBEBA3",23,0)
 .S OK=0,N=0 F  S N=$O(LRBETEST(N)) Q:'N  I LRBETS=+LRBETEST(N) S OK=1
"RTN","LRBEBA3",24,0)
 .I 'OK S N=$O(LRBETEST(""),-1),N=N+1,LRBETEST(N)=LRBETS_U_^LAB(60,LRBETS,0),LRBETEST(N,"P")=LRBETS_U_$$NLT^LRVER1(LRBETS)
"RTN","LRBEBA3",25,0)
 .S NX=0 F  S NX=$O(^LAB(60,LRBETS,2,NX)) Q:'NX  D
"RTN","LRBEBA3",26,0)
 ..S X=+^LAB(60,LRBETS,2,NX,0)
"RTN","LRBEBA3",27,0)
 ..S XX=$P($P(^LAB(60,X,0),U,5),";",2),REQX=$P(^(0),U,17)
"RTN","LRBEBA3",28,0)
 ..I XX,$D(LRBESB(XX)) S P(LRBETS,XX,X)=""
"RTN","LRBEBA3",29,0)
 ..I XX,$D(LRBEPAN(LRBETS)),REQX S P(LRBETS,XX,X)="R"
"RTN","LRBEBA3",30,0)
 ..;if XX null, then possibly another panel
"RTN","LRBEBA3",31,0)
 ..I 'XX D PARRAY(X,LRBETS,.P)
"RTN","LRBEBA3",32,0)
 .;reset LRBEY array;
"RTN","LRBEBA3",33,0)
 .;1st subscript is panel test; 2nd subscript is data identifier of atomic test
"RTN","LRBEBA3",34,0)
 .I $D(P(LRBETS)) D
"RTN","LRBEBA3",35,0)
 ..;retain original LRBEY array node if atomic test exists as a separate accession
"RTN","LRBEBA3",36,0)
 ..I '$D(^LRO(68,$G(LRAA),1,$G(LRAD),1,$G(LRAN),4,LRBETS,0)) K LRBEY(LRBETS)
"RTN","LRBEBA3",37,0)
 ..S XX=0 F  S XX=$O(P(LRBETS,XX)) Q:'XX  D
"RTN","LRBEBA3",38,0)
 ...S LRBEY(LRBETS,XX)=""
"RTN","LRBEBA3",39,0)
 ...S X=$O(P(LRBETS,XX,0))
"RTN","LRBEBA3",40,0)
 ...I P(LRBETS,XX,X)="R" S LRBEY(LRBETS,XX,"R")=X
"RTN","LRBEBA3",41,0)
 ;continue
"RTN","LRBEBA3",42,0)
 S LRBETS="" F  S LRBETS=$O(LRBETEST(LRBETS)) Q:LRBETS=""  D
"RTN","LRBEBA3",43,0)
 .S LRBETST=$P(LRBETEST(LRBETS),U,1)
"RTN","LRBEBA3",44,0)
 .D BLDAR^LRBEBA2(LRBEDFN,LRODT,LRSN,LRBETS,LRSAMP,LRSPEC,LRBETST,.LRBEAR)
"RTN","LRBEBA3",45,0)
 Q
"RTN","LRBEBA3",46,0)
 ;
"RTN","LRBEBA3",47,0)
PARRAY(XTEST,PTEST,P) ;
"RTN","LRBEBA3",48,0)
 N NX,X,XX,REQX
"RTN","LRBEBA3",49,0)
 S NX=0 F  S NX=$O(^LAB(60,XTEST,2,NX)) Q:'NX  D
"RTN","LRBEBA3",50,0)
 .S X=+^LAB(60,XTEST,2,NX,0)
"RTN","LRBEBA3",51,0)
 .S XX=$P($P(^LAB(60,X,0),U,5),";",2),REQX=$P(^(0),U,17)
"RTN","LRBEBA3",52,0)
 .I XX,$D(LRBESB(XX)) S P(PTEST,XX,X)=""
"RTN","LRBEBA3",53,0)
 .I XX,$D(LRBEPAN(PTEST)),REQX S P(PTEST,XX,X)="R"
"RTN","LRBEBA3",54,0)
 Q
"RTN","LRBEBA3",55,0)
 ;
"RTN","LRBEBA3",56,0)
QRYADD(LRODT,LRSN,LRTS,LRBEDFN,LRBESMP,LRBESPC,LRBETS,LRBEX,LRBEXD) ; Query #69 for
"RTN","LRBEBA3",57,0)
 ; default LRBEDGX and SC/EI
"RTN","LRBEBA3",58,0)
 N LRBEA,LRDGX,LRDX,LRDGXD
"RTN","LRBEBA3",59,0)
 S LRDGX=0
"RTN","LRBEBA3",60,0)
 F  S LRDGX=$O(^LRO(69,LRODT,1,LRSN,2,LRTS,2,LRDGX)) Q:LRDGX<1  D
"RTN","LRBEBA3",61,0)
 .S LRDGXD=2
"RTN","LRBEBA3",62,0)
 .S LRBEPTDT=$G(^LRO(69,LRODT,1,LRSN,2,LRTS,2,LRDGX,0)) Q:'LRBEPTDT
"RTN","LRBEBA3",63,0)
 .S LRBEA=$P(LRBEPTDT,U,1)_"^^^"_$P(LRBEPTDT,U,4)_U_$P(LRBEPTDT,U,5)
"RTN","LRBEBA3",64,0)
 .S LRBEA=LRBEA_U_$P(LRBEPTDT,U,2)_U_$P(LRBEPTDT,U,6)_U_$P(LRBEPTDT,U,8)
"RTN","LRBEBA3",65,0)
 .S LRBEA=LRBEA_U_$P(LRBEPTDT,U,7)_U_$P(LRBEPTDT,U,3)
"RTN","LRBEBA3",66,0)
 .I $P(LRBEPTDT,U,9)=1 S LRBEA=LRBEA_U_$P(LRBEPTDT,U,9),LRDGXD=1
"RTN","LRBEBA3",67,0)
 .S LRBEX(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETS,$P(LRBEA,U))=LRBEA
"RTN","LRBEBA3",68,0)
 .S LRBEXD(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETS,LRDGXD,$P(LRBEA,U))=LRBEA
"RTN","LRBEBA3",69,0)
 Q
"RTN","LRBEBA3",70,0)
 ;
"RTN","LRBEBA3",71,0)
ELIG(DFN) ; Display eligibility and disabilities
"RTN","LRBEBA3",72,0)
 D ELIG^VADPT W !," Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"    SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","LRBEBA3",73,0)
 W !," Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","LRBEBA3",74,0)
 .S LRDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),LRCNT=$P(I1,"^",2)
"RTN","LRBEBA3",75,0)
 .S LRDIS=$E(LRDIS,1,55)
"RTN","LRBEBA3",76,0)
 .I LRDIS]"" W ?15,LRDIS_" - "_LRCNT_"%("_$S($P(I1,"^",3):"SC",1:"NSC")_")",!
"RTN","LRBEBA3",77,0)
 K LRDIS,LRCNT,I,I1,VAEL
"RTN","LRBEBA3",78,0)
 Q
"RTN","LRBEBA3",79,0)
 ;
"RTN","LRBEBA3",80,0)
BALROW(LRODT,LRSN,LRTEST) ; CIDC LROW
"RTN","LRBEBA3",81,0)
 N LRBEA,LRBEB,LRBEAT,LRBET,LRBESN,LRBETS,LRBETST,LRBEQT,LRBEOT,LRBEVAL
"RTN","LRBEBA3",82,0)
 S LRBEVAL=$D(^XUSEC("PROVIDER",DUZ)) Q:'LRBEVAL
"RTN","LRBEBA3",83,0)
 S LRBEVAL=$$CIDC^IBBAPI(DFN) Q:'LRBEVAL
"RTN","LRBEBA3",84,0)
 I '$D(DFN) S LRBEDFN=$$GET1^DIQ(63,LRDFN_",",.03,"I")
"RTN","LRBEBA3",85,0)
 S:$G(LRSN)="" LRSN=1
"RTN","LRBEBA3",86,0)
 D SLROT^LRBEBA3(.LRXST,.LRTEST,.LRBEOT) S:$G(LRSS)="" LRSS="CH"
"RTN","LRBEBA3",87,0)
 S LRBEAT=1,LRBEY=$$SBA^LRBEBA31(LRDFN,.LRBEX,.LRBEQT,.LRBEOT)
"RTN","LRBEBA3",88,0)
 Q
"RTN","LRBEBA3",89,0)
 ;
"RTN","LRBEBA3",90,0)
AQ1 ; Ask question from LRORD1
"RTN","LRBEBA3",91,0)
 N LRBEVAL
"RTN","LRBEBA3",92,0)
 S LRBEVAL=$D(^XUSEC("PROVIDER",DUZ)) Q:'LRBEVAL
"RTN","LRBEBA3",93,0)
 S LRBEVAL=$$CIDC^IBBAPI(DFN) Q:'LRBEVAL
"RTN","LRBEBA3",94,0)
 K LRBEODT D DT^LRX S LRBEODT=%
"RTN","LRBEBA3",95,0)
 S:$G(LRSS)="" LRSS="CH"
"RTN","LRBEBA3",96,0)
 S LRBEAT=1,LRBEY=$$SBA^LRBEBA31(LRDFN,.LRBEX,.LRBEQT,.LROT)
"RTN","LRBEBA3",97,0)
 Q
"RTN","LRBEBA3",98,0)
 ;
"RTN","LRBEBA3",99,0)
AQ2 ; from LROW2A
"RTN","LRBEBA3",100,0)
 N LRBEVAL
"RTN","LRBEBA3",101,0)
 S LRBEVAL=$$CIDC^IBBAPI(DFN) Q:'LRBEVAL
"RTN","LRBEBA3",102,0)
 D SACC^LRBEBA2(LRODT,LRSN,LRTN,LRSSP,LRSPEC,$P(LRTEST(LRI),U,1),.LRBEX)
"RTN","LRBEBA3",103,0)
 Q
"RTN","LRBEBA3",104,0)
 ;
"RTN","LRBEBA3",105,0)
SVST(ENUM,ETYP,LRODT,LRSN) ; Set the Encounter # in #69
"RTN","LRBEBA3",106,0)
 S ^LRO(69,LRODT,1,LRSN,ETYP)=ENUM
"RTN","LRBEBA3",107,0)
 Q
"RTN","LRBEBA3",108,0)
 ;
"RTN","LRBEBA3",109,0)
BALROR(LRORD) ; CIDC LRORD
"RTN","LRBEBA3",110,0)
 N LRBEA,LRBEAT,LRBEB,LRBET,LRBESN,LRBETS,LRBETST,LRBEQT,LRBEODT
"RTN","LRBEBA3",111,0)
 N LRBEOT,LRBEVAL,LRBEZ,LRBETN
"RTN","LRBEBA3",112,0)
 S LRBEVAL=$D(^XUSEC("PROVIDER",DUZ)) Q:'LRBEVAL
"RTN","LRBEBA3",113,0)
 S LRBEVAL=$$CIDC^IBBAPI(DFN) Q:'LRBEVAL
"RTN","LRBEBA3",114,0)
 I '$D(DFN) S LRBEDFN=$$GET1^DIQ(63,LRDFN_",",.03,"I")
"RTN","LRBEBA3",115,0)
 S LRBEAT=1,LRBEY=$$SBA^LRBEBA31(LRDFN,.LRBEX,.LRBEQT,.LROT)
"RTN","LRBEBA3",116,0)
 Q
"RTN","LRBEBA3",117,0)
 ;
"RTN","LRBEBA3",118,0)
SLROT(LRXST,LRTEST,LRBEOT) ;LROT array
"RTN","LRBEBA3",119,0)
 N LRBEA,LRBESMP,LRBESPC
"RTN","LRBEBA3",120,0)
 S LRBESMP="" F  S LRBESMP=$O(LRXST(LRBESMP)) Q:LRBESMP=""  D
"RTN","LRBEBA3",121,0)
 .S LRBEA="" F  S LRBEA=$O(LRXST(LRBESMP,LRBEA)) Q:LRBEA=""  D
"RTN","LRBEBA3",122,0)
 ..S LRBESPC=$P(LRXST(LRBESMP,LRBEA),U,1)
"RTN","LRBEBA3",123,0)
 ..S LRBEOT(LRBESMP,LRBESPC,LRBEA)=$P(LRTEST(LRBEA),U,1)
"RTN","LRBEBA3",124,0)
 Q
"RTN","LRBEBA3",125,0)
 ;
"RTN","LRBEBA3",126,0)
MICRO1(LRODT,LRSN,LRTST,LRCNT) ;get CIDC data for microbiology
"RTN","LRBEBA3",127,0)
 ;called from LRCAPPH1
"RTN","LRBEBA3",128,0)
 N LRBETM
"RTN","LRBEBA3",129,0)
 N AA,DX,DXCNT,FINAL,GOPRO,GEPRO,MOD,ORD,N,X
"RTN","LRBEBA3",130,0)
 S FINAL=$$FINAL^LRBEBA3(LRODT,LRSN,LRTST)
"RTN","LRBEBA3",131,0)
 I $P(FINAL,U)=0 K ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT) Q
"RTN","LRBEBA3",132,0)
 ;continue if micro test completed
"RTN","LRBEBA3",133,0)
 S DXCNT=+$O(^TMP("LRBEDX",$J,999),-1)
"RTN","LRBEBA3",134,0)
 S LRBETM=$P($G(^LRO(69,LRODT,1,LRSN,3)),U) I 'LRBETM S LRBETM=LRODT
"RTN","LRBEBA3",135,0)
 S LRBETM=$$PCETM^LRBEBAO(LRBETM)
"RTN","LRBEBA3",136,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"EVENT D/T")=LRBETM
"RTN","LRBEBA3",137,0)
 S AA=$P($P(FINAL,";",2),U,4)
"RTN","LRBEBA3",138,0)
 S GOPRO=$$GOPRO^LRBEBA2(LRODT,LRSN)
"RTN","LRBEBA3",139,0)
 S GEPRO=$$GEPRO^LRBEBA2(AA)
"RTN","LRBEBA3",140,0)
 S ^TMP("LRPXAPI",$J,"PROVIDER",1,"NAME")=GOPRO
"RTN","LRBEBA3",141,0)
 S ^TMP("LRPXAPI",$J,"PROVIDER",1,"PRIMARY")=1
"RTN","LRBEBA3",142,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"ORD PROVIDER")=GOPRO
"RTN","LRBEBA3",143,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"ENC PROVIDER")=GEPRO
"RTN","LRBEBA3",144,0)
 S ORD=$P($P(FINAL,";",2),U,7)
"RTN","LRBEBA3",145,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"ORD REFERENCE")=ORD
"RTN","LRBEBA3",146,0)
 S ^TMP("LRBEDX",$J,"ID")=LRODT_U_LRSN
"RTN","LRBEBA3",147,0)
 S N=0 F  S N=$O(^LRO(69,LRODT,1,LRSN,2,LRTST,2,N)) Q:'N  Q:N>4  D
"RTN","LRBEBA3",148,0)
 .S X=^LRO(69,LRODT,1,LRSN,2,LRTST,2,N,0)
"RTN","LRBEBA3",149,0)
 .S DXCNT=DXCNT+1,^TMP("LRBEDX",$J,DXCNT)=X
"RTN","LRBEBA3",150,0)
 .I N=1 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"DIAGNOSIS")=$P(X,U,1)
"RTN","LRBEBA3",151,0)
 .I N>1 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"DIAGNOSIS "_N)=$P(X,U,1)
"RTN","LRBEBA3",152,0)
 Q
"RTN","LRBEBA3",153,0)
 ;
"RTN","LRBEBA3",154,0)
MICRO2(LRODT,LRSN) ;setup more CIDC data for microbiology
"RTN","LRBEBA3",155,0)
 ;called from LRCAPPH1
"RTN","LRBEBA3",156,0)
 N DXCNT,EI,EIX,X
"RTN","LRBEBA3",157,0)
 S X=$G(^TMP("LRBEDX",$J,"ID"))
"RTN","LRBEBA3",158,0)
 I ($P(X,U)'=LRODT)!($P(X,U,2)'=LRSN) Q
"RTN","LRBEBA3",159,0)
 S DXCNT=+$O(^TMP("LRBEDX",$J,999),-1)
"RTN","LRBEBA3",160,0)
 Q:'DXCNT
"RTN","LRBEBA3",161,0)
 S DXCNT=0 F  S DXCNT=$O(^TMP("LRBEDX",$J,DXCNT)) Q:'DXCNT  D
"RTN","LRBEBA3",162,0)
 .S X=^TMP("LRBEDX",$J,DXCNT)
"RTN","LRBEBA3",163,0)
 .S ^TMP("LRPXAPI",$J,"DX/PL",DXCNT,"DIAGNOSIS")=$P(X,U,1)
"RTN","LRBEBA3",164,0)
 .I $P(X,U,2)'="" S ^TMP("LRPXAPI",$J,"DX/PL",DXCNT,"PL SC")=$P(X,U,2),EIX("SC")=$G(EIX("SC"))+$P(X,U,2)
"RTN","LRBEBA3",165,0)
 .I $P(X,U,3)'="" S ^TMP("LRPXAPI",$J,"DX/PL",DXCNT,"PL CV")=$P(X,U,3),EIX("CV")=$G(EIX("CV"))+$P(X,U,3)
"RTN","LRBEBA3",166,0)
 .I $P(X,U,4)'="" S ^TMP("LRPXAPI",$J,"DX/PL",DXCNT,"PL AO")=$P(X,U,4),EIX("AO")=$G(EIX("AO"))+$P(X,U,4)
"RTN","LRBEBA3",167,0)
 .I $P(X,U,5)'="" S ^TMP("LRPXAPI",$J,"DX/PL",DXCNT,"PL IR")=$P(X,U,5),EIX("IR")=$G(EIX("IR"))+$P(X,U,5)
"RTN","LRBEBA3",168,0)
 .I $P(X,U,6)'="" S ^TMP("LRPXAPI",$J,"DX/PL",DXCNT,"PL EC")=$P(X,U,6),EIX("EC")=$G(EIX("EC"))+$P(X,U,6)
"RTN","LRBEBA3",169,0)
 .I $P(X,U,7)'="" S ^TMP("LRPXAPI",$J,"DX/PL",DXCNT,"PL MST")=$P(X,U,7),EIX("MST")=$G(EIX("MST"))+$P(X,U,7)
"RTN","LRBEBA3",170,0)
 .I $P(X,U,8)'="" S ^TMP("LRPXAPI",$J,"DX/PL",DXCNT,"PL HNC")=$P(X,U,8),EIX("HNC")=$G(EIX("HNC"))+$P(X,U,8)
"RTN","LRBEBA3",171,0)
 .I $P(X,U,9) S ^TMP("LRPXAPI",$J,"DX/PL",DXCNT,"PRIMARY")=$P(X,U,9)
"RTN","LRBEBA3",172,0)
 F EI="SC","CV","AO","IR","EC","MST","HNC" D
"RTN","LRBEBA3",173,0)
 .I $G(EIX(EI))>1 S EIX(EI)=1
"RTN","LRBEBA3",174,0)
 .I $G(EIX(EI))'="" S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,EI)=EIX(EI)
"RTN","LRBEBA3",175,0)
 Q
"RTN","LRBEBA3",176,0)
 ;
"RTN","LRBEBA3",177,0)
FINAL(LRODT,LRSN,LRTST) ;is microbiology test complete/final?
"RTN","LRBEBA3",178,0)
 ;called from MICRO1 only
"RTN","LRBEBA3",179,0)
 ;returns 1_";"_<0-node of order>, if test completed
"RTN","LRBEBA3",180,0)
 ;        otherwise returns 0
"RTN","LRBEBA3",181,0)
 N AA,AI,AY,NODEO,NODEA,NOKILL,RETURN,TST,TT,X
"RTN","LRBEBA3",182,0)
 S RETURN=0,NODEA=""
"RTN","LRBEBA3",183,0)
 S NODEO=$G(^LRO(69,LRODT,1,LRSN,2,LRTST,0))
"RTN","LRBEBA3",184,0)
 S TST=$P(NODEO,U),AY=$P(NODEO,U,3),AA=$P(NODEO,U,4),AI=$P(NODEO,U,5)
"RTN","LRBEBA3",185,0)
 I TST,AA,AI,AY S NODEA=$G(^LRO(68,AA,1,AY,1,AI,4,TST,0))
"RTN","LRBEBA3",186,0)
 ;does complete date exist?
"RTN","LRBEBA3",187,0)
 I $P(NODEA,U,5) S RETURN=1_";"_NODEO
"RTN","LRBEBA3",188,0)
 I RETURN'=0 D
"RTN","LRBEBA3",189,0)
 .S $P(^LRO(69,LRODT,1,LRSN,2,LRTST,0),U,12)=1
"RTN","LRBEBA3",190,0)
 .S NOKILL=0
"RTN","LRBEBA3",191,0)
 .S TT=0 F  S TT=$O(^LRO(69,LRODT,1,LRSN,2,TT)) Q:'TT  D
"RTN","LRBEBA3",192,0)
 ..S NODEO=^LRO(69,LRODT,1,LRSN,2,TT,0),AA=$P(NODEO,U,4)
"RTN","LRBEBA3",193,0)
 ..I AA,$P(NODEO,U,12)'=1,$P($G(^LRO(68,AA,0)),U,2)="MI" S NOKILL=1
"RTN","LRBEBA3",194,0)
 .I NOKILL=0 S ^LRO(69,"AA",LRCEX,LROA)=""
"RTN","LRBEBA3",195,0)
 Q RETURN
"RTN","LRBEBA4")
0^4^B61044712^B57653585
"RTN","LRBEBA4",1,0)
LRBEBA4 ;DALOI/JAH/FHS - ORDERING AND RESULTING OUTPATIENT ;8/10/04
"RTN","LRBEBA4",2,0)
 ;;5.2;LAB SERVICE;**291,359**;Sep 27, 1994
"RTN","LRBEBA4",3,0)
 ;
"RTN","LRBEBA4",4,0)
GPRO(LRBEDN,LRBECDT,LRBESPC,LRBETST) ; Get the Procedure (CPT)
"RTN","LRBEBA4",5,0)
 ; A qualified coder will setup the CPTs in #60. The routine look for 
"RTN","LRBEBA4",6,0)
 ; CPTs by specimen, then HCPCS, and lasty, by a default.
"RTN","LRBEBA4",7,0)
 ;
"RTN","LRBEBA4",8,0)
 S X="CH;"_LRBEDN_";1",Y=$O(^LAB(60,"C",X,0))
"RTN","LRBEBA4",9,0)
 Q:+Y<0
"RTN","LRBEBA4",10,0)
 S LRBETST=+Y
"RTN","LRBEBA4",11,0)
PANEL ;Entry point for panel cpt
"RTN","LRBEBA4",12,0)
 N X,Y,DIC,LRBEIEN,LRBENLT,LRN
"RTN","LRBEBA4",13,0)
 S:$G(LRSPEC)="" LRSPEC=$G(LRBESPC)
"RTN","LRBEBA4",14,0)
 S (LRI,LRBECPT)=""
"RTN","LRBEBA4",15,0)
 ; #60 Specimen CPT
"RTN","LRBEBA4",16,0)
SP60 D GCPT(LRBETST,LRBECDT,LRSPEC) Q:$O(LRBECPT(LRBETST,0))
"RTN","LRBEBA4",17,0)
 ;HCPCS CODE
"RTN","LRBEBA4",18,0)
HCPCS D
"RTN","LRBEBA4",19,0)
 . S LRBECPT=$$GET1^DIQ(60,LRBETST_",","HCPCS CODE","I")
"RTN","LRBEBA4",20,0)
 . I LRBECPT D
"RTN","LRBEBA4",21,0)
 . . S LRBECPT=$$CPT^ICPTCOD(LRBECPT,LRBECDT)
"RTN","LRBEBA4",22,0)
 . . I '$P(LRBECPT,U,7) S LRBECPT="" Q
"RTN","LRBEBA4",23,0)
 . . S LRBECPT(LRBETST,$G(LRI)+1,$P(LRBECPT,U))="HCPCS CODE",LRI=$G(LRI)+1
"RTN","LRBEBA4",24,0)
 ;Try file #64
"RTN","LRBEBA4",25,0)
NLT Q:$O(LRBECPT(LRBETST,0))  D
"RTN","LRBEBA4",26,0)
 . N I,LRBENLT,LRX,LRN,LRNM,SUFX
"RTN","LRBEBA4",27,0)
 . S LRBENLT=$$GET1^DIQ(60,LRBETST_",",64,"I")
"RTN","LRBEBA4",28,0)
 . Q:'LRBENLT
"RTN","LRBEBA4",29,0)
 . S LRNM=$P($G(^LAM(LRBENLT,0)),U,2)
"RTN","LRBEBA4",30,0)
 . S LRNM(1)=LRNM
"RTN","LRBEBA4",31,0)
 . S SUFX=$P(LRNM,".",2)
"RTN","LRBEBA4",32,0)
 . I $G(LRCDEF),SUFX'=LRCDEF S LRNM(2)=$P(LRNM,".",1)_"."_LRCDEF
"RTN","LRBEBA4",33,0)
 . I SUFX S LRNM(3)=$P(LRNM,".",1)_"."_"0000"
"RTN","LRBEBA4",34,0)
 . S I=0 F  S I=$O(LRNM(I)) Q:'I  Q:$O(LRBECPT(LRBETST,0))  D
"RTN","LRBEBA4",35,0)
 . . S LRBENLT=$O(^LAM("C",LRNM(I)_" ",0)) Q:'LRBENLT
"RTN","LRBEBA4",36,0)
 . . S LRN=0 F  S LRN=$O(^LAM(LRBENLT,4,"AC","CPT",LRN)) Q:LRN<1  D
"RTN","LRBEBA4",37,0)
 . . . S LRX=$G(^LAM(LRBENLT,4,LRN,0)) Q:'LRX  D
"RTN","LRBEBA4",38,0)
 . . . . Q:'$P(LRX,U,3)!($P(LRX,U,3)>LRBECDT)!($P(LRX,U,4)&($P(LRX,U,4)<LRBECDT))
"RTN","LRBEBA4",39,0)
 . . . . S LRBECPT=+LRX
"RTN","LRBEBA4",40,0)
 . . . . I '$P($$CPT^ICPTCOD(LRBECPT,LRBECDT),U,7) Q
"RTN","LRBEBA4",41,0)
 . . . . S LRBECPT(LRBETST,($G(LRI)+1),LRBECPT)="WKLD CODE-"_LRNM(I),LRI=$G(LRI)+1
"RTN","LRBEBA4",42,0)
 . . . . I LRI>1,LRBECPT(LRBETST,LRI,LRBECPT)=$G(LRBECPT(LRBETST,($G(LRI)-1),LRBECPT)) D
"RTN","LRBEBA4",43,0)
 . . . . . S LRBECPT(LRBETST,($G(LRI)-1),LRBECPT,"COUNT")=+$G(LRBECPT(LRBETST,($G(LRI)-1),LRBECPT,"COUNT"))+1
"RTN","LRBEBA4",44,0)
 . . . . . K LRBECPT(LRBETST,LRI,LRBECPT) S LRI=$G(LRI)-1
"RTN","LRBEBA4",45,0)
 ;Default Site/Spec CPT
"RTN","LRBEBA4",46,0)
SPCPT Q:$O(LRBECPT(LRBETST,0))  D
"RTN","LRBEBA4",47,0)
 . S LRBECPT=$$GET1^DIQ(60,LRBETST_",","DEFAULT SITE/SPECIMEN CPT","E")
"RTN","LRBEBA4",48,0)
 . I LRBECPT D
"RTN","LRBEBA4",49,0)
 . . I '$P($$CPT^ICPTCOD(LRBECPT,LRBECDT),U,7) S LRBECPT="" Q
"RTN","LRBEBA4",50,0)
 . . S LRBECPT(LRBETST,$G(LRI)+1,LRBECPT)="DEFAULT SITE/SPECIMEN CPT",LRI=$G(LRI)+1
"RTN","LRBEBA4",51,0)
 Q
"RTN","LRBEBA4",52,0)
 ;
"RTN","LRBEBA4",53,0)
SCPT(CPT,TDAT) ; Get the CPT/HCPCS Code
"RTN","LRBEBA4",54,0)
 Q $$CPT^ICPTCOD(CPT,TDAT)
"RTN","LRBEBA4",55,0)
 ;
"RTN","LRBEBA4",56,0)
GCPT(LRBETST,LRBECDT,LRSPEC) ; Get the CPT
"RTN","LRBEBA4",57,0)
 N A,ARR,LRBEAX,LRBEIEN,LRBEAR60,X,XX
"RTN","LRBEBA4",58,0)
 S LRBEIEN=LRSPEC_","_LRBETST_",",(LRI,LRBECPT)=""
"RTN","LRBEBA4",59,0)
 D GETS^DIQ(60.01,LRBEIEN,"96*","I","LRBEAR60")
"RTN","LRBEBA4",60,0)
 S A="" F  S A=$O(LRBEAR60(60.196,A)) Q:A=""  D
"RTN","LRBEBA4",61,0)
 . Q:$G(LRBEAR60(60.196,A,1,"I"))=""
"RTN","LRBEBA4",62,0)
 . S ARR($G(LRBEAR60(60.196,A,1,"I")))=$G(LRBEAR60(60.196,A,.01,"I"))
"RTN","LRBEBA4",63,0)
 S XX=$P(LRBECDT,".",1)_"."_9999
"RTN","LRBEBA4",64,0)
 S X=$O(ARR(XX),-1) I X D
"RTN","LRBEBA4",65,0)
 .S LRBEAX=ARR(X)
"RTN","LRBEBA4",66,0)
 .S LRBEAX=$$CPT^ICPTCOD(LRBEAX,LRBECDT)
"RTN","LRBEBA4",67,0)
 .Q:'$P(LRBEAX,U,7)
"RTN","LRBEBA4",68,0)
 .S LRBECPT(LRBETST,($G(LRI)+1),$P(LRBEAX,U))="SPECIMEN CPT",LRI=$G(LRI)+1
"RTN","LRBEBA4",69,0)
 Q
"RTN","LRBEBA4",70,0)
 ;
"RTN","LRBEBA4",71,0)
UPDOR(DFN,ORITEM,ORIEN,ORDX,ORSCEI) ; Update CIDC information from OERR
"RTN","LRBEBA4",72,0)
 I $G(^XTMP("LRPCELOG",0)) D
"RTN","LRBEBA4",73,0)
 . N LRLNOW,LRI
"RTN","LRBEBA4",74,0)
 . F  S LRLNOW=$$NOW^XLFDT Q:'$D(^XTMP("LRPCELOG",3,LRLNOW))
"RTN","LRBEBA4",75,0)
 . S ^XTMP("LRPCELOG",3,LRLNOW)=DFN_U_ORITEM_U_ORIEN_U_"["_ORSCEI_"]"
"RTN","LRBEBA4",76,0)
 . S LRI=0 F  S LRI=$O(ORDX(LRI)) Q:LRI=""  D
"RTN","LRBEBA4",77,0)
 . . S ^XTMP("LRPCELOG",3,LRLNOW,"ORDX",LRI)=ORDX(LRI)
"RTN","LRBEBA4",78,0)
 I $S('$O(ORDX(0)):1,ORSCEI="^^^^^":1,1:0) Q "O^No Diagnosis Entered"
"RTN","LRBEBA4",79,0)
 N LRBEAR,LRBEDFN,LRDFN,LRBEIEN,LRODT,LRORD,LRSN,LRBERMS,LRBETN,LRBETYP
"RTN","LRBEBA4",80,0)
 N LRBEVST,LRAA,LRLLOC,LRSAMP,LRSPEC,LRSB,LRBEY
"RTN","LRBEBA4",81,0)
 S LRBERMS=1,LRORD=$P(ORITEM,";",1),LRODT=$P(ORITEM,";",2)
"RTN","LRBEBA4",82,0)
 S LRSN=$P(ORITEM,";",3),LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEBA4",83,0)
 S (LRBEDFN,LRDFN)=$$GET1^DIQ(69.01,LRBEIEN,.01,"I")
"RTN","LRBEBA4",84,0)
 S LRSAMP=$$GET1^DIQ(69.01,LRBEIEN,3,"I")
"RTN","LRBEBA4",85,0)
 S LRLLOC=$$GET1^DIQ(69.01,LRBEIEN,8,"I")
"RTN","LRBEBA4",86,0)
 S LRSPEC=$$GET1^DIQ(69.02,"1,"_LRBEIEN,.01,"I") S:LRSPEC="" LRSPEC=72
"RTN","LRBEBA4",87,0)
 I LRORD'=$$GET1^DIQ(69.01,LRBEIEN,9.5,"I") D  Q LRBERMS
"RTN","LRBEBA4",88,0)
 .S LRBERMS="0^"_$$EMSG(1)
"RTN","LRBEBA4",89,0)
 I DFN'=$$GET1^DIQ(63,LRBEDFN_",",.03,"I") D  Q LRBERMS
"RTN","LRBEBA4",90,0)
 .S LRBERMS="0^"_$$EMSG(2)
"RTN","LRBEBA4",91,0)
 S LRBEVST=$P($G(^LRO(69,LRODT,1,LRSN,"PCE")),";",1) D WORK
"RTN","LRBEBA4",92,0)
 Q LRBERMS
"RTN","LRBEBA4",93,0)
 ;
"RTN","LRBEBA4",94,0)
WORK ; Enter the updated information into file
"RTN","LRBEBA4",95,0)
 N LRBEFND,LRBETNM,LRBETST,LRBEZ,LRBERES
"RTN","LRBEBA4",96,0)
 S (LRBETN,LRBEFND)=0
"RTN","LRBEBA4",97,0)
 F  S LRBETN=$O(^LRO(69,LRODT,1,LRSN,2,LRBETN)) Q:LRBETN=""!('LRBETN)  D
"RTN","LRBEBA4",98,0)
 .Q:ORIEN'=$$GET1^DIQ(69.03,LRBETN_","_LRBEIEN,6,"I")
"RTN","LRBEBA4",99,0)
 .S:'LRBEFND LRBEFND=1 S LRAA=""
"RTN","LRBEBA4",100,0)
 .S LRBETST=$$GET1^DIQ(69.03,LRBETN_","_LRBEIEN,.01,"I")
"RTN","LRBEBA4",101,0)
 .S LRBETNM=$$GET1^DIQ(60,LRBETST_",",.01,"I")
"RTN","LRBEBA4",102,0)
 .S LRBEZ(LRBETN)=LRBETST_"^"_LRBETNM K LRBEAR
"RTN","LRBEBA4",103,0)
 .D BLRSB(.LRSB,LRBETN_","_LRBEIEN,LRBETST,.LRBEY)
"RTN","LRBEBA4",104,0)
 .D KILL(LRODT,LRSN,LRBETN),SET(DFN,.ORDX,ORSCEI)
"RTN","LRBEBA4",105,0)
 .D SDG1(LRODT,LRSN,LRBETN,DFN,.LRBEAR)
"RTN","LRBEBA4",106,0)
 I 'LRBEFND S LRBERMS="0^"_$$EMSG(3) Q
"RTN","LRBEBA4",107,0)
 I LRBEVST'="",LRAA'="" S LRBERES=1 D BAWRK^LRBEBA(LRODT,LRSN,1,.LRBEY,.LRBEZ,"",LRBEVST,"",ORIEN)
"RTN","LRBEBA4",108,0)
 Q
"RTN","LRBEBA4",109,0)
 ;
"RTN","LRBEBA4",110,0)
KILL(LRBEODT,LRBESN,LRBETN) ; Kill the existing DGX and SC/EI
"RTN","LRBEBA4",111,0)
 N DA,DIK
"RTN","LRBEBA4",112,0)
 S DA(1)=LRBETN,DA(2)=LRSN,DA(3)=LRODT
"RTN","LRBEBA4",113,0)
 S DA="" F  S DA=$O(^LRO(69,DA(3),1,DA(2),2,DA(1),2,DA)) Q:DA=""  D
"RTN","LRBEBA4",114,0)
 .S DIK="^LRO(69,"_DA(3)_","_1_","_DA(2)_","_2_","_DA(1)_","_2_","
"RTN","LRBEBA4",115,0)
 .D ^DIK
"RTN","LRBEBA4",116,0)
 Q
"RTN","LRBEBA4",117,0)
 ;
"RTN","LRBEBA4",118,0)
SET(DFN,ORDX,ORSCEI) ; Set #69 with new DGX and SC/EI
"RTN","LRBEBA4",119,0)
 N LRBEA
"RTN","LRBEBA4",120,0)
 S LRBEA="" F  S LRBEA=$O(ORDX(LRBEA)) Q:LRBEA=""  D
"RTN","LRBEBA4",121,0)
 .S LRBEAR(DFN,"LRBEDGX",LRBEA,$G(ORDX(LRBEA)))="^^^"_ORSCEI
"RTN","LRBEBA4",122,0)
 .S:LRBEA=1 $P(LRBEAR(DFN,"LRBEDGX",LRBEA,$G(ORDX(LRBEA))),U,11)=1
"RTN","LRBEBA4",123,0)
 Q
"RTN","LRBEBA4",124,0)
 ;
"RTN","LRBEBA4",125,0)
SDG1(LRODT,LRSN,LRBETN,DFN,LRBEAR) ; Set the diagnois 
"RTN","LRBEBA4",126,0)
 ;                             and indicators file #69
"RTN","LRBEBA4",127,0)
 N LRBEA,LRBEFIL,LRBEIEN,LRFDA,LRFDAIEN,LRERR,LRBEPDGX,LRBETNUM
"RTN","LRBEBA4",128,0)
 S LRBEFIL=69.05,LRBETNUM=$O(^LRO(69,LRODT,1,LRSN,2,LRBETN,2,""),-1)+1
"RTN","LRBEBA4",129,0)
 S LRBEA="" F  S LRBEA=$O(LRBEAR(DFN,"LRBEDGX",LRBEA)) Q:LRBEA=""  D
"RTN","LRBEBA4",130,0)
 .S LRBEPDGX=""
"RTN","LRBEBA4",131,0)
 .F  S LRBEPDGX=$O(LRBEAR(DFN,"LRBEDGX",LRBEA,LRBEPDGX)) Q:LRBEPDGX=""  D
"RTN","LRBEBA4",132,0)
 ..S LRBEPTDT=$G(LRBEAR(DFN,"LRBEDGX",LRBEA,LRBEPDGX))
"RTN","LRBEBA4",133,0)
 ..S LRBEIEN="+"_LRBETNUM_","_LRBETN_","_LRSN_","_LRODT_","
"RTN","LRBEBA4",134,0)
 ..S LRFDAIEN(LRBETNUM)=LRBETNUM,LRFDA(99,LRBEFIL,LRBEIEN,.01)=LRBEPDGX
"RTN","LRBEBA4",135,0)
 ..S:$P(LRBEPTDT,U,6)'="" LRFDA(99,LRBEFIL,LRBEIEN,1)=$P(LRBEPTDT,U,6)
"RTN","LRBEBA4",136,0)
 ..S:$P(LRBEPTDT,U,10)'="" LRFDA(99,LRBEFIL,LRBEIEN,2)=$P(LRBEPTDT,U,10)
"RTN","LRBEBA4",137,0)
 ..S:$P(LRBEPTDT,U,4)'="" LRFDA(99,LRBEFIL,LRBEIEN,3)=$P(LRBEPTDT,U,4)
"RTN","LRBEBA4",138,0)
 ..S:$P(LRBEPTDT,U,5)'="" LRFDA(99,LRBEFIL,LRBEIEN,4)=$P(LRBEPTDT,U,5)
"RTN","LRBEBA4",139,0)
 ..S:$P(LRBEPTDT,U,7)'="" LRFDA(99,LRBEFIL,LRBEIEN,5)=$P(LRBEPTDT,U,7)
"RTN","LRBEBA4",140,0)
 ..S:$P(LRBEPTDT,U,8)'="" LRFDA(99,LRBEFIL,LRBEIEN,6)=$P(LRBEPTDT,U,8)
"RTN","LRBEBA4",141,0)
 ..S:$P(LRBEPTDT,U,9)'="" LRFDA(99,LRBEFIL,LRBEIEN,7)=$P(LRBEPTDT,U,9)
"RTN","LRBEBA4",142,0)
 ..S:$P(LRBEPTDT,U,11)=1 LRFDA(99,LRBEFIL,LRBEIEN,8)=1         ;Is Primary?
"RTN","LRBEBA4",143,0)
 ..S LRBETNUM=LRBETNUM+1
"RTN","LRBEBA4",144,0)
 D UPDATE^DIE("","LRFDA(99)","LRFDAIEN","LRERR")
"RTN","LRBEBA4",145,0)
 Q
"RTN","LRBEBA4",146,0)
 ;
"RTN","LRBEBA4",147,0)
EMSG(LRBETYP) ; Return Error Message
"RTN","LRBEBA4",148,0)
 N LRBEEMS,LRBETYPN
"RTN","LRBEBA4",149,0)
 S:LRBETYP=1 LRBETYPN="Order Number" S:LRBETYP=2 LRBETYPN="DFN"
"RTN","LRBEBA4",150,0)
 S:LRBETYP=3 LRBETYPN="Orderable Item"
"RTN","LRBEBA4",151,0)
 S LRBEEMS="Possible reasons for failure is the "_LRBETYPN_" did not match."
"RTN","LRBEBA4",152,0)
 Q LRBEEMS
"RTN","LRBEBA4",153,0)
 ;
"RTN","LRBEBA4",154,0)
BLRSB(LRSB,LRBEIENT,LRBETST,LRBEY) ; Build the LRSB global
"RTN","LRBEBA4",155,0)
 N LRBESS,LRBEIDT,LRBESB,LRBEAA,LRBEAD,LRBEAN,LRBEIEN2,LRBET,NX,XX
"RTN","LRBEBA4",156,0)
 S (LRAD,LRBEAD)=$$GET1^DIQ(69.03,LRBEIENT,2,"I")
"RTN","LRBEBA4",157,0)
 S (LRAA,LRBEAA)=$$GET1^DIQ(69.03,LRBEIENT,3,"I") Q:LRAA=""
"RTN","LRBEBA4",158,0)
 S (LRAN,LRBEAN)=$$GET1^DIQ(69.03,LRBEIENT,4,"I")
"RTN","LRBEBA4",159,0)
 S LRBEIEN2=LRBEAN_","_LRBEAD_","_LRBEAA_","
"RTN","LRBEBA4",160,0)
 S (LRSS,LRBESS)=$$GET1^DIQ(68,LRBEAA_",",.02,"I")
"RTN","LRBEBA4",161,0)
 S (LRIDT,LRBEIDT)=$$GET1^DIQ(68.02,LRBEIEN2,13.5,"I")
"RTN","LRBEBA4",162,0)
 S XX=$P($P(^LAB(60,LRBETST,0),U,5),";",2) I XX D
"RTN","LRBEBA4",163,0)
 .S LRSB(XX)=$G(^LR(LRDFN,LRSS,LRIDT,XX))
"RTN","LRBEBA4",164,0)
 .I LRSB(XX)="" K LRSB(XX) Q
"RTN","LRBEBA4",165,0)
 .I "pending^canc"[$P(LRSB(XX),U,1) K LRSB(XX) Q
"RTN","LRBEBA4",166,0)
 .S LRBEY(LRBETST,XX)=""
"RTN","LRBEBA4",167,0)
 S NX=0 F  S NX=$O(^LAB(60,LRBETST,2,NX)) Q:'NX  D
"RTN","LRBEBA4",168,0)
 .S LRBET=+^LAB(60,LRBETST,2,NX,0)
"RTN","LRBEBA4",169,0)
 .S XX=$P($P(^LAB(60,LRBET,0),U,5),";",2) I XX D
"RTN","LRBEBA4",170,0)
 ..S LRSB(XX)=$G(^LR(LRDFN,LRSS,LRIDT,XX))
"RTN","LRBEBA4",171,0)
 ..I LRSB(XX)="" K LRSB(XX) Q
"RTN","LRBEBA4",172,0)
 ..I "pending^canc"[$P(LRSB(XX),U,1) K LRSB(XX) Q
"RTN","LRBEBA4",173,0)
 ..S LRBEY(LRBETST,XX)=""
"RTN","LRBEBA4",174,0)
 Q
"RTN","LRBEBA4",175,0)
 ;
"RTN","LRBEBA4",176,0)
CHKINP(LRDFN,LRBEDAT) ; Check for Inpatient Status)
"RTN","LRBEBA4",177,0)
 N VAIN,VAINDT
"RTN","LRBEBA4",178,0)
 I '$G(DFN) D
"RTN","LRBEBA4",179,0)
 . S DFN=$$GET1^DIQ(63,LRDFN_",",.03,"I")
"RTN","LRBEBA4",180,0)
 . S LRDPF=$$GET1^DIQ(63,LRDFN_",",.02,"I")
"RTN","LRBEBA4",181,0)
 I $G(LRDPF)'=2 Q 0
"RTN","LRBEBA4",182,0)
 S VAINDT=LRBEDAT D INP^VADPT
"RTN","LRBEBA4",183,0)
 Q $G(VAIN(1))
"RTN","LRBEBA4",184,0)
 ;
"RTN","LRBEBA4",185,0)
RFLX() ; Ask the Reflex Question
"RTN","LRBEBA4",186,0)
 N DIR,DUOUT,DTOUT,DIRUT,Y
"RTN","LRBEBA4",187,0)
 S DIR("A")="Is this a Reflex Test? (Y/N): "
"RTN","LRBEBA4",188,0)
 S DIR(0)="YA" D ^DIR
"RTN","LRBEBA4",189,0)
 I $D(DIRUT)!($D(DUOUT)!$D(DTOUT)) Q -1
"RTN","LRBEBA4",190,0)
 Q +Y
"RTN","LRBEBA4",191,0)
 ;
"RTN","LRBEBA4",192,0)
DEFAULT ;Set Default diagnosis
"RTN","LRBEBA4",193,0)
 N LRD,LRI,LRX,LRY,LRD
"RTN","LRBEBA4",194,0)
 S (LRBEDMSG,LRDBEDGX)=""
"RTN","LRBEBA4",195,0)
 S LRI=$O(^LRO(69,LRODT,1,LRSN,2,1,2,0)) Q:LRI<1
"RTN","LRBEBA4",196,0)
 S LRD=$G(^LRO(69,LRODT,1,LRSN,2,1,2,LRI,0))
"RTN","LRBEBA4",197,0)
 Q:'LRD
"RTN","LRBEBA4",198,0)
 S LRDBEDGX=+LRD
"RTN","LRBEBA4",199,0)
 S LRBEDMSG=+LRD_"^^^"_$P(LRD,U,4)_U_$P(LRD,U,5)_U_$P(LRD,U,2)
"RTN","LRBEBA4",200,0)
 S LRBEDMSG=LRBEDMSG_U_$P(LRD,U,6)_U_$P(LRD,U,7)_U_$P(LRD,U,8)
"RTN","LRBEBA4",201,0)
 S LRBEDMSG=LRBEDMSG_U_$P(LRD,U,3)_U_$P(LRD,U,9)
"RTN","LRBEBA4",202,0)
 W:$G(LRDBUG) !,LRBEDMSG
"RTN","LRBEBA4",203,0)
 Q
"RTN","LRBEBAO")
0^5^B71311928^B68648424
"RTN","LRBEBAO",1,0)
LRBEBAO ;DALOI/JAH/FHS - ORDERING AND RESULTING FOR OUTPATIENTS ;8/10/04
"RTN","LRBEBAO",2,0)
 ;;5.2;LAB SERVICE;**291,359**;Sep 27, 1994
"RTN","LRBEBAO",3,0)
 ;
"RTN","LRBEBAO",4,0)
 ; This routine contains the subroutines that get the diagnosis pointers
"RTN","LRBEBAO",5,0)
 ; and indicators at order entry and result verification for outpatient.
"RTN","LRBEBAO",6,0)
 ;
"RTN","LRBEBAO",7,0)
 ; Reference to EN^DDIOL supported by IA #10142
"RTN","LRBEBAO",8,0)
 ; Reference to ^DIC supported by IA #10006
"RTN","LRBEBAO",9,0)
 ; Reference to $$GET1^DIQ supported by IA #2056
"RTN","LRBEBAO",10,0)
 ; Reference to ^DIR supported by IA #10026
"RTN","LRBEBAO",11,0)
 ; Reference to ^ICD9 supported by IA #10082
"RTN","LRBEBAO",12,0)
 ; Reference to ^DIC(9.4 supported by IA #10048
"RTN","LRBEBAO",13,0)
 ; Reference to ^DIC(81.3 supported by IA #2816
"RTN","LRBEBAO",14,0)
 ;
"RTN","LRBEBAO",15,0)
OPORD ; Outpatient Order Entry
"RTN","LRBEBAO",16,0)
 ;
"RTN","LRBEBAO",17,0)
 ; Input:
"RTN","LRBEBAO",18,0)
 ;  LRBEDFN    - Patient's DFN (#2)
"RTN","LRBEBAO",19,0)
 ;  LRBESMP    - Sample
"RTN","LRBEBAO",20,0)
 ;  LRBESPC    - Specimen
"RTN","LRBEBAO",21,0)
 ;  LRBETST    - Ordered Test
"RTN","LRBEBAO",22,0)
 ;  LRBEDGX    - Pointer to Diagnosis (#80)
"RTN","LRBEBAO",23,0)
 ;  LRBEAR(LRBEDFN,"DOS")      - Date of Service
"RTN","LRBEBAO",24,0)
 ;  LRBEAR(LRBEDFN,"PAT")      - Patient DFN (#2)
"RTN","LRBEBAO",25,0)
 ;  LRBEAR(LRBEDFN,"POS")      - Place of Service
"RTN","LRBEBAO",26,0)
 ;  LRBEAR(LRBEDFN,"ORDGX")    - Ordering or Resulting Diagnosis
"RTN","LRBEBAO",27,0)
 ;  LRBEAR(LRBEDFN,"USR")      - User
"RTN","LRBEBAO",28,0)
 ;  LRBEAR(LRBEDFN,"ORDPRO")    - Ordering Provider
"RTN","LRBEBAO",29,0)
 ;  LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,LRBEDGX)
"RTN","LRBEBAO",30,0)
 ;   Piece     Desc
"RTN","LRBEBAO",31,0)
 ;   -----     ---------------------------------
"RTN","LRBEBAO",32,0)
 ;   1     -   Diagnosis
"RTN","LRBEBAO",33,0)
 ;   2     -   Unused (blank)
"RTN","LRBEBAO",34,0)
 ;   3     -   Textual Description of  Diagnosis
"RTN","LRBEBAO",35,0)
 ;   4     -   Agent Orange
"RTN","LRBEBAO",36,0)
 ;   5     -   Ionizing Radiation
"RTN","LRBEBAO",37,0)
 ;   6     -   Service Connected Indicator
"RTN","LRBEBAO",38,0)
 ;   7     -   Environmental Contaminamts
"RTN","LRBEBAO",39,0)
 ;   8     -   MST (Military Sexual Tramua)
"RTN","LRBEBAO",40,0)
 ;   9     -   Head and Neck Cancer
"RTN","LRBEBAO",41,0)
 ;   10    -   Combat Veteran
"RTN","LRBEBAO",42,0)
 ;
"RTN","LRBEBAO",43,0)
 ; Output:
"RTN","LRBEBAO",44,0)
 ;  LRBEAR1(VISIT,TST,LRBEPOV)=LRBEDGX
"RTN","LRBEBAO",45,0)
 ;   VISIT      -  Pointer to VISIT (9000010) file
"RTN","LRBEBAO",46,0)
 ;   TST        -  Ordered Test
"RTN","LRBEBAO",47,0)
 ;   LRBEPOV        -  Pointer to V POV (#9000010.07) file
"RTN","LRBEBAO",48,0)
 ;   LRBEDGX        -  Pointer to Diagnosis (#80)
"RTN","LRBEBAO",49,0)
EN ;
"RTN","LRBEBAO",50,0)
 D INIT
"RTN","LRBEBAO",51,0)
 S SUB1="ENCOUNTER",SUB2="DX/PL",SUB3="PROVIDER"
"RTN","LRBEBAO",52,0)
 S LRBEDFN="" F  S LRBEDFN=$O(LRBEAR(LRBEDFN)) Q:LRBEDFN=""  D
"RTN","LRBEBAO",53,0)
 .S LRBETM=$S($P($G(LRBECDT),".",2):LRBECDT,$G(LRCDT):LRCDT,1:DT)
"RTN","LRBEBAO",54,0)
 .S LRBETM=$$PCETM(LRBETM)
"RTN","LRBEBAO",55,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"ENC D/T")=LRBETM
"RTN","LRBEBAO",56,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"DSS ID")=LROOS
"RTN","LRBEBAO",57,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"HOS LOC")=$G(LRBEAR(LRBEDFN,"POS"))
"RTN","LRBEBAO",58,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"PATIENT")=$G(LRBEAR(LRBEDFN,"PAT"))
"RTN","LRBEBAO",59,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"SERVICE CATEGORY")="X"
"RTN","LRBEBAO",60,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"ENCOUNTER TYPE")="A"
"RTN","LRBEBAO",61,0)
 .S ^TMP("LRPXAPI",$J,SUB3,1,"NAME")=$G(LRBEAR(LRBEDFN,"ORDPRO"))
"RTN","LRBEBAO",62,0)
 .S ^TMP("LRPXAPI",$J,SUB3,1,"PRIMARY")=1
"RTN","LRBEBAO",63,0)
 .I $G(LRBEAR(LRBEDFN,"DEL")) D
"RTN","LRBEBAO",64,0)
 ..S ^TMP("LRPXAPI",$J,SUB1,1,"DELETE")=$G(LRBEAR(LRBEDFN,"DEL"))
"RTN","LRBEBAO",65,0)
 .S LRBESMP=""
"RTN","LRBEBAO",66,0)
 .F  S LRBESMP=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP)) Q:LRBESMP=""  D
"RTN","LRBEBAO",67,0)
 ..S LRBESPC=""
"RTN","LRBEBAO",68,0)
 ..F  S LRBESPC=+$O(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC)) Q:LRBESPC<1  D
"RTN","LRBEBAO",69,0)
 ...D OPWRK
"RTN","LRBEBAO",70,0)
 Q
"RTN","LRBEBAO",71,0)
 ;
"RTN","LRBEBAO",72,0)
OPWRK ; More Outpatient Work
"RTN","LRBEBAO",73,0)
 N X,XX,B,BG,N,DX,LRBEDIA
"RTN","LRBEBAO",74,0)
 ;get all primary (n=1) and secondary (n=2) dx
"RTN","LRBEBAO",75,0)
 S LRBETST="" F  S LRBETST=$O(LRBECPT(LRBETST)) Q:'LRBETST  D
"RTN","LRBEBAO",76,0)
 . S LRBETNUM=0 F  S LRBETNUM=$O(LRBECPT(LRBETST,LRBETNUM)) Q:LRBETNUM<1  D
"RTN","LRBEBAO",77,0)
 . . S LRBEDGX=""
"RTN","LRBEBAO",78,0)
 . . F  S LRBEDGX=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,LRBEDGX)) Q:LRBEDGX=""  D
"RTN","LRBEBAO",79,0)
 . . . S LRBEPTDT=$G(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,LRBEDGX))
"RTN","LRBEBAO",80,0)
 . . . S N=$S($P(LRBEPTDT,U,11):1,1:2),X=$P(LRBEPTDT,U,4,10)
"RTN","LRBEBAO",81,0)
 . . . ;collapse indicators for same dx
"RTN","LRBEBAO",82,0)
 . . . S XX=$G(DX(N,LRBEDGX))
"RTN","LRBEBAO",83,0)
 . . . F B=1:1:7 I $P(XX,U,B)'=1,$P(X,U,B)'="" S $P(XX,U,B)=$P(X,U,B)
"RTN","LRBEBAO",84,0)
 . . . S DX(N,LRBEDGX)=XX
"RTN","LRBEBAO",85,0)
 ;set primary dx in PCE array
"RTN","LRBEBAO",86,0)
 S LRBEDGX=""
"RTN","LRBEBAO",87,0)
 F  S LRBEDGX=$O(DX(1,LRBEDGX)) Q:LRBEDGX=""  D
"RTN","LRBEBAO",88,0)
 . S LRBEDIA=$G(LRBEDIA)+1,XX=DX(1,LRBEDGX)
"RTN","LRBEBAO",89,0)
 . S ^TMP("LRPXAPI",$J,SUB2,LRBEDIA,"DIAGNOSIS")=LRBEDGX
"RTN","LRBEBAO",90,0)
 . S ^TMP("LRPXAPI",$J,SUB2,LRBEDIA,"PRIMARY")=1
"RTN","LRBEBAO",91,0)
 . F B=1:1:7 I $P(XX,U,B)'="" D
"RTN","LRBEBAO",92,0)
 . . S BG=$$GETT(B)
"RTN","LRBEBAO",93,0)
 . . I '$G(^TMP("LRPXAPI",$J,SUB2,LRBEDIA,BG)) S ^TMP("LRPXAPI",$J,SUB2,LRBEDIA,BG)=$P(XX,U,B)
"RTN","LRBEBAO",94,0)
 . . ;collapse dx indicators into encounter node
"RTN","LRBEBAO",95,0)
 . . I '$G(^TMP("LRPXAPI",$J,SUB1,1,$P(BG," ",2))) S ^TMP("LRPXAPI",$J,SUB1,1,$P(BG," ",2))=$P(XX,U,B)
"RTN","LRBEBAO",96,0)
 ;set secondary dx in PCE array
"RTN","LRBEBAO",97,0)
 S LRBEDGX=""
"RTN","LRBEBAO",98,0)
 F  S LRBEDGX=$O(DX(2,LRBEDGX)) Q:LRBEDGX=""  D
"RTN","LRBEBAO",99,0)
 . S LRBEDIA=$G(LRBEDIA)+1,XX=DX(2,LRBEDGX)
"RTN","LRBEBAO",100,0)
 . S ^TMP("LRPXAPI",$J,SUB2,LRBEDIA,"DIAGNOSIS")=LRBEDGX
"RTN","LRBEBAO",101,0)
 . F B=1:1:7 I $P(XX,U,B)'="" D
"RTN","LRBEBAO",102,0)
 . . S BG=$$GETT(B)
"RTN","LRBEBAO",103,0)
 . . I '$G(^TMP("LRPXAPI",$J,SUB2,LRBEDIA,BG)) S ^TMP("LRPXAPI",$J,SUB2,LRBEDIA,BG)=$P(XX,U,B)
"RTN","LRBEBAO",104,0)
 . . ;collapse dx indicators into encounter node
"RTN","LRBEBAO",105,0)
 . . I '$G(^TMP("LRPXAPI",$J,SUB1,1,$P(BG," ",2))) S ^TMP("LRPXAPI",$J,SUB1,1,$P(BG," ",2))=$P(XX,U,B)
"RTN","LRBEBAO",106,0)
 Q
"RTN","LRBEBAO",107,0)
 ;
"RTN","LRBEBAO",108,0)
GETT(X) ; Indicators for ^TMP
"RTN","LRBEBAO",109,0)
 I '+X Q ""
"RTN","LRBEBAO",110,0)
 Q "PL "_$S(X=1:"AO",X=2:"IR",X=3:"SC",X=4:"EC",X=5:"MST",X=6:"HNC",1:"CV")
"RTN","LRBEBAO",111,0)
 ;
"RTN","LRBEBAO",112,0)
OPRES(LRBEAR,LRBEAR1,LRODT,LRSN,LRBEVST) ; Outpatient Final Resulting
"RTN","LRBEBAO",113,0)
 ; Inputs:
"RTN","LRBEBAO",114,0)
 ;  LRBEDN    -  Data Number of Test in #63 field 400
"RTN","LRBEBAO",115,0)
 ;  LRBEAR(LRBEDFN,"VST")     -  Patient's Encounter Number #9000010
"RTN","LRBEBAO",116,0)
 ;  LRBEAR(LRBEDFN,"LRBEDGX",LRBEDN)
"RTN","LRBEBAO",117,0)
 ;   Piece     Desc
"RTN","LRBEBAO",118,0)
 ;   1     -   Procedure (CPT)
"RTN","LRBEBAO",119,0)
 ;   2     -   Modifiers (Sub-delimited by "~")
"RTN","LRBEBAO",120,0)
 ;   3     -   Diagnosis
"RTN","LRBEBAO",121,0)
 ;   4     -   Diagnosis 2
"RTN","LRBEBAO",122,0)
 ;   5     -   Diagnosis 3
"RTN","LRBEBAO",123,0)
 ;   6     -   Diagnosis 4
"RTN","LRBEBAO",124,0)
 ;   7     -   Event D/T  (DOS)
"RTN","LRBEBAO",125,0)
 ;   8     -   Encounter Provider
"RTN","LRBEBAO",126,0)
 ;   9     -   Ordering Provider
"RTN","LRBEBAO",127,0)
 ;   10    -   Quantity (Number of times procedure was performed)
"RTN","LRBEBAO",128,0)
 ;   11    -   Place of Service 
"RTN","LRBEBAO",129,0)
 ; Output:
"RTN","LRBEBAO",130,0)
 ;  LRBEAR1(VISIT,TST,LRBEPOV)=LRBEDGX
"RTN","LRBEBAO",131,0)
 ;   VISIT      -  Pointer to VISIT (9000010) file
"RTN","LRBEBAO",132,0)
 ;   TST        -  Ordered Test
"RTN","LRBEBAO",133,0)
 ;   LRBEPOV        -  Pointer to V POV (#9000010.07) file
"RTN","LRBEBAO",134,0)
 ;   LRBEDGX        -  Pointer to Diagnosis (#80)
"RTN","LRBEBAO",135,0)
 ;
"RTN","LRBEBAO",136,0)
 D INIT
"RTN","LRBEBAO",137,0)
 N LRSWSTAT,LRSWDATE
"RTN","LRBEBAO",138,0)
 S LRSWSTAT=$$SWSTAT^IBBAPI
"RTN","LRBEBAO",139,0)
 S LRSWDATE=+$P(LRSWSTAT,U,2)
"RTN","LRBEBAO",140,0)
 S LRSWSTAT=+$P(LRSWSTAT,U)
"RTN","LRBEBAO",141,0)
 S SUB1="PROCEDURE"
"RTN","LRBEBAO",142,0)
 I '$G(LRDBEDGX) D
"RTN","LRBEBAO",143,0)
 . N LRX
"RTN","LRBEBAO",144,0)
 . S (LRDBEDGX,LRX)=0
"RTN","LRBEBAO",145,0)
 . F  S LRX=$O(^LRO(69,LRODT,1,LRSN,2,LRX)) Q:LRX<1!($G(LRDBEDGX))  D
"RTN","LRBEBAO",146,0)
 . . ;set a default diagnosis and sc/ei indicators
"RTN","LRBEBAO",147,0)
 . . I $G(^LRO(69,LRODT,1,LRSN,2,LRX,2,1,0)) S LRDBEDGX=+^(0)
"RTN","LRBEBAO",148,0)
 S LRBEDFN="" F  S LRBEDFN=$O(LRBEAR(LRBEDFN)) Q:LRBEDFN=""  D
"RTN","LRBEBAO",149,0)
 . S LRI=0 F  S LRI=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRI)) Q:LRI<1  D
"RTN","LRBEBAO",150,0)
 . . D OPWRK2
"RTN","LRBEBAO",151,0)
 ;microbiology results sent to PCE in LRCAPPH1
"RTN","LRBEBAO",152,0)
 I $P($G(^LRO(68,$G(LRAA),0)),U,2)'="MI" D SEND
"RTN","LRBEBAO",153,0)
 Q
"RTN","LRBEBAO",154,0)
SEND ; Send if procedure is defined
"RTN","LRBEBAO",155,0)
 N LRLNOW,LRVX,PXALOOK,PXUCV
"RTN","LRBEBAO",156,0)
 I '$G(^TMP("LRPXAPI",$J,"PROCEDURE",1,"PROCEDURE")) G END
"RTN","LRBEBAO",157,0)
 I $G(^XTMP("LRPCELOG",0)) D
"RTN","LRBEBAO",158,0)
 . F  S LRLNOW=$$NOW^XLFDT Q:'$D(^XTMP("LRPCELOG",1,LRLNOW))
"RTN","LRBEBAO",159,0)
 . N LRACCX,LRUIDX
"RTN","LRBEBAO",160,0)
 . S LRACCX=$G(LRACC),LRUIDX=$G(LRUID)
"RTN","LRBEBAO",161,0)
 . M ^XTMP("LRPCELOG",2,LRLNOW)=^TMP("LRPXAPI",$J)
"RTN","LRBEBAO",162,0)
 . S ^XTMP("LRPCELOG",2,LRLNOW,0)=LRACCX_U_LRUIDX
"RTN","LRBEBAO",163,0)
 S LRVX=$$DATA2PCE^PXAPI(INROOT,LRPKG,SRC,.LRBEVSIT,USR,ERRDIS)
"RTN","LRBEBAO",164,0)
 I $D(^XTMP("LRPCELOG",2,+$G(LRLNOW),0)) D
"RTN","LRBEBAO",165,0)
 . S $P(^XTMP("LRPCELOG",2,+$G(LRLNOW),0),U,3,4)=LRVX_U_LRBEVSIT
"RTN","LRBEBAO",166,0)
 . M ^XTMP("LRPCELOG",2,LRLNOW)=^TMP("LRPXAPI",$J)
"RTN","LRBEBAO",167,0)
 I $G(LRBEVSIT) D SVST^LRBEBA3(LRBEVSIT,"PCE",LRODT,LRSN)
"RTN","LRBEBAO",168,0)
END K ^TMP("LRPXAPI",$J),LRBETNUM
"RTN","LRBEBAO",169,0)
 Q
"RTN","LRBEBAO",170,0)
 ;
"RTN","LRBEBAO",171,0)
OPWRK2 ; Outpatient Work Two
"RTN","LRBEBAO",172,0)
 K LRBEPTDT
"RTN","LRBEBAO",173,0)
 S LRBEDN=0 F  S LRBEDN=+$O(LRBEAR(LRBEDFN,"LRBEDGX",LRI,LRBEDN)) Q:LRBEDN<1  D OPWRK3
"RTN","LRBEBAO",174,0)
 Q
"RTN","LRBEBAO",175,0)
OPWRK3 ;
"RTN","LRBEBAO",176,0)
 N JJ
"RTN","LRBEBAO",177,0)
 S LRBEPTDT=$G(LRBEAR(LRBEDFN,"LRBEDGX",LRI,LRBEDN))
"RTN","LRBEBAO",178,0)
 Q:'($L(LRBEPTDT))
"RTN","LRBEBAO",179,0)
 I '$P(LRBEPTDT,U,3) D
"RTN","LRBEBAO",180,0)
 .S $P(LRBEPTDT,U,3)=LRDBEDGX
"RTN","LRBEBAO",181,0)
 .S JJ=$O(^TMP("LRPXAPI",$J,"DX/PL",99),-1)+1
"RTN","LRBEBAO",182,0)
 .S ^TMP("LRPXAPI",$J,"DX/PL",JJ,"DIAGNOSIS")=LRDBEDGX
"RTN","LRBEBAO",183,0)
 .I JJ=1 S ^TMP("LRPXAPI",$J,"DX/PL",JJ,"PRIMARY")=1
"RTN","LRBEBAO",184,0)
 .E  S ^TMP("LRPXAPI",$J,"DX/PL",JJ,"PRIMARY")=0
"RTN","LRBEBAO",185,0)
 S LRBETNUM=$G(LRBETNUM)+1,LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEBAO",186,0)
 I $P(LRBEPTDT,U,1)'="" D
"RTN","LRBEBAO",187,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"PROCEDURE")=$P(LRBEPTDT,U,1)
"RTN","LRBEBAO",188,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"QTY")=1
"RTN","LRBEBAO",189,0)
 I $P(LRBEPTDT,U,2)'="" D
"RTN","LRBEBAO",190,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"MODIFIERS",$P(LRBEPTDT,U,2))=""
"RTN","LRBEBAO",191,0)
 I $P(LRBEPTDT,U,3)'="" D
"RTN","LRBEBAO",192,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS")=$P(LRBEPTDT,U,3)
"RTN","LRBEBAO",193,0)
 I $P(LRBEPTDT,U,4)'="" D
"RTN","LRBEBAO",194,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 2")=$P(LRBEPTDT,U,4)
"RTN","LRBEBAO",195,0)
 I $P(LRBEPTDT,U,5)'="" D
"RTN","LRBEBAO",196,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 3")=$P(LRBEPTDT,U,5)
"RTN","LRBEBAO",197,0)
 I $P(LRBEPTDT,U,6)'="" D
"RTN","LRBEBAO",198,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 4")=$P(LRBEPTDT,U,6)
"RTN","LRBEBAO",199,0)
 I $P(LRBEPTDT,U,7)'="" D
"RTN","LRBEBAO",200,0)
 . N LRBETM S LRBETM=$P(LRBEPTDT,U,7)
"RTN","LRBEBAO",201,0)
 . S LRBETM=$$PCETM(LRBETM)
"RTN","LRBEBAO",202,0)
 . S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"EVENT D/T")=LRBETM
"RTN","LRBEBAO",203,0)
 I $P(LRBEPTDT,U,8)'="" D
"RTN","LRBEBAO",204,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"ENC PROVIDER")=$P(LRBEPTDT,U,8)
"RTN","LRBEBAO",205,0)
 I $P(LRBEPTDT,U,9)>0 D
"RTN","LRBEBAO",206,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"ORD PROVIDER")=$P(LRBEPTDT,U,9)
"RTN","LRBEBAO",207,0)
 I $P(LRBEPTDT,U,10)'="" D
"RTN","LRBEBAO",208,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"QTY")=$P(LRBEPTDT,U,10)
"RTN","LRBEBAO",209,0)
 I $P(LRBEPTDT,U,12)'="" D
"RTN","LRBEBAO",210,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 5")=$P(LRBEPTDT,U,12)
"RTN","LRBEBAO",211,0)
 I $P(LRBEPTDT,U,13)'="" D
"RTN","LRBEBAO",212,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 6")=$P(LRBEPTDT,U,13)
"RTN","LRBEBAO",213,0)
 I $P(LRBEPTDT,U,14)'="" D
"RTN","LRBEBAO",214,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 7")=$P(LRBEPTDT,U,14)
"RTN","LRBEBAO",215,0)
 I $P(LRBEPTDT,U,15)'="" D
"RTN","LRBEBAO",216,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 8")=$P(LRBEPTDT,U,15)
"RTN","LRBEBAO",217,0)
 I $P(LRBEPTDT,U,16)'="" D
"RTN","LRBEBAO",218,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"ORD REFERENCE")=$P(LRBEPTDT,U,16)
"RTN","LRBEBAO",219,0)
 I LRSWSTAT,($P(LRBETM,".")'<LRSWDATE) D
"RTN","LRBEBAO",220,0)
 .S ^TMP("LRPXAPI",$J,"PROCEDURE",LRBETNUM,"DEPARTMENT")=108
"RTN","LRBEBAO",221,0)
 I $P(LRBEPTDT,U,20)'="" D
"RTN","LRBEBAO",222,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"QTY")=$P(LRBEPTDT,U,20)
"RTN","LRBEBAO",223,0)
 I $G(^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS"))=0 K ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS")
"RTN","LRBEBAO",224,0)
 Q
"RTN","LRBEBAO",225,0)
 ;
"RTN","LRBEBAO",226,0)
INIT ;Setup PCE variables
"RTN","LRBEBAO",227,0)
 S INROOT="^TMP(""LRPXAPI"",$J)"
"RTN","LRBEBAO",228,0)
 I '$G(LRPKG) D  Q:'$G(LRPKG)
"RTN","LRBEBAO",229,0)
 . S X="LAB SERVICE",DIC="^DIC(9.4,",DIC(0)="Z" D ^DIC
"RTN","LRBEBAO",230,0)
 . I Y S LRPKG=+Y
"RTN","LRBEBAO",231,0)
 S SRC="LAB DATA",USR=DUZ,(LRBETNUM,ERRDIS)=0
"RTN","LRBEBAO",232,0)
 K DIC
"RTN","LRBEBAO",233,0)
 Q
"RTN","LRBEBAO",234,0)
PCETM(LRBETM) ;Return date/time without seconds
"RTN","LRBEBAO",235,0)
 N PCETM
"RTN","LRBEBAO",236,0)
 S LRBETM=$G(LRBETM)
"RTN","LRBEBAO",237,0)
 Q:'LRBETM LRBETM
"RTN","LRBEBAO",238,0)
 S PCETM=$E($P(LRBETM,".",2),1,4)
"RTN","LRBEBAO",239,0)
 F  Q:($L(PCETM)=4)  S PCETM=PCETM_0
"RTN","LRBEBAO",240,0)
 I PCETM>2359 S PCETM=2359
"RTN","LRBEBAO",241,0)
 I $E(PCETM,3,4)>59 S PCETM=$E(PCETM,1,2)_59
"RTN","LRBEBAO",242,0)
 I 'PCETM S PCETM="0001"
"RTN","LRBEBAO",243,0)
 S $P(LRBETM,".",2)=PCETM
"RTN","LRBEBAO",244,0)
 Q LRBETM
"RTN","LRBEPRPT")
0^6^B38192060^B37091351
"RTN","LRBEPRPT",1,0)
LRBEPRPT ;DALOI/FHS - PRINT CPT CODES FOR TESTS AND PANELS ;03/30/2005
"RTN","LRBEPRPT",2,0)
 ;;5.2;LAB SERVICE;**291,359**;Sep 27, 1994
"RTN","LRBEPRPT",3,0)
BEBA ;Individual test CPT code look-up
"RTN","LRBEPRPT",4,0)
 K ^TMP("LR",$J,"VTO"),^TMP("LR",$J,"TMP")
"RTN","LRBEPRPT",5,0)
 S (LRBEPSY,LRBECPT)="" K DIR,X,Y,LRSTOP,LRPG
"RTN","LRBEPRPT",6,0)
 S LRBECDT=DT
"RTN","LRBEPRPT",7,0)
 S DIR(0)="PO^60:AQEZNM"
"RTN","LRBEPRPT",8,0)
 S DIR("S")="I $S('$L($P(^(0),U,3)):0,$P(^(0),U,3)=""N"":0,1:1)"
"RTN","LRBEPRPT",9,0)
 D ^DIR K DIR
"RTN","LRBEPRPT",10,0)
 I $G(Y)<1 D CLEAN Q
"RTN","LRBEPRPT",11,0)
 W @IOF
"RTN","LRBEPRPT",12,0)
 S LRBELOP=1,LRBEBY=Y,LRPRT=0
"RTN","LRBEPRPT",13,0)
 D LOOP
"RTN","LRBEPRPT",14,0)
 I $G(OUT) D  Q
"RTN","LRBEPRPT",15,0)
 . W !,+LRBEBY_"  = "_$P(^LAB(60,+LRBEBY,0),U)
"RTN","LRBEPRPT",16,0)
 . W !,"**********     ","Invalid data prevents display.",!
"RTN","LRBEPRPT",17,0)
 D:'$G(OUT) T1
"RTN","LRBEPRPT",18,0)
 D CLEAN
"RTN","LRBEPRPT",19,0)
 G BEBA
"RTN","LRBEPRPT",20,0)
LOOP ;
"RTN","LRBEPRPT",21,0)
 Q:$G(LRBEPSY)!($G(LRSTOP))
"RTN","LRBEPRPT",22,0)
 S:'$G(LRSPEC) LRSPEC=99999999 S:'$G(LRBECDT) LRBECDT=DT
"RTN","LRBEPRPT",23,0)
 K DIC,LRTEST,LRNAME,LRNLT,T1,LRY,LRBECPT,LRORD
"RTN","LRBEPRPT",24,0)
 K LRM,LRMX
"RTN","LRBEPRPT",25,0)
 K ^TMP("LR",$J,"VTO"),^TMP("LR",$J,"TMP")
"RTN","LRBEPRPT",26,0)
 S LRBECPT=""
"RTN","LRBEPRPT",27,0)
 S X=+LRBEBY_U_+LRBEBY,LRNLT=+LRBEBY,LRTEST(1,"P")=LRNLT_U_$$NLT^LRVER1(LRNLT)
"RTN","LRBEPRPT",28,0)
 S T1=1,LRTEST(T1)=+LRBEBY_U_^LAB(60,+LRBEBY,0)
"RTN","LRBEPRPT",29,0)
 S OUT=0,XX=$P(LRTEST(T1),U,6) D  Q:OUT
"RTN","LRBEPRPT",30,0)
 . I XX'="",+$P(XX,";",2)=0 S OUT=1 Q
"RTN","LRBEPRPT",31,0)
 . I XX'="" S LRBEY(+LRBEBY,+$P(XX,";",2))=""
"RTN","LRBEPRPT",32,0)
 . I $D(^LAB(60,+LRBEBY,2)) D
"RTN","LRBEPRPT",33,0)
 . . S I=0 F  S I=$O(^LAB(60,+LRBEBY,2,I)) Q:'I  D
"RTN","LRBEPRPT",34,0)
 . . . S K=$P(^LAB(60,+LRBEBY,2,I,0),U,1)
"RTN","LRBEPRPT",35,0)
 . . . S XX=$P(^LAB(60,K,0),U,5) I XX'="",+$P(XX,";",2)=0 S OUT=1 Q
"RTN","LRBEPRPT",36,0)
 . . . S LRBEY(+LRBEBY,+$P(XX,";",2))=""
"RTN","LRBEPRPT",37,0)
 K LRBECPT
"RTN","LRBEPRPT",38,0)
 S LRBETST=0,(LRPANEL,LRBEPYS)=""
"RTN","LRBEPRPT",39,0)
 S LRBETST=$O(LRBEY(LRBETST)) Q:LRBETST<1!($G(LRSTOP))  D
"RTN","LRBEPRPT",40,0)
 . Q:'$G(^LAB(60,LRBETST,12))
"RTN","LRBEPRPT",41,0)
 . Q:$L($P(^LAB(60,LRBETST,0),U,5))
"RTN","LRBEPRPT",42,0)
 . D PANEL^LRBEBA4
"RTN","LRBEPRPT",43,0)
 . I '$O(LRBECPT(LRBETST,0)) Q
"RTN","LRBEPRPT",44,0)
 . S LRPANEL="*"
"RTN","LRBEPRPT",45,0)
 . S LRBEPSY=1 D DISPLAY
"RTN","LRBEPRPT",46,0)
 . S (LRPANEL)=""
"RTN","LRBEPRPT",47,0)
 . W !
"RTN","LRBEPRPT",48,0)
PANEL ;Display panel test CPT
"RTN","LRBEPRPT",49,0)
 I $G(LRBEPSY) K LRBECPT Q
"RTN","LRBEPRPT",50,0)
 I $O(LRBECPT(0)) D  Q:$G(LRBELOP)!($G(LRSTOP))
"RTN","LRBEPRPT",51,0)
 . S LRBEPYS=1 D DISPLAY
"RTN","LRBEPRPT",52,0)
 Q:$S($G(LRBEPO):1,$G(LRBEPYS):1,1:0)
"RTN","LRBEPRPT",53,0)
 K LRBECPT
"RTN","LRBEPRPT",54,0)
 S LRTST=0,LRBETST=+LRBEBY
"RTN","LRBEPRPT",55,0)
NLT ;
"RTN","LRBEPRPT",56,0)
 S LRBECDT=DT D PANEL^LRBEBA4
"RTN","LRBEPRPT",57,0)
 Q:'$O(LRBECPT(0))
"RTN","LRBEPRPT",58,0)
 S LRI=0 F  S LRI=$O(LRBECPT(LRBETST,LRI)) Q:LRI<1!($G(LRSTOP))  D
"RTN","LRBEPRPT",59,0)
 . D LN Q:$G(LRSTOP)
"RTN","LRBEPRPT",60,0)
 . ;W !,"{"_LRBETST_"="_$P(^LAB(60,LRBETST,0),U)_"} "_$P($G(LRBEBY),U,2)
"RTN","LRBEPRPT",61,0)
 . ;W:$D(^LAB(61,LRSPEC,0))#2 "  (SPEC) = "_$E($P(^(0),U),1,30)
"RTN","LRBEPRPT",62,0)
 . S LRREQ=$S($P($G(^LAB(60,LRBETST,0)),U,17):"r ",1:" ")
"RTN","LRBEPRPT",63,0)
 . W !,LRBETST_" = "_LRREQ_$P($G(LRBEBY),U,2)_"  "  ;_$P(^LAB(60,LRBETST,0),U)
"RTN","LRBEPRPT",64,0)
 . W:$D(^LAB(61,LRSPEC,0))#2 " (SPEC) = "_$E($P(^(0),U),1,30)
"RTN","LRBEPRPT",65,0)
 . D WRT
"RTN","LRBEPRPT",66,0)
 Q
"RTN","LRBEPRPT",67,0)
 ;
"RTN","LRBEPRPT",68,0)
DISPLAY ;
"RTN","LRBEPRPT",69,0)
 Q:$G(LRSTOP)  K LRREQ
"RTN","LRBEPRPT",70,0)
 I $O(LRBECPT(0)),'$G(LRPRT) W ! S LRPRT=1
"RTN","LRBEPRPT",71,0)
 S LRBETST=0 F  S LRBETST=$O(LRBECPT(LRBETST)) Q:LRBETST<1!($G(LRSTOP))  D
"RTN","LRBEPRPT",72,0)
 . D LN Q:$G(LRSTOP)
"RTN","LRBEPRPT",73,0)
 . S LRREQ=$S($P($G(^LAB(60,LRBETST,0)),U,17):"r ",1:"")
"RTN","LRBEPRPT",74,0)
 . W !,LRBETST_" = "_LRREQ_$P(^LAB(60,LRBETST,0),U) I $D(^LAB(61,LRSPEC,0))#2 W " / "_$P(^(0),U)
"RTN","LRBEPRPT",75,0)
 . S LRI=0 F  S LRI=$O(LRBECPT(LRBETST,LRI)) Q:LRI<1  D WRT
"RTN","LRBEPRPT",76,0)
 Q
"RTN","LRBEPRPT",77,0)
WRT ;
"RTN","LRBEPRPT",78,0)
 D LN Q:$G(LRSTOP)
"RTN","LRBEPRPT",79,0)
 S LRPRT=1
"RTN","LRBEPRPT",80,0)
 S LRCPT=$O(LRBECPT(LRBETST,LRI,0)) Q:'LRCPT!($G(LRSTOP))  D
"RTN","LRBEPRPT",81,0)
 . D LN Q:$G(LRSTOP)
"RTN","LRBEPRPT",82,0)
 . S XCODE=$$CPT^ICPTCOD(LRCPT)
"RTN","LRBEPRPT",83,0)
 . W !?6,$P(XCODE,U,2)_"  "_$P(XCODE,U,3)_"  ["_LRBECPT(LRBETST,LRI,LRCPT)_"]"_$G(LRPANEL)
"RTN","LRBEPRPT",84,0)
 . K LRBECPT(LRBETST,LRI,LRCPT),XCODE
"RTN","LRBEPRPT",85,0)
 Q
"RTN","LRBEPRPT",86,0)
 ;
"RTN","LRBEPRPT",87,0)
LN ;Check line spacing
"RTN","LRBEPRPT",88,0)
 Q:$Y<(IOSL-4)!($G(LRSTOP))
"RTN","LRBEPRPT",89,0)
 I $E(IOST,1)="C" D  Q:LRSTOP
"RTN","LRBEPRPT",90,0)
 . N DIR S DIR(0)="E" D ^DIR S LRSTOP=$G(DIRUT)
"RTN","LRBEPRPT",91,0)
HDR ;Report header
"RTN","LRBEPRPT",92,0)
 W @IOF,! S LRPG=$G(LRPG)+1
"RTN","LRBEPRPT",93,0)
 W $$CJ^XLFSTR($G(LRHDR)_"         "_$$FMTE^XLFDT(DT,5)_"    Pg "_LRPG,IOM),!
"RTN","LRBEPRPT",94,0)
 Q
"RTN","LRBEPRPT",95,0)
 ;
"RTN","LRBEPRPT",96,0)
TEST ;List all test with CPT codes
"RTN","LRBEPRPT",97,0)
 ;logic follows the Billing Aware CPT logic Hierarchy
"RTN","LRBEPRPT",98,0)
  U IO
"RTN","LRBEPRPT",99,0)
  I '$G(LRPG) D HDR
"RTN","LRBEPRPT",100,0)
 S LRBELOP=1,LRBECDT=DT
"RTN","LRBEPRPT",101,0)
  S LRTN="^LAB(60,""B"")"
"RTN","LRBEPRPT",102,0)
 F  Q:$G(LRSTOP)  S LRTN=$Q(@LRTN) Q:$QS(LRTN,2)'="B"  D
"RTN","LRBEPRPT",103,0)
 . Q:$G(@LRTN)
"RTN","LRBEPRPT",104,0)
 . S LRSPEC=999999,LRBEBY=$QS(LRTN,4)
"RTN","LRBEPRPT",105,0)
 . Q:$S('$D(^LAB(60,LRBEBY,0))#2:1,'$L($P(^(0),U,3)):1,$P(^(0),U,3)="N":1,1:0)
"RTN","LRBEPRPT",106,0)
 . Q:$G(LRSTOP)
"RTN","LRBEPRPT",107,0)
 . S LRPRT=0,LRBEPSY=""
"RTN","LRBEPRPT",108,0)
 . S LRBEBY=LRBEBY_U_$P(^LAB(60,+LRBEBY,0),U)
"RTN","LRBEPRPT",109,0)
 . D LOOP
"RTN","LRBEPRPT",110,0)
 . Q:$G(OUT)
"RTN","LRBEPRPT",111,0)
 . Q:$G(LRSTOP)
"RTN","LRBEPRPT",112,0)
 . D T1
"RTN","LRBEPRPT",113,0)
 . K LRBEY,LRBEBY
"RTN","LRBEPRPT",114,0)
 . Q:$G(LRSTOP)
"RTN","LRBEPRPT",115,0)
 D CLEAN
"RTN","LRBEPRPT",116,0)
 Q
"RTN","LRBEPRPT",117,0)
 ;
"RTN","LRBEPRPT",118,0)
T1 ;
"RTN","LRBEPRPT",119,0)
 S LRSPEC=0 F  S LRSPEC=$O(^LAB(60,+LRBEBY,1,LRSPEC)) Q:LRSPEC<1!($G(LRSTOP))  D
"RTN","LRBEPRPT",120,0)
 . D LOOP
"RTN","LRBEPRPT",121,0)
 . K LRBECPT
"RTN","LRBEPRPT",122,0)
 Q:$G(OUT)
"RTN","LRBEPRPT",123,0)
 Q:$G(LRSTOP)
"RTN","LRBEPRPT",124,0)
  D ATOMIC
"RTN","LRBEPRPT",125,0)
 I $G(LRPRT) W !
"RTN","LRBEPRPT",126,0)
 K LRBEPSY
"RTN","LRBEPRPT",127,0)
 Q
"RTN","LRBEPRPT",128,0)
 ;
"RTN","LRBEPRPT",129,0)
ATOMIC ; Print Atomic test of panel
"RTN","LRBEPRPT",130,0)
 Q:'$O(^LAB(60,+LRBEBY,2,0))
"RTN","LRBEPRPT",131,0)
 W !,+LRBEBY_" = "_$P(^LAB(60,+LRBEBY,0),U),!,"**********"
"RTN","LRBEPRPT",132,0)
 N LRBEBSY,LRII,LRREQ
"RTN","LRBEPRPT",133,0)
 S LRBEBSY=+LRBEBY N LRII S LRII=0
"RTN","LRBEPRPT",134,0)
 F  S LRII=$O(^LAB(60,LRBEBSY,2,LRII)) Q:LRII<1!($G(LRSTOP))  D
"RTN","LRBEPRPT",135,0)
 . S LRBEBY=+$G(^LAB(60,LRBEBSY,2,LRII,0)) Q:'LRBEBY!($G(LRSTOP))  D
"RTN","LRBEPRPT",136,0)
 . . S LRREQ=$S($P($G(^LAB(60,LRBEBY,0)),U,17):"r",1:" ")
"RTN","LRBEPRPT",137,0)
 . . I $D(^LAB(60,LRBEBY,0)) S LRBEBY=LRREQ_"["_LRBEBY_"]  "_$P(^(0),U) D
"RTN","LRBEPRPT",138,0)
 . . . W ?15,LRBEBY,! D LN
"RTN","LRBEPRPT",139,0)
 Q
"RTN","LRBEPRPT",140,0)
 ;
"RTN","LRBEPRPT",141,0)
ASK ;Present user with a selection of options
"RTN","LRBEPRPT",142,0)
 K DIR,Y,LRSTOP,POP,ZTRTN,OUT,OPT,XX
"RTN","LRBEPRPT",143,0)
 K LRDEV,ZTDTH,ZTDESC,ZTIO,ZTSAVE
"RTN","LRBEPRPT",144,0)
 S OUT=0
"RTN","LRBEPRPT",145,0)
 S LRBECDT=DT
"RTN","LRBEPRPT",146,0)
 S DIR(0)="SO^1:Single Test Look-up;2:List Panels Only;3:List All Test"
"RTN","LRBEPRPT",147,0)
  D ^DIR K DIR
"RTN","LRBEPRPT",148,0)
 I Y<1 G CLEAN
"RTN","LRBEPRPT",149,0)
 S OPT=Y
"RTN","LRBEPRPT",150,0)
 I OPT=1 D  G ASK
"RTN","LRBEPRPT",151,0)
 . S LRHDR="*** Single Test code listing (CPT) ***"
"RTN","LRBEPRPT",152,0)
 . D BEBA
"RTN","LRBEPRPT",153,0)
 I OPT=2 D  G ASK
"RTN","LRBEPRPT",154,0)
 . S LRHDR="*** Panel Tests Only (CPT) ***",LRBEPO=1
"RTN","LRBEPRPT",155,0)
 . D DEV I $G(POP) D ^%ZISC Q
"RTN","LRBEPRPT",156,0)
 . I IO'=IO(0) D  Q
"RTN","LRBEPRPT",157,0)
 . . S ZTSAVE("LRBEPO")=""
"RTN","LRBEPRPT",158,0)
 . . S ZTRTN="TEST^LRBEPRPT"
"RTN","LRBEPRPT",159,0)
 . . D LOAD
"RTN","LRBEPRPT",160,0)
 . D TEST
"RTN","LRBEPRPT",161,0)
 I OPT=3 D  G ASK
"RTN","LRBEPRPT",162,0)
 . D DEV I $G(POP) D ^%ZISC Q
"RTN","LRBEPRPT",163,0)
 . S LRHDR="*** All Lab Tests (CPT) ***"
"RTN","LRBEPRPT",164,0)
 . I IO'=IO(0) D  Q
"RTN","LRBEPRPT",165,0)
 . . S ZTRTN="TEST^LRBEPRPT"
"RTN","LRBEPRPT",166,0)
 . . D LOAD
"RTN","LRBEPRPT",167,0)
 . D TEST
"RTN","LRBEPRPT",168,0)
 Q
"RTN","LRBEPRPT",169,0)
 ;
"RTN","LRBEPRPT",170,0)
DEV ;Select print device
"RTN","LRBEPRPT",171,0)
 N %ZIS,LRMSG,ZTDESC,ZTDTH,ZTIO,ZTSK,ZTSAVE
"RTN","LRBEPRPT",172,0)
 S %ZIS="NQ",%ZIS("A")=" Select Print Device: "
"RTN","LRBEPRPT",173,0)
 S (LRDEV,%ZIS("B"))="Home" D ^%ZIS
"RTN","LRBEPRPT",174,0)
 Q
"RTN","LRBEPRPT",175,0)
LOAD ;%ZTLOAD section
"RTN","LRBEPRPT",176,0)
 S ZTDTH=$H
"RTN","LRBEPRPT",177,0)
 S ZTDESC=$G(LRHDR)
"RTN","LRBEPRPT",178,0)
 S (LRDEV,ZTIO)=ION,ZTSAVE("LRHDR")=""
"RTN","LRBEPRPT",179,0)
 D ^%ZTLOAD W @IOF,!,$S($G(ZTSK):"Queued to device "_LRDEV,1:"Not Queued"),!
"RTN","LRBEPRPT",180,0)
 D ^%ZISC
"RTN","LRBEPRPT",181,0)
 D HOME^%ZIS
"RTN","LRBEPRPT",182,0)
 Q
"RTN","LRBEPRPT",183,0)
 ;
"RTN","LRBEPRPT",184,0)
CLEAN ;Clean-up
"RTN","LRBEPRPT",185,0)
 W:$D(ZTQUEUED) @IOF
"RTN","LRBEPRPT",186,0)
 K DIC,DIR,DIRUT,DTOUT,DUOUT
"RTN","LRBEPRPT",187,0)
 K LRBEBY,LRBECPT,LRBECDT,LRBEDT,LRBELOP,LRBEPYS,LRBEYS,LRBENLT,LRBETST,LRBEY,LRCFL
"RTN","LRBEPRPT",188,0)
 K LRCPT,LRI,LRIEN,LRM,LRMX,LRNAME,LRNLT,LRNX,LRORD,LRBEPO,LRPANEL,LRPRT
"RTN","LRBEPRPT",189,0)
 K LRSPEC,LRSTOP,LRSUB,LRTEST,LRTN,LRTST,LRXX,LRY,S2,T1,X,Y,YY
"RTN","LRBEPRPT",190,0)
 K LRHDR,LRDEV,LRPG,POP
"RTN","LRBEPRPT",191,0)
 K ^TMP("LR",$J,"VTO"),^TMP("LR",$J,"TMP")
"RTN","LRBEPRPT",192,0)
 D ^%ZISC
"RTN","LRBEPRPT",193,0)
 Q
"RTN","LRCAPPH1")
0^7^B56348077^B49109396
"RTN","LRCAPPH1",1,0)
LRCAPPH1 ;DALOI/SED/RKS/KLL - PROCESS PHLEBOTOMY WORKLOAD DATA CONT ;07/30/04
"RTN","LRCAPPH1",2,0)
 ;;5.2;LAB SERVICE;**127,136,138,158,263,264,274,291,359**;Sep 27, 1994
"RTN","LRCAPPH1",3,0)
 ; Reference to  ^SC( Supported by DBIA #1482
"RTN","LRCAPPH1",4,0)
 ; Reference to  $$CODM^ICPTCOD Supported by DBIA #1995-A
"RTN","LRCAPPH1",5,0)
 ; Reference to  $$CPT^ICPTCOD Supported by DBIA #1995-A
"RTN","LRCAPPH1",6,0)
 ; Reference to  $$DATA2PCE^PXAPI Supported by DBIA #1889-A
"RTN","LRCAPPH1",7,0)
 ; Reference to  $$DELVFILE^PXAPI Supported by DBIA #1889-B
"RTN","LRCAPPH1",8,0)
 ; Reference to  ENCEVENT^PXKENC Supported by DBIA #1889-F
"RTN","LRCAPPH1",9,0)
 ; Reference to  $$NOW^XLFDT Supported by Reference #10103
"RTN","LRCAPPH1",10,0)
 ; Reference to  $$GET^XUA4A72 Supported by Reference #1625
"RTN","LRCAPPH1",11,0)
EN3 ;LREDT = PATIENT ENCOUNTER DATE
"RTN","LRCAPPH1",12,0)
 N LREDT,LRNOP,LRBEID
"RTN","LRCAPPH1",13,0)
 K ^TMP("LRPXAPI",$J),LRXTST,LRVSITN,LRXCPT
"RTN","LRCAPPH1",14,0)
NP ;Not perform entry
"RTN","LRCAPPH1",15,0)
 S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=""
"RTN","LRCAPPH1",16,0)
 S LREDT=$P($G(^LRO(69,LRCDT,1,LRSN,1)),U)
"RTN","LRCAPPH1",17,0)
 N LRDUZ
"RTN","LRCAPPH1",18,0)
 Q:+LREDT'>0!('$D(^LR(+NODE,0))#2)
"RTN","LRCAPPH1",19,0)
 S:$G(LRDBUG) LREDT=$$NOW^XLFDT
"RTN","LRCAPPH1",20,0)
 S EDATE=$P(LREDT,".")
"RTN","LRCAPPH1",21,0)
 S:'$P(LREDT,".",2) $P(LREDT,".",2)="1201"
"RTN","LRCAPPH1",22,0)
 S LOC=+$P(NODE,U,9),LRNINS=$P(NODE(1),U,8),LRPRO=+$P(NODE,U,6) ;CHECK
"RTN","LRCAPPH1",23,0)
 S LRDUZ=+$P(NODE,U,2)
"RTN","LRCAPPH1",24,0)
 S LRNINS=$S($P($G(^SC(LOC,0)),U,4):$P(^(0),U,4),$G(LRNINS):LRNINS,1:LRINS)
"RTN","LRCAPPH1",25,0)
 S LRPRO=$S($$GET^XUA4A72(LRPRO,EDATE)>0:LRPRO,1:LRDPRAC)
"RTN","LRCAPPH1",26,0)
 I $S('$G(LOC):1,"CMZ"'[$P($G(^SC(LOC,0)),U,3):1,1:0) Q
"RTN","LRCAPPH1",27,0)
 I $S('DFN:1,'LOC:1,1:0) S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=1 S LRNOP=1 Q
"RTN","LRCAPPH1",28,0)
 I 'LRNINS S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=2 S LRNOP=2 Q
"RTN","LRCAPPH1",29,0)
 I 'LRPRO S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=3 S LRNOP=3 Q
"RTN","LRCAPPH1",30,0)
 Q:$G(LRNP)
"RTN","LRCAPPH1",31,0)
EN5 ;GET THE CPT CODES FOR THE TESTS
"RTN","LRCAPPH1",32,0)
 I LRCDT,LRSN,$D(^LRO(69,LRCDT,1,LRSN,2,0)) D
"RTN","LRCAPPH1",33,0)
 . S (LRTST,LRCNT,LRXAA)=0 K LRXTST S LRXTST=""
"RTN","LRCAPPH1",34,0)
 . F  S LRTST=$O(^LRO(69,LRCDT,1,LRSN,2,LRTST)) Q:+LRTST'>0  D
"RTN","LRCAPPH1",35,0)
 . . Q:'$D(^LRO(69,LRCDT,1,LRSN,2,LRTST,0))#2  S LREN5=^(0)
"RTN","LRCAPPH1",36,0)
 . . Q:$S($P(LREN5,U,12):1,$P(LREN5,U,11):1,1:0)  ;Don't send cancel/already sent codes
"RTN","LRCAPPH1",37,0)
 . . S LRTSTP=+$P(LREN5,U),LRAA=+$P(LREN5,U,4) Q:$S('LRTSTP:1,'LRAA:1,1:0)
"RTN","LRCAPPH1",38,0)
 . . ;Turn off old style PCE reporting for CH subscripts.
"RTN","LRCAPPH1",39,0)
 . . ;Data passed via Billing Aware API
"RTN","LRCAPPH1",40,0)
 . . I $P($G(^LRO(68,LRAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",41,0)
 . . S LRBEID=$P(^LRO(69,LRCDT,1,LRSN,2,LRTST,.3),U)
"RTN","LRCAPPH1",42,0)
 . . I '$G(LRDBUG),$P($G(^LRO(68,LRAA,0)),U,2)'="MI" S $P(^LRO(69,LRCDT,1,LRSN,2,LRTST,0),U,12)=1
"RTN","LRCAPPH1",43,0)
 . . I 'LRXAA S LRXAA=LRAA D LOC
"RTN","LRCAPPH1",44,0)
 . . Q:'$G(LRDSSID)
"RTN","LRCAPPH1",45,0)
 . . I LRXAA'=LRAA,$D(^TMP("LRPXAPI",$J,"PROCEDURE")) D SEND K ^TMP("LRPXAPI",$J) S LRXAA=LRAA D LOC Q:'$G(LRDSSID)  D EN6 Q
"RTN","LRCAPPH1",46,0)
 . . D EN6
"RTN","LRCAPPH1",47,0)
 I $D(^TMP("LRPXAPI",$J,"PROCEDURE")),'$G(^LRO(69,"AA",LRCEX,LROA)) D SEND
"RTN","LRCAPPH1",48,0)
END Q:$G(LRDBUG)
"RTN","LRCAPPH1",49,0)
END0 K ^TMP("LRPXAPI",$J),LRINA,LRREL,LRNLT,CPT,LRPRO,LRICPT,EDATE,LRTST
"RTN","LRCAPPH1",50,0)
 K I,LOC,LRI,LRCNT,LRSTP,LRNINS,LROK,LRAA,LRXAA,LRDSSID,LREN5,LRXTST
"RTN","LRCAPPH1",51,0)
 K LRNLTN,LRIDT,LRXTSTU,LRXCPT
"RTN","LRCAPPH1",52,0)
 Q
"RTN","LRCAPPH1",53,0)
EN6 ;Called from LRCAPPNP
"RTN","LRCAPPH1",54,0)
 ;Turn off old style PCE reporting for CH subscripts.
"RTN","LRCAPPH1",55,0)
 ;Data passed via Billing Aware API
"RTN","LRCAPPH1",56,0)
 I $G(LRAA),$P($G(^LRO(68,LRAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",57,0)
 S:'$D(^LRO(69,LRCDT,1,LRSN,"PCE")) ^("PCE")=""
"RTN","LRCAPPH1",58,0)
 S LRNLT=+$P($G(^LAB(60,LRTSTP,64)),U),LRICPT=0
"RTN","LRCAPPH1",59,0)
 Q:+LRNLT'>0
"RTN","LRCAPPH1",60,0)
 Q:'$D(^LAM("AD",LRNLT,"CPT"))  S LRNLTN=$P(^LAM(LRNLT,0),U,2)
"RTN","LRCAPPH1",61,0)
 Q:'LRNLTN
"RTN","LRCAPPH1",62,0)
 F  S LRICPT=$O(^LAM("AD",LRNLT,"CPT",LRICPT)) Q:+LRICPT'>0  S CPT=+$P($G(^LAM(LRNLT,4,LRICPT,0)),U) I CPT,$P(^(0),U,2)="CPT" D
"RTN","LRCAPPH1",63,0)
 . Q:'$G(CPT)
"RTN","LRCAPPH1",64,0)
 . I '$P($$CPT^ICPTCOD(CPT,$P(LREDT,"."),,),U,7) S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=4 Q
"RTN","LRCAPPH1",65,0)
 . S LRREL=$P(^LAM(LRNLT,4,LRICPT,0),U,3),LRINA=$P(^(0),U,4)
"RTN","LRCAPPH1",66,0)
 . D:LRREL&(LRINA="") SET Q
"RTN","LRCAPPH1",67,0)
 . D:EDATE>(LRREL-1)&((EDATE<LRINA)!(LRINA="")) SET
"RTN","LRCAPPH1",68,0)
 Q
"RTN","LRCAPPH1",69,0)
LOC ;Called from LRCAPPNP
"RTN","LRCAPPH1",70,0)
 I '$G(LRAA) S LRNOP=4 Q
"RTN","LRCAPPH1",71,0)
 S LRDSSLOC=$S($G(^LRO(68,+LRAA,.8)):+^(.8),1:LRDLOC)
"RTN","LRCAPPH1",72,0)
 I 'LRDSSLOC S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=4 S LRNOP=4 Q
"RTN","LRCAPPH1",73,0)
 S LRDSSID=+$P($G(^SC(LRDSSLOC,0)),U,7)
"RTN","LRCAPPH1",74,0)
 I 'LRDSSID S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=5 S LRNOP=5
"RTN","LRCAPPH1",75,0)
 Q
"RTN","LRCAPPH1",76,0)
SET ;SET IF VALID PROCEDURE
"RTN","LRCAPPH1",77,0)
 I $G(LRNP),'$D(LRNPX(CPT))#2 Q
"RTN","LRCAPPH1",78,0)
 I '$D(^TMP("LRMOD",$J,CPT)) S ^(CPT)="" D
"RTN","LRCAPPH1",79,0)
 . N X
"RTN","LRCAPPH1",80,0)
 . S X=$$CODM^ICPTCOD(CPT,"^TMP(""LRMOD"",$J,CPT)",,)
"RTN","LRCAPPH1",81,0)
 I '$G(LRXCPT(CPT)) S LRCNT=$G(LRCNT)+1,LRXCPT(CPT)=LRCNT
"RTN","LRCAPPH1",82,0)
 S LRCNT=LRXCPT(CPT)
"RTN","LRCAPPH1",83,0)
 I '$G(LRNP) S LRXCPT(CPT,"P",LRCNT)=1+$G(LRXCPT(CPT,"P",LRCNT))
"RTN","LRCAPPH1",84,0)
 I $G(LRNP) D
"RTN","LRCAPPH1",85,0)
 . S LRXCPT(CPT,"P",LRCNT)=($G(LRNPX(CPT))-1)
"RTN","LRCAPPH1",86,0)
 . S LRNPX(CPT)=(LRNPX(CPT)-1)
"RTN","LRCAPPH1",87,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"ENC PROVIDER")=LRPRO
"RTN","LRCAPPH1",88,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"PROCEDURE")=CPT
"RTN","LRCAPPH1",89,0)
 I $G(LRNP) D
"RTN","LRCAPPH1",90,0)
 . Q:$G(LRXCPT(CPT,"P",LRCNT))>0
"RTN","LRCAPPH1",91,0)
 . S LRXCPT(CPT,"P",LRCNT)=1
"RTN","LRCAPPH1",92,0)
 . S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"DELETE")=1
"RTN","LRCAPPH1",93,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"QTY")=$S($G(LRXCPT(CPT,"P",LRCNT)):LRXCPT(CPT,"P",LRCNT),1:1)
"RTN","LRCAPPH1",94,0)
 Q:$G(LRNP)
"RTN","LRCAPPH1",95,0)
 I $G(LRXCPT(CPT,"P",LRCNT))>1,$D(^TMP("LRMOD",$J,CPT,59))>0 D
"RTN","LRCAPPH1",96,0)
 . S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"MODIFIERS",59)=""
"RTN","LRCAPPH1",97,0)
 ;If Manual CPT coding always set modifier to 59 to force PCE to add CPT code.
"RTN","LRCAPPH1",98,0)
 I $G(LRES) S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"MODIFIERS",59)=""
"RTN","LRCAPPH1",99,0)
 I $G(LRAA) D
"RTN","LRCAPPH1",100,0)
 .S MOD=$$GMOD^LRBEBA2(LRAA,CPT)
"RTN","LRCAPPH1",101,0)
 .I MOD'="" S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"MODIFIERS",MOD)="" K MOD
"RTN","LRCAPPH1",102,0)
 S LRXTST(LRTST)=LRNLTN_U_LRTSTP
"RTN","LRCAPPH1",103,0)
 I $G(LRAA),$P($G(^LRO(68,LRAA,0)),U,2)="MI" D
"RTN","LRCAPPH1",104,0)
 . Q:('$D(^TMP("LRPXAPI",$J,"PROCEDURE")))
"RTN","LRCAPPH1",105,0)
 . ;Get PCE data via Billing Aware API for Microbiology
"RTN","LRCAPPH1",106,0)
 . D MICRO1^LRBEBA3(LRCDT,LRSN,LRTST,LRCNT)
"RTN","LRCAPPH1",107,0)
 . I '$D(^TMP("LRPXAPI",$J,"PROCEDURE")) S ^LRO(69,"AA",LRCEX,LROA)=9
"RTN","LRCAPPH1",108,0)
 Q
"RTN","LRCAPPH1",109,0)
SEND ;BUILD ENCOUNTER INFO Called from LRCAPPNP
"RTN","LRCAPPH1",110,0)
 I '$G(LRESCPT) Q:$G(^LRO(69,"AA",$G(LRCEX),$G(LROA)))
"RTN","LRCAPPH1",111,0)
 N LRENCDT ; Check for incorrect time
"RTN","LRCAPPH1",112,0)
 S LRENCDT=$J(LREDT,7,4),LRENCDT(1)=$P(LRENCDT,".",2)
"RTN","LRCAPPH1",113,0)
 S:'LRENCDT(1) LRENCDT(1)=1201
"RTN","LRCAPPH1",114,0)
 I $E(LRENCDT(1),3,4)>59 S LRENCDT(1)=$E(LRENCDT(1),1,2)_59
"RTN","LRCAPPH1",115,0)
 I $E(LRENCDT(1),1,2)>23 S LRENCDT(1)=23_$E(LRENCDT(1),3,4)
"RTN","LRCAPPH1",116,0)
 S $P(LRENCDT,".",2)=LRENCDT(1)
"RTN","LRCAPPH1",117,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"DSS ID")=LRDSSID
"RTN","LRCAPPH1",118,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"ENC D/T")=LRENCDT
"RTN","LRCAPPH1",119,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"HOS LOC")=LRDSSLOC
"RTN","LRCAPPH1",120,0)
 S:LRNINS ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"INSTITUTION")=LRNINS
"RTN","LRCAPPH1",121,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"PATIENT")=DFN
"RTN","LRCAPPH1",122,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"SERVICE CATEGORY")="X"
"RTN","LRCAPPH1",123,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"ENCOUNTER TYPE")="A"
"RTN","LRCAPPH1",124,0)
PCE ;SEND DATA TO PCE
"RTN","LRCAPPH1",125,0)
 N LRLNOW,LRAAX
"RTN","LRCAPPH1",126,0)
 K LRVSITN S (LROK,LRVSITN)=""
"RTN","LRCAPPH1",127,0)
 I $G(LRAA) S LRAAX=$P($G(^LRO(68,LRAA,0)),U,2)
"RTN","LRCAPPH1",128,0)
 I ($G(LRAAX)="CH") S LROK=1,LRVSITN=$G(LRBEVSIT)
"RTN","LRCAPPH1",129,0)
 I ($G(LRAAX)="MI") D
"RTN","LRCAPPH1",130,0)
 . Q:('$D(^TMP("LRPXAPI",$J,"PROCEDURE")))
"RTN","LRCAPPH1",131,0)
 . ;Get PCE data via Billing Aware API for Microbiology
"RTN","LRCAPPH1",132,0)
 . D MICRO2^LRBEBA3(LRCDT,LRSN)
"RTN","LRCAPPH1",133,0)
 . S LROK=$$DATA2PCE^PXAPI("^TMP(""LRPXAPI"",$J)",LRPKG,"LAB DATA",.LRVSITN,$G(LRDUZ))
"RTN","LRCAPPH1",134,0)
 . K ^TMP("LRBEDX",$J)
"RTN","LRCAPPH1",135,0)
 I (";AU;BB;CY;EM;SP;"[(";"_$G(LRSS)_";"))!(";AU;BB;CY;EM;SP;"[(";"_$G(LRAAX)_";")) D
"RTN","LRCAPPH1",136,0)
 .S LROK=$$DATA2PCE^PXAPI("^TMP(""LRPXAPI"",$J)",LRPKG,"LAB DATA",.LRVSITN,$G(LRDUZ))
"RTN","LRCAPPH1",137,0)
 I $G(^XTMP("LRPCELOG",0)) D  ;Used to log/debug contents of ^TMP("LRPXAPI")
"RTN","LRCAPPH1",138,0)
 . F  S LRLNOW=$$NOW^XLFDT Q:'$D(^XTMP("LRPCELOG",1,LRLNOW))  H 1
"RTN","LRCAPPH1",139,0)
 . S ^XTMP("LRPCELOG",1,LRLNOW,0)=U_$G(LRBEID)_U_$G(LRVSITN)
"RTN","LRCAPPH1",140,0)
 . M ^XTMP("LRPCELOG",1,LRLNOW)=^TMP("LRPXAPI",$J)
"RTN","LRCAPPH1",141,0)
 W:$G(LRDBUG) !,"LROK = ",LROK,!,$G(LRVSITN)
"RTN","LRCAPPH1",142,0)
 Q:$G(LRESCPT)
"RTN","LRCAPPH1",143,0)
 I '$G(LRNP),$D(^LRO(69,LRCDT,1,LRSN,"PCE")) S:LRVSITN ^("PCE")=$E(^("PCE")_$S(LROK>0:LRVSITN,1:LROK)_";",1,30) D
"RTN","LRCAPPH1",144,0)
 . I LROK<1,$D(^LRO(69,"AA",LRCEX,LROA)) S ^(LROA)=LROK
"RTN","LRCAPPH1",145,0)
EN7 N LRFND,LRPCE
"RTN","LRCAPPH1",146,0)
 Q:'$G(LRNP)!(LROK<1)!('LRVSITN)
"RTN","LRCAPPH1",147,0)
 S LRPCE=$G(^LRO(69,LRCDT,1,LRSN,"PCE"))
"RTN","LRCAPPH1",148,0)
 I '$F(LRPCE,LRVSITN_"-CPT CANC") D
"RTN","LRCAPPH1",149,0)
 . S LRFND=$F(LRPCE,LRVSITN) Q:'LRFND
"RTN","LRCAPPH1",150,0)
 . I LRFND S LRPCE=$E(LRPCE,1,(LRFND-1))_"-CPT CANC"_$E(LRPCE,LRFND,$L(LRPCE))
"RTN","LRCAPPH1",151,0)
 . S ^LRO(69,LRCDT,1,LRSN,"PCE")=$E(LRPCE,1,30)
"RTN","LRCAPPH1",152,0)
CHK ;Determine if any CPT code remain on the encounter, then delete encounter if false
"RTN","LRCAPPH1",153,0)
 K ^TMP("PXKENC",$J)
"RTN","LRCAPPH1",154,0)
 D ENCEVENT^PXKENC(LRVSITN,1)
"RTN","LRCAPPH1",155,0)
 I $O(^TMP("PXKENC",$J,LRVSITN,"CPT",0)) K ^TMP("PXKENC",$J) Q
"RTN","LRCAPPH1",156,0)
 S LROK=$$DELVFILE^PXAPI("ALL",$G(LRVSITN),LRPKG,"LAB DATA",0,0,0)
"RTN","LRCAPPH1",157,0)
 K ^TMP("PXKENC",$J) Q:LROK<1
"RTN","LRCAPPH1",158,0)
 N LRSN
"RTN","LRCAPPH1",159,0)
 S LRSN=0
"RTN","LRCAPPH1",160,0)
 F  S LRSN=$O(^LRO(69,"C",LRCE,LRCDT,LRSN)) Q:LRSN<1  D DELCAN
"RTN","LRCAPPH1",161,0)
 Q
"RTN","LRCAPPH1",162,0)
DELCAN ;Mark PCE Encounter number as '-CPT CANC-ENC DEL'
"RTN","LRCAPPH1",163,0)
 ;LRVSITN = Encounter IEN
"RTN","LRCAPPH1",164,0)
 S LRPCE=$G(^LRO(69,LRCDT,1,LRSN,"PCE")) Q:'$L(LRPCE)  D
"RTN","LRCAPPH1",165,0)
 . Q:'$G(LRVSITN)
"RTN","LRCAPPH1",166,0)
 . I $F(LRPCE,LRVSITN_"-CPT CANC-ENC DEL;") Q
"RTN","LRCAPPH1",167,0)
 . S LRFND=$F($G(LRPCE),LRVSITN_"-CPT CANC") I LRFND D  Q
"RTN","LRCAPPH1",168,0)
 . . S LRPCE=$E(LRPCE,1,(LRFND-1))_"-ENC DEL"_$E(LRPCE,LRFND,$L(LRPCE))
"RTN","LRCAPPH1",169,0)
 . . S ^LRO(69,LRCDT,1,LRSN,"PCE")=$E(LRPCE,1,30)
"RTN","LRCAPPH1",170,0)
 . S LRFND=$F($G(LRPCE),LRVSITN) I LRFND D
"RTN","LRCAPPH1",171,0)
 . . S LRPCE=$E(LRPCE,1,(LRFND-1))_"-CPT CANC-ENC DEL"_$E(LRPCE,LRFND,$L(LRPCE))
"RTN","LRCAPPH1",172,0)
 . . S ^LRO(69,LRCDT,1,LRSN,"PCE")=$E(LRPCE,1,30)
"RTN","LRCAPPH1",173,0)
 Q
"RTN","LRCAPPH1",174,0)
TEST ;
"RTN","LRCAPPH1",175,0)
 S:'$G(LRDPRAC) LRDPRAC=DUZ
"RTN","LRCAPPH1",176,0)
 S LRDLOC=+$G(^LAB(69.9,1,.8))
"RTN","LRCAPPH1",177,0)
 S:'$G(LRPKG) LRPKG=26 S:'$G(LRDBUG) LRDBUG=1 S LRVSIT=2
"RTN","LRCAPPH1",178,0)
 S:'$G(LRCDT) LRCDT=DT S:'$G(LRSN) LRSN=1 S NODE=^LRO(69,LRCDT,1,LRSN,0)
"RTN","LRCAPPH1",179,0)
 S NODE(1)=^LRO(69,LRCDT,1,LRSN,1)
"RTN","LRCAPPH1",180,0)
 S DFN=$P(^LR(+NODE,0),U,3)
"RTN","LRCAPPH1",181,0)
 D EN3
"RTN","LRCAPPH1",182,0)
 Q
"RTN","LRORDST")
0^8^B30181718^B30093835
"RTN","LRORDST",1,0)
LRORDST ;SLC/CJS/WTY - SET THE ORDER AND ACCESSION ;5/16/05
"RTN","LRORDST",2,0)
 ;;5.2;LAB SERVICE;**100,107,121,153,202,290,291,359**;Sep 27, 1994
"RTN","LRORDST",3,0)
 ;Called to create orders and accessions from local LROT array
"RTN","LRORDST",4,0)
 D DT
"RTN","LRORDST",5,0)
 K ZTSK
"RTN","LRORDST",6,0)
 I $P(LRPARAM,U,4),'$D(LRNOLABL),'$D(LRTJ),LRORDR="" D ^LRLABLIO
"RTN","LRORDST",7,0)
 F LRSAMP=-1:0 S LRSAMP=$O(LROT(LRSAMP)) Q:LRSAMP=""  F LRSPEC=-1:0 S LRSPEC=$O(LROT(LRSAMP,LRSPEC)) Q:LRSPEC=""  D ZX
"RTN","LRORDST",8,0)
 ;
"RTN","LRORDST",9,0)
 I $D(LRLABLIO),$D(LRLBL) D
"RTN","LRORDST",10,0)
 . S ZTRTN="ENT^LRLABLD",ZTDESC="LAB LABELS",ZTDTH=$H
"RTN","LRORDST",11,0)
 . S ZTIO=LRLABLIO,ZTSAVE("LRLBL(")=""
"RTN","LRORDST",12,0)
 . D ^%ZTLOAD K LRLBL
"RTN","LRORDST",13,0)
 ;
"RTN","LRORDST",14,0)
 I $D(LRSLIP) F I1=0:0 S I1=$O(LROT(I1)) Q:I1<1  F I2=-1:0 S I2=$O(LROT(I1,I2)) Q:I2=""  S LRSN=LROT(I1,I2,"SN") D WCP
"RTN","LRORDST",15,0)
 K LRLBL,ZTSK
"RTN","LRORDST",16,0)
 ;Clean-up CIDC variables
"RTN","LRORDST",17,0)
 K LRBEX,LRBEY,LRBEAR,LRBERF
"RTN","LRORDST",18,0)
 Q
"RTN","LRORDST",19,0)
 ;
"RTN","LRORDST",20,0)
 ;
"RTN","LRORDST",21,0)
ZX K:$G(LRORDR)'="P" LRCOM,LRTCOM
"RTN","LRORDST",22,0)
 N I,COMB,LRCPRS
"RTN","LRORDST",23,0)
 I $D(LRGCOM) S LRCCOM=LRGCOM D RCS^LRORD2
"RTN","LRORDST",24,0)
 S LRSXN=0,I=0
"RTN","LRORDST",25,0)
 F  S I=$O(LROT(LRSAMP,LRSPEC,I)) Q:I<1  S LRSXN=LRSXN+1
"RTN","LRORDST",26,0)
 L +^LRO(69,LRODT,1)
"RTN","LRORDST",27,0)
 S LRSN=1+$P($G(^LRO(69,LRODT,1,0)),U,3)
"RTN","LRORDST",28,0)
 S LRSUM=1+$P($G(^LRO(69,LRODT,1,0)),U,4)
"RTN","LRORDST",29,0)
ZSN N I
"RTN","LRORDST",30,0)
 F  Q:'$D(^LRO(69,LRODT,1,LRSN,0))  S LRSN=LRSN+1
"RTN","LRORDST",31,0)
 S ^LRO(69,LRODT,1,LRSN,0)=LRDFN_"^"_DUZ_"^"_(+LRSAMP)_"^"_$S($L($G(LRLWC)):LRLWC,$L(LRORDR):LRORDR,1:"SP")_"^"_LRNT_"^"_LRPRAC_"^"_LRLLOC_"^"_LRODT_$S(+LRORDTIM:"."_LRORDTIM,1:"")_"^"_LROLLOC_"^^"_$G(LRORIFN)
"RTN","LRORDST",32,0)
 S ^LRO(69,LRODT,1,LRSN,2,0)="^69.03PA^"_LRSXN_U_LRSXN
"RTN","LRORDST",33,0)
 S ^LRO(69,LRODT,1,0)="^69.01PA^"_LRSN_U_LRSUM
"RTN","LRORDST",34,0)
 L -^LRO(69,LRODT,1)
"RTN","LRORDST",35,0)
 S ^LRO(69,LRODT,1,"AA",LRDFN,LRSN)=""
"RTN","LRORDST",36,0)
 S ^LRO(69,LRODT,1,"AC",LRLLOC,LRSN)=""
"RTN","LRORDST",37,0)
 S LROT(LRSAMP,LRSPEC,"SN")=LRSN
"RTN","LRORDST",38,0)
 S ^LRO(69,"D",LRDFN,LRODT,LRSN)=""
"RTN","LRORDST",39,0)
 S COMB=$P($G(^LRO(69,LRODT,1,LRSN,1)),"^",7)
"RTN","LRORDST",40,0)
 I $S($G(LRORDR)="":1,$G(LRORDR)="P":1,1:0) D
"RTN","LRORDST",41,0)
 . S $P(^LRO(69,LRODT,1,LRSN,1),"^")=$P(LRCDT,"^")
"RTN","LRORDST",42,0)
 . S $P(^LRO(69,LRODT,1,LRSN,1),"^",2)=$P(LRCDT,"^",2)
"RTN","LRORDST",43,0)
 . S $P(^LRO(69,LRODT,1,LRSN,1),"^",4)="C"
"RTN","LRORDST",44,0)
 . S $P(^LRO(69,LRODT,1,LRSN,1),"^",8)=DUZ(2)
"RTN","LRORDST",45,0)
 . ;S ^LRO(69,LRODT,1,LRSN,1)=LRCDT_"^^C^^^"_COMB_"^"_DUZ(2)
"RTN","LRORDST",46,0)
 . I $G(LRORDR)'="P" S ^LRO(69,"AA",+$G(LRORD),LRODT_"|"_LRSN)=""
"RTN","LRORDST",47,0)
 . ; PIECE 4 INDICATED COLLECTED (NOTE: LRCDT HAS 2 PIECES)
"RTN","LRORDST",48,0)
 I LRSPEC'="" S ^LRO(69,LRODT,1,LRSN,4,0)="^69.02PA^1^1",^(1,0)=LRSPEC
"RTN","LRORDST",49,0)
 S ^LRO(69,LRODT,1,LRSN,.1)=LRORD,^LRO(69,"C",+LRORD,LRODT,LRSN)="",LRJ=0
"RTN","LRORDST",50,0)
 F LRTN=1:1 S LRJ=$O(LROT(LRSAMP,LRSPEC,LRJ)) Q:LRJ<1  D ZSN1
"RTN","LRORDST",51,0)
 I $D(LRCOM(LRSAMP,LRSPEC)),LRCOM(LRSAMP,LRSPEC) D
"RTN","LRORDST",52,0)
 . N I
"RTN","LRORDST",53,0)
 . S X=LRCOM(LRSAMP,LRSPEC)
"RTN","LRORDST",54,0)
 . S ^LRO(69,LRODT,1,LRSN,6,0)="^69.04W^"_X_U_X
"RTN","LRORDST",55,0)
 . F I=1:1:X S ^LRO(69,LRODT,1,LRSN,6,I,0)=LRCOM(LRSAMP,LRSPEC,I)
"RTN","LRORDST",56,0)
 D NEW^LR7OB1(LRODT,LRSN,"SN",$G(LRNATURE),.LRCPRS)
"RTN","LRORDST",57,0)
 I LRORDR="LC"!(LRORDR="I") D
"RTN","LRORDST",58,0)
 . S ION=$P($G(^LAB(69.9,1,3.5,+DUZ(2),0)),U,2)
"RTN","LRORDST",59,0)
 . S:ION="" ION=$P($G(^LAB(69.9,1,3)),U,4)
"RTN","LRORDST",60,0)
 . I ION'="",(LRORDR="LC"!(LRORDR="I")) D ^LROW2P
"RTN","LRORDST",61,0)
 I LRORDR="I" S ION=$P($G(^LAB(69.9,1,7,DUZ(2),0)),U,3) I ION'="" D ^LROW2P
"RTN","LRORDST",62,0)
 I $S(LRORDR="":1,LRORDR="P":1,1:0) D ^LRWLST
"RTN","LRORDST",63,0)
 Q
"RTN","LRORDST",64,0)
 ;
"RTN","LRORDST",65,0)
ZSN1 ;
"RTN","LRORDST",66,0)
 N LRORIFN
"RTN","LRORDST",67,0)
 S LRTSTS=LROT(LRSAMP,LRSPEC,LRJ),LRCPRS(LRTSTS)=""
"RTN","LRORDST",68,0)
 S ^LRO(69,LRODT,1,LRSN,2,LRTN,0)=LRTSTS_"^"_$S($D(LROT(LRSAMP,LRSPEC,LRJ,1)):LROT(LRSAMP,LRSPEC,LRJ,1),1:LROUTINE)
"RTN","LRORDST",69,0)
 D:+LRDPF=2&($G(LRSS)'="BB")&('$$CHKINP^LRBEBA4(LRDFN,LRODT))  ;CIDC
"RTN","LRORDST",70,0)
 .D SACC^LRBEBA2(LRODT,LRSN,LRTN,LRSAMP,LRSPEC,LRTSTS,.LRBEX)
"RTN","LRORDST",71,0)
 I $G(LRORIFN) S $P(^LRO(69,LRODT,1,LRSN,2,LRTN,0),"^",7)=LRORIFN ;OE/RR 2.5
"RTN","LRORDST",72,0)
 S $P(^LRO(69,LRODT,1,LRSN,2,LRTN,0),"^",9,10)="IP^L"
"RTN","LRORDST",73,0)
 S ^LRO(69,LRODT,1,LRSN,2,"B",LRTSTS,LRTN)=""
"RTN","LRORDST",74,0)
 S ^LRO(69,"AT",LRDFN,LRTSTS,LRSPEC,LRODT)="",^(-LRODT)=""
"RTN","LRORDST",75,0)
 D RCOM:$D(LROT(LRSAMP,LRSPEC,LRJ,2))
"RTN","LRORDST",76,0)
 D:$O(LRTCOM(LRTSTS,0)) TCOM^LROW2A(LRTSTS)
"RTN","LRORDST",77,0)
 Q
"RTN","LRORDST",78,0)
 ;
"RTN","LRORDST",79,0)
 ;
"RTN","LRORDST",80,0)
RCOM ; Required comment
"RTN","LRORDST",81,0)
 N LRTSTN,LRTEST
"RTN","LRORDST",82,0)
 S LRTSTN=1,LRTEST(LRTSTN)=LRTSTS
"RTN","LRORDST",83,0)
 S LRCCOM="~For Test: "_$P(^LAB(60,LRTSTS,0),U)_"   "_$P(^LAB(62,LRSAMP,0),U) S:$P(^(0),U)'=$P(^LAB(61,LRSPEC,0),U) LRCCOM=LRCCOM_"   "_$P(^LAB(61,LRSPEC,0),U) I $S('$D(DUZ("AG")):1,"ARMYAFN"'[DUZ("AG"):1,1:0) W !,LRCCOM
"RTN","LRORDST",84,0)
 S LREXP=LROT(LRSAMP,LRSPEC,LRJ,2)
"RTN","LRORDST",85,0)
 D RCS^LRORD2,RCOM^LRORD2
"RTN","LRORDST",86,0)
 I LRCCOM="",$D(LRCOM(LRSAMP,LRSPEC)) S X=+LRCOM(LRSAMP,LRSPEC) I $D(LRCOM(LRSAMP,LRSPEC,X)),LRCOM(LRSAMP,LRSPEC,X)["~For Test:" K LRCOM(LRSAMP,LRSPEC,X) S LRCOM(LRSAMP,LRSPEC)=X-1
"RTN","LRORDST",87,0)
 Q
"RTN","LRORDST",88,0)
 ;
"RTN","LRORDST",89,0)
 ;
"RTN","LRORDST",90,0)
OLD ; to allow unchanged routines to still work, from LROE1, LRPHSET1
"RTN","LRORDST",91,0)
 N LRNT
"RTN","LRORDST",92,0)
 D DT,NOW^%DTC
"RTN","LRORDST",93,0)
 S LRNT=%
"RTN","LRORDST",94,0)
 I $P(LRPARAM,U,4),'$D(LRNOLABL),'$D(LRTJ) D ^LRLABLIO
"RTN","LRORDST",95,0)
 D ^LRWLST
"RTN","LRORDST",96,0)
 Q
"RTN","LRORDST",97,0)
 ;
"RTN","LRORDST",98,0)
 ;
"RTN","LRORDST",99,0)
WCP Q:$D(LRNCWL)
"RTN","LRORDST",100,0)
 S:$D(LRORDER) ION=LRORDER
"RTN","LRORDST",101,0)
 I '$D(LRORDER) K %ZIS S IOP="HOME",%ZIS="NQ" D ^%ZIS G:POP WCP1 S X=ION,DIC(0)="EQ",DIC=3.5 D ^DIC G:Y<1 WCP1 G:'$D(^%ZIS(1,+Y,99)) WCP1 G:'$L($P(^(99),U)) WCP1 S IOP=$P(^%ZIS(1,$P(^(99),U),0),U),%ZIS="NQ" D ^%ZIS G:POP WCP1 K %ZIS,IOP
"RTN","LRORDST",102,0)
WCP2 S LRORDER=ION
"RTN","LRORDST",103,0)
 I IO(0)=IO R !!,"Press RETURN to continue...",X:DTIME S IOP=LRORDER,%ZIS="" D ^%ZIS D ENT2^LROW2P Q
"RTN","LRORDST",104,0)
 I IO'=IO(0) D ^LROW2P Q
"RTN","LRORDST",105,0)
 Q
"RTN","LRORDST",106,0)
 ;
"RTN","LRORDST",107,0)
 ;
"RTN","LRORDST",108,0)
DT S DT=$$DT^XLFDT()
"RTN","LRORDST",109,0)
 Q
"RTN","LRORDST",110,0)
 ;
"RTN","LRORDST",111,0)
 ;
"RTN","LRORDST",112,0)
WCP1 S %ZIS="NQ",%ZIS("A")="ORDER COPY DEVICE:"
"RTN","LRORDST",113,0)
 D ^%ZIS
"RTN","LRORDST",114,0)
 Q:POP
"RTN","LRORDST",115,0)
 G WCP2
"RTN","LRORDST",116,0)
 ;
"RTN","LRORDST",117,0)
 ;
"RTN","LRORDST",118,0)
OR ;OE/RR 2.5
"RTN","LRORDST",119,0)
 Q  ;Following logic not required - 2.5 is obsolete version
"RTN","LRORDST",120,0)
 N LRORDR
"RTN","LRORDST",121,0)
 Q:$G(LRORDRR)="R"
"RTN","LRORDST",122,0)
 S LRY=$S($D(LROT(LRSAMP,LRSPEC,LRJ,1)):LROT(LRSAMP,LRSPEC,LRJ,1),1:LROUTINE),LRI=1,LRTEST(LRI)=LRTSTS_"^"_LRY,LRORDR=$S($L($G(LRLWC)):LRLWC,1:"")
"RTN","LRORDST",123,0)
 D SET^LROR
"RTN","LRORDST",124,0)
 Q
"VER")
8.0^22.0
"BLD",6333,6)
^276
**END**
**END**
