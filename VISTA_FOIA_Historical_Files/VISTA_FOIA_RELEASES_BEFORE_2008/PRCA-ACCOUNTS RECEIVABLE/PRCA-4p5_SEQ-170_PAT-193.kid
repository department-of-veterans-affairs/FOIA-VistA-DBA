Released PRCA*4.5*193 SEQ #170
Extracted from mail message
**KIDS**:PRCA*4.5*193^

**INSTALL NAME**
PRCA*4.5*193
"BLD",4499,0)
PRCA*4.5*193^ACCOUNTS RECEIVABLE^0^3030512^y
"BLD",4499,1,0)
^^6^6^3030326^
"BLD",4499,1,1,0)
 
"BLD",4499,1,2,0)
This patch addresses 2 issues. The first issue is regarding the 
"BLD",4499,1,3,0)
"Bad Debt Write-Off (Plus)" line in the Bad Debt report not updating
"BLD",4499,1,4,0)
correctly. The second issue concerns patient balance discrepancies
"BLD",4499,1,5,0)
that appear on the Statement Discrepancy Listing report even though
"BLD",4499,1,6,0)
the accounts are actually in balance.
"BLD",4499,4,0)
^9.64PA^^
"BLD",4499,"ABPKG")
n
"BLD",4499,"KRN",0)
^9.67PA^8989.52^19
"BLD",4499,"KRN",.4,0)
.4
"BLD",4499,"KRN",.401,0)
.401
"BLD",4499,"KRN",.402,0)
.402
"BLD",4499,"KRN",.403,0)
.403
"BLD",4499,"KRN",.5,0)
.5
"BLD",4499,"KRN",.84,0)
.84
"BLD",4499,"KRN",3.6,0)
3.6
"BLD",4499,"KRN",3.8,0)
3.8
"BLD",4499,"KRN",9.2,0)
9.2
"BLD",4499,"KRN",9.8,0)
9.8
"BLD",4499,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4499,"KRN",9.8,"NM",1,0)
PRCAMARK^^0^B1299299
"BLD",4499,"KRN",9.8,"NM",2,0)
RCRJRBD^^0^B55610292
"BLD",4499,"KRN",9.8,"NM","B","PRCAMARK",1)

"BLD",4499,"KRN",9.8,"NM","B","RCRJRBD",2)

"BLD",4499,"KRN",19,0)
19
"BLD",4499,"KRN",19.1,0)
19.1
"BLD",4499,"KRN",101,0)
101
"BLD",4499,"KRN",409.61,0)
409.61
"BLD",4499,"KRN",771,0)
771
"BLD",4499,"KRN",870,0)
870
"BLD",4499,"KRN",8989.51,0)
8989.51
"BLD",4499,"KRN",8989.52,0)
8989.52
"BLD",4499,"KRN",8994,0)
8994
"BLD",4499,"KRN","B",.4,.4)

"BLD",4499,"KRN","B",.401,.401)

"BLD",4499,"KRN","B",.402,.402)

"BLD",4499,"KRN","B",.403,.403)

"BLD",4499,"KRN","B",.5,.5)

"BLD",4499,"KRN","B",.84,.84)

"BLD",4499,"KRN","B",3.6,3.6)

"BLD",4499,"KRN","B",3.8,3.8)

"BLD",4499,"KRN","B",9.2,9.2)

"BLD",4499,"KRN","B",9.8,9.8)

"BLD",4499,"KRN","B",19,19)

"BLD",4499,"KRN","B",19.1,19.1)

"BLD",4499,"KRN","B",101,101)

"BLD",4499,"KRN","B",409.61,409.61)

"BLD",4499,"KRN","B",771,771)

"BLD",4499,"KRN","B",870,870)

"BLD",4499,"KRN","B",8989.51,8989.51)

"BLD",4499,"KRN","B",8989.52,8989.52)

"BLD",4499,"KRN","B",8994,8994)

"BLD",4499,"QUES",0)
^9.62^^
"BLD",4499,"REQB",0)
^9.611^2^2
"BLD",4499,"REQB",1,0)
PRCA*4.5*169^2
"BLD",4499,"REQB",2,0)
PRCA*4.5*170^2
"BLD",4499,"REQB","B","PRCA*4.5*169",1)

"BLD",4499,"REQB","B","PRCA*4.5*170",2)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
193^3030512
"PKG",142,22,1,"PAH",1,1,0)
^^6^6^3030512
"PKG",142,22,1,"PAH",1,1,1,0)
 
"PKG",142,22,1,"PAH",1,1,2,0)
This patch addresses 2 issues. The first issue is regarding the 
"PKG",142,22,1,"PAH",1,1,3,0)
"Bad Debt Write-Off (Plus)" line in the Bad Debt report not updating
"PKG",142,22,1,"PAH",1,1,4,0)
correctly. The second issue concerns patient balance discrepancies
"PKG",142,22,1,"PAH",1,1,5,0)
that appear on the Statement Discrepancy Listing report even though
"PKG",142,22,1,"PAH",1,1,6,0)
the accounts are actually in balance.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PRCAMARK")
0^1^B1299299
"RTN","PRCAMARK",1,0)
PRCAMARK ;WASH-ISC@ALTOONA,PA/TJK,LDB-MARK/UNMARK INVALID TRANSACTION ;10/15/93  11:53 AM
"RTN","PRCAMARK",2,0)
V ;;4.5;Accounts Receivable;**169,193**;Mar 20, 1995
"RTN","PRCAMARK",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAMARK",4,0)
 Q
"RTN","PRCAMARK",5,0)
 ;
"RTN","PRCAMARK",6,0)
 ;
"RTN","PRCAMARK",7,0)
SE ;  search for balance discrepancies
"RTN","PRCAMARK",8,0)
 NEW DIC,FR,TO,L,FLDS,BY,DIOEND,DIS
"RTN","PRCAMARK",9,0)
 W !!,"Since this may take awhile, queue this report to a printer!",!
"RTN","PRCAMARK",10,0)
 S DIC="^RCD(340,",(FR,TO)="",BY="@.01",FLDS="[PRCA DISCREPANCY]"
"RTN","PRCAMARK",11,0)
 S DIS(0)="I '$D(^RCD(340,D0,-9)),$P($G(^RCD(340,D0,0)),""^"")[""DPT("",$$EN^PRCAMRKC(D0)"
"RTN","PRCAMARK",12,0)
 S DIOEND="W !,""*   indicates account has bills in refund review."""
"RTN","PRCAMARK",13,0)
 D EN1^DIP
"RTN","PRCAMARK",14,0)
 Q
"RTN","RCRJRBD")
0^2^B55610292
"RTN","RCRJRBD",1,0)
RCRJRBD ;WISC/RFJ,TJK-bad debt extractor and report ;1 Feb 98
"RTN","RCRJRBD",2,0)
 ;;4.5;Accounts Receivable;**101,139,170,193**;Mar 20, 1995
"RTN","RCRJRBD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRBD",4,0)
 Q
"RTN","RCRJRBD",5,0)
 ;
"RTN","RCRJRBD",6,0)
 ;
"RTN","RCRJRBD",7,0)
START(DATEEND) ;  run bad debt report
"RTN","RCRJRBD",8,0)
 ;  the DATEEND is the last day of the month being run
"RTN","RCRJRBD",9,0)
 ;  from the routine RCRJRCOL which is the data extractor.  The
"RTN","RCRJRBD",10,0)
 ;  current receivable dollars is stored in ^TMP($J,"RCRJRBD",SGL)
"RTN","RCRJRBD",11,0)
 ;  where SGL is the standard general ledger 1319, 1338, or 1339.
"RTN","RCRJRBD",12,0)
 ;
"RTN","RCRJRBD",13,0)
 N ACTDATE,ACTUALCA,ACTUALWO,BEGDATE,BILLDA,CATEGORY
"RTN","RCRJRBD",14,0)
 N COLLECT,CONTRACT,DR,ENDDATE,FUND,PAY,PAYMENT,PRIN,PRINCPAL
"RTN","RCRJRBD",15,0)
 N RCRJFMM,RCRJDATE,SGL,TRANDA,TRANDATE,TRANTYPE,VALUE,WRITEOFF
"RTN","RCRJRBD",16,0)
 N RCPRIN,RCTOHSIF,RCTOMCCF,RCVALUE
"RTN","RCRJRBD",17,0)
 ;
"RTN","RCRJRBD",18,0)
 ;  lock the bad debt file for storing data, lock cannot fail
"RTN","RCRJRBD",19,0)
 ;  this lock can be used to monitor if the report is running
"RTN","RCRJRBD",20,0)
 L +^RC(348.1)
"RTN","RCRJRBD",21,0)
 ;
"RTN","RCRJRBD",22,0)
 ;  calculate the base percentages from past data
"RTN","RCRJRBD",23,0)
 ;  example:  DATEEND=2980331  => BEGDATE=2970300
"RTN","RCRJRBD",24,0)
 ;                             => ENDDATE=2980229
"RTN","RCRJRBD",25,0)
 ;   add one day to ending date to go to next month
"RTN","RCRJRBD",26,0)
 S BEGDATE=($E(DATEEND,1,3)-1)_$E(DATEEND,4,5)_"00"
"RTN","RCRJRBD",27,0)
 S ENDDATE=($$FMADD^XLFDT($E(DATEEND,1,5)_"00",-1))+1
"RTN","RCRJRBD",28,0)
 ;  loop bills activated between these dates
"RTN","RCRJRBD",29,0)
 S ACTDATE=BEGDATE
"RTN","RCRJRBD",30,0)
 F  S ACTDATE=$O(^PRCA(430,"ACTDT",ACTDATE)) Q:'ACTDATE!(ACTDATE>ENDDATE)  D
"RTN","RCRJRBD",31,0)
 .   S BILLDA=0 F  S BILLDA=$O(^PRCA(430,"ACTDT",ACTDATE,BILLDA)) Q:'BILLDA  D
"RTN","RCRJRBD",32,0)
 .   .   S CATEGORY=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRBD",33,0)
 .   .   ;  do not look at prepayments
"RTN","RCRJRBD",34,0)
 .   .   I 'CATEGORY!(CATEGORY=26) Q
"RTN","RCRJRBD",35,0)
 .   .   ;
"RTN","RCRJRBD",36,0)
 .   .   ;  only look at bills with a 0 principal balance
"RTN","RCRJRBD",37,0)
 .   .   I $P($G(^PRCA(430,BILLDA,7)),"^") Q
"RTN","RCRJRBD",38,0)
 .   .   ;
"RTN","RCRJRBD",39,0)
 .   .   ;  only report fund 5287 bills
"RTN","RCRJRBD",40,0)
 .   .   S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRBD",41,0)
 .   .   I FUND'=5287 Q
"RTN","RCRJRBD",42,0)
 .   .   ;
"RTN","RCRJRBD",43,0)
 .   .   ;  derive standard general ledger (SGL) from category
"RTN","RCRJRBD",44,0)
 .   .   S SGL=1319
"RTN","RCRJRBD",45,0)
 .   .   I CATEGORY=9 S SGL=1339   ;  reimbursable health insurance
"RTN","RCRJRBD",46,0)
 .   .   I CATEGORY=10 S SGL=1338  ;  tort feasor
"RTN","RCRJRBD",47,0)
 .   .   ;
"RTN","RCRJRBD",48,0)
 .   .   ;  determine the original amount of the bill (add increase
"RTN","RCRJRBD",49,0)
 .   .   ;  adjustments below)
"RTN","RCRJRBD",50,0)
 .   .   S PRIN=$P($G(^PRCA(430,BILLDA,0)),"^",3)
"RTN","RCRJRBD",51,0)
 .   .   S PAY=0
"RTN","RCRJRBD",52,0)
 .   .   ;
"RTN","RCRJRBD",53,0)
 .   .   ;  get the $ transations for bills
"RTN","RCRJRBD",54,0)
 .   .   S TRANDA=0
"RTN","RCRJRBD",55,0)
 .   .   F  S TRANDA=$O(^PRCA(433,"C",BILLDA,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRBD",56,0)
 .   .   .   S TRANTYPE=$P($G(^PRCA(433,TRANDA,1)),"^",2)
"RTN","RCRJRBD",57,0)
 .   .   .   I "^1^2^34^43^"'[("^"_TRANTYPE_"^") Q
"RTN","RCRJRBD",58,0)
 .   .   .   S VALUE=$$TRANBAL^RCRJRCOT(TRANDA) I VALUE="" Q
"RTN","RCRJRBD",59,0)
 .   .   .   ;  increase adjustments or re-establish
"RTN","RCRJRBD",60,0)
 .   .   .   I TRANTYPE=1!(TRANTYPE=43) S PRIN=PRIN+$P(VALUE,"^") Q
"RTN","RCRJRBD",61,0)
 .   .   .   ;  payments
"RTN","RCRJRBD",62,0)
 .   .   .   I TRANTYPE=2!(TRANTYPE=34) S PAY=PAY+$P(VALUE,"^") Q
"RTN","RCRJRBD",63,0)
 .   .   ;
"RTN","RCRJRBD",64,0)
 .   .   ;  payment cannot be greater than principle
"RTN","RCRJRBD",65,0)
 .   .   I PAY>PRIN S PAY=PRIN
"RTN","RCRJRBD",66,0)
 .   .   ;
"RTN","RCRJRBD",67,0)
 .   .   ;  store the data
"RTN","RCRJRBD",68,0)
 .   .   S PRINCPAL(SGL)=$G(PRINCPAL(SGL))+PRIN
"RTN","RCRJRBD",69,0)
 .   .   S PAYMENT(SGL)=$G(PAYMENT(SGL))+PAY
"RTN","RCRJRBD",70,0)
 .   .   ;
"RTN","RCRJRBD",71,0)
 .   .   ;  if it is an rx copay bill, calculate the principal & payment
"RTN","RCRJRBD",72,0)
 .   .   ;  so we can calculate the collection % for hsif (hsif values
"RTN","RCRJRBD",73,0)
 .   .   ;  are stored using 1319.1)
"RTN","RCRJRBD",74,0)
 .   .   I CATEGORY=22!(CATEGORY=23) D
"RTN","RCRJRBD",75,0)
 .   .   .   S PRINCPAL(1319.1)=$G(PRINCPAL(1319.1))+PRIN
"RTN","RCRJRBD",76,0)
 .   .   .   S PAYMENT(1319.1)=$G(PAYMENT(1319.1))+PAY
"RTN","RCRJRBD",77,0)
 ;
"RTN","RCRJRBD",78,0)
 ;  calculate the writeoffs from 2/0/98
"RTN","RCRJRBD",79,0)
 ;  2/0/98 is when fms cleared out actual writeoffs and contract adj
"RTN","RCRJRBD",80,0)
 K ^XTMP("PRCABDET")
"RTN","RCRJRBD",81,0)
 S ^XTMP("PRCABDET",0)=$$FMADD^XLFDT(DT,10)_"^"_DT_"^BAD DEBT REPORT AUDIT"
"RTN","RCRJRBD",82,0)
 F TRANTYPE=8,9,10,11,35,43 D
"RTN","RCRJRBD",83,0)
 .   S TRANDATE=2980200
"RTN","RCRJRBD",84,0)
 .   ;  do not pick up transactions after the end date
"RTN","RCRJRBD",85,0)
 .   F  S TRANDATE=$O(^PRCA(433,"AT",TRANTYPE,TRANDATE)) Q:'TRANDATE!($P(TRANDATE,".")>DATEEND)  D
"RTN","RCRJRBD",86,0)
 .   .   S TRANDA=0 F  S TRANDA=$O(^PRCA(433,"AT",TRANTYPE,TRANDATE,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRBD",87,0)
 .   .   .   ;  do not look at decrease adj which are not contract adj
"RTN","RCRJRBD",88,0)
 .   .   .   I TRANTYPE=35,'$P($G(^PRCA(433,TRANDA,8)),"^",8) Q
"RTN","RCRJRBD",89,0)
 .   .   .   ;
"RTN","RCRJRBD",90,0)
 .   .   .   S BILLDA=$P($G(^PRCA(433,TRANDA,0)),"^",2)
"RTN","RCRJRBD",91,0)
 .   .   .   I 'BILLDA Q
"RTN","RCRJRBD",92,0)
 .   .   .   S CATEGORY=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRBD",93,0)
 .   .   .   ;  do not look at prepayments
"RTN","RCRJRBD",94,0)
 .   .   .   I 'CATEGORY!(CATEGORY=26) Q
"RTN","RCRJRBD",95,0)
 .   .   .   ;
"RTN","RCRJRBD",96,0)
 .   .   .   ;  only report fund 5287 and 4032 (ltc) bills
"RTN","RCRJRBD",97,0)
 .   .   .   S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRBD",98,0)
 .   .   .   I FUND'=5287,FUND'=4032 Q
"RTN","RCRJRBD",99,0)
 .   .   .   ;
"RTN","RCRJRBD",100,0)
 .   .   .   ;  derive standard general ledger (SGL) from category
"RTN","RCRJRBD",101,0)
 .   .   .   S SGL=1319
"RTN","RCRJRBD",102,0)
 .   .   .   I CATEGORY=9 S SGL=1339   ;  reimbursable health insurance
"RTN","RCRJRBD",103,0)
 .   .   .   I CATEGORY=10 S SGL=1338  ;  tort feasor
"RTN","RCRJRBD",104,0)
 .   .   .   ;  breakout longterm care as a subset
"RTN","RCRJRBD",105,0)
 .   .   .   I FUND=4032 S SGL=1319.2
"RTN","RCRJRBD",106,0)
 .   .   .   ;
"RTN","RCRJRBD",107,0)
 .   .   .   ;  get the principal transaction value
"RTN","RCRJRBD",108,0)
 .   .   .   S RCVALUE=+$P($$TRANBAL^RCRJRCOT(TRANDA),"^")
"RTN","RCRJRBD",109,0)
 .   .   .   ;  temp variable for value (used below)
"RTN","RCRJRBD",110,0)
 .   .   .   S RCPRIN=RCVALUE
"RTN","RCRJRBD",111,0)
 .   .   .   ;
"RTN","RCRJRBD",112,0)
 .   .   .   I CATEGORY=22!(CATEGORY=23) D
"RTN","RCRJRBD",113,0)
 .   .   .   .   ;  get the amount for hsif written off
"RTN","RCRJRBD",114,0)
 .   .   .   .   D MCCFHSIF^RCRJRCOC(BILLDA,RCVALUE,$$CALCRSC^RCXFMSUR(BILLDA),TRANDATE+1)
"RTN","RCRJRBD",115,0)
 .   .   .   .   I RCTOHSIF S ACTUALWO(1319.1)=$G(ACTUALWO(1319.1))+RCTOHSIF
"RTN","RCRJRBD",116,0)
 .   .   .   .   ;  reset value for mccf fund below.  do not allow to
"RTN","RCRJRBD",117,0)
 .   .   .   .   ;  be greater than write off value (reestablish
"RTN","RCRJRBD",118,0)
 .   .   .   .   ;  transactions cause this)
"RTN","RCRJRBD",119,0)
 .   .   .   .   S RCVALUE=RCTOMCCF
"RTN","RCRJRBD",120,0)
 .   .   .   .   I RCVALUE>RCPRIN S RCVALUE=RCPRIN
"RTN","RCRJRBD",121,0)
 .   .   .   ;
"RTN","RCRJRBD",122,0)
 .   .   .   ;  add actual writeoff amount for fiscal year
"RTN","RCRJRBD",123,0)
 .   .   .   I TRANTYPE<35 S ACTUALWO(SGL)=$G(ACTUALWO(SGL))+RCVALUE
"RTN","RCRJRBD",124,0)
 .   .   .   ;  add re-established to writeoff amount for fiscal year
"RTN","RCRJRBD",125,0)
 .   .   .   I TRANTYPE=43 S ACTUALWO(SGL)=$G(ACTUALWO(SGL))-RCVALUE
"RTN","RCRJRBD",126,0)
 .   .   .   ;  add actual contract adjustments for fiscal year
"RTN","RCRJRBD",127,0)
 .   .   .   I TRANTYPE=35 S ACTUALCA(SGL)=$G(ACTUALCA(SGL))+RCVALUE
"RTN","RCRJRBD",128,0)
 .   .   .   S ^XTMP("PRCABDET",BILLDA,CATEGORY,FUND,SGL,TRANDA,TRANDATE,TRANTYPE,RCPRIN,RCVALUE,+$G(RCTOHSIF),0)=""
"RTN","RCRJRBD",129,0)
 ;
"RTN","RCRJRBD",130,0)
 ;  remove all the entries from the bad debt file
"RTN","RCRJRBD",131,0)
 D DELETALL
"RTN","RCRJRBD",132,0)
 ;
"RTN","RCRJRBD",133,0)
 ;  calculate percentages and store them
"RTN","RCRJRBD",134,0)
 F SGL=1319,1319.1,1319.2,1338,1339 D
"RTN","RCRJRBD",135,0)
 .   ;  collection %
"RTN","RCRJRBD",136,0)
 .   S COLLECT=0 I $G(PRINCPAL(SGL)) S COLLECT=$J($G(PAYMENT(SGL))/PRINCPAL(SGL)*100,0,2)
"RTN","RCRJRBD",137,0)
 .   S DR=".02////"_COLLECT_";"
"RTN","RCRJRBD",138,0)
 .   ;
"RTN","RCRJRBD",139,0)
 .   ;  current month receivable (this is built in the routine
"RTN","RCRJRBD",140,0)
 .   ;  RCRJRCO1 and is stored in ^TMP($J,"RCRJRBD",SGL))
"RTN","RCRJRBD",141,0)
 .   S DR=DR_".07////"_+$G(^TMP($J,"RCRJRBD",SGL))_";"
"RTN","RCRJRBD",142,0)
 .   ;
"RTN","RCRJRBD",143,0)
 .   ;  calculate allowance estimate for 1319 and 1338
"RTN","RCRJRBD",144,0)
 .   ;  .08 allowance estimate = (writeoff % * current receivables)
"RTN","RCRJRBD",145,0)
 .   ;  .09 actual writeoffs fytd
"RTN","RCRJRBD",146,0)
 .   I SGL=1319!(SGL=1319.1)!(SGL=1319.2)!(SGL=1338) D
"RTN","RCRJRBD",147,0)
 .   .   S WRITEOFF=100-COLLECT
"RTN","RCRJRBD",148,0)
 .   .   S DR=DR_".03////"_WRITEOFF_";"
"RTN","RCRJRBD",149,0)
 .   .   S DR=DR_".08////"_$J((WRITEOFF/100)*$G(^TMP($J,"RCRJRBD",SGL)),0,2)_";"
"RTN","RCRJRBD",150,0)
 .   .   S DR=DR_".09////"_+$G(ACTUALWO(SGL))_";"
"RTN","RCRJRBD",151,0)
 .   ;  calculate allowance estimate for 1339
"RTN","RCRJRBD",152,0)
 .   ;  .08 allowance estimate = (contract % * current receivables)
"RTN","RCRJRBD",153,0)
 .   ;  .09 actual contract adjustments fytd
"RTN","RCRJRBD",154,0)
 .   I SGL=1339 D
"RTN","RCRJRBD",155,0)
 .   .   S CONTRACT=100-COLLECT
"RTN","RCRJRBD",156,0)
 .   .   S DR=DR_".04////"_CONTRACT_";"
"RTN","RCRJRBD",157,0)
 .   .   S DR=DR_".08////"_$J((CONTRACT/100)*$G(^TMP($J,"RCRJRBD",SGL)),0,2)_";"
"RTN","RCRJRBD",158,0)
 .   .   S DR=DR_".09////"_+$G(ACTUALCA(SGL))_";"
"RTN","RCRJRBD",159,0)
 .   ;
"RTN","RCRJRBD",160,0)
 .   ;  set changed locally flag to no
"RTN","RCRJRBD",161,0)
 .   S DR=DR_".1////0;"
"RTN","RCRJRBD",162,0)
 .   D STORE(SGL,DR)
"RTN","RCRJRBD",163,0)
 ;
"RTN","RCRJRBD",164,0)
 L -^RC(348.1)
"RTN","RCRJRBD",165,0)
 ;
"RTN","RCRJRBD",166,0)
 ;  put the report in a mail message (rcrjfmm=1)
"RTN","RCRJRBD",167,0)
 S RCRJFMM=1
"RTN","RCRJRBD",168,0)
 S RCRJDATE=DATEEND
"RTN","RCRJRBD",169,0)
 D DQ^RCRJRBDR
"RTN","RCRJRBD",170,0)
 Q
"RTN","RCRJRBD",171,0)
 ;
"RTN","RCRJRBD",172,0)
 ;
"RTN","RCRJRBD",173,0)
STORE(SGL,DR) ;  store data for Standard Ledger Account
"RTN","RCRJRBD",174,0)
 N D0,DA,DD,DI,DIC,DIE,DINUM,DO,DQ,X,Y
"RTN","RCRJRBD",175,0)
 S DIC="^RC(348.1,",DIC(0)="L",(X,DINUM)=SGL,DIC("DR")=DR
"RTN","RCRJRBD",176,0)
 D FILE^DICN
"RTN","RCRJRBD",177,0)
 Q
"RTN","RCRJRBD",178,0)
 ;
"RTN","RCRJRBD",179,0)
 ;
"RTN","RCRJRBD",180,0)
DELETALL ;  delete all the entries from the bad debt file
"RTN","RCRJRBD",181,0)
 N %,DA,DIC,DIK,X,Y
"RTN","RCRJRBD",182,0)
 S DIK="^RC(348.1,"
"RTN","RCRJRBD",183,0)
 S DA=0 F  S DA=$O(^RC(348.1,DA)) Q:'DA  D ^DIK
"RTN","RCRJRBD",184,0)
 Q
"RTN","RCRJRBD",185,0)
 ;
"RTN","RCRJRBD",186,0)
 ;
"RTN","RCRJRBD",187,0)
WD3() ;  return the third work day of the month
"RTN","RCRJRBD",188,0)
 N J,P,V,X
"RTN","RCRJRBD",189,0)
 S J=0 F P=$E(DT,1,5)_"01":1 S V=$$DOW^XLFDT(P,1) I V,V<6,'$D(^HOLIDAY("B",P)) S J=J+1 Q:J=3
"RTN","RCRJRBD",190,0)
 S X=+$E(P,6,7)
"RTN","RCRJRBD",191,0)
 Q X
"RTN","RCRJRBD",192,0)
 ;
"RTN","RCRJRBD",193,0)
 ;
"RTN","RCRJRBD",194,0)
PREVMONT(FORDATE) ;  return the previous month's date
"RTN","RCRJRBD",195,0)
 N PREVDATE
"RTN","RCRJRBD",196,0)
 S PREVDATE=$E(FORDATE,1,5)-1
"RTN","RCRJRBD",197,0)
 I $E(PREVDATE,4,5)="00" S PREVDATE=($E(PREVDATE,1,3)-1)_12
"RTN","RCRJRBD",198,0)
 Q PREVDATE_"00"
"VER")
8.0^22
**END**
**END**
