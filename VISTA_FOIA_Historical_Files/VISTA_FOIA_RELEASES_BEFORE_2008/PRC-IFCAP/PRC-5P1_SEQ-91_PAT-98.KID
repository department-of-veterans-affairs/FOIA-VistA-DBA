EMERGENCY Released PRC*5.1*98 SEQ #91
Extracted from mail message
**KIDS**:PRC*5.1*98^

**INSTALL NAME**
PRC*5.1*98
"BLD",5008,0)
PRC*5.1*98^IFCAP^0^3070306^y
"BLD",5008,1,0)
^^2^2^3061201^^^
"BLD",5008,1,1,0)
This patch addresses an enhancement request to modify IFCAP to properly 
"BLD",5008,1,2,0)
classify On Demand Items (ODI).
"BLD",5008,4,0)
^9.64PA^446.5^3
"BLD",5008,4,445,0)
445
"BLD",5008,4,445,2,0)
^9.641^445.13^3
"BLD",5008,4,445,2,445.01,0)
INVENTORY ITEM  (sub-file)
"BLD",5008,4,445,2,445.01,1,0)
^9.6411^.8^1
"BLD",5008,4,445,2,445.01,1,.8,0)
ON-DEMAND
"BLD",5008,4,445,2,445.027,0)
ON-DEMAND USERS  (sub-file)
"BLD",5008,4,445,2,445.027,1,0)
^9.6411^^
"BLD",5008,4,445,2,445.13,0)
ON-DEMAND AUDIT  (sub-file)
"BLD",5008,4,445,2,445.13,1,0)
^9.6411^^
"BLD",5008,4,445,222)
y^n^p^^^^n^^n
"BLD",5008,4,445,224)

"BLD",5008,4,446.5,0)
446.5
"BLD",5008,4,446.5,222)
n^n^f^^y^^y^r^y
"BLD",5008,4,446.5,224)
I $P(^PRCT(446.5,+Y,0),"^",1)="PRIMARY/SECONDARY LABEL"
"BLD",5008,4,446.7,0)
446.7
"BLD",5008,4,446.7,222)
y^n^f^^^^n^^
"BLD",5008,4,446.7,224)

"BLD",5008,4,"APDD",445,445.01)

"BLD",5008,4,"APDD",445,445.01,.8)

"BLD",5008,4,"APDD",445,445.027)

"BLD",5008,4,"APDD",445,445.13)

"BLD",5008,4,"B",445,445)

"BLD",5008,4,"B",446.5,446.5)

"BLD",5008,4,"B",446.7,446.7)

"BLD",5008,6.3)
37
"BLD",5008,"ABPKG")
n
"BLD",5008,"INI")
BARCODE^PRC5198P
"BLD",5008,"INID")
^y^n
"BLD",5008,"INIT")
INIT^PRC5198P
"BLD",5008,"KRN",0)
^9.67PA^8989.52^19
"BLD",5008,"KRN",.4,0)
.4
"BLD",5008,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",5008,"KRN",.4,"NM",1,0)
PRCP REPORT:COMPREHENSIVE    FILE #445^445
"BLD",5008,"KRN",.4,"NM","B","PRCP REPORT:COMPREHENSIVE    FILE #445",1)

"BLD",5008,"KRN",.401,0)
.401
"BLD",5008,"KRN",.402,0)
.402
"BLD",5008,"KRN",.403,0)
.403
"BLD",5008,"KRN",.5,0)
.5
"BLD",5008,"KRN",.84,0)
.84
"BLD",5008,"KRN",3.6,0)
3.6
"BLD",5008,"KRN",3.8,0)
3.8
"BLD",5008,"KRN",9.2,0)
9.2
"BLD",5008,"KRN",9.8,0)
9.8
"BLD",5008,"KRN",9.8,"NM",0)
^9.68A^51^45
"BLD",5008,"KRN",9.8,"NM",4,0)
PRCPAGP1^^0^B29394147
"BLD",5008,"KRN",9.8,"NM",5,0)
PRCPAGRO^^0^B15045833
"BLD",5008,"KRN",9.8,"NM",6,0)
PRCPAGS1^^0^B21098347
"BLD",5008,"KRN",9.8,"NM",7,0)
PRCPAODI^^0^B47623250
"BLD",5008,"KRN",9.8,"NM",8,0)
PRCPEIL0^^0^B24762317
"BLD",5008,"KRN",9.8,"NM",9,0)
PRCPEITE^^0^B31335514
"BLD",5008,"KRN",9.8,"NM",10,0)
PRCPEITG^^0^B7383274
"BLD",5008,"KRN",9.8,"NM",11,0)
PRCPLO3^^0^B36921649
"BLD",5008,"KRN",9.8,"NM",12,0)
PRCPLO2^^0^B45937677
"BLD",5008,"KRN",9.8,"NM",13,0)
PRCPLO2A^^0^B60268350
"BLD",5008,"KRN",9.8,"NM",14,0)
PRCPLO4^^0^B35020662
"BLD",5008,"KRN",9.8,"NM",15,0)
PRCPRAIP^^0^B18810373
"BLD",5008,"KRN",9.8,"NM",16,0)
PRCPRAL1^^0^B23523734
"BLD",5008,"KRN",9.8,"NM",17,0)
PRCPRALS^^0^B33007246
"BLD",5008,"KRN",9.8,"NM",18,0)
PRCPRCFP^^0^B19712138
"BLD",5008,"KRN",9.8,"NM",19,0)
PRCPRCTP^^0^B20211721
"BLD",5008,"KRN",9.8,"NM",20,0)
PRCPRIIP^^0^B29831261
"BLD",5008,"KRN",9.8,"NM",21,0)
PRCPRINV^^0^B23141545
"BLD",5008,"KRN",9.8,"NM",22,0)
PRCPRIT1^^0^B27403400
"BLD",5008,"KRN",9.8,"NM",23,0)
PRCPRODA^^0^B28089294
"BLD",5008,"KRN",9.8,"NM",24,0)
PRCPRODM^^0^B47898792
"BLD",5008,"KRN",9.8,"NM",25,0)
PRCPRSO1^^0^B14821624
"BLD",5008,"KRN",9.8,"NM",26,0)
PRCPRSOH^^0^B24420509
"BLD",5008,"KRN",9.8,"NM",27,0)
PRCPRSS0^^0^B21505747
"BLD",5008,"KRN",9.8,"NM",28,0)
PRCPRSS1^^0^B38734810
"BLD",5008,"KRN",9.8,"NM",29,0)
PRCPRSSP^^0^B33524984
"BLD",5008,"KRN",9.8,"NM",30,0)
PRCPRSSR^^0^B28781841
"BLD",5008,"KRN",9.8,"NM",31,0)
PRCPRSTK^^0^B8034390
"BLD",5008,"KRN",9.8,"NM",32,0)
PRCPRUS1^^0^B21618591
"BLD",5008,"KRN",9.8,"NM",33,0)
PRCPRUSE^^0^B26326932
"BLD",5008,"KRN",9.8,"NM",34,0)
PRCPRUSP^^0^B21023718
"BLD",5008,"KRN",9.8,"NM",35,0)
PRCPUX2^^0^B14304958
"BLD",5008,"KRN",9.8,"NM",36,0)
PRCPXALL^^0^B1737679
"BLD",5008,"KRN",9.8,"NM",37,0)
PRCPXODI^^0^B8307389
"BLD",5008,"KRN",9.8,"NM",38,0)
PRCPXTRM^^0^B15984033
"BLD",5008,"KRN",9.8,"NM",39,0)
PRCPRUS2^^0^B33114061
"BLD",5008,"KRN",9.8,"NM",40,0)
PRCPLO^^0^B77921532
"BLD",5008,"KRN",9.8,"NM",41,0)
PRCPURS1^^0^B13383807
"BLD",5008,"KRN",9.8,"NM",42,0)
PRCHLO2^^0^B62073341
"BLD",5008,"KRN",9.8,"NM",43,0)
PRCPUINV^^0^B22949954
"BLD",5008,"KRN",9.8,"NM",46,0)
PRCPRIT0^^0^B2686426
"BLD",5008,"KRN",9.8,"NM",47,0)
PRCHLO4^^0^B89091376
"BLD",5008,"KRN",9.8,"NM",49,0)
PRCHLO5^^0^B81680096
"BLD",5008,"KRN",9.8,"NM",50,0)
PRCHLO4A^^0^B64544632
"BLD",5008,"KRN",9.8,"NM",51,0)
PRCPRODS^^0^B26200620
"BLD",5008,"KRN",9.8,"NM","B","PRCHLO2",42)

"BLD",5008,"KRN",9.8,"NM","B","PRCHLO4",47)

"BLD",5008,"KRN",9.8,"NM","B","PRCHLO4A",50)

"BLD",5008,"KRN",9.8,"NM","B","PRCHLO5",49)

"BLD",5008,"KRN",9.8,"NM","B","PRCPAGP1",4)

"BLD",5008,"KRN",9.8,"NM","B","PRCPAGRO",5)

"BLD",5008,"KRN",9.8,"NM","B","PRCPAGS1",6)

"BLD",5008,"KRN",9.8,"NM","B","PRCPAODI",7)

"BLD",5008,"KRN",9.8,"NM","B","PRCPEIL0",8)

"BLD",5008,"KRN",9.8,"NM","B","PRCPEITE",9)

"BLD",5008,"KRN",9.8,"NM","B","PRCPEITG",10)

"BLD",5008,"KRN",9.8,"NM","B","PRCPLO",40)

"BLD",5008,"KRN",9.8,"NM","B","PRCPLO2",12)

"BLD",5008,"KRN",9.8,"NM","B","PRCPLO2A",13)

"BLD",5008,"KRN",9.8,"NM","B","PRCPLO3",11)

"BLD",5008,"KRN",9.8,"NM","B","PRCPLO4",14)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRAIP",15)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRAL1",16)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRALS",17)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRCFP",18)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRCTP",19)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRIIP",20)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRINV",21)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRIT0",46)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRIT1",22)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRODA",23)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRODM",24)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRODS",51)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRSO1",25)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRSOH",26)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRSS0",27)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRSS1",28)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRSSP",29)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRSSR",30)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRSTK",31)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRUS1",32)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRUS2",39)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRUSE",33)

"BLD",5008,"KRN",9.8,"NM","B","PRCPRUSP",34)

"BLD",5008,"KRN",9.8,"NM","B","PRCPUINV",43)

"BLD",5008,"KRN",9.8,"NM","B","PRCPURS1",41)

"BLD",5008,"KRN",9.8,"NM","B","PRCPUX2",35)

"BLD",5008,"KRN",9.8,"NM","B","PRCPXALL",36)

"BLD",5008,"KRN",9.8,"NM","B","PRCPXODI",37)

"BLD",5008,"KRN",9.8,"NM","B","PRCPXTRM",38)

"BLD",5008,"KRN",19,0)
19
"BLD",5008,"KRN",19,"NM",0)
^9.68A^11^11
"BLD",5008,"KRN",19,"NM",1,0)
PRCP ON-DEMAND USERS^^0
"BLD",5008,"KRN",19,"NM",2,0)
PRCP ON-DEMAND CONFLICT REPORT^^0
"BLD",5008,"KRN",19,"NM",3,0)
PRCP ON-DEMAND AUDIT REPORT^^0
"BLD",5008,"KRN",19,"NM",4,0)
PRCHUSER COORDINATOR^^2
"BLD",5008,"KRN",19,"NM",5,0)
PRCP MANAGER MENU^^2
"BLD",5008,"KRN",19,"NM",6,0)
PRCP REPORTS MENU^^2
"BLD",5008,"KRN",19,"NM",7,0)
PRCP2 MANAGER MENU^^2
"BLD",5008,"KRN",19,"NM",8,0)
PRCP2 REPORTS MENU^^2
"BLD",5008,"KRN",19,"NM",9,0)
PRCPLO CLO SYSTEM PARAM^^0
"BLD",5008,"KRN",19,"NM",10,0)
PRCHLO CLO PROCUREMENT^^0
"BLD",5008,"KRN",19,"NM",11,0)
PRCPLO CLO GIP OPTION^^0
"BLD",5008,"KRN",19,"NM","B","PRCHLO CLO PROCUREMENT",10)

"BLD",5008,"KRN",19,"NM","B","PRCHUSER COORDINATOR",4)

"BLD",5008,"KRN",19,"NM","B","PRCP MANAGER MENU",5)

"BLD",5008,"KRN",19,"NM","B","PRCP ON-DEMAND AUDIT REPORT",3)

"BLD",5008,"KRN",19,"NM","B","PRCP ON-DEMAND CONFLICT REPORT",2)

"BLD",5008,"KRN",19,"NM","B","PRCP ON-DEMAND USERS",1)

"BLD",5008,"KRN",19,"NM","B","PRCP REPORTS MENU",6)

"BLD",5008,"KRN",19,"NM","B","PRCP2 MANAGER MENU",7)

"BLD",5008,"KRN",19,"NM","B","PRCP2 REPORTS MENU",8)

"BLD",5008,"KRN",19,"NM","B","PRCPLO CLO GIP OPTION",11)

"BLD",5008,"KRN",19,"NM","B","PRCPLO CLO SYSTEM PARAM",9)

"BLD",5008,"KRN",19.1,0)
19.1
"BLD",5008,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",5008,"KRN",19.1,"NM",1,0)
PRCPODI^^0
"BLD",5008,"KRN",19.1,"NM","B","PRCPODI",1)

"BLD",5008,"KRN",101,0)
101
"BLD",5008,"KRN",101,"NM",0)
^9.68A^^
"BLD",5008,"KRN",409.61,0)
409.61
"BLD",5008,"KRN",771,0)
771
"BLD",5008,"KRN",870,0)
870
"BLD",5008,"KRN",8989.51,0)
8989.51
"BLD",5008,"KRN",8989.51,"NM",0)
^9.68A^3^2
"BLD",5008,"KRN",8989.51,"NM",2,0)
PRC CLRS OUTLOOK MAILGROUP^^0
"BLD",5008,"KRN",8989.51,"NM",3,0)
PRC CLRS ADDRESS^^0
"BLD",5008,"KRN",8989.51,"NM","B","PRC CLRS ADDRESS",3)

"BLD",5008,"KRN",8989.51,"NM","B","PRC CLRS OUTLOOK MAILGROUP",2)

"BLD",5008,"KRN",8989.52,0)
8989.52
"BLD",5008,"KRN",8994,0)
8994
"BLD",5008,"KRN","B",.4,.4)

"BLD",5008,"KRN","B",.401,.401)

"BLD",5008,"KRN","B",.402,.402)

"BLD",5008,"KRN","B",.403,.403)

"BLD",5008,"KRN","B",.5,.5)

"BLD",5008,"KRN","B",.84,.84)

"BLD",5008,"KRN","B",3.6,3.6)

"BLD",5008,"KRN","B",3.8,3.8)

"BLD",5008,"KRN","B",9.2,9.2)

"BLD",5008,"KRN","B",9.8,9.8)

"BLD",5008,"KRN","B",19,19)

"BLD",5008,"KRN","B",19.1,19.1)

"BLD",5008,"KRN","B",101,101)

"BLD",5008,"KRN","B",409.61,409.61)

"BLD",5008,"KRN","B",771,771)

"BLD",5008,"KRN","B",870,870)

"BLD",5008,"KRN","B",8989.51,8989.51)

"BLD",5008,"KRN","B",8989.52,8989.52)

"BLD",5008,"KRN","B",8994,8994)

"BLD",5008,"QUES",0)
^9.62^^
"BLD",5008,"REQB",0)
^9.611^^
"DATA",446.5,1,0)
PRIMARY/SECONDARY LABEL^445^^^^4
"DATA",446.5,1,1,0)
^446.51^3^3^3070131^^^^
"DATA",446.5,1,1,1,0)
|1||7|
"DATA",446.5,1,1,2,0)
L:|3| R:|4| U:|5| OD:|2|
"DATA",446.5,1,1,3,0)
|6||8|
"DATA",446.5,1,2,0)
^446.52I^8^8
"DATA",446.5,1,2,1,0)
1^2^^^^^^^DESCRIPTION
"DATA",446.5,1,2,1,1)
S X=$E($$DESCR^PRCPUX1(D0,D1),1,33)
"DATA",446.5,1,2,2,0)
2^2^^1,.8^^^^^ON-DEMAND ITEM FLAG
"DATA",446.5,1,2,2,1)
S X=$S($$ODITEM^PRCPUX2(D0,D1)="Y":"Y",1:"N")
"DATA",446.5,1,2,3,0)
3^1^^1,9^^^^^LEVEL^^5
"DATA",446.5,1,2,4,0)
4^1^^1,10^^^^^REORDER POINT^^5
"DATA",446.5,1,2,5,0)
5^2^^^^^^^UNITS PER ISSUE
"DATA",446.5,1,2,5,1)
S X=$$UNIT^PRCPUX1(D0,D1,"/")
"DATA",446.5,1,2,6,0)
6^2^^^^^^^ITEM NO.
"DATA",446.5,1,2,6,1)
S X="IE"_D0_" "_D1
"DATA",446.5,1,2,7,0)
7^1^^1,0^^^^^TEST
"DATA",446.5,1,2,8,0)
8^2^^^^^^^PAUSE
"DATA",446.5,1,2,8,1)
H 1
"DATA",446.5,1,3,0)
^^3^3^3070131
"DATA",446.5,1,3,1,0)
S PRCT="1^1" D XEC^PRCTLAB;Y1
"DATA",446.5,1,3,2,0)
1,S PRCT="1^2" D XEC^PRCTLAB;Y1,S PRCT="1^3" D XEC^PRCTLAB;C1,S PRCT="1^4" D XEC^PRCTLAB;C1,9;Y1;L5,S PRCT="1^5" D XEC^PRCTLAB;Y1,10;Y1;L5,S PRCT="1^6" D XEC^PRCTLAB;Y1,S PRCT="1^7" D XEC^PRCTLAB;Y1,S PRCT="1^8" D XEC^PRCTLAB;Y1
"DATA",446.5,1,3,3,0)
1,S PRCT="1^9" D XEC^PRCTLAB;Y1,S PRCT="1^10" D XEC^PRCTLAB;C1,S PRCT="1^11" D XEC^PRCTLAB;Y1,S PRCT="1^12" D XEC^PRCTLAB;Y1,S PRCT="1^13" D XEC^PRCTLAB;Y1
"DATA",446.5,1,4,0)
^^13^13^3070131
"DATA",446.5,1,4,1,0)
S X="" I '$D(PRCTSC) S PRCTSC=1 S PRCT="4^1" D SPC^PRCTLAB
"DATA",446.5,1,4,2,0)
S PRCT="4^2" D SPC^PRCTLAB
"DATA",446.5,1,4,3,0)
S X=$E($$DESCR^PRCPUX1(D0,D1),1,33)
"DATA",446.5,1,4,4,0)
S X="L:"
"DATA",446.5,1,4,5,0)
S X=" R:"
"DATA",446.5,1,4,6,0)
S X=" U:"
"DATA",446.5,1,4,7,0)
S X=$$UNIT^PRCPUX1(D0,D1,"/")
"DATA",446.5,1,4,8,0)
S X=" OD:"
"DATA",446.5,1,4,9,0)
S X=$S($$ODITEM^PRCPUX2(D0,D1)="Y":"Y",1:"N")
"DATA",446.5,1,4,10,0)
S X="IE"_D0_" "_D1
"DATA",446.5,1,4,11,0)
H 1
"DATA",446.5,1,4,12,0)
S:'$D(PRCTCP) PRCTCP=PRCTCPY S PRCTCP=PRCTCP-1 S:PRCTCP D0=D0-.0001 K:PRCTCP=0 PRCTCP S X=""
"DATA",446.5,1,4,13,0)
S PRCT="4^3" D SPC^PRCTLAB
"FIA",445)
GENERIC INVENTORY
"FIA",445,0)
^PRCP(445,
"FIA",445,0,0)
445Is
"FIA",445,0,1)
y^n^p^^^^n^^n
"FIA",445,0,10)

"FIA",445,0,11)

"FIA",445,0,"RLRO")

"FIA",445,0,"VR")
5.1^PRC
"FIA",445,445)
1
"FIA",445,445,27)

"FIA",445,445.01)
1
"FIA",445,445.01,.8)

"FIA",445,445.01,.81)

"FIA",445,445.027)
0
"FIA",445,445.13)
0
"FIA",446.5)
CUSTOM LABEL
"FIA",446.5,0)
^PRCT(446.5,
"FIA",446.5,0,0)
446.5
"FIA",446.5,0,1)
n^n^f^^y^^y^r^y
"FIA",446.5,0,10)

"FIA",446.5,0,11)
I $P(^PRCT(446.5,+Y,0),"^",1)="PRIMARY/SECONDARY LABEL"
"FIA",446.5,0,"RLRO")

"FIA",446.5,0,"VR")
5.1^PRC
"FIA",446.5,446.5)
0
"FIA",446.5,446.51)
0
"FIA",446.5,446.52)
0
"FIA",446.5,446.53)
0
"FIA",446.5,446.54)
0
"FIA",446.7)
CLRS REPORT STORAGE
"FIA",446.7,0)
^PRCP(446.7,
"FIA",446.7,0,0)
446.7
"FIA",446.7,0,1)
y^n^f^^^^n^^
"FIA",446.7,0,10)

"FIA",446.7,0,11)

"FIA",446.7,0,"RLRO")

"FIA",446.7,0,"VR")
5.1^PRC
"FIA",446.7,446.7)
0
"FRV1",446.5,"1,0",2)
GENERIC INVENTORY
"FRV1",446.5,"1,0",2,"F")
;DIC(
"FRV1",446.5,"1,0",6)
LABEL 3X1/INTERMEC 8646
"FRV1",446.5,"1,0",6,"F")
;PRCT(446.6,
"INI")
BARCODE^PRC5198P
"INIT")
INIT^PRC5198P
"IX",445,445,"AJ",0)
445^AJ^ODI Users ^R^^F^IR^W^445.027^^^^^S
"IX",445,445,"AJ",.1,0)
^^6^6^3060714^
"IX",445,445,"AJ",.1,1,0)
This cross reference will house all of the DUZ's of users who have
"IX",445,445,"AJ",.1,2,0)
On-Demand authority and the inventory point(s) on which each user has this
"IX",445,445,"AJ",.1,3,0)
authority. It was created to facilitate maintaining the On-Demand User
"IX",445,445,"AJ",.1,4,0)
multiple for all affected inventory points whenever a user's access is
"IX",445,445,"AJ",.1,5,0)
terminated.  The file may also be used to quickly determine the specific
"IX",445,445,"AJ",.1,6,0)
inventory points on which any given user has the On-Demand authority.
"IX",445,445,"AJ",1)
S ^PRCP(445,"AJ",X,DA(1),DA)=""
"IX",445,445,"AJ",2)
K ^PRCP(445,"AJ",X,DA(1),DA)
"IX",445,445,"AJ",2.5)
K ^PRCP(445,"AJ")
"IX",445,445,"AJ",11.1,0)
^.114IA^1^1
"IX",445,445,"AJ",11.1,1,0)
1^F^445.027^.01^^1^F
"KRN",.4,2344,-1)
0^1
"KRN",.4,2344,0)
PRCP REPORT:COMPREHENSIVE^3060622.1508^@^445^^@^3070306
"KRN",.4,2344,"%D",0)
^.4001^1^1^3060621^^^
"KRN",.4,2344,"%D",1,0)
This print template is used to print the Comprehensive Item Report.
"KRN",.4,2344,"DXS",1,9)
S %=$P($G(^PRC(441,D1,4,+$G(PRCPFCP),0)),U,2) S:'% %=$P($G(^PRC(441,D1,0)),U,10) W !?7 W:($P($G(^PRCP(445,D0,0)),U,3)'="W") ?8,"ON-DEMAND: ",$S($$ODITEM^PRCPUX2(D0,D1)="Y":"D",1:""),?29 W "SUBACCOUNT: ",%
"KRN",.4,2344,"DXS",2,9)
I $P(^PRCP(445,D0,1,D1,0),"^",26)="Y" W ?19,"** DELETE ITEM WHEN QTY ON HAND REACHES ZERO **"
"KRN",.4,2344,"F",1)
1,-441,^PRC(441,^^S I(1,0)=D1 S I(0,0)=D0 S DIP(1)=$S($D(^PRCP(445,D0,1,D1,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X S D(0)=+X;Z;".01:"~1,-441,5~
"KRN",.4,2344,"F",2)
1,W ?19,$E($$DESCR^PRCPUX1(D0,D1),1,28);"DESCRIPTION";Z;"W ?19,$E($$DESCR^PRCPUX1(D0,D1),1,28)"~1,W ?49,"[#",D1,"]";"[#IM]";C50;Z;"W ?49,"[#",D1,"]""~
"KRN",.4,2344,"F",3)
1,.5;"GROUP_CATEGORY_DESC";L;C60~
"KRN",.4,2344,"F",4)
1,-445.6,^PRCP(445.6,^^S I(1,0)=D1 S I(0,0)=D0 S DIP(1)=$S($D(^PRCP(445,D0,1,D1,0)):^(0),1:"") S X=$P(DIP(1),U,21),X=X S D(0)=+X;Z;".5:"~1,-445.6,2;X;L16;C65~
"KRN",.4,2344,"F",5)
1,X DXS(1,9);X;Z;"S %=$P($G(^PRC(441,D1,4,+$G(PRCPFCP),0)),U,2) S:'% %=$P($G(^PRC(441,D1,0)),U,10) W !?7 W:($P($G(^PRCP(445,D0,0)),U,3)'="W") ?8,"ON-DEMAND: ",$S($$ODITEM^PRCPUX2(D0,D1)="Y":"D",1:""),?29 W "SUBACCOUNT: ",%"~
"KRN",.4,2344,"F",6)
1,"UNIT per ISSUE: ";C4~1,W $$UNIT^PRCPUX1(D0,D1," per ");X;Z;"W $$UNIT^PRCPUX1(D0,D1," per ")"~1,"QTY ON HAND: ";C7~1,7;X;L~1,"DUE-IN: ";C34~1,8.1;X;L~
"KRN",.4,2344,"F",7)
1,"DUE-OUT: ";C61~1,8.6;X;L~1,X DXS(2,9);C20;X;Z;"I $P(^PRCP(445,D0,1,D1,0),"^",26)="Y" W ?19,"** DELETE ITEM WHEN QTY ON HAND REACHES ZERO **""~
"KRN",.4,2344,"F",8)
1,"NORM STK LVL: ";C6~1,9;X;L~1,"REORDER PT: ";C30~1,10;X;L~1,"INT ORDER PT: ";C56~1,10.3;X;L~1,"EMERGENCY LVL: ";C5~1,11;X;L~1,"ISSUE MULT: ";C30~
"KRN",.4,2344,"F",9)
1,16;X;L~1,"MIN ISSUE QTY: ";C55~1,16.5;X;L~1,"TEMP STK LVL: ";C6~1,9.5;X;L~1,"UNTIL DATE: ";C30~1,9.6;X;L~1,"LAST COST: ";C9~1,4.7;X;L;D3~
"KRN",.4,2344,"F",10)
1,"LAST REC'D: ";C30~1,4.6;X;L~1,"AVERAGE COST: ";C56~1,4.8;X;L;D3~1,"MAIN STORAGE LOC: ";C2~1,5;X;L60~
"KRN",.4,2344,"F",11)
1,"-----POSSIBLE SOURCES (m=MANDATORY SOURCE)-----";C16;S1~1,"VENDOR";C6~1,"[#V]";C38~1,"CONV FACT";C46~1,"UNIT per REC";C69~
"KRN",.4,2344,"F",12)
1,.6,I $P(^PRCP(445,D0,1,D1,5,D2,0),"^")=$P(^PRCP(445,D0,1,D1,0),"^",12) W ?3,"m";X;C4;Z;"I $P(^PRCP(445,D0,1,D1,5,D2,0),"^")=$P(^PRCP(445,D0,1,D1,0),"^",12) W ?3,"m""~
"KRN",.4,2344,"F",13)
1,.6,.01;C6;L27;X~1,.6,W ?37,"[#",+$P(^PRCP(445,D0,1,D1,5,D2,0),"^"),"]";X;C38;Z;"W ?37,"[#",+$P(^PRCP(445,D0,1,D1,5,D2,0),"^"),"]""~
"KRN",.4,2344,"F",14)
1,.6,S X=^PRCP(445,D0,1,D1,5,D2,0) S:+$P(X,"^",4)=0 $P(X,"^",4)=1 W ?45,$J($P(X,"^",4),9);X;Z;"S X=^PRCP(445,D0,1,D1,5,D2,0) S:+$P(X,"^",4)=0 $P(X,"^",4)=1 W ?45,$J($P(X,"^",4),9)"~
"KRN",.4,2344,"F",15)
1,.6,2;X;C69;R4~1,.6,"per ";X;C74~1,.6,1;X;L~S PRCPDOT="",$P(PRCPDOT,".",81)="" W PRCPDOT;C1;X;Z;"S PRCPDOT="",$P(PRCPDOT,".",81)="" W PRCPDOT"~
"KRN",.4,2344,"H")
COMPREHENSIVE ITEM REPORT
"KRN",.4,2344,"ROUOLD")

"KRN",19,10186,-1)
2^6
"KRN",19,10186,0)
PRCP REPORTS MENU^Reports Menu^^M^68^^^^^^^^^1
"KRN",19,10186,10,0)
^19.01IP^18^18
"KRN",19,10186,10,18,0)
12172
"KRN",19,10186,10,18,"^")
PRCP ON-DEMAND CONFLICT REPORT
"KRN",19,10186,"U")
REPORTS MENU
"KRN",19,10194,-1)
2^5
"KRN",19,10194,0)
PRCP MANAGER MENU^Manager For Primary Inventory Point Menu^^M^68^PRCP MGRKEY^^^^^^^^1
"KRN",19,10194,10,0)
^19.01IP^12^12
"KRN",19,10194,10,12,0)
12171
"KRN",19,10194,10,12,"^")
PRCP ON-DEMAND AUDIT REPORT
"KRN",19,10194,"U")
MANAGER FOR PRIMARY INVENTORY 
"KRN",19,10202,-1)
2^8
"KRN",19,10202,0)
PRCP2 REPORTS MENU^Reports Menu^^M^2429^^^^^^^^^1
"KRN",19,10202,10,0)
^19.01IP^16^16
"KRN",19,10202,10,16,0)
12172
"KRN",19,10202,10,16,"^")
PRCP ON-DEMAND CONFLICT REPORT
"KRN",19,10202,"U")
REPORTS MENU
"KRN",19,10203,-1)
2^7
"KRN",19,10203,0)
PRCP2 MANAGER MENU^Manager For Secondary Point Menu^^M^68^PRCP2 MGRKEY^^^^^^^^1
"KRN",19,10203,10,0)
^19.01IP^7^7
"KRN",19,10203,10,7,0)
12171
"KRN",19,10203,10,7,"^")
PRCP ON-DEMAND AUDIT REPORT
"KRN",19,10203,"U")
MANAGER FOR SECONDARY POINT ME
"KRN",19,10347,-1)
2^4
"KRN",19,10347,0)
PRCHUSER COORDINATOR^IFCAP Application Coordinator Menu^^M^68^^^^^^^455
"KRN",19,10347,10,0)
^19.01IP^19^18
"KRN",19,10347,10,18,0)
12170
"KRN",19,10347,10,18,"^")
PRCP ON-DEMAND USERS
"KRN",19,10347,"U")
IFCAP APPLICATION COORDINATOR 
"KRN",19,12148,-1)
0^11
"KRN",19,12148,0)
PRCPLO CLO GIP OPTION^CLO GIP Reports (CLRS)^^R^^^^^^^^IFCAP
"KRN",19,12148,1,0)
^^11^11^3061227^
"KRN",19,12148,1,1,0)
This is the option used by the Prosthetics and Clinical Logistics Office
"KRN",19,12148,1,2,0)
to gather GIP information.  It runs the Stock Status Report and Days of
"KRN",19,12148,1,3,0)
Stock on Hand Report for every combination of station and active inventory
"KRN",19,12148,1,4,0)
point present within a system and creates extracts in the CLRS REPORT
"KRN",19,12148,1,5,0)
STORAGE file (#446.7).  
"KRN",19,12148,1,6,0)
 
"KRN",19,12148,1,7,0)
These extracts are "*" delimited files and encompass data extracted from
"KRN",19,12148,1,8,0)
the first day of the previous month to the last day of the previous
"KRN",19,12148,1,9,0)
month.  The extracts are stored in the CLRS REPORT STORAGE file (#446.7)
"KRN",19,12148,1,10,0)
until the FTP transmission to the CLRS occur as instructed by the
"KRN",19,12148,1,11,0)
Prosthetics and Clinical Logistics Office.
"KRN",19,12148,25)
ENT^PRCPLO3
"KRN",19,12148,"U")
CLO GIP REPORTS (CLRS)
"KRN",19,12149,-1)
0^9
"KRN",19,12149,0)
PRCPLO CLO SYSTEM PARAM^CLO System Parameters (CLRS)^^R^^XUPROG^^^^^^IFCAP
"KRN",19,12149,1,0)
^^6^6^3060425^
"KRN",19,12149,1,1,0)
This option presents the user with the current value for the system 
"KRN",19,12149,1,2,0)
parameters associated with the Clinical Logistics Report Server and
"KRN",19,12149,1,3,0)
prompts the user to enter new values if needed.  Entries are screened for
"KRN",19,12149,1,4,0)
validity and any setting errors are returned to the user. This option is
"KRN",19,12149,1,5,0)
only intended to be used by IRM staff and access to it is restricted to
"KRN",19,12149,1,6,0)
those who have the XUPROG security key.
"KRN",19,12149,25)
ENT^PRCPLO4
"KRN",19,12149,"U")
CLO SYSTEM PARAMETERS (CLRS)
"KRN",19,12150,-1)
0^10
"KRN",19,12150,0)
PRCHLO CLO PROCUREMENT^CLO Procurement Reports (CLRS)^^R^^^^^^^^IFCAP
"KRN",19,12150,1,0)
^^4^4^3061227^
"KRN",19,12150,1,1,0)
This option runs the procurement extracts associated with the CLRS and
"KRN",19,12150,1,2,0)
will be scheduled to run as directed by the Prosthetics & Clinical
"KRN",19,12150,1,3,0)
Logistics Office.  As part of this process, the flat files for both the PO
"KRN",19,12150,1,4,0)
Activity and GIP extracts are created for FTP transmission.
"KRN",19,12150,25)
ENT^PRCHLO5
"KRN",19,12150,"U")
CLO PROCUREMENT REPORTS (CLRS)
"KRN",19,12170,-1)
0^1
"KRN",19,12170,0)
PRCP ON-DEMAND USERS^On-Demand Users Enter/Edit^^R^^PRCPODI^^^^^^
"KRN",19,12170,1,0)
^19.06^3^3^3061218^^^
"KRN",19,12170,1,1,0)
This option allows the application coordinator to assign or delete 
"KRN",19,12170,1,2,0)
specified users access to change the On-Demand setting of items in
"KRN",19,12170,1,3,0)
specified inventory points.
"KRN",19,12170,25)
ENT^PRCPAODI
"KRN",19,12170,"U")
ON-DEMAND USERS ENTER/EDIT
"KRN",19,12171,-1)
0^3
"KRN",19,12171,0)
PRCP ON-DEMAND AUDIT REPORT^On-Demand Audit Activity Report^^R^^^^^^^^
"KRN",19,12171,1,0)
^^4^4^3060613^
"KRN",19,12171,1,1,0)
This report will list information for any item in the selected inventory
"KRN",19,12171,1,2,0)
point whose On-Demand setting has ever been changed.  The report will
"KRN",19,12171,1,3,0)
include the date/time of the change, who made the change, the reason for
"KRN",19,12171,1,4,0)
the change and what the setting was set to.
"KRN",19,12171,25)
PRIMARY^PRCPRODA
"KRN",19,12171,"U")
ON-DEMAND AUDIT ACTIVITY REPOR
"KRN",19,12172,-1)
0^2
"KRN",19,12172,0)
PRCP ON-DEMAND CONFLICT REPORT^On-Demand Conflicts Report^^R^^^^^^^^
"KRN",19,12172,1,0)
^^4^4^3060921^
"KRN",19,12172,1,1,0)
This report lists all the items whose On-Demand Setting is 'NO' in the
"KRN",19,12172,1,2,0)
Secondary and 'YES' in the Primary Inventory Point.  The Primary 
"KRN",19,12172,1,3,0)
Inventory Point used to make the comparison is the mandatory source for 
"KRN",19,12172,1,4,0)
the item in the Secondary Inventory Point.
"KRN",19,12172,25)
PRIM^PRCPRODM
"KRN",19,12172,"U")
ON-DEMAND CONFLICTS REPORT
"KRN",19.1,464,-1)
0^1
"KRN",19.1,464,0)
PRCPODI^PRCPODI^^
"KRN",19.1,464,1,0)
^^4^4^3061220^
"KRN",19.1,464,1,1,0)
This key enables the application coordinator to use the PRCP ON-DEMAND 
"KRN",19.1,464,1,2,0)
USERS option in order to authorize a primary or secondary inventory point
"KRN",19.1,464,1,3,0)
manager the ability to change the on-demand setting of an item within a
"KRN",19.1,464,1,4,0)
specified inventory point.
"KRN",8989.51,4770,-1)
0^3
"KRN",8989.51,4770,0)
PRC CLRS ADDRESS^PRC CLRS ADDRESS^0^^^0
"KRN",8989.51,4770,1)
F^$L(X)<245^Enter the IP address or DNS Server name identified as the location of the CLRS.
"KRN",8989.51,4770,4,0)
^8989.514^2^2
"KRN",8989.51,4770,4,1,0)
CLRS
"KRN",8989.51,4770,4,2,0)
PRC
"KRN",8989.51,4770,4,"B","CLRS",1)

"KRN",8989.51,4770,4,"B","PRC",2)

"KRN",8989.51,4770,20,0)
^^4^4^3060717^
"KRN",8989.51,4770,20,1,0)
This parameter will store the location of the Clinical Logistics Report 
"KRN",8989.51,4770,20,2,0)
Server in either IP address or DNS Server name form.  An error 
"KRN",8989.51,4770,20,3,0)
notification will be sent through MailMan if no value is present in this 
"KRN",8989.51,4770,20,4,0)
parameter when a transfer to the CLRS is attempted.
"KRN",8989.51,4770,30,0)
^8989.513I^^0
"KRN",8989.51,4771,-1)
0^2
"KRN",8989.51,4771,0)
PRC CLRS OUTLOOK MAILGROUP^PRC CLRS OUTLOOK MAILGROUP^0^^^0
"KRN",8989.51,4771,1)
F^$L(X)<245^Enter the Microsoft Outlook mail group that should receive CLRS notifications.
"KRN",8989.51,4771,4,0)
^8989.514^2^2
"KRN",8989.51,4771,4,1,0)
CLRS
"KRN",8989.51,4771,4,2,0)
PRC
"KRN",8989.51,4771,4,"B","CLRS",1)

"KRN",8989.51,4771,4,"B","PRC",2)

"KRN",8989.51,4771,20,0)
^^4^4^3060425^
"KRN",8989.51,4771,20,1,0)
This parameter will hold the name of the Microsoft Outlook mail group 
"KRN",8989.51,4771,20,2,0)
that should receive Clinical Logistics Report Server activity 
"KRN",8989.51,4771,20,3,0)
notifications.  The mail group name must be completely and accurately 
"KRN",8989.51,4771,20,4,0)
entered for this functionality to operate correctly.
"MBREQ")
0
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PGL",446.5,0,2,.02)
FILE^P1'X^DIC(^0;2^I $P(^PRCT(446.5,D0,0),"^",2),$P(^(0),"^",2)'=X W *7,!!,"Since you have change the file, be sure to review all 'FIELD' type parameters",!
"PGL",446.5,0,6,.06)
SPECIALTY COMMANDS^P446.6'^PRCT(446.6,^0;6^Q
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
98^3070306
"PKG",455,22,1,"PAH",1,1,0)
^^2^2^3070306
"PKG",455,22,1,"PAH",1,1,1,0)
This patch addresses an enhancement request to modify IFCAP to properly 
"PKG",455,22,1,"PAH",1,1,2,0)
classify On Demand Items (ODI).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
46
"RTN","PRC5198P")
0^^B7872585^n/a
"RTN","PRC5198P",1,0)
PRC5198P ;WOIFO/DAP-POST INSTALL TO PRC*5.1*98;05/18/06 ; 1/24/07 2:18pm
"RTN","PRC5198P",2,0)
V ;;5.1;IFCAP;**98**;Oct 20,2000;Build 37
"RTN","PRC5198P",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","PRC5198P",4,0)
 Q
"RTN","PRC5198P",5,0)
 ;
"RTN","PRC5198P",6,0)
INIT ;Entry point for routine that makes two calls out to EN^XPAR and sets
"RTN","PRC5198P",7,0)
 ;two system level parameters to their desired initial values using
"RTN","PRC5198P",8,0)
 ;methods detailed in IA #2263
"RTN","PRC5198P",9,0)
 ;
"RTN","PRC5198P",10,0)
 N PRCPER,PRCPER1,ERRFLG,PRCPMG,PRCPAD
"RTN","PRC5198P",11,0)
 S ERRFLG=0
"RTN","PRC5198P",12,0)
 ;
"RTN","PRC5198P",13,0)
 ; Sets default value for PRC CLRS ADDRESS parameter
"RTN","PRC5198P",14,0)
 ;
"RTN","PRC5198P",15,0)
 S PRCPAD="10.128.102.204"
"RTN","PRC5198P",16,0)
 D EN^XPAR("SYS","PRC CLRS ADDRESS",1,PRCPAD,.PRCPER)
"RTN","PRC5198P",17,0)
 I PRCPER=0 D BMES^XPDUTL("PRC CLRS ADDRESS successfully set to 10.128.102.204")
"RTN","PRC5198P",18,0)
 I PRCPER'=0 S ERRFLG=1 D BMES^XPDUTL("Error while trying to edit the PRC CLRS ADDRESS:") D MES^XPDUTL($P(PRCPER,"^",2))
"RTN","PRC5198P",19,0)
 ;
"RTN","PRC5198P",20,0)
 ; Sets default value for PRC CLRS OUTLOOK MAILGROUP parameter
"RTN","PRC5198P",21,0)
 ;
"RTN","PRC5198P",22,0)
 S PRCPMG="VHACO10FPCLRS@e2k.va.gov"
"RTN","PRC5198P",23,0)
 D EN^XPAR("SYS","PRC CLRS OUTLOOK MAILGROUP",1,PRCPMG,.PRCPER1)
"RTN","PRC5198P",24,0)
 I PRCPER1=0 D MES^XPDUTL("PRC CLRS OUTLOOK MAILGROUP successfully set to "_PRCPMG_" .")
"RTN","PRC5198P",25,0)
 I PRCPER1'=0 S ERRFLG=1 D MES^XPDUTL("Error while trying to edit the PRC CLRS OUTLOOK MAILGROUP:") D MES^XPDUTL($P(PRCPER1,"^",2))
"RTN","PRC5198P",26,0)
 ;
"RTN","PRC5198P",27,0)
 D SETNEW
"RTN","PRC5198P",28,0)
 ;
"RTN","PRC5198P",29,0)
 I ERRFLG=0 D MES^XPDUTL("POST-INSTALL COMPLETED SUCCESSFULLY!")
"RTN","PRC5198P",30,0)
 I ERRFLG=1 D MES^XPDUTL("POST-INSTALL COMPLETED WITH ERRORS!!!")
"RTN","PRC5198P",31,0)
 ;
"RTN","PRC5198P",32,0)
 Q
"RTN","PRC5198P",33,0)
BARCODE ; Modified Barcode Label print codes for Pri/Sec Inventory Point
"RTN","PRC5198P",34,0)
 ; Pre-install process for PRC*5.1*98
"RTN","PRC5198P",35,0)
 ;
"RTN","PRC5198P",36,0)
 ; Print Template ^PRCT(446.5,IEN
"RTN","PRC5198P",37,0)
 ; 1. Get "Primary/Secondary Label" IEN
"RTN","PRC5198P",38,0)
 ; 2. Rename the label to "PRE-ODI PRIM-SECONDARY LABEL" 
"RTN","PRC5198P",39,0)
 ; 3. Reset the "B" cross refernce for this label   
"RTN","PRC5198P",40,0)
 ;
"RTN","PRC5198P",41,0)
 Q:+$O(^PRCT(446.5,"B","PRE-ODI PRIM/SECONDARY LABEL",0))
"RTN","PRC5198P",42,0)
 N IEN
"RTN","PRC5198P",43,0)
 S IEN=$$FIND1^DIC(446.5,,"BX","PRIMARY/SECONDARY LABEL")
"RTN","PRC5198P",44,0)
 I 'IEN D  Q
"RTN","PRC5198P",45,0)
 . D MES^XPDUTL("NO PRIMARY/SECONDARY LABEL FOUND BEFORE INSTALLATION.")
"RTN","PRC5198P",46,0)
 . D MES^XPDUTL("PRE-INSTALL COMPLETED SUCCESSFULLY!")
"RTN","PRC5198P",47,0)
 . Q
"RTN","PRC5198P",48,0)
 S $P(^PRCT(446.5,IEN,0),U,1)="PRE-ODI PRIM/SECONDARY LABEL"
"RTN","PRC5198P",49,0)
 S ^PRCT(446.5,"B","PRE-ODI PRIM/SECONDARY LABEL",IEN)=""
"RTN","PRC5198P",50,0)
 K ^PRCT(446.5,"B","PRIMARY/SECONDARY LABEL",IEN)
"RTN","PRC5198P",51,0)
 ;
"RTN","PRC5198P",52,0)
 D MES^XPDUTL("CUSTOM LABEL, PRIMARY/SECONDARY LABEL RENAMED TO PRE-ODI PRIM/SECONDARY LABEL.")
"RTN","PRC5198P",53,0)
 D MES^XPDUTL("PRE-INSTALL COMPLETED SUCCESSFULLY!")
"RTN","PRC5198P",54,0)
 Q
"RTN","PRC5198P",55,0)
 ;
"RTN","PRC5198P",56,0)
SETNEW ; Compile the new Print Label template "Primary/Secondary Label"
"RTN","PRC5198P",57,0)
 ;
"RTN","PRC5198P",58,0)
 N COMP,DA,D0,D1,DIC,DIE,DLAYGO,DQ,DR,ERR,FLS,FLDS,I,J,LN,MULT,NL,N0
"RTN","PRC5198P",59,0)
 N P,PRCT,PRCTE,T,T1,X,Y,%DT
"RTN","PRC5198P",60,0)
 S DA=$O(^PRCT(446.5,"B","PRIMARY/SECONDARY LABEL",0)) Q:'DA
"RTN","PRC5198P",61,0)
 D COMP^PRCTRED
"RTN","PRC5198P",62,0)
 D MES^XPDUTL("NEW PRIMARY/SECONDARY LABEL COMPILE COMPLETED.")
"RTN","PRC5198P",63,0)
 Q
"RTN","PRC5198P",64,0)
 ; 
"RTN","PRCHLO2")
0^42^B62073341^B59193374
"RTN","PRCHLO2",1,0)
PRCHLO2 ;WOIFO/RLL/DAP-EXTRACT ROUTINE (cont.)CLO REPORT SERVER ; 10/16/06 2:09pm
"RTN","PRCHLO2",2,0)
V ;;5.1;IFCAP;**83,98**; Oct 20, 2000;Build 37
"RTN","PRCHLO2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHLO2",4,0)
 ; Continuation of PRCHLO1. This program includes the extract
"RTN","PRCHLO2",5,0)
 ; logic for each of the 19 identified tables.
"RTN","PRCHLO2",6,0)
 ;
"RTN","PRCHLO2",7,0)
POITEM ; PoItem Table
"RTN","PRCHLO2",8,0)
 ;
"RTN","PRCHLO2",9,0)
 Q
"RTN","PRCHLO2",10,0)
 ;
"RTN","PRCHLO2",11,0)
POITEMH ; PoItem Table Header
"RTN","PRCHLO2",12,0)
 ;
"RTN","PRCHLO2",13,0)
 W "PoIdNum^PurchaseOrderNum^PoDate^MonthYrRun^StationNum^"
"RTN","PRCHLO2",14,0)
 W "LineItemIdNum^LineItemNumber^ItemMasterFileNumber^"
"RTN","PRCHLO2",15,0)
 W "ItemMasterDescription^NIFNumber^"
"RTN","PRCHLO2",16,0)
 ;
"RTN","PRCHLO2",17,0)
 W "Quantity^UnitOfPurchase^PackagingMultiple^ItemDeliveryPoints^"
"RTN","PRCHLO2",18,0)
 W "BOC^ContractBOA^ActualUnitCost^EstUnitCost^FedSupplyClass^"
"RTN","PRCHLO2",19,0)
 W "VendorStockNumber^NationalDrugCode^SKU^NSN^"
"RTN","PRCHLO2",20,0)
 W "UnitConversionFactor^TotalCost^DiscountedAmount^"
"RTN","PRCHLO2",21,0)
 W "Z410ItemNumber^LotNumber^SerialNumber"
"RTN","PRCHLO2",22,0)
 Q
"RTN","PRCHLO2",23,0)
POITEMW ; Write PO Item Data
"RTN","PRCHLO2",24,0)
 ;
"RTN","PRCHLO2",25,0)
 N GPOID,GPOND
"RTN","PRCHLO2",26,0)
 S GPOID=0,GPOND=""
"RTN","PRCHLO2",27,0)
 F  S GPOID=$O(^TMP($J,"POITEM",GPOID)) Q:GPOID=""  D
"RTN","PRCHLO2",28,0)
 . F  S GPOND=$O(^TMP($J,"POITEM",GPOID,GPOND)) Q:GPOND=""  D
"RTN","PRCHLO2",29,0)
 . . W !,$G(^TMP($J,"POITEM",GPOID,GPOND,0))
"RTN","PRCHLO2",30,0)
 . . Q
"RTN","PRCHLO2",31,0)
 . Q
"RTN","PRCHLO2",32,0)
 Q
"RTN","PRCHLO2",33,0)
POITLNH ; Write PO Line Inventory Point Header
"RTN","PRCHLO2",34,0)
 W "PoIdNum^PurchaseOrderNum^PoDate^MonthYrRun^StationNum^"
"RTN","PRCHLO2",35,0)
 W "LineItemIdNum^LineInvPtIdNum^LineInvPt^LineQty^LineDelivery^"
"RTN","PRCHLO2",36,0)
 W "QtyReceivedToDate",!
"RTN","PRCHLO2",37,0)
 Q
"RTN","PRCHLO2",38,0)
POITLNW ; Write PO Line Inventory Point Data
"RTN","PRCHLO2",39,0)
 N PITL,PITL1,PITL2
"RTN","PRCHLO2",40,0)
 S PITL=0,PITL1=0,PITL2=0
"RTN","PRCHLO2",41,0)
 F  S PITL=$O(^TMP($J,"POITEMLNINVPT",PITL)) Q:PITL=""  D
"RTN","PRCHLO2",42,0)
 . F  S PITL1=$O(^TMP($J,"POITEMLNINVPT",PITL,PITL1)) Q:PITL1=""  D
"RTN","PRCHLO2",43,0)
 . . W $G(^TMP($J,"POITEMLNINVPT",PITL,PITL1,1,0)),!
"RTN","PRCHLO2",44,0)
 . . Q
"RTN","PRCHLO2",45,0)
 . Q
"RTN","PRCHLO2",46,0)
 Q
"RTN","PRCHLO2",47,0)
GPOITEM ; Get PO Item record
"RTN","PRCHLO2",48,0)
 S U="^"
"RTN","PRCHLO2",49,0)
 N N0,N2,N4,PONUMB,STNUMB,PR2237,PODAT,CKIT,CKIT1,ITMID
"RTN","PRCHLO2",50,0)
 N POI1A,POI1B,POI1C,POIA,POIA1,POIA2,PO16E,PO16E1,PO16E2
"RTN","PRCHLO2",51,0)
 N PO17E,PO17E1,PO17E2,POIAF,POIA2A,IMID
"RTN","PRCHLO2",52,0)
 S CKIT=$G(^PRC(442,POID,2,0)),ITMID=0
"RTN","PRCHLO2",53,0)
 S CKIT1=$P(CKIT,U,3)
"RTN","PRCHLO2",54,0)
 I +CKIT1>0  D
"RTN","PRCHLO2",55,0)
 . S ITMID=0
"RTN","PRCHLO2",56,0)
 . F  S ITMID=$O(^PRC(442,POID,2,ITMID)) Q:ITMID=""  D
"RTN","PRCHLO2",57,0)
 . . I +ITMID>0  D  ; Got an item
"RTN","PRCHLO2",58,0)
 . . . S N0=$G(^PRC(442,POID,2,ITMID,0))
"RTN","PRCHLO2",59,0)
 . . . S N2=$G(^PRC(442,POID,2,ITMID,2))
"RTN","PRCHLO2",60,0)
 . . . S N4=$G(^PRC(442,POID,2,ITMID,4))
"RTN","PRCHLO2",61,0)
 . . . D LPPOITM   ; Loop on item
"RTN","PRCHLO2",62,0)
 . . . Q
"RTN","PRCHLO2",63,0)
 . . Q
"RTN","PRCHLO2",64,0)
 . Q
"RTN","PRCHLO2",65,0)
 Q
"RTN","PRCHLO2",66,0)
DITMD ; Set PO Item Description Data
"RTN","PRCHLO2",67,0)
 N ITMD,ITMD1,ITMD2,ITMD3
"RTN","PRCHLO2",68,0)
 ; get 1st 50 characters from 1st desc.
"RTN","PRCHLO2",69,0)
 S ITMD=$G(^PRC(442,POID,2,ITMID,1,1,0))
"RTN","PRCHLO2",70,0)
 Q:ITMD=""  ; make sure a description exists for the PO
"RTN","PRCHLO2",71,0)
 S ITMD1=$P(ITMD,U,1)
"RTN","PRCHLO2",72,0)
 S ITMD2=$E(ITMD1,1,175)
"RTN","PRCHLO2",73,0)
 S ITMD3=PPOKEY_U_ITMID_U_1_U_ITMD2
"RTN","PRCHLO2",74,0)
 S ^TMP($J,"POITEMDESC",POID,ITMID,0)=ITMD3
"RTN","PRCHLO2",75,0)
 Q
"RTN","PRCHLO2",76,0)
POLIDT ; PO line item date received
"RTN","PRCHLO2",77,0)
 N LIDT1,LIDT2,LIDT3,LIDT4,LIDT5,V1,V2,V3,V4,LDT1E,LDT1E1,LDT1E2
"RTN","PRCHLO2",78,0)
 S LIDT1=$G(^PRC(442,POID,2,ITMID,3,0))
"RTN","PRCHLO2",79,0)
 S LIDT2=$P(LIDT1,U,3)
"RTN","PRCHLO2",80,0)
 I +LIDT2>0  D
"RTN","PRCHLO2",81,0)
 . S LIDT3=0
"RTN","PRCHLO2",82,0)
 . F  S LIDT3=$O(^PRC(442,POID,2,ITMID,3,LIDT3)) Q:LIDT3=""  D
"RTN","PRCHLO2",83,0)
 . . Q:+LIDT3<0  ; quit at the x-ref
"RTN","PRCHLO2",84,0)
 . . S LIDT4=$G(^PRC(442,POID,2,ITMID,3,LIDT3,0))
"RTN","PRCHLO2",85,0)
 . . ; V1-V4 Get the data,$P the values, pad with "^" delimiters
"RTN","PRCHLO2",86,0)
 . . ; get external value for date received
"RTN","PRCHLO2",87,0)
 . . S LDT1E=$P(LIDT4,U,1)
"RTN","PRCHLO2",88,0)
 . . I LDT1E'="" S LDT1E1=$P(LDT1E,".",1),LDT1E2=$$FMTE^XLFDT(LDT1E1)
"RTN","PRCHLO2",89,0)
 . . I LDT1E="" S LDT1E2=""
"RTN","PRCHLO2",90,0)
 . . S V1=LDT1E2_U_$P(LIDT4,U,2)_U_$P(LIDT4,U,3)_U
"RTN","PRCHLO2",91,0)
 . . S V2=$P(LIDT4,U,4)_U_$P(LIDT4,U,5)_U
"RTN","PRCHLO2",92,0)
 . . S V3=$P(LIDT4,U,7)_U_$P(LIDT4,U,8),V4=V1_V2_V3
"RTN","PRCHLO2",93,0)
 . . S LIDT5=PPOKEY_U_ITMID_U_LIDT3_U_V4
"RTN","PRCHLO2",94,0)
 . . I +(LIDT3)>0 S ^TMP($J,"POITEMDATEREC",POID,ITMID,LIDT3,0)=LIDT5
"RTN","PRCHLO2",95,0)
 . . Q
"RTN","PRCHLO2",96,0)
 . Q
"RTN","PRCHLO2",97,0)
 Q
"RTN","PRCHLO2",98,0)
POLIINV ; PO line item Inventory Point multiple
"RTN","PRCHLO2",99,0)
 N POLIV,POLIV1,POLIV2,POLIV3,POLIV4,V1,V2,V3,POLE1,POLE2,POLE3
"RTN","PRCHLO2",100,0)
 S POLIV=$G(^PRC(442,POID,2,ITMID,5,0))
"RTN","PRCHLO2",101,0)
 S POLIV1=$P(POLIV,U,3)
"RTN","PRCHLO2",102,0)
 I +POLIV1>0  D
"RTN","PRCHLO2",103,0)
 . S POLIV2=0
"RTN","PRCHLO2",104,0)
 . S POLIV2=$O(^PRC(442,POID,2,ITMID,5,POLIV2)) Q:POLIV2=""  D
"RTN","PRCHLO2",105,0)
 . . Q:+POLIV2<0  ; quit at the x-ref ELSE Get data, $P values
"RTN","PRCHLO2",106,0)
 . . S POLIV3=$G(^PRC(442,POID,2,ITMID,5,POLIV2,0))  ;Get data values
"RTN","PRCHLO2",107,0)
 . . S POLE1=$P(POLIV3,U,1)
"RTN","PRCHLO2",108,0)
 . . I POLE1'="" S POLE2=$G(^PRCP(445,+POLE1,0)),POLE3=$P(POLE2,U,1)
"RTN","PRCHLO2",109,0)
 . . I POLE1="" S POLE3=""
"RTN","PRCHLO2",110,0)
 . . S V1=POLE3_U_$P(POLIV3,U,2)_U_$P(POLIV3,U,3)_U
"RTN","PRCHLO2",111,0)
 . . S V2=$P(POLIV3,U,4),V3=V1_V2
"RTN","PRCHLO2",112,0)
 . . S POLIV4=PPOKEY_U_ITMID_U_POLIV2_U_V3
"RTN","PRCHLO2",113,0)
 . . I +POLIV2>0 S ^TMP($J,"POITEMLNINVPT",POID,ITMID,POLIV2,0)=POLIV4
"RTN","PRCHLO2",114,0)
 . . Q
"RTN","PRCHLO2",115,0)
 . Q
"RTN","PRCHLO2",116,0)
 Q
"RTN","PRCHLO2",117,0)
LPPOITM ; Loop on PO Item
"RTN","PRCHLO2",118,0)
 ; Initialize with PPOKEY
"RTN","PRCHLO2",119,0)
 S ^TMP($J,"POITEM",POID,ITMID,0)=PPOKEY_U_ITMID
"RTN","PRCHLO2",120,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,7)=$P(N0,U,1)  ; LineItem#
"RTN","PRCHLO2",121,0)
 ;
"RTN","PRCHLO2",122,0)
 ;
"RTN","PRCHLO2",123,0)
 ; get value for ItemMast.Description
"RTN","PRCHLO2",124,0)
 S POIA=$P(N0,U,5)
"RTN","PRCHLO2",125,0)
 I POIA'="" S POIA1=$G(^PRC(441,+POIA,0)),POIA2=$P(POIA1,U,2),IMID=$P(POIA1,U,1),POIA2A=$P(POIA1,U,1)
"RTN","PRCHLO2",126,0)
 I POIA="" S POIA2="",IMID=""
"RTN","PRCHLO2",127,0)
 ;
"RTN","PRCHLO2",128,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,8)=IMID  ; ItemMast.ID#
"RTN","PRCHLO2",129,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,9)=POIA2  ; ItemMast.Description
"RTN","PRCHLO2",130,0)
 ;
"RTN","PRCHLO2",131,0)
 ; Patch 98 CR1 fix . ITEM Master entry may have been deleted if
"RTN","PRCHLO2",132,0)
 ; POIA2'="", but value for lookup is missing (POIA2A="")
"RTN","PRCHLO2",133,0)
 ; If this is the case, S POIAF="ITEM MASTER FILE ERROR "_POIA
"RTN","PRCHLO2",134,0)
 ;
"RTN","PRCHLO2",135,0)
 I POIA2="" S POIAF=""
"RTN","PRCHLO2",136,0)
 I POIA2'=""  D  ; new logic RLL 8/9/06
"RTN","PRCHLO2",137,0)
 . I POIA2A="" S POIAF="ITEM MASTER FILE ERROR "_ITMID
"RTN","PRCHLO2",138,0)
 . I POIA2A'="" S POIAF=$P($G(^PRC(441,POIA2A,0)),U,15)
"RTN","PRCHLO2",139,0)
 . Q
"RTN","PRCHLO2",140,0)
 ; I POIA2'="" S POIAF=$P(^PRC(441,POIA2A,0),U,15)  ;original logic
"RTN","PRCHLO2",141,0)
 ; End Changes Patch 98 RLL 8/9/06
"RTN","PRCHLO2",142,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,10)=POIAF  ; NIF #
"RTN","PRCHLO2",143,0)
 ;
"RTN","PRCHLO2",144,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,11)=$P(N0,U,2)  ; Quantity
"RTN","PRCHLO2",145,0)
 ; Get external value of Unit of Purchase
"RTN","PRCHLO2",146,0)
 S POI1A=$P(N0,U,3)
"RTN","PRCHLO2",147,0)
 I POI1A'="" S POI1B=$G(^PRCD(420.5,+POI1A,0)),POI1C=$P(POI1B,U,1)
"RTN","PRCHLO2",148,0)
 I POI1A="" S POI1C=""
"RTN","PRCHLO2",149,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,12)=POI1C  ;UnitOfPurchase
"RTN","PRCHLO2",150,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,13)=$P(N0,U,12)  ; PkgMult
"RTN","PRCHLO2",151,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,14)=$P(N0,U,8)  ; ItmDelPoints
"RTN","PRCHLO2",152,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,15)=$P(N0,U,4)  ; BOC
"RTN","PRCHLO2",153,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,16)=$P(N2,U,2)  ; Contract Boa
"RTN","PRCHLO2",154,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,17)=$P(N0,U,9)  ; Act Unit Cost
"RTN","PRCHLO2",155,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,18)=$P(N0,U,7)  ; Est Unit Cost
"RTN","PRCHLO2",156,0)
 ; get external value for Fed Supply Classification
"RTN","PRCHLO2",157,0)
 S PO17E=$P(N2,U,3)
"RTN","PRCHLO2",158,0)
 I PO17E'="" S PO17E1=$G(^PRC(441.2,+PO17E,0)),PO17E2=$P(PO17E1,U,1)
"RTN","PRCHLO2",159,0)
 I PO17E="" S PO17E2=""
"RTN","PRCHLO2",160,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,19)=PO17E2  ;FedSupClass
"RTN","PRCHLO2",161,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,20)=$P(N0,U,6)  ;VenStkNum
"RTN","PRCHLO2",162,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,21)=$P(N0,U,15)  ;NatDrugCode
"RTN","PRCHLO2",163,0)
 ; get external value for SKU
"RTN","PRCHLO2",164,0)
 S PO16E=$P(N0,U,16)
"RTN","PRCHLO2",165,0)
 I PO16E'="" S PO16E1=$G(^PRCD(420.5,+PO16E,0)),PO16E2=$P(PO16E1,U,1)
"RTN","PRCHLO2",166,0)
 I PO16E="" S PO16E2=""
"RTN","PRCHLO2",167,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,22)=PO16E2  ;SKU
"RTN","PRCHLO2",168,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,23)=$P(N0,U,13)  ;NSN
"RTN","PRCHLO2",169,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,24)=$P(N0,U,17)  ;UnitConFactor
"RTN","PRCHLO2",170,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,25)=$P(N2,U,1)  ;TotalCost
"RTN","PRCHLO2",171,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,26)=$P(N2,U,6)  ;DiscItmAmt
"RTN","PRCHLO2",172,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,27)=$P(N2,U,13)  ;Z410ItmNum
"RTN","PRCHLO2",173,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,28)=$P(N4,U,17)  ;LotNum
"RTN","PRCHLO2",174,0)
 S $P(^TMP($J,"POITEM",POID,ITMID,0),U,29)=$P(N4,U,18)  ;SerialNum
"RTN","PRCHLO2",175,0)
 D DITMD  ; get 1st Item Description from multiple
"RTN","PRCHLO2",176,0)
 D POLIDT  ; get Item Date received Data from multiple
"RTN","PRCHLO2",177,0)
 D POLIINV
"RTN","PRCHLO2",178,0)
 Q
"RTN","PRCHLO2",179,0)
 ;
"RTN","PRCHLO2",180,0)
POITDRCH ; PO Item Date Received Header
"RTN","PRCHLO2",181,0)
 W "PoIdNum^PurchaseOrderNum^PoDate^MonthYrRun^StationNum^"
"RTN","PRCHLO2",182,0)
 W "LineItemIdNum^DateRecIdNum^DateReceived^QtyReceived^Amount^"
"RTN","PRCHLO2",183,0)
 W "PartialNumber^DiscountedAmount^AdjustedQuantityRec^AdjustedAmt",!
"RTN","PRCHLO2",184,0)
 Q
"RTN","PRCHLO2",185,0)
POITDRCW ; PO Item Date Received Data
"RTN","PRCHLO2",186,0)
 N PIDRC,PIDRC1,PIDRC2,PIDRC3,PIDRC4
"RTN","PRCHLO2",187,0)
 S PIDRC=0,PIDRC1=0,PIDRC2=0,PIDRC3=0
"RTN","PRCHLO2",188,0)
 F  S PIDRC=$O(^TMP($J,"POITEMDATEREC",PIDRC)) Q:PIDRC=""  D
"RTN","PRCHLO2",189,0)
 . F  S PIDRC1=$O(^TMP($J,"POITEMDATEREC",PIDRC,PIDRC1)) Q:PIDRC1=""  D
"RTN","PRCHLO2",190,0)
 . . F  S PIDRC2=$O(^TMP($J,"POITEMDATEREC",PIDRC,PIDRC1,PIDRC2)) Q:PIDRC2=""  D
"RTN","PRCHLO2",191,0)
 . . . ;
"RTN","PRCHLO2",192,0)
 . . . W $G(^TMP($J,"POITEMDATEREC",PIDRC,PIDRC1,PIDRC2,0)),!
"RTN","PRCHLO2",193,0)
 . . Q
"RTN","PRCHLO2",194,0)
 . . Q
"RTN","PRCHLO2",195,0)
 . Q
"RTN","PRCHLO2",196,0)
 Q
"RTN","PRCHLO2",197,0)
POITDSH ; PO Item Description Header
"RTN","PRCHLO2",198,0)
 W "PoIdNum^PurchaseOrderNum^PoDate^MonthYrRun^StationNum^"
"RTN","PRCHLO2",199,0)
 W "LineItemIdNum^LineItemDescIdNum^Description",!
"RTN","PRCHLO2",200,0)
 Q
"RTN","PRCHLO2",201,0)
POITDSW ; PO Item Description Write Data
"RTN","PRCHLO2",202,0)
 N PDES,PDES1,PDES2,PDES3
"RTN","PRCHLO2",203,0)
 S PDES=0,PDES1=0
"RTN","PRCHLO2",204,0)
 F  S PDES=$O(^TMP($J,"POITEMDESC",PDES)) Q:PDES=""  D
"RTN","PRCHLO2",205,0)
 . F  S PDES1=$O(^TMP($J,"POITEMDESC",PDES,PDES1)) Q:PDES1=""  D
"RTN","PRCHLO2",206,0)
 . . W $G(^TMP($J,"POITEMDESC",PDES,PDES1,0)),!
"RTN","PRCHLO2",207,0)
 . . Q
"RTN","PRCHLO2",208,0)
 . Q
"RTN","PRCHLO2",209,0)
 Q
"RTN","PRCHLO4")
0^47^B89091376^B83540702
"RTN","PRCHLO4",1,0)
PRCHLO4 ;WOIFO/RLL/DAP-EXTRACT ROUTINE CLO REPORT SERVER ; 10/16/06 2:10pm
"RTN","PRCHLO4",2,0)
V ;;5.1;IFCAP;**83,98**; Oct 20, 2000;Build 37
"RTN","PRCHLO4",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHLO4",4,0)
 ; Continuation of PRCHLO3
"RTN","PRCHLO4",5,0)
 ;
"RTN","PRCHLO4",6,0)
 ; PRCHLO3 routines are used to Write out the Header and data
"RTN","PRCHLO4",7,0)
 ; associated with each of the 19 tables created for the Clinical
"RTN","PRCHLO4",8,0)
 ; logistics Report Server. The files are built from the extracts
"RTN","PRCHLO4",9,0)
 ; located in the ^TMP($J) global.
"RTN","PRCHLO4",10,0)
 ;
"RTN","PRCHLO4",11,0)
 Q
"RTN","PRCHLO4",12,0)
GETDIR ; Get directory from System parameter for CLRS
"RTN","PRCHLO4",13,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4",14,0)
 ;
"RTN","PRCHLO4",15,0)
 Q
"RTN","PRCHLO4",16,0)
CLRSFIL ; Create output files for CLRS
"RTN","PRCHLO4",17,0)
 N FILEDIR
"RTN","PRCHLO4",18,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4",19,0)
 ; GET station id
"RTN","PRCHLO4",20,0)
 N STID
"RTN","PRCHLO4",21,0)
 ; S STID=$G(^DD("SITE",1)) Old call
"RTN","PRCHLO4",22,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4",23,0)
TSTFIL ; Test entry point
"RTN","PRCHLO4",24,0)
 ;
"RTN","PRCHLO4",25,0)
 D POMASTF  ; Po Master Data
"RTN","PRCHLO4",26,0)
 D POOBF  ; Po Obligation Data
"RTN","PRCHLO4",27,0)
 D POMETHF  ; PO Method of Purchase Data
"RTN","PRCHLO4",28,0)
 D PODISCF  ; PO Discount Data
"RTN","PRCHLO4",29,0)
 D POITMF  ; Po Item Data
"RTN","PRCHLO4",30,0)
 D POITIVF  ; PO Item Inventory Point Data
"RTN","PRCHLO4",31,0)
 D POITDRF  ; PO Item Desc Data
"RTN","PRCHLO4",32,0)
 D PODSCF  ; PO Description
"RTN","PRCHLO4",33,0)
 D POPRTF  ; PO Partial Data
"RTN","PRCHLO4",34,0)
 D PO2237F  ; PO 2237 data
"RTN","PRCHLO4",35,0)
 D POBOCF  ; PO BOC Data
"RTN","PRCHLO4",36,0)
 D POCOMF  ; PO Comments data
"RTN","PRCHLO4",37,0)
 D POREMF  ; PO Remarks data
"RTN","PRCHLO4",38,0)
 D POPPTF  ; PO Prompt Payment Terms data
"RTN","PRCHLO4",39,0)
 D POAMTF  ; PO Amount data
"RTN","PRCHLO4",40,0)
 D POAMDF  ; PO Amendment Data
"RTN","PRCHLO4",41,0)
 D POAMDCF  ; PO Amendment Changes Data
"RTN","PRCHLO4",42,0)
 D POAMDDF  ; PO Amendment Description Data
"RTN","PRCHLO4",43,0)
 D POAMBKF  ; PO Amount Breakout Code Data
"RTN","PRCHLO4",44,0)
GIPBL1 ; GIP REPORTS
"RTN","PRCHLO4",45,0)
 D BLDGP1^PRCPLO3
"RTN","PRCHLO4",46,0)
 D BLDGP2^PRCPLO3
"RTN","PRCHLO4",47,0)
 Q
"RTN","PRCHLO4",48,0)
POMASTF ; Save PO Master table data to a file to FTP to report Server
"RTN","PRCHLO4",49,0)
 ; build file name
"RTN","PRCHLO4",50,0)
 N OUTFIL1
"RTN","PRCHLO4",51,0)
 S OUTFIL1="IFCP"_STID_"F1.TXT"
"RTN","PRCHLO4",52,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL1,"W")  ; Open the file
"RTN","PRCHLO4",53,0)
 D USE^%ZISUTL("FILE1")  ; Use the file as the output device
"RTN","PRCHLO4",54,0)
 D POMASTH^PRCHLO3   ; Write the Header to the file
"RTN","PRCHLO4",55,0)
 D POMASTW^PRCHLO3   ; Write the data to the file
"RTN","PRCHLO4",56,0)
 D CLOSE^%ZISH("FILE1")  ; Close the file
"RTN","PRCHLO4",57,0)
 Q
"RTN","PRCHLO4",58,0)
POOBF ; Create flat file for PO OBLIGATION DATA
"RTN","PRCHLO4",59,0)
 N OUTFIL2
"RTN","PRCHLO4",60,0)
 S OUTFIL2="IFCP"_STID_"F2.TXT"
"RTN","PRCHLO4",61,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL2,"W")  ; Open the file
"RTN","PRCHLO4",62,0)
 D USE^%ZISUTL("FILE1")  ; Use the file as the output device
"RTN","PRCHLO4",63,0)
 D POOBHD^PRCHLO3
"RTN","PRCHLO4",64,0)
 D POOBW^PRCHLO3
"RTN","PRCHLO4",65,0)
 D CLOSE^%ZISH("FILE1")  ; Close the file
"RTN","PRCHLO4",66,0)
 Q
"RTN","PRCHLO4",67,0)
POMETHF ; Create flat for for Purchase Order Method
"RTN","PRCHLO4",68,0)
 N OUTFIL3
"RTN","PRCHLO4",69,0)
 S OUTFIL3="IFCP"_STID_"F3.TXT"
"RTN","PRCHLO4",70,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL3,"W")  ; Open the file
"RTN","PRCHLO4",71,0)
 D USE^%ZISUTL("FILE1")  ; Use the file as the output device
"RTN","PRCHLO4",72,0)
 D POPMEH^PRCHLO3
"RTN","PRCHLO4",73,0)
 D POPMEW^PRCHLO3
"RTN","PRCHLO4",74,0)
 D CLOSE^%ZISH("FILE1")  ; Close the file
"RTN","PRCHLO4",75,0)
 Q
"RTN","PRCHLO4",76,0)
PODISCF ; Create flat file for Purchase Order Discount
"RTN","PRCHLO4",77,0)
 N OUTFIL4
"RTN","PRCHLO4",78,0)
 S OUTFIL4="IFCP"_STID_"F4.TXT"
"RTN","PRCHLO4",79,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL4,"W")  ; Open the file
"RTN","PRCHLO4",80,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",81,0)
 D PODISCH^PRCHLO1
"RTN","PRCHLO4",82,0)
 D PODISCW^PRCHLO1
"RTN","PRCHLO4",83,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",84,0)
 Q
"RTN","PRCHLO4",85,0)
POITMF ; Create flat file for PO Item data
"RTN","PRCHLO4",86,0)
 N OUTFIL5
"RTN","PRCHLO4",87,0)
 S OUTFIL5="IFCP"_STID_"F5.TXT"
"RTN","PRCHLO4",88,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL5,"W")  ; Open the file
"RTN","PRCHLO4",89,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",90,0)
 D POITEMH^PRCHLO2
"RTN","PRCHLO4",91,0)
 D POITEMW^PRCHLO2
"RTN","PRCHLO4",92,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",93,0)
 Q
"RTN","PRCHLO4",94,0)
POITIVF ; Create flat file for PO Item inv. point data
"RTN","PRCHLO4",95,0)
 N OUTFIL6
"RTN","PRCHLO4",96,0)
 S OUTFIL6="IFCP"_STID_"F6.TXT"
"RTN","PRCHLO4",97,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL6,"W")  ; Open the file
"RTN","PRCHLO4",98,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",99,0)
 D POITLNH^PRCHLO2
"RTN","PRCHLO4",100,0)
 D POITLNW^PRCHLO2
"RTN","PRCHLO4",101,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",102,0)
 Q
"RTN","PRCHLO4",103,0)
POITDRF ; Create flat file for PO Item date received
"RTN","PRCHLO4",104,0)
 N OUTFIL7
"RTN","PRCHLO4",105,0)
 S OUTFIL7="IFCP"_STID_"F7.TXT"
"RTN","PRCHLO4",106,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL7,"W")  ; Open the file
"RTN","PRCHLO4",107,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",108,0)
 D POITDRCH^PRCHLO2
"RTN","PRCHLO4",109,0)
 D POITDRCW^PRCHLO2
"RTN","PRCHLO4",110,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",111,0)
 Q
"RTN","PRCHLO4",112,0)
PODSCF ; Create flat file for PO item description
"RTN","PRCHLO4",113,0)
 N OUTFIL8
"RTN","PRCHLO4",114,0)
 S OUTFIL8="IFCP"_STID_"F8.TXT"
"RTN","PRCHLO4",115,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL8,"W")  ; Open the file
"RTN","PRCHLO4",116,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",117,0)
 D POITDSH^PRCHLO2
"RTN","PRCHLO4",118,0)
 D POITDSW^PRCHLO2
"RTN","PRCHLO4",119,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",120,0)
 Q
"RTN","PRCHLO4",121,0)
POPRTF ; Create flat file for PO Partial data
"RTN","PRCHLO4",122,0)
 N OUTFIL9
"RTN","PRCHLO4",123,0)
 S OUTFIL9="IFCP"_STID_"F9.TXT"
"RTN","PRCHLO4",124,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL9,"W")  ; Open the file
"RTN","PRCHLO4",125,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",126,0)
 D POPART^PRCHLO3
"RTN","PRCHLO4",127,0)
 D POPARTW^PRCHLO3
"RTN","PRCHLO4",128,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",129,0)
 Q
"RTN","PRCHLO4",130,0)
PO2237F ; Create flat file for 2237 data
"RTN","PRCHLO4",131,0)
 N OUTFIL10
"RTN","PRCHLO4",132,0)
 S OUTFIL10="IFCP"_STID_"F10.TXT"
"RTN","PRCHLO4",133,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL10,"W")  ; Open the file
"RTN","PRCHLO4",134,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",135,0)
 D PO2237H^PRCHLO3
"RTN","PRCHLO4",136,0)
 D PO2237W^PRCHLO3
"RTN","PRCHLO4",137,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",138,0)
 Q
"RTN","PRCHLO4",139,0)
POBOCF ; Create flat file for PO BOC data
"RTN","PRCHLO4",140,0)
 N OUTFIL11
"RTN","PRCHLO4",141,0)
 S OUTFIL11="IFCP"_STID_"F11.TXT"
"RTN","PRCHLO4",142,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL11,"W")
"RTN","PRCHLO4",143,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",144,0)
 D POBOCH^PRCHLO3
"RTN","PRCHLO4",145,0)
 D POBOCW^PRCHLO3
"RTN","PRCHLO4",146,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",147,0)
 Q
"RTN","PRCHLO4",148,0)
POCOMF ; Create flat file for PO Comments
"RTN","PRCHLO4",149,0)
 N OUTFIL12
"RTN","PRCHLO4",150,0)
 S OUTFIL12="IFCP"_STID_"F12.TXT"
"RTN","PRCHLO4",151,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL12,"W")
"RTN","PRCHLO4",152,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",153,0)
 D POCMTSH^PRCHLO3
"RTN","PRCHLO4",154,0)
 D POCMTSW^PRCHLO3
"RTN","PRCHLO4",155,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",156,0)
 Q
"RTN","PRCHLO4",157,0)
POREMF ; Create flat file for PO Remarks
"RTN","PRCHLO4",158,0)
 N OUTFIL13
"RTN","PRCHLO4",159,0)
 S OUTFIL13="IFCP"_STID_"F13.TXT"
"RTN","PRCHLO4",160,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL13,"W")
"RTN","PRCHLO4",161,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",162,0)
 D PORMKH^PRCHLO3
"RTN","PRCHLO4",163,0)
 D PORMKW^PRCHLO3
"RTN","PRCHLO4",164,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",165,0)
 Q
"RTN","PRCHLO4",166,0)
POPPTF ; Create flat file for PO Prompt payment terms data
"RTN","PRCHLO4",167,0)
 N OUTFIL14
"RTN","PRCHLO4",168,0)
 S OUTFIL14="IFCP"_STID_"F14.TXT"
"RTN","PRCHLO4",169,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL14,"W")
"RTN","PRCHLO4",170,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",171,0)
 D POPPTH^PRCHLO3
"RTN","PRCHLO4",172,0)
 D POPPTW^PRCHLO3
"RTN","PRCHLO4",173,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",174,0)
 Q
"RTN","PRCHLO4",175,0)
POAMTF ; Create flat file for PO Amount data
"RTN","PRCHLO4",176,0)
 N OUTFIL15
"RTN","PRCHLO4",177,0)
 S OUTFIL15="IFCP"_STID_"F15.TXT"
"RTN","PRCHLO4",178,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL15,"W")
"RTN","PRCHLO4",179,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",180,0)
 D POAMTH^PRCHLO3
"RTN","PRCHLO4",181,0)
 D POAMTW^PRCHLO3
"RTN","PRCHLO4",182,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",183,0)
 Q
"RTN","PRCHLO4",184,0)
POAMDF ; Create flat file for PO Amendment data
"RTN","PRCHLO4",185,0)
 N OUTFIL16
"RTN","PRCHLO4",186,0)
 S OUTFIL16="IFCP"_STID_"F16.TXT"
"RTN","PRCHLO4",187,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL16,"W")
"RTN","PRCHLO4",188,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",189,0)
 D POAMDH^PRCHLO3
"RTN","PRCHLO4",190,0)
 D POAMDW^PRCHLO3
"RTN","PRCHLO4",191,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",192,0)
 Q
"RTN","PRCHLO4",193,0)
POAMDCF ; Create flat file for PO Amendment changes
"RTN","PRCHLO4",194,0)
 N OUTFIL17
"RTN","PRCHLO4",195,0)
 S OUTFIL17="IFCP"_STID_"F17.TXT"
"RTN","PRCHLO4",196,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL17,"W")
"RTN","PRCHLO4",197,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",198,0)
 D POAMDCH^PRCHLO3
"RTN","PRCHLO4",199,0)
 D POAMDCW^PRCHLO3
"RTN","PRCHLO4",200,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",201,0)
 Q
"RTN","PRCHLO4",202,0)
POAMDDF ; Create flat file for PO Amendment Desc data
"RTN","PRCHLO4",203,0)
 N OUTFIL18
"RTN","PRCHLO4",204,0)
 S OUTFIL18="IFCP"_STID_"F18.TXT"
"RTN","PRCHLO4",205,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL18,"W")
"RTN","PRCHLO4",206,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",207,0)
 D PAMDDH^PRCHLO3
"RTN","PRCHLO4",208,0)
 D PAMDDW^PRCHLO3
"RTN","PRCHLO4",209,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",210,0)
 Q
"RTN","PRCHLO4",211,0)
POAMBKF ; Create flat file for PO amount breakout code
"RTN","PRCHLO4",212,0)
 N OUTFIL19
"RTN","PRCHLO4",213,0)
 S OUTFIL19="IFCP"_STID_"F19.TXT"
"RTN","PRCHLO4",214,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFIL19,"W")
"RTN","PRCHLO4",215,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",216,0)
 D PAMTBKH^PRCHLO3
"RTN","PRCHLO4",217,0)
 D PAMTBKW^PRCHLO3
"RTN","PRCHLO4",218,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",219,0)
 Q
"RTN","PRCHLO4",220,0)
TSTF ; Test directory for file creation
"RTN","PRCHLO4",221,0)
 N FILEDIR,TFILE,OUTFILT,POP,STID
"RTN","PRCHLO4",222,0)
 ; POP is returned by OPEN^%ZISH if file cannot be created.
"RTN","PRCHLO4",223,0)
 S POP=""
"RTN","PRCHLO4",224,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4",225,0)
 S OUTFILT="CLRSREADME"_STID_".TXT"
"RTN","PRCHLO4",226,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4",227,0)
 D OPEN^%ZISH("TFILE",FILEDIR,OUTFILT,"W")
"RTN","PRCHLO4",228,0)
 I POP  D
"RTN","PRCHLO4",229,0)
 . S CLRSERR=2
"RTN","PRCHLO4",230,0)
 . Q
"RTN","PRCHLO4",231,0)
 I CLRSERR'=2  D
"RTN","PRCHLO4",232,0)
 . D USE^%ZISUTL("TFILE")
"RTN","PRCHLO4",233,0)
 . W !,"$ ! This directory is used to store PO activity"
"RTN","PRCHLO4",234,0)
 . W !,"$ ! extracts and GIP Extracts which are transmitted"
"RTN","PRCHLO4",235,0)
 . W !,"$ ! to the Clinical Logistics Report Server on a monthly"
"RTN","PRCHLO4",236,0)
 . W !,"$ ! basis. There are 21 extract files IFCPXXXF1 through"
"RTN","PRCHLO4",237,0)
 . W !,"$ ! IFCPXXXF19, IFCPXXXG1 and IFCPXXXG2. In addition, there"
"RTN","PRCHLO4",238,0)
 . W !,"$ ! are 2 working files used for the FTP Transfer:"
"RTN","PRCHLO4",239,0)
 . W !,"$ ! CLRSxxx.DAT and CLRS1xxx.COM. CLRSREADMExxx.TXT is also present"
"RTN","PRCHLO4",240,0)
 . W !,"$ EXIT"
"RTN","PRCHLO4",241,0)
 . D CLOSE^%ZISH("TFILE")
"RTN","PRCHLO4",242,0)
 . Q
"RTN","PRCHLO4",243,0)
 Q
"RTN","PRCHLO4",244,0)
 ;
"RTN","PRCHLO4",245,0)
CRTCOM ; Create .DAT file to transfer file(s)
"RTN","PRCHLO4",246,0)
 N FILEDIR,POP,STID,OUTFLL1
"RTN","PRCHLO4",247,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4",248,0)
 S POP=""  ; POP is returned by OPEN^%ZISH
"RTN","PRCHLO4",249,0)
 ; S FILEDIR="$1$DGA2:[ANONYMOUS.CLRS]"  ;set dir for outpt files.
"RTN","PRCHLO4",250,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4",251,0)
 S OUTFLL1="CLRS"_STID_"FTP.DAT"
"RTN","PRCHLO4",252,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFLL1,"W")
"RTN","PRCHLO4",253,0)
 I POP  D
"RTN","PRCHLO4",254,0)
 . S CLRSERR=3
"RTN","PRCHLO4",255,0)
 . Q
"RTN","PRCHLO4",256,0)
 I CLRSERR'=3  D
"RTN","PRCHLO4",257,0)
 . D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",258,0)
 . W "clrsadmin",!  ; Enter user name for Report Server Login
"RTN","PRCHLO4",259,0)
 . W "1025clrs",!  ;pw=1025clrs Enter P/W for Report Server Login
"RTN","PRCHLO4",260,0)
 . ; W "SET DEFAULT /LOCAL $1$DGA2:[ANONYMOUS.CLRS]",!
"RTN","PRCHLO4",261,0)
 . W "SET DEFAULT /LOCAL "_FILEDIR,!
"RTN","PRCHLO4",262,0)
 . W "PUT IFCP"_STID_"*.*;*",!  ; new code to issue PUT command
"RTN","PRCHLO4",263,0)
 . W "EXIT",!  ; Exit FTP
"RTN","PRCHLO4",264,0)
 . D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",265,0)
 . Q
"RTN","PRCHLO4",266,0)
 Q
"RTN","PRCHLO4",267,0)
CRTCOM1 ; Run CLRSFTP1.COM as com file for exception handling
"RTN","PRCHLO4",268,0)
 ;
"RTN","PRCHLO4",269,0)
 ;*98 Modified code to work with PRC CLRS ADDRESS parameter
"RTN","PRCHLO4",270,0)
 ;
"RTN","PRCHLO4",271,0)
 N FILEDIR,STID,OUTFLL2,ADDR
"RTN","PRCHLO4",272,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4",273,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4",274,0)
 S ADDR=$$GET^XPAR("SYS","PRC CLRS ADDRESS",1,"Q")
"RTN","PRCHLO4",275,0)
 I ADDR="" S PRCPMSG(1)="There is no address identified in the CLRS Address Parameter.",PRCPMSG(2)="Please correct and retry." D MAILFTP^PRCHLO4A S CLRSERR=1 Q
"RTN","PRCHLO4",276,0)
 S OUTFLL2="CLRS"_STID_"FTP1.COM"
"RTN","PRCHLO4",277,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFLL2,"W")
"RTN","PRCHLO4",278,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4",279,0)
 W "$ SET VERIFY=(PROCEDURE,IMAGE)",!
"RTN","PRCHLO4",280,0)
 W "$ SET DEFAULT "_FILEDIR,!
"RTN","PRCHLO4",281,0)
 W "$ FTP "_ADDR_" /INPUT="_FILEDIR_"CLRS"_STID_"FTP.DAT",!
"RTN","PRCHLO4",282,0)
 ;
"RTN","PRCHLO4",283,0)
 W "$ EXIT 3",!
"RTN","PRCHLO4",284,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4",285,0)
 Q
"RTN","PRCHLO4",286,0)
FTPCOM ; Issue the FTP command after CLRS1.TXT file is built
"RTN","PRCHLO4",287,0)
 ; remain in CACHE during FTP Process using
"RTN","PRCHLO4",288,0)
 ; $ZF(-1) call
"RTN","PRCHLO4",289,0)
 ; ; SACC Exception received for usage of $ZF(-1) in PRC*5.1*83
"RTN","PRCHLO4",290,0)
 ; See IFCAP technical manual
"RTN","PRCHLO4",291,0)
 ;
"RTN","PRCHLO4",292,0)
 ; commented out for testing
"RTN","PRCHLO4",293,0)
 ; add hook to mailman messaging for ftp, check variable PV
"RTN","PRCHLO4",294,0)
 N PV,XPV1,FILEDIR,STID
"RTN","PRCHLO4",295,0)
 ;
"RTN","PRCHLO4",296,0)
 ;
"RTN","PRCHLO4",297,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4",298,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4",299,0)
 S XPV1="S PV=$ZF(-1,""@"_FILEDIR_"CLRS"_STID_"FTP1.COM/OUTPUT="_FILEDIR_"CLRS"_STID_"FTP1.LOG"")"
"RTN","PRCHLO4",300,0)
 X XPV1  ; Run the .COM file to transfer files
"RTN","PRCHLO4",301,0)
 ;
"RTN","PRCHLO4",302,0)
 ; Error flag logic
"RTN","PRCHLO4",303,0)
 I PV=-1  D  ; This error is generated if failure during xfer occurs
"RTN","PRCHLO4",304,0)
 . S CLRSERR=1
"RTN","PRCHLO4",305,0)
 . Q
"RTN","PRCHLO4",306,0)
 Q
"RTN","PRCHLO4A")
0^50^B64544632^B41529207
"RTN","PRCHLO4A",1,0)
PRCHLO4A ;WOIFO/RLL/DAP-EXTRACT ROUTINE CLO REPORT SERVER ; 9/26/06 11:33am
"RTN","PRCHLO4A",2,0)
V ;;5.1;IFCAP;**83,104,98**; Oct 20, 2000;Build 37
"RTN","PRCHLO4A",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHLO4A",4,0)
 ; Continuation of PRCHLO4
"RTN","PRCHLO4A",5,0)
 ;
"RTN","PRCHLO4A",6,0)
 ; PRCHLO4A routines are used to Write out the Header and data
"RTN","PRCHLO4A",7,0)
 ;
"RTN","PRCHLO4A",8,0)
 Q
"RTN","PRCHLO4A",9,0)
GETDIR ; Get directory from PRCPLO EXTRACT DIRECTORY system parameter for CLRS
"RTN","PRCHLO4A",10,0)
 N FILEDIR,STID
"RTN","PRCHLO4A",11,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4A",12,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4A",13,0)
 ;
"RTN","PRCHLO4A",14,0)
 Q
"RTN","PRCHLO4A",15,0)
 ;
"RTN","PRCHLO4A",16,0)
CRTWIN ; Create CLRSxxxWFTP.TXT  file to transfer file(s)
"RTN","PRCHLO4A",17,0)
 ;*98 Modified to work with PRC CLRS ADDRESS parameter
"RTN","PRCHLO4A",18,0)
 N FILEDIR,POP,STID,OUTFLL1,ADDR
"RTN","PRCHLO4A",19,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4A",20,0)
 S POP=""  ; POP is returned by OPEN^%ZISH
"RTN","PRCHLO4A",21,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4A",22,0)
 ; RLL/PRC*5.1*104 change logic to create separate FTP
"RTN","PRCHLO4A",23,0)
 ; transfer files (1 for each file for Windows/Cache)
"RTN","PRCHLO4A",24,0)
 S ADDR=$$GET^XPAR("SYS","PRC CLRS ADDRESS",1,"Q")
"RTN","PRCHLO4A",25,0)
 I ADDR="" S PRCPMSG(1)="There is no address identified in the CLRS Adress Parameter.",PRCPMSG(2)="Please correct and retry." D MAILFTP S CLRSERR=1 Q
"RTN","PRCHLO4A",26,0)
 ;
"RTN","PRCHLO4A",27,0)
 I CLRSERR'=3  D
"RTN","PRCHLO4A",28,0)
 . N PONN  ; File number for File type
"RTN","PRCHLO4A",29,0)
 . S PONN=1
"RTN","PRCHLO4A",30,0)
 . F PONN=1:1:19  D
"RTN","PRCHLO4A",31,0)
 . . N FTY  ; File type F=Po Activity , G=GIP
"RTN","PRCHLO4A",32,0)
 . . ;
"RTN","PRCHLO4A",33,0)
 . . S FTY="F"
"RTN","PRCHLO4A",34,0)
 . . S OUTFLL1="CLRS"_STID_FTY_PONN_"WFTP.TXT"
"RTN","PRCHLO4A",35,0)
 . . D OPEN^%ZISH("FILE1",FILEDIR,OUTFLL1,"W")
"RTN","PRCHLO4A",36,0)
 . . I POP  D
"RTN","PRCHLO4A",37,0)
 . . . S CLRSERR=3
"RTN","PRCHLO4A",38,0)
 . . . Q
"RTN","PRCHLO4A",39,0)
 . . D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4A",40,0)
 . . D BLDF1
"RTN","PRCHLO4A",41,0)
 . . D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4A",42,0)
 . . Q
"RTN","PRCHLO4A",43,0)
 . Q
"RTN","PRCHLO4A",44,0)
 ;
"RTN","PRCHLO4A",45,0)
 I CLRSERR'=3  D
"RTN","PRCHLO4A",46,0)
 . ; RLL/PRC*5.1*104 change logic to create separate FTP
"RTN","PRCHLO4A",47,0)
 . ; tranfer files (1 for each file for Windows/Cache)
"RTN","PRCHLO4A",48,0)
 . N PONN  ; File number for file type
"RTN","PRCHLO4A",49,0)
 . S PONN=1
"RTN","PRCHLO4A",50,0)
 . F PONN=1:1:2  D
"RTN","PRCHLO4A",51,0)
 . . N FTY  ; File type F=Po Activity , G=GIP
"RTN","PRCHLO4A",52,0)
 . . S FTY="G"
"RTN","PRCHLO4A",53,0)
 . . S OUTFLL1="CLRS"_STID_FTY_PONN_"WFTP.TXT"
"RTN","PRCHLO4A",54,0)
 . . D OPEN^%ZISH("FILE1",FILEDIR,OUTFLL1,"W")
"RTN","PRCHLO4A",55,0)
 . . I POP  D
"RTN","PRCHLO4A",56,0)
 . . . S CLRSERR=3
"RTN","PRCHLO4A",57,0)
 . . . Q
"RTN","PRCHLO4A",58,0)
 . . D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4A",59,0)
 . . D BLDF1
"RTN","PRCHLO4A",60,0)
 . . D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4A",61,0)
 . . Q
"RTN","PRCHLO4A",62,0)
 . Q
"RTN","PRCHLO4A",63,0)
 Q
"RTN","PRCHLO4A",64,0)
BLDF1 ; RLL/PRC*5.1*104 added logic to create separate FTP
"RTN","PRCHLO4A",65,0)
 ; transfers (1 for each file)
"RTN","PRCHLO4A",66,0)
 ;
"RTN","PRCHLO4A",67,0)
 W "open "_ADDR,!  ;Connect to the Report Server
"RTN","PRCHLO4A",68,0)
 W "clrsadmin",!  ; Enter user name for Report Server Login
"RTN","PRCHLO4A",69,0)
 W "1025clrs",!  ;pw=1025clrs Enter P/W for Report Server Login
"RTN","PRCHLO4A",70,0)
 W "PUT "_FILEDIR_"IFCP"_STID_FTY_PONN_".TXT",!
"RTN","PRCHLO4A",71,0)
 W "bye",!  ; Exit FTP
"RTN","PRCHLO4A",72,0)
 ;
"RTN","PRCHLO4A",73,0)
 Q
"RTN","PRCHLO4A",74,0)
CKRPTSV ; Check for availability of report server
"RTN","PRCHLO4A",75,0)
 ; Several steps need to be performed
"RTN","PRCHLO4A",76,0)
 ; 1. Set up script to perform PING
"RTN","PRCHLO4A",77,0)
 ; 2. Capture log file during PING
"RTN","PRCHLO4A",78,0)
 ; 3. Read logfile into working global
"RTN","PRCHLO4A",79,0)
 ; 4. Determine Success/Failure of PING to server
"RTN","PRCHLO4A",80,0)
 ; 5. If successful, continue processing (CLRSERR=0)
"RTN","PRCHLO4A",81,0)
 ; 6. If problem occurs, S CLRSERR=3 and generate message
"RTN","PRCHLO4A",82,0)
 ;
"RTN","PRCHLO4A",83,0)
 I CKOS["VMS" D VMSPING  ; CKOS set in PRCHLO5
"RTN","PRCHLO4A",84,0)
 I CKOS["NT" D WINPING  ; CKOS set in PRCHLO5
"RTN","PRCHLO4A",85,0)
 Q
"RTN","PRCHLO4A",86,0)
VMSPING ; need to PING report server to make sure it is available
"RTN","PRCHLO4A",87,0)
 ;
"RTN","PRCHLO4A",88,0)
 ; 1. Create .COM file to execute
"RTN","PRCHLO4A",89,0)
 ;*98 Modified to work with PRC CLRS ADDRESS parameter
"RTN","PRCHLO4A",90,0)
 N FILEDIR,STID,OUTFLL2,ADDR
"RTN","PRCHLO4A",91,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4A",92,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4A",93,0)
 S ADDR=$$GET^XPAR("SYS","PRC CLRS ADDRESS",1,"Q")
"RTN","PRCHLO4A",94,0)
 I ADDR="" S PRCPMSG(1)="There is no address identified in the CLRS Address Parameter.",PRCPMSG(2)="Please correct and retry." D MAILFTP S CLRSERR=1 Q
"RTN","PRCHLO4A",95,0)
 ;
"RTN","PRCHLO4A",96,0)
 S OUTFLL2="CLRS"_STID_"PING.COM"
"RTN","PRCHLO4A",97,0)
 D OPEN^%ZISH("FILE1",FILEDIR,OUTFLL2,"W")
"RTN","PRCHLO4A",98,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCHLO4A",99,0)
 W "$ SET VERIFY=(PROCEDURE,IMAGE)",!
"RTN","PRCHLO4A",100,0)
 W "$ SET DEFAULT "_FILEDIR,!
"RTN","PRCHLO4A",101,0)
 W "$ TCPIP",!
"RTN","PRCHLO4A",102,0)
 W "PING "_ADDR,!
"RTN","PRCHLO4A",103,0)
 W "EXIT",!
"RTN","PRCHLO4A",104,0)
 W "$ EXIT 3",!
"RTN","PRCHLO4A",105,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCHLO4A",106,0)
 ;
"RTN","PRCHLO4A",107,0)
 ; 2. Execute .COM file, create logfile
"RTN","PRCHLO4A",108,0)
 S XPV1="S PV=$ZF(-1,""@"_FILEDIR_"CLRS"_STID_"PING.COM/OUTPUT="_FILEDIR_"CLRS"_STID_"PING.LOG"")"
"RTN","PRCHLO4A",109,0)
 X XPV1  ; Run the .com file
"RTN","PRCHLO4A",110,0)
 ;
"RTN","PRCHLO4A",111,0)
 ; 3. Read Logfile into working global
"RTN","PRCHLO4A",112,0)
 N FNAME,XLOG
"RTN","PRCHLO4A",113,0)
 S FNAME="CLRS"_STID_"PING.LOG"
"RTN","PRCHLO4A",114,0)
 S XLOG=$$FTG^%ZISH(FILEDIR,FNAME,$NAME(^TMP("CLRSLOG",$J,1)),3)
"RTN","PRCHLO4A",115,0)
 ; Check global for %SYSTEM or 0 packets received
"RTN","PRCHLO4A",116,0)
 N PNG,PNG1,PNG2,PNG3
"RTN","PRCHLO4A",117,0)
 S PNG=0,PNG1=0,PNG2=0
"RTN","PRCHLO4A",118,0)
 F  S PNG=$O(^TMP("CLRSLOG",$J,PNG)) Q:PNG=""  D
"RTN","PRCHLO4A",119,0)
 . S PNG1=$G(^TMP("CLRSLOG",$J,PNG))
"RTN","PRCHLO4A",120,0)
 . I PNG1["0 packets received" S CLRSERR=3
"RTN","PRCHLO4A",121,0)
 . I PNG1["%SYSTEM" S CLRSERR=3
"RTN","PRCHLO4A",122,0)
 . Q
"RTN","PRCHLO4A",123,0)
 Q
"RTN","PRCHLO4A",124,0)
WINPING ; PING report server to make sure it is available
"RTN","PRCHLO4A",125,0)
 ;*98 Modified to work with PRC CLRS ADDRESS parameter 
"RTN","PRCHLO4A",126,0)
 N PV,XPV1,FILEDIR,STID,XLOG,ADDR
"RTN","PRCHLO4A",127,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4A",128,0)
 S ADDR=$$GET^XPAR("SYS","PRC CLRS ADDRESS",1,"Q")
"RTN","PRCHLO4A",129,0)
 I ADDR="" S PRCPMSG(1)="There is no address identified in the CLRS Adress Parameter.",PRCPMSG(2)="Please correct and retry." D MAILFTP S CLRSERR=1 Q
"RTN","PRCHLO4A",130,0)
 ;
"RTN","PRCHLO4A",131,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4A",132,0)
 S XPV1="S PV=$ZF(-1,""PING "_ADDR_">"_FILEDIR_"CLRS"_STID_"PING.LOG"")"
"RTN","PRCHLO4A",133,0)
 X XPV1
"RTN","PRCHLO4A",134,0)
 S FNAME="CLRS"_STID_"PING.LOG"
"RTN","PRCHLO4A",135,0)
 S XLOG=$$FTG^%ZISH(FILEDIR,FNAME,$NAME(^TMP("CLRSLOG",$J,1)),3)
"RTN","PRCHLO4A",136,0)
 N PNG,PNG1,PNG2,PNG3
"RTN","PRCHLO4A",137,0)
 S PNG=0,PNG1=0,PNG2=0
"RTN","PRCHLO4A",138,0)
 F  S PNG=$O(^TMP("CLRSLOG",$J,PNG)) Q:PNG=""  D
"RTN","PRCHLO4A",139,0)
 . S PNG1=$G(^TMP("CLRSLOG",$J,PNG))
"RTN","PRCHLO4A",140,0)
 . I PNG1["Received = 0" S CLRSERR=3
"RTN","PRCHLO4A",141,0)
 . Q
"RTN","PRCHLO4A",142,0)
 Q
"RTN","PRCHLO4A",143,0)
 ;
"RTN","PRCHLO4A",144,0)
LOG2FILE ; Set logfile to global, add to mail message
"RTN","PRCHLO4A",145,0)
 ;
"RTN","PRCHLO4A",146,0)
 ;
"RTN","PRCHLO4A",147,0)
 N FILEDIR,STID,FNAME,XLOG
"RTN","PRCHLO4A",148,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4A",149,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4A",150,0)
 I CKOS["VMS" S FNAME="CLRS"_STID_"FTP1.LOG"
"RTN","PRCHLO4A",151,0)
 I CKOS["NT" S FNAME="CLRS"_STID_"F1FTP1.LOG"
"RTN","PRCHLO4A",152,0)
 S XLOG=$$FTG^%ZISH(FILEDIR,FNAME,$NAME(^TMP("PRCHLOG",$J,1)),3)
"RTN","PRCHLO4A",153,0)
 ; Log file is in the global ^TMP("PRCHLOG", lets put it in
"RTN","PRCHLO4A",154,0)
 ; the message beginning at PRCPMSG(11)
"RTN","PRCHLO4A",155,0)
 ;
"RTN","PRCHLO4A",156,0)
 N LG1,LG2,LG3,LG4,LGCNT
"RTN","PRCHLO4A",157,0)
 S LG1=0,LG2=0,LG3=0,LG4=0,LGCNT=11
"RTN","PRCHLO4A",158,0)
 F  S LG1=$O(^TMP("PRCHLOG",$J,LG1)) Q:LG1=""  D
"RTN","PRCHLO4A",159,0)
 . S LG3=$G(^TMP("PRCHLOG",$J,LG1))
"RTN","PRCHLO4A",160,0)
 . S PRCPMSG(LGCNT)=LG3
"RTN","PRCHLO4A",161,0)
 . S LGCNT=LGCNT+1
"RTN","PRCHLO4A",162,0)
 . Q
"RTN","PRCHLO4A",163,0)
 D MAILFTP
"RTN","PRCHLO4A",164,0)
 Q
"RTN","PRCHLO4A",165,0)
FTPCOM ; Issue the FTP command after CLRSxxxWFTP.TXT file is built
"RTN","PRCHLO4A",166,0)
 ; remain in CACHE during FTP Process using
"RTN","PRCHLO4A",167,0)
 ; $ZF(-1) call
"RTN","PRCHLO4A",168,0)
 ;
"RTN","PRCHLO4A",169,0)
 ; rll/ 8/30/2006 Change logic to initiate transfer one file
"RTN","PRCHLO4A",170,0)
 ; at a time to the report server for Windows/Cache stations
"RTN","PRCHLO4A",171,0)
 ; This was done after a hang was observed between transfers.
"RTN","PRCHLO4A",172,0)
 ;
"RTN","PRCHLO4A",173,0)
 N LPP1,LPP2
"RTN","PRCHLO4A",174,0)
 S LPP1=0,LPP2="F"
"RTN","PRCHLO4A",175,0)
 F LPP1=1:1:19  D  ; run the FTP command for the 19 PO files
"RTN","PRCHLO4A",176,0)
 . D RUNFTPT
"RTN","PRCHLO4A",177,0)
 . Q
"RTN","PRCHLO4A",178,0)
 S LPP1=0,LPP2="G"
"RTN","PRCHLO4A",179,0)
 F LPP1=1:1:2  D  ; run the FTP command for the 2 GIP files
"RTN","PRCHLO4A",180,0)
 . D RUNFTPT
"RTN","PRCHLO4A",181,0)
 . Q
"RTN","PRCHLO4A",182,0)
 Q
"RTN","PRCHLO4A",183,0)
 ;
"RTN","PRCHLO4A",184,0)
RUNFTPT ; Run the FTP transfer for Windows
"RTN","PRCHLO4A",185,0)
 N PV,XPV1,FILEDIR,STID
"RTN","PRCHLO4A",186,0)
 ;
"RTN","PRCHLO4A",187,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4A",188,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4A",189,0)
 ; SACC Exception received for usage of $ZF(-1) in PRC*5.1*83
"RTN","PRCHLO4A",190,0)
 ; See IFCAP Technical Manual
"RTN","PRCHLO4A",191,0)
 S XPV1="S PV=$ZF(-1,""ftp -s:"_FILEDIR_"CLRS"_STID_LPP2_LPP1_"WFTP.TXT>"_FILEDIR_"CLRS"_STID_LPP2_LPP1_"FTP1.LOG"")"
"RTN","PRCHLO4A",192,0)
 X XPV1  ; FTP the files, Comment out for testing
"RTN","PRCHLO4A",193,0)
 ;
"RTN","PRCHLO4A",194,0)
 ; error flag logic
"RTN","PRCHLO4A",195,0)
 I PV=-1  D  ; Note, this error is logged on system error during xfer
"RTN","PRCHLO4A",196,0)
 . S CLRSERR=1
"RTN","PRCHLO4A",197,0)
 . Q
"RTN","PRCHLO4A",198,0)
 Q
"RTN","PRCHLO4A",199,0)
DELWIN ; Delete windows files
"RTN","PRCHLO4A",200,0)
 ;
"RTN","PRCHLO4A",201,0)
 ;
"RTN","PRCHLO4A",202,0)
 I CKOS["NT"  D
"RTN","PRCHLO4A",203,0)
 . N LPP1,LPP2
"RTN","PRCHLO4A",204,0)
 . S LPP1=0,LPP2="F"
"RTN","PRCHLO4A",205,0)
 . F LPP1=1:1:19  D  ; run the FTP command for the 19 PO files
"RTN","PRCHLO4A",206,0)
 . . D DELFTPF
"RTN","PRCHLO4A",207,0)
 . . Q
"RTN","PRCHLO4A",208,0)
 . Q
"RTN","PRCHLO4A",209,0)
 S LPP1=0,LPP2="G"
"RTN","PRCHLO4A",210,0)
 F LPP1=1:1:2  D
"RTN","PRCHLO4A",211,0)
 . D DELFTPF  ; Delete the GIP files
"RTN","PRCHLO4A",212,0)
 . Q
"RTN","PRCHLO4A",213,0)
 Q
"RTN","PRCHLO4A",214,0)
DELFTPF ; Delete the FTP files, logs , and .TXT files
"RTN","PRCHLO4A",215,0)
 ;
"RTN","PRCHLO4A",216,0)
 N FILEDIR,STID,XPV
"RTN","PRCHLO4A",217,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO4A",218,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO4A",219,0)
 ; delete previous extract
"RTN","PRCHLO4A",220,0)
 S XPV="S PV=$ZF(-1,""DEL "_FILEDIR_"IFCP"_STID_LPP2_LPP1_".TXT"")"
"RTN","PRCHLO4A",221,0)
 X XPV  ; comment out for testing
"RTN","PRCHLO4A",222,0)
 ; delete previous logfile
"RTN","PRCHLO4A",223,0)
 ;
"RTN","PRCHLO4A",224,0)
 S XPV="S PV=$ZF(-1,""DEL "_FILEDIR_"CLRS"_STID_LPP2_LPP1_"FTP1.LOG"")"
"RTN","PRCHLO4A",225,0)
 X XPV  ; comment out for testing
"RTN","PRCHLO4A",226,0)
 ; delete previous ftp file for transfer
"RTN","PRCHLO4A",227,0)
 ;
"RTN","PRCHLO4A",228,0)
 S XPV="S PV=$ZF(-1,""DEL "_FILEDIR_"CLRS"_STID_LPP2_LPP1_"WFTP.TXT"")"
"RTN","PRCHLO4A",229,0)
 X XPV
"RTN","PRCHLO4A",230,0)
 Q
"RTN","PRCHLO4A",231,0)
 ;
"RTN","PRCHLO4A",232,0)
MAIL ;Builds mail messages to a defined mail group to notify users of the
"RTN","PRCHLO4A",233,0)
 ;success or failure of the TaskMan scheduling for the CLO Procurement
"RTN","PRCHLO4A",234,0)
 ;Reports
"RTN","PRCHLO4A",235,0)
 ;
"RTN","PRCHLO4A",236,0)
 ;*98 Modified code to work with PRC CLRS OUTLOOK MAILGROUP parameter
"RTN","PRCHLO4A",237,0)
 N XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ,PRCPMG,PRCPMG2
"RTN","PRCHLO4A",238,0)
 S XMSUB="CLO Procurement Report Status for "_$$HTE^XLFDT($H)
"RTN","PRCHLO4A",239,0)
 S XMDUZ="Clinical Logistics Report Server"
"RTN","PRCHLO4A",240,0)
 S XMTEXT="PRCPMSG("
"RTN","PRCHLO4A",241,0)
 S XMY("G.PRCPLO CLRS NOTIFICATIONS")=""
"RTN","PRCHLO4A",242,0)
 S PRCPMG=$$GET^XPAR("SYS","PRC CLRS OUTLOOK MAILGROUP",1,"Q")
"RTN","PRCHLO4A",243,0)
 S:$G(PRCPMG)'="" PRCPMG2="S XMY("""_PRCPMG_""")=""""" X PRCPMG2
"RTN","PRCHLO4A",244,0)
 ;
"RTN","PRCHLO4A",245,0)
 D ^XMD
"RTN","PRCHLO4A",246,0)
 Q
"RTN","PRCHLO4A",247,0)
 ;
"RTN","PRCHLO4A",248,0)
MAILFTP ;Builds mail messages to a defined mail group to notify users of
"RTN","PRCHLO4A",249,0)
 ;the success or failure of issues pertaining to FTP Transfer and
"RTN","PRCHLO4A",250,0)
 ;file permissions/protections associated with VMS Directories
"RTN","PRCHLO4A",251,0)
 ;
"RTN","PRCHLO4A",252,0)
 ;*98 Modified code to work with PRC CLRS OUTLOOK MAILGROUP parameter
"RTN","PRCHLO4A",253,0)
 N XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ,PRCPMG,PRCPMG2
"RTN","PRCHLO4A",254,0)
 S XMSUB="CLO Environment Check & Data Transfer for OS / FTP , "_$$HTE^XLFDT($H)
"RTN","PRCHLO4A",255,0)
 S XMDUZ="Clinical Logistics Report Server"
"RTN","PRCHLO4A",256,0)
 S XMTEXT="PRCPMSG("
"RTN","PRCHLO4A",257,0)
 S XMY("G.PRCPLO CLRS NOTIFICATIONS")=""
"RTN","PRCHLO4A",258,0)
 S PRCPMG=$$GET^XPAR("SYS","PRC CLRS OUTLOOK MAILGROUP",1,"Q")
"RTN","PRCHLO4A",259,0)
 S:$G(PRCPMG)'="" PRCPMG2="S XMY("""_PRCPMG_""")=""""" X PRCPMG2
"RTN","PRCHLO4A",260,0)
 ;
"RTN","PRCHLO4A",261,0)
 D ^XMD
"RTN","PRCHLO4A",262,0)
 Q
"RTN","PRCHLO5")
0^49^B81680096^B93753886
"RTN","PRCHLO5",1,0)
PRCHLO5 ;WOIFO/DAP/RLL-manual run for procurement reports  ; 10/16/06 2:12pm
"RTN","PRCHLO5",2,0)
V ;;5.1;IFCAP;**83,98**;Oct 20, 2000;Build 37
"RTN","PRCHLO5",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHLO5",4,0)
 ;
"RTN","PRCHLO5",5,0)
ENT ;This routine tasks out the execution of the procurement extract 
"RTN","PRCHLO5",6,0)
 ;reports associated with PRC*5.1*83 (CLRS).
"RTN","PRCHLO5",7,0)
 ;
"RTN","PRCHLO5",8,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,PRCHPRO,ZTSK,ZTREQ,PRCPMSG
"RTN","PRCHLO5",9,0)
 S ZTRTN="RUNEXT^PRCHLO5"
"RTN","PRCHLO5",10,0)
 S ZTDESC="PRCPLO CLO Procurement Reports CLRS"
"RTN","PRCHLO5",11,0)
 S ZTDTH=$H
"RTN","PRCHLO5",12,0)
 S ZTREQ="@"
"RTN","PRCHLO5",13,0)
 S ZTIO=""
"RTN","PRCHLO5",14,0)
 D ^%ZTLOAD
"RTN","PRCHLO5",15,0)
 S PRCHPRO=ZTSK
"RTN","PRCHLO5",16,0)
 ;Calls mail group message generation and screen display with success
"RTN","PRCHLO5",17,0)
 ;or exception notification
"RTN","PRCHLO5",18,0)
 I $D(PRCHPRO)[0 S PRCPMSG(1)="A task could not be created for the CLO Procurement Reports - please contact IRM." W ! D EN^DDIOL(PRCPMSG(1)) D MAIL^PRCHLO4A Q
"RTN","PRCHLO5",19,0)
 ; 
"RTN","PRCHLO5",20,0)
 S PRCPMSG(1)="Task # "_PRCHPRO_" entered for Procurement Reports."
"RTN","PRCHLO5",21,0)
 W !
"RTN","PRCHLO5",22,0)
 D EN^DDIOL(PRCPMSG(1))
"RTN","PRCHLO5",23,0)
 ;
"RTN","PRCHLO5",24,0)
 ;*98 Modified to move MAIL and MAILFTP tags to routine PRCHLO4A
"RTN","PRCHLO5",25,0)
 ;
"RTN","PRCHLO5",26,0)
 D MAIL^PRCHLO4A
"RTN","PRCHLO5",27,0)
 ;
"RTN","PRCHLO5",28,0)
 Q
"RTN","PRCHLO5",29,0)
PRCPCMP ; Notification of completion of building Procurement Report Data
"RTN","PRCHLO5",30,0)
 N PRCPMSG
"RTN","PRCHLO5",31,0)
 S PRCPMSG(1)="PO Procurement Data extract complete."
"RTN","PRCHLO5",32,0)
 D EN^DDIOL(PRCPMSG(1))
"RTN","PRCHLO5",33,0)
 D MAIL^PRCHLO4A
"RTN","PRCHLO5",34,0)
 Q
"RTN","PRCHLO5",35,0)
 ;
"RTN","PRCHLO5",36,0)
RUNEXT ; Run extract reports for PO Activity
"RTN","PRCHLO5",37,0)
 N CLRSERR,CLRSTST1  ; error flag for exception handling,tst entry pt.
"RTN","PRCHLO5",38,0)
 ; CLRSERR will be set for the following conditions:
"RTN","PRCHLO5",39,0)
 ; 0 - Success, status message for completion is sent.
"RTN","PRCHLO5",40,0)
 ; 1 - Error creating ^TMP($J) data (i.e. disk full)
"RTN","PRCHLO5",41,0)
 ; 2 - Error creating Files(i.e. directory patch, VMS Space, etc.)
"RTN","PRCHLO5",42,0)
 ; 3 - Error creating .Com file for FTP transfer, permissions issue
"RTN","PRCHLO5",43,0)
 ; 4 - Error with FTP Transfer,ntwk/permissions, Report Server issue
"RTN","PRCHLO5",44,0)
 ; 5 - Error with file deletion/cleanup prior to processing
"RTN","PRCHLO5",45,0)
 ; 6 - Error, lock is present. Process already running
"RTN","PRCHLO5",46,0)
 S CLRSERR=0
"RTN","PRCHLO5",47,0)
TSTMSG ; This entry point is used to test the messaging framework
"RTN","PRCHLO5",48,0)
 ;  S SLRSTST1=1
"RTN","PRCHLO5",49,0)
 S CLRSERR=0
"RTN","PRCHLO5",50,0)
 ; Check for O/S version
"RTN","PRCHLO5",51,0)
 N CKOS
"RTN","PRCHLO5",52,0)
 S CKOS=$$OS^%ZOSV()
"RTN","PRCHLO5",53,0)
 ; use lock to prevent mult. runs
"RTN","PRCHLO5",54,0)
 L +^PRCP(446.7,"STATUS"):3 I $T=0 S CLRSERR=6
"RTN","PRCHLO5",55,0)
 I CLRSERR=0 D DELRUN^PRCHLO5
"RTN","PRCHLO5",56,0)
 I CLRSERR=5  D
"RTN","PRCHLO5",57,0)
 . N PRCPMSG
"RTN","PRCHLO5",58,0)
 . S PRCPMSG(1)="Error with file deletion/cleanup prior to processing. Please contact IRM."
"RTN","PRCHLO5",59,0)
 . S PRCPMSG(2)=" "
"RTN","PRCHLO5",60,0)
 . S PRCPMSG(3)="This error indicates the CLRS EXTRACT DIRECTORY has not"
"RTN","PRCHLO5",61,0)
 . S PRCPMSG(4)="been properly set up during the installation of this patch."
"RTN","PRCHLO5",62,0)
 . S PRCPMSG(5)=" "
"RTN","PRCHLO5",63,0)
 . S PRCPMSG(6)="(Please refer to the pre installation instructions for PRC*5.1*83)"
"RTN","PRCHLO5",64,0)
 . S PRCPMSG(7)=" "
"RTN","PRCHLO5",65,0)
 . S PRCPMSG(8)="A valid directory must be set up with the"
"RTN","PRCHLO5",66,0)
 . S PRCPMSG(9)="proper read/write/execute/delete privileges."
"RTN","PRCHLO5",67,0)
 . S PRCPMSG(10)=" "
"RTN","PRCHLO5",68,0)
 . S PRCPMSG(11)="In addition, the directory name which you create"
"RTN","PRCHLO5",69,0)
 . S PRCPMSG(12)="must be added as the CLRS EXTRACT DIRECTORY"
"RTN","PRCHLO5",70,0)
 . S PRCPMSG(13)="through the CLO System Parameters Option."
"RTN","PRCHLO5",71,0)
 . S PRCPMSG(14)="If the field is blank, you will generate this error."
"RTN","PRCHLO5",72,0)
 . S PRCPMSG(15)=" "
"RTN","PRCHLO5",73,0)
 . S PRCPMSG(16)="Please confirm all steps have been performed"
"RTN","PRCHLO5",74,0)
 . S PRCPMSG(17)="according to the pre installation instructions for patch PRC*5.1*83."
"RTN","PRCHLO5",75,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",76,0)
 . Q
"RTN","PRCHLO5",77,0)
 ; Begin to build files
"RTN","PRCHLO5",78,0)
 I CLRSERR=0 D INIT^PRCHLO
"RTN","PRCHLO5",79,0)
 I CLRSERR=0 D PRCPCMP^PRCHLO5  ; PO activity Extract logic completed
"RTN","PRCHLO5",80,0)
 I $D(CLRSTST1)  D  ; test point to generate message 1
"RTN","PRCHLO5",81,0)
 . Q:CLRSTST1'=1
"RTN","PRCHLO5",82,0)
 . S CLRSERR=1
"RTN","PRCHLO5",83,0)
 . Q
"RTN","PRCHLO5",84,0)
 I CLRSERR=1  D
"RTN","PRCHLO5",85,0)
 . N PRCPMSG  ; error building ^TMP($J)
"RTN","PRCHLO5",86,0)
 . S PRCPMSG(1)="Error, No Data for PO Activity Files, contact IRM"
"RTN","PRCHLO5",87,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",88,0)
 . Q
"RTN","PRCHLO5",89,0)
CRFILE ; Create .txt file to confirm write privileges to directory
"RTN","PRCHLO5",90,0)
 I CLRSERR=0 D TSTF^PRCHLO4  ; will return CLRSERR=2 on error
"RTN","PRCHLO5",91,0)
 I CLRSERR=0 D CLRSFIL^PRCHLO4
"RTN","PRCHLO5",92,0)
 I CLRSERR=2  D
"RTN","PRCHLO5",93,0)
 . N PRCPMSG
"RTN","PRCHLO5",94,0)
 . S PRCPMSG(1)="Error, Problem with FTP File Creation, contact IRM"
"RTN","PRCHLO5",95,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",96,0)
 . Q
"RTN","PRCHLO5",97,0)
 I CLRSERR=0  D
"RTN","PRCHLO5",98,0)
 . N PRCPMSG
"RTN","PRCHLO5",99,0)
 . S PRCPMSG(1)="Built PO Activity Extracts and GIP Extracts for transfer"
"RTN","PRCHLO5",100,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",101,0)
 . Q
"RTN","PRCHLO5",102,0)
 I CKOS["VMS"  D
"RTN","PRCHLO5",103,0)
 . I CLRSERR=0 D CRTCOM^PRCHLO4
"RTN","PRCHLO5",104,0)
 . Q
"RTN","PRCHLO5",105,0)
 I CKOS["NT"  D
"RTN","PRCHLO5",106,0)
 . I CLRSERR=0 D CRTWIN^PRCHLO4A
"RTN","PRCHLO5",107,0)
 . Q
"RTN","PRCHLO5",108,0)
 I CLRSERR=6  D
"RTN","PRCHLO5",109,0)
 . N PRCPMSG
"RTN","PRCHLO5",110,0)
 . S PRCPMSG(1)="Error encountered when attempting to run CLO PO"
"RTN","PRCHLO5",111,0)
 . S PRCPMSG(2)="activity reports due to other CLRS extracts in"
"RTN","PRCHLO5",112,0)
 . S PRCPMSG(3)="progress. Please try again later."
"RTN","PRCHLO5",113,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",114,0)
 . Q
"RTN","PRCHLO5",115,0)
 I $D(CLRSTST1)  D  ; test point to generate message 3
"RTN","PRCHLO5",116,0)
 . Q:CLRSTST1'=3
"RTN","PRCHLO5",117,0)
 . S CLRSERR=3
"RTN","PRCHLO5",118,0)
 . Q
"RTN","PRCHLO5",119,0)
 I CLRSERR=0 D CKRPTSV^PRCHLO4A  ;ping report server for availability
"RTN","PRCHLO5",120,0)
 I CLRSERR=3  D
"RTN","PRCHLO5",121,0)
 . N PRCPMSG
"RTN","PRCHLO5",122,0)
 . S PRCPMSG(1)="Error, problem creating SETUP file for FTP Transfer, contact IRM."
"RTN","PRCHLO5",123,0)
 . S PRCPMSG(2)="The Report Server may be unavailable for processing."
"RTN","PRCHLO5",124,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",125,0)
 . Q
"RTN","PRCHLO5",126,0)
 I CLRSERR=0  D
"RTN","PRCHLO5",127,0)
 . N PRCPMSG,FILEDIR
"RTN","PRCHLO5",128,0)
 . S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO5",129,0)
 . S PRCPMSG(1)="Final FTP Setup complete, beginning FTP Transfer"
"RTN","PRCHLO5",130,0)
 . S PRCPMSG(2)=" "
"RTN","PRCHLO5",131,0)
 . S PRCPMSG(3)="The file transfer to the report server has been initiated."
"RTN","PRCHLO5",132,0)
 . S PRCPMSG(4)="You will be receiving a notification that the FTP"
"RTN","PRCHLO5",133,0)
 . S PRCPMSG(5)="process has completed. The notification message"
"RTN","PRCHLO5",134,0)
 . S PRCPMSG(6)="should be received within the hour.  If you do not"
"RTN","PRCHLO5",135,0)
 . S PRCPMSG(7)="receive the FTP process has completed message,"
"RTN","PRCHLO5",136,0)
 . S PRCPMSG(8)="please contact IRM. IRM can confirm the process"
"RTN","PRCHLO5",137,0)
 . S PRCPMSG(9)="is still running by performing the following"
"RTN","PRCHLO5",138,0)
 . S PRCPMSG(10)="command:"
"RTN","PRCHLO5",139,0)
 . S PRCPMSG(11)=" "
"RTN","PRCHLO5",140,0)
 . S PRCPMSG(12)="At the MUMPS Programmer prompt, type D ^%SS"
"RTN","PRCHLO5",141,0)
 . S PRCPMSG(13)=" "
"RTN","PRCHLO5",142,0)
 . S PRCPMSG(14)="See if there are any PRCHLO* routines running."
"RTN","PRCHLO5",143,0)
 . S PRCPMSG(15)=" "
"RTN","PRCHLO5",144,0)
 . S PRCPMSG(16)="If these routines are present, the process is still"
"RTN","PRCHLO5",145,0)
 . S PRCPMSG(17)="running. If you waited one hour, and did not get the"
"RTN","PRCHLO5",146,0)
 . S PRCPMSG(18)="FTP process has completed message, a problem"
"RTN","PRCHLO5",147,0)
 . S PRCPMSG(19)="was encountered. Further troubleshooting can be"
"RTN","PRCHLO5",148,0)
 . S PRCPMSG(20)="performed by examining the LOGFILE CLRSxxxFTP1.LOG"
"RTN","PRCHLO5",149,0)
 . S PRCPMSG(21)="where xxx is your station ID#. The logfile is"
"RTN","PRCHLO5",150,0)
 . S PRCPMSG(22)="located in the following directory: "_FILEDIR
"RTN","PRCHLO5",151,0)
 . S PRCPMSG(23)=" "
"RTN","PRCHLO5",152,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",153,0)
 . Q
"RTN","PRCHLO5",154,0)
 I CKOS["VMS"  D
"RTN","PRCHLO5",155,0)
 . I CLRSERR=0  D
"RTN","PRCHLO5",156,0)
 . . D CRTCOM1^PRCHLO4
"RTN","PRCHLO5",157,0)
 . . D FTPCOM^PRCHLO4
"RTN","PRCHLO5",158,0)
 . . Q
"RTN","PRCHLO5",159,0)
 . Q
"RTN","PRCHLO5",160,0)
 I CKOS["NT"  D
"RTN","PRCHLO5",161,0)
 . I CLRSERR=0  D
"RTN","PRCHLO5",162,0)
 . . D CRTWIN^PRCHLO4A
"RTN","PRCHLO5",163,0)
 . . D FTPCOM^PRCHLO4A
"RTN","PRCHLO5",164,0)
 . . Q
"RTN","PRCHLO5",165,0)
 . Q
"RTN","PRCHLO5",166,0)
 ; release the lock
"RTN","PRCHLO5",167,0)
 L -^PRCP(446.7,"STATUS")
"RTN","PRCHLO5",168,0)
 I CLRSERR=4  D
"RTN","PRCHLO5",169,0)
 . N PRCPMSG,FILEDIR
"RTN","PRCHLO5",170,0)
 . S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO5",171,0)
 . S PRCPMSG(1)="An Error occurred during the FTP Transfer "_$$HTE^XLFDT($H)
"RTN","PRCHLO5",172,0)
 . S PRCPMSG(2)="Contact IRM to perform troubleshooting steps"
"RTN","PRCHLO5",173,0)
 . S PRCPMSG(3)="by examining the logfile CLRSxxxFTP1.LOG where"
"RTN","PRCHLO5",174,0)
 . S PRCPMSG(4)="xxx is your station number. The logfile is located"
"RTN","PRCHLO5",175,0)
 . S PRCPMSG(5)="the FTP directory "_FILEDIR
"RTN","PRCHLO5",176,0)
 . S PRCPMSG(6)=" "
"RTN","PRCHLO5",177,0)
 . D MAILFTP^PRCHLO4A
"RTN","PRCHLO5",178,0)
 . Q
"RTN","PRCHLO5",179,0)
 I CLRSERR=0  D
"RTN","PRCHLO5",180,0)
 . N PRCPMSG,FILEDIR
"RTN","PRCHLO5",181,0)
 . S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO5",182,0)
 . S PRCPMSG(1)="The FTP Transfer process completed, "_$$HTE^XLFDT($H)
"RTN","PRCHLO5",183,0)
 . S PRCPMSG(2)=" "
"RTN","PRCHLO5",184,0)
 . S PRCPMSG(3)="The Clinical Logistics 0ffice should examine the Report Server"
"RTN","PRCHLO5",185,0)
 . S PRCPMSG(4)="FTP directory for your files. If the files from your"
"RTN","PRCHLO5",186,0)
 . S PRCPMSG(5)="station are not found, IRM can provide additional"
"RTN","PRCHLO5",187,0)
 . S PRCPMSG(6)="troubleshooting steps by examining the LOGFILE"
"RTN","PRCHLO5",188,0)
 . S PRCPMSG(7)="CLRSxxxFTP1.LOG where xxx is your station number."
"RTN","PRCHLO5",189,0)
 . S PRCPMSG(8)="The logfile is located in the directory: "_FILEDIR
"RTN","PRCHLO5",190,0)
 . S PRCPMSG(9)=" "
"RTN","PRCHLO5",191,0)
 . S PRCPMSG(10)="The contents of the logfile are listed below:"
"RTN","PRCHLO5",192,0)
 . D LOG2FILE^PRCHLO4A
"RTN","PRCHLO5",193,0)
 . Q
"RTN","PRCHLO5",194,0)
 ; CLEAN UP
"RTN","PRCHLO5",195,0)
 K ^TMP($J)
"RTN","PRCHLO5",196,0)
 K ^TMP("PRCHLOG",$J)
"RTN","PRCHLO5",197,0)
 Q
"RTN","PRCHLO5",198,0)
DELRUN ; delete previous run at the beginning of the program
"RTN","PRCHLO5",199,0)
 ;
"RTN","PRCHLO5",200,0)
 N FILCK,FILDEL,TFILE1,TFILE2,OUTFL1,OUTFL2,POP,STID
"RTN","PRCHLO5",201,0)
 ; create, delete, then create files to clean up and confirm
"RTN","PRCHLO5",202,0)
 ; write / delete privileges to directory
"RTN","PRCHLO5",203,0)
 S POP=""
"RTN","PRCHLO5",204,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCHLO5",205,0)
 S OUTFL1="CLRS"_STID_"TST.TXT"
"RTN","PRCHLO5",206,0)
 S OUTFL2="IFCP"_STID_"TST.TXT"
"RTN","PRCHLO5",207,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCHLO5",208,0)
 I FILEDIR=""  D
"RTN","PRCHLO5",209,0)
 . S CLRSERR=5
"RTN","PRCHLO5",210,0)
 . Q
"RTN","PRCHLO5",211,0)
 I FILEDIR=" "  D
"RTN","PRCHLO5",212,0)
 . S CLRSERR=5
"RTN","PRCHLO5",213,0)
 . Q
"RTN","PRCHLO5",214,0)
 I CLRSERR=0 D OPEN^%ZISH("TFILE1",FILEDIR,OUTFL1,"W")
"RTN","PRCHLO5",215,0)
 I POP  D
"RTN","PRCHLO5",216,0)
 . S CLRSERR=5
"RTN","PRCHLO5",217,0)
 . Q
"RTN","PRCHLO5",218,0)
 I CLRSERR=0  D
"RTN","PRCHLO5",219,0)
 . D USE^%ZISUTL("TFILE1")
"RTN","PRCHLO5",220,0)
 . W !,"$ ! This is a test file to confirm write/delete access"
"RTN","PRCHLO5",221,0)
 . W !,"$ ! once file access is confirmed, file is deleted"
"RTN","PRCHLO5",222,0)
 . W !,"$ EXIT"
"RTN","PRCHLO5",223,0)
 . D CLOSE^%ZISH("TFILE1")
"RTN","PRCHLO5",224,0)
 . D OPEN^%ZISH("TFILE2",FILEDIR,OUTFL2,"W")
"RTN","PRCHLO5",225,0)
 . D USE^%ZISUTL("TFILE2")
"RTN","PRCHLO5",226,0)
 . W !,"$ ! This is a test file to confirm write/delete access"
"RTN","PRCHLO5",227,0)
 . W !,"$ ! once file access is confirmed, file is deleted"
"RTN","PRCHLO5",228,0)
 . W !,"$ EXIT"
"RTN","PRCHLO5",229,0)
 . D CLOSE^%ZISH("TFILE2")
"RTN","PRCHLO5",230,0)
 . Q
"RTN","PRCHLO5",231,0)
 ;
"RTN","PRCHLO5",232,0)
DELWIN ; DELETE windows files, need to handle 1 file at a time
"RTN","PRCHLO5",233,0)
 ; SACC Exception received for usage of $ZF(-1) in PRC*5.1*83
"RTN","PRCHLO5",234,0)
 ; See IFCAP technical manual.
"RTN","PRCHLO5",235,0)
 I CKOS["NT" D DELWIN^PRCHLO4A
"RTN","PRCHLO5",236,0)
DELFILS ; Delete the files / clean-up before processing
"RTN","PRCHLO5",237,0)
 ;
"RTN","PRCHLO5",238,0)
 ; SACC Exception received for usage of $ZF(-1) in PRC*5.1*83
"RTN","PRCHLO5",239,0)
 ; See IFCAP technical manual
"RTN","PRCHLO5",240,0)
 I CKOS["VMS"  D  ;O/S IS VMS
"RTN","PRCHLO5",241,0)
 . Q:CLRSERR'="0"
"RTN","PRCHLO5",242,0)
 . N PV,PV1,XPV,XPV1
"RTN","PRCHLO5",243,0)
 . S XPV="S PV=$ZF(-1,""DELETE "_FILEDIR_"*"_STID_"*.*;*"")"
"RTN","PRCHLO5",244,0)
 . X XPV
"RTN","PRCHLO5",245,0)
 . Q
"RTN","PRCHLO5",246,0)
 Q
"RTN","PRCPAGP1")
0^4^B29394147^B27705278
"RTN","PRCPAGP1",1,0)
PRCPAGP1 ;WISC/RFJ-autogenerate primary or whse order ; 10/30/06 12:31pm
"RTN","PRCPAGP1",2,0)
V ;;5.1;IFCAP;**1,98**;Oct 20, 2000;Build 37
"RTN","PRCPAGP1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPAGP1",4,0)
 Q
"RTN","PRCPAGP1",5,0)
 ;
"RTN","PRCPAGP1",6,0)
 ;
"RTN","PRCPAGP1",7,0)
START ;  start autogenerating items
"RTN","PRCPAGP1",8,0)
 ; new of X,X1,X2 added with PRC*5.1*98
"RTN","PRCPAGP1",9,0)
 N %,CONV,COST,DESCNSN,EACHONE,ERROR,EXIT,G,GROUP,GROUPNM
"RTN","PRCPAGP1",10,0)
 N INACTIVE,ISSMULT,ITEMDA,ITEMDATA,LASTONE,LEVEL,MANSRCE,MINISS
"RTN","PRCPAGP1",11,0)
 N NOWDT,NUMBER,ORDER,PRCPFLAG,QTY,QTYAVAIL,TEMPLVL,TOTITEMS,TYPE
"RTN","PRCPAGP1",12,0)
 N UNITI,UNITR,VENDATA,VENDOR,VENDORNM,WHSEDATA,X,X1,X2
"RTN","PRCPAGP1",13,0)
 D NOW^%DTC S NOWDT=%
"RTN","PRCPAGP1",14,0)
 L +^PRCP(445,PRCP("I"),1):5 I '$T D SHOWWHO^PRCPULOC(445,PRCP("I")_"-1",0) Q
"RTN","PRCPAGP1",15,0)
 D ADD^PRCPULOC(445,PRCP("I")_"-1",0,"Autogeneration")
"RTN","PRCPAGP1",16,0)
 W !!,"<<< Starting Auto-generation ...",!
"RTN","PRCPAGP1",17,0)
 S EACHONE=$$INPERCNT^PRCPUX2(+$P($G(^PRCP(445,PRCP("I"),1,0)),"^",4),"*",PRCP("RV1"),PRCP("RV0"))
"RTN","PRCPAGP1",18,0)
 S (TOTITEMS,ITEMDA)=0
"RTN","PRCPAGP1",19,0)
 F NUMBER=1:1 S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S ITEMDATA=$G(^(ITEMDA,0)) I ITEMDATA'="" D
"RTN","PRCPAGP1",20,0)
 . S LASTONE=$$SHPERCNT^PRCPUX2(NUMBER,EACHONE,"*",PRCP("RV1"),PRCP("RV0"))
"RTN","PRCPAGP1",21,0)
 . ;  use this for sorting (primary:description, whse:nsn)
"RTN","PRCPAGP1",22,0)
 . I PRCP("DPTYPE")="P" D
"RTN","PRCPAGP1",23,0)
 . . S DESCNSN=$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,16)
"RTN","PRCPAGP1",24,0)
 . . S:DESCNSN="" DESCNSN=" "
"RTN","PRCPAGP1",25,0)
 . E  S DESCNSN=$$NSN^PRCPUX1(ITEMDA) I DESCNSN="" D  D ERROR Q
"RTN","PRCPAGP1",26,0)
 . . S DESCNSN=" "
"RTN","PRCPAGP1",27,0)
 . . S ERROR="NSN is missing for item"
"RTN","PRCPAGP1",28,0)
 . ;  remove temp stock level if greater than date
"RTN","PRCPAGP1",29,0)
 . I $P(ITEMDATA,"^",23)>0,NOWDT>$P(ITEMDATA,"^",24) D
"RTN","PRCPAGP1",30,0)
 . . D DELTEMP^PRCPAGU1(PRCP("I"),ITEMDA)
"RTN","PRCPAGP1",31,0)
 . . S $P(ITEMDATA,"^",23,24)="^"
"RTN","PRCPAGP1",32,0)
 . ;  check for 'delete item when inventory 0'
"RTN","PRCPAGP1",33,0)
 . I $P(ITEMDATA,"^",26)="Y" D  Q
"RTN","PRCPAGP1",34,0)
 . . I $P(ITEMDATA,"^",7)!($P(ITEMDATA,"^",19))!($P(ITEMDATA,"^",27)) Q
"RTN","PRCPAGP1",35,0)
 . . S INACTIVE=$P(^PRCP(445,PRCP("I"),0),"^",13)
"RTN","PRCPAGP1",36,0)
 . . I INACTIVE D  I EXIT Q
"RTN","PRCPAGP1",37,0)
 . . . S EXIT=0
"RTN","PRCPAGP1",38,0)
 . . . D NOW^%DTC
"RTN","PRCPAGP1",39,0)
 . . . S X1=X,X2=-(INACTIVE*30+1)
"RTN","PRCPAGP1",40,0)
 . . . D C^%DTC
"RTN","PRCPAGP1",41,0)
 . . . I $O(^PRCP(445,PRCP("I"),1,ITEMDA,2,$E(X,1,5)-.1)) S EXIT=1 Q
"RTN","PRCPAGP1",42,0)
 . . . I $O(^PRCP(445,PRCP("I"),1,ITEMDA,3,X)) S EXIT=1 Q
"RTN","PRCPAGP1",43,0)
 . . I $$ORDCHK^PRCPUITM(ITEMDA,PRCP("I"),"RCE","") D  D ERROR S EXIT=1 Q
"RTN","PRCPAGP1",44,0)
 . . . S ERROR="INACTIVE ITEM ON ORDER - can't delete from inventory point (KWZ)"
"RTN","PRCPAGP1",45,0)
 . . S ERROR="DELETING ITEM from inventory point (KWZ)" D ERROR
"RTN","PRCPAGP1",46,0)
 . . D DELITEM^PRCPUITM(PRCP("I"),ITEMDA)
"RTN","PRCPAGP1",47,0)
 . ;  not a purchasable item
"RTN","PRCPAGP1",48,0)
 . I '$$PURCHASE^PRCPU441(ITEMDA) Q
"RTN","PRCPAGP1",49,0)
 . ;  BOC
"RTN","PRCPAGP1",50,0)
 . I $$SUBACCT^PRCPU441(ITEMDA)="" S ERROR="BOC is missing for item" D ERROR Q
"RTN","PRCPAGP1",51,0)
 . ;  inactive items
"RTN","PRCPAGP1",52,0)
 . I $$INACTIVE^PRCPU441(ITEMDA) D  D ERROR Q
"RTN","PRCPAGP1",53,0)
 . . S %=^PRC(441,ITEMDA,3)
"RTN","PRCPAGP1",54,0)
 . . S ERROR="INACTIVATED item.  "_$S($P(%,"^",4)<1:"There are NO substitute items",1:"Use item number: "_$P(%,"^",4))
"RTN","PRCPAGP1",55,0)
 . ;
"RTN","PRCPAGP1",56,0)
 . ;  group not selected
"RTN","PRCPAGP1",57,0)
 . S GROUP=+$P(ITEMDATA,"^",21)
"RTN","PRCPAGP1",58,0)
 . S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPAGP1",59,0)
 . I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPAGP1",60,0)
 . S:GROUPNM="" GROUPNM=" "
"RTN","PRCPAGP1",61,0)
 . I GROUPNM=" " S ERROR="GROUP CATEGORY missing for item" D ERROR Q
"RTN","PRCPAGP1",62,0)
 . I $G(GROUPALL),$D(^TMP($J,"PRCPAG","GN",GROUP)) D  Q
"RTN","PRCPAGP1",63,0)
 . . S ^TMP($J,"PRCPAG","NOG",GROUPNM,DESCNSN,ITEMDA)="" Q
"RTN","PRCPAGP1",64,0)
 . I '$G(GROUPALL),'$D(^TMP($J,"PRCPAG","GY",GROUP)) D  Q
"RTN","PRCPAGP1",65,0)
 . . S ^TMP($J,"PRCPAG","NOG",GROUPNM,DESCNSN,ITEMDA)="" Q
"RTN","PRCPAGP1",66,0)
 . ;
"RTN","PRCPAGP1",67,0)
 . ;  vendor not selected
"RTN","PRCPAGP1",68,0)
 . S MANSRCE=$P(ITEMDATA,"^",12)
"RTN","PRCPAGP1",69,0)
 . S VENDOR=+MANSRCE I MANSRCE["PRCP(445" S VENDOR=WHSE
"RTN","PRCPAGP1",70,0)
 . S VENDORNM=$P($G(^PRC(440,VENDOR,0)),"^")
"RTN","PRCPAGP1",71,0)
 . I VENDORNM="" D  D ERROR Q
"RTN","PRCPAGP1",72,0)
 . . S ERROR="MANDATORY OR REQUESTED SOURCE is missing for item"
"RTN","PRCPAGP1",73,0)
 . I $G(VENDALL),$D(^TMP($J,"PRCPAG","VN",VENDOR)) D  Q
"RTN","PRCPAGP1",74,0)
 . . S ^TMP($J,"PRCPAG","NOV",VENDORNM,VENDOR,DESCNSN,ITEMDA)="" Q
"RTN","PRCPAGP1",75,0)
 . I '$G(VENDALL),'$D(^TMP($J,"PRCPAG","VY",VENDOR)) D  Q
"RTN","PRCPAGP1",76,0)
 . . S ^TMP($J,"PRCPAG","NOV",VENDORNM,VENDOR,DESCNSN,ITEMDA)="" Q
"RTN","PRCPAGP1",77,0)
 . I $P(ITEMDATA,"^",26)="Y" D  D ERROR Q
"RTN","PRCPAGP1",78,0)
 . . S ERROR="KWZ is set to YES, item not ordered"
"RTN","PRCPAGP1",79,0)
 . ;  check normal stock level (zero allowed for on-demand items - PRC*5.1*98)
"RTN","PRCPAGP1",80,0)
 . I $P(ITEMDATA,"^",9)=0&($P(ITEMDATA,"^",30)'="Y")!($P(ITEMDATA,"^",9)']"") D  D ERROR Q
"RTN","PRCPAGP1",81,0)
 . . S ERROR="NORMAL STOCK LEVEL missing for item"
"RTN","PRCPAGP1",82,0)
 . ;  check standard reorder point (no nils, 0 valid with PRC*5.1*1)
"RTN","PRCPAGP1",83,0)
 . I $P(ITEMDATA,"^",10)']"" D  D ERROR Q
"RTN","PRCPAGP1",84,0)
 . . S ERROR="STANDARD REORDER POINT missing for item"
"RTN","PRCPAGP1",85,0)
 . S VENDATA=$$GETVEN^PRCPUVEN(PRCP("I"),ITEMDA,MANSRCE,1)
"RTN","PRCPAGP1",86,0)
 . I 'VENDATA D  D ERROR Q
"RTN","PRCPAGP1",87,0)
 . . S ERROR="Vendor '"_VENDORNM_" is NOT a procurement source"
"RTN","PRCPAGP1",88,0)
 . ;
"RTN","PRCPAGP1",89,0)
 . ;  get vendor data
"RTN","PRCPAGP1",90,0)
 . K PRCPFLAG D  I $G(PRCPFLAG) Q
"RTN","PRCPAGP1",91,0)
 . . I MANSRCE["PRCP(445" D  Q
"RTN","PRCPAGP1",92,0)
 . . . S WHSEDATA=$G(^PRCP(445,+MANSRCE,1,ITEMDA,0))
"RTN","PRCPAGP1",93,0)
 . . . I WHSEDATA="" D  Q
"RTN","PRCPAGP1",94,0)
 . . . . S ERROR="Item NOT stored in the warehouse inventory point"
"RTN","PRCPAGP1",95,0)
 . . . . D ERROR
"RTN","PRCPAGP1",96,0)
 . . . . S PRCPFLAG=1 Q
"RTN","PRCPAGP1",97,0)
 . . . S UNITI=$$UNIT^PRCPUX1(+MANSRCE,ITEMDA,"/")
"RTN","PRCPAGP1",98,0)
 . . . S COST=$P(WHSEDATA,"^",15)
"RTN","PRCPAGP1",99,0)
 . . . S:$P(WHSEDATA,"^",22)>COST COST=$P(WHSEDATA,"^",22)
"RTN","PRCPAGP1",100,0)
 . . . S MINISS=$P(WHSEDATA,"^",17)
"RTN","PRCPAGP1",101,0)
 . . . S ISSMULT=$P(WHSEDATA,"^",25)
"RTN","PRCPAGP1",102,0)
 . . S %=$G(^PRC(441,ITEMDA,2,+MANSRCE,0))
"RTN","PRCPAGP1",103,0)
 . . S UNITI=$$UNITVAL^PRCPUX1($P(%,"^",8),$P(%,"^",7),"/")
"RTN","PRCPAGP1",104,0)
 . . S COST=$P(%,"^",2)
"RTN","PRCPAGP1",105,0)
 . . S MINISS=$P(%,"^",12)
"RTN","PRCPAGP1",106,0)
 . . S ISSMULT=$P(%,"^",11)
"RTN","PRCPAGP1",107,0)
 . S UNITR=$$UNITVAL^PRCPUX1($P(VENDATA,"^",3),$P(VENDATA,"^",2),"/")
"RTN","PRCPAGP1",108,0)
 . I UNITI'=UNITR D  D ERROR Q
"RTN","PRCPAGP1",109,0)
 . . S ERROR="UNIT/REC: "_UNITR_"  does not equal UNIT/ISS: "_UNITI_" for vendor: "_VENDORNM
"RTN","PRCPAGP1",110,0)
 . S CONV=+$P(VENDATA,"^",4) S:CONV<1 CONV=1
"RTN","PRCPAGP1",111,0)
 . D QTYORD^PRCPAGU2
"RTN","PRCPAGP1",112,0)
 D CLEAR^PRCPULOC(445,PRCP("I")_"-1",0)
"RTN","PRCPAGP1",113,0)
 L -^PRCP(445,PRCP("I"),1)
"RTN","PRCPAGP1",114,0)
 ;
"RTN","PRCPAGP1",115,0)
 D QPERCNT^PRCPUX2(+$G(LASTONE),"*",PRCP("RV1"),PRCP("RV0"))
"RTN","PRCPAGP1",116,0)
 W !!,"<<< Finished !"
"RTN","PRCPAGP1",117,0)
 D CONT^PRCPAGP2 Q
"RTN","PRCPAGP1",118,0)
 ;
"RTN","PRCPAGP1",119,0)
 ;
"RTN","PRCPAGP1",120,0)
ERROR ;  set tmp with error message
"RTN","PRCPAGP1",121,0)
 S ^TMP($J,"PRCPAG","ER",DESCNSN,ITEMDA)=ERROR Q
"RTN","PRCPAGRO")
0^5^B15045833^B13340275
"RTN","PRCPAGRO",1,0)
PRCPAGRO ;WISC/RFJ,DXH/VAC - autogenerate print suggested distribution order ; 2/19/07 12:46pm
"RTN","PRCPAGRO",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPAGRO",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPAGRO",4,0)
 ;*98 Modified to accommodate On-Demand items.
"RTN","PRCPAGRO",5,0)
 Q
"RTN","PRCPAGRO",6,0)
 ;
"RTN","PRCPAGRO",7,0)
 ;
"RTN","PRCPAGRO",8,0)
ORDER ;  print order to create
"RTN","PRCPAGRO",9,0)
 ;  for ^tmp($j,"prcpag","ok",vendorname,vendorda,groupname,
"RTN","PRCPAGRO",10,0)
 ;  xxx,itemda) where xxx equals whse:nsn;  prim or seco:descr
"RTN","PRCPAGRO",11,0)
 N %,%H,%I,D,DESCNSN,GNM,ITEMDA,NOW,ODITEM,ORDER,PAGE,SCREEN,TOTCOST,VDA,VNM,X,Y
"RTN","PRCPAGRO",12,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO
"RTN","PRCPAGRO",13,0)
 S VNM="" F  S VNM=$O(^TMP($J,"PRCPAG","OK",VNM)) Q:VNM=""!($G(PRCPFLAG))  S VDA=0 F  S VDA=$O(^TMP($J,"PRCPAG","OK",VNM,VDA)) Q:'VDA!($G(PRCPFLAG))  D
"RTN","PRCPAGRO",14,0)
 . I PAGE>1 D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)
"RTN","PRCPAGRO",15,0)
 . S TOTCOST=0,ORDER=$G(^TMP($J,"PRCPAG","VO",VDA)) S:ORDER="" ORDER="<< UNABLE TO CREATE ORDER >>" D H
"RTN","PRCPAGRO",16,0)
 . S GNM="" F  S GNM=$O(^TMP($J,"PRCPAG","OK",VNM,VDA,GNM)) Q:GNM=""!($G(PRCPFLAG))  D
"RTN","PRCPAGRO",17,0)
 .. I $Y>(IOSL-8) D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)  D H
"RTN","PRCPAGRO",18,0)
 .. W !!?12,"GROUP CATEGORY: ",$S(GNM=" ":"<< NOT SPECIFIED >>",1:GNM)
"RTN","PRCPAGRO",19,0)
 .. S DESCNSN="" F  S DESCNSN=$O(^TMP($J,"PRCPAG","OK",VNM,VDA,GNM,DESCNSN)) Q:DESCNSN=""!($G(PRCPFLAG))  D
"RTN","PRCPAGRO",20,0)
 ... S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPAG","OK",VNM,VDA,GNM,DESCNSN,ITEMDA)) Q:'ITEMDA!($G(PRCPFLAG))  S D=^(ITEMDA) D
"RTN","PRCPAGRO",21,0)
 .... S %=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA)
"RTN","PRCPAGRO",22,0)
 .... S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPAGRO",23,0)
 .... I PRCP("DPTYPE")="W" D
"RTN","PRCPAGRO",24,0)
 ..... W !!,ITEMDA,?7 W:PRCP("DPTYPE")'="W" $E(%,1,35) W:PRCP("DPTYPE")="W" $E(%,1,20),?31,$$NSN^PRCPUX1(ITEMDA) W ?50,$J($$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/"),9),$J($P(D,"^",12),9),$J($P(D,"^",15),6),$J($P(D,"^",16),6)
"RTN","PRCPAGRO",25,0)
 .... I PRCP("DPTYPE")'="W" D
"RTN","PRCPAGRO",26,0)
 ..... W !!,ITEMDA
"RTN","PRCPAGRO",27,0)
 ..... I ODITEM="Y" W ?8,"D  "
"RTN","PRCPAGRO",28,0)
 ..... I ODITEM'="Y" W ?8,"   "
"RTN","PRCPAGRO",29,0)
 ..... W:PRCP("DPTYPE")'="W" $E(%,1,32) W:PRCP("DPTYPE")="W" $E(%,1,17)
"RTN","PRCPAGRO",30,0)
 .... W ?31,$$NSN^PRCPUX1(ITEMDA) W ?50,$J($$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/"),9),$J($P(D,"^",12),9),$J($P(D,"^",15),6),$J($P(D,"^",16),6)
"RTN","PRCPAGRO",31,0)
 .... W !,$J("ONHAND",8),$J("+DUEIN",8),$J("-DUEOUT",8),$J("=AVAIL",8),$J("STAND",7),$J("OPTN",8),$J("LEVEL",8),$J("CONV",7),$J("ORDER",8),$J("UNIT$",10)
"RTN","PRCPAGRO",32,0)
 .... W !,$J(+$P(D,"^"),8),$J(+$P(D,"^",2),8),$J(+$P(D,"^",3),8),$J(+$P(D,"^",4),8),$J(+$P(D,"^",5),7),$S($P(D,"^",7)="STA":"*",1:" "),$J(+$P(D,"^",6),7),$S($P(D,"^",7)="OPT":"*",1:" ")
"RTN","PRCPAGRO",33,0)
 .... W $J(+$P(D,"^",8),7),$S($P(D,"^",9)="*":"*",1:" "),$J(+$P(D,"^",10),6),$J(+$P(D,"^",11),8),$J(+$P(D,"^",14),10,3)
"RTN","PRCPAGRO",34,0)
 .... S TOTCOST=TOTCOST+$J($P(D,"^",11)*$P(D,"^",14),0,2)
"RTN","PRCPAGRO",35,0)
 ....   I $Y>(IOSL-9) D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)  D H W !!?12,"GROUP CATEGORY: ",$S(GNM=" ":"<< NOT SPECIFIED >>",1:GNM)
"RTN","PRCPAGRO",36,0)
 . I $G(PRCPFLAG) Q
"RTN","PRCPAGRO",37,0)
 . I $Y>(IOSL-8) D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)  D H
"RTN","PRCPAGRO",38,0)
 . W !!,"TOTAL COST OF ORDER: ",TOTCOST
"RTN","PRCPAGRO",39,0)
 I $G(PRCPFLAG) Q
"RTN","PRCPAGRO",40,0)
 D END^PRCPUREP
"RTN","PRCPAGRO",41,0)
 Q
"RTN","PRCPAGRO",42,0)
 ;
"RTN","PRCPAGRO",43,0)
 ;
"RTN","PRCPAGRO",44,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPAGRO",45,0)
 W $C(13),"AUTO-GEN: SUGGESTED ORDERS FOR ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPAGRO",46,0)
 W !?5,"ORDERING FROM ",$S(PRCP("DPTYPE")="S":"PRIMARY INVENTORY POINT",1:"VENDOR"),": ",VNM
"RTN","PRCPAGRO",47,0)
 W !?5,$S(PRCP("DPTYPE")="S":"DISTRIBUTION ORDER",1:"REPETITIVE ITEM LIST")," NUMBER: ",ORDER
"RTN","PRCPAGRO",48,0)
 W !?50,$J($S(PRCP("DPTYPE")="S":"SECONDARY",PRCP("DPTYPE")="P":"PRIMARY",1:"WHSE"),9),$J($S(PRCP("DPTYPE")="S":"PRIMARY",1:"VENDOR"),9),$J("ISSUE",6),$J("ISSUE",6)
"RTN","PRCPAGRO",49,0)
 W !,"IM#"
"RTN","PRCPAGRO",50,0)
 I PRCP("DPTYPE")="W" D
"RTN","PRCPAGRO",51,0)
 . W ?7,"DESCRIPTION"
"RTN","PRCPAGRO",52,0)
 I PRCP("DPTYPE")'="W" D
"RTN","PRCPAGRO",53,0)
 . W ?8,"OD",?11,"DESCRIPTION"
"RTN","PRCPAGRO",54,0)
 W:PRCP("DPTYPE") ?31,"NSN" W ?50,$J("UNIT/ISS",9),$J("UNIT/ISS",9),$J("MINIM",6),$J("MULT",6)
"RTN","PRCPAGRO",55,0)
 S %="",$P(%,"-",81)="" W !,%
"RTN","PRCPAGRO",56,0)
 Q
"RTN","PRCPAGS1")
0^6^B21098347^B19591058
"RTN","PRCPAGS1",1,0)
PRCPAGS1 ;WISC/RFJ-autogenerate secondary order ; 10/30/06 12:32pm
"RTN","PRCPAGS1",2,0)
V ;;5.1;IFCAP;**1,98**;Oct 20, 2000;Build 37
"RTN","PRCPAGS1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPAGS1",4,0)
 Q
"RTN","PRCPAGS1",5,0)
 ;
"RTN","PRCPAGS1",6,0)
 ; PRCPSCHE is a flag passed by the Scheduler
"RTN","PRCPAGS1",7,0)
 ; PRCPFBAR is a flag passed by the barcode upload
"RTN","PRCPAGS1",8,0)
 ;
"RTN","PRCPAGS1",9,0)
START ;  start autogenerating items
"RTN","PRCPAGS1",10,0)
 N %,CONV,COST,DESCNSN,EACHONE,ERROR,EXIT,GROUP,GROUPNM
"RTN","PRCPAGS1",11,0)
 N INACTIVE,ISSMULT,ITEMDA,ITEMDATA,LASTONE,LEVEL,MINISS,NOWDT,NUMBER
"RTN","PRCPAGS1",12,0)
 N ORDER,PRIMDATA,QTY,QTYAVAIL,TEMPLVL,TOTITEMS,TYPE
"RTN","PRCPAGS1",13,0)
 N UNITI,UNITR,VENDATA,VENDOR,VENDORNM,X,Y
"RTN","PRCPAGS1",14,0)
 D NOW^%DTC S NOWDT=%
"RTN","PRCPAGS1",15,0)
 L +^PRCP(445,PRCP("I"),1):5 I '$T D  Q
"RTN","PRCPAGS1",16,0)
 . I '$D(PRCPSCHE) D SHOWWHO^PRCPULOC(445,PRCP("I")_"-1",0)
"RTN","PRCPAGS1",17,0)
 . I $D(PRCPSCHE) S $P(PRCPSCHE,"^",2)=4
"RTN","PRCPAGS1",18,0)
 D ADD^PRCPULOC(445,PRCP("I")_"-1",0,"Autogeneration")
"RTN","PRCPAGS1",19,0)
 W !!,"<<< Starting Auto-generation ...",!
"RTN","PRCPAGS1",20,0)
 I '$D(PRCPSCHE) S EACHONE=$$INPERCNT^PRCPUX2(+$P($G(^PRCP(445,PRCP("I"),1,0)),"^",4),"*",PRCP("RV1"),PRCP("RV0"))
"RTN","PRCPAGS1",21,0)
 S (TOTITEMS,ITEMDA)=0
"RTN","PRCPAGS1",22,0)
 F NUMBER=1:1 S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S ITEMDATA=$G(^(ITEMDA,0)) I ITEMDATA'="" D
"RTN","PRCPAGS1",23,0)
 . I '$D(PRCPSCHE) S LASTONE=$$SHPERCNT^PRCPUX2(NUMBER,EACHONE,"*",PRCP("RV1"),PRCP("RV0"))
"RTN","PRCPAGS1",24,0)
 . S DESCNSN=$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,16)
"RTN","PRCPAGS1",25,0)
 . S:DESCNSN="" DESCNSN=" "
"RTN","PRCPAGS1",26,0)
 . S GROUP=+$P(ITEMDATA,"^",21)
"RTN","PRCPAGS1",27,0)
 . S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPAGS1",28,0)
 . I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_"(#"_GROUP_")"
"RTN","PRCPAGS1",29,0)
 . S:GROUPNM="" GROUPNM=" "
"RTN","PRCPAGS1",30,0)
 . ;  remove temp stock level if greater than date
"RTN","PRCPAGS1",31,0)
 . I $P(ITEMDATA,"^",23)>0,NOWDT>$P(ITEMDATA,"^",24) D
"RTN","PRCPAGS1",32,0)
 . . D DELTEMP^PRCPAGU1(PRCP("I"),ITEMDA)
"RTN","PRCPAGS1",33,0)
 . . S $P(ITEMDATA,"^",23,24)="^"
"RTN","PRCPAGS1",34,0)
 . ;  check for 'delete item when inventory 0'
"RTN","PRCPAGS1",35,0)
 . I $P(ITEMDATA,"^",26)="Y" D  Q
"RTN","PRCPAGS1",36,0)
 . . I $P(ITEMDATA,"^",7)!($P(ITEMDATA,"^",19))!($P(ITEMDATA,"^",27)) Q
"RTN","PRCPAGS1",37,0)
 . . S INACTIVE=$P(^PRCP(445,PRCP("I"),0),"^",13)
"RTN","PRCPAGS1",38,0)
 . . I INACTIVE D  I EXIT Q
"RTN","PRCPAGS1",39,0)
 . . . N X1,X2 ; initialization of X1,X2 added with PRC*5.1*98
"RTN","PRCPAGS1",40,0)
 . . . S EXIT=0
"RTN","PRCPAGS1",41,0)
 . . . D NOW^%DTC
"RTN","PRCPAGS1",42,0)
 . . . S X1=X,X2=-(INACTIVE*30+1)
"RTN","PRCPAGS1",43,0)
 . . . D C^%DTC
"RTN","PRCPAGS1",44,0)
 . . . I $O(^PRCP(445,PRCP("I"),1,ITEMDA,2,$E(X,1,5)-.1)) S EXIT=1 Q
"RTN","PRCPAGS1",45,0)
 . . . I $O(^PRCP(445,PRCP("I"),1,ITEMDA,3,X)) S EXIT=1 Q
"RTN","PRCPAGS1",46,0)
 . . I $$ORDCHK^PRCPUITM(ITEMDA,PRCP("I"),"RCE","") D  D ERROR Q
"RTN","PRCPAGS1",47,0)
 . . . S ERROR="INACTIVE ITEM ON ORDER - can't delete from inventory point (KWZ)"
"RTN","PRCPAGS1",48,0)
 . . S ERROR="DELETING ITEM from inventory point (KWZ)"
"RTN","PRCPAGS1",49,0)
 . . D ERROR
"RTN","PRCPAGS1",50,0)
 . . D DELITEM^PRCPUITM(PRCP("I"),ITEMDA)
"RTN","PRCPAGS1",51,0)
 . ;
"RTN","PRCPAGS1",52,0)
 . ;  primary vendor not selected
"RTN","PRCPAGS1",53,0)
 . S VENDOR=$P(ITEMDATA,"^",12)
"RTN","PRCPAGS1",54,0)
 . I 'VENDOR D  D ERROR Q
"RTN","PRCPAGS1",55,0)
 . . S ERROR="MANDATORY OR REQUESTED SOURCE is missing for item"
"RTN","PRCPAGS1",56,0)
 . I VENDOR["PRC(440" D  D ERROR Q
"RTN","PRCPAGS1",57,0)
 . . S ERROR="MANDATORY OR REQUESTED SOURCE should be a primary distribution point"
"RTN","PRCPAGS1",58,0)
 . S VENDOR=+VENDOR
"RTN","PRCPAGS1",59,0)
 . I '$D(^TMP($J,"PRCPAG","V",VENDOR)) D  Q
"RTN","PRCPAGS1",60,0)
 . . S %=$S('VENDOR:" ",1:$$INVNAME^PRCPUX1(VENDOR))
"RTN","PRCPAGS1",61,0)
 . . S:%="" %=" "
"RTN","PRCPAGS1",62,0)
 . . S ^TMP($J,"PRCPAG","NOV",%,VENDOR,DESCNSN,ITEMDA)=""
"RTN","PRCPAGS1",63,0)
 . I $P(ITEMDATA,"^",26)="Y" D  D ERROR Q
"RTN","PRCPAGS1",64,0)
 . . S ERROR="KWZ is set to YES, item not ordered"
"RTN","PRCPAGS1",65,0)
 . ;  check normal stock level (O allowed for ODI per PRC*5.1*98)
"RTN","PRCPAGS1",66,0)
 . I $P(ITEMDATA,"^",9)=0&($P(ITEMDATA,"^",30)'="Y")!($P(ITEMDATA,"^",9)']"") D  D ERROR Q
"RTN","PRCPAGS1",67,0)
 . . S ERROR="NORMAL STOCK LEVEL missing for item"
"RTN","PRCPAGS1",68,0)
 . ;  check standard re-order point (no nils, 0 valid with PRC*5.1*1)
"RTN","PRCPAGS1",69,0)
 . I $P(ITEMDATA,"^",10)']"" D  D ERROR Q
"RTN","PRCPAGS1",70,0)
 . . S ERROR="STANDARD REORDER POINT missing for item"
"RTN","PRCPAGS1",71,0)
 . S VENDORNM=$$INVNAME^PRCPUX1(VENDOR)
"RTN","PRCPAGS1",72,0)
 . S VENDATA=$$GETVEN^PRCPUVEN(PRCP("I"),ITEMDA,VENDOR_";PRCP(445,",1)
"RTN","PRCPAGS1",73,0)
 . I 'VENDATA D  D ERROR Q
"RTN","PRCPAGS1",74,0)
 . . S ERROR="Primary '"_VENDORNM_" is NOT a procurement source"
"RTN","PRCPAGS1",75,0)
 . S PRIMDATA=$G(^PRCP(445,VENDOR,1,ITEMDA,0))
"RTN","PRCPAGS1",76,0)
 . I PRIMDATA="" D  D ERROR Q
"RTN","PRCPAGS1",77,0)
 . . S ERROR="Item NOT stored in primary inventory point: "_VENDORNM
"RTN","PRCPAGS1",78,0)
 . S UNITI=$$UNIT^PRCPUX1(VENDOR,ITEMDA,"/")
"RTN","PRCPAGS1",79,0)
 . S UNITR=$$UNITVAL^PRCPUX1($P(VENDATA,"^",3),$P(VENDATA,"^",2),"/")
"RTN","PRCPAGS1",80,0)
 . I UNITI'=UNITR D  D ERROR Q
"RTN","PRCPAGS1",81,0)
 . . S ERROR="UNIT/REC: "_UNITR_"  does not equal UNIT/ISS: "_UNITI_" for primary inventory point: "_VENDORNM
"RTN","PRCPAGS1",82,0)
 . S CONV=+$P(VENDATA,"^",4) S:CONV<1 CONV=1
"RTN","PRCPAGS1",83,0)
 . S COST=$P(PRIMDATA,"^",22)
"RTN","PRCPAGS1",84,0)
 . I $P(PRIMDATA,"^",15)>COST S COST=$P(PRIMDATA,"^",15)
"RTN","PRCPAGS1",85,0)
 . S MINISS=$P(PRIMDATA,"^",17)
"RTN","PRCPAGS1",86,0)
 . S ISSMULT=$P(PRIMDATA,"^",25)
"RTN","PRCPAGS1",87,0)
 . D QTYORD^PRCPAGU2
"RTN","PRCPAGS1",88,0)
 D CLEAR^PRCPULOC(445,PRCP("I")_"-1",0)
"RTN","PRCPAGS1",89,0)
 L -^PRCP(445,PRCP("I"),1)
"RTN","PRCPAGS1",90,0)
 ;
"RTN","PRCPAGS1",91,0)
 I '$D(PRCPSCHE) D QPERCNT^PRCPUX2(+$G(LASTONE),"*",PRCP("RV1"),PRCP("RV0"))
"RTN","PRCPAGS1",92,0)
 W !!,"<<< Finished !"
"RTN","PRCPAGS1",93,0)
 D CONT^PRCPAGS2
"RTN","PRCPAGS1",94,0)
 Q
"RTN","PRCPAGS1",95,0)
 ;
"RTN","PRCPAGS1",96,0)
 ;
"RTN","PRCPAGS1",97,0)
ERROR ;  set tmp with error message
"RTN","PRCPAGS1",98,0)
 S ^TMP($J,"PRCPAG","ER",DESCNSN,ITEMDA)=ERROR Q
"RTN","PRCPAODI")
0^7^B47623250^n/a
"RTN","PRCPAODI",1,0)
PRCPAODI ;WOIFO/CC-enter/edit On-Demand users ; 2/8/07 4:15pm
"RTN","PRCPAODI",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPAODI",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPAODI",4,0)
 Q
"RTN","PRCPAODI",5,0)
 ;
"RTN","PRCPAODI",6,0)
ENT ;
"RTN","PRCPAODI",7,0)
 I '$$KEY^PRCPUREP("PRCPODI",DUZ) D EN^DDIOL("You are not authorized to make managers On-Demand Users.") Q
"RTN","PRCPAODI",8,0)
 ;
"RTN","PRCPAODI",9,0)
 N %,D,DIC,PRCF,PRCP,PRCPIN,PRCPINPT,PRCPMAN,PRCPNAME,X,Y
"RTN","PRCPAODI",10,0)
 ;
"RTN","PRCPAODI",11,0)
 ; Prompt for user
"RTN","PRCPAODI",12,0)
USER S DIC="^VA(200,",DIC(0)="AEQMOZ",DIC("A")="INVENTORY POINT MANAGER: ",D="B"
"RTN","PRCPAODI",13,0)
 D IX^DIC
"RTN","PRCPAODI",14,0)
 K DIC,D I Y<0 Q
"RTN","PRCPAODI",15,0)
 S PRCPMAN=+Y
"RTN","PRCPAODI",16,0)
 L +^PRCPAODI(PRCPMAN):0 I $T=0 D EN^DDIOL(">>File in Use.  Please try again later.") W ! G USER
"RTN","PRCPAODI",17,0)
 ;
"RTN","PRCPAODI",18,0)
 ; Verify user is active
"RTN","PRCPAODI",19,0)
 S X=$$GET1^DIQ(200,PRCPMAN_",","9.2","I") ; termination date
"RTN","PRCPAODI",20,0)
 I X,X'>DT D EN^DDIOL(">>This user has been terminated and cannot be selected.") W ! D EXIT G USER
"RTN","PRCPAODI",21,0)
 ; Verify user has primary and/or secondary manager key
"RTN","PRCPAODI",22,0)
 S PRCPMAN(1)=0,PRCPMAN(2)=0
"RTN","PRCPAODI",23,0)
 S PRCPMAN(1)=$$KEY^PRCPUREP("PRCP MGRKEY",PRCPMAN)
"RTN","PRCPAODI",24,0)
 S PRCPMAN(2)=$$KEY^PRCPUREP("PRCP2 MGRKEY",PRCPMAN)
"RTN","PRCPAODI",25,0)
 I 'PRCPMAN(1),'PRCPMAN(2),'$O(^PRCP(445,"AJ",PRCPMAN,"")) D EN^DDIOL(">>User must be a manager of a Primary or Secondary Inventory Point") W ! D EXIT G USER
"RTN","PRCPAODI",26,0)
 ;
"RTN","PRCPAODI",27,0)
 ; Display ODI access to primary points
"RTN","PRCPAODI",28,0)
 S PRCPNAME=$$GET1^DIQ(200,PRCPMAN_",",".01")
"RTN","PRCPAODI",29,0)
 W ! D CHKPM
"RTN","PRCPAODI",30,0)
 ;
"RTN","PRCPAODI",31,0)
 ; Prompt for Site
"RTN","PRCPAODI",32,0)
 S %=0 F I="FY","PARAM","PER","QTR","SITE" S %=1 Q
"RTN","PRCPAODI",33,0)
 I % S PRCF("X")="S" D ^PRCFSITE I '$G(PRC("SITE")) K PRC,PRCP G EXIT
"RTN","PRCPAODI",34,0)
 ;
"RTN","PRCPAODI",35,0)
 ; Prompt for inventory point
"RTN","PRCPAODI",36,0)
IP S DIC="^PRCP(445,",DIC(0)="AEQMOZ"
"RTN","PRCPAODI",37,0)
 S DIC("S")="I +^(0)=PRC(""SITE"")"
"RTN","PRCPAODI",38,0)
 S DIC("A")="SELECT INVENTORY POINT: "
"RTN","PRCPAODI",39,0)
 S D="C",PRCPPRIV=1
"RTN","PRCPAODI",40,0)
 D IX^DIC K PRCPPRIV,D,DIC
"RTN","PRCPAODI",41,0)
 I Y<0  G EXIT
"RTN","PRCPAODI",42,0)
 S PRCP("I")=Y Q:'$G(PRCP("I"))
"RTN","PRCPAODI",43,0)
 S PRCPINPT=$P(PRCP("I"),"^",2)
"RTN","PRCPAODI",44,0)
 S PRCP("DPTYPE")=$P(^PRCP(445,+PRCP("I"),0),U,3)
"RTN","PRCPAODI",45,0)
 I PRCP("DPTYPE")="W" D EN^DDIOL("  >>The warehouse has no On-Demand items - needs no On-Demand User.") W ! G IP
"RTN","PRCPAODI",46,0)
 ;
"RTN","PRCPAODI",47,0)
 D INIT(+PRCP("I"))
"RTN","PRCPAODI",48,0)
 ;
"RTN","PRCPAODI",49,0)
 ;Process Users that don't qualify
"RTN","PRCPAODI",50,0)
 I 'PRCPMAN(3) D  D:PRCP("DPTYPE")="P" CHKDP G IP
"RTN","PRCPAODI",51,0)
 . D EN^DDIOL(">>"_PRCPNAME_" is not a "_PRCPMAN(3)_" of this inventory point")
"RTN","PRCPAODI",52,0)
 . ; if user is not in node 9, give message - not added
"RTN","PRCPAODI",53,0)
 . I 'PRCPIN D EN^DDIOL("  and therefore cannot be an On-Demand User") W !
"RTN","PRCPAODI",54,0)
 . ; delete if user is set up in node 9 - show 'deleted'
"RTN","PRCPAODI",55,0)
 . I PRCPIN D  Q
"RTN","PRCPAODI",56,0)
 . . D DEL(+PRCP("I"),PRCPIN) ; Delete entry
"RTN","PRCPAODI",57,0)
 . . D EN^DDIOL(">>Removed as On-Demand User for: "_PRCPINPT) W !
"RTN","PRCPAODI",58,0)
 ;
"RTN","PRCPAODI",59,0)
 ; If user is already On-Demand, ask if they should be removed???
"RTN","PRCPAODI",60,0)
 I PRCPIN D  G IP
"RTN","PRCPAODI",61,0)
 . D ASK(2,+PRCP("I"),PRCPMAN)
"RTN","PRCPAODI",62,0)
 . I PRCP("DPTYPE")="P" D CHKDP
"RTN","PRCPAODI",63,0)
 ;
"RTN","PRCPAODI",64,0)
 ; Ask if user should be added to IP's list of On-Demand users
"RTN","PRCPAODI",65,0)
 D ASK(1,+PRCP("I"),PRCPMAN)
"RTN","PRCPAODI",66,0)
 I PRCP("DPTYPE")="P" D CHKDP
"RTN","PRCPAODI",67,0)
 G IP
"RTN","PRCPAODI",68,0)
 ;
"RTN","PRCPAODI",69,0)
 Q
"RTN","PRCPAODI",70,0)
 ;
"RTN","PRCPAODI",71,0)
 ; Does user qualify?
"RTN","PRCPAODI",72,0)
INIT(PRCPINP) ;PRCPINP=inventory point being checked
"RTN","PRCPAODI",73,0)
 S PRCPMAN(3)=1 ; assume user is OK
"RTN","PRCPAODI",74,0)
 ; Verify user has manager key for type of IP selected
"RTN","PRCPAODI",75,0)
 I PRCP("DPTYPE")="P",'PRCPMAN(1) S PRCPMAN(3)="manager"
"RTN","PRCPAODI",76,0)
 I PRCP("DPTYPE")="S",'PRCPMAN(2) S PRCPMAN(3)="manager"
"RTN","PRCPAODI",77,0)
 ; Verify user is a user of that IP
"RTN","PRCPAODI",78,0)
 I '$D(^PRCP(445,+PRCPINP,4,PRCPMAN)) D
"RTN","PRCPAODI",79,0)
 . I PRCPMAN(3)=1 S PRCPMAN(3)="user" Q
"RTN","PRCPAODI",80,0)
 . S PRCPMAN(3)="manager nor user"
"RTN","PRCPAODI",81,0)
 ;
"RTN","PRCPAODI",82,0)
 ; set flag if user is already in list
"RTN","PRCPAODI",83,0)
 S PRCPIN=""
"RTN","PRCPAODI",84,0)
 S PRCPIN=$O(^PRCP(445,+PRCPINP,9,"B",PRCPMAN,PRCPIN))
"RTN","PRCPAODI",85,0)
 Q
"RTN","PRCPAODI",86,0)
 ;
"RTN","PRCPAODI",87,0)
DEL(PRCPINP,PRCPUSER) ; delete On-Demand authorization
"RTN","PRCPAODI",88,0)
 ; also called from PRCPXTRM for user termination from VISTA
"RTN","PRCPAODI",89,0)
 ;
"RTN","PRCPAODI",90,0)
 ; PRCPINP    inventory point from which user is being removed
"RTN","PRCPAODI",91,0)
 ; PRCPUSER   ien of user in the list
"RTN","PRCPAODI",92,0)
 ;
"RTN","PRCPAODI",93,0)
 N DA,DIK
"RTN","PRCPAODI",94,0)
 S DIK="^PRCP(445,"_PRCPINP_",9,",DA(1)=+PRCPINP,DA=+PRCPUSER D ^DIK
"RTN","PRCPAODI",95,0)
 Q
"RTN","PRCPAODI",96,0)
 ;
"RTN","PRCPAODI",97,0)
ADD(PRCPINP,PRCPUSER) ; Add user to On-Demand Users
"RTN","PRCPAODI",98,0)
 ;
"RTN","PRCPAODI",99,0)
 ; PRCPINP
"RTN","PRCPAODI",100,0)
 ; PRCPUSER
"RTN","PRCPAODI",101,0)
 ;
"RTN","PRCPAODI",102,0)
 ; save user in On-Demand Users list
"RTN","PRCPAODI",103,0)
 N PRCPIEN,PRCPARRY,PRCPREC
"RTN","PRCPAODI",104,0)
 S PRCPREC(1)=+PRCPMAN ; dinumed file
"RTN","PRCPAODI",105,0)
 S PRCPIEN="+1,"_+PRCPINP_","
"RTN","PRCPAODI",106,0)
 S PRCPARRY(445.027,PRCPIEN,.01)=+PRCPMAN
"RTN","PRCPAODI",107,0)
 D UPDATE^DIE("","PRCPARRY","PRCPREC")
"RTN","PRCPAODI",108,0)
 Q
"RTN","PRCPAODI",109,0)
 ;
"RTN","PRCPAODI",110,0)
 ; Find all distribution points
"RTN","PRCPAODI",111,0)
CHKDP N PRCPIN,PRCPIP,PRCPDA,PRCPDX,PRCPNM,FLAG,X
"RTN","PRCPAODI",112,0)
 D EN^DDIOL("Checking distribution points for "_PRCPINPT_"...") W !
"RTN","PRCPAODI",113,0)
 S PRCPIP=0,FLAG=1
"RTN","PRCPAODI",114,0)
 S PRCP("DPTYPE")="S"
"RTN","PRCPAODI",115,0)
 F  S PRCPIP=$O(^PRCP(445,+PRCP("I"),2,PRCPIP)) Q:'+PRCPIP  D
"RTN","PRCPAODI",116,0)
 . S PRCPNM=$$INVNAME^PRCPUX1(PRCPIP),X=$P(PRCPNM,"-",2,99)
"RTN","PRCPAODI",117,0)
 . I $E(X,1,12)="***INACTIVE_" Q  ; IP not active
"RTN","PRCPAODI",118,0)
 . I $P($G(^PRCP(445,PRCPIP,0)),"^",3)'="S" Q
"RTN","PRCPAODI",119,0)
 . S FLAG=0 D INIT(PRCPIP)
"RTN","PRCPAODI",120,0)
 . I 'PRCPMAN(3) D  Q
"RTN","PRCPAODI",121,0)
 . . I PRCPIN S PRCPDX(PRCPIP)=1_"^"_PRCPNM_"^"_PRCPIN Q
"RTN","PRCPAODI",122,0)
 . S PRCPDA(PRCPIP)=1_"^"_PRCPNM_"^"_PRCPIN
"RTN","PRCPAODI",123,0)
 ;
"RTN","PRCPAODI",124,0)
 I FLAG=1 D EN^DDIOL("There are no distribution points on this primary") W ! Q
"RTN","PRCPAODI",125,0)
 ;
"RTN","PRCPAODI",126,0)
 ; check for IPs where the user is On-Demand
"RTN","PRCPAODI",127,0)
 I $O(PRCPDA("")) D
"RTN","PRCPAODI",128,0)
 . N PRCPD,X S PRCPD=""
"RTN","PRCPAODI",129,0)
 . D EN^DDIOL(PRCPNAME_" is a User and Manager on the following Inventory Points:") W !
"RTN","PRCPAODI",130,0)
 . F  S PRCPD=$O(PRCPDA(PRCPD)) Q:'PRCPD  D
"RTN","PRCPAODI",131,0)
 . . S X=$P(PRCPDA(PRCPD),"^",2)
"RTN","PRCPAODI",132,0)
 . . S X=X_$E("                                   ",$L(X),35)
"RTN","PRCPAODI",133,0)
 . . S X=X_$S($P(PRCPDA(PRCPD),"^",3):"On-Demand User",1:"Not On-Demand User")
"RTN","PRCPAODI",134,0)
 . . D EN^DDIOL(X)
"RTN","PRCPAODI",135,0)
 . W !
"RTN","PRCPAODI",136,0)
 ;
"RTN","PRCPAODI",137,0)
 I $O(PRCPDX("")) D REMOVE(.PRCPDX)
"RTN","PRCPAODI",138,0)
 ;
"RTN","PRCPAODI",139,0)
 I '$O(PRCPDA("")),'$O(PRCPDX("")) D  W !
"RTN","PRCPAODI",140,0)
 . I PRCPMAN(2)'=1 D EN^DDIOL(PRCPNAME_" is not a manager of any distribution point") Q
"RTN","PRCPAODI",141,0)
 . D EN^DDIOL(PRCPNAME_" is not a user of the distribution points found")
"RTN","PRCPAODI",142,0)
 ;
"RTN","PRCPAODI",143,0)
ASK(PRCPOPT,PRCPIPT,PRCPUSER) ; Should user's authorization be removed?
"RTN","PRCPAODI",144,0)
 ;
"RTN","PRCPAODI",145,0)
 ; PRCPOPT    1 if add , 2 if delete
"RTN","PRCPAODI",146,0)
 ; PRCPIPT    Inventory Point ien
"RTN","PRCPAODI",147,0)
 ; PRCPUSER   DUZ of User
"RTN","PRCPAODI",148,0)
 ;
"RTN","PRCPAODI",149,0)
 N CNT,DIR,DIRUT,DIROUT,DTOUT,DUOUT,I,X,PRCPDP
"RTN","PRCPAODI",150,0)
 S CNT=1,PRCPDP="",X=""
"RTN","PRCPAODI",151,0)
 S DIR(0)="Y"
"RTN","PRCPAODI",152,0)
 S DIR("A")="Add as an On-Demand User"
"RTN","PRCPAODI",153,0)
 I PRCPOPT=2 S DIR("A")="Remove as an On-Demand User"
"RTN","PRCPAODI",154,0)
 D ^DIR K DIR
"RTN","PRCPAODI",155,0)
 I Y=0!$D(DTOUT)!$D(DUOUT) S X="  <<not added>>" S:PRCPOPT=2 X="  <<not removed>>" D EN^DDIOL(X) W ! Q
"RTN","PRCPAODI",156,0)
 ; IF YES, LOOP THROUGH AND DELETE USER FROM ALL
"RTN","PRCPAODI",157,0)
 I Y=1 D
"RTN","PRCPAODI",158,0)
 . I PRCPOPT=2 D
"RTN","PRCPAODI",159,0)
 . . D DEL(PRCPIPT,PRCPIN)
"RTN","PRCPAODI",160,0)
 . . D EN^DDIOL("  <<Removed>>") W !
"RTN","PRCPAODI",161,0)
 . I PRCPOPT=1 D
"RTN","PRCPAODI",162,0)
 . . D ADD(PRCPIPT,PRCPUSER)
"RTN","PRCPAODI",163,0)
 . . I $D(^TMP("DIERR",$J)) D EN^DDIOL("  <<Unable to Add - possible system problems>>") W ! Q
"RTN","PRCPAODI",164,0)
 . . D EN^DDIOL("  <<Added>>") W !
"RTN","PRCPAODI",165,0)
 Q
"RTN","PRCPAODI",166,0)
 ;
"RTN","PRCPAODI",167,0)
REMOVE(PRCPDX) ; Auto remove ODI authorization
"RTN","PRCPAODI",168,0)
 I $O(PRCPDX("")) D
"RTN","PRCPAODI",169,0)
 . N PRCPD,X S PRCPD=""
"RTN","PRCPAODI",170,0)
 . D EN^DDIOL("On-Demand Access was removed from the following:") W !
"RTN","PRCPAODI",171,0)
 . F  S PRCPD=$O(PRCPDX(PRCPD)) Q:'PRCPD  D
"RTN","PRCPAODI",172,0)
 . . D DEL(PRCPD,$P(PRCPDX(PRCPD),"^",3))
"RTN","PRCPAODI",173,0)
 . . S X=$P(PRCPDX(PRCPD),"^",2) D EN^DDIOL(X)
"RTN","PRCPAODI",174,0)
 . W !
"RTN","PRCPAODI",175,0)
 Q
"RTN","PRCPAODI",176,0)
 ;
"RTN","PRCPAODI",177,0)
CHKPM ; DISPLAY IPs User can access
"RTN","PRCPAODI",178,0)
 N PRCPIN,PRCPIP,FLAG,PRCPDX,PRCPNM
"RTN","PRCPAODI",179,0)
 S PRCPIP="",FLAG="",PRCP("DPTYPE")="P"
"RTN","PRCPAODI",180,0)
 F  S PRCPIP=$O(^PRCP(445,"AC","P",PRCPIP)) Q:'PRCPIP  D
"RTN","PRCPAODI",181,0)
 . I '$O(^PRCP(445,PRCPIP,9,"B",PRCPMAN,"")) Q
"RTN","PRCPAODI",182,0)
 . D INIT(PRCPIP)
"RTN","PRCPAODI",183,0)
 . S PRCPNM=$$INVNAME^PRCPUX1(PRCPIP),X=$P(PRCPNM,"-",2,99)
"RTN","PRCPAODI",184,0)
 . I $E(X,1,12)="***INACTIVE_" Q  ; IP not active
"RTN","PRCPAODI",185,0)
 . I 'PRCPMAN(3) D  Q
"RTN","PRCPAODI",186,0)
 . . I PRCPIN S PRCPDX(PRCPIP)=1_"^"_PRCPNM_"^"_PRCPIN Q
"RTN","PRCPAODI",187,0)
 . I 'FLAG S FLAG=1 D EN^DDIOL(PRCPNAME_" is an On-Demand User in these Primary Inventory Points:")
"RTN","PRCPAODI",188,0)
 . D EN^DDIOL(PRCPNM)
"RTN","PRCPAODI",189,0)
 I $O(PRCPDX("")) W ! D REMOVE(.PRCPDX)
"RTN","PRCPAODI",190,0)
 I 'FLAG D EN^DDIOL(">>"_PRCPNAME_" is not an On-Demand User in any Primary Inventory Point")
"RTN","PRCPAODI",191,0)
 W !
"RTN","PRCPAODI",192,0)
 Q
"RTN","PRCPAODI",193,0)
 ;
"RTN","PRCPAODI",194,0)
EXIT L -^PRCPAODI(PRCPMAN)
"RTN","PRCPAODI",195,0)
 Q
"RTN","PRCPEIL0")
0^8^B24762317^B22084013
"RTN","PRCPEIL0",1,0)
PRCPEIL0 ;WISC/RFJ-edit inventory items (build arrays)              ; 9/20/06 11:02am
"RTN","PRCPEIL0",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPEIL0",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPEIL0",4,0)
 Q
"RTN","PRCPEIL0",5,0)
 ;
"RTN","PRCPEIL0",6,0)
 ;
"RTN","PRCPEIL0",7,0)
ISSUNITS ;  build issue units array
"RTN","PRCPEIL0",8,0)
 S LINE=9,COLUMN=1,CLREND=39
"RTN","PRCPEIL0",9,0)
 D SET("Issue Units   ",LINE,COLUMN,CLREND,0,IORVON,IORVOFF)
"RTN","PRCPEIL0",10,0)
 D SET("Unit per Issue: "_$$UNIT^PRCPUX1(PRCPINPT,ITEMDA," per "),LINE+1,COLUMN,CLREND)
"RTN","PRCPEIL0",11,0)
 I PRCPTYPE="P" D SET("Issue Multiple",LINE+2,COLUMN,CLREND,16)
"RTN","PRCPEIL0",12,0)
 I PRCPTYPE="P" D SET("Min Issue Qty ",LINE+3,COLUMN,CLREND,16.5)
"RTN","PRCPEIL0",13,0)
 Q
"RTN","PRCPEIL0",14,0)
 ;
"RTN","PRCPEIL0",15,0)
 ;
"RTN","PRCPEIL0",16,0)
COSTS ;  build costs array
"RTN","PRCPEIL0",17,0)
 S LINE=16,COLUMN=40,CLREND=80
"RTN","PRCPEIL0",18,0)
 D SET("Costing Data",LINE+0,COLUMN,CLREND,0,IORVON,IORVOFF)
"RTN","PRCPEIL0",19,0)
 D SET("Last Cost   ",LINE+1,COLUMN,CLREND,4.7)
"RTN","PRCPEIL0",20,0)
 D SET("Average Cost",LINE+2,COLUMN,CLREND,4.8)
"RTN","PRCPEIL0",21,0)
 D SET("Total Value ",LINE+3,COLUMN,CLREND,4.81)
"RTN","PRCPEIL0",22,0)
 Q
"RTN","PRCPEIL0",23,0)
 ;
"RTN","PRCPEIL0",24,0)
 ;
"RTN","PRCPEIL0",25,0)
LEVELS ;  build levels array
"RTN","PRCPEIL0",26,0)
 S LINE=9,COLUMN=40,CLREND=80
"RTN","PRCPEIL0",27,0)
 D SET("Levels          ",LINE+0,COLUMN,CLREND,0,IORVON,IORVOFF)
"RTN","PRCPEIL0",28,0)
 D SET("Norm Stock Level",LINE+1,COLUMN,CLREND,9)
"RTN","PRCPEIL0",29,0)
 D SET("Emer Stock Level",LINE+2,COLUMN,CLREND,11)
"RTN","PRCPEIL0",30,0)
 D SET("Temp Stock Level",LINE+3,COLUMN,CLREND,9.5)
"RTN","PRCPEIL0",31,0)
 D SET("Delete Temp SL  ",LINE+4,COLUMN,CLREND,9.6)
"RTN","PRCPEIL0",32,0)
 D SET("Stand Reord Pt  ",LINE+5,COLUMN,CLREND,10)
"RTN","PRCPEIL0",33,0)
 D SET("Option Reord Pt ",LINE+6,COLUMN,CLREND,10.3)
"RTN","PRCPEIL0",34,0)
 Q
"RTN","PRCPEIL0",35,0)
 ;
"RTN","PRCPEIL0",36,0)
 ;
"RTN","PRCPEIL0",37,0)
QUANTITY ;  build quantities array
"RTN","PRCPEIL0",38,0)
 S LINE=16,COLUMN=1,CLREND=39
"RTN","PRCPEIL0",39,0)
 D SET("Quantities  ",LINE+0,COLUMN,CLREND,0,IORVON,IORVOFF)
"RTN","PRCPEIL0",40,0)
 D SET("On-hand     ",LINE+1,COLUMN,CLREND,7)
"RTN","PRCPEIL0",41,0)
 D SET("Due-In      ",LINE+2,COLUMN,CLREND,8.1)
"RTN","PRCPEIL0",42,0)
 D SET("Due-Out     ",LINE+3,COLUMN,CLREND,8.6)
"RTN","PRCPEIL0",43,0)
 D SET($S(PRCPTYPE="W":"Non-Issuable",1:""),LINE+4,COLUMN,CLREND,$S(PRCPTYPE="W":7.5,1:0))
"RTN","PRCPEIL0",44,0)
 D SET("",LINE+5,COLUMN,80)
"RTN","PRCPEIL0",45,0)
 Q
"RTN","PRCPEIL0",46,0)
 ;
"RTN","PRCPEIL0",47,0)
 ;
"RTN","PRCPEIL0",48,0)
OUTSTRAN ;  build outstanding transaction array
"RTN","PRCPEIL0",49,0)
 N D,PRCPDA
"RTN","PRCPEIL0",50,0)
 S LINE=22,COLUMN=1,CLREND=80
"RTN","PRCPEIL0",51,0)
 D SET("Due-Ins/Outstanding Transactions",LINE+0,COLUMN,CLREND,0,IORVON,IORVOFF)
"RTN","PRCPEIL0",52,0)
 S PRCPDA=0 F LINE=23:1:29 S PRCPDA=$O(^PRCP(445,PRCPINPT,1,ITEMDA,7,PRCPDA)) Q:'PRCPDA  S X=$G(^(+PRCPDA,0)) D
"RTN","PRCPEIL0",53,0)
 .   I X="" D SET("",LINE,COLUMN,CLREND) Q
"RTN","PRCPEIL0",54,0)
 .   S D=$E($P($G(^PRCS(410,+$P(X,"^"),0)),"^")_$J("",34),1,34)_"  Qty: "_$E($P(X,"^",2)_$J("",8),1,8)_"  U/R: "_$E($$UNITVAL^PRCPUX1($P(X,"^",4),$P(X,"^",3),"/")_$J("",10),1,10)_"  CF: "_$P(X,"^",5)
"RTN","PRCPEIL0",55,0)
 .   D SET(D,LINE,COLUMN,CLREND)
"RTN","PRCPEIL0",56,0)
 F LINE=LINE:1:29 D SET("",LINE,COLUMN,CLREND)
"RTN","PRCPEIL0",57,0)
 S PRCPDA=$O(^PRCP(445,PRCPINPT,1,ITEMDA,7,PRCPDA))
"RTN","PRCPEIL0",58,0)
 D SET($S('PRCPDA:"",1:"  . . . more . . . (only first 7 displayed)"),LINE+1,COLUMN,CLREND)
"RTN","PRCPEIL0",59,0)
 Q
"RTN","PRCPEIL0",60,0)
 ;
"RTN","PRCPEIL0",61,0)
 ;
"RTN","PRCPEIL0",62,0)
SPECIAL ;  build special parameter array
"RTN","PRCPEIL0",63,0)
 ;  subroutine modified to add On-Demand Items (PRC*5.1*98)
"RTN","PRCPEIL0",64,0)
 N PRCPONN S PRCPONN=""
"RTN","PRCPEIL0",65,0)
 S LINE=31,COLUMN=1,CLREND=39
"RTN","PRCPEIL0",66,0)
 D SET("Special Parameters",LINE+0,COLUMN,CLREND,0,IORVON,IORVOFF)
"RTN","PRCPEIL0",67,0)
 D SET("Kill When Zero    ",LINE+1,COLUMN,CLREND,17)
"RTN","PRCPEIL0",68,0)
 D SET("",LINE+2,COLUMN,CLREND)
"RTN","PRCPEIL0",69,0)
 S X=""
"RTN","PRCPEIL0",70,0)
 I PRCPTYPE="W" S X="",%=0 F  S %=$O(^PRCP(445,PRCPINPT,1,ITEMDA,4,%)) Q:'%  S X=X_$S(X="":"",1:", ")_%
"RTN","PRCPEIL0",71,0)
 I PRCPTYPE'="W" D
"RTN","PRCPEIL0",72,0)
 . N X
"RTN","PRCPEIL0",73,0)
 . S X=$$GET1^DIQ(445.01,ITEMDA_","_PRCPINPT_",",.8,"E")
"RTN","PRCPEIL0",74,0)
 . I X']"" S X="NO"
"RTN","PRCPEIL0",75,0)
 . S PRCPONN="On-Demand         : "
"RTN","PRCPEIL0",76,0)
 . I '$O(^PRCP(445,PRCPINPT,9,"B",DUZ,"")) S PRCPONN="(On-Demand)       : "
"RTN","PRCPEIL0",77,0)
 . S PRCPONN=PRCPONN_X
"RTN","PRCPEIL0",78,0)
 D SET($S(PRCPTYPE="W":"Substitute Items: "_X,1:PRCPONN),LINE+3,COLUMN,CLREND)
"RTN","PRCPEIL0",79,0)
 D SET("",LINE+4,COLUMN,CLREND)
"RTN","PRCPEIL0",80,0)
 Q
"RTN","PRCPEIL0",81,0)
 ;
"RTN","PRCPEIL0",82,0)
 ;
"RTN","PRCPEIL0",83,0)
DRUGACCT ;  build drug accountability array
"RTN","PRCPEIL0",84,0)
 S LINE=31,COLUMN=40,CLREND=80
"RTN","PRCPEIL0",85,0)
 D SET("Drug Accountability      ",LINE+0,COLUMN,CLREND,0,IORVON,IORVOFF)
"RTN","PRCPEIL0",86,0)
 D SET("Dispensing Unit          ",LINE+1,COLUMN,CLREND,50)
"RTN","PRCPEIL0",87,0)
 D SET("Dispensing Unit Conv Fact",LINE+2,COLUMN,CLREND,51)
"RTN","PRCPEIL0",88,0)
 Q
"RTN","PRCPEIL0",89,0)
 ;
"RTN","PRCPEIL0",90,0)
 ;
"RTN","PRCPEIL0",91,0)
SOURCES ;  build sources array
"RTN","PRCPEIL0",92,0)
 N D,PRCPDA
"RTN","PRCPEIL0",93,0)
 S LINE=36,COLUMN=1,CLREND=80
"RTN","PRCPEIL0",94,0)
 D SET("Procurement Sources",LINE+0,COLUMN,CLREND,0,IORVON,IORVOFF)
"RTN","PRCPEIL0",95,0)
 D SET("Mandatory Source   ",LINE+0,37,CLREND,.4)
"RTN","PRCPEIL0",96,0)
 S PRCPDA=0 F LINE=37:1:44 S PRCPDA=$O(^PRCP(445,PRCPINPT,1,ITEMDA,5,PRCPDA)) Q:'PRCPDA  S X=$G(^(+PRCPDA,0)) D
"RTN","PRCPEIL0",97,0)
 .   I X="" D SET("",LINE,COLUMN,CLREND) Q
"RTN","PRCPEIL0",98,0)
 .   S D=$E($$VENNAME^PRCPUX1($P(X,"^"))_$J("",34),1,34)_"  U/R: "_$E($$UNITVAL^PRCPUX1($P(X,"^",3),$P(X,"^",2),"/")_$J("",10),1,10)_"  CF: "_$P(X,"^",4)
"RTN","PRCPEIL0",99,0)
 .   D SET(D,LINE,COLUMN,CLREND)
"RTN","PRCPEIL0",100,0)
 F LINE=LINE:1:44 D SET("",LINE,COLUMN,CLREND)
"RTN","PRCPEIL0",101,0)
 S PRCPDA=$O(^PRCP(445,PRCPINPT,1,ITEMDA,5,PRCPDA))
"RTN","PRCPEIL0",102,0)
 D SET($S('PRCPDA:"",1:"  . . . more . . . (only first 8 displayed)"),LINE+1,COLUMN,CLREND)
"RTN","PRCPEIL0",103,0)
 Q
"RTN","PRCPEIL0",104,0)
 ;
"RTN","PRCPEIL0",105,0)
 ;
"RTN","PRCPEIL0",106,0)
SET(STRING,LINE,COLUMN,CLREND,FIELD,ON,OFF) ;  set array
"RTN","PRCPEIL0",107,0)
 I $G(FIELD) S STRING=STRING_": "_$G(PRCPDATA(445.01,ITEMDA,FIELD,"E"))
"RTN","PRCPEIL0",108,0)
 I STRING="" D SET^VALM10(LINE,$J("",80)) Q
"RTN","PRCPEIL0",109,0)
 I '$D(@VALMAR@(LINE,0)) D SET^VALM10(LINE,$J("",80))
"RTN","PRCPEIL0",110,0)
 D SET^VALM10(LINE,$$SETSTR^VALM1(STRING,@VALMAR@(LINE,0),COLUMN,CLREND))
"RTN","PRCPEIL0",111,0)
 I $G(ON)]""!($G(OFF)]"") D CNTRL^VALM10(LINE,COLUMN,$L(STRING),ON,OFF)
"RTN","PRCPEIL0",112,0)
 Q
"RTN","PRCPEITE")
0^9^B31335514^B30316508
"RTN","PRCPEITE",1,0)
PRCPEITE ;WISC/RFJ-enter/edit inventory items                       ; 11/6/06 8:40am
"RTN","PRCPEITE",2,0)
V ;;5.1;IFCAP;**1,98**;Oct 20, 2000;Build 37
"RTN","PRCPEITE",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPEITE",4,0)
 Q
"RTN","PRCPEITE",5,0)
 ;
"RTN","PRCPEITE",6,0)
ALL(PRCPINPT,ITEMDA) ;  edit all fields option (for new items)
"RTN","PRCPEITE",7,0)
 I '$D(^PRCP(445,+PRCPINPT,1,+ITEMDA,0)) Q
"RTN","PRCPEITE",8,0)
 N %,%H,D,D0,D1,D2,DA,DES,DI,DIC,DIE,DLAYGO,DQ,DR,I
"RTN","PRCPEITE",9,0)
 N PRCPINDA,PRCPITEM,PRCPNL,PRCPQUIT,PRCPPRIV,PRCPTYPE,PRCPUI,PRCPUI1,X,Y
"RTN","PRCPEITE",10,0)
 D EN^DDIOL("----- Enter Item Descriptive Data -----")
"RTN","PRCPEITE",11,0)
 S DES=$P($G(^PRCP(445,PRCPINPT,1,ITEMDA,6)),"^")
"RTN","PRCPEITE",12,0)
 I DES="" S DES=$$DESDEF^PRCPEITF(PRCPINPT,ITEMDA) ; get item description default
"RTN","PRCPEITE",13,0)
 S PRCPQUIT=0
"RTN","PRCPEITE",14,0)
 D DESCRIP^PRCPEITF(PRCPINPT,ITEMDA,.PRCPQUIT)
"RTN","PRCPEITE",15,0)
 I PRCPQUIT Q
"RTN","PRCPEITE",16,0)
 S DR="[PRCP ITEM ALL FIELDS (NON-SS)]"
"RTN","PRCPEITE",17,0)
 I $P(^PRCP(445,PRCPINPT,0),"^",3)="S",$P($G(^PRCP(445,PRCPINPT,5)),"^",1)]"" S DR="[PRCP ITEM ALL FIELDS (SS)]" ; supply station monitors normal level value
"RTN","PRCPEITE",18,0)
 S DA=PRCPINPT
"RTN","PRCPEITE",19,0)
 S PRCPITEM=$C(96)_ITEMDA
"RTN","PRCPEITE",20,0)
 S (DIC,DIE)="^PRCP(445,"
"RTN","PRCPEITE",21,0)
 S DIE("NO^")="BACKOUTOK"
"RTN","PRCPEITE",22,0)
 S PRCPPRIV=1 D ^DIE
"RTN","PRCPEITE",23,0)
 Q
"RTN","PRCPEITE",24,0)
 ;
"RTN","PRCPEITE",25,0)
 ;
"RTN","PRCPEITE",26,0)
DESCRIP(PRCPINPT,ITEMDA) ;  edit description, category, location fields
"RTN","PRCPEITE",27,0)
 I '$D(^PRCP(445,+PRCPINPT,1,+ITEMDA,0)) Q
"RTN","PRCPEITE",28,0)
 N %,D,D0,DA,DES,DI,DIC,DIE,DISYS,DQ,DR,DZ,E,PRCPPRIM,PRCPPRIV,PRCPPRNM,PRCPQUIT,TYPE,X,XH,XP,Y
"RTN","PRCPEITE",29,0)
 S DES=$P($G(^PRCP(445,PRCPINPT,1,ITEMDA,6)),"^")
"RTN","PRCPEITE",30,0)
 I DES="" S DES=$$DESDEF^PRCPEITF(PRCPINPT,ITEMDA) ; get default value
"RTN","PRCPEITE",31,0)
 S PRCPQUIT=0
"RTN","PRCPEITE",32,0)
 D DESCRIP^PRCPEITF(PRCPINPT,ITEMDA,.PRCPQUIT)
"RTN","PRCPEITE",33,0)
 I PRCPQUIT Q
"RTN","PRCPEITE",34,0)
 S DA(1)=PRCPINPT,DA=ITEMDA,(DIC,DIE)="^PRCP(445,"_PRCPINPT_",1,"
"RTN","PRCPEITE",35,0)
 S DR=".5GROUP CATEGORY;5MAIN STORAGE LOCATION;6"
"RTN","PRCPEITE",36,0)
 S PRCPPRIV=1
"RTN","PRCPEITE",37,0)
 D ^DIE K PRCPPRIV
"RTN","PRCPEITE",38,0)
 Q
"RTN","PRCPEITE",39,0)
 ;
"RTN","PRCPEITE",40,0)
 ;
"RTN","PRCPEITE",41,0)
LEVELS(PRCPINPT,ITEMDA) ;  edit stock levels
"RTN","PRCPEITE",42,0)
 I '$D(^PRCP(445,+PRCPINPT,1,+ITEMDA,0)) Q
"RTN","PRCPEITE",43,0)
 N %,D,D0,DA,DI,DIC,DIE,DQ,DR,DZ,PRCPDR,PRCPPRIV,PRCPQUIT,UNIT,X,Y
"RTN","PRCPEITE",44,0)
 S UNIT=$$UNIT^PRCPUX1(PRCPINPT,ITEMDA," per ")
"RTN","PRCPEITE",45,0)
 S DR="9NORMAL STOCK LEVEL     ("_UNIT_")"
"RTN","PRCPEITE",46,0)
 S PRCPQUIT=0
"RTN","PRCPEITE",47,0)
 ;
"RTN","PRCPEITE",48,0)
 ; if the supply station secondary has unposted regular orders,
"RTN","PRCPEITE",49,0)
 ; restrict editing a non-zero normal level to zero.
"RTN","PRCPEITE",50,0)
 I $P(^PRCP(445,PRCPINPT,0),"^",3)="S",$P($G(^PRCP(445,PRCPINPT,5)),"^",1)]"" D
"RTN","PRCPEITE",51,0)
 . D EDNORM(PRCPINPT,ITEMDA,$E(DR,2,99),.PRCPQUIT)
"RTN","PRCPEITE",52,0)
 . S DR=""
"RTN","PRCPEITE",53,0)
 . I $D(DUOUT)!$D(DTOUT) Q
"RTN","PRCPEITE",54,0)
 I PRCPQUIT Q
"RTN","PRCPEITE",55,0)
 I DR]"" S DR=DR_";"
"RTN","PRCPEITE",56,0)
 S PRCPPRIV=1
"RTN","PRCPEITE",57,0)
 S DR=DR_"11EMERGENCY STOCK LEVEL  ("_UNIT_");9.5TEMPORARY STOCK LEVEL  ("_UNIT_");I 'X S Y=10;9.6;10STANDARD REORDER POINT ("_UNIT_");10.3OPTIONAL REORDER POINT ("_UNIT_");"
"RTN","PRCPEITE",58,0)
 S DA(1)=PRCPINPT,DA=ITEMDA,(DIC,DIE)="^PRCP(445,"_PRCPINPT_",1," D ^DIE
"RTN","PRCPEITE",59,0)
 Q
"RTN","PRCPEITE",60,0)
 ;
"RTN","PRCPEITE",61,0)
 ;
"RTN","PRCPEITE",62,0)
SPECIAL(PRCPINPT,ITEMDA) ;  special parameters and flags
"RTN","PRCPEITE",63,0)
 I '$D(^PRCP(445,+PRCPINPT,1,+ITEMDA,0)) Q
"RTN","PRCPEITE",64,0)
 N %,C,D,D0,D1,DA,DDH,DI,DIC,DIE,DISYS,DIZ,DLAYGO,DQ,DR,I,ISSUE,PRCPITEM,PRCPPRIV,PRCPSET,TYPE,X,Y
"RTN","PRCPEITE",65,0)
 S (DIC,DIE)="^PRCP(445,"_PRCPINPT_",1,",PRCPSET="I PRCPITEM'=X,$D(^PRCP(445,PRCPINPT,1,X,0))",DA(1)=PRCPINPT,(PRCPITEM,DA)=ITEMDA
"RTN","PRCPEITE",66,0)
 S TYPE=$P($G(^PRCP(445,PRCPINPT,0)),"^",3)
"RTN","PRCPEITE",67,0)
 ;  substitute item multiple
"RTN","PRCPEITE",68,0)
 I TYPE="W",'$D(^PRCP(445,PRCPINPT,1,ITEMDA,4,0)) S ^(0)="^445.122PI^^"
"RTN","PRCPEITE",69,0)
 I TYPE="P",$P(^PRCP(445,PRCPINPT,0),"^",10)="S" S ISSUE=1
"RTN","PRCPEITE",70,0)
 ;  removal of fields 14;14.3;14.4 if type = "P" (fields not used)
"RTN","PRCPEITE",71,0)
 S DR="17;"_$S($G(ISSUE):"14.5;",1:"")_$S(TYPE="W":"22;",1:"")
"RTN","PRCPEITE",72,0)
 S PRCPPRIV=1
"RTN","PRCPEITE",73,0)
 D ^DIE I $D(DTOUT)!$D(Y) Q
"RTN","PRCPEITE",74,0)
 K DIC,DIE,DA,DR
"RTN","PRCPEITE",75,0)
 I TYPE'="W" D ODI^PRCPEITG(PRCPINPT,ITEMDA) ; ask On-Demand (PRC*5.1*98)
"RTN","PRCPEITE",76,0)
 Q
"RTN","PRCPEITE",77,0)
 ;
"RTN","PRCPEITE",78,0)
 ;
"RTN","PRCPEITE",79,0)
DISPUNIT(PRCPINPT,ITEMDA) ;  drug accountability dispensing units
"RTN","PRCPEITE",80,0)
 N %,D,D0,DA,DD,DDH,DI,DIC,DIE,DISYS,DIX,DIY,DO,DQ,DR,DZ,X,Y
"RTN","PRCPEITE",81,0)
 S DA(1)=PRCPINPT,DA=ITEMDA,(DIC,DIE)="^PRCP(445,"_PRCPINPT_",1,",DR="50;51"
"RTN","PRCPEITE",82,0)
 S PRCPPRIV=1 D ^DIE K PRCPPRIV
"RTN","PRCPEITE",83,0)
 Q
"RTN","PRCPEITE",84,0)
 ;
"RTN","PRCPEITE",85,0)
 ;
"RTN","PRCPEITE",86,0)
EDNORM(PRCPINPT,ITEMDA,TEXT,PRCPQUIT) ; editing the normal level on supply station secondaries
"RTN","PRCPEITE",87,0)
 ; ITEMDA   = item number requiring the default description
"RTN","PRCPEITE",88,0)
 ; PRCPINPT = inventory point
"RTN","PRCPEITE",89,0)
 ; TEXT = text to display when prompting the user
"RTN","PRCPEITE",90,0)
 ; PRCPQUIT = flag to signify exit desired
"RTN","PRCPEITE",91,0)
 ;
"RTN","PRCPEITE",92,0)
 N DA,DIC,DIE,DIR,DR,ORD,PRCPNL,PRCPPRIV,VALUE
"RTN","PRCPEITE",93,0)
 ; because this is sometimes called from templates, new FileMan variables
"RTN","PRCPEITE",94,0)
 N D,D0,D1,D2,D3,D4,D5,D6,DB,DC,DD,DE,DG,DH,DI,DIA,DIADD,DICR,DIEC,DIEL
"RTN","PRCPEITE",95,0)
 N DIFLD,DIK,DIOV,DK,DL,DLAYGO,DM,DO,DOV,DP,DQ,DU,DV,DW,I,J,X,Y
"RTN","PRCPEITE",96,0)
 I $P(^PRCP(445,PRCPINPT,0),"^",3)'="S" QUIT
"RTN","PRCPEITE",97,0)
 I '$P($G(^PRCP(445,PRCPINPT,5)),"^",1) QUIT
"RTN","PRCPEITE",98,0)
 I '$D(^PRCP(445,PRCPINPT,1,ITEMDA,0)) QUIT
"RTN","PRCPEITE",99,0)
 S PRCPNL=+$P(^PRCP(445,PRCPINPT,1,ITEMDA,0),"^",9)
"RTN","PRCPEITE",100,0)
 S ORD=0
"RTN","PRCPEITE",101,0)
 S ORD=$$ORDCHK^PRCPUITM(ITEMDA,PRCPINPT,"R","")
"RTN","PRCPEITE",102,0)
 I ORD D  ; this field is also a flag of items on supply station, editing must be restricted if there are outstanding supply station orders.
"RTN","PRCPEITE",103,0)
 . N DIR
"RTN","PRCPEITE",104,0)
 . S DIR("A")=TEXT
"RTN","PRCPEITE",105,0)
 . S DIR("A",1)="There are outstanding regular orders for this item."
"RTN","PRCPEITE",106,0)
 . S DIR("A",2)="You cannot delete the normal level or make it 0"
"RTN","PRCPEITE",107,0)
 . S DIR(0)="N^1:999999"
"RTN","PRCPEITE",108,0)
 . S DIR("B")=PRCPNL
"RTN","PRCPEITE",109,0)
 . D ^DIR K DIR
"RTN","PRCPEITE",110,0)
 . I $D(DUOUT)!$D(DTOUT) S PRCPQUIT=1 Q
"RTN","PRCPEITE",111,0)
 . I X S PRCPNL=X D
"RTN","PRCPEITE",112,0)
 . . S DA(1)=PRCPINPT,DA=ITEMDA,PRCPPRIV=1
"RTN","PRCPEITE",113,0)
 . . S (DIC,DIE)="^PRCP(445,"_PRCPINPT_",1,"
"RTN","PRCPEITE",114,0)
 . . S DR="9///^S X=PRCPNL"
"RTN","PRCPEITE",115,0)
 . . D ^DIE
"RTN","PRCPEITE",116,0)
 . . K DIC,DIE
"RTN","PRCPEITE",117,0)
 I 'ORD D
"RTN","PRCPEITE",118,0)
 . I PRCPNL'>0 W !!,"Changing the level from zero will add the item to the supply station."
"RTN","PRCPEITE",119,0)
 . I PRCPNL>0 W !!,"Changing the level to zero will delete the item from the supply station."
"RTN","PRCPEITE",120,0)
 . I $D(DUOUT)!$D(DTOUT) S PRCPQUIT=1 Q
"RTN","PRCPEITE",121,0)
 . S DIR(0)="445.01,9^^",DA(1)=PRCPINPT,DA=ITEMDA
"RTN","PRCPEITE",122,0)
 . D ^DIR K DIR
"RTN","PRCPEITE",123,0)
 . S VALUE=Y
"RTN","PRCPEITE",124,0)
 . I $D(DTOUT)!$D(DUOUT) S PRCPQUIT=1 Q
"RTN","PRCPEITE",125,0)
 . S DR="9///^S X=VALUE"
"RTN","PRCPEITE",126,0)
 . S DA=ITEMDA,DA(1)=PRCPINPT,PRCPPRIV=1
"RTN","PRCPEITE",127,0)
 . S (DIC,DIE)="^PRCP(445,"_PRCPINPT_",1,"
"RTN","PRCPEITE",128,0)
 . D ^DIE
"RTN","PRCPEITE",129,0)
 . K DIC,DIE
"RTN","PRCPEITE",130,0)
 . I PRCPNL,'$P(^PRCP(445,PRCPINPT,1,ITEMDA,0),"^",9) D BLDSEG^PRCPHLFM(2,ITEMDA,PRCPINPT)
"RTN","PRCPEITE",131,0)
 . I 'PRCPNL,$P(^PRCP(445,PRCPINPT,1,ITEMDA,0),"^",9) D BLDSEG^PRCPHLFM(1,ITEMDA,PRCPINPT)
"RTN","PRCPEITE",132,0)
 QUIT
"RTN","PRCPEITG")
0^10^B7383274^n/a
"RTN","PRCPEITG",1,0)
PRCPEITG ;WOIFO/CC-enter/edit inventory items (On-Demand) ; 11/6/06 9:56am
"RTN","PRCPEITG",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPEITG",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPEITG",4,0)
 Q
"RTN","PRCPEITG",5,0)
 ;
"RTN","PRCPEITG",6,0)
 ;
"RTN","PRCPEITG",7,0)
ODI(PRCPINPT,PRCPITEM) ; ask On-Demand and reason if appropriate, save data
"RTN","PRCPEITG",8,0)
 ;
"RTN","PRCPEITG",9,0)
 ; PRCPINPT   inventory point ien
"RTN","PRCPEITG",10,0)
 ; PRCPITEM   ien of the selected item
"RTN","PRCPEITG",11,0)
 ;
"RTN","PRCPEITG",12,0)
 N DIR,DIRUT,DIROUT,DTOUT,DUOUT,PRCPARRY,PRCPEDIT,PRCPIEN,PRCPONN,PRCPONO,PRCPREAS,Y
"RTN","PRCPEITG",13,0)
 S PRCPONO=$P(^PRCP(445,+PRCPINPT,1,+PRCPITEM,0),"^",30) ; O-D Flag
"RTN","PRCPEITG",14,0)
 I PRCPONO'="Y" S PRCPONO="N" ; if no value is defined, O-D Flag is No
"RTN","PRCPEITG",15,0)
 ; Can user edit this On-Demand setting?
"RTN","PRCPEITG",16,0)
 S PRCPEDIT=0
"RTN","PRCPEITG",17,0)
 I $D(^PRCP(445,+PRCPINPT,9,"B",DUZ)) S PRCPEDIT=1 ; authorized user
"RTN","PRCPEITG",18,0)
 ;
"RTN","PRCPEITG",19,0)
 ; Display On-Demand value. If user is not authorized,
"RTN","PRCPEITG",20,0)
 ; display << not editable >> , pause and exit
"RTN","PRCPEITG",21,0)
 I 'PRCPEDIT D EN^DDIOL("ON-DEMAND: "_$S(PRCPONO="N":"NO",1:"YES")_"//   <<may not edit>>") D R^PRCPUREP Q
"RTN","PRCPEITG",22,0)
 ; if user can edit value, proceed with prompting
"RTN","PRCPEITG",23,0)
YN S DIR(0)="Y",DIR("A")="ON-DEMAND",DIR("B")=PRCPONO
"RTN","PRCPEITG",24,0)
 S DIR("?",1)="Enter 'Y'es for low usage items qualifying to be On-Demand"
"RTN","PRCPEITG",25,0)
 S DIR("?")="      'N'o  for routinely used (standard) items"
"RTN","PRCPEITG",26,0)
 D ^DIR K DIR
"RTN","PRCPEITG",27,0)
 ; prompt user, default to value on file
"RTN","PRCPEITG",28,0)
 ; if user up-arrows or times out, exit
"RTN","PRCPEITG",29,0)
 I $D(DUOUT)!$D(DTOUT) G NOCHANGE
"RTN","PRCPEITG",30,0)
 I Y'=0,Y'=1 W "??" G YN
"RTN","PRCPEITG",31,0)
 I Y=1 S PRCPONN="Y"
"RTN","PRCPEITG",32,0)
 I Y=0 S PRCPONN="N"
"RTN","PRCPEITG",33,0)
 ; if new value agrees with current setting, exit
"RTN","PRCPEITG",34,0)
 I PRCPONN=PRCPONO Q  ; no additional processing required
"RTN","PRCPEITG",35,0)
 ;
"RTN","PRCPEITG",36,0)
 ; prompt user for reason
"RTN","PRCPEITG",37,0)
RS S DIR(0)="F^3:30",DIR("A")="REASON FOR CHANGE"
"RTN","PRCPEITG",38,0)
 S DIR("?")="Enter 3 - 30 characters with no embedded '^' and no leading spaces"
"RTN","PRCPEITG",39,0)
 ; if user enters '^', all spaces or just hits return, tell user setting will not be changed - no reason entered, prompt On-Demand again.
"RTN","PRCPEITG",40,0)
 D ^DIR K DIR
"RTN","PRCPEITG",41,0)
 I $D(DUOUT)!$D(DTOUT) G NOCHANGE
"RTN","PRCPEITG",42,0)
 F  Q:$E(Y,1)'=" "  S Y=$E(Y,2,$L(Y))
"RTN","PRCPEITG",43,0)
 I Y']"" W "??" G RS
"RTN","PRCPEITG",44,0)
 S PRCPREAS=Y
"RTN","PRCPEITG",45,0)
 ;
"RTN","PRCPEITG",46,0)
 ; save new setting, date/time, DUZ, reason in audit file
"RTN","PRCPEITG",47,0)
 S PRCPIEN="+1,"_+PRCPITEM_","_+PRCPINPT_","
"RTN","PRCPEITG",48,0)
 S PRCPARRY(445.13,PRCPIEN,.01)=$$NOW^XLFDT
"RTN","PRCPEITG",49,0)
 S PRCPARRY(445.13,PRCPIEN,1)=DUZ
"RTN","PRCPEITG",50,0)
 S PRCPARRY(445.13,PRCPIEN,2)=PRCPREAS
"RTN","PRCPEITG",51,0)
 S PRCPARRY(445.13,PRCPIEN,3)=PRCPONN
"RTN","PRCPEITG",52,0)
 D UPDATE^DIE("","PRCPARRY")
"RTN","PRCPEITG",53,0)
 I $D(^TMP("DIERR",$J)) W "NOTHING SAVED" ; likely system or space err
"RTN","PRCPEITG",54,0)
 ;
"RTN","PRCPEITG",55,0)
 ; Save new setting into field .8
"RTN","PRCPEITG",56,0)
 S PRCPIEN=+PRCPITEM_","_+PRCPINPT_","
"RTN","PRCPEITG",57,0)
 K PRCPARRY S PRCPARRY(445.01,PRCPIEN,.8)=PRCPONN
"RTN","PRCPEITG",58,0)
 D UPDATE^DIE("","PRCPARRY")
"RTN","PRCPEITG",59,0)
 I $D(^TMP("DIERR",$J)) W "NOTHING SAVED" ; likely system or space err
"RTN","PRCPEITG",60,0)
OD Q
"RTN","PRCPEITG",61,0)
 ;
"RTN","PRCPEITG",62,0)
NOCHANGE D EN^DDIOL("NO DATA UPDATED.  VALID RESPONSE AND/OR REASON NOT ENTERED.")
"RTN","PRCPEITG",63,0)
 D R^PRCPUREP
"RTN","PRCPEITG",64,0)
 Q
"RTN","PRCPLO")
0^40^B77921532^B62666305
"RTN","PRCPLO",1,0)
PRCPLO ;WOIFO/RLL/VAC/DAP-days of stock on hand report ; 2/26/07 1:53pm
"RTN","PRCPLO",2,0)
 ;;5.1;IFCAP;**83,98**;Oct 20, 2000;Build 37
"RTN","PRCPLO",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPLO",4,0)
 ; Note: This routine was copied from PRCPRSOH
"RTN","PRCPLO",5,0)
 ;*98 Code modification made to handle STD and ODI breakouts
"RTN","PRCPLO",6,0)
 ;
"RTN","PRCPLO",7,0)
 Q
"RTN","PRCPLO",8,0)
ENT ; Entry Point to run Program
"RTN","PRCPLO",9,0)
 L +^PRCP(446.7,"STATUS"):3 I $T=0 S PRCPMSG(1)="Error encountered when attempting to run CLO GIP Reports due to other CLRS extracts in progress, please try again later." D MAIL^PRCPLO3 Q
"RTN","PRCPLO",10,0)
 N TOSTDCNT,TOODICNT,TOALLCNT,TOTCNT,VALUES
"RTN","PRCPLO",11,0)
 D PRCPRINV  ; Run the logic from PRCPRSOH, get params
"RTN","PRCPLO",12,0)
 D BLDFIL  ; Build the output data
"RTN","PRCPLO",13,0)
 D GETVAL  ; Set the ^DIE Entries in 446.7
"RTN","PRCPLO",14,0)
 L -^PRCP(446.7,"STATUS")
"RTN","PRCPLO",15,0)
 ;
"RTN","PRCPLO",16,0)
 K ^TMP($J,"PRCPSOH") ;kill off tmp data
"RTN","PRCPLO",17,0)
 K ^TMP($J,"PRCPLO")  ;kill off tmp data
"RTN","PRCPLO",18,0)
 K ^TMP($J,"PRCPSOH2") ; kill off ODI tmp data
"RTN","PRCPLO",19,0)
 K ^TMP($J,"PRCPLO2") ;kill off ODI tmp data
"RTN","PRCPLO",20,0)
 Q
"RTN","PRCPLO",21,0)
 ;
"RTN","PRCPLO",22,0)
 ;
"RTN","PRCPLO",23,0)
PRCPRINV ; run INV Point
"RTN","PRCPLO",24,0)
 N CLRSFLAG
"RTN","PRCPLO",25,0)
 S CLRSFLAG="SOH"
"RTN","PRCPLO",26,0)
 D GETIPT^PRCPLO1
"RTN","PRCPLO",27,0)
 Q
"RTN","PRCPLO",28,0)
EN1 ; Added return from PRCPLO1
"RTN","PRCPLO",29,0)
 ; Q
"RTN","PRCPLO",30,0)
 N DATEEND,DATEENDD,DATESTRD,DATESTRT,DAYSLEFT,DIR,GROUPALL,PRCPDAYS,PRCPEND,PRCPSTRT,PRCPTYPE,TOTALDAY,X,X1,X2,Y,MNT,TODAY
"RTN","PRCPLO",31,0)
 N ODICNT,ODIDOL,ODIFLAG,ODIFLG,STDCNT,STDDOL
"RTN","PRCPLO",32,0)
 ;
"RTN","PRCPLO",33,0)
 ; *83 The following was edited to always enter the LAST DAY
"RTN","PRCPLO",34,0)
 ; of the previous month as the end date. End date for Oct 31, 2005
"RTN","PRCPLO",35,0)
 ; in FM 3051031, can also use 3051100 equivalent for date sort
"RTN","PRCPLO",36,0)
 ; this way, you do not have to handle months w/ 28, 29, 30 or 31 days
"RTN","PRCPLO",37,0)
 D NOW^%DTC S TODAY=X,Y=$E(X,1,3),MNT=$E(X,4,5)
"RTN","PRCPLO",38,0)
 S MNT=+(MNT)
"RTN","PRCPLO",39,0)
 S MNT=MNT-1
"RTN","PRCPLO",40,0)
 I MNT=0 S MNT=12,Y=Y-1
"RTN","PRCPLO",41,0)
 I $L(MNT)=1 S MNT=0_MNT
"RTN","PRCPLO",42,0)
 ;
"RTN","PRCPLO",43,0)
 ; *83 Added day logic to handle month/leap year, etc.
"RTN","PRCPLO",44,0)
 N DAYS,CKF
"RTN","PRCPLO",45,0)
 S DAYS=$P("31^28^31^30^31^30^31^31^30^31^30^31",U,+(MNT))
"RTN","PRCPLO",46,0)
 S DATEEND=Y_MNT_DAYS
"RTN","PRCPLO",47,0)
 I DAYS=28  D
"RTN","PRCPLO",48,0)
 . S CKF=(17+$E(DATEEND))_$E(DATEEND,2,3)
"RTN","PRCPLO",49,0)
 . S DAYS=$S(CKF#400=0:29,(CKF#4=0&(CKF#100'=0)):29,1:28)
"RTN","PRCPLO",50,0)
 . S DATEEND=Y_MNT_DAYS
"RTN","PRCPLO",51,0)
 . Q
"RTN","PRCPLO",52,0)
 ; S DATEEND=Y_MNT_"00"
"RTN","PRCPLO",53,0)
 ; *83 The following was edited to always enter a 90 day previous
"RTN","PRCPLO",54,0)
 ; to current date of report run (check param file, could change)
"RTN","PRCPLO",55,0)
 ; for the DATESTRT. Once DATEEND and DATESTRT are determined, we
"RTN","PRCPLO",56,0)
 ; can use the existing code to set the other variables
"RTN","PRCPLO",57,0)
 S X1=TODAY
"RTN","PRCPLO",58,0)
 ; *83 Report range supplied by site parameter and defaulted to 180
"RTN","PRCPLO",59,0)
 S X2=$$GET^XPAR("SYS","PRCPLO REPORT RANGE",1,"Q")
"RTN","PRCPLO",60,0)
 I X2="" S X2=180
"RTN","PRCPLO",61,0)
 S X2=(X2*-1)
"RTN","PRCPLO",62,0)
 D C^%DTC S DATESTRT=$E(X,1,5)_"01"
"RTN","PRCPLO",63,0)
 ; DATEEND and DATESTRT are set above, pass them to existing
"RTN","PRCPLO",64,0)
 ; logic below to set remaining variables
"RTN","PRCPLO",65,0)
 S X1=DATEEND,X2=DATESTRT D ^%DTC S TOTALDAY=X+1
"RTN","PRCPLO",66,0)
 S Y=DATEEND D DD^%DT S DATEENDD=Y,Y=DATESTRT D DD^%DT S DATESTRD=Y
"RTN","PRCPLO",67,0)
 ;
"RTN","PRCPLO",68,0)
 ;*83 Set PRCPTYPE=2 (always GREATER)
"RTN","PRCPLO",69,0)
 S PRCPTYPE=2
"RTN","PRCPLO",70,0)
 ;
"RTN","PRCPLO",71,0)
 ;*83 PRCPDAYS is set based on value of CLRS GREATER THAN RANGE parameter
"RTN","PRCPLO",72,0)
 ;if no value is presented in the parameter, it will default to 90
"RTN","PRCPLO",73,0)
 ;
"RTN","PRCPLO",74,0)
 S PRCPDAYS=$$GET^XPAR("SYS","PRCPLO GREATER THAN RANGE",1,"Q")
"RTN","PRCPLO",75,0)
 I PRCPDAYS="" S PRCPDAYS=90
"RTN","PRCPLO",76,0)
 ;
"RTN","PRCPLO",77,0)
 ;*83 Return PRCPSTRT="" and PRCPEND=""
"RTN","PRCPLO",78,0)
 I PRCP("DPTYPE")="W" D
"RTN","PRCPLO",79,0)
 . S PRCPSTRT="",PRCPEND=""
"RTN","PRCPLO",80,0)
 ;
"RTN","PRCPLO",81,0)
 ;*83 RETURN GROUPALL=1 to select all groups
"RTN","PRCPLO",82,0)
 I PRCP("DPTYPE")'="W" D
"RTN","PRCPLO",83,0)
 .   S GROUPALL=1
"RTN","PRCPLO",84,0)
 . ; finished adding variables
"RTN","PRCPLO",85,0)
 ;
"RTN","PRCPLO",86,0)
DQ ;  queue starts here
"RTN","PRCPLO",87,0)
 N AVERAGE,DATE,GROUP,GROUPNM,ITEMDA,ITEMDATA,NSN,ONHAND,TOTAL,X,Y
"RTN","PRCPLO",88,0)
 K ^TMP($J,"PRCPRSOH")
"RTN","PRCPLO",89,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S ITEMDATA=$G(^(ITEMDA,0)) I ITEMDATA'="" D
"RTN","PRCPLO",90,0)
 .   S ODIFLG=1  S ODIFLAG=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPLO",91,0)
 .   I ODIFLAG="Y" S ODIFLG=2
"RTN","PRCPLO",92,0)
 .   S TOTCNT(PRCP("I"),ODIFLG)=+$G(TOTCNT(PRCP("I"),ODIFLG))+1
"RTN","PRCPLO",93,0)
 .   I $$REUSABLE^PRCPU441(ITEMDA) Q
"RTN","PRCPLO",94,0)
 .   ;  calculate total usage between dates
"RTN","PRCPLO",95,0)
 .   S DATE=$E(DATESTRT,1,5)-.01,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE!(DATE>$E(DATEEND,1,5))  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPLO",96,0)
 .   S AVERAGE=$J(TOTAL/TOTALDAY,0,2),ONHAND=$P(ITEMDATA,"^",7)+$P(ITEMDATA,"^",19)
"RTN","PRCPLO",97,0)
 .   S DAYSLEFT=$S('AVERAGE&(ONHAND):9999999,'AVERAGE:0,1:ONHAND/AVERAGE\1)
"RTN","PRCPLO",98,0)
 .   I PRCPTYPE=1,DAYSLEFT'<PRCPDAYS Q
"RTN","PRCPLO",99,0)
 .   I PRCPTYPE=2,DAYSLEFT'>PRCPDAYS Q
"RTN","PRCPLO",100,0)
 .   ;  sort for whse
"RTN","PRCPLO",101,0)
 .   I PRCP("DPTYPE")="W" D  Q
"RTN","PRCPLO",102,0)
 .   .   S NSN=$$NSN^PRCPUX1(ITEMDA) S:NSN="" NSN=" "
"RTN","PRCPLO",103,0)
 .   .   I $E(NSN,1,$L(PRCPSTRT))'=PRCPSTRT,$E(NSN,1,$L(PRCPEND))'=PRCPEND I NSN']PRCPSTRT!(PRCPEND']NSN) Q
"RTN","PRCPLO",104,0)
 .   .   ; S ^TMP($J,"PRCPRSOH",NSN,ITEMDA)=TOTAL_"^"_AVERAGE_"^"_ONHAND_"^"_$P(DAYSLEFT,".")_"^"_$P(ITEMDATA,"^",27)
"RTN","PRCPLO",105,0)
 .   .   N ITMCHK
"RTN","PRCPLO",106,0)
 .   .   S ITMCHK=0,ITMCHK=$O(^PRCP(445,PRCP("I"),1,ITMCHK))
"RTN","PRCPLO",107,0)
 .   .   Q:ITMCHK=""!(+(ITMCHK)<1)
"RTN","PRCPLO",108,0)
 .   .   Q:+(ITMCHK)<1  ; made it to x-ref
"RTN","PRCPLO",109,0)
 .   .   D BLDTMP
"RTN","PRCPLO",110,0)
 .   ;98* Accumulate count information
"RTN","PRCPLO",111,0)
 .   S VALUES(PRCP("I"),ODIFLG)=+$G(VALUES(PRCP("I"),ODIFLG))+1
"RTN","PRCPLO",112,0)
 .   ;  sort for primary and secondary
"RTN","PRCPLO",113,0)
 .   S GROUP=+$P(ITEMDATA,"^",21)
"RTN","PRCPLO",114,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPLO",115,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPLO",116,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPLO",117,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPLO",118,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPLO",119,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPLO",120,0)
 .   ;*83,  Create TMP structure for Report
"RTN","PRCPLO",121,0)
 .   N ITMCHK
"RTN","PRCPLO",122,0)
 .   S ITMCHK=0,ITMCHK=$O(^PRCP(445,PRCP("I"),1,ITMCHK))
"RTN","PRCPLO",123,0)
 .   Q:ITMCHK=""!(+(ITMCHK)<1)
"RTN","PRCPLO",124,0)
 .   Q:ITMCHK<1  ; made it to x-ref
"RTN","PRCPLO",125,0)
 .   D BLDTMP
"RTN","PRCPLO",126,0)
 .   Q
"RTN","PRCPLO",127,0)
 Q
"RTN","PRCPLO",128,0)
 ;
"RTN","PRCPLO",129,0)
BLDTMP ;*83 Build ^TMP Structure for Report Server
"RTN","PRCPLO",130,0)
 ;
"RTN","PRCPLO",131,0)
 N INVTYPE,ITEMDESC,CSTCTR,INDAT,NUMLNIT,DATRN,DATRN1,INVPTID
"RTN","PRCPLO",132,0)
 N CSTC1,CSTC2,CSTC3,CSCE1,CSCE2,V4TR,V4TR1
"RTN","PRCPLO",133,0)
 ;
"RTN","PRCPLO",134,0)
 S DATRN=$$FMTE^XLFDT(+DATEEND)
"RTN","PRCPLO",135,0)
 S DATRN1=$P(DATRN," ",1)_","_$P(DATRN," ",3)
"RTN","PRCPLO",136,0)
 S ITEMDESC=$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,15)  ; item Desc
"RTN","PRCPLO",137,0)
 I ITEMDESC="" S ITEMDESC="No Item Desc"
"RTN","PRCPLO",138,0)
 Q:ITEMDA=""!(+(ITEMDA)<1)
"RTN","PRCPLO",139,0)
 ;
"RTN","PRCPLO",140,0)
 S NUMLNIT=1  ; set to 1 for each line item.
"RTN","PRCPLO",141,0)
 S INVTYPE=PRCP("DPTYPE")
"RTN","PRCPLO",142,0)
 I INVTYPE="" S INVTYPE="No Inv Type"
"RTN","PRCPLO",143,0)
 S INDAT=$G(PRCP("PAR"))
"RTN","PRCPLO",144,0)
 S INVPTID=PRCP("I")  ; inv point id #
"RTN","PRCPLO",145,0)
 ; Cost Center logic
"RTN","PRCPLO",146,0)
 ; Get ^PRCP(445,INVPTID,0) 7th piece (int. Cost Center #)
"RTN","PRCPLO",147,0)
 ; Get ^PRCD(420.1,IntCstCtr,0) 1st piece (external format)
"RTN","PRCPLO",148,0)
 S CSTC1=$G(^PRCP(445,INVPTID,0)),CSTC2=$P(CSTC1,"^",7),CSTC3=$P(CSTC1,"^",3)
"RTN","PRCPLO",149,0)
 S V4TR=$P(CSTC1,"^",1),V4TR1=$P(V4TR,"-",2,99)  ; *83 look up name
"RTN","PRCPLO",150,0)
 S V4TR1=$TR(V4TR1,"*","|")  ; $TR name to replace "*"'s with "|"'s
"RTN","PRCPLO",151,0)
 I CSTC2'="" S CSCE1=$G(^PRCD(420.1,CSTC2,0)),CSCE2=$P(CSCE1,"^",1)
"RTN","PRCPLO",152,0)
 I CSTC2="" S CSCE2="No Cost Center"
"RTN","PRCPLO",153,0)
 ; *83, Set 5th Node from ITEMDESC to ITEMDA
"RTN","PRCPLO",154,0)
 S ^TMP($J,"PRCPLO",V3,INVPTID,ITEMDA)=V3_"*"_DATRN1_"*"_INVPTID_"*"_V4TR1_"*"_NUMLNIT_"*"_$P(ITEMDATA,"^",27)_"*"_CSCE2_"*"_INVTYPE
"RTN","PRCPLO",155,0)
 ; *98 Split information for ODI and Standard
"RTN","PRCPLO",156,0)
 S ^TMP($J,"PRCPLO2",V3,INVPTID,ITEMDA,ODIFLG)=+$G(^TMP($J,"PRCPLO2",V3,INVPTID,ITEMDA,ODIFLG))+$P(ITEMDATA,"^",27)
"RTN","PRCPLO",157,0)
 Q
"RTN","PRCPLO",158,0)
BLDFIL ; Build output file
"RTN","PRCPLO",159,0)
 N IN1,IN2,IN3,IN4,IN5,OLPV,NWPV,INDDAT,TOTDOL,LNDOL,CSTCTR,LNCT,PRCPDX,INPTVAL,POINT,STID,DTTM,INVVTYP,INVPTLN
"RTN","PRCPLO",160,0)
 S IN1=0,IN2=0,IN3=0,IN4=0,IN5="INVPT",INDDAT=0,OLPV=0,NWPV=0,LNCT=0,CSTCTR=0,TOTDOL=0,LNDOL=0,INVPTLN=0
"RTN","PRCPLO",161,0)
 S STDCNT=0,ODICNT=0
"RTN","PRCPLO",162,0)
 S (STDDOL,ODIDOL)=0
"RTN","PRCPLO",163,0)
 F  S IN1=$O(^TMP($J,"PRCPLO",IN1)) Q:IN1=""  D
"RTN","PRCPLO",164,0)
 . ;S (STDDOL,ODIDOL)=0
"RTN","PRCPLO",165,0)
 . F  S IN2=$O(^TMP($J,"PRCPLO",IN1,IN2)) Q:IN2=""  D
"RTN","PRCPLO",166,0)
 . . I IN5'="INVPT"  D  ; init for first time through
"RTN","PRCPLO",167,0)
 . . . S INVPTLN=+$P($G(^PRCP(445,+INPTVAL,1,0)),"^",4)
"RTN","PRCPLO",168,0)
 . . . S TOSTDCNT=+$G(TOTCNT(IN2,1)),TOODICNT=+$G(TOTCNT(IN2,2)),TOALLCNT=TOSTDCNT+TOODICNT
"RTN","PRCPLO",169,0)
 . . . S PRCPDX=STID_"*"_DTTM_"*"_INPTVAL_"*"_POINT_"*"_INVVTYP_"*"_TOTDOL_"*"_IN4_"*"_INVPTLN_"*"_CSTCTR
"RTN","PRCPLO",170,0)
 . . . ; set up new ^TMP($J NODE to store totals for ^DIE set
"RTN","PRCPLO",171,0)
 . . . S ^TMP($J,"PRCPSOH",+(STID_INPTVAL))=PRCPDX
"RTN","PRCPLO",172,0)
 . . . S STDCNT=+$G(VALUES(INPTVAL,1)),ODICNT=+$G(VALUES(INPTVAL,2))
"RTN","PRCPLO",173,0)
 . . . S TOSTDCNT=+$G(TOTCNT(INPTVAL,1)),TOODICNT=+$G(TOTCNT(INPTVAL,2))
"RTN","PRCPLO",174,0)
 . . . S TOALLCNT=TOSTDCNT+TOODICNT
"RTN","PRCPLO",175,0)
 . . . S ^TMP($J,"PRCPSOH2",+(STID_INPTVAL))=STDDOL_"*"_ODIDOL_"*"_(STDDOL+ODIDOL)_"*"_STDCNT_"*"_ODICNT_"*"_(STDCNT+ODICNT)_"*"_TOSTDCNT_"*"_TOODICNT_"*"_TOALLCNT
"RTN","PRCPLO",176,0)
 . . . S IN4=0  ; reset to 0, begin counting Line items for INVPT
"RTN","PRCPLO",177,0)
 . . . S TOTDOL=0
"RTN","PRCPLO",178,0)
 . . . S LNDOL=0
"RTN","PRCPLO",179,0)
 . . . S PRCPDX=""
"RTN","PRCPLO",180,0)
 . . . S CSTCTR=""
"RTN","PRCPLO",181,0)
 . . . S (STDDOL,ODIDOL)=0
"RTN","PRCPLO",182,0)
 . . F  S IN3=$O(^TMP($J,"PRCPLO",IN1,IN2,IN3)) Q:IN3=""  D
"RTN","PRCPLO",183,0)
 . . . S INDDAT=$G(^TMP($J,"PRCPLO",IN1,IN2,IN3))
"RTN","PRCPLO",184,0)
 . . . S STID=$P(INDDAT,"*",1)
"RTN","PRCPLO",185,0)
 . . . S DTTM=$P(INDDAT,"*",2)
"RTN","PRCPLO",186,0)
 . . . S POINT=$P(INDDAT,"*",4)
"RTN","PRCPLO",187,0)
 . . . S INPTVAL=$P(INDDAT,"*",3)  ; Inv Point ID# for DIE Set
"RTN","PRCPLO",188,0)
 . . . S CSTCTR=$P(INDDAT,"*",7)
"RTN","PRCPLO",189,0)
 . . . S LNDOL=$P(INDDAT,"*",6)
"RTN","PRCPLO",190,0)
 . . . S INVVTYP=$P(INDDAT,"*",8)
"RTN","PRCPLO",191,0)
 . . . S TOTDOL=TOTDOL+LNDOL
"RTN","PRCPLO",192,0)
 . . . S IN4=IN4+1  ; Count # of line items in Inv Pt
"RTN","PRCPLO",193,0)
 . . . S IN5=IN2  ; Invt. Point
"RTN","PRCPLO",194,0)
 . . . S STDDOL=STDDOL+$G(^TMP($J,"PRCPLO2",IN1,IN2,IN3,1))
"RTN","PRCPLO",195,0)
 . . . S ODIDOL=ODIDOL+$G(^TMP($J,"PRCPLO2",IN1,IN2,IN3,2))
"RTN","PRCPLO",196,0)
 . . . Q
"RTN","PRCPLO",197,0)
 . . Q
"RTN","PRCPLO",198,0)
 . Q
"RTN","PRCPLO",199,0)
 Q
"RTN","PRCPLO",200,0)
GETVAL ; Get values from ^TMP($J,"PRCPSOH"
"RTN","PRCPLO",201,0)
 N LP1,SOHIEN,PRCPDX
"RTN","PRCPLO",202,0)
 S LP1=0
"RTN","PRCPLO",203,0)
 F  S LP1=$O(^TMP($J,"PRCPSOH",LP1)) Q:LP1=""  D
"RTN","PRCPLO",204,0)
 . S PRCPDX=$G(^TMP($J,"PRCPSOH",LP1))
"RTN","PRCPLO",205,0)
 . S SOHIEN=+LP1
"RTN","PRCPLO",206,0)
 . S DR="1///"_PRCPDX
"RTN","PRCPLO",207,0)
 . D SETREC
"RTN","PRCPLO",208,0)
 . S PRCPDX=$G(^TMP($J,"PRCPSOH2",LP1))
"RTN","PRCPLO",209,0)
 . S DR="2///"_PRCPDX
"RTN","PRCPLO",210,0)
 . D SETREC
"RTN","PRCPLO",211,0)
 . Q
"RTN","PRCPLO",212,0)
 Q
"RTN","PRCPLO",213,0)
SETREC ; Set record using DIE in 446.7
"RTN","PRCPLO",214,0)
 ;
"RTN","PRCPLO",215,0)
 N PRCPDR,PRCPST,PRCPSNM,PRCPDA,PRCPDX,PRCPST,X,Y
"RTN","PRCPLO",216,0)
 S PRCPDR=DR
"RTN","PRCPLO",217,0)
 S DIC="^PRCP(446.7,",DIC(0)="L",DLAYGO=446.7,X=SOHIEN D ^DIC K DIC,DLAYGO
"RTN","PRCPLO",218,0)
 S PRCPDA=Y+0
"RTN","PRCPLO",219,0)
 S PRCPST=$P(^TMP($J,"PRCPSOH",LP1),"*",1)
"RTN","PRCPLO",220,0)
 S PRCPSNM=$$GET1^DIQ(4,PRCPST_",",.01)
"RTN","PRCPLO",221,0)
 ;*98 Send enhanced mail message if exception occurs during FileMan set
"RTN","PRCPLO",222,0)
 I Y=-1 N PRCPMSG D  Q
"RTN","PRCPLO",223,0)
 . S PRCPMSG(1)="Error saving to File #446.7 for Days of Stock on Hand Report, related data: "
"RTN","PRCPLO",224,0)
 . S PRCPMSG(2)="",PRCPMSG(3)="Station: "_PRCPST_" "_PRCPSNM
"RTN","PRCPLO",225,0)
 . S PRCPMSG(4)="Inventory Point: "_$P(^TMP($J,"PRCPSOH",LP1),"*",3)_" "_$P(^TMP($J,"PRCPSOH",LP1),"*",4)
"RTN","PRCPLO",226,0)
 . S PRCPMSG(5)="File #446.7 Field Set Attempted: "_PRCPDR
"RTN","PRCPLO",227,0)
 . D MAIL^PRCPLO3 Q
"RTN","PRCPLO",228,0)
 ;
"RTN","PRCPLO",229,0)
 S DIE="^PRCP(446.7,",DA=PRCPDA D ^DIE K DIE,DR,DA
"RTN","PRCPLO",230,0)
 Q
"RTN","PRCPLO2")
0^12^B45937677^B29511924
"RTN","PRCPLO2",1,0)
PRCPLO2 ;WISC/RFJ/dh/DWA/DAP-stock status report (option, whse) ; 2/23/07 5:00pm
"RTN","PRCPLO2",2,0)
 ;;5.1;IFCAP;**83,41,98**;Oct 20, 2000;Build 37
"RTN","PRCPLO2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPLO2",4,0)
 ;Copied from routine ^PRCPRSSR and modified for PRC*5.1*83 (CLRS)
"RTN","PRCPLO2",5,0)
 ;
"RTN","PRCPLO2",6,0)
ENT ;This report will be called from option PRCPLO CLO GIP OPTION with fixed
"RTN","PRCPLO2",7,0)
 ;input parameters and run for all stations and active inventory points
"RTN","PRCPLO2",8,0)
 ;on a given VistA system.
"RTN","PRCPLO2",9,0)
 L +^PRCP(446.7,"STATUS"):3 I $T=0 S PRCPMSG(1)="Error encountered when attempting to run CLO GIP Reports due to other",PRCPMSG(2)="CLRS extracts in progress, please try again later." D MAIL^PRCPLO3 Q
"RTN","PRCPLO2",10,0)
 K ^PRCP(446.7)
"RTN","PRCPLO2",11,0)
 S ^PRCP(446.7,0)="CLRS REPORT STORAGE^446.7^^"
"RTN","PRCPLO2",12,0)
 N CLRSFLAG
"RTN","PRCPLO2",13,0)
 S CLRSFLAG="SS" D GETIPT^PRCPLO1
"RTN","PRCPLO2",14,0)
 ;*83 This call links the Stock on Hand Report in a series of two
"RTN","PRCPLO2",15,0)
 ;consecutive report runs to be executed on the 1st of each month.
"RTN","PRCPLO2",16,0)
 L -^PRCP(446.7,"STATUS")
"RTN","PRCPLO2",17,0)
 D ENT^PRCPLO
"RTN","PRCPLO2",18,0)
 N PRCPMSG S PRCPMSG(1)="CLO GIP Reports completed on "_$$HTE^XLFDT($H) D MAIL^PRCPLO3
"RTN","PRCPLO2",19,0)
 Q
"RTN","PRCPLO2",20,0)
 ;
"RTN","PRCPLO2",21,0)
EN1 ;*83 Call coming in from PRCPLO1 with station number and inventory point
"RTN","PRCPLO2",22,0)
 ;
"RTN","PRCPLO2",23,0)
 N %,%DT,%H,%I,DATEINAC,DATESTRT,TODAY,X,X1,X2,Y,MNT,INARNG
"RTN","PRCPLO2",24,0)
 ;*83 The following was edited to always enter the previous month as the start date
"RTN","PRCPLO2",25,0)
 D NOW^%DTC S TODAY=X,Y=$E(X,1,3),MNT=$E(X,4,5)
"RTN","PRCPLO2",26,0)
 S MNT=MNT-1
"RTN","PRCPLO2",27,0)
 I MNT=0 S MNT=12,Y=Y-1
"RTN","PRCPLO2",28,0)
 I $L(MNT)=1 S MNT=0_MNT
"RTN","PRCPLO2",29,0)
 S DATESTRT=Y_MNT_"00"
"RTN","PRCPLO2",30,0)
 ;
"RTN","PRCPLO2",31,0)
 ;*83 The following was edited to always enter a 90 day previous to 
"RTN","PRCPLO2",32,0)
 ;current date default inactivity range if no other is indicated via the
"RTN","PRCPLO2",33,0)
 ;PRCPLO INACTIVITY RANGE parameter
"RTN","PRCPLO2",34,0)
 S INARNG=$$GET^XPAR("SYS","PRCPLO INACTIVITY RANGE",1,"Q")
"RTN","PRCPLO2",35,0)
 I INARNG="" S INARNG=90
"RTN","PRCPLO2",36,0)
 S X1=TODAY,X2=(INARNG*-1) D C^%DTC S DATEINAC=$E(X,1,5)_"00"
"RTN","PRCPLO2",37,0)
 S DT=TODAY
"RTN","PRCPLO2",38,0)
 ;
"RTN","PRCPLO2",39,0)
 ;*83 Build report with station and inventory point passed in from PRCPLO1 call
"RTN","PRCPLO2",40,0)
DQ ;  queue starts here
"RTN","PRCPLO2",41,0)
 N ACCT,ADJ,ADJN,AVERAGE,D,DA,DATE,DATELONG,DUEIN,DUEOUT,INACT,INACTN,INVVAL,ISS,ISSN,ITEMDA,LONG,LONGN,NONISS,NONISSN,ONHAND,OPEN,QTY,REC,RECN,TOTAL,TOTDAYS,TRANSNO,TYPE,VALUE
"RTN","PRCPLO2",42,0)
 ;*83 Added newing of variables
"RTN","PRCPLO2",43,0)
 N STA,INV,TOTOPEN,TOTREC,TOTISS,TOTADJ,TOTCLOS,RECNM,TOTN,DATRN,TOTINA,TOTIS1,TOTAD1,TOTIND,TOTLNG,TOTLND,DAYS,DATRN1,ODITEM,NODE1
"RTN","PRCPLO2",44,0)
 ;*98 Modified calculations to separate ODI and Standard Items
"RTN","PRCPLO2",45,0)
 K ^TMP($J)
"RTN","PRCPLO2",46,0)
 K OPEN
"RTN","PRCPLO2",47,0)
 ;
"RTN","PRCPLO2",48,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  D
"RTN","PRCPLO2",49,0)
 .   S NODE1=1
"RTN","PRCPLO2",50,0)
 .   S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPLO2",51,0)
 .   I ODITEM="Y" S NODE1=2
"RTN","PRCPLO2",52,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPLO2",53,0)
 .   S ^TMP($J,NODE1,"CNT",ACCT)=$G(^TMP($J,NODE1,"CNT",ACCT))+1
"RTN","PRCPLO2",54,0)
 ; 
"RTN","PRCPLO2",55,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445.1,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S X=$$GETOPEN^PRCPUBAL(PRCP("I"),ITEMDA,$E(DATESTRT,1,5)) I X'="" D
"RTN","PRCPLO2",56,0)
 .   S NODE1=1
"RTN","PRCPLO2",57,0)
 .   S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPLO2",58,0)
 .   I ODITEM="Y" S NODE1=2
"RTN","PRCPLO2",59,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPLO2",60,0)
 .   S $P(^TMP($J,NODE1,"OPEN",ACCT),"^")=$P($G(^TMP($J,NODE1,"OPEN",ACCT)),"^")+$P(X,"^",2)+$P(X,"^",3)
"RTN","PRCPLO2",61,0)
 .   S $P(^TMP($J,NODE1,"OPEN",ACCT),"^",2)=$P($G(^TMP($J,NODE1,"OPEN",ACCT)),"^",2)+$P(X,"^",8)
"RTN","PRCPLO2",62,0)
 S DATE=DATESTRT F  S DATE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE)) Q:$E(DATE,1,5)'=$E(DATESTRT,1,5)  S TYPE="" F  S TYPE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE)) Q:TYPE=""  D
"RTN","PRCPLO2",63,0)
 .   S DA=0 F  S DA=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE,DA)) Q:'DA  D
"RTN","PRCPLO2",64,0)
 .   .   S D=$G(^PRCP(445.2,DA,0)) I '$P(D,"^",5) Q
"RTN","PRCPLO2",65,0)
 .   .   ;  non-issuable
"RTN","PRCPLO2",66,0)
 .   .   Q:$P(D,"^",11)="N"  ;count if not flagged as non-issueable
"RTN","PRCPLO2",67,0)
 .   .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1($P(D,"^",5)))
"RTN","PRCPLO2",68,0)
 .   .   S TRANSNO=$P(D,"^",19)
"RTN","PRCPLO2",69,0)
 .   .   S INVVAL=$P(D,"^",7)*$P(D,"^",8) I $P(D,"^",22)'="" S INVVAL=$P(D,"^",22)
"RTN","PRCPLO2",70,0)
 .   .   S NODE1=1
"RTN","PRCPLO2",71,0)
 .   .   I $$ODITEM^PRCPUX2(PRCP("I"),$P(D,"^",5))="Y" S NODE1=2
"RTN","PRCPLO2",72,0)
 .   .   ;  set transno temporary for primary and secondary to
"RTN","PRCPLO2",73,0)
 .   .   ;  indicate type of transaction
"RTN","PRCPLO2",74,0)
 .   .   I PRCP("DPTYPE")'="W" D
"RTN","PRCPLO2",75,0)
 .   .   .   I TYPE="R"!(TYPE="C")!(TYPE="E")!(TYPE="U")!(TYPE="S") S TRANSNO="--1" Q  ;issue
"RTN","PRCPLO2",76,0)
 .   .   .   I TYPE="RC" S TRANSNO=1 Q  ;receipt
"RTN","PRCPLO2",77,0)
 .   .   .   S TRANSNO="" ;adjustment
"RTN","PRCPLO2",78,0)
 .   .   ;  other adjustments
"RTN","PRCPLO2",79,0)
 .   .   I PRCP("DPTYPE")="W",$P(TRANSNO,"-",2)="" S ^TMP($J,NODE1,"ADJ",ACCT)=$G(^TMP($J,NODE1,"ADJ",ACCT))+INVVAL,^TMP($J,NODE1,"ADJN",ACCT)=$G(^TMP($J,NODE1,"ADJN",ACCT))+1 Q
"RTN","PRCPLO2",80,0)
 .   .   I TRANSNO="" S ^TMP($J,NODE1,"ADJ",ACCT)=$G(^TMP($J,NODE1,"ADJ",ACCT))+INVVAL,^TMP($J,NODE1,"ADJN",ACCT)=$G(^TMP($J,NODE1,"ADJN",ACCT))+1
"RTN","PRCPLO2",81,0)
 .   .   E  D
"RTN","PRCPLO2",82,0)
 .   .   .   ;  purchase order
"RTN","PRCPLO2",83,0)
 .   .   .   I $P(TRANSNO,"-",3)="" S ^TMP($J,NODE1,"REC",ACCT)=$G(^TMP($J,NODE1,"REC",ACCT))+INVVAL,^TMP($J,NODE1,"RECN",ACCT)=$G(^TMP($J,NODE1,"RECN",ACCT))+1 Q
"RTN","PRCPLO2",84,0)
 .   .   .   ;  usage
"RTN","PRCPLO2",85,0)
 .   .   .   S ^TMP($J,NODE1,"ISS",ACCT)=$G(^TMP($J,NODE1,"ISS",ACCT))+INVVAL,^TMP($J,NODE1,"ISSN",ACCT)=$G(^TMP($J,NODE1,"ISSN",ACCT))+1
"RTN","PRCPLO2",86,0)
 ;  calculate inactive, long supply, set non-issuable
"RTN","PRCPLO2",87,0)
 ;*98 modified long supply range to be 90 days instead of 270
"RTN","PRCPLO2",88,0)
 S X1=$E(DT,1,5)_"01",X2=-89 D C^%DTC S DATELONG=$E(X,1,5),X1=DT,X2=$E(X,1,5)_"00" D ^%DTC S TOTDAYS=X
"RTN","PRCPLO2",89,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S D=$G(^(ITEMDA,0)) I D'="" D
"RTN","PRCPLO2",90,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPLO2",91,0)
 .   ;  value
"RTN","PRCPLO2",92,0)
 .   S NODE1=1
"RTN","PRCPLO2",93,0)
 .   S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPLO2",94,0)
 .   I ODITEM="Y" S NODE1=2
"RTN","PRCPLO2",95,0)
 .   S ^TMP($J,NODE1,"VALUE",ACCT)=$G(^TMP($J,NODE1,"VALUE",ACCT))+$P(D,"^",27)
"RTN","PRCPLO2",96,0)
 .   S ^TMP($J,NODE1,"DUEIN",ACCT)=$G(^TMP($J,NODE1,"DUEIN",ACCT))+($$GETIN^PRCPUDUE(PRCP("I"),ITEMDA)*$P(D,"^",22))
"RTN","PRCPLO2",97,0)
 .   S ^TMP($J,NODE1,"DUEOUT",ACCT)=$G(^TMP($J,NODE1,"DUEOUT",ACCT))+($$GETOUT^PRCPUDUE(PRCP("I"),ITEMDA)*$P(D,"^",22))
"RTN","PRCPLO2",98,0)
 .   ;  non-issuable
"RTN","PRCPLO2",99,0)
 .   I $P(D,"^",19) S ^TMP($J,NODE1,"NISS",ACCT)=$G(^TMP($J,NODE1,"NISS",ACCT))+($J($P(D,"^",19)*$P(D,"^",22),0,2)),^TMP($J,NODE1,"NISSN",ACCT)=$G(^TMP($J,NODE1,"NISSN",ACCT))+1
"RTN","PRCPLO2",100,0)
 .   ;  inactive
"RTN","PRCPLO2",101,0)
 .   ;  if reusable, quit
"RTN","PRCPLO2",102,0)
 .   I $$REUSABLE^PRCPU441(ITEMDA) Q
"RTN","PRCPLO2",103,0)
 .   S QTY=$P(D,"^",7)+$P(D,"^",19)
"RTN","PRCPLO2",104,0)
 .   I QTY,'$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,$E(DATEINAC,1,5)-.01)),'$O(^PRCP(445,PRCP("I"),1,ITEMDA,3,DATEINAC)) D
"RTN","PRCPLO2",105,0)
 . .  S ^TMP($J,NODE1,"INACT",ACCT)=$G(^TMP($J,NODE1,"INACT",ACCT))+$P(D,"^",27),^TMP($J,NODE1,"INACTN",ACCT)=$G(^TMP($J,NODE1,"INACTN",ACCT))+1
"RTN","PRCPLO2",106,0)
 .   ;  long supply
"RTN","PRCPLO2",107,0)
 .   S DATE=DATELONG-.01,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPLO2",108,0)
 .   S AVERAGE=$J(TOTAL/TOTDAYS,0,2),TOTAL=$S('AVERAGE&(QTY):9999999,'AVERAGE:0,1:QTY/AVERAGE\1)
"RTN","PRCPLO2",109,0)
 .   I TOTAL>90 S ^TMP($J,NODE1,"LONG",ACCT)=$G(^TMP($J,NODE1,"LONG",ACCT))+$P(D,"^",27),^TMP($J,NODE1,"LONGN",ACCT)=$G(^TMP($J,NODE1,"LONGN",ACCT))+1
"RTN","PRCPLO2",110,0)
 ;
"RTN","PRCPLO2",111,0)
 ;*98 Create consolidated array of Standard and On-Demand Items
"RTN","PRCPLO2",112,0)
 N I,J,PRCPQ1,PRCPQ2,PRCPR1,PRCPR2,PRCPS1,PRCPS2,L,J,K,TEMPDATA
"RTN","PRCPLO2",113,0)
 F I=1:1:2 D
"RTN","PRCPLO2",114,0)
 .   S PRCPQ1="" F  S PRCPQ1=$O(^TMP($J,I,PRCPQ1)) Q:PRCPQ1=""  D
"RTN","PRCPLO2",115,0)
 ..  S PRCPQ2="" F  S PRCPQ2=$O(^TMP($J,I,PRCPQ1,PRCPQ2)) Q:PRCPQ2=""  D
"RTN","PRCPLO2",116,0)
 ... S TEMPDATA=^TMP($J,I,PRCPQ1,PRCPQ2)
"RTN","PRCPLO2",117,0)
 ... F L=1:1:2 S $P(^TMP($J,3,PRCPQ1,PRCPQ2),"^",L)=$P($G(^TMP($J,3,PRCPQ1,PRCPQ2)),"^",L)+$P(TEMPDATA,"^",L)
"RTN","PRCPLO2",118,0)
 ;
"RTN","PRCPLO2",119,0)
 F J=1:1:3 D
"RTN","PRCPLO2",120,0)
 .   S PRCPR1="" F  S PRCPR1=$O(^TMP($J,3,PRCPR1)) Q:PRCPR1=""  S ^TMP($J,J,PRCPR1,"TOTAL")=0
"RTN","PRCPLO2",121,0)
 ;
"RTN","PRCPLO2",122,0)
 F K=1:1:3 D
"RTN","PRCPLO2",123,0)
 .   S PRCPS1="" F  S PRCPS1=$O(^TMP($J,K,PRCPS1)) Q:PRCPS1=""  D
"RTN","PRCPLO2",124,0)
 ..  S PRCPS2="" F  S PRCPS2=$O(^TMP($J,K,PRCPS1,PRCPS2)) Q:+PRCPS2=0  D
"RTN","PRCPLO2",125,0)
 ... S ^TMP($J,K,PRCPS1,"TOTAL")=$G(^TMP($J,K,PRCPS1,"TOTAL"))+$G(^TMP($J,K,PRCPS1,PRCPS2))
"RTN","PRCPLO2",126,0)
 ;
"RTN","PRCPLO2",127,0)
 D ENT^PRCPLO2A
"RTN","PRCPLO2",128,0)
 ;
"RTN","PRCPLO2",129,0)
 Q
"RTN","PRCPLO2A")
0^13^B60268350^B19078579
"RTN","PRCPLO2A",1,0)
PRCPLO2A ;WOIFO/DAP-stock status report (cont) ; 1/26/06 12:00pm
"RTN","PRCPLO2A",2,0)
V ;;5.1;IFCAP;**83,98**;Oct 20, 2000;Build 37
"RTN","PRCPLO2A",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPLO2A",4,0)
 ;
"RTN","PRCPLO2A",5,0)
ENT ;*83 Building ^TMP with total result data, totaling logic pulled from PRCPRSS0
"RTN","PRCPLO2A",6,0)
 N PRCPIN,PRCPIN1,PRCPIN2,PRCPIN3,TOTVAL,TOTCLOS,TOTCLO1,TOTCLO2,SSRIEN
"RTN","PRCPLO2A",7,0)
 S U="^",STA=PRC("SITE"),INV=PRCP("I")
"RTN","PRCPLO2A",8,0)
 ;
"RTN","PRCPLO2A",9,0)
SSR1 ;*98 First Stock Status Report data field set
"RTN","PRCPLO2A",10,0)
 ;
"RTN","PRCPLO2A",11,0)
 S $P(^TMP($J,"PRCPSSR1",STA,INV),U,1)=STA ;Station #
"RTN","PRCPLO2A",12,0)
 S DATRN=$$FMTE^XLFDT(DATESTRT)
"RTN","PRCPLO2A",13,0)
 S DATRN1=$P(DATRN," ",1)_","_$P(DATRN," ",2)
"RTN","PRCPLO2A",14,0)
 S $P(^TMP($J,"PRCPSSR1",STA,INV),U,2)=DATRN1 ;Date Range
"RTN","PRCPLO2A",15,0)
 S $P(^TMP($J,"PRCPSSR1",STA,INV),U,3)=INARNG ;Inactivity Range
"RTN","PRCPLO2A",16,0)
 S $P(^TMP($J,"PRCPSSR1",STA,INV),U,4)=INV ;Inventory Point #
"RTN","PRCPLO2A",17,0)
 ;*83 Retrieve external inventory point name and primary/secondary/
"RTN","PRCPLO2A",18,0)
 ;warehouse indicator
"RTN","PRCPLO2A",19,0)
 S PRCPIN=$G(^PRCP(445,INV,0))
"RTN","PRCPLO2A",20,0)
 I PRCPIN'="" S PRCPIN1=$P(PRCPIN,"^",1),PRCPIN2=$P(PRCPIN1,"-",2,99)
"RTN","PRCPLO2A",21,0)
 I PRCPIN'="" S PRCPIN3=$P(PRCPIN,"^",3)
"RTN","PRCPLO2A",22,0)
 I PRCPIN="" S PRCPIN2="",PRCPIN3=""
"RTN","PRCPLO2A",23,0)
 S PRCPIN2=$TR(PRCPIN2,"*","|")  ; Needed due to "*" delimiter
"RTN","PRCPLO2A",24,0)
 S $P(^TMP($J,"PRCPSSR1",STA,INV),U,5)=PRCPIN2 ;Inventory Point Name
"RTN","PRCPLO2A",25,0)
 S $P(^TMP($J,"PRCPSSR1",STA,INV),U,6)=PRCPIN3 ;P/S/W Indicator
"RTN","PRCPLO2A",26,0)
 ;
"RTN","PRCPLO2A",27,0)
 S PRCPDX=$TR(^TMP($J,"PRCPSSR1",STA,INV),"^","*"),DR="3///"_PRCPDX
"RTN","PRCPLO2A",28,0)
 D FILE
"RTN","PRCPLO2A",29,0)
 ;
"RTN","PRCPLO2A",30,0)
SSR2 ;*98 Second Stock Status Report data field set
"RTN","PRCPLO2A",31,0)
 ;
"RTN","PRCPLO2A",32,0)
 S TOTOPEN=0 F ACCT=1,2,3,6,8 S %=$P($G(^TMP($J,1,"OPEN",ACCT)),U,2),TOTOPEN=TOTOPEN+%
"RTN","PRCPLO2A",33,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,1)=TOTOPEN ;Std. Open Balance Total $
"RTN","PRCPLO2A",34,0)
 S TOTOPEN=0 F ACCT=1,2,3,6,8 S %=$P($G(^TMP($J,2,"OPEN",ACCT)),U,2),TOTOPEN=TOTOPEN+%
"RTN","PRCPLO2A",35,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,2)=TOTOPEN ;ODI Open Balance Total $
"RTN","PRCPLO2A",36,0)
 S TOTOPEN=0 F ACCT=1,2,3,6,8 S %=$P($G(^TMP($J,3,"OPEN",ACCT)),U,2),TOTOPEN=TOTOPEN+%
"RTN","PRCPLO2A",37,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,3)=TOTOPEN ;All Open Balance Total $
"RTN","PRCPLO2A",38,0)
 ;
"RTN","PRCPLO2A",39,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,4)=+$G(^TMP($J,1,"REC","TOTAL"))
"RTN","PRCPLO2A",40,0)
 ;Std. Receipts Total $
"RTN","PRCPLO2A",41,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,5)=+$G(^TMP($J,2,"REC","TOTAL"))
"RTN","PRCPLO2A",42,0)
 ;ODI Receipts Total $
"RTN","PRCPLO2A",43,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,6)=+$G(^TMP($J,3,"REC","TOTAL"))
"RTN","PRCPLO2A",44,0)
 ;All Receipts Total $
"RTN","PRCPLO2A",45,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,7)=+$G(^TMP($J,1,"ISS","TOTAL"))
"RTN","PRCPLO2A",46,0)
 ;Std. Usages Total $
"RTN","PRCPLO2A",47,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,8)=+$G(^TMP($J,2,"ISS","TOTAL"))
"RTN","PRCPLO2A",48,0)
 ;ODI Usages Total $
"RTN","PRCPLO2A",49,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,9)=+$G(^TMP($J,3,"ISS","TOTAL"))
"RTN","PRCPLO2A",50,0)
 ;All Usages Total $
"RTN","PRCPLO2A",51,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,10)=+$G(^TMP($J,1,"ADJ","TOTAL"))
"RTN","PRCPLO2A",52,0)
 ;Std. Adjustments Total $
"RTN","PRCPLO2A",53,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,11)=+$G(^TMP($J,2,"ADJ","TOTAL"))
"RTN","PRCPLO2A",54,0)
 ;ODI Adjustments Total $
"RTN","PRCPLO2A",55,0)
 S $P(^TMP($J,"PRCPSSR2",STA,INV),U,12)=+$G(^TMP($J,3,"ADJ","TOTAL"))
"RTN","PRCPLO2A",56,0)
 ;All Adjustments Total $
"RTN","PRCPLO2A",57,0)
 ;
"RTN","PRCPLO2A",58,0)
 S PRCPDX=$TR(^TMP($J,"PRCPSSR2",STA,INV),"^","*"),DR="4///"_PRCPDX
"RTN","PRCPLO2A",59,0)
 D FILE
"RTN","PRCPLO2A",60,0)
 ;
"RTN","PRCPLO2A",61,0)
SSR3 ;*98 Third Stock Status Report data field set
"RTN","PRCPLO2A",62,0)
 ;
"RTN","PRCPLO2A",63,0)
 S TOTCLOS=0
"RTN","PRCPLO2A",64,0)
 S TOTCLOS=$P($G(^TMP($J,"PRCPSSR2",STA,INV)),U,1)+$G(^TMP($J,1,"REC","TOTAL"))
"RTN","PRCPLO2A",65,0)
 S TOTCLOS=TOTCLOS+$G(^TMP($J,1,"ISS","TOTAL"))+$G(^TMP($J,1,"ADJ","TOTAL"))
"RTN","PRCPLO2A",66,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,1)=TOTCLOS ;Std. Closing Bal Total $
"RTN","PRCPLO2A",67,0)
 S TOTCLO1=0
"RTN","PRCPLO2A",68,0)
 S TOTCLO1=$P($G(^TMP($J,"PRCPSSR2",STA,INV)),U,2)+$G(^TMP($J,2,"REC","TOTAL"))
"RTN","PRCPLO2A",69,0)
 S TOTCLO1=TOTCLO1+$G(^TMP($J,2,"ISS","TOTAL"))+$G(^TMP($J,2,"ADJ","TOTAL"))
"RTN","PRCPLO2A",70,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,2)=TOTCLO1 ;ODI Closing Bal Total $
"RTN","PRCPLO2A",71,0)
 S TOTCLO2=0
"RTN","PRCPLO2A",72,0)
 S TOTCLO2=$P($G(^TMP($J,"PRCPSSR2",STA,INV)),U,3)+$G(^TMP($J,3,"REC","TOTAL"))
"RTN","PRCPLO2A",73,0)
 S TOTCLO2=TOTCLO2+$G(^TMP($J,3,"ISS","TOTAL"))+$G(^TMP($J,3,"ADJ","TOTAL"))
"RTN","PRCPLO2A",74,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,3)=TOTCLO2 ;All Closing Bal Total $
"RTN","PRCPLO2A",75,0)
 ;
"RTN","PRCPLO2A",76,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,4)=+$G(^TMP($J,1,"RECN","TOTAL"))
"RTN","PRCPLO2A",77,0)
 ;# Std. Receipts
"RTN","PRCPLO2A",78,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,5)=+$G(^TMP($J,2,"RECN","TOTAL"))
"RTN","PRCPLO2A",79,0)
 ;# ODI Receipts
"RTN","PRCPLO2A",80,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,6)=+$G(^TMP($J,3,"RECN","TOTAL"))
"RTN","PRCPLO2A",81,0)
 ;# All Receipts
"RTN","PRCPLO2A",82,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,7)=+$G(^TMP($J,1,"ISSN","TOTAL"))
"RTN","PRCPLO2A",83,0)
 ;# Std. Issues
"RTN","PRCPLO2A",84,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,8)=+$G(^TMP($J,2,"ISSN","TOTAL"))
"RTN","PRCPLO2A",85,0)
 ;# ODI Issues
"RTN","PRCPLO2A",86,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,9)=+$G(^TMP($J,3,"ISSN","TOTAL"))
"RTN","PRCPLO2A",87,0)
 ;# All Issues
"RTN","PRCPLO2A",88,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,10)=+$G(^TMP($J,1,"ADJN","TOTAL"))
"RTN","PRCPLO2A",89,0)
 ;# Std. Adjustments
"RTN","PRCPLO2A",90,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,11)=+$G(^TMP($J,2,"ADJN","TOTAL"))
"RTN","PRCPLO2A",91,0)
 ;# ODI Adjustments
"RTN","PRCPLO2A",92,0)
 S $P(^TMP($J,"PRCPSSR3",STA,INV),U,12)=+$G(^TMP($J,3,"ADJN","TOTAL"))
"RTN","PRCPLO2A",93,0)
 ;# All Adjustments
"RTN","PRCPLO2A",94,0)
 ;
"RTN","PRCPLO2A",95,0)
 S PRCPDX=$TR(^TMP($J,"PRCPSSR3",STA,INV),"^","*"),DR="5///"_PRCPDX
"RTN","PRCPLO2A",96,0)
 D FILE
"RTN","PRCPLO2A",97,0)
 ;
"RTN","PRCPLO2A",98,0)
SSR4 ;*98 Fourth Stock Status Report data field set
"RTN","PRCPLO2A",99,0)
 ;
"RTN","PRCPLO2A",100,0)
 ;*83 Turnover computation logic also pulled from PRCPRSS0
"RTN","PRCPLO2A",101,0)
 S DAYS=$P("31^28^31^30^31^30^31^31^30^31^30^31",U,+$E(DATESTRT,4,5))
"RTN","PRCPLO2A",102,0)
 I DAYS=28 S %=(17+$E(DATESTRT))_$E(DATESTRT,2,3),DAYS=$S(%#400=0:29,(%#4=0&(%#100'=0)):29,1:28)
"RTN","PRCPLO2A",103,0)
 ;
"RTN","PRCPLO2A",104,0)
 S %=($G(^TMP($J,1,"ISS","TOTAL"))*365)/DAYS,%=$S('TOTCLOS:0,1:-%/TOTCLOS)
"RTN","PRCPLO2A",105,0)
 I $P(%,".",2) S %=$P(%,".",1)_"."_$E($P(%,".",2),1,2)
"RTN","PRCPLO2A",106,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,1)=%
"RTN","PRCPLO2A",107,0)
 ;Std. Turnover
"RTN","PRCPLO2A",108,0)
 S %=($G(^TMP($J,2,"ISS","TOTAL"))*365)/DAYS,%=$S('TOTCLO1:0,1:-%/TOTCLO1)
"RTN","PRCPLO2A",109,0)
 I $P(%,".",2) S %=$P(%,".",1)_"."_$E($P(%,".",2),1,2)
"RTN","PRCPLO2A",110,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,2)=%
"RTN","PRCPLO2A",111,0)
 ;ODI Turnover
"RTN","PRCPLO2A",112,0)
 S %=($G(^TMP($J,3,"ISS","TOTAL"))*365)/DAYS,%=$S('TOTCLO2:0,1:-%/TOTCLO2)
"RTN","PRCPLO2A",113,0)
 I $P(%,".",2) S %=$P(%,".",1)_"."_$E($P(%,".",2),1,2)
"RTN","PRCPLO2A",114,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,3)=%
"RTN","PRCPLO2A",115,0)
 ;All Turnover
"RTN","PRCPLO2A",116,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,4)=+$G(^TMP($J,1,"INACTN","TOTAL"))
"RTN","PRCPLO2A",117,0)
 ;# Std. Inactive
"RTN","PRCPLO2A",118,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,5)=+$G(^TMP($J,2,"INACTN","TOTAL"))
"RTN","PRCPLO2A",119,0)
 ;# ODI Inactive
"RTN","PRCPLO2A",120,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,6)=+$G(^TMP($J,3,"INACTN","TOTAL"))
"RTN","PRCPLO2A",121,0)
 ;# All Inactive
"RTN","PRCPLO2A",122,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,7)=+$G(^TMP($J,1,"INACT","TOTAL"))
"RTN","PRCPLO2A",123,0)
 ;Std Inactive Total $
"RTN","PRCPLO2A",124,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,8)=+$G(^TMP($J,2,"INACT","TOTAL"))
"RTN","PRCPLO2A",125,0)
 ;ODI Inactive Total $
"RTN","PRCPLO2A",126,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,9)=+$G(^TMP($J,3,"INACT","TOTAL"))
"RTN","PRCPLO2A",127,0)
 ;All Inactive Total $
"RTN","PRCPLO2A",128,0)
 ;
"RTN","PRCPLO2A",129,0)
 S %=$S('$G(^TMP($J,1,"VALUE","TOTAL")):0,1:$G(^TMP($J,1,"INACT","TOTAL"))/$G(^TMP($J,1,"VALUE","TOTAL")))
"RTN","PRCPLO2A",130,0)
 I $P(%,".",2) S %=$P(%,".",1)_"."_$E($P(%,".",2),1,2)
"RTN","PRCPLO2A",131,0)
 I %="" S %=0
"RTN","PRCPLO2A",132,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,10)=%
"RTN","PRCPLO2A",133,0)
 ;Std. Inactive %
"RTN","PRCPLO2A",134,0)
 S %=$S('$G(^TMP($J,2,"VALUE","TOTAL")):0,1:$G(^TMP($J,2,"INACT","TOTAL"))/$G(^TMP($J,2,"VALUE","TOTAL")))
"RTN","PRCPLO2A",135,0)
 I $P(%,".",2) S %=$P(%,".",1)_"."_$E($P(%,".",2),1,2)
"RTN","PRCPLO2A",136,0)
 I %="" S %=0
"RTN","PRCPLO2A",137,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,11)=%
"RTN","PRCPLO2A",138,0)
 ;ODI Inactive %
"RTN","PRCPLO2A",139,0)
 S %=$S('$G(^TMP($J,3,"VALUE","TOTAL")):0,1:$G(^TMP($J,3,"INACT","TOTAL"))/$G(^TMP($J,3,"VALUE","TOTAL")))
"RTN","PRCPLO2A",140,0)
 I $P(%,".",2) S %=$P(%,".",1)_"."_$E($P(%,".",2),1,2)
"RTN","PRCPLO2A",141,0)
 I %="" S %=0
"RTN","PRCPLO2A",142,0)
 S $P(^TMP($J,"PRCPSSR4",STA,INV),U,12)=%
"RTN","PRCPLO2A",143,0)
 ;All Inactive %
"RTN","PRCPLO2A",144,0)
 ;
"RTN","PRCPLO2A",145,0)
 S PRCPDX=$TR(^TMP($J,"PRCPSSR4",STA,INV),"^","*"),DR="6///"_PRCPDX
"RTN","PRCPLO2A",146,0)
 D FILE
"RTN","PRCPLO2A",147,0)
 ;
"RTN","PRCPLO2A",148,0)
SSR5 ;*98 Fifth Stock Status Report data field set
"RTN","PRCPLO2A",149,0)
 ;
"RTN","PRCPLO2A",150,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,1)=+$G(^TMP($J,1,"LONGN","TOTAL"))
"RTN","PRCPLO2A",151,0)
 ;# Std. Long Supply
"RTN","PRCPLO2A",152,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,2)=+$G(^TMP($J,2,"LONGN","TOTAL"))
"RTN","PRCPLO2A",153,0)
 ;# ODI Long Supply
"RTN","PRCPLO2A",154,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,3)=+$G(^TMP($J,3,"LONGN","TOTAL"))
"RTN","PRCPLO2A",155,0)
 ;# All Long Supply
"RTN","PRCPLO2A",156,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,4)=+$G(^TMP($J,1,"LONG","TOTAL"))
"RTN","PRCPLO2A",157,0)
 ;Std. Long Supply Total $
"RTN","PRCPLO2A",158,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,5)=+$G(^TMP($J,2,"LONG","TOTAL"))
"RTN","PRCPLO2A",159,0)
 ;ODI Long Supply Total $
"RTN","PRCPLO2A",160,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,6)=+$G(^TMP($J,3,"LONG","TOTAL"))
"RTN","PRCPLO2A",161,0)
 ;All Long Supply Total $
"RTN","PRCPLO2A",162,0)
 ;
"RTN","PRCPLO2A",163,0)
 S %=$S('$G(^TMP($J,1,"VALUE","TOTAL")):0,1:$G(^TMP($J,1,"LONG","TOTAL"))/$G(^TMP($J,1,"VALUE","TOTAL")))
"RTN","PRCPLO2A",164,0)
 I $P(%,".",2) S %=$P(%,".",1)_"."_$E($P(%,".",2),1,2)
"RTN","PRCPLO2A",165,0)
 I %="" S %=0
"RTN","PRCPLO2A",166,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,7)=%
"RTN","PRCPLO2A",167,0)
 ;Std. Long Supply %
"RTN","PRCPLO2A",168,0)
 S %=$S('$G(^TMP($J,2,"VALUE","TOTAL")):0,1:$G(^TMP($J,2,"LONG","TOTAL"))/$G(^TMP($J,2,"VALUE","TOTAL")))
"RTN","PRCPLO2A",169,0)
 I $P(%,".",2) S %=$P(%,".",1)_"."_$E($P(%,".",2),1,2)
"RTN","PRCPLO2A",170,0)
 I %="" S %=0
"RTN","PRCPLO2A",171,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,8)=%
"RTN","PRCPLO2A",172,0)
 ;ODI Long Supply %
"RTN","PRCPLO2A",173,0)
 S %=$S('$G(^TMP($J,3,"VALUE","TOTAL")):0,1:$G(^TMP($J,3,"LONG","TOTAL"))/$G(^TMP($J,3,"VALUE","TOTAL")))
"RTN","PRCPLO2A",174,0)
 I $P(%,".",2) S %=$P(%,".",1)_"."_$E($P(%,".",2),1,2)
"RTN","PRCPLO2A",175,0)
 I %="" S %=0
"RTN","PRCPLO2A",176,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,9)=%
"RTN","PRCPLO2A",177,0)
 ;All Long Supply %
"RTN","PRCPLO2A",178,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,10)=+$G(^TMP($J,1,"CNT","TOTAL"))
"RTN","PRCPLO2A",179,0)
 ;# Std. Items
"RTN","PRCPLO2A",180,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,11)=+$G(^TMP($J,2,"CNT","TOTAL"))
"RTN","PRCPLO2A",181,0)
 ;# On-Demand Items
"RTN","PRCPLO2A",182,0)
 S $P(^TMP($J,"PRCPSSR5",STA,INV),U,12)=+$G(^TMP($J,3,"CNT","TOTAL"))
"RTN","PRCPLO2A",183,0)
 ;# All Items
"RTN","PRCPLO2A",184,0)
 ;
"RTN","PRCPLO2A",185,0)
 S PRCPDX=$TR(^TMP($J,"PRCPSSR5",STA,INV),"^","*"),DR="7///"_PRCPDX
"RTN","PRCPLO2A",186,0)
 D FILE
"RTN","PRCPLO2A",187,0)
 K Y
"RTN","PRCPLO2A",188,0)
 ;
"RTN","PRCPLO2A",189,0)
 Q
"RTN","PRCPLO2A",190,0)
 ;
"RTN","PRCPLO2A",191,0)
 ;*98 Created filing subroutine
"RTN","PRCPLO2A",192,0)
FILE ; Subroutine that creates entries in File #446.7 fields as they 
"RTN","PRCPLO2A",193,0)
 ; are created
"RTN","PRCPLO2A",194,0)
 ;
"RTN","PRCPLO2A",195,0)
 N PRCPDR,PRCPSNM,PRCPDA,PRCPDX,X,Y
"RTN","PRCPLO2A",196,0)
 S PRCPDR=DR
"RTN","PRCPLO2A",197,0)
 S SSRIEN=STA_INV
"RTN","PRCPLO2A",198,0)
 S DIC="^PRCP(446.7,",DIC(0)="L",DLAYGO=446.7,X=SSRIEN D ^DIC K DIC,DLAYGO
"RTN","PRCPLO2A",199,0)
 S PRCPDA=Y+0
"RTN","PRCPLO2A",200,0)
 ;*98 Send enhanced mail message if exception occurs during FileMan set
"RTN","PRCPLO2A",201,0)
 I Y=-1 N PRCPMSG D  Q
"RTN","PRCPLO2A",202,0)
 . S PRCPMSG(1)="Error saving to File #446.7 for Stock Status Report, related data: "
"RTN","PRCPLO2A",203,0)
 . S PRCPSNM=$$GET1^DIQ(4,STA_",",.01)
"RTN","PRCPLO2A",204,0)
 . S PRCPMSG(2)="",PRCPMSG(3)="Station: "_STA_" "_PRCPSNM
"RTN","PRCPLO2A",205,0)
 . S PRCPMSG(4)="Inventory Point: "_$P(^TMP($J,"PRCPSSR1",STA,INV),U,4)_" "_$P(^TMP($J,"PRCPSSR1",STA,INV),U,5)
"RTN","PRCPLO2A",206,0)
 . S PRCPMSG(5)="File #446.7 Field Set Attempted: "_PRCPDR
"RTN","PRCPLO2A",207,0)
 . D MAIL^PRCPLO3 Q
"RTN","PRCPLO2A",208,0)
 ;
"RTN","PRCPLO2A",209,0)
 S DIE="^PRCP(446.7,",DA=PRCPDA D ^DIE K DIE,DR,DA
"RTN","PRCPLO2A",210,0)
 ;
"RTN","PRCPLO2A",211,0)
 Q
"RTN","PRCPLO3")
0^11^B36921649^B12210109
"RTN","PRCPLO3",1,0)
PRCPLO3 ;WOIFO/DAP/RLL-manual run option for GIP reports ; 7/28/06 10:39am
"RTN","PRCPLO3",2,0)
V ;;5.1;IFCAP;**83,98**;Oct 20, 2000;Build 37
"RTN","PRCPLO3",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPLO3",4,0)
 ;
"RTN","PRCPLO3",5,0)
ENT ;This section of the routine executes calls to the separate CLRS GIP
"RTN","PRCPLO3",6,0)
 ;extract routines.
"RTN","PRCPLO3",7,0)
 ;
"RTN","PRCPLO3",8,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,PRCPSSR,ZTSK,ZTREQ,PRCPMSG
"RTN","PRCPLO3",9,0)
 S ZTRTN="ENT^PRCPLO2"
"RTN","PRCPLO3",10,0)
 S ZTDESC="PRCPLO CLO GIP Reports CLRS"
"RTN","PRCPLO3",11,0)
 S ZTDTH=$H
"RTN","PRCPLO3",12,0)
 S ZTREQ="@"
"RTN","PRCPLO3",13,0)
 S ZTIO=""
"RTN","PRCPLO3",14,0)
 D ^%ZTLOAD
"RTN","PRCPLO3",15,0)
 S PRCPSSR=ZTSK
"RTN","PRCPLO3",16,0)
 ; Calls mail group message generation and screen display with success
"RTN","PRCPLO3",17,0)
 ; or exception notification
"RTN","PRCPLO3",18,0)
 I $D(PRCPSSR)[0 S PRCPMSG(1)="A task could not be created for the CLO GIP Reports - please contact IRM." D MAIL W ! D EN^DDIOL(PRCPMSG(1)) Q
"RTN","PRCPLO3",19,0)
 ;
"RTN","PRCPLO3",20,0)
 S PRCPMSG(1)="Task # "_PRCPSSR_" entered for the CLO GIP Reports."
"RTN","PRCPLO3",21,0)
 W !
"RTN","PRCPLO3",22,0)
 D EN^DDIOL(PRCPMSG(1))
"RTN","PRCPLO3",23,0)
 D MAIL
"RTN","PRCPLO3",24,0)
 ;
"RTN","PRCPLO3",25,0)
 Q
"RTN","PRCPLO3",26,0)
 ;
"RTN","PRCPLO3",27,0)
MAIL ; Builds mail messages to a defined mail group to notify users of the 
"RTN","PRCPLO3",28,0)
 ; success or failure of the TaskMan scheduling for the CLO GIP Reports.
"RTN","PRCPLO3",29,0)
 ;
"RTN","PRCPLO3",30,0)
 ;*98 Modified code to work with PRC CLRS OUTLOOK MAILGROUP parameter
"RTN","PRCPLO3",31,0)
 N XMDUZ,XMMG,XMSUB,XMTEXT,XMY,XMZ,PRCPMG,PRCPMG2
"RTN","PRCPLO3",32,0)
 S XMSUB="CLO GIP Report Status for "_$$HTE^XLFDT($H)
"RTN","PRCPLO3",33,0)
 S XMDUZ="Clinical Logistics Report Server"
"RTN","PRCPLO3",34,0)
 S XMTEXT="PRCPMSG("
"RTN","PRCPLO3",35,0)
 S XMY("G.PRCPLO CLRS NOTIFICATIONS")=""
"RTN","PRCPLO3",36,0)
 S PRCPMG=$$GET^XPAR("SYS","PRC CLRS OUTLOOK MAILGROUP",1,"Q")
"RTN","PRCPLO3",37,0)
 S:$G(PRCPMG)'="" PRCPMG2="S XMY("""_PRCPMG_""")=""""" X PRCPMG2
"RTN","PRCPLO3",38,0)
 ;
"RTN","PRCPLO3",39,0)
 D ^XMD
"RTN","PRCPLO3",40,0)
 Q
"RTN","PRCPLO3",41,0)
 ; 
"RTN","PRCPLO3",42,0)
BLDGP2 ; Build the DAYS of stock on hand file
"RTN","PRCPLO3",43,0)
 N FILEDIR,STID,FILG2
"RTN","PRCPLO3",44,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCPLO3",45,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCPLO3",46,0)
 S FILG2="IFCP"_STID_"G2.TXT"
"RTN","PRCPLO3",47,0)
 D OPEN^%ZISH("FILE1",FILEDIR,FILG2,"W")
"RTN","PRCPLO3",48,0)
 ; D OPEN^%ZISH("FILE1",FILEDIR,"CLRSG2.TXT","W")
"RTN","PRCPLO3",49,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCPLO3",50,0)
 D GTGIPSOH  ; *98 New version
"RTN","PRCPLO3",51,0)
 D GTGIPSOD  ; *98 New version
"RTN","PRCPLO3",52,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCPLO3",53,0)
 Q
"RTN","PRCPLO3",54,0)
BLDGP1 ; BUILD THE stock status file
"RTN","PRCPLO3",55,0)
 N FILEDIR,STID,FILG1
"RTN","PRCPLO3",56,0)
 S FILEDIR=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCPLO3",57,0)
 S STID=$$GET1^DIQ(4,$$KSP^XUPARAM("INST")_",",99)
"RTN","PRCPLO3",58,0)
 S FILG1="IFCP"_STID_"G1.TXT"
"RTN","PRCPLO3",59,0)
 D OPEN^%ZISH("FILE1",FILEDIR,FILG1,"W")
"RTN","PRCPLO3",60,0)
 ; D OPEN^%ZISH("FILE1",FILEDIR,"CLRSG1.DAT","W")
"RTN","PRCPLO3",61,0)
 D USE^%ZISUTL("FILE1")
"RTN","PRCPLO3",62,0)
 ; D GETGIPH2
"RTN","PRCPLO3",63,0)
 ; D GETGIPSF
"RTN","PRCPLO3",64,0)
 D GTGIPSSH  ; *98, New version
"RTN","PRCPLO3",65,0)
 D GTGIPSSD  ; *98, New version
"RTN","PRCPLO3",66,0)
 D CLOSE^%ZISH("FILE1")
"RTN","PRCPLO3",67,0)
 Q
"RTN","PRCPLO3",68,0)
GETGIPSF ; Get the GIP stock status data from file 446.7 (old format)
"RTN","PRCPLO3",69,0)
 N GT1,GT2,GT3,GT4
"RTN","PRCPLO3",70,0)
 S GT1="",GT2="",GT3=""
"RTN","PRCPLO3",71,0)
 F  S GT1=$O(^PRCP(446.7,GT1)) Q:GT1=""  D
"RTN","PRCPLO3",72,0)
 . S GT2=$G(^PRCP(446.7,GT1,2))
"RTN","PRCPLO3",73,0)
 . I $P(GT2,"*",2)'="" W GT2,!
"RTN","PRCPLO3",74,0)
 . Q
"RTN","PRCPLO3",75,0)
 Q
"RTN","PRCPLO3",76,0)
GTGIPSOD ; *98 Get the GIP Stock on Hand Data new (new format)
"RTN","PRCPLO3",77,0)
 ;
"RTN","PRCPLO3",78,0)
 N GT1,GT2,DT3
"RTN","PRCPLO3",79,0)
 S GT1="",GT2="",DT3=""
"RTN","PRCPLO3",80,0)
 F  S GT1=$O(^PRCP(446.7,GT1)) Q:GT1=""  D
"RTN","PRCPLO3",81,0)
 . S GT2=$G(^PRCP(446.7,GT1,1))_"*"
"RTN","PRCPLO3",82,0)
 . S DT3=$G(^PRCP(446.7,GT1,2))
"RTN","PRCPLO3",83,0)
 . I $P(GT2,"*",2)'="" W !,GT2,DT3
"RTN","PRCPLO3",84,0)
 . Q
"RTN","PRCPLO3",85,0)
 Q
"RTN","PRCPLO3",86,0)
GTGIPSSD ; *98 Get GIP Stock Status data (new format)
"RTN","PRCPLO3",87,0)
 N GT1,GT2,DT3,DT4,DT5,DT6,DT7
"RTN","PRCPLO3",88,0)
 S GT1="",GT2="",DT3="",DT4="",DT5="",DT6="",DT7=""
"RTN","PRCPLO3",89,0)
 F  S GT1=$O(^PRCP(446.7,GT1)) Q:GT1=""  D
"RTN","PRCPLO3",90,0)
 . S GT2=$G(^PRCP(446.7,GT1,3))_"*"
"RTN","PRCPLO3",91,0)
 . S DT4=$G(^PRCP(446.7,GT1,4))_"*"
"RTN","PRCPLO3",92,0)
 . S DT5=$G(^PRCP(446.7,GT1,5))_"*"
"RTN","PRCPLO3",93,0)
 . S DT6=$G(^PRCP(446.7,GT1,6))_"*"
"RTN","PRCPLO3",94,0)
 . S DT7=$G(^PRCP(446.7,GT1,7))
"RTN","PRCPLO3",95,0)
 . I $P(GT2,"*",2)'="" W !,GT2,DT4,DT5,DT6,DT7
"RTN","PRCPLO3",96,0)
 . Q
"RTN","PRCPLO3",97,0)
 Q
"RTN","PRCPLO3",98,0)
GETGIPH1 ; Header for stock on hand report (old format)
"RTN","PRCPLO3",99,0)
 ;
"RTN","PRCPLO3",100,0)
 W "StationNum"_"*"_"DateRange"_"*"_"InvIdNum"_"*"
"RTN","PRCPLO3",101,0)
 W "InventoryPoint"_"*"_"InventoryType"_"*"_"TotalDollars"_"*"
"RTN","PRCPLO3",102,0)
 W "NumOfLineItemsSoh"_"*"_"NumOfLineItemsInv"_"*"_"CostCenter",!
"RTN","PRCPLO3",103,0)
 Q
"RTN","PRCPLO3",104,0)
GTGIPSOH ; *98 Header for stock on hand report (new format)
"RTN","PRCPLO3",105,0)
 ;
"RTN","PRCPLO3",106,0)
 W "StationNum"_"*"_"DateRange"_"*"_"InvIdNum"_"*"
"RTN","PRCPLO3",107,0)
 W "InventoryPoint"_"*"_"InventoryType"_"*"_"TotalDollars"_"*"
"RTN","PRCPLO3",108,0)
 W "NumOfLineItemsSoh"_"*"_"NumOfLineItemsInv"_"*"_"CostCenter"_"*"
"RTN","PRCPLO3",109,0)
 W "StdTotDolVal"_"*"_"OdiTotDolVal"_"*"_"AllTotDolVal"_"*"
"RTN","PRCPLO3",110,0)
 W "StdNumSohItems"_"*"_"OdiNumSohItems"_"*"_"AllNumSohItems"_"*"
"RTN","PRCPLO3",111,0)
 W "StdNumInvItems"_"*"_"OdiNumInvItems"_"*"_"AllNumInvItems"
"RTN","PRCPLO3",112,0)
 Q
"RTN","PRCPLO3",113,0)
GETGIPH2 ; Header for Stock Status Report
"RTN","PRCPLO3",114,0)
 W "StationNum"_"*"_"DateRange"_"*"_"NumDays"_"*"
"RTN","PRCPLO3",115,0)
 W "InvIdNum"_"*"_"InventoryPoint"_"*"_"InventoryType"_"*"_"OpenBalTotal"_"*"_"ReceiptsTot"_"*"
"RTN","PRCPLO3",116,0)
 W "IssuesTotal"_"*"_"AdjTotal"_"*"_"ClosingBalTot"_"*"
"RTN","PRCPLO3",117,0)
 W "ReceiptsTot#"_"*"_"IssuesTotal#"_"*"_"AdjTotal#"_"*"
"RTN","PRCPLO3",118,0)
 W "TurnoverTotal"_"*"_"InactiveItmTotal#"_"*"_"InactiveItemTotal$"
"RTN","PRCPLO3",119,0)
 W "*"_"InactiveItemsPct"_"*"_"LongSupplyTotal#"_"*"_"LongSupplyTotal$"
"RTN","PRCPLO3",120,0)
 W "*"_"LongSupplyPct"_"*"_"NumOfLineItemsInv",!
"RTN","PRCPLO3",121,0)
 Q
"RTN","PRCPLO3",122,0)
GETGIPF ; Get the GIP days of stock on hand data from File 446.7 (old format)
"RTN","PRCPLO3",123,0)
 ;
"RTN","PRCPLO3",124,0)
 N GP1,GP2,GP3
"RTN","PRCPLO3",125,0)
 S GP1=0,GP2=0,GP3=0
"RTN","PRCPLO3",126,0)
 F  S GP1=$O(^PRCP(446.7,GP1)) Q:GP1=""  D
"RTN","PRCPLO3",127,0)
 . S GP2=$G(^PRCP(446.7,GP1,1))
"RTN","PRCPLO3",128,0)
 . I $P(GP2,"*",1)'="" W GP2,!
"RTN","PRCPLO3",129,0)
 . Q
"RTN","PRCPLO3",130,0)
 Q
"RTN","PRCPLO3",131,0)
GTGIPSSH ; *98 NEW Stock Status Report Header
"RTN","PRCPLO3",132,0)
 ; Additional Fields were added to accommodate
"RTN","PRCPLO3",133,0)
 ; Standard Items and On Demand Items
"RTN","PRCPLO3",134,0)
 W "StNum"_"*"_"DtRng"_"*"_"NmDys"_"*"
"RTN","PRCPLO3",135,0)
 W "InvIdNum"_"*"_"InvPnt"_"*"_"InvTyp"_"*"
"RTN","PRCPLO3",136,0)
 W "StdOpnBalTot"_"*"_"OdiOpnBalTot"_"*"_"AllOpnBalTot"_"*"
"RTN","PRCPLO3",137,0)
 W "StdRcptsTot"_"*"_"OdiRcptsTot"_"*"_"AllRcptsTot"_"*"
"RTN","PRCPLO3",138,0)
 W "StdIssTot"_"*"_"OdiIssTot"_"*"_"AllIssTot"_"*"
"RTN","PRCPLO3",139,0)
 W "StdAdjTot"_"*"_"OdiAdjTot"_"*"_"AllAdjTot"_"*"
"RTN","PRCPLO3",140,0)
 W "StdClseBalTot"_"*"_"OdiClseBalTot"_"*"_"AllClseBalTo"_"*"
"RTN","PRCPLO3",141,0)
 W "NumStdRcpts"_"*"_"NumOdiRcpts"_"*"_"NumAllRcpts"_"*"
"RTN","PRCPLO3",142,0)
 W "NumStdIss"_"*"_"NumOdiIss"_"*"_"NumAllIss"_"*"
"RTN","PRCPLO3",143,0)
 W "NumStdAdj"_"*"_"NumOdiAdj"_"*"_"NumAllAdj"_"*"
"RTN","PRCPLO3",144,0)
 W "StdTrnvrTot"_"*"_"OdiTrnvrTot"_"*"_"AllTrnvrTot"_"*"
"RTN","PRCPLO3",145,0)
 W "NumStdInactItms"_"*"_"NumOdiInactItms"_"*"_"NumAllInactItms"_"*"
"RTN","PRCPLO3",146,0)
 W "StdInactTotDol"_"*"_"OdiInactTotDol"_"*"_"AllInactTotDol"_"*"
"RTN","PRCPLO3",147,0)
 W "StdInactPct"_"*"_"OdiInactPct"_"*"_"AllInactPct"_"*"
"RTN","PRCPLO3",148,0)
 ;
"RTN","PRCPLO3",149,0)
 W "StdNumLngSup"_"*"_"OdiNumLngSup"_"*"_"AllNumLngSup"_"*"
"RTN","PRCPLO3",150,0)
 W "StdLngSupTotDol"_"*"_"OdiLngSupTotDol"_"*"_"AllLngSupTotDol"_"*"
"RTN","PRCPLO3",151,0)
 W "StdLngSupPct"_"*"_"OdiLngSupPct"_"*"_"AllLngSupPct"_"*"
"RTN","PRCPLO3",152,0)
 W "NumStdInvLnItms"_"*"_"NumOdiInvLnItms"_"*"_"NumAllInvLnItms"
"RTN","PRCPLO3",153,0)
 ;
"RTN","PRCPLO3",154,0)
 ;
"RTN","PRCPLO3",155,0)
 Q
"RTN","PRCPLO4")
0^14^B35020662^B15950699
"RTN","PRCPLO4",1,0)
PRCPLO4 ;WOIFO/DAP- Option to allow users to set CLRS parameters ; 10/19/06 8:44am
"RTN","PRCPLO4",2,0)
V ;;5.1;IFCAP;**83,98**;Oct 20, 2000;Build 37
"RTN","PRCPLO4",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPLO4",4,0)
 ;
"RTN","PRCPLO4",5,0)
ENT ;This allows users to enter new values for the parameters associated 
"RTN","PRCPLO4",6,0)
 ;with the Clinical Logistics Report Server by prompting them for 
"RTN","PRCPLO4",7,0)
 ;a new value for each parameter after presenting the current value.  
"RTN","PRCPLO4",8,0)
 ;Values are screened for validity and errors in setting the parameters 
"RTN","PRCPLO4",9,0)
 ;are returned to the screen. IA #2263 can be referenced for further 
"RTN","PRCPLO4",10,0)
 ;information on the ^XPAR calls utilized here.
"RTN","PRCPLO4",11,0)
 ;  
"RTN","PRCPLO4",12,0)
 N PRCP1,PRCP2,PRCP3,PRCP4,PRCP5,PRCP6,PRCPW,PRCPU,PRCPV,PRCPX,PRCPY,PRCPZ,ERR
"RTN","PRCPLO4",13,0)
 D PRR I ERR Q
"RTN","PRCPLO4",14,0)
 D PGR I ERR Q
"RTN","PRCPLO4",15,0)
 D PIR I ERR Q
"RTN","PRCPLO4",16,0)
 D PED I ERR Q
"RTN","PRCPLO4",17,0)
 ;
"RTN","PRCPLO4",18,0)
 ;*98 Added logic for modification of PRC CLRS ADDRESS and 
"RTN","PRCPLO4",19,0)
 ;PRC CLRS OUTLOOK MAILGROUP parameters
"RTN","PRCPLO4",20,0)
 ;
"RTN","PRCPLO4",21,0)
 D PAD I ERR Q
"RTN","PRCPLO4",22,0)
 D POG I ERR Q
"RTN","PRCPLO4",23,0)
 Q
"RTN","PRCPLO4",24,0)
 ;
"RTN","PRCPLO4",25,0)
PRR ;Provide current value of and then prompt to modify the PRCPLO REPORT RANGE parameter
"RTN","PRCPLO4",26,0)
 ;
"RTN","PRCPLO4",27,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",28,0)
 S ERR=0
"RTN","PRCPLO4",29,0)
 S DIR(0)="NOA^0:999",DIR("A")="Stock On Hand Report Range: "
"RTN","PRCPLO4",30,0)
 S PRCP1=$$GET^XPAR("SYS","PRCPLO REPORT RANGE",1,"Q")
"RTN","PRCPLO4",31,0)
 I PRCP1'="" S DIR("B")=PRCP1
"RTN","PRCPLO4",32,0)
 S DIR("?")="Please enter a number between 0 and 999 with no decimal digits"
"RTN","PRCPLO4",33,0)
 D ^DIR I $D(DUOUT)!$D(DTOUT) S ERR=1 Q
"RTN","PRCPLO4",34,0)
 I PRCP1=X Q
"RTN","PRCPLO4",35,0)
 I X'="@" S PRCP1=X
"RTN","PRCPLO4",36,0)
 I X="@" D EN^DDIOL("Deletions not allowed") G PRR
"RTN","PRCPLO4",37,0)
 K DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",38,0)
 D EN^XPAR("SYS","PRCPLO REPORT RANGE",1,PRCP1,.PRCPX)
"RTN","PRCPLO4",39,0)
 I PRCPX=0 W ! D EN^DDIOL("Stock on Hand Report Range successfully set to "_PRCP1)
"RTN","PRCPLO4",40,0)
 I PRCPX'=0 W ! D EN^DDIOL("Error while trying to edit the Stock on Hand Report Range:") W ! D EN^DDIOL($P(PRCPX,"^",2))
"RTN","PRCPLO4",41,0)
 Q
"RTN","PRCPLO4",42,0)
 ;
"RTN","PRCPLO4",43,0)
PIR ;Provide current value of and then prompt to modify the PRCPLO INACTIVITY RANGE parameter
"RTN","PRCPLO4",44,0)
 ;
"RTN","PRCPLO4",45,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",46,0)
 S ERR=0
"RTN","PRCPLO4",47,0)
 S DIR(0)="NOA^0:999",DIR("A")="Stock Status Report Inactivity Range: "
"RTN","PRCPLO4",48,0)
 S PRCP2=$$GET^XPAR("SYS","PRCPLO INACTIVITY RANGE",1,"Q")
"RTN","PRCPLO4",49,0)
 I PRCP2'="" S DIR("B")=PRCP2
"RTN","PRCPLO4",50,0)
 S DIR("?")="Please enter a number between 0 and 999 with no decimal digits"
"RTN","PRCPLO4",51,0)
 D ^DIR I $D(DUOUT)!$D(DTOUT) S ERR=1 Q
"RTN","PRCPLO4",52,0)
 I PRCP2=X Q
"RTN","PRCPLO4",53,0)
 I X'="@" S PRCP2=X
"RTN","PRCPLO4",54,0)
 I X="@" D EN^DDIOL("Deletions not allowed")  G PIR
"RTN","PRCPLO4",55,0)
 K DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",56,0)
 D EN^XPAR("SYS","PRCPLO INACTIVITY RANGE",1,PRCP2,.PRCPY)
"RTN","PRCPLO4",57,0)
 I PRCPY=0 W ! D EN^DDIOL("Stock Status Report Inactivity Range successfully set to "_PRCP2)
"RTN","PRCPLO4",58,0)
 I PRCPY'=0 W ! D EN^DDIOL("Error while trying to edit the Stock Status Report Inactivity Range:") W ! D EN^DDIOL($P(PRCPY,"^",2))
"RTN","PRCPLO4",59,0)
 Q
"RTN","PRCPLO4",60,0)
 ;
"RTN","PRCPLO4",61,0)
PGR ;Provide current value of and then prompt to modify the PRCPLO GREATER THAN RANGE parameter
"RTN","PRCPLO4",62,0)
 ;
"RTN","PRCPLO4",63,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",64,0)
 S ERR=0
"RTN","PRCPLO4",65,0)
 S DIR(0)="NOA^0:999",DIR("A")="Stock On Hand Report Greater Than Range: "
"RTN","PRCPLO4",66,0)
 S PRCP3=$$GET^XPAR("SYS","PRCPLO GREATER THAN RANGE",1,"Q")
"RTN","PRCPLO4",67,0)
 I PRCP3'="" S DIR("B")=PRCP3
"RTN","PRCPLO4",68,0)
 S DIR("?")="Please enter a number between 0 and 999 with no decimal digits"
"RTN","PRCPLO4",69,0)
 D ^DIR I $D(DUOUT)!$D(DTOUT) S ERR=1 Q
"RTN","PRCPLO4",70,0)
 I PRCP3=X Q
"RTN","PRCPLO4",71,0)
 I X'="@" S PRCP3=X
"RTN","PRCPLO4",72,0)
 I X="@" D EN^DDIOL("Deletions not allowed") G PGR
"RTN","PRCPLO4",73,0)
 K DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",74,0)
 D EN^XPAR("SYS","PRCPLO GREATER THAN RANGE",1,PRCP3,.PRCPZ)
"RTN","PRCPLO4",75,0)
 I PRCPZ=0 W ! D EN^DDIOL("Stock on Hand Report Greater Than Range successfully set to "_PRCP3)
"RTN","PRCPLO4",76,0)
 I PRCPZ'=0 W ! D EN^DDIOL("Error while trying to edit the Stock on Hand Report Greater Than Range:") W ! D EN^DDIOL($P(PRCPZ,"^",2))
"RTN","PRCPLO4",77,0)
 ;
"RTN","PRCPLO4",78,0)
 Q
"RTN","PRCPLO4",79,0)
 ;
"RTN","PRCPLO4",80,0)
PED ;Provide current value of and then prompt to modify the PRCPLO EXTRACT DIRECTORY parameter
"RTN","PRCPLO4",81,0)
 ;
"RTN","PRCPLO4",82,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",83,0)
 S ERR=0
"RTN","PRCPLO4",84,0)
 S DIR(0)="FOr^1:245",DIR("A")="CLRS Extract Directory"
"RTN","PRCPLO4",85,0)
 S PRCP4=$$GET^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,"Q")
"RTN","PRCPLO4",86,0)
 I PRCP4'="" S DIR("B")=PRCP4
"RTN","PRCPLO4",87,0)
 S DIR("?")="Please enter free text character string between 1 and 245 characters"
"RTN","PRCPLO4",88,0)
 D ^DIR I $D(DUOUT)!$D(DTOUT) S ERR=1 Q
"RTN","PRCPLO4",89,0)
 I PRCP4=X Q
"RTN","PRCPLO4",90,0)
 I X'="@" S PRCP4=X
"RTN","PRCPLO4",91,0)
 I X="@" D EN^DDIOL("Deletions not allowed") G PED
"RTN","PRCPLO4",92,0)
 K DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",93,0)
 D EN^XPAR("SYS","PRCPLO EXTRACT DIRECTORY",1,PRCP4,.PRCPV)
"RTN","PRCPLO4",94,0)
 I PRCP4="@" Q
"RTN","PRCPLO4",95,0)
 I PRCPV=0 W ! D EN^DDIOL("CLRS Extract Directory successfully set to "_PRCP4)
"RTN","PRCPLO4",96,0)
 I PRCPV'=0 W ! D EN^DDIOL("Error while trying to edit the CLRS Extract Directory:") W ! D EN^DDIOL($P(PRCPV,"^",2))
"RTN","PRCPLO4",97,0)
 ;
"RTN","PRCPLO4",98,0)
 Q
"RTN","PRCPLO4",99,0)
 ;
"RTN","PRCPLO4",100,0)
PAD ;Provide current value of and then prompt to modify the PRC CLRS ADDRESS parameter
"RTN","PRCPLO4",101,0)
 ;
"RTN","PRCPLO4",102,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",103,0)
 S ERR=0
"RTN","PRCPLO4",104,0)
 S DIR(0)="FOr^1:245",DIR("A")="CLRS Address"
"RTN","PRCPLO4",105,0)
 S PRCP5=$$GET^XPAR("SYS","PRC CLRS ADDRESS",1,"Q")
"RTN","PRCPLO4",106,0)
 I PRCP5'="" S DIR("B")=PRCP5
"RTN","PRCPLO4",107,0)
 S DIR("?")="Please enter free text character string between 1 and 245 characters"
"RTN","PRCPLO4",108,0)
 D ^DIR I $D(DUOUT)!$D(DTOUT) S ERR=1 Q
"RTN","PRCPLO4",109,0)
 I PRCP5=X Q
"RTN","PRCPLO4",110,0)
 S PRCP5=X
"RTN","PRCPLO4",111,0)
 K DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",112,0)
 D EN^XPAR("SYS","PRC CLRS ADDRESS",1,PRCP5,.PRCPW)
"RTN","PRCPLO4",113,0)
 I PRCP5="@" D EN^DDIOL("  <PRC CLRS ADDRESS deleted>") Q
"RTN","PRCPLO4",114,0)
 I PRCPW=0 W ! D EN^DDIOL("CLRS Address successfully set to "_PRCP5)
"RTN","PRCPLO4",115,0)
 I PRCPW'=0 W ! D EN^DDIOL("Error while trying to edit the CLRS Address:") W ! D EN^DDIOL($P(PRCPW,"^",2))
"RTN","PRCPLO4",116,0)
 ;
"RTN","PRCPLO4",117,0)
 Q
"RTN","PRCPLO4",118,0)
 ;
"RTN","PRCPLO4",119,0)
POG ;Provide current value of and then prompt to modify the PRC CLRS OUTLOOK MAILGROUP parameter
"RTN","PRCPLO4",120,0)
 ;
"RTN","PRCPLO4",121,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",122,0)
 S ERR=0
"RTN","PRCPLO4",123,0)
 S DIR(0)="FOr^1:245",DIR("A")="CLRS Outlook Mail Group"
"RTN","PRCPLO4",124,0)
 S PRCP6=$$GET^XPAR("SYS","PRC CLRS OUTLOOK MAILGROUP",1,"Q")
"RTN","PRCPLO4",125,0)
 I PRCP6'="" S DIR("B")=PRCP6
"RTN","PRCPLO4",126,0)
 S DIR("?")="Please enter free text character string between 1 and 245 characters"
"RTN","PRCPLO4",127,0)
 D ^DIR I $D(DUOUT)!$D(DTOUT) S ERR=1 Q
"RTN","PRCPLO4",128,0)
 I PRCP6=X Q
"RTN","PRCPLO4",129,0)
 S PRCP6=X
"RTN","PRCPLO4",130,0)
 K DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PRCPLO4",131,0)
 D EN^XPAR("SYS","PRC CLRS OUTLOOK MAILGROUP",1,PRCP6,.PRCPU)
"RTN","PRCPLO4",132,0)
 I PRCP6="@" D EN^DDIOL("  <PRC CLRS OUTLOOK MAILGROUP deleted>") Q
"RTN","PRCPLO4",133,0)
 I PRCPU=0 W ! D EN^DDIOL("CLRS Outlook Mail Group successfully set to "_PRCP6)
"RTN","PRCPLO4",134,0)
 I PRCPU'=0 W ! D EN^DDIOL("Error while trying to edit the CLRS Outlook Mail Group:") W ! D EN^DDIOL($P(PRCPU,"^",2))
"RTN","PRCPLO4",135,0)
 ;
"RTN","PRCPLO4",136,0)
 Q
"RTN","PRCPRAIP")
0^15^B18810373^B14911054
"RTN","PRCPRAIP",1,0)
PRCPRAIP ;WISC/RFJ/DST-abbreviated item report (primary, second)        ;09 Jun 93
"RTN","PRCPRAIP",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRAIP",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRAIP",4,0)
 Q
"RTN","PRCPRAIP",5,0)
 ;
"RTN","PRCPRAIP",6,0)
 ;
"RTN","PRCPRAIP",7,0)
PRIMARY ;  abbreviated item report for primary and secondary
"RTN","PRCPRAIP",8,0)
 N GROUPALL,X
"RTN","PRCPRAIP",9,0)
 N ODI,ODIS  ; for On-Demand Item 
"RTN","PRCPRAIP",10,0)
 K X S X(1)="The Abbreviated Item Report will sort the Primary or Secondary inventory items by the group category code and description." D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRAIP",11,0)
 K X S X(1)="Select the Group Categories to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRAIP",12,0)
 D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRAIP",13,0)
 I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) W !,"*** NO GROUP CATEGORIES SELECTED !" D Q Q
"RTN","PRCPRAIP",14,0)
 W !,"NOTE:  The report will",$S('$G(GROUPALL):" NOT",1:"")," include items not stored in a group category."
"RTN","PRCPRAIP",15,0)
 ; Prompt for On-Demand Item selection
"RTN","PRCPRAIP",16,0)
 S ODIS=$$ODIPROM^PRCPUX2(0)
"RTN","PRCPRAIP",17,0)
 I 'ODIS D Q Q
"RTN","PRCPRAIP",18,0)
 ;
"RTN","PRCPRAIP",19,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRAIP",20,0)
 .   S ZTDESC="Abbreviated Item Report",ZTRTN="DQ^PRCPRAIP"
"RTN","PRCPRAIP",21,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("GROUPALL")="",ZTSAVE("ODIS")="",ZTSAVE("^TMP($J,""PRCPURS1"",")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRAIP",22,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRAIP",23,0)
DQ ;  queue starts here
"RTN","PRCPRAIP",24,0)
 N %,%H,%I,GROUP,GROUPNM,DESCR,ITEMDA,ITEMDATA,NOW,PAGE,PRCPFLAG,SCREEN,X,Y
"RTN","PRCPRAIP",25,0)
 K ^TMP($J,"PRCPRAIP")
"RTN","PRCPRAIP",26,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  D
"RTN","PRCPRAIP",27,0)
 .   S ITEMDATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0))
"RTN","PRCPRAIP",28,0)
 .   S GROUP=+$P(ITEMDATA,"^",21)
"RTN","PRCPRAIP",29,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPRAIP",30,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPRAIP",31,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPRAIP",32,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRAIP",33,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRAIP",34,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRAIP",35,0)
 .   S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA) S:DESCR="" DESCR=" "
"RTN","PRCPRAIP",36,0)
 .   S ^TMP($J,"PRCPRAIP",GROUPNM,$E(DESCR,1,15),ITEMDA)=DESCR
"RTN","PRCPRAIP",37,0)
 ;  print report
"RTN","PRCPRAIP",38,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRAIP",39,0)
 S GROUP="" F  S GROUP=$O(^TMP($J,"PRCPRAIP",GROUP)) Q:GROUP=""!($G(PRCPFLAG))  D
"RTN","PRCPRAIP",40,0)
 .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRAIP",41,0)
 .   W !!?5,"GROUP: ",$S(GROUP=" ":"<<NONE>>",1:GROUP)
"RTN","PRCPRAIP",42,0)
 .   S DESCR="" F  S DESCR=$O(^TMP($J,"PRCPRAIP",GROUP,DESCR)) Q:DESCR=""!($G(PRCPFLAG))  S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPRAIP",GROUP,DESCR,ITEMDA)) Q:'ITEMDA!($G(PRCPFLAG))  S X=^(ITEMDA) D
"RTN","PRCPRAIP",43,0)
 .   .   ; Check ODI flag for this item
"RTN","PRCPRAIP",44,0)
 .   .   S ODI=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRAIP",45,0)
 .   .   ; If On-Demand Item display not selected, and is ODI, Quit
"RTN","PRCPRAIP",46,0)
 .   .   Q:(ODIS=1)&(ODI="Y")
"RTN","PRCPRAIP",47,0)
 .   .   ; If only On-Demand Item display selected, and not ODI, Quit
"RTN","PRCPRAIP",48,0)
 .   .   Q:(ODIS=2)&(ODI'="Y")
"RTN","PRCPRAIP",49,0)
 .   .   ;
"RTN","PRCPRAIP",50,0)
 .   .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRAIP",51,0)
 .   .   S ITEMDATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0))
"RTN","PRCPRAIP",52,0)
 .   .   W !,$E(X,1,23),?24,ITEMDA,?31,$S(ODI="Y":"D",1:""),?46,$J(+$P(ITEMDATA,"^",7),8),$J($$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/"),10),$J($$STORAGE^PRCPESTO(PRCP("I"),ITEMDA),16)
"RTN","PRCPRAIP",53,0)
 .   .   S %=0 F  S %=$O(^PRCP(445,PRCP("I"),1,ITEMDA,1,%)) Q:'%!($G(PRCPFLAG))  D
"RTN","PRCPRAIP",54,0)
 .   .   .   I $X>60 W !
"RTN","PRCPRAIP",55,0)
 .   .   .   S X=$E($$STORELOC^PRCPESTO(%),1,15),X="     "_X_$E("               ",$L(X)+1,15)
"RTN","PRCPRAIP",56,0)
 .   .   .   W X
"RTN","PRCPRAIP",57,0)
 .   .   .   I $X>60,$Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRAIP",58,0)
 .   I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>"
"RTN","PRCPRAIP",59,0)
 I '$G(PRCPFLAG) D END^PRCPUREP
"RTN","PRCPRAIP",60,0)
Q D ^%ZISC K ^TMP($J,"PRCPRAIP"),^TMP($J,"PRCPURS1")
"RTN","PRCPRAIP",61,0)
 Q
"RTN","PRCPRAIP",62,0)
 ;
"RTN","PRCPRAIP",63,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRAIP",64,0)
 W $C(13),"ABBREVIATED ITEM REPORT FOR: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRAIP",65,0)
 S %="",$P(%,"-",81)=""
"RTN","PRCPRAIP",66,0)
 W !,$S(ODIS=2:"ON-DEMAND ITEMS ONLY",ODIS=3:"ALL ITEMS (STANDARD AND ON-DEMAND)",1:"STANDARD ITEMS ONLY")
"RTN","PRCPRAIP",67,0)
 W !,"DESCRIPTION",?24,"IM",?31,$S(ODIS>1:"OD",1:""),?41,$J("QTY OH",13),$J("UNIT/IS",10),$J("MAIN STORAGE",16),!?5,"ADD STORAGE",?26,"ADD STORAGE",?46,"ADD STORAGE",?66,"ADD STORAGE",!,%
"RTN","PRCPRAIP",68,0)
 Q
"RTN","PRCPRAL1")
0^16^B23523734^B20213439
"RTN","PRCPRAL1",1,0)
PRCPRAL1 ;WISC/RFJ/DST-automatic level setter (print report)            ;28 Dec 93
"RTN","PRCPRAL1",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRAL1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRAL1",4,0)
 Q
"RTN","PRCPRAL1",5,0)
 ;
"RTN","PRCPRAL1",6,0)
 ;
"RTN","PRCPRAL1",7,0)
PRINT ;  print report
"RTN","PRCPRAL1",8,0)
 N %,AVERAGE,DATE,DESCR,GROUP,GROUPNM,ITEMDA,ITEMDATA,NOW,NSN,PAGE,PRCPFLAG,PRCPFNOT,PRCPNESL,PRCPNNSL,PRCPNORP,PRCPNSRP,PRCPSTDD,SCREEN,SORT,TOTAL,Y
"RTN","PRCPRAL1",9,0)
 N ODI  ; On-Demand Item flag
"RTN","PRCPRAL1",10,0)
 K ^TMP($J,"PRCPRALS")
"RTN","PRCPRAL1",11,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  D
"RTN","PRCPRAL1",12,0)
 .   I $G(PRCPFITM),'$D(^TMP($J,"PRCPURS4",ITEMDA)),'$G(PRCPALLI) Q
"RTN","PRCPRAL1",13,0)
 .   S ITEMDATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0))
"RTN","PRCPRAL1",14,0)
 .   S GROUP=+$P(ITEMDATA,"^",21)
"RTN","PRCPRAL1",15,0)
 .   S PRCPFLAG=0
"RTN","PRCPRAL1",16,0)
 .   I '$G(PRCPFITM) D  Q:PRCPFLAG
"RTN","PRCPRAL1",17,0)
 .   .   I 'GROUP,'$G(GROUPALL) S PRCPFLAG=1 Q
"RTN","PRCPRAL1",18,0)
 .   .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) S PRCPFLAG=1 Q
"RTN","PRCPRAL1",19,0)
 .   .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) S PRCPFLAG=1 Q
"RTN","PRCPRAL1",20,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRAL1",21,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRAL1",22,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRAL1",23,0)
 .   S SORT=$S(PRCP("DPTYPE")="W":$$NSN^PRCPUX1(ITEMDA),1:$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,15)) S:SORT="" SORT=" "
"RTN","PRCPRAL1",24,0)
 .   ;  calc daily usage
"RTN","PRCPRAL1",25,0)
 .   S DATE=PRCPSTDT-1,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPRAL1",26,0)
 .   S AVERAGE=$J(TOTAL/PRCPTDAY,0,5)
"RTN","PRCPRAL1",27,0)
 .   S ^TMP($J,"PRCPRALS",GROUPNM,SORT,ITEMDA)=AVERAGE
"RTN","PRCPRAL1",28,0)
 ;  print report
"RTN","PRCPRAL1",29,0)
 K PRCPFLAG
"RTN","PRCPRAL1",30,0)
 S Y=PRCPSTDT_"00" D DD^%DT S PRCPSTDD=Y
"RTN","PRCPRAL1",31,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRAL1",32,0)
 S GROUP="" F  S GROUP=$O(^TMP($J,"PRCPRALS",GROUP)) Q:GROUP=""!($G(PRCPFLAG))  D
"RTN","PRCPRAL1",33,0)
 .   I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRAL1",34,0)
 .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRAL1",35,0)
 .   W !!?5,"GROUP: ",$S(GROUP=" ":"<<NONE>>",1:GROUP)
"RTN","PRCPRAL1",36,0)
 .   S SORT="" F  S SORT=$O(^TMP($J,"PRCPRALS",GROUP,SORT)) Q:SORT=""!($G(PRCPFLAG))  S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPRALS",GROUP,SORT,ITEMDA)) Q:'ITEMDA!($G(PRCPFLAG))  S AVERAGE=^(ITEMDA) D
"RTN","PRCPRAL1",37,0)
 .   .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRAL1",38,0)
 .   .   S ITEMDATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0))
"RTN","PRCPRAL1",39,0)
 .   .   S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA),NSN=$$NSN^PRCPUX1(ITEMDA)
"RTN","PRCPRAL1",40,0)
 .   .   I PRCP("DPTYPE")="W" W !!,NSN,?18,$E(DESCR,1,18)
"RTN","PRCPRAL1",41,0)
 .   .   ; On-Demand Item display
"RTN","PRCPRAL1",42,0)
 .   .   S ODI=""
"RTN","PRCPRAL1",43,0)
 .   .   I PRCP("DPTYPE")'="W" S ODI=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRAL1",44,0)
 .   .   Q:PRCP("DPTYPE")'="W"&((($G(ODIS)=1)&(ODI="Y"))!(($G(ODIS)=2)&(ODI'="Y")))
"RTN","PRCPRAL1",45,0)
 .   .   I PRCP("DPTYPE")'="W" W !!,$E(DESCR,1,18),?25,$S(ODI="Y":"D",1:"")
"RTN","PRCPRAL1",46,0)
 .   .   ;
"RTN","PRCPRAL1",47,0)
 .   .   W ?38,ITEMDA,?45,"OLD",$J(+$P(ITEMDATA,"^",9),8),$J(+$P(ITEMDATA,"^",11),8),$J(+$P(ITEMDATA,"^",10),8),$J(+$P(ITEMDATA,"^",4),8)
"RTN","PRCPRAL1",48,0)
 .   .   I AVERAGE>.06,$G(PRCPFSET) K PRCPFNOT L +^PRCP(445,PRCP("I"),1,ITEMDA,0):5 I '$T S PRCPFNOT=1
"RTN","PRCPRAL1",49,0)
 .   .   W !?3,"AVG USAGE: ",$J(AVERAGE,0,4)
"RTN","PRCPRAL1",50,0)
 .   .   W ?22,$J($S('$G(PRCPFSET):"ESTIMATED VALUES",AVERAGE'>.06:"LOW USAGE (NOT UPDATED)",$G(PRCPFNOT):"UNABLE TO UPDATE (LOCKED)",1:"NEW VALUES"),26),?48
"RTN","PRCPRAL1",51,0)
 .   .   ;  normal stock level
"RTN","PRCPRAL1",52,0)
 .   .   S PRCPNNSL=AVERAGE*PRCPDNSL\1 S:PRCPNNSL>999999 PRCPNNSL=999999 W $J(PRCPNNSL,8)
"RTN","PRCPRAL1",53,0)
 .   .   ;  emergency stock level
"RTN","PRCPRAL1",54,0)
 .   .   S PRCPNESL=$J(PRCPNNSL*PRCPPESL/100,0,0) S:PRCPNESL>999999 PRCPNESL=999999 W $J(PRCPNESL,8)
"RTN","PRCPRAL1",55,0)
 .   .   ;  standard reorder point
"RTN","PRCPRAL1",56,0)
 .   .   S PRCPNSRP=$J(PRCPNNSL*PRCPPSRP/100,0,0) S:PRCPNSRP>999999 PRCPPSRP=999999 W $J(PRCPNSRP,8)
"RTN","PRCPRAL1",57,0)
 .   .   ;  optional reorder point
"RTN","PRCPRAL1",58,0)
 .   .   S PRCPNORP=$J(PRCPNNSL*PRCPPORP/100,0,0) S:PRCPNORP>999999 PRCPNORP=999999 W $J(PRCPNORP,8)
"RTN","PRCPRAL1",59,0)
 .   .   I AVERAGE>.06,$G(PRCPFSET),'$G(PRCPFNOT) S $P(^PRCP(445,PRCP("I"),1,ITEMDA,0),"^",4)=PRCPNORP,$P(^(0),"^",9,11)=PRCPNNSL_"^"_PRCPNSRP_"^"_PRCPNESL L -^PRCP(445,PRCP("I"),1,ITEMDA,0)
"RTN","PRCPRAL1",60,0)
 I '$G(PRCPFLAG) D END^PRCPUREP
"RTN","PRCPRAL1",61,0)
 Q
"RTN","PRCPRAL1",62,0)
 ;
"RTN","PRCPRAL1",63,0)
 ;
"RTN","PRCPRAL1",64,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRAL1",65,0)
 W $C(13),"AUTOMATIC LEVEL SETTER FOR: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRAL1",66,0)
 I PRCP("DPTYPE")'="W",('$D(^TMP($J,"PRCPURS4"))) W !?5,$S(ODIS=2:"ON-DEMAND ITEMS ONLY",ODIS=3:"ALL ITEMS (STANDARD AND ON-DEMAND)",1:"STANDARD ITEMS ONLY")
"RTN","PRCPRAL1",67,0)
 W !?5,"AVG USAGE START DATE: ",PRCPSTDD," (",PRCPTDAY," TOTAL DAYS)"
"RTN","PRCPRAL1",68,0)
 W !?5,"DAYS/PERCENTAGE USED FOR CALCULATION:",?48,$J(PRCPDNSL,8),$J(PRCPPESL_"%",8),$J(PRCPPSRP_"%",8),$J(PRCPPORP_"%",8)
"RTN","PRCPRAL1",69,0)
 S %="",$P(%,"-",81)=""
"RTN","PRCPRAL1",70,0)
 W !?48,$J("NORMAL",8),$J("EMERG",8),$J("STAND",8),$J("OPTION",8),!
"RTN","PRCPRAL1",71,0)
 I PRCP("DPTYPE")="W" W "NSN",?18,"DESCRIPTION"
"RTN","PRCPRAL1",72,0)
 E  W "DESCRIPTION",?25,"OD"
"RTN","PRCPRAL1",73,0)
 W ?38,"IM#",?48,$J("STKLVL",8),$J("STKLVL",8),$J("REO PT",8),$J("REO PT",8),!,%
"RTN","PRCPRAL1",74,0)
 Q
"RTN","PRCPRALS")
0^17^B33007246^B31003101
"RTN","PRCPRALS",1,0)
PRCPRALS ;WISC/RFJ/DST-automatic level setter                           ;28 Dec 93
"RTN","PRCPRALS",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRALS",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRALS",4,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRALS",5,0)
 N %,%DT,%I,DIR,GROUPALL,PRCPALLI,PRCPDNSL,PRCPFITM,PRCPFLAG,PRCPFSET,PRCPPESL,PRCPPORP,PRCPPSRP,PRCPSTDT,PRCPTDAY,X,X1,X2,XH,XP,Y
"RTN","PRCPRALS",6,0)
 N ODIS  ; for On-Demand Item display selection
"RTN","PRCPRALS",7,0)
 K X S X(1)="The Automatic Level Setter will calculate and reset the Normal Stock Level, Emergency Stock Level, Standard Reorder Point, and Optional Reorder Point for selected items or items in selected group categories."
"RTN","PRCPRALS",8,0)
 D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRALS",9,0)
 S DIR(0)="S^1:ITEM;2:GROUP CATEGORY",DIR("A")="Select Items BY",DIR("B")="ITEM" D ^DIR K DIR I Y'=1,Y'=2 Q
"RTN","PRCPRALS",10,0)
 S PRCPFITM=$S(Y=1:1,1:0)
"RTN","PRCPRALS",11,0)
 ;  select items by group
"RTN","PRCPRALS",12,0)
 I 'PRCPFITM D  I $G(PRCPFLAG) D Q Q
"RTN","PRCPRALS",13,0)
 .   K X S X(1)="Select the Group Categories to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRALS",14,0)
 .   D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRALS",15,0)
 .   I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) S PRCPFLAG=1 Q
"RTN","PRCPRALS",16,0)
 .   W !,"NOTE:  The report will",$S('$G(GROUPALL):" NOT",1:"")," include items not stored in a group category."
"RTN","PRCPRALS",17,0)
 ;  select individual items
"RTN","PRCPRALS",18,0)
 I PRCPFITM=1 D ITEMSEL^PRCPURS4 I '$O(^TMP($J,"PRCPURS4",0)),'$D(PRCPALLI) D Q Q
"RTN","PRCPRALS",19,0)
 W !
"RTN","PRCPRALS",20,0)
 ; Prompt for On-Demand Item selection, if not warehouse
"RTN","PRCPRALS",21,0)
 I PRCP("DPTYPE")'="W",('$D(^TMP($J,"PRCPURS4"))) S ODIS=$$ODIPROM^PRCPUX2(0)
"RTN","PRCPRALS",22,0)
 I PRCP("DPTYPE")'="W",('$D(^TMP($J,"PRCPURS4"))),('+$G(ODIS)) D Q Q
"RTN","PRCPRALS",23,0)
 ;
"RTN","PRCPRALS",24,0)
 K X S X(1)="The average daily usage will be calculated from the selected date to the current date." D DISPLAY^PRCPUX2(1,40,.X)
"RTN","PRCPRALS",25,0)
 S X1=DT,X2=-120 D C^%DTC S (X,Y)=$E(X,1,5)_"00" D DD^%DT
"RTN","PRCPRALS",26,0)
 S %DT="AEP",%DT("A")="Start Usage Average with Date (Month Year): ",%DT("B")=Y,%DT(0)=-X D ^%DT K %DT I Y<0 D Q Q
"RTN","PRCPRALS",27,0)
 S PRCPSTDT=$E(Y,1,5),Y=PRCPSTDT_"00" D DD^%DT W !?5,"*** STARTING WITH MO-YR: ",Y," ***"
"RTN","PRCPRALS",28,0)
 S X1=DT,X2=PRCPSTDT_"01" D ^%DTC S PRCPTDAY=X W !?5,"*** TOTAL DAYS: ",PRCPTDAY," ***"
"RTN","PRCPRALS",29,0)
 ;
"RTN","PRCPRALS",30,0)
 K X S X(1)="The normal stock level will be calculated by multiplying the average daily usage by the number of days." D DISPLAY^PRCPUX2(1,40,.X)
"RTN","PRCPRALS",31,0)
 S DIR(0)="N^1:240",DIR("A")="Enter number of days to be on hand for Normal Stock Level"
"RTN","PRCPRALS",32,0)
 S DIR("?",1)="The Normal Stock Level will be set equal to this number multiplied",DIR("?")="by the average usage."
"RTN","PRCPRALS",33,0)
 S DIR("B")=30 D ^DIR K DIR I 'Y D Q Q
"RTN","PRCPRALS",34,0)
 S PRCPDNSL=Y
"RTN","PRCPRALS",35,0)
 ;
"RTN","PRCPRALS",36,0)
 K X S X(1)="The emergency stock level will be calculated by multiplying the average daily usage by this percentage." D DISPLAY^PRCPUX2(1,40,.X)
"RTN","PRCPRALS",37,0)
 S DIR(0)="N^1:100",DIR("A")="Enter the percentage of usage for Emergency Stock Level"
"RTN","PRCPRALS",38,0)
 S DIR("?",1)="The Emergency Stock Level will be set equal to this percentage multiplied",DIR("?")="by the average usage."
"RTN","PRCPRALS",39,0)
 S DIR("B")=20 D ^DIR K DIR I 'Y D Q Q
"RTN","PRCPRALS",40,0)
 S PRCPPESL=Y
"RTN","PRCPRALS",41,0)
 ;
"RTN","PRCPRALS",42,0)
 K X S X(1)="The standard reorder point will be calculated by multiplying the average daily usage by this percentage." D DISPLAY^PRCPUX2(1,40,.X)
"RTN","PRCPRALS",43,0)
 S DIR(0)="N^"_PRCPPESL_":100",DIR("A")="Enter the percentage of usage for Standard Reorder Point"
"RTN","PRCPRALS",44,0)
 S DIR("?",1)="The Standard Reorder Point will be set equal to this percentage multiplied",DIR("?")="by the average usage."
"RTN","PRCPRALS",45,0)
 S DIR("B")=$S(PRCPPESL>50:PRCPPESL,1:50) D ^DIR K DIR I 'Y D Q Q
"RTN","PRCPRALS",46,0)
 S PRCPPSRP=Y
"RTN","PRCPRALS",47,0)
 ;
"RTN","PRCPRALS",48,0)
 K X S X(1)="The optional reorder point will be calculated by multiplying the average daily usage by this percentage." D DISPLAY^PRCPUX2(1,40,.X)
"RTN","PRCPRALS",49,0)
 S DIR(0)="N^"_PRCPPSRP_":100",DIR("A")="Enter the percentage of usage for Optional Reorder Point"
"RTN","PRCPRALS",50,0)
 S DIR("?",1)="The Optional Reorder Point will be set equal to this percentage multiplied",DIR("?")="by the average usage."
"RTN","PRCPRALS",51,0)
 S DIR("B")=$S(PRCPPSRP>75:PRCPPSRP,1:75) D ^DIR K DIR I 'Y D Q Q
"RTN","PRCPRALS",52,0)
 S PRCPPORP=Y
"RTN","PRCPRALS",53,0)
 ;
"RTN","PRCPRALS",54,0)
 I $$KEY^PRCPUREP("PRCP"_$TR(PRCP("DPTYPE"),"WSP","W2")_" MGRKEY",DUZ) D  I %<1 D Q Q
"RTN","PRCPRALS",55,0)
 .   S XP="Do you want to update the levels in the database",XH="Enter 'YES' to update the levels in the database based on my calculations",XH(1)="Enter 'NO' to print estimated levels, '^' to exit."
"RTN","PRCPRALS",56,0)
 .   W ! S %=$$YN^PRCPUYN(2)
"RTN","PRCPRALS",57,0)
 .   I %=1 S PRCPFSET=1
"RTN","PRCPRALS",58,0)
 I '$G(PRCPFSET) W !!,"I will print the current levels versus the estimated levels."
"RTN","PRCPRALS",59,0)
 I $G(PRCPFSET) D
"RTN","PRCPRALS",60,0)
 .   K X S X(1)="WARNING -- Check the changes I make carefully.  Errors in the database can drastically mess up automatic level setting.  As you debug your database I am going to become a trusted friend,"
"RTN","PRCPRALS",61,0)
 .   S X(2)="but always keep an eye on what I am doing because I do not have the common sense that you do."
"RTN","PRCPRALS",62,0)
 .   D DISPLAY^PRCPUX2(5,75,.X)
"RTN","PRCPRALS",63,0)
 ;
"RTN","PRCPRALS",64,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRALS",65,0)
 .   S ZTDESC="Automatic Level Setter",ZTRTN="DQ^PRCPRALS"
"RTN","PRCPRALS",66,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("GROUPALL")="",ZTSAVE("ODIS")="",ZTSAVE("^TMP($J,""PRCPURS1"",")="",ZTSAVE("^TMP($J,""PRCPURS4"",")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRALS",67,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRALS",68,0)
DQ ;  queue starts here
"RTN","PRCPRALS",69,0)
 D PRINT^PRCPRAL1
"RTN","PRCPRALS",70,0)
Q D ^%ZISC K ^TMP($J,"PRCPURS4"),^TMP($J,"PRCPRALS"),^TMP($J,"PRCPURS1")
"RTN","PRCPRALS",71,0)
 Q
"RTN","PRCPRCFP")
0^18^B19712138^B16613428
"RTN","PRCPRCFP",1,0)
PRCPRCFP ;WISC/RFJ/DST-conversion factor report (primary, secondary)    ;09 Jun 93
"RTN","PRCPRCFP",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRCFP",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRCFP",4,0)
 Q
"RTN","PRCPRCFP",5,0)
 ;
"RTN","PRCPRCFP",6,0)
 ;
"RTN","PRCPRCFP",7,0)
PRIMARY ;  conversion factor report for primary and secondary
"RTN","PRCPRCFP",8,0)
 N GROUPALL,X
"RTN","PRCPRCFP",9,0)
 K X S X(1)="The Conversion Factor Report will display the inventory point items with procurement sources and conversion factors."
"RTN","PRCPRCFP",10,0)
 S X(2)="This report will sort the Primary and Secondary inventory items by the Group Category, Description, and Procurement Source."
"RTN","PRCPRCFP",11,0)
 D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRCFP",12,0)
 K X S X(1)="Select the Group Categories to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRCFP",13,0)
 D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRCFP",14,0)
 I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) W !,"*** NO GROUP CATEGORIES SELECTED !" D Q Q
"RTN","PRCPRCFP",15,0)
 W !,"NOTE:  The report will",$S('$G(GROUPALL):" NOT",1:"")," include items not stored in a group category."
"RTN","PRCPRCFP",16,0)
 ; Prompt for On-Demand Item selection, if not warehouse
"RTN","PRCPRCFP",17,0)
 N ODIS
"RTN","PRCPRCFP",18,0)
 S ODIS=$$ODIPROM^PRCPUX2(0)
"RTN","PRCPRCFP",19,0)
 I 'ODIS D Q Q
"RTN","PRCPRCFP",20,0)
 ;
"RTN","PRCPRCFP",21,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRCFP",22,0)
 .   S ZTDESC="Conversion Factor Report",ZTRTN="DQ^PRCPRCFP"
"RTN","PRCPRCFP",23,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("GROUPALL")="",ZTSAVE("ODIS")="",ZTSAVE("^TMP($J,""PRCPURS1"",")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRCFP",24,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRCFP",25,0)
DQ ;  queue starts here
"RTN","PRCPRCFP",26,0)
 N %,%H,%I,DESCR,GROUP,GROUPNM,ITEMDA,ITEMDATA,NOW,NSN,PAGE,PRCPFLAG,SCREEN,VENDATA,VENNM,X,Y
"RTN","PRCPRCFP",27,0)
 N ODI  ; On-Demand Item flag
"RTN","PRCPRCFP",28,0)
 K ^TMP($J,"PRCPRCFP")
"RTN","PRCPRCFP",29,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  D
"RTN","PRCPRCFP",30,0)
 .   S ITEMDATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0))
"RTN","PRCPRCFP",31,0)
 .   S GROUP=+$P(ITEMDATA,"^",21)
"RTN","PRCPRCFP",32,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPRCFP",33,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPRCFP",34,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPRCFP",35,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRCFP",36,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRCFP",37,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRCFP",38,0)
 .   S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA) S:DESCR="" DESCR=" "
"RTN","PRCPRCFP",39,0)
 .   S X=0 F  S X=$O(^PRCP(445,PRCP("I"),1,ITEMDA,5,X)) Q:'X  S VENDATA=$G(^(X,0)) I VENDATA'="" D
"RTN","PRCPRCFP",40,0)
 .   .   S VENNM=$$VENNAME^PRCPUX1($P(VENDATA,"^")) S:VENNM="" VENNM=" "
"RTN","PRCPRCFP",41,0)
 .   .   S ^TMP($J,"PRCPRCFP",GROUPNM,$E(DESCR,1,30),ITEMDA,$E(VENNM,1,20))=VENDATA
"RTN","PRCPRCFP",42,0)
 ;  print report
"RTN","PRCPRCFP",43,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRCFP",44,0)
 S GROUP="" F  S GROUP=$O(^TMP($J,"PRCPRCFP",GROUP)) Q:GROUP=""!($G(PRCPFLAG))  D
"RTN","PRCPRCFP",45,0)
 .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRCFP",46,0)
 .   W !!?5,"GROUP: ",$S(GROUP=" ":"<<NONE>>",1:GROUP)
"RTN","PRCPRCFP",47,0)
 .   S DESCR="" F  S DESCR=$O(^TMP($J,"PRCPRCFP",GROUP,DESCR)) Q:DESCR=""!($G(PRCPFLAG))  S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPRCFP",GROUP,DESCR,ITEMDA)) Q:'ITEMDA!($G(PRCPFLAG))  D
"RTN","PRCPRCFP",48,0)
 .   .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRCFP",49,0)
 .   .   S ITEMDATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0))
"RTN","PRCPRCFP",50,0)
 .   .   ; On-Demand Item flag check and display
"RTN","PRCPRCFP",51,0)
 .   .   S ODI=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRCFP",52,0)
 .   .   Q:(ODIS=1)&(ODI="Y")
"RTN","PRCPRCFP",53,0)
 .   .   Q:(ODIS=2)&(ODI'="Y")
"RTN","PRCPRCFP",54,0)
 .   .   ;
"RTN","PRCPRCFP",55,0)
 .   .   W !,DESCR,?32,$S(ODI="Y":"D",1:""),?46,ITEMDA,?53,$J(+$P(ITEMDATA,"^",7),8),$J($$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/"),10)
"RTN","PRCPRCFP",56,0)
 .   .   S VENNM="" F  S VENNM=$O(^TMP($J,"PRCPRCFP",GROUP,DESCR,ITEMDA,VENNM)) Q:VENNM=""!($G(PRCPFLAG))  S VENDATA=^(VENNM) D
"RTN","PRCPRCFP",57,0)
 .   .   .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRCFP",58,0)
 .   .   .   S %=$S($P(VENDATA,"^")["PRCP(445":"I#",1:"V#")_+VENDATA
"RTN","PRCPRCFP",59,0)
 .   .   .   W !?29,VENNM,?51,$J(%,8),?61,$J($$UNITVAL^PRCPUX1($P(VENDATA,"^",3),$P(VENDATA,"^",2),"/"),10),$J($P(VENDATA,"^",4),9)
"RTN","PRCPRCFP",60,0)
 .   I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>"
"RTN","PRCPRCFP",61,0)
 I '$G(PRCPFLAG) D END^PRCPUREP
"RTN","PRCPRCFP",62,0)
Q D ^%ZISC K ^TMP($J,"PRCPRCFP"),^TMP($J,"PRCPURS1")
"RTN","PRCPRCFP",63,0)
 Q
"RTN","PRCPRCFP",64,0)
 ;
"RTN","PRCPRCFP",65,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRCFP",66,0)
 W $C(13),"CONVERSION FACTOR REPORT FOR: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRCFP",67,0)
 W !,$S(ODIS=2:"ON-DEMAND ITEMS ONLY",ODIS=3:"ALL ITEMS (STANDARD AND ON-DEMAND)",1:"STANDARD ITEMS ONLY")
"RTN","PRCPRCFP",68,0)
 S %="",$P(%,"-",81)=""
"RTN","PRCPRCFP",69,0)
 W !,"DESCRIPTION",?32,"OD",?46,"IM",$J("QTY OH",13),$J("UNIT/IS",10)
"RTN","PRCPRCFP",70,0)
 W !?29,"PROCUREMENT SOURCE",?55,"IV#",?61,$J("UNIT/RE",10),$J("CF",9),!,%
"RTN","PRCPRCFP",71,0)
 Q
"RTN","PRCPRCTP")
0^19^B20211721^B18777387
"RTN","PRCPRCTP",1,0)
PRCPRCTP ;WISC/RFJ/DST-cost trend analysis (primary)                    ;26 May 93
"RTN","PRCPRCTP",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRCTP",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRCTP",4,0)
 Q
"RTN","PRCPRCTP",5,0)
 ;
"RTN","PRCPRCTP",6,0)
 ;
"RTN","PRCPRCTP",7,0)
PRIMARY ;  cost trend analysis for primary
"RTN","PRCPRCTP",8,0)
 ;  There is no Cost Trend Analysis for secondary
"RTN","PRCPRCTP",9,0)
 N %,%H,%I,DATEEND,DATESTRT,PRCPALLI,PRCPSUMM,X,X1,X2,Y
"RTN","PRCPRCTP",10,0)
 N ODI  ; On-Demand Item flag
"RTN","PRCPRCTP",11,0)
 K X S X(1)="The Cost Trend Analysis Report will compute the average item cost for the specified period based on the monthly opening balance last receipt cost."
"RTN","PRCPRCTP",12,0)
 S X(2)="It will compare the computed average item cost with the current monthly opening balance average cost and display the percent increase or decrease change."
"RTN","PRCPRCTP",13,0)
 S X(3)="The report will sort Primary inventory items by description."
"RTN","PRCPRCTP",14,0)
 D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRCTP",15,0)
 K X S X(1)="Enter the date range (month-year) for computing the average item cost." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRCTP",16,0)
 D MONTHSEL^PRCPURS2 I '$G(DATEEND) Q
"RTN","PRCPRCTP",17,0)
 K X S X(1)="Select the Items to display." W ! D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRCTP",18,0)
 D ITEMSEL^PRCPURS4 I '$G(PRCPALLI),'$O(^TMP($J,"PRCPURS4",0)) Q
"RTN","PRCPRCTP",19,0)
 S PRCPSUMM=$$SUMMARY^PRCPURS0 I PRCPSUMM<0 Q
"RTN","PRCPRCTP",20,0)
 W ! S %ZIS="Q" D ^%ZIS G:POP Q I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK D Q Q
"RTN","PRCPRCTP",21,0)
 .   S ZTDESC="Cost Trend Analysis",ZTRTN="DQ^PRCPRCTP"
"RTN","PRCPRCTP",22,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("DATE*")="",ZTSAVE("^TMP($J,""PRCPURS4"",")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRCTP",23,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRCTP",24,0)
DQ ;  queue starts here
"RTN","PRCPRCTP",25,0)
 N AVG,CHANGE,COUNT,CURDT,CURRENT,D,DATA,DATE,DATEEDT,DATESDT,DESCR,HDR,ITEMDA,ITEMDATA,NOW,NSN,PAGE,PRCPFLAG,SCREEN,TOTAL
"RTN","PRCPRCTP",26,0)
 K ^TMP($J,"PRCPRCTP")
"RTN","PRCPRCTP",27,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  D
"RTN","PRCPRCTP",28,0)
 .   I '$G(PRCPALLI),'$D(^TMP($J,"PRCPURS4",ITEMDA)) Q
"RTN","PRCPRCTP",29,0)
 .   S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA) S:DESCR="" DESCR=" "
"RTN","PRCPRCTP",30,0)
 .   S (COUNT,TOTAL)=0
"RTN","PRCPRCTP",31,0)
 .   S DATE=$E(DATESTRT,1,5) F  D  Q:DATE>$E(DATEEND,1,5)
"RTN","PRCPRCTP",32,0)
 .   .   S D=$G(^PRCP(445.1,PRCP("I"),1,ITEMDA,1,DATE,0))
"RTN","PRCPRCTP",33,0)
 .   .   S ^TMP($J,"PRCPRCTP",$E(DESCR,1,15),ITEMDA,DATE)=+$P(D,"^",7)
"RTN","PRCPRCTP",34,0)
 .   .   I $P(D,"^",7) S COUNT=COUNT+1,TOTAL=TOTAL+$P(D,"^",7)
"RTN","PRCPRCTP",35,0)
 .   .   S X1=DATE_"00",X2=40 D C^%DTC S DATE=$E(X,1,5)
"RTN","PRCPRCTP",36,0)
 .   S AVG=$S(COUNT=0:0,1:$J(TOTAL/COUNT,0,3)),CURRENT=+$P($G(^PRCP(445.1,PRCP("I"),1,ITEMDA,1,$E(DT,1,5),0)),"^",7),CHANGE=$S(AVG=0:"***.**",1:(CURRENT-AVG)/AVG*100)
"RTN","PRCPRCTP",37,0)
 .   S ^TMP($J,"PRCPRCTP",$E(DESCR,1,15),ITEMDA,"TOTAL")=AVG_"^"_CURRENT_"^"_CHANGE
"RTN","PRCPRCTP",38,0)
 ;  print report
"RTN","PRCPRCTP",39,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,Y=$E(DT,1,5)_"00" D DD^%DT S CURDT=Y
"RTN","PRCPRCTP",40,0)
 S Y=$E(DATESTRT,1,5)_"00" D DD^%DT S DATESDT=Y,Y=$E(DATEEND,1,5)_"00" D DD^%DT S DATEEDT=Y
"RTN","PRCPRCTP",41,0)
 S PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRCTP",42,0)
 S DESCR="" F  S DESCR=$O(^TMP($J,"PRCPRCTP",DESCR)) Q:DESCR=""!($G(PRCPFLAG))  S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPRCTP",DESCR,ITEMDA)) Q:'ITEMDA!($G(PRCPFLAG))  D
"RTN","PRCPRCTP",43,0)
 .   I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRCTP",44,0)
 .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRCTP",45,0)
 .   S ITEMDATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0))
"RTN","PRCPRCTP",46,0)
 .   ; On-Demand Item flag check
"RTN","PRCPRCTP",47,0)
 .   S ODI=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRCTP",48,0)
 .   ;
"RTN","PRCPRCTP",49,0)
 .   W !!,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,33),?35,$J(ITEMDA,6),?42,$S(ODI="Y":"D",1:""),?43,$J($$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/"),8)
"RTN","PRCPRCTP",50,0)
 .   S D=$G(^TMP($J,"PRCPRCTP",DESCR,ITEMDA,"TOTAL"))
"RTN","PRCPRCTP",51,0)
 .   W $J($P(D,"^"),9,2),$J($P(D,"^",2),10,2),$J($P(D,"^",3),10,2)
"RTN","PRCPRCTP",52,0)
 .   I $G(PRCPSUMM) Q
"RTN","PRCPRCTP",53,0)
 .   S DATE=0 F  D  Q:'DATE!($G(PRCPFLAG))
"RTN","PRCPRCTP",54,0)
 .   .   S (DATA,HDR)=""
"RTN","PRCPRCTP",55,0)
 .   .   F COUNT=1:1:9 S DATE=$O(^TMP($J,"PRCPRCTP",DESCR,ITEMDA,DATE)) Q:'DATE  S D=^(DATE) D
"RTN","PRCPRCTP",56,0)
 .   .   .   S %=$P("Jan^Feb^Mar^Apr^May^Jun^Jul^Aug^Sep^Oct^Nov^Dec","^",+$E(DATE,4,5))_" "_$E(DATE,2,3),HDR=HDR_$J(%,8)
"RTN","PRCPRCTP",57,0)
 .   .   .   S DATA=DATA_$J(D,8,2)
"RTN","PRCPRCTP",58,0)
 .   .   I DATA'="" W !?5,HDR,!?5,DATA
"RTN","PRCPRCTP",59,0)
 .   .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRCTP",60,0)
 I '$G(PRCPFLAG) D END^PRCPUREP
"RTN","PRCPRCTP",61,0)
Q D ^%ZISC K ^TMP($J,"PRCPRCTP"),^TMP($J,"PRCPURS4")
"RTN","PRCPRCTP",62,0)
 Q
"RTN","PRCPRCTP",63,0)
 ;
"RTN","PRCPRCTP",64,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRCTP",65,0)
 W $C(13),"COST TREND ANALYSIS FOR: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRCTP",66,0)
 W !?5,"CUM AVG CALCULATED FROM DATE RANGE: ",DATESDT,"  TO  ",DATEEDT
"RTN","PRCPRCTP",67,0)
 S %="",$P(%,"-",81)="" W !,"DESCRIPTION",?38,"IM",?42,"OD",$J("UNIT/IS",9),$J("CUM AVG",9),$J(CURDT,9),$J("%CHANGE",9),!,%
"RTN","PRCPRCTP",68,0)
 Q
"RTN","PRCPRIIP")
0^20^B29831261^B22254891
"RTN","PRCPRIIP",1,0)
PRCPRIIP ;WISC/RFJ/VAC-inactive items report (primary, second)          ; 10/19/06 9:14am
"RTN","PRCPRIIP",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRIIP",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRIIP",4,0)
 ;Modified to add a Group Category prompt and an On-Demand selection.
"RTN","PRCPRIIP",5,0)
 Q
"RTN","PRCPRIIP",6,0)
 ;
"RTN","PRCPRIIP",7,0)
 ;
"RTN","PRCPRIIP",8,0)
PRIMARY ;  inactive items report for primary and secondary
"RTN","PRCPRIIP",9,0)
 N DATEINAC,GROUPALL,X,Y,ODITEM,TYPNUM,ZERNUM,ODITEMFL,NEWHED,X1,X2
"RTN","PRCPRIIP",10,0)
 K X S X(1)="The Inactive Items Report will print items which have no receipts or issues after a specified cutoff date.  The report is sorted by group category and description."
"RTN","PRCPRIIP",11,0)
 D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRIIP",12,0)
 K X S X(1)="Select the Group Categories to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRIIP",13,0)
 D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRIIP",14,0)
 I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) W !,"*** NO GROUP CATEGORIES SELECTED !" D Q Q
"RTN","PRCPRIIP",15,0)
 W !,"NOTE:  The report will",$S('$G(GROUPALL):" NOT",1:"")," include items not stored in a group category."
"RTN","PRCPRIIP",16,0)
 K X S X(1)="Enter the Inactivity cutoff date." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRIIP",17,0)
 S X1=DT,X2=-90 D C^%DTC S Y=$E(X,1,5)_"00" D DD^%DT
"RTN","PRCPRIIP",18,0)
 S %DT(0)=-($E(DT,1,5)_"00"),%DT="AEP",%DT("B")=Y,%DT("A")="Enter Inactivity Cutoff MONTH and YEAR: " D ^%DT K %DT I Y<1 Q
"RTN","PRCPRIIP",19,0)
 S DATEINAC=$E(Y,1,5)_"00"
"RTN","PRCPRIIP",20,0)
 ;Insert prompts for On-Demand and Zero quantity
"RTN","PRCPRIIP",21,0)
 S TYPNUM=$$ODIPROM^PRCPUX2(0)
"RTN","PRCPRIIP",22,0)
 Q:TYPNUM=0
"RTN","PRCPRIIP",23,0)
 S ZERNUM=$$ZEROQTY^PRCPURS1(0)
"RTN","PRCPRIIP",24,0)
 Q:ZERNUM=0
"RTN","PRCPRIIP",25,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRIIP",26,0)
 .   S ZTDESC="Inactive Item Report",ZTRTN="DQ^PRCPRIIP"
"RTN","PRCPRIIP",27,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("GROUP*")="",ZTSAVE("DATEINAC")="",ZTSAVE("^TMP($J,""PRCPURS1"",")="",ZTSAVE("ZTREQ")="@",ZTSAVE("O*")="",ZTSAVE("T*")=""
"RTN","PRCPRIIP",28,0)
 .   S ZTSAVE("Q*")="",ZTSAVE("Z*")=""
"RTN","PRCPRIIP",29,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRIIP",30,0)
DQ ;  queue starts here
"RTN","PRCPRIIP",31,0)
 N %,%I,D,DATEFROM,DESCR,DUEOUT,GROUP,GROUPNM,ITEMDA,NOW,PAGE,PRCPFLAG,QTY,RECPT,SCREEN,TOTAL,TOTDAYS,USAGE,X,Y
"RTN","PRCPRIIP",32,0)
 K ^TMP($J,"PRCPRIIP")
"RTN","PRCPRIIP",33,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S D=$G(^(ITEMDA,0)) I D'="" D
"RTN","PRCPRIIP",34,0)
 .   ;  if reusable quit
"RTN","PRCPRIIP",35,0)
 .   I $$REUSABLE^PRCPU441(ITEMDA) Q
"RTN","PRCPRIIP",36,0)
 .   ;Check if ODI, STD or Both
"RTN","PRCPRIIP",37,0)
 .   S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRIIP",38,0)
 .   I (ODITEM="Y")&(TYPNUM=1) Q
"RTN","PRCPRIIP",39,0)
 .   I (ODITEM'="Y")&(TYPNUM=2) Q
"RTN","PRCPRIIP",40,0)
 .   S QTY=$P(D,"^",7)+$P(D,"^",19)
"RTN","PRCPRIIP",41,0)
 .   ;Check if Zero qty is to be printed
"RTN","PRCPRIIP",42,0)
 .   I (+QTY=0)&(ZERNUM=2) Q
"RTN","PRCPRIIP",43,0)
 .   I (+QTY'=0)&(ZERNUM=3) Q
"RTN","PRCPRIIP",44,0)
 .   S GROUP=+$P(D,"^",21)
"RTN","PRCPRIIP",45,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPRIIP",46,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPRIIP",47,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPRIIP",48,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRIIP",49,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRIIP",50,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRIIP",51,0)
 .   S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA) S:DESCR="" DESCR=" "
"RTN","PRCPRIIP",52,0)
 .   I $O(^PRCP(445,PRCP("I"),1,ITEMDA,2,$E(DATEINAC,1,5)-.01))!($O(^PRCP(445,PRCP("I"),1,ITEMDA,3,DATEINAC))) Q
"RTN","PRCPRIIP",53,0)
 .   ;  find last usage date
"RTN","PRCPRIIP",54,0)
 .   S (USAGE,X)=0 F  S X=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,X)) Q:'X  S USAGE=X
"RTN","PRCPRIIP",55,0)
 .   S USAGE=$S('USAGE:"",1:$E(USAGE,4,5)_"/"_$E(USAGE,2,3))
"RTN","PRCPRIIP",56,0)
 .   ;  find last receipt date
"RTN","PRCPRIIP",57,0)
 .   S (RECPT,X)=0 F  S X=$O(^PRCP(445,PRCP("I"),1,ITEMDA,3,X)) Q:'X  S RECPT=X
"RTN","PRCPRIIP",58,0)
 .   S RECPT=$S('RECPT:"",1:$E(RECPT,4,5)_"/"_$E(RECPT,6,7)_"/"_$E(RECPT,2,3))
"RTN","PRCPRIIP",59,0)
 .   S DUEOUT=$$GETOUT^PRCPUDUE(PRCP("I"),ITEMDA) I 'DUEOUT S DUEOUT=""
"RTN","PRCPRIIP",60,0)
 .   S ^TMP($J,"PRCPRIIP",GROUPNM,$E(DESCR,1,15),ITEMDA)=USAGE_"^"_RECPT_"^"_DUEOUT_"^"_QTY_"^"_$P(D,"^",27)_"^"_$S($P(D,"^",26)="Y":"*",1:"")_"^"_ODITEM
"RTN","PRCPRIIP",61,0)
 ;  print report
"RTN","PRCPRIIP",62,0)
 S X1=DT,X2=DATEINAC D ^%DTC S TOTDAYS=X
"RTN","PRCPRIIP",63,0)
 S Y=DATEINAC D DD^%DT S DATEFROM=Y
"RTN","PRCPRIIP",64,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRIIP",65,0)
 S TOTAL=0,GROUP="" F  S GROUP=$O(^TMP($J,"PRCPRIIP",GROUP)) Q:GROUP=""!($G(PRCPFLAG))  D
"RTN","PRCPRIIP",66,0)
 .   I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRIIP",67,0)
 .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRIIP",68,0)
 .   W !!?5,"GROUP: ",$S(GROUP=" ":"<<NONE>>",1:GROUP)
"RTN","PRCPRIIP",69,0)
 .   S DESCR="" F  S DESCR=$O(^TMP($J,"PRCPRIIP",GROUP,DESCR)) Q:DESCR=""!($G(PRCPFLAG))  S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPRIIP",GROUP,DESCR,ITEMDA)) Q:'ITEMDA!($G(PRCPFLAG))  S D=^(ITEMDA) D
"RTN","PRCPRIIP",70,0)
 .   .   S ODITEMFL=$P($G(^TMP($J,"PRCPRIIP",GROUP,DESCR,ITEMDA)),"^",7)
"RTN","PRCPRIIP",71,0)
 .   .   W !,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,32),?33,ITEMDA
"RTN","PRCPRIIP",72,0)
 .   .   I ODITEMFL="Y" W ?41,"D"
"RTN","PRCPRIIP",73,0)
 .   .   W ?43,$J($P(D,"^"),5),$J($P(D,"^",2),10),$J($P(D,"^",3),5),$J($P(D,"^",4),7),$J($P(D,"^",5),8,2),$J($P(D,"^",6),2)
"RTN","PRCPRIIP",74,0)
 .   .   S TOTAL=TOTAL+$P(D,"^",5)
"RTN","PRCPRIIP",75,0)
 .   .   I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRIIP",76,0)
 I '$G(PRCPFLAG),$Y>(IOSL-3) D:SCREEN P^PRCPUREP I '$G(PRCPFLAG) D H
"RTN","PRCPRIIP",77,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRIIP",78,0)
 W !!?30,"TOTAL INACTIVE ITEM VALUE IN STOCK: ",$J(TOTAL,12,2)
"RTN","PRCPRIIP",79,0)
 D END^PRCPUREP
"RTN","PRCPRIIP",80,0)
Q D ^%ZISC K ^TMP($J,"PRCPRIIP"),^TMP($J,"PRCPURS1")
"RTN","PRCPRIIP",81,0)
 Q
"RTN","PRCPRIIP",82,0)
 ;
"RTN","PRCPRIIP",83,0)
 ;
"RTN","PRCPRIIP",84,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRIIP",85,0)
 W $C(13),"INACTIVE ITEM REPORT FOR: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRIIP",86,0)
 S %="",$P(%,"-",81)=""
"RTN","PRCPRIIP",87,0)
 W !?5,"INACTIVE ITEMS RANGE FROM ",DATEFROM,"  TO  ",$P(NOW,"@"),"  (",TOTDAYS," DAYS)"
"RTN","PRCPRIIP",88,0)
 I TYPNUM=1 S NEWHED="EXCLUDES ON-DEMAND ITEMS "
"RTN","PRCPRIIP",89,0)
 I TYPNUM=2 S NEWHED="ON-DEMAND ITEMS ONLY "
"RTN","PRCPRIIP",90,0)
 I TYPNUM=3 S NEWHED="STANDARD AND ON-DEMAND ITEMS "
"RTN","PRCPRIIP",91,0)
 I ZERNUM=1 S NEWHED=NEWHED_" INCLUDES ZERO QUANTITY ITEMS"
"RTN","PRCPRIIP",92,0)
 I ZERNUM=2 S NEWHED=NEWHED_" EXCLUDES ZERO QUANTITY ITEMS"
"RTN","PRCPRIIP",93,0)
 I ZERNUM=3 S NEWHED=NEWHED_" INCLUDES ONLY ZERO QUANTITY ITEMS"
"RTN","PRCPRIIP",94,0)
 W !?5,NEWHED,?79,"K"
"RTN","PRCPRIIP",95,0)
 W !?41,"O"
"RTN","PRCPRIIP",96,0)
 W ?44,"LAST",?53,"LAST",?60,"DUE",?67,"QTY",?73,"TOTAL",?79,"W",!,"DESCRIPTION",?36,"IM",?41,"D",?43,"USAGE",?50,"RECEIPT",?60,"OUT",?65,"ONHND",?73,"VALUE",?79,"Z",!,%
"RTN","PRCPRIIP",97,0)
 Q
"RTN","PRCPRINV")
0^21^B23141545^B18485386
"RTN","PRCPRINV",1,0)
PRCPRINV ;WISC/RFJ/DGL/VAC-inventory control parameters report ; 2/27/07 8:46am
"RTN","PRCPRINV",2,0)
V ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRINV",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRINV",4,0)
 ;*98 Modified to accommodate On-Demand Items.
"RTN","PRCPRINV",5,0)
 ;*98 Modified for Total = ODI+Standard, rather than pull from 0 node
"RTN","PRCPRINV",6,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRINV",7,0)
 N PRCPINPT,X,POP,ZTDESC,ZTRTN,ZTSAVE
"RTN","PRCPRINV",8,0)
 I "WP"[PRCP("DPTYPE") W !!,"--Press RETURN to print parameters for ",PRCP("IN"),"--" S PRCPINPT=$$TO^PRCPUDPT(PRCP("I")) I PRCPINPT["^" Q
"RTN","PRCPRINV",9,0)
 I '$G(PRCPINPT) S PRCPINPT=PRCP("I")
"RTN","PRCPRINV",10,0)
 W !!,"Print control parameters for ",$$INVNAME^PRCPUX1(PRCPINPT),!
"RTN","PRCPRINV",11,0)
 S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRINV",12,0)
 .   S ZTDESC="Inventory Parameters",ZTRTN="DQ^PRCPRINV"
"RTN","PRCPRINV",13,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRINV",14,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRINV",15,0)
DQ ;  queue starts here
"RTN","PRCPRINV",16,0)
 N %,%I,DATA,DISTR,FCP,ITEMCTR,MGRFLG,NOW,ODIFLG,ODITEM,PAGE,PRCPFLAG,PRCPNAME,PRCPTYPE,SCREEN,SECT,STATION,STDITEM,USER,X,Y
"RTN","PRCPRINV",17,0)
 S DATA=$G(^PRCP(445,PRCPINPT,0)),PRCPNAME=$P(DATA,"^"),PRCPTYPE=$P(DATA,"^",3)
"RTN","PRCPRINV",18,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRINV",19,0)
 W !!,"TYPE OF INVENTORY POINT",?30,": ",$S(PRCPTYPE="W":"SUPPLY WAREHOUSE",PRCPTYPE="P":"PRIMARY",PRCPTYPE="S":"SECONDARY",1:"<<NOT DEFINED>>")
"RTN","PRCPRINV",20,0)
 W !,"ABBREVIATED NAME",?30,": ",$P(DATA,"^",5)
"RTN","PRCPRINV",21,0)
 I PRCPTYPE="W"!(PRCPTYPE="P") W !,"COST CENTER",?30,": ",$E($P($G(^PRCD(420.1,+$P(DATA,"^",7),0)),"^"),1,48)
"RTN","PRCPRINV",22,0)
 W !,"KEEP PERPETUAL INVENTORY",?30,": ",$S($P(DATA,"^",2)="Y":"YES",1:"NO")
"RTN","PRCPRINV",23,0)
 W !,"KEEP TRANSACTION/USAGE HISTORY",?30,": ",$S($P(DATA,"^",6)="Y":"YES",1:"NO")
"RTN","PRCPRINV",24,0)
 I $Y>(IOSL-7) D:SCREEN P^PRCPUREP G:$D(PRCPFLAG) Q D H
"RTN","PRCPRINV",25,0)
 I PRCPTYPE="P" D
"RTN","PRCPRINV",26,0)
 .   W !,"PRIMARY UPDATED BY WAREHOUSE",?30,": ",$S($P(DATA,"^",16)="N":"NO",1:"YES")
"RTN","PRCPRINV",27,0)
 .   W !,"SPECIAL INVENTORY POINT TYPE",?30,": ",$S($P(DATA,"^",20)="D":"DRUG ACCOUNTABILITY",$P(DATA,"^",20)="S":"SPD",1:"")
"RTN","PRCPRINV",28,0)
 .   I $P(DATA,"^",20)="S" W !,"SPD PICKING TICKET PRINTER: ",$P($G(^PRCP(445,PRCPINPT,"DEV")),"^")
"RTN","PRCPRINV",29,0)
 .   W !,"ISSUE BOOK SORT",?30,": ",$S($P(DATA,"^",10)="A":"ALPHA SORT",$P(DATA,"^",10)="N":"NSN SORT",1:"")
"RTN","PRCPRINV",30,0)
 .   W !,"REGULAR WHSE ISSUES SCHEDULE",?30,": ",$S($P(DATA,"^",4)="W":"WEEKLY",$P(DATA,"^",4)=2:"EVERY 2 WEEKS",$P(DATA,"^",4)="M":"MONTHLY",$P(DATA,"^",4)="O":"OTHER",1:"")
"RTN","PRCPRINV",31,0)
 .   W !,"DEPARTMENT NUMBER",?30,": ",$P(DATA,"^",8)
"RTN","PRCPRINV",32,0)
 W !,"MONTHS INACTIVE ITEM DELETION",?30,": ",$P(DATA,"^",13)
"RTN","PRCPRINV",33,0)
 ;Count number of on-demand and standard items
"RTN","PRCPRINV",34,0)
 S (ODITEM,STDITEM,ITEMCTR)=0
"RTN","PRCPRINV",35,0)
 F  S ITEMCTR=$O(^PRCP(445,PRCPINPT,1,ITEMCTR)) Q:+ITEMCTR=0  D
"RTN","PRCPRINV",36,0)
 .S ODIFLG=$$ODITEM^PRCPUX2(PRCPINPT,ITEMCTR)
"RTN","PRCPRINV",37,0)
 .I ODIFLG="Y" S ODITEM=ODITEM+1 Q
"RTN","PRCPRINV",38,0)
 .S STDITEM=STDITEM+1
"RTN","PRCPRINV",39,0)
 I PRCPTYPE'="W" D
"RTN","PRCPRINV",40,0)
 .W !,"TOTAL STANDARD ITEMS",?30,": ",STDITEM
"RTN","PRCPRINV",41,0)
 .I $Y>(IOSL-6) D:SCREEN P^PRCPUREP G:$D(PRCPFLAG) Q D H
"RTN","PRCPRINV",42,0)
 .W !,"TOTAL ON-DEMAND ITEMS",?30,": ",ODITEM
"RTN","PRCPRINV",43,0)
 .I $Y>(IOSL-6) D:SCREEN P^PRCPUREP G:$D(PRCPFLAG) Q D H
"RTN","PRCPRINV",44,0)
 ; the following line was re-written with patch PRC*5.1*98
"RTN","PRCPRINV",45,0)
 ;W !,"TOTAL NUMBER OF ITEMS STORED",?30,": ",+$P($G(^PRCP(445,PRCPINPT,1,0)),"^",4)
"RTN","PRCPRINV",46,0)
 W !,"TOTAL NUMBER OF ITEMS STORED",?30,": ",STDITEM+ODITEM
"RTN","PRCPRINV",47,0)
 I $Y>(IOSL-6) D:SCREEN P^PRCPUREP G:$D(PRCPFLAG) Q D H
"RTN","PRCPRINV",48,0)
 I PRCPTYPE="W"!(PRCPTYPE="P") D
"RTN","PRCPRINV",49,0)
 .   W !!,"FUND CONTROL POINTS",?30,": "
"RTN","PRCPRINV",50,0)
 .   S STATION=0 F  S STATION=$O(^PRC(420,"AE",STATION)) Q:'STATION!($G(PRCPFLAG))  S FCP=0 F  S FCP=$O(^PRC(420,"AE",STATION,PRCPINPT,FCP)) Q:'FCP!($G(PRCPFLAG))  D
"RTN","PRCPRINV",51,0)
 .   .   W $P($G(^PRC(420,STATION,1,FCP,0)),"^")
"RTN","PRCPRINV",52,0)
 .   .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRINV",53,0)
 .   .   W !?32
"RTN","PRCPRINV",54,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRINV",55,0)
 I $Y>(IOSL-6) D:SCREEN P^PRCPUREP G:$D(PRCPFLAG) Q D H
"RTN","PRCPRINV",56,0)
 I PRCPTYPE="S"!(PRCPTYPE="P") D
"RTN","PRCPRINV",57,0)
 .   W !!,"MIS COSTING SECTION",?30,": "
"RTN","PRCPRINV",58,0)
 .   S SECT=0 F  S SECT=$O(^PRCP(445,PRCPINPT,3,SECT)) Q:'SECT!($G(PRCPFLAG))  D
"RTN","PRCPRINV",59,0)
 .   .   S %=$G(^PRCP(445,PRCPINPT,3,SECT,0))
"RTN","PRCPRINV",60,0)
 .   .   W $E($P($G(^DIC(49,+$P(%,"^"),0)),"^"),1,30),?64,$J($P(%,"^",2),5)," %"
"RTN","PRCPRINV",61,0)
 .   .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRINV",62,0)
 .   .   W !?32
"RTN","PRCPRINV",63,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRINV",64,0)
 I $Y>(IOSL-6) D:SCREEN P^PRCPUREP G:$D(PRCPFLAG) Q D H
"RTN","PRCPRINV",65,0)
 W !!,"INVENTORY USERS",?30,": "
"RTN","PRCPRINV",66,0)
 S USER=0 F  S USER=$O(^PRCP(445,PRCPINPT,4,USER)) Q:'USER!($G(PRCPFLAG))  D
"RTN","PRCPRINV",67,0)
 .   S MGRFLG=""
"RTN","PRCPRINV",68,0)
 .   W $E($$USER^PRCPUREP(USER),1,30)
"RTN","PRCPRINV",69,0)
 .   I $$KEY^PRCPUREP("PRCP"_$S(PRCPTYPE="P":"",PRCPTYPE="W":"W",PRCPTYPE="S":"2",1:"?")_" MGRKEY",USER) S MGRFLG="**MANAGER**"
"RTN","PRCPRINV",70,0)
 .   I $D(^PRCP(445,PRCPINPT,9,USER,0)) S MGRFLG="**ODI MGR**"
"RTN","PRCPRINV",71,0)
 .   W ?64,MGRFLG
"RTN","PRCPRINV",72,0)
 .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRINV",73,0)
 .   W !?32
"RTN","PRCPRINV",74,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRINV",75,0)
 I $Y>(IOSL-6) D:SCREEN P^PRCPUREP G:$D(PRCPFLAG) Q D H
"RTN","PRCPRINV",76,0)
 I PRCPTYPE="W"!(PRCPTYPE="P") D
"RTN","PRCPRINV",77,0)
 .   W !!,"DISTRIBUTION POINTS",?30,": "
"RTN","PRCPRINV",78,0)
 .   S DISTR=0 F  S DISTR=$O(^PRCP(445,PRCPINPT,2,DISTR)) Q:'DISTR!($G(PRCPFLAG))  D
"RTN","PRCPRINV",79,0)
 .   .   S %=$P($G(^PRCP(445,DISTR,0)),"^",3)
"RTN","PRCPRINV",80,0)
 .   .   W $$INVNAME^PRCPUX1(DISTR),?64,$S(%="W":"SUPPLY WAREHOUSE",%="P":"PRIMARY",%="S":"SECONDARY",1:"<<NOT DEFINED>>")
"RTN","PRCPRINV",81,0)
 .   .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRINV",82,0)
 .   .   W !?32
"RTN","PRCPRINV",83,0)
 I '$G(PRCPFLAG) D END^PRCPUREP
"RTN","PRCPRINV",84,0)
Q D ^%ZISC
"RTN","PRCPRINV",85,0)
 Q
"RTN","PRCPRINV",86,0)
 ;
"RTN","PRCPRINV",87,0)
 ;
"RTN","PRCPRINV",88,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRINV",89,0)
 W $C(13),"INVENTORY PARAMETERS FOR: ",$E(PRCPNAME,1,20),?(80-$L(%)),%
"RTN","PRCPRINV",90,0)
 S %="",$P(%,"-",81)=""
"RTN","PRCPRINV",91,0)
 W !,%
"RTN","PRCPRINV",92,0)
 Q
"RTN","PRCPRIT0")
0^46^B2686426^B2448325
"RTN","PRCPRIT0",1,0)
PRCPRIT0 ;WISC/RFJ-display item                                     ; 10/19/06 9:02am
"RTN","PRCPRIT0",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRIT0",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRIT0",4,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRIT0",5,0)
 N %,INVPT,ITEMDA,ODIFLAG
"RTN","PRCPRIT0",6,0)
 S INVPT=PRCP("I") I $O(^PRCP(445,PRCP("I"),2,0))="" G ITEM
"RTN","PRCPRIT0",7,0)
 W !!,"Enter the DISTRIBUTION POINT to select an item from the distribution point, or",!,"Enter <RETURN> to select an item from the ",PRCP("IN")," inventory point."
"RTN","PRCPRIT0",8,0)
 S %=$$TO^PRCPUDPT(PRCP("I")) Q:%["^"  I % S INVPT=%
"RTN","PRCPRIT0",9,0)
ITEM S ODIFLAG="P"
"RTN","PRCPRIT0",10,0)
 I PRCP("DPTYPE")="W" D
"RTN","PRCPRIT0",11,0)
 .I %=0 S ODIFLAG="W"
"RTN","PRCPRIT0",12,0)
 F  W ! S ITEMDA=$$ITEM^PRCPUITM(INVPT,0,"","") Q:'ITEMDA  D
"RTN","PRCPRIT0",13,0)
 .   S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRIT0",14,0)
 .   .   S ZTDESC="Display Item Report",ZTRTN="DQ^PRCPRIT1"
"RTN","PRCPRIT0",15,0)
 .   .   S ZTSAVE("PRCP*")="",ZTSAVE("ITEMDA")="",ZTSAVE("INVPT")="",ZTSAVE("ZTREQ")="@",ZTSAVE("O*")=""
"RTN","PRCPRIT0",16,0)
 .   W !!,"<*> please wait <*>"
"RTN","PRCPRIT0",17,0)
 .   D DQ^PRCPRIT1
"RTN","PRCPRIT0",18,0)
 Q
"RTN","PRCPRIT1")
0^22^B27403400^B24315914
"RTN","PRCPRIT1",1,0)
PRCPRIT1 ;WISC/RFJ/VAC-display item (print) ; 10/27/06 2:01pm
"RTN","PRCPRIT1",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRIT1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRIT1",4,0)
 ;Routine modified to show "D" for On-Demand Item and to correct
"RTN","PRCPRIT1",5,0)
 ;   column #IM heading
"RTN","PRCPRIT1",6,0)
 Q
"RTN","PRCPRIT1",7,0)
 ;
"RTN","PRCPRIT1",8,0)
 ;
"RTN","PRCPRIT1",9,0)
DQ ;queue comes here
"RTN","PRCPRIT1",10,0)
 N %I,D,D0,ITEMDATA,PRCPDA,DATA,DATE,INVNAME,NOW,PAGE,PRCPFLAG,SCREEN,UNIT,X,Y,ODI,X1,X2,MASTDATA
"RTN","PRCPRIT1",11,0)
 D NOW^%DTC S Y=%,DATE=$E(%,1,7) D DD^%DT S NOW=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP,INVNAME=$$INVNAME^PRCPUX1(INVPT) U IO D H
"RTN","PRCPRIT1",12,0)
 S MASTDATA=$G(^PRC(441,ITEMDA,0)),ITEMDATA=$G(^PRCP(445,INVPT,1,ITEMDA,0))
"RTN","PRCPRIT1",13,0)
 W !,$P(MASTDATA,"^",5),?19,$E($$DESCR^PRCPUX1(INVPT,ITEMDA),1,28),?49,"[#",ITEMDA,"]",?59,$E($$GROUPNM^PRCPEGRP(+$P(ITEMDATA,"^",21)),1,20)
"RTN","PRCPRIT1",14,0)
 ; Insert logic to print ODI flag of "D"
"RTN","PRCPRIT1",15,0)
 I ODIFLAG="P"  D
"RTN","PRCPRIT1",16,0)
 .W !,?8,"ON-DEMAND: "
"RTN","PRCPRIT1",17,0)
 .S ODI=""
"RTN","PRCPRIT1",18,0)
 .S ODI=$$ODITEM^PRCPUX2(INVPT,ITEMDA)
"RTN","PRCPRIT1",19,0)
 .I ODI="Y" W "D"
"RTN","PRCPRIT1",20,0)
 .W ?36,"BOC: ",$E($P($G(^PRCD(420.2,+$P(MASTDATA,"^",10),0)),"^"),1,39)
"RTN","PRCPRIT1",21,0)
 I ODIFLAG="W" D
"RTN","PRCPRIT1",22,0)
 .W ?14,"BOC: ",$E($P($G(^PRCD(420.2,+$P(MASTDATA,"^",10),0)),"^"),1,39)
"RTN","PRCPRIT1",23,0)
 S UNIT=$$UNIT^PRCPUX1(INVPT,ITEMDA," per ") W !?3,"UNIT per ISSUE: ",UNIT
"RTN","PRCPRIT1",24,0)
 W !?6,"QTY ON HAND: ",+$P(ITEMDATA,"^",7),?33,"DUE-IN: ",$$GETIN^PRCPUDUE(INVPT,ITEMDA),?60,"DUE-OUT: ",$$GETOUT^PRCPUDUE(INVPT,ITEMDA),!?6,"QTY NON-ISS: ",+$P(ITEMDATA,"^",19)
"RTN","PRCPRIT1",25,0)
 I $P(ITEMDATA,"^",26)="Y" W !?19,"** DELETE ITEM WHEN QTY ON HAND REACHES ZERO **"
"RTN","PRCPRIT1",26,0)
 W !?6,"TOTAL VALUE: ",$P(ITEMDATA,"^",27)
"RTN","PRCPRIT1",27,0)
 W !?5,"NORM STL LVL: ",$P(ITEMDATA,"^",9),?29,"REORDER PT: ",$P(ITEMDATA,"^",10),?55,"INT ORDER PT: ",$P(ITEMDATA,"^",4)
"RTN","PRCPRIT1",28,0)
 W !?4,"EMERGENCY LVL: ",$P(ITEMDATA,"^",11),?29,"ISSUE MULT: ",$P(ITEMDATA,"^",25),?54,"MIN ISSUE QTY: ",$P(ITEMDATA,"^",17)
"RTN","PRCPRIT1",29,0)
 I $P(ITEMDATA,"^",23) S Y=$P(ITEMDATA,"^",24) D DD^%DT W !?5,"TEMP STK LVL: ",$P(ITEMDATA,"^",23),?29,"UNTIL DATE: ",Y
"RTN","PRCPRIT1",30,0)
 S Y=$P(ITEMDATA,"^",3) D DD^%DT W !?8,"LAST COST: ",$P(ITEMDATA,"^",15),?29,"LAST REC'D: ",Y,?55,"AVERAGE COST: ",$P(ITEMDATA,"^",22)
"RTN","PRCPRIT1",31,0)
 W !?1,"MAIN STORAGE LOC: ",$$STORELOC^PRCPESTO(+$P(ITEMDATA,"^",6))
"RTN","PRCPRIT1",32,0)
 I $O(^PRCP(445,INVPT,1,ITEMDA,5,0)) D
"RTN","PRCPRIT1",33,0)
 .   D HS S PRCPDA=0 F  S PRCPDA=$O(^PRCP(445,INVPT,1,ITEMDA,5,PRCPDA)) Q:'PRCPDA!($G(PRCPFLAG))  S DATA=$G(^(PRCPDA,0)) D
"RTN","PRCPRIT1",34,0)
 .   .   W ! I $P(ITEMDATA,"^",12)=$P(DATA,"^") W ?3,"m"
"RTN","PRCPRIT1",35,0)
 .   .   S Y=$P(DATA,"^"),Y=$S(Y["PRC(440":$P($G(^PRC(440,+Y,0)),"^"),1:$P($G(^PRCP(445,+Y,0)),"^")) S:'+$P(DATA,"^",4) $P(DATA,"^",4)=1
"RTN","PRCPRIT1",36,0)
 .   .   W ?5,$E(Y,1,27),?37,"[#",+DATA,"]",?45,$J($P(DATA,"^",4),9),?68,$J($$UNITVAL^PRCPUX1($P(DATA,"^",3),$P(DATA,"^",2)," per "),11)
"RTN","PRCPRIT1",37,0)
 .   .   I $Y>(IOSL-5),$O(^PRCP(445,INVPT,1,ITEMDA,5,PRCPDA)) D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)  D H,HS
"RTN","PRCPRIT1",38,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRIT1",39,0)
 I $O(^PRCP(445,INVPT,1,ITEMDA,7,0)) D
"RTN","PRCPRIT1",40,0)
 .   I $Y>(IOSL-7) D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)  D H
"RTN","PRCPRIT1",41,0)
 .   D HO S PRCPDA=0 F  S PRCPDA=$O(^PRCP(445,INVPT,1,ITEMDA,7,PRCPDA)) Q:'PRCPDA!($G(PRCPFLAG))  S DATA=$G(^(PRCPDA,0)) D
"RTN","PRCPRIT1",42,0)
 .   .   S:'+$P(DATA,"^",5) $P(DATA,"^",5)=1
"RTN","PRCPRIT1",43,0)
 .   .   W !?1,$P($G(^PRCS(410,PRCPDA,0)),"^"),?21,$J(+$P(DATA,"^",2),7),?32,$J(UNIT,11),?50,$J($P(DATA,"^",5),5),?57,$J($P(DATA,"^",2)/$P(DATA,"^",5),7),?68,$J($$UNITVAL^PRCPUX1($P(DATA,"^",4),$P(DATA,"^",3)," per "),11)
"RTN","PRCPRIT1",44,0)
 .   .   S D0=PRCPDA D STATUS^PRCSES W !?10,"REQUEST STATUS: ",X
"RTN","PRCPRIT1",45,0)
 .   .   I $Y>(IOSL-5),$O(^PRCP(445,INVPT,1,ITEMDA,7,PRCPDA)) D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)  D H,HO
"RTN","PRCPRIT1",46,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRIT1",47,0)
 S X1=$E(DATE,1,5)_"01",X2=-180 D C^%DTC S X=$E(X,1,5)
"RTN","PRCPRIT1",48,0)
 I $O(^PRCP(445,INVPT,1,ITEMDA,2,X)) D
"RTN","PRCPRIT1",49,0)
 .   I $Y>(IOSL-7) D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)  D H
"RTN","PRCPRIT1",50,0)
 .   D HU S PRCPDA=X F  S PRCPDA=$O(^PRCP(445,INVPT,1,ITEMDA,2,PRCPDA)) Q:'PRCPDA!($G(PRCPFLAG))  S DATA=$G(^(PRCPDA,0)) D
"RTN","PRCPRIT1",51,0)
 .   .   W !?9,$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",+$E(PRCPDA,4,5))," ",17+$E(PRCPDA),$E(PRCPDA,2,3),?29,$J($P(DATA,"^",2),15),?47,$J($P(DATA,"^",3),17,3)
"RTN","PRCPRIT1",52,0)
 .   .   I $Y>(IOSL-5),$O(^PRCP(445,INVPT,1,ITEMDA,2,PRCPDA)) D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)  D H,HU
"RTN","PRCPRIT1",53,0)
 I $G(PRCPFLAG) D Q Q
"RTN","PRCPRIT1",54,0)
 I $O(^PRCP(445,INVPT,1,ITEMDA,3,X_"01")) D
"RTN","PRCPRIT1",55,0)
 .   I $Y>(IOSL-7) D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)  D H
"RTN","PRCPRIT1",56,0)
 .   D HR S PRCPDA=X_"01" F  S PRCPDA=$O(^PRCP(445,INVPT,1,ITEMDA,3,PRCPDA)) Q:'PRCPDA!($G(PRCPFLAG))  S DATA=$G(^(PRCPDA,0)) D
"RTN","PRCPRIT1",57,0)
 .   .   W !?9,$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",+$E(PRCPDA,4,5))," ",$E(PRCPDA,6,7),", ",17+$E(PRCPDA),$E(PRCPDA,2,3),?29,$J($P(DATA,"^",2),13)
"RTN","PRCPRIT1",58,0)
 .   .   I $Y>(IOSL-5),$O(^PRCP(445,INVPT,1,ITEMDA,3,PRCPDA)) D:SCREEN P^PRCPUREP Q:$G(PRCPFLAG)  D H,HR
"RTN","PRCPRIT1",59,0)
 I '$G(PRCPFLAG) D END^PRCPUREP
"RTN","PRCPRIT1",60,0)
Q D ^%ZISC Q
"RTN","PRCPRIT1",61,0)
 ;
"RTN","PRCPRIT1",62,0)
 ;
"RTN","PRCPRIT1",63,0)
H S %=NOW_"  PAGE: "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRIT1",64,0)
 W $C(13),"DISPLAY ITEM REPORT FOR ",INVNAME,?(80-$L(%)),%
"RTN","PRCPRIT1",65,0)
 S %="",$P(%,"-",81)="" W !,"NSN",?19,"DESCRIPTION",?49,"[IM#]",?59,"GROUP : DESCRIPTION",!,%
"RTN","PRCPRIT1",66,0)
 Q
"RTN","PRCPRIT1",67,0)
 ;
"RTN","PRCPRIT1",68,0)
 ;
"RTN","PRCPRIT1",69,0)
HS ;header for procurement sources
"RTN","PRCPRIT1",70,0)
 W !?15,"-----POSSIBLE SOURCES (m=MANDATORY SOURCE)-----",!?5,"VENDOR",?37,"[#V]",?45,"CONV FACT",?68,"UNIT per REC"
"RTN","PRCPRIT1",71,0)
 Q
"RTN","PRCPRIT1",72,0)
 ;
"RTN","PRCPRIT1",73,0)
 ;
"RTN","PRCPRIT1",74,0)
HO ;header for outstanding transactions
"RTN","PRCPRIT1",75,0)
 W !?22,"-----OUTSTANDING TRANSACTIONS-----",!?1,"TRANSACTION NO.     QTY ORD in UNIT per ISS  CONV FACT  QTY REC in UNIT per REC"
"RTN","PRCPRIT1",76,0)
 Q
"RTN","PRCPRIT1",77,0)
 ;
"RTN","PRCPRIT1",78,0)
 ;
"RTN","PRCPRIT1",79,0)
HU ;header for usage
"RTN","PRCPRIT1",80,0)
 W !?24,"-----USAGE/ISSUES HISTORY-----",!?9,"DATE USED/ISSUED    QTY USED/ISSUED    COST USED/ISSUED"
"RTN","PRCPRIT1",81,0)
 Q
"RTN","PRCPRIT1",82,0)
 ;
"RTN","PRCPRIT1",83,0)
 ;
"RTN","PRCPRIT1",84,0)
HR ;header for receipts
"RTN","PRCPRIT1",85,0)
 W !?26,"-----RECEIPTS HISTORY-----",!?9,"DATE RECEIVED        QTY RECEIVED"
"RTN","PRCPRIT1",86,0)
 Q
"RTN","PRCPRODA")
0^23^B28089294^n/a
"RTN","PRCPRODA",1,0)
PRCPRODA ;WOIFO/VAC-On-Demand Audit Activity Report ; 2/22/07 9:05am
"RTN","PRCPRODA",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRODA",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRODA",4,0)
 Q
"RTN","PRCPRODA",5,0)
PRIMARY ;This routine displays the audit information on On-Demand Items updates
"RTN","PRCPRODA",6,0)
 N X,Y,GROUPALL,SRT,GROUP,ITEMFLG,PERS1,PERSNAM,TIMFLG,GR,GROUPYES
"RTN","PRCPRODA",7,0)
 N ITEMSEL,DATESTRT,DATEEND,GRPFLG,DESCR,NOW,ORDER,PRCPFLAG,X1,X2
"RTN","PRCPRODA",8,0)
 N POP,ZTDESC,ZTQUEUED,ZTRTN,ZTSAVE
"RTN","PRCPRODA",9,0)
 K ^TMP($J,"PRCPRODA")
"RTN","PRCPRODA",10,0)
 S DATESTRT=1,DATEEND=9999999
"RTN","PRCPRODA",11,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRODA",12,0)
 K X S X(1)="The On-Demand Audit Report will print the audit trail for items in Primary and/or Secondary Inventory that are either designated as ODI or were designated as ODI but are not now."
"RTN","PRCPRODA",13,0)
 D DISPLAY^PRCPUX2(2,79,.X)
"RTN","PRCPRODA",14,0)
 ; Prompt for All or single item
"RTN","PRCPRODA",15,0)
 K X S X(1)="Select specific items to display."
"RTN","PRCPRODA",16,0)
 D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRODA",17,0)
 S ITEMSEL=$$SINGIT^PRCPUX2(PRCP("I"))
"RTN","PRCPRODA",18,0)
 I ITEMSEL="^" Q
"RTN","PRCPRODA",19,0)
 ; set up ^TMP is single item selected, skip remaining prompts
"RTN","PRCPRODA",20,0)
 I ITEMSEL'="" D  G BEGIN
"RTN","PRCPRODA",21,0)
 .S ORDER=ITEMSEL
"RTN","PRCPRODA",22,0)
 .S GRPFLG=$P($G(^PRCP(445,PRCP("I"),1,ITEMSEL,0)),"^",21)
"RTN","PRCPRODA",23,0)
 .I GRPFLG="" S GRPFLG=0
"RTN","PRCPRODA",24,0)
 .S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMSEL)
"RTN","PRCPRODA",25,0)
 .S:DESCR="" DESCR=" "
"RTN","PRCPRODA",26,0)
 .S I=0 F  S I=$O(^PRCP(445,PRCP("I"),1,ITEMSEL,10,I)) Q:+I=0  D
"RTN","PRCPRODA",27,0)
 ..S TIMFLG=($G(^PRCP(445,PRCP("I"),1,ITEMSEL,10,I,0))*(-1))
"RTN","PRCPRODA",28,0)
 ..S ^TMP($J,"PRCPRODA",GRPFLG,PRCP("I"),ORDER,TIMFLG)=ITEMSEL_"^"_DESCR_"^"_$G(^PRCP(445,PRCP("I"),1,ITEMSEL,10,I,0))
"RTN","PRCPRODA",29,0)
 W !
"RTN","PRCPRODA",30,0)
 K X S X(1)="Select the date range which should be used for displaying the usage."
"RTN","PRCPRODA",31,0)
 D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRODA",32,0)
 ;Select a date range to print
"RTN","PRCPRODA",33,0)
 D DATESEL^PRCPURS2("") I '$G(DATEEND) D Q Q
"RTN","PRCPRODA",34,0)
 S X1=DATEEND,X2=DATESTRT D ^%DTC
"RTN","PRCPRODA",35,0)
 W !,"-- TOTAL NUMBER OF DAYS: ",X+1,!
"RTN","PRCPRODA",36,0)
 K X S X(1)=""
"RTN","PRCPRODA",37,0)
 K X S X(1)="Select the Group categories to display." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRODA",38,0)
 D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRODA",39,0)
 I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) W !,"*** NO GROUP CATEGORIES SELECTED !" D Q Q
"RTN","PRCPRODA",40,0)
 W !,"NOTE:  The report will",$S('$G(GROUPALL):" NOT",1:""),"  include items not stored in a group category."
"RTN","PRCPRODA",41,0)
DESC ; Ask user for Item#/Description sort preference
"RTN","PRCPRODA",42,0)
 S SRT=$$SRTPRMP^PRCPUX2(0)
"RTN","PRCPRODA",43,0)
 Q:SRT=0
"RTN","PRCPRODA",44,0)
 I (+SRT<1)!(SRT>2) G DESC
"RTN","PRCPRODA",45,0)
 ;
"RTN","PRCPRODA",46,0)
BEGIN S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD,HOME^%ZIS K IO("Q"),ZTSK Q
"RTN","PRCPRODA",47,0)
 .  S ZTDESC="ON-DEMAND AUDIT REPORT",ZTRTN="DQ^PRCPRODA"
"RTN","PRCPRODA",48,0)
 .  S ZTSAVE("PRCP*")="",ZTSAVE("GROUP*")="",ZTSAVE("^TMP($J,""PRCPURS1"",")="",ZTSAVE("ZTREQ")="@",ZTSAVE("S*")=""
"RTN","PRCPRODA",49,0)
 .  S ZTSAVE("DATE*")="",ZTSAVE("ITEM*")=""
"RTN","PRCPRODA",50,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRODA",51,0)
DQ ;  queue starts here
"RTN","PRCPRODA",52,0)
 N X,Y,%,ITEMDA,D,CTR,DESCR,ORDER,I,PAGE,SCREEN
"RTN","PRCPRODA",53,0)
 N PRCPFLAG,GRPDESC,DIST,DAT,DATE0,DATE1,DATE2
"RTN","PRCPRODA",54,0)
 I ITEMSEL'="" G REPORT
"RTN","PRCPRODA",55,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S D=$G(^(ITEMDA,0)) I D'="" D
"RTN","PRCPRODA",56,0)
 .; If no audit trail quit
"RTN","PRCPRODA",57,0)
 .I $G(^PRCP(445,PRCP("I"),1,ITEMDA,10,0))="" Q
"RTN","PRCPRODA",58,0)
 .S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA) S:DESCR="" DESCR=" "
"RTN","PRCPRODA",59,0)
 .; Determine the Group
"RTN","PRCPRODA",60,0)
 .S GROUP=+$P(D,"^",21),GRPFLG=GROUP
"RTN","PRCPRODA",61,0)
 .S GROUPYES="NO"
"RTN","PRCPRODA",62,0)
 .I $G(GROUPALL)=1 S GROUPYES="YES"
"RTN","PRCPRODA",63,0)
 .I $G(GROUPALL)="" D
"RTN","PRCPRODA",64,0)
 ..S GR="" F  S GR=$O(^TMP($J,"PRCPURS1","YES",GR)) Q:GR=""  D
"RTN","PRCPRODA",65,0)
 ...I GR=GRPFLG S GROUPYES="YES"
"RTN","PRCPRODA",66,0)
 .Q:GROUPYES="NO"
"RTN","PRCPRODA",67,0)
 .I SRT=1 S ORDER=DESCR
"RTN","PRCPRODA",68,0)
 .I SRT=2 S ORDER=ITEMDA
"RTN","PRCPRODA",69,0)
 .S I=0 F  S I=$O(^PRCP(445,PRCP("I"),1,ITEMDA,10,I)) Q:+I=0  D
"RTN","PRCPRODA",70,0)
 . . S TIMFLG=+$P($G(^PRCP(445,PRCP("I"),1,ITEMDA,10,I,0)),".",1)
"RTN","PRCPRODA",71,0)
 . . Q:TIMFLG<DATESTRT
"RTN","PRCPRODA",72,0)
 . . Q:TIMFLG>DATEEND
"RTN","PRCPRODA",73,0)
 . . S TIMFLG=TIMFLG*(-1)
"RTN","PRCPRODA",74,0)
 . . S ^TMP($J,"PRCPRODA",GRPFLG,PRCP("I"),ORDER,TIMFLG)=ITEMDA_"^"_DESCR_"^"_$G(^PRCP(445,PRCP("I"),1,ITEMDA,10,I,0))
"RTN","PRCPRODA",75,0)
 ;
"RTN","PRCPRODA",76,0)
REPORT ; Print Report
"RTN","PRCPRODA",77,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=$P(Y,"@",1),PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRODA",78,0)
 ;
"RTN","PRCPRODA",79,0)
 S GROUP="" F  S GROUP=$O(^TMP($J,"PRCPRODA",GROUP)) Q:GROUP=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODA",80,0)
 . I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINIATED BY USER >>>" Q
"RTN","PRCPRODA",81,0)
 .I $Y>(IOSL-8) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRODA",82,0)
 .I GROUP=0 S GRPDESC="<<NONE>>"
"RTN","PRCPRODA",83,0)
 .I GROUP'=0 D
"RTN","PRCPRODA",84,0)
 .. S GRPDESC=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRODA",85,0)
 .. S GRPDESC=$E(GRPDESC,1,20)_" (#"_GROUP_")"
"RTN","PRCPRODA",86,0)
 . W !?7,"GROUP:  ",GRPDESC,!
"RTN","PRCPRODA",87,0)
 . S DIST="" F  S DIST=$O(^TMP($J,"PRCPRODA",GROUP,DIST)) Q:DIST=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODA",88,0)
 .. S ORDER="" F  S ORDER=$O(^TMP($J,"PRCPRODA",GROUP,DIST,ORDER)) Q:ORDER=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODA",89,0)
 ... S ITEMFLG=""
"RTN","PRCPRODA",90,0)
 ... S TIMFLG="" F  S TIMFLG=$O(^TMP($J,"PRCPRODA",GROUP,DIST,ORDER,TIMFLG)) Q:TIMFLG=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODA",91,0)
 .... S ITEMDA=$G(^TMP($J,"PRCPRODA",GROUP,DIST,ORDER,TIMFLG)) Q:ITEMDA=""
"RTN","PRCPRODA",92,0)
 .... I ITEMFLG="" D  Q:$D(PRCPFLAG)
"RTN","PRCPRODA",93,0)
 ..... I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRODA",94,0)
 ..... W !,$P(ITEMDA,"^",1),?9,$P(ITEMDA,"^",2) S ITEMFLG="X"
"RTN","PRCPRODA",95,0)
 ....S DATE0=$P(ITEMDA,"^",3),DATE1=$P($$FMTE^XLFDT(DATE0,2),"@",1),DATE2=$P($$FMTE^XLFDT(DATE0,3),"@",2)
"RTN","PRCPRODA",96,0)
 ....S PERS1=$P(ITEMDA,"^",4),PERSNAM=$P(^VA(200,PERS1,20),"^",2)
"RTN","PRCPRODA",97,0)
 ....I $Y>(IOSL-5) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRODA",98,0)
 ....W !,?9,$P(ITEMDA,"^",6),?12,DATE1,?21,DATE2,?32,$E(PERSNAM,1,15),?49,$E($P(ITEMDA,"^",5),1,30)
"RTN","PRCPRODA",99,0)
 ... W !
"RTN","PRCPRODA",100,0)
 .. W !
"RTN","PRCPRODA",101,0)
 I '$G(PRCPFLAG) D END^PRCPUREP
"RTN","PRCPRODA",102,0)
Q D ^%ZISC K ^TMP($J,"PRCPRODA"),^TMP($J,"PRCPURS1")
"RTN","PRCPRODA",103,0)
 Q
"RTN","PRCPRODA",104,0)
H ;PRINT HEADING
"RTN","PRCPRODA",105,0)
 S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRODA",106,0)
 W "ON-DEMAND AUDIT FOR: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRODA",107,0)
 S %="",$P(%,"-",81)=""
"RTN","PRCPRODA",108,0)
 W !,"IM#",?9,"DESCRIPTION"
"RTN","PRCPRODA",109,0)
 W !,?32,"INVENTORY POINT"
"RTN","PRCPRODA",110,0)
 W !,?3,"SETTING",?12,"DATE/TIME",?38,"USER",?49,"REASON"
"RTN","PRCPRODA",111,0)
 W !,%,!
"RTN","PRCPRODA",112,0)
 Q
"RTN","PRCPRODM")
0^24^B47898792^n/a
"RTN","PRCPRODM",1,0)
PRCPRODM ;WOIFO/CC/VAC-On-Demand Conflict Report ; 2/21/07 11:22am
"RTN","PRCPRODM",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRODM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRODM",4,0)
 ;*98 Created to identify items in Primary as ODI but not in Secondary
"RTN","PRCPRODM",5,0)
 Q
"RTN","PRCPRODM",6,0)
PRIM I $G(PRCP("DPTYPE"))="S" D PRIM^PRCPRODS Q
"RTN","PRCPRODM",7,0)
 N CHOICE,CTR,DATA2,DATA3,DISFLG,DISPT,DISTR,GROUP,GROUPALL,GROUPNM,I,IT,ITEM,ITEMNM,ITNAME,J
"RTN","PRCPRODM",8,0)
 N LST,MGRFLG,NOW,NOWDT,ODITEM,ODIUSER,ORD,PAGE,PRCPFLAG,PRI,PRIM,SCREEN,SEC,SECNAME,SRT,USER,X,Y,MAN,RECCNT,GR,GROUPYES
"RTN","PRCPRODM",9,0)
 N POP,ZTDESC,ZTQUEUED,ZTRTN,ZTSAVE
"RTN","PRCPRODM",10,0)
 K ^TMP($J,"PRIM"),^TMP($J,"SEC"),^TMP($J,"COMB")
"RTN","PRCPRODM",11,0)
 S PAGE=1
"RTN","PRCPRODM",12,0)
 D NOW^%DTC S NOWDT=X,Y=% D DD^%DT S NOW=Y,SCREEN=$$SCRPAUSE^PRCPUREP
"RTN","PRCPRODM",13,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRODM",14,0)
 K X S X(1)="The On-Demand Conflict Report shows all items that are On-Demand in the Primary and Standard in the Secondary" D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRODM",15,0)
 S CTR=$P($G(^PRCP(445,PRCP("I"),2,0)),"^",4)
"RTN","PRCPRODM",16,0)
 I +CTR=0 W !,"NO DISTRIBUTION POINTS EXIST FOR THIS PRIMARY" HANG 5 Q
"RTN","PRCPRODM",17,0)
 S DISTR=0 F I=1:1:CTR S DISTR=$O(^PRCP(445,PRCP("I"),2,DISTR)) Q:'DISTR!($G(PRCPFLAG))  D
"RTN","PRCPRODM",18,0)
 .S $P(DISPT(PRCP("I"),DISTR),"^",2)=$$INVNAME^PRCPUX1(DISTR)
"RTN","PRCPRODM",19,0)
QUEST0 ;
"RTN","PRCPRODM",20,0)
 K X S X(1)="Select the DISTRIBUTION POINTS to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRODM",21,0)
 D DISTRSEL^PRCPURS3(PRCP("I"))
"RTN","PRCPRODM",22,0)
QUEST1 ;
"RTN","PRCPRODM",23,0)
 S DISFLG=""
"RTN","PRCPRODM",24,0)
 I $D(^TMP($J,"PRCPURS3","YES"))=0 D FILL G QUEST3
"RTN","PRCPRODM",25,0)
 S X="" F  S X=$O(^TMP($J,"PRCPURS3","YES",X)) Q:X=""  D
"RTN","PRCPRODM",26,0)
 . S $P(DISPT(PRCP("I"),X),"^",1)="*"
"RTN","PRCPRODM",27,0)
QUEST3 ; Select Groups
"RTN","PRCPRODM",28,0)
 S DISTR=""
"RTN","PRCPRODM",29,0)
 F  S DISTR=$O(DISPT(PRCP("I"),DISTR)) Q:DISTR=""  D
"RTN","PRCPRODM",30,0)
 .I $P(DISPT(PRCP("I"),DISTR),"^",1)["*" S DISFLG="Y"
"RTN","PRCPRODM",31,0)
 I DISFLG="" W !,"No Distribution Points picked.  Try again." HANG 5 G QUEST0
"RTN","PRCPRODM",32,0)
 K X S X(1)="Select the Group Categories to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRODM",33,0)
 D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRODM",34,0)
 I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) W !,"*** NO GROUP CATEGORIES SELECTED !" D Q Q
"RTN","PRCPRODM",35,0)
 W !,"NOTE:  The report will",$S('$G(GROUPALL):" NOT",1:"")," include items not stored in a group category."
"RTN","PRCPRODM",36,0)
QUEST4 ; Select Sort order
"RTN","PRCPRODM",37,0)
 K X S X(1)="Select the order in which you want the item information to appear." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRODM",38,0)
 S SRT=$$SRTPRMP^PRCPUX2(0)
"RTN","PRCPRODM",39,0)
 Q:SRT=0
"RTN","PRCPRODM",40,0)
 S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK D ^%ZISC Q
"RTN","PRCPRODM",41,0)
 .   S ZTDESC="On-Demand Conflict Report",ZTRTN="REPORT^PRCPRODM"
"RTN","PRCPRODM",42,0)
 .   S ZTSAVE("S*")="",ZTSAVE("PRCP*")="",ZTSAVE("GR*")="",ZTSAVE("D*")="",ZTSAVE("P*")="",ZTSAVE("C*")="",ZTSAVE("I*")="",ZTSAVE("N*")=""
"RTN","PRCPRODM",43,0)
 .   S ZTSAVE("^TMP($J,""PRCPURS3"",")="",ZTSAVE("O*")="",ZTSAVE("U*")=""
"RTN","PRCPRODM",44,0)
 ;
"RTN","PRCPRODM",45,0)
QUEST5 W !!,"Please wait.  Report compiling and printing."
"RTN","PRCPRODM",46,0)
REPORT ;Now compile the data
"RTN","PRCPRODM",47,0)
 S PRI=PRCP("I")
"RTN","PRCPRODM",48,0)
 S PRIM(PRI)=$P(PRCP("PAR"),"^",1)
"RTN","PRCPRODM",49,0)
 S ITEM=0 F I=1:1 S ITEM=$O(^PRCP(445,PRI,1,ITEM)) Q:+ITEM=0  D
"RTN","PRCPRODM",50,0)
 .S ODITEM=$$ODITEM^PRCPUX2(PRI,ITEM)
"RTN","PRCPRODM",51,0)
 .I ODITEM'="Y" Q
"RTN","PRCPRODM",52,0)
 .S ^TMP($J,"PRIM",ITEM)=$$DESCR^PRCPUX1(PRI,ITEM)
"RTN","PRCPRODM",53,0)
 .S:^TMP($J,"PRIM",ITEM)="" ^TMP($J,"PRIM",ITEM)=" "
"RTN","PRCPRODM",54,0)
 ;Now get items in secondaries that match
"RTN","PRCPRODM",55,0)
 S DISTR=""  F I=1:1 S DISTR=$O(DISPT(PRI,DISTR)) Q:DISTR=""  D
"RTN","PRCPRODM",56,0)
 .Q:$P($G(DISPT(PRI,DISTR)),"^",1)'="*"
"RTN","PRCPRODM",57,0)
 .S ITEM=0 F J=1:1 S ITEM=$O(^TMP($J,"PRIM",ITEM)) Q:+ITEM=0  D
"RTN","PRCPRODM",58,0)
 ..Q:$G(^PRCP(445,DISTR,1,ITEM,0))=""
"RTN","PRCPRODM",59,0)
 ..S ODITEM=$$ODITEM^PRCPUX2(DISTR,ITEM)
"RTN","PRCPRODM",60,0)
 ..S MAN=$P($G(^PRCP(445,DISTR,1,ITEM,0)),"^",12)
"RTN","PRCPRODM",61,0)
 ..I PRI'=$P(MAN,";",1) Q
"RTN","PRCPRODM",62,0)
 ..I ODITEM="Y" Q
"RTN","PRCPRODM",63,0)
 ..S $P(^TMP($J,"SEC",DISTR,ITEM),"^",1)=^TMP($J,"PRIM",ITEM)
"RTN","PRCPRODM",64,0)
 ; Now put in order by group and sort sequence
"RTN","PRCPRODM",65,0)
 S DISTR="" F  S DISTR=$O(^TMP($J,"SEC",DISTR)) Q:DISTR=""  D
"RTN","PRCPRODM",66,0)
 .S ITEM="" F  S ITEM=$O(^TMP($J,"SEC",DISTR,ITEM)) Q:ITEM=""  D
"RTN","PRCPRODM",67,0)
 ..S DATA2=$G(^PRCP(445,PRI,1,ITEM,0))
"RTN","PRCPRODM",68,0)
 ..Q:DATA2=""
"RTN","PRCPRODM",69,0)
 ..S GROUP=+$P(DATA2,"^",21)
"RTN","PRCPRODM",70,0)
 ..;Determine if the item is in the group
"RTN","PRCPRODM",71,0)
 ..S GROUPYES="YES"
"RTN","PRCPRODM",72,0)
 ..I $G(GROUPALL)="" S GROUPYES="NO" D
"RTN","PRCPRODM",73,0)
 ...S GR="" F  S GR=$O(^TMP($J,"PRCPURS1","YES",GR)) Q:GR=""  D
"RTN","PRCPRODM",74,0)
 ....I GR=GROUP S GROUPYES="YES"
"RTN","PRCPRODM",75,0)
 ..Q:GROUPYES="NO"
"RTN","PRCPRODM",76,0)
 ..S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRODM",77,0)
 ..I GROUPNM'="" S GROUP=$P(GROUPNM,":",2)
"RTN","PRCPRODM",78,0)
 ..I GROUPNM="" S GROUP=+GROUPNM
"RTN","PRCPRODM",79,0)
 ..S ITEMNM=$P($G(^TMP($J,"SEC",DISTR,ITEM)),"^",1)
"RTN","PRCPRODM",80,0)
 ..S ORD=ITEM
"RTN","PRCPRODM",81,0)
 ..I SRT=1 S ORD=ITEMNM
"RTN","PRCPRODM",82,0)
 ..S ^TMP($J,"COMB",PRI,DISTR,GROUP,ORD)=ITEM_"^"_ITEMNM
"RTN","PRCPRODM",83,0)
REP ;Now print the report
"RTN","PRCPRODM",84,0)
 S PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO
"RTN","PRCPRODM",85,0)
 S RECCNT=0
"RTN","PRCPRODM",86,0)
 S PRIM="" F  S PRIM=$O(^TMP($J,"COMB",PRIM)) Q:PRIM=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODM",87,0)
 .S SEC="" F  S SEC=$O(^TMP($J,"COMB",PRIM,SEC)) Q:SEC=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODM",88,0)
 ..D:PAGE>1&SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODM",89,0)
 ..S GROUP="" F  S GROUP=$O(^TMP($J,"COMB",PRIM,SEC,GROUP)) Q:GROUP=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODM",90,0)
 ...I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODM",91,0)
 ...Q:$D(PRCPFLAG)
"RTN","PRCPRODM",92,0)
 ...I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !,?10,"<<<TASKMANAGER JOB TERMINATED BY USER >>>"
"RTN","PRCPRODM",93,0)
 ...W !,"GROUP: " I GROUP'=0 W GROUP,!
"RTN","PRCPRODM",94,0)
 ...I GROUP=0 W "<<NONE>>",!
"RTN","PRCPRODM",95,0)
 ...S ORD="" F  S ORD=$O(^TMP($J,"COMB",PRIM,SEC,GROUP,ORD)) Q:ORD=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODM",96,0)
 ....S DATA3=$G(^TMP($J,"COMB",PRIM,SEC,GROUP,ORD))
"RTN","PRCPRODM",97,0)
 ....S IT=$P(DATA3,"^",1),ITNAME=$P(DATA3,"^",2)
"RTN","PRCPRODM",98,0)
 ....S RECCNT=RECCNT+1
"RTN","PRCPRODM",99,0)
 ....I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODM",100,0)
 ....Q:$D(PRCPFLAG)
"RTN","PRCPRODM",101,0)
 ....I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>"
"RTN","PRCPRODM",102,0)
 ....Q:$D(PRCPFLAG)
"RTN","PRCPRODM",103,0)
 ....W ?1,IT,?11,ITNAME,!
"RTN","PRCPRODM",104,0)
 ...Q:$D(PRCPFLAG)
"RTN","PRCPRODM",105,0)
 ..Q:$D(PRCPFLAG)
"RTN","PRCPRODM",106,0)
 ..; Print authorized users
"RTN","PRCPRODM",107,0)
 ..I $Y>(IOSL-8) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODM",108,0)
 ..W !!,"AUTHORIZED ON-DEMAND USERS"
"RTN","PRCPRODM",109,0)
 ..W !,"--------------------------",!
"RTN","PRCPRODM",110,0)
 ..; I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODM",111,0)
 ..W PRIM(PRI),":"
"RTN","PRCPRODM",112,0)
 ..S USER=0 F  S USER=$O(^PRCP(445,PRI,4,USER)) Q:USER=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODM",113,0)
 ...S MGRFLG=""
"RTN","PRCPRODM",114,0)
 ...I $G(^PRCP(445,PRI,9,0))'="" D
"RTN","PRCPRODM",115,0)
 ....S LST=$P($G(^PRCP(445,PRI,9,0)),"^",4)
"RTN","PRCPRODM",116,0)
 ....S ODIUSER=0 F  S ODIUSER=$O(^PRCP(445,PRI,9,ODIUSER)) Q:+ODIUSER=0  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODM",117,0)
 .....I $G(^PRCP(445,PRI,9,ODIUSER,0))=USER D
"RTN","PRCPRODM",118,0)
 ......I $Y>(IOSL-5) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODM",119,0)
 ......W ?30,$E($$USER^PRCPUREP(USER),1,30),!
"RTN","PRCPRODM",120,0)
 ......Q:$D(PRCPFLAG)
"RTN","PRCPRODM",121,0)
 .....Q:$D(PRCPFLAG)
"RTN","PRCPRODM",122,0)
 ....Q:$D(PRCPFLAG)
"RTN","PRCPRODM",123,0)
 ...Q:$D(PRCPFLAG)
"RTN","PRCPRODM",124,0)
 ..Q:$D(PRCPFLAG)
"RTN","PRCPRODM",125,0)
 ..;Display secondary authorized users
"RTN","PRCPRODM",126,0)
 ..S SECNAME=$P($G(^PRCP(445,SEC,0)),"^",1)
"RTN","PRCPRODM",127,0)
 ..W !,$E(SECNAME,1,28),":"
"RTN","PRCPRODM",128,0)
 ..S USER=0 F  S USER=$O(^PRCP(445,SEC,4,USER)) Q:USER=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODM",129,0)
 ...S MGRFLG=""
"RTN","PRCPRODM",130,0)
 ...I $G(^PRCP(445,SEC,9,0))'="" D
"RTN","PRCPRODM",131,0)
 ....S ODIUSER=0
"RTN","PRCPRODM",132,0)
 ....F  S ODIUSER=$O(^PRCP(445,SEC,9,ODIUSER)) Q:+ODIUSER=0  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODM",133,0)
 .....I $G(^PRCP(445,SEC,9,ODIUSER,0))=USER D
"RTN","PRCPRODM",134,0)
 ......I $Y>(IOSL-5) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODM",135,0)
 ......W ?30,$E($$USER^PRCPUREP(USER),1,30),!
"RTN","PRCPRODM",136,0)
 ......Q:$D(PRCPFLAG)
"RTN","PRCPRODM",137,0)
 .....Q:$D(PRCPFLAG)
"RTN","PRCPRODM",138,0)
 ....Q:$D(PRCPFLAG)
"RTN","PRCPRODM",139,0)
 ...Q:$D(PRCPFLAG)
"RTN","PRCPRODM",140,0)
 ..Q:$D(PRCPFLAG)
"RTN","PRCPRODM",141,0)
 .Q:$D(PRCPFLAG)
"RTN","PRCPRODM",142,0)
 I RECCNT=0 D HEAD2 W !,?27,"*** NO CONFLICTS TO PRINT ***",!
"RTN","PRCPRODM",143,0)
 D END^PRCPUREP
"RTN","PRCPRODM",144,0)
 D Q Q
"RTN","PRCPRODM",145,0)
 ;
"RTN","PRCPRODM",146,0)
DISPL ; Display the information about the secondaries
"RTN","PRCPRODM",147,0)
 S DISTR="" F J=1:1  S DISTR=$O(DISPT(PRCP("I"),DISTR)) Q:DISTR=""  D
"RTN","PRCPRODM",148,0)
 . W !,?1,DISTR,?6,$P(DISPT(PRCP("I"),DISTR),"^",1),?8,$P(DISPT(PRCP("I"),DISTR),"^",2)
"RTN","PRCPRODM",149,0)
 Q
"RTN","PRCPRODM",150,0)
FILL S DISTR="" F I=1:1  S DISTR=$O(DISPT(PRCP("I"),DISTR)) Q:DISTR=""  S $P(DISPT(PRCP("I"),DISTR),"^",1)="*"
"RTN","PRCPRODM",151,0)
 Q
"RTN","PRCPRODM",152,0)
HEAD ;Display header information
"RTN","PRCPRODM",153,0)
 Q:$D(PRCPFLAG)
"RTN","PRCPRODM",154,0)
 S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRODM",155,0)
 S SECNAME=$P($G(^PRCP(445,SEC,0)),"^",1)
"RTN","PRCPRODM",156,0)
 W !,"ON-DEMAND CONFLICTS IN: ",$E(SECNAME,1,24),?48,%
"RTN","PRCPRODM",157,0)
 W !,"PRIMARY INVENTORY POINT: ",PRIM(PRI)
"RTN","PRCPRODM",158,0)
 W !!,"IM#",?11,"DESCRIPTION"
"RTN","PRCPRODM",159,0)
 S %="",$P(%,"-",80)="" W !,%,!
"RTN","PRCPRODM",160,0)
 K PRCPFLAG
"RTN","PRCPRODM",161,0)
 Q
"RTN","PRCPRODM",162,0)
HEAD2 S %=NOW_" PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRODM",163,0)
 W !,"ON-DEMAND CONFLICT REPORT",?48,%
"RTN","PRCPRODM",164,0)
 W !,"PRIMARY INVENTORY POINT: ",PRIM(PRI)
"RTN","PRCPRODM",165,0)
 W !!,"IM#",?11,"DESCRIPTION"
"RTN","PRCPRODM",166,0)
 S %="",$P(%,"-",80)="" W !,%,!
"RTN","PRCPRODM",167,0)
 Q
"RTN","PRCPRODM",168,0)
Q D ^%ZISC K ^TMP($J,"PRIM"),^TMP($J,"SEC"),^TMP($J,"COMB")
"RTN","PRCPRODM",169,0)
 Q
"RTN","PRCPRODS")
0^51^B26200620^n/a
"RTN","PRCPRODS",1,0)
PRCPRODS ;WOIFO/CC/VAC-On-Demand Conflict Report Secondary ; 2/22/07 9:38am
"RTN","PRCPRODS",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRODS",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRODS",4,0)
 ;*98 Created to identify items in Secondary as ODI but not in Primary
"RTN","PRCPRODS",5,0)
 Q
"RTN","PRCPRODS",6,0)
PRIM N CTR,I,ITEM,ITEMNAM,J,SECNAME,TOTREC
"RTN","PRCPRODS",7,0)
 N LST,MGRFLG,NOW,NOWDT,PAGE,PRCPFLAG,PRI,PRIM,SCREEN,SEC,SECNAME,SRT,SORT,USER,X,Y,RECCNT,ODIFLAG,ODIFLAG2,PRINAME
"RTN","PRCPRODS",8,0)
 N POP,ZTDESC,ZTQUEUED,ZTRTN,ZTSAVE
"RTN","PRCPRODS",9,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRODS",10,0)
 K ^TMP($J,"PRCPRODS")
"RTN","PRCPRODS",11,0)
 S PAGE=1
"RTN","PRCPRODS",12,0)
 D NOW^%DTC S NOWDT=X,Y=% D DD^%DT S NOW=Y,SCREEN=$$SCRPAUSE^PRCPUREP
"RTN","PRCPRODS",13,0)
 K X S X(1)="The On-Demand Conflict Report shows all items that are On-Demand in the Primary and Standard in the Secondary" D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRODS",14,0)
 S CTR=0
"RTN","PRCPRODS",15,0)
 S X="" F  S X=$O(^PRCP(445,PRCP("I"),1,"AC",X)) Q:X=""  S CTR=CTR+1
"RTN","PRCPRODS",16,0)
 I +CTR=0 W !,"NO PRIMARY CROSS REFERENCES EXIST FOR THIS SECONDARY" HANG 5 Q
"RTN","PRCPRODS",17,0)
QUEST ; Select Sort order
"RTN","PRCPRODS",18,0)
 S SRT=$$SRTPRMP^PRCPUX2(0)
"RTN","PRCPRODS",19,0)
 Q:SRT=0
"RTN","PRCPRODS",20,0)
 S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRODS",21,0)
 .S ZTDESC="On Demand Conflict Report",ZTRTN="REPORT^PRCPRODS"
"RTN","PRCPRODS",22,0)
 .S ZTSAVE("PRCP*")="",ZTSAVE("REPTYPE")="",ZTSAVE("S*")="",ZTSAVE("END*")="",ZTSAVE("NOW*")="",ZTSAVE("COMDT")="",ZTSAVE("PERCENT")="",ZTSAVE("REP")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRODS",23,0)
 .S ZTSAVE("S*")="",ZTSAVE("C*")=""
"RTN","PRCPRODS",24,0)
 ;
"RTN","PRCPRODS",25,0)
QUEST2 W !!,"Please wait.  Report compiling and printing."
"RTN","PRCPRODS",26,0)
REPORT ;Now compile the data
"RTN","PRCPRODS",27,0)
 S PRIM=""
"RTN","PRCPRODS",28,0)
 S PRI="" F  S PRI=$O(^PRCP(445,PRCP("I"),1,"AC",PRI)) Q:PRI=""  D
"RTN","PRCPRODS",29,0)
 .I PRIM="" S PRIM=$P(PRI,";",1)
"RTN","PRCPRODS",30,0)
 .I PRIM'=$P(PRI,";",1) D
"RTN","PRCPRODS",31,0)
 .. S PRIM=$P(PRI,";",1)
"RTN","PRCPRODS",32,0)
 .S ITEM=""
"RTN","PRCPRODS",33,0)
 .F  S ITEM=$O(^PRCP(445,PRCP("I"),1,"AC",PRI,ITEM)) Q:ITEM=""  D
"RTN","PRCPRODS",34,0)
 ..S ODIFLAG=$$ODITEM^PRCPUX2(PRCP("I"),ITEM)
"RTN","PRCPRODS",35,0)
 ..S ODIFLAG2=$$ODITEM^PRCPUX2(PRIM,ITEM)
"RTN","PRCPRODS",36,0)
 ..;S ITEMNAM=$P($G(^PRCP(445,PRCP("I"),1,ITEM,6)),"^",1)
"RTN","PRCPRODS",37,0)
 ..S ITEMNAM=$$DESCR^PRCPUX1(PRCP("I"),ITEM) S:ITEMNAM="" ITEMNAM=" "
"RTN","PRCPRODS",38,0)
 ..S SORT=ITEMNAM
"RTN","PRCPRODS",39,0)
 ..I SRT=2 S SORT=ITEM
"RTN","PRCPRODS",40,0)
 ..I ODIFLAG2="Y" D
"RTN","PRCPRODS",41,0)
 ...I (ODIFLAG="N")!(ODIFLAG="") D
"RTN","PRCPRODS",42,0)
 ....S ^TMP($J,"PRCPRODS",PRCP("I"),PRIM,SORT,ITEM)=ITEMNAM
"RTN","PRCPRODS",43,0)
RPT ;Now print the report
"RTN","PRCPRODS",44,0)
 S PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO
"RTN","PRCPRODS",45,0)
 S TOTREC=0
"RTN","PRCPRODS",46,0)
 S SEC=""
"RTN","PRCPRODS",47,0)
 F  S SEC=$O(^TMP($J,"PRCPRODS",SEC)) Q:SEC=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODS",48,0)
 .S PRIM=""
"RTN","PRCPRODS",49,0)
 .F  S PRIM=$O(^TMP($J,"PRCPRODS",SEC,PRIM)) Q:PRIM=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODS",50,0)
 ..S PRINAME=$P($G(^PRCP(445,PRIM,0)),"^",1)
"RTN","PRCPRODS",51,0)
 ..D:PAGE>1&SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODS",52,0)
 ..S RECCNT=0
"RTN","PRCPRODS",53,0)
 ..S SORT=""
"RTN","PRCPRODS",54,0)
 ..F  S SORT=$O(^TMP($J,"PRCPRODS",SEC,PRIM,SORT)) Q:SORT=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODS",55,0)
 ...S ITEM=""
"RTN","PRCPRODS",56,0)
 ...F  S ITEM=$O(^TMP($J,"PRCPRODS",SEC,PRIM,SORT,ITEM)) Q:ITEM=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODS",57,0)
 ....S ITEMNAM=$G(^TMP($J,"PRCPRODS",SEC,PRIM,SORT,ITEM))
"RTN","PRCPRODS",58,0)
 ....W !,ITEM,?11,ITEMNAM
"RTN","PRCPRODS",59,0)
 ....S RECCNT=RECCNT+1,TOTREC=TOTREC+1
"RTN","PRCPRODS",60,0)
 ....I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODS",61,0)
 ....I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !,?10,"<<<TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRODS",62,0)
 ...I RECCNT=0 W !,"No Records Found",!
"RTN","PRCPRODS",63,0)
 ...Q
"RTN","PRCPRODS",64,0)
 ..I '$D(PRCPFLAG) D A
"RTN","PRCPRODS",65,0)
 .Q
"RTN","PRCPRODS",66,0)
 ;
"RTN","PRCPRODS",67,0)
 I TOTREC=0 D HEAD2 W !?27,"*** NO CONFLICTS TO PRINT ***"
"RTN","PRCPRODS",68,0)
 I '$D(PRCPFLAG) D:SCREEN END^PRCPUREP
"RTN","PRCPRODS",69,0)
 D ^%ZISC
"RTN","PRCPRODS",70,0)
 D Q Q
"RTN","PRCPRODS",71,0)
 ;
"RTN","PRCPRODS",72,0)
A ; Print authorized users
"RTN","PRCPRODS",73,0)
 I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODS",74,0)
 S SECNAME=$P($G(^PRCP(445,SEC,0)),"^",1)
"RTN","PRCPRODS",75,0)
 W !!,"AUTHORIZED ON-DEMAND USERS"
"RTN","PRCPRODS",76,0)
 W !,"--------------------------"
"RTN","PRCPRODS",77,0)
 W !,SECNAME,":"
"RTN","PRCPRODS",78,0)
 S USER=0 F  S USER=$O(^PRCP(445,SEC,4,USER)) Q:USER=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODS",79,0)
 .S MGRFLG=""
"RTN","PRCPRODS",80,0)
 .I $G(^PRCP(445,SEC,9,0))'="" D
"RTN","PRCPRODS",81,0)
 ..S LST=$P($G(^PRCP(445,SEC,9,0)),"^",4)
"RTN","PRCPRODS",82,0)
 ..S J=0
"RTN","PRCPRODS",83,0)
 ..F I=1:1:LST D  Q:$D(PRCPFLAG)
"RTN","PRCPRODS",84,0)
 ...S J=$O(^PRCP(445,SEC,9,J))
"RTN","PRCPRODS",85,0)
 ...I $G(^PRCP(445,SEC,9,J,0))=USER D
"RTN","PRCPRODS",86,0)
 ....I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODS",87,0)
 ....I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>"
"RTN","PRCPRODS",88,0)
 ....Q:$D(PRCPFLAG)
"RTN","PRCPRODS",89,0)
 ....W ?30,$E($$USER^PRCPUREP(USER),1,30),!
"RTN","PRCPRODS",90,0)
 ...Q:$D(PRCPFLAG)
"RTN","PRCPRODS",91,0)
 ..Q:$D(PRCPFLAG)
"RTN","PRCPRODS",92,0)
 .Q:$D(PRCPFLAG)
"RTN","PRCPRODS",93,0)
 D B
"RTN","PRCPRODS",94,0)
 Q
"RTN","PRCPRODS",95,0)
B ; Display Primary authorized users
"RTN","PRCPRODS",96,0)
 I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODS",97,0)
 S PRINAME=$P($G(^PRCP(445,PRIM,0)),"^",1)
"RTN","PRCPRODS",98,0)
 W !
"RTN","PRCPRODS",99,0)
 W $E(PRINAME,1,28),":"
"RTN","PRCPRODS",100,0)
 S USER=0 F  S USER=$O(^PRCP(445,PRIM,4,USER)) Q:USER=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRODS",101,0)
 .S MGRFLG=""
"RTN","PRCPRODS",102,0)
 .I $G(^PRCP(445,PRIM,9,0))'="" D
"RTN","PRCPRODS",103,0)
 ..S LST=$P($G(^PRCP(445,PRIM,9,0)),"^",4)
"RTN","PRCPRODS",104,0)
 ..S J=0
"RTN","PRCPRODS",105,0)
 ..F I=1:1:LST D  Q:$D(PRCPFLAG)
"RTN","PRCPRODS",106,0)
 ...S J=$O(^PRCP(445,PRIM,9,J))
"RTN","PRCPRODS",107,0)
 ...I $G(^PRCP(445,PRIM,9,J,0))=USER D  Q:$D(PRCPFLAG)
"RTN","PRCPRODS",108,0)
 ....I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D HEAD
"RTN","PRCPRODS",109,0)
 ....I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<<TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRODS",110,0)
 ....W ?30,$E($$USER^PRCPUREP(USER),1,30),!
"RTN","PRCPRODS",111,0)
 ...Q:$D(PRCPFLAG)
"RTN","PRCPRODS",112,0)
 ..Q:$D(PRCPFLAG)
"RTN","PRCPRODS",113,0)
 .Q:$D(PRCPFLAG)
"RTN","PRCPRODS",114,0)
 Q:$D(PRCPFLAG)
"RTN","PRCPRODS",115,0)
 Q
"RTN","PRCPRODS",116,0)
 ;
"RTN","PRCPRODS",117,0)
HEAD ;Display header information
"RTN","PRCPRODS",118,0)
 Q:$D(PRCPFLAG)
"RTN","PRCPRODS",119,0)
 S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRODS",120,0)
 S SECNAME=$P($G(^PRCP(445,SEC,0)),"^",1)
"RTN","PRCPRODS",121,0)
 W !,"ON-DEMAND CONFLICTS IN: ",$E(SECNAME,1,24),?50,%
"RTN","PRCPRODS",122,0)
 W !,"PRIMARY INVENTORY POINT: ",PRINAME
"RTN","PRCPRODS",123,0)
 W !!,"IM#",?11,"DESCRIPTION"
"RTN","PRCPRODS",124,0)
 S %="",$P(%,"-",80)="" W !,%,!
"RTN","PRCPRODS",125,0)
 Q
"RTN","PRCPRODS",126,0)
HEAD2 ;Display header if no records found
"RTN","PRCPRODS",127,0)
 S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRODS",128,0)
 W !,"SECONDARY ON-DEMAND CONFLICT REPORT",?50,%
"RTN","PRCPRODS",129,0)
 W !!,"IM#",?11,"DESCRIPTION"
"RTN","PRCPRODS",130,0)
 S %="",$P(%,"-",80)="" W !,%,!
"RTN","PRCPRODS",131,0)
 Q
"RTN","PRCPRODS",132,0)
Q K ^TMP($J,"PRCPRODS")
"RTN","PRCPRODS",133,0)
 Q
"RTN","PRCPRSO1")
0^25^B14821624^B13281855
"RTN","PRCPRSO1",1,0)
PRCPRSO1 ;WISC/RFJ/VAC-days of stock on hand report (print)             ; 9/20/06 11:15am
"RTN","PRCPRSO1",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRSO1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRSO1",4,0)
 ;
"RTN","PRCPRSO1",5,0)
 ;*98 Modified to show Standard, ODI or Both
"RTN","PRCPRSO1",6,0)
 Q
"RTN","PRCPRSO1",7,0)
 ;
"RTN","PRCPRSO1",8,0)
 ;
"RTN","PRCPRSO1",9,0)
PRINT ;  print report
"RTN","PRCPRSO1",10,0)
 N %,%H,%I,D,DESCR,GROUP,ITEMDA,NOW,NSN,PAGE,PRCPFLAG,SCREEN,TOTAL,X,Y
"RTN","PRCPRSO1",11,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRSO1",12,0)
 I PRCP("DPTYPE")="W" D WHSE
"RTN","PRCPRSO1",13,0)
 I PRCP("DPTYPE")'="W" D PRIMARY
"RTN","PRCPRSO1",14,0)
 I '$G(PRCPFLAG),$Y>(IOSL-3) D:SCREEN P^PRCPUREP I '$G(PRCPFLAG) D H
"RTN","PRCPRSO1",15,0)
 I $G(PRCPFLAG) Q
"RTN","PRCPRSO1",16,0)
 W !!?38,"TOTAL SELLING VALUE IN STOCK: ",$J(TOTAL,12,2)
"RTN","PRCPRSO1",17,0)
 D END^PRCPUREP
"RTN","PRCPRSO1",18,0)
 Q
"RTN","PRCPRSO1",19,0)
 ;
"RTN","PRCPRSO1",20,0)
 ;
"RTN","PRCPRSO1",21,0)
WHSE ;  print whse report
"RTN","PRCPRSO1",22,0)
 S TOTAL=0,NSN="" F  S NSN=$O(^TMP($J,"PRCPRSOH",NSN)) Q:NSN=""!($G(PRCPFLAG))  S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPRSOH",NSN,ITEMDA)) Q:'ITEMDA!($G(PRCPFLAG))  S D=^(ITEMDA) D
"RTN","PRCPRSO1",23,0)
 .   I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRSO1",24,0)
 .   W !,$TR(NSN,"-"),?15,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,15),?31,ITEMDA,?37,$J($$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/"),8)
"RTN","PRCPRSO1",25,0)
 .   S TOTAL=TOTAL+$P(D,"^",5)
"RTN","PRCPRSO1",26,0)
 .   I $P(D,"^",5)>99999.99 S $P(D,"^",5)=">99999"
"RTN","PRCPRSO1",27,0)
 .   I $P(D,"^",4)>9999 S $P(D,"^",4)=">9999"
"RTN","PRCPRSO1",28,0)
 .   I $P(D,"^",3)>9999 S $P(D,"^",3)=">9999"
"RTN","PRCPRSO1",29,0)
 .   I $P(D,"^",2)>99.99 S $P(D,"^",2)=">99.99"
"RTN","PRCPRSO1",30,0)
 .   I $P(D,"^")>99999 S $P(D,"^")=">99999"
"RTN","PRCPRSO1",31,0)
 .   W ?45,$J($P(D,"^"),7),$J($P(D,"^",2),7),$J($P(D,"^",3),6),$J($P(D,"^",4),6),$J($P(D,"^",5),9)
"RTN","PRCPRSO1",32,0)
 .   I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRSO1",33,0)
 Q
"RTN","PRCPRSO1",34,0)
 ;
"RTN","PRCPRSO1",35,0)
 ;
"RTN","PRCPRSO1",36,0)
PRIMARY ;  print primary or secondary report
"RTN","PRCPRSO1",37,0)
 S TOTAL=0,GROUP="" F  S GROUP=$O(^TMP($J,"PRCPRSOH",GROUP)) Q:GROUP=""!($G(PRCPFLAG))  D
"RTN","PRCPRSO1",38,0)
 .   I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRSO1",39,0)
 .   I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRSO1",40,0)
 .   W !!?5,"GROUP: ",$S(GROUP=" ":"<<NONE>>",1:GROUP)
"RTN","PRCPRSO1",41,0)
 .   S DESCR="" F  S DESCR=$O(^TMP($J,"PRCPRSOH",GROUP,DESCR)) Q:DESCR=""!($G(PRCPFLAG))  S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"PRCPRSOH",GROUP,DESCR,ITEMDA)) Q:'ITEMDA!($G(PRCPFLAG))  S D=^(ITEMDA) D
"RTN","PRCPRSO1",42,0)
 .   .   W !,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,30),?31,ITEMDA,?37,$J($$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/"),8)
"RTN","PRCPRSO1",43,0)
 .   .   S TOTAL=TOTAL+$P(D,"^",5)
"RTN","PRCPRSO1",44,0)
 .   .   I $P(D,"^",5)>99999.99 S $P(D,"^",5)=">99999"
"RTN","PRCPRSO1",45,0)
 .   .   I $P(D,"^",4)>9999 S $P(D,"^",4)=">9999"
"RTN","PRCPRSO1",46,0)
 .   .   I $P(D,"^",3)>9999 S $P(D,"^",3)=">9999"
"RTN","PRCPRSO1",47,0)
 .   .   I $P(D,"^",2)>99.99 S $P(D,"^",2)=">99.99"
"RTN","PRCPRSO1",48,0)
 .   .   I $P(D,"^")>99999 S $P(D,"^")=">99999"
"RTN","PRCPRSO1",49,0)
 .   .   W ?45,$J($P(D,"^"),7),$J($P(D,"^",2),7),$J($P(D,"^",3),6),$J($P(D,"^",4),6),$J($P(D,"^",5),9)
"RTN","PRCPRSO1",50,0)
 .   .   I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRSO1",51,0)
 Q
"RTN","PRCPRSO1",52,0)
 ;
"RTN","PRCPRSO1",53,0)
 ;
"RTN","PRCPRSO1",54,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRSO1",55,0)
 W $C(13),"DAYS OF STOCK ON HAND REPORT: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRSO1",56,0)
 S %="",$P(%,"-",81)=""
"RTN","PRCPRSO1",57,0)
 W !?5,"USAGE DATE RANGE FROM ",DATESTRD,"  TO  ",DATEENDD,"  (",TOTALDAY," DAYS)"
"RTN","PRCPRSO1",58,0)
 W !?5,"ITEMS WITH STOCK ON HAND ",$S(PRCPTYPE=1:"LESS",1:"GREATER")," THAN ",PRCPDAYS," DAYS"
"RTN","PRCPRSO1",59,0)
 I PRCP("DPTYPE")'="W" D
"RTN","PRCPRSO1",60,0)
 . I ODIFLG=1 W !?5,"REPORT SHOWS STANDARD ITEMS ONLY"
"RTN","PRCPRSO1",61,0)
 . I ODIFLG=2 W !?5,"REPORT SHOWS ON-DEMAND ITEMS ONLY"
"RTN","PRCPRSO1",62,0)
 . I ODIFLG=3 W !?5,"REPORT SHOWS BOTH STANDARD AND ON-DEMAND ITEMS"
"RTN","PRCPRSO1",63,0)
 W !?45,$J("TOTAL",7),$J("DAYS",7),$J("QTY",6),$J("DAYS",6),$J("SELL",9)
"RTN","PRCPRSO1",64,0)
 I PRCP("DPTYPE")="W" W !,"NSN",?15,"DESCRIPTION"
"RTN","PRCPRSO1",65,0)
 E  W !,"DESCRIPTION"
"RTN","PRCPRSO1",66,0)
 W ?31,"IM",$J("UNIT/IS",12),?45,$J("USAGE",7),$J("AVG",7),$J("ONHND",6),$J("LEFT",6),$J("VALUE",9),!,%
"RTN","PRCPRSO1",67,0)
 Q
"RTN","PRCPRSOH")
0^26^B24420509^B20391419
"RTN","PRCPRSOH",1,0)
PRCPRSOH ;WISC/RFJ/DAP/VAC-days of stock on hand report ; 10/19/06 9:09am
"RTN","PRCPRSOH",2,0)
 ;;5.1;IFCAP;**84,83,98**;Oct 20, 2000;Build 37
"RTN","PRCPRSOH",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRSOH",4,0)
 ;
"RTN","PRCPRSOH",5,0)
 ;*83 Routine PRCPLO associated with PRC*5.1*83 is a modified copy of
"RTN","PRCPRSOH",6,0)
 ;this routine and any changes made to this routine should also be
"RTN","PRCPRSOH",7,0)
 ;considered for that routine as well.
"RTN","PRCPRSOH",8,0)
 ;
"RTN","PRCPRSOH",9,0)
 ;*98 Modified to show if Standard, On-Demand or Both
"RTN","PRCPRSOH",10,0)
 ;
"RTN","PRCPRSOH",11,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRSOH",12,0)
 N DATEEND,DATEENDD,DATESTRD,DATESTRT,DAYSLEFT,DIR,GROUPALL,PRCPDAYS,PRCPEND,PRCPSTRT,PRCPTYPE,TOTALDAY,X,X1,X2,Y
"RTN","PRCPRSOH",13,0)
 N ODIFLG,ODITEM,USEFLG
"RTN","PRCPRSOH",14,0)
 K X S X(1)="The Days Of Stock On Hand Report will print a list of items which have stock on hand less than or greater than a specified number of days."
"RTN","PRCPRSOH",15,0)
 D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRSOH",16,0)
 K X S X(1)="Select the date range which should be used for calculating the daily usage. *** Select by month & year only. ***" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSOH",17,0)
 D MONTHSEL^PRCPURS2 I '$G(DATEEND) Q
"RTN","PRCPRSOH",18,0)
 S X1=DATEEND,X2=DATESTRT D ^%DTC S TOTALDAY=X+1
"RTN","PRCPRSOH",19,0)
 S Y=DATEEND D DD^%DT S DATEENDD=Y,Y=DATESTRT D DD^%DT S DATESTRD=Y
"RTN","PRCPRSOH",20,0)
 W !?5,"-- TOTAL NUMBER OF DAYS: ",TOTALDAY
"RTN","PRCPRSOH",21,0)
 ;  select greater or less
"RTN","PRCPRSOH",22,0)
 K X S X(1)="Select the type of report: less than a specified number of days or greater than a specified number of days." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSOH",23,0)
 S DIR(0)="S^1:LESS;2:GREATER",DIR("A")="Print items with GREATER or LESS than 'X' days stock on hand",DIR("B")="LESS"
"RTN","PRCPRSOH",24,0)
 D ^DIR S PRCPTYPE=+Y I 'PRCPTYPE Q
"RTN","PRCPRSOH",25,0)
 ;  select days
"RTN","PRCPRSOH",26,0)
 K X S X(1)="Select the number of days which the current stock on hand should be "_$S(PRCPTYPE=1:"LESS than",1:"GREATER than")_"." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSOH",27,0)
 S DIR(0)="N^1:365",DIR("A")="Print items with stock on hand "_$S(PRCPTYPE=1:"less than",1:"greater than")_" DAYS",DIR("B")=30
"RTN","PRCPRSOH",28,0)
 D ^DIR S PRCPDAYS=+Y I 'PRCPDAYS Q
"RTN","PRCPRSOH",29,0)
 ;  whse sort
"RTN","PRCPRSOH",30,0)
 I PRCP("DPTYPE")="W" D  I '$D(PRCPSTRT) Q
"RTN","PRCPRSOH",31,0)
 .   K X S X(1)="Select the range of NSNs to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSOH",32,0)
 .   D NSNSEL^PRCPURS0
"RTN","PRCPRSOH",33,0)
 ;  prim/seco sort
"RTN","PRCPRSOH",34,0)
 I PRCP("DPTYPE")'="W" D  I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) W !,"*** NO GROUP CATEGORIES SELECTED !" Q
"RTN","PRCPRSOH",35,0)
 .   K X S X(1)="Select the Group Categories to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSOH",36,0)
 .   D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRSOH",37,0)
 ;
"RTN","PRCPRSOH",38,0)
ODIFLG ;*98 Set flag for Standard, On-Demand item or Both
"RTN","PRCPRSOH",39,0)
 S ODIFLG="W"
"RTN","PRCPRSOH",40,0)
 I PRCP("DPTYPE")'="W" S ODIFLG=$$ODIPROM^PRCPUX2(0)
"RTN","PRCPRSOH",41,0)
 Q:ODIFLG=0
"RTN","PRCPRSOH",42,0)
 ;
"RTN","PRCPRSOH",43,0)
 S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  Q
"RTN","PRCPRSOH",44,0)
 .   S ZTDESC="Days of Stock On Hand Report",ZTRTN="DQ^PRCPRSOH"
"RTN","PRCPRSOH",45,0)
 .   S ZTSAVE("^TMP($J,""PRCPURS1"",")=""
"RTN","PRCPRSOH",46,0)
 .   S ZTSAVE("DATE*")="",ZTSAVE("GROUP*")="",ZTSAVE("PRCP*")="",ZTSAVE("TOTALDAY")="",ZTSAVE("ZTREQ")="@",ZTSAVE("O*")="",ZTSAVE("U*")=""
"RTN","PRCPRSOH",47,0)
 .   D ^%ZTLOAD
"RTN","PRCPRSOH",48,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRSOH",49,0)
DQ ;  queue starts here
"RTN","PRCPRSOH",50,0)
 N AVERAGE,DATE,GROUP,GROUPNM,ITEMDA,ITEMDATA,NSN,ONHAND,TOTAL,X,Y
"RTN","PRCPRSOH",51,0)
 K ^TMP($J,"PRCPRSOH")
"RTN","PRCPRSOH",52,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S ITEMDATA=$G(^(ITEMDA,0)) I ITEMDATA'="" D
"RTN","PRCPRSOH",53,0)
 .; Select item based on selection criteria
"RTN","PRCPRSOH",54,0)
 .   S USEFLG="Y"
"RTN","PRCPRSOH",55,0)
 .   I PRCP("DPTYPE")'="W" D
"RTN","PRCPRSOH",56,0)
 .   .  S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRSOH",57,0)
 .   .  I ODIFLG=1&(ODITEM="Y") S USEFLG="N"
"RTN","PRCPRSOH",58,0)
 .   .  I ODIFLG=2&(ODITEM'="Y") S USEFLG="N"
"RTN","PRCPRSOH",59,0)
 .   .  I ODIFLG=3 S USEFLG="Y"
"RTN","PRCPRSOH",60,0)
 .   I USEFLG="N" Q
"RTN","PRCPRSOH",61,0)
 .   I $$REUSABLE^PRCPU441(ITEMDA) Q
"RTN","PRCPRSOH",62,0)
 .   ;  calculate total usage between dates
"RTN","PRCPRSOH",63,0)
 .   S DATE=$E(DATESTRT,1,5)-.01,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE!(DATE>$E(DATEEND,1,5))  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPRSOH",64,0)
 .   S AVERAGE=$J(TOTAL/TOTALDAY,0,2),ONHAND=$P(ITEMDATA,"^",7)+$P(ITEMDATA,"^",19)
"RTN","PRCPRSOH",65,0)
 .   S DAYSLEFT=$S('AVERAGE&(ONHAND):9999999,'AVERAGE:0,1:ONHAND/AVERAGE\1)
"RTN","PRCPRSOH",66,0)
 .   I PRCPTYPE=1,DAYSLEFT'<PRCPDAYS Q
"RTN","PRCPRSOH",67,0)
 .   I PRCPTYPE=2,DAYSLEFT'>PRCPDAYS Q
"RTN","PRCPRSOH",68,0)
 .   ;  sort for whse
"RTN","PRCPRSOH",69,0)
 .   I PRCP("DPTYPE")="W" D  Q
"RTN","PRCPRSOH",70,0)
 .   .   S NSN=$$NSN^PRCPUX1(ITEMDA) S:NSN="" NSN=" "
"RTN","PRCPRSOH",71,0)
 .   .   I $E(NSN,1,$L(PRCPSTRT))'=PRCPSTRT,$E(NSN,1,$L(PRCPEND))'=PRCPEND I NSN']PRCPSTRT!(PRCPEND']NSN) Q
"RTN","PRCPRSOH",72,0)
 .   .   S ^TMP($J,"PRCPRSOH",NSN,ITEMDA)=TOTAL_"^"_AVERAGE_"^"_ONHAND_"^"_$P(DAYSLEFT,".")_"^"_$P(ITEMDATA,"^",27)
"RTN","PRCPRSOH",73,0)
 .   ;  sort for primary and secondary
"RTN","PRCPRSOH",74,0)
 .   S GROUP=+$P(ITEMDATA,"^",21)
"RTN","PRCPRSOH",75,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPRSOH",76,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPRSOH",77,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPRSOH",78,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRSOH",79,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRSOH",80,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRSOH",81,0)
 .   S ^TMP($J,"PRCPRSOH",GROUPNM,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,15),ITEMDA)=TOTAL_"^"_AVERAGE_"^"_ONHAND_"^"_$P(DAYSLEFT,".")_"^"_$P(ITEMDATA,"^",27)
"RTN","PRCPRSOH",82,0)
 ;
"RTN","PRCPRSOH",83,0)
 D PRINT^PRCPRSO1
"RTN","PRCPRSOH",84,0)
 K ^TMP($J,"PRCPURS1"),^TMP($J,"PRCPRSOH")
"RTN","PRCPRSOH",85,0)
 D ^%ZISC
"RTN","PRCPRSOH",86,0)
 Q
"RTN","PRCPRSS0")
0^27^B21505747^B20176757
"RTN","PRCPRSS0",1,0)
PRCPRSS0 ;WISC/RFJ/DL/DAP-stock status report print for warehouse;1/28/98
"RTN","PRCPRSS0",2,0)
V ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRSS0",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRSS0",4,0)
 Q
"RTN","PRCPRSS0",5,0)
 ;
"RTN","PRCPRSS0",6,0)
 ;
"RTN","PRCPRSS0",7,0)
PRINT ;  print report
"RTN","PRCPRSS0",8,0)
 N DAYS,MONTH,NOW,PAGE,PRCPFLAG,SCREEN,TOTCLOS,TOTISS,TOTN,TOTOPEN,TOTVAL
"RTN","PRCPRSS0",9,0)
 S Y=DATESTRT D DD^%DT S MONTH=Y
"RTN","PRCPRSS0",10,0)
 S DAYS=$P("31^28^31^30^31^30^31^31^30^31^30^31","^",+$E(DATESTRT,4,5))
"RTN","PRCPRSS0",11,0)
 I DAYS=28 S %=(17+$E(DATESTRT))_$E(DATESTRT,2,3),DAYS=$S(%#400=0:29,(%#4=0&(%#100'=0)):29,1:28)
"RTN","PRCPRSS0",12,0)
 S SCREEN=$$SCRPAUSE^PRCPUREP,PAGE=1 D NOW^%DTC S Y=% D DD^%DT S NOW=Y U IO D H
"RTN","PRCPRSS0",13,0)
 W !!,"OPEN BALANCE",?14 S TOTOPEN=0 F ACCT=1,2,3,6,8 S %=$P($G(OPEN(ACCT)),"^",2),OPEN(ACCT)=%,TOTOPEN=TOTOPEN+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",14,0)
 W $$SHOWVALU(TOTOPEN)
"RTN","PRCPRSS0",15,0)
 W !!,"RECEIPTS",?14 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(REC(ACCT)),TOTAL=TOTAL+%,OPEN(ACCT)=$G(OPEN(ACCT))+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",16,0)
 W $$SHOWVALU(TOTAL)
"RTN","PRCPRSS0",17,0)
 ;
"RTN","PRCPRSS0",18,0)
 ;*98 Changed previous displays of "issues" to "usage"
"RTN","PRCPRSS0",19,0)
 ;
"RTN","PRCPRSS0",20,0)
 W !,"USAGE",?14 S TOTISS=0 F ACCT=1,2,3,6,8 S %=$G(ISS(ACCT)),TOTISS=TOTISS+%,OPEN(ACCT)=$G(OPEN(ACCT))+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",21,0)
 W $$SHOWVALU(TOTISS)
"RTN","PRCPRSS0",22,0)
 W !,"ADJUSTMENTS",?14 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(ADJ(ACCT)),TOTAL=TOTAL+%,OPEN(ACCT)=$G(OPEN(ACCT))+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",23,0)
 W $$SHOWVALU(TOTAL)
"RTN","PRCPRSS0",24,0)
 S %="",$P(%,"=",80)=""
"RTN","PRCPRSS0",25,0)
 W !,%,!,"CLOSE BALANCE",?14 S TOTCLOS=0 F ACCT=1,2,3,6,8 S %=$G(OPEN(ACCT)),TOTCLOS=TOTCLOS+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",26,0)
 W $$SHOWVALU(TOTCLOS)
"RTN","PRCPRSS0",27,0)
 W !!!,"# RECEIPTS",?13 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(RECN(ACCT)),TOTAL=TOTAL+%,TOTN(ACCT)=% W $J(%,11,0)
"RTN","PRCPRSS0",28,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS0",29,0)
 ;
"RTN","PRCPRSS0",30,0)
 ;*98 Changed previous displays of "issues" to "usage"
"RTN","PRCPRSS0",31,0)
 ;
"RTN","PRCPRSS0",32,0)
 W !,"# USAGE",?13 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(ISSN(ACCT)),TOTAL=TOTAL+%,TOTN(ACCT)=$G(TOTN(ACCT))+% W $J(%,11,0)
"RTN","PRCPRSS0",33,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS0",34,0)
 W !,"# ADJUSTMENTS",?13 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(ADJN(ACCT)),TOTAL=TOTAL+%,TOTN(ACCT)=$G(TOTN(ACCT))+% W $J(%,11,0)
"RTN","PRCPRSS0",35,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS0",36,0)
 S %="",$P(%,"=",80)=""
"RTN","PRCPRSS0",37,0)
 W !,%,!,"# TOTAL",?13 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(TOTN(ACCT)),TOTAL=TOTAL+% W $J(%,11,0)
"RTN","PRCPRSS0",38,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS0",39,0)
 W !!,"TURNOVER",?13 F ACCT=1,2,3,6,8 S %=($G(ISS(ACCT))*365)/DAYS,%=$S('$G(OPEN(ACCT)):"X",1:-%/OPEN(ACCT)) W $J(%,11,2)
"RTN","PRCPRSS0",40,0)
 S %=(TOTISS*365)/DAYS,%=$S('TOTCLOS:"X",1:-%/TOTCLOS) W $J(%,11,2)
"RTN","PRCPRSS0",41,0)
 I $Y>(IOSL-10) W ! D:SCREEN P^PRCPUREP G:$G(PRCPFLAG) Q D H
"RTN","PRCPRSS0",42,0)
 W !!?28,"***  CURRENT  DATA  ***",!,"$ ONHAND VALUE",?14 S TOTVAL=0 F ACCT=1,2,3,6,8 S %=$G(VALUE(ACCT)),TOTVAL=TOTVAL+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",43,0)
 W $$SHOWVALU(TOTVAL)
"RTN","PRCPRSS0",44,0)
 W !,"$ DUEINS",?14 S X=0 F ACCT=1,2,3,6,8 S %=$G(DUEIN(ACCT)),X=X+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",45,0)
 W $$SHOWVALU(X)
"RTN","PRCPRSS0",46,0)
 W !,"$ DUEOUTS",?14 S X=0 F ACCT=1,2,3,6,8 S %=$G(DUEOUT(ACCT)),X=X+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",47,0)
 W $$SHOWVALU(X)
"RTN","PRCPRSS0",48,0)
 S Y=$E(DATEINAC,1,5)_"01" D DD^%DT
"RTN","PRCPRSS0",49,0)
 W !!?2,"INACTIVE ITEMS FROM  ",Y,"  TO  ",$P(NOW,"@"),!,"# INACTIVE",?13
"RTN","PRCPRSS0",50,0)
 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(INACTN(ACCT)),TOTAL=TOTAL+% W $J(%,11,0)
"RTN","PRCPRSS0",51,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS0",52,0)
 W !,"$ INACTIVE",?14 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(INACT(ACCT)),TOTAL=TOTAL+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",53,0)
 W $$SHOWVALU(TOTAL)
"RTN","PRCPRSS0",54,0)
 W !,"% INACTIVE",?13 F ACCT=1,2,3,6,8 S %=$G(VALUE(ACCT)),%=$S('%:0,1:$G(INACT(ACCT))/%) W $J(%,11,2)
"RTN","PRCPRSS0",55,0)
 S %=$S('TOTVAL:0,1:TOTAL/TOTVAL) W $J(%,11,2)
"RTN","PRCPRSS0",56,0)
 S Y=$E(DATELONG,1,5)_"01" D DD^%DT
"RTN","PRCPRSS0",57,0)
 ;
"RTN","PRCPRSS0",58,0)
 ;*98 Showed correct range of 90 days for long supply on report section
"RTN","PRCPRSS0",59,0)
 ;
"RTN","PRCPRSS0",60,0)
 W !!?2,"LONG SUPPLY ITEMS AVERAGE FROM  ",Y,"  TO  ",$P(NOW,"@"),"  (>90 DAYS)",!,"# LONG SUPPLY",?13
"RTN","PRCPRSS0",61,0)
 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(LONGN(ACCT)),TOTAL=TOTAL+% W $J(%,11,0)
"RTN","PRCPRSS0",62,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS0",63,0)
 W !,"$ LONG SUPPLY",?14 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(LONG(ACCT)),TOTAL=TOTAL+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",64,0)
 W $$SHOWVALU(TOTAL)
"RTN","PRCPRSS0",65,0)
 W !,"% LONG SUPPLY",?13 F ACCT=1,2,3,6,8 S %=$G(VALUE(ACCT)),%=$S('%:0,1:$G(LONG(ACCT))/%) W $J(%,11,2)
"RTN","PRCPRSS0",66,0)
 S %=$S('TOTVAL:0,1:TOTAL/TOTVAL) W $J(%,11,2)
"RTN","PRCPRSS0",67,0)
 I $Y>(IOSL-7) W ! D:SCREEN P^PRCPUREP G:$G(PRCPFLAG) Q D H
"RTN","PRCPRSS0",68,0)
 W !!?2,"NONISSUABLE ITEMS ON  ",$P(NOW,"@"),!,"# NONISSUABLE",?13
"RTN","PRCPRSS0",69,0)
 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(NONISSN(ACCT)),TOTAL=TOTAL+% W $J(%,11,0)
"RTN","PRCPRSS0",70,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS0",71,0)
 W !,"$ NONISSUABLE",?14 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(NONISS(ACCT)),TOTAL=TOTAL+% W $$SHOWVALU(%)
"RTN","PRCPRSS0",72,0)
 W $$SHOWVALU(TOTAL)
"RTN","PRCPRSS0",73,0)
 W !,"% NONISSUABLE",?13 F ACCT=1,2,3,6,8 S %=$G(VALUE(ACCT)),%=$S('%:0,1:$G(NONISS(ACCT))/%) W $J(%,11,2)
"RTN","PRCPRSS0",74,0)
 S %=$S('TOTVAL:0,1:TOTAL/TOTVAL) W $J(%,11,2)
"RTN","PRCPRSS0",75,0)
 D END^PRCPUREP
"RTN","PRCPRSS0",76,0)
Q D ^%ZISC Q
"RTN","PRCPRSS0",77,0)
 ;
"RTN","PRCPRSS0",78,0)
 ;
"RTN","PRCPRSS0",79,0)
SHOWVALU(V1) ;show value
"RTN","PRCPRSS0",80,0)
 N % S %="+" S:+V1=0 %=" " I V1<0 S V1=-V1,%="-"
"RTN","PRCPRSS0",81,0)
 Q $J(V1,10,2)_%
"RTN","PRCPRSS0",82,0)
 ;
"RTN","PRCPRSS0",83,0)
 ;
"RTN","PRCPRSS0",84,0)
H ;heading
"RTN","PRCPRSS0",85,0)
 S %=NOW_"  PAGE: "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRSS0",86,0)
 W $C(13),"STOCK STATUS REPORT FOR: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRSS0",87,0)
 W !?5,"TRANSACTIONS FOR THE MONTH-YEAR: ",MONTH
"RTN","PRCPRSS0",88,0)
 W !,"SUMMARY",?14,$J("ACCT 1",11),$J("ACCT 2",11),$J("ACCT 3",11),$J("ACCT 6",11),$J("ACCT 8",11),$J("TOTAL",11)
"RTN","PRCPRSS0",89,0)
 S %="",$P(%,"-",81)="" W !,%
"RTN","PRCPRSS0",90,0)
 Q
"RTN","PRCPRSS1")
0^28^B38734810^n/a
"RTN","PRCPRSS1",1,0)
PRCPRSS1 ;WOIFO/DAP-stock status report for primaries and secondaries; 10/16/06 2:17pm
"RTN","PRCPRSS1",2,0)
V ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRSS1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRSS1",4,0)
 Q
"RTN","PRCPRSS1",5,0)
 ;
"RTN","PRCPRSS1",6,0)
 ;
"RTN","PRCPRSS1",7,0)
PRINT ;  print report
"RTN","PRCPRSS1",8,0)
 N DAYS,MONTH,NOW,PAGE,PRCPFLAG,SCREEN,TOTCLOS,TOTISS,TOTN,TOTOPEN,TOTVAL,ITEMCTA,X,Y
"RTN","PRCPRSS1",9,0)
 S Y=DATESTRT D DD^%DT S MONTH=Y
"RTN","PRCPRSS1",10,0)
 S DAYS=$P("31^28^31^30^31^30^31^31^30^31^30^31","^",+$E(DATESTRT,4,5))
"RTN","PRCPRSS1",11,0)
 I DAYS=28 S %=(17+$E(DATESTRT))_$E(DATESTRT,2,3),DAYS=$S(%#400=0:29,(%#4=0&(%#100'=0)):29,1:28)
"RTN","PRCPRSS1",12,0)
 ;
"RTN","PRCPRSS1",13,0)
 ;*98 Added looping logic to go through print cycle for each type of
"RTN","PRCPRSS1",14,0)
 ;item report (Standard/ODI/All)
"RTN","PRCPRSS1",15,0)
 ;
"RTN","PRCPRSS1",16,0)
 N P,PRCPTP,PRCPTP2,NODE1
"RTN","PRCPRSS1",17,0)
 S PAGE=1
"RTN","PRCPRSS1",18,0)
 F P=1:1:3 S NODE1=P D
"RTN","PRCPRSS1",19,0)
 . I $G(PRCPFLAG) Q
"RTN","PRCPRSS1",20,0)
 . I P=1 S PRCPTP="STANDARD",PRCPTP2="STD"
"RTN","PRCPRSS1",21,0)
 . I P=2 S PRCPTP="ON-DEMAND",PRCPTP2="OD"
"RTN","PRCPRSS1",22,0)
 . I P=3 S PRCPTP="ALL",PRCPTP2=PRCPTP
"RTN","PRCPRSS1",23,0)
 . D REP^PRCPRSS1
"RTN","PRCPRSS1",24,0)
 . Q
"RTN","PRCPRSS1",25,0)
 ;
"RTN","PRCPRSS1",26,0)
 D Q^PRCPRSS1
"RTN","PRCPRSS1",27,0)
 Q
"RTN","PRCPRSS1",28,0)
 ;
"RTN","PRCPRSS1",29,0)
REP ;*98 Added header to display type of reporting, moved header logic
"RTN","PRCPRSS1",30,0)
 ;from earlier in routine to support looping structure
"RTN","PRCPRSS1",31,0)
 ; 
"RTN","PRCPRSS1",32,0)
 I P>1 D LC
"RTN","PRCPRSS1",33,0)
 I $G(PRCPFLAG) Q
"RTN","PRCPRSS1",34,0)
 S SCREEN=$$SCRPAUSE^PRCPUREP D NOW^%DTC S Y=% D DD^%DT S NOW=Y U IO I P=1 D HEAD
"RTN","PRCPRSS1",35,0)
 ;
"RTN","PRCPRSS1",36,0)
 W !,"INVENTORY  ("_PRCPTP_" ITEMS)"
"RTN","PRCPRSS1",37,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",38,0)
 ;
"RTN","PRCPRSS1",39,0)
 W !,"OPEN BALANCE",?14 S TOTOPEN=0 F ACCT=1,2,3,6,8 S %=$P($G(^TMP($J,NODE1,"OPEN",ACCT)),"^",2) S OPEN(ACCT)=%,TOTOPEN=TOTOPEN+% W $$SHOWVALU(%)
"RTN","PRCPRSS1",40,0)
 W $$SHOWVALU(TOTOPEN)
"RTN","PRCPRSS1",41,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",42,0)
 W !!,"RECEIPTS",?14 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"REC",ACCT)),TOTAL=TOTAL+%,OPEN(ACCT)=$G(OPEN(ACCT))+% W $$SHOWVALU(%)
"RTN","PRCPRSS1",43,0)
 W $$SHOWVALU(TOTAL)
"RTN","PRCPRSS1",44,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",45,0)
 ;*98 Modified report to replace "ISSUES" with "USAGE"
"RTN","PRCPRSS1",46,0)
 W !,"USAGE",?14 S TOTISS=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"ISS",ACCT)),TOTISS=TOTISS+%,OPEN(ACCT)=$G(OPEN(ACCT))+% W $$SHOWVALU(%)
"RTN","PRCPRSS1",47,0)
 W $$SHOWVALU(TOTISS)
"RTN","PRCPRSS1",48,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",49,0)
 W !,"ADJUSTMENTS",?14 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"ADJ",ACCT)),TOTAL=TOTAL+%,OPEN(ACCT)=$G(OPEN(ACCT))+% W $$SHOWVALU(%)
"RTN","PRCPRSS1",50,0)
 W $$SHOWVALU(TOTAL)
"RTN","PRCPRSS1",51,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",52,0)
 S %="",$P(%,"=",80)=""
"RTN","PRCPRSS1",53,0)
 W !,%,!,"CLOSE BALANCE",?14 S TOTCLOS=0 F ACCT=1,2,3,6,8 S %=$G(OPEN(ACCT)),TOTCLOS=TOTCLOS+% W $$SHOWVALU(%)
"RTN","PRCPRSS1",54,0)
 W $$SHOWVALU(TOTCLOS)
"RTN","PRCPRSS1",55,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",56,0)
 W !!!,"# RECEIPTS",?13 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"RECN",ACCT)),TOTAL=TOTAL+%,TOTN(ACCT)=% W $J(%,11,0)
"RTN","PRCPRSS1",57,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS1",58,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",59,0)
 ;*98 Modified report to replace "ISSUES" with "USAGES"
"RTN","PRCPRSS1",60,0)
 W !,"# USAGE",?13 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"ISSN",ACCT)),TOTAL=TOTAL+%,TOTN(ACCT)=$G(TOTN(ACCT))+% W $J(%,11,0)
"RTN","PRCPRSS1",61,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS1",62,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",63,0)
 W !,"# ADJUSTMENTS",?13 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"ADJN",ACCT)),TOTAL=TOTAL+%,TOTN(ACCT)=$G(TOTN(ACCT))+% W $J(%,11,0)
"RTN","PRCPRSS1",64,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS1",65,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",66,0)
 S %="",$P(%,"=",80)=""
"RTN","PRCPRSS1",67,0)
 W !,%,!,"# TOTAL",?13 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(TOTN(ACCT)),TOTAL=TOTAL+% W $J(%,11,0)
"RTN","PRCPRSS1",68,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS1",69,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",70,0)
 W !!,"TURNOVER",?13 F ACCT=1,2,3,6,8 S %=($G(^TMP($J,NODE1,"ISS",ACCT))*365)/DAYS,%=$S('$G(OPEN(ACCT)):"X",1:-%/OPEN(ACCT)) W $J(%,11,2)
"RTN","PRCPRSS1",71,0)
 S %=(TOTISS*365)/DAYS,%=$S('TOTCLOS:"X",1:-%/TOTCLOS) W $J(%,11,2)
"RTN","PRCPRSS1",72,0)
 ;*98 Added indicator of type of report (Standard/ODI/All)
"RTN","PRCPRSS1",73,0)
 W !,"("_PRCPTP_" ITEMS)"
"RTN","PRCPRSS1",74,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",75,0)
 ;
"RTN","PRCPRSS1",76,0)
 ;*98 Added indicator of type of report (Standard/ODI/All)
"RTN","PRCPRSS1",77,0)
 W !!?28,"***  CURRENT  DATA ("_PRCPTP_" ITEMS) ***"
"RTN","PRCPRSS1",78,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",79,0)
 ;
"RTN","PRCPRSS1",80,0)
 ;*98 Rearranged report placement of sections and added indicator of 
"RTN","PRCPRSS1",81,0)
 ;type of report (Standard/ODI/All)
"RTN","PRCPRSS1",82,0)
 ;
"RTN","PRCPRSS1",83,0)
 S Y=$E(DATEINAC,1,5)_"01" D DD^%DT
"RTN","PRCPRSS1",84,0)
 W !!?2,"INACTIVE ITEMS ("_PRCPTP_" ITEMS) FROM  ",Y,"  TO  ",$P(NOW,"@"),!,"# INACTIVE",?13
"RTN","PRCPRSS1",85,0)
 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"INACTN",ACCT)),TOTAL=TOTAL+% W $J(%,11,0)
"RTN","PRCPRSS1",86,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS1",87,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",88,0)
 W !,"$ INACTIVE",?14 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"INACT",ACCT)),TOTAL=TOTAL+% W $$SHOWVALU(%)
"RTN","PRCPRSS1",89,0)
 W $$SHOWVALU(TOTAL)
"RTN","PRCPRSS1",90,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",91,0)
 W !,"% INACTIVE",?13 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"VALUE",ACCT)),%=$S('%:0,1:$G(^TMP($J,NODE1,"INACT",ACCT))/%) W $J(%,11,2)
"RTN","PRCPRSS1",92,0)
 ;
"RTN","PRCPRSS1",93,0)
 ;*98 Moved TOTVAL logic to support reordered processing
"RTN","PRCPRSS1",94,0)
 S TOTVAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"VALUE",ACCT)),TOTVAL=TOTVAL+%
"RTN","PRCPRSS1",95,0)
 ;
"RTN","PRCPRSS1",96,0)
 S %=$S('TOTVAL:0,1:TOTAL/TOTVAL) W $J(%,11,2)
"RTN","PRCPRSS1",97,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",98,0)
 S Y=$E(DATELONG,1,5)_"01" D DD^%DT
"RTN","PRCPRSS1",99,0)
 W !!?2,"LONG SUPPLY ("_PRCPTP_" ITEMS) AVG. FROM  ",Y,"  TO  ",$P(NOW,"@"),!?2,"(>90 DAYS)",!,"# LONG SUPPLY",?13
"RTN","PRCPRSS1",100,0)
 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"LONGN",ACCT)),TOTAL=TOTAL+% W $J(%,11,0)
"RTN","PRCPRSS1",101,0)
 W $J(TOTAL,11,0)
"RTN","PRCPRSS1",102,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",103,0)
 W !,"$ LONG SUPPLY",?14 S TOTAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"LONG",ACCT)),TOTAL=TOTAL+% W $$SHOWVALU(%)
"RTN","PRCPRSS1",104,0)
 W $$SHOWVALU(TOTAL)
"RTN","PRCPRSS1",105,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",106,0)
 W !,"% LONG SUPPLY",?13 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"VALUE",ACCT)),%=$S('%:0,1:$G(^TMP($J,NODE1,"LONG",ACCT))/%) W $J(%,11,2)
"RTN","PRCPRSS1",107,0)
 S %=$S('TOTVAL:0,1:TOTAL/TOTVAL) W $J(%,11,2)
"RTN","PRCPRSS1",108,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",109,0)
 ;
"RTN","PRCPRSS1",110,0)
 ;*98 Modified section to display a new section header, item type count,
"RTN","PRCPRSS1",111,0)
 ;and display "$ONHAND" by specific type (Standard/ODI/All)
"RTN","PRCPRSS1",112,0)
 ;
"RTN","PRCPRSS1",113,0)
 W !!,"# "_PRCPTP2_" ITEMS",?13 S ITEMCTA=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"CNT",ACCT)),ITEMCTA=ITEMCTA+% W $J(%,11,0)
"RTN","PRCPRSS1",114,0)
 W $J(ITEMCTA,11,0)
"RTN","PRCPRSS1",115,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",116,0)
 ;
"RTN","PRCPRSS1",117,0)
 W !!,"INVENTORY VALUE"
"RTN","PRCPRSS1",118,0)
 W !,"$ "_PRCPTP,?14 S TOTVAL=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"VALUE",ACCT)),TOTVAL=TOTVAL+% W $$SHOWVALU(%)
"RTN","PRCPRSS1",119,0)
 W $$SHOWVALU(TOTVAL)
"RTN","PRCPRSS1",120,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",121,0)
 W !,"$ DUEINS",?14 S X=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"DUEIN",ACCT)),X=X+% W $$SHOWVALU(%)
"RTN","PRCPRSS1",122,0)
 W $$SHOWVALU(X)
"RTN","PRCPRSS1",123,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",124,0)
 W !,"$ DUEOUTS",?14 S X=0 F ACCT=1,2,3,6,8 S %=$G(^TMP($J,NODE1,"DUEOUT",ACCT)),X=X+% W $$SHOWVALU(%)
"RTN","PRCPRSS1",125,0)
 W $$SHOWVALU(X)
"RTN","PRCPRSS1",126,0)
 I $Y>(IOSL-7) D LC G:$G(PRCPFLAG) Q
"RTN","PRCPRSS1",127,0)
 ; 
"RTN","PRCPRSS1",128,0)
 ;*98 Modified report to not show the section addressing nonissuable 
"RTN","PRCPRSS1",129,0)
 ;items for primary and secondary inventory points
"RTN","PRCPRSS1",130,0)
 Q
"RTN","PRCPRSS1",131,0)
 ;
"RTN","PRCPRSS1",132,0)
 ;
"RTN","PRCPRSS1",133,0)
Q ;Tag ends printing and exits routine
"RTN","PRCPRSS1",134,0)
 D END^PRCPUREP
"RTN","PRCPRSS1",135,0)
 D ^%ZISC Q
"RTN","PRCPRSS1",136,0)
 ;
"RTN","PRCPRSS1",137,0)
 ;
"RTN","PRCPRSS1",138,0)
SHOWVALU(V1) ;show value
"RTN","PRCPRSS1",139,0)
 N % S %="+" S:+V1=0 %=" " I V1<0 S V1=-V1,%="-"
"RTN","PRCPRSS1",140,0)
 Q $J(V1,10,2)_%
"RTN","PRCPRSS1",141,0)
 ;
"RTN","PRCPRSS1",142,0)
LC ;*98 Moved line control logic into subroutines
"RTN","PRCPRSS1",143,0)
 I SCREEN W ! D P^PRCPUREP I $D(PRCPFLAG) Q
"RTN","PRCPRSS1",144,0)
 ;
"RTN","PRCPRSS1",145,0)
HEAD ;heading
"RTN","PRCPRSS1",146,0)
 N PRCPT
"RTN","PRCPRSS1",147,0)
 S %=NOW_"  PAGE: "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRSS1",148,0)
 W !,"STOCK STATUS REPORT FOR: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRSS1",149,0)
 ;*98 Added type of reporting (Standard/ODI/All) to header
"RTN","PRCPRSS1",150,0)
 S PRCPT=PRCPTP_" ITEMS"
"RTN","PRCPRSS1",151,0)
 W !?5,"TRANSACTIONS FOR THE MONTH-YEAR: ",MONTH,?(80-$L(PRCPT)),PRCPT
"RTN","PRCPRSS1",152,0)
 ;
"RTN","PRCPRSS1",153,0)
 W !,"SUMMARY",?14,$J("ACCT 1",11),$J("ACCT 2",11),$J("ACCT 3",11),$J("ACCT 6",11),$J("ACCT 8",11),$J("TOTAL",11)
"RTN","PRCPRSS1",154,0)
 S %="",$P(%,"-",81)="" W !,%
"RTN","PRCPRSS1",155,0)
 Q
"RTN","PRCPRSSP")
0^29^B33524984^n/a
"RTN","PRCPRSSP",1,0)
PRCPRSSP ;WOIFO/DAP-stock status report for primaries and secondaries; 10/16/06 2:07pm ; 2/23/07 4:59pm
"RTN","PRCPRSSP",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRSSP",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRSSP",4,0)
 ;
"RTN","PRCPRSSP",5,0)
 ;*83 Routine PRCPLO2 associated with PRC*5.1*83 is a modified copy of
"RTN","PRCPRSSP",6,0)
 ;this routine and any changes made to this routine should also be
"RTN","PRCPRSSP",7,0)
 ;considered for that routine as well.
"RTN","PRCPRSSP",8,0)
 ;
"RTN","PRCPRSSP",9,0)
 ;*98 Changed previous displays of "issues" to "usages"
"RTN","PRCPRSSP",10,0)
 ;
"RTN","PRCPRSSP",11,0)
ENT ;*98 Entry point from PRCPRSSR when inventory point is confirmed to be
"RTN","PRCPRSSP",12,0)
 ;primary or secondary
"RTN","PRCPRSSP",13,0)
 ; 
"RTN","PRCPRSSP",14,0)
 N ZTDESC,ZTRTN,ZTSAVE,POP
"RTN","PRCPRSSP",15,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRSSP",16,0)
 .   S ZTDESC="Stock Status Report",ZTRTN="DQ^PRCPRSSP"
"RTN","PRCPRSSP",17,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("DATE*")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRSSP",18,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRSSP",19,0)
 ;
"RTN","PRCPRSSP",20,0)
DQ ;  queue starts here
"RTN","PRCPRSSP",21,0)
 N ACCT,ADJ,ADJN,AVERAGE,D,DA,DATE,DATELONG,DUEIN,DUEOUT,INACT,INACTN,INVVAL,ISS,ISSN,ITEMDA,LONG,LONGN,NONISS,NONISSN,ONHAND,OPEN,QTY,REC,RECN,TOTAL,TOTDAYS,TRANSNO,TYPE,VALUE
"RTN","PRCPRSSP",22,0)
 N ODITEM,NODE1,X,X1,X2
"RTN","PRCPRSSP",23,0)
 K ^TMP($J)
"RTN","PRCPRSSP",24,0)
 K OPEN
"RTN","PRCPRSSP",25,0)
 ;*98 Modified calculations to separate ODI and Standard Items
"RTN","PRCPRSSP",26,0)
 ;
"RTN","PRCPRSSP",27,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  D
"RTN","PRCPRSSP",28,0)
 .   S NODE1=1
"RTN","PRCPRSSP",29,0)
 .   S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRSSP",30,0)
 .   I ODITEM="Y" S NODE1=2
"RTN","PRCPRSSP",31,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPRSSP",32,0)
 .   ;*98 Added item counter logic
"RTN","PRCPRSSP",33,0)
 .   S ^TMP($J,NODE1,"CNT",ACCT)=$G(^TMP($J,NODE1,"CNT",ACCT))+1
"RTN","PRCPRSSP",34,0)
 ;  
"RTN","PRCPRSSP",35,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445.1,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S X=$$GETOPEN^PRCPUBAL(PRCP("I"),ITEMDA,$E(DATESTRT,1,5)) I X'="" D
"RTN","PRCPRSSP",36,0)
 .   S NODE1=1
"RTN","PRCPRSSP",37,0)
 .   S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRSSP",38,0)
 .   I ODITEM="Y" S NODE1=2
"RTN","PRCPRSSP",39,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPRSSP",40,0)
 .   ;*98 Added item counter logic
"RTN","PRCPRSSP",41,0)
 .   S $P(^TMP($J,NODE1,"OPEN",ACCT),"^")=$P($G(^TMP($J,NODE1,"OPEN",ACCT)),"^")+$P(X,"^",2)+$P(X,"^",3)
"RTN","PRCPRSSP",42,0)
 .   S $P(^TMP($J,NODE1,"OPEN",ACCT),"^",2)=$P($G(^TMP($J,NODE1,"OPEN",ACCT)),"^",2)+$P(X,"^",8)
"RTN","PRCPRSSP",43,0)
 S DATE=DATESTRT F  S DATE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE)) Q:$E(DATE,1,5)'=$E(DATESTRT,1,5)  S TYPE="" F  S TYPE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE)) Q:TYPE=""  D
"RTN","PRCPRSSP",44,0)
 .   S DA=0 F  S DA=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE,DA)) Q:'DA  D
"RTN","PRCPRSSP",45,0)
 ..  S D=$G(^PRCP(445.2,DA,0)) I '$P(D,"^",5) Q
"RTN","PRCPRSSP",46,0)
 ..  ;  non-issuable
"RTN","PRCPRSSP",47,0)
 ..  Q:$P(D,"^",11)="N"  ;count if not flagged as non-issueable
"RTN","PRCPRSSP",48,0)
 ..  S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1($P(D,"^",5)))
"RTN","PRCPRSSP",49,0)
 ..  S TRANSNO=$P(D,"^",19)
"RTN","PRCPRSSP",50,0)
 ..  S INVVAL=$P(D,"^",7)*$P(D,"^",8) I $P(D,"^",22)'="" S INVVAL=$P(D,"^",22)
"RTN","PRCPRSSP",51,0)
 ..  S NODE1=1
"RTN","PRCPRSSP",52,0)
 ..  I $$ODITEM^PRCPUX2(PRCP("I"),$P(D,"^",5))="Y" S NODE1=2
"RTN","PRCPRSSP",53,0)
 ..  ;  set transno temporary for primary and secondary to
"RTN","PRCPRSSP",54,0)
 ..  ;  indicate type of transaction
"RTN","PRCPRSSP",55,0)
 ..  ;*98 Removed warehouse check from loop entry below
"RTN","PRCPRSSP",56,0)
 ..  D
"RTN","PRCPRSSP",57,0)
 ... I TYPE="R"!(TYPE="C")!(TYPE="E")!(TYPE="U")!(TYPE="S") S TRANSNO="--1" Q  ;usage
"RTN","PRCPRSSP",58,0)
 ... I TYPE="RC" S TRANSNO=1 Q  ;receipt
"RTN","PRCPRSSP",59,0)
 ... S TRANSNO="" ;adjustment
"RTN","PRCPRSSP",60,0)
 ..  ;  other adjustments
"RTN","PRCPRSSP",61,0)
 ..  ;*98 Removed line featuring warehouse logic 
"RTN","PRCPRSSP",62,0)
 ..  ;I PRCP("DPTYPE")="W",$P(TRANSNO,"-",2)="" S ^TMP($J,NODE1,"ADJ",ACCT)=$G(^TMP($J,NODE1,"ADJ",ACCT))+INVVAL,^TMP($J,NODE1,"ADJN",ACCT)=$G(^TMP($J,NODE1,"ADJN",ACCT))+1 Q
"RTN","PRCPRSSP",63,0)
 ..  I TRANSNO="" S ^TMP($J,NODE1,"ADJ",ACCT)=$G(^TMP($J,NODE1,"ADJ",ACCT))+INVVAL,^TMP($J,NODE1,"ADJN",ACCT)=$G(^TMP($J,NODE1,"ADJN",ACCT))+1
"RTN","PRCPRSSP",64,0)
 ..  E  D
"RTN","PRCPRSSP",65,0)
 ... ;  purchase order
"RTN","PRCPRSSP",66,0)
 ... I $P(TRANSNO,"-",3)="" S ^TMP($J,NODE1,"REC",ACCT)=$G(^TMP($J,NODE1,"REC",ACCT))+INVVAL,^TMP($J,NODE1,"RECN",ACCT)=$G(^TMP($J,NODE1,"RECN",ACCT))+1 Q
"RTN","PRCPRSSP",67,0)
 ... ;  usage
"RTN","PRCPRSSP",68,0)
 ... S ^TMP($J,NODE1,"ISS",ACCT)=$G(^TMP($J,NODE1,"ISS",ACCT))+INVVAL,^TMP($J,NODE1,"ISSN",ACCT)=$G(^TMP($J,NODE1,"ISSN",ACCT))+1
"RTN","PRCPRSSP",69,0)
 ;
"RTN","PRCPRSSP",70,0)
 ;  calculate inactive, long supply, set non-issuable
"RTN","PRCPRSSP",71,0)
 ;
"RTN","PRCPRSSP",72,0)
 ;*98 Modified long supply range to be 90 days instead of 270 days for 
"RTN","PRCPRSSP",73,0)
 ;warehouse, primary, and secondary reporting
"RTN","PRCPRSSP",74,0)
 ;
"RTN","PRCPRSSP",75,0)
 S X1=$E(DT,1,5)_"01",X2=-89 D C^%DTC S DATELONG=$E(X,1,5),X1=DT,X2=$E(X,1,5)_"00" D ^%DTC S TOTDAYS=X
"RTN","PRCPRSSP",76,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S D=$G(^(ITEMDA,0)) I D'="" D
"RTN","PRCPRSSP",77,0)
 .   S NODE1=1
"RTN","PRCPRSSP",78,0)
 .   S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRSSP",79,0)
 .   I ODITEM="Y" S NODE1=2
"RTN","PRCPRSSP",80,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPRSSP",81,0)
 .   ;  value
"RTN","PRCPRSSP",82,0)
 .   S ^TMP($J,NODE1,"VALUE",ACCT)=$G(^TMP($J,NODE1,"VALUE",ACCT))+$P(D,"^",27)
"RTN","PRCPRSSP",83,0)
 .   S ^TMP($J,NODE1,"DUEIN",ACCT)=$G(^TMP($J,NODE1,"DUEIN",ACCT))+($$GETIN^PRCPUDUE(PRCP("I"),ITEMDA)*$P(D,"^",22))
"RTN","PRCPRSSP",84,0)
 .   S ^TMP($J,NODE1,"DUEOUT",ACCT)=$G(^TMP($J,NODE1,"DUEOUT",ACCT))+($$GETOUT^PRCPUDUE(PRCP("I"),ITEMDA)*$P(D,"^",22))
"RTN","PRCPRSSP",85,0)
 .   ;*98 Removed non-issuable section since they never appear for primary or secondary inventory points
"RTN","PRCPRSSP",86,0)
 .   ;
"RTN","PRCPRSSP",87,0)
 .   ;  inactive
"RTN","PRCPRSSP",88,0)
 .   ;  if reusable, quit
"RTN","PRCPRSSP",89,0)
 .   I $$REUSABLE^PRCPU441(ITEMDA) Q
"RTN","PRCPRSSP",90,0)
 .   S QTY=$P(D,"^",7)+$P(D,"^",19)
"RTN","PRCPRSSP",91,0)
 .   I QTY,'$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,$E(DATEINAC,1,5)-.01)),'$O(^PRCP(445,PRCP("I"),1,ITEMDA,3,DATEINAC)) D
"RTN","PRCPRSSP",92,0)
 . . S ^TMP($J,NODE1,"INACT",ACCT)=$G(^TMP($J,NODE1,"INACT",ACCT))+$P(D,"^",27),^TMP($J,NODE1,"INACTN",ACCT)=$G(^TMP($J,NODE1,"INACTN",ACCT))+1 Q
"RTN","PRCPRSSP",93,0)
 .   ;  long supply
"RTN","PRCPRSSP",94,0)
 .   S DATE=DATELONG-.01,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPRSSP",95,0)
 .   S AVERAGE=$J(TOTAL/TOTDAYS,0,2),TOTAL=$S('AVERAGE&(QTY):9999999,'AVERAGE:0,1:QTY/AVERAGE\1)
"RTN","PRCPRSSP",96,0)
 .   I TOTAL>90 S ^TMP($J,NODE1,"LONG",ACCT)=$G(^TMP($J,NODE1,"LONG",ACCT))+$P(D,"^",27),^TMP($J,NODE1,"LONGN",ACCT)=$G(^TMP($J,NODE1,"LONGN",ACCT))+1
"RTN","PRCPRSSP",97,0)
 ;
"RTN","PRCPRSSP",98,0)
 ;*98 Create consolidated array of Standard and ODI items
"RTN","PRCPRSSP",99,0)
 N I,PRCPQ1,PRCPQ2,L,TEMPDATA
"RTN","PRCPRSSP",100,0)
 F I=1:1:2 D
"RTN","PRCPRSSP",101,0)
 .   S PRCPQ1=""
"RTN","PRCPRSSP",102,0)
 .   F  S PRCPQ1=$O(^TMP($J,I,PRCPQ1)) Q:PRCPQ1=""  D
"RTN","PRCPRSSP",103,0)
 ..  S PRCPQ2=""
"RTN","PRCPRSSP",104,0)
 ..  F  S PRCPQ2=$O(^TMP($J,I,PRCPQ1,PRCPQ2)) Q:PRCPQ2=""  D
"RTN","PRCPRSSP",105,0)
 ... S TEMPDATA=^TMP($J,I,PRCPQ1,PRCPQ2)
"RTN","PRCPRSSP",106,0)
 ... F L=1:1:2 S $P(^TMP($J,3,PRCPQ1,PRCPQ2),"^",L)=$P($G(^TMP($J,3,PRCPQ1,PRCPQ2)),"^",L)+$P(TEMPDATA,"^",L)
"RTN","PRCPRSSP",107,0)
 ;
"RTN","PRCPRSSP",108,0)
 ;*98 Routed printing based on Primary/Secondary status
"RTN","PRCPRSSP",109,0)
 D PRINT^PRCPRSS1
"RTN","PRCPRSSP",110,0)
 Q
"RTN","PRCPRSSR")
0^30^B28781841^B26117439
"RTN","PRCPRSSR",1,0)
PRCPRSSR ;WISC/RFJ/dh/DWA/DAP-stock status report (option, whse) ;3.13.98
"RTN","PRCPRSSR",2,0)
 ;;5.1;IFCAP;**17,41,98**;Oct 20, 2000;Build 37
"RTN","PRCPRSSR",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRSSR",4,0)
 ;
"RTN","PRCPRSSR",5,0)
 ;*83 Routine PRCPLO2 associated with PRC*5.1*83 is a modified copy of
"RTN","PRCPRSSR",6,0)
 ;this routine and any changes made to this routine should also be
"RTN","PRCPRSSR",7,0)
 ;considered for that routine as well.
"RTN","PRCPRSSR",8,0)
 ;
"RTN","PRCPRSSR",9,0)
 ;*98 Changed previous displays of "issues" to "usage"
"RTN","PRCPRSSR",10,0)
 ;
"RTN","PRCPRSSR",11,0)
 D ^PRCPUSEL Q:'$D(PRCP("I"))
"RTN","PRCPRSSR",12,0)
 N %,%DT,%H,%I,DATEINAC,DATESTRT,TODAY,X,X1,X2,Y
"RTN","PRCPRSSR",13,0)
 K X S X(1)="The Stock Status Report will print a summary of all usage, receipts, and adjustments with the opening and closing balances by account codes."
"RTN","PRCPRSSR",14,0)
 S X(2)="It will calculate the turnover rate, inactive item percent, long supply percent, and non-issuable percent."
"RTN","PRCPRSSR",15,0)
 D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRSSR",16,0)
 K X S X(1)="Enter the date (month-year) for the Stock Status Report." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSSR",17,0)
 D NOW^%DTC S TODAY=X,Y=$E(X,1,5)_"00" S %DT(0)=-Y D DD^%DT S %DT="AEP",%DT("B")=Y,%DT("A")="Print Stock Status for MONTH and YEAR: " D ^%DT K %DT I Y<1 Q
"RTN","PRCPRSSR",18,0)
 S DATESTRT=$E(Y,1,5)_"00"
"RTN","PRCPRSSR",19,0)
 K X S X(1)="The inactive item percent is calculated for items which have not had activity (receipts or usage) after a specified cutoff date." D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRSSR",20,0)
 K X S X(1)="Enter the Inactivity cutoff date." D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRSSR",21,0)
 S X1=TODAY,X2=-90 D C^%DTC S Y=$E(X,1,5)_"00" D DD^%DT
"RTN","PRCPRSSR",22,0)
 S %DT(0)=-($E(TODAY,1,5)_"00"),%DT="AEP",%DT("B")=Y,%DT("A")="Enter Inactivity Cutoff MONTH and YEAR: " D ^%DT K %DT I Y<1 Q
"RTN","PRCPRSSR",23,0)
 S DATEINAC=$E(Y,1,5)_"00"
"RTN","PRCPRSSR",24,0)
 ;
"RTN","PRCPRSSR",25,0)
 ;*98 Branch to PRCPRSSP if the inventory point being reported is a 
"RTN","PRCPRSSR",26,0)
 ;primary or secondary
"RTN","PRCPRSSR",27,0)
 ;
"RTN","PRCPRSSR",28,0)
 I PRCP("DPTYPE")'="W" D ENT^PRCPRSSP Q
"RTN","PRCPRSSR",29,0)
 ; 
"RTN","PRCPRSSR",30,0)
 N ZTDESC,ZTRTN,ZTSAVE,POP
"RTN","PRCPRSSR",31,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRSSR",32,0)
 .   S ZTDESC="Stock Status Report",ZTRTN="DQ^PRCPRSSR"
"RTN","PRCPRSSR",33,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("DATE*")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRSSR",34,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRSSR",35,0)
 ;
"RTN","PRCPRSSR",36,0)
DQ ;  queue starts here
"RTN","PRCPRSSR",37,0)
 N ACCT,ADJ,ADJN,AVERAGE,D,DA,DATE,DATELONG,DUEIN,DUEOUT,INACT,INACTN,INVVAL,ISS,ISSN,ITEMDA,LONG,LONGN,NONISS,NONISSN,ONHAND,OPEN,QTY,REC,RECN,TOTAL,TOTDAYS,TRANSNO,TYPE,VALUE
"RTN","PRCPRSSR",38,0)
 K OPEN
"RTN","PRCPRSSR",39,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445.1,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S X=$$GETOPEN^PRCPUBAL(PRCP("I"),ITEMDA,$E(DATESTRT,1,5)) I X'="" D
"RTN","PRCPRSSR",40,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPRSSR",41,0)
 .   S $P(OPEN(ACCT),"^")=$P($G(OPEN(ACCT)),"^")+$P(X,"^",2)+$P(X,"^",3)
"RTN","PRCPRSSR",42,0)
 .   S $P(OPEN(ACCT),"^",2)=$P($G(OPEN(ACCT)),"^",2)+$P(X,"^",8)
"RTN","PRCPRSSR",43,0)
 S DATE=DATESTRT F  S DATE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE)) Q:$E(DATE,1,5)'=$E(DATESTRT,1,5)  S TYPE="" F  S TYPE=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE)) Q:TYPE=""  D
"RTN","PRCPRSSR",44,0)
 .   S DA=0 F  S DA=$O(^PRCP(445.2,"AX",PRCP("I"),DATE,TYPE,DA)) Q:'DA  D
"RTN","PRCPRSSR",45,0)
 .   .   S D=$G(^PRCP(445.2,DA,0)) I '$P(D,"^",5) Q
"RTN","PRCPRSSR",46,0)
 .   .   ;  non-issuable
"RTN","PRCPRSSR",47,0)
 .   .   Q:$P(D,"^",11)="N"  ;count if not flagged as non-issueable
"RTN","PRCPRSSR",48,0)
 .   .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1($P(D,"^",5)))
"RTN","PRCPRSSR",49,0)
 .   .   S TRANSNO=$P(D,"^",19)
"RTN","PRCPRSSR",50,0)
 .   .   S INVVAL=$P(D,"^",7)*$P(D,"^",8) I $P(D,"^",22)'="" S INVVAL=$P(D,"^",22)
"RTN","PRCPRSSR",51,0)
 .   .   ;  set transno temporary for primary and secondary to
"RTN","PRCPRSSR",52,0)
 .   .   ;  indicate type of transaction
"RTN","PRCPRSSR",53,0)
 .   .   I PRCP("DPTYPE")'="W" D
"RTN","PRCPRSSR",54,0)
 .   .   .   I TYPE="R"!(TYPE="C")!(TYPE="E")!(TYPE="U")!(TYPE="S") S TRANSNO="--1" Q  ;usage
"RTN","PRCPRSSR",55,0)
 .   .   .   I TYPE="RC" S TRANSNO=1 Q  ;receipt
"RTN","PRCPRSSR",56,0)
 .   .   .   S TRANSNO="" ;adjustment
"RTN","PRCPRSSR",57,0)
 .   .   ;  other adjustments
"RTN","PRCPRSSR",58,0)
 .   .   I PRCP("DPTYPE")="W",$P(TRANSNO,"-",2)="" S ADJ(ACCT)=$G(ADJ(ACCT))+INVVAL,ADJN(ACCT)=$G(ADJN(ACCT))+1 Q
"RTN","PRCPRSSR",59,0)
 .   .   I TRANSNO="" S ADJ(ACCT)=$G(ADJ(ACCT))+INVVAL,ADJN(ACCT)=$G(ADJN(ACCT))+1
"RTN","PRCPRSSR",60,0)
 .   .   E  D
"RTN","PRCPRSSR",61,0)
 .   .   .   ;  purchase order
"RTN","PRCPRSSR",62,0)
 .   .   .   I $P(TRANSNO,"-",3)="" S REC(ACCT)=$G(REC(ACCT))+INVVAL,RECN(ACCT)=$G(RECN(ACCT))+1 Q
"RTN","PRCPRSSR",63,0)
 .   .   .   ;  usage
"RTN","PRCPRSSR",64,0)
 .   .   .   S ISS(ACCT)=$G(ISS(ACCT))+INVVAL,ISSN(ACCT)=$G(ISSN(ACCT))+1
"RTN","PRCPRSSR",65,0)
 ;
"RTN","PRCPRSSR",66,0)
 ;  calculate inactive, long supply, set non-issuable
"RTN","PRCPRSSR",67,0)
 ;
"RTN","PRCPRSSR",68,0)
 ;*98 Modified long supply range to be 90 days instead of 270 days for 
"RTN","PRCPRSSR",69,0)
 ;warehouse, primary, and secondary reporting
"RTN","PRCPRSSR",70,0)
 ;
"RTN","PRCPRSSR",71,0)
 S X1=$E(DT,1,5)_"01",X2=-89 D C^%DTC S DATELONG=$E(X,1,5),X1=DT,X2=$E(X,1,5)_"00" D ^%DTC S TOTDAYS=X
"RTN","PRCPRSSR",72,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S D=$G(^(ITEMDA,0)) I D'="" D
"RTN","PRCPRSSR",73,0)
 .   S ACCT=$$ACCT1^PRCPUX1($$FSC^PRCPUX1(ITEMDA))
"RTN","PRCPRSSR",74,0)
 .   ;  value
"RTN","PRCPRSSR",75,0)
 .   S VALUE(ACCT)=$G(VALUE(ACCT))+$P(D,"^",27)
"RTN","PRCPRSSR",76,0)
 .   S DUEIN(ACCT)=$G(DUEIN(ACCT))+($$GETIN^PRCPUDUE(PRCP("I"),ITEMDA)*$P(D,"^",22))
"RTN","PRCPRSSR",77,0)
 .   S DUEOUT(ACCT)=$G(DUEOUT(ACCT))+($$GETOUT^PRCPUDUE(PRCP("I"),ITEMDA)*$P(D,"^",22))
"RTN","PRCPRSSR",78,0)
 .   ;  non-issuable
"RTN","PRCPRSSR",79,0)
 .   I $P(D,"^",19) S NONISS(ACCT)=$G(NONISS(ACCT))+($J($P(D,"^",19)*$P(D,"^",22),0,2)),NONISSN(ACCT)=$G(NONISSN(ACCT))+1
"RTN","PRCPRSSR",80,0)
 .   ;  inactive
"RTN","PRCPRSSR",81,0)
 .   ;  if reusable, quit
"RTN","PRCPRSSR",82,0)
 .   I $$REUSABLE^PRCPU441(ITEMDA) Q
"RTN","PRCPRSSR",83,0)
 .   S QTY=$P(D,"^",7)+$P(D,"^",19)
"RTN","PRCPRSSR",84,0)
 .   I QTY,'$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,$E(DATEINAC,1,5)-.01)),'$O(^PRCP(445,PRCP("I"),1,ITEMDA,3,DATEINAC)) S INACT(ACCT)=$G(INACT(ACCT))+$P(D,"^",27),INACTN(ACCT)=$G(INACTN(ACCT))+1
"RTN","PRCPRSSR",85,0)
 .   ;  long supply
"RTN","PRCPRSSR",86,0)
 .   S DATE=DATELONG-.01,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPRSSR",87,0)
 .   S AVERAGE=$J(TOTAL/TOTDAYS,0,2),TOTAL=$S('AVERAGE&(QTY):9999999,'AVERAGE:0,1:QTY/AVERAGE\1)
"RTN","PRCPRSSR",88,0)
 .   I TOTAL>90 S LONG(ACCT)=$G(LONG(ACCT))+$P(D,"^",27),LONGN(ACCT)=$G(LONGN(ACCT))+1
"RTN","PRCPRSSR",89,0)
 ;
"RTN","PRCPRSSR",90,0)
 ;*98 Routed printing based on Warehouse
"RTN","PRCPRSSR",91,0)
 D PRINT^PRCPRSS0
"RTN","PRCPRSSR",92,0)
 Q
"RTN","PRCPRSTK")
0^31^B8034390^B7437428
"RTN","PRCPRSTK",1,0)
PRCPRSTK ;WISC/RFJ/VAC-where is an item stocked                         ; 2/19/07 12:51pm
"RTN","PRCPRSTK",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRSTK",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRSTK",4,0)
 ;*98  Modified to accommodate On Demand Items.
"RTN","PRCPRSTK",5,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRSTK",6,0)
 N %,DATA,DATE,DESC,I,INVPT,ITEMDA,NSN,PAGE,PRCPFLAG,SCREEN,TYPE,X,Y
"RTN","PRCPRSTK",7,0)
 N ODITEM,ODINVPT
"RTN","PRCPRSTK",8,0)
ITEM S ITEMDA=$$ITEM^PRCPUITM(PRCP("I"),0,"","") Q:'ITEMDA
"RTN","PRCPRSTK",9,0)
 S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK W !! G ITEM
"RTN","PRCPRSTK",10,0)
 .   S ZTDESC="Display Where an Item is Stocked",ZTRTN="DQ^PRCPRSTK"
"RTN","PRCPRSTK",11,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("ITEMDA")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRSTK",12,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRSTK",13,0)
DQ ;queue comes here
"RTN","PRCPRSTK",14,0)
 K ^TMP($J,"PRCPRSTK"),PRCPFLAG S INVPT=0 F  S INVPT=$O(^PRCP(445,"AE",ITEMDA,INVPT)) Q:'INVPT  S %=$G(^PRCP(445,INVPT,0)) I %'="" S I=$P(%,"^"),TYPE=$P(%,"^",3) S:I="" I="??" S %=$G(^PRCP(445,INVPT,1,ITEMDA,0)) I %'="" D
"RTN","PRCPRSTK",15,0)
 .   S TYPE=$S(TYPE="W":"WAREHOUSE",TYPE="P":"PRIMARY",TYPE="S":"SECONDARY",1:" "),^TMP($J,"PRCPRSTK",TYPE,I)=+$P(%,"^",7)_"^"_$J($$UNITVAL^PRCPUX1($P(%,"^",14),$P(%,"^",5)," / "),12)_"^"_INVPT
"RTN","PRCPRSTK",16,0)
 D NOW^%DTC S Y=% D DD^%DT S DATE=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP,NSN=$$NSN^PRCPUX1(ITEMDA),DESC=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA) U IO D H
"RTN","PRCPRSTK",17,0)
 S TYPE="" F  S TYPE=$O(^TMP($J,"PRCPRSTK",TYPE)) Q:TYPE=""  S I="" F  S I=$O(^TMP($J,"PRCPRSTK",TYPE,I)) Q:I=""  S DATA=^(I) D
"RTN","PRCPRSTK",18,0)
 .   S ODINVPT=$P(DATA,"^",3),ODITEM=$$ODITEM^PRCPUX2(ODINVPT,ITEMDA)
"RTN","PRCPRSTK",19,0)
 .   I ODITEM="W" S ODITEM=""
"RTN","PRCPRSTK",20,0)
 .   I ODITEM="Y" S ODITEM="D"
"RTN","PRCPRSTK",21,0)
 .   W !,$E(TYPE,1,4),?12,I,?48,ODITEM,?50,$J($P(DATA,"^"),10),?66,$P(DATA,"^",2)
"RTN","PRCPRSTK",22,0)
 .   I $Y>(IOSL-4) D:SCREEN P^PRCPUREP S:$D(PRCPFLAG) (I,TYPE)="zzzzzz" Q:$D(PRCPFLAG)  D H
"RTN","PRCPRSTK",23,0)
 I '$D(PRCPFLAG) D END^PRCPUREP
"RTN","PRCPRSTK",24,0)
 D ^%ZISC K ^TMP($J,"PRCPRSTK")
"RTN","PRCPRSTK",25,0)
 I '$D(ZTQUEUED) W !! G ITEM
"RTN","PRCPRSTK",26,0)
 Q
"RTN","PRCPRSTK",27,0)
 ;
"RTN","PRCPRSTK",28,0)
H S %=DATE_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRSTK",29,0)
 W $C(13),"DISPLAY WHERE AN ITEM IS STOCKED",?(80-$L(%)),%,!?4,"PRINTED BY INVENTORY POINT: ",PRCP("IN")
"RTN","PRCPRSTK",30,0)
 W !?4,"NSN: ",NSN,?30,$E(DESC,1,30),?62,"[#",ITEMDA,"]"
"RTN","PRCPRSTK",31,0)
 W !,?48,"O"
"RTN","PRCPRSTK",32,0)
 W ?55,"QTY",?72,"UNIT PER"
"RTN","PRCPRSTK",33,0)
 W !,"TYPE",?12,"SITE-DISTRIBUTION POINT"
"RTN","PRCPRSTK",34,0)
 W ?48,"D"
"RTN","PRCPRSTK",35,0)
 W ?53,"ON-HAND",?73,"ISSUE"
"RTN","PRCPRSTK",36,0)
 S %="",$P(%,"-",81)="" W !,% Q
"RTN","PRCPRUS1")
0^32^B21618591^B20609341
"RTN","PRCPRUS1",1,0)
PRCPRUS1 ;WISC/RFJ/DL/VAC-usage increase,decrease usage report ; 2/19/07 12:52pm
"RTN","PRCPRUS1",2,0)
V ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRUS1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRUS1",4,0)
 ;*98 Modified to accommodate On-Demand Items
"RTN","PRCPRUS1",5,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRUS1",6,0)
 I $P(PRCP("PAR"),"^",3)'="W" D ^PRCPRUS2 Q
"RTN","PRCPRUS1",7,0)
 N %,AVERAGE,CHANGE,COMDATA,COMDT,COMPARE,DATA,DATE,DEFAULT,DESCR,END,ENDDT,ITEMDA,LASTMO,MAXDT,MONTHS,NOW,NOWDT,PAGE,PERCENT,PRCPEND,PRCPFLAG,REPTYPE,SCREEN,START,STARTDT,TOTAL,X,Y,Z,X1,X2
"RTN","PRCPRUS1",8,0)
 D NOW^%DTC S NOWDT=X,Y=% D DD^%DT S NOW=Y,X1=$E(NOWDT,1,5)_"15",X2=-30 D C^%DTC S (LASTMO,Y)=$E(X,1,5)_"00" D DD^%DT S DEFAULT=Y
"RTN","PRCPRUS1",9,0)
 S PRCPEND=$P("31^28^31^30^31^30^31^31^30^31^30^31","^",+$E(NOWDT,4,5))
"RTN","PRCPRUS1",10,0)
 I PRCPEND=28 S Z=$E(NOWDT,1,3)+1700,PRCPEND=$S(Z#400=0:29,(Z#4=0&(Z#100'=0)):29,1:28)
"RTN","PRCPRUS1",11,0)
 S MAXDT=$E(NOWDT,1,5)_PRCPEND,Y=($E(LASTMO,1,3)-1)_$E(LASTMO,4,5)_"00" D DD^%DT S START=Y
"RTN","PRCPRUS1",12,0)
 S %DT="AEP",%DT("A")="Compare Usage to Date (Month Year): ",%DT("B")=DEFAULT,%DT(0)=-MAXDT W ! D ^%DT K %DT Q:Y<0  S COMDT=$E(Y,1,5)
"RTN","PRCPRUS1",13,0)
START S %DT="AEP",%DT("A")="Start Comparison Usage with Date (Month Year): ",%DT("B")=START,%DT(0)=-MAXDT W ! D ^%DT K %DT Q:Y<0  S STARTDT=$E(Y,1,5)
"RTN","PRCPRUS1",14,0)
 S %DT="AEP",%DT("A")="  End Comparison Usage with Date (Month Year): ",%DT("B")=DEFAULT,%DT(0)=-MAXDT D ^%DT K %DT Q:Y<0  S ENDDT=$E(Y,1,5)
"RTN","PRCPRUS1",15,0)
 I ENDDT<STARTDT W !,"END DATE MUST BE GREATER THAN OR EQUAL TO THE START DATE." G START
"RTN","PRCPRUS1",16,0)
 S DIR(0)="N^1:1000",DIR("A")="Enter the percentage of change",DIR("?",1)="Enter a whole number change between 1 and 1000 which represents the percentage",DIR("?")="between the average (from start to end month) and the compare month."
"RTN","PRCPRUS1",17,0)
 S DIR("B")=50 W ! D ^DIR K DIR Q:'+Y  S PERCENT=+Y
"RTN","PRCPRUS1",18,0)
 S DIR(0)="S^D:Decrease in Usage;I:Increase in Usage",DIR("A")="Show Items with Increase or Decrease in Usage",DIR("B")="Decrease in Usage" W ! D ^DIR K DIR
"RTN","PRCPRUS1",19,0)
 S REPTYPE=$S(Y="D":"DECREASE",1:"INCREASE"),SCREEN=$S(Y="D":"I COMDATA<AVERAGE",Y="I":"I COMDATA>AVERAGE",1:"") Q:SCREEN=""
"RTN","PRCPRUS1",20,0)
 S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRUS1",21,0)
 .   S ZTDESC="Usage Demand Analysis Report",ZTRTN="DQ^PRCPRUS1"
"RTN","PRCPRUS1",22,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("REPTYPE")="",ZTSAVE("S*")="",ZTSAVE("END*")="",ZTSAVE("NOW*")="",ZTSAVE("COMDT")="",ZTSAVE("PERCENT")="",ZTSAVE("REP")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRUS1",23,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRUS1",24,0)
DQ ;queue comes here
"RTN","PRCPRUS1",25,0)
 K ^TMP($J,"USAGE") S X1=ENDDT_"00",X2=STARTDT_"00" D ^%DTC S MONTHS=(X+12)\30 S:'MONTHS MONTHS=1
"RTN","PRCPRUS1",26,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  D
"RTN","PRCPRUS1",27,0)
 .   Q:$D(PRCPFLAG)
"RTN","PRCPRUS1",28,0)
 .   S DATE=STARTDT-1,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE!(DATE>ENDDT)  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPRUS1",29,0)
 .   Q:'TOTAL  S AVERAGE=TOTAL/MONTHS,COMDATA=+$P($G(^PRCP(445,PRCP("I"),1,ITEMDA,2,COMDT,0)),"^",2) X SCREEN Q:'$T
"RTN","PRCPRUS1",30,0)
 .   S CHANGE=$S(AVERAGE=0:"***.**",1:(COMDATA-AVERAGE)/AVERAGE*100) S:CHANGE<0 CHANGE=-CHANGE I CHANGE'["*",CHANGE<PERCENT Q
"RTN","PRCPRUS1",31,0)
 .   S ^TMP($J,"USAGE",CHANGE,ITEMDA)=COMDATA_"^"_$J(AVERAGE,0,2)_"^"_$S(CHANGE["*":CHANGE,1:$J(CHANGE,0,2))
"RTN","PRCPRUS1",32,0)
 S Y=COMDT_"00" D DD^%DT S COMPARE=Y,Y=STARTDT_"00" D DD^%DT S START=Y,Y=ENDDT_"00" D DD^%DT S END=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRUS1",33,0)
 S CHANGE="" F  S CHANGE=$O(^TMP($J,"USAGE",CHANGE)) Q:CHANGE=""!($D(PRCPFLAG))  S ITEMDA=0 F  S ITEMDA=$O(^TMP($J,"USAGE",CHANGE,ITEMDA)) Q:'ITEMDA!($D(PRCPFLAG))  S DATA=^(ITEMDA) D
"RTN","PRCPRUS1",34,0)
 .   Q:$D(PRCPFLAG)
"RTN","PRCPRUS1",35,0)
 .   W !,ITEMDA,?10,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,20),?32,$J($P(DATA,"^"),16),$J($P(DATA,"^",2),16),$J($P(DATA,"^",3),16)
"RTN","PRCPRUS1",36,0)
 .   I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRUS1",37,0)
 .   Q:$D(PRCPFLAG)
"RTN","PRCPRUS1",38,0)
 .   I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>"
"RTN","PRCPRUS1",39,0)
 Q:$D(PRCPFLAG)
"RTN","PRCPRUS1",40,0)
 I '$D(PRCPFLAG) D END^PRCPUREP
"RTN","PRCPRUS1",41,0)
 D ^%ZISC K ^TMP($J,"USAGE") Q
"RTN","PRCPRUS1",42,0)
 ;
"RTN","PRCPRUS1",43,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRUS1",44,0)
 W $C(13),"USAGE DEMAND ANALYSIS FOR: ",PRCP("IN"),?(80-$L(%)),%
"RTN","PRCPRUS1",45,0)
 W !?5,"AVERAGE USAGE FROM ",START," TO ",END,"  (",MONTHS," MONTHS)"
"RTN","PRCPRUS1",46,0)
 W !?5,"COMPARE USAGE WITH ",COMPARE,?40,"PERCENT ",REPTYPE," AT LEAST: ",PERCENT," %"
"RTN","PRCPRUS1",47,0)
 S %="",$P(%,"-",81)="" W !,"IM#",?10,"DESCRIPTION",?32,$J("COMPARE QTY",16),$J("AVERAGE QTY",16),$J("% "_REPTYPE,16),!,% Q
"RTN","PRCPRUS2")
0^39^B33114061^n/a
"RTN","PRCPRUS2",1,0)
PRCPRUS2 ;WISC/VAC-usage increase,decrease usage report ; 11/29/06 2:04pm
"RTN","PRCPRUS2",2,0)
V ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPRUS2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRUS2",4,0)
 ;This routine is called from PRCPRUS1 and was modified to work only
"RTN","PRCPRUS2",5,0)
 ;   with Primary and Secondary inventory points.  To call this
"RTN","PRCPRUS2",6,0)
 ;   directly, first run ^PRCPUSEL to set location points
"RTN","PRCPRUS2",7,0)
 N %,AVERAGE,CHANGE,COMDATA,COMDT,COMPARE,DATA,DATE,DEFAULT,DESCR,END,ENDDT,ITEMDA,LASTMO,MAXDT,MONTHS,NOW,NOWDT,PAGE,PERCENT,PRCPEND,PRCPFLAG,REPTYPE,SCREEN,START,STARTDT,TOTAL,X,Y,Z
"RTN","PRCPRUS2",8,0)
 N DATA2,GROUP,GROUPALL,GROUPNM,ODIFLG,ORDER,SRT,TYPNUM,X1,X2
"RTN","PRCPRUS2",9,0)
 D NOW^%DTC S NOWDT=X,Y=% D DD^%DT S NOW=Y,X1=$E(NOWDT,1,5)_"15",X2=-30 D C^%DTC S (LASTMO,Y)=$E(X,1,5)_"00" D DD^%DT S DEFAULT=Y
"RTN","PRCPRUS2",10,0)
 S PRCPEND=$P("31^28^31^30^31^30^31^31^30^31^30^31","^",+$E(NOWDT,4,5))
"RTN","PRCPRUS2",11,0)
 I PRCPEND=28 S Z=$E(NOWDT,1,3)+1700,PRCPEND=$S(Z#400=0:29,(Z#4=0&(Z#100'=0)):29,1:28)
"RTN","PRCPRUS2",12,0)
 S MAXDT=$E(NOWDT,1,5)_PRCPEND,Y=($E(LASTMO,1,3)-1)_$E(LASTMO,4,5)_"00" D DD^%DT S START=Y
"RTN","PRCPRUS2",13,0)
 S %DT="AEP",%DT("A")="Compare Usage to Date (Month Year): ",%DT("B")=DEFAULT,%DT(0)=-MAXDT W ! D ^%DT K %DT Q:Y<0  S COMDT=$E(Y,1,5)
"RTN","PRCPRUS2",14,0)
START S %DT="AEP",%DT("A")="Start Comparison Usage with Date (Month Year): ",%DT("B")=START,%DT(0)=-MAXDT W ! D ^%DT K %DT Q:Y<0  S STARTDT=$E(Y,1,5)
"RTN","PRCPRUS2",15,0)
 S %DT="AEP",%DT("A")="  End Comparison Usage with Date (Month Year): ",%DT("B")=DEFAULT,%DT(0)=-MAXDT D ^%DT K %DT Q:Y<0  S ENDDT=$E(Y,1,5)
"RTN","PRCPRUS2",16,0)
 I ENDDT<STARTDT W !,"END DATE MUST BE GREATER THAN OR EQUAL TO THE START DATE." G START
"RTN","PRCPRUS2",17,0)
 S DIR(0)="N^1:1000",DIR("A")="Enter the percentage of change",DIR("?",1)="Enter a whole number change between 1 and 1000 which represents the percentage",DIR("?")="between the average (from start to end month) and the compare month."
"RTN","PRCPRUS2",18,0)
 S DIR("B")=50 W ! D ^DIR K DIR Q:'+Y  S PERCENT=+Y
"RTN","PRCPRUS2",19,0)
 S DIR(0)="S^D:Decrease in Usage;I:Increase in Usage",DIR("A")="Show Items with Increase or Decrease in Usage",DIR("B")="Decrease in Usage" W ! D ^DIR K DIR
"RTN","PRCPRUS2",20,0)
 S REPTYPE=$S(Y="D":"DECREASE",1:"INCREASE"),SCREEN=$S(Y="D":"I COMDATA<AVERAGE",Y="I":"I COMDATA>AVERAGE",1:"") Q:SCREEN=""
"RTN","PRCPRUS2",21,0)
 ; Insert prompt for Group
"RTN","PRCPRUS2",22,0)
 K X S X(1)="Select the Group Categories to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRUS2",23,0)
 D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRUS2",24,0)
 I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) W !,"*** NO GROUP CATEGORIES SELECTED !" D Q Q
"RTN","PRCPRUS2",25,0)
 W !,"NOTE:  The report will",$S('$G(GROUPALL):" NOT",1:"")," include items not stored in a group category."
"RTN","PRCPRUS2",26,0)
 ; Insert prompt for Standard, ODI or both
"RTN","PRCPRUS2",27,0)
 S TYPNUM=$$ODIPROM^PRCPUX2(0)
"RTN","PRCPRUS2",28,0)
 Q:TYPNUM=0
"RTN","PRCPRUS2",29,0)
DESC ; Insert prompt for sort order by item number or name
"RTN","PRCPRUS2",30,0)
 S SRT=$$SRTPRMP^PRCPUX2(0)
"RTN","PRCPRUS2",31,0)
 Q:SRT=0
"RTN","PRCPRUS2",32,0)
 I (+SRT<1)!(+SRT>2) G DESC
"RTN","PRCPRUS2",33,0)
 S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","PRCPRUS2",34,0)
 .   S ZTDESC="Usage Demand Analysis Report",ZTRTN="DQ^PRCPRUS2"
"RTN","PRCPRUS2",35,0)
 .   S ZTSAVE("PRCP*")="",ZTSAVE("REPTYPE")="",ZTSAVE("S*")="",ZTSAVE("END*")="",ZTSAVE("NOW*")="",ZTSAVE("COMDT")="",ZTSAVE("PERCENT")="",ZTSAVE("REP")="",ZTSAVE("ZTREQ")="@",ZTSAVE("SCREEN")=""
"RTN","PRCPRUS2",36,0)
 .   S ZTSAVE("GROUP*")="",ZTSAVE("^TMP($J,""PRCPURS1"",")="",ZTSAVE("TYP*")=""
"RTN","PRCPRUS2",37,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRUS2",38,0)
DQ ;queue comes here
"RTN","PRCPRUS2",39,0)
 K ^TMP($J,"USAGE2") S X1=ENDDT_"00",X2=STARTDT_"00" D ^%DTC S MONTHS=(X+12)\30 S:'MONTHS MONTHS=1
"RTN","PRCPRUS2",40,0)
 S ITEMDA=0 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:+ITEMDA=0  D
"RTN","PRCPRUS2",41,0)
 .   S DATA2=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0)) Q:DATA2=""
"RTN","PRCPRUS2",42,0)
 .   S GROUP=+$P(DATA2,"^",21)
"RTN","PRCPRUS2",43,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPRUS2",44,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPRUS2",45,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPRUS2",46,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRUS2",47,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRUS2",48,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRUS2",49,0)
 .   I SRT=2 S ORDER=ITEMDA
"RTN","PRCPRUS2",50,0)
 .   I SRT=1 D
"RTN","PRCPRUS2",51,0)
 ..    S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA) S:DESCR="" DESCR=" "
"RTN","PRCPRUS2",52,0)
 ..    S DESCR=$E(DESCR,1,20)
"RTN","PRCPRUS2",53,0)
 ..    S ORDER=DESCR
"RTN","PRCPRUS2",54,0)
 .   S DATE=STARTDT-1,TOTAL=0 F  S DATE=$O(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE)) Q:'DATE!(DATE>ENDDT)  S TOTAL=TOTAL+$P($G(^(DATE,0)),"^",2)
"RTN","PRCPRUS2",55,0)
 .   Q:TOTAL=""  S AVERAGE=TOTAL/MONTHS,COMDATA=+$P($G(^PRCP(445,PRCP("I"),1,ITEMDA,2,COMDT,0)),"^",2) X SCREEN Q:'$T
"RTN","PRCPRUS2",56,0)
 .   S CHANGE=$S(AVERAGE=0:"***.**",1:(COMDATA-AVERAGE)/AVERAGE*100) S:CHANGE<0 CHANGE=-CHANGE I CHANGE'["*",CHANGE<PERCENT Q
"RTN","PRCPRUS2",57,0)
 .   S ^TMP($J,"USAGE2",GROUPNM,ORDER,ITEMDA)=COMDATA_"^"_$J(AVERAGE,0,2)_"^"_$S(CHANGE["*":CHANGE,1:$J(CHANGE,0,2))
"RTN","PRCPRUS2",58,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,PAGE=1
"RTN","PRCPRUS2",59,0)
 S Y=COMDT_"00" D DD^%DT S COMPARE=Y,Y=STARTDT_"00" D DD^%DT S START=Y,Y=ENDDT_"00" D DD^%DT S END=Y,PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRUS2",60,0)
 I $D(^TMP($J))=0 D END^PRCPUREP G Q
"RTN","PRCPRUS2",61,0)
 S GROUPNM="" F  S GROUPNM=$O(^TMP($J,"USAGE2",GROUPNM)) Q:GROUPNM=""  D
"RTN","PRCPRUS2",62,0)
 .Q:$D(PRCPFLAG)
"RTN","PRCPRUS2",63,0)
 . W !,?6,"GROUP:  ",GROUPNM
"RTN","PRCPRUS2",64,0)
 . I GROUPNM=""!(GROUPNM=" ") W "<NONE>"
"RTN","PRCPRUS2",65,0)
 . W !
"RTN","PRCPRUS2",66,0)
 . I $Y>(IOSL-5) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRUS2",67,0)
 . S ORDER="" F  S ORDER=$O(^TMP($J,"USAGE2",GROUPNM,ORDER)) Q:ORDER=""  D
"RTN","PRCPRUS2",68,0)
 .. Q:$D(PRCPFLAG)
"RTN","PRCPRUS2",69,0)
 .. S ITEMDA="" F  S ITEMDA=$O(^TMP($J,"USAGE2",GROUPNM,ORDER,ITEMDA)) Q:ITEMDA=""  D
"RTN","PRCPRUS2",70,0)
 ... S ODIFLG=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRUS2",71,0)
 ... I (TYPNUM=1)&(ODIFLG="Y") Q
"RTN","PRCPRUS2",72,0)
 ... I (TYPNUM=2)&(ODIFLG'="Y") Q
"RTN","PRCPRUS2",73,0)
 ... Q:$D(PRCPFLAG)
"RTN","PRCPRUS2",74,0)
 ... S DATA=$G(^TMP($J,"USAGE2",GROUPNM,ORDER,ITEMDA))
"RTN","PRCPRUS2",75,0)
 ...   W !,ITEMDA
"RTN","PRCPRUS2",76,0)
 ...   S ODIFLG=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRUS2",77,0)
 ...   I ODIFLG="Y" W ?9,"D"
"RTN","PRCPRUS2",78,0)
 ...   W ?15,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,20),?41,$J($P(DATA,"^"),10),?55,$J($P(DATA,"^",2),10),?70,$J($P(DATA,"^",3),9)
"RTN","PRCPRUS2",79,0)
 ...   I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRUS2",80,0)
 ...   Q:$D(PRCPFLAG)
"RTN","PRCPRUS2",81,0)
 ...   I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>"
"RTN","PRCPRUS2",82,0)
 .. Q:$D(PRCPFLAG)
"RTN","PRCPRUS2",83,0)
 . Q:$D(PRCPFLAG)
"RTN","PRCPRUS2",84,0)
 . W !
"RTN","PRCPRUS2",85,0)
 D END^PRCPUREP
"RTN","PRCPRUS2",86,0)
Q D ^%ZISC K ^TMP($J,"USAGE2"),^TMP($J,"PRCPURS1") Q
"RTN","PRCPRUS2",87,0)
 ;
"RTN","PRCPRUS2",88,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRUS2",89,0)
 W $C(13),"USAGE DEMAND ANALYSIS FOR: ",PRCP("IN"),?(80-$L(%)),%
"RTN","PRCPRUS2",90,0)
 W !?5,"AVERAGE USAGE FROM ",START," TO ",END,"  (",MONTHS," MONTHS)"
"RTN","PRCPRUS2",91,0)
 W !?5,"COMPARE USAGE WITH ",COMPARE,?40,"PERCENT ",REPTYPE," AT LEAST: ",PERCENT," %"
"RTN","PRCPRUS2",92,0)
 S %="",$P(%,"-",81)="" W !,"IM#",?8,"OD",?15,"DESCRIPTION",?41,"COMPARE QTY",?55,"AVERAGE QTY",?70,"% "_REPTYPE,!,% Q
"RTN","PRCPRUSE")
0^33^B26326932^B26472627
"RTN","PRCPRUSE",1,0)
PRCPRUSE ;WISC/RFJ,DWA,VAC-usage demand item report  ; 10/19/06 9:53am
"RTN","PRCPRUSE",2,0)
V ;;5.1;IFCAP;**1,27,84,98**;Oct 20, 2000;Build 37
"RTN","PRCPRUSE",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRUSE",4,0)
 D ^PRCPUSEL Q:'$G(PRCP("I"))
"RTN","PRCPRUSE",5,0)
 ;
"RTN","PRCPRUSE",6,0)
 N DATEEND,DATEENDD,DATESTRD,DATESTRT,DIR,GROUPALL,PRCPALLI,PRCPEND,PRCPSTRT,TOTALDAY,X,X1,X2,Y
"RTN","PRCPRUSE",7,0)
 N ODIFLG,ODITEM,REORDER,PRCPSORT
"RTN","PRCPRUSE",8,0)
 ;
"RTN","PRCPRUSE",9,0)
 K X S X(1)="The Usage Demand Item Report will show the quantity of items used within a specified date period."
"RTN","PRCPRUSE",10,0)
 D DISPLAY^PRCPUX2(40,79,.X)
"RTN","PRCPRUSE",11,0)
 ;
"RTN","PRCPRUSE",12,0)
 K X S X(1)="Select the date range which should be used for displaying the usage.        *** Select by month & year only. ***"
"RTN","PRCPRUSE",13,0)
 D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRUSE",14,0)
 D MONTHSEL^PRCPURS2
"RTN","PRCPRUSE",15,0)
 I '$G(DATEEND) Q
"RTN","PRCPRUSE",16,0)
 ;
"RTN","PRCPRUSE",17,0)
 S X1=DATEEND,X2=DATESTRT D ^%DTC S TOTALDAY=X+1
"RTN","PRCPRUSE",18,0)
 S Y=DATEEND D DD^%DT
"RTN","PRCPRUSE",19,0)
 S DATEENDD=Y,Y=DATESTRT D DD^%DT
"RTN","PRCPRUSE",20,0)
 S DATESTRD=Y
"RTN","PRCPRUSE",21,0)
 W !?5,"-- TOTAL NUMBER OF DAYS: ",TOTALDAY
"RTN","PRCPRUSE",22,0)
 ;
"RTN","PRCPRUSE",23,0)
 ;  item(s)
"RTN","PRCPRUSE",24,0)
 K X S X(1)="Select specific items to display."
"RTN","PRCPRUSE",25,0)
 D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRUSE",26,0)
 D ITEMSEL^PRCPURS4
"RTN","PRCPRUSE",27,0)
 I '$G(PRCPALLI),'$O(^TMP($J,"PRCPURS4","")) Q
"RTN","PRCPRUSE",28,0)
 I '$G(PRCPALLI) D  G SORT
"RTN","PRCPRUSE",29,0)
 .   S GROUPALL=1
"RTN","PRCPRUSE",30,0)
 ;
"RTN","PRCPRUSE",31,0)
 ;  whse sort
"RTN","PRCPRUSE",32,0)
 I PRCP("DPTYPE")="W" D  I '$D(PRCPSTRT) Q
"RTN","PRCPRUSE",33,0)
 .   K X S X(1)="Select the range of NSNs to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRUSE",34,0)
 .   D NSNSEL^PRCPURS0
"RTN","PRCPRUSE",35,0)
 ;
"RTN","PRCPRUSE",36,0)
 ;  prim/seco sort
"RTN","PRCPRUSE",37,0)
 I PRCP("DPTYPE")'="W" D  I '$G(GROUPALL),'$O(^TMP($J,"PRCPURS1","YES",0)) W !,"*** NO GROUP CATEGORIES SELECTED !" Q
"RTN","PRCPRUSE",38,0)
 .   K X S X(1)="Select the Group Categories to display" D DISPLAY^PRCPUX2(2,40,.X)
"RTN","PRCPRUSE",39,0)
 .   D GROUPSEL^PRCPURS1(PRCP("I"))
"RTN","PRCPRUSE",40,0)
 ;
"RTN","PRCPRUSE",41,0)
SORT S ODIFLG=3
"RTN","PRCPRUSE",42,0)
 I PRCP("DPTYPE")'="W" D
"RTN","PRCPRUSE",43,0)
 .Q:$G(PRCPALLI)=""
"RTN","PRCPRUSE",44,0)
 .S ODIFLG=$$ODIPROM^PRCPUX2(0)
"RTN","PRCPRUSE",45,0)
 Q:ODIFLG=0
"RTN","PRCPRUSE",46,0)
 S PRCPSORT=$$SRTPRMP^PRCPUX2(0)
"RTN","PRCPRUSE",47,0)
 Q:PRCPSORT=0
"RTN","PRCPRUSE",48,0)
 ;
"RTN","PRCPRUSE",49,0)
QUEUE S %ZIS="Q" D ^%ZIS Q:POP  I $D(IO("Q")) D  Q
"RTN","PRCPRUSE",50,0)
 .   S ZTDESC="Usage Demand Item Report",ZTRTN="DQ^PRCPRUSE"
"RTN","PRCPRUSE",51,0)
 .   S ZTSAVE("^TMP($J,""PRCPURS4"",")="",ZTSAVE("^TMP($J,""PRCPURS1"",")="",ZTSAVE(ODIFLG)=""
"RTN","PRCPRUSE",52,0)
 .   S ZTSAVE("DATE*")="",ZTSAVE("GROUP*")="",ZTSAVE("PRCP*")="",ZTSAVE("TOTALDAY")="",ZTSAVE("ZTREQ")="@"
"RTN","PRCPRUSE",53,0)
 .   S ZTSAVE("O*")=""
"RTN","PRCPRUSE",54,0)
 .   D ^%ZTLOAD
"RTN","PRCPRUSE",55,0)
 W !!,"<*> please wait <*>"
"RTN","PRCPRUSE",56,0)
 ;
"RTN","PRCPRUSE",57,0)
DQ ;  queue starts here
"RTN","PRCPRUSE",58,0)
 N %,%H,%I,COLUMN,DATA,DATE,DESCR,GROUP,GROUPNM,ITEMDA,MONYR,NOW,NSN,PAGE,PRCPFLAG,SCREEN,TOTCOST,TOTUSED,TTOTCOST,TTOTUSED,VALUE,X,Y
"RTN","PRCPRUSE",59,0)
 K ^TMP($J,"PRCPRUSE")
"RTN","PRCPRUSE",60,0)
 S ITEMDA=0
"RTN","PRCPRUSE",61,0)
 I $G(PRCPALLI) F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:'ITEMDA  S DATA=$G(^(ITEMDA,0)) I DATA'="" D
"RTN","PRCPRUSE",62,0)
 .   S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA)
"RTN","PRCPRUSE",63,0)
 .   S VALUE=DESCR_"^"_$$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/")_"^"_$P(DATA,"^",15)_"^"_$P(DATA,"^",22)_"^"_($P(DATA,"^",7)+$P(DATA,"^",19))
"RTN","PRCPRUSE",64,0)
 .   ;
"RTN","PRCPRUSE",65,0)
 .   ;  sort for whse
"RTN","PRCPRUSE",66,0)
 .   I PRCP("DPTYPE")="W" D  Q
"RTN","PRCPRUSE",67,0)
 .   .   S NSN=$$NSN^PRCPUX1(ITEMDA) S:NSN="" NSN=" "
"RTN","PRCPRUSE",68,0)
 .   .   I $E(NSN,1,$L(PRCPSTRT))'=PRCPSTRT,$E(NSN,1,$L(PRCPEND))'=PRCPEND I NSN']PRCPSTRT!(PRCPEND']NSN) Q
"RTN","PRCPRUSE",69,0)
 .   .   I PRCPSORT=1 S ^TMP($J,"PRCPRUSE",NSN,$E(DESCR,1,15),ITEMDA)=VALUE
"RTN","PRCPRUSE",70,0)
 .   .   I PRCPSORT=2 S ^TMP($J,"PRCPRUSE",NSN,$E("000000000",$L(ITEMDA)+1,9)_ITEMDA,ITEMDA)=VALUE
"RTN","PRCPRUSE",71,0)
 .   ;
"RTN","PRCPRUSE",72,0)
 .   ;  sort for primary and secondary
"RTN","PRCPRUSE",73,0)
 .   S GROUP=+$P(DATA,"^",21)
"RTN","PRCPRUSE",74,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPRUSE",75,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPRUSE",76,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPRUSE",77,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRUSE",78,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRUSE",79,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRUSE",80,0)
 .   I PRCPSORT=1 S ^TMP($J,"PRCPRUSE",GROUPNM,$E(DESCR,1,15),ITEMDA)=VALUE
"RTN","PRCPRUSE",81,0)
 .   I PRCPSORT=2 S ^TMP($J,"PRCPRUSE",GROUPNM,$E("000000000",$L(ITEMDA)+1,9)_ITEMDA,ITEMDA)=VALUE
"RTN","PRCPRUSE",82,0)
 ;
"RTN","PRCPRUSE",83,0)
 I '$G(PRCPALLI) F  S ITEMDA=$O(^TMP($J,"PRCPURS4",ITEMDA)) Q:'ITEMDA  S DATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0)) I DATA'="" D
"RTN","PRCPRUSE",84,0)
 .   S DESCR=$$DESCR^PRCPUX1(PRCP("I"),ITEMDA)
"RTN","PRCPRUSE",85,0)
 .   S VALUE=DESCR_"^"_$$UNIT^PRCPUX1(PRCP("I"),ITEMDA,"/")_"^"_$P(DATA,"^",15)_"^"_$P(DATA,"^",22)_"^"_($P(DATA,"^",7)+$P(DATA,"^",19))
"RTN","PRCPRUSE",86,0)
 .   ;
"RTN","PRCPRUSE",87,0)
 .   ;  sort for whse
"RTN","PRCPRUSE",88,0)
 .   I PRCP("DPTYPE")="W" D  Q
"RTN","PRCPRUSE",89,0)
 .   .   S NSN=$$NSN^PRCPUX1(ITEMDA) S:NSN="" NSN=" "
"RTN","PRCPRUSE",90,0)
 .   .   I PRCPSORT=1 S ^TMP($J,"PRCPRUSE",NSN,$E(DESCR,1,15),ITEMDA)=VALUE
"RTN","PRCPRUSE",91,0)
 .   .   I PRCPSORT=2 S ^TMP($J,"PRCPRUSE",NSN,$E("000000000",$L(ITEMDA)+1,9)_ITEMDA,ITEMDA)=VALUE
"RTN","PRCPRUSE",92,0)
 .   ;
"RTN","PRCPRUSE",93,0)
 .   ;  sort for primary and secondary
"RTN","PRCPRUSE",94,0)
 .   S GROUP=+$P(DATA,"^",21)
"RTN","PRCPRUSE",95,0)
 .   I 'GROUP,'$G(GROUPALL) Q
"RTN","PRCPRUSE",96,0)
 .   I $G(GROUPALL),$D(^TMP($J,"PRCPURS1","NO",GROUP)) Q
"RTN","PRCPRUSE",97,0)
 .   I '$G(GROUPALL),'$D(^TMP($J,"PRCPURS1","YES",GROUP)) Q
"RTN","PRCPRUSE",98,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPRUSE",99,0)
 .   I GROUPNM'="" S GROUPNM=$E(GROUPNM,1,20)_" (#"_GROUP_")"
"RTN","PRCPRUSE",100,0)
 .   S:GROUPNM="" GROUPNM=" "
"RTN","PRCPRUSE",101,0)
 .   I PRCPSORT=1 S ^TMP($J,"PRCPRUSE",GROUPNM,$E(DESCR,1,15),ITEMDA)=VALUE
"RTN","PRCPRUSE",102,0)
 .   I PRCPSORT=2 S ^TMP($J,"PRCPRUSE",GROUPNM,$E("000000000",$L(ITEMDA)+1,9)_ITEMDA,ITEMDA)=VALUE
"RTN","PRCPRUSE",103,0)
 ;
"RTN","PRCPRUSE",104,0)
 D PRINT^PRCPRUSP
"RTN","PRCPRUSE",105,0)
 Q
"RTN","PRCPRUSP")
0^34^B21023718^B14471126
"RTN","PRCPRUSP",1,0)
PRCPRUSP ;WISC/RFJ/VAC-usage demand item report (print report)          ; 3/6/07 9:00am
"RTN","PRCPRUSP",2,0)
V ;;5.1;IFCAP;**1,98**;Oct 20, 2000;Build 37
"RTN","PRCPRUSP",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPRUSP",4,0)
 ;*98 Modified to accommodate On-Demand Items
"RTN","PRCPRUSP",5,0)
 Q
"RTN","PRCPRUSP",6,0)
 ;
"RTN","PRCPRUSP",7,0)
 ;
"RTN","PRCPRUSP",8,0)
PRINT ;  print report
"RTN","PRCPRUSP",9,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y
"RTN","PRCPRUSP",10,0)
 S PAGE=1,SCREEN=$$SCRPAUSE^PRCPUREP U IO D H
"RTN","PRCPRUSP",11,0)
 ;
"RTN","PRCPRUSP",12,0)
 ;  whse
"RTN","PRCPRUSP",13,0)
 I PRCP("DPTYPE")="W" D
"RTN","PRCPRUSP",14,0)
 . S NSN=""
"RTN","PRCPRUSP",15,0)
 . F  S NSN=$O(^TMP($J,"PRCPRUSE",NSN)) Q:NSN=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",16,0)
 . . S DESCR=0
"RTN","PRCPRUSP",17,0)
 . . F  S DESCR=$O(^TMP($J,"PRCPRUSE",NSN,DESCR)) Q:DESCR']""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",18,0)
 . . . S ITEMDA=0
"RTN","PRCPRUSP",19,0)
 . . . F  S ITEMDA=$O(^TMP($J,"PRCPRUSE",NSN,DESCR,ITEMDA)) Q:'ITEMDA  D  Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",20,0)
 . . . . S DATA=^TMP($J,"PRCPRUSE",NSN,DESCR,ITEMDA)
"RTN","PRCPRUSP",21,0)
 . . . . I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRUSP",22,0)
 . . . . I $Y>(IOSL-8) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRUSP",23,0)
 . . . . W !,$TR(NSN,"-"),?15,$E($P(DATA,"^"),1,15)
"RTN","PRCPRUSP",24,0)
 . . . . D USAGE
"RTN","PRCPRUSP",25,0)
 . . . . Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",26,0)
 ;
"RTN","PRCPRUSP",27,0)
 Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",28,0)
 ;  primary and secondary
"RTN","PRCPRUSP",29,0)
 I PRCP("DPTYPE")'="W" D
"RTN","PRCPRUSP",30,0)
 . S GROUP=""
"RTN","PRCPRUSP",31,0)
 . F  S GROUP=$O(^TMP($J,"PRCPRUSE",GROUP)) Q:GROUP=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",32,0)
 . . I $G(ZTQUEUED),$$S^%ZTLOAD S PRCPFLAG=1 W !?10,"<<< TASKMANAGER JOB TERMINATED BY USER >>>" Q
"RTN","PRCPRUSP",33,0)
 . . Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",34,0)
 . . I $Y>(IOSL-8) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRUSP",35,0)
 . . W !!?5,"GROUP: ",$S(GROUP=" ":"<<NONE>>",1:GROUP)
"RTN","PRCPRUSP",36,0)
 . . S DESCR=""
"RTN","PRCPRUSP",37,0)
 . . F  S DESCR=$O(^TMP($J,"PRCPRUSE",GROUP,DESCR)) Q:DESCR=""  D  Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",38,0)
 . . . S ITEMDA=0
"RTN","PRCPRUSP",39,0)
 . . . F  S ITEMDA=$O(^TMP($J,"PRCPRUSE",GROUP,DESCR,ITEMDA)) Q:'ITEMDA  D  Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",40,0)
 . . . . S DATA=^TMP($J,"PRCPRUSE",GROUP,DESCR,ITEMDA)
"RTN","PRCPRUSP",41,0)
 . . . . S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRUSP",42,0)
 . . . . Q:ODITEM="Y"&(ODIFLG=1)
"RTN","PRCPRUSP",43,0)
 . . . . Q:ODITEM=""&(ODIFLG=2)
"RTN","PRCPRUSP",44,0)
 . . . . I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRUSP",45,0)
 . . . . W !,$E($$DESCR^PRCPUX1(PRCP("I"),ITEMDA),1,25)
"RTN","PRCPRUSP",46,0)
 . . . . D USAGE
"RTN","PRCPRUSP",47,0)
 . . . . Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",48,0)
 . . . Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",49,0)
 . . Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",50,0)
 . Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",51,0)
 ;
"RTN","PRCPRUSP",52,0)
 I '$D(PRCPFLAG) D END^PRCPUREP
"RTN","PRCPRUSP",53,0)
 K ^TMP($J,"PRCPRUSE"),^TMP($J,"PRCPURS1")
"RTN","PRCPRUSP",54,0)
 D ^%ZISC
"RTN","PRCPRUSP",55,0)
 Q
"RTN","PRCPRUSP",56,0)
 ;
"RTN","PRCPRUSP",57,0)
 ;
"RTN","PRCPRUSP",58,0)
USAGE ;  display usage
"RTN","PRCPRUSP",59,0)
 I PRCP("DPTYPE")="W" D
"RTN","PRCPRUSP",60,0)
 .W ?31,ITEMDA
"RTN","PRCPRUSP",61,0)
 .W ?38,$J($P(DATA,"^",2),8)
"RTN","PRCPRUSP",62,0)
 .W $J($P(DATA,"^",3),12,3)
"RTN","PRCPRUSP",63,0)
 .W $J($P(DATA,"^",4),12,3)
"RTN","PRCPRUSP",64,0)
 .W $J($P(DATA,"^",5),9)
"RTN","PRCPRUSP",65,0)
 I PRCP("DPTYPE")'="W" D
"RTN","PRCPRUSP",66,0)
 .S ODITEM=$$ODITEM^PRCPUX2(PRCP("I"),ITEMDA)
"RTN","PRCPRUSP",67,0)
 .W ?27,ITEMDA
"RTN","PRCPRUSP",68,0)
 .I ODITEM="Y" W ?35,"D"
"RTN","PRCPRUSP",69,0)
 .W ?38,$J($P(DATA,"^",2),8)
"RTN","PRCPRUSP",70,0)
 .W ?47,$J($P(DATA,"^",3),12,3)
"RTN","PRCPRUSP",71,0)
 .W $J($P(DATA,"^",4),12,3)
"RTN","PRCPRUSP",72,0)
 .W $J($P(DATA,"^",5),9),!
"RTN","PRCPRUSP",73,0)
 .I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H W !
"RTN","PRCPRUSP",74,0)
 .S REORDER=$G(^PRCP(445,PRCP("I"),1,ITEMDA,0))
"RTN","PRCPRUSP",75,0)
 .W ?4,"NORM: ",$P(REORDER,"^",9)
"RTN","PRCPRUSP",76,0)
 .W ?26,"REORD: ",$P(REORDER,"^",10)
"RTN","PRCPRUSP",77,0)
 .W ?48,"OPT: ",$P(REORDER,"^",4)
"RTN","PRCPRUSP",78,0)
 .W ?67,"EMER: ",$P(REORDER,"^",11)
"RTN","PRCPRUSP",79,0)
 .I $Y>(IOSL-6) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRUSP",80,0)
 Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",81,0)
 S (COLUMN,TOTUSED,TOTCOST,TTOTUSED,TTOTCOST)=0
"RTN","PRCPRUSP",82,0)
 S DATE=$E(DATESTRT,1,5)-1
"RTN","PRCPRUSP",83,0)
 F  S DATE=DATE+1 S:$E(DATE,4,5)=13 DATE=($E(DATE,1,3)+1)_"01" Q:DATE>$E(DATEEND,1,5)!($D(PRCPFLAG))  D
"RTN","PRCPRUSP",84,0)
 .   I $Y>(IOSL-4) D:SCREEN P^PRCPUREP Q:$D(PRCPFLAG)  D H
"RTN","PRCPRUSP",85,0)
 .   S DATA=$G(^PRCP(445,PRCP("I"),1,ITEMDA,2,DATE,0))
"RTN","PRCPRUSP",86,0)
 .   S MONYR=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",+$E(DATE,4,5))_$E(DATE,2,3)
"RTN","PRCPRUSP",87,0)
 .   S TOTUSED=TOTUSED+$P(DATA,"^",2),TOTCOST=TOTCOST+$P(DATA,"^",3)
"RTN","PRCPRUSP",88,0)
 .   S COLUMN=COLUMN+1
"RTN","PRCPRUSP",89,0)
 .   W:COLUMN=1 !?4 W:COLUMN=2 ?31 W:COLUMN=3 ?58
"RTN","PRCPRUSP",90,0)
 .   W MONYR,$J(+$P(DATA,"^",2),7),$J(+$P(DATA,"^",3),10,2)
"RTN","PRCPRUSP",91,0)
 .   I COLUMN=3 S COLUMN=0
"RTN","PRCPRUSP",92,0)
 Q:$D(PRCPFLAG)
"RTN","PRCPRUSP",93,0)
 S TTOTUSED=TTOTUSED+TOTUSED,TTOTCOST=TTOTCOST+TOTCOST
"RTN","PRCPRUSP",94,0)
 W !?4,"---------------------------------------- CUMULATIVE TOTAL"
"RTN","PRCPRUSP",95,0)
 W ?63,$J(TTOTUSED,7),$J(TTOTCOST,10,2),!
"RTN","PRCPRUSP",96,0)
 Q
"RTN","PRCPRUSP",97,0)
 ;
"RTN","PRCPRUSP",98,0)
 ;
"RTN","PRCPRUSP",99,0)
H S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1 I PAGE'=2!(SCREEN) W @IOF
"RTN","PRCPRUSP",100,0)
 W $C(13),"USAGE DEMAND ITEM REPORT: ",$E(PRCP("IN"),1,20),?(80-$L(%)),%
"RTN","PRCPRUSP",101,0)
 S %="",$P(%,"-",81)=""
"RTN","PRCPRUSP",102,0)
 W !?5,"USAGE DATE RANGE FROM ",DATESTRD,"  TO  ",DATEENDD,"  (",TOTALDAY," DAYS)"
"RTN","PRCPRUSP",103,0)
 I PRCP("DPTYPE")'="W" D
"RTN","PRCPRUSP",104,0)
 .I ODIFLG=1 W !,?5,"STANDARD ITEMS ONLY"
"RTN","PRCPRUSP",105,0)
 .I ODIFLG=2 W !,?5,"ON-DEMAND ITEMS ONLY"
"RTN","PRCPRUSP",106,0)
 .I ODIFLG=3 W !,?5,"ALL ITEMS (STANDARD AND ON-DEMAND)"
"RTN","PRCPRUSP",107,0)
 I PRCP("DPTYPE")="W" W !,"NSN",?15,"DESCRIPTION"
"RTN","PRCPRUSP",108,0)
 E  W !,"DESCRIPTION"
"RTN","PRCPRUSP",109,0)
 I PRCP("DPTYPE")'="W" D
"RTN","PRCPRUSP",110,0)
 . W ?27,"IM",?35,"OD",?40,"UNIT/IS",?53,"LAST $",?66,"AVG $",?73,"ON-HAND",!,%
"RTN","PRCPRUSP",111,0)
 I PRCP("DPTYPE")="W" D
"RTN","PRCPRUSP",112,0)
 . W ?31,"IM",?38,$J("UNIT/IS",8),$J("LAST $",12),$J("AVG $",12),$J("ON-HAND",9),!,%
"RTN","PRCPRUSP",113,0)
 Q
"RTN","PRCPUINV")
0^43^B22949954^B22443803
"RTN","PRCPUINV",1,0)
PRCPUINV ;WISC/RFJ/DGL-inventory point selection ; 9/20/06 11:04am
"RTN","PRCPUINV",2,0)
V ;;5.1;IFCAP;**1,98**;Oct 20, 2000;Build 37
"RTN","PRCPUINV",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPUINV",4,0)
 Q
"RTN","PRCPUINV",5,0)
 ;
"RTN","PRCPUINV",6,0)
 ;
"RTN","PRCPUINV",7,0)
INVPT(PRCPSITE,PRCPTYPE,ADDNEW,PRCPUSER,DEFAULT) ;  select inventory point
"RTN","PRCPUINV",8,0)
 ;  prcptype=w or p or s
"RTN","PRCPUINV",9,0)
 ;  addnew  =1 to add new inventory points
"RTN","PRCPUINV",10,0)
 ;  prcpuser=1 to screen and set user
"RTN","PRCPUINV",11,0)
 ;  default =default inventory point
"RTN","PRCPUINV",12,0)
 ;  return da; 0 no item selected; ^ for ^ entered or timeout
"RTN","PRCPUINV",13,0)
 I 'PRCPSITE!("WPS"'[PRCPTYPE) Q ""
"RTN","PRCPUINV",14,0)
 N %,D0,DA,DI,DIE,DG,DIC,DISYS,DLAYGO,DQ,DR,PRC,PRCPPRIV,X,Y
"RTN","PRCPUINV",15,0)
 S PRC("SITE")=PRCPSITE
"RTN","PRCPUINV",16,0)
 ;  do not allow adding new entries for whse if defined
"RTN","PRCPUINV",17,0)
 I PRCPTYPE="W" F %=0:0 S %=$O(^PRCP(445,"AC","W",%)) Q:'%  I +$G(^PRCP(445,%,0))=PRCPSITE S ADDNEW=0 Q
"RTN","PRCPUINV",18,0)
 S DIC="^PRCP(445,",DIC(0)="QEAM",DIC("A")="Select a '"_$S(PRCPTYPE="W":"Warehouse",PRCPTYPE="P":"Primary",1:"Secondary")_"' Type Inventory Point: "
"RTN","PRCPUINV",19,0)
 I DEFAULT'="" S DIC("B")=DEFAULT
"RTN","PRCPUINV",20,0)
 I ADDNEW S DIC(0)="QEALM",DLAYGO=445,DIC("DR")=".8;.7///"_PRCPTYPE_";.5//"_$S(PRCPTYPE="S":"NO",1:"YES")_";.6//"_$S(PRCPTYPE="S":"NO",1:"YES")_";"_$S(PRCPTYPE="S":"",1:".9;")
"RTN","PRCPUINV",21,0)
 S DIC("S")="I +^(0)=PRCPSITE,$P(^(0),U,3)=PRCPTYPE"_$S(PRCPUSER:",$D(^PRCP(445,+Y,4,+$G(DUZ),0))",1:""),PRCPPRIV=1
"RTN","PRCPUINV",22,0)
 W ! D ^DIC
"RTN","PRCPUINV",23,0)
 ;  if new entry added, add authorized user
"RTN","PRCPUINV",24,0)
 I $P(Y,"^",3),$G(DUZ),PRCPUSER D
"RTN","PRCPUINV",25,0)
 .   D ADDUSER^PRCPXTRM(+Y,DUZ)
"RTN","PRCPUINV",26,0)
 .   W !?2,"TYPE OF INVENTORY POINT: ",$S(PRCPTYPE="W":"WAREHOUSE",PRCPTYPE="P":"PRIMARY",1:"SECONDARY")
"RTN","PRCPUINV",27,0)
 Q $S($G(DUOUT):"^",$G(DTOUT):"^",Y<1:0,1:+Y)
"RTN","PRCPUINV",28,0)
 ;
"RTN","PRCPUINV",29,0)
 ;
"RTN","PRCPUINV",30,0)
TYPE ;  called from 445,.7 input transform.  you cannot have
"RTN","PRCPUINV",31,0)
 ;  multiple warehouses with the same station number
"RTN","PRCPUINV",32,0)
 N STATION,%
"RTN","PRCPUINV",33,0)
 S STATION=+$G(^PRCP(445,DA,0)),%=0
"RTN","PRCPUINV",34,0)
 F  S %=$O(^PRCP(445,"AC","W",%)) Q:'%  I %'=DA,+$G(^PRCP(445,%,0))=STATION W !?2,"YOU CANNOT HAVE MULTIPLE WAREHOUSES WITH THE SAME STATION NUMBER." K X Q
"RTN","PRCPUINV",35,0)
 Q
"RTN","PRCPUINV",36,0)
 ;
"RTN","PRCPUINV",37,0)
 ;
"RTN","PRCPUINV",38,0)
KILL(INVPT) ;  update all pointers when deleting an inventory point
"RTN","PRCPUINV",39,0)
 ; (invoked from 'DEL' node in .01 field of file 445)
"RTN","PRCPUINV",40,0)
 ; 
"RTN","PRCPUINV",41,0)
 N %,DATA,NAME,OUTORD,X
"RTN","PRCPUINV",42,0)
 S XP(1)="You cannot delete inventory points after they are created."
"RTN","PRCPUINV",43,0)
 S XP(2)="This action removes all the items, distribution points, users,"
"RTN","PRCPUINV",44,0)
 S XP(3)="etc., for the inventory point and changes the name to"
"RTN","PRCPUINV",45,0)
 S XP(4)="STATIONNUMBER-'***INACTIVE_#***' where # is the internal entry number."
"RTN","PRCPUINV",46,0)
 S XP="",XP(5)="",XP(6)="  ARE YOU SURE YOU WANT TO PROCEED"
"RTN","PRCPUINV",47,0)
 I $$YN^PRCPUYN(2)'=1 Q
"RTN","PRCPUINV",48,0)
 ;
"RTN","PRCPUINV",49,0)
 ; quit if this inventory point has outstanding distribution orders
"RTN","PRCPUINV",50,0)
 S DATA=$P(^PRCP(445,INVPT,0),"^",3) ; search for primary or secondary
"RTN","PRCPUINV",51,0)
 I DATA="P"!(DATA="S") D  I OUTORD Q
"RTN","PRCPUINV",52,0)
 . S OUTORD=$$ORDCHK^PRCPUITM(0,INVPT,"REC","")
"RTN","PRCPUINV",53,0)
 . I OUTORD D  Q
"RTN","PRCPUINV",54,0)
 . . D EN^DDIOL("You must first post or delete outstanding orders for this inventory point.")
"RTN","PRCPUINV",55,0)
 . . I +$G(DQ) S DE(+$G(DQ))=$P($G(^PRCP(445,INVPT,0)),"^",1)
"RTN","PRCPUINV",56,0)
 . . W !!
"RTN","PRCPUINV",57,0)
 ;
"RTN","PRCPUINV",58,0)
 ; if the inventory point is linked to a supply station
"RTN","PRCPUINV",59,0)
 I $P($G(^PRCP(445,INVPT,5)),"^",1)]"" D  Q
"RTN","PRCPUINV",60,0)
 . D EN^DDIOL("This inventory point is linked to a supply station.")
"RTN","PRCPUINV",61,0)
 . D EN^DDIOL("You must first delete the Supply Station Provider.")
"RTN","PRCPUINV",62,0)
 ; 
"RTN","PRCPUINV",63,0)
 W !?3,"Wait, deleting data, changing name, etc..."
"RTN","PRCPUINV",64,0)
 S DATA=$P($G(^PRCP(445,INVPT,5)),"^",1) ; supply station
"RTN","PRCPUINV",65,0)
 I DATA K ^PRCP(445,"AI",DATA,INVPT)
"RTN","PRCPUINV",66,0)
 ;  remove x-ref on inventory points
"RTN","PRCPUINV",67,0)
 S %=0 F  S %=$O(^PRCP(445,INVPT,2,%)) Q:'%  K ^PRCP(445,"AB",%,INVPT,%)
"RTN","PRCPUINV",68,0)
 ;  remove x-ref on inventory,ODI users ("AJ" (ODI) from PRC*5.1*98)
"RTN","PRCPUINV",69,0)
 S %=0 F  S %=$O(^PRCP(445,INVPT,4,%)) Q:'%  K ^PRCP(445,"AD",%,INVPT,%)
"RTN","PRCPUINV",70,0)
 S %=0 F  S %=$O(^PRCP(445,INVPT,9,%)) Q:'%  K ^PRCP(445,"AJ",%,INVPT,%)
"RTN","PRCPUINV",71,0)
 ;  remove x-ref on items
"RTN","PRCPUINV",72,0)
 S %=0 F  S %=$O(^PRCP(445,INVPT,1,%)) Q:'%  D
"RTN","PRCPUINV",73,0)
 . K ^PRCP(445,"AE",%,INVPT,%)
"RTN","PRCPUINV",74,0)
 . I DATA K ^PRCP(445,"AH",%,DATA,INVPT)
"RTN","PRCPUINV",75,0)
 ;  change name, etc
"RTN","PRCPUINV",76,0)
 S X=^PRCP(445,INVPT,0),NAME=$P(X,"^")
"RTN","PRCPUINV",77,0)
 S:$P(NAME,"-",2,99)="" $P(NAME,"-",2,99)=" "
"RTN","PRCPUINV",78,0)
 S:$P(X,"^",5)="" $P(X,"^",5)=" "
"RTN","PRCPUINV",79,0)
 K ^PRCP(445,"AF",+X,$P(X,"^",5),INVPT)
"RTN","PRCPUINV",80,0)
 K ^PRCP(445,"B",$P(X,"^"),INVPT)
"RTN","PRCPUINV",81,0)
 K ^PRCP(445,"C",$P(NAME,"-",2,99),INVPT)
"RTN","PRCPUINV",82,0)
 K ^PRCP(445,INVPT)
"RTN","PRCPUINV",83,0)
 S $P(NAME,"-",2,99)="***INACTIVE_"_INVPT_"***"
"RTN","PRCPUINV",84,0)
 S ^PRCP(445,"B",NAME,INVPT)=""
"RTN","PRCPUINV",85,0)
 S ^PRCP(445,"C",$P(NAME,"-",2),INVPT)=""
"RTN","PRCPUINV",86,0)
 S ^PRCP(445,INVPT,0)=NAME_"^N^"_$P(X,"^",3)_"^^^N"
"RTN","PRCPUINV",87,0)
 W !?5,"Name changed to: ",NAME
"RTN","PRCPUINV",88,0)
 ;
"RTN","PRCPUINV",89,0)
 W !?3,"Removing as a distribution point for the following inventory points:"
"RTN","PRCPUINV",90,0)
 S %=0 F  S %=$O(^PRCP(445,"AB",INVPT,%)) Q:'%  I $D(^PRCP(445,%,2,INVPT)) W !?5,$$INVNAME^PRCPUX1(%) K ^PRCP(445,%,2,INVPT) I $D(^PRCP(445,%,2,0)) S X=^(0) D
"RTN","PRCPUINV",91,0)
 .   S $P(X,"^",4)=$P(X,"^",4)-1 S:$P(X,"^",4)<0 $P(X,"^",4)=0 S:$P(X,"^",3)=INVPT $P(X,"^",3)="" S ^PRCP(445,%,2,0)=X
"RTN","PRCPUINV",92,0)
 K ^PRCP(445,"AB",INVPT)
"RTN","PRCPUINV",93,0)
 ;
"RTN","PRCPUINV",94,0)
 W !?3,"Removing link to the following fund control points:"
"RTN","PRCPUINV",95,0)
 S %=0 F  S %=$O(^PRC(420,"AE",%)) Q:'%  S PRC("SITE")=%,X=0 F  S X=$O(^PRC(420,"AE",%,INVPT,X)) Q:'X  W !?5,%,"-",X D DEL^PRCPUFCP(X,INVPT)
"RTN","PRCPUINV",96,0)
 I +$G(DQ) S DE(+$G(DQ))=NAME
"RTN","PRCPUINV",97,0)
 W !!
"RTN","PRCPUINV",98,0)
 Q
"RTN","PRCPUINV",99,0)
 ;
"RTN","PRCPUINV",100,0)
 ;PRCPUINV
"RTN","PRCPURS1")
0^41^B13383807^B11159948
"RTN","PRCPURS1",1,0)
PRCPURS1 ;WISC/RFJ/VAC-select group category list                       ; 11/2/06 11:32am
"RTN","PRCPURS1",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPURS1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPURS1",4,0)
 Q
"RTN","PRCPURS1",5,0)
 ;
"RTN","PRCPURS1",6,0)
 ;
"RTN","PRCPURS1",7,0)
GROUPSEL(V1) ;  select group categories
"RTN","PRCPURS1",8,0)
 ;  v1=inventory point da
"RTN","PRCPURS1",9,0)
 N %,G,GROUP,GROUPNM,PRCPEXIT,PRCPFLAG,PRCPLINE,PRCPINPT
"RTN","PRCPURS1",10,0)
 K ^TMP($J,"PRCPURS1"),GROUPALL
"RTN","PRCPURS1",11,0)
 S PRCPINPT=+V1,PRCPLINE="",$P(PRCPLINE,"-",78)=""
"RTN","PRCPURS1",12,0)
 S %=$$ALLGRP I %=0 Q
"RTN","PRCPURS1",13,0)
 I %=1 S GROUPALL=1
"RTN","PRCPURS1",14,0)
 F  D  I $G(PRCPFLAG) Q
"RTN","PRCPURS1",15,0)
 .   W !!
"RTN","PRCPURS1",16,0)
 .   I $O(^TMP($J,"PRCPURS1","YES",0))!($G(GROUPALL)) D
"RTN","PRCPURS1",17,0)
 .   .   W !?2,PRCPLINE,!?2,"| Currently selected group categories:",?78,"|"
"RTN","PRCPURS1",18,0)
 .   .   I $G(GROUPALL) W !?2,"| << ALL GROUP CATEGORIES >>",?78,"|"
"RTN","PRCPURS1",19,0)
 .   .   E  D
"RTN","PRCPURS1",20,0)
 .   .   .   W !?2,"| "
"RTN","PRCPURS1",21,0)
 .   .   .   S G=0 F  S G=$O(^TMP($J,"PRCPURS1","YES",G)) Q:'G  S %=$E(^(G),1,20),%=%_$E("                    ",$L(%),20) W:$X>70 ?78,"|",!?2,"| " W %,"  "
"RTN","PRCPURS1",22,0)
 .   .   .   W ?78,"|"
"RTN","PRCPURS1",23,0)
 .   .   W !?2,"| You can DE-select one of the above group categories by reselecting it.",?78,"|"
"RTN","PRCPURS1",24,0)
 .   I $O(^TMP($J,"PRCPURS1","NO",0))!('$G(GROUPALL)) D
"RTN","PRCPURS1",25,0)
 .   .   W !?2,PRCPLINE,!?2,"| Currently DE-selected group categories:",?78,"|"
"RTN","PRCPURS1",26,0)
 .   .   I '$G(GROUPALL) W !?2,"| << ALL GROUP CATEGORIES >>",?78,"|"
"RTN","PRCPURS1",27,0)
 .   .   E  D
"RTN","PRCPURS1",28,0)
 .   .   .   W !?2,"| "
"RTN","PRCPURS1",29,0)
 .   .   .   S G=0 F  S G=$O(^TMP($J,"PRCPURS1","NO",G)) Q:'G  S %=$E(^(G),1,20),%=%_$E("                    ",$L(%),20) W:$X>70 ?78,"|",!?2,"| " W %,"  "
"RTN","PRCPURS1",30,0)
 .   .   .   W ?78,"|"
"RTN","PRCPURS1",31,0)
 .   .   W !?2,"| You can RE-select one of the above group categories by reselecting it.",?78,"|"
"RTN","PRCPURS1",32,0)
 .   W !?2,PRCPLINE
"RTN","PRCPURS1",33,0)
 .   S GROUP=$$GROUP^PRCPEGRP(PRCPINPT,"") I GROUP<0 S (PRCPFLAG,PRCPEXIT)=1 Q
"RTN","PRCPURS1",34,0)
 .   S GROUPNM=$$GROUPNM^PRCPEGRP(GROUP)
"RTN","PRCPURS1",35,0)
 .   I GROUP=0,'$O(^TMP($J,"PRCPURS1","YES",0)),'$G(GROUPALL) D  Q
"RTN","PRCPURS1",36,0)
 .   .   S %=$$ALLGRP I %=0 S (PRCPFLAG,PRCPEXIT)=1 Q
"RTN","PRCPURS1",37,0)
 .   .   I %=1 S GROUPALL=1
"RTN","PRCPURS1",38,0)
 .   I GROUP=0 S PRCPFLAG=1 Q
"RTN","PRCPURS1",39,0)
 .   I $G(GROUPALL),'$D(^TMP($J,"PRCPURS1","NO",GROUP)) K ^TMP($J,"PRCPURS1","YES",GROUP) S ^TMP($J,"PRCPURS1","NO",GROUP)=GROUPNM W !?10,"*** DE-selected !" Q
"RTN","PRCPURS1",40,0)
 .   I $D(^TMP($J,"PRCPURS1","YES",GROUP)) K ^TMP($J,"PRCPURS1","YES",GROUP) S ^TMP($J,"PRCPURS1","NO",GROUP)=GROUPNM W !?10,"*** DE-selected !" Q
"RTN","PRCPURS1",41,0)
 .   I $D(^TMP($J,"PRCPURS1","NO",GROUP)) K ^(GROUP) S ^TMP($J,"PRCPURS1","YES",GROUP)=GROUPNM W !?10,"*** RE-selected !" Q
"RTN","PRCPURS1",42,0)
 .   S ^TMP($J,"PRCPURS1","YES",GROUP)=GROUPNM W !?10,"*** selected !"
"RTN","PRCPURS1",43,0)
 I $G(PRCPEXIT) K ^TMP($J,"PRCPURS1"),GROUPALL Q
"RTN","PRCPURS1",44,0)
 I $G(GROUPALL) K ^TMP($J,"PRCPURS1","YES")
"RTN","PRCPURS1",45,0)
 Q
"RTN","PRCPURS1",46,0)
 ;
"RTN","PRCPURS1",47,0)
 ;
"RTN","PRCPURS1",48,0)
ALLGRP() ;  select all group categories
"RTN","PRCPURS1",49,0)
 ;  returns 1 for yes, 2 for no, 0 for ^
"RTN","PRCPURS1",50,0)
 S XP="Do you want to select ALL group categories",XH="Enter 'YES' to select ALL groups, 'NO' to not select all groups."
"RTN","PRCPURS1",51,0)
 W !
"RTN","PRCPURS1",52,0)
 Q $$YN^PRCPUYN(1)
"RTN","PRCPURS1",53,0)
ZEROQTY(Y) ;**98** Select zero quantity items to print or not or only
"RTN","PRCPURS1",54,0)
 ;DIRUT - "^" entered, exit from this option and return to menu
"RTN","PRCPURS1",55,0)
 ;Y - User selection, passed to calling routine for further process:
"RTN","PRCPURS1",56,0)
 ; If Y=1, Include Zero Quantity Items
"RTN","PRCPURS1",57,0)
 ; If Y=2, Do not include Zero Quantity Items
"RTN","PRCPURS1",58,0)
 ; If Y=3, Include ONLY Zero Quantity Items
"RTN","PRCPURS1",59,0)
 N X
"RTN","PRCPURS1",60,0)
 W !
"RTN","PRCPURS1",61,0)
 S X(1)="Select a number to display zero quantities or not "
"RTN","PRCPURS1",62,0)
 D DISPLAY^PRCPUX2(3,42,.X)
"RTN","PRCPURS1",63,0)
 K DIR
"RTN","PRCPURS1",64,0)
 S DIR(0)="S^1: Include Zero Quantity items;2: Do not include Zero Quantity items;3: Print  Only Zero Quantity items"
"RTN","PRCPURS1",65,0)
 S DIR("A")="Select"
"RTN","PRCPURS1",66,0)
 D ^DIR
"RTN","PRCPURS1",67,0)
 K DIR
"RTN","PRCPURS1",68,0)
 Q:$D(DIRUT) 0
"RTN","PRCPURS1",69,0)
 Q Y
"RTN","PRCPURS1",70,0)
 ;
"RTN","PRCPUX2")
0^35^B14304958^B5343186
"RTN","PRCPUX2",1,0)
PRCPUX2 ;WISC/RFJ/VAC/DST-extrinsic functions                              ; 2/21/07 10:52am
"RTN","PRCPUX2",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPUX2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPUX2",4,0)
 ;*98 Added three new calls to support On-Demand Items
"RTN","PRCPUX2",5,0)
 ;*98 Added fourth call to support ODI All items or single item
"RTN","PRCPUX2",6,0)
 Q
"RTN","PRCPUX2",7,0)
 ;
"RTN","PRCPUX2",8,0)
 ;
"RTN","PRCPUX2",9,0)
ISMSFLAG(SITE) ;  isms switch on|off for site
"RTN","PRCPUX2",10,0)
 ;  switch=0 or 1 for log code sheet format
"RTN","PRCPUX2",11,0)
 ;  switch=2 for isms code sheet formats
"RTN","PRCPUX2",12,0)
 N % S %=+$P($G(^PRC(411,+SITE,0)),"^",23)
"RTN","PRCPUX2",13,0)
 Q $S(1:1,%=0:1,1:%)
"RTN","PRCPUX2",14,0)
 ;
"RTN","PRCPUX2",15,0)
 ;
"RTN","PRCPUX2",16,0)
INPERCNT(V1,V2,V3,V4) ;  initialize percent graph
"RTN","PRCPUX2",17,0)
 ;  v1=total number of entries
"RTN","PRCPUX2",18,0)
 ;  v2=display character
"RTN","PRCPUX2",19,0)
 ;  v3=reverse video on (optional)
"RTN","PRCPUX2",20,0)
 ;  v4=reverse video off (optional)
"RTN","PRCPUX2",21,0)
 ;  returns number v2 to display per entry
"RTN","PRCPUX2",22,0)
 W !!?30,"% COMPLETE",!?10,"0   10   20   30   40   50   60   70   80   90   100"
"RTN","PRCPUX2",23,0)
 W !?10,"|----+----+----+----+----+----+----+----+----+----|"
"RTN","PRCPUX2",24,0)
 W !?10,V3,V2,V4
"RTN","PRCPUX2",25,0)
 S %=.02*V1,%=$S(%=0:50,1:1/%)
"RTN","PRCPUX2",26,0)
 Q %
"RTN","PRCPUX2",27,0)
 ;
"RTN","PRCPUX2",28,0)
 ;
"RTN","PRCPUX2",29,0)
SHPERCNT(V1,V2,V3,V4,V5,V6) ; display percent complete
"RTN","PRCPUX2",30,0)
 ;  v1=current entry number executed
"RTN","PRCPUX2",31,0)
 ;  v2=display this many v3 for each entry
"RTN","PRCPUX2",32,0)
 ;  v3=character to display
"RTN","PRCPUX2",33,0)
 ;  v4=reverse video on (optional)
"RTN","PRCPUX2",34,0)
 ;  v5=reverse video off (optional)
"RTN","PRCPUX2",35,0)
 ;  return last one displayed
"RTN","PRCPUX2",36,0)
 N %
"RTN","PRCPUX2",37,0)
 S X=V1*V2\1 S:X>50 X=50 F %=((V1-1*V2\1)+1):1:X W V4,V3,V5 I $X>50,$D(PRCP("XY")) X PRCP("XY")
"RTN","PRCPUX2",38,0)
 Q X
"RTN","PRCPUX2",39,0)
 ;
"RTN","PRCPUX2",40,0)
 ;
"RTN","PRCPUX2",41,0)
QPERCNT(V1,V2,V3,V4) ;  finish percent display
"RTN","PRCPUX2",42,0)
 ;  v1=last v2 displayed
"RTN","PRCPUX2",43,0)
 ;  v2=character to display
"RTN","PRCPUX2",44,0)
 ;  v3=reverse video on (optional)
"RTN","PRCPUX2",45,0)
 ;  v4=reverse video off (optional)
"RTN","PRCPUX2",46,0)
 N %
"RTN","PRCPUX2",47,0)
 F %=V1+1:1:50 W V3,V2,V4 I $X>50,$D(PRCP("XY")) X PRCP("XY")
"RTN","PRCPUX2",48,0)
 Q
"RTN","PRCPUX2",49,0)
 ;
"RTN","PRCPUX2",50,0)
 ;
"RTN","PRCPUX2",51,0)
DISPLAY(DX1,DX2,X) ;  display message
"RTN","PRCPUX2",52,0)
 ;  dx1 = begin column
"RTN","PRCPUX2",53,0)
 ;  dx2 = end column
"RTN","PRCPUX2",54,0)
 ;  x = message
"RTN","PRCPUX2",55,0)
 N %,END,LENGTH,LINE,NEXT,PRCPFLAG,PRCPLINE,TEXT
"RTN","PRCPUX2",56,0)
 S LENGTH=DX2-DX1 I LENGTH<10 S (DX1,DX2)=1,LENGTH=79
"RTN","PRCPUX2",57,0)
 S DX1=DX1-1,DX2=DX2-1,PRCPLINE="",$P(PRCPLINE,"-",LENGTH)="",PRCPLINE="+"_PRCPLINE_"+"
"RTN","PRCPUX2",58,0)
 W !?DX1,PRCPLINE
"RTN","PRCPUX2",59,0)
 S LINE=0,TEXT=""
"RTN","PRCPUX2",60,0)
 F  D  I TEXT="",'$O(X(LINE)) Q
"RTN","PRCPUX2",61,0)
 .   ;
"RTN","PRCPUX2",62,0)
 .   ;  get more text if less than 240 characters
"RTN","PRCPUX2",63,0)
 .   F  D  Q:$G(PRCPFLAG)
"RTN","PRCPUX2",64,0)
 .   .   S NEXT=+$O(X(LINE))
"RTN","PRCPUX2",65,0)
 .   .   I NEXT,$L(TEXT)+$L($G(X(NEXT)))<240 S TEXT=TEXT_$S(TEXT'="":" ",1:"")_$G(X(NEXT)) K X(NEXT) Q
"RTN","PRCPUX2",66,0)
 .   .   S PRCPFLAG=1
"RTN","PRCPUX2",67,0)
 .   ;
"RTN","PRCPUX2",68,0)
 .   ;  fit text in window
"RTN","PRCPUX2",69,0)
 .   F END=LENGTH:-1:0 S %=$E(TEXT,END) I %=""!(%=" ") Q
"RTN","PRCPUX2",70,0)
 .   I END=0 S END=LENGTH
"RTN","PRCPUX2",71,0)
 .   W !?DX1,"|",$E(TEXT,1,END-1),?DX2,"|" S TEXT=$E(TEXT,END+1,255)
"RTN","PRCPUX2",72,0)
 W !?DX1,PRCPLINE
"RTN","PRCPUX2",73,0)
 Q
"RTN","PRCPUX2",74,0)
 ;
"RTN","PRCPUX2",75,0)
ODITEM(INVPT,ITEMDA) ;Return a flag for On-Demand Item
"RTN","PRCPUX2",76,0)
 ; If an item is in the warehouse, return a "W", if the item is an 
"RTN","PRCPUX2",77,0)
 ;   on-demand item, return a "Y", otherwise return a null.
"RTN","PRCPUX2",78,0)
 Q:$P($G(^PRCP(445,INVPT,0)),"^",3)="W" "W"
"RTN","PRCPUX2",79,0)
 Q:$P($G(^PRCP(445,INVPT,1,ITEMDA,0)),"^",30)="N" ""
"RTN","PRCPUX2",80,0)
 Q $P($G(^PRCP(445,INVPT,1,ITEMDA,0)),"^",30)
"RTN","PRCPUX2",81,0)
 ;
"RTN","PRCPUX2",82,0)
ODIPROM(Y) ; Display prompt to user for On-Demand Items selection
"RTN","PRCPUX2",83,0)
 ;
"RTN","PRCPUX2",84,0)
 ; DIRUT - "^" entered, exit from this option and return to menu.
"RTN","PRCPUX2",85,0)
 ; Y - user selection, passed to calling routine for further process:
"RTN","PRCPUX2",86,0)
 ;        if Y = 1 - display Standard Items on the report only.
"RTN","PRCPUX2",87,0)
 ;        if Y = 2 - display On-Demand Items on the report only.
"RTN","PRCPUX2",88,0)
 ;        if Y = 3 - display All Items on the report.
"RTN","PRCPUX2",89,0)
 ;
"RTN","PRCPUX2",90,0)
 N X
"RTN","PRCPUX2",91,0)
 W !
"RTN","PRCPUX2",92,0)
 S X(1)=" Select On-Demand/Standard items to include on this report:             "
"RTN","PRCPUX2",93,0)
 D DISPLAY^PRCPUX2(3,75,.X)
"RTN","PRCPUX2",94,0)
 ; Choose one
"RTN","PRCPUX2",95,0)
 K DIR
"RTN","PRCPUX2",96,0)
 S DIR(0)="S^1:Standard Items Only;2:On-Demand Items Only;3:All Items (Both Standard and On-Demand)"
"RTN","PRCPUX2",97,0)
 S DIR("A")="Display information for"
"RTN","PRCPUX2",98,0)
 D ^DIR
"RTN","PRCPUX2",99,0)
 K DIR
"RTN","PRCPUX2",100,0)
 Q:$D(DIRUT) 0
"RTN","PRCPUX2",101,0)
 Q Y
"RTN","PRCPUX2",102,0)
 ;
"RTN","PRCPUX2",103,0)
SRTPRMP(Y) ; Display prompt for On-Demand Items SORT selection
"RTN","PRCPUX2",104,0)
 ;
"RTN","PRCPUX2",105,0)
 ; DIRUT - "^" entered, exit from this option and return to menu.
"RTN","PRCPUX2",106,0)
 ; Y - user selection, passed to calling routine for further process:
"RTN","PRCPUX2",107,0)
 ;     If Y = 1, report sorted by Item Description 
"RTN","PRCPUX2",108,0)
 ;        Y = 2, report sorted by Item Number
"RTN","PRCPUX2",109,0)
 N X
"RTN","PRCPUX2",110,0)
 W !
"RTN","PRCPUX2",111,0)
 S X(1)=" Select the order in which you want the item information to appear.      "
"RTN","PRCPUX2",112,0)
 D DISPLAY^PRCPUX2(3,42,.X)
"RTN","PRCPUX2",113,0)
 K DIR
"RTN","PRCPUX2",114,0)
 S DIR(0)="S^1:ITEM DESCRIPTION;2:ITEM NUMBER"
"RTN","PRCPUX2",115,0)
 S DIR("A")="Sort By"
"RTN","PRCPUX2",116,0)
 D ^DIR
"RTN","PRCPUX2",117,0)
 K DIR
"RTN","PRCPUX2",118,0)
 Q:$D(DIRUT) 0
"RTN","PRCPUX2",119,0)
 Q Y
"RTN","PRCPUX2",120,0)
 ;
"RTN","PRCPUX2",121,0)
SINGIT(PRCPIP) ; Prompt for selecting a single item or all items
"RTN","PRCPUX2",122,0)
 ; *98 Used by PRCPRODA
"RTN","PRCPUX2",123,0)
 ; ITEMSEL=NULL for all items selected or non-NULL for a single item
"RTN","PRCPUX2",124,0)
 N XP,ITEMSEL
"RTN","PRCPUX2",125,0)
SING1 S %=0,ITEMSEL=""
"RTN","PRCPUX2",126,0)
 W !
"RTN","PRCPUX2",127,0)
 W "To select All items, press RETURN."
"RTN","PRCPUX2",128,0)
 S ITEMSEL=$$ITEM^PRCPUITM(PRCPIP,0,"","")
"RTN","PRCPUX2",129,0)
 I ITEMSEL=0 D  G SING1:%=2
"RTN","PRCPUX2",130,0)
 .S XP="Do you want to select ALL items"
"RTN","PRCPUX2",131,0)
 .W !
"RTN","PRCPUX2",132,0)
 .S %=$$YN^PRCPUYN(1)
"RTN","PRCPUX2",133,0)
 .I %=1 S ITEMSEL="" Q
"RTN","PRCPUX2",134,0)
 .S ITEMSEL="^"
"RTN","PRCPUX2",135,0)
 Q ITEMSEL
"RTN","PRCPXALL")
0^36^B1737679^B1532150
"RTN","PRCPXALL",1,0)
PRCPXALL ;WISC/RFJ-purge all automatically by TaskManager           ; 2/19/07 1:19pm
"RTN","PRCPXALL",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPXALL",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPXALL",4,0)
 Q
"RTN","PRCPXALL",5,0)
 ;
"RTN","PRCPXALL",6,0)
 ;
"RTN","PRCPXALL",7,0)
DQ ;  TaskManager comes here to start the automatic purge of
"RTN","PRCPXALL",8,0)
 ;  inventory points.
"RTN","PRCPXALL",9,0)
 N %,%H,%I,INVPT,NOWDT,PRCP,PRCPZTSK,STOPDATE,TYPE,X,Y
"RTN","PRCPXALL",10,0)
 D NOW^%DTC S NOWDT=$E(X,1,5)_"01",X1=$E(X,1,5)_"15",X2=-395 D C^%DTC S (Y,STOPDATE)=$E(X,1,5)_"01"
"RTN","PRCPXALL",11,0)
 S PRCPZTSK=1
"RTN","PRCPXALL",12,0)
 S INVPT=0 F  S INVPT=$O(^PRCP(445,INVPT)) Q:'INVPT  I $P($G(^(INVPT,0)),"^",21)="Y" S TYPE=$P(^(0),"^",3) I TYPE'="" D
"RTN","PRCPXALL",13,0)
 .   S PRCP("I")=INVPT
"RTN","PRCPXALL",14,0)
 .   ;  distribution history (file 446)
"RTN","PRCPXALL",15,0)
 .   I TYPE'="S" D DQ^PRCPXDIS
"RTN","PRCPXALL",16,0)
 .   ;  receipts
"RTN","PRCPXALL",17,0)
 .   D DQ^PRCPXREC
"RTN","PRCPXALL",18,0)
 .   ;  transaction register
"RTN","PRCPXALL",19,0)
 .   D DQ^PRCPXTRA
"RTN","PRCPXALL",20,0)
 .   ;  usage/distribution totals
"RTN","PRCPXALL",21,0)
 .   D DQ^PRCPXUSE
"RTN","PRCPXALL",22,0)
 .   ;  on-demand item audits (PRC*5.1*98)
"RTN","PRCPXALL",23,0)
 .   I TYPE'="W" D DQ^PRCPXODI
"RTN","PRCPXALL",24,0)
 Q
"RTN","PRCPXODI")
0^37^B8307389^n/a
"RTN","PRCPXODI",1,0)
PRCPXODI ;WOIFO/CC-purge On-Demand Audit Activity ; 11/30/06 4:04pm
"RTN","PRCPXODI",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPXODI",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPXODI",4,0)
 Q
"RTN","PRCPXODI",5,0)
 ; Called from PRCPXALL where STOPDATE and PRCP("I") are set up
"RTN","PRCPXODI",6,0)
 ; PRCP("I") is the ien of the inventory point being cleaned
"RTN","PRCPXODI",7,0)
 ; STOPDATE is the oldest date for which activity is to be kept
"RTN","PRCPXODI",8,0)
 ;
"RTN","PRCPXODI",9,0)
 ; NOTE:  This program purges the On-Demand Audit records from each
"RTN","PRCPXODI",10,0)
 ;        item in the inventory point.  Although the program is
"RTN","PRCPXODI",11,0)
 ;        designed to purge any record older than the date indicated
"RTN","PRCPXODI",12,0)
 ;        in STOPDATE, it is also designed to retain the three most
"RTN","PRCPXODI",13,0)
 ;        recent audit records, regardless of how old they are.
"RTN","PRCPXODI",14,0)
 ;
"RTN","PRCPXODI",15,0)
DQ N D,DA,DIC,DIK,ITEMDA,PRCPAUDT,PRCPCNT,PRCPSTOP,X
"RTN","PRCPXODI",16,0)
 ; loop through for each item
"RTN","PRCPXODI",17,0)
 S ITEMDA=0
"RTN","PRCPXODI",18,0)
 F  S ITEMDA=$O(^PRCP(445,PRCP("I"),1,ITEMDA)) Q:+ITEMDA'>0  D
"RTN","PRCPXODI",19,0)
 . N X,PRCPKEEP
"RTN","PRCPXODI",20,0)
 . I $D(SCAN) W !,"ITEM # ",ITEMDA
"RTN","PRCPXODI",21,0)
 . S X=$O(^PRCP(445,PRCP("I"),1,ITEMDA,10,0)) Q:X=""  ; no audits on file
"RTN","PRCPXODI",22,0)
 . S X=$P($G(^PRCP(445,PRCP("I"),1,ITEMDA,10,X,0)),"^",1) ; date of audit
"RTN","PRCPXODI",23,0)
 . I $D(SCAN) W !,"OLDEST AUDIT DATE: ",X
"RTN","PRCPXODI",24,0)
 . I X'<STOPDATE Q  ; earliest audit is within retention period
"RTN","PRCPXODI",25,0)
 . ;
"RTN","PRCPXODI",26,0)
 . ; Item has entries that could be purged, save 3 most recent entries
"RTN","PRCPXODI",27,0)
 . S PRCPAUDT="A",PRCPCNT=0,PRCPSTOP=0
"RTN","PRCPXODI",28,0)
 . ; Find 3 oldest entries then proceed to next section
"RTN","PRCPXODI",29,0)
 . F  S PRCPAUDT=$O(^PRCP(445,PRCP("I"),1,ITEMDA,10,PRCPAUDT),-1) Q:'+PRCPAUDT  D  Q:PRCPCNT=3
"RTN","PRCPXODI",30,0)
 . . S PRCPCNT=PRCPCNT+1 I $D(SCAN) W !,"FOUND:",PRCPCNT
"RTN","PRCPXODI",31,0)
 . . I PRCPCNT<4 S PRCPKEEP(PRCPAUDT)=PRCPCNT Q  ; keep three most recent audit records
"RTN","PRCPXODI",32,0)
 . . Q
"RTN","PRCPXODI",33,0)
 . ;
"RTN","PRCPXODI",34,0)
 . I PRCPCNT<3 Q  ; only 2 records exists and all must be kept
"RTN","PRCPXODI",35,0)
 . ; Loop through all audit records on file, starting with the oldest
"RTN","PRCPXODI",36,0)
 . ; Continue processing until the audit date of a record follows the stop date or processing hits one of the 3 most recent records.
"RTN","PRCPXODI",37,0)
 . S PRCPAUDT=0
"RTN","PRCPXODI",38,0)
 . F  S PRCPAUDT=$O(^PRCP(445,PRCP("I"),1,ITEMDA,10,PRCPAUDT)) Q:'+PRCPAUDT  D  I PRCPSTOP Q
"RTN","PRCPXODI",39,0)
 . . S X=$P($G(^PRCP(445,PRCP("I"),1,ITEMDA,10,PRCPAUDT,0)),"^",1) ; get date of audit record
"RTN","PRCPXODI",40,0)
 . . I $D(SCAN) W !,"AUDIT DATE: ",X,"   STOPDATE:",STOPDATE
"RTN","PRCPXODI",41,0)
 . . I X'<STOPDATE!$D(PRCPKEEP(PRCPAUDT)) S PRCPSTOP=1 Q  ; no more to purge
"RTN","PRCPXODI",42,0)
 . . I $D(SCAN) W !,X," WILL BE PURGED" Q
"RTN","PRCPXODI",43,0)
 . . S DIK="^PRCP(445,"_PRCP("I")_",1,"_ITEMDA_",10,",DA(1)=ITEMDA,DA(2)=PRCP("I"),DA=PRCPAUDT D ^DIK K DIK,DA
"RTN","PRCPXODI",44,0)
 ;
"RTN","PRCPXODI",45,0)
 Q
"RTN","PRCPXODI",46,0)
 ;
"RTN","PRCPXODI",47,0)
TEST ; RUN WITHOUT DELETING AND WITH SCAN ON
"RTN","PRCPXODI",48,0)
 N SCAN
"RTN","PRCPXODI",49,0)
 S SCAN=1
"RTN","PRCPXODI",50,0)
 S STOPDATE=3060625
"RTN","PRCPXODI",51,0)
 ;S STOPDATE=3061125
"RTN","PRCPXODI",52,0)
 S PRCP("I")=9
"RTN","PRCPXODI",53,0)
 D DQ
"RTN","PRCPXODI",54,0)
 Q
"RTN","PRCPXTRM")
0^38^B15984033^B14673562
"RTN","PRCPXTRM",1,0)
PRCPXTRM ;WISC/RFJ-user termination, add, build array, utilities    ; 11/6/06 8:46am
"RTN","PRCPXTRM",2,0)
 ;;5.1;IFCAP;**98**;Oct 20, 2000;Build 37
"RTN","PRCPXTRM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCPXTRM",4,0)
 Q
"RTN","PRCPXTRM",5,0)
 ;
"RTN","PRCPXTRM",6,0)
 ;
"RTN","PRCPXTRM",7,0)
TERMUSER(USERDUZ)  ;  remove user as inventory user from all inventory pts
"RTN","PRCPXTRM",8,0)
 ;  called internally (not by prcp options)
"RTN","PRCPXTRM",9,0)
 ; 'Do' block modified by PRC*5.1*98 to add ODI cleanup
"RTN","PRCPXTRM",10,0)
 I '$D(^VA(200,+USERDUZ,0)) Q
"RTN","PRCPXTRM",11,0)
 N INVPT
"RTN","PRCPXTRM",12,0)
 S INVPT=0 F  S INVPT=$O(^PRCP(445,INVPT)) Q:'INVPT  D
"RTN","PRCPXTRM",13,0)
 . I $D(^PRCP(445,INVPT,4,USERDUZ)) D KILLUSER(INVPT,USERDUZ)
"RTN","PRCPXTRM",14,0)
 . I $D(^PRCP(445,INVPT,9,USERDUZ)) D DEL^PRCPAODI(INVPT,USERDUZ)
"RTN","PRCPXTRM",15,0)
 Q
"RTN","PRCPXTRM",16,0)
 ;
"RTN","PRCPXTRM",17,0)
 ;
"RTN","PRCPXTRM",18,0)
KILLUSER(INVPT,USERDUZ)      ;  remove user (userduz) from invpt
"RTN","PRCPXTRM",19,0)
 I '$D(^PRCP(445,+INVPT,4,+USERDUZ)) Q
"RTN","PRCPXTRM",20,0)
 N %,DA,DIC,DIK,X,Y
"RTN","PRCPXTRM",21,0)
 S DIK="^PRCP(445,"_+INVPT_",4,",DA(1)=+INVPT,DA=+USERDUZ D ^DIK
"RTN","PRCPXTRM",22,0)
 I '$O(^PRCP(445,INVPT,4,0)) D NOUSER(INVPT)
"RTN","PRCPXTRM",23,0)
 Q
"RTN","PRCPXTRM",24,0)
 ;
"RTN","PRCPXTRM",25,0)
 ;
"RTN","PRCPXTRM",26,0)
NOUSER(INVPT)        ;  send mailmsg to g.irm if invpt has no users
"RTN","PRCPXTRM",27,0)
 N INVNAME,PRCPTEXT,XCNP,XMDUZ,XMSUB,XMTEXT,XMY,XMZ ; XMSUB,XMTEXT added with PRC*5.1*98
"RTN","PRCPXTRM",28,0)
 S XMDUZ=.5,XMY("G.IRM")=""
"RTN","PRCPXTRM",29,0)
 S INVNAME=$$INVNAME^PRCPUX1(INVPT)
"RTN","PRCPXTRM",30,0)
 K PRCPTEXT
"RTN","PRCPXTRM",31,0)
 S PRCPTEXT(1,0)="TO: G.IRM"
"RTN","PRCPXTRM",32,0)
 S PRCPTEXT(2,0)="The inventory point "_INVNAME_" (#"_INVPT_") has NO authorized users"
"RTN","PRCPXTRM",33,0)
 S PRCPTEXT(3,0)="(field #6 in file #445)."
"RTN","PRCPXTRM",34,0)
 S PRCPTEXT(4,0)=" "
"RTN","PRCPXTRM",35,0)
 S PRCPTEXT(5,0)="You can use the following mumps call to add users:"
"RTN","PRCPXTRM",36,0)
 S PRCPTEXT(6,0)="  D ADDUSER^PRCPXTRM(INVPT,USERDUZ)"
"RTN","PRCPXTRM",37,0)
 S PRCPTEXT(7,0)="        where INVPT is the internal inventory point number;"
"RTN","PRCPXTRM",38,0)
 S PRCPTEXT(8,0)="              USERDUZ is the users DUZ."
"RTN","PRCPXTRM",39,0)
 S PRCPTEXT(9,0)=" "
"RTN","PRCPXTRM",40,0)
 S PRCPTEXT(10,0)="For example: D ADDUSER^PRCPXTRM("_INVPT_",100) would add user 100 to the"
"RTN","PRCPXTRM",41,0)
 S PRCPTEXT(11,0)=INVNAME_" (#"_INVPT_") inventory point listed above."
"RTN","PRCPXTRM",42,0)
 S PRCPTEXT(12,0)=" "
"RTN","PRCPXTRM",43,0)
 S PRCPTEXT(13,0)="Once an inventory user is added, the inventory point may be inactivated"
"RTN","PRCPXTRM",44,0)
 S PRCPTEXT(14,0)="if no longer used."
"RTN","PRCPXTRM",45,0)
 S XMSUB="INVENTORY POINT HAS NO AUTHORIZED USERS",XMTEXT="PRCPTEXT(" D ^XMD
"RTN","PRCPXTRM",46,0)
 Q
"RTN","PRCPXTRM",47,0)
 ;
"RTN","PRCPXTRM",48,0)
 ;
"RTN","PRCPXTRM",49,0)
ADDUSER(INVPT,USERDUZ)   ;  add authorized users to invpt
"RTN","PRCPXTRM",50,0)
 I '$D(^VA(200,+USERDUZ,0)) Q
"RTN","PRCPXTRM",51,0)
 I '$D(^PRCP(445,+INVPT,0)) Q
"RTN","PRCPXTRM",52,0)
 I $D(^PRCP(445,+INVPT,4,+USERDUZ,0)) Q
"RTN","PRCPXTRM",53,0)
 N %,D0,DA,DD,DIC,DINUM,DLAYGO,PRCPPRIV,X,Y ; DINUM added PRC*5.1*98
"RTN","PRCPXTRM",54,0)
 I '$D(^PRCP(445,+INVPT,4,0)) S ^PRCP(445,+INVPT,4,0)="^445.04P^^"
"RTN","PRCPXTRM",55,0)
 S DIC="^PRCP(445,"_+INVPT_",4,",DIC(0)="L",DLAYGO=445,DA(1)=+INVPT,(X,DINUM)=+USERDUZ,PRCPPRIV=1
"RTN","PRCPXTRM",56,0)
 D FILE^DICN
"RTN","PRCPXTRM",57,0)
 Q
"RTN","PRCPXTRM",58,0)
 ;
"RTN","PRCPXTRM",59,0)
 ;
"RTN","PRCPXTRM",60,0)
GETUSER(INVPT)     ;  build prcpxmy array of users
"RTN","PRCPXTRM",61,0)
 ;  if user is manager, set prcpxmy(duz)=1 otherwise 0
"RTN","PRCPXTRM",62,0)
 N %,X
"RTN","PRCPXTRM",63,0)
 K PRCPXMY
"RTN","PRCPXTRM",64,0)
 I '$D(^PRCP(445,+INVPT,4)) Q
"RTN","PRCPXTRM",65,0)
 S %=$P(^PRCP(445,INVPT,0),"^",3),%="PRCP"_$TR(%,"WSP","W2")_" MGRKEY"
"RTN","PRCPXTRM",66,0)
 S X=0 F  S X=$O(^PRCP(445,INVPT,4,X)) Q:'X  S PRCPXMY(X)=$S($$KEY^PRCPUREP(%,X):1,1:0)
"RTN","PRCPXTRM",67,0)
 Q
"RTN","PRCPXTRM",68,0)
 ;
"RTN","PRCPXTRM",69,0)
 ;
"RTN","PRCPXTRM",70,0)
INSTALL(SUBJECT,LINE2,TEXT)  ;  send install message to forum
"RTN","PRCPXTRM",71,0)
 ; text = text to be included from line 10 and up
"RTN","PRCPXTRM",72,0)
 N DIC,XCNP,XMDUZ,XMSUB,XMTEXT,XMZ
"RTN","PRCPXTRM",73,0)
 S TEXT(1,0)=" ",TEXT(2,0)="Installation of IFCAP "_LINE2_" information message:",TEXT(3,0)="",TEXT(4,0)="              site: "_$G(^DD("SITE"))
"RTN","PRCPXTRM",74,0)
 X ^%ZOSF("UCI") S TEXT(5,0)="            op sys: "_$P($G(^%ZOSF("OS")),"^"),TEXT(6,0)="               uci: "_Y,TEXT(7,0)="              user: "_$P($G(^VA(200,+DUZ,0)),"^")
"RTN","PRCPXTRM",75,0)
 D NOW^%DTC S Y=% D DD^%DT S TEXT(8,0)="         date@time: "_Y,TEXT(9,0)=" "
"RTN","PRCPXTRM",76,0)
 S XMDUZ=.5,XMY("G.IFCAP INSTALL@FORUM.VA.GOV")="",XMTEXT="TEXT(",XMSUB=SUBJECT
"RTN","PRCPXTRM",77,0)
 D ^XMD
"RTN","PRCPXTRM",78,0)
 Q
"UP",445,445.01,-1)
445^1
"UP",445,445.01,0)
445.01
"UP",445,445.027,-1)
445^9
"UP",445,445.027,0)
445.027
"UP",445,445.13,-2)
445^1
"UP",445,445.13,-1)
445.01^10
"UP",445,445.13,0)
445.13
"VER")
8.0^22.0
"^DD",445,445,27,0)
ON-DEMAND USERS^445.027P^^9;0
"^DD",445,445,27,21,0)
^.001^5^5^3060714^^^
"^DD",445,445,27,21,1,0)
This file will store the users designated by the application coordinator
"^DD",445,445,27,21,2,0)
with the ability to modify an On-Demand Setting for any item in this
"^DD",445,445,27,21,3,0)
inventory point.  Because the On-Demand Setting applies only to items in 
"^DD",445,445,27,21,4,0)
the Primary and Secondary Inventory Points, this multiple will never be 
"^DD",445,445,27,21,5,0)
populated in the Warehouse.
"^DD",445,445.01,.8,0)
ON-DEMAND^S^Y:YES;N:NO;^0;30^Q
"^DD",445,445.01,.8,3)
Enter 'YES' if the inventory item is On-Demand
"^DD",445,445.01,.8,21,0)
^^6^6^3060501^
"^DD",445,445.01,.8,21,1,0)
This setting is applicable to items in the Primary and Secondary 
"^DD",445,445.01,.8,21,2,0)
Inventory Points.  Items in the Warehouse can never be considered to be 
"^DD",445,445.01,.8,21,3,0)
On-Demand.  An item is flagged as On-Demand if it must be stocked but is
"^DD",445,445.01,.8,21,4,0)
rarely used.  These items must be tracked differently by GIP in order to
"^DD",445,445.01,.8,21,5,0)
accurately reflect the turnover of the standard items, i.e. those that are
"^DD",445,445.01,.8,21,6,0)
not On-Demand.
"^DD",445,445.01,.8,"DT")
3060428
"^DD",445,445.01,.81,0)
ON-DEMAND AUDIT^445.13DA^^10;0
"^DD",445,445.01,.81,21,0)
^.001^2^2^3060501^^^^
"^DD",445,445.01,.81,21,1,0)
This file will store information each time the ON-DEMAND Setting for 
"^DD",445,445.01,.81,21,2,0)
the inventory item is changed.
"^DD",445,445.027,0)
ON-DEMAND USERS SUB-FIELD^^.01^1
"^DD",445,445.027,0,"DT")
3060501
"^DD",445,445.027,0,"IX","B",445.027,.01)

"^DD",445,445.027,0,"NM","ON-DEMAND USERS")

"^DD",445,445.027,0,"UP")
445
"^DD",445,445.027,.01,0)
ON-DEMAND USER^P200'X^VA(200,^0;1^S DINUM=X
"^DD",445,445.027,.01,1,0)
^.1
"^DD",445,445.027,.01,1,1,0)
445.027^B
"^DD",445,445.027,.01,1,1,1)
S ^PRCP(445,DA(1),9,"B",$E(X,1,30),DA)=""
"^DD",445,445.027,.01,1,1,2)
K ^PRCP(445,DA(1),9,"B",$E(X,1,30),DA)
"^DD",445,445.027,.01,3)
Enter the user who will be allowed to change the ON-DEMAND setting of inventory items.
"^DD",445,445.027,.01,21,0)
^.001^2^2^3060714^^^^
"^DD",445,445.027,.01,21,1,0)
This field will store the users who are able to change the On-Demand
"^DD",445,445.027,.01,21,2,0)
Setting for items in this inventory point.
"^DD",445,445.027,.01,"DT")
3060714
"^DD",445,445.13,0)
ON-DEMAND AUDIT SUB-FIELD^^3^4
"^DD",445,445.13,0,"DT")
3060501
"^DD",445,445.13,0,"IX","B",445.13,.01)

"^DD",445,445.13,0,"NM","ON-DEMAND AUDIT")

"^DD",445,445.13,0,"UP")
445.01
"^DD",445,445.13,.01,0)
DATE/TIME OF CHANGE^D^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",445,445.13,.01,1,0)
^.1
"^DD",445,445.13,.01,1,1,0)
445.13^B
"^DD",445,445.13,.01,1,1,1)
S ^PRCP(445,DA(2),1,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",445,445.13,.01,1,1,2)
K ^PRCP(445,DA(2),1,DA(1),10,"B",$E(X,1,30),DA)
"^DD",445,445.13,.01,3)
(No range limit on date)
"^DD",445,445.13,.01,21,0)
^^4^4^3060501^
"^DD",445,445.13,.01,21,1,0)
This field stores the date/time that a user changed the On-Demand Setting 
"^DD",445,445.13,.01,21,2,0)
of an item in the inventory.  Only settings from or to 'Yes' will be
"^DD",445,445.13,.01,21,3,0)
captured as changes from null to NO or No to null do not move an item into
"^DD",445,445.13,.01,21,4,0)
or out of an On-Demand status.
"^DD",445,445.13,.01,"DT")
3060501
"^DD",445,445.13,1,0)
ON-DEMAND CHANGED BY^P200'^VA(200,^0;2^Q
"^DD",445,445.13,1,3)
This field stores the user who changed the On-Demand Setting for the item.
"^DD",445,445.13,1,21,0)
^^2^2^3060501^
"^DD",445,445.13,1,21,1,0)
This field stores the user who changed the On-Demand Setting for this 
"^DD",445,445.13,1,21,2,0)
item at the date/time specified.
"^DD",445,445.13,1,"DT")
3060428
"^DD",445,445.13,2,0)
REASON FOR CHANGE^F^^0;3^K:$L(X)>30!($L(X)<3) X
"^DD",445,445.13,2,3)
Answer must be 3-30 characters in length
"^DD",445,445.13,2,21,0)
^^2^2^3060501^
"^DD",445,445.13,2,21,1,0)
Anytime the On-Demand status of an item is changed, the user must specify 
"^DD",445,445.13,2,21,2,0)
why the change was made.  This field will store that reason.
"^DD",445,445.13,2,"DT")
3060428
"^DD",445,445.13,3,0)
NEW ON-DEMAND SETTING^S^Y:YES;N:NO;^0;4^Q
"^DD",445,445.13,3,3)
Enter 'YES' if the item was set to be On-Demand
"^DD",445,445.13,3,21,0)
^^2^2^3060501^
"^DD",445,445.13,3,21,1,0)
This field will show what the user changed the On-Demand Setting for that 
"^DD",445,445.13,3,21,2,0)
item to be.
"^DD",445,445.13,3,"DT")
3060428
"^DD",446.5,446.5,0)
FIELD^^4^8
"^DD",446.5,446.5,0,"DDA")
N
"^DD",446.5,446.5,0,"DT")
3060705
"^DD",446.5,446.5,0,"IX","B",446.5,.01)

"^DD",446.5,446.5,0,"NM","CUSTOM LABEL")

"^DD",446.5,446.5,0,"VRPK")
IFCAP
"^DD",446.5,446.5,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",446.5,446.5,.01,1,0)
^.1
"^DD",446.5,446.5,.01,1,1,0)
446.5^B
"^DD",446.5,446.5,.01,1,1,1)
S ^PRCT(446.5,"B",$E(X,1,30),DA)=""
"^DD",446.5,446.5,.01,1,1,2)
K ^PRCT(446.5,"B",$E(X,1,30),DA)
"^DD",446.5,446.5,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",446.5,446.5,.01,21,0)
^^1^1^2891205^
"^DD",446.5,446.5,.01,21,1,0)
This is a general description for the label that is designed for this entry.
"^DD",446.5,446.5,.02,0)
FILE^P1'X^DIC(^0;2^I $P(^PRCT(446.5,D0,0),"^",2),$P(^(0),"^",2)'=X W *7,!!,"Since you have change the file, be sure to review all 'FIELD' type parameters",!
"^DD",446.5,446.5,.02,8.5)
@
"^DD",446.5,446.5,.02,9)
@
"^DD",446.5,446.5,.02,21,0)
5^^5^5^2910506^^
"^DD",446.5,446.5,.02,21,1,0)
This is the file that the label will print from during a search and sort
"^DD",446.5,446.5,.02,21,2,0)
functions.  For example: If you want to print a label for all drugs in 
"^DD",446.5,446.5,.02,21,3,0)
the drug file, you would enter 50 or DRUG for this field and labels will
"^DD",446.5,446.5,.02,21,4,0)
print from this file.  If this field is not defined, then the label will
"^DD",446.5,446.5,.02,21,5,0)
be considered to be just free text and not associated with a file.
"^DD",446.5,446.5,.02,"DT")
2891207
"^DD",446.5,446.5,.03,0)
LABEL ROUTINE^FX^^0;3^K:$L(X)>15!($L(X)<1)!($L(X)>8&(X'["-")) X D:$D(X) RTN^PRCTUTL
"^DD",446.5,446.5,.03,3)
ANSWER MUST BE FROM 1-15 CHARACTERS
"^DD",446.5,446.5,.03,21,0)
^^2^2^2910506^^^^
"^DD",446.5,446.5,.03,21,1,0)
If this field has a routine entered, this routine will be called to
"^DD",446.5,446.5,.03,21,2,0)
print the labels rather than the generic label routine.
"^DD",446.5,446.5,.03,"DT")
2910506
"^DD",446.5,446.5,.06,0)
SPECIALTY COMMANDS^P446.6'^PRCT(446.6,^0;6^Q
"^DD",446.5,446.5,.06,21,0)
^^1^1^2920212^
"^DD",446.5,446.5,.06,21,1,0)
This field stores the specialty command for the label.
"^DD",446.5,446.5,.06,"DT")
2930301
"^DD",446.5,446.5,1,0)
TEXT^446.51^^1;0
"^DD",446.5,446.5,1,21,0)
^^2^2^2920819^^
"^DD",446.5,446.5,1,21,1,0)
This is the user defined description of the report.  The report can
"^DD",446.5,446.5,1,21,2,0)
contain parameters (|1|, |2|, etc...).
"^DD",446.5,446.5,2,0)
PARAMETER^446.52I^^2;0
"^DD",446.5,446.5,2,21,0)
^^1^1^2920212^
"^DD",446.5,446.5,2,21,1,0)
This field stores the definition of the parameter used on the label.
"^DD",446.5,446.5,3,0)
FILEMAN CODE^446.53^^3;0
"^DD",446.5,446.5,3,21,0)
^^2^2^2920819^^^
"^DD",446.5,446.5,3,21,1,0)
This word-processing field contains the compiled FILEMAN code
"^DD",446.5,446.5,3,21,2,0)
necessary to run the report.
"^DD",446.5,446.5,4,0)
MUMPS CODE^446.54^^4;0
"^DD",446.5,446.5,4,21,0)
^.001^2^2^3060705^^^^
"^DD",446.5,446.5,4,21,1,0)
This word-processing field contains the compiled MUMPS code
"^DD",446.5,446.5,4,21,2,0)
necessary to run the report.
"^DD",446.5,446.51,0)
TEXT SUB-FIELD^^.01^1
"^DD",446.5,446.51,0,"NM","TEXT")

"^DD",446.5,446.51,0,"UP")
446.5
"^DD",446.5,446.51,.01,0)
TEXT^WL^^0;1^Q
"^DD",446.5,446.51,.01,21,0)
^^1^1^2920819^
"^DD",446.5,446.51,.01,21,1,0)
This is the user defined description of the report.
"^DD",446.5,446.52,0)
PARAMETER SUB-FIELD^^1^13
"^DD",446.5,446.52,0,"ID",.09)
W "   ",$P(^(0),U,9)
"^DD",446.5,446.52,0,"NM","PARAMETER")

"^DD",446.5,446.52,0,"UP")
446.5
"^DD",446.5,446.52,.01,0)
PARAMETER^MNJ2,0X^^0;1^K:+X'=X!(X>15)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",446.5,446.52,.01,3)
Type a Number between 1 and 15, 0 Decimal Digits
"^DD",446.5,446.52,.01,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.01,21,1,0)
This field stores the parameter number on the label.
"^DD",446.5,446.52,.01,"DT")
2891130
"^DD",446.5,446.52,.02,0)
TYPE^RS^0:COUNTER;1:FIELD;2:XECUTABLE CODE;3:FORM FEED;^0;2^Q
"^DD",446.5,446.52,.02,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.02,21,1,0)
This field stores the type of the parameter.
"^DD",446.5,446.52,.02,"DT")
2891130
"^DD",446.5,446.52,.03,0)
BARCODE TYPE^S^0:NO BARCODE;1:SMALL BARCODE;2:MEDIUM BARCODE;3:LARGE BARCODE;^0;3^Q
"^DD",446.5,446.52,.03,3)

"^DD",446.5,446.52,.03,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.03,21,1,0)
This field stores the barcode type of the parameter.
"^DD",446.5,446.52,.03,"DT")
2891201
"^DD",446.5,446.52,.04,0)
FIELD^FX'Ia^^0;4^K:$L(X)>20!($L(X)<1) X D:$D(X) ^PRCTFLD
"^DD",446.5,446.52,.04,3)
ANSWER MUST BE 1-20 CHARACTERS IN LENGTH
"^DD",446.5,446.52,.04,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.04,21,1,0)
This field stores the name of the field for the parameter.
"^DD",446.5,446.52,.04,"AUDIT")
e
"^DD",446.5,446.52,.04,"DT")
3060705
"^DD",446.5,446.52,.05,0)
PRE-TEXT^F^^0;5^K:$L(X)>20!($L(X)<1) X
"^DD",446.5,446.52,.05,3)
ANSWER MUST BE 1-20 CHARACTERS IN LENGTH
"^DD",446.5,446.52,.05,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.05,21,1,0)
This field stores the pre-text printed before the parameter.
"^DD",446.5,446.52,.06,0)
POST-TEXT^F^^0;6^K:$L(X)>20!($L(X)<1) X
"^DD",446.5,446.52,.06,3)
ANSWER MUST BE 1-20 CHARACTERS IN LENGTH
"^DD",446.5,446.52,.06,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.06,21,1,0)
This field stores the post-text printed after the parameter.
"^DD",446.5,446.52,.07,0)
START AT NUMBER^NJ10,2^^0;7^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",446.5,446.52,.07,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",446.5,446.52,.07,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.07,21,1,0)
This field stores the start at number.
"^DD",446.5,446.52,.07,"DT")
2891129
"^DD",446.5,446.52,.08,0)
INCREMENT BY^NJ7,2^^0;8^K:+X'=X!(X>1000)!(X<-1000)!(X?.E1"."3N.N) X
"^DD",446.5,446.52,.08,3)
Type a Number between -1000 and 1000, 2 Decimal Digits
"^DD",446.5,446.52,.08,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.08,21,1,0)
This field stores the increment by value.
"^DD",446.5,446.52,.08,"DT")
2891129
"^DD",446.5,446.52,.09,0)
DESCRIPTION^F^^0;9^K:$L(X)>30!($L(X)<1) X
"^DD",446.5,446.52,.09,3)
ANSWER MUST BE 1-30 CHARACTERS IN LENGTH
"^DD",446.5,446.52,.09,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.09,21,1,0)
This field stores the description of the parameter.
"^DD",446.5,446.52,.09,"DT")
2891130
"^DD",446.5,446.52,.1,0)
TAB^NJ3,0^^0;10^K:+X'=X!(X>250)!(X<1)!(X?.E1"."1N.N) X
"^DD",446.5,446.52,.1,3)
Type a Number between 1 and 250, 0 Decimal Digits
"^DD",446.5,446.52,.1,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.1,21,1,0)
This field is the number of tabs.
"^DD",446.5,446.52,.1,"DT")
2891204
"^DD",446.5,446.52,.11,0)
LEFT JUSTIFY^NJ3,0^^0;11^K:+X'=X!(X>250)!(X<1)!(X?.E1"."1N.N) X
"^DD",446.5,446.52,.11,3)
Type a Number between 1 and 250, 0 Decimal Digits
"^DD",446.5,446.52,.11,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.11,21,1,0)
This field stores the left justification for the parameter.
"^DD",446.5,446.52,.11,"DT")
2930301
"^DD",446.5,446.52,.12,0)
RIGHT JUSTIFY^NJ3,0^^0;12^K:+X'=X!(X>250)!(X<1)!(X?.E1"."1N.N) X
"^DD",446.5,446.52,.12,3)
Type a Number between 1 and 250, 0 Decimal Digits
"^DD",446.5,446.52,.12,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,.12,21,1,0)
This field stores the right justification of the parameter.
"^DD",446.5,446.52,1,0)
XECUTABLE CODE^FX^^1;E1,250^D PROG^PRCTUTL
"^DD",446.5,446.52,1,3)
ANSWER MUST BE 1-250 CHARACTERS IN LENGTH
"^DD",446.5,446.52,1,8.5)
@
"^DD",446.5,446.52,1,9)
@
"^DD",446.5,446.52,1,21,0)
^^1^1^2920212^
"^DD",446.5,446.52,1,21,1,0)
This field stores the executable mumps code for the parameter.
"^DD",446.5,446.52,1,"DT")
2891205
"^DD",446.5,446.53,0)
FILEMAN CODE SUB-FIELD^^.01^1
"^DD",446.5,446.53,0,"NM","FILEMAN CODE")

"^DD",446.5,446.53,0,"UP")
446.5
"^DD",446.5,446.53,.01,0)
FILEMAN CODE^WL^^0;1^Q
"^DD",446.5,446.53,.01,8.5)
@
"^DD",446.5,446.53,.01,9)
@
"^DD",446.5,446.53,.01,21,0)
^^2^2^2920819^
"^DD",446.5,446.53,.01,21,1,0)
This word-processing field contains the compiled FILEMAN code necessary to
"^DD",446.5,446.53,.01,21,2,0)
run the report.
"^DD",446.5,446.53,.01,"DT")
2891130
"^DD",446.5,446.54,0)
MUMPS CODE SUB-FIELD^^.01^1
"^DD",446.5,446.54,0,"NM","MUMPS CODE")

"^DD",446.5,446.54,0,"UP")
446.5
"^DD",446.5,446.54,.01,0)
MUMPS CODE^WL^^0;1^Q
"^DD",446.5,446.54,.01,8.5)
@
"^DD",446.5,446.54,.01,9)
@
"^DD",446.5,446.54,.01,21,0)
^.001^2^2^3060705^^^^
"^DD",446.5,446.54,.01,21,1,0)
This word-processing field contains the compiled MUMPS code necessary to run
"^DD",446.5,446.54,.01,21,2,0)
the report.
"^DD",446.5,446.54,.01,"DT")
2891204
"^DD",446.7,446.7,0)
FIELD^^7^8
"^DD",446.7,446.7,0,"DDA")
N
"^DD",446.7,446.7,0,"DT")
3060606
"^DD",446.7,446.7,0,"IX","B",446.7,.01)

"^DD",446.7,446.7,0,"NM","CLRS REPORT STORAGE")

"^DD",446.7,446.7,0,"VRPK")
PRC
"^DD",446.7,446.7,.01,0)
STATION/INVENTORY POINT^NJ8,0^^0;1^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",446.7,446.7,.01,.1)

"^DD",446.7,446.7,.01,1,0)
^.1
"^DD",446.7,446.7,.01,1,1,0)
446.7^B
"^DD",446.7,446.7,.01,1,1,1)
S ^PRCP(446.7,"B",$E(X,1,30),DA)=""
"^DD",446.7,446.7,.01,1,1,2)
K ^PRCP(446.7,"B",$E(X,1,30),DA)
"^DD",446.7,446.7,.01,3)
Type a Number between 1 and 99999999, 0 Decimal Digits
"^DD",446.7,446.7,.01,21,0)
^.001^2^2^3061220^^
"^DD",446.7,446.7,.01,21,1,0)
This is a number representing a combination of the station number 
"^DD",446.7,446.7,.01,21,2,0)
concatenated with the inventory point for the CLRS report being stored.
"^DD",446.7,446.7,.01,"DT")
3060608
"^DD",446.7,446.7,1,0)
SOH REPORT DATA^F^^1;1^K:$L(X)>200!($L(X)<1) X
"^DD",446.7,446.7,1,3)
Answer must be 1-200 characters in length.
"^DD",446.7,446.7,1,21,0)
^^5^5^3061219^
"^DD",446.7,446.7,1,21,1,0)
This field will house the first part of the CLRS report data for the Stock
"^DD",446.7,446.7,1,21,2,0)
on Hand report.  The data presents as follows, with  each field in
"^DD",446.7,446.7,1,21,3,0)
brackets: <Station#>*<Date Range>*<Inventory Point ID>*<Inventory Point
"^DD",446.7,446.7,1,21,4,0)
Name>*<Inventory Point Type>*<Total Dollars>*<# Inventory Point Items>
"^DD",446.7,446.7,1,21,5,0)
*<Current Line Item #>*<Cost Center>
"^DD",446.7,446.7,1,"DT")
3061219
"^DD",446.7,446.7,2,0)
SOH REPORT DATA PT2^F^^2;1^K:$L(X)>200!($L(X)<1) X
"^DD",446.7,446.7,2,3)
Answer must be 1-200 characters in length.
"^DD",446.7,446.7,2,21,0)
^^5^5^3060607^
"^DD",446.7,446.7,2,21,1,0)
This field will house the second part of the CLRS report data for the
"^DD",446.7,446.7,2,21,2,0)
Stock on Hand report.  The data presents as follows, with  each field in
"^DD",446.7,446.7,2,21,3,0)
brackets: <Std Total $ Value>*<ODI  Total $ Value>*<All Total $
"^DD",446.7,446.7,2,21,4,0)
Value>*<Std # SOH Items>*<ODI # SOH Items>*<All # SOH Items>*<Std # Inv
"^DD",446.7,446.7,2,21,5,0)
Items>*<ODI # Inv Items>*<All # Inv Items>
"^DD",446.7,446.7,2,"DT")
3060606
"^DD",446.7,446.7,3,0)
SSR REPORT DATA^F^^3;1^K:$L(X)>200!($L(X)<1) X
"^DD",446.7,446.7,3,3)
Answer must be 1-200 characters in length.
"^DD",446.7,446.7,3,21,0)
^^4^4^3060607^
"^DD",446.7,446.7,3,21,1,0)
This field will house the first part of the CLRS report data for the Stock
"^DD",446.7,446.7,3,21,2,0)
Status Report.  The data reports as follows, with each field in
"^DD",446.7,446.7,3,21,3,0)
brackets:  <Station #>*<Date Range>*<Inactivity Range>*<Inventory Point
"^DD",446.7,446.7,3,21,4,0)
ID>*<Inventory Point>*<Inventory Point Type>
"^DD",446.7,446.7,3,"DT")
3060606
"^DD",446.7,446.7,4,0)
SSR REPORT DATA PT2^F^^4;1^K:$L(X)>200!($L(X)<1) X
"^DD",446.7,446.7,4,3)
Answer must be 1-200 characters in length.
"^DD",446.7,446.7,4,21,0)
^^6^6^3061219^
"^DD",446.7,446.7,4,21,1,0)
This field will house the second part of the CLRS report data for the
"^DD",446.7,446.7,4,21,2,0)
Stock Status Report.  The data reports as follows, with each field in
"^DD",446.7,446.7,4,21,3,0)
brackets: <Std Opening Balance Total>*<ODI Opening Balance Total>*<All
"^DD",446.7,446.7,4,21,4,0)
Opening Balance Total>*<Std Receipts Total>*<ODI Receipts Total>*<All
"^DD",446.7,446.7,4,21,5,0)
Receipts Total>*<Std Usage Total>*<ODI Usage Total>*<All Usage Total>*<Std
"^DD",446.7,446.7,4,21,6,0)
Adjustments Total>*<ODI  Adjustments Total>*<All Adjustments Total>
"^DD",446.7,446.7,4,"DT")
3061219
"^DD",446.7,446.7,5,0)
SSR REPORT DATA PT3^F^^5;1^K:$L(X)>200!($L(X)<1) X
"^DD",446.7,446.7,5,3)
Answer must be 1-200 characters in length.
"^DD",446.7,446.7,5,21,0)
^^6^6^3061219^
"^DD",446.7,446.7,5,21,1,0)
This field will house the third part of the CLRS report data for the
"^DD",446.7,446.7,5,21,2,0)
Stock Status Report.  The data reports as follows, with each field in
"^DD",446.7,446.7,5,21,3,0)
brackets: <Std Closing Balance Total>*<ODI Closing Balance Total>*<All
"^DD",446.7,446.7,5,21,4,0)
Closing Balance Total>*<# Std Receipts>*<# ODI Receipts>*<# All 
"^DD",446.7,446.7,5,21,5,0)
Receipts>*<# Std Usage>*<# ODI Usage>*<# All Usage>*<# Std Adjustments>*<#
"^DD",446.7,446.7,5,21,6,0)
ODI Adjustments>*<# All Adjustments>
"^DD",446.7,446.7,5,"DT")
3061219
"^DD",446.7,446.7,6,0)
SSR REPORT DATA PT4^F^^6;1^K:$L(X)>200!($L(X)<1) X
"^DD",446.7,446.7,6,3)
Answer must be 1-200 characters in length.
"^DD",446.7,446.7,6,21,0)
^^6^6^3060607^
"^DD",446.7,446.7,6,21,1,0)
This field will house the fourth part of the CLRS report data for the 
"^DD",446.7,446.7,6,21,2,0)
Stock Status Report.  The data reports as follows, with each field in
"^DD",446.7,446.7,6,21,3,0)
brackets: <Std Turnover Total>*<ODI Turnover Total>*<All Turnover
"^DD",446.7,446.7,6,21,4,0)
Total>*<Std # Inactive Items>*<ODI # Inactive Items>*<All # Inactive
"^DD",446.7,446.7,6,21,5,0)
Items>*<Std Inactive Total $>*<ODI Inactive Total $>*<All Inactive Total
"^DD",446.7,446.7,6,21,6,0)
$>*<Std Inactive %>*<ODI Inactive %>*<All Inactive %>
"^DD",446.7,446.7,6,"DT")
3060606
"^DD",446.7,446.7,7,0)
SSR REPORT DATA PT5^F^^7;1^K:$L(X)>200!($L(X)<1) X
"^DD",446.7,446.7,7,3)
Answer must be 1-200 characters in length.
"^DD",446.7,446.7,7,21,0)
^^7^7^3060607^
"^DD",446.7,446.7,7,21,1,0)
This field will house the fifth part of the CLRS report data for the 
"^DD",446.7,446.7,7,21,2,0)
Stock Status Report.  The data reports as follows, with each field in
"^DD",446.7,446.7,7,21,3,0)
brackets: <Std # Long Supply>*<ODI # Long Supply>*<All # Long Supply>*<Std
"^DD",446.7,446.7,7,21,4,0)
Long Supply Total $>*<ODI Long Supply Total $>*<All Long Supply Total
"^DD",446.7,446.7,7,21,5,0)
$>*<Std Long Supply %>*<ODI Long Supply %>*<All Long Supply %>*<Std #
"^DD",446.7,446.7,7,21,6,0)
Inventory Line Items>*<ODI # Inventory Line Items>*<All # Inventory Line
"^DD",446.7,446.7,7,21,7,0)
Items>
"^DD",446.7,446.7,7,"DT")
3060606
"^DIC",446.5,446.5,0)
CUSTOM LABEL^446.5
"^DIC",446.5,446.5,0,"GL")
^PRCT(446.5,
"^DIC",446.5,446.5,"%D",0)
^^2^2^2940309^^^
"^DIC",446.5,446.5,"%D",1,0)
This file contains the custom labels to be used as part of the Barcode
"^DIC",446.5,446.5,"%D",2,0)
Inventory process.
"^DIC",446.5,"B","CUSTOM LABEL",446.5)

"^DIC",446.7,446.7,0)
CLRS REPORT STORAGE^446.7
"^DIC",446.7,446.7,0,"GL")
^PRCP(446.7,
"^DIC",446.7,446.7,"%",0)
^1.005^^
"^DIC",446.7,446.7,"%D",0)
^^4^4^3060608^
"^DIC",446.7,446.7,"%D",1,0)
This file contains report data needed by the Clinical Logistics Report 
"^DIC",446.7,446.7,"%D",2,0)
Server (CLRS). The PRCPLO CLO GIP OPTION runs the report that clears and
"^DIC",446.7,446.7,"%D",3,0)
then populates this file.  The Prosthetics and Clinical Logistics Office
"^DIC",446.7,446.7,"%D",4,0)
(P&CLO) requires this option to be run on the first day of each month.
"^DIC",446.7,"B","CLRS REPORT STORAGE",446.7)

"BLD",5008,6)
^91
**END**
**END**
