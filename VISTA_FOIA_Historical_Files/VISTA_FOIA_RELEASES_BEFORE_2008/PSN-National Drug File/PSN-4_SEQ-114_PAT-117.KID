Released PSN*4*117 SEQ #114
Extracted from mail message
**KIDS**:PSN*4.0*117^

**INSTALL NAME**
PSN*4.0*117
"BLD",923,0)
PSN*4.0*117^NATIONAL DRUG FILE^0^3061006^y
"BLD",923,1,0)
^^17^17^3060428^
"BLD",923,1,1,0)
 
"BLD",923,1,2,0)
 
"BLD",923,1,3,0)
1.  Certain entries in the DRUG INTERACTION file (#56) may have been
"BLD",923,1,4,0)
    created using ingredients that are no longer primary ingredients.
"BLD",923,1,5,0)
    The routine included in this patch will replace those ingredients
"BLD",923,1,6,0)
    with the corresponding primary ingredients.
"BLD",923,1,7,0)
 
"BLD",923,1,8,0)
2.  Certain entries in the PATIENT ALLERGIES file (#120.8) may include
"BLD",923,1,9,0)
    non-primary ingredients.  The routine included in this patch will
"BLD",923,1,10,0)
    change those entries to the corresponding primary ingredients.
"BLD",923,1,11,0)
 
"BLD",923,1,12,0)
********************************NOTE***********************************
"BLD",923,1,13,0)
The routine included in this patch will not be run when the patch is
"BLD",923,1,14,0)
installed.  It will be called as part of the post-install during future
"BLD",923,1,15,0)
data update patches.
"BLD",923,1,16,0)
***********************************************************************
"BLD",923,1,17,0)
 
"BLD",923,4,0)
^9.64PA^^
"BLD",923,6.3)
6
"BLD",923,"ABPKG")
n
"BLD",923,"KRN",0)
^9.67PA^8989.52^19
"BLD",923,"KRN",.4,0)
.4
"BLD",923,"KRN",.401,0)
.401
"BLD",923,"KRN",.402,0)
.402
"BLD",923,"KRN",.403,0)
.403
"BLD",923,"KRN",.5,0)
.5
"BLD",923,"KRN",.84,0)
.84
"BLD",923,"KRN",3.6,0)
3.6
"BLD",923,"KRN",3.8,0)
3.8
"BLD",923,"KRN",9.2,0)
9.2
"BLD",923,"KRN",9.8,0)
9.8
"BLD",923,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",923,"KRN",9.8,"NM",1,0)
PSNCLEAN^^0^B35528399
"BLD",923,"KRN",9.8,"NM","B","PSNCLEAN",1)

"BLD",923,"KRN",19,0)
19
"BLD",923,"KRN",19.1,0)
19.1
"BLD",923,"KRN",101,0)
101
"BLD",923,"KRN",409.61,0)
409.61
"BLD",923,"KRN",771,0)
771
"BLD",923,"KRN",870,0)
870
"BLD",923,"KRN",8989.51,0)
8989.51
"BLD",923,"KRN",8989.52,0)
8989.52
"BLD",923,"KRN",8994,0)
8994
"BLD",923,"KRN","B",.4,.4)

"BLD",923,"KRN","B",.401,.401)

"BLD",923,"KRN","B",.402,.402)

"BLD",923,"KRN","B",.403,.403)

"BLD",923,"KRN","B",.5,.5)

"BLD",923,"KRN","B",.84,.84)

"BLD",923,"KRN","B",3.6,3.6)

"BLD",923,"KRN","B",3.8,3.8)

"BLD",923,"KRN","B",9.2,9.2)

"BLD",923,"KRN","B",9.8,9.8)

"BLD",923,"KRN","B",19,19)

"BLD",923,"KRN","B",19.1,19.1)

"BLD",923,"KRN","B",101,101)

"BLD",923,"KRN","B",409.61,409.61)

"BLD",923,"KRN","B",771,771)

"BLD",923,"KRN","B",870,870)

"BLD",923,"KRN","B",8989.51,8989.51)

"BLD",923,"KRN","B",8989.52,8989.52)

"BLD",923,"KRN","B",8994,8994)

"BLD",923,"QUES",0)
^9.62^^
"BLD",923,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",114,-1)
1^1
"PKG",114,0)
NATIONAL DRUG FILE^PSN^This is the National Drug File Package V 4
"PKG",114,20,0)
^9.402P^^
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
4.0^3041105
"PKG",114,22,1,"PAH",1,0)
117^3061006
"PKG",114,22,1,"PAH",1,1,0)
^^17^17^3061006
"PKG",114,22,1,"PAH",1,1,1,0)
 
"PKG",114,22,1,"PAH",1,1,2,0)
 
"PKG",114,22,1,"PAH",1,1,3,0)
1.  Certain entries in the DRUG INTERACTION file (#56) may have been
"PKG",114,22,1,"PAH",1,1,4,0)
    created using ingredients that are no longer primary ingredients.
"PKG",114,22,1,"PAH",1,1,5,0)
    The routine included in this patch will replace those ingredients
"PKG",114,22,1,"PAH",1,1,6,0)
    with the corresponding primary ingredients.
"PKG",114,22,1,"PAH",1,1,7,0)
 
"PKG",114,22,1,"PAH",1,1,8,0)
2.  Certain entries in the PATIENT ALLERGIES file (#120.8) may include
"PKG",114,22,1,"PAH",1,1,9,0)
    non-primary ingredients.  The routine included in this patch will
"PKG",114,22,1,"PAH",1,1,10,0)
    change those entries to the corresponding primary ingredients.
"PKG",114,22,1,"PAH",1,1,11,0)
 
"PKG",114,22,1,"PAH",1,1,12,0)
********************************NOTE***********************************
"PKG",114,22,1,"PAH",1,1,13,0)
The routine included in this patch will not be run when the patch is
"PKG",114,22,1,"PAH",1,1,14,0)
installed.  It will be called as part of the post-install during future
"PKG",114,22,1,"PAH",1,1,15,0)
data update patches.
"PKG",114,22,1,"PAH",1,1,16,0)
***********************************************************************
"PKG",114,22,1,"PAH",1,1,17,0)
 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSNCLEAN")
0^1^B35528399^n/a
"RTN","PSNCLEAN",1,0)
PSNCLEAN ;BIR/DMA-clean up ingredients and interactions ; 06 Oct 2006  10:26 AM
"RTN","PSNCLEAN",2,0)
 ;;4.0; NATIONAL DRUG FILE;**117**; 3O Oct 98;Build 6
"RTN","PSNCLEAN",3,0)
 ;
"RTN","PSNCLEAN",4,0)
 ;Reference to ^GMR(120.8 supported by DBIA# 2545
"RTN","PSNCLEAN",5,0)
 ;
"RTN","PSNCLEAN",6,0)
 N DA,DIE,DIK,DR,J,LINE,NA,NEWDA,PSN,PSNDA,PSNI,PSNI1,PSNI1N,PSNI1P,PSNI2,PSNI2N,PSNI2P,PSNN,PSNK,PSNPAT,PSNX,X,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","PSNCLEAN",7,0)
 K ^TMP($J),^TMP("PSN",$J)
"RTN","PSNCLEAN",8,0)
INTER ;CHECK FOR NON-PRIMARIES
"RTN","PSNCLEAN",9,0)
 S DA=0 F  S DA=$O(^PS(56,DA)) Q:'DA  S X=^(DA,0),PSNI1=$P(X,"^",2),PSNI2=$P(X,"^",3),PSNI1N=$P(^PS(50.416,PSNI1,0),"^",2),PSNI2N=$P(^PS(50.416,PSNI2,0),"^",2) D
"RTN","PSNCLEAN",10,0)
 .I 'PSNI1N,'PSNI2N Q
"RTN","PSNCLEAN",11,0)
 .S PSNI1P=$S('PSNI1N:PSNI1,1:PSNI1N),PSNI2P=$S('PSNI2N:PSNI2,1:PSNI2N)
"RTN","PSNCLEAN",12,0)
 .I '$D(^PS(56,"AE",PSNI1P,PSNI2P)) D  Q
"RTN","PSNCLEAN",13,0)
 ..;NO PRE-EXISTING INTERACTION - RENAME AND QUIT
"RTN","PSNCLEAN",14,0)
 ..K PSN,PSNN S PSN($P(^PS(50.416,PSNI1P,0),"^"))="",PSN($P(^PS(50.416,PSNI2P,0),"^"))="",PSNN=$O(PSN(""))_"/"_$O(PSN($O(PSN("")))),^TMP($J,"RENAM",$P(X,"^")_"^"_PSNN)="",DIE="^PS(56,",DR=".01////"_PSNN D ^DIE
"RTN","PSNCLEAN",15,0)
 ..K ^PS(56,"AI1",PSNI1,DA),^PS(56,"AI2",PSNI2,DA),^PS(56,"AE",PSNI1,PSNI2,DA),^PS(56,"AE",PSNI2,PSNI1,DA) S (^PS(56,"AI1",PSNI1P,DA),^PS(56,"AI2",PSNI2P,DA),^PS(56,"AE",PSNI1P,PSNI2P,DA),^PS(56,"AE",PSNI2P,PSNI1P,DA))=""
"RTN","PSNCLEAN",16,0)
 ..S $P(^PS(56,DA,0),"^",2,3)=PSNI1P_"^"_PSNI2P
"RTN","PSNCLEAN",17,0)
 .;PRE-EXISTING INTERACTIONS - LOG TO DELETE
"RTN","PSNCLEAN",18,0)
 .S NEWDA=$QS($Q(^PS(56,"AE",PSNI1P,PSNI2P)),5) D
"RTN","PSNCLEAN",19,0)
 ..S ^TMP($J,"DEL",$P(X,"^"))="",^TMP($J,"DELIEN",DA)=NEWDA
"RTN","PSNCLEAN",20,0)
 ;NOW DELETE AND REPOINT
"RTN","PSNCLEAN",21,0)
 S PSN=0 F  S PSN=$O(^TMP($J,"DELIEN",PSN)) Q:'PSN  S X=^PS(56,PSN,0),PSNI1=$P(X,"^",2),PSNI2=$P(X,"^",3),$P(^PS(56,PSN,0),"^",2,7)="" K ^PS(56,"AI1",PSNI1,PSN),^PS(56,"AI2",PSNI2,PSN),^PS(56,"AE",PSNI1,PSNI2,PSN),^PS(56,"AE",PSNI2,PSNI1,PSN)
"RTN","PSNCLEAN",22,0)
 ;NOW THE APD
"RTN","PSNCLEAN",23,0)
 S X="^PS(56,""APD"")" F  S X=$Q(@X) Q:$QS(X,2)'="APD"  I $D(^TMP($J,"DELIEN",$QS(X,5))) S NEWDA=^($QS(X,5)) K @X,^PS(56,"APD",$QS(X,4),$QS(X,3),$QS(X,5)) S (^PS(56,"APD",$QS(X,3),$QS(X,4),NEWDA),^PS(56,"APD",$QS(X,4),$QS(X,3),NEWDA))=""
"RTN","PSNCLEAN",24,0)
 ;NOW THE 0 NODE
"RTN","PSNCLEAN",25,0)
 S PSN=0 F  S PSN=$O(^TMP($J,"DELIEN",PSN)) Q:'PSN  S DIK="^PS(56,",DA=PSN D ^DIK
"RTN","PSNCLEAN",26,0)
 ;
"RTN","PSNCLEAN",27,0)
 I '$D(^TMP($J,"DEL")),'$D(^("RENAM")) D  G ALLER
"RTN","PSNCLEAN",28,0)
 .F LINE=1:1 S X=$P($T(TEXT4+LINE),";",3,300) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X
"RTN","PSNCLEAN",29,0)
 F LINE=1:1 S X=$P($T(TEXT+LINE),";",3,300) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X
"RTN","PSNCLEAN",30,0)
 I '$D(^TMP($J,"RENAM")) S ^TMP("PSN",$J,LINE,0)=" ",^TMP("PSN",$J,LINE+1,0)="none found",LINE=LINE+2
"RTN","PSNCLEAN",31,0)
 S NA="" F  S NA=$O(^TMP($J,"RENAM",NA)) Q:NA=""  S ^TMP("PSN",$J,LINE,0)=$P(NA,"^")_" was changed to",^TMP("PSN",$J,LINE+1,0)="   "_$P(NA,"^",2),^TMP("PSN",$J,LINE+2,0)=" ",LINE=LINE+3
"RTN","PSNCLEAN",32,0)
 F J=1:1 S X=$P($T(TEXT2+J),";",3,300) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X,LINE=LINE+1
"RTN","PSNCLEAN",33,0)
 I '$D(^TMP($J,"DEL")) S ^TMP("PSN",$J,LINE,0)="none found",LINE=LINE+1
"RTN","PSNCLEAN",34,0)
 S NA="" F  S NA=$O(^TMP($J,"DEL",NA)) Q:NA=""  S ^TMP("PSN",$J,LINE,0)=NA,LINE=LINE+1
"RTN","PSNCLEAN",35,0)
ALLER ;now the allergies
"RTN","PSNCLEAN",36,0)
 I ^XMB("NETNAME")["CMOP" G SENDIT
"RTN","PSNCLEAN",37,0)
 ;skip allergies for CMOPs
"RTN","PSNCLEAN",38,0)
 K ^TMP($J)
"RTN","PSNCLEAN",39,0)
 S PSNDA=0 F  S PSNDA=$O(^GMR(120.8,PSNDA)) Q:'PSNDA  I $D(^(PSNDA,0)) S PSNPAT=+^(0) I $D(^DPT(PSNPAT,0)) S PSNPAT=$P(^(0),"^"),PSNI=$P(^GMR(120.8,PSNDA,0),"^",3) D
"RTN","PSNCLEAN",40,0)
 .I PSNI["PS(50.416",$D(^PS(50.416,+PSNI,0)),$P(^(0),"^",2) S PSNI=$P(^(0),"^",2)_";PS(50.416,",$P(^GMR(120.8,PSNDA,0),"^",3)=PSNI
"RTN","PSNCLEAN",41,0)
 .S PSNK=0 F  S PSNK=$O(^GMR(120.8,PSNDA,2,PSNK)) Q:'PSNK  S PSNI=^(PSNK,0) D
"RTN","PSNCLEAN",42,0)
 ..S PSNX=$P(^PS(50.416,PSNI,0),"^",2) I PSNX S DA(1)=PSNDA,DA=PSNK,DIE="^GMR(120.8,DA(1),2,",DR=".01////"_$S($D(^GMR(120.8,DA(1),2,"B",PSNX)):"@",1:PSNX) D ^DIE S ^TMP($J,1,PSNPAT,$P(^PS(50.416,PSNI,0),"^")_"^"_$P(^PS(50.416,PSNX,0),"^"))=""
"RTN","PSNCLEAN",43,0)
 ;
"RTN","PSNCLEAN",44,0)
 I '$D(^TMP($J,1)) D  G SENDIT
"RTN","PSNCLEAN",45,0)
 .F J=1:1 S X=$P($T(TEXT5+J),";",3,300) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X,LINE=LINE+1
"RTN","PSNCLEAN",46,0)
 F J=1:1 S X=$P($T(TEXT3+J),";",3,300) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X,LINE=LINE+1
"RTN","PSNCLEAN",47,0)
 I '$D(^TMP($J,1)) S ^TMP("PSN",$J,LINE,0)="none found",LINE=LINE+1
"RTN","PSNCLEAN",48,0)
 S NA="" F  S NA=$O(^TMP($J,1,NA)) Q:NA=""  S X="" F  S X=$O(^TMP($J,1,NA,X)) Q:X=""  S ^TMP("PSN",$J,LINE,0)="Patient: "_NA,LINE=LINE+1,^TMP("PSN",$J,LINE,0)="Non-primary ingredient "_$P(X,"^"),LINE=LINE+1 D
"RTN","PSNCLEAN",49,0)
 .S ^TMP("PSN",$J,LINE,0)="was replaced with primary ingredient "_$P(X,"^",2),LINE=LINE+1,^TMP("PSN",$J,LINE,0)=" ",LINE=LINE+1
"RTN","PSNCLEAN",50,0)
 ;
"RTN","PSNCLEAN",51,0)
SENDIT ;
"RTN","PSNCLEAN",52,0)
 S XMSUB="INTERACTIONS and ALLERGIES UPDATED",XMDUZ="NDF MANAGER",XMTEXT="^TMP(""PSN"",$J," K XMY S XMY(DUZ)="",XMY("G.NDF DATA@"_^XMB("NETNAME"))="",DA=0 F  S DA=$O(^XUSEC("PSNMGR",DA)) Q:'DA  S XMY(DA)=""
"RTN","PSNCLEAN",53,0)
 N DIFROM D ^XMD
"RTN","PSNCLEAN",54,0)
QUIT K DA,DIE,DIK,DR,J,LINE,NA,NEWDA,PSN,PSNDA,PSNI,PSNI1,PSNI1N,PSNI1P,PSNI2,PSNI2N,PSNI2P,PSNN,PSNK,PSNPAT,PSNX,X,XMDUZ,XMSUB,XMTEXT,XMY,^TMP($J),^TMP("PSN",$J)
"RTN","PSNCLEAN",55,0)
 Q
"RTN","PSNCLEAN",56,0)
TEXT3 ; 
"RTN","PSNCLEAN",57,0)
 ;;  
"RTN","PSNCLEAN",58,0)
 ;;=========================================================================
"RTN","PSNCLEAN",59,0)
 ;;Allergy information for the following patients has been changed.
"RTN","PSNCLEAN",60,0)
 ;; 
"RTN","PSNCLEAN",61,0)
 ;;The allergy for the listed patients was created with a non-primary
"RTN","PSNCLEAN",62,0)
 ;;ingredient.  These have been updated to replace the non-primary
"RTN","PSNCLEAN",63,0)
 ;;ingredient with the proper primary ingredient.
"RTN","PSNCLEAN",64,0)
 ;;  
"RTN","PSNCLEAN",65,0)
 ;
"RTN","PSNCLEAN",66,0)
TEXT ;
"RTN","PSNCLEAN",67,0)
 ;; 
"RTN","PSNCLEAN",68,0)
 ;;The following interactions have been edited because they
"RTN","PSNCLEAN",69,0)
 ;;involved ingredients that are not primary ingredients.
"RTN","PSNCLEAN",70,0)
 ;; 
"RTN","PSNCLEAN",71,0)
 ;
"RTN","PSNCLEAN",72,0)
TEXT2 ; 
"RTN","PSNCLEAN",73,0)
 ;; 
"RTN","PSNCLEAN",74,0)
 ;;The following interactions have been deleted because
"RTN","PSNCLEAN",75,0)
 ;;Primary Ingredient/Other Ingredient combination already
"RTN","PSNCLEAN",76,0)
 ;;exists in the DRUG INGREDIENTS file involved ingredients
"RTN","PSNCLEAN",77,0)
 ;;that are not primary ingredients. 
"RTN","PSNCLEAN",78,0)
 ;; 
"RTN","PSNCLEAN",79,0)
 ;
"RTN","PSNCLEAN",80,0)
TEXT4 ;
"RTN","PSNCLEAN",81,0)
 ;; 
"RTN","PSNCLEAN",82,0)
 ;;No DRUG INTERACTIONS were updated due to Primary Ingredients being
"RTN","PSNCLEAN",83,0)
 ;;changed to Non-Primary ingredients in the Data Update.
"RTN","PSNCLEAN",84,0)
 ;; 
"RTN","PSNCLEAN",85,0)
 ;
"RTN","PSNCLEAN",86,0)
TEXT5 ;
"RTN","PSNCLEAN",87,0)
 ;; 
"RTN","PSNCLEAN",88,0)
 ;;No PATIENT ALLERGIES were updated due to Primary Ingredients being
"RTN","PSNCLEAN",89,0)
 ;;changed to Non-Primary ingredients during the Data Update.
"RTN","PSNCLEAN",90,0)
 ;; 
"VER")
8.0^22.0
"BLD",923,6)
^114
**END**
**END**
