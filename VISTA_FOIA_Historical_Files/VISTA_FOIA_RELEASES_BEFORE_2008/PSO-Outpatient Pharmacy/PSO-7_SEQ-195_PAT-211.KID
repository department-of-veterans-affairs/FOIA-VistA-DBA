Released PSO*7*211 SEQ #195
Extracted from mail message
**KIDS**:PSO*7.0*211^

**INSTALL NAME**
PSO*7.0*211
"BLD",6242,0)
PSO*7.0*211^OUTPATIENT PHARMACY^0^3050912^y
"BLD",6242,1,0)
^^5^5^3050616^
"BLD",6242,1,1,0)
This patch will modify the order process to require a physician to have a 
"BLD",6242,1,2,0)
DEA# or VA# to order controlled substances.
"BLD",6242,1,3,0)
It will also modify Script Talk label so if the instructions are more than
"BLD",6242,1,4,0)
three lines, the message that the signature is too long will print 
"BLD",6242,1,5,0)
instead.
"BLD",6242,4,0)
^9.64PA^^
"BLD",6242,"KRN",0)
^9.67PA^8989.52^19
"BLD",6242,"KRN",.4,0)
.4
"BLD",6242,"KRN",.401,0)
.401
"BLD",6242,"KRN",.402,0)
.402
"BLD",6242,"KRN",.403,0)
.403
"BLD",6242,"KRN",.5,0)
.5
"BLD",6242,"KRN",.84,0)
.84
"BLD",6242,"KRN",3.6,0)
3.6
"BLD",6242,"KRN",3.8,0)
3.8
"BLD",6242,"KRN",9.2,0)
9.2
"BLD",6242,"KRN",9.8,0)
9.8
"BLD",6242,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6242,"KRN",9.8,"NM",1,0)
PSODIR^^0^B29145455
"BLD",6242,"KRN",9.8,"NM",2,0)
PSOTALK^^0^B76664087
"BLD",6242,"KRN",9.8,"NM","B","PSODIR",1)

"BLD",6242,"KRN",9.8,"NM","B","PSOTALK",2)

"BLD",6242,"KRN",19,0)
19
"BLD",6242,"KRN",19.1,0)
19.1
"BLD",6242,"KRN",101,0)
101
"BLD",6242,"KRN",409.61,0)
409.61
"BLD",6242,"KRN",771,0)
771
"BLD",6242,"KRN",870,0)
870
"BLD",6242,"KRN",8989.51,0)
8989.51
"BLD",6242,"KRN",8989.52,0)
8989.52
"BLD",6242,"KRN",8994,0)
8994
"BLD",6242,"KRN","B",.4,.4)

"BLD",6242,"KRN","B",.401,.401)

"BLD",6242,"KRN","B",.402,.402)

"BLD",6242,"KRN","B",.403,.403)

"BLD",6242,"KRN","B",.5,.5)

"BLD",6242,"KRN","B",.84,.84)

"BLD",6242,"KRN","B",3.6,3.6)

"BLD",6242,"KRN","B",3.8,3.8)

"BLD",6242,"KRN","B",9.2,9.2)

"BLD",6242,"KRN","B",9.8,9.8)

"BLD",6242,"KRN","B",19,19)

"BLD",6242,"KRN","B",19.1,19.1)

"BLD",6242,"KRN","B",101,101)

"BLD",6242,"KRN","B",409.61,409.61)

"BLD",6242,"KRN","B",771,771)

"BLD",6242,"KRN","B",870,870)

"BLD",6242,"KRN","B",8989.51,8989.51)

"BLD",6242,"KRN","B",8989.52,8989.52)

"BLD",6242,"KRN","B",8994,8994)

"BLD",6242,"QUES",0)
^9.62^^
"BLD",6242,"REQB",0)
^9.611^2^2
"BLD",6242,"REQB",1,0)
PSO*7.0*164^2
"BLD",6242,"REQB",2,0)
PSO*7.0*182^2
"BLD",6242,"REQB","B","PSO*7.0*164",1)

"BLD",6242,"REQB","B","PSO*7.0*182",2)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
211^3050912
"PKG",206,22,1,"PAH",1,1,0)
^^5^5^3050912
"PKG",206,22,1,"PAH",1,1,1,0)
This patch will modify the order process to require a physician to have a 
"PKG",206,22,1,"PAH",1,1,2,0)
DEA# or VA# to order controlled substances.
"PKG",206,22,1,"PAH",1,1,3,0)
It will also modify Script Talk label so if the instructions are more than
"PKG",206,22,1,"PAH",1,1,4,0)
three lines, the message that the signature is too long will print 
"PKG",206,22,1,"PAH",1,1,5,0)
instead.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSODIR")
0^1^B29145455
"RTN","PSODIR",1,0)
PSODIR ;BHAM ISC/SAB - asks data for rx order entry ;02/12/93 8:49
"RTN","PSODIR",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**37,46,111,117,146,164,211**;DEC 1997
"RTN","PSODIR",3,0)
 ;External reference PSDRUG( supported by DBIA 221
"RTN","PSODIR",4,0)
 ;External reference PS(50.7 supported by DBIA 2223
"RTN","PSODIR",5,0)
 ;External reference to VA(200 is supported by DBIA 10060
"RTN","PSODIR",6,0)
 ;----------------------------------------------------------------
"RTN","PSODIR",7,0)
 ;
"RTN","PSODIR",8,0)
PROV(PSODIR) ;
"RTN","PSODIR",9,0)
PROVEN ; Entry point for failed lookup
"RTN","PSODIR",10,0)
 K DIC,X,Y S:$G(PSOFDR)&($G(OR0)) DIC("B")=$P(^VA(200,$P($G(OR0),"^",5),0),"^")
"RTN","PSODIR",11,0)
 I $G(PSODIR("PROVIDER"))]"" S PSODIR("OLD VAL")=PSODIR("PROVIDER")
"RTN","PSODIR",12,0)
 S DIC="^VA(200,",DIC(0)="QEAM",PSODIR("FIELD")=0
"RTN","PSODIR",13,0)
 S DIC("W")="W ""     "",$P(^(""PS""),""^"",9)"
"RTN","PSODIR",14,0)
 S DIC("A")="PROVIDER: ",DIC("S")="I $D(^(""PS"")),$P(^(""PS""),""^""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)'<DT)"
"RTN","PSODIR",15,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" S DIC("S")=DIC("S")_",$P($G(^(""TPB"")),""^""),$P($G(^(""TPB"")),""^"",5)=0"
"RTN","PSODIR",16,0)
 S:$G(PSORX("PROVIDER NAME"))]"" DIC("B")=PSORX("PROVIDER NAME")
"RTN","PSODIR",17,0)
 D ^DIC K DIC
"RTN","PSODIR",18,0)
 I X[U,$L(X)>1 D:'$G(PSOEDIT) JUMP G PROVX
"RTN","PSODIR",19,0)
 I $D(DTOUT)!$D(DUOUT) S PSODIR("DFLG")=1 G PROVX
"RTN","PSODIR",20,0)
 I '$G(SPEED),Y=-1 G PROVEN
"RTN","PSODIR",21,0)
 Q:$G(SPEED)&(Y=-1)
"RTN","PSODIR",22,0)
 ;PSO*7*211; ADD CHECK FOR DEA# AND VA#
"RTN","PSODIR",23,0)
 I $P($G(PSODIR("CS")),"^",1) I '$L($P($G(^VA(200,+Y,"PS")),U,2)),'$L($P($G(^VA(200,+Y,"PS")),U,3)) D  G PROVEN
"RTN","PSODIR",24,0)
 .W $C(7),!!,"Provider must have a DEA# or VA#",!
"RTN","PSODIR",25,0)
 I '$G(PSODRUG("IEN")),'$G(PSORENW("DRUG IEN")) G NODRUG
"RTN","PSODIR",26,0)
 I '$G(SPEED),$P($G(^PSDRUG($S($G(PSODRUG("IEN")):PSODRUG("IEN"),1:PSORENW("DRUG IEN")),"CLOZ1")),"^")="PSOCLO1",$P(^VA(200,+Y,"PS"),"^",2)'?2U7N D  K Y,PSORX("PROVIDER NAME"),DIC("B") G PROVEN
"RTN","PSODIR",27,0)
 .W $C(7),!!,"Only providers with DEA numbers can write prescriptions for clozaril.",!
"RTN","PSODIR",28,0)
NODRUG S PSODIR("PROVIDER")=+Y
"RTN","PSODIR",29,0)
 S (PSODIR("PROVIDER NAME"),PSORX("PROVIDER NAME"))=$P(Y,"^",2)
"RTN","PSODIR",30,0)
 I $G(PSODIR("OLD VAL"))'=+Y K PSODIR("GENERIC PROVIDER"),PSODIR("COSIGNING PROVIDER")
"RTN","PSODIR",31,0)
 I $G(PSODIR("OLD VAL"))'=$G(PSODIR("PROVIDER")),$P(Y,"^",2)="PROVIDER,OTHER"!($P(Y,"^",2)="PROVIDER,OUTSIDE") D GENERIC
"RTN","PSODIR",32,0)
 I $P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",7),$P(^("PS"),"^",8) D COSIGN
"RTN","PSODIR",33,0)
 I $G(PSODIR("COSIGNING PROVIDER")),'$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",7) K PSODIR("COSIGNING PROVIDER")
"RTN","PSODIR",34,0)
PROVX K X,Y
"RTN","PSODIR",35,0)
 Q
"RTN","PSODIR",36,0)
 ;
"RTN","PSODIR",37,0)
GENERIC ;
"RTN","PSODIR",38,0)
 K DIR,DIC,PSODIR("GENERIC PROVIDER")
"RTN","PSODIR",39,0)
 S DIR(0)="52,30"
"RTN","PSODIR",40,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") GENERICX
"RTN","PSODIR",41,0)
 S PSODIR("GENERIC PROVIDER")=Y
"RTN","PSODIR",42,0)
GENERICX K X,Y
"RTN","PSODIR",43,0)
 Q
"RTN","PSODIR",44,0)
 ;
"RTN","PSODIR",45,0)
COSIGN ;
"RTN","PSODIR",46,0)
 K DIC
"RTN","PSODIR",47,0)
 I '$G(PSODIR("COSIGNING PROVIDER")),$P($G(RX3),"^",3) S PSODIR("COSIGNING PROVIDER")=$P(RX3,"^",3) G COSIGN1
"RTN","PSODIR",48,0)
 I $P($G(RX3),"^",3),$P($G(RX3),"^",3)'=$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",8) D
"RTN","PSODIR",49,0)
 .W !!,"Previous Co-Signing Provider: "_$P(^VA(200,$P(RX3,"^",3),0),"^")
"RTN","PSODIR",50,0)
 .S PSODIR("COSIGNING PROVIDER")=$S($P(RX3,"^",3)'=PSODIR("COSIGNING PROVIDER"):PSODIR("COSIGNING PROVIDER"),1:$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",8))
"RTN","PSODIR",51,0)
COSIGN1 S DIC(0)="QEAM",DIC="^VA(200,",DIC("B")=$S($G(PSODIR("COSIGNING PROVIDER")):$P(^VA(200,PSODIR("COSIGNING PROVIDER"),0),"^"),1:$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",8))
"RTN","PSODIR",52,0)
 S DIC("S")="I $D(^(""PS"")),$P(^(""PS""),""^""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)'<DT)"
"RTN","PSODIR",53,0)
 S DIC("W")="W ""     "",$P(^(""PS""),""^"",9)",DIC("S")=DIC("S")_",'$P(^(""PS""),""^"",7)"
"RTN","PSODIR",54,0)
 S DIC("A")="COSIGNING PROVIDER: " D ^DIC K DIC
"RTN","PSODIR",55,0)
 I $D(DTOUT)!$D(DUOUT) S PSODIR("DFLG")=1 G COSIGNX
"RTN","PSODIR",56,0)
 S:+Y>0 PSODIR("COSIGNING PROVIDER")=+Y G:Y<0 COSIGN
"RTN","PSODIR",57,0)
COSIGNX K X,Y
"RTN","PSODIR",58,0)
 Q
"RTN","PSODIR",59,0)
DOSE(PSODIR) ;add dosing info
"RTN","PSODIR",60,0)
 D DOSE1^PSOORED5(.PSODIR)
"RTN","PSODIR",61,0)
EX K PSODOSE,PSOSCH,DOSE,DOOR,SCH,VERB,NOUN,DOSEOR,ENT,PSORTE,DRUA,DIR,X,Y,DIRUT,RTE,ERTE,DD,INS1,SINS1
"RTN","PSODIR",62,0)
 Q
"RTN","PSODIR",63,0)
INS(PSODIR) ;patient instructions
"RTN","PSODIR",64,0)
 N DA K INS1,DD,DIR,DIRUT S D=0 F  S D=$O(PSODIR("SIG",D)) Q:'D  S DD=$G(DD)+1
"RTN","PSODIR",65,0)
 I $G(DD)=1 S PSODIR("INS")=$G(PSODIR("SIG",1)) G INSD
"RTN","PSODIR",66,0)
 I ($G(PSOINSFL)=1&($G(DD)>1))!($G(PSOFDR)&($G(ORD))&($P($G(^PS(52.41,+$G(ORD),"EXT")),"^")'="")&($G(DD)>1)) D  G EX
"RTN","PSODIR",67,0)
 .K ^TMP($J) S D=0 F  S D=$O(PSODIR("SIG",D)) Q:'D  S ^TMP($J,"SIG",D,0)=PSODIR("SIG",D)
"RTN","PSODIR",68,0)
 .S DWPK=2,DWLW=80,DIC="^TMP($J,""SIG""," D EN^DIWE K PSODIR("SIG")
"RTN","PSODIR",69,0)
 .S D=0 F  S D=$O(^TMP($J,"SIG",D)) Q:'D  S PSODIR("SIG",D)=^TMP($J,"SIG",D,0)
"RTN","PSODIR",70,0)
 .D EN^PSOFSIG(.PSODIR,1) K DWLW,D,DWPK,^TMP($J)
"RTN","PSODIR",71,0)
 I $G(PSOINSFL)=0 G INSD
"RTN","PSODIR",72,0)
 I $G(PSOFDR),$G(ORD),$P($G(^PS(52.41,+$G(ORD),"EXT")),"^")'="" G INSD
"RTN","PSODIR",73,0)
 I $G(PSODIR("INS"))']"",$G(^PS(50.7,PSODRUG("OI"),"INS"))]"" S DIR("B")=^PS(50.7,PSODRUG("OI"),"INS")
"RTN","PSODIR",74,0)
INSD S DIR(0)="52,114" S:$G(PSODIR("INS"))]"" DIR("B")=PSODIR("INS")
"RTN","PSODIR",75,0)
 D DIR G:$G(PSODIR("DFLG"))!(PSODIR("FIELD")) EX
"RTN","PSODIR",76,0)
 I X'="",X'="@" S PSODIR("INS")=Y D SIG^PSOHELP G INSD:'$D(X)
"RTN","PSODIR",77,0)
 I $G(INS1)]"" D EN^DDIOL($E(INS1,2,9999999)) S (PSODIR("SIG",1),PSODIR("SIG"))=$E(INS1,2,9999999)
"RTN","PSODIR",78,0)
 I X="@" K PSODIR("INS"),PSODIR("SIG")
"RTN","PSODIR",79,0)
 D EN^PSOFSIG(.PSODIR,1) I $O(SIG(0)) S SIGOK=1
"RTN","PSODIR",80,0)
 G EX
"RTN","PSODIR",81,0)
 Q
"RTN","PSODIR",82,0)
SINS(PSODIR) ;other lang. patient instructions
"RTN","PSODIR",83,0)
 K SINS1,DIR
"RTN","PSODIR",84,0)
 S DIR(0)="52,114.1" S:$G(PSODIR("SINS"))]"" DIR("B")=PSODIR("SINS")
"RTN","PSODIR",85,0)
 I $G(PSODIR("SINS"))']"",$G(^PS(50.7,PSODRUG("OI"),"INS1"))]"" S DIR("B")=^PS(50.7,PSODRUG("OI"),"INS1")
"RTN","PSODIR",86,0)
 D DIR G:$G(PSODIR("DFLG")) EX
"RTN","PSODIR",87,0)
 I X'="",X'="@" S PSODIR("SINS")=Y D SSIG^PSOHELP
"RTN","PSODIR",88,0)
 I $G(SINS1)]"" D EN^DDIOL($E(SINS1,2,9999999)) S PSODIR("SINS")=$E(SINS1,2,9999999)
"RTN","PSODIR",89,0)
 I X="@" K PSODIR("SINS")
"RTN","PSODIR",90,0)
 G EX
"RTN","PSODIR",91,0)
 Q
"RTN","PSODIR",92,0)
 ;
"RTN","PSODIR",93,0)
DIR ;
"RTN","PSODIR",94,0)
 S PSODIR("FIELD")=0
"RTN","PSODIR",95,0)
 G:$G(DIR(0))']"" DIRX
"RTN","PSODIR",96,0)
 D ^DIR K DIR,DIE,DIC,DA
"RTN","PSODIR",97,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)),$L($G(X))'>1 S PSODIR("DFLG")=1 G DIRX
"RTN","PSODIR",98,0)
 I X[U,$L(X)>1 D:'$G(PSOEDIT) JUMP
"RTN","PSODIR",99,0)
DIRX K DIRUT,DTOUT,DUOUT,DIROUT,PSOX
"RTN","PSODIR",100,0)
 Q
"RTN","PSODIR",101,0)
 ;
"RTN","PSODIR",102,0)
JUMP ;
"RTN","PSODIR",103,0)
 I $G(PSOEDIT)!($G(OR0)) S PSODIR("DFLG")=1 Q
"RTN","PSODIR",104,0)
 S X=$P(X,"^",2),DIC="^DD(52,",DIC(0)="QM" D ^DIC K DIC
"RTN","PSODIR",105,0)
 I Y=-1 S PSODIR("FIELD")=$G(PSODIR("FLD")) G JUMPX
"RTN","PSODIR",106,0)
 I $G(PSONEW1)=0 D JUMP^PSONEW1 G JUMPX
"RTN","PSODIR",107,0)
 I $G(PSOREF1)=0 D JUMP^PSOREF1 G JUMPX
"RTN","PSODIR",108,0)
 I $G(PSONEW3)=0 D JUMP^PSONEW3 G JUMPX
"RTN","PSODIR",109,0)
 I $G(PSORENW3)=0 D JUMP^PSORENW3 G JUMPX
"RTN","PSODIR",110,0)
JUMPX S X="^"_X
"RTN","PSODIR",111,0)
 Q
"RTN","PSOTALK")
0^2^B76664087
"RTN","PSOTALK",1,0)
PSOTALK ;BIR/EJW - SCRIPTALK INTERFACE FROM VISTA ;04/18/2003
"RTN","PSOTALK",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**135,182,211**;DEC 1997
"RTN","PSOTALK",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOTALK",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOTALK",5,0)
 ;ROB SILVERMAN-HINES DEVELOPED ORIGINAL VISTA CUSTOM SOFTWARE FOR SCRIPTALK
"RTN","PSOTALK",6,0)
EN Q:'$$PAT55  ; QUIT IF NOT A SCRIPTALK ELIGIBLE PATIENT
"RTN","PSOTALK",7,0)
 S PSOSTALK=1
"RTN","PSOTALK",8,0)
 N PHONE,RXNUM,RXALPHA,DATE,EDATE,RFILLS,PTNAME,SIG,SIGX,PROV,DRUG,WARN,LINE
"RTN","PSOTALK",9,0)
 D GATHER,TRANS,CLEAN
"RTN","PSOTALK",10,0)
 Q
"RTN","PSOTALK",11,0)
 ;
"RTN","PSOTALK",12,0)
CLEAN K PHONE,RXNUM,RXALPHA,DATE,EDATE,RFILLS,PTNAME,SIG,SIGX,PROV,DRUG,WARN,VADM
"RTN","PSOTALK",13,0)
 K PSOCTP,PSOCTV,XMIT,PSORCT,PSOTSSN,PSOEXPDT
"RTN","PSOTALK",14,0)
 K PSOLNE,PSOLEN,PSOLINE,PSOWORD,PSOWDS,LINE
"RTN","PSOTALK",15,0)
 K PSOSIG1,PSOLSIG,PSOSIG,PSOSTOP
"RTN","PSOTALK",16,0)
 Q
"RTN","PSOTALK",17,0)
BARE N RX
"RTN","PSOTALK",18,0)
 D CLEAN
"RTN","PSOTALK",19,0)
 W ! S DIC="^PSRX(",DIC(0)="AEQM" D ^DIC K DIC Q:Y<0  S RX=+Y
"RTN","PSOTALK",20,0)
 D:'$D(PSOPAR) ^PSOLSET
"RTN","PSOTALK",21,0)
 I '$$PAT55 W !,"Patient not enrolled in ScripTalk program." G BAREO
"RTN","PSOTALK",22,0)
 I $P(^PSRX(RX,"STA"),"^")'=0 W !,"Prescription not ACTIVE" G BAREO
"RTN","PSOTALK",23,0)
 D GATHER
"RTN","PSOTALK",24,0)
 W !!,"  Queuing ScripTalk label"
"RTN","PSOTALK",25,0)
 D TRANS
"RTN","PSOTALK",26,0)
BAREO D CLEAN
"RTN","PSOTALK",27,0)
 W !!
"RTN","PSOTALK",28,0)
 G BARE
"RTN","PSOTALK",29,0)
 Q
"RTN","PSOTALK",30,0)
BARI N RX
"RTN","PSOTALK",31,0)
 D CLEAN
"RTN","PSOTALK",32,0)
 S RX=$$READER^PSOTALK1("FO^1:12","Enter Barcode Rx#")
"RTN","PSOTALK",33,0)
 Q:RX']""
"RTN","PSOTALK",34,0)
 G:RX'["-" BARIO
"RTN","PSOTALK",35,0)
 S RX=$P(RX,"-",2)
"RTN","PSOTALK",36,0)
 I '$D(^PSRX(RX,0)) W !,"Prescription not on file" G BARIO
"RTN","PSOTALK",37,0)
 I '$$PAT55 W !,"Patient not enrolled in ScripTalk program." G BARIO
"RTN","PSOTALK",38,0)
 I $P(^PSRX(RX,"STA"),"^")'=0 W !,"Prescription not ACTIVE" G BARIO
"RTN","PSOTALK",39,0)
 D:'$D(PSOPAR) ^PSOLSET
"RTN","PSOTALK",40,0)
 D GATHER
"RTN","PSOTALK",41,0)
 W !!,"  Queuing ScripTalk label"
"RTN","PSOTALK",42,0)
 D TRANS
"RTN","PSOTALK",43,0)
BARIO D CLEAN
"RTN","PSOTALK",44,0)
 W !!
"RTN","PSOTALK",45,0)
 G BARI
"RTN","PSOTALK",46,0)
 Q
"RTN","PSOTALK",47,0)
GATHER ;
"RTN","PSOTALK",48,0)
 N DFN
"RTN","PSOTALK",49,0)
 S DFN=$P(^PSRX(RX,0),"^",2)
"RTN","PSOTALK",50,0)
 D DEM^VADPT
"RTN","PSOTALK",51,0)
 S PHONE=$$PHONE
"RTN","PSOTALK",52,0)
 S RXNUM=+$$RXNUM
"RTN","PSOTALK",53,0)
 S RXALPHA=$$RXALPHA
"RTN","PSOTALK",54,0)
 S DATE=$$DATE
"RTN","PSOTALK",55,0)
 S FILLS=$$RFILLS I $L(RFILLS)=1 S FILLS="0"_FILLS
"RTN","PSOTALK",56,0)
 S PTNAME=VADM(1) D
"RTN","PSOTALK",57,0)
 .N FNAM,MI
"RTN","PSOTALK",58,0)
 .S FNAM=$P(PTNAME,",",2) I FNAM[" " D
"RTN","PSOTALK",59,0)
 ..S MI=$P(FNAM," ",2,99) I MI[" " S MI=$P(MI," ")
"RTN","PSOTALK",60,0)
 ..S FNAM=$P(FNAM," ")
"RTN","PSOTALK",61,0)
 .S PTNAME=FNAM_$S($G(MI)'="":" "_MI,1:"")_" "_$P(PTNAME,",")
"RTN","PSOTALK",62,0)
 .S PTNAME=$$UP^XLFSTR(PTNAME)
"RTN","PSOTALK",63,0)
 .S PTNAME=$TR(PTNAME,"-"," ")
"RTN","PSOTALK",64,0)
 .S PTNAME=$TR(PTNAME,".","")
"RTN","PSOTALK",65,0)
 .S PTNAME=$TR(PTNAME,"'"," ")
"RTN","PSOTALK",66,0)
 S SIG=$TR($$UP^XLFSTR($$SIGPOE),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",67,0)
 S SIGX=$TR($$UP^XLFSTR($$SIGPOEX),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",68,0)
 S PROV=$E($$UP^XLFSTR($$PROV),1,30)
"RTN","PSOTALK",69,0)
 S DRUG=$TR($$UP^XLFSTR($$DRUG),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",70,0)
 S WARN=$$WARN
"RTN","PSOTALK",71,0)
 D PSOEXP
"RTN","PSOTALK",72,0)
 S LINE(1)="VAMC "_$$CITY_", "_$$STATE_"  "_$$ZIP
"RTN","PSOTALK",73,0)
 S LINE(2)=$$SITE_" ("_$$CLERK_"/"_$$VRPH_") "_$$ACODE_"-"_$$EPHON_" Exp: "_PSOEXPDT
"RTN","PSOTALK",74,0)
 S LINE(3)="Rx# "_$$RXNUM_"  "_$$EDATE_"  Fill "_$$FILNO_" of "_$$TFILLS
"RTN","PSOTALK",75,0)
 S LINE(4)=$$EPAT_"  "_$$LAST6
"RTN","PSOTALK",76,0)
 D INST^PSOTALK1 S LINE(5)=$G(PSOLNE(1)),LINE(6)=$G(PSOLNE(2)),LINE(7)=$G(PSOLNE(3))
"RTN","PSOTALK",77,0)
 S LINE(8)=$$EPROV,LINE(10)=$$DRUG
"RTN","PSOTALK",78,0)
 S LINE(9)="Qty: "_$$QTY_"  "_$$DF
"RTN","PSOTALK",79,0)
 Q
"RTN","PSOTALK",80,0)
TRANS S ZTIO="`"_$P($G(^PS(59,PSOSITE,"STALK")),U),ZTDTH=$$NOW^XLFDT,ZTDESC="Scriptalk Interface Transmission"  ; CHANGE DEVICE TO BE DIVISIONAL BY FILE 59 RMS/HINES 6-5-01
"RTN","PSOTALK",81,0)
 Q:ZTIO="`"
"RTN","PSOTALK",82,0)
 S ZTRTN="GO^PSOTALK",ZTSAVE("*")=""
"RTN","PSOTALK",83,0)
 D ^%ZTLOAD
"RTN","PSOTALK",84,0)
 Q
"RTN","PSOTALK",85,0)
 ;
"RTN","PSOTALK",86,0)
GO W !,"^XA",!,"^FO250,700^XGE:RX.GRF^FS"  ;;1.2e 4-17-02 TO MOVE GRAPHIC
"RTN","PSOTALK",87,0)
 D OVERLAY,PICOTAG  ;;FOR LARGER LABELS
"RTN","PSOTALK",88,0)
 W !,"^PQ1,0,1,Y",!,"^XZ"  ;;FOR LARGER LABELS
"RTN","PSOTALK",89,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTALK",90,0)
 Q
"RTN","PSOTALK",91,0)
 ;
"RTN","PSOTALK",92,0)
OVERLAY F PSOLINE=1:1:7 D DEFLINE((9+((20-PSOLINE)*28)),50,LINE(PSOLINE),PSOLINE,0)
"RTN","PSOTALK",93,0)
 F PSOLINE=8:1:10 D DEFLINE((9+((19-PSOLINE)*28)),50,LINE(PSOLINE),PSOLINE,0)
"RTN","PSOTALK",94,0)
 Q
"RTN","PSOTALK",95,0)
 ;
"RTN","PSOTALK",96,0)
DEFLINE(XCORD,YCORD,PRTOUT,FIELDNO,OFFSET) ;
"RTN","PSOTALK",97,0)
 W !,"^AFR,20,10^FO"_XCORD_","_YCORD_"^FR^CI0^FD"_PRTOUT_"^FS"
"RTN","PSOTALK",98,0)
 Q
"RTN","PSOTALK",99,0)
 ;
"RTN","PSOTALK",100,0)
PICOTAG S PSOCTP=1
"RTN","PSOTALK",101,0)
 S DRUG=$E(DRUG,1,39)  ;1.2c*1 TEMPORARY FIX FOR DRUG TRUNCATE AT 39
"RTN","PSOTALK",102,0)
 F XMIT=PTNAME,DRUG,SIGX,DATE,FILLS,WARN,PROV,PHONE,RXNUM,RXALPHA D XMITP
"RTN","PSOTALK",103,0)
 Q
"RTN","PSOTALK",104,0)
 ;
"RTN","PSOTALK",105,0)
XMITP W !,"^RX"_$S(PSOCTP<10:"0",1:"")_PSOCTP_","_XMIT_"^FS"
"RTN","PSOTALK",106,0)
 S PSOCTP=PSOCTP+1
"RTN","PSOTALK",107,0)
 Q
"RTN","PSOTALK",108,0)
ID() I $$PAT55 Q "+SCRIPTALK"
"RTN","PSOTALK",109,0)
 E  Q ""
"RTN","PSOTALK",110,0)
AUTO ;;v1.2c - LABEL REPRINTING FUNCTIONS 3-12-02
"RTN","PSOTALK",111,0)
 Q:$G(PSOTREP)  ;NO AUTO-PRINT DURING REGULAR NON-VOIDED LABEL REPRINT
"RTN","PSOTALK",112,0)
 I $P($G(^PS(59,+PSOSITE,"STALK")),U,2)="A" D EN
"RTN","PSOTALK",113,0)
 Q
"RTN","PSOTALK",114,0)
 ;
"RTN","PSOTALK",115,0)
PAT55() Q +$G(^PS(55,"ASTALK",$P(^PSRX(RX,0),"^",2)))  ;IS PATIENT ENROLLED (NEW FIELD POSITION 2-12-02 RMS UPDATE v1.2b)
"RTN","PSOTALK",116,0)
PHONE() ;changes below 1.2c*1 to swap to site signed-on vs. site from Rx
"RTN","PSOTALK",117,0)
 Q $E($P(^PS(59,+PSOSITE,0),"^",3),1,3)_$E($TR($P(^PS(59,+PSOSITE,0),"^",4),"-,",""),1,7) ; RX DIVISION PHONE NUMBER
"RTN","PSOTALK",118,0)
CITY() Q $P(^PS(59,+PSOSITE,0),"^",7)
"RTN","PSOTALK",119,0)
STATE() Q $P(^DIC(5,$P(^PS(59,+PSOSITE,0),"^",8),0),"^",2)
"RTN","PSOTALK",120,0)
ZIP() Q $P(^PS(59,+PSOSITE,0),"^",5)
"RTN","PSOTALK",121,0)
SITE() Q $P(^PS(59,+PSOSITE,0),"^",6)
"RTN","PSOTALK",122,0)
ACODE() Q $P(^PS(59,+PSOSITE,0),"^",3)
"RTN","PSOTALK",123,0)
EPHON() Q $P(^PS(59,+PSOSITE,0),"^",4)
"RTN","PSOTALK",124,0)
CLERK() Q $P($G(^PSRX(RX,"OR1")),"^",5)
"RTN","PSOTALK",125,0)
PSOEXP ;
"RTN","PSOTALK",126,0)
 N X1,X2,X S X1=DT,X2=365 D C^%DTC S PSOEXPDT=X
"RTN","PSOTALK",127,0)
 S PSOEXPDT=$E(PSOEXPDT,4,5)_"/"_$E(PSOEXPDT,6,7)_"/"_$E(PSOEXPDT,2,3)
"RTN","PSOTALK",128,0)
 Q
"RTN","PSOTALK",129,0)
VRPH() Q $P($G(^PSRX(RX,2)),"^",10)
"RTN","PSOTALK",130,0)
RXNUM() Q $P(^PSRX(RX,0),"^",1) ;RETURN RX EXTERNAL NUMBER
"RTN","PSOTALK",131,0)
RXALPHA() ;RETURN RENEWAL LETTER OR SPACE CHARACTER
"RTN","PSOTALK",132,0)
 N RXALPHA
"RTN","PSOTALK",133,0)
 S RXALPHA=$E($P(^PSRX(RX,0),"^",1),$L($P(^PSRX(RX,0),"^",1)))
"RTN","PSOTALK",134,0)
 Q $S(RXALPHA?1A:RXALPHA,1:" ")
"RTN","PSOTALK",135,0)
DATE() ;CHANGED 7-30-01 TO USE EDATE FORMAT ALSO WHEN SPEAKING
"RTN","PSOTALK",136,0)
 S EDATE=$P(^PSRX(RX,3),"^")
"RTN","PSOTALK",137,0)
 Q $E(EDATE,4,5)_$E(EDATE,6,7)_$E(EDATE,2,3)
"RTN","PSOTALK",138,0)
EDATE() Q $$FMTE^XLFDT($P(^PSRX(RX,3),"^"))  ; EXTERNAL DATE / LAST DISPENSED
"RTN","PSOTALK",139,0)
FILLS() Q $G(RXF)+1 ; FILL COUNT
"RTN","PSOTALK",140,0)
TFILLS() Q $P(^PSRX(RX,0),"^",9)+1 ; TOTAL FILLS
"RTN","PSOTALK",141,0)
RFILLS() ;NEW REFILLS REMAINING METHOD 9-21-00, BASED ON PTST+5^PSORXVW
"RTN","PSOTALK",142,0)
 S RFILLS=$P(^PSRX(RX,0),"^",9),PSORCT=0 F  S PSORCT=$O(^PSRX(RX,1,PSORCT)) Q:'PSORCT  S RFILLS=RFILLS-1
"RTN","PSOTALK",143,0)
 Q RFILLS
"RTN","PSOTALK",144,0)
FILNO() Q $$TFILLS-$$RFILLS
"RTN","PSOTALK",145,0)
EPAT() Q $P(^DPT($P(^PSRX(RX,0),"^",2),0),"^") ; EXTERNAL PATIENT NAME
"RTN","PSOTALK",146,0)
LAST6() S PSOTSSN=$P(^DPT($P(^PSRX(RX,0),"^",2),0),"^",9)  ; LAST 6 OF SSN
"RTN","PSOTALK",147,0)
 Q $E(PSOTSSN,4,5)_"-"_$E(PSOTSSN,6,9)
"RTN","PSOTALK",148,0)
SIG() ;THIS SUBROUTINE WILL BE ABANDONED IF SIGPOE WORKS v1.2c 3-13-02
"RTN","PSOTALK",149,0)
 I $L($P(^PSRX(RX,"SIG"),"^",1))=0 Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG1",1,0),"^",1)),1,196)
"RTN","PSOTALK",150,0)
 E  Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG"),"^",1)),1,196) ; SIG -- NEEDS TO BE EXPANDED
"RTN","PSOTALK",151,0)
SIGPOE() ;v1.2c - NEW SUBROUTINE TO GIVE MESSAGE FOR LONG SIGS FOR THE HUMAN READABLE PORTION
"RTN","PSOTALK",152,0)
 S PSOSIG=""
"RTN","PSOTALK",153,0)
 I $P($G(^PS(55,DFN,"LAN")),"^",1) D  G SIGPOEE
"RTN","PSOTALK",154,0)
 .S PSOSIG=" " ; PUT SPACE ON FRONT OF SIG (GETS STRIPPED OFF LATER)
"RTN","PSOTALK",155,0)
 .D OTHL1^PSOLBL3(RX) I $O(SIG2(0))="" Q
"RTN","PSOTALK",156,0)
 .N XX,X
"RTN","PSOTALK",157,0)
 .;PSO*7*211;MODIFIED TO REPLACE SIG IF >138 INSTEAD OF 196
"RTN","PSOTALK",158,0)
 .S XX=0 F  S XX=$O(SIG2(XX)) Q:'XX  S X=SIG2(XX) I X'="" S PSOSIG=PSOSIG_X_" " I $L(PSOSIG)>138 D  Q
"RTN","PSOTALK",159,0)
 ..S PSOSIG=" INDICACIONES MUY LARGAS. IMPRIMA UNA ETIQUETA DE VISTA VALIDA Y APLIQUELA SOBRE ESTA ETIQUETA DE SCRIPTALK EN LA BOTELLA."
"RTN","PSOTALK",160,0)
 E  D  ;
"RTN","PSOTALK",161,0)
 . N PSOSEQ
"RTN","PSOTALK",162,0)
 . S PSOSTOP=0,PSOSIG=""
"RTN","PSOTALK",163,0)
 . S PSOLSIG=" SIG IS TOO LONG. REPRINT A NON-VOIDED VISTA LABEL AND PLACE OVER THIS SCRIPTALK LABEL"
"RTN","PSOTALK",164,0)
 . S PSOSEQ=0 F  S PSOSEQ=$O(^PSRX(RX,"SIG1",PSOSEQ)) Q:PSOSEQ'=+PSOSEQ!($G(PSOSTOP))  D  ;
"RTN","PSOTALK",165,0)
 .. S PSOSIG1=$G(^PSRX(RX,"SIG1",PSOSEQ,0))
"RTN","PSOTALK",166,0)
 ..;PSO*7*211;MODIFIED TO REPLACE SIG IF >138 INSTEAD OF 196
"RTN","PSOTALK",167,0)
 .. I $L(PSOSIG)+$L($G(^PSRX(RX,"SIG1",PSOSEQ,0)))>138 S PSOSIG=PSOLSIG,PSOSTOP=1 Q  ;
"RTN","PSOTALK",168,0)
 .. S PSOSIG=$G(PSOSIG)_" "_PSOSIG1
"RTN","PSOTALK",169,0)
SIGPOEE Q $E(PSOSIG,2,197)
"RTN","PSOTALK",170,0)
 ;
"RTN","PSOTALK",171,0)
SIGPOEX() ;v1.2c - NEW SUBROUTINE TO GIVE MESSAGE FOR LONG SIGS FOR THE READ ALOUD PORTION
"RTN","PSOTALK",172,0)
 S PSOSIG=""
"RTN","PSOTALK",173,0)
 I $P($G(^PS(55,DFN,"LAN")),"^",1) D  G SIGPOEEX
"RTN","PSOTALK",174,0)
 .S PSOSIG=" " ; PUT SPACE ON FRONT OF SIG (GETS STRIPPED OFF LATER)
"RTN","PSOTALK",175,0)
 .D OTHL1^PSOLBL3(RX) I $O(SIG2(0))="" Q
"RTN","PSOTALK",176,0)
 .N XX,X
"RTN","PSOTALK",177,0)
 .S XX=0 F  S XX=$O(SIG2(XX)) Q:'XX  S X=SIG2(XX) I X'="" S PSOSIG=PSOSIG_X_" " I $L(PSOSIG)>196 D  Q
"RTN","PSOTALK",178,0)
 ..S PSOSIG=" LAS INSTRUCCIONES DE ESTA RECETA SON MUY LARGAS.  POR FAVOR SOLICITE A SU CUIDADOR QUE LE LEA LAS INSTRUCCIONES IMPRESAS EN EL ROTULO O COMUNIQUESE CON SU MEDICO PARA INSTRUCCIONES COMPLETAS."
"RTN","PSOTALK",179,0)
 I $L($P(^PSRX(RX,"SIG"),"^",1))'=0 Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG"),"^",1)),1,196)
"RTN","PSOTALK",180,0)
 E  D  ;
"RTN","PSOTALK",181,0)
 . N PSOSEQ
"RTN","PSOTALK",182,0)
 . S PSOSTOP=0,PSOSIG=""
"RTN","PSOTALK",183,0)
 . S PSOLSIG=" THE INSTRUCTIONS FOR THIS PRESCRIPTION ARE TOO LONG. PLEASE HAVE A CAREGIVER READ THE PRINTED LABEL OR CONTACT YOUR PHYSICIAN FOR COMPLETE INSTRUCTIONS."
"RTN","PSOTALK",184,0)
 . S PSOSEQ=0 F  S PSOSEQ=$O(^PSRX(RX,"SIG1",PSOSEQ)) Q:PSOSEQ'=+PSOSEQ!($G(PSOSTOP))  D  ;
"RTN","PSOTALK",185,0)
 .. S PSOSIG1=$G(^PSRX(RX,"SIG1",PSOSEQ,0))
"RTN","PSOTALK",186,0)
 .. I $L(PSOSIG)+$L($G(^PSRX(RX,"SIG1",PSOSEQ,0)))>196 S PSOSIG=PSOLSIG,PSOSTOP=1 Q  ;
"RTN","PSOTALK",187,0)
 .. S PSOSIG=$G(PSOSIG)_" "_PSOSIG1
"RTN","PSOTALK",188,0)
SIGPOEEX Q $E(PSOSIG,2,197)
"RTN","PSOTALK",189,0)
PROV() ;PROVIDER NAME
"RTN","PSOTALK",190,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(^PSRX(RX,0),"^",4) D ^DIC S PSOPHYS=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") K DIC,X,Y
"RTN","PSOTALK",191,0)
 Q $P($$NAMEFMT^XLFNAME(PSOPHYS)," MD")
"RTN","PSOTALK",192,0)
EPROV() ;
"RTN","PSOTALK",193,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(^PSRX(RX,0),"^",4) D ^DIC S PSOPHYS=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") K DIC,X,Y
"RTN","PSOTALK",194,0)
 Q PSOPHYS
"RTN","PSOTALK",195,0)
QTY() Q $S($G(RXP):$P(RXP,"^",4),1:$P(^PSRX(RX,0),"^",7))
"RTN","PSOTALK",196,0)
DF() Q $P(^PSDRUG($P(^PSRX(RX,0),"^",6),660),"^",8)
"RTN","PSOTALK",197,0)
DRUG() Q $P(^PSDRUG($P(^PSRX(RX,0),"^",6),0),"^",1) ; DRUG NAME
"RTN","PSOTALK",198,0)
WARN() N WARN,NWARN,IWARN,XWARN ; 1-28-02 UPDATE v1.2a TO ELIMINATE LOCAL CODES
"RTN","PSOTALK",199,0)
 S WARN=$P(^PSDRUG($P(^PSRX(RX,0),"^",6),0),"^",8) ; WARNING LABEL CODES
"RTN","PSOTALK",200,0)
 F NWARN=1:1:3 S IWARN=$P(WARN,",",NWARN) S:IWARN>20 IWARN="" S:$L(IWARN)=1 IWARN="0"_IWARN S:$L(IWARN)=0 IWARN="00" S XWARN=$G(XWARN)_IWARN
"RTN","PSOTALK",201,0)
 Q XWARN
"VER")
8.0^22.0
"BLD",6242,6)
^SEQ #195
**END**
**END**
