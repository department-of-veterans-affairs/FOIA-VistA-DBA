Released GMRC*3*47 SEQ #48
Extracted from mail message
**KIDS**:GMRC*3.0*47^

**INSTALL NAME**
GMRC*3.0*47
"BLD",6294,0)
GMRC*3.0*47^CONSULT/REQUEST TRACKING^0^3051219^y
"BLD",6294,1,0)
^^3^3^3050721^
"BLD",6294,1,1,0)
This patch corrects Consult alerts being sent to users who do not wish to 
"BLD",6294,1,2,0)
receive them, missing Consult alerts and invalid data displaying on 
"BLD",6294,1,3,0)
alerts.
"BLD",6294,4,0)
^9.64PA^^
"BLD",6294,"KRN",0)
^9.67PA^8989.52^19
"BLD",6294,"KRN",.4,0)
.4
"BLD",6294,"KRN",.401,0)
.401
"BLD",6294,"KRN",.402,0)
.402
"BLD",6294,"KRN",.403,0)
.403
"BLD",6294,"KRN",.5,0)
.5
"BLD",6294,"KRN",.84,0)
.84
"BLD",6294,"KRN",3.6,0)
3.6
"BLD",6294,"KRN",3.8,0)
3.8
"BLD",6294,"KRN",9.2,0)
9.2
"BLD",6294,"KRN",9.8,0)
9.8
"BLD",6294,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",6294,"KRN",9.8,"NM",1,0)
GMRCACMT^^0^B27403592
"BLD",6294,"KRN",9.8,"NM",2,0)
GMRCADC^^0^B13804624
"BLD",6294,"KRN",9.8,"NM",3,0)
GMRCEDIT^^0^B11706918
"BLD",6294,"KRN",9.8,"NM",4,0)
GMRCEDT1^^0^B45730491
"BLD",6294,"KRN",9.8,"NM",5,0)
GMRCIACT^^0^B58670458
"BLD",6294,"KRN",9.8,"NM",6,0)
GMRCMED^^0^B35624524
"BLD",6294,"KRN",9.8,"NM","B","GMRCACMT",1)

"BLD",6294,"KRN",9.8,"NM","B","GMRCADC",2)

"BLD",6294,"KRN",9.8,"NM","B","GMRCEDIT",3)

"BLD",6294,"KRN",9.8,"NM","B","GMRCEDT1",4)

"BLD",6294,"KRN",9.8,"NM","B","GMRCIACT",5)

"BLD",6294,"KRN",9.8,"NM","B","GMRCMED",6)

"BLD",6294,"KRN",19,0)
19
"BLD",6294,"KRN",19.1,0)
19.1
"BLD",6294,"KRN",101,0)
101
"BLD",6294,"KRN",409.61,0)
409.61
"BLD",6294,"KRN",771,0)
771
"BLD",6294,"KRN",870,0)
870
"BLD",6294,"KRN",8989.51,0)
8989.51
"BLD",6294,"KRN",8989.52,0)
8989.52
"BLD",6294,"KRN",8994,0)
8994
"BLD",6294,"KRN","B",.4,.4)

"BLD",6294,"KRN","B",.401,.401)

"BLD",6294,"KRN","B",.402,.402)

"BLD",6294,"KRN","B",.403,.403)

"BLD",6294,"KRN","B",.5,.5)

"BLD",6294,"KRN","B",.84,.84)

"BLD",6294,"KRN","B",3.6,3.6)

"BLD",6294,"KRN","B",3.8,3.8)

"BLD",6294,"KRN","B",9.2,9.2)

"BLD",6294,"KRN","B",9.8,9.8)

"BLD",6294,"KRN","B",19,19)

"BLD",6294,"KRN","B",19.1,19.1)

"BLD",6294,"KRN","B",101,101)

"BLD",6294,"KRN","B",409.61,409.61)

"BLD",6294,"KRN","B",771,771)

"BLD",6294,"KRN","B",870,870)

"BLD",6294,"KRN","B",8989.51,8989.51)

"BLD",6294,"KRN","B",8989.52,8989.52)

"BLD",6294,"KRN","B",8994,8994)

"BLD",6294,"QUES",0)
^9.62^^
"BLD",6294,"REQB",0)
^9.611^2^2
"BLD",6294,"REQB",1,0)
GMRC*3.0*33^1
"BLD",6294,"REQB",2,0)
GMRC*3.0*39^1
"BLD",6294,"REQB","B","GMRC*3.0*33",1)

"BLD",6294,"REQB","B","GMRC*3.0*39",2)

"MBREQ")
0
"PKG",222,-1)
1^1
"PKG",222,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",222,22,0)
^9.49I^1^1
"PKG",222,22,1,0)
3.0^2980101^2990325^66481
"PKG",222,22,1,"PAH",1,0)
47^3051219
"PKG",222,22,1,"PAH",1,1,0)
^^3^3^3051219
"PKG",222,22,1,"PAH",1,1,1,0)
This patch corrects Consult alerts being sent to users who do not wish to 
"PKG",222,22,1,"PAH",1,1,2,0)
receive them, missing Consult alerts and invalid data displaying on 
"PKG",222,22,1,"PAH",1,1,3,0)
alerts.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","GMRCACMT")
0^1^B27403592^B27403570
"RTN","GMRCACMT",1,0)
GMRCACMT ;SLC/DLT,DCM,MA,JFR - Comment Action and alerting ;8/19/03 07:27
"RTN","GMRCACMT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,14,18,20,22,29,35,47**;DEC 27, 1997
"RTN","GMRCACMT",3,0)
 ; This routine invokes IA #10060
"RTN","GMRCACMT",4,0)
 ;
"RTN","GMRCACMT",5,0)
COMMENT(GMRCO) ;Add a comment without changing the status
"RTN","GMRCACMT",6,0)
 K GMRCQIT,GMRCQUT N GMRCA
"RTN","GMRCACMT",7,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCACMT",8,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCAD=GMRCNOW
"RTN","GMRCACMT",9,0)
 S GMRCOM=1,GMRCA=20,GMRCPROV=$P(^GMR(123,GMRCO,0),"^",14) D AUDIT^GMRCP
"RTN","GMRCACMT",10,0)
 ; GMRCOM=1 defined the variable and tells AUDIT^GMRCP that the 
"RTN","GMRCACMT",11,0)
 ; word-processing logic should be executed. If an actual comment is 
"RTN","GMRCACMT",12,0)
 ; added, $P(GMRCOM,"^",2)=1 (send alert), if not GMRCOM=1 and no '^' 
"RTN","GMRCACMT",13,0)
 ; exists (do not send alert)
"RTN","GMRCACMT",14,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG),END Q
"RTN","GMRCACMT",15,0)
 ;continue if no lock problems occurred
"RTN","GMRCACMT",16,0)
 I $P(GMRCOM,"^",2) D
"RTN","GMRCACMT",17,0)
 . I $P($G(^GMR(123,GMRCO,12)),U,5)="F" D
"RTN","GMRCACMT",18,0)
 .. W !!,"The ordering provider for this inter-facility consult will"
"RTN","GMRCACMT",19,0)
 .. W " automatically be ",!,"notified.",!
"RTN","GMRCACMT",20,0)
 . D PROCALRT("",1,20,GMRCO)
"RTN","GMRCACMT",21,0)
 . ;update LAST ACTION field even though no status change
"RTN","GMRCACMT",22,0)
 . N GMRCDR,GMRCSTS
"RTN","GMRCACMT",23,0)
 . S GMRCSTS="",GMRCDR="9////20"
"RTN","GMRCACMT",24,0)
 . D STATUS^GMRCP
"RTN","GMRCACMT",25,0)
 D END
"RTN","GMRCACMT",26,0)
 Q
"RTN","GMRCACMT",27,0)
 ;
"RTN","GMRCACMT",28,0)
PROCALRT(GMRCORTX,GMRCDELR,ACTION,GMRCO) ;Process alert for comments
"RTN","GMRCACMT",29,0)
 ;If GMRCDELR=1, the ordering provider can be deleted from the list.
"RTN","GMRCACMT",30,0)
 N GMRCADUZ,GMRCANS,NOTIF,GMRCQIT,GMRCTM
"RTN","GMRCACMT",31,0)
 ;S GMRCANS=$$READ("Y","Do You Wish To Send An Alert With This Comment","N","Enter Y to continue with recipient prompts. Otherwise, enter N.",1)
"RTN","GMRCACMT",32,0)
 ;I (GMRCANS[U)!(GMRCANS=0) D END Q
"RTN","GMRCACMT",33,0)
 ;
"RTN","GMRCACMT",34,0)
 D WHOTO
"RTN","GMRCACMT",35,0)
 ;I $G(GMRCQIT) D END Q  ;User "^" at requesting provider.
"RTN","GMRCACMT",36,0)
 ;
"RTN","GMRCACMT",37,0)
 N GMRCALT
"RTN","GMRCACMT",38,0)
 S NOTIF=$S(ACTION=20:63,ACTION=8:63,1:23)
"RTN","GMRCACMT",39,0)
 ;
"RTN","GMRCACMT",40,0)
 D SENDMSG(NOTIF,+GMRCO,$G(GMRCTM))
"RTN","GMRCACMT",41,0)
 Q
"RTN","GMRCACMT",42,0)
 ;
"RTN","GMRCACMT",43,0)
SENDMSG(NOTIF,GMRCO,GMRCATM) ;Send the alert
"RTN","GMRCACMT",44,0)
 N GMRCDFN
"RTN","GMRCACMT",45,0)
 I '$D(GMRCADUZ) S GMRCADUZ=""
"RTN","GMRCACMT",46,0)
 W !,"Processing Alerts..."
"RTN","GMRCACMT",47,0)
 S GMRCDFN=$P($G(^GMR(123,+GMRCO,0)),"^",2)
"RTN","GMRCACMT",48,0)
 I '$L(GMRCORTX) D
"RTN","GMRCACMT",49,0)
 . N TXT
"RTN","GMRCACMT",50,0)
 . S TXT="Comment Added to "
"RTN","GMRCACMT",51,0)
 . I $P($G(^GMR(123,GMRCO,12)),U,5)'="P" S GMRCORTX=TXT_"consult " Q
"RTN","GMRCACMT",52,0)
 . S GMRCORTX=TXT_"remote consult "
"RTN","GMRCACMT",53,0)
 S GMRCORTX=GMRCORTX_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCACMT",54,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTIF,.GMRCADUZ,$G(GMRCATM))
"RTN","GMRCACMT",55,0)
 Q
"RTN","GMRCACMT",56,0)
 ;
"RTN","GMRCACMT",57,0)
END ;kill off variables and exit
"RTN","GMRCACMT",58,0)
 K GMRC,GMRCA,GMRCMSG,GMRCOM,GMRCO,GMRCORTX,GMRCERR,GMRCERMS,GMRCQUT,GMRCUT
"RTN","GMRCACMT",59,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCACMT",60,0)
 K DTOUT,DIROUT,DUOUT,DIRUT
"RTN","GMRCACMT",61,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCACMT",62,0)
 Q
"RTN","GMRCACMT",63,0)
 ;
"RTN","GMRCACMT",64,0)
WHOTO ;Get the users who should receive an alert
"RTN","GMRCACMT",65,0)
 ;Asks about requesting provider first, then prompts for additional users
"RTN","GMRCACMT",66,0)
 ;Returns GMRCADUZ array of users to send an alert to and GMRCQIT if "^"
"RTN","GMRCACMT",67,0)
 N GMRCRP,GMRCANS,GMRCUPD
"RTN","GMRCACMT",68,0)
 S GMRCRP=+$P($G(^GMR(123,+GMRCO,0)),U,14) ;requesting provider entry
"RTN","GMRCACMT",69,0)
 S GMRCUPD=$$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5),GMRCO,DUZ)
"RTN","GMRCACMT",70,0)
 I GMRCRP=DUZ D  ;alert team if ord. prov. takes the action
"RTN","GMRCACMT",71,0)
 . S GMRCTM=1
"RTN","GMRCACMT",72,0)
 . W !,"Service update users will be notified.",!
"RTN","GMRCACMT",73,0)
 I GMRCUPD D  ; alert ord. prov if update users takes action
"RTN","GMRCACMT",74,0)
 . S GMRCADUZ(GMRCRP)=""
"RTN","GMRCACMT",75,0)
 . W !,"Requesting provider will be notified.",!
"RTN","GMRCACMT",76,0)
 I '$G(GMRCTM),'GMRCUPD D  ;alert both if not ord. prov or update user
"RTN","GMRCACMT",77,0)
 . S GMRCTM=1,GMRCADUZ(GMRCRP)=""
"RTN","GMRCACMT",78,0)
 . W !,"Requesting provider and service update users will be notified.",!
"RTN","GMRCACMT",79,0)
 ;
"RTN","GMRCACMT",80,0)
 ;
"RTN","GMRCACMT",81,0)
ANDTO ;Ask for additional recipients
"RTN","GMRCACMT",82,0)
 D NAMELIST("Additional alert recipients: ",.GMRCADUZ,GMRCDELR)
"RTN","GMRCACMT",83,0)
 Q
"RTN","GMRCACMT",84,0)
 ;
"RTN","GMRCACMT",85,0)
NAMELIST(GMRCP,GMRCOLD,GMRCDELR) ;manage the list of recipients
"RTN","GMRCACMT",86,0)
 ;
"RTN","GMRCACMT",87,0)
 ; GMRCP - Prompt
"RTN","GMRCACMT",88,0)
 ; GMRCOLD - Original list with ordering provider.
"RTN","GMRCACMT",89,0)
 ; GMRCDELR - 1 means the original list may have names deleted
"RTN","GMRCACMT",90,0)
 ; Returns final list in GMRCOLD array
"RTN","GMRCACMT",91,0)
 ;
"RTN","GMRCACMT",92,0)
 N GMRCNEW,GMRCNT,GMRCDUZ,GMRCUSER,GMRCQ,GMRCADD,DIC,X,Y
"RTN","GMRCACMT",93,0)
 ;
"RTN","GMRCACMT",94,0)
 M GMRCNEW=GMRCOLD
"RTN","GMRCACMT",95,0)
 I GMRCDELR=1 K GMRCOLD S GMRCOLD="" ;Remove mandatory users from GMRCOLD
"RTN","GMRCACMT",96,0)
 S GMRCNT=0 F  D  Q:(GMRCUSER[U)
"RTN","GMRCACMT",97,0)
 .S GMRCUSER=$$READ("FAO;3;46",$S(GMRCNT:"And ",1:"")_GMRCP,"","^D NAMEHELP^GMRCACMT")
"RTN","GMRCACMT",98,0)
 .S:'$L(GMRCUSER) GMRCUSER=U Q:(GMRCUSER[U)
"RTN","GMRCACMT",99,0)
 .I ($E(GMRCUSER,1)="-") S GMRCADD=0,GMRCUSER=$E(GMRCUSER,2,$L(GMRCUSER))
"RTN","GMRCACMT",100,0)
 .E  S GMRCADD=1
"RTN","GMRCACMT",101,0)
 .;
"RTN","GMRCACMT",102,0)
 .S X=GMRCUSER,DIC=200,DIC(0)="EMQ" D ^DIC
"RTN","GMRCACMT",103,0)
 .;
"RTN","GMRCACMT",104,0)
 .I (Y>0) D  I 1
"RTN","GMRCACMT",105,0)
 ..;W $E($P(Y,U,2),$L(GMRCUSER)+1,$L($P(Y,U,2)))
"RTN","GMRCACMT",106,0)
 ..;
"RTN","GMRCACMT",107,0)
 ..I GMRCADD D
"RTN","GMRCACMT",108,0)
 ...I $D(GMRCNEW(+Y)) W " already in the list." Q
"RTN","GMRCACMT",109,0)
 ...S GMRCNEW(+Y)="" W " added to the list." S GMRCNT=GMRCNT+1
"RTN","GMRCACMT",110,0)
 ..;
"RTN","GMRCACMT",111,0)
 ..I 'GMRCADD D
"RTN","GMRCACMT",112,0)
 ...I $D(GMRCOLD(+Y)) W " can't delete this name from the list." Q
"RTN","GMRCACMT",113,0)
 ...I '$D(GMRCNEW(+Y)) W " not currently in the list." Q
"RTN","GMRCACMT",114,0)
 ...K GMRCNEW(+Y) S GMRCNT=GMRCNT-1 W " deleted from the list."
"RTN","GMRCACMT",115,0)
 .;
"RTN","GMRCACMT",116,0)
 .E  I $L(GMRCUSER) W "  Name not found."
"RTN","GMRCACMT",117,0)
 ;
"RTN","GMRCACMT",118,0)
 M GMRCOLD=GMRCNEW
"RTN","GMRCACMT",119,0)
 Q
"RTN","GMRCACMT",120,0)
 ;
"RTN","GMRCACMT",121,0)
READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL) ;read logic
"RTN","GMRCACMT",122,0)
 ;
"RTN","GMRCACMT",123,0)
 ;  GMRC0 -> DIR(0) --- Type of read
"RTN","GMRCACMT",124,0)
 ;  GMRCA -> DIR("A") - Prompt
"RTN","GMRCACMT",125,0)
 ;  GMRCB -> DIR("B") - Default Answer
"RTN","GMRCACMT",126,0)
 ;  GMRCH -> DIR("?") - Help text or ^Execute code
"RTN","GMRCACMT",127,0)
 ;  GMRCL -> Number of blank lines to put before Prompt
"RTN","GMRCACMT",128,0)
 ;
"RTN","GMRCACMT",129,0)
 ;  Returns "^" or answer
"RTN","GMRCACMT",130,0)
 ;
"RTN","GMRCACMT",131,0)
 N GMRCLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCACMT",132,0)
 Q:'$L($G(GMRC0)) U
"RTN","GMRCACMT",133,0)
 S DIR(0)=GMRC0
"RTN","GMRCACMT",134,0)
 S:$L($G(GMRCA)) DIR("A")=GMRCA
"RTN","GMRCACMT",135,0)
 S:$L($G(GMRCB)) DIR("B")=GMRCB
"RTN","GMRCACMT",136,0)
 S:$L($G(GMRCH)) DIR("?")=GMRCH
"RTN","GMRCACMT",137,0)
 F GMRCLINE=1:1:($G(GMRCL)-1) W !
"RTN","GMRCACMT",138,0)
 D ^DIR
"RTN","GMRCACMT",139,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","GMRCACMT",140,0)
 Q Y
"RTN","GMRCACMT",141,0)
 ;
"RTN","GMRCACMT",142,0)
 ;
"RTN","GMRCACMT",143,0)
NAMEHELP ;Help for the recipient list logic
"RTN","GMRCACMT",144,0)
 N GMRCDUZ
"RTN","GMRCACMT",145,0)
 W !,"Enter the name of the user to send the alert to,"
"RTN","GMRCACMT",146,0)
 W !," or put a '-' in front of a name to delete from the list."
"RTN","GMRCACMT",147,0)
 W !
"RTN","GMRCACMT",148,0)
 W !,"  Example:"
"RTN","GMRCACMT",149,0)
 W !,"     SMITH,FRED  ->  to add Fred to the list."
"RTN","GMRCACMT",150,0)
 W !,"     -SMITH,FRED ->  to delete Fred from the list."
"RTN","GMRCACMT",151,0)
 W !,"Already selected: "
"RTN","GMRCACMT",152,0)
 W !
"RTN","GMRCACMT",153,0)
 S GMRCDUZ=0 F  S GMRCDUZ=$O(GMRCNEW(GMRCDUZ)) Q:'GMRCDUZ  D
"RTN","GMRCACMT",154,0)
 .W !,?5,$P(^VA(200,GMRCDUZ,0),U,1)
"RTN","GMRCACMT",155,0)
 .W:$D(GMRCOLD(GMRCDUZ)) "  <mandatory>"
"RTN","GMRCACMT",156,0)
 W !
"RTN","GMRCACMT",157,0)
 Q
"RTN","GMRCACMT",158,0)
 ;
"RTN","GMRCADC")
0^2^B13804624^B13902691
"RTN","GMRCADC",1,0)
GMRCADC ;SLC/DLT/DCM - DC taken from List Manager ; 7/11/05 1:40pm
"RTN","GMRCADC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,10,12,35,39,47**;DEC 27, 1997
"RTN","GMRCADC",3,0)
EXAC(MSG) ;Exit message asking for user to press <ENTER>; EXAC=Exit Action
"RTN","GMRCADC",4,0)
 N ND,X
"RTN","GMRCADC",5,0)
 W $C(7),!,MSG I $O(MSG(0)) S ND=0 F  S ND=$O(MSG(ND)) Q:ND=""  D
"RTN","GMRCADC",6,0)
 . W !,MSG(ND)
"RTN","GMRCADC",7,0)
 W !,"Press <RETURN> to continue: " R X:DTIME W !!
"RTN","GMRCADC",8,0)
 Q
"RTN","GMRCADC",9,0)
DC(GMRCO,GMRCA) ;Discontinue a consult logic from DC^GMRCA1
"RTN","GMRCADC",10,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCADC",11,0)
 N GMRCDA,GMRCACTM,GMRCADUZ,GMRCSERV,GMRCAD,GMRC
"RTN","GMRCADC",12,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCADC",13,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) Q
"RTN","GMRCADC",14,0)
 I '+$G(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCADC",15,0)
 I $P($G(^GMR(123,GMRCO,12)),U,5)="P" D  Q
"RTN","GMRCADC",16,0)
 . N DIR
"RTN","GMRCADC",17,0)
 . W !,"The requesting facility may not take this action on an "
"RTN","GMRCADC",18,0)
 . W "inter-facility consult."
"RTN","GMRCADC",19,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMRCADC",20,0)
 . S GMRCQUT=1
"RTN","GMRCADC",21,0)
 I '$$LOCK^GMRCA1(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCADC",22,0)
 ;
"RTN","GMRCADC",23,0)
 S GMRC(0)=^GMR(123,GMRCO,0),GMRCDA=GMRCO
"RTN","GMRCADC",24,0)
 S (GMRCDFN,DFN)=$P(GMRC(0),"^",2)
"RTN","GMRCADC",25,0)
 I $D(GMRCA),+GMRCA S GMRCACTM=$S(GMRCA=6:"Discontinued",GMRCA=19:"Cancelled",1:$P($G(^GMR(123.1,+GMRCA,0)),"^",1))
"RTN","GMRCADC",26,0)
 ;
"RTN","GMRCADC",27,0)
 D PROC I $D(GMRCQUT) D UNLOCK^GMRCA1(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCADC",28,0)
 ;send 513 back to service printer if request DC'd or Cancelled
"RTN","GMRCADC",29,0)
 I GMRCA=6,$$DCPRNT^GMRCUTL1(+GMRCO,DUZ) D
"RTN","GMRCADC",30,0)
 . D PRNT^GMRCUTL1(+$P(GMRC(0),U,5),+GMRCO)
"RTN","GMRCADC",31,0)
 S GMRCTRLC=$S(GMRCA=19:"OC",1:"OD")
"RTN","GMRCADC",32,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),GMRCTRLC,GMRCORNP,$G(GMRCVSIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCADC",33,0)
 D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCADC",34,0)
 Q
"RTN","GMRCADC",35,0)
 ;
"RTN","GMRCADC",36,0)
PROC ;Check validity of action and if valid process the discontinue action
"RTN","GMRCADC",37,0)
 N DIROUT,DTOUT,DUOUT,GMRCMSG,GMRCFL,GMRCACT
"RTN","GMRCADC",38,0)
 I $P(GMRC(0),"^",12)=1 S GMRCMSG="This consult has already been discontinued!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",39,0)
 I $P(GMRC(0),"^",12)=2 S GMRCMSG="This consult has already been completed!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",40,0)
 I $P(GMRC(0),"^",12)=9 S GMRCMSG="Action invalid. This consult has partial results!",GMRCMSG(1)="Remove the associated results and then discontinue." D EXAC(.GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",41,0)
 I $P(GMRC(0),"^",12)=13 S GMRCMSG="This consult has already been cancelled!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",42,0)
 ;
"RTN","GMRCADC",43,0)
 S GMRCORVP=GMRCDFN_";DPT("
"RTN","GMRCADC",44,0)
 N GETPROV
"RTN","GMRCADC",45,0)
FRGTPRV D GETPROV^GMRCAU I $D(DIROUT)!$D(DTOUT)!$D(DUOUT) S GMRCQUT=1 Q
"RTN","GMRCADC",46,0)
 S GMRCACT=$$PROVIDER^XUSER(GMRCORNP) I $P(GMRCACT,U)'=1 D  G FRGTPRV
"RTN","GMRCADC",47,0)
 .W !!,"***User account is TERMINATED please choose another responsible user.***"
"RTN","GMRCADC",48,0)
 S GMRCAD=$$GETDT^GMRCUTL1 ;Returns GMRCAD as the entered date
"RTN","GMRCADC",49,0)
 I GMRCAD="^" S GMRCQUT=1 Q
"RTN","GMRCADC",50,0)
 S GMRCSTS=$S(GMRCA=6:1,1:13),$P(GMRC(0),"^",12)=GMRCSTS
"RTN","GMRCADC",51,0)
 S GMRCOM=1
"RTN","GMRCADC",52,0)
 D STATUS^GMRCP
"RTN","GMRCADC",53,0)
 D AUDIT^GMRCP
"RTN","GMRCADC",54,0)
 ;
"RTN","GMRCADC",55,0)
 S GMRCORTX=$S($L($G(GMRCACTM)):GMRCACTM,+GMRCA:$P(^GMR(123.1,GMRCA,0),U,1),1:"ACTION UNKNOWN FOR")_" consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCADC",56,0)
 S GMRCADUZ="",GMRCFL=0
"RTN","GMRCADC",57,0)
 I +$P($G(^GMR(123,+GMRCO,0)),"^",14),+$P(^(0),"^",14)'=DUZ S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCADC",58,0)
 ;I +$P($G(^GMR(123,+GMRCO,0)),"^",14)=DUZ S GMRCFL=1
"RTN","GMRCADC",59,0)
 I GMRCA=6 S GMRCFL=$$DCNOTE(GMRCO,DUZ) ;check NOTIFY SERVICE ON DC
"RTN","GMRCADC",60,0)
 ;I GMRCA=19 S GMRCFL=1
"RTN","GMRCADC",61,0)
 ;send notification info to routine to be sent to OERR
"RTN","GMRCADC",62,0)
 N NOTYPE S NOTYPE=$S(GMRCA=6:23,1:30)
"RTN","GMRCADC",63,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTYPE,.GMRCADUZ,GMRCFL)
"RTN","GMRCADC",64,0)
 Q
"RTN","GMRCADC",65,0)
DCNOTE(IEN,USER) ;determine if service users receive alerts based on 1.04
"RTN","GMRCADC",66,0)
 N SERV,DCFLG
"RTN","GMRCADC",67,0)
 S SERV=$P(^GMR(123,IEN,0),U,5)
"RTN","GMRCADC",68,0)
 S DCFLG=$P($G(^GMR(123.5,SERV,1)),U,4)
"RTN","GMRCADC",69,0)
 I 'DCFLG Q 1
"RTN","GMRCADC",70,0)
 I DCFLG=2 Q 0
"RTN","GMRCADC",71,0)
 I DCFLG=1,'$$VALID^GMRCAU(SERV,IEN,USER) Q 1
"RTN","GMRCADC",72,0)
 Q 0
"RTN","GMRCEDIT")
0^3^B11706918^B11470474
"RTN","GMRCEDIT",1,0)
GMRCEDIT ;SLC/DCM,JFR - EDIT CANCELLED CONSULT-MAIN DRIVER ; 11/25/2000
"RTN","GMRCEDIT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,10,18,47**;DEC 27, 1997
"RTN","GMRCEDIT",3,0)
 ; Patch 18 newed variable DFN and added line tag VALPROV
"RTN","GMRCEDIT",4,0)
 ; This routine invokes IA #2638,#2713,#2801,#10060
"RTN","GMRCEDIT",5,0)
EN(XQCON,XQDFN) ; -- main entry point for GMRCEDIT
"RTN","GMRCEDIT",6,0)
 ;XQDFN=XQAID   XQCON=XQADATA from CPRS alerts
"RTN","GMRCEDIT",7,0)
 N GMRCNOTF,GMRCCORY,GMRCDA,GMRCO,DFN
"RTN","GMRCEDIT",8,0)
 S DFN=$P(XQDFN,",",2),GMRCDA=$S(XQCON=+XQCON:+XQCON,+$P($P(XQCON,",",2),";",2):+$P($P(XQCON,",",2),";",2),XQCON?1N.N1",GMRC".E:+XQCON,1:$P($P(XQCON,";",3),",",1))
"RTN","GMRCEDIT",9,0)
 S GMRCNOTF=+$P(XQDFN,",",3)
"RTN","GMRCEDIT",10,0)
 I '+GMRCDA S XQAKILL=$$XQAKILL^ORB3F1(GMRCNOTF) D DEL^ORB3FUP1(.GMRCCORY,XQDFN),END Q
"RTN","GMRCEDIT",11,0)
 S GMRCDAP=GMRCDA
"RTN","GMRCEDIT",12,0)
 I '$$LOCK^GMRCA1(+GMRCDAP) D END Q
"RTN","GMRCEDIT",13,0)
 N GMRCLCK S GMRCLCK=1 ;JFR
"RTN","GMRCEDIT",14,0)
 ;S GMRCDAP=GMRCDA I +$P(^GMR(123,+GMRCDA,0),"^",5)
"RTN","GMRCEDIT",15,0)
 S GMRCOK=$P(^ORD(100.01,$P(^GMR(123,+GMRCDA,0),"^",12),0),"^",1),GMRCOK=$S(GMRCOK["CANCELLED":1,1:0)
"RTN","GMRCEDIT",16,0)
 I '$D(GMRCOK) S XQAKILL=$$XQAKILL^ORB3F1(GMRCNOTF) D DEL^ORB3FUP1(.GMRCCORY,XQDFN),END Q
"RTN","GMRCEDIT",17,0)
 S GMRCPNM=$P(^DPT(DFN,0),"^",1)
"RTN","GMRCEDIT",18,0)
 S GMRCPROV=$P($G(^GMR(123,GMRCDA,0)),"^",14) I 'GMRCPROV S GMRCPROV=$P($G(^GMR(123,GMRCDA,12)),"^",6)
"RTN","GMRCEDIT",19,0)
 I +GMRCPROV S GMRCPROV=$P(^VA(200,GMRCPROV,0),"^",1)
"RTN","GMRCEDIT",20,0)
 D EN^VALM("GMRC EDIT CONSULT")  ;********* CALL TO LIST MANAGER
"RTN","GMRCEDIT",21,0)
 I $S($O(GMRCED(0)):1,$D(^TMP("GMRCED",$J)):1,1:0),'$D(GMRCRSUB) D
"RTN","GMRCEDIT",22,0)
 . N DIR,DTOUT,DUOUT,X,Y
"RTN","GMRCEDIT",23,0)
 . W !,$C(7),"This Consult Has Not Been Resubmitted!!"
"RTN","GMRCEDIT",24,0)
 . W !,"Resubmit Or All Edits Will Be Lost!!",!!
"RTN","GMRCEDIT",25,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to resubmit now? ",DIR("B")="YES"
"RTN","GMRCEDIT",26,0)
 . D ^DIR I $D(DUOUT)!($D(DTOUT))!(Y<1) W !!,"No changes made!" Q
"RTN","GMRCEDIT",27,0)
 . D EN^GMRCEDT2(GMRCDAP)
"RTN","GMRCEDIT",28,0)
 . Q
"RTN","GMRCEDIT",29,0)
 S XQAKILL=$$XQAKILL^ORB3F1(GMRCNOTF) D DEL^ORB3FUP1(.GMRCCORY,XQDFN)
"RTN","GMRCEDIT",30,0)
 D END
"RTN","GMRCEDIT",31,0)
 Q
"RTN","GMRCEDIT",32,0)
 ;
"RTN","GMRCEDIT",33,0)
HDR ; -- header code
"RTN","GMRCEDIT",34,0)
 S VALMHDR(1)="Edit Consult for Patient "_GMRCPNM_"  Consult Number: "_GMRCDA
"RTN","GMRCEDIT",35,0)
 S VALMHDR(2)="Sending Provider: "_GMRCPROV
"RTN","GMRCEDIT",36,0)
 Q
"RTN","GMRCEDIT",37,0)
 ;
"RTN","GMRCEDIT",38,0)
INIT ; -- init variables and list array
"RTN","GMRCEDIT",39,0)
 K ^TMP("GMRCR",$J,"EDLIST")
"RTN","GMRCEDIT",40,0)
 S DSPLINE=0,DATA="",VALMAR="^TMP(""GMRCR"",$J,""EDLIST"")"
"RTN","GMRCEDIT",41,0)
 F LINE=1:1:GMRCLNO S DSPLINE=$O(^TMP("GMRCR",$J,"ED",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCEDIT",42,0)
 S VALMCNT=GMRCLNO,VALMPGE=1,XQORM("A")="Select Action: "
"RTN","GMRCEDIT",43,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCEDIT",44,0)
 Q
"RTN","GMRCEDIT",45,0)
 ;
"RTN","GMRCEDIT",46,0)
HELP ; -- help code
"RTN","GMRCEDIT",47,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCEDIT",48,0)
 Q
"RTN","GMRCEDIT",49,0)
 ;
"RTN","GMRCEDIT",50,0)
VALPROV(GMRCIEN) ; Check Provider or Update authority.      
"RTN","GMRCEDIT",51,0)
 I DUZ=$P(^GMR(123,+GMRCIEN,0),"^",14) Q 1
"RTN","GMRCEDIT",52,0)
 I $$VALID^GMRCAU($P(^GMR(123,+GMRCIEN,0),"^",5)) Q 1
"RTN","GMRCEDIT",53,0)
 Q 0
"RTN","GMRCEDIT",54,0)
EXIT ;
"RTN","GMRCEDIT",55,0)
 ;Don't kill anything here
"RTN","GMRCEDIT",56,0)
 Q
"RTN","GMRCEDIT",57,0)
END ; -- exit code
"RTN","GMRCEDIT",58,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(+GMRCDAP) ;JFR
"RTN","GMRCEDIT",59,0)
 K ^TMP("GMRCR",$J,"EDLIST"),^TMP("GMRCR",$J,"ED")
"RTN","GMRCEDIT",60,0)
 K ^TMP("GMRCED",$J),^TMP("GMRCSUB",$J),^TMP("GMRCFLD20",$J)
"RTN","GMRCEDIT",61,0)
 K CMDA,DFN,DIC,DIE,DR,DA,FLDA,FLDNM,GMRCA,GMRCATN,GMRCD,GMRCDD,GMRCANS,GMRCDIAG,GMRCED,GMRCEDCM,GMRCIND,GMRCINO,GMRCKEEP,GMRCLNO,GMRCND,GMRCND1,GMRCO,GMRCOK,GMRCPC,GMRCPL,GMRCPR,GMRCPNM,GMRCPROC,GMRCPROV,GMRCREQ,GMRCRQT
"RTN","GMRCEDIT",62,0)
 K GMRCFLD,GMRCOUNT,GMRCRSUB,GMRCSS,GMRCURG,GMRCDA,GMRCDAP,GMRCDA1,ND,TRKDA,XQAKILL
"RTN","GMRCEDIT",63,0)
 Q
"RTN","GMRCEDIT",64,0)
 ;
"RTN","GMRCEDIT",65,0)
EXPND ; -- expand code
"RTN","GMRCEDIT",66,0)
 Q
"RTN","GMRCEDIT",67,0)
 ;
"RTN","GMRCEDT1")
0^4^B45730491^B38760045
"RTN","GMRCEDT1",1,0)
GMRCEDT1 ;SLC/DCM,JFR - EDIT A CONSULT AND RE-SEND AS NEW ;3/20/03 22:22
"RTN","GMRCEDT1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,22,33,47**;DEC 27, 1997
"RTN","GMRCEDT1",3,0)
 ;
"RTN","GMRCEDT1",4,0)
 ; This routine invokes IA #2638,#3991
"RTN","GMRCEDT1",5,0)
 ;
"RTN","GMRCEDT1",6,0)
EN(GMRCO) ;GMRCO=IEN of consult from file 123
"RTN","GMRCEDT1",7,0)
 ;GMRCSS=To Service   GMRCPROC=Procedure Request Type
"RTN","GMRCEDT1",8,0)
 ;GMRCURG=Urgency     GMRCPL=Place Of Consultation
"RTN","GMRCEDT1",9,0)
 ;GMRCATN=Attention   GMRCINO=Service is In/Out Patient
"RTN","GMRCEDT1",10,0)
 ;GMRCPNM=Patient Name  GMRCDIAG=Provisional Diagnosis
"RTN","GMRCEDT1",11,0)
 N GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCINO,GMRCDIAG,LN,GMRCRESP
"RTN","GMRCEDT1",12,0)
 K ^TMP("GMRCR",$J,"ED") S GMRCLNO=1
"RTN","GMRCEDT1",13,0)
 I $L($P(^GMR(123,+GMRCO,0),"^",12)) S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CURRENT STATUS: (Not Editable): "_$P(^ORD(100.01,$P(^(0),"^",12),0),"^",1),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",14,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="" F  S GMRCDD=$O(^GMR(123,GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",15,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=19 S LN=0 D
"RTN","GMRCEDT1",16,0)
 ..N GMRCPERS,GMRCTX
"RTN","GMRCEDT1",17,0)
 ..I '$D(^GMR(123,+GMRCO,12)) D
"RTN","GMRCEDT1",18,0)
 ...S GMRCPERS=+$P($G(^GMR(123,+GMRCO,40,GMRCDD,0)),"^",5)
"RTN","GMRCEDT1",19,0)
 ...S GMRCPERS=$$GET1^DIQ(200,GMRCPERS,.01)
"RTN","GMRCEDT1",20,0)
 ..I $D(^GMR(123,+GMRCO,12)) D
"RTN","GMRCEDT1",21,0)
 ...I $P(^GMR(123,+GMRCO,12),U,5)="P" D
"RTN","GMRCEDT1",22,0)
 ....S GMRCPERS=$P($G(^GMR(123,+GMRCO,40,GMRCDD,2)),U,1)
"RTN","GMRCEDT1",23,0)
 ...I $P(^GMR(123,+GMRCO,12),U,5)="F" D
"RTN","GMRCEDT1",24,0)
 ....S GMRCPERS=$P($G(^GMR(123,+GMRCO,40,GMRCDD,0)),U,5)
"RTN","GMRCEDT1",25,0)
 ....S GMRCPERS=$$GET1^DIQ(200,GMRCPERS,.01)
"RTN","GMRCEDT1",26,0)
 ..S GMRCTX="  CANCELLED BY (Not Editable): "_GMRCPERS
"RTN","GMRCEDT1",27,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=GMRCTX,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",28,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CANCELLED COMMENT (Not Editable):",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",29,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG)
"RTN","GMRCEDT1",30,0)
 ..I '$D(FLG) S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",31,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",$P(^(0),"-",79)=""
"RTN","GMRCEDT1",32,0)
 ..S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",33,0)
 ..Q
"RTN","GMRCEDT1",34,0)
 .Q
"RTN","GMRCEDT1",35,0)
 S GMRCSS=$S($D(GMRCEDT(1)):GMRCEDT(1),1:$P(^GMR(123,+GMRCO,0),"^",5)_U_$P(^GMR(123.5,$P(^GMR(123,+GMRCO,0),"^",5),0),U))
"RTN","GMRCEDT1",36,0)
 S GMRCPROC=$S($D(GMRCED(1)):GMRCED(1),1:$P(^GMR(123,+GMRCO,0),"^",8)_U_$$GET1^DIQ(123.3,+$P(^GMR(123,+GMRCO,0),"^",8),.01))
"RTN","GMRCEDT1",37,0)
 S GMRCURG=$S($D(GMRCED(3)):GMRCED(3),1:$P(^GMR(123,+GMRCO,0),"^",9)_U_$$GET1^DIQ(101,+$P(^(0),"^",9),1))
"RTN","GMRCEDT1",38,0)
 S GMRCPL=$S($D(GMRCED(4)):GMRCED(4),1:$P(^GMR(123,+GMRCO,0),"^",10)_U_$$GET1^DIQ(101,+$P(^(0),U,10),1))
"RTN","GMRCEDT1",39,0)
 S GMRCATN=$S($D(GMRCED(5)):GMRCED(5),1:$P(^GMR(123,+GMRCO,0),"^",11)_U_$$GET1^DIQ(200,+$P(^(0),U,11),.01))
"RTN","GMRCEDT1",40,0)
 I '$D(^GMR(123,GMRCO,30.1)) D
"RTN","GMRCEDT1",41,0)
 . I $D(GMRCED(6)),$L($P(GMRCED(6),U,2)) D  Q
"RTN","GMRCEDT1",42,0)
 .. S GMRCDIAG=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT1",43,0)
 . S GMRCDIAG=$S($D(GMRCED(6)):GMRCED(6),1:$G(^GMR(123,+GMRCO,30)))
"RTN","GMRCEDT1",44,0)
 I $D(^GMR(123,GMRCO,30.1)) D
"RTN","GMRCEDT1",45,0)
 . I $D(GMRCED(6)),$L(GMRCED(6)) D  Q
"RTN","GMRCEDT1",46,0)
 .. S GMRCDIAG=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT1",47,0)
 . S GMRCDIAG=$G(^GMR(123,+GMRCO,30))
"RTN","GMRCEDT1",48,0)
 . I '$$STATCHK^ICDAPIU(^GMR(123,GMRCO,30.1),DT) D
"RTN","GMRCEDT1",49,0)
 .. S GMRCDIAG=GMRCDIAG_"   <INACTIVE CODE>"
"RTN","GMRCEDT1",50,0)
 I $D(GMRCED(2)) S GMRCINO=GMRCED(2)
"RTN","GMRCEDT1",51,0)
 I '$D(GMRCINO) S GMRCINO=$P(^GMR(123,+GMRCO,0),U,18)_U_$S($P(^(0),U,18)="I":"Inpatient",1:"Outpatient")
"RTN","GMRCEDT1",52,0)
 S GMRCREQ=$S(+$P(^GMR(123,+GMRCO,0),U,17)="P":"Procedure",1:"Consult")
"RTN","GMRCEDT1",53,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="SENDING PROVIDER (Not Editable): "_$S($P($G(^GMR(123,+GMRCO,12)),U,6):$P(^GMR(123,+GMRCO,12),U,6),$P(^GMR(123,+GMRCO,0),"^",14):$$GET1^DIQ(200,+$P(^GMR(123,+GMRCO,0),"^",14),.01),1:"UNKNOWN"),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",54,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="REQUEST TYPE (Not Editable): "_GMRCREQ,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",55,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=$$REPEAT^XLFSTR("-",79),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",56,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  TO SERVICE (Not Editable): "_$P(GMRCSS,U,2) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",57,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=" ",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",58,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="1 PROCEDURE: "_$P(GMRCPROC,U,2)
"RTN","GMRCEDT1",59,0)
 D:+GMRCPROC RVRS(GMRCLNO,$D(GMRCED(1))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",60,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="2 Performed as INPT OR OUTPT: "_$P(GMRCINO,U,2) D RVRS(GMRCLNO,$D(GMRCED(2))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",61,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="3 URGENCY: "_$P(GMRCURG,U,2) D RVRS(GMRCLNO,$D(GMRCED(3))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",62,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="4 PLACE OF CONSULTATION: "_$P(GMRCPL,U,2) D RVRS(GMRCLNO,$D(GMRCED(4))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",63,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="5 ATTENTION (CONSULTANT): "_$P(GMRCATN,U,2) D RVRS(GMRCLNO,$D(GMRCED(5))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",64,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="6 PROVISIONAL DIAGNOSIS: "_GMRCDIAG D RVRS(GMRCLNO,$D(GMRCED(6))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",65,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="7 REASON FOR REQUEST:" D RVRS(GMRCLNO,$D(^TMP("GMRCED",$J,20))) S GMRCLNO=GMRCLNO+1 D
"RTN","GMRCEDT1",66,0)
 . I $D(^TMP("GMRCED",$J,20)) D  Q
"RTN","GMRCEDT1",67,0)
 .. N ND S ND=0
"RTN","GMRCEDT1",68,0)
 .. F  S ND=$O(^TMP("GMRCED",$J,20,ND)) Q:'ND  D
"RTN","GMRCEDT1",69,0)
 ... D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",70,0)
 ... S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCED",$J,20,ND,0)
"RTN","GMRCEDT1",71,0)
 ... S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",72,0)
 . N ND S ND=0
"RTN","GMRCEDT1",73,0)
 . F  S ND=$O(^GMR(123,+GMRCO,20,ND)) Q:ND=""  D
"RTN","GMRCEDT1",74,0)
 .. S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^GMR(123,+GMRCO,20,ND,0)
"RTN","GMRCEDT1",75,0)
 .. S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",76,0)
 .Q
"RTN","GMRCEDT1",77,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)="8 COMMENT(S): (Add Only)" D RVRS(GMRCLNO) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",78,0)
 I $D(^TMP("GMRCED",$J,40)) D
"RTN","GMRCEDT1",79,0)
 . D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",80,0)
 . S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  New Comment:",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",81,0)
 . N ND S ND=0 F  S ND=$O(^TMP("GMRCED",$J,40,ND)) Q:'ND  D
"RTN","GMRCEDT1",82,0)
 .. S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCED",$J,40,ND,0)
"RTN","GMRCEDT1",83,0)
 .. S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",84,0)
 N GMRCEDCT
"RTN","GMRCEDT1",85,0)
 S GMRCD=0,GMRCEDCT=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="",GMRCDD=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",86,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=20 S LN=0,GMRCEDCT=GMRCEDCT+1,GMRCEDCM(GMRCEDCT)=GMRCDD D
"RTN","GMRCEDT1",87,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)="ADDED COMMENT (Not Editable) Entered: "_$P($$FMTE^XLFDT($P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",1)),"@",1)
"RTN","GMRCEDT1",88,0)
 ..S GMRCRESP=$S($L($P($G(^GMR(123,+GMRCO,40,GMRCDD,0)),"^",5)):$P(^VA(200,$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",5),0),"^",1),$L($P($G(^GMR(123,+GMRCO,40,GMRCDD,2)),"^",1)):$P(^GMR(123,+GMRCO,40,GMRCDD,2),"^",1),1:"UNKNOWN")
"RTN","GMRCEDT1",89,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCR",$J,"ED",GMRCLNO,0)_" BY: "_GMRCRESP,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",90,0)
 ..;S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCR",$J,"ED",GMRCLNO,0)_" BY: "_$S($L($P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",4)):$P(^VA(200,$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",4),0),"^",1),1:"UNKNOWN"),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",91,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG) Q
"RTN","GMRCEDT1",92,0)
 ..S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",93,0)
 ..Q
"RTN","GMRCEDT1",94,0)
 .Q
"RTN","GMRCEDT1",95,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=""
"RTN","GMRCEDT1",96,0)
 K FLG
"RTN","GMRCEDT1",97,0)
 Q
"RTN","GMRCEDT1",98,0)
RVRS(LINE,EDITED) ;reverse video for fields that can be edited
"RTN","GMRCEDT1",99,0)
 I '$G(EDITED) D CNTRL^VALM10(LINE,1,1,IORVON,IORVOFF) Q
"RTN","GMRCEDT1",100,0)
 D CNTRL^VALM10(LINE,1,1,IORVON_IOINHI,IORVOFF_IOINORM)
"RTN","GMRCEDT1",101,0)
 Q
"RTN","GMRCIACT")
0^5^B58670458^B58449814
"RTN","GMRCIACT",1,0)
GMRCIACT ;SLC/JFR - PROCESS ACTIONS ON IFC ;02/10/02 22:13
"RTN","GMRCIACT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**22,47**;DEC 27, 1997
"RTN","GMRCIACT",3,0)
 Q  ;don't start here!
"RTN","GMRCIACT",4,0)
NW(ARRAY) ;process and file new order
"RTN","GMRCIACT",5,0)
 ;Input:
"RTN","GMRCIACT",6,0)
 ; ARRAY  = name of array containing message parts
"RTN","GMRCIACT",7,0)
 ;
"RTN","GMRCIACT",8,0)
 N GMRCFDA,GMRCORC,GMRCDA,GMRCITM,GMRCITER,GMRCROUT,GMRCFCN,GMRCLAC
"RTN","GMRCIACT",9,0)
 K ^TMP("GMRCIN",$J)
"RTN","GMRCIACT",10,0)
 M ^TMP("GMRCIN",$J)=@ARRAY
"RTN","GMRCIACT",11,0)
 S GMRCORC=^TMP("GMRCIN",$J,"ORC")
"RTN","GMRCIACT",12,0)
 D  I $D(GMRCITER) Q  ;Check for order already being on file
"RTN","GMRCIACT",13,0)
 . S GMRCFCN=+$P(GMRCORC,"|",2)
"RTN","GMRCIACT",14,0)
 . S GMRCROUT=$$IEN^XUAF4($P($P(GMRCORC,"|",2),U,2))
"RTN","GMRCIACT",15,0)
 . I '$O(^GMR(123,"AIFC",GMRCROUT,GMRCFCN,0)) Q  ;no dup
"RTN","GMRCIACT",16,0)
 . S GMRCITER=802
"RTN","GMRCIACT",17,0)
 . D APPACK^GMRCIAC2(0,"AR",GMRCITER) ;send app. ack w/ error
"RTN","GMRCIACT",18,0)
 . K ^TMP("GMRCIN",$J) Q 
"RTN","GMRCIACT",19,0)
 I '$D(^TMP("GMRCIN",$J,"PID")) Q  ;prepare reject message (no PID)
"RTN","GMRCIACT",20,0)
 D  ;get patient DFN from ICN in message
"RTN","GMRCIACT",21,0)
 . N PAT
"RTN","GMRCIACT",22,0)
 . S PAT=$$GETDFN^MPIF001(+$P(^TMP("GMRCIN",$J,"PID"),"|",2))
"RTN","GMRCIACT",23,0)
 . I +PAT'>1 S GMRCFDA(.02)="" Q
"RTN","GMRCIACT",24,0)
 . S GMRCFDA(.02)=+PAT
"RTN","GMRCIACT",25,0)
 I '$G(GMRCFDA(.02)) D  Q  ;reject message, patient is unknown
"RTN","GMRCIACT",26,0)
 . N STA S STA=$P($P(^TMP("GMRCIN",$J,"ORC"),"|",2),U,2)
"RTN","GMRCIACT",27,0)
 . D PTERRMSG^GMRCIERR(^TMP("GMRCIN",$J,"PID"),STA)
"RTN","GMRCIACT",28,0)
 . D APPACK^GMRCIAC2(0,"AR",201) ; send app. ack w/error
"RTN","GMRCIACT",29,0)
 . K ^TMP("GMRCIN",$J) Q 
"RTN","GMRCIACT",30,0)
 D  ;get ordered item and service
"RTN","GMRCIACT",31,0)
 . S GMRCITM=$P(^TMP("GMRCIN",$J,"OBR"),"|",4)
"RTN","GMRCIACT",32,0)
 . I GMRCITM["VA1233" D  ; proc
"RTN","GMRCIACT",33,0)
 .. N PROC
"RTN","GMRCIACT",34,0)
 .. S PROC=$$GETPROC^GMRCIUTL(GMRCITM)
"RTN","GMRCIACT",35,0)
 .. I +PROC'>0!('$P(PROC,U,2)) S GMRCITER=$P(PROC,U,3) Q
"RTN","GMRCIACT",36,0)
 .. S GMRCFDA(4)=$P(PROC,U)_";GMR(123.3,"
"RTN","GMRCIACT",37,0)
 .. S GMRCFDA(1)=$P(PROC,U,2)
"RTN","GMRCIACT",38,0)
 . I GMRCITM["VA1235" D
"RTN","GMRCIACT",39,0)
 .. N SERV
"RTN","GMRCIACT",40,0)
 .. S SERV=$$GETSERV^GMRCIUTL(GMRCITM) ;consult
"RTN","GMRCIACT",41,0)
 .. I +SERV'>0 S GMRCITER=$P(SERV,U,3)
"RTN","GMRCIACT",42,0)
 .. S GMRCFDA(1)=SERV
"RTN","GMRCIACT",43,0)
 I $D(GMRCITER) D  Q  ;error in procedure or service, reject new order
"RTN","GMRCIACT",44,0)
 . D APPACK^GMRCIAC2(0,"AR",GMRCITER) ; send app. ACK
"RTN","GMRCIACT",45,0)
 . K ^TMP("GMRCIN",$J) Q
"RTN","GMRCIACT",46,0)
 ;
"RTN","GMRCIACT",47,0)
 S GMRCFDA(.01)=$$NOW^XLFDT
"RTN","GMRCIACT",48,0)
 S GMRCFDA(3)=$$HL7TFM^XLFDT($P(GMRCORC,"|",15))
"RTN","GMRCIACT",49,0)
 S GMRCFDA(6)=$$FIND1^DIC(101,"","X","GMRCPLACE - ON CALL")
"RTN","GMRCIACT",50,0)
 D  ;get urgency to file
"RTN","GMRCIACT",51,0)
 . N URG
"RTN","GMRCIACT",52,0)
 . S URG=$$URG^GMRCHL7A($P($P(GMRCORC,"|",7),U,6))
"RTN","GMRCIACT",53,0)
 . S GMRCFDA(5)=$$FIND1^DIC(101,"","X","GMRCURGENCY - "_URG)
"RTN","GMRCIACT",54,0)
 S GMRCFDA(8)=5
"RTN","GMRCIACT",55,0)
 S GMRCFDA(9)=$S($P(GMRCORC,"|",16)["FI":24,1:23),GMRCLAC=GMRCFDA(9)
"RTN","GMRCIACT",56,0)
 S GMRCFDA(14)=$P(^TMP("GMRCIN",$J,"OBR"),"|",18)
"RTN","GMRCIACT",57,0)
 S GMRCFDA(.05)=$$IEN^XUAF4(+$P(GMRCORC,"|",17))
"RTN","GMRCIACT",58,0)
 S GMRCFDA(.06)=GMRCFCN
"RTN","GMRCIACT",59,0)
 S GMRCFDA(.07)=GMRCROUT
"RTN","GMRCIACT",60,0)
 D  ;get and set ordering prov info & entering person info
"RTN","GMRCIACT",61,0)
 . N GMRCOP
"RTN","GMRCIACT",62,0)
 . S GMRCOP=$$FMNAME^XLFNAME($P(GMRCORC,"|",12))
"RTN","GMRCIACT",63,0)
 . Q:'$L(GMRCOP)
"RTN","GMRCIACT",64,0)
 . S GMRCFDA(.126)=GMRCOP
"RTN","GMRCIACT",65,0)
 . Q
"RTN","GMRCIACT",66,0)
 S GMRCFDA(.125)="F"
"RTN","GMRCIACT",67,0)
 I $L($P(GMRCORC,"|",14)) D
"RTN","GMRCIACT",68,0)
 . N GMRCP14 S GMRCP14=$P(GMRCORC,"|",14)
"RTN","GMRCIACT",69,0)
 . S GMRCFDA(.132)=$P(GMRCP14,"B") ; requestor's phone number
"RTN","GMRCIACT",70,0)
 . S GMRCFDA(.133)=$P(GMRCP14,"B",2) ; requestor's dig pager
"RTN","GMRCIACT",71,0)
 S GMRCFDA(13)=$S($D(GMRCFDA(4)):"P",1:"C")
"RTN","GMRCIACT",72,0)
 I $D(^TMP("GMRCIN",$J,"OBX",2)) D
"RTN","GMRCIACT",73,0)
 . S GMRCFDA(30)=$P($P(^TMP("GMRCIN",$J,"OBX",2,1),"|",5),U,2)
"RTN","GMRCIACT",74,0)
 . S GMRCFDA(30.1)=$P($P(^TMP("GMRCIN",$J,"OBX",2,1),"|",5),U)
"RTN","GMRCIACT",75,0)
 M FDA(1,123,"+1,")=GMRCFDA
"RTN","GMRCIACT",76,0)
 D UPDATE^DIE("","FDA(1)","GMRCDA","GMRCERR")
"RTN","GMRCIACT",77,0)
 I '$D(GMRCDA) D  Q  ;couldn't get new consult #
"RTN","GMRCIACT",78,0)
 . D APPACK^GMRCIAC2(0,"AR",901) ; send app. ACK
"RTN","GMRCIACT",79,0)
 . K ^TMP("GMRCIN",$J) Q
"RTN","GMRCIACT",80,0)
 K GMRCFDA,FDA
"RTN","GMRCIACT",81,0)
 D  ; file reason for request
"RTN","GMRCIACT",82,0)
 . D TRIMWP^GMRCIUTL($NA(^TMP("GMRCIN",$J,"OBX",1)),5)
"RTN","GMRCIACT",83,0)
 . D WP^DIE(123,GMRCDA(1)_",",20,"K",$NA(^TMP("GMRCIN",$J,"OBX",1)))
"RTN","GMRCIACT",84,0)
 . Q
"RTN","GMRCIACT",85,0)
 D  ;file activity tracking
"RTN","GMRCIACT",86,0)
 . N GMRCSEG
"RTN","GMRCIACT",87,0)
 . S GMRCSEG("ORC")=GMRCORC
"RTN","GMRCIACT",88,0)
 . S GMRCSEG("OBX",5,1)=^TMP("GMRCIN",$J,"OBX",5,1)
"RTN","GMRCIACT",89,0)
 . D FILEACT^GMRCIAC2(GMRCDA(1),GMRCLAC,,"GMRCSEG")
"RTN","GMRCIACT",90,0)
 D  ;print SF-513
"RTN","GMRCIACT",91,0)
 . I GMRCLAC=24 Q  ;don't print if part of a FWD to IFC
"RTN","GMRCIACT",92,0)
 . D PRNT^GMRCUTL1("",GMRCDA(1))
"RTN","GMRCIACT",93,0)
 D  ;send notifications
"RTN","GMRCIACT",94,0)
 . I GMRCLAC=24 Q  ;no alerts yet if part of FWD to IFC
"RTN","GMRCIACT",95,0)
 . N GMRCORTX
"RTN","GMRCIACT",96,0)
 . S GMRCORTX="New remotely ordered consult "_$$ORTX^GMRCAU(+GMRCDA(1))
"RTN","GMRCIACT",97,0)
 . D MSG^GMRCP($P(^GMR(123,GMRCDA(1),0),U,2),GMRCORTX,GMRCDA(1),27,,1)
"RTN","GMRCIACT",98,0)
 D  ;send appl ack :-(
"RTN","GMRCIACT",99,0)
 . N GMRCRSLT
"RTN","GMRCIACT",100,0)
 . D RESP^GMRCIUTL("AA",HL("MID"),$P(GMRCORC,"|"),GMRCDA(1))
"RTN","GMRCIACT",101,0)
 . D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"LM",1,.GMRCRSLT)
"RTN","GMRCIACT",102,0)
 K ^TMP("GMRCIN",$J)
"RTN","GMRCIACT",103,0)
 Q
"RTN","GMRCIACT",104,0)
 ;
"RTN","GMRCIACT",105,0)
DIS(GMRCAR) ;dis-associate a result from a remote request
"RTN","GMRCIACT",106,0)
 ;Input:
"RTN","GMRCIACT",107,0)
 ; GMRCAR = array name containing message 
"RTN","GMRCIACT",108,0)
 ;      e.g.  ^TMP("GMRCIF",$J)
"RTN","GMRCIACT",109,0)
 N GMRCDA,GMRCFDA,FDA,GMRCERR,GMRCORC
"RTN","GMRCIACT",110,0)
 M ^TMP("GMRCID",$J)=@GMRCAR
"RTN","GMRCIACT",111,0)
 S GMRCORC=^TMP("GMRCID",$J,"ORC")
"RTN","GMRCIACT",112,0)
 S GMRCDA=$$GETDA^GMRCIAC2(GMRCORC)
"RTN","GMRCIACT",113,0)
 I '$$LOCKREC^GMRCUTL1(GMRCDA) D  Q  ;couldn't lock record
"RTN","GMRCIACT",114,0)
 . D APPACK^GMRCIAC2(GMRCDA,"AR",901) ;send app. ACK
"RTN","GMRCIACT",115,0)
 . K ^TMP("GMRCID",$J) Q
"RTN","GMRCIACT",116,0)
 ;    v--check to see if a dup transmission
"RTN","GMRCIACT",117,0)
 I $$DUPACT^GMRCIAC2(GMRCDA,12,GMRCORC,^TMP("GMRCID",$J,"OBX",4,1)) Q
"RTN","GMRCIACT",118,0)
 ;
"RTN","GMRCIACT",119,0)
 D FILEACT^GMRCIAC2(GMRCDA,12,,$NA(^TMP("GMRCID",$J))) ; act. tracking
"RTN","GMRCIACT",120,0)
 D FILRES^GMRCIAC2(GMRCDA,^TMP("GMRCID",$J,"OBX",4,1)) ;file results
"RTN","GMRCIACT",121,0)
 K GMRCERR,FDA,GMRCFDA
"RTN","GMRCIACT",122,0)
 I $$STSCHG^GMRCDIS(GMRCDA) S FDA(1,123,GMRCDA_",",8)=6
"RTN","GMRCIACT",123,0)
 S FDA(1,123,GMRCDA_",",9)=12
"RTN","GMRCIACT",124,0)
 D UPDATE^DIE("","FDA(1)",,"GMRCERR") ;file last action and status
"RTN","GMRCIACT",125,0)
 D  ;send notifications
"RTN","GMRCIACT",126,0)
 . I $P(^GMR(123,GMRCDA,12),U,5)="F" Q  ;DIS from placer before IFC
"RTN","GMRCIACT",127,0)
 . N GMRCORTX
"RTN","GMRCIACT",128,0)
 . S GMRCORTX="Remote result removed from "_$$ORTX^GMRCAU(+GMRCDA)
"RTN","GMRCIACT",129,0)
 . D MSG^GMRCP($P(^GMR(123,GMRCDA,0),U,2),GMRCORTX,GMRCDA,63,,1)
"RTN","GMRCIACT",130,0)
 D  ;send appl ACK
"RTN","GMRCIACT",131,0)
 . D APPACK^GMRCIAC2(GMRCDA,"AA") ; send app. ACK and unlock record
"RTN","GMRCIACT",132,0)
 K ^TMP("GMRCID",$J)
"RTN","GMRCIACT",133,0)
 Q
"RTN","GMRCIACT",134,0)
 ;
"RTN","GMRCIACT",135,0)
OTHER(GMRCAR) ;process most IFC actions
"RTN","GMRCIACT",136,0)
 ;will process the receive, schedule, DC, cancel and added comment action
"RTN","GMRCIACT",137,0)
 ;
"RTN","GMRCIACT",138,0)
 ;Input:
"RTN","GMRCIACT",139,0)
 ; GMRCAR = array name containing message 
"RTN","GMRCIACT",140,0)
 ;      e.g.  ^TMP("GMRCIF",$J)
"RTN","GMRCIACT",141,0)
 ;
"RTN","GMRCIACT",142,0)
 N GMRCDA,GMRCFDA,GMRCORC,GMRCLAT,GMRCACT,GMRCROL,FDA
"RTN","GMRCIACT",143,0)
 K ^TMP("GMRCIN",$J)
"RTN","GMRCIACT",144,0)
 M ^TMP("GMRCIN",$J)=@GMRCAR
"RTN","GMRCIACT",145,0)
 ;
"RTN","GMRCIACT",146,0)
 S GMRCORC=^TMP("GMRCIN",$J,"ORC")
"RTN","GMRCIACT",147,0)
 S GMRCDA=$$GETDA^GMRCIAC2(GMRCORC)  ;get ien to work on 
"RTN","GMRCIACT",148,0)
 S GMRCROL=$P(^GMR(123,GMRCDA,12),U,5)
"RTN","GMRCIACT",149,0)
 I '$$LOCKREC^GMRCUTL1(GMRCDA) D  Q  ;couldn't lock record
"RTN","GMRCIACT",150,0)
 . D APPACK^GMRCIAC2(GMRCDA,"AR",901) ; send app. ACK
"RTN","GMRCIACT",151,0)
 . K ^TMP("GMRCIN",$J) Q
"RTN","GMRCIACT",152,0)
 ;
"RTN","GMRCIACT",153,0)
 I $P(GMRCORC,"|")'="IP" D  ; status update
"RTN","GMRCIACT",154,0)
 . N GMRCOS S GMRCOS=$P(GMRCORC,"|",5)
"RTN","GMRCIACT",155,0)
 . S GMRCFDA(8)=$S(GMRCOS="IP":6,GMRCOS="SC":8,GMRCOS="CA":13,1:1)
"RTN","GMRCIACT",156,0)
 . ; IP=receive, SC=schedule, CA=cancel, DC=discontinue
"RTN","GMRCIACT",157,0)
 D  ; get last action taken
"RTN","GMRCIACT",158,0)
 . I '$G(GMRCFDA(8)) S (GMRCFDA(9),GMRCLAT)=20 Q
"RTN","GMRCIACT",159,0)
 . I GMRCFDA(8)=6 S (GMRCFDA(9),GMRCLAT)=21 Q
"RTN","GMRCIACT",160,0)
 . I GMRCFDA(8)=8 S (GMRCFDA(9),GMRCLAT)=8 Q
"RTN","GMRCIACT",161,0)
 . I GMRCFDA(8)=1 S (GMRCFDA(9),GMRCLAT)=6 Q
"RTN","GMRCIACT",162,0)
 . I GMRCFDA(8)=13 S (GMRCFDA(9),GMRCLAT)=19 Q
"RTN","GMRCIACT",163,0)
 ;                         ^--last action taken
"RTN","GMRCIACT",164,0)
 ;    v-- check to see if a dup transmission
"RTN","GMRCIACT",165,0)
 I $$DUPACT^GMRCIAC2(GMRCDA,GMRCLAT,GMRCORC) Q
"RTN","GMRCIACT",166,0)
 ;
"RTN","GMRCIACT",167,0)
 M FDA(1,123,GMRCDA_",")=GMRCFDA
"RTN","GMRCIACT",168,0)
 D UPDATE^DIE("","FDA(1)",,"GMRCERR") ;file last action and update status
"RTN","GMRCIACT",169,0)
 K GMRCFDA
"RTN","GMRCIACT",170,0)
 D FILEACT^GMRCIAC2(GMRCDA,GMRCLAT,,$NA(^TMP("GMRCIN",$J)))
"RTN","GMRCIACT",171,0)
 D  ;send notifications
"RTN","GMRCIACT",172,0)
 . N GMRCTX,GMRCNOT,GMRCFL
"RTN","GMRCIACT",173,0)
 . S GMRCFL=1
"RTN","GMRCIACT",174,0)
 . I GMRCLAT=20!(GMRCLAT=8)!(GMRCLAT=21) D
"RTN","GMRCIACT",175,0)
 .. I GMRCLAT=20 D  I '$D(GMRCTX) Q
"RTN","GMRCIACT",176,0)
 ... I $P(^GMR(123,GMRCDA,40,1,0),U,2)'=24 D  Q
"RTN","GMRCIACT",177,0)
 .... S GMRCTX="Comment Added to remote"
"RTN","GMRCIACT",178,0)
 ... N ACT S ACT=1
"RTN","GMRCIACT",179,0)
 ... F  S ACT=$O(^GMR(123,GMRCDA,40,ACT)) Q:'ACT!($D(GMRCTX))  D
"RTN","GMRCIACT",180,0)
 .... I $P(^GMR(123,GMRCDA,40,ACT,0),U,2)=25,$O(^GMR(123,GMRCDA,40,ACT)) D
"RTN","GMRCIACT",181,0)
 ..... S GMRCTX="Comment Added to remote"
"RTN","GMRCIACT",182,0)
 .. I '$D(GMRCTX),GMRCROL="F" Q  ;sch & rec on filler part of FWD 2 IFC
"RTN","GMRCIACT",183,0)
 .. I GMRCLAT=8 S GMRCTX="Scheduled remote"
"RTN","GMRCIACT",184,0)
 .. I GMRCLAT=21 S GMRCTX="Received remote"
"RTN","GMRCIACT",185,0)
 .. S GMRCTX=GMRCTX_" Consult: "_$$ORTX^GMRCAU(+GMRCDA)
"RTN","GMRCIACT",186,0)
 .. S GMRCNOT=63
"RTN","GMRCIACT",187,0)
 . I GMRCLAT=6 D
"RTN","GMRCIACT",188,0)
 .. S GMRCFL=$$DCNOTE^GMRCADC(GMRCDA,.5)
"RTN","GMRCIACT",189,0)
 .. S GMRCTX="Discontinued remote Consult: "_$$ORTX^GMRCAU(+GMRCDA)
"RTN","GMRCIACT",190,0)
 .. S GMRCNOT=23
"RTN","GMRCIACT",191,0)
 . I GMRCLAT=19 D
"RTN","GMRCIACT",192,0)
 .. I GMRCROL="F" Q  ;canc on a filler is part of FWD 2 IFC
"RTN","GMRCIACT",193,0)
 .. S GMRCTX="Cancelled remote Consult: "_$$ORTX^GMRCAU(+GMRCDA)
"RTN","GMRCIACT",194,0)
 .. S GMRCNOT=30
"RTN","GMRCIACT",195,0)
 . I '$D(GMRCNOT) Q  ;don't send any alerts
"RTN","GMRCIACT",196,0)
 . D MSG^GMRCP($P(^GMR(123,GMRCDA,0),U,2),GMRCTX,GMRCDA,GMRCNOT,,GMRCFL)
"RTN","GMRCIACT",197,0)
 ;
"RTN","GMRCIACT",198,0)
 D  ;send appl ACK
"RTN","GMRCIACT",199,0)
 . D APPACK^GMRCIAC2(GMRCDA,"AA") ;send app. ACK and unlock record
"RTN","GMRCIACT",200,0)
 K ^TMP("GMRCIN",$J)
"RTN","GMRCIACT",201,0)
 Q
"RTN","GMRCIACT",202,0)
 ;
"RTN","GMRCMED")
0^6^B35624524^B35624704
"RTN","GMRCMED",1,0)
GMRCMED ;SLC/JFR - MEDICINE INTERFACE ROUTINES; 2/20/01 13:32
"RTN","GMRCMED",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**15,47**;DEC 27, 1997
"RTN","GMRCMED",3,0)
 ;
"RTN","GMRCMED",4,0)
 ; This routine invokes IA #147,#2757,#3160,#3171
"RTN","GMRCMED",5,0)
 ;
"RTN","GMRCMED",6,0)
SET(NUM) ; set selected med result into GMRCMEDR
"RTN","GMRCMED",7,0)
 I NUM<1!(NUM>VALMCNT) D  Q
"RTN","GMRCMED",8,0)
 . W !,$C(7),NUM_" is not a valid selection. "
"RTN","GMRCMED",9,0)
 . W !,"Choose a number between 1 and "_VALMCNT
"RTN","GMRCMED",10,0)
 I '$D(^TMP("GMRCR",$J,"DT",NUM,1)) D  Q
"RTN","GMRCMED",11,0)
 . D EXAC^GMRCADC("The displayed item is not selectable")
"RTN","GMRCMED",12,0)
 I $D(GMRCMEDR) D RESETIT(GMRCMEDR)
"RTN","GMRCMED",13,0)
 S GMRCMEDR=NUM
"RTN","GMRCMED",14,0)
 D CNTRL^VALM10(NUM,1,80,IORVON,IORVOFF)
"RTN","GMRCMED",15,0)
 D WRITE^VALM10(NUM)
"RTN","GMRCMED",16,0)
 S VALMBCK=""
"RTN","GMRCMED",17,0)
 Q
"RTN","GMRCMED",18,0)
RESETIT(NUM) ;return prev. selected number to normal video 
"RTN","GMRCMED",19,0)
 D CNTRL^VALM10(NUM,1,80,IOINORM,IOINORM)
"RTN","GMRCMED",20,0)
 D WRITE^VALM10(NUM)
"RTN","GMRCMED",21,0)
 S VALMBCK="" K GMRCSEL
"RTN","GMRCMED",22,0)
 Q
"RTN","GMRCMED",23,0)
RESULTS(ROOT,GMRCDFN) ;get list of results from Medicine
"RTN","GMRCMED",24,0)
 ; ROOT = "MCAR(691","MCAR(691.5" etc. (global root w/o comma)
"RTN","GMRCMED",25,0)
 ; return list formatted in ^TMP("GMRCMC",$J
"RTN","GMRCMED",26,0)
 N S5,CNT,REC
"RTN","GMRCMED",27,0)
 K ^TMP("GMRCMC",$J)
"RTN","GMRCMED",28,0)
 S S5=ROOT D EN^MCARPS2(GMRCDFN)
"RTN","GMRCMED",29,0)
 I '$D(^TMP("OR",$J,"MCAR")) D  Q
"RTN","GMRCMED",30,0)
 . ;D EXAC^GMRCADC("No results found for"_$P(ROOT,U,2))
"RTN","GMRCMED",31,0)
 S CNT=1,REC=0
"RTN","GMRCMED",32,0)
 F  S REC=$O(^TMP("OR",$J,"MCAR","OT",REC)) Q:'REC  D
"RTN","GMRCMED",33,0)
 . N MCDATA,DATA,ONEDATA
"RTN","GMRCMED",34,0)
 . S MCDATA=^TMP("OR",$J,"MCAR","OT",REC),DATA=""
"RTN","GMRCMED",35,0)
 . Q:$D(^GMR(123,"R",$P(MCDATA,U,2)_";"_ROOT_","))
"RTN","GMRCMED",36,0)
 . Q:$$SCRNDRFT($P(MCDATA,U,2),$P(ROOT,"(",2))
"RTN","GMRCMED",37,0)
 . S DATA=$$SETSTR^VALM1(CNT,DATA,2,$L(REC))
"RTN","GMRCMED",38,0)
 . S DATA=$$SETSTR^VALM1($P(MCDATA,U),DATA,6,23)
"RTN","GMRCMED",39,0)
 . S DATA=$$SETSTR^VALM1($P(MCDATA,U,6),DATA,30,$L($P(MCDATA,U,6)))
"RTN","GMRCMED",40,0)
 . S DATA=$$SETSTR^VALM1($P(MCDATA,U,7),DATA,50,$L($P(MCDATA,U,7)))
"RTN","GMRCMED",41,0)
 . S ^TMP("GMRCR",$J,"DT",CNT,0)=DATA
"RTN","GMRCMED",42,0)
 . ;S ONEDATA=REC_U_$P(MCDATA,U,2)_";"_ROOT_","_U_$P(MCDATA,U,3,5)
"RTN","GMRCMED",43,0)
 . ;S ONEDATA=ONEDATA_U_$P(MCDATA,U,11)
"RTN","GMRCMED",44,0)
 . S ONEDATA=$P(MCDATA,U,2)_";"_ROOT_","
"RTN","GMRCMED",45,0)
 . S ^TMP("GMRCR",$J,"DT",CNT,1)=ONEDATA
"RTN","GMRCMED",46,0)
 . S CNT=CNT+1
"RTN","GMRCMED",47,0)
 K ^TMP("OR",$J,"MCAR")
"RTN","GMRCMED",48,0)
 Q 
"RTN","GMRCMED",49,0)
PHDR ;set protocols into actions
"RTN","GMRCMED",50,0)
 S VALMSG=$$CJ^XLFSTR("Select action or item number    ?? for help",80)
"RTN","GMRCMED",51,0)
 S XQORM("M")=3
"RTN","GMRCMED",52,0)
 D SHOW^VALM
"RTN","GMRCMED",53,0)
 S XQORM("#")=$O(^ORD(101,"B","GMRCACT SELECT MED RESULT",0))_"^1:"_VALMCNT
"RTN","GMRCMED",54,0)
 S XQORM("KEY","EX")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCMED",55,0)
 S XQORM("KEY","Q")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCMED",56,0)
 S XQORM("KEY","CLOSE")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCMED",57,0)
 S XQORM("KEY","NX")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCMED",58,0)
 S XQORM("KEY","AR")=$O(^ORD(101,"B","GMRCACT ASSOCIATE RESULTS",0))_"^1"
"RTN","GMRCMED",59,0)
 S XQORM("KEY","DR")=$O(^ORD(101,"B","GMRCACT DISPLAY MED RESULT",0))_"^1"
"RTN","GMRCMED",60,0)
 Q
"RTN","GMRCMED",61,0)
 ;
"RTN","GMRCMED",62,0)
SELECT(CNT) ;grab an item from list
"RTN","GMRCMED",63,0)
 N DIR,DUOUT,DTOUT,DIRUT,X,Y
"RTN","GMRCMED",64,0)
 S DIR(0)="NO^1:"_CNT,DIR("A")="Select item"
"RTN","GMRCMED",65,0)
 D ^DIR I $D(DIRUT) Q 0
"RTN","GMRCMED",66,0)
 Q +Y
"RTN","GMRCMED",67,0)
 ;
"RTN","GMRCMED",68,0)
DISPRES(ITEM) ;
"RTN","GMRCMED",69,0)
 I '+$G(^TMP("GMRCR",$J,"DT",1,1)) D  Q  ; no result there
"RTN","GMRCMED",70,0)
 . D EXAC^GMRCADC("There are no results to display")
"RTN","GMRCMED",71,0)
 N GMRCDFN
"RTN","GMRCMED",72,0)
 I '$G(ITEM),'$G(GMRCMEDR) D  Q:'ITEM
"RTN","GMRCMED",73,0)
 . S ITEM=$$SELECT(VALMCNT)
"RTN","GMRCMED",74,0)
 . D SET(ITEM)
"RTN","GMRCMED",75,0)
 I $G(GMRCMEDR) S ITEM=GMRCMEDR
"RTN","GMRCMED",76,0)
 N I,GMRCRES,GMRCDFN,GMRCVTIT
"RTN","GMRCMED",77,0)
 S GMRCRES=$G(^TMP("GMRCR",$J,"DT",ITEM,1))
"RTN","GMRCMED",78,0)
 Q:'$L(GMRCRES)
"RTN","GMRCMED",79,0)
 M ^TMP("GMRCR",$J,"DTSV")=^TMP("GMRCR",$J,"DT")
"RTN","GMRCMED",80,0)
 K ^TMP("GMRCR",$J,"DT")
"RTN","GMRCMED",81,0)
 S GMRCDFN=$G(DFN)
"RTN","GMRCMED",82,0)
 D START^ORWRP(80,"EN^MCAPI(GMRCRES)")
"RTN","GMRCMED",83,0)
 I '$D(^TMP("ORDATA",$J,1)) D  Q
"RTN","GMRCMED",84,0)
 . S ^TMP("GMRCR",$J,"DTLIST",1,0)="Unable to locate result"
"RTN","GMRCMED",85,0)
 S I=0 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:'I  D
"RTN","GMRCMED",86,0)
 . S ^TMP("GMRCR",$J,"DTLIST",I,0)=^TMP("ORDATA",$J,1,I)
"RTN","GMRCMED",87,0)
 K ^TMP("ORDATA",$J) ; clean up from OR WORKSTATION
"RTN","GMRCMED",88,0)
 S DFN=$S(+GMRCDFN:GMRCDFN,$G(ORVP):+ORVP,1:0)
"RTN","GMRCMED",89,0)
 S GMRCVTIT="Medicine Result Display"
"RTN","GMRCMED",90,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,"DTLIST",999999),-1)
"RTN","GMRCMED",91,0)
 D EN^VALM("GMRC DETAILED DISPLAY")
"RTN","GMRCMED",92,0)
 M ^TMP("GMRCR",$J,"DT")=^TMP("GMRCR",$J,"DTSV")
"RTN","GMRCMED",93,0)
 K ^TMP("GMRCR",$J,"DTSV")
"RTN","GMRCMED",94,0)
 S VALMBCK="R",VALMCNT=$O(^TMP("GMRCR",$J,"DT",999999),-1)
"RTN","GMRCMED",95,0)
 Q
"RTN","GMRCMED",96,0)
 ;
"RTN","GMRCMED",97,0)
AR(ITEM) ;associate specific result and complete consult
"RTN","GMRCMED",98,0)
 I '+$G(^TMP("GMRCR",$J,"DT",1,1)) D  Q  ; no result there
"RTN","GMRCMED",99,0)
 . D EXAC^GMRCADC("There are no results to associate")
"RTN","GMRCMED",100,0)
 N DIR,X,Y,RESTXT,RESULT
"RTN","GMRCMED",101,0)
 I '$G(ITEM),'$G(GMRCMEDR) D  Q:'ITEM
"RTN","GMRCMED",102,0)
 . S ITEM=$$SELECT(VALMCNT)
"RTN","GMRCMED",103,0)
 . D SET(ITEM)
"RTN","GMRCMED",104,0)
 I $G(GMRCMEDR) S ITEM=GMRCMEDR
"RTN","GMRCMED",105,0)
 D FULL^VALM1
"RTN","GMRCMED",106,0)
 S RESTXT=$E(^TMP("GMRCR",$J,"DT",ITEM,0),6,80)
"RTN","GMRCMED",107,0)
 S RESULT=^TMP("GMRCR",$J,"DT",ITEM,1) Q:'+RESULT
"RTN","GMRCMED",108,0)
 I $D(^GMR(123,"R",RESULT)) D  Q
"RTN","GMRCMED",109,0)
 . D EXAC^GMRCADC("This result is already associated with a procedure.")
"RTN","GMRCMED",110,0)
 S DIR(0)="YA",DIR("B")="NO"
"RTN","GMRCMED",111,0)
 S DIR("A",1)="",DIR("A",2)="   "_RESTXT,DIR("A",3)=""
"RTN","GMRCMED",112,0)
 S DIR("A")="Are you sure you want to associate this result? "
"RTN","GMRCMED",113,0)
 D ^DIR I Y<1 Q
"RTN","GMRCMED",114,0)
 D MEDCOMP(GMRCO,RESULT,$$NOW^XLFDT,DUZ)
"RTN","GMRCMED",115,0)
 Q
"RTN","GMRCMED",116,0)
MEDCOMP(GMRCDA,GMRCRSLT,GMRCAD,GMRCORNP,GMRCALRT) ;add medicine result
"RTN","GMRCMED",117,0)
 ; update status and send alerts
"RTN","GMRCMED",118,0)
 ;  Input:
"RTN","GMRCMED",119,0)
 ;   GMRCDA - ien from file 123
"RTN","GMRCMED",120,0)
 ;   GMRCRSLT - medicine result in var ptr form (e.g. "19;MCAR(691.5,")
"RTN","GMRCMED",121,0)
 ;   GMRCAD   - FM date/time of action (optional)
"RTN","GMRCMED",122,0)
 ;   GMRCORNP - DUZ of person taking action
"RTN","GMRCMED",123,0)
 ;   GMRCALRT - array of users to receive alert  (optional)
"RTN","GMRCMED",124,0)
 ;
"RTN","GMRCMED",125,0)
 I '$D(GMRCDA)!'$D(GMRCRSLT) Q
"RTN","GMRCMED",126,0)
 N GMRCO,GMRCSTS,GMRCA,GMRCDR,GMRCTYP,MSG
"RTN","GMRCMED",127,0)
 S GMRCO=GMRCDA,GMRCA=10,GMRCSTS=2
"RTN","GMRCMED",128,0)
 S GMRCDR="8////^S X=GMRCSTS;9////^S X=GMRCA;11////^S X=GMRCRSLT"
"RTN","GMRCMED",129,0)
 D STATUS^GMRCP
"RTN","GMRCMED",130,0)
 I $D(GMRCAD) D AUDIT^GMRCP
"RTN","GMRCMED",131,0)
 I '$D(GMRCAD) D AUDIT0^GMRCP
"RTN","GMRCMED",132,0)
 D ADDRSLT^GMRCTIUA(GMRCDA,GMRCRSLT)
"RTN","GMRCMED",133,0)
 S MSG="NEW RESULT ASSOCIATED",GMRCDFN=$P(^GMR(123,GMRCO,0),U,2)
"RTN","GMRCMED",134,0)
 D MSG^GMRCP(GMRCDFN,MSG,GMRCDA,23,.GMRCALRT,0)
"RTN","GMRCMED",135,0)
 S GMRCTYP=$P(^GMR(123,+GMRCDA,0),U,17)
"RTN","GMRCMED",136,0)
 D EN^GMRCHL7(GMRCDFN,GMRCDA,GMRCTYP,"","RE",$G(GMRCORNP),"")
"RTN","GMRCMED",137,0)
 Q
"RTN","GMRCMED",138,0)
REFRESH(GMRCIEN) ;update list of available results
"RTN","GMRCMED",139,0)
 N MCROOT,MCPROC,GMRCPROC
"RTN","GMRCMED",140,0)
 I $G(GMRCMEDR) D RESETIT(GMRCMEDR)
"RTN","GMRCMED",141,0)
 K ^TMP("GMRCR",$J,"DT"),GMRCMEDR
"RTN","GMRCMED",142,0)
 S GMRCPROC=$P(^GMR(123,GMRCIEN,0),"^",8)
"RTN","GMRCMED",143,0)
 S MCROOT=$$GET1^DIQ(697.2,+$P(^GMR(123.3,+GMRCPROC,0),U,5),1)
"RTN","GMRCMED",144,0)
 D RESULTS^GMRCMED(MCROOT,$P(^GMR(123,+GMRCIEN,0),U,2))
"RTN","GMRCMED",145,0)
 I '$O(^TMP("GMRCR",$J,"DT",0)) D
"RTN","GMRCMED",146,0)
 . S ^TMP("GMRCR",$J,"DT",1,0)="No further results to associate"
"RTN","GMRCMED",147,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,"DT",""),-1)
"RTN","GMRCMED",148,0)
 S VALMBCK="R"
"RTN","GMRCMED",149,0)
 Q
"RTN","GMRCMED",150,0)
 ;
"RTN","GMRCMED",151,0)
SCRNDRFT(GMRCMCDA,GMRCMCFL) ;screen out draft or marked for del med results
"RTN","GMRCMED",152,0)
 ; Input:
"RTN","GMRCMED",153,0)
 ;   GMRCDA   - ien from a MEDICINE file
"RTN","GMRCMED",154,0)
 ;   GMRCMCFL - file # from MEDICINE  (e.g. 691, 691.5, 699 etc.)
"RTN","GMRCMED",155,0)
 ; Output: Boolean 1=screen it out 0=include it
"RTN","GMRCMED",156,0)
 ;
"RTN","GMRCMED",157,0)
 N GMRCMCST,GMRCMFD
"RTN","GMRCMED",158,0)
 I '$D(GMRCMCDA)!('$D(GMRCMCFL)) Q 0
"RTN","GMRCMED",159,0)
 S GMRCMCST=$$GET1^DIQ(GMRCMCFL,GMRCMCDA,1506,"I") ;get release code
"RTN","GMRCMED",160,0)
 S GMRCMCST=$S(GMRCMCST="D":0,GMRCMCST="PD":0,1:1) ;no D or PD
"RTN","GMRCMED",161,0)
 S GMRCMFD=$$GET1^DIQ(GMRCMCFL,GMRCMCDA,1511,"I") ;marked for del?
"RTN","GMRCMED",162,0)
 I GMRCMFD=1 Q 1 ;marked for del
"RTN","GMRCMED",163,0)
 I GMRCMCST=0 Q 1 ;screen out draft or prob draft
"RTN","GMRCMED",164,0)
 Q 0
"VER")
8.0^22.0
"BLD",6294,6)
^48
**END**
**END**
