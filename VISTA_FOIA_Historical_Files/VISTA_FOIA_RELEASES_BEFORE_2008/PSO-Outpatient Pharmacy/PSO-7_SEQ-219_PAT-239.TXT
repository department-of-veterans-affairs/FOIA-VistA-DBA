$TXT Created by ELLZEY,LINDA at DEVFEX.FO-ALBANY.MED.VA.GOV  (KIDS) on Monday, 09/18/06 at 15:47
=============================================================================
Run Date: OCT 17, 2006                     Designation: PSO*7*239
Package : PSO - OUTPATIENT PHARMACY           Priority: Mandatory
Version : 7       SEQ #219                      Status: Released
                  Compliance Date: NOV 17, 2006
=============================================================================

Associated patches: (v)PSO*7*148   <<= must be installed BEFORE `PSO*7*239'
                    (v)PSO*7*226   <<= must be installed BEFORE `PSO*7*239'
                    (v)PSO*7*235   <<= must be installed BEFORE `PSO*7*239'
                    (v)PSO*7*237   <<= must be installed BEFORE `PSO*7*239'

Subject: CIDC FOLLOW-UP PATCH 3

Category: 
  - Routine
  - Enhancement (Mandatory)

Description:
============

  
 Functional Description:
 =======================
 The following describes all of the changes included in this patch:
  
 1.  For Remedy Ticket 130112:
  
 After installation of patch PSO*7*226, it was reported that the activity
 log entries generated by the patch were confusing. A large part of patch
 PSO*7*226 was to cancel any erroneously billed copays and to define any
 missing IBQ nodes on the prescription using the SC/EI answers stored on
 the ICD node.  For those prescriptions where the IBQ node was defined, an
 activity log entry was created with a reason of "RETURNED".  For those
 prescriptions where copay was cancelled, a copay activity log was
 generated. The following are examples of those types of entries made by
 PSO*7*226.
  
 Activity Log Example:
  
   1   11/28/05    X-INTERFACE    ORIGINAL       PHARMACIST,ONE
     Comments: Prescription sent to external interface.
   2   11/28/05    RETURNED       ORIGINAL       POSTMASTER
     Comments:  BKGD CIDC UPDATE
   3   11/29/05    X-INTERFACE    REFILL 1       PHARMACIST,TWO
     Comments: Prescription sent to external interface.
  
 Copay Activity Log Example:
  
   1   02/01/06    COPAY RESET          ORIGINAL       PHARMACIST,ONE
     Comment:-BKGD CIDC COPAY CANCEL  Old value=Copay   New value=No Copay
   2   02/01/06    REMOVE COPAY CHARGE  ORIGINAL       PHARMACIST,ONE
     Comment: RX EDITED -BKGD CIDC COPAY CANCEL
  
 To eliminate any confusion, patch PSO*7*239 provides an Activity Log 
 Correction process/Clean-up routine.  This routine will take the activity
 log entries created by patch PSO*7*226, move them to the copay activity
 log, and then subsequently will delete the activity log entries.  Also,
 the comment on the copay activity log entries where copay was cancelled as
 well as those entries moved to the copay activity log will be changed to
 "CIDC CLEANUP".  The activity log will be resequenced to eliminate any
 missing nodes, and the copay activity log will be resequenced to insert
 the new entries by date and time.  The following are examples of the
 updated entries:
  
   -Note that sequence two from the above example was removed and the
    third sequence was moved up.
  
   1   11/28/05    X-INTERFACE    ORIGINAL       PHARMACIST,ONE
     Comments: Prescription sent to external interface.
   2   11/28/05    X-INTERFACE    REFILL 1       PHARMACIST,TWO
     Comments: Prescription sent to external interface.
  
   -The next entry shows an Activity log entry moved to Copay Activity log:
  
   1   11/28/05    COPAY RESET       ORIGINAL         POSTMASTER
     Comment: CIDC CLEANUP
  
   -The following shows a cancelled Copay Activity Log entry comment
   updated to "CIDC CLEANUP:
  
   1   02/01/06    COPAY RESET          ORIGINAL       POSTMASTER
     Comment: CIDC CLEANUP  Old value=Copay   New value=No Copay
   2   02/01/06    REMOVE COPAY CHARGE  ORIGINAL       POSTMASTER
     Comment: CIDC CLEANUP  
  
 This patch provides a listing of all prescriptions where the activity log
 was updated by the Clean-up routine, a means of checking the status of the
 Clean-up routine, and a means of stopping the Clean-up job if needed.  A
 detailed description of these functions is located in the Technical
 description.
  
 When installing this patch, the activity log Clean-up portion of this
 patch is optional.  However, it is highly recommended that it be run for 
 consistency and maintainability.
  
 Once the Clean-up routine has completed a mailman message will be sent to 
 the user who installed the patch.  The following is an example:
  
     Subj: Outpatient Pharmacy PSO*7*239 CIDC ACTIVITY LOGS CORRECTION  
     [#200121] 03/06/06@13:56  4 lines
     From: PSO*7*239 CIDC ACTIVITY LOGS CORRECTION  In 'IN' basket.   Page
     1 *New*
     -------------------------------------------------------------------------
     The CIDC ACTIVITY LOGS CORRECTION job for the Outpatient Pharmacy
     patch (PSO*7*239) started MAR 06, 2006@13:56:04
     and completed MAR 06, 2006@13:56:04.
  
     Enter message action (in IN basket): Ignore//
  
 2. The following issues were found during unit testing for backdoor 
 Outpatient Pharmacy orders, and the corrections are included in this
 patch. 
  
 A.  When a prescriptions with an exempt patient status is renewed and the
 user changes the value of service connected (SC), the default value was
 stored instead of the changed value.  This only occurred for the SC
 prompt.  The renew process has been modified to store the changed value.
  
 B.  When prescription information was stored when the RX Patient Status 
 was exempt from copay, the IBQ node was being stored needlessly.  This
 patch will remove the functionality that stored this node.
                                            
 C.  For a patient defined as SC<50 but had a null SC percentage value 
 defined, backdoor Outpatient Pharmacy was asking the SC prompt but not
 storing the answers. The SC prompt is only displayed for those
 prescriptions that the Scheduling DBIA #1579 and/or the Integrated 
 Billing (IB) DBIA #125 determines that it should be asked.  Upon release
 of the fill, a "PRESCRIPTION QUESTIONS REVIEW NEEDED" mailman message
 requesting entry of the SC field was sent to holders of the PSO COPAY
 key.  Because this functionality uses the same checking mechanism as
 non-exempt new orders, the following functions were affected by this
 change:  copies, renews and edits that create a new order. This patch will
 store the SC answer for null SC percentage values.
  
 D.  The SC prompt was not asked in Computerized Patient Record System 
 (CPRS), but was asked in backdoor Outpatient Pharmacy. No default answer
 was shown in backdoor due to the question not being asked in CRPS.  This
 occurred for any SC percentage that the SDCO22 API (#1579) returned a
 value that indicated to not ask the SC question but IB returned a flag
 that indicated that the SC question should be asked.  This problem occurs
 for a variety of SC percentages based on how the patient's eligibility is
 defined in enrollment.  This patch will tell CPRS to ask SC for this
 scenario.
  
 E.  It was found that edits made to SC and/or EI's during COMPLETE ORDERS
 FROM OERR [PSO LMOE FINISH] option and the finish function in the PATIENT
 PRESCRIPTION PROCESSING [PSO LM BACKDOOR ORDERS] option were not reflected
 in CPRS.  With the CIDC patches, a new standardized segment was created to
 pass SC, EI's and ICD-9 diagnosis codes and use of the old segment was
 discontinued. When the CPRS CIDC switch is off, CPRS is looking at the old
 segment for updated orders. This patch adds the functionality to send both
 ZSC and ZCL segments.
  
 F.  When using the edit function in the PATIENT PRESCRIPTION PROCESSING
 option [PSO LM BACKDOOR ORDERS], the total number of entries in the ICD
 DIAGNOSIS multiple (#52311) was being defined as one number less than it
 should have been.  For example, eight diagnosis codes entered but the 
 multiple shows seven as the total number of entries for the multiple.  The
 diagnosis codes were displayed correctly to the user.  This patch will
 store the correct number of entries when edits are performed.
  
 G.  The PSOHLNE3 API IA (#4666) was defining an activity log entry that 
 stated "Clinical Indicators and SC/EI's were updated from a CPRS e-sig 
 edit..." for all prescriptions passed through the API.  Also, it was 
 needlessly defining a copay activity log entry for supply items and
 investigational drugs.   Last, it was storing a copay activity log entry
 (copay to no copay) that was set erroneously when the provider edits
 SC/EI's during sign of a verbal/telephone order leaving the prescription
 as no copay.  This API is used to pass data from CPRS to OP when a verbal
 or telephone order is signed in CPRS when the CPRS CIDC Switch is on.  
 This patch limits the setting of the activity log to only those
 prescriptions where SC, EI's and/or ICD's were changed during sign order.
 And, it eliminates setting the copay activity log for supply items and
 investigational drugs as well as eliminating the erroneous "copay to no 
 copay" activity log entry.
  
 H.  The RESET COPAY STATUS/CANCEL CHARGES option [PSOCP RESET COPAY 
 STATUS] was overlaying the previously stored diagnosis code when storing
 updated information.  Also, the default answer for SC was not being
 displayed for SC<50% patients.  This patch corrects these issues.
  
 I.  When the CPRS CIDC switch is turned on, the B cross reference was 
 not being defined in the ICD DIAGNOSIS field (#311) in PENDING OUTPATIENT
 ORDERS file (#52.41).  For telephone/verbal orders signed in CPRS and 
 CPRS renewals, the B cross reference was not being defined in the ICD
 DIAGNOSIS field (#52311) in PRESCRIPTION file (#52).  This was not
 reported as an issue, but the correction is being made in this patch.
  
  
 Technical Descriptions:
 =======================
 1.  For Remedy Ticket 130112:
  
 A.  A snapshot of the ACTIVITY LOG sub-file (#40) and the COPAY 
 ACTIVITY LOG sub-file (#107) will be stored in ^XTMP("PSOCIDC7") node,
 and will be available for 90 days.
  
 B.  The "BKGD CIDC UPDATE" activity log entry will be removed and the 
 ACTIVITY LOG sub-file (#40) will be re-subscripted to eliminate the
 missing node. The removed entry will be inserted in the COPAY ACTIVITY LOG
 sub-file (#107).  The date given in the old activity log entry will be
 used as the COPAY ACTIVITY LOG field (#.01) for the new entry. The copay
 activity log will be sorted by dates within the existing entries and
 including the new entry, then they will be stored back into the COPAY
 ACTIVITY LOG sub-file (#107). The comment for the new copay activity log
 entry as well as any existing copay activity log entries will be changed
 to state "CIDC CLEANUP" instead of "BKGD CIDC UPDATE".
  
 C.  Because the copay to no copay or vice versa information was not 
 recorded in the old Activity log entry, those values can only reflect the 
 current state of the prescription, and it's thought that they should not
 be stored on the new entry.
  
 D.  To print the report of all prescriptions updated by the Clean-up 
 routine, type the following from the programmer's prompt using the print 
 device that you prefer.
  
      >D RPT^PSOCIDC9
       DEVICE: HOME//     UCX/TELNET     RIGHT MARGIN:80//
  
     Patch PSO*7*239 - Corrected Activity and Copay Activity logs
  
      Note that this report reflects all prescriptions where the activity
      and/or copay activity logs were corrected. For detailed information,
      please view the activity and copay activity log on the prescription.
  
      Date printed: MAR 6,2006@14:09:25                       Page: 1
      ===============================================================
      PATIENT NAME     (SSN)       DIV          RX# 
      ---------------  -------  --------------  ------------
      PATIENT,ONE      (B3453)  TROY, NY        200037
      BPATIENT,TWO     (B0033)  TROY, NY        200049
      BPATIENT,TWO     (B0033)  TROY, NY        200050
  
 E.  The following is an example of a status query for the Clean-up 
 routine, and it must be run from programmer's mode:
  
      >D STATUS^PSOCIDC7
     
       Currently processing:
             Date being processed > Nov 3, 2005
                             RX # > 1375666
  
 F.  A stop function has been provided in case the system needs to be
 shut down for an emergency or other reason.  Then when the system is back
 up and you are ready you may restart the job, it will resume where it
 left off.  You may restart by entering D ^PSOCIDC7 at the programmer's
 prompt.  The following is an example:
  
      >D STOP^PSOCIDC7
  
       Outpatient Activity Logs Correction Job - set to STOP Soon
  
       Check Status to be sure it has stopped and is not running...
         
                    (D STATUS^PSOCIDC7)
  
 G.  The Clean-up routine can be executed from the programmer's 
 prompt instead of through the patch installation.  Also, restarting the
 Clean-up routine after using the stop function described above is 
 performed in the same manner.  Below is an example how to perform this 
 function:
  
      >D ^PSOCIDC7
  
      ****************** SELECT RUN OPTION ******************
      Do you want to run the activity logs correction process? Y or N// YES
      Enter when to Queue the CIDC ACTIVITY LOGS CORRECTION job to run in 
      date@time format:  NOW//
  
      ===================================================
      Queuing background job for CIDC ACTIVITY LOGS CORRECTION...
      Start time: Month day, year@time
      ===================================================
      *** Task #NNNNN Queued! ***
  
  
 2. The following correlates to the items described in number two in the
 Functional Description section:
  
 A. The renew process has been modified to store the changed value
 for SC in the PRESCRIPTION file (#52).
  
 B. This patch will remove all of the functionality that stored the
 unnecessary IBQ node.
  
 C.  Outpatient was modified to store the SC value for patients with a null
 SC percentage which eliminates the sending of a "PRESCRIPTION QUESTIONS
 REVIEW NEEDED" Mailman message.
  
 D.  The check for the PSOSCMX variable was restored to the PSOCP
 routine.  
  
 E.  This patch adds the functionality to send both ZSC and ZCL segments to
 CPRS. The ZSC passes SC/EI's only.  The ZCL node passes SC, EI's, and
 ICD-9 Diagnosis codes.
  
 F.  This patch will correctly store the third and fourth piece of the zero
 node of the ICD DIAGNOSIS multiple (#52311) of PRESCRIPTION file (#52).
  
 G.  The PSOHLNE3 API IA (#4666) was changed to only store entries in the 
 ACTIVITY LOG multiple (#40) when SC, EI's, and/or ICD's were edited.  
 For supply items and investigational drugs, no copay activity log entries 
 will be stored.  Also, it was modified to prevent storage of a copay
 activity log entry (copay to no copay) that was set erroneously when the
 provider edits SC/EI's during sign of a verbal/telephone order leaving the
 prescription as no copay.
  
 H.  The RESET COPAY STATUS/CANCEL CHARGES [PSOCP RESET COPAY STATUS] 
 option has been modified to not overlay the previously stored 
 ICD-9 Diagnosis code with a null value and to display previously entered
 SC values as a default answer.
  
 I.  The B cross reference will be set for the ICD DIAGNOSIS field (#311)
 in PENDING OUTPATIENT ORDERS file (#52.41) and in the ICD DIAGNOSIS field
 (#52311) in PRESCRIPTION file (#52) for CPRS renewals/verbal/telephone 
 orders.
  
  
 Associated New Service Request (NSR):
 =====================================
 N/A 
  
  
 Associated Remedy Ticket(s):
 ============================
 130112
  
  
 Associated E3Rs:
 ===============
 N/A
  
  
 Test Sites:
 ==========
 CLEVELAND, OH
 DAYTON, OH
 BOSTON, MA
 TUSCALOOSA, AL
  
  
 Routine Summary:
 ================                    
 The second line now reads as follows:
  
    <TAB>;;7.0;OUTPATIENT PHARMACY;**[patch list]**;DEC 1997
  
 CHECK^XTSUMBLD results:
  
 Routine     Before Patch  After Patch   Patch List
 ==========================================================================
 PSOCIDC7             N/A     12649656   239
 PSOCIDC8             N/A     11130561   239
 PSOCIDC9             N/A      6898634   239
 PSOCP           21618068     20083736   20,46,71,85,137,157,143,219,239
 PSOCP1           1406109      2430520   137,239
 PSOCPB          31710625     30983878   72,71,85,185,143,219,239
 PSOCPC          25435754     25194285   10,9,71,85,114,157,143,239
 PSODIAG         21605445     21722514   143,219,239
 PSOHLNE1        26192765     26214814   1,9,46,71,98,111,117,131,157,
                                              181,143,235,239
 PSOHLNE3        20707004     21660394   143,239
 PSOHLNEW        37073735     36821032   1,7,15,46,71,98,111,124,117,131,
                                              146,132,143,223,235,148,239
 PSOHLSN1        32226214     30431547   1,10,24,27,55,46,71,101,99,121,
                                              139,157,181,143,235,239
 PSOHLSN2         2827037      5332696   143,226,239
 PSOMLLD2        17414283     14273640   143,219,239
 PSON52          24231323     23824880   1,16,23,27,32,46,71,111,124,117,
                                              131,139,157,143,219,148,239
 PSONEW2         13388647     13142998   32,37,46,71,94,124,139,157,
                                              143,226,237,239
 PSONEWF         25455623     19021360   71,157,143,219,226,239 
 PSONEWG         13945471     14049172   71,157,143,219,226,239
 PSORENW1        25287539     26949235   20,37,51,46,71,117,157,143,219,239
 PSORN52         19739915     20042374   1,11,27,37,46,79,71,100,117,157,
                                              143,219,148,239
 PSORN52D        21621894     14345325   143,219,239
  
 Total number of routines: 21
  
  
 File Summary:
 =============
 N/A
  
  
 Field Summary:
 ==============
 N/A
  
  
 Installation Instructions:
 ==========================
 ** Warning, please do not queue this patch to be installed.  It has
 ** install questions that need to be answered.
  
 It is recommended that this patch not be installed while Outpatient
 Pharmacy users are on the system or when Outpatient Pharmacy orders are
 being entered and signed through CPRS. Installation will take no longer
 than 5 minutes, but the activity log Clean-up process may take several
 hours.
  
 Suggested time to install: During non-peak.
  
 Once the activity log correction/Clean-up process is completed, you will
 receive a Mailman messages defined in the above functional description.  
 Also noted above in the technical description are examples of how to check
 the status of the Clean-up job, how to stop the Clean-up job if needed,
 and how to print a report of prescriptions affected by the Clean-up
 process.
  
 1.  Use the INSTALL/CHECK MESSAGE option on the PackMan menu.
  
 2.  From the Kernel Installation & Distribution System menu, select the
     Installation menu.  
  
 3.  From this menu, you may select to use the following options: 
     (when prompted for INSTALL NAME, enter PSO*7.0*239)
    
     a.  Backup a Transport Global - this option will create a backup
         message of any routines exported with the patch.  It will
         NOT backup any other changes such as DDs or templates.
     b.  Compare Transport Global to Current System  - this option
         will allow you to view all changes that will be made when
         the patch is installed.  It compares all components of the
         patch (routines, DDs, templates, etc.).
     c.  Verify Checksums in Transport Global - this option will
         allow you to ensure the integrity of the routines that are
         in the transport global.
     d.  Print Transport Global - this option will allow you to view
         the components of the KIDS build.
     
 4.  Use the Install Package(s) option and select the package
     PSO*7.0*239.
     
 5.  When prompted "Do you want to Run the activity log correction 
     process? Y or N// , enter Y for YES to run Clean-up for the activity
     log entries or enter N for NO to not run the Clean-up process.  If
     this prompt is allowed to time out, the activity log Clean-up job
     will not run.  The length of time until the prompt times out is
     dependent on the time out length defined for your system.
  
 6.  Note that the following prompt will not be displayed if 'NO' was 
     answered for the previous question.  When prompted "Enter when to
     Queue the Job to run in date@time format: NOW//", press
     enter to start the process now or enter a future time to start this
     job in date@time format.  If this prompt is allowed to time out, the 
     job will run for the current time.  The length of time until the
     prompt times out is dependent on the time out length defined for your
     system.
  
 7.  When prompted 'Want KIDS to INHIBIT LOGONs during the install?
     YES//', respond NO
  
 8.  When prompted 'Want to DISABLE Scheduled Options, Menu Options, and
     Protocols? YES//', respond NO.
  
 9.  When prompted,"Device:Home//" respond with the correct device and DO 
     NOT queue this to P-Message.

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: PSOCIDC7
    Before:       n/a  After: B43535396  **239**
Routine Name: PSOCIDC8
    Before:       n/a  After: B28837769  **239**
Routine Name: PSOCIDC9
    Before:       n/a  After: B14993294  **239**
Routine Name: PSOCP
    Before: B75128860  After: B68323456  **20,46,71,85,137,157,143,219,239**
Routine Name: PSOCP1
    Before:  B2595305  After:  B5020940  **137,239**
Routine Name: PSOCPB
    Before: B82075464  After: B78420405  **72,71,85,185,143,219,239**
Routine Name: PSOCPC
    Before: B66994025  After: B67206155  **10,9,71,85,114,157,143,239**
Routine Name: PSODIAG
    Before: B63400905  After: B62418422  **143,219,239**
Routine Name: PSOHLNE1
    Before: B72765875  After: B72518246  **1,9,46,71,98,111,117,131,157,
                                          181,143,235,239**
Routine Name: PSOHLNE3
    Before: B58436703  After: B55635403  **143,239**
Routine Name: PSOHLNEW
    Before: B78866487  After: B77391528  **1,7,15,46,71,98,111,124,117,
                                          131,146,132,143,223,235,148,239**
Routine Name: PSOHLSN1
    Before: B86702182  After: B81359124  **1,10,24,27,55,46,71,101,99,
                                          121,139,157,181,143,235,239**
Routine Name: PSOHLSN2
    Before:  B4326292  After:  B9304423  **143,226,239**
Routine Name: PSOMLLD2
    Before: B22361376  After: B18734428  **143,219,239**
Routine Name: PSON52
    Before: B59165642  After: B58876503  **1,16,23,27,32,46,71,111,124,
                                          117,131,139,157,143,219,148,239**
Routine Name: PSONEW2
    Before: B31175329  After: B31577282  **32,37,46,71,94,124,139,157,
                                          143,226,237,239**
Routine Name: PSONEWF
    Before: B45034725  After: B35718015  **71,157,143,219,226,239**
Routine Name: PSONEWG
    Before: B22698688  After: B23242345  **71,157,143,219,226,239**
Routine Name: PSORENW1
    Before: B55639962  After: B64596305  **20,37,51,46,71,117,157,143,219,239**
Routine Name: PSORN52
    Before: B41220096  After: B42247336  **1,11,27,37,46,79,71,100,117,
                                          157,143,219,148,239**
Routine Name: PSORN52D
    Before: B45252333  After: B30768895  **143,219,239**

=============================================================================
User Information:
Entered By  : ELLZEY,LINDA                  Date Entered  : FEB 06, 2006
Completed By: LYNCH,MARY F.                 Date Completed: OCT 16, 2006
Released By : CONSENTINO,ALBERT             Date Released : OCT 17, 2006
=============================================================================


Packman Mail Message:
=====================

$END TXT
