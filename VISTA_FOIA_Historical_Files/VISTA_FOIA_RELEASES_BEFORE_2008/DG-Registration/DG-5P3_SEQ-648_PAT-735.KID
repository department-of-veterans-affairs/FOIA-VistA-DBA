Released DG*5.3*735 SEQ #648
Extracted from mail message
**KIDS**:DG*5.3*735^

**INSTALL NAME**
DG*5.3*735
"BLD",6912,0)
DG*5.3*735^REGISTRATION^0^3061121^y
"BLD",6912,1,0)
^9.61A^1^1^3061103^^^^
"BLD",6912,1,1,0)
Please refer to the National Patch Module for a description of this patch.
"BLD",6912,4,0)
^9.64PA^^0
"BLD",6912,6.3)
11
"BLD",6912,"ABPKG")
n
"BLD",6912,"INIT")
EP^DG53735P
"BLD",6912,"KRN",0)
^9.67PA^8989.52^19
"BLD",6912,"KRN",.4,0)
.4
"BLD",6912,"KRN",.401,0)
.401
"BLD",6912,"KRN",.402,0)
.402
"BLD",6912,"KRN",.403,0)
.403
"BLD",6912,"KRN",.5,0)
.5
"BLD",6912,"KRN",.84,0)
.84
"BLD",6912,"KRN",3.6,0)
3.6
"BLD",6912,"KRN",3.8,0)
3.8
"BLD",6912,"KRN",9.2,0)
9.2
"BLD",6912,"KRN",9.8,0)
9.8
"BLD",6912,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6912,"KRN",9.8,"NM",1,0)
DGRPE^^0^B61249824
"BLD",6912,"KRN",9.8,"NM","B","DGRPE",1)

"BLD",6912,"KRN",19,0)
19
"BLD",6912,"KRN",19.1,0)
19.1
"BLD",6912,"KRN",101,0)
101
"BLD",6912,"KRN",409.61,0)
409.61
"BLD",6912,"KRN",771,0)
771
"BLD",6912,"KRN",870,0)
870
"BLD",6912,"KRN",8989.51,0)
8989.51
"BLD",6912,"KRN",8989.52,0)
8989.52
"BLD",6912,"KRN",8994,0)
8994
"BLD",6912,"KRN","B",.4,.4)

"BLD",6912,"KRN","B",.401,.401)

"BLD",6912,"KRN","B",.402,.402)

"BLD",6912,"KRN","B",.403,.403)

"BLD",6912,"KRN","B",.5,.5)

"BLD",6912,"KRN","B",.84,.84)

"BLD",6912,"KRN","B",3.6,3.6)

"BLD",6912,"KRN","B",3.8,3.8)

"BLD",6912,"KRN","B",9.2,9.2)

"BLD",6912,"KRN","B",9.8,9.8)

"BLD",6912,"KRN","B",19,19)

"BLD",6912,"KRN","B",19.1,19.1)

"BLD",6912,"KRN","B",101,101)

"BLD",6912,"KRN","B",409.61,409.61)

"BLD",6912,"KRN","B",771,771)

"BLD",6912,"KRN","B",870,870)

"BLD",6912,"KRN","B",8989.51,8989.51)

"BLD",6912,"KRN","B",8989.52,8989.52)

"BLD",6912,"KRN","B",8994,8994)

"BLD",6912,"QUES",0)
^9.62^^
"BLD",6912,"REQB",0)
^9.611^1^1
"BLD",6912,"REQB",1,0)
DG*5.3*731^2
"BLD",6912,"REQB","B","DG*5.3*731",1)

"INIT")
EP^DG53735P
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
735^3061121^539
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3061121
"PKG",5,22,1,"PAH",1,1,1,0)
Please refer to the National Patch Module for a description of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DG53735P")
0^^B77535320^n/a
"RTN","DG53735P",1,0)
DG53735P ;EG,TMK - Re-transmit OEF-OIF Data to HEC ; 10/24/2006
"RTN","DG53735P",2,0)
 ;;5.3;Registration;**735**;Aug 13,1993;Build 11
"RTN","DG53735P",3,0)
 ; LOGIC USED:
"RTN","DG53735P",4,0)
 ; - Find all veterans with OEF/OIF data using the 'ALOEIF;' cross
"RTN","DG53735P",5,0)
 ;     reference by latest OEF/OIF TO DATE and patient
"RTN","DG53735P",6,0)
 ; - Check the PATIENT file (#2) record for a valid CV end date.
"RTN","DG53735P",7,0)
 ; - If the CV end date is not valid, or
"RTN","DG53735P",8,0)
 ;    If the CV End Date is valid, but the last Z07 message transmission
"RTN","DG53735P",9,0)
 ;      for the veteran was dated before the OEF/OIF data was added,
"RTN","DG53735P",10,0)
 ;   Flag the record so it will be sent to HEC via an HL7 Z07 message
"RTN","DG53735P",11,0)
 ;    and if the CV End date was not valid, update it to be the
"RTN","DG53735P",12,0)
 ;    calculated value.
"RTN","DG53735P",13,0)
 ;
"RTN","DG53735P",14,0)
EP ; Queue the conversion
"RTN","DG53735P",15,0)
 N %
"RTN","DG53735P",16,0)
 S %=$$NEWCP^XPDUTL("IEN12","POST^DG53735P")
"RTN","DG53735P",17,0)
 S %=$$NEWCP^XPDUTL("END","END^DG53735P") ; Leave as last update
"RTN","DG53735P",18,0)
 Q
"RTN","DG53735P",19,0)
 ;
"RTN","DG53735P",20,0)
POST N ZTSK
"RTN","DG53735P",21,0)
 D BMES^XPDUTL("Queue-ing Transmit OEF/OIF data to HEC ...")
"RTN","DG53735P",22,0)
 D QUE
"RTN","DG53735P",23,0)
 D BMES^XPDUTL("This request queued as Task # "_$G(ZTSK))
"RTN","DG53735P",24,0)
 D BMES^XPDUTL("=====================================================")
"RTN","DG53735P",25,0)
 D BMES^XPDUTL("")
"RTN","DG53735P",26,0)
 Q
"RTN","DG53735P",27,0)
 ;
"RTN","DG53735P",28,0)
END ; Post-install done
"RTN","DG53735P",29,0)
 D BMES^XPDUTL("Post install complete.")
"RTN","DG53735P",30,0)
 Q
"RTN","DG53735P",31,0)
 ;
"RTN","DG53735P",32,0)
QUE N ZTRTN,ZTDESC,ZTSAVE,ZTIO,ZTDTH
"RTN","DG53735P",33,0)
 S ZTRTN="RUN^DG53735P",ZTDESC="Re-transmit of OEF/OIF Data"
"RTN","DG53735P",34,0)
 S ZTIO="",ZTDTH=$$NOW^XLFDT()
"RTN","DG53735P",35,0)
 D ^%ZTLOAD
"RTN","DG53735P",36,0)
 Q
"RTN","DG53735P",37,0)
 ;
"RTN","DG53735P",38,0)
RUN ;entry point from taskman
"RTN","DG53735P",39,0)
 N NAMSPC
"RTN","DG53735P",40,0)
 S NAMSPC=$$NAMSPC
"RTN","DG53735P",41,0)
 I '$$CHKSTAT(1,NAMSPC) D  Q
"RTN","DG53735P",42,0)
 . D BMES^XPDUTL("Conversion routine already running, process aborted")
"RTN","DG53735P",43,0)
 N TESTING
"RTN","DG53735P",44,0)
 S TESTING="N" K ^XTMP(NAMSPC) D DEQUE(NAMSPC)
"RTN","DG53735P",45,0)
 Q
"RTN","DG53735P",46,0)
 ;
"RTN","DG53735P",47,0)
TEST ; test entry point
"RTN","DG53735P",48,0)
 N TESTING,X,STARTDT,ENDDT,NAMSPC
"RTN","DG53735P",49,0)
 S NAMSPC=$$NAMSPC
"RTN","DG53735P",50,0)
 S TESTING="Y"
"RTN","DG53735P",51,0)
 S X=$$CHKSTAT(0,NAMSPC)
"RTN","DG53735P",52,0)
 K ^XTMP(NAMSPC,"TEST RANGE"),^XTMP(NAMSPC,"TEST")
"RTN","DG53735P",53,0)
 S STARTDT=$$TESTID("Starting ")
"RTN","DG53735P",54,0)
 Q:'STARTDT
"RTN","DG53735P",55,0)
 S ENDDT=$$TESTID("Ending ")
"RTN","DG53735P",56,0)
 Q:'ENDDT
"RTN","DG53735P",57,0)
 I ENDDT<STARTDT W !,?10,"Ending To Date can't be less than starting To Date" Q
"RTN","DG53735P",58,0)
 S ^XTMP(NAMSPC,"TEST RANGE")=STARTDT_U_ENDDT
"RTN","DG53735P",59,0)
 D DEQUE(NAMSPC)
"RTN","DG53735P",60,0)
 Q
"RTN","DG53735P",61,0)
 ;
"RTN","DG53735P",62,0)
TESTID(MESS) ;
"RTN","DG53735P",63,0)
 N DGX,DIR,DTOUT,DUOUT,X,Y
"RTN","DG53735P",64,0)
 S DIR(0)="DA",DIR("A")=MESS_" To Date for OEF/OIF xref: "
"RTN","DG53735P",65,0)
 W !! D ^DIR K DIR
"RTN","DG53735P",66,0)
 S DGX=Y
"RTN","DG53735P",67,0)
 I $D(DUOUT)!$D(DTOUT) S DGX=""
"RTN","DG53735P",68,0)
 Q DGX
"RTN","DG53735P",69,0)
 ;
"RTN","DG53735P",70,0)
DEQUE(NAMSPC) ;
"RTN","DG53735P",71,0)
 N X
"RTN","DG53735P",72,0)
 I '$D(TESTING) N TESTING S TESTING="N"
"RTN","DG53735P",73,0)
 D SETUPX(90,NAMSPC)
"RTN","DG53735P",74,0)
 S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53735P",75,0)
 S $P(X,U,6)="RUNNING"
"RTN","DG53735P",76,0)
 S $P(X,U,7)=$$NOW^XLFDT()
"RTN","DG53735P",77,0)
 S ^XTMP(NAMSPC,0,0)=X
"RTN","DG53735P",78,0)
 ;
"RTN","DG53735P",79,0)
 S ZTSTOP=$$LOOP(NAMSPC,TESTING)
"RTN","DG53735P",80,0)
 S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53735P",81,0)
 S $P(X,U,6)=$S(ZTSTOP:"STOPPED",1:"COMPLETED")
"RTN","DG53735P",82,0)
 S $P(X,U,8)=$$NOW^XLFDT()
"RTN","DG53735P",83,0)
 S ^XTMP(NAMSPC,0,0)=X
"RTN","DG53735P",84,0)
 ;
"RTN","DG53735P",85,0)
 D MAIL(NAMSPC,TESTING,DUZ)
"RTN","DG53735P",86,0)
 K TESTING
"RTN","DG53735P",87,0)
 L -^XTMP(NAMSPC)
"RTN","DG53735P",88,0)
 Q
"RTN","DG53735P",89,0)
 ;
"RTN","DG53735P",90,0)
SETUPX(EXPDAYS,NAMSPC) ; 
"RTN","DG53735P",91,0)
 ; requires EXPDAYS - # of days to keep XTMP
"RTN","DG53735P",92,0)
 N BEGTIME,PURGDT
"RTN","DG53735P",93,0)
 S BEGTIME=$$NOW^XLFDT()
"RTN","DG53735P",94,0)
 S PURGDT=$$FMADD^XLFDT(BEGTIME,EXPDAYS)
"RTN","DG53735P",95,0)
 S ^XTMP(NAMSPC,0)=PURGDT_U_BEGTIME
"RTN","DG53735P",96,0)
 S $P(^XTMP(NAMSPC,0),U,3)="Transmit unsent OEF/OIF data to HEC"
"RTN","DG53735P",97,0)
 Q
"RTN","DG53735P",98,0)
 ;
"RTN","DG53735P",99,0)
LOOP(NAMSPC,TESTING) ;
"RTN","DG53735P",100,0)
 ;returns stop flag
"RTN","DG53735P",101,0)
 N X,XREC,LASTREC,TOTREC,TOTPAT
"RTN","DG53735P",102,0)
 S LASTREC="0;0;;0;0",ZTSTOP=0
"RTN","DG53735P",103,0)
 S TOTREC=0
"RTN","DG53735P",104,0)
 I $D(^XTMP(NAMSPC,0,0)) D
"RTN","DG53735P",105,0)
 . S XREC=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53735P",106,0)
 . ;last TODT processed
"RTN","DG53735P",107,0)
 . S LASTREC=$P(XREC,U,1)
"RTN","DG53735P",108,0)
 . ;total records read
"RTN","DG53735P",109,0)
 . S TOTREC=+$P(XREC,U,2)
"RTN","DG53735P",110,0)
 . S TOTPAT=+$P(XREC,U,10)
"RTN","DG53735P",111,0)
 . Q
"RTN","DG53735P",112,0)
 D ALOEIF(NAMSPC,TESTING,.ZTSTOP)
"RTN","DG53735P",113,0)
 Q ZTSTOP
"RTN","DG53735P",114,0)
 ;
"RTN","DG53735P",115,0)
ALOEIF(NAMSPC,TESTING,ZTSTOP) ;
"RTN","DG53735P",116,0)
 N CONF,DFN,END,FIRST,FRDT,IEN,TODT,X
"RTN","DG53735P",117,0)
 S ZTSTOP=0
"RTN","DG53735P",118,0)
 S TODT=$P(LASTREC,";"),END=9999999
"RTN","DG53735P",119,0)
 I $G(TESTING)="Y" D
"RTN","DG53735P",120,0)
 . S X=$G(^XTMP(NAMSPC,"TEST RANGE"))
"RTN","DG53735P",121,0)
 . I $L(X) S TODT=$P(X,U,1)-1,END=$P(X,U,2)
"RTN","DG53735P",122,0)
 S FIRST("FRDT")=$P(LASTREC,";",2),FIRST("CONF")=$P(LASTREC,";",3),FIRST("DFN")=$P(LASTREC,";",4),FIRST("IEN")=$P(LASTREC,";",5)
"RTN","DG53735P",123,0)
 F  S TODT=$O(^DPT("ALOEIF",TODT)) Q:'TODT!ZTSTOP  S:TODT>END ZTSTOP=2 Q:ZTSTOP  S FRDT=FIRST("FRDT"),FIRST("FRDT")=0 F  S FRDT=$O(^DPT("ALOEIF",TODT,FRDT)) Q:'FRDT!ZTSTOP  S CONF=FIRST("CONF"),FIRST("CONF")="" D
"RTN","DG53735P",124,0)
 . F  S CONF=$O(^DPT("ALOEIF",TODT,FRDT,CONF)) Q:CONF=""!ZTSTOP  S DFN=FIRST("DFN"),FIRST("DFN")=0 F  S DFN=$O(^DPT("ALOEIF",TODT,FRDT,CONF,DFN)) Q:'DFN!ZTSTOP  S IEN=FIRST("IEN"),FIRST("IEN")=0 D
"RTN","DG53735P",125,0)
 .. F  S IEN=$O(^DPT("ALOEIF",TODT,FRDT,CONF,DFN,IEN)) Q:'IEN!ZTSTOP  D CHKR(DFN,IEN)
"RTN","DG53735P",126,0)
 Q
"RTN","DG53735P",127,0)
 ;
"RTN","DG53735P",128,0)
CHKR(DFN,IEN) ;
"RTN","DG53735P",129,0)
 N X,CEN,CALC
"RTN","DG53735P",130,0)
 ; Assume TODT,FRDT,CONF,TOTREC,LASTREC,TOTPAT,NAMSPC are defined
"RTN","DG53735P",131,0)
 S TOTREC=TOTREC+1
"RTN","DG53735P",132,0)
 ;
"RTN","DG53735P",133,0)
 ; Chk for correct CV End Date
"RTN","DG53735P",134,0)
 I '$$CHPAT(DFN,.CEN,.CALC) D
"RTN","DG53735P",135,0)
 . D TRANSMIT(DFN)
"RTN","DG53735P",136,0)
 ;
"RTN","DG53735P",137,0)
 E  D  ; If CV End Date OK, must be transmitted after OEF/OIF filed
"RTN","DG53735P",138,0)
 . N LD,LTR,LOEIF
"RTN","DG53735P",139,0)
 . S LD=$$YEAR^IVMPLOG(DFN),LTR=$P($G(^IVM(301.5,+$O(^IVM(301.5,"APT",DFN,+LD,0)),0)),U,5)
"RTN","DG53735P",140,0)
 . S LOEIF=$P($G(^DPT(DFN,.3215,IEN,0)),U,5)
"RTN","DG53735P",141,0)
 . I $S('LD!'LTR:1,LOEIF>LTR:1,1:0) D
"RTN","DG53735P",142,0)
 .. D SET(DFN,CEN,CALC,"OEF/OIF DATA NOT TX")
"RTN","DG53735P",143,0)
 .. D TRANSMIT(DFN)
"RTN","DG53735P",144,0)
 ;
"RTN","DG53735P",145,0)
 S LASTREC=TODT_";"_FRDT_";"_CONF_";"_DFN_";"_IEN
"RTN","DG53735P",146,0)
 D UPDATEX(NAMSPC,TOTREC,LASTREC,TOTPAT)
"RTN","DG53735P",147,0)
 ;
"RTN","DG53735P",148,0)
 I (TOTREC#100)=0 S ZTSTOP=$$STOP(NAMSPC)
"RTN","DG53735P",149,0)
 Q
"RTN","DG53735P",150,0)
 ;
"RTN","DG53735P",151,0)
TRANSMIT(DFN) ;
"RTN","DG53735P",152,0)
 S TOTPAT=TOTPAT+1
"RTN","DG53735P",153,0)
 Q:TESTING="Y"  ; No update
"RTN","DG53735P",154,0)
 D EVENT^IVMPLOG(DFN)
"RTN","DG53735P",155,0)
 Q
"RTN","DG53735P",156,0)
 ;
"RTN","DG53735P",157,0)
CHPAT(DFN,CEN,CALC) ; Function returns:
"RTN","DG53735P",158,0)
 ;   0 if no CV End date or CV End date not correct
"RTN","DG53735P",159,0)
 ;   1 if CV End Date correct
"RTN","DG53735P",160,0)
 ; Also returns CEN=CV END DATE ON FILE   CALC=CALCULATED CV END DATE
"RTN","DG53735P",161,0)
 ;
"RTN","DG53735P",162,0)
 N DGARRY,DGOK,X
"RTN","DG53735P",163,0)
 S (CEN,CALC)=""
"RTN","DG53735P",164,0)
 S CEN=$P($G(^DPT(DFN,.52)),U,15)
"RTN","DG53735P",165,0)
 S CALC=$$CVDATE^DGCVRPT(DFN,.DGARRY)
"RTN","DG53735P",166,0)
 ;
"RTN","DG53735P",167,0)
 I 'CEN D:CALC UPDCVED(NAMSPC,DFN,CEN,CALC) D SET(DFN,CEN,CALC,"CV END DATE MISSING") S DGOK=0
"RTN","DG53735P",168,0)
 ;
"RTN","DG53735P",169,0)
 I CEN D
"RTN","DG53735P",170,0)
 . I $G(DGARRY("OEF/OIF")) D
"RTN","DG53735P",171,0)
 .. N LSSD
"RTN","DG53735P",172,0)
 .. S LSSD=$G(DGARRY(2,DFN_",",.327,"I"))
"RTN","DG53735P",173,0)
 .. I DGARRY("OEF/OIF")>LSSD S ^XTMP(NAMSPC,"DATA",DFN,"MSE DATA MISSING")=CEN_U_CALC
"RTN","DG53735P",174,0)
 .. ; Correct CV End Date if value on file is not the calculated value
"RTN","DG53735P",175,0)
 .. Q:CEN=CALC
"RTN","DG53735P",176,0)
 .. D UPDCVED(NAMSPC,DFN,CEN,CALC)
"RTN","DG53735P",177,0)
 . I CEN=CALC S DGOK=1 Q
"RTN","DG53735P",178,0)
 . D SET(DFN,CEN,CALC,"CV END DATE INCORRECT")
"RTN","DG53735P",179,0)
 . S DGOK=0
"RTN","DG53735P",180,0)
 Q DGOK
"RTN","DG53735P",181,0)
 ;
"RTN","DG53735P",182,0)
UPDCVED(NAMSPC,DFN,CEN,CALC) ; Update CV end date
"RTN","DG53735P",183,0)
 N DA,DIE,DR,X,Y
"RTN","DG53735P",184,0)
 S DA=DFN,DIE="^DPT(",DR=".5295////"_CALC
"RTN","DG53735P",185,0)
 D ^DIE
"RTN","DG53735P",186,0)
 S ^XTMP(NAMSPC,"DATA",DFN,"CV END DATE UPDATED TO "_CALC)=CEN
"RTN","DG53735P",187,0)
 Q
"RTN","DG53735P",188,0)
 ;
"RTN","DG53735P",189,0)
SET(DFN,CEN,CALC,REASON) ;
"RTN","DG53735P",190,0)
 S ^XTMP(NAMSPC,"DATA",DFN)=CEN_U_CALC_U_REASON
"RTN","DG53735P",191,0)
 Q
"RTN","DG53735P",192,0)
 ;
"RTN","DG53735P",193,0)
UPDATEX(NAMSPC,TOTREC,LASTREC,TOTPAT) ;
"RTN","DG53735P",194,0)
 N X
"RTN","DG53735P",195,0)
 S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53735P",196,0)
 S $P(X,U,1)=$G(LASTREC),$P(X,U,2)=$G(TOTREC)
"RTN","DG53735P",197,0)
 S $P(X,U,10)=$G(TOTPAT)
"RTN","DG53735P",198,0)
 S ^XTMP(NAMSPC,0,0)=X
"RTN","DG53735P",199,0)
 Q
"RTN","DG53735P",200,0)
 ;
"RTN","DG53735P",201,0)
STATUS ; current run status
"RTN","DG53735P",202,0)
 N X,NAMSPC
"RTN","DG53735P",203,0)
 S NAMSPC=$$NAMSPC
"RTN","DG53735P",204,0)
 S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53735P",205,0)
 I X="" U 0 W !!,"Task not started!!!" Q
"RTN","DG53735P",206,0)
 W !!," Current status: ",$P(X,U,6)
"RTN","DG53735P",207,0)
 W !,"  Starting time: ",$$FMTE^XLFDT($P(X,U,7))
"RTN","DG53735P",208,0)
 I $P(X,U,8) D
"RTN","DG53735P",209,0)
 . W !,"                                  Ending time: ",$$FMTE^XLFDT($P(X,U,8))
"RTN","DG53735P",210,0)
 W !!,"                   Total patient records read: ",$P(X,U,2)
"RTN","DG53735P",211,0)
 W !,"                   Last ALOEIF xref processed: ",$P(X,U,1)
"RTN","DG53735P",212,0)
 W !,"    Total patient records set for re-transmit: ",$P(X,U,10)
"RTN","DG53735P",213,0)
 Q
"RTN","DG53735P",214,0)
 ;
"RTN","DG53735P",215,0)
STOP(NAMSPC) ; returns stop flag
"RTN","DG53735P",216,0)
 N X
"RTN","DG53735P",217,0)
 S ZTSTOP=0
"RTN","DG53735P",218,0)
 I $$S^%ZTLOAD S ZTSTOP=1
"RTN","DG53735P",219,0)
 I $D(^XTMP(NAMSPC,"STOP")) S ZTSTOP=1 K ^XTMP(NAMSPC,"STOP")
"RTN","DG53735P",220,0)
 I ZTSTOP D
"RTN","DG53735P",221,0)
 . S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53735P",222,0)
 . S $P(X,U,6)="STOPPED",$P(X,U,7)=$$NOW^XLFDT()
"RTN","DG53735P",223,0)
 . S ^XTMP(NAMSPC,0,0)=X
"RTN","DG53735P",224,0)
 . Q
"RTN","DG53735P",225,0)
 Q ZTSTOP
"RTN","DG53735P",226,0)
 ;
"RTN","DG53735P",227,0)
MAIL(NAMSPC,TESTING,DUZ) ; stats
"RTN","DG53735P",228,0)
 N ETIME,STAT,STIME,TOTPAT,TOTREC,X
"RTN","DG53735P",229,0)
 S X=$G(^XTMP(NAMSPC,0,0))
"RTN","DG53735P",230,0)
 S TOTREC=$P(X,U,2)
"RTN","DG53735P",231,0)
 S STAT=$P(X,U,6),STIME=$P(X,U,7)
"RTN","DG53735P",232,0)
 S ETIME=$P(X,U,8)
"RTN","DG53735P",233,0)
 S TOTPAT=$P(X,U,10)
"RTN","DG53735P",234,0)
 ;
"RTN","DG53735P",235,0)
 D HDNG(NAMSPC,.LIN,STAT,STIME,ETIME,TESTING)
"RTN","DG53735P",236,0)
 D SUMRY(.LIN,TOTREC,TOTPAT,NAMSPC)
"RTN","DG53735P",237,0)
 D MAILIT("SUMMARY STATS - TRANSMIT UNSENT OEF/OIF DATA TO HEC",DUZ,NAMSPC)
"RTN","DG53735P",238,0)
 K ^TMP(NAMSPC,$J,"MSG")
"RTN","DG53735P",239,0)
 Q
"RTN","DG53735P",240,0)
 ;
"RTN","DG53735P",241,0)
HDNG(NAMSPC,LIN,STAT,STIME,ETIME,TESTING) ; hdr lines
"RTN","DG53735P",242,0)
 N HTEXT,TEXT,X
"RTN","DG53735P",243,0)
 K ^TMP(NAMSPC,$J,"MSG")
"RTN","DG53735P",244,0)
 S LIN=0
"RTN","DG53735P",245,0)
 S HTEXT="Transmit unsent OEF/OIF data to HEC "_STAT_" on "
"RTN","DG53735P",246,0)
 D BLDLINE(NAMSPC,HTEXT,.LIN)
"RTN","DG53735P",247,0)
 S HTEXT=$$FMTE^XLFDT(ETIME)
"RTN","DG53735P",248,0)
 D BLDLINE(NAMSPC,HTEXT,.LIN)
"RTN","DG53735P",249,0)
 D BLDLINE(NAMSPC,"",.LIN)
"RTN","DG53735P",250,0)
 I TESTING="Y" D
"RTN","DG53735P",251,0)
 . S TEXT="** TESTING - NO CHANGES MADE TO DATABASE **"
"RTN","DG53735P",252,0)
 . D BLDLINE(NAMSPC,TEXT,.LIN)
"RTN","DG53735P",253,0)
 D BLDLINE(NAMSPC,"",.LIN)
"RTN","DG53735P",254,0)
 Q
"RTN","DG53735P",255,0)
 ;
"RTN","DG53735P",256,0)
SUMRY(LIN,TOTREC,TOTPAT,NAMSPC) ; summary lines
"RTN","DG53735P",257,0)
 N TEXT,X
"RTN","DG53735P",258,0)
 S TEXT="                  Total Patient Records Read: "_$J($FN(TOTREC,","),11)
"RTN","DG53735P",259,0)
 D BLDLINE(NAMSPC,TEXT,.LIN)
"RTN","DG53735P",260,0)
 S TEXT="   Total Patient Records Set for Re-transmit: "_$J($FN(TOTPAT,","),11)
"RTN","DG53735P",261,0)
 D BLDLINE(NAMSPC,TEXT,.LIN)
"RTN","DG53735P",262,0)
 Q
"RTN","DG53735P",263,0)
 ;
"RTN","DG53735P",264,0)
BLDLINE(NAMSPC,TEXT,LIN) ;bld line in TMP
"RTN","DG53735P",265,0)
 S LIN=LIN+1
"RTN","DG53735P",266,0)
 S ^TMP(NAMSPC,$J,"MSG",LIN)=TEXT
"RTN","DG53735P",267,0)
 Q
"RTN","DG53735P",268,0)
 ;
"RTN","DG53735P",269,0)
MAILIT(HTEXT,DUZ,NAMSPC) ; send mail msg
"RTN","DG53735P",270,0)
 N XMY,XMDUZ,XMSUB,XMTEXT
"RTN","DG53735P",271,0)
 S XMY(DUZ)="",XMDUZ=.5
"RTN","DG53735P",272,0)
 S XMY("G.DGEN ELIGIBILITY ALERT")=""
"RTN","DG53735P",273,0)
 S XMSUB=HTEXT
"RTN","DG53735P",274,0)
 S XMTEXT="^TMP(NAMSPC,$J,""MSG"","
"RTN","DG53735P",275,0)
 D ^XMD
"RTN","DG53735P",276,0)
 Q
"RTN","DG53735P",277,0)
 ;
"RTN","DG53735P",278,0)
CHKSTAT(POST,NAMSPC) ;check if job is running, stopped, or complete
"RTN","DG53735P",279,0)
 L +^XTMP(NAMSPC):1
"RTN","DG53735P",280,0)
 I '$T Q 0
"RTN","DG53735P",281,0)
 D KILIT(POST,NAMSPC)
"RTN","DG53735P",282,0)
 Q 1
"RTN","DG53735P",283,0)
 ;
"RTN","DG53735P",284,0)
KILIT(POST,NAMSPC) ;
"RTN","DG53735P",285,0)
 I 'POST K ^XTMP(NAMSPC)
"RTN","DG53735P",286,0)
 Q
"RTN","DG53735P",287,0)
 ;
"RTN","DG53735P",288,0)
NAMSPC() ;
"RTN","DG53735P",289,0)
 Q $T(+0)
"RTN","DG53735P",290,0)
 ;
"RTN","DGRPE")
0^1^B61249824^B60930744
"RTN","DGRPE",1,0)
DGRPE ;ALB/MRL,LBD,BRM,TMK - REGISTRATIONS EDITS ; 09/12/05 1:27pm
"RTN","DGRPE",2,0)
 ;;5.3;Registration;**32,114,139,169,175,247,190,343,397,342,454,415,489,506,244,547,522,528,555,508,451,626,638,624,677,672,702,689,735**;Aug 13, 1993;Build 11
"RTN","DGRPE",3,0)
 ;
"RTN","DGRPE",4,0)
 ;DGDR contains a string of edits; edit=screen*10+item #
"RTN","DGRPE",5,0)
 ;
"RTN","DGRPE",6,0)
 ;line tag screen*10+item*1000 = continuation line
"RTN","DGRPE",7,0)
 ;
"RTN","DGRPE",8,0)
 I DGRPS=1,DGDR["101," D CEDITS^DGRPECE(DFN)
"RTN","DGRPE",9,0)
 I DGRPS=8 D ^DGRPEIS,Q Q  ; family demographic edit...not conventional!!  :)
"RTN","DGRPE",10,0)
 I DGRPS=9 D EDIT9^DGRPEIS2,Q Q  ; income screening data ($$$)
"RTN","DGRPE",11,0)
 I DGRPS=5,DGDR["501," D
"RTN","DGRPE",12,0)
 .I $G(DGPRFLG) D PREG^IBCNBME(DFN) Q
"RTN","DGRPE",13,0)
 .D REG^IBCNBME(DFN)
"RTN","DGRPE",14,0)
 .Q
"RTN","DGRPE",15,0)
 N QUIT S QUIT=0
"RTN","DGRPE",16,0)
 I DGRPS=6,$S(DGDR["602,"!(DGDR["603,"):1,1:0) D  I QUIT D Q Q  ;Screen 6 subscreens
"RTN","DGRPE",17,0)
 . I DGDR["601," D  Q:QUIT
"RTN","DGRPE",18,0)
 .. D SETDR("601,",.DR)
"RTN","DGRPE",19,0)
 .. S (DA,Y)=DFN,DIE="^DPT("
"RTN","DGRPE",20,0)
 .. D ^DIE I $D(Y) S QUIT=1
"RTN","DGRPE",21,0)
 .. S DGDR=$P(DGDR,"601,",1)_$P(DGDR,"601,",2,999)
"RTN","DGRPE",22,0)
 . I DGDR["602," D EN^DGRP6CL(DFN,.QUIT)  Q:QUIT  ; Conflicts
"RTN","DGRPE",23,0)
 . I DGDR["603," D EN^DGRP6EF(DFN,.QUIT)  Q:QUIT  ; Exposures
"RTN","DGRPE",24,0)
 ;-- Tricare screen #15
"RTN","DGRPE",25,0)
 I DGRPS=15 D EDIT^DGRP15,Q Q
"RTN","DGRPE",26,0)
 ;
"RTN","DGRPE",27,0)
 N DGPH,DGPHFLG
"RTN","DGRPE",28,0)
 K DR S (DA,Y)=DFN,DIE="^DPT(",DR="",DGDRS="DR",DGCT=0
"RTN","DGRPE",29,0)
 G ^DGRPE1:DGRPS>6
"RTN","DGRPE",30,0)
 I DGRPS=4 D ^DGRPE4
"RTN","DGRPE",31,0)
 D SETDR(DGDR,.DR)
"RTN","DGRPE",32,0)
 S (DA,Y)=DFN,DIE="^DPT("
"RTN","DGRPE",33,0)
 D ^DIE
"RTN","DGRPE",34,0)
 ;check for Combat Vet status
"RTN","DGRPE",35,0)
 I $G(DGCVFLG)=1,($P($$CVEDT^DGCV(DFN),U,2)']"") D
"RTN","DGRPE",36,0)
 . W !!,"**NOTE-Change(s) made in this session deleted the veteran's Combat Vet status!"
"RTN","DGRPE",37,0)
 . S DIR(0)="EA" D ^DIR K DIR
"RTN","DGRPE",38,0)
 I $G(DGPHFLG)>0 D EDITPH1^DGRPLE()
"RTN","DGRPE",39,0)
Q K DA,DIE,DR,DGCT,DGCVFLG,DGDR,DGDRD,DGDRS,DGRPADI,I,J,J1,DGCOMLOC,DIPA
"RTN","DGRPE",40,0)
 Q
"RTN","DGRPE",41,0)
 ;
"RTN","DGRPE",42,0)
SETDR(DGDR,DR) ; Set up DR string(s) for edit groups selected
"RTN","DGRPE",43,0)
 N DGCT,DGDRS,J1,J2
"RTN","DGRPE",44,0)
 K DR S DR="",DGDRS="DR",DGCT=0
"RTN","DGRPE",45,0)
 F I=1:1 S J=$P(DGDR,",",I) Q:J=""  S J1=J D:$T(@J1)
"RTN","DGRPE",46,0)
 . S DGDRD=$P($T(@J1),";;",2) D S
"RTN","DGRPE",47,0)
 . N J2
"RTN","DGRPE",48,0)
 . F J2=0:1 S J1=J*1000+J2 Q:'$T(@J1)  S DGDRD=$P($T(@J1),";;",2) D S
"RTN","DGRPE",49,0)
 Q
"RTN","DGRPE",50,0)
 ;
"RTN","DGRPE",51,0)
S I $L(@DGDRS)+$L(DGDRD)<241 S @DGDRS=@DGDRS_DGDRD Q
"RTN","DGRPE",52,0)
 S DGCT=DGCT+1,DGDRS="DR(1,2,"_DGCT_")",@DGDRS=DGDRD Q
"RTN","DGRPE",53,0)
 Q
"RTN","DGRPE",54,0)
 ;
"RTN","DGRPE",55,0)
SETFLDS(DGDR) ; Set up fields to edit
"RTN","DGRPE",56,0)
 Q
"RTN","DGRPE",57,0)
 ;
"RTN","DGRPE",58,0)
101 ;;
"RTN","DGRPE",59,0)
102 ;;1;
"RTN","DGRPE",60,0)
103 ;;.091;
"RTN","DGRPE",61,0)
104 ;;N FLG S (FLG(1),FLG(2))=1 D EN^DGREGAED(DFN,.FLG);
"RTN","DGRPE",62,0)
105 ;;.12105//NO;S:X="N" Y="@15" S:X="Y" DIE("NO^")="";.1217;I X']"" W !?4,$C(7),"But I need a Start Date for this Temporary Address." S Y=.12105;.1218;.1211;I X']"" W !?4,$C(7),"But I need at least one line of a Temporary address." S Y=.12105;
"RTN","DGRPE",63,0)
105000 ;;.1212;S:X']"" Y=.1214;.1213:.1215;.12112;Q;.12111;.1219;@15;K DIE("NO^");
"RTN","DGRPE",64,0)
109 ;;N FLG S (FLG(1),FLG(2))=1 D EN^DGREGAED(DFN,.FLG);.02;D DR109^DGRPE;6;2;K DR(2,2.02),DR(2,2.06);.05;.08;K DIE("NO^");
"RTN","DGRPE",65,0)
111 ;;.14105//NO;S:X="N" Y="@111" S:X="Y" DIE("NO^")="";.1417;I X']"" W !?4,$C(7),"But I need a Start Date." S Y=.14105;.1418;D DR111^DGRPE;.141;I '$P($$CAACT^DGRPCADD(DFN),U,2) W !?4,"But I need at least one active category." S Y=.14105;
"RTN","DGRPE",66,0)
111000 ;;K DR(2,2.141);.1411;I X']"" W !?4,$C(7),"I need at least one line of Address." S Y=.14105;.1412;S:X']"" Y=.1414;.1413;.1414;.1415;.1416;Q;.14111;@111;K DIE("NO^");
"RTN","DGRPE",67,0)
112 ;;.134;.135;.133
"RTN","DGRPE",68,0)
201 ;;.05;.08;.092;.093;.2401:.2403;57.4//NOT APPLICABLE;
"RTN","DGRPE",69,0)
202 ;;1010.15//NO;S:X'="Y" Y="@22";S DIE("NO^")="";1010.152;I X']"" W !?4,*7,"But I need to know where you were treated most recently." S Y=1010.15;1010.151;1010.154;S:X']"" Y="@22";1010.153;@22;K DIE("NO^");
"RTN","DGRPE",70,0)
203 ;;D DR203^DGRPE;6ETHNICITY;2RACE;K DR(2,2.02),DR(2,2.06);
"RTN","DGRPE",71,0)
205 ;;.181;
"RTN","DGRPE",72,0)
301 ;;.211;S:X']"" Y="@31";.212;.2125//NO;I X="Y" S DGADD=".21" D AD^DGRPE S Y=.21011;.213;S:X']"" Y=.216;.214;S:X']"" Y=.216;.215:.217;.2207;.219;.21011;@31;
"RTN","DGRPE",73,0)
302 ;;.2191;S:X']"" Y="@32";.2192;.21925//NO;I X="Y" S DGADD=".211" D AD^DGRPE S Y=.211011;
"RTN","DGRPE",74,0)
302000 ;;.2193;S:X']"" Y=.2196;.2194;S:X']"" Y=.2196;.2195:.2197;.2203;.2199;.211011;@32;
"RTN","DGRPE",75,0)
303 ;;N DGX1,DGX2;I '$L($P($G(^DPT(DFN,.21)),U)) S Y="@33";.3305//NO;I X="Y" S Y="@34",DGX1=1 S:$D(^DPT(DFN,.22)) $P(^(.22),U,1)=$P(^(.22),U,7);@33;.331;S:X']"" DGX1=2,Y="@34";.332;@34;
"RTN","DGRPE",76,0)
303000 ;;S:$G(DGX1) Y="@341";.333;S:X']"" Y=.336;.334;S:X']"" Y=.336;.335:.337;.2201;.339;.33011;S DGX1=2;@341;
"RTN","DGRPE",77,0)
303001 ;;S:$G(DGX1)=2 Y="@35";S DGX2=$G(^DPT(DA,.21));.331///^S X=$P(DGX2,U);.332///^S X=$P(DGX2,U,2);.333////^S X=$P(DGX2,U,3);.334///^S X=$P(DGX2,U,4);@35;
"RTN","DGRPE",78,0)
303002 ;;S:$G(DGX1)=2 Y="@351";.335///^S X=$P(DGX2,U,5);.336///^S X=$P(DGX2,U,6);.337///^S X=$P(DGX2,U,7);.338///^S X=$P(DGX2,U,8);.339///^S X=$P(DGX2,U,9);.33011///^S X=$P(DGX2,U,11);@351;K DGX1,DGX2;
"RTN","DGRPE",79,0)
304 ;;.3311;S:X']"" Y="@36";.3312;.3313;S:X']"" Y=.3316;.3314;S:X']"" Y=.3316;.3315:.3317;.2204;.3319;.331011;@36;        
"RTN","DGRPE",80,0)
305 ;;N DGX1,DGX2;I '$L($P($G(^DPT(DFN,.21)),U)) S Y="@37";.3405//NO;I X="Y" S DGX1=1,Y="@371" S:$D(^DPT(DFN,.22)) $P(^(.22),U,2)=$P(^(.22),U,7);@37;.341;S:X']"" DGX1=2,Y="@371";.342;@371;
"RTN","DGRPE",81,0)
305000 ;;S:$G(DGX1) Y="@38";.343;S:X']"" Y=.346;.344;S:X']"" Y=.346;.345:.347;.2202;.349;.34011;S DGX1=2;@38;
"RTN","DGRPE",82,0)
305001 ;;S:$G(DGX1)=2 Y="@381";S DGX2=$G(^DPT(DA,.21));.341///^S X=$P(DGX2,U);.342///^S X=$P(DGX2,U,2);.343///^S X=$P(DGX2,U,3);.344///^S X=$P(DGX2,U,4);@381
"RTN","DGRPE",83,0)
305002 ;;S:$G(DGX1)=2 Y="@39";.345///^S X=$P(DGX2,U,5);.346///^S X=$P(DGX2,U,6);.347///^S X=$P(DGX2,U,7);.348///^S X=$P(DGX2,U,8);.349///^S X=$P(DGX2,U,9);.34011///^S X=$P(DGX2,U,11);@39;K DGX1,DGX2;
"RTN","DGRPE",84,0)
401 ;;.01;.31115;S:($S(X']"":1,X=3:1,X=9:1,1:0)) Y="@41" S:(X'=5) Y=.3111;.31116;.3111;S:X']"" Y="@41";.3113;S:X']"" Y=.3116;.3114;S:X']"" Y=.3116;.3115:.3117;.2205;.3119;@41;
"RTN","DGRPE",85,0)
402 ;;.2514;.2515;S:($S(X']"":1,X=3:1,X=9:1,1:0)) Y="@42" S:(X'=5) Y=.251;.2516;.251;S:X']"" Y="@42";.252;S:X']"" Y=.255;.253;S:X']"" Y=.255;.254:.256;.2206;.258;@42;
"RTN","DGRPE",86,0)
501 ;;
"RTN","DGRPE",87,0)
502 ;;.381;.382///NOW;
"RTN","DGRPE",88,0)
503 ;;.383;
"RTN","DGRPE",89,0)
601 ;;@60101;D SET32^DGRPE(DA,.DIPA,1);.325;S DIPA("X1")=X S:X="" Y="@60199" I X'="" S:$$FV^DGRPMS(X)'=1 Y="@60111";.3214;I X="" D PRF^DGRPE S Y="@60101";S Y="@6011";
"RTN","DGRPE",90,0)
601000 ;;@60111;D:DIPA("X1")'="" WARN32^DGRPE(DIPA("X1"),.DIPA,1,.Y);.32911;@6011;.328;.326;.327;.324;.3285//NO;S:X'="Y" Y="@60199";
"RTN","DGRPE",91,0)
601001 ;;@60102;D SET32^DGRPE(DA,.DIPA,2);.3291;S DIPA("X2")=X S:X="" Y="@60199" I X'="" S:$$FV^DGRPMS(X)'=1 Y="@60112";.3214;I X="" D PRF^DGRPE S Y="@60102";S Y="@6012";
"RTN","DGRPE",92,0)
601002 ;;@60112;D:DIPA("X2")'="" WARN32^DGRPE(DIPA("X2"),.DIPA,2,.Y);.32912;@6012;.3294;.3292;.3293;.329;.32945//NO;S:X'="Y" Y="@60199";
"RTN","DGRPE",93,0)
601003 ;;@60103;D SET32^DGRPE(DA,.DIPA,3);.3296;S DIPA("X3")=X S:X="" Y="@60199" I X'="" S:$$FV^DGRPMS(X)'=1 Y="@60113";.3214;I X="" D PRF^DGRPE S Y="@60103";S Y="@6013";
"RTN","DGRPE",94,0)
601004 ;;@60113;D:DIPA("X3")'="" WARN32^DGRPE(DIPA("X3"),.DIPA,3,.Y);.32913;@6013;.3299;.3297;.3298;.3295;@60199;
"RTN","DGRPE",95,0)
602 ;;Q;
"RTN","DGRPE",96,0)
603 ;;Q;
"RTN","DGRPE",97,0)
604 ;;.525//NO;S:X'="Y" Y="@62";.526:.528;@62;
"RTN","DGRPE",98,0)
605 ;;.5291//NO;S:X'="Y" Y="@63";.5292:.5294;@63;
"RTN","DGRPE",99,0)
606 ;;I $P($G(^DPT(DFN,.361)),U,3)="H" S Y="@6131";.3602//NO;.3603//NO;S Y="@6132";@6131;.3602;.3603;@6132;
"RTN","DGRPE",100,0)
607 ;;.368//NO;.369//NO;I $S('$D(^DPT(DA,.36)):1,$P(^(.36),U,8)="Y"!($P(^(.36),U,9)="Y"):0,1:1) S Y="@614";.37;@614;
"RTN","DGRPE",101,0)
608 ;;S DGPHFLG=0;.531;S:X'="Y" DGX=X,Y="@616";.532///^S X="PENDING";S Y="@6161";@616;S:DGX'="N" Y="@6162";.533///^S X="VAMC";@6161;S DGPHFLG=1;.535///^S X=$$DIV^DGRPLE();@6162;
"RTN","DGRPE",102,0)
AD N DGZ4,DGPC
"RTN","DGRPE",103,0)
 S X=$S($D(^DPT(DA,.11)):^(.11),1:""),DGZ4=$P(X,U,12),DGPHONE=$S($D(^(.13)):$P(^(.13),U,1),1:""),Y=$S($D(^(DGADD)):^(DGADD),1:""),^(DGADD)=$P(Y,U,1)_U_$P(Y,U,2)_U_$P(X,U,1,6)_U_DGPHONE_U_$P(Y,U,10)
"RTN","DGRPE",104,0)
 I DGZ4 S DGPC=$S((DGADD=.33):1,(DGADD=.34):2,(DGADD=.211):3,(DGADD=.331):4,(DGADD=.311):5,(DGADD=.25):6,(DGADD=.21):7,1:0) S:DGPC $P(^DPT(DFN,.22),U,DGPC)=DGZ4
"RTN","DGRPE",105,0)
 K DGADD,DGPHONE Q
"RTN","DGRPE",106,0)
DR109 ;Drop through (use same logic as DR203)
"RTN","DGRPE",107,0)
DR203 S DR(2,2.02)=".01RACE;I $P($G(^DIC(10.3,+$P($G(^DPT(DA(1),.02,DA,0)),""^"",2),0)),""^"",2)=""S"" S Y=""@2031"";.02;@2031;"
"RTN","DGRPE",108,0)
 S DR(2,2.06)=".01ETHNICITY;I $P($G(^DIC(10.3,+$P($G(^DPT(DA(1),.06,DA,0)),""^"",2),0)),""^"",2)=""S"" S Y=""@2032"";.02;@2032;"
"RTN","DGRPE",109,0)
 Q
"RTN","DGRPE",110,0)
DR111 ;Set DR string for Confidential Address categories
"RTN","DGRPE",111,0)
 S DR(2,2.141)=".01;1//YES;"
"RTN","DGRPE",112,0)
 Q
"RTN","DGRPE",113,0)
PRF ; Write Proof needed for FV
"RTN","DGRPE",114,0)
 W !?4,$C(7),"Proof is required for Filipino vet."
"RTN","DGRPE",115,0)
 Q
"RTN","DGRPE",116,0)
 ;
"RTN","DGRPE",117,0)
SET32(DA,DIPA,SEQ) ; Extract the .32 node from patient file and set DIPA
"RTN","DGRPE",118,0)
 ; array with the BOS and component data for the SEQ military service
"RTN","DGRPE",119,0)
 ; episode (1-3)
"RTN","DGRPE",120,0)
 N I,Q,Z
"RTN","DGRPE",121,0)
 K DIPA(32,SEQ)
"RTN","DGRPE",122,0)
 S Q=$G(^DPT(DA,.32)),Z=$G(^(.3291))
"RTN","DGRPE",123,0)
 S DIPA(32,SEQ)=$P(Q,U,SEQ*5)_U_$P(Z,U,SEQ),DIPA("X"_SEQ)=$P(DIPA(32,SEQ),U)
"RTN","DGRPE",124,0)
 Q
"RTN","DGRPE",125,0)
 ;
"RTN","DGRPE",126,0)
WARN32(X,DIPA,SEQ,Y) ; Warn if the BOS is changed, then the component will
"RTN","DGRPE",127,0)
 ; be deleted
"RTN","DGRPE",128,0)
 ; Returns Y to skip component if the component should not be asked
"RTN","DGRPE",129,0)
 ;   for this branch of service
"RTN","DGRPE",130,0)
 N Z
"RTN","DGRPE",131,0)
 I '$$CMP(X) S Y="@601"_SEQ
"RTN","DGRPE",132,0)
 S Z=$G(DIPA(32,SEQ))
"RTN","DGRPE",133,0)
 Q:$S($P(Z,U,2)=""!($P(Z,U)=""):1,1:$P(Z,U)=X)
"RTN","DGRPE",134,0)
 ;
"RTN","DGRPE",135,0)
 I '$D(DIQUIET) W !!,*7,"** WARNING - BRANCH OF SERVICE WAS CHANGED SO THE COMPONENT WAS DELETED",!
"RTN","DGRPE",136,0)
 Q
"RTN","DGRPE",137,0)
 ;
"RTN","DGRPE",138,0)
CMP(X) ; Function to determine if service component is valid for
"RTN","DGRPE",139,0)
 ; branch of service ien in X   0 = invalid  1 = valid  
"RTN","DGRPE",140,0)
 ; Component only valid for ARMY/AIR FORCE/MARINES/COAST GUARD/NOAA/USPHS
"RTN","DGRPE",141,0)
 Q $S('$G(X):0,X'>5!(X=9)!(X=10):1,1:0)
"RTN","DGRPE",142,0)
 ;
"VER")
8.0^22.0
"BLD",6912,6)
^648
**END**
**END**
