Released IBD*3*38 SEQ #26
Extracted from mail message
**KIDS**:IBD*3.0*38^

**INSTALL NAME**
IBD*3.0*38
"BLD",2054,0)
IBD*3.0*38^AUTOMATED INFO COLLECTION SYS^0^3000228^y
"BLD",2054,1,0)
^^1^1^2991117^
"BLD",2054,1,1,0)
See patch description on NPM for complete details of this patch.
"BLD",2054,4,0)
^9.64PA^358.6^9
"BLD",2054,4,357.3,0)
357.3
"BLD",2054,4,357.3,2,0)
^9.641^357.33^1
"BLD",2054,4,357.3,2,357.33,0)
CPT Modifier  (sub-file)
"BLD",2054,4,357.3,2,357.33,1,0)
^9.6411^^
"BLD",2054,4,357.3,222)
y^n^p^^^^n
"BLD",2054,4,357.6,0)
357.6
"BLD",2054,4,357.6,222)
y^n^f^^y^IBD*3.0*38 PCKG INT^y^r^n
"BLD",2054,4,357.91,0)
357.91
"BLD",2054,4,357.91,222)
n^n^f^^n^PATCH IBD*3.0*38^y^o^n
"BLD",2054,4,357.95,0)
357.95
"BLD",2054,4,357.95,2,0)
^9.641^357.951^1
"BLD",2054,4,357.95,2,357.951,0)
BUBBLES  (sub-file)
"BLD",2054,4,357.95,2,357.951,1,0)
^9.6411^.14^1
"BLD",2054,4,357.95,2,357.951,1,.14,0)
SELECTION
"BLD",2054,4,357.95,222)
y^n^p^^^^n
"BLD",2054,4,358.1,0)
358.1
"BLD",2054,4,358.1,222)
y^n^f^^y^^y^o^n
"BLD",2054,4,358.2,0)
358.2
"BLD",2054,4,358.2,222)
y^n^f^^y^^y^o^n
"BLD",2054,4,358.3,0)
358.3
"BLD",2054,4,358.3,222)
y^n^f^^y^^y^o^n
"BLD",2054,4,358.4,0)
358.4
"BLD",2054,4,358.4,222)
y^n^f^^y^^y^o^n
"BLD",2054,4,358.6,0)
358.6
"BLD",2054,4,358.6,222)
y^n^f^^y^^y^o^n
"BLD",2054,4,"APDD",357.3,357.33)

"BLD",2054,4,"APDD",357.95,357.951)

"BLD",2054,4,"APDD",357.95,357.951,.14)

"BLD",2054,4,"B",357.3,357.3)

"BLD",2054,4,"B",357.6,357.6)

"BLD",2054,4,"B",357.91,357.91)

"BLD",2054,4,"B",357.95,357.95)

"BLD",2054,4,"B",358.1,358.1)

"BLD",2054,4,"B",358.2,358.2)

"BLD",2054,4,"B",358.3,358.3)

"BLD",2054,4,"B",358.4,358.4)

"BLD",2054,4,"B",358.6,358.6)

"BLD",2054,"ABPKG")
y^y
"BLD",2054,"INI")
PREINIT^IBDY338
"BLD",2054,"INID")
^n
"BLD",2054,"INIT")
IBDY338
"BLD",2054,"KRN",0)
^9.67PA^19^18
"BLD",2054,"KRN",.4,0)
.4
"BLD",2054,"KRN",.401,0)
.401
"BLD",2054,"KRN",.402,0)
.402
"BLD",2054,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",2054,"KRN",.402,"NM",1,0)
IBDF CPT MODIFIER    FILE #357.3^357.3^0
"BLD",2054,"KRN",.402,"NM","B","IBDF CPT MODIFIER    FILE #357.3",1)

"BLD",2054,"KRN",.403,0)
.403
"BLD",2054,"KRN",.5,0)
.5
"BLD",2054,"KRN",.84,0)
.84
"BLD",2054,"KRN",3.6,0)
3.6
"BLD",2054,"KRN",3.8,0)
3.8
"BLD",2054,"KRN",9.2,0)
9.2
"BLD",2054,"KRN",9.8,0)
9.8
"BLD",2054,"KRN",9.8,"NM",0)
^9.68A^35^32
"BLD",2054,"KRN",9.8,"NM",1,0)
IBDF18A^^0^B39891231
"BLD",2054,"KRN",9.8,"NM",2,0)
IBDF18A1^^0^B20186992
"BLD",2054,"KRN",9.8,"NM",3,0)
IBDF18E^^0^B42132833
"BLD",2054,"KRN",9.8,"NM",4,0)
IBDF18E0^^0^B37891162
"BLD",2054,"KRN",9.8,"NM",5,0)
IBDF18E1^^0^B47079647
"BLD",2054,"KRN",9.8,"NM",6,0)
IBDF2A2^^0^B6077398
"BLD",2054,"KRN",9.8,"NM",7,0)
IBDF2D3^^0^B24859455
"BLD",2054,"KRN",9.8,"NM",8,0)
IBDF4^^0^B73611649
"BLD",2054,"KRN",9.8,"NM",9,0)
IBDF4A^^0^B40998233
"BLD",2054,"KRN",9.8,"NM",10,0)
IBDFDE1^^0^B54599761
"BLD",2054,"KRN",9.8,"NM",11,0)
IBDFDE21^^0^B78355846
"BLD",2054,"KRN",9.8,"NM",13,0)
IBDFFRFT^^0^B32830943
"BLD",2054,"KRN",9.8,"NM",14,0)
IBDFM1^^0^B41474077
"BLD",2054,"KRN",9.8,"NM",15,0)
IBDFQEA^^0^B31331634
"BLD",2054,"KRN",9.8,"NM",16,0)
IBDFRPC2^^0^B53166622
"BLD",2054,"KRN",9.8,"NM",17,0)
IBDFRPC4^^0^B15949086
"BLD",2054,"KRN",9.8,"NM",18,0)
IBDFRPC5^^0^B12358591
"BLD",2054,"KRN",9.8,"NM",19,0)
IBDFU2B^^0^B51714679
"BLD",2054,"KRN",9.8,"NM",20,0)
IBDF4C^^0^B1786729
"BLD",2054,"KRN",9.8,"NM",21,0)
IBDFDE23^^0^B4887413
"BLD",2054,"KRN",9.8,"NM",22,0)
IBDF17^^0^B19904734
"BLD",2054,"KRN",9.8,"NM",23,0)
IBDFBK3^^0^B39962109
"BLD",2054,"KRN",9.8,"NM",24,0)
IBDFLST^^0^B26549250
"BLD",2054,"KRN",9.8,"NM",25,0)
IBDFN12^^0^B7401338
"BLD",2054,"KRN",9.8,"NM",26,0)
IBDFN14^^0^B7232490
"BLD",2054,"KRN",9.8,"NM",27,0)
IBDFN4^^0^B10281238
"BLD",2054,"KRN",9.8,"NM",28,0)
IBDFN7^^0^B3804156
"BLD",2054,"KRN",9.8,"NM",29,0)
IBDFN8^^0^B509843
"BLD",2054,"KRN",9.8,"NM",30,0)
IBDFN9^^0^B561836
"BLD",2054,"KRN",9.8,"NM",31,0)
IBDFRPC6^^0^B56803850
"BLD",2054,"KRN",9.8,"NM",34,0)
IBDY338^^0^B6785174
"BLD",2054,"KRN",9.8,"NM",35,0)
IBDFDBS^^0^B5744829
"BLD",2054,"KRN",9.8,"NM","B","IBDF17",22)

"BLD",2054,"KRN",9.8,"NM","B","IBDF18A",1)

"BLD",2054,"KRN",9.8,"NM","B","IBDF18A1",2)

"BLD",2054,"KRN",9.8,"NM","B","IBDF18E",3)

"BLD",2054,"KRN",9.8,"NM","B","IBDF18E0",4)

"BLD",2054,"KRN",9.8,"NM","B","IBDF18E1",5)

"BLD",2054,"KRN",9.8,"NM","B","IBDF2A2",6)

"BLD",2054,"KRN",9.8,"NM","B","IBDF2D3",7)

"BLD",2054,"KRN",9.8,"NM","B","IBDF4",8)

"BLD",2054,"KRN",9.8,"NM","B","IBDF4A",9)

"BLD",2054,"KRN",9.8,"NM","B","IBDF4C",20)

"BLD",2054,"KRN",9.8,"NM","B","IBDFBK3",23)

"BLD",2054,"KRN",9.8,"NM","B","IBDFDBS",35)

"BLD",2054,"KRN",9.8,"NM","B","IBDFDE1",10)

"BLD",2054,"KRN",9.8,"NM","B","IBDFDE21",11)

"BLD",2054,"KRN",9.8,"NM","B","IBDFDE23",21)

"BLD",2054,"KRN",9.8,"NM","B","IBDFFRFT",13)

"BLD",2054,"KRN",9.8,"NM","B","IBDFLST",24)

"BLD",2054,"KRN",9.8,"NM","B","IBDFM1",14)

"BLD",2054,"KRN",9.8,"NM","B","IBDFN12",25)

"BLD",2054,"KRN",9.8,"NM","B","IBDFN14",26)

"BLD",2054,"KRN",9.8,"NM","B","IBDFN4",27)

"BLD",2054,"KRN",9.8,"NM","B","IBDFN7",28)

"BLD",2054,"KRN",9.8,"NM","B","IBDFN8",29)

"BLD",2054,"KRN",9.8,"NM","B","IBDFN9",30)

"BLD",2054,"KRN",9.8,"NM","B","IBDFQEA",15)

"BLD",2054,"KRN",9.8,"NM","B","IBDFRPC2",16)

"BLD",2054,"KRN",9.8,"NM","B","IBDFRPC4",17)

"BLD",2054,"KRN",9.8,"NM","B","IBDFRPC5",18)

"BLD",2054,"KRN",9.8,"NM","B","IBDFRPC6",31)

"BLD",2054,"KRN",9.8,"NM","B","IBDFU2B",19)

"BLD",2054,"KRN",9.8,"NM","B","IBDY338",34)

"BLD",2054,"KRN",19,0)
19
"BLD",2054,"KRN",19,"NM",0)
^9.68A^^
"BLD",2054,"KRN",19.1,0)
19.1
"BLD",2054,"KRN",101,0)
101
"BLD",2054,"KRN",409.61,0)
409.61
"BLD",2054,"KRN",771,0)
771
"BLD",2054,"KRN",869.2,0)
869.2
"BLD",2054,"KRN",870,0)
870
"BLD",2054,"KRN",8994,0)
8994
"BLD",2054,"KRN","B",.4,.4)

"BLD",2054,"KRN","B",.401,.401)

"BLD",2054,"KRN","B",.402,.402)

"BLD",2054,"KRN","B",.403,.403)

"BLD",2054,"KRN","B",.5,.5)

"BLD",2054,"KRN","B",.84,.84)

"BLD",2054,"KRN","B",3.6,3.6)

"BLD",2054,"KRN","B",3.8,3.8)

"BLD",2054,"KRN","B",9.2,9.2)

"BLD",2054,"KRN","B",9.8,9.8)

"BLD",2054,"KRN","B",19,19)

"BLD",2054,"KRN","B",19.1,19.1)

"BLD",2054,"KRN","B",101,101)

"BLD",2054,"KRN","B",409.61,409.61)

"BLD",2054,"KRN","B",771,771)

"BLD",2054,"KRN","B",869.2,869.2)

"BLD",2054,"KRN","B",870,870)

"BLD",2054,"KRN","B",8994,8994)

"BLD",2054,"QUES",0)
^9.62^^
"BLD",2054,"REQB",0)
^9.611^3^3
"BLD",2054,"REQB",1,0)
PX*1.0*73^1
"BLD",2054,"REQB",2,0)
IBD*3.0*34^1
"BLD",2054,"REQB",3,0)
ICPT*6.0*6^1
"BLD",2054,"REQB","B","IBD*3.0*34",2)

"BLD",2054,"REQB","B","ICPT*6.0*6",3)

"BLD",2054,"REQB","B","PX*1.0*73",1)

"DATA",357.6,147,0)
ICPT CPT MODIFIER DISPLAY^CPTMOD^IBDFN4^CPT^1^3^4^1^1^0^^1^^^^^^^^^0
"DATA",357.6,147,1,0)
^^2^2^3000121^^^^
"DATA",357.6,147,1,1,0)
This toolkit block will display a list of CPT Modifiers to aid providers
"DATA",357.6,147,1,2,0)
in determining the correct CPT Modifier to add.
"DATA",357.6,147,2)
Code^5^^^^^^^^^^^^^^Code^1^1
"DATA",357.6,147,3)
CPT MODIFIER CODES
"DATA",357.6,147,15,0)
^357.615I^1^1
"DATA",357.6,147,15,1,0)
SHORT DESCRIPTION^35^2^^Description
"DATA",357.6,147,16)

"DATA",357.91,18,0)
MODIFIER^_______^1^0
"DATA",358.1,1,0)
CPT MODIFIER DISPLAY^^^0^0^45^21^^^1^CPT MODIFIERS^CR^Display CPT Modifiers (with sample modifier)^1
"DATA",358.1,2,0)
CPT MODIFIER DISPLY W/O SAMPLE^^^0^0^45^21^^^1^CPT MODIFIERS^CR^Display CPT Modifiers (without sample modifier)^1
"DATA",358.2,1,0)
CPT MODIFIERS^1^^^^^2^0^CSU^^1^0^^0^1
"DATA",358.2,1,1,0)
^358.21I^1^1
"DATA",358.2,1,1,1,0)
1^^1
"DATA",358.2,1,2,0)
^358.22I^2^2
"DATA",358.2,1,2,1,0)
1^Code^5^1^1
"DATA",358.2,1,2,2,0)
2^Description^35^1^2^^1
"DATA",358.2,2,0)
CPT MODIFIERS^2^^^^^2^0^CSU^^1^0^^0^1
"DATA",358.2,2,1,0)
^358.21I^1^1
"DATA",358.2,2,1,1,0)
1^^1
"DATA",358.2,2,2,0)
^358.22I^2^2
"DATA",358.2,2,2,1,0)
1^Code^5^1^1
"DATA",358.2,2,2,2,0)
2^Description^35^1^2^^1
"DATA",358.3,1,0)
59^^1^1^1
"DATA",358.3,1,1,0)
^358.31IA^2^2
"DATA",358.3,1,1,1,0)
1^59
"DATA",358.3,1,1,2,0)
2^DISTINCT PROCEDURAL SERVICE
"DATA",358.4,1,0)
BLANK^0^1
"DATA",358.4,2,0)
BLANK^0^2
"DATA",358.6,1,0)
ICPT CPT MODIFIER DISPLAY^CPTMOD^IBDFN4^CPT^1^3^4^1^1^0^^1^^^^^^^^^0
"DATA",358.6,1,1,0)
^^2^2^2991109^^^^
"DATA",358.6,1,1,1,0)
This toolkit block will display a list of CPT Modifiers to aid providers
"DATA",358.6,1,1,2,0)
in determining the correct CPT Modifier to add.
"DATA",358.6,1,2)
Code^5^^^^^^^^^^^^^^Code^1^1
"DATA",358.6,1,3)
CPT MODIFIER CODES
"DATA",358.6,1,15,0)
^357.615I^1^1
"DATA",358.6,1,15,1,0)
SHORT DESCRIPTION^35^2^^Description
"FIA",357.3)
SELECTION
"FIA",357.3,0)
^IBE(357.3,
"FIA",357.3,0,0)
357.3I
"FIA",357.3,0,1)
y^n^p^^^^n
"FIA",357.3,0,10)

"FIA",357.3,0,11)

"FIA",357.3,0,"RLRO")

"FIA",357.3,0,"VR")
3.0^IBD
"FIA",357.3,357.3)
1
"FIA",357.3,357.3,3)

"FIA",357.3,357.33)
0
"FIA",357.6)
PACKAGE INTERFACE
"FIA",357.6,0)
^IBE(357.6,
"FIA",357.6,0,0)
357.6I
"FIA",357.6,0,1)
y^n^f^^y^IBD*3.0*38 PCKG INT^y^r^n
"FIA",357.6,0,10)

"FIA",357.6,0,11)

"FIA",357.6,0,"RLRO")
^DIBT(1738,1)
"FIA",357.6,0,"VR")
3.0^IBD
"FIA",357.6,357.6)
0
"FIA",357.6,357.61)
0
"FIA",357.6,357.613)
0
"FIA",357.6,357.615)
0
"FIA",357.6,357.66)
0
"FIA",357.6,357.67)
0
"FIA",357.91)
MARKING AREA TYPE
"FIA",357.91,0)
^IBE(357.91,
"FIA",357.91,0,0)
357.91
"FIA",357.91,0,1)
n^n^f^^n^PATCH IBD*3.0*38^y^o^n
"FIA",357.91,0,10)

"FIA",357.91,0,11)

"FIA",357.91,0,"RLRO")
^DIBT(1731,1)
"FIA",357.91,0,"VR")
3.0^IBD
"FIA",357.91,357.91)
0
"FIA",357.95)
FORM DEFINITION
"FIA",357.95,0)
^IBD(357.95,
"FIA",357.95,0,0)
357.95I
"FIA",357.95,0,1)
y^n^p^^^^n
"FIA",357.95,0,10)

"FIA",357.95,0,11)

"FIA",357.95,0,"RLRO")

"FIA",357.95,0,"VR")
3.0^IBD
"FIA",357.95,357.95)
1
"FIA",357.95,357.951)
1
"FIA",357.95,357.951,.14)

"FIA",358.1)
IMP/EXP ENCOUNTER FORM BLOCK
"FIA",358.1,0)
^IBE(358.1,
"FIA",358.1,0,0)
358.1I
"FIA",358.1,0,1)
y^n^f^^y^^y^o^n
"FIA",358.1,0,10)

"FIA",358.1,0,11)

"FIA",358.1,0,"RLRO")

"FIA",358.1,0,"VR")
3.0^IBD
"FIA",358.1,358.1)
0
"FIA",358.1,358.11)
0
"FIA",358.2)
IMP/EXP SELECTION LIST
"FIA",358.2,0)
^IBE(358.2,
"FIA",358.2,0,0)
358.2I
"FIA",358.2,0,1)
y^n^f^^y^^y^o^n
"FIA",358.2,0,10)

"FIA",358.2,0,11)

"FIA",358.2,0,"RLRO")

"FIA",358.2,0,"VR")
3.0^IBD
"FIA",358.2,358.2)
0
"FIA",358.2,358.21)
0
"FIA",358.2,358.22)
0
"FIA",358.3)
IMP/EXP SELECTION
"FIA",358.3,0)
^IBE(358.3,
"FIA",358.3,0,0)
358.3I
"FIA",358.3,0,1)
y^n^f^^y^^y^o^n
"FIA",358.3,0,10)

"FIA",358.3,0,11)

"FIA",358.3,0,"RLRO")

"FIA",358.3,0,"VR")
3.0^IBD
"FIA",358.3,358.3)
0
"FIA",358.3,358.31)
0
"FIA",358.3,358.33)
0
"FIA",358.4)
IMP/EXP SELECTION GROUP
"FIA",358.4,0)
^IBE(358.4,
"FIA",358.4,0,0)
358.4I
"FIA",358.4,0,1)
y^n^f^^y^^y^o^n
"FIA",358.4,0,10)

"FIA",358.4,0,11)

"FIA",358.4,0,"RLRO")

"FIA",358.4,0,"VR")
3.0^IBD
"FIA",358.4,358.4)
0
"FIA",358.6)
IMP/EXP PACKAGE INTERFACE
"FIA",358.6,0)
^IBE(358.6,
"FIA",358.6,0,0)
358.6I
"FIA",358.6,0,1)
y^n^f^^y^^y^o^n
"FIA",358.6,0,10)

"FIA",358.6,0,11)

"FIA",358.6,0,"RLRO")

"FIA",358.6,0,"VR")
3.0^IBD
"FIA",358.6,358.6)
0
"FIA",358.6,358.61)
0
"FIA",358.6,358.613)
0
"FIA",358.6,358.615)
0
"FIA",358.6,358.66)
0
"FIA",358.6,358.67)
0
"INI")
PREINIT^IBDY338
"INIT")
IBDY338
"KRN",.402,2414,-1)
0^1
"KRN",.402,2414,0)
IBDF CPT MODIFIER^2990526.1117^@^357.3^^@^3000223
"KRN",.402,2414,"DIAB",1,1,357.33,0)
ALL
"KRN",.402,2414,"DR",1,357.3)
3;
"KRN",.402,2414,"DR",2,357.33)
.01
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PGL",357.6,0,11,.11)
TYPE OF HEALTH SUMMARY^*P142'^GMT(142,^0;11^S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",357.6,0,13,.13)
PACKAGE INTERFACE FOR INPUT^*P357.6'^IBE(357.6,^0;13^S DIC("S")="I $P(^(0),U,6)=1,$P(^(0),U,9)=1,$P(^(0),U,16)[""S""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",357.6,16,2,16.2)
NARRATIVE DATA TYPE^P359.1'^IBE(359.1,^16;2^Q
"PGL",357.6,16,6,16.6)
PRIMARY VALUE DATA TYPE^P359.1'^IBE(359.1,^16;6^Q
"PGL",358.22,0,6,.06)
MARKING AREA^P358.91'^IBE(358.91,^0;6^Q
"PGL",358.22,0,9,.09)
DATA QUALIFIER^P358.98'^IBD(358.98,^0;9^Q
"PGL",358.3,2,2,2.02)
CLINICAL LEXICON ENTRY^P757.01'^LEX(757.01,^2;2^Q
"PGL",358.6,0,11,.11)
TYPE OF HEALTH SUMMARY^*P142'^GMT(142,^0;11^S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",358.6,0,13,.13)
PACKAGE INTERFACE FOR INPUT^*P358.6'^IBE(358.6,^0;13^S DIC("S")="I $P(^(0),U,6)=1,$P(^(0),U,9)=1,$P(^(0),U,16)[""S""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",358.6,16,2,16.2)
NARRATIVE DATA TYPE^P358.99'^IBE(358.99,^16;2^Q
"PGL",358.6,16,6,16.6)
PRIMARY VALUE DATA TYPE^P358.99'^IBE(358.99,^16;6^Q
"PKG",421,-1)
1^1
"PKG",421,0)
AUTOMATED INFO COLLECTION SYS^IBD^The utilities for generating a paper encounter form.
"PKG",421,20,0)
^9.402P^^
"PKG",421,22,0)
^9.49I^1^1
"PKG",421,22,1,0)
3.0^2970212^2970424^1258
"PKG",421,22,1,"PAH",1,0)
38^3000228
"PKG",421,22,1,"PAH",1,1,0)
^^1^1^3000228
"PKG",421,22,1,"PAH",1,1,1,0)
See patch description on NPM for complete details of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
32
"RTN","IBDF17")
0^22^B19904734
"RTN","IBDF17",1,0)
IBDF17 ;ALB/CJM - ENCOUNTER FORM - COPY A CPT CHECK-OFF SHEET INTO A FORM ;24SEP93
"RTN","IBDF17",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDF17",3,0)
 ;DHH
"RTN","IBDF17",4,0)
 ;Allows the user to choose a form to copy to, and a CPT check-off sheet
"RTN","IBDF17",5,0)
 ;to copy from, then creates a new block and copies the CPT codes to it
"RTN","IBDF17",6,0)
 ;
"RTN","IBDF17",7,0)
 N FORM,LIST,BLOCK,SHEET
"RTN","IBDF17",8,0)
 W !!,"Select the encounter form you want to copy CPT codes to!",!
"RTN","IBDF17",9,0)
 S FORM=$$SLCTFORM^IBDFU4(0)
"RTN","IBDF17",10,0)
 Q:'FORM
"RTN","IBDF17",11,0)
 D FIND(FORM,.BLOCK,.LIST)
"RTN","IBDF17",12,0)
 I 'BLOCK W !,"There is no selection list for CPT codes to copy to!" D PAUSE^IBDFU5 Q
"RTN","IBDF17",13,0)
 ;
"RTN","IBDF17",14,0)
 S SHEET=$$SLCTSHT
"RTN","IBDF17",15,0)
 Q:'SHEET
"RTN","IBDF17",16,0)
 ;
"RTN","IBDF17",17,0)
 ;must delete the compiled version of the block, since it will be changed
"RTN","IBDF17",18,0)
 K ^IBE(357.1,BLOCK,"S"),^("V"),^("B"),^("H")
"RTN","IBDF17",19,0)
 ;
"RTN","IBDF17",20,0)
 D COPY(SHEET,LIST)
"RTN","IBDF17",21,0)
 Q
"RTN","IBDF17",22,0)
 ;
"RTN","IBDF17",23,0)
COPY(SHEET,LIST) ;copies the CPT codes/headers from the sheet to the list
"RTN","IBDF17",24,0)
 ;
"RTN","IBDF17",25,0)
 N HDR,TYPE,NODE
"RTN","IBDF17",26,0)
 ;
"RTN","IBDF17",27,0)
 ;find the subcolumns in LIST to write to
"RTN","IBDF17",28,0)
 D SUBCOLS(.LIST) I 'LIST("CODESC")!'LIST("TEXTSC") W !,"The CPT selection list does not contain a subcolumn for the CPT code or text!" D PAUSE^IBDFU5 Q
"RTN","IBDF17",29,0)
 ;
"RTN","IBDF17",30,0)
 S HDR="" F  S HDR=$O(^IBE(350.71,"G",SHEET,HDR)) Q:'HDR  S NODE=$G(^IBE(350.71,HDR,0)),TYPE=$P(NODE,"^",3)  D:TYPE="S" COPYGRP(HDR,.NODE,.LIST)
"RTN","IBDF17",31,0)
 Q
"RTN","IBDF17",32,0)
 ;
"RTN","IBDF17",33,0)
COPYGRP(HDR,NODE,LIST) ;copies the header contained in NODE to the selection list (LIST)
"RTN","IBDF17",34,0)
 ;
"RTN","IBDF17",35,0)
 N HEADER,ORDER,GROUP,PROC
"RTN","IBDF17",36,0)
 S HEADER=$P(NODE,"^") Q:HEADER=""  S ORDER=$P(NODE,"^",2) Q:'ORDER
"RTN","IBDF17",37,0)
 ;
"RTN","IBDF17",38,0)
 ;copy the group
"RTN","IBDF17",39,0)
 K DIC,DD,D0,DINUM S DIC="^IBE(357.4,",X=HEADER,DIC(0)=""
"RTN","IBDF17",40,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDF17",41,0)
 S GROUP=$S(+Y<0:"",1:+Y)
"RTN","IBDF17",42,0)
 Q:'GROUP
"RTN","IBDF17",43,0)
 S ^IBE(357.4,GROUP,0)=HEADER_"^"_ORDER_"^"_LIST
"RTN","IBDF17",44,0)
 K DIK,DA S DIK="^IBE(357.4,",DA=GROUP
"RTN","IBDF17",45,0)
 D IX1^DIK K DIK,DA
"RTN","IBDF17",46,0)
 ;
"RTN","IBDF17",47,0)
 ;now find all the group's procedures and copy them
"RTN","IBDF17",48,0)
 S PROC=0 F  S PROC=$O(^IBE(350.71,"S",HDR,PROC)) Q:'PROC  D:PROC'=HDR COPYPROC(PROC,.LIST,GROUP)
"RTN","IBDF17",49,0)
 ;
"RTN","IBDF17",50,0)
 W "." ;just to let the use know it's doing something
"RTN","IBDF17",51,0)
 Q
"RTN","IBDF17",52,0)
 ;
"RTN","IBDF17",53,0)
COPYPROC(PROC,LIST,GROUP) ;copies the procedure contained to the selection list and group
"RTN","IBDF17",54,0)
 ;
"RTN","IBDF17",55,0)
 N NODE,TEXT,ORDER,CODE,SLCTN
"RTN","IBDF17",56,0)
 S NODE=$G(^IBE(350.71,PROC,0))
"RTN","IBDF17",57,0)
 ;
"RTN","IBDF17",58,0)
 ;find the CPT code
"RTN","IBDF17",59,0)
 S CODE=$P(NODE,"^",6)
"RTN","IBDF17",60,0)
 Q:'CODE
"RTN","IBDF17",61,0)
 S CODE=$P($G(^SD(409.71,CODE,0)),"^")
"RTN","IBDF17",62,0)
 Q:'CODE
"RTN","IBDF17",63,0)
 ;; --change to api cpt ; dhh
"RTN","IBDF17",64,0)
 S CODE=$$CPT^ICPTCOD(CODE)
"RTN","IBDF17",65,0)
 Q:+CODE=-1
"RTN","IBDF17",66,0)
 S CODE=$P(CODE,"^",2)
"RTN","IBDF17",67,0)
 Q:'CODE
"RTN","IBDF17",68,0)
 ;
"RTN","IBDF17",69,0)
 ;find the text and order for the proc on the sheet
"RTN","IBDF17",70,0)
 S TEXT=$P(NODE,"^") Q:TEXT=""  S ORDER=$P(NODE,"^",2) Q:'ORDER
"RTN","IBDF17",71,0)
 ;
"RTN","IBDF17",72,0)
 ;create the selection
"RTN","IBDF17",73,0)
 K DIC,DD,D0,DINUM S DIC="^IBE(357.3,",X=CODE,DIC(0)=""
"RTN","IBDF17",74,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDF17",75,0)
 S SLCTN=$S(+Y<0:"",1:+Y)
"RTN","IBDF17",76,0)
 Q:'SLCTN
"RTN","IBDF17",77,0)
 ;
"RTN","IBDF17",78,0)
 ;fill in the 0 node
"RTN","IBDF17",79,0)
 S ^IBE(357.3,SLCTN,0)=CODE_"^^"_LIST_"^"_GROUP_"^"_ORDER_"^"
"RTN","IBDF17",80,0)
 ;
"RTN","IBDF17",81,0)
 ;fill in the SUBCOLUM VALUE multiple with the subcolumn values
"RTN","IBDF17",82,0)
 S ^IBE(357.3,SLCTN,1,0)="^357.31IA^2^2"
"RTN","IBDF17",83,0)
 S ^IBE(357.3,SLCTN,1,2,0)=LIST("TEXTSC")_"^"_TEXT
"RTN","IBDF17",84,0)
 S ^IBE(357.3,SLCTN,1,1,0)=LIST("CODESC")_"^"_CODE
"RTN","IBDF17",85,0)
 K DIK,DA S DIK="^IBE(357.3,",DA=SLCTN
"RTN","IBDF17",86,0)
 D IX1^DIK K DIK,DA
"RTN","IBDF17",87,0)
 Q
"RTN","IBDF17",88,0)
 ;
"RTN","IBDF17",89,0)
SUBCOLS(LIST) ;finds the column containing the CPT code and the text description
"RTN","IBDF17",90,0)
 ;LIST is passed by reference
"RTN","IBDF17",91,0)
 S (LIST("CODESC"),LIST("TEXTSC"))=""
"RTN","IBDF17",92,0)
 ;
"RTN","IBDF17",93,0)
 N SC,PIECE,NODE S SC=0
"RTN","IBDF17",94,0)
 ;
"RTN","IBDF17",95,0)
 ;piece 1 of the data returned by the package interface is the code,piece 2 is the description
"RTN","IBDF17",96,0)
 F  S SC=$O(^IBE(357.2,LIST,2,SC)) Q:'SC  S NODE=$G(^IBE(357.2,LIST,2,SC,0)),PIECE=$P(NODE,"^",5) S:PIECE=1 LIST("CODESC")=$P(NODE,"^") S:PIECE=2 LIST("TEXTSC")=$P(NODE,"^") Q:LIST("CODESC")&LIST("TEXTSC")
"RTN","IBDF17",97,0)
 Q
"RTN","IBDF17",98,0)
 ;
"RTN","IBDF17",99,0)
SLCTSHT() ;allows the user to select a CPT check-off sheet
"RTN","IBDF17",100,0)
 K DIC S DIC=350.7,DIC(0)="AEMQ" D ^DIC K DIC
"RTN","IBDF17",101,0)
 I $D(DINUM)!$D(DUOUT)!(Y<0) Q ""
"RTN","IBDF17",102,0)
 Q +Y
"RTN","IBDF17",103,0)
FIND(FORM,BLK,LIST) ;finds the block & list for CPT codes
"RTN","IBDF17",104,0)
 N INTRFACE,BLOCKS,I
"RTN","IBDF17",105,0)
 S (BLK,LIST,BLOCKS,I)=0
"RTN","IBDF17",106,0)
 ;
"RTN","IBDF17",107,0)
 ;find the package interface for selecting CPT codes
"RTN","IBDF17",108,0)
 S INTRFACE=$O(^IBE(357.6,"B","DG SELECT CPT PROCEDURE CODES",0))
"RTN","IBDF17",109,0)
 Q:'INTRFACE
"RTN","IBDF17",110,0)
 ;
"RTN","IBDF17",111,0)
 ;find all of the blocks with CPT lists
"RTN","IBDF17",112,0)
 S BLK="" F  S BLK=$O(^IBE(357.1,"C",FORM,BLK)) Q:'BLK  D
"RTN","IBDF17",113,0)
 .S LIST="" F  S LIST=$O(^IBE(357.2,"C",BLK,LIST)) Q:'LIST  I $P($G(^IBE(357.2,LIST,0)),"^",11)=INTRFACE S BLOCKS=BLOCKS+1,I=I+1,BLOCKS(I)=BLK_"^"_LIST
"RTN","IBDF17",114,0)
 ;
"RTN","IBDF17",115,0)
 ;if count of blocks <2 there is no need to ask the user to choose
"RTN","IBDF17",116,0)
 I BLOCKS<2 S BLK=+$P($G(BLOCKS(1)),"^"),LIST=$P($G(BLOCKS(1)),"^",2) Q
"RTN","IBDF17",117,0)
 ;
"RTN","IBDF17",118,0)
 ;if count>1 the user must choose the block from the array BLOCKS
"RTN","IBDF17",119,0)
 S (BLK,LIST)=0
"RTN","IBDF17",120,0)
 S I=$$CHOOSE(.BLOCKS)
"RTN","IBDF17",121,0)
 S BLK=+$G(BLOCKS(+I)),LIST=+$P($G(BLOCKS(+I)),"^",2)
"RTN","IBDF17",122,0)
 Q
"RTN","IBDF17",123,0)
 ;
"RTN","IBDF17",124,0)
CHOOSE(BLOCKS) ;ask the user to choose
"RTN","IBDF17",125,0)
 ;BLOCKS is an array passed by reference
"RTN","IBDF17",126,0)
 ;
"RTN","IBDF17",127,0)
 N I
"RTN","IBDF17",128,0)
ASK W ! S I=0 F  S I=$O(BLOCKS(I)) Q:'I  W !,I,"  ",$P($G(^IBE(357.1,+BLOCKS(I),0)),"^")
"RTN","IBDF17",129,0)
 W !!,"Select a block to put the CPT codes: (1-",BLOCKS,"): "
"RTN","IBDF17",130,0)
 R I:DTIME
"RTN","IBDF17",131,0)
 Q:'$T 0
"RTN","IBDF17",132,0)
 Q:'$G(I) 0
"RTN","IBDF17",133,0)
 I '$D(BLOCKS(I)) G ASK
"RTN","IBDF17",134,0)
 Q I
"RTN","IBDF18A")
0^1^B39891231
"RTN","IBDF18A",1,0)
IBDF18A ;ALB/CJM/AAS - ENCOUNTER FORM - utilities for PCE ;12-AUG-94
"RTN","IBDF18A",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**34,38**;APR 24, 1997
"RTN","IBDF18A",3,0)
 ;                                       
"RTN","IBDF18A",4,0)
GLL(CLINIC,INTRFACE,ARY,FILTER) ; -- get lots of lists in one call
"RTN","IBDF18A",5,0)
 ; -- input see GETLST but pass interface by reference expects
"RTN","IBDF18A",6,0)
 ;    intrface(n) = name of select list in package interface file
"RTN","IBDF18A",7,0)
 ;
"RTN","IBDF18A",8,0)
 ; -- output see GETLST
"RTN","IBDF18A",9,0)
 N X,COUNT
"RTN","IBDF18A",10,0)
 S COUNT=0
"RTN","IBDF18A",11,0)
 S X="" F  S X=$O(INTRFACE(X)) Q:X=""  D GETLST(CLINIC,INTRFACE(X),ARY,$G(FILTER),.COUNT)
"RTN","IBDF18A",12,0)
 Q
"RTN","IBDF18A",13,0)
 ;
"RTN","IBDF18A",14,0)
GETLST(CLINIC,INTRFACE,ARY,FILTER,COUNT,MODIFIER) ; -- returns any specified selection list for a clinic
"RTN","IBDF18A",15,0)
 ; -- input  CLINIC = pointer to hospital location file for clinic
"RTN","IBDF18A",16,0)
 ;         INTRFACE = name of selection list in package interface file
"RTN","IBDF18A",17,0)
 ;              ARY = name of array to return list in
"RTN","IBDF18A",18,0)
 ;           FILTER = predefined filters (optional, default = 1)
"RTN","IBDF18A",19,0)
 ;                                       1 = must be selection list
"RTN","IBDF18A",20,0)
 ;                                       2 = only visit cpts on list
"RTN","IBDF18A",21,0)
 ;         MODIFIER = if modifiers are to be passed, 1=yes send modifiers
"RTN","IBDF18A",22,0)
 ;                                                   
"RTN","IBDF18A",23,0)
 ; -- output  The format of the returned array is as follows
"RTN","IBDF18A",24,0)
 ;         @ARY@(0) = count of array element (0 of nothing found)
"RTN","IBDF18A",25,0)
 ;         @ARY@(1) = ^group header
"RTN","IBDF18A",26,0)
 ;         @ARY@(2) = P1 := cpt or icd code / ien of other items
"RTN","IBDF18A",27,0)
 ;                    P2 := user defined text
"RTN","IBDF18A",28,0)
 ;                    p6 := user defined expanded text to send to PCE
"RTN","IBDF18A",29,0)
 ;                    p7 := second code or item defined for line item
"RTN","IBDF18A",30,0)
 ;                    p8 := third code or item defined for line item
"RTN","IBDF18A",31,0)
 ;                    p9 := associated clinical lexicon term
"RTN","IBDF18A",32,0)
 ;                       
"RTN","IBDF18A",33,0)
 ;         @ARY@(2,"MODIFIER",0)=count of CPT Modifiers for entry
"RTN","IBDF18A",34,0)
 ;         @ARY@(2,"MODIFIER",1)=2 character CPT Modifier value
"RTN","IBDF18A",35,0)
 ;         @ARY@(2,"MODIFIER",2)=2 character CPT Modifier value
"RTN","IBDF18A",36,0)
 ;         @ARY@(2,"MODIFIER",k+1)=2 character CPT Modifier value
"RTN","IBDF18A",37,0)
 ;        
"RTN","IBDF18A",38,0)
 ;         @ARY@(k) = ^next group header
"RTN","IBDF18A",39,0)
 ;       @ARY@(k+1) = problem ien or cpt or icd code^user define text
"RTN","IBDF18A",40,0)
 ;
"RTN","IBDF18A",41,0)
 ; -- output modification for patch 34:
"RTN","IBDF18A",42,0)
 ;         Narrative to Send to PCE (instead of printed text)
"RTN","IBDF18A",43,0)
 ;         field (2.01) in file 357.3, added as piece 6 of @ary@(n)
"RTN","IBDF18A",44,0)
 ;
"RTN","IBDF18A",45,0)
 ;         if additional codes for an item (diagnosis) are added to
"RTN","IBDF18A",46,0)
 ;         item, they are added as pieces 7 and/or 8 of @ary@(n).
"RTN","IBDF18A",47,0)
 ;
"RTN","IBDF18A",48,0)
 ;         if a type of visit code is requested and none found, will
"RTN","IBDF18A",49,0)
 ;         automatically look first for blocks named type of visit and
"RTN","IBDF18A",50,0)
 ;         second for filtered codes using regular cpt blocks.
"RTN","IBDF18A",51,0)
 ;
"RTN","IBDF18A",52,0)
 ;         if a diagnosis block it requested and none found will
"RTN","IBDF18A",53,0)
 ;         automagically look for Clinic Common Problem List and
"RTN","IBDF18A",54,0)
 ;         then convert it to look like a diagnosis list
"RTN","IBDF18A",55,0)
 ;
"RTN","IBDF18A",56,0)
 N I,J,X,Y,INUM,IBQUIT,FORM,SETUP,LIST,BLOCK,OLDARY,IBDTMP,ROW,COL,BLK
"RTN","IBDF18A",57,0)
 K ^TMP("IBDUP",$J)
"RTN","IBDF18A",58,0)
 S (IBQUIT,LIST)=0
"RTN","IBDF18A",59,0)
 S COUNT=$G(COUNT,0)
"RTN","IBDF18A",60,0)
 I $G(FILTER)<1 S FILTER=1 ;default value=1
"RTN","IBDF18A",61,0)
 I FILTER>1 S OLDARY=ARY,ARY="IBDTMP"
"RTN","IBDF18A",62,0)
 S @ARY@(0)=+$G(@ARY@(0))
"RTN","IBDF18A",63,0)
 I $G(CLINIC)="" G GETLSTQ
"RTN","IBDF18A",64,0)
 I $G(^SC(CLINIC,0))="" G GETLSTQ
"RTN","IBDF18A",65,0)
 I $G(INTRFACE)="" G GETLSTQ
"RTN","IBDF18A",66,0)
 S INUM=$O(^IBE(357.6,"B",$E(INTRFACE,1,30),0))
"RTN","IBDF18A",67,0)
 ; 
"RTN","IBDF18A",68,0)
 ; -- find forms defined for clinic
"RTN","IBDF18A",69,0)
 ;    piece 2 = basic form
"RTN","IBDF18A",70,0)
 ;    piece 3,4,6 = supplemental forms
"RTN","IBDF18A",71,0)
 S SETUP=$G(^SD(409.95,+$O(^SD(409.95,"B",CLINIC,0)),0))
"RTN","IBDF18A",72,0)
 G:SETUP="" GETLSTQ
"RTN","IBDF18A",73,0)
 F I=2,3,4,6,8,9 S FORM=$P(SETUP,"^",I) D  Q:IBQUIT
"RTN","IBDF18A",74,0)
 .;
"RTN","IBDF18A",75,0)
 .; -- find blocks on forms
"RTN","IBDF18A",76,0)
 .Q:'FORM
"RTN","IBDF18A",77,0)
 . D GETBLKS Q:'$O(BLK(0))
"RTN","IBDF18A",78,0)
 . S (ROW,COL)=""
"RTN","IBDF18A",79,0)
 . F  S ROW=$O(BLK(ROW)) Q:ROW=""  S COL="" F  S COL=$O(BLK(ROW,COL)) Q:COL=""  S BLOCK=$G(BLK(+ROW,+COL)) D
"RTN","IBDF18A",80,0)
 ..;
"RTN","IBDF18A",81,0)
 ..; -- see if package interface defined for blocks
"RTN","IBDF18A",82,0)
 ..S LIST=0
"RTN","IBDF18A",83,0)
 ..F  S LIST=$O(^IBE(357.2,"C",BLOCK,LIST)) Q:'LIST  I $P($G(^IBE(357.2,LIST,0)),"^",11)=INUM D COPYLIST^IBDF18A1(LIST,ARY,.COUNT)
"RTN","IBDF18A",84,0)
 ;I COUNT D URH^IBDF18A1
"RTN","IBDF18A",85,0)
 S @ARY@(0)=COUNT
"RTN","IBDF18A",86,0)
 I FILTER=2 D F2^IBDF18A1(OLDARY)
"RTN","IBDF18A",87,0)
 ;
"RTN","IBDF18A",88,0)
 I COUNT=0 D
"RTN","IBDF18A",89,0)
 .I $E(INTRFACE,1,30)=$E("DG SELECT VISIT TYPE CPT PROCEDURES",1,30) D TOV
"RTN","IBDF18A",90,0)
 ;
"RTN","IBDF18A",91,0)
 ; -- always check for both diagnosis and clinic common problems when
"RTN","IBDF18A",92,0)
 ;    looking for diagnosis, return in diagnosis format
"RTN","IBDF18A",93,0)
 I $E(INTRFACE,1,30)=$E("DG SELECT ICD-9 DIAGNOSIS CODES",1,30) D CCP(COUNT)
"RTN","IBDF18A",94,0)
 ;
"RTN","IBDF18A",95,0)
 K ^TMP("IBDUP",$J)
"RTN","IBDF18A",96,0)
 ;
"RTN","IBDF18A",97,0)
GETLSTQ Q
"RTN","IBDF18A",98,0)
 ;
"RTN","IBDF18A",99,0)
GETBLKS ; -- get the blocks for a form in row,column order
"RTN","IBDF18A",100,0)
 K BLK
"RTN","IBDF18A",101,0)
 N ROW,COL
"RTN","IBDF18A",102,0)
 S BLK=0
"RTN","IBDF18A",103,0)
 F  S BLK=$O(^IBE(357.1,"C",FORM,BLK)) Q:'BLK  D
"RTN","IBDF18A",104,0)
 . S ROW=$P($G(^IBE(357.1,+BLK,0)),"^",4),COL=$P(^(0),"^",5)
"RTN","IBDF18A",105,0)
 . Q:ROW=""!(COL="")
"RTN","IBDF18A",106,0)
 . S BLK(ROW,COL)=BLK
"RTN","IBDF18A",107,0)
 Q
"RTN","IBDF18A",108,0)
 ;
"RTN","IBDF18A",109,0)
CCP(COUNT) ; -- no diagnosis, look for common problems and convert
"RTN","IBDF18A",110,0)
 N I,X,OLDCNT
"RTN","IBDF18A",111,0)
 S OLDCNT=COUNT
"RTN","IBDF18A",112,0)
 ;
"RTN","IBDF18A",113,0)
 ; -- get the clinic common problem list
"RTN","IBDF18A",114,0)
 D GETLST(CLINIC,"GMP SELECT CLINIC COMMON PROBLEMS",ARY,"",COUNT)
"RTN","IBDF18A",115,0)
 ;
"RTN","IBDF18A",116,0)
 ; -- now convert it to primary icd code save lexicon pointer in piece 6
"RTN","IBDF18A",117,0)
 S I=OLDCNT
"RTN","IBDF18A",118,0)
 F  S I=$O(VAR(I)) Q:I=""  D
"RTN","IBDF18A",119,0)
 .S X=+VAR(I)
"RTN","IBDF18A",120,0)
 . S:X $P(VAR(I),"^",9)=X,$P(VAR(I),"^",1)=$$ICDONE^LEXU(X)
"RTN","IBDF18A",121,0)
 . I $P(VAR(I),"^",7) S $P(VAR(I),"^",7)=$$ICDONE^LEXU($P(VAR(I),"^",7))
"RTN","IBDF18A",122,0)
 . I $P(VAR(I),"^",8) S $P(VAR(I),"^",8)=$$ICDONE^LEXU($P(VAR(I),"^",8))
"RTN","IBDF18A",123,0)
 Q
"RTN","IBDF18A",124,0)
 ;
"RTN","IBDF18A",125,0)
TOV ; -- if trying to find Type of Visit codes but list on form
"RTN","IBDF18A",126,0)
 ;    uses another interface try this
"RTN","IBDF18A",127,0)
 ;
"RTN","IBDF18A",128,0)
 N INUM
"RTN","IBDF18A",129,0)
 S INUM=0
"RTN","IBDF18A",130,0)
 F  S INUM=$O(^IBE(357.6,"B","DG SELECT CPT PROCEDURE CODES",INUM)) Q:'INUM  S INUM(INUM)=""
"RTN","IBDF18A",131,0)
 D TOV1
"RTN","IBDF18A",132,0)
 I COUNT=0 D TOV2
"RTN","IBDF18A",133,0)
 Q
"RTN","IBDF18A",134,0)
 ;
"RTN","IBDF18A",135,0)
TOV1 ; -- first get all lists for blocks named Type of Visit or E&M
"RTN","IBDF18A",136,0)
 N NM,HD
"RTN","IBDF18A",137,0)
 F I=2,3,4,6,8,9 S FORM=$P(SETUP,"^",I) D:+FORM  Q:IBQUIT
"RTN","IBDF18A",138,0)
 . ;
"RTN","IBDF18A",139,0)
 . ; -- find blocks on forms
"RTN","IBDF18A",140,0)
 . D GETBLKS Q:'$O(BLK(0))
"RTN","IBDF18A",141,0)
 . S (ROW,COL)=""
"RTN","IBDF18A",142,0)
 . F  S ROW=$O(BLK(ROW)) Q:ROW=""  S COL="" F  S COL=$O(BLK(ROW,COL)) Q:COL=""  S BLOCK=$G(BLK(+ROW,+COL)) D
"RTN","IBDF18A",143,0)
 .. ;
"RTN","IBDF18A",144,0)
 .. S NM=$P($G(^IBE(357.1,BLOCK,0)),"^",1)
"RTN","IBDF18A",145,0)
 .. S NM=$TR(NM,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","IBDF18A",146,0)
 .. S HD=$P($G(^IBE(357.1,BLOCK,0)),"^",11)
"RTN","IBDF18A",147,0)
 .. S HD=$TR(HD,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","IBDF18A",148,0)
 .. I NM["TYPE OF VISIT"!(NM["VISIT TYPE")!(HD["TYPE OF VISIT")!(HD["VISIT TYPE")!(NM["E&M")!(NM["E & M")!(HD["E&M")!(HD["E & M") D
"RTN","IBDF18A",149,0)
 ... S LIST=0
"RTN","IBDF18A",150,0)
 ... F  S LIST=$O(^IBE(357.2,"C",BLOCK,LIST)) Q:'LIST  D
"RTN","IBDF18A",151,0)
 .... I $D(INUM($P($G(^IBE(357.2,LIST,0)),"^",11))) D COPYLIST^IBDF18A1(LIST,ARY,.COUNT) K BLK(ROW,COL)
"RTN","IBDF18A",152,0)
 Q
"RTN","IBDF18A",153,0)
 ;
"RTN","IBDF18A",154,0)
TOV2 ; -- get the type of visit codes from cpt lists using filter
"RTN","IBDF18A",155,0)
 S OLDARY=ARY,ARY="IBDTMP"
"RTN","IBDF18A",156,0)
 S @ARY@(0)=+$G(@ARY@(0))
"RTN","IBDF18A",157,0)
 ;
"RTN","IBDF18A",158,0)
 F I=2,3,4,6,8,9 S FORM=$P(SETUP,"^",I) D:+FORM  Q:IBQUIT
"RTN","IBDF18A",159,0)
 . ;
"RTN","IBDF18A",160,0)
 . ; -- find blocks on forms
"RTN","IBDF18A",161,0)
 . S (ROW,COL)=""
"RTN","IBDF18A",162,0)
 . F  S ROW=$O(BLK(ROW)) Q:ROW=""  S COL="" F  S COL=$O(BLK(ROW,COL)) Q:COL=""  S BLOCK=$G(BLK(+ROW,+COL)) D
"RTN","IBDF18A",163,0)
 .. ;
"RTN","IBDF18A",164,0)
 .. ; -- see if package interface defined for blocks
"RTN","IBDF18A",165,0)
 .. S LIST=0
"RTN","IBDF18A",166,0)
 .. F  S LIST=$O(^IBE(357.2,"C",BLOCK,LIST)) Q:'LIST  I $D(INUM($P($G(^IBE(357.2,LIST,0)),"^",11))) D COPYLIST^IBDF18A1(LIST,ARY,.COUNT)
"RTN","IBDF18A",167,0)
 D F2^IBDF18A1(OLDARY)
"RTN","IBDF18A",168,0)
 Q
"RTN","IBDF18A",169,0)
 ;
"RTN","IBDF18A",170,0)
 ; -- here are some sample tests for different lists
"RTN","IBDF18A",171,0)
TEST1 K VAR D GETLST(573,"DG SELECT ICD-9 DIAGNOSIS CODES","VAR",1)
"RTN","IBDF18A",172,0)
 X "ZW VAR"
"RTN","IBDF18A",173,0)
 Q
"RTN","IBDF18A",174,0)
 ;
"RTN","IBDF18A",175,0)
TEST2 K VAR D GETLST(301,"DG SELECT ICD-9 DIAGNOSIS CODES","VAR",1)
"RTN","IBDF18A",176,0)
 X "ZW VAR"
"RTN","IBDF18A",177,0)
 Q
"RTN","IBDF18A",178,0)
 ;
"RTN","IBDF18A",179,0)
TEST4 K VAR D GETLST(300,"DG SELECT VISIT TYPE CPT PROCEDURES","VAR",1)
"RTN","IBDF18A",180,0)
 X "ZW VAR"
"RTN","IBDF18A",181,0)
 Q
"RTN","IBDF18A",182,0)
 ;
"RTN","IBDF18A",183,0)
TEST5 K VAR D GETLST(300,"PX SELECT IMMUNIZATIONS","VAR",1)
"RTN","IBDF18A",184,0)
 X "ZW VAR"
"RTN","IBDF18A",185,0)
 Q
"RTN","IBDF18A",186,0)
 ;
"RTN","IBDF18A",187,0)
TEST6 K VAR D GETLST(573,"DG SELECT CPT PROCEDURE CODES","VAR",1)
"RTN","IBDF18A",188,0)
 X "ZW VAR"
"RTN","IBDF18A",189,0)
 Q
"RTN","IBDF18A",190,0)
 ;
"RTN","IBDF18A",191,0)
TEST7 K VAR D GETLST(573,"DG SELECT VISIT TYPE CPT PROCEDURES","VAR",1)
"RTN","IBDF18A",192,0)
 X "ZW VAR"
"RTN","IBDF18A",193,0)
 Q
"RTN","IBDF18A",194,0)
 ;
"RTN","IBDF18A",195,0)
TEST8 ; -- use this to test CPRS ability to retrieve type of visit
"RTN","IBDF18A",196,0)
 ;    set clinic := name or internal entry number of clinic or change
"RTN","IBDF18A",197,0)
 ;    value for specific clinic
"RTN","IBDF18A",198,0)
 K VAR
"RTN","IBDF18A",199,0)
 I $G(CLINIC)="" S CLINIC=300
"RTN","IBDF18A",200,0)
 I CLINIC'=+CLINIC W !,"Using Clinic: ",CLINIC S CLINIC=$O(^SC("B",CLINIC,0)) W !,"IEN: ",CLINIC,! H 5
"RTN","IBDF18A",201,0)
 X "D VISIT^ORWPCE(.VAR,CLINIC) ZW VAR"
"RTN","IBDF18A",202,0)
 Q
"RTN","IBDF18A",203,0)
 ;
"RTN","IBDF18A",204,0)
TEST9 K VAR D GETLST(301,"GMP SELECT CLINIC COMMON PROBLEMS","VAR",1)
"RTN","IBDF18A",205,0)
 X "ZW VAR"
"RTN","IBDF18A",206,0)
 Q
"RTN","IBDF18A1")
0^2^B20186992
"RTN","IBDF18A1",1,0)
IBDF18A1 ;ALB/CJM/AAS - ENCOUNTER FORM - utilities for PCE ;12-AUG-94
"RTN","IBDF18A1",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**34,38**;APR 24, 1997
"RTN","IBDF18A1",3,0)
 ;
"RTN","IBDF18A1",4,0)
COPYLIST(LIST,ARY,COUNT) ;
"RTN","IBDF18A1",5,0)
 ; -- copies the entries from LIST to @ARY, starting subscript at COUNT+1
"RTN","IBDF18A1",6,0)
 ;
"RTN","IBDF18A1",7,0)
 N SLCTN,NODE,NODE1,NODE2,TSUBCOL,GROUP,ORDER,HDR,PRNT
"RTN","IBDF18A1",8,0)
 ;
"RTN","IBDF18A1",9,0)
 D SUBCOL(LIST,.TSUBCOL) ;find the subcolumn containing the text
"RTN","IBDF18A1",10,0)
 ;
"RTN","IBDF18A1",11,0)
 S PRNT=""
"RTN","IBDF18A1",12,0)
 F  S PRNT=$O(^IBE(357.4,"APO",LIST,PRNT)) Q:PRNT=""  D
"RTN","IBDF18A1",13,0)
 . S GROUP=""
"RTN","IBDF18A1",14,0)
 . F  S GROUP=$O(^IBE(357.4,"APO",LIST,PRNT,GROUP)) Q:GROUP=""  D
"RTN","IBDF18A1",15,0)
 .. S HDR=$P($G(^IBE(357.4,GROUP,0)),"^")
"RTN","IBDF18A1",16,0)
 .. I HDR="BLANK" S HDR=""
"RTN","IBDF18A1",17,0)
 .. S COUNT=COUNT+1,@ARY@(COUNT)="^"_HDR
"RTN","IBDF18A1",18,0)
 .. S ORDER=""
"RTN","IBDF18A1",19,0)
 .. F  S ORDER=$O(^IBE(357.3,"APO",LIST,GROUP,ORDER)) Q:ORDER=""  D
"RTN","IBDF18A1",20,0)
 ... S SLCTN=0
"RTN","IBDF18A1",21,0)
 ... F  S SLCTN=$O(^IBE(357.3,"APO",LIST,GROUP,ORDER,SLCTN)) Q:'SLCTN  D
"RTN","IBDF18A1",22,0)
 .... S NODE=$G(^IBE(357.3,SLCTN,0))
"RTN","IBDF18A1",23,0)
 .... S NODE2=$G(^IBE(357.3,SLCTN,2))
"RTN","IBDF18A1",24,0)
 .... S NODE1=$G(^IBE(357.3,SLCTN,1,+$O(^IBE(357.3,SLCTN,1,"B",+TSUBCOL,0)),0))
"RTN","IBDF18A1",25,0)
 .... ; -- return placeholders as headers when use as subheader
"RTN","IBDF18A1",26,0)
 .... ;    is yes and quit
"RTN","IBDF18A1",27,0)
 .... I $P(NODE,"^",2),$P(NODE,"^",7)=1 D  Q
"RTN","IBDF18A1",28,0)
 ..... S COUNT=COUNT+1,@ARY@(COUNT)="^"_$P(NODE,"^",6)
"RTN","IBDF18A1",29,0)
 .... ;
"RTN","IBDF18A1",30,0)
 .... I $P(NODE1,"^")=TSUBCOL,$L($P(NODE1,"^",2)) S COUNT=COUNT+1,@ARY@(COUNT)=$P(NODE,"^")_"^"_$P(NODE1,"^",2)_"^^^^"_$P(NODE2,"^")_"^"_$P(NODE2,"^",3)_"^"_$P(NODE2,"^",4)_"^"_$P(NODE2,"^",2)
"RTN","IBDF18A1",31,0)
 .... D MODLIST
"RTN","IBDF18A1",32,0)
 Q
"RTN","IBDF18A1",33,0)
 ;
"RTN","IBDF18A1",34,0)
SUBCOL(LIST,TSUBCOL) ; -- finds the subcolumn containing the text
"RTN","IBDF18A1",35,0)
 ; -- TSUBCOL passed by reference - used to return the subcolumn
"RTN","IBDF18A1",36,0)
 ;    LIST is the selection list to search
"RTN","IBDF18A1",37,0)
 ;
"RTN","IBDF18A1",38,0)
 ; -- refering to the data returned by the package interface,
"RTN","IBDF18A1",39,0)
 ;    piece 2 is usually the description
"RTN","IBDF18A1",40,0)
 ;
"RTN","IBDF18A1",41,0)
 N PI,SC
"RTN","IBDF18A1",42,0)
 S TSUBCOL="",SC=0
"RTN","IBDF18A1",43,0)
 S PI=$P($G(^IBE(357.6,+$P($G(^IBE(357.2,+LIST,0)),"^",11),0)),"^")
"RTN","IBDF18A1",44,0)
 ;
"RTN","IBDF18A1",45,0)
 F  S SC=$O(^IBE(357.2,LIST,2,SC)) Q:'SC  D
"RTN","IBDF18A1",46,0)
 .Q:$P($G(^IBE(357.2,LIST,2,SC,0)),"^",4)=2  ;is a marking area
"RTN","IBDF18A1",47,0)
 .I $P($G(^IBE(357.2,LIST,2,SC,0)),"^",5)=2 S TSUBCOL=$P(^(0),"^") Q
"RTN","IBDF18A1",48,0)
 .I TSUBCOL="",$P($G(^IBE(357.2,LIST,2,SC,0)),"^",5)>2 S TSUBCOL=$P(^(0),"^") Q  ; -- see if other than data piece two is text subcolumn
"RTN","IBDF18A1",49,0)
 .;
"RTN","IBDF18A1",50,0)
 .; -- utility for selecting blanks is exception
"RTN","IBDF18A1",51,0)
 .I TSUBCOL="",PI="IBDF UTILITY FOR SELECTING BLANKS",$P($G(^IBE(357.2,LIST,2,SC,0)),"^",5)=1 S TSUBCOL=$P(^(0),"^") Q
"RTN","IBDF18A1",52,0)
 Q
"RTN","IBDF18A1",53,0)
 ;
"RTN","IBDF18A1",54,0)
F2(ARY) ; -- filter cpt code array to find only codes beginning with 992 and asssicated headers
"RTN","IBDF18A1",55,0)
 ; -- Copy filtered array to from ibdtmp( to @ary@(
"RTN","IBDF18A1",56,0)
 ;
"RTN","IBDF18A1",57,0)
 N NODE,IBQUIT,COUNT
"RTN","IBDF18A1",58,0)
 S (COUNT,IBQUIT)=0
"RTN","IBDF18A1",59,0)
 ;
"RTN","IBDF18A1",60,0)
 ;I INTRFACE'="DG SELECT CPT PROCEDURE CODES" S @ARY=IBDTMP K IBDTMP
"RTN","IBDF18A1",61,0)
 ;
"RTN","IBDF18A1",62,0)
 S NODE="" F  S NODE=$O(IBDTMP(NODE),-1) Q:NODE=""  I $E(IBDTMP(NODE),1,3)=992 D  ;Q:IBQUIT  ;comment out the q:ibquit if want from more than 1 list
"RTN","IBDF18A1",63,0)
 .;
"RTN","IBDF18A1",64,0)
 .S @ARY@(NODE)=IBDTMP(NODE),COUNT=COUNT+1 ;this is bottom of list
"RTN","IBDF18A1",65,0)
 .;
"RTN","IBDF18A1",66,0)
 .; -- process from bottom of list to header
"RTN","IBDF18A1",67,0)
 .F  S NODE=$O(IBDTMP(NODE),-1) Q:NODE=""  D  Q:IBQUIT
"RTN","IBDF18A1",68,0)
 ..S IBQUIT=0
"RTN","IBDF18A1",69,0)
 ..I $E(IBDTMP(NODE),1,3)=992 S @ARY@(NODE)=IBDTMP(NODE),COUNT=COUNT+1
"RTN","IBDF18A1",70,0)
 ..I $P(IBDTMP(NODE),"^",1)="" S @ARY@(NODE)=IBDTMP(NODE),IBQUIT=1,COUNT=COUNT+1
"RTN","IBDF18A1",71,0)
 I COUNT S @ARY@(0)=COUNT
"RTN","IBDF18A1",72,0)
 Q
"RTN","IBDF18A1",73,0)
 ;
"RTN","IBDF18A1",74,0)
URH ; -- UnReferenced Headers (removal)
"RTN","IBDF18A1",75,0)
 ;    if a header doesn't have any data under it, then remove the header
"RTN","IBDF18A1",76,0)
 N X,HDR
"RTN","IBDF18A1",77,0)
 S X=0 F  S X=$O(@ARY@(X)) Q:'X  D
"RTN","IBDF18A1",78,0)
 .I '$D(HDR),$P(@ARY@(X),"^",1)="" S HDR=X Q  ;find a header
"RTN","IBDF18A1",79,0)
 .I $P(@ARY@(X),"^",1)="" K HDR Q  ; is item under header
"RTN","IBDF18A1",80,0)
 .; -- patch 34 check if piece one below = null instead of positive
"RTN","IBDF18A1",81,0)
 .I $D(HDR),$P(@ARY@(X),"^",1)="" K @ARY@(HDR) S COUNT=COUNT-1,HDR=X ;hdr doesn't have any items, kill hdr node and reset header to next header
"RTN","IBDF18A1",82,0)
 .;I $D(HDR),$P(@ARY@(X),"^",1) K @ARY@(HDR) S COUNT=COUNT-1,HDR=X ;hdr doesn't have any items, kill hdr node and reset header to next header
"RTN","IBDF18A1",83,0)
 I $D(HDR) S X=$O(@ARY@(""),-1) I $P(@ARY@(X),"^",1)="" K @ARY@(X) S COUNT=COUNT-1,HDR=X ;last item in list is a header
"RTN","IBDF18A1",84,0)
 Q
"RTN","IBDF18A1",85,0)
MODLIST ; return all CPT Modifiers if defined
"RTN","IBDF18A1",86,0)
 ;
"RTN","IBDF18A1",87,0)
 Q:$G(MODIFIER)'=1
"RTN","IBDF18A1",88,0)
 N MCOUNT,MOD
"RTN","IBDF18A1",89,0)
 Q:'$D(^IBE(357.3,SLCTN,3))
"RTN","IBDF18A1",90,0)
 S MCOUNT=0
"RTN","IBDF18A1",91,0)
 F MOD=0:0 S MOD=$O(^IBE(357.3,SLCTN,3,MOD)) Q:'MOD  D
"RTN","IBDF18A1",92,0)
 . S MCOUNT=MCOUNT+1
"RTN","IBDF18A1",93,0)
 . S @ARY@(COUNT,"MODIFIER",MCOUNT)=$G(^IBE(357.3,SLCTN,3,MOD,0))
"RTN","IBDF18A1",94,0)
 S:MCOUNT>0 @ARY@(COUNT,"MODIFIER",0)=MCOUNT
"RTN","IBDF18A1",95,0)
 Q
"RTN","IBDF18E")
0^3^B42132833
"RTN","IBDF18E",1,0)
IBDF18E ;ALB/CJM - ENCOUNTER FORM - PCE DEVICE INTERFACE utilities ;04-OCT-94
"RTN","IBDF18E",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**3,25,38**;APR 24, 1997
"RTN","IBDF18E",3,0)
 ;
"RTN","IBDF18E",4,0)
SEND(FORMID,PROVIDER,PROVTYPE,BUBBLES,HANDPRNT,CHECKOUT,PXCA,DYNAMIC) ;builds the PCXA array and passes it to PCE, updates form tracking status
"RTN","IBDF18E",5,0)
 ;input:
"RTN","IBDF18E",6,0)
 ;   FORMID = the unique id assigned to the printed form, points to the FORM TRACKING file
"RTN","IBDF18E",7,0)
 ;   PROVIDER=pointer to NEW PERSON file (#200) (optional)
"RTN","IBDF18E",8,0)
 ;   PROVTYPE= P:=primary,S:=secondary (optional)
"RTN","IBDF18E",9,0)
 ;   BUBBLES = an array which should be passed by reference, BUBBLES is the list of bubbles marked on the form, subscripted by pointers to the BUBBLES multiple in the FORM DEFINITION TABLE
"RTN","IBDF18E",10,0)
 ;   HANDPRNT is the list of hand print fields marked on the form - subscripted by pointers to the HAND PRINT FIELDS multiple in the FORM DEFINITION TABLE, the value being what was input (HANDPRINT(<ien>)=<value>) - should be passed by reference
"RTN","IBDF18E",11,0)
 ;   CHECKOUT = checkout data@time
"RTN","IBDF18E",12,0)
 ;   DYNAMIC = an array which should be passed by reference, contains the list of bubbles selected from dynamic selection lists
"RTN","IBDF18E",13,0)
 ;
"RTN","IBDF18E",14,0)
 ;output:
"RTN","IBDF18E",15,0)
 ;    = 0 if the data is not passed to PCE
"RTN","IBDF18E",16,0)
 ;    = 1 if PXCA is passed by reference, and the data is passed to PCE
"RTN","IBDF18E",17,0)
 ;    the PXCA array is returned, principally to aid in debugging
"RTN","IBDF18E",18,0)
 ;
"RTN","IBDF18E",19,0)
 ;example: S RETURN=$$SEND^IBDF18E(3,DOCTOR,"P",.BUBBLES,.HANDPRNT)
"RTN","IBDF18E",20,0)
 ;
"RTN","IBDF18E",21,0)
 N D,D0,NODE,FORMTYPE,PXCASTAT,IBAPPT,IBCLINIC,IBDFN,VALUE,VALUE1,PI,TEXT,HEADER,QLFR,BUB,STATUS,IBSOURCE,HAND,COUNT,FID,TEMP,ITEM,TYPE,IBDF,LEX,PLEX,QUANTITY,NARR,SLCTN
"RTN","IBDF18E",22,0)
 ;
"RTN","IBDF18E",23,0)
 S FORMID("WSID")=$G(^TMP("IBD-SCAN-RAWDATA",$J,"WSID"))
"RTN","IBDF18E",24,0)
 S FORMID("PAGE")=+$P($G(^TMP("IBD-SCAN-RAWDATA",$J,"FD1")),"PAGE=",2)
"RTN","IBDF18E",25,0)
 K PXCA
"RTN","IBDF18E",26,0)
 S (PXCA,PXCASTAT)=""
"RTN","IBDF18E",27,0)
 ;
"RTN","IBDF18E",28,0)
 ;check that the required parameters were passed
"RTN","IBDF18E",29,0)
 I '$G(FORMID) D LOGERR^IBDF18E2(3579601,.FORMID) Q 0
"RTN","IBDF18E",30,0)
 ;
"RTN","IBDF18E",31,0)
 ;there must be an entry in form tracking - retrieve it into FORMID array
"RTN","IBDF18E",32,0)
 I '$$TRACKING^IBDF18E0(.FORMID) D LOGERR^IBDF18E2(3579501,.FORMID) Q 0
"RTN","IBDF18E",33,0)
 ;
"RTN","IBDF18E",34,0)
 ;there must be a form definition table
"RTN","IBDF18E",35,0)
 S FORMTYPE=$P(NODE,"^",4)
"RTN","IBDF18E",36,0)
 I 'FORMTYPE S STATUS=$$FSCND^IBDF18C(FORMID,12) Q 0
"RTN","IBDF18E",37,0)
 I '$G(^IBD(357.95,FORMTYPE,0)) S STATUS=$$FSCND^IBDF18C(FORMID,12) Q 0
"RTN","IBDF18E",38,0)
 ;
"RTN","IBDF18E",39,0)
 S PROVIDER=$G(PROVIDER)
"RTN","IBDF18E",40,0)
 S PROVTYPE=$G(PROVTYPE)
"RTN","IBDF18E",41,0)
 ;
"RTN","IBDF18E",42,0)
 ;build the encounter node and source node from form tracking
"RTN","IBDF18E",43,0)
 S PXCA("ENCOUNTER")=FORMID("APPT")_"^"_FORMID("DFN")_"^"_FORMID("CLINIC")_"^"_PROVIDER_"^^^^^^^^^^"_CHECKOUT_"^"_PROVTYPE
"RTN","IBDF18E",44,0)
 S PXCA("SOURCE")=+FORMID("SOURCE")_"^"_DUZ_"^"_FORMTYPE_"^^"_FORMID
"RTN","IBDF18E",45,0)
 ;
"RTN","IBDF18E",46,0)
 ;now for each bubble in BUBBLES() add to TEMP()
"RTN","IBDF18E",47,0)
 S BUB=0 F  S BUB=$O(BUBBLES(BUB)) Q:BUB=""  S:BUB NODE=$G(^IBD(357.95,FORMTYPE,1,BUB,0)) D
"RTN","IBDF18E",48,0)
 .N SUBHDR
"RTN","IBDF18E",49,0)
 .I 'BUB!(NODE="") D LOGERR^IBDF18E2(3579502,.FORMID,BUB,BUBBLES(BUB)) Q
"RTN","IBDF18E",50,0)
 .S $P(NODE,"^",8)=$S($D(^IBD(357.95,FORMTYPE,1,BUB,2))&($P($G(^IBD(357.95,FORMTYPE,1,BUB,2)),"^",1)]""):$P($G(^IBD(357.95,FORMTYPE,1,BUB,2)),"^",1),1:$P(NODE,"^",8))
"RTN","IBDF18E",51,0)
 .S VALUE=$P(NODE,"^",4)
"RTN","IBDF18E",52,0)
 .S PI=$P(NODE,"^",3)
"RTN","IBDF18E",53,0)
 .S TEXT=$P(NODE,"^",8)
"RTN","IBDF18E",54,0)
 .; -- strip :: code from TEXT if it exists
"RTN","IBDF18E",55,0)
 .I TEXT[" :: " S TEXT=$$DISP^IBDFM1(TEXT)
"RTN","IBDF18E",56,0)
 .;I TEXT[" :: ",PI,VALUE D
"RTN","IBDF18E",57,0)
 .;.S (Y,X)=VALUE X $G(^IBE(357.6,PI,14)) I Y]"" S TEXT=$P(TEXT," :: "_Y)
"RTN","IBDF18E",58,0)
 .S SUBHDR=$G(^IBD(357.95,FORMTYPE,1,BUB,1))
"RTN","IBDF18E",59,0)
 .;
"RTN","IBDF18E",60,0)
 .; -- the following line causes the subheader and display text to
"RTN","IBDF18E",61,0)
 .;    to be concatenated except for IB, which can pass an alternate
"RTN","IBDF18E",62,0)
 .;    text.  (some don't like this when passed to Problem List)
"RTN","IBDF18E",63,0)
 .;    This may need to be re-visited in the future
"RTN","IBDF18E",64,0)
 .I +FORMID("SOURCE")'=1,$L(SUBHDR),($L(SUBHDR)+$L(TEXT)<80) S TEXT=SUBHDR_" "_TEXT
"RTN","IBDF18E",65,0)
 .S HEADER=$P(NODE,"^",9)
"RTN","IBDF18E",66,0)
 .S FID=$P(NODE,"^",6) I FID="" S FID=$P(NODE,"^") ;PANDAS uses piece 1 to number each bubble - does not use piece 6
"RTN","IBDF18E",67,0)
 .S ITEM=$P(NODE,"^",12)
"RTN","IBDF18E",68,0)
 .S QLFR=$P(NODE,"^",10)
"RTN","IBDF18E",69,0)
 .S QUANTITY=$P(NODE,"^",13)
"RTN","IBDF18E",70,0)
 .S SLCTN=$P(NODE,"^",14) ;--added for modifiers, pointer to file 357.3
"RTN","IBDF18E",71,0)
 .;
"RTN","IBDF18E",72,0)
 .; -- if text contains 'x #' for quantity, strip it
"RTN","IBDF18E",73,0)
 .;I +QUANTITY I TEXT[(" x "_QUANTITY) S TEXT=$TR(TEXT," x "_QUANTITY)
"RTN","IBDF18E",74,0)
 .I +QUANTITY I TEXT[(" x "_QUANTITY) D
"RTN","IBDF18E",75,0)
 ..S X=" x "_QUANTITY
"RTN","IBDF18E",76,0)
 ..S TEXT=$E(TEXT,1,$F(TEXT,X)-($L(X)+1))_$E(TEXT,$F(TEXT,X),$L(TEXT))
"RTN","IBDF18E",77,0)
 .;
"RTN","IBDF18E",78,0)
 .S TYPE="",(LEX,NARR)=0
"RTN","IBDF18E",79,0)
 .I $D(^IBD(357.95,FORMTYPE,1,BUB,2)) S LEX=$P($G(^IBD(357.95,FORMTYPE,1,BUB,2)),"^",2)
"RTN","IBDF18E",80,0)
 .D SETTEMP^IBDF18E1
"RTN","IBDF18E",81,0)
 .D CODES^IBDF18E0
"RTN","IBDF18E",82,0)
 K BUBBLES
"RTN","IBDF18E",83,0)
 ;
"RTN","IBDF18E",84,0)
 ;now for each bubble in DYNAMIC() add to TEMP()
"RTN","IBDF18E",85,0)
 S FID="" F  S FID=$O(DYNAMIC(FID)) Q:FID=""  S COUNT="" F  S COUNT=$O(DYNAMIC(FID,COUNT)) Q:COUNT=""  S BUB=$O(^IBD(357.96,FORMID,"AC",FID,+COUNT,0)) S:BUB NODE=$G(^IBD(357.96,FORMID,1,BUB,0)) D
"RTN","IBDF18E",86,0)
 .I 'BUB!(NODE="") D LOGERR^IBDF18E2(3579602,.FORMID,FID,DYNAMIC(FID,COUNT)) Q
"RTN","IBDF18E",87,0)
 .S VALUE=$P(NODE,"^",4)
"RTN","IBDF18E",88,0)
 .S PI=$P(NODE,"^",3)
"RTN","IBDF18E",89,0)
 .S TEXT=$P(NODE,"^",8)
"RTN","IBDF18E",90,0)
 .; -- strip :: code from TEXT if it exists
"RTN","IBDF18E",91,0)
 .I TEXT[" :: " S TEXT=$$DISP^IBDFM1(TEXT)
"RTN","IBDF18E",92,0)
 .;I TEXT[" :: " S TEXT=$P(TEXT," :: ")
"RTN","IBDF18E",93,0)
 .S HEADER=""
"RTN","IBDF18E",94,0)
 .S FID=$P(NODE,"^",6)
"RTN","IBDF18E",95,0)
 .S ITEM=$P(NODE,"^")
"RTN","IBDF18E",96,0)
 .S QLFR=$P(NODE,"^",10)
"RTN","IBDF18E",97,0)
 .S TYPE=""
"RTN","IBDF18E",98,0)
 .S LEX=0
"RTN","IBDF18E",99,0)
 .S SLCTN=$P(NODE,"^",14) ;--added for modifiers, pointer fo file 357.3
"RTN","IBDF18E",100,0)
 .D SETTEMP^IBDF18E1
"RTN","IBDF18E",101,0)
 K DYNAMIC
"RTN","IBDF18E",102,0)
 ;
"RTN","IBDF18E",103,0)
 ;now for each hand print field in HANDPRNT() add to TEMP()
"RTN","IBDF18E",104,0)
 ;
"RTN","IBDF18E",105,0)
 S HAND=0 F  S HAND=$O(HANDPRNT(HAND)) Q:HAND=""  S:HAND NODE=$G(^IBD(357.95,FORMTYPE,2,HAND,0)) D
"RTN","IBDF18E",106,0)
 .I 'HAND!(NODE="") D LOGERR^IBDF18E2(3579503,.FORMID,HAND,HANDPRNT(HAND)) Q
"RTN","IBDF18E",107,0)
 .S TYPE=$P(NODE,"^",17)
"RTN","IBDF18E",108,0)
 .S VALUE=HANDPRNT(HAND) S:$E(VALUE,$L(VALUE))="," VALUE=$E(VALUE,1,$L(VALUE)-1)
"RTN","IBDF18E",109,0)
 .;
"RTN","IBDF18E",110,0)
 .;what was printed may need transformation/formating
"RTN","IBDF18E",111,0)
 .S VALUE1=VALUE,VALUE=$$HPTRNS^IBDFU91(TYPE,VALUE,.FORMID)
"RTN","IBDF18E",112,0)
 .;
"RTN","IBDF18E",113,0)
 .; -- failed the input transform
"RTN","IBDF18E",114,0)
 .I VALUE="" D LOGERR^IBDF18E2(3579504,.FORMID,HAND,VALUE1,"","",TYPE) Q
"RTN","IBDF18E",115,0)
 .;
"RTN","IBDF18E",116,0)
 .S PI=$P(NODE,"^",4)
"RTN","IBDF18E",117,0)
 .S TEXT=$P(NODE,"^",7)
"RTN","IBDF18E",118,0)
 .S HEADER=$P(NODE,"^",9)
"RTN","IBDF18E",119,0)
 .S FID=$P(NODE,"^",8)
"RTN","IBDF18E",120,0)
 .S ITEM=$P(NODE,"^",12)
"RTN","IBDF18E",121,0)
 .S QLFR=$P(NODE,"^",10)
"RTN","IBDF18E",122,0)
 .S (LEX,NARR)=0
"RTN","IBDF18E",123,0)
 .S SLCTN=$P(NODE,"^",14) ;--added for modifiers, pointer to file 357.3
"RTN","IBDF18E",124,0)
 .I $P($G(^IBE(357.2,+$E(FID,2,$L(FID)),0)),U,18)=3 S NARR=1 ;Send both code and narrative
"RTN","IBDF18E",125,0)
 .D SETTEMP^IBDF18E1
"RTN","IBDF18E",126,0)
 K HANDPRNT
"RTN","IBDF18E",127,0)
 ;
"RTN","IBDF18E",128,0)
 ; --added to copy visit modifiers if any
"RTN","IBDF18E",129,0)
 ;
"RTN","IBDF18E",130,0)
 D:$D(TEMP("ENCOUNTER")) VSTPXCA^IBDF18E0
"RTN","IBDF18E",131,0)
 ;
"RTN","IBDF18E",132,0)
 D SETPXCA^IBDF18E0,PRO^IBDF18E0,SC^IBDF18E0
"RTN","IBDF18E",133,0)
 ;
"RTN","IBDF18E",134,0)
 I $D(PXCA("IBD-ABORT")) D  S PXCASTAT=0 G SENDQ
"RTN","IBDF18E",135,0)
 .S I="" F  S I=$O(PXCA("IBD-ABORT",I)) Q:I=""  S J="" F  S J=$O(PXCA("IBD-ABORT",I,J)) Q:J=""  D
"RTN","IBDF18E",136,0)
 ..I +PXCA("IBD-ABORT",I,J)=3 K PXCA("IBD-ABORT",I,J) Q
"RTN","IBDF18E",137,0)
 ..D LOGERR^IBDF18E2(3570004,.FORMID,"",$P(PXCA("IBD-ABORT",I,J),"^",2))
"RTN","IBDF18E",138,0)
 ;
"RTN","IBDF18E",139,0)
 I +FORMID("SOURCE")=1 D QUE^IBDF18E3 G STAT
"RTN","IBDF18E",140,0)
 ;
"RTN","IBDF18E",141,0)
 S IBD("AICS")=1 ;flag for IBDF PCE EVENT protocol
"RTN","IBDF18E",142,0)
 S IBD("PASSFLAG")=+$P($G(^IBD(357.09,1,0)),"^",7)
"RTN","IBDF18E",143,0)
 I $G(IBD("PASSFLAG"))<2 D VALIDATE^PXCA(.PXCA) I '$D(PXCA("ERROR")) D BACKGND^PXCA(.PXCA,.PXCASTAT)
"RTN","IBDF18E",144,0)
 I $G(IBD("PASSFLAG"))>1 D FOREGND^PXCA(.PXCA,.PXCASTAT)
"RTN","IBDF18E",145,0)
 K IBD("AICS"),IBD("PASSFLAG")
"RTN","IBDF18E",146,0)
 ;
"RTN","IBDF18E",147,0)
STAT S STATUS=$$FSCND^IBDF18C(FORMID,$S(PXCASTAT=0:4,PXCASTAT=1:3,1:12),$S(PXCASTAT=0:"PCE RETURNED AN ERROR",1:""))
"RTN","IBDF18E",148,0)
 ;
"RTN","IBDF18E",149,0)
 ; -- kill erroneous inpatient warnings
"RTN","IBDF18E",150,0)
 I $D(PXCA("WARNING","ENCOUNTER"))>0 D INPT^IBDF18E0($G(FORMID("DFN")),$G(FORMID("APPT")))
"RTN","IBDF18E",151,0)
 ;
"RTN","IBDF18E",152,0)
 ; -- log pce errors and warnings in AICS Error file
"RTN","IBDF18E",153,0)
 I $O(PXCA("ERROR",""))'=""!($O(PXCA("WARNING",""))'="") S FORMID("SOURCE")=99 D LOGERR^IBDF18E2(3570001,.FORMID)
"RTN","IBDF18E",154,0)
 ;
"RTN","IBDF18E",155,0)
 ; -- if pce returns an error unflag all pages as received and delete
"RTN","IBDF18E",156,0)
 ;    all scanned data so data can be re-scanned
"RTN","IBDF18E",157,0)
SENDQ I $O(PXCA("ERROR",""))'=""!($O(PXCA("IBD-ABORT",""))'="") D UNRECV^IBDFBK2(FORMID)
"RTN","IBDF18E",158,0)
 Q +$G(PXCASTAT)
"RTN","IBDF18E0")
0^4^B37891162
"RTN","IBDF18E0",1,0)
IBDF18E0 ;ALB/CJM - ENCOUNTER FORM - PCE DEVICE INTERFACE utilities ;04-OCT-94
"RTN","IBDF18E0",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**11,25,38**;APR 24, 1997
"RTN","IBDF18E0",3,0)
 ;
"RTN","IBDF18E0",4,0)
SETPXCA ;set values from TEMP() into the PXCA()
"RTN","IBDF18E0",5,0)
 ;
"RTN","IBDF18E0",6,0)
 N NODE,NUMBER,IBQUIT,Y,Y1,X
"RTN","IBDF18E0",7,0)
 S PROVIDER=+$P(PXCA("ENCOUNTER"),"^",4)
"RTN","IBDF18E0",8,0)
 I PROVIDER,"^P^S^"'[("^"_$P(PXCA("ENCOUNTER"),"^",15)_"^") S $P(PXCA("ENCOUNTER"),"^",15)="S" D LOGERR^IBDF18E2(3579603,.FORMID,"",PROVIDER)
"RTN","IBDF18E0",9,0)
 ;
"RTN","IBDF18E0",10,0)
 S NODE="" F  S NODE=$O(TEMP(NODE)) Q:NODE=""  S NUMBER=0,FID="" F  S FID=$O(TEMP(NODE,FID)) Q:FID=""  S ITEM="" F  S ITEM=$O(TEMP(NODE,FID,ITEM)) Q:ITEM=""  D
"RTN","IBDF18E0",11,0)
 .S IBQUIT=0
"RTN","IBDF18E0",12,0)
 .I NODE="PROCEDURE" S X=TEMP(NODE,FID,ITEM) D
"RTN","IBDF18E0",13,0)
 ..I $P(X,"^",2)="" S $P(X,"^",2)=1
"RTN","IBDF18E0",14,0)
 ..S Y=0 F  S Y=$O(PXCA(NODE,PROVIDER,Y)) Q:'Y!(IBQUIT)  D
"RTN","IBDF18E0",15,0)
 ...S Y1=$G(PXCA(NODE,PROVIDER,Y))
"RTN","IBDF18E0",16,0)
 ...I $P(X,"^")=$P(Y1,"^"),$P(X,"^",3,7)=$P(Y1,"^",3,7) S $P(PXCA(NODE,PROVIDER,Y),"^",2)=$P(PXCA(NODE,PROVIDER,Y),"^",2)+$P(X,"^",2),IBQUIT=1
"RTN","IBDF18E0",17,0)
 ..Q:IBQUIT
"RTN","IBDF18E0",18,0)
 ..S TEMP(NODE,FID,ITEM)=X
"RTN","IBDF18E0",19,0)
 .I IBQUIT K TEMP(NODE,FID,ITEM) Q
"RTN","IBDF18E0",20,0)
 .S NUMBER=NUMBER+1
"RTN","IBDF18E0",21,0)
 .S PXCA(NODE,PROVIDER,NUMBER)=TEMP(NODE,FID,ITEM)
"RTN","IBDF18E0",22,0)
 .I $D(TEMP(NODE,FID,ITEM,"MODIFIER")) D MODPXCA
"RTN","IBDF18E0",23,0)
 .K TEMP(NODE,FID,ITEM)
"RTN","IBDF18E0",24,0)
 ;
"RTN","IBDF18E0",25,0)
 ; -- default c/o date time to now if not passed
"RTN","IBDF18E0",26,0)
 I '$P($G(^IBD(357.09,1,1)),"^",2) D  ;cont only if s/p not answerred
"RTN","IBDF18E0",27,0)
 .I $D(PXCA("ENCOUNTER")) I $P(PXCA("ENCOUNTER"),"^",14)="" D  ;quit if we are already passing c/o date/time
"RTN","IBDF18E0",28,0)
 ..N SDOE S SDOE=$$FNDSDOE^IBDFDE($S(+$G(FORMID("DFN")):+$G(FORMID("DFN")),+$G(IBDF("DFN")):+$G(IBDF("DFN")),1:$G(DFN)),$S(+$G(FORMID("APPT")):+$G(FORMID("APPT")),+$G(IBDF("APPT")):+$G(IBDF("APPT")),1:$G(APPT)))
"RTN","IBDF18E0",29,0)
 ..Q:$$COMDT^SDCOU(+SDOE)  ;c/o already performed, don't overwrite
"RTN","IBDF18E0",30,0)
 ..N IBDDFN,IBDAPPT,IBDCLN,IBDCOST
"RTN","IBDF18E0",31,0)
 ..S IBDDFN=$S(+$G(FORMID("DFN")):+$G(FORMID("DFN")),+$G(IBDF("DFN")):+$G(IBDF("DFN")),1:$G(DFN))
"RTN","IBDF18E0",32,0)
 ..S IBDAPPT=$S(+$G(FORMID("APPT")):+$G(FORMID("APPT")),+$G(IBDF("APPT")):+$G(IBDF("APPT")),1:$G(APPT))
"RTN","IBDF18E0",33,0)
 ..S IBDCLN=$S(+$G(FORMID("CLINIC")):+$G(FORMID("CLINIC")),+$G(IBDF("CLINIC")):+$G(IBDF("CLINIC")),1:$G(CLN))
"RTN","IBDF18E0",34,0)
 ..S IBDCOST=$$STATUS^SDAM1(IBDDFN,IBDAPPT,IBDCLN,$G(^DPT(IBDDFN,0))) Q:$P(IBDCOST,";",5)
"RTN","IBDF18E0",35,0)
 ..S $P(PXCA("ENCOUNTER"),"^",14)=$E($$HTFM^XLFDT($H),1,12)
"RTN","IBDF18E0",36,0)
 ;
"RTN","IBDF18E0",37,0)
 D OTHRBUB
"RTN","IBDF18E0",38,0)
 Q
"RTN","IBDF18E0",39,0)
 ;
"RTN","IBDF18E0",40,0)
 ;
"RTN","IBDF18E0",41,0)
OTHRBUB ; -- check procedure and diagnosis node for other bubble, but no data
"RTN","IBDF18E0",42,0)
 N NODE,CODE
"RTN","IBDF18E0",43,0)
 S I=0 F  S I=$O(PXCA("PROCEDURE",I)) Q:I=""  S J=0 F  S J=$O(PXCA("PROCEDURE",I,J)) Q:J=""  D
"RTN","IBDF18E0",44,0)
 .I +$G(PXCA("PROCEDURE",I,J))<1 D  ;no code, may be treatment
"RTN","IBDF18E0",45,0)
 ..I $P($G(PXCA("PROCEDURE",I,J)),"^",6)["OTHER#" D  ;no code, narr=other
"RTN","IBDF18E0",46,0)
 ...D LOGERR^IBDF18E2(3579612,.FORMID)
"RTN","IBDF18E0",47,0)
 ...K PXCA("PROCEDURE",I,J)
"RTN","IBDF18E0",48,0)
 .I +$G(PXCA("PROCEDURE",I,J)),$P($G(PXCA("PROCEDURE",I,J)),"^",6)["OTHER#" D
"RTN","IBDF18E0",49,0)
 ..;; --change to api cpt ; dhh
"RTN","IBDF18E0",50,0)
 ..S CODE=$$CPT^ICPTCOD(CODE)
"RTN","IBDF18E0",51,0)
 ..S $P(PXCA("PROCEDURE",I,J),"^",6)=$S(+CODE'=-1:$E($P((CODE),"^",3),1,80),1:"")
"RTN","IBDF18E0",52,0)
 ;
"RTN","IBDF18E0",53,0)
 S I=0 F  S I=$O(PXCA("DIAGNOSIS/PROBLEM",I)) Q:I=""  S J=0 F  S J=$O(PXCA("DIAGNOSIS/PROBLEM",I,J)) Q:J=""  D
"RTN","IBDF18E0",54,0)
 .I $P($G(PXCA("DIAGNOSIS/PROBLEM",I,J)),"^",13)="" D
"RTN","IBDF18E0",55,0)
 ..S $P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",13)=$E($G(^ICD9(+PXCA("DIAGNOSIS/PROBLEM",I,J),1)),1,79)
"RTN","IBDF18E0",56,0)
 .I $P($G(PXCA("DIAGNOSIS/PROBLEM",I,J)),"^",13)["OTHER#" D
"RTN","IBDF18E0",57,0)
 ..S $P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",13)=$E($G(^ICD9(+PXCA("DIAGNOSIS/PROBLEM",I,J),1)),1,79)
"RTN","IBDF18E0",58,0)
 Q
"RTN","IBDF18E0",59,0)
 ;
"RTN","IBDF18E0",60,0)
PRO ; -- make sure diagnosis code is added to DIAGNOSIS/PROBLEM node
"RTN","IBDF18E0",61,0)
 S I=0 F  S I=$O(PXCA("DIAGNOSIS/PROBLEM",I)) Q:I=""  S J=0 F  S J=$O(PXCA("DIAGNOSIS/PROBLEM",I,J)) Q:J=""  D
"RTN","IBDF18E0",62,0)
 .I $TR($P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",5,8),"^","")']"",($P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",2)="") S $P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",2)="S" D
"RTN","IBDF18E0",63,0)
 ..D LOGERR^IBDF18E2(3579505,.FORMID,"",+PXCA("DIAGNOSIS/PROBLEM",I,J),"","","",$P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",13))
"RTN","IBDF18E0",64,0)
 .Q:+$P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^")
"RTN","IBDF18E0",65,0)
 .I +$P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",3) D
"RTN","IBDF18E0",66,0)
 ..S IBX=$P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",3) D
"RTN","IBDF18E0",67,0)
 ...I $D(^LEX)>1 S X="LEXU" X ^%ZOSF("TEST") I $T S IBX=$$ICDONE^LEXU(IBX) S:$L(IBX)<1 IBX=799.9 Q  ; clinical lexicon next version to be in ^LEX
"RTN","IBDF18E0",68,0)
 ...S X="GMPTU" X ^%ZOSF("TEST") I $T S IBX=$$ICDONE^GMPTU(IBX) S:$L(IBX)<1 IBX=799.9 Q
"RTN","IBDF18E0",69,0)
 ...S IBX=799.9
"RTN","IBDF18E0",70,0)
 ...Q
"RTN","IBDF18E0",71,0)
 ..S IBXI=+$O(^ICD9("BA",IBX_" ",0)) I +IBXI<1 S IBXI=+$O(^ICD9("BA",799.9_" ",0))
"RTN","IBDF18E0",72,0)
 ..I +IBXI<1 D LOGERR^IBDF18E2(3579506,.FORMID,"",$P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",3),"","","",$P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",13)) Q
"RTN","IBDF18E0",73,0)
 ..S $P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^")=IBXI
"RTN","IBDF18E0",74,0)
 ..Q
"RTN","IBDF18E0",75,0)
 .;
"RTN","IBDF18E0",76,0)
 .; -- set diagnosis code from problem list into piece 1 of array
"RTN","IBDF18E0",77,0)
 .I +$P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",4) S $P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^")=$$PROBDIA^IBDFBK3(+$P(PXCA("DIAGNOSIS/PROBLEM",I,J),"^",4))
"RTN","IBDF18E0",78,0)
 Q
"RTN","IBDF18E0",79,0)
 ;
"RTN","IBDF18E0",80,0)
CODES ; -- if addt'l codes to pass and qual is prim or sec, send 2nd code
"RTN","IBDF18E0",81,0)
 N VALUE,IBI
"RTN","IBDF18E0",82,0)
 Q:$G(QLFR)']""
"RTN","IBDF18E0",83,0)
 Q:"PRIMARYSECONDARY"'[$P($G(^IBD(357.98,QLFR,0)),"^")
"RTN","IBDF18E0",84,0)
 F IBI=3,4 S VALUE=$P($G(^IBD(357.95,FORMTYPE,1,BUB,2)),"^",IBI) Q:'$G(VALUE)  D
"RTN","IBDF18E0",85,0)
 .N QLFR S QLFR=$O(^IBD(357.98,"B","SECONDARY",0)),ITEM=ITEM_"."_IBI
"RTN","IBDF18E0",86,0)
 .D SETTEMP^IBDF18E1
"RTN","IBDF18E0",87,0)
 .S ITEM=$P(ITEM,".")
"RTN","IBDF18E0",88,0)
 Q
"RTN","IBDF18E0",89,0)
 ;
"RTN","IBDF18E0",90,0)
TRACKING(FORMID) ;get form tracking info,sets FORMID array, which should be passed by reference, return 0 if not found
"RTN","IBDF18E0",91,0)
 ;
"RTN","IBDF18E0",92,0)
 S NODE=$G(^IBD(357.96,FORMID,0))
"RTN","IBDF18E0",93,0)
 Q:NODE="" 0
"RTN","IBDF18E0",94,0)
 S FORMID("APPT")=$P(NODE,"^",3),FORMID("CLINIC")=$P(NODE,"^",10),FORMID("DFN")=$P(NODE,"^",2),FORMID("SOURCE")=$P(NODE,"^",7)
"RTN","IBDF18E0",95,0)
 Q 1
"RTN","IBDF18E0",96,0)
 ;
"RTN","IBDF18E0",97,0)
SC ; -- if SC answered yes then all other classifications = null
"RTN","IBDF18E0",98,0)
 I $P(PXCA("ENCOUNTER"),"^",6) S $P(PXCA("ENCOUNTER"),"^",7,9)="^^"
"RTN","IBDF18E0",99,0)
 Q
"RTN","IBDF18E0",100,0)
 ;
"RTN","IBDF18E0",101,0)
INPT(DFN,APPT) ; -- determine inpatient status
"RTN","IBDF18E0",102,0)
 N INPT
"RTN","IBDF18E0",103,0)
 S INPT=$P($G(^DPT(+$G(DFN),"S",+$G(APPT),0)),"^",2)="I"
"RTN","IBDF18E0",104,0)
 Q:'INPT
"RTN","IBDF18E0",105,0)
 ;
"RTN","IBDF18E0",106,0)
 ; -- kill erroneous warnings for inpatients
"RTN","IBDF18E0",107,0)
 I $G(PXCA("WARNING","ENCOUNTER",0,0,6))["SC flag is missing" K PXCA("WARNING","ENCOUNTER",0,0,6)
"RTN","IBDF18E0",108,0)
 I $G(PXCA("WARNING","ENCOUNTER",0,0,7))["AO flag is missing" K PXCA("WARNING","ENCOUNTER",0,0,7)
"RTN","IBDF18E0",109,0)
 I $G(PXCA("WARNING","ENCOUNTER",0,0,8))["IR flag is missing" K PXCA("WARNING","ENCOUNTER",0,0,8)
"RTN","IBDF18E0",110,0)
 I $G(PXCA("WARNING","ENCOUNTER",0,0,9))["EC flag is missing" K PXCA("WARNING","ENCOUNTER",0,0,9)
"RTN","IBDF18E0",111,0)
 Q
"RTN","IBDF18E0",112,0)
MODPXCA ; -- copy CPT Modifier information from TEMP to PXCA
"RTN","IBDF18E0",113,0)
 ;
"RTN","IBDF18E0",114,0)
 N MOD,MODX,MODNODE,CODE
"RTN","IBDF18E0",115,0)
 S CODE=$P($G(TEMP(NODE,FID,ITEM)),"^")
"RTN","IBDF18E0",116,0)
 S MOD=0 F  S MOD=$O(TEMP(NODE,FID,ITEM,"MODIFIER",MOD)) Q:MOD']""  D
"RTN","IBDF18E0",117,0)
 . S MODX=TEMP(NODE,FID,ITEM,"MODIFIER",MOD)
"RTN","IBDF18E0",118,0)
 . S MODNODE=$$MODP^ICPTMOD(CODE,MODX)
"RTN","IBDF18E0",119,0)
 . S:+MODNODE>0 PXCA(NODE,PROVIDER,NUMBER,MODX)=$$MOD^ICPTMOD(+MODNODE,"I")
"RTN","IBDF18E0",120,0)
 Q
"RTN","IBDF18E0",121,0)
VSTPXCA ; -- copy CPT Modifier information from TEMP to PXCA for Visit
"RTN","IBDF18E0",122,0)
 ;
"RTN","IBDF18E0",123,0)
 N I,J,MOD,MODX
"RTN","IBDF18E0",124,0)
 S I=0 F  S I=$O(TEMP("ENCOUNTER",I)) Q:I']""  D
"RTN","IBDF18E0",125,0)
 . S J=0 F  S J=$O(TEMP("ENCOUNTER",I,J)) Q:'J  D
"RTN","IBDF18E0",126,0)
 .. S MOD=0 F  S MOD=$O(TEMP("ENCOUNTER",I,J,"MODIFIER",MOD)) Q:MOD']""  D
"RTN","IBDF18E0",127,0)
 ... S MODX=TEMP("ENCOUNTER",I,J,"MODIFIER",MOD)
"RTN","IBDF18E0",128,0)
 ... S PXCA("ENCOUNTER","MODIFIER",MODX)=""
"RTN","IBDF18E0",129,0)
 K TEMP("ENCOUNTER")
"RTN","IBDF18E0",130,0)
 Q
"RTN","IBDF18E1")
0^5^B47079647
"RTN","IBDF18E1",1,0)
IBDF18E1 ;ALB/CJM - ENCOUNTER FORM - PCE DEVICE INTERFACE utilities ;04-OCT-94
"RTN","IBDF18E1",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**1,3,38**;APR 24, 1997
"RTN","IBDF18E1",3,0)
 ;
"RTN","IBDF18E1",4,0)
GETPI(PI,QLFR,TYPE) ; -- returns information about the package interface 
"RTN","IBDF18E1",5,0)
 ;                    needed to map data to PCE DEVICE INTERFACE
"RTN","IBDF18E1",6,0)
 ;
"RTN","IBDF18E1",7,0)
 ; -- input - PI := pointer to the package interface file
"RTN","IBDF18E1",8,0)
 ;                  MUST be passed by reference
"RTN","IBDF18E1",9,0)
 ;          QLFR := pointer to the data qualifier
"RTN","IBDF18E1",10,0)
 ;          TYPE := pointer to file 359.1, applies to hand print fields
"RTN","IBDF18E1",11,0)
 ;
"RTN","IBDF18E1",12,0)
 ; -- output  PI :="" if the mapping can not be determined
"RTN","IBDF18E1",13,0)
 ;            PI(PI,"NODE")
"RTN","IBDF18E1",14,0)
 ;            PI(PI,"VAL")
"RTN","IBDF18E1",15,0)
 ;            PI(PI,"TXT")
"RTN","IBDF18E1",16,0)
 ;            PI(PI,"HDR")
"RTN","IBDF18E1",17,0)
 ;            PI(PI,"QLFR")
"RTN","IBDF18E1",18,0)
 ;            PI(PI,"QTY")
"RTN","IBDF18E1",19,0)
 ;      - if QLFR is passed, also returns PI(PI,QLFR,"IND")
"RTN","IBDF18E1",20,0)
 ;      - if PI(PI,QLFR,"IND")=1,meaning there is independent mapping
"RTN","IBDF18E1",21,0)
 ;        info for this qualifier - then also returns PI(PI,QLFR,"NODE")=
"RTN","IBDF18E1",22,0)
 ;        <the node>,PI(PI,QLFR,"VAL")=<piece for the value>,
"RTN","IBDF18E1",23,0)
 ;        PI(PI,QLFR,"TXT")=<the piece for txt>,PI(PI,QLFR,"HDR")=
"RTN","IBDF18E1",24,0)
 ;        <piece for the hdr>,
"RTN","IBDF18E1",25,0)
 ;        PI(PI,QLFR,"QLFR")=<piece for the qualifier code>
"RTN","IBDF18E1",26,0)
 ;      - if TYPE is passed , also returns PI(PI,"TYPE",TYPE,"UNIT")=
"RTN","IBDF18E1",27,0)
 ;        <unit code> and PI(PI,"TYPE",TYPE,"VTYPE")=
"RTN","IBDF18E1",28,0)
 ;        <vitals type code>
"RTN","IBDF18E1",29,0)
 ;
"RTN","IBDF18E1",30,0)
 ;NOTE - it is assumed that entries in the PI() may be left hanging around,and if so they are valid
"RTN","IBDF18E1",31,0)
 ;
"RTN","IBDF18E1",32,0)
 N NODE,QNODE,PIECE,IEN
"RTN","IBDF18E1",33,0)
 I '$G(PI) S PI="" G GETPIQ
"RTN","IBDF18E1",34,0)
 ;
"RTN","IBDF18E1",35,0)
 ; -- type of package interface must be for input
"RTN","IBDF18E1",36,0)
 I $P($G(^IBE(357.6,PI,0)),"^",6)'=1 S PI="" G GETPIQ
"RTN","IBDF18E1",37,0)
 ;
"RTN","IBDF18E1",38,0)
 I '$D(PI(PI)) D  Q:'PI ""
"RTN","IBDF18E1",39,0)
 .S NODE=$G(^IBE(357.6,PI,12))
"RTN","IBDF18E1",40,0)
 .S PI(PI,"NODE")=$P(NODE,"^")
"RTN","IBDF18E1",41,0)
 .S PI(PI,"VAL")=$P(NODE,"^",2)
"RTN","IBDF18E1",42,0)
 .S PI(PI,"TXT")=$P(NODE,"^",3)
"RTN","IBDF18E1",43,0)
 .S PI(PI,"HDR")=$P(NODE,"^",4)
"RTN","IBDF18E1",44,0)
 .S PI(PI,"QLFR")=$P(NODE,"^",5)
"RTN","IBDF18E1",45,0)
 .S PI(PI,"QTY")=$P(NODE,"^",6)
"RTN","IBDF18E1",46,0)
 ;
"RTN","IBDF18E1",47,0)
 ; - if there is a 'PCE DIM PIECE, VARIABLE VALUE' node, execute code to
"RTN","IBDF18E1",48,0)
 ; - determine value for PCE DIM PIECE, VALUE (since it is variable, it
"RTN","IBDF18E1",49,0)
 ; - must be asked outside of the above dotted do
"RTN","IBDF18E1",50,0)
 S X="",Y=VALUE X $G(^IBE(357.6,PI,21)) I X S PI(PI,"VAL")=X
"RTN","IBDF18E1",51,0)
 ;
"RTN","IBDF18E1",52,0)
 ;special rules apply for the VITALS node
"RTN","IBDF18E1",53,0)
 I PI(PI,"NODE")="VITALS" D  Q:'PI ""
"RTN","IBDF18E1",54,0)
 .S PI(PI,"VAL")=2 ;the value for the VITALS node goes to piece 2
"RTN","IBDF18E1",55,0)
 .;
"RTN","IBDF18E1",56,0)
 .I 'TYPE D LOGERR^IBDF18E2(35791001,.FORMID,TYPE,$G(VALUE),PI) S PI(PI,"TYPE",+$G(TYPE),"VTYPE")="",PI(PI,"TYPE",+$G(TYPE),"UNIT")="" Q
"RTN","IBDF18E1",57,0)
 .;
"RTN","IBDF18E1",58,0)
 .;may have already gotten
"RTN","IBDF18E1",59,0)
 .I $D(PI(PI,"TYPE",TYPE)) Q
"RTN","IBDF18E1",60,0)
 .;
"RTN","IBDF18E1",61,0)
 .S IEN=$O(^IBE(357.6,PI,13,"B",TYPE_";IBE(359.1,",""))
"RTN","IBDF18E1",62,0)
 .I 'IEN D LOGERR^IBDF18E2(3576001,.FORMID,TYPE,$G(VALUE),PI) S PI(PI,"TYPE",TYPE,"VTYPE")="",PI(PI,"TYPE",TYPE,"UNIT")="" Q
"RTN","IBDF18E1",63,0)
 .S NODE=$G(^IBE(359.1,TYPE,0))
"RTN","IBDF18E1",64,0)
 .S PI(PI,"TYPE",TYPE,"UNIT")=$P(NODE,"^",13)
"RTN","IBDF18E1",65,0)
 .S PI(PI,"TYPE",TYPE,"VTYPE")=$P(NODE,"^",12)
"RTN","IBDF18E1",66,0)
 .S PI(PI,"TYPE",TYPE,"DATATYPE")=$P($G(^IBE(359.1,TYPE,10)),"^",1)
"RTN","IBDF18E1",67,0)
 ;
"RTN","IBDF18E1",68,0)
 ;if not VITALS, and there is a QLFR, get independent mapping info if not gotten previously
"RTN","IBDF18E1",69,0)
 I PI(PI,"NODE")'="VITALS",QLFR I '$D(PI(PI,QLFR,"IND")) D  Q:'PI ""
"RTN","IBDF18E1",70,0)
 .S PI(PI,QLFR,"CODE")=$P($G(^IBD(357.98,QLFR,0)),"^",2)
"RTN","IBDF18E1",71,0)
 .S IEN=$O(^IBE(357.6,PI,13,"B",QLFR_";IBD(357.98,",""))
"RTN","IBDF18E1",72,0)
 .I 'IEN D LOGERR^IBDF18E2(3576002,.FORMID,$G(TYPE),$G(VALUE),PI,$G(QLFR)) S PI(PI,QLFR,"IND")=0 Q
"RTN","IBDF18E1",73,0)
 .S NODE=$G(^IBE(357.6,PI,13,IEN,0))
"RTN","IBDF18E1",74,0)
 .S PI(PI,QLFR,"IND")=$P(NODE,"^",3)
"RTN","IBDF18E1",75,0)
 .Q:'PI(PI,QLFR,"IND")
"RTN","IBDF18E1",76,0)
 .S QNODE=$P(NODE,"^",4) S:QNODE="" QNODE=PI(PI,"NODE") S PI(PI,QLFR,"NODE")=QNODE
"RTN","IBDF18E1",77,0)
 .S PIECE=$P(NODE,"^",8) S:('PIECE)&(PI(PI,"NODE")=PI(PI,QLFR,"NODE")) PIECE=PI(PI,"QLFR") S PI(PI,QLFR,"QLFR")=PIECE
"RTN","IBDF18E1",78,0)
 .;
"RTN","IBDF18E1",79,0)
 .;if the node isn't different for the qualifier then the value,text,and header can not be mapped independently
"RTN","IBDF18E1",80,0)
 .I PI(PI,"NODE")=PI(PI,QLFR,"NODE") D
"RTN","IBDF18E1",81,0)
 ..S PI(PI,QLFR,"VAL")=PI(PI,"VAL"),PI(PI,QLFR,"TXT")=PI(PI,"TXT"),PI(PI,QLFR,"HDR")=PI(PI,"HDR")
"RTN","IBDF18E1",82,0)
 .E  S PI(PI,QLFR,"VAL")=$P(NODE,"^",5),PI(PI,QLFR,"TXT")=$P(NODE,"^",6),PI(PI,QLFR,"HDR")=$P(NODE,"^",7)
"RTN","IBDF18E1",83,0)
 .;must at least know the piece to place the returned value
"RTN","IBDF18E1",84,0)
 .I (PI(PI,QLFR,"NODE")="")!('PI(PI,QLFR,"VAL")) S PI=""
"RTN","IBDF18E1",85,0)
 ;
"RTN","IBDF18E1",86,0)
 ;must at least know the node and the piece to place the returned value
"RTN","IBDF18E1",87,0)
 I 'QLFR I (PI(PI,"NODE")="")!('PI(PI,"VAL")) S PI=""
"RTN","IBDF18E1",88,0)
GETPIQ Q PI
"RTN","IBDF18E1",89,0)
 ;
"RTN","IBDF18E1",90,0)
SETTEMP ; -- sets values for the field into TEMP()
"RTN","IBDF18E1",91,0)
 ;    values are merged for fields that consist of a collection
"RTN","IBDF18E1",92,0)
 ;
"RTN","IBDF18E1",93,0)
 ; -- Output   QCODE := <qualifier code>
"RTN","IBDF18E1",94,0)
 ;              PHDR := <header piece>
"RTN","IBDF18E1",95,0)
 ;              PVAL := <value piece>
"RTN","IBDF18E1",96,0)
 ;              PTXT := <text piece>
"RTN","IBDF18E1",97,0)
 ;             PQLFR := <qualifier piece>
"RTN","IBDF18E1",98,0)
 ;               SUB := <PCE GDI node>
"RTN","IBDF18E1",99,0)
 ;              NODE := <the value of the node>
"RTN","IBDF18E1",100,0)
 ;              PLEX := <clinical lexicon piece, for use with diag.>
"RTN","IBDF18E1",101,0)
 ;
"RTN","IBDF18E1",102,0)
 N QCODE,PHDR,PVAL,PTXT,PQLFR,SUB,NODE,PLEX,PQTY,SAVEPI
"RTN","IBDF18E1",103,0)
 S SAVEPI=PI
"RTN","IBDF18E1",104,0)
 Q:'PI
"RTN","IBDF18E1",105,0)
 S PI=$$GETPI(.PI,QLFR,TYPE) I 'PI D LOGERR^IBDF18E2(3576003,.FORMID,$G(TYPE),$G(VALUE),SAVEPI,$G(QLFR)) Q
"RTN","IBDF18E1",106,0)
 ;
"RTN","IBDF18E1",107,0)
 S QCODE=$S(QLFR:PI(PI,QLFR,"CODE"),1:"")
"RTN","IBDF18E1",108,0)
 ;
"RTN","IBDF18E1",109,0)
 ;determine if QCODE should be passed as VALUE
"RTN","IBDF18E1",110,0)
 I $P($G(^IBE(357.6,PI,20)),"^") N VALUE S VALUE=QCODE
"RTN","IBDF18E1",111,0)
 ;
"RTN","IBDF18E1",112,0)
 S PQTY=PI(PI,"QTY")
"RTN","IBDF18E1",113,0)
 ;mapping info could come from several different sources depending on whether or not a data qualifier is involved or the node=VITALS or ENCOUNTER
"RTN","IBDF18E1",114,0)
 I QLFR,PI(PI,"NODE")'="VITALS",PI(PI,"NODE")'="ENCOUNTER" I PI(PI,QLFR,"IND") D
"RTN","IBDF18E1",115,0)
 .S PHDR=PI(PI,QLFR,"HDR"),PVAL=PI(PI,QLFR,"VAL"),PTXT=PI(PI,QLFR,"TXT"),PQLFR=PI(PI,QLFR,"QLFR"),SUB=PI(PI,QLFR,"NODE")
"RTN","IBDF18E1",116,0)
 E  D
"RTN","IBDF18E1",117,0)
 .S PHDR=PI(PI,"HDR"),PVAL=PI(PI,"VAL"),PTXT=PI(PI,"TXT"),PQLFR=PI(PI,"QLFR"),SUB=PI(PI,"NODE")
"RTN","IBDF18E1",118,0)
 ;
"RTN","IBDF18E1",119,0)
 ;the ENCOUNTER node is treated differently, because there is always just one of them
"RTN","IBDF18E1",120,0)
 S:SUB'="ENCOUNTER" NODE=$G(TEMP(SUB,$P(FID,"("),+ITEM))
"RTN","IBDF18E1",121,0)
 S:SUB="ENCOUNTER" NODE=$G(PXCA("ENCOUNTER"))
"RTN","IBDF18E1",122,0)
 ;
"RTN","IBDF18E1",123,0)
 ; -- define clin lex pointer if from data enty  ($d(ibdf(item)))
"RTN","IBDF18E1",124,0)
 ;    if from scanning clin lex pointer defined in ibdf18e
"RTN","IBDF18E1",125,0)
 S PLEX=0 I SUB="DIAGNOSIS/PROBLEM" D
"RTN","IBDF18E1",126,0)
 .S PLEX=3
"RTN","IBDF18E1",127,0)
 .I $G(ITEM)'="" I $D(IBDF(ITEM)) S LEX=$P(IBDF(ITEM),"^",5)
"RTN","IBDF18E1",128,0)
 ;
"RTN","IBDF18E1",129,0)
 ;the VITALS node is also treated differently
"RTN","IBDF18E1",130,0)
 I SUB="VITALS" D
"RTN","IBDF18E1",131,0)
 .I $G(PI(PI,"TYPE",TYPE,"DATATYPE"))="f" S VALUE=+VALUE ; set floating point values to M values
"RTN","IBDF18E1",132,0)
 .S $P(NODE,"^")=PI(PI,"TYPE",TYPE,"VTYPE"),$P(NODE,"^",3)=PI(PI,"TYPE",TYPE,"UNIT"),$P(NODE,"^",2)=VALUE,$P(NODE,"^",4)=+$G(PXCA("ENCOUNTER"))
"RTN","IBDF18E1",133,0)
 ;these are nodes other than VITALS and ENCOUNTER
"RTN","IBDF18E1",134,0)
 E  D
"RTN","IBDF18E1",135,0)
 .;merge the data into the node
"RTN","IBDF18E1",136,0)
 .;
"RTN","IBDF18E1",137,0)
 .; -- for second provider entry put in provider node, always put
"RTN","IBDF18E1",138,0)
 .;    primary in encounter node
"RTN","IBDF18E1",139,0)
 .I SUB="ENCOUNTER",PVAL=4,$P(NODE,"^",4) D  Q
"RTN","IBDF18E1",140,0)
 ..I QCODE="P",$P(NODE,"^",15)'="P" S PXCA("PROVIDER",$P(NODE,"^",4))=$P(NODE,"^",15),$P(NODE,"^",4)=VALUE,$P(NODE,"^",15)=QCODE Q
"RTN","IBDF18E1",141,0)
 ..S PXCA("PROVIDER",VALUE)=QCODE Q
"RTN","IBDF18E1",142,0)
 .;
"RTN","IBDF18E1",143,0)
 .S NARR=+$G(NARR) ; define Narr for manual data entry
"RTN","IBDF18E1",144,0)
 .;
"RTN","IBDF18E1",145,0)
 .;  -- change to add modifiers to visit code selected
"RTN","IBDF18E1",146,0)
 .;
"RTN","IBDF18E1",147,0)
 .I $P(NODE,"^",PVAL)="" D
"RTN","IBDF18E1",148,0)
 .. S:$S(NARR=0:1,1:$P(FID,"(",2)'="N") $P(NODE,"^",PVAL)=VALUE
"RTN","IBDF18E1",149,0)
 .. ;D MODTEMP
"RTN","IBDF18E1",150,0)
 .I PTXT S:$P(FID,"(",2)="N"&NARR TEXT=VALUE I $S(NARR=0:$L($P(NODE,"^",PTXT))<$L(TEXT),$P(FID,"(",2)="N":TEXT'="",1:0) S $P(NODE,"^",PTXT)=TEXT
"RTN","IBDF18E1",151,0)
 .I PHDR I $L($P(NODE,"^",PHDR))<$L(HEADER) S $P(NODE,"^",PHDR)=HEADER
"RTN","IBDF18E1",152,0)
 .I PQTY S $P(NODE,"^",PQTY)=$G(QUANTITY)
"RTN","IBDF18E1",153,0)
 .;
"RTN","IBDF18E1",154,0)
 .; -- insert clin lex pointer into temp arry and re-initialize
"RTN","IBDF18E1",155,0)
 .I $G(PLEX),$G(LEX) S $P(NODE,"^",PLEX)=LEX
"RTN","IBDF18E1",156,0)
 .S LEX=0
"RTN","IBDF18E1",157,0)
 .;
"RTN","IBDF18E1",158,0)
 .I QCODE'="" S $P(NODE,"^",PQLFR)=$S($P(NODE,"^",PQLFR)'="":$P(NODE,"^",PQLFR)_","_QCODE,1:QCODE)
"RTN","IBDF18E1",159,0)
 ;
"RTN","IBDF18E1",160,0)
 S:SUB'="ENCOUNTER" TEMP(SUB,$P(FID,"("),+ITEM)=NODE
"RTN","IBDF18E1",161,0)
 D:SUB="PROCEDURE" MODTEMP
"RTN","IBDF18E1",162,0)
 S:SUB="ENCOUNTER" PXCA(SUB)=NODE
"RTN","IBDF18E1",163,0)
 D:SUB="ENCOUNTER" MODTEMP
"RTN","IBDF18E1",164,0)
 Q
"RTN","IBDF18E1",165,0)
MODTEMP ;-- Set up TEMP(SUB,$P(FID,"("),+ITEM, "MODIFIER array
"RTN","IBDF18E1",166,0)
 ;   the CPT Modifier information is stored in the selection file(357.3)
"RTN","IBDF18E1",167,0)
 ;
"RTN","IBDF18E1",168,0)
 ;
"RTN","IBDF18E1",169,0)
 N MCOUNT,MOD
"RTN","IBDF18E1",170,0)
 I $D(^IBE(357.3,+$G(SLCTN),3)) D
"RTN","IBDF18E1",171,0)
 . S MCOUNT=0
"RTN","IBDF18E1",172,0)
 . F MOD=0:0 S MOD=$O(^IBE(357.3,SLCTN,3,MOD)) Q:'MOD  D
"RTN","IBDF18E1",173,0)
 .. S MCOUNT=MCOUNT+1
"RTN","IBDF18E1",174,0)
 ..S TEMP(SUB,$P(FID,"("),+ITEM,"MODIFIER",MCOUNT)=$P($G(^IBE(357.3,SLCTN,3,MOD,0)),"^")
"RTN","IBDF18E1",175,0)
 .S:MCOUNT>0 TEMP(SUB,$P(FID,"("),+ITEM,"MODIFIER",0)=MCOUNT
"RTN","IBDF18E1",176,0)
 I $D(IBDF(+ITEM,"MODIFIER")) D
"RTN","IBDF18E1",177,0)
 . S MCOUNT=+$G(TEMP(SUB,$P(FID,"("),+ITEM,"MODIFIER",0))
"RTN","IBDF18E1",178,0)
 . S MOD=0 F  S MOD=$O(IBDF(+ITEM,"MODIFIER",MOD)) Q:'MOD  D
"RTN","IBDF18E1",179,0)
 .. S MCOUNT=MCOUNT+1
"RTN","IBDF18E1",180,0)
 .. S TEMP(SUB,$P(FID,"("),+ITEM,"MODIFIER",MCOUNT)=IBDF(+ITEM,"MODIFIER",MOD)
"RTN","IBDF18E1",181,0)
 . S TEMP(SUB,$P(FID,"("),+ITEM,"MODIFIER",0)=MCOUNT
"RTN","IBDF18E1",182,0)
 Q
"RTN","IBDF2A2")
0^6^B6077398
"RTN","IBDF2A2",1,0)
IBDF2A2 ;ALB/CJM - ENCOUNTER FORM (IBDF2A continued);NOV 16,1992
"RTN","IBDF2A2",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDF2A2",3,0)
 ;
"RTN","IBDF2A2",4,0)
WCMP ;write the compiled version
"RTN","IBDF2A2",5,0)
 N SUB,ND,WIDTH,STRING,LINES,ROW,FNAME,TYPE,UNIT,TYPENODE,ND2,SLCTN
"RTN","IBDF2A2",6,0)
 S SUB=0 F  S SUB=$O(^IBE(357.1,IBBLK,"S",SUB)) Q:'SUB  S ND=$G(^IBE(357.1,IBBLK,"S",SUB,0)) D DRWSTR^IBDFU(+$P(ND,"^"),+$P(ND,"^",2),$P(ND,"^",5,200),$P(ND,"^",3),$P(ND,"^",4))
"RTN","IBDF2A2",7,0)
 S SUB=0 F  S SUB=$O(^IBE(357.1,IBBLK,"V",SUB)) Q:'SUB  S ND=$G(^IBE(357.1,IBBLK,"V",SUB,0)) D DRWVLINE^IBDFU(+$P(ND,"^"),+$P(ND,"^",2),+$P(ND,"^",3),$P(ND,"^",4))
"RTN","IBDF2A2",8,0)
 ;
"RTN","IBDF2A2",9,0)
 ;bubbles
"RTN","IBDF2A2",10,0)
 S SUB=0 F  S SUB=$O(^IBE(357.1,IBBLK,"B",SUB)) Q:'SUB  D
"RTN","IBDF2A2",11,0)
 .S ND=$G(^IBE(357.1,IBBLK,"B",SUB,0))
"RTN","IBDF2A2",12,0)
 .S ND2=$G(^IBE(357.1,IBBLK,"B",SUB,2))
"RTN","IBDF2A2",13,0)
 .S SLCTN=$P($G(ND),"^",14)
"RTN","IBDF2A2",14,0)
 .S SUBHDR=$P($G(^IBE(357.1,IBBLK,"B",SUB,1)),"^") D
"RTN","IBDF2A2",15,0)
 ..D DRWBBL^IBDFM1(+$P(ND,"^"),+$P(ND,"^",2),+$P(ND,"^",3),$P(ND,"^",4),$P(ND,"^",5),$P(ND,"^",6),$P(ND,"^",7),$P(ND,"^",8),$P(ND,"^",9),$P(ND,"^",10),$P(ND,"^",11),$P(ND,"^",12),SUBHDR,$P(ND,"^",13),$G(ND2),$G(SLCTN))
"RTN","IBDF2A2",16,0)
 ;
"RTN","IBDF2A2",17,0)
 ;handprint
"RTN","IBDF2A2",18,0)
 S SUB=0 F  S SUB=$O(^IBE(357.1,IBBLK,"H",SUB)) Q:'SUB  S ND=$G(^IBE(357.1,IBBLK,"H",SUB,0)) D
"RTN","IBDF2A2",19,0)
 .D DRWHAND^IBDFM1(+ND,+$P(ND,"^",2),+$P(ND,"^",3),$P(ND,"^",4),$P(ND,"^",6),$P(ND,"^",7),$P(ND,"^",8),$P(ND,"^",9),$P(ND,"^",10),$P(ND,"^",12),$P(ND,"^",14),$P(ND,"^",15),$P(ND,"^",17))
"RTN","IBDF2A2",20,0)
 Q
"RTN","IBDF2A2",21,0)
 ;
"RTN","IBDF2A2",22,0)
SAVE(ARRAY,VAR) ;saves one array to the string=VAR, pass by reference
"RTN","IBDF2A2",23,0)
 N SUB,I
"RTN","IBDF2A2",24,0)
 S I=1,SUB="" F  S SUB=$O(ARRAY(SUB)) Q:SUB=""  S $P(VAR,"^",I)=ARRAY(SUB),I=I+1
"RTN","IBDF2A2",25,0)
 Q
"RTN","IBDF2A2",26,0)
RESTORE(ARRAY,VAR) ;restores the array from the string=VAR, pass by reference
"RTN","IBDF2A2",27,0)
 N SUB,I
"RTN","IBDF2A2",28,0)
 S I=1,SUB="" F  S SUB=$O(ARRAY(SUB)) Q:SUB=""  S ARRAY(SUB)=$P(VAR,"^",I),I=I+1
"RTN","IBDF2A2",29,0)
 Q
"RTN","IBDF2D3")
0^7^B24859455
"RTN","IBDF2D3",1,0)
IBDF2D3 ;ALB/CJM - ENCOUNTER FORM - WRITE SELECTION LIST (cont'd) ;NOV 16,1992
"RTN","IBDF2D3",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDF2D3",3,0)
 ;
"RTN","IBDF2D3",4,0)
DISPLAY(SLCTN,COL,HEADER,SUBHDR) ;writes the selection to the list
"RTN","IBDF2D3",5,0)
 N J,K,DA,ENTRY,VALUE,TYPE,UNDRLINE,OFFSET,LEN,FIRST,IBROW,IBCOL,BBBLS,ID,DISPLAY,NODE,SUB,WRAP,QTY,ND2
"RTN","IBDF2D3",6,0)
 S UNDRLINE=$S(IBLIST("ULSLCTNS"):"U",1:"")
"RTN","IBDF2D3",7,0)
 S FIRST=1,(ID,HEADER,DISPLAY,NODE)=""
"RTN","IBDF2D3",8,0)
 ;
"RTN","IBDF2D3",9,0)
 ;get the 0 node of the selection & the selection identifier
"RTN","IBDF2D3",10,0)
 I SLCTN S:IBLIST("DYNAMIC") NODE=$G(@LOCATION@(SLCTN)) S:'IBLIST("DYNAMIC") NODE=$G(^IBE(357.3,SLCTN,0)),ND2=$G(^IBE(357.3,SLCTN,2)) S ID=$P(NODE,"^")
"RTN","IBDF2D3",11,0)
 ;
"RTN","IBDF2D3",12,0)
 ;if a place holder, determine its use as a subheader - dynamic lists don't have place holders
"RTN","IBDF2D3",13,0)
 I 'IBLIST("DYNAMIC") D
"RTN","IBDF2D3",14,0)
 .S QTY=$P(NODE,"^",9)
"RTN","IBDF2D3",15,0)
 .I $P(NODE,"^",2) D
"RTN","IBDF2D3",16,0)
 ..;turn of the use of any prior subhdr if it was used
"RTN","IBDF2D3",17,0)
 ..I $P(NODE,"^",8) S SUBHDR=""
"RTN","IBDF2D3",18,0)
 ..;determine if this is to be used as a subheader
"RTN","IBDF2D3",19,0)
 ..S $P(NODE,"^",6)=$P(NODE,"^",6)
"RTN","IBDF2D3",20,0)
 ..I $P(NODE,"^",7),$P(NODE,"^",6)]"" S SUBHDR=SUBHDR_" "_$$STRIP^IBDFU($P(NODE,"^",6))
"RTN","IBDF2D3",21,0)
 ;
"RTN","IBDF2D3",22,0)
 ;if place holder with text,just print the text and quit
"RTN","IBDF2D3",23,0)
 I 'IBLIST("DYNAMIC"),$P(NODE,"^",2),$P(NODE,"^",6)]"" D  Q
"RTN","IBDF2D3",24,0)
 .I IBLIST("ULSLCTNS") D
"RTN","IBDF2D3",25,0)
 ..D DRWSTR^IBDFU($$Y^IBDF2D,($$X^IBDF2D)+LINE,$P(IBLIST("SEP"),"|",2)_$P(NODE,"^",6),"U",CWIDTH-(2*LINE))
"RTN","IBDF2D3",26,0)
 ..I NEEDUPR D DRWSTR^IBDFU(($$Y^IBDF2D)-1,($$X^IBDF2D)+LINE,"","U",CWIDTH-(2*LINE)) S NEEDUPR=0
"RTN","IBDF2D3",27,0)
 .E  D DRWSTR^IBDFU($$Y^IBDF2D,($$X^IBDF2D)+$L(IBLIST("SEP2"))+LINE,$P(NODE,"^",6))
"RTN","IBDF2D3",28,0)
 .D DECREASE^IBDF2D(.COL)
"RTN","IBDF2D3",29,0)
 ;
"RTN","IBDF2D3",30,0)
 ;don't draw bubbles for place holders
"RTN","IBDF2D3",31,0)
 I 'IBLIST("DYNAMIC"),$P(NODE,"^",2) N DRWBBL S DRWBBL=0
"RTN","IBDF2D3",32,0)
 ;
"RTN","IBDF2D3",33,0)
 I SLCTN,(IBLIST("DYNAMIC")!('$P(NODE,"^",2))) S CNT=CNT+1
"RTN","IBDF2D3",34,0)
 ;
"RTN","IBDF2D3",35,0)
 I 'IBFORM("COMPILED") I 'SLCTN,IBLIST("DYNAMIC") D
"RTN","IBDF2D3",36,0)
 .S CNT=CNT+1
"RTN","IBDF2D3",37,0)
 .S DISPLAY="#"_CNT
"RTN","IBDF2D3",38,0)
 .S ID=""
"RTN","IBDF2D3",39,0)
 ;
"RTN","IBDF2D3",40,0)
 F K=1:1:(+IBLIST("BTWN")+1) D  Q:COL("ROWSLEFT")<1
"RTN","IBDF2D3",41,0)
 .S ENTRY=""
"RTN","IBDF2D3",42,0)
 .S OFFSET=LINE
"RTN","IBDF2D3",43,0)
 .F J=1-IBLIST("SC0"):1:8 S TYPE=IBLIST("SCTYPE",J) D:TYPE'=""
"RTN","IBDF2D3",44,0)
 ..;S VALUE=""
"RTN","IBDF2D3",45,0)
 ..S VALUE=$S(K=2:$G(WRAP(J)),1:"")
"RTN","IBDF2D3",46,0)
 ..I TYPE=1,K'>1,SLCTN D  S:(ID]"")&IBLIST("SCPIECE",J) DISPLAY=DISPLAY_$S(DISPLAY="":"",1:" :: ")_$E(VALUE,1,IBLIST("SCW",J)*(1+$S(IBLIST("BTWN"):1,1:0))) I IBLIST("BTWN"),$L(VALUE)>IBLIST("SCW",J) D WRAP
"RTN","IBDF2D3",47,0)
 ...I IBLIST("SCPIECE",J)=0 S:SLCTN&(IBLIST("DYNAMIC")!('$P(NODE,"^",2))) VALUE="#"_CNT Q
"RTN","IBDF2D3",48,0)
 ...I 'IBLIST("DYNAMIC") S DA=$O(^IBE(357.3,SLCTN,1,"B",J,"")) S:DA VALUE=$P($G(^IBE(357.3,SLCTN,1,DA,0)),"^",2) Q
"RTN","IBDF2D3",49,0)
 ...;dynamic lists
"RTN","IBDF2D3",50,0)
 ...S SUB=$$DATANODE^IBDFU1B(IBLIST("RTN"),IBLIST("SCPIECE",J))
"RTN","IBDF2D3",51,0)
 ...I SUB]"" S VALUE=$P($G(@IBLIST("DATA_LOCATION")@(SUB,SLCTN)),"^",IBLIST("SCPIECE",J))
"RTN","IBDF2D3",52,0)
 ...E  S VALUE=$P(NODE,"^",IBLIST("SCPIECE",J))
"RTN","IBDF2D3",53,0)
 ...;
"RTN","IBDF2D3",54,0)
 ..S:TYPE=2 VALUE=$S(K'>1:IBLIST("SCSYMBOL",J),1:$J("",IBLIST("SCW",J)))
"RTN","IBDF2D3",55,0)
 ..;I TYPE=1 I SLCTN,ID]"",K'>1,IBLIST("SCPIECE",J) S DISPLAY=DISPLAY_$S(DISPLAY="":"",1:" :: ")_$E(VALUE,1,(IBLIST("SCW",J))
"RTN","IBDF2D3",56,0)
 ..S:TYPE=1 VALUE=$$PADRIGHT^IBDFU(VALUE,IBLIST("SCW",J))
"RTN","IBDF2D3",57,0)
 ..I TYPE=2 I IBLIST("ROUTINE",J)]"",K'>1,DRWBBL S IBCOL=($$X^IBDF2D)+OFFSET+$L(IBLIST("SEP2"))+$L(ENTRY)+((IBLIST("SCW",J)-3)\2),IBROW=$$Y^IBDF2D+$S(IBLIST("BTWN"):.5,1:0),BBBLS(IBCOL)=J
"RTN","IBDF2D3",58,0)
 ..I (TYPE=1)!('IBLIST("NOUL",J))!(K'=(+IBLIST("BTWN")+1))!(UNDRLINE'="U") D 
"RTN","IBDF2D3",59,0)
 ...S ENTRY=ENTRY_IBLIST("SEP2")_VALUE_IBLIST("SEP1")
"RTN","IBDF2D3",60,0)
 ...S FIRST=0
"RTN","IBDF2D3",61,0)
 ..E  D
"RTN","IBDF2D3",62,0)
 ...S NEEDUPR=1
"RTN","IBDF2D3",63,0)
 ...S LEN=$S(FIRST:0,1:$L(ENTRY)-LINE)
"RTN","IBDF2D3",64,0)
 ...S ENTRY=ENTRY_IBLIST("SEP2")_VALUE_IBLIST("SEP1")
"RTN","IBDF2D3",65,0)
 ...I OFFSET+$L(ENTRY)=CWIDTH S ENTRY=$E(ENTRY,1,$L(ENTRY)-LINE)
"RTN","IBDF2D3",66,0)
 ...D DRWSTR^IBDFU($$Y^IBDF2D,($$X^IBDF2D)+OFFSET,ENTRY,"U",LEN)
"RTN","IBDF2D3",67,0)
 ...S OFFSET=OFFSET+$L(ENTRY),ENTRY="",FIRST=1
"RTN","IBDF2D3",68,0)
 .I ENTRY'="" S ENTRY=$E(ENTRY,1,$L(ENTRY)-$L(IBLIST("SEP1"))) D DRWSTR^IBDFU($$Y^IBDF2D,($$X^IBDF2D)+OFFSET,ENTRY,$S(K'=(+IBLIST("BTWN")+1):"",1:UNDRLINE),$L(ENTRY)+$L(IBLIST("SEP2")))
"RTN","IBDF2D3",69,0)
 .D DECREASE^IBDF2D(.COL)
"RTN","IBDF2D3",70,0)
 ;
"RTN","IBDF2D3",71,0)
 ;Writting bubbles to form tracking? Is the form NOT yet compiled? Otherwise, don't need to do anything with the bubbles
"RTN","IBDF2D3",72,0)
 I (TRACKBBL)!('IBFORM("COMPILED")) S IBCOL="" F  S IBCOL=$O(BBBLS(IBCOL)) Q:IBCOL=""  S J=BBBLS(IBCOL) I IBLIST("ROUTINE",J)="BUBBLE" D
"RTN","IBDF2D3",73,0)
 .;
"RTN","IBDF2D3",74,0)
 .D:'TRACKBBL DRWBBL^IBDFM1(IBROW,IBCOL,IBLIST("INPUT_RTN"),ID,IBLIST("NAME"),"S"_IBLIST_"("_J,IBLIST("RULE",J),DISPLAY,HEADER,IBLIST("QLFR",J),IBLIST("DYNAMIC"),CNT,SUBHDR,$G(QTY),$G(ND2),$G(SLCTN))
"RTN","IBDF2D3",75,0)
 .D:TRACKBBL TRACKBBL^IBDFM1("S"_IBLIST_"("_J,CNT,IBLIST("QLFR",J),IBLIST("INPUT_RTN"),DISPLAY,ID)
"RTN","IBDF2D3",76,0)
 Q
"RTN","IBDF2D3",77,0)
 ;
"RTN","IBDF2D3",78,0)
WRAP    ;
"RTN","IBDF2D3",79,0)
 Q:IBLIST("SCW",J)<8
"RTN","IBDF2D3",80,0)
 N FOUND,AT,I,CHAR S FOUND=0
"RTN","IBDF2D3",81,0)
 S AT=IBLIST("SCW",J)+2
"RTN","IBDF2D3",82,0)
 F I=0:1:IBLIST("SCW",J)\4 S AT=AT-1,CHAR=$E(VALUE,AT) I " /\-:;"[CHAR S FOUND=1 Q
"RTN","IBDF2D3",83,0)
 I FOUND D
"RTN","IBDF2D3",84,0)
 .S WRAP(J)=$E(VALUE,AT+$S(" -"[CHAR:1,1:0),AT+IBLIST("SCW",J))
"RTN","IBDF2D3",85,0)
 .F I=1:1:IBLIST("SCW",J) I $E(WRAP(J),I)'=" " D  Q
"RTN","IBDF2D3",86,0)
 ..I I>1 S WRAP(J)=$E(WRAP(J),I,$L(WRAP(J)))
"RTN","IBDF2D3",87,0)
 .S VALUE=$E(VALUE,1,AT-1)
"RTN","IBDF2D3",88,0)
 E  S WRAP(J)=$E(VALUE,IBLIST("SCW",J),2*IBLIST("SCW",J)-1),VALUE=$E(VALUE,1,IBLIST("SCW",J)-1)_"-"
"RTN","IBDF2D3",89,0)
 Q
"RTN","IBDF4")
0^8^B73611649
"RTN","IBDF4",1,0)
IBDF4 ;ALB/CJM - ENCOUNTER FORM - BUILD FORM(editing group's selections) ;NOV 16,1992
"RTN","IBDF4",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**19,38**;APR 24, 1997
"RTN","IBDF4",3,0)
 ;
"RTN","IBDF4",4,0)
SLCTNS ;
"RTN","IBDF4",5,0)
 N IBRTN
"RTN","IBDF4",6,0)
 Q:IBLIST'=$P($G(^IBE(357.4,IBGRP,0)),"^",3)
"RTN","IBDF4",7,0)
 S IBRTN=IBLIST("RTN")
"RTN","IBDF4",8,0)
 D RTNDSCR^IBDFU1B(.IBRTN)
"RTN","IBDF4",9,0)
 D KILL^IBDFUA
"RTN","IBDF4",10,0)
 D EN^VALM("IBDF EDIT GROUP'S SELECTIONS") ;call the list manager
"RTN","IBDF4",11,0)
 Q
"RTN","IBDF4",12,0)
ONENTRY ;entry code for list manager
"RTN","IBDF4",13,0)
 D IDXSLCTN
"RTN","IBDF4",14,0)
 Q
"RTN","IBDF4",15,0)
ONEXIT ;exit code for the list manager
"RTN","IBDF4",16,0)
 K @VALMAR
"RTN","IBDF4",17,0)
 Q
"RTN","IBDF4",18,0)
 ;
"RTN","IBDF4",19,0)
IDXSLCTN ;build an array of selections in print order for the list processor
"RTN","IBDF4",20,0)
 N SLCTN,ODR,NODE
"RTN","IBDF4",21,0)
 K @VALMAR
"RTN","IBDF4",22,0)
 S ODR="",VALMCNT=0
"RTN","IBDF4",23,0)
 F  S ODR=$O(^IBE(357.3,"APO",IBLIST,IBGRP,ODR)) Q:ODR=""  D
"RTN","IBDF4",24,0)
 .S SLCTN="" F  S SLCTN=$O(^IBE(357.3,"APO",IBLIST,IBGRP,ODR,SLCTN)) Q:'SLCTN  D
"RTN","IBDF4",25,0)
 ..;check for messed up index and take appropriate action
"RTN","IBDF4",26,0)
 ..S NODE=$G(^IBE(357.3,SLCTN,0))
"RTN","IBDF4",27,0)
 ..I ($P(NODE,"^",3)'=IBLIST)!($P(NODE,"^",4)'=IBGRP) D  Q
"RTN","IBDF4",28,0)
 ...K ^IBE(357.3,"APO",IBLIST,IBGRP,ODR,SLCTN)
"RTN","IBDF4",29,0)
 ...I $P(NODE,"^",3)'=IBLIST,$P(NODE,"^",4)=IBGRP D  Q
"RTN","IBDF4",30,0)
 ....K DIK,DA S DIK="^IBE(357.3,",DA=SLCTN D ^DIK K DIK,DA
"RTN","IBDF4",31,0)
 ...I $P(NODE,"^",3)=IBLIST,$P($G(^IBE(357.4,+IBGRP,0)),"^",3)'=IBLIST D  Q
"RTN","IBDF4",32,0)
 ....K DIK,DA S DIK="^IBE(357.3,",DA=SLCTN D ^DIK K DIK,DA
"RTN","IBDF4",33,0)
 ...K DIK,DA S DIK="^IBE(357.3,",DA=SLCTN D IX^DIK K DIK,DA
"RTN","IBDF4",34,0)
 ..;
"RTN","IBDF4",35,0)
 ..S VALMCNT=VALMCNT+1
"RTN","IBDF4",36,0)
 ..S @VALMAR@(VALMCNT,0)=$$DISPLAY(SLCTN,VALMCNT),@VALMAR@("IDX",VALMCNT,VALMCNT)=SLCTN
"RTN","IBDF4",37,0)
 ..D FLDCTRL^VALM10(VALMCNT,"ID") ;set video for ID column
"RTN","IBDF4",38,0)
 Q
"RTN","IBDF4",39,0)
LMGRPHDR ;header for the screen
"RTN","IBDF4",40,0)
 S VALMHDR(1)="SELECTIONS CURRENTLY DEFINED FOR '"_$$GRPNAME_"' PRINT GROUP"
"RTN","IBDF4",41,0)
 Q
"RTN","IBDF4",42,0)
 ;
"RTN","IBDF4",43,0)
GRPNAME() ;the name of the selection group
"RTN","IBDF4",44,0)
 Q $P($G(^IBE(357.4,IBGRP,0)),"^",1)
"RTN","IBDF4",45,0)
 ;
"RTN","IBDF4",46,0)
DISPLAY(SLCTN,COUNT) ;returns a line to display to the list containing a selection - SLCTN is a ptr to the selectin, COUNT is the number of the selection on the list
"RTN","IBDF4",47,0)
 N SC,SCDA,VAL,RET,W,NODE,ORDER
"RTN","IBDF4",48,0)
 ;W - an array cotaining the widths of the subcolumns that contain text
"RTN","IBDF4",49,0)
 S VAL=""
"RTN","IBDF4",50,0)
 S RET=$$PADRIGHT^IBDFU(COUNT,4)
"RTN","IBDF4",51,0)
 S NODE=$G(^IBE(357.3,SLCTN,0))
"RTN","IBDF4",52,0)
 S ORDER=$P(NODE,"^",5),RET=RET_$J(ORDER,6,2)
"RTN","IBDF4",53,0)
 I $P(NODE,"^",2) S RET=RET_$S($P(NODE,"^",7):" SH",1:" PH")_"| "_$P(NODE,"^",6)
"RTN","IBDF4",54,0)
 I '$P(NODE,"^",2) S RET=RET_"  ",SC="" F SC=1:1:8 S SCDA=$O(^IBE(357.3,SLCTN,1,"B",SC,"")) D
"RTN","IBDF4",55,0)
 .I $G(IBLIST("SCTYPE",SC))=1 S W(SC)=IBLIST("SCW",SC)*(1+IBLIST("BTWN"))
"RTN","IBDF4",56,0)
 .S:$G(W(SC)) VAL=$$PADRIGHT^IBDFU($S(SCDA:$P($G(^IBE(357.3,SLCTN,1,SCDA,0)),"^",2),1:""),W(SC))
"RTN","IBDF4",57,0)
 .S:VAL'="" RET=RET_" | "_VAL
"RTN","IBDF4",58,0)
 .S VAL=""
"RTN","IBDF4",59,0)
 I $D(^IBE(357.3,SLCTN,2)) S RET=RET_"  ",SC="" F SC=1:1:2 S SCDA=$P(^IBE(357.3,SLCTN,2),"^",SC) S:SC=2 SCDA=$S($D(^LEX)>1:$P($G(^LEX(757.01,+SCDA,0)),"^"),1:$P($G(^GMP(757.01,+SCDA,0)),"^")) D
"RTN","IBDF4",60,0)
 .S W(SC)=25
"RTN","IBDF4",61,0)
 .S VAL=$$PADRIGHT^IBDFU($S(SCDA]"":SCDA,1:""),W(SC))
"RTN","IBDF4",62,0)
 .S:VAL'="" RET=RET_" | "_VAL
"RTN","IBDF4",63,0)
 .S VAL=""
"RTN","IBDF4",64,0)
 Q RET
"RTN","IBDF4",65,0)
ADDSLCTN ;allows the user to add a selection to the selection group
"RTN","IBDF4",66,0)
 N QUIT,SUB
"RTN","IBDF4",67,0)
 ;
"RTN","IBDF4",68,0)
 S VALMBCK="R"
"RTN","IBDF4",69,0)
 D FULL^VALM1
"RTN","IBDF4",70,0)
 I IBRTN("ACTION")'=3 D NOGOOD G ADDEXIT
"RTN","IBDF4",71,0)
 K @IBRTN("DATA_LOCATION")
"RTN","IBDF4",72,0)
 S QUIT=0 F  D  Q:QUIT  W !!!,"Now for another SELECTION LIST entry!"
"RTN","IBDF4",73,0)
 .I '$$DORTN^IBDFU1B(.IBRTN) S QUIT=1 D NOGOOD Q
"RTN","IBDF4",74,0)
 .I '$D(@IBRTN("DATA_LOCATION")) S QUIT=1 Q
"RTN","IBDF4",75,0)
 .D ADDREC(.QUIT) ;edits and adds the selection
"RTN","IBDF4",76,0)
 .K @IBRTN("DATA_LOCATION")
"RTN","IBDF4",77,0)
ADDEXIT ;
"RTN","IBDF4",78,0)
 D IDXSLCTN
"RTN","IBDF4",79,0)
 Q
"RTN","IBDF4",80,0)
ADDREC(QUIT,ORDER,SLCTN) ;allows the user to number the selection, edit the editable subcolumns, then adds the record - sets QUIT=1 if user quits
"RTN","IBDF4",81,0)
 N SUB,COUNT,NODE,VAL,DLAYGO,QTY,DTOUT,DUOUT,DIRUT
"RTN","IBDF4",82,0)
 I $P($G(^IBE(357.6,$P($G(^IBE(357.2,+IBLIST,0)),"^",11),16)),"^",8) S DIR(0)="NO",DIR("A")="Quantity",DIR("B")=1,DIR("?")="Enter the number of occurrences" D ^DIR K DIR S:$D(DTOUT)!$D(DUOUT) QUIT=1 Q:QUIT  S QTY=$G(Y)
"RTN","IBDF4",83,0)
 I '$G(ORDER) D  Q:QUIT
"RTN","IBDF4",84,0)
 .K DIR S DIR(0)="357.3,.05",DIR("B")=$$NEXT^IBDF4A(IBLIST,IBGRP) D ^DIR K DIR I $D(DIRUT) S QUIT=1 Q
"RTN","IBDF4",85,0)
 .S ORDER=+Y
"RTN","IBDF4",86,0)
 S VAL=$G(@IBRTN("DATA_LOCATION"))
"RTN","IBDF4",87,0)
 Q:QUIT
"RTN","IBDF4",88,0)
 ;we have all the data needed to add the selection - so add it
"RTN","IBDF4",89,0)
 S NODE=$S($P(VAL,"^")'="":$P(VAL,"^"),1:ORDER)_"^^"_IBLIST_"^"_IBGRP_"^"_ORDER_$S($G(QTY):"^^^^"_QTY,1:"")
"RTN","IBDF4",90,0)
 K DIC,DD,DO,DINUM S DIC="^IBE(357.3,",X=$P(NODE,"^",1),DIC(0)="FL",DLAYGO=357.3
"RTN","IBDF4",91,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDF4",92,0)
 S SLCTN=$S(+Y<0:"",1:+Y)
"RTN","IBDF4",93,0)
 I 'SLCTN W !,"Unable to create a new selection record!" D PAUSE^VALM1 S QUIT=1 Q
"RTN","IBDF4",94,0)
 S ^IBE(357.3,SLCTN,0)=NODE
"RTN","IBDF4",95,0)
 ;--- move codes and add modifiers
"RTN","IBDF4",96,0)
 D CODES^IBDF4A,ADD^IBDF4C
"RTN","IBDF4",97,0)
 ;---move the subcolum set up
"RTN","IBDF4",98,0)
 F SUB=1:1:8 D  Q:QUIT
"RTN","IBDF4",99,0)
 .I $G(IBLIST("SCTYPE",SUB))=1 I IBLIST("SCPIECE",SUB),IBLIST("SCW",SUB) D
"RTN","IBDF4",100,0)
 ..S NODE=$$DATANODE^IBDFU1B(IBRTN,IBLIST("SCPIECE",SUB))
"RTN","IBDF4",101,0)
 ..I NODE]"" S VAL(SUB)=$P($G(@IBRTN("DATA_LOCATION")@(NODE)),"^",IBLIST("SCPIECE",SUB))
"RTN","IBDF4",102,0)
 ..E  S VAL(SUB)=$P(VAL,"^",IBLIST("SCPIECE",SUB))
"RTN","IBDF4",103,0)
 ..Q:('IBLIST("SCEDITABLE",SUB))!((IBRTN("WIDTH",1))&(IBLIST("SCPIECE",SUB)=1))
"RTN","IBDF4",104,0)
 ..W !!,"Subcolumn Header: "_IBLIST("SCHDR",SUB) K DIR S DIR(0)="FO^0:"_(IBLIST("SCW",SUB)*(1+IBLIST("BTWN"))),DIR("A")="Edit Subcolumn "_SUB,DIR("B")=VAL(SUB)_$S($G(QTY)>1:" x "_QTY,1:"")
"RTN","IBDF4",105,0)
 ..I $P($G(^IBE(357.3,SLCTN,3,0)),"^",4)>0 D
"RTN","IBDF4",106,0)
 ...S:DIR("B")'["w/ mod" DIR("B")=DIR("B")_"w/ mod"
"RTN","IBDF4",107,0)
 ..D ^DIR K DIR S:$D(DTOUT)!$D(DUOUT) QUIT=1 Q:QUIT  S VAL(SUB)=Y I IBLIST("SCPIECE",SUB)=1,X="" S QUIT=1
"RTN","IBDF4",108,0)
 ;
"RTN","IBDF4",109,0)
 ;add the subcolumn value multiple
"RTN","IBDF4",110,0)
 S COUNT=0 F SUB=1:1:8 I $G(VAL(SUB))'="" S COUNT=COUNT+1,^IBE(357.3,SLCTN,1,COUNT,0)=SUB_"^"_VAL(SUB)
"RTN","IBDF4",111,0)
 S ^IBE(357.3,SLCTN,1,0)="^357.31IA^"_COUNT_"^"_COUNT
"RTN","IBDF4",112,0)
 K DA S DA=SLCTN,DIK="^IBE(357.3," D IX^DIK K DIK,DA
"RTN","IBDF4",113,0)
 D NARR,TERM
"RTN","IBDF4",114,0)
 Q
"RTN","IBDF4",115,0)
 ;
"RTN","IBDF4",116,0)
NARR ; -- edit provider narrative, but only for selections where the
"RTN","IBDF4",117,0)
 ;    interface allows editing
"RTN","IBDF4",118,0)
 N DIE,DA,DR
"RTN","IBDF4",119,0)
 I $P($G(^IBE(357.6,+$P($G(^IBE(357.2,+IBLIST,0)),U,11),0)),U,17) D
"RTN","IBDF4",120,0)
 .S DIE="^IBE(357.3,",DA=SLCTN,DR=2.01 D ^DIE
"RTN","IBDF4",121,0)
 Q
"RTN","IBDF4",122,0)
 ;
"RTN","IBDF4",123,0)
TERM ; -- map selection to clinical lexicon, but only for selections where
"RTN","IBDF4",124,0)
 ;    the package interface allows editing
"RTN","IBDF4",125,0)
 N DIE,DA,DR,GMPTUN,GMPTSUB,GMPTSHOW,XTLKGLB,XTLKHLP,XTLKKSCH,XTLKSAY,IBDLEX
"RTN","IBDF4",126,0)
 I $P($G(^IBE(357.6,+$P($G(^IBE(357.2,+IBLIST,0)),U,11),0)),U,18) D
"RTN","IBDF4",127,0)
 .I $D(^LEX)>1 S X="LEXSET" X ^%ZOSF("TEST") I $T D CONFIG^LEXSET("GMPL","PL1") S IBDLEX=1
"RTN","IBDF4",128,0)
 .I '$D(IBDLEX) S X="GMPTSET" X ^%ZOSF("TEST") I $T D CONFIG^GMPTSET("GMPL","PL1") S IBDLEX=1
"RTN","IBDF4",129,0)
 .;D CONFIG^GMPTSET("ICD","ICD") (this is an alternate filter)
"RTN","IBDF4",130,0)
 .Q:'$D(IBDLEX)
"RTN","IBDF4",131,0)
 .S DIE="^IBE(357.3,",DA=SLCTN,DR="2.02//"_$P($G(^IBE(357.3,DA,0)),"^") D ^DIE
"RTN","IBDF4",132,0)
 Q
"RTN","IBDF4",133,0)
 ;
"RTN","IBDF4",134,0)
CODES ; -- allow selection of a second code to pass through for this entry
"RTN","IBDF4",135,0)
 ; -- only as if pi allows input of more than one code
"RTN","IBDF4",136,0)
 ;N PI S PI=+$P($G(^IBE(357.2,+IBLIST,0)),U,11)
"RTN","IBDF4",137,0)
 ;Q:'$P($G(^IBE(357.6,PI,16)),U,9)
"RTN","IBDF4",138,0)
 ;N IBI,QUIT,IBVAL S QUIT=0
"RTN","IBDF4",139,0)
 ;F IBI=1,2 D  Q:QUIT
"RTN","IBDF4",140,0)
 ;.W !,"****Select a ",$S(IBI=1:"second",1:"third")," code to pass along with original."
"RTN","IBDF4",141,0)
 ;.I '$$DORTN^IBDFU1B(.IBRTN) S QUIT=1 Q
"RTN","IBDF4",142,0)
 ;.I +Y'>0 S QUIT=1 Q
"RTN","IBDF4",143,0)
 ;.X $G(^IBE(357.6,PI,9)) S IBVAL=X
"RTN","IBDF4",144,0)
 ;.S DIE="^IBE(357.3,",DA=SLCTN,DR=$S(IBI=1:"2.03",1:"2.04")_"////^S X=IBVAL" D ^DIE K DIE,DA,DR
"RTN","IBDF4",145,0)
 ;Q
"RTN","IBDF4",146,0)
 ;
"RTN","IBDF4",147,0)
NOGOOD ;
"RTN","IBDF4",148,0)
 W !,"The package interface routine for selection is not properly defined" D PAUSE^VALM1
"RTN","IBDF4",149,0)
 Q
"RTN","IBDF4",150,0)
 ;
"RTN","IBDF4",151,0)
SEQUENCE ;allows the user to resequence all of the selections on the list
"RTN","IBDF4",152,0)
 ;
"RTN","IBDF4",153,0)
 N SUBCOL,CNT,P,SORT,GROUP,NODE,VALUE,ITEM,IEN,HDR,DTOUT,DUOUT,DIRUT,SORT1
"RTN","IBDF4",154,0)
 S VALMBCK="R"
"RTN","IBDF4",155,0)
 D FULL^VALM1
"RTN","IBDF4",156,0)
 ;
"RTN","IBDF4",157,0)
 ;sort by which subcolumn?
"RTN","IBDF4",158,0)
 K DIR S DIR("A")="Which subcolumn do you want to sort by?",DIR("?")=" "
"RTN","IBDF4",159,0)
 S SUBCOL=0 F  S SUBCOL=$O(IBLIST("SCTYPE",SUBCOL)) Q:'SUBCOL  I IBLIST("SCTYPE",SUBCOL)=1 S SUBCOL(SUBCOL)=""
"RTN","IBDF4",160,0)
 S (CNT,SUBCOL)=0,DIR(0)="SOX^"
"RTN","IBDF4",161,0)
 F CNT=1:1 S SUBCOL=$O(SUBCOL(SUBCOL)) Q:'SUBCOL  D
"RTN","IBDF4",162,0)
 .S P=IBLIST("SCPIECE",SUBCOL),P=$S(P=1:1,P=2:3,P=3:5,P=4:7,P=5:9,P=6:11,P=7:13,1:0),HDR=$P($G(^IBE(357.6,+IBLIST("RTN"),2)),"^",P),DIR("?",CNT)=SUBCOL_" = "_HDR
"RTN","IBDF4",163,0)
 .S HDR=$S($G(IBLIST("SCHDR",SUBCOL))="":HDR,1:IBLIST("SCHDR",SUBCOL))
"RTN","IBDF4",164,0)
 .S DIR(0)=DIR(0)_SUBCOL_":"_HDR_";"
"RTN","IBDF4",165,0)
 D ^DIR
"RTN","IBDF4",166,0)
 Q:$D(DIRUT)!(Y=-1)
"RTN","IBDF4",167,0)
 K SUBCOL S SUBCOL=+Y
"RTN","IBDF4",168,0)
 ;
"RTN","IBDF4",169,0)
 ;sort aphabetically or numerically?
"RTN","IBDF4",170,0)
 K DIR
"RTN","IBDF4",171,0)
 S DIR("A")="How should the list be sorted?",DIR(0)="SO^1:ALPHABETICALLY;2:NUMERICALLY;",DIR("B")="ALPHABETICALLY"
"RTN","IBDF4",172,0)
 D ^DIR
"RTN","IBDF4",173,0)
 Q:$D(DIRUT)!(Y=-1)
"RTN","IBDF4",174,0)
 S SORT=Y
"RTN","IBDF4",175,0)
 ;  -- Resequence by group or group and placeholders
"RTN","IBDF4",176,0)
 K DIR
"RTN","IBDF4",177,0)
 S DIR("A")="Resequence by Group or Group and Place Holders?",DIR(0)="SO^1:GROUP/PLACE HOLDERS;2:GROUP;",DIR("B")="GROUP/PLACE HOLDERS"
"RTN","IBDF4",178,0)
 D ^DIR
"RTN","IBDF4",179,0)
 Q:$D(DIRUT)!(Y=-1)
"RTN","IBDF4",180,0)
 S SORT1=Y
"RTN","IBDF4",181,0)
 ;
"RTN","IBDF4",182,0)
 ;sort
"RTN","IBDF4",183,0)
 I SORT1=2 D EN^IBDF4A Q
"RTN","IBDF4",184,0)
 N CNTR,GROUP1,IBGROUP,IBORDER
"RTN","IBDF4",185,0)
 K ^TMP("IBDF",$J)
"RTN","IBDF4",186,0)
 S (GROUP,GROUP1,CNTR,IBGROUP)=0
"RTN","IBDF4",187,0)
 ;  -- Resequence only specific groups in block.
"RTN","IBDF4",188,0)
 I $D(IBGRUP) F  S IBGROUP=$O(IBGRUP(IBGROUP)) Q:'IBGROUP  D RESEQ
"RTN","IBDF4",189,0)
 I $D(IBGRUP) D ORDER Q
"RTN","IBDF4",190,0)
 ;  -- Resequence all groups of the block.
"RTN","IBDF4",191,0)
 I '$D(IBGRUP) F  S IBGROUP=$O(^IBE(357.3,"APO",IBLIST,IBGROUP)) Q:'IBGROUP  D RESEQ
"RTN","IBDF4",192,0)
 I '$D(IBGRUP) D ORDER Q
"RTN","IBDF4",193,0)
 Q
"RTN","IBDF4",194,0)
RESEQ S IBORDER=0 F  S IBORDER=$O(^IBE(357.3,"APO",IBLIST,IBGROUP,IBORDER)) Q:'IBORDER  S ITEM=0 F  S ITEM=$O(^IBE(357.3,"APO",IBLIST,IBGROUP,IBORDER,ITEM)) Q:'ITEM  D
"RTN","IBDF4",195,0)
 .S NODE=$G(^IBE(357.3,ITEM,0))
"RTN","IBDF4",196,0)
 .I ($P(NODE,"^",3)'=IBLIST) Q
"RTN","IBDF4",197,0)
 .S GROUP1=GROUP,GROUP=+$P(NODE,"^",4)
"RTN","IBDF4",198,0)
 .Q:$P($G(^IBE(357.4,GROUP,0)),"^",3)'=IBLIST
"RTN","IBDF4",199,0)
 .I $P(NODE,"^",2)=1 D  Q
"RTN","IBDF4",200,0)
 ..S CNTR=CNTR+1
"RTN","IBDF4",201,0)
 ..S VALUE=$S(SORT=1:" ",1:+$P(NODE,"^",1))
"RTN","IBDF4",202,0)
 ..S ^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,CNTR,VALUE,ITEM)=""
"RTN","IBDF4",203,0)
 .S IEN=$O(^IBE(357.3,ITEM,1,"B",SUBCOL,0)) Q:'IEN
"RTN","IBDF4",204,0)
 .S VALUE=$P($G(^IBE(357.3,ITEM,1,IEN,0)),"^",2)
"RTN","IBDF4",205,0)
 .S VALUE=$S(SORT=1:VALUE=" "_VALUE,1:+$P(NODE,"^",1))
"RTN","IBDF4",206,0)
 .I GROUP'=GROUP1 S CNTR=CNTR+1
"RTN","IBDF4",207,0)
 .S ^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,CNTR,$E(VALUE,1,40),ITEM)=""
"RTN","IBDF4",208,0)
 ;set the order
"RTN","IBDF4",209,0)
ORDER S GROUP=0,CNTR=0
"RTN","IBDF4",210,0)
 F  S GROUP=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP)) Q:'GROUP  D
"RTN","IBDF4",211,0)
 .S VALUE="",CNT=0
"RTN","IBDF4",212,0)
 .F  S CNTR=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,CNTR)) Q:'CNTR  F  S VALUE=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,CNTR,VALUE)) Q:VALUE=""  D
"RTN","IBDF4",213,0)
 ..S ITEM=0 F  S ITEM=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,CNTR,VALUE,ITEM)) Q:'ITEM  D
"RTN","IBDF4",214,0)
 ...S CNT=CNT+1
"RTN","IBDF4",215,0)
 ...K DIE,DA,DR S DIE="^IBE(357.3,",DR=".05///"_CNT,DA=ITEM D ^DIE K DIE,DA,DR
"RTN","IBDF4",216,0)
 ;
"RTN","IBDF4",217,0)
 K Y,X,DIR,^TMP("IBDF",$J,"RESEQUENCE LIST")
"RTN","IBDF4",218,0)
 D IDXGRP^IBDF3
"RTN","IBDF4",219,0)
 Q
"RTN","IBDF4A")
0^9^B40998233
"RTN","IBDF4A",1,0)
IBDF4A ;ALB/CJM - ENCOUNTER FORM - BUILD FORM(editing group's selections - continued from IBDF4) ;NOV 16,1992
"RTN","IBDF4A",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDF4A",3,0)
 ;
"RTN","IBDF4A",4,0)
EDIT ;allows editing of an existing selection
"RTN","IBDF4A",5,0)
 N SEL,SUB,SLCTN,SC,NODE,OQTY,NQTY
"RTN","IBDF4A",6,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","IBDF4A",7,0)
 S SEL="" F  S SEL=$O(VALMY(SEL)) Q:'SEL  D
"RTN","IBDF4A",8,0)
 .W !,"Editing Entry #",SEL
"RTN","IBDF4A",9,0)
 .S SLCTN=$G(@VALMAR@("IDX",SEL,SEL)) Q:'SLCTN
"RTN","IBDF4A",10,0)
 .S NODE=$G(^IBE(357.3,SLCTN,0))
"RTN","IBDF4A",11,0)
 .;re-index the record, to insure it is good                             
"RTN","IBDF4A",12,0)
 .K DIK,DA S DIK="^IBE(357.3,",DA=SLCTN D IX^DIK K DIK
"RTN","IBDF4A",13,0)
 .;edit the order of the selection - also, for placeholders, the text, then quit
"RTN","IBDF4A",14,0)
 .D FULL^VALM1
"RTN","IBDF4A",15,0)
 .I $P(NODE,"^",2) D  Q
"RTN","IBDF4A",16,0)
 ..S DA=SLCTN,DIE=357.3,DR="[IBDF EDIT PLACE HOLDER]" D ^DIE K DIE,DA,DR
"RTN","IBDF4A",17,0)
 .S DA=SLCTN,DIE=357.3,DR=".05;I '$P($G(^IBE(357.6,$P($G(^IBE(357.2,+IBLIST,0)),""^"",11),16)),""^"",8) S Y=""@99"";S OQTY=$P(^IBE(357.3,DA,0),""^"",9);.09;S NQTY=X;@99;S CONT=1" S CONT=0 D ^DIE K DIE,DA,DR
"RTN","IBDF4A",18,0)
 .D CODES
"RTN","IBDF4A",19,0)
 .D ADD^IBDF4C
"RTN","IBDF4A",20,0)
 .;add any missing subcolumns
"RTN","IBDF4A",21,0)
 .S SC=0 F SC=1:1:8 I $G(IBLIST("SCTYPE",SC))=1 I '$D(^IBE(357.3,SLCTN,1,"B",SC)) D
"RTN","IBDF4A",22,0)
 ..K DA,DO,DINUM,DIC
"RTN","IBDF4A",23,0)
 ..N DLAYGO
"RTN","IBDF4A",24,0)
 ..S DIC="^IBE(357.3,"_SLCTN_",1,",DA(1)=SLCTN,X=SC,DIC(0)="L",DLAYGO=357.3 D FILE^DICN
"RTN","IBDF4A",25,0)
 .;now allow the user to edit editable subcolumns - CONT=0 means the user up-arrowed out, so stop
"RTN","IBDF4A",26,0)
 .I CONT S SUB=0 F  S SUB=$O(^IBE(357.3,SLCTN,1,SUB)) Q:'SUB  D
"RTN","IBDF4A",27,0)
 ..S SC=+$G(^IBE(357.3,SLCTN,1,SUB,0)) I $G(IBLIST("SCTYPE",SC))=1,$G(IBLIST("SCPIECE",SC)),$G(IBLIST("SCEDITABLE",SC)) D
"RTN","IBDF4A",28,0)
 ...I $G(^IBE(357.3,SLCTN,1,0))="" S ^IBE(357.3,SLCTN,1,0)="^357.31AI^"
"RTN","IBDF4A",29,0)
 ...S DIE="^IBE(357.3,"_SLCTN_",1,",DA(1)=SLCTN,DA=SUB,DR=".02;S CONT=1",CONT=0 W !!,"Editing Subcolumn "_SC_": Header="_IBLIST("SCHDR",SC)
"RTN","IBDF4A",30,0)
 ...S IBVAL=$P($G(^IBE(357.3,SLCTN,1,SUB,0)),"^",2)
"RTN","IBDF4A",31,0)
 ...I $G(OQTY)'=$G(NQTY) S IBVAL=$P(IBVAL," x "_OQTY)_$S(NQTY>1:" x "_NQTY,1:""),DR=".02////^S X=IBVAL;I;"_DR
"RTN","IBDF4A",32,0)
 ...;--added for modifiers
"RTN","IBDF4A",33,0)
 ...I $P($G(^IBE(357.3,SLCTN,3,0)),"^",4)>0 D
"RTN","IBDF4A",34,0)
 ....S:IBVAL'["w/ mod" IBVAL=IBVAL_" w/ mod"
"RTN","IBDF4A",35,0)
 ....S DR=".02////^S X=IBVAL;I;"_DR
"RTN","IBDF4A",36,0)
 ...D ^DIE K DIE,DA,DR,IBVAL I 'CONT Q
"RTN","IBDF4A",37,0)
 .D NARR^IBDF4 W !
"RTN","IBDF4A",38,0)
 .D TERM^IBDF4 W !
"RTN","IBDF4A",39,0)
 D IDXSLCTN^IBDF4
"RTN","IBDF4A",40,0)
 S VALMBCK="R"
"RTN","IBDF4A",41,0)
EDITEXIT ;
"RTN","IBDF4A",42,0)
 Q
"RTN","IBDF4A",43,0)
CODES ; -- allow editing of 2nd & 3rd codes that are associated w/ original
"RTN","IBDF4A",44,0)
 N IBPI S IBPI=+$P($G(^IBE(357.2,+IBLIST,0)),U,11) Q:'IBPI
"RTN","IBDF4A",45,0)
 Q:'$P($G(^IBE(357.6,IBPI,16)),U,9)!('$D(^IBE(357.6,IBPI,17)))
"RTN","IBDF4A",46,0)
 N IBI,IBEXT,FLD
"RTN","IBDF4A",47,0)
 F IBI=3,4 S FLD="2.0"_IBI D
"RTN","IBDF4A",48,0)
 .S IBEXT=$P($G(^IBE(357.3,SLCTN,2)),"^",IBI)
"RTN","IBDF4A",49,0)
 .I $G(IBEXT)]"" D
"RTN","IBDF4A",50,0)
 ..W !,$S(IBI=3:"SECOND",1:"THIRD")," CODE: ",IBEXT
"RTN","IBDF4A",51,0)
 ..S DIR(0)="Y",DIR("A")="Delete?",DIR("B")="NO" D ^DIR K DIR
"RTN","IBDF4A",52,0)
 ..I Y=1 S IBEXT="",DIE="^IBE(357.3,",DA=SLCTN,DR=FLD_"////@" D ^DIE K DIE,DA,DR
"RTN","IBDF4A",53,0)
 .S DIC("A")="Select a "_$S(IBI=3:"SECOND",1:"THIRD")_" code to associate with the original:",DIC("B")=$S($G(IBEXT)]"":IBEXT,1:"")
"RTN","IBDF4A",54,0)
 .I '$$DORTN^IBDFU1B(.IBRTN) Q
"RTN","IBDF4A",55,0)
 .S IBEXT=$S(+$G(Y)>0:$P($G(Y(0)),"^"),1:"")
"RTN","IBDF4A",56,0)
 .I $G(IBEXT)]"" D
"RTN","IBDF4A",57,0)
 ..S DIE="^IBE(357.3,",DA=SLCTN,DR=FLD_"////^S X=IBEXT"
"RTN","IBDF4A",58,0)
 ..D ^DIE K DIE,DA,DR
"RTN","IBDF4A",59,0)
 Q
"RTN","IBDF4A",60,0)
DELETE ;allows the user to select selections to delete
"RTN","IBDF4A",61,0)
 N SEL
"RTN","IBDF4A",62,0)
 D EN^VALM2($G(XQORNOD(0)))
"RTN","IBDF4A",63,0)
 K DA
"RTN","IBDF4A",64,0)
 S SEL="" F  S SEL=$O(VALMY(SEL)) Q:'SEL  D
"RTN","IBDF4A",65,0)
 .S DIK="^IBE(357.3,",DA=$G(@VALMAR@("IDX",SEL,SEL))
"RTN","IBDF4A",66,0)
 .Q:'$$RUSURE^IBDFU5("Selection #"_SEL)
"RTN","IBDF4A",67,0)
 .D ^DIK
"RTN","IBDF4A",68,0)
 .D KILL^VALM10(SEL)
"RTN","IBDF4A",69,0)
 K DIK,DA
"RTN","IBDF4A",70,0)
 D IDXSLCTN^IBDF4
"RTN","IBDF4A",71,0)
 S VALMBCK="R"
"RTN","IBDF4A",72,0)
 Q
"RTN","IBDF4A",73,0)
 ;
"RTN","IBDF4A",74,0)
ADDBLANK ;allows the user to add a dummy selection to the selection group
"RTN","IBDF4A",75,0)
 ;i.e., a place holder that will not actually print a selection
"RTN","IBDF4A",76,0)
 ;
"RTN","IBDF4A",77,0)
 D FULL^VALM1
"RTN","IBDF4A",78,0)
 D ADD
"RTN","IBDF4A",79,0)
 D IDXSLCTN^IBDF4
"RTN","IBDF4A",80,0)
 S VALMBCK="R"
"RTN","IBDF4A",81,0)
 Q
"RTN","IBDF4A",82,0)
 ;
"RTN","IBDF4A",83,0)
NEXT(IBLIST,IBGRP) ;returns the next print order to assign=last + 1
"RTN","IBDF4A",84,0)
 Q (1+$O(^IBE(357.3,"APO",IBLIST,IBGRP,""),-1))
"RTN","IBDF4A",85,0)
 ;
"RTN","IBDF4A",86,0)
ASKMORE() ;ask if the user wants to add another, returns 1 or 0
"RTN","IBDF4A",87,0)
 K DIR
"RTN","IBDF4A",88,0)
 S DIR(0)="Y",DIR("A")="Do you want to add another",DIR("B")="NO"
"RTN","IBDF4A",89,0)
 D ^DIR
"RTN","IBDF4A",90,0)
 K DIR
"RTN","IBDF4A",91,0)
 I $D(DIRUT)!'Y Q 0
"RTN","IBDF4A",92,0)
 Q 1
"RTN","IBDF4A",93,0)
 ;
"RTN","IBDF4A",94,0)
ADD ;allows the user to add a dummy selection to the selection group
"RTN","IBDF4A",95,0)
 ;i.e., a place holder that will not actually print a selection
"RTN","IBDF4A",96,0)
 ;
"RTN","IBDF4A",97,0)
 N QUIT,ORDER,SLCTN,NODE
"RTN","IBDF4A",98,0)
 S QUIT=0 F  D  Q:QUIT  Q:'$$ASKMORE()
"RTN","IBDF4A",99,0)
 .S ORDER=$$NEXT(IBLIST,IBGRP)
"RTN","IBDF4A",100,0)
 .;we have all the data needed to add the selection - so add it
"RTN","IBDF4A",101,0)
 .S NODE=ORDER_"^"_1_"^"_IBLIST_"^"_IBGRP_"^"_ORDER
"RTN","IBDF4A",102,0)
 .K DIC,DD,DO,DINUM
"RTN","IBDF4A",103,0)
 .N DLAYGO
"RTN","IBDF4A",104,0)
 .S DIC="^IBE(357.3,",X=ORDER,DIC(0)="FL",DLAYGO=357.3
"RTN","IBDF4A",105,0)
 .D FILE^DICN K DIC,DIE,DA
"RTN","IBDF4A",106,0)
 .S SLCTN=$S(+Y<0:"",1:+Y)
"RTN","IBDF4A",107,0)
 .I 'SLCTN W !,"Unable to create the place holder!" D PAUSE^VALM1 S QUIT=1 Q
"RTN","IBDF4A",108,0)
 .S ^IBE(357.3,SLCTN,0)=NODE
"RTN","IBDF4A",109,0)
 .K DA S DA=SLCTN,DIK="^IBE(357.3," D IX^DIK K DIK,DA
"RTN","IBDF4A",110,0)
 .K DIE S DA=SLCTN,DIE=357.3,DR="[IBDF EDIT PLACE HOLDER]" D ^DIE K DIE,DA,DR
"RTN","IBDF4A",111,0)
 .K DA S DA=SLCTN,DIK="^IBE(357.3," D IX^DIK K DIK,DA
"RTN","IBDF4A",112,0)
 Q
"RTN","IBDF4A",113,0)
EN ;  -- Resequence selection lists not taking into account the
"RTN","IBDF4A",114,0)
 ;     the place holders.  Will put the selection list into alphabetic
"RTN","IBDF4A",115,0)
 ;     or numeric order..... the place holders will be used as exta
"RTN","IBDF4A",116,0)
 ;     lines of description and not as separators or headers within
"RTN","IBDF4A",117,0)
 ;     the group.
"RTN","IBDF4A",118,0)
 N CNTR,COUNT,IBGROUP,IBORDER
"RTN","IBDF4A",119,0)
 S (CNTR,COUNT,IBGROUP)=0
"RTN","IBDF4A",120,0)
 K ^TMP("BLANK",$J),^TMP("IBDF",$J)
"RTN","IBDF4A",121,0)
 ;  -- Resequence only specific groups in block.
"RTN","IBDF4A",122,0)
 I $D(IBGRUP) F  S IBGROUP=$O(IBGRUP(IBGROUP)) Q:'IBGROUP  D RESEQ
"RTN","IBDF4A",123,0)
 I $D(IBGRUP) D ORDER Q
"RTN","IBDF4A",124,0)
 ;  -- Resequence all groups of the block.
"RTN","IBDF4A",125,0)
 I '$D(IBGRUP) F  S IBGROUP=$O(^IBE(357.3,"APO",IBLIST,IBGROUP)) Q:'IBGROUP  D RESEQ
"RTN","IBDF4A",126,0)
 I '$D(IBGRUP) D ORDER Q
"RTN","IBDF4A",127,0)
 Q
"RTN","IBDF4A",128,0)
 ;
"RTN","IBDF4A",129,0)
RESEQ S IBORDER=0 F  S IBORDER=$O(^IBE(357.3,"APO",IBLIST,IBGROUP,IBORDER)) Q:'IBORDER  S ITEM=0 F  S ITEM=$O(^IBE(357.3,"APO",IBLIST,IBGROUP,IBORDER,ITEM)) Q:'ITEM  D
"RTN","IBDF4A",130,0)
 .S NODE=$G(^IBE(357.3,ITEM,0))
"RTN","IBDF4A",131,0)
 .I ($P(NODE,"^",3)'=IBLIST) Q
"RTN","IBDF4A",132,0)
 .S GROUP=+$P(NODE,"^",4)
"RTN","IBDF4A",133,0)
 .Q:$P($G(^IBE(357.4,GROUP,0)),"^",3)'=IBLIST
"RTN","IBDF4A",134,0)
 .S COUNT=COUNT+1
"RTN","IBDF4A",135,0)
 .I $P(NODE,"^",2) S ^TMP("BLANK",$J,GROUP,CNTR,COUNT,ITEM)=""
"RTN","IBDF4A",136,0)
 .S IEN=$O(^IBE(357.3,ITEM,1,"B",SUBCOL,0)) Q:'IEN
"RTN","IBDF4A",137,0)
 .S VALUE=$P($G(^IBE(357.3,ITEM,1,IEN,0)),"^",2)
"RTN","IBDF4A",138,0)
 .S VALUE=$S(SORT=1:VALUE=" "_VALUE,1:+$P(NODE,"^",1))
"RTN","IBDF4A",139,0)
 .S CNTR=CNTR+1
"RTN","IBDF4A",140,0)
 .S ^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,$E(VALUE,1,40),ITEM)=CNTR
"RTN","IBDF4A",141,0)
 .S ^TMP("BLANK",$J,GROUP,CNTR,COUNT,ITEM)=""
"RTN","IBDF4A",142,0)
 ;
"RTN","IBDF4A",143,0)
 ;set the order
"RTN","IBDF4A",144,0)
ORDER S (GROUP,CNTR)=0
"RTN","IBDF4A",145,0)
 F  S GROUP=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP)) Q:'GROUP  D
"RTN","IBDF4A",146,0)
 .S VALUE="",CNT=0
"RTN","IBDF4A",147,0)
 .F  S VALUE=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,VALUE)) Q:VALUE=""  D
"RTN","IBDF4A",148,0)
 ..S ITEM=0 F  S ITEM=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,VALUE,ITEM)) Q:'ITEM  S CNTR=^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,VALUE,ITEM) D:'$D(^TMP("BLANK",$J,GROUP,CNTR))  I $D(^TMP("BLANK",$J,GROUP,CNTR)) D BLANK
"RTN","IBDF4A",149,0)
 ...S CNT=CNT+1
"RTN","IBDF4A",150,0)
 ...K DIE,DA,DR S DIE="^IBE(357.3,",DR=".05///"_CNT,DA=ITEM D ^DIE K DIE,DA,DR
"RTN","IBDF4A",151,0)
 ;
"RTN","IBDF4A",152,0)
 K Y,X,DIR,^TMP("IBDF",$J,"RESEQUENCE LIST")
"RTN","IBDF4A",153,0)
 D IDXGRP^IBDF3
"RTN","IBDF4A",154,0)
 Q
"RTN","IBDF4A",155,0)
BLANK ;  -- Check to see if there is any place holders.
"RTN","IBDF4A",156,0)
 N IBDITEM,COUNT
"RTN","IBDF4A",157,0)
 F COUNT=0:0 S COUNT=$O(^TMP("BLANK",$J,GROUP,CNTR,COUNT)) Q:'COUNT  F IBDITEM=0:0 S IBDITEM=$O(^TMP("BLANK",$J,GROUP,CNTR,COUNT,IBDITEM)) Q:'IBDITEM  D
"RTN","IBDF4A",158,0)
 .S CNT=CNT+1
"RTN","IBDF4A",159,0)
 .K DIE,DA,DR S DIE="^IBE(357.3,",DR=".05///"_CNT,DA=IBDITEM D ^DIE K DIE,DA,DR
"RTN","IBDF4A",160,0)
 .Q
"RTN","IBDF4A",161,0)
 Q
"RTN","IBDF4C")
0^20^B1786729
"RTN","IBDF4C",1,0)
IBDF4C ;ALB/DHH - CPT MODIFIER SELECTION ;26-MAY-1999
"RTN","IBDF4C",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24,1997
"RTN","IBDF4C",3,0)
MOD ;Entry point for selecting or modifying modifiers
"RTN","IBDF4C",4,0)
 ; -- this is called by the input transform (fileman file: selection)
"RTN","IBDF4C",5,0)
 ;   
"RTN","IBDF4C",6,0)
 ;    slctn -- is the ien of selection file and should be cpt code
"RTN","IBDF4C",7,0)
 ;    $$modp^icptmod  -- screens appropriate modifiers for a cpt code
"RTN","IBDF4C",8,0)
 ;
"RTN","IBDF4C",9,0)
 D
"RTN","IBDF4C",10,0)
 .N DO,CPT,Y,DIC
"RTN","IBDF4C",11,0)
 .Q:$G(SLCTN)=""
"RTN","IBDF4C",12,0)
 .S CPT=$P(^IBE(357.3,SLCTN,0),"^")
"RTN","IBDF4C",13,0)
 .Q:$G(CPT)=""
"RTN","IBDF4C",14,0)
 .S DIC=81.3,DIC("S")="I ($$MODP^ICPTMOD(CPT,+Y,""I""))>0"
"RTN","IBDF4C",15,0)
 .S DIC(0)="EM" D ^DIC
"RTN","IBDF4C",16,0)
 .S (DIX,X)=$P(Y,"^",2)
"RTN","IBDF4C",17,0)
 .I +Y<1 D
"RTN","IBDF4C",18,0)
 .. D EN^DDIOL("Invalid CPT Modifier entered for CPT procedure code.")
"RTN","IBDF4C",19,0)
 Q
"RTN","IBDF4C",20,0)
 ;
"RTN","IBDF4C",21,0)
 ;
"RTN","IBDF4C",22,0)
ADD ;add cpt modifiers to the selection file
"RTN","IBDF4C",23,0)
 ;
"RTN","IBDF4C",24,0)
 ; -- this is to be called via IBDF4 AND IBDF4A
"RTN","IBDF4C",25,0)
 ;
"RTN","IBDF4C",26,0)
 ; -- check package interface file to see if CPT Modifiers are to be
"RTN","IBDF4C",27,0)
 ;    asked.
"RTN","IBDF4C",28,0)
 ;
"RTN","IBDF4C",29,0)
 Q:$P($G(^IBE(357.6,+$P($G(^IBE(357.2,+IBLIST,0)),U,11),0)),U,21)'=1
"RTN","IBDF4C",30,0)
 ;
"RTN","IBDF4C",31,0)
 ; -- use fileman to allow user to add/edit modifiers
"RTN","IBDF4C",32,0)
 ;    using CPT API to screen out inappropriate modifiers ( this is 
"RTN","IBDF4C",33,0)
 ;    done via the input transform on the CPT MODIFIERS multiple field
"RTN","IBDF4C",34,0)
 ;
"RTN","IBDF4C",35,0)
 N DIE,DA,DR
"RTN","IBDF4C",36,0)
 S DIE="^IBE(357.3,"
"RTN","IBDF4C",37,0)
 S DA=SLCTN
"RTN","IBDF4C",38,0)
 S DR="[IBDF CPT MODIFIER]"
"RTN","IBDF4C",39,0)
 D ^DIE
"RTN","IBDF4C",40,0)
 Q
"RTN","IBDF4C",41,0)
LOOKUP ;response to ?? while entering CPT Modifiers
"RTN","IBDF4C",42,0)
 ;xecutable help used this from file 357.3 cTP Modifier field
"RTN","IBDF4C",43,0)
 ;
"RTN","IBDF4C",44,0)
 N DO,CPT,DIC
"RTN","IBDF4C",45,0)
 Q:$G(SLCTN)=""
"RTN","IBDF4C",46,0)
 S CPT=$P(^IBE(357.3,SLCTN,0),"^")
"RTN","IBDF4C",47,0)
 Q:$G(CPT)=""
"RTN","IBDF4C",48,0)
 ;S IBDSAV=DIC
"RTN","IBDF4C",49,0)
 S X="??",DIC=81.3,DIC("S")="I ($$MODP^ICPTMOD(CPT,+Y,""I""))>0"
"RTN","IBDF4C",50,0)
 S DIC(0)="EMQ" D ^DIC
"RTN","IBDF4C",51,0)
 Q
"RTN","IBDFBK3")
0^23^B39962109
"RTN","IBDFBK3",1,0)
IBDFBK3 ;ALB/AAS - AICS broker Utilities ;23-May-95
"RTN","IBDFBK3",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**12,38**;APR 24, 1997
"RTN","IBDFBK3",3,0)
 ;
"RTN","IBDFBK3",4,0)
LSTDATA(RESULT,PXCA,LCNT) ;
"RTN","IBDFBK3",5,0)
 ; -- expand the PXCA array data into human readable terms for
"RTN","IBDFBK3",6,0)
 ;    display on the workstation
"RTN","IBDFBK3",7,0)
 ;
"RTN","IBDFBK3",8,0)
 ;    Input : Result - (called by reference, see output)
"RTN","IBDFBK3",9,0)
 ;            PXCA   - (by referencethe array of data formated to
"RTN","IBDFBK3",10,0)
 ;                      the PCE device interface specification
"RTN","IBDFBK3",11,0)
 ;            lcnt   - (by reference) a counter for the result array
"RTN","IBDFBK3",12,0)
 ;    Output: RESULT - a new array element result(lcnt) will be
"RTN","IBDFBK3",13,0)
 ;                     created for each piece of data received
"RTN","IBDFBK3",14,0)
 ;
"RTN","IBDFBK3",15,0)
 N I,J,M,X,IBX
"RTN","IBDFBK3",16,0)
 ;
"RTN","IBDFBK3",17,0)
 ; -- noshow, cancel or reschedule checked
"RTN","IBDFBK3",18,0)
 I $D(PXCA("IBD-ABORT")) D
"RTN","IBDFBK3",19,0)
 .S I="" F  S I=$O(PXCA("IBD-ABORT",I)) Q:I=""  S J="" F  S J=$O(PXCA("IBD-ABORT",I,J)) Q:J=""  D
"RTN","IBDFBK3",20,0)
 ..S IBX=PXCA("IBD-ABORT",I,J)
"RTN","IBDFBK3",21,0)
 ..S X="The following Data was NOT Sent to PCE because "_$P(IBX,"^",2)_" was marked!"
"RTN","IBDFBK3",22,0)
 ..D NEWLINE(.RESULT,X,.LCNT)
"RTN","IBDFBK3",23,0)
 .Q
"RTN","IBDFBK3",24,0)
 ;
"RTN","IBDFBK3",25,0)
 ; -- expand the encounter node
"RTN","IBDFBK3",26,0)
 I $D(PXCA("ENCOUNTER")) S IBX=PXCA("ENCOUNTER") D
"RTN","IBDFBK3",27,0)
 .I $P(IBX,"^",14) S X="Checkout Date/Time: "_$$FMTE^XLFDT($P(IBX,"^",14)) D NEWLINE(.RESULT,X,.LCNT)
"RTN","IBDFBK3",28,0)
 .I $P(IBX,"^",4) S X=$S($P(IBX,"^",15)="P":"Primary ",$P(IBX,"^",15)="S":"Secondary ",1:"")_"Provider: "_$P($G(^VA(200,+$P(IBX,"^",4),0)),"^") D NEWLINE(.RESULT,X,.LCNT)
"RTN","IBDFBK3",29,0)
 .;; --change to api cpt ; dhh
"RTN","IBDFBK3",30,0)
 .I $P(IBX,"^",5) S X=$P(IBX,"^",5) D
"RTN","IBDFBK3",31,0)
 .. I X'="" D
"RTN","IBDFBK3",32,0)
 ... N IBVST
"RTN","IBDFBK3",33,0)
 ... S X=$$CPT^ICPTCOD(X)
"RTN","IBDFBK3",34,0)
 ... S (X,IBVST)=$S(+X=-1:"",1:$P(X,"^",2))
"RTN","IBDFBK3",35,0)
 ... S X="Visit Type CPT: "_X D NEWLINE(.RESULT,X,.LCNT)
"RTN","IBDFBK3",36,0)
 ... I $D(PXCA("ENCOUNTER","MODIFIER")) D
"RTN","IBDFBK3",37,0)
 .... S X="    Modifier(s): " D NEWLINE(.RESULT,X,.LCNT)
"RTN","IBDFBK3",38,0)
 .... N IBM S IBM=0
"RTN","IBDFBK3",39,0)
 .... F  S IBM=$O(PXCA("ENCOUNTER","MODIFIER",IBM)) Q:IBM']""  D
"RTN","IBDFBK3",40,0)
 ..... N IBMDESC S IBMDESC=$$MODP^ICPTMOD(IBVST,IBM,"E") Q:+IBMDESC<0
"RTN","IBDFBK3",41,0)
 ..... S X="         "_IBM_"-"_$P(IBMDESC,"^",2)
"RTN","IBDFBK3",42,0)
 ..... D NEWLINE(.RESULT,X,.LCNT)
"RTN","IBDFBK3",43,0)
 .; add sc,ao,ir,ec,elegibility,credit stop (pieces 6-9,13,17)
"RTN","IBDFBK3",44,0)
 .I $P(IBX,"^",6) D NEWLINE(.RESULT,"Visit for SC Condition",.LCNT)
"RTN","IBDFBK3",45,0)
 .I $P(IBX,"^",7) D NEWLINE(.RESULT,"Visit for Agent Orange Condition",.LCNT)
"RTN","IBDFBK3",46,0)
 .I $P(IBX,"^",8) D NEWLINE(.RESULT,"Visit for Ionizing Radiation Condition",.LCNT)
"RTN","IBDFBK3",47,0)
 .I $P(IBX,"^",9) D NEWLINE(.RESULT,"Visit for Environmental Contaminates Condition",.LCNT)
"RTN","IBDFBK3",48,0)
 .I $P(IBX,"^",13) D NEWLINE(.RESULT,"Eligibility for Visit: "_$P($G(^DIC(8,+$P(IBX,"^",13),0)),"^"),.LCNT)
"RTN","IBDFBK3",49,0)
 .I $P(IBX,"^",17) D NEWLINE(.RESULT,"Additional Credit Stop: "_$P($G(^DIC(40.7,+$P(IBX,"^",17),0)),"^"),.LCNT)
"RTN","IBDFBK3",50,0)
 ;
"RTN","IBDFBK3",51,0)
 ; -- expand the other nodes
"RTN","IBDFBK3",52,0)
 F M="DIAGNOSIS/PROBLEM","PROVIDER","DIAGNOSIS","PROCEDURE","VITALS","PROBLEM","EXAM","IMMUNIZATION","HEALTH FACTORS","SKIN TEST","PATIENT ED","LOCAL" I $D(PXCA(M)) D
"RTN","IBDFBK3",53,0)
 .S I="" F  S I=$O(PXCA(M,I)) Q:I=""  D:M="PROVIDER" PROV S J="" F  S J=$O(PXCA(M,I,J)) Q:J=""  D
"RTN","IBDFBK3",54,0)
 ..K X S IBX=PXCA(M,I,J) D  D:$D(X) NEWLINE(.RESULT,X,.LCNT)
"RTN","IBDFBK3",55,0)
 ...;
"RTN","IBDFBK3",56,0)
 ...I M="DIAGNOSIS" S X=$S($P(IBX,"^",2)="P":"Primary",$P(IBX,"^",2)="S":"Secondary",1:"")_" Diagnosis: "_$P($G(^ICD9(+$P($G(IBX),"^"),0)),"^")_" - "_$P(IBX,"^",9)_" - "_$P(IBX,"^",8) Q
"RTN","IBDFBK3",57,0)
 ...;
"RTN","IBDFBK3",58,0)
 ...I M="PROCEDURE" D
"RTN","IBDFBK3",59,0)
 ....I +IBX D
"RTN","IBDFBK3",60,0)
 ..... S X=$$CPT^ICPTCOD(+IBX)
"RTN","IBDFBK3",61,0)
 ..... S X=$S(X=-1:"",1:$P(X,"^",2))
"RTN","IBDFBK3",62,0)
 ..... S X="Procedure: "_X_" - "_$P(IBX,"^",7)_" - "_$P(IBX,"^",6)_" - "_$S($P(IBX,"^",2)="P":"Primary ",$P(IBX,"^",2)="S":"Secondary ",1:"Quantity: "_+$P(IBX,"^",2))
"RTN","IBDFBK3",63,0)
 ..... Q
"RTN","IBDFBK3",64,0)
 ....I 'IBX S X="Treatment: "_$P(IBX,"^",6)
"RTN","IBDFBK3",65,0)
 ...;
"RTN","IBDFBK3",66,0)
 ...I M="VITALS" S X="Vital Sign: "_$$VTYPE($P(IBX,"^"))_": "_$P(IBX,"^",2) Q
"RTN","IBDFBK3",67,0)
 ...;
"RTN","IBDFBK3",68,0)
 ...I M="IMMUNIZATION" S X="Immunization: "_$$DSPLYIM^PXAPIIB(+IBX) I $P(IBX,"^",5) S X=X_" - Contraindicated" Q
"RTN","IBDFBK3",69,0)
 ...;
"RTN","IBDFBK3",70,0)
 ...I M="EXAM" S X="Exam: "_$$DSPLYEX^PXAPIIB(+IBX)_$S($P(IBX,"^",2)="A":" Abnormal",$P(IBX,"^",2)="N":" Normal",1:"") Q
"RTN","IBDFBK3",71,0)
 ...;
"RTN","IBDFBK3",72,0)
 ...I M="PROBLEM" S X="Problem List: "_$P(IBX,"^") Q
"RTN","IBDFBK3",73,0)
 ...;
"RTN","IBDFBK3",74,0)
 ...I M="HEALTH FACTORS" S X="Health Factor: "_$$DSPLYHF^PXAPIIB(+IBX) N Y S Y=$P(IBX,"^",2) I Y'="" S X=X_" Level/Severity: "_$S(Y="M":"Minimal",Y="MO":"Moderate",Y="H":"Heavy/Severe",1:"") Q
"RTN","IBDFBK3",75,0)
 ...;
"RTN","IBDFBK3",76,0)
 ...I M="SKIN TEST" S X="Skin Tests: "_$$DSPLYSK^PXAPIIB(+IBX) Q
"RTN","IBDFBK3",77,0)
 ...;
"RTN","IBDFBK3",78,0)
 ...I M="PATIENT ED" S X="Patient Eduction: "_$$DSPLYED^PXAPIIB(+IBX) I $P(IBX,"^",2) S X=X_" , Level of Understanding: "_$S(IBX=1:"Poor",IBX=2:"Fair",IBX=3:"Good",IBX=4:"N/A",IBX=5:"Refused",1:"") Q
"RTN","IBDFBK3",79,0)
 ...;
"RTN","IBDFBK3",80,0)
 ...I M="DIAGNOSIS/PROBLEM" D  S:X="" X="Diagnosis/Problem: unspecified"
"RTN","IBDFBK3",81,0)
 ....N Y S X=""
"RTN","IBDFBK3",82,0)
 ....S Y=$P(IBX,"^",2) S X=$S(Y="P":"Primary ",Y="S":"Secondary ",1:"")_"Diagnosis/Problem"
"RTN","IBDFBK3",83,0)
 ....;I $P(IBX,"^",4) S X=X_$S($P(IBX,"^",6)="I":", Inactive",1:", Active")
"RTN","IBDFBK3",84,0)
 ....I $P(IBX,"^",13)'="" S X=X_" '"_$P(IBX,"^",14)_$S($P(IBX,"^",14)'="":" ",1:"")_$P(IBX,"^",13)_"'"
"RTN","IBDFBK3",85,0)
 ....;I +$P(IBX,"^",3) S X=X_", Clinical Lexicon term: "_$P($G(^GMP(757.01,+$P(IBX,"^",3),0)),"^") ;clinical lexicon term passed
"RTN","IBDFBK3",86,0)
 ....I +$P(IBX,"^",3) S X=X_", Clinical Lexicon term: " D
"RTN","IBDFBK3",87,0)
 .....I $D(^LEX) S X=X_$P($G(^LEX(757.01,+$P(IBX,"^",3),0)),"^") Q
"RTN","IBDFBK3",88,0)
 .....S X=X_$P($G(^GMP(757.01,+$P(IBX,"^",3),0)),"^")
"RTN","IBDFBK3",89,0)
 ....I $P(IBX,"^",5) S X=X_", Added to Problem List "
"RTN","IBDFBK3",90,0)
 ....I +$P(IBX,"^",4) S X=X_", Patient Active Problem: "_$$PROBNAR($P(IBX,"^",4)) ;problem entry passed
"RTN","IBDFBK3",91,0)
 ....I +IBX S IBY=$P($G(^ICD9(+IBX,0)),"^") I IBX'[IBY S X=X_", ICD9: "_IBY
"RTN","IBDFBK3",92,0)
 ....I $P(IBX,"^",9) S X=X_" SC Condition "
"RTN","IBDFBK3",93,0)
 ....I $P(IBX,"^",10) S X=X_" AO Condition "
"RTN","IBDFBK3",94,0)
 ....I $P(IBX,"^",11) S X=X_" IR Condition "
"RTN","IBDFBK3",95,0)
 ....I $P(IBX,"^",12) S X=X_" EC Condition "
"RTN","IBDFBK3",96,0)
 ...I M="LOCAL" S X="Local Data Received: "_IBX Q
"RTN","IBDFBK3",97,0)
 ..I M="PROCEDURE",$D(PXCA(M,I,J)) D MODLIST
"RTN","IBDFBK3",98,0)
LSTQ Q
"RTN","IBDFBK3",99,0)
 ;
"RTN","IBDFBK3",100,0)
MODLIST ; -- expand the modifiers filed
"RTN","IBDFBK3",101,0)
 N IBM,X S IBM=0
"RTN","IBDFBK3",102,0)
 S X="    Modifier(s): " D NEWLINE(.RESULT,X,.LCNT)
"RTN","IBDFBK3",103,0)
 F  S IBM=$O(PXCA(M,I,J,IBM)) Q:IBM']""  D
"RTN","IBDFBK3",104,0)
 . S X="         "_IBM_"-"_$P(PXCA(M,I,J,IBM),"^",3)
"RTN","IBDFBK3",105,0)
 . D NEWLINE(.RESULT,X,.LCNT)
"RTN","IBDFBK3",106,0)
 Q
"RTN","IBDFBK3",107,0)
PROV ; -- expand the additional provider node
"RTN","IBDFBK3",108,0)
 S IBX=$G(PXCA(M,I))
"RTN","IBDFBK3",109,0)
 S X=$S($E(IBX,1)="P":"Primary ",$E(IBX,1)="S":"Secondary ",1:"")_"Provider: "_$P($G(^VA(200,I,0)),"^")_$S($P(IBX,"^",2)=1:" Attending",1:"")
"RTN","IBDFBK3",110,0)
 D NEWLINE(.RESULT,X,.LCNT)
"RTN","IBDFBK3",111,0)
 Q
"RTN","IBDFBK3",112,0)
 ;
"RTN","IBDFBK3",113,0)
NEWLINE(RESULT,X,LCNT) ;
"RTN","IBDFBK3",114,0)
 ; -- increment count and add new line to results array.
"RTN","IBDFBK3",115,0)
 S LCNT=LCNT+1
"RTN","IBDFBK3",116,0)
 S RESULT(LCNT)=X
"RTN","IBDFBK3",117,0)
 Q
"RTN","IBDFBK3",118,0)
 ;
"RTN","IBDFBK3",119,0)
VTYPE(X) ;
"RTN","IBDFBK3",120,0)
 ; -- Vital sign type from codes
"RTN","IBDFBK3",121,0)
 S X=$G(X)
"RTN","IBDFBK3",122,0)
 Q $S(X="BP":"Blood Pressure",X="HT":"Height",X="WT":"Weight",X="TMP":"Temperature",X="PU":"Pulse",1:"Other Vital")
"RTN","IBDFBK3",123,0)
 ;
"RTN","IBDFBK3",124,0)
PROBNAR(IEN) ; -- display problem narrative
"RTN","IBDFBK3",125,0)
 ;
"RTN","IBDFBK3",126,0)
 Q $P($G(^AUTNPOV(+$P($G(^AUPNPROB(+$G(IEN),0)),"^",5),0)),"^")
"RTN","IBDFBK3",127,0)
 ;
"RTN","IBDFBK3",128,0)
PROBDIA(IEN) ; -- return problem diagnosis code pointer
"RTN","IBDFBK3",129,0)
 Q +$P($G(^AUPNPROB(+$G(IEN),0)),"^")
"RTN","IBDFDBS")
0^35^B5744829
"RTN","IBDFDBS",1,0)
IBDFDBS ;ALB/RMO/CJM - Database Server Utilities; [ 03/23/95  11:08 AM ]
"RTN","IBDFDBS",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDFDBS",3,0)
 ;
"RTN","IBDFDBS",4,0)
 ; These API's were originally copied from routine DGENDBS and use the 
"RTN","IBDFDBS",5,0)
 ; FileMan database server calls (with wrappers around them to facilitate
"RTN","IBDFDBS",6,0)
 ; their use) to add a new record, update an existing record, and 
"RTN","IBDFDBS",7,0)
 ; validate data in a record.
"RTN","IBDFDBS",8,0)
 ;
"RTN","IBDFDBS",9,0)
 ;
"RTN","IBDFDBS",10,0)
UPD(FILE,IBDFDA,DATA,ERROR) ;File data into an existing record.
"RTN","IBDFDBS",11,0)
 ; Input:
"RTN","IBDFDBS",12,0)
 ;   FILE - File or sub-file number
"RTN","IBDFDBS",13,0)
 ;   IBDFDA - New name for traditional DA array, with same meaning.
"RTN","IBDFDBS",14,0)
 ;            Pass by reference.
"RTN","IBDFDBS",15,0)
 ;   DATA - Data array to file (pass by reference)
"RTN","IBDFDBS",16,0)
 ;          Format: DATA(<field #>)=<value>
"RTN","IBDFDBS",17,0)
 ;
"RTN","IBDFDBS",18,0)
 ; Output:
"RTN","IBDFDBS",19,0)
 ;  Function Value -     0=error and 1=no error
"RTN","IBDFDBS",20,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","IBDFDBS",21,0)
 ;
"RTN","IBDFDBS",22,0)
 ; Example: To update a record in subfile 2.0361 in record with ien=353,
"RTN","IBDFDBS",23,0)
 ;          subrecord ien=68, with the field .01 value = 21:
"RTN","IBDFDBS",24,0)
 ;    S DATA(.01)=21,IBDFDA=68,IBDFDA(1)=353 I $$UPD^IBDFDBS(2.0361,.IBDFDA,.DATA,.ERROR) W !,"DONE"
"RTN","IBDFDBS",25,0)
 ;
"RTN","IBDFDBS",26,0)
 N FDA,FIELD,IENS,ERRORS
"RTN","IBDFDBS",27,0)
 ;
"RTN","IBDFDBS",28,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","IBDFDBS",29,0)
 ;FDA - the FDA array as defined by FM
"RTN","IBDFDBS",30,0)
 ;
"RTN","IBDFDBS",31,0)
 I '$G(IBDFDA) S ERROR="IEN OF RECORD TO BE UPDATED NOT SPECIFIED" Q 0
"RTN","IBDFDBS",32,0)
 S IENS=$$IENS^DILF(.IBDFDA)
"RTN","IBDFDBS",33,0)
 S FIELD=0
"RTN","IBDFDBS",34,0)
 F  S FIELD=$O(DATA(FIELD)) Q:'FIELD  D
"RTN","IBDFDBS",35,0)
 .S FDA(FILE,IENS,FIELD)=$G(DATA(FIELD))
"RTN","IBDFDBS",36,0)
 D FILE^DIE("K","FDA","ERRORS(1)")
"RTN","IBDFDBS",37,0)
 I +$G(DIERR) D
"RTN","IBDFDBS",38,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","IBDFDBS",39,0)
 E  D
"RTN","IBDFDBS",40,0)
 .S ERROR=""
"RTN","IBDFDBS",41,0)
 ;
"RTN","IBDFDBS",42,0)
 I $S(+$G(DIERR):0,1:1) D CLEAN^DILF Q 1
"RTN","IBDFDBS",43,0)
 E  D CLEAN^DILF Q 0
"RTN","IBDFDBS",44,0)
 ;
"RTN","IBDFDBS",45,0)
ADD(FILE,IBDFDA,DATA,ERROR,IEN) ;
"RTN","IBDFDBS",46,0)
 ;Description: Creates a new record and files the data.
"RTN","IBDFDBS",47,0)
 ; Input:
"RTN","IBDFDBS",48,0)
 ;   FILE - File or sub-file number
"RTN","IBDFDBS",49,0)
 ;   IBDFDA - New name for traditional FileMan DA array with same
"RTN","IBDFDBS",50,0)
 ;            meaning. Pass by reference.  Only needed if adding to a
"RTN","IBDFDBS",51,0)
 ;            subfile.
"RTN","IBDFDBS",52,0)
 ;   DATA - Data array to file, pass by reference
"RTN","IBDFDBS",53,0)
 ;          Format: DATA(<field #>)=<value>
"RTN","IBDFDBS",54,0)
 ;   IEN - internal entry number to use (optional)
"RTN","IBDFDBS",55,0)
 ;
"RTN","IBDFDBS",56,0)
 ; Output:
"RTN","IBDFDBS",57,0)
 ;   Function Value - If no error then it returns the ien of the created record, else returns NULL.
"RTN","IBDFDBS",58,0)
 ;  IBDFDA - returns the ien of the new record, NULL if none created.  If needed, pass by reference.
"RTN","IBDFDBS",59,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","IBDFDBS",60,0)
 ;
"RTN","IBDFDBS",61,0)
 ; Example: To add a record in subfile 2.0361 in the record with ien=353
"RTN","IBDFDBS",62,0)
 ;          with the field .01 value = 21:
"RTN","IBDFDBS",63,0)
 ;  S DATA(.01)=21,IBDFDA(1)=353 I $$ADD^IBDFDBS(2.0361,.IBDFDA,.DATA) W !,"DONE"
"RTN","IBDFDBS",64,0)
 ;
"RTN","IBDFDBS",65,0)
 ; Example: If creating a record not in a subfile, would look like this:
"RTN","IBDFDBS",66,0)
 ;          S DATA(.01)=21 I $$ADD^IBDFDBS(867,,.DATA) W !,"DONE"
"RTN","IBDFDBS",67,0)
 ;
"RTN","IBDFDBS",68,0)
 N FDA,FIELD,IENA,IENS,ERRORS
"RTN","IBDFDBS",69,0)
 ;
"RTN","IBDFDBS",70,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","IBDFDBS",71,0)
 ;IENA - the Internal Entry Numebr Array defined by FM
"RTN","IBDFDBS",72,0)
 ;FDA - the FDA array defined by FM
"RTN","IBDFDBS",73,0)
 ;IEN - the ien of the new record
"RTN","IBDFDBS",74,0)
 ;
"RTN","IBDFDBS",75,0)
 S IBDFDA="+1"
"RTN","IBDFDBS",76,0)
 S IENS=$$IENS^DILF(.IBDFDA)
"RTN","IBDFDBS",77,0)
 S FIELD=0
"RTN","IBDFDBS",78,0)
 F  S FIELD=$O(DATA(FIELD)) Q:'FIELD  D
"RTN","IBDFDBS",79,0)
 .S FDA(FILE,IENS,FIELD)=$G(DATA(FIELD))
"RTN","IBDFDBS",80,0)
 I $G(IEN) S IENA(1)=IEN
"RTN","IBDFDBS",81,0)
 D UPDATE^DIE("","FDA","IENA","ERRORS(1)")
"RTN","IBDFDBS",82,0)
 I +$G(DIERR) D
"RTN","IBDFDBS",83,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","IBDFDBS",84,0)
 .S IEN=""
"RTN","IBDFDBS",85,0)
 E  D
"RTN","IBDFDBS",86,0)
 .S IEN=IENA(1)
"RTN","IBDFDBS",87,0)
 .S ERROR=""
"RTN","IBDFDBS",88,0)
 D CLEAN^DILF
"RTN","IBDFDBS",89,0)
 S IBDFDA=IEN
"RTN","IBDFDBS",90,0)
 Q IEN
"RTN","IBDFDBS",91,0)
 ;
"RTN","IBDFDBS",92,0)
TESTVAL(FILE,FIELD,VALUE) ;
"RTN","IBDFDBS",93,0)
 ;Description: returns 1 if VALUE is a valid value for FIELD in FILE
"RTN","IBDFDBS",94,0)
 ;
"RTN","IBDFDBS",95,0)
 Q:(('$G(FILE))!('$G(FIELD))) 0
"RTN","IBDFDBS",96,0)
 ;
"RTN","IBDFDBS",97,0)
 N DISPLAY,VALID,RESULT
"RTN","IBDFDBS",98,0)
 S VALID=1
"RTN","IBDFDBS",99,0)
 ;
"RTN","IBDFDBS",100,0)
 ;if there is no external value then it is not valid
"RTN","IBDFDBS",101,0)
 S DISPLAY=$$EXTERNAL^DILFD(FILE,FIELD,"F",VALUE)
"RTN","IBDFDBS",102,0)
 I (DISPLAY="") S VALID=0
"RTN","IBDFDBS",103,0)
 ; 
"RTN","IBDFDBS",104,0)
 I VALID,$$GET1^DID(FILE,FIELD,"","TYPE")'["POINTER" D
"RTN","IBDFDBS",105,0)
 .D CHK^DIE(FILE,FIELD,,VALUE,.RESULT) I RESULT="^" S VALID=0 Q
"RTN","IBDFDBS",106,0)
 Q VALID
"RTN","IBDFDE1")
0^10^B54599761
"RTN","IBDFDE1",1,0)
IBDFDE1 ;ALB/AAS - AICS Data Entry, Final check; 24-FEB-96 [ 11/12/96  2:12 PM ]
"RTN","IBDFDE1",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDFDE1",3,0)
 ; -- calls IBDFRPC4 to pass data to pce
"RTN","IBDFDE1",4,0)
 ;
"RTN","IBDFDE1",5,0)
% G ^IBDFDE
"RTN","IBDFDE1",6,0)
 ;
"RTN","IBDFDE1",7,0)
FINAL ; -- display everything selected and check okay
"RTN","IBDFDE1",8,0)
 ; -- input IBDSEL :
"RTN","IBDFDE1",9,0)
 ;             $p1 := package interface ien (for input)
"RTN","IBDFDE1",10,0)
 ;             $p2 := code to send (may be internal or external)
"RTN","IBDFDE1",11,0)
 ;             $p3 := text to send
"RTN","IBDFDE1",12,0)
 ;             $p4 := hdr to send (optional)
"RTN","IBDFDE1",13,0)
 ;             $p5 := clinic lexicon pointer (optional) 
"RTN","IBDFDE1",14,0)
 ;             $p6 := qualifier (i.e. primary or secondary)
"RTN","IBDFDE1",15,0)
 ;             $P7 :=
"RTN","IBDFDE1",16,0)
 ;             $p8 :=
"RTN","IBDFDE1",17,0)
 ;             $p9 :=
"RTN","IBDFDE1",18,0)
 ;             $p10 := external value of code (optional)
"RTN","IBDFDE1",19,0)
 ;
"RTN","IBDFDE1",20,0)
 N I,X,DIR,DIRUT,DUOUT,DTOUT,PARAM,IBDCNT,MODSAVE,XX
"RTN","IBDFDE1",21,0)
 K IBDREDIT
"RTN","IBDFDE1",22,0)
 I $G(IBDSEL(0))<1,$G(IBDCO("CO"))="",$G(IBDCO("SC"))="",$G(IBDCO("AO"))="",$G(IBDCO("IR"))="" W !!,"Nothing Selected!!" S IBDF("NOTHING")=1 Q
"RTN","IBDFDE1",23,0)
 ;
"RTN","IBDFDE1",24,0)
 S (IBDCNT,IBQUIT)=0
"RTN","IBDFDE1",25,0)
 W !!,"You have entered the following:"
"RTN","IBDFDE1",26,0)
 D WRITE^IBDFDE0(IBDF("SDOE"),.IBDCNT)
"RTN","IBDFDE1",27,0)
 S I=0 F  S I=$O(IBDSEL(I)) Q:I=""  D
"RTN","IBDFDE1",28,0)
 . S IBDCNT=IBDCNT+1
"RTN","IBDFDE1",29,0)
 . K MODSAVE
"RTN","IBDFDE1",30,0)
 . D LINE(IBDCNT,IBDSEL(I)) D
"RTN","IBDFDE1",31,0)
 .. I $D(IBDSEL(I,"MODIFIER")) D MODLIST(I)
"RTN","IBDFDE1",32,0)
 S DIR(0)="Y",DIR("B")="No",DIR("A")="Is this Okay" D ^DIR
"RTN","IBDFDE1",33,0)
 I $D(DIRUT) S IBQUIT=1 W !!,"No action Taken",! G FINALQ
"RTN","IBDFDE1",34,0)
 I Y<1 D DEL S:'IBQUIT IBDREDIT=1 G FINALQ
"RTN","IBDFDE1",35,0)
 I Y'=1 G FINALQ
"RTN","IBDFDE1",36,0)
 M IBDF=IBDSEL
"RTN","IBDFDE1",37,0)
 ;I $G(^DPT(DFN,"S",IBDF("APPT"),0))="" D FNDAPPT I 'IBDOK W !!,"No action Taken",! Q
"RTN","IBDFDE1",38,0)
 I $G(IBDF("SAVE")) M ^TMP("IBD-SAVED",$J)=IBDF ;don't save checkout data
"RTN","IBDFDE1",39,0)
 M IBDF=IBDCO
"RTN","IBDFDE1",40,0)
 W !!,"Sending Data to PCE..."
"RTN","IBDFDE1",41,0)
 D SEND^IBDFRPC4(.RESULT,.IBDF)
"RTN","IBDFDE1",42,0)
 W $S($G(RESULT(0)):" Successful",1:" Unsuccessful"),!!
"RTN","IBDFDE1",43,0)
 I $D(IBDSTRT) S IBDFIN=$H S IBDTIME=$$HDIFF^XLFDT(IBDFIN,IBDSTRT,2)
"RTN","IBDFDE1",44,0)
 S PARAM=$P($G(^IBD(357.09,1,0)),"^",7)
"RTN","IBDFDE1",45,0)
 I PARAM=3 D DISP
"RTN","IBDFDE1",46,0)
 I PARAM,$D(PXCA("ERROR"))!($D(PXCA("WARNING"))) D ERR
"RTN","IBDFDE1",47,0)
 I $G(IBDTIME) D
"RTN","IBDFDE1",48,0)
 .W !!,"Elapsed time for data entry: ",IBDTIME," seconds.",!!
"RTN","IBDFDE1",49,0)
 .S IBDF("SECONDS")=IBDTIME,IBDF("USER")=DUZ
"RTN","IBDFDE1",50,0)
 .D ETIME^IBDFBK1(.RESULT,.IBDF)
"RTN","IBDFDE1",51,0)
 I '$G(IBDREDIT),$P($G(^IBD(357.09,1,0)),"^",6) D MAKAPPT
"RTN","IBDFDE1",52,0)
FINALQ K SDFN,ZTSK,SECONDS,LEX,ORVP,SEL1,PXCAVSIT,PXCA,PXCASTAT
"RTN","IBDFDE1",53,0)
 Q
"RTN","IBDFDE1",54,0)
 ;
"RTN","IBDFDE1",55,0)
DEL ; -- delete selected entry
"RTN","IBDFDE1",56,0)
 N I,J,DIR,DIRUT,DUOUT,DTOUT,CNT,CNTD,IBD,IBD1,IBDEL
"RTN","IBDFDE1",57,0)
 S CNT=0
"RTN","IBDFDE1",58,0)
 W !
"RTN","IBDFDE1",59,0)
 S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to delete an item"
"RTN","IBDFDE1",60,0)
 S DIR("?")="Enter 'Yes' if you want to delete an item or 'No' to just add more items."
"RTN","IBDFDE1",61,0)
 D ^DIR K DIR
"RTN","IBDFDE1",62,0)
 I $D(DIRUT) S IBQUIT=1 Q
"RTN","IBDFDE1",63,0)
 Q:Y<1
"RTN","IBDFDE1",64,0)
 S IBD=0 F  S IBD=$O(IBDSEL(IBD)) Q:IBD=""  S CNT=CNT+1,IBDEL(CNT)=IBD D LINE(CNT,IBDSEL(IBD)) D
"RTN","IBDFDE1",65,0)
 . I $D(IBDSEL(IBD,"MODIFIER")) D MODLIST(IBD)
"RTN","IBDFDE1",66,0)
 Q:CNT<1
"RTN","IBDFDE1",67,0)
 S DIR(0)="L^1:"_CNT D ^DIR K DIR
"RTN","IBDFDE1",68,0)
 I $D(DIRUT) W !,"Nothing Deleted" Q
"RTN","IBDFDE1",69,0)
 F IBD1=1:1 S IBDEL=$P(Y,",",IBD1) Q:IBDEL=""  D
"RTN","IBDFDE1",70,0)
 .W !,"Deleting "_IBDEL
"RTN","IBDFDE1",71,0)
 .S QLFR=$P(IBDSEL(IBDEL(IBDEL)),"^",6)
"RTN","IBDFDE1",72,0)
 .I QLFR'="" K IBDPI(+IBDSEL(IBDEL(IBDEL)),QLFR)
"RTN","IBDFDE1",73,0)
 .K IBDPI(+IBDSEL(IBDEL(IBDEL)),IBDEL(IBDEL))
"RTN","IBDFDE1",74,0)
 .K IBDSEL(IBDEL(IBDEL))
"RTN","IBDFDE1",75,0)
 .K IBDEL(IBDEL)
"RTN","IBDFDE1",76,0)
 .S CNTD=$G(CNTD)+1
"RTN","IBDFDE1",77,0)
 I $G(CNTD)=CNT S IBDSEL(0)=0
"RTN","IBDFDE1",78,0)
 W !
"RTN","IBDFDE1",79,0)
DELQ Q
"RTN","IBDFDE1",80,0)
 ;
"RTN","IBDFDE1",81,0)
LINE(CNT,IBD) ; -- write one line of text
"RTN","IBDFDE1",82,0)
 W !,?3,CNT,?7,$S($P(IBD,"^",8)'="":$P(IBD,"^",8),1:$E($P($P($G(^IBE(357.6,+IBD,0)),"^"),"INPUT ",2),1,22)),?31,$E($P(IBD,"^",3),1,30)
"RTN","IBDFDE1",83,0)
 W ?62,$S($P(IBD,"^",10)'="":$P(IBD,"^",10),$P($G(^IBE(357.6,+IBD,0)),"^")="GMP INPUT CLINIC COMMON PROBLEMS":$$LEX($P(IBD,"^",2)),1:$P(IBD,"^",2))
"RTN","IBDFDE1",84,0)
 W ?70,$E($S($P(IBD,"^",9)'="":$P(IBD,"^",9),1:$P(IBD,"^",6)),1,10)
"RTN","IBDFDE1",85,0)
 S SLCTN=$P(IBD,"^",12) I SLCTN'="" D
"RTN","IBDFDE1",86,0)
 . ;list modifiers
"RTN","IBDFDE1",87,0)
 . N CODE
"RTN","IBDFDE1",88,0)
 . Q:'$D(^IBE(357.3,SLCTN,3))
"RTN","IBDFDE1",89,0)
 . S CODE=$P($G(^IBE(357.3,SLCTN,0)),"^") Q:CODE=""
"RTN","IBDFDE1",90,0)
 . W !?11,"Associated Modifier(s):    "
"RTN","IBDFDE1",91,0)
 . S MOD=0 F  S MOD=$O(^IBE(357.3,SLCTN,3,MOD)) Q:'MOD  D
"RTN","IBDFDE1",92,0)
 .. S MODSAVE=$P($G(^IBE(357.3,SLCTN,3,MOD,0)),"^")
"RTN","IBDFDE1",93,0)
 .. S MODSAVE(MODSAVE)=""
"RTN","IBDFDE1",94,0)
 .. S XX=$P($$MODP^ICPTMOD(CODE,MODSAVE,"E"),"^",2)
"RTN","IBDFDE1",95,0)
 .. W !,?15,MODSAVE,?20,XX
"RTN","IBDFDE1",96,0)
 Q
"RTN","IBDFDE1",97,0)
 ;
"RTN","IBDFDE1",98,0)
MODLIST(I) ; -- list modifiers if in array
"RTN","IBDFDE1",99,0)
 ;
"RTN","IBDFDE1",100,0)
 W !?11,"Selected during Data Entry Modifier(s):    "
"RTN","IBDFDE1",101,0)
 N CODE
"RTN","IBDFDE1",102,0)
 S CODE=$P($G(IBDSEL(I)),"^",2)
"RTN","IBDFDE1",103,0)
 S MOD=0 F  S MOD=$O(IBDSEL(I,"MODIFIER",MOD)) Q:'MOD  D
"RTN","IBDFDE1",104,0)
 .; --quitting if duplicate entry
"RTN","IBDFDE1",105,0)
 . Q:$D(MODSAVE(IBDSEL(I,"MODIFIER",MOD)))
"RTN","IBDFDE1",106,0)
 . S MODSAVE=IBDSEL(I,"MODIFIER",MOD)
"RTN","IBDFDE1",107,0)
 . S XX=$P($$MODP^ICPTMOD(CODE,MODSAVE,"E"),"^",2)
"RTN","IBDFDE1",108,0)
 . W !,?15,MODSAVE,?20,XX
"RTN","IBDFDE1",109,0)
 Q
"RTN","IBDFDE1",110,0)
LEX(VAL) ; -- get output of lexicon entry
"RTN","IBDFDE1",111,0)
 I $D(^LEX)>1 S X="LEXU" X ^%ZOSF("TEST") I $T S VAL=$$ICDONE^LEXU(VAL) S:$L(VAL)<1 VAL=799.9 Q VAL  ;clinical lexicon next version to be in ^LEX
"RTN","IBDFDE1",112,0)
 S X="GMPTU" X ^%ZOSF("TEST") I $T S VAL=$$ICDONE^GMPTU(VAL) S:$L(VAL)<1 VAL=799.9 Q VAL
"RTN","IBDFDE1",113,0)
 Q 799.9
"RTN","IBDFDE1",114,0)
 ;
"RTN","IBDFDE1",115,0)
MAKAPPT ; -- ask make appointment stuff
"RTN","IBDFDE1",116,0)
 N %I,%T,I,J,X,Y,DIC,DA,DIR,DIRUT,DUOUT,IBDFN,RTCLEX,SDALLE,SDATD,SDAV,SDCLN,SDDECOD,SDEC,SDEMP,SDFN,SDHX,SDLOCK,SDMADE,SDNOT,SDOEL,SDPL,SDRE,SDRT,SDSOH,SDT,SDTTM,SDY,VSITON,VSIT,XQXFLG
"RTN","IBDFDE1",117,0)
 ;
"RTN","IBDFDE1",118,0)
 I $G(IBDF("NOAPPT")) G MAKAPQ
"RTN","IBDFDE1",119,0)
 S DIR("?")="Enter 'Yes' to make another appointment for this patient or 'No' if no appointment is to be made."
"RTN","IBDFDE1",120,0)
 S DIR(0)="Y",DIR("A")="Do you wish to make a follow-up appointment for "_$P(^DPT(IBDF("DFN"),0),"^")
"RTN","IBDFDE1",121,0)
 D ^DIR K DIR
"RTN","IBDFDE1",122,0)
 I $D(DUOUT)!($D(DTOUT)) S IBQUIT=1 G MAKAPQ
"RTN","IBDFDE1",123,0)
 I Y<1 G MAKAPQ
"RTN","IBDFDE1",124,0)
 ;
"RTN","IBDFDE1",125,0)
 S (SDFN,IBDFN,DFN)=$G(IBDF("DFN")) ;use same patient, don't ask patient, ask clinic
"RTN","IBDFDE1",126,0)
 ;S SDCLN=IBDF("CLINIC") ;use same clinic, don't ask clinic
"RTN","IBDFDE1",127,0)
 D ^SDM
"RTN","IBDFDE1",128,0)
 S DFN=IBDFN K SDFN
"RTN","IBDFDE1",129,0)
MAKAPQ Q
"RTN","IBDFDE1",130,0)
 ;
"RTN","IBDFDE1",131,0)
ERR ; -- if processing of errors is on do display
"RTN","IBDFDE1",132,0)
 ;    ask if want to re-edit
"RTN","IBDFDE1",133,0)
 N I,J,ERR,LCNT,DIR,DIRUT,DUOUT
"RTN","IBDFDE1",134,0)
 S LCNT=0
"RTN","IBDFDE1",135,0)
 D EW^IBDFBK2(.ERR,.PXCA,.LCNT)
"RTN","IBDFDE1",136,0)
 ;
"RTN","IBDFDE1",137,0)
 W !!!,"The following Error(s) occurred while validating data in PCE for: ",$P($G(^DPT(IBDF("DFN"),0)),"^")
"RTN","IBDFDE1",138,0)
 S I=0 F  S I=$O(ERR(I)) Q:'I  W !?4,$E(ERR(I),1,75)  I $L(ERR(I))>75 W !?10,$E(ERR(I),76,140)
"RTN","IBDFDE1",139,0)
 W !
"RTN","IBDFDE1",140,0)
 Q:$G(IBDF("SAVE"))
"RTN","IBDFDE1",141,0)
 S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Do you want to Re-Edit"
"RTN","IBDFDE1",142,0)
 D ^DIR K DIR
"RTN","IBDFDE1",143,0)
 I Y=1 D
"RTN","IBDFDE1",144,0)
 .S IBDREDIT=1
"RTN","IBDFDE1",145,0)
 .K IBDF("CO"),IBDF("IR"),IBDF("SC"),IBDF("EC"),IBDF("AO")
"RTN","IBDFDE1",146,0)
 .S I=0 F  S I=$O(IBDF(I)) Q:'I  K IBDF(I)
"RTN","IBDFDE1",147,0)
 I $D(DIRUT) S IBQUIT=1
"RTN","IBDFDE1",148,0)
 Q
"RTN","IBDFDE1",149,0)
 ;
"RTN","IBDFDE1",150,0)
DISP ; -- display data based on pxca array
"RTN","IBDFDE1",151,0)
 N I,LST,LCNT
"RTN","IBDFDE1",152,0)
 S LCNT=0
"RTN","IBDFDE1",153,0)
 D LSTDATA^IBDFBK3(.LST,.PXCA,.LCNT)
"RTN","IBDFDE1",154,0)
 W !!!,"The following data was sent to PCE for: ",$P($G(^DPT(IBDF("DFN"),0)),"^")
"RTN","IBDFDE1",155,0)
 W !,?4,"Clinic: ",$P($G(^SC(+$P($G(PXCA("ENCOUNTER")),"^",3),0)),"^")," at ",$$FMTE^XLFDT(+$G(PXCA("ENCOUNTER")))
"RTN","IBDFDE1",156,0)
 S I=0 F  S I=$O(LST(I)) Q:'I  W !?4,$E(LST(I),1,75) I $L(LST(I))>75 W !?10,$E(LST(I),76,140)
"RTN","IBDFDE1",157,0)
 W !
"RTN","IBDFDE1",158,0)
 Q
"RTN","IBDFDE1",159,0)
 ;
"RTN","IBDFDE1",160,0)
FNDAPPT ; -- if form is not associated with an appointment see any in clinic
"RTN","IBDFDE1",161,0)
 I $G(IBDSAEOK) S IBDOK=1 G FNDQ
"RTN","IBDFDE1",162,0)
 N IBDI,IBDJ,X,NODE,CNT,IOINHI,IOINORM,NEWAPPT,CLNAM,FORMLST,DIR,DIRUT,DUOUT,DTOUT
"RTN","IBDFDE1",163,0)
 S X="IOINHI;IOINORM" D ENDR^%ZISS
"RTN","IBDFDE1",164,0)
 S IBDI=$E(IBDF("APPT"),1,7),IBDJ=IBDI+.24,CNT=0
"RTN","IBDFDE1",165,0)
 F  S IBDI=$O(^DPT(DFN,"S",IBDI)) Q:'IBDI!(IBDI>IBDJ)  D  G:CNT<1 FNDQ
"RTN","IBDFDE1",166,0)
 .S NODE=$G(^DPT(DFN,"S",IBDI,0))
"RTN","IBDFDE1",167,0)
 .Q:+NODE'=IBDF("CLINIC")
"RTN","IBDFDE1",168,0)
 .S CNT=CNT+1,CLNAM=$E($P(^SC(IBDF("CLINIC"),0),"^"),1,20),NEWAPPT(CNT)=IBDI
"RTN","IBDFDE1",169,0)
 .I CNT=1 W $C(7),!!,IOINHI,"Warning:","  You are about to create a stand alone visit for: ",IOINORM,!,$E($P(^DPT(DFN,0),"^"),1,25),?27,CLNAM,?49,$$FMTE^XLFDT(IBDF("APPT"))
"RTN","IBDFDE1",170,0)
 .S FORMLST=$$FINDID^IBDF18C(DFN,IBDI,"",1)
"RTN","IBDFDE1",171,0)
 .W !,IOINHI,"Patient has appointment in ",CLNAM,?49,$$FMTE^XLFDT(IBDI)," ID: ",$TR($E(FORMLST,1,($L(FORMLST)-1)),"^",","),IOINORM
"RTN","IBDFDE1",172,0)
 ;
"RTN","IBDFDE1",173,0)
 W ! S IBDOK=$$ASKYN^IBDFDE0("Okay to Create Stand Alone Encounter",0) W !
"RTN","IBDFDE1",174,0)
 I $G(IBDOK)<0 S IBDOK=0
"RTN","IBDFDE1",175,0)
 G:IBDOK FNDQ
"RTN","IBDFDE1",176,0)
 ;
"RTN","IBDFDE1",177,0)
 ; -- ask if want to use appt. date time
"RTN","IBDFDE1",178,0)
 I CNT=1 D
"RTN","IBDFDE1",179,0)
 .S IBDOK=$$ASKYN^IBDFDE0("Okay to use "_$$FMTE^XLFDT(NEWAPPT(1))_" appointment date/time",1) W !
"RTN","IBDFDE1",180,0)
 .I $G(IBDOK)<0 S IBDOK=0
"RTN","IBDFDE1",181,0)
 .I IBDOK S IBDF("APPT")=NEWAPPT(1)
"RTN","IBDFDE1",182,0)
 ;
"RTN","IBDFDE1",183,0)
 I CNT>1 D
"RTN","IBDFDE1",184,0)
 .S DIR("A")=""
"RTN","IBDFDE1",185,0)
 .S DIR(0)=""
"RTN","IBDFDE1",186,0)
FNDQ Q
"RTN","IBDFDE21")
0^11^B78355846
"RTN","IBDFDE21",1,0)
IBDFDE21 ;ALB/AAS - AICS Data Entry, process selection lists ; 11/22/99 4:35pm
"RTN","IBDFDE21",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**4,38**;APR 24, 1997
"RTN","IBDFDE21",3,0)
 ;
"RTN","IBDFDE21",4,0)
% G ^IBDFDE
"RTN","IBDFDE21",5,0)
 ;
"RTN","IBDFDE21",6,0)
SEL(SEL) ; -- Build results array
"RTN","IBDFDE21",7,0)
 N IBDX,DSPTXT,IBQUIT,IBDQL,QCNT,IBDQLFR
"RTN","IBDFDE21",8,0)
 S IBQUIT=0
"RTN","IBDFDE21",9,0)
 ;
"RTN","IBDFDE21",10,0)
 S IBDQL=$$QLFR(.RULE,.QLFR)
"RTN","IBDFDE21",11,0)
 Q:IBQUIT!(IBDQL="^")
"RTN","IBDFDE21",12,0)
 S IBDQLFR=$P(IBDQL,"^",1) D SEL1
"RTN","IBDFDE21",13,0)
 ;
"RTN","IBDFDE21",14,0)
 F QCNT=2:1 S IBDQLFR=$P(IBDQL,"^",QCNT) Q:IBDQLFR=""  D SEL1
"RTN","IBDFDE21",15,0)
 Q
"RTN","IBDFDE21",16,0)
 ;
"RTN","IBDFDE21",17,0)
SEL1 ; -- build selections
"RTN","IBDFDE21",18,0)
 S IBDX=$G(RESULT(0))+1,RESULT(0)=IBDX
"RTN","IBDFDE21",19,0)
 I +SEL=SEL S CHOICE=$$CHOICE^IBDFDE2(SEL)
"RTN","IBDFDE21",20,0)
 I +SEL'=SEL S CHOICE=SEL
"RTN","IBDFDE21",21,0)
 S DISPTXT=$S($P(CHOICE,"^",5)="":$P(CHOICE,"^"),1:$P(CHOICE,"^",5))
"RTN","IBDFDE21",22,0)
 W:+$G(QCNT)<2 "  ",DISPTXT,"   ",$S($P(CHOICE,"^",2)'="":$P(CHOICE,"^",2),$P($G(^IBE(357.6,IBDF("PI"),0)),"^")="GMP INPUT CLINIC COMMON PROBLEMS":$$LEX^IBDFDE1($P(CHOICE,"^",3)),1:$P(CHOICE,"^",3)),"   ",$P(CHOICE,"^",8)_"   ",$P(CHOICE,"^",4)
"RTN","IBDFDE21",23,0)
 ;
"RTN","IBDFDE21",24,0)
 S RESULT(IBDX)=IBDF("PI")_"^"_$P(CHOICE,"^",3)_"^"_DISPTXT_"^"_$P(CHOICE,"^",8)_"^"_$P(CHOICE,"^",6)_"^"_IBDQLFR_"^"_$G(IBDF("IEN"))_"^^"_$P(CHOICE,"^",9)_"^"_$P(CHOICE,"^",2)_"^^"_$P(CHOICE,"^",12)
"RTN","IBDFDE21",25,0)
 S IBDPI(IBDF("PI"),IBDX)=RESULT(IBDX)
"RTN","IBDFDE21",26,0)
 ;
"RTN","IBDFDE21",27,0)
 ; --validate code for active problem list
"RTN","IBDFDE21",28,0)
 I $P($G(^IBE(357.6,IBDF("PI"),0)),"^")="PX INPUT PATIENT ACTIVE PROBLEM" D
"RTN","IBDFDE21",29,0)
 .N X S X=$P(CHOICE,"^",2) Q:X=""
"RTN","IBDFDE21",30,0)
 .I X=799.9 W !,$C(7),IOINHI,"Warning: The ICD9 Diagnosis associated with this problem needs to be updated!",IOINORM Q
"RTN","IBDFDE21",31,0)
 .D TESTICD^IBDFN7
"RTN","IBDFDE21",32,0)
 .I '$D(X) W !,$C(7),IOINHI,"Warning: The ICD9 code associated with this problem is inactive.",IOINORM
"RTN","IBDFDE21",33,0)
 .;I $D(X) W !,"This is a valid icd9 code"
"RTN","IBDFDE21",34,0)
 ;
"RTN","IBDFDE21",35,0)
 ; -- send second and third codes if applicable
"RTN","IBDFDE21",36,0)
 Q:"PRIMARYSECONDARY"'[IBDQLFR
"RTN","IBDFDE21",37,0)
 N I F I=10,11 I $P(CHOICE,"^",I)]"" D
"RTN","IBDFDE21",38,0)
 .S IBDX=$G(RESULT(0))+1,RESULT(0)=IBDX
"RTN","IBDFDE21",39,0)
 .S RESULT(IBDX)=IBDF("PI")_"^"_$P(CHOICE,"^",I)_"^"_DISPTXT_"^"_$P(CHOICE,"^",8)_"^"_$P(CHOICE,"^",6)_"^"_"SECONDARY"_"^"_$G(IBDF("IEN"))_"^^"_$P(CHOICE,"^",9)
"RTN","IBDFDE21",40,0)
 .S IBDPI(IBDF("PI"),IBDX)=RESULT(IBDX)
"RTN","IBDFDE21",41,0)
 ; 
"RTN","IBDFDE21",42,0)
 ; -- if ans contains - go to modifier routine
"RTN","IBDFDE21",43,0)
 I IBDASK="CPT Procedure Code" D MOD^IBDFDE23
"RTN","IBDFDE21",44,0)
 I IBDASK="Visit Type (EM) Code" D MOD^IBDFDE23
"RTN","IBDFDE21",45,0)
 Q
"RTN","IBDFDE21",46,0)
 ;
"RTN","IBDFDE21",47,0)
QLFR(RULE,QLFR) ; -- ask Qualifier from array, impose rules
"RTN","IBDFDE21",48,0)
 N I,X,IBDQ,IBDQ1,QCNT,CNT,ANS,IBDI,OVER,X1,X2,NUM
"RTN","IBDFDE21",49,0)
 S IBDQ="",CNT=0
"RTN","IBDFDE21",50,0)
 ;
"RTN","IBDFDE21",51,0)
 ; -- if only 1 qualifier use it
"RTN","IBDFDE21",52,0)
 I RULE=1 S IBDQ=$G(QLFR(+$O(QLFR(0)))) W "  ",IBDQ G QLFRQ
"RTN","IBDFDE21",53,0)
 ;
"RTN","IBDFDE21",54,0)
 S IBDI=0
"RTN","IBDFDE21",55,0)
 F  S IBDI=$O(QLFR(IBDI)) Q:'IBDI  S X=$G(QLFR(IBDI)) I X'="" D
"RTN","IBDFDE21",56,0)
 .S CNT=CNT+1,X(CNT)=X,X2(X)=X
"RTN","IBDFDE21",57,0)
 .I '$D(X1($E(X),1)) S X1($E(X),1)=X Q
"RTN","IBDFDE21",58,0)
 .S NUM=$O(X1($E(X),""),-1) S X1($E(X),NUM+1)=X
"RTN","IBDFDE21",59,0)
 I CNT=1 S IBDQ=$G(X(CNT)) W "  ",IBDQ G QLFRQ
"RTN","IBDFDE21",60,0)
 ;
"RTN","IBDFDE21",61,0)
 I $D(IBNAQLFR) S ANS=1 S IBDQ=X(ANS)  W !,IOINHI,"Using Default Qualifier: "_X(ANS),IOINORM,! Q IBDQ
"RTN","IBDFDE21",62,0)
OVER1 ;
"RTN","IBDFDE21",63,0)
 I CNT<1 G QLFRQ
"RTN","IBDFDE21",64,0)
 W !,IOINHI,"   Select a Qualifier",IOINORM
"RTN","IBDFDE21",65,0)
 I CNT>1 F I=1:1:CNT I X(I)'="" W !?6,I,?10,X(I)
"RTN","IBDFDE21",66,0)
 W !,"   Choose 1-",CNT,": " R ANS:DTIME
"RTN","IBDFDE21",67,0)
 I '$T!($E(ANS,1)="^") S IBDQ="",IBQUIT=1 G QLFRQ
"RTN","IBDFDE21",68,0)
 I ANS="" G OVER1
"RTN","IBDFDE21",69,0)
 S OVER=0
"RTN","IBDFDE21",70,0)
 I $E(ANS,1)="?" D HELP G OVER1
"RTN","IBDFDE21",71,0)
 I ANS=+ANS D  G:OVER OVER1
"RTN","IBDFDE21",72,0)
 .I ANS<1!(ANS>CNT) S OVER=1 Q
"RTN","IBDFDE21",73,0)
 .I $G(X(ANS))="" S OVER=1 Q
"RTN","IBDFDE21",74,0)
 .S IBDQ=X(ANS) W "  ",X(ANS)
"RTN","IBDFDE21",75,0)
 .W !
"RTN","IBDFDE21",76,0)
 I ANS'=+ANS D  G:OVER OVER1
"RTN","IBDFDE21",77,0)
 .S ANS1=ANS,QCNT=0,IBDQ1=""
"RTN","IBDFDE21",78,0)
 .F IBD=1:1 S ANS=$P(ANS1,",",IBD) Q:ANS=""!OVER  D ONEQLFR I 'OVER,IBDQ'="" S QCNT=QCNT+1,$P(IBDQ1,"^",QCNT)=IBDQ
"RTN","IBDFDE21",79,0)
 .S IBDQ=IBDQ1
"RTN","IBDFDE21",80,0)
 .K QCNT,IBDQ1
"RTN","IBDFDE21",81,0)
 ;
"RTN","IBDFDE21",82,0)
QLFRQ Q IBDQ
"RTN","IBDFDE21",83,0)
 ;
"RTN","IBDFDE21",84,0)
ONEQLFR ; -- parse qualifiers
"RTN","IBDFDE21",85,0)
 S ANS=$$UP^XLFSTR(ANS)
"RTN","IBDFDE21",86,0)
 I +ANS=ANS D  Q
"RTN","IBDFDE21",87,0)
 .I $G(X(ANS))="" W !,"'"_ANS_"' IS NOT A VALID SELECTION, RE-ENTER" S OVER=1 Q
"RTN","IBDFDE21",88,0)
 .S IBDQ=X(ANS) W "  ",X(ANS)
"RTN","IBDFDE21",89,0)
 ;
"RTN","IBDFDE21",90,0)
 I $L(ANS)=1,$G(X1(ANS,1))'="",$O(X1(ANS,1))="" S IBDQ=X1(ANS,1) W:ANS=ANS1 $E(X1(ANS,1),2,99) W:ANS'=ANS1 "  ",X1(ANS,1) Q
"RTN","IBDFDE21",91,0)
 I $G(X2(ANS))'="" S IBDQ=X2(ANS) W "  ",X2(ANS) Q
"RTN","IBDFDE21",92,0)
 I $L(ANS)=1,$G(X1(ANS,1))'="",$O(X1(ANS,1)) S OVER=1 W "  Ambiguous answer, enter the number." Q  ;S IBDQ=$$PARTLST("X1",ANS,ANS) W $E(X1(ANS,1),2,99) Q
"RTN","IBDFDE21",93,0)
 S OVER=1
"RTN","IBDFDE21",94,0)
 Q
"RTN","IBDFDE21",95,0)
 ;
"RTN","IBDFDE21",96,0)
LST ; -- List previous selections and selections to choose from.
"RTN","IBDFDE21",97,0)
 N I,CNT,IBQUIT,NUM
"RTN","IBDFDE21",98,0)
 ;
"RTN","IBDFDE21",99,0)
 ; -- list previous selections
"RTN","IBDFDE21",100,0)
 D PREVSEL
"RTN","IBDFDE21",101,0)
 ;
"RTN","IBDFDE21",102,0)
 ; -- list available choices
"RTN","IBDFDE21",103,0)
 S (IBQUIT,CNT)=0
"RTN","IBDFDE21",104,0)
 S NUM=+$$CHOICE^IBDFDE2(0)
"RTN","IBDFDE21",105,0)
 W !!,"Choose from: "
"RTN","IBDFDE21",106,0)
 S I=0 F  S I=$O(^TMP("IBD-LST",$J,IBDFMIEN,IBDF("PI"),IBDF("IEN"),I)) Q:'I!(IBQUIT)  D
"RTN","IBDFDE21",107,0)
 .S CHOICE=$$CHOICE^IBDFDE2(I)
"RTN","IBDFDE21",108,0)
 .I '$P(CHOICE,"^",7) W !?16,IOINHI,$P(CHOICE,"^"),IOINORM Q
"RTN","IBDFDE21",109,0)
 .S CNT=CNT+1,NUMBER(CNT)=I
"RTN","IBDFDE21",110,0)
 .W !?3,CNT,?7,$S($P(CHOICE,"^",2)'="":$P(CHOICE,"^",2),1:$P(CHOICE,"^",3)),?16,$P(CHOICE,"^",1)
"RTN","IBDFDE21",111,0)
 .I NUM>15,NUM>I,'(CNT#15) D PAUSE^IBDFDE I 'IBQUIT W $C(13),$J("",55),$C(13)
"RTN","IBDFDE21",112,0)
 .;I NUM>15,CNT'=NUM,'(CNT#15) D READ I $G(LISTSEL)<1!($G(LISTSEL)>CNT) K LISTSEL
"RTN","IBDFDE21",113,0)
 .;I $G(LISTSEL) S SEL=NUMBER(LISTSEL)
"RTN","IBDFDE21",114,0)
 Q
"RTN","IBDFDE21",115,0)
 ;
"RTN","IBDFDE21",116,0)
PREVSEL ; -- List previous selections
"RTN","IBDFDE21",117,0)
 N I,CNT
"RTN","IBDFDE21",118,0)
 S CNT=0
"RTN","IBDFDE21",119,0)
 ;
"RTN","IBDFDE21",120,0)
 ; -- list previous selections
"RTN","IBDFDE21",121,0)
 I $D(IBDPI(IBDF("PI")))>1 S I=0 F  S I=$O(IBDPI(IBDF("PI"),I)) Q:'I  D
"RTN","IBDFDE21",122,0)
 .Q:$P(IBDPI(IBDF("PI"),I),"^",7)'=IBDF("IEN")  ; not the same list
"RTN","IBDFDE21",123,0)
 .S CNT=CNT+1
"RTN","IBDFDE21",124,0)
 .W:CNT=1 !!,IOINHI,"   You have previously selected: ",IOINORM
"RTN","IBDFDE21",125,0)
 .W !,?7,$S($P($G(^IBE(357.6,+IBDPI(IBDF("PI"),I),0)),"^")="GMP INPUT CLINIC COMMON PROBLEMS":$$LEX^IBDFDE1($P(IBDPI(IBDF("PI"),I),"^",2)),1:$P(IBDPI(IBDF("PI"),I),"^",2))
"RTN","IBDFDE21",126,0)
 .W ?16,$P(IBDPI(IBDF("PI"),I),"^",3),?50,$P(IBDPI(IBDF("PI"),I),"^",6)
"RTN","IBDFDE21",127,0)
 W !
"RTN","IBDFDE21",128,0)
 Q
"RTN","IBDFDE21",129,0)
 ;
"RTN","IBDFDE21",130,0)
DEFAULT ; -- compute default answer
"RTN","IBDFDE21",131,0)
 N CNT,SEL,NAME,PIECE,SELAST
"RTN","IBDFDE21",132,0)
 S (CNT,SEL,SELAST)=0
"RTN","IBDFDE21",133,0)
 S NAME=$P($G(^IBE(357.6,+IBDF("PI"),0)),"^")
"RTN","IBDFDE21",134,0)
 S PIECE=$S(NAME["INPUT PROCEDURE CODE":2,NAME["INPUT DIAGNOSIS CODE":2,NAME["INPUT VISIT TYPE":2,1:3)
"RTN","IBDFDE21",135,0)
 F  S SEL=$O(IBDPI(IBDF("PI"),SEL)) Q:'SEL  D
"RTN","IBDFDE21",136,0)
 .Q:$P(IBDPI(IBDF("PI"),SEL),"^",7)'=IBDF("IEN")  ; not the same list
"RTN","IBDFDE21",137,0)
 .S CNT=CNT+1,SELAST=SEL
"RTN","IBDFDE21",138,0)
 I $G(SELAST) S DIR("B")=$P(IBDPI(IBDF("PI"),SELAST),"^",PIECE),IBDEFLT(IBDF("PI"))=DIR("B")
"RTN","IBDFDE21",139,0)
 D PREVSEL
"RTN","IBDFDE21",140,0)
 Q
"RTN","IBDFDE21",141,0)
 ;
"RTN","IBDFDE21",142,0)
DEFPROV ; -- find default provider, not on form
"RTN","IBDFDE21",143,0)
 N SEL,IBDX
"RTN","IBDFDE21",144,0)
 S IBDF("PI")=$O(^IBE(357.6,"B","INPUT PROVIDER",0))
"RTN","IBDFDE21",145,0)
 Q:$D(IBDPI(IBDF("PI")))
"RTN","IBDFDE21",146,0)
 S SEL=$G(IBDF("PROVIDER")) I 'SEL S SEL=$$PRDEF^IBDFRPC3(IBDF("CLINIC"))
"RTN","IBDFDE21",147,0)
 Q:'SEL
"RTN","IBDFDE21",148,0)
 S $P(IBDF("PROVIDER PI"),"^",2)=1 ;flag not on form
"RTN","IBDFDE21",149,0)
 S IBDX=$G(IBDSEL(0))+1,IBDSEL(0)=IBDX
"RTN","IBDFDE21",150,0)
 S IBDSEL(IBDX)=IBDF("PI")_"^"_SEL_"^"_$P($G(^VA(200,+SEL,0)),"^")_"^^^PRIMARY^"
"RTN","IBDFDE21",151,0)
 S IBDPI(IBDF("PI"),IBDX)=IBDSEL(IBDX)
"RTN","IBDFDE21",152,0)
 W:'$G(IBDF("PROVIDER")) !!,"No Provider Block on form.  Using Default Provider from Clinic as Primary.",!
"RTN","IBDFDE21",153,0)
 W:$G(IBDF("PROVIDER")) !!,"Using Provider: "
"RTN","IBDFDE21",154,0)
 W "   ",$P(^VA(200,+SEL,0),"^"),"    PRIMARY",!
"RTN","IBDFDE21",155,0)
 Q
"RTN","IBDFDE21",156,0)
 ;
"RTN","IBDFDE21",157,0)
HELP ; -- 
"RTN","IBDFDE21",158,0)
 W !,"You must choose a data qualifier for this item.  Enter a number from 1-",CNT,!,"Or enter the first letter, or enter the full name.  Enter more than one",!,"qualifier separated by commas (ie 1,2 or P,A).",!
"RTN","IBDFDE21",159,0)
 Q
"RTN","IBDFDE21",160,0)
 ;
"RTN","IBDFDE21",161,0)
OTHER(IBDX) ; -- allow input of an additional item
"RTN","IBDFDE21",162,0)
 N I,J,X,Y,DIR,DIRUT,DUOUT,SEL,SELX,NARR,DIC,DIE,DA,DR,GMPTUN,GMPTSUB,GMPTSHOW,XTLKGLB,XTLKHLP,XTLKKSCH,XTLKSAY,IBDLEX,IBDFILE
"RTN","IBDFDE21",163,0)
 ;
"RTN","IBDFDE21",164,0)
 ; -- strip the cpt code if modifiers are added cpt-mod,mod,mod...
"RTN","IBDFDE21",165,0)
 ;
"RTN","IBDFDE21",166,0)
 I IBDX["-" S IBDX=$P(IBDX,"-")
"RTN","IBDFDE21",167,0)
 I $G(IBDF("LEXICON")) D  Q:'$D(IBDLEX)
"RTN","IBDFDE21",168,0)
 .I $D(^LEX)>1 S X="LEXSET" X ^%ZOSF("TEST") I $T D CONFIG^LEXSET("ICD","ICD") S IBDLEX=1
"RTN","IBDFDE21",169,0)
 .I '$D(IBDLEX) S X="GMPTSET" X ^%ZOSF("TEST") I $T D CONFIG^GMPTSET("GMPL","PL1") S IBDLEX=1
"RTN","IBDFDE21",170,0)
 .;D CONFIG^GMPTSET("ICD","ICD") (this is an alternate filter)
"RTN","IBDFDE21",171,0)
 S SELX=-1
"RTN","IBDFDE21",172,0)
 I '$G(IBDF("OTHER")) G OTHQ
"RTN","IBDFDE21",173,0)
 I $L($G(IBDX)) S X=IBDX S DIC(0)="EQMZ"
"RTN","IBDFDE21",174,0)
 S DIC("A")="Select Other "_$G(IBDASK)
"RTN","IBDFDE21",175,0)
 S DIC=$P(IBDF("OTHER"),"^") I $P(IBDF("OTHER"),"^",2)'="" S DIC("S")=$P(IBDF("OTHER"),"^",2,99)
"RTN","IBDFDE21",176,0)
 D ^DIC G OTHQ:+Y<1
"RTN","IBDFDE21",177,0)
 K DIC
"RTN","IBDFDE21",178,0)
 S SEL=Y
"RTN","IBDFDE21",179,0)
 W !!,$C(7),"WARNING: Item selected not from Encounter Form."
"RTN","IBDFDE21",180,0)
 ;
"RTN","IBDFDE21",181,0)
 I IBDF("PI")=$G(IBDF("PROVIDER PI")) W ! S SELX=$P($G(^VA(200,+Y,0)),"^",1)_"^^"_+Y_"^^^^1" G OTHQ
"RTN","IBDFDE21",182,0)
 ;
"RTN","IBDFDE21",183,0)
 W "...Entry of Narrative Required!",!
"RTN","IBDFDE21",184,0)
 S IBDFILE=+IBDF("OTHER")
"RTN","IBDFDE21",185,0)
 S:IBDFILE=81 DIR("B")=$P(Y(0),"^",2)
"RTN","IBDFDE21",186,0)
 ;S:IBDFILE=80 DIR("B")=$P(Y(0),"^",3)
"RTN","IBDFDE21",187,0)
 S:IBDFILE=80 DIR("B")=$S($L($G(^ICD9(+Y,1)))<81:^ICD9(+Y,1),1:$P(Y(0),"^",3))
"RTN","IBDFDE21",188,0)
 S:IBDFILE=357.69 DIR("B")=$P(Y(0),"^",3)
"RTN","IBDFDE21",189,0)
 I IBDFILE>9999999,IBDFILE<10000000 S DIR("B")=$P(Y(0),"^",1)
"RTN","IBDFDE21",190,0)
 S DIR(0)="FO^3:80",DIR("A")="Narrative" D ^DIR K DIR G:$G(DIRUT) OTHQ
"RTN","IBDFDE21",191,0)
 S NARR=Y
"RTN","IBDFDE21",192,0)
 ;
"RTN","IBDFDE21",193,0)
 S SELX=$S((IBDFILE<9999999)&(IBDFILE'=757.01):NARR_"^^"_$P(SEL,"^",2)_"^^^^1",1:NARR_"^^"_$P(SEL,"^",1)_"^^^^1")
"RTN","IBDFDE21",194,0)
OTHQ Q $S(SELX=-1:"",1:SELX)
"RTN","IBDFDE21",195,0)
 ;
"RTN","IBDFDE21",196,0)
PARTLST(ARY,NEXT,ANS) ; -- input has more than one match, prompt for which one
"RTN","IBDFDE21",197,0)
 N I,J,K,N,IBD,ANS2,SEL,CHOICE
"RTN","IBDFDE21",198,0)
 S SEL=0
"RTN","IBDFDE21",199,0)
 S NEXT=$E(NEXT,1,$L(NEXT)-1)_$C($A($E(NEXT,$L(NEXT)))-1)_"~"
"RTN","IBDFDE21",200,0)
 ;
"RTN","IBDFDE21",201,0)
 S J=0,K=NEXT F  S K=$O(@ARY@(K)) Q:$E(K,1,$L(ANS))'=ANS  D
"RTN","IBDFDE21",202,0)
 .S N=0 F  S N=$O(@ARY@(K,N)) Q:'N  D
"RTN","IBDFDE21",203,0)
 ..S J=J+1,IBD(J)=@ARY@(K,N),CHOICE=$$CHOICE^IBDFDE2(IBD(J))
"RTN","IBDFDE21",204,0)
 ..W !?6,J,?10,$S($P(CHOICE,"^",2)'="":$P(CHOICE,"^",2),1:$P(CHOICE,"^",3)),?20,$P(CHOICE,"^",1),?50,"   ",$P(CHOICE,"^",8),"   ",$P(CHOICE,"^",4)
"RTN","IBDFDE21",205,0)
 ;
"RTN","IBDFDE21",206,0)
ASKNUM I J<1 G PARTLQ
"RTN","IBDFDE21",207,0)
 W !,"   Choose 1-",J,": " R ANS2:DTIME
"RTN","IBDFDE21",208,0)
 I '$T!($E(ANS2,1)="^")!(ANS2="") S SEL="" G PARTLQ
"RTN","IBDFDE21",209,0)
 I $E(ANS2,1)="?" W !,"Enter a number from 1 - ",J G ASKNUM
"RTN","IBDFDE21",210,0)
 S ANS2=+ANS2
"RTN","IBDFDE21",211,0)
 I ANS2<1!(ANS2>J) G ASKNUM
"RTN","IBDFDE21",212,0)
 I $G(IBD(ANS2))="" G ASKNUM
"RTN","IBDFDE21",213,0)
 W !
"RTN","IBDFDE21",214,0)
 S SEL=$G(IBD(ANS2))
"RTN","IBDFDE21",215,0)
PARTLQ Q SEL
"RTN","IBDFDE21",216,0)
 ;
"RTN","IBDFDE21",217,0)
READ ; -- get input from list
"RTN","IBDFDE21",218,0)
 N ANS2
"RTN","IBDFDE21",219,0)
 G:CNT<1 READQ
"RTN","IBDFDE21",220,0)
 W !,"   Choose 1-",CNT,": " R ANS2:DTIME
"RTN","IBDFDE21",221,0)
 I '$T!($E(ANS2,1)="^") S IBQUIT=1 G READQ
"RTN","IBDFDE21",222,0)
 I $E(ANS2,1)="?" W !,"Enter a number from 1 - ",CNT," or return to see more." G READ
"RTN","IBDFDE21",223,0)
 S ANS2=+ANS2
"RTN","IBDFDE21",224,0)
 I ANS2<1!(ANS2>CNT) W $C(7),! G READ
"RTN","IBDFDE21",225,0)
 I $G(NUMBER(CNT))="" G READ
"RTN","IBDFDE21",226,0)
 W !
"RTN","IBDFDE21",227,0)
READQ Q
"RTN","IBDFDE23")
0^21^B4887413
"RTN","IBDFDE23",1,0)
IBDFDE23 ;ALB/DHH - Select CPT Modifiers during Manual Data Entry ; MAY-18-1999
"RTN","IBDFDE23",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDFDE23",3,0)
MOD ;Entry point for selecting or modifying modifiers
"RTN","IBDFDE23",4,0)
 ;
"RTN","IBDFDE23",5,0)
 ;  -- called by IBDFDE21
"RTN","IBDFDE23",6,0)
 ;
"RTN","IBDFDE23",7,0)
 N CODE,I,X,SEL,MOD,Y,CNT,MODLST
"RTN","IBDFDE23",8,0)
 ;
"RTN","IBDFDE23",9,0)
 ;-- result is definition is noted in ^ibdfde2
"RTN","IBDFDE23",10,0)
 ;   result:= pckg interface^code to send^text to send...
"RTN","IBDFDE23",11,0)
 ;
"RTN","IBDFDE23",12,0)
 S CODE=$P(RESULT(IBDX),"^",2)
"RTN","IBDFDE23",13,0)
 ;
"RTN","IBDFDE23",14,0)
 ; --ans = list number, cpt, or cpt-mod,mod (raw data user enters)
"RTN","IBDFDE23",15,0)
 ; if ans contains "-" then seperate and validate each cpt modifier pair
"RTN","IBDFDE23",16,0)
 ; if ans contains "-" ans should = cpt-mod,mod,mod...
"RTN","IBDFDE23",17,0)
 ; else  ask for modifiers 
"RTN","IBDFDE23",18,0)
 ; 
"RTN","IBDFDE23",19,0)
 I ANS["-" D
"RTN","IBDFDE23",20,0)
 .S MODLST=$P(ANS,"-",2)
"RTN","IBDFDE23",21,0)
 .F I=1:1 S X=$P(MODLST,",",I) Q:X']""  D
"RTN","IBDFDE23",22,0)
 ..; --check for appropriate modifiers/cpt matches
"RTN","IBDFDE23",23,0)
 ..;   cpts and modifiers can be input as 
"RTN","IBDFDE23",24,0)
 ..;      -- cpt-mod,mod,mod
"RTN","IBDFDE23",25,0)
 ..;   if multiple modifiers were entered with cpt, each cpt-mod pair
"RTN","IBDFDE23",26,0)
 ..;   will be checked by modp^icptmod to see if valid.  if not, an
"RTN","IBDFDE23",27,0)
 ..;   error message will be displayed for the invalid code pair
"RTN","IBDFDE23",28,0)
 ..;
"RTN","IBDFDE23",29,0)
 .. I $$MODP^ICPTMOD(CODE,X)'>0 D ERR Q
"RTN","IBDFDE23",30,0)
 .. S SEL("MOD",X)=""
"RTN","IBDFDE23",31,0)
 ;
"RTN","IBDFDE23",32,0)
 ;  --no matter what method user uses to input data modifiers should
"RTN","IBDFDE23",33,0)
 ;    should be asked for each cpt code
"RTN","IBDFDE23",34,0)
 ;
"RTN","IBDFDE23",35,0)
 D OTHER,ARRAY
"RTN","IBDFDE23",36,0)
 Q
"RTN","IBDFDE23",37,0)
 ;
"RTN","IBDFDE23",38,0)
OTHER ;--allow for additional modifiers to be selected
"RTN","IBDFDE23",39,0)
 N DIC
"RTN","IBDFDE23",40,0)
 F  S DIC=81.3,DIC("S")="I ($$MODP^ICPTMOD(CODE,+Y,""I""))>0",DIC(0)="AEMQ" D ^DIC Q:+Y<1  D
"RTN","IBDFDE23",41,0)
 . S MOD=$P($G(Y),"^",2)
"RTN","IBDFDE23",42,0)
 . I $D(SEL("MOD",MOD)) D DELMOD Q:Y=1
"RTN","IBDFDE23",43,0)
 . S:MOD'="" SEL("MOD",MOD)=""
"RTN","IBDFDE23",44,0)
 Q
"RTN","IBDFDE23",45,0)
DELMOD ; Delete modifier from list if duplicate entry
"RTN","IBDFDE23",46,0)
 N DIR,DA,DR,DIC
"RTN","IBDFDE23",47,0)
 W !,"Do you want to remove this modifier as being Associated with this CPT Procedure?"
"RTN","IBDFDE23",48,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR Q:$D(DIRUT)
"RTN","IBDFDE23",49,0)
 I Y=1 K SEL("MOD",MOD)
"RTN","IBDFDE23",50,0)
 Q
"RTN","IBDFDE23",51,0)
ARRAY ; -- transfer modifier data to result array
"RTN","IBDFDE23",52,0)
 Q:'$D(SEL)
"RTN","IBDFDE23",53,0)
 S MOD="",CNT=0 F  S MOD=$O(SEL("MOD",MOD)) Q:MOD']""  D
"RTN","IBDFDE23",54,0)
 . S CNT=CNT+1
"RTN","IBDFDE23",55,0)
 . S RESULT(IBDX,"MODIFIER",CNT)=MOD
"RTN","IBDFDE23",56,0)
 S RESULT(IBDX,"MODIFIER",0)=CNT
"RTN","IBDFDE23",57,0)
 Q
"RTN","IBDFDE23",58,0)
 ;
"RTN","IBDFDE23",59,0)
ERR ;Error message
"RTN","IBDFDE23",60,0)
 W !,X," is not a valid modifier for ",CODE,!
"RTN","IBDFDE23",61,0)
 Q
"RTN","IBDFFRFT")
0^13^B32830943
"RTN","IBDFFRFT",1,0)
IBDFFRFT ;ALB/CMR - AICS Free Forms Tracking Entry ; 27-MAR-97
"RTN","IBDFFRFT",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**15,38**;APR 24, 1997
"RTN","IBDFFRFT",3,0)
 ;
"RTN","IBDFFRFT",4,0)
 ; -- modified 10/7/97 to allow background freeing via site parameter
"RTN","IBDFFRFT",5,0)
 ;
"RTN","IBDFFRFT",6,0)
FREEFT ; -- called to pass data from FT to PCE regardless of whether all
"RTN","IBDFFRFT",7,0)
 ;    pages have been received.
"RTN","IBDFFRFT",8,0)
 ;
"RTN","IBDFFRFT",9,0)
 N FORMTYPE,IBFID,IBD,IBNODE,DFN,CLINIC,APPT,Y,PXCA,AUPNDAYS,AUPNDOB,AUPNDOD,AUPNPAT,AUPNSEX,CNT,ORVP,PXCAVSIT,RESULT,SDFN
"RTN","IBDFFRFT",10,0)
 D EN^VALM2($G(XQORNOD(0)))
"RTN","IBDFFRFT",11,0)
 I $D(VALMY) D FULL^VALM1 S IBD=0 F  S IBD=$O(VALMY(IBD)) Q:'IBD!$D(DIRUT)  D
"RTN","IBDFFRFT",12,0)
 .S IBFID=$P($G(^TMP("FRMIDX",$J,+IBD)),"^",2)
"RTN","IBDFFRFT",13,0)
 .S IBNODE=$G(^IBD(357.96,+IBFID,0)) I IBNODE="" W !,"No Form Tracking record associated with entry #",IBD H 2 Q
"RTN","IBDFFRFT",14,0)
 .I '$D(^XUSEC("IBD MANAGER",DUZ)) W !,"You must hold the IBD MANAGER key to free Forms Tracking entries" H 2 Q
"RTN","IBDFFRFT",15,0)
 .I $P(IBNODE,"^",11)'=11 W !,"You may only pass data to PCE if the current status is PENDING PAGES" H 2 Q
"RTN","IBDFFRFT",16,0)
 .S DFN=$P(IBNODE,"^",2),APPT=$P(IBNODE,"^",3),CLINIC=$P(IBNODE,"^",10)
"RTN","IBDFFRFT",17,0)
 .;
"RTN","IBDFFRFT",18,0)
 .; -- display ft data
"RTN","IBDFFRFT",19,0)
 .W !!,"PATIENT: ",$P($G(^DPT(DFN,0)),"^"),"    APPT DATE/TIME: ",$$FMTE^XLFDT(APPT,2),!,"CLINIC:  ",$P($G(^SC(CLINIC,0)),"^"),!
"RTN","IBDFFRFT",20,0)
 .;
"RTN","IBDFFRFT",21,0)
 .; -- display page data
"RTN","IBDFFRFT",22,0)
 .S I=0 F  S I=$O(^IBD(357.96,IBFID,9,I)) Q:'I  S IBNODE=$G(^IBD(357.96,IBFID,9,I,0)) W !?5,"Page ",$P(IBNODE,"^")," ",$S(+$P(IBNODE,"^",2):"Received",1:"Not Received")
"RTN","IBDFFRFT",23,0)
 .W ! S DIR(0)="Y",DIR("A")="Okay to continue",DIR("B")="Y" D ^DIR K DIR Q:'Y
"RTN","IBDFFRFT",24,0)
 .D SEND(IBFID)
"RTN","IBDFFRFT",25,0)
 ;
"RTN","IBDFFRFT",26,0)
 D EXIT1^IBDFFT,START^IBDFFT1
"RTN","IBDFFRFT",27,0)
 S VALMBCK="R"
"RTN","IBDFFRFT",28,0)
 Q
"RTN","IBDFFRFT",29,0)
 ;
"RTN","IBDFFRFT",30,0)
SEND(IBFID,ERRCNT) ; -- send all page data in forms tracking
"RTN","IBDFFRFT",31,0)
 ;
"RTN","IBDFFRFT",32,0)
 ; -- gather data from previously stored pages
"RTN","IBDFFRFT",33,0)
 S I=0 F  S I=$O(^IBD(357.96,IBFID,10,I)) Q:'I  D ARYAD^IBDFBKR($G(^IBD(357.96,IBFID,10,I,0)))
"RTN","IBDFFRFT",34,0)
 ;
"RTN","IBDFFRFT",35,0)
 ; -- send data to pce
"RTN","IBDFFRFT",36,0)
 W:'$D(ZTQUEUED) !,"Sending Data to PCE..."
"RTN","IBDFFRFT",37,0)
 S RESULT=$$SEND^IBDF18E(IBFID,"","",.BUBBLES,.HANDPRNT,"",.PXCA,.DYNAMIC)
"RTN","IBDFFRFT",38,0)
 W:'$D(ZTQUEUED) $S(RESULT:"Successfull",1:"Unsuccessful")
"RTN","IBDFFRFT",39,0)
 ;
"RTN","IBDFFRFT",40,0)
 ; -- process any returned errors/warnings
"RTN","IBDFFRFT",41,0)
 I $D(PXCA("ERROR"))!($D(PXCA("WARNING"))) D
"RTN","IBDFFRFT",42,0)
 .N I,J,ERR,LCNT,DIR,DIRUT,DUOUT
"RTN","IBDFFRFT",43,0)
 .S LCNT=0,ERRCNT=$G(ERRCNT)+1
"RTN","IBDFFRFT",44,0)
 .D EW^IBDFBK2(.ERR,.PXCA,.LCNT)
"RTN","IBDFFRFT",45,0)
 .;
"RTN","IBDFFRFT",46,0)
 .W:'$D(ZTQUEUED) !!!,"The following Error(s) occurred while validating data in PCE for: ",$P($G(^DPT(DFN,0)),"^")
"RTN","IBDFFRFT",47,0)
 .Q:$D(ZTQUEUED)
"RTN","IBDFFRFT",48,0)
 .S I=0 F  S I=$O(ERR(I)) Q:'I  W !?4,$E(ERR(I),1,75)  I $L(ERR(I))>75 W !?10,$E(ERR(I),76,140)
"RTN","IBDFFRFT",49,0)
 .W !!
"RTN","IBDFFRFT",50,0)
 Q
"RTN","IBDFFRFT",51,0)
 ;
"RTN","IBDFFRFT",52,0)
BCKGRND ; -- entry point for back ground job to process pending pages
"RTN","IBDFFRFT",53,0)
 ;
"RTN","IBDFFRFT",54,0)
 N DAYS,START,END
"RTN","IBDFFRFT",55,0)
 S DAYS=+$P($G(^IBD(357.09,1,0)),"^",11)
"RTN","IBDFFRFT",56,0)
 ;
"RTN","IBDFFRFT",57,0)
 Q:'DAYS
"RTN","IBDFFRFT",58,0)
 S ERRCNT=0
"RTN","IBDFFRFT",59,0)
 S START=DAYS+7
"RTN","IBDFFRFT",60,0)
 S START=$$FMADD^XLFDT(DT,-START)
"RTN","IBDFFRFT",61,0)
 S END=$$FMADD^XLFDT(DT,-DAYS)+.24
"RTN","IBDFFRFT",62,0)
 ;
"RTN","IBDFFRFT",63,0)
B1 N CNT,ERRCNT,IBFID,STATUS
"RTN","IBDFFRFT",64,0)
 F  S START=$O(^IBD(357.96,"D",START)) Q:'START!(START>END)  D
"RTN","IBDFFRFT",65,0)
 .S IBFID=0
"RTN","IBDFFRFT",66,0)
 .F  S IBFID=$O(^IBD(357.96,"D",START,IBFID)) Q:'IBFID  D
"RTN","IBDFFRFT",67,0)
 ..S STATUS=$P($G(^IBD(357.96,IBFID,0)),"^",11)
"RTN","IBDFFRFT",68,0)
 ..I STATUS=11 S CNT=$G(CNT)+1 D SEND(IBFID,.ERRCNT)
"RTN","IBDFFRFT",69,0)
 ;
"RTN","IBDFFRFT",70,0)
 D:$G(MANUAL) BULL
"RTN","IBDFFRFT",71,0)
 I $D(ZTQUEUED),$G(MANUAL) S ZTREQ="@"
"RTN","IBDFFRFT",72,0)
 Q
"RTN","IBDFFRFT",73,0)
 ;
"RTN","IBDFFRFT",74,0)
BULL ; -- add bulletin or something to let people know what was done
"RTN","IBDFFRFT",75,0)
 ;    but only if they ask for it during testing.
"RTN","IBDFFRFT",76,0)
 ;
"RTN","IBDFFRFT",77,0)
 S IBD(1)="The background job to release pending pages has completed"
"RTN","IBDFFRFT",78,0)
 S IBD(2)=""
"RTN","IBDFFRFT",79,0)
 S IBD(3)="   Number of Forms Tracking Entries: "_+$G(CNT)
"RTN","IBDFFRFT",80,0)
 S IBD(4)="  Number of Forms Generating Errors: "_+$G(ERRCNT)
"RTN","IBDFFRFT",81,0)
 S XMSUB="AICS RELEASE PENDING PAGES"
"RTN","IBDFFRFT",82,0)
 S XMDUZ="AICS PACKAGE",XMTEXT="IBD("
"RTN","IBDFFRFT",83,0)
 K XMY S XMN=0
"RTN","IBDFFRFT",84,0)
 S XMY(DUZ)=""
"RTN","IBDFFRFT",85,0)
 D ^XMD
"RTN","IBDFFRFT",86,0)
 K X,Y,IBD,XMDUZ,XMTEXT,XMY,XMSUB,XMN
"RTN","IBDFFRFT",87,0)
 Q
"RTN","IBDFFRFT",88,0)
 ;
"RTN","IBDFFRFT",89,0)
MANUAL ; -- entry point for sending pending pages to PCE for a date range
"RTN","IBDFFRFT",90,0)
 ;    get date range and do b1
"RTN","IBDFFRFT",91,0)
 ;
"RTN","IBDFFRFT",92,0)
 W !!,"Option to Manually send Encounter Forms in a Pending Pages Status in Forms"
"RTN","IBDFFRFT",93,0)
 W !,"Tracking to PCE by Encounter date range.",!!
"RTN","IBDFFRFT",94,0)
 ;
"RTN","IBDFFRFT",95,0)
 S MANUAL=1
"RTN","IBDFFRFT",96,0)
 S DAYS=+$P($G(^IBD(357.09,1,0)),"^",11)
"RTN","IBDFFRFT",97,0)
 S HELP="Enter a START date.  This is an exact date and should be in the past."
"RTN","IBDFFRFT",98,0)
 S START=$$ASKDT("Start Date: ","T-"_(60+DAYS),"AEPQX","",DT,.HELP,"D SHELP^IBDFFRFT")
"RTN","IBDFFRFT",99,0)
 I START<1 G MQ
"RTN","IBDFFRFT",100,0)
 S HELP="Enter the END date.  This must be after the start date an before today."
"RTN","IBDFFRFT",101,0)
 S END=$$ASKDT("End Date: ","T-"_$S(DAYS:DAYS,1:15),"AEQX",START,DT,.HELP,"D EHELP^IBDFFRFT")
"RTN","IBDFFRFT",102,0)
 I END<1!(END<START) G MQ
"RTN","IBDFFRFT",103,0)
 S ZTRTN="B1^IBDFFRFT",ZTSAVE("START")="",ZTSAVE("END")="",ZTSAVE("DAYS")="",ZTSAVE("MANUAL")=""
"RTN","IBDFFRFT",104,0)
 S ZTDESC="IBD-FREE FORMS TRACKING OF PENDING PAGES"
"RTN","IBDFFRFT",105,0)
 S ZTIO=""
"RTN","IBDFFRFT",106,0)
 W !!,"This option must be queued.  No Device is Necessary."
"RTN","IBDFFRFT",107,0)
 W !,"A mail message will be sent when the process has completed.",!!
"RTN","IBDFFRFT",108,0)
 D ^%ZTLOAD
"RTN","IBDFFRFT",109,0)
MQ K X,Y,IBD,DAYS,START,END,MANUAL,HELP,ZTSK,ZTRTN,ZTSAVE,ZTSAVE,ZTDESC,ZTIO
"RTN","IBDFFRFT",110,0)
 Q
"RTN","IBDFFRFT",111,0)
 ;
"RTN","IBDFFRFT",112,0)
EHELP ; -- help for the end date prompt
"RTN","IBDFFRFT",113,0)
 W !,"Enter the END date.  This is an Encounter Date."
"RTN","IBDFFRFT",114,0)
 W !,"This is the last date that forms that are in a Pending Pages Status in Forms"
"RTN","IBDFFRFT",115,0)
 W !,"Tracking will be automatically sent to PCE for processing."
"RTN","IBDFFRFT",116,0)
 Q
"RTN","IBDFFRFT",117,0)
 ;
"RTN","IBDFFRFT",118,0)
SHELP ; -- help for start date prompt
"RTN","IBDFFRFT",119,0)
 W !,"Enter the START date.  This is an Encounter Date."
"RTN","IBDFFRFT",120,0)
 W !,"This is the date that you want to start the process that sends forms that"
"RTN","IBDFFRFT",121,0)
 W !,"are in a Pending Pages Status in Forms Tracking entries to PCE to start on."
"RTN","IBDFFRFT",122,0)
 Q
"RTN","IBDFFRFT",123,0)
 ;
"RTN","IBDFFRFT",124,0)
ASKDT(QUES,DEFLT,PARAM,EARLY,LATEST,HELP,EXHELP) ; -- ask date questions
"RTN","IBDFFRFT",125,0)
 N X,Y,DIR,DIRUT,DTOUT,DUOUT,IBQUIT
"RTN","IBDFFRFT",126,0)
 S DIR(0)="DOA^"_$E($G(EARLY),1,7)_":"_$G(LATEST)_":"_$S($G(PARAM)'="":PARAM,1:"AEQRX")
"RTN","IBDFFRFT",127,0)
 I $G(QUES)'="" S DIR("A")=QUES
"RTN","IBDFFRFT",128,0)
 I $G(DEFLT)'="" S DIR("B")=DEFLT
"RTN","IBDFFRFT",129,0)
 I $L($G(EXHELP)) S DIR("??")="^"_EXHELP
"RTN","IBDFFRFT",130,0)
 I $D(HELP) M DIR("?")=HELP
"RTN","IBDFFRFT",131,0)
 D ^DIR
"RTN","IBDFFRFT",132,0)
 I $D(DIRUT),Y'="" S Y=-1 ;i y="" user typed "@"
"RTN","IBDFFRFT",133,0)
 I $D(DTOUT)!($D(DUOUT)) S IBQUIT=1,Y=-1
"RTN","IBDFFRFT",134,0)
 Q Y
"RTN","IBDFLST")
0^24^B26549250
"RTN","IBDFLST",1,0)
IBDFLST ;ALM/MAF - Maintenance Utility Invalid Codes List - MAY 17 1995
"RTN","IBDFLST",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**9,38**;APR 24, 1997
"RTN","IBDFLST",3,0)
 ;
"RTN","IBDFLST",4,0)
 ;
"RTN","IBDFLST",5,0)
START ;  -- Ask what invalid code you want to display CPT/ ICD9/ Visit
"RTN","IBDFLST",6,0)
 N IBDFDIS
"RTN","IBDFLST",7,0)
 D FULL^VALM1
"RTN","IBDFLST",8,0)
 S DIR("B")="CPT",DIR(0)="SBM^C:CPT;I:ICD9;V:VISIT",DIR("A")="Display invalid codes for [C]PT, [I]CD9, [V]ISIT" D ^DIR
"RTN","IBDFLST",9,0)
 K DIR I $D(DIRUT)!(Y<0) G QUIT
"RTN","IBDFLST",10,0)
 ;W !!,"Display invalid codes for CPT// " D ZSET1^IBDFLST1 S X="" R X:DTIME G QUIT:X="^"!('$T) I X=""!("Cc"[X) S X="1"
"RTN","IBDFLST",11,0)
 S X=$S("Ii"[X:2,"Vv"[X:3,1:1)
"RTN","IBDFLST",12,0)
 ;I X="?" D ZSET1^IBDFLST1,HELP1^IBDFLST1 G START
"RTN","IBDFLST",13,0)
 S IBDFTYP=$E(X)  ; D IN^DGHELP W ! I %=-1 D ZSET1^IBDFLST1,HELP1^IBDFLST1 G START
"RTN","IBDFLST",14,0)
 S IBDFDIS=$S(IBDFTYP=1:"CPT",IBDFTYP=2:"ICD9",IBDFTYP=3:"VISIT",1:"QUIT")
"RTN","IBDFLST",15,0)
 D WAIT^DICD
"RTN","IBDFLST",16,0)
 D EN^VALM("IBDF UTIL COMPLETE LIST TEMP")
"RTN","IBDFLST",17,0)
 Q
"RTN","IBDFLST",18,0)
 ;
"RTN","IBDFLST",19,0)
 ;
"RTN","IBDFLST",20,0)
HDR ; -- header code
"RTN","IBDFLST",21,0)
 S VALMHDR(1)="This screen displays the most current invalid codes for the "_IBDFDIS_" file."
"RTN","IBDFLST",22,0)
 Q
"RTN","IBDFLST",23,0)
 ;
"RTN","IBDFLST",24,0)
 ;
"RTN","IBDFLST",25,0)
SETSTR(S,V,X,L) ; -- insert text(S) into variable(V)
"RTN","IBDFLST",26,0)
 ;    S := string
"RTN","IBDFLST",27,0)
 ;    V := destination
"RTN","IBDFLST",28,0)
 ;    X := @ col X
"RTN","IBDFLST",29,0)
 ;    L := # of chars
"RTN","IBDFLST",30,0)
 ;
"RTN","IBDFLST",31,0)
 Q $E(V_$J("",X-1),1,X-1)_$E(S_$J("",L),1,L)_$E(V,X+L,999)
"RTN","IBDFLST",32,0)
 ;
"RTN","IBDFLST",33,0)
 ;
"RTN","IBDFLST",34,0)
INIT ;  -- Set up list for display
"RTN","IBDFLST",35,0)
 N IBDFCODE,IBDFDESC,IBDFIFN,IBDFCAT
"RTN","IBDFLST",36,0)
 S (IBDCNT,VALMCNT,IBDCNT1)=0
"RTN","IBDFLST",37,0)
 D @(IBDFDIS)
"RTN","IBDFLST",38,0)
 Q
"RTN","IBDFLST",39,0)
 ;
"RTN","IBDFLST",40,0)
 ;  -- Gets CPT listing of invalid codes
"RTN","IBDFLST",41,0)
CPT D FULL^VALM1 F IBDFIFN=0:0 S IBDFIFN=$O(^ICPT(IBDFIFN)) Q:'IBDFIFN  D
"RTN","IBDFLST",42,0)
 .;; --change to api cpt ; dhh
"RTN","IBDFLST",43,0)
 .;;     --note: 7th piece is status 0-inactive 1-active
"RTN","IBDFLST",44,0)
 . S IBDFNODE=$$CPT^ICPTCOD(IBDFIFN),IBDFNODE=$G(IBDFNODE)
"RTN","IBDFLST",45,0)
 . I $P(IBDFNODE,"^",7)=0 D
"RTN","IBDFLST",46,0)
 .. S IBDFCODE=$P(IBDFNODE,"^",2),IBDFDESC=$P(IBDFNODE,"^",3)
"RTN","IBDFLST",47,0)
 .. S IBDFCAT=$S($P(IBDFNODE,"^",4)]"":$P(^DIC(81.1,$P(IBDFNODE,"^",4),0),"^",1),1:"UNKNOWN") D ALPHA
"RTN","IBDFLST",48,0)
 D LOOP
"RTN","IBDFLST",49,0)
 Q
"RTN","IBDFLST",50,0)
 ;
"RTN","IBDFLST",51,0)
 ;  -- Gets ICD9 listing onf invalid codes
"RTN","IBDFLST",52,0)
ICD9 F IBDFIFN=0:0 S IBDFIFN=$O(^ICD9(IBDFIFN)) Q:'IBDFIFN  S IBDFNODE=$G(^ICD9(IBDFIFN,0)) I $P(IBDFNODE,"^",9)]"" D
"RTN","IBDFLST",53,0)
 .S IBDFCODE=$P(IBDFNODE,"^",1),IBDFDESC=$P(IBDFNODE,"^",3),IBDFCAT=$S($P(IBDFNODE,"^",5)]""&($G(^ICM(+$P(IBDFNODE,"^",5),0))]""):$P(^ICM($P(IBDFNODE,"^",5),0),"^",1),1:"UNKNOWN") D ALPHA
"RTN","IBDFLST",54,0)
 D LOOP
"RTN","IBDFLST",55,0)
 Q
"RTN","IBDFLST",56,0)
 ;
"RTN","IBDFLST",57,0)
 ;
"RTN","IBDFLST",58,0)
VISIT ;  -- Gets visit code listing of invalid codes
"RTN","IBDFLST",59,0)
 N IEN
"RTN","IBDFLST",60,0)
 F IBDFVST=0:0 S IBDFVST=$O(^IBE(357.69,"B",IBDFVST)) Q:'IBDFVST  D
"RTN","IBDFLST",61,0)
 . S IEN=$O(^IBE(357.69,"B",IBDFVST,0))
"RTN","IBDFLST",62,0)
 . Q:'IEN
"RTN","IBDFLST",63,0)
 . S IBDFNODE=$$CPT^ICPTCOD(IBDFVST)
"RTN","IBDFLST",64,0)
 . Q:+IBDFNODE=-1
"RTN","IBDFLST",65,0)
 . S IBDFIFN=+IBDFNODE
"RTN","IBDFLST",66,0)
 . S IBDFCODE=$P(IBDFNODE,"^",2)
"RTN","IBDFLST",67,0)
 . S IBDFDESC=$P(IBDFNODE,"^",3)
"RTN","IBDFLST",68,0)
 . S IBDFCAT=$S($P(IBDFNODE,"^",4)]"":$P(^DIC(81.1,$P(IBDFNODE,"^",4),0),"^",1),1:"UNKNOWN")
"RTN","IBDFLST",69,0)
 . D ALPHA
"RTN","IBDFLST",70,0)
 D LOOP
"RTN","IBDFLST",71,0)
 Q
"RTN","IBDFLST",72,0)
 ;
"RTN","IBDFLST",73,0)
 ;
"RTN","IBDFLST",74,0)
LOOP ;  -- Loop thru global ^TMP("ALPHA",$J) alphabetic by category
"RTN","IBDFLST",75,0)
 S IBDFCAT=0
"RTN","IBDFLST",76,0)
 F IBDCAT=0:0 S IBDFCAT=$O(^TMP("ALPHA",$J,IBDFCAT)) Q:IBDFCAT']""  F IBDFIFN=0:0 S IBDFIFN=$O(^TMP("ALPHA",$J,IBDFCAT,IBDFIFN)) Q:'IBDFIFN  S IBDFNODE=$G(^TMP("ALPHA",$J,IBDFCAT,IBDFIFN)) D
"RTN","IBDFLST",77,0)
 .S IBDFIFN=$P(IBDFNODE,"^",1)
"RTN","IBDFLST",78,0)
 .S IBDFCODE=$P(IBDFNODE,"^",2)
"RTN","IBDFLST",79,0)
 .S IBDFCAT=$P(IBDFNODE,"^",3)
"RTN","IBDFLST",80,0)
 .S IBDFDESC=$P(IBDFNODE,"^",4)
"RTN","IBDFLST",81,0)
 .D:'$D(IBDFC(IBDFCAT)) HEADER^IBDFLST1 D SET
"RTN","IBDFLST",82,0)
 Q
"RTN","IBDFLST",83,0)
 ;
"RTN","IBDFLST",84,0)
 ;
"RTN","IBDFLST",85,0)
SET ;  -- Set up list array
"RTN","IBDFLST",86,0)
 S IBDCNT1=IBDCNT1+1
"RTN","IBDFLST",87,0)
 S IBDCNT=IBDCNT+1,VALMCNT=VALMCNT+1
"RTN","IBDFLST",88,0)
 S X=""
"RTN","IBDFLST",89,0)
 S IBDFVAL=$J(IBDCNT1_")",5)
"RTN","IBDFLST",90,0)
 S X=$$SETSTR(IBDFVAL,X,1,5)
"RTN","IBDFLST",91,0)
 S IBDFVAL=IBDFCODE
"RTN","IBDFLST",92,0)
 S X=$$SETSTR(IBDFVAL,X,7,8)
"RTN","IBDFLST",93,0)
 S IBDFVAL=IBDFDESC
"RTN","IBDFLST",94,0)
 S X=$$SETSTR(IBDFVAL,X,17,20)
"RTN","IBDFLST",95,0)
 S IBDFVAL=IBDFCAT
"RTN","IBDFLST",96,0)
 S X=$$SETSTR(IBDFVAL,X,39,20)
"RTN","IBDFLST",97,0)
 ;
"RTN","IBDFLST",98,0)
 ;
"RTN","IBDFLST",99,0)
TMP ; -- Set up Array
"RTN","IBDFLST",100,0)
 S ^TMP("CODE",$J,IBDCNT,0)=$$LOWER^VALM1(X),^TMP("CODE",$J,"IDX",VALMCNT,IBDCNT1)=""
"RTN","IBDFLST",101,0)
 S ^TMP("CODEIDX",$J,IBDCNT1)=VALMCNT_"^"_IBDFIFN_"^"_IBDFCODE_"^"_IBDFCAT_"^"_IBDFDESC
"RTN","IBDFLST",102,0)
 Q
"RTN","IBDFLST",103,0)
 ;
"RTN","IBDFLST",104,0)
 ;
"RTN","IBDFLST",105,0)
ALPHA ;  - Alphabetize by category
"RTN","IBDFLST",106,0)
 S ^TMP("ALPHA",$J,IBDFCAT,IBDFIFN)=IBDFIFN_"^"_IBDFCODE_"^"_IBDFCAT_"^"_IBDFDESC
"RTN","IBDFLST",107,0)
 Q
"RTN","IBDFLST",108,0)
 ;
"RTN","IBDFLST",109,0)
 ;
"RTN","IBDFLST",110,0)
QUIT ;  -- Kill variables and reset to last display if no change has been taken place.
"RTN","IBDFLST",111,0)
 ;
"RTN","IBDFLST",112,0)
 ;
"RTN","IBDFLST",113,0)
EXIT K ^TMP("CODE",$J),^TMP("CODEIDX",$J),^TMP("ALPHA",$J)
"RTN","IBDFLST",114,0)
 K IBDFC,IBDFTYP,IBDFCNT1,IBDCAT
"RTN","IBDFLST",115,0)
 Q
"RTN","IBDFLST",116,0)
 ;
"RTN","IBDFLST",117,0)
 ;
"RTN","IBDFLST",118,0)
JUMP ; -- Jump action to display a specific category on the screen.
"RTN","IBDFLST",119,0)
 D FULL^VALM1
"RTN","IBDFLST",120,0)
 I $D(XQORNOD(0)),$P(XQORNOD(0),"^",4)]"" S X=$P(XQORNOD(0),"^",4) S X=$P(X,"=",2) I X]"" D:X?1.6N JSEL S DIC=$S(IBDFDIS="ICD9":"^ICM(",1:"^DIC(81.1,"),DIC(0)="QEZ" D ^DIC K DIC G:Y<0 JMP S Y=+Y D JUMP1 Q
"RTN","IBDFLST",121,0)
JMP S DIC=$S(IBDFDIS="ICD9":"^ICM(",1:"^DIC(81.1,"),DIC(0)="AEMN",DIC("A")="Select "_$S(IBDFDIS="ICD9":"ICD9",1:"CPT")_" category you wish to move to: "
"RTN","IBDFLST",122,0)
 D ^DIC K DIC
"RTN","IBDFLST",123,0)
 I X["^" S VALMBG=1,VALMBCK="R" Q
"RTN","IBDFLST",124,0)
 ;
"RTN","IBDFLST",125,0)
 ;
"RTN","IBDFLST",126,0)
JUMP1 I Y<0 G JUMP
"RTN","IBDFLST",127,0)
 N IBDFCAT
"RTN","IBDFLST",128,0)
 S IBDFCAT=$S(IBDFDIS="ICD9":$P(^ICM(+Y,0),"^",1),1:$P(^DIC(81.1,+Y,0),"^",1))
"RTN","IBDFLST",129,0)
 I '$D(IBDFC(IBDFCAT)) W !!,"There is no data listed for this Clinic Group" G JMP
"RTN","IBDFLST",130,0)
 S VALMBG=+IBDFC(IBDFCAT) S VALMBCK="R" Q
"RTN","IBDFLST",131,0)
 Q
"RTN","IBDFLST",132,0)
 ;
"RTN","IBDFLST",133,0)
 ;
"RTN","IBDFLST",134,0)
JSEL ; -- Convert number selected to name
"RTN","IBDFLST",135,0)
 S IBDVALM=X I $D(^TMP("CGIDX",$J,IBDVALM)) S X=$P(^TMP("CGIDX",$J,IBDVALM),"^",2),X=$P(^IBD(357.99,X,0),"^",1)
"RTN","IBDFLST",136,0)
 Q
"RTN","IBDFLST",137,0)
HLP ; -- help code
"RTN","IBDFLST",138,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBDFLST",139,0)
 Q
"RTN","IBDFLST",140,0)
 ;
"RTN","IBDFM1")
0^14^B41474077
"RTN","IBDFM1",1,0)
IBDFM1 ;ALB/CJM - Compiling bubbles and hand print fields;3/1/93
"RTN","IBDFM1",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**13,25,38**;APR 24, 1997
"RTN","IBDFM1",3,0)
 ;                                          
"RTN","IBDFM1",4,0)
DRWBBL(ROW,COL,PI,VALUE,FNAME,FID,ALLOWED,DISPLAY,HDR,QLFR,DYN,CNT,SUBHDR,QTY,ND2,SLCTN) ;
"RTN","IBDFM1",5,0)
 ;returns "" if no bubble created, else the ien
"RTN","IBDFM1",6,0)
 ;
"RTN","IBDFM1",7,0)
 N BUBBLE
"RTN","IBDFM1",8,0)
 S DISPLAY=$E(DISPLAY,1,80),HDR=$E(HDR,1,40)
"RTN","IBDFM1",9,0)
 S DISPLAY=$TR(DISPLAY,"""\","``")
"RTN","IBDFM1",10,0)
 S DYN=+$G(DYN),CNT=+$G(CNT)
"RTN","IBDFM1",11,0)
 ;
"RTN","IBDFM1",12,0)
 ;don't want to associate a value with the bubble if there is no input interface for the type of data
"RTN","IBDFM1",13,0)
 I 'PI S VALUE=""
"RTN","IBDFM1",14,0)
 ;
"RTN","IBDFM1",15,0)
 ;compiling blocks?
"RTN","IBDFM1",16,0)
 I IBPRINT("COMPILING_BLOCKS") D CMPBBL Q:'IBPRINT("WRITE_IF_COMPILING")
"RTN","IBDFM1",17,0)
 ;
"RTN","IBDFM1",18,0)
 ;don't draw a bubble if in the list processor
"RTN","IBDFM1",19,0)
 Q:IBDEVICE("LISTMAN")
"RTN","IBDFM1",20,0)
 ;
"RTN","IBDFM1",21,0)
 ;add the offsets for the block to position
"RTN","IBDFM1",22,0)
 S ROW=ROW+IBBLK("Y"),COL=COL+IBBLK("X")
"RTN","IBDFM1",23,0)
 ;
"RTN","IBDFM1",24,0)
 ;might not be creating a FORM DEFINITION TABLE - case of toolkit form
"RTN","IBDFM1",25,0)
 I IBFORM("TOOLKIT") S @IBARRAY("BUBBLES")@(ROW,COL)="" Q
"RTN","IBDFM1",26,0)
 ;
"RTN","IBDFM1",27,0)
 ;case of FORM DEFINITION TABLE being created - all forms but toolkit
"RTN","IBDFM1",28,0)
 Q:IBFORM("COMPILED")="F"  ;something already went wrong
"RTN","IBDFM1",29,0)
 I IBFORM("TYPE") I $D(^IBD(357.95,IBFORM("TYPE"),0))
"RTN","IBDFM1",30,0)
 E  S IBFORM("TYPE")=$$NEWTABLE(.IBFORM)
"RTN","IBDFM1",31,0)
 I 'IBFORM("TYPE") D UNCMPL^IBDF19(.IBFORM,1) Q
"RTN","IBDFM1",32,0)
 ;
"RTN","IBDFM1",33,0)
 ;add the bubble to the table
"RTN","IBDFM1",34,0)
 K DIC,D0,DINUM,DD S DIC="^IBD(357.95,"_IBFORM("TYPE")_",1,",X=ROW,DA(1)=IBFORM("TYPE"),DIC(0)=""
"RTN","IBDFM1",35,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDFM1",36,0)
 S BUBBLE=$S(+Y<0:"",1:+Y)
"RTN","IBDFM1",37,0)
 I 'BUBBLE D UNCMPL^IBDF19(.IBFORM,1) Q
"RTN","IBDFM1",38,0)
 I BUBBLE D
"RTN","IBDFM1",39,0)
 .D INPUT^IBDFU91(PI,.VALUE) I '$D(VALUE) S VALUE=""
"RTN","IBDFM1",40,0)
 .S ^IBD(357.95,IBFORM("TYPE"),1,BUBBLE,0)=ROW_"^"_COL_"^"_PI_"^"_VALUE_"^"_$G(FNAME)_"^"_FID_"^"_ALLOWED_"^"_DISPLAY_"^"_HDR_"^"_QLFR_"^"_DYN_"^"_CNT_"^"_$G(QTY)_"^"_$G(SLCTN)
"RTN","IBDFM1",41,0)
 .I $L($G(SUBHDR)) S ^IBD(357.95,IBFORM("TYPE"),1,BUBBLE,1)=$E(SUBHDR,1,250)
"RTN","IBDFM1",42,0)
 .I $L($G(ND2)) D
"RTN","IBDFM1",43,0)
 ..; -- change external format of 2nd & 3rd codes to internal format
"RTN","IBDFM1",44,0)
 ..N IBJ,IBVAL F IBJ=3,4 S IBVAL=$P(ND2,"^",IBJ) I IBVAL]"" D INPUT^IBDFU91(PI,.IBVAL) S $P(ND2,"^",IBJ)=$S($D(IBVAL):IBVAL,1:"")
"RTN","IBDFM1",45,0)
 ..S ^IBD(357.95,IBFORM("TYPE"),1,BUBBLE,2)=ND2
"RTN","IBDFM1",46,0)
 .K DIK,DA S DIK="^IBD(357.95,"_IBFORM("TYPE")_",1,",DA=BUBBLE,DA(1)=IBFORM("TYPE") D IX1^DIK K DIK,DA
"RTN","IBDFM1",47,0)
 Q
"RTN","IBDFM1",48,0)
 ;
"RTN","IBDFM1",49,0)
NEWTABLE(IBFORM) ;creates a new FORM DEFINITION table
"RTN","IBDFM1",50,0)
 ;returns the ien of the table created, "" if not created
"RTN","IBDFM1",51,0)
 N NODE,SUB,CNT
"RTN","IBDFM1",52,0)
 S IBFORM("TYPE")=$$FORMTYPE^IBDF18D(1)
"RTN","IBDFM1",53,0)
 Q:'IBFORM("TYPE")
"RTN","IBDFM1",54,0)
 S NODE=$G(^IBE(357,IBFORM,0))
"RTN","IBDFM1",55,0)
 S $P(^IBD(357.95,IBFORM("TYPE"),0),"^",9,19)=$P(NODE,"^",9,19) ;not all  19 pieces may exist
"RTN","IBDFM1",56,0)
 S $P(^IBD(357.95,IBFORM("TYPE"),0),"^",20,21)=DT_"^"_IBFORM
"RTN","IBDFM1",57,0)
 S $P(^IBE(357,IBFORM,0),"^",13)=IBFORM("TYPE")
"RTN","IBDFM1",58,0)
 S (CNT,SUB)=0 F  S SUB=$O(^IBE(357,IBFORM,2,SUB)) Q:'SUB  S NODE=$G(^IBE(357,IBFORM,2,SUB,0)) Q:('+NODE)!('$P(NODE,"^",2))  S CNT=CNT+1,^IBD(357.95,IBFORM("TYPE"),3,CNT,0)=+NODE_"^1",^IBD(357.95,IBFORM("TYPE"),3,"B",+NODE,CNT)=""
"RTN","IBDFM1",59,0)
 S $P(^IBD(357.95,IBFORM("TYPE"),3,0),"^",3,4)=CNT_"^"_CNT
"RTN","IBDFM1",60,0)
 Q IBFORM("TYPE")
"RTN","IBDFM1",61,0)
 ;
"RTN","IBDFM1",62,0)
CMPBBL ;save compiled bubbles for the block
"RTN","IBDFM1",63,0)
 S IBWRTCNT("B")=IBWRTCNT("B")+1
"RTN","IBDFM1",64,0)
 S ^IBE(357.1,IBBLK,"B",IBWRTCNT("B"),0)=ROW_"^"_COL_"^"_PI_"^"_VALUE_"^"_FNAME_"^"_FID_"^"_ALLOWED_"^"_DISPLAY_"^"_HDR_"^"_QLFR_"^"_DYN_"^"_CNT_"^"_$G(QTY)_"^"_$G(SLCTN)
"RTN","IBDFM1",65,0)
 I $L($G(SUBHDR)) S ^IBE(357.1,IBBLK,"B",IBWRTCNT("B"),1)=$E(SUBHDR,1,250)
"RTN","IBDFM1",66,0)
 I $L($G(ND2)) S ^IBE(357.1,IBBLK,"B",IBWRTCNT("B"),2)=ND2
"RTN","IBDFM1",67,0)
 Q
"RTN","IBDFM1",68,0)
 ;
"RTN","IBDFM1",69,0)
CMPHAND ;save compiled hand print fields for the block
"RTN","IBDFM1",70,0)
 S IBWRTCNT("H")=IBWRTCNT("H")+1
"RTN","IBDFM1",71,0)
 S ^IBE(357.1,IBBLK,"H",IBWRTCNT("H"),0)=ROW_"^"_COL_"^"_WIDTH_"^"_PI_"^^"_LINES_"^"_FID_"^"_FNAME_"^"_HDR_"^"_QLFR_"^^"_ITEM_"^^"_PRINT_"^"_READ_"^^"_TYPEDATA
"RTN","IBDFM1",72,0)
 Q
"RTN","IBDFM1",73,0)
 ;
"RTN","IBDFM1",74,0)
DRWHAND(ROW,COL,WIDTH,PI,LINES,FID,FNAME,HDR,QLFR,ITEM,PRINT,READ,TYPEDATA) ;creates hand print field
"RTN","IBDFM1",75,0)
 N NODE
"RTN","IBDFM1",76,0)
 S NODE=""
"RTN","IBDFM1",77,0)
 ;
"RTN","IBDFM1",78,0)
 S ITEM=$G(ITEM),PRINT=$G(PRINT),READ=$G(READ),TYPEDATA=$G(TYPEDATA)
"RTN","IBDFM1",79,0)
 ;returns "" if no hand print field created, else the ien
"RTN","IBDFM1",80,0)
 Q:('$D(ROW))!('$D(COL))
"RTN","IBDFM1",81,0)
 N HANDPRNT
"RTN","IBDFM1",82,0)
 S HDR=$E(HDR,1,40)
"RTN","IBDFM1",83,0)
 ;
"RTN","IBDFM1",84,0)
 ;compiling blocks?
"RTN","IBDFM1",85,0)
 I IBPRINT("COMPILING_BLOCKS") D CMPHAND Q:'IBPRINT("WRITE_IF_COMPILING")
"RTN","IBDFM1",86,0)
 ;
"RTN","IBDFM1",87,0)
 ;don't draw hand print field if in the list processor
"RTN","IBDFM1",88,0)
 Q:IBDEVICE("LISTMAN")
"RTN","IBDFM1",89,0)
 ;
"RTN","IBDFM1",90,0)
 ;add the offsets for the block to position
"RTN","IBDFM1",91,0)
 S ROW=ROW+IBBLK("Y"),COL=COL+IBBLK("X")
"RTN","IBDFM1",92,0)
 ;
"RTN","IBDFM1",93,0)
 ;might not be creating a FORM DEFINITION TABLE - case of toolkit form
"RTN","IBDFM1",94,0)
 I IBFORM("TOOLKIT") D  Q
"RTN","IBDFM1",95,0)
 .N CNT S CNT=+$G(@IBARRAY("HAND_PRINT"))+1
"RTN","IBDFM1",96,0)
 .S @IBARRAY("HAND_PRINT")@(ROW,COL,CNT)=ROW_"^"_COL_"^"_WIDTH_"^"_PI_"^"_FNAME_"^"_LINES_"^^"_FID_"^"_HDR_"^"_QLFR_"^^"_ITEM_"^^"_PRINT_"^"_READ_"^^"_TYPEDATA
"RTN","IBDFM1",97,0)
 ;
"RTN","IBDFM1",98,0)
 ;case of FORM DEFINITION TABLE being created - all forms but toolkit
"RTN","IBDFM1",99,0)
 Q:IBFORM("COMPILED")="F"  ;something already went wrong
"RTN","IBDFM1",100,0)
 I IBFORM("TYPE") I $D(^IBD(357.95,IBFORM("TYPE"),0))
"RTN","IBDFM1",101,0)
 E  S IBFORM("TYPE")=$$NEWTABLE(.IBFORM)
"RTN","IBDFM1",102,0)
 ;if 'IBFORM("TYPE") want to recompile this next time around
"RTN","IBDFM1",103,0)
 I 'IBFORM("TYPE") D UNCMPL^IBDF19(.IBFORM,1) Q
"RTN","IBDFM1",104,0)
 ;
"RTN","IBDFM1",105,0)
 ;add the handprint field to the table
"RTN","IBDFM1",106,0)
 K DIC,D0,DINUM,DD S DIC="^IBD(357.95,"_IBFORM("TYPE")_",2,",X=ROW,DA(1)=IBFORM("TYPE"),DIC(0)=""
"RTN","IBDFM1",107,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDFM1",108,0)
 S HANDPRNT=$S(+Y<0:"",1:+Y)
"RTN","IBDFM1",109,0)
 I 'HANDPRNT D UNCMPL^IBDF19(.IBFORM,1) Q
"RTN","IBDFM1",110,0)
 I HANDPRNT D
"RTN","IBDFM1",111,0)
 .S ^IBD(357.95,IBFORM("TYPE"),2,HANDPRNT,0)=ROW_"^"_COL_"^"_WIDTH_"^"_PI_"^"_FNAME_"^"_LINES_"^^"_FID_"^"_HDR_"^"_QLFR_"^^"_ITEM_"^^"_PRINT_"^"_READ_"^^"_TYPEDATA
"RTN","IBDFM1",112,0)
 .K DIK,DA S DIK="^IBD(357.95,"_IBFORM("TYPE")_",2,",DA=HANDPRNT,DA(1)=IBFORM("TYPE") D IX1^DIK K DIK,DA
"RTN","IBDFM1",113,0)
 Q
"RTN","IBDFM1",114,0)
 ;
"RTN","IBDFM1",115,0)
TRACKBBL(FID,COUNT,QLFR,PI,DISPLAY,VALUE) ;
"RTN","IBDFM1",116,0)
 ;IBPFID, the id in form tracking, should be defined
"RTN","IBDFM1",117,0)
 ;
"RTN","IBDFM1",118,0)
 ; -- do not re-file dynamic data if reprint
"RTN","IBDFM1",119,0)
 Q:$G(REPRINT)
"RTN","IBDFM1",120,0)
 ;N SUB,NODE
"RTN","IBDFM1",121,0)
 ;S NODE=$G(^IBD(357.96,IBPFID,1,0))
"RTN","IBDFM1",122,0)
 ;S SUB=$P(NODE,"^",3)
"RTN","IBDFM1",123,0)
 ;S SUB=SUB+1,$P(NODE,"^",3,4)=SUB_"^"_SUB
"RTN","IBDFM1",124,0)
 ;D INPUT^IBDFU91(PI,.VALUE) I '$D(VALUE) S VALUE=""
"RTN","IBDFM1",125,0)
 ;S ^IBD(357.96,IBPFID,1,SUB,0)=COUNT_"^^"_PI_"^"_VALUE_"^^"_FID_"^^"_DISPLAY_"^^"_QLFR
"RTN","IBDFM1",126,0)
 ;S ^IBD(357.96,IBPFID,1,0)=NODE
"RTN","IBDFM1",127,0)
 ;K DIK,DA S DIK="^IBD(357.96,IBPFID,1,",DA=SUB,DA(1)=IBPFID D IX^DIK K DIK,DA
"RTN","IBDFM1",128,0)
 ;
"RTN","IBDFM1",129,0)
 ; -- for problem list, move the narrative to one piece for storing
"RTN","IBDFM1",130,0)
 S DISPLAY=$$DISP(DISPLAY)
"RTN","IBDFM1",131,0)
 ;
"RTN","IBDFM1",132,0)
 D INPUT^IBDFU91(PI,.VALUE) I '$D(VALUE) S VALUE=""
"RTN","IBDFM1",133,0)
 S X=COUNT
"RTN","IBDFM1",134,0)
 S DLAYGO=357.96
"RTN","IBDFM1",135,0)
 S DIC="^IBD(357.96,IBPFID,1,"
"RTN","IBDFM1",136,0)
 S DIC(0)="L"
"RTN","IBDFM1",137,0)
 S DIC("P")=$P(^DD(357.96,1,0),"^",2)
"RTN","IBDFM1",138,0)
 S DA(1)=IBPFID
"RTN","IBDFM1",139,0)
 S DIC("DR")=".03////^S X=PI;.04////^S X=VALUE;.06////^S X=FID;.08////^S X=$E(DISPLAY,1,80);.1////^S X=QLFR"
"RTN","IBDFM1",140,0)
 K DD,DO D FILE^DICN K DIC,DA,DLAYGO,DD,DO
"RTN","IBDFM1",141,0)
 Q
"RTN","IBDFM1",142,0)
 ;
"RTN","IBDFM1",143,0)
DISP(DIS) ; -- display narrative :: piece
"RTN","IBDFM1",144,0)
 N I,J
"RTN","IBDFM1",145,0)
 S DIS=$E($G(DIS),1,80)
"RTN","IBDFM1",146,0)
 G:DIS="" DISPQ
"RTN","IBDFM1",147,0)
 G:DIS'[" :: " DISPQ
"RTN","IBDFM1",148,0)
 I $P(DIS," :: ",2,99)="" S DIS=$P(DIS," :: ",1) G DISPQ
"RTN","IBDFM1",149,0)
 ;
"RTN","IBDFM1",150,0)
 F I=1:1 D  Q:$P(DIS," :: ",2,99)=""
"RTN","IBDFM1",151,0)
 . ;
"RTN","IBDFM1",152,0)
 . ; -- sometimes the string contains "nnnnn ::  ::  :: narrative"
"RTN","IBDFM1",153,0)
 . I $E(DIS,1,4)=" :: " S DIS=$E(DIS,5,80) Q
"RTN","IBDFM1",154,0)
 . ;
"RTN","IBDFM1",155,0)
 . ; -- get rid of leading spaces
"RTN","IBDFM1",156,0)
 . F J=1:1 Q:$E(DIS)'=" "  S DIS=$E(DIS,2,80)
"RTN","IBDFM1",157,0)
 . ;
"RTN","IBDFM1",158,0)
 . ; -- get rid of piece one if Numeric code
"RTN","IBDFM1",159,0)
 . I +DIS>0 S DIS=$P(DIS," :: ",2,99) Q
"RTN","IBDFM1",160,0)
 . ;
"RTN","IBDFM1",161,0)
 . ; -- get rid of piece one if alpha numeric (cpt) code
"RTN","IBDFM1",162,0)
 . I +DIS=0,$P(DIS," :: ",1)?1U4N S DIS=$P(DIS," :: ",2,99) Q
"RTN","IBDFM1",163,0)
 . ;
"RTN","IBDFM1",164,0)
 . ; -- get rid of piece one if alpha numeric icd code
"RTN","IBDFM1",165,0)
 . I +DIS=0,$P(DIS," :: ",1)?1U2.3N.1".".2N S DIS=$P(DIS," :: ",2,99) Q
"RTN","IBDFM1",166,0)
 . ;
"RTN","IBDFM1",167,0)
 . ; -- must be text in piece one, use it as text
"RTN","IBDFM1",168,0)
 . I +DIS=0 S DIS=$P(DIS," :: ",1) Q
"RTN","IBDFM1",169,0)
DISPQ I DIS=" :: " S DIS="Unknown"
"RTN","IBDFM1",170,0)
 Q DIS
"RTN","IBDFN12")
0^25^B7401338
"RTN","IBDFN12",1,0)
IBDFN12 ;ALB/CJM - ENCOUNTER FORM - SELECTORS;MAY 10, 1995
"RTN","IBDFN12",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**12,38**;APR 24, 1997
"RTN","IBDFN12",3,0)
 ;
"RTN","IBDFN12",4,0)
LOOKUP(FILE,SCREEN,X,NODE) ;
"RTN","IBDFN12",5,0)
 ; -- lookup X in file using SCREEN
"RTN","IBDFN12",6,0)
 ; -- kills X if lookup not successful, else sets X to the ien and returns NODE as the 0 node
"RTN","IBDFN12",7,0)
 ; -- pass X and NODE by reference
"RTN","IBDFN12",8,0)
 ;
"RTN","IBDFN12",9,0)
 I +$G(FILE)<1 K X Q
"RTN","IBDFN12",10,0)
 N Y
"RTN","IBDFN12",11,0)
 S (NODE,Y)=""
"RTN","IBDFN12",12,0)
 K DIC S DIC=FILE,DIC("S")=SCREEN
"RTN","IBDFN12",13,0)
 S DIC(0)="EMQZ"
"RTN","IBDFN12",14,0)
 I $D(^DIC(FILE)) D ^DIC K DIC
"RTN","IBDFN12",15,0)
 I +Y>0 D
"RTN","IBDFN12",16,0)
 .S X=Y,NODE=Y(0)
"RTN","IBDFN12",17,0)
 E  K X
"RTN","IBDFN12",18,0)
 Q
"RTN","IBDFN12",19,0)
 ;
"RTN","IBDFN12",20,0)
SLCTCPT(X) ;for CPT codes
"RTN","IBDFN12",21,0)
 ;pass X by reference
"RTN","IBDFN12",22,0)
 ;example of use: D SLCTCPT^IBDFN12(.X)
"RTN","IBDFN12",23,0)
 ;
"RTN","IBDFN12",24,0)
 N NODE
"RTN","IBDFN12",25,0)
 D LOOKUP(81,"I '$P(^(0),U,4)",.X,.NODE)
"RTN","IBDFN12",26,0)
 I $D(X) S IBLABEL=$P(NODE,"^",2),(IBID,X)=$P(NODE,"^",1)
"RTN","IBDFN12",27,0)
 Q
"RTN","IBDFN12",28,0)
 ;
"RTN","IBDFN12",29,0)
SLCTDX(X) ;for ICD9 diagnosis codes
"RTN","IBDFN12",30,0)
 ;pass X by reference
"RTN","IBDFN12",31,0)
 ;example of use: D SLCTICD^IBDFN12(.X)
"RTN","IBDFN12",32,0)
 ;
"RTN","IBDFN12",33,0)
 N NODE
"RTN","IBDFN12",34,0)
 D LOOKUP(80,"I '$P(^(0),U,9)",.X,.NODE)
"RTN","IBDFN12",35,0)
 I $D(X) S IBLABEL=$P(NODE,"^",3),(IBID,X)=$P(NODE,"^",1)
"RTN","IBDFN12",36,0)
 Q
"RTN","IBDFN12",37,0)
 ;
"RTN","IBDFN12",38,0)
SLCTVST(X) ;for VISIT TYPE codes
"RTN","IBDFN12",39,0)
 ;pass X by reference
"RTN","IBDFN12",40,0)
 ;example of use: D SLCTVST^IBDFN12(.X)
"RTN","IBDFN12",41,0)
 ;
"RTN","IBDFN12",42,0)
 N NODE
"RTN","IBDFN12",43,0)
 D LOOKUP(357.69,"I '$P(^(0),U,4)",.X,.NODE)
"RTN","IBDFN12",44,0)
 ;; --change to api cpt ; dhh
"RTN","IBDFN12",45,0)
 I $G(X) S NODE=$$CPT^ICPTCOD(+NODE),NODE=$G(NODE),(IBID,X)=$P(NODE,"^",2),IBLABEL=$P(NODE,"^",3)
"RTN","IBDFN12",46,0)
 Q
"RTN","IBDFN12",47,0)
 ;
"RTN","IBDFN12",48,0)
SLCTED(X) ;for Education Topics
"RTN","IBDFN12",49,0)
 ;pass X by reference
"RTN","IBDFN12",50,0)
 ;example of use: D SLCTED^IBDFN12(.X)
"RTN","IBDFN12",51,0)
 ;
"RTN","IBDFN12",52,0)
 N NODE
"RTN","IBDFN12",53,0)
 D LOOKUP(9999999.09,"",.X,.NODE)
"RTN","IBDFN12",54,0)
 I $D(X) S IBLABEL=$P(NODE,"^"),IBID=+X,X=IBLABEL
"RTN","IBDFN12",55,0)
 Q
"RTN","IBDFN12",56,0)
 ;
"RTN","IBDFN12",57,0)
SLCTIMM(X) ;for Immunizations
"RTN","IBDFN12",58,0)
 ;pass X by reference
"RTN","IBDFN12",59,0)
 ;example of use: D SLCTIMM^IBDFN12(.X)
"RTN","IBDFN12",60,0)
 ;
"RTN","IBDFN12",61,0)
 N NODE
"RTN","IBDFN12",62,0)
 D LOOKUP(9999999.14,"",.X,.NODE)
"RTN","IBDFN12",63,0)
 I $D(X) S IBLABEL=$P(NODE,"^",2),IBID=+X,X=IBLABEL
"RTN","IBDFN12",64,0)
 Q
"RTN","IBDFN12",65,0)
 ;
"RTN","IBDFN12",66,0)
SLCTEX(X) ;for Exams
"RTN","IBDFN12",67,0)
 ;pass X by reference
"RTN","IBDFN12",68,0)
 ;example of use: D SLCTEX^IBDFN12(.X)
"RTN","IBDFN12",69,0)
 ;
"RTN","IBDFN12",70,0)
 N NODE
"RTN","IBDFN12",71,0)
 D LOOKUP(9999999.15,"",.X,.NODE)
"RTN","IBDFN12",72,0)
 I $D(X) S IBLABEL=$P(NODE,"^"),IBID=+X,X=IBLABEL
"RTN","IBDFN12",73,0)
 Q
"RTN","IBDFN12",74,0)
 ;
"RTN","IBDFN12",75,0)
SLCTSKN(X) ;for Skin Tests
"RTN","IBDFN12",76,0)
 ;pass X by reference
"RTN","IBDFN12",77,0)
 ;example of use: D SLCTSKN^IBDFN12(.X)
"RTN","IBDFN12",78,0)
 ;
"RTN","IBDFN12",79,0)
 N NODE
"RTN","IBDFN12",80,0)
 D LOOKUP(9999999.28,"",.X,.NODE)
"RTN","IBDFN12",81,0)
 I $D(X) S IBLABEL=$P(NODE,"^"),IBID=+X,X=IBLABEL
"RTN","IBDFN12",82,0)
 Q
"RTN","IBDFN12",83,0)
 ;
"RTN","IBDFN12",84,0)
SLCTHF(X) ;for Health Factores
"RTN","IBDFN12",85,0)
 ;pass X by reference
"RTN","IBDFN12",86,0)
 ;example of use: D SLCTHF^IBDFN12(.X)
"RTN","IBDFN12",87,0)
 ;
"RTN","IBDFN12",88,0)
 N NODE
"RTN","IBDFN12",89,0)
 D LOOKUP(9999999.64,"I $P(^(0),U,10)=""F""",.X,.NODE)
"RTN","IBDFN12",90,0)
 I $D(X) S IBLABEL=$P(NODE,"^"),IBID=+X,X=IBLABEL
"RTN","IBDFN12",91,0)
 Q
"RTN","IBDFN12",92,0)
SLCTTR(X) ;for Treatments
"RTN","IBDFN12",93,0)
 ;pass X by reference
"RTN","IBDFN12",94,0)
 ;example of use: D SLCTTR^IBDFN12(.X)
"RTN","IBDFN12",95,0)
 ;
"RTN","IBDFN12",96,0)
 N NODE
"RTN","IBDFN12",97,0)
 D LOOKUP(9999999.17,"",.X,.NODE)
"RTN","IBDFN12",98,0)
 I $D(X) S IBLABEL=$P(NODE,"^"),IBID=+X,X=IBLABEL
"RTN","IBDFN12",99,0)
 Q
"RTN","IBDFN12",100,0)
 ;
"RTN","IBDFN12",101,0)
SLCTYN(X) ;for selecting YES or NO
"RTN","IBDFN12",102,0)
 ;
"RTN","IBDFN12",103,0)
 I "Yy"[$E(X) S X="YES",IBID=1 Q
"RTN","IBDFN12",104,0)
 I "Nn"[$E(X) S X="NO",IBID=0 Q
"RTN","IBDFN12",105,0)
 W "Enter YES or NO."
"RTN","IBDFN12",106,0)
 K X
"RTN","IBDFN12",107,0)
 Q
"RTN","IBDFN12",108,0)
 ;
"RTN","IBDFN12",109,0)
SLCTCLS(PI,X) ;for visit classification
"RTN","IBDFN12",110,0)
 ;pass X by reference
"RTN","IBDFN12",111,0)
 ;*NOTE: if interactive sets IBQUAL to the qualifier, IBLABEL to the recommended label, for use in the input template
"RTN","IBDFN12",112,0)
 ;example of use: D INPUTCLS^IBDFN12(PI,.X)
"RTN","IBDFN12",113,0)
 ;
"RTN","IBDFN12",114,0)
 N NODE
"RTN","IBDFN12",115,0)
 D LOOKUP(357.98,"I $$DQGOOD^IBDFU9(PI,Y)",.X,.NODE)
"RTN","IBDFN12",116,0)
 I $D(X) S IBID="",IBLABEL=$P(NODE,"^",3),IBQUAL=+X,X=$P(NODE,"^")
"RTN","IBDFN12",117,0)
 Q
"RTN","IBDFN14")
0^26^B7232490
"RTN","IBDFN14",1,0)
IBDFN14 ;ALB/CMR - ENCOUNTER FORM - OUTPUTS;JAN 4, 1996
"RTN","IBDFN14",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**12,38**;APR 24, 1997
"RTN","IBDFN14",3,0)
 ;
"RTN","IBDFN14",4,0)
CPT(X) ; -- return external value, descr and active flag for CPT code
"RTN","IBDFN14",5,0)
 ; -- X passed equal to ien for cpt code
"RTN","IBDFN14",6,0)
 ;
"RTN","IBDFN14",7,0)
 ;    input: ien of file #81
"RTN","IBDFN14",8,0)
 ;    output: IBID = cpt code (.01 field of file #81)
"RTN","IBDFN14",9,0)
 ;            IBLABEL = description fo cpt code
"RTN","IBDFN14",10,0)
 ;            IBINACT = null if active
"RTN","IBDFN14",11,0)
 ;                      1 if inactive
"RTN","IBDFN14",12,0)
 ;
"RTN","IBDFN14",13,0)
 Q:'X
"RTN","IBDFN14",14,0)
 N IBDFNODE
"RTN","IBDFN14",15,0)
 S (IBID,IBLABEL,IBINACT)=""
"RTN","IBDFN14",16,0)
 S IBDFNODE=$$CPT^ICPTCOD(X)
"RTN","IBDFN14",17,0)
 Q:+IBDFNODE=-1
"RTN","IBDFN14",18,0)
 S IBID=$P(IBDFNODE,"^",2)
"RTN","IBDFN14",19,0)
 S IBLABEL=$P(IBDFNODE,"^",3)
"RTN","IBDFN14",20,0)
 S IBINACT=$S($P(IBDFNODE,"^",7)=1:"",1:1)
"RTN","IBDFN14",21,0)
 Q
"RTN","IBDFN14",22,0)
DX(X) ; -- return external value, descr and active flag for ICD9 diagnosis
"RTN","IBDFN14",23,0)
 ; -- pass X equal to ien for icd9 code
"RTN","IBDFN14",24,0)
 ;
"RTN","IBDFN14",25,0)
 Q:'X
"RTN","IBDFN14",26,0)
 S (IBID,IBLABEL,IBINACT)=""
"RTN","IBDFN14",27,0)
 I $G(^ICD9(X,0))]"" S IBID=$P(^(0),"^"),IBLABEL=$P(^(0),"^",3),IBINACT=$P(^(0),"^",9)
"RTN","IBDFN14",28,0)
 Q
"RTN","IBDFN14",29,0)
VST(X) ; -- return external value, descr and active flag for VISIT TYPE 
"RTN","IBDFN14",30,0)
 ; -- pass X equal to ien for visit type
"RTN","IBDFN14",31,0)
 ;
"RTN","IBDFN14",32,0)
 Q:'X
"RTN","IBDFN14",33,0)
 S (IBID,IBLABEL,IBINACT)=""
"RTN","IBDFN14",34,0)
 ;; --change to api cpt ; dhh
"RTN","IBDFN14",35,0)
 I $G(^IBE(357.69,X,0))]"",+$$CPT^ICPTCOD(X)'=-1 D
"RTN","IBDFN14",36,0)
 .S IBID=$P(^IBE(357.69,X,0),"^"),IBLABEL=$P(^(0),"^",3)
"RTN","IBDFN14",37,0)
 .S HDR=$P(^IBE(357.69,X,0),"^",2) I $L(HDR_IBLABEL)<75 S IBLABEL=HDR_" "_IBLABEL
"RTN","IBDFN14",38,0)
 .K HDR
"RTN","IBDFN14",39,0)
 .;; --change to api cpt ; dhh
"RTN","IBDFN14",40,0)
 .S IBINACT=$S($P(^IBE(357.69,X,0),"^",4):1,$P($$CPT^ICPTCOD(X),"^",7)=0:1,1:"")
"RTN","IBDFN14",41,0)
 Q
"RTN","IBDFN14",42,0)
ED(X) ; -- return descr and active flag for education topics
"RTN","IBDFN14",43,0)
 ; -- pass X equal to ien for education topic
"RTN","IBDFN14",44,0)
 ;
"RTN","IBDFN14",45,0)
 Q:'X
"RTN","IBDFN14",46,0)
 S (IBID,IBLABEL,IBINACT)=""
"RTN","IBDFN14",47,0)
 I $G(^AUTTEDT(X,0))]"" S IBID="ED TOPIC",IBLABEL=$P(^(0),"^"),IBINACT=$P(^(0),"^",3)
"RTN","IBDFN14",48,0)
 Q
"RTN","IBDFN14",49,0)
EXAM(X) ; -- return descr and active flag for exam
"RTN","IBDFN14",50,0)
 ; -- pass X equal to ien for exam
"RTN","IBDFN14",51,0)
 ;
"RTN","IBDFN14",52,0)
 Q:'X
"RTN","IBDFN14",53,0)
 S (IBID,IBLABEL,IBINACT)=""
"RTN","IBDFN14",54,0)
 I $G(^AUTTEXAM(X,0))]"" S IBID="EXAM",IBLABEL=$P(^(0),"^"),IBINACT=$P(^(0),"^",4)
"RTN","IBDFN14",55,0)
 Q
"RTN","IBDFN14",56,0)
HF(X) ; -- return descr and active flag for health factor
"RTN","IBDFN14",57,0)
 ; -- pass X equal to ien for health factor
"RTN","IBDFN14",58,0)
 ;
"RTN","IBDFN14",59,0)
 Q:'X
"RTN","IBDFN14",60,0)
 S (IBID,IBLABEL,IBINACT)=""
"RTN","IBDFN14",61,0)
 I $G(^AUTTHF(X,0))]"" S IBID="FACTOR",IBLABEL=$P(^(0),"^"),IBINACT=$P(^(0),"^",11)
"RTN","IBDFN14",62,0)
 Q
"RTN","IBDFN14",63,0)
 ;
"RTN","IBDFN14",64,0)
IMMUN(X) ; -- return descr and active flag for immunization
"RTN","IBDFN14",65,0)
 ; -- pass X equal to ien for immunization
"RTN","IBDFN14",66,0)
 ;
"RTN","IBDFN14",67,0)
 Q:'X
"RTN","IBDFN14",68,0)
 S (IBID,IBLABEL,IBINACT)=""
"RTN","IBDFN14",69,0)
 I $G(^AUTTIMM(X,0))]"" S IBID="IMMUN",IBLABEL=$P(^(0),"^"),IBINACT=$P(^(0),"^",7)
"RTN","IBDFN14",70,0)
 Q
"RTN","IBDFN14",71,0)
 ;
"RTN","IBDFN14",72,0)
TREAT(X) ; -- return descr and active flag for treatment
"RTN","IBDFN14",73,0)
 ; -- pass X equal to ien for TREATMENTS
"RTN","IBDFN14",74,0)
 ;
"RTN","IBDFN14",75,0)
 Q:'X
"RTN","IBDFN14",76,0)
 S (IBID,IBLABEL,IBINACT)=""
"RTN","IBDFN14",77,0)
 I $G(^AUTTTRT(X,0))]"" S IBID="TREATMENT",IBLABEL=$P(^(0),"^"),IBINACT=$P(^(0),"^",4)
"RTN","IBDFN14",78,0)
 Q
"RTN","IBDFN14",79,0)
 ;
"RTN","IBDFN14",80,0)
ST(X) ; -- return descr and active flag for immunization
"RTN","IBDFN14",81,0)
 ; -- pass X equal to ien for immunization
"RTN","IBDFN14",82,0)
 ;
"RTN","IBDFN14",83,0)
 Q:'X
"RTN","IBDFN14",84,0)
 S (IBID,IBLABEL,IBINACT)=""
"RTN","IBDFN14",85,0)
 I $G(^AUTTSK(X,0))]"" S IBID="SKIN TEST",IBLABEL=$P(^(0),"^"),IBINACT=$P(^(0),"^",3)
"RTN","IBDFN14",86,0)
 Q
"RTN","IBDFN14",87,0)
YN(X) ; -- return descr
"RTN","IBDFN14",88,0)
 ; -- pass X equal to 1 or 0
"RTN","IBDFN14",89,0)
 ;
"RTN","IBDFN14",90,0)
 Q:X']""
"RTN","IBDFN14",91,0)
 S IBID="VALUE"
"RTN","IBDFN14",92,0)
 S (IBLABEL,IBINACT)=""
"RTN","IBDFN14",93,0)
 I X S IBLABEL="YES" Q
"RTN","IBDFN14",94,0)
 S IBLABEL="NO" Q
"RTN","IBDFN14",95,0)
 Q
"RTN","IBDFN4")
0^27^B10281238
"RTN","IBDFN4",1,0)
IBDFN4 ;ALB/CJM - ENCOUNTER FORM - (entry points for selection routines);5/21/93
"RTN","IBDFN4",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDFN4",3,0)
 ;
"RTN","IBDFN4",4,0)
CPT ;select ambulatory procedures
"RTN","IBDFN4",5,0)
 N NAME,CODE,SCREEN,IBDESCR,IBDESCLG,QUIT
"RTN","IBDFN4",6,0)
 S QUIT=0
"RTN","IBDFN4",7,0)
 I '$D(@IBARY@("SCREEN")) D CPTSCRN Q:QUIT
"RTN","IBDFN4",8,0)
 E  S SCREEN=$G(@IBARY@("SCREEN"))
"RTN","IBDFN4",9,0)
 K DIC S DIC=81,DIC(0)="AEMQZ",DIC("S")=SCREEN
"RTN","IBDFN4",10,0)
 I $D(^ICPT) D ^DIC K DIC I +Y>0 D
"RTN","IBDFN4",11,0)
 .;;change to api cpt;dhh
"RTN","IBDFN4",12,0)
 .S CODE=$P(Y(0),U)
"RTN","IBDFN4",13,0)
 .S CODE=$$CPT^ICPTCOD(CODE)
"RTN","IBDFN4",14,0)
 .I +CODE=-1 K @IBARY Q
"RTN","IBDFN4",15,0)
 .S NAME=$P(CODE,"^",3)
"RTN","IBDFN4",16,0)
 .S IBDESCLG=$$CPTD^ICPTCOD(+CODE,.IBCPTD)
"RTN","IBDFN4",17,0)
 .S IBDESCR=$G(IBCPTD(1))_" "_$G(IBCPTD(2))
"RTN","IBDFN4",18,0)
 .S @IBARY=$P(CODE,"^",2)_"^"_NAME_"^"_IBDESCR
"RTN","IBDFN4",19,0)
 E  K @IBARY ;kill either if file doesn't exist or nothing chosen
"RTN","IBDFN4",20,0)
 Q
"RTN","IBDFN4",21,0)
CPTSCRN ;
"RTN","IBDFN4",22,0)
 S SCREEN="I '$P(^(0),U,4)"
"RTN","IBDFN4",23,0)
 ;
"RTN","IBDFN4",24,0)
 ;don't ask the user about categories - it doesn't work well 
"RTN","IBDFN4",25,0)
 ;K DIR S DIR(0)="YA",DIR("A")="Do you want to select a CPT from a particular CPT category? ",DIR("?")="Answer YES if you want to screen out all CPT codes that do not belong to a particular category",DIR("B")="NO"
"RTN","IBDFN4",26,0)
 ;I $D(^DIC(81.1)) D ^DIR K DIR S:$D(DIRUT) QUIT=1 Q:$D(DIRUT)  I +Y D
"RTN","IBDFN4",27,0)
 ;.K DIC S DIC="81.1",DIC(0)="AEQ",DIC("S")="I $P(^(0),U,2)=""m"""
"RTN","IBDFN4",28,0)
 ;.D ^DIC K DIC I +Y>0 S SCREEN=SCREEN_",$P($G(^DIC(81.1,+$P(^(0),U,3),0)),U,3)="_+Y
"RTN","IBDFN4",29,0)
 S @IBARY@("SCREEN")=SCREEN
"RTN","IBDFN4",30,0)
 Q
"RTN","IBDFN4",31,0)
 ;
"RTN","IBDFN4",32,0)
ICD9 ;select ICD-9 codes
"RTN","IBDFN4",33,0)
 N IBDX,CODE,SCREEN,IBDESCR,QUIT
"RTN","IBDFN4",34,0)
 S QUIT=0
"RTN","IBDFN4",35,0)
 I $D(@IBARY@("SCREEN")) S SCREEN=$G(@IBARY@("SCREEN"))
"RTN","IBDFN4",36,0)
 E  D ICD9SCRN Q:QUIT
"RTN","IBDFN4",37,0)
 S DIC=80,DIC(0)="AEMQZI",DIC("S")=SCREEN
"RTN","IBDFN4",38,0)
 I $D(^ICD9) D ^DIC K DIC I +Y>0 D
"RTN","IBDFN4",39,0)
 .S CODE=$P(Y(0),U),IBDX=$P(Y(0),U,3),IBDESCR=$P($G(^ICD9(+Y,1)),"^")
"RTN","IBDFN4",40,0)
 .S @IBARY=CODE_"^"_IBDX_"^"_IBDESCR
"RTN","IBDFN4",41,0)
 E  K @IBARY ;kill if either file doesn't exist or nothing chosen - this is how to let the encounter form utilities know nothing was selected
"RTN","IBDFN4",42,0)
 Q
"RTN","IBDFN4",43,0)
ICD9SCRN ;
"RTN","IBDFN4",44,0)
 S SCREEN="I '$P(^(0),U,9)"
"RTN","IBDFN4",45,0)
 ;
"RTN","IBDFN4",46,0)
 ;don't ask the user about categories - it doesn't work well 
"RTN","IBDFN4",47,0)
 ;K DIR S DIR(0)="YA",DIR("A")="Do you want to select an ICD diagnosis from a particular diagnostic category? ",DIR("B")="NO"
"RTN","IBDFN4",48,0)
 ;S DIR("?")="Answer YES if you want to screen out all diagnosis codes that do not belong to a particular category"
"RTN","IBDFN4",49,0)
 ;I $D(^DIC(80.3)) D ^DIR K DIR S:$D(DIRUT) QUIT=1 Q:$D(DIRUT)  I +Y D
"RTN","IBDFN4",50,0)
 ;.K DIC S DIC="80.3",DIC(0)="AEQ"
"RTN","IBDFN4",51,0)
 ;.D ^DIC K DIC I +Y>0 S SCREEN=SCREEN_",+$P(^(0),U,5)="_+Y
"RTN","IBDFN4",52,0)
 S @IBARY@("SCREEN")=SCREEN
"RTN","IBDFN4",53,0)
 Q
"RTN","IBDFN4",54,0)
NULL ;returns NOTHING for selection
"RTN","IBDFN4",55,0)
 S @IBARY=""
"RTN","IBDFN4",56,0)
 Q
"RTN","IBDFN4",57,0)
 ;
"RTN","IBDFN4",58,0)
VSIT ; -- Select only visit cpt codes
"RTN","IBDFN4",59,0)
 N NAME,CODE,IBDESCR,QUIT,DIC,X,Y,IBHDR,IBTXT
"RTN","IBDFN4",60,0)
 S QUIT=0
"RTN","IBDFN4",61,0)
 ;
"RTN","IBDFN4",62,0)
 S DIC="^IBE(357.69,",DIC(0)="AEMQZ",DIC("S")="I '$P(^(0),U,4)"
"RTN","IBDFN4",63,0)
 D ^DIC K DIC I +Y>0 D
"RTN","IBDFN4",64,0)
 .;;----change to api cpt;dhh
"RTN","IBDFN4",65,0)
 .S CODE=$P(Y(0),U),IBHDR=$P(Y(0),U,2),IBTXT=$P(Y(0),U,3)
"RTN","IBDFN4",66,0)
 .S NODE=$$CPT^ICPTCOD(CODE)
"RTN","IBDFN4",67,0)
 .I +NODE=-1 S IBSNM="" Q
"RTN","IBDFN4",68,0)
 .S IBSNM=$P(NODE,U,3)
"RTN","IBDFN4",69,0)
 .S @IBARY=CODE_"^"_IBTXT_"^"_IBHDR_"^"_IBSNM
"RTN","IBDFN4",70,0)
 E  K @IBARY ;kill if nothing chosen
"RTN","IBDFN4",71,0)
 Q
"RTN","IBDFN4",72,0)
 ;
"RTN","IBDFN4",73,0)
PRVDR ;for selecting provider
"RTN","IBDFN4",74,0)
 D GETPRO^IBDF18B(IBCLINIC,IBARY)
"RTN","IBDFN4",75,0)
 Q
"RTN","IBDFN4",76,0)
 ;
"RTN","IBDFN4",77,0)
IBPFID ;for printing the form # assigned by form tracking
"RTN","IBDFN4",78,0)
 S @IBARY=$G(IBPFID)
"RTN","IBDFN4",79,0)
 Q
"RTN","IBDFN4",80,0)
 ;
"RTN","IBDFN4",81,0)
PCPR ; -- get primary care provider for a patient
"RTN","IBDFN4",82,0)
 S @IBARY=$P($$OUTPTPR^SDUTL3(DFN,DT),"^",2)
"RTN","IBDFN4",83,0)
 Q
"RTN","IBDFN4",84,0)
 ;
"RTN","IBDFN4",85,0)
PCTM ; -- get primary care team for a patient
"RTN","IBDFN4",86,0)
 S @IBARY=$P($$OUTPTTM^SDUTL3(DFN,DT),"^",2)
"RTN","IBDFN4",87,0)
 Q
"RTN","IBDFN4",88,0)
 ;
"RTN","IBDFN4",89,0)
SCCOND ; -- display sc conditions
"RTN","IBDFN4",90,0)
 Q:'$G(DFN)
"RTN","IBDFN4",91,0)
 D DIS^DGRPDB
"RTN","IBDFN4",92,0)
 W !
"RTN","IBDFN4",93,0)
 Q
"RTN","IBDFN4",94,0)
 ;
"RTN","IBDFN4",95,0)
 ;
"RTN","IBDFN4",96,0)
CPTMOD ;- Select active CPT Modifiers
"RTN","IBDFN4",97,0)
 ;- (used in selecting CPT Modifier(s) when creating the CPT Modifier
"RTN","IBDFN4",98,0)
 ;   Display ToolKit Block)
"RTN","IBDFN4",99,0)
 ;
"RTN","IBDFN4",100,0)
 N CODE,DIC,NAME,SCREEN
"RTN","IBDFN4",101,0)
 Q:$G(IBARY)=""
"RTN","IBDFN4",102,0)
 ;
"RTN","IBDFN4",103,0)
 ;- Screen out inactive CPT modifiers
"RTN","IBDFN4",104,0)
 S SCREEN="I '$P(^(0),U,5)"
"RTN","IBDFN4",105,0)
 I '$D(@IBARY@("SCREEN")) S @IBARY@("SCREEN")=SCREEN
"RTN","IBDFN4",106,0)
 S DIC=81.3
"RTN","IBDFN4",107,0)
 S DIC(0)="AEMQZ"
"RTN","IBDFN4",108,0)
 S DIC("S")=SCREEN
"RTN","IBDFN4",109,0)
 D ^DIC
"RTN","IBDFN4",110,0)
 I +Y>0 D
"RTN","IBDFN4",111,0)
 . ;- Use first 35 chars of modifier description
"RTN","IBDFN4",112,0)
 . S CODE=$P(Y(0),"^"),NAME=$E($P(Y(0),"^",2),1,35)
"RTN","IBDFN4",113,0)
 . S @IBARY=CODE_"^"_NAME
"RTN","IBDFN4",114,0)
 ;
"RTN","IBDFN4",115,0)
 ;- Kill if file doesn't exist or nothing chosen
"RTN","IBDFN4",116,0)
 E  K @IBARY
"RTN","IBDFN4",117,0)
 Q
"RTN","IBDFN7")
0^28^B3804156
"RTN","IBDFN7",1,0)
IBDFN7 ;ALB/CJM - ENCOUNTER FORM - validate logic for data ;MAY 10,1995
"RTN","IBDFN7",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDFN7",3,0)
 ;
"RTN","IBDFN7",4,0)
TESTCPT ;does X point to a valid CPT4 code? Kills X if not.
"RTN","IBDFN7",5,0)
 ;
"RTN","IBDFN7",6,0)
 ;;change to api cpt;dhh
"RTN","IBDFN7",7,0)
 N XX
"RTN","IBDFN7",8,0)
 S Y=""
"RTN","IBDFN7",9,0)
 I $G(X)="" K X Q
"RTN","IBDFN7",10,0)
 S XX=$$CPT^ICPTCOD($G(X))
"RTN","IBDFN7",11,0)
 I +XX=-1 K X Q
"RTN","IBDFN7",12,0)
 I $P(XX,U,7)'=1 K X S Y=$P(XX,U,3) Q
"RTN","IBDFN7",13,0)
 S X=$P(XX,U) ;set X equal ien of cpt code
"RTN","IBDFN7",14,0)
 Q
"RTN","IBDFN7",15,0)
 ;
"RTN","IBDFN7",16,0)
TESTICD ; -- does X point to a valid ICD9 code? Kills X if not.
"RTN","IBDFN7",17,0)
 ; -- input the icd code in X
"RTN","IBDFN7",18,0)
 ;
"RTN","IBDFN7",19,0)
 I $G(X)="" K X S Y="" Q
"RTN","IBDFN7",20,0)
 S:$E(X,$L(X))'=" " X=X_" " ; use ba xref, add space to end for lookup.
"RTN","IBDFN7",21,0)
 S X=$O(^ICD9("BA",X,0)) I 'X K X S Y="" Q
"RTN","IBDFN7",22,0)
 I '$D(^ICD9(X,0)) K X S Y="" Q
"RTN","IBDFN7",23,0)
 I $P($G(^ICD9(X,0)),"^",9) S Y=$P(^ICD9(X,0),"^",3) K X
"RTN","IBDFN7",24,0)
 Q
"RTN","IBDFN7",25,0)
 ;
"RTN","IBDFN7",26,0)
TESTVST ;does X point to a valid visit code? If not, kills X.
"RTN","IBDFN7",27,0)
 ;checks that X is a valid CPT4 code and that there is a corresponding entry in the TYPE OF VISIT file that is active
"RTN","IBDFN7",28,0)
 N IEN,XX
"RTN","IBDFN7",29,0)
 I $G(X)="" K X S Y="" Q
"RTN","IBDFN7",30,0)
 ;;change to api cpt;dhh
"RTN","IBDFN7",31,0)
 S XX=$$CPT^ICPTCOD(X)
"RTN","IBDFN7",32,0)
 I +XX=-1 K X S Y="" Q
"RTN","IBDFN7",33,0)
 I $P(XX,U,7)'=1 K X S Y=$P(XX,U,3) Q
"RTN","IBDFN7",34,0)
 S X=$P(XX,U) ;set X equal ien of cpt code
"RTN","IBDFN7",35,0)
 Q:'$D(X)
"RTN","IBDFN7",36,0)
 S IEN=$O(^IBE(357.69,"B",X,0)) K:'IEN X I IEN K:$P($G(^IBE(357.69,IEN,0)),"^",4) X
"RTN","IBDFN7",37,0)
 Q
"RTN","IBDFN7",38,0)
 ;
"RTN","IBDFN7",39,0)
TESTLEX ; -- Is clinical lexicon pointer valid and does icdone, not return 799.9
"RTN","IBDFN7",40,0)
 S IBDLEXV=1
"RTN","IBDFN7",41,0)
 I $D(^LEX)>1 S X="LEXSET" X ^%ZOSF("TEST") I $T S IBDLEXV=2
"RTN","IBDFN7",42,0)
 I IBDLEXV=1 D
"RTN","IBDFN7",43,0)
 .I $G(X)="" K X S Y="" Q
"RTN","IBDFN7",44,0)
 .I '$D(^GMP(757.01,+X,0)) K X S Y="" Q
"RTN","IBDFN7",45,0)
 .S VAL=$$ICDONE^GMPTU(X)
"RTN","IBDFN7",46,0)
 .I VAL="" K X S Y="No ICD9 code" Q
"RTN","IBDFN7",47,0)
 .I VAL=799.9 K X S Y="ICD9 code 799.9" Q
"RTN","IBDFN7",48,0)
 .I $G(X)="" K X S Y="" Q
"RTN","IBDFN7",49,0)
 .Q
"RTN","IBDFN7",50,0)
 I IBDLEXV>1 D
"RTN","IBDFN7",51,0)
 .I $G(X)="" K X S Y="" Q
"RTN","IBDFN7",52,0)
 .I '$D(^LEX(757.01,+X,0)) K X S Y="" Q
"RTN","IBDFN7",53,0)
 .S VAL=$$ICDONE^LEXU(X)
"RTN","IBDFN7",54,0)
 .I VAL="" K X S Y="No ICD9 code" Q
"RTN","IBDFN7",55,0)
 .I VAL=799.9 K X S Y="ICD9 code 799.9" Q
"RTN","IBDFN7",56,0)
 .Q
"RTN","IBDFN7",57,0)
 Q
"RTN","IBDFN8")
0^29^B509843
"RTN","IBDFN8",1,0)
IBDFN8 ;ALB/CJM - ENCOUNTER FORM - PCE GDI INPUT TRANSFORMS;AUG 10, 1995
"RTN","IBDFN8",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**25,38**;APR 24, 1997
"RTN","IBDFN8",3,0)
 ;
"RTN","IBDFN8",4,0)
INPUTCPT(X) ;changes X,a CPT code, into its ien
"RTN","IBDFN8",5,0)
 ;
"RTN","IBDFN8",6,0)
 ;   --input: cpt code
"RTN","IBDFN8",7,0)
 ;   
"RTN","IBDFN8",8,0)
 ;   --output: ien of cpt code (file #81)
"RTN","IBDFN8",9,0)
 ;
"RTN","IBDFN8",10,0)
 S X=$$UPP(X)
"RTN","IBDFN8",11,0)
 S X=+$$CPT^ICPTCOD(X)
"RTN","IBDFN8",12,0)
 I +X=-1 K X Q
"RTN","IBDFN8",13,0)
 Q
"RTN","IBDFN8",14,0)
 ;
"RTN","IBDFN8",15,0)
INPUTICD(ICD) ;changes X, an ICD9 code, into its ien
"RTN","IBDFN8",16,0)
 ;
"RTN","IBDFN8",17,0)
 S ICD=$$UPP(ICD)
"RTN","IBDFN8",18,0)
 S X=$O(^ICD9("BA",ICD_" ",0))
"RTN","IBDFN8",19,0)
 K:'X X
"RTN","IBDFN8",20,0)
 Q
"RTN","IBDFN8",21,0)
 ;
"RTN","IBDFN8",22,0)
UPP(X) ; -- convert lower case to upper case (especially when in codes above)
"RTN","IBDFN8",23,0)
 Q $TR(X,"zxcvbnmlkjhgfdsaqwertyuiop","ZXCVBNMLKJHGFDSAQWERTYUIOP")
"RTN","IBDFN9")
0^30^B561836
"RTN","IBDFN9",1,0)
IBDFN9 ;ALB/CJM - ENCOUNTER FORM - output transforms for data ;MAY 10, 1995
"RTN","IBDFN9",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDFN9",3,0)
 ;
"RTN","IBDFN9",4,0)
DSPLYCPT(IEN) ;output transform for CPT codes (file #81)
"RTN","IBDFN9",5,0)
 ;example of use: S Y=$$DSPLYCPT^IBDFN9(Y)
"RTN","IBDFN9",6,0)
 ;;change to api cpt;dhh
"RTN","IBDFN9",7,0)
 N CODE
"RTN","IBDFN9",8,0)
 S CODE=$$CPT^ICPTCOD(IEN)
"RTN","IBDFN9",9,0)
 I +CODE=-1 S CODE=""
"RTN","IBDFN9",10,0)
 E  S CODE=$P(CODE,U,2)
"RTN","IBDFN9",11,0)
 Q CODE
"RTN","IBDFN9",12,0)
 ;
"RTN","IBDFN9",13,0)
DSPLYICD(IEN) ;output transform for ICD9 codes (file #80)
"RTN","IBDFN9",14,0)
 ;example of use: S Y=$$DSPLYICD^IBDFN9(Y)
"RTN","IBDFN9",15,0)
 Q $P($G(^ICD9(+$G(IEN),0)),"^")
"RTN","IBDFN9",16,0)
 ;
"RTN","IBDFN9",17,0)
DSPLYPRV(IEN) ;output transform for provider (file #200)
"RTN","IBDFN9",18,0)
 ;example of use: S Y=$$DSPLYPRV^IBDFN9(Y)
"RTN","IBDFN9",19,0)
 Q $P($G(^VA(200,+$G(IEN),0)),"^")
"RTN","IBDFN9",20,0)
 ;
"RTN","IBDFN9",21,0)
DSPLYYN(Y) ;changes 1 to YES and 0 or "" to NO
"RTN","IBDFN9",22,0)
 Q:Y=1 "YES"
"RTN","IBDFN9",23,0)
 Q:(Y=0)!(Y="") "NO"
"RTN","IBDFN9",24,0)
 Q " "
"RTN","IBDFN9",25,0)
VARVAL(Y) ;determines PCE DIM NODE VALUE
"RTN","IBDFN9",26,0)
 Q:'$D(Y) ""
"RTN","IBDFN9",27,0)
 Q $S(Y="SC":6,Y="AO":7,Y="IR":8,Y="EC":9,1:"")
"RTN","IBDFQEA")
0^15^B31331634
"RTN","IBDFQEA",1,0)
IBDFQEA ;ALB/CJM/MAF - ENCOUNTER FORM - BUILD FORM(editing action for group's selections list) ;JUN 16,1995
"RTN","IBDFQEA",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**15,38**;APR 24, 1997
"RTN","IBDFQEA",3,0)
 ;
"RTN","IBDFQEA",4,0)
EDIT ;allows editing of an existing selection
"RTN","IBDFQEA",5,0)
 D FULL^VALM1
"RTN","IBDFQEA",6,0)
 N SEL,SUB,SLCTN,SC,NODE,OQTY,NQTY
"RTN","IBDFQEA",7,0)
 D EN^VALM2($G(XQORNOD(0)),"S")
"RTN","IBDFQEA",8,0)
 S SEL="" F  S SEL=$O(VALMY(SEL)) Q:'SEL  D
"RTN","IBDFQEA",9,0)
 .W !,"Editing Entry #",SEL
"RTN","IBDFQEA",10,0)
 .S SLCTN=$P($G(^TMP("SELIDX",$J,SEL)),"^",3) Q:'SLCTN
"RTN","IBDFQEA",11,0)
 .S NODE=$G(^IBE(357.3,SLCTN,0))
"RTN","IBDFQEA",12,0)
 .S IBGRP=$P(NODE,"^",4),ORD=$P(NODE,"^",5)
"RTN","IBDFQEA",13,0)
 .;re-index the record, to insure it is good                             
"RTN","IBDFQEA",14,0)
 .K DIK,DA S DIK="^IBE(357.3,",DA=SLCTN D IX^DIK K DIK
"RTN","IBDFQEA",15,0)
 .;edit the order of the selection - also, for placeholders, the text, then quit
"RTN","IBDFQEA",16,0)
 .I $P(NODE,"^",2) S DA=SLCTN,DIE=357.3,DR="[IBDF EDIT PLACE HOLDER]" D ^DIE K DIE,DA,DR Q
"RTN","IBDFQEA",17,0)
 .S DA=SLCTN,DIE=357.3,DR=".05;I '$P($G(^IBE(357.6,$P($G(^IBE(357.2,+IBLIST,0)),""^"",11),16)),""^"",8) S Y=""@99"";S OQTY=$P(^IBE(357.3,DA,0),""^"",9);.09;S NQTY=X;@99;S CONT=1" S CONT=0 D ^DIE K DIE,DA,DR
"RTN","IBDFQEA",18,0)
 .D CODES^IBDF4A W !
"RTN","IBDFQEA",19,0)
 .D ADD^IBDF4C W !
"RTN","IBDFQEA",20,0)
 .;add any missing subcolumns
"RTN","IBDFQEA",21,0)
 .S SC=0 F SC=1:1:8 I $G(IBLIST("SCTYPE",SC))=1 I '$D(^IBE(357.3,SLCTN,1,"B",SC)) D
"RTN","IBDFQEA",22,0)
 ..K DA,DO,DINUM,DIC
"RTN","IBDFQEA",23,0)
 ..N DLAYGO
"RTN","IBDFQEA",24,0)
 ..S DIC="^IBE(357.3,"_SLCTN_",1,",DA(1)=SLCTN,X=SC,DIC(0)="L",DLAYGO=357.3 D FILE^DICN
"RTN","IBDFQEA",25,0)
 .;now allow the user to edit editable subcolumns - CONT=0 means the user up-arrowed out, so stop
"RTN","IBDFQEA",26,0)
 .I CONT S SUB=0 F  S SUB=$O(^IBE(357.3,SLCTN,1,SUB)) Q:'SUB  D
"RTN","IBDFQEA",27,0)
 ..S SC=+$G(^IBE(357.3,SLCTN,1,SUB,0)) I $G(IBLIST("SCTYPE",SC))=1,$G(IBLIST("SCPIECE",SC)),$G(IBLIST("SCEDITABLE",SC)) D
"RTN","IBDFQEA",28,0)
 ...I $G(^IBE(357.3,SLCTN,1,0))="" S ^IBE(357.3,SLCTN,1,0)="^357.31IA^"
"RTN","IBDFQEA",29,0)
 ...S DIE="^IBE(357.3,"_SLCTN_",1,",DA(1)=SLCTN,DA=SUB,DR=".02;S CONT=1",CONT=0 W !!,"Editing Subcolumn "_SC_": Header="_IBLIST("SCHDR",SC)
"RTN","IBDFQEA",30,0)
 ...S IBVAL=$P($G(^IBE(357.3,SLCTN,1,SUB,0)),"^",2)
"RTN","IBDFQEA",31,0)
 ...I $G(OQTY)'=$G(NQTY) D
"RTN","IBDFQEA",32,0)
 ....S IBVAL=$P(IBVAL," x "_OQTY)_$S(NQTY>1:" x "_NQTY,1:""),DR=".02////^S X=IBVAL;I;"_DR
"RTN","IBDFQEA",33,0)
 ...I $P($G(^IBE(357.3,SLCTN,3,0)),"^",4)>0 D
"RTN","IBDFQEA",34,0)
 ....S IBVAL=$P($G(^IBE(357.3,SLCTN,1,SUB,0)),"^",2)
"RTN","IBDFQEA",35,0)
 ....S:IBVAL'["w/ mod" IBVAL=IBVAL_" w/ mod"
"RTN","IBDFQEA",36,0)
 ....S DR=".02////^S X=IBVAL;I;"_DR
"RTN","IBDFQEA",37,0)
 ...D ^DIE K DIE,DA,DR,IBVAL I 'CONT Q
"RTN","IBDFQEA",38,0)
 .D NARR^IBDF4 W !
"RTN","IBDFQEA",39,0)
 .D TERM^IBDF4 W !
"RTN","IBDFQEA",40,0)
 ;
"RTN","IBDFQEA",41,0)
EDITEXIT ;
"RTN","IBDFQEA",42,0)
 G EXIT
"RTN","IBDFQEA",43,0)
DELETE ;allows the user to select selections to delete
"RTN","IBDFQEA",44,0)
 D FULL^VALM1
"RTN","IBDFQEA",45,0)
 N SEL
"RTN","IBDFQEA",46,0)
 D EN^VALM2($G(XQORNOD(0)))
"RTN","IBDFQEA",47,0)
 K DA
"RTN","IBDFQEA",48,0)
 S SEL="" F  S SEL=$O(VALMY(SEL)) Q:'SEL  D
"RTN","IBDFQEA",49,0)
 .S DIK="^IBE(357.3,",DA=$P($G(^TMP("SELIDX",$J,SEL)),"^",3) Q:'DA
"RTN","IBDFQEA",50,0)
 .S NODE=$G(^IBE(357.3,DA,0))
"RTN","IBDFQEA",51,0)
 .S IBGRP=$P(NODE,"^",4),ORD=$P(NODE,"^",5)
"RTN","IBDFQEA",52,0)
 .Q:'$$RUSURE^IBDFU5("Selection #"_SEL)
"RTN","IBDFQEA",53,0)
 .D ^DIK
"RTN","IBDFQEA",54,0)
 .D KILL^VALM10(SEL)
"RTN","IBDFQEA",55,0)
 K DIK,DA
"RTN","IBDFQEA",56,0)
 G EXIT
"RTN","IBDFQEA",57,0)
ADDSLCTN ;allows the user to add a selection to the selection group
"RTN","IBDFQEA",58,0)
 N QUIT,SUB
"RTN","IBDFQEA",59,0)
 ;
"RTN","IBDFQEA",60,0)
 D FULL^VALM1
"RTN","IBDFQEA",61,0)
 S IBRTN=IBLIST("RTN")
"RTN","IBDFQEA",62,0)
 I $G(IBLIST("CLRM")) S IBLIST("EDITING CLRM")=1
"RTN","IBDFQEA",63,0)
 D RTNDSCR^IBDFU1B(.IBRTN)
"RTN","IBDFQEA",64,0)
 I IBRTN("ACTION")'=3 D NOGOOD^IBDF4 G ADDEXIT
"RTN","IBDFQEA",65,0)
 K @IBRTN("DATA_LOCATION")
"RTN","IBDFQEA",66,0)
 S QUIT=0 F  D  G:QUIT EXIT  W !,"Now for another!",!
"RTN","IBDFQEA",67,0)
 .I '$$DORTN^IBDFU1B(.IBRTN) S QUIT=1 D NOGOOD^IBDF4 Q
"RTN","IBDFQEA",68,0)
 .I '$D(@IBRTN("DATA_LOCATION")) S QUIT=1 Q
"RTN","IBDFQEA",69,0)
 .S DIC="^IBE(357.4,",DIC(0)="AEMN",DIC("S")="I $P(^IBE(357.4,+Y,0),""^"",3)=IBLIST" D ^DIC K DIC S:X="^" QUIT=1 Q:QUIT  S IBGRP=+Y I Y<0 D  Q:QUIT=1
"RTN","IBDFQEA",70,0)
 ..W !!,"A SELECTION GROUP HEADER IS REQUIRED.... The selection will not be added if none is provided....Enter '??' for a list of choices.",!!
"RTN","IBDFQEA",71,0)
 ..S DIC="^IBE(357.4,",DIC(0)="AEMN",DIC("S")="I $P(^IBE(357.4,+Y,0),""^"",3)=IBLIST" D ^DIC K DIC S IBGRP=+Y I Y<0 S QUIT=1 Q
"RTN","IBDFQEA",72,0)
 .D ADDREC^IBDF4(.QUIT) ;edits and adds the selection
"RTN","IBDFQEA",73,0)
 .K @IBRTN("DATA_LOCATION")
"RTN","IBDFQEA",74,0)
ADDEXIT ;
"RTN","IBDFQEA",75,0)
 G EXIT
"RTN","IBDFQEA",76,0)
ADDBLANK ;allows the user to add a dummy selection to the selection group
"RTN","IBDFQEA",77,0)
 ;i.e., a place holder that will not actually print a selection
"RTN","IBDFQEA",78,0)
 ;
"RTN","IBDFQEA",79,0)
 ;
"RTN","IBDFQEA",80,0)
 N IBGRP
"RTN","IBDFQEA",81,0)
 D FULL^VALM1
"RTN","IBDFQEA",82,0)
 K DIC S DIC="^IBE(357.4,",DIC(0)="AEMN",DIC("S")="I $D(^IBE(357.3,""APO"",IBLIST,+Y))" D ^DIC S IBGRP=+Y K DIC
"RTN","IBDFQEA",83,0)
 I ('$D(DIRUT))&(Y>0) D ADD^IBDF4A
"RTN","IBDFQEA",84,0)
 D INIT^IBDFQSL1
"RTN","IBDFQEA",85,0)
 S VALMBCK="R"
"RTN","IBDFQEA",86,0)
 Q
"RTN","IBDFQEA",87,0)
FORMAT ;allows the user to format all of the selections in the group in mass
"RTN","IBDFQEA",88,0)
 ;
"RTN","IBDFQEA",89,0)
 D FORMAT^IBDF9A1
"RTN","IBDFQEA",90,0)
 G EXIT
"RTN","IBDFQEA",91,0)
 ;
"RTN","IBDFQEA",92,0)
GRPDEL ;  -- Group Delete
"RTN","IBDFQEA",93,0)
 D FULL^VALM1
"RTN","IBDFQEA",94,0)
 N GRP
"RTN","IBDFQEA",95,0)
 S DIC="^IBE(357.4,",DIC(0)="AEMN",DIC("S")="I $P(^IBE(357.4,+Y,0),""^"",3)=IBLIST" D ^DIC K DIC S IBGRP=+Y I Y<0 G EXIT
"RTN","IBDFQEA",96,0)
 S GRP=+Y
"RTN","IBDFQEA",97,0)
 Q:'$$RUSURE^IBDFU5($P($G(^IBE(357.4,GRP,0)),"^"))
"RTN","IBDFQEA",98,0)
 I GRP D DELSLCTN^IBDF3 K DA S DIK="^IBE(357.4,",DA=GRP D ^DIK K DIK
"RTN","IBDFQEA",99,0)
 D IDXGRP^IBDF3
"RTN","IBDFQEA",100,0)
 S VALMBCK="R"
"RTN","IBDFQEA",101,0)
 D EXIT Q
"RTN","IBDFQEA",102,0)
 ;
"RTN","IBDFQEA",103,0)
GROUPADD ;  -- Add a new group to the selection list and to file 357.4.
"RTN","IBDFQEA",104,0)
 D FULL^VALM1
"RTN","IBDFQEA",105,0)
 N NAME,QUIT,GRP
"RTN","IBDFQEA",106,0)
 S QUIT=0
"RTN","IBDFQEA",107,0)
 F  D  D IDXGRP^IBDF3 G:QUIT EXIT
"RTN","IBDFQEA",108,0)
 .K DIR S DIR(0)="357.4,.01O",DIR("B")="" D ^DIR K DIR I $D(DIRUT) S QUIT=1 Q
"RTN","IBDFQEA",109,0)
 .S NAME=Y
"RTN","IBDFQEA",110,0)
 .K DIC,DD,DO,DINUM S DIC="^IBE(357.4,",X=NAME,DIC(0)=""
"RTN","IBDFQEA",111,0)
 .D FILE^DICN K DIC,DIE,DA
"RTN","IBDFQEA",112,0)
 .I +Y<0 W !,"Unable to create a new record!" D PAUSE^VALM1 S QUIT=1 Q
"RTN","IBDFQEA",113,0)
 .I +Y>0 K DA S DA=+Y,DIE="^IBE(357.4,",DIE("NO^")="Any value",DR=".02;.04;.03////"_IBLIST D ^DIE K DIC,DIE,DR,DA
"RTN","IBDFQEA",114,0)
 .W !,"Now Another!",!
"RTN","IBDFQEA",115,0)
 G EXIT
"RTN","IBDFQEA",116,0)
 ;
"RTN","IBDFQEA",117,0)
GRPEDIT ;
"RTN","IBDFQEA",118,0)
 D FULL^VALM1
"RTN","IBDFQEA",119,0)
 N DIC,DIE,DA,DR,GRP
"RTN","IBDFQEA",120,0)
 S DIC="^IBE(357.4,",DIC(0)="AEMN",DIC("S")="I $P(^IBE(357.4,+Y,0),""^"",3)=IBLIST" D ^DIC K DIC S IBGRP=+Y I Y<0 G EXIT
"RTN","IBDFQEA",121,0)
 S GRP=+Y
"RTN","IBDFQEA",122,0)
 S (DIC,DIE)="^IBE(357.4,",DA=GRP,DR=".01;.02;.04" D ^DIE
"RTN","IBDFQEA",123,0)
 I '$D(DA) D DELSLCTN^IBDF3
"RTN","IBDFQEA",124,0)
 D IDXGRP^IBDF3
"RTN","IBDFQEA",125,0)
 S VALMBCK="R"
"RTN","IBDFQEA",126,0)
 D EXIT Q
"RTN","IBDFQEA",127,0)
 Q
"RTN","IBDFQEA",128,0)
 ;
"RTN","IBDFQEA",129,0)
EXIT D INIT^IBDFQSL1 S VALMBCK="R"
"RTN","IBDFQEA",130,0)
 Q
"RTN","IBDFQEA",131,0)
GRPRESEQ ;  -- Resequence numerically or alphabetically a group
"RTN","IBDFQEA",132,0)
 ;     within a block.
"RTN","IBDFQEA",133,0)
 D FULL^VALM1
"RTN","IBDFQEA",134,0)
 N DIC,GRP,IBGRP,IBGRUP
"RTN","IBDFQEA",135,0)
 Q:$$LSTDSCR2^IBDFU1(.IBLIST) 1
"RTN","IBDFQEA",136,0)
GRP1 S DIC="^IBE(357.4,",DIC(0)="AEMN",DIC("S")="I $P(^IBE(357.4,+Y,0),""^"",3)=IBLIST" D ^DIC K DIC S IBGRUP(+Y)=+Y
"RTN","IBDFQEA",137,0)
 I Y<0&($D(IBGRUP)) D SEQUENCE^IBDF4,EXIT Q
"RTN","IBDFQEA",138,0)
 I Y<0&('$D(IBGRUP)) G EXIT
"RTN","IBDFQEA",139,0)
 G GRP1
"RTN","IBDFQEA",140,0)
GRPRSEQ1 ;  -- Resequence all groups chosen
"RTN","IBDFQEA",141,0)
 N IBGROUP,IBFLAG
"RTN","IBDFQEA",142,0)
 S IBGROUP=0,IBFLAG=1
"RTN","IBDFQEA",143,0)
 F  S IBGROUP=$O(IBGRP(IBGROUP)) Q:'IBGROUP  D SEQUENCE^IBDF4
"RTN","IBDFQEA",144,0)
 Q
"RTN","IBDFRPC2")
0^16^B53166622
"RTN","IBDFRPC2",1,0)
IBDFRPC2 ;ALB/AAS - Return list of selections, broker call ;29-JAN-96
"RTN","IBDFRPC2",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**34,38**;APR 24, 1997
"RTN","IBDFRPC2",3,0)
 ;
"RTN","IBDFRPC2",4,0)
SEL(RESULT,IBDF) ; -- Procedure
"RTN","IBDFRPC2",5,0)
 ; -- called by ibdfrpc1, returns list for one selection list
"RTN","IBDFRPC2",6,0)
 ;    see ibdfrpc1 for complete input/output lists
"RTN","IBDFRPC2",7,0)
 ; -- Input  IBDF("IEN")    := pointer to selection list (357.2)
"RTN","IBDFRPC2",8,0)
 ;           IBDF("PI")     := pointer to package interface (357.6) (optional)
"RTN","IBDFRPC2",9,0)
 ;           IBDF("DFN")    := pointer to patient (2) (optional)
"RTN","IBDFRPC2",10,0)
 ;           IBDF("CLINIC") := pointer to clinic (44) (optional)
"RTN","IBDFRPC2",11,0)
 ;
"RTN","IBDFRPC2",12,0)
 N OTEXT,TEXT,SC,TERM,COUNT,DCODE,SECOND,THIRD
"RTN","IBDFRPC2",13,0)
 I $E($G(RESULT),1)="^" S ARRY=RESULT
"RTN","IBDFRPC2",14,0)
 E  S ARRY="RESULT"
"RTN","IBDFRPC2",15,0)
 S COUNT=+$G(@ARRY@(0))
"RTN","IBDFRPC2",16,0)
 ;
"RTN","IBDFRPC2",17,0)
 S @ARRY@(0)="List not found"
"RTN","IBDFRPC2",18,0)
 G:'$G(IBDF("IEN")) SELQ
"RTN","IBDFRPC2",19,0)
 G:$G(^IBE(357.2,IBDF("IEN"),0))="" SELQ
"RTN","IBDFRPC2",20,0)
 ;K ^TMP("IBD-DUP",$J)
"RTN","IBDFRPC2",21,0)
 ;
"RTN","IBDFRPC2",22,0)
 ; -- copy list
"RTN","IBDFRPC2",23,0)
 I '$G(IBDF("RULE-ONLY")) D COPYLIST(.RESULT,IBDF("IEN"),.COUNT)
"RTN","IBDFRPC2",24,0)
 ;I COUNT D URH
"RTN","IBDFRPC2",25,0)
 ;
"RTN","IBDFRPC2",26,0)
 S @ARRY@(0)=COUNT_"^LIST^"
"RTN","IBDFRPC2",27,0)
 D GETQLF
"RTN","IBDFRPC2",28,0)
SELQ Q
"RTN","IBDFRPC2",29,0)
 ;
"RTN","IBDFRPC2",30,0)
GETQLF ; -- add selection rule and qualifiers from marking area
"RTN","IBDFRPC2",31,0)
 ;    subcolumns to results(0) node, but only for bubbles
"RTN","IBDFRPC2",32,0)
 N SC,NODE,BUBB,BUBBCNT
"RTN","IBDFRPC2",33,0)
 S SC=0,BUBBCNT=0,BUBB=$O(^IBE(357.91,"B","BUBBLE (use for scanning)",0)) Q:'BUBB
"RTN","IBDFRPC2",34,0)
 F  S SC=$O(^IBE(357.2,IBDF("IEN"),2,SC)) Q:'SC  D
"RTN","IBDFRPC2",35,0)
 .S NODE=$G(^IBE(357.2,IBDF("IEN"),2,SC,0))
"RTN","IBDFRPC2",36,0)
 .I $P(NODE,"^",4)=2,$P(NODE,"^",6)=BUBB S BUBBCNT=BUBBCNT+1,@ARRY@(0)=@ARRY@(0)_$P($G(^IBD(357.98,+$P(NODE,"^",9),0)),"^")_";;"_+$P(NODE,"^",10)_"::"
"RTN","IBDFRPC2",37,0)
 ;
"RTN","IBDFRPC2",38,0)
 ; -- if no bubbles then kill off array, leave zero node for reports
"RTN","IBDFRPC2",39,0)
 I BUBBCNT<1 S SC=@ARRY@(0) K @ARRY S @ARRY@(0)="0^"_$P(SC,"^",2,3) S $P(@ARRY@(0),"^",4)=1
"RTN","IBDFRPC2",40,0)
 Q
"RTN","IBDFRPC2",41,0)
 ;
"RTN","IBDFRPC2",42,0)
COPYLIST(RESULT,LIST,COUNT) ;copies the entries from LIST to @ARY, starting subscript at COUNT+1
"RTN","IBDFRPC2",43,0)
 ;
"RTN","IBDFRPC2",44,0)
 N SLCTN,SUBCOL,TEXT,IEN,NODE,TSUBCOL,NOTREAL,GROUP,ORDER,HDR,CSUBCOL,DCODE,QUANTITY,SECOND,THIRD
"RTN","IBDFRPC2",45,0)
 ;
"RTN","IBDFRPC2",46,0)
 I $E($G(RESULT),1)="^" S ARRY=RESULT
"RTN","IBDFRPC2",47,0)
 E  S ARRY="RESULT"
"RTN","IBDFRPC2",48,0)
 ;
"RTN","IBDFRPC2",49,0)
 S SUBCOL=$$SUBCOL(LIST),TSUBCOL=+SUBCOL,CSUBCOL=+$P(SUBCOL,"^",2)
"RTN","IBDFRPC2",50,0)
 ;
"RTN","IBDFRPC2",51,0)
 S PRNT=""
"RTN","IBDFRPC2",52,0)
 F  S PRNT=$O(^IBE(357.4,"APO",LIST,PRNT)) Q:PRNT=""  D
"RTN","IBDFRPC2",53,0)
 . S GROUP=""
"RTN","IBDFRPC2",54,0)
 . F  S GROUP=$O(^IBE(357.4,"APO",LIST,PRNT,GROUP)) Q:GROUP=""  D
"RTN","IBDFRPC2",55,0)
 .. S HDR=$P($G(^IBE(357.4,GROUP,0)),"^")
"RTN","IBDFRPC2",56,0)
 .. I $P($G(^IBE(357.4,GROUP,0)),"^",4)="I" S HDR="   "
"RTN","IBDFRPC2",57,0)
 .. I HDR="BLANK" S HDR="   "
"RTN","IBDFRPC2",58,0)
 .. S COUNT=COUNT+1,@ARRY@(COUNT)=HDR_"^^^^^^0"
"RTN","IBDFRPC2",59,0)
 .. S ORDER=""
"RTN","IBDFRPC2",60,0)
 .. F  S ORDER=$O(^IBE(357.3,"APO",LIST,GROUP,ORDER)) Q:ORDER=""  D
"RTN","IBDFRPC2",61,0)
 ... S SLCTN=0
"RTN","IBDFRPC2",62,0)
 ... F  S SLCTN=$O(^IBE(357.3,"APO",LIST,GROUP,ORDER,SLCTN)) Q:'SLCTN  D
"RTN","IBDFRPC2",63,0)
 .... S (TEXT,DCODE,OTEXT,TERM,NOTREAL,IEN,SECOND,THIRD)=""
"RTN","IBDFRPC2",64,0)
 .... S NODE=$G(^IBE(357.3,SLCTN,0)),IEN=$P(NODE,"^")
"RTN","IBDFRPC2",65,0)
 .... S QUANTITY=$P(NODE,"^",9)
"RTN","IBDFRPC2",66,0)
 .... ;
"RTN","IBDFRPC2",67,0)
 .... ; -- handle place holder as headers
"RTN","IBDFRPC2",68,0)
 .... S NOTREAL=$P(NODE,"^",2)
"RTN","IBDFRPC2",69,0)
 .... I NOTREAL,$P(NODE,"^",6)'="" D  Q
"RTN","IBDFRPC2",70,0)
 ..... I $P(NODE,"^",7) S COUNT=COUNT+1,HDR=$P(NODE,"^",6),@ARRY@(COUNT)=HDR_"^^^^^^0" Q
"RTN","IBDFRPC2",71,0)
 ..... I $P(NODE,"^",8) S COUNT=COUNT+1,HDR="   ",@ARRY@(COUNT)=HDR_"^^^^^^0" Q
"RTN","IBDFRPC2",72,0)
 .....;
"RTN","IBDFRPC2",73,0)
 .... ; -- find text for entry
"RTN","IBDFRPC2",74,0)
 .... S SUBCOL=$O(^IBE(357.3,SLCTN,1,"B",+TSUBCOL,0))
"RTN","IBDFRPC2",75,0)
 .... S NODE=$G(^IBE(357.3,+SLCTN,1,+SUBCOL,0))
"RTN","IBDFRPC2",76,0)
 .... S:$P(NODE,"^")=TSUBCOL TEXT=$P(NODE,"^",2)
"RTN","IBDFRPC2",77,0)
 .... ;
"RTN","IBDFRPC2",78,0)
 .... ; -- find display code for entry
"RTN","IBDFRPC2",79,0)
 .... S SUBCOL=$O(^IBE(357.3,+SLCTN,1,"B",+CSUBCOL,0))
"RTN","IBDFRPC2",80,0)
 .... S NODE=$G(^IBE(357.3,+SLCTN,1,+SUBCOL,0))
"RTN","IBDFRPC2",81,0)
 .... S:$P(NODE,"^")=CSUBCOL DCODE=$P(NODE,"^",2)
"RTN","IBDFRPC2",82,0)
 .... ;
"RTN","IBDFRPC2",83,0)
 .... ; -- find optional caption and lexicon pointer
"RTN","IBDFRPC2",84,0)
 .... S NODE=$G(^IBE(357.3,SLCTN,2))
"RTN","IBDFRPC2",85,0)
 .... S OTEXT=$P(NODE,"^"),TERM=$P(NODE,"^",2)
"RTN","IBDFRPC2",86,0)
 .... ;
"RTN","IBDFRPC2",87,0)
 .... ; -- find optional second and third codes
"RTN","IBDFRPC2",88,0)
 .... S SECOND=$P(NODE,"^",3),THIRD=$P(NODE,"^",4)
"RTN","IBDFRPC2",89,0)
 .... ;
"RTN","IBDFRPC2",90,0)
 .... ; -- add to array.  Is dup ien or ien+text???
"RTN","IBDFRPC2",91,0)
 .... I $L(TEXT) S COUNT=COUNT+1 D BLDA Q
"RTN","IBDFRPC2",92,0)
 .... ;I $L(TEXT),'$D(IBDUP(IEN_"^"_TEXT)) S COUNT=COUNT+1,IBDUP(IEN_"^"_TEXT)="" D BLDA Q  ;this line checks ien+text for duplicates
"RTN","IBDFRPC2",93,0)
 ;
"RTN","IBDFRPC2",94,0)
 K ^TMP("IBD-DUP",$J)
"RTN","IBDFRPC2",95,0)
 Q
"RTN","IBDFRPC2",96,0)
 ;
"RTN","IBDFRPC2",97,0)
SUBCOL(LIST) ; -- function
"RTN","IBDFRPC2",98,0)
 ; -- returns the subcolumn containing the text
"RTN","IBDFRPC2",99,0)
 ;    input  LIST := selection list internal entry
"RTN","IBDFRPC2",100,0)
 ; -- Assumes data returned by the package interface, piece 2 is the description
"RTN","IBDFRPC2",101,0)
 ;
"RTN","IBDFRPC2",102,0)
 N SC,TSUBCOL,CSUBCOL
"RTN","IBDFRPC2",103,0)
 S (TSUBCOL,CSUBCOL)=""
"RTN","IBDFRPC2",104,0)
 S SC=0
"RTN","IBDFRPC2",105,0)
 F  S SC=$O(^IBE(357.2,LIST,2,SC)) Q:'SC  D
"RTN","IBDFRPC2",106,0)
 .Q:$P($G(^IBE(357.2,LIST,2,SC,0)),"^",4)=2  ;is a marking area
"RTN","IBDFRPC2",107,0)
 .I $P($G(^IBE(357.2,LIST,2,SC,0)),"^",5)=2 S TSUBCOL=$P(^(0),"^") Q  ;data piece 2 is usually text subcol
"RTN","IBDFRPC2",108,0)
 .I $P($G(^IBE(357.2,LIST,2,SC,0)),"^",5)=1 S CSUBCOL=$P(^(0),"^") Q  ; data piece 1 is always code
"RTN","IBDFRPC2",109,0)
 .I TSUBCOL="",$P($G(^IBE(357.2,LIST,2,SC,0)),"^",5)>2 S TSUBCOL=$P(^(0),"^") Q  ; -- see if other than data piece two is text subcolumn
"RTN","IBDFRPC2",110,0)
 .I CSUBCOL="",$P($G(^IBE(357.2,LIST,2,SC,0)),"^",5)>2 S CSUBCOL=$P(^(0),"^") Q
"RTN","IBDFRPC2",111,0)
 Q TSUBCOL_"^"_CSUBCOL
"RTN","IBDFRPC2",112,0)
 ;
"RTN","IBDFRPC2",113,0)
BLDA ; -- build results array
"RTN","IBDFRPC2",114,0)
 S @ARRY@(COUNT)=TEXT ;B  ;;
"RTN","IBDFRPC2",115,0)
 S $P(@ARRY@(COUNT),"^",2)=$G(DCODE)
"RTN","IBDFRPC2",116,0)
 S $P(@ARRY@(COUNT),"^",3)=$S($G(NOTREAL):"",1:$G(IEN))
"RTN","IBDFRPC2",117,0)
 S $P(@ARRY@(COUNT),"^",4)=""
"RTN","IBDFRPC2",118,0)
 S $P(@ARRY@(COUNT),"^",5)=$G(OTEXT)
"RTN","IBDFRPC2",119,0)
 S $P(@ARRY@(COUNT),"^",6)=$G(TERM)
"RTN","IBDFRPC2",120,0)
 S $P(@ARRY@(COUNT),"^",7)=$S($G(NOTREAL):0,1:1)
"RTN","IBDFRPC2",121,0)
 S $P(@ARRY@(COUNT),"^",9)=$G(QUANTITY)
"RTN","IBDFRPC2",122,0)
 S $P(@ARRY@(COUNT),"^",10)=$G(SECOND)
"RTN","IBDFRPC2",123,0)
 S $P(@ARRY@(COUNT),"^",11)=$G(THIRD)
"RTN","IBDFRPC2",124,0)
 ;--added for  slctn to be passed also
"RTN","IBDFRPC2",125,0)
 S $P(@ARRY@(COUNT),"^",12)=$G(SLCTN)
"RTN","IBDFRPC2",126,0)
 Q
"RTN","IBDFRPC2",127,0)
 ;
"RTN","IBDFRPC2",128,0)
URH ; -- UnReferenced Headers removal
"RTN","IBDFRPC2",129,0)
 ;    if a header doesn't have any data under it, then remove the header
"RTN","IBDFRPC2",130,0)
 N X,HDR
"RTN","IBDFRPC2",131,0)
 S X=0 F  S X=$O(@ARRY@(X)) Q:'X  D
"RTN","IBDFRPC2",132,0)
 .I '$D(HDR),$P(@ARRY@(X),"^",1)="" S HDR=X Q  ;find a header
"RTN","IBDFRPC2",133,0)
 .I $P(@ARRY@(X),"^",1)="" K HDR Q  ; is item under header
"RTN","IBDFRPC2",134,0)
 .I $D(HDR),$P(@ARRY@(X),"^",1)="" K @ARRY@(HDR) S COUNT=COUNT-1,HDR=X ;hdr doesn't have any items, kill hdr node and reset header to next header
"RTN","IBDFRPC2",135,0)
 I $D(HDR) S X=$O(@ARRY@(""),-1) I $P(@ARRY@(X),"^",1)="" K @ARRY@(X) S COUNT=COUNT-1,HDR=X ;last item in list is a header
"RTN","IBDFRPC2",136,0)
 Q
"RTN","IBDFRPC2",137,0)
 ;
"RTN","IBDFRPC2",138,0)
DYN(RESULT,IBDF) ; -- Procedure
"RTN","IBDFRPC2",139,0)
 ; -- called by ibdfrpc1 to return selection list for dynamic selections
"RTN","IBDFRPC2",140,0)
 ;    see ibdfrpc1 for complete input/output lists
"RTN","IBDFRPC2",141,0)
 ; -- Input  IBDF("PI")     := pointer to package interface (357.6)
"RTN","IBDFRPC2",142,0)
 ;           IBDF("IEN")    := pointer to selection list (357.2)
"RTN","IBDFRPC2",143,0)
 ;           IBDF("DFN")    := pointer to patient (2) (optional for provider selections)
"RTN","IBDFRPC2",144,0)
 ;           IBDF("CLINIC") := pointer to clinic (44) (optional for active problem selections)
"RTN","IBDFRPC2",145,0)
 ;
"RTN","IBDFRPC2",146,0)
 N PI,DFN,CNT,COUNT,NAME,RTN,IBARY,IBCLINIC
"RTN","IBDFRPC2",147,0)
 I $E($G(RESULT),1)="^" S ARRY=RESULT
"RTN","IBDFRPC2",148,0)
 E  S ARRY="RESULT"
"RTN","IBDFRPC2",149,0)
 S COUNT=+$G(@ARRY@(0))
"RTN","IBDFRPC2",150,0)
 I '$G(IBDF("DFN")) S @ARRY@(0)="-1^Patient not defined" G DYNQ
"RTN","IBDFRPC2",151,0)
 I $G(^DPT(+IBDF("DFN"),0))="" S @ARRY@(0)="-1^Patient not Found" G DYNQ
"RTN","IBDFRPC2",152,0)
 S DFN=+$G(IBDF("DFN"))
"RTN","IBDFRPC2",153,0)
 I $G(IBDF("RULE-ONLY")) G RULE
"RTN","IBDFRPC2",154,0)
 ;
"RTN","IBDFRPC2",155,0)
 S @ARRY@(0)="List not found"
"RTN","IBDFRPC2",156,0)
 G:'$G(IBDF("IEN")) SELQ
"RTN","IBDFRPC2",157,0)
 G:$G(^IBE(357.2,IBDF("IEN"),0))="" DYNQ
"RTN","IBDFRPC2",158,0)
 ;
"RTN","IBDFRPC2",159,0)
 S @ARRY@(0)="-1^Package Interface Not found"
"RTN","IBDFRPC2",160,0)
 S PI=$G(^IBE(357.6,+$G(IBDF("PI")),0)) I PI="" G DYNQ
"RTN","IBDFRPC2",161,0)
 ;
"RTN","IBDFRPC2",162,0)
 S IBCLINIC=$G(IBDF("CLINIC"))
"RTN","IBDFRPC2",163,0)
 I +IBCLINIC'=IBCLINIC,IBCLINIC'="" S IBCLINIC=$O(^SC("B",IBCLINIC,0))
"RTN","IBDFRPC2",164,0)
 I +IBCLINIC=0 S @ARRY@(0)="Clinic Not Specified"
"RTN","IBDFRPC2",165,0)
 ; 
"RTN","IBDFRPC2",166,0)
 S NAME=$P(PI,"^"),RTN=$P(PI,"^",2,3) I RTN=""!(RTN="^") G DYNQ
"RTN","IBDFRPC2",167,0)
 I NAME["ACTIVE PROBLEM" S NAME="GMP SELECT PATIENT ACTIVE PROBLEMS"
"RTN","IBDFRPC2",168,0)
 S IBARY="^TMP(""IB"",$J,""INTERFACES"","""_NAME_""")"
"RTN","IBDFRPC2",169,0)
 D @RTN
"RTN","IBDFRPC2",170,0)
 ;
"RTN","IBDFRPC2",171,0)
 S @ARRY@(0)=+$G(@IBARY@(0))_"^LIST^"
"RTN","IBDFRPC2",172,0)
RULE I $G(IBDF("RULE-ONLY")) S @ARRY@(0)="1^DYNLIST^"
"RTN","IBDFRPC2",173,0)
 ;G DYNQ:@ARRY@(0)<1
"RTN","IBDFRPC2",174,0)
 D GETQLF
"RTN","IBDFRPC2",175,0)
 G:$G(IBDF("RULE-ONLY")) DYNQ
"RTN","IBDFRPC2",176,0)
 ;
"RTN","IBDFRPC2",177,0)
 S CNT=0 F  S CNT=$O(@IBARY@(CNT)) Q:'CNT  D
"RTN","IBDFRPC2",178,0)
 .Q:$G(@IBARY@(CNT))=""
"RTN","IBDFRPC2",179,0)
 .;
"RTN","IBDFRPC2",180,0)
 .; -- Process provider lists
"RTN","IBDFRPC2",181,0)
 .I NAME["PROVIDER" D  Q
"RTN","IBDFRPC2",182,0)
 ..I IBCLINIC<1 Q
"RTN","IBDFRPC2",183,0)
 ..S @ARRY@(CNT)=$P(@IBARY@(CNT),"^",2)_"^^"_$P(@IBARY@(CNT),"^",1)_"^^^^1" Q
"RTN","IBDFRPC2",184,0)
 .;
"RTN","IBDFRPC2",185,0)
 .; -- process patient active problem lists
"RTN","IBDFRPC2",186,0)
 .I NAME["ACTIVE PROBLEMS" D  Q
"RTN","IBDFRPC2",187,0)
 ..S @ARRY@(CNT)=$P(@IBARY@(CNT),"^",2)_"^"_$P(@IBARY@(CNT),"^",3)_"^"_+@IBARY@(CNT)_"^^^^1"
"RTN","IBDFRPC2",188,0)
 .I '$D(@ARRY@(CNT)) S @ARRY@(CNT)=@IBARY@(CNT)
"RTN","IBDFRPC2",189,0)
 ;
"RTN","IBDFRPC2",190,0)
DYNQ Q
"RTN","IBDFRPC2",191,0)
 ;
"RTN","IBDFRPC2",192,0)
 ; -- here are some sample tests for different lists
"RTN","IBDFRPC2",193,0)
TEST K VAR,IBDF
"RTN","IBDFRPC2",194,0)
 S IBDF("IEN")=489
"RTN","IBDFRPC2",195,0)
 D SEL(.VAR,.IBDF)
"RTN","IBDFRPC2",196,0)
 X "ZW VAR"
"RTN","IBDFRPC2",197,0)
 Q
"RTN","IBDFRPC2",198,0)
 ;
"RTN","IBDFRPC2",199,0)
TEST1 K VAR,IBDF
"RTN","IBDFRPC2",200,0)
 S IBDF("IEN")=488
"RTN","IBDFRPC2",201,0)
 D SEL(.VAR,.IBDF)
"RTN","IBDFRPC2",202,0)
 X "ZW VAR"
"RTN","IBDFRPC2",203,0)
 Q
"RTN","IBDFRPC2",204,0)
 ;
"RTN","IBDFRPC2",205,0)
TESTD ; -- Test dynamic
"RTN","IBDFRPC2",206,0)
 K VAR,IBDF
"RTN","IBDFRPC2",207,0)
 ;S IBDF("PI")=71,IBDF("IEN")=103 ;provider, 1577 FEX
"RTN","IBDFRPC2",208,0)
 ;S IBDF("PI")=73 ;patient active problems
"RTN","IBDFRPC2",209,0)
 ;S IBDF("CLINIC")=300
"RTN","IBDFRPC2",210,0)
 S IBDF("PI")=7,IBDF("IEN")=14 ;provider, 1577 FEX
"RTN","IBDFRPC2",211,0)
 ;S IBDF("PI")=73 ;patient active problems
"RTN","IBDFRPC2",212,0)
 S IBDF("DFN")=7169761
"RTN","IBDFRPC2",213,0)
 S IBDF("CLINIC")=88
"RTN","IBDFRPC2",214,0)
 D DYN(.VAR,.IBDF)
"RTN","IBDFRPC2",215,0)
 X "ZW VAR"
"RTN","IBDFRPC4")
0^17^B15949086
"RTN","IBDFRPC4",1,0)
IBDFRPC4 ;ALB/AAS - AICS Pass data to PCE, Broker Call ; 24-FEB-96
"RTN","IBDFRPC4",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDFRPC4",3,0)
 ;
"RTN","IBDFRPC4",4,0)
 ; -- used by AICS Data Entry System, routine IBDFDE1
"RTN","IBDFRPC4",5,0)
 ;
"RTN","IBDFRPC4",6,0)
SEND(RESULT,IBDF) ; -- procedure
"RTN","IBDFRPC4",7,0)
 ; -- broker call to set data into pxca array and send to pce
"RTN","IBDFRPC4",8,0)
 ;    rpc  := IBD RECEIVE DATA
"RTN","IBDFRPC4",9,0)
 ;
"RTN","IBDFRPC4",10,0)
 ; -- input:      Result := passed by reference, see output
"RTN","IBDFRPC4",11,0)
 ;            ibdf(text) := contains data about visit, plus checkout defined as follows:
"RTN","IBDFRPC4",12,0)
 ;          ibdf("appt") := appointment data/time
"RTN","IBDFRPC4",13,0)
 ;        ibdf("clinic") := clinic, pointer to file 44
"RTN","IBDFRPC4",14,0)
 ;           ibdf("dfn") := patient, pointer to file 2
"RTN","IBDFRPC4",15,0)
 ;          ibdf("form") := encounter form ID, pointer to file 357.96
"RTN","IBDFRPC4",16,0)
 ;        ibdf("frmdef") := form definition, pointer to 357.95
"RTN","IBDFRPC4",17,0)
 ;       ibdf("foregnd") := pass data in foreground, show results
"RTN","IBDFRPC4",18,0)
 ;       ibdf("backgnd") := pass data in background, don't show results
"RTN","IBDFRPC4",19,0)
 ;
"RTN","IBDFRPC4",20,0)
 ;            ibdf("co") := check out date/time
"RTN","IBDFRPC4",21,0)
 ;            ibdf("sc") := is visit for service connected condition
"RTN","IBDFRPC4",22,0)
 ;            ibdf("ao") := is visit related to Agent orange
"RTN","IBDFRPC4",23,0)
 ;            ibdf("ir") := is visit related to ionizing radiation
"RTN","IBDFRPC4",24,0)
 ;            ibdf("ec") := is visit related to environmental contam.
"RTN","IBDFRPC4",25,0)
 ;
"RTN","IBDFRPC4",26,0)
 ;               ibdf(n) := where n>0 are user selections as follows:
"RTN","IBDFRPC4",27,0)
 ;                   $p1 := package interface, pointer to file 357.6
"RTN","IBDFRPC4",28,0)
 ;                   $p2 := value to send
"RTN","IBDFRPC4",29,0)
 ;                   $p3 := display text
"RTN","IBDFRPC4",30,0)
 ;                   $p4 := header to send
"RTN","IBDFRPC4",31,0)
 ;                   $p5 := clin lexicon pointer
"RTN","IBDFRPC4",32,0)
 ;                   $p6 := qualifier
"RTN","IBDFRPC4",33,0)
 ;                   $p7 := ien of inteface
"RTN","IBDFRPC4",34,0)
 ;                   $p8 := vitals type (.01 field in 359.1)
"RTN","IBDFRPC4",35,0)
 ;                   $p9 := quantity
"RTN","IBDFRPC4",36,0)
 ;                      
"RTN","IBDFRPC4",37,0)
 N I,J,X,Y,D,D0,D1,D2,DA,DIC,DIE,DR,TNODE,FID,FORMID,NODE,VALUE,PI,TEXT,SUBHDR,HEADER,TYPE,QLFR,ITEM,PROVIDER,PXKDONE,STATUS,VSIT,QUANTITY,SDFN
"RTN","IBDFRPC4",38,0)
 S RESULT="-1^No data passed"
"RTN","IBDFRPC4",39,0)
 ;
"RTN","IBDFRPC4",40,0)
 K PXCA
"RTN","IBDFRPC4",41,0)
 S (PXCA,PXCASTAT)=""
"RTN","IBDFRPC4",42,0)
 ;
"RTN","IBDFRPC4",43,0)
 ; -- check form,frmdef and appt/clinic.  Need one or the other
"RTN","IBDFRPC4",44,0)
 S TNODE=$G(^IBD(357.96,+$G(IBDF("FORM")),0))
"RTN","IBDFRPC4",45,0)
 S:'$G(IBDF("DFN")) IBDF("DFN")=$P(TNODE,"^",2)
"RTN","IBDFRPC4",46,0)
 S:'$G(IBDF("APPT")) IBDF("APPT")=$P(TNODE,"^",3)
"RTN","IBDFRPC4",47,0)
 S:'$G(IBDF("FRMDEF")) IBDF("FRMDEF")=$P(TNODE,"^",4)
"RTN","IBDFRPC4",48,0)
 S:'$G(IBDF("CLINIC")) IBDF("CLINIC")=$P(TNODE,"^",10)
"RTN","IBDFRPC4",49,0)
 ;
"RTN","IBDFRPC4",50,0)
 I '$G(IBDF("DFN"))!('$G(IBDF("APPT")))!('$G(IBDF("CLINIC"))) D  G END
"RTN","IBDFRPC4",51,0)
 . I $G(IBDF("FORM")) S STATUS=$$FSCND^IBDF18C(+IBDF("FORM"),12)
"RTN","IBDFRPC4",52,0)
 . S RESULT="-1^Critical information for processing missing"
"RTN","IBDFRPC4",53,0)
 ;
"RTN","IBDFRPC4",54,0)
 ; -- log manual data entry attempt in form tracking
"RTN","IBDFRPC4",55,0)
 S STATUS=$$FSCND^IBDF18C(IBDF("FORM"),5)
"RTN","IBDFRPC4",56,0)
 ;
"RTN","IBDFRPC4",57,0)
 ; -- build the encounter node and source node from form tracking
"RTN","IBDFRPC4",58,0)
 S PXCA("ENCOUNTER")=$G(IBDF("APPT"))_"^"_$G(IBDF("DFN"))_"^"_$G(IBDF("CLINIC"))_"^^^"_$G(IBDF("SC"))_"^"_$G(IBDF("AO"))_"^"_$G(IBDF("IR"))_"^"_$G(IBDF("EC"))_"^^^^^"_$G(IBDF("CO"))
"RTN","IBDFRPC4",59,0)
 S PXCA("SOURCE")="1^"_DUZ_"^"_$G(IBDF("FRMDEF"))_"^^"_$G(IBDF("FORM"))
"RTN","IBDFRPC4",60,0)
 ;
"RTN","IBDFRPC4",61,0)
 ; -- process data in ibdf(n) nodes
"RTN","IBDFRPC4",62,0)
 S FORMID=IBDF("FORM")
"RTN","IBDFRPC4",63,0)
 S FID=0 F  S FID=$O(IBDF(FID)) Q:'FID  S NODE=$G(IBDF(FID)) D
"RTN","IBDFRPC4",64,0)
 .N VALUE,PI,TEXT,SUBHDR,HEADER,TYPE,QLFR,ITEM,DELEX,QUANTITY
"RTN","IBDFRPC4",65,0)
 .I NODE="" D LOGERR^IBDF18E2(3570002,.FORMID,FID) Q
"RTN","IBDFRPC4",66,0)
 .S PI=$P(NODE,"^")
"RTN","IBDFRPC4",67,0)
 .S VALUE=$$INPUT(PI,$P(NODE,"^",2))
"RTN","IBDFRPC4",68,0)
 .S TEXT=$P(NODE,"^",3)
"RTN","IBDFRPC4",69,0)
 .S (SUBHDR,HEADER)=$E($P(NODE,"^",4),1,80)
"RTN","IBDFRPC4",70,0)
 .I $L(SUBHDR),$L(SUBHDR)<2 S (SUBHDR,HEADER)=""
"RTN","IBDFRPC4",71,0)
 .;I $L(SUBHDR),($L(SUBHDR)+$L(TEXT)<80) S TEXT=SUBHDR_" "_TEXT
"RTN","IBDFRPC4",72,0)
 .S QLFR=$P(NODE,"^",6) S:QLFR'="" QLFR=$O(^IBD(357.98,"B",QLFR,0))
"RTN","IBDFRPC4",73,0)
 .S TYPE=+$$TYPE($P(NODE,"^",8))
"RTN","IBDFRPC4",74,0)
 .S ITEM=FID
"RTN","IBDFRPC4",75,0)
 .S DELEX=$P(NODE,"^",5)
"RTN","IBDFRPC4",76,0)
 .S QUANTITY=$P(NODE,"^",9)
"RTN","IBDFRPC4",77,0)
 .S SLCTN=$P(NODE,"^",12)
"RTN","IBDFRPC4",78,0)
 .D SETTEMP^IBDF18E1
"RTN","IBDFRPC4",79,0)
 .Q
"RTN","IBDFRPC4",80,0)
 ;
"RTN","IBDFRPC4",81,0)
 ; --added to copy visit modifiers
"RTN","IBDFRPC4",82,0)
 ;
"RTN","IBDFRPC4",83,0)
 D:$D(TEMP("ENCOUNTER")) VSTPXCA^IBDF18E0
"RTN","IBDFRPC4",84,0)
 ;
"RTN","IBDFRPC4",85,0)
 D SETPXCA^IBDF18E0,PRO^IBDF18E0
"RTN","IBDFRPC4",86,0)
 ;
"RTN","IBDFRPC4",87,0)
 S IBDF("PASSFLAG")=+$P($G(^IBD(357.09,1,0)),"^",7)
"RTN","IBDFRPC4",88,0)
 S IBD("AICS")=1 ;flag for IBDF PCE EVENT protocal
"RTN","IBDFRPC4",89,0)
 ;
"RTN","IBDFRPC4",90,0)
 ;I $G(IBDF("PASSFLAG"))<1 D BACKGND^PXCA(.PXCA,.PXCASTAT)
"RTN","IBDFRPC4",91,0)
 ;I $G(IBDF("PASSFLAG"))=1 D VALIDATE^PXCA(.PXCA) I '$D(PXCA("ERROR")) D BACKGND^PXCA(.PXCA,.PXCASTAT)
"RTN","IBDFRPC4",92,0)
 I $G(IBDF("PASSFLAG"))<2 D QUE^IBDF18E3
"RTN","IBDFRPC4",93,0)
 I $G(IBDF("PASSFLAG"))>1 D FOREGND^PXCA(.PXCA,.PXCASTAT)
"RTN","IBDFRPC4",94,0)
 K IBD("AICS")
"RTN","IBDFRPC4",95,0)
 ;
"RTN","IBDFRPC4",96,0)
 ; -- kill erroneous inpatient warnings
"RTN","IBDFRPC4",97,0)
 I $D(PXCA("WARNING","ENCOUNTER"))>0 D INPT^IBDF18E0($G(IBDF("DFN")),$G(IBDF("APPT")))
"RTN","IBDFRPC4",98,0)
 ;
"RTN","IBDFRPC4",99,0)
 ; -- set form tracking processing status, if okay=6, if error=7
"RTN","IBDFRPC4",100,0)
 I $G(IBDF("FORM")) S STATUS=$$FSCND^IBDF18C(IBDF("FORM"),$S(PXCASTAT=0:7,PXCASTAT=1:6,PXCASTAT=-1:7,PXCASTAT=-2:6,1:12),$S((PXCASTAT=0!(PXCASTAT=-1)):"PCE RETURNED AN ERROR",1:""))
"RTN","IBDFRPC4",101,0)
 ;
"RTN","IBDFRPC4",102,0)
 S RESULT(0)=PXCASTAT
"RTN","IBDFRPC4",103,0)
 I (PXCASTAT=1!(PXCASTAT=-2)),IBDF("PASSFLAG")<3 K PXCA,PXCASTAT
"RTN","IBDFRPC4",104,0)
END Q
"RTN","IBDFRPC4",105,0)
 ;
"RTN","IBDFRPC4",106,0)
INPUT(PI,X) ; -- convert external value to internal value
"RTN","IBDFRPC4",107,0)
 I $G(PI)=""!($G(X)="")
"RTN","IBDFRPC4",108,0)
 I $G(^IBE(357.6,+$G(PI),9))'="" X ^(9)
"RTN","IBDFRPC4",109,0)
VALQ Q $G(X)
"RTN","IBDFRPC4",110,0)
 ;
"RTN","IBDFRPC4",111,0)
TYPE(X) ; -- Change external to internal for hand print fields
"RTN","IBDFRPC4",112,0)
 N Y S Y=""
"RTN","IBDFRPC4",113,0)
 I X'="" S Y=$O(^IBE(359.1,"B",X,0))
"RTN","IBDFRPC4",114,0)
 Q Y
"RTN","IBDFRPC5")
0^18^B12358591
"RTN","IBDFRPC5",1,0)
IBDFRPC5 ;ALB/AAS - AICS Pass data to PCE, Broker Call ; 24-FEB-96
"RTN","IBDFRPC5",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**3,38**;APR 24, 1997
"RTN","IBDFRPC5",3,0)
 ;
"RTN","IBDFRPC5",4,0)
GETALL(RESULT,IBDATA) ; -- called by RPC and by write
"RTN","IBDFRPC5",5,0)
 ; -- get all encounter data
"RTN","IBDFRPC5",6,0)
 ; -- input  Result (called by reference)
"RTN","IBDFRPC5",7,0)
 ;           IBDATA (called by reference)
"RTN","IBDFRPC5",8,0)
 ;           IBDATA("CLINIC")   := pointer to hospital location file (44)
"RTN","IBDFRPC5",9,0)
 ;           IBDATA("DFN")      := pointer to Patient file (2)
"RTN","IBDFRPC5",10,0)
 ;           IBDATA("APPT")     := date/time of encounter in FM format
"RTN","IBDFRPC5",11,0)
 ;           IBDATA("UNFORMAT") := (optional, default :=0) return piece
"RTN","IBDFRPC5",12,0)
 ;                                  as displayable
"RTN","IBDFRPC5",13,0)
 ; -- output Results Array
"RTN","IBDFRPC5",14,0)
 ;           A sequential array of all data found for encounters for
"RTN","IBDFRPC5",15,0)
 ;             patient/clinic/appt
"RTN","IBDFRPC5",16,0)
 ;           if ibdata(unformat) is false then data is preformatted
"RTN","IBDFRPC5",17,0)
 ;              suitable for display to a crt.
"RTN","IBDFRPC5",18,0)
 ;           if ibdata(unformat) is true then a record as follows:
"RTN","IBDFRPC5",19,0)
 ;              P1  :=  data qualifier (ie primary or secondary)
"RTN","IBDFRPC5",20,0)
 ;              P2  :=  type of data
"RTN","IBDFRPC5",21,0)
 ;              p3  :=  Narrative or Description (Textual name)
"RTN","IBDFRPC5",22,0)
 ;              P4  :=  value (code or date/time)
"RTN","IBDFRPC5",23,0)
 ;              P5  :=  source of data (aics, pce, scheduling)
"RTN","IBDFRPC5",24,0)
 ;              P6  :=  Quantity (cpt codes only)
"RTN","IBDFRPC5",25,0)
 ;                      The next 4 pieces only set if answered
"RTN","IBDFRPC5",26,0)
 ;              P7  :=  sc (null, 1 or 0) encounter node only
"RTN","IBDFRPC5",27,0)
 ;              P8  :=  ao (null, 1 or 0) encounter node only
"RTN","IBDFRPC5",28,0)
 ;              P9  :=  ir (null, 1 or 0) encounter node only
"RTN","IBDFRPC5",29,0)
 ;              P10 :=  ec (null, 1 or 0) encounter node only
"RTN","IBDFRPC5",30,0)
 ;
"RTN","IBDFRPC5",31,0)
 N CNT,IBDI,ENCTRS,L
"RTN","IBDFRPC5",32,0)
 S CNT=0,ENCTRS=""
"RTN","IBDFRPC5",33,0)
 D GETDATA(.RESULT,.IBDATA,.ENCTRS)
"RTN","IBDFRPC5",34,0)
 S L="                             "
"RTN","IBDFRPC5",35,0)
 I +RESULT(0) S RESULT(0)="The following data was found: " D FINDALL^IBDFRPC6(.RESULT)
"RTN","IBDFRPC5",36,0)
 ;F IBDI="VST","PRV","POV","CPT","HF","PED","XAM","SK","IMM","TRT" D @(IBDI_"^IBDFRPC6")
"RTN","IBDFRPC5",37,0)
GETALLQ Q
"RTN","IBDFRPC5",38,0)
 ;
"RTN","IBDFRPC5",39,0)
GETDATA(RESULT,IBDATA,ENCTRS) ; -- return all data for an encounter date time
"RTN","IBDFRPC5",40,0)
 ;
"RTN","IBDFRPC5",41,0)
 N IBDJ,IBDY
"RTN","IBDFRPC5",42,0)
 K ^TMP("PXKENC",$J)
"RTN","IBDFRPC5",43,0)
 I +IBDATA("CLINIC")'=IBDATA("CLINIC"),IBDATA("CLINIC")'="" S IBDATA("CLINIC")=$O(^SC("B",IBDATA("CLINIC"),0))
"RTN","IBDFRPC5",44,0)
 S RESULT(0)="Nothing Processed, Perhaps an Error Occurred"
"RTN","IBDFRPC5",45,0)
 I $G(IBDATA("DFN"))<1!($G(IBDATA("APPT"))<1)!($G(IBDATA("CLINIC"))<1) S RESULT(0)="Insufficient Data Passed to find encounter data" G GETQ
"RTN","IBDFRPC5",46,0)
 ;
"RTN","IBDFRPC5",47,0)
 ; -- first get visit iens
"RTN","IBDFRPC5",48,0)
 S ENCTRS=$$GETENC^PXAPI(IBDATA("DFN"),IBDATA("APPT"),IBDATA("CLINIC"))
"RTN","IBDFRPC5",49,0)
 I ENCTRS=-1 S RESULT(0)="No encounter Data on file." G GETQ
"RTN","IBDFRPC5",50,0)
 I ENCTRS=-2 S RESULT(0)="Error in calling routine, file a NOIS" G GETQ
"RTN","IBDFRPC5",51,0)
 ;
"RTN","IBDFRPC5",52,0)
 ; -- then get all visit data
"RTN","IBDFRPC5",53,0)
 S RESULT(0)="Attempting to Retieve Data"
"RTN","IBDFRPC5",54,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:IBDY=""  D ENCEVENT^PXAPI(IBDY,1)
"RTN","IBDFRPC5",55,0)
 ;
"RTN","IBDFRPC5",56,0)
 S RESULT(0)="1"
"RTN","IBDFRPC5",57,0)
GETQ Q
"RTN","IBDFRPC5",58,0)
 ;
"RTN","IBDFRPC5",59,0)
WRITE ; -- called by DIR as executable help from IBDFDE
"RTN","IBDFRPC5",60,0)
 N RESULT,IBQUIT,I,CNT
"RTN","IBDFRPC5",61,0)
 W !,"Retrieving Encounter Data from PCE..."
"RTN","IBDFRPC5",62,0)
 D GETALL(.RESULT,.IBDF)
"RTN","IBDFRPC5",63,0)
 W !
"RTN","IBDFRPC5",64,0)
 S I="",IBQUIT=0,CNT=0
"RTN","IBDFRPC5",65,0)
 F  S I=$O(RESULT(I)) Q:I=""  S CNT=CNT+1 D:'(CNT#10) PAUSE^IBDFDE Q:IBQUIT  W !,RESULT(I)
"RTN","IBDFRPC5",66,0)
 Q
"RTN","IBDFRPC5",67,0)
 ;
"RTN","IBDFRPC5",68,0)
APPTLST(RESULT,IBDF) ; -- return past appointment list, called by rpc
"RTN","IBDFRPC5",69,0)
 N I,J,CNT,DFN,VASD,VAERR,VAROOT
"RTN","IBDFRPC5",70,0)
 S RESULT(0)="No Past Appointments Found^^"
"RTN","IBDFRPC5",71,0)
 K ^UTILITY("VASD",$J)
"RTN","IBDFRPC5",72,0)
 ;
"RTN","IBDFRPC5",73,0)
 S DFN=+$G(IBDF("DFN"))
"RTN","IBDFRPC5",74,0)
 S VASD("F")=$S($G(IBDF("F"))>2840000:IBDF("F"),1:DT-10000)
"RTN","IBDFRPC5",75,0)
 S VASD("T")=$S($G(IBDF("T"))>2840000:IBDF("T"),1:DT+.24)
"RTN","IBDFRPC5",76,0)
 S VASD("W")=$S($G(IBDF("W"))'="":IBDF("W"),1:"129")
"RTN","IBDFRPC5",77,0)
 ;
"RTN","IBDFRPC5",78,0)
 D SDA^VADPT
"RTN","IBDFRPC5",79,0)
 ;
"RTN","IBDFRPC5",80,0)
 I $O(^UTILITY("VASD",$J,"")) S CNT=0
"RTN","IBDFRPC5",81,0)
 S I="" F  S I=$O(^UTILITY("VASD",$J,I),-1) Q:I=""  S RESULT(CNT)=$G(^UTILITY("VASD",$J,I,"E"))_"^"_$G(^UTILITY("VASD",$J,I,"I")),CNT=CNT+1
"RTN","IBDFRPC5",82,0)
 ;
"RTN","IBDFRPC5",83,0)
 I VAERR=1 S RESULT(0)="Invalid Patient Identifier^^"
"RTN","IBDFRPC5",84,0)
 K ^UTILITY("VASD",$J)
"RTN","IBDFRPC5",85,0)
 Q
"RTN","IBDFRPC5",86,0)
 ;
"RTN","IBDFRPC5",87,0)
TEST ;
"RTN","IBDFRPC5",88,0)
 K IBDF,ALAN
"RTN","IBDFRPC5",89,0)
 S IBDF("DFN")=7169761
"RTN","IBDFRPC5",90,0)
 S IBDF("CLINIC")=300
"RTN","IBDFRPC5",91,0)
 S IBDF("APPT")=2970902.0849
"RTN","IBDFRPC5",92,0)
 S IBDF("UNFORMAT")=1
"RTN","IBDFRPC5",93,0)
 D GETALL(.ALAN,.IBDF)
"RTN","IBDFRPC5",94,0)
 Q
"RTN","IBDFRPC5",95,0)
TESTW ;
"RTN","IBDFRPC5",96,0)
 K IBDF
"RTN","IBDFRPC5",97,0)
 S IBDF("DFN")=7169761
"RTN","IBDFRPC5",98,0)
 S IBDF("CLINIC")=300
"RTN","IBDFRPC5",99,0)
 S IBDF("APPT")=2970902.0849
"RTN","IBDFRPC5",100,0)
 D WRITE
"RTN","IBDFRPC5",101,0)
 K IBDF
"RTN","IBDFRPC5",102,0)
 Q
"RTN","IBDFRPC5",103,0)
 ;
"RTN","IBDFRPC5",104,0)
TESTA ;
"RTN","IBDFRPC5",105,0)
 K ALAN,IBDF
"RTN","IBDFRPC5",106,0)
 S IBDF("DFN")=7169761
"RTN","IBDFRPC5",107,0)
 D APPTLST(.ALAN,.IBDF)
"RTN","IBDFRPC5",108,0)
 Q
"RTN","IBDFRPC6")
0^31^B56803850
"RTN","IBDFRPC6",1,0)
IBDFRPC6 ;ALB/AAS - AICS Pass data to PCE, Broker Call ; 24-FEB-96
"RTN","IBDFRPC6",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**3,25,38**;APR 24, 1997
"RTN","IBDFRPC6",3,0)
 ;
"RTN","IBDFRPC6",4,0)
FINDALL(RESULT) ; -- loop through all entries for data
"RTN","IBDFRPC6",5,0)
 ; -- called from ibdfrpc5, ONLY call if data in ^tmp
"RTN","IBDFRPC6",6,0)
 N IBDI
"RTN","IBDFRPC6",7,0)
 S RESULT(0)="The following data was found: "
"RTN","IBDFRPC6",8,0)
 F IBDI="VST","PRV","POV","CPT","HF","PED","XAM","SK","IMM","TRT" D @(IBDI)
"RTN","IBDFRPC6",9,0)
 K ^TMP("PXKENC",$J)
"RTN","IBDFRPC6",10,0)
 Q
"RTN","IBDFRPC6",11,0)
 ;
"RTN","IBDFRPC6",12,0)
PRV ; -- Expand Provider Entry
"RTN","IBDFRPC6",13,0)
 N IBDY,IBDJ,IEN,X,Y
"RTN","IBDFRPC6",14,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:'IBDY  D
"RTN","IBDFRPC6",15,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXKENC",$J,IBDY,"PRV",IEN)) Q:'IEN  D
"RTN","IBDFRPC6",16,0)
 ..D GETY(.Y,IBDY,"PRV",IEN)
"RTN","IBDFRPC6",17,0)
 ..I $G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",18,0)
 ...S X=$S($P(Y,"^",4)="P":"Primary",1:"Secondary")_"^Provider^"_$P($G(^VA(200,+Y,0)),"^")
"RTN","IBDFRPC6",19,0)
 ...S $P(X,"^",5)=$$SOURCE(9000010.06)
"RTN","IBDFRPC6",20,0)
 ..I '$G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",21,0)
 ...S X=$S($P(Y,"^",4)="P":"   Primary",1:" Secondary")_" Provider:  "_$P($G(^VA(200,+Y,0)),"^")
"RTN","IBDFRPC6",22,0)
 ..D INC(X,.CNT)
"RTN","IBDFRPC6",23,0)
 Q
"RTN","IBDFRPC6",24,0)
 ;
"RTN","IBDFRPC6",25,0)
POV ; -- Expand POV entry, (9000010.07)
"RTN","IBDFRPC6",26,0)
 N IBDY,IBDJ,IEN,X,Y
"RTN","IBDFRPC6",27,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:'IBDY  D
"RTN","IBDFRPC6",28,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXKENC",$J,IBDY,"POV",IEN)) Q:'IEN  D
"RTN","IBDFRPC6",29,0)
 ..D GETY(.Y,IBDY,"POV",IEN)
"RTN","IBDFRPC6",30,0)
 ..I '$G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",31,0)
 ...S X=$S($P(Y,"^",12)="P":"  Primary",1:"Secondary")_" Diagnosis:  "
"RTN","IBDFRPC6",32,0)
 ...S X=X_$E($P($G(^ICD9(+Y,0)),"^")_"   ",1,6)_" - "
"RTN","IBDFRPC6",33,0)
 ...IF $P(Y,"^",4) S X=X_$$EXTERNAL^DILFD(9000010.07,.04,"",$P(Y,"^",4))
"RTN","IBDFRPC6",34,0)
 ...ELSE  S X=X_$E($G(^ICD9(+Y,1)),1,80)
"RTN","IBDFRPC6",35,0)
 ..;
"RTN","IBDFRPC6",36,0)
 ..I $G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",37,0)
 ...S X=$S($P(Y,"^",12)="P":"Primary",1:"Secondary")_"^Diagnosis^"
"RTN","IBDFRPC6",38,0)
 ...IF $P(Y,"^",4) S X=X_$$EXTERNAL^DILFD(9000010.07,.04,"",$P(Y,"^",4))
"RTN","IBDFRPC6",39,0)
 ...ELSE  S X=X_$E($G(^ICD9(+Y,1)),1,80)
"RTN","IBDFRPC6",40,0)
 ...S X=X_"^"_$E($P($G(^ICD9(+Y,0)),"^")_"   ",1,6)
"RTN","IBDFRPC6",41,0)
 ...S $P(X,"^",5)=$$SOURCE(9000010.07)
"RTN","IBDFRPC6",42,0)
 ..D INC(X,.CNT)
"RTN","IBDFRPC6",43,0)
 Q
"RTN","IBDFRPC6",44,0)
 ;
"RTN","IBDFRPC6",45,0)
CPT ; -- Expand CPT entry
"RTN","IBDFRPC6",46,0)
 N IBDY,IBDJ,IEN,QUAN,X,Y,CODE
"RTN","IBDFRPC6",47,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:'IBDY  D
"RTN","IBDFRPC6",48,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXKENC",$J,IBDY,"CPT",IEN)) Q:'IEN  D
"RTN","IBDFRPC6",49,0)
 ..D GETY(.Y,IBDY,"CPT",IEN)
"RTN","IBDFRPC6",50,0)
 ..S QUAN=$P(Y,"^",16)
"RTN","IBDFRPC6",51,0)
 ..;;-----change to api cpt; dhh
"RTN","IBDFRPC6",52,0)
 ..S CODE=$$CPT^ICPTCOD(+Y)
"RTN","IBDFRPC6",53,0)
 ..I '$G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",54,0)
 ...I +CODE=-1 S CODE=""
"RTN","IBDFRPC6",55,0)
 ...E  S CODE=$P(CODE,U,2)
"RTN","IBDFRPC6",56,0)
 ...S X="          Procedure:  "_CODE_"  - "
"RTN","IBDFRPC6",57,0)
 ...IF $P(Y,"^",4) S X=X_$$EXTERNAL^DILFD(9000010.18,.04,"",$P(Y,"^",4))
"RTN","IBDFRPC6",58,0)
 ...ELSE  S X=X_$P(CODE,"^",3)
"RTN","IBDFRPC6",59,0)
 ...S X=X_"   Quantity: "_QUAN
"RTN","IBDFRPC6",60,0)
 ..I $G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",61,0)
 ...S X="^Procedure^"
"RTN","IBDFRPC6",62,0)
 ...IF $P(Y,"^",4) S X=X_$$EXTERNAL^DILFD(9000010.18,.04,"",$P(Y,"^",4))
"RTN","IBDFRPC6",63,0)
 ...ELSE  S X=X_$P(CODE,"^",3)
"RTN","IBDFRPC6",64,0)
 ...S X=X_"^"_$P(CODE,"^",2)_"^"_$$SOURCE(9000010.18)_"^"_QUAN
"RTN","IBDFRPC6",65,0)
 ..D INC(X,.CNT)
"RTN","IBDFRPC6",66,0)
 Q
"RTN","IBDFRPC6",67,0)
 ;
"RTN","IBDFRPC6",68,0)
HF ; -- Expand Health Factors
"RTN","IBDFRPC6",69,0)
 N IBDY,IBDJ,IEN,X,Y,Z
"RTN","IBDFRPC6",70,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:'IBDY  D
"RTN","IBDFRPC6",71,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXKENC",$J,IBDY,"HF",IEN)) Q:'IEN  D
"RTN","IBDFRPC6",72,0)
 ..D GETY(.Y,IBDY,"HF",IEN)
"RTN","IBDFRPC6",73,0)
 ..I '$G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",74,0)
 ...S X="      Health Factor:  "_$E($$EXTERNAL^DILFD(9000010.23,.01,"",+Y)_L,1,25)
"RTN","IBDFRPC6",75,0)
 ...I $P(Y,"^",4)'="" S X=X_" Severity="_$$EXTERNAL^DILFD(9000010.23,.04,"",$P(Y,"^",4))
"RTN","IBDFRPC6",76,0)
 ..;
"RTN","IBDFRPC6",77,0)
 ..I $G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",78,0)
 ...S X=""
"RTN","IBDFRPC6",79,0)
 ...I $P(Y,"^",4)'="" S X=$$EXTERNAL^DILFD(9000010.23,.04,"",$P(Y,"^",4))
"RTN","IBDFRPC6",80,0)
 ...S X=X_"^Health Factor^"_$E($$EXTERNAL^DILFD(9000010.23,.01,"",+Y),1,25)
"RTN","IBDFRPC6",81,0)
 ...S $P(X,"^",5)=$$SOURCE(9000010.23)
"RTN","IBDFRPC6",82,0)
 ..D INC(X,.CNT)
"RTN","IBDFRPC6",83,0)
 Q
"RTN","IBDFRPC6",84,0)
 ;
"RTN","IBDFRPC6",85,0)
IMM ; -- Expand Immunizations
"RTN","IBDFRPC6",86,0)
 N IBDY,IBDJ,IEN,X,Y
"RTN","IBDFRPC6",87,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:'IBDY  D
"RTN","IBDFRPC6",88,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXKENC",$J,IBDY,"IMM",IEN)) Q:'IEN  D
"RTN","IBDFRPC6",89,0)
 ..D GETY(.Y,IBDY,"IMM",IEN)
"RTN","IBDFRPC6",90,0)
 ..I '$G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",91,0)
 ...S X="       Immunization:  "_$$EXTERNAL^DILFD(9000010.11,.01,"",+Y)
"RTN","IBDFRPC6",92,0)
 ...I $P(Y,"^",7) S X=X_"  Contraindicated!"
"RTN","IBDFRPC6",93,0)
 ..;
"RTN","IBDFRPC6",94,0)
 ..I $G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",95,0)
 ...S X="" I $P(Y,"^",7) S X="Contraindicated"
"RTN","IBDFRPC6",96,0)
 ...S X=X_"^Immunization^"_$$EXTERNAL^DILFD(9000010.11,.01,"",+Y)
"RTN","IBDFRPC6",97,0)
 ...S $P(X,"^",5)=$$SOURCE(9000010.11)
"RTN","IBDFRPC6",98,0)
 ..D INC(X,.CNT)
"RTN","IBDFRPC6",99,0)
 Q
"RTN","IBDFRPC6",100,0)
 ;
"RTN","IBDFRPC6",101,0)
PED ; -- Expand Patient Education
"RTN","IBDFRPC6",102,0)
 N IBDY,IBDJ,IEN,X,Y
"RTN","IBDFRPC6",103,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:'IBDY  D
"RTN","IBDFRPC6",104,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXKENC",$J,IBDY,"PED",IEN)) Q:'IEN  D
"RTN","IBDFRPC6",105,0)
 ..D GETY(.Y,IBDY,"PED",IEN)
"RTN","IBDFRPC6",106,0)
 ..I '$G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",107,0)
 ...S X="    Education Topic:  "_$E($$EXTERNAL^DILFD(9000010.16,.01,"",+Y)_L,1,25)
"RTN","IBDFRPC6",108,0)
 ...I $P(Y,"^",6)'="" S X=X_" Understanding="_$$EXTERNAL^DILFD(9000010.16,.06,"",$P(Y,"^",6))
"RTN","IBDFRPC6",109,0)
 ..;
"RTN","IBDFRPC6",110,0)
 ..I $G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",111,0)
 ...S X=""
"RTN","IBDFRPC6",112,0)
 ...I $P(Y,"^",6)'="" S X=$$EXTERNAL^DILFD(9000010.16,.06,"",$P(Y,"^",6))
"RTN","IBDFRPC6",113,0)
 ...S X=X_"^Education Topic^"_$E($$EXTERNAL^DILFD(9000010.16,.01,"",+Y),1,25)
"RTN","IBDFRPC6",114,0)
 ...S $P(X,"^",5)=$$SOURCE(9000010.16)
"RTN","IBDFRPC6",115,0)
 ..D INC(X,.CNT)
"RTN","IBDFRPC6",116,0)
 Q
"RTN","IBDFRPC6",117,0)
 ;
"RTN","IBDFRPC6",118,0)
SK ; -- Expand Skin Tests
"RTN","IBDFRPC6",119,0)
 N IBDY,IBDJ,IEN,X,Y,Z
"RTN","IBDFRPC6",120,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:'IBDY  D
"RTN","IBDFRPC6",121,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXKENC",$J,IBDY,"SK",IEN)) Q:'IEN  D
"RTN","IBDFRPC6",122,0)
 ..D GETY(.Y,IBDY,"SK",IEN)
"RTN","IBDFRPC6",123,0)
 ..I '$G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",124,0)
 ...S X="          Skin Test:  "_$E($$EXTERNAL^DILFD(9000010.12,.01,"",+Y)_L,1,25)
"RTN","IBDFRPC6",125,0)
 ...I $P(Y,"^",4)'="" S X=X_" Result="_$$EXTERNAL^DILFD(9000010.12,.04,"",$P(Y,"^",4))
"RTN","IBDFRPC6",126,0)
 ..;
"RTN","IBDFRPC6",127,0)
 ..I $G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",128,0)
 ...S X=$$EXTERNAL^DILFD(9000010.12,.04,"",$P(Y,"^",4))
"RTN","IBDFRPC6",129,0)
 ...S X=X_"^Skin Test^"_$E($$EXTERNAL^DILFD(9000010.12,.01,"",+Y),1,25)
"RTN","IBDFRPC6",130,0)
 ...S $P(X,"^",5)=$$SOURCE(9000010.12)
"RTN","IBDFRPC6",131,0)
 ..D INC(X,.CNT)
"RTN","IBDFRPC6",132,0)
 Q
"RTN","IBDFRPC6",133,0)
 ;
"RTN","IBDFRPC6",134,0)
TRT ; -- Expand Treatments
"RTN","IBDFRPC6",135,0)
 N IBDY,IBDJ,IEN,X,Y,TRT
"RTN","IBDFRPC6",136,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:'IBDY  D
"RTN","IBDFRPC6",137,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXKENC",$J,IBDY,"TRT",IEN)) Q:'IEN  D
"RTN","IBDFRPC6",138,0)
 ..D GETY(.Y,IBDY,"TRT",IEN)
"RTN","IBDFRPC6",139,0)
 ..S TRT=$$EXTERNAL^DILFD(9000010.15,.01,"",+Y)
"RTN","IBDFRPC6",140,0)
 ..I TRT="OTHER" S TRT=$$EXTERNAL^DILFD(9000010.15,.06,"",$P(Y,"^",6))
"RTN","IBDFRPC6",141,0)
 ..I '$G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",142,0)
 ...S X="          Treatment:  "_TRT
"RTN","IBDFRPC6",143,0)
 ..I $G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",144,0)
 ...S X="^Treatment^"_TRT
"RTN","IBDFRPC6",145,0)
 ...S $P(X,"^",5)=$$SOURCE(9000010.15)
"RTN","IBDFRPC6",146,0)
 ..D INC(X,.CNT)
"RTN","IBDFRPC6",147,0)
 Q
"RTN","IBDFRPC6",148,0)
 ;
"RTN","IBDFRPC6",149,0)
XAM ; -- Expand Exams
"RTN","IBDFRPC6",150,0)
 N IBDY,IBDJ,IEN,X,Y
"RTN","IBDFRPC6",151,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:'IBDY  D
"RTN","IBDFRPC6",152,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXKENC",$J,IBDY,"XAM",IEN)) Q:'IEN  D
"RTN","IBDFRPC6",153,0)
 ..D GETY(.Y,IBDY,"XAM",IEN)
"RTN","IBDFRPC6",154,0)
 ..I '$G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",155,0)
 ...S X="               Exam:  "_$E($$EXTERNAL^DILFD(9000010.13,.01,"",+Y)_L,1,25)
"RTN","IBDFRPC6",156,0)
 ...S X=X_" Result="_$$EXTERNAL^DILFD(9000010.13,.04,"",$P(Y,"^",4))
"RTN","IBDFRPC6",157,0)
 ..;
"RTN","IBDFRPC6",158,0)
 ..I $G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",159,0)
 ...S X=$$EXTERNAL^DILFD(9000010.13,.04,"",$P(Y,"^",4))
"RTN","IBDFRPC6",160,0)
 ...S X=X_"^Exam^"_$E($$EXTERNAL^DILFD(9000010.13,.01,"",+Y),1,25)
"RTN","IBDFRPC6",161,0)
 ...S $P(X,"^",5)=$$SOURCE(9000010.13)
"RTN","IBDFRPC6",162,0)
 ..D INC(X,.CNT)
"RTN","IBDFRPC6",163,0)
 Q
"RTN","IBDFRPC6",164,0)
 ;
"RTN","IBDFRPC6",165,0)
VST ; -- Expand visit entry
"RTN","IBDFRPC6",166,0)
 N IBDY,IBDJ,IBDZ,IEN,X,Y
"RTN","IBDFRPC6",167,0)
 F IBDJ=1:1 S IBDY=$P(ENCTRS,"^",IBDJ) Q:'IBDY  D
"RTN","IBDFRPC6",168,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXKENC",$J,IBDY,"VST",IEN)) Q:'IEN  D
"RTN","IBDFRPC6",169,0)
 ..D GETY(.Y,IBDY,"VST",IEN)
"RTN","IBDFRPC6",170,0)
 ..I '$G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",171,0)
 ...S X="     Encounter Info:  "_$$EXTERNAL^DILFD(9000010,.22,"",$P(Y,"^",22))_" - "_$$FMTE^XLFDT(+Y)_" - "_$$EXTERNAL^DILFD(9000010,15003,"",$P(Y(150),"^",3))_" Encounter"
"RTN","IBDFRPC6",172,0)
 ...D INC(X,.CNT)
"RTN","IBDFRPC6",173,0)
 ...S X=""
"RTN","IBDFRPC6",174,0)
 ...S X=$$SOURCE(9000010) I X'="" S X=$E(L,1,22)_"Source - "_X
"RTN","IBDFRPC6",175,0)
 ...I $P(Y(800),"^",1)'="" S X=X_", SC := "_$S($P(Y(800),"^",1):"Yes",1:"No")
"RTN","IBDFRPC6",176,0)
 ...I $P(Y(800),"^",2)'="" S X=X_", AO:="_$S($P(Y(800),"^",2):"Yes",1:"No")
"RTN","IBDFRPC6",177,0)
 ...I $P(Y(800),"^",3)'="" S X=X_", IR:="_$S($P(Y(800),"^",3):"Yes",1:"No")
"RTN","IBDFRPC6",178,0)
 ...I $P(Y(800),"^",4)'="" S X=X_", EC:="_$S($P(Y(800),"^",4):"Yes",1:"No")
"RTN","IBDFRPC6",179,0)
 ..;
"RTN","IBDFRPC6",180,0)
 ..I $G(IBDATA("UNFORMAT")) D
"RTN","IBDFRPC6",181,0)
 ...S X=$$EXTERNAL^DILFD(9000010,15003,"",$P(Y(150),"^",3))_"^Encounter^"
"RTN","IBDFRPC6",182,0)
 ...S X=X_$$EXTERNAL^DILFD(9000010,.22,"",$P(Y,"^",22))_"^"_$$FMTE^XLFDT(+Y)_"^"
"RTN","IBDFRPC6",183,0)
 ...S X=X_$$SOURCE(9000010)
"RTN","IBDFRPC6",184,0)
 ...F IBDZ=1:1:4 I $P(Y(800),"^",IBDZ)'="" S $P(X,"^",(6+IBDZ))=$P(Y(800),"^",IBDZ)
"RTN","IBDFRPC6",185,0)
 ..I X'="" D INC(X,.CNT)
"RTN","IBDFRPC6",186,0)
 Q
"RTN","IBDFRPC6",187,0)
 ;
"RTN","IBDFRPC6",188,0)
INC(X,CNT) ; -- increment results array
"RTN","IBDFRPC6",189,0)
 S CNT=CNT+1
"RTN","IBDFRPC6",190,0)
 S RESULT(CNT)=X
"RTN","IBDFRPC6",191,0)
 Q
"RTN","IBDFRPC6",192,0)
 ;
"RTN","IBDFRPC6",193,0)
GETY(Y,IBDY,TYPE,IEN) ; -- return y array
"RTN","IBDFRPC6",194,0)
 S Y=$G(^TMP("PXKENC",$J,IBDY,TYPE,IEN,0))
"RTN","IBDFRPC6",195,0)
 S Y(150)=$G(^TMP("PXKENC",$J,IBDY,TYPE,IEN,150))
"RTN","IBDFRPC6",196,0)
 S Y(812)=$G(^TMP("PXKENC",$J,IBDY,TYPE,IEN,812))
"RTN","IBDFRPC6",197,0)
 I TYPE="VST" S Y(800)=$G(^TMP("PXKENC",$J,IBDY,TYPE,IEN,800))
"RTN","IBDFRPC6",198,0)
 Q
"RTN","IBDFRPC6",199,0)
 ;
"RTN","IBDFRPC6",200,0)
SOURCE(FILE) ; -- return source of data
"RTN","IBDFRPC6",201,0)
 N X S X=""
"RTN","IBDFRPC6",202,0)
 I $P(Y(812),"^",3)'="" S X=$$EXTERNAL^DILFD(FILE,81203,"",$P(Y(812),"^",3))
"RTN","IBDFRPC6",203,0)
 I X="",$P(Y(812),"^",2)'="" S X=$$EXTERNAL^DILFD(FILE,81202,"",$P(Y(812),"^",2))
"RTN","IBDFRPC6",204,0)
 Q X
"RTN","IBDFRPC6",205,0)
 ;
"RTN","IBDFRPC6",206,0)
TEST G TEST^IBDFRPC5
"RTN","IBDFRPC6",207,0)
TESTW G TESTW^IBDFRPC5
"RTN","IBDFU2B")
0^19^B51714679
"RTN","IBDFU2B",1,0)
IBDFU2B ;ALB/CJM - ENCOUNTER FORM - BUILD FORM(copying blocks - continued from IBDFU2) ; 08-JAN-1993
"RTN","IBDFU2B",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDFU2B",3,0)
 ;
"RTN","IBDFU2B",4,0)
CPYSLCTN(SLCTN,GRP,NEWGRP,LIST,NEWLIST,FROMFILE,TOFILE) ;
"RTN","IBDFU2B",5,0)
 Q:('$G(SLCTN))!('$G(GRP))!('$G(NEWGRP))!('$G(LIST))!('$G(NEWLIST))!('$G(FROMFILE))!('$G(TOFILE))
"RTN","IBDFU2B",6,0)
 Q:(FROMFILE'=357.3)&(FROMFILE'=358.3)
"RTN","IBDFU2B",7,0)
 Q:(TOFILE'=357.3)&(TOFILE'=358.3)
"RTN","IBDFU2B",8,0)
 N NODE,NAME,NEWSLCTN,SC,CNT,I
"RTN","IBDFU2B",9,0)
 S NEWSLCTN=""
"RTN","IBDFU2B",10,0)
 S NODE=$G(^IBE(FROMFILE,SLCTN,0)) Q:NODE=""
"RTN","IBDFU2B",11,0)
 I ($P(NODE,"^",3)'=LIST)!($P(NODE,"^",4)'=GRP) K DA S DA=SLCTN,DIK="^IBE("_FROMFILE_"," D IX^DIK K DIK Q
"RTN","IBDFU2B",12,0)
 S NAME=$P(NODE,"^",1),$P(NODE,"^",3)=NEWLIST,$P(NODE,"^",4)=NEWGRP
"RTN","IBDFU2B",13,0)
 Q:NAME=""
"RTN","IBDFU2B",14,0)
 K DIC,DD,DINUM,DO S DIC="^IBE("_TOFILE_",",X=NAME,DIC(0)=""
"RTN","IBDFU2B",15,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDFU2B",16,0)
 S NEWSLCTN=$S(+Y<0:"",1:+Y)
"RTN","IBDFU2B",17,0)
 Q:'NEWSLCTN
"RTN","IBDFU2B",18,0)
 S ^IBE(TOFILE,NEWSLCTN,0)=NODE
"RTN","IBDFU2B",19,0)
 ;
"RTN","IBDFU2B",20,0)
 ; -- now copy the subcolumn value multiple
"RTN","IBDFU2B",21,0)
 ; -- When copying selections but not same list definition (i.e.
"RTN","IBDFU2B",22,0)
 ;    when copying selections from one list to another)
"RTN","IBDFU2B",23,0)
 ;    find old sub columns, in 357.2 for list
"RTN","IBDFU2B",24,0)
 ;    find and match to new sub columns in 357.2 for new list
"RTN","IBDFU2B",25,0)
 ;
"RTN","IBDFU2B",26,0)
 S (SC,CNT,LAST)=0
"RTN","IBDFU2B",27,0)
 ;S NODE=$G(^IBE(FROMFILE,SLCTN,1,0)) I NODE'=""  S ^IBE(TOFILE,NEWSLCTN,1,0)=NODE 
"RTN","IBDFU2B",28,0)
 F  S SC=$O(^IBE(FROMFILE,SLCTN,1,SC)) Q:'SC  S NODE=$G(^IBE(FROMFILE,SLCTN,1,SC,0)) D:$D(IBDFCPYF)  S:NODE'="" ^IBE(TOFILE,NEWSLCTN,1,+NODE,0)=NODE,CNT=CNT+1,LAST=+NODE
"RTN","IBDFU2B",29,0)
 .N K,IBDFI
"RTN","IBDFU2B",30,0)
 .S K=0,IBDFI=+NODE
"RTN","IBDFU2B",31,0)
 .Q:$G(IBDFNEW(IBDFI))=$G(IBDFOLD(IBDFI))
"RTN","IBDFU2B",32,0)
 .F  S K=$O(IBDFNEW(K)) Q:K=""  I IBDFNEW(K)=$G(IBDFOLD(+IBDFI)) S $P(NODE,"^",1)=K,NODE=NODE Q
"RTN","IBDFU2B",33,0)
 .Q
"RTN","IBDFU2B",34,0)
 S ^IBE(TOFILE,NEWSLCTN,1,0)=$S(TOFILE=357.3:"^357.31IA^",1:"^358.31IA^")_$G(LAST)_"^"_CNT
"RTN","IBDFU2B",35,0)
 ; -- now copy 2 node if it exists
"RTN","IBDFU2B",36,0)
 S NODE=$G(^IBE(FROMFILE,SLCTN,2))
"RTN","IBDFU2B",37,0)
 I NODE'="" S ^IBE(TOFILE,NEWSLCTN,2)=NODE
"RTN","IBDFU2B",38,0)
 ;
"RTN","IBDFU2B",39,0)
 ; -- now copy 3 node if it exists (CPT MODIFIERS)
"RTN","IBDFU2B",40,0)
 ;
"RTN","IBDFU2B",41,0)
 I $D(^IBE(FROMFILE,SLCTN,3)) D
"RTN","IBDFU2B",42,0)
 . S ^IBE(TOFILE,NEWSLCTN,3,0)=^IBE(FROMFILE,SLCTN,3,0)
"RTN","IBDFU2B",43,0)
 . F I=0:0 S I=$O(^IBE(FROMFILE,SLCTN,3,I)) Q:'I  D
"RTN","IBDFU2B",44,0)
 .. S:$D(^IBE(FROMFILE,SLCTN,3,I,0)) ^IBE(TOFILE,NEWSLCTN,3,I,0)=^(0)
"RTN","IBDFU2B",45,0)
 ;
"RTN","IBDFU2B",46,0)
 ; -- now re-index file entry
"RTN","IBDFU2B",47,0)
 ;
"RTN","IBDFU2B",48,0)
 K DIK,DA S DIK="^IBE("_TOFILE_",",DA=NEWSLCTN
"RTN","IBDFU2B",49,0)
 D IX1^DIK
"RTN","IBDFU2B",50,0)
 K DIK,DA
"RTN","IBDFU2B",51,0)
 Q
"RTN","IBDFU2B",52,0)
 ;
"RTN","IBDFU2B",53,0)
GETMA(MA,FROMFILE,TOFILE) ;copys marking area=ma from file=FROMFILE to file=TOFILE if it does not already exist
"RTN","IBDFU2B",54,0)
 ;returns the ien of the marking area existing in TOFILE
"RTN","IBDFU2B",55,0)
 Q:($G(FROMFILE)'=357.91)&($G(FROMFILE)'=358.91) ""
"RTN","IBDFU2B",56,0)
 Q:($G(TOFILE)'=357.91)&($G(TOFILE)'=358.91) ""
"RTN","IBDFU2B",57,0)
 Q:'$G(MA) ""
"RTN","IBDFU2B",58,0)
 Q:FROMFILE=TOFILE MA ;files are the same!
"RTN","IBDFU2B",59,0)
 N NODE,NAME,NEWMA
"RTN","IBDFU2B",60,0)
 S NEWMA=""
"RTN","IBDFU2B",61,0)
 S NODE=$G(^IBE(FROMFILE,MA,0)) Q:NODE="" ""
"RTN","IBDFU2B",62,0)
 S NAME=$P(NODE,"^",1)
"RTN","IBDFU2B",63,0)
 Q:NAME="" ""
"RTN","IBDFU2B",64,0)
 S NEWMA=$O(^IBE(TOFILE,"B",NAME,0)) Q:NEWMA NEWMA ;quit if it already exists
"RTN","IBDFU2B",65,0)
 K DIC,DO,DINUM,DD S DIC="^IBE("_TOFILE_",",X=NAME,DIC(0)=""
"RTN","IBDFU2B",66,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDFU2B",67,0)
 S NEWMA=$S(+Y<0:"",1:+Y)
"RTN","IBDFU2B",68,0)
 Q:'NEWMA ""
"RTN","IBDFU2B",69,0)
 S ^IBE(TOFILE,NEWMA,0)=NODE
"RTN","IBDFU2B",70,0)
 K DIK,DA S DIK="^IBE("_TOFILE_",",DA=NEWMA
"RTN","IBDFU2B",71,0)
 D IX1^DIK K DIK,DA
"RTN","IBDFU2B",72,0)
 Q NEWMA
"RTN","IBDFU2B",73,0)
 ;
"RTN","IBDFU2B",74,0)
GETPI(PI,FROMFILE,TOFILE) ;copies the package interface=PI from file=FROMFILE to file=TOFILE if it doesn't already exist
"RTN","IBDFU2B",75,0)
 ;returns the ien of the package interface in the TOFILE
"RTN","IBDFU2B",76,0)
 Q:($G(FROMFILE)'=357.6)&($G(FROMFILE)'=358.6) ""
"RTN","IBDFU2B",77,0)
 Q:($G(TOFILE)'=357.6)&($G(TOFILE)'=358.6) ""
"RTN","IBDFU2B",78,0)
 Q:'$G(PI) ""
"RTN","IBDFU2B",79,0)
 Q:FROMFILE=TOFILE PI
"RTN","IBDFU2B",80,0)
 N NODE,NEWPI,SUB1,SUB2,RTN,ENTRYPT,TYPE
"RTN","IBDFU2B",81,0)
 S NEWPI=""
"RTN","IBDFU2B",82,0)
 S NODE=$G(^IBE(FROMFILE,PI,0)) Q:NODE="" ""
"RTN","IBDFU2B",83,0)
 S NAME=$P(NODE,"^"),ENTRYPT=$P(NODE,"^",2),RTN=$P(NODE,"^",3),TYPE=$P(NODE,"^",6)
"RTN","IBDFU2B",84,0)
 S NEWPI=$$LOOKUP(NAME,RTN,ENTRYPT,TOFILE,TYPE)
"RTN","IBDFU2B",85,0)
 Q:NEWPI NEWPI ;quit if copy is not needed
"RTN","IBDFU2B",86,0)
 K DIC,DO,DINUM,DD S DIC="^IBE("_TOFILE_",",X=$P(NODE,"^"),DIC(0)=""
"RTN","IBDFU2B",87,0)
 Q:X="" "" ;corrupted data!
"RTN","IBDFU2B",88,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDFU2B",89,0)
 S NEWPI=$S(+Y<0:"",1:+Y)
"RTN","IBDFU2B",90,0)
 Q:'NEWPI ""
"RTN","IBDFU2B",91,0)
 ;
"RTN","IBDFU2B",92,0)
 ;for display or selection interfaces, if the entry point does not exist the new package interface should be marked as unavailable
"RTN","IBDFU2B",93,0)
 I (TYPE=2)!(TYPE=3) D
"RTN","IBDFU2B",94,0)
 .I RTN="" S $P(NODE,"^",9)=0 Q
"RTN","IBDFU2B",95,0)
 .I RTN'="" D
"RTN","IBDFU2B",96,0)
 ..I ENTRYPT]"" I '$L($T(@ENTRYPT^@RTN)) S $P(NODE,"^",9)=0
"RTN","IBDFU2B",97,0)
 ..I ENTRYPT="" I '$L($T(^@RTN)) S $P(NODE,"^",9)=0
"RTN","IBDFU2B",98,0)
 ;
"RTN","IBDFU2B",99,0)
 S ^IBE(TOFILE,NEWPI,0)=NODE
"RTN","IBDFU2B",100,0)
 S:$P(NODE,"^",13) $P(NODE,"^",13)=$$GETPI($P(NODE,"^",13),$S(FROMFILE[358:358.6,1:357.6),$S(TOFILE[358:358.6,1:357.6))
"RTN","IBDFU2B",101,0)
 S ^IBE(TOFILE,NEWPI,0)=NODE
"RTN","IBDFU2B",102,0)
 F SUB1=2,3,4,5,8,9,10,11,12,14,17,18,19,20,21 S NODE=$G(^IBE(FROMFILE,PI,SUB1)) I NODE'="" S ^IBE(TOFILE,NEWPI,SUB1)=NODE
"RTN","IBDFU2B",103,0)
 S NODE=$G(^IBE(FROMFILE,PI,16)) I NODE'="" D
"RTN","IBDFU2B",104,0)
 .N TYPEDATA
"RTN","IBDFU2B",105,0)
 .S TYPEDATA=$P(NODE,"^",2)
"RTN","IBDFU2B",106,0)
 .I TYPEDATA S $P(NODE,"^",2)=$$GETADE(TYPEDATA,$S(FROMFILE[358:358.99,1:359.1),$S(TOFILE[358:358.99,1:359.1))
"RTN","IBDFU2B",107,0)
 .S TYPEDATA=$P(NODE,"^",6)
"RTN","IBDFU2B",108,0)
 .I TYPEDATA S $P(NODE,"^",6)=$$GETADE(TYPEDATA,$S(FROMFILE[358:358.99,1:359.1),$S(TOFILE[358:358.99,1:359.1))
"RTN","IBDFU2B",109,0)
 .S ^IBE(TOFILE,NEWPI,16)=NODE
"RTN","IBDFU2B",110,0)
 F SUB1=1,6,7,15 S NODE=$G(^IBE(FROMFILE,PI,SUB1,0)) D
"RTN","IBDFU2B",111,0)
 .I NODE'="" S ^IBE(TOFILE,NEWPI,SUB1,0)=NODE S SUB2=0 F  S SUB2=$O(^IBE(FROMFILE,PI,SUB1,SUB2)) Q:'SUB2  S NODE=$G(^IBE(FROMFILE,PI,SUB1,SUB2,0)) I NODE'="" S ^IBE(TOFILE,NEWPI,SUB1,SUB2,0)=NODE
"RTN","IBDFU2B",112,0)
 ;
"RTN","IBDFU2B",113,0)
 D CPYQLFRS(FROMFILE,PI,TOFILE,NEWPI)
"RTN","IBDFU2B",114,0)
 ;
"RTN","IBDFU2B",115,0)
 K DIK,DA S DIK="^IBE("_TOFILE_",",DA=NEWPI
"RTN","IBDFU2B",116,0)
 D IX1^DIK K DIK,DA
"RTN","IBDFU2B",117,0)
 Q NEWPI
"RTN","IBDFU2B",118,0)
 ;
"RTN","IBDFU2B",119,0)
CPYQLFRS(FROMFILE,PI,TOFILE,NEWPI) ;copy allowable qualifiers from the package interface=PI in NEWPI to the package interface=NEWPI in TOFILE
"RTN","IBDFU2B",120,0)
 ;
"RTN","IBDFU2B",121,0)
 N NODE,SUB,VARPTR
"RTN","IBDFU2B",122,0)
 K ^IBE(TOFILE,NEWPI,13)
"RTN","IBDFU2B",123,0)
 S NODE=$G(^IBE(FROMFILE,PI,13,0)) I NODE'="" S ^IBE(TOFILE,NEWPI,13,0)=NODE S SUB=0 F  S SUB=$O(^IBE(FROMFILE,PI,13,SUB)) Q:'SUB  D
"RTN","IBDFU2B",124,0)
 .S NODE=$G(^IBE(FROMFILE,PI,13,SUB,0)),VARPTR=$P(NODE,"^") I +VARPTR D  I +VARPTR S $P(NODE,"^")=VARPTR,^IBE(TOFILE,NEWPI,13,SUB,0)=NODE
"RTN","IBDFU2B",125,0)
 ..I VARPTR["IBE" S $P(VARPTR,";")=$$GETADE(+VARPTR,$S(FROMFILE[358:358.99,1:359.1),$S(TOFILE[358:358.99,1:359.1)),$P(VARPTR,"(",2)=$S(TOFILE[358:358.99,1:359.1)_"," Q
"RTN","IBDFU2B",126,0)
 ..I VARPTR["IBD" S $P(VARPTR,";")=$$GETQLFR(+VARPTR,$S(FROMFILE[358:358.98,1:357.98),$S(TOFILE[358:358.98,1:357.98)),$P(VARPTR,"(",2)=$S(TOFILE[358:358.98,1:357.98)_","
"RTN","IBDFU2B",127,0)
 Q
"RTN","IBDFU2B",128,0)
 ;
"RTN","IBDFU2B",129,0)
LOOKUP(NAME,RTN,ENTRYPT,TOFILE,TYPE) ;return 1 if the package interface already exists in TOFILE, 0 otherwise
"RTN","IBDFU2B",130,0)
 N PI,LOOKNODE,QUIT
"RTN","IBDFU2B",131,0)
 Q:NAME="" ""
"RTN","IBDFU2B",132,0)
 S (QUIT,PI)=0 F  S PI=$O(^IBE(TOFILE,"B",$E(NAME,1,30),PI)) Q:'PI  S LOOKNODE=$G(^IBE(TOFILE,PI,0)) I LOOKNODE'="" D  Q:QUIT
"RTN","IBDFU2B",133,0)
 .I NAME=$P(LOOKNODE,"^"),RTN=$P(LOOKNODE,"^",3),ENTRYPT=$P(LOOKNODE,"^",2),TYPE=$P(LOOKNODE,"^",6) S QUIT=1 Q  ;matches!
"RTN","IBDFU2B",134,0)
 Q PI
"RTN","IBDFU2B",135,0)
 ;
"RTN","IBDFU2B",136,0)
GETQLFR(QLFR,FROMFILE,TOFILE) ;copys qualifier=QLFR from file=FROMFILE to file=TOFILE if it does not already exist
"RTN","IBDFU2B",137,0)
 ;returns the ien of the qualifier existing in TOFILE
"RTN","IBDFU2B",138,0)
 Q:($G(FROMFILE)'=357.98)&($G(FROMFILE)'=358.98) ""
"RTN","IBDFU2B",139,0)
 Q:($G(TOFILE)'=357.98)&($G(TOFILE)'=358.98) ""
"RTN","IBDFU2B",140,0)
 Q:'$G(QLFR) ""
"RTN","IBDFU2B",141,0)
 Q:FROMFILE=TOFILE QLFR ;files are the same!
"RTN","IBDFU2B",142,0)
 N NODE,NAME,NEWQLFR
"RTN","IBDFU2B",143,0)
 S NEWQLFR=""
"RTN","IBDFU2B",144,0)
 S NODE=$G(^IBD(FROMFILE,QLFR,0)) Q:NODE="" ""
"RTN","IBDFU2B",145,0)
 S NAME=$P(NODE,"^",1)
"RTN","IBDFU2B",146,0)
 Q:NAME="" ""
"RTN","IBDFU2B",147,0)
 ;does it already exist?
"RTN","IBDFU2B",148,0)
 S NEWQLFR=0 F  S NEWQLFR=$O(^IBD(TOFILE,"B",$E(NAME,1,30),NEWQLFR)) Q:'NEWQLFR  Q:$P($G(^IBD(TOFILE,NEWQLFR,0)),"^")=NAME
"RTN","IBDFU2B",149,0)
 Q:NEWQLFR NEWQLFR ;quit if it already exists
"RTN","IBDFU2B",150,0)
 K DIC,DO,DINUM,DD S DIC="^IBD("_TOFILE_",",X=NAME,DIC(0)=""
"RTN","IBDFU2B",151,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDFU2B",152,0)
 S NEWQLFR=$S(+Y<0:"",1:+Y)
"RTN","IBDFU2B",153,0)
 Q:'NEWQLFR ""
"RTN","IBDFU2B",154,0)
 S ^IBD(TOFILE,NEWQLFR,0)=NODE
"RTN","IBDFU2B",155,0)
 K DIK,DA S DIK="^IBD("_TOFILE_",",DA=NEWQLFR
"RTN","IBDFU2B",156,0)
 D IX1^DIK K DIK,DA
"RTN","IBDFU2B",157,0)
 Q NEWQLFR
"RTN","IBDFU2B",158,0)
 ;
"RTN","IBDFU2B",159,0)
GETADE(ADE,FROMFILE,TOFILE) ;copys AICS Data Element=ADE from file=FROMFILE to file=TOFILE if it does not already exist
"RTN","IBDFU2B",160,0)
 ;returns the ien of the qualifier existing in TOFILE
"RTN","IBDFU2B",161,0)
 Q:($G(FROMFILE)'=359.1)&($G(FROMFILE)'=358.99) ""
"RTN","IBDFU2B",162,0)
 Q:($G(TOFILE)'=359.1)&($G(TOFILE)'=358.99) ""
"RTN","IBDFU2B",163,0)
 Q:'$G(ADE) ""
"RTN","IBDFU2B",164,0)
 Q:FROMFILE=TOFILE ADE ;files are the same!
"RTN","IBDFU2B",165,0)
 N NODE,NAME,NEWADE,SUB
"RTN","IBDFU2B",166,0)
 S NEWADE=""
"RTN","IBDFU2B",167,0)
 S NODE=$G(^IBE(FROMFILE,ADE,0)) Q:NODE="" ""
"RTN","IBDFU2B",168,0)
 S NAME=$P(NODE,"^",1)
"RTN","IBDFU2B",169,0)
 Q:NAME="" ""
"RTN","IBDFU2B",170,0)
 S NEWADE=$O(^IBE(TOFILE,"B",NAME,0)) Q:NEWADE NEWADE ;quit if it already exists
"RTN","IBDFU2B",171,0)
 K DIC,DO,DINUM,DD S DIC="^IBE("_TOFILE_",",X=NAME,DIC(0)=""
"RTN","IBDFU2B",172,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDFU2B",173,0)
 S NEWADE=$S(+Y<0:"",1:+Y)
"RTN","IBDFU2B",174,0)
 Q:'NEWADE ""
"RTN","IBDFU2B",175,0)
 S ^IBE(TOFILE,NEWADE,0)=NODE
"RTN","IBDFU2B",176,0)
 ;
"RTN","IBDFU2B",177,0)
 ; -- 9/28/95 add 10 node to be moved for moved fields 
"RTN","IBDFU2B",178,0)
 F SUB=1,2,3,10 S NODE=$G(^IBE(FROMFILE,ADE,SUB)) I NODE'="" S ^IBE(TOFILE,NEWADE,SUB)=NODE
"RTN","IBDFU2B",179,0)
 K DIK,DA S DIK="^IBE("_TOFILE_",",DA=NEWADE
"RTN","IBDFU2B",180,0)
 D IX1^DIK K DIK,DA
"RTN","IBDFU2B",181,0)
 Q NEWADE
"RTN","IBDY338")
0^34^B6785174
"RTN","IBDY338",1,0)
IBDY338 ;ALB/DHH - POST INSTALL FOR PATCH IBD*3*38 ; OCT 1, 1999
"RTN","IBDY338",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**38**;APR 24, 1997
"RTN","IBDY338",3,0)
 ;
"RTN","IBDY338",4,0)
 D ASK,ASK1
"RTN","IBDY338",5,0)
 ;
"RTN","IBDY338",6,0)
 ;-- Add CPT Modifier Tool Kit Blocks to Tool Kit
"RTN","IBDY338",7,0)
 D AUTOINS
"RTN","IBDY338",8,0)
 Q
"RTN","IBDY338",9,0)
 ;
"RTN","IBDY338",10,0)
ASK ;-- Set ASK CPT MODIFIERS to yes for DG SELECT CPT PROCEDURE CODES
"RTN","IBDY338",11,0)
 ;   in the package interface file
"RTN","IBDY338",12,0)
 ;
"RTN","IBDY338",13,0)
 D MES^XPDUTL(">>> Updating DG SELECT CPT PROCEDURE CODES Package Interface.")
"RTN","IBDY338",14,0)
 N I,J,X
"RTN","IBDY338",15,0)
 S I=0
"RTN","IBDY338",16,0)
 F  S I=$O(^IBE(357.6,"B",$E("DG SELECT CPT PROCEDURE CODES",1,30),I)) Q:'I  D
"RTN","IBDY338",17,0)
 .I $P($G(^IBE(357.6,I,0)),"^")="DG SELECT CPT PROCEDURE CODES" S $P(^IBE(357.6,I,0),"^",21)=1
"RTN","IBDY338",18,0)
 Q
"RTN","IBDY338",19,0)
 ;
"RTN","IBDY338",20,0)
ASK1 ;-- Set ASK CPT MODIFIERS to yes for DG SELECT VISIT TYPE PROCEDURES
"RTN","IBDY338",21,0)
 ;   in the package interface file
"RTN","IBDY338",22,0)
 ;
"RTN","IBDY338",23,0)
 D MES^XPDUTL(">>> Updating DG SELECT VISIT TYPE CPT PROCEDURES Package Interface.")
"RTN","IBDY338",24,0)
 N I,J,X
"RTN","IBDY338",25,0)
 S I=0
"RTN","IBDY338",26,0)
 F  S I=$O(^IBE(357.6,"B",$E("DG SELECT VISIT TYPE CPT PROCEDURES",1,30),I)) Q:'I  D
"RTN","IBDY338",27,0)
 .I $P($G(^IBE(357.6,I,0)),"^")="DG SELECT VISIT TYPE CPT PROCEDURES" S $P(^IBE(357.6,I,0),"^",21)=1
"RTN","IBDY338",28,0)
 Q
"RTN","IBDY338",29,0)
 ;
"RTN","IBDY338",30,0)
AUTOINS ;-- Auto install CPT Modifier tool kit blocks into AICS Tool Kit
"RTN","IBDY338",31,0)
 N FORM,NEWFORM,FORMNM,CNT,CNT1,ARY,NAME,X,Y,NEWBLOCK,A,EXCLUDE,BLK,CNTF,CNTB
"RTN","IBDY338",32,0)
 D MES^XPDUTL(">>> Adding CPT Modifier Tool Kit Blocks to AICS Tool Kit.")
"RTN","IBDY338",33,0)
 S (CNTB,CNTF)=0
"RTN","IBDY338",34,0)
 ;
"RTN","IBDY338",35,0)
 ;-- Add all tool kit blocks
"RTN","IBDY338",36,0)
 S FORMNM="TOOL KIT"
"RTN","IBDY338",37,0)
 I '$O(^IBE(357,"B",FORMNM,0)) Q
"RTN","IBDY338",38,0)
 S ORD="" F  S ORD=$O(^IBE(358.1,"D",ORD)) Q:ORD=""  S BLK=0 F  S BLK=$O(^IBE(358.1,"D",ORD,BLK)) Q:'BLK  D
"RTN","IBDY338",39,0)
 .S NAME=$P($G(^IBE(358.1,+BLK,0)),"^")
"RTN","IBDY338",40,0)
 .Q:$P($G(^IBE(358.1,BLK,0)),"^",14)'=1  ;not toolkit
"RTN","IBDY338",41,0)
 .I $O(^IBE(357.1,"B",NAME,0)) D MES^XPDUTL("     Block "_NAME_" already exists") Q
"RTN","IBDY338",42,0)
 .D MES^XPDUTL("    Moving block '"_$P($G(^IBE(358.1,+BLK,0)),"^")_"' from Import/Export files to Tool Kit")
"RTN","IBDY338",43,0)
 .N IBTKBLK S IBTKBLK=1
"RTN","IBDY338",44,0)
 .S NEWBLOCK=$$COPYBLK^IBDFU2(BLK,$$TKFORM^IBDFU2C,358.1,357.1,"","",$$TKORDER^IBDF13),CNTB=CNTB+1
"RTN","IBDY338",45,0)
 .D:$G(NEWBLOCK) DLTBLK^IBDFU3(BLK,"",358.1)
"RTN","IBDY338",46,0)
 ;
"RTN","IBDY338",47,0)
 ;-- Clear workspace
"RTN","IBDY338",48,0)
 D DLTALL^IBDE2
"RTN","IBDY338",49,0)
 Q
"RTN","IBDY338",50,0)
PREINIT ; Pre-Init for Patch 38
"RTN","IBDY338",51,0)
 ; clearing workspace - imp/exp
"RTN","IBDY338",52,0)
 D MES^XPDUTL(">>> Clearing Import/Export Workspace Now...")
"RTN","IBDY338",53,0)
 D DLTALL^IBDE2
"RTN","IBDY338",54,0)
 Q
"UP",357.3,357.33,-1)
357.3^3
"UP",357.3,357.33,0)
357.33
"UP",357.95,357.951,-1)
357.95^1
"UP",357.95,357.951,0)
357.951
"VER")
8.0^22.0
"^DD",357.3,357.3,3,0)
CPT MODIFIER^357.33^^3;0
"^DD",357.3,357.3,3,"DT")
2990920
"^DD",357.3,357.33,0)
CPT MODIFIER SUB-FIELD^^1^2
"^DD",357.3,357.33,0,"DIK")
IBDX3
"^DD",357.3,357.33,0,"DT")
2990908
"^DD",357.3,357.33,0,"IX","B",357.33,.01)

"^DD",357.3,357.33,0,"NM","CPT MODIFIER")

"^DD",357.3,357.33,0,"UP")
357.3
"^DD",357.3,357.33,.01,0)
CPT MODIFIER^MFX^^0;1^D MOD^IBDF4C K:$L(X)>2!($L(X)<2) X
"^DD",357.3,357.33,.01,1,0)
^.1
"^DD",357.3,357.33,.01,1,1,0)
357.33^B
"^DD",357.3,357.33,.01,1,1,1)
S ^IBE(357.3,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",357.3,357.33,.01,1,1,2)
K ^IBE(357.3,DA(1),3,"B",$E(X,1,30),DA)
"^DD",357.3,357.33,.01,3)
Answer must be 2 characters in length. The field should contain the 2 character CPT Modifier which is in the .01 field of the CPT MODIFIER file.
"^DD",357.3,357.33,.01,4)
D LOOKUP^IBDF4C
"^DD",357.3,357.33,.01,21,0)
^^1^1^2991216^
"^DD",357.3,357.33,.01,21,1,0)
The two character .01 field of the CPT MODIFIER file is stored.
"^DD",357.3,357.33,.01,"DT")
2990920
"^DD",357.3,357.33,1,0)
NAME^F^^0;2^K:$L(X)>30!($L(X)<3) X
"^DD",357.3,357.33,1,3)
Answer must be 3-30 characters in length.
"^DD",357.3,357.33,1,21,0)
^^1^1^3000121^
"^DD",357.3,357.33,1,21,1,0)
Description (name) of CPT Modifier.
"^DD",357.3,357.33,1,"DT")
2990908
"^DD",357.6,357.6,0)
FIELD^^21^57
"^DD",357.6,357.6,0,"ACT")
D ASK^IBDFU9
"^DD",357.6,357.6,0,"DDA")
N
"^DD",357.6,357.6,0,"DT")
2990304
"^DD",357.6,357.6,0,"ID",.06)
W ""
"^DD",357.6,357.6,0,"ID","WRITE")
Q  N IBDWNAM S IBDWNAM=$E($P(^(0),U),1,40) D EN^DDIOL(IBDWNAM,"","!?0")
"^DD",357.6,357.6,0,"ID","WRITE1")
N IBDWTYPE S IBDWTYPE=$S($P(^(0),"^",6)=1:"INPUT",$P(^(0),"^",6)=2:"OUTPUT",$P(^(0),"^",6)=3:"SELECTION",1:"REPORT")_$S($P(^(0),"^",6)=3&'$P(^(0),"^",13):"  ** NOT SCANNABLE **",1:"") D EN^DDIOL("TYPE="_IBDWTYPE,"","?45")
"^DD",357.6,357.6,0,"IX","B",357.6,.01)

"^DD",357.6,357.6,0,"IX","C",357.6,.04)

"^DD",357.6,357.6,0,"IX","D",357.6,3)

"^DD",357.6,357.6,0,"IX","E",357.6,.01)

"^DD",357.6,357.6,0,"NM","PACKAGE INTERFACE")

"^DD",357.6,357.6,0,"PT",357.13,.03)

"^DD",357.6,357.6,0,"PT",357.14,.04)

"^DD",357.6,357.6,0,"PT",357.2,.11)

"^DD",357.6,357.6,0,"PT",357.5,.03)

"^DD",357.6,357.6,0,"PT",357.6,.13)

"^DD",357.6,357.6,0,"PT",357.93,.06)

"^DD",357.6,357.6,0,"PT",357.951,.03)

"^DD",357.6,357.6,0,"PT",357.952,.04)

"^DD",357.6,357.6,0,"PT",357.961,.03)

"^DD",357.6,357.6,0,"PT",357.962,.03)

"^DD",357.6,357.6,0,"PT",358.94,.06)

"^DD",357.6,357.6,0,"PT",359.3,.1)

"^DD",357.6,357.6,0,"PT",359.94,.06)

"^DD",357.6,357.6,0,"PT",409.9501,.01)

"^DD",357.6,357.6,0,"PT",409.9502,.01)

"^DD",357.6,357.6,0,"PT",409.961,.01)

"^DD",357.6,357.6,0,"VRPK")
IBD
"^DD",357.6,357.6,.01,0)
NAME^RFX^^0;1^K:$L(X)>40!($L(X)<3)!'(X'?1P.E) X
"^DD",357.6,357.6,.01,1,0)
^.1
"^DD",357.6,357.6,.01,1,1,0)
357.6^B
"^DD",357.6,357.6,.01,1,1,1)
S ^IBE(357.6,"B",$E(X,1,30),DA)=""
"^DD",357.6,357.6,.01,1,1,2)
K ^IBE(357.6,"B",$E(X,1,30),DA)
"^DD",357.6,357.6,.01,1,2,0)
357.6^E^MUMPS
"^DD",357.6,357.6,.01,1,2,1)
N IBDXE S IBDXE=$E(X,$F(X," "),40) S:$A(IBDXE)<33 IBDXE=X S ^IBE(357.6,"E",IBDXE,DA)=""
"^DD",357.6,357.6,.01,1,2,2)
N IBDXE S IBDXE=$E(X,$F(X," "),40) S:$A(IBDXE)<33 IBDXE=X K ^IBE(357.6,"E",IBDXE,DA)
"^DD",357.6,357.6,.01,1,2,"%D",0)
^^4^4^2970711^^^^
"^DD",357.6,357.6,.01,1,2,"%D",1,0)
 
"^DD",357.6,357.6,.01,1,2,"%D",2,0)
For package interfaces that are output routines the name has the custodial
"^DD",357.6,357.6,.01,1,2,"%D",3,0)
package's name space as a prefix. This cross-reference removes that
"^DD",357.6,357.6,.01,1,2,"%D",4,0)
prefix. It is used to improve the display of output routines for the user.
"^DD",357.6,357.6,.01,1,2,"DT")
2970711
"^DD",357.6,357.6,.01,3)
The name should be prefixed with the namespace of the package that provides the data.
"^DD",357.6,357.6,.01,21,0)
^^3^3^2951017^
"^DD",357.6,357.6,.01,21,1,0)
 
"^DD",357.6,357.6,.01,21,2,0)
The name of the Package Interface. The name should be preceded with the
"^DD",357.6,357.6,.01,21,3,0)
namespace of the package.
"^DD",357.6,357.6,.01,23,0)
^^1^1^2951017^^^
"^DD",357.6,357.6,.01,23,1,0)
 
"^DD",357.6,357.6,.01,"DT")
2970711
"^DD",357.6,357.6,.02,0)
ENTRY POINT^F^^0;2^K:$L(X)>8!($L(X)<1) X
"^DD",357.6,357.6,.02,3)
What entry point into the routine does this package interface use?
"^DD",357.6,357.6,.02,21,0)
^^2^2^2941018^^
"^DD",357.6,357.6,.02,21,1,0)
 
"^DD",357.6,357.6,.02,21,2,0)
The entry point in the routine that should be called.
"^DD",357.6,357.6,.02,"DT")
2941018
"^DD",357.6,357.6,.03,0)
ROUTINE^F^^0;3^K:$L(X)>8!($L(X)<1) X
"^DD",357.6,357.6,.03,3)
What routine does this package interface use?
"^DD",357.6,357.6,.03,21,0)
^^2^2^2941018^^
"^DD",357.6,357.6,.03,21,1,0)
 
"^DD",357.6,357.6,.03,21,2,0)
The routine that should be called.
"^DD",357.6,357.6,.03,"DT")
2921125
"^DD",357.6,357.6,.04,0)
CUSTODIAL PACKAGE^F^^0;4^K:$L(X)>30!($L(X)<3) X
"^DD",357.6,357.6,.04,1,0)
^.1
"^DD",357.6,357.6,.04,1,1,0)
357.6^C
"^DD",357.6,357.6,.04,1,1,1)
S ^IBE(357.6,"C",$E(X,1,30),DA)=""
"^DD",357.6,357.6,.04,1,1,2)
K ^IBE(357.6,"C",$E(X,1,30),DA)
"^DD",357.6,357.6,.04,1,1,"DT")
2921229
"^DD",357.6,357.6,.04,3)
Answer must be 3-30 characters in length.
"^DD",357.6,357.6,.04,21,0)
^^2^2^2951017^^
"^DD",357.6,357.6,.04,21,1,0)
This is a free text pointer to the package file. It serves only to
"^DD",357.6,357.6,.04,21,2,0)
document the custodial package of the data.
"^DD",357.6,357.6,.04,"DT")
2951017
"^DD",357.6,357.6,.05,0)
VARIABLE DATA?^S^0:NO;1:YES;^0;5^Q
"^DD",357.6,357.6,.05,.1)
DOES THE DATA VARY FROM PATIENT TO PATIENT?
"^DD",357.6,357.6,.05,3)
Enter YES if the data returned is variable, NO if the data is always the same.
"^DD",357.6,357.6,.05,21,0)
^^3^3^2930726^^^
"^DD",357.6,357.6,.05,21,1,0)
This field is used in the batch printing of encounter forms. The purpose
"^DD",357.6,357.6,.05,21,2,0)
is to avoid recomputing fields whose data does not change from patient to
"^DD",357.6,357.6,.05,21,3,0)
patient.
"^DD",357.6,357.6,.05,"DT")
2931124
"^DD",357.6,357.6,.06,0)
ACTION TYPE^RS^1:INPUT;2:DISPLAY;3:SELECTION;4:PRINT REPORT;^0;6^Q
"^DD",357.6,357.6,.06,3)
Is this interface for inputting data, displaying data to a form, for creating lists that will appear on a form, or for printing reports?
"^DD",357.6,357.6,.06,21,0)
^^10^10^2981216^^^^
"^DD",357.6,357.6,.06,21,1,0)

"^DD",357.6,357.6,.06,21,2,0)
Enter 1 for INPUT if the interface accepts data input from the user
"^DD",357.6,357.6,.06,21,3,0)
        and transmits the data to the appropriate package. 
"^DD",357.6,357.6,.06,21,4,0)
Enter 2 for DISPLAY if the interface retrieves data for display to a form.
"^DD",357.6,357.6,.06,21,5,0)
Enter 3 for SELECTION if the interface is for building a list to display
"^DD",357.6,357.6,.06,21,6,0)
        to a form.
"^DD",357.6,357.6,.06,21,7,0)
Enter 4 if the interface is for printing a report.
"^DD",357.6,357.6,.06,21,8,0)

"^DD",357.6,357.6,.06,21,9,0)
If the ACTION TYPE is SELECTION then the data type must be a record and
"^DD",357.6,357.6,.06,21,10,0)
the first piece must be the ID use to uniquely identify the selection.
"^DD",357.6,357.6,.06,23,0)
^^1^1^2981216^^^^
"^DD",357.6,357.6,.06,23,1,0)
 
"^DD",357.6,357.6,.06,"DT")
2950825
"^DD",357.6,357.6,.07,0)
DATA TYPE^S^1:SINGLE VALUE;2:RECORD;3:LIST OF SINGLE VALUES;4:LIST OF RECORDS;5:WORD PROCESSING;^0;7^Q
"^DD",357.6,357.6,.07,.1)
WHAT FORMAT WILL THE DATA BE IN?
"^DD",357.6,357.6,.07,3)
What format will the data be in?
"^DD",357.6,357.6,.07,21,0)
^^9^9^2981216^^
"^DD",357.6,357.6,.07,21,1,0)
Only applies to selection or display interfaces, both of which retrieve
"^DD",357.6,357.6,.07,21,2,0)
data for display to a form. It is the type of format the data should be
"^DD",357.6,357.6,.07,21,3,0)
in.
"^DD",357.6,357.6,.07,21,4,0)
 
"^DD",357.6,357.6,.07,21,5,0)
A single value is a string without pieces. A record is a set of strings
"^DD",357.6,357.6,.07,21,6,0)
concatenated together with "^" separating the pieces. A list is an
"^DD",357.6,357.6,.07,21,7,0)
indefinite number of values, each numbered, each containing the same type
"^DD",357.6,357.6,.07,21,8,0)
of information. A word processing data type will be in FM format.
"^DD",357.6,357.6,.07,21,9,0)
If the ACTION TYPE is SELECTION then the data type must be record.
"^DD",357.6,357.6,.07,"DT")
2930726
"^DD",357.6,357.6,.08,0)
PRINT COMPLETE^S^0:NO;1:YES;^0;8^Q
"^DD",357.6,357.6,.08,3)
If there is insufficient room on the form to print the data, should it be re-printed in full on a separate page?
"^DD",357.6,357.6,.08,21,0)
^^4^4^2930527^
"^DD",357.6,357.6,.08,21,1,0)
 
"^DD",357.6,357.6,.08,21,2,0)
This field is used to determine what should happen if the data does not
"^DD",357.6,357.6,.08,21,3,0)
fit in the space allocated to it on the form. If answered YES the data
"^DD",357.6,357.6,.08,21,4,0)
will be printed on another page.
"^DD",357.6,357.6,.08,"DT")
2930507
"^DD",357.6,357.6,.09,0)
AVAILABLE? (Y/N)^RS^0:NO;1:YES;^0;9^Q
"^DD",357.6,357.6,.09,3)
Is this package interface now available for use?
"^DD",357.6,357.6,.09,21,0)
^^3^3^2930527^
"^DD",357.6,357.6,.09,21,1,0)
 
"^DD",357.6,357.6,.09,21,2,0)
This field should be set to YES if the interface is available, NO if it is
"^DD",357.6,357.6,.09,21,3,0)
not available. Interfaces that are not available are not called.
"^DD",357.6,357.6,.09,"DT")
2921213
"^DD",357.6,357.6,.1,0)
HEALTH SUMMARY?^S^0:NO;1:YES;^0;10^Q
"^DD",357.6,357.6,.1,.1)
ARE YOU REQUESTING A HEALTH SUMMARY?
"^DD",357.6,357.6,.1,2.1)
S:Y=+Y Y=Y+1
"^DD",357.6,357.6,.1,3)
 Are you requesting a HEALTH SUMMARY to print?
"^DD",357.6,357.6,.1,21,0)
^^7^7^2930616^
"^DD",357.6,357.6,.1,21,1,0)
 
"^DD",357.6,357.6,.1,21,2,0)
This field will determine how to go about printing the report or form. It
"^DD",357.6,357.6,.1,21,3,0)
applies only to Package Interfaces of ACTION TYPE = PRINT REPORT. Health
"^DD",357.6,357.6,.1,21,4,0)
Summaries use the field HEALTH SUMMARY to determine the type of Health
"^DD",357.6,357.6,.1,21,5,0)
Summary to print. The process of printing Health Summaries dos not use the
"^DD",357.6,357.6,.1,21,6,0)
fields ENTRY POINT or ROUTINE, since all Health Summaries are printed in
"^DD",357.6,357.6,.1,21,7,0)
the same way.
"^DD",357.6,357.6,.1,"DT")
2930616
"^DD",357.6,357.6,.11,0)
TYPE OF HEALTH SUMMARY^*P142'^GMT(142,^0;11^S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",357.6,357.6,.11,3)
Which Health Summary do you want printed?
"^DD",357.6,357.6,.11,12)
EXCLUDES AD HOC HEALTH SUMMARIES
"^DD",357.6,357.6,.11,12.1)
S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"^DD",357.6,357.6,.11,21,0)
^^4^4^2970819^^
"^DD",357.6,357.6,.11,21,1,0)
 
"^DD",357.6,357.6,.11,21,2,0)
This identifies the Health Summary that should be printed when this
"^DD",357.6,357.6,.11,21,3,0)
Package Interface is invoked. It should be null unless the HEALTH SUMMARY?
"^DD",357.6,357.6,.11,21,4,0)
field #.1 is coded YES.
"^DD",357.6,357.6,.11,"DT")
2930617
"^DD",357.6,357.6,.12,0)
TOOLKIT MEMBER?^S^0:NO;1:YES;^0;12^Q
"^DD",357.6,357.6,.12,.1)
SHOULD THIS PACKAGE INTERFACE BE PART OF THE TOOLKIT?
"^DD",357.6,357.6,.12,3)
Enter YES if this PACKAGE INTERFACE was added by the package developers as part of the toolkit, enter NO otherwise.
"^DD",357.6,357.6,.12,21,0)
^^3^3^2950808^^
"^DD",357.6,357.6,.12,21,1,0)
 
"^DD",357.6,357.6,.12,21,2,0)
Package Interfaces that are developed for national use will be documented
"^DD",357.6,357.6,.12,21,3,0)
as being part of the toolkit.
"^DD",357.6,357.6,.12,"DT")
2950711
"^DD",357.6,357.6,.13,0)
PACKAGE INTERFACE FOR INPUT^*P357.6'^IBE(357.6,^0;13^S DIC("S")="I $P(^(0),U,6)=1,$P(^(0),U,9)=1,$P(^(0),U,16)[""S""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",357.6,357.6,.13,.1)
WHICH INTERFACE SHOULD THIS LIST USE FOR PASSING DATA TO THE DATA BASE?
"^DD",357.6,357.6,.13,3)
What interface should be used for inputting data entered on the selection list?
"^DD",357.6,357.6,.13,12)
Must be an available interfaces for accepting input from selection lists.
"^DD",357.6,357.6,.13,12.1)
S DIC("S")="I $P(^(0),U,6)=1,$P(^(0),U,9)=1,$P(^(0),U,16)[""S"""
"^DD",357.6,357.6,.13,21,0)
^^1^1^2970902^^^^
"^DD",357.6,357.6,.13,21,1,0)
Used to map scanned data to DHCP.
"^DD",357.6,357.6,.13,"DT")
2950825
"^DD",357.6,357.6,.14,0)
DYNAMIC SELECTIONS^S^0:NO;1:YES;^0;14^Q
"^DD",357.6,357.6,.14,3)
Only for selection routines. Enter YES if the Package Interface builds the selection list each time the form is printed.
"^DD",357.6,357.6,.14,21,0)
^^2^2^2950719^
"^DD",357.6,357.6,.14,21,1,0)
This is used to indicate whether the interface is used to build selection
"^DD",357.6,357.6,.14,21,2,0)
lists at print time.
"^DD",357.6,357.6,.14,"DT")
2941221
"^DD",357.6,357.6,.15,0)
DO NOT USE DFN AS A SUBSCRIPT^*S^0:NO;1:YES;^0;15^Q
"^DD",357.6,357.6,.15,3)
If the patient DFN should not be used as a subscript when passing data enter YES.
"^DD",357.6,357.6,.15,12)
If the action type is not OUTPUT ROUTINE then this field should not be set to NO.
"^DD",357.6,357.6,.15,12.1)
S DIC("S")="I (Y=1)!($P(^IBE(357.6,DA,0),U,6)=2)"
"^DD",357.6,357.6,.15,21,0)
^^6^6^2950413^^^^
"^DD",357.6,357.6,.15,21,1,0)
Originally, the patient DFN was used as a subscript when returning data
"^DD",357.6,357.6,.15,21,2,0)
for Package Interfaces of type output, but not for other types of
"^DD",357.6,357.6,.15,21,3,0)
interfaces. It is no longer necessary for any new Package Interface to use
"^DD",357.6,357.6,.15,21,4,0)
DFN as a subscript, but, to maintain compatibilty, output routines
"^DD",357.6,357.6,.15,21,5,0)
must set this field to YES if DFN is not to be used as a subscript. This
"^DD",357.6,357.6,.15,21,6,0)
field has no effect on other types of interfaces.
"^DD",357.6,357.6,.15,"DT")
2950413
"^DD",357.6,357.6,.16,0)
ALLOWED OBJECT USE^FX^^0;16^S X=$$UPPER^VALM1(X) K:$L(X)>4!("SMHP"'[$E(X,1))!("SMHP"'[$E(X,2))!("SMHP"'[$E(X,3))!("SMHP"'[$E(X,4)) X
"^DD",357.6,357.6,.16,3)

"^DD",357.6,357.6,.16,4)
D HELP7^IBDFU5A
"^DD",357.6,357.6,.16,21,0)
^^5^5^2950913^^^^
"^DD",357.6,357.6,.16,21,1,0)
This field applies only to package interfaces for input and is used to
"^DD",357.6,357.6,.16,21,2,0)
determine which package interfaces a particular type of form object may
"^DD",357.6,357.6,.16,21,3,0)
point to. Some combinations don't make sense. For example, it would not
"^DD",357.6,357.6,.16,21,4,0)
make sense to allow a multiple choice question to point to vitals, which
"^DD",357.6,357.6,.16,21,5,0)
is used to input data such as temperature and blood pressure.
"^DD",357.6,357.6,.16,"DT")
2950913
"^DD",357.6,357.6,.17,0)
ASK FOR ADDITIONAL NARRATIVE^S^0:NO;1:YES;^0;17^Q
"^DD",357.6,357.6,.17,21,0)
^^7^7^2951207^
"^DD",357.6,357.6,.17,21,1,0)
Enter whether users should be prompt for specifying the provider narrative
"^DD",357.6,357.6,.17,21,2,0)
that will be sent to PCE (and problem list) when creating a selection list.
"^DD",357.6,357.6,.17,21,3,0)
If this is answered no and the narrative is sent to PCE then the text as it
"^DD",357.6,357.6,.17,21,4,0)
appears on the form will be used as the provider narrative.
"^DD",357.6,357.6,.17,21,5,0)
 
"^DD",357.6,357.6,.17,21,6,0)
Generally only dianosis and clinical lexicon entries will want this field 
"^DD",357.6,357.6,.17,21,7,0)
set to Yes.
"^DD",357.6,357.6,.17,"DT")
2951207
"^DD",357.6,357.6,.18,0)
ASK FOR CLINICAL LEXICON^S^0:NO;1:YES;^0;18^Q
"^DD",357.6,357.6,.18,3)
Enter 'Yes' if you want to map entries from this interface to the clinical lexicon
"^DD",357.6,357.6,.18,21,0)
^^10^10^2960205^
"^DD",357.6,357.6,.18,21,1,0)
If this field is answered 'Yes' then users who are editing or creating
"^DD",357.6,357.6,.18,21,2,0)
selection lists based on this interface will be asked to map each entry
"^DD",357.6,357.6,.18,21,3,0)
(thought it is optional) to a clinical lexicon entry.  This is highly
"^DD",357.6,357.6,.18,21,4,0)
recommended for user who are scanning diagnosis entries and trying to 
"^DD",357.6,357.6,.18,21,5,0)
add entries to the Patients Problem list.
"^DD",357.6,357.6,.18,21,6,0)
 
"^DD",357.6,357.6,.18,21,7,0)
The primary purpose of this field is to allow sites who have built selection
"^DD",357.6,357.6,.18,21,8,0)
lists using the ICD9 Diagnosis file to map each entry to the clinical lexicon.
"^DD",357.6,357.6,.18,21,9,0)
The Problem List EP has recommended that each problem added to the problem
"^DD",357.6,357.6,.18,21,10,0)
list be associated with a clinical lexicon entry.
"^DD",357.6,357.6,.18,"DT")
2960205
"^DD",357.6,357.6,.19,0)
DQ REQUIRED^S^1:YES;^0;19^Q
"^DD",357.6,357.6,.19,21,0)
^^2^2^2960228^^
"^DD",357.6,357.6,.19,21,1,0)
Field used to determine if a data qualifier is required for this
"^DD",357.6,357.6,.19,21,2,0)
input interface.
"^DD",357.6,357.6,.19,"DT")
2960212
"^DD",357.6,357.6,.2,0)
ASK FOR CLINICAL REMINDERS^S^0:NO;1:YES;^0;20^Q
"^DD",357.6,357.6,.2,3)
If this package interface is for display of clinical reminders answer yes, otherwise answer no.
"^DD",357.6,357.6,.2,21,0)
^^2^2^2991216^^^^
"^DD",357.6,357.6,.2,21,1,0)
If this package interface is for display of clinical reminders answer 
"^DD",357.6,357.6,.2,21,2,0)
yes, otherwise answer no.
"^DD",357.6,357.6,.2,"DT")
2971002
"^DD",357.6,357.6,.21,0)
ASK FOR CPT MODIFIERS?^S^0:NO;1:YES;^0;21^Q
"^DD",357.6,357.6,.21,3)
If this package interface is to prompt for CPT Modifiers, answer yes, otherwise answer no.
"^DD",357.6,357.6,.21,21,0)
^^3^3^3000121^^^^
"^DD",357.6,357.6,.21,21,1,0)
ASK FOR CPT MODIFIERS field will be used when selecting CPT codes.
"^DD",357.6,357.6,.21,21,2,0)
If answered "YES" and data is a procedure, CPT Modifiers should be
"^DD",357.6,357.6,.21,21,3,0)
asked during Forms Design and Manual Data Entry.
"^DD",357.6,357.6,.21,"DT")
2990524
"^DD",357.6,357.6,1,0)
DESCRIPTION^357.61^^1;0
"^DD",357.6,357.6,1,21,0)
^^1^1^2950719^^^^
"^DD",357.6,357.6,1,21,1,0)
Should describe the data being exchanged by the package interface.
"^DD",357.6,357.6,2.01,0)
PIECE 1 DESCRIPTIVE NAME^F^^2;1^K:$L(X)>30!($L(X)<3) X
"^DD",357.6,357.6,2.01,.1)
WHAT IS THE FIRST PIECE OF DATA RETURNED BY THE INTERFACE?
"^DD",357.6,357.6,2.01,3)
Answer must be 3-30 characters in length.
"^DD",357.6,357.6,2.01,21,0)
^^3^3^2930527^
"^DD",357.6,357.6,2.01,21,1,0)
 
"^DD",357.6,357.6,2.01,21,2,0)
Should be a descriptive name of the first field in the record returned by
"^DD",357.6,357.6,2.01,21,3,0)
the interface.
"^DD",357.6,357.6,2.01,"DT")
2930726
"^DD",357.6,357.6,2.02,0)
PIECE 1 MAXIMUM LENGTH^NJ3,0^^2;2^K:+X'=X!(X>210)!(X<0)!(X?.E1"."1N.N) X
"^DD",357.6,357.6,2.02,.1)
WHAT IS ITS MAXIMUM LENGTH?
"^DD",357.6,357.6,2.02,3)
Type a Number between 0 and 210, 0 Decimal Digits
"^DD",357.6,357.6,2.02,21,0)
^^3^3^2930527^
"^DD",357.6,357.6,2.02,21,1,0)
 
"^DD",357.6,357.6,2.02,21,2,0)
The maximum length of the first field of the record returned by the
"^DD",357.6,357.6,2.02,21,3,0)
interface.
"^DD",357.6,357.6,2.02,"DT")
2930726
"^DD",357.6,357.6,2.16,0)
PIECE 1 RECOMMENDED HEADER^F^^2;16^K:$L(X)>20!($L(X)<1) X
"^DD",357.6,357.6,2.16,3)
Answer must be 1-20 characters in length.
"^DD",357.6,357.6,2.16,21,0)
^^1^1^2950719^
"^DD",357.6,357.6,2.16,21,1,0)
The recommended header will be used as the default when designing a form.
"^DD",357.6,357.6,2.16,"DT")
2950417
"^DD",357.6,357.6,2.17,0)
IS PIECE 1 DISPLAYABLE?^S^0:NO;1:YES;^2;17^Q
"^DD",357.6,357.6,2.17,.1)
CAN THIS FIELD BE DISPLAYED TO THE USER?
"^DD",357.6,357.6,2.17,3)
The first piece of the returned record is reserved for the unique id of the selection. Enter no if it should not be displayed, for example, if it is a pointer.
"^DD",357.6,357.6,2.17,21,0)
^^3^3^2950719^^
"^DD",357.6,357.6,2.17,21,1,0)
This is used only for selection type interfaces. If NO, then the value can
"^DD",357.6,357.6,2.17,21,2,0)
not be displayed to the encounter form.  The first piece must contain the
"^DD",357.6,357.6,2.17,21,3,0)
unique id of the selection.
"^DD",357.6,357.6,2.17,"DT")
2930810
"^DD",357.6,357.6,2.18,0)
EXPORT SELECTIONS/CHOICES?^S^0:NO;1:YES;^2;18^Q
"^DD",357.6,357.6,2.18,3)
Enter NO if the ID returned by the PACKAGE INTERFACE is not constant between sites, for example, if it is a pointer. Otherwise answer YES.
"^DD",357.6,357.6,2.18,21,0)
^^8^8^2950825^
"^DD",357.6,357.6,2.18,21,1,0)
 
"^DD",357.6,357.6,2.18,21,2,0)
 
"^DD",357.6,357.6,2.18,21,3,0)
Applies to selection and input routines. Determines whether
"^DD",357.6,357.6,2.18,21,4,0)
selections appearing on selection lists and choices in a multiple choice
"^DD",357.6,357.6,2.18,21,5,0)
field will be exported along with the form that they appear on. The
"^DD",357.6,357.6,2.18,21,6,0)
import/export utility will not resolve pointers, so if the id used by
"^DD",357.6,357.6,2.18,21,7,0)
the package interface is a pointer that differs between sites
"^DD",357.6,357.6,2.18,21,8,0)
this field should contain NO.
"^DD",357.6,357.6,2.18,"DT")
2950825
"^DD",357.6,357.6,3,0)
USER LOOKUP^F^^3;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>240!($L(X)<1) X
"^DD",357.6,357.6,3,.1)
LIST OF WORDS TO MAKE LOOK-UPS EASIER
"^DD",357.6,357.6,3,1,0)
^.1
"^DD",357.6,357.6,3,1,1,0)
357.6^D^KWIC
"^DD",357.6,357.6,3,1,1,1)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2,^DD("KWIC")'[I S ^IBE(357.6,"D",I,DA)=""
"^DD",357.6,357.6,3,1,1,2)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2 K ^IBE(357.6,"D",I,DA)
"^DD",357.6,357.6,3,1,1,"%D",0)
^^3^3^2930409^^
"^DD",357.6,357.6,3,1,1,"%D",1,0)
 
"^DD",357.6,357.6,3,1,1,"%D",2,0)
This index is meant to assist the user in locating the correct package
"^DD",357.6,357.6,3,1,1,"%D",3,0)
interface needed to display a particular item of data to a form.
"^DD",357.6,357.6,3,1,1,"DT")
2930309
"^DD",357.6,357.6,3,3)
Enter words separated with spaces. They will be indexed to assist in lookup.
"^DD",357.6,357.6,3,4)
D LOOKUP^IBDF16
"^DD",357.6,357.6,3,21,0)
^^4^4^2940217^
"^DD",357.6,357.6,3,21,1,0)
 
"^DD",357.6,357.6,3,21,2,0)
This field is used to create a KWIC index for this file. The purpose is to
"^DD",357.6,357.6,3,21,3,0)
assist the user in locating the package interface he needs to display a
"^DD",357.6,357.6,3,21,4,0)
particular item of data to a form.
"^DD",357.6,357.6,3,"DT")
2930726
"^DD",357.6,357.6,4.01,0)
ENTRY ACTION^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",357.6,357.6,4.01,3)
This is Standard MUMPS code.
"^DD",357.6,357.6,4.01,9)
@
"^DD",357.6,357.6,4.01,21,0)
^^3^3^2930527^
"^DD",357.6,357.6,4.01,21,1,0)
 
"^DD",357.6,357.6,4.01,21,2,0)
This code will be executed after the PROTECTED VARIABLES are newed, but
"^DD",357.6,357.6,4.01,21,3,0)
before the interface routine is called.
"^DD",357.6,357.6,4.01,"DT")
2930521
"^DD",357.6,357.6,5.01,0)
EXIT ACTION^K^^5;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",357.6,357.6,5.01,3)
This is Standard MUMPS code.
"^DD",357.6,357.6,5.01,9)
@
"^DD",357.6,357.6,5.01,21,0)
^^3^3^2930528^
"^DD",357.6,357.6,5.01,21,1,0)
 
"^DD",357.6,357.6,5.01,21,2,0)
This code will be executed after the interface routine is called.
"^DD",357.6,357.6,5.01,21,3,0)
The effect of the NEW done on the PROTECTED VARIABLES is still in effect.
"^DD",357.6,357.6,5.01,"DT")
2930518
"^DD",357.6,357.6,6,0)
PROTECTED LOCAL VARIABLES^357.66^^6;0
"^DD",357.6,357.6,6,21,0)
^^11^11^2950719^^^
"^DD",357.6,357.6,6,21,1,0)
 
"^DD",357.6,357.6,6,21,2,0)
This is a list of variables that should be newed before the entry action
"^DD",357.6,357.6,6,21,3,0)
or calling the interface routine. It is protection against interfaces that
"^DD",357.6,357.6,6,21,4,0)
alter or kill variables, or entry actions that do so. Note that REQUIRED
"^DD",357.6,357.6,6,21,5,0)
VARIABLES should not also be PROTECTED VARIABLES. If an interface routine
"^DD",357.6,357.6,6,21,6,0)
changes a required variable, however, there is a way to protect it.
"^DD",357.6,357.6,6,21,7,0)
Supposing, for example, DFN is killed by the interface. This will protect
"^DD",357.6,357.6,6,21,8,0)
it:
"^DD",357.6,357.6,6,21,9,0)
     PROTECTED VARIABLE:   IBDFN
"^DD",357.6,357.6,6,21,10,0)
     ENTRY ACTION:  S IBDFN=DFN
"^DD",357.6,357.6,6,21,11,0)
     EXIT ACTION:   S DFN=IBDFN
"^DD",357.6,357.6,7,0)
REQUIRED LOCAL VARIABLES^357.67^^7;0
"^DD",357.6,357.6,7,21,0)
^^4^4^2930528^
"^DD",357.6,357.6,7,21,1,0)
 
"^DD",357.6,357.6,7,21,2,0)
The interface may require inputs. This field is a list of the required
"^DD",357.6,357.6,7,21,3,0)
local variables. The interface will not be called unless the variables are
"^DD",357.6,357.6,7,21,4,0)
determined to exist.
"^DD",357.6,357.6,9,0)
PCE DIM INPUT TRANSFORM^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",357.6,357.6,9,3)
The input transform should transform X to the value that should be passed.
"^DD",357.6,357.6,9,9)
@
"^DD",357.6,357.6,9,21,0)
^^3^3^2960401^^
"^DD",357.6,357.6,9,21,1,0)
Used to transform X, the identifier stored with the form object, to the
"^DD",357.6,357.6,9,21,2,0)
form that should be passed to the PCE Device Interface Module. It may, for
"^DD",357.6,357.6,9,21,3,0)
example, transform a code to an ien.
"^DD",357.6,357.6,9,"DT")
2960401
"^DD",357.6,357.6,10,0)
HELP TEXT^F^^10;1^K:$L(X)>245!($L(X)<1) X
"^DD",357.6,357.6,10,3)
This should provide some help to the user who is trying to enter a value associated with a bubble.
"^DD",357.6,357.6,10,21,0)
^^2^2^2950817^^^
"^DD",357.6,357.6,10,21,1,0)
This should provide some help to the user who is trying to enter a value
"^DD",357.6,357.6,10,21,2,0)
associated with a bubble.
"^DD",357.6,357.6,10,"DT")
2950522
"^DD",357.6,357.6,11,0)
VALIDATOR^K^^11;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",357.6,357.6,11,3)
This is Standard MUMPS code will kill X if X no longer identifies a valid code.
"^DD",357.6,357.6,11,9)
@
"^DD",357.6,357.6,11,21,0)
^^7^7^2981222^^
"^DD",357.6,357.6,11,21,1,0)
This field is used to validate codes currently on a form. The variable X
"^DD",357.6,357.6,11,21,2,0)
should be set to the identifier that was returned by the Package
"^DD",357.6,357.6,11,21,3,0)
Interface. For selection interfaces, the identifier is always piece 1 of
"^DD",357.6,357.6,11,21,4,0)
the 0 node of the entry in the selection list. Xecuting this field will
"^DD",357.6,357.6,11,21,5,0)
result in X being killed if the value is not valid. This is used by the
"^DD",357.6,357.6,11,21,6,0)
maintanance utility, for example, to find CPT codes that have been
"^DD",357.6,357.6,11,21,7,0)
inactivated.
"^DD",357.6,357.6,11,"DT")
2950908
"^DD",357.6,357.6,12.01,0)
PCE DIM NODE^F^^12;1^K:$L(X)>30!($L(X)<1) X
"^DD",357.6,357.6,12.01,3)
What node will be used to pass the data?
"^DD",357.6,357.6,12.01,21,0)
^^1^1^2951017^^
"^DD",357.6,357.6,12.01,21,1,0)
The node used to pass the data to PCE, using the PCE DEVICE INTERFACE MODULE.
"^DD",357.6,357.6,12.01,"DT")
2951017
"^DD",357.6,357.6,12.02,0)
PCE DIM PIECE, VALUE^NJ2,0^^12;2^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",357.6,357.6,12.02,3)
What piece should be used to pass the value?
"^DD",357.6,357.6,12.02,21,0)
^^1^1^2951017^^^
"^DD",357.6,357.6,12.02,21,1,0)
The piece in the PXCA node used to pass the input value.
"^DD",357.6,357.6,12.02,"DT")
2951017
"^DD",357.6,357.6,12.03,0)
PCE DIM PIECE, NARRATIVE^NJ2,0^^12;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",357.6,357.6,12.03,3)
What piece should be used to pass the text displayed on the form?
"^DD",357.6,357.6,12.03,21,0)
^^1^1^2950317^^^
"^DD",357.6,357.6,12.03,21,1,0)
The piece in the PCXA node used to pass the text displayed on the form.
"^DD",357.6,357.6,12.03,"DT")
2951017
"^DD",357.6,357.6,12.04,0)
PCE DIM PIECE, HEADER^NJ2,0^^12;4^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",357.6,357.6,12.04,3)
What piece should be used to pass the header displayed on the form?
"^DD",357.6,357.6,12.04,21,0)
^^2^2^2951017^
"^DD",357.6,357.6,12.04,21,1,0)
The piece on the node specified by the PCE DIM that the header is mapped
"^DD",357.6,357.6,12.04,21,2,0)
to.
"^DD",357.6,357.6,12.04,"DT")
2951017
"^DD",357.6,357.6,12.05,0)
PCE DIM PIECE, DATA QUALIFIER^NJ2,0^^12;5^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",357.6,357.6,12.05,3)
What piece should be used to pass the data qualifier?
"^DD",357.6,357.6,12.05,21,0)
^^1^1^2971028^^
"^DD",357.6,357.6,12.05,21,1,0)
The piece of the PXCA node where the data modifier belongs.
"^DD",357.6,357.6,12.05,"DT")
2951017
"^DD",357.6,357.6,12.06,0)
PCE DIM PIECE, QUANTITY^NJ2,0^^12;6^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",357.6,357.6,12.06,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",357.6,357.6,12.06,21,0)
^^2^2^2961031^^
"^DD",357.6,357.6,12.06,21,1,0)
An entry in this field indicates which piece of the array the quantity
"^DD",357.6,357.6,12.06,21,2,0)
should be passed on when sending data to PCE.
"^DD",357.6,357.6,12.06,"DT")
2961015
"^DD",357.6,357.6,13,0)
ALLOWABLE QUALIFIERS^357.613V^^13;0
"^DD",357.6,357.6,13,21,0)
^^2^2^2971028^^^
"^DD",357.6,357.6,13,21,1,0)
This mulitiple contains the list of qualifiers that may apply to the
"^DD",357.6,357.6,13,21,2,0)
data.
"^DD",357.6,357.6,14,0)
PCE DIM OUTPUT TRANSFORM^K^^14;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",357.6,357.6,14,3)
This should change Y, the value to be passed, to a value suitable for display.
"^DD",357.6,357.6,14,9)
@
"^DD",357.6,357.6,14,21,0)
^^3^3^2990302^^^
"^DD",357.6,357.6,14,21,1,0)
This transform should set Y, the value to be passed to the PCE 
"^DD",357.6,357.6,14,21,2,0)
Device Interface Module (DIM), to a value that is suitable for
"^DD",357.6,357.6,14,21,3,0)
display. It may, for example, change an ien to a code.
"^DD",357.6,357.6,14,"DT")
2960401
"^DD",357.6,357.6,15,0)
DATA DESCRIPTION^357.615I^^15;0
"^DD",357.6,357.6,15,21,0)
^^2^2^2950330^
"^DD",357.6,357.6,15,21,1,0)
For interfaces that return records, this multiple stores information on
"^DD",357.6,357.6,15,21,2,0)
the fields, other than the first field.
"^DD",357.6,357.6,16.1,0)
ALLOW INPUT OF NARRATIVE?^S^n:NO;o:OPTIONAL;r:REQUIRED;^16;1^Q
"^DD",357.6,357.6,16.1,3)
Should the user be allowed to enter a narrative? Answer n=NO, o=OPTIONAL, r=REQUIRED
"^DD",357.6,357.6,16.1,21,0)
^^2^2^2950915^
"^DD",357.6,357.6,16.1,21,1,0)
For selection interfaces, this field determines whether a narrative is
"^DD",357.6,357.6,16.1,21,2,0)
allowed by the PCE Generic Device Interface.
"^DD",357.6,357.6,16.1,"DT")
2950421
"^DD",357.6,357.6,16.2,0)
NARRATIVE DATA TYPE^P359.1'^IBE(359.1,^16;2^Q
"^DD",357.6,357.6,16.2,3)
What data type definition describes the narrative?
"^DD",357.6,357.6,16.2,21,0)
^^2^2^2950719^
"^DD",357.6,357.6,16.2,21,1,0)
This determines, among other things, how much space to allocate for the
"^DD",357.6,357.6,16.2,21,2,0)
narrative.
"^DD",357.6,357.6,16.2,"DT")
2950426
"^DD",357.6,357.6,16.3,0)
NARRATIVE HEADER^F^^16;3^K:$L(X)>40!($L(X)<1) X
"^DD",357.6,357.6,16.3,3)
Answer must be 1-40 characters in length.
"^DD",357.6,357.6,16.3,21,0)
^^1^1^2950825^
"^DD",357.6,357.6,16.3,21,1,0)
Used to label the narrative field.
"^DD",357.6,357.6,16.3,"DT")
2950815
"^DD",357.6,357.6,16.5,0)
ALLOW INPUT OF PRIMARY VALUE?^S^n:NO;o:OPTIONAL;r:REQUIRED;^16;5^Q
"^DD",357.6,357.6,16.5,3)
Should a code be entered? n=NO, o=OPTIONAL, r=REQUIRED
"^DD",357.6,357.6,16.5,21,0)
^^2^2^2950915^
"^DD",357.6,357.6,16.5,21,1,0)
For selectin interfaces this determines whether a value, other than a
"^DD",357.6,357.6,16.5,21,2,0)
narrative, can be entered.
"^DD",357.6,357.6,16.5,"DT")
2950426
"^DD",357.6,357.6,16.6,0)
PRIMARY VALUE DATA TYPE^P359.1'^IBE(359.1,^16;6^Q
"^DD",357.6,357.6,16.6,3)
What type of data is the primary value?
"^DD",357.6,357.6,16.6,21,0)
^^2^2^2950915^
"^DD",357.6,357.6,16.6,21,1,0)
For selection interfaces this determines, among other things, the data
"^DD",357.6,357.6,16.6,21,2,0)
type of the value to be entered.
"^DD",357.6,357.6,16.6,"DT")
2950426
"^DD",357.6,357.6,16.7,0)
PRIMARY VALUE HEADER^F^^16;7^K:$L(X)>40!($L(X)<1) X
"^DD",357.6,357.6,16.7,3)
Answer must be 1-40 characters in length.
"^DD",357.6,357.6,16.7,21,0)
^^1^1^2950815^
"^DD",357.6,357.6,16.7,21,1,0)
Used to label the primary value field.
"^DD",357.6,357.6,16.7,"DT")
2950815
"^DD",357.6,357.6,16.8,0)
ALLOW MULTIPLIERS^S^1:YES;^16;8^Q
"^DD",357.6,357.6,16.8,3)
Enter yes if this interface will allow entry of quantity at form development time.
"^DD",357.6,357.6,16.8,21,0)
^^3^3^2961031^^
"^DD",357.6,357.6,16.8,21,1,0)
For selection interfaces, this determines whether 'quantity' should be
"^DD",357.6,357.6,16.8,21,2,0)
asked at form development time to pass multiple occurrences of a selection
"^DD",357.6,357.6,16.8,21,3,0)
to PCE.
"^DD",357.6,357.6,16.8,"DT")
2961008
"^DD",357.6,357.6,16.9,0)
ALLOW INPUT OF MULTIPLE CODES?^S^1:YES;^16;9^Q
"^DD",357.6,357.6,16.9,3)
Enter a 1 for 'YES'.
"^DD",357.6,357.6,16.9,21,0)
^^4^4^2961216^^^^
"^DD",357.6,357.6,16.9,21,1,0)
Enter a one in this field if the users will be allowed to add more than
"^DD",357.6,357.6,16.9,21,2,0)
one code to pass along to PCE when one entry is bubbled.
"^DD",357.6,357.6,16.9,21,3,0)
Data in this field REQUIRES that field 17 be populated with mumps code
"^DD",357.6,357.6,16.9,21,4,0)
that will allow selection of the code if the entry is edited.
"^DD",357.6,357.6,16.9,"DT")
2961021
"^DD",357.6,357.6,17,0)
SELECTOR^K^^17;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",357.6,357.6,17,3)
Enter mumps code that will allow the form designer to add a choice to a multiple choice field.
"^DD",357.6,357.6,17,9)
@
"^DD",357.6,357.6,17,21,0)
^^9^9^2951208^^^
"^DD",357.6,357.6,17,21,1,0)
This field only applies to input interfaces. It is executed as by an input
"^DD",357.6,357.6,17,21,2,0)
transform when creating a multiple choice field. It should:
"^DD",357.6,357.6,17,21,3,0)
1) Kill X if an nothing is selected, otherwise set X to a value suitable
"^DD",357.6,357.6,17,21,4,0)
for display, perhaps the code.
"^DD",357.6,357.6,17,21,5,0)
2) Set IBLABEL to a suitable label for the choice.
"^DD",357.6,357.6,17,21,6,0)
3) Set IBID to an identifier. The identifier should ideally be exportable,
"^DD",357.6,357.6,17,21,7,0)
meaning the same from site to site. This usually means a coded value
"^DD",357.6,357.6,17,21,8,0)
rather than an ien. The identfier should match that of a corresponding
"^DD",357.6,357.6,17,21,9,0)
selection interface, if there is one.
"^DD",357.6,357.6,17,"DT")
2950908
"^DD",357.6,357.6,18,0)
MANUAL DATA ENTRY ROUTINE^K^^18;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",357.6,357.6,18,3)
Enter the code to be executed during manual data entry for this interface.  This is Standard MUMPS code.
"^DD",357.6,357.6,18,9)
@
"^DD",357.6,357.6,18,21,0)
^^10^10^2951208^
"^DD",357.6,357.6,18,21,1,0)
Enter the code to be executed to do manual data entry for this interface.
"^DD",357.6,357.6,18,21,2,0)
 
"^DD",357.6,357.6,18,21,3,0)
This field should only be completed for input package interfaces.  This
"^DD",357.6,357.6,18,21,4,0)
code will be executed to provide quick data entry for a user trying to
"^DD",357.6,357.6,18,21,5,0)
input data for a form.  It is expected that the output of this field will
"^DD",357.6,357.6,18,21,6,0)
be used to format the PXCA array prior to calling PCE to file the data
"^DD",357.6,357.6,18,21,7,0)
for the encounter.
"^DD",357.6,357.6,18,21,8,0)

"^DD",357.6,357.6,18,21,9,0)
Developers writing routines for this entry should provide a roll and scroll
"^DD",357.6,357.6,18,21,10,0)
interface for manaul entry of items only on the form.
"^DD",357.6,357.6,18,"DT")
2951208
"^DD",357.6,357.6,19,0)
EXTERNAL DISPLAY VALUES^K^^19;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",357.6,357.6,19,3)
This is Standard MUMPS code.
"^DD",357.6,357.6,19,9)
@
"^DD",357.6,357.6,19,21,0)
^^5^5^2960228^^^^
"^DD",357.6,357.6,19,21,1,0)
Executable code used to translate the internal value that is to
"^DD",357.6,357.6,19,21,2,0)
be passed to PCE into its external value for display purposes.  It
"^DD",357.6,357.6,19,21,3,0)
is used by the data validation routines to display the external
"^DD",357.6,357.6,19,21,4,0)
values and descriptions of what is to be passed, to the
"^DD",357.6,357.6,19,21,5,0)
user for verification.
"^DD",357.6,357.6,19,"DT")
2960214
"^DD",357.6,357.6,20,0)
PASS DQ AS VALUE^S^1:YES;^20;1^Q
"^DD",357.6,357.6,20,3)
Enter Yes if the Data Qualifier should be passed as the Value when sending data to PCE.
"^DD",357.6,357.6,20,21,0)
^^7^7^2961031^^
"^DD",357.6,357.6,20,21,1,0)
If the value of the Data Qualifier shall be passed to PCE as the VALUE,
"^DD",357.6,357.6,20,21,2,0)
this field should be set to one.  Doing so will prevent the data in the
"^DD",357.6,357.6,20,21,3,0)
VALUE from populating the PCE DIM NODE, but instead, will allow the Data
"^DD",357.6,357.6,20,21,4,0)
Qualifier to pass as the VALUE.
"^DD",357.6,357.6,20,21,5,0)
This is used mostly for YES/NO Data Qualifiers, where the value may
"^DD",357.6,357.6,20,21,6,0)
be a question, and the Data Qualifier Value, if bubbled, is the value
"^DD",357.6,357.6,20,21,7,0)
that must be placed on the PCE DIM NODE.
"^DD",357.6,357.6,20,"DT")
2961001
"^DD",357.6,357.6,21,0)
PCE DIM PIECE, VARIABLE VALUE^K^^21;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",357.6,357.6,21,3)
This is Standard MUMPS code.
"^DD",357.6,357.6,21,9)
@
"^DD",357.6,357.6,21,21,0)
^^7^7^2961031^^^
"^DD",357.6,357.6,21,21,1,0)
This field should be populated when the PCE DIM PIECE VALUE is not
"^DD",357.6,357.6,21,21,2,0)
constant.  If the value of that field is dependent upon specific conditions,
"^DD",357.6,357.6,21,21,3,0)
those conditions may be evaluated by placing the MUMPS code in this
"^DD",357.6,357.6,21,21,4,0)
field.  Ultimately, the code should return a value that will be used as
"^DD",357.6,357.6,21,21,5,0)
the PCE DIM PIECE VALUE.  If the return value is null, the original
"^DD",357.6,357.6,21,21,6,0)
PCE DIM PIECE VALUE field will be used to determine the piece location
"^DD",357.6,357.6,21,21,7,0)
to pass the VALUE on.
"^DD",357.6,357.6,21,"DT")
2961001
"^DD",357.6,357.61,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",357.6,357.61,0,"DT")
2921119
"^DD",357.6,357.61,0,"NM","DESCRIPTION")

"^DD",357.6,357.61,0,"UP")
357.6
"^DD",357.6,357.61,.01,0)
/6^W^^0;1^Q
"^DD",357.6,357.61,.01,3)
Enter a description of the data being exchanged.
"^DD",357.6,357.61,.01,21,0)
^^1^1^2950719^^
"^DD",357.6,357.61,.01,21,1,0)
This should describe the data being exchanged b the package interface.
"^DD",357.6,357.61,.01,"DT")
2930210
"^DD",357.6,357.613,0)
ALLOWABLE QUALIFIERS SUB-FIELD^^.08^6
"^DD",357.6,357.613,0,"DT")
2990304
"^DD",357.6,357.613,0,"IX","B",357.613,.01)

"^DD",357.6,357.613,0,"NM","ALLOWABLE QUALIFIERS")

"^DD",357.6,357.613,0,"UP")
357.6
"^DD",357.6,357.613,.01,0)
ALLOWABLE QUALIFIERS^MV^^0;1^Q
"^DD",357.6,357.613,.01,1,0)
^.1
"^DD",357.6,357.613,.01,1,1,0)
357.613^B
"^DD",357.6,357.613,.01,1,1,1)
S ^IBE(357.6,DA(1),13,"B",$E(X,1,30),DA)=""
"^DD",357.6,357.613,.01,1,1,2)
K ^IBE(357.6,DA(1),13,"B",$E(X,1,30),DA)
"^DD",357.6,357.613,.01,1,1,3)
Required Index for Variable Pointer
"^DD",357.6,357.613,.01,3)
Which qualifiers can apply to the data?
"^DD",357.6,357.613,.01,21,0)
^^1^1^2950814^^
"^DD",357.6,357.613,.01,21,1,0)
A qualifier that can be used by this package interface.
"^DD",357.6,357.613,.01,"DT")
2950426
"^DD",357.6,357.613,.01,"V",0)
^.12P^2^2
"^DD",357.6,357.613,.01,"V",1,0)
357.98^DATA QUALIFIER^1^Q^n^n
"^DD",357.6,357.613,.01,"V",2,0)
359.1^TYPE OF DATA^2^D^n^n
"^DD",357.6,357.613,.03,0)
INDEPENDENT MAPPING INFO?^RS^0:NO;1:YES;^0;3^Q
"^DD",357.6,357.613,.03,3)
YES means that fields on the form associated with this qualifier will have its own rules for entering the data to the database.
"^DD",357.6,357.613,.03,21,0)
^^1^1^2951017^
"^DD",357.6,357.613,.03,21,1,0)
YES means that data can be mapped into the PCE DIM based on the qualifier.
"^DD",357.6,357.613,.03,"DT")
2950426
"^DD",357.6,357.613,.04,0)
PCE DIM NODE^F^^0;4^K:$L(X)>30!($L(X)<1) X
"^DD",357.6,357.613,.04,3)
What node should the qualifier be placed on?
"^DD",357.6,357.613,.04,21,0)
^^1^1^2971028^^^
"^DD",357.6,357.613,.04,21,1,0)
The node where the data should be placed.
"^DD",357.6,357.613,.04,"DT")
2951017
"^DD",357.6,357.613,.05,0)
PCE DIM PIECE, VALUE^NJ2,0^^0;5^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",357.6,357.613,.05,3)
What piece should the primary value be located?
"^DD",357.6,357.613,.05,21,0)
^^1^1^2950719^
"^DD",357.6,357.613,.05,21,1,0)
The piece on the node where the value should be placed.
"^DD",357.6,357.613,.05,"DT")
2951017
"^DD",357.6,357.613,.07,0)
PCE DIM PIECE, HEADER^NJ2,0^^0;7^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",357.6,357.613,.07,3)
What piece should the header be located on?
"^DD",357.6,357.613,.07,21,0)
^^1^1^2951017^^
"^DD",357.6,357.613,.07,21,1,0)
The piece on the node where the associated header should be placed.
"^DD",357.6,357.613,.07,"DT")
2951017
"^DD",357.6,357.613,.08,0)
PCE DIM PIECE, QUALIFIER^NJ2,0^^0;8^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",357.6,357.613,.08,3)
What piece should the qualifier be located on?
"^DD",357.6,357.613,.08,21,0)
^^1^1^2971028^^
"^DD",357.6,357.613,.08,21,1,0)
The piece where the qualifier should go.
"^DD",357.6,357.613,.08,"DT")
2951017
"^DD",357.6,357.615,0)
DATA DESCRIPTION SUB-FIELD^^.05^5
"^DD",357.6,357.615,0,"DT")
2950417
"^DD",357.6,357.615,0,"ID","WRITE")
D EN^DDIOL("   PIECE="_$P(^(0),U,3),"","?0")
"^DD",357.6,357.615,0,"IX","B",357.615,.01)

"^DD",357.6,357.615,0,"IX","C",357.615,.03)

"^DD",357.6,357.615,0,"NM","DATA DESCRIPTION")

"^DD",357.6,357.615,0,"UP")
357.6
"^DD",357.6,357.615,.01,0)
DATA^MF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",357.6,357.615,.01,1,0)
^.1
"^DD",357.6,357.615,.01,1,1,0)
357.615^B
"^DD",357.6,357.615,.01,1,1,1)
S ^IBE(357.6,DA(1),15,"B",$E(X,1,30),DA)=""
"^DD",357.6,357.615,.01,1,1,2)
K ^IBE(357.6,DA(1),15,"B",$E(X,1,30),DA)
"^DD",357.6,357.615,.01,3)
Enter a descriptive name for this data field, up to 30 characters.
"^DD",357.6,357.615,.01,21,0)
^^1^1^2960730^^
"^DD",357.6,357.615,.01,21,1,0)
A descriptive name for the data.
"^DD",357.6,357.615,.01,"DT")
2950320
"^DD",357.6,357.615,.02,0)
MAXIMUM LENGTH^RNJ3,0^^0;2^K:+X'=X!(X>210)!(X<1)!(X?.E1"."1N.N) X
"^DD",357.6,357.615,.02,3)
What is the maximum length of this field?
"^DD",357.6,357.615,.02,21,0)
^^1^1^2950719^
"^DD",357.6,357.615,.02,21,1,0)
The maximum length of the data.
"^DD",357.6,357.615,.02,"DT")
2950320
"^DD",357.6,357.615,.03,0)
PIECE^NJ1,0X^^0;3^K:+X'=X!(X>8)!(X<2)!(X?.E1"."1N.N)!($D(^IBE(357.6,D0,15,"C",X))) X
"^DD",357.6,357.615,.03,1,0)
^.1
"^DD",357.6,357.615,.03,1,1,0)
357.615^C
"^DD",357.6,357.615,.03,1,1,1)
S ^IBE(357.6,DA(1),15,"C",$E(X,1,30),DA)=""
"^DD",357.6,357.615,.03,1,1,2)
K ^IBE(357.6,DA(1),15,"C",$E(X,1,30),DA)
"^DD",357.6,357.615,.03,1,1,"%D",0)
^^1^1^2950320^
"^DD",357.6,357.615,.03,1,1,"%D",1,0)
Indexes the field by piece.
"^DD",357.6,357.615,.03,1,1,"DT")
2950320
"^DD",357.6,357.615,.03,3)
In the returned record, which piece will this field be?
"^DD",357.6,357.615,.03,21,0)
^^2^2^2950918^^
"^DD",357.6,357.615,.03,21,1,0)
The piece that the data will be returned as. Doesn't allow
"^DD",357.6,357.615,.03,21,2,0)
piece 1 because that is stored in field #2.01.
"^DD",357.6,357.615,.03,"DT")
2950407
"^DD",357.6,357.615,.04,0)
ANNEX NODE^F^^0;4^K:$L(X)>10!($L(X)<1) X
"^DD",357.6,357.615,.04,3)
You can optionally specify the subscript to store the data. Use this when the entire record won't fit on one node.
"^DD",357.6,357.615,.04,21,0)
^^2^2^2950719^
"^DD",357.6,357.615,.04,21,1,0)
In case all the returned data can not be returned on a single node an
"^DD",357.6,357.615,.04,21,2,0)
annex node can be specified.
"^DD",357.6,357.615,.04,"DT")
2950320
"^DD",357.6,357.615,.05,0)
RECOMMENDED HEADER^F^^0;5^K:$L(X)>40!($L(X)<1) X
"^DD",357.6,357.615,.05,3)
Answer must be 1-40 characters in length.
"^DD",357.6,357.615,.05,21,0)
^^1^1^2950719^^
"^DD",357.6,357.615,.05,21,1,0)
The recommended header will be used as the default when designing a form.
"^DD",357.6,357.615,.05,"DT")
2950417
"^DD",357.6,357.66,0)
PROTECTED LOCAL VARIABLES SUB-FIELD^^.01^1
"^DD",357.6,357.66,0,"DT")
2930608
"^DD",357.6,357.66,0,"IX","B",357.66,.01)

"^DD",357.6,357.66,0,"NM","PROTECTED LOCAL VARIABLES")

"^DD",357.6,357.66,0,"UP")
357.6
"^DD",357.6,357.66,.01,0)
PROTECTED LOCAL VARIABLES^MFX^^0;1^K:'$$VARIABLE^IBDFU5(X) X
"^DD",357.6,357.66,.01,1,0)
^.1
"^DD",357.6,357.66,.01,1,1,0)
357.66^B
"^DD",357.6,357.66,.01,1,1,1)
S ^IBE(357.6,DA(1),6,"B",$E(X,1,30),DA)=""
"^DD",357.6,357.66,.01,1,1,2)
K ^IBE(357.6,DA(1),6,"B",$E(X,1,30),DA)
"^DD",357.6,357.66,.01,3)
Enter variables that should be NEWED before the entry action or calling the interface.
"^DD",357.6,357.66,.01,21,0)
^^3^3^2950426^^
"^DD",357.6,357.66,.01,21,1,0)
 
"^DD",357.6,357.66,.01,21,2,0)
A list of variables that should be newed before the entry action or
"^DD",357.6,357.66,.01,21,3,0)
calling the interface.
"^DD",357.6,357.66,.01,"DT")
2930608
"^DD",357.6,357.67,0)
REQUIRED LOCAL VARIABLES SUB-FIELD^^.01^1
"^DD",357.6,357.67,0,"DT")
2930521
"^DD",357.6,357.67,0,"IX","B",357.67,.01)

"^DD",357.6,357.67,0,"NM","REQUIRED LOCAL VARIABLES")

"^DD",357.6,357.67,0,"UP")
357.6
"^DD",357.6,357.67,.01,0)
REQUIRED LOCAL VARIABLE^MFX^^0;1^K:'$$VARIABLE^IBDFU5(X) X
"^DD",357.6,357.67,.01,1,0)
^.1
"^DD",357.6,357.67,.01,1,1,0)
357.67^B
"^DD",357.6,357.67,.01,1,1,1)
S ^IBE(357.6,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",357.6,357.67,.01,1,1,2)
K ^IBE(357.6,DA(1),7,"B",$E(X,1,30),DA)
"^DD",357.6,357.67,.01,3)
Enter any variables that must exist before the Package Interface routine is called.
"^DD",357.6,357.67,.01,21,0)
^^4^4^2930528^
"^DD",357.6,357.67,.01,21,1,0)
 
"^DD",357.6,357.67,.01,21,2,0)
A variable that is required input to the interface routine. The interface
"^DD",357.6,357.67,.01,21,3,0)
routine will not be called if all of the required variables are not
"^DD",357.6,357.67,.01,21,4,0)
defined.
"^DD",357.6,357.67,.01,"DT")
2930521
"^DD",357.91,357.91,0)
FIELD^^.04^4
"^DD",357.91,357.91,0,"DDA")
N
"^DD",357.91,357.91,0,"DT")
2940607
"^DD",357.91,357.91,0,"IX","B",357.91,.01)

"^DD",357.91,357.91,0,"NM","MARKING AREA TYPE")

"^DD",357.91,357.91,0,"PT",357.22,.06)

"^DD",357.91,357.91,0,"VRPK")
AUTOMATED INFO COLLECTION SYS
"^DD",357.91,357.91,.01,0)
NAME^RFX^^0;1^K:$L(X)>30 X
"^DD",357.91,357.91,.01,1,0)
^.1
"^DD",357.91,357.91,.01,1,1,0)
357.91^B
"^DD",357.91,357.91,.01,1,1,1)
S ^IBE(357.91,"B",$E(X,1,30),DA)=""
"^DD",357.91,357.91,.01,1,1,2)
K ^IBE(357.91,"B",$E(X,1,30),DA)
"^DD",357.91,357.91,.01,3)
NAME MUST BE UNDER 31 CHARACTERS
"^DD",357.91,357.91,.01,21,0)
^^1^1^2930608^
"^DD",357.91,357.91,.01,21,1,0)
The name should describe the appearance of the marking area on the form.
"^DD",357.91,357.91,.02,0)
DISPLAY STRING^F^^0;2^K:$L(X)>20!($L(X)<1) X
"^DD",357.91,357.91,.02,3)
Answer must be 1-20 characters in length.
"^DD",357.91,357.91,.02,21,0)
^^2^2^2930528^
"^DD",357.91,357.91,.02,21,1,0)
 
"^DD",357.91,357.91,.02,21,2,0)
The text that should be displayed in the MARKING AREA.
"^DD",357.91,357.91,.02,"DT")
2921207
"^DD",357.91,357.91,.03,0)
TOOL KIT MEMBER?^S^0:NO;1:YES;^0;3^Q
"^DD",357.91,357.91,.03,3)
Enter YES if the MARKING AREA is part of the tool kit, NO otherwise.
"^DD",357.91,357.91,.03,21,0)
^^2^2^2930811^
"^DD",357.91,357.91,.03,21,1,0)
Used to prevent local sites from editing MARKING AREAS that are part of the
"^DD",357.91,357.91,.03,21,2,0)
tool kit.
"^DD",357.91,357.91,.03,"DT")
2930811
"^DD",357.91,357.91,.04,0)
REQUIRES SPECIAL PROCEDURE?^S^0:NO;1:YES;^0;4^Q
"^DD",357.91,357.91,.04,3)
Answer NO if the Marking Area is just text, YES if it requires a special procedure to print.
"^DD",357.91,357.91,.04,21,0)
^^2^2^2940628^^
"^DD",357.91,357.91,.04,21,1,0)
NO means that the Marking Area is just text that can be printed. YES means
"^DD",357.91,357.91,.04,21,2,0)
that a special procedure must be called to print the Marking Area.
"^DD",357.91,357.91,.04,"DT")
2940628
"^DD",357.95,357.951,.14,0)
SELECTION^P357.3'^IBE(357.3,^0;14^Q
"^DD",357.95,357.951,.14,3)
Pointer to Selection File is to be set via AICS Form compilation.
"^DD",357.95,357.951,.14,21,0)
^^1^1^3000124^^^
"^DD",357.95,357.951,.14,21,1,0)
Pointer to Selection File is to be set via AICS Form compilation.
"^DD",357.95,357.951,.14,"DT")
2990601
"^DD",358.1,358.1,0)
FIELD^^1^12
"^DD",358.1,358.1,0,"DT")
2930806
"^DD",358.1,358.1,0,"ID",.02)
W ""
"^DD",358.1,358.1,0,"IX","B",358.1,.01)

"^DD",358.1,358.1,0,"IX","C",358.1,.02)

"^DD",358.1,358.1,0,"IX","D",358.1,.14)

"^DD",358.1,358.1,0,"NM","IMP/EXP ENCOUNTER FORM BLOCK")

"^DD",358.1,358.1,0,"PT",358.2,.02)

"^DD",358.1,358.1,0,"PT",358.5,.02)

"^DD",358.1,358.1,0,"PT",358.7,.06)

"^DD",358.1,358.1,0,"PT",358.8,.02)

"^DD",358.1,358.1,0,"PT",358.93,.08)

"^DD",358.1,358.1,0,"VRPK")
AUTOMATED INFO COLLECTION SYS
"^DD",358.1,358.1,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",358.1,358.1,.01,1,0)
^.1
"^DD",358.1,358.1,.01,1,1,0)
358.1^B
"^DD",358.1,358.1,.01,1,1,1)
S ^IBE(358.1,"B",$E(X,1,30),DA)=""
"^DD",358.1,358.1,.01,1,1,2)
K ^IBE(358.1,"B",$E(X,1,30),DA)
"^DD",358.1,358.1,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",358.1,358.1,.01,21,0)
^^2^2^2930527^
"^DD",358.1,358.1,.01,21,1,0)
 
"^DD",358.1,358.1,.01,21,2,0)
The name of the block.
"^DD",358.1,358.1,.01,"DEL",1,0)
I '$G(IBLISTPR) W "...Encounter Form Blocks can only be deleted through the Encounter Form Utilities!"
"^DD",358.1,358.1,.02,0)
FORM^RP358'^IBE(358,^0;2^Q
"^DD",358.1,358.1,.02,1,0)
^.1
"^DD",358.1,358.1,.02,1,1,0)
358.1^C
"^DD",358.1,358.1,.02,1,1,1)
S ^IBE(358.1,"C",$E(X,1,30),DA)=""
"^DD",358.1,358.1,.02,1,1,2)
K ^IBE(358.1,"C",$E(X,1,30),DA)
"^DD",358.1,358.1,.02,1,1,"%D",0)
^^1^1^2921116^
"^DD",358.1,358.1,.02,1,1,"%D",1,0)
Used to find all the blocks belonging to a particular form.
"^DD",358.1,358.1,.02,1,1,"DT")
2921116
"^DD",358.1,358.1,.02,3)
What form should this block appear on?
"^DD",358.1,358.1,.02,21,0)
^^2^2^2930802^^
"^DD",358.1,358.1,.02,21,1,0)
 
"^DD",358.1,358.1,.02,21,2,0)
The form the block appears on.
"^DD",358.1,358.1,.02,"DT")
2930802
"^DD",358.1,358.1,.04,0)
BLOCK'S STARTING ROW^RNJ3,0XO^^0;4^S:+X=X X=X-1 K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",358.1,358.1,.04,.1)
WHAT ROW SHOULD THE BLOCK START IN?
"^DD",358.1,358.1,.04,2)
S Y(0)=Y S Y=(+Y)+1
"^DD",358.1,358.1,.04,2.1)
S Y=(+Y)+1
"^DD",358.1,358.1,.04,3)
What line should this block begin on?
"^DD",358.1,358.1,.04,21,0)
^^1^1^2930715^^^
"^DD",358.1,358.1,.04,21,1,0)
The row  on the encounter form that the block starts on.
"^DD",358.1,358.1,.04,23,0)
^^4^4^2930715^
"^DD",358.1,358.1,.04,23,1,0)
The internal representation starts at 0, the external representation
"^DD",358.1,358.1,.04,23,2,0)
starts at 1. The difference is because for computing the form image
"^DD",358.1,358.1,.04,23,3,0)
it is convenient to work with displacements fromt the top left-hand
"^DD",358.1,358.1,.04,23,4,0)
corner. However, users do not want to work with row=0 or column=0.
"^DD",358.1,358.1,.04,"DT")
2930715
"^DD",358.1,358.1,.05,0)
BLOCK'S STARTING COLUMN^RNJ3,0XO^^0;5^S:+X=X X=X-1 K:+X'=X!(X>200)!(X<0)!(X?.E1"."1N.N) X
"^DD",358.1,358.1,.05,.1)
WHAT COLUMN SHOULD THE BLOCK START IN?
"^DD",358.1,358.1,.05,2)
S Y(0)=Y S Y=(+Y)+1
"^DD",358.1,358.1,.05,2.1)
S Y=(+Y)+1
"^DD",358.1,358.1,.05,3)
What column should this block begin on?
"^DD",358.1,358.1,.05,21,0)
^^1^1^2930715^^
"^DD",358.1,358.1,.05,21,1,0)
The column on the encounter form that the block starts on.
"^DD",358.1,358.1,.05,23,0)
^^4^4^2930715^
"^DD",358.1,358.1,.05,23,1,0)
The internal representation starts at 0, the external representation
"^DD",358.1,358.1,.05,23,2,0)
starts at 1. The difference is because for computing the form image
"^DD",358.1,358.1,.05,23,3,0)
it is convenient to work with displacements from the top left-hand
"^DD",358.1,358.1,.05,23,4,0)
corner. However, users do not want to work with row=0 or column=0.
"^DD",358.1,358.1,.05,"DT")
2930715
"^DD",358.1,358.1,.06,0)
WIDTH IN CHARACTERS^RNJ3,0^^0;6^K:+X'=X!(X>200)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.1,358.1,.06,.1)
HOW MANY CHARACTERS WIDE SHOULD THE BLOCK BE?
"^DD",358.1,358.1,.06,3)
How many characters wide should this block be?
"^DD",358.1,358.1,.06,21,0)
^^2^2^2930527^
"^DD",358.1,358.1,.06,21,1,0)
 
"^DD",358.1,358.1,.06,21,2,0)
The width of the block, measured in the number of characters across.
"^DD",358.1,358.1,.06,"DT")
2930415
"^DD",358.1,358.1,.07,0)
HEIGHT IN LINES^RNJ3,0^^0;7^K:+X'=X!(X>200)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.1,358.1,.07,.1)
HOW MANY LINES HIGH SHOULD THE BLOCK BE?
"^DD",358.1,358.1,.07,3)
How many lines high should this block be?
"^DD",358.1,358.1,.07,21,0)
^^2^2^2930527^
"^DD",358.1,358.1,.07,21,1,0)
 
"^DD",358.1,358.1,.07,21,2,0)
The height of the block, measured by the number of lines it takes up.
"^DD",358.1,358.1,.07,"DT")
2930415
"^DD",358.1,358.1,.1,0)
OUTLINE TYPE^RS^1:SOLID LINE;2:INVISIBLE;^0;10^Q
"^DD",358.1,358.1,.1,.1)
OUTLINE TYPE (SOLID/INVISIBLE)
"^DD",358.1,358.1,.1,3)
Enter '1' if the block should have a box around it, '2' if not.
"^DD",358.1,358.1,.1,21,0)
^^2^2^2930527^
"^DD",358.1,358.1,.1,21,1,0)
 
"^DD",358.1,358.1,.1,21,2,0)
How the block is outlined on the form.
"^DD",358.1,358.1,.1,"DT")
2930415
"^DD",358.1,358.1,.11,0)
BLOCK HEADER^F^^0;11^K:$L(X)>60!($L(X)<1) X
"^DD",358.1,358.1,.11,.1)
WHAT HEADER WOULD SHOULD APPEAR AT THE TOP OF THE BLOCK? (OPTIONAL)
"^DD",358.1,358.1,.11,3)
What text should appear at the top of the block?
"^DD",358.1,358.1,.11,21,0)
^^2^2^2930527^
"^DD",358.1,358.1,.11,21,1,0)
 
"^DD",358.1,358.1,.11,21,2,0)
The text appearing at the top of the block.
"^DD",358.1,358.1,.11,"DT")
2930415
"^DD",358.1,358.1,.12,0)
HEADER APPEARANCE^FX^^0;12^S X=$$UPPER^VALM1(X) K:$L(X)>3!("UBC"'[$E(X,1))!("UBC"'[$E(X,2))!("UBC"'[$E(X,3)) X
"^DD",358.1,358.1,.12,.1)
HOW SHOULD THE BLOCK HEADER APPEAR? CHOOSE FROM {U,B,C}
"^DD",358.1,358.1,.12,3)
B=bold, U=underline, C=center. You can enter any combination of {B,U,C}.
"^DD",358.1,358.1,.12,21,0)
^^2^2^2930607^
"^DD",358.1,358.1,.12,21,1,0)
 
"^DD",358.1,358.1,.12,21,2,0)
A description of the block's contents and use.
"^DD",358.1,358.1,.12,"DT")
2930616
"^DD",358.1,358.1,.13,0)
BRIEF DESCRIPTION^RF^^0;13^K:$L(X)>80!($L(X)<1) X
"^DD",358.1,358.1,.13,.1)
ENTER A BRIEF DESCRIPTION OF THE USE & CONTENTS OF THE BLOCK
"^DD",358.1,358.1,.13,3)
Answer must be 1-80 characters in length.
"^DD",358.1,358.1,.13,21,0)
^^2^2^2930607^
"^DD",358.1,358.1,.13,21,1,0)
 
"^DD",358.1,358.1,.13,21,2,0)
A brief description of the contents or use of the block.
"^DD",358.1,358.1,.13,"DT")
2930415
"^DD",358.1,358.1,.14,0)
TOOL KIT ORDER^NJ6,2^^0;14^K:+X'=X!(X>999.99)!(X<0)!(X?.E1"."3N.N) X
"^DD",358.1,358.1,.14,1,0)
^.1
"^DD",358.1,358.1,.14,1,1,0)
358.1^D
"^DD",358.1,358.1,.14,1,1,1)
S ^IBE(358.1,"D",$E(X,1,30),DA)=""
"^DD",358.1,358.1,.14,1,1,2)
K ^IBE(358.1,"D",$E(X,1,30),DA)
"^DD",358.1,358.1,.14,1,1,"%D",0)
^^2^2^2930108^
"^DD",358.1,358.1,.14,1,1,"%D",1,0)
This index is used to locate all the 'tool box' blocs that can be used 
"^DD",358.1,358.1,.14,1,1,"%D",2,0)
as templates to create a new block to be added to a form.
"^DD",358.1,358.1,.14,1,1,"DT")
2930108
"^DD",358.1,358.1,.14,3)
Enter a numeric value >0 if this block is part of the tool kit. The number will determine its listed order.
"^DD",358.1,358.1,.14,21,0)
^^4^4^2930607^
"^DD",358.1,358.1,.14,21,1,0)
 
"^DD",358.1,358.1,.14,21,2,0)
A value greater than 0 means that the block belongs to the tool kit. The
"^DD",358.1,358.1,.14,21,3,0)
value also determines the order that the block will be listed to the
"^DD",358.1,358.1,.14,21,4,0)
screen that displays the tool kit blocks.
"^DD",358.1,358.1,.14,"DT")
2930309
"^DD",358.1,358.1,1,0)
EXPORT NOTES^358.11^^1;0
"^DD",358.1,358.1,1,21,0)
^^2^2^2930806^
"^DD",358.1,358.1,1,21,1,0)
Should be give other sites information that will enable them to decide
"^DD",358.1,358.1,1,21,2,0)
whether or not they want to import the block. Only applies to tool kit blocks.
"^DD",358.1,358.11,0)
EXPORT NOTES SUB-FIELD^^.01^1
"^DD",358.1,358.11,0,"DT")
2930806
"^DD",358.1,358.11,0,"NM","EXPORT NOTES")

"^DD",358.1,358.11,0,"UP")
358.1
"^DD",358.1,358.11,.01,0)
EXPORT NOTES^W^^0;1^Q
"^DD",358.1,358.11,.01,3)
What should other sites know about this tool kit block before importing it?
"^DD",358.1,358.11,.01,"DT")
2930806
"^DD",358.2,358.2,0)
FIELD^^2^19
"^DD",358.2,358.2,0,"DDA")
N
"^DD",358.2,358.2,0,"DT")
2960123
"^DD",358.2,358.2,0,"ID",.02)
W ""
"^DD",358.2,358.2,0,"ID",.11)
W ""
"^DD",358.2,358.2,0,"IX","B",358.2,.01)

"^DD",358.2,358.2,0,"IX","C",358.2,.02)

"^DD",358.2,358.2,0,"NM","IMP/EXP SELECTION LIST")

"^DD",358.2,358.2,0,"PT",358.3,.03)

"^DD",358.2,358.2,0,"PT",358.4,.03)

"^DD",358.2,358.2,0,"VRPK")
AUTOMATED INFO COLLECTION SYS
"^DD",358.2,358.2,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",358.2,358.2,.01,1,0)
^.1
"^DD",358.2,358.2,.01,1,1,0)
358.2^B
"^DD",358.2,358.2,.01,1,1,1)
S ^IBE(358.2,"B",$E(X,1,30),DA)=""
"^DD",358.2,358.2,.01,1,1,2)
K ^IBE(358.2,"B",$E(X,1,30),DA)
"^DD",358.2,358.2,.01,3)
Answer must be 3-30 characters in length.
"^DD",358.2,358.2,.01,21,0)
^^2^2^2930527^
"^DD",358.2,358.2,.01,21,1,0)
 
"^DD",358.2,358.2,.01,21,2,0)
The name of the list.
"^DD",358.2,358.2,.01,"DEL",1,0)
I '$G(IBLISTPR) W "...Selection Lists can only be deleted through the Encounter Form Utilities!"
"^DD",358.2,358.2,.01,"DT")
2921119
"^DD",358.2,358.2,.02,0)
BLOCK^RP358.1'^IBE(358.1,^0;2^Q
"^DD",358.2,358.2,.02,1,0)
^.1
"^DD",358.2,358.2,.02,1,1,0)
358.2^C
"^DD",358.2,358.2,.02,1,1,1)
S ^IBE(358.2,"C",$E(X,1,30),DA)=""
"^DD",358.2,358.2,.02,1,1,2)
K ^IBE(358.2,"C",$E(X,1,30),DA)
"^DD",358.2,358.2,.02,1,1,"DT")
2921207
"^DD",358.2,358.2,.02,3)
Enter the block that the selection list should appear in.
"^DD",358.2,358.2,.02,21,0)
^^2^2^2930527^
"^DD",358.2,358.2,.02,21,1,0)
The block that the list appears on. The position of the selection list is
"^DD",358.2,358.2,.02,21,2,0)
relative to the block.
"^DD",358.2,358.2,.02,"DT")
2921207
"^DD",358.2,358.2,.04,0)
SUBCOLUMN HEADER APPEARANCE^FX^^0;4^S X=$$UPPER^VALM1(X) K:$L(X)>1!("R"'[$E(X,1)) X
"^DD",358.2,358.2,.04,.1)
HOW SHOULD THE SUBCOLUMN HEADERS APPEAR? ENTER 'R' FOR REVERSE PRINTING.
"^DD",358.2,358.2,.04,3)
R=Reverse Printing
"^DD",358.2,358.2,.04,"DT")
2940531
"^DD",358.2,358.2,.05,0)
COLUMN HEADER^F^^0;5^K:$L(X)>70!($L(X)<1) X
"^DD",358.2,358.2,.05,.1)
WHAT TEXT SHOULD APPEAR AT THE TOP OF EACH COLUMN? (OPTIONAL)
"^DD",358.2,358.2,.05,3)
This header will appear at the top of the column that contains the list. If there is more than one column it will appear at the top of each.
"^DD",358.2,358.2,.05,21,0)
^^2^2^2930527^
"^DD",358.2,358.2,.05,21,1,0)
 
"^DD",358.2,358.2,.05,21,2,0)
The text that appears at the top of each column (NOT subcolumn).
"^DD",358.2,358.2,.05,"DT")
2930415
"^DD",358.2,358.2,.06,0)
COLUMN HEADER APPEARANCE^FX^^0;6^S X=$$UPPER^VALM1(X) K:$L(X)>4!("UBRC"'[$E(X,1))!("UBRC"'[$E(X,2))!("UBRC"'[$E(X,3))!("UBRC"'[$E(X,4)) X
"^DD",358.2,358.2,.06,.1)
HOW SHOULD THE COLUMN HEADER APPEAR? CHOOSE FROM {U,B,R,C}
"^DD",358.2,358.2,.06,3)
B=bold,U=underline,R=reverse,C=center. You can enter any combination of {B,U,R,C}.
"^DD",358.2,358.2,.06,21,0)
^^2^2^2940531^^^
"^DD",358.2,358.2,.06,21,1,0)
 
"^DD",358.2,358.2,.06,21,2,0)
The column header can be give characteristics, such as centered and bold.
"^DD",358.2,358.2,.06,"DT")
2940531
"^DD",358.2,358.2,.07,0)
SUBCOLUMNS SEPARATED WITH?^RS^1:ONE SPACE;2:TWO SPACES;3:LINE;4:SPACE/LINE/SPACE;^0;7^Q
"^DD",358.2,358.2,.07,.1)
HOW SHOULD THE SUBCOLUMNS BE SEPARATED?
"^DD",358.2,358.2,.07,3)
How should the subcolumns be separated?
"^DD",358.2,358.2,.07,21,0)
^^2^2^2930527^
"^DD",358.2,358.2,.07,21,1,0)
 
"^DD",358.2,358.2,.07,21,2,0)
What characters are used to separate the subcolumns.
"^DD",358.2,358.2,.07,"DT")
2930415
"^DD",358.2,358.2,.08,0)
EXTRA LINES FOR SELECTIONS^NJ1,0^^0;8^K:+X'=X!(X>9)!(X<0)!(X?.E1"."1N.N) X
"^DD",358.2,358.2,.08,.1)
NUMBER OF ADDITIONAL LINES FOR EACH ENTRY ON LIST?
"^DD",358.2,358.2,.08,3)
How many extra lines should be allocated for each selection, in addition to the 1 the selection will print on?
"^DD",358.2,358.2,.08,21,0)
^^4^4^2930527^
"^DD",358.2,358.2,.08,21,1,0)
 
"^DD",358.2,358.2,.08,21,2,0)
Each entry on the list prints on only one line. However, if you want
"^DD",358.2,358.2,.08,21,3,0)
extra space to appear below each entry on the list then this field should
"^DD",358.2,358.2,.08,21,4,0)
be set to the number of blank lines desired.
"^DD",358.2,358.2,.08,"DT")
2930427
"^DD",358.2,358.2,.09,0)
GROUP HEADER APPEARANCE^FX^^0;9^S X=$$UPPER^VALM1(X) K:$L(X)>4!("UBRC"'[$E(X,1))!("UBRC"'[$E(X,2))!("UBRC"'[$E(X,3))!("UBRC"'[$E(X,4)) X
"^DD",358.2,358.2,.09,.1)
HOW SHOULD THE HEADER FOR EACH GROUP OF ENTRIES APPEAR? CHOOSE FROM {U,B,R,C}
"^DD",358.2,358.2,.09,3)
B=bold,R=reverse,C=center,U=underline. You can use any combination of {B,R,C,U}
"^DD",358.2,358.2,.09,21,0)
^^1^1^2940527^^^^
"^DD",358.2,358.2,.09,21,1,0)
This field determines the appearance of the group headers.
"^DD",358.2,358.2,.09,"DT")
2940527
"^DD",358.2,358.2,.11,0)
SELECTION ROUTINE^R*P358.6'^IBE(358.6,^0;11^S DIC("S")="I $P(^(0),U,6)=3,$P(^(0),U,9)=1" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",358.2,358.2,.11,3)
Enter the package interface used to obtain this list.
"^DD",358.2,358.2,.11,12)
Allows only available selection routines.
"^DD",358.2,358.2,.11,12.1)
S DIC("S")="I $P(^(0),U,6)=3,$P(^(0),U,9)=1"
"^DD",358.2,358.2,.11,21,0)
^^2^2^2930527^
"^DD",358.2,358.2,.11,21,1,0)
 
"^DD",358.2,358.2,.11,21,2,0)
This identifies the Package Interface that is used to fill the list.
"^DD",358.2,358.2,.11,"DT")
2930115
"^DD",358.2,358.2,.12,0)
UNDERLINE SELECTIONS?^RS^0:NO;1:YES;^0;12^Q
"^DD",358.2,358.2,.12,.1)
SHOULD EACH ENTRY ON THE LIST BE UNDERLINED? (YES/NO)
"^DD",358.2,358.2,.12,3)
Should the items on the list be underlined?
"^DD",358.2,358.2,.12,21,0)
^^2^2^2930527^
"^DD",358.2,358.2,.12,21,1,0)
 
"^DD",358.2,358.2,.12,21,2,0)
Answer yes if each entry on the list should be underlined.
"^DD",358.2,358.2,.12,"DT")
2930414
"^DD",358.2,358.2,.13,0)
NUMBER OF COLUMNS^NJ2,0^^0;13^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.2,358.2,.13,.1)
HOW MANY COLUMNS OF LIST ENTRIES SHOULD THE LIST HAVE? (OPTIONAL)
"^DD",358.2,358.2,.13,3)

"^DD",358.2,358.2,.13,4)
D HELP5^IBDFU5
"^DD",358.2,358.2,.13,21,0)
^^6^6^2930527^
"^DD",358.2,358.2,.13,21,1,0)
 
"^DD",358.2,358.2,.13,21,2,0)
A selection list may be displayed in an area several columns wide. The
"^DD",358.2,358.2,.13,21,3,0)
starting position and height of each column may be specified. However, it
"^DD",358.2,358.2,.13,21,4,0)
is not necessary because defaults values will be used. The defaults used
"^DD",358.2,358.2,.13,21,5,0)
assume that nothing else is going in the block except the selection list
"^DD",358.2,358.2,.13,21,6,0)
and that the entire block should be filled.
"^DD",358.2,358.2,.13,"DT")
2930802
"^DD",358.2,358.2,.14,0)
DYNAMIC SELECTIONS^S^0:NO;1:YES;^0;14^Q
"^DD",358.2,358.2,.14,3)
Answer YES if the list of selecitons are created at print time.
"^DD",358.2,358.2,.14,"DT")
2950717
"^DD",358.2,358.2,.15,0)
PRINT COMPLETE^S^0:NO;1:YES;^0;15^Q
"^DD",358.2,358.2,.15,3)
If the data on the list won't fit on the form, should it be printed on a separate page?
"^DD",358.2,358.2,.15,21,0)
^^1^1^2950717^
"^DD",358.2,358.2,.15,21,1,0)
Applies only to dynamic selection lists.
"^DD",358.2,358.2,.15,"DT")
2950717
"^DD",358.2,358.2,.16,0)
NUMBER OF OTHER^NJ1,0^^0;16^K:+X'=X!(X>9)!(X<0)!(X?.E1"."1N.N) X
"^DD",358.2,358.2,.16,3)
Allocate space for how many 'other' not found on the list?
"^DD",358.2,358.2,.16,21,0)
^^2^2^2950717^
"^DD",358.2,358.2,.16,21,1,0)
Space will be allocated at the bottom of the lsit for this number of items
"^DD",358.2,358.2,.16,21,2,0)
not found on the list.
"^DD",358.2,358.2,.16,"DT")
2950717
"^DD",358.2,358.2,.17,0)
WHAT TO ALLOCATE SPACE FOR^S^1:NARRATIVE ONLY;2:CODE ONLY;3:NARRATIVE AND CODE;^0;17^Q
"^DD",358.2,358.2,.17,3)
What should space be allocated for when making room for 'other'?
"^DD",358.2,358.2,.17,21,0)
^^2^2^2950803^^
"^DD",358.2,358.2,.17,21,1,0)
This field will determine what fields will be placed on the form for
"^DD",358.2,358.2,.17,21,2,0)
writting in other items not found on the list.
"^DD",358.2,358.2,.17,"DT")
2950717
"^DD",358.2,358.2,.18,0)
WHAT TO SEND TO PCE^S^1:NARRATIVE ONLY;2:CODE ONLY;3:NARRATIVE AND CODE;^0;18^Q
"^DD",358.2,358.2,.18,3)
WHAT DO YOU WANT ENTERED INTO THE DATABASE?
"^DD",358.2,358.2,.18,21,0)
^^2^2^2960123^
"^DD",358.2,358.2,.18,21,1,0)
This determines what is sent to PCE.  For example, some types of data
"^DD",358.2,358.2,.18,21,2,0)
may require that a code be sent, but the narrative may be optional.
"^DD",358.2,358.2,.18,"DT")
2960123
"^DD",358.2,358.2,.19,0)
CLINICAL REMINDER DISPLAY TYPE^S^1:DUE NOW ONLY;2:ALL REMINDERS;^0;19^Q
"^DD",358.2,358.2,.19,3)
This determines the clincial reminders that will print on an encounter form.  Choose either to see only those due now or all appropriate reminders.
"^DD",358.2,358.2,.19,21,0)
^^1^1^2980910^^^^
"^DD",358.2,358.2,.19,21,1,0)
This is the display type for this list of clinical reminders.
"^DD",358.2,358.2,.19,"DT")
2971027
"^DD",358.2,358.2,1,0)
LIST COLUMN^358.21I^^1;0
"^DD",358.2,358.2,1,21,0)
^^2^2^2940216^^^^
"^DD",358.2,358.2,1,21,1,0)
A column is a rectangular area that has the necessary width to display a
"^DD",358.2,358.2,1,21,2,0)
single item on the list.
"^DD",358.2,358.2,1,"DT")
2930802
"^DD",358.2,358.2,2,0)
SUBCOLUMN NUMBER^358.22I^^2;0
"^DD",358.2,358.2,2,21,0)
^^4^4^2941020^^^^
"^DD",358.2,358.2,2,21,1,0)
 
"^DD",358.2,358.2,2,21,2,0)
A subcolumn contains one field of the entry on the list. The subcolumn
"^DD",358.2,358.2,2,21,3,0)
order is the order, from left to right, that the subcolumns will appear
"^DD",358.2,358.2,2,21,4,0)
in.
"^DD",358.2,358.2,2,"DT")
2930413
"^DD",358.2,358.21,0)
LIST COLUMN SUB-FIELD^^.04^4
"^DD",358.2,358.21,0,"DT")
2930331
"^DD",358.2,358.21,0,"ID","WRITE")
D EN^DDIOL("   COLUMN #"_$P($G(^(0)),U),"","?0")
"^DD",358.2,358.21,0,"IX","B",358.21,.01)

"^DD",358.2,358.21,0,"NM","LIST COLUMN")

"^DD",358.2,358.21,0,"UP")
358.2
"^DD",358.2,358.21,.01,0)
LIST COLUMN NUMBER^MNJ1,0^^0;1^K:+X'=X!(X>4)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.2,358.21,.01,1,0)
^.1
"^DD",358.2,358.21,.01,1,1,0)
358.21^B
"^DD",358.2,358.21,.01,1,1,1)
S ^IBE(358.2,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",358.2,358.21,.01,1,1,2)
K ^IBE(358.2,DA(1),1,"B",$E(X,1,30),DA)
"^DD",358.2,358.21,.01,3)
You can specify the position and height of up to 4 columns. Defaults will be used where needed.
"^DD",358.2,358.21,.01,21,0)
^^2^2^2930722^^
"^DD",358.2,358.21,.01,21,1,0)
The order that the columns will be filled. Column 1 will first be filled
"^DD",358.2,358.21,.01,21,2,0)
with items, then column 2, etc.
"^DD",358.2,358.21,.01,"DT")
2930802
"^DD",358.2,358.21,.02,0)
LIST COLUMN'S STARTING ROW^NJ3,0XO^^0;2^S:+X=X X=X-1 K:+X'=X!(X>200)!(X<0)!(X?.E1"."1N.N) X
"^DD",358.2,358.21,.02,.1)
WHAT ROW SHOULD THE LIST COLUMN START IN? (OPTIONAL)
"^DD",358.2,358.21,.02,2)
S Y(0)=Y S:+Y=Y Y=+Y+1
"^DD",358.2,358.21,.02,2.1)
S:+Y=Y Y=+Y+1
"^DD",358.2,358.21,.02,3)
What row should the column begin in?
"^DD",358.2,358.21,.02,21,0)
^^2^2^2930715^^^
"^DD",358.2,358.21,.02,21,1,0)
The row, relative to the block, that the column should begin in. This is
"^DD",358.2,358.21,.02,21,2,0)
optional, since default values can be used.
"^DD",358.2,358.21,.02,23,0)
^^4^4^2930715^^
"^DD",358.2,358.21,.02,23,1,0)
The internal representation starts at 0, the external representation
"^DD",358.2,358.21,.02,23,2,0)
starts at 1. The difference is because for computing the form image
"^DD",358.2,358.21,.02,23,3,0)
it is convenient to work with displacements from the top left-hand
"^DD",358.2,358.21,.02,23,4,0)
corner. However, users do not want to work with row=0 or column=0.
"^DD",358.2,358.21,.02,"DT")
2930802
"^DD",358.2,358.21,.03,0)
LIST COLUMN'S STARTING COLUMN^NJ3,0XO^^0;3^S:+X=X X=X-1 K:+X'=X!(X>200)!(X<0)!(X?.E1"."1N.N) X
"^DD",358.2,358.21,.03,.1)
WHAT BLOCK COLUMN SHOULD THE LIST COLUMN START IN? (OPTIONAL)
"^DD",358.2,358.21,.03,2)
S Y(0)=Y S:+Y=Y Y=+Y+1
"^DD",358.2,358.21,.03,2.1)
S:+Y=Y Y=+Y+1
"^DD",358.2,358.21,.03,3)
At what block column should the list column begin at? The first subcolumn of the list column will start one character to the right of this.
"^DD",358.2,358.21,.03,21,0)
^^4^4^2940216^
"^DD",358.2,358.21,.03,21,1,0)
 
"^DD",358.2,358.21,.03,21,2,0)
The column (# of characters to the right) that the list column should
"^DD",358.2,358.21,.03,21,3,0)
begin in, relative to the block. It is optional, since a default value can
"^DD",358.2,358.21,.03,21,4,0)
be used.
"^DD",358.2,358.21,.03,23,0)
^^4^4^2930715^
"^DD",358.2,358.21,.03,23,1,0)
The internal representation starts at 0, the external representation
"^DD",358.2,358.21,.03,23,2,0)
starts at 1. The difference is because for computing the form image
"^DD",358.2,358.21,.03,23,3,0)
it is convenient to work with displacements from the top left-hand
"^DD",358.2,358.21,.03,23,4,0)
corner. However, users do not want to work with row=0 or column=0.
"^DD",358.2,358.21,.03,"DT")
2930930
"^DD",358.2,358.21,.04,0)
LIST COLUMN HEIGHT^NJ3,0^^0;4^K:+X'=X!(X>200)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.2,358.21,.04,.1)
HOW MANY LINES HIGH SHOULD THE LIST COLUMN BE? (OPTIONAL)
"^DD",358.2,358.21,.04,3)
How many lines should the column cover?
"^DD",358.2,358.21,.04,21,0)
^^3^3^2930527^
"^DD",358.2,358.21,.04,21,1,0)
 
"^DD",358.2,358.21,.04,21,2,0)
The number of lines the column should occupy. This is optional - if not
"^DD",358.2,358.21,.04,21,3,0)
supplied the column will extend to the bottom of the block.
"^DD",358.2,358.21,.04,"DT")
2930802
"^DD",358.2,358.22,0)
SUBCOLUMN NUMBER SUB-FIELD^^.1^10
"^DD",358.2,358.22,0,"DT")
2960123
"^DD",358.2,358.22,0,"ID","WRITE")
D ID1^IBDFU5
"^DD",358.2,358.22,0,"IX","B",358.22,.01)

"^DD",358.2,358.22,0,"NM","SUBCOLUMN NUMBER")

"^DD",358.2,358.22,0,"UP")
358.2
"^DD",358.2,358.22,.01,0)
SUBCOLUMN NUMBER^MRNJ1,0X^^0;1^K:+X'=X!(X>6)!(X<1)!(X?.E1"."1N.N)!($D(^IBE(358.2,DA(1),2,"B",X))) X
"^DD",358.2,358.22,.01,.1)
Number of the subcolumn, subcolumns being numbered 1-6, left-to-right
"^DD",358.2,358.22,.01,1,0)
^.1
"^DD",358.2,358.22,.01,1,1,0)
358.22^B
"^DD",358.2,358.22,.01,1,1,1)
S ^IBE(358.2,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",358.2,358.22,.01,1,1,2)
K ^IBE(358.2,DA(1),2,"B",$E(X,1,30),DA)
"^DD",358.2,358.22,.01,3)
The SUBCOLUMN NUMBER determines the order in which the subcolumns will display. There are at most 6 subcolumns, numbered 1-6.
"^DD",358.2,358.22,.01,21,0)
^^2^2^2930527^
"^DD",358.2,358.22,.01,21,1,0)
 
"^DD",358.2,358.22,.01,21,2,0)
The order that the subcolumn will appear on the form.
"^DD",358.2,358.22,.01,"DT")
2930413
"^DD",358.2,358.22,.02,0)
SUBCOLUMN HEADER^F^^0;2^K:$L(X)>150!($L(X)<1) X
"^DD",358.2,358.22,.02,.1)
WHAT TEXT SHOULD APPEAR AT THE TOP OF THE SUBCOLUMN?
"^DD",358.2,358.22,.02,3)
What text should appear at the top of the subcolumn?
"^DD",358.2,358.22,.02,21,0)
^^2^2^2930527^
"^DD",358.2,358.22,.02,21,1,0)
 
"^DD",358.2,358.22,.02,21,2,0)
The text that will appear at the top of the subcolumn.
"^DD",358.2,358.22,.02,"DT")
2930414
"^DD",358.2,358.22,.03,0)
SUBCOLUMN WIDTH^NJ3,0^^0;3^K:+X'=X!(X>150)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.2,358.22,.03,.1)
HOW WIDE SHOULD THE SUBCOLUMN BE?
"^DD",358.2,358.22,.03,3)
How wide should the subcolumn be?
"^DD",358.2,358.22,.03,21,0)
^^3^3^2930527^
"^DD",358.2,358.22,.03,21,1,0)
 
"^DD",358.2,358.22,.03,21,2,0)
The width of the subcolumn. If the subcolumn contains a MARKING AREA then
"^DD",358.2,358.22,.03,21,3,0)
the width of the MARKING AREA overrides what ever this is.
"^DD",358.2,358.22,.03,"DT")
2930414
"^DD",358.2,358.22,.04,0)
TYPE OF SUBCOLUMN^RS^1:TEXT;2:MARKING;^0;4^Q
"^DD",358.2,358.22,.04,.1)
SUBCOLUMN CONTAINS TEXT, OR FOR MARKING? (TEXT/MARKING)
"^DD",358.2,358.22,.04,3)
Enter '1' if the subcolumn will contain text, '2' if it will be for the user to mark his selections.
"^DD",358.2,358.22,.04,21,0)
^^4^4^2930527^
"^DD",358.2,358.22,.04,21,1,0)
 
"^DD",358.2,358.22,.04,21,2,0)
The subcolumn can contain either text, derived from what is returned by
"^DD",358.2,358.22,.04,21,3,0)
the PACKAGE INTERFACE, or a MARKING AREA, which is meant to be written in
"^DD",358.2,358.22,.04,21,4,0)
to select an entry on the list.
"^DD",358.2,358.22,.04,"DT")
2930428
"^DD",358.2,358.22,.05,0)
SUBCOLUMN'S DATA^NJ1,0X^^0;5^K:+X'=X!(X>7)!(X<1)!(X?.E1"."1N.N)!($P($G(^IBE(358.6,+$P($G(^IBE(358.2,DA(1),0)),U,11),2)),U,(2*X)-1)="")!((X=1)&'$P($G(^IBE(358.6,+$P($G(^IBE(358.2,DA(1),0)),U,11),2)),U,17)) X
"^DD",358.2,358.22,.05,.1)
WHAT DATA SHOULD BE CONTAINED IN THE SUBCOLUMN?
"^DD",358.2,358.22,.05,3)
WHAT DATA SHOULD BE CONTAINED IN THE SUBCOLUMN?
"^DD",358.2,358.22,.05,4)
D HELP2^IBDFU5
"^DD",358.2,358.22,.05,21,0)
^^3^3^2940719^^
"^DD",358.2,358.22,.05,21,1,0)
 
"^DD",358.2,358.22,.05,21,2,0)
The Package Interface returns a record, which is composed of fields. This
"^DD",358.2,358.22,.05,21,3,0)
identifies which field goes in the subcolumn.
"^DD",358.2,358.22,.05,"DT")
2940719
"^DD",358.2,358.22,.06,0)
MARKING AREA^P358.91'^IBE(358.91,^0;6^Q
"^DD",358.2,358.22,.06,.1)
TYPE OF MARKING AREA
"^DD",358.2,358.22,.06,3)
What type of marking area should appear in the subcolumn?
"^DD",358.2,358.22,.06,21,0)
^^2^2^2930527^
"^DD",358.2,358.22,.06,21,1,0)
 
"^DD",358.2,358.22,.06,21,2,0)
This identifies which MARKING AREA should go in the subcolumn.
"^DD",358.2,358.22,.06,"DT")
2930414
"^DD",358.2,358.22,.07,0)
ALLOW EDITING OF TEXT?^S^0:NO;1:YES;^0;7^Q
"^DD",358.2,358.22,.07,.1)
ALLOW EDITING OF THE TEXT APPEARING IN THIS SUBCOLUMN? (YES/NO)
"^DD",358.2,358.22,.07,3)
Is it okey to edit the text appearing in this subcolumn?
"^DD",358.2,358.22,.07,21,0)
^^4^4^2930527^
"^DD",358.2,358.22,.07,21,1,0)
 
"^DD",358.2,358.22,.07,21,2,0)
This determines whether or not the user, when selecting items to appear on
"^DD",358.2,358.22,.07,21,3,0)
the list, will be able to edit the text appearing in the subcolum. This is
"^DD",358.2,358.22,.07,21,4,0)
ignored if the subcolumn contains a MARKING AREA.
"^DD",358.2,358.22,.07,"DT")
2930428
"^DD",358.2,358.22,.08,0)
DO NOT UNDERLINE MARKING AREA?^S^0:NO;1:YES;^0;8^Q
"^DD",358.2,358.22,.08,3)
Enter YES if you do NOT want this subcolumn underlined.
"^DD",358.2,358.22,.08,"DT")
2940607
"^DD",358.2,358.22,.09,0)
DATA QUALIFIER^P358.98'^IBD(358.98,^0;9^Q
"^DD",358.2,358.22,.09,"DT")
2941020
"^DD",358.2,358.22,.1,0)
SELECTION RULE^S^0:ANY NUMBER;1:EXACTLY ONE;2:AT MOST ONE (0 or 1);3:AT LEAST ONE (1 or more);^0;10^Q
"^DD",358.2,358.22,.1,3)
Which rule applies to the choices the user can make in this subcolumn?
"^DD",358.2,358.22,.1,21,0)
^^2^2^2960123^
"^DD",358.2,358.22,.1,21,1,0)
A selection rule can be applied to a subcolumn used to make selections,
"^DD",358.2,358.22,.1,21,2,0)
i.e., one that contains marking areas.
"^DD",358.2,358.22,.1,"DT")
2960123
"^DD",358.3,358.3,0)
FIELD^^3^15
"^DD",358.3,358.3,0,"DT")
2961031
"^DD",358.3,358.3,0,"ID",.03)
S %I=Y,Y=$S('$D(^(0)):"",$D(^IBE(358.2,+$P(^(0),U,3),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(358.2,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",358.3,358.3,0,"ID",.04)
S %I=Y,Y=$S('$D(^(0)):"",$D(^IBE(358.4,+$P(^(0),U,4),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(358.4,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",358.3,358.3,0,"IX","APO",358.3,.03)

"^DD",358.3,358.3,0,"IX","APO1",358.3,.04)

"^DD",358.3,358.3,0,"IX","APO2",358.3,.05)

"^DD",358.3,358.3,0,"IX","B",358.3,.01)

"^DD",358.3,358.3,0,"IX","C",358.3,.03)

"^DD",358.3,358.3,0,"IX","D",358.3,.04)

"^DD",358.3,358.3,0,"NM","IMP/EXP SELECTION")

"^DD",358.3,358.3,0,"VRPK")
AUTOMATED INFO COLLECTION SYS
"^DD",358.3,358.3,.01,0)
SELECTION ID^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",358.3,358.3,.01,1,0)
^.1
"^DD",358.3,358.3,.01,1,1,0)
358.3^B
"^DD",358.3,358.3,.01,1,1,1)
S ^IBE(358.3,"B",$E(X,1,30),DA)=""
"^DD",358.3,358.3,.01,1,1,2)
K ^IBE(358.3,"B",$E(X,1,30),DA)
"^DD",358.3,358.3,.01,3)
Answer must be 3-30 characters in length.
"^DD",358.3,358.3,.01,21,0)
^^2^2^2930309^
"^DD",358.3,358.3,.01,21,1,0)
 
"^DD",358.3,358.3,.01,21,2,0)
The ID passed by the package.
"^DD",358.3,358.3,.01,"DT")
2921119
"^DD",358.3,358.3,.02,0)
PLACE HOLDER ONLY^S^0:NO;1:YES;^0;2^Q
"^DD",358.3,358.3,.02,3)
Enter YES if this is a place holder, used to add some space to the list.
"^DD",358.3,358.3,.02,"DT")
2950717
"^DD",358.3,358.3,.03,0)
SELECTION LIST^RP358.2'^IBE(358.2,^0;3^Q
"^DD",358.3,358.3,.03,1,0)
^.1
"^DD",358.3,358.3,.03,1,1,0)
358.3^C
"^DD",358.3,358.3,.03,1,1,1)
S ^IBE(358.3,"C",$E(X,1,30),DA)=""
"^DD",358.3,358.3,.03,1,1,2)
K ^IBE(358.3,"C",$E(X,1,30),DA)
"^DD",358.3,358.3,.03,1,1,"DT")
2921127
"^DD",358.3,358.3,.03,1,2,0)
358.3^APO^MUMPS
"^DD",358.3,358.3,.03,1,2,1)
I $P($G(^IBE(358.3,DA,0)),U,5)]"",$P(^(0),U,4) S ^IBE(358.3,"APO",X,$P(^(0),U,4),$P(^(0),U,5),DA)=""
"^DD",358.3,358.3,.03,1,2,2)
I $P($G(^IBE(358.3,DA,0)),U,5)]"",$P(^(0),U,4) K ^IBE(358.3,"APO",X,$P(^(0),U,4),$P(^(0),U,5),DA)
"^DD",358.3,358.3,.03,1,2,"DT")
2960403
"^DD",358.3,358.3,.03,21,0)
^^2^2^2921215^
"^DD",358.3,358.3,.03,21,1,0)
 
"^DD",358.3,358.3,.03,21,2,0)
Identifies the selection list that this selection belongs on.
"^DD",358.3,358.3,.03,"DT")
2960403
"^DD",358.3,358.3,.04,0)
SELECTION GROUP^RP358.4^IBE(358.4,^0;4^Q
"^DD",358.3,358.3,.04,1,0)
^.1
"^DD",358.3,358.3,.04,1,1,0)
358.3^D
"^DD",358.3,358.3,.04,1,1,1)
S ^IBE(358.3,"D",$E(X,1,30),DA)=""
"^DD",358.3,358.3,.04,1,1,2)
K ^IBE(358.3,"D",$E(X,1,30),DA)
"^DD",358.3,358.3,.04,1,1,"DT")
2921221
"^DD",358.3,358.3,.04,1,2,0)
358.3^APO1^MUMPS
"^DD",358.3,358.3,.04,1,2,1)
I $P($G(^IBE(358.3,DA,0)),U,5)]"",$P(^(0),U,3) S ^IBE(358.3,"APO",$P(^(0),U,3),X,$P(^(0),U,5),DA)=""
"^DD",358.3,358.3,.04,1,2,2)
I $P($G(^IBE(358.3,DA,0)),U,5)]"",$P(^(0),U,3) K ^IBE(358.3,"APO",$P(^(0),U,3),X,$P(^(0),U,5),DA)
"^DD",358.3,358.3,.04,1,2,"DT")
2960403
"^DD",358.3,358.3,.04,3)
Entries on a list are grouped under group headers - under which header should this entry appear?
"^DD",358.3,358.3,.04,21,0)
^^3^3^2930607^
"^DD",358.3,358.3,.04,21,1,0)
 
"^DD",358.3,358.3,.04,21,2,0)
The SELECTION GROUP that the selection belongs to.The selection will
"^DD",358.3,358.3,.04,21,3,0)
appear under the group header on the form.
"^DD",358.3,358.3,.04,"DT")
2960403
"^DD",358.3,358.3,.05,0)
PRINT ORDER WITHIN GROUP^RNJ6,2^^0;5^K:+X'=X!(X>999.99)!(X<0)!(X?.E1"."3N.N) X
"^DD",358.3,358.3,.05,1,0)
^.1
"^DD",358.3,358.3,.05,1,1,0)
358.3^APO2^MUMPS
"^DD",358.3,358.3,.05,1,1,1)
I $P($G(^IBE(358.3,DA,0)),U,3),$P(^(0),U,4) S ^IBE(358.3,"APO",$P(^(0),U,3),$P(^(0),U,4),X,DA)=""
"^DD",358.3,358.3,.05,1,1,2)
I $P(^IBE(358.3,DA,0),U,3),$P(^(0),U,4) K ^IBE(358.3,"APO",$P(^(0),U,3),$P(^(0),U,4),X,DA)
"^DD",358.3,358.3,.05,1,1,"DT")
2960403
"^DD",358.3,358.3,.05,3)
Type a Number between 0 and 999.99, 2 Decimal Digits
"^DD",358.3,358.3,.05,21,0)
^^2^2^2921229^^^^
"^DD",358.3,358.3,.05,21,1,0)
Determines the order that this selection entry will appear in under the
"^DD",358.3,358.3,.05,21,2,0)
header for the selection group.
"^DD",358.3,358.3,.05,"DT")
2960403
"^DD",358.3,358.3,.06,0)
PLACE HOLDER TEXT^F^^0;6^K:$L(X)>75!($L(X)<1) X
"^DD",358.3,358.3,.06,3)
What text should be displayed for the place holder?
"^DD",358.3,358.3,.06,"DT")
2950717
"^DD",358.3,358.3,.07,0)
USE AS PLACE HOLDER^S^0:NO;1:YES;^0;7^Q
"^DD",358.3,358.3,.07,3)
Does the place holder serve as a subheader?
"^DD",358.3,358.3,.07,21,0)
^^2^2^2950928^
"^DD",358.3,358.3,.07,21,1,0)
If the place holder is being used as a subheader its text should be
"^DD",358.3,358.3,.07,21,2,0)
included with the narrative. This field implements that.
"^DD",358.3,358.3,.07,"DT")
2950928
"^DD",358.3,358.3,.08,0)
END USE AS SUBHEADER?^S^0:NO;1:YES;^0;8^Q
"^DD",358.3,358.3,.08,3)
Should the prior subheader be discarded?
"^DD",358.3,358.3,.08,21,0)
^^2^2^2951002^
"^DD",358.3,358.3,.08,21,1,0)
This field is used to end the use of any prior subheader that is in
"^DD",358.3,358.3,.08,21,2,0)
effect. Applies only to selections defined to be place holders.
"^DD",358.3,358.3,.08,"DT")
2951002
"^DD",358.3,358.3,.09,0)
QUANTITY^NJ3,0^^0;9^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.3,358.3,.09,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",358.3,358.3,.09,21,0)
^^3^3^2961031^
"^DD",358.3,358.3,.09,21,1,0)
This field contains the number of occurrences for a particular selection.
"^DD",358.3,358.3,.09,21,2,0)
A value placed in this field will be passed to PCE as the quantity.
"^DD",358.3,358.3,.09,21,3,0)
Presently, the quantity field will only be asked for CPT codes.
"^DD",358.3,358.3,.09,"DT")
2961031
"^DD",358.3,358.3,1,0)
SUBCOLUMN VALUE^358.31IA^^1;0
"^DD",358.3,358.3,1,21,0)
^^3^3^2930527^
"^DD",358.3,358.3,1,21,1,0)
 
"^DD",358.3,358.3,1,21,2,0)
The selection can be composed of multiple fields. Each field occupies its
"^DD",358.3,358.3,1,21,3,0)
own subcolumn on the form.
"^DD",358.3,358.3,2.01,0)
NARRATIVE TO SEND TO PCE^F^^2;1^K:$L(X)>150!($L(X)<1) X
"^DD",358.3,358.3,2.01,3)
Enter the narrative to send to PCE if a provider narrative different from the description is desired.  Answer must be 3-80 characters in length.
"^DD",358.3,358.3,2.01,21,0)
^^6^6^2960123^
"^DD",358.3,358.3,2.01,21,1,0)
Enter the narrative that should be sent to PCE when this selection is
"^DD",358.3,358.3,2.01,21,2,0)
scanned.  This will be the provider narrative that is shown in PCE and
"^DD",358.3,358.3,2.01,21,3,0)
Problem List.  If there is no entry in this field the text as it appears
"^DD",358.3,358.3,2.01,21,4,0)
on the form will be sent as the narrative.  This field can only be
"^DD",358.3,358.3,2.01,21,5,0)
entered for the type of interfaces that allow adding this narrative,
"^DD",358.3,358.3,2.01,21,6,0)
and then send the narrative to PCE.
"^DD",358.3,358.3,2.01,"DT")
2960123
"^DD",358.3,358.3,2.02,0)
CLINICAL LEXICON ENTRY^P757.01'^LEX(757.01,^2;2^Q
"^DD",358.3,358.3,2.02,21,0)
^^5^5^2960131^
"^DD",358.3,358.3,2.02,21,1,0)
This is the clinical lexicon entry this term should be associated with.
"^DD",358.3,358.3,2.02,21,2,0)
Generally this is only completed for selections based on diagnosis.
"^DD",358.3,358.3,2.02,21,3,0)
The clinical lexicon entry will be passed to pce when this selection is
"^DD",358.3,358.3,2.02,21,4,0)
scanned.  This allows maintaining the patient problem list associated 
"^DD",358.3,358.3,2.02,21,5,0)
with clinical terms.
"^DD",358.3,358.3,2.02,"DT")
2960131
"^DD",358.3,358.3,2.03,0)
SECOND CODE^F^^2;3^K:$L(X)>10!($L(X)<1) X
"^DD",358.3,358.3,2.03,3)
Answer must be 1-10 characters in length.
"^DD",358.3,358.3,2.03,21,0)
^^1^1^2961031^
"^DD",358.3,358.3,2.03,21,1,0)
Used to send additional codes along when one entry is bubbled.
"^DD",358.3,358.3,2.03,"DT")
2961031
"^DD",358.3,358.3,2.04,0)
THIRD CODE^F^^2;4^K:$L(X)>10!($L(X)<1) X
"^DD",358.3,358.3,2.04,3)
Answer must be 1-10 characters in length.
"^DD",358.3,358.3,2.04,21,0)
^^1^1^2961031^
"^DD",358.3,358.3,2.04,21,1,0)
Answer must be 1-10 characters in length.
"^DD",358.3,358.3,2.04,"DT")
2961031
"^DD",358.3,358.3,3,0)
CPT MODIFIER^358.33^^3;0
"^DD",358.3,358.3,3,21,0)
^^2^2^3000121^
"^DD",358.3,358.3,3,21,1,0)
CPT Modifier multiple - entries will be associated with selection.
"^DD",358.3,358.3,3,21,2,0)
Only used when selection is a CPT Code.
"^DD",358.3,358.31,0)
SUBCOLUMN VALUE SUB-FIELD^^.02^2
"^DD",358.3,358.31,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",358.3,358.31,0,"IX","B",358.31,.01)

"^DD",358.3,358.31,0,"NM","SUBCOLUMN VALUE")

"^DD",358.3,358.31,0,"UP")
358.3
"^DD",358.3,358.31,.01,0)
SUBCOLUMN NUMBER^MRNJ1,0X^^0;1^K:+X'=X!(X>6)!(X<1)!(X?.E1"."1N.N)!($D(^IBE(358.3,DA(1),1,"B",X))) X
"^DD",358.3,358.31,.01,1,0)
^.1
"^DD",358.3,358.31,.01,1,1,0)
358.31^B
"^DD",358.3,358.31,.01,1,1,1)
S ^IBE(358.3,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",358.3,358.31,.01,1,1,2)
K ^IBE(358.3,DA(1),1,"B",$E(X,1,30),DA)
"^DD",358.3,358.31,.01,3)
Which subcolumn is the value for?
"^DD",358.3,358.31,.01,21,0)
^^2^2^2930527^
"^DD",358.3,358.31,.01,21,1,0)
 
"^DD",358.3,358.31,.01,21,2,0)
The order that the subcolumn should appear on the form.
"^DD",358.3,358.31,.01,"DT")
2930402
"^DD",358.3,358.31,.02,0)
SUBCOLUMN VALUE^F^^0;2^K:$L(X)>150!($L(X)<1) X
"^DD",358.3,358.31,.02,3)
What value should go in the subcolumn?
"^DD",358.3,358.31,.02,21,0)
^^2^2^2930527^
"^DD",358.3,358.31,.02,21,1,0)
 
"^DD",358.3,358.31,.02,21,2,0)
The text that should appear in the subcolumn.
"^DD",358.3,358.31,.02,"DT")
2930401
"^DD",358.3,358.33,0)
CPT MODIFIER SUB-FIELD^^1^2
"^DD",358.3,358.33,0,"DT")
2990920
"^DD",358.3,358.33,0,"IX","B",358.33,.01)

"^DD",358.3,358.33,0,"NM","CPT MODIFIER")

"^DD",358.3,358.33,0,"UP")
358.3
"^DD",358.3,358.33,.01,0)
CPT MODIFIER^MFX^^0;1^D MOD^IBDF4C K:$L(X)>2!($L(X)<2) X
"^DD",358.3,358.33,.01,1,0)
^.1
"^DD",358.3,358.33,.01,1,1,0)
358.33^B
"^DD",358.3,358.33,.01,1,1,1)
S ^IBE(358.3,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",358.3,358.33,.01,1,1,2)
K ^IBE(358.3,DA(1),3,"B",$E(X,1,30),DA)
"^DD",358.3,358.33,.01,3)
Answer must be 2 characters in length.  This field is related to the CPT MODIFIER file.
"^DD",358.3,358.33,.01,4)
D LOOKUP^IBDF4C
"^DD",358.3,358.33,.01,21,0)
^^1^1^3000121^
"^DD",358.3,358.33,.01,21,1,0)
2 character CPT Modifier Code
"^DD",358.3,358.33,.01,"DT")
2990920
"^DD",358.3,358.33,1,0)
NAME^F^^0;2^K:$L(X)>30!($L(X)<3) X
"^DD",358.3,358.33,1,3)
Answer must be 3-30 characters in length.
"^DD",358.3,358.33,1,21,0)
^^1^1^3000121^
"^DD",358.3,358.33,1,21,1,0)
Description (name) of the CPT Modifier
"^DD",358.3,358.33,1,"DT")
2990920
"^DD",358.4,358.4,0)
FIELD^^.04^4
"^DD",358.4,358.4,0,"DDA")
N
"^DD",358.4,358.4,0,"DT")
2950717
"^DD",358.4,358.4,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",358.4,358.4,0,"ID",.03)
S %I=Y,Y=$S('$D(^(0)):"",$D(^IBE(358.2,+$P(^(0),U,3),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(358.2,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",358.4,358.4,0,"IX","APO",358.4,.02)

"^DD",358.4,358.4,0,"IX","APO1",358.4,.03)

"^DD",358.4,358.4,0,"IX","B",358.4,.01)

"^DD",358.4,358.4,0,"IX","D",358.4,.03)

"^DD",358.4,358.4,0,"NM","IMP/EXP SELECTION GROUP")

"^DD",358.4,358.4,0,"PT",358.3,.04)

"^DD",358.4,358.4,0,"VRPK")
AUTOMATED INFO COLLECTION SYS
"^DD",358.4,358.4,.01,0)
HEADER^RF^^0;1^K:$L(X)>40!($L(X)<1) X
"^DD",358.4,358.4,.01,1,0)
^.1
"^DD",358.4,358.4,.01,1,1,0)
358.4^B
"^DD",358.4,358.4,.01,1,1,1)
S ^IBE(358.4,"B",$E(X,1,30),DA)=""
"^DD",358.4,358.4,.01,1,1,2)
K ^IBE(358.4,"B",$E(X,1,30),DA)
"^DD",358.4,358.4,.01,3)
What text do you want to appear at the top of this group?
"^DD",358.4,358.4,.01,21,0)
^^2^2^2930604^^^^
"^DD",358.4,358.4,.01,21,1,0)
 
"^DD",358.4,358.4,.01,21,2,0)
The name given to a group of selections appearing on a selection list.
"^DD",358.4,358.4,.01,"DEL",1,0)
I '$G(IBLISTPR) W "...Selection Groups can only be deleted through the Encounter Form Utilities!"
"^DD",358.4,358.4,.01,"DT")
2930604
"^DD",358.4,358.4,.02,0)
PRINT ORDER^RNJ5,2^^0;2^K:+X'=X!(X>99.99)!(X<0)!(X?.E1"."3N.N) X
"^DD",358.4,358.4,.02,1,0)
^.1
"^DD",358.4,358.4,.02,1,1,0)
358.4^APO^MUMPS
"^DD",358.4,358.4,.02,1,1,1)
I $P($G(^IBE(358.4,DA,0)),U,3) S ^IBE(358.4,"APO",$P(^(0),U,3),X,DA)=""
"^DD",358.4,358.4,.02,1,1,2)
I $P($G(^IBE(358.4,DA,0)),U,3) K ^IBE(358.4,"APO",$P(^(0),U,3),X,DA)
"^DD",358.4,358.4,.02,1,1,"DT")
2960403
"^DD",358.4,358.4,.02,3)
Type a Number between 0 and 99.99, 2 Decimal Digits
"^DD",358.4,358.4,.02,21,0)
^^5^5^2921222^^^^
"^DD",358.4,358.4,.02,21,1,0)
 
"^DD",358.4,358.4,.02,21,2,0)
This will define the order that a group of selections will appear in as
"^DD",358.4,358.4,.02,21,3,0)
compared to the other groups of selections.
"^DD",358.4,358.4,.02,21,4,0)
A group header "BLANK" will be created by default with order number 0.
"^DD",358.4,358.4,.02,"DT")
2960403
"^DD",358.4,358.4,.03,0)
SELECTION LIST^RP358.2'^IBE(358.2,^0;3^Q
"^DD",358.4,358.4,.03,1,0)
^.1
"^DD",358.4,358.4,.03,1,1,0)
358.4^D
"^DD",358.4,358.4,.03,1,1,1)
S ^IBE(358.4,"D",$E(X,1,30),DA)=""
"^DD",358.4,358.4,.03,1,1,2)
K ^IBE(358.4,"D",$E(X,1,30),DA)
"^DD",358.4,358.4,.03,1,1,"%D",0)
^^1^1^2921218^
"^DD",358.4,358.4,.03,1,1,"%D",1,0)
Used to find all the groups belonging to a selection list.
"^DD",358.4,358.4,.03,1,1,"DT")
2921218
"^DD",358.4,358.4,.03,1,2,0)
358.4^APO1^MUMPS
"^DD",358.4,358.4,.03,1,2,1)
I $P($G(^IBE(358.4,DA,0)),U,2)]"" S ^IBE(358.4,"APO",X,$P(^(0),U,2),DA)=""
"^DD",358.4,358.4,.03,1,2,2)
I $P($G(^IBE(358.4,DA,0)),U,2)]"" K ^IBE(358.4,"APO",X,$P(^(0),U,2),DA)
"^DD",358.4,358.4,.03,1,2,"DT")
2960403
"^DD",358.4,358.4,.03,3)
This identifies the selection list that contains this group.
"^DD",358.4,358.4,.03,21,0)
^^2^2^2930527^
"^DD",358.4,358.4,.03,21,1,0)
 
"^DD",358.4,358.4,.03,21,2,0)
The Selection List this group belongs to.
"^DD",358.4,358.4,.03,"DT")
2960403
"^DD",358.4,358.4,.04,0)
INVISIBLE^S^I:INVISIBLE;^0;4^Q
"^DD",358.4,358.4,.04,3)
If you do not want the header to print, enter 'I'.
"^DD",358.4,358.4,.04,"DT")
2950717
"^DD",358.6,358.6,0)
FIELD^^.21^76
"^DD",358.6,358.6,0,"DDA")
N
"^DD",358.6,358.6,0,"DT")
3000124
"^DD",358.6,358.6,0,"ID",.06)
W ""
"^DD",358.6,358.6,0,"ID","WRITE")
N IBDWNAM S IBDWNAM=$E($P(^(0),U),1,40) D EN^DDIOL(IBDWNAM,"","!?0")
"^DD",358.6,358.6,0,"ID","WRITE1")
N IBDWTYPE S IBDWTYPE=$S($P(^(0),"^",6)=1:"INPUT",$P(^(0),"^",6)=2:"OUTPUT",$P(^(0),"^",6)=3:"SELECTION",1:"REPORT")_$S($P(^(0),U,6)=3&'$P(^(0),"^",13):"  ** NOT SCANNABLE **",1:"") D EN^DDIOL("TYPE="_IBDWTYPE,"","?45")
"^DD",358.6,358.6,0,"IX","B",358.6,.01)

"^DD",358.6,358.6,0,"IX","C",358.6,.04)

"^DD",358.6,358.6,0,"IX","D",358.6,3)

"^DD",358.6,358.6,0,"IX","E",358.6,.01)

"^DD",358.6,358.6,0,"NM","IMP/EXP PACKAGE INTERFACE")

"^DD",358.6,358.6,0,"PT",358.2,.11)

"^DD",358.6,358.6,0,"PT",358.5,.03)

"^DD",358.6,358.6,0,"PT",358.6,.13)

"^DD",358.6,358.6,0,"PT",358.93,.06)

"^DD",358.6,358.6,0,"VRPK")
AUTOMATED INFO COLLECTION SYS
"^DD",358.6,358.6,.01,0)
NAME^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>40!($L(X)<3)!'(X'?1P.E) X
"^DD",358.6,358.6,.01,1,0)
^.1
"^DD",358.6,358.6,.01,1,1,0)
358.6^B
"^DD",358.6,358.6,.01,1,1,1)
S ^IBE(358.6,"B",$E(X,1,30),DA)=""
"^DD",358.6,358.6,.01,1,1,2)
K ^IBE(358.6,"B",$E(X,1,30),DA)
"^DD",358.6,358.6,.01,1,2,0)
358.6^E^MUMPS
"^DD",358.6,358.6,.01,1,2,1)
S ^IBE(358.6,"E",$E(X,$F(X," "),40),DA)=""
"^DD",358.6,358.6,.01,1,2,2)
K ^IBE(358.6,"E",$E(X,$F(X," "),40),DA)
"^DD",358.6,358.6,.01,1,2,"%D",0)
^^4^4^2940224^
"^DD",358.6,358.6,.01,1,2,"%D",1,0)
 
"^DD",358.6,358.6,.01,1,2,"%D",2,0)
For package interfaces that are output routines the name has the custodial
"^DD",358.6,358.6,.01,1,2,"%D",3,0)
package's name space as a prefix. This cross-reference removes that
"^DD",358.6,358.6,.01,1,2,"%D",4,0)
prefix. It is used to improve the display of output routines for the user.
"^DD",358.6,358.6,.01,1,2,"DT")
2930409
"^DD",358.6,358.6,.01,3)
Answer must be 3-40 characters in length. All entries with Action Type other than PRINT REPORT must be be prefixed with the namespace of the package that is responsible for the data.
"^DD",358.6,358.6,.01,21,0)
^^3^3^2950412^^^^
"^DD",358.6,358.6,.01,21,1,0)
 
"^DD",358.6,358.6,.01,21,2,0)
The name of the Package Interface. For interfaces returning data the name
"^DD",358.6,358.6,.01,21,3,0)
should be preceded with the namespace of the package.
"^DD",358.6,358.6,.01,23,0)
^^1^1^2950412^
"^DD",358.6,358.6,.01,23,1,0)
 
"^DD",358.6,358.6,.01,"DT")
2930409
"^DD",358.6,358.6,.02,0)
ENTRY POINT^F^^0;2^K:$L(X)>8!($L(X)<1) X
"^DD",358.6,358.6,.02,3)
What entry point into the routine does this package interface use?
"^DD",358.6,358.6,.02,21,0)
^^2^2^2941018^^
"^DD",358.6,358.6,.02,21,1,0)
 
"^DD",358.6,358.6,.02,21,2,0)
The entry point in the routine that should be called.
"^DD",358.6,358.6,.02,"DT")
2941018
"^DD",358.6,358.6,.03,0)
ROUTINE^F^^0;3^K:$L(X)>8!($L(X)<1) X
"^DD",358.6,358.6,.03,3)
What routine does this package interface use?
"^DD",358.6,358.6,.03,21,0)
^^2^2^2941018^^
"^DD",358.6,358.6,.03,21,1,0)
 
"^DD",358.6,358.6,.03,21,2,0)
The routine that should be called.
"^DD",358.6,358.6,.03,"DT")
2921125
"^DD",358.6,358.6,.04,0)
CUSTODIAL PACKAGE^F^^0;4^K:$L(X)>20!($L(X)<3) X
"^DD",358.6,358.6,.04,1,0)
^.1
"^DD",358.6,358.6,.04,1,1,0)
358.6^C
"^DD",358.6,358.6,.04,1,1,1)
S ^IBE(358.6,"C",$E(X,1,30),DA)=""
"^DD",358.6,358.6,.04,1,1,2)
K ^IBE(358.6,"C",$E(X,1,30),DA)
"^DD",358.6,358.6,.04,1,1,"DT")
2921229
"^DD",358.6,358.6,.04,3)
For Package Interfaces that return data the Custodial Package is the package that is providing the data. For Package Interfaces that print reports it is the package that is providing the report.
"^DD",358.6,358.6,.04,21,0)
^^2^2^2940217^
"^DD",358.6,358.6,.04,21,1,0)
This is a free text pointer to the package file. It serves only to
"^DD",358.6,358.6,.04,21,2,0)
document the custodial package of the data.
"^DD",358.6,358.6,.04,"DT")
2930726
"^DD",358.6,358.6,.05,0)
VARIABLE DATA?^S^0:NO;1:YES;^0;5^Q
"^DD",358.6,358.6,.05,.1)
DOES THE DATA VARY FROM PATIENT TO PATIENT?
"^DD",358.6,358.6,.05,3)
Enter YES if the data returned is variable, NO if the data is always the same.
"^DD",358.6,358.6,.05,21,0)
^^3^3^2930726^^^
"^DD",358.6,358.6,.05,21,1,0)
This field is used in the batch printing of encounter forms. The purpose
"^DD",358.6,358.6,.05,21,2,0)
is to avoid recomputing fields whose data does not change from patient to
"^DD",358.6,358.6,.05,21,3,0)
patient.
"^DD",358.6,358.6,.05,"DT")
2931124
"^DD",358.6,358.6,.06,0)
ACTION TYPE^RS^1:INPUT;2:DISPLAY;3:SELECTION;4:PRINT REPORT;^0;6^Q
"^DD",358.6,358.6,.06,3)
Is this interface for inputting data, displaying data to a form, for creating lists that will appear on a form, or for printing reports?
"^DD",358.6,358.6,.06,21,0)
^^9^9^2950825^
"^DD",358.6,358.6,.06,21,1,0)
                                                                   
"^DD",358.6,358.6,.06,21,2,0)
 
"^DD",358.6,358.6,.06,21,3,0)
Enter 1 for INPUT if the interface accepts data input from the user
"^DD",358.6,358.6,.06,21,4,0)
and transmits the data to the appropriate package. Enter 2 for DISPLAY
"^DD",358.6,358.6,.06,21,5,0)
if the interface retrieve data for display to a form. Enter 3 for
"^DD",358.6,358.6,.06,21,6,0)
SELECTION if the interface is for building a list to display
"^DD",358.6,358.6,.06,21,7,0)
to a form. Enter 4 if the interface is for printing a report. If
"^DD",358.6,358.6,.06,21,8,0)
the ACTION TYPE is SELECTION then the data type must be a record and the
"^DD",358.6,358.6,.06,21,9,0)
first piece must be the ID use to uniquely identify the selection.
"^DD",358.6,358.6,.06,"DT")
2950825
"^DD",358.6,358.6,.07,0)
DATA TYPE^S^1:SINGLE VALUE;2:RECORD;3:LIST OF SINGLE VALUES;4:LIST OF RECORDS;5:WORD PROCESSING;^0;7^Q
"^DD",358.6,358.6,.07,.1)
WHAT FORMAT WILL THE DATA BE IN?
"^DD",358.6,358.6,.07,3)
What format will the data be in?
"^DD",358.6,358.6,.07,21,0)
^^9^9^2950825^
"^DD",358.6,358.6,.07,21,1,0)
Only applies to selection or display interfaces, both of which retrieve
"^DD",358.6,358.6,.07,21,2,0)
data for display to a form. It is the type of format the data should be
"^DD",358.6,358.6,.07,21,3,0)
in.
"^DD",358.6,358.6,.07,21,4,0)
 
"^DD",358.6,358.6,.07,21,5,0)
A single value is a string without pieces. A record is a set of strings
"^DD",358.6,358.6,.07,21,6,0)
concatenated together with "^" separating the pieces. A list is an
"^DD",358.6,358.6,.07,21,7,0)
indefinite number of values, each numbered, each containing the same type
"^DD",358.6,358.6,.07,21,8,0)
of information. A word processing data type will be in FM format.
"^DD",358.6,358.6,.07,21,9,0)
If the ACTION TYPE is SELECTION then the data type must be record.
"^DD",358.6,358.6,.07,"DT")
2930726
"^DD",358.6,358.6,.08,0)
PRINT COMPLETE^S^0:NO;1:YES;^0;8^Q
"^DD",358.6,358.6,.08,3)
If there is insufficient room on the form to print the data, should it be re-printed in full on a separate page?
"^DD",358.6,358.6,.08,21,0)
^^4^4^2930527^
"^DD",358.6,358.6,.08,21,1,0)
 
"^DD",358.6,358.6,.08,21,2,0)
This field is used to determine what should happen if the data does not
"^DD",358.6,358.6,.08,21,3,0)
fit in the space allocated to it on the form. If answered YES the data
"^DD",358.6,358.6,.08,21,4,0)
will be printed on another page.
"^DD",358.6,358.6,.08,"DT")
2930507
"^DD",358.6,358.6,.09,0)
AVAILABLE? (Y/N)^RS^0:NO;1:YES;^0;9^Q
"^DD",358.6,358.6,.09,3)
Is this package interface now available for use?
"^DD",358.6,358.6,.09,21,0)
^^3^3^2930527^
"^DD",358.6,358.6,.09,21,1,0)
 
"^DD",358.6,358.6,.09,21,2,0)
This field should be set to YES if the interface is available, NO if it is
"^DD",358.6,358.6,.09,21,3,0)
not available. Interfaces that are not available are not called.
"^DD",358.6,358.6,.09,"DT")
2921213
"^DD",358.6,358.6,.1,0)
HEALTH SUMMARY?^S^0:NO;1:YES;^0;10^Q
"^DD",358.6,358.6,.1,.1)
ARE YOU REQUESTING A HEALTH SUMMARY?
"^DD",358.6,358.6,.1,2.1)
S:Y=+Y Y=Y+1
"^DD",358.6,358.6,.1,3)
 Are you requesting a HEALTH SUMMARY to print?
"^DD",358.6,358.6,.1,21,0)
^^7^7^2930616^
"^DD",358.6,358.6,.1,21,1,0)
 
"^DD",358.6,358.6,.1,21,2,0)
This field will determine how to go about printing the report or form. It
"^DD",358.6,358.6,.1,21,3,0)
applies only to Package Interfaces of ACTION TYPE = PRINT REPORT. Health
"^DD",358.6,358.6,.1,21,4,0)
Summaries use the field HEALTH SUMMARY to determine the type of Health
"^DD",358.6,358.6,.1,21,5,0)
Summary to print. The process of printing Health Summaries dos not use the
"^DD",358.6,358.6,.1,21,6,0)
fields ENTRY POINT or ROUTINE, since all Health Summaries are printed in
"^DD",358.6,358.6,.1,21,7,0)
the same way.
"^DD",358.6,358.6,.1,"DT")
2930616
"^DD",358.6,358.6,.11,0)
TYPE OF HEALTH SUMMARY^*P142'^GMT(142,^0;11^S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",358.6,358.6,.11,3)
Which Health Summary do you want printed?
"^DD",358.6,358.6,.11,12)
EXCLUDES AD HOC HEALTH SUMMARIES
"^DD",358.6,358.6,.11,12.1)
S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"^DD",358.6,358.6,.11,21,0)
^^4^4^2940224^
"^DD",358.6,358.6,.11,21,1,0)
 
"^DD",358.6,358.6,.11,21,2,0)
This identifies the Health Summary that should be printed when this
"^DD",358.6,358.6,.11,21,3,0)
Package Interface is invoked. It should be null unless the HEALTH SUMMARY?
"^DD",358.6,358.6,.11,21,4,0)
field #.1 is coded YES.
"^DD",358.6,358.6,.11,"DT")
2930617
"^DD",358.6,358.6,.12,0)
TOOLKIT MEMBER?^S^0:NO;1:YES;^0;12^Q
"^DD",358.6,358.6,.12,.1)
SHOULD THIS PACKAGE INTERFACE BE PART OF THE TOOLKIT?
"^DD",358.6,358.6,.12,3)
Enter YES if this PACKAGE INTERFACE was added by the package developers as part of the toolkit, enter NO otherwise.
"^DD",358.6,358.6,.12,21,0)
^^3^3^2950808^^
"^DD",358.6,358.6,.12,21,1,0)
 
"^DD",358.6,358.6,.12,21,2,0)
Package Interfaces that are developed for national use will be documented
"^DD",358.6,358.6,.12,21,3,0)
as being part of the toolkit.
"^DD",358.6,358.6,.12,"DT")
2950711
"^DD",358.6,358.6,.13,0)
PACKAGE INTERFACE FOR INPUT^*P358.6'^IBE(358.6,^0;13^S DIC("S")="I $P(^(0),U,6)=1,$P(^(0),U,9)=1,$P(^(0),U,16)[""S""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",358.6,358.6,.13,.1)
WHICH INTERFACE SHOULD THIS LIST USE FOR PASSING DATA TO THE DATA BASE?
"^DD",358.6,358.6,.13,3)
What interface should be used for inputting data entered on the selection list?
"^DD",358.6,358.6,.13,12)
Must be an available interfaces for accepting input from selection lists.
"^DD",358.6,358.6,.13,12.1)
S DIC("S")="I $P(^(0),U,6)=1,$P(^(0),U,9)=1,$P(^(0),U,16)[""S"""
"^DD",358.6,358.6,.13,21,0)
^^1^1^2950825^^^^
"^DD",358.6,358.6,.13,21,1,0)
Used to map scanned data to DHCP.
"^DD",358.6,358.6,.13,"DT")
2950825
"^DD",358.6,358.6,.14,0)
DYNAMIC SELECTIONS^S^0:NO;1:YES;^0;14^Q
"^DD",358.6,358.6,.14,3)
Only for selection routines. Enter YES if the Package Interface builds the selection list each time the form is printed.
"^DD",358.6,358.6,.14,21,0)
^^2^2^2950719^
"^DD",358.6,358.6,.14,21,1,0)
This is used to indicate whether the interface is used to build selection
"^DD",358.6,358.6,.14,21,2,0)
lists at print time.
"^DD",358.6,358.6,.14,"DT")
2941221
"^DD",358.6,358.6,.15,0)
DO NOT USE DFN AS A SUBSCRIPT^*S^0:NO;1:YES;^0;15^Q
"^DD",358.6,358.6,.15,3)
If the patient DFN should not be used as a subscript when passing data enter YES.
"^DD",358.6,358.6,.15,12)
If the action type is not OUTPUT ROUTINE then this field should not be set to NO.
"^DD",358.6,358.6,.15,12.1)
S DIC("S")="I (Y=1)!($P(^IBE(358.6,DA,0),U,6)=2)"
"^DD",358.6,358.6,.15,21,0)
^^6^6^2950413^^^^
"^DD",358.6,358.6,.15,21,1,0)
Originally, the patient DFN was used as a subscript when returning data
"^DD",358.6,358.6,.15,21,2,0)
for Package Interfaces of type output, but not for other types of
"^DD",358.6,358.6,.15,21,3,0)
interfaces. It is no longer necessary for any new Package Interface to use
"^DD",358.6,358.6,.15,21,4,0)
DFN as a subscript, but, to maintain compatibilty, output routines
"^DD",358.6,358.6,.15,21,5,0)
must set this field to YES if DFN is not to be used as a subscript. This
"^DD",358.6,358.6,.15,21,6,0)
field has no effect on other types of interfaces.
"^DD",358.6,358.6,.15,"DT")
2950413
"^DD",358.6,358.6,.16,0)
ALLOWED OBJECT USE^FX^^0;16^S X=$$UPPER^VALM1(X) K:$L(X)>4!("SMHP"'[$E(X,1))!("SMHP"'[$E(X,2))!("SMHP"'[$E(X,3))!("SMHP"'[$E(X,4)) X
"^DD",358.6,358.6,.16,3)

"^DD",358.6,358.6,.16,4)
D HELP7^IBDFU5A
"^DD",358.6,358.6,.16,21,0)
^^5^5^2950913^^^^
"^DD",358.6,358.6,.16,21,1,0)
This field applies only to package interfaces for input and is used to
"^DD",358.6,358.6,.16,21,2,0)
determine which package interfaces a particular type of form object may
"^DD",358.6,358.6,.16,21,3,0)
point to. Some combinations don't make sense. For example, it would not
"^DD",358.6,358.6,.16,21,4,0)
make sense to allow a multiple choice question to point to vitals, which
"^DD",358.6,358.6,.16,21,5,0)
is used to input data such as temperature and blood pressure.
"^DD",358.6,358.6,.16,"DT")
2950913
"^DD",358.6,358.6,.17,0)
ASK FOR ADDITIONAL NARRATIVE^S^0:NO;1:YES;^0;17^Q
"^DD",358.6,358.6,.17,3)
Answer yes or no.
"^DD",358.6,358.6,.17,21,0)
^^8^8^2960123^
"^DD",358.6,358.6,.17,21,1,0)
Enter whether users should be prompted for specifying the provider
"^DD",358.6,358.6,.17,21,2,0)
narrative that will be sent to PCE (and problem list) when creating a
"^DD",358.6,358.6,.17,21,3,0)
selection list.  If this is answered no and the narrative is sent to
"^DD",358.6,358.6,.17,21,4,0)
PCE then the text as it appears on the form will be used as the
"^DD",358.6,358.6,.17,21,5,0)
provider narrative.
"^DD",358.6,358.6,.17,21,6,0)
 
"^DD",358.6,358.6,.17,21,7,0)
Generally only diagnosis and clinical lexicon entries will want this
"^DD",358.6,358.6,.17,21,8,0)
field set to Yes.
"^DD",358.6,358.6,.17,"DT")
2960123
"^DD",358.6,358.6,.18,0)
ASK FOR CLINICAL LEXICON^S^0:NO;1:YES;^0;18^Q
"^DD",358.6,358.6,.18,3)
 Enter 'Yes' if you want to map entries from this interface to the clinical lexicon.
"^DD",358.6,358.6,.18,21,0)
^^10^10^2960205^
"^DD",358.6,358.6,.18,21,1,0)
If this field is answered 'Yes' then users who are editing or creating
"^DD",358.6,358.6,.18,21,2,0)
selection lists based on this interface will be asked to map each entry
"^DD",358.6,358.6,.18,21,3,0)
(thought it is optional) to a clinical lexicon entry.  This is highly
"^DD",358.6,358.6,.18,21,4,0)
recommended for user who are scanning diagnosis entries and trying to 
"^DD",358.6,358.6,.18,21,5,0)
add entries to the Patients Problem list.
"^DD",358.6,358.6,.18,21,6,0)
 
"^DD",358.6,358.6,.18,21,7,0)
The primary purpose of this field is to allow sites who have built selection
"^DD",358.6,358.6,.18,21,8,0)
lists using the ICD9 Diagnosis file to map each entry to the clinical lexicon.
"^DD",358.6,358.6,.18,21,9,0)
The Problem List EP has recommended that each problem added to the problem
"^DD",358.6,358.6,.18,21,10,0)
list be associated with a clinical lexicon entry.
"^DD",358.6,358.6,.18,"DT")
2960205
"^DD",358.6,358.6,.19,0)
DQ REQUIRED^S^1:YES;^0;19^Q
"^DD",358.6,358.6,.19,21,0)
^^2^2^2960212^
"^DD",358.6,358.6,.19,21,1,0)
Field used to determine if a data qualifier is required for this
"^DD",358.6,358.6,.19,21,2,0)
input interface.
"^DD",358.6,358.6,.19,"DT")
2960212
"^DD",358.6,358.6,.2,0)
ASK FOR CLINICAL REMINDERS^S^0:NO;1:YES;^0;20^Q
"^DD",358.6,358.6,.2,3)
If this package interface is for display of clinical reminders answer yes, otherwise answer no.
"^DD",358.6,358.6,.2,21,0)
^^2^2^2990122^^^^
"^DD",358.6,358.6,.2,21,1,0)
If this package interface is for display of clinical reminders answer yes, 
"^DD",358.6,358.6,.2,21,2,0)
otherwise answer no.
"^DD",358.6,358.6,.2,"DT")
2971015
"^DD",358.6,358.6,.21,0)
ASK FOR CPT MODIFIERS?^S^0:NO;1:YES;^0;21^Q
"^DD",358.6,358.6,.21,3)
If this package interface is to prompt for CPT Modifiers, answer yes, otherwise answer no.
"^DD",358.6,358.6,.21,21,0)
^^3^3^3000124^
"^DD",358.6,358.6,.21,21,1,0)
ASK FOR CPT MODIFIERS field will be used when selecting CPT codes.  If
"^DD",358.6,358.6,.21,21,2,0)
answered "YES" and data is a procedure, CPT Modifiers should be asked
"^DD",358.6,358.6,.21,21,3,0)
during Forms Design and Manual Data Entry.
"^DD",358.6,358.6,.21,"DT")
3000124
"^DD",358.6,358.6,1,0)
DESCRIPTION^358.61^^1;0
"^DD",358.6,358.6,1,21,0)
^^1^1^2950719^^^^
"^DD",358.6,358.6,1,21,1,0)
Should describe the data being exchanged by the package interface.
"^DD",358.6,358.6,2.01,0)
PIECE 1 DESCRIPTIVE NAME^F^^2;1^K:$L(X)>30!($L(X)<3) X
"^DD",358.6,358.6,2.01,.1)
WHAT IS THE FIRST PIECE OF DATA RETURNED BY THE INTERFACE?
"^DD",358.6,358.6,2.01,3)
Answer must be 3-30 characters in length.
"^DD",358.6,358.6,2.01,21,0)
^^3^3^2930527^
"^DD",358.6,358.6,2.01,21,1,0)
 
"^DD",358.6,358.6,2.01,21,2,0)
Should be a descriptive name of the first field in the record returned by
"^DD",358.6,358.6,2.01,21,3,0)
the interface.
"^DD",358.6,358.6,2.01,"DT")
2930726
"^DD",358.6,358.6,2.02,0)
PIECE 1 MAXIMUM LENGTH^NJ3,0^^2;2^K:+X'=X!(X>210)!(X<0)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,2.02,.1)
WHAT IS ITS MAXIMUM LENGTH?
"^DD",358.6,358.6,2.02,3)
Type a Number between 0 and 210, 0 Decimal Digits
"^DD",358.6,358.6,2.02,21,0)
^^3^3^2930527^
"^DD",358.6,358.6,2.02,21,1,0)
 
"^DD",358.6,358.6,2.02,21,2,0)
The maximum length of the first field of the record returned by the
"^DD",358.6,358.6,2.02,21,3,0)
interface.
"^DD",358.6,358.6,2.02,"DT")
2930726
"^DD",358.6,358.6,2.03,0)
PIECE 2 DESCRIPTIVE NAME^F^^2;3^K:$L(X)>30!($L(X)<3) X
"^DD",358.6,358.6,2.03,.1)
WHAT IS THE SECOND PIECE OF DATA RETURNED BY THE INTERFACE?
"^DD",358.6,358.6,2.03,3)
Answer must be 3-30 characters in length.
"^DD",358.6,358.6,2.03,21,0)
^^3^3^2930528^
"^DD",358.6,358.6,2.03,21,1,0)
 
"^DD",358.6,358.6,2.03,21,2,0)
A descriptive name of the second field of the record returned by the
"^DD",358.6,358.6,2.03,21,3,0)
interface routine.
"^DD",358.6,358.6,2.03,"DT")
2930726
"^DD",358.6,358.6,2.04,0)
WHAT IS ITS MAXIMUM LENGTH?^NJ3,0^^2;4^K:+X'=X!(X>210)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,2.04,3)
Type a Number between 1 and 210, 0 Decimal Digits
"^DD",358.6,358.6,2.04,21,0)
^^3^3^2930528^
"^DD",358.6,358.6,2.04,21,1,0)
 
"^DD",358.6,358.6,2.04,21,2,0)
The maximum length of the second field of the record returned by the
"^DD",358.6,358.6,2.04,21,3,0)
interface routine.
"^DD",358.6,358.6,2.04,"DT")
2930726
"^DD",358.6,358.6,2.05,0)
PIECE 3 DESCRIPTIVE NAME^F^^2;5^K:$L(X)>30!($L(X)<3) X
"^DD",358.6,358.6,2.05,.1)
WHAT IS THE THIRD PIECE OF DATA RETURNED BY THE INTERFACE?
"^DD",358.6,358.6,2.05,3)
Answer must be 3-30 characters in length.
"^DD",358.6,358.6,2.05,21,0)
^^3^3^2930528^
"^DD",358.6,358.6,2.05,21,1,0)
 
"^DD",358.6,358.6,2.05,21,2,0)
A descriptive name of the third field of the record returned by the
"^DD",358.6,358.6,2.05,21,3,0)
interface routine.
"^DD",358.6,358.6,2.05,"DT")
2930726
"^DD",358.6,358.6,2.06,0)
PIECE 3 MAXIMUM LENGTH^NJ3,0^^2;6^K:+X'=X!(X>210)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,2.06,.1)
WHAT IS ITS MAXIMUM LENGTH?
"^DD",358.6,358.6,2.06,3)
Type a Number between 1 and 210, 0 Decimal Digits
"^DD",358.6,358.6,2.06,21,0)
^^2^2^2930528^
"^DD",358.6,358.6,2.06,21,1,0)
 
"^DD",358.6,358.6,2.06,21,2,0)
The maximum length of the 3rd field returned by the interface routine.
"^DD",358.6,358.6,2.06,"DT")
2930726
"^DD",358.6,358.6,2.07,0)
PIECE 4 DESCRIPTIVE NAME^F^^2;7^K:$L(X)>30!($L(X)<3) X
"^DD",358.6,358.6,2.07,.1)
WHAT IS THE FOURTH PIECE OF DATA RETURNED BY THE INTERFACE?
"^DD",358.6,358.6,2.07,3)
Answer must be 3-30 characters in length.
"^DD",358.6,358.6,2.07,21,0)
^^2^2^2930528^
"^DD",358.6,358.6,2.07,21,1,0)
 
"^DD",358.6,358.6,2.07,21,2,0)
A descriptive name of the 4th field returned by the interface routine.
"^DD",358.6,358.6,2.07,"DT")
2930726
"^DD",358.6,358.6,2.08,0)
PIECE 4 MAXIMUM LENGTH^NJ3,0^^2;8^K:+X'=X!(X>200)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,2.08,.1)
WHAT IS ITS MAXIMUM LENGTH?
"^DD",358.6,358.6,2.08,3)
Type a Number between 1 and 200, 0 Decimal Digits
"^DD",358.6,358.6,2.08,21,0)
^^2^2^2930528^
"^DD",358.6,358.6,2.08,21,1,0)
 
"^DD",358.6,358.6,2.08,21,2,0)
The maximum length of the 4th field returned by the interface routine.
"^DD",358.6,358.6,2.08,"DT")
2930726
"^DD",358.6,358.6,2.09,0)
PIECE 5 DESCRIPTIVE NAME^F^^2;9^K:$L(X)>30!($L(X)<3) X
"^DD",358.6,358.6,2.09,.1)
WHAT IS THE FIFTH PIECE OF DATA RETURNED BY THE INTERFACE?
"^DD",358.6,358.6,2.09,3)
Answer must be 3-30 characters in length.
"^DD",358.6,358.6,2.09,21,0)
^^2^2^2930528^
"^DD",358.6,358.6,2.09,21,1,0)
 
"^DD",358.6,358.6,2.09,21,2,0)
A descriptive name of the 5th field returned by the interface routine.
"^DD",358.6,358.6,2.09,"DT")
2930726
"^DD",358.6,358.6,2.1,0)
PIECE 5 MAXIMUM LENGTH^NJ3,0^^2;10^K:+X'=X!(X>210)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,2.1,.1)
WHAT IS ITS MAXIMUM LENGTH?
"^DD",358.6,358.6,2.1,3)
Type a Number between 1 and 210, 0 Decimal Digits
"^DD",358.6,358.6,2.1,21,0)
^^2^2^2930528^
"^DD",358.6,358.6,2.1,21,1,0)
 
"^DD",358.6,358.6,2.1,21,2,0)
The maximum length of the 5th field returned by the interface routine.
"^DD",358.6,358.6,2.1,"DT")
2930726
"^DD",358.6,358.6,2.11,0)
PIECE 6 DESCRIPTIVE NAME^F^^2;11^K:$L(X)>30!($L(X)<3) X
"^DD",358.6,358.6,2.11,.1)
WHAT IS THE SIXTH PIECE OF DATA RETURNED BY THE INTERFACE?
"^DD",358.6,358.6,2.11,3)
Answer must be 3-30 characters in length.
"^DD",358.6,358.6,2.11,21,0)
^^2^2^2930528^
"^DD",358.6,358.6,2.11,21,1,0)
 
"^DD",358.6,358.6,2.11,21,2,0)
A descriptive name fo the 6th field returned by the interface routine.
"^DD",358.6,358.6,2.11,"DT")
2930726
"^DD",358.6,358.6,2.12,0)
PIECE 6 MAXIMUM LENGTH^NJ3,0^^2;12^K:+X'=X!(X>210)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,2.12,.1)
WHAT IS ITS MAXIMUM LENGTH?
"^DD",358.6,358.6,2.12,3)
Type a Number between 1 and 210, 0 Decimal Digits
"^DD",358.6,358.6,2.12,21,0)
^^2^2^2930528^
"^DD",358.6,358.6,2.12,21,1,0)
 
"^DD",358.6,358.6,2.12,21,2,0)
The maximum length of the 6th field returned by the interface routine.
"^DD",358.6,358.6,2.12,"DT")
2930726
"^DD",358.6,358.6,2.13,0)
PIECE 7 DESCRIPTIVE NAME^F^^2;13^K:$L(X)>30!($L(X)<3) X
"^DD",358.6,358.6,2.13,.1)
WHAT IS THE SEVENTH PIECE OF DATA RETURNED BY THE INTERFACE?
"^DD",358.6,358.6,2.13,3)
Answer must be 3-30 characters in length.
"^DD",358.6,358.6,2.13,21,0)
^^3^3^2930528^
"^DD",358.6,358.6,2.13,21,1,0)
 
"^DD",358.6,358.6,2.13,21,2,0)
A descriptive name for the 7th field returned by the package interface
"^DD",358.6,358.6,2.13,21,3,0)
routine.
"^DD",358.6,358.6,2.13,"DT")
2930726
"^DD",358.6,358.6,2.14,0)
PIECE 7 MAXIMUM LENGTH^NJ3,0^^2;14^K:+X'=X!(X>210)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,2.14,.1)
WHAT IS ITS MAXIMUM LENGTH?
"^DD",358.6,358.6,2.14,3)
Type a Number between 1 and 210, 0 Decimal Digits
"^DD",358.6,358.6,2.14,21,0)
^^2^2^2930528^
"^DD",358.6,358.6,2.14,21,1,0)
 
"^DD",358.6,358.6,2.14,21,2,0)
The maximum length of the 7th field returned by the interface routine.
"^DD",358.6,358.6,2.14,"DT")
2930726
"^DD",358.6,358.6,2.16,0)
PIECE 1 RECOMMENDED HEADER^F^^2;16^K:$L(X)>20!($L(X)<1) X
"^DD",358.6,358.6,2.16,3)
Answer must be 1-20 characters in length.
"^DD",358.6,358.6,2.16,21,0)
^^1^1^2950719^
"^DD",358.6,358.6,2.16,21,1,0)
The recommended header will be used as the default when designing a form.
"^DD",358.6,358.6,2.16,"DT")
2950417
"^DD",358.6,358.6,2.17,0)
IS PIECE 1 DISPLAYABLE?^S^0:NO;1:YES;^2;17^Q
"^DD",358.6,358.6,2.17,.1)
CAN THIS FIELD BE DISPLAYED TO THE USER?
"^DD",358.6,358.6,2.17,3)
The first piece of the returned record is reserved for the unique id of the selection. Enter no if it should not be displayed, for example, if it is a pointer.
"^DD",358.6,358.6,2.17,21,0)
^^3^3^2950719^^
"^DD",358.6,358.6,2.17,21,1,0)
This is used only for selection type interfaces. If NO, then the value can
"^DD",358.6,358.6,2.17,21,2,0)
not be displayed to the encounter form.  The first piece must contain the
"^DD",358.6,358.6,2.17,21,3,0)
unique id of the selection.
"^DD",358.6,358.6,2.17,"DT")
2930810
"^DD",358.6,358.6,2.18,0)
EXPORT SELECTIONS/CHOICES?^S^0:NO;1:YES;^2;18^Q
"^DD",358.6,358.6,2.18,3)
Enter NO if the ID returned by the PACKAGE INTERFACE is not constant between sites, for example, if it is a pointer. Otherwise answer YES.
"^DD",358.6,358.6,2.18,21,0)
^^8^8^2950825^
"^DD",358.6,358.6,2.18,21,1,0)
 
"^DD",358.6,358.6,2.18,21,2,0)
 
"^DD",358.6,358.6,2.18,21,3,0)
Applies to selection and input routines. Determines whether
"^DD",358.6,358.6,2.18,21,4,0)
selections appearing on selection lists and choices in a multiple choice
"^DD",358.6,358.6,2.18,21,5,0)
field will be exported along with the form that they appear on. The
"^DD",358.6,358.6,2.18,21,6,0)
import/export utility will not resolve pointers, so if the id used by
"^DD",358.6,358.6,2.18,21,7,0)
the package interface is a pointer that differs between sites
"^DD",358.6,358.6,2.18,21,8,0)
this field should contain NO.
"^DD",358.6,358.6,2.18,"DT")
2950825
"^DD",358.6,358.6,3,0)
USER LOOKUP^F^^3;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>240!($L(X)<1) X
"^DD",358.6,358.6,3,.1)
LIST OF WORDS TO MAKE LOOK-UPS EASIER
"^DD",358.6,358.6,3,1,0)
^.1
"^DD",358.6,358.6,3,1,1,0)
358.6^D^KWIC
"^DD",358.6,358.6,3,1,1,1)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2,^DD("KWIC")'[I S ^IBE(358.6,"D",I,DA)=""
"^DD",358.6,358.6,3,1,1,2)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2 K ^IBE(358.6,"D",I,DA)
"^DD",358.6,358.6,3,1,1,"%D",0)
^^3^3^2930409^^
"^DD",358.6,358.6,3,1,1,"%D",1,0)
 
"^DD",358.6,358.6,3,1,1,"%D",2,0)
This index is meant to assist the user in locating the correct package
"^DD",358.6,358.6,3,1,1,"%D",3,0)
interface needed to display a particular item of data to a form.
"^DD",358.6,358.6,3,1,1,"DT")
2930309
"^DD",358.6,358.6,3,3)
Enter words separated with spaces. They will be indexed to assist in lookup.
"^DD",358.6,358.6,3,4)
D LOOKUP^IBDF16
"^DD",358.6,358.6,3,21,0)
^^4^4^2940217^
"^DD",358.6,358.6,3,21,1,0)
 
"^DD",358.6,358.6,3,21,2,0)
This field is used to create a KWIC index for this file. The purpose is to
"^DD",358.6,358.6,3,21,3,0)
assist the user in locating the package interface he needs to display a
"^DD",358.6,358.6,3,21,4,0)
particular item of data to a form.
"^DD",358.6,358.6,3,"DT")
2930726
"^DD",358.6,358.6,4.01,0)
ENTRY ACTION^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",358.6,358.6,4.01,3)
This is Standard MUMPS code.
"^DD",358.6,358.6,4.01,9)
@
"^DD",358.6,358.6,4.01,21,0)
^^3^3^2930527^
"^DD",358.6,358.6,4.01,21,1,0)
 
"^DD",358.6,358.6,4.01,21,2,0)
This code will be executed after the PROTECTED VARIABLES are newed, but
"^DD",358.6,358.6,4.01,21,3,0)
before the interface routine is called.
"^DD",358.6,358.6,4.01,"DT")
2930521
"^DD",358.6,358.6,5.01,0)
EXIT ACTION^K^^5;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",358.6,358.6,5.01,3)
This is Standard MUMPS code.
"^DD",358.6,358.6,5.01,9)
@
"^DD",358.6,358.6,5.01,21,0)
^^3^3^2930528^
"^DD",358.6,358.6,5.01,21,1,0)
 
"^DD",358.6,358.6,5.01,21,2,0)
This code will be executed after the interface routine is called.
"^DD",358.6,358.6,5.01,21,3,0)
The effect of the NEW done on the PROTECTED VARIABLES is still in effect.
"^DD",358.6,358.6,5.01,"DT")
2930518
"^DD",358.6,358.6,6,0)
PROTECTED LOCAL VARIABLES^358.66^^6;0
"^DD",358.6,358.6,6,21,0)
^^11^11^2950719^^^
"^DD",358.6,358.6,6,21,1,0)
 
"^DD",358.6,358.6,6,21,2,0)
This is a list of variables that should be newed before the entry action
"^DD",358.6,358.6,6,21,3,0)
or calling the interface routine. It is protection against interfaces that
"^DD",358.6,358.6,6,21,4,0)
alter or kill variables, or entry actions that do so. Note that REQUIRED
"^DD",358.6,358.6,6,21,5,0)
VARIABLES should not also be PROTECTED VARIABLES. If an interface routine
"^DD",358.6,358.6,6,21,6,0)
changes a required variable, however, there is a way to protect it.
"^DD",358.6,358.6,6,21,7,0)
Supposing, for example, DFN is killed by the interface. This will protect
"^DD",358.6,358.6,6,21,8,0)
it:
"^DD",358.6,358.6,6,21,9,0)
     PROTECTED VARIABLE:   IBDFN
"^DD",358.6,358.6,6,21,10,0)
     ENTRY ACTION:  S IBDFN=DFN
"^DD",358.6,358.6,6,21,11,0)
     EXIT ACTION:   S DFN=IBDFN
"^DD",358.6,358.6,7,0)
REQUIRED LOCAL VARIABLES^358.67^^7;0
"^DD",358.6,358.6,7,21,0)
^^4^4^2930528^
"^DD",358.6,358.6,7,21,1,0)
 
"^DD",358.6,358.6,7,21,2,0)
The interface may require inputs. This field is a list of the required
"^DD",358.6,358.6,7,21,3,0)
local variables. The interface will not be called unless the variables are
"^DD",358.6,358.6,7,21,4,0)
determined to exist.
"^DD",358.6,358.6,8.01,0)
PIECE 1 NODE^F^^8;1^K:$L(X)>10!($L(X)<1) X
"^DD",358.6,358.6,8.01,3)
Answer must be 1-10 characters in length.
"^DD",358.6,358.6,8.01,"DT")
2931203
"^DD",358.6,358.6,8.02,0)
PIECE 2 NODE^F^^8;2^K:$L(X)>10!($L(X)<1) X
"^DD",358.6,358.6,8.02,3)
Answer must be 1-10 characters in length.
"^DD",358.6,358.6,8.02,"DT")
2931203
"^DD",358.6,358.6,8.03,0)
PIECE 3 NODE^F^^8;3^K:$L(X)>10!($L(X)<1) X
"^DD",358.6,358.6,8.03,3)
Answer must be 1-10 characters in length.
"^DD",358.6,358.6,8.03,"DT")
2931203
"^DD",358.6,358.6,8.04,0)
PIECE 4 NODE^F^^8;4^K:$L(X)>10!($L(X)<1) X
"^DD",358.6,358.6,8.04,3)
Answer must be 1-10 characters in length.
"^DD",358.6,358.6,8.04,"DT")
2931203
"^DD",358.6,358.6,8.05,0)
PIECE 5 NODE^F^^8;5^K:$L(X)>10!($L(X)<1) X
"^DD",358.6,358.6,8.05,3)
Answer must be 1-10 characters in length.
"^DD",358.6,358.6,8.05,"DT")
2931203
"^DD",358.6,358.6,8.06,0)
PIECE 6 NODE^F^^8;6^K:$L(X)>10!($L(X)<1) X
"^DD",358.6,358.6,8.06,3)
Answer must be 1-10 characters in length.
"^DD",358.6,358.6,8.06,"DT")
2931203
"^DD",358.6,358.6,8.07,0)
PIECE 7 NODE^F^^8;7^K:$L(X)>10!($L(X)<1) X
"^DD",358.6,358.6,8.07,3)
Answer must be 1-10 characters in length.
"^DD",358.6,358.6,8.07,"DT")
2931203
"^DD",358.6,358.6,9,0)
PCE DIM INPUT TRANSFORM^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",358.6,358.6,9,3)
The input transform should transform X to the value that should be passed.
"^DD",358.6,358.6,9,9)
@
"^DD",358.6,358.6,9,21,0)
^^3^3^2960401^^^^
"^DD",358.6,358.6,9,21,1,0)
Used to transform X, the identifier stored with the form object, to the
"^DD",358.6,358.6,9,21,2,0)
form that should be passed to the PCE Device Interface Module (DIM). It may,
"^DD",358.6,358.6,9,21,3,0)
for example, transform a code to an ien.
"^DD",358.6,358.6,9,"DT")
2960401
"^DD",358.6,358.6,10,0)
HELP TEXT^F^^10;1^K:$L(X)>245!($L(X)<1) X
"^DD",358.6,358.6,10,3)
This should provide some help to the user who is trying to enter a value associated with a bubble.
"^DD",358.6,358.6,10,21,0)
^^2^2^2950817^^^
"^DD",358.6,358.6,10,21,1,0)
This should provide some help to the user who is trying to enter a value
"^DD",358.6,358.6,10,21,2,0)
associated with a bubble.
"^DD",358.6,358.6,10,"DT")
2950522
"^DD",358.6,358.6,11,0)
VALIDATOR^K^^11;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",358.6,358.6,11,3)
This is Standard MUMPS code will kill X if X no longer identifies a valid code.
"^DD",358.6,358.6,11,9)
@
"^DD",358.6,358.6,11,21,0)
^^7^7^2950825^
"^DD",358.6,358.6,11,21,1,0)
This field is used to validate codes currently on a form. The variable X
"^DD",358.6,358.6,11,21,2,0)
should be set to the identifier that was returned by the Package
"^DD",358.6,358.6,11,21,3,0)
Interface. For selection interfaces, the identifier is always piece 1 of
"^DD",358.6,358.6,11,21,4,0)
the 0 node of the entry in the selection list. Xecuting this field will
"^DD",358.6,358.6,11,21,5,0)
result in X being killed if the value is not valid. This is used by the
"^DD",358.6,358.6,11,21,6,0)
maintanance utility, for example, to find CPT codes that have been
"^DD",358.6,358.6,11,21,7,0)
inactivated.
"^DD",358.6,358.6,11,"DT")
2950908
"^DD",358.6,358.6,12.01,0)
PCE DIM NODE^F^^12;1^K:$L(X)>30!($L(X)<1) X
"^DD",358.6,358.6,12.01,3)
What node will be used to pass the data?
"^DD",358.6,358.6,12.01,21,0)
^^1^1^2960401^^
"^DD",358.6,358.6,12.01,21,1,0)
The node used to pass the data to PCE, using the PCE DEVICE INTERFACE MODULE.
"^DD",358.6,358.6,12.01,"DT")
2960401
"^DD",358.6,358.6,12.02,0)
PCE DIM PIECE, VALUE^NJ2,0^^12;2^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,12.02,3)
What piece should be used to pass the value?
"^DD",358.6,358.6,12.02,21,0)
^^1^1^2960401^^^
"^DD",358.6,358.6,12.02,21,1,0)
The piece in the PXCA node used to pass the input value.
"^DD",358.6,358.6,12.02,"DT")
2960401
"^DD",358.6,358.6,12.03,0)
PCE DIM PIECE, NARRATIVE^NJ2,0^^12;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,12.03,3)
What piece should be used to pass the text displayed on the form?
"^DD",358.6,358.6,12.03,21,0)
^^1^1^2960401^^^^
"^DD",358.6,358.6,12.03,21,1,0)
The piece in the PCXA node used to pass the text displayed on the form.
"^DD",358.6,358.6,12.03,"DT")
2960401
"^DD",358.6,358.6,12.04,0)
PCE DIM PIECE, HEADER^NJ2,0^^12;4^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,12.04,3)
What piece should be used to pass the header displayed on the form?
"^DD",358.6,358.6,12.04,21,0)
^^2^2^2960401^^
"^DD",358.6,358.6,12.04,21,1,0)
The piece on the node specified by the PCE Device Interface Module
"^DD",358.6,358.6,12.04,21,2,0)
that the header is mapped to.
"^DD",358.6,358.6,12.04,"DT")
2960401
"^DD",358.6,358.6,12.05,0)
PCE DIM PIECE, DATA QUALIFIER^NJ2,0^^12;5^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,12.05,3)
What piece should be used to pass the data qualifier?
"^DD",358.6,358.6,12.05,21,0)
^^1^1^2960401^^^
"^DD",358.6,358.6,12.05,21,1,0)
The piece of the PXCA node where the data modifier belongs.
"^DD",358.6,358.6,12.05,"DT")
2960401
"^DD",358.6,358.6,12.06,0)
PCE DIM PIECE, QUANTITY^NJ2,0^^12;6^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.6,12.06,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",358.6,358.6,12.06,21,0)
^^2^2^2961031^
"^DD",358.6,358.6,12.06,21,1,0)
An entry in this field indicates which piece of the array the quantity
"^DD",358.6,358.6,12.06,21,2,0)
should be passed on when sending data to PCE.
"^DD",358.6,358.6,12.06,"DT")
2961031
"^DD",358.6,358.6,13,0)
ALLOWABLE QUALIFIERS^358.613V^^13;0
"^DD",358.6,358.6,13,21,0)
^^2^2^2980928^^^^
"^DD",358.6,358.6,13,21,1,0)
This mulitiple contains the list of quailifiers that may apply to the
"^DD",358.6,358.6,13,21,2,0)
data.
"^DD",358.6,358.6,14,0)
PCE DIM OUTPUT TRANSFORM^K^^14;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",358.6,358.6,14,3)
This should change Y, the value to be passed, to a value suitable for display.
"^DD",358.6,358.6,14,9)
@
"^DD",358.6,358.6,14,21,0)
^^3^3^2960401^^
"^DD",358.6,358.6,14,21,1,0)
This transform should set Y, the value to be passed to the PCE 
"^DD",358.6,358.6,14,21,2,0)
Device Interface Module, to a value that is suitable for display.
"^DD",358.6,358.6,14,21,3,0)
It may, for example, change an ien to a code.
"^DD",358.6,358.6,14,"DT")
2960401
"^DD",358.6,358.6,15,0)
DATA DESCRIPTION^358.615I^^15;0
"^DD",358.6,358.6,15,21,0)
^^2^2^2950330^
"^DD",358.6,358.6,15,21,1,0)
For interfaces that return records, this multiple stores information on
"^DD",358.6,358.6,15,21,2,0)
the fields, other than the first field.
"^DD",358.6,358.6,16.1,0)
ALLOW INPUT OF NARRATIVE?^S^n:NO;o:OPTIONAL;r:REQUIRED;^16;1^Q
"^DD",358.6,358.6,16.1,3)
Should the user be allowed to enter a narrative? Answer n=NO, o=OPTIONAL, r=REQUIRED
"^DD",358.6,358.6,16.1,21,0)
^^2^2^2950719^
"^DD",358.6,358.6,16.1,21,1,0)
For input interfaces, this field determines whether a narrative is
"^DD",358.6,358.6,16.1,21,2,0)
allowed by the PCE Generic Device Interface.
"^DD",358.6,358.6,16.1,"DT")
2950421
"^DD",358.6,358.6,16.2,0)
NARRATIVE DATA TYPE^P358.99'^IBE(358.99,^16;2^Q
"^DD",358.6,358.6,16.2,3)
What data type definition describes the narrative?
"^DD",358.6,358.6,16.2,21,0)
^^2^2^2951018^^
"^DD",358.6,358.6,16.2,21,1,0)
This determines, among other things, how much space to allocate for the
"^DD",358.6,358.6,16.2,21,2,0)
narrative.
"^DD",358.6,358.6,16.2,"DT")
2951018
"^DD",358.6,358.6,16.3,0)
NARRATIVE HEADER^F^^16;3^K:$L(X)>40!($L(X)<1) X
"^DD",358.6,358.6,16.3,3)
Answer must be 1-40 characters in length.
"^DD",358.6,358.6,16.3,21,0)
^^1^1^2950825^
"^DD",358.6,358.6,16.3,21,1,0)
Used to label the narrative field.
"^DD",358.6,358.6,16.3,"DT")
2950815
"^DD",358.6,358.6,16.5,0)
ALLOW INPUT OF PRIMARY VALUE?^S^n:NO;o:OPTIONAL;r:REQUIRED;^16;5^Q
"^DD",358.6,358.6,16.5,3)
Should a code be entered? n=NO, o=OPTIONAL, r=REQUIRED
"^DD",358.6,358.6,16.5,21,0)
^^2^2^2950719^
"^DD",358.6,358.6,16.5,21,1,0)
This applies only to interfaces for input and determines whether a
"^DD",358.6,358.6,16.5,21,2,0)
value, other than a narrative, can be entered.
"^DD",358.6,358.6,16.5,"DT")
2950426
"^DD",358.6,358.6,16.6,0)
PRIMARY VALUE DATA TYPE^P358.99'^IBE(358.99,^16;6^Q
"^DD",358.6,358.6,16.6,3)
What type of data is the primary value?
"^DD",358.6,358.6,16.6,21,0)
^^2^2^2951018^^^
"^DD",358.6,358.6,16.6,21,1,0)
This applies only to interfaces for input and determines, among other
"^DD",358.6,358.6,16.6,21,2,0)
things, the data type of the value to be entered.
"^DD",358.6,358.6,16.6,"DT")
2950914
"^DD",358.6,358.6,16.7,0)
PRIMARY VALUE HEADER^F^^16;7^K:$L(X)>40!($L(X)<1) X
"^DD",358.6,358.6,16.7,3)
Answer must be 1-40 characters in length.
"^DD",358.6,358.6,16.7,21,0)
^^1^1^2950815^
"^DD",358.6,358.6,16.7,21,1,0)
Used to label the primary value field.
"^DD",358.6,358.6,16.7,"DT")
2950815
"^DD",358.6,358.6,16.8,0)
ALLOW MULTIPLIERS^S^1:YES;^16;8^Q
"^DD",358.6,358.6,16.8,3)
Enter yes if this interface will allow entry of quantity at form development time.
"^DD",358.6,358.6,16.8,21,0)
^^3^3^2961031^
"^DD",358.6,358.6,16.8,21,1,0)
For selection interfaces, this determines whether 'quantity' should be
"^DD",358.6,358.6,16.8,21,2,0)
asked at form development time to pass multiple occurrences of a selection
"^DD",358.6,358.6,16.8,21,3,0)
to PCE.
"^DD",358.6,358.6,16.8,"DT")
2961031
"^DD",358.6,358.6,16.9,0)
ALLOW INPUT OF MULTIPLE CODES?^S^1:YES;^16;9^Q
"^DD",358.6,358.6,16.9,3)
Enter a 1 for 'YES'.
"^DD",358.6,358.6,16.9,21,0)
^^4^4^2961031^
"^DD",358.6,358.6,16.9,21,1,0)
Enter a one in this field if the users will be allowed to add more than
"^DD",358.6,358.6,16.9,21,2,0)
one code to pass along to PCE when one entry is bubbled.
"^DD",358.6,358.6,16.9,21,3,0)
Data in this field REQUIRES that field 17 be populated with mumps code
"^DD",358.6,358.6,16.9,21,4,0)
that will allow selection of the code if the entry is edited.
"^DD",358.6,358.6,16.9,"DT")
2961031
"^DD",358.6,358.6,17,0)
SELECTOR^K^^17;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",358.6,358.6,17,3)
Enter mumps code that will allow the form designer to add a choice to a multiple choice field.
"^DD",358.6,358.6,17,9)
@
"^DD",358.6,358.6,17,21,0)
^^9^9^2950908^^
"^DD",358.6,358.6,17,21,1,0)
This field only applies to input interfaces. It is executed as by an input
"^DD",358.6,358.6,17,21,2,0)
transform when creating a multiple choice field. It should:
"^DD",358.6,358.6,17,21,3,0)
1) Kill X if an nothing is selected, otherwise set X to a value suitable
"^DD",358.6,358.6,17,21,4,0)
for display, perhaps the code.
"^DD",358.6,358.6,17,21,5,0)
2) Set IBLABEL to a suitable label for the choice.
"^DD",358.6,358.6,17,21,6,0)
3) Set IBID to an identifier. The identifier should ideally be exportable,
"^DD",358.6,358.6,17,21,7,0)
meaning the same from site to site. This usually means a coded value
"^DD",358.6,358.6,17,21,8,0)
rather than an ien. The identfier should match that of a corresponding
"^DD",358.6,358.6,17,21,9,0)
selection interface, if there is one.
"^DD",358.6,358.6,17,"DT")
2950908
"^DD",358.6,358.6,18,0)
MANUAL DATA ENTRY ROUTINE^K^^18;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",358.6,358.6,18,3)
Enter the code to be executed during manual data entry for this interface.  This is Standard MUMPS code.
"^DD",358.6,358.6,18,9)
@
"^DD",358.6,358.6,18,21,0)
^^7^7^2960123^
"^DD",358.6,358.6,18,21,1,0)
This field should only be completed for input package interfaces.  This
"^DD",358.6,358.6,18,21,2,0)
code will be executed to provide quick data entry for a user trying to
"^DD",358.6,358.6,18,21,3,0)
input data for a form.  It is expected that the output of this field will
"^DD",358.6,358.6,18,21,4,0)
be used to format the PXCA array prior to calling PCE to file the data
"^DD",358.6,358.6,18,21,5,0)
for the encounter.
"^DD",358.6,358.6,18,21,6,0)
Developers writing routines for this entry should provide a roll and
"^DD",358.6,358.6,18,21,7,0)
scroll interface for manual entry of items only on the form.
"^DD",358.6,358.6,18,"DT")
2960123
"^DD",358.6,358.6,19,0)
EXTERNAL DISPLAY VALUES^K^^19;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",358.6,358.6,19,3)
This is Standard MUMPS code.
"^DD",358.6,358.6,19,9)
@
"^DD",358.6,358.6,19,21,0)
^^5^5^2960214^
"^DD",358.6,358.6,19,21,1,0)
Executable code used to translate the internal value that is to
"^DD",358.6,358.6,19,21,2,0)
be passed to PCE into its external value for display purposes.  It
"^DD",358.6,358.6,19,21,3,0)
is used by the data validation routines to display the external
"^DD",358.6,358.6,19,21,4,0)
values and descriptions of the data to be passed, to the user
"^DD",358.6,358.6,19,21,5,0)
for verification.
"^DD",358.6,358.6,19,"DT")
2960214
"^DD",358.6,358.6,20,0)
PASS DQ AS VALUE^S^1:YES;^20;1^Q
"^DD",358.6,358.6,20,3)
Enter Yes if the Data Qualifier should be passed as the Value when sending data to PCE.
"^DD",358.6,358.6,20,21,0)
^^7^7^2961031^
"^DD",358.6,358.6,20,21,1,0)
If the value of the Data Qualifier shall be passed to PCE as the VALUE,
"^DD",358.6,358.6,20,21,2,0)
this field should be set to one.  Doing so will prevent the data in the
"^DD",358.6,358.6,20,21,3,0)
VALUE from populating the PCE DIM NODE, but instead, will allow the Data
"^DD",358.6,358.6,20,21,4,0)
Qualifier to pass as the VALUE.
"^DD",358.6,358.6,20,21,5,0)
This is used mostly for YES/NO Data Qualifiers, where the value may
"^DD",358.6,358.6,20,21,6,0)
be a question, and the Data Qualifier Value, if bubbled, is the value
"^DD",358.6,358.6,20,21,7,0)
that must be placed on the PCE DIM NODE.
"^DD",358.6,358.6,20,"DT")
2961031
"^DD",358.6,358.6,21,0)
PCE DIM PIECE, VARIABLE VALUE^K^^21;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",358.6,358.6,21,3)
This is Standard MUMPS code.
"^DD",358.6,358.6,21,9)
@
"^DD",358.6,358.6,21,21,0)
^^7^7^2961031^
"^DD",358.6,358.6,21,21,1,0)
This field should be populated when the PCE DIM PIECE VALUE is not
"^DD",358.6,358.6,21,21,2,0)
constant.  If the value of that field is dependent upon specific conditions,
"^DD",358.6,358.6,21,21,3,0)
those conditions may be evaluated by placing the MUMPS code in this
"^DD",358.6,358.6,21,21,4,0)
field.  Ultimately, the code should return a value that will be used as
"^DD",358.6,358.6,21,21,5,0)
the PCE DIM PIECE VALUE.  If the return value is null, the original
"^DD",358.6,358.6,21,21,6,0)
PCE DIM PIECE VALUE field will be used to determine the piece location
"^DD",358.6,358.6,21,21,7,0)
to pass the VALUE on.
"^DD",358.6,358.6,21,"DT")
2961031
"^DD",358.6,358.61,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",358.6,358.61,0,"DT")
2921119
"^DD",358.6,358.61,0,"NM","DESCRIPTION")

"^DD",358.6,358.61,0,"UP")
358.6
"^DD",358.6,358.61,.01,0)
/6^W^^0;1^Q
"^DD",358.6,358.61,.01,3)
Enter a description of the data being exchanged.
"^DD",358.6,358.61,.01,21,0)
^^1^1^2950719^^
"^DD",358.6,358.61,.01,21,1,0)
This should describe the data being exchanged b the package interface.
"^DD",358.6,358.61,.01,"DT")
2930210
"^DD",358.6,358.613,0)
ALLOWABLE QUALIFIERS SUB-FIELD^^.08^6
"^DD",358.6,358.613,0,"DT")
2950810
"^DD",358.6,358.613,0,"IX","B",358.613,.01)

"^DD",358.6,358.613,0,"NM","ALLOWABLE QUALIFIERS")

"^DD",358.6,358.613,0,"UP")
358.6
"^DD",358.6,358.613,.01,0)
ALLOWABLE QUALIFIERS^MV^^0;1^Q
"^DD",358.6,358.613,.01,1,0)
^.1
"^DD",358.6,358.613,.01,1,1,0)
358.613^B
"^DD",358.6,358.613,.01,1,1,1)
S ^IBE(358.6,DA(1),13,"B",$E(X,1,30),DA)=""
"^DD",358.6,358.613,.01,1,1,2)
K ^IBE(358.6,DA(1),13,"B",$E(X,1,30),DA)
"^DD",358.6,358.613,.01,1,1,3)
Required Index for Variable Pointer
"^DD",358.6,358.613,.01,3)
Which qualifiers can apply to the data?
"^DD",358.6,358.613,.01,21,0)
^^1^1^2951018^^^^
"^DD",358.6,358.613,.01,21,1,0)
A qualifier that can be used by this package interface.
"^DD",358.6,358.613,.01,"DT")
2950426
"^DD",358.6,358.613,.01,"V",0)
^.12P^2^2
"^DD",358.6,358.613,.01,"V",1,0)
358.98^QUALIFIER^1^Q^n^n
"^DD",358.6,358.613,.01,"V",2,0)
358.99^DATA ELEMENT^2^D^n^n
"^DD",358.6,358.613,.03,0)
INDEPENDENT MAPPING INFO?^RS^0:NO;1:YES;^0;3^Q
"^DD",358.6,358.613,.03,3)
YES means that fields on the form associated with this qualifier will have its own rules for entering the data to the database.
"^DD",358.6,358.613,.03,21,0)
^^2^2^2950719^
"^DD",358.6,358.613,.03,21,1,0)
YES means that data can be mapped into the PCE Generic Device Interface
"^DD",358.6,358.613,.03,21,2,0)
based on the qualifier.
"^DD",358.6,358.613,.03,"DT")
2950426
"^DD",358.6,358.613,.04,0)
PCE GDI NODE^F^^0;4^K:$L(X)>30!($L(X)<1) X
"^DD",358.6,358.613,.04,3)
What node should the qualifier be placed on?
"^DD",358.6,358.613,.04,21,0)
^^1^1^2950719^
"^DD",358.6,358.613,.04,21,1,0)
The node where the data should be placed.
"^DD",358.6,358.613,.04,"DT")
2950710
"^DD",358.6,358.613,.05,0)
PCE GDI PIECE, VALUE^NJ2,0^^0;5^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.613,.05,3)
What piece should the primary value be located?
"^DD",358.6,358.613,.05,21,0)
^^1^1^2950719^
"^DD",358.6,358.613,.05,21,1,0)
The piece on the node where the value should be placed.
"^DD",358.6,358.613,.05,"DT")
2950426
"^DD",358.6,358.613,.07,0)
PCE GDI PIECE, HEADER^NJ2,0^^0;7^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.613,.07,3)
What piece should the header be located on?
"^DD",358.6,358.613,.07,21,0)
^^1^1^2950719^
"^DD",358.6,358.613,.07,21,1,0)
The piece on the node where the associated header should be placed.
"^DD",358.6,358.613,.07,"DT")
2950426
"^DD",358.6,358.613,.08,0)
PCE GDI PIECE, QUALIFIER^NJ2,0^^0;8^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.613,.08,3)
What piece should the qualifier be located on?
"^DD",358.6,358.613,.08,21,0)
^^1^1^2950719^
"^DD",358.6,358.613,.08,21,1,0)
The piece where the qualifier should go.
"^DD",358.6,358.613,.08,"DT")
2950426
"^DD",358.6,358.615,0)
DATA DESCRIPTION SUB-FIELD^^.05^5
"^DD",358.6,358.615,0,"DT")
2950417
"^DD",358.6,358.615,0,"ID","WRITE")
D EN^DDIOL("  PIECE="_$P(^(0),U,3),"","?0")
"^DD",358.6,358.615,0,"IX","B",358.615,.01)

"^DD",358.6,358.615,0,"IX","C",358.615,.03)

"^DD",358.6,358.615,0,"NM","DATA DESCRIPTION")

"^DD",358.6,358.615,0,"UP")
358.6
"^DD",358.6,358.615,.01,0)
DATA^MF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",358.6,358.615,.01,1,0)
^.1
"^DD",358.6,358.615,.01,1,1,0)
358.615^B
"^DD",358.6,358.615,.01,1,1,1)
S ^IBE(358.6,DA(1),15,"B",$E(X,1,30),DA)=""
"^DD",358.6,358.615,.01,1,1,2)
K ^IBE(358.6,DA(1),15,"B",$E(X,1,30),DA)
"^DD",358.6,358.615,.01,3)
Enter a descriptive name for this data field, up to 30 characters.
"^DD",358.6,358.615,.01,21,0)
^^1^1^2950719^
"^DD",358.6,358.615,.01,21,1,0)
A descriptive name for the data.
"^DD",358.6,358.615,.01,"DT")
2950320
"^DD",358.6,358.615,.02,0)
MAXIMUM LENGTH^RNJ3,0^^0;2^K:+X'=X!(X>210)!(X<1)!(X?.E1"."1N.N) X
"^DD",358.6,358.615,.02,3)
What is the maximum length of this field?
"^DD",358.6,358.615,.02,21,0)
^^1^1^2950719^
"^DD",358.6,358.615,.02,21,1,0)
The maximum length of the data.
"^DD",358.6,358.615,.02,"DT")
2950320
"^DD",358.6,358.615,.03,0)
PIECE^NJ1,0X^^0;3^K:+X'=X!(X>8)!(X<2)!(X?.E1"."1N.N)!($D(^IBE(358.6,D0,15,"C",X))) X
"^DD",358.6,358.615,.03,1,0)
^.1
"^DD",358.6,358.615,.03,1,1,0)
358.615^C
"^DD",358.6,358.615,.03,1,1,1)
S ^IBE(358.6,DA(1),15,"C",$E(X,1,30),DA)=""
"^DD",358.6,358.615,.03,1,1,2)
K ^IBE(358.6,DA(1),15,"C",$E(X,1,30),DA)
"^DD",358.6,358.615,.03,1,1,"%D",0)
^^1^1^2950320^
"^DD",358.6,358.615,.03,1,1,"%D",1,0)
Indexes the field by piece.
"^DD",358.6,358.615,.03,1,1,"DT")
2950320
"^DD",358.6,358.615,.03,3)
In the returned record, which piece will this field be?
"^DD",358.6,358.615,.03,21,0)
^^1^1^2950719^
"^DD",358.6,358.615,.03,21,1,0)
The piece that the data will be returned as.
"^DD",358.6,358.615,.03,"DT")
2950407
"^DD",358.6,358.615,.04,0)
ANNEX NODE^F^^0;4^K:$L(X)>10!($L(X)<1) X
"^DD",358.6,358.615,.04,3)
You can optionally specify the subscript to store the data. Use this when the entire record won't fit on one node.
"^DD",358.6,358.615,.04,21,0)
^^2^2^2950719^
"^DD",358.6,358.615,.04,21,1,0)
In case all the returned data can not be returned on a single node an
"^DD",358.6,358.615,.04,21,2,0)
annex node can be specified.
"^DD",358.6,358.615,.04,"DT")
2950320
"^DD",358.6,358.615,.05,0)
RECOMMENDED HEADER^F^^0;5^K:$L(X)>40!($L(X)<1) X
"^DD",358.6,358.615,.05,3)
Answer must be 1-40 characters in length.
"^DD",358.6,358.615,.05,21,0)
^^1^1^2950719^^
"^DD",358.6,358.615,.05,21,1,0)
The recommended header will be used as the default when designing a form.
"^DD",358.6,358.615,.05,"DT")
2950417
"^DD",358.6,358.66,0)
PROTECTED LOCAL VARIABLES SUB-FIELD^^.01^1
"^DD",358.6,358.66,0,"DT")
2930608
"^DD",358.6,358.66,0,"IX","B",358.66,.01)

"^DD",358.6,358.66,0,"NM","PROTECTED LOCAL VARIABLES")

"^DD",358.6,358.66,0,"UP")
358.6
"^DD",358.6,358.66,.01,0)
PROTECTED LOCAL VARIABLES^MFX^^0;1^K:'$$VARIABLE^IBDFU5(X) X
"^DD",358.6,358.66,.01,1,0)
^.1
"^DD",358.6,358.66,.01,1,1,0)
358.66^B
"^DD",358.6,358.66,.01,1,1,1)
S ^IBE(358.6,DA(1),6,"B",$E(X,1,30),DA)=""
"^DD",358.6,358.66,.01,1,1,2)
K ^IBE(358.6,DA(1),6,"B",$E(X,1,30),DA)
"^DD",358.6,358.66,.01,3)
Enter variables that should be NEWED before the entry action or calling the interface.
"^DD",358.6,358.66,.01,21,0)
^^3^3^2950426^^
"^DD",358.6,358.66,.01,21,1,0)
 
"^DD",358.6,358.66,.01,21,2,0)
A list of variables that should be newed before the entry action or
"^DD",358.6,358.66,.01,21,3,0)
calling the interface.
"^DD",358.6,358.66,.01,"DT")
2930608
"^DD",358.6,358.67,0)
REQUIRED LOCAL VARIABLES SUB-FIELD^^.01^1
"^DD",358.6,358.67,0,"DT")
2930521
"^DD",358.6,358.67,0,"IX","B",358.67,.01)

"^DD",358.6,358.67,0,"NM","REQUIRED LOCAL VARIABLES")

"^DD",358.6,358.67,0,"UP")
358.6
"^DD",358.6,358.67,.01,0)
REQUIRED LOCAL VARIABLE^MFX^^0;1^K:'$$VARIABLE^IBDFU5(X) X
"^DD",358.6,358.67,.01,1,0)
^.1
"^DD",358.6,358.67,.01,1,1,0)
358.67^B
"^DD",358.6,358.67,.01,1,1,1)
S ^IBE(358.6,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",358.6,358.67,.01,1,1,2)
K ^IBE(358.6,DA(1),7,"B",$E(X,1,30),DA)
"^DD",358.6,358.67,.01,3)
Enter any variables that must exist before the Package Interface routine is called.
"^DD",358.6,358.67,.01,21,0)
^^4^4^2930528^
"^DD",358.6,358.67,.01,21,1,0)
 
"^DD",358.6,358.67,.01,21,2,0)
A variable that is required input to the interface routine. The interface
"^DD",358.6,358.67,.01,21,3,0)
routine will not be called if all of the required variables are not
"^DD",358.6,358.67,.01,21,4,0)
defined.
"^DD",358.6,358.67,.01,"DT")
2930521
"^DIC",357.6,357.6,0)
PACKAGE INTERFACE^357.6IO
"^DIC",357.6,357.6,0,"GL")
^IBE(357.6,
"^DIC",357.6,357.6,"%D",0)
^^17^17^2950913^^^
"^DIC",357.6,357.6,"%D",1,0)
This file contains a description of all of the interfaces with other packages.
"^DIC",357.6,357.6,"%D",2,0)
The form will invoke the proper interface routines by doing a lookup on
"^DIC",357.6,357.6,"%D",3,0)
this file and then calling the routine by indirection. The
"^DIC",357.6,357.6,"%D",4,0)
Data will be exchanged between the encounter form utilities and other
"^DIC",357.6,357.6,"%D",5,0)
packages by putting the data in at @IBARY. Interfaces that pass a single
"^DIC",357.6,357.6,"%D",6,0)
value or record will will reference data as in: S DATA=@IBARY. Interfaces
"^DIC",357.6,357.6,"%D",7,0)
that pass lists of records or values will reference the data as in:
"^DIC",357.6,357.6,"%D",8,0)
S DATA=@IBARY@(<number of item on the list>).
"^DIC",357.6,357.6,"%D",9,0)
 
"^DIC",357.6,357.6,"%D",10,0)
Note that multiple entries in this file can have the same entry points
"^DIC",357.6,357.6,"%D",11,0)
into routines. This is for efficiency purposes. For example, patient name,
"^DIC",357.6,357.6,"%D",12,0)
DOB and sex are all located on the same node of the Patient file. Each of
"^DIC",357.6,357.6,"%D",13,0)
these items of data can have its own entry in the Package Interface file,
"^DIC",357.6,357.6,"%D",14,0)
but by using the same entry point there is a savings because all of the
"^DIC",357.6,357.6,"%D",15,0)
data on that node can be obtained at once. The routine that invokes the
"^DIC",357.6,357.6,"%D",16,0)
entry points keeps track of those already invoked so that they are not
"^DIC",357.6,357.6,"%D",17,0)
repeated.
"^DIC",357.6,"B","PACKAGE INTERFACE",357.6)

"^DIC",357.91,357.91,0)
MARKING AREA TYPE^357.91
"^DIC",357.91,357.91,0,"GL")
^IBE(357.91,
"^DIC",357.91,357.91,"%D",0)
^^4^4^2931214^^
"^DIC",357.91,357.91,"%D",1,0)
 
"^DIC",357.91,357.91,"%D",2,0)
This file contains the different types of marking areas that can be
"^DIC",357.91,357.91,"%D",3,0)
printed to a form for the user to write in. Examples are  ( ),__, etc.
"^DIC",357.91,357.91,"%D",4,0)
These are for the person completing the form to mark to indicate a choice.
"^DIC",357.91,"B","MARKING AREA TYPE",357.91)

"^DIC",358.1,358.1,0)
IMP/EXP ENCOUNTER FORM BLOCK
"^DIC",358.1,358.1,0,"GL")
^IBE(358.1,
"^DIC",358.1,358.1,"%",0)
^1.005^^
"^DIC",358.1,358.1,"%D",0)
^^4^4^2940217^
"^DIC",358.1,358.1,"%D",1,0)
 
"^DIC",358.1,358.1,"%D",2,0)
This file is nearly identical to file #357.1. It is used by the
"^DIC",358.1,358.1,"%D",3,0)
Import/Export Utility as a temporary staging area for data from that file
"^DIC",358.1,358.1,"%D",4,0)
that is being imported or exported.
"^DIC",358.1,"B","IMP/EXP ENCOUNTER FORM BLOCK",358.1)

"^DIC",358.2,358.2,0)
IMP/EXP SELECTION LIST
"^DIC",358.2,358.2,0,"GL")
^IBE(358.2,
"^DIC",358.2,358.2,"%D",0)
^^1^1^2940829^^^^
"^DIC",358.2,358.2,"%D",1,0)
Used by the import/export utility as a workspace.
"^DIC",358.2,358.2,"%D",2,0)
 
"^DIC",358.2,358.2,"%D",3,0)
 
"^DIC",358.2,358.2,"%D",4,0)
 
"^DIC",358.2,358.2,"%D",5,0)
 
"^DIC",358.2,358.2,"%D",6,0)
 
"^DIC",358.2,358.2,"%D",7,0)
 
"^DIC",358.2,358.2,"%D",8,0)
This file is nearly identical to file #357.2 . It is used by the
"^DIC",358.2,358.2,"%D",9,0)
Import/Export Utility as a temporary staging area for data from that file
"^DIC",358.2,358.2,"%D",10,0)
that is being imported or exported.
"^DIC",358.2,358.2,"%D",11,0)
provisions have been made to specify up to 4 columns per list.
"^DIC",358.2,"B","IMP/EXP SELECTION LIST",358.2)

"^DIC",358.3,358.3,0)
IMP/EXP SELECTION
"^DIC",358.3,358.3,0,"GL")
^IBE(358.3,
"^DIC",358.3,358.3,"%D",0)
^^4^4^2940217^
"^DIC",358.3,358.3,"%D",1,0)
 
"^DIC",358.3,358.3,"%D",2,0)
This file is nearly identical to file #357.3. It is used by the
"^DIC",358.3,358.3,"%D",3,0)
Import/Export Utility as a temporary staging area for data from that file
"^DIC",358.3,358.3,"%D",4,0)
that is being imported or exported.
"^DIC",358.3,"B","IMP/EXP SELECTION",358.3)

"^DIC",358.4,358.4,0)
IMP/EXP SELECTION GROUP
"^DIC",358.4,358.4,0,"GL")
^IBE(358.4,
"^DIC",358.4,358.4,"%D",0)
^^4^4^2940217^
"^DIC",358.4,358.4,"%D",1,0)
 
"^DIC",358.4,358.4,"%D",2,0)
This file is nearly identical to file #357.4. It is used by the
"^DIC",358.4,358.4,"%D",3,0)
Import/Export Utility as a temporary staging area for data from that file
"^DIC",358.4,358.4,"%D",4,0)
that is being imported or exported.
"^DIC",358.4,"B","IMP/EXP SELECTION GROUP",358.4)

"^DIC",358.6,358.6,0)
IMP/EXP PACKAGE INTERFACE^358.6I
"^DIC",358.6,358.6,0,"GL")
^IBE(358.6,
"^DIC",358.6,358.6,"%D",0)
^^1^1^2950927^^^^
"^DIC",358.6,358.6,"%D",1,0)
This file is used as a workspace by the import/export utility.
"^DIC",358.6,358.6,"%D",2,0)
Import/Export Utility as a temporary staging area for data from that file
"^DIC",358.6,358.6,"%D",3,0)
that is being imported or exported.
"^DIC",358.6,358.6,"%D",4,0)
 
"^DIC",358.6,358.6,"%D",5,0)
This file contains a description of all of the interfaces with other packages.
"^DIC",358.6,358.6,"%D",6,0)
The form will invoke the proper interface routines by doing a lookup on
"^DIC",358.6,358.6,"%D",7,0)
this file and then invoking the routine by indirection. The INPUT VARIABLE
"^DIC",358.6,358.6,"%D",8,0)
fields are for documentation purposes and to verify that the proper
"^DIC",358.6,358.6,"%D",9,0)
variables are defined. Data will be exchanged between the encounter form
"^DIC",358.6,358.6,"%D",10,0)
utilities and other packages by putting the data in a predefined location.
"^DIC",358.6,358.6,"%D",11,0)
The first part of the subscript is always be ^TMP("IB",$J,"INTERFACES".
"^DIC",358.6,358.6,"%D",12,0)
For output routines, but not selection routines, the fourth subscript is
"^DIC",358.6,358.6,"%D",13,0)
be the patient DFN. The next subscript is the name of the Package
"^DIC",358.6,358.6,"%D",14,0)
Interface. For single valued data and record valued data there is no
"^DIC",358.6,358.6,"%D",15,0)
additional subscript. For interfaces returning a list there is one
"^DIC",358.6,358.6,"%D",16,0)
additional subscript level, the number of the item on the list. For
"^DIC",358.6,358.6,"%D",17,0)
word processing type data the data will be in FM word-processing format,
"^DIC",358.6,358.6,"%D",18,0)
i.e., the final subscripts will be ...1,0),...2,0),...3,0), etc.
"^DIC",358.6,358.6,"%D",19,0)
these items of data can have its own entry in the Package Interface file,
"^DIC",358.6,358.6,"%D",20,0)
but by using the same entry point there is a savings because all of the
"^DIC",358.6,358.6,"%D",21,0)
data on that node can be obtained at once. The routines that invoke the
"^DIC",358.6,358.6,"%D",22,0)
entry point keep track of the entry points already invoked so they are
"^DIC",358.6,358.6,"%D",23,0)
not repeated.
"^DIC",358.6,"B","IMP/EXP PACKAGE INTERFACE",358.6)

**END**
**END**
