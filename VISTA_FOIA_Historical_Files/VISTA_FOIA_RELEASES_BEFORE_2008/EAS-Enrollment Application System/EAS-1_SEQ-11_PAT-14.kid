Released EAS*1*14 SEQ #11
Extracted from mail message
**KIDS**:EAS*1.0*14^

**INSTALL NAME**
EAS*1.0*14
"BLD",4063,0)
EAS*1.0*14^ENROLLMENT APPLICATION SYSTEM^0^3020627^y
"BLD",4063,1,0)
^^7^7^3020603^
"BLD",4063,1,1,0)
This patch addresses a fix for flagging 0-day letters and correcting the 
"BLD",4063,1,2,0)
newing of the "VAROOT" variable to correct an interaction with older DG 
"BLD",4063,1,3,0)
routines.
"BLD",4063,1,4,0)
 
"BLD",4063,1,5,0)
This patch addresses the following NOIS's"
"BLD",4063,1,6,0)
SLC-0502-51019
"BLD",4063,1,7,0)
BAC-0502-41276
"BLD",4063,4,0)
^9.64PA^^
"BLD",4063,"KRN",0)
^9.67PA^8989.52^19
"BLD",4063,"KRN",.4,0)
.4
"BLD",4063,"KRN",.401,0)
.401
"BLD",4063,"KRN",.402,0)
.402
"BLD",4063,"KRN",.403,0)
.403
"BLD",4063,"KRN",.5,0)
.5
"BLD",4063,"KRN",.84,0)
.84
"BLD",4063,"KRN",3.6,0)
3.6
"BLD",4063,"KRN",3.8,0)
3.8
"BLD",4063,"KRN",9.2,0)
9.2
"BLD",4063,"KRN",9.8,0)
9.8
"BLD",4063,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",4063,"KRN",9.8,"NM",1,0)
EASMTL6A^^0^B18551367
"BLD",4063,"KRN",9.8,"NM",2,0)
EASMTUTL^^0^B39076142
"BLD",4063,"KRN",9.8,"NM",3,0)
EAS114PT^^0^B3576716
"BLD",4063,"KRN",9.8,"NM",4,0)
EASMTL6^^0^B43403506
"BLD",4063,"KRN",9.8,"NM",5,0)
EASMTL2^^0^B16855638
"BLD",4063,"KRN",9.8,"NM","B","EAS114PT",3)

"BLD",4063,"KRN",9.8,"NM","B","EASMTL2",5)

"BLD",4063,"KRN",9.8,"NM","B","EASMTL6",4)

"BLD",4063,"KRN",9.8,"NM","B","EASMTL6A",1)

"BLD",4063,"KRN",9.8,"NM","B","EASMTUTL",2)

"BLD",4063,"KRN",19,0)
19
"BLD",4063,"KRN",19.1,0)
19.1
"BLD",4063,"KRN",101,0)
101
"BLD",4063,"KRN",409.61,0)
409.61
"BLD",4063,"KRN",771,0)
771
"BLD",4063,"KRN",870,0)
870
"BLD",4063,"KRN",8989.51,0)
8989.51
"BLD",4063,"KRN",8989.52,0)
8989.52
"BLD",4063,"KRN",8994,0)
8994
"BLD",4063,"KRN","B",.4,.4)

"BLD",4063,"KRN","B",.401,.401)

"BLD",4063,"KRN","B",.402,.402)

"BLD",4063,"KRN","B",.403,.403)

"BLD",4063,"KRN","B",.5,.5)

"BLD",4063,"KRN","B",.84,.84)

"BLD",4063,"KRN","B",3.6,3.6)

"BLD",4063,"KRN","B",3.8,3.8)

"BLD",4063,"KRN","B",9.2,9.2)

"BLD",4063,"KRN","B",9.8,9.8)

"BLD",4063,"KRN","B",19,19)

"BLD",4063,"KRN","B",19.1,19.1)

"BLD",4063,"KRN","B",101,101)

"BLD",4063,"KRN","B",409.61,409.61)

"BLD",4063,"KRN","B",771,771)

"BLD",4063,"KRN","B",870,870)

"BLD",4063,"KRN","B",8989.51,8989.51)

"BLD",4063,"KRN","B",8989.52,8989.52)

"BLD",4063,"KRN","B",8994,8994)

"BLD",4063,"QUES",0)
^9.62^^
"BLD",4063,"REQB",0)
^9.611^2^2
"BLD",4063,"REQB",1,0)
EAS*1.0*3^1
"BLD",4063,"REQB",2,0)
EAS*1.0*12^1
"BLD",4063,"REQB","B","EAS*1.0*12",2)

"BLD",4063,"REQB","B","EAS*1.0*3",1)

"MBREQ")
0
"PKG",552,-1)
1^1
"PKG",552,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",552,20,0)
^9.402P^2^1
"PKG",552,20,2,0)
2^^EASXDR
"PKG",552,20,2,1)

"PKG",552,20,"B",2,2)

"PKG",552,22,0)
^9.49I^1^1
"PKG",552,22,1,0)
1.0^3010315^3010419^66481
"PKG",552,22,1,"PAH",1,0)
14^3020627^11984
"PKG",552,22,1,"PAH",1,1,0)
^^7^7^3020627
"PKG",552,22,1,"PAH",1,1,1,0)
This patch addresses a fix for flagging 0-day letters and correcting the 
"PKG",552,22,1,"PAH",1,1,2,0)
newing of the "VAROOT" variable to correct an interaction with older DG 
"PKG",552,22,1,"PAH",1,1,3,0)
routines.
"PKG",552,22,1,"PAH",1,1,4,0)
 
"PKG",552,22,1,"PAH",1,1,5,0)
This patch addresses the following NOIS's"
"PKG",552,22,1,"PAH",1,1,6,0)
SLC-0502-51019
"PKG",552,22,1,"PAH",1,1,7,0)
BAC-0502-41276
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","EAS114PT")
0^3^B3576716
"RTN","EAS114PT",1,0)
EAS114PT ; ALB/SCK - EAS*1.0*14 POST INSTALL CONVERSION ROUTINE ; 6/3/2002
"RTN","EAS114PT",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**14**;MAR 15,2001
"RTN","EAS114PT",3,0)
 ;
"RTN","EAS114PT",4,0)
EN ; Entry point for post installation routine
"RTN","EAS114PT",5,0)
 N ZX,COUNT,CNVRT,DR,DA,NODE0,NODE4,NODEZ,EASPRE
"RTN","EAS114PT",6,0)
 ;
"RTN","EAS114PT",7,0)
 S DIR(0)="YAO",DIR("A")="Pre-scan for un-flagged 0-day letters? "
"RTN","EAS114PT",8,0)
 S DIR("B")="YES"
"RTN","EAS114PT",9,0)
 S DIR("?",1)="Pre-scan will provide the number of records which will have the 0-day"
"RTN","EAS114PT",10,0)
 S DIR("?",2)="Flag-to-Print flag set to 'YES' when this routine is run in the conversion mode."
"RTN","EAS114PT",11,0)
 S DIR("?",3)=""
"RTN","EAS114PT",12,0)
 S DIR("?")="Enter 'YES' to pre-scan, 'NO' to convert the 0-day print flags"
"RTN","EAS114PT",13,0)
 D ^DIR K DIR
"RTN","EAS114PT",14,0)
 Q:$D(DIRUT)
"RTN","EAS114PT",15,0)
 S EASPRE=Y
"RTN","EAS114PT",16,0)
 ;
"RTN","EAS114PT",17,0)
 W !!!,"Beginning scan for un-flagged 0-day letters"
"RTN","EAS114PT",18,0)
 D WAIT^DICD W !
"RTN","EAS114PT",19,0)
 ;
"RTN","EAS114PT",20,0)
 S (COUNT,ZX,CNVRT)=0
"RTN","EAS114PT",21,0)
 F  S ZX=$O(^EAS(713.2,ZX)) Q:'ZX  D
"RTN","EAS114PT",22,0)
 . S NODE0=$G(^EAS(713.2,ZX,0))
"RTN","EAS114PT",23,0)
 . S COUNT=COUNT+1 I (COUNT#100)=0 W "."
"RTN","EAS114PT",24,0)
 . Q:$P(NODE0,U,4)=1
"RTN","EAS114PT",25,0)
 . S NODE4=$G(^EAS(713.2,ZX,4))
"RTN","EAS114PT",26,0)
 . S NODEZ=$G(^EAS(713.2,ZX,"Z"))
"RTN","EAS114PT",27,0)
 . I $P(NODE4,U,3)=1 D
"RTN","EAS114PT",28,0)
 . . I +$P(NODEZ,U,2)=0 D
"RTN","EAS114PT",29,0)
 . . . I +$P(NODEZ,U,3)=0 D
"RTN","EAS114PT",30,0)
 . . . . I 'EASPRE D
"RTN","EAS114PT",31,0)
 . . . . . S DIE="^EAS(713.2,"
"RTN","EAS114PT",32,0)
 . . . . . S DR="18///1",DA=ZX
"RTN","EAS114PT",33,0)
 . . . . . D ^DIE K DIE
"RTN","EAS114PT",34,0)
 . . . . S CNVRT=CNVRT+1
"RTN","EAS114PT",35,0)
 ;
"RTN","EAS114PT",36,0)
 W !?3,$FN(COUNT,",")," records scanned"
"RTN","EAS114PT",37,0)
 W !?3,$FN(CNVRT,",")," records "_$S(EASPRE:"will have",1:"had")_" the 0-day flag set to print"
"RTN","EAS114PT",38,0)
 Q
"RTN","EASMTL2")
0^5^B16855638
"RTN","EASMTL2",1,0)
EASMTL2 ;MIN/TCM ALB/SCK - AUTOMATED MEANS TEST LETTER - SEARCH ; 7/3/01
"RTN","EASMTL2",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,12,14**;MAR 15,2001
"RTN","EASMTL2",3,0)
 ;
"RTN","EASMTL2",4,0)
EN60 ; Entry point for inital 60-day letter search for candidates 
"RTN","EASMTL2",5,0)
 N EASIEN,DFN,VADM,CNT,ANNVDT,EASLAST
"RTN","EASMTL2",6,0)
 ;
"RTN","EASMTL2",7,0)
 S CNT=0 ; Initialize counter
"RTN","EASMTL2",8,0)
 S ANNVDT=EASDT("ANV")
"RTN","EASMTL2",9,0)
 ; Check for means test data to process, quit if none found
"RTN","EASMTL2",10,0)
 Q:'$D(^DGMT(408.31,"B",ANNVDT))
"RTN","EASMTL2",11,0)
 ;
"RTN","EASMTL2",12,0)
 ; Retieve data for each Means Test entry being processed
"RTN","EASMTL2",13,0)
 S EASIEN=0
"RTN","EASMTL2",14,0)
 F  S EASIEN=$O(^DGMT(408.31,"B",ANNVDT,EASIEN)) Q:EASIEN'>0  D
"RTN","EASMTL2",15,0)
 . ; Quit further processing if means test is not MEANS TEST type
"RTN","EASMTL2",16,0)
 . Q:'$$GET1^DIQ(408.31,EASIEN,.019,"I")=1
"RTN","EASMTL2",17,0)
 . S DFN=$$GET1^DIQ(408.31,EASIEN,.02,"I") ; get patient's DFN
"RTN","EASMTL2",18,0)
 . ; Check conditions; if all passed, add new entry to worklist file, #713.2
"RTN","EASMTL2",19,0)
 . Q:'DFN                         ; Safety check for DFN
"RTN","EASMTL2",20,0)
 . Q:$$TEST(DFN)                  ; Quit if test patient
"RTN","EASMTL2",21,0)
 . S EASLAST=$$LST^DGMTU(DFN)     ; Get last MT on file
"RTN","EASMTL2",22,0)
 . Q:'(+EASLAST=EASIEN)  ; Not the latest MT record for patient
"RTN","EASMTL2",23,0)
 . Q:"L,N"[$P(EASLAST,U,4)        ; Quit, patient no longer requires means test (No Longer Applicable or No Longer Required)
"RTN","EASMTL2",24,0)
 . Q:$$DECEASED^EASMTUTL("",DFN)  ; Quit if patient deceased
"RTN","EASMTL2",25,0)
 . ;  If passed through all condition checks, update files
"RTN","EASMTL2",26,0)
 . Q:$$CHKSTAT(EASIEN,DFN)         ; Check current MT status
"RTN","EASMTL2",27,0)
 . Q:$$FUTURE(DFN)  ; Quit if a future means test is on file
"RTN","EASMTL2",28,0)
 . D NEWSTAT(DFN,.EASPT)
"RTN","EASMTL2",29,0)
 . Q:'EASPT  ; Safety check
"RTN","EASMTL2",30,0)
 . Q:'$$NEWLTR(EASPT,.EASDT)  ; Quit if letter status was not updated
"RTN","EASMTL2",31,0)
 . ; Finally, Update the counters
"RTN","EASMTL2",32,0)
 . S CNT=CNT+1
"RTN","EASMTL2",33,0)
 S EAS6CNT(EASPRCDT)=CNT,EAS6CNT=EAS6CNT+CNT
"RTN","EASMTL2",34,0)
 Q
"RTN","EASMTL2",35,0)
 ;
"RTN","EASMTL2",36,0)
NEWLTR(EASPT,EASDT) ; Add new entry to the work list file #713.2.
"RTN","EASMTL2",37,0)
 ; Input
"RTN","EASMTL2",38,0)
 ;   EASPT  - Ptr to 713.1 file
"RTN","EASMTL2",39,0)
 ;   EASDT  - Worklist date array
"RTN","EASMTL2",40,0)
 ;
"RTN","EASMTL2",41,0)
 ; Output
"RTN","EASMTL2",42,0)
 ;   RSLT   - 1 if new letter status entry added
"RTN","EASMTL2",43,0)
 ;            0 if new letter status was not added
"RTN","EASMTL2",44,0)
 ;
"RTN","EASMTL2",45,0)
 N ANNVDT,FDA,RSLT
"RTN","EASMTL2",46,0)
 ;
"RTN","EASMTL2",47,0)
 S ANNVDT=EASDT("ANV")
"RTN","EASMTL2",48,0)
 ;
"RTN","EASMTL2",49,0)
 ;; Check for an existing entry for patient and anniversary date
"RTN","EASMTL2",50,0)
 I $D(^EAS(713.2,"AN",EASPT,ANNVDT)) Q 0 ; Quit if duplicate entry
"RTN","EASMTL2",51,0)
 ;
"RTN","EASMTL2",52,0)
 ; Add new entry to the letter status file, #713.2
"RTN","EASMTL2",53,0)
 S FDA(1,713.2,"+1,",.01)=EADT
"RTN","EASMTL2",54,0)
 S FDA(1,713.2,"+1,",2)=EASPT
"RTN","EASMTL2",55,0)
 S FDA(1,713.2,"+1,",3)=ANNVDT
"RTN","EASMTL2",56,0)
 S FDA(1,713.2,"+1,",4)=0
"RTN","EASMTL2",57,0)
 S FDA(1,713.2,"+1,",8)=EASDT("60")
"RTN","EASMTL2",58,0)
 S FDA(1,713.2,"+1,",11)=EASDT("30")
"RTN","EASMTL2",59,0)
 S FDA(1,713.2,"+1,",17)=EASDT("0")
"RTN","EASMTL2",60,0)
 S FDA(1,713.2,"+1,",9)=1
"RTN","EASMTL2",61,0)
 ;; Modification for DCD sites which are required to print only the 0-day letters
"RTN","EASMTL2",62,0)
 ;; EAS*1*12
"RTN","EASMTL2",63,0)
 I $$VERSION^XPDUTL("IVMC") D
"RTN","EASMTL2",64,0)
 . K FDA(1,713.2,"+1,",9)
"RTN","EASMTL2",65,0)
 . S FDA(1,713.2,"+1,",18)=1
"RTN","EASMTL2",66,0)
 ;; ***
"RTN","EASMTL2",67,0)
 D UPDATE^DIE("","FDA(1)","","ERRMSG")
"RTN","EASMTL2",68,0)
 Q 1
"RTN","EASMTL2",69,0)
 ;
"RTN","EASMTL2",70,0)
UPDLTR(EAS1,TYPE) ; Update Flagged to print field for letter type
"RTN","EASMTL2",71,0)
 ; Input
"RTN","EASMTL2",72,0)
 ;   EAS1  - Ptr to file 713.2
"RTN","EASMTL2",73,0)
 ;   TYPE  - Letter type
"RTN","EASMTL2",74,0)
 ;
"RTN","EASMTL2",75,0)
 N DIE,DR,DA
"RTN","EASMTL2",76,0)
 ;
"RTN","EASMTL2",77,0)
 S DIE="^EAS(713.2,",DA=EAS1
"RTN","EASMTL2",78,0)
 S DR=$S(TYPE=2:12,TYPE=4:18,1:0)
"RTN","EASMTL2",79,0)
 Q:'DR
"RTN","EASMTL2",80,0)
 S DR=DR_"///1"
"RTN","EASMTL2",81,0)
 D ^DIE K DIE
"RTN","EASMTL2",82,0)
 Q
"RTN","EASMTL2",83,0)
 ;
"RTN","EASMTL2",84,0)
NEWSTAT(DFN,EASPT) ; Update the Patient status file, #713.1
"RTN","EASMTL2",85,0)
 ; Input
"RTN","EASMTL2",86,0)
 ;   DFN   - Patient's DFN
"RTN","EASMTL2",87,0)
 ;   EASPT - Return Var, New IEN to 713.1 file
"RTN","EASMTL2",88,0)
 ;
"RTN","EASMTL2",89,0)
 N EASIEN
"RTN","EASMTL2",90,0)
 ;
"RTN","EASMTL2",91,0)
 ; Create new entry in the patient status file
"RTN","EASMTL2",92,0)
 I '$D(^EAS(713.1,"B",DFN)) D  Q
"RTN","EASMTL2",93,0)
 . S X=DFN,DIC="^EAS(713.1,",DIC(0)="Z"
"RTN","EASMTL2",94,0)
 . S DIC("DR")="2///0"
"RTN","EASMTL2",95,0)
 . D FILE^DICN K DIC
"RTN","EASMTL2",96,0)
 . S EASPT=+Y
"RTN","EASMTL2",97,0)
 ;
"RTN","EASMTL2",98,0)
 I $D(^EAS(713.1,"B",DFN)) D
"RTN","EASMTL2",99,0)
 . Q:'DFN
"RTN","EASMTL2",100,0)
 . S EASPT=$O(^EAS(713.1,"B",DFN,0))
"RTN","EASMTL2",101,0)
 Q
"RTN","EASMTL2",102,0)
 ;
"RTN","EASMTL2",103,0)
PRNTDT(EARY,ETYPE) ; Retrieve Print date and flagged to print status for letter type
"RTN","EASMTL2",104,0)
 ; Input
"RTN","EASMTL2",105,0)
 ;    EARY  - Data array from Patient Status file, #713.1, MT Anniversary date field, #11
"RTN","EASMTL2",106,0)
 ;    ETYPE - Search type, 30 or 0 day
"RTN","EASMTL2",107,0)
 ;
"RTN","EASMTL2",108,0)
 ; Output
"RTN","EASMTL2",109,0)
 ;    RSLT = Print date ^ Flagged to print status
"RTN","EASMTL2",110,0)
 ;           will be 0^0 if nothing found to return
"RTN","EASMTL2",111,0)
 ;
"RTN","EASMTL2",112,0)
 N RSLT
"RTN","EASMTL2",113,0)
 ;
"RTN","EASMTL2",114,0)
 S RSLT=$S(ETYPE=2:EARY(11,"I"),ETYPE=4:EARY(17,"I"),1:0)
"RTN","EASMTL2",115,0)
 S RSLT=RSLT_"^"_+$S(ETYPE=2:EARY(12,"I"),ETYPE=4:EARY(18,"I"),1:0)
"RTN","EASMTL2",116,0)
 Q RSLT
"RTN","EASMTL2",117,0)
 ;
"RTN","EASMTL2",118,0)
CHKSTAT(EASIEN,DFN) ; Check for means test status, still required or not
"RTN","EASMTL2",119,0)
 ; Input
"RTN","EASMTL2",120,0)
 ;    EASIEN  - Internal Entry Number to the ANNUAL MEANS TEST File, #408.31
"RTN","EASMTL2",121,0)
 ;
"RTN","EASMTL2",122,0)
 ; Output
"RTN","EASMTL2",123,0)
 ;    1 - if means test is no longer required or applicable
"RTN","EASMTL2",124,0)
 ;    0 - if means test is still required
"RTN","EASMTL2",125,0)
 ;
"RTN","EASMTL2",126,0)
 N RSLT,EASTAT
"RTN","EASMTL2",127,0)
 ;
"RTN","EASMTL2",128,0)
 ; If status = "NO LONGER REQUIRED" or "NO LONGER APPLICABLE" then set result to 1
"RTN","EASMTL2",129,0)
 ; The .03 field is a pointer to the MEANS TEST STATUS File, #408.32, checks
"RTN","EASMTL2",130,0)
 ; IEN=3 and IEN=10, NO LONGER REQUIRED and NO LONGER APPLICABLE entries respectively 
"RTN","EASMTL2",131,0)
 ; If the 408.32 file is changed, this code will need to be reviewed and updated if necessary.
"RTN","EASMTL2",132,0)
 ;
"RTN","EASMTL2",133,0)
 S RSLT=0,DFN=$G(DFN)
"RTN","EASMTL2",134,0)
 ;
"RTN","EASMTL2",135,0)
 S EASTAT=$$GET1^DIQ(408.31,EASIEN,.03,"I")
"RTN","EASMTL2",136,0)
 I (EASTAT=3)!(EASTAT=10) S RSLT=1
"RTN","EASMTL2",137,0)
 ;
"RTN","EASMTL2",138,0)
 ;; Check current MT Status from API (Looking for Cat-C, Agree to Pay Dedct, MT later than 10-5-99
"RTN","EASMTL2",139,0)
 I 'RSLT D
"RTN","EASMTL2",140,0)
 . S:'$$MTCHK^EASMTCHK(DFN,"L") RSLT=1
"RTN","EASMTL2",141,0)
 ;
"RTN","EASMTL2",142,0)
 Q $G(RSLT)
"RTN","EASMTL2",143,0)
 ;
"RTN","EASMTL2",144,0)
FUTURE(DFN) ;
"RTN","EASMTL2",145,0)
 N RSLT
"RTN","EASMTL2",146,0)
 ;
"RTN","EASMTL2",147,0)
 S RSLT=$$FUT^DGMTU(DFN)
"RTN","EASMTL2",148,0)
 Q $G(RSLT)
"RTN","EASMTL2",149,0)
 ;
"RTN","EASMTL2",150,0)
TEST(DFN) ;
"RTN","EASMTL2",151,0)
 N VAROOT,ZSSN,EASDEM
"RTN","EASMTL2",152,0)
 ;
"RTN","EASMTL2",153,0)
 S VAROOT="EASDEM"
"RTN","EASMTL2",154,0)
 D DEM^VADPT
"RTN","EASMTL2",155,0)
 S ZSSN=$P(EASDEM(2),U,1)
"RTN","EASMTL2",156,0)
 I $E(ZSSN,1,5)["00000" Q 1
"RTN","EASMTL2",157,0)
 ;
"RTN","EASMTL2",158,0)
 Q 0
"RTN","EASMTL6")
0^4^B43403506
"RTN","EASMTL6",1,0)
EASMTL6 ; MIN/TCM ALB/SCK - AUTOMATED MEANS TEST LETTER-PRINT LETTERS ; 7-13-01
"RTN","EASMTL6",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14**;MAR 15,2001
"RTN","EASMTL6",3,0)
 ;
"RTN","EASMTL6",4,0)
EN ; Main entry point
"RTN","EASMTL6",5,0)
 ; Input, set in option call, if not passed in, or called interactively, user is asked to specify.
"RTN","EASMTL6",6,0)
 ;    EATYP - Used for selective printing of letters and forms
"RTN","EASMTL6",7,0)
 ;         1 : 60-Day
"RTN","EASMTL6",8,0)
 ;         2 : 30-Day
"RTN","EASMTL6",9,0)
 ;         4 :  0-Day
"RTN","EASMTL6",10,0)
 ;
"RTN","EASMTL6",11,0)
 N DIR,DIRUT,Y,ZTSAVE,EASLOC,EASIEN
"RTN","EASMTL6",12,0)
 N EASUSR,EASDEV,EASTMP,EASKP,EAPLOC
"RTN","EASMTL6",13,0)
 ;
"RTN","EASMTL6",14,0)
 ;; Select type of letter to print
"RTN","EASMTL6",15,0)
 I '$G(EATYP) D  Q:$D(DIRUT)
"RTN","EASMTL6",16,0)
 . S DIR(0)="SO^1:60-Day;2:30-Day;4:0-Day;A:All"
"RTN","EASMTL6",17,0)
 . S DIR("B")=$S($G(EATYP)]"":EATYP,1:"ALL")
"RTN","EASMTL6",18,0)
 . S DIR("?")="Select letter or ""A"" for All"
"RTN","EASMTL6",19,0)
 . D ^DIR K DIR
"RTN","EASMTL6",20,0)
 . S EATYP=+Y
"RTN","EASMTL6",21,0)
 ;
"RTN","EASMTL6",22,0)
 ;; Restrict letters to a specific location, or print all letters
"RTN","EASMTL6",23,0)
 I $$GET1^DIQ(713,1,8,"I") D  Q:$D(DIRUT)
"RTN","EASMTL6",24,0)
 . S DIR(0)="YAO",DIR("B")="YES",DIR("A")="Print letters for a specific location? "
"RTN","EASMTL6",25,0)
 . S DIR("?")="'YES' to print for a specific location, 'NO' to print for all locations"
"RTN","EASMTL6",26,0)
 . D ^DIR K DIR
"RTN","EASMTL6",27,0)
 . Q:$D(DIRUT)
"RTN","EASMTL6",28,0)
 . S EASLOC=+Y
"RTN","EASMTL6",29,0)
 . ;
"RTN","EASMTL6",30,0)
 . I 'EASLOC Q
"RTN","EASMTL6",31,0)
 . S DIR(0)="P^EAS(713,1,2,:QEM"
"RTN","EASMTL6",32,0)
 . D ^DIR K DIR
"RTN","EASMTL6",33,0)
 . Q:$D(DIRUT)
"RTN","EASMTL6",34,0)
 . S EASIEN=+Y
"RTN","EASMTL6",35,0)
 . S EASLOC("LOC")=$$GET1^DIQ(713.025,EASIEN_",1",.01,"I")_"^"_EASIEN
"RTN","EASMTL6",36,0)
 ;
"RTN","EASMTL6",37,0)
 S EASTMP="^TMP(""EASMT"",$J)" ; Clean out TMP array for sorting letters
"RTN","EASMTL6",38,0)
 K @EASTMP
"RTN","EASMTL6",39,0)
 ;
"RTN","EASMTL6",40,0)
 I $G(EASLOC) S EAPLOC=EASLOC("LOC")
"RTN","EASMTL6",41,0)
 E  S EAPLOC=0
"RTN","EASMTL6",42,0)
 W !!,"Scanning for letters"
"RTN","EASMTL6",43,0)
 D WAIT^DICD
"RTN","EASMTL6",44,0)
 D BLD(EATYP,EAPLOC,EASTMP,.EASKP)
"RTN","EASMTL6",45,0)
 W !?4,"     Letters to print: ",$J($FN(EASKP("CNT"),","),8)
"RTN","EASMTL6",46,0)
 W !?4,"Threshold not reached: ",$J($FN(EASKP("T"),","),8)
"RTN","EASMTL6",47,0)
 W !!?4,"The following letters were found, their printing will be canceled"
"RTN","EASMTL6",48,0)
 W !?4," Incomplete Addr : ",$J($FN(EASKP("I"),","),8)
"RTN","EASMTL6",49,0)
 W !?4,"        Deceased : ",$J($FN(EASKP("D"),","),8)
"RTN","EASMTL6",50,0)
 W !?4,"       MT Changed: ",$J($FN(EASKP("C"),","),8)
"RTN","EASMTL6",51,0)
 W !?4,"Prohibit flag set: ",$J($FN(EASKP("P"),","),8)
"RTN","EASMTL6",52,0)
 W !
"RTN","EASMTL6",53,0)
 S DIR(0)="YAO",DIR("B")="YES",DIR("A")="Continue? "
"RTN","EASMTL6",54,0)
 D ^DIR K DIR
"RTN","EASMTL6",55,0)
 I $D(DIRUT)!('Y) D  Q
"RTN","EASMTL6",56,0)
 . K EATYP,@EASTMP
"RTN","EASMTL6",57,0)
 ;
"RTN","EASMTL6",58,0)
 D PRINT(EATYP,EAPLOC,EASTMP)
"RTN","EASMTL6",59,0)
 K @EASTMP ; Clean out TMP array for sorting letters
"RTN","EASMTL6",60,0)
 D HOME^%ZIS
"RTN","EASMTL6",61,0)
 K EATYP
"RTN","EASMTL6",62,0)
 Q
"RTN","EASMTL6",63,0)
 ;
"RTN","EASMTL6",64,0)
BLD(EATYP,EASLOC,EASTMP,EASKP) ; Build TMP array of letters to print
"RTN","EASMTL6",65,0)
 N EASLTR,DFN,EADEM,EASIEN,EASPT,COUNT,EAX2,EASPTR
"RTN","EASMTL6",66,0)
 ;
"RTN","EASMTL6",67,0)
 F EAX2="P","D","C","F","T","I","CNT" S EASKP(EAX2)=0
"RTN","EASMTL6",68,0)
 S COUNT=0
"RTN","EASMTL6",69,0)
 ;
"RTN","EASMTL6",70,0)
 S EASIEN=0 ; Begin loop through un-returned means tests
"RTN","EASMTL6",71,0)
 F  S EASIEN=$O(^EAS(713.2,"AC",0,EASIEN)) Q:'EASIEN  D
"RTN","EASMTL6",72,0)
 . S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I") ; Pointer to File 713.1
"RTN","EASMTL6",73,0)
 . ;; begin checks
"RTN","EASMTL6",74,0)
 . I $D(^EAS(713.1,"AP",1,EASPTR)) D  Q  ; Check Prohibit letter
"RTN","EASMTL6",75,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",76,0)
 . . S EASKP("P")=EASKP("P")+1
"RTN","EASMTL6",77,0)
 . I $$DECEASED^EASMTUTL(EASIEN) D  Q  ; Check Deceased
"RTN","EASMTL6",78,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",79,0)
 . . S EASKP("D")=EASKP("D")+1
"RTN","EASMTL6",80,0)
 . I $$CHECKMT^EASMTUTL(EASPTR,EASIEN) D  Q  ; Check MT changed?
"RTN","EASMTL6",81,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",82,0)
 . . S EASKP("C")=EASKP("C")+1 Q  ; Check MT changed?
"RTN","EASMTL6",83,0)
 . I $$FUTMT^EASMTUTL(EASIEN) D  Q  ; Check Future MT
"RTN","EASMTL6",84,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",85,0)
 . . S EASKP("F")=EASKP("F")+1
"RTN","EASMTL6",86,0)
 . I '$$LTRTYP^EASMTL6B(EASIEN,.EASLTR) Q  ; Check Pending letter
"RTN","EASMTL6",87,0)
 . I EATYP,EASLTR'=EATYP Q  ; Check default or selected letter type
"RTN","EASMTL6",88,0)
 . S DFN=+$G(^EAS(713.1,EASPTR,0))
"RTN","EASMTL6",89,0)
 . I +EASLOC,+EASLOC'=$$GET1^DIQ(2,DFN,27.02,"I") Q  ; Check Location
"RTN","EASMTL6",90,0)
 . I '$$THRSHLD(EASLTR,EASIEN) D  Q  ; Quit if letter threshold not reached
"RTN","EASMTL6",91,0)
 . . S EASKP("T")=EASKP("T")+1
"RTN","EASMTL6",92,0)
 . I $$CHKADR^EASMTL6A(EASPTR),EASLTR'=3 D  Q  ; Check for valid address
"RTN","EASMTL6",93,0)
 . . S EASKP("I")=EASKP("I")+1
"RTN","EASMTL6",94,0)
 . S @EASTMP@($P(EASLOC,U),EASLTR,EASIEN)="" ; Build entry
"RTN","EASMTL6",95,0)
 . S EASKP("CNT")=EASKP("CNT")+1
"RTN","EASMTL6",96,0)
 Q
"RTN","EASMTL6",97,0)
 ;
"RTN","EASMTL6",98,0)
PRINT(EATYP,EASLOC,EASTMP) ; Print batched letters
"RTN","EASMTL6",99,0)
 N RSLTOK,EASABRT,ZTRTN,ZTSAVE
"RTN","EASMTL6",100,0)
 ;
"RTN","EASMTL6",101,0)
 Q:'$D(@EASTMP)
"RTN","EASMTL6",102,0)
 I 'EATYP D
"RTN","EASMTL6",103,0)
 . S ZTRTN="PRNALL^EASMTL6"
"RTN","EASMTL6",104,0)
 E  D
"RTN","EASMTL6",105,0)
 . S ZTRTN="PRNTYP^EASMTL6"
"RTN","EASMTL6",106,0)
 S ZTSAVE("EATYP")="",ZTSAVE("EASLOC")="",ZTSAVE("EASTMP")=""
"RTN","EASMTL6",107,0)
 D EN^XUTMDEVQ(ZTRTN,"EAS MT LETTER PRINT",.ZTSAVE)
"RTN","EASMTL6",108,0)
 Q
"RTN","EASMTL6",109,0)
 ;
"RTN","EASMTL6",110,0)
PRNTYP ; Print a specific type of letter only
"RTN","EASMTL6",111,0)
 N EASIEN,EASLC,EASABRT
"RTN","EASMTL6",112,0)
 ;
"RTN","EASMTL6",113,0)
 S EASLC=+EASLOC,EASIEN=0
"RTN","EASMTL6",114,0)
 F  S EASIEN=$O(@EASTMP@(EASLC,EATYP,EASIEN)) Q:'EASIEN  D  Q:$G(EASABRT)
"RTN","EASMTL6",115,0)
 . D LETTER^EASMTL6A(EASIEN,EATYP,0)
"RTN","EASMTL6",116,0)
 . D UPDSTAT(EASIEN,EATYP) ; Update Letter status file, #713.2
"RTN","EASMTL6",117,0)
 . I $E(IOST,1,2)="C-" D
"RTN","EASMTL6",118,0)
 . . S DIR(0)="E"
"RTN","EASMTL6",119,0)
 . . D ^DIR K DIR
"RTN","EASMTL6",120,0)
 . . S:'Y EASABRT=1
"RTN","EASMTL6",121,0)
 Q
"RTN","EASMTL6",122,0)
 ;
"RTN","EASMTL6",123,0)
PRNALL ; Print all types of letters
"RTN","EASMTL6",124,0)
 N EASLC,EAX,EASIEN,EASABRT
"RTN","EASMTL6",125,0)
 ;
"RTN","EASMTL6",126,0)
 S EASLC=+EASLOC
"RTN","EASMTL6",127,0)
 F EAX=1,2,4 D  Q:$G(EASABRT)
"RTN","EASMTL6",128,0)
 . S EASIEN=0
"RTN","EASMTL6",129,0)
 . F  S EASIEN=$O(@EASTMP@(EASLC,EAX,EASIEN)) Q:'EASIEN  D  Q:$G(EASABRT)
"RTN","EASMTL6",130,0)
 . . D LETTER^EASMTL6A(EASIEN,EAX,0,.RSLTOK)
"RTN","EASMTL6",131,0)
 . . I $E(IOST,1,2)="C-" D  Q:$G(EASABRT)
"RTN","EASMTL6",132,0)
 . . . S DIR(0)="E"
"RTN","EASMTL6",133,0)
 . . . D ^DIR K DIR
"RTN","EASMTL6",134,0)
 . . . S:'Y EASABRT=1
"RTN","EASMTL6",135,0)
 . . D UPDSTAT(EASIEN,EAX) ; Update Letter status file, #713.2
"RTN","EASMTL6",136,0)
 Q
"RTN","EASMTL6",137,0)
 ;
"RTN","EASMTL6",138,0)
THRSHLD(EATYP,EASIEN) ; Check threshold for letter types
"RTN","EASMTL6",139,0)
 ; Input
"RTN","EASMTL6",140,0)
 ;    EATYP  - Letter type to print
"RTN","EASMTL6",141,0)
 ;    EASIEN - IEN for file #713.2
"RTN","EASMTL6",142,0)
 ;
"RTN","EASMTL6",143,0)
 ; Output
"RTN","EASMTL6",144,0)
 ;    RSLT = 1: Letter is inside threshold to print
"RTN","EASMTL6",145,0)
 ;           0: Letter is outside threshold (Don't print)
"RTN","EASMTL6",146,0)
 ;
"RTN","EASMTL6",147,0)
 N DIFF,THRESH,RSLT,ANVDT,MTDT
"RTN","EASMTL6",148,0)
 ;
"RTN","EASMTL6",149,0)
 S RSLT=1
"RTN","EASMTL6",150,0)
 Q:'$G(EATYP)
"RTN","EASMTL6",151,0)
 S THRESH=$S(EATYP=1:60,EATYP=2:30,1:0)
"RTN","EASMTL6",152,0)
 S MTDT=$$GET1^DIQ(713.2,EASIEN,3,"I")
"RTN","EASMTL6",153,0)
 S ANVDT=$$FMADD^XLFDT(MTDT,365)
"RTN","EASMTL6",154,0)
 S DIFF=$$FMDIFF^XLFDT(ANVDT,$$DT^XLFDT)
"RTN","EASMTL6",155,0)
 I DIFF>THRESH S RSLT=0
"RTN","EASMTL6",156,0)
 Q RSLT
"RTN","EASMTL6",157,0)
 ;
"RTN","EASMTL6",158,0)
UPDSTAT(EASN,EAX) ;
"RTN","EASMTL6",159,0)
 N DIE,DR,DA,EAPD,EAFLG,NXTFLG
"RTN","EASMTL6",160,0)
 ;
"RTN","EASMTL6",161,0)
 ; Update Letter status file, #713.2
"RTN","EASMTL6",162,0)
 S DIE="^EAS(713.2,",DA=EASN
"RTN","EASMTL6",163,0)
 S DR=$S(EAX=1:10,EAX=2:13,EAX=4:19,1:0)
"RTN","EASMTL6",164,0)
 Q:'DR
"RTN","EASMTL6",165,0)
 S EAPD=DR_".5",EAFLG=DR-1
"RTN","EASMTL6",166,0)
 S DR=DR_"///1;"_EAPD_"///^S X=$$DT^XLFDT;"_EAFLG_"///0"
"RTN","EASMTL6",167,0)
 S NXTFLG=$S(EAFLG=9:12,EAFLG=12:18,1:0)
"RTN","EASMTL6",168,0)
 S:NXTFLG>0 DR=DR_";"_NXTFLG_"///1"
"RTN","EASMTL6",169,0)
 D ^DIE K DIE
"RTN","EASMTL6",170,0)
 D CLRFLG^EASMTUTL(EAX,EASN)
"RTN","EASMTL6",171,0)
 Q
"RTN","EASMTL6",172,0)
 ;
"RTN","EASMTL6",173,0)
GETFAC(EADFN,EASARY,EASDEF) ;  set facility return address information
"RTN","EASMTL6",174,0)
 N EASITE,EAS4,EASIEN,EAX,RSLT,EAPFAC
"RTN","EASMTL6",175,0)
 ;
"RTN","EASMTL6",176,0)
 S EASDEF=$G(EASDEF)
"RTN","EASMTL6",177,0)
 S RSLT=1
"RTN","EASMTL6",178,0)
 S EASARY("PRIM")=$$SITE^VASITE ; Get Primary facility
"RTN","EASMTL6",179,0)
 S EASARY("PREF")=$$GET1^DIQ(2,EADFN,27.02,"I") ; Get preferred facility
"RTN","EASMTL6",180,0)
 ;
"RTN","EASMTL6",181,0)
 ;  If a preferred facility is not defined, then default to the primary facility
"RTN","EASMTL6",182,0)
 S EAPFAC=EASARY("PREF")
"RTN","EASMTL6",183,0)
 S:'EAPFAC EAPFAC=+EASARY("PRIM")
"RTN","EASMTL6",184,0)
 I EASDEF S EAPFAC=+EASARY("PRIM") ; Toggle to primary facility
"RTN","EASMTL6",185,0)
 Q:'EAPFAC
"RTN","EASMTL6",186,0)
 ;
"RTN","EASMTL6",187,0)
 ;  Get return address for selected facility
"RTN","EASMTL6",188,0)
 D GETS^DIQ(4,EAPFAC,".01;1.01;1.02;1.03;1.04;.02;100","EI","EAS4")
"RTN","EASMTL6",189,0)
 ;
"RTN","EASMTL6",190,0)
 ;  Check for valid return address (ST, City, State)
"RTN","EASMTL6",191,0)
 ;  If preferred facility does not return a valid return address, then get retrun address for primary
"RTN","EASMTL6",192,0)
 S EAPFAC=EAPFAC_","
"RTN","EASMTL6",193,0)
 I EAS4(4,EAPFAC,1.01,"E")']"",EAS4(4,EAPFAC,1.03,"E")']"",EAS4(4,EAPFAC,.02,"E")']"" D
"RTN","EASMTL6",194,0)
 . S:EAPFAC'=+EASARY("PRIM") EAPFAC=+EASARY("PRIM")
"RTN","EASMTL6",195,0)
 . D GETS^DIQ(4,EAPFAC,".01;1.01;1.02;1.03;1.04;.02;100","EI","EAS4")
"RTN","EASMTL6",196,0)
 . S EAPFAC=EAPFAC_","
"RTN","EASMTL6",197,0)
 S EASARY("FAC")=$$GET1^DIQ(4,EAPFAC,.01)
"RTN","EASMTL6",198,0)
 ;
"RTN","EASMTL6",199,0)
 F EAX=1.01,1.02,1.03,1.04,100 D
"RTN","EASMTL6",200,0)
 .  S EASARY(EAX)=EAS4(4,EAPFAC,EAX,"E")
"RTN","EASMTL6",201,0)
 S EASARY(.02)=EAS4(4,EAPFAC,.02,"E")_"^"_$$GET1^DIQ(5,EAS4(4,EAPFAC,.02,"I"),1)
"RTN","EASMTL6",202,0)
 Q
"RTN","EASMTL6A")
0^1^B18551367
"RTN","EASMTL6A",1,0)
EASMTL6A ; MIN/TCM ALB/SCK - AUTOMATED MEANS TEST LETTER-PRINT LETTERS CONT ; 7-13-01
"RTN","EASMTL6A",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14**;MAR 15,2001
"RTN","EASMTL6A",3,0)
 ;
"RTN","EASMTL6A",4,0)
LETTER(EASN,TYPE,EASBJ,EASDEV,EAERR) ;Print letter
"RTN","EASMTL6A",5,0)
 ; Input
"RTN","EASMTL6A",6,0)
 ;     EASN    - File #713.2 IEN
"RTN","EASMTL6A",7,0)
 ;     TYPE    - Letter type
"RTN","EASMTL6A",8,0)
 ;     EASBJ   - Background job status
"RTN","EASMTL6A",9,0)
 ;     EASDEV  - Print device [Optional]
"RTN","EASMTL6A",10,0)
 ;     EAERR   - Returns error condition [Optional]
"RTN","EASMTL6A",11,0)
 ;
"RTN","EASMTL6A",12,0)
 N DFN,EASADD,EASIN,EASNME,EALNE,EASFAC,EAPFAC,MSG,TAB,EAFIEN,EAX,LINE,EASANV,EASX,VADM,VAROOT,EASPRT,OFFSET
"RTN","EASMTL6A",13,0)
 N EASPTR,EASLIEN,EASPRM,EASPRF,EASITE,EASRTE,EASDEM,POP
"RTN","EASMTL6A",14,0)
 ;
"RTN","EASMTL6A",15,0)
 S EASDEV=$G(EASDEV)
"RTN","EASMTL6A",16,0)
 S TAB=3 ; Tab spacing for letters
"RTN","EASMTL6A",17,0)
 S OFFSET=+$$GET1^DIQ(713,1,10) ; Get print offset for address
"RTN","EASMTL6A",18,0)
 ;
"RTN","EASMTL6A",19,0)
 ;  Get patient data for letter
"RTN","EASMTL6A",20,0)
 S EASPTR=$$GET1^DIQ(713.2,EASN,2,"I")
"RTN","EASMTL6A",21,0)
 S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTL6A",22,0)
 ;
"RTN","EASMTL6A",23,0)
 ;; Get patient mailing information
"RTN","EASMTL6A",24,0)
 D GETPAT(DFN,.EASDEM,.EASADD)
"RTN","EASMTL6A",25,0)
 ;;  Get return address info
"RTN","EASMTL6A",26,0)
 D GETFAC^EASMTL6(DFN,.EASFAC,1)
"RTN","EASMTL6A",27,0)
 ;
"RTN","EASMTL6A",28,0)
 I EASDEV D  Q:$G(EAERR)
"RTN","EASMTL6A",29,0)
 . S IOP="`"_EASDEV D ^%ZIS
"RTN","EASMTL6A",30,0)
 . I POP S EAERR=1 Q
"RTN","EASMTL6A",31,0)
 ;
"RTN","EASMTL6A",32,0)
 U IO
"RTN","EASMTL6A",33,0)
 W:'EASBJ @IOF
"RTN","EASMTL6A",34,0)
 W !!
"RTN","EASMTL6A",35,0)
 I EASFAC(100)]"" D
"RTN","EASMTL6A",36,0)
 . W ?TAB+OFFSET,EASFAC(100)
"RTN","EASMTL6A",37,0)
 E  D
"RTN","EASMTL6A",38,0)
 . W ?TAB+OFFSET,"VA MEDICAL CENTER"
"RTN","EASMTL6A",39,0)
 ;
"RTN","EASMTL6A",40,0)
 W !?TAB+OFFSET,EASFAC(1.01)
"RTN","EASMTL6A",41,0)
 I EASFAC(1.02)]"" W !?TAB+OFFSET,EASFAC(1.02)
"RTN","EASMTL6A",42,0)
 W !?TAB+OFFSET,EASFAC(1.03)_" "_$P(EASFAC(.02),U,2)_" "_EASFAC(1.04)
"RTN","EASMTL6A",43,0)
 W !!!?TAB+OFFSET,$$FMTE^XLFDT(DT,1)
"RTN","EASMTL6A",44,0)
 ;
"RTN","EASMTL6A",45,0)
 S EASITE=$$SITE^VASITE
"RTN","EASMTL6A",46,0)
 ;
"RTN","EASMTL6A",47,0)
 S EASNME("FILE")=2,EASNME("IENS")=DFN,EASNME("FIELD")=.01
"RTN","EASMTL6A",48,0)
 W !!!!?TAB+OFFSET,$$NAMEFMT^XLFNAME(.EASNME,"G")
"RTN","EASMTL6A",49,0)
 W !?TAB+OFFSET,EASADD(1)
"RTN","EASMTL6A",50,0)
 ;
"RTN","EASMTL6A",51,0)
 I EASADD(2)]"" W !?TAB+OFFSET,EASADD(2)
"RTN","EASMTL6A",52,0)
 W !?TAB+OFFSET,EASADD(4)
"RTN","EASMTL6A",53,0)
 I +EASADD(5) W " ",$$GET1^DIQ(5,$P(EASADD(5),U),1)
"RTN","EASMTL6A",54,0)
 W " ",$P(EASADD(11),U,2)
"RTN","EASMTL6A",55,0)
 ;
"RTN","EASMTL6A",56,0)
 S EASANV=$$GET1^DIQ(713.2,EASN,3,"I")
"RTN","EASMTL6A",57,0)
 W !!!!,?TAB,"MEANS TEST ANNIVERSARY DATE: ",$$FMTE^XLFDT($$FMADD^XLFDT(EASANV,365))
"RTN","EASMTL6A",58,0)
 ;
"RTN","EASMTL6A",59,0)
 S EASX=$P(EASDEM(5),U)
"RTN","EASMTL6A",60,0)
 W !!,?TAB,"Dear ",$S(EASX="M":"Mr. ",EASX="F":"Ms. ",1:"Mr./Ms. "),$$NAMEFMT^XLFNAME(.EASNME,"O","M"),":"
"RTN","EASMTL6A",61,0)
 ;
"RTN","EASMTL6A",62,0)
 ;  Print letter body
"RTN","EASMTL6A",63,0)
 S EASLIEN=$O(^EAS(713.3,"C",TYPE,0))
"RTN","EASMTL6A",64,0)
 Q:'EASLIEN
"RTN","EASMTL6A",65,0)
 S EALNE=0
"RTN","EASMTL6A",66,0)
 ;
"RTN","EASMTL6A",67,0)
 W !
"RTN","EASMTL6A",68,0)
 F  S EALNE=$O(^EAS(713.3,EASLIEN,1,EALNE)) Q:'EALNE  D
"RTN","EASMTL6A",69,0)
 . S LINE=^EAS(713.3,EASLIEN,1,EALNE,0)
"RTN","EASMTL6A",70,0)
 . I LINE["|ANNVDT|" W !?TAB,$P(LINE,"|ANNVDT|",1),$$FMTE^XLFDT($$FMADD^XLFDT(EASANV,365)),$P(LINE,"|ANNVDT|",2) Q
"RTN","EASMTL6A",71,0)
 . W !?TAB,LINE
"RTN","EASMTL6A",72,0)
 ;
"RTN","EASMTL6A",73,0)
 ; Retrieve division section of letter
"RTN","EASMTL6A",74,0)
 S:$G(EASFAC("PREF")) EAFIEN=$O(^EAS(713.3,EASLIEN,2,"B",+EASFAC("PREF"),0))
"RTN","EASMTL6A",75,0)
 S:'$G(EAFIEN) EAFIEN=$O(^EAS(713.3,EASLIEN,2,"B",+EASFAC("PRIM"),0))
"RTN","EASMTL6A",76,0)
 ;
"RTN","EASMTL6A",77,0)
 I 'EAFIEN D  ; Print default signature block
"RTN","EASMTL6A",78,0)
 . N EAX,LINE
"RTN","EASMTL6A",79,0)
 . F EAX=1:1:9  D
"RTN","EASMTL6A",80,0)
 . . S LINE=$P($T(DEFSIG+EAX),";;",2)
"RTN","EASMTL6A",81,0)
 . . I LINE["|FAC|" W !?TAB,$P(LINE,"|FAC|",1),$S(EASFAC(100)]"":EASFAC(100),1:"VA Medical Center"),$P(LINE,"|FAC|",2) Q
"RTN","EASMTL6A",82,0)
 . . W !?TAB,LINE
"RTN","EASMTL6A",83,0)
 ;
"RTN","EASMTL6A",84,0)
 I EAFIEN D  ; Print division/facility signature block
"RTN","EASMTL6A",85,0)
 . S EALNE=0
"RTN","EASMTL6A",86,0)
 . F  S EALNE=$O(^EAS(713.3,EASLIEN,2,EAFIEN,1,EALNE)) Q:'EALNE  D
"RTN","EASMTL6A",87,0)
 . . W !?TAB,^EAS(713.3,EASLIEN,2,EAFIEN,1,EALNE,0)
"RTN","EASMTL6A",88,0)
 ;
"RTN","EASMTL6A",89,0)
 W !!?TAB,"Enclosure"
"RTN","EASMTL6A",90,0)
 ;
"RTN","EASMTL6A",91,0)
 D:EASDEV ^%ZISC
"RTN","EASMTL6A",92,0)
 Q
"RTN","EASMTL6A",93,0)
 ;
"RTN","EASMTL6A",94,0)
GETPAT(DFN,EASDEM,EASADD) ; Get patient information
"RTN","EASMTL6A",95,0)
 N VAROOT
"RTN","EASMTL6A",96,0)
 ;
"RTN","EASMTL6A",97,0)
 S VAROOT="EASADD"
"RTN","EASMTL6A",98,0)
 D ADD^VADPT
"RTN","EASMTL6A",99,0)
 ;
"RTN","EASMTL6A",100,0)
 S VAROOT="EASDEM"
"RTN","EASMTL6A",101,0)
 D DEM^VADPT
"RTN","EASMTL6A",102,0)
 Q
"RTN","EASMTL6A",103,0)
 ;
"RTN","EASMTL6A",104,0)
CHKADR(EASPTR) ; Check for valid address
"RTN","EASMTL6A",105,0)
 N EASADD,RSLT,DFN,VAROOT
"RTN","EASMTL6A",106,0)
 ;
"RTN","EASMTL6A",107,0)
 S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTL6A",108,0)
 S RSLT=1
"RTN","EASMTL6A",109,0)
 S VAROOT="EASADD"
"RTN","EASMTL6A",110,0)
 D ADD^VADPT
"RTN","EASMTL6A",111,0)
 ;; Check for valid mailing address
"RTN","EASMTL6A",112,0)
 I EASADD(1)]"",EASADD(4)]"",EASADD(5)]"",EASADD(11)]"" S RSLT=0
"RTN","EASMTL6A",113,0)
 D:RSLT ADRERR^EASMTUTL(.EASADD,DFN)
"RTN","EASMTL6A",114,0)
 Q $G(RSLT)
"RTN","EASMTL6A",115,0)
 ;
"RTN","EASMTL6A",116,0)
DEFSIG ; Default closing and signature block
"RTN","EASMTL6A",117,0)
 ;;Thank you for your assistance and cooperation.  If you have any
"RTN","EASMTL6A",118,0)
 ;;questions or need assistance in the completion of the information
"RTN","EASMTL6A",119,0)
 ;;requested, please contact the |FAC| Business 
"RTN","EASMTL6A",120,0)
 ;;Office between 8:00am and 4:00pm Monday through Friday.
"RTN","EASMTL6A",121,0)
 ;;
"RTN","EASMTL6A",122,0)
 ;;Sincerely,
"RTN","EASMTL6A",123,0)
 ;;
"RTN","EASMTL6A",124,0)
 ;;
"RTN","EASMTL6A",125,0)
 ;;
"RTN","EASMTUTL")
0^2^B39076142
"RTN","EASMTUTL",1,0)
EASMTUTL ; ALB/SCK - AUTOMATED MEANS TEST LETTERS UTILITIES ; 7/2/01
"RTN","EASMTUTL",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14**;MAR 15,2001
"RTN","EASMTUTL",3,0)
 ;
"RTN","EASMTUTL",4,0)
 Q
"RTN","EASMTUTL",5,0)
 ;
"RTN","EASMTUTL",6,0)
PAUSE ;  Screen pause, user must press key to continue
"RTN","EASMTUTL",7,0)
 S DIR(0)="FAO",DIR("A")="Press any key to continue..."
"RTN","EASMTUTL",8,0)
 D ^DIR K DIR
"RTN","EASMTUTL",9,0)
 Q
"RTN","EASMTUTL",10,0)
 ;
"RTN","EASMTUTL",11,0)
CLRFLG(EAX,DA) ; Clears flags in File #713.2, For development
"RTN","EASMTUTL",12,0)
 N DIE,DR
"RTN","EASMTUTL",13,0)
 ;
"RTN","EASMTUTL",14,0)
 Q:EAX=1
"RTN","EASMTUTL",15,0)
 S:EAX=2 DR="9///0"
"RTN","EASMTUTL",16,0)
 S:EAX=3 DR="9///0;12///0"
"RTN","EASMTUTL",17,0)
 S:EAX=4 DR="9///0;12///0"
"RTN","EASMTUTL",18,0)
 S:EAX=0 DR="9///0;12///0;18///0"
"RTN","EASMTUTL",19,0)
 S DIE="^EAS(713.2,"
"RTN","EASMTUTL",20,0)
 D ^DIE K DIE
"RTN","EASMTUTL",21,0)
 Q
"RTN","EASMTUTL",22,0)
 ;
"RTN","EASMTUTL",23,0)
LOCK(ACTION) ; Flag IN USE field in EAS Parameters file, #713
"RTN","EASMTUTL",24,0)
 ; Input
"RTN","EASMTUTL",25,0)
 ;   ACTION - Locking action
"RTN","EASMTUTL",26,0)
 ;            1 = Flag IN USE for Automated Generator is running
"RTN","EASMTUTL",27,0)
 ;            0 = Flag IN USE for Automated Generator is not running
"RTN","EASMTUTL",28,0)
 ; Output
"RTN","EASMTUTL",29,0)
 ;        1 if action was successful
"RTN","EASMTUTL",30,0)
 ;        0 if action was not successful
"RTN","EASMTUTL",31,0)
 N RSLT
"RTN","EASMTUTL",32,0)
 ;
"RTN","EASMTUTL",33,0)
 I ACTION,$D(^EAS(713,"ALOCK",1)) Q $G(RSLT)
"RTN","EASMTUTL",34,0)
 ;
"RTN","EASMTUTL",35,0)
 S DIE="^EAS(713,",DA=1,DR="30////^S X=ACTION"
"RTN","EASMTUTL",36,0)
 D ^DIE K DIE
"RTN","EASMTUTL",37,0)
 S RSLT=1
"RTN","EASMTUTL",38,0)
 Q +$G(RSLT)
"RTN","EASMTUTL",39,0)
 ;
"RTN","EASMTUTL",40,0)
ALERT(ERRMSG) ; Post an alert message to the EAS Letters Mail group
"RTN","EASMTUTL",41,0)
 N XMY,XMTEXT,XMDUZ,XMSUB,MSG
"RTN","EASMTUTL",42,0)
 ;
"RTN","EASMTUTL",43,0)
 S MSG(1)="Notification:"
"RTN","EASMTUTL",44,0)
 S MSG(2)=ERRMSG
"RTN","EASMTUTL",45,0)
 ;
"RTN","EASMTUTL",46,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTUTL",47,0)
 S XMTEXT="MSG("
"RTN","EASMTUTL",48,0)
 S XMDUZ="EAS Auto MT Letters"
"RTN","EASMTUTL",49,0)
 S XMSUB="EAS Means Test Letter's Notice"
"RTN","EASMTUTL",50,0)
 D ^XMD
"RTN","EASMTUTL",51,0)
 Q
"RTN","EASMTUTL",52,0)
 ;
"RTN","EASMTUTL",53,0)
ADRERR(EASADD,DFN) ; Error notification for missing or invalid patient address
"RTN","EASMTUTL",54,0)
 N MSG,XMY,XMTEXT,XMDUZ,XMSUB,VAROOT,EASDEM,VA,EASPRF
"RTN","EASMTUTL",55,0)
 ;
"RTN","EASMTUTL",56,0)
 S VAROOT="EASDEM"
"RTN","EASMTUTL",57,0)
 D DEM^VADPT
"RTN","EASMTUTL",58,0)
 D PID^VADPT6
"RTN","EASMTUTL",59,0)
 S EASPRF=$$GET1^DIQ(2,DFN,27.02)
"RTN","EASMTUTL",60,0)
 I EASPRF']"" S EASPRF="No Preferred Facility"
"RTN","EASMTUTL",61,0)
 ;
"RTN","EASMTUTL",62,0)
 S MSG(1)="The following patient does not have a complete permanent mailing"
"RTN","EASMTUTL",63,0)
 S MSG(2)="address.  A means test reminder letter could not be mailed."
"RTN","EASMTUTL",64,0)
 S MSG(3)=" "
"RTN","EASMTUTL",65,0)
 S MSG(4)="       Patient : "_EASDEM(1)
"RTN","EASMTUTL",66,0)
 S MSG(5)="        Last 4 : "_VA("BID")
"RTN","EASMTUTL",67,0)
 S MSG(6)="Address Line 1 : "_EASADD(1)
"RTN","EASMTUTL",68,0)
 S MSG(7)="          City : "_EASADD(4)
"RTN","EASMTUTL",69,0)
 S MSG(8)="         State : "_$P(EASADD(5),U,2)
"RTN","EASMTUTL",70,0)
 S MSG(9)="       Zipcode : "_$P(EASADD(11),U,2)
"RTN","EASMTUTL",71,0)
 S MSG(10)=""
"RTN","EASMTUTL",72,0)
 S MSG(11)="           DFN : "_$G(DFN)
"RTN","EASMTUTL",73,0)
 S MSG(13)=""
"RTN","EASMTUTL",74,0)
 S MSG(14)="This patient's letter entry will stay in 'FLAGGED-TO-PRINT' status until"
"RTN","EASMTUTL",75,0)
 S MSG(15)="the address is corrected."
"RTN","EASMTUTL",76,0)
 ;
"RTN","EASMTUTL",77,0)
 I +EASADD(9)>0!(+EASADD(10)>0) D
"RTN","EASMTUTL",78,0)
 . S MSG(5.5)="** Temporary Address in effect **"
"RTN","EASMTUTL",79,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTUTL",80,0)
 S XMTEXT="MSG("
"RTN","EASMTUTL",81,0)
 S XMDUZ="EAS Auto MT Letters"
"RTN","EASMTUTL",82,0)
 S XMSUB="Incomplete Addr: "_EASPRF
"RTN","EASMTUTL",83,0)
 D ^XMD
"RTN","EASMTUTL",84,0)
 Q
"RTN","EASMTUTL",85,0)
 ;
"RTN","EASMTUTL",86,0)
CLRLCK ;  Clears IN USE field of the EAS MT PARAMETERS if an error occurs and locks the field
"RTN","EASMTUTL",87,0)
 N DIE,DR,DA
"RTN","EASMTUTL",88,0)
 ;
"RTN","EASMTUTL",89,0)
 S DA=1,DIE="^EAS(713,",DR="30///0"
"RTN","EASMTUTL",90,0)
 D ^DIE
"RTN","EASMTUTL",91,0)
 Q
"RTN","EASMTUTL",92,0)
 ;
"RTN","EASMTUTL",93,0)
PROHBIT ; Set or delete the Prohibit fields in the Patient Status file, #713.1
"RTN","EASMTUTL",94,0)
 N DIR,DIRUT,EASF,DIC,DIE,Y,X,EASIEN,DR,DA,DFN,EASN
"RTN","EASMTUTL",95,0)
 ;
"RTN","EASMTUTL",96,0)
 S DIR(0)="S^S:Set Prohibit Flag;R:Remove Prohibit Flag"
"RTN","EASMTUTL",97,0)
 S DIR("A")="Set or remove the MT Prohibit flag"
"RTN","EASMTUTL",98,0)
 S DIR("?")="Select 'S' to set flag, 'R' to remove the flag"
"RTN","EASMTUTL",99,0)
 D ^DIR K DIR
"RTN","EASMTUTL",100,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",101,0)
 S EASF=Y
"RTN","EASMTUTL",102,0)
 ;
"RTN","EASMTUTL",103,0)
 I EASF="R"!(EASF="r") D  Q:$D(DIRUT) 
"RTN","EASMTUTL",104,0)
 . S DIR(0)="PAO^713.1:EMZ"
"RTN","EASMTUTL",105,0)
 . S DIR("A")="Select Patient: "
"RTN","EASMTUTL",106,0)
 . D ^DIR K DIR
"RTN","EASMTUTL",107,0)
 . S EASIEN=+Y
"RTN","EASMTUTL",108,0)
 ;
"RTN","EASMTUTL",109,0)
 I EASF="S"!(EASF="s") D  Q:$D(DIRUT)
"RTN","EASMTUTL",110,0)
 . S DIR(0)="PAO^2:EMZ"
"RTN","EASMTUTL",111,0)
 . S DIR("A")="Select Patient: "
"RTN","EASMTUTL",112,0)
 . D ^DIR K DIR
"RTN","EASMTUTL",113,0)
 . Q:$D(DIRUT)
"RTN","EASMTUTL",114,0)
 . S DFN=+Y
"RTN","EASMTUTL",115,0)
 . I '$D(^EAS(713.1,"B",DFN)) D  Q:$D(DIRUT)
"RTN","EASMTUTL",116,0)
 . . S DIR(0)="Y",DIR("B")="YES"
"RTN","EASMTUTL",117,0)
 . . S DIR("A")="Add patient to the Patient Status File"
"RTN","EASMTUTL",118,0)
 . . D ^DIR K DIR
"RTN","EASMTUTL",119,0)
 . . Q:$D(DIRUT)
"RTN","EASMTUTL",120,0)
 . . I 'Y S DIRUT=1 Q
"RTN","EASMTUTL",121,0)
 . . S DIC="^EAS(713.1,",DIC(0)="Z",X=DFN
"RTN","EASMTUTL",122,0)
 . . D FILE^DICN
"RTN","EASMTUTL",123,0)
 . . S EASIEN=+Y
"RTN","EASMTUTL",124,0)
 . I $D(^EAS(713.1,"B",DFN)) S EASIEN=$O(^EAS(713.1,"B",DFN,0))
"RTN","EASMTUTL",125,0)
 ;
"RTN","EASMTUTL",126,0)
 Q:'$G(EASIEN)
"RTN","EASMTUTL",127,0)
 ;
"RTN","EASMTUTL",128,0)
 S DIE="^EAS(713.1,",DA=EASIEN
"RTN","EASMTUTL",129,0)
 S:EASF="S" DR="2///YES;3;5///^S X=$$NOW^XLFDT;4///^S X=DUZ;10"
"RTN","EASMTUTL",130,0)
 S:EASF="R" DR="2///@;3///@;5///@;4///@;10///@"
"RTN","EASMTUTL",131,0)
 D ^DIE K DIE
"RTN","EASMTUTL",132,0)
 ;
"RTN","EASMTUTL",133,0)
 Q
"RTN","EASMTUTL",134,0)
 ;
"RTN","EASMTUTL",135,0)
EDTLTRS ;
"RTN","EASMTUTL",136,0)
 N DIR,EASIEN
"RTN","EASMTUTL",137,0)
 ;
"RTN","EASMTUTL",138,0)
 S DIR(0)="P^713.3:EMZ"
"RTN","EASMTUTL",139,0)
 S DIR("A")="Select Letter"
"RTN","EASMTUTL",140,0)
 D ^DIR K DIR
"RTN","EASMTUTL",141,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",142,0)
 S EASIEN=+Y
"RTN","EASMTUTL",143,0)
 ;
"RTN","EASMTUTL",144,0)
 S DIE="^EAS(713.3,",DA=EASIEN,DR="4"
"RTN","EASMTUTL",145,0)
 D ^DIE
"RTN","EASMTUTL",146,0)
 Q
"RTN","EASMTUTL",147,0)
 ;
"RTN","EASMTUTL",148,0)
MTRTN ; Update the letter status file, #713.2, with returned Means Test information
"RTN","EASMTUTL",149,0)
 N DIE,DIC,EASIEN,DR,DA,Y
"RTN","EASMTUTL",150,0)
 ;
"RTN","EASMTUTL",151,0)
 S DIC="^EAS(713.2,",DIC(0)="AEQM",DIC("A")="Select the Letter Status entry to update: "
"RTN","EASMTUTL",152,0)
 D ^DIC K DIC
"RTN","EASMTUTL",153,0)
 Q:Y<0
"RTN","EASMTUTL",154,0)
 S EASIEN=+Y
"RTN","EASMTUTL",155,0)
 ;
"RTN","EASMTUTL",156,0)
 S DIE="^EAS(713.2,",DA=EASIEN
"RTN","EASMTUTL",157,0)
 S DR="4;I X=0 S Y=0;5;7;6////^S X=DUZ"
"RTN","EASMTUTL",158,0)
 L +^EAS(713.2,EASIEN):0 I $T D 
"RTN","EASMTUTL",159,0)
 . D ^DIE K DIE
"RTN","EASMTUTL",160,0)
 E  W !,$CHAR(7),"Entry is being edited by another user."
"RTN","EASMTUTL",161,0)
 L -^EAS(713.2,EASIEN)
"RTN","EASMTUTL",162,0)
 ;
"RTN","EASMTUTL",163,0)
 Q
"RTN","EASMTUTL",164,0)
 ;
"RTN","EASMTUTL",165,0)
DECEASED(EASIEN,DFN) ;  Check deceased status for patient
"RTN","EASMTUTL",166,0)
 N RSLT,EADEM,EAS1,VAROOT
"RTN","EASMTUTL",167,0)
 ;
"RTN","EASMTUTL",168,0)
 S EASIEN=$G(EASIEN)
"RTN","EASMTUTL",169,0)
 S DFN=$G(DFN)
"RTN","EASMTUTL",170,0)
 I EASIEN>0 D
"RTN","EASMTUTL",171,0)
 . S EAS1=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EASMTUTL",172,0)
 . S DFN=$$GET1^DIQ(713.1,EAS1,.01,"I")
"RTN","EASMTUTL",173,0)
 Q:'DFN 0
"RTN","EASMTUTL",174,0)
 S RSLT=0
"RTN","EASMTUTL",175,0)
 ;
"RTN","EASMTUTL",176,0)
 S VAROOT="EADEM"
"RTN","EASMTUTL",177,0)
 D DEM^VADPT
"RTN","EASMTUTL",178,0)
 S:+EADEM(6) RSLT=1
"RTN","EASMTUTL",179,0)
 D KVA^VADPT
"RTN","EASMTUTL",180,0)
 Q RSLT
"RTN","EASMTUTL",181,0)
 ;
"RTN","EASMTUTL",182,0)
CHECKMT(EASPT,EAIEN) ; Check current MT status
"RTN","EASMTUTL",183,0)
 N DFN,RTN,EACHK,DIE,DR,DA
"RTN","EASMTUTL",184,0)
 ;
"RTN","EASMTUTL",185,0)
 S RTN=0
"RTN","EASMTUTL",186,0)
 I '$G(EASPT) S RTN=1 G CHKQ ; Safety check
"RTN","EASMTUTL",187,0)
 S DFN=$$GET1^DIQ(713.1,EASPT,.01,"I") ; Get DFN
"RTN","EASMTUTL",188,0)
 I '$G(DFN) S RTN=1 G CHKQ ; Safety check
"RTN","EASMTUTL",189,0)
 ;
"RTN","EASMTUTL",190,0)
 S EACHK=$$MTCHK^EASMTCHK(DFN,"L") ; Check current MT to see if it's changed
"RTN","EASMTUTL",191,0)
 I 'EACHK D  ; If MT no longer required, update letter status file
"RTN","EASMTUTL",192,0)
 . S DIE="^EAS(713.2,",DA=EAIEN
"RTN","EASMTUTL",193,0)
 . S DR="4///YES;5///TODAY;7///AUTO-GENERATED;9///NO;12///NO;18///NO"
"RTN","EASMTUTL",194,0)
 . D ^DIE K DIE ;; Remove before release
"RTN","EASMTUTL",195,0)
 . S RTN=1
"RTN","EASMTUTL",196,0)
 ;
"RTN","EASMTUTL",197,0)
CHKQ Q RTN
"RTN","EASMTUTL",198,0)
 ;
"RTN","EASMTUTL",199,0)
FUTMT(EASIEN) ; Check for a future MT
"RTN","EASMTUTL",200,0)
 ;  Input
"RTN","EASMTUTL",201,0)
 ;    EASIEN - IEN for record in Letter Status file
"RTN","EASMTUTL",202,0)
 ;
"RTN","EASMTUTL",203,0)
 ;  Output
"RTN","EASMTUTL",204,0)
 ;     1 - Future MT exist's (API call)
"RTN","EASMTUTL",205,0)
 ;     0 - Future MT does not exist
"RTN","EASMTUTL",206,0)
 ;
"RTN","EASMTUTL",207,0)
 N EASPTR,DFN,EASFUT
"RTN","EASMTUTL",208,0)
 ;
"RTN","EASMTUTL",209,0)
 S RTN=0
"RTN","EASMTUTL",210,0)
 S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EASMTUTL",211,0)
 S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTUTL",212,0)
 ;
"RTN","EASMTUTL",213,0)
 ;; Call API for future MT check
"RTN","EASMTUTL",214,0)
 S EASFUT=$$FUT^DGMTU(DFN)
"RTN","EASMTUTL",215,0)
 ;
"RTN","EASMTUTL",216,0)
 I +$G(EASFUT) D  ; Turn off letters if future MT present
"RTN","EASMTUTL",217,0)
 . Q:'EASIEN
"RTN","EASMTUTL",218,0)
 . S DIE="^EAS(713.2,",DA=EASIEN
"RTN","EASMTUTL",219,0)
 . S DR="4///YES;5///TODAY;7///FUTURE MEANS TEST;9///NO;12///NO;18///NO"
"RTN","EASMTUTL",220,0)
 . D ^DIE K DIE
"RTN","EASMTUTL",221,0)
 . S RTN=1
"RTN","EASMTUTL",222,0)
 Q RTN
"VER")
8.0^22
**END**
**END**
