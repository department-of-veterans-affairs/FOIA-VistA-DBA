Released SD*5.3*327 SEQ #348
Extracted from mail message
**KIDS**:SD*5.3*327^

**INSTALL NAME**
SD*5.3*327
"BLD",6167,0)
SD*5.3*327^SCHEDULING^0^3050809^y
"BLD",6167,1,0)
^^6^6^3050607^
"BLD",6167,1,1,0)
 
"BLD",6167,1,2,0)
 
"BLD",6167,1,3,0)
 
"BLD",6167,1,4,0)
Adds appointment info to file 409.3 and provides option to disposition EWL
"BLD",6167,1,5,0)
entries after making appointment.  Creates background job to monitor EWL
"BLD",6167,1,6,0)
Wait List types and notifies user by mailman of changes.
"BLD",6167,4,0)
^9.64PA^409.3^1
"BLD",6167,4,409.3,0)
409.3
"BLD",6167,4,409.3,222)
y^n^f^^^^n^^n
"BLD",6167,4,409.3,224)

"BLD",6167,4,"B",409.3,409.3)

"BLD",6167,6)
17^
"BLD",6167,"ABPKG")
n
"BLD",6167,"KRN",0)
^9.67PA^8989.52^19
"BLD",6167,"KRN",.4,0)
.4
"BLD",6167,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",6167,"KRN",.4,"NM",1,0)
SDWLRO    FILE #409.3^409.3^0
"BLD",6167,"KRN",.4,"NM","B","SDWLRO    FILE #409.3",1)

"BLD",6167,"KRN",.401,0)
.401
"BLD",6167,"KRN",.401,"NM",0)
^9.68A^1^1
"BLD",6167,"KRN",.401,"NM",1,0)
SDWLRO    FILE #409.3^409.3^0
"BLD",6167,"KRN",.401,"NM","B","SDWLRO    FILE #409.3",1)

"BLD",6167,"KRN",.402,0)
.402
"BLD",6167,"KRN",.403,0)
.403
"BLD",6167,"KRN",.5,0)
.5
"BLD",6167,"KRN",.84,0)
.84
"BLD",6167,"KRN",3.6,0)
3.6
"BLD",6167,"KRN",3.8,0)
3.8
"BLD",6167,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",6167,"KRN",3.8,"NM",1,0)
SD EWL BACKGROUND UPDATE^^0
"BLD",6167,"KRN",3.8,"NM","B","SD EWL BACKGROUND UPDATE",1)

"BLD",6167,"KRN",9.2,0)
9.2
"BLD",6167,"KRN",9.8,0)
9.8
"BLD",6167,"KRN",9.8,"NM",0)
^9.68A^14^14
"BLD",6167,"KRN",9.8,"NM",1,0)
SDWLQSC^^0^B46613371
"BLD",6167,"KRN",9.8,"NM",2,0)
SDWLMSG^^0^B26877762
"BLD",6167,"KRN",9.8,"NM",3,0)
SDWLI^^0^B50070111
"BLD",6167,"KRN",9.8,"NM",4,0)
SDFORM^^0^B1409070
"BLD",6167,"KRN",9.8,"NM",5,0)
SDWLR^^1^
"BLD",6167,"KRN",9.8,"NM",6,0)
SDM4^^0^B8861998
"BLD",6167,"KRN",9.8,"NM",7,0)
SDM1^^0^B34155248
"BLD",6167,"KRN",9.8,"NM",8,0)
SDAMWI^^0^B13138913
"BLD",6167,"KRN",9.8,"NM",9,0)
SDAM2^^0^B29301501
"BLD",6167,"KRN",9.8,"NM",10,0)
SDMM^^0^B40995043
"BLD",6167,"KRN",9.8,"NM",11,0)
SDMM1^^0^B15400257
"BLD",6167,"KRN",9.8,"NM",12,0)
SDM1A^^0^B39690265
"BLD",6167,"KRN",9.8,"NM",13,0)
SDWLPL^^0^B29704697
"BLD",6167,"KRN",9.8,"NM",14,0)
SDWLEVAL^^0^B82936763
"BLD",6167,"KRN",9.8,"NM","B","SDAM2",9)

"BLD",6167,"KRN",9.8,"NM","B","SDAMWI",8)

"BLD",6167,"KRN",9.8,"NM","B","SDFORM",4)

"BLD",6167,"KRN",9.8,"NM","B","SDM1",7)

"BLD",6167,"KRN",9.8,"NM","B","SDM1A",12)

"BLD",6167,"KRN",9.8,"NM","B","SDM4",6)

"BLD",6167,"KRN",9.8,"NM","B","SDMM",10)

"BLD",6167,"KRN",9.8,"NM","B","SDMM1",11)

"BLD",6167,"KRN",9.8,"NM","B","SDWLEVAL",14)

"BLD",6167,"KRN",9.8,"NM","B","SDWLI",3)

"BLD",6167,"KRN",9.8,"NM","B","SDWLMSG",2)

"BLD",6167,"KRN",9.8,"NM","B","SDWLPL",13)

"BLD",6167,"KRN",9.8,"NM","B","SDWLQSC",1)

"BLD",6167,"KRN",9.8,"NM","B","SDWLR",5)

"BLD",6167,"KRN",19,0)
19
"BLD",6167,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",6167,"KRN",19,"NM",1,0)
SD WAIT LIST REPORTS MENU^^3
"BLD",6167,"KRN",19,"NM",2,0)
SD WAIT LIST REOPEN ENTRIES^^0
"BLD",6167,"KRN",19,"NM",3,0)
SD EWL BACKGROUND JOB^^0
"BLD",6167,"KRN",19,"NM","B","SD EWL BACKGROUND JOB",3)

"BLD",6167,"KRN",19,"NM","B","SD WAIT LIST REOPEN ENTRIES",2)

"BLD",6167,"KRN",19,"NM","B","SD WAIT LIST REPORTS MENU",1)

"BLD",6167,"KRN",19.1,0)
19.1
"BLD",6167,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6167,"KRN",101,0)
101
"BLD",6167,"KRN",101,"NM",0)
^9.68A^^
"BLD",6167,"KRN",409.61,0)
409.61
"BLD",6167,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",6167,"KRN",771,0)
771
"BLD",6167,"KRN",771,"NM",0)
^9.68A^^
"BLD",6167,"KRN",870,0)
870
"BLD",6167,"KRN",870,"NM",0)
^9.68A^^
"BLD",6167,"KRN",8989.51,0)
8989.51
"BLD",6167,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",6167,"KRN",8989.52,0)
8989.52
"BLD",6167,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",6167,"KRN",8994,0)
8994
"BLD",6167,"KRN",8994,"NM",0)
^9.68A^^
"BLD",6167,"KRN","B",.4,.4)

"BLD",6167,"KRN","B",.401,.401)

"BLD",6167,"KRN","B",.402,.402)

"BLD",6167,"KRN","B",.403,.403)

"BLD",6167,"KRN","B",.5,.5)

"BLD",6167,"KRN","B",.84,.84)

"BLD",6167,"KRN","B",3.6,3.6)

"BLD",6167,"KRN","B",3.8,3.8)

"BLD",6167,"KRN","B",9.2,9.2)

"BLD",6167,"KRN","B",9.8,9.8)

"BLD",6167,"KRN","B",19,19)

"BLD",6167,"KRN","B",19.1,19.1)

"BLD",6167,"KRN","B",101,101)

"BLD",6167,"KRN","B",409.61,409.61)

"BLD",6167,"KRN","B",771,771)

"BLD",6167,"KRN","B",870,870)

"BLD",6167,"KRN","B",8989.51,8989.51)

"BLD",6167,"KRN","B",8989.52,8989.52)

"BLD",6167,"KRN","B",8994,8994)

"BLD",6167,"QUES",0)
^9.62^^
"BLD",6167,"REQB",0)
^9.611^5^5
"BLD",6167,"REQB",1,0)
SD*5.3*263^1
"BLD",6167,"REQB",2,0)
SD*5.3*296^1
"BLD",6167,"REQB",3,0)
SD*5.3*380^1
"BLD",6167,"REQB",4,0)
SD*5.3*408^1
"BLD",6167,"REQB",5,0)
SD*5.3*427^1
"BLD",6167,"REQB","B","SD*5.3*263",1)

"BLD",6167,"REQB","B","SD*5.3*296",2)

"BLD",6167,"REQB","B","SD*5.3*380",3)

"BLD",6167,"REQB","B","SD*5.3*408",4)

"BLD",6167,"REQB","B","SD*5.3*427",5)

"FIA",409.3)
SD WAIT LIST
"FIA",409.3,0)
^SDWL(409.3,
"FIA",409.3,0,0)
409.3IP
"FIA",409.3,0,1)
y^n^f^^^^n^^n
"FIA",409.3,0,10)

"FIA",409.3,0,11)

"FIA",409.3,0,"RLRO")

"FIA",409.3,0,"VR")
5.3^SD
"FIA",409.3,409.3)
0
"FIA",409.3,409.324)
0
"FIA",409.3,409.33)
0
"KRN",.4,1451,-1)
0^1
"KRN",.4,1451,0)
SDWLRO^3050422.1506^@^409.3^^@^3050714
"KRN",.4,1451,"F",1)
.01;L25;X~"REOPEN REASON: ";C42~29;X~"EWL TYPE: ";C1~4;X;L25~"DESIRED DATE: ";C42~22;X;~"APPT: ";C1~13.2;L25;C7;X~13;X;d;L20;C36~13.8;L20;C60;X~
"KRN",.4,1451,"F",2)
"REOPEN COMMENTS: ";C1~30;X~"";S1~
"KRN",.4,1451,"H")
EWL REOPEN REASON
"KRN",.401,888,-1)
0^1
"KRN",.401,888,0)
SDWLRO^3050323.1327^@^409.3^^@^3050714
"KRN",.401,888,2,0)
^.4014^2^2
"KRN",.401,888,2,1,0)
409.3^23^CURRENT STATUS^@^^^^^^3
"KRN",.401,888,2,1,"F")
Nz^O^O (OPEN)
"KRN",.401,888,2,1,"GET")
S DISX(1)=$P($G(^SDWL(409.3,D0,0)),U,17)
"KRN",.401,888,2,1,"QCON")
I DISX(1)="O"
"KRN",.401,888,2,1,"SER")
0.7260^0.7260
"KRN",.401,888,2,1,"T")
O^O^O (OPEN)
"KRN",.401,888,2,1,"TXT")
CURRENT STATUS equals O (OPEN)
"KRN",.401,888,2,2,0)
409.3^29^REOPEN REASON^'@^^^^^^3
"KRN",.401,888,2,2,"GET")
S DISX(2)=$P($G(^SDWL(409.3,D0,1)),U)
"KRN",.401,888,2,2,"QCON")
I DISX(2)'=""
"KRN",.401,888,2,2,"SER")
0.9863^0.9863
"KRN",.401,888,2,2,"TXT")
REOPEN REASON not null
"KRN",.401,888,2,"B",409.3,1)

"KRN",.401,888,2,"B",409.3,2)

"KRN",.401,888,"%D",0)
^.4012^1^1^3050323^^^^
"KRN",.401,888,"%D",1,0)
Sort template to display field 29 REOPEN REASON.
"KRN",3.8,224,-1)
0^1
"KRN",3.8,224,0)
SD EWL BACKGROUND UPDATE^PU^^^^^
"KRN",3.8,224,2,0)
^3.801^2^2^3050601^^^^
"KRN",3.8,224,2,1,0)
Alerts users when status of SD WAIT LIST types(pcmm,clinic,specialty)
"KRN",3.8,224,2,2,0)
change.
"KRN",3.8,224,3)

"KRN",19,9629,-1)
3^1
"KRN",19,9629,0)
SD WAIT LIST REPORTS MENU^Wait List (Sch/PCMM) Reports^^M^^^^^^^^^^1^1
"KRN",19,9629,10,0)
^19.01IP^9^9
"KRN",19,9629,10,9,0)
10427^6^6
"KRN",19,9629,10,9,"^")
SD WAIT LIST REOPEN ENTRIES
"KRN",19,9629,15)
D EN^SDWLKIL
"KRN",19,9629,20)
D EN^SDWLKIL
"KRN",19,9629,99)
60119,83111
"KRN",19,9629,"U")
WAIT LIST (SCH/PCMM) REPORTS
"KRN",19,10427,-1)
0^2
"KRN",19,10427,0)
SD WAIT LIST REOPEN ENTRIES^EWL Reopened Entries^^P^^^^^^^^
"KRN",19,10427,1,0)
^19.06^1^1^3050714^^^^
"KRN",19,10427,1,1,0)
Option to display all open EWL entries that have a REOPEN REASON.
"KRN",19,10427,60)
SDWL(409.3,
"KRN",19,10427,63)
[SDWLRO]
"KRN",19,10427,64)
[SDWLRO]
"KRN",19,10427,"U")
EWL REOPENED ENTRIES
"KRN",19,10428,-1)
0^3
"KRN",19,10428,0)
SD EWL BACKGROUND JOB^SD EWL BACKGROUND JOB^^R^^^^^^^^
"KRN",19,10428,1,0)
^19.06^2^2^3050715^^^^
"KRN",19,10428,1,1,0)
Displays changes in SD WAIT LIST types using mail group SD EWL BACKGROUND
"KRN",19,10428,1,2,0)
UPDATE.  
"KRN",19,10428,25)
EN2^SDWLQSC
"KRN",19,10428,200.9)
y
"KRN",19,10428,"U")
SD EWL BACKGROUND JOB
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",48,-1)
1^1
"PKG",48,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",48,22,0)
^9.49I^1^1
"PKG",48,22,1,0)
5.3^2930813^2960613
"PKG",48,22,1,"PAH",1,0)
327^3050809^123456967
"PKG",48,22,1,"PAH",1,1,0)
^^6^6^3050809
"PKG",48,22,1,"PAH",1,1,1,0)
 
"PKG",48,22,1,"PAH",1,1,2,0)
 
"PKG",48,22,1,"PAH",1,1,3,0)
 
"PKG",48,22,1,"PAH",1,1,4,0)
Adds appointment info to file 409.3 and provides option to disposition EWL
"PKG",48,22,1,"PAH",1,1,5,0)
entries after making appointment.  Creates background job to monitor EWL
"PKG",48,22,1,"PAH",1,1,6,0)
Wait List types and notifies user by mailman of changes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","SDAM2")
0^9^B29301501
"RTN","SDAM2",1,0)
SDAM2 ;ALB/MJK - Appt Mgt (cont); 12/1/91 ; 5/24/05 8:11am
"RTN","SDAM2",2,0)
 ;;5.3;Scheduling;**250,296,327**;Aug 13, 1993
"RTN","SDAM2",3,0)
 ;
"RTN","SDAM2",4,0)
CI ; -- protocol SDAM APPT CHECK IN entry pt
"RTN","SDAM2",5,0)
 ; input:  VALMY := array entries
"RTN","SDAM2",6,0)
 ;
"RTN","SDAM2",7,0)
 N SDI,SDAT,VALMY,SDAMCIDT,SDCIACT
"RTN","SDAM2",8,0)
 D SEL^VALM2 S SDI=0,SDCIACT=""
"RTN","SDAM2",9,0)
 D NOW^%DTC S SDAMCIDT=$P(%,".")_"."_$E($P(%,".",2)_"0000",1,4)
"RTN","SDAM2",10,0)
 F  S SDI=$O(VALMY(SDI)) Q:'SDI  I $D(^TMP("SDAMIDX",$J,SDI)) K SDAT D
"RTN","SDAM2",11,0)
 .S SDAT=^TMP("SDAMIDX",$J,SDI)
"RTN","SDAM2",12,0)
 .W !,^TMP("SDAM",$J,+SDAT,0)
"RTN","SDAM2",13,0)
 .D:VALMCC SELECT^VALM10(+SDAT,1)
"RTN","SDAM2",14,0)
 .D ONE($P(SDAT,U,2),$P(SDAT,U,4),$P(SDAT,U,3),$P(SDAT,U,5),0,SDAMCIDT)
"RTN","SDAM2",15,0)
 .D:VALMCC SELECT^VALM10(+SDAT,0)
"RTN","SDAM2",16,0)
 S VALMBCK=$S(VALMCC:"",1:"R")
"RTN","SDAM2",17,0)
 Q
"RTN","SDAM2",18,0)
 ;
"RTN","SDAM2",19,0)
ONE(DFN,SDCL,SDT,SDDA,SDASK,SDAMCIDT) ; -- check in one appt
"RTN","SDAM2",20,0)
 ; input:  DFN := ifn of patient
"RTN","SDAM2",21,0)
 ;        SDCL := clinic# 
"RTN","SDAM2",22,0)
 ;         SDT := appt d/t
"RTN","SDAM2",23,0)
 ;        SDDA := ifn in ^SC multiple or null
"RTN","SDAM2",24,0)
 ;       SDASK := ask d/t of ci always [1|yes or 0|no]
"RTN","SDAM2",25,0)
 ;    SDAMCIDT := ci date/time [optional]
"RTN","SDAM2",26,0)
 ;
"RTN","SDAM2",27,0)
 I $D(XRTL) D T0^%ZOSV
"RTN","SDAM2",28,0)
 S:'SDDA SDDA=$$FIND(DFN,SDT,SDCL)
"RTN","SDAM2",29,0)
 I 'SDDA W !!,*7,"You cannot check in this appointment." D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",30,0)
 N SDATA,SDCIHDL,X S SDATA=SDDA_U_DFN_U_SDT_U_SDCL,SDCIHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDAM2",31,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDCIHDL)
"RTN","SDAM2",32,0)
 I '$D(^SD(409.63,"ACI",1,+SDATA("BEFORE","STATUS"))) W !!,*7,"You cannot check in this appointment." D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",33,0)
 ; *** mt blocking removed
"RTN","SDAM2",34,0)
 ;S X="EASMTCHK" X ^%ZOSF("TEST") I $T,$G(EASACT)'="W",$$MT^EASMTCHK(DFN,"","C",SDT) D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",35,0)
 I $P(SDT,".")>DT W !!,*7,"It is too soon to check in this appointment." D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",36,0)
 S:'$D(^SC(SDCL,"S",0)) ^(0)="^44.001DA^^"
"RTN","SDAM2",37,0)
 S DR="",X=$G(^SC(SDCL,"S",SDT,1,SDDA,"C"))
"RTN","SDAM2",38,0)
 I +X S DR=309
"RTN","SDAM2",39,0)
 ; -- already co'ed
"RTN","SDAM2",40,0)
 I DR="",$P(X,U,3) D
"RTN","SDAM2",41,0)
 .S DR="309//"
"RTN","SDAM2",42,0)
 .I $P(^SC(SDCL,0),U,24)!(SDASK) S DR=DR_$$FTIME^VALM1($P(X,U,3)) Q
"RTN","SDAM2",43,0)
 .S DR=DR_"//^S X="_$P(X,U,3)
"RTN","SDAM2",44,0)
 ;
"RTN","SDAM2",45,0)
 I DR="",$P(^SC(SDCL,0),U,24)!(SDASK) S DR="309//"_$S(SDAMCIDT:$$FTIME^VALM1(SDAMCIDT),1:"NOW")
"RTN","SDAM2",46,0)
 I DR="" S DR="309///"_$S(SDAMCIDT:"/"_SDAMCIDT,1:"NOW")
"RTN","SDAM2",47,0)
 S DA(2)=SDCL,DA(1)=SDT,DA=SDDA,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1," D ^DIE
"RTN","SDAM2",48,0)
 D AFTER^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDCIHDL)
"RTN","SDAM2",49,0)
 I '$P(SDATA("AFTER","STATUS"),U,4),'$P(SDATA("BEFORE","STATUS"),U,4) W !?8,*7,"...appointment has not been checked in" D PAUSE^VALM1
"RTN","SDAM2",50,0)
 I SDATA("BEFORE","STATUS")'=SDATA("AFTER","STATUS") D
"RTN","SDAM2",51,0)
 .I $P(SDATA("AFTER","STATUS"),U,4),'$P(SDATA("BEFORE","STATUS"),U,4) W !?8,"...checked in ",$$FTIME^VALM1($P(SDATA("AFTER","STATUS"),U,4))
"RTN","SDAM2",52,0)
 .I $D(SDCIACT) D
"RTN","SDAM2",53,0)
 ..S Y=SDATA("AFTER","STATUS"),Y1=$P(Y,U,4),Y=$P(Y,U,3)
"RTN","SDAM2",54,0)
 ..I $P(SDATA("BEFORE","STATUS"),U,3)'=Y D UPD($$LOWER^VALM1(Y),"STAT",+SDAT,1),UPD("","TIME",+SDAT,1)
"RTN","SDAM2",55,0)
 ..I $P(SDATA("AFTER","STATUS"),U,3)["CHECKED IN" D UPD($S($P(Y1,".")=DT:$$TIME^SDAM1($P(Y1,".",2)),1:"     "),"TIME",+SDAT,1)
"RTN","SDAM2",56,0)
 .D EVT^SDAMEVT(.SDATA,4,0,SDCIHDL) ; 4 := ci evt , 0 := interactive mode
"RTN","SDAM2",57,0)
 I $D(XRT0) S XRTN="SDAM2" D T1^%ZOSV
"RTN","SDAM2",58,0)
ONEQ K DA,DIE,DR,DQ,DE,Y,Y1 Q
"RTN","SDAM2",59,0)
 ;
"RTN","SDAM2",60,0)
 ;
"RTN","SDAM2",61,0)
FIND(DFN,SDT,SDCL) ; -- return appt ifn for pat
"RTN","SDAM2",62,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM2",63,0)
 ;                 SDT := appt d/t
"RTN","SDAM2",64,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM2",65,0)
 ;  output: [returned] := ifn if pat has appt on date/time
"RTN","SDAM2",66,0)
 ;
"RTN","SDAM2",67,0)
 N Y
"RTN","SDAM2",68,0)
 S Y=0 F  S Y=$O(^SC(SDCL,"S",SDT,1,Y)) Q:'Y  I $D(^(Y,0)),DFN=+^(0),$D(^DPT(+DFN,"S",SDT,0)),$$VALID(DFN,SDCL,SDT,Y) Q
"RTN","SDAM2",69,0)
 Q Y
"RTN","SDAM2",70,0)
 ;
"RTN","SDAM2",71,0)
UPD(TEXT,FLD,LINE,SAVE) ; -- update data for screen
"RTN","SDAM2",72,0)
 D FLDTEXT^VALM10(LINE,FLD,TEXT)
"RTN","SDAM2",73,0)
 D:VALMCC CNTRL^VALM10(LINE,$P(VALMDDF(FLD),U,2),$P(VALMDDF(FLD),U,3),IOINHI,IOINORM,+$G(SAVE))
"RTN","SDAM2",74,0)
 Q
"RTN","SDAM2",75,0)
 ;
"RTN","SDAM2",76,0)
MAKE ; -- make appt action
"RTN","SDAM2",77,0)
 N ORACTION,ORVP,XQORQUIT,SDAMERR
"RTN","SDAM2",78,0)
 D FULL^VALM1
"RTN","SDAM2",79,0)
 W !!,VALMHDR(1)
"RTN","SDAM2",80,0)
 D ^SDM
"RTN","SDAM2",81,0)
 I '$D(SDAMERR) D BLD^SDAM
"RTN","SDAM2",82,0)
 I $D(SDAMERR) D PAUSE^VALM1
"RTN","SDAM2",83,0)
 D SDM^SDKILL S VALMBCK="R"
"RTN","SDAM2",84,0)
 Q
"RTN","SDAM2",85,0)
 ;
"RTN","SDAM2",86,0)
WI ; -- walk-in visit action
"RTN","SDAM2",87,0)
 S VALMBCK="R"
"RTN","SDAM2",88,0)
 D FULL^VALM1
"RTN","SDAM2",89,0)
 I SDAMTYP="P" I $$CL^SDAMWI(SDFN) D BLD^SDAM1
"RTN","SDAM2",90,0)
 I SDAMTYP="C" I $$PT^SDAMWI(SDCLN) D BLD^SDAM3
"RTN","SDAM2",91,0)
 ;evaluate wait list ;SD/327
"RTN","SDAM2",92,0)
EWLCHK ;check if patient has any open EWL entries (SD/372)
"RTN","SDAM2",93,0)
 ;CLN expected as clinic IEN
"RTN","SDAM2",94,0)
 I '$D(DFN) Q
"RTN","SDAM2",95,0)
 I $D(SDT) N SDEV D EN^SDWLEVAL(DFN,.SDEV) D
"RTN","SDAM2",96,0)
 .I SDEV,$L(SDEV(1))>0 W !,SDEV(1),! D
"RTN","SDAM2",97,0)
 ..;display appointment
"RTN","SDAM2",98,0)
 ..K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDAM2",99,0)
 ..N SD S SD=SDT
"RTN","SDAM2",100,0)
 ..;S SC=+$G(SDATA)
"RTN","SDAM2",101,0)
 ..I '$D(SC) S SC=+$G(CLN)
"RTN","SDAM2",102,0)
 ..W:$D(IOF) @IOF D APPT^SDWLEVAL(DFN,SD,SC)
"RTN","SDAM2",103,0)
 ..Q:'$D(^TMP($J,"APPT"))
"RTN","SDAM2",104,0)
 ..D APPTD^SDWLEVAL ;display appointment
"RTN","SDAM2",105,0)
 .Q:'$D(^TMP($J,"APPT"))  ;no appointment created
"RTN","SDAM2",106,0)
 .N SDTC D EWLANS^SDWLEVAL(.SDTC) ;user may reject EWL
"RTN","SDAM2",107,0)
 .;ask for selection of EWL to display
"RTN","SDAM2",108,0)
 .;ASKS - returned answer (A/C/S/^)
"RTN","SDAM2",109,0)
 .;    ^TMP("SDWLPL",$J) and ^TMP($J,"SDWLPL") are used
"RTN","SDAM2",110,0)
 .;      to generate EWL open entries
"RTN","SDAM2",111,0)
 .I SDTC N SDCTN S SDCTN=0 F  N ASKS K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL") D ANS2^SDWLPL(DFN,.ASKS) Q:ASKS="^"  D  Q:SDCTN
"RTN","SDAM2",112,0)
 ..Q:'$D(^TMP($J,"SDWLPL"))  D ASKREM^SDWLEVAL S SDCTN=1 ;display and process selected open EWL entries
"RTN","SDAM2",113,0)
 .I 'SDTC Q  ;no EWL evaluation per user's decision
"RTN","SDAM2",114,0)
 .Q
"RTN","SDAM2",115,0)
 Q
"RTN","SDAM2",116,0)
 ;
"RTN","SDAM2",117,0)
DATE ; -- change date range
"RTN","SDAM2",118,0)
 S VALMB=SDBEG D RANGE^VALM11
"RTN","SDAM2",119,0)
 I $S('VALMBEG:1,SDBEG'=VALMBEG:0,1:SDEND=VALMEND) W !!,"Date range was not changed." D PAUSE^VALM1 S VALMBCK="" G DATEQ
"RTN","SDAM2",120,0)
 S SDBEG=VALMBEG,SDEND=VALMEND
"RTN","SDAM2",121,0)
 I SDAMTYP="P" D BLD^SDAM1
"RTN","SDAM2",122,0)
 I SDAMTYP="C" D BLD^SDAM3
"RTN","SDAM2",123,0)
 S VALMBCK="R"
"RTN","SDAM2",124,0)
DATEQ K VALMB,VALMBEG,VALMEND Q
"RTN","SDAM2",125,0)
 ;
"RTN","SDAM2",126,0)
INP(DFN,VDATE) ; -- determine inpat status ; dom is not an inpat appt
"RTN","SDAM2",127,0)
 N SDINP,VAINDT,VADMVT
"RTN","SDAM2",128,0)
 S SDINP="",VAINDT=VDATE D ADM^VADPT2 G INPQ:'VADMVT
"RTN","SDAM2",129,0)
 I $P(^DG(43,1,0),U,21),$P($G(^DIC(42,+$P($G(^DGPM(VADMVT,0)),U,6),0)),U,3)="D" G INPQ
"RTN","SDAM2",130,0)
 S SDINP="I"
"RTN","SDAM2",131,0)
INPQ Q SDINP
"RTN","SDAM2",132,0)
 ;
"RTN","SDAM2",133,0)
VALID(DFN,SDCL,SDT,SDDA) ; -- return valid appt.
"RTN","SDAM2",134,0)
 ; **NOTE:  For speed consideration the ^SC and ^DPT nodes must be
"RTN","SDAM2",135,0)
 ;          check to see they exist prior to calling this entry point.
"RTN","SDAM2",136,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM2",137,0)
 ;                 SDT := appt d/t
"RTN","SDAM2",138,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM2",139,0)
 ;                SDDA := ifn of appt
"RTN","SDAM2",140,0)
 ;  output: [returned] := 1 for valid appt., 0 for not valid
"RTN","SDAM2",141,0)
 Q $S($P(^SC(SDCL,"S",SDT,1,SDDA,0),U,9)'="C":1,$P(^DPT(DFN,"S",SDT,0),U,2)["C":1,1:0)
"RTN","SDAMWI")
0^8^B13138913
"RTN","SDAMWI",1,0)
SDAMWI ;ALB/MJK - Unscheduled Appointments ; 5/3/05 5:50pm
"RTN","SDAMWI",2,0)
 ;;5.3;Scheduling;**63,94,241,250,296,380,327**;Aug 13, 1993
"RTN","SDAMWI",3,0)
 ;
"RTN","SDAMWI",4,0)
EN(DFN,SC) ; -- main entry point
"RTN","SDAMWI",5,0)
 ;    input: DFN ; SC := clinic#
"RTN","SDAMWI",6,0)
 ; returned: success or fail := 1/0
"RTN","SDAMWI",7,0)
 ;
"RTN","SDAMWI",8,0)
 N SDY,SDAPTYP,SDRE,SDRE1,SDIN,SDSL,SDD,SDALLE,SDATD,SDDECOD,SDEC,SDEMP,SDOEL,SDPL,SDRT,SDSC,SDTTM,COLLAT,SDX,SDSTART,ORDER,SDREP,SDDA,SDCL
"RTN","SDAMWI",9,0)
 D 2^VADPT I +VADM(6) W !!?5,*7,"o  Patient has died!" D PAUSE^VALM1 S SDY=0 G ENQ
"RTN","SDAMWI",10,0)
 S SDCL=SC,SDSL=$S($D(^SC(SC,"SL")):+^("SL"),1:""),SDD=0
"RTN","SDAMWI",11,0)
 K SDRE,SDIN,SDRE1
"RTN","SDAMWI",12,0)
 I $D(^SC(SC,"I")) S Y=^("I"),SDIN=+Y,SDRE=+$P(Y,U,2),SDRE1=$$FDATE^VALM1(SDRE)
"RTN","SDAMWI",13,0)
 I $D(SDIN),SDIN,SDIN'>DT,SDRE,SDRE>DT W !!?5,*7,"o  Clinic is inactive from ",$$FTIME^VALM1(SDIN)," to "_SDRE1 D PAUSE^VALM1 S SDY=0 G ENQ
"RTN","SDAMWI",14,0)
 I $D(SDIN),SDIN,SDIN'>DT,'SDRE W !!?5,*7,"o  Clinic is inactive as of ",$$FTIME^VALM1(SDIN) D PAUSE^VALM1 S SDY=0 G ENQ
"RTN","SDAMWI",15,0)
 N SDRES S SDRES=$$CLNCK^SDUTL2(SC,1)
"RTN","SDAMWI",16,0)
 I 'SDRES W !,?5,*7,"o  Clinic MUST be corrected before continuing." D PAUSE^VALM1 S SDY=0 G ENQ
"RTN","SDAMWI",17,0)
 I '$$TIME(.DFN,.SC,.SDT) D WL^SDM1(SC) S SDY=0 G ENQ ;SD/327
"RTN","SDAMWI",18,0)
 S Y=SDT D ^SDM4 I X="^" S SDY=0 G ENQ
"RTN","SDAMWI",19,0)
 ; ** SD*5.3*250 MT Blocking check removed
"RTN","SDAMWI",20,0)
 ;S X="EASMTCHK" X ^%ZOSF("TEST") I $T N EASACT S EASACT="W" I $$MT^EASMTCHK(DFN,+$G(SDAPTYP),EASACT) D PAUSE^VALM1 S SDY=0 G ENQ
"RTN","SDAMWI",21,0)
 ;-- get sub-category for appointment type
"RTN","SDAMWI",22,0)
 S SDXSCAT=$$SUB^DGSAUTL(SDAPTYP,2,"")
"RTN","SDAMWI",23,0)
 S SDY=$$MAKE^SDAMWI1(DFN,SDCL,SDT)
"RTN","SDAMWI",24,0)
 K SDXSCAT
"RTN","SDAMWI",25,0)
ENQ D KVAR^VADPT
"RTN","SDAMWI",26,0)
 Q SDY
"RTN","SDAMWI",27,0)
 ;
"RTN","SDAMWI",28,0)
TIME(DFN,SC,SDT) ; -- get appt date/time
"RTN","SDAMWI",29,0)
 ;    input: DFN ; SC := clinic#
"RTN","SDAMWI",30,0)
 ;   output: SDT := date/time of wi appt
"RTN","SDAMWI",31,0)
 ; returned: success or fail := 1/0
"RTN","SDAMWI",32,0)
 ;
"RTN","SDAMWI",33,0)
 N SDY,%DT
"RTN","SDAMWI",34,0)
ASK R !!,"APPOINTMENT TIME: NOW// ",X:DTIME S X=$$UPPER^VALM1(X)
"RTN","SDAMWI",35,0)
 I X["^"!('$T) S SDY=0 G TIMEQ
"RTN","SDAMWI",36,0)
 I X?.E1"?" D  G ASK
"RTN","SDAMWI",37,0)
 .W !,"  Enter a time or date@time for the appointment or return for 'NOW'."
"RTN","SDAMWI",38,0)
 .W !,"The date must be today or earlier."
"RTN","SDAMWI",39,0)
 S:X=""!(X="N")!(X="NO") X="NOW"
"RTN","SDAMWI",40,0)
 I X'="NOW",X'["@" S X="T@"_X
"RTN","SDAMWI",41,0)
 S %DT="TEP",%DT(0)=-(DT+1) D ^%DT G ASK:Y<0 S SDT=Y
"RTN","SDAMWI",42,0)
 G:'$$CANCHK(.SC,.SDT) ASK
"RTN","SDAMWI",43,0)
 I $D(^DPT(DFN,"S",SDT,0)) W !?5,*7,"o  Patient already has an appt on ",$$FTIME^VALM1(SDT) G ASK
"RTN","SDAMWI",44,0)
 S SDY=1
"RTN","SDAMWI",45,0)
TIMEQ Q SDY
"RTN","SDAMWI",46,0)
 ;
"RTN","SDAMWI",47,0)
CANCHK(SC,SDT) ; -- is clinic cancelled for date
"RTN","SDAMWI",48,0)
 ;    input: SC := clinic# ; SDT := date/time of wi appt
"RTN","SDAMWI",49,0)
 ; returned: success or fail := 1/0
"RTN","SDAMWI",50,0)
 ;
"RTN","SDAMWI",51,0)
 N SDY
"RTN","SDAMWI",52,0)
 S SDY=1
"RTN","SDAMWI",53,0)
 I $D(^SC(SC,"ST",$P(SDT,"."))),'$D(^SC(SC,"ST",$P(SDT,"."),"CAN")) G CANCHKQ
"RTN","SDAMWI",54,0)
 I $D(^SC(SC,"ST",$P(SDT,"."),"CAN")),$G(^SC(SC,"ST",$P(SDT,"."),1))["CANCEL" W !?5,*7,"o  This date's clinic has been cancelled!" S SDY=0 G CANCHKQ
"RTN","SDAMWI",55,0)
 I $D(^SC(SC,"ST",$P(SDT,"."),"CAN")),$G(^SC(SC,"ST",$P(SDT,"."),1))'["CANCEL" W !?5,*7,"o  Warning: Part of this day's clinic has been cancelled!" G CANCHKQ
"RTN","SDAMWI",56,0)
 S SDY=$$AVAIL(.SC,.SDT)
"RTN","SDAMWI",57,0)
CANCHKQ Q SDY
"RTN","SDAMWI",58,0)
 ;
"RTN","SDAMWI",59,0)
AVAIL(SC,SDT) ; -- does clinic meet
"RTN","SDAMWI",60,0)
 ;    input: SC := clinic# ; SDT := date/time of wi appt
"RTN","SDAMWI",61,0)
 ; returned: success or fail := 1/0
"RTN","SDAMWI",62,0)
 ;
"RTN","SDAMWI",63,0)
 N SDY
"RTN","SDAMWI",64,0)
 S X=$P(SDT,".") D DOW^SDM0
"RTN","SDAMWI",65,0)
 I $D(^SC(SC,"T"_Y)) S Z=$O(^SC(SC,"T"_Y,DT)) I Z'="",$D(^SC(SC,"T"_Y,Z,1)),^(1)]"" S SDY=1 G AVAILQ
"RTN","SDAMWI",66,0)
 W !?5,*7,"o  Clinic does not meet on this date!" S SDY=0
"RTN","SDAMWI",67,0)
AVAILQ Q SDY
"RTN","SDAMWI",68,0)
 ;
"RTN","SDAMWI",69,0)
CL(DFN) ; -- make wi appt
"RTN","SDAMWI",70,0)
 ;    input: DFN
"RTN","SDAMWI",71,0)
 ; returned: success or fail := 1/0
"RTN","SDAMWI",72,0)
 ;
"RTN","SDAMWI",73,0)
 S DIC="^SC(",DIC(0)="AEMQ",DIC("A")="Select Clinic: ",DIC("S")="I $P(^(0),U,3)=""C"",'$G(^(""OOS""))"
"RTN","SDAMWI",74,0)
 D ^DIC K DIC
"RTN","SDAMWI",75,0)
 I Y<0 S SDY=0 G CLQ
"RTN","SDAMWI",76,0)
 S SC=+Y S SDY=$$EN(.DFN,.SC)
"RTN","SDAMWI",77,0)
CLQ Q SDY
"RTN","SDAMWI",78,0)
 ;
"RTN","SDAMWI",79,0)
PT(SC) ;
"RTN","SDAMWI",80,0)
 ;    input:  SC := clinic#
"RTN","SDAMWI",81,0)
 ; returned: success or fail := 1/0
"RTN","SDAMWI",82,0)
 ;
"RTN","SDAMWI",83,0)
 S DIC="^DPT(",DIC(0)="AEMQ",DIC("A")="Select Patient: "
"RTN","SDAMWI",84,0)
 D ^DIC K DIC
"RTN","SDAMWI",85,0)
 I Y<0 S SDY=0 G PTQ
"RTN","SDAMWI",86,0)
 S DFN=+Y S SDY=$$EN(.DFN,.SC)
"RTN","SDAMWI",87,0)
PTQ Q SDY
"RTN","SDAMWI",88,0)
 ;
"RTN","SDFORM")
0^4^B1409070
"RTN","SDFORM",1,0)
SDFORM ;IOFO BAY PINES/ESW - FORMAT MESSAGES ;09/02/2004 2:10 PM [5/19/05 8:24am]
"RTN","SDFORM",2,0)
 ;;5.3;Scheduling;**327**;Aug 13, 1993
"RTN","SDFORM",3,0)
 ;This routine may be called to format a text up to four columns.
"RTN","SDFORM",4,0)
 ;The returned value may be asigned to an array element used in
"RTN","SDFORM",5,0)
 ;a message creation
"RTN","SDFORM",6,0)
 ;================================================
"RTN","SDFORM",7,0)
FORM(FIRST,FN,SECOND,SN,THIRD,TN,FOURTH,FRN) ;
"RTN","SDFORM",8,0)
 ;
"RTN","SDFORM",9,0)
 ;FIRST,SECOND,THIRD,FOURTH - names of variables containing text values or text strings 
"RTN","SDFORM",10,0)
 ;                                to be included in a formatted message
"RTN","SDFORM",11,0)
 ;FN,SN,TN - numbers assigned for a text and spaces up to the next column
"RTN","SDFORM",12,0)
 ;
"RTN","SDFORM",13,0)
 ;Output: formatted text
"RTN","SDFORM",14,0)
 ;
"RTN","SDFORM",15,0)
 N FS,SS,TS,FNS,SNS,TNS
"RTN","SDFORM",16,0)
 S:'$D(THIRD) THIRD=""
"RTN","SDFORM",17,0)
 S:'$D(FOURTH) FOURTH=""
"RTN","SDFORM",18,0)
 S:'$D(TN) TN=""
"RTN","SDFORM",19,0)
 S:'$D(SN) SN=""
"RTN","SDFORM",20,0)
 S:'$D(FRN) FRN=""
"RTN","SDFORM",21,0)
 S FNS=FN-$L(FIRST) S:FNS'>0 FNS=1,FIRST=$E(FIRST,1,$L(FIRST)-1) S $P(FS," ",FNS)=""
"RTN","SDFORM",22,0)
 S SNS=SN-$L(SECOND) S:SNS'>0 SNS=1,SECOND=$E(SECOND,1,$L(SECOND)-1) S $P(SS," ",SNS)=""
"RTN","SDFORM",23,0)
 S TNS=TN-$L(THIRD) S:TNS'>0 TNS=1,THIRD=$E(THIRD,1,$L(THIRD)-1) S $P(TS," ",TNS)=""
"RTN","SDFORM",24,0)
 Q FIRST_FS_SECOND_SS_THIRD_TS_FOURTH
"RTN","SDM1")
0^7^B34155248
"RTN","SDM1",1,0)
SDM1 ;SF/GFT - MAKE APPOINTMENT ; 3/29/05 12:35pm [5/5/05 9:41am]
"RTN","SDM1",2,0)
 ;;5.3;Scheduling;**32,167,168,80,223,263,273,408,327**;Aug 13, 1993
"RTN","SDM1",3,0)
1 L  Q:$D(SDXXX)  S CCXN=0 K MXOK,COV,SDPROT Q:DFN<0  S SC=+SC
"RTN","SDM1",4,0)
 S X1=DT,SDEDT=365 S:$D(^SC(SC,"SDP")) SDEDT=$P(^SC(SC,"SDP"),"^",2)
"RTN","SDM1",5,0)
 S X2=SDEDT D C^%DTC S SDEDT=X D WRT
"RTN","SDM1",6,0)
 I $D(^SC(SC,"SI")),$O(^("SI",0))>0 W !,*7,?8,"**** SPECIAL INSTRUCTIONS ****",! S %I=0 F %=0:1 S %I=$O(^SC(SC,"SI",%I)) Q:%I'>0  W ^(%I,0) W:% ! I '%,$O(^SC(SC,"SI",%I))>0 S POP=0 D SPIN Q:POP
"RTN","SDM1",7,0)
 I $D(SDINA),SDINA>DT D IN W !,?8,@SDMSG K SDMSG
"RTN","SDM1",8,0)
 G:SDMM RDTY^SDMM
"RTN","SDM1",9,0)
 ;
"RTN","SDM1",10,0)
ADT S:'$D(SDW) SDW=""
"RTN","SDM1",11,0)
 S SDSOH=$S('$D(^SC(SC,"SL")):0,$P(^("SL"),"^",8)']"":0,1:1),CCX=""
"RTN","SDM1",12,0)
 S SDONCE=$G(SDONCE)+1  ;Prevent repetitive iteration
"RTN","SDM1",13,0)
 S X=$S(SDONCE<2:$G(SDSDATE),1:"")  ;Use default date/time if specified as 'desired date'  
"RTN","SDM1",14,0)
 I 'X R !,"DATE/TIME: ",X:DTIME G:X="M"!(X="m") MORDIS^SDM0 I "^"[X D WL(SC) Q   ;sd/327
"RTN","SDM1",15,0)
 ;
"RTN","SDM1",16,0)
 I X="D"!(X="d") S X=$$REDDT() G:X>0 MORD2^SDM0 S X="" W "  ??",! G ADT
"RTN","SDM1",17,0)
 I X?1"?".E D  G ADT
"RTN","SDM1",18,0)
 .W !,"Enter a date/time for the appointment"
"RTN","SDM1",19,0)
 .W:$D(SD) " or a space to choose the same date/time as the patient you have just previously scheduled into this clinic"
"RTN","SDM1",20,0)
 .W ".",!,"You may also select 'M' to display the next month's availability or"
"RTN","SDM1",21,0)
 .W !,"'D' to specify an earlier or later date to begin the availability display."
"RTN","SDM1",22,0)
 I X=" ",$D(SD),SD S Y=SD D AT^SDUTL W Y S Y=SD G OVR
"RTN","SDM1",23,0)
 I $E($P(X,"@",2),1,4)?1.4"0" K %DT S X=$P(X,"@"),X=$S($L(X):X,1:"T"),%DT="XF" D ^%DT G ADT:Y'>0 S X1=Y,X2=-1 D C^%DTC S X=X_.24
"RTN","SDM1",24,0)
 K %DT S %DT="TXEF" D ^%DT
"RTN","SDM1",25,0)
 ;SD*5.3*408  verify that day hasn't been canceled via "SET UP A CLINIC"
"RTN","SDM1",26,0)
 I $G(^SC(+SC,"ST",$P(Y,"."),1))'="",^SC(+SC,"ST",$P(Y,"."),1)'["[" D  G ADT
"RTN","SDM1",27,0)
 .W !,"There is no availability for this date/time.",!
"RTN","SDM1",28,0)
 I $P(Y,".",2)=24 S X1=$P(Y,"."),X2=1 D C^%DTC S Y=X_".000001"
"RTN","SDM1",29,0)
OVR I $D(^HOLIDAY($P(Y,"."),0)),'SDSOH W *7,?50,$P(^(0),U,2),"??" K SDSDATE G ADT
"RTN","SDM1",30,0)
 I $D(SDINA),$P(Y,".")'<SDINA,$S('$D(SDRE):1,SDRE>$P(Y,".")!('SDRE):1,1:0) D IN W !,*7,@SDMSG K SDMSG K SDSDATE G ADT
"RTN","SDM1",31,0)
 I Y#1=0 K SDSDATE G 1
"RTN","SDM1",32,0)
 I $P(Y,".")'<SDEDT W !,*7,"EXCEEDS MAXIMUM DAYS FOR FUTURE APPOINTMENT!!",*7 K SDSDATE G ADT
"RTN","SDM1",33,0)
 ;
"RTN","SDM1",34,0)
EN1 S (X,SD)=Y,SM=0 D DOW
"RTN","SDM1",35,0)
 F S=$P(SD,"."):0 S S=+$O(^DPT(DFN,"S",S)) Q:$P(S,".")-($P(SD,"."))  S I=+^(S,0) G ^SDM2:$P(^(0),U,2)'["C"
"RTN","SDM1",36,0)
 ;
"RTN","SDM1",37,0)
PRECAN I $D(^DPT(DFN,"S",SD,0)),$P(^(0),U,2)["P" S %=1 W !,"THIS TIME WAS PREVIOUSLY CANCELLED BY THE PATIENT",!,"ARE YOU SURE THAT YOU WANT TO PROCEED" D YN^DICN W:'% !,"ANSWER WITH (Y)ES OR (N)O" I (%-1) K SDSDATE G ADT
"RTN","SDM1",38,0)
 W !
"RTN","SDM1",39,0)
 ;
"RTN","SDM1",40,0)
S I '$D(^SC(SC,"ST",$P(SD,"."),1)) S SS=+$O(^SC(+SC,"T"_Y,SD)) G XW:SS'>0,XW:^(SS,1)="" S ^SC(+SC,"ST",$P(SD,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(SD,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(SD,".")
"RTN","SDM1",41,0)
LEN I $P(SL,U,2)]"" W !,"LENGTH OF APPOINTMENT (IN MINUTES): ",+SL,"// " R S:DTIME I S]"" G:$L(S)>3 LEN Q:U[S  S POP=0 D L G LEN:POP,S:S\5*5'=S,S:S>360,S:S<5 S SL=S_U_$P(SL,U,2,99)
"RTN","SDM1",42,0)
 ;
"RTN","SDM1",43,0)
SC S SDLOCK=$S('$D(SDLOCK):1,1:SDLOCK+1) G:SDLOCK>9 LOCK
"RTN","SDM1",44,0)
 L ^SC(SC,"ST",$P(SD,"."),1):5 G:'$T SC
"RTN","SDM1",45,0)
 S SDLOCK=0,S=^SC(SC,"ST",$P(SD,"."),1)
"RTN","SDM1",46,0)
 S I=SD#1-SB*100,ST=I#1*SI\.6+($P(I,".")*SI),SS=SL*HSI/60*SDDIF+ST+ST
"RTN","SDM1",47,0)
 G X:(I<1!'$F(S,"["))&(S'["CAN")
"RTN","SDM1",48,0)
 I SM<7 S %=$F(S,"[",SS-1) S:'%!($P(SL,"^",6)<3) %=999 I $F(S,"]",SS)'<%!(SDDIF=2&$E(S,ST+ST+1,SS-1)["[") S SM=7
"RTN","SDM1",49,0)
 ;
"RTN","SDM1",50,0)
SP I ST+ST>$L(S),$L(S)<80 S S=S_" " G SP
"RTN","SDM1",51,0)
 S SDNOT=1
"RTN","SDM1",52,0)
 F I=ST+ST:SDDIF:SS-SDDIF S ST=$E(S,I+1) S:ST="" ST=" " S Y=$E(STR,$F(STR,ST)-2) G C:S["CAN"!(ST="X"&($D(^SC(+SC,"ST",$P(SD,"."),"CAN")))),X:Y="" S:Y'?1NL&(SM<6) SM=6 S ST=$E(S,I+2,999) S:ST="" ST=" " S S=$E(S,1,I)_Y_ST
"RTN","SDM1",53,0)
 Q:SDMM  G OK^SDM1A:SM#9=0,^SDM3:$P(SL,U,7)]""&('$D(MXOK))
"RTN","SDM1",54,0)
 ;
"RTN","SDM1",55,0)
E G:'$D(^XUSEC("SDOB",DUZ)) NOOB
"RTN","SDM1",56,0)
 S %=2 W *7,!,$E($T(@SM),5,99),"...OK" D YN^DICN
"RTN","SDM1",57,0)
 I '% W !,"RESPOND YES OR NO" G E
"RTN","SDM1",58,0)
 S SM=9 G SC:'(%-1) K SDSDATE G 1
"RTN","SDM1",59,0)
 ;
"RTN","SDM1",60,0)
LOCK Q:SDMM  W !,*7,"ANOTHER USER HAS LOCKED THIS DATE - TRY AGAIN LATER" Q
"RTN","SDM1",61,0)
 ;
"RTN","SDM1",62,0)
6 ;;OVERBOOK!
"RTN","SDM1",63,0)
7 ;;THAT TIME IS NOT WITHIN SCHEDULED PERIOD!
"RTN","SDM1",64,0)
C S POP=1 W !,*7,"CAN'T BOOK WITHIN A CANCELLED TIME PERIOD!",!
"RTN","SDM1",65,0)
 Q:SDMM  K SDSDATE G 1
"RTN","SDM1",66,0)
 ;
"RTN","SDM1",67,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDM1",68,0)
 ;
"RTN","SDM1",69,0)
DOW S %=$E(X,1,3),Y=$E(X,4,5),Y=Y>2&'(%#4)+$E("144025036146",Y)
"RTN","SDM1",70,0)
 F %=%:-1:281 S Y=%#4=1+1+Y
"RTN","SDM1",71,0)
 S Y=$E(X,6,7)+Y#7 Q
"RTN","SDM1",72,0)
 ;
"RTN","SDM1",73,0)
X I SDMM S POP=1 Q
"RTN","SDM1",74,0)
 G:I<1 XW
"RTN","SDM1",75,0)
 S:Y'?1NL&(SM<6) SM=6
"RTN","SDM1",76,0)
 G OK^SDM1A:SM#9=0,^SDM3:$P(SL,U,7)]""&('$D(MXOK))
"RTN","SDM1",77,0)
XW W *7,"  WHEN??" K SDSDATE G 1
"RTN","SDM1",78,0)
 ;
"RTN","SDM1",79,0)
NOOB W !,"NO OPEN SLOTS THEN",*7 K SDSDATE G 1
"RTN","SDM1",80,0)
 ;
"RTN","SDM1",81,0)
WRT W !,+SL," MINUTE APPOINTMENTS "
"RTN","SDM1",82,0)
 W $S($P(SL,U,2)["V":"(VARIABLE LENGTH)",1:"") Q
"RTN","SDM1",83,0)
 ;
"RTN","SDM1",84,0)
L S SDSL=$S($P(SL,"^",6)]"":60/$P(SL,"^",6),1:"") Q:'SDSL
"RTN","SDM1",85,0)
 I S\(SDSL)*(SDSL)'=S W *7,!,"Appt. length must = or be a multiple of the increment minutes per hour (",SDSL,")",! S POP=1
"RTN","SDM1",86,0)
 Q
"RTN","SDM1",87,0)
 ;
"RTN","SDM1",88,0)
IN S SDHY=$S($D(Y):Y,1:""),Y=SDINA D DTS^SDUTL S Y1=Y,Y=SDRE
"RTN","SDM1",89,0)
 D:Y DTS^SDUTL
"RTN","SDM1",90,0)
 S SDMSG="""*** Note: Clinic is scheduled to be inactivated on "","_""""_Y1_""""_$S(SDRE:",!,?10,"_""" and reactivated on "","_""""_Y_"""",1:""),Y=SDHY K Y1,SDHY
"RTN","SDM1",91,0)
 Q
"RTN","SDM1",92,0)
 ;
"RTN","SDM1",93,0)
SPIN W !,"There are more special instructions. Do you want to display them"
"RTN","SDM1",94,0)
 S %=2 D YN^DICN
"RTN","SDM1",95,0)
 I '% W !,"Enter Y to see the remaining special instructions, or N if you don't wish to see them" G SPIN
"RTN","SDM1",96,0)
 I (%-1) S POP=1 Q
"RTN","SDM1",97,0)
 W !,^SC(SC,"SI",%I,0),! Q
"RTN","SDM1",98,0)
 ;
"RTN","SDM1",99,0)
REDDT() ;Prompt for availability redisplay date
"RTN","SDM1",100,0)
 N %DT,X,Y
"RTN","SDM1",101,0)
 S %DT="AEX"
"RTN","SDM1",102,0)
 S %DT("A")="DATE TO BEGIN THE RE-DISPLAY OF CLINIC AVAILABILITY: "
"RTN","SDM1",103,0)
 W ! D ^%DT
"RTN","SDM1",104,0)
 Q Y
"RTN","SDM1",105,0)
WL(SC) ;Wait List Hook/teh patch 263 ;SD/327 passed 'SC'
"RTN","SDM1",106,0)
 Q:$G(SC)'>0
"RTN","SDM1",107,0)
 I '$D(^SC(SC)) Q
"RTN","SDM1",108,0)
 I $D(SC) S SDWLFLG=0 D
"RTN","SDM1",109,0)
 .I $D(^SDWL(409.32,"B",+SC)) S SDWLFLG=1
"RTN","SDM1",110,0)
 .I 'SDWLFLG S SDWLDSS=$P($G(^SC(+SC,0)),U,7) I $D(^SDWL(409.31,"B",SDWLDSS)) S SDWLFLG=2 D
"RTN","SDM1",111,0)
 ..I SDWLFLG=1 S SDWLSC=$O(^SDWL(409.32,"B",+SC,0)) I $P(^SDWL(409.32,SDWLSC,0),U,4) S SDWLFLG=0
"RTN","SDM1",112,0)
 .I SDWLFLG=2 S SDWLDS=$O(^SDWL(409.31,"E",DUZ(2),0)) I $D(^SDWL(409.31,SDWLDSS,"I",+SDWLDS,0)),$P(^(0),U,4) S SDWLFLG=0
"RTN","SDM1",113,0)
 .I SDWLFLG D
"RTN","SDM1",114,0)
 ..K SDWLSC,SDWLDSS,SDWLDS,SDWLFLG
"RTN","SDM1",115,0)
 ..S SDWLOPT=1,SDWLERR=0 D OPT^SDWLE D EN^SDWLKIL
"RTN","SDM1",116,0)
 Q
"RTN","SDM1",117,0)
 ;
"RTN","SDM1A")
0^12^B39690265
"RTN","SDM1A",1,0)
SDM1A ;SF/GFT,ALB/TMP - MAKE APPOINTMENT ; 3/29/05 12:26pm
"RTN","SDM1A",2,0)
 ;;5.3;Scheduling;**26,94,155,206,168,223,241,263,327**;Aug 13, 1993
"RTN","SDM1A",3,0)
OK I $D(SDMLT) D ^SDM4 Q:X="^"!(SDMADE=2)
"RTN","SDM1A",4,0)
 S ^SC(SC,"ST",$P(SD,"."),1)=S,^DPT(DFN,"S",SD,0)=SC,^SC(SC,"S",SD,0)=SD S:'$D(^DPT(DFN,"S",0)) ^(0)="^2.98P^^" S:'$D(^SC(SC,"S",0)) ^(0)="^44.001DA^^" L
"RTN","SDM1A",5,0)
S1 L ^SC(SC,"S",SD,1):5 G:'$T S1 F SDY=1:1 I '$D(^SC(SC,"S",SD,1,SDY)) S:'$D(^(0)) ^(0)="^44.003PA^^" S ^(SDY,0)=DFN_U_(+SL) L  Q
"RTN","SDM1A",6,0)
 I SM S ^("OB")="O" ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDY,"OB")
"RTN","SDM1A",7,0)
 I $D(^SC(SC,"RAD")),^("RAD")="Y"!(^("RAD")=1) S ^SC("ARAD",SC,SD,DFN)=""
"RTN","SDM1A",8,0)
 S SDINP=$$INP^SDAM2(DFN,SD)
"RTN","SDM1A",9,0)
 ;-- added sub-category
"RTN","SDM1A",10,0)
 S COV=3,SDYC="",COV=$S(COLLAT=1:1,1:3),SDYC=$S(COLLAT=7:1,1:"")
"RTN","SDM1A",11,0)
 S:SD<DT SDSRTY="W"
"RTN","SDM1A",12,0)
 S ^DPT(DFN,"S",SD,0)=SC_"^"_$$STATUS(SC,SDINP,SD)_"^^^^^"_COV_"^^^^"_SDYC_"^^^^^"_SDAPTYP_U_$G(SD17)_"^^"_DT_"^^^^^"_$G(SDXSCAT)_U_$P($G(SDSRTY),U,2)_U_$$NAVA^SDMANA(SC,SD,$P($G(SDSRTY),U,2))
"RTN","SDM1A",13,0)
 S ^DPT(DFN,"S",SD,1)=$G(SDDATE)_U_$G(SDSRFU)
"RTN","SDM1A",14,0)
 ;xref DATE APPT. MADE field
"RTN","SDM1A",15,0)
 D
"RTN","SDM1A",16,0)
 .N DIV,DA,DIK
"RTN","SDM1A",17,0)
 .S DA=SD,DA(1)=DFN,DIK="^DPT(DA(1),""S"",",DIK(1)=20 D EN1^DIK
"RTN","SDM1A",18,0)
 .Q
"RTN","SDM1A",19,0)
 K:$D(^DPT(DFN,"S",SD,"R")) ^("R") K:$D(^DPT("ASDCN",SC,SD,DFN)) ^(DFN)
"RTN","SDM1A",20,0)
 S SDRT="A",SDTTM=SD,SDPL=SDY,SDSC=SC D RT^SDUTL
"RTN","SDM1A",21,0)
 W !,"   ",+SL,"-MINUTE APPOINTMENT MADE" K SDINP
"RTN","SDM1A",22,0)
 ;confirm request type & follow-up indicator
"RTN","SDM1A",23,0)
 I $D(SDSRTY(0)) D CONF(.SDSRTY,.SDSRFU,DFN,SD,SC) W !
"RTN","SDM1A",24,0)
 I $P(SD,".")'>DT,$D(^DPT(DFN,.321)) D EN1^SDM3
"RTN","SDM1A",25,0)
 ;
"RTN","SDM1A",26,0)
 ;Wait List SD*5.3*263
"RTN","SDM1A",27,0)
 ;I '$D(SDWLLIST) D ^SDWLR ;replaced with sd/372, see below
"RTN","SDM1A",28,0)
EWLCHK ;check if patient has any open EWL entries (SD/372)
"RTN","SDM1A",29,0)
 N SDEV D EN^SDWLEVAL(DFN,.SDEV)
"RTN","SDM1A",30,0)
 ;process open EWL entries if exist
"RTN","SDM1A",31,0)
 I SDEV,$L(SDEV(1))>0 W !,SDEV(1),! D
"RTN","SDM1A",32,0)
 .;display appointment
"RTN","SDM1A",33,0)
 .K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDM1A",34,0)
 .;SD-Appt Date/Time
"RTN","SDM1A",35,0)
 .;SC- Appt Clinic
"RTN","SDM1A",36,0)
 .W:$D(IOF) @IOF D APPT^SDWLEVAL(DFN,SD,SC)
"RTN","SDM1A",37,0)
 .Q:'$D(^TMP($J,"APPT"))
"RTN","SDM1A",38,0)
 .D APPTD^SDWLEVAL ;display appointment from ^TMP($J,"APPT")
"RTN","SDM1A",39,0)
 .;
"RTN","SDM1A",40,0)
 .N SDTC D EWLANS^SDWLEVAL(.SDTC) ;user may reject EWL
"RTN","SDM1A",41,0)
 .;ask for selection of EWL to display
"RTN","SDM1A",42,0)
 .;ASKS - returned answer (A/C/S/^)
"RTN","SDM1A",43,0)
 .;    ^TMP("SDWLPL",$J) and ^TMP($J,"SDWLPL") are used
"RTN","SDM1A",44,0)
 .;      to generate EWL open entries
"RTN","SDM1A",45,0)
 .I SDTC N SDCTN S SDCTN=0 F  N ASKS K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL") D ANS2^SDWLPL(DFN,.ASKS) Q:ASKS="^"  D  Q:SDCTN
"RTN","SDM1A",46,0)
 ..Q:'$D(^TMP($J,"SDWLPL"))  D ASKREM^SDWLEVAL S SDCTN=1 ;display and process selected open EWL entries
"RTN","SDM1A",47,0)
 .I 'SDTC Q  ;no EWL evaluation per user's decision
"RTN","SDM1A",48,0)
 .Q
"RTN","SDM1A",49,0)
 ;
"RTN","SDM1A",50,0)
 ;continue appointment entry process
"RTN","SDM1A",51,0)
ORD S %=2 W !,"WANT PATIENT NOTIFIED OF LAB,X-RAY, OR EKG STOPS" D YN^DICN I '% W !,"  Enter YES to notify patient on appt. letter of LAB, X-RAY, or EKG stops" G ORD
"RTN","SDM1A",52,0)
 I '(%-1) D ORDY^SDM3
"RTN","SDM1A",53,0)
OTHER R !,"  OTHER INFO: ",D:DTIME I D["^" W !,*7,"'^' not allowed - hit return if no 'OTHER INFO' is to be entered" G OTHER
"RTN","SDM1A",54,0)
 I $L(D)>150 D MSG^SDMM G OTHER
"RTN","SDM1A",55,0)
 I D]"",D?."?"!(D'?.ANP) W "  ENTER LAB, SCAN, ETC." G OTHER
"RTN","SDM1A",56,0)
 I $L(^SC(SC,"S",SD,1,SDY,0))+$L(D)+$L(DT)+$S($D(DUZ):$L(DUZ),1:0)>250 D MSG^SDMM G OTHER
"RTN","SDM1A",57,0)
 S $P(^(0),"^",4)=D,$P(^(0),U,6,7)=$S($D(DUZ):DUZ,1:"")_U_DT ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDY,0)
"RTN","SDM1A",58,0)
XR I $S('$D(^SC(SC,"RAD")):1,^("RAD")="Y":0,^("RAD")=1:0,1:1) S %=2 W !,"WANT PREVIOUS X-RAY RESULTS SENT TO CLINIC" D YN^DICN G:'% HXR I '(%-1) S ^SC("ARAD",SC,SD,DFN)=""
"RTN","SDM1A",59,0)
SDMM S SDEMP=0 I COLLAT=7 S:SDEC'=SDCOL SDEMP=SDCOL G OV
"RTN","SDM1A",60,0)
 D ELIG^VADPT I $O(VAEL(1,0))>0 D ELIG^SDM4:"369"[SDAPTYP S SDEMP=$S(SDDECOD:SDDECOD,1:SDEMP)
"RTN","SDM1A",61,0)
OV Q:$D(SDZM)  K SDQ1,SDEC,SDCOL I +SDEMP S $P(^SC(SC,"S",SD,1,SDY,0),"^",10)=+SDEMP
"RTN","SDM1A",62,0)
 S SDMADE=1 D EVT Q
"RTN","SDM1A",63,0)
HXR W !,"  Enter YES to have previous XRAY results sent to the clinic" G XR
"RTN","SDM1A",64,0)
 Q
"RTN","SDM1A",65,0)
CS S SDCS=+$P(^SC(+SC,0),"^",7) I $S('$D(^DIC(40.7,SDCS,0)):1,'$P(^(0),"^",3):0,1:$P(^(0),"^",3)'>DT) W !!,*7,"** WARNING - CLINIC HAS AN INVALID OR INACTIVE STOP CODE!!!",!!
"RTN","SDM1A",66,0)
 S SDCS=+$P(^SC(+SC,0),"^",18) I $S('SDCS:0,'$D(^DIC(40.7,SDCS,0)):1,'$P(^(0),"^",3):0,1:$P(^(0),"^",3)'>DT) W !!,*7,"** WARNING - CLINIC HAS AN INVALID OR INACTIVE CREDIT STOP CODE!!!",!!
"RTN","SDM1A",67,0)
 K SDCS Q
"RTN","SDM1A",68,0)
 ;
"RTN","SDM1A",69,0)
STATUS(SDCL,SDINP,SDT) ; -- determine status for NEW appts
"RTN","SDM1A",70,0)
 Q $S(SDINP]"":SDINP,$$CHK(.SDCL,.SDT):"NT",1:"")
"RTN","SDM1A",71,0)
 ;
"RTN","SDM1A",72,0)
CHK(SDCL,SDT) ; -- should appt be NT'ed
"RTN","SDM1A",73,0)
 ; -- non-count clinic check := don't NT appt
"RTN","SDM1A",74,0)
 ; -- appt update executed   := need to NT appt
"RTN","SDM1A",75,0)
 ; -- otherwise              := don't NT appt
"RTN","SDM1A",76,0)
 Q $S($P($G(^SC(SDCL,0)),U,17)="Y":0,$D(^SDD(409.65,"AUPD",$P(SDT,"."))):1,1:0)
"RTN","SDM1A",77,0)
 ;
"RTN","SDM1A",78,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDM1A",79,0)
 D MAKE^SDAMEVT(DFN,SD,SC,SDY,0)
"RTN","SDM1A",80,0)
 Q
"RTN","SDM1A",81,0)
 ;
"RTN","SDM1A",82,0)
REQ(SDT) ; -- which is required check in(CI) or out(CO)
"RTN","SDM1A",83,0)
 Q $S($$REQDT()>SDT:"CI",1:"CO")
"RTN","SDM1A",84,0)
 ;
"RTN","SDM1A",85,0)
REQDT() ; -- co required date
"RTN","SDM1A",86,0)
 Q $S($P(^DG(43,1,"SCLR"),U,23):$P(^("SCLR"),U,23),1:2931001)
"RTN","SDM1A",87,0)
 ;
"RTN","SDM1A",88,0)
COCMP(DFN,SDT) ; -- date CO completed
"RTN","SDM1A",89,0)
 Q $P($G(^SCE(+$P($G(^DPT(DFN,"S",SDT,0)),U,20),0)),U,7)
"RTN","SDM1A",90,0)
 ;
"RTN","SDM1A",91,0)
CI(SDCL,SDT,SDDA,SDACT) ; -- ok to update DPT
"RTN","SDM1A",92,0)
 N C
"RTN","SDM1A",93,0)
 I '$$CHK(.SDCL,.SDT) G CIQ
"RTN","SDM1A",94,0)
 I $$REQ(SDT)'="CI" G CIQ
"RTN","SDM1A",95,0)
 I SDACT="SET",$D(^DPT(+^SC(SDCL,"S",SDT,1,SDDA,0),"S",SDT,0)),$P(^(0),U,2)="NT" S $P(^(0),U,2)=""
"RTN","SDM1A",96,0)
 I SDACT="KILL" S C=$G(^SC(SDCL,"S",SDT,1,SDDA,"C")) I $D(^DPT(+$G(^(0)),"S",SDT,0)),$P(^(0),U,2)="",'$P(C,U,3) S $P(^(0),U,2)="NT"
"RTN","SDM1A",97,0)
CIQ Q
"RTN","SDM1A",98,0)
 ;
"RTN","SDM1A",99,0)
CO(SDCL,SDT,SDDA,SDACT) ; -- ok to update DPT
"RTN","SDM1A",100,0)
 N DFN,C
"RTN","SDM1A",101,0)
 I '$$CHK(.SDCL,.SDT) G COQ
"RTN","SDM1A",102,0)
 I $$REQ(.SDT)'="CO" D  G COQ
"RTN","SDM1A",103,0)
 .I SDACT="SET",$D(^DPT(+^SC(SDCL,"S",SDT,1,SDDA,0),"S",SDT,0)),$P(^(0),U,2)="NT" S $P(^(0),U,2)=""
"RTN","SDM1A",104,0)
 .I SDACT="KILL" S C=$G(^SC(SDCL,"S",SDT,1,SDDA,"C")) I $D(^DPT(+$G(^(0)),"S",SDT,0)),$P(^(0),U,2)="",'C S $P(^(0),U,2)="NT"
"RTN","SDM1A",105,0)
 S DFN=+^SC(SDCL,"S",SDT,1,SDDA,0)
"RTN","SDM1A",106,0)
 D UPD(.DFN,.SDT,$$COCMP(.DFN,.SDT),$S(SDACT="SET":X,1:""))
"RTN","SDM1A",107,0)
COQ Q
"RTN","SDM1A",108,0)
 ;
"RTN","SDM1A",109,0)
UPD(DFN,SDT,SDCOCMP,SDCODT) ; -- update status
"RTN","SDM1A",110,0)
 N Y
"RTN","SDM1A",111,0)
 I $D(^DPT(DFN,"S",SDT,0)) S Y=$P(^(0),U,2) D
"RTN","SDM1A",112,0)
 .I 'SDCOCMP!('SDCODT) S:Y="" $P(^DPT(DFN,"S",SDT,0),U,2)="NT" Q
"RTN","SDM1A",113,0)
 .S:Y="NT" $P(^DPT(DFN,"S",SDT,0),U,2)=""
"RTN","SDM1A",114,0)
 Q
"RTN","SDM1A",115,0)
 ;
"RTN","SDM1A",116,0)
OE(SDOE,SDACT) ; -- called by x-ref on co completed field(#.07) in ^SCE
"RTN","SDM1A",117,0)
 N Y S Y=^SCE(SDOE,0)
"RTN","SDM1A",118,0)
 I $P(Y,U,8)'=1 G OEQ
"RTN","SDM1A",119,0)
 I $$REQ(+Y)'="CO" G OEQ
"RTN","SDM1A",120,0)
 I '$$CANT(+$P(Y,U,2),+Y,SDOE),'$$CHK(+$P(Y,U,4),+Y) G OEQ
"RTN","SDM1A",121,0)
 D UPD(+$P(Y,U,2),+Y,$S(SDACT="SET":X,1:""),$P($G(^SC(+$P(Y,U,4),"S",+Y,1,+$P(Y,U,9),"C")),U,3))
"RTN","SDM1A",122,0)
OEQ Q
"RTN","SDM1A",123,0)
 ;
"RTN","SDM1A",124,0)
CONF(SDSRTY,SDSRFU,DFN,SDT,SC) ;Confirm scheduling request type
"RTN","SDM1A",125,0)
 ;Input: SDSRTY=request type
"RTN","SDM1A",126,0)
 ;Input: SDSRFU=follow-up indicator
"RTN","SDM1A",127,0)
 ;Input: DFN=patient ien
"RTN","SDM1A",128,0)
 ;Input: SDT=appointment date/time
"RTN","SDM1A",129,0)
 ;Input: SC=clinic ifn
"RTN","SDM1A",130,0)
 ;
"RTN","SDM1A",131,0)
 N DIR,DIE,DA,DR,SDX,SDY,X,Y
"RTN","SDM1A",132,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","SDM1A",133,0)
 S DIR("A")="THIS APPOINTMENT IS MARKED AS '"_SDSRTY(0)_"', IS THIS CORRECT"
"RTN","SDM1A",134,0)
 W ! D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDM1A",135,0)
 I 'Y S SDX='SDSRTY,SDX(0)=$$TXRT(.SDX) W !!,"THIS APPOINTMENT HAS NOW BEEN MARKED AS '"_$S('SDSRTY:"",1:"NOT ")_"NEXT AVAILABLE'."
"RTN","SDM1A",136,0)
 ;S DIR("A")="THIS APPOINTMENT IS DEFINED AS '"_$S(SDSRFU:"FOLLOW-UP",1:"OTHER THAN FOLLOW-UP")_"', OK"
"RTN","SDM1A",137,0)
 ;W ! D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDM1A",138,0)
 ;I 'Y S SDY='SDSRFU W "  (changed)"
"RTN","SDM1A",139,0)
 Q:'$D(SDX)  S DR=""
"RTN","SDM1A",140,0)
 I $D(SDX) S DR="25///^S X=$P(SDX,U,2);26///^S X=$$NAVA^SDMANA(SC,SDT,$P(SDX,U,2))"
"RTN","SDM1A",141,0)
 ;I $D(SDY) S:$L(DR) DR=DR_";" S DR=DR_"26///^S X=SDY"
"RTN","SDM1A",142,0)
 S DA=SDT,DA(1)=DFN
"RTN","SDM1A",143,0)
 S DIE="^DPT(DA(1),""S""," D ^DIE
"RTN","SDM1A",144,0)
 Q
"RTN","SDM1A",145,0)
 ;
"RTN","SDM1A",146,0)
TXRT(SDSRTY)    ;Transform request type
"RTN","SDM1A",147,0)
 ;Input: SDSRTY=variable to return request type (pass by reference)
"RTN","SDM1A",148,0)
 ;Output: external text for SDSRTY(0)
"RTN","SDM1A",149,0)
 I SDSRTY S SDSRTY=SDSRTY_U_"N" Q "NEXT AVAILABLE"
"RTN","SDM1A",150,0)
 S SDSRTY=SDSRTY_U_"O" Q "NOT NEXT AVAILABLE"
"RTN","SDM1A",151,0)
 ;
"RTN","SDM1A",152,0)
CANT(DFN,SDT,SDOE) ;Determine if clinic appt. has been marked "NT"
"RTN","SDM1A",153,0)
 ;Output: '1' if appt. points to encounter and is marked "NT", otherwise '0'
"RTN","SDM1A",154,0)
 N SDAPP S SDAPP=$G(^DPT(DFN,"S",SDT,0))
"RTN","SDM1A",155,0)
 Q:$P(SDAPP,U,20)'=SDOE 0
"RTN","SDM1A",156,0)
 Q $P(SDAPP,U,2)="NT"
"RTN","SDM1A",157,0)
 ;
"RTN","SDM1A",158,0)
 ; -- Variable doc for above tags
"RTN","SDM1A",159,0)
 ;     SDCL := file 44 ien
"RTN","SDM1A",160,0)
 ;      SDT := appt date/time
"RTN","SDM1A",161,0)
 ;      DFN := file 2 ien
"RTN","SDM1A",162,0)
 ;     SDDA := ^SC(SDCL,"S",SDT,1,SDDA,0)
"RTN","SDM1A",163,0)
 ;    SDACT := current x-ref action 'set' or 'kill' 
"RTN","SDM1A",164,0)
 ;  SDCOCMP := check out completed date
"RTN","SDM1A",165,0)
 ;   SDCODT := check out date/time
"RTN","SDM1A",166,0)
 ;     SDOE := Outpatient Encounter ien
"RTN","SDM1A",167,0)
 ;    SDINP := inpatient status ('I' or null)    
"RTN","SDM1A",168,0)
 ;    SDINP := inpatient status ('I' or null)    
"RTN","SDM4")
0^6^B8861998
"RTN","SDM4",1,0)
SDM4 ;ALB/BOK - MAKE APPOINTMENT ; 12 APR 1988 1100
"RTN","SDM4",2,0)
 ;;5.3;Scheduling;**263,273,327**;Aug 13, 1993
"RTN","SDM4",3,0)
 ;
"RTN","SDM4",4,0)
 ;09/15/2002 $N FUNCTION REMOVED AND REPLACED WITH $O - IOFO - BAY PINES - TEH
"RTN","SDM4",5,0)
 ;
"RTN","SDM4",6,0)
TYPE ;
"RTN","SDM4",7,0)
 D SC
"RTN","SDM4",8,0)
 D 2^VADPT S SDATD=$S($D(SDAPTYP):SDAPTYP,$D(^SC(+SC,"AT")):$S($D(^SD(409.1,+^("AT"),0)):$P(^(0),U),1:"REGULAR"),1:"REGULAR") W !,"APPOINTMENT TYPE: "_SDATD_"//" R X:DTIME I X']"" S X=SDATD
"RTN","SDM4",9,0)
 I X["^" W !,"APPOINTMENT TYPE IS REQUIRED" G TYPE
"RTN","SDM4",10,0)
 S SDEC=$S($D(^DIC(8,+VAEL(1),0)):$P(^(0),U,5),1:"")
"RTN","SDM4",11,0)
 S DIC("S")="I '$P(^(0),U,3),$S(SDEC[""Y"":1,1:$P(^(0),U,5)),$S('$P(^(0),U,6):1,$D(VAEL(1,+$P(^(0),U,6))):1,+VAEL(1)=$P(^(0),U,6):1,1:0)",DIC="^SD(409.1,",DIC(0)="EQMZ" D ^DIC K DIC
"RTN","SDM4",12,0)
 I X["^"!(Y'>0) W !,"Appointment type is required",!,"Patient must have the eligibility code EMPLOYEE, COLLATERAL or SHARING AGREEMENT",!,"to choose those types of appointments." G TYPE
"RTN","SDM4",13,0)
 S COLLAT=$S(+Y=1:1,+Y=7:7,1:0),SDAPTYP=+Y,SDDECOD=$P(^SD(409.1,+Y,0),U,6) I COLLAT W !!,"** Note - You are making a ",$P(^SD(409.1,+COLLAT,0),U)," appt.",!
"RTN","SDM4",14,0)
 Q:$D(SDAMBAE)
"RTN","SDM4",15,0)
 I COLLAT=7 S SDCOL=$P(^SD(409.1,SDAPTYP,0),U,6) I '$D(SDMLT)&'$D(SDD) D ^SDM0,END^SDM
"RTN","SDM4",16,0)
 Q
"RTN","SDM4",17,0)
ELIG S SDALLE="",SDEMP=$P(VAEL(1),U,2) W !,"THIS PATIENT HAS OTHER ENTITLED ELIGIBILITIES:" F SDOEL=0:0 S SDOEL=$O(VAEL(1,SDOEL)) Q:SDOEL=""  W !?5,$P(VAEL(1,SDOEL),U,2) S SDALLE=SDALLE_"^"_$P(VAEL(1,SDOEL),U,2)
"RTN","SDM4",18,0)
1 W !,"ENTER THE ELIGIBILITY FOR THIS APPOINTMENT: "_SDEMP_"// " R X:DTIME Q:"^"[X  S X=$$UPPER^VALM1(X) G ELIG:X["?",1:SDALLE'[("^"_X)
"RTN","SDM4",19,0)
 S SDEMP=X_$P($P(SDALLE,"^"_X,2),"^") W $P($P(SDALLE,"^"_X,2),"^")
"RTN","SDM4",20,0)
 F SDOEL=0:0 S SDOEL=$O(VAEL(1,SDOEL)) Q:SDOEL=""  I $P(VAEL(1,SDOEL),U,2)=SDEMP S SDEMP=SDOEL_"^"_SDEMP Q
"RTN","SDM4",21,0)
 Q
"RTN","SDM4",22,0)
SC ;SERVICE CONNECTED MESSAGE/IOFO - BAY PINES/TEH
"RTN","SDM4",23,0)
 I $D(^DPT(DFN,.3)) S SDAMSCN=+$P(^(.3),U,2) I SDAMSCN>49 D
"RTN","SDM4",24,0)
 .W !,?7,"********** THIS PATIENT IS 50% OR GREATER SERVICE-CONNECTED **********",!
"RTN","SDM4",25,0)
 ;I $D(SDWLLIST),SDWLLIST D ^SDWLR  ;SD/327
"RTN","SDM4",26,0)
 Q
"RTN","SDMM")
0^10^B40995043
"RTN","SDMM",1,0)
SDMM ;SF/GFT,MAN/GRR - MULTIPLE APPOINTMENTS ; 2/7/05 12:51pm
"RTN","SDMM",2,0)
 ;;5.3;Scheduling;**26,32,167,241,327**;Aug 13, 1993
"RTN","SDMM",3,0)
 N SDHX,SDAPDT S SDMM=1 D ^SDM K SDMM Q
"RTN","SDMM",4,0)
RDTY K ^TMP($J,"APPT"),^TMP($J,"SDAMA301") ;SD/327
"RTN","SDMM",5,0)
 R !,"WANT TO MAKE DAILY OR WEEKLY APPOINTMENTS?: WEEKLY// ",SDTYP:DTIME Q:SDTYP["^"!('$T)  S:SDTYP="" SDTYP="W" S SDTYP=$$UP^XLFSTR($E(SDTYP)) I "WD"'[SDTYP W !,"ENTER 'D' FOR DAILY OR PRESS RETURN" G RDTY
"RTN","SDMM",6,0)
RD22 I SDTYP["D" S %=2 W !,"WANT APPOINTMENTS MADE ON SATURDAYS AND SUNDAYS" D YN^DICN S SDWE=$S(%<0:"^",%=2:"N",%=1:"Y",1:"?") Q:SDWE["^"  G:SDWE["?" HLP22
"RTN","SDMM",7,0)
ADT K SDERRFT S CCX=""
"RTN","SDMM",8,0)
 S X=$G(SDSDATE) S:X SDHX=X\1 K SDSDATE
"RTN","SDMM",9,0)
 W:X#1 !,"APPOINTMENT DATE/TIME REQUESTED: "
"RTN","SDMM",10,0)
 I '(X#1) R !,"DATE/TIME: ",X:DTIME I "^"[X K X,SD Q
"RTN","SDMM",11,0)
 I X="M"!(X="m") D MORDIS G ADT
"RTN","SDMM",12,0)
 I X="D"!(X="d") S X=$$REDDT^SDM1() D:X>0 MORD2 W:X="" $C(7),"  ??",! G ADT
"RTN","SDMM",13,0)
 I X?1"?".E D HLP1 G ADT
"RTN","SDMM",14,0)
 I X=" ",$G(SDAPDT) S Y=SDAPDT D AT^SDUTL W Y S Y=SDAPDT G OVR
"RTN","SDMM",15,0)
 I $E($P(X,"@",2),1,4)?1.4"0" K %DT S X=$P(X,"@"),X=$S($L(X):X,1:"T"),%DT="XF" D ^%DT G ADT:Y'>0 S X1=Y,X2=-1 D C^%DTC S X=X_.24
"RTN","SDMM",16,0)
 K %DT S %DT="TXEF" D ^%DT
"RTN","SDMM",17,0)
 I $P(Y,".",2)=24 S X1=$P(Y,"."),X2=1 D C^%DTC S Y=X_".000001"
"RTN","SDMM",18,0)
 S SDSOH=$S('$D(^SC(+SC,"SL")):0,$P(^("SL"),"^",8)']"":0,1:1)
"RTN","SDMM",19,0)
OVR S SDY1=$P(Y,".") I $D(^HOLIDAY(SDY1,0)),'SDSOH W *7,?50,$P(^(0),U,2),"??" G ADT
"RTN","SDMM",20,0)
 I $D(SDINA),SDY1'<SDINA,$S('$D(SDRE):1,SDRE>SDY1!('SDRE):1,1:0) S SDY=Y,Y=SDINA D DTS^SDUTL W !,*7,"Clinic is scheduled to be inactivated on ",Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" and reactivated on "_Y,1:"") S Y=SDY K SDY G ADT
"RTN","SDMM",21,0)
 I Y#1=0 G ADT
"RTN","SDMM",22,0)
 D SDFT I $P(Y,".")'<SDEDT W !,*7,"EXCEEDS MAXIMUM DAYS FOR FUTURE APPOINTMENT!!",*7 G ADT
"RTN","SDMM",23,0)
LEN I $P(SL,U,2)]"" W !,"LENGTH OF APPOINTMENTS (IN MINUTES): ",+SL,"// " R S:DTIME I S]"" G:$L(S)>3 LEN Q:U[S  S POP=0 D L^SDM1 G LEN:POP I S\5*5=S,S'>360,S'<5 S SL=S_U_$P(SL,U,2,99)
"RTN","SDMM",24,0)
 S SDOT=Y#1,SDDAT=$P(Y,"."),X=Y D DOW^SDM0
"RTN","SDMM",25,0)
RDC W !,"FOR HOW MANY CONSECUTIVE ",$S(SDTYP["W":$P($T(DAY),"^",Y+2)_"DAY'S",1:"DAYS")," DO YOU WANT APPOINTMENTS SCHEDULED",!,"   AT " S X=SDOT D TM W X,"?: "
"RTN","SDMM",26,0)
 R SDCN:DTIME G:SDCN=""!(SDCN="^") ADT G HLP:SDCN'?.N,HLP:SDCN<1,HLP:SDCN>60
"RTN","SDMM",27,0)
 S Y=SDDAT_SDOT,SDMCNT=0,SDMADE=0
"RTN","SDMM",28,0)
OTHER R !,"  OTHER INFO: ",D:DTIME I D["^" W !,*7,"'^' not allowed - hit return if no 'OTHER INFO' is to be entered" G OTHER
"RTN","SDMM",29,0)
 I $L(D)>150 D MSG G OTHER
"RTN","SDMM",30,0)
 I D]"",D?."?"!(D'?.ANP) W "  ENTER LAB, SCAN, ETC." G OTHER
"RTN","SDMM",31,0)
 I $L(D)+$L(SDW)>250 D MSG G OTHER
"RTN","SDMM",32,0)
BEGIN S SDZM=1,SDZY=Y,SDX9=X,SDM9=D D SDMM^SDM1A K SDZM S Y=SDZY,X=SDX9,D=SDM9
"RTN","SDMM",33,0)
 F SDZ=1:1:SDCN D MAKE^SDMM1 Q:$D(SDERRFT)  D  Q:POP
"RTN","SDMM",34,0)
 .S:SDMADE SDMCNT=SDMCNT+1 I SDMADE,SDZ=1 S SDAPDT=SD
"RTN","SDMM",35,0)
 .S SDMADE=0,POP=0 D GETNEX:SDTYP["W",GETNXD:SDTYP["D"
"RTN","SDMM",36,0)
 .Q
"RTN","SDMM",37,0)
 G:$D(SDERRFT) ADT
"RTN","SDMM",38,0)
END W !,SDMCNT," APPOINTMENTS MADE",!
"RTN","SDMM",39,0)
 ;display all created appointments
"RTN","SDMM",40,0)
 I $D(^TMP($J,"APPT")) D
"RTN","SDMM",41,0)
 .D APPTD^SDWLEVAL ;display appointment(s)
"RTN","SDMM",42,0)
 .N SDTC D EWLANS^SDWLEVAL(.SDTC) ;user may reject EWL
"RTN","SDMM",43,0)
 .;ask for selection of EWL to display
"RTN","SDMM",44,0)
 .;ASKS - returned answer (A/C/S/^)
"RTN","SDMM",45,0)
 .;    ^TMP("SDWLPL",$J) and ^TMP($J,"SDWLPL") are used
"RTN","SDMM",46,0)
 .;      to generate EWL open entries
"RTN","SDMM",47,0)
 .I SDTC N SDCTN S SDCTN=0 F  N ASKS K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL") D ANS2^SDWLPL(DFN,.ASKS) Q:ASKS="^"  D  Q:SDCTN
"RTN","SDMM",48,0)
 ..Q:'$D(^TMP($J,"SDWLPL"))  D ASKREM^SDWLEVAL S SDCTN=1 ;display and process selected open EWL entries
"RTN","SDMM",49,0)
 .I 'SDTC Q  ;no EWL evaluation per user's decision
"RTN","SDMM",50,0)
 .Q
"RTN","SDMM",51,0)
 ;
"RTN","SDMM",52,0)
 K CCX,COLLAT,COV,D,I,POP,S,SC,SD,SDAPTYP,SDEDT,SDEMP,SDINA,SDLOCK,SDM9,SDMES,SDNOT,SDRE,SDSOH,SDW,SDWEE,SDX3,SDX7,SDX9,SDY1,SDYC,SDZ,SDZY,SDMES,SDCN,SDDAT,SDMADE,SDMCNT,SDOT,SDPL,SDRT,SDSC,SDTTM,SDTYP
"RTN","SDMM",53,0)
 K SDALLE,SDATD,SDAV,SDDECOD,SDEC,SDHX,SDIN,SDINP,SDOEL,SDT,SDY,%H,%T,C,DISYS,SDW,SDWE,SDX3,SDX7,SDX9,SDY1,SDYC,SDZY,SI,SL,SM,SS,X1,X2,Y,SDXF,% Q
"RTN","SDMM",54,0)
GETNEX I SDDAT#100<22 S SDDAT=SDDAT+7 S POP=0 D INACT Q:POP  G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNEX S Y=SDDAT_SDOT Q
"RTN","SDMM",55,0)
 S X1=SDDAT,X2=7 D C^%DTC S POP=0 D INACT Q:POP  S SDDAT=X G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNEX S Y=SDDAT_SDOT
"RTN","SDMM",56,0)
 Q
"RTN","SDMM",57,0)
GETNXD I SDDAT#100<28 S SDDAT=SDDAT+1 S POP=0 D INACT Q:POP  G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNXD S X=SDDAT D DOW^SDM0 S:SDWE["Y" Y=SDDAT_SDOT Q:SDWE["Y"  G:Y=0!(Y=6) GETNXD S Y=SDDAT_SDOT Q
"RTN","SDMM",58,0)
 S X1=SDDAT,X2=1 D C^%DTC S POP=0 D INACT Q:POP  S SDDAT=X G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNXD S X=SDDAT D DOW^SDM0 S:SDWE["Y" Y=SDDAT_SDOT Q:SDWE["Y"  G:Y=0!(Y=6) GETNXD S Y=SDDAT_SDOT
"RTN","SDMM",59,0)
 Q
"RTN","SDMM",60,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDMM",61,0)
 ;
"RTN","SDMM",62,0)
TM S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M" Q
"RTN","SDMM",63,0)
HLP W !,"Enter the number of appointments you want made (between 1 and 60)." G RDC
"RTN","SDMM",64,0)
HLP22 W !,"ENTER 'YES' IF YOU WANT THE SYSTEM TO TRY TO MAKE APPOINTMENTS ON SATURDAYS AND SUNDAYS" G RD22
"RTN","SDMM",65,0)
INACT I $D(SDINA),SDINA'>SDDAT,SDRE>SDDAT!('SDRE) W !,*7,"Appointments can't be made while clinic is inactivated" S POP=1
"RTN","SDMM",66,0)
 Q
"RTN","SDMM",67,0)
HLP1 W !,"Enter a date/time for the appointment"
"RTN","SDMM",68,0)
 W:$D(SD) " or a space to choose the same date/time",!,"as the patient you have just previously scheduled into this clinic"
"RTN","SDMM",69,0)
 W ".",!,"You may also select 'M' to display the next month's availability or"
"RTN","SDMM",70,0)
 W !,"'D' to specify an earlier or later date to begin the availability display."
"RTN","SDMM",71,0)
 Q
"RTN","SDMM",72,0)
SDFT S X1=DT,SDEDT=$S($D(^SC(SC,"SDP")):$P(^("SDP"),U,2),1:365) S:'SDEDT SDEDT=365 S X2=SDEDT D C^%DTC S SDEDT=X Q
"RTN","SDMM",73,0)
MSG W !!?5,"Text entered at OTHER INFO prompt was too long.  Please re-enter.",! Q
"RTN","SDMM",74,0)
 ;
"RTN","SDMM",75,0)
MORDIS I '$D(SDHX) W *7," ??" G ADT
"RTN","SDMM",76,0)
 S SDXF=0,X1=SDHX,X2=1 D C^%DTC
"RTN","SDMM",77,0)
MORD2 I $D(SDINA),SDINA'>X,SDRE>X!('SDRE) S SDHY=$S($D(Y):Y,1:""),Y=SDINA D DTS^SDUTL W *7,!,"Clinic is inactivated as of ",Y S Y=SDHY K SDHY G ADT
"RTN","SDMM",78,0)
EN S:$L(X)=1 X=$TR(X,"tnN","TTT") S:X="NOW" X="T" I X?.A!(+X=X),X<13,X'?1"T".E S X=X_" 1"
"RTN","SDMM",79,0)
 D  Q:Y<1
"RTN","SDMM",80,0)
 .N %DT
"RTN","SDMM",81,0)
 .S %DT="T" D ^%DT
"RTN","SDMM",82,0)
 .I Y<1 W !!,"Unable to evaluate date value """_X_""".",!
"RTN","SDMM",83,0)
 .Q
"RTN","SDMM",84,0)
 S:$S($D(DUZ)'[0:1,1:0) ^DISV(DUZ_U_+SC)=Y
"RTN","SDMM",85,0)
DISP S IOF=$S('$D(IOF):"!#",IOF']"":"!#",1:IOF) W @IOF S SDSOH=$S('$D(^SC(+SC,"SL")):0,$P(^("SL"),"^",8)']"":0,1:1),SDAV=0
"RTN","SDMM",86,0)
 I $D(SDINA),Y'<SDINA,SDRE>Y!('SDRE) S SDHY=Y,Y=SDINA D DTS^SDUTL W !,*7,"Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"") S Y=SDHY K SDHY Q:'SDRE
"RTN","SDMM",87,0)
 S:Y#100=0 Y=Y+1 S X=Y D D^SDM0:$E(X,4,5) S (SDX,X1)=X,X2=1 D C^%DTC S X=SDX K SDX Q
"RTN","SDMM1")
0^11^B15400257
"RTN","SDMM1",1,0)
SDMM1 ;ALB/GRR - MULTIPLE BOOKINGS ; 2/7/05 8:16am
"RTN","SDMM1",2,0)
 ;;5.3;Scheduling;**28,206,168,327**;Aug 13, 1993
"RTN","SDMM1",3,0)
MAKE S (SDX3,X,SD)=Y,SM=0 D DOW^SDM0 I $D(^DPT(DFN,"S",X)) S I=^(X,0) I $P(I,"^",2)'["C" W !,"PATIENT ALREADY HAS APPOINTMENT ON ",$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(X,4,5))," ",$E(X,6,7)," AT THAT TIME" Q
"RTN","SDMM1",4,0)
 S SDX7=X D SDFT^SDMM S X=SDX7 I $P(SDX3,".")'<SDEDT W !,*7,"EXCEEDS MAXIMUM DAYS FOR FUTURE APPOINTMENT!!",*7 Q
"RTN","SDMM1",5,0)
S S SDNOT=0 I '$D(^SC(SC,"ST",$P(X,"."),1)) S SS=$O(^SC(+SC,"T"_Y,X)) G X:'SS,X:^(SS,1)="" S ^SC(+SC,"ST",$P(X,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(X,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(X,".")
"RTN","SDMM1",6,0)
SC S POP=0,SD=X D SC^SDM1 I SDLOCK W ! D DT W " HAS BEEN LOCKED BY ANOTHER USER - APPT NOT BOOKED" L  Q
"RTN","SDMM1",7,0)
 G X:POP,OK:SM#9=0 S SDY=Y,Y=X
"RTN","SDMM1",8,0)
 ;
"RTN","SDMM1",9,0)
 D OB I SDNOT=0 Q  ; check overbook/keys...quit if not ok
"RTN","SDMM1",10,0)
 S SM=9 G SC
"RTN","SDMM1",11,0)
 ;
"RTN","SDMM1",12,0)
OK S ^SC(SC,"ST",$P(X,"."),1)=S,^SC(SC,"S",X,0)=X S:'$D(^DPT(DFN,"S",0)) ^(0)="^2.98^^" S:'$D(^SC(SC,"S",0)) ^(0)="^44.001DA^^" L
"RTN","SDMM1",13,0)
S1 L ^SC(SC,"S",X,1):5 G:'$T S1 F Y=1:1 I '$D(^SC(SC,"S",X,1,Y)) S:'$D(^(0)) ^(0)="^44.003PA^^" S ^(Y,0)=DFN_U_(+SL)_U_U_D_U_U_$S($D(DUZ):DUZ,1:"")_U_DT_U_U_U_$S(+SDEMP:+SDEMP,1:"") S SDY=Y L  Q
"RTN","SDMM1",14,0)
 I SM S ^("OB")="O" ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,"OB")
"RTN","SDMM1",15,0)
 I $D(^SC(SC,"RAD")),^("RAD")="Y"!(^("RAD")=1) S ^SC("ARAD",SC,X,DFN)=""
"RTN","SDMM1",16,0)
 S SDINP=$$INP^SDAM2(DFN,X)
"RTN","SDMM1",17,0)
 S COV=3,SDYC="",COV=$S(COLLAT=1:1,1:3),SDYC=$S(COLLAT=7:1,1:""),^DPT(DFN,"S",X,0)=SC_"^"_$$STATUS^SDM1A(SC,SDINP,X)_"^^^^^"_COV_"^^^^"_SDYC_"^^^^^"_SDAPTYP_"^^^"_DT_"^^^^^^M^0",SDMADE=1
"RTN","SDMM1",18,0)
 D XRDT(DFN,X)  ;xref DATE APPT. MADE field
"RTN","SDMM1",19,0)
 K:$D(^DPT("ASDCN",SC,X,DFN)) ^(DFN) K:$D(^DPT(DFN,"S",X,"R")) ^("R")
"RTN","SDMM1",20,0)
 S SDRT="A",SDTTM=X,SDPL=SDY,SDSC=SC D RT^SDUTL
"RTN","SDMM1",21,0)
 L  W !,"APPOINTMENT MADE ON " S Y=X D DT^DIQ
"RTN","SDMM1",22,0)
 ;check for open EWL entries and create TMP($J,"APPT";SD/327
"RTN","SDMM1",23,0)
 N SDEV,SD D EN^SDWLEVAL(DFN,.SDEV) S SD=X I SDEV D APPT^SDWLEVAL(DFN,SD,SC)
"RTN","SDMM1",24,0)
 D EVT
"RTN","SDMM1",25,0)
 Q
"RTN","SDMM1",26,0)
 ;
"RTN","SDMM1",27,0)
XRDT(DFN,X) ;cross reference DATE APPT. MADE field
"RTN","SDMM1",28,0)
 ;Input: DFN=patient ifn
"RTN","SDMM1",29,0)
 ;Input: X=appointment date
"RTN","SDMM1",30,0)
 N DIK,DA,DIV S DA=X,DA(1)=DFN
"RTN","SDMM1",31,0)
 S DIK="^DPT(DA(1),""S"",",DIK(1)=20 D EN1^DIK
"RTN","SDMM1",32,0)
 Q
"RTN","SDMM1",33,0)
 ;
"RTN","SDMM1",34,0)
NOOB S SDMES="NO OPEN SLOTS ON "
"RTN","SDMM1",35,0)
WRTER W !,SDMES D DT W:SDNOT " AT THAT TIME" S SDNOT=0 Q
"RTN","SDMM1",36,0)
DT W $P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(X,4,5))," ",$E(X,6,7) Q
"RTN","SDMM1",37,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDMM1",38,0)
 ;
"RTN","SDMM1",39,0)
X L  I SDZ=1 W !,*7,"CLINIC DOES NOT MEET THEN!!" S SDERRFT=1 Q
"RTN","SDMM1",40,0)
 S SDMES="CLINIC DOES NOT MEET ON " G WRTER
"RTN","SDMM1",41,0)
 ;
"RTN","SDMM1",42,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDMM1",43,0)
 N D,SI,SC,SL,COLLAT D MAKE^SDAMEVT(DFN,SDTTM,SDSC,SDPL,0)
"RTN","SDMM1",44,0)
 Q
"RTN","SDMM1",45,0)
 ;
"RTN","SDMM1",46,0)
OB ; check for overbook keys
"RTN","SDMM1",47,0)
 N %,D,I,S,ST
"RTN","SDMM1",48,0)
 S SDNOT=1
"RTN","SDMM1",49,0)
 I '$D(^XUSEC("SDOB",DUZ)),'$D(^XUSEC("SDMOB",DUZ)) D NOOB G OBQ ; user has neither key
"RTN","SDMM1",50,0)
 S I=$P(SD,".",1),(S,ST)=$P(SL,U,7) ; counter of OBs for day = ST
"RTN","SDMM1",51,0)
 I ST F D=I-.01:0 S D=$O(^SC(SC,"S",D)) Q:$P(D,".",1)-I  F %=0:0 S %=$O(^SC(SC,"S",D,1,%)) Q:'%  I $P(^(%,0),"^",9)'["C",$D(^("OB")) S ST=ST-1
"RTN","SDMM1",52,0)
 I ST<1 D  G OBQ
"RTN","SDMM1",53,0)
 . I '$D(^XUSEC("SDMOB",DUZ)) W !,*7,"ONLY "_S_" OVERBOOK"_$E("S",S>1)_" ALLOWED PER DAY!!" D NOOB Q
"RTN","SDMM1",54,0)
 . S MXOK=$$DIR("WILL EXCEED MAXIMUM ALLOWABLE OVERBOOKS FOR "_$$FMTE^XLFDT(Y)_", OK","YES")
"RTN","SDMM1",55,0)
 . I 'MXOK S SM=9,SDNOT=0 Q
"RTN","SDMM1",56,0)
 . I MXOK S S=^SC(SC,"ST",I,1),SM=9,MXOK=""
"RTN","SDMM1",57,0)
 I '$D(^XUSEC("SDOB",DUZ)) D NOOB G OBQ
"RTN","SDMM1",58,0)
 I '$$DIR($$FMTE^XLFDT(Y)_" WILL BE AN OVERBOOK, OK","NO") S SM=9,SDNOT=0
"RTN","SDMM1",59,0)
OBQ Q
"RTN","SDMM1",60,0)
 ;
"RTN","SDMM1",61,0)
DIR(TEXT,DEF) ; reader processor
"RTN","SDMM1",62,0)
 ; Input:  TEXT as text of read
"RTN","SDMM1",63,0)
 ;         DEF as default response (if any)
"RTN","SDMM1",64,0)
 ;
"RTN","SDMM1",65,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","SDMM1",66,0)
 S DIR(0)="Y",DIR("A")=TEXT
"RTN","SDMM1",67,0)
 I $G(DEF)]"" S DIR("B")=DEF
"RTN","SDMM1",68,0)
 D ^DIR
"RTN","SDMM1",69,0)
 W:'Y !
"RTN","SDMM1",70,0)
 Q Y
"RTN","SDWLEVAL")
0^14^B82936763
"RTN","SDWLEVAL",1,0)
SDWLEVAL ;;IOFO BAY PINES/ESW - WAIT LIST - DISPOSITION AFTER APPOINTMENT(S) ENTRY;06/12/2002 ; 5/23/05 4:47pm
"RTN","SDWLEVAL",2,0)
 ;;5.3;Scheduling;**327**;AUG 13 1993
"RTN","SDWLEVAL",3,0)
 ;Evaluate appt for optional disposition
"RTN","SDWLEVAL",4,0)
 ;called from SDMM, SDMM1, SDM1A, SDAM2
"RTN","SDWLEVAL",5,0)
 ;replaces SDWLR
"RTN","SDWLEVAL",6,0)
 ;
"RTN","SDWLEVAL",7,0)
EN(DFN,SDYN) ;evaluation if patient is on EWL
"RTN","SDWLEVAL",8,0)
 ; SDYN has to be passed by reference
"RTN","SDWLEVAL",9,0)
 ;output: SDYN=0 -  no open entries in EWL
"RTN","SDWLEVAL",10,0)
 ;        SDYN=1 -  at least one open entry in EWL
"RTN","SDWLEVAL",11,0)
 ;        SDYN(1)  - related message
"RTN","SDWLEVAL",12,0)
 S SDYN=0,SDYN(1)=""
"RTN","SDWLEVAL",13,0)
 I '$D(DFN)!(DFN'?1.N) S SDYN(1)="Patient's DFN not passed." Q
"RTN","SDWLEVAL",14,0)
 I $D(DFN),'$D(^SDWL(409.3,"B",DFN)) S SDYN(1)="This patient is not on EWL." Q
"RTN","SDWLEVAL",15,0)
 S SDWLDA="" F  S SDWLDA=$O(^SDWL(409.3,"B",DFN,SDWLDA)) Q:SDWLDA=""  D  Q:SDYN=1
"RTN","SDWLEVAL",16,0)
 .I $P($G(^SDWL(409.3,SDWLDA,0)),"^",17)="O" S SDYN=1,SDYN(1)="Patient has open Wait List entries."
"RTN","SDWLEVAL",17,0)
 I SDYN=0 S SDYN(1)="Patient has no open Wait List entries."
"RTN","SDWLEVAL",18,0)
 Q
"RTN","SDWLEVAL",19,0)
EWLANS(SDCONT) ;display EWL OPEN entries
"RTN","SDWLEVAL",20,0)
 ;check if to continue with EWL open entries
"RTN","SDWLEVAL",21,0)
 S SDCONT=0
"RTN","SDWLEVAL",22,0)
 N X,DIR
"RTN","SDWLEVAL",23,0)
 S DIR("B")="YES"
"RTN","SDWLEVAL",24,0)
 S DIR("A")="Do you want to display open Wait list entries (Yes/No)?",DIR(0)="Y"
"RTN","SDWLEVAL",25,0)
 S DIR("?")="Do you want to review open EWL entries for Dispositioning?"
"RTN","SDWLEVAL",26,0)
 D ^DIR
"RTN","SDWLEVAL",27,0)
 I Y S SDCONT=1
"RTN","SDWLEVAL",28,0)
 Q
"RTN","SDWLEVAL",29,0)
ASKREM ;prompt user for record for dispositioning
"RTN","SDWLEVAL",30,0)
 S SDDIS=0 ; flag indicating disposition
"RTN","SDWLEVAL",31,0)
 W ! N X,DIR
"RTN","SDWLEVAL",32,0)
 S DIR("B")="NO"
"RTN","SDWLEVAL",33,0)
 S DIR("A")="DO YOU WISH TO REMOVE ANY ENTRY FROM LIST (Yes/No)? ",DIR(0)="Y"
"RTN","SDWLEVAL",34,0)
 S DIR("?")="To disposition any entry based on scheduled appointments."
"RTN","SDWLEVAL",35,0)
 D ^DIR
"RTN","SDWLEVAL",36,0)
 I Y S SDDIS=1
"RTN","SDWLEVAL",37,0)
 D ANSW(SDDIS)
"RTN","SDWLEVAL",38,0)
 Q
"RTN","SDWLEVAL",39,0)
ANSW(SDDIS) ;
"RTN","SDWLEVAL",40,0)
 ;SDDIS=0 - select entries not to disposition
"RTN","SDWLEVAL",41,0)
 ;SDDIS=1 - select entries to disposition
"RTN","SDWLEVAL",42,0)
 K DIR,X
"RTN","SDWLEVAL",43,0)
 W !
"RTN","SDWLEVAL",44,0)
 N STR,SS S SDC=$O(^TMP($J,"SDWLPL",""),-1) I SDC=1 S DIR("B")=1
"RTN","SDWLEVAL",45,0)
 S DIR(0)="L^1:"_SDC S DIR("A")="Select entries for entering Non-Removal Reason or '^' to Quit>",DIR("?")="Enter number(s) or range of displayed Wait List entries."
"RTN","SDWLEVAL",46,0)
 I SDDIS S DIR("A")="Select entries for dispositioning or '^' to Quit>"
"RTN","SDWLEVAL",47,0)
 D ^DIR
"RTN","SDWLEVAL",48,0)
 I X="^" D END Q
"RTN","SDWLEVAL",49,0)
 I X["-" D
"RTN","SDWLEVAL",50,0)
 .N SXB,SXE
"RTN","SDWLEVAL",51,0)
 .S SXB=$P(X,"-"),SXE=$P(X,"-",2) N SDC F SDC=SXB:1:SXE S SDWLDA=+^TMP($J,"SDWLPL",SDC) D
"RTN","SDWLEVAL",52,0)
 ..;LOCK
"RTN","SDWLEVAL",53,0)
 ..L +^SDWL(409.3,SDWLDA):5 I '$T W !,"Another User is Editing this Entry. Try Later." Q
"RTN","SDWLEVAL",54,0)
 ..I 'SDDIS D DISPO(SDWLDA,SDC)
"RTN","SDWLEVAL",55,0)
 ..I SDDIS D GETDATA(SDWLDA) D DISEND(SDWLDA,SDC)
"RTN","SDWLEVAL",56,0)
 I X[","!(X?1N) D
"RTN","SDWLEVAL",57,0)
 .N FF S FF=X N GG,SDC F GG=1:1 S SDC=$P(FF,",",GG) Q:SDC=""  S SDWLDA=+^TMP($J,"SDWLPL",SDC) D
"RTN","SDWLEVAL",58,0)
 ..;LOCK
"RTN","SDWLEVAL",59,0)
 ..L +^SDWL(409.3,SDWLDA):5 I '$T W !,"Another User is Editing this Entry. Try Later." Q
"RTN","SDWLEVAL",60,0)
 ..I 'SDDIS D DISPO(SDWLDA,SDC)
"RTN","SDWLEVAL",61,0)
 ..I SDDIS D GETDATA(SDWLDA) D DISEND(SDWLDA,SDC)
"RTN","SDWLEVAL",62,0)
 ..L
"RTN","SDWLEVAL",63,0)
 Q
"RTN","SDWLEVAL",64,0)
DISEND(SDWLAD,SDC) ;enter disposition
"RTN","SDWLEVAL",65,0)
 ;SDWLDA - IEN of 409.3  
"RTN","SDWLEVAL",66,0)
 ;are you sure you want to disposition this entry:
"RTN","SDWLEVAL",67,0)
 ;display an entry
"RTN","SDWLEVAL",68,0)
 ;quit if NO
"RTN","SDWLEVAL",69,0)
 ;proceed if YES
"RTN","SDWLEVAL",70,0)
 D EDIT(SDWLDA,SDC,.SDWLERR) Q:$D(DUOUT)  I SDWLERR Q
"RTN","SDWLEVAL",71,0)
 W !!,"*** Patient has been removed from Wait List ***",!
"RTN","SDWLEVAL",72,0)
 K DIR,DIE,DR,DIC
"RTN","SDWLEVAL",73,0)
 S DIR(0)="E" D ^DIR I $D(DUOUT) Q
"RTN","SDWLEVAL",74,0)
 Q
"RTN","SDWLEVAL",75,0)
GETDATA(SDWLDA) ;PATIENT DATA RETRIEVAL
"RTN","SDWLEVAL",76,0)
 S SDWLDATA=$G(^SDWL(409.3,SDWLDA,0))
"RTN","SDWLEVAL",77,0)
 S SDWLIN=$P(SDWLDATA,U,3),SDWLCL=+$P(SDWLDATA,U,4),SDWLTY=$P(SDWLDATA,U,5),SDWLST=$P(SDWLDATA,U,6)
"RTN","SDWLEVAL",78,0)
 S SDWLSP=$P(SDWLDATA,U,7),SDWLSS=$P(SDWLDATA,U,8),SDWLSC=$P(SDWLDATA,U,9),SDWLPRI=$P(SDWLDATA,U,10),SDWLRB=$P(SDWLDATA,U,11)
"RTN","SDWLEVAL",79,0)
 S SDWLPROV=$P(SDWLDATA,U,12),SDWLDAPT=$P(SDWLDATA,U,16),SDWLST=$P(SDWLDATA,U,17),SDWLDUZ=DUZ,SDWLEDT=DT
"RTN","SDWLEVAL",80,0)
 S SDWLSCL="" I SDWLSC S SDWLSCL=+$P(^SDWL(409.32,SDWLSC,0),U,1)
"RTN","SDWLEVAL",81,0)
 I $D(^SDWL(409.3,SDWLDA,"DIS")) S SDWLDISP=$P(^SDWL(409.3,SDWLDA,"DIS"),U,3)
"RTN","SDWLEVAL",82,0)
 Q
"RTN","SDWLEVAL",83,0)
EDIT(SDWLDA,SDC,SDWLERR) ;ENTER/EDIT DISPOSITION
"RTN","SDWLEVAL",84,0)
 ;SDWLDA -IEN of selected 409.3 entry to disposition
"RTN","SDWLEVAL",85,0)
 ;SDWLERR - called by a reference
"RTN","SDWLEVAL",86,0)
 ;SDC - sequential number in ^TMP($J,"SDWLPL",SDC
"RTN","SDWLEVAL",87,0)
 S SDWLDUZ=DUZ,SDWLERR=0 K DIR,DR,DIE,DIC
"RTN","SDWLEVAL",88,0)
 I $D(SDWLDISP) S DIR("B")=$$EXTERNAL^DILFD(409.3,21,,SDWLDISP)
"RTN","SDWLEVAL",89,0)
 S DIR(0)="SO^D:DEATH;NC:REMOVED/NON-VA CARE;SA:REMOVED/SCHEDULED-ASSIGNED;CC:REMOVED/VA CONTRACT CARE;NN:REMOVED/NO LONGER NECESSARY;ER:ENTERED IN ERROR;Q:QUIT/DO NOT DISPOSITION^"
"RTN","SDWLEVAL",90,0)
 S DIR("L",1)="Disposition Reason for # "_SDC_":",DIR("L",2)="",DIR("L",3)="D DEATH",DIR("L",4)="NC REMOVED/NON-VA CARE",DIR("L",5)="SA REMOVED/SCHEDULED-ASSIGNED"
"RTN","SDWLEVAL",91,0)
 S DIR("L",6)="CC REMOVED/VA CONTRACT CARE",DIR("L",7)="NN REMOVED/NO LONGER NECESSARY",DIR("L",8)="ER ENTERED IN ERROR",DIR("L")="Q QUIT/DO NOT DISPOSITION"
"RTN","SDWLEVAL",92,0)
 ;MAKE DEFAULT 'SA'
"RTN","SDWLEVAL",93,0)
 S DIR("A")="Enter selection or <cr> to accept 'SA REMOVED/SCHEDULED-ASSIGNED'> "
"RTN","SDWLEVAL",94,0)
 S DIR("?")="SA selection will require appointment selection to disposition this entry."
"RTN","SDWLEVAL",95,0)
 S DIR("B")="SA"
"RTN","SDWLEVAL",96,0)
 D ^DIR
"RTN","SDWLEVAL",97,0)
 S SDWLDISP=$S(X["D":"D",X["d":"D",X["NC":"NC",X["nc":"NC",X["SA":"SA",X["sa":"SA",X["CC":"CC",X["cc":"CC",X["NN":"NN",X["nn":"NN",X["ER":"ER",X["er":"ER",X["Q":"^",X="":"SA",1:0)
"RTN","SDWLEVAL",98,0)
 I X="^" S DUOUT=1 Q
"RTN","SDWLEVAL",99,0)
 I SDWLDISP="^" S DUOUT=1 Q
"RTN","SDWLEVAL",100,0)
 I SDWLDISP=0 S SDWLERR=1
"RTN","SDWLEVAL",101,0)
 I SDWLERR W *7,"Invalid Entry" Q
"RTN","SDWLEVAL",102,0)
 S DIE("NO^")="NO EDITING"
"RTN","SDWLEVAL",103,0)
 N SDAP I SDWLDISP="SA" D APPTD D  I SDAP="^" W !,"Disposition canceled by user",! Q
"RTN","SDWLEVAL",104,0)
 .W ! K DIR,X
"RTN","SDWLEVAL",105,0)
 .N STR,SS,SDA S SDA=$O(^TMP($J,"APPT",""),-1) I SDA=1 S DIR("B")=1
"RTN","SDWLEVAL",106,0)
 .S DIR(0)="N^1:"_SDA S DIR("A")="Select appointment entry for Removal Reason or '^' to Quit>",DIR("?")="Select Appointment for updating the selected EWL with."
"RTN","SDWLEVAL",107,0)
 .D ^DIR
"RTN","SDWLEVAL",108,0)
 .S SDAP=X
"RTN","SDWLEVAL",109,0)
 S DIE="^SDWL(409.3,",DA=SDWLDA,DR="21////^S X=SDWLDISP" D ^DIE
"RTN","SDWLEVAL",110,0)
 S DR="19////^S X=DT" D ^DIE
"RTN","SDWLEVAL",111,0)
 S DR="20////^S X=SDWLDUZ" D ^DIE
"RTN","SDWLEVAL",112,0)
 S DR="23////^S X=""C""" D ^DIE
"RTN","SDWLEVAL",113,0)
 ;I SDWLDISP="SA" update with appointment data
"RTN","SDWLEVAL",114,0)
 ;get appointment data to file (for a particular appt #)
"RTN","SDWLEVAL",115,0)
 I SDWLDISP="SA" N SDA D DATP(SDAP,.SDA) D
"RTN","SDWLEVAL",116,0)
 .I $D(SDA) S DIE="^SDWL(409.3,",DA=SDWLDA D
"RTN","SDWLEVAL",117,0)
 ..S DR="13////"_SDA(1)_";13.1////"_DT_";13.2////"_SDA(2)_";13.3////"_SDA(15)_";13.4////"_SDA(13)_";13.5////"_SDA(14)_";13.6////"_SDA(16)_";13.8////"_SDA(3)_";13.7////"_DUZ
"RTN","SDWLEVAL",118,0)
 ..D ^DIE
"RTN","SDWLEVAL",119,0)
 N SDWLSCL,SDWLSS
"RTN","SDWLEVAL",120,0)
 S SDWLSCL=$P($G(^TMP($J,"SDWLPL",SDC)),U,9)
"RTN","SDWLEVAL",121,0)
 S SDWLSS=$P($G(^TMP($J,"SDWLPL",SDC)),U,10)
"RTN","SDWLEVAL",122,0)
 I SDWLSCL K:$D(^SDWL(409.3,"SC",SDWLSCL,SDWLDA)) ^SDWL(409.3,"SC",SDWLSCL,SDWLDA)
"RTN","SDWLEVAL",123,0)
 S SDWLDFN=$P($G(^TMP($J,"APPT",1)),U,4)
"RTN","SDWLEVAL",124,0)
 I SDWLSS,SDWLDFN K:$D(^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLDA)) ^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLDA)
"RTN","SDWLEVAL",125,0)
 Q
"RTN","SDWLEVAL",126,0)
DISPO(SDWLDA,SDC) ;
"RTN","SDWLEVAL",127,0)
 ;SDWLDA - IEN of 409.3
"RTN","SDWLEVAL",128,0)
 ;select NON-REMOVAL reason
"RTN","SDWLEVAL",129,0)
 K DIR,X
"RTN","SDWLEVAL",130,0)
 S DIR(0)="SO^1:APPOINTMENT CRITERIA NOT MET;2:PATIENT WANTS ANOTHER APPOINTMENT;3:PROVIDER WANTS ANOTHER APPOINTMENT;4:OTHER;5:QUIT"
"RTN","SDWLEVAL",131,0)
 S DIR("L",1)="SELECT ONE OF THE FOLLOWING REASONS FOR # "_SDC_":",DIR("L",2)=""
"RTN","SDWLEVAL",132,0)
 S DIR("L",3)="1. APPOINTMENT CRITERIA NOT MET",DIR("L",4)="2. PATIENT WANTS ANOTHER APPOINTMENT"
"RTN","SDWLEVAL",133,0)
 S DIR("L",5)="3. PROVIDER WANTS ANOTHER APPOINTMENT",DIR("L,6")="4. OTHER",DIR("L,7")="5. QUIT"
"RTN","SDWLEVAL",134,0)
 S DIR("A")="Select one of the following reasons for #: "_SDC
"RTN","SDWLEVAL",135,0)
 D ^DIR
"RTN","SDWLEVAL",136,0)
 S X=$E(X,1,2) S:$E(X,2)'="R" X=$E(X)
"RTN","SDWLEVAL",137,0)
 S SDWLX=$S(X="a":"A",X="p":"P",X="pr":"PR",X="o":"O",X="A":"A",X="P":"P",X="PR":"PR",X="O":"O",X=1:"A",X=2:"P",X=3:"PR",X=4:"O",X="^":"^",X="Q":"^",X=5:"^",1:"")
"RTN","SDWLEVAL",138,0)
 I SDWLX="^" Q
"RTN","SDWLEVAL",139,0)
 I SDWLX="O" D
"RTN","SDWLEVAL",140,0)
 .S DIR(0)="FAO^^",DIR("A")="Comments: " D ^DIR Q:X["^"
"RTN","SDWLEVAL",141,0)
 .S SDWLCOM=X,DA=SDWLDA,DIE="^SDWL(409.3,",DR="18.1////^S X=SDWLCOM" D ^DIE
"RTN","SDWLEVAL",142,0)
 N DA S DA=SDWLDA
"RTN","SDWLEVAL",143,0)
 S DIE="^SDWL(409.3,",DR="18////^S X=SDWLX" D ^DIE
"RTN","SDWLEVAL",144,0)
 S DR="17////^S X=DUZ" D ^DIE
"RTN","SDWLEVAL",145,0)
 S DR="16////^S X=DT" D ^DIE
"RTN","SDWLEVAL",146,0)
 K SDWLERR,DIR,DR,DIE,X,SDWLX,SDWLDSS,SDWLASK,SDWLDA,SDWLCOM
"RTN","SDWLEVAL",147,0)
 Q
"RTN","SDWLEVAL",148,0)
HD ;HEADER
"RTN","SDWLEVAL",149,0)
 W:$D(IOF) @IOF W !!,?80-$L("Wait List - Disposition Patient")\2,"Wait List - Disposition Patient",!!
"RTN","SDWLEVAL",150,0)
 Q
"RTN","SDWLEVAL",151,0)
APPT(DFN,SD,SC) ;create appt TMP
"RTN","SDWLEVAL",152,0)
 ;SD - appt date/time
"RTN","SDWLEVAL",153,0)
 ;SC - Hospital Location IEN
"RTN","SDWLEVAL",154,0)
 N SDARR,SCNT
"RTN","SDWLEVAL",155,0)
 S SDDIV=""
"RTN","SDWLEVAL",156,0)
 S SDARR(1)=SD_";"_SD
"RTN","SDWLEVAL",157,0)
 S SDARR(2)=SC
"RTN","SDWLEVAL",158,0)
 S SDARR(4)=DFN
"RTN","SDWLEVAL",159,0)
 S SDARR("FLDS")="1;2;3;4;10;13;14"
"RTN","SDWLEVAL",160,0)
 N SAPP S SAPP=$$SDAPI^SDAMA301(.SDARR) D
"RTN","SDWLEVAL",161,0)
 .N SDINST,SDFAC,SDINSTE
"RTN","SDWLEVAL",162,0)
 .Q:'$D(^TMP($J,"SDAMA301",DFN))
"RTN","SDWLEVAL",163,0)
 .S SCNT=$O(^TMP($J,"APPT",""),-1)+1
"RTN","SDWLEVAL",164,0)
 .S ^TMP($J,"APPT",SCNT)=^TMP($J,"SDAMA301",DFN,SC,SD)
"RTN","SDWLEVAL",165,0)
 .S SDINST=$$GET1^DIQ(44,SC_",",3,"I")  ; get Institution
"RTN","SDWLEVAL",166,0)
 .S SDINSTE=$$GET1^DIQ(44,SC_",",3,"E")
"RTN","SDWLEVAL",167,0)
 .S SDFAC=$S(SDINST="":"",1:$$GET1^DIQ(4,SDINST_",",99,"I"))  ; Station
"RTN","SDWLEVAL",168,0)
 .I SDFAC="" N SDDIV S SDDIV="" S SDDIV=$$GET1^DIQ(44,SC_",",3.5,"I") D
"RTN","SDWLEVAL",169,0)
 ..I SDDIV'="" S SDINST=$$GET1^DIQ(40.8,SDDIV_",",.07,"I") I SDINST'="" D
"RTN","SDWLEVAL",170,0)
 ...S SDFAC=$S(SDINST="":"",1:$$GET1^DIQ(4,SDINST_",",99,"I"))  ; Station
"RTN","SDWLEVAL",171,0)
 ..I SDDIV="" S SDFAC=$P($$SITE^VASITE(,),"^",3)
"RTN","SDWLEVAL",172,0)
 .S $P(^TMP($J,"APPT",SCNT),"^",15)=SDINST_";"_SDINSTE
"RTN","SDWLEVAL",173,0)
 .S $P(^TMP($J,"APPT",SCNT),"^",16)=SDFAC
"RTN","SDWLEVAL",174,0)
 .K ^TMP($J,"SDAMA301",DFN,SC,SD)
"RTN","SDWLEVAL",175,0)
 Q
"RTN","SDWLEVAL",176,0)
APPTD ;display appointment
"RTN","SDWLEVAL",177,0)
 ;from appointment list created in ^TMP if open EWL entries
"RTN","SDWLEVAL",178,0)
 N STR,SCNT
"RTN","SDWLEVAL",179,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDWLEVAL",180,0)
 S SCNT="" F  S SCNT=$O(^TMP($J,"APPT",SCNT)) Q:SCNT=""  D
"RTN","SDWLEVAL",181,0)
 .S STR=^TMP($J,"APPT",SCNT)
"RTN","SDWLEVAL",182,0)
 .N ZZ F ZZ=2,3,4,10,15 S SDD(ZZ)=$P($P(STR,"^",ZZ),";",2)
"RTN","SDWLEVAL",183,0)
 .N SD S SD=$P(STR,U) D  S Y=SD D D^DIQ S SDD(1)=Y ; date conversion
"RTN","SDWLEVAL",184,0)
 ..I SDD(3)="SCHEDULED/KEPT" S SDD(3)=$S(SD<DT:"KEPT",1:"SCHEDULED")
"RTN","SDWLEVAL",185,0)
 .S SDD(16)=$P(STR,U,16)
"RTN","SDWLEVAL",186,0)
 .N CP,ZZ F ZZ=13,14 S CP(ZZ)=$P($P(STR,U,ZZ),";") D
"RTN","SDWLEVAL",187,0)
 ..S SDD(ZZ)=""
"RTN","SDWLEVAL",188,0)
 ..I CP(ZZ)>0 S SDD(ZZ)=$$GET1^DIQ(40.7,CP(ZZ)_",",.01,"I") ; stop code desc
"RTN","SDWLEVAL",189,0)
 .;DISPLAY
"RTN","SDWLEVAL",190,0)
 .I SCNT=1 D DPH(SCNT,.SDD)
"RTN","SDWLEVAL",191,0)
 .D DPHD(SCNT,.SDD)
"RTN","SDWLEVAL",192,0)
 W !
"RTN","SDWLEVAL",193,0)
 Q
"RTN","SDWLEVAL",194,0)
DATP(SCNT,SDA) ;create data from appt # SCNT to be filed in 409.3 entry
"RTN","SDWLEVAL",195,0)
 ;SDA - called by a reference to be returned to EDIT
"RTN","SDWLEVAL",196,0)
 S STR=^TMP($J,"APPT",SCNT)
"RTN","SDWLEVAL",197,0)
 S SDA(1)=$P(STR,U)
"RTN","SDWLEVAL",198,0)
 N ZZ F ZZ=2,3,10,13,14,15 S SDA(ZZ)=$P($P(STR,"^",ZZ),";",1)
"RTN","SDWLEVAL",199,0)
 S SDA(16)=$P(STR,"^",16) ;station
"RTN","SDWLEVAL",200,0)
 Q
"RTN","SDWLEVAL",201,0)
DPH(SCNT,SDD) ;display appt header
"RTN","SDWLEVAL",202,0)
 W !!,?80-$L("Appointment(s) for: "_SDD(4)_" in Clinic: "_SDD(2)_"on "_SDD(1))\2,"Appointment(s) for: "_SDD(4)_" in Clinic: "_SDD(2) W !!?4,"Specialty: "_SDD(13),?60,"Station: ",SDD(16),!
"RTN","SDWLEVAL",203,0)
 W !?3,"Appt Date/Time",?25,"Status",?42,"Appt Type",?60,"Institution",! N SDL S $P(SDL,"-",79)="" W SDL,!
"RTN","SDWLEVAL",204,0)
 Q
"RTN","SDWLEVAL",205,0)
DPHD(SCNT,SDD) ;
"RTN","SDWLEVAL",206,0)
 W !,SCNT,?3,SDD(1),?25,SDD(3),?42,SDD(10),?60,SDD(15)
"RTN","SDWLEVAL",207,0)
 Q
"RTN","SDWLEVAL",208,0)
END ;QUIT OPTION
"RTN","SDWLEVAL",209,0)
 K DIC,DIR,DR,DIE,SDWLDFN,DUOUT
"RTN","SDWLEVAL",210,0)
 K SDWLCL,SDWSLCN,SDWLDA,SDWLDAPT,SDWLDATA,SDWLDFN,SDWLDISP,SDWLDUZ,SDWLEDT,SDWLERR,SDWLIN,SDWLNAM,SDWLOP,SDWLPRI
"RTN","SDWLEVAL",211,0)
 K SDWLPROV,SDWLPS,SDWLRB,SDWLSC,SDWLSP,SDWLSS,SDWLST,SDWLTY,SDWLY,X,Y,SDWLHDR
"RTN","SDWLEVAL",212,0)
 Q
"RTN","SDWLI")
0^3^B50070111
"RTN","SDWLI",1,0)
SDWLI ;IOFO BAY PINES/TEH - DISPLAY PENDING APPOINTMENTS ; 6/1/05 12:56pm
"RTN","SDWLI",2,0)
 ;;5.3;scheduling;**263,327**;AUG 13 1993
"RTN","SDWLI",3,0)
 ;
"RTN","SDWLI",4,0)
 ;
"RTN","SDWLI",5,0)
 ;******************************************************************
"RTN","SDWLI",6,0)
 ;                             CHANGE LOG
"RTN","SDWLI",7,0)
 ;                                               
"RTN","SDWLI",8,0)
 ;   DATE               PATCH          DESCRIPTION
"RTN","SDWLI",9,0)
 ;   ----             -----             -----------
"RTN","SDWLI",10,0)
 ;   04/22/2005      SD*5.3*327  DISPLAY APPOINTMENT INFORMATION
"RTN","SDWLI",11,0)
 ;   04/22/2005      SD*5.3*327  CORRECT UNDEFINED. HD+1
"RTN","SDWLI",12,0)
 ;
"RTN","SDWLI",13,0)
 ;
"RTN","SDWLI",14,0)
 ;
"RTN","SDWLI",15,0)
EN ;NEW AND INITIALIZE VARIABLES
"RTN","SDWLI",16,0)
 S SDWLERR=0 I $D(SDWLLIST),SDWLLIST D
"RTN","SDWLI",17,0)
 .I '$D(DFN) S SDWLERR=1 Q
"RTN","SDWLI",18,0)
 .I $D(DFN),DFN'="",'$D(^SDWL(409.3,"B",DFN)) D HD W *7,!,"This Patient has NO entries on the Electronic Wait List." S DIR(0)="E" D ^DIR S DUOUT=1 Q
"RTN","SDWLI",19,0)
 I $D(DUOUT) G END
"RTN","SDWLI",20,0)
 I 'SDWLERR,$D(SDWLLIST),SDWLLIST D 1^VADPT,DEM^VADPT S SDWLDFN=DFN D HD K DIR,DIC,DR,DIE,VADM S (SDWLBDT,SDWLEDT)="" K ^TMP("SDWLI",$J) G EN1
"RTN","SDWLI",21,0)
 K DIR,DIC,DR,DIE,VADM
"RTN","SDWLI",22,0)
 S (SDWLBDT,SDWLEDT)="" K ^TMP("SDWLI",$J)
"RTN","SDWLI",23,0)
 ;
"RTN","SDWLI",24,0)
 ;OPTION HEADER
"RTN","SDWLI",25,0)
 ;
"RTN","SDWLI",26,0)
 D HD
"RTN","SDWLI",27,0)
 ;
"RTN","SDWLI",28,0)
 ;PATIENT LOOK-UP FROM WAIT LIST PATIENT FILE (^SDWL(409.3,IEN,0).
"RTN","SDWLI",29,0)
 ;
"RTN","SDWLI",30,0)
 D PAT Q:'$D(SDWLDFN)
"RTN","SDWLI",31,0)
 G END:SDWLDFN<0,END:SDWLDFN=""
"RTN","SDWLI",32,0)
 Q:$D(DUOUT)
"RTN","SDWLI",33,0)
EN1 K DIR,DIC,DR,DIE,SDWLDRG
"RTN","SDWLI",34,0)
 D SEL G EN:$D(DUOUT)
"RTN","SDWLI",35,0)
 D GETFILE
"RTN","SDWLI",36,0)
 D DISP G EN:'$D(DUOUT)
"RTN","SDWLI",37,0)
 D END
"RTN","SDWLI",38,0)
 Q
"RTN","SDWLI",39,0)
PAT ;PATIENT LOOK-UP
"RTN","SDWLI",40,0)
 S DIC(0)="EMNQA",DIC=409.3 D ^DIC S (SDWLDFN,DFN)=$P(Y,U,2)
"RTN","SDWLI",41,0)
 G PATEND:SDWLDFN=""
"RTN","SDWLI",42,0)
 Q:Y<0
"RTN","SDWLI",43,0)
 Q:$D(DUOUT)
"RTN","SDWLI",44,0)
 D 1^VADPT
"RTN","SDWLI",45,0)
PATEND Q
"RTN","SDWLI",46,0)
 ;
"RTN","SDWLI",47,0)
 ;PROMPT FOR DISPLAY 'OPEN' WAITING LIST ONLY OR PROMPT FOR BEGINNING AND ENDING DATES
"RTN","SDWLI",48,0)
 ;
"RTN","SDWLI",49,0)
SEL K SDWLDRG S DIR(0)="YAO^^" S DIR("A")="Do You Want to View Only 'OPEN' Wait Lists? Yes// "
"RTN","SDWLI",50,0)
 S DIR("?")="'Yes' for 'Open' and these Patient Record have not been dispositioned and 'No' for all Records."
"RTN","SDWLI",51,0)
 W ! D ^DIR S SDWLY=Y W !
"RTN","SDWLI",52,0)
 I X["^" S DUOUT=1
"RTN","SDWLI",53,0)
 I SDWLY=0 D SEL1
"RTN","SDWLI",54,0)
 Q
"RTN","SDWLI",55,0)
SEL1 K DIR,%DT(0) S SDWLDISC="",%DT="AE",%DT("A")="Start with Date Entered: " D ^%DT G SEL:Y<1 S SDWLBDT=Y
"RTN","SDWLI",56,0)
 S %DT(0)=SDWLBDT,%DT("A")="End with Date Entered: " D ^%DT G SEL1:Y<1 S SDWLEDT=Y,SDWLDRG="" K %DT(0),%DT("A")
"RTN","SDWLI",57,0)
 Q
"RTN","SDWLI",58,0)
 ;
"RTN","SDWLI",59,0)
GETFILE ;GET DATA - OPTIONAL DATE RANGE IF SDWLDBT AND SDWLEDT VALID DATE RANGE
"RTN","SDWLI",60,0)
 ;
"RTN","SDWLI",61,0)
 K ^TMP("SDWLI",$J),SDWLDISX S SDWLDA=0,SDWLCNT=0 F  S SDWLDA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA)) Q:SDWLDA=""  D
"RTN","SDWLI",62,0)
 .S SDWLDATA=$G(^SDWL(409.3,SDWLDA,0)) I '$D(SDWLDRG),$P(SDWLDATA,U,17)["C" Q
"RTN","SDWLI",63,0)
 .I '$P(SDWLDATA,U,3) Q
"RTN","SDWLI",64,0)
 .N SDWLAPP S SDWLAPP="" I $D(^SDWL(409.3,SDWLDA,"SDAPT")) S SDWLAPP=^("SDAPT") D  ;app data
"RTN","SDWLI",65,0)
 ..S SDWLAPP=SDWLAPP_"~"_$P(SDWLDATA,U,23)
"RTN","SDWLI",66,0)
 .N SDOP,SDOP1 S SDOP="" I $D(^SDWL(409.3,SDWLDA,1)) S SDOP=^(1),SDOP1=$$GET1^DIQ(409.3,SDWLDA_",",29),$P(SDOP,U)=SDOP1
"RTN","SDWLI",67,0)
 .I $D(^SDWL(409.3,SDWLDA,"DIS")) D
"RTN","SDWLI",68,0)
 ..S SDWLDISX=$G(^SDWL(409.3,SDWLDA,"DIS")),SDWLDIS=$P(SDWLDISX,U,3),SDWLDDUZ=$P(SDWLDISX,U,2)
"RTN","SDWLI",69,0)
 ..S SDWLDDT=$P(^SDWL(409.3,SDWLDA,"DIS"),U,1)
"RTN","SDWLI",70,0)
 ..S SDWLDIDT="" I SDWLDDT'="" S SDWLDIDT=$E(SDWLDDT,4,5)_"/"_$E(SDWLDDT,6,7)_"/"_$E(SDWLDDT,2,3)
"RTN","SDWLI",71,0)
 .S SDWLST=$P(SDWLDATA,U,6),SDWLSP=$P(SDWLDATA,U,7),SDWLSS=$P(SDWLDATA,U,8),SDWLSC=$P(SDWLDATA,U,9),SDWLDT=$P(SDWLDATA,U,2)
"RTN","SDWLI",72,0)
 .S SDWLPROV=$P(SDWLDATA,U,13) I $D(SDWLDRG) D  I SDNOK Q
"RTN","SDWLI",73,0)
 ..S SDNOK=0
"RTN","SDWLI",74,0)
 ..I SDWLDT<SDWLBDT!(SDWLDT>SDWLEDT) S SDNOK=1 Q
"RTN","SDWLI",75,0)
 .;
"RTN","SDWLI",76,0)
 .;IF STATUS IS CLOSED DO NOT DISPLAY RECORD
"RTN","SDWLI",77,0)
 .;
"RTN","SDWLI",78,0)
 .S SDWLCNT=SDWLCNT+1,^TMP("SDWLI",$J,SDWLCNT)=SDWLDATA_"~"_SDWLDA I $D(SDWLDISX) D 
"RTN","SDWLI",79,0)
 ..S ^TMP("SDWLI",$J,SDWLCNT,"DIS")=SDWLDIS_"^"_SDWLDDUZ_"^"_SDWLDIDT
"RTN","SDWLI",80,0)
 ..I SDWLAPP>0 S ^TMP("SDWLI",$J,SDWLCNT,"SDAPT")=SDWLAPP
"RTN","SDWLI",81,0)
 ..I SDOP'="" S ^TMP("SDWLI",$J,SDWLCNT,"SDOP")=SDOP
"RTN","SDWLI",82,0)
 .S ^TMP("SDWLI",$J)=SDWLCNT
"RTN","SDWLI",83,0)
 .K SDWLDISX
"RTN","SDWLI",84,0)
 Q
"RTN","SDWLI",85,0)
 ;
"RTN","SDWLI",86,0)
DISP ;Display Wait List Data
"RTN","SDWLI",87,0)
 S (SDWLDT,SDWLCNT,SDWLCN)="",SDWLCT=$G(^TMP("SDWLI",$J)) I 'SDWLCT W !!,"No 'OPEN' Wait List Records to Display.",!! K DIR S DIR(0)="E" D ^DIR S DUOUT="" Q
"RTN","SDWLI",88,0)
 F  S SDWLCNT=$O(^TMP("SDWLI",$J,SDWLCNT)) Q:SDWLCNT=""  D  I $D(DUOUT) Q
"RTN","SDWLI",89,0)
 .I $D(^TMP("SDWLI",$J,SDWLCNT,"DIS")) S SDWLDISX=$G(^TMP("SDWLI",$J,SDWLCNT,"DIS"))
"RTN","SDWLI",90,0)
 .S X=$G(^TMP("SDWLI",$J,SDWLCNT)),SDWLDA=$P(X,"~",2),SDWLIN=$P(X,U,3),SDWLCL=$P(X,U,4),SDWLTY=$P(X,U,5),SDWLPRI=$P(X,U,11)
"RTN","SDWLI",91,0)
 .S SDWLTYP=$S(SDWLTY=1:$P(X,U,6),SDWLTY=2:$P(X,U,7),SDWLTY=3:$P(X,U,8),SDWLTY=4:$P(X,U,9))
"RTN","SDWLI",92,0)
 .S SDWLTYN=$S(SDWLTY=1:5,SDWLTY=2:6,SDWLTY=3:7,SDWLTY=4:8),SDWLCOM=$P($P(X,U,18),"~",1)
"RTN","SDWLI",93,0)
 .S SDWLDUZ=$P(X,U,10),SDWLPRV=$P(X,U,12),SDWLPROV=$P(X,U,13),SDWLX=$P(X,"~",3) D
"RTN","SDWLI",94,0)
 ..I $D(SDWLDISX) S SDWLDIS=$P(SDWLDISX,U,1),SDWLDDUZ=$P(SDWLDISX,U,2),SDWLDIDT=$P(SDWLDISX,U,3)
"RTN","SDWLI",95,0)
 .S SDWLDT=$P(X,U,2),YY=$E(SDWLDT,1,3)+1700,YY=$E(YY,3,4),MM=$E(SDWLDT,4,5),DD=$E(SDWLDT,6,7),SDWLDTP=MM_"/"_DD_"/"_YY
"RTN","SDWLI",96,0)
 .S SDWLDTD=$P(X,U,16),YY=$E(SDWLDTD,1,3)+1700,YY=$E(YY,3,4),MM=$E(SDWLDTD,4,5),DD=$E(SDWLDTD,6,7),SDWLDTD=MM_"/"_DD_"/"_YY
"RTN","SDWLI",97,0)
 .W !,"# ",$J(SDWLCNT,3),!
"RTN","SDWLI",98,0)
 .W !,"Wait List - ",$$EXTERNAL^DILFD(409.3,4,,SDWLTY),?55,"Date Entered - ",SDWLDTP
"RTN","SDWLI",99,0)
 .W !,?15 S X=$$EXTERNAL^DILFD(409.3,SDWLTYN,,SDWLTYP) W X
"RTN","SDWLI",100,0)
 .S SDWLP=0 I SDWLPRI W !,"Priority - ",$$EXTERNAL^DILFD(409.3,19,,SDWLPRI) S SDWLP=1
"RTN","SDWLI",101,0)
 .W:SDWLP ?15 W:'SDWLP ! W "Institution - ",$$EXTERNAL^DILFD(409.3,2,,SDWLIN)
"RTN","SDWLI",102,0)
 .W !,"Entered by - " S X=$$EXTERNAL^DILFD(409.3,9,,SDWLDUZ) W X
"RTN","SDWLI",103,0)
 .S SDWRB=0 I SDWLPRV W !,"Requested By - ",$$EXTERNAL^DILFD(409.3,11,,SDWLPRV),?55,"Date Desired - ",SDWLDTD
"RTN","SDWLI",104,0)
 .I SDWLPRV=1 W !,"Provider - ",$$EXTERNAL^DILFD(409.3,12,,SDWLPROV)
"RTN","SDWLI",105,0)
 .I $D(SDWLCOM),SDWLCOM'="" W !,"Comments - ",SDWLCOM
"RTN","SDWLI",106,0)
 .I $D(^TMP("SDWLI",$J,SDWLCNT,"SDOP")) N SDOP S SDOP=^("SDOP") W !,"Reopen Reason: ",$P(SDOP,U) D
"RTN","SDWLI",107,0)
 ..I $P(SDOP,U,2)'="" W !,"Reopen comment: ",$P(SDOP,U,2)
"RTN","SDWLI",108,0)
 .I $D(SDWLDISX) W !,"Disposition - ",$$EXTERNAL^DILFD(409.3,21,,SDWLDIS),?51,"Disposition Date - ",SDWLDIDT D 
"RTN","SDWLI",109,0)
 ..W !,"Dispositioned by - ",$$EXTERNAL^DILFD(409.3,20,,SDWLDDUZ)
"RTN","SDWLI",110,0)
 .I $D(^TMP("SDWLI",$J,SDWLCNT,"SDAPT")) N SDAP S SDAP=^("SDAPT") D
"RTN","SDWLI",111,0)
 ..W !,"Appointment scheduled for " S Y=$P(SDAP,"~",2) D DD^%DT W Y
"RTN","SDWLI",112,0)
 ..W !?3,"Made on: " S Y=+SDAP D DD^%DT W Y,?30,"For clinic: " N SDC S SDC=$P(SDAP,U,2) S SDC=$$GET1^DIQ(44,SDC_",",.01) W SDC
"RTN","SDWLI",113,0)
 ..N SDAIN S SDAIN=$P(SDAP,U,3),SDAIN=$$GET1^DIQ(4,SDAIN_",",.01)
"RTN","SDWLI",114,0)
 ..W !?3,"Appt Institution: ",SDAIN
"RTN","SDWLI",115,0)
 ..N SDCR S SDCR=$P(SDAP,U,4),SDCR=$$GET1^DIQ(40.7,SDCR_",",.01)
"RTN","SDWLI",116,0)
 ..W ?40,"Appt Specialty: ",SDCR
"RTN","SDWLI",117,0)
 ..N SAPS S SAPS=$P(SDAP,U,8),SAPS=$P(SAPS,"~") I SAPS="CC" W !,"Appointment Status: Canceled by Clinic"
"RTN","SDWLI",118,0)
 .K SDWLIN,SDWLCL,SDWLTY,SDWLPRI,SDWLDUZ,SDWLPRV,SDWLDT,SDWLDTD,SDWLDIS,SDWLDIDT,SDWLTYN,SDWLCOM,SDWLPROV,SDWLDISX,DIR,DIE,DR
"RTN","SDWLI",119,0)
 .W !,"*****",! K DIR S DIR(0)="E" D ^DIR  D
"RTN","SDWLI",120,0)
 ..I X["^" S DUOUT=1 Q
"RTN","SDWLI",121,0)
 ..I 'Y S DUOUT=1 Q
"RTN","SDWLI",122,0)
 ..D HD
"RTN","SDWLI",123,0)
 Q
"RTN","SDWLI",124,0)
HD ;Header
"RTN","SDWLI",125,0)
 W:$D(IOF) @IOF W !!,?80-$L("Wait List - Inquiry")\2,"Wait List - Inquiry ",!
"RTN","SDWLI",126,0)
 ;SD*5.3*327 - Correct undefined.
"RTN","SDWLI",127,0)
 I '$D(SDWLDFN) W !! Q 
"RTN","SDWLI",128,0)
 N DFN S DFN=SDWLDFN D DEM^VADPT
"RTN","SDWLI",129,0)
 W:$D(VADM) !,VADM(1),?40 I $D(VA("PID")) W VA("PID")
"RTN","SDWLI",130,0)
 W !!
"RTN","SDWLI",131,0)
 K DUOUT
"RTN","SDWLI",132,0)
 Q
"RTN","SDWLI",133,0)
END ;
"RTN","SDWLI",134,0)
 K DIR,DIC,DR,DIE,SDWLDFN,DUOUT
"RTN","SDWLI",135,0)
 K SDNOK,SDWLBDT,SDWLCL,SDWLCN,SDWLCNT,SDWLCOM,SDWLCT,SDWLDA,SDWLDATA,SDWLDDT,SDWLDDUZ,SDWLDFN,SDWLDIDT,SDWLDIS,SDWLDISX
"RTN","SDWLI",136,0)
 K SDWLDRG,SDWLDT,SDWLDTD,SDWLDTP,SDWLDUZ,SDLWEDT,SDWLIN,SDLWP,SDWLPRI,SDWLPROV,SDLWPRV,SDWLSC,SDWLSP,SDWLSS,SDLWST,SDWLTY
"RTN","SDWLI",137,0)
 K SDWLTYN,SDSWLTYP,SDLWX,SDWLY,SDWRB,SDWLBDT,SDWLDISC,SDWLERR,SDWLPRON,SDXSCAT,SDWLP,SDWLTYP
"RTN","SDWLI",138,0)
 Q
"RTN","SDWLMSG")
0^2^B26877762
"RTN","SDWLMSG",1,0)
SDWLMSG ;IOFO BAY PINES/DMR - SD EWL BACKGROUND MESSAGES;09/02/2004 2:10 PM [5/12/05 2:58pm]
"RTN","SDWLMSG",2,0)
 ;;5.3;scheduling;**327**;AUG 13, 1993
"RTN","SDWLMSG",3,0)
 ;
"RTN","SDWLMSG",4,0)
 ;Called by SDWLQSC
"RTN","SDWLMSG",5,0)
 ;
"RTN","SDWLMSG",6,0)
MESS2 ;
"RTN","SDWLMSG",7,0)
 S ^TMP("SDWLQSC3",$J,.01)="This message displays any pending appointments in the EWL file which have"
"RTN","SDWLMSG",8,0)
 S ^TMP("SDWLQSC3",$J,.02)="a status of 'CANCELED BY CLINIC', there may be further action required if"
"RTN","SDWLMSG",9,0)
 S ^TMP("SDWLQSC3",$J,.03)="the patient still needs an appointment."
"RTN","SDWLMSG",10,0)
 S ^TMP("SDWLQSC3",$J,.04)=""
"RTN","SDWLMSG",11,0)
 N SDFORM S SDFORM=$$FORM^SDFORM("PATIENT NAME",32,"CLINIC",27,"DATE/TIME of APPT",21) D  ;added
"RTN","SDWLMSG",12,0)
 .S ^TMP("SDWLQSC3",$J,.05)=SDFORM
"RTN","SDWLMSG",13,0)
 S ^TMP("SDWLQSC3",$J,.06)="-------------------------------------------------------------------------------"
"RTN","SDWLMSG",14,0)
 S ^TMP("SDWLQSC3",$J,.07)=""
"RTN","SDWLMSG",15,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",16,0)
 S XMSUB="EWL appointment entries with a status of 'CANCELED BY CLINIC'."
"RTN","SDWLMSG",17,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",18,0)
 S XMTEXT="^TMP(""SDWLQSC3"",$J,"
"RTN","SDWLMSG",19,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",20,0)
 D ^XMD K ^TMP("SDWLQSC3",$J)
"RTN","SDWLMSG",21,0)
 Q
"RTN","SDWLMSG",22,0)
MESS3 ;
"RTN","SDWLMSG",23,0)
 S ^TMP("SDWLQSC4",$J,.01)="This message displays the number of open Wait List entries that are tied to"
"RTN","SDWLMSG",24,0)
 S ^TMP("SDWLQSC4",$J,.02)="an Inactive Clinic. These Wait List entries may require further action,"
"RTN","SDWLMSG",25,0)
 S ^TMP("SDWLQSC4",$J,.03)="please review."
"RTN","SDWLMSG",26,0)
 S ^TMP("SDWLQSC4",$J,.04)=""
"RTN","SDWLMSG",27,0)
 S ^TMP("SDWLQSC4",$J,.05)="CLINIC and NUMBER of WAIT LIST entries"
"RTN","SDWLMSG",28,0)
 S ^TMP("SDWLQSC4",$J,.06)=""
"RTN","SDWLMSG",29,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",30,0)
 S XMSUB="INACTIVE CLINICS with OPEN WAIT LIST entries."
"RTN","SDWLMSG",31,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",32,0)
 S XMTEXT="^TMP(""SDWLQSC4"",$J,"
"RTN","SDWLMSG",33,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",34,0)
 D ^XMD K ^TMP("SDWLQSC4",$J)
"RTN","SDWLMSG",35,0)
 Q
"RTN","SDWLMSG",36,0)
MESS4 ;PCMM Inactivative Team Report
"RTN","SDWLMSG",37,0)
 S ^TMP("SDWLQSC5",$J,.01)="This message displays any PCMM Teams that have been inactivated"
"RTN","SDWLMSG",38,0)
 S ^TMP("SDWLQSC5",$J,.02)="and have patients waiting on the Wait List.  The PCMM Teams"
"RTN","SDWLMSG",39,0)
 S ^TMP("SDWLQSC5",$J,.03)="are displayed along with the number of open Wait List entries."
"RTN","SDWLMSG",40,0)
 S ^TMP("SDWLQSC5",$J,.04)=""
"RTN","SDWLMSG",41,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",42,0)
 S XMSUB="Wait List PCMM Inactive Team Report"
"RTN","SDWLMSG",43,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",44,0)
 S XMTEXT="^TMP(""SDWLQSC5"",$J,"
"RTN","SDWLMSG",45,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",46,0)
 D ^XMD K ^TMP("SDWLQSC5",$J)
"RTN","SDWLMSG",47,0)
 Q
"RTN","SDWLMSG",48,0)
MESS5 ;PCMM Position Inactivation Report
"RTN","SDWLMSG",49,0)
 S ^TMP("SDWLQSC6",$J,.01)="This message displays any PCMM Positions that have been inactivated"
"RTN","SDWLMSG",50,0)
 S ^TMP("SDWLQSC6",$J,.02)="and have patients waiting on the Wait List.  The PCMM Positions"
"RTN","SDWLMSG",51,0)
 S ^TMP("SDWLQSC6",$J,.03)="are displayed along with the number of open Wait List entries."
"RTN","SDWLMSG",52,0)
 S ^TMP("SDWLQSC6",$J,.04)=""
"RTN","SDWLMSG",53,0)
 S ^TMP("SDWLQSC6",$J,.05)="Team Position                  Team                      Open EWL Entries"
"RTN","SDWLMSG",54,0)
 S ^TMP("SDWLQSC6",$J,.06)=""
"RTN","SDWLMSG",55,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",56,0)
 S XMSUB="Wait List PCMM Inactive Position Report"
"RTN","SDWLMSG",57,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",58,0)
 S XMTEXT="^TMP(""SDWLQSC6"",$J,"
"RTN","SDWLMSG",59,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",60,0)
 D ^XMD K ^TMP("SDWLQSC6",$J)
"RTN","SDWLMSG",61,0)
 Q
"RTN","SDWLMSG",62,0)
MESS6 ;Date of Death error message
"RTN","SDWLMSG",63,0)
 S ^TMP("SDWLQSC7",$J,.01)="This message displays any patient on the Wait List who had "
"RTN","SDWLMSG",64,0)
 S ^TMP("SDWLQSC7",$J,.02)="a Date of Death entered in error.  The Wait List entry is"
"RTN","SDWLMSG",65,0)
 S ^TMP("SDWLQSC7",$J,.03)="reopened and may require additional follow-up."
"RTN","SDWLMSG",66,0)
 S ^TMP("SDWLQSC7",$J,.04)=""
"RTN","SDWLMSG",67,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",68,0)
 S XMSUB="Wait List Date of Death Error Report"
"RTN","SDWLMSG",69,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",70,0)
 S XMTEXT="^TMP(""SDWLQSC7"",$J,"
"RTN","SDWLMSG",71,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",72,0)
 D ^XMD K ^TMP("SDWLQSC7",$J)
"RTN","SDWLMSG",73,0)
 Q
"RTN","SDWLMSG",74,0)
MESS7 ;PCMM Team available slots
"RTN","SDWLMSG",75,0)
 S ^TMP("SDWLQSC8",$J,.01)="This message displays any PCMM Teams that have open EWL entries"
"RTN","SDWLMSG",76,0)
 S ^TMP("SDWLQSC8",$J,.02)="waiting - and now have open slots available.  Message displays"
"RTN","SDWLMSG",77,0)
 S ^TMP("SDWLQSC8",$J,.03)="PCMM Team and number of open slots and number of EWL entries waiting"
"RTN","SDWLMSG",78,0)
 S ^TMP("SDWLQSC8",$J,.04)="for that PCMM Team."
"RTN","SDWLMSG",79,0)
 S ^TMP("SDWLQSC8",$J,.05)=""
"RTN","SDWLMSG",80,0)
 S ^TMP("SDWLQSC8",$J,.07)=""
"RTN","SDWLMSG",81,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",82,0)
 S XMSUB="PCMM Team Report of Available Slots"
"RTN","SDWLMSG",83,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",84,0)
 S XMTEXT="^TMP(""SDWLQSC8"",$J,"
"RTN","SDWLMSG",85,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",86,0)
 D ^XMD K ^TMP("SDWLQSC8",$J)
"RTN","SDWLMSG",87,0)
 Q
"RTN","SDWLMSG",88,0)
MESS8 ;PCMM Position available open slots
"RTN","SDWLMSG",89,0)
 S ^TMP("SDWLQSC9",$J,.01)="This message displays any PCMM Positions that have open EWL entries"
"RTN","SDWLMSG",90,0)
 S ^TMP("SDWLQSC9",$J,.02)="waiting - and now have open slots available.  Message displays"
"RTN","SDWLMSG",91,0)
 S ^TMP("SDWLQSC9",$J,.03)="PCMM Position and number of open slots and number of EWL entries waiting"
"RTN","SDWLMSG",92,0)
 S ^TMP("SDWLQSC9",$J,.04)="for that PCMM Position."
"RTN","SDWLMSG",93,0)
 S ^TMP("SDWLQSC9",$J,.05)=""
"RTN","SDWLMSG",94,0)
 S ^TMP("SDWLQSC9",$J,.07)=""
"RTN","SDWLMSG",95,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",96,0)
 S XMSUB="PCMM Positions Report of Available Slots"
"RTN","SDWLMSG",97,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",98,0)
 S XMTEXT="^TMP(""SDWLQSC9"",$J,"
"RTN","SDWLMSG",99,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",100,0)
 D ^XMD K ^TMP("SDWLQSC9",$J)
"RTN","SDWLMSG",101,0)
 Q
"RTN","SDWLPL")
0^13^B29704697
"RTN","SDWLPL",1,0)
SDWLPL ;IOFO BAY PINES/DMR,esw - WAIT LIST PICK LIST ; 6/1/05 1:05pm
"RTN","SDWLPL",2,0)
 ;;5.3;scheduling;**327**;AUG 13, 1993
"RTN","SDWLPL",3,0)
 ;
"RTN","SDWLPL",4,0)
 I '$D(^SDWL(409.3,"B",DFN)) Q
"RTN","SDWLPL",5,0)
 S (ANS1,ANS2,NN)="",DTIME=60
"RTN","SDWLPL",6,0)
 W !,"This patient is currently on the Wait List."
"RTN","SDWLPL",7,0)
 ;
"RTN","SDWLPL",8,0)
ANS1 ;
"RTN","SDWLPL",9,0)
 R !,"Do you want to display open Wait list entries? (Y or N): ",ANS1:DTIME
"RTN","SDWLPL",10,0)
 IF ANS1'="Y"&(ANS1'="N") W !,*7,"ENTER (Y or N) PLEASE!)" G ANS1
"RTN","SDWLPL",11,0)
 Q:ANS1="N"
"RTN","SDWLPL",12,0)
 ;
"RTN","SDWLPL",13,0)
ANS2(DFN,ANS2) ;
"RTN","SDWLPL",14,0)
 N STR S ANS2=" ",STR=",A,S,C,"
"RTN","SDWLPL",15,0)
 F  Q:STR[ANS2!(ANS2="^")  D
"RTN","SDWLPL",16,0)
 .W !!,"Display Open Wait List entries selection:"
"RTN","SDWLPL",17,0)
 .W !?5,"'A' for ALL entries",!?5,"'C' for matching Appointment CLINIC",!?5,"'S' for matching Appointment SPECIALTY",!?5,"'^' to Quit",!
"RTN","SDWLPL",18,0)
 .W "SELECT: " R ANS2:120 Q:'$T
"RTN","SDWLPL",19,0)
 .IF ANS2'="A"&(ANS2'="S")&(ANS2'="C")&(ANS2'="^") W !!,"PLEASE ENTER 'A' for All entries, 'C' for clinic or 'S' for current specialty/stop code or '^' to quit."
"RTN","SDWLPL",20,0)
 Q:ANS2="^"
"RTN","SDWLPL",21,0)
 D INIT(DFN,ANS2) I '$D(^TMP($J,"SDWLPL")) W !!,"No selected open EWL entry has been found!" Q
"RTN","SDWLPL",22,0)
DISPLAY ;
"RTN","SDWLPL",23,0)
 D LIST(ANS2,DFN)
"RTN","SDWLPL",24,0)
 Q
"RTN","SDWLPL",25,0)
 ;
"RTN","SDWLPL",26,0)
INIT(DFN,ANS2) ;
"RTN","SDWLPL",27,0)
 S (INST,SCODE,CLINIC,DENTER,REQBY,DESIRD,SCPRI,IEN,SSN)="" K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDWLPL",28,0)
 F  S IEN=$O(^SDWL(409.3,"B",DFN,IEN)) Q:IEN=""  D
"RTN","SDWLPL",29,0)
 .Q:$$GET1^DIQ(409.3,IEN_",",23,"I")="C"
"RTN","SDWLPL",30,0)
 .S ^TMP("SDWLPL",$J,IEN)=$G(^SDWL(409.3,IEN,0)) S DENTER="",DENTER=$P($G(^TMP("SDWLPL",$J,IEN)),"^",2)
"RTN","SDWLPL",31,0)
 .S (WLTYPE,TYPE,WLTN,NUM)="",TYPE=$P($G(^TMP("SDWLPL",$J,IEN)),"^",5)
"RTN","SDWLPL",32,0)
 .IF DENTER'=""&(TYPE'="") D
"RTN","SDWLPL",33,0)
 ..IF ANS2="A" D ARAY1
"RTN","SDWLPL",34,0)
 ..IF ANS2="S" D ARAY2
"RTN","SDWLPL",35,0)
 ..IF ANS2="C" D ARAY3
"RTN","SDWLPL",36,0)
 ;
"RTN","SDWLPL",37,0)
 K ANS1,NN,INST,SCODE,CLINIC,DENTER,REQBY,DESIRD,SCPRI
"RTN","SDWLPL",38,0)
 K CLINIC,WLTYPE,TYPE,WLTN,NUM,REC
"RTN","SDWLPL",39,0)
 Q
"RTN","SDWLPL",40,0)
 ;
"RTN","SDWLPL",41,0)
ARAY1 ;
"RTN","SDWLPL",42,0)
 IF TYPE=1 S WLTYPE="PCMM TEAM",NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",6),WLTNI=$$GET1^DIQ(404.51,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(404.51,NUM_",",.01)
"RTN","SDWLPL",43,0)
 IF TYPE=2 S WLTYPE="PCMM POSITION",NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",7),WLTNI=$$GET1^DIQ(404.57,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(404.57,NUM_",",.01)
"RTN","SDWLPL",44,0)
 IF TYPE=3 S WLTYPE="SERV/SPECIALTY",NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",8),WLTNI=$$GET1^DIQ(409.31,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(409.31,NUM_",",.01)
"RTN","SDWLPL",45,0)
 IF TYPE=4 S WLTYPE="CLINIC",NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",9),WLTNI=$$GET1^DIQ(409.32,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(409.32,NUM_",",.01)
"RTN","SDWLPL",46,0)
 D SAVE(TYPE,WLTNI,IEN)
"RTN","SDWLPL",47,0)
 Q
"RTN","SDWLPL",48,0)
 ;
"RTN","SDWLPL",49,0)
ARAY2 ;
"RTN","SDWLPL",50,0)
 IF TYPE=3 D
"RTN","SDWLPL",51,0)
 .S SCODE=+$P($G(^TMP($J,"APPT",1)),U,13),NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",8),WLTNI=$$GET1^DIQ(409.31,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(409.31,NUM_",",.01)
"RTN","SDWLPL",52,0)
 .Q:SCODE'=WLTNI
"RTN","SDWLPL",53,0)
 .S WLTYPE="SERV/SPECIAL"
"RTN","SDWLPL",54,0)
 .D SAVE(TYPE,WLTNI,IEN)
"RTN","SDWLPL",55,0)
 Q
"RTN","SDWLPL",56,0)
 ;
"RTN","SDWLPL",57,0)
ARAY3 ;
"RTN","SDWLPL",58,0)
 IF TYPE=4 D
"RTN","SDWLPL",59,0)
 .S CLINIC=+$P($G(^TMP($J,"APPT",1)),U,2),NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",9),WLTNI=$$GET1^DIQ(409.32,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(409.32,NUM_",",.01)
"RTN","SDWLPL",60,0)
 .Q:CLINIC'=WLTNI
"RTN","SDWLPL",61,0)
 .S WLTYPE="CLINIC"
"RTN","SDWLPL",62,0)
 .D SAVE(TYPE,WLTNI,IEN)
"RTN","SDWLPL",63,0)
 Q
"RTN","SDWLPL",64,0)
 ;
"RTN","SDWLPL",65,0)
SAVE(TYPE,WLTNI,IEN) ;
"RTN","SDWLPL",66,0)
 S REQBY=$P($G(^TMP("SDWLPL",$J,IEN)),"^",12)
"RTN","SDWLPL",67,0)
 S INST=$P($G(^TMP("SDWLPL",$J,IEN)),"^",3)
"RTN","SDWLPL",68,0)
 N DESIRED S DESIRED=$P($G(^TMP("SDWLPL",$J,IEN)),"^",16)
"RTN","SDWLPL",69,0)
 ;S SCPRI=$E($$GET1^DIQ(409.3,IEN_",",15)) ;SC priority
"RTN","SDWLPL",70,0)
 ;S SCPRI="" ;future SC
"RTN","SDWLPL",71,0)
 N NAME,SSN S NAME=$$GET1^DIQ(2,DFN_",",.01),SSN=$$GET1^DIQ(2,DFN_",",.09)
"RTN","SDWLPL",72,0)
 N SDBY S SDBY=$$GET1^DIQ(409.3,IEN_",",11),SDBY=$E(SDBY,1,3)
"RTN","SDWLPL",73,0)
 S NN=$O(^TMP($J,"SDWLPL",""),-1)+1
"RTN","SDWLPL",74,0)
 S ^TMP($J,"SDWLPL",NN)=IEN_U_WLTYPE_U_U_WLTN_U_INST_U_DENTER_U_SDBY_U_DESIRED
"RTN","SDWLPL",75,0)
 ;
"RTN","SDWLPL",76,0)
 N SPIEC S SPIEC=$S(TYPE=4:9,TYPE=3:10,TYPE=2:11,TYPE=1:12)
"RTN","SDWLPL",77,0)
 S $P(^TMP($J,"SDWLPL",NN),U,SPIEC)=WLTNI
"RTN","SDWLPL",78,0)
 K ^TMP("SDWLPL",$J,IEN)
"RTN","SDWLPL",79,0)
 Q
"RTN","SDWLPL",80,0)
 ;
"RTN","SDWLPL",81,0)
LIST(ANS2,DFN) ;
"RTN","SDWLPL",82,0)
 W:$D(IOF) @IOF
"RTN","SDWLPL",83,0)
 D APPTD^SDWLEVAL ;display appointment(s) again
"RTN","SDWLPL",84,0)
 W !,"=========================================================================="
"RTN","SDWLPL",85,0)
 N NAME,SSN S NAME=$$GET1^DIQ(2,DFN_",",.01),SSN=$$GET1^DIQ(2,DFN_",",.09)
"RTN","SDWLPL",86,0)
 W !!,$S(ANS2="A":" All",ANS2="C":" Clinic matched",ANS2="S":" Specialty matched",1:" All") W " Open Wait List Entries for: ",NAME_"  "_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","SDWLPL",87,0)
 W !,"------------------------------" I ANS2'="A" W "-----------"
"RTN","SDWLPL",88,0)
 W !,"  EW List Type   P  Waiting for Institution  Orig Date   By  Des. Date Reopen"
"RTN","SDWLPL",89,0)
 W !,"--------------------------------------------------------------------------"
"RTN","SDWLPL",90,0)
 S (REC,NUM)=""
"RTN","SDWLPL",91,0)
 F  S NUM=$O(^TMP($J,"SDWLPL",NUM)) Q:NUM=""  S REC=^TMP($J,"SDWLPL",NUM) D
"RTN","SDWLPL",92,0)
 .;I $P(REC,U,3)="" S $P(REC,U,3)="N"
"RTN","SDWLPL",93,0)
 .S IEN=+REC N SDP,SDR D
"RTN","SDWLPL",94,0)
 ..S SDP=$E($$GET1^DIQ(409.3,IEN_",",10)) ;priority
"RTN","SDWLPL",95,0)
 ..S SDR=$$GET1^DIQ(409.3,IEN_",",29,"I") ;reopen reason
"RTN","SDWLPL",96,0)
 .N SDINS,SDIN S SDINS=$P(REC,"^",5) S SDIN=$$GET1^DIQ(4,SDINS_",",.01,"I")
"RTN","SDWLPL",97,0)
 .W !,NUM_". ",$E($P(REC,"^",2),1,12),?17,SDP,?21,$E($P(REC,U,4),1,13),?35,SDIN,?45,$$FMTE^XLFDT($P(REC,"^",6),8),?57,$P(REC,"^",7),?61,$$FMTE^XLFDT($P(REC,"^",8),8),?76,SDR
"RTN","SDWLPL",98,0)
 .N SDUP,SDLO
"RTN","SDWLPL",99,0)
 .S SDUP="ABCDEFGHIJKLMNOPRSTUWQXYzv",SDLO="abcdefghijklmnoprstuwqxyzv"
"RTN","SDWLPL",100,0)
 .N SMT S SMT=$$GET1^DIQ(409.3,IEN_",",25) I SMT'="" S SMT=$TR(SMT,SDUP,SDLO) W !?2,"Comment: ",SMT
"RTN","SDWLPL",101,0)
 .N SMO S SMO=$$GET1^DIQ(409.3,IEN_",",30) I SMO'="" S SMO=$TR(SMO,SDUP,SDLO) W !?2,"Reopen: ",SMO
"RTN","SDWLPL",102,0)
 Q
"RTN","SDWLQSC")
0^1^B46613371
"RTN","SDWLQSC",1,0)
SDWLQSC        ;IOFO BAY PINES/TEH,DMR - WAITING LIST BACKGROUND JOB;09/02/2004 2:10 PM [4/21/05 8:04pm]
"RTN","SDWLQSC",2,0)
 ;;5.3;scheduling;**327**;AUG 13, 1993
"RTN","SDWLQSC",3,0)
 ;
"RTN","SDWLQSC",4,0)
 ;SD*5.3*327       EWL Updates Phase II - Addition of EWL notification messages.
"RTN","SDWLQSC",5,0)
 ;               
"RTN","SDWLQSC",6,0)
 ;This routine will run as a nightly background job to determine changes
"RTN","SDWLQSC",7,0)
 ;in SD WAIT LIST types (pcmm,clinics,specialty).  A mailman message is sent
"RTN","SDWLQSC",8,0)
 ;to mail group SD EWL BACKGROUND UPDATE.
"RTN","SDWLQSC",9,0)
 ;         
"RTN","SDWLQSC",10,0)
 Q
"RTN","SDWLQSC",11,0)
EN2 ;Part 2 - checks status of appts linked to closed EWL entries.
"RTN","SDWLQSC",12,0)
 S (IEN,DFN,APPT,WLAPPT,CLINIC,SDAPPT,WLSTAT,STATUS,NN,SDFORM)=""
"RTN","SDWLQSC",13,0)
 F  S DFN=$O(^SDWL(409.3,"B",DFN)) Q:DFN<1  D
"RTN","SDWLQSC",14,0)
 .S IEN="" F  S IEN=$O(^SDWL(409.3,"B",DFN,IEN)) Q:IEN<1  D
"RTN","SDWLQSC",15,0)
 ..S STATUS="" S STATUS=$$GET1^DIQ(409.3,IEN_",",23,"I") IF STATUS="C" D
"RTN","SDWLQSC",16,0)
 ...IF $G(^SDWL(409.3,IEN,"SDAPT")) D
"RTN","SDWLQSC",17,0)
 ....S CLINIC=$$GET1^DIQ(409.3,IEN_",",13.2,"I") IF CLINIC>0 D
"RTN","SDWLQSC",18,0)
 .....S WLAPPT=$$GET1^DIQ(409.3,IEN_",",13,"I"),WLSTAT=$$GET1^DIQ(409.3,IEN_",",21,"I") IF WLSTAT="SA" D APPT(CLINIC,IEN)
"RTN","SDWLQSC",19,0)
 IF $D(^TMP("SDWLQSC3",$J)) D MESS2^SDWLMSG
"RTN","SDWLQSC",20,0)
 D EN3
"RTN","SDWLQSC",21,0)
 K IEN,DFN,APPT,WLAPPT,STOP,WLSTAT,STATUS,NN,SDREC,SDARRAY,SDAPPT,CL,CLINIC,SDC,SDDFN,SDNAME,SDAPPST,CIEN,SDWL
"RTN","SDWLQSC",22,0)
 K SDCL,SDIEN,CC,SDREACT,SDINACT,CLINICS,TEAM,TEAMN,WLOPEN,PIEN,POS,POSN,SDWLPOS,EDATE,DOD,DIS,NAME,MAX,AVAL,SDFORM
"RTN","SDWLQSC",23,0)
 K REC,SDNAM,TEAMC,TIEN
"RTN","SDWLQSC",24,0)
 Q
"RTN","SDWLQSC",25,0)
APPT(CLINIC,IEN) ;
"RTN","SDWLQSC",26,0)
 S (SDREC,SDARRAY)=""
"RTN","SDWLQSC",27,0)
 S SDARRAY(1)=WLAPPT_";"_WLAPPT
"RTN","SDWLQSC",28,0)
 S SDARRAY(4)=DFN
"RTN","SDWLQSC",29,0)
 S SDARRAY("FLDS")="3;2;4;1"
"RTN","SDWLQSC",30,0)
 S SDREC=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SDWLQSC",31,0)
 IF SDREC>0 D
"RTN","SDWLQSC",32,0)
 .S (CL,SDC,SDDFN,SDNAM,SDAPPT,SDAPPST,NN)=""
"RTN","SDWLQSC",33,0)
 .S CL=$O(^TMP($J,"SDAMA301",DFN,"")) Q:CL=""  ;Current Clinic
"RTN","SDWLQSC",34,0)
 .S SDAPPST=$P($G(^TMP($J,"SDAMA301",DFN,CL,WLAPPT)),"^",3),SDAPPST=$P(SDAPPST,";")  ;Appt Status
"RTN","SDWLQSC",35,0)
 .I CL'=CLINIC!(SDAPPST="CC") D
"RTN","SDWLQSC",36,0)
 ..S SDDFN=$P($G(^TMP($J,"SDAMA301",DFN,CL,WLAPPT)),"^",4) IF SDDFN'="" S SDNAM=$P($G(SDDFN),";",2),SDNAM=$E(SDNAM,1,30)
"RTN","SDWLQSC",37,0)
 ..S SDC=$P($G(^TMP($J,"SDAMA301",DFN,CL,WLAPPT)),"^",2)
"RTN","SDWLQSC",38,0)
 ..S SDC=$$GET1^DIQ(44,CL_",",.01),SDC=$E(SDC,1,25)
"RTN","SDWLQSC",39,0)
 ..S Y=WLAPPT D DD^%DT S SDAPPT=Y
"RTN","SDWLQSC",40,0)
 ..IF CL'=CLINIC S SDC=SDC_"(new)"  ;to distinguish another clinic"
"RTN","SDWLQSC",41,0)
 ..S SDFORM=$$FORM^SDFORM(SDNAM,32,SDC,27,SDAPPT,21)
"RTN","SDWLQSC",42,0)
 ..S NN=NN+1,^TMP("SDWLQSC3",$J,NN)=SDFORM
"RTN","SDWLQSC",43,0)
 ..N DIE,DA,DR
"RTN","SDWLQSC",44,0)
 ..S DIE="^SDWL(409.3,",DA=IEN,DR="23////^S X=""O""" D ^DIE
"RTN","SDWLQSC",45,0)
 ..S DR="13.8////^S X=""CC""" D ^DIE
"RTN","SDWLQSC",46,0)
 ..S DR="29////^S X=""CA""" D ^DIE
"RTN","SDWLQSC",47,0)
 ..S DR="19///@" D ^DIE
"RTN","SDWLQSC",48,0)
 ..S DR="20///@" D ^DIE
"RTN","SDWLQSC",49,0)
 ..S DR="21///@" D ^DIE
"RTN","SDWLQSC",50,0)
 Q
"RTN","SDWLQSC",51,0)
EN3 ;Inactive clinics
"RTN","SDWLQSC",52,0)
 S (CIEN,IEN,APPT,DFN,WLSTAT,SDCL,SDIEN,CC,SDREACT,SDINACT,CLINICS,SDFORM)=""
"RTN","SDWLQSC",53,0)
 F  S CIEN=$O(^SDWL(409.3,"SC",CIEN)) Q:CIEN<1  S CC=0 D
"RTN","SDWLQSC",54,0)
 .S SDINACT=$$GET1^DIQ(44,CIEN_",",2505,"I"),SDREACT=$$GET1^DIQ(44,CIEN_",",2506,"I")
"RTN","SDWLQSC",55,0)
 .Q:SDINACT=""&(SDREACT="")  D 
"RTN","SDWLQSC",56,0)
 ..S IEN="" F  S IEN=$O(^SDWL(409.3,"SC",CIEN,IEN)) Q:IEN<1  S WLSTAT=$$GET1^DIQ(409.3,IEN_",",23,"I") D
"RTN","SDWLQSC",57,0)
 ...Q:WLSTAT'="O"
"RTN","SDWLQSC",58,0)
 ...Q:SDINACT<SDREACT&((SDREACT+.01)>DT)
"RTN","SDWLQSC",59,0)
 ...Q:SDINACT<DT&(SDREACT>SDINACT)
"RTN","SDWLQSC",60,0)
 ...Q:SDINACT>(DT+.01)
"RTN","SDWLQSC",61,0)
 ...S CC=CC+1
"RTN","SDWLQSC",62,0)
 .IF CC>0 D
"RTN","SDWLQSC",63,0)
 ..S CLINIC=$$GET1^DIQ(44,CIEN_",",.01),CLINIC=$E(CLINIC,1,30)
"RTN","SDWLQSC",64,0)
 ..S SDFORM=$$FORM^SDFORM(CLINIC,40,CC,20),^TMP("SDWLQSC4",$J,CIEN)=SDFORM
"RTN","SDWLQSC",65,0)
 ..S REC="",REC=$O(^SDWL(409.32,"B",CIEN,REC),-1)
"RTN","SDWLQSC",66,0)
 ..IF REC'="" D
"RTN","SDWLQSC",67,0)
 ...S SDINACT=$$GET1^DIQ(44,CIEN_",",2505,"I")
"RTN","SDWLQSC",68,0)
 ...S DIE="^SDWL(409.32,",DA=REC,DR="3////^S X=SDINACT" D ^DIE
"RTN","SDWLQSC",69,0)
 ...S DR="4////^S X=.5" D ^DIE
"RTN","SDWLQSC",70,0)
 IF $D(^TMP("SDWLQSC4",$J)) D MESS3^SDWLMSG
"RTN","SDWLQSC",71,0)
 D EN4
"RTN","SDWLQSC",72,0)
 Q
"RTN","SDWLQSC",73,0)
EN4 ;PCMM Team inactivated
"RTN","SDWLQSC",74,0)
 S (IEN,TIEN,TEAM,TEAMN,DFN,CC,STATUS,WLOPEN,SDFORM)="" S CC="0"
"RTN","SDWLQSC",75,0)
 F  S TEAM=$O(^SDWL(409.3,"D",TEAM)) Q:TEAM<1  S CC=0 D
"RTN","SDWLQSC",76,0)
 .S IEN="" F  S IEN=$O(^SDWL(409.3,"D",TEAM,IEN)) Q:IEN<1  S WLOPEN=$$GET1^DIQ(409.3,IEN_",",23,"I") D
"RTN","SDWLQSC",77,0)
 ..Q:WLOPEN="C"  S TIEN="",TIEN=$O(^SCTM(404.58,"B",TEAM,TIEN),-1) IF TIEN'="" D
"RTN","SDWLQSC",78,0)
 ...S STATUS=$$GET1^DIQ(404.58,TIEN_",",.03,"I")
"RTN","SDWLQSC",79,0)
 ...Q:STATUS="1"
"RTN","SDWLQSC",80,0)
 ...IF STATUS="0" S CC=CC+1
"RTN","SDWLQSC",81,0)
 .IF CC>0 D 
"RTN","SDWLQSC",82,0)
 ..S TEAMN=$$GET1^DIQ(404.51,TEAM_",",.01) S TEAMN=$E(TEAMN,1,30)
"RTN","SDWLQSC",83,0)
 ..S SDFORM=$$FORM^SDFORM(TEAMN,40,CC,20),^TMP("SDWLQSC5",$J,TEAM)=SDFORM
"RTN","SDWLQSC",84,0)
 IF $D(^TMP("SDWLQSC5",$J)) D MESS4^SDWLMSG
"RTN","SDWLQSC",85,0)
 D EN5
"RTN","SDWLQSC",86,0)
 Q
"RTN","SDWLQSC",87,0)
EN5 ;PCMM Position inactivated
"RTN","SDWLQSC",88,0)
 S (IEN,PIEN,POS,POSN,STATUS,WLOPEN,SDWLPOS,SDFORM,TEAM)=""
"RTN","SDWLQSC",89,0)
 S SDWLPOS="" F  S IEN=$O(^SDWL(409.3,"SP",IEN)) Q:IEN<1  D
"RTN","SDWLQSC",90,0)
 .S POS="" F  S POS=$O(^SDWL(409.3,"SP",IEN,POS)) Q:POS<1  D
"RTN","SDWLQSC",91,0)
 ..S WLOPEN=$$GET1^DIQ(409.3,IEN_",",23,"I")
"RTN","SDWLQSC",92,0)
 ..Q:WLOPEN="C"
"RTN","SDWLQSC",93,0)
 ..S PIEN="",PIEN=$O(^SCTM(404.59,"B",POS,PIEN),-1) IF PIEN'="" D
"RTN","SDWLQSC",94,0)
 ... S POSN=$$GET1^DIQ(404.57,POS_",",.01)
"RTN","SDWLQSC",95,0)
 ...IF PIEN'="" S STATUS=$$GET1^DIQ(404.59,PIEN_",",.03,"I")
"RTN","SDWLQSC",96,0)
 ...Q:STATUS="1"
"RTN","SDWLQSC",97,0)
 ...IF STATUS="0" D
"RTN","SDWLQSC",98,0)
 ....S:'$D(SDWLPOS(POS)) SDWLPOS(POS)=0 S SDWLPOS(POS)=SDWLPOS(POS)+1,POSN=$E(POSN,1,30)
"RTN","SDWLQSC",99,0)
 ....S TEAM=$$GET1^DIQ(404.57,POS_",",.02),TEAM=$E(TEAM,1,25)
"RTN","SDWLQSC",100,0)
 ....S SDFORM=$$FORM^SDFORM(POSN,32,TEAM,27,SDWLPOS(POS),21)
"RTN","SDWLQSC",101,0)
 ....S ^TMP("SDWLQSC6",$J,POS)=SDFORM
"RTN","SDWLQSC",102,0)
 IF $D(^TMP("SDWLQSC6",$J)) D MESS5^SDWLMSG
"RTN","SDWLQSC",103,0)
 D EN6
"RTN","SDWLQSC",104,0)
 Q
"RTN","SDWLQSC",105,0)
EN6 ;Date of Death
"RTN","SDWLQSC",106,0)
 S (IEN,SDDFN,DIS,DOD,NAME)=""
"RTN","SDWLQSC",107,0)
 F  S SDDFN=$O(^SDWL(409.3,"B",SDDFN)) Q:SDDFN<1  D
"RTN","SDWLQSC",108,0)
 .S IEN="" F  S IEN=$O(^SDWL(409.3,"B",SDDFN,IEN)) Q:IEN<1  D
"RTN","SDWLQSC",109,0)
 ..S DIS=$$GET1^DIQ(409.3,IEN_",",21,"I") IF DIS="D" D
"RTN","SDWLQSC",110,0)
 ...S DOD=$$GET1^DIQ(2,SDDFN_",",.351) Q:DOD'=""  D
"RTN","SDWLQSC",111,0)
 ....N DIE,DR,DA
"RTN","SDWLQSC",112,0)
 ....S DIE="^SDWL(409.3,",DA=IEN,DR="23////^S X=""O""" D ^DIE
"RTN","SDWLQSC",113,0)
 ....S DR="19///@" D ^DIE
"RTN","SDWLQSC",114,0)
 ....S DR="20///@" D ^DIE
"RTN","SDWLQSC",115,0)
 ....S DR="21///@" D ^DIE
"RTN","SDWLQSC",116,0)
 ....S DR="29////^S X=""DE""" D ^DIE
"RTN","SDWLQSC",117,0)
 ....S NAME=$$GET1^DIQ(2,SDDFN_",",.01) S ^TMP("SDWLQSC7",$J,SDDFN)=NAME
"RTN","SDWLQSC",118,0)
 IF $D(^TMP("SDWLQSC7",$J)) D MESS6^SDWLMSG
"RTN","SDWLQSC",119,0)
 D EN7
"RTN","SDWLQSC",120,0)
 Q
"RTN","SDWLQSC",121,0)
EN7 ;PCMM Team open slots
"RTN","SDWLQSC",122,0)
 S (IEN,TIEN,TEAMN,CC,WLOPEN,MAX,AVAL,SDFORM,TEAM,STATUS)=""
"RTN","SDWLQSC",123,0)
 F  S TEAM=$O(^SDWL(409.3,"D",TEAM)) Q:TEAM<1  S CC=0 D
"RTN","SDWLQSC",124,0)
 .S IEN="" F  S IEN=$O(^SDWL(409.3,"D",TEAM,IEN)) Q:IEN<1  S WLOPEN=$$GET1^DIQ(409.3,IEN_",",23,"I") D
"RTN","SDWLQSC",125,0)
 ..Q:WLOPEN="C"  S CC=CC+1
"RTN","SDWLQSC",126,0)
 .IF CC>0 D
"RTN","SDWLQSC",127,0)
 ..S TIEN="",TIEN=$O(^SCTM(404.58,"B",TEAM,TIEN),-1) IF TIEN'="" D
"RTN","SDWLQSC",128,0)
 ...S STATUS=$$GET1^DIQ(404.58,TIEN_",",.03,"I")
"RTN","SDWLQSC",129,0)
 ...Q:STATUS="0"
"RTN","SDWLQSC",130,0)
 ...S MAX=$$GET1^DIQ(404.51,TEAM_",",.08)
"RTN","SDWLQSC",131,0)
 ...S TEAMC=$$TEAMCNT^SCAPMCU1(TEAM,DT)
"RTN","SDWLQSC",132,0)
 ...Q:(TEAMC+.01)>MAX  S AVAL=MAX-TEAMC,TEAMN=$$GET1^DIQ(404.51,TEAM_",",.01)
"RTN","SDWLQSC",133,0)
 ...S TEAMN=$E(TEAMN,1,30),SDFORM=$$FORM^SDFORM(TEAMN,35,AVAL,22,CC,12)
"RTN","SDWLQSC",134,0)
 ...S ^TMP("SDWLQSC8",$J,TIEN)=SDFORM
"RTN","SDWLQSC",135,0)
 ...Q
"RTN","SDWLQSC",136,0)
 IF $D(^TMP("SDWLQSC8",$J)) D
"RTN","SDWLQSC",137,0)
 .S SDFORM=$$FORM^SDFORM("TEAM",35,"SLOTS AVAILIABLE",22,"EWL ENTRIES",12)
"RTN","SDWLQSC",138,0)
 .S ^TMP("SDWLQSC8",$J,.06)=SDFORM
"RTN","SDWLQSC",139,0)
 .D MESS7^SDWLMSG
"RTN","SDWLQSC",140,0)
 D EN8
"RTN","SDWLQSC",141,0)
 Q
"RTN","SDWLQSC",142,0)
EN8 ;PCMM Position open slots
"RTN","SDWLQSC",143,0)
 S (IEN,PIEN,POS,POSN,STATUS,WLOPEN,EDATE,SDWLPOS,SDWL,SDFORM)="" K SDWLPOS
"RTN","SDWLQSC",144,0)
 S SDWLPOS="" F  S IEN=$O(^SDWL(409.3,"SP",IEN)) Q:IEN<1  D
"RTN","SDWLQSC",145,0)
 .S POS="" F  S POS=$O(^SDWL(409.3,"SP",IEN,POS)) Q:POS<1  D
"RTN","SDWLQSC",146,0)
 ..S PIEN="",PIEN=$O(^SCTM(404.59,"B",POS,PIEN),-1) IF PIEN'="" D
"RTN","SDWLQSC",147,0)
 ...S STATUS=$$GET1^DIQ(404.59,PIEN_",",.03,"I")
"RTN","SDWLQSC",148,0)
 ...S WLOPEN=$$GET1^DIQ(409.3,IEN_",",23,"I"),EDATE=$$GET1^DIQ(404.59,PIEN_",",.02,"I")
"RTN","SDWLQSC",149,0)
 ...Q:WLOPEN="C"
"RTN","SDWLQSC",150,0)
 ...Q:((EDATE+.01)<DT&(STATUS="0"))
"RTN","SDWLQSC",151,0)
 ...S:'$D(SDWLPOS(POS)) SDWLPOS(POS)=0 S SDWLPOS(POS)=SDWLPOS(POS)+1
"RTN","SDWLQSC",152,0)
 ...Q
"RTN","SDWLQSC",153,0)
 S (IEN,POS,POSN,MAX,AVAL,CC,TEAM)=""
"RTN","SDWLQSC",154,0)
 F  S POS=$O(SDWLPOS(POS)) Q:POS<1  D
"RTN","SDWLQSC",155,0)
 .S MAX=$$GET1^DIQ(404.57,POS_",",.08),SDWL=$$PCPOSCNT^SCAPMCU1(POS,DT)
"RTN","SDWLQSC",156,0)
 .Q:(SDWL+.01)>MAX
"RTN","SDWLQSC",157,0)
 .S TEAM=$$GET1^DIQ(404.57,POS_",",.02),TEAM=$E(TEAM,1,23)
"RTN","SDWLQSC",158,0)
 .S AVAL=MAX-SDWL,POSN=$$GET1^DIQ(404.57,POS_",",.01)
"RTN","SDWLQSC",159,0)
 .S POSN=$E(POSN,1,23),SDFORM=$$FORM^SDFORM(POSN,25,TEAM,25,AVAL,14,SDWLPOS(POS),11)
"RTN","SDWLQSC",160,0)
 .S ^TMP("SDWLQSC9",$J,POS)=SDFORM
"RTN","SDWLQSC",161,0)
 IF $D(^TMP("SDWLQSC9",$J)) D
"RTN","SDWLQSC",162,0)
 .S SDFORM=$$FORM^SDFORM("POSITION",25,"TEAM",25,"SLOTS AVAIL",14,"EWL ENTRIES",11)
"RTN","SDWLQSC",163,0)
 .S ^TMP("SDWLQSC9",$J,.06)=SDFORM
"RTN","SDWLQSC",164,0)
 .D MESS8^SDWLMSG
"RTN","SDWLQSC",165,0)
 Q
"RTN","SDWLR")
1^5
"VER")
8.0^22.0
"^DD",409.3,409.3,0)
FIELD^^30^41
"^DD",409.3,409.3,0,"DDA")
N
"^DD",409.3,409.3,0,"DT")
3050505
"^DD",409.3,409.3,0,"ID",1)
W ""
"^DD",409.3,409.3,0,"ID",2)
S %I=Y,Y=$S('$D(^(0)):"",$D(^DIC(4,+$P(^(0),U,3),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(4,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",409.3,409.3,0,"ID",4)
W "   ",@("$P($P($C(59)_$S($D(^DD(409.3,4,0)):$P(^(0),U,3),1:0)_$E("_DIC_"Y,0),0),$C(59)_$P(^(0),U,5)_"":"",2),$C(59),1)")
"^DD",409.3,409.3,0,"ID",23)
W "   ",@("$P($P($C(59)_$S($D(^DD(409.3,23,0)):$P(^(0),U,3),1:0)_$E("_DIC_"Y,0),0),$C(59)_$P(^(0),U,17)_"":"",2),$C(59),1)")
"^DD",409.3,409.3,0,"IX","B",409.3,.01)

"^DD",409.3,409.3,0,"IX","C",409.3,2)

"^DD",409.3,409.3,0,"IX","D",409.3,5)

"^DD",409.3,409.3,0,"IX","SC",409.3,8)

"^DD",409.3,409.3,0,"IX","SCC",409.3,8)

"^DD",409.3,409.3,0,"IX","SP",409.3,6)

"^DD",409.3,409.3,0,"IX","SS",409.3,7)

"^DD",409.3,409.3,0,"IX","ST",409.3,5)

"^DD",409.3,409.3,0,"NM","SD WAIT LIST")

"^DD",409.3,409.3,0,"PT",409.35,.01)

"^DD",409.3,409.3,0,"VRPK")
SD
"^DD",409.3,409.3,.01,0)
PATIENT^RP2^DPT(^0;1^Q
"^DD",409.3,409.3,.01,1,0)
^.1^^-1
"^DD",409.3,409.3,.01,1,1,0)
409.3^B
"^DD",409.3,409.3,.01,1,1,1)
S ^SDWL(409.3,"B",$E(X,1,30),DA)=""
"^DD",409.3,409.3,.01,1,1,2)
K ^SDWL(409.3,"B",$E(X,1,30),DA)
"^DD",409.3,409.3,.01,3)
Enter the name of the patient from the Patient file #2 that is to be on the Sch/PCMM Wait List.
"^DD",409.3,409.3,.01,21,0)
^.001^2^2^3050303^^^^
"^DD",409.3,409.3,.01,21,1,0)
Enter the name of the patient from the Patient file #2 that is to be on
"^DD",409.3,409.3,.01,21,2,0)
the Sch/PCMM Wait List.
"^DD",409.3,409.3,.01,"DT")
3021022
"^DD",409.3,409.3,1,0)
ORIGINATING DATE^D^^0;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",409.3,409.3,1,21,0)
^.001^1^1^3020912^^^^
"^DD",409.3,409.3,1,21,1,0)
Date the patient was placed on the Wait List (Sch/PCMM)
"^DD",409.3,409.3,1,"DT")
3020618
"^DD",409.3,409.3,2,0)
INSTITUTION^R*P4'^DIC(4,^0;3^S DIC("S")="I $P(^(0),U,11)=""N"",$$TF^XUAF4(+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",409.3,409.3,2,1,0)
^.1
"^DD",409.3,409.3,2,1,1,0)
409.3^C
"^DD",409.3,409.3,2,1,1,1)
S ^SDWL(409.3,"C",$E(X,1,30),DA)=""
"^DD",409.3,409.3,2,1,1,2)
K ^SDWL(409.3,"C",$E(X,1,30),DA)
"^DD",409.3,409.3,2,1,1,"DT")
3020716
"^DD",409.3,409.3,2,3)
Enter the INSTITUTION that the patient is to be placed for the waiting list.  INSTITUTION must be NATIONAL and a treating facility.
"^DD",409.3,409.3,2,12)
Enter a National/Medical Institution
"^DD",409.3,409.3,2,12.1)
S DIC("S")="I $P(^(0),U,11)=""N"",$$TF^XUAF4(+Y)"
"^DD",409.3,409.3,2,21,0)
^.001^1^1^3030224^^^^
"^DD",409.3,409.3,2,21,1,0)
The Institution the patient is on the Wait List (Sch/PCMM)
"^DD",409.3,409.3,2,"AUDIT")
 
"^DD",409.3,409.3,2,"DT")
3030304
"^DD",409.3,409.3,3,0)
TRANMISSION STATUS TO ACC^S^0:NOT TRANSMITTED;1:TRANSMITTED;^0;4^Q
"^DD",409.3,409.3,3,21,0)
^^2^2^3020913^
"^DD",409.3,409.3,3,21,1,0)
Reflects the current transmission status (transmitted/not transmitted) of 
"^DD",409.3,409.3,3,21,2,0)
the wait list entry
"^DD",409.3,409.3,3,"DT")
3020808
"^DD",409.3,409.3,3.1,0)
DATE OF TRANSMISSION^409.33D^^ACCDATE;0
"^DD",409.3,409.3,3.1,21,0)
^^1^1^3020913^
"^DD",409.3,409.3,3.1,21,1,0)
Wait List Transmission date information - multiple
"^DD",409.3,409.3,4,0)
WAIT LIST TYPE^RSI^1:PCMM TEAM ASSIGNMENT;2:PCMM POSITION ASSIGNMENT;3:SERVICE/SPECIALITY;4:SPECIFIC CLINIC;^0;5^Q
"^DD",409.3,409.3,4,3)
Select one Wait List Type.
"^DD",409.3,409.3,4,21,0)
^.001^1^1^3050426^^^^
"^DD",409.3,409.3,4,21,1,0)
The type of wait list the patient is assigned.
"^DD",409.3,409.3,4,"DT")
3041012
"^DD",409.3,409.3,5,0)
WL SPECIFIC TEAM^*P404.51'^SCTM(404.51,^0;6^S DIC("S")="I $D(SDWLIN),$P(^SCTM(404.51,+Y,0),U,7)=SDWLIN" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",409.3,409.3,5,1,0)
^.1
"^DD",409.3,409.3,5,1,1,0)
409.3^D
"^DD",409.3,409.3,5,1,1,1)
S ^SDWL(409.3,"D",$E(X,1,30),DA)=""
"^DD",409.3,409.3,5,1,1,2)
K ^SDWL(409.3,"D",$E(X,1,30),DA)
"^DD",409.3,409.3,5,1,1,"DT")
3020725
"^DD",409.3,409.3,5,1,2,0)
409.3^ST^MUMPS
"^DD",409.3,409.3,5,1,2,1)
I $D(X) S ^SDWL(409.3,"ST",DA,X)=""
"^DD",409.3,409.3,5,1,2,2)
K ^SDWL(409.3,"ST",DA,X)
"^DD",409.3,409.3,5,1,2,"DT")
3020816
"^DD",409.3,409.3,5,3)
Enter the team that the patient is waiting to be assigned. The team must be an active team at the selected institution and must be over capacity. Only one wait list for a team is allowed.
"^DD",409.3,409.3,5,12)
Entry's for this Institution.
"^DD",409.3,409.3,5,12.1)
S DIC("S")="I $D(SDWLIN),$P(^SCTM(404.51,+Y,0),U,7)=SDWLIN"
"^DD",409.3,409.3,5,21,0)
^.001^5^5^3020918^^^^
"^DD",409.3,409.3,5,21,1,0)
If the patient is waiting for a PCMM Team Assignment,
"^DD",409.3,409.3,5,21,2,0)
the team that the patient is waiting to be assigned is to be entered here.  
"^DD",409.3,409.3,5,21,3,0)
The team must be active at the designated institution, must be above
"^DD",409.3,409.3,5,21,4,0)
capacity.
"^DD",409.3,409.3,5,21,5,0)
The patient can have only ONE open Team Wait List assignment.
"^DD",409.3,409.3,5,"AUDIT")
n
"^DD",409.3,409.3,5,"DT")
3020930
"^DD",409.3,409.3,6,0)
WL SPECIFIC POSITION^P404.57'^SCTM(404.57,^0;7^Q
"^DD",409.3,409.3,6,1,0)
^.1
"^DD",409.3,409.3,6,1,1,0)
409.3^SP^MUMPS
"^DD",409.3,409.3,6,1,1,1)
I $D(X) S ^SDWL(409.3,"SP",DA,X)=""
"^DD",409.3,409.3,6,1,1,2)
K ^SDWL(409.3,"SP",DA,X)
"^DD",409.3,409.3,6,1,1,"DT")
3020816
"^DD",409.3,409.3,6,3)
Enter the position the patient is waiting to be assigned. Only active, over capacity positions assigned to the patient's primary care team are selectable.
"^DD",409.3,409.3,6,21,0)
^.001^5^5^3020913^^^
"^DD",409.3,409.3,6,21,1,0)
If the patient is waiting for a PCMM Position, the position that the
"^DD",409.3,409.3,6,21,2,0)
patient is waiting to be assigned is entered here. The position must be
"^DD",409.3,409.3,6,21,3,0)
active, assigned to the team the patient is currently assigned and the
"^DD",409.3,409.3,6,21,4,0)
position must be above capacity. The patient can have only ONE open
"^DD",409.3,409.3,6,21,5,0)
Position Wait List assignment.
"^DD",409.3,409.3,6,"AUDIT")
n
"^DD",409.3,409.3,6,"DT")
3020930
"^DD",409.3,409.3,7,0)
WL SERVICE/SPECIALTY^P409.31'^SDWL(409.31,^0;8^Q
"^DD",409.3,409.3,7,1,0)
^.1
"^DD",409.3,409.3,7,1,1,0)
409.3^SS^MUMPS
"^DD",409.3,409.3,7,1,1,1)
I $D(X) S ^SDWL(409.3,"SS",$P(^SDWL(409.3,DA,0),U,1),$P(^SDWL(409.31,X,0),U,1),DA)=""
"^DD",409.3,409.3,7,1,1,2)
K ^SDWL(409.3,"SS",$P(^SDWL(409.3,DA,0),U,1),$P(^SDWL(409.31,X,0),U,1),DA)
"^DD",409.3,409.3,7,1,1,"DT")
3020821
"^DD",409.3,409.3,7,3)
Enter the Service/Specialty (DSS ID) allowed by this institution in the wait list parameters, that this patient is waiting for an appointment.
"^DD",409.3,409.3,7,21,0)
^.001^4^4^3020913^^^^
"^DD",409.3,409.3,7,21,1,0)
If the patient has been assigned to the Service/Specialty Wait List,
"^DD",409.3,409.3,7,21,2,0)
enter the DSS ID that represents the service/specialty
"^DD",409.3,409.3,7,21,3,0)
the patient is waiting for an appointment. This DSS ID must be active in
"^DD",409.3,409.3,7,21,4,0)
file 409.31.
"^DD",409.3,409.3,7,"AUDIT")
n
"^DD",409.3,409.3,7,"DT")
3020930
"^DD",409.3,409.3,8,0)
WL SPECIFIC CLINIC^RP409.32'^SDWL(409.32,^0;9^Q
"^DD",409.3,409.3,8,1,0)
^.1
"^DD",409.3,409.3,8,1,1,0)
409.3^SC^MUMPS
"^DD",409.3,409.3,8,1,1,1)
I $D(X) S ^SDWL(409.3,"SC",$P(^SDWL(409.32,X,0),U,1),DA)=""
"^DD",409.3,409.3,8,1,1,2)
K ^SDWL(409.3,"SC",$P(^SDWL(409.32,X,0),U,1),DA)
"^DD",409.3,409.3,8,1,1,"DT")
3020819
"^DD",409.3,409.3,8,1,2,0)
409.3^SCC^MUMPS
"^DD",409.3,409.3,8,1,2,1)
I $D(X) S ^SDWL(409.3,"SCC",$P(^SDWL(409.3,DA,0),U,1),X,DA)=""
"^DD",409.3,409.3,8,1,2,2)
K ^SDWL(409.3,"SCC",$P(^SDWL(409.3,DA,0),U,1),X,DA)
"^DD",409.3,409.3,8,1,2,"DT")
3020828
"^DD",409.3,409.3,8,3)
Select clinic from approved wait list clinics
"^DD",409.3,409.3,8,21,0)
^.001^4^4^3020925^^^
"^DD",409.3,409.3,8,21,1,0)
If the patient has been assigned to the Specific Clinic Wait List,
"^DD",409.3,409.3,8,21,2,0)
enter the clinic that the patient is waiting for an appointment.
"^DD",409.3,409.3,8,21,3,0)
The clinic must be active and must be assigned to the institution
"^DD",409.3,409.3,8,21,4,0)
designated. It must be an active clinic in file 409.32. 
"^DD",409.3,409.3,8,"AUDIT")
n
"^DD",409.3,409.3,8,"DT")
3020930
"^DD",409.3,409.3,9,0)
ORIGINATING USER^P200'^VA(200,^0;10^Q
"^DD",409.3,409.3,9,21,0)
^.001^1^1^3020626^^
"^DD",409.3,409.3,9,21,1,0)
User that enters the patient to the wait list.
"^DD",409.3,409.3,9,"DT")
3020618
"^DD",409.3,409.3,10,0)
PRIORITY^RS^A:ASAP;F:FUTURE;^0;11^Q
"^DD",409.3,409.3,10,3)
Select either ASAP which will set the desired date for the appointment as the current date or select Future which will allow you to enter a desired date (example: T+6M)
"^DD",409.3,409.3,10,21,0)
^.001^7^7^3020913^^^^
"^DD",409.3,409.3,10,21,1,0)
If the patient is assigned to either the Service/Specialty or Specific
"^DD",409.3,409.3,10,21,2,0)
Clinic Wait List, a priority of Future or ASAP (as soon as possible) must
"^DD",409.3,409.3,10,21,3,0)
be entered. Future indicates that the patient needs an appointment in the
"^DD",409.3,409.3,10,21,4,0)
future and a desired will be entered by the user.
"^DD",409.3,409.3,10,21,5,0)
ASAP indicates that the patient needs an appointment before
"^DD",409.3,409.3,10,21,6,0)
the currently next available appointment (as soon as a slot opens). The 
"^DD",409.3,409.3,10,21,7,0)
desired date for ASAP will be set by the system as the current date.
"^DD",409.3,409.3,10,"DT")
3020805
"^DD",409.3,409.3,11,0)
REQUEST BY^RS^1:PROVIDER;2:PATIENT;^0;12^Q
"^DD",409.3,409.3,11,3)
Enter who requested the appointment - the patient or a provider
"^DD",409.3,409.3,11,21,0)
^.001^3^3^3020913^^
"^DD",409.3,409.3,11,21,1,0)
If the patient is placed on a Service/Specialty or Specific
"^DD",409.3,409.3,11,21,2,0)
Clinic Wait List type, the user must enter who requested the appointment 
"^DD",409.3,409.3,11,21,3,0)
- the patient or a provider.
"^DD",409.3,409.3,11,"DT")
3020625
"^DD",409.3,409.3,12,0)
PROVIDER^P200'^VA(200,^0;13^Q
"^DD",409.3,409.3,12,3)
This is the provider that requested the patient's appointment.       Must be an active provider in file 200.
"^DD",409.3,409.3,12,21,0)
^.001^3^3^3020913^^^^
"^DD",409.3,409.3,12,21,1,0)
If the patient's appointment was requested by a provider,
"^DD",409.3,409.3,12,21,2,0)
this is the provider that requested the patient's appointment.
"^DD",409.3,409.3,12,21,3,0)
Must be an active provider in file 200.
"^DD",409.3,409.3,12,"AUDIT")
n
"^DD",409.3,409.3,12,"DT")
3020930
"^DD",409.3,409.3,13,0)
SCHEDULED DATE OF APPT^D^^0;23^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",409.3,409.3,13,3)
Enter date/time of the scheduled appointment for this request
"^DD",409.3,409.3,13,21,0)
^^2^2^3050506^
"^DD",409.3,409.3,13,21,1,0)
The Appointment date scheduled for a patient. This appointment may be 
"^DD",409.3,409.3,13,21,2,0)
used as a reason for closing Electronic Wait List entry.
"^DD",409.3,409.3,13,23,0)
^.001^1^1^3050506^^
"^DD",409.3,409.3,13,23,1,0)
This is a date/time of the scheduled appointment related to this entry.
"^DD",409.3,409.3,13,"DT")
3050426
"^DD",409.3,409.3,13.1,0)
DATE APPT. MADE^D^^SDAPT;1^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",409.3,409.3,13.1,3)
(No range limit on date)
"^DD",409.3,409.3,13.1,21,0)
^^1^1^3050606^
"^DD",409.3,409.3,13.1,21,1,0)
This is the date the appointment was created.
"^DD",409.3,409.3,13.1,23,0)
^.001^2^2^3050606^^^
"^DD",409.3,409.3,13.1,23,1,0)
The Appointment Creation Date. It corresponds to the DATE APPT. MADE field
"^DD",409.3,409.3,13.1,23,2,0)
(#20) of the APPOINTMENT multiple (#1900) in the Patient file (#2).
"^DD",409.3,409.3,13.1,"DT")
3050505
"^DD",409.3,409.3,13.2,0)
APPT CLINIC^P44'^SC(^SDAPT;2^Q
"^DD",409.3,409.3,13.2,3)
Hospital Location the appointment is scheduled for.
"^DD",409.3,409.3,13.2,21,0)
^.001^1^1^3050519^^
"^DD",409.3,409.3,13.2,21,1,0)
This is a clinic the appointment was created for.
"^DD",409.3,409.3,13.2,23,0)
^.001^1^1^3050519^^^
"^DD",409.3,409.3,13.2,23,1,0)
Pointer to the HOSPITAL LOCATION file (#44) of the related appointment.
"^DD",409.3,409.3,13.2,"DT")
3050104
"^DD",409.3,409.3,13.3,0)
APPT INSTITUTION^P4'^DIC(4,^SDAPT;3^Q
"^DD",409.3,409.3,13.3,21,0)
^.001^1^1^3050519^^
"^DD",409.3,409.3,13.3,21,1,0)
The institution the clinic appointment belongs to.
"^DD",409.3,409.3,13.3,23,0)
^.001^2^2^3050519^^^
"^DD",409.3,409.3,13.3,23,1,0)
A pointer from the Hospital Location file of the scheduled appointment to 
"^DD",409.3,409.3,13.3,23,2,0)
the Institution file (#4).
"^DD",409.3,409.3,13.3,"DT")
3050104
"^DD",409.3,409.3,13.4,0)
APPT STOP CODE^P40.7'^DIC(40.7,^SDAPT;4^Q
"^DD",409.3,409.3,13.4,21,0)
^.001^2^2^3050519^^
"^DD",409.3,409.3,13.4,21,1,0)
The stop code/specialty of a clinic associated with the patient 
"^DD",409.3,409.3,13.4,21,2,0)
appointment.
"^DD",409.3,409.3,13.4,23,0)
^.001^2^2^3050519^^
"^DD",409.3,409.3,13.4,23,1,0)
This is the primary Stop Code Number pointer to the Stop Code file 
"^DD",409.3,409.3,13.4,23,2,0)
(#40.7).
"^DD",409.3,409.3,13.4,"DT")
3050506
"^DD",409.3,409.3,13.5,0)
APPT CREDIT STOP CODE^P40.7'^DIC(40.7,^SDAPT;5^Q
"^DD",409.3,409.3,13.5,21,0)
^^2^2^3050506^
"^DD",409.3,409.3,13.5,21,1,0)
The credit stop code optionally assigned to the Hospital Location file
"^DD",409.3,409.3,13.5,21,2,0)
associated with the scheduled appointment.
"^DD",409.3,409.3,13.5,23,0)
^.001^3^3^3050506^^^
"^DD",409.3,409.3,13.5,23,1,0)
This is the secondary (optional) Stop Code Number pointer to the Stop 
"^DD",409.3,409.3,13.5,23,2,0)
Code file (#40.7). This stop code is assigned to the Hospital Location
"^DD",409.3,409.3,13.5,23,3,0)
file associated with the scheduled appointment.
"^DD",409.3,409.3,13.5,"DT")
3050104
"^DD",409.3,409.3,13.6,0)
APPT STATION NUMBER^F^^SDAPT;6^K:$L(X)>6!($L(X)<3)!'(X?3N.E) X
"^DD",409.3,409.3,13.6,3)
Answer must be 3-6 characters in length.
"^DD",409.3,409.3,13.6,21,0)
^^2^2^3050606^
"^DD",409.3,409.3,13.6,21,1,0)
This is the 3 digit station number assigned to the facility plus optional
"^DD",409.3,409.3,13.6,21,2,0)
modifiers.
"^DD",409.3,409.3,13.6,23,0)
^.001^2^2^3050606^^^^
"^DD",409.3,409.3,13.6,23,1,0)
This is the Station Number field (#99) of the Institution file (#4) 
"^DD",409.3,409.3,13.6,23,2,0)
associated with the scheduled appointment.
"^DD",409.3,409.3,13.6,"DT")
3050428
"^DD",409.3,409.3,13.7,0)
APPT CLERK^P200'^VA(200,^SDAPT;7^Q
"^DD",409.3,409.3,13.7,21,0)
^^1^1^3050506^
"^DD",409.3,409.3,13.7,21,1,0)
This is a person who assigned the appointment to the EWL entry.
"^DD",409.3,409.3,13.7,23,0)
^.001^2^2^3050506^^
"^DD",409.3,409.3,13.7,23,1,0)
This is a pointer to the New Person file and it represents a person who 
"^DD",409.3,409.3,13.7,23,2,0)
entered the scheduled appointment into the EWL.
"^DD",409.3,409.3,13.7,"DT")
3050104
"^DD",409.3,409.3,13.8,0)
APPT STATUS^S^R:Scheduled/Kept;I:Inpatient;NS:No-Show;NSR:No_Show, Rescheduled;CP:Canceled by Patient;CPR:Canceled by Patient, Rescheduled;CC:Canceled by Clinic;CCR:Canceled by Clinic, Rescheduled;NT:No Action Taken;^SDAPT;8^Q
"^DD",409.3,409.3,13.8,21,0)
^^1^1^3050506^
"^DD",409.3,409.3,13.8,21,1,0)
This is an appointment status.
"^DD",409.3,409.3,13.8,"DT")
3050112
"^DD",409.3,409.3,14,0)
SERVICE CONNECTED PERCENTAGE^NJ3,0^^SC;1^K:+X'=X!(X>100)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.3,409.3,14,3)
Type a Number between 0 and 100, 0 Decimal Digits
"^DD",409.3,409.3,14,"DT")
3050627
"^DD",409.3,409.3,15,0)
SERVICE CONNECTED PRIORITY^S^0:NO;1:YES;^SC;2^Q
"^DD",409.3,409.3,15,"DT")
3050627
"^DD",409.3,409.3,16,0)
DO NOT REMOVE DATE^D^^0;14^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",409.3,409.3,16,21,0)
^.001^3^3^3020626^^
"^DD",409.3,409.3,16,21,1,0)
If the patient has met the criteria that should remove 
"^DD",409.3,409.3,16,21,2,0)
him/her from the wait list but the user does not want the
"^DD",409.3,409.3,16,21,3,0)
patient removed
"^DD",409.3,409.3,16,"DT")
3020618
"^DD",409.3,409.3,17,0)
USER ENTERING NO REMOVE^P200'^VA(200,^0;15^Q
"^DD",409.3,409.3,17,21,0)
^^1^1^3020626^
"^DD",409.3,409.3,17,21,1,0)
User entering 'Do Not Remove'
"^DD",409.3,409.3,17,"DT")
3020618
"^DD",409.3,409.3,18,0)
DO NOT REMOVE REASON^S^A:Appointment Criteria Not Met;P:Patient wants another appointment;PR:Provider wants another appointment;O:Other;^DNR;1^Q
"^DD",409.3,409.3,18,3)
Enter the reason for NOT removing the patient from the wait list.
"^DD",409.3,409.3,18,21,0)
^.001^1^1^3021009^^^^
"^DD",409.3,409.3,18,21,1,0)
Reason why the patient is not removed from Waiting List(Sch/PCMM)
"^DD",409.3,409.3,18,"DT")
3021009
"^DD",409.3,409.3,18.1,0)
DO NOT REMOVE COMMENT^F^^DNR;2^K:$L(X)>50!($L(X)<1) X
"^DD",409.3,409.3,18.1,3)
Answer must be 1-50 characters in length.
"^DD",409.3,409.3,18.1,21,0)
^^2^2^3020913^
"^DD",409.3,409.3,18.1,21,1,0)
Free Text comment (1-50 characters) for why wait list entry should not be 
"^DD",409.3,409.3,18.1,21,2,0)
removed when an appointment has met the wait list criteria.
"^DD",409.3,409.3,18.1,"DT")
3020821
"^DD",409.3,409.3,19,0)
DATE DISPOSITIONED^D^^DIS;1^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",409.3,409.3,19,21,0)
^.001^1^1^3050422^^^
"^DD",409.3,409.3,19,21,1,0)
Date patient is dispositioned from the Wait List(Sch/PCMM)
"^DD",409.3,409.3,19,"DT")
3020618
"^DD",409.3,409.3,20,0)
DISPOSITIONED BY^P200'^VA(200,^DIS;2^Q
"^DD",409.3,409.3,20,21,0)
^^1^1^3020626^
"^DD",409.3,409.3,20,21,1,0)
User who dispositioned patient from Wait List(Sch/PCMM)
"^DD",409.3,409.3,20,"DT")
3020618
"^DD",409.3,409.3,21,0)
DISPOSITION^S^D:DEATH;NC:REMOVED/NON-VA CARE;SA:REMOVED/SCHEDULED-ASSIGNED;CC:REMOVED/VA CONTRACT CARE;NN:REMOVED/NO LONGER NECESSARY;ER:ENTERED IN ERROR;TR:TRANSFERRED;^DIS;3^Q
"^DD",409.3,409.3,21,3)
Select a reason for removing the patient the wait list.
"^DD",409.3,409.3,21,21,0)
^.001^1^1^3050414^^^^
"^DD",409.3,409.3,21,21,1,0)
Reason patient has been dispositioned from Wait List(Sch/PCMM)
"^DD",409.3,409.3,21,"DT")
3050318
"^DD",409.3,409.3,22,0)
DESIRED DATE OF APPOINTMENT^RD^^0;16^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",409.3,409.3,22,3)
Enter the desired date for the appointment.
"^DD",409.3,409.3,22,21,0)
^.001^6^6^3021115^^^
"^DD",409.3,409.3,22,21,1,0)
If a patient is placed on a Service/Specialty or Clinic Specific
"^DD",409.3,409.3,22,21,2,0)
Wait List type, the date the appointment is needed/desired.
"^DD",409.3,409.3,22,21,3,0)
If the priority is ASAP, this is the date the patient
"^DD",409.3,409.3,22,21,4,0)
is placed on the Wait List(Sch/PCMM).
"^DD",409.3,409.3,22,21,5,0)
If the priority is Future, the user enters the date that the 
"^DD",409.3,409.3,22,21,6,0)
patient/provider needs an appointment scheduled.
"^DD",409.3,409.3,22,"DT")
3020710
"^DD",409.3,409.3,23,0)
CURRENT STATUS^S^O:OPEN;C:CLOSED;^0;17^Q
"^DD",409.3,409.3,23,21,0)
^.001^3^3^3050412^^^^
"^DD",409.3,409.3,23,21,1,0)
If the Wait List(Sch/PCMM) entry is dispositioned the
"^DD",409.3,409.3,23,21,2,0)
status = CLOSED, otherwise the Wait List(Sch/PCMM) entry
"^DD",409.3,409.3,23,21,3,0)
status = OPEN
"^DD",409.3,409.3,23,"DT")
3020618
"^DD",409.3,409.3,24,0)
AUDIT POINTER^409.324^^AU;0
"^DD",409.3,409.3,25,0)
COMMENTS^F^^0;18^K:$L(X)>60!($L(X)<1) X
"^DD",409.3,409.3,25,3)
Answer must be 1-60 characters in length.
"^DD",409.3,409.3,25,21,0)
^.001^6^6^3020909^^^
"^DD",409.3,409.3,25,21,1,0)
Free Text field to enter information related to the 
"^DD",409.3,409.3,25,21,2,0)
appointment that needs to be made.
"^DD",409.3,409.3,25,21,3,0)
example: see progress note date 5/01/02
"^DD",409.3,409.3,25,21,4,0)
this would direct the scheduling clerk to a note that may contain
"^DD",409.3,409.3,25,21,5,0)
lab,xray orders that need to be completed prior to
"^DD",409.3,409.3,25,21,6,0)
the appointment.
"^DD",409.3,409.3,25,"DT")
3050311
"^DD",409.3,409.3,26,0)
PACKAGE ORIGINATING^S^SD:SCHEDULING;PCMM:PCMM;^0;19^Q
"^DD",409.3,409.3,26,"DT")
3020628
"^DD",409.3,409.3,27,0)
EWL ENROLLEE STATUS^S^N:NEW;E:ESTABLISHED;P:PRIOR;U:UNDETERMINED;^0;20^Q
"^DD",409.3,409.3,27,21,0)
^^2^2^3020913^
"^DD",409.3,409.3,27,21,1,0)
A set of code that is determined by a formula looking at date patient 
"^DD",409.3,409.3,27,21,2,0)
last seen (file #391.91 and enrollment date from file #27.11)
"^DD",409.3,409.3,27,"DT")
3020815
"^DD",409.3,409.3,28,0)
EDITING USER^P200'^VA(200,^0;21^Q
"^DD",409.3,409.3,28,"AUDIT")
n
"^DD",409.3,409.3,28,"DT")
3020930
"^DD",409.3,409.3,29,0)
REOPEN REASON^S^CC:INACTIVATED CLINIC;CA:CANCELED APPOINTMENT;DE:DATE OF DEATH ERROR;O:OTHER;^1;1^Q
"^DD",409.3,409.3,29,21,0)
^^1^1^3050506^
"^DD",409.3,409.3,29,21,1,0)
The reason why the closed EWL entry was open.
"^DD",409.3,409.3,29,23,0)
^.001^2^2^3050506^^^
"^DD",409.3,409.3,29,23,1,0)
This field has been added with patch SD*5.3*327. It is populated by the 
"^DD",409.3,409.3,29,23,2,0)
EWL background job.
"^DD",409.3,409.3,29,"DT")
3050426
"^DD",409.3,409.3,30,0)
REOPEN COMMENT^F^^1;2^K:$L(X)>72!($L(X)<3) X
"^DD",409.3,409.3,30,3)
Answer must be 3-72 characters in length
"^DD",409.3,409.3,30,21,0)
^^1^1^3050506^
"^DD",409.3,409.3,30,21,1,0)
The comment used optionally with the Reopen Reason if applicable,
"^DD",409.3,409.3,30,"DT")
3050311
"^DD",409.3,409.324,0)
AUDIT POINTER SUB-FIELD^^.01^1
"^DD",409.3,409.324,0,"DT")
3020713
"^DD",409.3,409.324,0,"IX","B",409.324,.01)

"^DD",409.3,409.324,0,"NM","AUDIT POINTER")

"^DD",409.3,409.324,0,"UP")
409.3
"^DD",409.3,409.324,.01,0)
AUDIT POINTER^NJ11,0^^0;1^K:+X'=X!(X>99999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",409.3,409.324,.01,1,0)
^.1
"^DD",409.3,409.324,.01,1,1,0)
409.324^B
"^DD",409.3,409.324,.01,1,1,1)
S ^SDWL(409.3,DA(1),"AU","B",$E(X,1,30),DA)=""
"^DD",409.3,409.324,.01,1,1,2)
K ^SDWL(409.3,DA(1),"AU","B",$E(X,1,30),DA)
"^DD",409.3,409.324,.01,3)
Type a Number between 1 and 99999999999, 0 Decimal Digits
"^DD",409.3,409.324,.01,"DT")
3020713
"^DD",409.3,409.33,0)
DATE OF TRANSMISSION SUB-FIELD^^.01^1
"^DD",409.3,409.33,0,"DT")
3020808
"^DD",409.3,409.33,0,"IX","B",409.33,.01)

"^DD",409.3,409.33,0,"NM","DATE OF TRANSMISSION")

"^DD",409.3,409.33,0,"UP")
409.3
"^DD",409.3,409.33,.01,0)
DATE OF TRANSMISSION^MD^^0;1^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",409.3,409.33,.01,1,0)
^.1
"^DD",409.3,409.33,.01,1,1,0)
409.33^B
"^DD",409.3,409.33,.01,1,1,1)
S ^SDWL(409.3,DA(1),"ACCDATE","B",$E(X,1,30),DA)=""
"^DD",409.3,409.33,.01,1,1,2)
K ^SDWL(409.3,DA(1),"ACCDATE","B",$E(X,1,30),DA)
"^DD",409.3,409.33,.01,21,0)
^^1^1^3020913^
"^DD",409.3,409.33,.01,21,1,0)
Date of Wait List transmission
"^DD",409.3,409.33,.01,"DT")
3020808
"^DIC",409.3,409.3,0)
SD WAIT LIST^409.3
"^DIC",409.3,409.3,0,"GL")
^SDWL(409.3,
"^DIC",409.3,409.3,"%",0)
^1.005^^0
"^DIC",409.3,409.3,"%D",0)
^1.001^2^2^3050422^^^^
"^DIC",409.3,409.3,"%D",1,0)
This file contains the Wait List entries for the Wait List (Sch/PCMM) 
"^DIC",409.3,409.3,"%D",2,0)
package. Each entry represents a unique wait list entry.
"^DIC",409.3,"B","SD WAIT LIST",409.3)

"BLD",6167,6)
^SEQ #348
**END**
**END**
