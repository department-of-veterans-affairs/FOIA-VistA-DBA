Released PRC*5.1*85 SEQ #73
Extracted from mail message
**KIDS**:PRC*5.1*85^

**INSTALL NAME**
PRC*5.1*85
"BLD",4284,0)
PRC*5.1*85^IFCAP^0^3050715^y
"BLD",4284,1,0)
^^5^5^3050715^
"BLD",4284,1,1,0)
This patch modifies the PRCS APPROVE REQUEST print template to resolve
"BLD",4284,1,2,0)
an issue which was causing the APPROVE REQUEST option to fail when an
"BLD",4284,1,3,0)
item description contained a vertical bar (pipe) character.  It also 
"BLD",4284,1,4,0)
distributes a new copy of PRCPSFSV which contains a new set of FMS 
"BLD",4284,1,5,0)
transmission codes.
"BLD",4284,4,0)
^9.64PA^^
"BLD",4284,"KRN",0)
^9.67PA^8989.52^19
"BLD",4284,"KRN",.4,0)
.4
"BLD",4284,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",4284,"KRN",.4,"NM",1,0)
PRCS APPROVE REQUEST    FILE #410^410^0
"BLD",4284,"KRN",.4,"NM","B","PRCS APPROVE REQUEST    FILE #410",1)

"BLD",4284,"KRN",.401,0)
.401
"BLD",4284,"KRN",.402,0)
.402
"BLD",4284,"KRN",.403,0)
.403
"BLD",4284,"KRN",.5,0)
.5
"BLD",4284,"KRN",.84,0)
.84
"BLD",4284,"KRN",3.6,0)
3.6
"BLD",4284,"KRN",3.8,0)
3.8
"BLD",4284,"KRN",9.2,0)
9.2
"BLD",4284,"KRN",9.8,0)
9.8
"BLD",4284,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4284,"KRN",9.8,"NM",1,0)
PRCPSFSV^^0^B14632902
"BLD",4284,"KRN",9.8,"NM","B","PRCPSFSV",1)

"BLD",4284,"KRN",19,0)
19
"BLD",4284,"KRN",19.1,0)
19.1
"BLD",4284,"KRN",101,0)
101
"BLD",4284,"KRN",409.61,0)
409.61
"BLD",4284,"KRN",771,0)
771
"BLD",4284,"KRN",870,0)
870
"BLD",4284,"KRN",8989.51,0)
8989.51
"BLD",4284,"KRN",8989.52,0)
8989.52
"BLD",4284,"KRN",8994,0)
8994
"BLD",4284,"KRN","B",.4,.4)

"BLD",4284,"KRN","B",.401,.401)

"BLD",4284,"KRN","B",.402,.402)

"BLD",4284,"KRN","B",.403,.403)

"BLD",4284,"KRN","B",.5,.5)

"BLD",4284,"KRN","B",.84,.84)

"BLD",4284,"KRN","B",3.6,3.6)

"BLD",4284,"KRN","B",3.8,3.8)

"BLD",4284,"KRN","B",9.2,9.2)

"BLD",4284,"KRN","B",9.8,9.8)

"BLD",4284,"KRN","B",19,19)

"BLD",4284,"KRN","B",19.1,19.1)

"BLD",4284,"KRN","B",101,101)

"BLD",4284,"KRN","B",409.61,409.61)

"BLD",4284,"KRN","B",771,771)

"BLD",4284,"KRN","B",870,870)

"BLD",4284,"KRN","B",8989.51,8989.51)

"BLD",4284,"KRN","B",8989.52,8989.52)

"BLD",4284,"KRN","B",8994,8994)

"BLD",4284,"QUES",0)
^9.62^^
"BLD",4284,"REQB",0)
^9.611^1^1
"BLD",4284,"REQB",1,0)
PRC*5.1*81^2
"BLD",4284,"REQB","B","PRC*5.1*81",1)

"KRN",.4,2382,-1)
0^1
"KRN",.4,2382,0)
PRCS APPROVE REQUEST^3050713.1624^^410^^^3050713
"KRN",.4,2382,"%D",0)
^^2^2^2890716^
"KRN",.4,2382,"%D",1,0)
This print template is for printing out limited data of a
"KRN",.4,2382,"%D",2,0)
Control Point Request for the Control Point Official to sign.
"KRN",.4,2382,"DXS",1,"A")
ADJUSTMENT
"KRN",.4,2382,"DXS",1,"C")
CEILING
"KRN",.4,2382,"DXS",1,"CA")
CANCELLED
"KRN",.4,2382,"DXS",1,"O")
OBLIGATION
"KRN",.4,2382,"F",1)
"CP TRANSACTION NUMBER: ";C1~.01~
"KRN",.4,2382,"F",2)
S X=$S('$D(D0):"",D0<0:"",1:D0),DIP(1)=$G(X) S X="IEN",X1=DIP(1) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;Z;"SETPARAM(NUMBER,"IEN")"~
"KRN",.4,2382,"F",3)
"TEMPORARY TRANSACTION: ";C1~
"KRN",.4,2382,"F",4)
S DIP(1)=$S($D(^PRCS(410,D0,0)):^(0),1:"") S X=$P(DIP(1),U,3),DIP(2)=$G(X) S X=1,DIP(3)=$G(X) S X=10,X=$E(DIP(2),DIP(3),X) W X K DIP;Z;"$E(TEMPORARY TRANS. NUMBER,1,10)"~
"KRN",.4,2382,"F",5)
" ";C1~"TRANSACTION TYPE: ";C1~1~"FORM TYPE: ";C1~3~" ";C1~"REQUESTOR: ";C1~40~" ";C1~"DATE OF REQUEST: ";C1~5~"DATE REQUIRED: ";C1~7~" ";C1~
"KRN",.4,2382,"F",6)
"COMMITTED (ESTIMATED) COST: ";C1~20~" ";C1~"VENDOR: ";C1~11~" ";C1~"ITEM #1 DESCRIPTION:  ";C1;X~
"KRN",.4,2382,"F",7)
S PRCST5X=$$GET1^DIQ(410.02,"1,"_DIPA("IEN")_",",1,"","PRCTXT","PRCERR");L0;X;Z;"S PRCST5X=$$GET1^DIQ(410.02,"1,"_DIPA("IEN")_",",1,"","PRCTXT","PRCERR")"~
"KRN",.4,2382,"F",8)
W $S($D(PRCTXT(1)):$E(PRCTXT(1),1,30),1:"Item Description not available");X;Z;"W $S($D(PRCTXT(1)):$E(PRCTXT(1),1,30),1:"Item Description not available")"~
"KRN",.4,2382,"F",9)
K PRCST5X,PRCTXT,DIERR,PRCERR;Z;"K PRCST5X,PRCTXT,DIERR,PRCERR"~
"KRN",.4,2382,"H")
@
"KRN",.4,2382,"IOM")
80
"KRN",.4,2382,"LAST")

"KRN",.4,2382,"ROU")
^PRCST5
"KRN",.4,2382,"ROUOLD")
PRCST5
"KRN",.4,2382,"SUB")
1
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
85^3050715
"PKG",455,22,1,"PAH",1,1,0)
^^5^5^3050715
"PKG",455,22,1,"PAH",1,1,1,0)
This patch modifies the PRCS APPROVE REQUEST print template to resolve
"PKG",455,22,1,"PAH",1,1,2,0)
an issue which was causing the APPROVE REQUEST option to fail when an
"PKG",455,22,1,"PAH",1,1,3,0)
item description contained a vertical bar (pipe) character.  It also 
"PKG",455,22,1,"PAH",1,1,4,0)
distributes a new copy of PRCPSFSV which contains a new set of FMS 
"PKG",455,22,1,"PAH",1,1,5,0)
transmission codes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PRCPSFSV")
0^1^B14632902
"RTN","PRCPSFSV",1,0)
PRCPSFSV ;WOIFO/RFJ,LKG-create fms sv adjustment code sheet ;7/8/05  10:11
"RTN","PRCPSFSV",2,0)
 ;;5.1;IFCAP;**81,85**;Oct 20, 2000
"RTN","PRCPSFSV",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCPSFSV",4,0)
 Q
"RTN","PRCPSFSV",5,0)
 ;
"RTN","PRCPSFSV",6,0)
 ;
"RTN","PRCPSFSV",7,0)
SV(INVPT,TRANID,TRANDATE,STACKDA) ;  create fms sv document for adjustment
"RTN","PRCPSFSV",8,0)
 ;  tranid=transaction register id number
"RTN","PRCPSFSV",9,0)
 ;  pass trandate for optional FMS acctg period, otherwise it uses the
"RTN","PRCPSFSV",10,0)
 ;                                               transaction date
"RTN","PRCPSFSV",11,0)
 ;  pass stackda for regeneration of document
"RTN","PRCPSFSV",12,0)
 ;  loop transaction register for adjusted items
"RTN","PRCPSFSV",13,0)
 ;  variables required:
"RTN","PRCPSFSV",14,0)
 ;    prcpwbfy = whse beg fy  ;  prcpwfcp = whse fcp
"RTN","PRCPSFSV",15,0)
 ;    prcpwsta = whse station #
"RTN","PRCPSFSV",16,0)
 N ACCT,BFY,DATA,EFY,FUND,GECSFMS,INVCOST,LINE,LINEDOC,PRCPFMS,PRCPSEC1,REASON,SIGN,TABLE,TOTAL,TRANDA,XPROG
"RTN","PRCPSFSV",17,0)
 K PRCPFMS
"RTN","PRCPSFSV",18,0)
 S (TRANDA,TOTAL)=0 F  S TRANDA=$O(^PRCP(445.2,"T",INVPT,TRANID,TRANDA)) Q:'TRANDA  S DATA=$G(^PRCP(445.2,TRANDA,0)) I DATA'="" D
"RTN","PRCPSFSV",19,0)
 .   I '$P(DATA,"^",5) Q
"RTN","PRCPSFSV",20,0)
 .   S INVCOST=$P(DATA,"^",22) I 'INVCOST Q
"RTN","PRCPSFSV",21,0)
 .   I 'TRANDATE S TRANDATE=$P(DATA,"^",3)
"RTN","PRCPSFSV",22,0)
 .   S ACCT=$$ACCT1^PRCPUX1($P($$NSN^PRCPUX1($P(DATA,"^",5)),"-"))
"RTN","PRCPSFSV",23,0)
 .   S REASON=+$P(DATA,"^",10) I 'REASON S REASON=+$G(^PRCP(445.2,TRANDA,1))
"RTN","PRCPSFSV",24,0)
 .   S TOTAL=TOTAL+INVCOST
"RTN","PRCPSFSV",25,0)
 .   S PRCPFMS(ACCT,REASON)=$G(PRCPFMS(ACCT,REASON))+INVCOST
"RTN","PRCPSFSV",26,0)
 .   I PRCPFMS(ACCT,REASON)=0 K PRCPFMS(ACCT,REASON)
"RTN","PRCPSFSV",27,0)
 I '$D(PRCPFMS) Q
"RTN","PRCPSFSV",28,0)
 ;
"RTN","PRCPSFSV",29,0)
SVCOTS ;Entry point for SV from COTS inventory transaction
"RTN","PRCPSFSV",30,0)
 ;  set up document variables
"RTN","PRCPSFSV",31,0)
 ;   table=^^xprogram(fcp/prj)^^linefund^beginfy^endfy^^^job
"RTN","PRCPSFSV",32,0)
 S TABLE=$$ACC^PRC0C(PRCPWSTA,PRCPWFCP_"^"_$E(DT,2,3)_"^"_PRCPWBFY)
"RTN","PRCPSFSV",33,0)
 S XPROG=$P(TABLE,"^",3),FUND=$P(TABLE,"^",5),BFY=$E($P(TABLE,"^",6),3,4),EFY=$E($P(TABLE,"^",7),3,4)
"RTN","PRCPSFSV",34,0)
 I EFY=BFY S EFY=""
"RTN","PRCPSFSV",35,0)
 ;
"RTN","PRCPSFSV",36,0)
 ;  build control segments in gcs
"RTN","PRCPSFSV",37,0)
 S PRCPSEC1=$$SEC1^PRC0C(PRCPWSTA) S:PRCPSEC1="" PRCPSEC1=10
"RTN","PRCPSFSV",38,0)
 I '$G(STACKDA) D CONTROL^GECSUFMS("I",PRCPWSTA,PRCPWSTA_TRANID,"SV",PRCPSEC1,0,"","Other adjustment tranid: "_TRANID)
"RTN","PRCPSFSV",39,0)
 I $G(STACKDA) D REBUILD^GECSUFM1(STACKDA,"I",PRCPSEC1,"","Rebuild of Other adjustment tranid: "_TRANID) S GECSFMS("DA")=STACKDA
"RTN","PRCPSFSV",40,0)
 D SETPARAM^GECSSDCT(GECSFMS("DA"),TRANID)
"RTN","PRCPSFSV",41,0)
 ;
"RTN","PRCPSFSV",42,0)
 ;  build iv2 segment
"RTN","PRCPSFSV",43,0)
 S LINEDOC="SV2^"_$E(TRANDATE,2,3)_"^"_$E(TRANDATE,4,5)_"^"_$E(TRANDATE,6,7)
"RTN","PRCPSFSV",44,0)
 S $P(LINEDOC,"^",7)="E"
"RTN","PRCPSFSV",45,0)
 S $P(LINEDOC,"^",16)=$J($S(TOTAL<0:-TOTAL,1:TOTAL),0,2)
"RTN","PRCPSFSV",46,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),LINEDOC_"^~")
"RTN","PRCPSFSV",47,0)
 ;
"RTN","PRCPSFSV",48,0)
 ;  build line documents
"RTN","PRCPSFSV",49,0)
 S (ACCT,LINE)=0 F  S ACCT=$O(PRCPFMS(ACCT)) Q:'ACCT  S REASON="" F  S REASON=$O(PRCPFMS(ACCT,REASON)) Q:REASON=""  S INVCOST=PRCPFMS(ACCT,REASON) I INVCOST D
"RTN","PRCPSFSV",50,0)
 .   S SIGN="I" I INVCOST<0 S INVCOST=-INVCOST,SIGN="D"
"RTN","PRCPSFSV",51,0)
 .   S LINE=LINE+1
"RTN","PRCPSFSV",52,0)
 .   S LINEDOC="LIN^~SVA^"_$E("000",$L(LINE)+1,3)_LINE_"^S"_$$TRANTYPE(REASON,ACCT)_"^"_BFY_"^"_EFY_"^"_FUND_"^^"_PRCPWSTA_"^^^^"_XPROG
"RTN","PRCPSFSV",53,0)
 .   S $P(LINEDOC,"^",24)="220"
"RTN","PRCPSFSV",54,0)
 .   S LINEDOC=LINEDOC_"^~SVB^"_$J(INVCOST,0,2)_"^"_SIGN_"^^G^~"
"RTN","PRCPSFSV",55,0)
 .   D SETCS^GECSSTAA(GECSFMS("DA"),LINEDOC)
"RTN","PRCPSFSV",56,0)
 ;
"RTN","PRCPSFSV",57,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCPSFSV",58,0)
 D EN^DDIOL("FMS SV "_PRCPWSTA_TRANID_" document automatically "_$S($G(STACKDA):"RE-",1:"")_"transmitted.","","!?4")
"RTN","PRCPSFSV",59,0)
 Q
"RTN","PRCPSFSV",60,0)
 ;
"RTN","PRCPSFSV",61,0)
 ;
"RTN","PRCPSFSV",62,0)
TRANTYPE(TYPE,ACCT) ;  return transaction type based on type (1-7) and acct
"RTN","PRCPSFSV",63,0)
 ;  type=1:transfer stock to VAMC whse
"RTN","PRCPSFSV",64,0)
 ;  type=2:sale of stock to OGA
"RTN","PRCPSFSV",65,0)
 ;  type=3:transfer excess stock to GSA
"RTN","PRCPSFSV",66,0)
 ;  type=4:adjustment to stock valuation
"RTN","PRCPSFSV",67,0)
 ;  type=5:writeoff damaged stock
"RTN","PRCPSFSV",68,0)
 ;  type=6:transfer transportation to stock
"RTN","PRCPSFSV",69,0)
 ;  type=7:inventory refund adjustment
"RTN","PRCPSFSV",70,0)
 I TYPE=1 Q $S(ACCT=1:"A",ACCT=2:"B",ACCT=3:"C",ACCT=8:"D",ACCT=6:"N",1:0)
"RTN","PRCPSFSV",71,0)
 I TYPE=2 Q $S(ACCT=1:"E",ACCT=2:"F",ACCT=3:"G",ACCT=8:"H",ACCT=6:"N",1:0)
"RTN","PRCPSFSV",72,0)
 I TYPE=3 Q $S(ACCT=1:"J",ACCT=2:"J",ACCT=3:"J",ACCT=8:"J",ACCT=6:"N",1:0)
"RTN","PRCPSFSV",73,0)
 I TYPE=4 Q $S(ACCT=1:"M",ACCT=2:"N",ACCT=3:"N",ACCT=8:"N",ACCT=6:"N",1:0)
"RTN","PRCPSFSV",74,0)
 I TYPE=5 Q $S(ACCT=1:"M",ACCT=2:"N",ACCT=3:"N",ACCT=8:"N",ACCT=6:"N",1:0)
"RTN","PRCPSFSV",75,0)
 I TYPE=6 Q $S(ACCT=1:"Q",ACCT=2:"Q",ACCT=3:"Q",ACCT=8:"Q",ACCT=6:"N",1:0)
"RTN","PRCPSFSV",76,0)
 I TYPE=7 Q $S(ACCT=1:"U",ACCT=2:"U",ACCT=3:"U",ACCT=8:"U",ACCT=6:"N",1:0)
"RTN","PRCPSFSV",77,0)
 Q 0
"VER")
8.0^22.0
"BLD",4284,6)
^SEQ #73
**END**
**END**
