Released FB*3.5*73 SEQ #69
Extracted from mail message
**KIDS**:FB*3.5*73^

**INSTALL NAME**
FB*3.5*73
"BLD",5383,0)
FB*3.5*73^FEE BASIS^0^3040217^y
"BLD",5383,1,0)
^^3^3^3040211^
"BLD",5383,1,1,0)
This Patch addresses two issues: The first, Allow the sites to suspend 
"BLD",5383,1,2,0)
payment for a prescription that is not covered. The second, To correct 
"BLD",5383,1,3,0)
the "AF" X-ref by using FileMan call to populate the field AUTHORIZATION.
"BLD",5383,4,0)
^9.64PA^^
"BLD",5383,"INID")
y^y
"BLD",5383,"INIT")
FBXIP73
"BLD",5383,"KRN",0)
^9.67PA^8989.52^19
"BLD",5383,"KRN",.4,0)
.4
"BLD",5383,"KRN",.401,0)
.401
"BLD",5383,"KRN",.402,0)
.402
"BLD",5383,"KRN",.403,0)
.403
"BLD",5383,"KRN",.5,0)
.5
"BLD",5383,"KRN",.84,0)
.84
"BLD",5383,"KRN",3.6,0)
3.6
"BLD",5383,"KRN",3.8,0)
3.8
"BLD",5383,"KRN",9.2,0)
9.2
"BLD",5383,"KRN",9.8,0)
9.8
"BLD",5383,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5383,"KRN",9.8,"NM",1,0)
FBUTL2^^0^B53713039
"BLD",5383,"KRN",9.8,"NM",2,0)
FBAACO5^^0^B3693700
"BLD",5383,"KRN",9.8,"NM","B","FBAACO5",2)

"BLD",5383,"KRN",9.8,"NM","B","FBUTL2",1)

"BLD",5383,"KRN",19,0)
19
"BLD",5383,"KRN",19.1,0)
19.1
"BLD",5383,"KRN",101,0)
101
"BLD",5383,"KRN",409.61,0)
409.61
"BLD",5383,"KRN",771,0)
771
"BLD",5383,"KRN",870,0)
870
"BLD",5383,"KRN",8989.51,0)
8989.51
"BLD",5383,"KRN",8989.52,0)
8989.52
"BLD",5383,"KRN",8994,0)
8994
"BLD",5383,"KRN","B",.4,.4)

"BLD",5383,"KRN","B",.401,.401)

"BLD",5383,"KRN","B",.402,.402)

"BLD",5383,"KRN","B",.403,.403)

"BLD",5383,"KRN","B",.5,.5)

"BLD",5383,"KRN","B",.84,.84)

"BLD",5383,"KRN","B",3.6,3.6)

"BLD",5383,"KRN","B",3.8,3.8)

"BLD",5383,"KRN","B",9.2,9.2)

"BLD",5383,"KRN","B",9.8,9.8)

"BLD",5383,"KRN","B",19,19)

"BLD",5383,"KRN","B",19.1,19.1)

"BLD",5383,"KRN","B",101,101)

"BLD",5383,"KRN","B",409.61,409.61)

"BLD",5383,"KRN","B",771,771)

"BLD",5383,"KRN","B",870,870)

"BLD",5383,"KRN","B",8989.51,8989.51)

"BLD",5383,"KRN","B",8989.52,8989.52)

"BLD",5383,"KRN","B",8994,8994)

"BLD",5383,"PRE")
FBXIP73E
"BLD",5383,"QUES",0)
^9.62^^
"BLD",5383,"REQB",0)
^9.611^1^1
"BLD",5383,"REQB",1,0)
FB*3.5*61^2
"BLD",5383,"REQB","B","FB*3.5*61",1)

"INIT")
FBXIP73
"MBREQ")
0
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
73^3040217
"PKG",60,22,1,"PAH",1,1,0)
^^3^3^3040217
"PKG",60,22,1,"PAH",1,1,1,0)
This Patch addresses two issues: The first, Allow the sites to suspend 
"PKG",60,22,1,"PAH",1,1,2,0)
payment for a prescription that is not covered. The second, To correct 
"PKG",60,22,1,"PAH",1,1,3,0)
the "AF" X-ref by using FileMan call to populate the field AUTHORIZATION.
"PRE")
FBXIP73E
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","FBAACO5")
0^2^B3693700
"RTN","FBAACO5",1,0)
FBAACO5 ;AISC/GRR-ENTER PAYMENT CONTINUED ;5/5/93  09:24
"RTN","FBAACO5",2,0)
 ;;3.5;FEE BASIS;**73**;JAN 30, 1995
"RTN","FBAACO5",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACO5",4,0)
FILEV(DFN,FBV) ;files vendor multiple in outpatient payment file
"RTN","FBAACO5",5,0)
 ;required input variable DFN,FBV (vendor ien)
"RTN","FBAACO5",6,0)
 K FBAAOUT
"RTN","FBAACO5",7,0)
 I '$G(DFN)!('FBV) S FBAAOUT=1 Q
"RTN","FBAACO5",8,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAACO5",9,0)
 S DLAYGO=162,DIC="^FBAAC("_DFN_",1,",DIC(0)="QLNM",DA(1)=DFN,X="`"_FBV D ^DIC K DIC,DLAYGO I Y<0 W !,*7,"Cannot select this Vendor at this time" S FBAAOUT=1 Q
"RTN","FBAACO5",10,0)
 Q
"RTN","FBAACO5",11,0)
GETSVDT(DFN,FBV,FBASSOC,FBA,X) ;set date of service multiple
"RTN","FBAACO5",12,0)
 ;required input DFN,FBV (vendor ien),FBASSOC (auth ptr,0 if not known)
"RTN","FBAACO5",13,0)
 ;required input FBA (1=ask dt,0=do not ask dt)
"RTN","FBAACO5",14,0)
 ;optional/required input X (dt) - X req if FBA=0 (do not ask)
"RTN","FBAACO5",15,0)
 ;output FBSDI=ien of svc date mult,FBAADT=svc date
"RTN","FBAACO5",16,0)
 K FBAAOUT
"RTN","FBAACO5",17,0)
 I '$G(DFN)!('$G(FBV))!('$D(FBASSOC))!('$D(FBA)) S FBAAOUT=1 Q
"RTN","FBAACO5",18,0)
 I FBA=0,('$G(X)) S FBAAOUT=1 Q
"RTN","FBAACO5",19,0)
 I $G(FBA) S DIC("A")="Date of Service: ",DIC(0)="AEQLM"
"RTN","FBAACO5",20,0)
 I '$G(FBA) S DIC(0)="QLMN"
"RTN","FBAACO5",21,0)
 I '$D(^FBAAC(DFN,1,FBV,1,0)) S ^FBAAC(DFN,1,FBV,1,0)="^162.02DA^0^0"
"RTN","FBAACO5",22,0)
 S DLAYGO=162,DA(2)=DFN,DA(1)=FBV,DIC="^FBAAC("_DFN_",1,"_FBV_",1," D ^DIC K DLAYGO,DIC,DA I X=""!(X="^")!(Y<0) S FBAAOUT=1 Q
"RTN","FBAACO5",23,0)
 S FBSDI=+Y,FBAADT=$P(Y,"^",2) I FBASSOC>0 S DA(2)=DFN,DA(1)=FBV,DA=FBSDI,DIE="^FBAAC("_DFN_",1,"_FBV_",1,",DR="3///^S X=FBASSOC" D ^DIE K DIE,DA,DR
"RTN","FBAACO5",24,0)
 Q
"RTN","FBUTL2")
0^1^B53713039
"RTN","FBUTL2",1,0)
FBUTL2 ;WOIFO/SAB-FEE BASIS UTILITY ;7/1/2003
"RTN","FBUTL2",2,0)
 ;;3.5;FEE BASIS;**61,73**;JAN 30, 1995
"RTN","FBUTL2",3,0)
 Q
"RTN","FBUTL2",4,0)
ADJ(FBTAS,FBADJ,FBMAX,FBDT,FBADJD,FBNOOUT) ; Prompt for adjustments
"RTN","FBUTL2",5,0)
 ;
"RTN","FBUTL2",6,0)
 ; Input
"RTN","FBUTL2",7,0)
 ;   FBTAS  - required, total amount suspended, number, may be negative
"RTN","FBUTL2",8,0)
 ;            the sum of all adjustment amounts must equal this value
"RTN","FBUTL2",9,0)
 ;   FBADJ  - required, array passed by reference
"RTN","FBUTL2",10,0)
 ;            will be initialized (killed)
"RTN","FBUTL2",11,0)
 ;            array of any entered adjustments
"RTN","FBUTL2",12,0)
 ;            format
"RTN","FBUTL2",13,0)
 ;              FBADJ(#)=FBADJR^FBADJG^FBADJA
"RTN","FBUTL2",14,0)
 ;            where
"RTN","FBUTL2",15,0)
 ;              # = sequentially assigned number starting with 1
"RTN","FBUTL2",16,0)
 ;              FBADJR = adjustment reason (internal value file 162.91)
"RTN","FBUTL2",17,0)
 ;              FBADJG = adjustment group (inernal value file 162.92)
"RTN","FBUTL2",18,0)
 ;              FBADJA = adjustment amount (dollar value)
"RTN","FBUTL2",19,0)
 ;   FBMAX  -  optional, number, default to 1
"RTN","FBUTL2",20,0)
 ;             maximum number of adjustments that may be entered by user
"RTN","FBUTL2",21,0)
 ;   FBDT   -  optional, effective date, FileMan internal format
"RTN","FBUTL2",22,0)
 ;             default to current date, used to determine available codes
"RTN","FBUTL2",23,0)
 ;   FBADJD -  optional, array passed by reference
"RTN","FBUTL2",24,0)
 ;             same format as FBADJ
"RTN","FBUTL2",25,0)
 ;             if passed, it will be used to supply default values
"RTN","FBUTL2",26,0)
 ;             normally only used when editing an existing payment 
"RTN","FBUTL2",27,0)
 ;   FBNOOUT-  optional, boolean value, default 0, set =1 if user
"RTN","FBUTL2",28,0)
 ;             should not be allowed to exit using an uparrow
"RTN","FBUTL2",29,0)
 ; Result (value of $$ADJ extrinsic function)
"RTN","FBUTL2",30,0)
 ;   FBRET  - boulean value (0 or 1)
"RTN","FBUTL2",31,0)
 ;             = 1 when valid adjustments entered
"RTN","FBUTL2",32,0)
 ;             = 0 when processed ended due to time-out or entry of '^'
"RTN","FBUTL2",33,0)
 ; Output
"RTN","FBUTL2",34,0)
 ;   FBADJ  - the FBADJ input array passed by reference will be modified
"RTN","FBUTL2",35,0)
 ;            if the result = 1 then it will contain entered adjustments
"RTN","FBUTL2",36,0)
 ;            if the result = 0 then it will be undefined
"RTN","FBUTL2",37,0)
 ;
"RTN","FBUTL2",38,0)
 N FBADJR,FBCAS,FBCNT,FBEDIT,FBERR,FBI,FBNEW,FBRET
"RTN","FBUTL2",39,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBUTL2",40,0)
 S FBRET=1
"RTN","FBUTL2",41,0)
 S FBMAX=$G(FBMAX,1)
"RTN","FBUTL2",42,0)
 S FBDT=$G(FBDT,DT)
"RTN","FBUTL2",43,0)
 S FBNOOUT=$G(FBNOOUT,0)
"RTN","FBUTL2",44,0)
 S FBTAS=+FBTAS
"RTN","FBUTL2",45,0)
 K FBADJ
"RTN","FBUTL2",46,0)
 ;
"RTN","FBUTL2",47,0)
 I +FBTAS=0 G EXIT ; no adjustment since total amount susp. is 0
"RTN","FBUTL2",48,0)
 ;
"RTN","FBUTL2",49,0)
 ; if default adjustments exist then load them into array
"RTN","FBUTL2",50,0)
 I $D(FBADJD) M FBADJ=FBADJD
"RTN","FBUTL2",51,0)
 S (FBCNT,FBCAS)=0
"RTN","FBUTL2",52,0)
 I $D(FBADJ) S FBI=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D
"RTN","FBUTL2",53,0)
 . S FBCNT=FBCNT+1
"RTN","FBUTL2",54,0)
 . S FBCAS=FBCAS+$P(FBADJ(FBI),U,3)
"RTN","FBUTL2",55,0)
 ;
"RTN","FBUTL2",56,0)
 ; if more than one adjustment can be entered then display number
"RTN","FBUTL2",57,0)
 ;
"RTN","FBUTL2",58,0)
 ;
"RTN","FBUTL2",59,0)
ASKADJ ; multiply prompt for adjustments
"RTN","FBUTL2",60,0)
 ;
"RTN","FBUTL2",61,0)
 ; display current list of adjustments when more than 1 allowed
"RTN","FBUTL2",62,0)
 I FBMAX>1!(FBCNT>1) D
"RTN","FBUTL2",63,0)
 . W !!,"Current list of Adjustments: "
"RTN","FBUTL2",64,0)
 . I '$O(FBADJ(0)) W "none"
"RTN","FBUTL2",65,0)
 . S FBI=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D
"RTN","FBUTL2",66,0)
 . . W ?30,"Code: "
"RTN","FBUTL2",67,0)
 . . W:$P(FBADJ(FBI),U)]"" $P($G(^FB(161.91,$P(FBADJ(FBI),U),0)),U)
"RTN","FBUTL2",68,0)
 . . W ?44,"Group: "
"RTN","FBUTL2",69,0)
 . . W:$P(FBADJ(FBI),U,2)]"" $P($G(^FB(161.92,$P(FBADJ(FBI),U,2),0)),U)
"RTN","FBUTL2",70,0)
 . . W ?56,"Amount: "
"RTN","FBUTL2",71,0)
 . . W "$",$FN($P(FBADJ(FBI),U,3),"",2),!
"RTN","FBUTL2",72,0)
 ;
"RTN","FBUTL2",73,0)
 ; prompt for adjustment reason
"RTN","FBUTL2",74,0)
 ;   if max is 1 and reason already on list then automatically select it
"RTN","FBUTL2",75,0)
 I FBMAX=1,FBCNT=1 D
"RTN","FBUTL2",76,0)
 . N FBI,FBADJR
"RTN","FBUTL2",77,0)
 . S FBI=$O(FBADJ(0))
"RTN","FBUTL2",78,0)
 . S:FBI FBADJR=$P(FBADJ(FBI),U)
"RTN","FBUTL2",79,0)
 . I FBADJR S Y=FBADJR_U_$P($G(^FB(161.91,FBADJR,0)),U)
"RTN","FBUTL2",80,0)
 E  D  I $D(DTOUT)!$D(DUOUT) S FBRET=0 G EXIT  ; prompt user
"RTN","FBUTL2",81,0)
 . S DIR(0)="PO^161.91:EMZ"
"RTN","FBUTL2",82,0)
 . S DIR("A")="Select ADJUSTMENT REASON"
"RTN","FBUTL2",83,0)
 . S DIR("S")="I $P($$AR^FBUTL1(Y,,FBDT),U,4)=1"
"RTN","FBUTL2",84,0)
 . S DIR("?")="Select a HIPAA Adjustment (suspense) Reason Code"
"RTN","FBUTL2",85,0)
 . S DIR("?",1)="Adjustment reason codes explain why the amount paid differs"
"RTN","FBUTL2",86,0)
 . S DIR("?",2)="from the amount claimed."
"RTN","FBUTL2",87,0)
 . D ^DIR K DIR
"RTN","FBUTL2",88,0)
 ; if value was entered then process it and ask another if not max and
"RTN","FBUTL2",89,0)
 ;   total amount suspended has not been accounted for
"RTN","FBUTL2",90,0)
 I +Y>0 D  G:FBRET=0 EXIT I FBCNT<FBMAX,FBCAS'=FBTAS G ASKADJ
"RTN","FBUTL2",91,0)
 . S FBADJR=+Y
"RTN","FBUTL2",92,0)
 . ; if specified adj. reason already in list set FBEDIT = it's number
"RTN","FBUTL2",93,0)
 . S (FBI,FBEDIT)=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D  Q:FBEDIT
"RTN","FBUTL2",94,0)
 . . I $P(FBADJ(FBI),U)=FBADJR S FBEDIT=FBI
"RTN","FBUTL2",95,0)
 . S FBNEW=$S(FBEDIT:0,1:1) ; flag as new if not on list
"RTN","FBUTL2",96,0)
 . ; if in list then edit the existing adj. reason
"RTN","FBUTL2",97,0)
 . I FBEDIT D  Q:$D(DIRUT)  Q:FBADJR=""
"RTN","FBUTL2",98,0)
 . . S DIR(0)="162.558,.01"
"RTN","FBUTL2",99,0)
 . . ;S DIR(0)="PO^161.91:EMZ"
"RTN","FBUTL2",100,0)
 . . ;S DIR("S")="I $P($$AR^FBUTL1(Y,,FBDT),U,4)=1"
"RTN","FBUTL2",101,0)
 . . ;S DIR("A")="  ADJUSTMENT REASON"
"RTN","FBUTL2",102,0)
 . . S DIR("B")=$P($G(^FB(161.91,FBADJR,0)),U)
"RTN","FBUTL2",103,0)
 . . ;S DIR("?")="Enter a HIPAA Adjustment (suspense) Reason Code"
"RTN","FBUTL2",104,0)
 . . ;S DIR("?",1)="Adjustment reason codes explain why the amount paid differs"
"RTN","FBUTL2",105,0)
 . . ;S DIR("?",2)="from the amount claimed."
"RTN","FBUTL2",106,0)
 . . D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S:FBMAX=1 FBRET=0 Q
"RTN","FBUTL2",107,0)
 . . I X="@" D  Q  ; "@" removes from list
"RTN","FBUTL2",108,0)
 . . . D DEL(FBEDIT)
"RTN","FBUTL2",109,0)
 . . . S FBADJR=""
"RTN","FBUTL2",110,0)
 . . . W "   (deleted)"
"RTN","FBUTL2",111,0)
 . . I +Y>0 S FBADJR=+Y
"RTN","FBUTL2",112,0)
 . . ; ensure new value of edited reason is not already on list
"RTN","FBUTL2",113,0)
 . . S FBI=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D  Q:FBADJR=""
"RTN","FBUTL2",114,0)
 . . . I $P(FBADJ(FBI),U)=FBADJR,FBI'=FBEDIT S FBADJR="" W !,$C(7),"     Change was not accepted because the new value is already on the list."
"RTN","FBUTL2",115,0)
 . . Q:FBADJR=""
"RTN","FBUTL2",116,0)
 . . ; upate the existing reason
"RTN","FBUTL2",117,0)
 . . S $P(FBADJ(FBEDIT),U)=FBADJR
"RTN","FBUTL2",118,0)
 . ;
"RTN","FBUTL2",119,0)
 . ; if new reason then add to list
"RTN","FBUTL2",120,0)
 . I 'FBEDIT D  Q:FBADJR=""
"RTN","FBUTL2",121,0)
 . . I (FBCNT+1)>FBMAX D  Q
"RTN","FBUTL2",122,0)
 . . . S FBADJR=""
"RTN","FBUTL2",123,0)
 . . . W !,$C(7),"ERROR: A new reason would exceed maximum number (",FBMAX,") allowed for this invoice."
"RTN","FBUTL2",124,0)
 . . . W !,"   Select a reason code on the current list instead."
"RTN","FBUTL2",125,0)
 . . S FBEDIT=$O(FBADJ(" "),-1)+1
"RTN","FBUTL2",126,0)
 . . S $P(FBADJ(FBEDIT),U)=FBADJR,FBCNT=FBCNT+1
"RTN","FBUTL2",127,0)
 . ;
"RTN","FBUTL2",128,0)
 . ; ask for adjustment group
"RTN","FBUTL2",129,0)
 . S DIR(0)="162.558,1"
"RTN","FBUTL2",130,0)
 . ;S DIR(0)="P^161.92:EMZ"
"RTN","FBUTL2",131,0)
 . ;S DIR("S")="I $P($$AG^FBUTL1(Y,,FBDT),U,4)=1"
"RTN","FBUTL2",132,0)
 . ;S DIR("A")="  ADJUSTMENT GROUP"
"RTN","FBUTL2",133,0)
 . I $P(FBADJ(FBEDIT),U,2)]"" S DIR("B")=$P($G(^FB(161.92,$P(FBADJ(FBEDIT),U,2),0)),U)
"RTN","FBUTL2",134,0)
 . D ^DIR K DIR I $D(DIRUT) D:FBNEW DEL(FBEDIT) Q
"RTN","FBUTL2",135,0)
 . S $P(FBADJ(FBEDIT),U,2)=+Y
"RTN","FBUTL2",136,0)
 . ;
"RTN","FBUTL2",137,0)
 . ; ask for adjustment amount
"RTN","FBUTL2",138,0)
 . S DIR(0)="162.558,2"
"RTN","FBUTL2",139,0)
 . ;S DIR(0)="NA^-9999999.99:9999999.99:2^K:+X=0 X"
"RTN","FBUTL2",140,0)
 . ;S DIR("A")="  ADJUSTMENT AMOUNT: "
"RTN","FBUTL2",141,0)
 . S DIR("B")=$FN(FBTAS-FBCAS+$P(FBADJ(FBEDIT),U,3),"",2)
"RTN","FBUTL2",142,0)
 . D ^DIR K DIR I $D(DIRUT) D:FBNEW DEL(FBEDIT) Q
"RTN","FBUTL2",143,0)
 . S FBCAS=FBCAS-$P($G(FBADJ(FBEDIT)),U,3)+Y
"RTN","FBUTL2",144,0)
 . S $P(FBADJ(FBEDIT),U,3)=+Y
"RTN","FBUTL2",145,0)
 ;
"RTN","FBUTL2",146,0)
VAL ; validate
"RTN","FBUTL2",147,0)
 S FBERR=0
"RTN","FBUTL2",148,0)
 I FBCAS'=FBTAS D
"RTN","FBUTL2",149,0)
 . S FBERR=1
"RTN","FBUTL2",150,0)
 . W !,$C(7),"ERROR: Must account for $",$FN(FBTAS-FBCAS,"",2)," more to cover the total amount suspended."
"RTN","FBUTL2",151,0)
 . W !,"   The current sum of adjustments is $",$FN(FBCAS,"",2),"."
"RTN","FBUTL2",152,0)
 . W !,"   The total amount suspended is $",$FN(FBTAS,"",2),"."
"RTN","FBUTL2",153,0)
 I FBCNT>FBMAX D
"RTN","FBUTL2",154,0)
 . S FBERR=1
"RTN","FBUTL2",155,0)
 . W !,$C(7),"ERROR: Maximum number of adjustment reasons (",FBMAX,") have been exceeded."
"RTN","FBUTL2",156,0)
 I FBERR G ASKADJ
"RTN","FBUTL2",157,0)
 ;
"RTN","FBUTL2",158,0)
EXIT ;
"RTN","FBUTL2",159,0)
 ; if time-out or uparrow and total amount not covered then check if
"RTN","FBUTL2",160,0)
 ; exit is allowed by the calling routine. (not allowed during edit)
"RTN","FBUTL2",161,0)
 I FBRET=0,FBNOOUT S FBRET=1 I FBTAS'=FBCAS G VAL
"RTN","FBUTL2",162,0)
 I FBRET=0 K FBADJ
"RTN","FBUTL2",163,0)
 ;
"RTN","FBUTL2",164,0)
 Q FBRET
"RTN","FBUTL2",165,0)
 ;
"RTN","FBUTL2",166,0)
DEL(FBI) ; delete adjustment reason from list
"RTN","FBUTL2",167,0)
 S FBCAS=FBCAS-$P($G(FBADJ(FBI)),U,3)
"RTN","FBUTL2",168,0)
 S FBCNT=FBCNT-1
"RTN","FBUTL2",169,0)
 K FBADJ(FBI)
"RTN","FBUTL2",170,0)
 S FBADJR=""
"RTN","FBUTL2",171,0)
 W "   (reason deleted)"
"RTN","FBUTL2",172,0)
 Q
"RTN","FBUTL2",173,0)
 ;
"RTN","FBUTL2",174,0)
ADJL(FBADJ) ; build list of adjustments extrinsic function
"RTN","FBUTL2",175,0)
 ; Input
"RTN","FBUTL2",176,0)
 ;   FBADJ  - required, array passed by reference
"RTN","FBUTL2",177,0)
 ;            array adjustments
"RTN","FBUTL2",178,0)
 ;            format
"RTN","FBUTL2",179,0)
 ;              FBADJ(#)=FBADJR^FBADJG^FBADJA
"RTN","FBUTL2",180,0)
 ;            where
"RTN","FBUTL2",181,0)
 ;              # = integer number greater than 0
"RTN","FBUTL2",182,0)
 ;              FBADJR = adjustment reason (internal value file 162.91)
"RTN","FBUTL2",183,0)
 ;              FBADJG = adjustment group (inernal value file 162.92)
"RTN","FBUTL2",184,0)
 ;              FBADJA = adjustment amount (dollar value)
"RTN","FBUTL2",185,0)
 ; Result
"RTN","FBUTL2",186,0)
 ;   string containing sorted list (by external reason) of adjustments
"RTN","FBUTL2",187,0)
 ;   format
"RTN","FBUTL2",188,0)
 ;      FBADJRE 1^FBADJGE 1^FBADJAE 1^FBADJRE 2^FBADJGE 2^FBADJAE 2
"RTN","FBUTL2",189,0)
 ;   where
"RTN","FBUTL2",190,0)
 ;      FBADJRE = adjustment reason (external value)
"RTN","FBUTL2",191,0)
 ;      FBADJGE = adjustment group (external value)
"RTN","FBUTL2",192,0)
 ;      FBADJAE = adjustment amount (with cents)
"RTN","FBUTL2",193,0)
 N FBRET
"RTN","FBUTL2",194,0)
 N FBARJR,FBADJRE,FBADJG,FBADJGE,FBADJA,FBADJAE
"RTN","FBUTL2",195,0)
 N FBI,FBADJS
"RTN","FBUTL2",196,0)
 S FBRET=""
"RTN","FBUTL2",197,0)
 ;
"RTN","FBUTL2",198,0)
 ; build sorted array containing external values
"RTN","FBUTL2",199,0)
 S FBI=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D
"RTN","FBUTL2",200,0)
 . ; obtain internal values
"RTN","FBUTL2",201,0)
 . S FBADJR=$P(FBADJ(FBI),U)
"RTN","FBUTL2",202,0)
 . S FBADJG=$P(FBADJ(FBI),U,2)
"RTN","FBUTL2",203,0)
 . S FBADJA=$P(FBADJ(FBI),U,3)
"RTN","FBUTL2",204,0)
 . ; convert to external values
"RTN","FBUTL2",205,0)
 . S FBADJRE=$S(FBADJR:$P($G(^FB(161.91,FBADJR,0)),U),1:"")
"RTN","FBUTL2",206,0)
 . S FBADJGE=$S(FBADJG:$P($G(^FB(161.92,FBADJG,0)),U),1:"")
"RTN","FBUTL2",207,0)
 . S FBADJAE=$FN(FBADJA,"",2)
"RTN","FBUTL2",208,0)
 . ; store in sorted array
"RTN","FBUTL2",209,0)
 . S FBADJS(FBADJRE_U_FBI)=FBADJRE_U_FBADJGE_U_FBADJAE_U
"RTN","FBUTL2",210,0)
 ;
"RTN","FBUTL2",211,0)
 ; build list from sorted array
"RTN","FBUTL2",212,0)
 S FBI="" F  S FBI=$O(FBADJS(FBI)) Q:FBI=""  D
"RTN","FBUTL2",213,0)
 . S FBRET=FBRET_FBADJS(FBI)
"RTN","FBUTL2",214,0)
 ; strip trailing "^" from list
"RTN","FBUTL2",215,0)
 I $E(FBRET,$L(FBRET))="^" S FBRET=$E(FBRET,1,$L(FBRET)-1)
"RTN","FBUTL2",216,0)
 ;
"RTN","FBUTL2",217,0)
 Q FBRET
"RTN","FBUTL2",218,0)
 ;
"RTN","FBUTL2",219,0)
ADJLR(FBADJL) ; build list of adjustment reasons extrinsic function
"RTN","FBUTL2",220,0)
 ; Input
"RTN","FBUTL2",221,0)
 ;   FBADJL - required, string containing sorted list
"RTN","FBUTL2",222,0)
 ;           (by external reason) of adjustments (see $$ADJL result)
"RTN","FBUTL2",223,0)
 ; Result
"RTN","FBUTL2",224,0)
 ;   sting of adjustment reasons delimited by commas
"RTN","FBUTL2",225,0)
 ;
"RTN","FBUTL2",226,0)
 N FBRET,FBADJRE
"RTN","FBUTL2",227,0)
 N FBI
"RTN","FBUTL2",228,0)
 S FBRET=""
"RTN","FBUTL2",229,0)
 F FBI=1:3 S FBADJRE=$P(FBADJL,U,FBI) Q:FBADJRE=""  S FBRET=FBRET_FBADJRE_","
"RTN","FBUTL2",230,0)
 ; strip trailing "," from list
"RTN","FBUTL2",231,0)
 I $E(FBRET,$L(FBRET))="," S FBRET=$E(FBRET,1,$L(FBRET)-1)
"RTN","FBUTL2",232,0)
 ;
"RTN","FBUTL2",233,0)
 Q FBRET
"RTN","FBUTL2",234,0)
 ;
"RTN","FBUTL2",235,0)
ADJLA(FBADJL) ; build list of adjustment amounts extrinsic function
"RTN","FBUTL2",236,0)
 ; Input
"RTN","FBUTL2",237,0)
 ;   FBADJL - required, string containing sorted list
"RTN","FBUTL2",238,0)
 ;           (by external reason) of adjustments (see $$ADJL result)
"RTN","FBUTL2",239,0)
 ; Result
"RTN","FBUTL2",240,0)
 ;   sting of adjustment reasons delimited by commas
"RTN","FBUTL2",241,0)
 ;
"RTN","FBUTL2",242,0)
 N FBRET,FBADJRE
"RTN","FBUTL2",243,0)
 N FBI
"RTN","FBUTL2",244,0)
 S FBRET=""
"RTN","FBUTL2",245,0)
 F FBI=3:3 S FBADJRE=$P(FBADJL,U,FBI) Q:FBADJRE=""  S FBRET=FBRET_FBADJRE_","
"RTN","FBUTL2",246,0)
 ; strip trailing "," from list
"RTN","FBUTL2",247,0)
 I $E(FBRET,$L(FBRET))="," S FBRET=$E(FBRET,1,$L(FBRET)-1)
"RTN","FBUTL2",248,0)
 ;
"RTN","FBUTL2",249,0)
 Q FBRET
"RTN","FBUTL2",250,0)
 ;
"RTN","FBUTL2",251,0)
 ;FBUTL2
"RTN","FBXIP73")
0^^B1259781
"RTN","FBXIP73",1,0)
FBXIP73 ;WOIFO/SS-PATCH INSTALL ROUTINE ;2/9/04
"RTN","FBXIP73",2,0)
 ;;3.5;FEE BASIS;**73**;JAN 30, 1995
"RTN","FBXIP73",3,0)
 ;
"RTN","FBXIP73",4,0)
EN ;post-install
"RTN","FBXIP73",5,0)
 D BMES^XPDUTL("Post-Install Starting")
"RTN","FBXIP73",6,0)
 D BMES^XPDUTL("Re-index of AF cross-references in file #162 Started")
"RTN","FBXIP73",7,0)
 D INDX
"RTN","FBXIP73",8,0)
 D BMES^XPDUTL("Re-index of AF cross-reference in file #162 Complete")
"RTN","FBXIP73",9,0)
 D BMES^XPDUTL("Post-Install Complete")
"RTN","FBXIP73",10,0)
 Q
"RTN","FBXIP73",11,0)
 ;
"RTN","FBXIP73",12,0)
INDX ;post-install entry point
"RTN","FBXIP73",13,0)
 ;reindex "AF" cross-ref for #162.02  field #3 AUTHORIZATION POINTER
"RTN","FBXIP73",14,0)
 N DA,DIK
"RTN","FBXIP73",15,0)
 S DIK(1)="3^AF"
"RTN","FBXIP73",16,0)
 S DA(2)=0
"RTN","FBXIP73",17,0)
 F  S DA(2)=$O(^FBAAC(DA(2))) Q:+DA(2)=0  D
"RTN","FBXIP73",18,0)
 . S DA(1)=0
"RTN","FBXIP73",19,0)
 . F  S DA(1)=$O(^FBAAC(DA(2),1,DA(1))) Q:+DA(1)=0  D
"RTN","FBXIP73",20,0)
 . . S DA=0
"RTN","FBXIP73",21,0)
 . . F  S DA=$O(^FBAAC(DA(2),1,DA(1),1,DA)) Q:+DA=0  D
"RTN","FBXIP73",22,0)
 . . . S DIK="^FBAAC("_DA(2)_",1,"_DA(1)_",1,"
"RTN","FBXIP73",23,0)
 . . . D EN1^DIK
"RTN","FBXIP73",24,0)
 Q
"RTN","FBXIP73E")
0^^B3841102
"RTN","FBXIP73E",1,0)
FBXIP73E ;AISC/JEH - PATCH FB*3.5*73 ENVIRONMENT CHECK
"RTN","FBXIP73E",2,0)
 ;;3.5;Fee Basis;**73**;JAN 30, 1995
"RTN","FBXIP73E",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBXIP73E",4,0)
ENV ;
"RTN","FBXIP73E",5,0)
 ;this is the environment check pre-init routine
"RTN","FBXIP73E",6,0)
 I $$PATCH^XPDUTL("FB*3.5*42") D
"RTN","FBXIP73E",7,0)
 .W !,"You are a test site for a CoreFLS version (patch FB*3.5*42) of Fee Basis"
"RTN","FBXIP73E",8,0)
 .W !,"This patch has a conflict with the FB-CoreFLS test software."
"RTN","FBXIP73E",9,0)
 .W !,"It must NOT be installed unless an accompanying update is made to the"
"RTN","FBXIP73E",10,0)
 .W !,"FB-CoreFLS software immediately after installation of this patch."
"RTN","FBXIP73E",11,0)
 .W !
"RTN","FBXIP73E",12,0)
 .K DIR S DIR(0)="YA"
"RTN","FBXIP73E",13,0)
 .S DIR("A")="Do you have the corresponding update to the FB-CoreFLS software that is associated with this patch? (Note: Entering ""No"" here will stop the installation of this patch) Y/N//"
"RTN","FBXIP73E",14,0)
 .D ^DIR K DIR
"RTN","FBXIP73E",15,0)
 .I $D(DTOUT)!$D(DUOUT)!(Y'=1) W !,"Installation of this patch has been stopped!" S XPDQUIT=2 Q
"RTN","FBXIP73E",16,0)
 .W !,"OK to install!"
"RTN","FBXIP73E",17,0)
 Q
"VER")
8.0^22
**END**
**END**
