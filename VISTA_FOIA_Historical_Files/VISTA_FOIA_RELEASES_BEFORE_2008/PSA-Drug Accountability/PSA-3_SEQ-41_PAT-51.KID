Released PSA*3*51 SEQ #41
Extracted from mail message
**KIDS**:PSA*3.0*51^

**INSTALL NAME**
PSA*3.0*51
"BLD",6002,0)
PSA*3.0*51^DRUG ACCOUNTABILITY^0^3060522^y
"BLD",6002,1,0)
^9.61A^5^5^3060519^^^^
"BLD",6002,1,1,0)
This option gives the user the ability to select and store drugs that are
"BLD",6002,1,2,0)
to be returned to the manufacturer.
"BLD",6002,1,3,0)
 
"BLD",6002,1,4,0)
The OUTDATED MEDICATIONS option is located within the PHARMACY LOCATION
"BLD",6002,1,5,0)
MAINTENANCE menu and locked with the PSAMGR key.
"BLD",6002,6)
5^
"BLD",6002,6.3)
2
"BLD",6002,"KRN",0)
^9.67PA^^
"BLD",6002,"KRN",.4,0)
.4
"BLD",6002,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",6002,"KRN",.401,0)
.401
"BLD",6002,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",6002,"KRN",.402,0)
.402
"BLD",6002,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",6002,"KRN",.403,0)
.403
"BLD",6002,"KRN",.5,0)
.5
"BLD",6002,"KRN",.84,0)
.84
"BLD",6002,"KRN",3.6,0)
3.6
"BLD",6002,"KRN",3.8,0)
3.8
"BLD",6002,"KRN",9.2,0)
9.2
"BLD",6002,"KRN",9.8,0)
9.8
"BLD",6002,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6002,"KRN",9.8,"NM",1,0)
PSAOUT^^0^B52711368
"BLD",6002,"KRN",9.8,"NM","B","PSAOUT",1)

"BLD",6002,"KRN",19,0)
19
"BLD",6002,"KRN",19,"NM",0)
^9.68A^9^9
"BLD",6002,"KRN",19,"NM",1,0)
PSA PV LOCATION MENU^^2
"BLD",6002,"KRN",19,"NM",2,0)
PSA OUTDATED MEDICATIONS^^0
"BLD",6002,"KRN",19,"NM",3,0)
PSA LOCATION EDIT^^0
"BLD",6002,"KRN",19,"NM",4,0)
PSA BALANCE ADJUSTMENTS^^0
"BLD",6002,"KRN",19,"NM",5,0)
PSA BALANCE INITIALIZE^^0
"BLD",6002,"KRN",19,"NM",6,0)
PSA PV DRUG ENTER/EDIT^^0
"BLD",6002,"KRN",19,"NM",7,0)
PSA STOCK AND REORDER LEVELS^^0
"BLD",6002,"KRN",19,"NM",8,0)
PSA TRANSFER DRUGS^^0
"BLD",6002,"KRN",19,"NM",9,0)
PSA MSG RECIPIENTS^^0
"BLD",6002,"KRN",19,"NM","B","PSA BALANCE ADJUSTMENTS",4)

"BLD",6002,"KRN",19,"NM","B","PSA BALANCE INITIALIZE",5)

"BLD",6002,"KRN",19,"NM","B","PSA LOCATION EDIT",3)

"BLD",6002,"KRN",19,"NM","B","PSA MSG RECIPIENTS",9)

"BLD",6002,"KRN",19,"NM","B","PSA OUTDATED MEDICATIONS",2)

"BLD",6002,"KRN",19,"NM","B","PSA PV DRUG ENTER/EDIT",6)

"BLD",6002,"KRN",19,"NM","B","PSA PV LOCATION MENU",1)

"BLD",6002,"KRN",19,"NM","B","PSA STOCK AND REORDER LEVELS",7)

"BLD",6002,"KRN",19,"NM","B","PSA TRANSFER DRUGS",8)

"BLD",6002,"KRN",19.1,0)
19.1
"BLD",6002,"KRN",101,0)
101
"BLD",6002,"KRN",409.61,0)
409.61
"BLD",6002,"KRN",771,0)
771
"BLD",6002,"KRN",869.2,0)
869.2
"BLD",6002,"KRN",870,0)
870
"BLD",6002,"KRN",8994,0)
8994
"BLD",6002,"KRN","B",.4,.4)

"BLD",6002,"KRN","B",.401,.401)

"BLD",6002,"KRN","B",.402,.402)

"BLD",6002,"KRN","B",.403,.403)

"BLD",6002,"KRN","B",.5,.5)

"BLD",6002,"KRN","B",.84,.84)

"BLD",6002,"KRN","B",3.6,3.6)

"BLD",6002,"KRN","B",3.8,3.8)

"BLD",6002,"KRN","B",9.2,9.2)

"BLD",6002,"KRN","B",9.8,9.8)

"BLD",6002,"KRN","B",19,19)

"BLD",6002,"KRN","B",19.1,19.1)

"BLD",6002,"KRN","B",101,101)

"BLD",6002,"KRN","B",409.61,409.61)

"BLD",6002,"KRN","B",771,771)

"BLD",6002,"KRN","B",869.2,869.2)

"BLD",6002,"KRN","B",870,870)

"BLD",6002,"KRN","B",8994,8994)

"BLD",6002,"QUES",0)
^9.62^^
"BLD",6002,"REQG",0)
^9.611^^
"KRN",19,6795,-1)
0^3
"KRN",19,6795,0)
PSA LOCATION EDIT^Set Up/Edit a Pharmacy Location^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,6795,1,0)
^19.06^4^4^3010314^^
"KRN",19,6795,1,1,0)
The Set Up/Edit a Pharmacy Location option creates and edits a pharmacy
"KRN",19,6795,1,2,0)
location. The pharmacy location's name, location type, and drugs can be
"KRN",19,6795,1,3,0)
entered and edited. If it is an Inpatient pharmacy location, wards can be
"KRN",19,6795,1,4,0)
entered and edited.
"KRN",19,6795,15)

"KRN",19,6795,20)

"KRN",19,6795,25)
PSAENT
"KRN",19,6795,"U")
SET UP/EDIT A PHARMACY LOCATIO
"KRN",19,7971,-1)
0^4
"KRN",19,7971,0)
PSA BALANCE ADJUSTMENTS^Balance Adjustments^^R^^PSAMGR^^^^^^DRUG ACCOUNTABILITY
"KRN",19,7971,1,0)
^19.06^2^2^3000607^^^^
"KRN",19,7971,1,1,0)
The Balance Adjustments option reviews or enters adjustments to correct
"KRN",19,7971,1,2,0)
the balance of a drug.
"KRN",19,7971,25)
PSADJ
"KRN",19,7971,99)
55768,51136
"KRN",19,7971,"U")
BALANCE ADJUSTMENTS
"KRN",19,7975,-1)
0^5
"KRN",19,7975,0)
PSA BALANCE INITIALIZE^Balance Initialization^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,7975,1,0)
^^2^2^2970507^^
"KRN",19,7975,1,1,0)
The Balance Initialization option establishes the balance for any drugs
"KRN",19,7975,1,2,0)
that do not yet have a balance.
"KRN",19,7975,25)
PSADJI
"KRN",19,7975,"U")
BALANCE INITIALIZATION
"KRN",19,10592,-1)
0^7
"KRN",19,10592,0)
PSA STOCK AND REORDER LEVELS^Enter/Edit Stock and Reorder Levels^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,10592,1,0)
^19.06^5^5^3010108^^
"KRN",19,10592,1,1,0)
The Enter/Edit Stock and Reorder Levels option flags a pharmacy location
"KRN",19,10592,1,2,0)
or master vault to maintain the stock and reorder levels or removes the
"KRN",19,10592,1,3,0)
flag. It also allows the user to enter the stock and reorder levels. These
"KRN",19,10592,1,4,0)
levels are used to determine the number of dispense units that need to be
"KRN",19,10592,1,5,0)
ordered.
"KRN",19,10592,25)
PSALEVEL
"KRN",19,10592,"U")
ENTER/EDIT STOCK AND REORDER L
"KRN",19,10598,-1)
2^1
"KRN",19,10598,0)
PSA PV LOCATION MENU^Pharmacy Location Maintenance Menu^^M^10000000006^^^^^^^287^^1^1
"KRN",19,10598,10,0)
^19.01IP^8^8
"KRN",19,10598,10,1,0)
6795^1^10
"KRN",19,10598,10,1,"^")
PSA LOCATION EDIT
"KRN",19,10598,10,2,0)
7975^3^30
"KRN",19,10598,10,2,"^")
PSA BALANCE INITIALIZE
"KRN",19,10598,10,3,0)
7971^2^20
"KRN",19,10598,10,3,"^")
PSA BALANCE ADJUSTMENTS
"KRN",19,10598,10,4,0)
10602^4^40
"KRN",19,10598,10,4,"^")
PSA PV DRUG ENTER/EDIT
"KRN",19,10598,10,5,0)
10592^5^50
"KRN",19,10598,10,5,"^")
PSA STOCK AND REORDER LEVELS
"KRN",19,10598,10,6,0)
10603^6^60
"KRN",19,10598,10,6,"^")
PSA TRANSFER DRUGS
"KRN",19,10598,10,7,0)
12072^7^70
"KRN",19,10598,10,7,"^")
PSA MSG RECIPIENTS
"KRN",19,10598,10,8,0)
13131^8^80
"KRN",19,10598,10,8,"^")
PSA OUTDATED MEDICATIONS
"KRN",19,10598,"U")
PHARMACY LOCATION MAINTENANCE 
"KRN",19,10602,-1)
0^6
"KRN",19,10602,0)
PSA PV DRUG ENTER/EDIT^Enter/Edit a Drug^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,10602,1,0)
^19.06^4^4^3001004^^^
"KRN",19,10602,1,1,0)
The Enter/Edit a Drug option adds a new drug to the pharmacy location. If
"KRN",19,10602,1,2,0)
the drug is being added to the location and the location maintains stock
"KRN",19,10602,1,3,0)
and reorder levels, it prompts for the stock and reorder levels. It also
"KRN",19,10602,1,4,0)
displays the balance of an existing drug.
"KRN",19,10602,25)
PSADRUGP
"KRN",19,10602,"U")
ENTER/EDIT A DRUG
"KRN",19,10603,-1)
0^8
"KRN",19,10603,0)
PSA TRANSFER DRUGS^Transfer Drugs Between Pharmacies^^R^^PSAMGR^^^^^^DRUG ACCOUNTABILITY
"KRN",19,10603,1,0)
^^5^5^2970812^
"KRN",19,10603,1,1,0)
The Transfer Drugs Between Pharmacies option allows a pharmacist to move
"KRN",19,10603,1,2,0)
drugs between pharmacy locations. The number of dispense units to be moved
"KRN",19,10603,1,3,0)
is subtracted from the dispensing pharmacy location and added to the
"KRN",19,10603,1,4,0)
receiving pharmacy location. A Transfer Signature Sheet may be printed
"KRN",19,10603,1,5,0)
after all transfers are completed.
"KRN",19,10603,25)
PSATRAN
"KRN",19,10603,"U")
TRANSFER DRUGS BETWEEN PHARMAC
"KRN",19,12072,-1)
0^9
"KRN",19,12072,0)
PSA MSG RECIPIENTS^Setup Mail Message Recipients^^R^^PSAMGR^^^^^^
"KRN",19,12072,1,0)
^^3^3^3010215^
"KRN",19,12072,1,1,0)
 This option is used to enter/delete personnel from the two mail groups
"KRN",19,12072,1,2,0)
 used for notifying personnel of a change in NDC and/or Drug Price, and
"KRN",19,12072,1,3,0)
 when drugs are below reorder levels.
"KRN",19,12072,25)
PSA10^PSALOCO
"KRN",19,12072,"U")
SETUP MAIL MESSAGE RECIPIENTS
"KRN",19,13131,-1)
0^2
"KRN",19,13131,0)
PSA OUTDATED MEDICATIONS^Outdated Medications^^R^^PSAMGR^^^^^^DRUG ACCOUNTABILITY
"KRN",19,13131,1,0)
^19.06^2^2^3060519^^^
"KRN",19,13131,1,1,0)
This option gives the user the ability to select and store drugs that are
"KRN",19,13131,1,2,0)
to be returned to the manufacturer.
"KRN",19,13131,25)
PSAOUT
"KRN",19,13131,"U")
OUTDATED MEDICATIONS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",287,-1)
1^1
"PKG",287,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability Inventory and Tracking module.
"PKG",287,22,0)
^9.49I^1^1
"PKG",287,22,1,0)
3.0^2971024^2971030^11595
"PKG",287,22,1,"PAH",1,0)
51^3060522^11850
"PKG",287,22,1,"PAH",1,1,0)
^^5^5^3060522
"PKG",287,22,1,"PAH",1,1,1,0)
This option gives the user the ability to select and store drugs that are
"PKG",287,22,1,"PAH",1,1,2,0)
to be returned to the manufacturer.
"PKG",287,22,1,"PAH",1,1,3,0)
 
"PKG",287,22,1,"PAH",1,1,4,0)
The OUTDATED MEDICATIONS option is located within the PHARMACY LOCATION
"PKG",287,22,1,"PAH",1,1,5,0)
MAINTENANCE menu and locked with the PSAMGR key.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSAOUT")
0^1^B52711368
"RTN","PSAOUT",1,0)
PSAOUT ;BHM/DB - Return Drugs to Manufacturer ;23 FEB 04
"RTN","PSAOUT",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**51**; 10/24/97;Build 2
"RTN","PSAOUT",3,0)
 ;References to ^PSDRUG( are covered by IA #2095
"RTN","PSAOUT",4,0)
 ;References to ^DIC(51.5 are covered by DBIA # 1931
"RTN","PSAOUT",5,0)
 ;References to ^PSRX( are covered by DBIA # 254
"RTN","PSAOUT",6,0)
 ;References to ^PSD(58.86 are covered by DBIA # 4472
"RTN","PSAOUT",7,0)
 S PSACNT=0
"RTN","PSAOUT",8,0)
 D Q
"RTN","PSAOUT",9,0)
 K DIR S DIR(0)="S^1:Print Report;2:Enter drugs Return to Manufacturer" D ^DIR K DIR G Q:$D(DIRUT) I +Y=1 G RPT
"RTN","PSAOUT",10,0)
 S (PSALOC,PSANUM)=0 F  S PSALOC=+$O(^PSD(58.8,"ADISP","P",PSALOC)) Q:PSALOC'>0  S PSALOCN=PSALOC
"RTN","PSAOUT",11,0)
1 ;Select Drug
"RTN","PSAOUT",12,0)
 R !!,"Scan Drug barcode or enter a drug name : ",AN:DTIME S PSACNT=$G(PSACNT)+1 G DONE:AN["^" G DONE:AN="" I AN=" " W "??" G 1
"RTN","PSAOUT",13,0)
 I $D(^PSDRUG("NDC",AN)) S PSADRG=$O(^PSDRUG("NDC",AN,0)) G FOUND
"RTN","PSAOUT",14,0)
 I $D(^PSDRUG("C",AN)) S PSADRG=$O(^PSDRUG("C",AN,0)) G FOUND
"RTN","PSAOUT",15,0)
 I AN?.AN,$D(^PSDRUG(AN,0)) S PSADRG=AN G FOUND
"RTN","PSAOUT",16,0)
 I AN["-",$P(AN,"-",3)'="" S PSANDC=$P(AN,"-")_$P(AN,"-",2)_$P(AN,"-",3) I $D(^PSDRUG("NDC",PSANDC)) S PSADRG=$O(^PSDRUG("NDC",PSANDC,0)) G FOUND
"RTN","PSAOUT",17,0)
 I AN["-",$P(AN,"-",3)="" S PSARX=$P(AN,"-",2),PSADRG=$P($G(^PSRX(PSARX,0)),"^",6) I $G(PSADRG)>0 G FOUND
"RTN","PSAOUT",18,0)
 I AN?.AE S X=AN,DIC(0)="QEZ",DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$P($G(^(2)),""^"",3)'[""N""",DIC="^PSDRUG(" D ^DIC K DIC G:+Y'>0 NONDRUG S PSADRG=+Y G FOUND
"RTN","PSAOUT",19,0)
 W !!,"Sorry, I could not find a match. Please enter the drug name.",!! G FM
"RTN","PSAOUT",20,0)
FOUND ;Might have match
"RTN","PSAOUT",21,0)
 S PSADRUGN=$P($G(^PSDRUG(PSADRG,0)),"^") W " ",$G(PSADRUGN) S DIC("B")=PSADRUGN
"RTN","PSAOUT",22,0)
 I $P($G(^PSDRUG(PSADRG,2)),"^",3)["N" W !!,"Sorry, Controlled Substances cannot be selected through this option." K PSADRG,PSADRUGN,X,AN G 1
"RTN","PSAOUT",23,0)
OK K DIR S DIR("A")="Is this correct",DIR(0)="Y",DIR("B")="YES" D ^DIR G DONE:$D(DIRUT)
"RTN","PSAOUT",24,0)
 I +Y>0 G PROCEED
"RTN","PSAOUT",25,0)
FM ;Fileman search
"RTN","PSAOUT",26,0)
 S DIC(0)="AEQMZ",DIC("A")="Select Drug : ",DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0),$P($G(^(2)),""^"",3)'[""N""",DIC="^PSDRUG(" D ^DIC G DONE:+Y'>0 S PSADRG=+Y K DIC G FOUND
"RTN","PSAOUT",27,0)
PROCEED ;On to the next series of questions
"RTN","PSAOUT",28,0)
CON K DIR S DIR(0)="N",DIR("A")="Number of containers " D ^DIR K DIR S PSACON=+Y I $D(DIRUT) G DONE
"RTN","PSAOUT",29,0)
 K PSAOU
"RTN","PSAOUT",30,0)
 S PSAOU=$P($G(^PSDRUG(PSADRG,"660")),"^",2) I $G(PSAOU)>0 S PSAOU(1)=$P(^DIC(51.5,PSAOU,0),"^")
"RTN","PSAOUT",31,0)
 S PSAPDUOU=$P($G(^PSDRUG(PSADRG,660)),"^",6)
"RTN","PSAOUT",32,0)
QTY K DIR S DIR(0)="N",DIR("A")="Number of Dispense units being returned: " D ^DIR G DONE:$D(DIRUT)>0 S PSAQTY=Y
"RTN","PSAOUT",33,0)
OU K DIC,Y,X S DIC(0)="QAEMZ",DIC="^DIC(51.5,",DIC("A")="Package type: ",DR=.01 S:$G(PSAOU(1))'="" DIC("B")=PSAOU(1) D ^DIC K DIC I +Y<0 G DONE
"RTN","PSAOUT",34,0)
 S PSAOU(1)=Y(0)
"RTN","PSAOUT",35,0)
 K DIR S DIR("A")="Is it ok to file the data entered",DIR(0)="Y",DIR("B")="YES" D ^DIR K DIR G Q:$D(DIRUT) I Y'>0 W !,"ok, try again,",! G CON
"RTN","PSAOUT",36,0)
 W !,"Updating Destruction holding file."
"RTN","PSAOUT",37,0)
 F  L +^PSD(58.86,0):0 I  Q
"RTN","PSAOUT",38,0)
FIND S PSAHLD=$P(^PSD(58.86,0),"^",3)+1 I $D(^PSD(58.86,PSAHLD)) S $P(^PSD(58.86,0),"^",3)=PSAHLD G FIND
"RTN","PSAOUT",39,0)
 D NOW^%DTC S PSADT=%
"RTN","PSAOUT",40,0)
 K DA,DIC,DLAYGO S (DIC,DLAYGO)=58.86,DIC(0)="L",(X,DINUM)=PSAHLD D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSAOUT",41,0)
 L -^PSD(58.86,0)
"RTN","PSAOUT",42,0)
 W !,"Updating Drug Accountability Transaction file."
"RTN","PSAOUT",43,0)
PSTRAN S PSAIEN=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSAIEN)) S $P(^PSD(58.81,0),"^",3)=PSAIEN G PSTRAN
"RTN","PSAOUT",44,0)
 S DIC="^PSD(58.81,",DIC(0)="L",DLAYG0=58.81,(DINUM,X)=PSAIEN D ^DIC K DIC,DLAYGO
"RTN","PSAOUT",45,0)
 S DIE="^PSD(58.81,",DA=PSAIEN,DR="1////^S X=10;3////^S X=PSADT;4////^S X=PSADRG;6////^S X=DUZ;47////^S X=PSAHLD" D ^DIE
"RTN","PSAOUT",46,0)
UPDT K DA,DIE,DR S DIE=58.86,DA=PSAHLD,DR="1////"_+PSADRG_";2////"_PSAQTY_";11////"_PSACON_";12////"_$P(PSAOU(1),U,1)_";9///^S X=DUZ;10////^S X=PSADT;6////^S X=PSALOCN;19////^S X=$G(PSAPDUOU)"
"RTN","PSAOUT",47,0)
 I +PSADRG=99999999 S ^PSD(58.86,DA,1)=PSADRUGN
"RTN","PSAOUT",48,0)
 D ^DIE K DIE,DA,DR S ^PSD(58.86,PSAHLD,2)="Returned to Manufacturer"
"RTN","PSAOUT",49,0)
 S ^XTMP("PSA",$J,PSACNT)=PSADRG_"^"_PSAQTY_"^"_PSAOU_"^"_PSACON
"RTN","PSAOUT",50,0)
 W !!!!!!! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y G DONE
"RTN","PSAOUT",51,0)
 G 1
"RTN","PSAOUT",52,0)
DONE I $G(PSACNT)'>0 G Q
"RTN","PSAOUT",53,0)
 K DIR S DIR("A")="Would you like to print the returns report ",DIR(0)="Y",DIR("B")="YES" D ^DIR G Q:$D(DIRUT)>0 I Y'>0 G Q
"RTN","PSAOUT",54,0)
RPT ;print report
"RTN","PSAOUT",55,0)
 W !,"If you are returning the items to the manufacturer at this time, the program",!,"will add today's date to the item to show when it was actually returned.",!
"RTN","PSAOUT",56,0)
 K DIR S DIR("A")="Are you returning items to the manufacturer at this time",DIR(0)="Y",DIR("B")="YES" D ^DIR G Q:$D(DIRUT)>0 I Y>0 S PSARET=1
"RTN","PSAOUT",57,0)
 D NOW^%DTC S X1=X,X2=-90 D C^%DTC S Y=X D DD^%DT S %DT("B")=Y
"RTN","PSAOUT",58,0)
BGNDT S %DT="AEP",%DT("A")="Beginning Date: " D ^%DT I +Y<1!($D(DTOUT))!(X["^")!(X']"") G Q
"RTN","PSAOUT",59,0)
 S PSABEG=+Y
"RTN","PSAOUT",60,0)
ENDDT D NOW^%DTC S Y=+% D DD^%DT S %DT("B")=$P(Y,"@"),%DT="AE",%DT("A")="Ending Date   : " D ^%DT I +Y<1!($D(DTOUT))!(X["^")!(X']"") S PSAOUT=1 G Q
"RTN","PSAOUT",61,0)
 I Y<PSABEG W !!,"Ending Date cannot be before the Start Date." G ENDDT
"RTN","PSAOUT",62,0)
 S PSAEND=+Y
"RTN","PSAOUT",63,0)
 K IO("Q") S %ZIS="Q" W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED.",! G Q
"RTN","PSAOUT",64,0)
 I $D(IO("Q")) K ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSAOUT",ZTDTH=$H,ZTDESC="PSA OUTDATED REPORT" F X="PSARET","PSABEG","PSAEND" S ZTSAVE(X)=""
"RTN","PSAOUT",65,0)
 I  D ^%ZTLOAD,HOME^%ZIS G Q
"RTN","PSAOUT",66,0)
 U IO
"RTN","PSAOUT",67,0)
START ;
"RTN","PSAOUT",68,0)
 K ^XTMP("PSA",$J) S PG=0
"RTN","PSAOUT",69,0)
 S Y=PSABEG,PSADT=PSABEG-.1 D DD^%DT S PSABEG(1)=Y
"RTN","PSAOUT",70,0)
 S Y=PSAEND D DD^%DT S PSAEND(1)=Y,PSAEND=PSAEND+.999999
"RTN","PSAOUT",71,0)
 D NOW^%DTC S PSARETD=$P(%,"."),^XTMP("PSA",$J,0)=PSARETD_"^"_PSARETD,Y=PSARETD
"RTN","PSAOUT",72,0)
 D DD^%DT S PSARETD=Y K Y
"RTN","PSAOUT",73,0)
LOOP ;Loop through "AC" xref
"RTN","PSAOUT",74,0)
 ;^PSD(58.86,"AC",DATE/TIME DESTROYED,DISPENSING SITE,DRUG,DA)=""
"RTN","PSAOUT",75,0)
 S PSADT=$O(^PSD(58.86,"AC",PSADT)) G BEGIN:PSADT'>0 G BEGIN:PSADT>PSAEND
"RTN","PSAOUT",76,0)
 S PSALOC1=0
"RTN","PSAOUT",77,0)
LOC S PSALOC1=$O(^PSD(58.86,"AC",PSADT,PSALOC1)) G LOOP:PSALOC1'>0 G LOOP:PSALOC1'>0 S PSADRG=0
"RTN","PSAOUT",78,0)
DRG S PSADRG=$O(^PSD(58.86,"AC",PSADT,PSALOC1,PSADRG)) G LOC:PSADRG'>0 S PSAIEN=0
"RTN","PSAOUT",79,0)
IEN S PSAIEN=$O(^PSD(58.86,"AC",PSADT,PSALOC1,PSADRG,PSAIEN)) G DRG:PSAIEN'>0
"RTN","PSAOUT",80,0)
 S PSADATA=$G(^PSD(58.86,PSAIEN,0)),PSADATA2=$G(^PSD(58.86,PSAIEN,2))
"RTN","PSAOUT",81,0)
 I $E(PSADATA2,1,3)'="Ret" G IEN
"RTN","PSAOUT",82,0)
 F X=1:1:14 S PSA(X)=$P(PSADATA,"^",X)
"RTN","PSAOUT",83,0)
 I $G(PSA(2))=99999999 S PSA(2)=$G(^PSD(58.86,PSAIEN,1))
"RTN","PSAOUT",84,0)
 S ^XTMP("PSA",$J,PSA(1))=PSA(8)_"^"_PSA(2)_"^"_PSA(3)_"^"_PSA(10)_"^"_PSA(9)_"^"_PSADT_"^"_$G(^PSD(58.86,PSAIEN,2))_"^"_PSA(12)_"^"_PSA(14)
"RTN","PSAOUT",85,0)
 I $G(PSARET)=1,$G(^PSD(58.86,PSAIEN,2))'["on" S ^PSD(58.86,PSAIEN,2)=^PSD(58.86,PSAIEN,2)_" on "_PSARETD
"RTN","PSAOUT",86,0)
 G IEN
"RTN","PSAOUT",87,0)
PRINT ;Print data
"RTN","PSAOUT",88,0)
 S PG=$G(PG)+1 W @IOF,!!!,?25,"Items to be Returned Report",?70,"Page : ",$G(PG),!,?24,PSABEG(1)," thru ",PSAEND(1),!,"Printed on: ",PSADT(1),?50,"Printed by: ",$P($G(^VA(200,DUZ,0)),"^"),! F X=1:1:((IOM/2)-2) W "- "
"RTN","PSAOUT",89,0)
 W !,?50,"Total Dispense"
"RTN","PSAOUT",90,0)
 W !,"Drug Name",?30,"Containers",?50,"Units / Cost",?66,"Entered by",! F X=1:1:(IOM-1) W "-"
"RTN","PSAOUT",91,0)
 Q
"RTN","PSAOUT",92,0)
BEGIN S PSAIEN=0 D NOW^%DTC S Y=+% D DD^%DT S PSADT(1)=Y D PRINT
"RTN","PSAOUT",93,0)
PNT1 S PSAIEN=$O(^XTMP("PSA",$J,PSAIEN)) G EORPT:PSAIEN'>0 S PSADATA=^XTMP("PSA",$J,PSAIEN),PSADRUGN=$P(PSADATA,"^",2)
"RTN","PSAOUT",94,0)
 W !,$S('$D(^PSDRUG(PSADRUGN,0)):PSADRUGN,1:$P(^PSDRUG(PSADRUGN,0),"^")) I $L(PSADRUGN)>37 W !
"RTN","PSAOUT",95,0)
 W ?38,$J($P(PSADATA,"^",1),2)," (",$P(PSADATA,"^",8),")",?50,$J($P(PSADATA,"^",3),3)
"RTN","PSAOUT",96,0)
 I $P(PSADATA,"^",9)]"",$P(PSADATA,"^",1)]"" W ?55,$J(($P(PSADATA,"^",1)*$P(PSADATA,"^",9)),5,2)
"RTN","PSAOUT",97,0)
 S PSANAME=$S($P(PSADATA,"^",4)']"":"",1:$P($G(^VA(200,$P(PSADATA,"^",4),0)),"^")) I PSANAME'="" S PSANM1=$P(PSANAME,",",1),PSANM2=$P(PSANAME,",",2),PSANAME=$E(PSANM2,1)_$E(PSANM1,1)
"RTN","PSAOUT",98,0)
 W ?64,PSANAME S DATA=$P(PSADATA,"^",6),X2=$E(DATA,1,3)+1700 W " (",$E(DATA,4,5),"/",$E(DATA,6,7),"/",$E(X2,3,4),")"
"RTN","PSAOUT",99,0)
 I $Y>(IOSL-5) D HDR G Q:$G(PSAOUT)=1
"RTN","PSAOUT",100,0)
 G PNT1
"RTN","PSAOUT",101,0)
EORPT W !!,"End of report" D ^%ZISC
"RTN","PSAOUT",102,0)
Q K AN,DA,DATA,DIC,DIR,DIE,DIRUT,DLAYG0,DR,PG,PSA,PSABEG,PSACNT,PSACON,PSADATA,PSADATA2,PSADRG
"RTN","PSAOUT",103,0)
 K PSADRUGN,PSADT,PSAEND,PSAHLD,PSAIEN,PSALOC,PSALOC1,PSALOCN,PSANAME,PSANDC,PSANM1,PSANM2,PSANUM,PSAOU
"RTN","PSAOUT",104,0)
 K PSAPDUOU,PSAOUT,PSAQTY,PSARET,PSARETD,PSARX,X,X1,X2,Y,^XTMP("PSA",$J) Q
"RTN","PSAOUT",105,0)
NONDRUG W !,"The item could not be found in the drug file.",!
"RTN","PSAOUT",106,0)
 K DIR S DIR("A")="Is this a non-va drug",DIR(0)="Y",DIR("B")="NO" D ^DIR K DIR G Q:$D(DIRUT)=1
"RTN","PSAOUT",107,0)
 I +Y'>0 G FM
"RTN","PSAOUT",108,0)
 S PSADRG=99999999,PSADRUGN=AN
"RTN","PSAOUT",109,0)
ASKD W !,PSADRUGN," //" R AN:DTIME I AN="" G CON
"RTN","PSAOUT",110,0)
 G Q:AN["^" S PSADRUGN=AN W " ok, press ENTER to confirm.",! G ASKD
"RTN","PSAOUT",111,0)
HDR I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAOUT",112,0)
 D PRINT Q
"VER")
8.0^22.0
"BLD",6002,6)
^41
**END**
**END**
