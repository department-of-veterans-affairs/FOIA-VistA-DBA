$TXT Created by KOPECKY,STEVE at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Thursday, 07/10/03 at 09:52
=============================================================================
Run Date: AUG 15, 2003                     Designation: EAS*1*28
Package : EAS - ENROLLMENT APPLICATION SYSTEM Priority: Mandatory
Version : 1        SEQ #31                      Status: Released
                  Compliance Date: SEP 15, 2003
=============================================================================

Associated patches: (v)EAS*1*13    <<= must be installed BEFORE `EAS*1*28'
                    (v)EAS*1*29    <<= must be installed BEFORE `EAS*1*28'

Subject: CHANGE LOCATION OF LAST 4 ON LETTERS

Category: 
  - Routine

Description:
============

 This patch addresses several modifications to the Enrollment Application 
 System and the EAS Means Test Letters.  First, the printing location of 
 the last four of a patient's SSN on the means test letters is moved from
 the address line to the upper right hand corner of the letter, out of the
 address display in a windowed envelope.  Second, the sequence of prompts 
 for the means test letter reprinting is also modified, enabling a more 
 intuitive date selection for the reprinting of the different types of 
 letters.  Finally, the Means Test Signature Summary Report is modified so 
 that the numbers it reports are in line with the numbers reported by the 
 Means Test Signature Detail Report.  Prior to this patch, the detailed 
 report looked at all facilities, while the summary report looked at only 
 the primary facility.
  
  
 This patch addresses the following E3R(s):
 ------------------------------------------
 There are no E3R messages associated with this patch
  
  
 This patch addresses the following NOIS message(s):
 ---------------------------------------------------
 DAN-0603-40246, LAST FOUR OF SSN
 STX-0503-71718, UNABLE TO REPRINT 30-DAY LETTERS
 MAC-0403-62098, MEANS TEST SIGNATURE REPORTS
  
  
 Overview of NOIS Message(s):
 ---------------------------
 DAN-0603-40246
 The last four numbers of the patient's social security number is 
 currently printed after the patient's name.  If a windowed envelope is 
 used for mailing, this information becomes visible.  The site feels this 
 is inconsistent with the new HIPPA requirements and has been manually 
 blacking out the patients last four.  
  
 This patch will move the printing of the patients last four to the upper 
 right hand corner of the letter where it will not be visible in a 
 windowed envelope.
  
  
 STX-0503-71718 
 The site is reporting that when they use the Reprint Letters by 
 Processing Date option to reprint 30-day letters, they are getting 60-day 
 letters instead.  Review has shown that 30-day letters are in fact 
 printing out; the actual issue is in the selection of the appropriate 
 processing date to get the 30-day letter.  The processing date is the 
 date the letter search was run and in most circumstances is the date the 
 60-day letter would have printed.  For example, if the user selected a 
 processing date of June 25 thinking that all 30-day letters for June 25th 
 would print, they would get the "30-day" letter printed, but the means 
 test anniversary date would be for August 25th, not July 25th, causing 
 them to believe that a 60-day letter was printed.
  
 This patch modifies the prompts provided and will use the type of letter 
 selected and the user provided date to determine the "best" processing 
 date to select in order to print the desired letter and date.  Additional 
 "up-front" information is also now displayed to the user prior to 
 printing the letters. Finally, the reprint option will now check the 
 threshold date for printing the letters as the current print option 
 does.  If the correct threshold date for the type of letter being 
 reprinted has not been reached, the letter will not print as it currently 
 does.
  
  
 MAC-0403-62098
 There is some confusion at the site over the different numbers being 
 reported by the Means Test Signature Detail Report and the Means Test 
 Signature Summary Report for the same period.  Analysis by NVS indicated 
 the difference to be in the way the summary report checks the SITE 
 CONDUCTING TEST Field, #2.05, against the site number returned by the 
 SITE^VASITE function.  Currently, an exact match must occur for the entry 
 to be included in the report otherwise it is ignored, whereas the detail 
 report makes no distinction.  If the site number is "500" and the SITE 
 CONDUCTING TEST field is "500GE", the summary report does not consider 
 this a match.
  
 This patch modifies the site check to return only the numeric portion of 
 the site number when the comparison is made.  i.e. "500GE" will become 
 "500" and will now match with the "500" returned by the VASITE API.
  
  
 Test Sites:
 -----------
 Danville VAMC
 No. California HCS
 S. Texas VHCS 
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
 If installed during the normal workday, it is recommended that the 
 following menu options (File #19) be disabled to prevent possible 
 conflicts while running the KIDS Install. Other VISTA users will not be 
 affected.
  
         Means Test Signature Detail Report 
         Means Test Signature Summary Report
         Letters Print Menu
         Background print job for EAS MT Letters
  
 Install Time - 5 minutes
  
  
   1.   LOAD TRANSPORT GLOBAL 
        ---------------------
        Choose the PackMan message containing this patch and invoke the 
        INSTALL/CHECK MESSAGE PackMan option.  
              
   2.   DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only) 
        -----------------------
        Disable routine mapping on all systems for the routines listed in 
        step 3 below.  
       
        NOTE:  If the routines included in this patch are not currently in 
               your mapped routine set, please skip this step.
   
   3.   COMPONENTS SENT WITH PATCH 
        ------------------------
        The following is a list of the routine(s) included in this patch.
        The second line of each of these routine(s) will look like:
  
     <tab>;;1.0;ENROLLMENT APPLICATION SYSTEM;**[patch list]**;Mar 15, 2001
  
                            CHECK^XTSUMBLD results
   Routine name      Before Patch          After Patch         Patch List
   ============      ============          ===========         ==========
   EASMTL10               7560794             11846761           3,15,28
   EASMTL6A               6003514              6024675        3,14,15,29,28
   EASSIGOV               7612214              7609579          4,8,13,28  
  
         Total number of routines - 3 ****
   
  
   4.   START UP KIDS 
        -------------
        Start up the Kernel Installation and Distribution System Menu 
        [XPD MAIN]: 
    
             Edits and Distribution ...  
             Utilities ...  
             Installation ...  
    
   Select Kernel Installation & Distribution System Option: INStallation 
                                                            ---
             Load a Distribution 
             Print Transport Global 
             Compare Transport Global to Current System 
             Verify Checksums in Transport Global 
             Install Package(s) 
             Restart Install of Package(s) 
             Unload a Distribution 
             Backup a Transport Global 
    
   Select Installation Option: 
    
   5.   Select Installation Option: 
        --------------------------
        NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
               NAME, enter EAS*1.0*28):
       
        a.  Backup a Transport Global - This option will create a backup
            message of any routines exported with this patch. It will not
            backup any other changes such as DD's or templates.
        b.  Compare Transport Global to Current System - This option will
            allow you to view all changes that will be made when this
            patch is installed.  It compares all components of this patch
            (routines, DD's, templates, etc.).
        c.  Verify Checksums in Transport Global - This option will allow
            you to ensure the integrity of the routines that are in the
            transport global.
      
   6.   Select Installation Option: Install Package(s) 
                                    ----------------
        **This is the step to start the installation of this KIDS patch: 
    
      a.  Choose the Install Package(s) option to start the patch install.
      b   When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
          YES//' answer NO
      c.  When prompted 'Want to DISABLE Scheduled Options, Menu 
          Options, and Protocols? YES//' answer YES
      d.  When prompted 'Enter options you wish to mark as 'Out Of
          Order':'  Enter the following options:
   
          Letters Print Menu              [EAS MT PRINT MENU]       
          Means Test Signature Detail Report  [EAS MEANS TEST SIG DET
                                               RPT]     
          Means Test Signature Summary Report [EAS MEANS TEST SIG SUM
                                               RPT]
          Background print job for EAS MT Letters  [EAS MT LETTERS BG 
                                                    PRINT]
  
   7.    REBUILD MAPPED ROUTINE(S)  (DSM for Open VMS sites only)
        -------------------------
        Optional - Include the routines distributed with this patch
        in the mapped routine set.
      
        NOTE: This step is only necessary if you performed step 2 or 
              if you wish to include the routines in your mapped set.

Routine Information:
====================

Routine Name:
  - EASMTL6A

 Before
 -------
  
  26        E  D
  27        . W !!?TAB+OFFSET,"VA MEDICAL CENTER"
  28        ;
  29        W !?TAB+OFFSET,EASFAC(1.01)
  
  38        E  D
  39        . W !!!!?TAB+OFFSET,"TEST LETTER (DO NOT MAIL!)"
  40        W "  (",EASDEM(2),")" ;; Patch 15
  
  90        I DFN<0 D  Q
  91        . S EASDEM(2)="6789"
  
  
 After
 ------
  
  26        E  D
  27        . W !!?TAB+OFFSET,"VA MEDICAL CENTER"
  28        W ?(IOM-10),$E(EASDEM(1),1,1),EASDEM(2)
  29        ;
  30        W !?TAB+OFFSET,EASFAC(1.01)
  
  39        E  D
  40        . W !!!!?TAB+OFFSET,EASDEM(1)
  
  90        I DFN<0 D  Q
  91        . S EASDEM(1)="TEST LETTER (DO NOT MAIL!)"
  92        . S EASDEM(2)="6789"

Routine Checksum:

Routine Name:
  - EASMTL10

 Before
 ======
  
   2        ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,15**;Mar 15, 2001
  
   4 RERUN  ;  Main entry point to rerun a processing date
   5        N EASDDD,DIR,DIRUT,EATYP,ZTSAVE,EASLOC,EASKIP,EASLOC,EASIEN,EASX
   6        ;
   7        S EASLOC=-1
   8        I $$GET1^DIQ(713,1,8,"I") D  Q:$D(DIRUT)
   9        . S DIR(0)="YAO",DIR("A")="Filter letters by Preferred Facility? "
  10        . S DIR("B")="NO"
  11        . S DIR("?")="Enter 'YES' to limit letters to a specific Facility or 'NO' to print all letters"
  12        . D ^DIR K DIR
  13        . Q:$D(DIRUT)!('Y)
  14        . S DIR(0)="P^EAS(713,1,2,:QEM"
  15        . S EASLOC=$$FACNUM^EASMTL6
  16        E  D
  17        . S EASLOC=0
  18        ;
  19        D LIST^EASMTL10 ; Display available processing dates
  20 ASKDT  ; Ask for processing date to look for letters
  21        S DIR(0)="DAO^:DT:EP"
  22        S DIR("?")="^D LIST^EASMTL10"
  23        S DIR("?",1)="Select Processing Date:"
  24        S DIR("A",1)=""
  25        S DIR("A")="Enter processing date to re-run letters: "
  26        D ^DIR K DIR
  27        Q:$D(DIRUT)
  28        I '$D(^EAS(713.2,"AD",+Y)) D  G ASKDT
  29        . W !!?5,$CHAR(7),"There are no entries with this processing date, type '?' for list.",!
  30        S EASDDD=+Y
  31        Q:'EASDDD
  32        ;
  33 TYPE   ;  Ask for a specific type of letter to print
  34        S DIR(0)="SO^1:60-Day;2:30-Day;4:0-Day"
  35        S DIR("A")="Select letter type",DIR("A",1)=""
  36        S DIR("?")="Select the type of letter to re-print "
  37        D ^DIR K DIR
  38        Q:$D(DIRUT)
  39        S EATYP=+Y
  
 102        . I +$G(EASLOC)>0 Q:$$GET1^DIQ(2,DFN,27.02,"I")'=+EASLOC
 103        . Q:$D(^EAS(713.2,"AC",1,EASIEN))  ; Quit if MT has been returned
  
  
 After
 =====
  
   2        ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,15,28**;Mar 15, 2001
  
   4 RERUN  ;  Main entry point to rerun a processing date
   5        N EASDDD,EASLOC,EATYP,XX
   6        ;
   7        D:'$G(IOF) HOME^%ZIS
   8        W @IOF
   9        F XX=1:1:7 W !?2,$P($T(NOTICE+XX),";;",2)
  10        ;
  11        Q:'$$FILTER(.EASLOC)  ; Select Filter action, quit on uparrow
  12        Q:'$$LTRTYPE(.EATYP)  ; Select type of letter to reprint, quit on up arrow 
  13        Q:'$$ASKDT(EATYP,.EASDDD)  ; Select date to reprint letters from, quit on uparrow
  14        D QUE1
  15        Q
  16        ;
  17 FILTER(EASLOC) ; Filter by Patient Preferred Location
  18        ; Input:  None
  19        ;
  20        ; Output: EASLOC  -1 if an error occurred
  21        ;                  0 if not filtering by location
  22        ;                nnn IEN of filtered facility in the INSTITUTION File
  23        ;
  24        ;         RESULT   1 if result of function Ok
  25        ;                  0 if user enters "^" or exits
  26        ; 
  27        N DIR,DIRUT
  28        ;
  29        S EASLOC=-1
  30        I $$GET1^DIQ(713,1,8,"I") D  Q:$D(DIRUT) 0
  31        . S DIR(0)="YAO",DIR("A")="Filter letters by Preferred Facility? "
  32        . S DIR("B")="NO"
  33        . S DIR("?")="Enter 'YES' to limit letters to a specific Facility or 'NO' to print all letters"
  34        . D ^DIR K DIR
  35        . Q:$D(DIRUT)
  36        . I 'Y S EASLOC=0 Q
  37        . S DIR(0)="P^EAS(713,1,2,:QEM"
  38        . S EASLOC=$$FACNUM^EASMTL6
  39        E  D
  40        . S EASLOC=0
  41        Q 1
  42        ;
  43 ASKDT(EATYP,EASDDD)            ; Ask for processing date to look for letters
  44        ; Input   EATYP    Type of letter to be reprinted 
  45        ;
  46        ; Output  EASDDD   Selected processing date for type of letter 
  47        ;                  to be reprinted
  48        ;
  49        ;         RESULT   1 if result of function Ok
  50        ;                  0 if user enters "^" or exits
  51        ;
  52        N EASDT,RSLT,EAX,EASOFST
  53        ;
  54        S RSLT=0
  55 AGN    S EASDT=$$GETDT
  56        G:EASDT<0 ASKQ
  57        ;
  58        S EASOFST=$S(EATYP=2:30,EATYP=4:60,1:0)
  59        S EAX=$$FMADD^XLFDT(EASDT,-EASOFST,0,0,-1)
  60        S EAX=$O(^EAS(713.2,"AD",EAX))
  61        I 'EAX D  G AGN
  62        . W !!,"No valid processing date could be found for ",$S(EATYP=2:30,EATYP=4:0,1:60),"-day letters for ",$$FMTE^XLFDT(EASDT),"."
  63        . W !,"Please select another date."
  64        ;
  65        W !!,"To re-print "_$S(EATYP=2:30,EATYP=4:0,1:60)_"-day letters for "_$$FMTE^XLFDT(EASDT)
  66        W !,"the Search/Processing date of "_$$FMTE^XLFDT(EAX)_" will be used."
  67        W !,"Please note: ALL "_$S(EATYP=2:30,EATYP=4:0,1:60)_"-day letters for this processing date will print"
  68        ;
  69        S DIR(0)="YAO"
  70        S DIR("?")="Enter 'YES' to use the "_$$FMTE^XLFDT(EAX)_" date.  Enter 'NO' to select a different date."
  71        S DIR("A")="Do you wish to use this date? "
  72        S DIR("B")="YES"
  73        D ^DIR K DIR
  74        I $D(DIRUT) G ASKQ
  75        I 'Y G AGN
  76        ;
  77        S EASDDD=EAX
  78        S RSLT=1
  79 ASKQ   Q RSLT
  80        ;
  81 GETDT() ;
  82        N DIR,DIRUT
  83        ;
  84        S DIR(0)="DAO^:DT:EP"
  85        S DIR("?")="Select the date for the letters you wish to re-print."
  86        S DIR("A")="Enter re-print date: "
  87        D ^DIR K DIR
  88        S:$D(DIRUT) Y=-1
  89        Q +Y
  90        ;
  91 LTRTYPE(EATYP) ;  Ask for a specific type of letter to print
  92        ; Input           None
  93        ;
  94        ; Output  EATYP    Type of letter to reprint
  95        ;                  1 - 60-day letter
  96        ;                  2 - 30-day letter
  97        ;                  4 - 0-day letter
  98        ;
  99        ;         RESULT   1 if result of function Ok
 100        ;                  0 if user enters "^" or exits
 101        ;
 102        N DIR,DIRUT
 103        ;
 104        S DIR(0)="SO^1:60-Day;2:30-Day;4:0-Day"
 105        S DIR("A")="Select letter type",DIR("A",1)=""
 106        S DIR("?")="Select the type of letter to re-print "
 107        D ^DIR K DIR
 108        Q:$D(DIRUT) 0
 109        S EATYP=+Y
 110        Q 1
  
  
 173        . I +$G(EASLOC)>0 Q:$$GET1^DIQ(2,DFN,27.02,"I")'=+EASLOC
 174        . Q:'$$THRSHLD^EASMTL6(EATYP,EASIEN)  ; Quit if letter threshold not met

Routine Checksum:

Routine Name:
  - EASSIGOV

 Before
 ======
  
 2        ;;1.0;ENROLLMENT APPLICATION SYSTEM;**4,8,13**;Mar 15, 2001
  
 26        ..;Is test from this site?
 27        ..I $P($G(^DGMT(408.31,MTIEN,2)),"^",5)'=SITE Q
  
 44        ..;Is test from this site?
 45        ..I $P($G(^DGMT(408.31,MTIEN,2)),"^",5)'=SITE Q
  
 60        W !,?2,"This purpose of this report is to help sites monitor the Means Test images"
  
  
 After
 =====
  
 2        ;;1.0;ENROLLMENT APPLICATION SYSTEM;**4,8,13,28**;Mar 15, 2001
  
 26        ..;Is test from this site?
 27        ..I +$P($G(^DGMT(408.31,MTIEN,2)),"^",5)'=SITE Q
  
 44        ..;Is test from this site?
 45        ..I +$P($G(^DGMT(408.31,MTIEN,2)),"^",5)'=SITE Q
  
 60        W !,?2,"The purpose of this report is to help sites monitor the Means Test images"

Routine Checksum:

=============================================================================
User Information:
Entered By  : KOPECKY,STEPHEN C.            Date Entered  : MAR 05, 2003
Completed By: LANDRY,DANNA                  Date Completed: AUG 15, 2003
Released By : KOVACH,STUART                 Date Released : AUG 15, 2003
=============================================================================


Packman Mail Message:
=====================

$END TXT
