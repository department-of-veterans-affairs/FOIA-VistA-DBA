Released IB*2*293 SEQ #323
Extracted from mail message
**KIDS**:IB*2.0*293^

**INSTALL NAME**
IB*2.0*293
"BLD",6054,0)
IB*2.0*293^INTEGRATED BILLING^0^3061031^y
"BLD",6054,1,0)
^^6^6^3061031^
"BLD",6054,1,1,0)
This patch addresses 2 issues. The first is that site requested to change
"BLD",6054,1,2,0)
the heading "Last test date" to "Last RX Copayment Exemption date" in the
"BLD",6054,1,3,0)
DG Patient Inquiry option to match up to the data. The second issue is
"BLD",6054,1,4,0)
about a bug behind discovered in the IB's IVM backbilling functionality.
"BLD",6054,1,5,0)
If the veteran has an appointment in a billable clinic but also has a non
"BLD",6054,1,6,0)
billable stop code added, charges are not being generated.
"BLD",6054,4,0)
^9.64PA^^
"BLD",6054,6.3)
1
"BLD",6054,"INI")

"BLD",6054,"INID")
^^
"BLD",6054,"INIT")

"BLD",6054,"KRN",0)
^9.67PA^8989.52^19
"BLD",6054,"KRN",.4,0)
.4
"BLD",6054,"KRN",.401,0)
.401
"BLD",6054,"KRN",.402,0)
.402
"BLD",6054,"KRN",.403,0)
.403
"BLD",6054,"KRN",.5,0)
.5
"BLD",6054,"KRN",.84,0)
.84
"BLD",6054,"KRN",3.6,0)
3.6
"BLD",6054,"KRN",3.8,0)
3.8
"BLD",6054,"KRN",9.2,0)
9.2
"BLD",6054,"KRN",9.8,0)
9.8
"BLD",6054,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6054,"KRN",9.8,"NM",1,0)
IBAMTV1^^0^B9409430
"BLD",6054,"KRN",9.8,"NM",2,0)
IBARXEU^^0^B19692471
"BLD",6054,"KRN",9.8,"NM","B","IBAMTV1",1)

"BLD",6054,"KRN",9.8,"NM","B","IBARXEU",2)

"BLD",6054,"KRN",19,0)
19
"BLD",6054,"KRN",19,"NM",0)
^9.68A^^
"BLD",6054,"KRN",19.1,0)
19.1
"BLD",6054,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6054,"KRN",101,0)
101
"BLD",6054,"KRN",409.61,0)
409.61
"BLD",6054,"KRN",771,0)
771
"BLD",6054,"KRN",870,0)
870
"BLD",6054,"KRN",8989.51,0)
8989.51
"BLD",6054,"KRN",8989.52,0)
8989.52
"BLD",6054,"KRN",8994,0)
8994
"BLD",6054,"KRN","B",.4,.4)

"BLD",6054,"KRN","B",.401,.401)

"BLD",6054,"KRN","B",.402,.402)

"BLD",6054,"KRN","B",.403,.403)

"BLD",6054,"KRN","B",.5,.5)

"BLD",6054,"KRN","B",.84,.84)

"BLD",6054,"KRN","B",3.6,3.6)

"BLD",6054,"KRN","B",3.8,3.8)

"BLD",6054,"KRN","B",9.2,9.2)

"BLD",6054,"KRN","B",9.8,9.8)

"BLD",6054,"KRN","B",19,19)

"BLD",6054,"KRN","B",19.1,19.1)

"BLD",6054,"KRN","B",101,101)

"BLD",6054,"KRN","B",409.61,409.61)

"BLD",6054,"KRN","B",771,771)

"BLD",6054,"KRN","B",870,870)

"BLD",6054,"KRN","B",8989.51,8989.51)

"BLD",6054,"KRN","B",8989.52,8989.52)

"BLD",6054,"KRN","B",8994,8994)

"BLD",6054,"PRE")

"BLD",6054,"QUES",0)
^9.62^^0
"BLD",6054,"REQB",0)
^9.611^2^2
"BLD",6054,"REQB",1,0)
IB*2.0*222^2
"BLD",6054,"REQB",2,0)
IB*2.0*153^2
"BLD",6054,"REQB","B","IB*2.0*153",2)

"BLD",6054,"REQB","B","IB*2.0*222",1)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
293^3061031
"PKG",200,22,1,"PAH",1,1,0)
^^6^6^3061031
"PKG",200,22,1,"PAH",1,1,1,0)
This patch addresses 2 issues. The first is that site requested to change
"PKG",200,22,1,"PAH",1,1,2,0)
the heading "Last test date" to "Last RX Copayment Exemption date" in the
"PKG",200,22,1,"PAH",1,1,3,0)
DG Patient Inquiry option to match up to the data. The second issue is
"PKG",200,22,1,"PAH",1,1,4,0)
about a bug behind discovered in the IB's IVM backbilling functionality.
"PKG",200,22,1,"PAH",1,1,5,0)
If the veteran has an appointment in a billable clinic but also has a non
"PKG",200,22,1,"PAH",1,1,6,0)
billable stop code added, charges are not being generated.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IBAMTV1")
0^1^B9409430^B9609270
"RTN","IBAMTV1",1,0)
IBAMTV1 ;ALB/CPM - BUILD ARRAY OF BILLABLE EPISODES ; 31-MAY-94
"RTN","IBAMTV1",2,0)
 ;;2.0;INTEGRATED BILLING;**15,33,91,132,153,293**;21-MAR-94;Build 1
"RTN","IBAMTV1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBAMTV1",4,0)
 ;
"RTN","IBAMTV1",5,0)
CARE ; Build an array of episodes to be back-billed.
"RTN","IBAMTV1",6,0)
 ;
"RTN","IBAMTV1",7,0)
 ; Input: IBSTART  --  First date that the patient is Means Test billable
"RTN","IBAMTV1",8,0)
 ;          IBEND  --  Last date that the patient is Means Test billable
"RTN","IBAMTV1",9,0)
 ;            DFN  --  Pointer to the patient in file #2
"RTN","IBAMTV1",10,0)
 ;
"RTN","IBAMTV1",11,0)
 ; Output:  ^TMP("IBAMTV",$J,episode date) = 1^2^3, where
"RTN","IBAMTV1",12,0)
 ;                         1 = adm date for inpatient care
"RTN","IBAMTV1",13,0)
 ;                             visit date for outpatient care
"RTN","IBAMTV1",14,0)
 ;                         2 = disch/last bill date for inpatient care
"RTN","IBAMTV1",15,0)
 ;                             null for outpatient care
"RTN","IBAMTV1",16,0)
 ;                         3 = null for inpatient care
"RTN","IBAMTV1",17,0)
 ;                             softlink for outpatient care
"RTN","IBAMTV1",18,0)
 ;
"RTN","IBAMTV1",19,0)
 K ^TMP("IBAMTV",$J)
"RTN","IBAMTV1",20,0)
 ;
"RTN","IBAMTV1",21,0)
 ; - inpatient at IBSTART?
"RTN","IBAMTV1",22,0)
 S VAINDT=IBSTART\1_.2359 D ADM^VADPT2
"RTN","IBAMTV1",23,0)
 I VADMVT D
"RTN","IBAMTV1",24,0)
 .S IBA=$$ORIG(VADMVT),IBADM=+$G(^DGPM(IBA,0))\1
"RTN","IBAMTV1",25,0)
 .Q:+$$MVT^DGPMOBS(IBA)
"RTN","IBAMTV1",26,0)
 .S IBDIS=+$G(^DGPM(+$P($G(^DGPM(IBA,0)),"^",17),0))\1
"RTN","IBAMTV1",27,0)
 .S:'IBDIS!(IBDIS>IBEND) IBDIS=$$FMADD^XLFDT(IBEND,1)
"RTN","IBAMTV1",28,0)
 .S ^TMP("IBAMTV",$J,IBADM)=(IBSTART\1)_"^"_IBDIS
"RTN","IBAMTV1",29,0)
 ;
"RTN","IBAMTV1",30,0)
 ; - get subsequent admissions
"RTN","IBAMTV1",31,0)
 S IBD="" F  S IBD=$O(^DGPM("ATID1",DFN,IBD)) Q:'IBD!((9999999.9999999-IBD)\1'>IBSTART)  S IBA=+$O(^(IBD,0)) D
"RTN","IBAMTV1",32,0)
 .S IBADM0=$G(^DGPM(IBA,0))
"RTN","IBAMTV1",33,0)
 .Q:+IBADM0>IBEND  ;           adm after end date for MT
"RTN","IBAMTV1",34,0)
 .Q:+$$MVT^DGPMOBS(IBA)  ;       adm for obs & examination
"RTN","IBAMTV1",35,0)
 .Q:$$ASIH^IBAUTL5(IBADM0)  ;  asih admission (catch it later)
"RTN","IBAMTV1",36,0)
 .;
"RTN","IBAMTV1",37,0)
 .S IBDIS=+$G(^DGPM(+$P($G(^DGPM(IBA,0)),"^",17),0))\1
"RTN","IBAMTV1",38,0)
 .S:'IBDIS!(IBDIS>IBEND) IBDIS=$$FMADD^XLFDT(IBEND,1)
"RTN","IBAMTV1",39,0)
 .S ^TMP("IBAMTV",$J,+IBADM0\1)=(+IBADM0\1)_"^"_IBDIS
"RTN","IBAMTV1",40,0)
 ;
"RTN","IBAMTV1",41,0)
 ; Outpatient encounters
"RTN","IBAMTV1",42,0)
 N IBVAL,IBCBK,IBFILTER,IBOE,IBOE0,IBCK,IBT,IBPB,Z
"RTN","IBAMTV1",43,0)
 S IBVAL("DFN")=DFN,IBVAL("BDT")=IBSTART,IBVAL("EDT")=IBEND
"RTN","IBAMTV1",44,0)
 ; Only parent encounters
"RTN","IBAMTV1",45,0)
 S IBFILTER=""
"RTN","IBAMTV1",46,0)
 S IBCBK="I '$P(Y0,U,6) S ^TMP(""IBOE"",$J,+$P(Y0,U,8),Y)=Y0"
"RTN","IBAMTV1",47,0)
 K ^TMP("IBOE",$J)
"RTN","IBAMTV1",48,0)
 D SCAN^IBSDU("PATIENT/DATE",.IBVAL,IBFILTER,IBCBK,1) K ^TMP("DIERR",$J)
"RTN","IBAMTV1",49,0)
 F Z=0:1:6,9,10,13 S IBCK(Z)=""
"RTN","IBAMTV1",50,0)
 S IBT=0 F  S IBT=$O(^TMP("IBOE",$J,IBT)) Q:'IBT  D
"RTN","IBAMTV1",51,0)
 . S IBOE=0 F  S IBOE=$O(^TMP("IBOE",$J,IBT,IBOE)) Q:'IBOE  S IBOE0=$G(^(IBOE)) D
"RTN","IBAMTV1",52,0)
 .. K IBPB
"RTN","IBAMTV1",53,0)
 .. I $$BILLCK^IBAMTEDU(IBOE,IBOE0,.IBCK,.IBPB) D
"RTN","IBAMTV1",54,0)
 ... S Z=$O(IBPB(0)) Q:'Z
"RTN","IBAMTV1",55,0)
 ...;
"RTN","IBAMTV1",56,0)
 ... ;Check any visits for that date for dispositions, add-edits
"RTN","IBAMTV1",57,0)
 ... I Z=3 Q:$D(^TMP("IBAMTV",$J,IBOE0\1))
"RTN","IBAMTV1",58,0)
 ... I Z=2 Q:$S($D(^TMP("IBAMTV",$J,IBOE0\1)):1,1:$$NBCSC^IBEFUNC($P(IBOE0,U,3),IBOE0\1))
"RTN","IBAMTV1",59,0)
 ...;
"RTN","IBAMTV1",60,0)
 ... S ^TMP("IBAMTV",$J,IBOE0\1)=IBOE0\1_U_U_IBOE
"RTN","IBAMTV1",61,0)
 K ^TMP("IBOE",$J)
"RTN","IBAMTV1",62,0)
 ;
"RTN","IBAMTV1",63,0)
 K IBA,IBADM,IBADM0,IBAD,IBD,IBDIS,IBDT,IBI,VAINDT,VADMVT
"RTN","IBAMTV1",64,0)
 ;
"RTN","IBAMTV1",65,0)
 Q
"RTN","IBAMTV1",66,0)
 ;
"RTN","IBAMTV1",67,0)
INP(DATE) ; Was the patient an inpatient on DATE?
"RTN","IBAMTV1",68,0)
 ;  Input:   DATE  --  Date of outpatient visit
"RTN","IBAMTV1",69,0)
 ;           array IBARR
"RTN","IBAMTV1",70,0)
 ; Output:      1  --  Patient was an inpatient on DATE
"RTN","IBAMTV1",71,0)
 ;              0  --  Patient was not
"RTN","IBAMTV1",72,0)
 N X,Y,Z S X=0
"RTN","IBAMTV1",73,0)
 I '$G(DATE) G INPQ
"RTN","IBAMTV1",74,0)
 S Y=0 F  S Y=$O(IBARR(Y)) Q:X!'Y!(Y>DATE)  D
"RTN","IBAMTV1",75,0)
 .S Z=0 F  S Z=$O(IBARR(Y,Z)) Q:'Z  S Z1=$G(IBARR(Y,Z)) I DATE'<+Z1,DATE'>$P(Z1,"^",2) S X=1 Q
"RTN","IBAMTV1",76,0)
INPQ Q X
"RTN","IBAMTV1",77,0)
 ;
"RTN","IBAMTV1",78,0)
ORIG(IBA) ; Find first admission pointer, considering ASIH movements
"RTN","IBAMTV1",79,0)
 ;  Input:  IBA  --  Pointer to admission in #405
"RTN","IBAMTV1",80,0)
 ; Output:    Z  --  Pointer to original admission in #405
"RTN","IBAMTV1",81,0)
 N X,Y,Z S Z=+$G(IBA)
"RTN","IBAMTV1",82,0)
 F  S X=$G(^DGPM(Z,0)),Z=$P(X,"^",14),Y=$P(X,"^",21) Q:Y=""  S Z=Y
"RTN","IBAMTV1",83,0)
 Q Z
"RTN","IBARXEU")
0^2^B19692471^B19501479
"RTN","IBARXEU",1,0)
IBARXEU ;AAS/ALB - RX EXEMPTION UTILITY ROUTINE ;2-NOV-92
"RTN","IBARXEU",2,0)
 ;;2.0;INTEGRATED BILLING;**20,222,293**;21-MAR-94;Build 1
"RTN","IBARXEU",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBARXEU",4,0)
 ;
"RTN","IBARXEU",5,0)
 ;
"RTN","IBARXEU",6,0)
RXST(DFN,IBDT) ; -- Check rx income exemption status of patient
"RTN","IBARXEU",7,0)
 ;
"RTN","IBARXEU",8,0)
 ;  input = :  dfn  = patient file pointer
"RTN","IBARXEU",9,0)
 ;             ibdt = date to check for (optional) default is today
"RTN","IBARXEU",10,0)
 ;
"RTN","IBARXEU",11,0)
 ;  returns :  -1 if no data   ^text^reason code^reason text^date of test
"RTN","IBARXEU",12,0)
 ;              0 if non exempt
"RTN","IBARXEU",13,0)
 ;              1 if exempt
"RTN","IBARXEU",14,0)
 ;
"RTN","IBARXEU",15,0)
 N X,Y,Z,IBX,IBON
"RTN","IBARXEU",16,0)
 ;
"RTN","IBARXEU",17,0)
 S IBON=$$ON^IBARXEU0 I IBON<1 Q IBON
"RTN","IBARXEU",18,0)
 ;
"RTN","IBARXEU",19,0)
 S IBX=""
"RTN","IBARXEU",20,0)
 I '$G(IBDT) S IBDT=DT
"RTN","IBARXEU",21,0)
 I IBDT>DT S IBDT=DT ; no future dates
"RTN","IBARXEU",22,0)
 ;
"RTN","IBARXEU",23,0)
 ; -- date before legislations
"RTN","IBARXEU",24,0)
 I IBDT<$$STDATE S IBX="0^NON-EXEMPT^^Date is Prior to Legislation^" G RXSTQ ; nobody exempt prior to legislation
"RTN","IBARXEU",25,0)
 ;
"RTN","IBARXEU",26,0)
 ; -- if no data on patient quit
"RTN","IBARXEU",27,0)
 S X=$G(^IBA(354,DFN,0))
"RTN","IBARXEU",28,0)
 I X=""!('$D(^IBA(354.1,"AP",DFN))) S IBX="-1^UNKNOWN^^Medication Copayment Exemption status never determined" G RXSTQ ; no data return -1
"RTN","IBARXEU",29,0)
 ;
"RTN","IBARXEU",30,0)
 ; -- use current status if ibdt not less than current test and
"RTN","IBARXEU",31,0)
 ;    not greater than current test date +365
"RTN","IBARXEU",32,0)
 I IBDT'<$P(X,U,3),IBDT'>$$PLUS^IBARXEU0($P(X,U,3)) S IBX=$$IBX^IBARXEU0(DFN,IBDT) G RXSTQ
"RTN","IBARXEU",33,0)
 ;
"RTN","IBARXEU",34,0)
 ; -- if ibdt not less than current date but greater than
"RTN","IBARXEU",35,0)
 ;    current test +365 is into future
"RTN","IBARXEU",36,0)
 I IBDT'<$P(X,U,3),IBDT>$$PLUS^IBARXEU0($P(X,U,3)) D
"RTN","IBARXEU",37,0)
 .S Y=$$LST^IBARXEU0(DFN,IBDT)
"RTN","IBARXEU",38,0)
 .;
"RTN","IBARXEU",39,0)
 .; -- see if patient was SC>50, can't be updated so don't say previous
"RTN","IBARXEU",40,0)
 .I $L($$ACODE^IBARXEU0(Y))<3 S IBX=+$P(X,U,4)_U_$$TEXT^IBARXEU0($P(X,U,4))_U_$$ACODE^IBARXEU0(Y)_U_$$REASON^IBARXEU0(X)_U_$P(X,U,3) Q
"RTN","IBARXEU",41,0)
 .;
"RTN","IBARXEU",42,0)
 .S IBX=+$P(X,U,4)_U_"Previously "_$$TEXT^IBARXEU0($P(X,U,4))_U_$$ACODE^IBARXEU0(Y)_U_"Requires new exemption. Previously "_$$REASON^IBARXEU0(X)_U_$P(X,U,3)
"RTN","IBARXEU",43,0)
 ;
"RTN","IBARXEU",44,0)
 ; -- if ibdt less than current date need old exemption data
"RTN","IBARXEU",45,0)
 I IBDT<$P(X,U,3) D  G RXSTQ
"RTN","IBARXEU",46,0)
 .;
"RTN","IBARXEU",47,0)
 .; -- find status of prior test
"RTN","IBARXEU",48,0)
 .S Y=$$LST^IBARXEU0(DFN,IBDT)
"RTN","IBARXEU",49,0)
 .;
"RTN","IBARXEU",50,0)
 .; -- no previous data
"RTN","IBARXEU",51,0)
 .I Y="" D  Q
"RTN","IBARXEU",52,0)
 ..S IBX="-1^UNKNOWN^^No data for date requested."
"RTN","IBARXEU",53,0)
 ..Q
"RTN","IBARXEU",54,0)
 .;
"RTN","IBARXEU",55,0)
 .S Z=$G(^IBA(354,DFN,0)),Z=$P(Z,U,5)_U_$P(Z,U,3) ; get status & date
"RTN","IBARXEU",56,0)
 .;
"RTN","IBARXEU",57,0)
 .; -- if old exemption is current for copay date
"RTN","IBARXEU",58,0)
 .I IBDT'>$$PLUS^IBARXEU0(+Y) D  Q
"RTN","IBARXEU",59,0)
 ..S X=$G(^IBE(354.2,+$P(Y,U,5),0)) ; exemption reason node
"RTN","IBARXEU",60,0)
 ..S IBX=+$P(X,U,4)_U_$$TEXT^IBARXEU0($P(X,U,4))_U_$$ACODE^IBARXEU0(Y)_U_$$REASON^IBARXEU0(X)_U_$P(X,U,3)
"RTN","IBARXEU",61,0)
 ..Q
"RTN","IBARXEU",62,0)
 .;
"RTN","IBARXEU",63,0)
 .; -- if ibdt is greater than old exemption + 365
"RTN","IBARXEU",64,0)
 .;    report previous
"RTN","IBARXEU",65,0)
 .I IBDT>$$PLUS^IBARXEU0(+Y) D  Q
"RTN","IBARXEU",66,0)
 ..S X=$G(^IBE(354.2,+$P(Y,U,5),0)) ;exemption reason node
"RTN","IBARXEU",67,0)
 ..;
"RTN","IBARXEU",68,0)
 ..; -- see if patient was SC>50, can't be updated so don't say previous
"RTN","IBARXEU",69,0)
 ..I $L($$ACODE^IBARXEU0(Y))<3 S IBX=+$P(X,U,4)_U_$$TEXT^IBARXEU0($P(X,U,4))_U_$$ACODE^IBARXEU0(Y)_U_$$REASON^IBARXEU0(X)_U_$P(X,U,3) Q
"RTN","IBARXEU",70,0)
 ..;
"RTN","IBARXEU",71,0)
 ..S IBX=+$P(X,U,4)_U_"Previously "_$$TEXT^IBARXEU0($P(X,U,4))_U_$$ACODE^IBARXEU0(Y)_U_"Requires new exemption. Previously "_$$REASON^IBARXEU0(X)_U_$P(X,U,3)
"RTN","IBARXEU",72,0)
 ..Q
"RTN","IBARXEU",73,0)
 .Q
"RTN","IBARXEU",74,0)
 ;
"RTN","IBARXEU",75,0)
RXSTQ Q IBX
"RTN","IBARXEU",76,0)
 ;
"RTN","IBARXEU",77,0)
DISP(DFN,IBDT,NO,NULL) ; -- formats text to display 
"RTN","IBARXEU",78,0)
 ; -- input =  dfn
"RTN","IBARXEU",79,0)
 ;             ibdt = date to check for
"RTN","IBARXEU",80,0)
 ;             no   = number of lines to print (1, 2, or 3)
"RTN","IBARXEU",81,0)
 ;             null = if zero print unknown, if non-zero quit
"RTN","IBARXEU",82,0)
 ;
"RTN","IBARXEU",83,0)
 I '$G(IBDT) S IBDT=DT
"RTN","IBARXEU",84,0)
 I '$D(NULL) S NULL=1
"RTN","IBARXEU",85,0)
 I IBDT>DT S IBDT=DT ; no future dates
"RTN","IBARXEU",86,0)
 I '$G(NO) S NO=3
"RTN","IBARXEU",87,0)
 S X=$$RXST(DFN,IBDT)
"RTN","IBARXEU",88,0)
 S IBON=$$ON^IBARXEU0 I IBON<1 S X=IBON
"RTN","IBARXEU",89,0)
 I X<0&(NULL) G DISPQ
"RTN","IBARXEU",90,0)
 W !,"Medication Copayment Exemption Status: ",$P(X,U,2) G:NO<2 DISPQ
"RTN","IBARXEU",91,0)
 W !,$P(X,U,4) G:NO<3 DISPQ
"RTN","IBARXEU",92,0)
 I $P(X,U,5) W !,"Last Rx Copay Exemption date: " S Y=$P(X,U,5) D DT^DIQ
"RTN","IBARXEU",93,0)
DISPQ Q
"RTN","IBARXEU",94,0)
 ;
"RTN","IBARXEU",95,0)
STDATE() ; -- legislative start date for income exemption
"RTN","IBARXEU",96,0)
 Q 2921030
"RTN","IBARXEU",97,0)
 ;
"RTN","IBARXEU",98,0)
 ;
"RTN","IBARXEU",99,0)
ACTIVE(IBZ) ; -- SCREEN for active field of billing exemptions file
"RTN","IBARXEU",100,0)
 ;    only one entry per effective date can be active
"RTN","IBARXEU",101,0)
 ;
"RTN","IBARXEU",102,0)
 N IBX,IBY,T
"RTN","IBARXEU",103,0)
 S T=0
"RTN","IBARXEU",104,0)
 S IBZ=$S(IBZ=1:IBZ,$E(IBZ)="A":1,1:0)
"RTN","IBARXEU",105,0)
 I 'IBZ S T=1 G ACTIVEQ
"RTN","IBARXEU",106,0)
 S IBX=$G(^IBA(354.1,DA,0))
"RTN","IBARXEU",107,0)
 S IBY=$O(^IBA(354.1,"AIVDT",+$P(IBX,U,3),+$P(IBX,U,2),-$P(IBX,U),0))
"RTN","IBARXEU",108,0)
 I 'IBY!(IBY=DA) S T=1
"RTN","IBARXEU",109,0)
 W:$D(IBTALK) !!,"Another entry is already Active, You must inactivate it first",!!
"RTN","IBARXEU",110,0)
ACTIVEQ Q T
"VER")
8.0^22.0
"BLD",6054,6)
^323
**END**
**END**
