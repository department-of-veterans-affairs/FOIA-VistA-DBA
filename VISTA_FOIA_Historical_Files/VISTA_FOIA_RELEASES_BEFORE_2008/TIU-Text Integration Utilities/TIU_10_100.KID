KIDS Distribution saved on Apr 16, 2001@12:32:30
ID Notes, 4/16/01
**KIDS**:TIU*1.0*100^USR*1.0*15^OR*3.0*104^

**INSTALL NAME**
TIU*1.0*100
"BLD",2610,0)
TIU*1.0*100^TEXT INTEGRATION UTILITIES^0^3010416^y
"BLD",2610,1,0)
^^2^2^3010416^^^^
"BLD",2610,1,1,0)
The description of this build is found in the National Patch Module under
"BLD",2610,1,2,0)
patch TIU*1*100.
"BLD",2610,4,0)
^9.64PA^8925.5^3
"BLD",2610,4,8925,0)
8925
"BLD",2610,4,8925,2,0)
^9.641^8925^1
"BLD",2610,4,8925,2,8925,0)
TIU DOCUMENT  (File-top level)
"BLD",2610,4,8925,2,8925,1,0)
^9.6411^2101^1
"BLD",2610,4,8925,2,8925,1,2101,0)
ID PARENT
"BLD",2610,4,8925,222)
y^n^p^^^^n
"BLD",2610,4,8925.5,0)
8925.5
"BLD",2610,4,8925.5,2,0)
^9.641^8925.5^1
"BLD",2610,4,8925.5,2,8925.5,0)
TIU AUDIT TRAIL  (File-top level)
"BLD",2610,4,8925.5,2,8925.5,1,0)
^9.6411^3.05^5
"BLD",2610,4,8925.5,2,8925.5,1,3.01,0)
INTERDISCIPLINARY NOTE ACTION
"BLD",2610,4,8925.5,2,8925.5,1,3.02,0)
DATE/TIME OF ACTION
"BLD",2610,4,8925.5,2,8925.5,1,3.03,0)
PERSON
"BLD",2610,4,8925.5,2,8925.5,1,3.04,0)
ID ENTRY STATUS
"BLD",2610,4,8925.5,2,8925.5,1,3.05,0)
ID PARENT
"BLD",2610,4,8925.5,222)
y^n^p^^^^n
"BLD",2610,4,8925.95,0)
8925.95
"BLD",2610,4,8925.95,2,0)
^9.641^8925.95^1
"BLD",2610,4,8925.95,2,8925.95,0)
TIU DOCUMENT PARAMETERS  (File-top level)
"BLD",2610,4,8925.95,2,8925.95,1,0)
^9.6411^.19^2
"BLD",2610,4,8925.95,2,8925.95,1,.18,0)
ORDER ID ENTRIES BY TITLE
"BLD",2610,4,8925.95,2,8925.95,1,.19,0)
SEND ALERTS ON NEW ID ENTRY
"BLD",2610,4,8925.95,222)
y^n^p^^^^n
"BLD",2610,4,"APDD",8925,8925)

"BLD",2610,4,"APDD",8925,8925,2101)

"BLD",2610,4,"APDD",8925.5,8925.5)

"BLD",2610,4,"APDD",8925.5,8925.5,3.01)

"BLD",2610,4,"APDD",8925.5,8925.5,3.02)

"BLD",2610,4,"APDD",8925.5,8925.5,3.03)

"BLD",2610,4,"APDD",8925.5,8925.5,3.04)

"BLD",2610,4,"APDD",8925.5,8925.5,3.05)

"BLD",2610,4,"APDD",8925.95,8925.95)

"BLD",2610,4,"APDD",8925.95,8925.95,.18)

"BLD",2610,4,"APDD",8925.95,8925.95,.19)

"BLD",2610,4,"B",8925,8925)

"BLD",2610,4,"B",8925.5,8925.5)

"BLD",2610,4,"B",8925.95,8925.95)

"BLD",2610,"ABNS",0)
^9.66A^1^1
"BLD",2610,"ABNS",1,0)
TIU
"BLD",2610,"ABNS","B","TIU",1)

"BLD",2610,"ABPKG")
^n
"BLD",2610,"INID")
^n
"BLD",2610,"INIT")
TIUPS100
"BLD",2610,"KRN",0)
^9.67PA^19^18
"BLD",2610,"KRN",.4,0)
.4
"BLD",2610,"KRN",.401,0)
.401
"BLD",2610,"KRN",.402,0)
.402
"BLD",2610,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",2610,"KRN",.402,"NM",1,0)
TIU DOCUMENT PARAMETER EDIT    FILE #8925.95^8925.95^0
"BLD",2610,"KRN",.402,"NM","B","TIU DOCUMENT PARAMETER EDIT    FILE #8925.95",1)

"BLD",2610,"KRN",.403,0)
.403
"BLD",2610,"KRN",.5,0)
.5
"BLD",2610,"KRN",.84,0)
.84
"BLD",2610,"KRN",3.6,0)
3.6
"BLD",2610,"KRN",3.8,0)
3.8
"BLD",2610,"KRN",9.2,0)
9.2
"BLD",2610,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",2610,"KRN",9.8,0)
9.8
"BLD",2610,"KRN",9.8,"NM",0)
^9.68A^97^89
"BLD",2610,"KRN",9.8,"NM",1,0)
TIUSRV^^0^B61332508
"BLD",2610,"KRN",9.8,"NM",6,0)
TIUBR^^0^B35871110
"BLD",2610,"KRN",9.8,"NM",7,0)
TIUBR1^^0^B62172798
"BLD",2610,"KRN",9.8,"NM",9,0)
TIULP^^0^B30501674
"BLD",2610,"KRN",9.8,"NM",10,0)
TIUEDI1^^0^B36955152
"BLD",2610,"KRN",9.8,"NM",11,0)
TIUEDIT^^0^B35671495
"BLD",2610,"KRN",9.8,"NM",12,0)
TIUEDIH^^1^
"BLD",2610,"KRN",9.8,"NM",13,0)
TIULM^^0^B7219067
"BLD",2610,"KRN",9.8,"NM",14,0)
TIULA2^^0^B43112403
"BLD",2610,"KRN",9.8,"NM",15,0)
TIULC1^^0^B38069683
"BLD",2610,"KRN",9.8,"NM",16,0)
TIUR^^0^B32618351
"BLD",2610,"KRN",9.8,"NM",17,0)
TIUROR^^0^B50360977
"BLD",2610,"KRN",9.8,"NM",18,0)
TIURORL^^0^B2065529
"BLD",2610,"KRN",9.8,"NM",19,0)
TIURM^^0^B20943725
"BLD",2610,"KRN",9.8,"NM",20,0)
TIURL^^0^B16440544
"BLD",2610,"KRN",9.8,"NM",22,0)
TIURPN^^0^B15628738
"BLD",2610,"KRN",9.8,"NM",23,0)
TIURPTTL^^0^B20534008
"BLD",2610,"KRN",9.8,"NM",24,0)
TIURTITL^^0^B19866250
"BLD",2610,"KRN",9.8,"NM",25,0)
TIUADD^^0^B37868143
"BLD",2610,"KRN",9.8,"NM",26,0)
TIUGR^^0^B21432467
"BLD",2610,"KRN",9.8,"NM",27,0)
TIUGR1^^0^B13839553
"BLD",2610,"KRN",9.8,"NM",28,0)
TIUEPRNT^^0^B4636923
"BLD",2610,"KRN",9.8,"NM",29,0)
TIUGEDIT^^0^B35813365
"BLD",2610,"KRN",9.8,"NM",30,0)
TIUEDI3^^0^B36953715
"BLD",2610,"KRN",9.8,"NM",31,0)
TIUEDI4^^0^B48766687
"BLD",2610,"KRN",9.8,"NM",32,0)
TIUGEDI1^^0^B14705877
"BLD",2610,"KRN",9.8,"NM",33,0)
TIUEDIM^^0^B16170400
"BLD",2610,"KRN",9.8,"NM",34,0)
TIUEDITR^^0^B12868226
"BLD",2610,"KRN",9.8,"NM",35,0)
TIUHELP^^0^B10933422
"BLD",2610,"KRN",9.8,"NM",36,0)
TIURB^^0^B23339679
"BLD",2610,"KRN",9.8,"NM",37,0)
TIURC^^0^B17035494
"BLD",2610,"KRN",9.8,"NM",39,0)
TIUSRVLL^^0^B44395016
"BLD",2610,"KRN",9.8,"NM",40,0)
TIUPUTC^^0^B28208783
"BLD",2610,"KRN",9.8,"NM",41,0)
TIURECL^^0^B53577732
"BLD",2610,"KRN",9.8,"NM",42,0)
TIURA^^0^B55230625
"BLD",2610,"KRN",9.8,"NM",43,0)
TIURA2^^0^B15791678
"BLD",2610,"KRN",9.8,"NM",44,0)
TIURECL1^^0^B32764020
"BLD",2610,"KRN",9.8,"NM",45,0)
TIULX^^0^B43149986
"BLD",2610,"KRN",9.8,"NM",47,0)
TIURB2^^0^B23091302
"BLD",2610,"KRN",9.8,"NM",48,0)
TIURC1^^0^B47007459
"BLD",2610,"KRN",9.8,"NM",49,0)
TIURECL2^^0^B8811306
"BLD",2610,"KRN",9.8,"NM",50,0)
TIURA1^^0^B41686413
"BLD",2610,"KRN",9.8,"NM",51,0)
TIUPRPN1^^0^B41372297
"BLD",2610,"KRN",9.8,"NM",52,0)
TIUPRPN2^^0^B8876435
"BLD",2610,"KRN",9.8,"NM",53,0)
TIUPRPN8^^0^B19590307
"BLD",2610,"KRN",9.8,"NM",54,0)
TIUSRVA^^0^B10527139
"BLD",2610,"KRN",9.8,"NM",55,0)
TIUSRVP1^^0^B33298781
"BLD",2610,"KRN",9.8,"NM",56,0)
TIUGR2^^0^B8612903
"BLD",2610,"KRN",9.8,"NM",57,0)
TIUPEFIX^^0^B39823612
"BLD",2610,"KRN",9.8,"NM",58,0)
TIUPUTCN^^0^B23885954
"BLD",2610,"KRN",9.8,"NM",59,0)
TIUPUTPN^^0^B22180375
"BLD",2610,"KRN",9.8,"NM",60,0)
TIUPUTU^^0^B16248856
"BLD",2610,"KRN",9.8,"NM",61,0)
TIUBRWS^^0^B2380614
"BLD",2610,"KRN",9.8,"NM",62,0)
TIUSRVR1^^0^B22989539
"BLD",2610,"KRN",9.8,"NM",63,0)
TIUSRVD^^0^B36840434
"BLD",2610,"KRN",9.8,"NM",64,0)
TIUSRVP^^0^B62127442
"BLD",2610,"KRN",9.8,"NM",65,0)
TIUALRT1^^0^B6917688
"BLD",2610,"KRN",9.8,"NM",66,0)
TIUGBR^^0^B6771191
"BLD",2610,"KRN",9.8,"NM",67,0)
TIUPRD^^0^B13286619
"BLD",2610,"KRN",9.8,"NM",68,0)
TIUPRPN3^^0^B37848861
"BLD",2610,"KRN",9.8,"NM",69,0)
TIUPRPN4^^0^B10745385
"BLD",2610,"KRN",9.8,"NM",70,0)
TIUPRPN5^^0^B22720274
"BLD",2610,"KRN",9.8,"NM",71,0)
TIUPRPN6^^0^B10034142
"BLD",2610,"KRN",9.8,"NM",72,0)
TIUPRPN7^^0^B28321769
"BLD",2610,"KRN",9.8,"NM",73,0)
TIUR1^^0^B12693272
"BLD",2610,"KRN",9.8,"NM",74,0)
TIUR2^^0^B52417653
"BLD",2610,"KRN",9.8,"NM",75,0)
TIURD^^0^B30912680
"BLD",2610,"KRN",9.8,"NM",76,0)
TIURL1^^0^B3721001
"BLD",2610,"KRN",9.8,"NM",77,0)
TIURM1^^0^B32425153
"BLD",2610,"KRN",9.8,"NM",78,0)
TIUROR1^^0^B5585918
"BLD",2610,"KRN",9.8,"NM",79,0)
TIURPTT1^^0^B29452638
"BLD",2610,"KRN",9.8,"NM",80,0)
TIURS^^0^B35669886
"BLD",2610,"KRN",9.8,"NM",81,0)
TIURS1^^0^B55954271
"BLD",2610,"KRN",9.8,"NM",82,0)
TIURTIT1^^0^B29562167
"BLD",2610,"KRN",9.8,"NM",83,0)
TIUSRV1^^0^B18146606
"BLD",2610,"KRN",9.8,"NM",84,0)
TIUSRVR2^^0^B29516546
"BLD",2610,"KRN",9.8,"NM",85,0)
TIUT^^0^B18525033
"BLD",2610,"KRN",9.8,"NM",86,0)
TIUTSK^^0^B10933398
"BLD",2610,"KRN",9.8,"NM",87,0)
TIURT^^0^B42216967
"BLD",2610,"KRN",9.8,"NM",88,0)
TIULQ^^0^B13973581
"BLD",2610,"KRN",9.8,"NM",89,0)
TIULAPIC^^0^B10248132
"BLD",2610,"KRN",9.8,"NM",90,0)
TIULAPIS^^0^B10427510
"BLD",2610,"KRN",9.8,"NM",91,0)
TIURD2^^0^B66177181
"BLD",2610,"KRN",9.8,"NM",92,0)
TIURHX^^0^B5258912
"BLD",2610,"KRN",9.8,"NM",93,0)
TIUSRVLV^^0^B9127015
"BLD",2610,"KRN",9.8,"NM",94,0)
TIUAUDIT^^0^B3039693
"BLD",2610,"KRN",9.8,"NM",95,0)
TIURD4^^0^B14526406
"BLD",2610,"KRN",9.8,"NM",96,0)
TIUSRVR3^^0^B17223226
"BLD",2610,"KRN",9.8,"NM",97,0)
TIUPD^^0^B24674329
"BLD",2610,"KRN",9.8,"NM","B","TIUADD",25)

"BLD",2610,"KRN",9.8,"NM","B","TIUALRT1",65)

"BLD",2610,"KRN",9.8,"NM","B","TIUAUDIT",94)

"BLD",2610,"KRN",9.8,"NM","B","TIUBR",6)

"BLD",2610,"KRN",9.8,"NM","B","TIUBR1",7)

"BLD",2610,"KRN",9.8,"NM","B","TIUBRWS",61)

"BLD",2610,"KRN",9.8,"NM","B","TIUEDI1",10)

"BLD",2610,"KRN",9.8,"NM","B","TIUEDI3",30)

"BLD",2610,"KRN",9.8,"NM","B","TIUEDI4",31)

"BLD",2610,"KRN",9.8,"NM","B","TIUEDIH",12)

"BLD",2610,"KRN",9.8,"NM","B","TIUEDIM",33)

"BLD",2610,"KRN",9.8,"NM","B","TIUEDIT",11)

"BLD",2610,"KRN",9.8,"NM","B","TIUEDITR",34)

"BLD",2610,"KRN",9.8,"NM","B","TIUEPRNT",28)

"BLD",2610,"KRN",9.8,"NM","B","TIUGBR",66)

"BLD",2610,"KRN",9.8,"NM","B","TIUGEDI1",32)

"BLD",2610,"KRN",9.8,"NM","B","TIUGEDIT",29)

"BLD",2610,"KRN",9.8,"NM","B","TIUGR",26)

"BLD",2610,"KRN",9.8,"NM","B","TIUGR1",27)

"BLD",2610,"KRN",9.8,"NM","B","TIUGR2",56)

"BLD",2610,"KRN",9.8,"NM","B","TIUHELP",35)

"BLD",2610,"KRN",9.8,"NM","B","TIULA2",14)

"BLD",2610,"KRN",9.8,"NM","B","TIULAPIC",89)

"BLD",2610,"KRN",9.8,"NM","B","TIULAPIS",90)

"BLD",2610,"KRN",9.8,"NM","B","TIULC1",15)

"BLD",2610,"KRN",9.8,"NM","B","TIULM",13)

"BLD",2610,"KRN",9.8,"NM","B","TIULP",9)

"BLD",2610,"KRN",9.8,"NM","B","TIULQ",88)

"BLD",2610,"KRN",9.8,"NM","B","TIULX",45)

"BLD",2610,"KRN",9.8,"NM","B","TIUPD",97)

"BLD",2610,"KRN",9.8,"NM","B","TIUPEFIX",57)

"BLD",2610,"KRN",9.8,"NM","B","TIUPRD",67)

"BLD",2610,"KRN",9.8,"NM","B","TIUPRPN1",51)

"BLD",2610,"KRN",9.8,"NM","B","TIUPRPN2",52)

"BLD",2610,"KRN",9.8,"NM","B","TIUPRPN3",68)

"BLD",2610,"KRN",9.8,"NM","B","TIUPRPN4",69)

"BLD",2610,"KRN",9.8,"NM","B","TIUPRPN5",70)

"BLD",2610,"KRN",9.8,"NM","B","TIUPRPN6",71)

"BLD",2610,"KRN",9.8,"NM","B","TIUPRPN7",72)

"BLD",2610,"KRN",9.8,"NM","B","TIUPRPN8",53)

"BLD",2610,"KRN",9.8,"NM","B","TIUPUTC",40)

"BLD",2610,"KRN",9.8,"NM","B","TIUPUTCN",58)

"BLD",2610,"KRN",9.8,"NM","B","TIUPUTPN",59)

"BLD",2610,"KRN",9.8,"NM","B","TIUPUTU",60)

"BLD",2610,"KRN",9.8,"NM","B","TIUR",16)

"BLD",2610,"KRN",9.8,"NM","B","TIUR1",73)

"BLD",2610,"KRN",9.8,"NM","B","TIUR2",74)

"BLD",2610,"KRN",9.8,"NM","B","TIURA",42)

"BLD",2610,"KRN",9.8,"NM","B","TIURA1",50)

"BLD",2610,"KRN",9.8,"NM","B","TIURA2",43)

"BLD",2610,"KRN",9.8,"NM","B","TIURB",36)

"BLD",2610,"KRN",9.8,"NM","B","TIURB2",47)

"BLD",2610,"KRN",9.8,"NM","B","TIURC",37)

"BLD",2610,"KRN",9.8,"NM","B","TIURC1",48)

"BLD",2610,"KRN",9.8,"NM","B","TIURD",75)

"BLD",2610,"KRN",9.8,"NM","B","TIURD2",91)

"BLD",2610,"KRN",9.8,"NM","B","TIURD4",95)

"BLD",2610,"KRN",9.8,"NM","B","TIURECL",41)

"BLD",2610,"KRN",9.8,"NM","B","TIURECL1",44)

"BLD",2610,"KRN",9.8,"NM","B","TIURECL2",49)

"BLD",2610,"KRN",9.8,"NM","B","TIURHX",92)

"BLD",2610,"KRN",9.8,"NM","B","TIURL",20)

"BLD",2610,"KRN",9.8,"NM","B","TIURL1",76)

"BLD",2610,"KRN",9.8,"NM","B","TIURM",19)

"BLD",2610,"KRN",9.8,"NM","B","TIURM1",77)

"BLD",2610,"KRN",9.8,"NM","B","TIUROR",17)

"BLD",2610,"KRN",9.8,"NM","B","TIUROR1",78)

"BLD",2610,"KRN",9.8,"NM","B","TIURORL",18)

"BLD",2610,"KRN",9.8,"NM","B","TIURPN",22)

"BLD",2610,"KRN",9.8,"NM","B","TIURPTT1",79)

"BLD",2610,"KRN",9.8,"NM","B","TIURPTTL",23)

"BLD",2610,"KRN",9.8,"NM","B","TIURS",80)

"BLD",2610,"KRN",9.8,"NM","B","TIURS1",81)

"BLD",2610,"KRN",9.8,"NM","B","TIURT",87)

"BLD",2610,"KRN",9.8,"NM","B","TIURTIT1",82)

"BLD",2610,"KRN",9.8,"NM","B","TIURTITL",24)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRV",1)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRV1",83)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRVA",54)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRVD",63)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRVLL",39)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRVLV",93)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRVP",64)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRVP1",55)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRVR1",62)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRVR2",84)

"BLD",2610,"KRN",9.8,"NM","B","TIUSRVR3",96)

"BLD",2610,"KRN",9.8,"NM","B","TIUT",85)

"BLD",2610,"KRN",9.8,"NM","B","TIUTSK",86)

"BLD",2610,"KRN",19,0)
19
"BLD",2610,"KRN",19,"NM",0)
^9.68A^^
"BLD",2610,"KRN",19.1,0)
19.1
"BLD",2610,"KRN",101,0)
101
"BLD",2610,"KRN",101,"NM",0)
^9.68A^98^88
"BLD",2610,"KRN",101,"NM",1,0)
TIU ACTION PRINT^^0
"BLD",2610,"KRN",101,"NM",2,0)
TIU ACTION COMPLETE NOTES^^0
"BLD",2610,"KRN",101,"NM",3,0)
TIU ACTION MAKE ADDENDUM^^0
"BLD",2610,"KRN",101,"NM",4,0)
TIU ACTION ADD DOCUMENT^^0
"BLD",2610,"KRN",101,"NM",5,0)
TIU ACTION SIGNED/UNSIGNED^^0
"BLD",2610,"KRN",101,"NM",6,0)
TIU ACTION SELECT NEW PATIENT^^0
"BLD",2610,"KRN",101,"NM",7,0)
TIU ACTION QUIT^^0
"BLD",2610,"KRN",101,"NM",8,0)
TIU ACTION RESET ALL SIGNED^^0
"BLD",2610,"KRN",101,"NM",9,0)
TIU ACTION ID NOTE^^0
"BLD",2610,"KRN",101,"NM",10,0)
TIU ACTION MENU OE/RR^^0
"BLD",2610,"KRN",101,"NM",11,0)
TIU ACTION BROWSE FOR CLINICIAN^^0
"BLD",2610,"KRN",101,"NM",12,0)
TIU ACTION BROWSE FOR MGR^^0
"BLD",2610,"KRN",101,"NM",13,0)
TIU ACTION BROWSE FOR MRT^^0
"BLD",2610,"KRN",101,"NM",14,0)
TIU ACTION BROWSE FOR OE/RR^^0
"BLD",2610,"KRN",101,"NM",15,0)
TIU ACTION BROWSE FOR READ ONLY^^0
"BLD",2610,"KRN",101,"NM",16,0)
TIU ACTION DETAILED DISPLAY^^0
"BLD",2610,"KRN",101,"NM",17,0)
TIU ACTION EXPAND LIST^^0
"BLD",2610,"KRN",101,"NM",18,0)
TIU ACTION SELECT LIST ELEMENT^^0
"BLD",2610,"KRN",101,"NM",19,0)
TIU ACTION COPY^^0
"BLD",2610,"KRN",101,"NM",20,0)
TIU ACTION DELETE^^0
"BLD",2610,"KRN",101,"NM",21,0)
TIU BROWSE ACTION COPY^^0
"BLD",2610,"KRN",101,"NM",22,0)
TIU BROWSE ACTION DELETE^^0
"BLD",2610,"KRN",101,"NM",23,0)
TIU BROWSE ACTION ID NOTE^^0
"BLD",2610,"KRN",101,"NM",25,0)
TIU BROWSE ACTION EDIT^^0
"BLD",2610,"KRN",101,"NM",33,0)
TIU ACTION MENU DISPLAY^^0
"BLD",2610,"KRN",101,"NM",34,0)
TIU ACTION DISPLAY REASSIGN HX^^0
"BLD",2610,"KRN",101,"NM",35,0)
TIU ACTION MENU MGR^^0
"BLD",2610,"KRN",101,"NM",36,0)
TIU ACTION CHANGE TITLE^^0
"BLD",2610,"KRN",101,"NM",37,0)
TIU ACTION CHANGE VIEW CLINICIAN^^0
"BLD",2610,"KRN",101,"NM",38,0)
TIU ACTION CHANGE VIEW MIS^^0
"BLD",2610,"KRN",101,"NM",39,0)
TIU ACTION CHANGE VIEW OTHER^^0
"BLD",2610,"KRN",101,"NM",40,0)
TIU ACTION CHANGE VIEW PT/TTL^^0
"BLD",2610,"KRN",101,"NM",41,0)
TIU ACTION CHANGE VIEW TITLE^^0
"BLD",2610,"KRN",101,"NM",42,0)
TIU ACTION COMPLETE DOCUMENTS^^0
"BLD",2610,"KRN",101,"NM",43,0)
TIU ACTION CWAD DISPLAY^^0
"BLD",2610,"KRN",101,"NM",44,0)
TIU ACTION EXPAND LIST DUP^^0
"BLD",2610,"KRN",101,"NM",45,0)
TIU ACTION MENU CLINICIAN^^0
"BLD",2610,"KRN",101,"NM",46,0)
TIU ACTION MENU MGR REVIEW^^0
"BLD",2610,"KRN",101,"NM",47,0)
TIU ACTION MENU PT/TTL REVIEW^^0
"BLD",2610,"KRN",101,"NM",48,0)
TIU ACTION MENU TITLE REVIEW^^0
"BLD",2610,"KRN",101,"NM",49,0)
TIU ACTION SIGN/COSIGN^^0
"BLD",2610,"KRN",101,"NM",51,0)
TIU HIDDEN ACTIONS ADVANCED^^0
"BLD",2610,"KRN",101,"NM",52,0)
TIU HIDDEN ACTIONS OE/RR^^0
"BLD",2610,"KRN",101,"NM",53,0)
TIU ACTION LINK WITH CLIENT RECORD^^0
"BLD",2610,"KRN",101,"NM",54,0)
TIU ACTION VERIFY^^0
"BLD",2610,"KRN",101,"NM",55,0)
TIU ACTION SIGN ON CHART^^0
"BLD",2610,"KRN",101,"NM",56,0)
TIU ACTION REASSIGN^^0
"BLD",2610,"KRN",101,"NM",57,0)
TIU ACTION SEND BACK^^0
"BLD",2610,"KRN",101,"NM",59,0)
TIU BROWSE MENU CLINICIAN^^0
"BLD",2610,"KRN",101,"NM",60,0)
TIU BROWSE MENU MGR^^0
"BLD",2610,"KRN",101,"NM",61,0)
TIU BROWSE ACTION DESIGNATE SIGNERS^^0
"BLD",2610,"KRN",101,"NM",62,0)
TIU BROWSE ACTION EDIT ENCOUNTER^^0
"BLD",2610,"KRN",101,"NM",63,0)
TIU BROWSE ACTION MAKE ADDENDUM^^0
"BLD",2610,"KRN",101,"NM",64,0)
TIU BROWSE ACTION PRINT^^0
"BLD",2610,"KRN",101,"NM",65,0)
TIU BROWSE ACTION SEARCH^^0
"BLD",2610,"KRN",101,"NM",66,0)
TIU BROWSE ACTION SIGN/COSIGN^^0
"BLD",2610,"KRN",101,"NM",67,0)
TIU BROWSE ACTION LINK TO PROBLEM^^0
"BLD",2610,"KRN",101,"NM",68,0)
TIU BROWSE ACTION REASSIGN^^0
"BLD",2610,"KRN",101,"NM",69,0)
TIU BROWSE ACTION LINK WITH CLIENT APP^^0
"BLD",2610,"KRN",101,"NM",70,0)
TIU BROWSE ACTION SIGN ON CHART^^0
"BLD",2610,"KRN",101,"NM",71,0)
TIU BROWSE ACTION AMEND^^0
"BLD",2610,"KRN",101,"NM",72,0)
TIU BROWSE ACTION SEND BACK^^0
"BLD",2610,"KRN",101,"NM",73,0)
TIU BROWSE ACTION VERIFY^^0
"BLD",2610,"KRN",101,"NM",74,0)
TIU ACTION AMEND^^0
"BLD",2610,"KRN",101,"NM",75,0)
TIU ACTION SEARCH LIST^^0
"BLD",2610,"KRN",101,"NM",76,0)
TIU ACTION EDIT^^0
"BLD",2610,"KRN",101,"NM",77,0)
TIU ACTION MENU LINK^^0
"BLD",2610,"KRN",101,"NM",78,0)
TIU ACTION DESIGNATE SIGNERS^^0
"BLD",2610,"KRN",101,"NM",79,0)
TIU ACTION EDIT ENCOUNTER^^0
"BLD",2610,"KRN",101,"NM",80,0)
TIU ACTION LINK TO PROBLEMS^^0
"BLD",2610,"KRN",101,"NM",81,0)
TIU ACTION LINK TO VISIT^^0
"BLD",2610,"KRN",101,"NM",82,0)
TIU BROWSE MENU LINK^^0
"BLD",2610,"KRN",101,"NM",83,0)
VALM BLANK 1^^4^
"BLD",2610,"KRN",101,"NM",84,0)
TIU ACTION NEXT SCREEN^^0
"BLD",2610,"KRN",101,"NM",85,0)
TIU ACTION PREVIOUS SCREEN^^0
"BLD",2610,"KRN",101,"NM",86,0)
TIU ACTION TOP^^0
"BLD",2610,"KRN",101,"NM",87,0)
TIU ACTION BOTTOM^^0
"BLD",2610,"KRN",101,"NM",88,0)
VALM DOWN A LINE^^4^
"BLD",2610,"KRN",101,"NM",89,0)
VALM GOTO PAGE^^4^
"BLD",2610,"KRN",101,"NM",90,0)
VALM LEFT^^4^
"BLD",2610,"KRN",101,"NM",91,0)
VALM PRINT LIST^^4^
"BLD",2610,"KRN",101,"NM",92,0)
VALM REFRESH^^4^
"BLD",2610,"KRN",101,"NM",93,0)
VALM RIGHT^^4^
"BLD",2610,"KRN",101,"NM",94,0)
VALM UP ONE LINE^^4^
"BLD",2610,"KRN",101,"NM",95,0)
VALM TURN ON/OFF MENUS^^4^
"BLD",2610,"KRN",101,"NM",96,0)
TIU ACTION MENU MRT^^0
"BLD",2610,"KRN",101,"NM",97,0)
TIU ACTION MENU MRT REVIEW^^0
"BLD",2610,"KRN",101,"NM",98,0)
TIU BROWSE MENU MRT^^0
"BLD",2610,"KRN",101,"NM","B","TIU ACTION ADD DOCUMENT",4)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION AMEND",74)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION BOTTOM",87)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION BROWSE FOR CLINICIAN",11)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION BROWSE FOR MGR",12)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION BROWSE FOR MRT",13)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION BROWSE FOR OE/RR",14)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION BROWSE FOR READ ONLY",15)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION CHANGE TITLE",36)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION CHANGE VIEW CLINICIAN",37)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION CHANGE VIEW MIS",38)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION CHANGE VIEW OTHER",39)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION CHANGE VIEW PT/TTL",40)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION CHANGE VIEW TITLE",41)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION COMPLETE DOCUMENTS",42)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION COMPLETE NOTES",2)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION COPY",19)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION CWAD DISPLAY",43)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION DELETE",20)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION DESIGNATE SIGNERS",78)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION DETAILED DISPLAY",16)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION DISPLAY REASSIGN HX",34)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION EDIT",76)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION EDIT ENCOUNTER",79)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION EXPAND LIST",17)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION EXPAND LIST DUP",44)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION ID NOTE",9)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION LINK TO PROBLEMS",80)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION LINK TO VISIT",81)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION LINK WITH CLIENT RECORD",53)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MAKE ADDENDUM",3)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MENU CLINICIAN",45)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MENU DISPLAY",33)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MENU LINK",77)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MENU MGR",35)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MENU MGR REVIEW",46)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MENU MRT",96)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MENU MRT REVIEW",97)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MENU OE/RR",10)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MENU PT/TTL REVIEW",47)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION MENU TITLE REVIEW",48)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION NEXT SCREEN",84)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION PREVIOUS SCREEN",85)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION PRINT",1)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION QUIT",7)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION REASSIGN",56)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION RESET ALL SIGNED",8)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION SEARCH LIST",75)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION SELECT LIST ELEMENT",18)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION SELECT NEW PATIENT",6)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION SEND BACK",57)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION SIGN ON CHART",55)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION SIGN/COSIGN",49)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION SIGNED/UNSIGNED",5)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION TOP",86)

"BLD",2610,"KRN",101,"NM","B","TIU ACTION VERIFY",54)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION AMEND",71)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION COPY",21)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION DELETE",22)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION DESIGNATE SIGNERS",61)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION EDIT",25)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION EDIT ENCOUNTER",62)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION ID NOTE",23)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION LINK TO PROBLEM",67)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION LINK WITH CLIENT APP",69)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION MAKE ADDENDUM",63)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION PRINT",64)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION REASSIGN",68)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION SEARCH",65)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION SEND BACK",72)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION SIGN ON CHART",70)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION SIGN/COSIGN",66)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE ACTION VERIFY",73)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE MENU CLINICIAN",59)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE MENU LINK",82)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE MENU MGR",60)

"BLD",2610,"KRN",101,"NM","B","TIU BROWSE MENU MRT",98)

"BLD",2610,"KRN",101,"NM","B","TIU HIDDEN ACTIONS ADVANCED",51)

"BLD",2610,"KRN",101,"NM","B","TIU HIDDEN ACTIONS OE/RR",52)

"BLD",2610,"KRN",101,"NM","B","VALM BLANK 1",83)

"BLD",2610,"KRN",101,"NM","B","VALM DOWN A LINE",88)

"BLD",2610,"KRN",101,"NM","B","VALM GOTO PAGE",89)

"BLD",2610,"KRN",101,"NM","B","VALM LEFT",90)

"BLD",2610,"KRN",101,"NM","B","VALM PRINT LIST",91)

"BLD",2610,"KRN",101,"NM","B","VALM REFRESH",92)

"BLD",2610,"KRN",101,"NM","B","VALM RIGHT",93)

"BLD",2610,"KRN",101,"NM","B","VALM TURN ON/OFF MENUS",95)

"BLD",2610,"KRN",101,"NM","B","VALM UP ONE LINE",94)

"BLD",2610,"KRN",409.61,0)
409.61
"BLD",2610,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",2610,"KRN",409.61,"NM",1,0)
TIU DISPLAY AUDIT TRAIL^^0
"BLD",2610,"KRN",409.61,"NM","B","TIU DISPLAY AUDIT TRAIL",1)

"BLD",2610,"KRN",771,0)
771
"BLD",2610,"KRN",771,"NM",0)
^9.68A^^
"BLD",2610,"KRN",869.2,0)
869.2
"BLD",2610,"KRN",870,0)
870
"BLD",2610,"KRN",8994,0)
8994
"BLD",2610,"KRN",8994,"NM",0)
^9.68A^4^4
"BLD",2610,"KRN",8994,"NM",1,0)
TIU ID ATTACH ENTRY^^0
"BLD",2610,"KRN",8994,"NM",2,0)
TIU ID CAN ATTACH^^0
"BLD",2610,"KRN",8994,"NM",3,0)
TIU ID CAN RECEIVE^^0
"BLD",2610,"KRN",8994,"NM",4,0)
TIU ID DETACH ENTRY^^0
"BLD",2610,"KRN",8994,"NM","B","TIU ID ATTACH ENTRY",1)

"BLD",2610,"KRN",8994,"NM","B","TIU ID CAN ATTACH",2)

"BLD",2610,"KRN",8994,"NM","B","TIU ID CAN RECEIVE",3)

"BLD",2610,"KRN",8994,"NM","B","TIU ID DETACH ENTRY",4)

"BLD",2610,"KRN","B",.4,.4)

"BLD",2610,"KRN","B",.401,.401)

"BLD",2610,"KRN","B",.402,.402)

"BLD",2610,"KRN","B",.403,.403)

"BLD",2610,"KRN","B",.5,.5)

"BLD",2610,"KRN","B",.84,.84)

"BLD",2610,"KRN","B",3.6,3.6)

"BLD",2610,"KRN","B",3.8,3.8)

"BLD",2610,"KRN","B",9.2,9.2)

"BLD",2610,"KRN","B",9.8,9.8)

"BLD",2610,"KRN","B",19,19)

"BLD",2610,"KRN","B",19.1,19.1)

"BLD",2610,"KRN","B",101,101)

"BLD",2610,"KRN","B",409.61,409.61)

"BLD",2610,"KRN","B",771,771)

"BLD",2610,"KRN","B",869.2,869.2)

"BLD",2610,"KRN","B",870,870)

"BLD",2610,"KRN","B",8994,8994)

"BLD",2610,"QUES",0)
^9.62^^
"BLD",2610,"REQB",0)
^9.611^20^14
"BLD",2610,"REQB",3,0)
TIU*1.0*31^2
"BLD",2610,"REQB",4,0)
TIU*1.0*66^2
"BLD",2610,"REQB",5,0)
TIU*1.0*49^2
"BLD",2610,"REQB",8,0)
TIU*1.0*108^2
"BLD",2610,"REQB",10,0)
TIU*1.0*61^2
"BLD",2610,"REQB",11,0)
TIU*1.0*48^2
"BLD",2610,"REQB",12,0)
TIU*1.0*81^2
"BLD",2610,"REQB",13,0)
TIU*1.0*80^2
"BLD",2610,"REQB",14,0)
TIU*1.0*104^2
"BLD",2610,"REQB",15,0)
TIU*1.0*53^2
"BLD",2610,"REQB",16,0)
TIU*1.0*103^2
"BLD",2610,"REQB",18,0)
TIU*1.0*25^2
"BLD",2610,"REQB",19,0)
TIU*1.0*83^2
"BLD",2610,"REQB",20,0)
GMTS*2.7*45^2
"BLD",2610,"REQB","B","GMTS*2.7*45",20)

"BLD",2610,"REQB","B","TIU*1.0*103",16)

"BLD",2610,"REQB","B","TIU*1.0*104",14)

"BLD",2610,"REQB","B","TIU*1.0*108",8)

"BLD",2610,"REQB","B","TIU*1.0*25",18)

"BLD",2610,"REQB","B","TIU*1.0*31",3)

"BLD",2610,"REQB","B","TIU*1.0*48",11)

"BLD",2610,"REQB","B","TIU*1.0*49",5)

"BLD",2610,"REQB","B","TIU*1.0*53",15)

"BLD",2610,"REQB","B","TIU*1.0*61",10)

"BLD",2610,"REQB","B","TIU*1.0*66",4)

"BLD",2610,"REQB","B","TIU*1.0*80",13)

"BLD",2610,"REQB","B","TIU*1.0*81",12)

"BLD",2610,"REQB","B","TIU*1.0*83",19)

"FIA",8925)
TIU DOCUMENT
"FIA",8925,0)
^TIU(8925,
"FIA",8925,0,0)
8925IP
"FIA",8925,0,1)
y^n^p^^^^n
"FIA",8925,0,10)

"FIA",8925,0,11)

"FIA",8925,0,"RLRO")

"FIA",8925,0,"VR")
1.0^TIU
"FIA",8925,8925)
1
"FIA",8925,8925,2101)

"FIA",8925.5)
TIU AUDIT TRAIL
"FIA",8925.5,0)
^TIU(8925.5,
"FIA",8925.5,0,0)
8925.5P
"FIA",8925.5,0,1)
y^n^p^^^^n
"FIA",8925.5,0,10)

"FIA",8925.5,0,11)

"FIA",8925.5,0,"RLRO")

"FIA",8925.5,0,"VR")
1.0^TIU
"FIA",8925.5,8925.5)
1
"FIA",8925.5,8925.5,3.01)

"FIA",8925.5,8925.5,3.02)

"FIA",8925.5,8925.5,3.03)

"FIA",8925.5,8925.5,3.04)

"FIA",8925.5,8925.5,3.05)

"FIA",8925.95)
TIU DOCUMENT PARAMETERS
"FIA",8925.95,0)
^TIU(8925.95,
"FIA",8925.95,0,0)
8925.95P
"FIA",8925.95,0,1)
y^n^p^^^^n
"FIA",8925.95,0,10)

"FIA",8925.95,0,11)

"FIA",8925.95,0,"RLRO")

"FIA",8925.95,0,"VR")
1.0^TIU
"FIA",8925.95,8925.95)
1
"FIA",8925.95,8925.95,.18)

"FIA",8925.95,8925.95,.19)

"INIT")
TIUPS100
"KRN",.402,1005,-1)
0^1
"KRN",.402,1005,0)
TIU DOCUMENT PARAMETER EDIT^3001108.1218^@^8925.95^^@^3010413
"KRN",.402,1005,"DIAB",1,0,8925.95,2)
4;"FILING ALERT RECIPIENT"
"KRN",.402,1005,"DIAB",1,1,8925.954,0)
.01;"FILING ALERT RECIPIENT"
"KRN",.402,1005,"DR",1,8925.95)
.01;.02;.03;.04;.06;.07;.08;.09;.1;@2;.11;I +X'>0 K DIE("NO^") S Y="@1";S DIE("NO^")="BACK";.12;K DIE("NO^");I +$P(^TIU(8925.95,+DA,0),U,12)>0 S Y="@1";W !,"You may not turn on IRT w/o specifying the Deficiency...";.11///@;
"KRN",.402,1005,"DR",1,8925.95,1)
S Y="@2";@1;.14;I +$P(^TIU(8925.95,+DA,0),U,14) S Y="@3";.15;.16;S Y="@4";@3;I +$P(^TIU(8925.95,+DA,0),U,14)'>0 S Y="@4";.15///@;.16///@;@4;.17;.18;.19;3;W !!,"If document is to be uploaded, specify Filing Alert Recipients:",!;
"KRN",.402,1005,"DR",1,8925.95,2)
4FILING ALERT RECIPIENT~;W !!,"Now enter the USER CLASSES for which cosignature will be required:",!;5;W !!,"Now enter the DIVISIONAL parameters:",!;2;
"KRN",.402,1005,"DR",2,8925.952)
.02;.03;
"KRN",.402,1005,"DR",2,8925.954)
.01FILING ALERT RECIPIENT~;
"KRN",.402,1005,"DR",2,8925.955)
.01;
"KRN",101,2761,-1)
4^92
"KRN",101,2761,0)
VALM REFRESH
"KRN",101,2764,-1)
4^94
"KRN",101,2764,0)
VALM UP ONE LINE
"KRN",101,2765,-1)
4^88
"KRN",101,2765,0)
VALM DOWN A LINE
"KRN",101,2769,-1)
4^91
"KRN",101,2769,0)
VALM PRINT LIST
"KRN",101,2771,-1)
4^95
"KRN",101,2771,0)
VALM TURN ON/OFF MENUS
"KRN",101,2772,-1)
4^83
"KRN",101,2772,0)
VALM BLANK 1
"KRN",101,2780,-1)
4^93
"KRN",101,2780,0)
VALM RIGHT
"KRN",101,2781,-1)
4^90
"KRN",101,2781,0)
VALM LEFT
"KRN",101,2783,-1)
4^89
"KRN",101,2783,0)
VALM GOTO PAGE
"KRN",101,3488,-1)
0^35
"KRN",101,3488,0)
TIU ACTION MENU MGR^Act on Documents^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3488,1,0)
^^1^1^2980304^^^^
"KRN",101,3488,1,1,0)
Menu of actions which may be executed by MIS Managers.
"KRN",101,3488,4)
26
"KRN",101,3488,10,0)
^101.01PA^19^19
"KRN",101,3488,10,1,0)
3500^^5^
"KRN",101,3488,10,1,"^")
TIU ACTION EDIT
"KRN",101,3488,10,2,0)
3501^^26^
"KRN",101,3488,10,2,"^")
TIU ACTION PRINT
"KRN",101,3488,10,3,0)
5886^^19^
"KRN",101,3488,10,3,"^")
TIU ACTION MENU DISPLAY
"KRN",101,3488,10,6,0)
3516^^11^
"KRN",101,3488,10,6,"^")
TIU ACTION DELETE
"KRN",101,3488,10,7,0)
3513^^9^
"KRN",101,3488,10,7,"^")
TIU ACTION AMEND
"KRN",101,3488,10,8,0)
3690^^21^
"KRN",101,3488,10,8,"^")
TIU ACTION BROWSE FOR MGR
"KRN",101,3488,10,9,0)
3507^^27^
"KRN",101,3488,10,9,"^")
TIU ACTION QUIT
"KRN",101,3488,10,10,0)
3522^^3^
"KRN",101,3488,10,10,"^")
TIU ACTION SIGN ON CHART
"KRN",101,3488,10,11,0)
3515^^25^
"KRN",101,3488,10,11,"^")
TIU ACTION CHANGE VIEW OTHER
"KRN",101,3488,10,12,0)
3521^^17^
"KRN",101,3488,10,12,"^")
TIU ACTION SEND BACK
"KRN",101,3488,10,15,0)
4683^^1^
"KRN",101,3488,10,15,"^")
TIU ACTION SEARCH LIST
"KRN",101,3488,10,16,0)
3520^^13^
"KRN",101,3488,10,16,"^")
TIU ACTION REASSIGN
"KRN",101,3488,10,17,0)
3523^^7^
"KRN",101,3488,10,17,"^")
TIU ACTION VERIFY
"KRN",101,3488,10,18,0)
5039^^15^
"KRN",101,3488,10,18,"^")
TIU ACTION LINK WITH CLIENT RECORD
"KRN",101,3488,10,19,0)
5740^^23^
"KRN",101,3488,10,19,"^")
TIU ACTION ID NOTE
"KRN",101,3488,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT) S:$G(TIUGLINK) VALMSG=$$LINKMSG^TIUGR2(TIUGLINK)
"KRN",101,3488,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,3488,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,17),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,3488,28)
Select Action: 
"KRN",101,3488,99)
58543,64334
"KRN",101,3490,-1)
0^60
"KRN",101,3490,0)
TIU BROWSE MENU MGR^Review/edit/sign^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3490,1,0)
^^1^1^2950628^^
"KRN",101,3490,1,1,0)
Menu of actions which may be executed by clinicians.
"KRN",101,3490,4)
26
"KRN",101,3490,10,0)
^101.01PA^16^12
"KRN",101,3490,10,3,0)
3526^^5^
"KRN",101,3490,10,3,"^")
TIU BROWSE ACTION EDIT
"KRN",101,3490,10,4,0)
3527^^3^
"KRN",101,3490,10,4,"^")
TIU BROWSE ACTION PRINT
"KRN",101,3490,10,5,0)
3531^^7^
"KRN",101,3490,10,5,"^")
TIU BROWSE ACTION SIGN ON CHART
"KRN",101,3490,10,6,0)
3507^^17^
"KRN",101,3490,10,6,"^")
TIU ACTION QUIT
"KRN",101,3490,10,7,0)
3529^^1^
"KRN",101,3490,10,7,"^")
TIU BROWSE ACTION SEARCH
"KRN",101,3490,10,10,0)
3524^^9^
"KRN",101,3490,10,10,"^")
TIU BROWSE ACTION AMEND
"KRN",101,3490,10,11,0)
3525^^11^
"KRN",101,3490,10,11,"^")
TIU BROWSE ACTION DELETE
"KRN",101,3490,10,12,0)
3530^^15^
"KRN",101,3490,10,12,"^")
TIU BROWSE ACTION SEND BACK
"KRN",101,3490,10,13,0)
3528^^13^
"KRN",101,3490,10,13,"^")
TIU BROWSE ACTION REASSIGN
"KRN",101,3490,10,14,0)
3533^^6^
"KRN",101,3490,10,14,"^")
TIU BROWSE ACTION VERIFY
"KRN",101,3490,10,15,0)
2772^^12^
"KRN",101,3490,10,15,"^")
VALM BLANK 1
"KRN",101,3490,10,16,0)
5741^^16^
"KRN",101,3490,10,16,"^")
TIU BROWSE ACTION ID NOTE
"KRN",101,3490,15)
S:$D(DIROUT) TIUQUIT=1
"KRN",101,3490,20)
S XQORM("SH")=0
"KRN",101,3490,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,3490,26)
S VALMSG="+ Next Screen  - Prev Screen  ?? More actions" D RESIZE^TIULM(21,18),SHOW^VALM
"KRN",101,3490,28)
Select Action: 
"KRN",101,3490,99)
58521,39030
"KRN",101,3499,-1)
0^45
"KRN",101,3499,0)
TIU ACTION MENU CLINICIAN^Act on Documents^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3499,1,0)
^^1^1^2970309^^^^
"KRN",101,3499,1,1,0)
Menu of actions which may be executed by clinicians.
"KRN",101,3499,4)
26
"KRN",101,3499,10,0)
^101.01PA^21^15
"KRN",101,3499,10,1,0)
3500^^12^
"KRN",101,3499,10,1,"^")
TIU ACTION EDIT
"KRN",101,3499,10,2,0)
3501^^23^
"KRN",101,3499,10,2,"^")
TIU ACTION PRINT
"KRN",101,3499,10,3,0)
3502^^15^
"KRN",101,3499,10,3,"^")
TIU ACTION SIGN/COSIGN
"KRN",101,3499,10,4,0)
3503^^21^
"KRN",101,3499,10,4,"^")
TIU ACTION DETAILED DISPLAY
"KRN",101,3499,10,7,0)
3506^^22^
"KRN",101,3499,10,7,"^")
TIU ACTION BROWSE FOR CLINICIAN
"KRN",101,3499,10,8,0)
3507^^35^
"KRN",101,3499,10,8,"^")
TIU ACTION QUIT
"KRN",101,3499,10,9,0)
3508^^25^^^
"KRN",101,3499,10,9,"^")
TIU ACTION CHANGE VIEW CLINICIAN
"KRN",101,3499,10,13,0)
3599^^11^
"KRN",101,3499,10,13,"^")
TIU ACTION ADD DOCUMENT
"KRN",101,3499,10,14,0)
3602^^14^
"KRN",101,3499,10,14,"^")
TIU ACTION MENU LINK
"KRN",101,3499,10,16,0)
4054^^13^
"KRN",101,3499,10,16,"^")
TIU ACTION MAKE ADDENDUM
"KRN",101,3499,10,17,0)
3516^^31^
"KRN",101,3499,10,17,"^")
TIU ACTION DELETE
"KRN",101,3499,10,18,0)
4159^^24^
"KRN",101,3499,10,18,"^")
TIU ACTION DESIGNATE SIGNERS
"KRN",101,3499,10,19,0)
5128^^34^
"KRN",101,3499,10,19,"^")
TIU ACTION EDIT ENCOUNTER
"KRN",101,3499,10,20,0)
5740^^32^
"KRN",101,3499,10,20,"^")
TIU ACTION ID NOTE
"KRN",101,3499,10,21,0)
5491^^33^
"KRN",101,3499,10,21,"^")
TIU ACTION EXPAND LIST
"KRN",101,3499,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT) S:$G(TIUGLINK) VALMSG=$$LINKMSG^TIUGR2(TIUGLINK)
"KRN",101,3499,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,3499,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,17),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,3499,28)
Select Action: 
"KRN",101,3499,99)
58521,34128
"KRN",101,3500,-1)
0^76
"KRN",101,3500,0)
TIU ACTION EDIT^Edit^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3500,1,0)
^^4^4^2980304^^^^
"KRN",101,3500,1,1,0)
Allows authorized users to edit selected documents online...When electronic
"KRN",101,3500,1,2,0)
signature is enabled, physicians will be prompted for their signatures upon
"KRN",101,3500,1,3,0)
exit, thereby allowing doctors to review, edit and sign as a one-step
"KRN",101,3500,1,4,0)
process.
"KRN",101,3500,15)

"KRN",101,3500,20)
D EDIT^TIURA
"KRN",101,3500,24)
I '$G(TIUGLINK)
"KRN",101,3500,99)
57061,57315
"KRN",101,3501,-1)
0^1
"KRN",101,3501,0)
TIU ACTION PRINT^Print^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3501,1,0)
^^2^2^2980304^
"KRN",101,3501,1,1,0)
Allows authorized users to print copies of selected documents to a
"KRN",101,3501,1,2,0)
specified device.
"KRN",101,3501,20)
D PRINT^TIURA
"KRN",101,3501,24)
I '$G(TIUGLINK)
"KRN",101,3501,99)
58382,35756
"KRN",101,3502,-1)
0^49
"KRN",101,3502,0)
TIU ACTION SIGN/COSIGN^Sign/Cosign^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3502,1,0)
^^6^6^2980305^
"KRN",101,3502,1,1,0)
Allows clinicians to electronically sign selected documents or addenda.
"KRN",101,3502,1,2,0)
 
"KRN",101,3502,1,3,0)
NOTE:  Electronic signature carries the same legal ramifications that wet
"KRN",101,3502,1,4,0)
signature of a hard-copy document carries.  You are advised to carefully
"KRN",101,3502,1,5,0)
review each document for content and accuracy before exercising this
"KRN",101,3502,1,6,0)
option.
"KRN",101,3502,20)
D ELSIG^TIURS1
"KRN",101,3502,24)
I '$G(TIUGLINK)
"KRN",101,3502,99)
57061,57315
"KRN",101,3503,-1)
0^16
"KRN",101,3503,0)
TIU ACTION DETAILED DISPLAY^Detailed Display^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3503,1,0)
^^3^3^2980304^
"KRN",101,3503,1,1,0)
Displays the all of the details concerning the selected document's
"KRN",101,3503,1,2,0)
history, including audit trail and reassignment history, in addition to
"KRN",101,3503,1,3,0)
the narrative body of the document.
"KRN",101,3503,2,0)
^101.02A^2^2
"KRN",101,3503,2,1,0)
DT
"KRN",101,3503,2,2,0)
DD
"KRN",101,3503,2,"B","DD",2)

"KRN",101,3503,2,"B","DT",1)

"KRN",101,3503,20)
D DISPLAY^TIURA2
"KRN",101,3503,24)

"KRN",101,3503,99)
58382,35757
"KRN",101,3504,-1)
0^84
"KRN",101,3504,0)
TIU ACTION NEXT SCREEN^Next screen^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3504,1,0)
^^2^2^2931129^
"KRN",101,3504,1,1,0)
If multiple screens of information are available, this will page to the
"KRN",101,3504,1,2,0)
next screen.
"KRN",101,3504,20)
D NEXT^VALM4
"KRN",101,3504,99)
58519,52195
"KRN",101,3505,-1)
0^85
"KRN",101,3505,0)
TIU ACTION PREVIOUS SCREEN^Previous Screen^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3505,1,0)
^^3^3^2921123^
"KRN",101,3505,1,1,0)
If multiple screens of information are available, and the user is not on
"KRN",101,3505,1,2,0)
the first screen, this will allow paging back to the previous screens,
"KRN",101,3505,1,3,0)
one at a time.
"KRN",101,3505,20)
D PREV^VALM4
"KRN",101,3505,99)
58519,52195
"KRN",101,3506,-1)
0^11
"KRN",101,3506,0)
TIU ACTION BROWSE FOR CLINICIAN^Browse^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3506,1,0)
^101.06^4^4^3010109^^^^
"KRN",101,3506,1,1,0)
Allows users to browse through Documents from the Review Screen.
"KRN",101,3506,1,2,0)
In addition to scrolling sequentially through the selected documents
"KRN",101,3506,1,3,0)
and their addenda, the user may Search for a particular word or
"KRN",101,3506,1,4,0)
phrase, or Print draft copies to a selected device.
"KRN",101,3506,15)

"KRN",101,3506,20)
D:$G(TIUGLINK) BROWSE^TIURA2("TIU BROWSE FOR READ ONLY") D:'$G(TIUGLINK) BROWSE^TIURA2("TIU BROWSE FOR CLINICIAN")
"KRN",101,3506,24)

"KRN",101,3506,99)
58382,35757
"KRN",101,3507,-1)
0^7
"KRN",101,3507,0)
TIU ACTION QUIT^Quit^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3507,1,0)
^^1^1^3010412^
"KRN",101,3507,1,1,0)
Allows user to quit the current menu level.
"KRN",101,3507,2,0)
^101.02A^^0
"KRN",101,3507,20)
Q
"KRN",101,3507,99)
58519,52195
"KRN",101,3508,-1)
0^37
"KRN",101,3508,0)
TIU ACTION CHANGE VIEW CLINICIAN^Change View^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3508,1,0)
^^2^2^2970309^^
"KRN",101,3508,1,1,0)
Allows users to modify the list of reports by signature status, review
"KRN",101,3508,1,2,0)
screen and dictation date range without exiting the review screen.
"KRN",101,3508,15)

"KRN",101,3508,20)
K TIUQUIK,VALMY D FIXLSTNW^TIULM,FULL^VALM1,MAKELIST^TIUR($S(+$G(^TMP("TIUR",$J,"CLASS")):+$G(^TMP("TIUR",$J,"CLASS")),1:38),1) S VALMBCK="R",VALMBG=1
"KRN",101,3508,99)
57061,57315
"KRN",101,3509,-1)
0^86
"KRN",101,3509,0)
TIU ACTION TOP^First Screen^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3509,1,0)
^^1^1^2930225^
"KRN",101,3509,1,1,0)
If multiple screens are available, this will page to the first screen.
"KRN",101,3509,20)
D FIRST^VALM4
"KRN",101,3509,99)
58519,52195
"KRN",101,3510,-1)
0^87
"KRN",101,3510,0)
TIU ACTION BOTTOM^Last Screen^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3510,1,0)
^^2^2^2950420^^
"KRN",101,3510,1,1,0)
If multiple screens of information are available, this will page to the
"KRN",101,3510,1,2,0)
last screen.
"KRN",101,3510,20)
D LAST^VALM4
"KRN",101,3510,99)
58519,52195
"KRN",101,3512,-1)
0^59
"KRN",101,3512,0)
TIU BROWSE MENU CLINICIAN^Review/edit/sign^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3512,1,0)
^101.06^1^1^3001026^^^^
"KRN",101,3512,1,1,0)
Menu of actions which may be executed by clinicians.
"KRN",101,3512,4)
26
"KRN",101,3512,10,0)
^101.01PA^16^16
"KRN",101,3512,10,3,0)
3526^^5^
"KRN",101,3512,10,3,"^")
TIU BROWSE ACTION EDIT
"KRN",101,3512,10,4,0)
3527^^3^
"KRN",101,3512,10,4,"^")
TIU BROWSE ACTION PRINT
"KRN",101,3512,10,5,0)
3532^^9^
"KRN",101,3512,10,5,"^")
TIU BROWSE ACTION SIGN/COSIGN
"KRN",101,3512,10,6,0)
3507^^23^
"KRN",101,3512,10,6,"^")
TIU ACTION QUIT
"KRN",101,3512,10,7,0)
3529^^1^
"KRN",101,3512,10,7,"^")
TIU BROWSE ACTION SEARCH
"KRN",101,3512,10,8,0)
3744^^11^
"KRN",101,3512,10,8,"^")
TIU BROWSE ACTION COPY
"KRN",101,3512,10,9,0)
4055^^7^
"KRN",101,3512,10,9,"^")
TIU BROWSE ACTION MAKE ADDENDUM
"KRN",101,3512,10,10,0)
3525^^15^
"KRN",101,3512,10,10,"^")
TIU BROWSE ACTION DELETE
"KRN",101,3512,10,11,0)
4174^^13^
"KRN",101,3512,10,11,"^")
TIU BROWSE ACTION DESIGNATE SIGNERS
"KRN",101,3512,10,14,0)
4769^^17^
"KRN",101,3512,10,14,"^")
TIU BROWSE MENU LINK
"KRN",101,3512,10,15,0)
5129^^19^
"KRN",101,3512,10,15,"^")
TIU BROWSE ACTION EDIT ENCOUNTER
"KRN",101,3512,10,16,0)
5741^^21^
"KRN",101,3512,10,16,"^")
TIU BROWSE ACTION ID NOTE
"KRN",101,3512,15)
S:$D(DIROUT) TIUQUIT=1
"KRN",101,3512,20)
S XQORM("SH")=0
"KRN",101,3512,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,3512,26)
S VALMSG="+ Next Screen  - Prev Screen  ?? More actions" D RESIZE^TIULM(21,18),SHOW^VALM
"KRN",101,3512,28)
Select Action: 
"KRN",101,3512,99)
58538,64051
"KRN",101,3513,-1)
0^74
"KRN",101,3513,0)
TIU ACTION AMEND^Amend Document^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3513,1,0)
^^2^2^2980304^^^^
"KRN",101,3513,1,1,0)
Allows authorized users to AMEND documents at the patient's request, per
"KRN",101,3513,1,2,0)
the Privacy Act.
"KRN",101,3513,20)
D AMEND^TIURB
"KRN",101,3513,99)
57061,57316
"KRN",101,3515,-1)
0^39
"KRN",101,3515,0)
TIU ACTION CHANGE VIEW OTHER^Change View^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3515,1,0)
^^4^4^2980304^
"KRN",101,3515,1,1,0)
Allows MIS users to modify the list of documents by STATUS, DOCUMENT
"KRN",101,3515,1,2,0)
TYPE, SEARCH CATEGORY (e.g., AUTHOR, EXPECTED COSIGNER, SERVICE,
"KRN",101,3515,1,3,0)
HOSPITAL LOCATION, etc.) and REFERENCE DATE range without exiting the
"KRN",101,3515,1,4,0)
review screen.
"KRN",101,3515,20)
K VALMY D FIXLSTNW^TIULM,FULL^VALM1,MAKELIST^TIUR($S(+$G(^TMP("TIUR",$J,"CLASS")):+$G(^TMP("TIUR",$J,"CLASS")),1:38)) S VALMBCK="R",VALMBG=1
"KRN",101,3515,99)
57061,57316
"KRN",101,3516,-1)
0^20
"KRN",101,3516,0)
TIU ACTION DELETE^Delete Document^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3516,1,0)
^^2^2^2980304^
"KRN",101,3516,1,1,0)
Allows authorized users (as defined by your local business rules in ASU)
"KRN",101,3516,1,2,0)
to delete a document at the patient's request, per the Privacy Act.
"KRN",101,3516,20)
D DELETE^TIURB2
"KRN",101,3516,24)
I '$G(TIUGLINK)
"KRN",101,3516,99)
58382,35757
"KRN",101,3518,-1)
0^96
"KRN",101,3518,0)
TIU ACTION MENU MRT^Act on Documents^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3518,1,0)
^101.06^1^1^3010220^^^^
"KRN",101,3518,1,1,0)
Menu of actions which may be executed by Medical Records Technicians.
"KRN",101,3518,4)
26
"KRN",101,3518,10,0)
^101.01PA^17^12
"KRN",101,3518,10,1,0)
3500^^7^
"KRN",101,3518,10,1,"^")
TIU ACTION EDIT
"KRN",101,3518,10,2,0)
3501^^19^
"KRN",101,3518,10,2,"^")
TIU ACTION PRINT
"KRN",101,3518,10,3,0)
3503^^15^
"KRN",101,3518,10,3,"^")
TIU ACTION DETAILED DISPLAY
"KRN",101,3518,10,6,0)
3523^^3^
"KRN",101,3518,10,6,"^")
TIU ACTION VERIFY
"KRN",101,3518,10,7,0)
3691^^17^
"KRN",101,3518,10,7,"^")
TIU ACTION BROWSE FOR MRT
"KRN",101,3518,10,8,0)
3507^^23^
"KRN",101,3518,10,8,"^")
TIU ACTION QUIT
"KRN",101,3518,10,9,0)
3522^^5^
"KRN",101,3518,10,9,"^")
TIU ACTION SIGN ON CHART
"KRN",101,3518,10,10,0)
3520^^9^
"KRN",101,3518,10,10,"^")
TIU ACTION REASSIGN
"KRN",101,3518,10,11,0)
3515^^21^
"KRN",101,3518,10,11,"^")
TIU ACTION CHANGE VIEW OTHER
"KRN",101,3518,10,12,0)
3521^^13^
"KRN",101,3518,10,12,"^")
TIU ACTION SEND BACK
"KRN",101,3518,10,16,0)
5039^^11^
"KRN",101,3518,10,16,"^")
TIU ACTION LINK WITH CLIENT RECORD
"KRN",101,3518,10,17,0)
5740^^20^
"KRN",101,3518,10,17,"^")
TIU ACTION ID NOTE
"KRN",101,3518,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT) S:$G(TIUGLINK) VALMSG=$$LINKMSG^TIUGR2(TIUGLINK)
"KRN",101,3518,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,3518,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,18),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,3518,28)
Select Action: 
"KRN",101,3518,99)
58526,41300
"KRN",101,3520,-1)
0^56
"KRN",101,3520,0)
TIU ACTION REASSIGN^Reassign^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3520,1,0)
^^6^6^3010301^
"KRN",101,3520,1,1,0)
Allows authorized users to reassign Documents which have been
"KRN",101,3520,1,2,0)
inappropriately assigned to a given patient or the wrong admission/visit.
"KRN",101,3520,1,3,0)
Authorized users can also reassign a signed Original or Addendum, promote
"KRN",101,3520,1,4,0)
an Addendum as an Original, or "swap" the Addendum and the Original.
"KRN",101,3520,1,5,0)
 
"KRN",101,3520,1,6,0)
Interdisciplinary entries must be detached before they can be reassigned.
"KRN",101,3520,15)
S VALMBCK="R"
"KRN",101,3520,20)
D REASSIGN^TIURD
"KRN",101,3520,24)
I '$G(TIUGLINK)
"KRN",101,3520,99)
57061,57317
"KRN",101,3521,-1)
0^57
"KRN",101,3521,0)
TIU ACTION SEND BACK^Send Back^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3521,1,0)
^^7^7^3010301^
"KRN",101,3521,1,1,0)
Allows Medical Record Technicians or MIS Managers to send a Document back
"KRN",101,3521,1,2,0)
to transcription for editing, provided that it has not yet been signed.
"KRN",101,3521,1,3,0)
The status of the Document is changed to "unreleased" and clinicians and MAS
"KRN",101,3521,1,4,0)
personnel are prevented from viewing it until the modifications have been 
"KRN",101,3521,1,5,0)
made, and the Document has been re-released.
"KRN",101,3521,1,6,0)
 
"KRN",101,3521,1,7,0)
Interdiciplinary entries must be detached before they can be sent back.
"KRN",101,3521,20)
D SENDBACK^TIURB
"KRN",101,3521,24)
I '$G(TIUGLINK)
"KRN",101,3521,99)
57061,57318
"KRN",101,3522,-1)
0^55
"KRN",101,3522,0)
TIU ACTION SIGN ON CHART^On Chart^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3522,1,0)
^^5^5^2980304^^^^
"KRN",101,3522,1,1,0)
Allows MIS clerks to mark documents as "signed on chart."
"KRN",101,3522,1,2,0)

"KRN",101,3522,1,3,0)
NOTE:  This step is NECESSARY when the provider elects to sign the chart
"KRN",101,3522,1,4,0)
copy of the document, rather than entering his/her electronic signature
"KRN",101,3522,1,5,0)
on-line.
"KRN",101,3522,20)
D SIGNCHRT^TIURT
"KRN",101,3522,24)
I '$G(TIUGLINK)
"KRN",101,3522,99)
57061,57318
"KRN",101,3523,-1)
0^54
"KRN",101,3523,0)
TIU ACTION VERIFY^Verify/Unverify^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3523,1,0)
^^7^7^3010301^
"KRN",101,3523,1,1,0)
Allows MIS personnel to review, edit, and verify/unverify Documents.
"KRN",101,3523,1,2,0)
 
"KRN",101,3523,1,3,0)
Interdisciplinary entries must be detached before they can be
"KRN",101,3523,1,4,0)
verified/unverified.
"KRN",101,3523,1,5,0)
 
"KRN",101,3523,1,6,0)
NOTE:  This action may only be applied to Documents which are specified
"KRN",101,3523,1,7,0)
as requiring MAS verification.
"KRN",101,3523,20)
D VERIFY^TIURC
"KRN",101,3523,24)
I '$G(TIUGLINK)
"KRN",101,3523,99)
57061,57318
"KRN",101,3524,-1)
0^71
"KRN",101,3524,0)
TIU BROWSE ACTION AMEND^Amend^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3524,1,0)
^^2^2^2950628^^^
"KRN",101,3524,1,1,0)
Allows authorized users to amend current document at the
"KRN",101,3524,1,2,0)
patient's request, per the Privacy Act.
"KRN",101,3524,20)
D AMEND1^TIURB,BLDTMP^TIUBR(TIUDA) S VALMBCK="R"
"KRN",101,3524,99)
57061,57318
"KRN",101,3525,-1)
0^22
"KRN",101,3525,0)
TIU BROWSE ACTION DELETE^Delete^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3525,1,0)
^^2^2^2980305^
"KRN",101,3525,1,1,0)
Allows authorized users (as defined by your local business rules in
"KRN",101,3525,1,2,0)
ASU) to delete a document at the patient's request, per the Privacy Act.
"KRN",101,3525,20)
D DEL^TIURB2(TIUDA) S VALMBCK="Q"
"KRN",101,3525,99)
58382,35757
"KRN",101,3526,-1)
0^25
"KRN",101,3526,0)
TIU BROWSE ACTION EDIT^Edit^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3526,1,0)
^^4^4^2950628^^^^
"KRN",101,3526,1,1,0)
Allows authorized users to edit current document online...When electronic
"KRN",101,3526,1,2,0)
signature is enabled, physicians will be prompted for their signatures upon
"KRN",101,3526,1,3,0)
exit, thereby allowing doctors to review, edit and sign as a one-step
"KRN",101,3526,1,4,0)
process. 
"KRN",101,3526,20)
S TIUCHNG=0 D CLEAR^VALM1,EDIT1^TIURA,BLDTMP^TIUBR(TIUDA) S VALMBCK=$S($D(^TIU(8925,TIUDA)):"R",1:"Q")
"KRN",101,3526,99)
58382,35757
"KRN",101,3527,-1)
0^64
"KRN",101,3527,0)
TIU BROWSE ACTION PRINT^Print^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3527,1,0)
^^2^2^2950628^^^^
"KRN",101,3527,1,1,0)
Allows users to print copies of selected documents on their corresponding VA 
"KRN",101,3527,1,2,0)
Standard Forms to a specified device.
"KRN",101,3527,20)
D CLEAR^VALM1,PRINT1^TIURA S VALMBCK="R"
"KRN",101,3527,99)
58382,35758
"KRN",101,3528,-1)
0^68
"KRN",101,3528,0)
TIU BROWSE ACTION REASSIGN^Reassign^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3528,1,0)
^^3^3^2980305^
"KRN",101,3528,1,1,0)
Allows authorized users (as defined by your local business rules in ASU)
"KRN",101,3528,1,2,0)
to reassign the current document which has been inappropriately assigned
"KRN",101,3528,1,3,0)
to a given patient or the wrong visit/admission.
"KRN",101,3528,20)
D REASSIG1^TIURD
"KRN",101,3528,99)
57061,57318
"KRN",101,3529,-1)
0^65
"KRN",101,3529,0)
TIU BROWSE ACTION SEARCH^Find^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3529,1,0)
^^5^5^2980305^
"KRN",101,3529,1,1,0)
Allows users to search for a text string (word or partial word) from the
"KRN",101,3529,1,2,0)
current position in the summary through its end.  Upon reaching
"KRN",101,3529,1,3,0)
the end of the document, the user will be asked whether to continue the
"KRN",101,3529,1,4,0)
search from the beginning of the document through the origin of the
"KRN",101,3529,1,5,0)
search.
"KRN",101,3529,20)
D FIND^VALM40
"KRN",101,3529,99)
58382,35758
"KRN",101,3530,-1)
0^72
"KRN",101,3530,0)
TIU BROWSE ACTION SEND BACK^Send Back^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3530,1,0)
^^5^5^2980305^
"KRN",101,3530,1,1,0)
Allows Medical Record Technicians or MIS Managers to send the current
"KRN",101,3530,1,2,0)
document back to transcription to be edited, if it hasn't been signed yet.
"KRN",101,3530,1,3,0)
The status of the document is changed to "unreleased" and clinicians and 
"KRN",101,3530,1,4,0)
MAS personnel are prevented from viewing it until the modifications have
"KRN",101,3530,1,5,0)
been made, and the document has been re-released.
"KRN",101,3530,20)
D SENDBACK^TIUT(TIUDA) S VALMBCK=$S(+$P(^TIU(8925,+TIUDA,13),U,4):"R",1:"Q")
"KRN",101,3530,99)
57061,57318
"KRN",101,3531,-1)
0^70
"KRN",101,3531,0)
TIU BROWSE ACTION SIGN ON CHART^On Chart^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3531,1,0)
^^1^1^2980305^
"KRN",101,3531,1,1,0)
Allows MIS clerks to mark current document as "signed on chart."
"KRN",101,3531,20)
D SIGCHRT1^TIURT($G(TIUDA))
"KRN",101,3531,99)
57061,57318
"KRN",101,3532,-1)
0^66
"KRN",101,3532,0)
TIU BROWSE ACTION SIGN/COSIGN^Sign/Cosign^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3532,1,0)
^^6^6^2980305^
"KRN",101,3532,1,1,0)
Allows clinicians to electronically sign the current document.
"KRN",101,3532,1,2,0)
 
"KRN",101,3532,1,3,0)
NOTE:  Electronic signature carries the same legal ramifications that wet
"KRN",101,3532,1,4,0)
signature of a hard-copy document carries.  You are advised to carefully
"KRN",101,3532,1,5,0)
review each document for content and accuracy before exercising this
"KRN",101,3532,1,6,0)
option.
"KRN",101,3532,15)
S VALMBCK="Q"
"KRN",101,3532,20)
D EDSIG^TIURS(TIUDA,$G(TIUDATA),1)
"KRN",101,3532,24)

"KRN",101,3532,99)
58382,35758
"KRN",101,3533,-1)
0^73
"KRN",101,3533,0)
TIU BROWSE ACTION VERIFY^Verify/Unverify^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3533,1,0)
^^5^5^2980305^
"KRN",101,3533,1,1,0)
Allows MIS personnel to review, edit, and verify/unverify the current
"KRN",101,3533,1,2,0)
document.
"KRN",101,3533,1,3,0)
 
"KRN",101,3533,1,4,0)
NOTE:  This action may only be selected when the site parameter to require
"KRN",101,3533,1,5,0)
MAS verification is set.
"KRN",101,3533,15)
S VALMBCK="Q"
"KRN",101,3533,20)
D VERIFY1^TIURC
"KRN",101,3533,24)
; If verification is required
"KRN",101,3533,99)
57061,57318
"KRN",101,3534,-1)
0^98
"KRN",101,3534,0)
TIU BROWSE MENU MRT^Review/edit/sign^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3534,1,0)
^^1^1^2950628^^
"KRN",101,3534,1,1,0)
Menu of actions which may be executed by clinicians.
"KRN",101,3534,4)
26
"KRN",101,3534,10,0)
^101.01PA^14^9
"KRN",101,3534,10,3,0)
3526^^7^
"KRN",101,3534,10,3,"^")
TIU BROWSE ACTION EDIT
"KRN",101,3534,10,4,0)
3527^^13^
"KRN",101,3534,10,4,"^")
TIU BROWSE ACTION PRINT
"KRN",101,3534,10,5,0)
3507^^15^
"KRN",101,3534,10,5,"^")
TIU ACTION QUIT
"KRN",101,3534,10,9,0)
3533^^3^
"KRN",101,3534,10,9,"^")
TIU BROWSE ACTION VERIFY
"KRN",101,3534,10,10,0)
3531^^5^
"KRN",101,3534,10,10,"^")
TIU BROWSE ACTION SIGN ON CHART
"KRN",101,3534,10,11,0)
3530^^9^
"KRN",101,3534,10,11,"^")
TIU BROWSE ACTION SEND BACK
"KRN",101,3534,10,12,0)
3528^^11^
"KRN",101,3534,10,12,"^")
TIU BROWSE ACTION REASSIGN
"KRN",101,3534,10,13,0)
3744^^12^
"KRN",101,3534,10,13,"^")
TIU BROWSE ACTION COPY
"KRN",101,3534,10,14,0)
5741^^14^
"KRN",101,3534,10,14,"^")
TIU BROWSE ACTION ID NOTE
"KRN",101,3534,15)
S:$D(DIROUT) TIUQUIT=1
"KRN",101,3534,20)
S XQORM("SH")=0
"KRN",101,3534,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,3534,26)
S VALMSG="+ Next Screen  - Prev Screen  ?? More actions" D RESIZE^TIULM(21,18),SHOW^VALM
"KRN",101,3534,28)
Select Action: 
"KRN",101,3534,99)
58521,42119
"KRN",101,3599,-1)
0^4
"KRN",101,3599,0)
TIU ACTION ADD DOCUMENT^Add Document^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3599,1,0)
^101.06^1^1^3010111^^^
"KRN",101,3599,1,1,0)
Enter a new Document.
"KRN",101,3599,2,0)
^101.02A^1^1
"KRN",101,3599,2,1,0)
NW
"KRN",101,3599,2,"B","NW",1)

"KRN",101,3599,15)
S VALMBCK="R"
"KRN",101,3599,20)
D ADD^TIURC
"KRN",101,3599,24)
I '$G(TIUGLINK)
"KRN",101,3599,99)
58382,35758
"KRN",101,3600,-1)
0^81
"KRN",101,3600,0)
TIU ACTION LINK TO VISIT^Patient/Visit^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3600,1,0)
^^4^4^3010301^
"KRN",101,3600,1,1,0)
Allows authorized users to create or revise the linkage of any document to 
"KRN",101,3600,1,2,0)
the corresponding encounter with the patient.
"KRN",101,3600,1,3,0)
 
"KRN",101,3600,1,4,0)
Interdisciplinary entries must be detached before they can be relinked.
"KRN",101,3600,15)
S VALMBCK="R"
"KRN",101,3600,20)
D REASSIGN^TIURD
"KRN",101,3600,99)
57316,37868
"KRN",101,3601,-1)
0^80
"KRN",101,3601,0)
TIU ACTION LINK TO PROBLEMS^Problems^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3601,1,0)
^^2^2^2980304^^
"KRN",101,3601,1,1,0)
Allows authorized users to link documents to problems in a many-to-many 
"KRN",101,3601,1,2,0)
fashion.
"KRN",101,3601,15)

"KRN",101,3601,20)
D LINK^TIURB
"KRN",101,3601,99)
57061,57322
"KRN",101,3602,-1)
0^77
"KRN",101,3602,0)
TIU ACTION MENU LINK^Link ...^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3602,1,0)
^^4^4^2980304^^
"KRN",101,3602,1,1,0)
Allows authorized users to link documents to either problems, visits, or 
"KRN",101,3602,1,2,0)
records in other applications (e.g., Consult Results to Consult Requests,
"KRN",101,3602,1,3,0)
Operative Reports to Sugical Cases, etc.). Such associations permit a
"KRN",101,3602,1,4,0)
variety of clinically useful "views" of the on-line record.
"KRN",101,3602,4)
26
"KRN",101,3602,10,0)
^101.01PA^3^3
"KRN",101,3602,10,1,0)
3601^^1^
"KRN",101,3602,10,1,"^")
TIU ACTION LINK TO PROBLEMS
"KRN",101,3602,10,2,0)
3600^^3^
"KRN",101,3602,10,2,"^")
TIU ACTION LINK TO VISIT
"KRN",101,3602,10,3,0)
5039^^5^
"KRN",101,3602,10,3,"^")
TIU ACTION LINK WITH CLIENT RECORD
"KRN",101,3602,15)

"KRN",101,3602,20)
S XQORM(0)="AD",VALMBCK=""
"KRN",101,3602,24)
I '$G(TIUGLINK)
"KRN",101,3602,26)
W !
"KRN",101,3602,28)
Specify Linkage: 
"KRN",101,3602,99)
57954,34692
"KRN",101,3638,-1)
0^18
"KRN",101,3638,0)
TIU ACTION SELECT LIST ELEMENT^Select Item^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3638,1,0)
^^1^1^2970613^
"KRN",101,3638,1,1,0)
Select one or more items from the current list of documents.
"KRN",101,3638,20)
D PICK^TIULM($P($G(XQORNOD(0)),"=",2)) S VALMBCK="R"
"KRN",101,3638,99)
58382,35758
"KRN",101,3690,-1)
0^12
"KRN",101,3690,0)
TIU ACTION BROWSE FOR MGR^Browse^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3690,1,0)
^101.06^4^4^3010109^^^^
"KRN",101,3690,1,1,0)
Allows users to browse through Documents from the Review Screen.
"KRN",101,3690,1,2,0)
In addition to scrolling sequentially through the selected documents
"KRN",101,3690,1,3,0)
and their addenda, the user may Search for a particular word or
"KRN",101,3690,1,4,0)
phrase, or Print draft copies to a selected device.
"KRN",101,3690,20)
D:$G(TIUGLINK) BROWSE^TIURA2("TIU BROWSE FOR READ ONLY") D:'$G(TIUGLINK) BROWSE^TIURA2("TIU BROWSE FOR MGR")
"KRN",101,3690,99)
58382,35758
"KRN",101,3691,-1)
0^13
"KRN",101,3691,0)
TIU ACTION BROWSE FOR MRT^Browse^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3691,1,0)
^101.06^4^4^3010109^^^^
"KRN",101,3691,1,1,0)
Allows users to browse through Documents from the Review Screen.
"KRN",101,3691,1,2,0)
In addition to scrolling sequentially through the selected documents
"KRN",101,3691,1,3,0)
and their addenda, the user may Search for a particular word or
"KRN",101,3691,1,4,0)
phrase, or Print draft copies to a selected device.
"KRN",101,3691,20)
D:$G(TIUGLINK) BROWSE^TIURA2("TIU BROWSE FOR READ ONLY") D:'$G(TIUGLINK) BROWSE^TIURA2("TIU BROWSE FOR MRT")
"KRN",101,3691,99)
58382,35758
"KRN",101,3692,-1)
0^15
"KRN",101,3692,0)
TIU ACTION BROWSE FOR READ ONLY^Browse^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3692,1,0)
^^4^4^2950426^^
"KRN",101,3692,1,1,0)
Allows users to browse through Documents from the Review Screen.
"KRN",101,3692,1,2,0)
In addition to scrolling sequentially through the selected documents
"KRN",101,3692,1,3,0)
and their addenda, the user may Search for a particular word or
"KRN",101,3692,1,4,0)
phrase, or Print draft copies to a selected device.
"KRN",101,3692,20)
D BROWSE^TIURA2("TIU BROWSE FOR READ ONLY")
"KRN",101,3692,99)
58382,35758
"KRN",101,3744,-1)
0^21
"KRN",101,3744,0)
TIU BROWSE ACTION COPY^Copy^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3744,1,0)
^^4^4^2950628^^^^
"KRN",101,3744,1,1,0)
Allows authorized users to duplicate the current document.  This is 
"KRN",101,3744,1,2,0)
especially useful when composing a note for a group of patients (e.g., 
"KRN",101,3744,1,3,0)
therapy group, etc.), and rapid duplication to all members of the group is 
"KRN",101,3744,1,4,0)
appropriate.
"KRN",101,3744,20)
D COPY1^TIURC1
"KRN",101,3744,99)
58382,35758
"KRN",101,3745,-1)
0^19
"KRN",101,3745,0)
TIU ACTION COPY^Copy^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3745,1,0)
^^3^3^2950628^^^^
"KRN",101,3745,1,1,0)
Allows authorized users to copy one or more documents to other patients and 
"KRN",101,3745,1,2,0)
encounters...This is particularly useful when documenting group sessions, 
"KRN",101,3745,1,3,0)
etc.
"KRN",101,3745,15)
S VALMBCK="R"
"KRN",101,3745,20)
D COPY^TIURC1
"KRN",101,3745,24)
I '$G(TIUGLINK)
"KRN",101,3745,99)
58382,35758
"KRN",101,4054,-1)
0^3
"KRN",101,4054,0)
TIU ACTION MAKE ADDENDUM^Make Addendum^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4054,1,0)
^^4^4^2951213^^^^
"KRN",101,4054,1,1,0)
Allows authorized users to add addenda to selected documents online...
"KRN",101,4054,1,2,0)
When electronic signature is enabled, physicians will be prompted for
"KRN",101,4054,1,3,0)
their signatures upon exit, thereby allowing doctors to review, edit
"KRN",101,4054,1,4,0)
and sign as a one-step process.
"KRN",101,4054,20)
D ADDEND^TIURA1
"KRN",101,4054,24)
I '$G(TIUGLINK)
"KRN",101,4054,99)
58382,35758
"KRN",101,4055,-1)
0^63
"KRN",101,4055,0)
TIU BROWSE ACTION MAKE ADDENDUM^Make Addendum^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4055,1,0)
^^4^4^2951213^^^^
"KRN",101,4055,1,1,0)
Allows authorized users to add an addendum to the current document online...
"KRN",101,4055,1,2,0)
When electronic signature is enabled, physicians will be prompted for their
"KRN",101,4055,1,3,0)
signatures upon exit, thereby allowing doctors to review, edit and sign as
"KRN",101,4055,1,4,0)
a one-step process. 
"KRN",101,4055,20)
D CLEAR^VALM1,ADDEND1^TIURA1,BLDTMP^TIUBR(TIUDA) S VALMBCK="R"
"KRN",101,4055,99)
58382,35758
"KRN",101,4083,-1)
0^41
"KRN",101,4083,0)
TIU ACTION CHANGE VIEW TITLE^Change View^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4083,1,0)
^^2^2^2921125^
"KRN",101,4083,1,1,0)
Allows users to modify the list of reports by signature status, review
"KRN",101,4083,1,2,0)
screen and dictation date range without exiting the review screen.
"KRN",101,4083,20)
K TIUQUIK,VALMY D FIXLSTNW^TIULM,FULL^VALM1,MAKELIST^TIURTITL($S(+$G(^TMP("TIUR",$J,"CLASS")):+$G(^TMP("TIUR",$J,"CLASS")),1:38)) S VALMBCK="R",VALMBG=1
"KRN",101,4083,99)
57061,57325
"KRN",101,4084,-1)
0^48
"KRN",101,4084,0)
TIU ACTION MENU TITLE REVIEW^Act on Documents^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4084,1,0)
^^1^1^2951213^^^^
"KRN",101,4084,1,1,0)
Menu of actions which may be executed by clinicians.
"KRN",101,4084,4)
26
"KRN",101,4084,10,0)
^101.01PA^17^12
"KRN",101,4084,10,1,0)
3500^^3^
"KRN",101,4084,10,1,"^")
TIU ACTION EDIT
"KRN",101,4084,10,2,0)
3501^^15^
"KRN",101,4084,10,2,"^")
TIU ACTION PRINT
"KRN",101,4084,10,3,0)
3502^^9^
"KRN",101,4084,10,3,"^")
TIU ACTION SIGN/COSIGN
"KRN",101,4084,10,4,0)
3503^^11^
"KRN",101,4084,10,4,"^")
TIU ACTION DETAILED DISPLAY
"KRN",101,4084,10,7,0)
3506^^13^
"KRN",101,4084,10,7,"^")
TIU ACTION BROWSE FOR CLINICIAN
"KRN",101,4084,10,8,0)
3507^^23^
"KRN",101,4084,10,8,"^")
TIU ACTION QUIT
"KRN",101,4084,10,9,0)
4083^^17^
"KRN",101,4084,10,9,"^")
TIU ACTION CHANGE VIEW TITLE
"KRN",101,4084,10,13,0)
3599^^1^
"KRN",101,4084,10,13,"^")
TIU ACTION ADD DOCUMENT
"KRN",101,4084,10,14,0)
3602^^7^
"KRN",101,4084,10,14,"^")
TIU ACTION MENU LINK
"KRN",101,4084,10,15,0)
3745^^19^
"KRN",101,4084,10,15,"^")
TIU ACTION COPY
"KRN",101,4084,10,16,0)
4054^^5^
"KRN",101,4084,10,16,"^")
TIU ACTION MAKE ADDENDUM
"KRN",101,4084,10,17,0)
5740^^21^
"KRN",101,4084,10,17,"^")
TIU ACTION ID NOTE
"KRN",101,4084,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT) S:$G(TIUGLINK) VALMSG=$$LINKMSG^TIUGR2(TIUGLINK)
"KRN",101,4084,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4084,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,18),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,4084,28)
Select Action: 
"KRN",101,4084,99)
58521,54824
"KRN",101,4124,-1)
0^38
"KRN",101,4124,0)
TIU ACTION CHANGE VIEW MIS^Change View^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4124,1,0)
^^2^2^2980304^
"KRN",101,4124,1,1,0)
Allows MIS users to modify the list of documents by STATUS, DOCUMENT TYPE,
"KRN",101,4124,1,2,0)
and ENTRY DATE range without exiting the review screen.
"KRN",101,4124,20)
K VALMY D FIXLSTNW^TIULM,FULL^VALM1,MAKELIST^TIURM($S(+$G(^TMP("TIUR",$J,"CLASS")):+$G(^TMP("TIUR",$J,"CLASS")),1:38)) S VALMBCK="R",VALMBG=1
"KRN",101,4124,99)
57061,57325
"KRN",101,4125,-1)
0^97
"KRN",101,4125,0)
TIU ACTION MENU MRT REVIEW^Select Action^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4125,1,0)
^^1^1^2980304^^^^
"KRN",101,4125,1,1,0)
Menu of actions which may be executed by Medical Records Technicians.
"KRN",101,4125,4)
26
"KRN",101,4125,10,0)
^101.01PA^17^12
"KRN",101,4125,10,1,0)
3500^^7^
"KRN",101,4125,10,1,"^")
TIU ACTION EDIT
"KRN",101,4125,10,2,0)
3501^^19^
"KRN",101,4125,10,2,"^")
TIU ACTION PRINT
"KRN",101,4125,10,3,0)
3503^^15^
"KRN",101,4125,10,3,"^")
TIU ACTION DETAILED DISPLAY
"KRN",101,4125,10,6,0)
3523^^3^
"KRN",101,4125,10,6,"^")
TIU ACTION VERIFY
"KRN",101,4125,10,7,0)
3691^^17^
"KRN",101,4125,10,7,"^")
TIU ACTION BROWSE FOR MRT
"KRN",101,4125,10,8,0)
3507^^23^
"KRN",101,4125,10,8,"^")
TIU ACTION QUIT
"KRN",101,4125,10,9,0)
3522^^5^
"KRN",101,4125,10,9,"^")
TIU ACTION SIGN ON CHART
"KRN",101,4125,10,10,0)
3520^^9^
"KRN",101,4125,10,10,"^")
TIU ACTION REASSIGN
"KRN",101,4125,10,11,0)
4124^^21^
"KRN",101,4125,10,11,"^")
TIU ACTION CHANGE VIEW MIS
"KRN",101,4125,10,12,0)
3521^^13^
"KRN",101,4125,10,12,"^")
TIU ACTION SEND BACK
"KRN",101,4125,10,16,0)
5039^^11^
"KRN",101,4125,10,16,"^")
TIU ACTION LINK WITH CLIENT RECORD
"KRN",101,4125,10,17,0)
5740^^20^
"KRN",101,4125,10,17,"^")
TIU ACTION ID NOTE
"KRN",101,4125,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT) S:$G(TIUGLINK) VALMSG=$$LINKMSG^TIUGR2(TIUGLINK)
"KRN",101,4125,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4125,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,18),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,4125,28)
Select Action: 
"KRN",101,4125,99)
58521,42147
"KRN",101,4126,-1)
0^46
"KRN",101,4126,0)
TIU ACTION MENU MGR REVIEW^Select Action^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4126,1,0)
^^1^1^2980304^^^^
"KRN",101,4126,1,1,0)
Menu of actions which may be executed by MIS Managers.
"KRN",101,4126,4)
26
"KRN",101,4126,10,0)
^101.01PA^19^19
"KRN",101,4126,10,1,0)
3500^^5^
"KRN",101,4126,10,1,"^")
TIU ACTION EDIT
"KRN",101,4126,10,2,0)
3501^^26^
"KRN",101,4126,10,2,"^")
TIU ACTION PRINT
"KRN",101,4126,10,3,0)
5886^^19^
"KRN",101,4126,10,3,"^")
TIU ACTION MENU DISPLAY
"KRN",101,4126,10,6,0)
3516^^11^
"KRN",101,4126,10,6,"^")
TIU ACTION DELETE
"KRN",101,4126,10,7,0)
3513^^9^
"KRN",101,4126,10,7,"^")
TIU ACTION AMEND
"KRN",101,4126,10,8,0)
3690^^21^
"KRN",101,4126,10,8,"^")
TIU ACTION BROWSE FOR MGR
"KRN",101,4126,10,9,0)
3507^^27^
"KRN",101,4126,10,9,"^")
TIU ACTION QUIT
"KRN",101,4126,10,10,0)
3522^^3^
"KRN",101,4126,10,10,"^")
TIU ACTION SIGN ON CHART
"KRN",101,4126,10,11,0)
4124^^25^
"KRN",101,4126,10,11,"^")
TIU ACTION CHANGE VIEW MIS
"KRN",101,4126,10,12,0)
3521^^17^
"KRN",101,4126,10,12,"^")
TIU ACTION SEND BACK
"KRN",101,4126,10,15,0)
4683^^1^
"KRN",101,4126,10,15,"^")
TIU ACTION SEARCH LIST
"KRN",101,4126,10,16,0)
3520^^13^
"KRN",101,4126,10,16,"^")
TIU ACTION REASSIGN
"KRN",101,4126,10,17,0)
3523^^6^
"KRN",101,4126,10,17,"^")
TIU ACTION VERIFY
"KRN",101,4126,10,18,0)
5039^^15^
"KRN",101,4126,10,18,"^")
TIU ACTION LINK WITH CLIENT RECORD
"KRN",101,4126,10,19,0)
5740^^23^
"KRN",101,4126,10,19,"^")
TIU ACTION ID NOTE
"KRN",101,4126,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT) S:$G(TIUGLINK) VALMSG=$$LINKMSG^TIUGR2(TIUGLINK)
"KRN",101,4126,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4126,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,17),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,4126,28)
Select Action: 
"KRN",101,4126,99)
58543,63496
"KRN",101,4159,-1)
0^78
"KRN",101,4159,0)
TIU ACTION DESIGNATE SIGNERS^Identify Signers^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4159,1,0)
^^2^2^2960605^
"KRN",101,4159,1,1,0)
Allows authorized users to identify additional signers for a given
"KRN",101,4159,1,2,0)
document.
"KRN",101,4159,20)
D NAME^TIURA1
"KRN",101,4159,24)
I '$G(TIUGLINK)
"KRN",101,4159,99)
57061,57326
"KRN",101,4174,-1)
0^61
"KRN",101,4174,0)
TIU BROWSE ACTION DESIGNATE SIGNERS^Identify Signers^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4174,1,0)
^^4^4^2960611^
"KRN",101,4174,1,1,0)
Allows authorized users to identify additional users who are to be alerted
"KRN",101,4174,1,2,0)
for concurrence signature.  These signers may enter an addendum if they do
"KRN",101,4174,1,3,0)
not concur with the content of the document, but they may not edit the
"KRN",101,4174,1,4,0)
document itself.
"KRN",101,4174,20)
D CLEAR^VALM1,SIGNER^TIURA1,BLDTMP^TIUBR(TIUDA) S VALMBCK="R"
"KRN",101,4174,99)
58382,35758
"KRN",101,4410,-1)
0^40
"KRN",101,4410,0)
TIU ACTION CHANGE VIEW PT/TTL^Change View^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4410,1,0)
^^2^2^2921125^
"KRN",101,4410,1,1,0)
Allows users to modify the list of reports by signature status, review
"KRN",101,4410,1,2,0)
screen and dictation date range without exiting the review screen.
"KRN",101,4410,20)
K TIUQUIK,VALMY D FIXLSTNW^TIULM,FULL^VALM1,MAKELIST^TIURPTTL($S(+$G(^TMP("TIUR",$J,"CLASS")):+$G(^TMP("TIUR",$J,"CLASS")),1:38)) S VALMBCK="R",VALMBG=1
"KRN",101,4410,99)
57061,57327
"KRN",101,4411,-1)
0^47
"KRN",101,4411,0)
TIU ACTION MENU PT/TTL REVIEW^Act on Documents^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4411,1,0)
^^1^1^2951213^^^^
"KRN",101,4411,1,1,0)
Menu of actions which may be executed by clinicians.
"KRN",101,4411,4)
26
"KRN",101,4411,10,0)
^101.01PA^17^12
"KRN",101,4411,10,1,0)
3500^^3^
"KRN",101,4411,10,1,"^")
TIU ACTION EDIT
"KRN",101,4411,10,2,0)
3501^^15^
"KRN",101,4411,10,2,"^")
TIU ACTION PRINT
"KRN",101,4411,10,3,0)
3502^^9^
"KRN",101,4411,10,3,"^")
TIU ACTION SIGN/COSIGN
"KRN",101,4411,10,4,0)
3503^^11^
"KRN",101,4411,10,4,"^")
TIU ACTION DETAILED DISPLAY
"KRN",101,4411,10,7,0)
3506^^13^
"KRN",101,4411,10,7,"^")
TIU ACTION BROWSE FOR CLINICIAN
"KRN",101,4411,10,8,0)
3507^^23^
"KRN",101,4411,10,8,"^")
TIU ACTION QUIT
"KRN",101,4411,10,9,0)
4410^^17^
"KRN",101,4411,10,9,"^")
TIU ACTION CHANGE VIEW PT/TTL
"KRN",101,4411,10,13,0)
3599^^1^
"KRN",101,4411,10,13,"^")
TIU ACTION ADD DOCUMENT
"KRN",101,4411,10,14,0)
3602^^7^
"KRN",101,4411,10,14,"^")
TIU ACTION MENU LINK
"KRN",101,4411,10,15,0)
3745^^19^
"KRN",101,4411,10,15,"^")
TIU ACTION COPY
"KRN",101,4411,10,16,0)
4054^^5^
"KRN",101,4411,10,16,"^")
TIU ACTION MAKE ADDENDUM
"KRN",101,4411,10,17,0)
5740^^21^
"KRN",101,4411,10,17,"^")
TIU ACTION ID NOTE
"KRN",101,4411,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT) S:$G(TIUGLINK) VALMSG=$$LINKMSG^TIUGR2(TIUGLINK)
"KRN",101,4411,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4411,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,18),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,4411,28)
Select Action: 
"KRN",101,4411,99)
58533,41871
"KRN",101,4683,-1)
0^75
"KRN",101,4683,0)
TIU ACTION SEARCH LIST^Find^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4683,1,0)
^^5^5^2980304^
"KRN",101,4683,1,1,0)
Allows users to search list of Documents for a text string (word, phrase,
"KRN",101,4683,1,2,0)
or partial word) from current position to the end of the list.  Upon
"KRN",101,4683,1,3,0)
reaching the end of the last page of the list, the user will be asked
"KRN",101,4683,1,4,0)
whether to continue the search from the beginning of the list through the
"KRN",101,4683,1,5,0)
origin of the search.
"KRN",101,4683,20)
D FIND^VALM40
"KRN",101,4683,99)
57061,57328
"KRN",101,4728,-1)
0^10
"KRN",101,4728,0)
TIU ACTION MENU OE/RR^Act on Documents^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4728,1,0)
^^1^1^3000814^^^^
"KRN",101,4728,1,1,0)
Menu of actions which may be executed by clinicians.
"KRN",101,4728,4)
26
"KRN",101,4728,10,0)
^101.01PA^19^19
"KRN",101,4728,10,2,0)
3501^PC^5^^^Print Copy
"KRN",101,4728,10,2,"^")
TIU ACTION PRINT
"KRN",101,4728,10,3,0)
4737^$^15^^^Complete Note(s)
"KRN",101,4728,10,3,"^")
TIU ACTION COMPLETE NOTES
"KRN",101,4728,10,4,0)
3506^B^3^
"KRN",101,4728,10,4,"^")
TIU ACTION BROWSE FOR CLINICIAN
"KRN",101,4728,10,7,0)
4054^AD^13^
"KRN",101,4728,10,7,"^")
TIU ACTION MAKE ADDENDUM
"KRN",101,4728,10,8,0)
3507^Q^21^
"KRN",101,4728,10,8,"^")
TIU ACTION QUIT
"KRN",101,4728,10,12,0)
3599^NW^1^^^New Note
"KRN",101,4728,10,12,"^")
TIU ACTION ADD DOCUMENT
"KRN",101,4728,10,14,0)
4729^SS^9^^^Select Search
"KRN",101,4728,10,14,"^")
TIU ACTION SIGNED/UNSIGNED
"KRN",101,4728,10,15,0)
4730^SP^7^
"KRN",101,4728,10,15,"^")
TIU ACTION SELECT NEW PATIENT
"KRN",101,4728,10,16,0)
4731^RS^11^
"KRN",101,4728,10,16,"^")
TIU ACTION RESET ALL SIGNED
"KRN",101,4728,10,18,0)
5740^IN^17^
"KRN",101,4728,10,18,"^")
TIU ACTION ID NOTE
"KRN",101,4728,10,19,0)
5491^EE^19^^^
"KRN",101,4728,10,19,"^")
TIU ACTION EXPAND LIST
"KRN",101,4728,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT) S:$G(TIUGLINK) VALMSG=$$LINKMSG^TIUGR2(TIUGLINK)
"KRN",101,4728,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,4728,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,18),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,4728,28)
Select Action: 
"KRN",101,4728,99)
58519,56678
"KRN",101,4729,-1)
0^5
"KRN",101,4729,0)
TIU ACTION SIGNED/UNSIGNED^Select Signed/Unsigned Notes^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4729,1,0)
^^2^2^2970316^
"KRN",101,4729,1,1,0)
Allows users to modify the list of reports by signature status, etc.
"KRN",101,4729,1,2,0)
without exiting the review screen.
"KRN",101,4729,20)
D KILL^VALM10() K VALMY D FULL^VALM1,INIT^TIUROR($S(+$G(^TMP("TIUR",$J,"CLASS")):+$G(^("CLASS")),1:3),9999,+$G(^TMP("TIUR",$J,"DFN"))) S VALMBCK="R",VALMBG=1
"KRN",101,4729,99)
58382,35758
"KRN",101,4730,-1)
0^6
"KRN",101,4730,0)
TIU ACTION SELECT NEW PATIENT^Select New Patient^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4730,1,0)
^^1^1^2980320^^^^
"KRN",101,4730,1,1,0)
Select a new patient.
"KRN",101,4730,15)
D:$D(^TMP("TIUR",$J)) HDR^TIUROR S VALMBCK=$S($D(^TMP("TIUR",$J,0)):"R",1:"Q"),VALMBG=1
"KRN",101,4730,20)
K ^TMP("TIURSAVE",$J),^TMP("TIURSIDX",$J),^TMP("VALM VIDEO",$J),VALMY D FULL^VALM1,INIT^TIUROR(+$G(^TMP("TIUR",$J,"CLASS")),1)
"KRN",101,4730,24)
I '$G(TIUGLINK),+$G(ORVP)'>0
"KRN",101,4730,99)
58382,35758
"KRN",101,4731,-1)
0^8
"KRN",101,4731,0)
TIU ACTION RESET ALL SIGNED^Reset to All Signed^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4731,1,0)
^^1^1^2970613^^
"KRN",101,4731,1,1,0)
Reset the list to ALL SIGNED documents.
"KRN",101,4731,15)
D HDR^TIUROR
"KRN",101,4731,20)
D KILL^VALM10() K VALMY D RESTORE^TIUROR1
"KRN",101,4731,99)
58382,35758
"KRN",101,4732,-1)
0^43
"KRN",101,4732,0)
TIU ACTION CWAD DISPLAY^CWAD Display^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4732,1,0)
^^2^2^2970317^^^
"KRN",101,4732,1,1,0)
Detailed display of the CWAD patient warnings; setup for "^^"-jumping
"KRN",101,4732,1,2,0)
to within XQOR*.  Requires Health Summary.
"KRN",101,4732,2,0)
^101.02A^2^2
"KRN",101,4732,2,1,0)
CWA
"KRN",101,4732,2,2,0)
CWAD
"KRN",101,4732,2,"B","CWA",1)

"KRN",101,4732,2,"B","CWAD",2)

"KRN",101,4732,3,0)
^101.03P^1^1
"KRN",101,4732,3,1,0)
ORWARD
"KRN",101,4732,15)

"KRN",101,4732,20)
D CWAD^TIULX
"KRN",101,4732,24)
I '$G(TIUGLINK)
"KRN",101,4732,99)
58519,52195
"KRN",101,4733,-1)
0^14
"KRN",101,4733,0)
TIU ACTION BROWSE FOR OE/RR^Browse^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4733,1,0)
^101.06^4^4^3010109^^^^
"KRN",101,4733,1,1,0)
Allows users to browse through Documents from the Review Screen.
"KRN",101,4733,1,2,0)
In addition to scrolling sequentially through the selected documents
"KRN",101,4733,1,3,0)
and their addenda, the user may Search for a particular word or
"KRN",101,4733,1,4,0)
phrase, or Print draft copies to a selected device.
"KRN",101,4733,15)

"KRN",101,4733,20)
D:$G(TIUGLINK) BROWSE^TIURA2("TIU BROWSE FOR READ ONLY") D:'$G(TIUGLINK) BROWSE^TIURA2("TIU BROWSE FOR CLINICIAN")
"KRN",101,4733,99)
58382,35759
"KRN",101,4734,-1)
0^42
"KRN",101,4734,0)
TIU ACTION COMPLETE DOCUMENTS^Sign/Cosign^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4734,1,0)
^^6^6^2980305^^
"KRN",101,4734,1,1,0)
Allows clinicians to electronically sign selected documents or addenda.
"KRN",101,4734,1,2,0)
 
"KRN",101,4734,1,3,0)
NOTE:  Electronic signature carries the same legal ramifications that
"KRN",101,4734,1,4,0)
wet signature of a hard-copy document carries.  You are advised to
"KRN",101,4734,1,5,0)
carefully review each document for content and accuracy before exercising
"KRN",101,4734,1,6,0)
this option.
"KRN",101,4734,20)
D FULL^VALM1,ELSIG^TIURS1
"KRN",101,4734,24)
; I $D(GMRDPRM0),+$P(GMRDPRM0,U,2),$D(^XUSEC("PROVIDER",DUZ))!$D(^XUSEC("GMRD AUTHOR",DUZ))!$D(^XUSEC("GMRD SURROGATE",DUZ))
"KRN",101,4734,99)
57061,57329
"KRN",101,4737,-1)
0^2
"KRN",101,4737,0)
TIU ACTION COMPLETE NOTES^Complete Note(s)^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4737,1,0)
^^2^2^2970321^
"KRN",101,4737,1,1,0)
Allows users to browse Progress Notes from the Review Screen, and to Sign,
"KRN",101,4737,1,2,0)
Edit, or Delete individual records, either singly, or in groups.
"KRN",101,4737,20)
D BROWSE^TIURA2("TIU COMPLETE NOTES")
"KRN",101,4737,24)
I '$G(TIUGLINK)
"KRN",101,4737,99)
58382,35759
"KRN",101,4738,-1)
0^52
"KRN",101,4738,0)
TIU HIDDEN ACTIONS OE/RR^Hidden Actions^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4738,1,0)
^^4^4^2970322^^^
"KRN",101,4738,1,1,0)
This menu includes the secondary or "hidden actions" which are provided
"KRN",101,4738,1,2,0)
by the List Manager (e.g., scroll right, scroll left, up one line, etc.)
"KRN",101,4738,1,3,0)
and which may be used in the review screens, but which are not visible
"KRN",101,4738,1,4,0)
in the top level action menu.
"KRN",101,4738,4)
26
"KRN",101,4738,10,0)
^101.01PA^26^26
"KRN",101,4738,10,9,0)
3504^+^1^
"KRN",101,4738,10,9,"^")
TIU ACTION NEXT SCREEN
"KRN",101,4738,10,10,0)
3505^-^2^
"KRN",101,4738,10,10,"^")
TIU ACTION PREVIOUS SCREEN
"KRN",101,4738,10,11,0)
3509^FS^3^
"KRN",101,4738,10,11,"^")
TIU ACTION TOP
"KRN",101,4738,10,12,0)
3510^LS^4^
"KRN",101,4738,10,12,"^")
TIU ACTION BOTTOM
"KRN",101,4738,10,13,0)
2765^DN^14^
"KRN",101,4738,10,13,"^")
VALM DOWN A LINE
"KRN",101,4738,10,14,0)
2783^GO^23^
"KRN",101,4738,10,14,"^")
VALM GOTO PAGE
"KRN",101,4738,10,15,0)
2781^<^15^
"KRN",101,4738,10,15,"^")
VALM LEFT
"KRN",101,4738,10,16,0)
2769^PL^26^
"KRN",101,4738,10,16,"^")
VALM PRINT LIST
"KRN",101,4738,10,17,0)
2761^RD^24^
"KRN",101,4738,10,17,"^")
VALM REFRESH
"KRN",101,4738,10,18,0)
2780^>^16^
"KRN",101,4738,10,18,"^")
VALM RIGHT
"KRN",101,4738,10,19,0)
2764^UP^13^
"KRN",101,4738,10,19,"^")
VALM UP ONE LINE
"KRN",101,4738,10,20,0)
2771^ADPL^^
"KRN",101,4738,10,20,"^")
VALM TURN ON/OFF MENUS
"KRN",101,4738,10,21,0)
4732^CWAD^^
"KRN",101,4738,10,21,"^")
TIU ACTION CWAD DISPLAY
"KRN",101,4738,10,22,0)
4683^F^^
"KRN",101,4738,10,22,"^")
TIU ACTION SEARCH LIST
"KRN",101,4738,10,23,0)
3503^DT^^
"KRN",101,4738,10,23,"^")
TIU ACTION DETAILED DISPLAY
"KRN",101,4738,10,24,0)
4751^CT^^
"KRN",101,4738,10,24,"^")
TIU ACTION CHANGE TITLE
"KRN",101,4738,10,25,0)
5491^EE^^^^
"KRN",101,4738,10,25,"^")
TIU ACTION EXPAND LIST
"KRN",101,4738,10,26,0)
5883^EX^^
"KRN",101,4738,10,26,"^")
TIU ACTION EXPAND LIST DUP
"KRN",101,4738,24)

"KRN",101,4738,99)
58519,52195
"KRN",101,4750,-1)
0^51
"KRN",101,4750,0)
TIU HIDDEN ACTIONS ADVANCED^Hidden Actions^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4750,1,0)
^^4^4^2970408^^^^
"KRN",101,4750,1,1,0)
This menu includes the secondary or "hidden actions" which are provided
"KRN",101,4750,1,2,0)
by the List Manager (e.g., scroll right, scroll left, up one line, etc.)
"KRN",101,4750,1,3,0)
and which may be used in the review screens, but which are not visible
"KRN",101,4750,1,4,0)
in the top level action menu.
"KRN",101,4750,4)
26
"KRN",101,4750,10,0)
^101.01PA^26^26
"KRN",101,4750,10,9,0)
3504^+^1^
"KRN",101,4750,10,9,"^")
TIU ACTION NEXT SCREEN
"KRN",101,4750,10,10,0)
3505^-^2^
"KRN",101,4750,10,10,"^")
TIU ACTION PREVIOUS SCREEN
"KRN",101,4750,10,11,0)
3509^FS^3^
"KRN",101,4750,10,11,"^")
TIU ACTION TOP
"KRN",101,4750,10,12,0)
3510^LS^4^
"KRN",101,4750,10,12,"^")
TIU ACTION BOTTOM
"KRN",101,4750,10,13,0)
2765^DN^14^
"KRN",101,4750,10,13,"^")
VALM DOWN A LINE
"KRN",101,4750,10,14,0)
2783^GO^23^
"KRN",101,4750,10,14,"^")
VALM GOTO PAGE
"KRN",101,4750,10,15,0)
2781^<^15^
"KRN",101,4750,10,15,"^")
VALM LEFT
"KRN",101,4750,10,16,0)
2769^PL^26^
"KRN",101,4750,10,16,"^")
VALM PRINT LIST
"KRN",101,4750,10,17,0)
2761^RD^24^
"KRN",101,4750,10,17,"^")
VALM REFRESH
"KRN",101,4750,10,18,0)
2780^>^16^
"KRN",101,4750,10,18,"^")
VALM RIGHT
"KRN",101,4750,10,19,0)
2764^UP^13^
"KRN",101,4750,10,19,"^")
VALM UP ONE LINE
"KRN",101,4750,10,20,0)
2771^ADPL^^
"KRN",101,4750,10,20,"^")
VALM TURN ON/OFF MENUS
"KRN",101,4750,10,21,0)
4732^CWAD^^
"KRN",101,4750,10,21,"^")
TIU ACTION CWAD DISPLAY
"KRN",101,4750,10,22,0)
4683^F^^
"KRN",101,4750,10,22,"^")
TIU ACTION SEARCH LIST
"KRN",101,4750,10,23,0)
4751^CT^^
"KRN",101,4750,10,23,"^")
TIU ACTION CHANGE TITLE
"KRN",101,4750,10,24,0)
5491^EE^^
"KRN",101,4750,10,24,"^")
TIU ACTION EXPAND LIST
"KRN",101,4750,10,25,0)
5883^EX^^
"KRN",101,4750,10,25,"^")
TIU ACTION EXPAND LIST DUP
"KRN",101,4750,10,26,0)
3745^CP^^
"KRN",101,4750,10,26,"^")
TIU ACTION COPY
"KRN",101,4750,24)

"KRN",101,4750,99)
58519,52195
"KRN",101,4751,-1)
0^36
"KRN",101,4751,0)
TIU ACTION CHANGE TITLE^Change Title^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4751,1,0)
^^5^5^3010301^
"KRN",101,4751,1,1,0)
Allows authorized users to modify the title of a document (and thereby
"KRN",101,4751,1,2,0)
convert a patient posting), as appropriate.
"KRN",101,4751,1,3,0)
 
"KRN",101,4751,1,4,0)
Interdisciplinary entries must be detached before having their titles
"KRN",101,4751,1,5,0)
changed.
"KRN",101,4751,20)
Q:$G(TIUGLINK)  D CNVPOST^TIURS1
"KRN",101,4751,24)
I '$G(TIUGLINK)
"KRN",101,4751,99)
57076,52269
"KRN",101,4768,-1)
0^67
"KRN",101,4768,0)
TIU BROWSE ACTION LINK TO PROBLEM^Problem(s)^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4768,1,0)
^^2^2^2980304^^^
"KRN",101,4768,1,1,0)
Link the selected document to one or more Problems from the patient's
"KRN",101,4768,1,2,0)
active Problem List.
"KRN",101,4768,20)
D LINK1^TIURB1
"KRN",101,4768,99)
57112,36839
"KRN",101,4769,-1)
0^82
"KRN",101,4769,0)
TIU BROWSE MENU LINK^Link ...^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4769,1,0)
^^5^5^2980304^
"KRN",101,4769,1,1,0)
Allows authorized users to link single documents to either problems,
"KRN",101,4769,1,2,0)
visits, or records in other VistA applications (e.g., Consult Results
"KRN",101,4769,1,3,0)
with Consult Requests, or Operative Reports with Surgical Cases, etc.).
"KRN",101,4769,1,4,0)
Such associations permit a variety of clinically useful "views" of the
"KRN",101,4769,1,5,0)
on-line record.
"KRN",101,4769,4)
26
"KRN",101,4769,10,0)
^101.01PA^6^6
"KRN",101,4769,10,4,0)
4768^^1^
"KRN",101,4769,10,4,"^")
TIU BROWSE ACTION LINK TO PROBLEM
"KRN",101,4769,10,5,0)
3528^^3^^^Patient/Visit
"KRN",101,4769,10,5,"^")
TIU BROWSE ACTION REASSIGN
"KRN",101,4769,10,6,0)
5040^^5^
"KRN",101,4769,10,6,"^")
TIU BROWSE ACTION LINK WITH CLIENT APP
"KRN",101,4769,15)
K TIUCHNG
"KRN",101,4769,20)
S XQORM(0)="AD",VALMBCK=""
"KRN",101,4769,26)
W !
"KRN",101,4769,28)
Specify Linkage: 
"KRN",101,4769,99)
58394,49132
"KRN",101,5039,-1)
0^53
"KRN",101,5039,0)
TIU ACTION LINK WITH CLIENT RECORD^Link with Request^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5039,1,0)
^^2^2^2980304^^^
"KRN",101,5039,1,1,0)
Allows authorized users to change the linkage of TIU Documents to records
"KRN",101,5039,1,2,0)
in Client Applications (e.g., Consult Tracking).
"KRN",101,5039,15)
S VALMBCK="R"
"KRN",101,5039,20)
D CLAPPLNK^TIURD
"KRN",101,5039,24)
I '$G(TIUGLINK)
"KRN",101,5039,99)
57315,43064
"KRN",101,5040,-1)
0^69
"KRN",101,5040,0)
TIU BROWSE ACTION LINK WITH CLIENT APP^Link with Request^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5040,1,0)
^^3^3^2980304^^
"KRN",101,5040,1,1,0)
Allows authorized users (as defined by your local business rules in ASU)
"KRN",101,5040,1,2,0)
to link or re-link the current document, which has been inappropriately
"KRN",101,5040,1,3,0)
assigned to a given request.
"KRN",101,5040,15)
S VALMBCK="R"
"KRN",101,5040,20)
D FULL^VALM1,CLAPPLN1^TIURD(TIUDA)
"KRN",101,5040,99)
57315,61682
"KRN",101,5128,-1)
0^79
"KRN",101,5128,0)
TIU ACTION EDIT ENCOUNTER^Encounter Edit^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5128,1,0)
^^1^1^2980612^^
"KRN",101,5128,1,1,0)
Allows authorized users to Edit Encounter information on demand.
"KRN",101,5128,20)
D ENCNTR^TIURA1
"KRN",101,5128,24)
I '$G(TIUGLINK)
"KRN",101,5128,99)
57506,62136
"KRN",101,5129,-1)
0^62
"KRN",101,5129,0)
TIU BROWSE ACTION EDIT ENCOUNTER^Encounter Edit^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5129,1,0)
^^2^2^2980615^
"KRN",101,5129,1,1,0)
Allows authorized users to edit the encounter data for the visit associated 
"KRN",101,5129,1,2,0)
with the selected TIU Document(s).
"KRN",101,5129,20)
D EDTENC^TIUPXAP2(TIUDA,.TIUCHNG)
"KRN",101,5129,99)
58382,35759
"KRN",101,5491,-1)
0^17
"KRN",101,5491,0)
TIU ACTION EXPAND LIST^Expand/Collapse Entry^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5491,1,0)
^101.06^3^3^3010212^^
"KRN",101,5491,1,1,0)
Action EXPAND ENTRY permits users to expand notes to list any addenda or
"KRN",101,5491,1,2,0)
interdisciplinary children nested under the note.  If the note is already
"KRN",101,5491,1,3,0)
expanded when the action is taken, the note is collapsed.
"KRN",101,5491,2,0)
^101.02A^1^1
"KRN",101,5491,2,1,0)
EX
"KRN",101,5491,2,"B","EX",1)

"KRN",101,5491,15)
S VALMBCK="R"
"KRN",101,5491,20)
D EXPAND^TIURA2
"KRN",101,5491,24)

"KRN",101,5491,99)
58504,37012
"KRN",101,5740,-1)
0^9
"KRN",101,5740,0)
TIU ACTION ID NOTE^Interdiscipl'ry Note^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5740,1,0)
^^18^18^3010307^
"KRN",101,5740,1,1,0)
This action permits the user to add a new entry to an interdisciplinary
"KRN",101,5740,1,2,0)
note, attach a stand-alone note to an interdisciplinary note, or to detach
"KRN",101,5740,1,3,0)
an entry from an interdisciplinary note.
"KRN",101,5740,1,4,0)
 
"KRN",101,5740,1,5,0)
Only one note at a time can be selected for this action.
"KRN",101,5740,1,6,0)
 
"KRN",101,5740,1,7,0)
The action taken depends on the note selected.  If an interdisciplinary
"KRN",101,5740,1,8,0)
note is selected, the option attempts to add a new entry to it.  If a
"KRN",101,5740,1,9,0)
stand-alone note is selected, the option attempts to attach it to an
"KRN",101,5740,1,10,0)
interdisciplinary note, and the user is asked to select the note to attach
"KRN",101,5740,1,11,0)
it to. If an individual entry of an interdisciplinary note is selected,
"KRN",101,5740,1,12,0)
the option attempts to detach it from the interdisciplinary note.
"KRN",101,5740,1,13,0)
 
"KRN",101,5740,1,14,0)
All of these actions are governed by business rules.  The two
"KRN",101,5740,1,15,0)
business rule actions specific to ID notes are ATTACH TO ID NOTE, and
"KRN",101,5740,1,16,0)
ATTACH ID ENTRY. There is no business rule detach action.  Those users who
"KRN",101,5740,1,17,0)
can ATTACH a note TO AN ID NOTE are permitted to detach the note once it
"KRN",101,5740,1,18,0)
is attached.
"KRN",101,5740,2,0)
^101.02A^^0
"KRN",101,5740,15)
D IDNOTE^TIUGR
"KRN",101,5740,20)
S VALMBCK="R"
"KRN",101,5740,24)
I $G(^TMP("TIUR",$J,"CLASS"))'=244
"KRN",101,5740,99)
58382,35759
"KRN",101,5741,-1)
0^23
"KRN",101,5741,0)
TIU BROWSE ACTION ID NOTE^Interdiscipl'ry Note^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5741,1,0)
^^12^12^3010212^
"KRN",101,5741,1,1,0)
This option permits the user to add a new entry to an interdisciplinary
"KRN",101,5741,1,2,0)
note or to detach an entry from an interdisciplinary note.
"KRN",101,5741,1,3,0)
 
"KRN",101,5741,1,4,0)
The other ID action, attaching a stand-alone note to an interdisciplinary
"KRN",101,5741,1,5,0)
note, may not be executed from the browse, it must be done from the review
"KRN",101,5741,1,6,0)
screen.
"KRN",101,5741,1,7,0)
 
"KRN",101,5741,1,8,0)
The action taken depends on the note currently browsed. If the browsed
"KRN",101,5741,1,9,0)
note is an interdisciplinary note, the option attempts to add a new entry
"KRN",101,5741,1,10,0)
to it. If the browsed note is an individual entry of an interdisciplinary
"KRN",101,5741,1,11,0)
note, the option attempts to detach the entry from the interdisciplinary
"KRN",101,5741,1,12,0)
note.
"KRN",101,5741,2,0)
^101.02A^3^1
"KRN",101,5741,2,3,0)
ID
"KRN",101,5741,2,"B","ID",3)

"KRN",101,5741,15)
D IDNOTEB^TIUGR1(TIUDA)
"KRN",101,5741,20)

"KRN",101,5741,24)
I '$D(ORTAB)&($G(^TMP("TIUR",$J,"CLASS"))'=244)&($G(TIUTYP)'=244)
"KRN",101,5741,99)
58382,35759
"KRN",101,5883,-1)
0^44
"KRN",101,5883,0)
TIU ACTION EXPAND LIST DUP^Expand/Collapse Entry^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5883,1,0)
^^7^7^3010212^
"KRN",101,5883,1,1,0)
Action EXPAND ENTRY permits users to expand notes to list any addenda or
"KRN",101,5883,1,2,0)
interdisciplinary children nested under the note.  If the note is already
"KRN",101,5883,1,3,0)
expanded when the action is taken, the note is collapsed.
"KRN",101,5883,1,4,0)
 
"KRN",101,5883,1,5,0)
Duplicate of TIU ACTION EXPAND LIST.
"KRN",101,5883,1,6,0)
 
"KRN",101,5883,1,7,0)
Created so users can use mnemonic EX, as well as mnemonic EE.
"KRN",101,5883,2,0)
^101.02A^1^1
"KRN",101,5883,2,1,0)
EX
"KRN",101,5883,2,"B","EX",1)

"KRN",101,5883,15)
S VALMBCK="R"
"KRN",101,5883,20)
D EXPAND^TIURA2
"KRN",101,5883,99)
58504,37047
"KRN",101,5885,-1)
0^34
"KRN",101,5885,0)
TIU ACTION DISPLAY REASSIGN HX^Show Reassign History^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5885,.1)
Show Hx
"KRN",101,5885,1,0)
^^3^3^3001128^
"KRN",101,5885,1,1,0)
Displays the reassignment history of selected documents for HIMS
"KRN",101,5885,1,2,0)
personnel. May be useful in tracing the origin and destination of
"KRN",101,5885,1,3,0)
documents that were initially entered in error.
"KRN",101,5885,2,0)
^101.02A^3^1
"KRN",101,5885,2,3,0)
DH
"KRN",101,5885,2,"B","DH",3)

"KRN",101,5885,20)
D DISPLAY^TIURHX
"KRN",101,5885,99)
58519,52196
"KRN",101,5886,-1)
0^33
"KRN",101,5886,0)
TIU ACTION MENU DISPLAY^Display...^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5886,10,0)
^101.01PA^2^2
"KRN",101,5886,10,1,0)
3503^^1^
"KRN",101,5886,10,1,"^")
TIU ACTION DETAILED DISPLAY
"KRN",101,5886,10,2,0)
5885^^2^
"KRN",101,5886,10,2,"^")
TIU ACTION DISPLAY REASSIGN HX
"KRN",101,5886,20)
S XQORM(0)="AD",VALMBCK=""
"KRN",101,5886,26)
W !
"KRN",101,5886,28)
Specify View: 
"KRN",101,5886,99)
58521,37898
"KRN",409.61,472,-1)
0^1
"KRN",409.61,472,0)
TIU DISPLAY AUDIT TRAIL^1^^^5^18^1^1^Document^TIU BROWSE MENU READ ONLY^Detailed Display
"KRN",409.61,472,1)
^TIU HIDDEN ACTIONS BROWSE
"KRN",409.61,472,"ARRAY")
 ^TMP("TIUAUDIT",$J)
"KRN",409.61,472,"FNL")
D CLEAN^TIUAUDIT S VALMBCK="Q"
"KRN",409.61,472,"HDR")
D HDR^TIUAUDIT
"KRN",409.61,472,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,472,"INIT")
D MAIN^TIUAUDIT
"KRN",8994,1482,-1)
0^2
"KRN",8994,1482,0)
TIU ID CAN ATTACH^CANATTCH^TIUSRVA^1^S
"KRN",8994,1482,1,0)
^^3^3^3010108^
"KRN",8994,1482,1,1,0)
This BOOLEAN RPC evaluates the question of whether a particular document
"KRN",8994,1482,1,2,0)
may be attached as an entry to an Interdisciplinary Note (i.e., can this
"KRN",8994,1482,1,3,0)
document be an ID Child?).
"KRN",8994,1482,2,0)
^8994.02A^1^1
"KRN",8994,1482,2,1,0)
TIUDA^1^^1^1
"KRN",8994,1482,2,1,1,0)
^8994.021^2^2^3010108^^^
"KRN",8994,1482,2,1,1,1,0)
This is the IEN of the prospective ID Child document in the TIU Document
"KRN",8994,1482,2,1,1,2,0)
file.
"KRN",8994,1482,2,"B","TIUDA",1)

"KRN",8994,1482,2,"PARAMSEQ",1,1)

"KRN",8994,1482,3,0)
^^7^7^3010108^
"KRN",8994,1482,3,1,0)
This is the BOOLEAN result:
"KRN",8994,1482,3,2,0)
 
"KRN",8994,1482,3,3,0)
        1                      = Document may be attached
"KRN",8994,1482,3,4,0)
        0^Explanatory message  = Document may NOT be attached
"KRN",8994,1482,3,5,0)
        -1^Explanatory message = Document may NOT be attached, because
"KRN",8994,1482,3,6,0)
                                 a business rule allows it to also be a
"KRN",8994,1482,3,7,0)
                                 parent document.
"KRN",8994,1483,-1)
0^3
"KRN",8994,1483,0)
TIU ID CAN RECEIVE^CANRCV^TIUSRVA^1^S
"KRN",8994,1483,1,0)
^^3^3^3001026^
"KRN",8994,1483,1,1,0)
This BOOLEAN RPC evaluates the question of whether a particular document
"KRN",8994,1483,1,2,0)
may receive an entry as an Interdisciplinary Parent Note (i.e., can this
"KRN",8994,1483,1,3,0)
document be an ID Parent?).
"KRN",8994,1483,2,0)
^8994.02A^1^1
"KRN",8994,1483,2,1,0)
TIUDA^1^^1^1
"KRN",8994,1483,2,1,1,0)
^^2^2^3001026^
"KRN",8994,1483,2,1,1,1,0)
This is the IEN of the prospective ID Parent document in the TIU Document
"KRN",8994,1483,2,1,1,2,0)
file.
"KRN",8994,1483,2,"B","TIUDA",1)

"KRN",8994,1483,2,"PARAMSEQ",1,1)

"KRN",8994,1483,3,0)
^^4^4^3001026^
"KRN",8994,1483,3,1,0)
This is the BOOLEAN result:
"KRN",8994,1483,3,2,0)
 
"KRN",8994,1483,3,3,0)
        1                     = Document may receive an ID Entry
"KRN",8994,1483,3,4,0)
        0^Explanatory message = Document may NOT receive an ID Entry
"KRN",8994,1484,-1)
0^1
"KRN",8994,1484,0)
TIU ID ATTACH ENTRY^IDATTCH^TIUSRVP1^1^S
"KRN",8994,1484,1,0)
^8994.01^2^2^3001026^^
"KRN",8994,1484,1,1,0)
This RPC will attach a a document as an Interdisciplinary (ID) entry to an
"KRN",8994,1484,1,2,0)
ID Parent document.
"KRN",8994,1484,2,0)
^8994.02A^2^2
"KRN",8994,1484,2,1,0)
TIUDA^1^^1^1
"KRN",8994,1484,2,1,1,0)
^^1^1^3001026^
"KRN",8994,1484,2,1,1,1,0)
This is the IEN of the Entry which is to be attached as the ID Child.
"KRN",8994,1484,2,2,0)
TIUDAD^1^^1^2
"KRN",8994,1484,2,2,1,0)
^8994.021^2^2^3001026^^
"KRN",8994,1484,2,2,1,1,0)
This is the internal entry number of the TIU Document which is to be the
"KRN",8994,1484,2,2,1,2,0)
ID Parent to which the ID Entry is attached.
"KRN",8994,1484,2,"B","TIUDA",1)

"KRN",8994,1484,2,"B","TIUDAD",2)

"KRN",8994,1484,2,"PARAMSEQ",1,1)

"KRN",8994,1484,2,"PARAMSEQ",2,2)

"KRN",8994,1484,3,0)
^8994.03^5^5^3001026^^
"KRN",8994,1484,3,1,0)
This is a flag indicating the success or failure of the call:
"KRN",8994,1484,3,2,0)
 
"KRN",8994,1484,3,3,0)
IF THE CALL SUCCEEDS, THE ENTRY NUMBER OF THE ENTRY WILL BE RETURNED.
"KRN",8994,1484,3,4,0)
 
"KRN",8994,1484,3,5,0)
IF THE CALL FAILS, 0^Explanatory Message WILL BE RETURNED.
"KRN",8994,1485,-1)
0^4
"KRN",8994,1485,0)
TIU ID DETACH ENTRY^IDDTCH^TIUSRVP1^1^S
"KRN",8994,1485,1,0)
^8994.01^1^1^3001026^^
"KRN",8994,1485,1,1,0)
This call will remove an ID Entry from an Interdisciplinary Note.
"KRN",8994,1485,2,0)
^8994.02A^1^1
"KRN",8994,1485,2,1,0)
TIUDA^1^^1^1
"KRN",8994,1485,2,1,1,0)
^8994.021^2^2^3001026^^
"KRN",8994,1485,2,1,1,1,0)
This is the internal entry number of the ID Entry which is to be removed
"KRN",8994,1485,2,1,1,2,0)
from the ID Note.
"KRN",8994,1485,2,"B","TIUDA",1)

"KRN",8994,1485,2,"PARAMSEQ",1,1)

"KRN",8994,1485,3,0)
^8994.03^4^4^3001026^^
"KRN",8994,1485,3,1,0)
This is a flag indicating the success or failure of the call:
"KRN",8994,1485,3,2,0)
 
"KRN",8994,1485,3,3,0)
IF THE CALL SUCCEEDS, THE ENTRY NUMBER OF THE ENTRY WILL BE RETURNED. 
"KRN",8994,1485,3,4,0)
IF THE CALL FAILS, 0^Explanatory Message WILL BE RETURNED.
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
100^3010416^17
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3010416
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this build is found in the National Patch Module under
"PKG",193,22,1,"PAH",1,1,2,0)
patch TIU*1*100.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
90
"RTN","TIUADD")
0^25^B37868143
"RTN","TIUADD",1,0)
TIUADD ; SLC/JER - Enter/Edit an addendum online ;3/16/01
"RTN","TIUADD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,88,100**;Jun 20, 1997
"RTN","TIUADD",3,0)
 ; 2/3: Update TEXTEDIT from TIUEDIT to TIUEDI4
"RTN","TIUADD",4,0)
ADDENDUM(TIUDA,TIUADD,TIUCHNG,TIUNOASK) ; Control branching
"RTN","TIUADD",5,0)
 N TIUY,TIUEDIT,TIUDADD K ^TMP("TIUADD",$J)
"RTN","TIUADD",6,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUADD",7,0)
 S TIUCHNG("ADDM")=1
"RTN","TIUADD",8,0)
 ; -- Get list of existing addenda, edit existing one --
"RTN","TIUADD",9,0)
 D ADDLIST(.TIUY,TIUDA)
"RTN","TIUADD",10,0)
 I +$D(TIUY),+$D(@TIUY) D  G:$D(DIRUT) ADDENX
"RTN","TIUADD",11,0)
 . W !
"RTN","TIUADD",12,0)
 . S TIUEDIT=+$$READ^TIUU("YO","Do you wish to EDIT an existing ADDENDUM","YES")
"RTN","TIUADD",13,0)
 . I +TIUEDIT D EDIT(TIUY) S TIUADD=1
"RTN","TIUADD",14,0)
 G:+$G(TIUADD) ADDENX
"RTN","TIUADD",15,0)
 ; -- Create new addendum to TIUDA: --
"RTN","TIUADD",16,0)
 I +$P($G(^TIU(8925,+TIUDA,0)),U,6)'>0 D  Q:$D(DIROUT)!(+TIUDADD'>0)
"RTN","TIUADD",17,0)
 . S TIUDADD=$$CANDO^TIULP(TIUDA,"MAKE ADDENDUM")
"RTN","TIUADD",18,0)
 . I '+TIUDADD D  Q
"RTN","TIUADD",19,0)
 . . W !!,$C(7),$P(TIUDADD,U,2),!
"RTN","TIUADD",20,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUADD",21,0)
 . I +TIUDADD D  Q:$D(DIROUT)
"RTN","TIUADD",22,0)
 . . I +$G(TIUNOASK)'>0,'+$$READ^TIUU("YO","Do you wish to ADD a new ADDENDUM","NO") Q
"RTN","TIUADD",23,0)
 . . D ADD(TIUDA,.TIUCHNG)
"RTN","TIUADD",24,0)
 . . ; -- Update ADDENDED? if browsing ID Note
"RTN","TIUADD",25,0)
 . . I TIUCHNG,$P($G(TIUGDATA),U,2) K VALMHDR
"RTN","TIUADD",26,0)
 I +$P(^TIU(8925,+TIUDA,0),U,6)>0 D
"RTN","TIUADD",27,0)
 . W !!,$C(7)," You may not make an ADDENDUM to an ADDENDUM.",!
"RTN","TIUADD",28,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUADD",29,0)
ADDENX ;Exit for ADDENDUM
"RTN","TIUADD",30,0)
 K ^TMP("TIUADD",$J)
"RTN","TIUADD",31,0)
 ;I $D(VALMAR),$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUADD",32,0)
 Q
"RTN","TIUADD",33,0)
EDIT(TIUY) ;Edit existing addendum
"RTN","TIUADD",34,0)
 N TIUED,TIUDA,DA,DIC,DIE,TIUDAUTH,TIUPT,TIURDOC,DR,X,Y,TIUCNT
"RTN","TIUADD",35,0)
 S TIUCNT=0 F  S TIUCNT=$O(@TIUY@(TIUCNT)) Q:TIUCNT'>0  D  Q:$D(DIROUT)
"RTN","TIUADD",36,0)
 . N TIUQUIT
"RTN","TIUADD",37,0)
 . S TIUDA=+$G(@TIUY@(TIUCNT))
"RTN","TIUADD",38,0)
 . D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUADD",39,0)
 . W !!,"Displaying Addendum #",TIUCNT
"RTN","TIUADD",40,0)
 . D EN^VALM("TIU EDIT ADDENDUM") Q:$D(DIROUT)
"RTN","TIUADD",41,0)
 Q
"RTN","TIUADD",42,0)
EDADD ; Edit action
"RTN","TIUADD",43,0)
 N DA,DIC,DIE,DLAYGO,DIWESUB,TIUDAUTH,TIUMD,TIUPT,TIUECOS,TIUXINI,DR,X,Y
"RTN","TIUADD",44,0)
 N TIUDAD,TIUD0,TIUD12,TIUD13,TIUD14,TIUQUIT,TIUTYP,TIUT0,TIU
"RTN","TIUADD",45,0)
 K TIUBY,TIUCANED
"RTN","TIUADD",46,0)
 S TIUCANED=$$CANDO^TIULP(TIUDA,"EDIT RECORD")
"RTN","TIUADD",47,0)
 I +TIUCANED'>0 D  Q
"RTN","TIUADD",48,0)
 . W !!,$P(TIUCANED,U,2)
"RTN","TIUADD",49,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUADD",50,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIUADD",51,0)
 S TIUD14=$G(^TIU(8925,+TIUDA,14))
"RTN","TIUADD",52,0)
 S TIUDAD=+$P($G(^TIU(8925,+TIUDA,0)),U,6)
"RTN","TIUADD",53,0)
 S DA=+TIUDA
"RTN","TIUADD",54,0)
 W !!,"Editing ADDENDUM"
"RTN","TIUADD",55,0)
 S TIUTYP=+$G(^TIU(8925,+DA,0)),TIUT0=$G(^TIU(8925.1,+TIUTYP,0))
"RTN","TIUADD",56,0)
 S TIUTYP(1)="1^"_+TIUTYP_U_$P(TIUT0,U,3)_U
"RTN","TIUADD",57,0)
 S TIUMD=$$ISA^USRLM(+$G(DUZ),"PROVIDER")
"RTN","TIUADD",58,0)
 S TIUPT=$P($G(^DPT(+$P(TIUD0,U,2),0)),U)
"RTN","TIUADD",59,0)
 S DIWESUB="Patient: "_TIUPT
"RTN","TIUADD",60,0)
 S DR=$$GETTMPL^TIUEDI1(+$P(^TIU(8925,+TIUDAD,0),U))
"RTN","TIUADD",61,0)
 D GETTIU^TIULD(.TIU,TIUDAD)
"RTN","TIUADD",62,0)
 ; -- Do DIE; get text, release, verify: --
"RTN","TIUADD",63,0)
 D ADDDIE(DA,DR,TIUDAD)
"RTN","TIUADD",64,0)
 I '$D(^TIU(8925,+DA,0)) S TIUCHNG=0,TIUCHNG("DELETE")=1 Q
"RTN","TIUADD",65,0)
 ; -- Update status, visit type, visit location: --
"RTN","TIUADD",66,0)
 S DR=".05///"_$$STATUS^TIULC(DA)_";.13////"_$P($G(TIU("VSTR")),";",3)_";1211////"_$P($G(TIU("VLOC")),U),DIE=8925 D ^DIE
"RTN","TIUADD",67,0)
 ; -- Set TIUCHNG: e.g. TIUCHNG = 2^addmIFN  (2 for entered/edited text);
"RTN","TIUADD",68,0)
 ;    TIUCHNG("EXIST") for edited EXISTING not new addm
"RTN","TIUADD",69,0)
 S TIUCHNG=2_"^"_+$G(DA),TIUCHNG("EXIST")=1,VALMBCK="Q"
"RTN","TIUADD",70,0)
 ; -- Sign, print: --
"RTN","TIUADD",71,0)
 I +$P(TIUPRM0,U,2) D
"RTN","TIUADD",72,0)
 . N TIUSIGN S TIUSIGN=$$CANDO^TIULP(DA,"SIGNATURE")
"RTN","TIUADD",73,0)
 . I '+TIUSIGN D  Q
"RTN","TIUADD",74,0)
 . . I +$$ISA^USRLM(+$G(DUZ),"TRANSCRIPTIONIST") Q
"RTN","TIUADD",75,0)
 . . W !,$C(7),$P(TIUSIGN,U,2)
"RTN","TIUADD",76,0)
 . . I '$D(VALMAR),$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUADD",77,0)
 . I +TIUSIGN D EDSIG^TIURS(DA)
"RTN","TIUADD",78,0)
 . I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUADD",79,0)
 ; NOIS LOU-0598-40899
"RTN","TIUADD",80,0)
 I $G(TIUQUIT),+$$EMPTYDOC^TIULF(DA) D DELETE^TIUEDIT(DA) S TIUCHNG=0,TIUCHNG("DELETE")=1 H 2 Q
"RTN","TIUADD",81,0)
 Q
"RTN","TIUADD",82,0)
ADD(TIUDA,TIUCHNG) ;Add new addendum
"RTN","TIUADD",83,0)
 N DA,DIC,DIE,DLAYGO,DIWESUB,DR,TIUDAUTH,TIUMD,TIUPT,TIUECOS,TIUXINI,X,Y
"RTN","TIUADD",84,0)
 N TIUD0,TIUDV,TIUD12,TIUD13,TIUD14,TIUTYP,TIUT0,TIU,TIUFPRIV,TIUQUIT
"RTN","TIUADD",85,0)
 N LINENO,EXPANDED
"RTN","TIUADD",86,0)
 S TIUFPRIV=1
"RTN","TIUADD",87,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIUADD",88,0)
 S TIUD14=$G(^TIU(8925,+TIUDA,14)),TIUDV=$P(TIUD0,U,3)
"RTN","TIUADD",89,0)
 S LINENO=+$O(^TMP("TIUR",$J,"IEN",TIUDA,0))
"RTN","TIUADD",90,0)
 I LINENO,$D(^TMP("TIUR",$J,"EXPAND",LINENO)) S EXPANDED=1
"RTN","TIUADD",91,0)
 I '$G(EXPANDED),$$HASIDKID^TIUGBR(TIUDA) W !!,"  You are addending an interdisciplinary note.  Your addendum will be added to",!,"the parent entry of the note." H 2
"RTN","TIUADD",92,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_$$ADDPTR_""""
"RTN","TIUADD",93,0)
 D ^DIC
"RTN","TIUADD",94,0)
 I +Y>0 S DA=+Y D
"RTN","TIUADD",95,0)
 . W !!,"Adding ADDENDUM"
"RTN","TIUADD",96,0)
 . S DIE="^TIU(8925,"
"RTN","TIUADD",97,0)
 . S DR=".03////"_TIUDV_";.04////"_+$$ADDCLASS_";.05////3;.06////"_TIUDA
"RTN","TIUADD",98,0)
 . D ^DIE
"RTN","TIUADD",99,0)
 . S TIUTYP=+$G(^TIU(8925,+DA,0)),TIUT0=$G(^TIU(8925.1,+TIUTYP,0))
"RTN","TIUADD",100,0)
 . S TIUTYP(1)="1^"_+TIUTYP_U_$P(TIUT0,U,3)_U
"RTN","TIUADD",101,0)
 . S TIUMD=$$ISA^USRLM(+$G(DUZ),"PROVIDER")
"RTN","TIUADD",102,0)
 . S TIUPT=$P($G(^DPT(+$P(TIUD0,U,2),0)),U)
"RTN","TIUADD",103,0)
 . S DIWESUB="Patient: "_TIUPT
"RTN","TIUADD",104,0)
 . S DR=$$GETTMPL^TIUEDI1(+$P(^TIU(8925,+TIUDA,0),U))
"RTN","TIUADD",105,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUADD",106,0)
 . D ADDDIE(DA,DR,TIUDA) I '$D(^TIU(8925,+DA,0)) S TIUCHNG=0,TIUCHNG("DELETE")=1 Q
"RTN","TIUADD",107,0)
 . S DR=".05///"_$$STATUS^TIULC(DA),DIE=8925 D ^DIE
"RTN","TIUADD",108,0)
 . S TIUCHNG=2_"^"_+$G(DA)
"RTN","TIUADD",109,0)
 . I +$P(TIUPRM0,U,2) D
"RTN","TIUADD",110,0)
 . . N TIUSIGN S TIUSIGN=$$CANDO^TIULP(DA,"SIGNATURE")
"RTN","TIUADD",111,0)
 . . I '+TIUSIGN D  Q
"RTN","TIUADD",112,0)
 . . . W !,$C(7),$P(TIUSIGN,U,2)
"RTN","TIUADD",113,0)
 . . . I '$D(VALMAR),$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUADD",114,0)
 . . I +TIUSIGN D EDSIG^TIURS(DA)
"RTN","TIUADD",115,0)
 . I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUADD",116,0)
 . I $G(TIUQUIT) D DELETE^TIUEDIT(DA) S TIUCHNG=0,TIUCHNG("DELETE")=1 Q
"RTN","TIUADD",117,0)
 Q
"RTN","TIUADD",118,0)
ADDPTR() ; Get record # of ADDENDUM in 8925.1
"RTN","TIUADD",119,0)
 N DIC,X,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUADD",120,0)
 S DIC=8925.1,DIC(0)="FMX",X="ADDENDUM"
"RTN","TIUADD",121,0)
 S DIC("S")="I $P($G(^TIU(8925.1,+Y,0)),U,4)=""DOC"""
"RTN","TIUADD",122,0)
 D ^DIC K DIC("S")
"RTN","TIUADD",123,0)
 Q +Y
"RTN","TIUADD",124,0)
ADDCLASS() ; Get record # of ADDENDUM Document Class in 8925.1
"RTN","TIUADD",125,0)
 N DIC,X,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUADD",126,0)
 S DIC=8925.1,DIC(0)="FMX",X="ADDENDUM"
"RTN","TIUADD",127,0)
 S DIC("S")="I $P($G(^TIU(8925.1,+Y,0)),U,4)=""DC"""
"RTN","TIUADD",128,0)
 D ^DIC K DIC("S")
"RTN","TIUADD",129,0)
 Q +Y
"RTN","TIUADD",130,0)
ADDDIE(DA,DR,TIUDA) ; Call DIE to conduct dialog
"RTN","TIUADD",131,0)
 N TIUREL,TIUD0,TIUD12,TIUD13,TIUD14,DTOUT,Y,DWPK
"RTN","TIUADD",132,0)
 S DIE=8925 D ^DIE
"RTN","TIUADD",133,0)
 I $D(Y)!($D(DTOUT)) S TIUQUIT=1
"RTN","TIUADD",134,0)
 D:+$G(TIUQUIT) SEND^TIUALRT(DA)
"RTN","TIUADD",135,0)
 I '+$G(TIUQUIT) D
"RTN","TIUADD",136,0)
 . D TEXTEDIT^TIUEDI4(DA)
"RTN","TIUADD",137,0)
 . I $$EMPTYDOC^TIULF(DA) D DELETE^TIUEDIT(DA,0) Q
"RTN","TIUADD",138,0)
 . ; -- Not clear why I need these nodes 0,12,13,14: --
"RTN","TIUADD",139,0)
 . S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIUADD",140,0)
 . S TIUD14=$G(^TIU(8925,+DA,14))
"RTN","TIUADD",141,0)
 . ; Execute RELEASE Logic
"RTN","TIUADD",142,0)
 . D RELEASE^TIUT(DA) S TIUREL=""
"RTN","TIUADD",143,0)
 . ; Execute VERIFY Logic
"RTN","TIUADD",144,0)
 . D VERIFY^TIUT(DA)
"RTN","TIUADD",145,0)
 . ; Send Addendum Alert
"RTN","TIUADD",146,0)
 . D SENDADD^TIUALRT(DA)
"RTN","TIUADD",147,0)
 Q
"RTN","TIUADD",148,0)
ADDLIST(Y,TIUDA) ; Get list of addenda for a record
"RTN","TIUADD",149,0)
 N TIUI,TIUCNT S (TIUCNT,TIUI)=0 K ^TMP("TIUADD",$J)
"RTN","TIUADD",150,0)
 F  S TIUI=$O(^TIU(8925,"DAD",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUADD",151,0)
 . Q:+$$ISADDNDM^TIULC1(TIUI)'>0
"RTN","TIUADD",152,0)
 . Q:+$$CANDO^TIULP(TIUI,"EDIT RECORD")'>0
"RTN","TIUADD",153,0)
 . S TIUCNT=TIUCNT+1,^TMP("TIUADD",$J,TIUCNT)=TIUI
"RTN","TIUADD",154,0)
 I $D(^TMP("TIUADD",$J)) S Y=$NA(^TMP("TIUADD",$J))
"RTN","TIUADD",155,0)
 Q
"RTN","TIUALRT1")
0^65^B6917688
"RTN","TIUALRT1",1,0)
TIUALRT1 ; SLC/JER - More alert processing ;4/9/01
"RTN","TIUALRT1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUALRT1",3,0)
SENDID(DA) ; Generates "ID Entry attached" alert
"RTN","TIUALRT1",4,0)
 N TIU0,TIU12,TIU13,TIU14,TIU15,TIU21,TIUPNM,TIUSSN,TIUTRAN,TIU,TIUTITLE
"RTN","TIUALRT1",5,0)
 N TIUDPRM,XQA,XQAMSG,XQAFLG,XQADATA,XQAROU,TIUESNR,TIUDATE,TIUESNM
"RTN","TIUALRT1",6,0)
 N TIUO0,TIUO12,TIUO13,TIUECSNR
"RTN","TIUALRT1",7,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUALRT1",8,0)
 D IDDEL(DA)
"RTN","TIUALRT1",9,0)
 ; Don't send if notifications not enabled
"RTN","TIUALRT1",10,0)
 I '+$P(TIUPRM1,U,7) Q
"RTN","TIUALRT1",11,0)
 S TIU0=$G(^TIU(8925,+DA,0))
"RTN","TIUALRT1",12,0)
 S TIU12=$G(^TIU(8925,+DA,12)),TIU13=$G(^(13)),TIU14=$G(^(14))
"RTN","TIUALRT1",13,0)
 S TIU15=$G(^TIU(8925,+DA,15)),TIU21=$G(^(21))
"RTN","TIUALRT1",14,0)
 Q:+TIU21'>0
"RTN","TIUALRT1",15,0)
 S TIUO0=$G(^TIU(8925,+TIU21,0)),TIUO12=$G(^(12)),TIUO13=$G(^(13))
"RTN","TIUALRT1",16,0)
 ; Only send if document parameter indicates you should
"RTN","TIUALRT1",17,0)
 D DOCPRM^TIULC1(+TIUO0,.TIUDPRM,DA)
"RTN","TIUALRT1",18,0)
 Q:'+$P(TIUDPRM(0),U,19)
"RTN","TIUALRT1",19,0)
 S TIUPNM=$E($$PTNAME^TIULC1(+$P(TIU0,U,2)),1,9)
"RTN","TIUALRT1",20,0)
 S TIUESNM=$$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIU12,U,2)),"LAST,FI MI")
"RTN","TIUALRT1",21,0)
 S TIUTITLE=$E($$PNAME^TIULC1(+TIUO0),1,20)
"RTN","TIUALRT1",22,0)
 S TIUDATE=$S(+$P(TIUO13,U):$P(TIUO13,U),1:$G(DT))
"RTN","TIUALRT1",23,0)
 S TIUDATE=$$DATE^TIULS(TIUDATE)
"RTN","TIUALRT1",24,0)
 D PATVADPT^TIULV(.TIU,+$P(TIU0,U,2)) ;Used to get SSN. Date not important.
"RTN","TIUALRT1",25,0)
 S TIUSSN=$E(TIUPNM,1)_$P($G(TIU("SSN")),"-",3)
"RTN","TIUALRT1",26,0)
 S TIUTRAN=$P(TIU13,U,2)
"RTN","TIUALRT1",27,0)
 ;Expected Cosigner and Author of original document
"RTN","TIUALRT1",28,0)
 S TIUECSNR=$P($G(^TIU(8925,+TIU21,12)),U,8),TIUESNR=$P($G(^(12)),U,4)
"RTN","TIUALRT1",29,0)
 ; Not attached by Expected Signer: SET Expected Signer as recipient
"RTN","TIUALRT1",30,0)
 I TIUESNR'=DUZ,$D(^VA(200,+TIUESNR,0)) S XQA(TIUESNR)=""
"RTN","TIUALRT1",31,0)
 ; Not attached by Expected Cosigner: SET Expected Cosigner as recipient
"RTN","TIUALRT1",32,0)
 I +TIUECSNR,(TIUECSNR'=DUZ),$D(^VA(200,+TIUECSNR,0)) S XQA(TIUECSNR)=""
"RTN","TIUALRT1",33,0)
 Q:$D(XQA)'>9
"RTN","TIUALRT1",34,0)
 S XQAID="TIUID"_+DA_";",XQADATA=+DA_U,XQAROU="ACTID^TIUALRT1"
"RTN","TIUALRT1",35,0)
 S XQAMSG=TIUPNM_" ("_TIUSSN_"): ID Entry added by "_TIUESNM_" for "_TIUTITLE_" of "_TIUDATE
"RTN","TIUALRT1",36,0)
 D SETUP^XQALERT
"RTN","TIUALRT1",37,0)
 Q
"RTN","TIUALRT1",38,0)
 ;
"RTN","TIUALRT1",39,0)
ACTID    ; Act on ID Entry alerts
"RTN","TIUALRT1",40,0)
 N TIUQUIK,TIUDA,TIUPRM0,TIUPRM1,TIUPRM3 S TIUQUIK=1 K XQAKILL
"RTN","TIUALRT1",41,0)
 S TIUDA=$P(XQADATA,U),XQAKILL=1
"RTN","TIUALRT1",42,0)
 I '$D(^TIU(8925,+TIUDA,0)) D IDDEL(TIUDA) Q
"RTN","TIUALRT1",43,0)
 W !!,"A NEW Interdisciplinary Entry has been added to your document...",!
"RTN","TIUALRT1",44,0)
 W:$L($P($G(XQX),U,3)) !,$P($G(XQX),U,3),!
"RTN","TIUALRT1",45,0)
 I '+$$READ^TIUU("YAO","Do you wish to Browse the Interdisciplinary Entry now? ","NO") Q
"RTN","TIUALRT1",46,0)
 D:'$D(TIUPRM0)!'$D(TIUPRM1) SETPARM^TIULE
"RTN","TIUALRT1",47,0)
 D EN^VALM("TIU BROWSE FOR CLINICIAN")
"RTN","TIUALRT1",48,0)
 Q
"RTN","TIUALRT1",49,0)
 ;
"RTN","TIUALRT1",50,0)
IDDEL(DA) ; Delete alert associated with ID Entry added
"RTN","TIUALRT1",51,0)
 N XQA,XQAID,XQAKILL S XQAID="TIUID"_DA_";"
"RTN","TIUALRT1",52,0)
 D DELETEA^XQALERT
"RTN","TIUALRT1",53,0)
 Q
"RTN","TIUAUDIT")
0^94^B3039693
"RTN","TIUAUDIT",1,0)
TIUAUDIT ;SLC/JER - Display audit trail ;4/4/01
"RTN","TIUAUDIT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUAUDIT",3,0)
 ;;Text Integration Utility;;
"RTN","TIUAUDIT",4,0)
EN ; Option entry
"RTN","TIUAUDIT",5,0)
 K ^TMP("TIUAUDIT",$J) N TIU
"RTN","TIUAUDIT",6,0)
 D EN^VALM("TIU DISPLAY AUDIT TRAIL")
"RTN","TIUAUDIT",7,0)
 K ^TMP("TIUAUDIT",$J)
"RTN","TIUAUDIT",8,0)
 Q
"RTN","TIUAUDIT",9,0)
MAIN ; Control branching
"RTN","TIUAUDIT",10,0)
 N TIUVIEW S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUAUDIT",11,0)
 I +TIUVIEW'>0 D  Q
"RTN","TIUAUDIT",12,0)
 . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIUAUDIT",13,0)
 . I $$READ^TIUU("EA","RETURN to continue...")
"RTN","TIUAUDIT",14,0)
 D GET^TIUSRV(TIUDA)
"RTN","TIUAUDIT",15,0)
 Q
"RTN","TIUAUDIT",16,0)
HDR ; Build Header
"RTN","TIUAUDIT",17,0)
 N TIUDTYP,DFN
"RTN","TIUAUDIT",18,0)
 ; I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUAUDIT",19,0)
 D:$D(TIU)'>9 GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUAUDIT",20,0)
 S VALMHDR(1)=$$CENTER^TIULS($P($G(TIU("DOCTYP")),U,2))
"RTN","TIUAUDIT",21,0)
 S VALMHDR(2)=$$SETREC("HDR")
"RTN","TIUAUDIT",22,0)
 Q
"RTN","TIUAUDIT",23,0)
SETREC(LINE) ; Calls $$SETSTR^VALM1 for each line of ^TMP("TIUAUDIT",$J,
"RTN","TIUAUDIT",24,0)
 N Y
"RTN","TIUAUDIT",25,0)
 I LINE="HDR" D
"RTN","TIUAUDIT",26,0)
 . S Y=$$SETSTR^VALM1($$NAME^TIULS(TIU("PNM"),"LAST,FI MI"),$G(Y),1,15)
"RTN","TIUAUDIT",27,0)
 . S Y=$$SETSTR^VALM1(TIU("SSN"),$G(Y),16,12)
"RTN","TIUAUDIT",28,0)
 . S Y=$$SETSTR^VALM1($P($G(TIU("WARD")),U,2),$G(Y),30,20)
"RTN","TIUAUDIT",29,0)
 . I +TIU("DOCTYP")=1 D
"RTN","TIUAUDIT",30,0)
 . . S Y=$$SETSTR^VALM1("Adm: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/YY"),$G(Y),51,13)
"RTN","TIUAUDIT",31,0)
 . . S Y=$$SETSTR^VALM1("Dis: "_$$DATE^TIULS(+TIU("LDT"),"MM/DD/YY"),$G(Y),66,13)
"RTN","TIUAUDIT",32,0)
 . I +TIU("DOCTYP")'=1 D
"RTN","TIUAUDIT",33,0)
 . . S Y=$$SETSTR^VALM1("Visit Date: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/YY@HR:MIN"),$G(Y),53,26)
"RTN","TIUAUDIT",34,0)
 Q Y
"RTN","TIUAUDIT",35,0)
 ;
"RTN","TIUAUDIT",36,0)
CLEAN ; Die, filthy spawn!!!
"RTN","TIUAUDIT",37,0)
 D CLEAN^VALM10 K VALMHDR,TIU,TIUPRM0,TIUPRM1
"RTN","TIUAUDIT",38,0)
 Q
"RTN","TIUBR")
0^6^B35871110
"RTN","TIUBR",1,0)
TIUBR ; SLC/JER - Browse Action Subroutines ;4/12/01
"RTN","TIUBR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**32,87,93,58,100**;Jun 20, 1997
"RTN","TIUBR",3,0)
 ; Move LOADSIG, XTRASIG, LOADFOR, LOADREC to TIUBR1.
"RTN","TIUBR",4,0)
EN ; Entry code for LM templates TIU BROWSE
"RTN","TIUBR",5,0)
 N TIUY
"RTN","TIUBR",6,0)
 ;Kill TIUGDATA in CLEAN; don't new it here
"RTN","TIUBR",7,0)
 ; -- Set TIUGDATA, which describes the note originally
"RTN","TIUBR",8,0)
 ;    selected to be browsed. --
"RTN","TIUBR",9,0)
 ; TIUGDATA = 0 or
"RTN","TIUBR",10,0)
 ;          = TIUDA^HASIDKID^TIUD21^PRMSORT, where
"RTN","TIUBR",11,0)
 ;            PRMSORT = "TITLE" or "REFDT".  See 8925.95, fld .18
"RTN","TIUBR",12,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIUBR",13,0)
 D BLDTMP(TIUDA)
"RTN","TIUBR",14,0)
 Q
"RTN","TIUBR",15,0)
HDR ; Build Header
"RTN","TIUBR",16,0)
 N TIUDTYP,DFN
"RTN","TIUBR",17,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUBR",18,0)
 D:$D(TIU)'>9 GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUBR",19,0)
 S VALMHDR(1)=$$CENTER^TIULS($P($G(TIU("DOCTYP")),U,2))
"RTN","TIUBR",20,0)
 ;  Docmt header line Patname, SSN, [Location, Visit]:
"RTN","TIUBR",21,0)
 S VALMHDR(2)=$$SETREC(TIUGDATA)
"RTN","TIUBR",22,0)
 Q
"RTN","TIUBR",23,0)
BLDTMP(TIUDA) ; Build ^TMP("TIUVIEW",$J,
"RTN","TIUBR",24,0)
 ; Requires TIUDA = IFN of note selected to be browsed.
"RTN","TIUBR",25,0)
 ; Needs TIUGDATA, set in EN
"RTN","TIUBR",26,0)
 N TIUI,TIUL,TIUREC,TIUDADD S (TIUDADD,TIUI)=0
"RTN","TIUBR",27,0)
 N TIUNAME K ^TMP("TIUVIEW",$J),^TMP("TIU FOCUS",$J)
"RTN","TIUBR",28,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUBR",29,0)
 S ^TMP("TIU FOCUS",$J)=TIUDA
"RTN","TIUBR",30,0)
 D INQUIRE^TIUGBR(TIUDA,.TIUREC)
"RTN","TIUBR",31,0)
 I $D(TIUREC)>9 W !!,"Opening "_TIUREC(8925,+TIUDA,.01)_" record for review..."
"RTN","TIUBR",32,0)
 ; ---- Load dictation, transcription data, etc.: ----
"RTN","TIUBR",33,0)
 D LOADTOP(.TIUREC,TIUDA,.TIUL,TIUGDATA)
"RTN","TIUBR",34,0)
 ; ---- Load the remainder of the record: ----
"RTN","TIUBR",35,0)
 D LOADREC^TIUBR1(TIUDA,.TIUL,TIUGDATA)
"RTN","TIUBR",36,0)
 K ^TMP("TIU FOCUS",$J)
"RTN","TIUBR",37,0)
 S ^TMP("TIUVIEW",$J,0)=$G(^TIU(8925,+TIUDA,"TEXT",0))
"RTN","TIUBR",38,0)
 S $P(^TMP("TIUVIEW",$J,0),U,3,4)=$G(TIUL)_U_$G(TIUL),VALMCNT=+$G(TIUL)
"RTN","TIUBR",39,0)
 Q
"RTN","TIUBR",40,0)
LOADTOP(TIUREC,TIUDA,TIUL,TIUGDATA) ; Load dictation, transcription data, etc.
"RTN","TIUBR",41,0)
 ; Requires array TIUREC, TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR",42,0)
 N TIUY,SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT
"RTN","TIUBR",43,0)
 ; ---- For ID note, include Title, [Location, & Visit] with each
"RTN","TIUBR",44,0)
 ;      entry, since they vary by entry.
"RTN","TIUBR",45,0)
 ; ---- Follow with Date, Author, etc.
"RTN","TIUBR",46,0)
 ; ---- For ID children in whole note display, shorten top info:
"RTN","TIUBR",47,0)
 ;      Instead of Title, Location, Visit, Date, Author, etc.,
"RTN","TIUBR",48,0)
 ;      use just Title, followed by just Date and Status:
"RTN","TIUBR",49,0)
 S (SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT)=0
"RTN","TIUBR",50,0)
 I $P(TIUGDATA,U,3) S SELCHLD=1 ; Selected record was IDchild
"RTN","TIUBR",51,0)
 I $P(TIUGDATA,U,2) S SELPRNT=1
"RTN","TIUBR",52,0)
 I SELCHLD,TIUDA'=$P(TIUGDATA,U,3) S CURCHLD=1 ; Current rec is IDchild
"RTN","TIUBR",53,0)
 I SELCHLD,TIUDA=$P(TIUGDATA,U,3) S CURPRNT=1
"RTN","TIUBR",54,0)
 I SELPRNT,TIUDA=+TIUGDATA S CURPRNT=1
"RTN","TIUBR",55,0)
 I SELPRNT,TIUDA'=+TIUGDATA S CURCHLD=1
"RTN","TIUBR",56,0)
 I SELPRNT,CURCHLD S SHORT=1 ;Child in whole note: shorten top info
"RTN","TIUBR",57,0)
 I SELCHLD,CURCHLD,$G(TIUGWHOL) S SHORT=1
"RTN","TIUBR",58,0)
 I SELCHLD!SELPRNT D
"RTN","TIUBR",59,0)
 . D IDTOP^TIUGBR(TIUDA,.TIUL,SHORT,CURPRNT)
"RTN","TIUBR",60,0)
 S TIUL=+$G(TIUL)+1,TIUY=""
"RTN","TIUBR",61,0)
 I SHORT D
"RTN","TIUBR",62,0)
 . S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),$G(TIUY),1,39)
"RTN","TIUBR",63,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),$G(TIUY),42,38)
"RTN","TIUBR",64,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",65,0)
 I 'SHORT D
"RTN","TIUBR",66,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUBR",67,0)
 . . S TIUY=$$SETSTR^VALM1("DICT DATE: "_TIUREC(8925,+TIUDA,1307),$G(TIUY),4,39)
"RTN","TIUBR",68,0)
 . E  S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),$G(TIUY),1,39)
"RTN","TIUBR",69,0)
 . S TIUY=$$SETSTR^VALM1("ENTRY DATE: "_TIUREC(8925,+TIUDA,1201),$G(TIUY),38,39)
"RTN","TIUBR",70,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",71,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",72,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUBR",73,0)
 . . S TIUY=$$SETSTR^VALM1("DICTATED BY: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),2,32)
"RTN","TIUBR",74,0)
 . E  S TIUY=$$SETSTR^VALM1("AUTHOR: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),7,32)
"RTN","TIUBR",75,0)
 . I $L(TIUREC(8925,+TIUDA,1209)) D  I 1
"RTN","TIUBR",76,0)
 . . S TIUY=$$SETSTR^VALM1("ATTENDING: "_TIUREC(8925,+TIUDA,1209),$G(TIUY),39,40)
"RTN","TIUBR",77,0)
 . E  S TIUY=$$SETSTR^VALM1("EXP COSIGNER: "_TIUREC(8925,+TIUDA,1208),$G(TIUY),36,40)
"RTN","TIUBR",78,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",79,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",80,0)
 . S TIUY=$$SETSTR^VALM1("URGENCY: "_TIUREC(8925,+TIUDA,.09),$G(TIUY),6,36)
"RTN","TIUBR",81,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),$G(TIUY),42,38)
"RTN","TIUBR",82,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",83,0)
 S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",84,0)
 I '$L($G(^TIU(8925,+TIUDA,17))) S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",85,0)
 E  D
"RTN","TIUBR",86,0)
 . S TIUY=$$SETSTR^VALM1("SUBJECT: "_$G(^TIU(8925,+TIUDA,17)),$G(TIUY),6,74)
"RTN","TIUBR",87,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",88,0)
 . S TIUL=TIUL+1,TIUY="",@VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",89,0)
 I +$$HASADDEN^TIULC1(TIUDA) D
"RTN","TIUBR",90,0)
 . S TIUY="   *** "_$$PNAME^TIULC1(+$G(^TIU(8925,TIUDA,0)))_" Has ADDENDA ***"
"RTN","TIUBR",91,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",92,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR",93,0)
 Q
"RTN","TIUBR",94,0)
 ;
"RTN","TIUBR",95,0)
LOADKIDS(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ID kids of TIUDA
"RTN","TIUBR",96,0)
 ; Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR",97,0)
 N TIUK,PRMSORT,KIDDA,TIUD0,TIUD21
"RTN","TIUBR",98,0)
 I $G(^TMP("TIUR",$J,"IDDATA",TIUDA)) S PRMSORT=$P(^TMP("TIUR",$J,"IDDATA",TIUDA),U,4)
"RTN","TIUBR",99,0)
 E  S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD21=$G(^TIU(8925,TIUDA,21)),PRMSORT=$P($$IDDATA^TIURECL1(TIUDA,TIUD0,TIUD21),U,4)
"RTN","TIUBR",100,0)
 D GETIDKID^TIURECL2(TIUDA,PRMSORT) ; sets array ^TMP("TIUIDKID",$J,
"RTN","TIUBR",101,0)
 S TIUK=0
"RTN","TIUBR",102,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:+TIUK'>0  D
"RTN","TIUBR",103,0)
 . S KIDDA=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIUBR",104,0)
 . D LOADID^TIUGBR(KIDDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUBR",105,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIUBR",106,0)
 Q
"RTN","TIUBR",107,0)
 ;
"RTN","TIUBR",108,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUBR",109,0)
 N TIUY,TIUTYP
"RTN","TIUBR",110,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUBR",111,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUBR",112,0)
 Q TIUY
"RTN","TIUBR",113,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUBR",114,0)
 N TIUDADT,TIUJ,CANSEE
"RTN","TIUBR",115,0)
 S CANSEE=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUBR",116,0)
 S TIUJ=0,TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR",117,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/CCYY")
"RTN","TIUBR",118,0)
 S TIUL=TIUL+1,@VALMAR@(TIUL,0)=TIUDADT_" ADDENDUM:"
"RTN","TIUBR",119,0)
 I +CANSEE'>0 D  Q
"RTN","TIUBR",120,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR",121,0)
 . S @VALMAR@(TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUBR",122,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUBR",123,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR",124,0)
 . S @VALMAR@(TIUL,0)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUBR",125,0)
 D LOADSIG^TIUBR1(TIUDADD,.TIUL)
"RTN","TIUBR",126,0)
 Q
"RTN","TIUBR",127,0)
 ;
"RTN","TIUBR",128,0)
SETREC(TIUGDATA) ; Sets docmt header line Patname, SSN, [Location, Visit]
"RTN","TIUBR",129,0)
 ; Requires TIUGDATA
"RTN","TIUBR",130,0)
 N Y
"RTN","TIUBR",131,0)
 S Y=$$SETSTR^VALM1($$NAME^TIULS($G(TIU("PNM")),"LAST,FI MI"),$G(Y),1,15)
"RTN","TIUBR",132,0)
 S Y=$$SETSTR^VALM1($G(TIU("SSN")),$G(Y),16,12)
"RTN","TIUBR",133,0)
 ; ---- If TIUDA is an ID entry, write ID, ADDENDED? in header
"RTN","TIUBR",134,0)
 ;      and leave out entry-specific info (Location, Visit)
"RTN","TIUBR",135,0)
 ;      since that goes with each individual entry: ----
"RTN","TIUBR",136,0)
 I $P(TIUGDATA,U,2)!$P(TIUGDATA,U,3) D  G SETRX
"RTN","TIUBR",137,0)
 . S Y=$$SETSTR^VALM1("Interdisciplinary "_$S($P(TIUGDATA,U,2):"Note",1:"Entry"),$G(Y),29,23)
"RTN","TIUBR",138,0)
 . I $P(TIUGDATA,U,2) S Y=$$SETSTR^VALM1("ADDENDED?"_$S($$HASADDEN^TIULC1(+TIUDA,1):" Yes",1:" No"),$G(Y),66,13)
"RTN","TIUBR",139,0)
 S Y=$$SETSTR^VALM1($P($G(TIU("LOC")),U,2),$G(Y),30,17)
"RTN","TIUBR",140,0)
 I $L($G(TIU("WARD"))) D
"RTN","TIUBR",141,0)
 . S Y=$$SETSTR^VALM1("Adm: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/CCYY"),$G(Y),48,15)
"RTN","TIUBR",142,0)
 . S Y=$$SETSTR^VALM1("Dis: "_$$DATE^TIULS(+TIU("LDT"),"MM/DD/CCYY"),$G(Y),65,15)
"RTN","TIUBR",143,0)
 I '$L($G(TIU("WARD"))) D
"RTN","TIUBR",144,0)
 . S Y=$$SETSTR^VALM1("Visit Date: "_$$DATE^TIULS(+$G(TIU("EDT")),"MM/DD/CCYY HR:MIN"),$G(Y),51,28)
"RTN","TIUBR",145,0)
SETRX Q Y
"RTN","TIUBR",146,0)
 ;
"RTN","TIUBR",147,0)
CLEAN ; Die, filthy spawn!!!
"RTN","TIUBR",148,0)
 D CLEAN^VALM10 K VALMHDR,TIU,TIUPRM0,TIUPRM1,TIUGDATA
"RTN","TIUBR",149,0)
 Q
"RTN","TIUBR1")
0^7^B62172798
"RTN","TIUBR1",1,0)
TIUBR1 ;SLC/JER - Enter TIU Browse with DFN and TIUDA ;4/10/01
"RTN","TIUBR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**31,100**;Jul 20, 1997
"RTN","TIUBR1",3,0)
 ; Move LOADSIG, XTRASIG, LOADFOR, LOADREC from TIUBR. **100**
"RTN","TIUBR1",4,0)
 ;
"RTN","TIUBR1",5,0)
LOADREC(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ^TMP
"RTN","TIUBR1",6,0)
 ;Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR1",7,0)
 ;optional TIUGWHOL = 1 if we're mid-load for browse, and we're already
"RTN","TIUBR1",8,0)
 ;                    loading the whole note after the selected child,
"RTN","TIUBR1",9,0)
 ;                    so DON'T load the whole note again.
"RTN","TIUBR1",10,0)
 N TIUKID,TIUI,CANSEE,TIUPARNT,TIUPNAME,TIUPDATE
"RTN","TIUBR1",11,0)
 N TIUGPRNT,TIUGPNM,TIUGPDT,TIUPDATA,TIUHASKD
"RTN","TIUBR1",12,0)
 S TIUI=0
"RTN","TIUBR1",13,0)
 ; ---- If user cannot view, say so and quit: ----
"RTN","TIUBR1",14,0)
 ;      TIU*1*100
"RTN","TIUBR1",15,0)
 S CANSEE=$S(+$$ISCOMP^TIUBR(TIUDA)>0:1,1:$$CANDO^TIULP(+TIUDA,"VIEW"))
"RTN","TIUBR1",16,0)
 I +CANSEE'>0 D  Q
"RTN","TIUBR1",17,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",18,0)
 . S @VALMAR@(TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUBR1",19,0)
 ; ---- Load text of TIUDA: ----
"RTN","TIUBR1",20,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUBR1",21,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",22,0)
 . S @VALMAR@(TIUL,0)=$G(^TIU(8925,+TIUDA,"TEXT",+TIUI,0))
"RTN","TIUBR1",23,0)
 ; ---- If TIUDA is a COMPONENT, QUIT
"RTN","TIUBR1",24,0)
 Q:+$$ISCOMP^TIUBR(TIUDA)
"RTN","TIUBR1",25,0)
 ; ---- If TIUDA **IS** an addendum, load addm signature,
"RTN","TIUBR1",26,0)
 ;         load original document, quit: ----
"RTN","TIUBR1",27,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D  Q
"RTN","TIUBR1",28,0)
 . N TIULINE S $P(TIULINE,"=",79)=""
"RTN","TIUBR1",29,0)
 . D LOADSIG(TIUDA,.TIUL)
"RTN","TIUBR1",30,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",31,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIULINE
"RTN","TIUBR1",32,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",33,0)
 . S TIUPARNT=+$P(^TIU(8925,+TIUDA,0),U,6)
"RTN","TIUBR1",34,0)
 . S TIUPNAME=$$PNAME^TIULC1(+^TIU(8925,TIUPARNT,0))
"RTN","TIUBR1",35,0)
 . S TIUPDATE=+$G(^TIU(8925,TIUPARNT,13))
"RTN","TIUBR1",36,0)
 . S TIUPDATE=$$DATE^TIULS(TIUPDATE,"MM/DD/YY")
"RTN","TIUBR1",37,0)
 . S TIUPDATA=$$IDDATA^TIURECL1(TIUPARNT)
"RTN","TIUBR1",38,0)
 . S TIUHASKD=$P(TIUPDATA,U,2),TIUGPRNT=+$P(TIUPDATA,U,3)
"RTN","TIUBR1",39,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",40,0)
 . I TIUHASKD D
"RTN","TIUBR1",41,0)
 . . S @VALMAR@(TIUL,0)=" --- Original Addended Interdisciplinary Entry ---"
"RTN","TIUBR1",42,0)
 . I TIUGPRNT D
"RTN","TIUBR1",43,0)
 . . S @VALMAR@(TIUL,0)=" --- Original Addended Interdisciplinary Entry ---"
"RTN","TIUBR1",44,0)
 . . S TIUGPNM=$$PNAME^TIULC1(+^TIU(8925,TIUGPRNT,0))
"RTN","TIUBR1",45,0)
 . . S TIUGPDT=+$G(^TIU(8925,TIUGPRNT,13))
"RTN","TIUBR1",46,0)
 . . S TIUGPDT=$$DATE^TIULS(TIUGPDT,"MM/DD/YY")
"RTN","TIUBR1",47,0)
 . I 'TIUHASKD,'TIUGPRNT S @VALMAR@(TIUL,0)=" --- Original Document ---"
"RTN","TIUBR1",48,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",49,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",50,0)
 . I TIUHASKD D
"RTN","TIUBR1",51,0)
 . . S @VALMAR@(TIUL,0)="                    << Addended Interdisciplinary Entry >>"
"RTN","TIUBR1",52,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",53,0)
 . . S @VALMAR@(TIUL,0)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUBR1",54,0)
 . I TIUGPRNT D
"RTN","TIUBR1",55,0)
 . . S @VALMAR@(TIUL,0)="                         << Interdisciplinary Note >>"
"RTN","TIUBR1",56,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",57,0)
 . . S @VALMAR@(TIUL,0)=TIUGPDT_" "_TIUGPNM
"RTN","TIUBR1",58,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",59,0)
 . . S @VALMAR@(TIUL,0)="                    << Addended Interdisciplinary Entry >>"
"RTN","TIUBR1",60,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUBR1",61,0)
 . I 'TIUHASKD,'TIUGPRNT D
"RTN","TIUBR1",62,0)
 . . S @VALMAR@(TIUL,0)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUBR1",63,0)
 . D LOADREC(TIUPARNT,.TIUL,TIUGDATA)
"RTN","TIUBR1",64,0)
 ; ---- Load components of TIUDA: ----
"RTN","TIUBR1",65,0)
 S TIUKID=0
"RTN","TIUBR1",66,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUBR1",67,0)
 . I +$$ISADDNDM^TIULC1(TIUKID)'>0 D LOADREC(TIUKID,.TIUL,TIUGDATA)
"RTN","TIUBR1",68,0)
 ; ---- Load signature of TIUDA if TIUDA is not addm
"RTN","TIUBR1",69,0)
 ;           or comp: ----
"RTN","TIUBR1",70,0)
 I '$$ISCOMP^TIUBR(TIUDA) D LOADSIG(TIUDA,.TIUL)
"RTN","TIUBR1",71,0)
 ; ---- Load addenda of TIUDA: ----
"RTN","TIUBR1",72,0)
 S TIUKID=0
"RTN","TIUBR1",73,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUBR1",74,0)
 . ; If an addendum has focus, don't show it again.
"RTN","TIUBR1",75,0)
 . I +TIUKID=+$G(^TMP("TIU FOCUS",$J)) Q
"RTN","TIUBR1",76,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D LOADADD^TIUBR(TIUKID,.TIUL)
"RTN","TIUBR1",77,0)
 N IDDAD
"RTN","TIUBR1",78,0)
 S IDDAD=+$P(TIUGDATA,U,3)
"RTN","TIUBR1",79,0)
 ; ---- If Browsed Record is an ID parent, & this cycle has
"RTN","TIUBR1",80,0)
 ;      just loaded the parent entry, then load ID kids
"RTN","TIUBR1",81,0)
 ;      and quit: **100** ----
"RTN","TIUBR1",82,0)
 I $P(TIUGDATA,U,2),TIUDA=+TIUGDATA D LOADKIDS^TIUBR(TIUDA,.TIUL,TIUGDATA) Q
"RTN","TIUBR1",83,0)
 ; ---- If Browsed Record is an ID child, & this cycle hasn't begun
"RTN","TIUBR1",84,0)
 ;      loading the whole note, then load the whole ID Note after
"RTN","TIUBR1",85,0)
 ;      the browsed child and quit: ----
"RTN","TIUBR1",86,0)
 I IDDAD,'$G(TIUGWHOL) D  Q
"RTN","TIUBR1",87,0)
 . S TIUGWHOL=1
"RTN","TIUBR1",88,0)
 . N TIULINE S $P(TIULINE,"=",79)=""
"RTN","TIUBR1",89,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",90,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIULINE
"RTN","TIUBR1",91,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",92,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" --- Original Interdisciplinary Note ---"
"RTN","TIUBR1",93,0)
 . D LOADID^TIUGBR(IDDAD,.TIUL,TIUGDATA,TIUGWHOL)
"RTN","TIUBR1",94,0)
 ; ---- If Browsed Record is an ID child, & this cycle has begun
"RTN","TIUBR1",95,0)
 ;      loading the whole ID note, and is currently loading the first
"RTN","TIUBR1",96,0)
 ;      entry of the whole note, then load kids and quit: ----
"RTN","TIUBR1",97,0)
 I IDDAD,$G(TIUGWHOL),TIUDA=IDDAD D LOADKIDS^TIUBR(TIUDA,.TIUL,TIUGDATA,TIUGWHOL) K TIUGWHOL
"RTN","TIUBR1",98,0)
 Q
"RTN","TIUBR1",99,0)
 ;
"RTN","TIUBR1",100,0)
EXSTNOTE(DFN,TIUDA) ; Sample/display existing notes
"RTN","TIUBR1",101,0)
 N TIU,TIUPRM0,TIUPRM1,TIUSEE,TIUOUT,TIUY,TIUQUIT
"RTN","TIUBR1",102,0)
 D SETPARM^TIULE
"RTN","TIUBR1",103,0)
 Q:TIUDA'>0
"RTN","TIUBR1",104,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUBR1",105,0)
 I $D(TIU) D
"RTN","TIUBR1",106,0)
 . S TIUSEE=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUBR1",107,0)
 . I 'TIUSEE D  Q
"RTN","TIUBR1",108,0)
 . . W !!,$C(7),$P(TIUSEE,U,2),!
"RTN","TIUBR1",109,0)
 . . W:$$READ^TIUU("FOA","Press RETURN to continue...") ""
"RTN","TIUBR1",110,0)
 . D EN^VALM("TIU BROWSE FOR CLINICIAN")
"RTN","TIUBR1",111,0)
 . K ^TMP("TIUVIEW",$J)
"RTN","TIUBR1",112,0)
 . S:$D(TIUQUIT) TIUOUT=1
"RTN","TIUBR1",113,0)
 Q
"RTN","TIUBR1",114,0)
 ;
"RTN","TIUBR1",115,0)
LOADSIG(DA,TIUL) ; Get signature and co-signature blocks
"RTN","TIUBR1",116,0)
 N DIC,DIQ,DR,TIUSIG,TIUESIG1,TIUESIG2,TIUSIG1,TIUSIG2,TIUS1,TIUS2
"RTN","TIUBR1",117,0)
 N TIUSNM,TIUSTTL,TIUS1DT,TIUS2DT,TIUSDT
"RTN","TIUBR1",118,0)
 Q:'$D(^TIU(8925,DA,15))
"RTN","TIUBR1",119,0)
 S DIC=8925,DIQ="TIUSIG(",DIQ(0)="IE",DR="1204;1208;1501:1505;1507:1511;1601:1605"
"RTN","TIUBR1",120,0)
 D EN^DIQ1 I '$D(TIUSIG) Q
"RTN","TIUBR1",121,0)
 S TIUS1=$S(TIUSIG(8925,DA,1505,"I")="E":"/es/ ",TIUSIG(8925,DA,1505,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1503,"E"))
"RTN","TIUBR1",122,0)
 S TIUS2=$S(TIUSIG(8925,DA,1511,"I")="E":"/es/ ",TIUSIG(8925,DA,1511,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1509,"E"))
"RTN","TIUBR1",123,0)
 S TIUESIG1=$G(TIUSIG(8925,DA,1204,"I"))
"RTN","TIUBR1",124,0)
 S TIUSIG1=$G(TIUSIG(8925,DA,1502,"I"))
"RTN","TIUBR1",125,0)
 S TIUS1DT=$S(+$G(TIUSIG(8925,DA,1501,"I")):"Signed: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1501,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUBR1",126,0)
 S TIUESIG2=$G(TIUSIG(8925,DA,1208,"I"))
"RTN","TIUBR1",127,0)
 S TIUS2DT=$S(+$G(TIUSIG(8925,DA,1507,"I")):"Cosigned: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1507,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUBR1",128,0)
 S TIUSIG2=$G(TIUSIG(8925,DA,1508,"I"))
"RTN","TIUBR1",129,0)
 S TIUSNM=$$SETSTR^VALM1(TIUS1,$G(TIUSNM),1,35)
"RTN","TIUBR1",130,0)
 S TIUSNM=$$SETSTR^VALM1(TIUS2,$G(TIUSNM),40,35)
"RTN","TIUBR1",131,0)
 S TIUSTTL=$$SETSTR^VALM1(TIUSIG(8925,DA,1504,"E"),$G(TIUSTTL),1,35)
"RTN","TIUBR1",132,0)
 S TIUSTTL=$$SETSTR^VALM1(TIUSIG(8925,DA,1510,"E"),$G(TIUSTTL),40,35)
"RTN","TIUBR1",133,0)
 S TIUSDT=$$SETSTR^VALM1(TIUS1DT,$G(TIUSDT),1,35)
"RTN","TIUBR1",134,0)
 S TIUSDT=$$SETSTR^VALM1(TIUS2DT,$G(TIUSDT),40,35)
"RTN","TIUBR1",135,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR1",136,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUSNM
"RTN","TIUBR1",137,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUSTTL
"RTN","TIUBR1",138,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUSDT
"RTN","TIUBR1",139,0)
 I TIUSIG1]"",(TIUSIG1'=TIUESIG1) D LOADFOR(TIUSIG1,TIUESIG1,TIUSIG2,TIUESIG2,.TIUL) G XTRA
"RTN","TIUBR1",140,0)
 I TIUSIG2]"",(TIUSIG2'=TIUESIG2) D LOADFOR(TIUSIG1,TIUESIG1,TIUSIG2,TIUESIG2,.TIUL)
"RTN","TIUBR1",141,0)
XTRA I +$O(^TIU(8925.7,"B",DA,0)) D XTRASIG(DA,.TIUL)
"RTN","TIUBR1",142,0)
 I +$G(TIUSIG(8925,DA,1601,"I")) D
"RTN","TIUBR1",143,0)
 . N TIUMODE
"RTN","TIUBR1",144,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",145,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",146,0)
 . S @VALMAR@(TIUL,0)=$$DATE^TIULS(TIUSIG(8925,DA,1601,"I"),"MM/DD/CCYY HR:MIN")_"  AMENDMENT FILED:"
"RTN","TIUBR1",147,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="",TIUL=+$G(TIUL)+1
"RTN","TIUBR1",148,0)
 . S TIUMODE=$S(+$G(TIUSIG(8925,DA,1603,"I")):"/es/ ",1:" /s/ ")
"RTN","TIUBR1",149,0)
 . S @VALMAR@(TIUL,0)=TIUMODE_$S($G(TIUSIG(8925,DA,1604,"E"))]"":$G(TIUSIG(8925,DA,1604,"E")),1:$G(TIUSIG(8925,DA,1602,"E")))
"RTN","TIUBR1",150,0)
 . I $L($G(TIUSIG(8925,DA,1605,"E"))) D
"RTN","TIUBR1",151,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$G(TIUSIG(8925,DA,1605,"E"))
"RTN","TIUBR1",152,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$P($G(TIUPRM1),U,5)
"RTN","TIUBR1",153,0)
 Q
"RTN","TIUBR1",154,0)
XTRASIG(TIUDA,TIUL) ; Load additional signature blocks
"RTN","TIUBR1",155,0)
 N TIUI,DA,DR,DIC,DIQ,TIUXTRA S TIUI=0
"RTN","TIUBR1",156,0)
 S DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIUBR1",157,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR1",158,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="Receipt Acknowledged By:"
"RTN","TIUBR1",159,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUBR1",160,0)
 . N TIUX,TIUSGNR,TIUSDT
"RTN","TIUBR1",161,0)
 . S DA=TIUI,DR=".03:.08",DIQ(0)="IE" D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIUBR1",162,0)
 . S TIUSGNR=$S($L($G(TIUXTRA(8925.7,DA,.06,"E"))):"/es/ "_$G(TIUXTRA(8925.7,DA,.06,"E")),1:"     "_$G(TIUXTRA(8925.7,DA,.03,"E")))
"RTN","TIUBR1",163,0)
 . S TIUSDT=$S(+$G(TIUXTRA(8925.7,DA,.04,"I")):$$DATE^TIULS(TIUXTRA(8925.7,DA,.04,"I"),"MM/DD/CCYY HR:MIN"),1:"* AWAITING SIGNATURE *")
"RTN","TIUBR1",164,0)
 . S TIUX=$$SETSTR^VALM1(TIUSDT,$G(TIUX),1,38)
"RTN","TIUBR1",165,0)
 . S TIUX=$$SETSTR^VALM1(TIUSGNR,$G(TIUX),30,49)
"RTN","TIUBR1",166,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUX,TIUX=""
"RTN","TIUBR1",167,0)
 . S TIUX=$$SETSTR^VALM1($G(TIUXTRA(8925.7,DA,.07,"E")),$G(TIUX),35,44)
"RTN","TIUBR1",168,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUX
"RTN","TIUBR1",169,0)
 Q
"RTN","TIUBR1",170,0)
LOADFOR(TIUS1,TIUES1,TIUS2,TIUES2,TIUL) ; Apply "for" block(s)
"RTN","TIUBR1",171,0)
 N TIUESN1,TIUEST1,TIUESN2,TIUEST2,TIUFORN,TIUFORT
"RTN","TIUBR1",172,0)
 S TIUESN1="for "_$$SIGNAME^TIULS(TIUES1),TIUEST1=$$SIGTITL^TIULS(TIUES1)
"RTN","TIUBR1",173,0)
 S TIUESN2="for "_$$SIGNAME^TIULS(TIUES2),TIUEST2=$$SIGTITL^TIULS(TIUES2)
"RTN","TIUBR1",174,0)
 I +$G(TIUS1),($G(TIUS1)'=$G(TIUES1)) S TIUFORN=$$SETSTR^VALM1(TIUESN1,$G(TIUFORN),1,35),TIUFORT=$$SETSTR^VALM1(TIUEST1,$G(TIUFORT),1,35)
"RTN","TIUBR1",175,0)
 I +$G(TIUS2),($G(TIUS2)'=$G(TIUES2)) S TIUFORN=$$SETSTR^VALM1(TIUESN2,$G(TIUFORN),40,35),TIUFORT=$$SETSTR^VALM1(TIUEST2,$G(TIUFORT),40,35)
"RTN","TIUBR1",176,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUFORN
"RTN","TIUBR1",177,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUFORT
"RTN","TIUBR1",178,0)
 Q
"RTN","TIUBRWS")
0^61^B2380614
"RTN","TIUBRWS",1,0)
TIUBRWS ; SLC/JER - Single patient browse ; 11/12/00
"RTN","TIUBRWS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUBRWS",3,0)
MAIN(TIULTMP,TIUTYP) ; Control Branching
"RTN","TIUBRWS",4,0)
 N DFN,TIU,TIUOUT,TIUREL,TIUCHK,TIUA,TIUSEE,ACT,TIUY
"RTN","TIUBRWS",5,0)
 N TIUOUT,TIUSEE,TIUI,TIUQUIT
"RTN","TIUBRWS",6,0)
 N TIUGDATA
"RTN","TIUBRWS",7,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUBRWS",8,0)
 S:$D(ORVP) DFN=+ORVP S TIUTYP=$G(TIUTYP,38)
"RTN","TIUBRWS",9,0)
 S TIUTYP(1)="1^"_TIUTYP_U_$P(^TIU(8925.1,+TIUTYP,0),U)
"RTN","TIUBRWS",10,0)
 F  D  Q:+$G(TIUOUT)
"RTN","TIUBRWS",11,0)
 . N TIUDAT,TIUGDATA
"RTN","TIUBRWS",12,0)
 . D SELPAT^TIULA2(.TIUDAT,TIUTYP,+$G(DFN))
"RTN","TIUBRWS",13,0)
 . I +$G(TIUDAT)'>0,($D(TIUDAT)'>9) D  S TIUOUT=1 Q
"RTN","TIUBRWS",14,0)
 . . W !!,"Nothing selected."
"RTN","TIUBRWS",15,0)
 . S TIUI=0
"RTN","TIUBRWS",16,0)
 . F  S TIUI=$O(TIUDAT(TIUI)) Q:+TIUI'>0  D  Q:$D(DUOUT)!$D(DIROUT)!+$G(TIUOUT)
"RTN","TIUBRWS",17,0)
 . . S TIUDA=+$G(TIUDAT(TIUI)) Q:TIUDA'>0
"RTN","TIUBRWS",18,0)
 . . D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUBRWS",19,0)
 . . I $D(TIU) D
"RTN","TIUBRWS",20,0)
 . . . S TIUSEE=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUBRWS",21,0)
 . . . I 'TIUSEE D  Q
"RTN","TIUBRWS",22,0)
 . . . . W !!,$C(7),$P(TIUSEE,U,2),! K DFN
"RTN","TIUBRWS",23,0)
 . . . . I $D(ORVP) S TIUOUT=1
"RTN","TIUBRWS",24,0)
 . . . . S TIU=$$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIUBRWS",25,0)
 . . . ; -- Get ID data needed for browse: --
"RTN","TIUBRWS",26,0)
 . . . S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIUBRWS",27,0)
 . . . D EN^VALM(TIULTMP)
"RTN","TIUBRWS",28,0)
 . . . K ^TMP("TIUVIEW",$J),DFN
"RTN","TIUBRWS",29,0)
 . . . S:$D(TIUQUIT) TIUOUT=1
"RTN","TIUBRWS",30,0)
 Q
"RTN","TIUEDI1")
0^10^B36955152
"RTN","TIUEDI1",1,0)
TIUEDI1 ; SLC/MAM - Additional Edit Code ;14-MAR-2001 09:30:02
"RTN","TIUEDI1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,22,66,61,100**;Jun 20, 1997
"RTN","TIUEDI1",3,0)
GETREC(DFN,TIU,TIUCREAT,TIUNEW,TIUDPRM,TIUINQ,TIUPERSN) ;Returns
"RTN","TIUEDI1",4,0)
 ;new or existing document DA.
"RTN","TIUEDI1",5,0)
 ; Receives TIUPERSN (optional) = person asking to edit/create docmt,
"RTN","TIUEDI1",6,0)
 ;             or for upload, = author of document.
"RTN","TIUEDI1",7,0)
 ;             If not received, assumed to be DUZ.
"RTN","TIUEDI1",8,0)
 ;             New **ID** parameter, backward compatible
"RTN","TIUEDI1",9,0)
 ; Requires array TIUTYP where
"RTN","TIUEDI1",10,0)
 ;   TIUTYP = title DA
"RTN","TIUEDI1",11,0)
 ;   TIUTYP(1) = 1^title DA^Name
"RTN","TIUEDI1",12,0)
 ; Receives TIUCREAT for backward compatibility place holder only
"RTN","TIUEDI1",13,0)
 S TIUPERSN=$G(TIUPERSN,DUZ)
"RTN","TIUEDI1",14,0)
 S DA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM,+$G(TIUINQ),TIUPERSN)
"RTN","TIUEDI1",15,0)
 Q +$G(DA)
"RTN","TIUEDI1",16,0)
 ;
"RTN","TIUEDI1",17,0)
INQUIRE() ; Ask user whether to create a new note anyway
"RTN","TIUEDI1",18,0)
 N TIUY,TIUPRMT
"RTN","TIUEDI1",19,0)
 S TIUY=0,TIUPRMT="Do you want to create a new record anyway"
"RTN","TIUEDI1",20,0)
 S TIUY=+$$READ^TIUU("Y",TIUPRMT,"NO")
"RTN","TIUEDI1",21,0)
 Q TIUY
"RTN","TIUEDI1",22,0)
SCANDAD(TIUTYP,TIUDA) ; Search "DAD" index for component record
"RTN","TIUEDI1",23,0)
 N TIUC,TIUY
"RTN","TIUEDI1",24,0)
 S (TIUY,TIUC)=0
"RTN","TIUEDI1",25,0)
 F  S TIUC=$O(^TIU(8925,"DAD",+TIUDA,TIUC)) Q:+TIUC'>0!(+TIUY>0)  D
"RTN","TIUEDI1",26,0)
 . I +TIUTYP=+$G(^TIU(8925,+TIUC,0)) S TIUY=TIUC Q
"RTN","TIUEDI1",27,0)
 . I +$O(^TIU(8925,"DAD",+TIUC,0)) S TIUY=$$SCANDAD(TIUTYP,TIUC)
"RTN","TIUEDI1",28,0)
 Q TIUY
"RTN","TIUEDI1",29,0)
GETCOMP(TIUTYP,TIUDA,TIU,DFN) ; Adds components to document
"RTN","TIUEDI1",30,0)
 N DIC,DA,X,Y,DIE,DR,TIUC,TIUCMP,TIUMOM,TIUMTYP,TIUY,TIUFPRIV
"RTN","TIUEDI1",31,0)
 N DLAYGO ;10/3/00
"RTN","TIUEDI1",32,0)
 S TIUFPRIV=1,(TIUY,TIUC)=0
"RTN","TIUEDI1",33,0)
 S TIUY=$$SCANDAD(TIUTYP,TIUDA)
"RTN","TIUEDI1",34,0)
 I +TIUY G GETCX
"RTN","TIUEDI1",35,0)
 S (DIC,DLAYGO)=8925,DIC(0)="FL"
"RTN","TIUEDI1",36,0)
 S X="""`"_+TIUTYP_""""
"RTN","TIUEDI1",37,0)
 D ^DIC
"RTN","TIUEDI1",38,0)
 I +Y'>0 W !,X," component could not be created.",! G GETCX
"RTN","TIUEDI1",39,0)
 S (TIUY,DA)=+Y,DIE=DIC
"RTN","TIUEDI1",40,0)
 S TIUMOM=+$$RUMYMTHR(TIUDA,DA,+TIUTYP,+$G(^TIU(8925,+DA,0)))
"RTN","TIUEDI1",41,0)
 S TIUMTYP=+$G(^TIU(8925,+TIUMOM,0))
"RTN","TIUEDI1",42,0)
 S DR=".02////"_DFN_";.03////"_$P($G(TIU("VISIT")),U)_";.04////"_TIUMTYP_";.06////"_TIUMOM
"RTN","TIUEDI1",43,0)
 D ^DIE W "."
"RTN","TIUEDI1",44,0)
GETCX Q TIUY
"RTN","TIUEDI1",45,0)
RUMYMTHR(MOM,BRAT,MOMTYP,BRATYP) ; Get appropriate parent for component
"RTN","TIUEDI1",46,0)
 N TIUI,GOTMOM,CNDMOM,CNDTYP,TIUMOM S (GOTMOM,TIUI)=0
"RTN","TIUEDI1",47,0)
 I +$O(^TIU(8925.1,"AD",+BRATYP,MOMTYP,0)) S GOTMOM=1 G RUMYX
"RTN","TIUEDI1",48,0)
 S CNDMOM=0
"RTN","TIUEDI1",49,0)
 F  S CNDMOM=$O(^TIU(8925,"DAD",+MOM,+CNDMOM)) Q:+CNDMOM'>0  D
"RTN","TIUEDI1",50,0)
 . S CNDTYP=+$G(^TIU(8925,+CNDMOM,0))
"RTN","TIUEDI1",51,0)
 . S TIUMOM=$$RUMYMTHR(CNDMOM,BRAT,CNDTYP,BRATYP) I $P(TIUMOM,U,2)=1 S MOM=+TIUMOM,GOTMOM=1 Q
"RTN","TIUEDI1",52,0)
RUMYX Q MOM_U_GOTMOM
"RTN","TIUEDI1",53,0)
DELCOMP(TIUDA) ; Cleans up all components of a document
"RTN","TIUEDI1",54,0)
 N DA,DIE,DR,TIUCDA S TIUCDA=0,DIE="^TIU(8925,"
"RTN","TIUEDI1",55,0)
 F  S TIUCDA=$O(^TIU(8925,"DAD",TIUDA,TIUCDA)) Q:+TIUCDA'>0  D
"RTN","TIUEDI1",56,0)
 . W !,$P(^TIU(8925.1,+^TIU(8925,TIUCDA,0),0),U)_" Component Deleted"
"RTN","TIUEDI1",57,0)
 . S DR=".01///@",DA=TIUCDA D ^DIE W "."
"RTN","TIUEDI1",58,0)
 . I +$O(^TIU(8925,"DAD",TIUCDA,0))>0  D DELCOMP(TIUCDA)
"RTN","TIUEDI1",59,0)
 Q
"RTN","TIUEDI1",60,0)
DELAUDIT(TIUDA) ; Cleans up all AUDIT TRAIL entries for a document
"RTN","TIUEDI1",61,0)
 N DA,DIK,DR,TIUADA S TIUADA=0,DIK="^TIU(8925.5,"
"RTN","TIUEDI1",62,0)
 F  S TIUADA=$O(^TIU(8925.5,"B",TIUDA,TIUADA)) Q:+TIUADA'>0  D
"RTN","TIUEDI1",63,0)
 . ; W !," Audit trail record #",TIUADA," Deleted"
"RTN","TIUEDI1",64,0)
 . S DA=TIUADA D ^DIK ; W "."
"RTN","TIUEDI1",65,0)
 Q
"RTN","TIUEDI1",66,0)
ISCOMP(TIUTYP,X) ; Is the text provided a component tag
"RTN","TIUEDI1",67,0)
 N DIC,TIULEVEL,TIUY,Y,TIUFPRIV S TIULEVEL=0,TIUFPRIV=1
"RTN","TIUEDI1",68,0)
 S DIC=8925.1,DIC(0)="FX"
"RTN","TIUEDI1",69,0)
 S DIC("S")="I $P(^TIU(8925.1,+Y,0),U,4)=""CO"""
"RTN","TIUEDI1",70,0)
 D ^DIC K DIC("S")
"RTN","TIUEDI1",71,0)
 I +Y'>0 S TIUY=0 G ISCMPX
"RTN","TIUEDI1",72,0)
 I +$O(^TIU(8925.1,+TIUTYP,10,"B",+Y,0))'>0 S TIUY=0 G ISCMPX
"RTN","TIUEDI1",73,0)
 S TIUY=Y
"RTN","TIUEDI1",74,0)
ISCMPX Q TIUY
"RTN","TIUEDI1",75,0)
MERGTEMP(TIUDA) ; Merge text from components into TEMP node for edit
"RTN","TIUEDI1",76,0)
 N TIUC,TIUI,TIUJ,TIULINE
"RTN","TIUEDI1",77,0)
 S (TIUC,TIULINE)=0,TIUJ=+$P($G(^TIU(8925,+TIUDA,"TEMP",0)),U,3)
"RTN","TIUEDI1",78,0)
 F  S TIUC=$O(^TIU(8925,"DAD",TIUDA,TIUC)) Q:+TIUC'>0  D
"RTN","TIUEDI1",79,0)
 . I +$$ISADDNDM^TIULC1(+TIUC) Q
"RTN","TIUEDI1",80,0)
 . S TIUI=0 F  S TIUI=$O(^TIU(8925,+TIUC,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUEDI1",81,0)
 . . S TIUJ=+$G(TIUJ)+1
"RTN","TIUEDI1",82,0)
 . . S ^TIU(8925,+TIUDA,"TEMP",TIUJ,0)=$G(^TIU(8925,+TIUC,"TEXT",TIUI,0))
"RTN","TIUEDI1",83,0)
 . . K ^TIU(8925,+TIUC,"TEXT",TIUI,0) ; Clear the way for edits
"RTN","TIUEDI1",84,0)
 . . S ^TIU(8925,+TIUC,"TEXT",0)="^^^^"_DT_"^^"
"RTN","TIUEDI1",85,0)
 . . S ^TIU(8925,+TIUDA,"TEMP",0)="^^"_TIUJ_"^"_TIUJ_"^"_DT_"^^"
"RTN","TIUEDI1",86,0)
 . I +$O(^TIU(8925,"DAD",+TIUC,0)) D MERGGRAN(TIUDA,+TIUC)
"RTN","TIUEDI1",87,0)
 . S TIUJ=+$P($G(^TIU(8925,+TIUDA,"TEMP",0)),U,3)
"RTN","TIUEDI1",88,0)
 I $D(^TIU(8925,+TIUDA,"TEMP",1))>9 M ^TIU(8925,+TIUDA,"TEXT")=^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUEDI1",89,0)
 Q
"RTN","TIUEDI1",90,0)
MERGGRAN(TIUDA,TIUC) ; Merge sub-components into TEMP node of original
"RTN","TIUEDI1",91,0)
 N TIUC1,TIUI,TIUJ,TIULINE
"RTN","TIUEDI1",92,0)
 S (TIUC1,TIULINE)=0,TIUJ=+$P($G(^TIU(8925,+TIUDA,"TEMP",0)),U,3)
"RTN","TIUEDI1",93,0)
 F  S TIUC1=$O(^TIU(8925,"DAD",TIUC,TIUC1)) Q:+TIUC1'>0  D
"RTN","TIUEDI1",94,0)
 . S TIUI=0 F  S TIUI=$O(^TIU(8925,+TIUC1,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUEDI1",95,0)
 . . S TIUJ=+$G(TIUJ)+1
"RTN","TIUEDI1",96,0)
 . . S ^TIU(8925,+TIUDA,"TEMP",TIUJ,0)=$G(^TIU(8925,+TIUC1,"TEXT",TIUI,0))
"RTN","TIUEDI1",97,0)
 . . K ^TIU(8925,+TIUC1,"TEXT",TIUI,0) ; Clear the way for edits
"RTN","TIUEDI1",98,0)
 . . S ^TIU(8925,+TIUC1,"TEXT",0)="^^^^"_DT_"^^"
"RTN","TIUEDI1",99,0)
 . . S ^TIU(8925,+TIUDA,"TEMP",0)="^^"_TIUJ_"^"_TIUJ_"^"_DT_"^^"
"RTN","TIUEDI1",100,0)
 . I +$O(^TIU(8925,"DAD",+TIUC1,0)) D MERGGRAN(TIUDA,+TIUC1)
"RTN","TIUEDI1",101,0)
 . S TIUJ=+$P($G(^TIU(8925,+TIUDA,"TEMP",0)),U,3)
"RTN","TIUEDI1",102,0)
 Q
"RTN","TIUEDI1",103,0)
MERGTEXT(TIUDA,TIU) ; Merge TEMP node from parent document into components
"RTN","TIUEDI1",104,0)
 N TIUTYP
"RTN","TIUEDI1",105,0)
 S TIUTYP=+$P(^TIU(8925,+TIUDA,0),U)
"RTN","TIUEDI1",106,0)
 ; -- If document has components, add/update them
"RTN","TIUEDI1",107,0)
 I +$O(^TIU(8925.1,+TIUTYP,10,0))>0 D
"RTN","TIUEDI1",108,0)
 . N TIUC,TIUI,TIUJ,TIUX,TIUCMP S (TIUI,TIUJ,TIUCMP)=0
"RTN","TIUEDI1",109,0)
 . F  S TIUI=$O(^TIU(8925,+TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUEDI1",110,0)
 . . S TIUX=$G(^TIU(8925,+TIUDA,"TEMP",TIUI,0))
"RTN","TIUEDI1",111,0)
 . . S TIUC=+$$ISCOMP(TIUTYP,$P(TIUX,":"))
"RTN","TIUEDI1",112,0)
 . . I TIUX[":",+TIUC D
"RTN","TIUEDI1",113,0)
 . . . S TIUJ=0 ; Reinitialize line count for new component
"RTN","TIUEDI1",114,0)
 . . . S TIUCMP=$$GETCOMP(TIUC,TIUDA,.TIU,DFN)
"RTN","TIUEDI1",115,0)
 . . S TIUJ=+$G(TIUJ)+1
"RTN","TIUEDI1",116,0)
 . . I +TIUCMP>0 D
"RTN","TIUEDI1",117,0)
 . . . S ^TIU(8925,+TIUCMP,"TEXT",TIUJ,0)=$G(^TIU(8925,+TIUDA,"TEMP",+TIUI,0))
"RTN","TIUEDI1",118,0)
 . . . S ^TIU(8925,+TIUCMP,"TEXT",0)="^^"_TIUJ_"^"_TIUJ_"^"_DT_"^^"
"RTN","TIUEDI1",119,0)
 . . E  D
"RTN","TIUEDI1",120,0)
 . . . S ^TIU(8925,+TIUDA,"TEXT",TIUJ,0)=$G(^TIU(8925,+TIUDA,"TEMP",TIUJ,0))
"RTN","TIUEDI1",121,0)
 . . . S ^TIU(8925,+TIUDA,"TEXT",0)="^^"_TIUJ_"^"_TIUJ_"^"_DT_"^^"
"RTN","TIUEDI1",122,0)
 ; -- If no components, merge "TEMP" into "TEXT" for current document
"RTN","TIUEDI1",123,0)
 I +$O(^TIU(8925.1,+TIUTYP,10,0))'>0 M ^TIU(8925,+TIUDA,"TEXT")=^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUEDI1",124,0)
 Q
"RTN","TIUEDI1",125,0)
GETTMPL(TIUTYP) ; Get edit template, enforce inheritance
"RTN","TIUEDI1",126,0)
 N TIUDAD,TIUY S TIUDAD=0
"RTN","TIUEDI1",127,0)
 S TIUY=$G(^TIU(8925.1,+TIUTYP,5))
"RTN","TIUEDI1",128,0)
 I TIUY']"",($P(^TIU(8925.1,+TIUTYP,0),U)["ADDENDUM") D
"RTN","TIUEDI1",129,0)
 . S TIUDAD=+$P($G(^TIU(8925,+$P($G(^TIU(8925,+$G(TIUDA),0)),U,6),0)),U)
"RTN","TIUEDI1",130,0)
 . I +TIUDAD S TIUY=$$GETTMPL(TIUDAD)
"RTN","TIUEDI1",131,0)
 I TIUY']"" S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIUEDI1",132,0)
 I +TIUDAD S TIUY=$$GETTMPL(TIUDAD)
"RTN","TIUEDI1",133,0)
 Q TIUY
"RTN","TIUEDI1",134,0)
AUDIT(TIUDA,TIUCKSM0,TIUCKSM1) ; Update audit trail
"RTN","TIUEDI1",135,0)
 N DIC,DIE,DA,DR,X,Y
"RTN","TIUEDI1",136,0)
 S X=""""_"`"_TIUDA_"""",(DIC,DLAYGO)=8925.5,DIC(0)="FLX" D ^DIC Q:+Y'>0
"RTN","TIUEDI1",137,0)
 S DIE=DIC,DR=".02////"_$$NOW^TIULC_";.03////"_DUZ_";.04////"_TIUCKSM0_";.05////"_TIUCKSM1
"RTN","TIUEDI1",138,0)
 S DA=+Y D ^DIE
"RTN","TIUEDI1",139,0)
 Q
"RTN","TIUEDI1",140,0)
GETLMETH(TIUTYP) ; Get Visit Linkage method, enforce inheritance
"RTN","TIUEDI1",141,0)
 N TIUDAD,TIUY S TIUDAD=0
"RTN","TIUEDI1",142,0)
 S TIUY=$G(^TIU(8925.1,+TIUTYP,7))
"RTN","TIUEDI1",143,0)
 I TIUY']"" S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIUEDI1",144,0)
 I +TIUDAD S TIUY=$$GETLMETH(TIUDAD)
"RTN","TIUEDI1",145,0)
 Q TIUY
"RTN","TIUEDI1",146,0)
GETVMETH(TIUTYP) ; Get Validation method, enforce enheritance
"RTN","TIUEDI1",147,0)
 N TIUDAD,TIUY S TIUDAD=0
"RTN","TIUEDI1",148,0)
 S TIUY=$G(^TIU(8925.1,+TIUTYP,8))
"RTN","TIUEDI1",149,0)
 I TIUY']"" S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIUEDI1",150,0)
 I +TIUDAD S TIUY=$$GETVMETH(TIUDAD)
"RTN","TIUEDI1",151,0)
 Q TIUY
"RTN","TIUEDI1",152,0)
 ;
"RTN","TIUEDI3")
0^30^B36953715
"RTN","TIUEDI3",1,0)
TIUEDI3 ; SLC/MAM - Additional Edit Code ;3/16/01
"RTN","TIUEDI3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUEDI3",3,0)
 ;
"RTN","TIUEDI3",4,0)
GETRECNW(DFN,TIU,TIUTYP1,TIUNEW,TIUDPRM,TIUINQ,PERSON,EDIT) ; New GETREC.
"RTN","TIUEDI3",5,0)
 ;  Code rewritten from the old GETREC^TIUEDI1.
"RTN","TIUEDI3",6,0)
 ;  GETREC^TIUEDI1 now calls this code.
"RTN","TIUEDI3",7,0)
 ;  New parameters: Left out TIUCREAT since we always used it as 1.
"RTN","TIUEDI3",8,0)
 ;                  Added PERSON and EDIT. 
"RTN","TIUEDI3",9,0)
 ;  Can be called directly, or via GETREC^TIUEDI1 for
"RTN","TIUEDI3",10,0)
 ;backward compatibility. GETREC^TIUEDI1 uses OLD parameters.
"RTN","TIUEDI3",11,0)
 ;  There are 3 functional differences between GETRECNW and the old 
"RTN","TIUEDI3",12,0)
 ;GETREC: First, GETRECNW no longer does RETRY since there should no 
"RTN","TIUEDI3",13,0)
 ;longer be editable entries with no time in the visit field.
"RTN","TIUEDI3",14,0)
 ;Second, if user when creating new docmt is asked if user wants
"RTN","TIUEDI3",15,0)
 ;to edit existing docmt instead, and user says no, and user
"RTN","TIUEDI3",16,0)
 ;cannot create a new docmt, then user is no longer given the
"RTN","TIUEDI3",17,0)
 ;existing record to addend.  User must use a separate addend action.
"RTN","TIUEDI3",18,0)
 ;Third, because code is restructured, code no longer quits before
"RTN","TIUEDI3",19,0)
 ;creating a new docmt if GETRECNW is called with DUOUT, etc defined.
"RTN","TIUEDI3",20,0)
 ;So quit before calling GETRECNW if DUOUT, etc.
"RTN","TIUEDI3",21,0)
 ; Returns document record DA, where DA is:
"RTN","TIUEDI3",22,0)
 ;   new docmt for user to continue entering, or
"RTN","TIUEDI3",23,0)
 ;   existing docmt for user to edit or addend.
"RTN","TIUEDI3",24,0)
 ; If called by upload, DA is:
"RTN","TIUEDI3",25,0)
 ;   new docmt to continue entering, or
"RTN","TIUEDI3",26,0)
 ;   existing docmt for text replacement or addendum.
"RTN","TIUEDI3",27,0)
 ;
"RTN","TIUEDI3",28,0)
 ; Call with:
"RTN","TIUEDI3",29,0)
 ; DFN, TIU array, TIUTYP1 are REQUIRED.
"RTN","TIUEDI3",30,0)
 ;    [DFN] --> Patient IFN.
"RTN","TIUEDI3",31,0)
 ;    [TIU] --> Visit info array
"RTN","TIUEDI3",32,0)
 ;              References TIU("VSTR") = LOC;VDT;VTYP
"RTN","TIUEDI3",33,0)
 ;                         TIU("VISIT") = Visit File IFN
"RTN","TIUEDI3",34,0)
 ;                         TIU("LOC")
"RTN","TIUEDI3",35,0)
 ;                         TIU("VLOC")
"RTN","TIUEDI3",36,0)
 ;                         TIU("STOP") = mark to defer workload
"RTN","TIUEDI3",37,0)
 ; [TIUTYP1] --> Title info variable of form:
"RTN","TIUEDI3",38,0)
 ;              TIUTYP1 = 1^title DA^title Name, where the 1
"RTN","TIUEDI3",39,0)
 ;              is just style to imitate XQORNOD
"RTN","TIUEDI3",40,0)
 ; [TIUNEW] --> flag, passed back with
"RTN","TIUEDI3",41,0)
 ;              TIUNEW = 1 if returned docmt is new
"RTN","TIUEDI3",42,0)
 ;              TIUNEW = 0 if returned docmt already existed,
"RTN","TIUEDI3",43,0)
 ;              timeout, etc
"RTN","TIUEDI3",44,0)
 ;
"RTN","TIUEDI3",45,0)
 ;[TIUDPRM] --> Docmt param array where
"RTN","TIUEDI3",46,0)
 ;              $P($G(TIUDPRM(0)),U,10), = 1 if
"RTN","TIUEDI3",47,0)
 ;              more than ONE record/visit is allowed.
"RTN","TIUEDI3",48,0)
 ;              If TIUDPRM not received, don't worry about
"RTN","TIUEDI3",49,0)
 ;              creating multiple documents
"RTN","TIUEDI3",50,0)
 ; [TIUINQ] --> Ask user flag, where
"RTN","TIUEDI3",51,0)
 ;              TIUINQ = 1: ask re edit/addend existing docmt
"RTN","TIUEDI3",52,0)
 ;              (Interactive List Manager options, TRY docmt def)
"RTN","TIUEDI3",53,0)
 ;              TIUINQ = 0: don't ask (Upload & GUI options)
"RTN","TIUEDI3",54,0)
 ; [PERSON] --> IFN of person asking to edit/create docmt,
"RTN","TIUEDI3",55,0)
 ;              or for upload, = author of document
"RTN","TIUEDI3",56,0)
 ;              If not received, assumed to be DUZ.
"RTN","TIUEDI3",57,0)
 ;   [EDIT] --> flag, passed back with EDIT = 1 if returned
"RTN","TIUEDI3",58,0)
 ;              PREEXISTING docmt can be edited by PERSON. If
"RTN","TIUEDI3",59,0)
 ;              preexisting docmt returned and 'EDIT, then
"RTN","TIUEDI3",60,0)
 ;              docmt cannot be edited by person.
"RTN","TIUEDI3",61,0)
 N TIUVSTR,MULTOK,DA,TLFULL,XISONE
"RTN","TIUEDI3",62,0)
 N EDABLEDA,YESDOIT ;10/3/00
"RTN","TIUEDI3",63,0)
 N TIUTYPDA,TIUTYPNM
"RTN","TIUEDI3",64,0)
 I '$G(PERSON) S PERSON=DUZ
"RTN","TIUEDI3",65,0)
 S TIUVSTR=TIU("VSTR")
"RTN","TIUEDI3",66,0)
 ; -- If just testing a document definition (TRY) rather than
"RTN","TIUEDI3",67,0)
 ;    doing a real note, skip inquiry into existing notes: --
"RTN","TIUEDI3",68,0)
 I +$G(NOSAVE) S DA=$$CREATREC(DFN,.TIU,TIUTYP1),TIUNEW=1 G GETNWX
"RTN","TIUEDI3",69,0)
 ; --  MULTOK: More than ONE record/visit is OK (param permits,
"RTN","TIUEDI3",70,0)
 ;             or didn't care enough to send the parameter)
"RTN","TIUEDI3",71,0)
 ;     TLFULL: Only 1 docmt allowed, and it
"RTN","TIUEDI3",72,0)
 ;                already exists on this title/pt/vst --
"RTN","TIUEDI3",73,0)
 I '$D(TIUDPRM(0)) S MULTOK=1
"RTN","TIUEDI3",74,0)
 E  S MULTOK=+$P(TIUDPRM(0),U,10)
"RTN","TIUEDI3",75,0)
 S (TIUNEW,EDIT,DA,TLFULL,EDABLEDA)=0
"RTN","TIUEDI3",76,0)
 S TIUTYPDA=$P(TIUTYP1,U,2),TIUTYPNM=$P(TIUTYP1,U,3)
"RTN","TIUEDI3",77,0)
 S XISONE=$$EXIST(DFN,TIUTYPDA,TIUVSTR)
"RTN","TIUEDI3",78,0)
 I 'MULTOK,XISONE S TLFULL=1
"RTN","TIUEDI3",79,0)
 ; -- Find existing editable docmts for patient, title, & visit:--
"RTN","TIUEDI3",80,0)
 S EDABLEDA=+$$EXIST(DFN,TIUTYPDA,TIUVSTR,1,PERSON)
"RTN","TIUEDI3",81,0)
 ; -- If there are NO such docmts,
"RTN","TIUEDI3",82,0)
 ;    then create new if title not full,
"RTN","TIUEDI3",83,0)
 ;    or return existing [NONeditable] for addendum [if user wants]: --
"RTN","TIUEDI3",84,0)
 I 'EDABLEDA D  G GETNWX
"RTN","TIUEDI3",85,0)
 . I 'TLFULL S DA=$$CREATREC(DFN,.TIU,TIUTYP1),TIUNEW=1 Q
"RTN","TIUEDI3",86,0)
 . I +$G(TIUINQ) D  Q
"RTN","TIUEDI3",87,0)
 . . W !!,"There is already a ",TIUTYPNM,".",!
"RTN","TIUEDI3",88,0)
 . . W "Only ONE record of this type per Visit is allowed...",!
"RTN","TIUEDI3",89,0)
 . . S YESDOIT=+$$READ^TIUU("Y"," Would you like to addend the existing record","NO")
"RTN","TIUEDI3",90,0)
 . . I YESDOIT S DA=XISONE
"RTN","TIUEDI3",91,0)
 . I '+$G(TIUINQ) S DA=XISONE
"RTN","TIUEDI3",92,0)
 . Q
"RTN","TIUEDI3",93,0)
 ; -- If there ARE such docmts, then
"RTN","TIUEDI3",94,0)
 ;      If title is full, return existing docmt for edit.
"RTN","TIUEDI3",95,0)
 ;      If title is NOT full, return existing docmt for edit,
"RTN","TIUEDI3",96,0)
 ;        or ask user.
"RTN","TIUEDI3",97,0)
 I EDABLEDA D  G GETNWX
"RTN","TIUEDI3",98,0)
 . I TLFULL D:+$G(TIUINQ)  S DA=EDABLEDA,EDIT=1 Q
"RTN","TIUEDI3",99,0)
 . . W !!,"There is already a ",TIUTYPNM," which you may edit."
"RTN","TIUEDI3",100,0)
 . . W !,"Only ONE record of this type per Visit is allowed...",!
"RTN","TIUEDI3",101,0)
 . . W "Opening the existing record"
"RTN","TIUEDI3",102,0)
 . . S TIUCHNG("EXIST")=1
"RTN","TIUEDI3",103,0)
 . I 'TLFULL D  Q
"RTN","TIUEDI3",104,0)
 . . I '+$G(TIUINQ) S DA=EDABLEDA,EDIT=1 Q
"RTN","TIUEDI3",105,0)
 . . W !!,"There is already a ",TIUTYPNM," which you may edit."
"RTN","TIUEDI3",106,0)
 . . S YESDOIT=+$$INQUIRE ; "Create new anyway?"
"RTN","TIUEDI3",107,0)
 . . I $D(DUOUT)!$D(DTOUT)!$D(DIROUT) Q
"RTN","TIUEDI3",108,0)
 . . I YESDOIT S DA=$$CREATREC(DFN,.TIU,TIUTYP1),TIUNEW=1 Q
"RTN","TIUEDI3",109,0)
 . . W !!,"Okay, I'll open the existing record then!"
"RTN","TIUEDI3",110,0)
 . . S DA=EDABLEDA,EDIT=1,TIUCHNG("EXIST")=1
"RTN","TIUEDI3",111,0)
GETNWX ;
"RTN","TIUEDI3",112,0)
 I TIUNEW,'DA S TIUNEW=0
"RTN","TIUEDI3",113,0)
 Q +$G(DA)
"RTN","TIUEDI3",114,0)
 ;
"RTN","TIUEDI3",115,0)
EXIST(DFN,TIUTYPDA,TIUVSTR,REQEDIT,PERSON) ; If a docmt already
"RTN","TIUEDI3",116,0)
 ;EXISTS for the given patient, title, and visit, then return it.
"RTN","TIUEDI3",117,0)
 ; Ignore: - docmts of status deleted or retracted
"RTN","TIUEDI3",118,0)
 ;         - all docmts if run across a docmt w/ requesting pkg
"RTN","TIUEDI3",119,0)
 ;         - I REQEDIT, then also ignore docmts PERSON cannot edit.
"RTN","TIUEDI3",120,0)
 ; If there are more than one, get the smallest DA.
"RTN","TIUEDI3",121,0)
 ; Receives TIUVSTR = LOC;VDT;VTYP
"RTN","TIUEDI3",122,0)
 ; Needs TIUTYPDA = title DA
"RTN","TIUEDI3",123,0)
 ; REQEDIT & PERSON are optional
"RTN","TIUEDI3",124,0)
 N REQUEST,DA,TIUI,STATUS,RETRY
"RTN","TIUEDI3",125,0)
 S REQEDIT=+$G(REQEDIT)
"RTN","TIUEDI3",126,0)
 I '$G(PERSON) S PERSON=DUZ
"RTN","TIUEDI3",127,0)
 S (REQUEST,TIUI,DA)=0
"RTN","TIUEDI3",128,0)
LOOP ; -- Find existing docmt for given patient, title, & visit:--
"RTN","TIUEDI3",129,0)
 F  S TIUI=+$O(^TIU(8925,"APTLD",DFN,TIUTYPDA,TIUVSTR,TIUI)) Q:'TIUI  D  Q:REQUEST  Q:DA
"RTN","TIUEDI3",130,0)
 . ; -- If TIUI doesn't exist, reject it and keep looking: --
"RTN","TIUEDI3",131,0)
 . I '$D(^TIU(8925,TIUI,0)) D  Q
"RTN","TIUEDI3",132,0)
 . . K ^TIU(8925,"APTLD",DFN,TIUTYPDA,TIUVSTR,TIUI)
"RTN","TIUEDI3",133,0)
 . ; -- If TIUI has requesting package (e.g. Consults),
"RTN","TIUEDI3",134,0)
 . ;    then reject it and quit looking: --
"RTN","TIUEDI3",135,0)
 . I +$P($G(^TIU(8925,TIUI,14)),U,5) S REQUEST=1 Q  ; **22**
"RTN","TIUEDI3",136,0)
 . ; -- If TIUI has status deleted or retracted, reject it
"RTN","TIUEDI3",137,0)
 . ;    and keep looking: TIU*1*61 --
"RTN","TIUEDI3",138,0)
 . S STATUS=+$P($G(^TIU(8925,TIUI,0)),U,5)
"RTN","TIUEDI3",139,0)
 . I STATUS=14!(STATUS=15) Q
"RTN","TIUEDI3",140,0)
 . ; -- If OK so far, and record not required to be editable,
"RTN","TIUEDI3",141,0)
 . ;then grab existing record and stop looking: --
"RTN","TIUEDI3",142,0)
 . I 'REQEDIT S DA=TIUI Q
"RTN","TIUEDI3",143,0)
 . ; -- If REQEDIT & PERSON can edit existing record,
"RTN","TIUEDI3",144,0)
 . ;    then grab it and stop looking: --
"RTN","TIUEDI3",145,0)
 . N CANEDIT S CANEDIT=+$$CANDO^TIULP(TIUI,"EDIT RECORD",PERSON)
"RTN","TIUEDI3",146,0)
 . I +CANEDIT>0 S DA=TIUI
"RTN","TIUEDI3",147,0)
 ; -- If record not required to be editable & still haven't
"RTN","TIUEDI3",148,0)
 ;    found a record, check for records with no visit time: --
"RTN","TIUEDI3",149,0)
 ;    (Early anomaly with DSs at Boston)
"RTN","TIUEDI3",150,0)
 I +DA'>0,($P(TIUVSTR,";",3)="H"),(+$G(RETRY)'>0) D  G LOOP
"RTN","TIUEDI3",151,0)
 . S RETRY=1,$P(TIUVSTR,";",2)=$P($P(TIUVSTR,";",2),".")
"RTN","TIUEDI3",152,0)
EXISTEX ;
"RTN","TIUEDI3",153,0)
 Q +$G(DA)
"RTN","TIUEDI3",154,0)
 ;
"RTN","TIUEDI3",155,0)
CREATREC(DFN,TIU,TIUTYP1) ; Create document record - Returns DA
"RTN","TIUEDI3",156,0)
 ; Receives array TIU as in GETRECNW
"RTN","TIUEDI3",157,0)
 ; Needs var TIUTYP1 as in GETRECNW
"RTN","TIUEDI3",158,0)
 N DIC,DLAYGO,X,Y,TIUFPRIV,TIUVTYP,RETRY,TIUVSTR,TIUVISIT,DA
"RTN","TIUEDI3",159,0)
 N TIUTYPDA,TIUTYPNM
"RTN","TIUEDI3",160,0)
 S TIUTYPDA=$P(TIUTYP1,U,2),TIUTYPNM=$P(TIUTYP1,U,3)
"RTN","TIUEDI3",161,0)
 S TIUVSTR=TIU("VSTR")
"RTN","TIUEDI3",162,0)
 S DA=0,TIUFPRIV=1
"RTN","TIUEDI3",163,0)
 S (DIC,DLAYGO)=8925,DIC(0)="FL"
"RTN","TIUEDI3",164,0)
 S X=""""_"`"_TIUTYPDA_"""" D ^DIC
"RTN","TIUEDI3",165,0)
 I +Y'>0 W !,TIUTYPNM," record could not be created.",! G CREXIT
"RTN","TIUEDI3",166,0)
 ; -- Stuff patient, visit, parent doc type, status,
"RTN","TIUEDI3",167,0)
 ;    visit type, hosp loc, visit loc: --
"RTN","TIUEDI3",168,0)
 S DA=+Y
"RTN","TIUEDI3",169,0)
 N DIE,DR S DIE=8925
"RTN","TIUEDI3",170,0)
 S TIUVTYP=$P($G(TIUVSTR),";",3)
"RTN","TIUEDI3",171,0)
 S TIUVISIT=$S(+$G(TIU("VISIT")):+$G(TIU("VISIT")),1:"")
"RTN","TIUEDI3",172,0)
 S DR=".02////"_DFN_";.03////"_TIUVISIT_";.04////"_$$DOCCLASS^TIULC1(+$P(Y,U,2))_";.05///"_$$UP^XLFSTR($$STATUS^TIULC(DA))_";.13////"_TIUVTYP_";1205////"_$P($G(TIU("LOC")),U)_";1211////"_$P($G(TIU("VLOC")),U)
"RTN","TIUEDI3",173,0)
 D ^DIE
"RTN","TIUEDI3",174,0)
 ; -- [Mark record for deferred crediting of stop code (fld #.11)]: --
"RTN","TIUEDI3",175,0)
 I +$G(TIU("STOP")) D DEFER^TIUVSIT(DA,+$G(TIU("STOP")))
"RTN","TIUEDI3",176,0)
CREXIT Q +$G(DA)
"RTN","TIUEDI3",177,0)
 ;
"RTN","TIUEDI3",178,0)
INQUIRE() ; Ask user whether to create a new note anyway
"RTN","TIUEDI3",179,0)
 N TIUY,TIUPRMT
"RTN","TIUEDI3",180,0)
 S TIUY=0,TIUPRMT="Do you want to create a new record anyway"
"RTN","TIUEDI3",181,0)
 S TIUY=+$$READ^TIUU("Y",TIUPRMT,"NO")
"RTN","TIUEDI3",182,0)
 Q TIUY
"RTN","TIUEDI3",183,0)
 ;
"RTN","TIUEDI4")
0^31^B48766687
"RTN","TIUEDI4",1,0)
TIUEDI4 ; SLC/JER - Enter/Edit a Document ; 7-FEB-2001 08:01:51
"RTN","TIUEDI4",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUEDI4",3,0)
 ;new rtn in TSC, created feb 2 from TIUEDIT
"RTN","TIUEDI4",4,0)
 ; 2/2: Moved LOADDFLT, BOIL, CANXEC, REPLACE, INSMULT to TIUEDI4
"RTN","TIUEDI4",5,0)
 ; 2/3 moved DIE, TEXTEDIT from TIUEDIT to TIUEDI4
"RTN","TIUEDI4",6,0)
 ; 3/2 moved SETTL, GETVST, ASKOK from TIUEDIT to TIUEDI4
"RTN","TIUEDI4",7,0)
 ;
"RTN","TIUEDI4",8,0)
SETTL(TIUTYP,TIUCLASS,TIUTITLE) ; Set array TIUTYP w/ title info
"RTN","TIUEDI4",9,0)
 ;  e.g. TIUTYP(1) = 1^113^CRISIS, where 113 is IFN of CRISIS title,
"RTN","TIUEDI4",10,0)
 ;          TIUTYP = 1 if gotten from TIUTITLE
"RTN","TIUEDI4",11,0)
 ;          TIUTYP = 113 if gotten from user
"RTN","TIUEDI4",12,0)
 ; Requires TIUCLASS
"RTN","TIUEDI4",13,0)
 ; Receives TIUTITLE - optional = Title DA or Title Name or DA^Name
"RTN","TIUEDI4",14,0)
 N TIUDFLT
"RTN","TIUEDI4",15,0)
 ; -- Get title from TIUTITLE if it's there: --
"RTN","TIUEDI4",16,0)
 I $G(TIUTITLE)]"",$S(+$G(NOSAVE):1,+$P(TIUTITLE,U,2):1,1:0) D  I 1
"RTN","TIUEDI4",17,0)
 . S TIUTYP=1,TIUTITLE=$P(TIUTITLE,U)
"RTN","TIUEDI4",18,0)
 . S TIUTYP(1)=1_U_$S(+$G(TIUTITLE)>0:+$G(TIUTITLE),1:+$O(^TIU(8925.1,"B",TIUTITLE,0)))
"RTN","TIUEDI4",19,0)
 . S $P(TIUTYP(1),U,3)=$$PNAME^TIULC1(+$P(TIUTYP(1),U,2))
"RTN","TIUEDI4",20,0)
 ; -- If not, ask user: --
"RTN","TIUEDI4",21,0)
 E  D
"RTN","TIUEDI4",22,0)
 . S TIUDFLT="LAST" ; use user's preferred list of docmts
"RTN","TIUEDI4",23,0)
 . D DOCSPICK^TIULA2(.TIUTYP,TIUCLASS,"1A",TIUDFLT,"","+$$CANPICK^TIULP(+Y),+$$CANENTR^TIULP(+Y)")
"RTN","TIUEDI4",24,0)
 I +$G(TIUTYP)'>0 S TIUOUT=1 Q
"RTN","TIUEDI4",25,0)
 S TIUTYP=+$P($G(TIUTYP(1)),U,2)
"RTN","TIUEDI4",26,0)
 Q
"RTN","TIUEDI4",27,0)
 ;
"RTN","TIUEDI4",28,0)
GETVST(DFN,TIUTYP,TIU,EVNTFLAG) ; Get visit, set array TIU
"RTN","TIUEDI4",29,0)
 ; -- If no eventflag & don't suppress visit, then execute
"RTN","TIUEDI4",30,0)
 ;    visit linkage method: --
"RTN","TIUEDI4",31,0)
 ; Requires DFN
"RTN","TIUEDI4",32,0)
 ; Requires simple variable TIUTYP = title DA
"RTN","TIUEDI4",33,0)
 ; Optional EVNTFLAG
"RTN","TIUEDI4",34,0)
 ; Returns array TIU
"RTN","TIUEDI4",35,0)
 N TIUVSUPP,TIULMETH
"RTN","TIUEDI4",36,0)
 S TIUVSUPP=0
"RTN","TIUEDI4",37,0)
 I '$G(EVNTFLAG) S TIUVSUPP=+$$SUPPVSIT^TIULC1(TIUTYP)
"RTN","TIUEDI4",38,0)
 ; -- execute visit linkage method for TIUTYP --
"RTN","TIUEDI4",39,0)
 I 'TIUVSUPP,'$G(EVNTFLAG) D  I 1
"RTN","TIUEDI4",40,0)
 . S TIULMETH=$$GETLMETH^TIUEDI1(TIUTYP)
"RTN","TIUEDI4",41,0)
 . I '$L(TIULMETH) D  S TIUOUT=1 Q
"RTN","TIUEDI4",42,0)
 . . W !,$C(7),"No Visit Linkage Method defined for "
"RTN","TIUEDI4",43,0)
 . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUEDI4",44,0)
 . ; -- TIULMETH for PN: D ENPN^TIUVSIT(.TIU,.DFN,1) --
"RTN","TIUEDI4",45,0)
 . X TIULMETH
"RTN","TIUEDI4",46,0)
 ; -- else create new historical "E" visit: --
"RTN","TIUEDI4",47,0)
 E  D EVENT^TIUSRVP1(.TIU,DFN)
"RTN","TIUEDI4",48,0)
 I $S($D(DIROUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 Q
"RTN","TIUEDI4",49,0)
 I '$D(TIU("VSTR")) D
"RTN","TIUEDI4",50,0)
 . W !,$C(7),"Patient & Visit required." H 2
"RTN","TIUEDI4",51,0)
 Q
"RTN","TIUEDI4",52,0)
 ;
"RTN","TIUEDI4",53,0)
ASKOK(TIUTYP,TIU,TIUBY,TIUASK) ; X Validation method.
"RTN","TIUEDI4",54,0)
 ; Receives and returns array TIU, simple var TIUTYP, [array TIUBY]
"RTN","TIUEDI4",55,0)
 ; Sets TIUASK = answer, = 0 for not OK or 1 for OK
"RTN","TIUEDI4",56,0)
 N TIUVMETH
"RTN","TIUEDI4",57,0)
 S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYP)
"RTN","TIUEDI4",58,0)
 I '$L(TIUVMETH) D  S TIUOUT=1 Q
"RTN","TIUEDI4",59,0)
 . W !,$C(7),"No Validation Method defined for "
"RTN","TIUEDI4",60,0)
 . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUEDI4",61,0)
 ; -- TIUVMETH for PN: S TIUASK=$$CHEKPN^TIULD(.TIU,.TIUBY) --
"RTN","TIUEDI4",62,0)
 X TIUVMETH
"RTN","TIUEDI4",63,0)
 ; -- If finish without a visit, then quit: --
"RTN","TIUEDI4",64,0)
 I '$D(TIU("VSTR")) D
"RTN","TIUEDI4",65,0)
 . W !,$C(7),"Patient & Visit required." H 2
"RTN","TIUEDI4",66,0)
 Q
"RTN","TIUEDI4",67,0)
 ;
"RTN","TIUEDI4",68,0)
DIE(DA,TIUQUIT,TIUCHNG) ; Invoke ^DIE
"RTN","TIUEDI4",69,0)
 N Y,DIE,DR
"RTN","TIUEDI4",70,0)
 I '$D(TIUPREF) S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUEDI4",71,0)
 L +^TIU(8925,+DA):1
"RTN","TIUEDI4",72,0)
 E  D  Q
"RTN","TIUEDI4",73,0)
 . W !!?5,$C(7),"Another user is editing this entry.",! S TIUQUIT=2
"RTN","TIUEDI4",74,0)
 . I $$READ^TIUU("FOA","Press RETURN to continue...") W ""
"RTN","TIUEDI4",75,0)
 S ^TIU(8925,"ASAVE",DUZ,DA)=""
"RTN","TIUEDI4",76,0)
 S DR=$$GETTMPL^TIUEDI1(+$P(^TIU(8925,+DA,0),U))
"RTN","TIUEDI4",77,0)
 I DR']"" W !?5,$C(7),"No Edit template defined for ",$$PNAME^TIULC1(+$P(^TIU(8925,+DA,0),U)),! S TIUQUIT=2 Q
"RTN","TIUEDI4",78,0)
 S DIE=8925 D ^DIE
"RTN","TIUEDI4",79,0)
 I $D(Y) S TIUQUIT=1
"RTN","TIUEDI4",80,0)
 I +$G(TIUQUIT)>0,+$G(TIUNEW)>0 Q
"RTN","TIUEDI4",81,0)
 D:+$G(TIUQUIT) UPDTIRT^TIUDIRT(.TIU,DA),SEND^TIUALRT(DA)
"RTN","TIUEDI4",82,0)
 Q:+$G(TIUQUIT)
"RTN","TIUEDI4",83,0)
 D TEXTEDIT(DA,.TIUCHNG)
"RTN","TIUEDI4",84,0)
 I +$G(^TIU(8925,DA,0))'>0 S TIUQUIT=2 Q
"RTN","TIUEDI4",85,0)
 S DR=".05///"_$$STATUS^TIULC(DA),DIE=8925 D ^DIE
"RTN","TIUEDI4",86,0)
 D UPDTIRT^TIUDIRT(.TIU,DA),SEND^TIUALRT(DA)
"RTN","TIUEDI4",87,0)
 L -^TIU(8925,+DA)
"RTN","TIUEDI4",88,0)
 Q
"RTN","TIUEDI4",89,0)
TEXTEDIT(DA,TIUCMMT,TIUCHNG) ; Call DIWE
"RTN","TIUEDI4",90,0)
 N DIC,DIWE,DIWESUB,DIWPT,DR,DWHD,DWI,DWLC,DWLR,DWLW,DWO,DWPK,DDWRW
"RTN","TIUEDI4",91,0)
 N TIUCKSM0,TIUCKSM1,TIUESNM,TIUESBLK
"RTN","TIUEDI4",92,0)
 S TIUESNM=$$DECRYPT^TIULC1($P($G(^TIU(8925,DA,15)),U,3),1,$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEXT"")"))
"RTN","TIUEDI4",93,0)
 S TIUESBLK=$$DECRYPT^TIULC1($P($G(^TIU(8925,DA,15)),U,4),1,$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEXT"")"))
"RTN","TIUEDI4",94,0)
 W !!,"Calling text editor, please wait..." H 1
"RTN","TIUEDI4",95,0)
 X:$L($G(TIUPRM3)) TIUPRM3
"RTN","TIUEDI4",96,0)
 D BUFFER^TIUEDIU(DA) ; Load edit buffer to protect original from booboos
"RTN","TIUEDI4",97,0)
 S TIUCKSM0=$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEMP"")")
"RTN","TIUEDI4",98,0)
 I $D(^TIU(8925,+DA,"TEXT"))'>9 D LOADDFLT(DA,+$P(TIUTYP(1),U,2))
"RTN","TIUEDI4",99,0)
 S DIWESUB="Patient: "_$G(TIU("PNM")),DIC="^TIU(8925,"_+DA_",""TEMP"","
"RTN","TIUEDI4",100,0)
 I $G(VALMAR)="^TMP(""TIUVIEW"",$J)",(+$G(VALMBG)>5),(+$G(VALMBG)'>(+$P($G(^TIU(8925,+DA,"TEXT",0)),U,3)+4)) S DDWRW=+$G(VALMBG)-4
"RTN","TIUEDI4",101,0)
 S DWPK=1,DWLW=74 D EN^DIWE
"RTN","TIUEDI4",102,0)
 ; DELETE if NOSAVE
"RTN","TIUEDI4",103,0)
 I +$G(NOSAVE) D DELETE^TIUEDIT(DA,0) S TIUQUIT=2 Q
"RTN","TIUEDI4",104,0)
 ; Save edit buffer
"RTN","TIUEDI4",105,0)
 S TIUCKSM1=$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEMP"")")
"RTN","TIUEDI4",106,0)
 I TIUCKSM0'=TIUCKSM1 D  I 1
"RTN","TIUEDI4",107,0)
 . D COMMIT^TIUEDIU(DA),AUDIT^TIUEDI1(DA,TIUCKSM0,TIUCKSM1)
"RTN","TIUEDI4",108,0)
 . S TIUCHNG=1
"RTN","TIUEDI4",109,0)
 . ; re-file /es/-block
"RTN","TIUEDI4",110,0)
 . I $L(TIUESNM) D
"RTN","TIUEDI4",111,0)
 . . S DR="1503///^S X=TIUESNM;1504///^S X=TIUESBLK",DIE=8925
"RTN","TIUEDI4",112,0)
 . . D ^DIE
"RTN","TIUEDI4",113,0)
 E  W !,"No changes made..." D COMMIT^TIUEDIU(DA,1) S TIUCHNG=0
"RTN","TIUEDI4",114,0)
 S DIE=8925,DR=".1///"_$$LINECNT^TIULC(DA) D ^DIE
"RTN","TIUEDI4",115,0)
 Q
"RTN","TIUEDI4",116,0)
 ;
"RTN","TIUEDI4",117,0)
LOADDFLT(DA,TIUTYP) ; Load bp text
"RTN","TIUEDI4",118,0)
 N TIUI,TIUJ,TIUK,TIUL S TIUI=0
"RTN","TIUEDI4",119,0)
 S TIUJ=+$P($G(^TIU(8925,+DA,"TEMP",0)),U,3)+1
"RTN","TIUEDI4",120,0)
 ; - Set comp hdr -
"RTN","TIUEDI4",121,0)
 S ^TIU(8925,+DA,"TEMP",TIUJ,0)=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":$P(^TIU(8925.1,+TIUTYP,0),U)_":   ",1:"")
"RTN","TIUEDI4",122,0)
 I +TIUJ=1,($G(^TIU(8925,+DA,"TEMP",TIUJ,0))']"") K ^TIU(8925,+DA,"TEMP",TIUJ,0) S TIUJ=0
"RTN","TIUEDI4",123,0)
 S ^TIU(8925,+DA,"TEMP",0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIUEDI4",124,0)
 F  S TIUI=$O(^TIU(8925.1,+TIUTYP,"DFLT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUEDI4",125,0)
 . S TIUJ=TIUJ+1,X=$G(^TIU(8925.1,+TIUTYP,"DFLT",TIUI,0))
"RTN","TIUEDI4",126,0)
 . I $L($T(DOLMLINE^TIUSRVF1)),'$D(XWBOS),(X["{FLD:") S X=$$DOLMLINE^TIUSRVF1(X)
"RTN","TIUEDI4",127,0)
 . I X["|" S X=$$BOIL(X,TIUJ)
"RTN","TIUEDI4",128,0)
 . I X["~@" D INSMULT(X,"^TIU(8925,"_+DA_",""TEMP"")",.TIUJ) I 1
"RTN","TIUEDI4",129,0)
 . E  S ^TIU(8925,+DA,"TEMP",TIUJ,0)=X
"RTN","TIUEDI4",130,0)
 . S ^TIU(8925,+DA,"TEMP",0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIUEDI4",131,0)
 I +$O(^TIU(8925.1,+TIUTYP,10,0)) D
"RTN","TIUEDI4",132,0)
 . N TIUFITEM,TIUI
"RTN","TIUEDI4",133,0)
 . D ITEMS^TIUFLT(+TIUTYP)
"RTN","TIUEDI4",134,0)
 . S TIUI=0 F  S TIUI=$O(TIUFITEM(TIUI)) Q:+TIUI'>0  D
"RTN","TIUEDI4",135,0)
 . . S TIUL=+$G(TIUFITEM(+TIUI)) D LOADDFLT(DA,TIUL)
"RTN","TIUEDI4",136,0)
 Q
"RTN","TIUEDI4",137,0)
BOIL(LINE,COUNT) ; execute objects
"RTN","TIUEDI4",138,0)
 N TIUI,DIC,X,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUEDI4",139,0)
 S DIC=8925.1,DIC(0)="FMXZ"
"RTN","TIUEDI4",140,0)
 S DIC("S")="I $P($G(^TIU(8925.1,+Y,0)),U,4)=""O"""
"RTN","TIUEDI4",141,0)
 F TIUI=2:2:$L(LINE,"|") S X=$P(LINE,"|",TIUI) D
"RTN","TIUEDI4",142,0)
 . D ^DIC
"RTN","TIUEDI4",143,0)
 . I +Y'>0 S X="The OBJECT "_X_" was NOT found...Contact IRM."
"RTN","TIUEDI4",144,0)
 . I +Y>0 D
"RTN","TIUEDI4",145,0)
 . . I $D(^TIU(8925.1,+Y,9)),+$$CANXEC(+Y) X ^(9) S:$E(X,1,2)="~@" X=X_"~@" I 1
"RTN","TIUEDI4",146,0)
 . . E  S X="The OBJECT "_X_" is INACTIVE...Contact IRM."
"RTN","TIUEDI4",147,0)
 . S LINE=$$REPLACE(LINE,X,TIUI)
"RTN","TIUEDI4",148,0)
 Q $TR(LINE,"|","")
"RTN","TIUEDI4",149,0)
CANXEC(TIUODA) ; Eval Obj Status
"RTN","TIUEDI4",150,0)
 N TIUOST,TIUY S TIUOST=+$P($G(^TIU(8925.1,+TIUODA,0)),U,7)
"RTN","TIUEDI4",151,0)
 S TIUY=$S(TIUOST=11:1,+$G(NOSAVE):1,1:0)
"RTN","TIUEDI4",152,0)
 Q +$G(TIUY)
"RTN","TIUEDI4",153,0)
REPLACE(LINE,X,TIUI) ; Replace TIUIth object in LINE
"RTN","TIUEDI4",154,0)
 S $P(LINE,"|",TIUI)=X
"RTN","TIUEDI4",155,0)
 Q LINE
"RTN","TIUEDI4",156,0)
INSMULT(LINE,TARGET,TIULCNT) ; Mult-valued results
"RTN","TIUEDI4",157,0)
 N TIUPC
"RTN","TIUEDI4",158,0)
 F TIUPC=2:2:$L(LINE,"~@") D
"RTN","TIUEDI4",159,0)
 . N TIUI,TIULINE,TIUX,TIUSRC,TIUSCNT,TIUTAIL
"RTN","TIUEDI4",160,0)
 . S TIUSRC=$P(LINE,"~@",TIUPC)
"RTN","TIUEDI4",161,0)
 . S TIUTAIL=$P(LINE,"~@",TIUPC+1)
"RTN","TIUEDI4",162,0)
 . S TIULINE=$P(LINE,"~@",(TIUPC-1)),(TIUI,TIUSCNT)=0
"RTN","TIUEDI4",163,0)
 . I $E(TIULINE)=" ",(TIUPC>2) S $E(TIULINE)=""
"RTN","TIUEDI4",164,0)
 . F  S TIUI=$O(@TIUSRC@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUEDI4",165,0)
 . . N TIUSLINE
"RTN","TIUEDI4",166,0)
 . . S TIUSCNT=TIUSCNT+1
"RTN","TIUEDI4",167,0)
 . . S TIUSLINE=$G(@TIUSRC@(TIUI,0))
"RTN","TIUEDI4",168,0)
 . . S:'+$O(@TIUSRC@(TIUI))&(TIUPC+2>$L(LINE,"~@")) TIUSLINE=TIUSLINE_TIUTAIL
"RTN","TIUEDI4",169,0)
 . . I TIUSCNT=1,($L(TIULINE_TIUSLINE)>73) D  Q
"RTN","TIUEDI4",170,0)
 . . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUEDI4",171,0)
 . . . S @TARGET@(TIULCNT,0)=TIULINE
"RTN","TIUEDI4",172,0)
 . . . S TIULCNT=TIULCNT+1
"RTN","TIUEDI4",173,0)
 . . . S @TARGET@(TIULCNT,0)=TIUSLINE
"RTN","TIUEDI4",174,0)
 . . I TIUSCNT=1,($L(TIULINE_TIUSLINE)'>73) D  Q
"RTN","TIUEDI4",175,0)
 . . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUEDI4",176,0)
 . . . S @TARGET@(TIULCNT,0)=TIULINE_TIUSLINE
"RTN","TIUEDI4",177,0)
 . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUEDI4",178,0)
 . . S @TARGET@(TIULCNT,0)=$G(TIUSLINE)
"RTN","TIUEDI4",179,0)
 . K @TIUSRC
"RTN","TIUEDI4",180,0)
 Q
"RTN","TIUEDIH")
1^12
"RTN","TIUEDIM")
0^33^B16170400
"RTN","TIUEDIM",1,0)
TIUEDIM ; SLC/JER - Enter/Edit Multiple Document ; 3/7/01
"RTN","TIUEDIM",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,41,52,100**;Jun 20, 1997
"RTN","TIUEDIM",3,0)
 ; 2/2: Update DIE from TIUEDIT to TIUEDI4
"RTN","TIUEDIM",4,0)
MAIN(TIUCLASS,TIUOUT,TIUNDA,TIUCHNG) ; Control Branching
"RTN","TIUEDIM",5,0)
 N TIUREL,TIUCHK,TIUDA,TIUEDIT,TIUY,TIUNEW,TIUTYP,TIUPAT
"RTN","TIUEDIM",6,0)
 N TIUI,DTOUT S TIUDFLT=""
"RTN","TIUEDIM",7,0)
 K DIROUT
"RTN","TIUEDIM",8,0)
 ; --- Get one or more patients ---
"RTN","TIUEDIM",9,0)
 I '$L($T(PATIENT^ORU1)) Q
"RTN","TIUEDIM",10,0)
 D PATIENT^ORU1(.TIUPAT) I +TIUPAT'>0 S TIUOUT=1 Q
"RTN","TIUEDIM",11,0)
 S TIUI=0 F  S TIUI=+$O(TIUPAT(TIUI)) Q:+TIUI'>0!+$G(TIUOUT)  D
"RTN","TIUEDIM",12,0)
 . N DFN,DUOUT,TIUDPRM,TIU,TIULMETH,TIUVMETH,VAIN,VADM,TIUDA,TIUEDIT
"RTN","TIUEDIM",13,0)
 . N TIUENTRY,TIUCMMTX,TIUVSUPP,CANEDIT
"RTN","TIUEDIM",14,0)
 . S TIUVSUPP=0
"RTN","TIUEDIM",15,0)
 . S DFN=+$G(TIUPAT(TIUI)) Q:+DFN'>0
"RTN","TIUEDIM",16,0)
 . W !!,"For Patient ",$P(TIUPAT(TIUI),U,2)
"RTN","TIUEDIM",17,0)
 . S TIUCLASS=$G(TIUCLASS,38)
"RTN","TIUEDIM",18,0)
 . I TIUCLASS=3,$S(+$$ISA^USRLM(DUZ,"TRANSCRIPTIONIST"):0,1:1),(+$G(NOSAVE)'>0) D EXSTNOTE^TIUEDI2(DFN) D:$G(VALMAR)="^TMP(""OR"",$J,""CURRENT"")" FULL^VALM1
"RTN","TIUEDIM",19,0)
 . I +$G(DIROUT)!+$G(DUOUT)!+$G(DTOUT) S TIUOUT=1 Q
"RTN","TIUEDIM",20,0)
 . ; -- Set title array TIUTYP (use TIUTITLE or ask user) --
"RTN","TIUEDIM",21,0)
 . D SETTL^TIUEDI4(.TIUTYP,TIUCLASS,$G(TIUTITLE)) I +$G(TIUTYP)'>0 S TIUOUT=1 Q
"RTN","TIUEDIM",22,0)
 . ; -- Get doc parameters for title, X entry action --
"RTN","TIUEDIM",23,0)
 . D DOCPRM^TIULC1(TIUTYP,.TIUDPRM)
"RTN","TIUEDIM",24,0)
 . S TIUENTRY=$$GETENTRY^TIUEDI2(+TIUTYP)
"RTN","TIUEDIM",25,0)
 . I $L(TIUENTRY) X TIUENTRY
"RTN","TIUEDIM",26,0)
 . Q:+$G(TIUOUT)  ; If ENTRY ACTION sets TIUOUT=1 Abort Entry
"RTN","TIUEDIM",27,0)
 . ; -- Set visit array TIU --
"RTN","TIUEDIM",28,0)
 . ; NOTE: EVNTFLAG is set in TIUEDIT, prior to calling this routine
"RTN","TIUEDIM",29,0)
 . D GETVST^TIUEDI4(DFN,TIUTYP,.TIU,EVNTFLAG)
"RTN","TIUEDIM",30,0)
 . I $S($G(TIUQUIT):1,'$D(TIU("VSTR")):1,1:0) Q
"RTN","TIUEDIM",31,0)
 . ; -- Ask OK --
"RTN","TIUEDIM",32,0)
 . S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYP)
"RTN","TIUEDIM",33,0)
 . I '$L(TIUVMETH) D  S TIUOUT=1 Q
"RTN","TIUEDIM",34,0)
 . . W !,$C(7),"No Validation Method defined for "
"RTN","TIUEDIM",35,0)
 . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUEDIM",36,0)
 . X TIUVMETH
"RTN","TIUEDIM",37,0)
 . I $S($D(DIROUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 Q
"RTN","TIUEDIM",38,0)
 . I $D(DUOUT) Q
"RTN","TIUEDIM",39,0)
 . ; -- If user OK'd basic info, go on to get text, etc.: --
"RTN","TIUEDIM",40,0)
 . I $D(TIU),+$G(TIUASK) D
"RTN","TIUEDIM",41,0)
 . . ; -- Get record DA --
"RTN","TIUEDIM",42,0)
 . . ; DA is either: new stub record, ready for edit, or
"RTN","TIUEDIM",43,0)
 . . ;               existing record, for edit, or
"RTN","TIUEDIM",44,0)
 . . ;               existing record, for addendum      
"RTN","TIUEDIM",45,0)
 . . N DA
"RTN","TIUEDIM",46,0)
 . . S DA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM,1,DUZ,.CANEDIT)
"RTN","TIUEDIM",47,0)
 . . I +DA'>0 W !,"Unable to enter/edit." Q
"RTN","TIUEDIM",48,0)
 . . ; -- [Addend DA and Quit] --
"RTN","TIUEDIM",49,0)
 . . ;  If record not new & user can't edit it, user said
"RTN","TIUEDIM",50,0)
 . . ;  in GETRECNW they wanted to addend, so let user write
"RTN","TIUEDIM",51,0)
 . . ;  addendum and quit:
"RTN","TIUEDIM",52,0)
 . . I 'TIUNEW,'CANEDIT D ADDENDUM^TIUADD(DA,"",.TIUCHNG,1) Q
"RTN","TIUEDIM",53,0)
 . . N TIUQUIT,TIUADD,TIUTDA
"RTN","TIUEDIM",54,0)
 . . ; -- Edit new or existing DA --
"RTN","TIUEDIM",55,0)
 . . D DIE^TIUEDI4(DA,.TIUQUIT)
"RTN","TIUEDIM",56,0)
 . . Q:+$G(TIUQUIT)=2  ; DA doesn't exist (e.g. uparrowed w/ bad record)
"RTN","TIUEDIM",57,0)
 . . I $$EMPTYDOC^TIULF(DA) D DELETE^TIUEDIT(DA,0) S:$G(VALMAR)="^TMP(""TIUVIEW"",$J)" VALMBCK="Q" S:'+$G(TIUNEW) TIUCHNG("DELETE")=1 H:'+$G(TIUNEW) 2 Q
"RTN","TIUEDIM",58,0)
 . . Q:+$G(TIUQUIT)
"RTN","TIUEDIM",59,0)
 . . S:+DA SUCCESS=+DA
"RTN","TIUEDIM",60,0)
 . . I +$G(TIUONCE) S TIUNDA(+$G(DA))="" ; See TIURC, Across Patients
"RTN","TIUEDIM",61,0)
 . . ; -- Misc after-edit-stuff for DA --
"RTN","TIUEDIM",62,0)
 . . ; -- Mark to ask workload at signature;
"RTN","TIUEDIM",63,0)
 . . ;    (STOP for Stop codes for stand-alone visits): --
"RTN","TIUEDIM",64,0)
 . . I +$G(TIU("STOP")),(+$P($G(TIUDPRM(0)),U,14)'=1) D DEFER^TIUVSIT(DA,TIU("STOP")) I 1
"RTN","TIUEDIM",65,0)
 . . E  D QUE^TIUPXAP1 ; Post workload now in background
"RTN","TIUEDIM",66,0)
 . . S TIUCMMTX=$$COMMIT^TIULC1(+$P(TIUTYP(1),U,2))
"RTN","TIUEDIM",67,0)
 . . I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUEDIM",68,0)
 . . D RELEASE^TIUT(DA)
"RTN","TIUEDIM",69,0)
 . . D VERIFY^TIUT(DA)
"RTN","TIUEDIM",70,0)
 . . ; -- Get signature for DA 
"RTN","TIUEDIM",71,0)
 . . D EDSIG^TIURS(DA)
"RTN","TIUEDIM",72,0)
 . . ; - execute EXIT ACTION -
"RTN","TIUEDIM",73,0)
 . . S TIUEXIT=$$GETEXIT^TIUEDI2(+$P(TIUTYP(1),U,2))
"RTN","TIUEDIM",74,0)
 . . I $L(TIUEXIT) S TIUTDA=DA X TIUEXIT S DA=TIUTDA
"RTN","TIUEDIM",75,0)
 . . ; --  [Prompt to print DA] --
"RTN","TIUEDIM",76,0)
 . . I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUEDIM",77,0)
 Q
"RTN","TIUEDIT")
0^11^B35671495
"RTN","TIUEDIT",1,0)
TIUEDIT ; SLC/JER - Enter/Edit a Document ; 3/7/01
"RTN","TIUEDIT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,7,22,52,100**;Jun 20, 1997
"RTN","TIUEDIT",3,0)
 ; Moved LOADDFLT, BOIL, CANXEC, REPLACE, INSMULT to TIUEDI4
"RTN","TIUEDIT",4,0)
 ; Moved DIE, TEXTEDIT from TIUEDIT to TIUEDI4
"RTN","TIUEDIT",5,0)
 ; Separated out modules SETTL, GETVST, ASKOK
"RTN","TIUEDIT",6,0)
 ; Moved SETTL, GETVST, ASKOK from TIUEDIT to TIUEDI4
"RTN","TIUEDIT",7,0)
 ; Changed call to GETREC^TIUEDI1 to call GETRECNW^TIUEDI3
"RTN","TIUEDIT",8,0)
MAIN(TIUCLASS,SUCCESS,DFN,TIUTITLE,EVNTFLAG,NOSAVE,TIUNDA,TIUSNGL,TIUCHNG) ; Create new document(s)
"RTN","TIUEDIT",9,0)
 ; May branch off to edit existing docmt instead of creating new one.
"RTN","TIUEDIT",10,0)
 ; Call with: [TIUCLASS] --> pointer to file (8925) corresponding to
"RTN","TIUEDIT",11,0)
 ;                           the class (e.g., Progress Notes=3)
"RTN","TIUEDIT",12,0)
 ;                           from which to select a title
"RTN","TIUEDIT",13,0)
 ;    [by ref] [SUCCESS] --> Boolean flag returned as IFN when a
"RTN","TIUEDIT",14,0)
 ;                           record is created, or 0 when record
"RTN","TIUEDIT",15,0)
 ;                           creation fails
"RTN","TIUEDIT",16,0)
 ;                 [DFN] --> IEN in patient file (#2)
"RTN","TIUEDIT",17,0)
 ;            [TIUTITLE] --> Pointer or NAME or PTR^NAME of the
"RTN","TIUEDIT",18,0)
 ;                           TITLE from file 8925.1 to be used as
"RTN","TIUEDIT",19,0)
 ;                           the default.
"RTN","TIUEDIT",20,0)
 ;            [EVNTFLAG] --> Boolean flag for visit prompt (0 to
"RTN","TIUEDIT",21,0)
 ;                           prompt, 1 to force event type visit)
"RTN","TIUEDIT",22,0)
 ;              [NOSAVE] --> Boolean flag to suppress saving the data
"RTN","TIUEDIT",23,0)
 ;                           (e.g., when testing new Boilerplates
"RTN","TIUEDIT",24,0)
 ;                           using DDEF action TRY, etc.).
"RTN","TIUEDIT",25,0)
 ;     [by ref] [TIUNDA] --> array of form: TIUNDA(IFN)="".
"RTN","TIUEDIT",26,0)
 ;                           Used in SHOW NOTES ACROSS PATIENTS.
"RTN","TIUEDIT",27,0)
 ;                           See TIURC, which sets TIUONCE.
"RTN","TIUEDIT",28,0)
 ;                           Also used in TIUEDIM, for mult pts.
"RTN","TIUEDIT",29,0)
 ;             [TIUSNGL] --> Boolean flag to create only ONE note
"RTN","TIUEDIT",30,0)
 ;                           regardless of multiple pt preference.
"RTN","TIUEDIT",31,0)
 ;    [by ref] [TIUCHNG] --> If received, passes back TIUCHNG array,
"RTN","TIUEDIT",32,0)
 ;                           which collects info across records about
"RTN","TIUEDIT",33,0)
 ;                           actions taken. Used in feedback
"RTN","TIUEDIT",34,0)
 ;                           msgs to user.
"RTN","TIUEDIT",35,0)
 ; Other variables:
"RTN","TIUEDIT",36,0)
 ; sets [TIUTYP] --> array with form similar to that of XQORNOD:
"RTN","TIUEDIT",37,0)
 ;                           TIUTYP = title IFN
"RTN","TIUEDIT",38,0)
 ;                           TIUTYP(1) = 1^title IFN^title name,
"RTN","TIUEDIT",39,0)
 ;                           where 1 for us is just a positive #
"RTN","TIUEDIT",40,0)
 ; sets  [TIUBY] --> used in some input templates to BYpass fields.
"RTN","TIUEDIT",41,0)
 ; Called by:
"RTN","TIUEDIT",42,0)
 ;   Outpt Pharmacy, Consults, ...
"RTN","TIUEDIT",43,0)
 N TIUASK,TIUOUT,TIUREL,TIUCHK,TIUDA,TIUEDIT,TIUY,TIUTYP,TIUDPRM
"RTN","TIUEDIT",44,0)
 N TIUDFLT,TIUPREF,TIULMETH,TIUVMETH,DIRUT,DUOUT,DTOUT,TIUPRM0
"RTN","TIUEDIT",45,0)
 N TIUPRM1,TIUPRM3,TIUENTRY,TIUEXIT,TIUBY,TIUPNAME,TIUST
"RTN","TIUEDIT",46,0)
 S EVNTFLAG=+$G(EVNTFLAG,0)
"RTN","TIUEDIT",47,0)
 ; --Get user's division parameters, preferences: --
"RTN","TIUEDIT",48,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUEDIT",49,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUEDIT",50,0)
 ; -- multiple pts; not in OERR, not TRYing DDEF, not single docmt: --
"RTN","TIUEDIT",51,0)
 I $P(TIUPREF,U,6)="M",(+$G(ORVP)'>0),(+$G(NOSAVE)'>0),'+$G(TIUSNGL) D MAIN^TIUEDIM(TIUCLASS,.TIUOUT,.TIUNDA,.TIUCHNG) Q
"RTN","TIUEDIT",52,0)
 ; -- Loop: Create docmt --
"RTN","TIUEDIT",53,0)
 F  D  Q:+$G(ORVP)!+$G(TIUOUT)!+$G(NOSAVE)!+$G(TIUSNGL)
"RTN","TIUEDIT",54,0)
 . N TIU,TIUCMMTX,TIUBY,TIUEDIT,TIUNEW,TIUTYP,VADM,VAIN,CANEDIT
"RTN","TIUEDIT",55,0)
 . ; -- User specifies basic info for new docmt --
"RTN","TIUEDIT",56,0)
 . ; -- Get patient --
"RTN","TIUEDIT",57,0)
 . I +$G(ORVP) S DFN=+$G(ORVP)
"RTN","TIUEDIT",58,0)
 . I +$G(DFN)'>0 D  I +DFN'>0 S TIUOUT=1 Q
"RTN","TIUEDIT",59,0)
 . . S DFN=+$$PATIENT^TIULA
"RTN","TIUEDIT",60,0)
 . ; -- [For progress notes, show available notes]: --
"RTN","TIUEDIT",61,0)
 . S TIUCLASS=$G(TIUCLASS,38)
"RTN","TIUEDIT",62,0)
 . I TIUCLASS=3,$S(+$$ISA^USRLM(DUZ,"TRANSCRIPTIONIST"):0,1:1),(+$G(NOSAVE)'>0) D EXSTNOTE^TIUEDI2(DFN) D:$G(VALMAR)="^TMP(""OR"",$J,""CURRENT"")" FULL^VALM1
"RTN","TIUEDIT",63,0)
 . I +$G(DIROUT)!+$G(DUOUT)!+$G(DTOUT) S TIUOUT=1 Q
"RTN","TIUEDIT",64,0)
 . ; -- Set title array TIUTYP (use TIUTITLE or ask user) --
"RTN","TIUEDIT",65,0)
 . D SETTL^TIUEDI4(.TIUTYP,TIUCLASS,$G(TIUTITLE)) I +$G(TIUTYP)'>0 S TIUOUT=1 Q
"RTN","TIUEDIT",66,0)
 . ; -- Get doc parameters for title, X entry action --
"RTN","TIUEDIT",67,0)
 . D DOCPRM^TIULC1(TIUTYP,.TIUDPRM)
"RTN","TIUEDIT",68,0)
 . S TIUENTRY=$$GETENTRY^TIUEDI2(+TIUTYP)
"RTN","TIUEDIT",69,0)
 . I $L(TIUENTRY) X TIUENTRY
"RTN","TIUEDIT",70,0)
 . Q:+$G(TIUOUT)  ; If ENTRY ACTION sets TIUOUT=1 Abort entry
"RTN","TIUEDIT",71,0)
 . ; -- Set visit array TIU --
"RTN","TIUEDIT",72,0)
 . D GETVST^TIUEDI4(DFN,TIUTYP,.TIU,EVNTFLAG)
"RTN","TIUEDIT",73,0)
 . I '$D(TIU("VSTR")) K DFN,TIUTYP Q
"RTN","TIUEDIT",74,0)
 . ; -- Ask OK --
"RTN","TIUEDIT",75,0)
 . D ASKOK^TIUEDI4(TIUTYP,.TIU,.TIUBY,.TIUASK) I '$D(TIU("VSTR")) K DFN,TIUTYP Q
"RTN","TIUEDIT",76,0)
 . ; -- If user OK'd basic info, go on to get text, etc.: --
"RTN","TIUEDIT",77,0)
 . I $D(TIU),+$G(TIUASK) D
"RTN","TIUEDIT",78,0)
 . . ; -- Get record DA --
"RTN","TIUEDIT",79,0)
 . . ; DA is either: new stub record, ready for edit, or
"RTN","TIUEDIT",80,0)
 . . ;               existing record, for edit, or
"RTN","TIUEDIT",81,0)
 . . ;               existing record, for addendum      
"RTN","TIUEDIT",82,0)
 . . N DA
"RTN","TIUEDIT",83,0)
 . . S DA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM,1,DUZ,.CANEDIT)
"RTN","TIUEDIT",84,0)
 . . I +DA'>0 W !,"Unable to enter/edit." Q
"RTN","TIUEDIT",85,0)
 . . ; -- [Addend DA and Quit] --
"RTN","TIUEDIT",86,0)
 . . ;    If record not new & user can't edit it, let user
"RTN","TIUEDIT",87,0)
 . . ;    write addendum and quit:
"RTN","TIUEDIT",88,0)
 . . I 'TIUNEW,'CANEDIT D  Q
"RTN","TIUEDIT",89,0)
 . . . D ADDENDUM^TIUADD(DA,"",.TIUCHNG,1)
"RTN","TIUEDIT",90,0)
 . . N TIUQUIT,TIUADD,TIUTDA
"RTN","TIUEDIT",91,0)
 . . ; -- Edit new or existing DA --
"RTN","TIUEDIT",92,0)
 . . D DIE^TIUEDI4(DA,.TIUQUIT)
"RTN","TIUEDIT",93,0)
 . . Q:+$G(TIUQUIT)=2  ; DA doesn't exist (e.g. uparrowed w/ bad record)
"RTN","TIUEDIT",94,0)
 . . I $$EMPTYDOC^TIULF(DA) D DELETE(DA,0) S:$G(VALMAR)="^TMP(""TIUVIEW"",$J)" VALMBCK="Q" S:'+$G(TIUNEW) TIUCHNG("DELETE")=1 H:'+$G(TIUNEW) 2 Q
"RTN","TIUEDIT",95,0)
 . . Q:+$G(TIUQUIT)
"RTN","TIUEDIT",96,0)
 . . S:+DA SUCCESS=+DA
"RTN","TIUEDIT",97,0)
 . . I +$G(TIUONCE) S TIUNDA(+$G(DA))="" ; See TIURC, Across Patients
"RTN","TIUEDIT",98,0)
 . . ; -- Misc after-edit-stuff for DA --
"RTN","TIUEDIT",99,0)
 . . ; -- Mark to ask workload at signature;
"RTN","TIUEDIT",100,0)
 . . ;    (STOP for Stop codes for stand-alone visits): --
"RTN","TIUEDIT",101,0)
 . . I +$G(TIU("STOP")),(+$P($G(TIUDPRM(0)),U,14)'=1) D DEFER^TIUVSIT(DA,TIU("STOP")) I 1 ;piece 14 = suppress DX/CPT on entry
"RTN","TIUEDIT",102,0)
 . . E  D QUE^TIUPXAP1 ; Post workload now in background
"RTN","TIUEDIT",103,0)
 . . S TIUCMMTX=$$COMMIT^TIULC1(+$P(TIUTYP(1),U,2))
"RTN","TIUEDIT",104,0)
 . . I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUEDIT",105,0)
 . . D RELEASE^TIUT(DA)
"RTN","TIUEDIT",106,0)
 . . D VERIFY^TIUT(DA)
"RTN","TIUEDIT",107,0)
 . . ; -- Get signature for DA 
"RTN","TIUEDIT",108,0)
 . . D EDSIG^TIURS(DA)
"RTN","TIUEDIT",109,0)
 . . ; - execute EXIT ACTION -
"RTN","TIUEDIT",110,0)
 . . S TIUEXIT=$$GETEXIT^TIUEDI2(+$P(TIUTYP(1),U,2))
"RTN","TIUEDIT",111,0)
 . . I $L(TIUEXIT) S TIUTDA=DA X TIUEXIT S DA=TIUTDA
"RTN","TIUEDIT",112,0)
 . . ; --  [Prompt to add ID stub] --
"RTN","TIUEDIT",113,0)
 . . ; I +$P($G(TIUDPRM(0)),U,20) D ADDSTUB^TIUGEDIT(DA)
"RTN","TIUEDIT",114,0)
 . . ; --  [Prompt to print DA] --
"RTN","TIUEDIT",115,0)
 . . I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUEDIT",116,0)
 . K DFN ; Free patient
"RTN","TIUEDIT",117,0)
 . S TIUPNAME=$$PNAME^TIULC1(TIUCLASS)
"RTN","TIUEDIT",118,0)
 . I $$UP^XLFSTR($E(TIUPNAME,$L(TIUPNAME)))="S" S TIUPNAME=$E(TIUPNAME,1,$L(TIUPNAME)-1)
"RTN","TIUEDIT",119,0)
 . ; -- [loop again] --
"RTN","TIUEDIT",120,0)
 . I '+$G(NOSAVE),'+$G(ORVP),'+$G(TIUSNGL) W !!,"You may enter another ",TIUPNAME,". Press RETURN to exit.",!
"RTN","TIUEDIT",121,0)
 Q
"RTN","TIUEDIT",122,0)
 ;
"RTN","TIUEDIT",123,0)
DELETE(TIUDA,PROMPT,MSG,HUSH) ; Delete record
"RTN","TIUEDIT",124,0)
 N DIDEL,DIE,DR,TIUD0,TIUVSIT,TIUVKILL,TIUDELX,TIUTYPE
"RTN","TIUEDIT",125,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUVSIT=$P(TIUD0,U,3),TIUTYPE=+TIUD0
"RTN","TIUEDIT",126,0)
 I +$G(PROMPT),'+$$READ^TIUU("YO",MSG,"NO") W !,"Nothing Deleted." Q
"RTN","TIUEDIT",127,0)
 K ^TIU(8925,"ASAVE",DUZ,TIUDA)
"RTN","TIUEDIT",128,0)
 D DELIRT^TIUDIRT(TIUDA)
"RTN","TIUEDIT",129,0)
 ; If a DELETE Action exists for the document definition, execute it
"RTN","TIUEDIT",130,0)
 S TIUDELX=$$DELETE^TIULC1(TIUTYPE)
"RTN","TIUEDIT",131,0)
 I TIUDELX]"" X TIUDELX
"RTN","TIUEDIT",132,0)
 S DA=TIUDA,(DIDEL,DIE)=8925,DR=".01///@"
"RTN","TIUEDIT",133,0)
 D ^DIE W:'+$G(HUSH) !,"<NOTHING ENTERED. "
"RTN","TIUEDIT",134,0)
 I '+$G(HUSH) W:+TIUD0 $$PNAME^TIULC1(+TIUD0)," DELETED>"
"RTN","TIUEDIT",135,0)
 D DELCOMP^TIUEDI1(TIUDA),DELAUDIT^TIUEDI1(TIUDA)
"RTN","TIUEDIT",136,0)
 K ^TIU(8925,"ASAVE",DUZ,TIUDA) ; Remove Save Flag
"RTN","TIUEDIT",137,0)
 D ALERTDEL^TIUALRT(TIUDA),ADDENDEL^TIUALRT(TIUDA)
"RTN","TIUEDIT",138,0)
 ; I +TIUVSIT S TIUVKILL=$$DELVFILE^PXAPI("ALL",TIUVSIT,"","TEXT INTEGRATION UTILITIES")
"RTN","TIUEDIT",139,0)
 Q
"RTN","TIUEDIT",140,0)
 ;
"RTN","TIUEDITR")
0^34^B12868226
"RTN","TIUEDITR",1,0)
TIUEDITR ; SLC/JER - Enter/Edit a Document for Transcriber ;1/21/01
"RTN","TIUEDITR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,41,48,100**;Jun 20, 1997
"RTN","TIUEDITR",3,0)
 ; 2/2: Update DIE from TIUEDIT to TIUEDI4
"RTN","TIUEDITR",4,0)
MAIN(TIUCLASS) ; Control Branching
"RTN","TIUEDITR",5,0)
 N TIUPREF,TIUOUT,TIUAUTH
"RTN","TIUEDITR",6,0)
 ; --- Get user's preferences ---
"RTN","TIUEDITR",7,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUEDITR",8,0)
 ; --- Get the author to be used for multiple patients
"RTN","TIUEDITR",9,0)
 S TIUAUTH=+$$AUTHOR^TIULA2
"RTN","TIUEDITR",10,0)
 I TIUAUTH'>0 Q
"RTN","TIUEDITR",11,0)
 F  D  Q:+$G(TIUOUT)
"RTN","TIUEDITR",12,0)
 . N DFN,TIUREL,TIUCHK,TIUDA,TIUEDIT,TIUY,TIUNEW,TIUTYP,TIUDPRM
"RTN","TIUEDITR",13,0)
 . N TIUASK,TIU,VAIN,VADM,TIULMETH,TIUVMETH,TIUENTRY,TIUEXIT,TIUCMMTX
"RTN","TIUEDITR",14,0)
 . N DA ;10/3/00
"RTN","TIUEDITR",15,0)
 . ;Removed with TIU*1*41 - Joel didn't think it was appropriate
"RTN","TIUEDITR",16,0)
 . ;I $P(TIUPREF,U,6)="M" D MAIN^TIUEDIM(TIUCLASS,.TIUOUT) Q
"RTN","TIUEDITR",17,0)
 . ; --- Get a patient ---
"RTN","TIUEDITR",18,0)
 . S DFN=+$$PATIENT^TIULA I +DFN'>0 S TIUOUT=1 Q
"RTN","TIUEDITR",19,0)
 . S TIUCLASS=$G(TIUCLASS,38)
"RTN","TIUEDITR",20,0)
 . ; --- Get a document type ---
"RTN","TIUEDITR",21,0)
 . D DOCSPICK^TIULA2(.TIUTYP,TIUCLASS,"1A","LAST","","$P(^TIU(8925.1,+Y,0),U,7)'=13,+$$CANENTR^TIULP(+Y)")
"RTN","TIUEDITR",22,0)
 . I +$G(TIUTYP)'>0 S TIUOUT=1 Q
"RTN","TIUEDITR",23,0)
 . S TIUTYP=+$P($G(TIUTYP(1)),U,2)
"RTN","TIUEDITR",24,0)
 . ; --- Initialize document parameters ---
"RTN","TIUEDITR",25,0)
 . D DOCPRM^TIULC1(TIUTYP,.TIUDPRM)
"RTN","TIUEDITR",26,0)
 . ; --- If an ENTRY ACTION exists, execute it ---
"RTN","TIUEDITR",27,0)
 . S TIUENTRY=$$GETENTRY^TIUEDI2(+TIUTYP)
"RTN","TIUEDITR",28,0)
 . I $L(TIUENTRY) X TIUENTRY
"RTN","TIUEDITR",29,0)
 . Q:+$G(TIUOUT)  ; If entry action sets TIUOUT=1 Abort Entry
"RTN","TIUEDITR",30,0)
 . ; --- Get associated visit ---
"RTN","TIUEDITR",31,0)
 . I +$$SUPPVSIT^TIULC1(TIUTYP)'>0 D  I 1
"RTN","TIUEDITR",32,0)
 . . S TIULMETH=$$GETLMETH^TIUEDI1(TIUTYP)
"RTN","TIUEDITR",33,0)
 . . I '$L(TIULMETH) D  S TIUOUT=1 Q
"RTN","TIUEDITR",34,0)
 . . . W !,$C(7),"No Visit Linkage Method defined for "
"RTN","TIUEDITR",35,0)
 . . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUEDITR",36,0)
 . . X TIULMETH
"RTN","TIUEDITR",37,0)
 . E  D
"RTN","TIUEDITR",38,0)
 . . D EVENT^TIUSRVP1(.TIU,DFN)
"RTN","TIUEDITR",39,0)
 . I $S($D(DIROUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 Q
"RTN","TIUEDITR",40,0)
 . I '$D(TIU("VSTR")) D  Q
"RTN","TIUEDITR",41,0)
 . . W !,$C(7),"Patient & Visit required." H 2
"RTN","TIUEDITR",42,0)
 . ; --- Validate Selection ---
"RTN","TIUEDITR",43,0)
 . S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYP)
"RTN","TIUEDITR",44,0)
 . I '$L(TIUVMETH) D  S TIUOUT=1 Q
"RTN","TIUEDITR",45,0)
 . . W !,$C(7),"No Validation Method defined for "
"RTN","TIUEDITR",46,0)
 . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUEDITR",47,0)
 . X TIUVMETH
"RTN","TIUEDITR",48,0)
 . I $D(TIU),+$G(TIUASK) D
"RTN","TIUEDITR",49,0)
 . . ;S DA=$$GETREC^TIUEDI1(DFN,.TIU,1,.TIUNEW,.TIUDPRM,1)
"RTN","TIUEDITR",50,0)
 . . S DA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM,1)
"RTN","TIUEDITR",51,0)
 . . I +DA'>0 W !,"Unable to enter/edit." Q
"RTN","TIUEDITR",52,0)
 . . S TIUEDIT=$S('+$G(TIUNEW):$$CANDO^TIULP(DA,"EDIT RECORD"),1:1)
"RTN","TIUEDITR",53,0)
 . . I '+TIUEDIT D  Q
"RTN","TIUEDITR",54,0)
 . . . W !,$P(TIUEDIT,U,2) ; Echo denial message
"RTN","TIUEDITR",55,0)
 . . . D ADDENDUM^TIUADD(DA,"",.TIUCHNG)
"RTN","TIUEDITR",56,0)
 . . N TIUQUIT,TIUADD
"RTN","TIUEDITR",57,0)
 . . D DIE^TIUEDI4(DA,.TIUQUIT) Q:+$G(TIUQUIT)=2  ; **100**
"RTN","TIUEDITR",58,0)
 . . I $$EMPTYDOC^TIULF(DA) D DELETE^TIUEDIT(DA,0) S:'+$G(TIUNEW) TIUCHNG("DELETE")=1 H:'+$G(TIUNEW) 2 Q
"RTN","TIUEDITR",59,0)
 . . Q:+$G(TIUQUIT)
"RTN","TIUEDITR",60,0)
 . . I +$G(TIUONCE) S TIUNDA(+$G(DA))=""
"RTN","TIUEDITR",61,0)
 . . I +$G(TIU("STOP")) D DEFER^TIUVSIT(DA,TIU("STOP")) I 1
"RTN","TIUEDITR",62,0)
 . . E  D QUE^TIUPXAP1
"RTN","TIUEDITR",63,0)
 . . ; --- Execute COMMIT procedure ---
"RTN","TIUEDITR",64,0)
 . . S TIUCMMTX=$$COMMIT^TIULC1(+$G(^TIU(8925,+DA,0)))
"RTN","TIUEDITR",65,0)
 . . I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUEDITR",66,0)
 . . ; --- Execute RELEASE procedure ---
"RTN","TIUEDITR",67,0)
 . . D RELEASE^TIUT(DA)
"RTN","TIUEDITR",68,0)
 . . ; --- Execute VERIFY procedure ---
"RTN","TIUEDITR",69,0)
 . . D VERIFY^TIUT(DA)
"RTN","TIUEDITR",70,0)
 . . ; --- Execute SIGNATURE procedure ---
"RTN","TIUEDITR",71,0)
 . . D EDSIG^TIURS(DA)
"RTN","TIUEDITR",72,0)
 . . ; --- If an EXIT ACTION exists, execute it ---
"RTN","TIUEDITR",73,0)
 . . S TIUEXIT=$$GETEXIT^TIUEDI2(+$P(TIUTYP(1),U,2))
"RTN","TIUEDITR",74,0)
 . . I $L(TIUEXIT) X TIUEXIT
"RTN","TIUEDITR",75,0)
 . . ; --- If required, prompt for print
"RTN","TIUEDITR",76,0)
 . . I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUEDITR",77,0)
 Q
"RTN","TIUEPRNT")
0^28^B4636923
"RTN","TIUEPRNT",1,0)
TIUEPRNT ; SLC/JER - Handle print following entry/edit ; 10/25/00
"RTN","TIUEPRNT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**20,100**;Jun 20, 1997
"RTN","TIUEPRNT",3,0)
PRINT(TIUDA) ; Prompt and print
"RTN","TIUEPRNT",4,0)
 N TIUDEV,TIUTYP,DFN,TIUPMTHD,TIUD0,TIUMSG,TIUPR,TIUDARR,TIUFLAG,TIUDPRM
"RTN","TIUEPRNT",5,0)
 N TIUPGRP,TIUPFHDR,TIUPFNBR
"RTN","TIUEPRNT",6,0)
 S TIUMSG="Print this note"
"RTN","TIUEPRNT",7,0)
 S TIUPR=$$READ^TIUU("Y",TIUMSG,"No")
"RTN","TIUEPRNT",8,0)
 I +TIUPR'>0 Q
"RTN","TIUEPRNT",9,0)
 I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=$P($G(^TIU(8925,+TIUDA,0)),U,6)
"RTN","TIUEPRNT",10,0)
 I $G(^TIU(8925,TIUDA,21)) S TIUDA=^TIU(8925,TIUDA,21)
"RTN","TIUEPRNT",11,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUEPRNT",12,0)
 S TIUTYP=$P(TIUD0,U),DFN=$P(TIUD0,U,2)
"RTN","TIUEPRNT",13,0)
 I +TIUTYP'>0 Q
"RTN","TIUEPRNT",14,0)
 S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYP)
"RTN","TIUEPRNT",15,0)
 S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYP)
"RTN","TIUEPRNT",16,0)
 S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYP)
"RTN","TIUEPRNT",17,0)
 S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYP)
"RTN","TIUEPRNT",18,0)
 D DOCPRM^TIULC1(+TIUTYP,.TIUDPRM,TIUDA)
"RTN","TIUEPRNT",19,0)
 I +$P($G(TIUDPRM(0)),U,9) S TIUFLAG=$$FLAG^TIUPRPN3
"RTN","TIUEPRNT",20,0)
 I $G(TIUPMTHD)]"",+$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") S TIUDARR(TIUPMTHD,$G(TIUPGRP)_"$"_TIUPFHDR_";"_DFN,1,TIUDA)=TIUPFNBR
"RTN","TIUEPRNT",21,0)
 E  S TIUDARR(TIUPMTHD,DFN,1,TIUDA)=""
"RTN","TIUEPRNT",22,0)
 I $G(TIUPMTHD)']"" W !,$C(7),"No Print Method Defined for ",$P($G(^TIU(8925.1,+TIUTYP,0)),U) H 2 G PRINT1X
"RTN","TIUEPRNT",23,0)
 S TIUDEV=$$DEVICE^TIUDEV(.IO) ; Get Device/allow queueing
"RTN","TIUEPRNT",24,0)
 I $S($G(IO)']"":1,TIUDEV']"":1,1:0) D ^%ZISC Q
"RTN","TIUEPRNT",25,0)
 I $D(IO("Q")) D QUE^TIUDEV("PRINTQ^TIUEPRNT",TIUDEV) G PRINT1X
"RTN","TIUEPRNT",26,0)
 D PRINTQ,^%ZISC
"RTN","TIUEPRNT",27,0)
PRINT1X ; Exit single document print
"RTN","TIUEPRNT",28,0)
 Q
"RTN","TIUEPRNT",29,0)
PRINTQ ; Entry point for queued single document print
"RTN","TIUEPRNT",30,0)
 D PRNTDOC(TIUPMTHD,.TIUDARR)
"RTN","TIUEPRNT",31,0)
 Q
"RTN","TIUEPRNT",32,0)
PRNTDOC(TIUPMTHD,TIUDARR) ; Print a single document type
"RTN","TIUEPRNT",33,0)
 ; Receives TIUPMTHD & TIUDARR
"RTN","TIUEPRNT",34,0)
 N TIUDA
"RTN","TIUEPRNT",35,0)
 I '+$D(TIUDARR) W !,"No Documents selected." Q
"RTN","TIUEPRNT",36,0)
 M ^TMP("TIUPR",$J)=TIUDARR(TIUPMTHD)
"RTN","TIUEPRNT",37,0)
 I TIUPMTHD']"" D  G PRNTDOCX
"RTN","TIUEPRNT",38,0)
 . W !!,"No Print Method Defined for ",$P(TIUTYP,U,2) H 2
"RTN","TIUEPRNT",39,0)
 X TIUPMTHD
"RTN","TIUEPRNT",40,0)
PRNTDOCX ; Exit single document type print
"RTN","TIUEPRNT",41,0)
 K ^TMP("TIUPR",$J)
"RTN","TIUEPRNT",42,0)
 Q
"RTN","TIUGBR")
0^66^B6771191
"RTN","TIUGBR",1,0)
TIUGBR ; SLC/MAM - ID Browse Action Subroutines: HASIDKID, HASIDDAD, DADORKID, IDTOP, LOADID, GETKIDS ;4/12/01
"RTN","TIUGBR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUGBR",3,0)
 ; Similar to TIUBR, but for ID notes
"RTN","TIUGBR",4,0)
 ;
"RTN","TIUGBR",5,0)
GETKIDS(TIUDA) ; Set ID kids of TIUDA into array
"RTN","TIUGBR",6,0)
 ;   ^TMP("TIUGKID",$J,REFERENCE DATE,TIUKID)="":
"RTN","TIUGBR",7,0)
 N TIUKID,REFDATE
"RTN","TIUGBR",8,0)
 S TIUKID=0
"RTN","TIUGBR",9,0)
 F  S TIUKID=$O(^TIU(8925,"GDAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUGBR",10,0)
 . S REFDATE=+$G(^TIU(8925,TIUKID,13))
"RTN","TIUGBR",11,0)
 . S ^TMP("TIUGKID",$J,REFDATE,TIUKID)=""
"RTN","TIUGBR",12,0)
 Q
"RTN","TIUGBR",13,0)
 ;
"RTN","TIUGBR",14,0)
HASIDKID(DA) ; Function returns 1 if DA has ID kid, else 0. 
"RTN","TIUGBR",15,0)
 N TIUY
"RTN","TIUGBR",16,0)
 S TIUY=0
"RTN","TIUGBR",17,0)
 I $O(^TIU(8925,"GDAD",+DA,0)) S TIUY=1
"RTN","TIUGBR",18,0)
 Q TIUY
"RTN","TIUGBR",19,0)
 ;
"RTN","TIUGBR",20,0)
HASIDDAD(DA) ; Function returns ID parent of DA if DA has parent; else 0.
"RTN","TIUGBR",21,0)
 Q +$G(^TIU(8925,DA,21),0)
"RTN","TIUGBR",22,0)
 ;
"RTN","TIUGBR",23,0)
DADORKID(DA) ; Function returns DA if DA has ID kid,
"RTN","TIUGBR",24,0)
 ;or ID dad IFN if DA has ID dad, else 0.
"RTN","TIUGBR",25,0)
 N TIUY
"RTN","TIUGBR",26,0)
 S TIUY=0
"RTN","TIUGBR",27,0)
 I $O(^TIU(8925,"GDAD",+DA,0)) S TIUY=DA G ORKIDX
"RTN","TIUGBR",28,0)
 I +$G(^TIU(8925,DA,21)) S TIUY=^TIU(8925,DA,21)
"RTN","TIUGBR",29,0)
ORKIDX Q TIUY
"RTN","TIUGBR",30,0)
 ;
"RTN","TIUGBR",31,0)
IDTOP(TIUDA,TIUL,SHORT,CURPRNT) ; Load entry-specific info:
"RTN","TIUGBR",32,0)
 ;Title, [Location, Visit] for ID entry.
"RTN","TIUGBR",33,0)
 ; Called by LOADTOP^TIUBR
"RTN","TIUGBR",34,0)
 N TIUY,TIU,DFN
"RTN","TIUGBR",35,0)
 I CURPRNT S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="                         << Interdisciplinary Note >>"
"RTN","TIUGBR",36,0)
 I SHORT S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="                      << Interdisciplinary Note - Cont. >>"
"RTN","TIUGBR",37,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUGBR",38,0)
 S TIUL=+$G(TIUL)+1,TIUY=""
"RTN","TIUGBR",39,0)
 S TIUY=$$SETSTR^VALM1("TITLE: "_$P($G(TIU("DOCTYP")),U,2),$G(TIUY),1,67)
"RTN","TIUGBR",40,0)
 S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUGBR",41,0)
 Q:SHORT
"RTN","TIUGBR",42,0)
 S TIUL=TIUL+1,TIUY=""
"RTN","TIUGBR",43,0)
 S TIUY=$$SETSTR^VALM1("LOCATION: "_$P($G(TIU("LOC")),U,2),$G(TIUY),5,31)
"RTN","TIUGBR",44,0)
 I $L($G(TIU("WARD"))) S TIUY=$$SETSTR^VALM1("ADMISSION DATE: "_$P($G(TIU("EDT")),U,2),$G(TIUY),34,37) I 1
"RTN","TIUGBR",45,0)
 E  S TIUY=$$SETSTR^VALM1("VISIT DATE: "_$P($G(TIU("EDT")),U,2),$G(TIUY),38,33)
"RTN","TIUGBR",46,0)
 S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUGBR",47,0)
 Q
"RTN","TIUGBR",48,0)
 ;
"RTN","TIUGBR",49,0)
LOADID(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ID entry TIUDA for browse
"RTN","TIUGBR",50,0)
 ; Requires TIUDA, array TIUL, TIUGDATA;
"RTN","TIUGBR",51,0)
 ; Optional TIUGWHOL (see rtn TIUBR).
"RTN","TIUGBR",52,0)
 N TIUREC,TIU,DFN
"RTN","TIUGBR",53,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUGBR",54,0)
 ; ---- If ID Kid has focus, don't show it again ----
"RTN","TIUGBR",55,0)
 ; I +$G(^TMP("TIU FOCUS",$J))=TIUDA Q
"RTN","TIUGBR",56,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUGBR",57,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUGBR",58,0)
 D INQUIRE(TIUDA,.TIUREC)
"RTN","TIUGBR",59,0)
 ; ---- Load info missing from header since this is ID note entry: ----
"RTN","TIUGBR",60,0)
 ; ---- Load dictation, transcription data, etc.: ----
"RTN","TIUGBR",61,0)
 D LOADTOP^TIUBR(.TIUREC,TIUDA,.TIUL,TIUGDATA)
"RTN","TIUGBR",62,0)
 ; ---- Load the remainder of the record: ----
"RTN","TIUGBR",63,0)
 D LOADREC^TIUBR1(TIUDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUGBR",64,0)
 Q
"RTN","TIUGBR",65,0)
 ;
"RTN","TIUGBR",66,0)
INQUIRE(TIUDA,TIUREC) ; Inquire to document TIUDA and set TIUREC
"RTN","TIUGBR",67,0)
 N DA,DIC,DIQ,DR
"RTN","TIUGBR",68,0)
 S DA=TIUDA,DIC=8925,DIQ="TIUREC("
"RTN","TIUGBR",69,0)
 S DR=".01;.02;.05;.09;1201;1202;1208;1209;1301;1307;1501;1502;1505;1506"
"RTN","TIUGBR",70,0)
 D EN^DIQ1
"RTN","TIUGBR",71,0)
 Q
"RTN","TIUGEDI1")
0^32^B14705877
"RTN","TIUGEDI1",1,0)
TIUGEDI1 ; SLC/MAM - Enter New ID Document Code; 11/14/00
"RTN","TIUGEDI1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUGEDI1",3,0)
 ; New rtn for ID notes
"RTN","TIUGEDI1",4,0)
 ; 3/2/00 moved GETRECG from TIUGEDIT to TIUGEDI1
"RTN","TIUGEDI1",5,0)
GETRECG(DFN,TIU,TIUTYP,TIUDPRM,TIUNEW,EDIT,DADDA) ; Get record
"RTN","TIUGEDI1",6,0)
 ;for ID entry.
"RTN","TIUGEDI1",7,0)
 ; Returns DA: new docmt for user to continue entering, or
"RTN","TIUGEDI1",8,0)
 ;existing docmt for user to edit, or just link, or addend.
"RTN","TIUGEDI1",9,0)
 ; Requires array TIU.  References TIU("VSTR") = LOC;VDT;VTYP
"RTN","TIUGEDI1",10,0)
 ;                                 TIU("VISIT") = Visit File IFN
"RTN","TIUGEDI1",11,0)
 ;                                 TIU("LOC")
"RTN","TIUGEDI1",12,0)
 ;                                 TIU("VLOC")
"RTN","TIUGEDI1",13,0)
 ;                                 TIU("STOP") = stop code
"RTN","TIUGEDI1",14,0)
 ; Requires array TIUTYP as in MAIN
"RTN","TIUGEDI1",15,0)
 ; Passes back flags:
"RTN","TIUGEDI1",16,0)
 ;   TIUNEW = 1 if good docmt is returned and it is new
"RTN","TIUGEDI1",17,0)
 ;          = 0 if returned docmt already existed, timeout, etc
"RTN","TIUGEDI1",18,0)
 ;     EDIT = 1 to open DA for edit (already know Person can edit)
"RTN","TIUGEDI1",19,0)
 ;          = 0 to forget the edit
"RTN","TIUGEDI1",20,0)
 ; Requires DADDA = IFN of docmt DA will be added to.
"RTN","TIUGEDI1",21,0)
 N DA,MULTOK,TLFULL,DALKABLE,YESDOIT
"RTN","TIUGEDI1",22,0)
 ;-- Get parameters for selected title, set TLFULL: --
"RTN","TIUGEDI1",23,0)
 ;        TLFULL: Already have max # entries on this title/pt/vst
"RTN","TIUGEDI1",24,0)
 ;        MULTOK: More than ONE record/visit is OK
"RTN","TIUGEDI1",25,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM) S MULTOK=+$P($G(TIUDPRM(0)),U,10)
"RTN","TIUGEDI1",26,0)
 S (TIUNEW,EDIT,TLFULL)=0
"RTN","TIUGEDI1",27,0)
 I 'MULTOK,$$EXIST^TIUEDI3(DFN,TIUTYP,TIU("VSTR")) S TLFULL=1
"RTN","TIUGEDI1",28,0)
 ; -- Find existing docmts for proposed title/patient/visit
"RTN","TIUGEDI1",29,0)
 ;    which are linkable to DADDA: --
"RTN","TIUGEDI1",30,0)
 S DALKABLE=$$EXISTLNK(DFN,TIUTYP,TIU("VSTR"),DUZ,DADDA)
"RTN","TIUGEDI1",31,0)
 ; -- If there are NO such existing docmts,
"RTN","TIUGEDI1",32,0)
 ;    let user create new or tell user they can't, quit: --
"RTN","TIUGEDI1",33,0)
 I 'DALKABLE D  G GETX
"RTN","TIUGEDI1",34,0)
 . I 'TLFULL S DA=$$CREATREC^TIUEDI3(DFN,.TIU,TIUTYP(1)),TIUNEW=1 Q
"RTN","TIUGEDI1",35,0)
 . I TLFULL W !!,"There is already a ",$P(TIUTYP(1),U,3),".",!,"Only ONE record of this type per Visit is allowed...",! H 1 Q
"RTN","TIUGEDI1",36,0)
 ; -- There IS such a docmt. --
"RTN","TIUGEDI1",37,0)
 ;    -- If docmt is already linked, and user can edit,
"RTN","TIUGEDI1",38,0)
 ;       ask if user wants to create new note anyway: --
"RTN","TIUGEDI1",39,0)
 I $G(^TIU(8925,DALKABLE,21))=DADDA D  G GETX
"RTN","TIUGEDI1",40,0)
 . W !,"The note already has an ID entry you can edit with that title and visit"
"RTN","TIUGEDI1",41,0)
 . S YESDOIT=$$READ^TIUU("Y","Would you like to create a new entry anyway","NO")
"RTN","TIUGEDI1",42,0)
 . I YESDOIT S DA=$$CREATREC^TIUEDI3(DFN,.TIU,TIUTYP(1)),TIUNEW=1 Q
"RTN","TIUGEDI1",43,0)
 . W !,"Opening the existing entry" S DA=DALKABLE,EDIT=1
"RTN","TIUGEDI1",44,0)
 ;   -- If docmt is NOT already linked, create new,
"RTN","TIUGEDI1",45,0)
 ;      or edit existing, or just link existing: --
"RTN","TIUGEDI1",46,0)
 W !,"You already have a document you can link for that patient, title, and visit."
"RTN","TIUGEDI1",47,0)
 S YESDOIT=$$READ^TIUU("Y","Would you like to create a new entry anyway","NO")
"RTN","TIUGEDI1",48,0)
 I $D(DUOUT)!$D(DTOUT)!$D(DIROUT) G GETX
"RTN","TIUGEDI1",49,0)
 I YESDOIT S DA=$$CREATREC^TIUEDI3(DFN,.TIU,TIUTYP(1)) S TIUNEW=1 G GETX
"RTN","TIUGEDI1",50,0)
 ;      -- If user says, no don't create, then try edit: --
"RTN","TIUGEDI1",51,0)
 N CANDO S CANDO=+$$CANDO^TIULP(DALKABLE,"EDIT RECORD")
"RTN","TIUGEDI1",52,0)
 I CANDO W !,"Opening the existing entry" S DA=DALKABLE,EDIT=1 G GETX
"RTN","TIUGEDI1",53,0)
 ;         -- If user can't edit, just return it for linking: --
"RTN","TIUGEDI1",54,0)
 I 'CANDO D  G GETX
"RTN","TIUGEDI1",55,0)
 . S DA=DALKABLE
"RTN","TIUGEDI1",56,0)
GETX ;
"RTN","TIUGEDI1",57,0)
 I TIUNEW,'$G(DA) W !,"No new entry created" H 2 S TIUNEW=0
"RTN","TIUGEDI1",58,0)
 Q +$G(DA)
"RTN","TIUGEDI1",59,0)
 ;
"RTN","TIUGEDI1",60,0)
EXISTLNK(DFN,TIUTYP,TIUVSTR,PERSON,DADDA) ; If a docmt PERSON
"RTN","TIUGEDI1",61,0)
 ;can LINK already EXISTS for the given patient, title, and visit,
"RTN","TIUGEDI1",62,0)
 ;then return it. If there are more than one, get the smallest DA.
"RTN","TIUGEDI1",63,0)
 ; Receives TIUVSTR = LOC;VDT;VTYP
"RTN","TIUGEDI1",64,0)
 ; Needs TIUTYP = title DA
"RTN","TIUGEDI1",65,0)
 ; Needs DADDA = IFN of docmt DA will be added to.
"RTN","TIUGEDI1",66,0)
 N REQUEST,DA,TIUI,CANLINK,DALKDAD
"RTN","TIUGEDI1",67,0)
 I '$G(PERSON) S PERSON=DUZ
"RTN","TIUGEDI1",68,0)
 S (REQUEST,TIUI,DA)=0
"RTN","TIUGEDI1",69,0)
LOOP ; -- Find existing docmt for given patient, title, & visit:--
"RTN","TIUGEDI1",70,0)
 F  S TIUI=+$O(^TIU(8925,"APTLD",DFN,TIUTYP,TIUVSTR,TIUI)) Q:'TIUI  D  Q:REQUEST  Q:DA
"RTN","TIUGEDI1",71,0)
 . ; -- If TIUI is bad, reject it and keep looking:
"RTN","TIUGEDI1",72,0)
 . I '$D(^TIU(8925,TIUI,0)) D  Q
"RTN","TIUGEDI1",73,0)
 . . K ^TIU(8925,"APTLD",DFN,TIUTYP,TIUVSTR,TIUI)
"RTN","TIUGEDI1",74,0)
 . ; -- If TIUI has requesting package (e.g. Consults),
"RTN","TIUGEDI1",75,0)
 . ;    then reject it and quit looking: --
"RTN","TIUGEDI1",76,0)
 . I +$P($G(^TIU(8925,TIUI,14)),U,5) S REQUEST=1 Q  ; **22**
"RTN","TIUGEDI1",77,0)
 . N CANLINK S CANLINK=+$$CANDO^TIULP(TIUI,"ATTACH TO ID NOTE",PERSON)
"RTN","TIUGEDI1",78,0)
 . ; -- If person can't link it, keep looking: --
"RTN","TIUGEDI1",79,0)
 . I 'CANLINK Q
"RTN","TIUGEDI1",80,0)
 . ; -- If already linked somewhere else, keep looking: --
"RTN","TIUGEDI1",81,0)
 . S DALKDAD=$G(^TIU(8925,TIUI,21))
"RTN","TIUGEDI1",82,0)
 . I DALKDAD,DALKDAD'=DADDA Q
"RTN","TIUGEDI1",83,0)
 . ; -- If already linked to dad, but can't edit, keep looking: --
"RTN","TIUGEDI1",84,0)
 . I DALKDAD,'$$CANDO^TIULP(TIUI,"EDIT RECORD") Q
"RTN","TIUGEDI1",85,0)
 . ; -- If already linked to dad & can edit, return it: --
"RTN","TIUGEDI1",86,0)
 . I DALKDAD S DA=TIUI Q
"RTN","TIUGEDI1",87,0)
 . ; -- If not already linked, return it: --
"RTN","TIUGEDI1",88,0)
 . S DA=TIUI
"RTN","TIUGEDI1",89,0)
EXISTLX ;
"RTN","TIUGEDI1",90,0)
 Q +$G(DA)
"RTN","TIUGEDIT")
0^29^B35813365
"RTN","TIUGEDIT",1,0)
TIUGEDIT ; SLC/MAM - Add New ID Entry; 4/11/01
"RTN","TIUGEDIT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUGEDIT",3,0)
 ; 3/2/00 moved GETRECG from TIUGEDIT to TIUGEDI1
"RTN","TIUGEDIT",4,0)
 ; 3/14/00 Checked XINDEX for newing vars
"RTN","TIUGEDIT",5,0)
DIE(DA,TIUQUIT) ; Invoke ^DIE
"RTN","TIUGEDIT",6,0)
 N Y,DIE,DR
"RTN","TIUGEDIT",7,0)
 S ^TIU(8925,"ASAVE",DUZ,DA)=""
"RTN","TIUGEDIT",8,0)
 S DR=$$GETTMPL^TIUEDI1(+$P(^TIU(8925,+DA,0),U))
"RTN","TIUGEDIT",9,0)
 I DR']"" W !?5,$C(7),"No Edit template defined for ",$$PNAME^TIULC1(+$P(^TIU(8925,+DA,0),U)),! S TIUQUIT=2 Q
"RTN","TIUGEDIT",10,0)
 S DIE=8925 D ^DIE
"RTN","TIUGEDIT",11,0)
 S DR=".05///undictated",DIE=8925 D ^DIE
"RTN","TIUGEDIT",12,0)
 D UPDTIRT^TIUDIRT(.TIU,DA),SEND^TIUALRT(DA)
"RTN","TIUGEDIT",13,0)
 L -^TIU(8925,+DA)
"RTN","TIUGEDIT",14,0)
 Q
"RTN","TIUGEDIT",15,0)
 ;
"RTN","TIUGEDIT",16,0)
ADDSTUB(DADDA) ; Prompt user for new stub ID entries for parent DADDA
"RTN","TIUGEDIT",17,0)
 N TIUAUTH,TIUTYP,TIUDAD,DFN,TIUDPRM,DA,TIURTYP,TIUPRMT
"RTN","TIUGEDIT",18,0)
 N X,Y,DIC
"RTN","TIUGEDIT",19,0)
 S DFN=$P(^TIU(8925,DADDA,0),U,2)
"RTN","TIUGEDIT",20,0)
 W !!,"  If you wish you may add stub interdisciplinary entries for this note:",!
"RTN","TIUGEDIT",21,0)
 F  D  Q:$G(TIUAUTH)'>0  Q:$G(TIUTYP)'>0
"RTN","TIUGEDIT",22,0)
 . K TIUTYP,TIUAUTH
"RTN","TIUGEDIT",23,0)
 . S DIC=200,DIC(0)="AEMQ",DIC("A")="Select stub AUTHOR: "
"RTN","TIUGEDIT",24,0)
 . S DIC("S")="I '+$$ISTERM^USRLM(+Y)"
"RTN","TIUGEDIT",25,0)
 . D ^DIC
"RTN","TIUGEDIT",26,0)
 . ;I Y'>0 S TIUOUT=1 Q
"RTN","TIUGEDIT",27,0)
 . Q:Y'>0
"RTN","TIUGEDIT",28,0)
 . S TIUAUTH=+Y
"RTN","TIUGEDIT",29,0)
 . ; -- Get data array TIUDAD on parent note DADDA: --
"RTN","TIUGEDIT",30,0)
 . I '$D(TIUDAD) D GETTIU^TIULD(.TIUDAD,DADDA)
"RTN","TIUGEDIT",31,0)
 . D DOCSPICK^TIULA2(.TIUTYP,3,"1A","LAST","Select stub TITLE: ","+$$CANPICK^TIULP(+Y),+$$CANENTR^TIULP(+Y),$$CANLINK^TIULP(+Y)")
"RTN","TIUGEDIT",32,0)
 . ;I +$G(TIUTYP)'>0 S TIUOUT=1 Q
"RTN","TIUGEDIT",33,0)
 . Q:+$G(TIUTYP)'>0
"RTN","TIUGEDIT",34,0)
 . S TIUTYP=+$P($G(TIUTYP(1)),U,2) ; IFN. (DOCSPICK returns TIUTYP as 1.)
"RTN","TIUGEDIT",35,0)
 . ; -- Use visit of parent: --
"RTN","TIUGEDIT",36,0)
 . M TIU=TIUDAD
"RTN","TIUGEDIT",37,0)
 . ;-- Get parameters for selected title: --
"RTN","TIUGEDIT",38,0)
 . D DOCPRM^TIULC1(TIUTYP,.TIUDPRM)
"RTN","TIUGEDIT",39,0)
 . ; --  Get DA: --
"RTN","TIUGEDIT",40,0)
 . S DA=$$CREATREC^TIUEDI3(DFN,.TIU,TIUTYP(1))
"RTN","TIUGEDIT",41,0)
 . N TIUQUIT,TIUTDA
"RTN","TIUGEDIT",42,0)
 . D DIE(DA,.TIUQUIT)
"RTN","TIUGEDIT",43,0)
 . D LINK^TIUGR2(DA,DADDA)
"RTN","TIUGEDIT",44,0)
 . W !,"  Stub entry added",!!
"RTN","TIUGEDIT",45,0)
 Q
"RTN","TIUGEDIT",46,0)
 ;
"RTN","TIUGEDIT",47,0)
ADDDAD(DADDA,ADDED) ; Create new ID entry and link it to note DADDA
"RTN","TIUGEDIT",48,0)
 ; Assumes DADDA can receive ID entries.
"RTN","TIUGEDIT",49,0)
 ; Requires DADDA = parent note
"RTN","TIUGEDIT",50,0)
 ; Requires DADLINE = parent note line number
"RTN","TIUGEDIT",51,0)
 ; Returns ADDED > 0 if new note added (may not be linked), otherwise = 0
"RTN","TIUGEDIT",52,0)
 N TITLE,TIUD0,TITLEDA,ADDING,STATUS,KIDDA
"RTN","TIUGEDIT",53,0)
 S ADDED=0
"RTN","TIUGEDIT",54,0)
 S TIUD0=$G(^TIU(8925,+DADDA,0))
"RTN","TIUGEDIT",55,0)
 S TITLEDA=+TIUD0,STATUS=$P(TIUD0,U,5),TITLE=$$PNAME^TIULC1(TITLEDA)
"RTN","TIUGEDIT",56,0)
 I STATUS<6 Q
"RTN","TIUGEDIT",57,0)
 S ADDING=$$READ^TIUU("Y","Are you adding a new interdisciplinary entry to this note","YES")
"RTN","TIUGEDIT",58,0)
 I 'ADDING D  Q
"RTN","TIUGEDIT",59,0)
 . W !!,"This note appears to be an ID parent.  Please select the note"
"RTN","TIUGEDIT",60,0)
 . W !,"you want to attach to this note FIRST, or check with IRM"
"RTN","TIUGEDIT",61,0)
 . W !,"or your clinical coordinator."
"RTN","TIUGEDIT",62,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUGEDIT",63,0)
 D CLEAR^VALM1 W !!,"Adding a new interdisciplinary entry to",!,TITLE
"RTN","TIUGEDIT",64,0)
 D FULL^VALM1
"RTN","TIUGEDIT",65,0)
 D ADDDAD1(DADDA,.KIDDA)
"RTN","TIUGEDIT",66,0)
 I $G(KIDDA) S ADDED=1 D:$D(^TMP("TIUR",$J)) UPIDDATA^TIURL1(DADDA),UPIDDATA^TIURL1(KIDDA)
"RTN","TIUGEDIT",67,0)
 Q
"RTN","TIUGEDIT",68,0)
 ;
"RTN","TIUGEDIT",69,0)
ADDDAD1(DADDA,DA) ; Enter one new ID Document and link it to DADDA
"RTN","TIUGEDIT",70,0)
 ; Call with:
"RTN","TIUGEDIT",71,0)
 ; [DADDA] --> IFN of note new note will be added to,
"RTN","TIUGEDIT",72,0)
 ;             i.e. parent note. Required.
"RTN","TIUGEDIT",73,0)
 ;    [DA] --> IFN of new note or 0 if not created.  Passed back.
"RTN","TIUGEDIT",74,0)
 N LINKTL,TIUVSUPP,TIULMETH,TIU,TIUVMETH,TIUOUT,TIUASK,TIUDAD
"RTN","TIUGEDIT",75,0)
 N TIUNEW,TIU,TIUTYP,DFN,EDIT,TIUCMMTX,TIUDPRM,TIUEXIT,CONTINUE
"RTN","TIUGEDIT",76,0)
 N TIUQUIT
"RTN","TIUGEDIT",77,0)
 S DA=0
"RTN","TIUGEDIT",78,0)
 ; -- Get data array TIUDAD on parent note DADDA: --
"RTN","TIUGEDIT",79,0)
 D GETTIU^TIULD(.TIUDAD,DADDA)
"RTN","TIUGEDIT",80,0)
 S DFN=$P(^TIU(8925,DADDA,0),U,2)
"RTN","TIUGEDIT",81,0)
 ; -- Get new title from user.
"RTN","TIUGEDIT",82,0)
 ;    Set info into array TIUTYP where
"RTN","TIUGEDIT",83,0)
 ;          TIUTYP = title DA
"RTN","TIUGEDIT",84,0)
 ;       TIUTYP(1) = 1^title DA^Name...
"RTN","TIUGEDIT",85,0)
TITLE ; -- Get title.  Limit titles to those user can link, at least
"RTN","TIUGEDIT",86,0)
 ;for SOME status.  Check again later after we know the status.
"RTN","TIUGEDIT",87,0)
 W !!,"Please select a title for your entry:"
"RTN","TIUGEDIT",88,0)
 D DOCSPICK^TIULA2(.TIUTYP,3,"1A","LAST","","+$$CANPICK^TIULP(+Y),+$$CANENTR^TIULP(+Y),$$CANLINK^TIULP(+Y)")
"RTN","TIUGEDIT",89,0)
 I +$G(TIUTYP)'>0 S TIUOUT=1 Q
"RTN","TIUGEDIT",90,0)
 S TIUTYP=+$P($G(TIUTYP(1)),U,2) ; IFN. (DOCSPICK returns TIUTYP as 1.)
"RTN","TIUGEDIT",91,0)
VISIT ; -- Get visit (use same visit as first entry unless visit
"RTN","TIUGEDIT",92,0)
 ;must be an historical event and parent visit is not hist): --
"RTN","TIUGEDIT",93,0)
 S TIUVSUPP=+$$SUPPVSIT^TIULC1(TIUTYP)
"RTN","TIUGEDIT",94,0)
 I TIUVSUPP,$P(TIUDAD("VSTR"),";",3)'="E" D EVENT^TIUSRVP1(.TIU,DFN) I 1
"RTN","TIUGEDIT",95,0)
 E  M TIU=TIUDAD
"RTN","TIUGEDIT",96,0)
VALID ; -- Validate, i.e. ask user if OK: --
"RTN","TIUGEDIT",97,0)
 S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYP)
"RTN","TIUGEDIT",98,0)
 I '$L(TIUVMETH) D  S TIUOUT=1 Q
"RTN","TIUGEDIT",99,0)
 . W !,$C(7),"No Validation Method defined for "
"RTN","TIUGEDIT",100,0)
 . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUGEDIT",101,0)
 ; -- Ask user if proposed docmt looks OK.
"RTN","TIUGEDIT",102,0)
 ;    May change array TIU, gets user answer in TIUASK: --
"RTN","TIUGEDIT",103,0)
 K TIU("REFDT") ; for new ID child, want default = NOW. See TIULD
"RTN","TIUGEDIT",104,0)
 X TIUVMETH
"RTN","TIUGEDIT",105,0)
 I '$D(TIU("VSTR")) D  Q
"RTN","TIUGEDIT",106,0)
 . W !,$C(7),"Patient & Visit required." H 2
"RTN","TIUGEDIT",107,0)
 ; -- Go on if user answers says OK: --
"RTN","TIUGEDIT",108,0)
 Q:'TIUASK
"RTN","TIUGEDIT",109,0)
 ;-- Get parameters for selected title: --
"RTN","TIUGEDIT",110,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM)
"RTN","TIUGEDIT",111,0)
 ; --  Get DA: new docmt for user to continue entering, or
"RTN","TIUGEDIT",112,0)
 ;     existing docmt for user to edit, or existing docmt for
"RTN","TIUGEDIT",113,0)
 ;     user to link w/o editing since they may not edit it: --
"RTN","TIUGEDIT",114,0)
 S DA=$$GETRECG^TIUGEDI1(DFN,.TIU,.TIUTYP,.TIUDPRM,.TIUNEW,.EDIT,DADDA)
"RTN","TIUGEDIT",115,0)
 I 'DA S VALMSG="** No entry added **" Q
"RTN","TIUGEDIT",116,0)
 ; -- If user is attaching an existing docmt they may not edit,
"RTN","TIUGEDIT",117,0)
 ;    try to attach, and quit: --
"RTN","TIUGEDIT",118,0)
 I 'TIUNEW,'EDIT D TRYLINK(DA,DADDA,.TIUDAD) H 2 Q
"RTN","TIUGEDIT",119,0)
 ; -- Edit new or existing DA: --
"RTN","TIUGEDIT",120,0)
 N TIUQUIT,TIUTDA
"RTN","TIUGEDIT",121,0)
 D DIE^TIUEDI4(DA,.TIUQUIT)
"RTN","TIUGEDIT",122,0)
 Q:'$G(^TIU(8925,DA,0))  ; uparrow w/ bad docmt, already deleted
"RTN","TIUGEDIT",123,0)
 I $$EMPTYDOC^TIULF(DA) D DELETE^TIUEDIT(DA,0) S:$G(VALMAR)="^TMP(""TIUVIEW"",$J)" VALMBCK="Q" S:'TIUNEW TIUCHNG("DELETE")=1 H:'TIUNEW 2 Q
"RTN","TIUGEDIT",124,0)
 I +$G(TIUQUIT),'EDIT W !,"Document not attached" H 2 Q
"RTN","TIUGEDIT",125,0)
 ; -- Misc after-edit-stuff for DA --
"RTN","TIUGEDIT",126,0)
 I +$G(TIU("STOP")),(+$P($G(TIUDPRM(0)),U,14)'=1) D DEFER^TIUVSIT(DA,TIU("STOP")) I 1 ; Stop code: For stand alones, mark to get work load at signature
"RTN","TIUGEDIT",127,0)
 E  D QUE^TIUPXAP1 ; Post workload now in background
"RTN","TIUGEDIT",128,0)
 S TIUCMMTX=$$COMMIT^TIULC1(TIUTYP)
"RTN","TIUGEDIT",129,0)
 I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUGEDIT",130,0)
 D RELEASE^TIUT(DA)
"RTN","TIUGEDIT",131,0)
 D VERIFY^TIUT(DA)
"RTN","TIUGEDIT",132,0)
 ; -- If get this far without quitting, attach entry,
"RTN","TIUGEDIT",133,0)
 ;    new or existing, so auto-print prints whole note:
"RTN","TIUGEDIT",134,0)
 D LINK^TIUGR2(DA,DADDA) S VALMSG="** Entry attached **"
"RTN","TIUGEDIT",135,0)
 ; -- Get signature
"RTN","TIUGEDIT",136,0)
 D EDSIG^TIURS(DA) ;does auto-print
"RTN","TIUGEDIT",137,0)
 ; -- execute EXIT ACTION --
"RTN","TIUGEDIT",138,0)
 S TIUEXIT=$$GETEXIT^TIUEDI2(TIUTYP)
"RTN","TIUGEDIT",139,0)
 I $L(TIUEXIT) S TIUTDA=DA X TIUEXIT S DA=TIUTDA
"RTN","TIUGEDIT",140,0)
 ;I '$G(^TIU(8925,DA,21)) D TRYLINK(DA,DADDA,.TIUDAD)
"RTN","TIUGEDIT",141,0)
 ; --  [Prompt to print DA] --
"RTN","TIUGEDIT",142,0)
 I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(DA)
"RTN","TIUGEDIT",143,0)
 Q
"RTN","TIUGEDIT",144,0)
 ;
"RTN","TIUGEDIT",145,0)
TRYLINK(DA,DADDA,TIUDAD) ; Check specific docmt now that we know
"RTN","TIUGEDIT",146,0)
 ;its status, to see if user can attach it to an ID note; if so,
"RTN","TIUGEDIT",147,0)
 ;attach DA to DADDA.
"RTN","TIUGEDIT",148,0)
 ; Already know that DADDA can receive ID entries.
"RTN","TIUGEDIT",149,0)
 ;4/11/01 not currently used
"RTN","TIUGEDIT",150,0)
 N CANLINK
"RTN","TIUGEDIT",151,0)
 S CANLINK=$$CANDO^TIULP(DA,"ATTACH TO ID NOTE")
"RTN","TIUGEDIT",152,0)
 I 'CANLINK D  Q
"RTN","TIUGEDIT",153,0)
 . W !!,$P(CANLINK,U,2),!," Entry saved as a stand-alone note.  Please attach it later if you are",!," authorized to do so."
"RTN","TIUGEDIT",154,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUGEDIT",155,0)
 . I $D(DUOUT)!$D(DTOUT)!$D(DIROUT) S TIUQUIT=1
"RTN","TIUGEDIT",156,0)
 . S VALMSG="** Entry saved as a stand-alone note **"
"RTN","TIUGEDIT",157,0)
 D LINK^TIUGR2(DA,DADDA)
"RTN","TIUGEDIT",158,0)
 W !!,"Entry added to ",$P(TIUDAD("DOCTYP"),U,2)
"RTN","TIUGEDIT",159,0)
 S VALMSG="** Entry attached **"
"RTN","TIUGEDIT",160,0)
 Q
"RTN","TIUGEDIT",161,0)
 ;
"RTN","TIUGR")
0^26^B21432467
"RTN","TIUGR",1,0)
TIUGR ; SLC/MAM - ID Note Review Screen Actions ; IDNOTE; 4/12/01
"RTN","TIUGR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUGR",3,0)
 ;
"RTN","TIUGR",4,0)
IDNOTE ; Review Screen Action IN Interdisciplinary Note
"RTN","TIUGR",5,0)
 ;If editing this module, please keep TIUGR1 consistent with it.
"RTN","TIUGR",6,0)
 ; -- Sets TIUGLINK if user starts attaching
"RTN","TIUGR",7,0)
 ;    the note to an existing note: --
"RTN","TIUGR",8,0)
 ;     TIUGLINK = IFN of ID entry^Lineno^Title.
"RTN","TIUGR",9,0)
 ;     (If ID entry is chosen via browse instead of review, Lineno=0)
"RTN","TIUGR",10,0)
 N LINENO,NTDATA,NTDA,ADDED,TIUQUIT,TITLE,TITLEDA
"RTN","TIUGR",11,0)
 N CANATT,CANADD,PDOCTYP,TIUCHNG,LNO
"RTN","TIUGR",12,0)
 N TIUDAARY,DETACHED,TIUACT,TIULST,TIUIDDAD
"RTN","TIUGR",13,0)
 ; -- If user has already selected note to attach, but not note
"RTN","TIUGR",14,0)
 ;    to attach it to, write msg and quit: --
"RTN","TIUGR",15,0)
 ;I $G(TIUGLINK) D ATTCHMSG(TIUGLINK) S TIUQUIT=1 G IDNOTEX
"RTN","TIUGR",16,0)
 ; -- If user has already selected note to attach, but not note
"RTN","TIUGR",17,0)
 ;    to attach it to, and reselects IN, quit attach action: --
"RTN","TIUGR",18,0)
 I $G(TIUGLINK) D LINKQUIT^TIUGR2 S TIUQUIT=1 G IDNOTEX
"RTN","TIUGR",19,0)
 ; -- Select note to act on, if not already selected: --
"RTN","TIUGR",20,0)
 I '$D(VALMY) D  I $G(TIUQUIT) G IDNOTEX
"RTN","TIUGR",21,0)
 . I $P($G(XQORNOD(0)),U,4)'["=" D
"RTN","TIUGR",22,0)
 . . W !!,"  To ADD a new entry to an interdisciplinary note, please select the",!,"interdisciplinary note."
"RTN","TIUGR",23,0)
 . . W !,"  To ATTACH an existing stand-alone note to an interdisciplinary note,",!,"please select the note you want to attach."
"RTN","TIUGR",24,0)
 . D EN^VALM2(XQORNOD(0),"S") S LINENO=+$O(VALMY(0))
"RTN","TIUGR",25,0)
 . I 'LINENO S TIUQUIT=1 Q
"RTN","TIUGR",26,0)
 . ; -- Reverse video selected note: --
"RTN","TIUGR",27,0)
 . D RESTORE^VALM10(LINENO),CNTRL^VALM10(LINENO,6,VALM("RM"),IORVON,IORVOFF),WRITE^VALM10(LINENO)
"RTN","TIUGR",28,0)
 ; -- In case note was already selected: --
"RTN","TIUGR",29,0)
 S LINENO=+$O(VALMY(0))
"RTN","TIUGR",30,0)
 ; -- Set notedata NTDATA = lineno^IFN^? --
"RTN","TIUGR",31,0)
 S NTDATA=$G(^TMP("TIURIDX",$J,LINENO))
"RTN","TIUGR",32,0)
 S NTDA=+$P(NTDATA,U,2)
"RTN","TIUGR",33,0)
 I '$D(^TIU(8925,+NTDA,0)) S TIUCHNG("REFRESH")=1,TIUQUIT=1 G IDNOTEX
"RTN","TIUGR",34,0)
 S TITLE=$$DOCTYPE^TIULF(NTDA)
"RTN","TIUGR",35,0)
 I $O(VALMY(LINENO)) D
"RTN","TIUGR",36,0)
 . W !!,"Notes must be selected one at a time for interdisciplinary"
"RTN","TIUGR",37,0)
 . W !,"note actions.  Acting on your FIRST selection,"
"RTN","TIUGR",38,0)
 . W !?3,$P(TITLE,U,2) H 5
"RTN","TIUGR",39,0)
 . S LNO=LINENO F  S LNO=$O(VALMY(LNO)) Q:'LNO  D
"RTN","TIUGR",40,0)
 . . D RESTORE^VALM10(LNO)
"RTN","TIUGR",41,0)
 . . D WRITE^VALM10(LNO)
"RTN","TIUGR",42,0)
 . . K VALMY(LNO)
"RTN","TIUGR",43,0)
 ; -- If note is addendum, CWAD, or consult result,
"RTN","TIUGR",44,0)
 ;    user can't detach/attach it or add new entry to it.
"RTN","TIUGR",45,0)
 ;    Say so & quit: --
"RTN","TIUGR",46,0)
 I +^TIU(8925,+NTDA,0)=81 D CANT("A") S TIUCHNG("REFRESH")=1 G IDNOTEX
"RTN","TIUGR",47,0)
 S PDOCTYP=$P(^TIU(8925,+NTDA,0),U,4)
"RTN","TIUGR",48,0)
 I (PDOCTYP=27)!(PDOCTYP=25)!(PDOCTYP=31)!(PDOCTYP=30) D  G IDNOTEX
"RTN","TIUGR",49,0)
 . D CANT("CWAD") S TIUCHNG("REFRESH")=1
"RTN","TIUGR",50,0)
 I $P($G(^TIU(8925,+NTDA,14)),U,5) D  G IDNOTEX
"RTN","TIUGR",51,0)
 . D CANT("CR") S TIUCHNG("REFRESH")=1
"RTN","TIUGR",52,0)
 ; -- If note is already an entry of an ID note, unlink it: --
"RTN","TIUGR",53,0)
 S TIUIDDAD=$$HASIDDAD^TIUGBR(NTDA)
"RTN","TIUGR",54,0)
 I TIUIDDAD D  G IDNOTEX
"RTN","TIUGR",55,0)
 . S TIUACT="DETACHED",TIUDAARY(LINENO)=NTDA
"RTN","TIUGR",56,0)
 . D UNLKKID^TIUGR1(NTDA,TIUIDDAD,.DETACHED)
"RTN","TIUGR",57,0)
 . I '$G(DETACHED) S TIUCHNG("REFRESH")=1,TIULST="" Q
"RTN","TIUGR",58,0)
 . S TIUCHNG("RBLD")=1,TIULST=LINENO
"RTN","TIUGR",59,0)
 ; -- If user can add an entry to the note, do it & quit: --
"RTN","TIUGR",60,0)
 S CANADD=$$CANDO^TIULP(NTDA,"ATTACH ID ENTRY")
"RTN","TIUGR",61,0)
 I CANADD D  G IDNOTEX
"RTN","TIUGR",62,0)
 . D ADDDAD^TIUGEDIT(NTDA,.ADDED)
"RTN","TIUGR",63,0)
 . I 'ADDED S TIUCHNG("REFRESH")=1 Q
"RTN","TIUGR",64,0)
 . S TIUCHNG("RBLD")=1
"RTN","TIUGR",65,0)
 ; -- If user can't add entry to note, & attaching note to
"RTN","TIUGR",66,0)
 ;    an existing note is not permitted, say can't add & quit: --
"RTN","TIUGR",67,0)
 ;    -- Note itself has entries: --
"RTN","TIUGR",68,0)
 I 'CANADD,$$HASIDKID^TIUGBR(NTDA) D  G IDNOTEX
"RTN","TIUGR",69,0)
 . W !!,$P(CANADD,U,2) D PAUSE S TIUCHNG("REFRESH")=1
"RTN","TIUGR",70,0)
 ;    -- Note is a possible parent: --
"RTN","TIUGR",71,0)
 S TITLEDA=+^TIU(8925,NTDA,0)
"RTN","TIUGR",72,0)
 I 'CANADD,$$POSSPRNT^TIULP(TITLEDA) D  G IDNOTEX
"RTN","TIUGR",73,0)
 . W !!,$P(CANADD,U,2) D PAUSE S TIUCHNG("REFRESH")=1
"RTN","TIUGR",74,0)
 ; -- See if user can attach note to an existing note: --
"RTN","TIUGR",75,0)
 S CANATT=$$CANDO^TIULP(NTDA,"ATTACH TO ID NOTE")
"RTN","TIUGR",76,0)
 ;    -- If user can attach note, set TIUGLINK,
"RTN","TIUGR",77,0)
 ;       write "Attaching...", and quit: --
"RTN","TIUGR",78,0)
 I CANATT D  G IDNOTEX
"RTN","TIUGR",79,0)
 . S TIUGLINK=NTDA_U_LINENO_U_$P(TITLE,U,2)
"RTN","TIUGR",80,0)
 . D ATTCHMSG(TIUGLINK) ; User is mid-attach, don't set TIUCHNG
"RTN","TIUGR",81,0)
 ;    -- If user can't attach, say can't attach, and quit
"RTN","TIUGR",82,0)
 I 'CANATT D
"RTN","TIUGR",83,0)
 . W !!,$P(CANATT,U,2) D PAUSE
"RTN","TIUGR",84,0)
 . S TIUCHNG("REFRESH")=1
"RTN","TIUGR",85,0)
IDNOTEX ; Restore video for selected line and refresh/update/rebuild list:
"RTN","TIUGR",86,0)
 I $G(TIUCHNG("REFRESH"))!$G(TIUCHNG("UPDATE"))!$G(TIUCHNG("RBLD")) D
"RTN","TIUGR",87,0)
 . S VALMY(LINENO)=""
"RTN","TIUGR",88,0)
 . D UPRBLD^TIURL(.TIUCHNG,.VALMY)
"RTN","TIUGR",89,0)
 S VALMBCK="R" K VALMY
"RTN","TIUGR",90,0)
 I $G(TIUACT)="DETACHED" D VMSG^TIURS1(TIULST,.TIUDAARY,"DETACHED")
"RTN","TIUGR",91,0)
 Q
"RTN","TIUGR",92,0)
 ;
"RTN","TIUGR",93,0)
PAUSE ;Wait til user hits return
"RTN","TIUGR",94,0)
 I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUGR",95,0)
 Q
"RTN","TIUGR",96,0)
 ;
"RTN","TIUGR",97,0)
CANT(TYPE) ; Tell user they can't act on addendum, CWAD, or
"RTN","TIUGR",98,0)
 ;Consult result
"RTN","TIUGR",99,0)
 I TYPE="A" D
"RTN","TIUGR",100,0)
 . W !!,"  An addendum is linked to its parent when it is first made and"
"RTN","TIUGR",101,0)
 . W !,"cannot be attached or detached like an interdisciplinary note."
"RTN","TIUGR",102,0)
 . W !,"To add an addendum to a note, use action 'Make Addendum.'"
"RTN","TIUGR",103,0)
 I TYPE="CWAD" D
"RTN","TIUGR",104,0)
 . W !!,"  CWAD notes cannot be used as interdisciplinary notes."
"RTN","TIUGR",105,0)
 I TYPE="CR" D
"RTN","TIUGR",106,0)
 . W !!,"  Consult results cannot be used as interdisciplinary notes."
"RTN","TIUGR",107,0)
 D PAUSE
"RTN","TIUGR",108,0)
 Q
"RTN","TIUGR",109,0)
 ;
"RTN","TIUGR",110,0)
ATTCHMSG(KIDDATA) ; Offer instructions when user has selected
"RTN","TIUGR",111,0)
 ;the note to attach but not the note to attach it to.
"RTN","TIUGR",112,0)
 W !!,"  Attaching ",$P(KIDDATA,U,3),"."
"RTN","TIUGR",113,0)
 W !,"  Please select the note you want to attach it to."
"RTN","TIUGR",114,0)
 W !,"  Or, reselect action IN if you no longer wish to attach the note."
"RTN","TIUGR",115,0)
 I $$READ^TIUU("EA","Press RETURN when you have finished reading this message...")
"RTN","TIUGR",116,0)
 Q
"RTN","TIUGR",117,0)
 ;
"RTN","TIUGR1")
0^27^B13839553
"RTN","TIUGR1",1,0)
TIUGR1 ; SLC/MAM - More ID Note Review Screen Actions ;4/12/01
"RTN","TIUGR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUGR1",3,0)
 ;
"RTN","TIUGR1",4,0)
IDNOTEB(TIUDA) ; Browse Screen Action IN Interdisciplinary Note
"RTN","TIUGR1",5,0)
 ; Requires TIUDA
"RTN","TIUGR1",6,0)
 ; If editing this module, please keep TIUGR consistent with it.
"RTN","TIUGR1",7,0)
 N TITLE,PREFIX,TITLEDA,CANADD,CANATT,ADDED,TIUQUIT,TIUIDDAD
"RTN","TIUGR1",8,0)
 ;TIUCHNG is newed in TIURA2; Don't new it here
"RTN","TIUGR1",9,0)
 S VALMBCK="R"
"RTN","TIUGR1",10,0)
 ; -- If note is addendum, can't attach; say so & quit: --
"RTN","TIUGR1",11,0)
 I +^TIU(8925,TIUDA,0)=81 D  G IDNOTEBX
"RTN","TIUGR1",12,0)
 . D CANT^TIUGR("A") S TIUCHNG("REFRESH")=1
"RTN","TIUGR1",13,0)
 ; -- If note is already an entry of an ID note, unlink it: --
"RTN","TIUGR1",14,0)
 S TIUIDDAD=$$HASIDDAD^TIUGBR(TIUDA)
"RTN","TIUGR1",15,0)
 I TIUIDDAD D  G IDNOTEBX
"RTN","TIUGR1",16,0)
 . D UNLKKID(TIUDA,TIUIDDAD)
"RTN","TIUGR1",17,0)
 . I $G(TIUQUIT) S TIUCHNG("REFRESH")=1 Q
"RTN","TIUGR1",18,0)
 . S TIUCHNG("RBLD")=1
"RTN","TIUGR1",19,0)
 . K VALMHDR ; TIUDA is no longer an ID entry so update header
"RTN","TIUGR1",20,0)
 ; -- If user can add an entry to the note, do it & quit: --
"RTN","TIUGR1",21,0)
 S CANADD=$$CANDO^TIULP(TIUDA,"ATTACH ID ENTRY")
"RTN","TIUGR1",22,0)
 I CANADD D ADDDAD^TIUGEDIT(TIUDA,.ADDED) D  G IDNOTEBX
"RTN","TIUGR1",23,0)
 . I 'ADDED S TIUCHNG("REFRESH")=1 Q
"RTN","TIUGR1",24,0)
 . S TIUCHNG("RBLD")=1 K VALMHDR
"RTN","TIUGR1",25,0)
 ; -- If user can't add entry to note, & attaching note to
"RTN","TIUGR1",26,0)
 ;    an existing note is not permitted, say can't add & quit: --
"RTN","TIUGR1",27,0)
 ;    -- Note itself has entries: --
"RTN","TIUGR1",28,0)
 I 'CANADD,$$HASIDKID^TIUGBR(TIUDA) D  G IDNOTEBX
"RTN","TIUGR1",29,0)
 . W !!,$P(CANADD,U,2) D PAUSE^TIUGR
"RTN","TIUGR1",30,0)
 . S TIUCHNG("REFRESH")=1
"RTN","TIUGR1",31,0)
 ;    -- Note is a possible parent: --
"RTN","TIUGR1",32,0)
 S TITLEDA=+^TIU(8925,TIUDA,0)
"RTN","TIUGR1",33,0)
 I 'CANADD,$$POSSPRNT^TIULP(TITLEDA) D  G IDNOTEBX
"RTN","TIUGR1",34,0)
 . W !!,$P(CANADD,U,2) D PAUSE^TIUGR
"RTN","TIUGR1",35,0)
 . S TIUCHNG("REFRESH")=1
"RTN","TIUGR1",36,0)
 ; -- See if user can attach note to an existing note: --
"RTN","TIUGR1",37,0)
 S CANATT=$$CANDO^TIULP(TIUDA,"ATTACH TO ID NOTE")
"RTN","TIUGR1",38,0)
 ; -- If user can attach, tell user not to use Browse:
"RTN","TIUGR1",39,0)
 I CANATT W !!,"To attach this note to an ID parent, please exit Browse and try again ",!,"from a Review Screen showing a list of notes.",! H 5 S TIUCHNG("REFRESH")=1 G IDNOTEBX
"RTN","TIUGR1",40,0)
 ;    -- If user can't attach, say can't attach: --
"RTN","TIUGR1",41,0)
 I 'CANATT W !!,$P(CANATT,U,2) D PAUSE^TIUGR S TIUCHNG("REFRESH")=1
"RTN","TIUGR1",42,0)
IDNOTEBX ;
"RTN","TIUGR1",43,0)
 ; -- Rebuild browse screen for updated record: --
"RTN","TIUGR1",44,0)
 ;    (Review screen is updated from BROWSE^TIURA2)
"RTN","TIUGR1",45,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA) ;may have changed
"RTN","TIUGR1",46,0)
 D BLDTMP^TIUBR(TIUDA)
"RTN","TIUGR1",47,0)
 Q
"RTN","TIUGR1",48,0)
 ;
"RTN","TIUGR1",49,0)
UNLKKID(KIDDA,TIUIDDAD,DETACHED) ; Unlink ID entry
"RTN","TIUGR1",50,0)
 ; Check if user can unlink, and if so, unlink it.
"RTN","TIUGR1",51,0)
 N CANUNLK,UNLINK,MSG,DADDA,TIUQUIT
"RTN","TIUGR1",52,0)
 S DETACHED=0
"RTN","TIUGR1",53,0)
 W !!,"This note is attached to an interdisciplinary note."
"RTN","TIUGR1",54,0)
 ; -- Same users can unlink as can link: --
"RTN","TIUGR1",55,0)
 S CANUNLK=$$CANDO^TIULP(KIDDA,"ATTACH TO ID NOTE")
"RTN","TIUGR1",56,0)
 I CANUNLK S CANUNLK=$$CANDO^TIULP(TIUIDDAD,"ATTACH ID ENTRY")
"RTN","TIUGR1",57,0)
 I 'CANUNLK D  G UNLKKIDX
"RTN","TIUGR1",58,0)
 . ;S MSG=$P(CANUNLK,U,2),MSG=$P(MSG,"You may not ATTACH this",2)
"RTN","TIUGR1",59,0)
 . ;S MSG=$P(MSG,"to an ID note."),MSG=" You may not DETACH this"_MSG
"RTN","TIUGR1",60,0)
 . W !,"You may not detach this note from its interdisciplinary note."
"RTN","TIUGR1",61,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUGR1",62,0)
 . S TIUQUIT=1
"RTN","TIUGR1",63,0)
 S UNLINK=$$READ^TIUU("Y","Do you want to detach it","NO")
"RTN","TIUGR1",64,0)
 I 'UNLINK W !!,"Entry not detached." H 1 S TIUQUIT=1 G UNLKKIDX
"RTN","TIUGR1",65,0)
 S DADDA=$P($G(^TMP("TIUR",$J,"IDDATA",KIDDA)),U,3)
"RTN","TIUGR1",66,0)
 D UNLINK(KIDDA)
"RTN","TIUGR1",67,0)
 I DADDA D UPIDDATA^TIURL1(KIDDA),UPIDDATA^TIURL1(DADDA)
"RTN","TIUGR1",68,0)
 W !!,"Entry detached." H 1
"RTN","TIUGR1",69,0)
 ;S VALMSG="** Entry detached **" ;4/9/01
"RTN","TIUGR1",70,0)
 S TIUCHNG("RBLD")=1,DETACHED=1 ;4/9/01
"RTN","TIUGR1",71,0)
UNLKKIDX ;
"RTN","TIUGR1",72,0)
 ;I $G(TIUQUIT) S VALMSG="** Entry not detached **",TIUCHNG("REFRESH")=1 Q  ;4/9/01
"RTN","TIUGR1",73,0)
 I $G(TIUQUIT) S TIUCHNG("REFRESH")=1 Q  ;4/9/01
"RTN","TIUGR1",74,0)
 Q
"RTN","TIUGR1",75,0)
 ;
"RTN","TIUGR1",76,0)
UNLINK(DA) ; Unlink DA from DADDA
"RTN","TIUGR1",77,0)
 N DIE,DR,IDDAD
"RTN","TIUGR1",78,0)
 S IDDAD=+$G(^TIU(8925,DA,21))
"RTN","TIUGR1",79,0)
 S DIE=8925,DR="2101////@"
"RTN","TIUGR1",80,0)
 D ^DIE
"RTN","TIUGR1",81,0)
 D AUDLINK(DA,"d",IDDAD)
"RTN","TIUGR1",82,0)
 D IDDEL^TIUALRT1(DA)
"RTN","TIUGR1",83,0)
 Q
"RTN","TIUGR1",84,0)
AUDLINK(TIUDA,ACTION,IDPARENT) ; Audit Attach/Detach Events
"RTN","TIUGR1",85,0)
 N DIC,DIE,DA,DR,X,Y,TIUD0,TIUD21,DLAYGO
"RTN","TIUGR1",86,0)
 Q:$G(ACTION)']""!(+$G(IDPARENT)'>0)
"RTN","TIUGR1",87,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUGR1",88,0)
 S X=""""_"`"_TIUDA_"""",(DIC,DLAYGO)=8925.5,DIC(0)="FLX" D ^DIC Q:+Y'>0
"RTN","TIUGR1",89,0)
 S DA=+Y,DIE=DIC
"RTN","TIUGR1",90,0)
 S DR="3.01////"_ACTION_";3.02////"_$$NOW^XLFDT
"RTN","TIUGR1",91,0)
 S DR=DR_";3.03////"_DUZ_";3.04////"_$P(TIUD0,U,5)
"RTN","TIUGR1",92,0)
 S DR=DR_";3.05////"_IDPARENT
"RTN","TIUGR1",93,0)
 D ^DIE
"RTN","TIUGR1",94,0)
 Q
"RTN","TIUGR2")
0^56^B8612903
"RTN","TIUGR2",1,0)
TIUGR2 ; SLC/MAM - ID Note Review Screen Actions ;2/28/01
"RTN","TIUGR2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUGR2",3,0)
 ;
"RTN","TIUGR2",4,0)
LKDAD(KIDDATA) ; Select DAD ID note to attach KID to, and attach it.
"RTN","TIUGR2",5,0)
 ; Called by PICK^TIULM when user selects line at action prompt
"RTN","TIUGR2",6,0)
 ;when TIUGLINK exists.  Needs $0(VALMY(0)).
"RTN","TIUGR2",7,0)
 ; KIDDATA = TIUGLINK = DA^lineno^titlename for entry being attached,
"RTN","TIUGR2",8,0)
 ;                      where lineno = 0 if not in current screen
"RTN","TIUGR2",9,0)
 N LINENO,CANLINK2,DADDATA,DADDA,DADTL,CONTINUE,LINKED
"RTN","TIUGR2",10,0)
 N TIUI,PDOCTYP,TIUCHNG
"RTN","TIUGR2",11,0)
 S LINKED=0
"RTN","TIUGR2",12,0)
 S LINENO=+$O(VALMY(0))
"RTN","TIUGR2",13,0)
 S DADDATA=$G(^TMP("TIURIDX",$J,LINENO))
"RTN","TIUGR2",14,0)
 S DADDA=+$P(DADDATA,U,2)
"RTN","TIUGR2",15,0)
 I '$D(^TIU(8925,+DADDA,0)) G LKDADX
"RTN","TIUGR2",16,0)
 ; -- Set can't attach msg:
"RTN","TIUGR2",17,0)
 I +^TIU(8925,+DADDA,0)=81 S CANLINK2="0^You cannot attach ID entries to addenda."
"RTN","TIUGR2",18,0)
 S PDOCTYP=$P(^TIU(8925,+DADDA,0),U,4)
"RTN","TIUGR2",19,0)
 I (PDOCTYP=27)!(PDOCTYP=25)!(PDOCTYP=31)!(PDOCTYP=30) S CANLINK2="0^You cannot attach ID entries to CWAD notes."
"RTN","TIUGR2",20,0)
 I $P(^TIU(8925,+DADDA,14),U,5) S CANLINK2="0^You cannot attach ID entries to consult results."
"RTN","TIUGR2",21,0)
 I '$D(CANLINK2) S CANLINK2=$$CANDO^TIULP(DADDA,"ATTACH ID ENTRY")
"RTN","TIUGR2",22,0)
 I CANLINK2 D
"RTN","TIUGR2",23,0)
 . Q:($P(^TIU(8925,DADDA,0),U,2)=$P(^TIU(8925,+KIDDATA,0),U,2))
"RTN","TIUGR2",24,0)
 . S $P(CANLINK2,U,2)="You cannot attach these notes; they do not have the same patient."
"RTN","TIUGR2",25,0)
 . S $P(CANLINK2,U)=0
"RTN","TIUGR2",26,0)
 ; -- Tell user they can't attach, and quit:
"RTN","TIUGR2",27,0)
 I 'CANLINK2 D  G LKDADX
"RTN","TIUGR2",28,0)
 . W !!,"  ",$P(CANLINK2,U,2),!
"RTN","TIUGR2",29,0)
 . W "Please reselect the child and choose a different parent."
"RTN","TIUGR2",30,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUGR2",31,0)
 ; -- Attach:
"RTN","TIUGR2",32,0)
 S DADTL=$P($$DOCTYPE^TIULF(DADDA),U,2)
"RTN","TIUGR2",33,0)
 W !!,"  Attaching ",$P(KIDDATA,U,3)," to ",!,DADTL,"."
"RTN","TIUGR2",34,0)
 S CONTINUE=$$READ^TIUU("Y","  Are you sure","YES")
"RTN","TIUGR2",35,0)
 I 'CONTINUE!$D(DUOUT)!$D(DTOUT)!$D(DIROUT) G LKDADX
"RTN","TIUGR2",36,0)
 S LINKED=1
"RTN","TIUGR2",37,0)
 D LINK(+TIUGLINK,DADDA)
"RTN","TIUGR2",38,0)
 I $L(DADTL)>26 S DADTL=$E(DADTL,1,26)
"RTN","TIUGR2",39,0)
LKDADX ; Exit
"RTN","TIUGR2",40,0)
 ; -- Restore video for KID line if kid is in current screen:
"RTN","TIUGR2",41,0)
 I $P(KIDDATA,U,2) D RESTORE^VALM10($P(KIDDATA,U,2))
"RTN","TIUGR2",42,0)
 ; -- Set msgbar, UPRBLD parameter:
"RTN","TIUGR2",43,0)
 I 'LINKED S VALMSG="** Note not attached **",TIUCHNG("REFRESH")=1
"RTN","TIUGR2",44,0)
 I LINKED S VALMSG="** Note attached to "_DADTL_" **",TIUCHNG("RBLD")=1
"RTN","TIUGR2",45,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) ;don't K VALMY - done in PICK^TIULM
"RTN","TIUGR2",46,0)
 S VALMBCK="R" K TIUGLINK
"RTN","TIUGR2",47,0)
 Q
"RTN","TIUGR2",48,0)
 ;
"RTN","TIUGR2",49,0)
LINKMSG(TIUGLINK) ; Returns VALMSG displayed after LKKID.
"RTN","TIUGR2",50,0)
 ;Used in ENTRY ACTION of protocol TIU ACTION MENU OE/RR.
"RTN","TIUGR2",51,0)
 ; Can't just set VALMSG in LKKID because it gets overwritten by ENTRY
"RTN","TIUGR2",52,0)
 ;ACTION if user selects item number as independent List Manager action.
"RTN","TIUGR2",53,0)
 N KIDTL
"RTN","TIUGR2",54,0)
 S KIDTL=$P(TIUGLINK,U,3)
"RTN","TIUGR2",55,0)
 I $L(KIDTL)>33 S KIDTL=$E(KIDTL,1,33)
"RTN","TIUGR2",56,0)
 Q "** Attaching "_KIDTL_" **"
"RTN","TIUGR2",57,0)
 ;
"RTN","TIUGR2",58,0)
LINK(DA,DADDA) ; Link DA to parent ID note DADDA
"RTN","TIUGR2",59,0)
 N DIE,DR
"RTN","TIUGR2",60,0)
 S DIE=8925,DR="2101////"_DADDA
"RTN","TIUGR2",61,0)
 D ^DIE
"RTN","TIUGR2",62,0)
 D AUDLINK^TIUGR1(DA,"a",DADDA)
"RTN","TIUGR2",63,0)
 D SENDID^TIUALRT1(DA)
"RTN","TIUGR2",64,0)
 Q
"RTN","TIUGR2",65,0)
 ;
"RTN","TIUGR2",66,0)
LINKQUIT ; Quit without linking
"RTN","TIUGR2",67,0)
 ; Action QUIT Review Screen if started linking and didn't succeed
"RTN","TIUGR2",68,0)
 ; Called by TIU ACTION QUIT from Review Screen if $G(TIUGLINK).
"RTN","TIUGR2",69,0)
 ; Unscreens review actions
"RTN","TIUGR2",70,0)
 N TIUI
"RTN","TIUGR2",71,0)
 S TIUI=0
"RTN","TIUGR2",72,0)
 F TIUI=+$O(VALMY(TIUI)) Q:'TIUI  D RESTORE^VALM10(TIUI)
"RTN","TIUGR2",73,0)
 I $P($G(TIUGLINK),U,2) D RESTORE^VALM10(+$P(TIUGLINK,U,2))
"RTN","TIUGR2",74,0)
 S VALMSG="** Note not attached **"
"RTN","TIUGR2",75,0)
 K VALMY,TIUGLINK
"RTN","TIUGR2",76,0)
 S VALMBCK="R"
"RTN","TIUGR2",77,0)
 Q
"RTN","TIUGR2",78,0)
 ;
"RTN","TIUHELP")
0^35^B10933422
"RTN","TIUHELP",1,0)
TIUHELP ; SLC/JER - On-line help library ;6/12/00
"RTN","TIUHELP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUHELP",3,0)
PROTOCOL ; Help for protocols
"RTN","TIUHELP",4,0)
 N DIRUT,DTOUT,DUOUT,TIUX,ORU,ORUPRMT,VALMDDF,VALMPGE S TIUX=X
"RTN","TIUHELP",5,0)
 D FULL^VALM1
"RTN","TIUHELP",6,0)
 I TIUX="?"!(TIUX="??") D  G PROTX
"RTN","TIUHELP",7,0)
 . I TIUX="??",($G(VALMAR)="^TMP(""TIUR"",$J)") D STATUS I $D(DIRUT) W ! Q
"RTN","TIUHELP",8,0)
 . D DISP^XQORM1 W !!,"Enter selection by typing the name, or abbreviation.",!,"Enter '??' or '???' for additional details.",!
"RTN","TIUHELP",9,0)
 . I TIUX="?" W:$$STOP^TIUU ""
"RTN","TIUHELP",10,0)
 I TIUX="???" D MENU(XQORNOD) I $D(DIROUT) S (XQORQUIT,XQORPOP)=1 Q
"RTN","TIUHELP",11,0)
PROTX S VALMBCK="R"
"RTN","TIUHELP",12,0)
 Q
"RTN","TIUHELP",13,0)
MENU(XQORNOD) ; Unwind protocol menus for help
"RTN","TIUHELP",14,0)
 N TIUSEQ,TIUI,TIUJ D CLEAR^VALM1
"RTN","TIUHELP",15,0)
 W:$$CONTINUE "Valid selections are:",!
"RTN","TIUHELP",16,0)
 S TIUI=0 F  S TIUI=$O(^ORD(101,+XQORNOD,10,TIUI)) Q:+TIUI'>0  D
"RTN","TIUHELP",17,0)
 . S TIUJ=+$P($G(^ORD(101,+XQORNOD,10,TIUI,0)),U,3) S:$D(TIUSEQ(TIUJ)) TIUJ=TIUJ+.1
"RTN","TIUHELP",18,0)
 . S TIUSEQ(TIUJ)=+$P(^ORD(101,+XQORNOD,10,TIUI,0),U)
"RTN","TIUHELP",19,0)
 S TIUI=0 F  S TIUI=$O(TIUSEQ(TIUI)) Q:+TIUI'>0!$D(DIRUT)  D
"RTN","TIUHELP",20,0)
 . I $D(^ORD(101,+TIUSEQ(TIUI),0)) D ITEM(+TIUSEQ(TIUI),1)
"RTN","TIUHELP",21,0)
 Q
"RTN","TIUHELP",22,0)
ITEM(XQORNOD,TAB) ; Show descriptions of items
"RTN","TIUHELP",23,0)
 N TIUI
"RTN","TIUHELP",24,0)
 Q:$P($G(^ORD(101,+XQORNOD,0)),U,2)']""
"RTN","TIUHELP",25,0)
 W:$$CONTINUE ?+$G(TAB),$G(IOINHI),$$UPPER^TIULS($P($G(^ORD(101,+XQORNOD,0)),U,2)),$G(IOINORM),!
"RTN","TIUHELP",26,0)
 I $D(DIRUT) Q
"RTN","TIUHELP",27,0)
 S TIUI=0 F  S TIUI=$O(^ORD(101,+XQORNOD,1,TIUI)) Q:+TIUI'>0!$D(DIRUT)  D
"RTN","TIUHELP",28,0)
 . W:$$CONTINUE ?(TAB+2),$G(^ORD(101,+XQORNOD,1,TIUI,0)),! Q:$D(DIRUT)
"RTN","TIUHELP",29,0)
 S TIUI=0 F  S TIUI=$O(^ORD(101,+XQORNOD,10,TIUI)) Q:+TIUI'>0  D
"RTN","TIUHELP",30,0)
 . D ITEM(+$G(^ORD(101,+XQORNOD,10,+TIUI,0))_";ORD(101,",3)
"RTN","TIUHELP",31,0)
 Q
"RTN","TIUHELP",32,0)
STATUS ; Show status descriptions
"RTN","TIUHELP",33,0)
 W:$$CONTINUE !!,"The Following Statuses are defined:"
"RTN","TIUHELP",34,0)
 D STATEXP
"RTN","TIUHELP",35,0)
 W:$$CONTINUE !!,"The Following Indicators are defined:",!!
"RTN","TIUHELP",36,0)
 W:$$CONTINUE " '+' to the left of the Title or Patient's name indicates that",!,"     a report has addenda.",!
"RTN","TIUHELP",37,0)
 W:$$CONTINUE " '*' to the left of the Title or Patient's name indicates",!,"     a priority (STAT) document.",!
"RTN","TIUHELP",38,0)
 W:$$CONTINUE " '<' to the left of the Title or Patient's name indicates an",!,"     interdisciplinary note, which can be expanded to show entries.",!
"RTN","TIUHELP",39,0)
 W:$$CONTINUE " '>' to the left of the Title or Patient's name indicates",!,"     that the note is an entry of an interdisciplinary note.",!
"RTN","TIUHELP",40,0)
 ;W:$$CONTINUE "These will appear at the top of the list.",!
"RTN","TIUHELP",41,0)
 Q
"RTN","TIUHELP",42,0)
CONTINUE() ; Pagination control
"RTN","TIUHELP",43,0)
 N Y
"RTN","TIUHELP",44,0)
 I $Y<(IOSL-2) S Y=1 G CONTX
"RTN","TIUHELP",45,0)
 S Y=$$STOP^TIUU("",1) W:+Y @IOF,!
"RTN","TIUHELP",46,0)
CONTX Q Y
"RTN","TIUHELP",47,0)
STATEXP ; Explain Statuses
"RTN","TIUHELP",48,0)
 N TIUI,TIUJ,TIUY S TIUI=0
"RTN","TIUHELP",49,0)
 D STATUS^TIUSRVL(.TIUY,"ALL",1)
"RTN","TIUHELP",50,0)
 F  S TIUI=$O(TIUY(TIUI)) Q:+TIUI'>0  D
"RTN","TIUHELP",51,0)
 . I TIUI>1 W:$$CONTINUE !
"RTN","TIUHELP",52,0)
 . W:$$CONTINUE !,$G(IOINHI),$P(TIUY(TIUI),U,2),$G(IOINORM)
"RTN","TIUHELP",53,0)
 . S TIUJ=0 F  S TIUJ=$O(TIUY(TIUI,1,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUHELP",54,0)
 . . W:$$CONTINUE !?2,$G(TIUY(TIUI,1,TIUJ))
"RTN","TIUHELP",55,0)
 Q
"RTN","TIULA2")
0^14^B43112403
"RTN","TIULA2",1,0)
TIULA2 ; SLC/JER - More interactive functions ;21-MAR-2001 14:41:10
"RTN","TIULA2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,50,86,93,61,100**;Jun 20, 1997
"RTN","TIULA2",3,0)
ASKTYP(TIUCLASS,DFLT,SCREEN,PROMPT) ; Call ^DIC to select single type
"RTN","TIULA2",4,0)
 N DIC,X,Y,TIUFPRIV,ITMCNT S TIUFPRIV=1
"RTN","TIULA2",5,0)
 S DIC=8925.1,TIUCLASS=$G(TIUCLASS,38),ITMCNT=$$ITMCNT(TIUCLASS)
"RTN","TIULA2",6,0)
 I +ITMCNT=1 D  G ASKTYPX
"RTN","TIULA2",7,0)
 . I $P($G(^TIU(8925.1,+TIUCLASS,0)),U,4)="CL" D  Q
"RTN","TIULA2",8,0)
 . . S TIUCLASS=+$G(^TIU(8925.1,+TIUCLASS,10,+$P(ITMCNT,U,2),0))
"RTN","TIULA2",9,0)
 . . S Y=$$ASKTYP(+TIUCLASS,DFLT,SCREEN,$G(PROMPT))
"RTN","TIULA2",10,0)
 . S DIC(0)="NX",X=+$G(^TIU(8925.1,+TIUCLASS,10,+$P(ITMCNT,U,2),0))
"RTN","TIULA2",11,0)
 . D ^DIC S Y=Y_U_"SINGLE ITEM"
"RTN","TIULA2",12,0)
 S DIC(0)="AEMQZ"
"RTN","TIULA2",13,0)
 S DIC("A")=$S($G(PROMPT)]"":$G(PROMPT),1:"Select TITLE: ")
"RTN","TIULA2",14,0)
 I $G(DFLT)="LAST" S DFLT=$P($$PERSDOC^TIULE(DUZ,+$G(TIUCLASS,38)),U,2)
"RTN","TIULA2",15,0)
 I +$G(DFLT),+$D(TIUCLASS),(+$$ISA^TIULX(+$G(DFLT),+$G(TIUCLASS))'>0) S DFLT=""
"RTN","TIULA2",16,0)
 I $G(DFLT)]"" S DIC("B")=$G(DFLT)
"RTN","TIULA2",17,0)
 I $G(SCREEN)]"" S DIC("S")=SCREEN
"RTN","TIULA2",18,0)
 D ^DIC K DIC("S")
"RTN","TIULA2",19,0)
ASKTYPX Q Y
"RTN","TIULA2",20,0)
ITMCNT(CLASS) ; Count the number of members of a class or document class
"RTN","TIULA2",21,0)
 N TIUI,TIUCNT,TIUY S (TIUI,TIUCNT,TIUY)=0
"RTN","TIULA2",22,0)
 F  S TIUI=$O(^TIU(8925.1,+CLASS,10,TIUI)) Q:+TIUI'>0  D 
"RTN","TIULA2",23,0)
 . I +$$CANPICK^TIULP(+$G(^TIU(8925.1,+CLASS,10,TIUI,0))) D
"RTN","TIULA2",24,0)
 . . S TIUCNT=TIUCNT+1
"RTN","TIULA2",25,0)
 . . S TIUY=TIUCNT_U_TIUI
"RTN","TIULA2",26,0)
 Q TIUY
"RTN","TIULA2",27,0)
DOCPICK(TIUCLASS,DFLT,ADDSCRN) ; Ask for document, given a class or document class
"RTN","TIULA2",28,0)
 N SCREEN,PROMPT S PROMPT=$S(TIUCLASS=3:"TITLE: ",1:"")
"RTN","TIULA2",29,0)
 S SCREEN="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"",+$$ISA^TIULX(+Y,TIUCLASS),+$$CANPICK^TIULP(+Y)"_$S($G(ADDSCRN)]"":",",1:"")_$G(ADDSCRN)
"RTN","TIULA2",30,0)
 Q $$ASKTYP(+TIUCLASS,$G(DFLT),SCREEN,PROMPT)
"RTN","TIULA2",31,0)
DOCSPICK(TIUY,TIUCLASS,PARM,DFLT,PROMPT,ADDSCRN) ; Ask for TITLE(S)
"RTN","TIULA2",32,0)
 ; with pick-list
"RTN","TIULA2",33,0)
 N SCREEN,Y
"RTN","TIULA2",34,0)
 S DFLT=$S($G(DFLT)=0:"",$G(DFLT)]"":$G(DFLT),1:"LAST")
"RTN","TIULA2",35,0)
 S PARM=$S($G(PARM)]"":PARM,1:"A")
"RTN","TIULA2",36,0)
 ; D DOCLIST^TIULA1(TIUCLASS,.TIUY,PARM,DFLT) I +TIUY>0 Q
"RTN","TIULA2",37,0)
 ; ADD CALL TO PERSONAL DOCUMENT LISTER HERE
"RTN","TIULA2",38,0)
 I PARM="1A" D TITLPICK^TIULA4(.TIUY,TIUCLASS) I +$G(TIUY)>0 Q
"RTN","TIULA2",39,0)
 S PROMPT=$S($G(PROMPT)]"":$G(PROMPT),TIUCLASS=3:"TITLE: ",1:"")
"RTN","TIULA2",40,0)
 S SCREEN="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"",($P(^(0),U)'[""ADDENDUM""),+$$ISA^TIULX(+Y,TIUCLASS)"_$S($G(ADDSCRN)]"":",",1:"")_$G(ADDSCRN)
"RTN","TIULA2",41,0)
 S TIUY=$$ASKTYP(+TIUCLASS,$G(DFLT),SCREEN,PROMPT)
"RTN","TIULA2",42,0)
 I +TIUY>0 S TIUY(1)=1_U_TIUY,TIUY=1
"RTN","TIULA2",43,0)
 Q
"RTN","TIULA2",44,0)
SELPAT(TIURTN,TIUTYP,DFN,TIUASK) ; Select a patient's document
"RTN","TIULA2",45,0)
 N TIUI,TIUQRY,TIUREC,TIUEDT,TIULDT,TIUPRMT,TIUA,TIUZ,TIUTOT,TIUSTOP
"RTN","TIULA2",46,0)
 N TIULAST,TIULIST,TIUJ,TIUY,TIUPNOUN,TIUSMPL,TIUTMP,TIUEDFLT,TIUCONT
"RTN","TIULA2",47,0)
 K ^TMP("TIULIST",$J),^TMP("TIULIDX",$J)
"RTN","TIULA2",48,0)
 S TIUTYP=$G(TIUTYP,38)
"RTN","TIULA2",49,0)
 S TIUPNOUN=$S(TIUTYP=3:"notes",TIUTYP=244:"summaries",1:"documents")
"RTN","TIULA2",50,0)
 I '+$G(DFN) S DFN=+$$PATIENT^TIULA Q:+DFN'>0
"RTN","TIULA2",51,0)
 I +$O(^TIU(8925,"APTCL",+DFN,+TIUTYP,0))'>0 D  Q
"RTN","TIULA2",52,0)
 . W !!,"No ",TIUPNOUN," on file for ",$P(^DPT(+DFN,0),U)
"RTN","TIULA2",53,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIULA2",54,0)
 S TIUSMPL=$$SAMPLE(DFN,TIUTYP)
"RTN","TIULA2",55,0)
 I +TIUSMPL'>0 D  Q
"RTN","TIULA2",56,0)
 . W !!,"No ",TIUPNOUN," available for ",$P(^DPT(+DFN,0),U),!
"RTN","TIULA2",57,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIULA2",58,0)
 S TIUTOT=+$P(TIUSMPL,U)
"RTN","TIULA2",59,0)
 S TIUEDT=+$P(TIUSMPL,U,2)_U_$$DATE^TIULS(+$P(TIUSMPL,U,2),"MM/DD/CCYY")
"RTN","TIULA2",60,0)
 S TIULDT=+$P(TIUSMPL,U,3)_U_$$DATE^TIULS(+$P(TIUSMPL,U,3),"MM/DD/CCYY")
"RTN","TIULA2",61,0)
 W !!,"Available ",TIUPNOUN,":  ",$P(TIUEDT,U,2)
"RTN","TIULA2",62,0)
 W " thru ",$P(TIULDT,U,2),"  (",TIUTOT,")"
"RTN","TIULA2",63,0)
 I +$G(TIUASK)>0 D  Q:+$G(TIUCONT)'>0
"RTN","TIULA2",64,0)
 . N TIUPRMT S TIUPRMT="Do you wish to see any of these notes"
"RTN","TIULA2",65,0)
 . S TIUCONT=+$$READ^TIUU("YO",TIUPRMT,"NO")
"RTN","TIULA2",66,0)
 I +TIUTOT=1,+$P(TIUSMPL,U,4) S TIURTN=1,TIURTN(1)=+$P(TIUSMPL,U,4) Q
"RTN","TIULA2",67,0)
 W !!,"Please specify a date range from which to select ",TIUPNOUN_":"
"RTN","TIULA2",68,0)
 S TIUPRMT="List "_TIUPNOUN_" Beginning: "
"RTN","TIULA2",69,0)
 S TIUEDFLT=$P(TIUEDT,U)
"RTN","TIULA2",70,0)
 I +TIUEDFLT<+$P(TIUEDT,U) S TIUEDFLT=$P(TIUEDT,U,2)
"RTN","TIULA2",71,0)
 I TIUEDFLT'["/" S TIUEDFLT=$$DATE^TIULS(TIUEDFLT,"MM/DD/CCYY")
"RTN","TIULA2",72,0)
 S TIUA=+$$READ^TIUU("DA^"_+$P(TIUEDT,".")_":"_+TIULDT_":E",TIUPRMT,TIUEDFLT)
"RTN","TIULA2",73,0)
 I +$D(DIRUT)!(TIUA'>0) Q
"RTN","TIULA2",74,0)
 S TIUPRMT=$J("Thru: ",$L(TIUPRMT))
"RTN","TIULA2",75,0)
 S TIUZ=+$$READ^TIUU("DA^"_+$P(TIUEDT,".")_":"_+TIULDT_":E",TIUPRMT,$P(TIULDT,U,2))_".2401" W !
"RTN","TIULA2",76,0)
 I +$D(DIRUT)!(TIUA'>0) Q
"RTN","TIULA2",77,0)
 I +TIUA>TIUZ S TIUTMP=TIUA,TIUA=TIUZ,TIUZ=TIUTMP
"RTN","TIULA2",78,0)
 D LIST^TIUSRVLL(.TIUY,TIUTYP,DFN,TIUA,TIUZ)
"RTN","TIULA2",79,0)
 I $D(TIUY)>9 D
"RTN","TIULA2",80,0)
 . S TIUI=0 F  S TIUI=$O(TIUY(TIUI)) Q:+TIUI'>0!(+$G(TIUSTOP)>0)  D
"RTN","TIULA2",81,0)
 . . N TIUD0,TIUD13,TIUD12,TIUD17,TIUDOC,PREFIX
"RTN","TIULA2",82,0)
 . . S TIUD0=$G(^TIU(8925,+TIUY(TIUI),0)),TIUD12=$G(^(12))
"RTN","TIULA2",83,0)
 . . S TIUD13=$G(^TIU(8925,+TIUY(TIUI),13)),TIUD17=$G(^(17)),TIULAST=TIUI
"RTN","TIULA2",84,0)
 . . S TIUDOC=$E($$PNAME^TIULC1(+TIUD0),1,36)
"RTN","TIULA2",85,0)
 . . I TIUDOC="Addendum" S TIUDOC=TIUDOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIULA2",86,0)
 . . S PREFIX=$$PREFIX(+TIUY(TIUI),1),TIUDOC=PREFIX_TIUDOC
"RTN","TIULA2",87,0)
 . . I +$P(TIUD0,U,5)=15 S TIUDOC=TIUDOC_" (RETRACTED)"
"RTN","TIULA2",88,0)
 . . W !,TIUI,?4,$$DATE^TIULS(+TIUD13,"MM/DD/CCYY HR:MIN")
"RTN","TIULA2",89,0)
 . . W ?22,TIUDOC
"RTN","TIULA2",90,0)
 . . W ?60,$E($$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD12,U,2)),"LAST,FI"),1,19)
"RTN","TIULA2",91,0)
 . . W !?$S($P(TIUD0,U,13)="H":24,1:22),$S($P(TIUD0,U,13)="H":"Adm: ",1:"Visit: "),$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/CCYY")
"RTN","TIULA2",92,0)
 . . I $P(TIUD0,U,13)="H" W ?41,"Dis: ",$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/CCYY")
"RTN","TIULA2",93,0)
 . . I $L(TIUD17) W !,"SUBJECT: ",$E(TIUD17,1,70)
"RTN","TIULA2",94,0)
 . . I '(TIUI#5),(TIUI<+$P(TIUY,U)) D CHOOSE(.TIUSTOP,"   '^' TO STOP: ",1,TIUI,1)
"RTN","TIULA2",95,0)
 . I +TIUY=1 S TIURTN(1)=+TIUY(1) D  Q
"RTN","TIULA2",96,0)
 . . W !!,"One ",$S(TIUTYP=3:"note",TIUTYP=244:"summary",1:"document")
"RTN","TIULA2",97,0)
 . . W " found within date range..." H 1
"RTN","TIULA2",98,0)
 . I +$G(TIUSTOP)>0,(+$G(TIUSTOP)'=9999999) M TIULIST=TIUSTOP
"RTN","TIULA2",99,0)
 . E  D CHOOSE(.TIULIST,"Choose one or more "_TIUPNOUN_":  (1-"_+$G(TIULAST)_"): ",1,+$G(TIULAST))
"RTN","TIULA2",100,0)
 . N TIUK
"RTN","TIULA2",101,0)
 . S TIUK="",TIURTN=0
"RTN","TIULA2",102,0)
 . F  S TIUK=$O(TIULIST(TIUK)) Q:TIUK=""  D
"RTN","TIULA2",103,0)
 . . F TIUI=1:1:$L(TIULIST(TIUK),",") D
"RTN","TIULA2",104,0)
 . . . S TIUJ=$P(TIULIST,",",TIUI)
"RTN","TIULA2",105,0)
 . . . I +TIUJ>0,+$G(^TIU(8925,+$G(TIUY(+TIUJ)),0)) S TIURTN(TIUI)=+$G(TIUY(+TIUJ)),TIURTN=TIURTN+1
"RTN","TIULA2",106,0)
 Q
"RTN","TIULA2",107,0)
 ;
"RTN","TIULA2",108,0)
PREFIX(DA,IDKID) ; Return addendum, urgency, ID indicators.
"RTN","TIULA2",109,0)
 ; I $G(IDKID)=1, include '>' if note is ID kid.
"RTN","TIULA2",110,0)
 N PREFIX,IDKIDFLG
"RTN","TIULA2",111,0)
 S PREFIX=""
"RTN","TIULA2",112,0)
 S IDKIDFLG=1 ; check ID kids too for addenda
"RTN","TIULA2",113,0)
 I $$HASIDKID^TIUGBR(DA) S PREFIX="<"_PREFIX
"RTN","TIULA2",114,0)
 I $G(IDKID),$$HASIDDAD^TIUGBR(DA) S PREFIX=">"_PREFIX
"RTN","TIULA2",115,0)
 I $$HASADDEN^TIULC1(DA,IDKIDFLG) S PREFIX="+"_PREFIX
"RTN","TIULA2",116,0)
 I +$$URGENCY^TIURM(DA)=1 S PREFIX="*"_PREFIX
"RTN","TIULA2",117,0)
 I $L(PREFIX) S PREFIX=PREFIX_" "
"RTN","TIULA2",118,0)
 Q PREFIX
"RTN","TIULA2",119,0)
 ;
"RTN","TIULA2",120,0)
SAMPLE(DFN,CLASS) ; Quick sample for range and count
"RTN","TIULA2",121,0)
 N EARLY,LATE,TOTAL,TIUI,TIUJ,TIUL,TIUY,TIULDA
"RTN","TIULA2",122,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIULA2",123,0)
 S (TIUI,TIUL,TIULDA,LATE,EARLY,TOTAL)=0
"RTN","TIULA2",124,0)
 F  S TIUI=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI)) Q:+TIUI'>0  D
"RTN","TIULA2",125,0)
 . S TIUJ=0
"RTN","TIULA2",126,0)
 . F  S TIUJ=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIULA2",127,0)
 . . I ($P(TIUPRM0,U,6)="S"),(+$$CANDO^TIULP(TIUJ,"VIEW")'>0) Q
"RTN","TIULA2",128,0)
 . . I +$G(^TIU(8925,+TIUJ,0))=81!'$D(^TIU(8925,+TIUJ,0)) Q
"RTN","TIULA2",129,0)
 . . S:'LATE LATE=9999999-TIUI
"RTN","TIULA2",130,0)
 . . S TIUL=TIUI,TOTAL=TOTAL+1,TIULDA=TIUJ
"RTN","TIULA2",131,0)
 S:+TIUL EARLY=9999999-TIUL
"RTN","TIULA2",132,0)
 S TIUY=TOTAL_U_EARLY_U_LATE
"RTN","TIULA2",133,0)
 S:TOTAL=1 TIUY=TIUY_U_TIULDA
"RTN","TIULA2",134,0)
 Q TIUY
"RTN","TIULA2",135,0)
CHOOSE(Y,PROMPT,LO,HI,PAUSE) ; Call reader for pause or list selection
"RTN","TIULA2",136,0)
 N DIR,DIRUT,DUOUT,DTOUT,X
"RTN","TIULA2",137,0)
 S DIR(0)="LOA^"_LO_":"_HI
"RTN","TIULA2",138,0)
 S DIR("A")=PROMPT
"RTN","TIULA2",139,0)
 D ^DIR
"RTN","TIULA2",140,0)
 I +$G(PAUSE),(Y="^")!$D(DUOUT)!$D(DIROUT)!$D(DTOUT) S Y=9999999
"RTN","TIULA2",141,0)
 Q
"RTN","TIULA2",142,0)
AUTHOR(TERMOK) ; Get author
"RTN","TIULA2",143,0)
 N TIUY,TIURTYP,TIUPRMT,TIUSCRN,DFLT S TERMOK=+$G(TERMOK)
"RTN","TIULA2",144,0)
 S:+$$ISA^USRLM(DUZ,"PROVIDER")!+$$ISA^USRLM(DUZ,"STUDENT") DFLT=$$PERSNAME^TIULC1(DUZ)
"RTN","TIULA2",145,0)
 S TIURTYP="P^200:AEMQZ",TIUPRMT="Select AUTHOR"
"RTN","TIULA2",146,0)
 S TIUSCRN="I $S(+TERMOK:1,1:'+$$ISTERM^USRLM(+Y))"
"RTN","TIULA2",147,0)
 S TIUY=$$READ^TIUU(TIURTYP,TIUPRMT,$G(DFLT),"",TIUSCRN)
"RTN","TIULA2",148,0)
 Q TIUY
"RTN","TIULAPIC")
0^89^B10248132
"RTN","TIULAPIC",1,0)
TIULAPIC ; SLC/JER,KER - Extract selected classes from TIU ;3/21/01
"RTN","TIULAPIC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**83,100**;Jun 20, 1997
"RTN","TIULAPIC",3,0)
MAIN(DFN,TIUDOC,TIME1,TIME2,OCCLIM,TEXT) ; Control branching
"RTN","TIULAPIC",4,0)
 ; Notes for Health Summaries, by Reference Date
"RTN","TIULAPIC",5,0)
 ; For comments, see rtn TIULAPIS
"RTN","TIULAPIC",6,0)
 N TIUDA,TIUDT,TIUPRM0,TIUPRM1,TIUPRM3,COUNT,TIUSI,TIUS,TIUTI,TYPES
"RTN","TIULAPIC",7,0)
 N CANDO,RPARRAY,CKCANVW,ORIGCHLD
"RTN","TIULAPIC",8,0)
 D SETPARM^TIULE S:+$G(OCCLIM)'>0 OCCLIM=999 S:+$G(TIME1)'>0 TIME1=6666666 S:+$G(TIME2)'>0 TIME2=9999999 K ^TMP("TIU",$J) I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIULAPIC",9,0)
 S TIUDT=TIME1 F  S TIUDT=$O(^TIU(8925,"APTCL",DFN,TIUDOC,TIUDT)) Q:+TIUDT'>0!(TIUDT>TIME2)!(+$G(COUNT)'<OCCLIM)  D
"RTN","TIULAPIC",10,0)
 . S TIUDA=0 F  S TIUDA=$O(^TIU(8925,"APTCL",DFN,TIUDOC,TIUDT,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIULAPIC",11,0)
 . . I +$$ISADDNDM^TIULC1(TIUDA),+TEXT Q
"RTN","TIULAPIC",12,0)
 . . S CKCANVW=$S($E(IOST,1)="C":1,1:0)
"RTN","TIULAPIC",13,0)
 . . I $E(IOST,1)'="C" S CANDO=+$$CANDO^TIULP(TIUDA,"PRINT RECORD") Q:'CANDO  ;TIU*1*91
"RTN","TIULAPIC",14,0)
 . . D REPLACE^TIUPRPN3(TIUDA,.RPARRAY,TIUDT,1301,CKCANVW)
"RTN","TIULAPIC",15,0)
 . . S COUNT=RPARRAY
"RTN","TIULAPIC",16,0)
 S TIUDA=0
"RTN","TIULAPIC",17,0)
 F  S TIUDA=$O(RPARRAY(TIUDA)) Q:'TIUDA  D
"RTN","TIULAPIC",18,0)
 . Q:RPARRAY(TIUDA)=0  ;not viewable
"RTN","TIULAPIC",19,0)
 . S TIUDT=RPARRAY(TIUDA,"DT")
"RTN","TIULAPIC",20,0)
 . S ORIGCHLD=+$P(RPARRAY(TIUDA),U,2)
"RTN","TIULAPIC",21,0)
 . D EXTRACT^TIULQ(TIUDA,"^TMP(""TIU"",$J,"_TIUDT_")",.TIUERR,".01;.05;.07;.08;1202;1203;1205;1208;1209;1301;1307;1402;1501:1505;1507:1513;1701","",1,"IE",CKCANVW,ORIGCHLD)
"RTN","TIULAPIC",22,0)
 Q
"RTN","TIULAPIC",23,0)
 ;
"RTN","TIULAPIC",24,0)
VISIT(DFN,TIUDOC,TIME1,TIME2,OCCLIM,TEXT) ; Control branching
"RTN","TIULAPIC",25,0)
 ; Visit Date
"RTN","TIULAPIC",26,0)
 N TIUDA,TIUDT,TIUPRM0,TIUPRM1,TIUPRM3,COUNT,TIUSI,TIUS,TIUTI,TIUVD,TYPES
"RTN","TIULAPIC",27,0)
 N CANDO,RPARRAY,CKCANVW,ORIGCHLD
"RTN","TIULAPIC",28,0)
 D SETPARM^TIULE S:+$G(OCCLIM)'>0 OCCLIM=999 S:+$G(TIME1)'>0 TIME1=6666666 S:+$G(TIME2)'>0 TIME2=9999999 K ^TMP("TIU",$J) I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIULAPIC",29,0)
 S TIUDT=TIME1 F  S TIUDT=$O(^TIU(8925,"AE",DFN,TIUDT)) Q:+TIUDT'>0!(TIUDT>TIME2)!(+$G(COUNT)'<OCCLIM)  D
"RTN","TIULAPIC",30,0)
 . S TIUVD=0 F  S TIUVD=$O(^TIU(8925,"AE",DFN,TIUDT,TIUVD)) Q:+TIUVD'>0  D
"RTN","TIULAPIC",31,0)
 . . S TIUDA=0 F  S TIUDA=$O(^TIU(8925,"AE",DFN,TIUDT,TIUVD,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIULAPIC",32,0)
 . . . N TIUIVD,TIUIRD S TIUIVD=(9999999-TIUDT),TIUIRD=+($P($G(^TIU(8925,+TIUDA,13)),"^",1))
"RTN","TIULAPIC",33,0)
 . . . Q:'$D(^TIU(8925,"APTCL",DFN,TIUDOC,(9999999-TIUIRD)))
"RTN","TIULAPIC",34,0)
 . . . I +$$ISADDNDM^TIULC1(TIUDA),+TEXT Q
"RTN","TIULAPIC",35,0)
 . . . S CKCANVW=$S($E(IOST,1)="C":1,1:0)
"RTN","TIULAPIC",36,0)
 . . . I $E(IOST,1)'="C" S CANDO=+$$CANDO^TIULP(TIUDA,"PRINT RECORD") Q:'CANDO  ;TIU*1*91
"RTN","TIULAPIC",37,0)
 . . . D REPLACE^TIUPRPN3(TIUDA,.RPARRAY,TIUDT,1301,CKCANVW)
"RTN","TIULAPIC",38,0)
 . . . S COUNT=RPARRAY
"RTN","TIULAPIC",39,0)
 S TIUDA=0
"RTN","TIULAPIC",40,0)
 F  S TIUDA=$O(RPARRAY(TIUDA)) Q:'TIUDA  D
"RTN","TIULAPIC",41,0)
 . Q:RPARRAY(TIUDA)=0
"RTN","TIULAPIC",42,0)
 . S TIUDT=RPARRAY(TIUDA,"DT")
"RTN","TIULAPIC",43,0)
 . S ORIGCHLD=+$P(RPARRAY(TIUDA),U,2)
"RTN","TIULAPIC",44,0)
 . D EXTRACT^TIULQ(TIUDA,"^TMP(""TIU"",$J,"_(TIUDT)_")",.TIUERR,".01;.05;.07;.08;1202;1203;1205;1208;1209;1301;1307;1402;1501:1505;1507:1513;1701","",1,"IE",CKCANVW,ORIGCHLD)
"RTN","TIULAPIC",45,0)
 Q
"RTN","TIULAPIS")
0^90^B10427510
"RTN","TIULAPIS",1,0)
TIULAPIS ; SLC/JER - Extract selected documents from TIU ;3/23/01
"RTN","TIULAPIS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIULAPIS",3,0)
MAIN(DFN,TIUDOC,STATUS,TIME1,TIME2,OCCLIM,TEXT) ; Control branching
"RTN","TIULAPIS",4,0)
 N TIUDA,TIUDT,TIUPRM0,TIUPRM1,TIUPRM3,COUNT,TIUSI,TIUS,TIUTI
"RTN","TIULAPIS",5,0)
 N CANDO,OLDRPARY,TIUDOCI,CKCANVW,ORIGCHLD,RPARRAY
"RTN","TIULAPIS",6,0)
 D SETPARM^TIULE
"RTN","TIULAPIS",7,0)
 S:+$G(OCCLIM)'>0 OCCLIM=999
"RTN","TIULAPIS",8,0)
 S:+$G(TIME1)'>0 TIME1=6666666
"RTN","TIULAPIS",9,0)
 S:+$G(TIME2)'>0 TIME2=9999999
"RTN","TIULAPIS",10,0)
 K ^TMP("TIU",$J)
"RTN","TIULAPIS",11,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIULAPIS",12,0)
 I $D(TIUDOC)'>0 Q
"RTN","TIULAPIS",13,0)
 I $D(STATUS)'>9 D STATUS^TIUSRVL(.STATUS,$S($G(STATUS)]"":STATUS,1:"ALL"))
"RTN","TIULAPIS",14,0)
 S TIUTI=0 F  S TIUTI=$O(TIUDOC(TIUTI)) Q:+TIUTI'>0  D  ;TIUTI=1,2,3...
"RTN","TIULAPIS",15,0)
 . S TIUDOC=+$G(TIUDOC(TIUTI)),COUNT=0
"RTN","TIULAPIS",16,0)
 . S TIUSI=0 F  S TIUSI=$O(STATUS(TIUSI)) Q:+TIUSI'>0  D
"RTN","TIULAPIS",17,0)
 . . S TIUS=+$G(STATUS(TIUSI)),TIUDT=TIME1
"RTN","TIULAPIS",18,0)
 . . F  S TIUDT=$O(^TIU(8925,"APT",DFN,TIUDOC,TIUS,TIUDT)) Q:+TIUDT'>0!(TIUDT>TIME2)!(+$G(COUNT)'<OCCLIM)  D
"RTN","TIULAPIS",19,0)
 . . . S TIUDA=0 F  S TIUDA=$O(^TIU(8925,"APT",DFN,TIUDOC,TIUS,TIUDT,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIULAPIS",20,0)
 . . . . I +$$ISADDNDM^TIULC1(TIUDA),+TEXT Q
"RTN","TIULAPIS",21,0)
 . . . . ; -- CKCANVW: If user is viewing, check in REPLACE if user
"RTN","TIULAPIS",22,0)
 . . . . ;    can view, and add record to RPARRAY only if user
"RTN","TIULAPIS",23,0)
 . . . . ;    can view.  Tell EXTRACT it doesn't need to check again
"RTN","TIULAPIS",24,0)
 . . . . ;    when EXTRACT loops thru RPARRAY.
"RTN","TIULAPIS",25,0)
 . . . . S CKCANVW=$S($E(IOST,1)="C":1,1:0)
"RTN","TIULAPIS",26,0)
 . . . . I $E(IOST,1)'="C" S CANDO=+$$CANDO^TIULP(TIUDA,"PRINT RECORD") Q:'CANDO  ;TIU*1*91
"RTN","TIULAPIS",27,0)
 . . . . ; -- Since ID children must print as part of the whole ID
"RTN","TIULAPIS",28,0)
 . . . . ;    note, set array RPARRAY of standalone notes
"RTN","TIULAPIS",29,0)
 . . . . ;    and ID parents.
"RTN","TIULAPIS",30,0)
 . . . . ;    Add TIUDA to RPARRAY, replacing TIUDA w its ID parent
"RTN","TIULAPIS",31,0)
 . . . . ;    IFN if TIUDA is an ID kid.  Raise count of records
"RTN","TIULAPIS",32,0)
 . . . . ;    if "good" element was added to RPARRAY.
"RTN","TIULAPIS",33,0)
 . . . . S OLDRPARY=$G(RPARRAY) ;How many "GOOD" elements in array
"RTN","TIULAPIS",34,0)
 . . . . D REPLACE^TIUPRPN3(TIUDA,.RPARRAY,TIUDT,1301,CKCANVW)
"RTN","TIULAPIS",35,0)
 . . . . S COUNT=COUNT+RPARRAY-OLDRPARY
"RTN","TIULAPIS",36,0)
 . . . . S ^TMP("TIU",$J,TIUDT,TIUTI,0)=COUNT
"RTN","TIULAPIS",37,0)
 . . . . ; -- Track which title to collate TIUDA with:
"RTN","TIULAPIS",38,0)
 . . . . S TIUDOCI(TIUDA)=TIUTI
"RTN","TIULAPIS",39,0)
 ; -- Loop thru array of standalone or ID parent records and
"RTN","TIULAPIS",40,0)
 ;    set ^TMP("TIU",$J for each record.
"RTN","TIULAPIS",41,0)
 S TIUDA=0
"RTN","TIULAPIS",42,0)
 F  S TIUDA=$O(RPARRAY(TIUDA)) Q:'TIUDA  D
"RTN","TIULAPIS",43,0)
 . Q:RPARRAY(TIUDA)=0  ;User can't view
"RTN","TIULAPIS",44,0)
 . S TIUDT=RPARRAY(TIUDA,"DT")
"RTN","TIULAPIS",45,0)
 . ; -- ORIGCHLD: If a parent is added to array solely on merit
"RTN","TIULAPIS",46,0)
 . ;    of an ID kid, retrieve the child that meets the criteria
"RTN","TIULAPIS",47,0)
 . ;    and collate w child title:
"RTN","TIULAPIS",48,0)
 . S ORIGCHLD=+$P(RPARRAY(TIUDA),U,2)
"RTN","TIULAPIS",49,0)
 . S TIUTI=$G(TIUDOCI(TIUDA)) I 'TIUTI S TIUTI=$G(TIUDOCI(ORIGCHLD))
"RTN","TIULAPIS",50,0)
 . D EXTRACT^TIULQ(TIUDA,"^TMP(""TIU"","_$J_","_TIUDT_","_TIUTI_")",.TIUERR,".01;.05;.07;.08;1202;1203;1205;1208;1209;1301;1307;1402;1501:1505;1507:1513;1701","",1,"IE",CKCANVW,ORIGCHLD)
"RTN","TIULAPIS",51,0)
 Q
"RTN","TIULC1")
0^15^B38069683
"RTN","TIULC1",1,0)
TIULC1 ; SLC/JER - More computational functions ;14-MAR-2001 09:59:41
"RTN","TIULC1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,4,40,49,100**;Jun 20, 1997
"RTN","TIULC1",3,0)
ENCRYPT(X,X1,X2) ; Encrypt Text Strings
"RTN","TIULC1",4,0)
 D EN^XUSHSHP
"RTN","TIULC1",5,0)
 Q X
"RTN","TIULC1",6,0)
DECRYPT(X,X1,X2) ; Decrypt Text Strings
"RTN","TIULC1",7,0)
 D DE^XUSHSHP
"RTN","TIULC1",8,0)
 Q X
"RTN","TIULC1",9,0)
WHOSIGNS(DA) ; Evaluate who should be the expected signer
"RTN","TIULC1",10,0)
 N Y,TIU12
"RTN","TIULC1",11,0)
 S TIU12=$G(^TIU(8925,+DA,12))
"RTN","TIULC1",12,0)
 I $P(TIU12,U,2)'=$P(TIU12,U,9) S Y=$P(TIU12,U,2)
"RTN","TIULC1",13,0)
 E  S Y=$P(TIU12,U,9)
"RTN","TIULC1",14,0)
 Q Y
"RTN","TIULC1",15,0)
WHOCOSIG(DA) ; Evaluate who should be the expected cosigner
"RTN","TIULC1",16,0)
 N Y,TIU12
"RTN","TIULC1",17,0)
 S TIU12=$G(^TIU(8925,+DA,12))
"RTN","TIULC1",18,0)
 I $P(TIU12,U,2)=$P(TIU12,U,9) D
"RTN","TIULC1",19,0)
 . I $P(TIU12,U,8)]"" S Y="@"
"RTN","TIULC1",20,0)
 . E  S Y=""
"RTN","TIULC1",21,0)
 E  S Y=$P(TIU12,U,9)
"RTN","TIULC1",22,0)
 Q Y
"RTN","TIULC1",23,0)
 ;
"RTN","TIULC1",24,0)
HASADDEN(DA,IDKIDFLG) ; Evaluate whether a given record has addenda
"RTN","TIULC1",25,0)
 ; **100**:
"RTN","TIULC1",26,0)
 ; If +IDKIDFLG, check interdisciplinary kids of DA, as well as DA.
"RTN","TIULC1",27,0)
 N TIUI,TIUY,TIUJ,TIUK
"RTN","TIULC1",28,0)
 S (TIUI,TIUJ,TIUY)=0
"RTN","TIULC1",29,0)
 F  S TIUI=$O(^TIU(8925,"DAD",+DA,TIUI)) Q:+TIUI'>0  D  Q:TIUY
"RTN","TIULC1",30,0)
 . I $P($G(^TIU(8925.1,+$G(^TIU(8925,+TIUI,0)),0)),U)["ADDENDUM" S TIUY=1
"RTN","TIULC1",31,0)
 I TIUY!'$G(IDKIDFLG) G HASX
"RTN","TIULC1",32,0)
 ;**100** Check ID kids for addenda:
"RTN","TIULC1",33,0)
 F  S TIUJ=$O(^TIU(8925,"GDAD",+DA,TIUJ)) Q:+TIUJ'>0  D  Q:TIUY
"RTN","TIULC1",34,0)
 . S TIUK=0
"RTN","TIULC1",35,0)
 . F  S TIUK=$O(^TIU(8925,"DAD",TIUJ,TIUK)) Q:+TIUK'>0  D  Q:TIUY
"RTN","TIULC1",36,0)
 . . I $P($G(^TIU(8925.1,+$G(^TIU(8925,+TIUK,0)),0)),U)["ADDENDUM" S TIUY=1
"RTN","TIULC1",37,0)
HASX Q TIUY
"RTN","TIULC1",38,0)
 ;
"RTN","TIULC1",39,0)
ISADDNDM(DA) ; Evaluate whether a given record IS an addendum
"RTN","TIULC1",40,0)
 N TIUY S TIUY=0
"RTN","TIULC1",41,0)
 I $P($G(^TIU(8925.1,+$G(^TIU(8925,+DA,0)),0)),U)["ADDENDUM",+$P($G(^TIU(8925,+DA,0)),U,6)>0 S TIUY=1
"RTN","TIULC1",42,0)
 Q TIUY
"RTN","TIULC1",43,0)
PNAME(DA) ; Receives pointer to 8925.1, returns display name of
"RTN","TIULC1",44,0)
 ; document class
"RTN","TIULC1",45,0)
 N TIUY,TIUMOM S TIUMOM=0
"RTN","TIULC1",46,0)
 I +$G(DA)'>0 Q "UNKNOWN"
"RTN","TIULC1",47,0)
 S TIUMOM=$O(^TIU(8925.1,"AD",DA,TIUMOM))
"RTN","TIULC1",48,0)
 I $P($G(^TIU(8925.1,+DA,0)),U,4)="CO" S TIUMOM=0
"RTN","TIULC1",49,0)
 I +$P($G(^TIU(8925.1,+DA,0)),U,9)=0 S TIUMOM=0
"RTN","TIULC1",50,0)
 I +TIUMOM>0  D
"RTN","TIULC1",51,0)
 . S TIUY=$P($G(^TIU(8925.1,+TIUMOM,0)),U,3)
"RTN","TIULC1",52,0)
 . I TIUY']"" S TIUY=$$MIXED^TIULS($P($G(^TIU(8925.1,+TIUMOM,0)),U))
"RTN","TIULC1",53,0)
 I +TIUMOM'>0 D
"RTN","TIULC1",54,0)
 . S TIUY=$P($G(^TIU(8925.1,+DA,0)),U,3)
"RTN","TIULC1",55,0)
 . I TIUY']"" S TIUY=$$MIXED^TIULS($P($G(^TIU(8925.1,+DA,0)),U))
"RTN","TIULC1",56,0)
 Q TIUY
"RTN","TIULC1",57,0)
ABBREV(DA) ; Get abbreviaton for a document type or class
"RTN","TIULC1",58,0)
 Q $P($G(^TIU(8925.1,+DA,0)),U,2)
"RTN","TIULC1",59,0)
PERSNAME(USER) ; Receives pointer to 200, returns name field
"RTN","TIULC1",60,0)
 Q $P($G(^VA(200,+USER,0),"UNKNOWN"),U)
"RTN","TIULC1",61,0)
BEEP(USER) ; Get beeper #'s 
"RTN","TIULC1",62,0)
 Q $P($G(^VA(200,+USER,.13)),U,7,8)
"RTN","TIULC1",63,0)
DOCPRM(TIUTYP,TIUDPRM,TIUDA) ; Get Document Parameters, support inheritance
"RTN","TIULC1",64,0)
 N TIUI,TIUDAD
"RTN","TIULC1",65,0)
 S (TIUDPRM(0),TIUDPRM(5))=""
"RTN","TIULC1",66,0)
 I $P($G(^TIU(8925.1,+TIUTYP,0)),U)["ADDENDUM",+$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULC1",67,0)
 S TIUI=+$O(^TIU(8925.95,"B",+TIUTYP,0))
"RTN","TIULC1",68,0)
 I +TIUI D  Q
"RTN","TIULC1",69,0)
 . S TIUDPRM(0)=$G(^TIU(8925.95,+TIUI,0))
"RTN","TIULC1",70,0)
 . I +$O(^TIU(8925.95,+TIUI,5,0)) D
"RTN","TIULC1",71,0)
 . . N TIUJ S TIUJ=0
"RTN","TIULC1",72,0)
 . . F  S TIUJ=$O(^TIU(8925.95,+TIUI,5,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIULC1",73,0)
 . . . S $P(TIUDPRM(5),U,TIUJ)=+$G(^TIU(8925.95,+TIUI,5,+TIUJ,0))
"RTN","TIULC1",74,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",75,0)
 I +TIUDAD D DOCPRM(TIUDAD,.TIUDPRM)
"RTN","TIULC1",76,0)
 Q
"RTN","TIULC1",77,0)
POSTFILE(TIUTYP) ; Get Post-filing Code, support inheritance
"RTN","TIULC1",78,0)
 N TIUPOST,TIUDAD
"RTN","TIULC1",79,0)
 S TIUPOST=$G(^TIU(8925.1,+TIUTYP,4.5))
"RTN","TIULC1",80,0)
 I TIUPOST]"" G POSTFILX
"RTN","TIULC1",81,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",82,0)
 I +TIUDAD S TIUPOST=$$POSTFILE(TIUDAD)
"RTN","TIULC1",83,0)
POSTFILX Q TIUPOST
"RTN","TIULC1",84,0)
FIXCODE(TIUTYP) ; Get Error Resolution Code, support inheritance
"RTN","TIULC1",85,0)
 N TIUFIX,TIUDAD
"RTN","TIULC1",86,0)
 S TIUFIX=$G(^TIU(8925.1,+TIUTYP,4.8))
"RTN","TIULC1",87,0)
 I TIUFIX]"" G FIXCODX
"RTN","TIULC1",88,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",89,0)
 I +TIUDAD S TIUFIX=$$FIXCODE(TIUDAD)
"RTN","TIULC1",90,0)
FIXCODX Q TIUFIX
"RTN","TIULC1",91,0)
DOCCLASS(TIUTYP) ; Given a document type, find its parent document class
"RTN","TIULC1",92,0)
 Q +$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",93,0)
CLINDOC(TIUTYP,TIUDA) ; Given a document type, find the Clinical Document
"RTN","TIULC1",94,0)
 ;                 subclass to which it belongs
"RTN","TIULC1",95,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULC1",96,0)
 I +$G(TIUDA),+$$ISADDNDM(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULC1",97,0)
 S TIUI=$O(^TIU(8925.1,"AD",+TIUTYP,TIUI))
"RTN","TIULC1",98,0)
 I +TIUI'>0 G CLINDOX
"RTN","TIULC1",99,0)
 I TIUI=38 S TIUY=TIUTYP
"RTN","TIULC1",100,0)
 I TIUI'=38 S TIUY=$$CLINDOC(TIUI)
"RTN","TIULC1",101,0)
CLINDOX Q TIUY
"RTN","TIULC1",102,0)
REQVER(TIUTYP,TIUDA) ; Does a given document type require verification
"RTN","TIULC1",103,0)
 N TIUDPRM,TIUY
"RTN","TIULC1",104,0)
 I +$G(TIUDA),+$$ISADDNDM(TIUDA) S TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULC1",105,0)
 D DOCPRM(TIUTYP,.TIUDPRM)
"RTN","TIULC1",106,0)
 I +$P($G(TIUDPRM(0)),U,3) S TIUY=1
"RTN","TIULC1",107,0)
 Q +$G(TIUY)
"RTN","TIULC1",108,0)
REFDATE(TIU,TIUDICDT) ; Identify Reference date
"RTN","TIULC1",109,0)
 N TIURDT
"RTN","TIULC1",110,0)
 I +$G(TIU("LDT")) S TIURDT=+$G(TIU("LDT"))_"^0"
"RTN","TIULC1",111,0)
 I +$G(TIU("LDT"))'>0 D
"RTN","TIULC1",112,0)
 . S TIURDT=$S(+$G(TIUDICDT):+$G(TIUDICDT),1:+$$NOW^TIULC)_"^1"
"RTN","TIULC1",113,0)
 . S TIU("LDT")=TIURDT_U_$$DATE^TIULS(TIURDT,"AMTH DD, CCYY@HR:MIN:SEC")
"RTN","TIULC1",114,0)
 Q TIURDT
"RTN","TIULC1",115,0)
WHATMPL(USER) ; What List Template should a given user get?
"RTN","TIULC1",116,0)
 N TIUY
"RTN","TIULC1",117,0)
 I +$$ISA^USRLM(USER,"PROVIDER") S TIUY="TIU BROWSE FOR CLINICIAN" G WHAX
"RTN","TIULC1",118,0)
 I +$$ISA^USRLM(USER,"MEDICAL RECORDS TECHNICIAN") S TIUY="TIU BROWSE FOR MRT" G WHAX
"RTN","TIULC1",119,0)
 I +$$ISA^USRLM(USER,"CHIEF, MIS") S TIUY="TIU BROWSE FOR MGR" G WHAX
"RTN","TIULC1",120,0)
 I +$$ISA^USRLM(USER,"MEDICAL STUDENT") S TIUY="TIU BROWSE FOR CLINICIAN" G WHAX
"RTN","TIULC1",121,0)
 S TIUY="TIU BROWSE FOR READ ONLY"
"RTN","TIULC1",122,0)
WHAX Q TIUY
"RTN","TIULC1",123,0)
SUPPVSIT(TIUTYP) ; Evaluate whether to suppress visit matching
"RTN","TIULC1",124,0)
 N TIUI,TIUY S TIUY=0
"RTN","TIULC1",125,0)
 I +$P($G(^TIU(8925.1,+TIUTYP,3)),U,3) S TIUY=1 G SUPPVSIX
"RTN","TIULC1",126,0)
 I $L($P($G(^TIU(8925.1,+TIUTYP,3)),U,3)),($P($G(^(3)),U,3)=0) S TIUY=0 G SUPPVSIX ; ** SLC/JER - NOIS NYC-1298-11472
"RTN","TIULC1",127,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.1,"AD",+TIUTYP,TIUI)) Q:+TIUI'>0!(+TIUY>0)  D
"RTN","TIULC1",128,0)
 . S TIUY=+$$SUPPVSIT(+TIUI)
"RTN","TIULC1",129,0)
SUPPVSIX Q TIUY
"RTN","TIULC1",130,0)
PTNAME(DFN) ; Resolve Patient Name
"RTN","TIULC1",131,0)
 N TIUY S TIUY=$P($G(^DPT(DFN,0)),U)
"RTN","TIULC1",132,0)
 S:TIUY']"" TIUY="NAME UNKNOWN"
"RTN","TIULC1",133,0)
 Q TIUY
"RTN","TIULC1",134,0)
POSTSIGN(TIUTYP) ; Get Post-Signature Code, support inheritance
"RTN","TIULC1",135,0)
 N TIUPOST,TIUDAD
"RTN","TIULC1",136,0)
 S TIUPOST=$G(^TIU(8925.1,+TIUTYP,4.9))
"RTN","TIULC1",137,0)
 I TIUPOST]"" G POSTSIGX
"RTN","TIULC1",138,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",139,0)
 I +TIUDAD S TIUPOST=$$POSTSIGN(TIUDAD)
"RTN","TIULC1",140,0)
POSTSIGX Q TIUPOST
"RTN","TIULC1",141,0)
COMMIT(TIUTYP) ; Get Commitment action, support inheritance
"RTN","TIULC1",142,0)
 N TIUCOMM,TIUDAD
"RTN","TIULC1",143,0)
 S TIUCOMM=$G(^TIU(8925.1,+TIUTYP,4.1))
"RTN","TIULC1",144,0)
 I TIUCOMM]"" G COMMITX
"RTN","TIULC1",145,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",146,0)
 I +TIUDAD S TIUCOMM=$$COMMIT(TIUDAD)
"RTN","TIULC1",147,0)
COMMITX Q TIUCOMM
"RTN","TIULC1",148,0)
RELEASE(TIUTYP) ; Get Release Action, support inheritance
"RTN","TIULC1",149,0)
 N TIUREL,TIUDAD
"RTN","TIULC1",150,0)
 S TIUREL=$G(^TIU(8925.1,+TIUTYP,4.2))
"RTN","TIULC1",151,0)
 I TIUREL]"" G RELEASX
"RTN","TIULC1",152,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",153,0)
 I +TIUDAD S TIUREL=$$RELEASE(TIUDAD)
"RTN","TIULC1",154,0)
RELEASX Q TIUREL
"RTN","TIULC1",155,0)
VERIFY(TIUTYP) ; Get Verification action, support inheritance
"RTN","TIULC1",156,0)
 N TIUVER,TIUDAD
"RTN","TIULC1",157,0)
 S TIUVER=$G(^TIU(8925.1,+TIUTYP,4.3))
"RTN","TIULC1",158,0)
 I TIUVER]"" G VERIFYX
"RTN","TIULC1",159,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",160,0)
 I +TIUDAD S TIUVER=$$VERIFY(TIUDAD)
"RTN","TIULC1",161,0)
VERIFYX Q TIUVER
"RTN","TIULC1",162,0)
DELETE(TIUTYP) ; Get Delete Action, support inheritance
"RTN","TIULC1",163,0)
 N TIUDEL,TIUDAD
"RTN","TIULC1",164,0)
 S TIUDEL=$G(^TIU(8925.1,+TIUTYP,4.4))
"RTN","TIULC1",165,0)
 I TIUDEL]"" G DELETEX
"RTN","TIULC1",166,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",167,0)
 I +TIUDAD S TIUDEL=$$DELETE(TIUDAD)
"RTN","TIULC1",168,0)
DELETEX Q TIUDEL
"RTN","TIULC1",169,0)
REASSIGN(TIUTYP) ; Get Package Reassign Action, support inheritance
"RTN","TIULC1",170,0)
 N TIUREASS,TIUDAD
"RTN","TIULC1",171,0)
 S TIUREASS=$G(^TIU(8925.1,+TIUTYP,4.45))
"RTN","TIULC1",172,0)
 I TIUREASS]"" G REASSIX
"RTN","TIULC1",173,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIULC1",174,0)
 I +TIUDAD S TIUREASS=$$REASSIGN(TIUDAD)
"RTN","TIULC1",175,0)
REASSIX Q TIUREASS
"RTN","TIULM")
0^13^B7219067
"RTN","TIULM",1,0)
TIULM ; SLC/JER - List Manager Library: RESIZE, REMOVE Elmt, PICK List Elmt ; 3/9/01
"RTN","TIULM",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIULM",3,0)
RESIZE(LONG,SHORT,SHRINK) ; Resizes list area
"RTN","TIULM",4,0)
 N TIUBM S TIUBM=$S(VALMMENU:SHORT,+$G(SHRINK):SHORT,1:LONG)
"RTN","TIULM",5,0)
 I VALM("BM")'=TIUBM S VALMBCK="R" D
"RTN","TIULM",6,0)
 . S VALM("BM")=TIUBM,VALM("LINES")=(TIUBM-VALM("TM"))+1
"RTN","TIULM",7,0)
 . I +$G(VALMCC) D RESET^VALM4
"RTN","TIULM",8,0)
 Q
"RTN","TIULM",9,0)
PICK(TIUITEM) ; Highlight selected list elements, add to VALMY(ITEM) array
"RTN","TIULM",10,0)
 N TIUI,ITEM,LINE
"RTN","TIULM",11,0)
 ; **100** 4/11/00:
"RTN","TIULM",12,0)
 F TIUI=1:1:$L(TIUITEM,",") S ITEM=$P(TIUITEM,",",TIUI) Q:+ITEM'>0  D
"RTN","TIULM",13,0)
 . S LINE=+$O(@VALMAR@("PICK",+ITEM,0)) I '+LINE S LINE=ITEM
"RTN","TIULM",14,0)
 . I '$D(VALMY(ITEM)) D  I 1
"RTN","TIULM",15,0)
 . . D RESTORE^VALM10(LINE),CNTRL^VALM10(LINE,6,VALM("RM"),IORVON,IORVOFF)
"RTN","TIULM",16,0)
 . . D WRITE^VALM10(LINE)
"RTN","TIULM",17,0)
 . . S VALMY(ITEM)=""
"RTN","TIULM",18,0)
 . . ;**100**
"RTN","TIULM",19,0)
 . . I $G(TIUGLINK) D
"RTN","TIULM",20,0)
 . . . I $L(TIUITEM,",")>2 D
"RTN","TIULM",21,0)
 . . . . W !!,"You are now selecting ONE interdisciplinary parent note."
"RTN","TIULM",22,0)
 . . . . W !,"Acting on line ",+TIUITEM
"RTN","TIULM",23,0)
 . . . . W " as your parent note selection." H 5
"RTN","TIULM",24,0)
 . . . . S TIUITEM=+TIUITEM ; only want 1 ID parent
"RTN","TIULM",25,0)
 . . . D LKDAD^TIUGR2(TIUGLINK)
"RTN","TIULM",26,0)
 . . . K VALMY
"RTN","TIULM",27,0)
 . E  D
"RTN","TIULM",28,0)
 . . D RESTORE^VALM10(LINE),WRITE^VALM10(LINE)
"RTN","TIULM",29,0)
 . . K VALMY(ITEM)
"RTN","TIULM",30,0)
 ; D RE^VALM4 ; P100 took out, redundant
"RTN","TIULM",31,0)
 Q
"RTN","TIULM",32,0)
FIXLST ; Restore video attributes to entire list
"RTN","TIULM",33,0)
 N TIUI S TIUI=0
"RTN","TIULM",34,0)
 Q:'$D(VALMAR)
"RTN","TIULM",35,0)
 F  S TIUI=$O(^TMP("TIUR",$J,TIUI)) Q:+TIUI'>0  D
"RTN","TIULM",36,0)
 . I TIUI=$P($G(TIUGLINK),U,2) Q  ; See TIURL
"RTN","TIULM",37,0)
 . D RESTORE(TIUI)
"RTN","TIULM",38,0)
 Q
"RTN","TIULM",39,0)
FIXLSTNW ; Restore video attributes to entire list
"RTN","TIULM",40,0)
 ; New: Don't bold the list #
"RTN","TIULM",41,0)
 N TIUI S TIUI=0
"RTN","TIULM",42,0)
 Q:'$D(VALMAR)
"RTN","TIULM",43,0)
 F  S TIUI=$O(^TMP("TIUR",$J,TIUI)) Q:+TIUI'>0  D
"RTN","TIULM",44,0)
 . I TIUI=$P($G(TIUGLINK),U,2) Q  ; See TIURL
"RTN","TIULM",45,0)
 . D RESTORE^VALM10(TIUI)
"RTN","TIULM",46,0)
 Q
"RTN","TIULM",47,0)
RESTORE(ITEM) ; Restore video attributes for a single list element
"RTN","TIULM",48,0)
 D RESTORE^VALM10(ITEM),FLDCTRL^VALM10(ITEM,"NUMBER",IOINHI,IOINORM)
"RTN","TIULM",49,0)
 Q
"RTN","TIULM",50,0)
RESTOREG(TIUGLINK) ; Update video attributes after changing view,
"RTN","TIULM",51,0)
 ;for ID entry being attached, which probably moved to a different line.
"RTN","TIULM",52,0)
 N LINENO,NLINENO
"RTN","TIULM",53,0)
 Q:'$G(TIUGLINK)
"RTN","TIULM",54,0)
 S LINENO=$P(TIUGLINK,U,2)
"RTN","TIULM",55,0)
 S NLINENO=+$O(^TMP("TIUR",$J,"IEN",+TIUGLINK,0))
"RTN","TIULM",56,0)
 S $P(TIUGLINK,U,2)=NLINENO
"RTN","TIULM",57,0)
 I $D(^TMP("TIUR",$J,LINENO)) D RESTORE^VALM10(LINENO)
"RTN","TIULM",58,0)
 I $D(^TMP("TIUR",$J,NLINENO)) D
"RTN","TIULM",59,0)
 . D RESTORE^VALM10(NLINENO)
"RTN","TIULM",60,0)
 . D CNTRL^VALM10(NLINENO,6,VALM("RM"),IORVON,IORVOFF)
"RTN","TIULM",61,0)
 Q
"RTN","TIULM",62,0)
 ;
"RTN","TIULM",63,0)
REMOVE(ITEM) ; Remove an element from the list
"RTN","TIULM",64,0)
 ; No longer used since patch 100
"RTN","TIULM",65,0)
 ; Now called only by rtn TIUPPAC, an obsolete patient postings rtn.
"RTN","TIULM",66,0)
 N TIUREC S TIUREC=$G(^TMP("TIUR",$J,+ITEM,0))
"RTN","TIULM",67,0)
 S TIUREC=$$SETFLD^VALM1("deleted",TIUREC,"STATUS")
"RTN","TIULM",68,0)
 S ^TMP("TIUR",$J,+ITEM,0)=TIUREC
"RTN","TIULM",69,0)
 D RESTORE^VALM10(+ITEM),CNTRL^VALM10(+ITEM,6,VALM("RM"),IOINHI,IOINORM)
"RTN","TIULM",70,0)
 I $P(ITEM,U,2) D UPIDDATA^TIURL1($P(ITEM,U,2))
"RTN","TIULM",71,0)
 Q
"RTN","TIULP")
0^9^B30501674
"RTN","TIULP",1,0)
TIULP ; SLC/JER - Functions determining privilege ;3/3/01
"RTN","TIULP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**98,100**;Jun 20, 1997
"RTN","TIULP",3,0)
CANDO(TIUDA,TIUACT,PERSON) ; Can PERSON perform action now
"RTN","TIULP",4,0)
 ; Receives: TIUDA=Record number in file 8925
"RTN","TIULP",5,0)
 ;           TIUACT=Name of user action in 8930.8 (USR ACTION)
"RTN","TIULP",6,0)
 ;           PERSON=New Person file IFN.
"RTN","TIULP",7,0)
 ;                  Assumed to be DUZ if not received.
"RTN","TIULP",8,0)
 ;                  New **100** ID param, backward compatible.
"RTN","TIULP",9,0)
 ;  Returns:   TIUY=1:yes,0:no_"^"_why not message
"RTN","TIULP",10,0)
 ; tested: MAM 2/2/00
"RTN","TIULP",11,0)
 N TIUI,TIUTYP,TIUROLE,STATUS,TIUY,TIUATYP,MSG,WHO,MODIFIER
"RTN","TIULP",12,0)
 S TIUY=0 I '$G(PERSON) S PERSON=DUZ
"RTN","TIULP",13,0)
 ;**100** was I +TIUACT'>0 S TIUACT etc.
"RTN","TIULP",14,0)
 S TIUACT=$$USREVNT(TIUACT) I +TIUACT'>0 S TIUY=0 G CANDOX
"RTN","TIULP",15,0)
 ; -- In case business rules have changed, & children already existed:
"RTN","TIULP",16,0)
 I +TIUACT=24,$D(^TIU(8925,"GDAD",TIUDA)) D  G CANDOX
"RTN","TIULP",17,0)
 . S TIUY="0^ This note cannot be attached; it has its own children."
"RTN","TIULP",18,0)
 I +TIUACT=25,+$G(^TIU(8925,TIUDA,21)) D  G CANDOX
"RTN","TIULP",19,0)
 . S TIUY="0^ This note cannot receive ID children; it is itself a child."
"RTN","TIULP",20,0)
 I +TIUACT=4!(+TIUACT=5),+$$BLANK^TIULC(TIUDA) D  G CANDOX
"RTN","TIULP",21,0)
 . S TIUY="0^ Contains blanks ("_$P(TIUPRM1,U,6)_") which must be filled before "_$P(TIUACT,U,2)_"ATURE."
"RTN","TIULP",22,0)
 S TIUROLE=$$USRROLE(TIUDA,PERSON)
"RTN","TIULP",23,0)
 S STATUS=+$P($G(^TIU(8925,+TIUDA,0)),U,5)
"RTN","TIULP",24,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIULP",25,0)
 I $$ISADDNDM^TIULC1(+TIUDA) S TIUATYP=TIUTYP,TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULP",26,0)
 I TIUROLE']"" S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,PERSON)
"RTN","TIULP",27,0)
 F TIUI=1:1:($L(TIUROLE,U)-1) D  Q:+$G(TIUY)>0
"RTN","TIULP",28,0)
 . S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,PERSON,$P(TIUROLE,U,TIUI))
"RTN","TIULP",29,0)
 I +$G(TIUATYP) S TIUTYP=+$G(TIUATYP)
"RTN","TIULP",30,0)
 ;**100** update for PERSON param; update for verb modifier:
"RTN","TIULP",31,0)
 I +TIUY'>0 D
"RTN","TIULP",32,0)
 . S WHO=" You"
"RTN","TIULP",33,0)
 . I PERSON'=DUZ S WHO=$P(^VA(200,PERSON,0),U),WHO=$$NAME^TIULS(WHO,"FIRST LAST")
"RTN","TIULP",34,0)
 . S MODIFIER=$P(TIUACT,U,3) I $L(MODIFIER) S MODIFIER=" "_MODIFIER
"RTN","TIULP",35,0)
 . ;e.g. "You may not LINK this UNSIGNED TELEPHONE NOTE TO AN ID NOTE."
"RTN","TIULP",36,0)
 . S MSG=WHO_" may not "_$P(TIUACT,U,2)_" this "_$P($G(^TIU(8925.6,+STATUS,0)),U)_" "_$$PNAME^TIULC1(TIUTYP)_MODIFIER_"."
"RTN","TIULP",37,0)
 . S TIUY=TIUY_U_MSG
"RTN","TIULP",38,0)
CANDOX Q TIUY
"RTN","TIULP",39,0)
 ;
"RTN","TIULP",40,0)
CANLINK(TIUTYP) ; Can user (DUZ) link a document of a particular type
"RTN","TIULP",41,0)
 ;to an ID note.
"RTN","TIULP",42,0)
 ; For use in ADD NEW ID NOTE, where docmt is not entered yet.
"RTN","TIULP",43,0)
 ; Assume most favorable circumstances (user will complete
"RTN","TIULP",44,0)
 ;the note, so if user still can't link, can tell them no,
"RTN","TIULP",45,0)
 ;when they first select title for the new entry.
"RTN","TIULP",46,0)
 ; Rule out if TIUTYP can be an ID parent, since ID parent
"RTN","TIULP",47,0)
 ;and ID kid function as mutually exclusive, (regardless of
"RTN","TIULP",48,0)
 ;business rules).
"RTN","TIULP",49,0)
 N TIUACT,STATUS,USRROLE,TIUY
"RTN","TIULP",50,0)
 S TIUACT=$$USREVNT("ATTACH TO ID NOTE"),STATUS=7 ; complete
"RTN","TIULP",51,0)
 S USRROLE=+$O(^USR(8930.2,"B","COMPLETER",0))
"RTN","TIULP",52,0)
 S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,DUZ,USRROLE)
"RTN","TIULP",53,0)
 I '$G(TIUY) Q TIUY
"RTN","TIULP",54,0)
 ; -- If user can link a certain note, but note can also receive
"RTN","TIULP",55,0)
 ;    ID entries, don't let user link it. --
"RTN","TIULP",56,0)
 I $$POSSPRNT^TIULP(TIUTYP) S TIUY="0^ Business rules permit this note to be a parent, so it cannot be an ID child."
"RTN","TIULP",57,0)
 ; -- If selected type is a CWAD, don't let user link it: --
"RTN","TIULP",58,0)
 I $$ISCWAD^TIULX(TIUTYP) S TIUY="0^ CWAD notes cannot be used as interdisciplinary child entries."
"RTN","TIULP",59,0)
 ; -- If selected type is a consult, don't let user link it: --
"RTN","TIULP",60,0)
 I $$ISA^TIULX(TIUTYP,+$$CLASS^TIUCNSLT) S TIUY="0^ Consult notes cannot be used as interdisciplinary child entries."
"RTN","TIULP",61,0)
 Q TIUY
"RTN","TIULP",62,0)
 ;
"RTN","TIULP",63,0)
POSSPRNT(TIUTYP) ; Is a docmt intended as a possible ID parent?
"RTN","TIULP",64,0)
 ;Returns 1^WHYCAN'TATTACH if there are business rules permitting ANYONE
"RTN","TIULP",65,0)
 ;to LINK TO notes of type TIUTYP with an ID entry.
"RTN","TIULP",66,0)
 ;Else returns 0.
"RTN","TIULP",67,0)
 N TIUACT,STATUS,TIUY,DADTYP
"RTN","TIULP",68,0)
 S TIUY=0,TIUACT=+$$USREVNT("ATTACH ID ENTRY")
"RTN","TIULP",69,0)
 F STATUS=6,7,8 D  G:TIUY POSSX
"RTN","TIULP",70,0)
 . I $O(^USR(8930.1,"AR",TIUTYP,STATUS,TIUACT,0)) S TIUY=1 Q
"RTN","TIULP",71,0)
 . I $O(^USR(8930.1,"AC",TIUTYP,STATUS,TIUACT,0)) S TIUY=1
"RTN","TIULP",72,0)
 ; -- If no rules for TIUTYP, try its parent: --
"RTN","TIULP",73,0)
 S DADTYP=$O(^TIU(8925.1,"AD",TIUTYP,0)) G:DADTYP'>0 POSSX
"RTN","TIULP",74,0)
 S TIUY=$$POSSPRNT(DADTYP)
"RTN","TIULP",75,0)
POSSX I TIUY S TIUY="1^Business rules permit this note to be a parent, so it cannot be an ID child."
"RTN","TIULP",76,0)
 Q TIUY
"RTN","TIULP",77,0)
 ;
"RTN","TIULP",78,0)
CANENTR(TIUTYP) ; Evaluate privilege to enter a document of a particular type
"RTN","TIULP",79,0)
 N TIUACT,STATUS,USRROLE,TIUY
"RTN","TIULP",80,0)
 S TIUACT=$$USREVNT("ENTRY"),STATUS=2 ; untranscribed
"RTN","TIULP",81,0)
 S USRROLE=3 ; transcriber
"RTN","TIULP",82,0)
 S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,DUZ,USRROLE)
"RTN","TIULP",83,0)
 Q TIUY
"RTN","TIULP",84,0)
USRROLE(TIUDA,PERSON) ; Identify the user's role with respect to the document
"RTN","TIULP",85,0)
 ; 3/20/00 **100** Added role COMPLETER
"RTN","TIULP",86,0)
 ; 3/20/00 **100** Added PERSON param
"RTN","TIULP",87,0)
 N TIU0,TIU12,TIU13,TIUY,TIU15,COMPLTR,STATUS
"RTN","TIULP",88,0)
 S PERSON=$G(PERSON,DUZ)
"RTN","TIULP",89,0)
 S TIU0=$G(^TIU(8925,+TIUDA,0)),STATUS=$P(TIU0,U,5)
"RTN","TIULP",90,0)
 S TIU12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIULP",91,0)
 S TIU13=$G(^TIU(8925,+TIUDA,13)),TIU15=$G(^TIU(8925,+TIUDA,15))
"RTN","TIULP",92,0)
 I PERSON=+$P(TIU13,U,2) S TIUY=+$O(^USR(8930.2,"B","TRANSCRIBER",0))_U
"RTN","TIULP",93,0)
 I PERSON=+$P(TIU12,U,2) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","AUTHOR/DICTATOR",0))_U
"RTN","TIULP",94,0)
 I PERSON=+$P(TIU12,U,9) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","ATTENDING PHYSICIAN",0))_U
"RTN","TIULP",95,0)
 I PERSON=+$P(TIU12,U,4) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","EXPECTED SIGNER",0))_U
"RTN","TIULP",96,0)
 I PERSON=+$P(TIU12,U,8) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","EXPECTED COSIGNER",0))_U
"RTN","TIULP",97,0)
 I STATUS>6 D  I COMPLTR S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","COMPLETER",0))_U
"RTN","TIULP",98,0)
 . S COMPLTR=0
"RTN","TIULP",99,0)
 . I PERSON=+$P(TIU15,U,8) S COMPLTR=1 Q
"RTN","TIULP",100,0)
 . I '$P(TIU15,U,8),PERSON=+$P(TIU15,U,2) S COMPLTR=1
"RTN","TIULP",101,0)
 I +$O(^TIU(8925.7,"AE",+TIUDA,+PERSON,0)) D
"RTN","TIULP",102,0)
 . N TIUXTRA S TIUXTRA=+$O(^TIU(8925.7,"AE",+TIUDA,+PERSON,0))
"RTN","TIULP",103,0)
 . I +$P($G(^TIU(8925.7,+TIUXTRA,0)),U,4) Q
"RTN","TIULP",104,0)
 . S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","ADDITIONAL SIGNER",0))_U
"RTN","TIULP",105,0)
 Q $G(TIUY)
"RTN","TIULP",106,0)
USREVNT(EVENT) ; Given event name, return:
"RTN","TIULP",107,0)
 ;EVENT = event pointer^user verb^verb modifier
"RTN","TIULP",108,0)
 ; **100** added verb modifier piece (.07)
"RTN","TIULP",109,0)
 N TIUY,TIUDA,NODE0
"RTN","TIULP",110,0)
 S TIUDA=+$O(^USR(8930.8,"B",EVENT,0))
"RTN","TIULP",111,0)
 S NODE0=$G(^USR(8930.8,TIUDA,0))
"RTN","TIULP",112,0)
 S TIUY=TIUDA_U_$P(NODE0,U,5)_U_$P(NODE0,U,7)
"RTN","TIULP",113,0)
 Q TIUY
"RTN","TIULP",114,0)
CANPICK(TIUTYP) ; Screens selection of title by title status and
"RTN","TIULP",115,0)
 ;(for status TEST), by owner.
"RTN","TIULP",116,0)
 N TIUPOWN,TIUCOWN,TIUT0,TIUTSTAT,TIUY S TIUY=0
"RTN","TIULP",117,0)
 S TIUT0=$G(^TIU(8925.1,+TIUTYP,0)),TIUTSTAT=$P(TIUT0,U,7)
"RTN","TIULP",118,0)
 I TIUTSTAT']"" S TIUY=0 G CANPIX
"RTN","TIULP",119,0)
 I TIUTSTAT=13 S TIUY=0 G CANPIX
"RTN","TIULP",120,0)
 I TIUTSTAT=11 S TIUY=1 G CANPIX
"RTN","TIULP",121,0)
 S TIUPOWN=$P(TIUT0,U,5),TIUCOWN=+$P(TIUT0,U,6)
"RTN","TIULP",122,0)
 I TIUTSTAT=10 S TIUY=$S(TIUPOWN=DUZ:1,+$$ISA^USRLM(DUZ,TIUCOWN):1,1:0)
"RTN","TIULP",123,0)
CANPIX Q +$G(TIUY)
"RTN","TIULP",124,0)
REQCOSIG(TIUTYP,TIUDA,USER) ; Evaluate whether user requires cosignature
"RTN","TIULP",125,0)
 N TIUI,TIUY S USER=$S(+$G(USER):+$G(USER),1:+$G(DUZ))
"RTN","TIULP",126,0)
 I '$D(TIUDPRM) D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,+$G(TIUDA))
"RTN","TIULP",127,0)
 I $G(TIUDPRM(5))="" G REQCOSX
"RTN","TIULP",128,0)
 F TIUI=1:1:$L(TIUDPRM(5),U) D  Q:+TIUY>0
"RTN","TIULP",129,0)
 . S TIUY=+$$ISA^USRLM(+USER,+$P(TIUDPRM(5),U,TIUI))
"RTN","TIULP",130,0)
REQCOSX Q +$G(TIUY)
"RTN","TIULQ")
0^88^B13973581
"RTN","TIULQ",1,0)
TIULQ ; SLC/JER - Record Extract Using FM Retriever ;3/22/01
"RTN","TIULQ",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,100**;Jun 20, 1997
"RTN","TIULQ",3,0)
EXTRACT(TIUDA,TIUROOT,TIUERR,DR,TIULINE,TIUTEXT,FORMAT,OVRRIDE,ORIGCHLD) ; Gets record & addenda and ID kids
"RTN","TIULQ",4,0)
 ; Do we need a new DBIA here? MARGY
"RTN","TIULQ",5,0)
 N DA,DIC,DIQ,TIULQ,X,Y
"RTN","TIULQ",6,0)
 S TIUROOT=$G(TIUROOT,"^TMP(""TIULQ"",$J)")
"RTN","TIULQ",7,0)
 S DA=TIUDA,DIC=8925,DIQ="TIULQ",DIQ(0)=$G(FORMAT,"IE")
"RTN","TIULQ",8,0)
 I $G(DR)']"" S DR=".01:.1;1201:1701"
"RTN","TIULQ",9,0)
 D EN^DIQ1
"RTN","TIULQ",10,0)
 I '$D(TIULQ) S TIUERR="1^ Record Extract Failed"
"RTN","TIULQ",11,0)
 M @TIUROOT@(TIUDA)=TIULQ(8925,TIUDA)
"RTN","TIULQ",12,0)
 D XTRASIGN(DA,+$G(TIULINE))
"RTN","TIULQ",13,0)
 D PROBLEMS(DA,+$G(TIULINE))
"RTN","TIULQ",14,0)
 I +$G(TIUTEXT) D TEXT(TIUDA,+$G(TIULINE),TIUDA,+$G(OVRRIDE),+$G(ORIGCHLD))
"RTN","TIULQ",15,0)
 Q
"RTN","TIULQ",16,0)
XTRASIGN(TIUDA,TIUJ) ; Get Extra Signers
"RTN","TIULQ",17,0)
 N TIUI,TIUXTRA,TIUC,DR,DIC,DIQ S TIUI=0
"RTN","TIULQ",18,0)
 F  S TIUI=$O(^TIU(8925.7,"B",+TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIULQ",19,0)
 . N TIUDT,TIUSGN,TIUSNM,TIUSTTL
"RTN","TIULQ",20,0)
 . S DA=TIUI,DR=".04:.07",DIC="^TIU(8925.7,",DIQ="TIUXTRA",DIQ(0)="IE"
"RTN","TIULQ",21,0)
 . D EN^DIQ1 Q:$D(TIUXTRA)'>9
"RTN","TIULQ",22,0)
 . S TIUC=+$G(TIUC)+1
"RTN","TIULQ",23,0)
 . S TIUDT=$G(TIUXTRA(8925.7,DA,.04,"I"))
"RTN","TIULQ",24,0)
 . S TIUSGN=$G(TIUXTRA(8925.7,DA,.05,"I"))
"RTN","TIULQ",25,0)
 . S TIUSNM=$G(TIUXTRA(8925.7,DA,.06,"E"))
"RTN","TIULQ",26,0)
 . S TIUSTTL=$G(TIUXTRA(8925.7,DA,.07,"E"))
"RTN","TIULQ",27,0)
 . S @TIUROOT@(TIUDA,"EXTRASGNR",(TIUJ+TIUC),"DATE")=TIUDT
"RTN","TIULQ",28,0)
 . S @TIUROOT@(TIUDA,"EXTRASGNR",(TIUJ+TIUC),"EXTRA")=TIUSGN
"RTN","TIULQ",29,0)
 . S @TIUROOT@(TIUDA,"EXTRASGNR",(TIUJ+TIUC),"NAME")=TIUSNM
"RTN","TIULQ",30,0)
 . S @TIUROOT@(TIUDA,"EXTRASGNR",(TIUJ+TIUC),"TITLE")=TIUSTTL
"RTN","TIULQ",31,0)
 Q
"RTN","TIULQ",32,0)
PROBLEMS(TIUDA,TIUJ) ; Get associated problems
"RTN","TIULQ",33,0)
 N TIUI,TIUP,TIUPROB,TIUC,TIUX,DR,DIC,DIQ S TIUI=0
"RTN","TIULQ",34,0)
 F  S TIUI=$O(^TIU(8925.9,"B",+TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIULQ",35,0)
 . S DA=TIUI,DR=".02;.05",DIC="^TIU(8925.9,",DIQ="TIUPROB"
"RTN","TIULQ",36,0)
 . D EN^DIQ1 Q:$D(TIUPROB)'>9
"RTN","TIULQ",37,0)
 . S TIUC=+$G(TIUC)+1
"RTN","TIULQ",38,0)
 . S TIUP=$$MIXED^TIULS($G(TIUPROB(8925.9,TIUI,.05)))
"RTN","TIULQ",39,0)
 . S TIUX=$$SETSTR^VALM1($J(TIUC,2)_".",$G(TIUX),1,3)
"RTN","TIULQ",40,0)
 . S TIUX=$$SETSTR^VALM1(TIUP,$G(TIUX),5,35)
"RTN","TIULQ",41,0)
 . S TIUP=$G(TIUPROB(8925.9,TIUI,.02))
"RTN","TIULQ",42,0)
 . S TIUX=$$SETSTR^VALM1(TIUP,$G(TIUX),40,6)
"RTN","TIULQ",43,0)
 . S @TIUROOT@(TIUDA,"PROBLEM",(TIUJ+TIUC),0)=TIUX
"RTN","TIULQ",44,0)
 Q
"RTN","TIULQ",45,0)
TEXT(TIUDA,TIUJ,TIUDAD,TIUOVR,ORIGCHLD) ; Get each component
"RTN","TIULQ",46,0)
 N TIUKID,TIUDADT,TIUI,TIUD0,TIULVL,CANPRINT S TIUI=0
"RTN","TIULQ",47,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIULVL=$P($G(^TIU(8925.1,+TIUD0,0)),U,4)
"RTN","TIULQ",48,0)
 S CANPRINT=$S(TIULVL="DOC":$$CANDO^TIULP(TIUDA,"PRINT RECORD"),1:1)
"RTN","TIULQ",49,0)
 I +TIUOVR'>0,(+CANPRINT'>0) D  Q
"RTN","TIULQ",50,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIULQ",51,0)
 . S @TIUROOT@(TIUDAD,"TEXT",TIUJ,0)=$P(CANPRINT,U,2)
"RTN","TIULQ",52,0)
 . S @TIUROOT@(TIUDAD,"TEXT",0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIULQ",53,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIULQ",54,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIULQ",55,0)
 . S @TIUROOT@(TIUDAD,"TEXT",TIUJ,0)=$G(^TIU(8925,+TIUDA,"TEXT",TIUI,0))
"RTN","TIULQ",56,0)
 S @TIUROOT@(TIUDAD,"TEXT",0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIULQ",57,0)
 ; Iterate through children, and get their text fields
"RTN","TIULQ",58,0)
 S TIUKID=0
"RTN","TIULQ",59,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIULQ",60,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D
"RTN","TIULQ",61,0)
 . . N TIUADRT
"RTN","TIULQ",62,0)
 . . I TIUROOT[")" S TIUADRT=$P(TIUROOT,")")_","_TIUDAD_",""ZADD"")"
"RTN","TIULQ",63,0)
 . . E  S TIUADRT=TIUROOT_"("_TIUDAD_",""ZADD"")"
"RTN","TIULQ",64,0)
 . . D EXTRACT(TIUKID,TIUADRT,.TIUERR,DR,.TIUJ,1) I 1
"RTN","TIULQ",65,0)
 . E  D TEXT(TIUKID,.TIUJ,TIUDAD,+$G(TIUOVR))
"RTN","TIULQ",66,0)
 ; Get ID kids in correct sort order; extract data for each kid:
"RTN","TIULQ",67,0)
 Q:'$O(^TIU(8925,"GDAD",TIUDA,0))
"RTN","TIULQ",68,0)
 N TIUGDATA,TIUSORT,TIUK,TIUIDKID,TIUIDRT,CTR
"RTN","TIULQ",69,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIULQ",70,0)
 S TIUSORT=$P(TIUGDATA,U,4)
"RTN","TIULQ",71,0)
 D GETIDKID^TIURECL2(TIUDA,TIUSORT)
"RTN","TIULQ",72,0)
 S TIUK=0,CTR=0
"RTN","TIULQ",73,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:'TIUK  D
"RTN","TIULQ",74,0)
 . S TIUIDKID=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIULQ",75,0)
 . N TIUIDRT
"RTN","TIULQ",76,0)
 . I TIUROOT[")" S TIUIDRT=$P(TIUROOT,")")_","_TIUDAD_",""ZZID"","_TIUK_")"
"RTN","TIULQ",77,0)
 . E  S TIUIDRT=TIUROOT_"("_TIUDAD_",""ZZID"","_TIUK_")"
"RTN","TIULQ",78,0)
 . D EXTRACT(TIUIDKID,TIUIDRT,.TIUERR,DR,.TIUJ,1)
"RTN","TIULQ",79,0)
 . S CTR=CTR+1
"RTN","TIULQ",80,0)
 I CTR S @TIUROOT@(TIUDAD,"ZZID",0)=CTR ; How many ID kids TIUDAD has
"RTN","TIULQ",81,0)
 ;I CTR,$G(ORIGCHLD) S @TIUROOT@(TIUDAD,"REASON")="Note included because interdisciplinary child meets criteria."
"RTN","TIULQ",82,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIULQ",83,0)
 Q
"RTN","TIULX")
0^45^B43149986
"RTN","TIULX",1,0)
TIULX ; SLC/JER - Cross-reference library functions ;1/9/01
"RTN","TIULX",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,28,79,100**;Jun 20, 1997
"RTN","TIULX",3,0)
ALOCP(DA) ; Should record be included in daily print queue by location?
"RTN","TIULX",4,0)
 ; Receives DA = record # in 8925
"RTN","TIULX",5,0)
 Q +$$ISPN(+$G(^TIU(8925,+DA,0)))
"RTN","TIULX",6,0)
APTP(DA) ; Should record be included in daily print queue by patient?
"RTN","TIULX",7,0)
 ; Receives DA = record # in 8925
"RTN","TIULX",8,0)
 Q +$$ISPN(+$G(^TIU(8925,+DA,0)))
"RTN","TIULX",9,0)
AAUP(DA) ; Should record be included in daily print queue by author?
"RTN","TIULX",10,0)
 ; Receives DA = record # in 8925
"RTN","TIULX",11,0)
 Q +$$ISPN(+$G(^TIU(8925,+DA,0)))
"RTN","TIULX",12,0)
BELONGS(TIUDA,CLASS) ; Evaluate whether a given document belongs to a
"RTN","TIULX",13,0)
 ;                 particular document class
"RTN","TIULX",14,0)
 N TIUY
"RTN","TIULX",15,0)
 I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=+$P($G(^TIU(8925,+TIUDA,0)),U,6)
"RTN","TIULX",16,0)
 S TIUY=+$$ISA(+$G(^TIU(8925,+TIUDA,0)),CLASS)
"RTN","TIULX",17,0)
 Q TIUY
"RTN","TIULX",18,0)
ISA(DA,CLASS) ; Evaluate whether a given document type is a member of a
"RTN","TIULX",19,0)
 ;         particular document class
"RTN","TIULX",20,0)
 ; Receives DA = record # in 8925.1, and
"RTN","TIULX",21,0)
 ;       CLASS = record # of class in 8925.1
"RTN","TIULX",22,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULX",23,0)
 F  S TIUI=$O(^TIU(8925.1,"AD",DA,TIUI)) Q:+TIUI'>0!(TIUY=1)  D
"RTN","TIULX",24,0)
 . I TIUI=CLASS S TIUY=1 Q
"RTN","TIULX",25,0)
 . S TIUY=$$ISA(TIUI,CLASS)
"RTN","TIULX",26,0)
 Q TIUY
"RTN","TIULX",27,0)
ISPN(DA) ; Evaluate whether a given document is a Progress Note
"RTN","TIULX",28,0)
 ; Receives DA = record # in 8925.1
"RTN","TIULX",29,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULX",30,0)
 F  S TIUI=$O(^TIU(8925.1,"AD",DA,TIUI)) Q:+TIUI'>0!(TIUY=1)  D
"RTN","TIULX",31,0)
 . I TIUI=3 S TIUY=1 Q
"RTN","TIULX",32,0)
 . S TIUY=$$ISPN(TIUI)
"RTN","TIULX",33,0)
 Q TIUY
"RTN","TIULX",34,0)
ISCWAD(DA) ; Evaluate whether a given title is a CWAD
"RTN","TIULX",35,0)
 ;Is the given title in a CWAD document class?
"RTN","TIULX",36,0)
 ;New for ID notes
"RTN","TIULX",37,0)
 ; Receives DA = record # in 8925.1
"RTN","TIULX",38,0)
 N TIUDC,TIUY S TIUY=0
"RTN","TIULX",39,0)
 S TIUDC=$O(^TIU(8925.1,"AD",DA,0)) Q:+TIUDC'>0!(TIUY=1)  D
"RTN","TIULX",40,0)
 . I TIUDC=25 S TIUY=1 Q
"RTN","TIULX",41,0)
 . I TIUDC=27 S TIUY=1 Q
"RTN","TIULX",42,0)
 . I TIUDC=30 S TIUY=1 Q
"RTN","TIULX",43,0)
 . I TIUDC=31 S TIUY=1 Q
"RTN","TIULX",44,0)
 Q TIUY
"RTN","TIULX",45,0)
ISDS(DA) ; Evaluate whether a given document is a Discharge Summary
"RTN","TIULX",46,0)
 ; Receives DA = record # in 8925.1
"RTN","TIULX",47,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULX",48,0)
 F  S TIUI=$O(^TIU(8925.1,"AD",DA,TIUI)) Q:+TIUI'>0!(TIUY=1)  D
"RTN","TIULX",49,0)
 . I TIUI=244 S TIUY=1 Q
"RTN","TIULX",50,0)
 . S TIUY=$$ISDS(TIUI)
"RTN","TIULX",51,0)
 Q TIUY
"RTN","TIULX",52,0)
TRNSFRM(RTYPE,FLD,X) ; Executes Transform code for a given header field
"RTN","TIULX",53,0)
 N XFORM
"RTN","TIULX",54,0)
 S FLD=$O(^TIU(8925.1,+RTYPE("TYPE"),"HEAD","D",+FLD,0))
"RTN","TIULX",55,0)
 I +FLD'>0 G TRNSFRMX
"RTN","TIULX",56,0)
 S XFORM=$G(^TIU(8925.1,+RTYPE("TYPE"),"HEAD",+FLD,1))
"RTN","TIULX",57,0)
 I XFORM']"" G TRNSFRMX
"RTN","TIULX",58,0)
 X XFORM
"RTN","TIULX",59,0)
TRNSFRMX Q X
"RTN","TIULX",60,0)
MENUS ; Evaluate/enforce user's menu display preference
"RTN","TIULX",61,0)
 N TIUI,TIUPREF S TIUPREF=$$PERSPRF^TIULE(DUZ),TIUI=0
"RTN","TIULX",62,0)
 F  S TIUI=$O(^DISV(DUZ,"VALMMENU",TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",63,0)
 . I $P($G(^ORD(101,+TIUI,0)),U)["TIU" S ^DISV(DUZ,"VALMMENU",TIUI)=$S($P(TIUPREF,U,5)=0:0,1:1)
"RTN","TIULX",64,0)
 Q
"RTN","TIULX",65,0)
XTRASIGN(TIUY,TIUDA) ; Get list of extra signers for a document
"RTN","TIULX",66,0)
 N TIUI,TIUJ,TIUL,DA,DR,DIC,DIQ,TIUXTRA S (TIUI,TIUJ,TIUL)=0
"RTN","TIULX",67,0)
 S DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIULX",68,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",69,0)
 . N TIUX,TIUSGNR
"RTN","TIULX",70,0)
 . S DA=TIUI,DR=".03;.04" D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIULX",71,0)
 . I $L($G(TIUXTRA(8925.7,DA,.04))) Q
"RTN","TIULX",72,0)
 . S TIUJ=+$G(TIUJ)+1,TIUL=+$G(TIUL)+1
"RTN","TIULX",73,0)
 . S TIUSGNR=$G(TIUXTRA(8925.7,DA,.03))
"RTN","TIULX",74,0)
 . S TIUX=$$SETSTR^VALM1($G(TIUJ)_")  "_TIUSGNR,$G(TIUX),1,39)
"RTN","TIULX",75,0)
 . S TIUY(TIUL)=DA_U_TIUX
"RTN","TIULX",76,0)
 Q
"RTN","TIULX",77,0)
ASKSIGN(TIUY) ; Identify which Signature to edit
"RTN","TIULX",78,0)
 N I,L,Y
"RTN","TIULX",79,0)
 W !!,"Please Indicate Which Expected Signer to Change:",!
"RTN","TIULX",80,0)
 S (I,L,Y)=0 F  S I=$O(TIUY(I)) Q:+I'>0!+Y  D
"RTN","TIULX",81,0)
 . W:$P(TIUY(I),U)]"" !,$P(TIUY(I),U,2)
"RTN","TIULX",82,0)
 . I I#20=0 S Y=$P($$PICK(1,I,"Select Signer","NO"),U)
"RTN","TIULX",83,0)
 . S L=I
"RTN","TIULX",84,0)
 I L#20,'+Y S Y=$P($$PICK(1,L,"Select Signer","NO"),U)
"RTN","TIULX",85,0)
 I +Y,+$G(TIUY(+Y)) S Y=+$G(TIUY(+Y))
"RTN","TIULX",86,0)
 Q Y
"RTN","TIULX",87,0)
PICK(LOW,HIGH,PROMPT,TYPE) ; List selection
"RTN","TIULX",88,0)
 N X,Y S PROMPT=$G(PROMPT,"Select Item"),TYPE=$G(TYPE,"LO")
"RTN","TIULX",89,0)
 W !
"RTN","TIULX",90,0)
 S Y=$$READ^TIUU(TYPE_U_LOW_":"_HIGH,PROMPT)
"RTN","TIULX",91,0)
 W !
"RTN","TIULX",92,0)
 Q Y
"RTN","TIULX",93,0)
CWAD ; Entry action for CWAD protocol
"RTN","TIULX",94,0)
 N GMRPALG,GMRPCWAD,GMRPDFN,GMRPOPT,GMRPEN,GMRPAGE,GMRPCWAD,GMRPDOB
"RTN","TIULX",95,0)
 N GMRPLOC,GMRPRB,GMRPSSN,GMRPQT
"RTN","TIULX",96,0)
 I $G(TIUGLINK) W !,"Please finish attaching the interdisciplinay note before displaying alerts.",! H 3 Q
"RTN","TIULX",97,0)
 D FULL^VALM1
"RTN","TIULX",98,0)
 I '+$G(DFN),'+$G(ORVP) D  Q
"RTN","TIULX",99,0)
 . W !!,"No Patient Selected...",!
"RTN","TIULX",100,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIULX",101,0)
 . S VALMBCK="R"
"RTN","TIULX",102,0)
 D PAT^GMRPNOR1 I $D(GMRPQT) S VALMBCK="R" Q
"RTN","TIULX",103,0)
 S Y=GMRPDFN,GMRPOPT=1,GMRPEN=1 W !!,"** Current Patient:  "_$P(Y,U,2)
"RTN","TIULX",104,0)
 D ENPAT^GMRPNCW S VALMBCK="R"
"RTN","TIULX",105,0)
 Q
"RTN","TIULX",106,0)
IDSIGNRS(TIUY,TIUDA,TIULIST) ; Add list of Add'l Signers for a TIU Document
"RTN","TIULX",107,0)
 ; TIULIST(TIUI) [By Ref] = array of users to add/remove as signers
"RTN","TIULX",108,0)
 ; TIUDA                  = IEN in ^TIU(8925,
"RTN","TIULX",109,0)
 N TIUI S TIUI=0
"RTN","TIULX",110,0)
 F  S TIUI=$O(TIULIST(TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",111,0)
 . N DA,DIC,DLAYGO,DIE,DR,X,Y
"RTN","TIULX",112,0)
 . ; if current user is already an additional signer, and current user
"RTN","TIULX",113,0)
 . ; is NOT being removed as an additional signer, then QUIT
"RTN","TIULX",114,0)
 . I +$O(^TIU(8925.7,"AE",TIUDA,+TIULIST(TIUI),0)),($P(TIULIST(TIUI),U,3)'="REMOVE") Q
"RTN","TIULX",115,0)
 . ; if current user is being removed as a cosigner, then remove him
"RTN","TIULX",116,0)
 . I $P(TIULIST(TIUI),U,3)="REMOVE" D REMSIGNR(TIUDA,+TIULIST(TIUI)) Q
"RTN","TIULX",117,0)
 . ; otherwise, add the current user as an additional signer
"RTN","TIULX",118,0)
 . S X=""""_"`"_TIUDA_"""",(DIC,DLAYGO)=8925.7,DIC(0)="LX" D ^DIC Q:+Y'>0
"RTN","TIULX",119,0)
 . S DIE=DIC,TIUY=$G(TIUY)_$S($G(TIUY)]"":U,1:"")_+TIULIST(TIUI)
"RTN","TIULX",120,0)
 . S DR=".02////"_0_";.03////"_+$G(TIULIST(TIUI))
"RTN","TIULX",121,0)
 . D ^DIE
"RTN","TIULX",122,0)
 . D SEND^TIUALRT(TIUDA)
"RTN","TIULX",123,0)
 Q
"RTN","TIULX",124,0)
REMSIGNR(TIUDA,TIUDUZ) ; Remove user from additional signer list
"RTN","TIULX",125,0)
 N DA,DIE,DR,DIDEL
"RTN","TIULX",126,0)
 S DA=+$O(^TIU(8925.7,"AE",TIUDA,TIUDUZ,0)) Q:+DA'>0
"RTN","TIULX",127,0)
 S (DIDEL,DIE)=8925.7,DR=".01///@" D ^DIE
"RTN","TIULX",128,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIULX",129,0)
 Q
"RTN","TIULX",130,0)
GETSIGNR(TIUY,TIUDA) ; RPC to Get list of extra signers for a document
"RTN","TIULX",131,0)
 N TIUI,DA,DR,DIC,DIQ,TIUXTRA,TIUD12,TIUAU,TIUEC S (DA,TIUI)=0
"RTN","TIULX",132,0)
 S DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIULX",133,0)
 F  S DA=$O(^TIU(8925.7,"B",TIUDA,DA)) Q:+DA'>0  D
"RTN","TIULX",134,0)
 . N TIUX,TIUSGNR
"RTN","TIULX",135,0)
 . S DR=".03;.04",DIQ(0)="IE" D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIULX",136,0)
 . I +$G(TIUXTRA(8925.7,DA,.04,"I")) Q
"RTN","TIULX",137,0)
 . S TIUI=+$G(TIUI)+1
"RTN","TIULX",138,0)
 . S TIUY(TIUI)=$G(TIUXTRA(8925.7,DA,.03,"I"))_U_$G(TIUXTRA(8925.7,DA,.03,"E"))
"RTN","TIULX",139,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIULX",140,0)
 S TIUAU=$P(TIUD12,U,4),TIUEC=$P(TIUD12,U,8)
"RTN","TIULX",141,0)
 S TIUI=+$G(TIUI)+1,TIUY(TIUI)=TIUAU_U_$$PERSNAME^TIULC1(TIUAU)_U_"AUTHOR"
"RTN","TIULX",142,0)
 I $S(+TIUEC'>0:1,'$L($G(^VA(200,+TIUEC,0))):1,1:0) Q
"RTN","TIULX",143,0)
 S TIUI=+$G(TIUI)+1,TIUY(TIUI)=TIUEC_U_$$PERSNAME^TIULC1(TIUEC)_U_"EXPECTED COSIGNER"
"RTN","TIULX",144,0)
 Q
"RTN","TIULX",145,0)
HASDS(DFN,VSTR) ; Does an admission have a Discharge Summary?
"RTN","TIULX",146,0)
 N TITLE,TIUDA S (TITLE,TIUDA)=0
"RTN","TIULX",147,0)
 F  S TITLE=$O(^TIU(8925,"APTLD",DFN,TITLE)) Q:+TITLE'>0  D  Q:+TIUDA>0
"RTN","TIULX",148,0)
 . N STATUS,CONTEXT
"RTN","TIULX",149,0)
 . I '+$$ISDS(TITLE) S TIUDA=0_U_0 Q
"RTN","TIULX",150,0)
 . S TIUDA=+$O(^TIU(8925,"APTLD",DFN,TITLE,VSTR,0))
"RTN","TIULX",151,0)
 . S STATUS=$S(+TIUDA:$P($G(^TIU(8925,+TIUDA,0)),U,5),1:0)
"RTN","TIULX",152,0)
 . S CONTEXT=$S(STATUS=0:0,STATUS=5:2,1:1),TIUDA=TIUDA_U_CONTEXT
"RTN","TIULX",153,0)
 I '+TIUDA,($L(TIUDA,U)<2) S TIUDA=TIUDA_U_0
"RTN","TIULX",154,0)
 Q TIUDA
"RTN","TIULX",155,0)
NEEDSIG(TIUY,USER,CLASS)        ; Get list of documents for which USER is an additional signer
"RTN","TIULX",156,0)
 N TIUDA,TIUI,TIUJ S (TIUDA,TIUJ)=0
"RTN","TIULX",157,0)
 S USER=$G(USER,DUZ),CLASS=$G(CLASS,38),TIUY=$NA(^TMP("TIUSIGN",$J))
"RTN","TIULX",158,0)
 K @TIUY ; Clear out return array before query
"RTN","TIULX",159,0)
 F  S TIUDA=$O(^TIU(8925.7,"AES",USER,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIULX",160,0)
 . S TIUI=0 F  S TIUI=$O(^TIU(8925.7,"AES",USER,TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",161,0)
 . . N TIUD0 S TIUD0=$G(^TIU(8925.7,TIUI,0)) Q:+$P(TIUD0,U,4)
"RTN","TIULX",162,0)
 . . Q:'+$$ISA(+$G(^TIU(8925,TIUDA,0)),CLASS)
"RTN","TIULX",163,0)
 . . S TIUJ=+$G(TIUJ)+1,@TIUY@(TIUJ)=TIUDA
"RTN","TIULX",164,0)
 Q
"RTN","TIULX",165,0)
         
"RTN","TIUPD")
0^97^B24674329
"RTN","TIUPD",1,0)
TIUPD ; SLC/JER - Background Print Driver ;4/11/01
"RTN","TIUPD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,89,100**;Jun 20, 1997
"RTN","TIUPD",3,0)
MAIN(DA,TIUACT) ; Control Branching
"RTN","TIUPD",4,0)
 ;  TIUACT=R ==> Release from transcription,
"RTN","TIUPD",5,0)
 ;         V ==> Verified by MAS,
"RTN","TIUPD",6,0)
 ;         A ==> AMENDED by Privacy Act Officer
"RTN","TIUPD",7,0)
 ;         S ==> On completion by electronic signature by appropriate
"RTN","TIUPD",8,0)
 ;               person (i.e., author or expected cosigner)
"RTN","TIUPD",9,0)
 ; TIUSTAT=1 ==> STAT urgency,
"RTN","TIUPD",10,0)
 ;   TIURP=routine print event(s)
"RTN","TIUPD",11,0)
 ;   TIUSP=stat print event(s)
"RTN","TIUPD",12,0)
 N TIUSTAT,TIURP,TIUSP,TIUDPARM
"RTN","TIUPD",13,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,+DA,0)),.TIUDPARM,+DA)
"RTN","TIUPD",14,0)
 Q:+$P($G(TIUDPARM(0)),U,8)>0!(+$G(TIUDPARM(0))'>0)
"RTN","TIUPD",15,0)
 Q:$G(TIUACT)=""!("ARVS"'[TIUACT)!(+$G(DA)'>0)
"RTN","TIUPD",16,0)
 S:$P($G(^TIU(8925,+DA,0)),U,9)="P" TIUSTAT=1
"RTN","TIUPD",17,0)
 S TIURP=$P($G(TIUDPARM(0)),U,6),TIUSP=$P($G(TIUDPARM(0)),U,7)
"RTN","TIUPD",18,0)
 I TIUACT="S" D TSKPRINT(DA,2,"",.TIUDPARM) Q
"RTN","TIUPD",19,0)
 I TIUACT="A" D TSKPRINT(DA,1,"",.TIUDPARM) Q
"RTN","TIUPD",20,0)
 I TIUACT="V",TIUSP]"","VB"[TIUSP D TSKPRINT(DA,1,"",.TIUDPARM) Q
"RTN","TIUPD",21,0)
 I +$G(TIUSTAT) D  ;STAT Document processing
"RTN","TIUPD",22,0)
 . I TIUACT="R",TIUSP]"","RB"[TIUSP D TSKPRINT(DA,1,TIUSTAT,.TIUDPARM) Q
"RTN","TIUPD",23,0)
 . I TIUACT="V",TIUSP]"","VB"[TIUSP D TSKPRINT(DA,1,"",.TIUDPARM) Q
"RTN","TIUPD",24,0)
 E  D  ;Non-stat Document processing
"RTN","TIUPD",25,0)
 . I TIUACT="R",TIURP]"","RB"[TIURP D TSKPRINT(DA,1,"",.TIUDPARM) Q
"RTN","TIUPD",26,0)
 . I TIUACT="V",TIURP]"","VB"[TIURP D TSKPRINT(DA,1,"",.TIUDPARM) Q
"RTN","TIUPD",27,0)
 Q
"RTN","TIUPD",28,0)
RPC(TIUY,TIUDA,TIUIO,TIUFLAG,TIUWIN) ; Remote Procedure to print a record
"RTN","TIUPD",29,0)
 ;TIUFLAG > 1 Chart Copy, TIUFLAG = 2 Electronically signed Chart Copy
"RTN","TIUPD",30,0)
 ;TIUWIN = 1 Windows printer, 0 or "" VistA printer
"RTN","TIUPD",31,0)
 N DFN,TIUD0,TIUX,ZTIO,ZTDTH,ZTRTN,ZTSK,ZTDESC,TIUTYPE,TIUPMTHD,TIUTNM
"RTN","TIUPD",32,0)
 N TIUDATE,TIUPFHDR,TIUPFNBR,TIUPGRP,TIUD13,TIUD15,TIUIDDAD
"RTN","TIUPD",33,0)
 K ^TMP("TIUPR",$J)
"RTN","TIUPD",34,0)
 I '$D(^TIU(8925,+$G(TIUDA),0)) S TIUY="1^No such record in TIU" Q
"RTN","TIUPD",35,0)
 I $G(TIUIO)']"" S TIUY="1^No device selected" Q
"RTN","TIUPD",36,0)
 ; Get Print Method for the document
"RTN","TIUPD",37,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD13=$G(^TIU(8925,+TIUDA,13))
"RTN","TIUPD",38,0)
 S TIUD15=$G(^TIU(8925,+TIUDA,15)),TIUTYPE=+TIUD0,TIUFLAG=+$G(TIUFLAG)
"RTN","TIUPD",39,0)
 S TIUDATE=$S(+TIUD15>0:+TIUD15,+TIUD13>0:+TIUD13,1:+$G(DT))
"RTN","TIUPD",40,0)
 I '+TIUTYPE Q
"RTN","TIUPD",41,0)
 S DFN=+$P(TIUD0,U,2)
"RTN","TIUPD",42,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYPE)
"RTN","TIUPD",43,0)
 S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYPE,TIUDA)
"RTN","TIUPD",44,0)
 S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYPE,TIUDA)
"RTN","TIUPD",45,0)
 S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYPE,TIUDA)
"RTN","TIUPD",46,0)
 S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYPE,TIUDA)
"RTN","TIUPD",47,0)
 I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=+$P($G(^TIU(8925,+TIUDA,0)),U,6)
"RTN","TIUPD",48,0)
 S TIUIDDAD=$$HASIDDAD^TIUGBR(TIUDA)
"RTN","TIUPD",49,0)
 I TIUIDDAD S TIUDA=TIUIDDAD
"RTN","TIUPD",50,0)
 I $G(TIUPMTHD)']"" S TIUY="1^No Print Method Defined" Q
"RTN","TIUPD",51,0)
 I $G(TIUPMTHD)]"",+$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") D
"RTN","TIUPD",52,0)
 . S ^TMP("TIUPR",$J,$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_DFN,1,TIUDA)=$G(TIUPFNBR)
"RTN","TIUPD",53,0)
 E  S ^TMP("TIUPR",$J,DFN,1,TIUDA)=""
"RTN","TIUPD",54,0)
 I +$G(TIUWIN) D
"RTN","TIUPD",55,0)
 . U IO
"RTN","TIUPD",56,0)
 . X TIUPMTHD
"RTN","TIUPD",57,0)
 E  D
"RTN","TIUPD",58,0)
 . S ZTIO=TIUIO,ZTDTH=$H
"RTN","TIUPD",59,0)
 . S ZTDESC=$S(+TIUFLAG:"CHART",1:"WORK")_" copy of "_$$UPPER^TIULS(TIUTNM)
"RTN","TIUPD",60,0)
 . S ZTRTN=$P(TIUPMTHD," ",2),ZTSAVE("^TMP(""TIUPR"",$J,")=""
"RTN","TIUPD",61,0)
 . S ZTSAVE("TIUFLAG")="",ZTSAVE("TIUPRM*")="",ZTSAVE("DUZ(")=""
"RTN","TIUPD",62,0)
 . D ^%ZTLOAD K ^TMP("TIUPR",$J,+$P(TIUD0,U,2),1,TIUDA)
"RTN","TIUPD",63,0)
 . I $D(ZTSK) S TIUY="0^"_$S(+$G(TIUFLAG):"Chart",1:"Draft")_" copy queued"
"RTN","TIUPD",64,0)
 . E  S TIUY="1^Task Rejected"
"RTN","TIUPD",65,0)
 K ^TMP("TIUPR",$J,$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_DFN,1,TIUDA)
"RTN","TIUPD",66,0)
 Q
"RTN","TIUPD",67,0)
TSKPRINT(DA,TIUFLAG,TIUSTAT,TIUDPARM) ;Set up task and do a queued print
"RTN","TIUPD",68,0)
 ;TIUFLAG > 1 Chart Copy, TIUFLAG = 2 Electronically signed Chart Copy
"RTN","TIUPD",69,0)
 ;TIUSTAT > 1 Stat printed at Release, check for Stat Chart Copy Printer
"RTN","TIUPD",70,0)
 N TIUD0,TIUDA,TIUX,ZTIO,ZTDTH,ZTRTN,ZTSK,ZTDESC,TIUTYPE,TIUPMTHD,TIUTNM
"RTN","TIUPD",71,0)
 N TIUDATE,TIUPFHDR,TIUPFNBR,TIUPGRP,TIUD13,TIUD15,TIUIDDAD
"RTN","TIUPD",72,0)
 K ^TMP("TIUPR",$J)
"RTN","TIUPD",73,0)
 I '$D(^TIU(8925,+$G(DA),0)) Q
"RTN","TIUPD",74,0)
 ; Get Print Method for the document
"RTN","TIUPD",75,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD13=$G(^TIU(8925,+DA,13))
"RTN","TIUPD",76,0)
 S TIUD15=$G(^TIU(8925,+DA,15)),TIUTYPE=+TIUD0
"RTN","TIUPD",77,0)
 S TIUDATE=$S(+TIUD15>0:+TIUD15,+TIUD13>0:+TIUD13,1:+$G(DT))
"RTN","TIUPD",78,0)
 I '+TIUTYPE Q
"RTN","TIUPD",79,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYPE)
"RTN","TIUPD",80,0)
 S TIUPMTHD=$P($$PRNTMTHD^TIULG(+TIUTYPE,DA)," ",2)
"RTN","TIUPD",81,0)
 S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYPE,DA)
"RTN","TIUPD",82,0)
 S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYPE,DA)
"RTN","TIUPD",83,0)
 S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYPE,DA)
"RTN","TIUPD",84,0)
 I +$$ISADDNDM^TIULC1(DA) S DA=+$P($G(^TIU(8925,+DA,0)),U,6)
"RTN","TIUPD",85,0)
 S TIUIDDAD=$$HASIDDAD^TIUGBR(DA)
"RTN","TIUPD",86,0)
 I TIUIDDAD S DA=TIUIDDAD
"RTN","TIUPD",87,0)
 I TIUPMTHD']"" Q
"RTN","TIUPD",88,0)
 S ZTIO=$$GETDEV(DA,.TIUDPARM,+$G(TIUSTAT)),ZTDTH=$H
"RTN","TIUPD",89,0)
 I ZTIO']"" K ^TMP("TIUPR",$J) Q
"RTN","TIUPD",90,0)
 S ZTDESC="CHART COPY OF "_$$UPPER^TIULS(TIUTNM)
"RTN","TIUPD",91,0)
 S ZTRTN=TIUPMTHD,ZTSAVE("^TMP(""TIUPR"",$J,")="",ZTSAVE("TIUFLAG")=""
"RTN","TIUPD",92,0)
 S ZTSAVE("TIUPRM*")="",ZTSAVE("DUZ(")=""
"RTN","TIUPD",93,0)
 I $G(TIUPMTHD)]"",+$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") D
"RTN","TIUPD",94,0)
 . S ^TMP("TIUPR",$J,$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_+$P(TIUD0,U,2),TIUDATE,DA)=$G(TIUPFNBR)
"RTN","TIUPD",95,0)
 E  S ^TMP("TIUPR",$J,+$P(TIUD0,U,2),TIUDATE,DA)=""
"RTN","TIUPD",96,0)
 D ^%ZTLOAD K ^TMP("TIUPR",$J,+$P(TIUD0,U,2),TIUDATE,DA)
"RTN","TIUPD",97,0)
 K ^TMP("TIUPR",$J,$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_DFN,TIUDATE,DA)
"RTN","TIUPD",98,0)
 I $D(ZTSK),'$D(XWBOS) W !,$S(+$G(TIUFLAG):"Chart",1:"Draft")," copy queued."
"RTN","TIUPD",99,0)
 Q
"RTN","TIUPD",100,0)
GETDEV(DA,TIUDPARM,TIUSTAT) ; Get Chart copy print device name
"RTN","TIUPD",101,0)
 N DIC,DIQ,DR,X,Y,TIUDPDA,TIUDIV,TIUDEV,TIUI,TIU,TIUY
"RTN","TIUPD",102,0)
 D GETTIU^TIULD(.TIU,+DA)
"RTN","TIUPD",103,0)
 S TIUDPDA=+$O(^TIU(8925.95,"B",+$G(TIUDPARM(0)),0)) I '+TIUDPDA G GETDX
"RTN","TIUPD",104,0)
 S TIUDIV=+$O(^TIU(8925.95,+TIUDPDA,2,"B",+$G(TIU("DIV")),0))
"RTN","TIUPD",105,0)
 I +TIUDIV>0 D
"RTN","TIUPD",106,0)
 . S DIC="^TIU(8925.95,"_TIUDPDA_",2,",DA=+TIUDIV
"RTN","TIUPD",107,0)
 . S DIQ="TIUDEV",DR=".02;.03" D EN^DIQ1
"RTN","TIUPD",108,0)
 . I +$G(TIUSTAT),($G(TIUDEV(8925.952,+DA,.03))]"") S TIUY=$G(TIUDEV(8925.952,+DA,.03))
"RTN","TIUPD",109,0)
 . E  S TIUY=$G(TIUDEV(8925.952,+DA,.02))
"RTN","TIUPD",110,0)
GETDX Q $G(TIUY)
"RTN","TIUPEFIX")
0^57^B39823612
"RTN","TIUPEFIX",1,0)
TIUPEFIX ; SLC/JER - Resolve Filing errors for TIU Documents ;10/27/00
"RTN","TIUPEFIX",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,21,100**;Jun 20, 1997
"RTN","TIUPEFIX",3,0)
MAKE(SUCCESS,DFN,TITLE,TIU,TIUBUF) ; File new TIU Document
"RTN","TIUPEFIX",4,0)
 ; SUCCESS = (by ref) SUCCESS Returns TIU DOCUMENT # (PTR to 8925)
"RTN","TIUPEFIX",5,0)
 ;         = 0^Explanatory message if no SUCCESS
"RTN","TIUPEFIX",6,0)
 ; DFN     = Patient (#2)
"RTN","TIUPEFIX",7,0)
 ; TITLE   = Pointer to TIU Document Definition (#8925.1)
"RTN","TIUPEFIX",8,0)
 ; TIU     = Array of demographic and visit attributes
"RTN","TIUPEFIX",9,0)
 ; TIUBUF  = Record number (ien) of entry in TIU Buffer file (#8925.2)
"RTN","TIUPEFIX",10,0)
 ;
"RTN","TIUPEFIX",11,0)
 ; -- first, get TIU Document record --
"RTN","TIUPEFIX",12,0)
 ;
"RTN","TIUPEFIX",13,0)
 N TIUDA,LDT,NEWREC,TIUX,TIUTYP,TIUDPRM,HAPPY,TIUCLASS,TIUDTYP,TIUPOST
"RTN","TIUPEFIX",14,0)
 N TIUDFLT,TIUREC
"RTN","TIUPEFIX",15,0)
 S SUCCESS=0 ; Initialize SUCCESS to false
"RTN","TIUPEFIX",16,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,+$G(TIUTYPE)'>0:1,1:0) S SUCCESS="0^"_$$EZBLD^DIALOG(89250001) Q
"RTN","TIUPEFIX",17,0)
 ; If target file is not 8925 QUIT
"RTN","TIUPEFIX",18,0)
 I +$G(^TIU(8925.1,+TIUTYPE,1))'=8925 Q
"RTN","TIUPEFIX",19,0)
 S TIUDTYP=$P($G(^TIU(8925.1,+TIUTYPE,0)),U,4)
"RTN","TIUPEFIX",20,0)
 S TIUCLASS=$S(TIUDTYP="CL":+TIUTYPE,1:38)
"RTN","TIUPEFIX",21,0)
 S TIUDFLT=$S(TIUCLASS'=TIUTYPE:TIUTYPE,1:"")
"RTN","TIUPEFIX",22,0)
 I +$G(TITLE)'>0 S TITLE=$$ASKTITLE^TIULA3(TIUCLASS,TIUDFLT)
"RTN","TIUPEFIX",23,0)
 Q:+TITLE'>0
"RTN","TIUPEFIX",24,0)
 S TIUTYP=TITLE,TIUTYP(1)=1_U_TITLE
"RTN","TIUPEFIX",25,0)
 D DOCPRM^TIULC1(TITLE,.TIUDPRM)
"RTN","TIUPEFIX",26,0)
 ;S TIUDA=$$GETREC^TIUEDI1(DFN,.TIU,1,.NEWREC,.TIUDPRM) ;10/27/00
"RTN","TIUPEFIX",27,0)
 S TIUDA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.NEWREC,.TIUDPRM)
"RTN","TIUPEFIX",28,0)
 I +TIUDA'>0 S SUCCESS="0^"_$$EZBLD^DIALOG(89250002) Q
"RTN","TIUPEFIX",29,0)
 I +$$CANEDIT^TIUPUTU(TIUDA)'>0 D  G MAKEX
"RTN","TIUPEFIX",30,0)
 . D MAKEADD(.TIUADD,+TIUDA,TIUBUF) S SUCCESS=TIUADD
"RTN","TIUPEFIX",31,0)
 S SUCCESS=1
"RTN","TIUPEFIX",32,0)
 ;
"RTN","TIUPEFIX",33,0)
 ; -- second, load the header elements & text into TIUX array
"RTN","TIUPEFIX",34,0)
 ;
"RTN","TIUPEFIX",35,0)
 D STUFREC(TIUDA,$G(DFN),$G(PARENT),.TIU)
"RTN","TIUPEFIX",36,0)
 D LOADTIUX(.TIUX,TIUBUF)
"RTN","TIUPEFIX",37,0)
 ;
"RTN","TIUPEFIX",38,0)
 ; -- third, file the data in TIU Document record --
"RTN","TIUPEFIX",39,0)
 ;
"RTN","TIUPEFIX",40,0)
 K ^TIU(8925,+TIUDA,"TEMP"),TIUX(.01),TIUX(.02),TIUX(.03),TIUX(.05)
"RTN","TIUPEFIX",41,0)
 K TIUX(.13),TIUX(1205),TIUX(1211)
"RTN","TIUPEFIX",42,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUPEFIX",43,0)
 D FILE(.HAPPY,+TIUDA,.TIUX,TIUTYP)
"RTN","TIUPEFIX",44,0)
 D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUPEFIX",45,0)
 S TIUPOST=$$POSTFILE^TIULC1(TITLE)
"RTN","TIUPEFIX",46,0)
 S TIUREC("#")=TIUDA
"RTN","TIUPEFIX",47,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPEFIX",48,0)
MAKEX D ALERTDEL^TIUPEVNT(+TIUBUF)
"RTN","TIUPEFIX",49,0)
 D RESOLVE^TIUPEVNT($S($D(XQADATA):+$P(XQADATA,";",3),1:$G(ERRDA)),1)
"RTN","TIUPEFIX",50,0)
 D BUFPURGE^TIUPUTC(+TIUBUF)
"RTN","TIUPEFIX",51,0)
 K ^TIU(8925,+TIUDA,"TEMP") W "Done."
"RTN","TIUPEFIX",52,0)
 I +$G(TIUDA),+$D(^TIU(8925,+$G(TIUDA),0)) D
"RTN","TIUPEFIX",53,0)
 . N TIU D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUPEFIX",54,0)
 . D EN^VALM("TIU BROWSE FOR MRT")
"RTN","TIUPEFIX",55,0)
 Q
"RTN","TIUPEFIX",56,0)
LOADTIUX(TIUARR,TIUBUF) ; Load TIUX array with header and text
"RTN","TIUPEFIX",57,0)
 N TIUI,TIUHSIG,TIUBGN,TIULINE,X,Y,TYPE I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUPEFIX",58,0)
 S TIUHSIG=$P(TIUPRM0,U,10),TIUBGN=$P(TIUPRM0,U,12)
"RTN","TIUPEFIX",59,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPEFIX",60,0)
 . S TIULINE=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0))
"RTN","TIUPEFIX",61,0)
 . I TIULINE[TIUHSIG D
"RTN","TIUPEFIX",62,0)
 . . N TIUD1,TIUD4
"RTN","TIUPEFIX",63,0)
 . . S X=$$STRIP^TIULS($P(TIULINE,":",2)),Y=$$WHATYPE^TIUPUTU(X)
"RTN","TIUPEFIX",64,0)
 . . I +Y'>0 D MAIN^TIUPEVNT(TIUBUF,1,3,X) Q
"RTN","TIUPEFIX",65,0)
 . . S TIUD1=$G(^TIU(8925.1,+Y,1)),TIUD4=$G(^TIU(8925.1,+Y,4))
"RTN","TIUPEFIX",66,0)
 . . S TYPE=+Y
"RTN","TIUPEFIX",67,0)
 . . F  D  Q:TIULINE[TIUBGN!(+TIUI'>0)
"RTN","TIUPEFIX",68,0)
 . . . N TIUN,TIUCAP,TIUFLD,TIUREQ S TIUREQ=0
"RTN","TIUPEFIX",69,0)
 . . . S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0
"RTN","TIUPEFIX",70,0)
 . . . S TIULINE=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0)) Q:TIULINE[TIUBGN
"RTN","TIUPEFIX",71,0)
 . . . S TIUCAP=$P(TIULINE,":") Q:TIUCAP']""
"RTN","TIUPEFIX",72,0)
 . . . S TIUN=$O(^TIU(8925.1,+TYPE,"HEAD","B",TIUCAP,0))
"RTN","TIUPEFIX",73,0)
 . . . Q:+TIUN'>0
"RTN","TIUPEFIX",74,0)
 . . . S TIUFLD=$P(^TIU(8925.1,+TYPE,"HEAD",+TIUN,0),U,3)
"RTN","TIUPEFIX",75,0)
 . . . Q:TIUFLD']""
"RTN","TIUPEFIX",76,0)
 . . . S TIUREQ=$P(^TIU(8925.1,+TYPE,"HEAD",+TIUN,0),U,7)
"RTN","TIUPEFIX",77,0)
 . . . S TIUARR(TIUFLD)=$$STRIP^TIULS($P(TIULINE,":",2,99))
"RTN","TIUPEFIX",78,0)
 . . . S:TIUFLD'=.001 TIUARR(TIUFLD)=$$TRNSFRM(+TYPE,TIUFLD,TIUARR(TIUFLD))
"RTN","TIUPEFIX",79,0)
 . . . I +TIUREQ,TIUARR(TIUFLD)="" S TIUARR(TIUFLD)="** REQUIRED FIELD MISSING FROM UPLOAD **"
"RTN","TIUPEFIX",80,0)
 . . . I $S(TIUFLD=.01:1,TIUFLD=.02:1,TIUFLD=.07:1,TIUFLD=1301:1,1:0) K TIUARR(TIUFLD)
"RTN","TIUPEFIX",81,0)
 . . I TIULINE[TIUBGN D
"RTN","TIUPEFIX",82,0)
 . . . N TIUJ S TIUJ=0
"RTN","TIUPEFIX",83,0)
 . . . F  D  Q:+TIUI'>0
"RTN","TIUPEFIX",84,0)
 . . . . S TIUI=$O(^TIU(8925.2,+TIUBUF,"TEXT",TIUI)) Q:+TIUI'>0
"RTN","TIUPEFIX",85,0)
 . . . . S TIUJ=TIUJ+1
"RTN","TIUPEFIX",86,0)
 . . . . S TIUARR("TEXT",TIUJ,0)=$G(^TIU(8925.2,+TIUBUF,"TEXT",TIUI,0))
"RTN","TIUPEFIX",87,0)
 Q
"RTN","TIUPEFIX",88,0)
STUFREC(DA,DFN,PARENT,TIU) ; Stuff fixed field data
"RTN","TIUPEFIX",89,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIURDT
"RTN","TIUPEFIX",90,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPEFIX",91,0)
 I +$G(PARENT)'>0 D
"RTN","TIUPEFIX",92,0)
 . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUPEFIX",93,0)
 . S @FDARR@(.05)=$S(+$$REQVER(+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUPEFIX",94,0)
 . S @FDARR@(.07)=$P(TIU("EDT"),U)
"RTN","TIUPEFIX",95,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U),@FDARR@(1401)=$P($G(TIU("AD#")),U)
"RTN","TIUPEFIX",96,0)
 . S @FDARR@(1402)=$P($G(TIU("TS")),U),@FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPEFIX",97,0)
 . S @FDARR@(1205)=$S(+$P($G(TIU("LOC")),U):$P($G(TIU("LOC")),U),1:$P($G(TIU("VLOC")),U))
"RTN","TIUPEFIX",98,0)
 . S @FDARR@(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUPEFIX",99,0)
 I +$G(PARENT)>0 D
"RTN","TIUPEFIX",100,0)
 . S @FDARR@(.02)=+$P(^TIU(8925,+PARENT,0),U,2)
"RTN","TIUPEFIX",101,0)
 . S @FDARR@(.03)=$P(^TIU(8925,+PARENT,0),U,3)
"RTN","TIUPEFIX",102,0)
 . S @FDARR@(.05)=$S(+$$REQVER(+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUPEFIX",103,0)
 . S @FDARR@(.06)=PARENT
"RTN","TIUPEFIX",104,0)
 . S @FDARR@(.07)=$P($G(TIU("EDT")),U),@FDARR@(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUPEFIX",105,0)
 . S @FDARR@(1205)=$P($G(^TIU(8925,+PARENT,12)),U,5)
"RTN","TIUPEFIX",106,0)
 . S @FDARR@(1401)=$P($G(^TIU(8925,+PARENT,14)),U)
"RTN","TIUPEFIX",107,0)
 . S @FDARR@(1402)=$P($G(^TIU(8925,+PARENT,14)),U,2)
"RTN","TIUPEFIX",108,0)
 . S @FDARR@(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUPEFIX",109,0)
 S @FDARR@(1201)=$$NOW^XLFDT
"RTN","TIUPEFIX",110,0)
 I +$G(TIU("LDT")) S TIURDT=+$G(TIU("LDT"))
"RTN","TIUPEFIX",111,0)
 I +$G(TIU("LDT"))'>0 D
"RTN","TIUPEFIX",112,0)
 . S TIUDICDT=+$$IDATE^TIULC($G(TIUDICDT))
"RTN","TIUPEFIX",113,0)
 . I +TIUDICDT,($P(TIUDICDT,".",2)'>0) D
"RTN","TIUPEFIX",114,0)
 . . S TIUDICDT=$S($P(TIU("VSTR"),";",3)'="H":$P($G(TIU("EDT")),U),1:"")
"RTN","TIUPEFIX",115,0)
 . S TIURDT=$S(+$G(TIUDICDT)>0:+$G(TIUDICDT),1:+$$NOW^TIULC)
"RTN","TIUPEFIX",116,0)
 . S:+$G(TIUTYPE)=1 @FDARR@(.12)=1
"RTN","TIUPEFIX",117,0)
 . K TIUDICDT
"RTN","TIUPEFIX",118,0)
 S @FDARR@(1301)=TIURDT,@FDARR@(1303)="U"
"RTN","TIUPEFIX",119,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPEFIX",120,0)
 Q
"RTN","TIUPEFIX",121,0)
REQVER(VPARM) ; Evaluate whether verification is required
"RTN","TIUPEFIX",122,0)
 Q $S(VPARM=1:1,VPARM=2:1,1:0)
"RTN","TIUPEFIX",123,0)
MAKEADD(TIUDADD,TIUDA,TIUBUF) ; Create an addendum record
"RTN","TIUPEFIX",124,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUCAN,TIUFPRIV,TIU,TIUX S TIUFPRIV=1
"RTN","TIUPEFIX",125,0)
 N TIUDTTL,TIUPOST,TIUREC
"RTN","TIUPEFIX",126,0)
 S TIUDTTL=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUPEFIX",127,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUPEFIX",128,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUPEFIX",129,0)
 D ^DIC
"RTN","TIUPEFIX",130,0)
 S TIUDADD=+Y
"RTN","TIUPEFIX",131,0)
 I +Y'>0 S TIUDADD=TIUDADD_"^Could not create addendum." Q
"RTN","TIUPEFIX",132,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPEFIX",133,0)
 S TIU("DOCTYP")=TIUATYP_U_$$PNAME^TIULC1(TIUATYP)
"RTN","TIUPEFIX",134,0)
 D STUFREC(TIUDADD,DFN,+TIUDA,.TIU)
"RTN","TIUPEFIX",135,0)
 D LOADTIUX(.TIUX,TIUBUF)
"RTN","TIUPEFIX",136,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUPEFIX",137,0)
 M ^TIU(8925,+TIUDADD,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUPEFIX",138,0)
 D FILE(.SUCCESS,+TIUDADD,.TIUX,TIUATYP)
"RTN","TIUPEFIX",139,0)
 D MERGTEXT^TIUEDI1(+TIUDADD,.TIU)
"RTN","TIUPEFIX",140,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUDTTL)
"RTN","TIUPEFIX",141,0)
 S TIUREC("#")=TIUDADD
"RTN","TIUPEFIX",142,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPEFIX",143,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUPEFIX",144,0)
 Q
"RTN","TIUPEFIX",145,0)
FILE(SUCCESS,TIUDA,TIUX,RTYPE) ; Call FM Filer to commit updates to DB
"RTN","TIUPEFIX",146,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUPEFIX",147,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="KE"
"RTN","TIUPEFIX",148,0)
 M @FDARR=TIUX
"RTN","TIUPEFIX",149,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPEFIX",150,0)
 I $D(TIUMSG)>9 D
"RTN","TIUPEFIX",151,0)
 . S SUCCESS=0_U_$G(TIUMSG(1,"TEXT",1))
"RTN","TIUPEFIX",152,0)
 . D MAIN^TIUPEVNT(TIUBUF,2,"",$P($G(^TIU(8925.1,+RTYPE,0)),U),.FDA,.TIUMSG)
"RTN","TIUPEFIX",153,0)
 E  S SUCCESS=TIUDA
"RTN","TIUPEFIX",154,0)
 Q
"RTN","TIUPEFIX",155,0)
TRNSFRM(RTYPE,FLD,X) ; Executes Transform code for a given header field
"RTN","TIUPEFIX",156,0)
 N XFORM
"RTN","TIUPEFIX",157,0)
 S FLD=$O(^TIU(8925.1,+RTYPE,"HEAD","D",+FLD,0))
"RTN","TIUPEFIX",158,0)
 I +FLD'>0 G TRNSFRMX
"RTN","TIUPEFIX",159,0)
 S XFORM=$G(^TIU(8925.1,+RTYPE,"HEAD",+FLD,1))
"RTN","TIUPEFIX",160,0)
 I XFORM']"" G TRNSFRMX
"RTN","TIUPEFIX",161,0)
 X XFORM
"RTN","TIUPEFIX",162,0)
TRNSFRMX Q X
"RTN","TIUPRD")
0^67^B13286619
"RTN","TIUPRD",1,0)
TIUPRD ; SLC/JER - Single patient print ;3/19/01
"RTN","TIUPRD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,100**;Jun 20, 1997
"RTN","TIUPRD",3,0)
 ;
"RTN","TIUPRD",4,0)
REPLACE(TIUDA,RPARRAY) ; Populate RPARRAY array w records received,
"RTN","TIUPRD",5,0)
 ;replacing ID kids w ID parents; replacing addenda with their parents
"RTN","TIUPRD",6,0)
 ;or grandparents.
"RTN","TIUPRD",7,0)
 ; Requires TIUDA. 
"RTN","TIUPRD",8,0)
 ; Sets & passes back RPARRAY(IFN)=1 or 1^TIUDA, or 0
"RTN","TIUPRD",9,0)
 ;where IFN is TIUDA or parent or grandparent of TIUDA.
"RTN","TIUPRD",10,0)
 ; If TIUDA is replaced, then RPARRAY(IFN)=1^TIUDA,
"RTN","TIUPRD",11,0)
 ;to know what child the parent was included in the list for.
"RTN","TIUPRD",12,0)
 ; Sets & passes back RPARRAY = # of elements in RPARRAY.
"RTN","TIUPRD",13,0)
 N IDPRNT,ADDPRNT,ADDGPNT
"RTN","TIUPRD",14,0)
 S RPARRAY=+$G(RPARRAY)
"RTN","TIUPRD",15,0)
 S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIUPRD",16,0)
 ; -- If kid has parent that doesn't exist,
"RTN","TIUPRD",17,0)
 ;    treat kid as stand-alone:
"RTN","TIUPRD",18,0)
 I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIUPRD",19,0)
 S ADDPRNT=$P(^TIU(8925,TIUDA,0),U,6)
"RTN","TIUPRD",20,0)
 I ADDPRNT,'$D(^TIU(8925,ADDPRNT,0)) Q
"RTN","TIUPRD",21,0)
 I ADDPRNT S ADDGPNT=+$G(^TIU(8925,ADDPRNT,21))
"RTN","TIUPRD",22,0)
 I $G(ADDGPNT),'$D(^TIU(8925,ADDGPNT,0)) S ADDGPNT=0
"RTN","TIUPRD",23,0)
 ;============================================
"RTN","TIUPRD",24,0)
 ; -- If TIUDA is not an ID kid & not addm, just put it
"RTN","TIUPRD",25,0)
 ;    in RPARRAY and quit: --
"RTN","TIUPRD",26,0)
 I 'IDPRNT,'ADDPRNT D  G REPX
"RTN","TIUPRD",27,0)
 . ; -- If TIUDA is already in array (as parent/gpa of previous kid),
"RTN","TIUPRD",28,0)
 . ;    and is now received on its own merit, forget the original
"RTN","TIUPRD",29,0)
 . ;    child.  If not already in array, put it in.  Quit.
"RTN","TIUPRD",30,0)
 . I $D(RPARRAY(TIUDA)) S $P(RPARRAY(TIUDA),U,2)="" Q
"RTN","TIUPRD",31,0)
 . S RPARRAY(TIUDA)=1
"RTN","TIUPRD",32,0)
 . S RPARRAY=$G(RPARRAY)+1
"RTN","TIUPRD",33,0)
 ; ==========================================
"RTN","TIUPRD",34,0)
 ; -- If TIUDA is an ID kid, put its parent in array and track
"RTN","TIUPRD",35,0)
 ;    original child:
"RTN","TIUPRD",36,0)
 I IDPRNT D  G REPX
"RTN","TIUPRD",37,0)
 . S RPARRAY(IDPRNT)=1_U_TIUDA
"RTN","TIUPRD",38,0)
 . S RPARRAY=$G(RPARRAY)+1
"RTN","TIUPRD",39,0)
 ; ===========================================
"RTN","TIUPRD",40,0)
 ; -- If TIUDA is an addm to standalone note, put parent in
"RTN","TIUPRD",41,0)
 ;    array and track orig addm:
"RTN","TIUPRD",42,0)
 I ADDPRNT,'ADDGPNT D  G REPX
"RTN","TIUPRD",43,0)
 . S RPARRAY(ADDPRNT)=1_U_TIUDA
"RTN","TIUPRD",44,0)
 . S RPARRAY=$G(RPARRAY)+1
"RTN","TIUPRD",45,0)
 ; ===========================================
"RTN","TIUPRD",46,0)
 ; -- If TIUDA is an addm to ID kid, put ID parent in
"RTN","TIUPRD",47,0)
 ;    array and track orig addm:
"RTN","TIUPRD",48,0)
 I ADDPRNT,ADDGPNT D  G REPX
"RTN","TIUPRD",49,0)
 . S RPARRAY(ADDGPNT)=1_U_TIUDA
"RTN","TIUPRD",50,0)
 . S RPARRAY=$G(RPARRAY)+1
"RTN","TIUPRD",51,0)
REPX Q
"RTN","TIUPRD",52,0)
 ;
"RTN","TIUPRD",53,0)
MAIN(TIUTYP) ; Control Branching
"RTN","TIUPRD",54,0)
 N DFN,TIU,TIUOUT,TIUREL,TIUCHK,TIUA,TIUSEE,ACT,TIUY,TIUFLAG
"RTN","TIUPRD",55,0)
 N TIUDAT,TIUOUT,TIUSEE,TIUI,TIUQUIT
"RTN","TIUPRD",56,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUPRD",57,0)
 S:$D(ORVP) DFN=+ORVP S TIUTYP=$G(TIUTYP,38)
"RTN","TIUPRD",58,0)
 D SELPAT^TIULA2(.TIUDAT,TIUTYP,+$G(DFN))
"RTN","TIUPRD",59,0)
 I +$G(TIUDAT)'>0,($D(TIUDAT)'>9) S TIUOUT=1 Q
"RTN","TIUPRD",60,0)
 S TIUFLAG=$$FLAG^TIUPRPN3
"RTN","TIUPRD",61,0)
 S TIUDEV=$$DEVICE^TIUDEV(.IO) ; Get Device/allow queueing
"RTN","TIUPRD",62,0)
 I IO']"" G PRINTX
"RTN","TIUPRD",63,0)
 I $D(IO("Q")) D QUE^TIUDEV("PRINTN^TIUPRD",TIUDEV) G PRINTX
"RTN","TIUPRD",64,0)
 D PRINTN
"RTN","TIUPRD",65,0)
PRINTX D ^%ZISC
"RTN","TIUPRD",66,0)
 K ^TMP("TIUPR",$J)
"RTN","TIUPRD",67,0)
 Q
"RTN","TIUPRD",68,0)
PRINTN ; Loop through selected doc's & invoke print code as appropriate
"RTN","TIUPRD",69,0)
 N TIUI,TIUTYP,TIUDARR,DFN,RPARRAY,TIULNO
"RTN","TIUPRD",70,0)
 U IO
"RTN","TIUPRD",71,0)
 S TIUI=0
"RTN","TIUPRD",72,0)
 F  S TIUI=$O(TIUDAT(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIUPRD",73,0)
 . N TIUPGRP,TIUPMTHD,TIUPFHDR,TIUPFNBR,ORIGCHLD
"RTN","TIUPRD",74,0)
 . S TIUDA=+$G(TIUDAT(TIUI))
"RTN","TIUPRD",75,0)
 . I '+$G(^TIU(8925,+TIUDA,0)) Q
"RTN","TIUPRD",76,0)
 . ; -- Set RPARRAY, with ID kids & adda replaced by parents:
"RTN","TIUPRD",77,0)
 . D REPLACE(TIUDA,.RPARRAY)
"RTN","TIUPRD",78,0)
 . S TIULNO(TIUDA)=TIUI
"RTN","TIUPRD",79,0)
 ; -- Set TIUDARR w info needed to print TIUDA:
"RTN","TIUPRD",80,0)
 S TIUDA=0 F  S TIUDA=$O(RPARRAY(TIUDA)) Q:'TIUDA  D
"RTN","TIUPRD",81,0)
 . S TIUTYP=$P(^TIU(8925,TIUDA,0),U),DFN=$P(^(0),U,2)
"RTN","TIUPRD",82,0)
 . I +TIUTYP D
"RTN","TIUPRD",83,0)
 . . S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYP)
"RTN","TIUPRD",84,0)
 . . S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYP)
"RTN","TIUPRD",85,0)
 . . S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYP)
"RTN","TIUPRD",86,0)
 . . S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYP)
"RTN","TIUPRD",87,0)
 . Q:$G(TIUPMTHD)']""
"RTN","TIUPRD",88,0)
 . S TIUI=$G(TIULNO(TIUDA))
"RTN","TIUPRD",89,0)
 . I '$G(TIUI) D
"RTN","TIUPRD",90,0)
 . . S ORIGCHLD=$P(RPARRAY(TIUDA),U,2),TIUI=$G(TIULNO(ORIGCHLD))
"RTN","TIUPRD",91,0)
 . I +$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") S TIUDARR(TIUPMTHD,$G(TIUPGRP)_"$"_TIUPFHDR_";"_DFN,TIUI,TIUDA)=TIUPFNBR
"RTN","TIUPRD",92,0)
 . E  S TIUDARR(TIUPMTHD,DFN,TIUI,TIUDA)=""
"RTN","TIUPRD",93,0)
 ; -- Sort printout by printmethod (prints similar docmts together):
"RTN","TIUPRD",94,0)
 S TIUPMTHD="" F  S TIUPMTHD=$O(TIUDARR(TIUPMTHD)) Q:TIUPMTHD=""  D
"RTN","TIUPRD",95,0)
 . D PRNTDOC^TIURA(TIUPMTHD,.TIUDARR)
"RTN","TIUPRD",96,0)
 Q
"RTN","TIUPRPN1")
0^51^B41372297
"RTN","TIUPRPN1",1,0)
TIUPRPN1 ;SLC/JER - Print SF 509-Progress Notes ;4/11/01
"RTN","TIUPRPN1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**45,52,87,100**;Jun 20, 1997
"RTN","TIUPRPN1",3,0)
PRINT(TIUFLAG,TIUSPG) ; Print Document
"RTN","TIUPRPN1",4,0)
 ; ^TMP("TIUPR",$J) is array of records to be printed
"RTN","TIUPRPN1",5,0)
 ; TIUFLAG=1 --> Chart Copy     TIUSPG=1 --> Contiguous
"RTN","TIUPRPN1",6,0)
 ; TIUFLAG=0 --> Work Copy      TIUSPG=0 --> Fresh Page- each note
"RTN","TIUPRPN1",7,0)
 ; TIUCONT=1 --> Continue printing
"RTN","TIUPRPN1",8,0)
 ; TIUCONT1=1 --> Write "Continue to next/from previous-page" msgs
"RTN","TIUPRPN1",9,0)
 ; TIUPFNBR ---> Print Form # like vice 509
"RTN","TIUPRPN1",10,0)
 ; TIUMISC=TIUFLAG_U_TIUPFNBR_U_TIUDA
"RTN","TIUPRPN1",11,0)
 N TIUI,TIUJ,TIUPAGE,TIUFOOT,TIUK,TIUDA,TIUCONT,TIUPGRP,TIUTYP
"RTN","TIUPRPN1",12,0)
 N TIUPFHDR,TIUPFNBR,TIUMISC,TIUCONT1,TIUIDONE,TMP
"RTN","TIUPRPN1",13,0)
 S TIUFLAG=+$G(TIUFLAG),TIUSPG=+$G(TIUSPG)
"RTN","TIUPRPN1",14,0)
 S TIUCONT=1,TIUCONT1=0
"RTN","TIUPRPN1",15,0)
 S TIUI=0 F  S TIUI=$O(^TMP("TIUPR",$J,TIUI)) Q:TIUI=""  D  Q:'TIUCONT
"RTN","TIUPRPN1",16,0)
 . N DFN,TIU
"RTN","TIUPRPN1",17,0)
 . I TIUI["$" S TIUPGRP=$P(TIUI,"$"),TIUPFHDR=$P($P(TIUI,";"),"$",2)
"RTN","TIUPRPN1",18,0)
 . E  S TIUPFHDR="Progress Notes"
"RTN","TIUPRPN1",19,0)
 . I $G(TIUPGRP)>2 S TIUSPG=0
"RTN","TIUPRPN1",20,0)
 . S DFN=$P(TIUI,";",2)
"RTN","TIUPRPN1",21,0)
 . D PATPN^TIULV(.TIUFOOT,DFN)
"RTN","TIUPRPN1",22,0)
 . I +$G(TIUSPG) D HEADER^TIUPRPN2(.TIUFOOT,TIUFLAG,.TIUPFHDR,TIUCONT1)
"RTN","TIUPRPN1",23,0)
 . ; Use TIUJ="" (not TIUJ=0), to print "complete" notes w/o sigdt:
"RTN","TIUPRPN1",24,0)
 . S TIUJ="" F  S TIUJ=$O(^TMP("TIUPR",$J,TIUI,TIUJ)) Q:TIUJ=""  D  Q:'TIUCONT
"RTN","TIUPRPN1",25,0)
 . . S TIUK=0 F  S TIUK=$O(^TMP("TIUPR",$J,TIUI,TIUJ,TIUK)) Q:'TIUK  D  Q:'TIUCONT
"RTN","TIUPRPN1",26,0)
 . . . S TIUCONT1=0 S TIUPFNBR=^TMP("TIUPR",$J,TIUI,TIUJ,TIUK)
"RTN","TIUPRPN1",27,0)
 . . . ; If the document has been deleted, QUIT
"RTN","TIUPRPN1",28,0)
 . . . I '$D(^TIU(8925,+TIUK,0)) S TIUCONT=1 Q
"RTN","TIUPRPN1",29,0)
 . . . N TIUROOT
"RTN","TIUPRPN1",30,0)
 . . . I '+$G(TIUSPG) D HEADER^TIUPRPN2(.TIUFOOT,TIUFLAG,.TIUPFHDR,TIUCONT1)
"RTN","TIUPRPN1",31,0)
 . . . S TIUDA=TIUK
"RTN","TIUPRPN1",32,0)
 . . . S TIUMISC=TIUFLAG_U_TIUPFNBR_U_TIUDA
"RTN","TIUPRPN1",33,0)
 . . . K ^TMP("TIULQ",$J)
"RTN","TIUPRPN1",34,0)
 . . . D EXTRACT^TIULQ(+TIUDA,"^TMP(""TIULQ"",$J)",.TIUERR,"","",1)
"RTN","TIUPRPN1",35,0)
 . . . I +$G(TIUERR) W !,$P(TIUERR,U,2) Q
"RTN","TIUPRPN1",36,0)
 . . . Q:'$D(^TMP("TIULQ",$J))
"RTN","TIUPRPN1",37,0)
 . . . S TIUROOT="^TMP(""TIULQ"",$J,"_TIUDA_")"
"RTN","TIUPRPN1",38,0)
 . . . D REPORT(TIUROOT,.TIUFOOT,TIUMISC,.TIUCONT) Q:'TIUCONT
"RTN","TIUPRPN1",39,0)
 . . . D IDKIDS(TIUROOT,.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT) Q:'TIUCONT
"RTN","TIUPRPN1",40,0)
 . . . I '+$G(TIUSPG) S TIUCONT1=0 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,1,$G(TIUROOT))
"RTN","TIUPRPN1",41,0)
 . Q:'TIUCONT
"RTN","TIUPRPN1",42,0)
 . I $E(IOST)="C" S TIUCONT=$$STOP^TIUPRPN2() Q:'TIUCONT
"RTN","TIUPRPN1",43,0)
 . I +$G(TIUSPG),$E(IOST)'="C" S TIUCONT1=0 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,1,$G(TIUROOT))
"RTN","TIUPRPN1",44,0)
 Q
"RTN","TIUPRPN1",45,0)
 ;
"RTN","TIUPRPN1",46,0)
REPORT(TIUROOT,TIUFOOT,TIUMISC,TIUCONT,TIUIDEND) ; Report Text
"RTN","TIUPRPN1",47,0)
 ; Requires array TIUFOOT, vars TIUMISC, TIUCONT
"RTN","TIUPRPN1",48,0)
 ; Requires TIUROOT =
"RTN","TIUPRPN1",49,0)
 ; ^TMP("TIULQ",$J,NOTEIFN) for parent/stand-alone note, or
"RTN","TIUPRPN1",50,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZADD",ADDMIFN) for addendum, or
"RTN","TIUPRPN1",51,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZZID",KIDSEQ#,IDKIDIFN) for ID kid, or
"RTN","TIUPRPN1",52,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZZID",KIDSEQ#,IDKIDIFN,"ZADD",KIDADDMIFN)
"RTN","TIUPRPN1",53,0)
 ;       for ID kid addm.
"RTN","TIUPRPN1",54,0)
 N DIW,DIWF,DIWL,DIWR,DIWT,TIUERR,TIU,TIUI,X,Z,LOC
"RTN","TIUPRPN1",55,0)
 N REFDT,TITLE,ADT,HLOC,SUBJ
"RTN","TIUPRPN1",56,0)
 N TIUDA,TIUCONT1,HASIDKID,HASIDDAD
"RTN","TIUPRPN1",57,0)
 S TIUDA=$P(TIUMISC,U,3),TIUCONT1=0
"RTN","TIUPRPN1",58,0)
 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",59,0)
 S HASIDKID=$G(^TMP("TIULQ",$J,TIUDA,"ZZID",0)) ;how many ID kids
"RTN","TIUPRPN1",60,0)
 S HASIDDAD=$S(TIUROOT["ZZID":1,1:0)
"RTN","TIUPRPN1",61,0)
 I HASIDKID W "<< Interdisciplinary Note - Begin >>",!
"RTN","TIUPRPN1",62,0)
 I HASIDDAD W "<< Interdisciplinary Note - Cont. >>",!
"RTN","TIUPRPN1",63,0)
 W $S('HASIDKID&'HASIDDAD:"NOTE DATED: ",1:"ENTRY DATED: ")
"RTN","TIUPRPN1",64,0)
 S REFDT=@TIUROOT@(1301,"I")
"RTN","TIUPRPN1",65,0)
 W $$DATE^TIULS(REFDT,"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN1",66,0)
 S TITLE=@TIUROOT@(.01,"E")
"RTN","TIUPRPN1",67,0)
 W ?30,$$UP^XLFSTR(TITLE),!
"RTN","TIUPRPN1",68,0)
 S LOC=$G(@TIUROOT@(1205,"I"))
"RTN","TIUPRPN1",69,0)
 I +LOC D
"RTN","TIUPRPN1",70,0)
 . W $S($P(^SC(LOC,0),U,3)="W":"ADMITTED: ",1:"VISIT: ")
"RTN","TIUPRPN1",71,0)
 . S ADT=$G(@TIUROOT@(.07,"I"))
"RTN","TIUPRPN1",72,0)
 . W $$DATE^TIULS(ADT,"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN1",73,0)
 . S HLOC=$G(@TIUROOT@(1205,"E"))
"RTN","TIUPRPN1",74,0)
 . W " ",HLOC
"RTN","TIUPRPN1",75,0)
 S SUBJ=$G(@TIUROOT@(1701,"E"))
"RTN","TIUPRPN1",76,0)
 I SUBJ]"" W !,"SUBJECT: ",^("E"),!
"RTN","TIUPRPN1",77,0)
 S TIUCONT1=1
"RTN","TIUPRPN1",78,0)
 I $D(@TIUROOT@("PROBLEM")) D  Q:'TIUCONT
"RTN","TIUPRPN1",79,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",80,0)
 . W !,"ASSOCIATED PROBLEMS:"
"RTN","TIUPRPN1",81,0)
 . N TIUI S TIUI=0
"RTN","TIUPRPN1",82,0)
 . F  S TIUI=$O(@TIUROOT@("PROBLEM",TIUI)) Q:'TIUI  D  Q:'TIUCONT
"RTN","TIUPRPN1",83,0)
 ..W !,^(TIUI,0)
"RTN","TIUPRPN1",84,0)
 ..S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",85,0)
 W !
"RTN","TIUPRPN1",86,0)
 S TIUI=0,DIWF="WN",DIWL=1,DIWR=79 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",87,0)
 F  S TIUI=$O(@TIUROOT@("TEXT",TIUI)) Q:TIUI'>0  D  Q:'TIUCONT  ; D ^DIWW
"RTN","TIUPRPN1",88,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",89,0)
 . S X=@TIUROOT@("TEXT",TIUI,0) S:X="" X=" " D ^DIWP
"RTN","TIUPRPN1",90,0)
 D ^DIWW K ^UTILITY($J,"W")
"RTN","TIUPRPN1",91,0)
 Q:'TIUCONT
"RTN","TIUPRPN1",92,0)
 D GETSIG(TIUROOT,.TIUSIG)
"RTN","TIUPRPN1",93,0)
 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",94,0)
 W !
"RTN","TIUPRPN1",95,0)
 D SIGBLK^TIUPRPN8(.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT,.TIUSIG,TIUROOT)
"RTN","TIUPRPN1",96,0)
 Q:'TIUCONT
"RTN","TIUPRPN1",97,0)
ADDENDA ; Fall through and do Addenda of docmt TIUDA
"RTN","TIUPRPN1",98,0)
 N DIW,DIWF,DIWL,DIWR,DIWT,X,Z,TIUI,TIUADD,ADDMRDT
"RTN","TIUPRPN1",99,0)
 S TIUADD=0,DIWF="WN",DIWL=1,DIWR=79 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",100,0)
 F  S TIUADD=$O(@TIUROOT@("ZADD",TIUADD)) Q:TIUADD'>0  D  Q:'TIUCONT
"RTN","TIUPRPN1",101,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",102,0)
 . S ADDMRDT=@TIUROOT@("ZADD",TIUADD,1301,"I")
"RTN","TIUPRPN1",103,0)
 . W !!,$$DATE^TIULS(ADDMRDT,"MM/DD/CCYY HR:MIN"),?21,"ADDENDUM"
"RTN","TIUPRPN1",104,0)
 . S TIUI=0
"RTN","TIUPRPN1",105,0)
 . F  S TIUI=$O(@TIUROOT@("ZADD",TIUADD,"TEXT",TIUI)) Q:TIUI'>0  D  Q:'TIUCONT
"RTN","TIUPRPN1",106,0)
 . . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",107,0)
 . . S X=@TIUROOT@("ZADD",TIUADD,"TEXT",TIUI,0) S:X="" X=" " D ^DIWP
"RTN","TIUPRPN1",108,0)
 . D ^DIWW
"RTN","TIUPRPN1",109,0)
 . Q:'TIUCONT
"RTN","TIUPRPN1",110,0)
 . N TIUADRT
"RTN","TIUPRPN1",111,0)
 . S TIUADRT=$P(TIUROOT,")")_",""ZADD"","_TIUADD_")"
"RTN","TIUPRPN1",112,0)
 . D GETSIG(TIUADRT,.TIUSIG)
"RTN","TIUPRPN1",113,0)
 . D SIGBLK^TIUPRPN8(.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT,.TIUSIG,TIUADRT)
"RTN","TIUPRPN1",114,0)
 ; Need ! in front for amended notes:
"RTN","TIUPRPN1",115,0)
 I $G(TIUIDEND) W !,"<< Interdisciplinary Note - End >>",!
"RTN","TIUPRPN1",116,0)
 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",117,0)
 ; Write 2 linefeeds between records
"RTN","TIUPRPN1",118,0)
 W:TIUCONT !!
"RTN","TIUPRPN1",119,0)
 Q
"RTN","TIUPRPN1",120,0)
 ;
"RTN","TIUPRPN1",121,0)
IDKIDS(TIUROOT,TIUFOOT,TIUMISC,TIUCONT1,TIUCONT) ; Print ID kids
"RTN","TIUPRPN1",122,0)
 ;of docmt TIUDA (each kid does its own addenda)
"RTN","TIUPRPN1",123,0)
 N TIUL,KIDDA,TIUDA,TIUSORT,TIUIDRT,TIUIDEND
"RTN","TIUPRPN1",124,0)
 S TIUDA=$P(TIUMISC,U,3),TIUIDEND=0
"RTN","TIUPRPN1",125,0)
 S TIUL=0
"RTN","TIUPRPN1",126,0)
 F  S TIUL=$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL)) Q:'TIUL  D  Q:'TIUCONT
"RTN","TIUPRPN1",127,0)
 . S KIDDA=$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL,0))
"RTN","TIUPRPN1",128,0)
 . S TIUMISC=TIUFLAG_U_TIUPFNBR_U_KIDDA
"RTN","TIUPRPN1",129,0)
 . S TIUIDRT="^TMP(""TIULQ"",$J,"_TIUDA_",""ZZID"","_TIUL_","_KIDDA_")"
"RTN","TIUPRPN1",130,0)
 . I '$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL)) S TIUIDEND=1
"RTN","TIUPRPN1",131,0)
 . D REPORT(TIUIDRT,.TIUFOOT,TIUMISC,.TIUCONT,TIUIDEND)
"RTN","TIUPRPN1",132,0)
 Q
"RTN","TIUPRPN1",133,0)
 ;
"RTN","TIUPRPN1",134,0)
GETSIG(TIUROOT,TIUSIG) ; Get signature info from TIULQ global;
"RTN","TIUPRPN1",135,0)
 ; Set info into TIUSIG array **100**
"RTN","TIUPRPN1",136,0)
 ; Requires array name TIUROOT; passes back array TIUSIG
"RTN","TIUPRPN1",137,0)
 ; TIUROOT = ^TMP("TIULQ",$J,NOTEIFN) for parent note, or
"RTN","TIUPRPN1",138,0)
 ;           ^TMP("TIULQ",$J,NOTEIFN,"ZADD",ADDMIFN) for addendum, or
"RTN","TIUPRPN1",139,0)
 ;           ^TMP("TIULQ",$J,NOTEIFN,"ZZID",IDKIDIFN) for ID kid.
"RTN","TIUPRPN1",140,0)
 ; Signature should be on bottom of form, Addenda on Subsequent pages
"RTN","TIUPRPN1",141,0)
 N TIULINE S $P(TIULINE,"-",81)=""
"RTN","TIUPRPN1",142,0)
 S TIUSIG("AUTHOR")=$G(@TIUROOT@(1202,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",143,0)
 S TIUSIG("EXPSIGNR")=$G(@TIUROOT@(1204,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",144,0)
 S TIUSIG("EXPCOSNR")=$G(@TIUROOT@(1208,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",145,0)
 S TIUSIG("SIGNDATE")=$G(@TIUROOT@(1501,"I"))
"RTN","TIUPRPN1",146,0)
 S TIUSIG("SIGNEDBY")=$G(@TIUROOT@(1502,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",147,0)
 S TIUSIG("SIGNNAME")=$G(@TIUROOT@(1503,"E"))
"RTN","TIUPRPN1",148,0)
 S TIUSIG("SIGTITL")=$G(@TIUROOT@(1504,"E"))
"RTN","TIUPRPN1",149,0)
 S TIUSIG("SIGNMODE")=$G(@TIUROOT@(1505,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",150,0)
 S TIUSIG("COSGDATE")=$G(@TIUROOT@(1507,"I"))
"RTN","TIUPRPN1",151,0)
 S TIUSIG("COSGEDBY")=$G(@TIUROOT@(1508,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",152,0)
 S TIUSIG("COSGNAME")=$G(@TIUROOT@(1509,"E"))
"RTN","TIUPRPN1",153,0)
 S TIUSIG("COSGTITL")=$G(@TIUROOT@(1510,"E"))
"RTN","TIUPRPN1",154,0)
 S TIUSIG("COSGMODE")=$G(@TIUROOT@(1511,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",155,0)
 S TIUSIG("SIGCHRT")=$G(@TIUROOT@(1512,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",156,0)
 S TIUSIG("COSCHRT")=$G(@TIUROOT@(1513,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",157,0)
 Q
"RTN","TIUPRPN1",158,0)
 ;
"RTN","TIUPRPN1",159,0)
SETCONT(TIUFOOT,TIUMISC,TIUCONT1,TIUHEAD,TIUROOT) ;Does footer
"RTN","TIUPRPN1",160,0)
 ;and returns TIUCONT
"RTN","TIUPRPN1",161,0)
 ; Requires array TIUFOOT, vars TIUMISC,TIUCONT1; optional TIUHEAD
"RTN","TIUPRPN1",162,0)
 ; Optional TIUROOT
"RTN","TIUPRPN1",163,0)
 Q $$FOOTER^TIUPRPN2(.TIUFOOT,TIUMISC,TIUCONT1,TIUHEAD,$G(TIUROOT))
"RTN","TIUPRPN2")
0^52^B8876435
"RTN","TIUPRPN2",1,0)
TIUPRPN2 ;SLC/MJC - Header/Footer for Progress Notes ;25-JAN-2001 08:50:35
"RTN","TIUPRPN2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**44,45,52,100**;Jun 20, 1997
"RTN","TIUPRPN2",3,0)
FOOTER(TIUFOOT,TIUMISC,TIUCONT1,TIUHDR,TIUROOT) ; Function returns TIUCONT
"RTN","TIUPRPN2",4,0)
 ; Also controls Pagination position, writes footer when appropriate.
"RTN","TIUPRPN2",5,0)
 ; Requires array TIUFOOT, vars TIUMISC,TIUCONT1. Optional TIUHDR.
"RTN","TIUPRPN2",6,0)
 ; IF TIUHDR=1, HEADER WILL NOT BE PRINTED
"RTN","TIUPRPN2",7,0)
 N TIUCONT,TIUFLAG,TIUPFNBR,TIUDA
"RTN","TIUPRPN2",8,0)
 S TIUCONT=1
"RTN","TIUPRPN2",9,0)
 S TIUFLAG=$P(TIUMISC,U),TIUPFNBR=$P(TIUMISC,U,2),TIUDA=$P(TIUMISC,U,3)
"RTN","TIUPRPN2",10,0)
 I $E(IOST)="C" G FOOTX:$Y+3<IOSL S TIUCONT=$$STOP G FOOTW
"RTN","TIUPRPN2",11,0)
 G FTR:+$G(TIUHDR)
"RTN","TIUPRPN2",12,0)
 G:$Y+7<IOSL FOOTX
"RTN","TIUPRPN2",13,0)
FTR I (IOT'="HFS")!(IOSL<250) F  Q:$Y+6'<IOSL  W ! ;moves ftr to pg bottom
"RTN","TIUPRPN2",14,0)
 N TIUFNUM,TIULINE,LOC,DIV,TIUDIV,TIUDIVI,TIUPRTDT,TIUPRTNM
"RTN","TIUPRPN2",15,0)
 S $P(TIULINE,"-",81)=""
"RTN","TIUPRPN2",16,0)
 W ?21,$S(+$G(TIUCONT1):"** THIS NOTE CONTINUED ON NEXT PAGE **",1:""),!
"RTN","TIUPRPN2",17,0)
 I '+$G(TIUFLAG) W "WORK COPY ========== UNOFFICIAL "
"RTN","TIUPRPN2",18,0)
 I  W "- NOT FOR MEDICAL RECORD =========== DO NOT FILE"
"RTN","TIUPRPN2",19,0)
 E  W TIULINE
"RTN","TIUPRPN2",20,0)
 W !,TIUFOOT("PNMP")
"RTN","TIUPRPN2",21,0)
 S LOC=$S($L(TIUROOT):$G(@TIUROOT@(1205,"I")),1:"") ; **100**
"RTN","TIUPRPN2",22,0)
 I LOC D
"RTN","TIUPRPN2",23,0)
 . S DIV=+$P($G(^SC(LOC,0)),U,15)
"RTN","TIUPRPN2",24,0)
 . S TIUDIV=+$O(^TIU(8925.94,"B",DIV,0))
"RTN","TIUPRPN2",25,0)
 I $G(TIUDIV),$P($G(^TIU(8925.94,TIUDIV,0)),U,2)]"" S TIUDIVI=$P(^(0),U,2)
"RTN","TIUPRPN2",26,0)
 S TIUPRTNM=$S($G(TIUDIVI)]"":TIUDIVI,$G(TIUFOOT("INTNM"))]"":TIUFOOT("INTNM"),1:TIUFOOT("SITE"))
"RTN","TIUPRPN2",27,0)
 S TIUPRTDT="Printed:"_$$DATE^TIULS($$NOW^TIULC,"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN2",28,0)
 I $L(TIUPRTNM)<36 D
"RTN","TIUPRPN2",29,0)
 . W ?(80-$L(TIUPRTNM)\2),TIUPRTNM,?56,TIUPRTDT
"RTN","TIUPRPN2",30,0)
 ELSE  D
"RTN","TIUPRPN2",31,0)
 . W ?58,TIUPRTDT,!?(80-$L(TIUPRTNM)\2),TIUPRTNM
"RTN","TIUPRPN2",32,0)
 W !,TIUFOOT("SSN")," ",TIUFOOT("DOB"),?(80-$L(TIUFOOT("LOCP"))\2),TIUFOOT("LOCP")
"RTN","TIUPRPN2",33,0)
 I +$G(TIUFLAG) W ?(80-$L(TIUPFNBR)),TIUPFNBR
"RTN","TIUPRPN2",34,0)
 I '+$G(TIUFLAG) W ?(80-$L(TIUFOOT("PH#"))),TIUFOOT("PH#")
"RTN","TIUPRPN2",35,0)
 I +$G(TIUFLAG) W !,TIULINE
"RTN","TIUPRPN2",36,0)
 E  W !,"=========================== CONFIDENTIAL INFORMATION ==========================="
"RTN","TIUPRPN2",37,0)
 W @IOF
"RTN","TIUPRPN2",38,0)
 ;I '+$G(TIUHDR),+$G(TIUCONT) D HEADER(.TIUFOOT,TIUFLAG,.TIUPFHDR,.TIUCONT1) ;; why send TIUCONT1 by ref? not used here in FOOTER, & TIUCONT1 never sent to FOOTER by ref.
"RTN","TIUPRPN2",39,0)
FOOTW I '+$G(TIUHDR),+$G(TIUCONT) D HEADER(.TIUFOOT,TIUFLAG,.TIUPFHDR,TIUCONT1,$G(TIUROOT))
"RTN","TIUPRPN2",40,0)
FOOTX ;
"RTN","TIUPRPN2",41,0)
 Q TIUCONT
"RTN","TIUPRPN2",42,0)
HEADER(TIUFOOT,TIUFLAG,TIUPFHDR,TIUCONT1,TIUROOT) ; Header
"RTN","TIUPRPN2",43,0)
 ; Requires array TIUFOOT, vars TIUFLAG,TIUPFHDR,TIUCONT1
"RTN","TIUPRPN2",44,0)
 N TIULINE S $P(TIULINE,"-",81)=""
"RTN","TIUPRPN2",45,0)
 I $E(IOST)="C" D
"RTN","TIUPRPN2",46,0)
 .W @IOF,$C(13),TIULINE,!,TIUFOOT("PNMP")_"  "_TIUFOOT("SSN")
"RTN","TIUPRPN2",47,0)
 .W ?(78-$L(TIUPFHDR)),TIUPFHDR,!,TIULINE,!
"RTN","TIUPRPN2",48,0)
 .I +$G(TIUCONT1) W $$DATE^TIULS(@TIUROOT@(1301,"I"),"MM/DD/CCYY HR:MIN"),?21,"** CONTINUED FROM PREVIOUS SCREEN **",!
"RTN","TIUPRPN2",49,0)
 E  D
"RTN","TIUPRPN2",50,0)
 .W !,TIULINE,!,$S('+$G(TIUFLAG):"** WORK COPY - NOT FOR ",1:"")
"RTN","TIUPRPN2",51,0)
 .W "MEDICAL RECORD" W:'+$G(TIUFLAG) " **" W ?(80-$L(TIUPFHDR)),TIUPFHDR
"RTN","TIUPRPN2",52,0)
 .W !,TIULINE,!
"RTN","TIUPRPN2",53,0)
 .I +$G(TIUCONT1) W $$DATE^TIULS(@TIUROOT@(1301,"I"),"MM/DD/CCYY HR:MIN"),?21,"** CONTINUED FROM PREVIOUS PAGE **",!!
"RTN","TIUPRPN2",54,0)
 ;K TIUCONT1;**100** why needed? TIUCONT1 not sent by ref except in FOOTER at the end, and FOOTER never receives TIUCONT1 by ref.
"RTN","TIUPRPN2",55,0)
 Q
"RTN","TIUPRPN2",56,0)
STOP() ;on screen paging check
"RTN","TIUPRPN2",57,0)
 ; quits TIUCONT=1 if cont. ELSE quits TIUCONT=0
"RTN","TIUPRPN2",58,0)
 N DIR,Y,TIUCONT
"RTN","TIUPRPN2",59,0)
 S DIR(0)="E" D ^DIR
"RTN","TIUPRPN2",60,0)
 S TIUCONT=Y
"RTN","TIUPRPN2",61,0)
 Q TIUCONT
"RTN","TIUPRPN3")
0^68^B37848861
"RTN","TIUPRPN3",1,0)
TIUPRPN3 ;SLC/MJC-Sort PNs for Prting;;3/21/01
"RTN","TIUPRPN3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUPRPN3",3,0)
 ;
"RTN","TIUPRPN3",4,0)
SETUP(TITLE) ;displays centered option hdr
"RTN","TIUPRPN3",5,0)
 N TIULINE
"RTN","TIUPRPN3",6,0)
 S $P(TIULINE,"-",80)=""
"RTN","TIUPRPN3",7,0)
 W @IOF,!!?(IOM-$L(TITLE)\2),TITLE,!,TIULINE,!
"RTN","TIUPRPN3",8,0)
 Q
"RTN","TIUPRPN3",9,0)
PT ;sorts PNs to prt by pt for selected date range
"RTN","TIUPRPN3",10,0)
 ;these notes are chartable either contiguous or separate pgs
"RTN","TIUPRPN3",11,0)
 ;[TIU PRINT PN PT]
"RTN","TIUPRPN3",12,0)
 ;
"RTN","TIUPRPN3",13,0)
 N TIUDFN,TIUQT,DIC,Y,TIUXREF,CTR1
"RTN","TIUPRPN3",14,0)
 D SETUP("Print Progress Notes for a Selected PATIENT")
"RTN","TIUPRPN3",15,0)
 F  W ! S DIC=2,DIC(0)="AEQMN" D ^DIC Q:Y<0  D  K TIUQT
"RTN","TIUPRPN3",16,0)
 .N TIUFLAG,TIUSPG
"RTN","TIUPRPN3",17,0)
 .S CTR1=0,TIUDFN=Y,TIUXREF="APTP" ;pt/pt x-ref
"RTN","TIUPRPN3",18,0)
 .D FETCH(TIUXREF,TIUDFN,.CTR1) Q:$D(TIUQT)
"RTN","TIUPRPN3",19,0)
 .S TIUFLAG=$$FLAG() Q:TIUFLAG']""
"RTN","TIUPRPN3",20,0)
 .I +$G(TIUFLAG),CTR1>1 S TIUSPG=$$PAGE Q:TIUSPG']""
"RTN","TIUPRPN3",21,0)
 .S TIUSPG=$S(+$G(TIUSPG):0,1:1)
"RTN","TIUPRPN3",22,0)
 .D DEVICE^TIUPRPN(TIUFLAG,TIUSPG)
"RTN","TIUPRPN3",23,0)
 Q
"RTN","TIUPRPN3",24,0)
 ;
"RTN","TIUPRPN3",25,0)
AUTHOR ;sorts PNs to prt by author for selected date range
"RTN","TIUPRPN3",26,0)
 ;these guys are only chartable if prted on separate pages
"RTN","TIUPRPN3",27,0)
 ;[TIU PRINT PN AUTHOR]
"RTN","TIUPRPN3",28,0)
 ;
"RTN","TIUPRPN3",29,0)
 N TIUDUZ,TIUQT,DIC,Y,TIUXREF
"RTN","TIUPRPN3",30,0)
 D SETUP("Print Progress Notes for a Selected AUTHOR")
"RTN","TIUPRPN3",31,0)
 S DIC=200,DIC(0)="AEQMN",DIC("A")="AUTHOR: "
"RTN","TIUPRPN3",32,0)
 F  W ! D ^DIC Q:Y<0  D  K TIUQT
"RTN","TIUPRPN3",33,0)
 .N TIUFLAG,TIUSPG
"RTN","TIUPRPN3",34,0)
 .S TIUDUZ=Y,TIUXREF="AAUP" ;author/author x-ref
"RTN","TIUPRPN3",35,0)
 .D FETCH(TIUXREF,TIUDUZ) Q:$D(TIUQT)
"RTN","TIUPRPN3",36,0)
 .S TIUFLAG=$$FLAG() Q:TIUFLAG']""
"RTN","TIUPRPN3",37,0)
 .S TIUSPG=$S(+$G(TIUFLAG):0,1:1)
"RTN","TIUPRPN3",38,0)
 .D DEVICE^TIUPRPN(TIUFLAG,TIUSPG)
"RTN","TIUPRPN3",39,0)
 Q
"RTN","TIUPRPN3",40,0)
 ;
"RTN","TIUPRPN3",41,0)
LOC ;sorts PNs to prt by location for selected date range
"RTN","TIUPRPN3",42,0)
 ;they are only chartable if prted on separate pages
"RTN","TIUPRPN3",43,0)
 ;[TIU PRINT PN LOC]
"RTN","TIUPRPN3",44,0)
 ;
"RTN","TIUPRPN3",45,0)
 N TIUDUZ,TIUQT,DIC,Y,TIUXREF
"RTN","TIUPRPN3",46,0)
 D SETUP("Print Progress Notes for a Selected LOCATION")
"RTN","TIUPRPN3",47,0)
 S DIC=44,DIC(0)="AEQMN"
"RTN","TIUPRPN3",48,0)
 F  W ! D ^DIC Q:Y<0  D  K TIUQT
"RTN","TIUPRPN3",49,0)
 .N TIUFLAG,TIUSPG
"RTN","TIUPRPN3",50,0)
 .S TIULOC=Y,TIUXREF="ALOCP" ;location/location x-ref
"RTN","TIUPRPN3",51,0)
 .D FETCH(TIUXREF,TIULOC) Q:$D(TIUQT)
"RTN","TIUPRPN3",52,0)
 .S TIUFLAG=$$FLAG() Q:TIUFLAG']""
"RTN","TIUPRPN3",53,0)
 .S TIUSPG=$S(+$G(TIUFLAG):0,1:1)
"RTN","TIUPRPN3",54,0)
 .D DEVICE^TIUPRPN(TIUFLAG,TIUSPG)
"RTN","TIUPRPN3",55,0)
 Q
"RTN","TIUPRPN3",56,0)
 ;
"RTN","TIUPRPN3",57,0)
FETCH(TIUXREF,ENTITY,CTR1) ;get the notes select date range
"RTN","TIUPRPN3",58,0)
 ; Passes back optional CTR1 = # of notes
"RTN","TIUPRPN3",59,0)
 N OLD,NEW,BEG,END,HOLD,SORT,DFN,IFN,Y,RPARRAY,DATE
"RTN","TIUPRPN3",60,0)
 S OLD=0 S OLD=$O(^TIU(8925,TIUXREF,+ENTITY,OLD)) I 'OLD D  S TIUQT=1 Q
"RTN","TIUPRPN3",61,0)
 .W !!,$C(7),"No signed notes available for "_$P(ENTITY,U,2),!
"RTN","TIUPRPN3",62,0)
 S OLD=$O(^TIU(8925,TIUXREF,+ENTITY,0))
"RTN","TIUPRPN3",63,0)
 S NEW=$O(^TIU(8925,TIUXREF,+ENTITY,9999999),-1)
"RTN","TIUPRPN3",64,0)
 W !!,"Available note",$S(OLD'=NEW:"s",1:""),": "
"RTN","TIUPRPN3",65,0)
 W $$FMTE^XLFDT(OLD,"D")
"RTN","TIUPRPN3",66,0)
 I OLD'=NEW W " thru ",$$FMTE^XLFDT(NEW,"D")
"RTN","TIUPRPN3",67,0)
FISH I OLD=NEW S (BEG,END)=$E(OLD,1,7)
"RTN","TIUPRPN3",68,0)
 E  D  W ! K %DT Q:$D(TIUQT)
"RTN","TIUPRPN3",69,0)
 .S %DT="AEPTX",%DT(0)="-NOW",%DT("A")="Print Notes Beginning: "
"RTN","TIUPRPN3",70,0)
 .D ^%DT I $D(DTOUT)!(Y<0) S TIUQT=1 Q
"RTN","TIUPRPN3",71,0)
 .S BEG=Y,%DT("A")="                 Thru: "
"RTN","TIUPRPN3",72,0)
 .S %DT="AEPTX" D ^%DT I $D(DTOUT)!(Y<0) S TIUQT=1 Q
"RTN","TIUPRPN3",73,0)
 .S END=Y I END<BEG S HOLD=BEG,BEG=END,END=HOLD
"RTN","TIUPRPN3",74,0)
 ; load up the notes
"RTN","TIUPRPN3",75,0)
 W !!,"Searching for the notes"
"RTN","TIUPRPN3",76,0)
 K ^TMP("TIUPR",$J),RPARRAY ;K RPARRAY since user may go FISH
"RTN","TIUPRPN3",77,0)
 S DATE=BEG,END=END+.9999999
"RTN","TIUPRPN3",78,0)
 F  S DATE=$O(^TIU(8925,TIUXREF,+ENTITY,DATE)) Q:'DATE!(DATE>END)  D
"RTN","TIUPRPN3",79,0)
 .S IFN=0 F  S IFN=$O(^TIU(8925,TIUXREF,+ENTITY,DATE,IFN)) Q:'IFN  D
"RTN","TIUPRPN3",80,0)
 ..W "." D REPLACE(IFN,.RPARRAY,DATE,1501)
"RTN","TIUPRPN3",81,0)
 S IFN=0 F  S IFN=$O(RPARRAY(IFN)) Q:'IFN  Q:'RPARRAY(IFN)  D
"RTN","TIUPRPN3",82,0)
 .S DFN=$P(^TIU(8925,IFN,0),U,2),SORT=$P(^DPT(DFN,0),U)_";"_DFN
"RTN","TIUPRPN3",83,0)
 .S DATE=RPARRAY(IFN,"DT")
"RTN","TIUPRPN3",84,0)
 .S ^TMP("TIUPR",$J,SORT,DATE,IFN)="Vice SF 509"
"RTN","TIUPRPN3",85,0)
 I '$D(^TMP("TIUPR",$J)) W !!,"No notes found- try again!",! G FISH
"RTN","TIUPRPN3",86,0)
 S CTR1=+$G(RPARRAY)
"RTN","TIUPRPN3",87,0)
 W !,">> "_CTR1_" note"_$S(CTR1>1:"s",1:"")_" found for "_$P(ENTITY,U,2)
"RTN","TIUPRPN3",88,0)
 Q
"RTN","TIUPRPN3",89,0)
 ;
"RTN","TIUPRPN3",90,0)
REPLACE(TIUDA,RPARRAY,DATTIM,DTFIELD,CKCANVW) ; Populate RPARRAY array
"RTN","TIUPRPN3",91,0)
 ;w records received, replacing ID kids or addenda with their parents.
"RTN","TIUPRPN3",92,0)
 ; Requires TIUDA. 
"RTN","TIUPRPN3",93,0)
 ; Sets & passes back RPARRAY(IFN)=1 or 1^TIUDA, or 0
"RTN","TIUPRPN3",94,0)
 ;where IFN is TIUDA or its ID parent.
"RTN","TIUPRPN3",95,0)
 ; If TIUDA is replaced by its parent, then RPARRAY(IFN)=1^TIUDA,
"RTN","TIUPRPN3",96,0)
 ;to know what child the parent was included in the list for.
"RTN","TIUPRPN3",97,0)
 ; If CKCANVW = 1 is received, code checks CAN VIEW before
"RTN","TIUPRPN3",98,0)
 ;setting RPARRAY.
"RTN","TIUPRPN3",99,0)
 ; Sets & passes back RPARRAY = # of [viewable] elements in RPARRAY.
"RTN","TIUPRPN3",100,0)
 ; Optional DATTIM = 
"RTN","TIUPRPN3",101,0)
 ;      Signature date/time of record, NOT inverse, if DTFIELD = 1501
"RTN","TIUPRPN3",102,0)
 ;      Reference date/time of record, inverse, if DTFIELD = 1301
"RTN","TIUPRPN3",103,0)
 ;If DATTIM received=non null, passes back RPARRAY(IFN,"DT")=DATTIM
"RTN","TIUPRPN3",104,0)
 ;  Optional DTFIELD = 1501 or 1301; default = 1501
"RTN","TIUPRPN3",105,0)
 ; 1/11/01 cf REPLACE^TIUSRVLL.
"RTN","TIUPRPN3",106,0)
 N IDPRNT,PDATTIM,DTNODE,PCANDO,CANDO
"RTN","TIUPRPN3",107,0)
 S RPARRAY=+$G(RPARRAY)
"RTN","TIUPRPN3",108,0)
 S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIUPRPN3",109,0)
 ; -- If user can't view record, quit and
"RTN","TIUPRPN3",110,0)
 ;    if it is parent, track it as already processed
"RTN","TIUPRPN3",111,0)
 ;    (but not a 'good' record):
"RTN","TIUPRPN3",112,0)
 I $G(CKCANVW) D  Q:'$G(CANDO)
"RTN","TIUPRPN3",113,0)
 . S CANDO=+$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUPRPN3",114,0)
 . I '$G(CANDO),$O(^TIU(8925,"GDAD",TIUDA,0)) S RPARRAY(TIUDA)=0
"RTN","TIUPRPN3",115,0)
 S DTNODE=$S($G(DTFIELD)=1301:13,1:15)
"RTN","TIUPRPN3",116,0)
 ; -- If record is child with nonexistent parent,
"RTN","TIUPRPN3",117,0)
 ;    treat record as stand-alone:
"RTN","TIUPRPN3",118,0)
 I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIUPRPN3",119,0)
 ; -- If record is child, & parent already in array
"RTN","TIUPRPN3",120,0)
 ;    from previous cycle (viewable or not), just quit:
"RTN","TIUPRPN3",121,0)
 I IDPRNT,$D(RPARRAY(IDPRNT)) Q
"RTN","TIUPRPN3",122,0)
 ; -- If record is child, & parent not viewable,
"RTN","TIUPRPN3",123,0)
 ;    track parent as processed but not 'good' & quit:
"RTN","TIUPRPN3",124,0)
 I IDPRNT,$G(CKCANVW) D  I '$G(PCANDO) S RPARRAY(IDPRNT)=0 Q
"RTN","TIUPRPN3",125,0)
 . S PCANDO=+$$CANDO^TIULP(IDPRNT,"VIEW")
"RTN","TIUPRPN3",126,0)
 ; -- If record is not child, just put it
"RTN","TIUPRPN3",127,0)
 ;    in RPARRAY and quit: --
"RTN","TIUPRPN3",128,0)
 I 'IDPRNT D  G REPX
"RTN","TIUPRPN3",129,0)
 . ; -- If record is already in array as parent from previous cycle
"RTN","TIUPRPN3",130,0)
 . ;    (viewable or not), and is now received on its own merit,
"RTN","TIUPRPN3",131,0)
 . ;    quit & don't consider it there because of a child:
"RTN","TIUPRPN3",132,0)
 . I $D(RPARRAY(TIUDA)) S RPARRAY(TIUDA)=+RPARRAY(TIUDA) Q
"RTN","TIUPRPN3",133,0)
 . S RPARRAY(TIUDA)=1
"RTN","TIUPRPN3",134,0)
 . I $G(DATTIM)'="" S RPARRAY(TIUDA,"DT")=DATTIM
"RTN","TIUPRPN3",135,0)
 . S RPARRAY=$G(RPARRAY)+1
"RTN","TIUPRPN3",136,0)
 ; -- If record is child, put its parent in array:
"RTN","TIUPRPN3",137,0)
 I IDPRNT,$G(DATTIM)'="" D
"RTN","TIUPRPN3",138,0)
 . S PDATTIM=+$G(^TIU(8925,IDPRNT,DTNODE))
"RTN","TIUPRPN3",139,0)
 . I PDATTIM,DTNODE=13 S PDATTIM=9999999-PDATTIM
"RTN","TIUPRPN3",140,0)
 I IDPRNT D  G REPX
"RTN","TIUPRPN3",141,0)
 . S RPARRAY(IDPRNT)=1_U_TIUDA ;parent in array because of child TIUDA
"RTN","TIUPRPN3",142,0)
 . I $G(DATTIM)'="" S RPARRAY(IDPRNT,"DT")=PDATTIM
"RTN","TIUPRPN3",143,0)
 . S RPARRAY=$G(RPARRAY)+1
"RTN","TIUPRPN3",144,0)
REPX Q
"RTN","TIUPRPN3",145,0)
 ;
"RTN","TIUPRPN3",146,0)
FLAG() ;asks question for CHART vs. WORK copies
"RTN","TIUPRPN3",147,0)
 ;returns TIUFLAG=1 if CHART copy - TIUFLAG=0 if WORK copy - NULL if '^'
"RTN","TIUPRPN3",148,0)
 S TIUFLAG=$$READ^TIUU("SA^C:CHART;W:WORK","Do you want WORK copies or CHART copies? ","CHART","^D HELP^TIUPRPN3")
"RTN","TIUPRPN3",149,0)
 I $E(TIUFLAG)="^" S TIUFLAG=""
"RTN","TIUPRPN3",150,0)
 E  S TIUFLAG=$S($P(TIUFLAG,U)="C":1,1:0)
"RTN","TIUPRPN3",151,0)
 Q TIUFLAG
"RTN","TIUPRPN3",152,0)
 ;
"RTN","TIUPRPN3",153,0)
PAGE() ;asks question for CONTIGUOUS vs. SEPARATE PAGE print
"RTN","TIUPRPN3",154,0)
 ;returns TIUSPG=0 for CONTIGUOUS - TIUSPG=1 SEPARATE PAGE - NULL if '^'
"RTN","TIUPRPN3",155,0)
 S TIUSPG=$$READ^TIUU("YA","Do you want to start each note on a new page? ","NO","^D HELP1^TIUPRPN3")
"RTN","TIUPRPN3",156,0)
 I $E(TIUSPG)="^" S TIUSPG=""
"RTN","TIUPRPN3",157,0)
 E  S TIUSPG=$S(+$G(TIUSPG):1,1:0)
"RTN","TIUPRPN3",158,0)
 Q TIUSPG
"RTN","TIUPRPN3",159,0)
HELP ; answers questions regarding WORK vs. CHART copies
"RTN","TIUPRPN3",160,0)
 W !!?5,"The FOOTERS of WORK/CHART copies vary significantly.  The WORK"
"RTN","TIUPRPN3",161,0)
 W !?5,"FOOTER has the patient's phone number and is clearly marked:"
"RTN","TIUPRPN3",162,0)
 W !?5,"'NOT FOR MEDICAL RECORD'.  Unless you really intend to file the"
"RTN","TIUPRPN3",163,0)
 W !?5,"note(s) in the chart- print a WORK copy."
"RTN","TIUPRPN3",164,0)
 Q
"RTN","TIUPRPN3",165,0)
HELP1 ; answers the 'ea note on a new page' question
"RTN","TIUPRPN3",166,0)
 W !!?5,"The option selected will produce CHARTABLE contiguous notes."
"RTN","TIUPRPN3",167,0)
 W !?5,"If you are filling in a chart that has handwritten notes, or,"
"RTN","TIUPRPN3",168,0)
 W !?5,"you'd prefer to begin each note on a new page; answer 'YES'."
"RTN","TIUPRPN3",169,0)
 Q
"RTN","TIUPRPN4")
0^69^B10745385
"RTN","TIUPRPN4",1,0)
TIUPRPN4 ;SLC/MJC;Print Progress Notes for Inpt Location; 1/22/01
"RTN","TIUPRPN4",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**25,100**;Jun 20, 1997
"RTN","TIUPRPN4",3,0)
 ;
"RTN","TIUPRPN4",4,0)
LOC ;sorts PNs for prting by WARD location
"RTN","TIUPRPN4",5,0)
 ;this option is for inpts
"RTN","TIUPRPN4",6,0)
 ;it prts all PNs for a selected date range for all patients
"RTN","TIUPRPN4",7,0)
 ;currently on the WARD
"RTN","TIUPRPN4",8,0)
 ;these notes are chartable contiguous or separate
"RTN","TIUPRPN4",9,0)
 ;[TIU PRINT PN WARD]
"RTN","TIUPRPN4",10,0)
 ;
"RTN","TIUPRPN4",11,0)
 N DIC,Y,TIUQT,TIULOC,WARD
"RTN","TIUPRPN4",12,0)
 D SETUP^TIUPRPN3("Print Progress Notes for ALL patients on WARD")
"RTN","TIUPRPN4",13,0)
DIC F  D  Q:$D(TIUQT)
"RTN","TIUPRPN4",14,0)
 .S DIC=8925.93,DIC(0)="AEQMNZ",DIC("A")="Select WARD Location: "
"RTN","TIUPRPN4",15,0)
 .S DIC("S")="I $P($G(^SC(+$P($G(^TIU(8925.93,+Y,0)),U),0)),U,3)=""W"""
"RTN","TIUPRPN4",16,0)
 .W ! D ^DIC K DIC I Y<0 S TIUQT=1 Q
"RTN","TIUPRPN4",17,0)
 .S WARD=Y(0,0)
"RTN","TIUPRPN4",18,0)
 .I '+$O(^DIC(42,"B",WARD,0)) D
"RTN","TIUPRPN4",19,0)
 ..S WARD=$P($G(^DIC(42,+$G(^SC(+$P(Y,U,2),42)),0)),U)
"RTN","TIUPRPN4",20,0)
 .I '+$O(^DIC(42,"B",WARD,0)) D  Q
"RTN","TIUPRPN4",21,0)
 ..S TIUQT=1
"RTN","TIUPRPN4",22,0)
 ..W !!,"Invalid WARD LOCATION...Contact IRM."
"RTN","TIUPRPN4",23,0)
 .S TIULOC=+Y(0)_U_+Y_U_Y(0,0)
"RTN","TIUPRPN4",24,0)
 .;ien hosp loc^ien tiu prt param^external ward loc
"RTN","TIUPRPN4",25,0)
 .D NOTES(TIULOC)
"RTN","TIUPRPN4",26,0)
 Q
"RTN","TIUPRPN4",27,0)
 ;
"RTN","TIUPRPN4",28,0)
NOTES(TIULOC) ;sets date/time of when notes prted
"RTN","TIUPRPN4",29,0)
 N Y,BEG,MOVE,BED,DATE,CTR,TIULAST,ANS,IFN,TIUSPG,DFN,TIUQT
"RTN","TIUPRPN4",30,0)
 N RPARRAY
"RTN","TIUPRPN4",31,0)
 S TIULAST=$P($G(^TIU(8925.93,+$P(TIULOC,U,2),1)),U,2)
"RTN","TIUPRPN4",32,0)
 I TIULAST']"" S BEG=$$DATE() Q:BEG']""
"RTN","TIUPRPN4",33,0)
 I TIULAST]"" D  Q:$D(TIUQT)
"RTN","TIUPRPN4",34,0)
 .I '+$G(TIULAST) D 2^TIUPRPN5 S BEG=$$DATE() I BEG']"" S TIUQT=1 Q
"RTN","TIUPRPN4",35,0)
 .W !!,"Notes were last printed for "_WARD_" at "
"RTN","TIUPRPN4",36,0)
 .W $$FMTE^XLFDT(+TIULAST,"1P"),!
"RTN","TIUPRPN4",37,0)
 .S ANS=$$READ^TIUU("YA","Print from this DATE/TIME on? ","YES","^D HELP^TIUPRPN5")
"RTN","TIUPRPN4",38,0)
 .I $D(DIRUT) S TIUQT=1 Q
"RTN","TIUPRPN4",39,0)
 .I +$G(ANS) S BEG=+TIULAST Q
"RTN","TIUPRPN4",40,0)
 .D 3^TIUPRPN5 S BEG=$$DATE() I BEG']"" S TIUQT=1 Q
"RTN","TIUPRPN4",41,0)
 S TIULAST=BEG
"RTN","TIUPRPN4",42,0)
 S MOVE=0 F  S MOVE=$O(^DGPM("CN",WARD,MOVE)) Q:'MOVE  D
"RTN","TIUPRPN4",43,0)
 .Q:'$D(^DGPM(MOVE,0))
"RTN","TIUPRPN4",44,0)
 .S DFN=$P(^DGPM(MOVE,0),U,3)
"RTN","TIUPRPN4",45,0)
 .S BEG=$E(TIULAST,1,12)-.0001 ;back up one minute
"RTN","TIUPRPN4",46,0)
 .F  S BEG=$O(^TIU(8925,"APTP",DFN,BEG)) Q:'BEG  D
"RTN","TIUPRPN4",47,0)
 ..S IFN=0 F  S IFN=$O(^TIU(8925,"APTP",DFN,BEG,IFN)) Q:'IFN  D
"RTN","TIUPRPN4",48,0)
 ...W "." D REPLACE^TIUPRPN3(IFN,.RPARRAY,BEG,1501)
"RTN","TIUPRPN4",49,0)
 S IFN=0 F  S IFN=$O(RPARRAY(IFN)) Q:'IFN  D
"RTN","TIUPRPN4",50,0)
 .S DFN=$P(^TIU(8925,IFN,0),U,2),BED=$G(^DPT(DFN,.101))_" "
"RTN","TIUPRPN4",51,0)
 .S BEG=RPARRAY(IFN,"DT")
"RTN","TIUPRPN4",52,0)
 .S ^TMP("TIUPR",$J,BED_";"_DFN,BEG,IFN)="Vice SF 509"
"RTN","TIUPRPN4",53,0)
 S CTR=+$G(RPARRAY)
"RTN","TIUPRPN4",54,0)
 I CTR=0 W $C(7),!!,"No notes have been signed for "_WARD_" since "
"RTN","TIUPRPN4",55,0)
 I  W $$FMTE^XLFDT(TIULAST,"1P") Q
"RTN","TIUPRPN4",56,0)
 W !,">> "_CTR_" note"_$S(CTR>1:"s",1:"")_" found for WARD "_WARD
"RTN","TIUPRPN4",57,0)
 S TIUSPG=1,TIULAST=$$NOW^XLFDT
"RTN","TIUPRPN4",58,0)
 D DEV^TIUPRPN5
"RTN","TIUPRPN4",59,0)
 Q
"RTN","TIUPRPN4",60,0)
DATE() W ! S %DT="AESTPX",%DT(0)="-NOW"
"RTN","TIUPRPN4",61,0)
 S %DT("A")="Print Notes Starting With (DATE/TIME): "
"RTN","TIUPRPN4",62,0)
 D ^%DT K %DT
"RTN","TIUPRPN4",63,0)
 S BEG=$S($D(DTOUT):"",Y<0:"",1:Y)
"RTN","TIUPRPN4",64,0)
 Q BEG
"RTN","TIUPRPN4",65,0)
 ;
"RTN","TIUPRPN4",66,0)
ADD ; enter/edit locations in file 8925.93
"RTN","TIUPRPN4",67,0)
 N DA,DIC,DIE,DR,TIUQT,Y
"RTN","TIUPRPN4",68,0)
 F  W ! D  Q:$D(TIUQT)
"RTN","TIUPRPN4",69,0)
 .S (DIC,DLAYGO)=8925.93,DIC(0)="AEQMNL"
"RTN","TIUPRPN4",70,0)
 .S DIC("A")="Select Clinic or Ward: "
"RTN","TIUPRPN4",71,0)
 .D ^DIC I Y<0 S TIUQT=1 Q
"RTN","TIUPRPN4",72,0)
 .S DIE=DIC,DA=+Y,DR="1.03;3" D ^DIE
"RTN","TIUPRPN4",73,0)
 K DLAYGO
"RTN","TIUPRPN4",74,0)
 Q
"RTN","TIUPRPN4",75,0)
 ;
"RTN","TIUPRPN4",76,0)
DIV ; enter/edit division params in file 8925.94
"RTN","TIUPRPN4",77,0)
 N DA,DIC,DIE,DR,TIUQT,Y
"RTN","TIUPRPN4",78,0)
 F  W ! D  Q:$D(TIUQT)
"RTN","TIUPRPN4",79,0)
 .S (DIC,DLAYGO)=8925.94,DIC(0)="AEQMNL"
"RTN","TIUPRPN4",80,0)
 .S DIC("A")="Select Division for PNs Outpatient Batch Print: "
"RTN","TIUPRPN4",81,0)
 .D ^DIC I Y<0 S TIUQT=1 Q
"RTN","TIUPRPN4",82,0)
 .S DIE=DIC,DA=+Y,DR=".02;1.02" D ^DIE
"RTN","TIUPRPN4",83,0)
 K DLAYGO
"RTN","TIUPRPN4",84,0)
 Q
"RTN","TIUPRPN5")
0^70^B22720274
"RTN","TIUPRPN5",1,0)
TIUPRPN5 ;SLC/MJC-Sort PNs for Prting by Location;25-JAN-2001 08:16:52 ;25-JAN-2001 08:52:30
"RTN","TIUPRPN5",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUPRPN5",3,0)
 ;
"RTN","TIUPRPN5",4,0)
LOC ;sorts PNs for prting by CLINIC location
"RTN","TIUPRPN5",5,0)
 ;these notes are chartable contiguous or separate
"RTN","TIUPRPN5",6,0)
 ;this option is screened to exclude WARDs 
"RTN","TIUPRPN5",7,0)
 ;sites should use the [TIU PRINT PN WARD] option which sorts
"RTN","TIUPRPN5",8,0)
 ;by BED NUMBER for current inpts on that ward for INPT notes
"RTN","TIUPRPN5",9,0)
 ;[TIU PRINT PN OUTPT LOC]
"RTN","TIUPRPN5",10,0)
 ;
"RTN","TIUPRPN5",11,0)
 N DIC,Y,TIUQT,TIULOC
"RTN","TIUPRPN5",12,0)
 D SETUP^TIUPRPN3("Print Progress Notes for OUTPATIENT LOCATION")
"RTN","TIUPRPN5",13,0)
DIC F  D  Q:$D(TIUQT)
"RTN","TIUPRPN5",14,0)
 .S DIC=8925.93,DIC(0)="AEQMNZ",DIC("A")="Select OUTPATIENT location: "
"RTN","TIUPRPN5",15,0)
 .S DIC("S")="I $P($G(^SC(+$P($G(^TIU(8925.93,+Y,0)),U),0)),U,3)'=""W"""
"RTN","TIUPRPN5",16,0)
 .W ! D ^DIC K DIC("S") I Y<0 S TIUQT=1 Q
"RTN","TIUPRPN5",17,0)
 .S TIULOC=+Y(0)_U_+Y_U_Y(0,0)
"RTN","TIUPRPN5",18,0)
 .I '$D(^TIU(8925,"ALOCP",+TIULOC)) D  Q
"RTN","TIUPRPN5",19,0)
 ..W !,$C(7),"There are no signed Progress Notes for this location!!"
"RTN","TIUPRPN5",20,0)
 .D NOTES(TIULOC)
"RTN","TIUPRPN5",21,0)
 Q
"RTN","TIUPRPN5",22,0)
 ;
"RTN","TIUPRPN5",23,0)
NOTES(TIULOC) ;returns date/time;ien of last note prted
"RTN","TIUPRPN5",24,0)
 N OLD,NEW,Y,BEG,IFN,TIUSPG,CTR,TIULAST,ANS,MSG,TIUQT,DFN,SORT
"RTN","TIUPRPN5",25,0)
 N RPARRAY
"RTN","TIUPRPN5",26,0)
 S MSG=1,TIULAST=$P($G(^TIU(8925.93,+$P(TIULOC,U,2),1)),U,2)
"RTN","TIUPRPN5",27,0)
 I TIULAST]"" D  Q:$D(TIUQT)
"RTN","TIUPRPN5",28,0)
 .I '+$G(TIULAST)!'$P(TIULAST,";",2)!('$D(^TIU(8925,"ALOCP",+TIULOC,+TIULAST,+$P(TIULAST,";",2)))) S $P(^TIU(8925.93,+$P(TIULOC,U,2),1),U,2)="",MSG=2 Q
"RTN","TIUPRPN5",29,0)
 .S BEG=+TIULAST
"RTN","TIUPRPN5",30,0)
 .W !!,"The last note printed for this location using this option was "
"RTN","TIUPRPN5",31,0)
 .W !,"signed ",$$FMTE^XLFDT(BEG,"1P"),!!
"RTN","TIUPRPN5",32,0)
 .S ANS=$$READ^TIUU("YA","Print from this point on? ","YES","^D HELP^TIUPRPN5")
"RTN","TIUPRPN5",33,0)
 .I $D(DIRUT) S TIUQT=1 Q
"RTN","TIUPRPN5",34,0)
 .I +$G(ANS) S IFN=$P(TIULAST,U,2) Q
"RTN","TIUPRPN5",35,0)
 .S $P(^TIU(8925.93,+$P(TIULOC,U,2),1),U,2)="",MSG=3
"RTN","TIUPRPN5",36,0)
 I $P($G(^TIU(8925.93,+$P(TIULOC,U,2),1)),U,2)']"" D  Q:$D(TIUQT)
"RTN","TIUPRPN5",37,0)
 .D @MSG ;writes message to explain date selection
"RTN","TIUPRPN5",38,0)
RANGE .S OLD=$O(^TIU(8925,"ALOCP",+TIULOC,0))
"RTN","TIUPRPN5",39,0)
 .S NEW=$O(^TIU(8925,"ALOCP",+TIULOC,9999999),-1)
"RTN","TIUPRPN5",40,0)
 .W !,"     The OLDEST note was signed: ",$$FMTE^XLFDT(OLD,"1P")
"RTN","TIUPRPN5",41,0)
 .W !,"The MOST RECENT note was signed: ",$$FMTE^XLFDT(NEW,"1P"),!
"RTN","TIUPRPN5",42,0)
 .W !,"Select a date and I will print all signed notes for "
"RTN","TIUPRPN5",43,0)
 .W !,$P(TIULOC,U,3)," from this date until NOW.",!
"RTN","TIUPRPN5",44,0)
DATE .S %DT="AEPX",%DT(0)="-NOW",%DT("A")="Print Notes Beginning: "
"RTN","TIUPRPN5",45,0)
 .D ^%DT K %DT I $D(DTOUT)!(Y<0) S TIUQT=1 Q
"RTN","TIUPRPN5",46,0)
 .I Y>NEW W $C(7),!?5,"Pick a date between the OLDEST and the MOST "
"RTN","TIUPRPN5",47,0)
 .I  W "RECENT." G DATE
"RTN","TIUPRPN5",48,0)
 .S BEG=Y
"RTN","TIUPRPN5",49,0)
 S CTR=0 F  S BEG=$O(^TIU(8925,"ALOCP",+TIULOC,BEG)) Q:'BEG  D
"RTN","TIUPRPN5",50,0)
 .I '$D(IFN) S IFN=0
"RTN","TIUPRPN5",51,0)
 .F  S IFN=$O(^TIU(8925,"ALOCP",+TIULOC,BEG,IFN)) Q:'IFN  D
"RTN","TIUPRPN5",52,0)
 ..W "." D REPLACE^TIUPRPN3(IFN,.RPARRAY,BEG,1501)
"RTN","TIUPRPN5",53,0)
 S IFN=0 F  S IFN=$O(RPARRAY(IFN)) Q:'IFN  D
"RTN","TIUPRPN5",54,0)
 .S DFN=$P(^TIU(8925,IFN,0),U,2),SORT=$P(^DPT(DFN,0),U)_";"_DFN
"RTN","TIUPRPN5",55,0)
 .S BEG=RPARRAY(IFN,"DT")
"RTN","TIUPRPN5",56,0)
 .S ^TMP("TIUPR",$J,SORT,BEG,IFN)="Vice SF 509"
"RTN","TIUPRPN5",57,0)
 .S TIULAST=BEG_";"_IFN
"RTN","TIUPRPN5",58,0)
 S CTR=+$G(RPARRAY)
"RTN","TIUPRPN5",59,0)
 I CTR=0 W $C(7),!!,"No notes have been signed for this location since "
"RTN","TIUPRPN5",60,0)
 I  W $$FMTE^XLFDT(+TIULAST,"1P") Q
"RTN","TIUPRPN5",61,0)
 W !,">> "_CTR_" note"_$S(CTR>1:"s",1:"")_" found for "_$P(TIULOC,U,3)
"RTN","TIUPRPN5",62,0)
 I CTR'>1 S TIUSPG=1
"RTN","TIUPRPN5",63,0)
 E  S TIUSPG=$$PAGE^TIUPRPN3 Q:TIUSPG']""  S TIUSPG=$S(+$G(TIUSPG):0,1:1)
"RTN","TIUPRPN5",64,0)
DEV S %ZIS("B")=$P($G(^%ZIS(1,+$P($G(^TIU(8925.93,$P(TIULOC,U,2),1)),U,3),0),""),U) ;brings up default prter from param file
"RTN","TIUPRPN5",65,0)
 W ! S %ZIS="Q" D ^%ZIS I POP K POP G EXIT
"RTN","TIUPRPN5",66,0)
 I $E(IOST)="C" W $C(7),$C(7),!?5,"You must select a "
"RTN","TIUPRPN5",67,0)
 I  W "printer for this option!!" G DEV
"RTN","TIUPRPN5",68,0)
 S $P(^TIU(8925.93,$P(TIULOC,U,2),0),U,4)=""
"RTN","TIUPRPN5",69,0)
 I $D(IO("Q")) K IO("Q") D  G EXIT
"RTN","TIUPRPN5",70,0)
 .S ZTRTN="PRINT^TIUPRPN5",ZTSAVE("^TMP(""TIUPR"",$J,")=""
"RTN","TIUPRPN5",71,0)
 .S ZTSAVE("TIUSPG")="",ZTSAVE("TIULAST")="",ZTSAVE("TIULOC")=""
"RTN","TIUPRPN5",72,0)
 .S ZTDESC="TIU PRT PNS BY LOCATION"
"RTN","TIUPRPN5",73,0)
 .D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Canceled!")
"RTN","TIUPRPN5",74,0)
 .K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,%ZIS,TIULAST,TIUSPG,TIULOC
"RTN","TIUPRPN5",75,0)
 .D HOME^%ZIS
"RTN","TIUPRPN5",76,0)
 U IO D PRINT,^%ZISC
"RTN","TIUPRPN5",77,0)
 Q
"RTN","TIUPRPN5",78,0)
PRINT ;
"RTN","TIUPRPN5",79,0)
 K ^TMP("TIULQ",$J)
"RTN","TIUPRPN5",80,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","TIUPRPN5",81,0)
 D PRINT^TIUPRPN1(1,$G(TIUSPG))
"RTN","TIUPRPN5",82,0)
 S $P(^TIU(8925.93,$P(TIULOC,U,2),1),U,2)=TIULAST
"RTN","TIUPRPN5",83,0)
EXIT K ^TMP("TIULQ",$J),^TMP("TIUPR",$J)
"RTN","TIUPRPN5",84,0)
 Q
"RTN","TIUPRPN5",85,0)
 ;
"RTN","TIUPRPN5",86,0)
1 W !!,"I don't seem to have any record of you having used this option "
"RTN","TIUPRPN5",87,0)
 W !,"to print progress notes for this location.",!
"RTN","TIUPRPN5",88,0)
 Q
"RTN","TIUPRPN5",89,0)
2 W !!,"I could not determine what the last note printed for this "
"RTN","TIUPRPN5",90,0)
 W !,"location was."
"RTN","TIUPRPN5",91,0)
 W !!,"Please select a date and all notes from that date to NOW will be"
"RTN","TIUPRPN5",92,0)
 W !,"printed.  The last note printed will become the new base date.",!
"RTN","TIUPRPN5",93,0)
 Q
"RTN","TIUPRPN5",94,0)
3 W !!,"OK- then select a different date.",!
"RTN","TIUPRPN5",95,0)
 Q
"RTN","TIUPRPN5",96,0)
HELP ; help for continue from this point prompt
"RTN","TIUPRPN5",97,0)
 W !!,"Every note that has been signed since this date (last time this"
"RTN","TIUPRPN5",98,0)
 W !,"notes were printed using this option) until NOW will be printed."
"RTN","TIUPRPN5",99,0)
 Q
"RTN","TIUPRPN6")
0^71^B10034142
"RTN","TIUPRPN6",1,0)
TIUPRPN6 ;SLC/MJC-Print PNs-Most Current Admission ; 1/22/01
"RTN","TIUPRPN6",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUPRPN6",3,0)
 ;
"RTN","TIUPRPN6",4,0)
ADM ;prints PNs for LAST admission to either date of discharge or NOW
"RTN","TIUPRPN6",5,0)
 ;this sort is chartable for either contiguous or separate
"RTN","TIUPRPN6",6,0)
 ;also supports WORK copy
"RTN","TIUPRPN6",7,0)
 ;TIU PRINT PN ADMISSION]
"RTN","TIUPRPN6",8,0)
 ;
"RTN","TIUPRPN6",9,0)
 N TIUDFN,TIUQT,DIC,Y
"RTN","TIUPRPN6",10,0)
 D SETUP^TIUPRPN3("Print Progress Notes for selected patient's LAST admission")
"RTN","TIUPRPN6",11,0)
 F  W ! S DIC=2,DIC(0)="AEQMN" D ^DIC Q:Y<0  D  K TIUQT
"RTN","TIUPRPN6",12,0)
 .I '$O(^TIU(8925,"APTP",+Y,0)) W !!?5,$C(7),"There are no signed "
"RTN","TIUPRPN6",13,0)
 .I  W "progress notes on file for this patient.",! Q
"RTN","TIUPRPN6",14,0)
 .N TIUFLAG,TIUSPG
"RTN","TIUPRPN6",15,0)
 .S TIUDFN=Y
"RTN","TIUPRPN6",16,0)
 .D NOTES(TIUDFN) Q:$D(TIUQT)
"RTN","TIUPRPN6",17,0)
 .S TIUFLAG=$$FLAG^TIUPRPN3() Q:TIUFLAG']""
"RTN","TIUPRPN6",18,0)
 .S TIUSPG=1
"RTN","TIUPRPN6",19,0)
 .D DEVICE^TIUPRPN(TIUFLAG,TIUSPG)
"RTN","TIUPRPN6",20,0)
 Q
"RTN","TIUPRPN6",21,0)
 ;
"RTN","TIUPRPN6",22,0)
NOTES(TIUDFN) ;get the notes for the admission
"RTN","TIUPRPN6",23,0)
 N VAIP,ADMDT,BEG,END,HOLD,CTR,DATE,IFN,DFN,DIR,Y,RPARRAY
"RTN","TIUPRPN6",24,0)
 S DFN=+TIUDFN,VAIP("D")="LAST" D IN5^VADPT
"RTN","TIUPRPN6",25,0)
 I '$G(VAIP(1)) W !!?5,$C(7),"I don't have any record of an admission "
"RTN","TIUPRPN6",26,0)
 I  W "for this patient.",!?5,"Select another patient." S TIUQT=1 Q
"RTN","TIUPRPN6",27,0)
 S ADMDT=VAIP(13,1)
"RTN","TIUPRPN6",28,0)
 W !!,"Patient was admitted:  ",$P(ADMDT,U,2)
"RTN","TIUPRPN6",29,0)
 I $D(VAIP(17,1)) D
"RTN","TIUPRPN6",30,0)
 .W !,"Patient was discharged: ",$P(VAIP(17,1),U,2),!
"RTN","TIUPRPN6",31,0)
 .S DIR("A")="Print all progress notes written during this admission? "
"RTN","TIUPRPN6",32,0)
 E  D
"RTN","TIUPRPN6",33,0)
 .W !!,"Patient has not been DISCHARGED.",!
"RTN","TIUPRPN6",34,0)
 .S DIR("A")="Print all progress notes from admission date until NOW? "
"RTN","TIUPRPN6",35,0)
 S DIR(0)="YA",DIR("B")="YES",DIR("A")=DIR("A")_"(Y/N) "
"RTN","TIUPRPN6",36,0)
 S DIR("?")="^D HELP^TIUPRPN6" D ^DIR
"RTN","TIUPRPN6",37,0)
 I $D(DIRUT) S TIUQT=1 Q
"RTN","TIUPRPN6",38,0)
 I +$G(Y) S BEG=+ADMDT,END=$S($G(VAIP(17,1)):+VAIP(17,1),1:9999999)
"RTN","TIUPRPN6",39,0)
 E  D  K %DT Q:$D(TIUQT)
"RTN","TIUPRPN6",40,0)
 .W ! S %DT="AEPTX",%DT(0)="-NOW",%DT("A")="Print Notes Beginning: "
"RTN","TIUPRPN6",41,0)
 .D ^%DT I $D(DTOUT)!(Y<0) S TIUQT=1 Q
"RTN","TIUPRPN6",42,0)
 .S BEG=Y,%DT("A")="                 Thru: "
"RTN","TIUPRPN6",43,0)
 .S %DT="AEPTX" D ^%DT I $D(DTOUT)!(Y<0) S TIUQT=1 Q
"RTN","TIUPRPN6",44,0)
 .S END=Y I END<BEG S HOLD=BEG,BEG=END,END=HOLD
"RTN","TIUPRPN6",45,0)
 ;load up the notes
"RTN","TIUPRPN6",46,0)
 W !!,"Searching for the notes "
"RTN","TIUPRPN6",47,0)
 K ^TMP("TIUPR",$J)
"RTN","TIUPRPN6",48,0)
 S DATE=BEG
"RTN","TIUPRPN6",49,0)
 F  S DATE=$O(^TIU(8925,"APTP",DFN,DATE)) Q:'DATE!(DATE>END)  D
"RTN","TIUPRPN6",50,0)
 .S IFN=0 F  S IFN=$O(^TIU(8925,"APTP",DFN,DATE,IFN)) Q:'IFN  D
"RTN","TIUPRPN6",51,0)
 ..W "." D REPLACE^TIUPRPN3(IFN,.RPARRAY,DATE,1501)
"RTN","TIUPRPN6",52,0)
 S IFN=0 F  S IFN=$O(RPARRAY(IFN)) Q:'IFN  D
"RTN","TIUPRPN6",53,0)
 .S DATE=RPARRAY(IFN,"DT")
"RTN","TIUPRPN6",54,0)
 .S ^TMP("TIUPR",$J,$P(TIUDFN,U,2)_";"_DFN,DATE,IFN)="Vice SF 509"
"RTN","TIUPRPN6",55,0)
 S CTR=+$G(RPARRAY)
"RTN","TIUPRPN6",56,0)
 I '$D(^TMP("TIUPR",$J)) W !!,"No SIGNED notes found in this date "
"RTN","TIUPRPN6",57,0)
 I  W "range for this patient." S TIUQT=1 Q
"RTN","TIUPRPN6",58,0)
 W !!,">> "_CTR_" note"_$S(CTR>1:"s",1:"")_" found.",!
"RTN","TIUPRPN6",59,0)
 Q
"RTN","TIUPRPN6",60,0)
HELP ;help for yes/no print all notes for admission question
"RTN","TIUPRPN6",61,0)
 W !!?5,"Answer YES and all the progress notes for this admission will "
"RTN","TIUPRPN6",62,0)
 W !?5,"be printed in CONTIGUOUS format."
"RTN","TIUPRPN6",63,0)
 W !!?5,"Answer NO and you will be asked to select a date range for "
"RTN","TIUPRPN6",64,0)
 W !?5,"this patient."
"RTN","TIUPRPN6",65,0)
 Q
"RTN","TIUPRPN7")
0^72^B28321769
"RTN","TIUPRPN7",1,0)
TIUPRPN7 ;SLC/MJC - Progress Notes Outpt Batch Prt ;1/22/01
"RTN","TIUPRPN7",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**45,100**;Jun 20, 1997
"RTN","TIUPRPN7",3,0)
 ;
"RTN","TIUPRPN7",4,0)
BATCH ;batch print outpatient progress notes sorted by terminal digit
"RTN","TIUPRPN7",5,0)
 ;if you wish to exlude a particular hospital location from this
"RTN","TIUPRPN7",6,0)
 ;print option that can be specified in the
"RTN","TIUPRPN7",7,0)
 ;EXCLUDE FROM BATCH PRINTING field of file 8925.93
"RTN","TIUPRPN7",8,0)
 ;[TIU PRINT PN BATCH INTERACTIVE]
"RTN","TIUPRPN7",9,0)
 ;
"RTN","TIUPRPN7",10,0)
 N Y,TIUQT,TIUSTART,TIUDIV,ANS,LAST,DIV
"RTN","TIUPRPN7",11,0)
 D SETUP^TIUPRPN3("Batch Print Outpatient Progress Notes by Terminal Digit")
"RTN","TIUPRPN7",12,0)
 W !!?5,"Notes will be printed in terminal digit order."
"RTN","TIUPRPN7",13,0)
 W !!?5,"This option may also be scheduled to run non-interactively"
"RTN","TIUPRPN7",14,0)
 W !?5,"in file #19.2 OPTION SCHEDULING FILE.",!!
"RTN","TIUPRPN7",15,0)
 ;
"RTN","TIUPRPN7",16,0)
 I $D(^TIU(8925.94,0))'=1 W $C(7),$C(7),!?5,"Before using this option "
"RTN","TIUPRPN7",17,0)
 I  W "you must enter the divisions for your site in"
"RTN","TIUPRPN7",18,0)
 I  W !?5,"file #8925.94 - TIU DIVISION PRINT PARAMETERS FILE." Q
"RTN","TIUPRPN7",19,0)
 ;
"RTN","TIUPRPN7",20,0)
 S DIC=8925.94,DIC(0)="AEQMNZ",DIC("A")="Select DIVISION: "
"RTN","TIUPRPN7",21,0)
 S DIC("B")=$P($G(^DG(40.8,+$G(^DISV(DUZ,"^TIU(8925.94,")),0),""),U)
"RTN","TIUPRPN7",22,0)
 D ^DIC K DIC Q:Y<0
"RTN","TIUPRPN7",23,0)
 S TIUDIV=+Y(0)_U_+Y_U_Y(0,0)
"RTN","TIUPRPN7",24,0)
 ;ien medical center div^ien tiu param^external division
"RTN","TIUPRPN7",25,0)
 S LAST=$P($G(^TIU(8925.94,+$P(TIUDIV,U,2),1)),U)
"RTN","TIUPRPN7",26,0)
 I LAST']"" S TIUSTART=$$DATE^TIUPRPN4() Q:TIUSTART']""
"RTN","TIUPRPN7",27,0)
 I LAST]"" D  Q:$D(TIUQT)
"RTN","TIUPRPN7",28,0)
 .W !!,"Notes were last printed for '"_$P(TIUDIV,U,3)_"' "
"RTN","TIUPRPN7",29,0)
 .W $$FMTE^XLFDT(LAST,"1P"),!
"RTN","TIUPRPN7",30,0)
 .S ANS=$$READ^TIUU("YA","Print from this DATE/TIME on? ","YES","D HELP^TIUPRPN5")
"RTN","TIUPRPN7",31,0)
 .I $D(DIRUT) S TIUQT=1 Q
"RTN","TIUPRPN7",32,0)
 .I +$G(ANS) S TIUSTART=LAST Q
"RTN","TIUPRPN7",33,0)
 .D 3^TIUPRPN5 S TIUSTART=$$DATE^TIUPRPN4() I TIUSTART']"" S TIUQT=1 Q
"RTN","TIUPRPN7",34,0)
DEV S %ZIS("B")=$P($G(^%ZIS(1,+$P($G(^TIU(8925.94,$P(TIUDIV,U,2),1)),U,2),0),""),U) ;brings up default prter from 8925.94 param file
"RTN","TIUPRPN7",35,0)
 W ! S %ZIS="Q" D ^%ZIS I POP K POP G EXIT
"RTN","TIUPRPN7",36,0)
 I $E(IOST)="C" W $C(7),$C(7),!?5,"You must select a printer for this "
"RTN","TIUPRPN7",37,0)
 I  W "option!!" G DEV
"RTN","TIUPRPN7",38,0)
 S TIUDIV=+$P(TIUDIV,U,2)
"RTN","TIUPRPN7",39,0)
 I $D(IO("Q")) K IO("Q") D  G EXIT
"RTN","TIUPRPN7",40,0)
 .S ZTRTN="PRINT^TIUPRPN7",ZTSAVE("TIUSTART")="",ZTSAVE("TIUDIV")=""
"RTN","TIUPRPN7",41,0)
 .S ZTDESC="TIU BATCH PRT PNS OUTPT DIV"
"RTN","TIUPRPN7",42,0)
 .D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Canceled!")
"RTN","TIUPRPN7",43,0)
 .K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,STSAVE,%ZIS,TIUSTART,TIUDIV
"RTN","TIUPRPN7",44,0)
 .D HOME^%ZIS
"RTN","TIUPRPN7",45,0)
 U IO D PRINT,^%ZISC
"RTN","TIUPRPN7",46,0)
 Q
"RTN","TIUPRPN7",47,0)
PRINT ;entry point for non-interactive tasked job
"RTN","TIUPRPN7",48,0)
 ;requires TIUDIV set to the division you want notes for
"RTN","TIUPRPN7",49,0)
 ;if queued non-interactively, file 8925.94- field #1.02 will need 
"RTN","TIUPRPN7",50,0)
 ;to contain the start time of the batch
"RTN","TIUPRPN7",51,0)
 ;[TIU PRINT PN BATCH SCHEDULED]- entry point if called from file #19.2
"RTN","TIUPRPN7",52,0)
 ;
"RTN","TIUPRPN7",53,0)
 I '$D(TIUDIV) D TROUBLE G EXIT
"RTN","TIUPRPN7",54,0)
 N DATE,LOC,IFN,SSN,DFN,STOP,DIV,RPARRAY
"RTN","TIUPRPN7",55,0)
 K ^TMP("TIUPR",$J),^TMP("TIULQ",$J)
"RTN","TIUPRPN7",56,0)
 S STOP=$$NOW^XLFDT
"RTN","TIUPRPN7",57,0)
 I '$D(TIUSTART) S TIUSTART=$P($G(^TIU(8925.94,TIUDIV,1)),U)
"RTN","TIUPRPN7",58,0)
 Q:TIUSTART']""  ;date not passed/no date in field 1.01 file #8925.94
"RTN","TIUPRPN7",59,0)
 S DIV=+$P($G(^TIU(8925.94,TIUDIV,0)),U)
"RTN","TIUPRPN7",60,0)
 S LOC=0
"RTN","TIUPRPN7",61,0)
 F  S LOC=$O(^TIU(8925,"ALOCP",LOC)) Q:'LOC  D
"RTN","TIUPRPN7",62,0)
 .Q:+$$LOC(LOC,DIV)  S DATE=TIUSTART
"RTN","TIUPRPN7",63,0)
 .F  S DATE=$O(^TIU(8925,"ALOCP",LOC,DATE)) Q:'DATE!(DATE>STOP)  D
"RTN","TIUPRPN7",64,0)
 ..S IFN=0 F  S IFN=$O(^TIU(8925,"ALOCP",LOC,DATE,IFN)) Q:'IFN  D
"RTN","TIUPRPN7",65,0)
 ...D REPLACE^TIUPRPN3(IFN,.RPARRAY,DATE,1501)
"RTN","TIUPRPN7",66,0)
 S IFN=0 F  S IFN=$O(RPARRAY(IFN)) Q:'IFN  D
"RTN","TIUPRPN7",67,0)
 .S DFN=$P(^TIU(8925,IFN,0),U,2),SSN=$P(^DPT(DFN,0),U,9)
"RTN","TIUPRPN7",68,0)
 .S SSN=$E(SSN,8,9)_$E(SSN,6,7)_$E(SSN,4,5)_$E(SSN,1,3)
"RTN","TIUPRPN7",69,0)
 .S DATE=RPARRAY(IFN,"DT")
"RTN","TIUPRPN7",70,0)
 .S ^TMP("TIUPR",$J,SSN_";"_DFN,DATE,IFN)="Vice SF 509"
"RTN","TIUPRPN7",71,0)
 I '$D(^TMP("TIUPR",$J)) D TROUBLE G EXIT
"RTN","TIUPRPN7",72,0)
 D PRINT^TIUPRPN1(1,1)
"RTN","TIUPRPN7",73,0)
 S $P(^TIU(8925.94,TIUDIV,1),U)=STOP
"RTN","TIUPRPN7",74,0)
EXIT K ^TIU("TIUPR",$J),^TMP("TIULQ",$J)
"RTN","TIUPRPN7",75,0)
 Q
"RTN","TIUPRPN7",76,0)
LOC(LOC,DIV) ;checks if this location should be batch prted
"RTN","TIUPRPN7",77,0)
 N IEN
"RTN","TIUPRPN7",78,0)
 S IEN=$O(^TIU(8925.93,"B",LOC,0))
"RTN","TIUPRPN7",79,0)
 Q $S($P($G(^SC(LOC,0)),U,3)="W":1,$P($G(^SC(LOC,0)),U,15)'=DIV:1,'$D(^TIU(8925.93,+IEN,0)):"",+$G(^TIU(8925.93,IEN,3)):1,1:"")
"RTN","TIUPRPN7",80,0)
 ;
"RTN","TIUPRPN7",81,0)
TROUBLE ;message to print if no output
"RTN","TIUPRPN7",82,0)
 W !!,"The option [TIU PRINT PN BATCH OUTPT] ran to completion at "
"RTN","TIUPRPN7",83,0)
 W !,$$FMTE^XLFDT($$NOW^XLFDT,"1P")," but did not find any notes."
"RTN","TIUPRPN7",84,0)
 W !!,"If you were expecting notes to print review the following:"
"RTN","TIUPRPN7",85,0)
 ;
"RTN","TIUPRPN7",86,0)
 W !!,"INTERACTIVE"
"RTN","TIUPRPN7",87,0)
 W !,"-----------"
"RTN","TIUPRPN7",88,0)
 W !,"1.  Very little can go wrong- the required criteria is screened"
"RTN","TIUPRPN7",89,0)
 W !,"while the user is manually queueing the job."
"RTN","TIUPRPN7",90,0)
 W !!,"2.  This option prints all the outpatient progress notes, in"
"RTN","TIUPRPN7",91,0)
 W !,"terminal digit order, for the selected date range for ALL CLINICS"
"RTN","TIUPRPN7",92,0)
 W !,"for the selected DIVISION.  Verify that you have signed progress"
"RTN","TIUPRPN7",93,0)
 W !,"notes satisfying this criteria.",!
"RTN","TIUPRPN7",94,0)
 ;
"RTN","TIUPRPN7",95,0)
 W !!,"NON-INTERACTIVE (job set to run in OPTION SCHEDULING FILE (#19.2)"
"RTN","TIUPRPN7",96,0)
 W !,"-----------------------------------------------------------------"
"RTN","TIUPRPN7",97,0)
 W !,"1.  DIVISION must be defined in file #8925.94 (TIU DIVISION PRINT"
"RTN","TIUPRPN7",98,0)
 W !,"PRINT PARAMETERS FILE)."
"RTN","TIUPRPN7",99,0)
 W !!,"2.  The variable TIUDIV must be defined in the VARIABLE NAME "
"RTN","TIUPRPN7",100,0)
 W !,"multiple of the OPTION SCHEDULING FILE (#19.2).  TIUDIV should"
"RTN","TIUPRPN7",101,0)
 W !,"be set to the IEN of an entry in the TIU DIVISION PRINT PARAMETERS"
"RTN","TIUPRPN7",102,0)
 W !,"FILE (#8925.94)."
"RTN","TIUPRPN7",103,0)
 W !!,"3.  This option must find a valid date in field #1.01 of"
"RTN","TIUPRPN7",104,0)
 W !,"file #8925.94 to start looping on.  If a valid date is not "
"RTN","TIUPRPN7",105,0)
 W !,"found, the option will terminate with this message."
"RTN","TIUPRPN7",106,0)
 W !!,"4.  To assist in troubleshooting, if no notes are found, the"
"RTN","TIUPRPN7",107,0)
 W !,"DATE/TIME field (#1.01) of file #8925.94 will not be re-set"
"RTN","TIUPRPN7",108,0)
 W !,"to the new value (which is NOW) when the option begins "
"RTN","TIUPRPN7",109,0)
 W "calculating."
"RTN","TIUPRPN7",110,0)
 Q
"RTN","TIUPRPN8")
0^53^B19590307
"RTN","TIUPRPN8",1,0)
TIUPRPN8 ;SLC/MAM - Print SF 509-Progress Notes, Cont ;1/24/01
"RTN","TIUPRPN8",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUPRPN8",3,0)
 ; 10/00 New rtn, created by moving SIGBLK here from TIUPRPN1
"RTN","TIUPRPN8",4,0)
 ;
"RTN","TIUPRPN8",5,0)
SIGBLK(TIUFOOT,TIUMISC,TIUCONT1,TIUCONT,TIUSIG,TIUROOT) ; Print signature block info
"RTN","TIUPRPN8",6,0)
 ; Requires array TIUFOOT, requires TIUMISC
"RTN","TIUPRPN8",7,0)
 ; Requires TIUCONT1
"RTN","TIUPRPN8",8,0)
 ; Receives TIUCONT by ref (req'd)
"RTN","TIUPRPN8",9,0)
 ; Receives array TIUSIG by ref, required.
"RTN","TIUPRPN8",10,0)
 ; Requires TIUROOT
"RTN","TIUPRPN8",11,0)
 N TIUDA,TIUFLAG
"RTN","TIUPRPN8",12,0)
 S TIUCONT=1,TIUDA=$P(TIUMISC,U,3),TIUFLAG=$P(TIUMISC,U)
"RTN","TIUPRPN8",13,0)
 ;S TIUGROOT=$NA(^TMP("TIULQ",$J,TIUDA))
"RTN","TIUPRPN8",14,0)
 I '+TIUSIG("SIGNDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",15,0)
 . W "**DRAFT COPY - DRAFT COPY -- ABOVE NOTE IS UNSIGNED--"
"RTN","TIUPRPN8",16,0)
 . W " DRAFT COPY - DRAFT COPY**",!
"RTN","TIUPRPN8",17,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN8",18,0)
 I TIUSIG("SIGNEDBY")]"",(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",19,0)
 . W ?21,"Author:      ",$P(TIUSIG("AUTHOR"),";",2),!
"RTN","TIUPRPN8",20,0)
 I +TIUSIG("SIGNDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",21,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",22,0)
 . W ?18,"Signed by:",$S($P(TIUSIG("SIGNMODE"),";")="C":" /s/  ",1:" /es/ "),?34,$S(TIUSIG("SIGNNAME")]"":TIUSIG("SIGNNAME"),1:$P(TIUSIG("SIGNEDBY"),";",2))
"RTN","TIUPRPN8",23,0)
 . W !?34,TIUSIG("SIGTITL")
"RTN","TIUPRPN8",24,0)
 . I $L(TIUSIG("SIGTITL"))>30 W !?34
"RTN","TIUPRPN8",25,0)
 . E  W " "
"RTN","TIUPRPN8",26,0)
 . W $$DATE^TIULS(+TIUSIG("SIGNDATE"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",27,0)
 . I '+$G(TIUFLAG)!($E(IOST)="C") D
"RTN","TIUPRPN8",28,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U) W !?34,"Analog Pager:  ",$P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U)
"RTN","TIUPRPN8",29,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U,2) W !?34,"Digital Pager: ",$P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U,2)
"RTN","TIUPRPN8",30,0)
 I $G(@TIUROOT@(.05,"E"))="UNCOSIGNED" D
"RTN","TIUPRPN8",31,0)
 . W !?34,"**REQUIRES COSIGNATURE**",!
"RTN","TIUPRPN8",32,0)
 I +TIUSIG("SIGCHRT"),$P(TIUSIG("SIGNMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",33,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",34,0)
 . W !?2,"Marked signed on chart by:",?34,$P(TIUSIG("SIGCHRT"),";",2)
"RTN","TIUPRPN8",35,0)
 ;I +$G(TIUADD) S TIUGROOT=$NA(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD))
"RTN","TIUPRPN8",36,0)
 I +$D(@TIUROOT@("EXTRASGNR")) D  Q:'TIUCONT  ;**100** added the quit
"RTN","TIUPRPN8",37,0)
 . N TIUI S TIUI=0
"RTN","TIUPRPN8",38,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",39,0)
 . W !?4,"Receipt Acknowledged By:"
"RTN","TIUPRPN8",40,0)
 . F  S TIUI=$O(@TIUROOT@("EXTRASGNR",TIUI)) Q:'TIUI  D
"RTN","TIUPRPN8",41,0)
 . . I +$G(@TIUROOT@("EXTRASGNR",TIUI,"DATE"))'>0 Q
"RTN","TIUPRPN8",42,0)
 . . I TIUI>1 S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",43,0)
 . . W !?29,"/es/ ",$G(@TIUROOT@("EXTRASGNR",TIUI,"NAME"))
"RTN","TIUPRPN8",44,0)
 . . W !?34,$G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE"))
"RTN","TIUPRPN8",45,0)
 . . I $L($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")))>30 W !?34
"RTN","TIUPRPN8",46,0)
 . . E  W " "
"RTN","TIUPRPN8",47,0)
 . . W $$DATE^TIULS($G(@TIUROOT@("EXTRASGNR",TIUI,"DATE")),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",48,0)
 . . I '+$G(TIUFLAG)!($E(IOST)="C") D
"RTN","TIUPRPN8",49,0)
 . . . N BEEP
"RTN","TIUPRPN8",50,0)
 . . . S BEEP=$$BEEP^TIULC1(+$G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")))
"RTN","TIUPRPN8",51,0)
 . . . I +BEEP W !?34,"Analog Pager:  ",$P(BEEP,U)
"RTN","TIUPRPN8",52,0)
 . . . I +$P(BEEP,U,2) W !?34,"Digital Pager: ",$P(BEEP,U,2)
"RTN","TIUPRPN8",53,0)
 . ;K @TIUROOT@("EXTRASGNR") ;**100** commented out
"RTN","TIUPRPN8",54,0)
 I +TIUSIG("COSGDATE"),(+TIUSIG("COSGEDBY")'=+TIUSIG("SIGNEDBY")) D  Q:'TIUCONT
"RTN","TIUPRPN8",55,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",56,0)
 . W !?16,"Cosigned by:",$S($P(TIUSIG("COSGMODE"),";")="C":" /s/  ",1:" /es/ "),?34,$S(TIUSIG("COSGNAME")]"":TIUSIG("COSGNAME"),1:$P(TIUSIG("COSGEDBY"),";",2))
"RTN","TIUPRPN8",57,0)
 . W !?34,TIUSIG("COSGTITL")," "
"RTN","TIUPRPN8",58,0)
 . W $$DATE^TIULS(+TIUSIG("COSGDATE"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",59,0)
 . I '+$G(TIUFLAG)!($E(IOST)="C") D
"RTN","TIUPRPN8",60,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U) W !?34,"Analog Pager: ",$P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U)
"RTN","TIUPRPN8",61,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U,2) W !?34,"Digital Pager:",$P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U,2)
"RTN","TIUPRPN8",62,0)
 I +TIUSIG("COSCHRT"),$P(TIUSIG("COSGMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",63,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",64,0)
 . W !,"Marked cosigned on chart by:",?34,$P(TIUSIG("COSCHRT"),";",2)
"RTN","TIUPRPN8",65,0)
 W !
"RTN","TIUPRPN8",66,0)
 ;K TIUCONT1 ; kills the cont on next page msgs since no longer in middle
"RTN","TIUPRPN8",67,0)
 ;of a note.  **100** moved down to amend code
"RTN","TIUPRPN8",68,0)
AMEND ; signature blocks of amender
"RTN","TIUPRPN8",69,0)
 ;N TIUY S TIUY=4 ;I don't think we need TIUY anymore **100**
"RTN","TIUPRPN8",70,0)
 I '$G(@TIUROOT@(1601,"I")) K TIUCONT1 Q
"RTN","TIUPRPN8",71,0)
 S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN8",72,0)
 K TIUCONT1 Q:'TIUCONT
"RTN","TIUPRPN8",73,0)
 I +$G(@TIUROOT@(1601,"I")) D
"RTN","TIUPRPN8",74,0)
 . W !!?12,"Amendment Filed:",?34,$$DATE^TIULS(@TIUROOT@(1601,"I"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",75,0)
 . I $G(@TIUROOT@(1603,"E"))']"" D
"RTN","TIUPRPN8",76,0)
 . . W !!?29 F TIUI=1:1:40 W "_"
"RTN","TIUPRPN8",77,0)
 . . W !?29,$$SIGNAME^TIULS(@TIUROOT@(1602,"I"))
"RTN","TIUPRPN8",78,0)
 . . W !?29,$$SIGTITL^TIULS(@TIUROOT@(1602,"I"))
"RTN","TIUPRPN8",79,0)
 . I $G(@TIUROOT@(1604,"E"))]"" D
"RTN","TIUPRPN8",80,0)
 . . W !?29,"/es/",?34,@TIUROOT@(1604,"E")
"RTN","TIUPRPN8",81,0)
 . . W !?34,@TIUROOT@(1605,"E")
"RTN","TIUPRPN8",82,0)
 Q
"RTN","TIUPRPN8",83,0)
 ;
"RTN","TIUPS100")
0^^B758398
"RTN","TIUPS100",1,0)
TIUPS100 ; SLC/JER - Patch 100 Post-init ;29-NOV-2000 09:45:54
"RTN","TIUPS100",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUPS100",3,0)
 ;
"RTN","TIUPS100",4,0)
 ; With special gratitude to "Elvis" for his inspired use of
"RTN","TIUPS100",5,0)
 ; UPDATE^DIE and the letter "I"...
"RTN","TIUPS100",6,0)
 ;
"RTN","TIUPS100",7,0)
RPCS ; Register TIU RPCs that support ID Notes
"RTN","TIUPS100",8,0)
 ; TIU patch 100 registers these in its post-init
"RTN","TIUPS100",9,0)
 N MENU,I
"RTN","TIUPS100",10,0)
 S MENU="OR CPRS GUI CHART"
"RTN","TIUPS100",11,0)
 F I="TIU ID ATTACH ENTRY","TIU ID CAN ATTACH","TIU ID CAN RECEIVE","TIU ID DETACH ENTRY" D INSERT(MENU,I)
"RTN","TIUPS100",12,0)
 Q
"RTN","TIUPS100",13,0)
 ;
"RTN","TIUPS100",14,0)
INSERT(OPTION,RPC) ; Call FM Updater with each RPC
"RTN","TIUPS100",15,0)
 N FDA,FDAIEN,ERR,DIERR
"RTN","TIUPS100",16,0)
 S FDA(19,"?1,",.01)=OPTION
"RTN","TIUPS100",17,0)
 S FDA(19.05,"?+2,?1,",.01)=RPC
"RTN","TIUPS100",18,0)
 D UPDATE^DIE("E","FDA","FDAIEN","ERR")
"RTN","TIUPS100",19,0)
 Q
"RTN","TIUPUTC")
0^40^B28208783
"RTN","TIUPUTC",1,0)
TIUPUTC ; SLC/JER - Document filer - captioned header ;2/7/00
"RTN","TIUPUTC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,21,81,100**;Jun 20, 1997
"RTN","TIUPUTC",3,0)
 ;
"RTN","TIUPUTC",4,0)
MAIN ; ---- Controls branching.
"RTN","TIUPUTC",5,0)
 ;      Attempts to file upload documents in the target file.
"RTN","TIUPUTC",6,0)
 ;      Requires DA = IEN of 8925.2 upload buffer entry.
"RTN","TIUPUTC",7,0)
 N TIUDA,TIUBGN,TIUI,TIUHSIG,TIULIM,TIULCNT,TIULINE,TIUREC,TIUPOST
"RTN","TIUPUTC",8,0)
 N TIUTYPE K ^TMP("TIUPUTC",$J)
"RTN","TIUPUTC",9,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUPUTC",10,0)
 S TIUHSIG=$P(TIUPRM0,U,10),TIUBGN=$P(TIUPRM0,U,12)
"RTN","TIUPUTC",11,0)
 I TIUHSIG']"" D MAIN^TIUPEVNT(DA,1,1) Q
"RTN","TIUPUTC",12,0)
 I TIUBGN']"" D MAIN^TIUPEVNT(DA,1,7) Q
"RTN","TIUPUTC",13,0)
 ; ---- Strip controls when kermit:
"RTN","TIUPUTC",14,0)
 I $P(TIUPRM0,U,17)="k" D PREPROC(DA)
"RTN","TIUPUTC",15,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925.2,+DA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",16,0)
 . S TIULINE=$G(^TIU(8925.2,+DA,"TEXT",TIUI,0))
"RTN","TIUPUTC",17,0)
 . I TIULINE[TIUHSIG D  Q
"RTN","TIUPUTC",18,0)
 . . ; ---- Hdr signal line.  GETREC^TIUPUTC1 resets TIUI to $TXT line:
"RTN","TIUPUTC",19,0)
 . . N TIUHDR,TIUFRST,TIUJ S TIUFRST=TIUI
"RTN","TIUPUTC",20,0)
 . . ; ---- If after first hdr signal, finish previous docmt
"RTN","TIUPUTC",21,0)
 . . ;      before going on w/ current docmt:
"RTN","TIUPUTC",22,0)
 . . I +$G(TIULCNT),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")) D FINISH
"RTN","TIUPUTC",23,0)
 . . K TIUREC D GETREC^TIUPUTC1(TIULINE,.TIUREC,.TIUHDR)
"RTN","TIUPUTC",24,0)
 . . I +$G(TIUREC("#"))'>0!($G(TIUREC("ROOT"))']"") Q
"RTN","TIUPUTC",25,0)
 . . D STUFREC(.TIUHDR,.TIUREC)
"RTN","TIUPUTC",26,0)
 . . S TIUREC("TROOT")=TIUREC("ROOT")_TIUREC("#")_","_TIUREC("TEXT")_","
"RTN","TIUPUTC",27,0)
 . . S:'$D(@(TIUREC("TROOT")_"0)")) @(TIUREC("TROOT")_"0)")="^^^^^"
"RTN","TIUPUTC",28,0)
 . . S TIULCNT=+$P(@(TIUREC("TROOT")_"0)"),U,4)
"RTN","TIUPUTC",29,0)
 . . F TIUJ=TIUFRST:1:TIUI D
"RTN","TIUPUTC",30,0)
 . . . ; ---- Delete header lines from buffer once filed;
"RTN","TIUPUTC",31,0)
 . . . ;      (TIUI was reset in GETREC^TIUPUTC1 to $TXT line):
"RTN","TIUPUTC",32,0)
 . . . K ^TIU(8925.2,+DA,"TEXT",TIUJ,0)
"RTN","TIUPUTC",33,0)
 . . I TIUREC("FILE")=8925,+$G(TIUREC("#")),+$G(TIUREC("BOILON")) D BOILRPLT(.TIUREC)
"RTN","TIUPUTC",34,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),(+$G(TIUREC("FILE"))=8925),+$G(TIUREC("BOILON")) D
"RTN","TIUPUTC",35,0)
 . . I TIULINE]"",$D(^TIU(8925.1,"B",$P(TIULINE,":"))) D  I 1
"RTN","TIUPUTC",36,0)
 . . . S TIULCNT=$$LOCATE(TIULINE,TIUREC("#"))
"RTN","TIUPUTC",37,0)
 . . E  S TIULCNT=+$G(TIULCNT)+.01
"RTN","TIUPUTC",38,0)
 . . S ^TIU(8925,+TIUREC("#"),"TEMP",TIULCNT,0)=TIULINE
"RTN","TIUPUTC",39,0)
 . . ; ---- Delete text line from buffer once xferred:
"RTN","TIUPUTC",40,0)
 . . K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",41,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")),(+$G(TIUREC("BOILON"))'>0) D
"RTN","TIUPUTC",42,0)
 . . S TIULCNT=+$G(TIULCNT)+1,@(TIUREC("TROOT")_TIULCNT_",0)")=TIULINE
"RTN","TIUPUTC",43,0)
 . . ; ---- Delete text line once xferred:
"RTN","TIUPUTC",44,0)
 . . K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",45,0)
 . . ; ---- Remove leading buffer garbage
"RTN","TIUPUTC",46,0)
 . I TIULINE'[TIUHSIG,(TIULINE'[TIUBGN),'$D(TIUREC("TROOT")),($G(TIUREC("#"))'=-1) K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",47,0)
 . I TIULINE[TIUBGN K ^TIU(8925.2,+DA,"TEXT",TIUI,0)
"RTN","TIUPUTC",48,0)
 ; ---- Finish last docmt in buffer file:
"RTN","TIUPUTC",49,0)
 I +$G(TIULCNT),$D(TIUREC("TROOT")),$D(@(TIUREC("TROOT")_"0)")) D FINISH
"RTN","TIUPUTC",50,0)
 I '+$O(^TIU(8925.2,+DA,"TEXT",0)) D BUFPURGE(DA)
"RTN","TIUPUTC",51,0)
 ; ---- Write upload results:
"RTN","TIUPUTC",52,0)
 I '$D(ZTQUEUED),$D(^TMP("TIUPUTC",$J)) D
"RTN","TIUPUTC",53,0)
 . W !!,"TOTALS FOR CURRENT BATCH:",!
"RTN","TIUPUTC",54,0)
 . W !?14,"TOTAL Document(s) RECEIVED: ",$J((+$G(^TMP("TIUPUTC",$J,"SUCC"))+$G(^("MISS"))+$G(^("FAIL"))),5),!
"RTN","TIUPUTC",55,0)
 . W !?18," Document(s) NOT FILED: ",$J(+$G(^TMP("TIUPUTC",$J,"FAIL")),5)
"RTN","TIUPUTC",56,0)
 . W !?3,"Document(s) FILED with MISSING FIELDS: ",$J(+$G(^TMP("TIUPUTC",$J,"MISS")),5),!
"RTN","TIUPUTC",57,0)
 K ^TMP("TIUPUTC",$J)
"RTN","TIUPUTC",58,0)
 Q
"RTN","TIUPUTC",59,0)
LOCATE(LINE,REC) ; ---- Locate line in boilerplate text
"RTN","TIUPUTC",60,0)
 N TIUJ,HIT,BTXT S (TIUJ,HIT)=0
"RTN","TIUPUTC",61,0)
 F  Q:+HIT  S TIUJ=$O(^TIU(8925,+REC,"TEMP",TIUJ)) Q:+TIUJ'>0!HIT  D
"RTN","TIUPUTC",62,0)
 . S BTXT=$G(^TIU(8925,+REC,"TEMP",TIUJ,0))
"RTN","TIUPUTC",63,0)
 . I BTXT[$P(LINE,":")_":" S HIT=1
"RTN","TIUPUTC",64,0)
 Q +$G(TIUJ)
"RTN","TIUPUTC",65,0)
 ;
"RTN","TIUPUTC",66,0)
STUFREC(HEADER,RECORD) ; ---- Stuffs record with known fixed fields;
"RTN","TIUPUTC",67,0)
 ;                      Checks for missing fields.
"RTN","TIUPUTC",68,0)
 N FDA,FDARR,IENS,FLAGS,TIUI,TIUMSG,TIUPC
"RTN","TIUPUTC",69,0)
 S IENS=""""_+RECORD("#")_","""
"RTN","TIUPUTC",70,0)
 S FDARR="FDA("_+RECORD("FILE")_","_IENS_")",FLAGS="KE"
"RTN","TIUPUTC",71,0)
 ; ---- Set up FDA Array:
"RTN","TIUPUTC",72,0)
 S TIUI=0
"RTN","TIUPUTC",73,0)
 F  S TIUI=$O(HEADER(TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",74,0)
 . S:TIUI'=.001 @FDARR@(TIUI)=$$TRNSFRM^TIULX(.RECORD,TIUI,HEADER(TIUI))
"RTN","TIUPUTC",75,0)
 I $D(FDA) D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTC",76,0)
 I $D(TIUMSG) D
"RTN","TIUPUTC",77,0)
 . ; ---- If FILE^DIC fails, log 8925.4 error w/ hdr info.  Create new
"RTN","TIUPUTC",78,0)
 . ;      8925.2 buffer entry with hdr, text, & 8925.4 log #.
"RTN","TIUPUTC",79,0)
 . ;      Kill most of old buffer. Send missing field alerts:
"RTN","TIUPUTC",80,0)
 . D MAIN^TIUPEVNT(DA,2,"",$P($G(^TIU(8925.1,+RECORD("TYPE"),0)),U),.FDA,.TIUMSG)
"RTN","TIUPUTC",81,0)
 . S ^TMP("TIUPUTC",$J,"MISS")=+$G(^TMP("TIUPUTC",$J,"MISS"))+1
"RTN","TIUPUTC",82,0)
 I '$D(TIUMSG) D
"RTN","TIUPUTC",83,0)
 . S ^TMP("TIUPUTC",$J,"SUCC")=+$G(^TMP("TIUPUTC",$J,"SUCC"))+1
"RTN","TIUPUTC",84,0)
 Q
"RTN","TIUPUTC",85,0)
BOILRPLT(TIUREC) ; ---- Execute/Interleave Boilerplates w/uploaded text
"RTN","TIUPUTC",86,0)
 N TIU
"RTN","TIUPUTC",87,0)
 D GETTIU^TIULD(.TIU,TIUREC("#"))
"RTN","TIUPUTC",88,0)
 D LOADDFLT^TIUEDI4(TIUREC("#"),TIUREC("TYPE")) ;100
"RTN","TIUPUTC",89,0)
 Q
"RTN","TIUPUTC",90,0)
SETROOT(LINECNT,RECORD) ; ---- Sets root of WP field
"RTN","TIUPUTC",91,0)
 S @(RECORD("TROOT")_"0)")="^^"_LINECNT_"^"_LINECNT_"^"_DT_"^^"
"RTN","TIUPUTC",92,0)
 Q
"RTN","TIUPUTC",93,0)
BUFPURGE(DA) ; ---- Call ^DIK to purge buffer record when all's well
"RTN","TIUPUTC",94,0)
 N DIK S DIK="^TIU(8925.2," D ^DIK
"RTN","TIUPUTC",95,0)
 Q
"RTN","TIUPUTC",96,0)
PREPROC(DA) ; ---- Strip controls & white space from headers
"RTN","TIUPUTC",97,0)
 N TIUI,TIUHLIN,X S (TIUI,TIUHLIN)=0
"RTN","TIUPUTC",98,0)
 F  S TIUI=$O(^TIU(8925.2,+DA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPUTC",99,0)
 . S X=$G(^TIU(8925.2,+DA,"TEXT",TIUI,0))
"RTN","TIUPUTC",100,0)
 . S:X[TIUHSIG TIUHLIN=1 S:X[TIUBGN TIUHLIN=0
"RTN","TIUPUTC",101,0)
 . S:TIUHLIN ^TIU(8925.2,+DA,"TEXT",TIUI,0)=$$STRIP^TIULS(X)
"RTN","TIUPUTC",102,0)
 Q
"RTN","TIUPUTC",103,0)
DADTYPE(DA) ; ---- Get type of original document for addenda
"RTN","TIUPUTC",104,0)
 N TIUDAD,Y
"RTN","TIUPUTC",105,0)
 S TIUDAD=$P($G(^TIU(8925,DA,0)),U,6)
"RTN","TIUPUTC",106,0)
 S Y=+$G(^TIU(8925,+TIUDAD,0))
"RTN","TIUPUTC",107,0)
 Q Y
"RTN","TIUPUTC",108,0)
 ;
"RTN","TIUPUTC",109,0)
FINISH ; ---- Finish document: feedback, postfile code, merge boil,
"RTN","TIUPUTC",110,0)
 ;      log file event
"RTN","TIUPUTC",111,0)
 N ISADDNDM S ISADDNDM=0
"RTN","TIUPUTC",112,0)
 D SETROOT(TIULCNT,.TIUREC)
"RTN","TIUPUTC",113,0)
 S ISADDNDM=+$$ISADDNDM^TIULC1(TIUREC("#"))
"RTN","TIUPUTC",114,0)
 S TIUTYPE=$S(ISADDNDM:+$$DADTYPE(TIUREC("#")),1:TIUREC("TYPE"))
"RTN","TIUPUTC",115,0)
 I '$D(ZTQUEUED) W !,">>> ",$S(ISADDNDM:"Addendum",1:"Document")," Filed Successfully.",! ;TIU*1*81
"RTN","TIUPUTC",116,0)
 ; ---- TIU*1*81 Tell error handler that retrying filer was successful:
"RTN","TIUPUTC",117,0)
 S TIUDONE=1
"RTN","TIUPUTC",118,0)
 S TIUTYPE=$S(+$$ISADDNDM^TIULC1(TIUREC("#")):+$$DADTYPE(TIUREC("#")),1:TIUREC("TYPE"))
"RTN","TIUPUTC",119,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUTYPE)
"RTN","TIUPUTC",120,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPUTC",121,0)
 I TIUREC("FILE")=8925,+$G(TIUREC("BOILON")) D
"RTN","TIUPUTC",122,0)
 . N TIU D GETTIU^TIULD(.TIU,TIUREC("#"))
"RTN","TIUPUTC",123,0)
 . D MERGTEXT^TIUEDI1(TIUREC("#"),.TIU)
"RTN","TIUPUTC",124,0)
 . K ^TIU(8925,+TIUREC("#"),"TEMP")
"RTN","TIUPUTC",125,0)
 D MAIN^TIUPEVNT(DA,0,"",$P($G(^TIU(8925.1,+TIUREC("TYPE"),0)),U))
"RTN","TIUPUTC",126,0)
 Q
"RTN","TIUPUTC",127,0)
 ;
"RTN","TIUPUTCN")
0^58^B23885954
"RTN","TIUPUTCN",1,0)
TIUPUTCN ; SLC/JER - PN Look-up Method ; 5-MAR-2001 09:20:09
"RTN","TIUPUTCN",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**4,100**;Jun 20, 1997
"RTN","TIUPUTCN",3,0)
LOOKUP ; Look-up code used by router/filer
"RTN","TIUPUTCN",4,0)
 ; Required: TIUSSN, TIUVDT
"RTN","TIUPUTCN",5,0)
 N DA,DFN,TIU,TIUDAD,TIUEDIT,TIUEDT,TIULDT,TIUXCRP,TIUTYPE,TIUNEW
"RTN","TIUPUTCN",6,0)
 I $S('$D(TIUSSN):1,'$D(TIUVDT):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",7,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTCN",8,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",9,0)
 I $G(TIUCNNBR)']"" S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",10,0)
 S TIULOC=+$$ILOC(TIULOC)
"RTN","TIUPUTCN",11,0)
 I '$D(^SC(+$G(TIULOC),0)) S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",12,0)
 S TIUEDT=$$IDATE^TIULC(TIUVDT),TIULDT=$$FMADD^XLFDT(TIUEDT,1)
"RTN","TIUPUTCN",13,0)
 I +TIUEDT'>0 S Y=-1 Q
"RTN","TIUPUTCN",14,0)
 S TIUTYPE=$$WHATITLE(TIUTITLE)
"RTN","TIUPUTCN",15,0)
 I +TIUTYPE'>0 S Y=-1 Q
"RTN","TIUPUTCN",16,0)
 I $P($G(^SC(+TIULOC,0)),U,3)="W" D  I 1
"RTN","TIUPUTCN",17,0)
 . D MAIN^TIUMOVE(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,1,"LAST",0,TIULOC)
"RTN","TIUPUTCN",18,0)
 E  D MAIN^TIUVSIT(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,"LAST",0,TIULOC)
"RTN","TIUPUTCN",19,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",20,0)
 I $P(+$G(TIU("EDT")),".")'=$P($$IDATE^TIULC(TIUVDT),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTCN",21,0)
 S TIUTYP(1)=1_U_TIUTYPE_U_$$PNAME^TIULC1(TIUTYPE)
"RTN","TIUPUTCN",22,0)
 ;S Y=$$GETREC^TIUEDI1(DFN,.TIU,1,.TIUNEW)
"RTN","TIUPUTCN",23,0)
 S Y=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW)
"RTN","TIUPUTCN",24,0)
 I +Y'>0 G LOOKUPX
"RTN","TIUPUTCN",25,0)
 ; If record is not new, has text and can be edited, then replace
"RTN","TIUPUTCN",26,0)
 ; existing text
"RTN","TIUPUTCN",27,0)
 I +$G(TIUNEW)'>0 D
"RTN","TIUPUTCN",28,0)
 . S TIUEDIT=$$CANEDIT(+Y)
"RTN","TIUPUTCN",29,0)
 . I +TIUEDIT>0,$D(^TIU(8925,+Y,"TEXT")) D DELTEXT(+Y)
"RTN","TIUPUTCN",30,0)
 . I +TIUEDIT'>0 S TIUDAD=+Y,Y=$$MAKEADD
"RTN","TIUPUTCN",31,0)
 I +Y'>0 Q
"RTN","TIUPUTCN",32,0)
 D STUFREC(Y,+$G(TIUDAD))
"RTN","TIUPUTCN",33,0)
 I +$G(TIUDAD) D SENDADD^TIUALRT(+Y)
"RTN","TIUPUTCN",34,0)
 K TIUHDR(.01),TIUHDR(.07),TIUHDR(1301)
"RTN","TIUPUTCN",35,0)
LOOKUPX Q
"RTN","TIUPUTCN",36,0)
ILOC(LOCATION) ; Get pointer to file 44
"RTN","TIUPUTCN",37,0)
 N DIC,X,Y
"RTN","TIUPUTCN",38,0)
 S DIC=44,DIC(0)="M",X=LOCATION D ^DIC
"RTN","TIUPUTCN",39,0)
 Q Y
"RTN","TIUPUTCN",40,0)
CANEDIT(DA) ; Check whether or not document is released
"RTN","TIUPUTCN",41,0)
 Q $S(+$P($G(^TIU(8925,+DA,0)),U,5)<6:1,1:0)
"RTN","TIUPUTCN",42,0)
MAKEADD() ; Create an addendum record
"RTN","TIUPUTCN",43,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTCN",44,0)
 S TIUATYP=+$$WHATITLE("ADDENDUM")
"RTN","TIUPUTCN",45,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUPUTCN",46,0)
 D ^DIC
"RTN","TIUPUTCN",47,0)
 S DA=+Y
"RTN","TIUPUTCN",48,0)
 I +DA>0 S DIE=DIC,DR=".04////"_$$DOCCLASS^TIULC1(TIUATYP) D ^DIE
"RTN","TIUPUTCN",49,0)
 K TIUHDR(.01)
"RTN","TIUPUTCN",50,0)
 Q +DA
"RTN","TIUPUTCN",51,0)
STUFREC(DA,PARENT) ; Stuff fixed field data
"RTN","TIUPUTCN",52,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUPUTCN",53,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTCN",54,0)
 I +$G(PARENT)'>0 D
"RTN","TIUPUTCN",55,0)
 . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUPUTCN",56,0)
 . S @FDARR@(.05)=3
"RTN","TIUPUTCN",57,0)
 . S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTCN",58,0)
 . S @FDARR@(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUPUTCN",59,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTCN",60,0)
 . S @FDARR@(1205)=$S(+$P($G(TIU("LOC")),U):$P($G(TIU("LOC")),U),1:$P($G(TIU("VLOC")),U))
"RTN","TIUPUTCN",61,0)
 . ;S @FDARR@(1211)=$P($G(TIU("VLOC")),U)
"RTN","TIUPUTCN",62,0)
 . S @FDARR@(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUPUTCN",63,0)
 I +$G(PARENT)>0 D
"RTN","TIUPUTCN",64,0)
 . S @FDARR@(.02)=+$P($G(^TIU(8925,+PARENT,0)),U,2)
"RTN","TIUPUTCN",65,0)
 . S @FDARR@(.03)=+$P($G(^TIU(8925,+PARENT,0)),U,3),@FDARR@(.05)=3
"RTN","TIUPUTCN",66,0)
 . S @FDARR@(.06)=PARENT
"RTN","TIUPUTCN",67,0)
 . S @FDARR@(.07)=$P($G(^TIU(8925,+PARENT,0)),U,7)
"RTN","TIUPUTCN",68,0)
 . S @FDARR@(.08)=$P($G(^TIU(8925,+PARENT,0)),U,8)
"RTN","TIUPUTCN",69,0)
 . S @FDARR@(1205)=$P($G(^TIU(8925,+PARENT,12)),U,5)
"RTN","TIUPUTCN",70,0)
 . S @FDARR@(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUPUTCN",71,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTCN",72,0)
 S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUPUTCN",73,0)
 S @FDARR@(1301)=$S($G(TIUDDT)]"":$$IDATE^TIULC($G(TIUDDT)),1:"")
"RTN","TIUPUTCN",74,0)
 I @FDARR@(1301)'>0 S @FDARR@(1301)=$G(@FDARR@(.07))
"RTN","TIUPUTCN",75,0)
 S @FDARR@(1303)="U"
"RTN","TIUPUTCN",76,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTCN",77,0)
 Q
"RTN","TIUPUTCN",78,0)
DELTEXT(DA) ; Delete existing text in preparation for replacement
"RTN","TIUPUTCN",79,0)
 N DIE,DR,X,Y
"RTN","TIUPUTCN",80,0)
 S DIE=8925,DR="2///@" D ^DIE
"RTN","TIUPUTCN",81,0)
 Q
"RTN","TIUPUTCN",82,0)
WHATYPE(X) ; Identify document type
"RTN","TIUPUTCN",83,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTCN",84,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTCN",85,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTCN",86,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTCN",87,0)
 S DIC("S")="I $D(^TIU(8925.1,+Y,""HEAD""))!$D(^TIU(8295.1,+Y,""ITEM""))"
"RTN","TIUPUTCN",88,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTCN",89,0)
WHATYPX Q Y
"RTN","TIUPUTCN",90,0)
WHATITLE(X) ; Identify document title
"RTN","TIUPUTCN",91,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTCN",92,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTCN",93,0)
 N DIC,Y,TIUFPRIV,SCREEN,TIUCLASS S TIUFPRIV=1
"RTN","TIUPUTCN",94,0)
 S DIC=8925.1,DIC(0)="M",TIUCLASS=+$$CLASS^TIUCNSLT
"RTN","TIUPUTCN",95,0)
 S SCREEN="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"",+$$ISA^TIULX(+Y,"_TIUCLASS_"),+$$CANPICK^TIULP(+Y)"
"RTN","TIUPUTCN",96,0)
 S DIC("S")=SCREEN
"RTN","TIUPUTCN",97,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTCN",98,0)
WHATITX Q Y
"RTN","TIUPUTCN",99,0)
FOLLOWUP(TIUDA) ; Post-filing code for PROGRESS NOTES
"RTN","TIUPUTCN",100,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU,DFN
"RTN","TIUPUTCN",101,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTCN",102,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTCN",103,0)
 I +$P($G(^TIU(8925,TIUDA,12)),U,9),'+$P($G(^(12)),U,8) D
"RTN","TIUPUTCN",104,0)
 . S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTCN",105,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTCN",106,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,8),(+$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,8)) D
"RTN","TIUPUTCN",107,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTCN",108,0)
 D RELEASE^TIUT(TIUDA,1)
"RTN","TIUPUTCN",109,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTCN",110,0)
 I '$D(TIU("VSTR")) D
"RTN","TIUPUTCN",111,0)
 . N TIUD0,TIUD12,TIUVLOC,TIUHLOC,TIUEDT,TIULDT
"RTN","TIUPUTCN",112,0)
 . S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUPUTCN",113,0)
 . S DFN=+$P(TIUD0,U,2),TIUEDT=+$P(TIUD0,U,7)
"RTN","TIUPUTCN",114,0)
 . S TIULDT=$$FMADD^XLFDT(TIUEDT,1),TIUHLOC=+$P(TIUD12,U,5)
"RTN","TIUPUTCN",115,0)
 . S TIUVLOC=$S(+$P(TIUD12,U,11):+$P(TIUD12,U,11),1:+TIUHLOC)
"RTN","TIUPUTCN",116,0)
 . I $S(+DFN'>0:1,+TIUEDT'>0:1,+TIULDT'>0:1,+TIUVLOC'>0:1,1:0) Q
"RTN","TIUPUTCN",117,0)
 . D MAIN^TIUVSIT(.TIU,DFN,"",TIUEDT,TIULDT,"LAST",0,+TIUVLOC)
"RTN","TIUPUTCN",118,0)
 Q:'$D(TIU("VSTR"))
"RTN","TIUPUTCN",119,0)
 D ENQ^TIUPXAP1 ; Get/file VISIT
"RTN","TIUPUTCN",120,0)
 I +$P($G(^TIU(8925,+TIUDA,14)),U,5) D
"RTN","TIUPUTCN",121,0)
 . N TIUCDA,DA S TIUCDA=+$P($G(^TIU(8925,+TIUDA,14)),U,5)
"RTN","TIUPUTCN",122,0)
 . ; Post result in CT Pkg
"RTN","TIUPUTCN",123,0)
 . D GET^GMRCTIU(TIUCDA,TIUDA,"INCOMPLETE RPT")
"RTN","TIUPUTCN",124,0)
 Q
"RTN","TIUPUTPN")
0^59^B22180375
"RTN","TIUPUTPN",1,0)
TIUPUTPN ; SLC/JER - PN Look-up Method ;10/30/00
"RTN","TIUPUTPN",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,21,100**;Jun 20, 1997
"RTN","TIUPUTPN",3,0)
LOOKUP ; Look-up code used by router/filer
"RTN","TIUPUTPN",4,0)
 ; Required: TIUSSN, TIUVDT
"RTN","TIUPUTPN",5,0)
 N DA,DFN,TIU,TIUDAD,TIUEDIT,TIUEDT,TIULDT,TIUXCRP,TIUTYPE,TIUNEW
"RTN","TIUPUTPN",6,0)
 N TIUDPRM
"RTN","TIUPUTPN",7,0)
 I $S('$D(TIUSSN):1,'$D(TIUVDT):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTPN",8,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTPN",9,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTPN",10,0)
 S TIULOC=+$$ILOC(TIULOC)
"RTN","TIUPUTPN",11,0)
 I '$D(^SC(+$G(TIULOC),0)) S Y=-1 G LOOKUPX
"RTN","TIUPUTPN",12,0)
 S TIUEDT=$$IDATE^TIULC(TIUVDT),TIULDT=$$FMADD^XLFDT(TIUEDT,1)
"RTN","TIUPUTPN",13,0)
 I +TIUEDT'>0 S Y=-1 Q
"RTN","TIUPUTPN",14,0)
 S TIUTYPE=$$WHATITLE(TIUTITLE)
"RTN","TIUPUTPN",15,0)
 I +TIUTYPE'>0 S Y=-1 Q
"RTN","TIUPUTPN",16,0)
 D DOCPRM^TIULC1(+TIUTYPE,.TIUDPRM)
"RTN","TIUPUTPN",17,0)
 I $P($G(^SC(+TIULOC,0)),U,3)="W" D  I 1
"RTN","TIUPUTPN",18,0)
 . D MAIN^TIUMOVE(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,1,"LAST",0,TIULOC)
"RTN","TIUPUTPN",19,0)
 E  D MAIN^TIUVSIT(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,"LAST",0,TIULOC)
"RTN","TIUPUTPN",20,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTPN",21,0)
 I $P(+$G(TIU("EDT")),".")'=$P($$IDATE^TIULC(TIUVDT),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTPN",22,0)
 S TIUTYP(1)=1_U_TIUTYPE_U_$$PNAME^TIULC1(TIUTYPE)
"RTN","TIUPUTPN",23,0)
 ;S Y=$$GETREC^TIUEDI1(DFN,.TIU,1,.TIUNEW,.TIUDPRM)
"RTN","TIUPUTPN",24,0)
 S Y=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM)
"RTN","TIUPUTPN",25,0)
 I +Y'>0 G LOOKUPX
"RTN","TIUPUTPN",26,0)
 ; If record is not new, has text and can be edited, then replace
"RTN","TIUPUTPN",27,0)
 ; existing text
"RTN","TIUPUTPN",28,0)
 I +$G(TIUNEW)'>0 D
"RTN","TIUPUTPN",29,0)
 . S TIUEDIT=$$CANEDIT(+Y)
"RTN","TIUPUTPN",30,0)
 . I +TIUEDIT>0,$D(^TIU(8925,+Y,"TEXT")) D DELTEXT(+Y)
"RTN","TIUPUTPN",31,0)
 . I +TIUEDIT'>0 S TIUDAD=+Y,Y=$$MAKEADD
"RTN","TIUPUTPN",32,0)
 I +Y'>0 Q
"RTN","TIUPUTPN",33,0)
 D STUFREC(Y,+$G(TIUDAD))
"RTN","TIUPUTPN",34,0)
 I +$G(TIUDAD) D SENDADD^TIUALRT(+Y)
"RTN","TIUPUTPN",35,0)
 K TIUHDR(.01),TIUHDR(.07),TIUHDR(1301)
"RTN","TIUPUTPN",36,0)
LOOKUPX Q
"RTN","TIUPUTPN",37,0)
ILOC(LOCATION) ; Get pointer to file 44
"RTN","TIUPUTPN",38,0)
 N DIC,X,Y
"RTN","TIUPUTPN",39,0)
 S DIC=44,DIC(0)="M",X=LOCATION D ^DIC
"RTN","TIUPUTPN",40,0)
 Q Y
"RTN","TIUPUTPN",41,0)
CANEDIT(DA) ; Check whether or not document is released
"RTN","TIUPUTPN",42,0)
 Q $S(+$P($G(^TIU(8925,+DA,0)),U,5)<4:1,1:0)
"RTN","TIUPUTPN",43,0)
MAKEADD() ; Create an addendum record
"RTN","TIUPUTPN",44,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTPN",45,0)
 S TIUATYP=+$$WHATITLE("ADDENDUM")
"RTN","TIUPUTPN",46,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUPUTPN",47,0)
 D ^DIC
"RTN","TIUPUTPN",48,0)
 S DA=+Y
"RTN","TIUPUTPN",49,0)
 I +DA>0 S DIE=DIC,DR=".04////"_$$DOCCLASS^TIULC1(TIUATYP) D ^DIE
"RTN","TIUPUTPN",50,0)
 K TIUHDR(.01)
"RTN","TIUPUTPN",51,0)
 Q +DA
"RTN","TIUPUTPN",52,0)
STUFREC(DA,PARENT) ; Stuff fixed field data
"RTN","TIUPUTPN",53,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUPUTPN",54,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTPN",55,0)
 I +$G(PARENT)'>0 D
"RTN","TIUPUTPN",56,0)
 . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUPUTPN",57,0)
 . S @FDARR@(.05)=3
"RTN","TIUPUTPN",58,0)
 . S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTPN",59,0)
 . S @FDARR@(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUPUTPN",60,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTPN",61,0)
 . S @FDARR@(1205)=$S(+$P($G(TIU("LOC")),U):$P($G(TIU("LOC")),U),1:$P($G(TIU("VLOC")),U))
"RTN","TIUPUTPN",62,0)
 . ;S @FDARR@(1211)=$P($G(TIU("VLOC")),U)
"RTN","TIUPUTPN",63,0)
 . S @FDARR@(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUPUTPN",64,0)
 I +$G(PARENT)>0 D
"RTN","TIUPUTPN",65,0)
 . S @FDARR@(.02)=+$P($G(^TIU(8925,+PARENT,0)),U,2)
"RTN","TIUPUTPN",66,0)
 . S @FDARR@(.03)=+$P($G(^TIU(8925,+PARENT,0)),U,3),@FDARR@(.05)=3
"RTN","TIUPUTPN",67,0)
 . S @FDARR@(.06)=PARENT
"RTN","TIUPUTPN",68,0)
 . S @FDARR@(.07)=$P($G(^TIU(8925,+PARENT,0)),U,7)
"RTN","TIUPUTPN",69,0)
 . S @FDARR@(.08)=$P($G(^TIU(8925,+PARENT,0)),U,8)
"RTN","TIUPUTPN",70,0)
 . S @FDARR@(1205)=$P($G(^TIU(8925,+PARENT,12)),U,5)
"RTN","TIUPUTPN",71,0)
 . S @FDARR@(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUPUTPN",72,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTPN",73,0)
 S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUPUTPN",74,0)
 S @FDARR@(1301)=$S($G(TIUDDT)]"":$$IDATE^TIULC($G(TIUDDT)),1:"")
"RTN","TIUPUTPN",75,0)
 I $S(@FDARR@(1301)'>0:1,$P(@FDARR@(1301),".",2)']"":1,1:0) D
"RTN","TIUPUTPN",76,0)
 . S @FDARR@(1301)=$S($P($G(TIU("VSTR")),";",3)="H":$$NOW^XLFDT,1:$G(@FDARR@(.07)))
"RTN","TIUPUTPN",77,0)
 S @FDARR@(1303)="U"
"RTN","TIUPUTPN",78,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTPN",79,0)
 Q
"RTN","TIUPUTPN",80,0)
DELTEXT(DA) ; Delete existing text in preparation for replacement
"RTN","TIUPUTPN",81,0)
 N DIE,DR,X,Y
"RTN","TIUPUTPN",82,0)
 S DIE=8925,DR="2///@" D ^DIE
"RTN","TIUPUTPN",83,0)
 Q
"RTN","TIUPUTPN",84,0)
WHATYPE(X) ; Identify document type
"RTN","TIUPUTPN",85,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTPN",86,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTPN",87,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTPN",88,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTPN",89,0)
 S DIC("S")="I $D(^TIU(8925.1,+Y,""HEAD""))!$D(^TIU(8295.1,+Y,""ITEM""))"
"RTN","TIUPUTPN",90,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTPN",91,0)
WHATYPX Q Y
"RTN","TIUPUTPN",92,0)
WHATITLE(X) ; Identify document title
"RTN","TIUPUTPN",93,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTPN",94,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTPN",95,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTPN",96,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTPN",97,0)
 S DIC("S")="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"""
"RTN","TIUPUTPN",98,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTPN",99,0)
WHATITX Q Y
"RTN","TIUPUTPN",100,0)
FOLLOWUP(TIUDA) ; Post-filing code for PROGRESS NOTES
"RTN","TIUPUTPN",101,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU,DFN
"RTN","TIUPUTPN",102,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTPN",103,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTPN",104,0)
 I +$P($G(^TIU(8925,TIUDA,12)),U,9),'+$P($G(^(12)),U,8) D
"RTN","TIUPUTPN",105,0)
 . S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTPN",106,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTPN",107,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,8),(+$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,8)) D
"RTN","TIUPUTPN",108,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTPN",109,0)
 D RELEASE^TIUT(TIUDA,1)
"RTN","TIUPUTPN",110,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTPN",111,0)
 I '$D(TIU("VSTR")) D
"RTN","TIUPUTPN",112,0)
 . N TIUD0,TIUD12,TIUVLOC,TIUHLOC,TIUEDT,TIULDT
"RTN","TIUPUTPN",113,0)
 . S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUPUTPN",114,0)
 . S DFN=+$P(TIUD0,U,2),TIUEDT=+$P(TIUD0,U,7)
"RTN","TIUPUTPN",115,0)
 . S TIULDT=$$FMADD^XLFDT(TIUEDT,1),TIUHLOC=+$P(TIUD12,U,5)
"RTN","TIUPUTPN",116,0)
 . S TIUVLOC=$S(+$P(TIUD12,U,11):+$P(TIUD12,U,11),1:+TIUHLOC)
"RTN","TIUPUTPN",117,0)
 . I $S(+DFN'>0:1,+TIUEDT'>0:1,+TIULDT'>0:1,+TIUVLOC'>0:1,1:0) Q
"RTN","TIUPUTPN",118,0)
 . D MAIN^TIUVSIT(.TIU,DFN,"",TIUEDT,TIULDT,"LAST",0,+TIUVLOC)
"RTN","TIUPUTPN",119,0)
 Q:'$D(TIU("VSTR"))
"RTN","TIUPUTPN",120,0)
 D ENQ^TIUPXAP1 ; Get/file VISIT
"RTN","TIUPUTPN",121,0)
 Q
"RTN","TIUPUTU")
0^60^B16248856
"RTN","TIUPUTU",1,0)
TIUPUTU ; SLC/JER - Utilities for Filer/Router ;10/30/00
"RTN","TIUPUTU",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,100**;Jun 20, 1997
"RTN","TIUPUTU",3,0)
LOOKUP ; Look-up code used by router/filer
"RTN","TIUPUTU",4,0)
 ; Required: TIUSSN, TIUADT
"RTN","TIUPUTU",5,0)
 N DA,DFN,TIU,TIUDAD,TIUEDIT,TIUEDT,TIULDT,TIUXCRP S TIUXCRP=1
"RTN","TIUPUTU",6,0)
 I $S('$D(TIUSSN):1,'$D(TIUADT):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTU",7,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTU",8,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTU",9,0)
 S TIUEDT=$$IDATE^TIULC(TIUADT),TIULDT=$$FMADD^XLFDT(TIUEDT,1)
"RTN","TIUPUTU",10,0)
 I +TIUEDT'>0 S Y=-1 Q
"RTN","TIUPUTU",11,0)
 D MAIN^TIUMOVE(.TIU,.DFN,TIUSSN,TIUEDT,TIULDT,1,"LAST",0)
"RTN","TIUPUTU",12,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTU",13,0)
 I $P(+$G(TIU("EDT")),".")'=$P($$IDATE^TIULC(TIUADT),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTU",14,0)
 I '+$G(TIU("LDT")),($G(TIUDICDT)]""),(+$$IDATE^TIULC(TIUDICDT)=-1) S Y=-1 Q
"RTN","TIUPUTU",15,0)
 S TIUTYP(1)=1_U_RECORD("TYPE")_U_$$PNAME^TIULC1(RECORD("TYPE"))
"RTN","TIUPUTU",16,0)
 ;S Y=$$GETREC^TIUEDI1(DFN,.TIU,1)
"RTN","TIUPUTU",17,0)
 S Y=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1))
"RTN","TIUPUTU",18,0)
 I +Y'>0 G LOOKUPX
"RTN","TIUPUTU",19,0)
 S TIUEDIT=$$CANEDIT(+Y)
"RTN","TIUPUTU",20,0)
 ; If record has text and can be edited, then replace existing text
"RTN","TIUPUTU",21,0)
 I +TIUEDIT>0,$D(^TIU(8925,+Y,"TEXT")) D DELTEXT(+Y)
"RTN","TIUPUTU",22,0)
 I +TIUEDIT'>0 S TIUDAD=+Y,Y=$$MAKEADD
"RTN","TIUPUTU",23,0)
 I +Y'>0 G LOOKUPX
"RTN","TIUPUTU",24,0)
 K TIUHDR(.07)
"RTN","TIUPUTU",25,0)
 D STUFREC(Y,+$G(TIUDAD))
"RTN","TIUPUTU",26,0)
 I +$G(TIUDAD) D SENDADD^TIUALRT(+Y)
"RTN","TIUPUTU",27,0)
LOOKUPX Q
"RTN","TIUPUTU",28,0)
CANEDIT(DA) ; Check whether or not document is released
"RTN","TIUPUTU",29,0)
 Q $S(+$P($G(^TIU(8925,+DA,13)),U,4):0,+$P($G(^(13)),U,5)>0:0,+$G(^(15)):0,1:1)
"RTN","TIUPUTU",30,0)
MAKEADD() ; Create an addendum record
"RTN","TIUPUTU",31,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTU",32,0)
 S TIUATYP=+$$WHATITLE("ADDENDUM")
"RTN","TIUPUTU",33,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUPUTU",34,0)
 D ^DIC
"RTN","TIUPUTU",35,0)
 S DA=+Y
"RTN","TIUPUTU",36,0)
 I +DA>0 S DIE=DIC,DR=".04////"_$$DOCCLASS^TIULC1(TIUATYP) D ^DIE
"RTN","TIUPUTU",37,0)
 Q +DA
"RTN","TIUPUTU",38,0)
STUFREC(DA,PARENT) ; Stuff fixed field data
"RTN","TIUPUTU",39,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIURDT
"RTN","TIUPUTU",40,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTU",41,0)
 I +$G(PARENT)'>0 D
"RTN","TIUPUTU",42,0)
 . S @FDARR@(.02)=$G(DFN),@FDARR@(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUPUTU",43,0)
 . S @FDARR@(.05)=3
"RTN","TIUPUTU",44,0)
 . S @FDARR@(.07)=$P(TIU("EDT"),U)
"RTN","TIUPUTU",45,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U),@FDARR@(1401)=TIU("AD#")
"RTN","TIUPUTU",46,0)
 . S @FDARR@(1402)=$P($G(TIU("TS")),U),@FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTU",47,0)
 I +$G(PARENT)>0 D
"RTN","TIUPUTU",48,0)
 . S @FDARR@(.02)=+$P(^TIU(8925,+PARENT,0),U,2)
"RTN","TIUPUTU",49,0)
 . S @FDARR@(.03)=+$P(^TIU(8925,+PARENT,0),U,3),@FDARR@(.05)=3
"RTN","TIUPUTU",50,0)
 . S @FDARR@(.06)=PARENT,@FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUPUTU",51,0)
 . S @FDARR@(1401)=$P(^TIU(8925,+PARENT,14),U)
"RTN","TIUPUTU",52,0)
 . S @FDARR@(1402)=$P(^TIU(8925,+PARENT,14),U,2)
"RTN","TIUPUTU",53,0)
 . S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTU",54,0)
 S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUPUTU",55,0)
 I +$G(TIU("LDT")) S TIURDT=+$G(TIU("LDT"))
"RTN","TIUPUTU",56,0)
 I +$G(TIU("LDT"))'>0 D
"RTN","TIUPUTU",57,0)
 . S TIUDICDT=+$$IDATE^TIULC($G(TIUDICDT))
"RTN","TIUPUTU",58,0)
 . S TIURDT=$S(+$G(TIUDICDT)>0:+$G(TIUDICDT),1:+$$NOW^TIULC)
"RTN","TIUPUTU",59,0)
 . S TIU("LDT")=TIURDT_U_$$DATE^TIULS(TIURDT,"AMTH DD, CCYY@HR:MIN:SEC")
"RTN","TIUPUTU",60,0)
 . S @FDARR@(.12)=1
"RTN","TIUPUTU",61,0)
 S @FDARR@(1301)=TIURDT,@FDARR@(1303)="U"
"RTN","TIUPUTU",62,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTU",63,0)
 Q
"RTN","TIUPUTU",64,0)
DELTEXT(DA) ; Delete existing text in preparation for replacement
"RTN","TIUPUTU",65,0)
 N DIE,DR,X,Y
"RTN","TIUPUTU",66,0)
 S DIE=8925,DR="2///@" D ^DIE
"RTN","TIUPUTU",67,0)
 Q
"RTN","TIUPUTU",68,0)
WHATYPE(X) ; Identify document type
"RTN","TIUPUTU",69,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTU",70,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTU",71,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTU",72,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTU",73,0)
 S DIC("S")="I $D(^TIU(8925.1,+Y,""HEAD""))!$D(^TIU(8925.1,+Y,""ITEM""))"
"RTN","TIUPUTU",74,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTU",75,0)
 Q Y
"RTN","TIUPUTU",76,0)
WHATYPE2(X) ; Identify document type
"RTN","TIUPUTU",77,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTU",78,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTU",79,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTU",80,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTU",81,0)
 S DIC("S")="I $D(^TIU(8925.1,+Y,""HEAD""))!$D(^TIU(8925.1,+Y,""ITEM""))"
"RTN","TIUPUTU",82,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTU",83,0)
 Q Y
"RTN","TIUPUTU",84,0)
WHATITLE(X) ; Identify document type
"RTN","TIUPUTU",85,0)
 ; Receives: X=Document Definition Name
"RTN","TIUPUTU",86,0)
 ;  Returns: Y=Document Definition IFN
"RTN","TIUPUTU",87,0)
 N DIC,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUPUTU",88,0)
 S DIC=8925.1,DIC(0)="M"
"RTN","TIUPUTU",89,0)
 S DIC("S")="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"""
"RTN","TIUPUTU",90,0)
 D ^DIC K DIC("S")
"RTN","TIUPUTU",91,0)
 Q Y
"RTN","TIUPUTU",92,0)
FOLLOWUP(TIUDA) ; Post-filing code for Discharge Summaries
"RTN","TIUPUTU",93,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU
"RTN","TIUPUTU",94,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTU",95,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPUTU",96,0)
 I $L($G(TIU("EDT"))) S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTU",97,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTU",98,0)
 S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTU",99,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTU",100,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,9) D
"RTN","TIUPUTU",101,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTU",102,0)
 D ENQ^TIUPXAP1 ; In-line call to get/file the visit
"RTN","TIUPUTU",103,0)
 D RELEASE^TIUT(TIUDA,1),UPDTIRT^TIUDIRT(.TIU,TIUDA)
"RTN","TIUPUTU",104,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTU",105,0)
 Q
"RTN","TIUR")
0^16^B32618351
"RTN","TIUR",1,0)
TIUR ; SLC/JER - Integrated Document Review ;2/26/01
"RTN","TIUR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100**;Jun 20, 1997
"RTN","TIUR",3,0)
 ; 11/30/00 Moved PUTLIST & ADDELMNT to TIUR1
"RTN","TIUR",4,0)
MAKELIST(TIUCLASS,TIUCHVW) ; Get Search Criteria
"RTN","TIUR",5,0)
 N DIRUT,DTOUT,DUOUT,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIUR",6,0)
 N TIUDPRMT,TIUPICT,TIUOUT,STATWORD,STATIFN,NOWFLAG
"RTN","TIUR",7,0)
 K DIROUT
"RTN","TIUR",8,0)
 D INITRR^TIULRR(0)
"RTN","TIUR",9,0)
 ;  TIURPN used in Order Entry 2.5, OR OE/RR MENU CLIN:
"RTN","TIUR",10,0)
 I +$G(ORVP),(+$G(TIUCHVW)'>0) D EN^TIURPN(TIUCLASS,+ORVP) Q
"RTN","TIUR",11,0)
STATUS S STATUS=$S($D(TIUQUIK):$$SELSTAT^TIULA(.TIUSTAT,"F","UNSIGNED,UNCOSIGNED"),($D(ORVP)&'+$G(TIUCHVW)):$$SELSTAT^TIULA(.TIUSTAT,"F","COMPLETED"),1:$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT^TIURM(DUZ)))
"RTN","TIUR",12,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIUR",13,0)
 S TIUI=0
"RTN","TIUR",14,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIUR",15,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIUR",16,0)
 . Q:'STATIFN
"RTN","TIUR",17,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIUR",18,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIUR",19,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR",20,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIUR",21,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIUR",22,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIUR",23,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIUR",24,0)
 N TIUDCL K TIUPICT
"RTN","TIUR",25,0)
 I $S(('$D(TIUQUIK)&'$D(ORVP)):1,($D(ORVP)&+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL,.TIUPICT)
"RTN","TIUR",26,0)
 ; SELTYP sets array ^TMP("TIUTYP",$J);
"RTN","TIUR",27,0)
 ; SELTYP used to set data into TIUTYP array
"RTN","TIUR",28,0)
 ; Now TIUTYP just ="^TMP("TIUTYP",$J)"
"RTN","TIUR",29,0)
 I $S($D(TIUQUIK):1,($D(ORVP)&'+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"F","ALL","DOC",0)
"RTN","TIUR",30,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",31,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIUR",32,0)
SCREEN ;
"RTN","TIUR",33,0)
 N TIUNAME
"RTN","TIUR",34,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIUR",35,0)
 I $D(TIUQUIK) D  I 1
"RTN","TIUR",36,0)
 . S SCREEN(1)="AAU^"_DUZ_U_TIUNAME
"RTN","TIUR",37,0)
 . S SCREEN(2)="ASUP^"_DUZ
"RTN","TIUR",38,0)
 E  I $D(ORVP),'+$G(TIUCHVW) S SCREEN(1)="APT^"_+ORVP_U_$P($G(^DPT(+ORVP,0)),U) I 1
"RTN","TIUR",39,0)
 E  D SELCAT^TIULA1(.SCREEN,"A","AUTHOR")
"RTN","TIUR",40,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",41,0)
 I $D(SCREEN)'>9 K @TIUTYP G DOCTYPE
"RTN","TIUR",42,0)
 I $D(@TIUTYP)'>9 W !,$C(7),"You must select one or more TITLES..." G SCREEN
"RTN","TIUR",43,0)
 I $G(SCREEN(1))="ALL^ANY",+$G(ORVP) S SCREEN(1)="APT^"_+$G(ORVP)_U_$P($G(^DPT(+$G(ORVP),0)),U)
"RTN","TIUR",44,0)
 D CHECKADD
"RTN","TIUR",45,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIUR",46,0)
 S TIUDPRMT=$S(TIUCLASS=244:"Discharge",1:"Reference")
"RTN","TIUR",47,0)
 S TIUEDT=$S($D(TIUQUIK):1,$D(ORVP)&(+$G(TIUCHVW)'>0):$$FMADD^XLFDT(DT,$S($D(^DPT(+$G(ORVP),.1))'>0:-180,1:-30)),1:$P($$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT),U))
"RTN","TIUR",48,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",49,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIUR",50,0)
 S TIULDT=$S($D(TIUQUIK):9999999,$D(ORVP)&(+$G(TIUCHVW)'>0):+$$NOW^XLFDT,1:$P($$LDATE^TIULA(TIUDPRMT),U))
"RTN","TIUR",51,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",52,0)
 I TIULDT'>0 G ERLY
"RTN","TIUR",53,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIUR",54,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT)
"RTN","TIUR",55,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIUR",56,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIUR",57,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIUR",58,0)
 D BUILD(TIUCLASS,.STATUS,.SCREEN,TIUEDT,TIULDT,NOWFLAG) ;11/30/00 removed param TIUTYP since BUILD uses global now.
"RTN","TIUR",59,0)
 ; -- If attaching ID note & changed view,
"RTN","TIUR",60,0)
 ;    update video for line to be attached: --
"RTN","TIUR",61,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIUR",62,0)
 ;K @TIUTYP ;11/30/00 keep ^TMP("TIUTYP",$J) for rebuild
"RTN","TIUR",63,0)
 Q
"RTN","TIUR",64,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIUR",65,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIUR",66,0)
 S (TIUI,HIT)=0
"RTN","TIUR",67,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIUR",68,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIUR",69,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIUR",70,0)
 Q
"RTN","TIUR",71,0)
 ;
"RTN","TIUR",72,0)
SWAP(TIUX,TIUY) ; Swap variables
"RTN","TIUR",73,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIUR",74,0)
 Q
"RTN","TIUR",75,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIUR",76,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIUR",77,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIUR",78,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIUR",79,0)
 Q
"RTN","TIUR",80,0)
BUILD(TIUCLASS,STATUS,SCREEN,EARLY,LATE,NOWFLAG) ; Build List.
"RTN","TIUR",81,0)
 ;11/30/00 - removed param TYPES. 12/3 added param TIUCLASS
"RTN","TIUR",82,0)
 ; BUILD (GATHER) uses docmt type info from ^TMP("TIUTYP",$J)
"RTN","TIUR",83,0)
 N TIUDT,TIUI,TIUK
"RTN","TIUR",84,0)
 N TIUT,TIUTP,XREF,TIUS,TIUPREF
"RTN","TIUR",85,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIUR",86,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIUR",87,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIUR",88,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIUR",89,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIUR",90,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIUR",91,0)
 S ^TMP("TIUR",$J,"RTN")="TIUR"
"RTN","TIUR",92,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUR",93,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUR",94,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIUR",95,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIUR",96,0)
 . I XREF'="ASUB" D
"RTN","TIUR",97,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIUR",98,0)
 . . D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF)
"RTN","TIUR",99,0)
 . I XREF="ASUB" D
"RTN","TIUR",100,0)
 . . S TIUI=$O(^TIU(8925,XREF,$P(SCREEN(TIUK),U,2)),-1)
"RTN","TIUR",101,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[$P(SCREEN(TIUK),U,2))  D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF)
"RTN","TIUR",102,0)
 D PUTLIST^TIUR2(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIUR",103,0)
 K ^TMP("TIUI",$J)
"RTN","TIUR",104,0)
 Q
"RTN","TIUR",105,0)
 ;
"RTN","TIUR",106,0)
CLEAN ; Clean up your mess!
"RTN","TIUR",107,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIUR",108,0)
 K VALMY
"RTN","TIUR",109,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIUR",110,0)
 Q
"RTN","TIUR",111,0)
 ;
"RTN","TIUR",112,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIUR",113,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIUR",114,0)
 N TIURBLD,TIUI,TIUCLASS,NOWFLAG
"RTN","TIUR",115,0)
 S TIURBLD=1
"RTN","TIUR",116,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIUR",117,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIUR",118,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIUR",119,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIUR",120,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIUR",121,0)
 S TIUI=1
"RTN","TIUR",122,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIUR",123,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIUR",124,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIUR",125,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIUR",126,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIUR",127,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIUR",128,0)
 D BUILD(TIUCLASS,.STATUS,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIUR",129,0)
 ; Reexpand previously expanded items:
"RTN","TIUR",130,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIUR",131,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR",132,0)
 Q
"RTN","TIUR1")
0^73^B12693272
"RTN","TIUR1",1,0)
TIUR1  ; SLC/JER - Integrated Document Review ;1/16/01
"RTN","TIUR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**79,100**;Jun 20, 1997
"RTN","TIUR1",3,0)
 ; 11/30/00 moved PUTLIST & ADDELMNT here from TIUR. 
"RTN","TIUR1",4,0)
 ; 12/12/00 moved PUTLIST, ADDELMNT, PARENT, EXPANDKD to TIUR2
"RTN","TIUR1",5,0)
GATHER(TIUI,TIUPREF,CLASS,STATIFNS,EARLY,LATE,XREF) ; Find/sort
"RTN","TIUR1",6,0)
 ; Uses title info from ^TMP("TIUTYP",$J) array, set in SELTYP^TIULA
"RTN","TIUR1",7,0)
 N TIUT,TIUTP,TIUS,TIUSTAT,TIUSFLD,TIUD0,TIUD12,TIUD13,TIUD15
"RTN","TIUR1",8,0)
 N TIUIFN,TIULD
"RTN","TIUR1",9,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIUR1",10,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIUR1",11,0)
 S TIUT=0 F  S TIUT=$O(^TMP("TIUTYP",$J,TIUT)) Q:+TIUT'>0  D
"RTN","TIUR1",12,0)
 . S TIUTP=+$P($G(^TMP("TIUTYP",$J,TIUT)),U,2) Q:TIUTP'>0
"RTN","TIUR1",13,0)
 . S TIUS=1 F  S TIUSTAT=$P(STATIFNS,";",TIUS) Q:'TIUSTAT  D
"RTN","TIUR1",14,0)
 . . S TIUS=TIUS+1
"RTN","TIUR1",15,0)
 . . S (TIUJ,TIULD)=LATE
"RTN","TIUR1",16,0)
 . . F  S TIUJ=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ)) Q:+TIUJ'>0!(+TIUJ>EARLY)  D
"RTN","TIUR1",17,0)
 . . . S TIUIFN=0
"RTN","TIUR1",18,0)
 . . . F  S TIUIFN=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ,TIUIFN)) Q:+TIUIFN'>0  D
"RTN","TIUR1",19,0)
 . . . . I ($P(TIUPRM0,U,6)="S"),(+$$CANDO^TIULP(TIUIFN,"VIEW")'>0) Q
"RTN","TIUR1",20,0)
 . . . . I +$G(ORVP),(+$P($G(^TIU(8925,+TIUIFN,0)),U,2)'=+$G(ORVP)) Q
"RTN","TIUR1",21,0)
 . . . . I TIUTP=81,(^TMP("TIUTYP",$J)>1),($P(^TMP("TIUTYP",$J,TIUT),U,4)="NOT PICKED"),(+$P($G(^TIU(8925,+TIUIFN,0)),U,5)>6) Q
"RTN","TIUR1",22,0)
 . . . . I TIUTP=81,(^TMP("TIUTYP",$J)>1),($P(^TMP("TIUTYP",$J,TIUT),U,4)="NOT PICKED"),'+$$DADINTYP(TIUIFN) Q
"RTN","TIUR1",23,0)
 . . . . S TIUQ=$$RESOLVE(TIUIFN,TIUSFLD)
"RTN","TIUR1",24,0)
 . . . . S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)="",TIULD=TIUJ
"RTN","TIUR1",25,0)
 I +$D(TIUQUIK),+$G(TIULD) D ADDSIGN(DUZ,CLASS,TIULD,TIUSFLD)
"RTN","TIUR1",26,0)
 Q
"RTN","TIUR1",27,0)
DADINTYP(TIUDA) ; addendum's parent belong? 12/1/00 Removed param TYPES
"RTN","TIUR1",28,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIUR1",29,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIUR1",30,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIUR1",31,0)
 . I +$P(^TMP("TIUTYP",$J,TIUI),U,2)=TIUDTYP S TIUY=1
"RTN","TIUR1",32,0)
 Q TIUY
"RTN","TIUR1",33,0)
RESOLVE(DA,DR) ; resolve sort field values
"RTN","TIUR1",34,0)
 N TIUD0,TIUD12,TIUD13,TIUD15,TIUY
"RTN","TIUR1",35,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIUR1",36,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIUR1",37,0)
 I DR=.01 S TIUY=$$PNAME^TIULC1(+TIUD0) G RESX
"RTN","TIUR1",38,0)
 I DR=.02 S TIUY=$$PTNAME^TIULC1(+$P(TIUD0,U,2)) G RESX
"RTN","TIUR1",39,0)
 I DR=.05 S TIUY=$P(TIUD0,U,5) G RESX
"RTN","TIUR1",40,0)
 I DR=1202 S TIUY=$$PERSNAME^TIULC1(+$P(TIUD12,U,2)) S:TIUY="UNKNOWN" TIUY="" G RESX
"RTN","TIUR1",41,0)
 I DR=1208 S TIUY=$$PERSNAME^TIULC1(+$P(TIUD12,U,8)) S:TIUY="UNKNOWN" TIUY="" G RESX
"RTN","TIUR1",42,0)
 I DR=1301 S TIUY=$P(TIUD13,U) G RESX
"RTN","TIUR1",43,0)
 ;I DR=1507,($P(TIUD0,U,5)=7),(+$P(TIUD15,U,7)'>0) S DR=1501
"RTN","TIUR1",44,0)
 I DR=1507,(($P(TIUD0,U,5)=7)!($P(TIUD0,U,5)=8)),(+$P(TIUD15,U,7)'>0) S DR=1501 ;TIU*1*100 amended notes were sorting at top w sortval=ZZZZEMPTY for sortfld=complete, even tho they had sign date and displayed it.
"RTN","TIUR1",45,0)
 I DR=1501 S TIUY=$P(TIUD15,U) G RESX
"RTN","TIUR1",46,0)
 I DR=1507 S TIUY=$P(TIUD15,U,7)
"RTN","TIUR1",47,0)
RESX I $G(TIUY)']"" S TIUY="ZZZZEMPTY"
"RTN","TIUR1",48,0)
 Q TIUY
"RTN","TIUR1",49,0)
 ;
"RTN","TIUR1",50,0)
ADDSIGN(USER,CLASS,DATE,SORTBY)   ; Get documents for which the user is the additional signer
"RTN","TIUR1",51,0)
 N TIUI,TIUY S TIUI=0
"RTN","TIUR1",52,0)
 D NEEDSIG^TIULX(.TIUY,USER,CLASS)
"RTN","TIUR1",53,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR1",54,0)
 . N TIUDA,TIUD13,TIUQ,TIUJ
"RTN","TIUR1",55,0)
 . S TIUDA=+$G(@TIUY@(TIUI)),TIUD13=$G(^TIU(8925,TIUDA,13))
"RTN","TIUR1",56,0)
 . S TIUQ=$$RESOLVE(TIUDA,SORTBY),TIUJ=9999999-+TIUD13
"RTN","TIUR1",57,0)
 . S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)=""
"RTN","TIUR1",58,0)
 K @TIUY
"RTN","TIUR1",59,0)
 Q
"RTN","TIUR2")
0^74^B52417653
"RTN","TIUR2",1,0)
TIUR2  ; SLC/JER - Integrated Document Review ;3/3/01
"RTN","TIUR2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUR2",3,0)
 ; 12/12/00 new rtn, from splitting TIUR1
"RTN","TIUR2",4,0)
REPLACE(TIUDA,SORTVAL,SORTFLD,DATTIM,EXPAND,FORGETAD) ; Fix ^TMP("TIUI",$J).
"RTN","TIUR2",5,0)
 ;Remove ID kid or addm records from ^TMP("TIUI",$J), and replace
"RTN","TIUR2",6,0)
 ;with parent record instead.
"RTN","TIUR2",7,0)
 ; Requires TIUDA, SORTVAL, SORTFLD, DATTIM.
"RTN","TIUR2",8,0)
 ; Passes back opt array EXPAND, where EXPAND(IFN)=""
"RTN","TIUR2",9,0)
 ; opt flag FORGETAD: don't expand parent for sake of addm
"RTN","TIUR2",10,0)
 N IDPRNT,ADDMPRNT,ADDMGPNT,PVAL,GPVAL,PDATTIM,GPDATTIM
"RTN","TIUR2",11,0)
 S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIUR2",12,0)
 I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIUR2",13,0)
 I IDPRNT D
"RTN","TIUR2",14,0)
 . S PVAL=$$RESOLVE^TIUR1(IDPRNT,SORTFLD)
"RTN","TIUR2",15,0)
 . S PDATTIM=$S(^TMP("TIUR",$J,"RTN")="TIURM":+$G(^TIU(8925,IDPRNT,12)),1:+$G(^TIU(8925,IDPRNT,13))) ; rtn TIURM uses "F" XREF, whose date is ENTRY DT.
"RTN","TIUR2",16,0)
 . S PDATTIM=9999999-PDATTIM
"RTN","TIUR2",17,0)
 S ADDMPRNT=+$P($G(^TIU(8925,TIUDA,0)),U,6) ; assume TIUDA is not component
"RTN","TIUR2",18,0)
 I '$D(^TIU(8925,ADDMPRNT,0)) S ADDMPRNT=0
"RTN","TIUR2",19,0)
 I ADDMPRNT D
"RTN","TIUR2",20,0)
 . S PVAL=$$RESOLVE^TIUR1(ADDMPRNT,SORTFLD)
"RTN","TIUR2",21,0)
 . S PDATTIM=$S(^TMP("TIUR",$J,"RTN")="TIUR":+$G(^TIU(8925,ADDMPRNT,13)),1:+$G(^TIU(8925,ADDMPRNT,12)))
"RTN","TIUR2",22,0)
 . S PDATTIM=9999999-PDATTIM
"RTN","TIUR2",23,0)
 S EXPAND=+$G(EXPAND)
"RTN","TIUR2",24,0)
 ; -- If TIUDA is not an ID kid, not addm, just quit: --
"RTN","TIUR2",25,0)
 I 'IDPRNT,'ADDMPRNT Q
"RTN","TIUR2",26,0)
 ; -- Take kid or addm out of array:
"RTN","TIUR2",27,0)
 K ^TMP("TIUI",$J,SORTVAL,DATTIM,TIUDA)
"RTN","TIUR2",28,0)
 ; -- If TIUDA is an ID kid, put its parent in array:
"RTN","TIUR2",29,0)
 I IDPRNT D  Q
"RTN","TIUR2",30,0)
 . I '$D(EXPAND(IDPRNT)) S EXPAND(IDPRNT)="",EXPAND=EXPAND+1
"RTN","TIUR2",31,0)
 . S ^TMP("TIUI",$J,PVAL,PDATTIM,IDPRNT)=""
"RTN","TIUR2",32,0)
 ; -- If TIUDA is an addendum, put its (g)parent in array:
"RTN","TIUR2",33,0)
 I ADDMPRNT D  Q
"RTN","TIUR2",34,0)
 . I '$G(FORGETAD),'$D(EXPAND(ADDMPRNT)) S EXPAND(ADDMPRNT)="",EXPAND=EXPAND+1
"RTN","TIUR2",35,0)
 . S ADDMGPNT=+$G(^TIU(8925,ADDMPRNT,21))
"RTN","TIUR2",36,0)
 . I '$D(^TIU(8925,ADDMGPNT,0)) S ADDMGPNT=0
"RTN","TIUR2",37,0)
 . I ADDMGPNT D  I 1
"RTN","TIUR2",38,0)
 . . S GPVAL=$$RESOLVE^TIUR1(ADDMGPNT,SORTFLD)
"RTN","TIUR2",39,0)
 . . S GPDATTIM=$S(^TMP("TIUR",$J,"RTN")="TIUR":+$G(^TIU(8925,ADDMGPNT,13)),1:+$G(^TIU(8925,ADDMGPNT,12)))
"RTN","TIUR2",40,0)
 . . S GPDATTIM=9999999-GPDATTIM
"RTN","TIUR2",41,0)
 . . I '$D(EXPAND(ADDMGPNT)) S EXPAND(ADDMGPNT)="",EXPAND=EXPAND+1
"RTN","TIUR2",42,0)
 . . S ^TMP("TIUI",$J,GPVAL,GPDATTIM,ADDMGPNT)=""
"RTN","TIUR2",43,0)
 . E  S ^TMP("TIUI",$J,PVAL,PDATTIM,ADDMPRNT)=""
"RTN","TIUR2",44,0)
 Q
"RTN","TIUR2",45,0)
 ;
"RTN","TIUR2",46,0)
SETLIST(TIUORDER,VALMCNT) ; Set items from ^TMP("TIUI",$J) into
"RTN","TIUR2",47,0)
 ;List Template list
"RTN","TIUR2",48,0)
 N SORTVAL,TIUDTM,TIUDA
"RTN","TIUR2",49,0)
 S SORTVAL=""
"RTN","TIUR2",50,0)
 F  S SORTVAL=$O(^TMP("TIUI",$J,SORTVAL),TIUORDER) Q:SORTVAL=""  D
"RTN","TIUR2",51,0)
 . S TIUDTM=0
"RTN","TIUR2",52,0)
 . F  S TIUDTM=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM)) Q:'TIUDTM  D
"RTN","TIUR2",53,0)
 . . S TIUDA=0
"RTN","TIUR2",54,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM,TIUDA)) Q:'TIUDA  D
"RTN","TIUR2",55,0)
 . . . D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIUR2",56,0)
 Q
"RTN","TIUR2",57,0)
 ;
"RTN","TIUR2",58,0)
PUTLIST(TIUPREF,TIUCLASS,STATUS,SCREEN) ; Puts elements in List Template list
"RTN","TIUR2",59,0)
 N TIUJ,TIUQ,TIUDA,TIUPICK,TIUORDER,TIUEXPKD,TIUSFLD
"RTN","TIUR2",60,0)
 S VALMCNT=0
"RTN","TIUR2",61,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIUR2",62,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIUR2",63,0)
 S TIUORDER=$S($P(TIUPREF,U,4)="A":1,1:-1) ;A for ascending
"RTN","TIUR2",64,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIUR2",65,0)
 S TIUQ="" F  S TIUQ=$O(^TMP("TIUI",$J,TIUQ)) Q:TIUQ']""  D
"RTN","TIUR2",66,0)
 . S TIUJ=0 F  S TIUJ=$O(^TMP("TIUI",$J,TIUQ,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUR2",67,0)
 . . S TIUDA=0
"RTN","TIUR2",68,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUR2",69,0)
 . . . D REPLACE(TIUDA,TIUQ,TIUSFLD,TIUJ,.TIUEXPKD)
"RTN","TIUR2",70,0)
 D SETLIST(TIUORDER,.VALMCNT)
"RTN","TIUR2",71,0)
 S ^TMP("TIUR",$J,0)=+$G(VALMCNT)_U_STATUS("WORDS")
"RTN","TIUR2",72,0)
 S TIUJ=0,SCREEN="" F  S TIUJ=$O(SCREEN(TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUR2",73,0)
 . S SCREEN=$G(SCREEN)_$S(TIUJ>1:";",1:U)_SCREEN(TIUJ)
"RTN","TIUR2",74,0)
 S ^TMP("TIUR",$J,0)=^TMP("TIUR",$J,0)_$G(SCREEN)
"RTN","TIUR2",75,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIUR2",76,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(VALMCNT)
"RTN","TIUR2",77,0)
 I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIUR2",78,0)
 I +$G(VALMCNT)'>0 D
"RTN","TIUR2",79,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIUR2",80,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIUR2",81,0)
 . S ^TMP("TIUR",$J,"IDX",1,0)="" ; User can't select lines 1 or 2
"RTN","TIUR2",82,0)
 . S ^TMP("TIUR",$J,"IDX",2,0)=""
"RTN","TIUR2",83,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D EXPANDKD(.TIUEXPKD,STATUS("WORDS"))
"RTN","TIUR2",84,0)
 Q
"RTN","TIUR2",85,0)
 ;
"RTN","TIUR2",86,0)
EXPANDKD(TIUEXPKD,STATWORD,CONTEXT) ; Expand items to show kids that meet
"RTN","TIUR2",87,0)
 ;search criteria.
"RTN","TIUR2",88,0)
 ; Requires array TIUEXPKD, requires VALMCNT
"RTN","TIUR2",89,0)
 ; Requires nonnull: STATWORD (from TIUR1) or CONTEXT (from TIUROR).
"RTN","TIUR2",90,0)
 N TIUEXP2,YESEXPD,LINENO,HELP,TIUTWO
"RTN","TIUR2",91,0)
 ; -- Expand only for status unsigned or uncosigned, & not for "ALL":
"RTN","TIUR2",92,0)
 I STATWORD]"" Q:((STATWORD["ALL")!((STATWORD'["UNSIGNED")&(STATWORD'["UNCOSIGNED")))
"RTN","TIUR2",93,0)
 I $G(CONTEXT) Q:((CONTEXT'=2)&(CONTEXT'=3))  ;unsigned, uncosigned
"RTN","TIUR2",94,0)
 I (5*TIUEXPKD+$G(VALMCNT))>50 D  Q:'YESEXPD
"RTN","TIUR2",95,0)
 . W !!,"      There are ",TIUEXPKD," items (Interdisciplinary Notes, Addenda) to expand",!,"        in a list of ",VALMCNT," items."
"RTN","TIUR2",96,0)
 . S HELP="NO saves time building the list, but 'hides' relevant items under their parent until you expand the parent yourself."
"RTN","TIUR2",97,0)
 . S YESEXPD=$$READ^TIUU("Y","  Shall I take the extra time to expand them before I list them","NO",HELP)
"RTN","TIUR2",98,0)
 D LOAD^TIUROR1(.TIUEXPKD,.TIUEXP2)
"RTN","TIUR2",99,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR2",100,0)
 ; Try again if not in list til expanded once:
"RTN","TIUR2",101,0)
 ; (Can't use BREATHE^TIUROR1 again since it COLLAPSES now.)
"RTN","TIUR2",102,0)
 Q:'$D(TIUEXP2)
"RTN","TIUR2",103,0)
 S TIUDA=0
"RTN","TIUR2",104,0)
 F  S TIUDA=$O(TIUEXP2(TIUDA)) Q:'TIUDA  D
"RTN","TIUR2",105,0)
 . S LINENO=$O(^TMP("TIUR",$J,"IEN",TIUDA,0))
"RTN","TIUR2",106,0)
 . Q:'LINENO
"RTN","TIUR2",107,0)
 . S TIUTWO(LINENO)=""
"RTN","TIUR2",108,0)
 S LINENO=VALMCNT+1
"RTN","TIUR2",109,0)
 F  S LINENO=$O(TIUTWO(LINENO),-1) Q:'LINENO  D
"RTN","TIUR2",110,0)
 . D BREATHE^TIURL1(LINENO,1)
"RTN","TIUR2",111,0)
 Q
"RTN","TIUR2",112,0)
 ;
"RTN","TIUR2",113,0)
ADDELMNT(TIUDA,TIUCNT,APPEND) ; Add each element to the list
"RTN","TIUR2",114,0)
 N PT,ADT,DDT,AUT,AMD,EDT,SDT,XDT,TIULST4
"RTN","TIUR2",115,0)
 N TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,TIULI,STATX,DOC
"RTN","TIUR2",116,0)
 N PREFIX,TIUGDATA
"RTN","TIUR2",117,0)
 I '$D(^TIU(8925,TIUDA,0)) Q
"RTN","TIUR2",118,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIUR2",119,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1)
"RTN","TIUR2",120,0)
 . S TIUCNT=0
"RTN","TIUR2",121,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIUR2",122,0)
 S TIUD13=$G(^TIU(8925,TIUDA,13)),TIUD15=$G(^TIU(8925,TIUDA,15))
"RTN","TIUR2",123,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIUR2",124,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIUR2",125,0)
 S PREFIX=$$PREFIX^TIULA2(TIUDA,0)
"RTN","TIUR2",126,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIUR2",127,0)
 S TIULI=$E(PT)
"RTN","TIUR2",128,0)
 S PT=PREFIX_PT
"RTN","TIUR2",129,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIUR2",130,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIUR2",131,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIUR2",132,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIUR2",133,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIUR2",134,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIUR2",135,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIUR2",136,0)
 S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIUR2",137,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY")
"RTN","TIUR2",138,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIUR2",139,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIUR2",140,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIUR2",141,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUR2",142,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIUR2",143,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIUR2",144,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIUR2",145,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIUR2",146,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"REF DATE")
"RTN","TIUR2",147,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIUR2",148,0)
 S TIUREC=$$SETFLD^VALM1(SDT,TIUREC,"SIG DATE")
"RTN","TIUR2",149,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIUR2",150,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"COSIGNER")
"RTN","TIUR2",151,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIUR2",152,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W:TIUCNT#10'>0 "."
"RTN","TIUR2",153,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_TIUDA_U_PREFIX
"RTN","TIUR2",154,0)
 S ^TMP("TIUR",$J,"IEN",TIUDA,TIUCNT)="" ;MARGY 11/11/00
"RTN","TIUR2",155,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA,TIUD0)
"RTN","TIUR2",156,0)
 I TIUGDATA S ^TMP("TIUR",$J,"IDDATA",TIUDA)=TIUGDATA
"RTN","TIUR2",157,0)
 I +$G(APPEND) D
"RTN","TIUR2",158,0)
 . D RESTORE^VALM10(TIUCNT)
"RTN","TIUR2",159,0)
 . D CNTRL^VALM10(TIUCNT,1,$G(VALM("RM")),IOINHI,IOINORM),HDR^TIURH
"RTN","TIUR2",160,0)
 . S VALMSG="** Item(s) #"_$$ITMLIST(TIUCNT,$G(VALMSG))_" Added **"
"RTN","TIUR2",161,0)
 . S $P(^TMP("TIUR",$J,0),U)=TIUCNT
"RTN","TIUR2",162,0)
 . S $P(^TMP("TIUR",$J,"#"),":",2)=TIUCNT
"RTN","TIUR2",163,0)
 . S VALMCNT=TIUCNT
"RTN","TIUR2",164,0)
 . I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIUR2",165,0)
 Q
"RTN","TIUR2",166,0)
ITMLIST(TIUITM,TIUMSG) ; Add Message
"RTN","TIUR2",167,0)
 N TIULIST
"RTN","TIUR2",168,0)
 I $E($G(TIUMSG),1,7)'="** Item" S TIULIST=TIUITM G ITMLISTX
"RTN","TIUR2",169,0)
 S TIULIST=$P($P($G(TIUMSG)," Added **"),"#",2)_" & "_TIUITM
"RTN","TIUR2",170,0)
ITMLISTX Q $G(TIULIST)
"RTN","TIUR2",171,0)
 Q
"RTN","TIURA")
0^42^B55230625
"RTN","TIURA",1,0)
TIURA ; SLC/JER - Review screen actions ; 7-MAR-2001 09:12:29
"RTN","TIURA",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,10,20,79,88,58,100**;Jun 20, 1997
"RTN","TIURA",3,0)
 ; 6/20/00: Split rtn into TIURA and TIURA2, with DISPLAY,
"RTN","TIURA",4,0)
 ; BROWSE, and BROWS1 going into TIURA2.
"RTN","TIURA",5,0)
EDIT ; Edit Documents
"RTN","TIURA",6,0)
 N TIUDA,DFN,TIUDDT,TIUDATA,TIUCHNG,TIUEDIT,TIUI,DIROUT,TIUDAARY
"RTN","TIURA",7,0)
 N TIULST,MSGVERB
"RTN","TIURA",8,0)
 S TIUI=0
"RTN","TIURA",9,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA",10,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA",11,0)
 . N RSTRCTD
"RTN","TIURA",12,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA",13,0)
 . D CLEAR^VALM1 W !!,"Editing #",+TIUDATA
"RTN","TIURA",14,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA",15,0)
 . I RSTRCTD D  Q
"RTN","TIURA",16,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURA",17,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA",18,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURA",19,0)
 . S TIUCHNG=0
"RTN","TIURA",20,0)
 . I +$D(^TIU(8925,+TIUDA,0)) D EDIT1
"RTN","TIURA",21,0)
 . I +$G(TIUCHNG) D
"RTN","TIURA",22,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURA",23,0)
 ; -- Update or Rebuild list, restore video: --
"RTN","TIURA",24,0)
 I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURA",25,0)
 E  S TIUCHNG("UPDATE")=1
"RTN","TIURA",26,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURA",27,0)
 S VALMBCK="R"
"RTN","TIURA",28,0)
 S MSGVERB=$S($G(TIUCHNG("ADDM")):"edited/addended",1:"edited")
"RTN","TIURA",29,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,MSGVERB)
"RTN","TIURA",30,0)
 Q
"RTN","TIURA",31,0)
EDIT1 ; Single record edit
"RTN","TIURA",32,0)
 ; Receives TIUDA
"RTN","TIURA",33,0)
 N %X,%Y,C,D,D0,DDWTMP,DFN,DI,DIC,TIUEDIT,TIUMSG,TIUQUIT,TIUADD,TIUREL
"RTN","TIURA",34,0)
 N TIUTYP,TIUT0,TIUDPRM,TIULDT,DIWESUB,TIU,TIUCMMTX
"RTN","TIURA",35,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIURA",36,0)
 I '+$G(TIUDA) W !,"No Documents selected." H 2 Q
"RTN","TIURA",37,0)
 ; Evaluate edit privilege
"RTN","TIURA",38,0)
 S TIUEDIT=$$CANDO^TIULP(TIUDA,"EDIT RECORD")
"RTN","TIURA",39,0)
 ; if 'canedit, offer explanation, and let add addendum
"RTN","TIURA",40,0)
 I '+TIUEDIT D  Q
"RTN","TIURA",41,0)
 . K ^TIU(8925,"ASAVE",DUZ,TIUDA)
"RTN","TIURA",42,0)
 . W !!,$C(7),$P(TIUEDIT,U,2),!
"RTN","TIURA",43,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIURA",44,0)
 . D ADDENDUM^TIUADD(TIUDA,"",.TIUCHNG)
"RTN","TIURA",45,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0)),TIUT0=$G(^TIU(8925.1,+TIUTYP,0))
"RTN","TIURA",46,0)
 S TIUTYP(1)="1^"_+TIUTYP_U_$P(TIUT0,U,3)_U
"RTN","TIURA",47,0)
 S DFN=$P($G(^TIU(8925,+TIUDA,0)),U,2),TIULDT=$P(^(0),U,8)
"RTN","TIURA",48,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIURA",49,0)
 S DIWESUB="Patient: "_$G(TIU("PNM"))
"RTN","TIURA",50,0)
 D DIE^TIUEDI4(TIUDA,.TIUQUIT,.TIUCHNG) ; **100**
"RTN","TIURA",51,0)
 K ^TIU(8925,"ASAVE",DUZ,TIUDA)
"RTN","TIURA",52,0)
 I +$G(TIUCPYNG),+$G(TIUQUIT) D DELETE^TIUEDIT(TIUDA,0,"",1) Q
"RTN","TIURA",53,0)
 Q:+$G(TIUQUIT)=2
"RTN","TIURA",54,0)
 I $$EMPTYDOC^TIULF(TIUDA) D DELETE^TIUEDIT(TIUDA,0) S TIUCHNG("DELETE")=1 H 2 Q
"RTN","TIURA",55,0)
 Q:+$G(TIUQUIT)
"RTN","TIURA",56,0)
 I +$G(TIU("STOP")) D DEFER^TIUVSIT(TIUDA,TIU("STOP")) I 1
"RTN","TIURA",57,0)
 E  I +$P($G(^TIU(8925,+TIUDA,0)),U,3)'>0 D QUE^TIUPXAP1
"RTN","TIURA",58,0)
 ; - Commit proc -
"RTN","TIURA",59,0)
 S TIUCMMTX=$$COMMIT^TIULC1(+$P(TIUTYP(1),U,2))
"RTN","TIURA",60,0)
 I TIUCMMTX]"" D
"RTN","TIURA",61,0)
 . N DA S DA=TIUDA X TIUCMMTX
"RTN","TIURA",62,0)
 ;   i. Execute RELEASE logic
"RTN","TIURA",63,0)
 D RELEASE^TIUT(+TIUDA)
"RTN","TIURA",64,0)
 ;  ii. Execute VERIFICATION logic
"RTN","TIURA",65,0)
 D VERIFY^TIUT(+TIUDA)
"RTN","TIURA",66,0)
 ; iii. Execute ES logic
"RTN","TIURA",67,0)
 D EDSIG^TIURS(+TIUDA,"",1)
"RTN","TIURA",68,0)
 ;  iv. If document is an ADDENDUM process alert
"RTN","TIURA",69,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D SENDADD^TIUALRT(+TIUDA)
"RTN","TIURA",70,0)
 I $D(^TMP("TIUR",$J,"CTXT")),(+$P($G(^TIU(8925,+TIUDA,0)),U,5)'<6) S VALMBCK="Q"
"RTN","TIURA",71,0)
 Q
"RTN","TIURA",72,0)
PRINT ; Print selected documents
"RTN","TIURA",73,0)
 N DFN,TIUDA,TIUDARR,TIUDATA,TIUI,DIROUT,TIUDE,POP,TIUPFLG
"RTN","TIURA",74,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0)) G:$D(VALMY)'>9 PRINTX
"RTN","TIURA",75,0)
 D CLEAR^VALM1
"RTN","TIURA",76,0)
 D PRNTSCRN^TIURA2(.VALMY)
"RTN","TIURA",77,0)
 I '$D(VALMY) D  G PRINTX
"RTN","TIURA",78,0)
 . W !!,"No Printable Documents Remain in your List.",!
"RTN","TIURA",79,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIURA",80,0)
 I +$$CHARTANY^TIURA1(.VALMY) S TIUPFLG=$$FLAG^TIUPRPN3
"RTN","TIURA",81,0)
 S TIUDEV=$$DEVICE^TIUDEV(.IO) ; Get Device/allow queueing
"RTN","TIURA",82,0)
 I $S(IO']"":1,TIUDEV']"":1,1:0) G PRINTX
"RTN","TIURA",83,0)
 I $D(IO("Q")) D QUE^TIUDEV("PRINTN^TIURA",TIUDEV) G PRINTX
"RTN","TIURA",84,0)
 D PRINTN
"RTN","TIURA",85,0)
PRINTX N IOSTBM D ^%ZISC,FIXLSTNW^TIULM
"RTN","TIURA",86,0)
 K VALMY S VALMBCK="R"
"RTN","TIURA",87,0)
 Q
"RTN","TIURA",88,0)
PRINTN ; Loop through selected doc's & invoke print code
"RTN","TIURA",89,0)
 N TIUI,TIUTYP,TIUDARR,DFN K ^TMP("TIUPR",$J)
"RTN","TIURA",90,0)
 N ARRAYDA
"RTN","TIURA",91,0)
 U IO
"RTN","TIURA",92,0)
 S TIUI=0
"RTN","TIURA",93,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA",94,0)
 . N TIUPMTHD,TIUDTYP,TIUPFHDR,TIUPFNBR,TIUPGRP,TIUPRINT,TIUFLAG
"RTN","TIURA",95,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA",96,0)
 . S TIUDA=+$P(TIUDATA,U,2),TIUTYP=$P(^TIU(8925,TIUDA,0),U)
"RTN","TIURA",97,0)
 . S ARRAYDA(TIUDA)=""
"RTN","TIURA",98,0)
 . ; -- If TIUDA is an addendum, print its parent instead,
"RTN","TIURA",99,0)
 . ;    or quit if the parent has already been printed: --
"RTN","TIURA",100,0)
 . I +$$ISADDNDM^TIULC1(TIUDA) D  Q:'TIUDA
"RTN","TIURA",101,0)
 . . S TIUDA=+$P($G(^TIU(8925,TIUDA,0)),U,6)
"RTN","TIURA",102,0)
 . . I $D(ARRAYDA(TIUDA)) S TIUDA=0 Q
"RTN","TIURA",103,0)
 . . S TIUDTYP=+$G(^TIU(8925,TIUDA,0))
"RTN","TIURA",104,0)
 . ; -- If TIUDA is an ID kid, print its parent instead,
"RTN","TIURA",105,0)
 . ;    or quit if the parent has already been printed: --
"RTN","TIURA",106,0)
 . I $G(^TIU(8925,TIUDA,21)) D  Q:'TIUDA
"RTN","TIURA",107,0)
 . . S TIUDA=^TIU(8925,TIUDA,21)
"RTN","TIURA",108,0)
 . . I $D(ARRAYDA(TIUDA)) S TIUDA=0 Q
"RTN","TIURA",109,0)
 . . S TIUDTYP=+$G(^TIU(8925,TIUDA,0))
"RTN","TIURA",110,0)
 . S TIUPRINT=$$CANDO^TIULP(TIUDA,"PRINT RECORD")
"RTN","TIURA",111,0)
 . I +TIUPRINT'>0 D  Q  ; Exclude records user can't print
"RTN","TIURA",112,0)
 . . W !!,"Item #",TIUI,": ",!,$P(TIUPRINT,U,2),!
"RTN","TIURA",113,0)
 . . I IO=IO(0),'$D(ZTQUEUED),$$READ^TIUU("EA","RETURN to continue...")
"RTN","TIURA",114,0)
 . I +$G(TIUPFLG) S TIUFLAG=+$$CHARTONE^TIURA1(TIUDA)
"RTN","TIURA",115,0)
 . S DFN=$P($G(^TIU(8925,+TIUDA,0)),U,2)
"RTN","TIURA",116,0)
 . I +TIUTYP,'$G(TIUDTYP) D
"RTN","TIURA",117,0)
 . . S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYP)
"RTN","TIURA",118,0)
 . . S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYP)
"RTN","TIURA",119,0)
 . . S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYP)
"RTN","TIURA",120,0)
 . . S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYP)
"RTN","TIURA",121,0)
 . I +$G(TIUDTYP) S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUDTYP),TIUPGRP=$$PRNTGRP^TIULG(+TIUDTYP),TIUPFHDR=$$PRNTHDR^TIULG(+TIUDTYP),TIUPFNBR=$$PRNTNBR^TIULG(+TIUDTYP)
"RTN","TIURA",122,0)
 . I $G(TIUPMTHD)]"",+$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") S TIUDARR(TIUPMTHD,$G(TIUPGRP)_"$"_TIUPFHDR_";"_DFN,TIUI,TIUDA)=TIUPFNBR
"RTN","TIURA",123,0)
 . E  S TIUDARR(TIUPMTHD,DFN,TIUI,TIUDA)=""
"RTN","TIURA",124,0)
 . D:'$D(ZTQUEUED) RESTORE^VALM10(+TIUI)
"RTN","TIURA",125,0)
 S TIUPMTHD="" F  S TIUPMTHD=$O(TIUDARR(TIUPMTHD)) Q:TIUPMTHD=""  D
"RTN","TIURA",126,0)
 . D PRNTDOC(TIUPMTHD,.TIUDARR)
"RTN","TIURA",127,0)
 Q
"RTN","TIURA",128,0)
PRINT1 ; Print a single document
"RTN","TIURA",129,0)
 N TIUDARR,TIUDEV,TIUTYP,DFN,TIUPMTHD,TIUD0,TIUDPRM,TIUFLAG,TIUDTYP
"RTN","TIURA",130,0)
 N TIUPGRP,TIUPFHDR,TIUPFNBR,TIUPRINT,POP,TIUTMPDA
"RTN","TIURA",131,0)
 D CLEAR^VALM1
"RTN","TIURA",132,0)
 S TIUTMPDA=TIUDA
"RTN","TIURA",133,0)
 I +$$ISADDNDM^TIULC1(TIUTMPDA) D
"RTN","TIURA",134,0)
 . S TIUTMPDA=+$P($G(^TIU(8925,TIUTMPDA,0)),U,6)
"RTN","TIURA",135,0)
 . S TIUDTYP=+$G(^TIU(8925,TIUTMPDA,0))
"RTN","TIURA",136,0)
 I $G(^TIU(8925,TIUTMPDA,21)) D
"RTN","TIURA",137,0)
 . S TIUTMPDA=^TIU(8925,TIUTMPDA,21)
"RTN","TIURA",138,0)
 . S TIUDTYP=+$G(^TIU(8925,TIUTMPDA,0))
"RTN","TIURA",139,0)
 S TIUPRINT=$$CANDO^TIULP(TIUTMPDA,"PRINT RECORD")
"RTN","TIURA",140,0)
 I +TIUPRINT'>0 D  Q
"RTN","TIURA",141,0)
 . W !!,$C(7),$P(TIUPRINT,U,2),!
"RTN","TIURA",142,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA",143,0)
 I +$G(TIUDTYP) D
"RTN","TIURA",144,0)
 . S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUDTYP)
"RTN","TIURA",145,0)
 . S TIUPGRP=$$PRNTGRP^TIULG(+TIUDTYP)
"RTN","TIURA",146,0)
 . S TIUPFHDR=$$PRNTHDR^TIULG(+TIUDTYP)
"RTN","TIURA",147,0)
 . S TIUPFNBR=$$PRNTNBR^TIULG(+TIUDTYP)
"RTN","TIURA",148,0)
 . D DOCPRM^TIULC1(+TIUDTYP,.TIUDPRM,TIUTMPDA)
"RTN","TIURA",149,0)
 S TIUD0=$G(^TIU(8925,TIUTMPDA,0))
"RTN","TIURA",150,0)
 S TIUTYP=$P(TIUD0,U),DFN=$P(TIUD0,U,2)
"RTN","TIURA",151,0)
 I +TIUTYP'>0 Q
"RTN","TIURA",152,0)
 I '$G(TIUDTYP) D
"RTN","TIURA",153,0)
 . S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYP)
"RTN","TIURA",154,0)
 . S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYP)
"RTN","TIURA",155,0)
 . S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYP)
"RTN","TIURA",156,0)
 . S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYP)
"RTN","TIURA",157,0)
 . D DOCPRM^TIULC1(+TIUTYP,.TIUDPRM,TIUTMPDA)
"RTN","TIURA",158,0)
 I +$P($G(TIUDPRM(0)),U,9) S TIUFLAG=$$FLAG^TIUPRPN3
"RTN","TIURA",159,0)
 I (+$P($G(TIUDPRM(0)),U,9)'>0),+$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION") S TIUFLAG=$$FLAG^TIUPRPN3
"RTN","TIURA",160,0)
 I $G(TIUPMTHD)]"",+$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") S TIUDARR(TIUPMTHD,$G(TIUPGRP)_"$"_TIUPFHDR_";"_DFN,1,TIUTMPDA)=TIUPFNBR
"RTN","TIURA",161,0)
 E  S TIUDARR(TIUPMTHD,DFN,1,TIUTMPDA)=""
"RTN","TIURA",162,0)
 I $G(TIUPMTHD)']"" W !,$C(7),"No Print Method Defined for ",$P($G(^TIU(8925.1,+TIUTYP,0)),U) H 2 G PRINT1X
"RTN","TIURA",163,0)
 S TIUDEV=$$DEVICE^TIUDEV(.IO) ; Get Device
"RTN","TIURA",164,0)
 I $S(IO']"":1,TIUDEV']"":1,1:0) G PRINT1X
"RTN","TIURA",165,0)
 I $D(IO("Q")) D QUE^TIUDEV("PRINTQ^TIURA",TIUDEV) G PRINT1X
"RTN","TIURA",166,0)
 D PRINTQ
"RTN","TIURA",167,0)
PRINT1X D ^%ZISC
"RTN","TIURA",168,0)
 Q
"RTN","TIURA",169,0)
PRINTQ ; Queued document print
"RTN","TIURA",170,0)
 D PRNTDOC(TIUPMTHD,.TIUDARR)
"RTN","TIURA",171,0)
 Q
"RTN","TIURA",172,0)
PRNTDOC(TIUPMTHD,TIUDARR) ; Print a single document
"RTN","TIURA",173,0)
 ; Receives TIUPMTHD & TIUDARR
"RTN","TIURA",174,0)
 N TIUDA
"RTN","TIURA",175,0)
 I '+$D(TIUDARR) W !,"No Documents selected." Q
"RTN","TIURA",176,0)
 M ^TMP("TIUPR",$J)=TIUDARR(TIUPMTHD)
"RTN","TIURA",177,0)
 I TIUPMTHD']"" D  G PRNTDOCX
"RTN","TIURA",178,0)
 . W !!,"No Print Method Defined for ",$P(TIUTYP,U,2) H 2
"RTN","TIURA",179,0)
 X TIUPMTHD
"RTN","TIURA",180,0)
PRNTDOCX K ^TMP("TIUPR",$J)
"RTN","TIURA",181,0)
 Q
"RTN","TIURA",182,0)
BROWS1(TIULTMP) ; -- Call to BROWS1 for backward compatibility
"RTN","TIURA",183,0)
 D BROWS1^TIURA2(TIULTMP,TIUDA)
"RTN","TIURA",184,0)
 Q
"RTN","TIURA1")
0^50^B41686413
"RTN","TIURA1",1,0)
TIURA1 ; SLC/JER - Review screen actions ;3/5/01
"RTN","TIURA1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**20,88,58,100**;Jun 20, 1997
"RTN","TIURA1",3,0)
ADDEND ; Make addenda
"RTN","TIURA1",4,0)
 N TIUDA,TIUDATA,TIUCHNG,TIUI,DIROUT,TIULST,TIUDAARY
"RTN","TIURA1",5,0)
 S TIUI=0
"RTN","TIURA1",6,0)
 ; -- Get docmt to addend: --
"RTN","TIURA1",7,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA1",8,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA1",9,0)
 . N RSTRCTD
"RTN","TIURA1",10,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA1",11,0)
 . D CLEAR^VALM1 W !!,"Making an addendum for #",+TIUDATA
"RTN","TIURA1",12,0)
 . ; -- Addend it: --
"RTN","TIURA1",13,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA1",14,0)
 . I RSTRCTD D  Q
"RTN","TIURA1",15,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURA1",16,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA1",17,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURA1",18,0)
 . S TIUCHNG=0
"RTN","TIURA1",19,0)
 . I +$D(^TIU(8925,+TIUDA,0)) D ADDEND1
"RTN","TIURA1",20,0)
 . I +$G(TIUCHNG) D
"RTN","TIURA1",21,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURA1",22,0)
 ; -- Update or Rebuild list, restore video:
"RTN","TIURA1",23,0)
 I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURA1",24,0)
 E  S TIUCHNG("UPDATE")=1 ; user may have edited existing addm
"RTN","TIURA1",25,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURA1",26,0)
 S VALMBCK="R"
"RTN","TIURA1",27,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"addended")
"RTN","TIURA1",28,0)
 Q
"RTN","TIURA1",29,0)
ADDEND1 ; Single record Addendum
"RTN","TIURA1",30,0)
 ; Receives TIUDA
"RTN","TIURA1",31,0)
 N %X,%Y,C,D,D0,DDWTMP,DFN,DI,DIC,TIUEDIT,TIUMSG,TIUQUIT,TIUADD,TIUREL
"RTN","TIURA1",32,0)
 N TIUTYP,TIUT0,TIUDPRM
"RTN","TIURA1",33,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIURA1",34,0)
 I '+$G(TIUDA) W !,"No Documents selected." H 2 Q
"RTN","TIURA1",35,0)
 D ADDENDUM^TIUADD(TIUDA,"",.TIUCHNG,1)
"RTN","TIURA1",36,0)
 Q
"RTN","TIURA1",37,0)
NAME ; Identify signer(s)
"RTN","TIURA1",38,0)
 N TIUCHNG,TIUDA,DFN,TIU,TIUDATA,TIUEDIT,TIUI,TIUY,TIULST,Y,DIROUT
"RTN","TIURA1",39,0)
 N TIUDAARY
"RTN","TIURA1",40,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA1",41,0)
 S TIUI=0
"RTN","TIURA1",42,0)
 I +$O(VALMY(0)) D FULL^VALM1
"RTN","TIURA1",43,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA1",44,0)
 . N TIU,VALMY,XQORM,RSTRCTD
"RTN","TIURA1",45,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA1",46,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA1",47,0)
 . I RSTRCTD D  Q
"RTN","TIURA1",48,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURA1",49,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA1",50,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURA1",51,0)
 . S TIUCHNG=0
"RTN","TIURA1",52,0)
 . D SIGNER ; SIGNER initializes TIUCHNG to 0
"RTN","TIURA1",53,0)
 . I +$G(TIUCHNG) S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURA1",54,0)
NAMEX ; Revise list and cycle back as appropriate
"RTN","TIURA1",55,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURA1",56,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURA1",57,0)
 S VALMBCK="R"
"RTN","TIURA1",58,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"Signers identified/edited")
"RTN","TIURA1",59,0)
 Q
"RTN","TIURA1",60,0)
SIGNER ; Link selected document to additional signers
"RTN","TIURA1",61,0)
 ; Receives TIUDA as pointer to document record
"RTN","TIURA1",62,0)
 N TIULIST,TIUI,TIUMORE,TIUCANID S (TIUCHNG,TIUI)=0,TIUMORE=1
"RTN","TIURA1",63,0)
 S TIUCANID=$$CANDO^TIULP(TIUDA,"IDENTIFY SIGNERS")
"RTN","TIURA1",64,0)
 I +$$MAYCHNG(TIUDA) D  Q:'TIUMORE
"RTN","TIURA1",65,0)
 . N TIUPRMT S TIUPRMT="Do you Wish to Identify Additional Signers"
"RTN","TIURA1",66,0)
 . D CHNGCSNR(TIUDA) S TIUCHNG=1
"RTN","TIURA1",67,0)
 . I +$G(TIUCANID) S TIUMORE=$$READ^TIUU("YO",TIUPRMT,"NO")
"RTN","TIURA1",68,0)
 . I +$G(TIUCANID)'>0 S TIUMORE=0
"RTN","TIURA1",69,0)
 I +$G(TIUCANID)'>0 D  Q
"RTN","TIURA1",70,0)
 . W !!,$C(7),$P(TIUCANID,U,2),! ; Echo denial message
"RTN","TIURA1",71,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA1",72,0)
 I +$O(^TIU(8925.7,"B",TIUDA,0)) D  Q:+TIUMORE'>0
"RTN","TIURA1",73,0)
 . N DIDEL,DIE,DA,DR,TIUY,TIUPRMT
"RTN","TIURA1",74,0)
 . W !,"This Document Already has Additional Expected Signers."
"RTN","TIURA1",75,0)
 . D XTRASIGN^TIULX(.TIUY,TIUDA) Q:+$O(TIUY(0))'>0
"RTN","TIURA1",76,0)
 . S DA=+$$ASKSIGN^TIULX(.TIUY) Q:+DA'>0
"RTN","TIURA1",77,0)
 . S (DIE,DIDEL)=8925.7,DR=".03;I +X>0 S Y=""@1"";.01///@;@1" D ^DIE
"RTN","TIURA1",78,0)
 . D SEND^TIUALRT(TIUDA) S TIUCHNG=1
"RTN","TIURA1",79,0)
 . S TIUPRMT="Do You Wish to Identify More Additional Signers"
"RTN","TIURA1",80,0)
 . S TIUMORE=$$READ^TIUU("Y",TIUPRMT,"NO")
"RTN","TIURA1",81,0)
 D PERSEL(.TIULIST,TIUDA) Q:+$D(TIULIST)'>9
"RTN","TIURA1",82,0)
 F  S TIUI=$O(TIULIST(TIUI)) Q:+TIUI'>0  D
"RTN","TIURA1",83,0)
 . N DA,DIC,DIE,DLAYGO,DR,X,Y
"RTN","TIURA1",84,0)
 . S X=""""_"`"_TIUDA_"""",(DIC,DLAYGO)=8925.7,DIC(0)="LX" D ^DIC Q:+Y'>0
"RTN","TIURA1",85,0)
 . S DIE=DIC
"RTN","TIURA1",86,0)
 . S DR=".02////"_0_";.03////"_+$G(TIULIST(TIUI))
"RTN","TIURA1",87,0)
 . D ^DIE
"RTN","TIURA1",88,0)
 . W !,$$SIGNAME^TIULS(+TIULIST(TIUI))," Added as expected signer..." H 2
"RTN","TIURA1",89,0)
 . D SEND^TIUALRT(TIUDA)
"RTN","TIURA1",90,0)
 . S TIUCHNG=1 K VALMY(TIUI)
"RTN","TIURA1",91,0)
 Q
"RTN","TIURA1",92,0)
MAYCHNG(TIUDA) ; Boolean function - can cosigner be modified?
"RTN","TIURA1",93,0)
 N TIUD0,TIUD12,TIUY,TIUAUTH,TIUESNR,TIUECSNR S TIUY=0
"RTN","TIURA1",94,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIURA1",95,0)
 S TIUAUTH=$P(TIUD12,U,2),TIUESNR=$P(TIUD12,U,4),TIUECSNR=$P(TIUD12,U,8)
"RTN","TIURA1",96,0)
 I +TIUECSNR,(+$P(TIUD0,U,5)<7) D
"RTN","TIURA1",97,0)
 . S TIUY=$S(DUZ=TIUAUTH:1,DUZ=TIUESNR:1,DUZ=TIUECSNR:1,1:0)
"RTN","TIURA1",98,0)
 Q TIUY
"RTN","TIURA1",99,0)
CHNGCSNR(DA) ; Change the expected cosigner
"RTN","TIURA1",100,0)
 N DR,DIE,X,Y
"RTN","TIURA1",101,0)
 W !,"You may change the expected cosigner, if you wish...",!
"RTN","TIURA1",102,0)
CHNGAGN S DIE=8925,DR="1208R" D ^DIE
"RTN","TIURA1",103,0)
 I +$P($G(^TIU(8925,DA,12)),U,8)'>0 W !,$C(7),"  Response Required." G CHNGAGN
"RTN","TIURA1",104,0)
 D SEND^TIUALRT(DA)
"RTN","TIURA1",105,0)
 Q
"RTN","TIURA1",106,0)
PERSEL(TIUY,TIUDA) ; Select a person
"RTN","TIURA1",107,0)
 N TIUQUIT,TIUPRSN,TIUI,TIUPRMT,TIUSCRN S (TIUI,TIUQUIT)=0
"RTN","TIURA1",108,0)
 W !!,"Specify other practitioners whose signatures will be  expected:",!
"RTN","TIURA1",109,0)
 F  D  Q:+TIUQUIT
"RTN","TIURA1",110,0)
 . S TIUI=TIUI+1,TIUPRMT=$J(TIUI,3)_")  "
"RTN","TIURA1",111,0)
 . S TIUSCRN="I +$$SCREEN^TIURA1(TIUDA,+Y)"
"RTN","TIURA1",112,0)
 . S TIUPRSN=$$READ^TIUU("PAO^200:AEMQ",TIUPRMT,"","",TIUSCRN)
"RTN","TIURA1",113,0)
 . I +TIUPRSN'>0 S TIUQUIT=1 Q
"RTN","TIURA1",114,0)
 . S TIUY(TIUI)=TIUPRSN
"RTN","TIURA1",115,0)
 W !
"RTN","TIURA1",116,0)
 Q
"RTN","TIURA1",117,0)
SCREEN(TIUDA,Y) ; Evaluate whether a person may be selected as a signer
"RTN","TIURA1",118,0)
 N TIUI,TIUY,TIUD0,TIUD12 S TIUY=1 ; most people may be selected
"RTN","TIURA1",119,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIURA1",120,0)
 ; A user may NOT select himself
"RTN","TIURA1",121,0)
 I Y=+$G(DUZ) S TIUY=0 G SCREENX
"RTN","TIURA1",122,0)
 ; Author may NOT be selected
"RTN","TIURA1",123,0)
 I Y=+$P(TIUD12,U,2) S TIUY=0 G SCREENX
"RTN","TIURA1",124,0)
 ; Expected Signer may NOT be selected
"RTN","TIURA1",125,0)
 I Y=+$P(TIUD12,U,4) S TIUY=0 G SCREENX
"RTN","TIURA1",126,0)
 ; Can't choose a terminated user
"RTN","TIURA1",127,0)
 I '+$$ACTIVE^XUSER(+Y) S TIUY=0 G SCREENX
"RTN","TIURA1",128,0)
 ; Can't name the same signer twice
"RTN","TIURA1",129,0)
 I +$O(^TIU(8925.7,"AE",+TIUDA,+Y,0)) S TIUY=0 G SCREENX
"RTN","TIURA1",130,0)
 S TIUI=0
"RTN","TIURA1",131,0)
 F  S TIUI=$O(TIULIST(TIUI)) Q:+TIUI'>0!(TIUY=0)  D
"RTN","TIURA1",132,0)
 . I +$G(TIULIST(TIUI))=+Y S TIUY=0
"RTN","TIURA1",133,0)
 I +TIUY=0 G SCREENX
"RTN","TIURA1",134,0)
 ; Expected Cosigner may NOT be selected
"RTN","TIURA1",135,0)
 I Y=+$P(TIUD12,U,8) S TIUY=0
"RTN","TIURA1",136,0)
SCREENX Q +$G(TIUY)
"RTN","TIURA1",137,0)
ENCNTR ; Enter/edit encounter data on demand
"RTN","TIURA1",138,0)
 N TIUCHNG,TIUDA,DFN,TIU,TIUDATA,TIUI,TIUY,TIULST,Y,DIROUT
"RTN","TIURA1",139,0)
 N TIUDAARY
"RTN","TIURA1",140,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA1",141,0)
 S TIUI=0
"RTN","TIURA1",142,0)
 I +$O(VALMY(0)) D FULL^VALM1
"RTN","TIURA1",143,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA1",144,0)
 . N TIU,VALMY,XQORM,RSTRCTD
"RTN","TIURA1",145,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA1",146,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA1",147,0)
 . I RSTRCTD D  Q
"RTN","TIURA1",148,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURA1",149,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA1",150,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURA1",151,0)
 . S TIUCHNG=0
"RTN","TIURA1",152,0)
 . D EDTENC^TIUPXAP2(TIUDA,.TIUCHNG)
"RTN","TIURA1",153,0)
 . I +$G(TIUCHNG) S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURA1",154,0)
ENCNTX ; Revise list and cycle back as appropriate
"RTN","TIURA1",155,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURA1",156,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURA1",157,0)
 S VALMBCK="R"
"RTN","TIURA1",158,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"Encounter Data Edited")
"RTN","TIURA1",159,0)
 Q
"RTN","TIURA1",160,0)
CHARTANY(VALMY) ; Can any of the selected items be printed for the chart?
"RTN","TIURA1",161,0)
 N TIUDATA,TIUDA,TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIURA1",162,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:+TIUY
"RTN","TIURA1",163,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA1",164,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURA1",165,0)
 . S TIUY=+$$CHARTONE(TIUDA)
"RTN","TIURA1",166,0)
 Q TIUY
"RTN","TIURA1",167,0)
CHARTONE(TIUDA) ; Can this document be printed for the chart?
"RTN","TIURA1",168,0)
 N TIUDTYP,TIUDPRM
"RTN","TIURA1",169,0)
 S TIUDTYP=+$G(^TIU(8925,TIUDA,0))
"RTN","TIURA1",170,0)
 D DOCPRM^TIULC1(TIUDTYP,.TIUDPRM,TIUDA)
"RTN","TIURA1",171,0)
 Q +$P(TIUDPRM(0),U,9)
"RTN","TIURA2")
0^43^B15791678
"RTN","TIURA2",1,0)
TIURA2 ; SLC/JER - More review screen actions ;2/26/01
"RTN","TIURA2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**88,58,100**;Jun 20, 1997
"RTN","TIURA2",3,0)
 ; 6/20/00: Moved DISPLAY, BROWSE, & BROWS1 from TIURA to TIURA2
"RTN","TIURA2",4,0)
DISPLAY ; Detailed Display
"RTN","TIURA2",5,0)
 N TIUDA,TIUD,TIUDATA,TIUI,Y,DIROUT,TIUQUIT,RSTRCTD
"RTN","TIURA2",6,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA2",7,0)
 S TIUI=0
"RTN","TIURA2",8,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(TIUQUIT)
"RTN","TIURA2",9,0)
 . N TIUVIEW
"RTN","TIURA2",10,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",11,0)
 . D CLEAR^VALM1
"RTN","TIURA2",12,0)
 . W !!,"Reviewing #",+TIUDATA
"RTN","TIURA2",13,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURA2",14,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURA2",15,0)
 . I +TIUVIEW'>0 D  Q
"RTN","TIURA2",16,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURA2",17,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",18,0)
 . . D RESTORE^VALM10(+TIUI)
"RTN","TIURA2",19,0)
 . S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA2",20,0)
 . I RSTRCTD D  Q
"RTN","TIURA2",21,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURA2",22,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",23,0)
 . . D RESTORE^VALM10(+TIUI)
"RTN","TIURA2",24,0)
 . D EN^TIUAUDIT
"RTN","TIURA2",25,0)
 . I +$G(TIUQUIT) D FIXLSTNW^TIULM Q
"RTN","TIURA2",26,0)
 . I TIUI'=$P($G(TIUGLINK),U,2) D RESTORE^VALM10(+TIUI) ; See rtn TIURL
"RTN","TIURA2",27,0)
 K VALMY S VALMBCK="R"
"RTN","TIURA2",28,0)
 Q
"RTN","TIURA2",29,0)
BROWSE(TIULTMP) ; Browse selected documents
"RTN","TIURA2",30,0)
 ; TIULTMP is list template name
"RTN","TIURA2",31,0)
 N TIUDA,DFN,TIU,TIUCHNG,TIUDATA,TIUI,Y,DIROUT,TIUQUIT
"RTN","TIURA2",32,0)
 N TIUGDATA
"RTN","TIURA2",33,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA2",34,0)
 S TIUI=0
"RTN","TIURA2",35,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(TIUQUIT)
"RTN","TIURA2",36,0)
 . N TIUVIEW,TIUGACT,RSTRCTD
"RTN","TIURA2",37,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",38,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURA2",39,0)
 . S TIUGDATA=$G(^TMP("TIUR",$J,"IDDATA",TIUDA)) ; ID note/entry
"RTN","TIURA2",40,0)
 . D CLEAR^VALM1
"RTN","TIURA2",41,0)
 . W !!,"Reviewing Item #",TIUI
"RTN","TIURA2",42,0)
 . S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA2",43,0)
 . I RSTRCTD D  Q
"RTN","TIURA2",44,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURA2",45,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",46,0)
 . D BROWS1(TIULTMP,TIUDA,TIUGDATA)
"RTN","TIURA2",47,0)
 ; -- Update or Rebuild list: --
"RTN","TIURA2",48,0)
 I $G(TIUCHNG("DELETE"))!$G(TIUCHNG("ADDM")) S TIUCHNG("RBLD")=1
"RTN","TIURA2",49,0)
 S TIUCHNG("UPDATE")=1 ; default
"RTN","TIURA2",50,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURA2",51,0)
 S VALMBCK="R"
"RTN","TIURA2",52,0)
 Q
"RTN","TIURA2",53,0)
GETSORT(PRMSORT,EXPSORT) ; Get order for ID entries
"RTN","TIURA2",54,0)
 Q $S($G(EXPSORT)'="":EXPSORT,1:PRMSORT)
"RTN","TIURA2",55,0)
 ;
"RTN","TIURA2",56,0)
BROWS1(TIULTMP,TIUDA,TIUGDATA) ; Browse single document
"RTN","TIURA2",57,0)
 ;  Calls EN^VALM
"RTN","TIURA2",58,0)
 N %DT,C,D0,DIQ2,FINISH,TIU,TIUVIEW
"RTN","TIURA2",59,0)
 I '$D(TIUGDATA) S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIURA2",60,0)
 I TIULTMP="TIU COMPLETE NOTES",$P(TIUGDATA,U,2) W !!,"You are completing the PARENT ENTRY of this interdisciplinary note."
"RTN","TIURA2",61,0)
 S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURA2",62,0)
 I +TIUVIEW'>0 D  Q
"RTN","TIURA2",63,0)
 . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURA2",64,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",65,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIURA2",66,0)
 D EN^VALM(TIULTMP)
"RTN","TIURA2",67,0)
 K ^TMP("TIUVIEW",$J)
"RTN","TIURA2",68,0)
 Q
"RTN","TIURA2",69,0)
 ;
"RTN","TIURA2",70,0)
EXPAND ; Expand/Collapse ID notes, Addenda in lists
"RTN","TIURA2",71,0)
 N TIUDNM,TIULNM,TIUSTAT
"RTN","TIURA2",72,0)
 D:'$D(VALMY) EN^VALM2(XQORNOD(0))
"RTN","TIURA2",73,0)
 I $D(VALMY) D EC^TIURECL(.VALMY)
"RTN","TIURA2",74,0)
 W !,"Refreshing the list."
"RTN","TIURA2",75,0)
 K VALMY
"RTN","TIURA2",76,0)
 S VALMCNT=+$G(@VALMAR@(0))
"RTN","TIURA2",77,0)
 S VALMBCK="R"
"RTN","TIURA2",78,0)
 Q
"RTN","TIURA2",79,0)
 ;
"RTN","TIURA2",80,0)
PRNTSCRN(VALMY) ; Evaluate whether a record may be printed
"RTN","TIURA2",81,0)
 N TIUI S TIUI=""
"RTN","TIURA2",82,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA2",83,0)
 . N TIUPMTHD,TIUDTYP,TIUPFHDR,TIUPFNBR,TIUPGRP,TIUPRINT,TIUFLAG,RSTRCTD
"RTN","TIURA2",84,0)
 . S RSTRCTD=0,TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",85,0)
 . S TIUDA=+$P(TIUDATA,U,2),TIUTYP=$P(^TIU(8925,TIUDA,0),U)
"RTN","TIURA2",86,0)
 . ; Evaluate whether user can print record
"RTN","TIURA2",87,0)
 . S TIUPRINT=$$CANDO^TIULP(TIUDA,"PRINT RECORD")
"RTN","TIURA2",88,0)
 . I +TIUPRINT'>0 D  Q
"RTN","TIURA2",89,0)
 . . W !!,"Item #",TIUI,": ",!,$P(TIUPRINT,U,2),!
"RTN","TIURA2",90,0)
 . . K VALMY(TIUI)
"RTN","TIURA2",91,0)
 . . I $$READ^TIUU("EA","RETURN to continue...")
"RTN","TIURA2",92,0)
 . ;-- Add Check for restricted record when available --
"RTN","TIURA2",93,0)
 . S DFN=+$P(^TIU(8925,TIUDA,0),U,2)
"RTN","TIURA2",94,0)
 . S RSTRCTD=$$PTRES^TIULRR(DFN)
"RTN","TIURA2",95,0)
 . I +RSTRCTD D  Q
"RTN","TIURA2",96,0)
 . . W !!,"Item #",TIUI," Removed from print list.",!
"RTN","TIURA2",97,0)
 . . K VALMY(TIUI)
"RTN","TIURA2",98,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIURA2",99,0)
 . I +$G(TIUPFLG) S TIUFLAG=+$$CHARTONE^TIURA1(TIUDA)
"RTN","TIURA2",100,0)
 Q
"RTN","TIURB")
0^36^B23339679
"RTN","TIURB",1,0)
TIURB ; SLC/JER - More Review Screen Actions ;2/26/01
"RTN","TIURB",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**4,32,52,78,58,100**;Jun 20, 1997
"RTN","TIURB",3,0)
 ; 9/28 Moved DELETE, DEL, DELTEXT, DIK to new rtn TIURB2
"RTN","TIURB",4,0)
AMEND ; Amendment action
"RTN","TIURB",5,0)
 N TIUDA,DFN,DIE,DR,TIU,TIUDATA,TIUI,TIUSIG,TIUY,X,X1,Y
"RTN","TIURB",6,0)
 N DIROUT,TIUCHNG,TIUDAARY,TIULST
"RTN","TIURB",7,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURB",8,0)
 S TIUI=0
"RTN","TIURB",9,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURB",10,0)
 . N RSTRCTD
"RTN","TIURB",11,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURB",12,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURB",13,0)
 . I RSTRCTD D  Q
"RTN","TIURB",14,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURB",15,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURB",16,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURB",17,0)
 . S TIUCHNG=0
"RTN","TIURB",18,0)
 . D AMEND1
"RTN","TIURB",19,0)
 . I $G(TIUCHNG) D
"RTN","TIURB",20,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURB",21,0)
 ; -- Update or Rebuild list, restore video:
"RTN","TIURB",22,0)
 S TIUCHNG("UPDATE")=1
"RTN","TIURB",23,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURB",24,0)
 S VALMBCK="R"
"RTN","TIURB",25,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"amended")
"RTN","TIURB",26,0)
 Q
"RTN","TIURB",27,0)
AMEND1 ; Single record amend
"RTN","TIURB",28,0)
 N TIUCMT,TIUT0,TIUTYP,TIUAMND,TIUSNM,TIUSBLK,TIUCSNM,TIUCSBLK,DIE,DR
"RTN","TIURB",29,0)
 N DA,DFN,DIWESUB,TIU
"RTN","TIURB",30,0)
 L +^TIU(8925,+TIUDA):1
"RTN","TIURB",31,0)
 I '$T W !?5,$C(7),"Another user is editing this entry." H 3 Q
"RTN","TIURB",32,0)
 I +$P($G(^TIU(8925,+TIUDA,0)),U,5)'>6 W !?5,$C(7),"Only SIGNED Documents may be amended." H 3 Q
"RTN","TIURB",33,0)
 S TIUAMND=$$CANDO^TIULP(TIUDA,"AMENDMENT")
"RTN","TIURB",34,0)
 I +TIUAMND'>0 D  Q
"RTN","TIURB",35,0)
 . W !!,$C(7),$C(7),$C(7),$P(TIUAMND,U,2),!
"RTN","TIURB",36,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURB",37,0)
 S TIUSNM=$$DECRYPT^TIULC1($P(^TIU(8925,TIUDA,15),U,3),1,$$CHKSUM^TIULC("^TIU(8925,"_TIUDA_",""TEXT"")"))
"RTN","TIURB",38,0)
 S TIUSBLK=$$DECRYPT^TIULC1($P($G(^TIU(8925,TIUDA,15)),U,4),1,$$CHKSUM^TIULC("^TIU(8925,"_TIUDA_",""TEXT"")"))
"RTN","TIURB",39,0)
 S TIUCSNM=$$DECRYPT^TIULC1($P(^TIU(8925,TIUDA,15),U,9),1,$$CHKSUM^TIULC("^TIU(8925,"_TIUDA_",""TEXT"")"))
"RTN","TIURB",40,0)
 S TIUCSBLK=$$DECRYPT^TIULC1($P($G(^TIU(8925,TIUDA,15)),U,10),1,$$CHKSUM^TIULC("^TIU(8925,"_TIUDA_",""TEXT"")"))
"RTN","TIURB",41,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0)),TIUT0=$G(^TIU(8925.1,+TIUTYP,0))
"RTN","TIURB",42,0)
 S TIUTYP(1)="1^"_+TIUTYP_U_$P(TIUT0,U,3)_U
"RTN","TIURB",43,0)
 S DFN=$P($G(^TIU(8925,+TIUDA,0)),U,2)
"RTN","TIURB",44,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIURB",45,0)
 S DIWESUB="Patient: "_$G(TIU("PNM"))
"RTN","TIURB",46,0)
 S TIUCHNG=0 D CLEAR^VALM1,TEXTEDIT^TIUEDI4(TIUDA,.TIUCMT,.TIUCHNG)
"RTN","TIURB",47,0)
 I +$G(TIUCHNG) D
"RTN","TIURB",48,0)
 . D SIG^XUSESIG
"RTN","TIURB",49,0)
 . I X1']"" S X=$G(X) D BADSIG^TIULG(X)
"RTN","TIURB",50,0)
 . S DR=".05///AMENDED;1601////"_$$NOW^XLFDT_";1602////"_DUZ,DA=TIUDA,TIUSIG=0
"RTN","TIURB",51,0)
 . I X1]"" S DR=DR_";1603////"_$$NOW^XLFDT_";1604///^S X=$$SIGNAME^TIULS(DUZ);1605///^S X=$$SIGTITL^TIULS(DUZ)",TIUSIG=1
"RTN","TIURB",52,0)
 . S DIE=8925 D ^DIE
"RTN","TIURB",53,0)
 . ; Refile /es/-block fields
"RTN","TIURB",54,0)
 . S DR="1503///^S X=TIUSNM;1504///^S X=TIUSBLK;1509///^S X=TIUCSNM;1510///^S X=TIUCSBLK"
"RTN","TIURB",55,0)
 . D ^DIE
"RTN","TIURB",56,0)
 L -^TIU(8925,+TIUDA)
"RTN","TIURB",57,0)
 Q
"RTN","TIURB",58,0)
SENDBACK ; Send back a Document to transcription
"RTN","TIURB",59,0)
 N TIUDA,DFN,TIU,TIUDATA,TIUCHNG,TIUI,TIUY,Y,DIROUT,TIULST
"RTN","TIURB",60,0)
 N TIUDAARY
"RTN","TIURB",61,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURB",62,0)
 S TIUI=0
"RTN","TIURB",63,0)
 I +$O(VALMY(0)) D CLEAR^VALM1
"RTN","TIURB",64,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURB",65,0)
 . N TIU,RSTRCTD
"RTN","TIURB",66,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURB",67,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURB",68,0)
 . I RSTRCTD D  Q
"RTN","TIURB",69,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURB",70,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURB",71,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURB",72,0)
 . S TIUCHNG=0
"RTN","TIURB",73,0)
 . D EN^VALM("TIU SEND BACK")
"RTN","TIURB",74,0)
 . I +$G(TIUCHNG) D
"RTN","TIURB",75,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURB",76,0)
SENDX ; Revise list and cycle back as appropriate
"RTN","TIURB",77,0)
 I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURB",78,0)
 E  S TIUCHNG("UPDATE")=1
"RTN","TIURB",79,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURB",80,0)
 S VALMBCK="R"
"RTN","TIURB",81,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"sent back")
"RTN","TIURB",82,0)
 Q
"RTN","TIURB",83,0)
LINK ; Link to problem(s)
"RTN","TIURB",84,0)
 N TIUCHNG,TIUDA,DFN,TIU,TIUDATA,TIUEDIT,TIUI,TIUY,TIULST,Y,DIROUT
"RTN","TIURB",85,0)
 N TIUDAARY
"RTN","TIURB",86,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURB",87,0)
 S TIUI=0
"RTN","TIURB",88,0)
 I +$O(VALMY(0)) D CLEAR^VALM1
"RTN","TIURB",89,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURB",90,0)
 . N TIU,VALMY,XQORM,VA,VADM,GMPDFN,GMPLUSER,RSTRCTD
"RTN","TIURB",91,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURB",92,0)
 . S TIUDA=+$P(TIUDATA,U,2),GMPLUSER=1
"RTN","TIURB",93,0)
 . I '$D(^TIU(8925,+TIUDA,0)) D  Q
"RTN","TIURB",94,0)
 . . W !,$C(7),"Document no longer exists.",!
"RTN","TIURB",95,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURB",96,0)
 . S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURB",97,0)
 . I RSTRCTD D  Q
"RTN","TIURB",98,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURB",99,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURB",100,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURB",101,0)
 . S DFN=+$P($G(^TIU(8925,+TIUDA,0)),U,2)
"RTN","TIURB",102,0)
 . I +DFN D DEM^VADPT S GMPDFN=DFN_U_VADM(1)_U_$E(VADM(1))_VA("BID")
"RTN","TIURB",103,0)
 . S TIUCHNG=0
"RTN","TIURB",104,0)
 . D EN^VALM("TIU LINK TO PROBLEM")
"RTN","TIURB",105,0)
 . I +$G(TIUCHNG) S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURB",106,0)
LINKX ; Revise list and cycle back as appropriate
"RTN","TIURB",107,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURB",108,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURB",109,0)
 S VALMBCK="R"
"RTN","TIURB",110,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"linked to problems")
"RTN","TIURB",111,0)
 Q
"RTN","TIURB",112,0)
DEL(DA) ; -- Call to DEL for backward compatibility
"RTN","TIURB",113,0)
 G GODEL^TIURB2
"RTN","TIURB",114,0)
 Q
"RTN","TIURB2")
0^47^B23091302
"RTN","TIURB2",1,0)
TIURB2 ; SLC/JER - More Review Screen Actions ;2/26/01
"RTN","TIURB2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURB2",3,0)
 ; 2/3: Update TEXTEDIT from TIUEDIT to TIUEDI4
"RTN","TIURB2",4,0)
 ; 9/28 Moved DELETE, DEL, DELTEXT, DIK to new rtn TIURB2
"RTN","TIURB2",5,0)
DELETE ; Delete action
"RTN","TIURB2",6,0)
 N TIUI,TIUY,TIUCHNG,Y,DIROUT,DTOUT,DUOUT
"RTN","TIURB2",7,0)
 N TIULNO,TIUJ,PRNTDA,LSTDA
"RTN","TIURB2",8,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURB2",9,0)
 S TIUI=0
"RTN","TIURB2",10,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURB2",11,0)
 . N TIUDATA,DA,RSTRCTD
"RTN","TIURB2",12,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURB2",13,0)
 . S DA=+$P(TIUDATA,U,2)
"RTN","TIURB2",14,0)
 . L +^TIU(8925,+DA):1
"RTN","TIURB2",15,0)
 . E  D  Q
"RTN","TIURB2",16,0)
 . . W !?5,$C(7),"Another user is editing this entry."
"RTN","TIURB2",17,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURB2",18,0)
 . . D PICK^TIULM(TIUI)
"RTN","TIURB2",19,0)
 . S RSTRCTD=$$DOCRES^TIULRR(DA)
"RTN","TIURB2",20,0)
 . I RSTRCTD D  Q
"RTN","TIURB2",21,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURB2",22,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURB2",23,0)
 . D DEL(DA)
"RTN","TIURB2",24,0)
 . L -^TIU(8925,+DA)
"RTN","TIURB2",25,0)
 ; -- Update or Rebuild list, restore video:
"RTN","TIURB2",26,0)
 S TIUCHNG("RBLD")=1
"RTN","TIURB2",27,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURB2",28,0)
 S VALMBCK="R"
"RTN","TIURB2",29,0)
 Q
"RTN","TIURB2",30,0)
DEL(DA) ; We don't hand out pencils, without erasers
"RTN","TIURB2",31,0)
GODEL ; -- Called from DEL^TIURB
"RTN","TIURB2",32,0)
 N CANDEL,TIUDA,TIUD0,TIUI,TIUDFLT,TIUPT,TIUVDT,TIUTYP,PROMPT,TIUAUDIT
"RTN","TIURB2",33,0)
 N TIUMSG,TIURSN,TIUVTYP,TIUABORT,ADDMPRNT,IDPRNT
"RTN","TIURB2",34,0)
 L +^TIU(8925,+DA):1
"RTN","TIURB2",35,0)
 E  D  Q
"RTN","TIURB2",36,0)
 . W !?5,$C(7),"Another user is editing this entry."
"RTN","TIURB2",37,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURB2",38,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUTYP=$$UP^XLFSTR($$PNAME^TIULC1(+TIUD0))
"RTN","TIURB2",39,0)
 S ADDMPRNT=+$P(TIUD0,U,6)
"RTN","TIURB2",40,0)
 S IDPRNT=+$P($G(^TMP("TIUR",$J,"IDDATA",DA)),U,3)
"RTN","TIURB2",41,0)
 S TIUPT=$$NAME^TIULS($P($G(^DPT(+$P(TIUD0,U,2),0)),U),"FIRST LAST")
"RTN","TIURB2",42,0)
 S TIUVDT=+$P(TIUD0,U,7)
"RTN","TIURB2",43,0)
 S TIUVDT=$$DATE^TIULS(TIUVDT,"MM/DD/YY"_$S($L(TIUVDT,".")=2:" HR:MIN",1:""))
"RTN","TIURB2",44,0)
 S TIUVTYP=$S(+$$ISDS^TIULX(+TIUD0):" Admission",1:" Visit")
"RTN","TIURB2",45,0)
 S TIUMSG="DELETING "_TIUTYP_" For "_TIUPT_"'s "_TIUVDT_TIUVTYP_"."
"RTN","TIURB2",46,0)
 S CANDEL=$$CANDO^TIULP(DA,"DELETE RECORD")
"RTN","TIURB2",47,0)
 I 'CANDEL W !!,$C(7),$C(7),$C(7),$P(CANDEL,U,2),! H 2 G DELX
"RTN","TIURB2",48,0)
 I $$HASIDKID^TIUGBR(DA) W !!,"This interdisciplinary parent cannot be deleted; it's entries must first",!,"be detached.",! H 3 G DELX
"RTN","TIURB2",49,0)
 I $O(^TIU(8925,"DAD",+DA,0))>0,$$HASADDEN^TIULC1(DA) D
"RTN","TIURB2",50,0)
 . W !!,"This "_TIUTYP_" has ADDENDA."
"RTN","TIURB2",51,0)
 W !,$C(7) F TIUI=1:1:$L(TIUMSG,"|") W !,$P(TIUMSG,"|",TIUI)
"RTN","TIURB2",52,0)
 W ! S PROMPT="Are you SURE you want to DELETE"
"RTN","TIURB2",53,0)
 I '$$READ^TIUU("YO",PROMPT,"NO") W !,"Nothing DELETED.",! H 2 S TIUCHNG=0 G DELX
"RTN","TIURB2",54,0)
 S PROMPT="DELETE the TEXT ONLY, leaving audit trail information"
"RTN","TIURB2",55,0)
 S TIUDA=DA
"RTN","TIURB2",56,0)
 I $S(DUZ=+$P($G(^TIU(8925,TIUDA,12)),U,2):1,+$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION")'>0:1,1:0) S TIUAUDIT=0 I 1
"RTN","TIURB2",57,0)
 E  D  G:$D(TIUABORT) DELX
"RTN","TIURB2",58,0)
 . I +$P($G(^TIU(8925,+TIUDA,0)),U,5)'<6 S TIUAUDIT=1
"RTN","TIURB2",59,0)
 . E  D
"RTN","TIURB2",60,0)
 . . S TIUAUDIT=+$$READ^TIUU("YO",PROMPT,"NO")
"RTN","TIURB2",61,0)
 . . I $D(DTOUT)!($D(DUOUT)) D
"RTN","TIURB2",62,0)
 . . . W !,"Nothing DELETED.",!
"RTN","TIURB2",63,0)
 . . . S TIUCHNG=0,TIUABORT=1
"RTN","TIURB2",64,0)
 . . . H 2
"RTN","TIURB2",65,0)
 K ^TIU(8925,"ASAVE",DUZ,TIUDA) ; Remove SAVE-flag
"RTN","TIURB2",66,0)
 I +TIUAUDIT'>0 D  G DELX
"RTN","TIURB2",67,0)
 . W !,"DELETING Entire "_TIUTYP_" record.",!
"RTN","TIURB2",68,0)
 . D DELIRT^TIUDIRT(TIUDA),DIK(TIUDA) H 2
"RTN","TIURB2",69,0)
 . S TIUCHNG=2,TIUCHNG("DELETE")=1
"RTN","TIURB2",70,0)
 . D ALERTDEL^TIUALRT(TIUDA),DELSGNR^TIURB1(TIUDA)
"RTN","TIURB2",71,0)
 S PROMPT="Reason for DELETION (Privacy Act or Administrative): "
"RTN","TIURB2",72,0)
 S TIURSN=$P($$READ^TIUU("SA^P:privacy act;A:administrative",PROMPT,"PRIVACY ACT"),U)
"RTN","TIURB2",73,0)
 D ALERTDEL^TIUALRT(TIUDA),DELSGNR^TIURB1(TIUDA)
"RTN","TIURB2",74,0)
 D DELTEXT(TIUDA,TIURSN) S TIUCHNG=1
"RTN","TIURB2",75,0)
DELX L -^TIU(8925,+DA)
"RTN","TIURB2",76,0)
 Q
"RTN","TIURB2",77,0)
DELTEXT(DA,TIURSN) ; Delete Text, but leave audit information
"RTN","TIURB2",78,0)
 N DR,DIE,TIUTYP,TIUDA,X,Y S TIUDA=0
"RTN","TIURB2",79,0)
 F  S TIUDA=+$O(^TIU(8925,"DAD",+DA,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURB2",80,0)
 . I +$$ISADDNDM^TIULC1(TIUDA) D DELTEXT(TIUDA,$G(TIURSN)) I 1
"RTN","TIURB2",81,0)
 . E  D DIK(TIUDA) ; Remove components entirely
"RTN","TIURB2",82,0)
 S TIUTYP=$P($G(^TIU(8925.1,+$G(^TIU(8925,+DA,0)),0)),U)
"RTN","TIURB2",83,0)
 W:'$D(ZTQUEUED) !,"Deleting "_TIUTYP_" text."
"RTN","TIURB2",84,0)
 S DR=".05///DELETED;1610////"_+$G(DUZ)_";1611////"_$$NOW^TIULC_";1612////"_TIURSN_";2///@;1503///@;1504///@;1506///@;1509///@;1510///@"
"RTN","TIURB2",85,0)
 S DIE=8925 D ^DIE W:'$D(ZTQUEUED) "."
"RTN","TIURB2",86,0)
 S ^TIU(8925,+DA,"TEXT",0)="^^"_2_U_2_U_DT_"^^"
"RTN","TIURB2",87,0)
 S ^TIU(8925,+DA,"TEXT",1,0)=" "
"RTN","TIURB2",88,0)
 S ^TIU(8925,+DA,"TEXT",2,0)="  Document Deleted per "_$S(TIURSN="P":"Privacy Act.",1:"Administrative Action.")
"RTN","TIURB2",89,0)
 Q
"RTN","TIURB2",90,0)
DIK(DA) ; Call ^DIK to delete the record
"RTN","TIURB2",91,0)
 N DIK,TIUTYP,TIUTYPE,TIUDA,TIUVSIT,TIUVKILL,TIUDELX S TIUDA=0
"RTN","TIURB2",92,0)
 F  S TIUDA=+$O(^TIU(8925,"DAD",+DA,TIUDA)) Q:+TIUDA'>0  D DIK(TIUDA)
"RTN","TIURB2",93,0)
 S TIUTYPE=+$G(^TIU(8925,+DA,0))
"RTN","TIURB2",94,0)
 S TIUTYP=$P($G(^TIU(8925.1,TIUTYPE,0)),U)
"RTN","TIURB2",95,0)
 S TIUVSIT=+$P($G(^TIU(8925,DA,0)),U,3),TIUDA=DA
"RTN","TIURB2",96,0)
 S TIUDELX=$$DELETE^TIULC1(TIUTYPE)
"RTN","TIURB2",97,0)
 I TIUDELX]"" X TIUDELX
"RTN","TIURB2",98,0)
 S DIK="^TIU(8925,"
"RTN","TIURB2",99,0)
 D ^DIK ; W:'$D(ZTQUEUED) "."
"RTN","TIURB2",100,0)
 D DELAUDIT^TIUEDI1(DA)
"RTN","TIURB2",101,0)
 D DELPROB^TIURB1(DA)
"RTN","TIURB2",102,0)
 D DELSGNR^TIURB1(DA)
"RTN","TIURB2",103,0)
 D ALERTDEL^TIUALRT(DA)
"RTN","TIURB2",104,0)
 ; **52** Disable call to $$DELVFILE^PXAPI 'til further notice
"RTN","TIURB2",105,0)
 ; I +TIUVSIT,$D(^AUPNVSIT(+TIUVSIT)) S TIUVKILL=$$DELVFILE^PXAPI("ALL",TIUVSIT,"","TEXT INTEGRATION UTILITIES")
"RTN","TIURB2",106,0)
 Q
"RTN","TIURC")
0^37^B17035494
"RTN","TIURC",1,0)
TIURC ; SLC/JER - Additional Review screen actions ;3/7/01
"RTN","TIURC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,4,36,48,67,79,58,100**;Jun 20, 1997
"RTN","TIURC",3,0)
VERIFY ; Verify Documents
"RTN","TIURC",4,0)
 N TIUCHNG,TIUDATA,TIUI,TIUY,Y,DIROUT,TIULST,TIUDAARY
"RTN","TIURC",5,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURC",6,0)
 S TIUI=0
"RTN","TIURC",7,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURC",8,0)
 . N TIU,TIUDATA,TIUDA,RSTRCTD
"RTN","TIURC",9,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURC",10,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURC",11,0)
 . I RSTRCTD D  Q
"RTN","TIURC",12,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURC",13,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC",14,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURC",15,0)
 . S TIUCHNG=0
"RTN","TIURC",16,0)
 . D EN^VALM("TIU VERIFY")
"RTN","TIURC",17,0)
 . K ^TMP("TIUVIEW",$J)
"RTN","TIURC",18,0)
 . I +$G(TIUCHNG) D
"RTN","TIURC",19,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURC",20,0)
 ; -- Update or Rebuild list, restore video:
"RTN","TIURC",21,0)
 I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURC",22,0)
 E  S TIUCHNG("UPDATE")=1
"RTN","TIURC",23,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURC",24,0)
 S VALMBCK="R"
"RTN","TIURC",25,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"verified/unverified")
"RTN","TIURC",26,0)
 Q
"RTN","TIURC",27,0)
VERIFY1 ; Single record verify
"RTN","TIURC",28,0)
 ; Receives TIUDA
"RTN","TIURC",29,0)
 N DA,DIE,DR,TIUTYP,TIUQUIT,TIUT0,TIUTNM,TIUVERX
"RTN","TIURC",30,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0)),TIUT0=$G(^TIU(8925.1,+TIUTYP,0))
"RTN","TIURC",31,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYP)
"RTN","TIURC",32,0)
 S TIUTYP(1)="1^"_+TIUTYP_U_TIUTNM_U
"RTN","TIURC",33,0)
 I $$DADORKID^TIUGBR(TIUDA) D  Q
"RTN","TIURC",34,0)
 . W !!,$C(7),"This ",TIUTNM," is an interdisciplinary entry.",!,"ID entries must be verified prior to attaching.",!
"RTN","TIURC",35,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC",36,0)
 I +$P($G(^TIU(8925,+TIUDA,15)),U)!+$P($G(^(15)),U,7) D  Q
"RTN","TIURC",37,0)
 . W !!,$C(7),"This ",TIUTNM," is already signed.",!
"RTN","TIURC",38,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC",39,0)
 I +$P($G(^TIU(8925,+TIUDA,13)),U,5) D  Q
"RTN","TIURC",40,0)
 . W !!,"This ",TIUTNM," is already verified."
"RTN","TIURC",41,0)
 . S TIUY=$$READ^TIUU("YO","Do you want to UNVERIFY this "_TIUTNM,"NO","^D UNVER^TIUDIRH")
"RTN","TIURC",42,0)
 . I TIUY W !,TIUTNM," UNVERIFIED" D
"RTN","TIURC",43,0)
 . . S DA=TIUDA,DIE=8925,DR=".05///UNVERIFIED;1305///@;1306///@" D ^DIE
"RTN","TIURC",44,0)
 . . W "." S TIUCHNG=1
"RTN","TIURC",45,0)
 . . D ALERTDEL^TIUALRT(TIUDA)
"RTN","TIURC",46,0)
 S TIUY=$$READ^TIUU("YO","Do you want to edit this "_TIUTNM,"NO")
"RTN","TIURC",47,0)
 I +TIUY D
"RTN","TIURC",48,0)
 . D GETTIU^TIULD(.TIU,TIUDA),CLEAR^VALM1
"RTN","TIURC",49,0)
 . D DIE^TIUEDI4(TIUDA,.TIUQUIT) ; **100**
"RTN","TIURC",50,0)
 I +TIUY'>0,$S(+$G(TIUQUIT):1,$D(DUOUT):1,$D(DIROUT):1,$D(DTOUT):1,1:0) Q
"RTN","TIURC",51,0)
 S TIUY=$$READ^TIUU("YO","VERIFY this "_TIUTNM,"NO","^D VER^TIUDIRH")
"RTN","TIURC",52,0)
 I 'TIUY W !,TIUTNM," NOT VERIFIED." Q
"RTN","TIURC",53,0)
 S DA=TIUDA,DIE=8925,DR=".05///UNSIGNED;1305////"_$$NOW^TIULC_";1306////"_$G(DUZ) D ^DIE
"RTN","TIURC",54,0)
 S TIUCHNG=1,TIUVERX=$$VERIFY^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIURC",55,0)
 I TIUVERX]"" X TIUVERX
"RTN","TIURC",56,0)
 I +DA W !,TIUTNM," VERIFIED." D MAIN^TIUPD(DA,"V"),SEND^TIUALRT(DA)
"RTN","TIURC",57,0)
 Q
"RTN","TIURC",58,0)
ADD ; Add Document
"RTN","TIURC",59,0)
 N TIUONCE,TIUNDA,TIUCLASS,TIUCREAT,TIUITEM,LINENO,VALMY,TIUCHNG,RSTRCTD
"RTN","TIURC",60,0)
 ; OK to new TIUCHNG here, this is not used in browse.
"RTN","TIURC",61,0)
 S TIUONCE=1
"RTN","TIURC",62,0)
 S TIUCLASS=$S($G(VALM("ENTITY"))="Progress Note":3,$G(VALM("ENTITY"))="Discharge Summary":244,1:38)
"RTN","TIURC",63,0)
 D FULL^VALM1
"RTN","TIURC",64,0)
 I +$G(DFN) D  Q:+$G(RSTRCTD)
"RTN","TIURC",65,0)
 . S RSTRCTD=$$PTRES^TIULRR(DFN)
"RTN","TIURC",66,0)
 . I RSTRCTD D  Q
"RTN","TIURC",67,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURC",68,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC",69,0)
 ; -- MAIN^TIUEDIT looks like:
"RTN","TIURC",70,0)
 ;    MAIN(TIUCLASS,SUCCESS,DFN,TIUTITLE,EVNTFLAG,NOSAVE,
"RTN","TIURC",71,0)
 ;         TIUNDA,TIUSNGL,TIUCHNG)
"RTN","TIURC",72,0)
 ;    i.e. TIUTITLE,EVNTFLAG,NOSAVE,TIUSNGL are null
"RTN","TIURC",73,0)
 D MAIN^TIUEDIT(TIUCLASS,.TIUCREAT,+$G(DFN),"","","",.TIUNDA,"",.TIUCHNG)
"RTN","TIURC",74,0)
 I $G(TIUCHNG("DELETE"))!$G(TIUCHNG("ADDM"))!$G(TIUCHNG("EXIST"))!$G(TIUCHNG("AVAIL")) S TIUCHNG("RBLD")=1
"RTN","TIURC",75,0)
 I +$O(TIUNDA(0))'>0 S TIUCHNG("REFRESH")=1 G ADDX
"RTN","TIURC",76,0)
 ; -- If in TIU OE/RR REVIEW PN, rebuild list and quit:
"RTN","TIURC",77,0)
 I $G(^TMP("TIUR",$J,"RTN"))="TIUROR" S TIUCHNG("RBLD")=1 G ADDX
"RTN","TIURC",78,0)
 ; -- If in Review Notes by Patient (no review screen),
"RTN","TIURC",79,0)
 ;    or rebuilding, don't add elements to end of screen:
"RTN","TIURC",80,0)
 I '$D(^TMP("TIUR",$J,"RTN")) G ADDX
"RTN","TIURC",81,0)
 I $G(TIUCHNG("RBLD")) G ADDX
"RTN","TIURC",82,0)
 ; -- If in an integrated docmts option, add one line
"RTN","TIURC",83,0)
 ;    to screen for each new docmt, refresh list, and quit:
"RTN","TIURC",84,0)
 S TIUNDA=0
"RTN","TIURC",85,0)
 F  S TIUNDA=$O(TIUNDA(TIUNDA)) Q:+TIUNDA'>0  D
"RTN","TIURC",86,0)
 . S TIUITEM=+$G(^TMP("TIUR",$J,0))
"RTN","TIURC",87,0)
 . ; -- Don't add if editing existing docmt which is already in list:
"RTN","TIURC",88,0)
 . S LINENO=$O(^TMP("TIUR",$J,"IEN",TIUNDA,0))
"RTN","TIURC",89,0)
 . I LINENO D  Q
"RTN","TIURC",90,0)
 . . S VALMY(LINENO)="",TIUCHNG("UPDATE")=1
"RTN","TIURC",91,0)
 . D ADDELMNT^TIUR2(TIUNDA,+TIUITEM,1)
"RTN","TIURC",92,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURC",93,0)
ADDX D UPRBLD^TIURL(.TIUCHNG,.VALMY)
"RTN","TIURC",94,0)
 Q
"RTN","TIURC",95,0)
COPY1 ; -- Call to COPY1 for backward compatibility
"RTN","TIURC",96,0)
 G COPY1^TIURC1
"RTN","TIURC",97,0)
 Q
"RTN","TIURC1")
0^48^B47007459
"RTN","TIURC1",1,0)
TIURC1 ; SLC/JER - Additional Review screen actions ;3/16/01
"RTN","TIURC1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURC1",3,0)
 ;9/28 split TIURC, with COPY to end going here to new rtn TIURC1
"RTN","TIURC1",4,0)
COPY ; Copy
"RTN","TIURC1",5,0)
 N DA,DIE,DR,TIU,TIUCHNG,TIUDATA,TIUI,TIUY,Y,DIROUT
"RTN","TIURC1",6,0)
 N TIUVIEW,TIULST,TIUNREC,TIUDAARY,OLDNREC
"RTN","TIURC1",7,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURC1",8,0)
 S TIUI=0
"RTN","TIURC1",9,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURC1",10,0)
 . N TIU,RSTRCTD
"RTN","TIURC1",11,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURC1",12,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURC1",13,0)
 . I RSTRCTD D  Q
"RTN","TIURC1",14,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURC1",15,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC1",16,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURC1",17,0)
 . I +TIUVIEW'>0 D  Q
"RTN","TIURC1",18,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURC1",19,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC1",20,0)
 . S OLDNREC=$G(TIUNREC)
"RTN","TIURC1",21,0)
 . D EN^VALM("TIU COPY DOCUMENT") ;generates list TIUNREC of new recs
"RTN","TIURC1",22,0)
 . K ^TMP("TIUVIEW",$J)
"RTN","TIURC1",23,0)
 . I $G(TIUNREC)'=OLDNREC D
"RTN","TIURC1",24,0)
 . . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURC1",25,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURC1",26,0)
 I +$G(TIUNREC) D
"RTN","TIURC1",27,0)
 . N TIUI,TIUNDA,TIUITEM
"RTN","TIURC1",28,0)
 . F TIUI=1:1:$L($G(TIUNREC),",") D
"RTN","TIURC1",29,0)
 . . S TIUNDA=$P(TIUNREC,",",TIUI),TIUITEM=+$G(^TMP("TIUR",$J,0))
"RTN","TIURC1",30,0)
 . . D ADDELMNT^TIUR2(TIUNDA,+TIUITEM,1)
"RTN","TIURC1",31,0)
 ;I $G(TIULST)]"" S VALMSG="** Item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_" Copied; See end of list **"
"RTN","TIURC1",32,0)
 ;E  S VALMSG="** No changes made... **"
"RTN","TIURC1",33,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURC1",34,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURC1",35,0)
 S VALMBCK="R"
"RTN","TIURC1",36,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"copied")
"RTN","TIURC1",37,0)
 Q
"RTN","TIURC1",38,0)
COPY1 ; Copy a document
"RTN","TIURC1",39,0)
 N TIUOD0,TIUOD12,TIUD13,TIUOD14,TIUOD17,TIUI,TIUPAT,TIUTNM,TIUTYP
"RTN","TIURC1",40,0)
 N TIUDPRM,TIUPOP,TIUCOPY,TIUVSUPP,DUOUT,DIROUT,DTOUT,TIUASK
"RTN","TIURC1",41,0)
 S TIUPOP=0
"RTN","TIURC1",42,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D  Q
"RTN","TIURC1",43,0)
 . W !,$C(7),"ADDENDA may not be copied."
"RTN","TIURC1",44,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC1",45,0)
 S TIUCOPY=$$CANDO^TIULP(TIUDA,"COPY RECORD")
"RTN","TIURC1",46,0)
 I +TIUCOPY'>0 D  Q
"RTN","TIURC1",47,0)
 . W !!,$C(7),$P(TIUCOPY,U,2),!
"RTN","TIURC1",48,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC1",49,0)
 S TIUOD0=$G(^TIU(8925,+TIUDA,0)),TIUOD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIURC1",50,0)
 S TIUOD14=$G(^TIU(8925,+TIUDA,14)),TIUOD17=$G(^TIU(8925,+TIUDA,17))
"RTN","TIURC1",51,0)
 S TIUTYP=+TIUOD0
"RTN","TIURC1",52,0)
 D FULL^VALM1
"RTN","TIURC1",53,0)
 I $$CHKTITLE(+TIUTYP) D  Q:$G(TIUOUT)=1
"RTN","TIURC1",54,0)
 . N TIUDOC0,TIUDCLS
"RTN","TIURC1",55,0)
 . S TIUDOC0=$G(^TIU(8925.1,TIUTYP,0))
"RTN","TIURC1",56,0)
 . W !
"RTN","TIURC1",57,0)
 . I $P(TIUDOC0,U,7)=13 D
"RTN","TIURC1",58,0)
 . . W !,$C(7),$P(TIUDOC0,U,3)," is an inactive title."
"RTN","TIURC1",59,0)
 . W !,"You must now select a new, active title BEFORE the note is copied:",!
"RTN","TIURC1",60,0)
 . S TIUDCLS=+$$CLINDOC^TIULC1(+TIUTYP,TIUDA),TIUTYP=0
"RTN","TIURC1",61,0)
 . D DOCSPICK^TIULA2(.TIUTYP,TIUDCLS,"1A","","","+$$CANPICK^TIULP(+Y),+$$CANENTR^TIULP(+Y)")
"RTN","TIURC1",62,0)
 . I TIUTYP'>0 S TIUOUT=1
"RTN","TIURC1",63,0)
 . E  D
"RTN","TIURC1",64,0)
 . . S TIUTYP=$P($G(TIUTYP(1)),U,2)
"RTN","TIURC1",65,0)
 . . I $$CHKTITLE(+TIUTYP) S TIUOUT=1
"RTN","TIURC1",66,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,TIUDA)
"RTN","TIURC1",67,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYP)
"RTN","TIURC1",68,0)
 S TIUTYP(1)="1^"_+TIUTYP_U_TIUTNM_U
"RTN","TIURC1",69,0)
 W !!,"Please Choose One or More Patients for whom the document should be copied:",!
"RTN","TIURC1",70,0)
 F  D  Q:+TIUPOP
"RTN","TIURC1",71,0)
 . D PATIENT^ORU1(.TIUPAT,1)
"RTN","TIURC1",72,0)
 . I +TIUPAT'>0 D  Q
"RTN","TIURC1",73,0)
 . . W !,$C(7),"No patient(s) selected..."
"RTN","TIURC1",74,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W !
"RTN","TIURC1",75,0)
 . . S TIUCHNG=0,TIUPOP=1
"RTN","TIURC1",76,0)
 . S TIUI=0 F  S TIUI=$O(TIUPAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURC1",77,0)
 . . N DA,DR,DFN,TIU,TIULMETH,TIUVMETH,TIUPATNM
"RTN","TIURC1",78,0)
 . . S DFN=+TIUPAT(TIUI),TIUPATNM=$P(TIUPAT(TIUI),U,2)
"RTN","TIURC1",79,0)
 . . S TIUVSUPP=+$$SUPPVSIT^TIULC1(TIUTYP)
"RTN","TIURC1",80,0)
 . . I TIUVSUPP'>0 D  I 1
"RTN","TIURC1",81,0)
 . . . S TIULMETH=$$GETLMETH^TIUEDI1(TIUTYP)
"RTN","TIURC1",82,0)
 . . . I '$L(TIULMETH) D  S TIUOUT=1 Q
"RTN","TIURC1",83,0)
 . . . . W !,$C(7),"No Visit Linkage Method defined for "
"RTN","TIURC1",84,0)
 . . . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIURC1",85,0)
 . . . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC1",86,0)
 . . . W !!,"For Patient ",TIUPATNM
"RTN","TIURC1",87,0)
 . . . X TIULMETH
"RTN","TIURC1",88,0)
 . . E  D EVENT^TIUSRVP1(.TIU,DFN)
"RTN","TIURC1",89,0)
 . . I '$D(TIU("VSTR")) W !,$C(7),"Patient & Visit required." H 2 Q
"RTN","TIURC1",90,0)
 . . S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYP)
"RTN","TIURC1",91,0)
 . . I '$L(TIUVMETH) D  S TIUOUT=1 Q
"RTN","TIURC1",92,0)
 . . . W !,$C(7),"No Validation Method defined for "
"RTN","TIURC1",93,0)
 . . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIURC1",94,0)
 . . X TIUVMETH
"RTN","TIURC1",95,0)
 . . I $D(TIU),+$G(TIUASK) D
"RTN","TIURC1",96,0)
 . . . N TIUNEW,TIUITEM,DA,DR,DIE
"RTN","TIURC1",97,0)
 . . . ;S DA=$$GETREC^TIUEDI1(DFN,.TIU,1,.TIUNEW,.TIUDPRM) Q:+DA'>0
"RTN","TIURC1",98,0)
 . . . S DA=$$GETRECNW^TIUEDI3(DFN,.TIU,TIUTYP(1),.TIUNEW,.TIUDPRM) Q:+DA'>0
"RTN","TIURC1",99,0)
 . . . I '+$G(TIUNEW) D  Q
"RTN","TIURC1",100,0)
 . . . . W !!,$C(7),"A ",$P(TIUTYP(1),U,3)," already exists for this visit."
"RTN","TIURC1",101,0)
 . . . . W !,"You may not use the copy function to overwrite an existing ",!,$$UPPER^TIULS($$STATUS^TIULC(DA))," ",$P(TIUTYP(1),U,3),".",!
"RTN","TIURC1",102,0)
 . . . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC1",103,0)
 . . . D COPY0(DA,TIUOD0,.TIU),COPY12(DA,TIUOD0,TIUOD12,.TIU),COPY13(DA,TIUD13)
"RTN","TIURC1",104,0)
 . . . D COPY14(DA,TIUOD14,.TIU),COPY17(DA,TIUOD17),COPYTEXT(TIUDA,DA)
"RTN","TIURC1",105,0)
 . . . I $D(^TIU(8925,DA,"TEMP")) D MERGTEXT^TIUEDI1(DA,.TIU) K ^TIU(8925,+DA,"TEMP")
"RTN","TIURC1",106,0)
 . . . S DR=".05///"_$$UPPER^TIULS($$STATUS^TIULC(DA)),DIE=8925 D ^DIE
"RTN","TIURC1",107,0)
 . . . S TIUCHNG=1,TIUNREC=$G(TIUNREC)_$S(+$G(TIUNREC):",",1:"")_DA
"RTN","TIURC1",108,0)
 . . . I +$D(^TIU(8925,+DA,"TEXT"))>9!(+$O(^TIU(8925,"DAD",+DA,0))>0) D
"RTN","TIURC1",109,0)
 . . . . N TIUDA,TIUCPYNG S TIUDA=+DA,TIUCPYNG=1 D EDIT1^TIURA
"RTN","TIURC1",110,0)
 . S TIUPOP='+$$AGAIN
"RTN","TIURC1",111,0)
 Q
"RTN","TIURC1",112,0)
CHKTITLE(TIUTYP) ; Title Status
"RTN","TIURC1",113,0)
 N TIUBAD S TIUBAD=0
"RTN","TIURC1",114,0)
 I +$$CANPICK^TIULP(+TIUTYP)'>0 S TIUBAD=1 I 1
"RTN","TIURC1",115,0)
 E  I +$$CANENTR^TIULP(+TIUTYP)'>0 S TIUBAD=1
"RTN","TIURC1",116,0)
 Q TIUBAD
"RTN","TIURC1",117,0)
AGAIN() ; Ask again?
"RTN","TIURC1",118,0)
 N TIUY W !
"RTN","TIURC1",119,0)
 S TIUY=$$READ^TIUU("Y","Copy this note again","No")
"RTN","TIURC1",120,0)
 Q TIUY
"RTN","TIURC1",121,0)
COPY0(DA,TIUD0,TIU) ; Copy 0-node
"RTN","TIURC1",122,0)
 N DR,DIE S DIE=8925
"RTN","TIURC1",123,0)
 S DR=".02////"_DFN_";.03////"_$P($G(TIU("VISIT")),U)_";.04////"_$P(TIUD0,U,4)_";.07////"_$P($G(TIU("EDT")),U)_";.08////"_$P($G(TIU("LDT")),U)_";.09////"_$P(TIUD0,U,9)
"RTN","TIURC1",124,0)
 I $P($G(TIUDPRM(0)),U,16),'$P($G(^TIU(8925,+DA,0)),U,11),$$WORKOK^TIUPXAP1(+DA) S DR=DR_";.11////1" ;set flag to collect workload
"RTN","TIURC1",125,0)
 D ^DIE
"RTN","TIURC1",126,0)
 Q
"RTN","TIURC1",127,0)
COPY12(DA,TIUD0,TIUD12,TIU) ; Copy 12-node
"RTN","TIURC1",128,0)
 N DR,DIE S DIE=8925
"RTN","TIURC1",129,0)
 S DR="1201////"_$$NOW^TIULC_";1202////"_+$G(DUZ)_";1203////"_$P(TIUD12,U,3)_";1204////"_$G(DUZ)_";1205////"_$P($G(TIU("LOC")),U)
"RTN","TIURC1",130,0)
 S DR=DR_";1206////"_$P(TIUD12,U,6)_";1207////"_$P(TIUD12,U,7)_";1209////"_$P(TIUD12,U,9)
"RTN","TIURC1",131,0)
 I +$$REQCOSIG^TIULP(+TIUD0,DA,+$G(DUZ)) S DR=DR_";1208////"_$P(TIUD12,U,8)
"RTN","TIURC1",132,0)
 S DR=DR_";1210////"_$P(TIUD12,U,10)_";1211////"_+$G(TIU("VLOC"))
"RTN","TIURC1",133,0)
 D ^DIE
"RTN","TIURC1",134,0)
 Q
"RTN","TIURC1",135,0)
COPY13(DA,TIUD13,TIU) ; Copy 13-node
"RTN","TIURC1",136,0)
 N DR,DIE S DIE=8925
"RTN","TIURC1",137,0)
 S DR="1301////"_$$NOW^TIULC_";1302////"_$G(DUZ)_";1303////O;1307////"_$P(TIUD13,U,7)
"RTN","TIURC1",138,0)
 D ^DIE
"RTN","TIURC1",139,0)
 Q
"RTN","TIURC1",140,0)
COPY14(DA,TIUD14,TIU) ; Copy 14-node
"RTN","TIURC1",141,0)
 N DR,DIE S DIE=8925
"RTN","TIURC1",142,0)
 S DR="1401////"_$P($G(TIU("AD#")),U)_";1402////"_$P($G(TIU("TS")),U)_";1403////"_$P(TIUD14,U,3)_";1404////"_$P(TIUD14,U,4)
"RTN","TIURC1",143,0)
 D ^DIE
"RTN","TIURC1",144,0)
 Q
"RTN","TIURC1",145,0)
COPY17(DA,TIUD17) ; Copy Subject
"RTN","TIURC1",146,0)
 N DR,DIE S DIE=8925
"RTN","TIURC1",147,0)
 I $G(TIUD17)']"" Q
"RTN","TIURC1",148,0)
 S DR="1701////^S X=$G(TIUD17)" D ^DIE
"RTN","TIURC1",149,0)
 Q
"RTN","TIURC1",150,0)
COPYTEXT(TIUDA,DA) ; Copy text
"RTN","TIURC1",151,0)
 N TIUC,TIUI,TIUJ,TIULINE
"RTN","TIURC1",152,0)
 I +$O(^TIU(8925,+TIUDA,"TEXT",0)) M ^TIU(8925,+DA,"TEMP")=^TIU(8925,+TIUDA,"TEXT")
"RTN","TIURC1",153,0)
 S (TIUC,TIULINE)=0,TIUJ=+$P($G(^TIU(8925,+DA,"TEMP",0)),U,3)
"RTN","TIURC1",154,0)
 F  S TIUC=$O(^TIU(8925,"DAD",TIUDA,TIUC)) Q:+TIUC'>0  D
"RTN","TIURC1",155,0)
 . I +$$ISADDNDM^TIULC1(TIUC) Q
"RTN","TIURC1",156,0)
 . S TIUI=0 F  S TIUI=$O(^TIU(8925,+TIUC,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIURC1",157,0)
 . . S TIUJ=+$G(TIUJ)+1
"RTN","TIURC1",158,0)
 . . S ^TIU(8925,+DA,"TEMP",TIUJ,0)=$G(^TIU(8925,+TIUC,"TEXT",TIUI,0))
"RTN","TIURC1",159,0)
 . . S ^TIU(8925,+DA,"TEMP",0)="^^"_TIUJ_"^"_TIUJ_"^"_DT_"^^"
"RTN","TIURC1",160,0)
 Q
"RTN","TIURD")
0^75^B30912680
"RTN","TIURD",1,0)
TIURD ; SLC/JER - Reassign actions ;21-MAR-2001 15:25:35
"RTN","TIURD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**4,58,61,100**;Jun 20, 1997
"RTN","TIURD",3,0)
 ;
"RTN","TIURD",4,0)
REASSIGN ; Reassign selected Documents
"RTN","TIURD",5,0)
 N TIUCHNG,TIULST,TIUI,TIUY,RSTRCTD,TIUDAARY
"RTN","TIURD",6,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURD",7,0)
 S TIUI=0
"RTN","TIURD",8,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURD",9,0)
 . N TIUDA,DFN,TIU,TIUDATA,TIUVIEW
"RTN","TIURD",10,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURD",11,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURD",12,0)
 . I RSTRCTD D  Q
"RTN","TIURD",13,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURD",14,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURD",15,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURD",16,0)
 . I '+TIUVIEW D  Q
"RTN","TIURD",17,0)
 . . W !!,$C(7),$C(7),$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURD",18,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",19,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURD",20,0)
 . S TIUCHNG=0
"RTN","TIURD",21,0)
 . D EN^VALM("TIU REASSIGN")
"RTN","TIURD",22,0)
 . I +$G(TIUCHNG) D
"RTN","TIURD",23,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURD",24,0)
 ; -- Rebuild list: --
"RTN","TIURD",25,0)
 S TIUCHNG("RBLD")=1
"RTN","TIURD",26,0)
 D UPRBLD^TIURL(.TIUCHNG) K VALMY
"RTN","TIURD",27,0)
 S VALMBCK="R"
"RTN","TIURD",28,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"reassigned")
"RTN","TIURD",29,0)
 Q
"RTN","TIURD",30,0)
 ;
"RTN","TIURD",31,0)
REASSIG1 ; Single record reassign
"RTN","TIURD",32,0)
 N TIUAUTH,TIURSSG,TIUNAME,DA,DR,DIE,TIUTYPE,TIUEDIT,TIUADD,TIUPROMO,TIUY
"RTN","TIURD",33,0)
 N TIUD0,TIUD12,TIUD13,TIUD14,TIUODA,TIUOUT K ^TMP("TIURTRCT",$J)
"RTN","TIURD",34,0)
 D FULL^VALM1
"RTN","TIURD",35,0)
 L +^TIU(8925,+TIUDA):1
"RTN","TIURD",36,0)
 E  W !?5,$C(7),$C(7),$C(7),"Another user is editing this entry." S TIUY=$$READ^TIUU("EA","Press RETURN to continue...") Q
"RTN","TIURD",37,0)
 ; Authorized? NO: echo why not & quit
"RTN","TIURD",38,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D  I 1
"RTN","TIURD",39,0)
 . N TIUDAD
"RTN","TIURD",40,0)
 . S TIUDAD=+$P(^TIU(8925,TIUDA,0),U,6)
"RTN","TIURD",41,0)
 . I +$$DADORKID^TIUGBR(TIUDAD) D
"RTN","TIURD",42,0)
 . . S TIURSSG="0^You must first detach the ORIGINAL interdisciplinary entry."
"RTN","TIURD",43,0)
 E  I $$DADORKID^TIUGBR(TIUDA) D  I 1
"RTN","TIURD",44,0)
 . S TIURSSG="0^You must first detach interdisciplinary entries."
"RTN","TIURD",45,0)
 I '$D(TIURSSG) S TIURSSG=$$CANDO^TIULP(+TIUDA,"REASSIGN")
"RTN","TIURD",46,0)
 I +$G(TIURSSG)'>0 D  G REASS1X
"RTN","TIURD",47,0)
 . W !!,$C(7),$C(7),$C(7),$P(TIURSSG,U,2),!
"RTN","TIURD",48,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",49,0)
 S TIUD0(0)=$G(^TIU(8925,+TIUDA,0)),TIUD12(0)=$G(^(12))
"RTN","TIURD",50,0)
 S TIUD13(0)=$G(^TIU(8925,+TIUDA,13)),TIUD14(0)=$G(^(14))
"RTN","TIURD",51,0)
 S TIUTYPE=$P(TIUD0(0),U)
"RTN","TIURD",52,0)
 S TIUNAME=$$PNAME^TIULC1(+TIUTYPE)
"RTN","TIURD",53,0)
 S TIUAUTH=$P(TIUD12(0),U,2)
"RTN","TIURD",54,0)
 W !,$C(7)
"RTN","TIURD",55,0)
 S TIUY=$$READ^TIUU("YO","Are you sure you want to REASSIGN this "_TIUNAME,"NO","^D REAS1^TIUDIRH")
"RTN","TIURD",56,0)
 G:+TIUY'>0 REASS1X
"RTN","TIURD",57,0)
 I +$P(TIUD0(0),U,5)>5 D  G:+$G(TIUOUT) REASS1X
"RTN","TIURD",58,0)
 . W !!,$C(7),$C(7),"The status of this document is: ",$$UP^XLFSTR($$STATUS^TIULC(TIUDA))
"RTN","TIURD",59,0)
 . I +$$GETSIG^TIURD2'>0 S TIUOUT=1
"RTN","TIURD",60,0)
 . W !
"RTN","TIURD",61,0)
 ; Addendum? YES: Ask intended action is move, swap with original, or
"RTN","TIURD",62,0)
 ; replace original
"RTN","TIURD",63,0)
 S TIUADD=$$ISADDNDM^TIULC1(+TIUDA)
"RTN","TIURD",64,0)
 I +TIUADD D  G REASS1X
"RTN","TIURD",65,0)
 . D REASSIGA
"RTN","TIURD",66,0)
 D REASSIGO^TIURD3
"RTN","TIURD",67,0)
REASS1X L -^TIU(8925,+TIUDA):1
"RTN","TIURD",68,0)
 I +$G(TIUOUT),+$G(TIUODA),+$G(TIUDA),$D(TIUD0(0)) D RECOVER^TIURD4(TIUODA,TIUDA,.TIUD0) S TIUDA=TIUODA
"RTN","TIURD",69,0)
 ; Remove additional signers who haven't signed from retracted original
"RTN","TIURD",70,0)
 I '+$G(TIUOUT),+$G(TIUODA) D
"RTN","TIURD",71,0)
 . I +$O(^TIU(8925.7,"B",+$G(TIUODA),0)) D DELSGNRS^TIURD4(TIUODA,1)
"RTN","TIURD",72,0)
 . D ALERTDEL^TIUALRT(TIUODA)
"RTN","TIURD",73,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIURD",74,0)
 S VALMBCK=$S(+$G(TIUCHNG):"Q",1:"R") K ^TMP("TIURTRCT",$J)
"RTN","TIURD",75,0)
 Q
"RTN","TIURD",76,0)
 ;
"RTN","TIURD",77,0)
REASSIGO ; Reassign an original Document
"RTN","TIURD",78,0)
 G REASSIGO^TIURD3
"RTN","TIURD",79,0)
 ;
"RTN","TIURD",80,0)
REASSIGA ;Reassign an Addendum to an original DS
"RTN","TIURD",81,0)
 N TIUACT,TIUSET S TIUCHNG=0
"RTN","TIURD",82,0)
 W !,"Please choose the appropriate action for this Addendum:"
"RTN","TIURD",83,0)
 S TIUSET="M:move addendum to a different document"
"RTN","TIURD",84,0)
 S TIUSET=TIUSET_";P:promote addendum as document for another visit"
"RTN","TIURD",85,0)
 S TIUSET=TIUSET_";R:replace parent document with this addendum"
"RTN","TIURD",86,0)
 S TIUSET=TIUSET_";S:swap this addendum with its parent document"
"RTN","TIURD",87,0)
 S TIUACT=$$READ^TIUU("S^"_TIUSET,"Select Reassign Action","move")
"RTN","TIURD",88,0)
 I $P(TIUACT,U)="M" D MOVEADD^TIURD1(TIUDA) Q
"RTN","TIURD",89,0)
 I $P(TIUACT,U)="P" D PROMOTE^TIURD1(TIUDA) Q
"RTN","TIURD",90,0)
 I $P(TIUACT,U)="R" D REPLACE^TIURD1(TIUDA) Q
"RTN","TIURD",91,0)
 I $P(TIUACT,U)="S" D SWAPADD^TIURD1(TIUDA)
"RTN","TIURD",92,0)
 Q
"RTN","TIURD",93,0)
 ;
"RTN","TIURD",94,0)
CLAPPLNK ; Re-link selected Documents to different Client Records
"RTN","TIURD",95,0)
 N TIUCHNG,TIULST,TIUDA,DFN,TIU,TIUDATA,TIUEDIT,TIUI,TIUY,Y,DIROUT,TIUPOP
"RTN","TIURD",96,0)
 N TIUDAARY
"RTN","TIURD",97,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURD",98,0)
 S TIUI=0 D FULL^VALM1
"RTN","TIURD",99,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURD",100,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURD",101,0)
 . S TIUDA=+$P(TIUDATA,U,2),TIUDAARY(TIUI)=TIUDA
"RTN","TIURD",102,0)
 . S TIUCHNG=0
"RTN","TIURD",103,0)
 . D CLAPPLN1(TIUDA)
"RTN","TIURD",104,0)
 . I +$G(TIUCHNG)=1 D
"RTN","TIURD",105,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":", ",1:"")_TIUI
"RTN","TIURD",106,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURD",107,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURD",108,0)
 S VALMBCK="R"
"RTN","TIURD",109,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"reassigned")
"RTN","TIURD",110,0)
 Q
"RTN","TIURD",111,0)
 ;
"RTN","TIURD",112,0)
CLAPPLN1(TIUDA) ; Re-link a single record to the client application
"RTN","TIURD",113,0)
 N TIUREASX,TIUCVP,CANLNK
"RTN","TIURD",114,0)
 I '$D(^TIU(8925,TIUDA,0)) D  Q
"RTN","TIURD",115,0)
 . W !!,$C(7),"Document no longer exists.",!
"RTN","TIURD",116,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",117,0)
 S TIUCVP=$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIURD",118,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D  Q
"RTN","TIURD",119,0)
 . W !!,$C(7),"Links for ADDENDA can't be independently changed.",!
"RTN","TIURD",120,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",121,0)
 S TIUREASX=$$REASSIGN^TIULC1(+$G(^TIU(8925,TIUDA,0)))
"RTN","TIURD",122,0)
 I TIUREASX']"" D  I 1
"RTN","TIURD",123,0)
 . W !!,$C(7),"No PACKAGE REASSIGNMENT ACTION Defined.",!
"RTN","TIURD",124,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",125,0)
 E  D
"RTN","TIURD",126,0)
 . N CANLNK
"RTN","TIURD",127,0)
 . I $$DADORKID^TIUGBR(TIUDA) D  ;**100**
"RTN","TIURD",128,0)
 . . S CANLNK="0^You must first detach interdisciplinary entries"
"RTN","TIURD",129,0)
 . E  S CANLNK=$$CANDO^TIULP(+TIUDA,"LINK WITH REQUEST")
"RTN","TIURD",130,0)
 . I +CANLNK'>0 D  Q
"RTN","TIURD",131,0)
 . . W !!,$C(7),$C(7),$P(CANLNK,U,2),!
"RTN","TIURD",132,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",133,0)
 . X TIUREASX S:$P($G(^TIU(8925,TIUDA,14)),U,5)'=TIUCVP TIUCHNG=1
"RTN","TIURD",134,0)
 Q
"RTN","TIURD2")
0^91^B66177181
"RTN","TIURD2",1,0)
TIURD2 ; SLC/JER - Reassignment following signature ;13-APR-2001 14:20:47
"RTN","TIURD2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**61,100**;Jun 20, 1997
"RTN","TIURD2",3,0)
RETRACT(TIUDA,TIUDAD,COPYSTAT,NEWDAD,SKIPADD) ; Retract document
"RTN","TIURD2",4,0)
 N TIUOD0,TIUOD12,TIUOD13,TIUOD14,TIUOD15,TIUOD17,TIUI,TIUPAT,TIUTNM,TIUTYP
"RTN","TIURD2",5,0)
 N TIUDPRM,TIUCOPY,TIUVSUPP,DUOUT,DIROUT,DTOUT,DA,DR,DFN,TIU,TIULMETH
"RTN","TIURD2",6,0)
 N TIUVMETH,TIUPATNM,TIUNREC,DFN,TIUNDAD
"RTN","TIURD2",7,0)
 S TIUOD0=$G(^TIU(8925,+TIUDA,0)),TIUOD12=$G(^(12)),TIUOD13=$G(^(13))
"RTN","TIURD2",8,0)
 S TIUOD14=$G(^TIU(8925,+TIUDA,14)),TIUOD15=$G(^(15)),TIUOD17=$G(^(17))
"RTN","TIURD2",9,0)
 S TIUTYP=+TIUOD0,^TMP("TIURTRCT",$J,TIUDA,0)=TIUOD0,COPYSTAT=$G(COPYSTAT,5)
"RTN","TIURD2",10,0)
 I $S(+COPYSTAT=14:1,+COPYSTAT=15:1,1:0) D STATUS(TIUDA) G RTADD
"RTN","TIURD2",11,0)
 I +$P(TIUOD0,U,5)'>5 D:+$G(NEWDAD) LINKADD(TIUDA,NEWDAD) G RETRAX
"RTN","TIURD2",12,0)
 D FULL^VALM1
"RTN","TIURD2",13,0)
 ; --- Initialize document parameters ---
"RTN","TIURD2",14,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,TIUDA)
"RTN","TIURD2",15,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYP)
"RTN","TIURD2",16,0)
 ; --- Identify the patient ---
"RTN","TIURD2",17,0)
 S DFN=+$P(TIUOD0,U,2)
"RTN","TIURD2",18,0)
 I +DFN'>0 D  G RETRAX
"RTN","TIURD2",19,0)
 . W !,$C(7),"No patient selected..."
"RTN","TIURD2",20,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W !
"RTN","TIURD2",21,0)
 S TIUPATNM=$$PTNAME^TIULC1(DFN)
"RTN","TIURD2",22,0)
 ; --- Get visit info ---
"RTN","TIURD2",23,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIURD2",24,0)
 I '$D(TIU("VSTR")) W !,$C(7),"Patient & Visit required." H 2 G RETRAX
"RTN","TIURD2",25,0)
 I $D(TIU) D
"RTN","TIURD2",26,0)
 . N TIUNEW,TIUITEM,DA,DR,DIE
"RTN","TIURD2",27,0)
 . S DA=$$GETREC^TIUSRVP(DFN,.TIU,TIUTYP,.TIUNEW) Q:+DA'>0
"RTN","TIURD2",28,0)
 . I '+$G(TIUNEW) D  Q
"RTN","TIURD2",29,0)
 . . W !!,$C(7),"A ",TIUTNM," already exists for this visit."
"RTN","TIURD2",30,0)
 . . W !,"You may not use the reassign function to overwrite an existing ",!,$$UPPER^TIULS($$STATUS^TIULC(DA))," ",TIUTNM,".",!
"RTN","TIURD2",31,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD2",32,0)
 . D REMVSIT(TIUDA,TIUOD0)
"RTN","TIURD2",33,0)
 . D COPY0(DA,TIUOD0,.TIU,$G(TIUDAD),COPYSTAT),COPY12(DA,TIUOD12,.TIU)
"RTN","TIURD2",34,0)
 . D COPY13(DA,TIUOD13,.TIU,COPYSTAT),COPY14(DA,TIUOD14,.TIU)
"RTN","TIURD2",35,0)
 . D COPYSGNR(TIUDA,DA,COPYSTAT)
"RTN","TIURD2",36,0)
 . I COPYSTAT>5 D COPY15(DA,TIUOD15)
"RTN","TIURD2",37,0)
 . I +$$REQCOSIG^TIULP(+TIUTYP,TIUDA,+$P(TIUOD12,U,4)),(COPYSTAT<6) D
"RTN","TIURD2",38,0)
 . . N DIE,DR S DIE=8925
"RTN","TIURD2",39,0)
 . . S DR="1506////1" D ^DIE
"RTN","TIURD2",40,0)
 . D COPY17^TIURC1(DA,TIUOD17),COPYTEXT^TIURC1(TIUDA,DA)
"RTN","TIURD2",41,0)
 . I $D(^TIU(8925,DA,"TEMP")) D MERGTEXT^TIUEDI1(DA,.TIU) K ^TIU(8925,+DA,"TEMP")
"RTN","TIURD2",42,0)
 . S DR=".05///"_$$UPPER^TIULS($$STATUS^TIULC(DA))_";.1////^S X=$$LINECNT^TIULC(DA);1406////"_TIUDA
"RTN","TIURD2",43,0)
 . S DIE=8925 D ^DIE
"RTN","TIURD2",44,0)
 . D AUDIT^TIUEDI1(DA,0,$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEXT"")"))
"RTN","TIURD2",45,0)
 . S ^TMP("TIURTRCT",$J,"NEW",DA)=""
"RTN","TIURD2",46,0)
 . S:'+$G(TIUDAD) TIUNDAD=DA
"RTN","TIURD2",47,0)
 . S TIUNREC=$G(TIUNREC)_$S(+$G(TIUNREC):",",1:"")_DA
"RTN","TIURD2",48,0)
 . D STATUS(TIUDA)
"RTN","TIURD2",49,0)
 ; If SKIPADD is TRUE, bypass retraction of addenda...
"RTN","TIURD2",50,0)
 I +$G(SKIPADD) G RETRAX
"RTN","TIURD2",51,0)
RTADD ; Retract all addenda
"RTN","TIURD2",52,0)
 N TIUDADD S TIUDADD=0
"RTN","TIURD2",53,0)
 F  S TIUDADD=$O(^TIU(8925,"DAD",TIUDA,TIUDADD)) Q:+TIUDADD'>0  D
"RTN","TIURD2",54,0)
 . I '$$ISADDNDM^TIULC1(TIUDADD) Q
"RTN","TIURD2",55,0)
 . D ADDENDEL^TIUALRT(TIUDADD)
"RTN","TIURD2",56,0)
 . S TIUNREC=$G(TIUNREC)_$S(+$G(TIUNREC):",",1:"")_$$RETRACT(TIUDADD,TIUDA,$G(COPYSTAT),$G(TIUNDAD))
"RTN","TIURD2",57,0)
RETRAX Q +$G(TIUNREC)
"RTN","TIURD2",58,0)
REMVSIT(DA,TIUOD0) ; Remove VISIT from Retracted Doc
"RTN","TIURD2",59,0)
 N DIE,DR,SVCAT,TIUPOP S TIUPOP=0
"RTN","TIURD2",60,0)
 S SVCAT=$P(TIUOD0,U,13)
"RTN","TIURD2",61,0)
 I +$$ISADDNDM^TIULC1(DA) D  Q:+TIUPOP
"RTN","TIURD2",62,0)
 . I +$P($G(^TIU(8925,+$P(TIUOD0,U,6),0)),U,3)>0 S TIUPOP=1 Q
"RTN","TIURD2",63,0)
 . S:SVCAT="" SVCAT=$P($G(^TIU(8925,+$P(TIUOD0,U,6),0)),U,13)
"RTN","TIURD2",64,0)
 I SVCAT="H" Q
"RTN","TIURD2",65,0)
 W !,"Removing RETRACTED ",TIUTNM," from original Visit..."
"RTN","TIURD2",66,0)
 S DIE=8925,DR=".03///@" D ^DIE
"RTN","TIURD2",67,0)
 Q
"RTN","TIURD2",68,0)
LINKADD(DA,TIUDAD) ; Link addendum (DA) to TIUDAD
"RTN","TIURD2",69,0)
 N DR,DIE
"RTN","TIURD2",70,0)
 S DIE=8925,DR=".06////^S X=TIUDAD" D ^DIE
"RTN","TIURD2",71,0)
 Q
"RTN","TIURD2",72,0)
COPY0(DA,TIUD0,TIU,TIUDAD,STATUS) ; Copy root node
"RTN","TIURD2",73,0)
 N DR,DIE S DIE=8925,STATUS=$G(STATUS,5)
"RTN","TIURD2",74,0)
 S DR=".02////"_DFN_";.03////"_$P(TIUD0,U,3)_";.04////"_$P(TIUD0,U,4)_";.05////"_STATUS_";.06////"_$P(TIUD0,U,6)_";.07////"_$P(TIUD0,U,7)_";.08////"_$P(TIUD0,U,8)_";.09////"_$P(TIUD0,U,9)_";.12////"_$P(TIUD0,U,12)_";.13////"_$P(TIUD0,U,13)
"RTN","TIURD2",75,0)
 I $P($G(TIUDPRM(0)),U,16),'$P($G(^TIU(8925,+DA,0)),U,11),$$WORKOK^TIUPXAP1(+DA) S DR=DR_";.11////1" ;set flag to collect workload
"RTN","TIURD2",76,0)
 D ^DIE
"RTN","TIURD2",77,0)
 Q
"RTN","TIURD2",78,0)
COPY12(DA,TIUD12,TIU) ; Copy 12-node
"RTN","TIURD2",79,0)
 N DR,DIE S DIE=8925
"RTN","TIURD2",80,0)
 S DR="1201////"_+$$NOW^XLFDT_";1202////"_+$P(TIUD12,U,2)_";1203////"_$P(TIUD12,U,3)_";1204////"_$P(TIUD12,U,4)_";1205////"_$P(TIUD12,U,5)
"RTN","TIURD2",81,0)
 S DR=DR_";1206////"_$P(TIUD12,U,6)_";1207////"_$P(TIUD12,U,7)_";1208////"_$P(TIUD12,U,8)_";1209////"_$P(TIUD12,U,9)
"RTN","TIURD2",82,0)
 S DR=DR_";1210////"_$P(TIUD12,U,10)_";1211////"_$P(TIUD12,U,11)
"RTN","TIURD2",83,0)
 D ^DIE
"RTN","TIURD2",84,0)
 Q
"RTN","TIURD2",85,0)
COPY13(DA,TIUD13,TIU,STATUS) ; Copy 13-node
"RTN","TIURD2",86,0)
 N DR,DIE,TIUDT,TIURDT S DIE=8925,TIUDT=$$NOW^XLFDT
"RTN","TIURD2",87,0)
 S TIURDT=$S(+$$ISDS^TIULX(+$G(^TIU(8925,DA,0))):+$$REFDATE^TIULC1(.TIU,TIUDT),1:TIUDT)
"RTN","TIURD2",88,0)
 S:'TIURDT TIURDT=TIUDT
"RTN","TIURD2",89,0)
 S DR="1301////"_TIURDT_";1302////"_$P(TIUD13,U,2)_";1303////O"
"RTN","TIURD2",90,0)
 S DR=DR_";1304////"_$S(STATUS<4:"@",1:TIUDT)
"RTN","TIURD2",91,0)
 S DR=DR_";1305////"_$S(STATUS<5:"@",1:TIUDT)
"RTN","TIURD2",92,0)
 S DR=DR_";1306////"_$S(STATUS<5:"@",+$P(TIUD13,U,6):$P(TIUD13,U,6),1:DUZ)
"RTN","TIURD2",93,0)
 S DR=DR_";1307////"_$P(TIUD13,U,7)
"RTN","TIURD2",94,0)
 D ^DIE
"RTN","TIURD2",95,0)
 Q
"RTN","TIURD2",96,0)
COPY14(DA,TIUD14,TIU) ; Copy 14-node
"RTN","TIURD2",97,0)
 N DR,DIE S DIE=8925
"RTN","TIURD2",98,0)
 S DR="1401////"_$P($G(TIU("AD#")),U)_";1402////"_$P($G(TIU("TS")),U)_";1404////"_$P($G(TIU("SVC")),U)
"RTN","TIURD2",99,0)
 D ^DIE
"RTN","TIURD2",100,0)
 Q
"RTN","TIURD2",101,0)
COPYSGNR(TIUDA,TIUCDA,COPYSTAT) ; Copy Add'nal Signers
"RTN","TIURD2",102,0)
 N TIUSDA S TIUSDA=0
"RTN","TIURD2",103,0)
 F  S TIUSDA=$O(^TIU(8925.7,"B",TIUDA,TIUSDA)) Q:+TIUSDA'>0  D
"RTN","TIURD2",104,0)
 . N TIUSD0,DA,DR,DIC,DIE,DLAYGO
"RTN","TIURD2",105,0)
 . S TIUSD0=$G(^TIU(8925.7,TIUSDA,0))
"RTN","TIURD2",106,0)
 . S (DIC,DLAYGO)=8925.7,DIC(0)="LX",X=""""_"`"_TIUCDA_"""" D ^DIC Q:+Y'>0
"RTN","TIURD2",107,0)
 . S DA=+Y,DIE=DIC,DR=".02////^S X=0;.03////^S X=$P(TIUSD0,U,3)"
"RTN","TIURD2",108,0)
 . I COPYSTAT>5 D
"RTN","TIURD2",109,0)
 . . S DR=DR_";.04////^S X=$P(TIUSD0,U,4);.05////^S X=$P(TIUSD0,U,5)"
"RTN","TIURD2",110,0)
 . . S DR=DR_";.06////^S X=$P(TIUSD0,U,6);.07////^S X=$P(TIUSD0,U,7)"
"RTN","TIURD2",111,0)
 . . S DR=DR_";.08////^S X=$P(TIUSD0,U,8)"
"RTN","TIURD2",112,0)
 . D ^DIE
"RTN","TIURD2",113,0)
 Q
"RTN","TIURD2",114,0)
COPY15(DA,TIUD15) ; Copy 15-node
"RTN","TIURD2",115,0)
 N DR,DIE S DIE=8925
"RTN","TIURD2",116,0)
 S DR="1501////"_$P(TIUD15,U)_";1502////"_$P(TIUD15,U,2)_";1503////^S X=$P(TIUD15,U,3);1504////^S X=$P(TIUD15,U,4)"
"RTN","TIURD2",117,0)
 S DR=DR_";1505////"_$P(TIUD15,U,5)_";1506////"_$P(TIUD15,U,6)_";1507////"_$P(TIUD15,U,7)_";1508////"_$P(TIUD15,U,8)
"RTN","TIURD2",118,0)
 S DR=DR_";1509////^S X=$P(TIUD15,U,9);1510////^S X=$P(TIUD15,U,10);1511////"_$P(TIUD15,U,11)_";1512////"_$P(TIUD15,U,12)
"RTN","TIURD2",119,0)
 S DR=DR_";1513////"_$P(TIUD15,U,13)
"RTN","TIURD2",120,0)
 D ^DIE
"RTN","TIURD2",121,0)
 Q
"RTN","TIURD2",122,0)
STATUS(DA) ; Set original's status to "RETRACTED"
"RTN","TIURD2",123,0)
 N DIE,DR,DIC
"RTN","TIURD2",124,0)
 S DIE=8925,DR=".05///RETRACTED" D ^DIE
"RTN","TIURD2",125,0)
 D ALERTDEL^TIUALRT(DA),DELIRT^TIUDIRT(DA)
"RTN","TIURD2",126,0)
 Q
"RTN","TIURD2",127,0)
ATTACH(TIUDA,TIUDADD) ; Attach TIUDADD as addendum to TIUDA
"RTN","TIURD2",128,0)
 N DR,DIE,DA,TIUD0,TIUD12,TIUD14,TIUDADA
"RTN","TIURD2",129,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIURD2",130,0)
 S DIE="^TIU(8925,",DA=TIUDADD
"RTN","TIURD2",131,0)
 S DR=".01////81;.02////^S X=$P(TIUD0,U,2);.03////^S X=$P(TIUD0,U,3);.04////^S X=$$DOCCLASS^TIULC1(81)"
"RTN","TIURD2",132,0)
 S DR=DR_";.06////^S X=TIUDA;.07////^S X=$P(TIUD0,U,7);.08////^S X=$P(TIUD0,U,8)"
"RTN","TIURD2",133,0)
 D ^DIE
"RTN","TIURD2",134,0)
 S DR="1205////^S X=$P(TIUD12,U,5);1211////^S X=$P(TIUD12,U,11)"
"RTN","TIURD2",135,0)
 D ^DIE
"RTN","TIURD2",136,0)
 S DR="1301////^S X="_$$REFDTA(TIUDA,TIUDADD,TIUD0)
"RTN","TIURD2",137,0)
 S DR=DR_";1401////^S X=$P(TIUD14,U);1402////^S X=$P(TIUD14,U,2)"
"RTN","TIURD2",138,0)
 D ^DIE
"RTN","TIURD2",139,0)
 ; If TIUDADD has addenda, re-attach them as addenda to TIUDA
"RTN","TIURD2",140,0)
 S TIUDADA=0
"RTN","TIURD2",141,0)
 F  S TIUDADA=$O(^TIU(8925,"DAD",TIUDADD,TIUDADA)) Q:+TIUDADA'>0  D
"RTN","TIURD2",142,0)
 . Q:'+$$ISADDNDM^TIULC1(TIUDADA)
"RTN","TIURD2",143,0)
 . D ATTACH(TIUDA,TIUDADA),SEND^TIUALRT(TIUDADA) W "."
"RTN","TIURD2",144,0)
 W !!,"Done." S TIUCHNG=1
"RTN","TIURD2",145,0)
 Q
"RTN","TIURD2",146,0)
REFDTO(TIUDA,TIU) ; Compute reference date
"RTN","TIURD2",147,0)
 N TIUY,TIUD12,TIUD13
"RTN","TIURD2",148,0)
 S TIUD12=$G(^TIU(8925,+TIUDA,12)),TIUD13=$G(^(13))
"RTN","TIURD2",149,0)
 S TIUY=+TIU("LDT")
"RTN","TIURD2",150,0)
 I TIUY>0 G REFDTOX
"RTN","TIURD2",151,0)
 I +$P(TIUD13,U,7) S TIUY=+$P(TIUD13,U,7) G REFDTOX
"RTN","TIURD2",152,0)
 S TIUY=+$P(TIUD12,U)
"RTN","TIURD2",153,0)
REFDTOX Q TIUY
"RTN","TIURD2",154,0)
REFDTA(TIUDA,TIUDADD,TIUD0) ; Compute reference date for addenda
"RTN","TIURD2",155,0)
 N TIUY,TIUDAD12,TIUDAD13
"RTN","TIURD2",156,0)
 S TIUDAD12=$G(^TIU(8925,+TIUDADD,12)),TIUDAD13=$G(^(13))
"RTN","TIURD2",157,0)
 S TIUY=+TIUDAD13
"RTN","TIURD2",158,0)
 I +$$ISDS^TIULX(+TIUD0)'>0 G REFDTAX
"RTN","TIURD2",159,0)
 I +$P(TIUDAD13,U) S TIUY=+$P(TIUDAD13,U) G REFDTAX
"RTN","TIURD2",160,0)
 I +$P(TIUDAD13,U,7) S TIUY=+$P(TIUDAD13,U,7) G REFDTAX
"RTN","TIURD2",161,0)
 S TIUY=+$P(TIUDAD12,U)
"RTN","TIURD2",162,0)
REFDTAX Q TIUY
"RTN","TIURD2",163,0)
UPDTADD(TIUDA) ; Addenda for reassigned original are updated
"RTN","TIURD2",164,0)
 I $$HASADDEN^TIULC1(+TIUDA) D
"RTN","TIURD2",165,0)
 . N DA
"RTN","TIURD2",166,0)
 . W !!,$C(7),"Addenda for this Document will now be updated..."
"RTN","TIURD2",167,0)
 . S DA=0 F  S DA=$O(^TIU(8925,"DAD",+TIUDA,DA)) Q:+DA'>0  D
"RTN","TIURD2",168,0)
 . . N DR,DIE,TIUD0,TIUD12,TIUD14
"RTN","TIURD2",169,0)
 . . I '+$$ISADDNDM^TIULC1(+DA) Q
"RTN","TIURD2",170,0)
 . . S TIUD0(0)=$G(^TIU(8925,+DA,0)),TIUD12(0)=$G(^(12))
"RTN","TIURD2",171,0)
 . . S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIURD2",172,0)
 . . S DR=".02////"_$P(TIUD0,U,2)_";.03////"_$S($P(TIUD0,U,3)="":"@",1:$P(TIUD0,U,3))_";.04////"_$P(TIUD0,U,4)_";.07////"_$P(TIUD0,U,7)_";.08////"_$S(+$P(TIUD0,U,8):$P(TIUD0,U,8),1:"@")_";.13////"_$P(TIUD0,U,13)
"RTN","TIURD2",173,0)
 . . S DR=DR_";1401////"_$P(TIUD14,U)_";1402////"_$P(TIUD14,U,2)
"RTN","TIURD2",174,0)
 . . S DIE=8925 D ^DIE
"RTN","TIURD2",175,0)
 . . S DR="1205////"_$P(TIUD12,U,5)_";1211////"_$P(TIUD12,U,11)
"RTN","TIURD2",176,0)
 . . D ^DIE
"RTN","TIURD2",177,0)
 . . S DR="1301////^S X="_$$REFDTA^TIURD2(TIUDA,DA,TIUD0)
"RTN","TIURD2",178,0)
 . . D ^DIE W "."
"RTN","TIURD2",179,0)
 . . ; Remove and resend alerts
"RTN","TIURD2",180,0)
 . . D SEND^TIUALRT(DA)
"RTN","TIURD2",181,0)
 . . S TIUD0(1)=$G(^TIU(8925,+DA,0)),TIUD12(1)=$G(^(12))
"RTN","TIURD2",182,0)
 . . D AUDREASS^TIURB1(DA,.TIUD0,.TIUD12)
"RTN","TIURD2",183,0)
 . . ; If the addendum was retracted, post its audit trail info as well
"RTN","TIURD2",184,0)
 . . I +$P($G(^TIU(8925,DA,14)),U,6) D
"RTN","TIURD2",185,0)
 . . . D AUDREASS^TIURB1(+$P(^TIU(8925,DA,14),U,6),.TIUD0,.TIUD12)
"RTN","TIURD2",186,0)
 Q
"RTN","TIURD2",187,0)
VLOC(LOCDA)     ; Resolve location pointer
"RTN","TIURD2",188,0)
 Q $P($G(^SC(LOCDA,0)),U)
"RTN","TIURD2",189,0)
GETSIG() ; Challenge user for Electronic Signature, when appropriate
"RTN","TIURD2",190,0)
 N X,X1,X2,TIUY S TIUY=0
"RTN","TIURD2",191,0)
 D SIG^XUSESIG
"RTN","TIURD2",192,0)
 I X1']"" D  G GETSIGX
"RTN","TIURD2",193,0)
 . W !!,$C(7),$C(7),"You MUST Enter your CORRECT Electronic Signature to Complete this Task...",!
"RTN","TIURD2",194,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIURD2",195,0)
 S TIUY=1
"RTN","TIURD2",196,0)
GETSIGX Q +$G(TIUY)
"RTN","TIURD4")
0^95^B14526406
"RTN","TIURD4",1,0)
TIURD4 ; SLC/JER - Reassign actions ;13-APR-2001 14:29:02
"RTN","TIURD4",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**61,100**;Jun 20, 1997
"RTN","TIURD4",3,0)
FROMTO(TIUDA,TIUDAT) ; Display the from/to information
"RTN","TIURD4",4,0)
 N TIUF,TIUT,TIUDAD,TIUFEDT,TIUFLDT,TIUTEDT,TIUTLDT
"RTN","TIURD4",5,0)
 S TIUDAD=$P($G(^TIU(8925,+TIUDA,0)),U,6)
"RTN","TIURD4",6,0)
 D GETTIU^TIULD(.TIUF,+TIUDAD)
"RTN","TIURD4",7,0)
 D GETTIU^TIULD(.TIUT,+TIUDAT)
"RTN","TIURD4",8,0)
 S TIUFEDT=$$DATE^TIULS($P(TIUF("EDT"),U),"MM/DD/YY")
"RTN","TIURD4",9,0)
 S TIUFLDT=$$DATE^TIULS($P(TIUF("LDT"),U),"MM/DD/YY")
"RTN","TIURD4",10,0)
 S TIUTEDT=$$DATE^TIULS($P(TIUT("EDT"),U),"MM/DD/YY")
"RTN","TIURD4",11,0)
 S TIUTLDT=$$DATE^TIULS($P(TIUT("LDT"),U),"MM/DD/YY")
"RTN","TIURD4",12,0)
 W !!,"You are about to move the addendum as follows:",!
"RTN","TIURD4",13,0)
 W !,?5,"From",?45,"To",!
"RTN","TIURD4",14,0)
 W !,$P(TIUF("DOCTYP"),U,2),?35," --> ",?40,$P(TIUT("DOCTYP"),U,2)
"RTN","TIURD4",15,0)
 W !,TIUF("PNM")," ",TIUF("PID"),?35," --> ",?40,TIUT("PNM")," ",TIUT("PID")
"RTN","TIURD4",16,0)
 W !,TIUFEDT,$S($L(TIUFLDT):" - "_TIUFLDT,1:""),?35," --> "
"RTN","TIURD4",17,0)
 W ?40,TIUTEDT,$S($L(TIUTLDT):" - "_TIUTLDT,1:""),!
"RTN","TIURD4",18,0)
 Q
"RTN","TIURD4",19,0)
UPDSTAT(DA)     ; Update the status of the named record
"RTN","TIURD4",20,0)
 N DIE,DR
"RTN","TIURD4",21,0)
 S DIE=8925,DR=".05///^S X=$$STATUS^TIULC(DA)"
"RTN","TIURD4",22,0)
 D ^DIE
"RTN","TIURD4",23,0)
 Q
"RTN","TIURD4",24,0)
LOADSB(TIUODA,TIUADA,TIUOS,TIUAS) ; Load arrays w/Sig Blocks
"RTN","TIURD4",25,0)
 N TIUOD15,TIUAD15
"RTN","TIURD4",26,0)
 S TIUOD15=$G(^TIU(8925,TIUODA,15))
"RTN","TIURD4",27,0)
 S TIUOS("SBN")=$S($P(TIUOD15,U,3)]"":$$DECRYPT(TIUODA,$P(TIUOD15,U,3)),1:"@")
"RTN","TIURD4",28,0)
 S TIUOS("SBT")=$S($P(TIUOD15,U,4)]"":$$DECRYPT(TIUODA,$P(TIUOD15,U,4)),1:"@")
"RTN","TIURD4",29,0)
 S TIUOS("CSBN")=$S($P(TIUOD15,U,9)]"":$$DECRYPT(TIUODA,$P(TIUOD15,U,9)),1:"@")
"RTN","TIURD4",30,0)
 S TIUOS("CSBT")=$S($P(TIUOD15,U,10)]"":$$DECRYPT(TIUODA,$P(TIUOD15,U,10)),1:"@")
"RTN","TIURD4",31,0)
 S TIUAD15=$G(^TIU(8925,TIUADA,15))
"RTN","TIURD4",32,0)
 S TIUAS("SBN")=$S($P(TIUAD15,U,3)]"":$$DECRYPT(TIUADA,$P(TIUAD15,U,3)),1:"@")
"RTN","TIURD4",33,0)
 S TIUAS("SBT")=$S($P(TIUAD15,U,4)]"":$$DECRYPT(TIUADA,$P(TIUAD15,U,4)),1:"@")
"RTN","TIURD4",34,0)
 S TIUAS("CSBN")=$S($P(TIUAD15,U,9)]"":$$DECRYPT(TIUADA,$P(TIUAD15,U,9)),1:"@")
"RTN","TIURD4",35,0)
 S TIUAS("CSBT")=$S($P(TIUAD15,U,10)]"":$$DECRYPT(TIUADA,$P(TIUAD15,U,10)),1:"@")
"RTN","TIURD4",36,0)
 Q
"RTN","TIURD4",37,0)
SWAPSB(TIUODA,TIUADA,TIUOS,TIUAS) ; Swap Signature blocks
"RTN","TIURD4",38,0)
 N DA,DIE,DR
"RTN","TIURD4",39,0)
 S DR="1503///^S X=TIUAS(""SBN"");1504///^S X=TIUAS(""SBT"")"
"RTN","TIURD4",40,0)
 S DR=DR_";1509///^S X=TIUAS(""CSBN"");1510///^S X=TIUAS(""CSBT"")"
"RTN","TIURD4",41,0)
 S DA=TIUODA,DIE="^TIU(8925," D ^DIE K DR
"RTN","TIURD4",42,0)
 S DR="1503///^S X=TIUOS(""SBN"");1504///^S X=TIUOS(""SBT"")"
"RTN","TIURD4",43,0)
 S DR=DR_";1509///^S X=TIUOS(""CSBN"");1510///^S X=TIUOS(""CSBT"")"
"RTN","TIURD4",44,0)
 S DA=TIUADA,DIE="^TIU(8925," D ^DIE K DR
"RTN","TIURD4",45,0)
 Q
"RTN","TIURD4",46,0)
DECRYPT(TIUDA,TIUX) ; Decrypt signature blocks
"RTN","TIURD4",47,0)
 N TIUY
"RTN","TIURD4",48,0)
 S TIUY=$$DECRYPT^TIULC1(TIUX,1,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIURD4",49,0)
 Q TIUY
"RTN","TIURD4",50,0)
RECOVER(TIUODA,TIUDA,TIUD0)     ; Restore original state on abort
"RTN","TIURD4",51,0)
 N DIE,DR,DA,DIDEL,TIUI
"RTN","TIURD4",52,0)
 W $C(7),$C(7),!!,"Transaction aborted. Restoring records to original state..."
"RTN","TIURD4",53,0)
 ; Loop thru ^TMP("TIURTRCT",$J,DA) and restore prior state
"RTN","TIURD4",54,0)
 I '$D(^TMP("TIURTRCT",$J,TIUODA)) D
"RTN","TIURD4",55,0)
 . W !!,"** Can't Restore to Prior State...'$D(^TMP(""TIURTRCT"",$J,TIUODA)) **"
"RTN","TIURD4",56,0)
 S TIUI=0 F  S TIUI=$O(^TMP("TIURTRCT",$J,TIUI)) Q:+TIUI'>0  D
"RTN","TIURD4",57,0)
 . N DIE,DR,X,Y,TIUD0,DA
"RTN","TIURD4",58,0)
 . S DA=TIUI,TIUD0=^TMP("TIURTRCT",$J,DA,0)
"RTN","TIURD4",59,0)
 . S DIE=8925
"RTN","TIURD4",60,0)
 . S DR=".03////^S X=$P(TIUD0,U,3);.05////^S X=$P(TIUD0,U,5);.06////^S X=$P(TIUD0,U,6)"
"RTN","TIURD4",61,0)
 . D ^DIE
"RTN","TIURD4",62,0)
 ; Loop thru ^TMP("TIURTRCT",$J,"NEW",DA) and delete duplicate notes
"RTN","TIURD4",63,0)
 I '$D(^TMP("TIURTRCT",$J,"NEW",TIUDA)) D
"RTN","TIURD4",64,0)
 . W !!,"** Can't Restore to Prior State...'$D(^TMP(""TIURTRCT"",$J,""NEW"",TIUDA)) **"
"RTN","TIURD4",65,0)
 S TIUI=0 F  S TIUI=$O(^TMP("TIURTRCT",$J,"NEW",TIUI)) Q:+TIUI'>0  D
"RTN","TIURD4",66,0)
 . D DELDOC(TIUI)
"RTN","TIURD4",67,0)
 H 3
"RTN","TIURD4",68,0)
 Q
"RTN","TIURD4",69,0)
DELDOC(DA) ; Delete document and components--NOT its addenda
"RTN","TIURD4",70,0)
 N DIE,DIDEL,DR,X,Y,TIUDA,TIUI
"RTN","TIURD4",71,0)
 S TIUDA=DA
"RTN","TIURD4",72,0)
 ; First, delete audit trail entries
"RTN","TIURD4",73,0)
 D DELAUDIT^TIUEDI1(TIUDA)
"RTN","TIURD4",74,0)
 D DELSGNRS(TIUDA)
"RTN","TIURD4",75,0)
 ; Next, delete the document's components
"RTN","TIURD4",76,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925,"DAD",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIURD4",77,0)
 . I +$$ISADDNDM^TIULC1(TIUI) Q
"RTN","TIURD4",78,0)
 . D DELDOC(TIUI)
"RTN","TIURD4",79,0)
 S (DIDEL,DIE)=8925,DR=".01///@"
"RTN","TIURD4",80,0)
 D ^DIE ; Delete duplicate note
"RTN","TIURD4",81,0)
 Q
"RTN","TIURD4",82,0)
DELSGNRS(TIUDA,UNSIGN) ; Remove Additional signers
"RTN","TIURD4",83,0)
 N DA S DA=0
"RTN","TIURD4",84,0)
 F  S DA=$O(^TIU(8925.7,"B",TIUDA,DA)) Q:+DA'>0  D
"RTN","TIURD4",85,0)
 . N DIK,DIDEL
"RTN","TIURD4",86,0)
 . I +$G(UNSIGN),(+$P(^TIU(8925.7,DA,0),U,4)>0) Q
"RTN","TIURD4",87,0)
 . S DIK="^TIU(8925.7,",DIDEL=8925.7 D ^DIK
"RTN","TIURD4",88,0)
 Q
"RTN","TIURECL")
0^41^B53577732
"RTN","TIURECL",1,0)
TIURECL ; SLC/PKR,JER - Expand/collapse LM views ;3/14/01
"RTN","TIURECL",2,0)
 ;;1.0;TEXT INTETRATION UTILITIES;**88,100**;Jun 20, 1997
"RTN","TIURECL",3,0)
 ;======================================================================
"RTN","TIURECL",4,0)
COPYCL(LSTART,START,END) ;Copy elements of List into ^TMP("TMPLIST",$J),
"RTN","TIURECL",5,0)
 ;starting at START going to END.
"RTN","TIURECL",6,0)
 N IND,TEXT
"RTN","TIURECL",7,0)
 S ^TMP("TMPLIST",$J,0)=$G(@VALMAR@(0))
"RTN","TIURECL",8,0)
 S ^TMP("TMPLIST",$J,"TIURIDX0")=$G(^TMP("TIURIDX",$J,0))
"RTN","TIURECL",9,0)
 ; -- Copy numbered lines: --
"RTN","TIURECL",10,0)
 F IND=START:1:END D:$D(@VALMAR@(IND,0))
"RTN","TIURECL",11,0)
 . S LSTART=LSTART+1
"RTN","TIURECL",12,0)
 . S TEXT=@VALMAR@(IND,0)
"RTN","TIURECL",13,0)
 . S TEXT=$$SETFLD^VALM1(LSTART,TEXT,"NUMBER")
"RTN","TIURECL",14,0)
 . S ^TMP("TMPLIST",$J,LSTART)=TEXT_U_$P($G(^TMP("TIURIDX",$J,IND)),U,2,4)
"RTN","TIURECL",15,0)
 ; -- Copy other nodes, skipping "IDX", "IEN", "EXPAND",
"RTN","TIURECL",16,0)
 ;    & "IDDATA", where I need >1 subscript: --
"RTN","TIURECL",17,0)
 S IND="A"
"RTN","TIURECL",18,0)
 F  S IND=$O(@VALMAR@(IND)) Q:IND=""  D
"RTN","TIURECL",19,0)
 . Q:$S(IND="IDX":1,IND="IEN":1,IND="EXPAND":1,IND="IDDATA":1,1:0)
"RTN","TIURECL",20,0)
 . S ^TMP("TMPLIST",$J,IND)=$G(@VALMAR@(IND))
"RTN","TIURECL",21,0)
 ; -- Copy "EXPAND" node: --
"RTN","TIURECL",22,0)
 S IND=0
"RTN","TIURECL",23,0)
 F  S IND=$O(@VALMAR@("EXPAND",IND)) Q:IND=""  D
"RTN","TIURECL",24,0)
 . S ^TMP("TMPLIST",$J,"EXPAND",IND)=$G(@VALMAR@("EXPAND",IND))
"RTN","TIURECL",25,0)
 ; -- Copy "IDDATA" node: --
"RTN","TIURECL",26,0)
 S IND=0
"RTN","TIURECL",27,0)
 F  S IND=$O(@VALMAR@("IDDATA",IND)) Q:IND=""  D
"RTN","TIURECL",28,0)
 . S ^TMP("TMPLIST",$J,"IDDATA",IND)=$G(@VALMAR@("IDDATA",IND))
"RTN","TIURECL",29,0)
 ; -- Copy "IEN" node: --
"RTN","TIURECL",30,0)
 S IND=0
"RTN","TIURECL",31,0)
 F  S IND=$O(@VALMAR@("IEN",IND)) Q:IND=""  D
"RTN","TIURECL",32,0)
 . N TIUJ S TIUJ=0
"RTN","TIURECL",33,0)
 . F  S TIUJ=$O(@VALMAR@("IEN",IND,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURECL",34,0)
 . . S ^TMP("TMPLIST",$J,"IEN",IND,TIUJ)=""
"RTN","TIURECL",35,0)
 Q LSTART
"RTN","TIURECL",36,0)
 ;
"RTN","TIURECL",37,0)
 ;======================================================================
"RTN","TIURECL",38,0)
EC(VALMY) ;Expand or contract the tree view in VALMY.
"RTN","TIURECL",39,0)
 ;Make sure the request is valid.
"RTN","TIURECL",40,0)
 I '$$VEXREQ^TIURECL1(.VALMY) Q
"RTN","TIURECL",41,0)
 N TIUI
"RTN","TIURECL",42,0)
 S TIUI=""
"RTN","TIURECL",43,0)
 ; -- Traverse pick list in reverse to avoid collisions: --
"RTN","TIURECL",44,0)
 F  S TIUI=$O(VALMY(TIUI),-1) Q:+TIUI'>0  D EC1(TIUI)
"RTN","TIURECL",45,0)
 Q
"RTN","TIURECL",46,0)
 ;
"RTN","TIURECL",47,0)
 ;======================================================================
"RTN","TIURECL",48,0)
EC1(TIUI,HUSH)  ; Expand a single List Element (line TIUI):
"RTN","TIURECL",49,0)
 ;    ORIGPFIX = $$PREFIX^TIULA2
"RTN","TIURECL",50,0)
 ;             = Indicators followed by space (if there are any).
"RTN","TIURECL",51,0)
 ;             EX:"+< ", or "*+< ", etc.
"RTN","TIURECL",52,0)
 ;    CURPFIX = Beginning characters of title/pt column, up to
"RTN","TIURECL",53,0)
 ;              but not including title/pt itself.
"RTN","TIURECL",54,0)
 ;            = Possible spacer characters (e.g. " |_"),
"RTN","TIURECL",55,0)
 ;              followed by possible indicators_space 
"RTN","TIURECL",56,0)
 ;              (if there are any).  If item is expanded,
"RTN","TIURECL",57,0)
 ;              indicators +, <, or +< may be replaced
"RTN","TIURECL",58,0)
 ;              with "-".
"RTN","TIURECL",59,0)
 ;            EX: "  |_- ", or "  |   |_", etc
"RTN","TIURECL",60,0)
 ; When getting indicators for new prefix, EC1 checks for changes
"RTN","TIURECL",61,0)
 ;in record being expanded (changes such as getting an addendum).
"RTN","TIURECL",62,0)
 ; EC1 updates prefix and ^TMP("TIURIDX",$J,listno) with such
"RTN","TIURECL",63,0)
 ;changes.
"RTN","TIURECL",64,0)
 ; EC1 does NOT update text of line, or ^TMP("TIUR",$J,"IDDATA",DA).
"RTN","TIURECL",65,0)
 N ORIGPFIX,CURPFIX,TIUGDATA,PRMSORT,NEWPFIX
"RTN","TIURECL",66,0)
 N TSTART,START,LISTNUM,REBUILD,TEXT
"RTN","TIURECL",67,0)
 N TIUDATA,TIUDA,TIUPICK
"RTN","TIURECL",68,0)
 S START=1,(REBUILD,TSTART)=0
"RTN","TIURECL",69,0)
 K ^TMP("TMPLIST",$J)
"RTN","TIURECL",70,0)
 S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI)) Q:'+TIUDATA
"RTN","TIURECL",71,0)
 S LISTNUM=$P(TIUDATA,U,1)
"RTN","TIURECL",72,0)
 ; -- Retrieve DA, current prefix; get original prefix: --
"RTN","TIURECL",73,0)
 S TIUDA=$P(TIUDATA,U,2),CURPFIX=$P(TIUDATA,U,3)
"RTN","TIURECL",74,0)
 S ORIGPFIX=$$PREFIX^TIULA2(TIUDA)
"RTN","TIURECL",75,0)
 S NEWPFIX=$$UPPFIX^TIURL1(TIUDA,CURPFIX)
"RTN","TIURECL",76,0)
 ; ---- If docmt cannot be expanded or collapsed, say so and quit: ----
"RTN","TIURECL",77,0)
 I ORIGPFIX'["+",ORIGPFIX'["<",CURPFIX'["-" D  Q
"RTN","TIURECL",78,0)
 . N MSG
"RTN","TIURECL",79,0)
 . D RESTORE^VALM10(TIUI)
"RTN","TIURECL",80,0)
 . I '+$G(HUSH) D
"RTN","TIURECL",81,0)
 . . S MSG="** Item #"_TIUI_" cannot be expanded/collapsed. **"
"RTN","TIURECL",82,0)
 . . D MSG^VALM10(MSG) H 2
"RTN","TIURECL",83,0)
 S TEXT=$G(@VALMAR@(LISTNUM,0))
"RTN","TIURECL",84,0)
 ; ---- If docmt not expanded & has addenda but no ID kids,
"RTN","TIURECL",85,0)
 ;      expand to show adda: ----
"RTN","TIURECL",86,0)
 I CURPFIX'["-",ORIGPFIX["+",ORIGPFIX'["<" D
"RTN","TIURECL",87,0)
 . S REBUILD=1
"RTN","TIURECL",88,0)
 . ; -- Set lines (from beg to line before TIUI) into ^TMP("TMPLIST",$J):
"RTN","TIURECL",89,0)
 . S TSTART=$$COPYCL(TSTART,START,LISTNUM-1)
"RTN","TIURECL",90,0)
 . S START=LISTNUM+1
"RTN","TIURECL",91,0)
 . ;-- Set line TIUI into ^TMP("TMPLIST",$J), updating flds NUMBER,
"RTN","TIURECL",92,0)
 . ;   and TITLE or PATIENT, with new prefix and spacing: --
"RTN","TIURECL",93,0)
 . S TSTART=TSTART+1
"RTN","TIURECL",94,0)
 . S TEXT=$$SETFLD^VALM1(TSTART,TEXT,"NUMBER")
"RTN","TIURECL",95,0)
 . S NEWPFIX=$S(NEWPFIX["+>":$TR(NEWPFIX,"+>","-"),1:$TR(NEWPFIX,"+","-"))
"RTN","TIURECL",96,0)
 . S TEXT=$$SETTLPT^TIURECL1(TEXT,TIUDA,NEWPFIX)
"RTN","TIURECL",97,0)
 . ; -- Save DA, prefixes, etc., for next time: --
"RTN","TIURECL",98,0)
 . S ^TMP("TMPLIST",$J,TSTART)=TEXT_U_TIUDA_U_NEWPFIX
"RTN","TIURECL",99,0)
 . ; -- Insert addenda of TIUI: --
"RTN","TIURECL",100,0)
 . S TSTART=$$INSADD^TIURECL2(TSTART,TIUDA,NEWPFIX)
"RTN","TIURECL",101,0)
 . ; -- Update EXPAND index to compensate for insertion: --
"RTN","TIURECL",102,0)
 . I TIUI<+$O(@VALMAR@("EXPAND",""),-1) D BUMPEXP(TIUI,TSTART)
"RTN","TIURECL",103,0)
 . ; -- Set new EXPAND node: --
"RTN","TIURECL",104,0)
 . S @VALMAR@("EXPAND",TIUI)=TIUDA
"RTN","TIURECL",105,0)
 ; ---- If tree view can be collapsed, then collapse it: ----
"RTN","TIURECL",106,0)
 I CURPFIX["-" D
"RTN","TIURECL",107,0)
 . N TEMP,CONTRACT,LEVEL
"RTN","TIURECL",108,0)
 . S REBUILD=1
"RTN","TIURECL",109,0)
 . S TSTART=$$COPYCL(TSTART,START,LISTNUM-1)
"RTN","TIURECL",110,0)
 . S TSTART=TSTART+1
"RTN","TIURECL",111,0)
 . S LEVEL=$L(TEXT,"|")
"RTN","TIURECL",112,0)
 . S TEXT=$$SETFLD^VALM1(TSTART,TEXT,"NUMBER")
"RTN","TIURECL",113,0)
 . S TEXT=$$SETTLPT^TIURECL1(TEXT,TIUDA,NEWPFIX)
"RTN","TIURECL",114,0)
 . S ^TMP("TMPLIST",$J,TSTART)=TEXT_U_TIUDA_U_NEWPFIX
"RTN","TIURECL",115,0)
 . S START=TIUI+1
"RTN","TIURECL",116,0)
 . S CONTRACT=1
"RTN","TIURECL",117,0)
 . F  Q:'CONTRACT  D
"RTN","TIURECL",118,0)
 .. S TEMP=$G(@VALMAR@(START,0))
"RTN","TIURECL",119,0)
 ..; -- Contract if at a higher level than the main line: --
"RTN","TIURECL",120,0)
 .. I TEMP["|",$L(TEMP,"|")>LEVEL S START=START+1
"RTN","TIURECL",121,0)
 .. E  S CONTRACT=0
"RTN","TIURECL",122,0)
 . I TIUI<+$O(@VALMAR@("EXPAND",""),-1) D SUCKEXP(START,TSTART)
"RTN","TIURECL",123,0)
 . K @VALMAR@("EXPAND",TIUI),^TMP("TMPLIST",$J,"EXPAND",TIUI)
"RTN","TIURECL",124,0)
 ; ---- If docmt has ID kids & hasn't
"RTN","TIURECL",125,0)
 ;    been expanded, then expand it to show ID kids: ----
"RTN","TIURECL",126,0)
 I CURPFIX'["-",ORIGPFIX["<" D
"RTN","TIURECL",127,0)
 . ; -- Retrieve ID entry order (from docmt parameter): --
"RTN","TIURECL",128,0)
 . ;    (Entry order should be ok even if rest needs update.)
"RTN","TIURECL",129,0)
 . S TIUGDATA=^TMP("TIUR",$J,"IDDATA",TIUDA)
"RTN","TIURECL",130,0)
 . S PRMSORT=$P(TIUGDATA,U,4)
"RTN","TIURECL",131,0)
 . S REBUILD=1
"RTN","TIURECL",132,0)
 . S TSTART=$$COPYCL(TSTART,START,LISTNUM-1)
"RTN","TIURECL",133,0)
 . S START=LISTNUM+1
"RTN","TIURECL",134,0)
 . S TSTART=TSTART+1
"RTN","TIURECL",135,0)
 . S TEXT=$$SETFLD^VALM1(TSTART,TEXT,"NUMBER")
"RTN","TIURECL",136,0)
 . S NEWPFIX=$S(NEWPFIX["+<":$TR(NEWPFIX,"+<","-"),NEWPFIX["<":$TR(NEWPFIX,"<","-"),1:$TR(NEWPFIX,"+","-"))
"RTN","TIURECL",137,0)
 . S TEXT=$$SETTLPT^TIURECL1(TEXT,TIUDA,NEWPFIX)
"RTN","TIURECL",138,0)
 . S ^TMP("TMPLIST",$J,TSTART)=TEXT_U_TIUDA_U_NEWPFIX
"RTN","TIURECL",139,0)
 . S TSTART=$$INSKIDS^TIURECL2(TSTART,TIUDA,NEWPFIX,PRMSORT)
"RTN","TIURECL",140,0)
 . S ^TMP("TMPLIST",$J,"IDDATA",TIUDA)=TIUGDATA
"RTN","TIURECL",141,0)
 . I TIUI<+$O(@VALMAR@("EXPAND",""),-1) D BUMPEXP(TIUI,TSTART)
"RTN","TIURECL",142,0)
 . ; -- Set new EXPAND node: --
"RTN","TIURECL",143,0)
 . S @VALMAR@("EXPAND",TIUI)=TIUDA
"RTN","TIURECL",144,0)
 ; -- Restore the original video attributes: --
"RTN","TIURECL",145,0)
 D RESTORE^VALM10(TIUI)
"RTN","TIURECL",146,0)
 I 'REBUILD Q
"RTN","TIURECL",147,0)
 ; ---- Add the rest of the list to ^TMP("TMPLIST",$J):
"RTN","TIURECL",148,0)
 S LISTNUM=$P(@VALMAR@(0),U,1)
"RTN","TIURECL",149,0)
 S TSTART=$$COPYCL(TSTART,START,LISTNUM)
"RTN","TIURECL",150,0)
 ; --Rebuild the LM ^TMP arrays: --
"RTN","TIURECL",151,0)
 K @VALMAR,^TMP("TIURIDX",$J)
"RTN","TIURECL",152,0)
 S VALMCNT=0
"RTN","TIURECL",153,0)
 S START=0,@VALMAR@(0)=^TMP("TMPLIST",$J,0)
"RTN","TIURECL",154,0)
 S ^TMP("TIURIDX",$J,0)=^TMP("TMPLIST",$J,"TIURIDX0")
"RTN","TIURECL",155,0)
 ; -- Rebuild numbered lines and IDX and TIURIDX nodes: --
"RTN","TIURECL",156,0)
 N CURPFX
"RTN","TIURECL",157,0)
 F  S START=$O(^TMP("TMPLIST",$J,START)) Q:+START'>0  D
"RTN","TIURECL",158,0)
 . S VALMCNT=VALMCNT+1
"RTN","TIURECL",159,0)
 . S TEMP=^TMP("TMPLIST",$J,START)
"RTN","TIURECL",160,0)
 . S TEXT=$P(TEMP,U),TIUDA=$P(TEMP,U,2),CURPFX=$P(TEMP,U,3)
"RTN","TIURECL",161,0)
 . S @VALMAR@(START,0)=TEXT
"RTN","TIURECL",162,0)
 . D RESTORE^VALM10(START)
"RTN","TIURECL",163,0)
 . S @VALMAR@("IDX",START,START)=""
"RTN","TIURECL",164,0)
 . S ^TMP("TIURIDX",$J,START)=START_U_TIUDA_U_CURPFX
"RTN","TIURECL",165,0)
 . S @VALMAR@("IEN",TIUDA,START)=""
"RTN","TIURECL",166,0)
 S $P(@VALMAR@(0),U)=VALMCNT
"RTN","TIURECL",167,0)
 ; -- Rebuild other nodes: --
"RTN","TIURECL",168,0)
 S START="A"
"RTN","TIURECL",169,0)
 F  S START=$O(^TMP("TMPLIST",$J,START)) Q:START=""  D
"RTN","TIURECL",170,0)
 . Q:START="EXPAND"
"RTN","TIURECL",171,0)
 . Q:START="IDDATA"
"RTN","TIURECL",172,0)
 . Q:START="IEN"
"RTN","TIURECL",173,0)
 . S @VALMAR@(START)=$G(^TMP("TMPLIST",$J,START))
"RTN","TIURECL",174,0)
 ; -- Rebuild EXPAND node: --
"RTN","TIURECL",175,0)
 S START=0
"RTN","TIURECL",176,0)
 F  S START=$O(^TMP("TMPLIST",$J,"EXPAND",START)) Q:+START'>0  D
"RTN","TIURECL",177,0)
 . S @VALMAR@("EXPAND",START)=$G(^TMP("TMPLIST",$J,"EXPAND",START))
"RTN","TIURECL",178,0)
 ; -- Rebuild IDDATA node: --
"RTN","TIURECL",179,0)
 S START=0
"RTN","TIURECL",180,0)
 F  S START=$O(^TMP("TMPLIST",$J,"IDDATA",START)) Q:+START'>0  D
"RTN","TIURECL",181,0)
 . Q:'$D(@VALMAR@("IEN",START))
"RTN","TIURECL",182,0)
 . S @VALMAR@("IDDATA",START)=$G(^TMP("TMPLIST",$J,"IDDATA",START))
"RTN","TIURECL",183,0)
 ; -- Rebuild # node: --
"RTN","TIURECL",184,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIURECL",185,0)
 S @VALMAR@("#")=TIUPICK_U_"1:"_+$G(VALMCNT)
"RTN","TIURECL",186,0)
 ; -- Update # of documents in header: --
"RTN","TIURECL",187,0)
 K VALMHDR,^TMP("TMPLIST",$J)
"RTN","TIURECL",188,0)
 Q
"RTN","TIURECL",189,0)
 ;=======================================================================
"RTN","TIURECL",190,0)
BUMPEXP(TIUI,TSTART)    ; Bump EXPAND index to compensate for insertion
"RTN","TIURECL",191,0)
 N TIUJ,GAP S TIUJ="",GAP=TSTART-TIUI
"RTN","TIURECL",192,0)
 F  S TIUJ=$O(@VALMAR@("EXPAND",TIUJ),-1) Q:TIUJ'>TIUI  D
"RTN","TIURECL",193,0)
 . S @VALMAR@("EXPAND",TIUJ+GAP)=$G(@VALMAR@("EXPAND",TIUJ))
"RTN","TIURECL",194,0)
 . K @VALMAR@("EXPAND",TIUJ),^TMP("TMPLIST",$J,"EXPAND",TIUJ)
"RTN","TIURECL",195,0)
 Q
"RTN","TIURECL",196,0)
 ;=======================================================================
"RTN","TIURECL",197,0)
SUCKEXP(START,TSTART)    ; Remove EXPAND index to compensate for collapse
"RTN","TIURECL",198,0)
 N TIUJ,GAP S TIUJ=START,GAP=(START-TSTART)-1
"RTN","TIURECL",199,0)
 F  S TIUJ=$O(@VALMAR@("EXPAND",TIUJ)) Q:TIUJ'>0  D
"RTN","TIURECL",200,0)
 . S @VALMAR@("EXPAND",TIUJ-GAP)=$G(@VALMAR@("EXPAND",TIUJ))
"RTN","TIURECL",201,0)
 . K @VALMAR@("EXPAND",TIUJ),^TMP("TMPLIST",$J,"EXPAND",TIUJ)
"RTN","TIURECL",202,0)
 Q
"RTN","TIURECL1")
0^44^B32764020
"RTN","TIURECL1",1,0)
TIURECL1 ; SLC/PKR,JER - Expand/collapse LM views ;3/14/01
"RTN","TIURECL1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURECL1",3,0)
 ; 7/6 Split TIURECL into TIURECL & TIURECL1, move RESOLVE to TIURECL1
"RTN","TIURECL1",4,0)
 ; 7/10 Move INSID, INSADD, VEXREQ, ISSUB to TIURECL1
"RTN","TIURECL1",5,0)
 ; 9/7 Move INSKIDS, INSADD, & associated modules to TIURECL2
"RTN","TIURECL1",6,0)
 ;=======================================================================
"RTN","TIURECL1",7,0)
ISSUB(CLASS1,CLASS2,LEVEL) ;Return true if CLASS2 is sub to CLASS1.
"RTN","TIURECL1",8,0)
 N IND,ISSUB
"RTN","TIURECL1",9,0)
 I LEVEL(CLASS1)'<LEVEL(CLASS2) Q 0
"RTN","TIURECL1",10,0)
 ;Check sublevel links between class1 and class2
"RTN","TIURECL1",11,0)
 S ISSUB=1
"RTN","TIURECL1",12,0)
 F IND=(CLASS1+1):1:(CLASS2-1) D
"RTN","TIURECL1",13,0)
 . I LEVEL(IND)=1 D  Q
"RTN","TIURECL1",14,0)
 .. S ISSUB=0
"RTN","TIURECL1",15,0)
 Q ISSUB
"RTN","TIURECL1",16,0)
 ;
"RTN","TIURECL1",17,0)
 ;======================================================================
"RTN","TIURECL1",18,0)
VEXREQ(VALMY) ;Check for valid expand/contract requests.
"RTN","TIURECL1",19,0)
 ; A list of documents to expand/contract is invalid if any docmt
"RTN","TIURECL1",20,0)
 ;is a sub docmt of another docmt on the list.
"RTN","TIURECL1",21,0)
 N END,START
"RTN","TIURECL1",22,0)
 S START=$O(VALMY(""))
"RTN","TIURECL1",23,0)
 S END=$O(VALMY(""),-1)
"RTN","TIURECL1",24,0)
 I START=END Q 1
"RTN","TIURECL1",25,0)
 ;
"RTN","TIURECL1",26,0)
 N ACTION,ACTIND,ACTJND,CIND,CN,IND,JND,LEVEL,MSG,TEXT,VALID
"RTN","TIURECL1",27,0)
 ;Build the level list.
"RTN","TIURECL1",28,0)
 F IND=START:1:END D
"RTN","TIURECL1",29,0)
 . S LEVEL(IND)=$L(@VALMAR@(IND,0),"|")
"RTN","TIURECL1",30,0)
 S VALID=1
"RTN","TIURECL1",31,0)
 S IND=""
"RTN","TIURECL1",32,0)
 F  S IND=$O(VALMY(IND)) Q:+IND'>0  D
"RTN","TIURECL1",33,0)
 . S TEXT(IND)=$G(@VALMAR@(IND,0))
"RTN","TIURECL1",34,0)
 . S ACTIND=$S(TEXT(IND)["+":"+ ",TEXT(IND)["-":"-",1:"")
"RTN","TIURECL1",35,0)
 . I ACTIND="" Q
"RTN","TIURECL1",36,0)
 . S ACTION(IND)=$S(TEXT(IND)["+":"expand ",TEXT(IND)["-":"collapse ",1:"")
"RTN","TIURECL1",37,0)
 . S JND=IND
"RTN","TIURECL1",38,0)
 . F  S JND=$O(VALMY(JND)) Q:+JND'>0  D
"RTN","TIURECL1",39,0)
 .. S TEXT(JND)=$G(@VALMAR@(JND,0))
"RTN","TIURECL1",40,0)
 .. S ACTJND=$S(TEXT(JND)["+":"+",TEXT(JND)["-":"-",1:"")
"RTN","TIURECL1",41,0)
 .. I ACTJND="" Q
"RTN","TIURECL1",42,0)
 .. S ACTION(JND)=$S(TEXT(JND)["+":"expand ",TEXT(JND)["-":"collapse ",1:"")
"RTN","TIURECL1",43,0)
 .. I $$ISSUB(IND,JND,.LEVEL) D
"RTN","TIURECL1",44,0)
 ... I ACTION(IND)'=ACTION(JND) D  Q
"RTN","TIURECL1",45,0)
 .... S CIND(IND)=$P(^TMP("TIURIDX",$J,IND),U,2)
"RTN","TIURECL1",46,0)
 .... S CN(IND)=$P(^TIU(8925,CIND(IND),0),U,1)
"RTN","TIURECL1",47,0)
 .... S CIND(JND)=$P(^TMP("TIURIDX",$J,JND),U,2)
"RTN","TIURECL1",48,0)
 .... S CN(JND)=$P(^TIU(8925,CIND(JND),0),U,1)
"RTN","TIURECL1",49,0)
 .... I '+$G(HUSH) D
"RTN","TIURECL1",50,0)
 ..... S MSG="You cannot "_ACTION(IND)_CN(IND)_" and "_ACTION(JND)_CN(JND)
"RTN","TIURECL1",51,0)
 ..... D MSG^VALM10(MSG)
"RTN","TIURECL1",52,0)
 ..... H 4
"RTN","TIURECL1",53,0)
 .... S VALID=0
"RTN","TIURECL1",54,0)
 Q VALID
"RTN","TIURECL1",55,0)
 ;======================================================================
"RTN","TIURECL1",56,0)
IDDATA(TIUDA,TIUD0,TIUD21) ; Return TIUGDATA:
"RTN","TIURECL1",57,0)
 ; TIUGDATA = 0 or
"RTN","TIURECL1",58,0)
 ;        = TIUDA^haskid^IDparent^prmsort, where
"RTN","TIURECL1",59,0)
 ;           TIUDA = note DA
"RTN","TIURECL1",60,0)
 ;          haskid = 1 if note has ID kid, else 0
"RTN","TIURECL1",61,0)
 ;        IDparent = parent DA if note has ID parent, else 0
"RTN","TIURECL1",62,0)
 ;         prmsort = 'TITLE' if entries ordered by title, else 'REFDT'
"RTN","TIURECL1",63,0)
 ;Note: TIUGDATA is nonzero if note is POSSIBLE DAD, or dad, or kid.
"RTN","TIURECL1",64,0)
 ; Requires TIUDA; TIUD0 & TIUD21 are optional
"RTN","TIURECL1",65,0)
 N HASIDKID,POSSPRNT,TIUDPRM,PRMSORT,TIUGDATA
"RTN","TIURECL1",66,0)
 I '$G(TIUD0) S TIUD0=^TIU(8925,TIUDA,0)
"RTN","TIURECL1",67,0)
 I '$D(TIUD21) S TIUD21=+$G(^TIU(8925,TIUDA,21))
"RTN","TIURECL1",68,0)
 S (TIUGDATA,POSSPRNT)=0
"RTN","TIURECL1",69,0)
 S HASIDKID=$$HASIDKID^TIUGBR(TIUDA)
"RTN","TIURECL1",70,0)
 I 'TIUD21,'HASIDKID S POSSPRNT=$$POSSPRNT^TIULP(+TIUD0) ;has bus rules
"RTN","TIURECL1",71,0)
 I TIUD21!HASIDKID!POSSPRNT D
"RTN","TIURECL1",72,0)
 . I 'TIUD21 D  I 1
"RTN","TIURECL1",73,0)
 . . D DOCPRM^TIULC1(+TIUD0,.TIUDPRM)
"RTN","TIURECL1",74,0)
 . . S PRMSORT=$S($P($G(TIUDPRM(0)),U,18):"TITLE",1:"REFDT")
"RTN","TIURECL1",75,0)
 . E  S PRMSORT=""
"RTN","TIURECL1",76,0)
 . S TIUGDATA=TIUDA_U_HASIDKID_U_TIUD21_U_PRMSORT
"RTN","TIURECL1",77,0)
 Q TIUGDATA
"RTN","TIURECL1",78,0)
 ;
"RTN","TIURECL1",79,0)
RESOLVE(DA,TSTART,FIRSTPFX,XIDDATA) ; Get document data for insertion
"RTN","TIURECL1",80,0)
 ;  Receives DA, TSTART, FIRSTPFX
"RTN","TIURECL1",81,0)
 ;    FIRSTPFX = $$INSPFIX of parent of inserted document.
"RTN","TIURECL1",82,0)
 ;  Returns line TSTART.
"RTN","TIURECL1",83,0)
 ;  Receives XIDDATA by ref, finds it, and passes it back.
"RTN","TIURECL1",84,0)
 N DIC,DIQ,DR,TIUR,PT,MOM,ADT,DDT,LCT,AUT,AMD,EDT,SDT,XDT,RMD,TIULST4
"RTN","TIURECL1",85,0)
 N TIUP,TIUD0,TIUD12,TIUD13,TIUD15,TIULI,STATX,DOC,TIUY,TIUI,TIUFLDS
"RTN","TIURECL1",86,0)
 N PREFIX,GETTL,GETPT,TIUD21
"RTN","TIURECL1",87,0)
 I '$D(^TIU(8925,DA,0)) S TIUY="Record #"_DA_" is missing." G RESOLVEX
"RTN","TIURECL1",88,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIURECL1",89,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIURECL1",90,0)
 S TIUD21=$G(^TIU(8925,+DA,21))
"RTN","TIURECL1",91,0)
 S XIDDATA=$$IDDATA(DA,TIUD0,TIUD21)
"RTN","TIURECL1",92,0)
 S PREFIX=$$PREFIX^TIULA2(DA),PREFIX=FIRSTPFX_PREFIX
"RTN","TIURECL1",93,0)
 S GETTL=$$GETTL(TIUD0,PREFIX)
"RTN","TIURECL1",94,0)
 ; Most screens have docmt title in 1st column, but some have pat nm:
"RTN","TIURECL1",95,0)
 S DOC=$S($D(VALMDDF("PATIENT NAME")):$P(GETTL,U),1:$P(GETTL,U,2)_$P(GETTL,U))
"RTN","TIURECL1",96,0)
 S TIUFLDS("DOCUMENT TYPE")="DOC"
"RTN","TIURECL1",97,0)
 S TIUFLDS("TITLE")="DOC"
"RTN","TIURECL1",98,0)
 S GETPT=$$GETPT(TIUD0,PREFIX)
"RTN","TIURECL1",99,0)
 S TIULI=$E(GETPT)
"RTN","TIURECL1",100,0)
 S PT=$P(GETPT,U,2)_$P(GETPT,U)
"RTN","TIURECL1",101,0)
 S TIUFLDS("PATIENT NAME")="PT"
"RTN","TIURECL1",102,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIURECL1",103,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIURECL1",104,0)
 S TIUFLDS("LAST I/LAST 4")="TIULST4"
"RTN","TIURECL1",105,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIURECL1",106,0)
 S TIUFLDS("ADMISSION DATE")="ADT"
"RTN","TIURECL1",107,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY"),LCT=$P(TIUD0,U,10)
"RTN","TIURECL1",108,0)
 S TIUFLDS("DISCH DATE")="DDT"
"RTN","TIURECL1",109,0)
 S TIUFLDS("LINE COUNT")="AMD"
"RTN","TIURECL1",110,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIURECL1",111,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIURECL1",112,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIURECL1",113,0)
 S TIUFLDS("ATTENDING")="AMD"
"RTN","TIURECL1",114,0)
 S TIUFLDS("COSIGNER")="AMD"
"RTN","TIURECL1",115,0)
 I $D(^TMP("TIUR",$J,"CTXT")) S AUT=$$NAME^TIULS(AUT,"LAST,FI") I 1
"RTN","TIURECL1",116,0)
 E  S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIURECL1",117,0)
 S TIUFLDS("AUTHOR")="AUT"
"RTN","TIURECL1",118,0)
 I $D(^TMP("TIUR",$J,"CTXT")) S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY HR:MIN") I 1
"RTN","TIURECL1",119,0)
 E  S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY")
"RTN","TIURECL1",120,0)
 S TIUFLDS("REF DATE")="EDT"
"RTN","TIURECL1",121,0)
 S XDT=$$DATE^TIULS($P(TIUD13,U,7),"MM/DD/YY")
"RTN","TIURECL1",122,0)
 S TIUFLDS("DICT DATE")="XDT"
"RTN","TIURECL1",123,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIURECL1",124,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURECL1",125,0)
 S TIUFLDS("SIG DATE")="SDT"
"RTN","TIURECL1",126,0)
 S STATX=$$LOW^XLFSTR($P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U))
"RTN","TIURECL1",127,0)
 S TIUFLDS("STATUS")="STATX"
"RTN","TIURECL1",128,0)
 S (TIUI,TIUY)=""
"RTN","TIURECL1",129,0)
 S TIUY=$$SETFLD^VALM1(TSTART,TIUY,"NUMBER")
"RTN","TIURECL1",130,0)
 F  S TIUI=$O(TIUFLDS(TIUI)) Q:TIUI=""  D
"RTN","TIURECL1",131,0)
 . S:$D(VALMDDF(TIUI)) TIUY=$$SETFLD^VALM1(@TIUFLDS(TIUI),TIUY,TIUI)
"RTN","TIURECL1",132,0)
RESOLVEX Q TIUY
"RTN","TIURECL1",133,0)
 ;
"RTN","TIURECL1",134,0)
GETPT(TIUD0,PREFIX) ; Get patient column data; put updated prefix data
"RTN","TIURECL1",135,0)
 ;in second ^ piece
"RTN","TIURECL1",136,0)
 ;  Receives TIUDO, PREFIX.
"RTN","TIURECL1",137,0)
 ;  Returns (patient col data)^PREFIX
"RTN","TIURECL1",138,0)
 N TIUY
"RTN","TIURECL1",139,0)
 S TIUY=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIURECL1",140,0)
 I $D(PREFIX) S TIUY=TIUY_U_PREFIX
"RTN","TIURECL1",141,0)
 Q TIUY
"RTN","TIURECL1",142,0)
 ;
"RTN","TIURECL1",143,0)
GETTL(TIUD0,PREFIX) ; Get title column data; put updated prefix
"RTN","TIURECL1",144,0)
 ;data in second ^ piece.
"RTN","TIURECL1",145,0)
 ;  Receives TIUDO, PREFIX.
"RTN","TIURECL1",146,0)
 ;  Returns (title col data)^PREFIX
"RTN","TIURECL1",147,0)
 N TIUY
"RTN","TIURECL1",148,0)
 S TIUY=$$PNAME^TIULC1(+TIUD0)
"RTN","TIURECL1",149,0)
 I TIUY="Addendum" S TIUY="Addendum to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIURECL1",150,0)
 I $D(PREFIX) S TIUY=TIUY_U_PREFIX
"RTN","TIURECL1",151,0)
 Q TIUY
"RTN","TIURECL1",152,0)
 ;
"RTN","TIURECL1",153,0)
SETTLPT(STRING,DA,PREFIX) ; Set field TITLE or PATIENT into string,
"RTN","TIURECL1",154,0)
 ;with prefix as first chars of string.
"RTN","TIURECL1",155,0)
 ;  Receives STRING, DA, PREFIX:
"RTN","TIURECL1",156,0)
 ;    PREFIX = beginning chars of title/pt column, up to but not
"RTN","TIURECL1",157,0)
 ;             including title/pt itself.
"RTN","TIURECL1",158,0)
 ;  Returns STRING.
"RTN","TIURECL1",159,0)
 N PT,DOC,TIUD0
"RTN","TIURECL1",160,0)
 S TIUD0=^TIU(8925,DA,0)
"RTN","TIURECL1",161,0)
 I $D(VALMDDF("PATIENT NAME")) D  I 1
"RTN","TIURECL1",162,0)
 . S PT=$$GETPT(TIUD0,PREFIX)
"RTN","TIURECL1",163,0)
 . S PT=$P(PT,U,2)_$P(PT,U)
"RTN","TIURECL1",164,0)
 . S STRING=$$SETFLD^VALM1(PT,STRING,"PATIENT NAME")
"RTN","TIURECL1",165,0)
 E  D
"RTN","TIURECL1",166,0)
 . S DOC=$$GETTL(TIUD0,PREFIX)
"RTN","TIURECL1",167,0)
 . S DOC=$P(DOC,U,2)_$P(DOC,U)
"RTN","TIURECL1",168,0)
 . S STRING=$$SETFLD^VALM1(DOC,STRING,"TITLE")
"RTN","TIURECL1",169,0)
 Q STRING
"RTN","TIURECL2")
0^49^B8811306
"RTN","TIURECL2",1,0)
TIURECL2 ; SLC/MAM - Expand/collapse LM views ;1/22/01
"RTN","TIURECL2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURECL2",3,0)
 ; 7/6 Split TIURECL into TIURECL & TIURECL1, move RESOLVE to TIURECL1
"RTN","TIURECL2",4,0)
 ; 7/10 Move INSID, INSADD, VEXREQ, ISSUB to TIURECL1
"RTN","TIURECL2",5,0)
 ; 9/7 Move INSKIDS, INSADD & associated mods from TIURECL1 TO ECL2
"RTN","TIURECL2",6,0)
 ;=======================================================================
"RTN","TIURECL2",7,0)
INSKIDS(TSTART,TIUDA,PRNTPFIX,SORTBY) ;Insert ID kids
"RTN","TIURECL2",8,0)
 ;of parent TIUDA into array ^TMP("TMPLIST",$J) in SORTBY order
"RTN","TIURECL2",9,0)
 ;  Receives TSTART, TIUDA, PRNTPFIX, SORTBY
"RTN","TIURECL2",10,0)
 ;       TIUDA = ID parent
"RTN","TIURECL2",11,0)
 ;    PRNTPFIX = prefix of parent, updated for current expand action.
"RTN","TIURECL2",12,0)
 ;      SORTBY = "REFDT" or "TITLE"
"RTN","TIURECL2",13,0)
 N KIDDATA,KIDDA,TEXT,FRSTPFIX,ORIGPFIX,NEWPFIX,KIDLIST,TIUK
"RTN","TIURECL2",14,0)
 ; -- If ID parent has addenda at the parent level,
"RTN","TIURECL2",15,0)
 ;    as well as ID kids, then first insert addenda: --
"RTN","TIURECL2",16,0)
 I $$HASADDEN^TIULC1(TIUDA) S TSTART=$$INSADD(TSTART,TIUDA,PRNTPFIX)
"RTN","TIURECL2",17,0)
 ; -- Get list of ID kids in ref date or title order: --
"RTN","TIURECL2",18,0)
 D GETIDKID(TIUDA,SORTBY)
"RTN","TIURECL2",19,0)
 ; -- Set LIST(TSTART)=TEXT_U_KIDDA_U_NEWPFIX and
"RTN","TIURECL2",20,0)
 ;    ^TMP("TMPLIST",$J,"IDDATA",KIDDA)
"RTN","TIURECL2",21,0)
 S TIUK=0
"RTN","TIURECL2",22,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:'TIUK  D
"RTN","TIURECL2",23,0)
 . S KIDDA=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIURECL2",24,0)
 . S TSTART=TSTART+1
"RTN","TIURECL2",25,0)
 . S ^TMP("TMPLIST",$J,TSTART)=$$GETLINE(KIDDA,PRNTPFIX,TSTART,.KIDDATA)
"RTN","TIURECL2",26,0)
 . S ^TMP("TMPLIST",$J,"IDDATA",KIDDA)=KIDDATA
"RTN","TIURECL2",27,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIURECL2",28,0)
 Q TSTART
"RTN","TIURECL2",29,0)
 ;
"RTN","TIURECL2",30,0)
GETIDKID(TIUDA,SORTBY) ; Set ^TMP("TIUIDKID",$J,TIUDA,TIUK) = KIDDA,
"RTN","TIURECL2",31,0)
 ; array of ID kids of TIUDA, in SORTBY order
"RTN","TIURECL2",32,0)
 N KIDDA,REFDT,TITLE,TIUJ,LIST,TIUK
"RTN","TIURECL2",33,0)
 S KIDDA=0,TIUJ=0
"RTN","TIURECL2",34,0)
 F  S KIDDA=$O(^TIU(8925,"GDAD",TIUDA,KIDDA)) Q:+KIDDA'>0  D
"RTN","TIURECL2",35,0)
 . S TIUJ=TIUJ+1
"RTN","TIURECL2",36,0)
 . S REFDT=$P(^TIU(8925,KIDDA,13),U)
"RTN","TIURECL2",37,0)
 . I SORTBY="REFDT" S LIST("HOLDER",REFDT,TIUJ)=KIDDA
"RTN","TIURECL2",38,0)
 . I SORTBY="TITLE" S TITLE=$$PNAME^TIULC1(+^TIU(8925,KIDDA,0)),LIST(TITLE,REFDT,TIUJ)=KIDDA
"RTN","TIURECL2",39,0)
 ; -- Flatten the list: --
"RTN","TIURECL2",40,0)
 S TITLE="",REFDT=0,TIUJ=0,TIUK=0
"RTN","TIURECL2",41,0)
 F  S TITLE=$O(LIST(TITLE)) Q:TITLE=""  D
"RTN","TIURECL2",42,0)
 . F  S REFDT=$O(LIST(TITLE,REFDT)) Q:'REFDT  D
"RTN","TIURECL2",43,0)
 . . F  S TIUJ=$O(LIST(TITLE,REFDT,TIUJ)) Q:'TIUJ  D
"RTN","TIURECL2",44,0)
 . . . S TIUK=TIUK+1
"RTN","TIURECL2",45,0)
 . . . S ^TMP("TIUIDKID",$J,TIUDA,TIUK)=LIST(TITLE,REFDT,TIUJ)
"RTN","TIURECL2",46,0)
 Q
"RTN","TIURECL2",47,0)
 ;
"RTN","TIURECL2",48,0)
GETLINE(KIDDA,PRNTPFIX,LINENO,TIUGDATA) ; Return LINE=TEXT_U_KIDDA_U_NEWPFIX
"RTN","TIURECL2",49,0)
 ; Find & pass back TIUGDATA
"RTN","TIURECL2",50,0)
 N LINE,ORIGPFIX,NEWPFIX,TEXT,FRSTPFIX
"RTN","TIURECL2",51,0)
 S ORIGPFIX=$$PREFIX^TIULA2(KIDDA)
"RTN","TIURECL2",52,0)
 S FRSTPFIX=$$FRSTPFIX(PRNTPFIX)
"RTN","TIURECL2",53,0)
 S TEXT=$$RESOLVE^TIURECL1(KIDDA,LINENO,FRSTPFIX,.TIUGDATA)
"RTN","TIURECL2",54,0)
 S NEWPFIX=FRSTPFIX_ORIGPFIX
"RTN","TIURECL2",55,0)
 S LINE=TEXT_U_KIDDA_U_NEWPFIX
"RTN","TIURECL2",56,0)
 Q LINE
"RTN","TIURECL2",57,0)
 ;
"RTN","TIURECL2",58,0)
FRSTPFIX(PRNTPFIX) ; Return first part of Prefix for Inserted addm
"RTN","TIURECL2",59,0)
 ;or ID kid of parent.
"RTN","TIURECL2",60,0)
 ;    Receives PRNTPFIX; returns FRSTPFIX.
"RTN","TIURECL2",61,0)
 ;    PRNTPFIX = prefix of parent, updated for current expand action.
"RTN","TIURECL2",62,0)
 ; -- Build first part of kid prefix using PRNTPFIX: --
"RTN","TIURECL2",63,0)
 ;    EX: if updated prefix of parent is "  |_- ",
"RTN","TIURECL2",64,0)
 ;        then build FRSTPFIX from left to right:
"RTN","TIURECL2",65,0)
 ;        Take beginning spaces "  ", keep the "|", replace the _
"RTN","TIURECL2",66,0)
 ;        with a space, replace INDicators (& the following space)
"RTN","TIURECL2",67,0)
 ;        with spaces, and tack on "|_" to get: "  |   |_"
"RTN","TIURECL2",68,0)
 ;     Prefix of kid is then FRSTPFIX_(Original prefix of kid).
"RTN","TIURECL2",69,0)
 N INDLNGTH,INDSPACE,FRSTPFIX
"RTN","TIURECL2",70,0)
 I PRNTPFIX["|_" S INDLNGTH=$L($P(PRNTPFIX,"|_",2)) I 1
"RTN","TIURECL2",71,0)
 E  S INDLNGTH=$L(PRNTPFIX)
"RTN","TIURECL2",72,0)
 S INDSPACE="",$P(INDSPACE," ",INDLNGTH+1)=""
"RTN","TIURECL2",73,0)
 I PRNTPFIX["|_" S FRSTPFIX=$P(PRNTPFIX,"|_")_"| "_INDSPACE_"|_" I 1
"RTN","TIURECL2",74,0)
 E  S FRSTPFIX=INDSPACE_"|_"
"RTN","TIURECL2",75,0)
 Q FRSTPFIX
"RTN","TIURECL2",76,0)
 ;
"RTN","TIURECL2",77,0)
INSADD(TSTART,TIUDA,PRNTPFIX) ;Insert addenda of parent TIUDA into ^TMP("TMPLIST",$J).
"RTN","TIURECL2",78,0)
 ;  Receives TSTART, TIUDA, PRNTPFIX
"RTN","TIURECL2",79,0)
 ;    PRNTPFIX = prefix of parent, updated for current expand action.
"RTN","TIURECL2",80,0)
 N KIDDA,TEXT,FIRSTPFX,ORIGPFIX,NEWPFIX
"RTN","TIURECL2",81,0)
 S KIDDA=0
"RTN","TIURECL2",82,0)
 F  S KIDDA=$O(^TIU(8925,"DAD",TIUDA,KIDDA)) Q:+KIDDA'>0  D
"RTN","TIURECL2",83,0)
 . I '+$$ISADDNDM^TIULC1(+KIDDA) Q
"RTN","TIURECL2",84,0)
 . S TSTART=TSTART+1
"RTN","TIURECL2",85,0)
 . S ^TMP("TMPLIST",$J,TSTART)=$$GETLINE(KIDDA,PRNTPFIX,TSTART)
"RTN","TIURECL2",86,0)
 Q TSTART
"RTN","TIURHX")
0^92^B5258912
"RTN","TIURHX",1,0)
TIURHX ;SLC/JER - Display reassignment history ;21-MAR-2001 16:47:04
"RTN","TIURHX",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**61,100**;Jun 20, 1997
"RTN","TIURHX",3,0)
DISPLAY ; Display Reassignment History of Selected Documents
"RTN","TIURHX",4,0)
 N TIUDA,TIUD,TIUDATA,TIUI,Y,DIROUT,TIUQUIT
"RTN","TIURHX",5,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURHX",6,0)
 S TIUI=0
"RTN","TIURHX",7,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(TIUQUIT)
"RTN","TIURHX",8,0)
 . N TIUVIEW
"RTN","TIURHX",9,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURHX",10,0)
 . D CLEAR^VALM1
"RTN","TIURHX",11,0)
 . W !!,"Reviewing #",+TIUDATA
"RTN","TIURHX",12,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURHX",13,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURHX",14,0)
 . I +TIUVIEW'>0 D  Q  ; Exclude records user can't print
"RTN","TIURHX",15,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),! ; Echo denial message
"RTN","TIURHX",16,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURHX",17,0)
 . . D RESTORE^TIULM(+TIUI)
"RTN","TIURHX",18,0)
 . D EN
"RTN","TIURHX",19,0)
 . I +$G(TIUQUIT) D FIXLSTNW^TIULM Q
"RTN","TIURHX",20,0)
 . D RESTORE^VALM10(+TIUI)
"RTN","TIURHX",21,0)
 K VALMY S VALMBCK="R"
"RTN","TIURHX",22,0)
 Q
"RTN","TIURHX",23,0)
EN ; Option entry
"RTN","TIURHX",24,0)
 K ^TMP("TIURHX",$J) N TIU
"RTN","TIURHX",25,0)
 D EN^VALM("TIU DISPLAY REASSIGN HISTORY")
"RTN","TIURHX",26,0)
 Q
"RTN","TIURHX",27,0)
MAIN ; Control branching
"RTN","TIURHX",28,0)
 N TIUVIEW S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURHX",29,0)
 I +TIUVIEW'>0 D  Q
"RTN","TIURHX",30,0)
 . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURHX",31,0)
 . S VALMQUIT=1
"RTN","TIURHX",32,0)
 . I $$READ^TIUU("EA","RETURN to continue...")
"RTN","TIURHX",33,0)
 D GET^TIUSRV(TIUDA,0,1)
"RTN","TIURHX",34,0)
 Q
"RTN","TIURHX",35,0)
HDR ; Build Header
"RTN","TIURHX",36,0)
 N TIUDTYP
"RTN","TIURHX",37,0)
 ; I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIURHX",38,0)
 D:$D(TIU)'>9 GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIURHX",39,0)
 S VALMHDR(1)=$$CENTER^TIULS($P($G(TIU("DOCTYP")),U,2))
"RTN","TIURHX",40,0)
 S VALMHDR(2)=$$SETREC("HDR")
"RTN","TIURHX",41,0)
 Q
"RTN","TIURHX",42,0)
SETREC(LINE) ; Calls $$SETSTR^VALM1 for each line of ^TMP("TIUAUDIT",$J,
"RTN","TIURHX",43,0)
 N Y
"RTN","TIURHX",44,0)
 I LINE="HDR" D
"RTN","TIURHX",45,0)
 . S Y=$$SETSTR^VALM1($$NAME^TIULS(TIU("PNM"),"LAST,FI MI"),$G(Y),1,15)
"RTN","TIURHX",46,0)
 . S Y=$$SETSTR^VALM1(TIU("SSN"),$G(Y),16,12)
"RTN","TIURHX",47,0)
 . S Y=$$SETSTR^VALM1($P($G(TIU("WARD")),U,2),$G(Y),30,20)
"RTN","TIURHX",48,0)
 . I +TIU("DOCTYP")=1 D
"RTN","TIURHX",49,0)
 . . S Y=$$SETSTR^VALM1("Adm: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/YY"),$G(Y),51,13)
"RTN","TIURHX",50,0)
 . . S Y=$$SETSTR^VALM1("Dis: "_$$DATE^TIULS(+TIU("LDT"),"MM/DD/YY"),$G(Y),66,13)
"RTN","TIURHX",51,0)
 . I +TIU("DOCTYP")'=1 D
"RTN","TIURHX",52,0)
 . . S Y=$$SETSTR^VALM1("Visit Date: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/YY@HR:MIN"),$G(Y),53,26)
"RTN","TIURHX",53,0)
 Q Y
"RTN","TIURL")
0^20^B16440544
"RTN","TIURL",1,0)
TIURL ; SLC/JER - List Management Library ;2/21/01
"RTN","TIURL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**88,100**;Jun 20, 1997
"RTN","TIURL",3,0)
 ; 11/14/00 Moved UPDATEID, etc to TIURL1
"RTN","TIURL",4,0)
 ;
"RTN","TIURL",5,0)
UPRBLD(TIUCHNG,ITEMS) ; Refreshes, updates, or rebuilds the list
"RTN","TIURL",6,0)
 ;after various actions. Also restores video.
"RTN","TIURL",7,0)
 ; Receives optional arrays TIUCHNG, ITEMS by ref.
"RTN","TIURL",8,0)
 ; Checks TIUCHNG("RBLD"),TIUCHNG("UPDATE"), & TIUCHNG("REFRESH");
"RTN","TIURL",9,0)
 ;does nothing if none of these is defined.
"RTN","TIURL",10,0)
 ; Items in ITEMS list are updated (depending on TIUCHNG), and
"RTN","TIURL",11,0)
 ;their video attributes are restored.
"RTN","TIURL",12,0)
 N TIUI,TIUREC,TIUJ,RTN
"RTN","TIURL",13,0)
 S RTN=$G(^TMP("TIUR",$J,"RTN"))
"RTN","TIURL",14,0)
 ; -- Restore video attributes for selected items:
"RTN","TIURL",15,0)
 ;    (Rebuild code, except for TIUROR, does its own video restore)
"RTN","TIURL",16,0)
 I '$G(TIUCHNG("RBLD"))!(RTN="TIUROR") D
"RTN","TIURL",17,0)
 . S TIUJ=0
"RTN","TIURL",18,0)
 . F  S TIUJ=$O(ITEMS(TIUJ)) Q:'TIUJ  D
"RTN","TIURL",19,0)
 . . Q:TIUJ=$P($G(TIUGLINK),U,2)  ; Don't restore midattach ID child
"RTN","TIURL",20,0)
 . . D RESTORE^VALM10(TIUJ)
"RTN","TIURL",21,0)
 ; -- If TIUROR screen needs changes, it is always
"RTN","TIURL",22,0)
 ;    rebuilt, not updated:
"RTN","TIURL",23,0)
 I RTN="TIUROR",$G(TIUCHNG("UPDATE")) S TIUCHNG("RBLD")=1
"RTN","TIURL",24,0)
 ; -- Rebuild, Update, or Refresh list:
"RTN","TIURL",25,0)
 ;    (In cases (e.g.browse) where more than one action
"RTN","TIURL",26,0)
 ;    was performed, TIUCHNG("RBLD") may coexist w TIUCHNG("UPDATE"),
"RTN","TIURL",27,0)
 ;    etc., so order is important.)
"RTN","TIURL",28,0)
 I $G(TIUCHNG("RBLD")) D  Q
"RTN","TIURL",29,0)
 . W !,"Rebuilding the list..."
"RTN","TIURL",30,0)
 . I RTN="TIUROR" D RBLD^TIUROR Q
"RTN","TIURL",31,0)
 . ; -- If not in 2b, pause for feedback ("Rebuilding",
"RTN","TIURL",32,0)
 . ;    "Entry deleted", etc):
"RTN","TIURL",33,0)
 . H 2
"RTN","TIURL",34,0)
 . I RTN="TIURM" D RBLD^TIURM Q
"RTN","TIURL",35,0)
 . I RTN="TIURPTTL" D RBLD^TIURPTTL Q
"RTN","TIURL",36,0)
 . I RTN="TIURTITL" D RBLD^TIURTITL Q
"RTN","TIURL",37,0)
 . I RTN="TIUR" D RBLD^TIUR
"RTN","TIURL",38,0)
 I $G(TIUCHNG("UPDATE")),$D(ITEMS) D  Q
"RTN","TIURL",39,0)
 . S TIUI=""
"RTN","TIURL",40,0)
 . W !,"Updating the list..."
"RTN","TIURL",41,0)
 . F  S TIUI=$O(ITEMS(TIUI)) Q:'TIUI  D
"RTN","TIURL",42,0)
 . . D SETREC(TIUI,.TIUREC)
"RTN","TIURL",43,0)
 . . S ^TMP("TIUR",$J,TIUI,0)=TIUREC
"RTN","TIURL",44,0)
 I $G(TIUCHNG("REFRESH")) D  Q
"RTN","TIURL",45,0)
 . W !,"Refreshing the list..."
"RTN","TIURL",46,0)
 Q
"RTN","TIURL",47,0)
 ;
"RTN","TIURL",48,0)
SETREC(LINENO,TIUREC,PFIXFLAG) ; Update line LINENO with [new prefix], new flds
"RTN","TIURL",49,0)
 ; Combined fields so that SETREC works for MIS as well as
"RTN","TIURL",50,0)
 ;CLINICIAN LM templates
"RTN","TIURL",51,0)
 ; PFIXFLAG=1: update prefix (as well as other flds).
"RTN","TIURL",52,0)
 ; New prefix is for unexpanded state of line.
"RTN","TIURL",53,0)
 N DIC,DIQ,DA,DR,TIUR,ADT,DDT,LCT,AUT,AMD,EDT,SDT,TIULST4
"RTN","TIURL",54,0)
 N MOM,DOC,MISEDT,ITEMNODE
"RTN","TIURL",55,0)
 S ITEMNODE=^TMP("TIURIDX",$J,LINENO)
"RTN","TIURL",56,0)
 S DA=+$P(ITEMNODE,U,2)
"RTN","TIURL",57,0)
 S DIQ="TIUR",DIC=8925,DIQ(0)="IE"
"RTN","TIURL",58,0)
 S DR=".01;.02;.05;.07;.08;.1;1202;1204;1208;1209;1301;1307;1501;1507"
"RTN","TIURL",59,0)
 D EN^DIQ1 Q:$D(TIUR)'>9
"RTN","TIURL",60,0)
 S DOC=$$PNAME^TIULC1(+TIUR(8925,DA,.01,"I"))
"RTN","TIURL",61,0)
 I DOC="Addendum" D
"RTN","TIURL",62,0)
 . S MOM=+$P(^TIU(8925,DA,0),U,6)
"RTN","TIURL",63,0)
 . S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,MOM,0)))
"RTN","TIURL",64,0)
 S TIULST4=$E($P($G(^DPT(TIUR(8925,DA,.02,"I"),0)),U,9),6,9)
"RTN","TIURL",65,0)
 S TIULST4="("_$E(TIUR(8925,DA,.02,"E"))_TIULST4_")"
"RTN","TIURL",66,0)
 S ADT=$$DATE^TIULS(TIUR(8925,DA,.07,"I"),"MM/DD/YY")
"RTN","TIURL",67,0)
 S DDT=$$DATE^TIULS(TIUR(8925,DA,.08,"I"),"MM/DD/YY")
"RTN","TIURL",68,0)
 S AMD=$$NAME^TIULS(TIUR(8925,DA,1208,"E"),"LAST, FI MI")
"RTN","TIURL",69,0)
 S AUT=$$NAME^TIULS(TIUR(8925,DA,1202,"E"),"LAST, FI MI")
"RTN","TIURL",70,0)
 S EDT=$$DATE^TIULS(TIUR(8925,DA,1301,"I"),"MM/DD/YY")
"RTN","TIURL",71,0)
 S MISEDT=$$DATE^TIULS(TIUR(8925,DA,1307,"I"),"MM/DD/YY")
"RTN","TIURL",72,0)
 S SDT=$S(+TIUR(8925,DA,1507,"I"):TIUR(8925,DA,1507,"I"),TIUR(8925,DA,.05,"I")'<7:+TIUR(8925,DA,1501,"I"),1:"")
"RTN","TIURL",73,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURL",74,0)
 S LCT=$G(TIUR(8925,DA,.1,"E"))
"RTN","TIURL",75,0)
 ; -- Set prefix_patient/title into ^TMP("TIUR",$J,LINENO,0),
"RTN","TIURL",76,0)
 ;    then into TIUREC: --
"RTN","TIURL",77,0)
 I $G(PFIXFLAG) D SETPT^TIURL1(LINENO)
"RTN","TIURL",78,0)
 S TIUREC=^TMP("TIUR",$J,LINENO,0)
"RTN","TIURL",79,0)
 ; -- Set other fields into TIUREC: --
"RTN","TIURL",80,0)
 S TIUREC=$$SETFLD^VALM1(LINENO,TIUREC,"NUMBER")
"RTN","TIURL",81,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(TIUR(8925,DA,.05,"E")),TIUREC,"STATUS")
"RTN","TIURL",82,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIURL",83,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIURL",84,0)
 S:$D(VALMDDF("ADMISSION DATE")) TIUREC=$$SETFLD^VALM1(ADT,TIUREC,"ADMISSION DATE")
"RTN","TIURL",85,0)
 S:$D(VALMDDF("DISCH DATE")) TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"DISCH DATE")
"RTN","TIURL",86,0)
 S:$D(VALMDDF("DICT DATE")) TIUREC=$$SETFLD^VALM1(MISEDT,TIUREC,"DICT DATE")
"RTN","TIURL",87,0)
 S:$D(VALMDDF("LINE COUNT")) TIUREC=$$SETFLD^VALM1(LCT,TIUREC,"LINE COUNT")
"RTN","TIURL",88,0)
 S:$D(VALMDDF("REF DATE")) TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"REF DATE")
"RTN","TIURL",89,0)
 S:$D(VALMDDF("SIG DATE")) TIUREC=$$SETFLD^VALM1(SDT,TIUREC,"SIG DATE")
"RTN","TIURL",90,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIURL",91,0)
 S:$D(VALMDDF("COSIGNER")) TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"COSIGNER")
"RTN","TIURL",92,0)
 S:$D(VALMDDF("ATTENDING")) TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"ATTENDING")
"RTN","TIURL",93,0)
 S ^TMP("TIUR",$J,LINENO,0)=TIUREC
"RTN","TIURL",94,0)
 Q
"RTN","TIURL1")
0^76^B3721001
"RTN","TIURL1",1,0)
TIURL1 ; SLC/JER - List Management Library ;11/26/00
"RTN","TIURL1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURL1",3,0)
 ; New rtn created 11/14/00 by splitting TIURL
"RTN","TIURL1",4,0)
 ;
"RTN","TIURL1",5,0)
UPIDDATA(TIUDA) ; Update (or kill) ^TMP("TIUR",$J,"IDDATA",TIUDA)
"RTN","TIURL1",6,0)
 K ^TMP("TIUR",$J,"IDDATA",TIUDA)
"RTN","TIURL1",7,0)
 Q:'$D(^TIU(8925,TIUDA))
"RTN","TIURL1",8,0)
 S IDDATA=$$IDDATA^TIURECL1(TIUDA) ; =TIUDA^hasIDkid^IDdadDA^prmsort
"RTN","TIURL1",9,0)
 I IDDATA S ^TMP("TIUR",$J,"IDDATA",TIUDA)=IDDATA
"RTN","TIURL1",10,0)
 Q
"RTN","TIURL1",11,0)
 ;
"RTN","TIURL1",12,0)
UPPFIX(TIUDA,OLDPFIX) ; Returns prefix with indicators updated
"RTN","TIURL1",13,0)
 ;for changes to record TIUDA (e.g. has new addendum).
"RTN","TIURL1",14,0)
 ; Returned prefix has same level as received prefix OLDPFIX.
"RTN","TIURL1",15,0)
 ; Returned prefix is set for UNEXPANDED state of record.
"RTN","TIURL1",16,0)
 ; OLDPFIX may be that of a record at any level of the treeview,
"RTN","TIURL1",17,0)
 ;in any state of expansion.
"RTN","TIURL1",18,0)
 N ORIGPFIX,NEWPFIX
"RTN","TIURL1",19,0)
 S ORIGPFIX=$$PREFIX^TIULA2(TIUDA,0)
"RTN","TIURL1",20,0)
 I OLDPFIX["|_" S NEWPFIX=$P(OLDPFIX,"|_")_"|_"_ORIGPFIX
"RTN","TIURL1",21,0)
 E  S NEWPFIX=ORIGPFIX
"RTN","TIURL1",22,0)
 Q NEWPFIX
"RTN","TIURL1",23,0)
 ;
"RTN","TIURL1",24,0)
SETPT(LINENO) ; Set prefix_patient column of ^TMP("TIUR",$J,LINENO,0)
"RTN","TIURL1",25,0)
 ;after item prefix is changed (e.g. item has new addendum).
"RTN","TIURL1",26,0)
 ; Updated prefix is at same level of treeview as received prefix,
"RTN","TIURL1",27,0)
 ;has updated indicators, but is in UNEXPANDED state.
"RTN","TIURL1",28,0)
 N CURPFIX,TEXT,TIUDA,IDDATA,NEWPFIX,ITEMNODE
"RTN","TIURL1",29,0)
 S ITEMNODE=^TMP("TIURIDX",$J,LINENO)
"RTN","TIURL1",30,0)
 S TIUDA=$P(ITEMNODE,U,2),CURPFIX=$P(ITEMNODE,U,3)
"RTN","TIURL1",31,0)
 S NEWPFIX=$$UPPFIX(TIUDA,CURPFIX)
"RTN","TIURL1",32,0)
 S TEXT=^TMP("TIUR",$J,LINENO,0)
"RTN","TIURL1",33,0)
 S TEXT=$$SETTLPT^TIURECL1(TEXT,TIUDA,NEWPFIX)
"RTN","TIURL1",34,0)
 S ^TMP("TIUR",$J,LINENO,0)=TEXT
"RTN","TIURL1",35,0)
 S $P(^TMP("TIURIDX",$J,LINENO),U,3)=NEWPFIX
"RTN","TIURL1",36,0)
 Q
"RTN","TIURL1",37,0)
 ;
"RTN","TIURL1",38,0)
ITEM(TIUDA) ; Find which item in the list is occupied by TIUDA
"RTN","TIURL1",39,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIURL1",40,0)
 F  S TIUI=$O(^TMP("TIURIDX",$J,TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIURL1",41,0)
 . I $P(^TMP("TIURIDX",$J,TIUI),U,2)=TIUDA S TIUY=TIUI
"RTN","TIURL1",42,0)
 Q TIUY
"RTN","TIURL1",43,0)
BREATHE(ITEM,ONCE)   ; Collapse/Expand treeview on changes
"RTN","TIURL1",44,0)
 D EC1^TIURECL(ITEM,1) ; Collapse or expand once
"RTN","TIURL1",45,0)
 D:'+$D(ONCE) EC1^TIURECL(ITEM,1) ; if ONCE is not sent, do it again
"RTN","TIURL1",46,0)
 Q
"RTN","TIURM")
0^19^B20943725
"RTN","TIURM",1,0)
TIURM ; SLC/JER - MIS Document Review ;2/26/01
"RTN","TIURM",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100**;Jun 20, 1997
"RTN","TIURM",3,0)
 ;12/7/00 split TIURM into TIURM & TIURM1
"RTN","TIURM",4,0)
MAKELIST(TIUCLASS) ; Get Search Criteria
"RTN","TIURM",5,0)
 N DIRUT,DTOUT,DUOUT,TIUI,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIURM",6,0)
 N TIUDPRMT,STATWORD,STATIFN,NOWFLAG
"RTN","TIURM",7,0)
 K DIROUT
"RTN","TIURM",8,0)
 D INITRR^TIULRR(0)
"RTN","TIURM",9,0)
STATUS S STATUS=$S($D(TIUQUIK):$$SELSTAT^TIULA(.TIUSTAT,"F","UNSIGNED,UNCOSIGNED"),1:$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT(DUZ)))
"RTN","TIURM",10,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIURM",11,0)
 S TIUI=0
"RTN","TIURM",12,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIURM",13,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIURM",14,0)
 . Q:'STATIFN
"RTN","TIURM",15,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIURM",16,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIURM",17,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURM",18,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIURM",19,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIURM",20,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIURM",21,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIURM",22,0)
 N TIUDCL
"RTN","TIURM",23,0)
 ; -- Ask user for docmt types and set ^TMP("TIUTYP",$J):
"RTN","TIURM",24,0)
 D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL)
"RTN","TIURM",25,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",26,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIURM",27,0)
 D CHECKADD
"RTN","TIURM",28,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIURM",29,0)
 S TIUDPRMT="Entry"
"RTN","TIURM",30,0)
 S TIUEDT=$S($D(TIUQUIK):1,1:$$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT))
"RTN","TIURM",31,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",32,0)
 I TIUEDT'>0 G DOCTYPE
"RTN","TIURM",33,0)
LATE S TIULDT=$S($D(TIUQUIK):9999999,1:$$LDATE^TIULA(TIUDPRMT))
"RTN","TIURM",34,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",35,0)
 I TIULDT'>0 G ERLY
"RTN","TIURM",36,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIURM",37,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT) ; P74.  Add late date time whether or not late date is same as early date.
"RTN","TIURM",38,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIURM",39,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIURM",40,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIURM",41,0)
 D BUILD(TIUCLASS,.STATUS,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIURM",42,0)
 ; -- If attaching ID note & changed view,
"RTN","TIURM",43,0)
 ;    update video for line to be attached: --
"RTN","TIURM",44,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIURM",45,0)
 Q
"RTN","TIURM",46,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIURM",47,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIURM",48,0)
 S (TIUI,HIT)=0
"RTN","TIURM",49,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIURM",50,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIURM",51,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIURM",52,0)
 Q
"RTN","TIURM",53,0)
SWAP(TIUX,TIUY) ; Swap any two variables
"RTN","TIURM",54,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIURM",55,0)
 Q
"RTN","TIURM",56,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIURM",57,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIURM",58,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIURM",59,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIURM",60,0)
 Q
"RTN","TIURM",61,0)
BUILD(TIUCLASS,STATUS,EARLY,LATE,NOWFLAG) ; Build List
"RTN","TIURM",62,0)
 N TIUPREF
"RTN","TIURM",63,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIURM",64,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIURM",65,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIURM",66,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIURM",67,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIURM",68,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIURM",69,0)
 S ^TMP("TIUR",$J,"RTN")="TIURM"
"RTN","TIURM",70,0)
 I '$D(TIUPRM0)!'$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURM",71,0)
 S EARLY=+$G(EARLY,0),LATE=+$G(LATE,3333333)
"RTN","TIURM",72,0)
 D GATHER^TIURM1(TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE)
"RTN","TIURM",73,0)
 D PUTLIST^TIURM1(TIUPREF,TIUCLASS,.STATUS)
"RTN","TIURM",74,0)
 K ^TMP("TIUI",$J)
"RTN","TIURM",75,0)
 Q
"RTN","TIURM",76,0)
CLEAN ; Clean up your mess!
"RTN","TIURM",77,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIURM",78,0)
 K VALMY
"RTN","TIURM",79,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIURM",80,0)
 Q
"RTN","TIURM",81,0)
URGENCY(TIUDA) ; What is the urgency of the current document
"RTN","TIURM",82,0)
 N TIUY,TIUD0,TIUDSTAT,TIUDURG
"RTN","TIURM",83,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUDSTAT=$P(TIUD0,U,5)
"RTN","TIURM",84,0)
 S TIUDURG=$P(TIUD0,U,9)
"RTN","TIURM",85,0)
 S TIUY=$S(TIUDSTAT<7:$S(TIUDURG="P":1,1:2),1:3)
"RTN","TIURM",86,0)
 Q TIUY
"RTN","TIURM",87,0)
DFLTSTAT(USER) ; Set default STATUS for current user
"RTN","TIURM",88,0)
 N TIUMIS,TIUMD,TIUY,TIUDPRM D DOCPRM^TIULC1(244,.TIUDPRM)
"RTN","TIURM",89,0)
 S TIUMIS=$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION")
"RTN","TIURM",90,0)
 I +TIUMIS,+$P($G(TIUDPRM(0)),U,3) S TIUY="UNVERIFIED" G DFLTX
"RTN","TIURM",91,0)
 I $$ISA^USRLM(DUZ,"PROVIDER") S TIUY="COMPLETED" G DFLTX
"RTN","TIURM",92,0)
 S TIUY="COMPLETED"
"RTN","TIURM",93,0)
DFLTX Q TIUY
"RTN","TIURM",94,0)
 ;
"RTN","TIURM",95,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIURM",96,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUEDT,TIULDT
"RTN","TIURM",97,0)
 N TIURBLD,TIUI,TIUCLASS
"RTN","TIURM",98,0)
 S TIURBLD=1
"RTN","TIURM",99,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIURM",100,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIURM",101,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIURM",102,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIURM",103,0)
 S TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIURM",104,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIURM",105,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIURM",106,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIURM",107,0)
 D BUILD(TIUCLASS,.STATUS,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIURM",108,0)
 ; Reexpand previously expanded items:
"RTN","TIURM",109,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIURM",110,0)
 D BREATHE^TIUROR1(1)
"RTN","TIURM",111,0)
 Q
"RTN","TIURM1")
0^77^B32425153
"RTN","TIURM1",1,0)
TIURM1 ; SLC/JER - MIS Document Review ;2/28/01
"RTN","TIURM1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURM1",3,0)
GATHER(TIUPREF,CLASS,STATIFNS,EARLY,LATE) ; Find/sort
"RTN","TIURM1",4,0)
 ;records for the list
"RTN","TIURM1",5,0)
 N TIUDA,TIUSFLD,TIUI,TIUQ
"RTN","TIURM1",6,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURM1",7,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURM1",8,0)
 S TIUI=EARLY F  S TIUI=$O(^TIU(8925,"F",TIUI)) Q:+TIUI'>0!(+TIUI>LATE)  D
"RTN","TIURM1",9,0)
 . S TIUDA=0
"RTN","TIURM1",10,0)
 . F  S TIUDA=$O(^TIU(8925,"F",TIUI,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURM1",11,0)
 . . ; Consider adding view check here
"RTN","TIURM1",12,0)
 . . I '$$INTYPES(TIUDA) Q
"RTN","TIURM1",13,0)
 . . I '$$INSTATUS(TIUDA,STATIFNS) Q
"RTN","TIURM1",14,0)
 . . S TIUQ=$$RESOLVE^TIUR1(TIUDA,TIUSFLD)
"RTN","TIURM1",15,0)
 . . S ^TMP("TIUI",$J,TIUQ,(9999999-TIUI),TIUDA)=""
"RTN","TIURM1",16,0)
 Q
"RTN","TIURM1",17,0)
 ;
"RTN","TIURM1",18,0)
INTYPES(TIUDA) ; Evaluates whether a record is among the selected types
"RTN","TIURM1",19,0)
 N TIUI,TIUTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIURM1",20,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIURM1",21,0)
 I TIUTYP=81 S TIUY=+$$DADINTYP(TIUDA) G INTYPX
"RTN","TIURM1",22,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIURM1",23,0)
 . I +$P(^TMP("TIUTYP",$J,TIUI),U,2)=TIUTYP S TIUY=1
"RTN","TIURM1",24,0)
INTYPX Q TIUY
"RTN","TIURM1",25,0)
 ;
"RTN","TIURM1",26,0)
INSTATUS(TIUDA,STATIFNS) ; Evaluates whether a record
"RTN","TIURM1",27,0)
 ;is among the selected statuses
"RTN","TIURM1",28,0)
 N TIUS,TIUSTAT,TIUSTATE,TIUY S TIUY=0
"RTN","TIURM1",29,0)
 S TIUSTATE=+$P($G(^TIU(8925,+TIUDA,0)),U,5)
"RTN","TIURM1",30,0)
 S TIUS=1 F  S TIUSTAT=$P(STATIFNS,";",TIUS) Q:'TIUSTAT!TIUY  D
"RTN","TIURM1",31,0)
 . S TIUS=TIUS+1
"RTN","TIURM1",32,0)
 . I TIUSTAT=TIUSTATE S TIUY=1
"RTN","TIURM1",33,0)
 Q TIUY
"RTN","TIURM1",34,0)
DADINTYP(TIUDA) ; Evaluates whether addendum's parent is among
"RTN","TIURM1",35,0)
 ;                 the selected types
"RTN","TIURM1",36,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIURM1",37,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIURM1",38,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIURM1",39,0)
 . I +$P(^TMP("TIUTYP",$J,TIUI),U,2)=TIUDTYP S TIUY=1
"RTN","TIURM1",40,0)
 Q TIUY
"RTN","TIURM1",41,0)
 ;
"RTN","TIURM1",42,0)
PUTLIST(TIUPREF,TIUCLASS,STATUS) ; Expands list elements for LM Template
"RTN","TIURM1",43,0)
 N TIUJ,TIUQ,TIUDA,TIUPICK,TIUORDER,TIUEXPKD,TIUSFLD
"RTN","TIURM1",44,0)
 S VALMCNT=0
"RTN","TIURM1",45,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURM1",46,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURM1",47,0)
 S TIUORDER=$S($P(TIUPREF,U,4)="A":1,1:-1)
"RTN","TIURM1",48,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIURM1",49,0)
 S TIUQ="" F  S TIUQ=$O(^TMP("TIUI",$J,TIUQ)) Q:TIUQ']""  D
"RTN","TIURM1",50,0)
 . S TIUJ=0 F  S TIUJ=$O(^TMP("TIUI",$J,TIUQ,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURM1",51,0)
 . . S TIUDA=0
"RTN","TIURM1",52,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)) Q:'TIUDA  D
"RTN","TIURM1",53,0)
 . . . D REPLACE^TIUR2(TIUDA,TIUQ,TIUSFLD,TIUJ,.TIUEXPKD)
"RTN","TIURM1",54,0)
 D SETLIST(TIUORDER,.VALMCNT)
"RTN","TIURM1",55,0)
 S ^TMP("TIUR",$J,0)=+$G(VALMCNT)_U_STATUS("WORDS")
"RTN","TIURM1",56,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIURM1",57,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(VALMCNT)
"RTN","TIURM1",58,0)
 I $D(VALMHDR)>9 D HDR^TIURMH
"RTN","TIURM1",59,0)
 I +$G(VALMCNT)'>0 D
"RTN","TIURM1",60,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIURM1",61,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIURM1",62,0)
 . S ^TMP("TIUR",$J,"IDX",1,0)="" ; User can't select lines 1 or 2
"RTN","TIURM1",63,0)
 . S ^TMP("TIUR",$J,"IDX",2,0)=""
"RTN","TIURM1",64,0)
 ; -- Expand to show kids that fit:
"RTN","TIURM1",65,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D EXPANDKD^TIUR2(.STATUS,.TIUEXPKD)
"RTN","TIURM1",66,0)
 Q
"RTN","TIURM1",67,0)
SETLIST(TIUORDER,VALMCNT) ; Set items from ^TMP("TIUI",$J) into
"RTN","TIURM1",68,0)
 ;List Template list
"RTN","TIURM1",69,0)
 N SORTVAL,TIUDTM,TIUDA
"RTN","TIURM1",70,0)
 S SORTVAL=""
"RTN","TIURM1",71,0)
 F  S SORTVAL=$O(^TMP("TIUI",$J,SORTVAL),TIUORDER) Q:SORTVAL=""  D
"RTN","TIURM1",72,0)
 . S TIUDTM=0
"RTN","TIURM1",73,0)
 . F  S TIUDTM=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM)) Q:'TIUDTM  D
"RTN","TIURM1",74,0)
 . . S TIUDA=0
"RTN","TIURM1",75,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,SORTVAL,TIUDTM,TIUDA)) Q:'TIUDA  D
"RTN","TIURM1",76,0)
 . . . D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIURM1",77,0)
 Q
"RTN","TIURM1",78,0)
 ;
"RTN","TIURM1",79,0)
ADDELMNT(DA,TIUCNT,APPEND) ; Add each element to the list
"RTN","TIURM1",80,0)
 N PT,ADT,DDT,AUT,AMD,EDT,LCT,SDT,TIULST4
"RTN","TIURM1",81,0)
 N TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,STATX,TIULI,DOC ;P74 newed DOC
"RTN","TIURM1",82,0)
 N PREFIX,TIUGDATA
"RTN","TIURM1",83,0)
 I '$D(^TIU(8925,TIUDA,0)) Q
"RTN","TIURM1",84,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIURM1",85,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1)
"RTN","TIURM1",86,0)
 . S TIUCNT=0
"RTN","TIURM1",87,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIURM1",88,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIURM1",89,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIURM1",90,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIURM1",91,0)
 S PREFIX=$$PREFIX^TIULA2(TIUDA,0)
"RTN","TIURM1",92,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIURM1",93,0)
 S TIULI=$E(PT)
"RTN","TIURM1",94,0)
 S PT=PREFIX_PT
"RTN","TIURM1",95,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIURM1",96,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIURM1",97,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIURM1",98,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIURM1",99,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIURM1",100,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIURM1",101,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIURM1",102,0)
 S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIURM1",103,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U,7),"MM/DD/YY")
"RTN","TIURM1",104,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIURM1",105,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURM1",106,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIURM1",107,0)
 S LCT=$P(TIUD0,U,10)
"RTN","TIURM1",108,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIURM1",109,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIURM1",110,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIURM1",111,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIURM1",112,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIURM1",113,0)
 S TIUREC=$$SETFLD^VALM1(ADT,TIUREC,"ADMISSION DATE")
"RTN","TIURM1",114,0)
 S TIUREC=$$SETFLD^VALM1(DDT,TIUREC,"DISCH DATE")
"RTN","TIURM1",115,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"DICT DATE")
"RTN","TIURM1",116,0)
 S TIUREC=$$SETFLD^VALM1(LCT,TIUREC,"LINE COUNT")
"RTN","TIURM1",117,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIURM1",118,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIURM1",119,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"ATTENDING")
"RTN","TIURM1",120,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIURM1",121,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W "."
"RTN","TIURM1",122,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_DA_U_PREFIX
"RTN","TIURM1",123,0)
 S ^TMP("TIUR",$J,"IEN",DA,TIUCNT)=""
"RTN","TIURM1",124,0)
 S TIUGDATA=$$IDDATA^TIURECL1(DA,TIUD0)
"RTN","TIURM1",125,0)
 I TIUGDATA S ^TMP("TIUR",$J,"IDDATA",DA)=TIUGDATA
"RTN","TIURM1",126,0)
 I +$G(APPEND) D
"RTN","TIURM1",127,0)
 . D RESTORE^VALM10(TIUCNT)
"RTN","TIURM1",128,0)
 . D CNTRL^VALM10(TIUCNT,1,$G(VALM("RM")),IOINHI,IOINORM),HDR^TIURMH
"RTN","TIURM1",129,0)
 . S VALMSG="** Item #"_TIUCNT_" Added **"
"RTN","TIURM1",130,0)
 . S $P(^TMP("TIUR",$J,0),U)=TIUCNT
"RTN","TIURM1",131,0)
 . S $P(^TMP("TIUR",$J,"#"),":",2)=TIUCNT
"RTN","TIURM1",132,0)
 . S VALMCNT=TIUCNT
"RTN","TIURM1",133,0)
 . I $D(VALMHDR)>9 D HDR^TIURMH
"RTN","TIURM1",134,0)
 Q
"RTN","TIUROR")
0^17^B50360977
"RTN","TIUROR",1,0)
TIUROR ;SLC/JER - New PATIENT Review screen ; 3/14/01
"RTN","TIUROR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**10,86,88,100**;Jun 20, 1997
"RTN","TIUROR",3,0)
 ; Split rtn into TIUROR & TIUROR1 11/27/00
"RTN","TIUROR",4,0)
EN ; -- main entry point for TIU OE/RR REVIEW PN
"RTN","TIUROR",5,0)
 D EN^VALM("TIU OE/RR REVIEW PN")
"RTN","TIUROR",6,0)
 Q
"RTN","TIUROR",7,0)
 ;
"RTN","TIUROR",8,0)
HDR ; -- header code
"RTN","TIUROR",9,0)
 N TIUCTXT,TIUPNM,TIUSSN,TIULOC,TIUDOB,TIUHDR,TIUCWAD,TIUDCNT,VADM,VA
"RTN","TIUROR",10,0)
 N TIUDFN I +$D(@VALMAR@(0))'>0 S VALMQUIT=1 Q
"RTN","TIUROR",11,0)
 S TIUDFN=+$G(@VALMAR@("DFN"))
"RTN","TIUROR",12,0)
 S TIUCWAD=$$CWAD^GMRPNOR1(TIUDFN) S:TIUCWAD]"" TIUCWAD="<"_TIUCWAD_">"
"RTN","TIUROR",13,0)
 S TIUDCNT=$J($S($G(@VALMAR@("CTXT"))="INIT":"Last ",1:"")_+@VALMAR@(0)_" note(s)",16)
"RTN","TIUROR",14,0)
 S TIUCTXT=$$UP^XLFSTR($$PNAME^TIULC1(@VALMAR@("CLASS")))
"RTN","TIUROR",15,0)
 S TIUCTXT=$$TITLE^TIUU(TIUCTXT)
"RTN","TIUROR",16,0)
 S TIUHDR=$$SETSTR^VALM1(TIUCWAD,$G(TIUHDR),1,20)
"RTN","TIUROR",17,0)
 S TIUHDR=$$SETSTR^VALM1(TIUCTXT,$G(TIUHDR),27,28)
"RTN","TIUROR",18,0)
 S TIUHDR=$$SETSTR^VALM1(TIUDCNT,$G(TIUHDR),64,16)
"RTN","TIUROR",19,0)
 S VALMHDR(1)=TIUHDR,TIUHDR=""
"RTN","TIUROR",20,0)
 S TIUPNM=$$NAME^TIULO(TIUDFN),TIUSSN=$$SSN^TIULO(TIUDFN)
"RTN","TIUROR",21,0)
 S TIUDOB=$$DOB^TIULO(TIUDFN)_" ("_$$AGE^TIULO(TIUDFN)_")"
"RTN","TIUROR",22,0)
 S TIULOC=$G(^DPT(+TIUDFN,.1))
"RTN","TIUROR",23,0)
 S:TIULOC]"" TIULOC=TIULOC_"/"_$G(^DPT(+TIUDFN,.101))
"RTN","TIUROR",24,0)
 S TIUHDR=$$SETSTR^VALM1(TIUPNM,$G(TIUHDR),1,20)
"RTN","TIUROR",25,0)
 S TIUHDR=$$SETSTR^VALM1(TIUSSN,$G(TIUHDR),22,11)
"RTN","TIUROR",26,0)
 S TIUHDR=$$SETSTR^VALM1(TIULOC,$G(TIUHDR),35,20)
"RTN","TIUROR",27,0)
 S TIUHDR=$$SETSTR^VALM1(TIUDOB,$G(TIUHDR),64,16)
"RTN","TIUROR",28,0)
 S VALMHDR(2)=TIUHDR
"RTN","TIUROR",29,0)
 Q
"RTN","TIUROR",30,0)
 ;
"RTN","TIUROR",31,0)
INIT(CLASS,CONTEXT,DFN,TIUOCC) ; -- init variables and list array
"RTN","TIUROR",32,0)
 N TIUR,TIUI,TIUY,TIUPICK,TIUQUIT,TIUCCTXT,TIUDUZ,TIUERLY,TIULATE
"RTN","TIUROR",33,0)
 N TIUPREF,TIUOCTXT,TIURCTXT,TIUSEQ,TIUDPRM
"RTN","TIUROR",34,0)
 N DUOUT,DTOUT,DIROUT ;1/8/01
"RTN","TIUROR",35,0)
 I $G(@VALMAR@("SEQ"))]"" S TIUSEQ=$G(@VALMAR@("SEQ"))
"RTN","TIUROR",36,0)
 I +$G(@VALMAR@("CTXT")) S TIURCTXT=$G(@VALMAR@("CTXT"))
"RTN","TIUROR",37,0)
 K @VALMAR,VALMCNT,^TMP("TIURIDX",$J)
"RTN","TIUROR",38,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUROR",39,0)
 S TIUSEQ=$G(TIUSEQ,$S($P(TIUPREF,U,4)="A":"A",1:"D"))
"RTN","TIUROR",40,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIUROR",41,0)
 S DFN=$S(+$G(DFN):+$G(DFN),+$G(ORVP):+$G(ORVP),1:+$$PATIENT^TIULA)
"RTN","TIUROR",42,0)
 I $S($D(DUOUT):1,$D(DTOUT):1,$D(DIROUT):1,+$G(DFN)'>0:1,1:0) S VALMQUIT=1 Q
"RTN","TIUROR",43,0)
 I +$G(CONTEXT)'=9999,'+$G(TIUOCC) S TIUOCC=$S(+$P(TIUPREF,U,10):+$P(TIUPREF,U,10),1:100)
"RTN","TIUROR",44,0)
 S ^TMP("TIUR",$J,"RTN")="TIUROR"
"RTN","TIUROR",45,0)
 I '$O(^TIU(8925,"ACLPT",CLASS,DFN,0)),'$O(^TIU(8925,"ACLAU",CLASS,DUZ,DFN,0)),'$O(^TIU(8925,"ACLEC",CLASS,DUZ,DFN,0)) D  Q:$G(CONTEXT)'=9999
"RTN","TIUROR",46,0)
 . N TIUST
"RTN","TIUROR",47,0)
 . S TIUST=$S(CONTEXT=2:"UNSIGNED ",CONTEXT=3:"UNCOSIGNED ",1:"SIGNED ")
"RTN","TIUROR",48,0)
 . S VALMCNT=2,^TMP("TIUR",$J,0)=0
"RTN","TIUROR",49,0)
 . S ^TMP("TIUR",$J,1,0)=""
"RTN","TIUROR",50,0)
 . S ^TMP("TIUR",$J,2,0)="No "_TIUST_$$UP^XLFSTR($$PNAME^TIULC1(CLASS))_" Available for "_$$PTNAME^TIULC1(DFN)
"RTN","TIUROR",51,0)
 . S TIUOCTXT=CONTEXT
"RTN","TIUROR",52,0)
 . I CONTEXT=4 S TIUOCTXT=TIUOCTXT_U_TIUDUZ
"RTN","TIUROR",53,0)
 . I CONTEXT=5 S TIUOCTXT=TIUOCTXT_U_+TIUERLY_U_+TIULATE
"RTN","TIUROR",54,0)
 . S ^TMP("TIUR",$J,"SEQ")=$G(TIUSEQ)
"RTN","TIUROR",55,0)
 . S ^TMP("TIUR",$J,"CLASS")=CLASS,^("DFN")=DFN,^("CTXT")=TIUOCTXT D HDR
"RTN","TIUROR",56,0)
 I $G(CONTEXT)=9999 S TIUCCTXT=1,TIUOCC=9999999
"RTN","TIUROR",57,0)
 ; -- Set vars needed for RBLD if user ^s:
"RTN","TIUROR",58,0)
 S ^TMP("TIUR",$J,"CLASS")=CLASS,^("DFN")=DFN,^("OCC")=TIUOCC,^("CTXT")=+$G(TIURCTXT)
"RTN","TIUROR",59,0)
 S CONTEXT=$S($G(CONTEXT)=9999:$$ASKCTXT^TIUROR1,+$G(CONTEXT):+$G(CONTEXT),1:1)
"RTN","TIUROR",60,0)
 ; -- 1=Signed 2=Unsigned 3=Uncosigned 4=Signed/Author 5=Signed/Date --
"RTN","TIUROR",61,0)
 I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) D RBLD Q
"RTN","TIUROR",62,0)
 I $S(CONTEXT=1:1,CONTEXT=2:1,CONTEXT=3:1,1:0) S TIUERLY="",TIULATE="",TIUDUZ=DUZ
"RTN","TIUROR",63,0)
 I CONTEXT=4 D  Q:+$G(TIUQUIT)>0
"RTN","TIUROR",64,0)
 . S TIUERLY="",TIULATE=""
"RTN","TIUROR",65,0)
 . S TIUDUZ=$S(+$G(TIURCTXT)'=4:+$$AUTHOR^TIULA2(1),+$P(TIURCTXT,U,2)'>0:+$$AUTHOR^TIULA2(1),+$G(TIUCCTXT):+$$AUTHOR^TIULA2(1),1:+$P(TIURCTXT,U,2))
"RTN","TIUROR",66,0)
 . I $S($D(DUOUT):1,$D(DTOUT):1,$D(DIROUT):1,+$G(TIUDUZ)'>0:1,1:0) S TIUQUIT=1 D RBLD Q  ; changed DIRUT to DTOUT. 10/20/00
"RTN","TIUROR",67,0)
 . S TIUSEQ=$S(+$G(TIUCCTXT):$P($$ASKSEQ^TIULA3(TIUSEQ),U),$G(TIUSEQ)']"":$P($$ASKSEQ^TIULA3(TIUSEQ),U),1:$G(TIUSEQ))
"RTN","TIUROR",68,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 D RBLD
"RTN","TIUROR",69,0)
 I CONTEXT=5 D  Q:+$G(TIUQUIT)>0
"RTN","TIUROR",70,0)
 . S TIUDUZ=+$G(DUZ)
"RTN","TIUROR",71,0)
 . S TIUERLY=$S(+$G(TIURCTXT)'=5:$$EDATE^TIULA("",7,""),+$P(TIURCTXT,U,2)'>0:$$EDATE^TIULA("",7,""),+$G(TIUCCTXT):$$EDATE^TIULA("",7,""),1:+$P(TIURCTXT,U,2))
"RTN","TIUROR",72,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 D RBLD Q
"RTN","TIUROR",73,0)
 . S TIUERLY=$P(TIUERLY,U)
"RTN","TIUROR",74,0)
 . S TIULATE=$S(+$G(TIURCTXT)'=5:$$LDATE^TIULA("",7,""),+$P(TIURCTXT,U,3)'>0:$$LDATE^TIULA("",7,""),+$G(TIUCCTXT):$$LDATE^TIULA("",7,""),1:+$P(TIURCTXT,U,3))
"RTN","TIUROR",75,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 D RBLD Q
"RTN","TIUROR",76,0)
 . S TIULATE=$P(TIULATE,U)
"RTN","TIUROR",77,0)
 . I TIUERLY>TIULATE D SWAP^TIUR(.TIUERLY,.TIULATE)
"RTN","TIUROR",78,0)
 . I $L(TIULATE,".")=1 D EXPRANGE^TIUR(.TIUERLY,.TIULATE)
"RTN","TIUROR",79,0)
 . S TIUSEQ=$S(+$G(TIUCCTXT):$P($$ASKSEQ^TIULA3(TIUSEQ),U),$G(TIUSEQ)']"":$P($$ASKSEQ^TIULA3(TIUSEQ),U),1:$G(TIUSEQ))
"RTN","TIUROR",80,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 D RBLD
"RTN","TIUROR",81,0)
 I '$G(TIURBLD) W !,"Searching for the progress notes"
"RTN","TIUROR",82,0)
 N TIUEXPKD
"RTN","TIUROR",83,0)
 D CONTEXT^TIUSRVLL(.TIUY,CLASS,CONTEXT,DFN,TIUERLY,TIULATE,TIUDUZ,TIUOCC,TIUSEQ,.TIUEXPKD) W "."
"RTN","TIUROR",84,0)
 I $D(TIUY)'>9 D  Q
"RTN","TIUROR",85,0)
 . N TIUST
"RTN","TIUROR",86,0)
 . S TIUST=$S(CONTEXT=2:"UNSIGNED ",CONTEXT=3:"UNCOSIGNED ",1:"SIGNED ")
"RTN","TIUROR",87,0)
 . S VALMCNT=2,^TMP("TIUR",$J,0)=0
"RTN","TIUROR",88,0)
 . S ^TMP("TIUR",$J,1,0)=""
"RTN","TIUROR",89,0)
 . S ^TMP("TIUR",$J,2,0)="No "_TIUST_$$UP^XLFSTR($$PNAME^TIULC1(CLASS))_" Available for "_$$PTNAME^TIULC1(DFN)
"RTN","TIUROR",90,0)
 . S ^TMP("TIUR",$J,"CLASS")=CLASS,^("DFN")=DFN
"RTN","TIUROR",91,0)
 . S TIUOCTXT=CONTEXT
"RTN","TIUROR",92,0)
 . I CONTEXT=4 S TIUOCTXT=TIUOCTXT_U_TIUDUZ
"RTN","TIUROR",93,0)
 . I CONTEXT=5 S TIUOCTXT=TIUOCTXT_U_+TIUERLY_U_+TIULATE
"RTN","TIUROR",94,0)
 . S ^TMP("TIUR",$J,"SEQ")=$G(TIUSEQ)
"RTN","TIUROR",95,0)
 . S ^TMP("TIUR",$J,"CTXT")=$S('+$G(TIUCCTXT):"INIT",1:TIUOCTXT) D HDR
"RTN","TIUROR",96,0)
 S TIUI=""
"RTN","TIUROR",97,0)
 F  S TIUI=$O(TIUY(TIUI)) Q:TIUI=""  D
"RTN","TIUROR",98,0)
 . N AUT,RDT,STAT,TITL,TIUD0,TIUD12,TIUD13,PREFIX
"RTN","TIUROR",99,0)
 . N TIUGDATA
"RTN","TIUROR",100,0)
 . S TIUD0=$G(^TIU(8925,+TIUY(TIUI),0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIUROR",101,0)
 . S VALMCNT=+$G(VALMCNT)+1 W:(VALMCNT#100'>0) "."
"RTN","TIUROR",102,0)
 . S TITL=$$PNAME^TIULC1(+TIUD0)
"RTN","TIUROR",103,0)
 . I TITL="Addendum" S TITL=TITL_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIUROR",104,0)
 . ; -- Mark ID note '<' and/or has addendum '+',
"RTN","TIUROR",105,0)
 . S PREFIX=$$PREFIX^TIULA2(+TIUY(TIUI),0)
"RTN","TIUROR",106,0)
 . S TITL=PREFIX_TITL
"RTN","TIUROR",107,0)
 . S AUT=$$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD12,U,2)),"LAST,FI")
"RTN","TIUROR",108,0)
 . S RDT=$$DATE^TIULS(+TIUD13,"MM/DD/YY HR:MIN")
"RTN","TIUROR",109,0)
 . S STAT=$$LOW^XLFSTR($P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U))
"RTN","TIUROR",110,0)
 . S TIUR=$$SETFLD^VALM1(VALMCNT,$G(TIUR),"NUMBER")
"RTN","TIUROR",111,0)
 . S TIUR=$$SETFLD^VALM1(TITL,$G(TIUR),"TITLE")
"RTN","TIUROR",112,0)
 . S TIUR=$$SETFLD^VALM1(AUT,$G(TIUR),"AUTHOR")
"RTN","TIUROR",113,0)
 . S TIUR=$$SETFLD^VALM1(RDT,$G(TIUR),"REF DATE")
"RTN","TIUROR",114,0)
 . S TIUR=$$SETFLD^VALM1(STAT,$G(TIUR),"STATUS")
"RTN","TIUROR",115,0)
 . S ^TMP("TIUR",$J,VALMCNT,0)=TIUR
"RTN","TIUROR",116,0)
 . S ^TMP("TIUR",$J,0)=VALMCNT
"RTN","TIUROR",117,0)
 . S ^TMP("TIURIDX",$J,VALMCNT)=VALMCNT_U_+TIUY(TIUI)_U_PREFIX
"RTN","TIUROR",118,0)
 . S ^TMP("TIUR",$J,"IEN",+TIUY(TIUI),VALMCNT)=""
"RTN","TIUROR",119,0)
 . S ^TMP("TIUR",$J,"IDX",VALMCNT,VALMCNT)=""
"RTN","TIUROR",120,0)
 . ;    TIUGDATA = 0 or DA^haskid^IDparent^prmsort:
"RTN","TIUROR",121,0)
 . S TIUGDATA=$$IDDATA^TIURECL1(+TIUY(TIUI),TIUD0)
"RTN","TIUROR",122,0)
 . I $G(TIUGDATA) S ^TMP("TIUR",$J,"IDDATA",+TIUY(TIUI))=TIUGDATA
"RTN","TIUROR",123,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+VALMCNT
"RTN","TIUROR",124,0)
 S ^TMP("TIUR",$J,"CLASS")=CLASS
"RTN","TIUROR",125,0)
 S ^TMP("TIUR",$J,"DFN")=DFN
"RTN","TIUROR",126,0)
 S ^TMP("TIUR",$J,"OCC")=+$G(TIUOCC)
"RTN","TIUROR",127,0)
 S TIUOCTXT=CONTEXT
"RTN","TIUROR",128,0)
 I CONTEXT=4 S TIUOCTXT=TIUOCTXT_U_TIUDUZ
"RTN","TIUROR",129,0)
 I CONTEXT=5 S TIUOCTXT=TIUOCTXT_U_+TIUERLY_U_+TIULATE
"RTN","TIUROR",130,0)
 S ^TMP("TIUR",$J,"SEQ")=$G(TIUSEQ)
"RTN","TIUROR",131,0)
 S ^TMP("TIUR",$J,"CTXT")=$S('+$G(TIUCCTXT)&(VALMCNT'<TIUOCC):"INIT",1:TIUOCTXT)
"RTN","TIUROR",132,0)
 I CONTEXT=1,(+$G(TIUOCC)=9999999) D SAVE^TIUROR1
"RTN","TIUROR",133,0)
 I +$G(TIUCCTXT),$D(^TMP("TIUR",$J,0)) D HDR
"RTN","TIUROR",134,0)
 ; If first build (not rebuild), expand parents to show kids that
"RTN","TIUROR",135,0)
 ;meet criteria:
"RTN","TIUROR",136,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D
"RTN","TIUROR",137,0)
 . D EXPANDKD^TIUR2(.TIUEXPKD,"",CONTEXT)
"RTN","TIUROR",138,0)
 Q
"RTN","TIUROR",139,0)
 ;
"RTN","TIUROR",140,0)
EXIT ; -- exit code
"RTN","TIUROR",141,0)
 D CLEAN^VALM10
"RTN","TIUROR",142,0)
 K DFN,VALMY,VALMCNT,VALMKEY,^TMP("TIURSAVE",$J)
"RTN","TIUROR",143,0)
 K ^TMP("TIURIDX",$J)
"RTN","TIUROR",144,0)
 K TIUGLINK ;**100**
"RTN","TIUROR",145,0)
 Q
"RTN","TIUROR",146,0)
 ;
"RTN","TIUROR",147,0)
RBLD ; -- rebuild list after actions
"RTN","TIUROR",148,0)
 N TIUEXP,TIURBLD
"RTN","TIUROR",149,0)
 S TIURBLD=1
"RTN","TIUROR",150,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D  Q
"RTN","TIUROR",151,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIUROR",152,0)
 . D INIT(+$G(^TMP("TIUR",$J,"CLASS")),+$G(^("CTXT")),+$G(^("DFN")),+$G(^("OCC")))
"RTN","TIUROR",153,0)
 . D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIUROR",154,0)
 . D BREATHE^TIUROR1(1)
"RTN","TIUROR",155,0)
 D INIT(+$G(^TMP("TIUR",$J,"CLASS")),+$G(^("CTXT")),+$G(^("DFN")),+$G(^("OCC")))
"RTN","TIUROR",156,0)
 D HDR S VALMBCK="R",VALMBG=1,VALMCNT=+$G(^TMP("TIUR",$J,0))
"RTN","TIUROR",157,0)
 Q
"RTN","TIUROR1")
0^78^B5585918
"RTN","TIUROR1",1,0)
TIUROR1 ;SLC/JER - New PATIENT Review screen ; 12/3/00
"RTN","TIUROR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUROR1",3,0)
 ; New, created 11/27/00 by splitting TIUROR
"RTN","TIUROR1",4,0)
 ;
"RTN","TIUROR1",5,0)
ASKCTXT() ; Ask user for new context
"RTN","TIUROR1",6,0)
 N TIUY,DIR,Y
"RTN","TIUROR1",7,0)
 ; newed Y 9/21
"RTN","TIUROR1",8,0)
 S DIR(0)="SAO^1:SIGNED;2:UNSIGNED;3:UNCOSIGNED;4:AUTHOR;5:DATES"
"RTN","TIUROR1",9,0)
 S DIR("A")="Select context: ",DIR("A",1)="Valid selections are:"
"RTN","TIUROR1",10,0)
 S DIR("A",2)="  1 - signed notes (all)   2 - unsigned notes       3 - uncosigned notes"
"RTN","TIUROR1",11,0)
 S DIR("A",3)="  4 - signed notes/author  5 - signed notes/dates",DIR("A",4)="    "
"RTN","TIUROR1",12,0)
 S DIR("?",1)="To change which notes are displayed, select the number"
"RTN","TIUROR1",13,0)
 S DIR("?")="of the context you wish to work within.",DIR("B")="1"
"RTN","TIUROR1",14,0)
 W ! D ^DIR
"RTN","TIUROR1",15,0)
 Q +Y
"RTN","TIUROR1",16,0)
 ;
"RTN","TIUROR1",17,0)
SAVE ; -- Set aside original list
"RTN","TIUROR1",18,0)
 K ^TMP("TIURSAVE",$J)
"RTN","TIUROR1",19,0)
 M ^TMP("TIURSAVE",$J)=^TMP("TIUR",$J)
"RTN","TIUROR1",20,0)
 M ^TMP("TIURSAVIDX",$J)=^TMP("TIURIDX",$J)
"RTN","TIUROR1",21,0)
 Q
"RTN","TIUROR1",22,0)
 ;
"RTN","TIUROR1",23,0)
RESTORE ; -- restore original All Signed list
"RTN","TIUROR1",24,0)
 I '$D(^TMP("TIURSAVE",$J)) D  Q
"RTN","TIUROR1",25,0)
 . D INIT^TIUROR(+$G(^TMP("TIUR",$J,"CLASS")),1,+$G(^("DFN")),9999999)
"RTN","TIUROR1",26,0)
 . S VALMBCK="R",VALMBG=1,VALMCNT=+$G(^TMP("TIUR",$J,0))
"RTN","TIUROR1",27,0)
 K ^TMP("TIUR",$J)
"RTN","TIUROR1",28,0)
 M ^TMP("TIUR",$J)=^TMP("TIURSAVE",$J)
"RTN","TIUROR1",29,0)
 M ^TMP("TIURIDX",$J)=^TMP("TIURSAVIDX",$J)
"RTN","TIUROR1",30,0)
 S VALMBCK="R",VALMBG=1,VALMCNT=+$G(^TMP("TIUR",$J,0))
"RTN","TIUROR1",31,0)
 Q
"RTN","TIUROR1",32,0)
 ;
"RTN","TIUROR1",33,0)
BREATHE(ONCE) ; -- Collapse/Re-expand in reverse order to avoid collisions
"RTN","TIUROR1",34,0)
 N TIUI
"RTN","TIUROR1",35,0)
 S TIUI=""
"RTN","TIUROR1",36,0)
 F  S TIUI=$O(^TMP("TIUR",$J,"EXPAND",TIUI),-1) Q:+TIUI'>0  D
"RTN","TIUROR1",37,0)
 . D EC1^TIURECL(TIUI,1) ; Inhale
"RTN","TIUROR1",38,0)
 . D:'+$D(ONCE) EC1^TIURECL(TIUI,1) ; Exhale
"RTN","TIUROR1",39,0)
 . W "."
"RTN","TIUROR1",40,0)
 Q
"RTN","TIUROR1",41,0)
 ;
"RTN","TIUROR1",42,0)
RELOAD(TIUEXP) ; Reload ^TMP("TIUR",$J,"EXPAND") w IFNs to expand, gotten
"RTN","TIUROR1",43,0)
 ;from previous user expansions.  (Line numbers have changed.)
"RTN","TIUROR1",44,0)
 N TIUI S TIUI=0
"RTN","TIUROR1",45,0)
 F  S TIUI=$O(TIUEXP(TIUI)) Q:+TIUI'>0  D
"RTN","TIUROR1",46,0)
 . N TIUDA,TIUJ
"RTN","TIUROR1",47,0)
 . S TIUDA=$G(TIUEXP(TIUI)),TIUJ=$O(^TMP("TIUR",$J,"IEN",TIUDA,0)) Q:+TIUJ'>0
"RTN","TIUROR1",48,0)
 . S ^TMP("TIUR",$J,"EXPAND",TIUJ)=TIUDA_U_1
"RTN","TIUROR1",49,0)
 Q
"RTN","TIUROR1",50,0)
 ;
"RTN","TIUROR1",51,0)
LOAD(TIUXCTXT,TIUXCTX2) ; Load ^TMP("TIUR",$J,"EXPAND") w IFNs to expand,
"RTN","TIUROR1",52,0)
 ;gotten from doing CONTEXT^TIUSRVLL
"RTN","TIUROR1",53,0)
 ; These are parent records that must be expanded to display ID kids or
"RTN","TIUROR1",54,0)
 ;addenda under them that fall within search criteria.
"RTN","TIUROR1",55,0)
 N TIUDA,LINENO
"RTN","TIUROR1",56,0)
 S TIUDA=0
"RTN","TIUROR1",57,0)
 F  S TIUDA=$O(TIUXCTXT(TIUDA)) Q:'TIUDA  D
"RTN","TIUROR1",58,0)
 . S LINENO=$O(^TMP("TIUR",$J,"IEN",TIUDA,0))
"RTN","TIUROR1",59,0)
 . I 'LINENO S TIUXCTX2(TIUDA)="" Q
"RTN","TIUROR1",60,0)
 . S ^TMP("TIUR",$J,"EXPAND",LINENO)=TIUDA_U_1
"RTN","TIUROR1",61,0)
 Q
"RTN","TIURORL")
0^18^B2065529
"RTN","TIURORL",1,0)
TIURORL ; SLC/JER - List Management Library for OE screen ;4/17/00
"RTN","TIURORL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURORL",3,0)
UPDATE(ITEM) ; Updates list following actions
"RTN","TIURORL",4,0)
 N AUT,RDT,TITL,TIUD0,TIUD12,TIUD13,TIUDA,IDKIDFLG
"RTN","TIURORL",5,0)
 N STAT,TIUR ;10/2/00
"RTN","TIURORL",6,0)
 S TIUDA=+$P(ITEM,U,2)
"RTN","TIURORL",7,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIURORL",8,0)
 S TITL=$$PNAME^TIULC1(+TIUD0),IDKIDFLG=1
"RTN","TIURORL",9,0)
 I +$O(^TIU(8925,"DAD",+TIUDA,0)),+$$HASADDEN^TIULC1(TIUDA,IDKIDFLG) S TITL="+ "_TITL ;**100**
"RTN","TIURORL",10,0)
 S AUT=$$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD12,U,2)),"LAST,FI")
"RTN","TIURORL",11,0)
 S RDT=$$DATE^TIULS(+TIUD13,"MM/DD/YY HR:MIN")
"RTN","TIURORL",12,0)
 S STAT=$$LOW^XLFSTR($P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U))
"RTN","TIURORL",13,0)
 S TIUR=$$SETFLD^VALM1(VALMCNT,$G(TIUR),"NUMBER")
"RTN","TIURORL",14,0)
 S TIUR=$$SETFLD^VALM1(TITL,$G(TIUR),"TITLE")
"RTN","TIURORL",15,0)
 S TIUR=$$SETFLD^VALM1(AUT,$G(TIUR),"AUTHOR")
"RTN","TIURORL",16,0)
 S TIUR=$$SETFLD^VALM1(RDT,$G(TIUR),"REF DATE")
"RTN","TIURORL",17,0)
 S TIUR=$$SETFLD^VALM1(STAT,$G(TIUR),"STATUS")
"RTN","TIURORL",18,0)
 S ^TMP("TIUR",$J,VALMCNT,0)=TIUR
"RTN","TIURORL",19,0)
 D RESTORE^VALM10(+ITEM),CNTRL^VALM10(+ITEM,1,VALM("RM"),IOINHI,IOINORM)
"RTN","TIURORL",20,0)
 Q
"RTN","TIURPN")
0^22^B15628738
"RTN","TIURPN",1,0)
TIURPN ; SLC/JER - QUICK Review BY PATIENT ;2/28/01
"RTN","TIURPN",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURPN",3,0)
EN(TIUCLASS,DFN) ; Entry point for build code
"RTN","TIURPN",4,0)
 N DIRUT,DTOUT,DUOUT,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIURPN",5,0)
 N TIUDPRMT,TIUPICT,TIUOUT
"RTN","TIURPN",6,0)
 K DIROUT
"RTN","TIURPN",7,0)
 S TIUEDT=$$FMADD^XLFDT(DT,$S($D(^DPT(DFN,.1))'>0:-180,1:-30))
"RTN","TIURPN",8,0)
 S TIULDT=+$$NOW^XLFDT
"RTN","TIURPN",9,0)
 W !,"Searching for the documents."
"RTN","TIURPN",10,0)
 D BUILD(TIUCLASS,DFN,TIUEDT,TIULDT)
"RTN","TIURPN",11,0)
 Q
"RTN","TIURPN",12,0)
BUILD(CLASS,DFN,EARLY,LATE) ; Build List
"RTN","TIURPN",13,0)
 N TIUCNT,TIUDT,TIUI,TIUJ,TIUK,TIUP,TIUQ,TIUDA,TIUREC
"RTN","TIURPN",14,0)
 N TIUT,TIUTP,XREF,TIUS,TIUPREF,TIUPICK
"RTN","TIURPN",15,0)
 S (TIUK,VALMCNT)=0
"RTN","TIURPN",16,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J)
"RTN","TIURPN",17,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-+$G(LATE)
"RTN","TIURPN",18,0)
 S TIUJ=LATE
"RTN","TIURPN",19,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIURPN",20,0)
 F  S TIUJ=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUJ)) Q:+TIUJ'>0!(+TIUJ>EARLY)  D
"RTN","TIURPN",21,0)
 . S TIUDA=0
"RTN","TIURPN",22,0)
 . F  S TIUDA=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUJ,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURPN",23,0)
 . . D ADDELMNT(TIUDA,.TIUCNT)
"RTN","TIURPN",24,0)
 S ^TMP("TIUR",$J,0)=+$G(TIUCNT)_U_"ALL^APT^"_DFN
"RTN","TIURPN",25,0)
 S ^TMP("TIUR",$J,0)=^TMP("TIUR",$J,0)_U_$P(^DPT(DFN,0),U)
"RTN","TIURPN",26,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIURPN",27,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(TIUCNT)
"RTN","TIURPN",28,0)
 I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIURPN",29,0)
 S VALMCNT=+$G(TIUCNT)
"RTN","TIURPN",30,0)
 I +$G(TIUCNT)'>0 D
"RTN","TIURPN",31,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIURPN",32,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIURPN",33,0)
 Q
"RTN","TIURPN",34,0)
ADDELMNT(DA,TIUCNT) ; Add each element to the list
"RTN","TIURPN",35,0)
 N DIC,DIQ,DR,TIUR,PT,MOM,ADT,DDT,LCT,AUT,AMD,EDT,SDT,XDT,RMD,TIULST4
"RTN","TIURPN",36,0)
 N TIUP,TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,TIULI,STATX,DOC,IDKIDFLG
"RTN","TIURPN",37,0)
 I '$D(^TIU(8925,DA,0)) Q
"RTN","TIURPN",38,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIURPN",39,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1) S TIUCNT=0
"RTN","TIURPN",40,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIURPN",41,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIURPN",42,0)
 I +TIUD0=81,(+$P(TIUD0,U,5)>5) Q
"RTN","TIURPN",43,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIURPN",44,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIURPN",45,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIURPN",46,0)
 S TIULI=$E(PT),IDKIDFLG=1
"RTN","TIURPN",47,0)
 I +$O(^TIU(8925,"DAD",+DA,0)),$$HASADDEN^TIULC1(DA,IDKIDFLG) S PT="+ "_PT ;**100**
"RTN","TIURPN",48,0)
 S TIUP=$$URGENCY(+DA)
"RTN","TIURPN",49,0)
 S:TIUP=1 PT=$S(PT["+":"*",1:"* ")_PT
"RTN","TIURPN",50,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIURPN",51,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIURPN",52,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIURPN",53,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIURPN",54,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIURPN",55,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIURPN",56,0)
 S AMD=$$NAME^TIULS(AMD,"LAST,FI MI")
"RTN","TIURPN",57,0)
 S AUT=$$NAME^TIULS(AUT,"LAST,FI MI")
"RTN","TIURPN",58,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY")
"RTN","TIURPN",59,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIURPN",60,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURPN",61,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIURPN",62,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIURPN",63,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIURPN",64,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIURPN",65,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIURPN",66,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIURPN",67,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"REF DATE")
"RTN","TIURPN",68,0)
 S TIUREC=$$SETFLD^VALM1(SDT,TIUREC,"SIG DATE")
"RTN","TIURPN",69,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIURPN",70,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIURPN",71,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"COSIGNER")
"RTN","TIURPN",72,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIURPN",73,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W:TIUCNT#10'>0 "."
"RTN","TIURPN",74,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_DA
"RTN","TIURPN",75,0)
 S VALMCNT=TIUCNT
"RTN","TIURPN",76,0)
 Q
"RTN","TIURPN",77,0)
CLEAN ; Clean up your mess!
"RTN","TIURPN",78,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10
"RTN","TIURPN",79,0)
 K VALMY
"RTN","TIURPN",80,0)
 Q
"RTN","TIURPN",81,0)
URGENCY(TIUDA) ; What is the urgency of the current document
"RTN","TIURPN",82,0)
 N TIUY,TIUD0,TIUDSTAT,TIUDURG
"RTN","TIURPN",83,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUDSTAT=$P(TIUD0,U,5)
"RTN","TIURPN",84,0)
 S TIUDURG=$P(TIUD0,U,9)
"RTN","TIURPN",85,0)
 S TIUY=$S(TIUDSTAT<7:$S(TIUDURG="P":1,1:2),1:3)
"RTN","TIURPN",86,0)
 Q TIUY
"RTN","TIURPTT1")
0^79^B29452638
"RTN","TIURPTT1",1,0)
TIURPTT1 ; SLC/JER - Review Documents by PATIENT & TITLE ;2/28/01
"RTN","TIURPTT1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURPTT1",3,0)
 ; 12/5/00 new rtn from splitting TIURPTTL
"RTN","TIURPTT1",4,0)
GATHER(TIUI,TIUPREF,CLASS,STATIFNS,EARLY,LATE,XREF) ; Find/sort records for the list
"RTN","TIURPTT1",5,0)
 N TIUT,TIUTP,TIUS,TIUSTAT,TIUSFLD,TIUJ,TIUQ,TIUIFN
"RTN","TIURPTT1",6,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURPTT1",7,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURPTT1",8,0)
 S TIUT=0 F  S TIUT=$O(TYPES(TIUT)) Q:+TIUT'>0  D
"RTN","TIURPTT1",9,0)
 . S TIUTP=+$P($G(TYPES(TIUT)),U,2) Q:TIUTP'>0
"RTN","TIURPTT1",10,0)
 . S TIUS=1 F  S TIUSTAT=$P(STATIFNS,";",TIUS) Q:'TIUSTAT  D
"RTN","TIURPTT1",11,0)
 . . S TIUS=TIUS+1
"RTN","TIURPTT1",12,0)
 . . S TIUJ=LATE F  S TIUJ=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ)) Q:+TIUJ'>0!(+TIUJ>EARLY)  D
"RTN","TIURPTT1",13,0)
 . . . S TIUIFN=0
"RTN","TIURPTT1",14,0)
 . . . F  S TIUIFN=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ,TIUIFN)) Q:+TIUIFN'>0  D
"RTN","TIURPTT1",15,0)
 . . . . ;Consider adding view check here
"RTN","TIURPTT1",16,0)
 . . . . I TIUTP=81,(+TYPES>1),($P(TYPES(TIUT),U,4)="NOT PICKED"),'+$$DADINTYP(TIUIFN,.TYPES) Q
"RTN","TIURPTT1",17,0)
 . . . . S TIUQ=$$RESOLVE^TIUR1(TIUIFN,TIUSFLD)
"RTN","TIURPTT1",18,0)
 . . . . S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)=""
"RTN","TIURPTT1",19,0)
 Q
"RTN","TIURPTT1",20,0)
DADINTYP(TIUDA,TYPES) ; Evaluates whether addendum's parent belongs is among
"RTN","TIURPTT1",21,0)
 ;                 the selected types
"RTN","TIURPTT1",22,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIURPTT1",23,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIURPTT1",24,0)
 F  S TIUI=$O(TYPES(TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIURPTT1",25,0)
 . I +$P(TYPES(TIUI),U,2)=TIUDTYP S TIUY=1
"RTN","TIURPTT1",26,0)
 Q TIUY
"RTN","TIURPTT1",27,0)
PUTLIST(TIUPREF,TIUCLASS,STATUS,SCREEN) ; Adds list elements
"RTN","TIURPTT1",28,0)
 ;to LM Template array
"RTN","TIURPTT1",29,0)
 N TIUJ,TIUQ,TIUDA,TIUPICK,TIUORDER
"RTN","TIURPTT1",30,0)
 N TIUEXPKD,FORGETAD,TIUSFLD
"RTN","TIURPTT1",31,0)
 S VALMCNT=0
"RTN","TIURPTT1",32,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURPTT1",33,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURPTT1",34,0)
 S TIUORDER=$S($P(TIUPREF,U,4)="D":-1,1:1)
"RTN","TIURPTT1",35,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIURPTT1",36,0)
 S TIUQ="" F  S TIUQ=$O(^TMP("TIUI",$J,TIUQ)) Q:TIUQ']""  D
"RTN","TIURPTT1",37,0)
 . S TIUJ=0 F  S TIUJ=$O(^TMP("TIUI",$J,TIUQ,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURPTT1",38,0)
 . . S TIUDA=0
"RTN","TIURPTT1",39,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURPTT1",40,0)
 . . . S FORGETAD=1
"RTN","TIURPTT1",41,0)
 . . . ; Replace ID kids/addenda in ^TMP("TIUI",$J) with
"RTN","TIURPTT1",42,0)
 . . . ;their parents. Don't expand parent for sake of addm:
"RTN","TIURPTT1",43,0)
 . . . D REPLACE^TIUR2(TIUDA,TIUQ,TIUSFLD,TIUJ,.TIUEXPKD,FORGETAD)
"RTN","TIURPTT1",44,0)
 D SETLIST(TIUORDER,.VALMCNT)
"RTN","TIURPTT1",45,0)
 S ^TMP("TIUR",$J,0)=+$G(VALMCNT)_U_STATUS("WORDS")
"RTN","TIURPTT1",46,0)
 S TIUJ=0,SCREEN="" F  S TIUJ=$O(SCREEN(TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURPTT1",47,0)
 . S SCREEN=$G(SCREEN)_$S(TIUJ>1:";",1:U)_SCREEN(TIUJ)
"RTN","TIURPTT1",48,0)
 S ^TMP("TIUR",$J,0)=^TMP("TIUR",$J,0)_$G(SCREEN)
"RTN","TIURPTT1",49,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIURPTT1",50,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(VALMCNT)
"RTN","TIURPTT1",51,0)
 I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIURPTT1",52,0)
 I +$G(VALMCNT)'>0 D
"RTN","TIURPTT1",53,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIURPTT1",54,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIURPTT1",55,0)
 ; -- Expand to show kids that fit:
"RTN","TIURPTT1",56,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D EXPANDKD^TIUR2(.STATUS,.TIUEXPKD)
"RTN","TIURPTT1",57,0)
 Q
"RTN","TIURPTT1",58,0)
 ;
"RTN","TIURPTT1",59,0)
SETLIST(TIUORDER,VALMCNT) ; Set items from ^TMP("TIUI",$J) into
"RTN","TIURPTT1",60,0)
 ;List Template list
"RTN","TIURPTT1",61,0)
 N TIUSVAL,TIUDTM,TIUDA
"RTN","TIURPTT1",62,0)
 S TIUSVAL=""
"RTN","TIURPTT1",63,0)
 F  S TIUSVAL=$O(^TMP("TIUI",$J,TIUSVAL),TIUORDER) Q:TIUSVAL=""  D
"RTN","TIURPTT1",64,0)
 . S TIUDTM=0
"RTN","TIURPTT1",65,0)
 . F  S TIUDTM=$O(^TMP("TIUI",$J,TIUSVAL,TIUDTM)) Q:'TIUDTM  D
"RTN","TIURPTT1",66,0)
 . . S TIUDA=0
"RTN","TIURPTT1",67,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUSVAL,TIUDTM,TIUDA)) Q:'TIUDA  D
"RTN","TIURPTT1",68,0)
 . . . D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIURPTT1",69,0)
 Q
"RTN","TIURPTT1",70,0)
 ;
"RTN","TIURPTT1",71,0)
ADDELMNT(DA,TIUCNT,APPEND) ; Add each element to the list
"RTN","TIURPTT1",72,0)
 N PT,ADT,DDT,AUT,AMD,EDT,SDT,TIULST4
"RTN","TIURPTT1",73,0)
 N TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,TIULI,STATX,DOC
"RTN","TIURPTT1",74,0)
 N PREFIX,TIUGDATA
"RTN","TIURPTT1",75,0)
 I '$D(^TIU(8925,DA,0)) Q
"RTN","TIURPTT1",76,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIURPTT1",77,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1) S TIUCNT=0
"RTN","TIURPTT1",78,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIURPTT1",79,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIURPTT1",80,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIURPTT1",81,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIURPTT1",82,0)
 S PREFIX=$$PREFIX^TIULA2(DA,0)
"RTN","TIURPTT1",83,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIURPTT1",84,0)
 S TIULI=$E(PT)
"RTN","TIURPTT1",85,0)
 S PT=PREFIX_PT
"RTN","TIURPTT1",86,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIURPTT1",87,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIURPTT1",88,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIURPTT1",89,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIURPTT1",90,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIURPTT1",91,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIURPTT1",92,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIURPTT1",93,0)
 S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIURPTT1",94,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY")
"RTN","TIURPTT1",95,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIURPTT1",96,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURPTT1",97,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIURPTT1",98,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIURPTT1",99,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIURPTT1",100,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIURPTT1",101,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIURPTT1",102,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIURPTT1",103,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"REF DATE")
"RTN","TIURPTT1",104,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIURPTT1",105,0)
 S TIUREC=$$SETFLD^VALM1(SDT,TIUREC,"SIG DATE")
"RTN","TIURPTT1",106,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIURPTT1",107,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"COSIGNER")
"RTN","TIURPTT1",108,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIURPTT1",109,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W "."
"RTN","TIURPTT1",110,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_DA_U_PREFIX
"RTN","TIURPTT1",111,0)
 S ^TMP("TIUR",$J,"IEN",DA,TIUCNT)="" ;MARGY 11/11/00
"RTN","TIURPTT1",112,0)
 S TIUGDATA=$$IDDATA^TIURECL1(DA,TIUD0)
"RTN","TIURPTT1",113,0)
 I TIUGDATA S ^TMP("TIUR",$J,"IDDATA",DA)=TIUGDATA
"RTN","TIURPTT1",114,0)
 S VALMCNT=TIUCNT
"RTN","TIURPTT1",115,0)
 I +$G(APPEND) D
"RTN","TIURPTT1",116,0)
 . D RESTORE^VALM10(TIUCNT)
"RTN","TIURPTT1",117,0)
 . D CNTRL^VALM10(TIUCNT,1,$G(VALM("RM")),IOINHI,IOINORM),HDR^TIURH
"RTN","TIURPTT1",118,0)
 . S VALMSG="** Item #"_TIUCNT_" Added **"
"RTN","TIURPTT1",119,0)
 . S $P(^TMP("TIUR",$J,0),U)=TIUCNT
"RTN","TIURPTT1",120,0)
 . S $P(^TMP("TIUR",$J,"#"),":",2)=TIUCNT
"RTN","TIURPTT1",121,0)
 . S VALMCNT=TIUCNT
"RTN","TIURPTT1",122,0)
 . I $D(VALMHDR)>9 D HDR^TIURH
"RTN","TIURPTT1",123,0)
 Q
"RTN","TIURPTT1",124,0)
 ;
"RTN","TIURPTTL")
0^23^B20534008
"RTN","TIURPTTL",1,0)
TIURPTTL ; SLC/JER - Review Documents by PATIENT & TITLE ;2/26/01
"RTN","TIURPTTL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURPTTL",3,0)
 ; 12/5/00 split rtn w GATHER, PUTLIST, ADDELMNT to new rtn TIURPTT1
"RTN","TIURPTTL",4,0)
 ;
"RTN","TIURPTTL",5,0)
MAKELIST(TIUCLASS) ; Get Search Criteria
"RTN","TIURPTTL",6,0)
 N DFN,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL,TIUQUIT
"RTN","TIURPTTL",7,0)
 N STATWORD,STATIFN,NOWFLAG
"RTN","TIURPTTL",8,0)
STATUS S STATUS=$$SELSTAT^TIULA(.TIUSTAT,"F","ALL")
"RTN","TIURPTTL",9,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIURPTTL",10,0)
 S TIUI=0
"RTN","TIURPTTL",11,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIURPTTL",12,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIURPTTL",13,0)
 . Q:'STATIFN
"RTN","TIURPTTL",14,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIURPTTL",15,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIURPTTL",16,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURPTTL",17,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIURPTTL",18,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIURPTTL",19,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIURPTTL",20,0)
PATIENT ; Select Patient
"RTN","TIURPTTL",21,0)
 S DFN=$S(+$G(ORVP):+$G(ORVP),1:+$$PATIENT^TIULA)
"RTN","TIURPTTL",22,0)
 I +DFN'>0 S VALMQUIT=1 Q
"RTN","TIURPTTL",23,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIURPTTL",24,0)
 N TIUDCL
"RTN","TIURPTTL",25,0)
 D TITLPICK^TIULA3(.TIUTYP,TIUCLASS)
"RTN","TIURPTTL",26,0)
 I +$D(TIUQUIT) S VALMQUIT=1 Q
"RTN","TIURPTTL",27,0)
 I +$G(TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIURPTTL",28,0)
SCREEN ;
"RTN","TIURPTTL",29,0)
 N TIUNAME
"RTN","TIURPTTL",30,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIURPTTL",31,0)
 S SCREEN=1,SCREEN(1)="APT^"_DFN
"RTN","TIURPTTL",32,0)
 D CHECKADD(.TIUTYP)
"RTN","TIURPTTL",33,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIURPTTL",34,0)
 S TIUEDT=$S($D(TIUQUIK):1,1:$P($$EDATE^TIULA("Reference","",TIUEDFLT),U))
"RTN","TIURPTTL",35,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURPTTL",36,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIURPTTL",37,0)
 S TIULDT=$S($D(TIUQUIK):9999999,1:$P($$LDATE^TIULA("Reference"),U))
"RTN","TIURPTTL",38,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURPTTL",39,0)
 I TIULDT'>0 G ERLY
"RTN","TIURPTTL",40,0)
 I TIUEDT>TIULDT D SWAP^TIUR(.TIUEDT,.TIULDT)
"RTN","TIURPTTL",41,0)
 I $L(TIULDT,".")=1 D EXPRANGE^TIUR(.TIUEDT,.TIULDT)
"RTN","TIURPTTL",42,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIURPTTL",43,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIURPTTL",44,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIURPTTL",45,0)
 D BUILD(TIUCLASS,.STATUS,.TIUTYP,.SCREEN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIURPTTL",46,0)
 ; -- If changed view while attaching ID note, update video for note: --
"RTN","TIURPTTL",47,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIURPTTL",48,0)
 Q
"RTN","TIURPTTL",49,0)
CHECKADD(TYPES) ; Checks whether Addendum is included in the list of types
"RTN","TIURPTTL",50,0)
 N TIUI,HIT S (TIUI,HIT)=0
"RTN","TIURPTTL",51,0)
 F  S TIUI=$O(TYPES(TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(TYPES(TIUI))["ADDENDUM" S HIT=1
"RTN","TIURPTTL",52,0)
 I +HIT'>0 S TYPES(TYPES+1)=+TYPES(TYPES)+1_U_"81^Addendum^NOT PICKED",TYPES=TYPES+1
"RTN","TIURPTTL",53,0)
 Q
"RTN","TIURPTTL",54,0)
BUILD(TIUCLASS,STATUS,TYPES,SCREEN,EARLY,LATE,NOWFLAG) ; Build List
"RTN","TIURPTTL",55,0)
 N TIUCNT,TIUDT,TIUI,TIUJ,TIUK,TIUQ,TIUIFN,TIUREC
"RTN","TIURPTTL",56,0)
 N XREF,TIUS,TIUPREF
"RTN","TIURPTTL",57,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIURPTTL",58,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J),^TMP("TIUTYP",$J)
"RTN","TIURPTTL",59,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIURPTTL",60,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIURPTTL",61,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIURPTTL",62,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIURPTTL",63,0)
 ; Save docmt types in ^TMP("TIUTYP",$J) for rebuild:
"RTN","TIURPTTL",64,0)
 M ^TMP("TIUTYP",$J)=TYPES
"RTN","TIURPTTL",65,0)
 S ^TMP("TIUR",$J,"RTN")="TIURPTTL"
"RTN","TIURPTTL",66,0)
 I '$D(TIUPRM0)!'$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURPTTL",67,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIURPTTL",68,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIURPTTL",69,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIURPTTL",70,0)
 . I XREF'="ASUB" D
"RTN","TIURPTTL",71,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIURPTTL",72,0)
 . . D GATHER^TIURPTT1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF)
"RTN","TIURPTTL",73,0)
 . I XREF="ASUB" D
"RTN","TIURPTTL",74,0)
 . . S TIUI=$O(^TIU(8925,XREF,$P(SCREEN(TIUK),U,2)),-1)
"RTN","TIURPTTL",75,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[$P(SCREEN(TIUK),U,2))  D GATHER^TIURPTT1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF)
"RTN","TIURPTTL",76,0)
 D PUTLIST^TIURPTT1(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIURPTTL",77,0)
 Q
"RTN","TIURPTTL",78,0)
CLEAN ; Clean up your mess!
"RTN","TIURPTTL",79,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10
"RTN","TIURPTTL",80,0)
 K VALMY,^TMP("TIUTYP",$J)
"RTN","TIURPTTL",81,0)
 Q
"RTN","TIURPTTL",82,0)
 ;
"RTN","TIURPTTL",83,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIURPTTL",84,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIURPTTL",85,0)
 N TIURBLD,TIUI,TIUCLASS,TIUTYP,NOWFLAG
"RTN","TIURPTTL",86,0)
 S TIURBLD=1
"RTN","TIURPTTL",87,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIURPTTL",88,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIURPTTL",89,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIURPTTL",90,0)
 M TIUTYP=^TMP("TIUTYP",$J)
"RTN","TIURPTTL",91,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIURPTTL",92,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIURPTTL",93,0)
 S TIUI=1
"RTN","TIURPTTL",94,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIURPTTL",95,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIURPTTL",96,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIURPTTL",97,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIURPTTL",98,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIURPTTL",99,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIURPTTL",100,0)
 D BUILD(TIUCLASS,.STATUS,.TIUTYP,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIURPTTL",101,0)
 ; Reexpand previously expanded items:
"RTN","TIURPTTL",102,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIURPTTL",103,0)
 D BREATHE^TIUROR1(1)
"RTN","TIURPTTL",104,0)
 Q
"RTN","TIURS")
0^80^B35669886
"RTN","TIURS",1,0)
TIURS ; SLC/JER - Electronic signature actions ;19-JAN-2001 11:14:07
"RTN","TIURS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,4,20,67,79,98,107,58,100**;Jun 20, 1997
"RTN","TIURS",3,0)
 ;12/11/00 Moved ELSIG,MULTIPRN,LIST to TIURS1
"RTN","TIURS",4,0)
ACCEPT(TIUSLST,TIUI) ; Accept for signing
"RTN","TIURS",5,0)
 N TIUSGN,TIUMSG,TIUPR,TIUFLAG
"RTN","TIURS",6,0)
 I +$G(TIUDA),($G(TIUEVNT)]"") D  Q:'+$G(TIUSGN)
"RTN","TIURS",7,0)
 . S TIUSGN=$$CANDO^TIULP(TIUDA,TIUEVNT)
"RTN","TIURS",8,0)
 . I '+TIUSGN D
"RTN","TIURS",9,0)
 . . D FULL^VALM1
"RTN","TIURS",10,0)
 . . W !!,"Document has changed...",!,$P(TIUSGN,U,2)
"RTN","TIURS",11,0)
 . . W !!,"Item #",TIUI,": Removed from signature list.",!
"RTN","TIURS",12,0)
 . . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIURS",13,0)
 S TIUSLST(TIUI)=""
"RTN","TIURS",14,0)
 W !,"Item #",TIUI,": Added to signature list." ;H 2
"RTN","TIURS",15,0)
 I +$P($G(TIUDPRM(0)),U,8) D
"RTN","TIURS",16,0)
 . S TIUMSG="Print this note"
"RTN","TIURS",17,0)
 . S TIUPR=$$READ^TIUU("Y",TIUMSG,"No")
"RTN","TIURS",18,0)
 . I +TIUPR S TIUSLST(TIUI)=1
"RTN","TIURS",19,0)
 I +$G(TIUPR),+$P($G(TIUDPRM(0)),U,9) D
"RTN","TIURS",20,0)
 . S TIUFLAG=$$FLAG^TIUPRPN3
"RTN","TIURS",21,0)
 . I +TIUFLAG S $P(TIUSLST(TIUI),U,2)=1
"RTN","TIURS",22,0)
 I +$G(XTRASGNR) S $P(TIUSLST(TIUI),U,3)=$G(XTRASGNR)
"RTN","TIURS",23,0)
 Q
"RTN","TIURS",24,0)
EDSIG(TIUDA,TIUADD,TIUPASK) ; interactive sign
"RTN","TIURS",25,0)
 N TIU,TIU0,TIU12,ASK,X,X1,TIUTYPE,SIGNER,COSIGNER,TIUTYPE,TIUMSG,TIUSTAT
"RTN","TIURS",26,0)
 N TIUES,TIUACT,TIUDPRM,XTRASGNR,TIUCOM,TIU15
"RTN","TIURS",27,0)
 I +$D(TIUSIGN),(TIUSIGN=0) Q
"RTN","TIURS",28,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURS",29,0)
 I '+$P(TIUPRM0,U,2) S VALMBCK="R" Q
"RTN","TIURS",30,0)
 S TIUADD=1
"RTN","TIURS",31,0)
 S TIU0=$G(^TIU(8925,+TIUDA,0)),TIU12=$G(^(12)),TIU15=$G(^(15))
"RTN","TIURS",32,0)
 S SIGNER=$S(+$P(TIU12,U,4):$P(TIU12,U,4),1:$P(TIU12,U,2))
"RTN","TIURS",33,0)
 S COSIGNER=$P(TIU12,U,8)
"RTN","TIURS",34,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIURS",35,0)
 S TIUSTAT=+$P(TIU0,U,5)
"RTN","TIURS",36,0)
 S TIUACT=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIURS",37,0)
 S ASK=$$CANDO^TIULP(TIUDA,TIUACT)
"RTN","TIURS",38,0)
 S TIUTYPE=$$PNAME^TIULC1(+TIU0)
"RTN","TIURS",39,0)
 I +ASK'>0 D  Q
"RTN","TIURS",40,0)
 . S VALMBCK="R"
"RTN","TIURS",41,0)
 . I +$$ISA^USRLM(+$G(DUZ),"MEDICAL INFORMATION SECTION"),(+$$ISPN^TIULX(+TIU0)'>0) Q
"RTN","TIURS",42,0)
 . I +$$ISA^USRLM(+$G(DUZ),"MAS TRANSCRIPTIONIST") Q
"RTN","TIURS",43,0)
 . I +$$ISA^USRLM(+$G(DUZ),"TRANSCRIPTIONIST") Q
"RTN","TIURS",44,0)
 . W !,$P(ASK,U,2)
"RTN","TIURS",45,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURS",46,0)
 W:$G(VALMAR)'="^TMP(""TIUVIEW"",$J)" !
"RTN","TIURS",47,0)
 I $S(+$$REQCOSIG^TIULP(+TIU0,+TIUDA,+SIGNER):1,+$P(TIU15,U,6):1,1:0),(+COSIGNER'>0) D  Q:+COSIGNER'>0
"RTN","TIURS",48,0)
 . S COSIGNER=$$ASKCSNR(TIUDA,SIGNER)
"RTN","TIURS",49,0)
 . I +COSIGNER'>0 D
"RTN","TIURS",50,0)
 . . W !!,"This ",TIUTYPE," MUST have a cosigner before you may sign.",!
"RTN","TIURS",51,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURS",52,0)
 I TIUSTAT=5,$G(DUZ)'=SIGNER D
"RTN","TIURS",53,0)
 . S TIUMSG="Author hasn't signed, are you SURE you want to sign "_TIUTYPE
"RTN","TIURS",54,0)
 W ! I $G(TIUMSG)]"",$$READ^TIUU("YO",TIUMSG,"NO","^D SIG^TIUDIRH")'>0 S VALMBCK="R" Q
"RTN","TIURS",55,0)
 L +^TIU(8925,+TIUDA):1
"RTN","TIURS",56,0)
 E  W !?5,$C(7),"Another user is editing this entry.",! W:$$READ^TIUU("EA","Press RETURN to continue...") "" S TIUQUIT=2 Q
"RTN","TIURS",57,0)
 S TIUES=$$ASKSIG^TIULA1 L -^TIU(8925,+TIUDA) I '+TIUES Q
"RTN","TIURS",58,0)
 I $D(VALMAR) D FULL^VALM1
"RTN","TIURS",59,0)
 I +$G(XTRASGNR) D ADDSIG^TIURS1(TIUDA,XTRASGNR)
"RTN","TIURS",60,0)
 I '+$G(XTRASGNR) D ES(TIUDA,TIUES)
"RTN","TIURS",61,0)
 I $G(TIUACT)="COSIGNATURE",(+$$ISADDNDM^TIULC1(TIUDA)'>0) D  Q:+TIUCOM
"RTN","TIURS",62,0)
 . N TIUADDND S TIUCOM=0
"RTN","TIURS",63,0)
 . S TIUADDND=$$READ^TIUU("YO","Do you wish to add your comments in an addendum","NO")
"RTN","TIURS",64,0)
 . I +TIUADDND D ADD^TIUADD(TIUDA,.TIUCHNG) S TIUCOM=1
"RTN","TIURS",65,0)
 I '+$G(TIUPASK) Q
"RTN","TIURS",66,0)
 D DOCPRM^TIULC1(+TIU0,.TIUDPRM,TIUDA)
"RTN","TIURS",67,0)
 I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(TIUDA)
"RTN","TIURS",68,0)
 Q
"RTN","TIURS",69,0)
ASKCSNR(DA,SIGNER) ; Ask cosigner
"RTN","TIURS",70,0)
 N DR,DIE,TIUY,TIUDCSNR,TIUPREF,TIUFLD
"RTN","TIURS",71,0)
 S TIUPREF=$$PERSPRF^TIULE(SIGNER)
"RTN","TIURS",72,0)
 S TIUDCSNR=$$PERSNAME^TIULC1($P(TIUPREF,U,9))
"RTN","TIURS",73,0)
 I TIUDCSNR="UNKNOWN" S TIUDCSNR=""
"RTN","TIURS",74,0)
 S TIUFLD=$S(+$$ISDS^TIULX(+$G(^TIU(8925,+DA,0))):"ATTENDING PHYSICIAN",1:"EXPECTED COSIGNER")
"RTN","TIURS",75,0)
 D FULL^VALM1
"RTN","TIURS",76,0)
AGN W !!,$C(7),"You must designate an ",TIUFLD,"...",!
"RTN","TIURS",77,0)
 L +^TIU(8925,+DA):1
"RTN","TIURS",78,0)
 E  W !?5,$C(7),"Another user is editing this entry.",! W:$$READ^TIUU("EA","Press RETURN to continue...") "" G ASKCOUT
"RTN","TIURS",79,0)
 I $E(TIUFLD)="A" S DR="1209R//^S X=TIUDCSNR;1208////^S X=$P(^TIU(8925,DA,12),U,9);1506////1"
"RTN","TIURS",80,0)
 E  S DR="1208R//^S X=TIUDCSNR;1506////1"
"RTN","TIURS",81,0)
 S DIE="^TIU(8925," D ^DIE
"RTN","TIURS",82,0)
ASKCOUT L -^TIU(8925,+DA)
"RTN","TIURS",83,0)
 S TIUY=+$P($G(^TIU(8925,+DA,12)),U,8)
"RTN","TIURS",84,0)
 Q TIUY
"RTN","TIURS",85,0)
ES(DA,TIUES,TIUI) ; ^DIE call for /es/
"RTN","TIURS",86,0)
 N SIGNER,DR,DIE,ESDT,TIUSTAT,TIUSTNOW,COSIGNER,SVCHIEF,CSREQ,TIUPRINT
"RTN","TIURS",87,0)
 N CSNEED,TIUTTL,TIUPSIG,TIUDPRM
"RTN","TIURS",88,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,+DA,0)),.TIUDPRM,DA)
"RTN","TIURS",89,0)
 S TIUSTAT=$P($G(^TIU(8925,+DA,0)),U,5),ESDT=$$NOW^TIULC
"RTN","TIURS",90,0)
 S SVCHIEF=+$$ISA^USRLM(DUZ,"CLINICAL SERVICE CHIEF")
"RTN","TIURS",91,0)
 S SIGNER=$P(^TIU(8925,+DA,12),U,4),COSIGNER=$P(^(12),U,8),CSREQ=0
"RTN","TIURS",92,0)
 S CSNEED=+$P($G(^TIU(8925,+DA,15)),U,6)
"RTN","TIURS",93,0)
 I +CSNEED,(DUZ'=COSIGNER),'+$G(SVCHIEF) S CSREQ=1
"RTN","TIURS",94,0)
 I TIUSTAT=5 D
"RTN","TIURS",95,0)
 . S DR=".05////"_$S(+CSREQ:6,1:7)_";1501////"_ESDT_";1502////"_+DUZ
"RTN","TIURS",96,0)
 . I '+$G(CSREQ),+CSNEED,$S(DUZ=COSIGNER:1,+$G(SVCHIEF):1,1:0) D
"RTN","TIURS",97,0)
 . . S DR=DR_";1506////0;1507////"_ESDT_";1508////"_+DUZ_";1509///^S X=$P(TIUES,U,2);1510///^S X=$P(TIUES,U,3);1511////E"
"RTN","TIURS",98,0)
 I TIUSTAT=6 S DR=".05////7;1506////0;1507////"_ESDT_";1508////"_+DUZ
"RTN","TIURS",99,0)
 Q:'$D(DR)
"RTN","TIURS",100,0)
 S DIE=8925 D ^DIE W:'$D(XWBOS) "."
"RTN","TIURS",101,0)
 I TIUSTAT=5 S DR="1503///^S X=$P(TIUES,U,2);1504///^S X=$P(TIUES,U,3);1505////E"
"RTN","TIURS",102,0)
 I TIUSTAT=6 D
"RTN","TIURS",103,0)
 . N TIUSBY S DR="",TIUSBY=$P($G(^TIU(8925,+DA,15)),U,2)
"RTN","TIURS",104,0)
 . I +TIUSBY>0 S DR="1503///^S X=$$SIGNAME^TIULS("_TIUSBY_");1504///^S X=$$SIGTITL^TIULS("_TIUSBY_");"
"RTN","TIURS",105,0)
 . S DR=$G(DR)_"1509///^S X=$P(TIUES,U,2);1510///^S X=$P(TIUES,U,3);1511////E"
"RTN","TIURS",106,0)
 S DIE=8925 D ^DIE W:'$D(XWBOS) "." S:'+$G(TIUCHNG) TIUCHNG=1
"RTN","TIURS",107,0)
 D SEND^TIUALRT(DA),SIGNIRT^TIUDIRT(+DA)
"RTN","TIURS",108,0)
 I +$$ISADDNDM^TIULC1(DA) S DA=+$P(^(0),U,6)
"RTN","TIURS",109,0)
 I +$G(CSREQ)'>0 D MAIN^TIUPD(DA,"S") I 1
"RTN","TIURS",110,0)
 ;If 'Credit Stop Code on Completion' is Yes
"RTN","TIURS",111,0)
 I +$P(^TIU(8925,+DA,0),U,11) D
"RTN","TIURS",112,0)
 . ;If workload does not exist, process using TIU's interview otherwise
"RTN","TIURS",113,0)
 . ;process as an edit using PCE's interview
"RTN","TIURS",114,0)
 . I '$$CHKVST^TIUPXAP2(+DA) D  I 1
"RTN","TIURS",115,0)
 . . N TIUCONT,TIUPRMT
"RTN","TIURS",116,0)
 . . Q:$D(XWBOS)
"RTN","TIURS",117,0)
 . . I $P(+$P(^TIU(8925,+DA,0),U,7),".")>DT D  Q
"RTN","TIURS",118,0)
 . . . W !!
"RTN","TIURS",119,0)
 . . . D QUE^TIUPXAP1
"RTN","TIURS",120,0)
 . . . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIURS",121,0)
 . . W !!
"RTN","TIURS",122,0)
 . . ;Check if workload should be entered
"RTN","TIURS",123,0)
 . . I $$CHKWKL^TIUPXAP2(+DA,.TIUDPRM) D CREDIT^TIUVSIT(DA)
"RTN","TIURS",124,0)
 . E  D
"RTN","TIURS",125,0)
 . . ;Check if workload should be entered
"RTN","TIURS",126,0)
 . . I $$CHKWKL^TIUPXAP2(+DA,.TIUDPRM) D EDTENC^TIUPXAP2(DA)
"RTN","TIURS",127,0)
 . D REMFLAG^TIUVSIT(+DA)
"RTN","TIURS",128,0)
 ; post-signature action
"RTN","TIURS",129,0)
 S TIUTTL=+$G(^TIU(8925,+DA,0)),TIUPSIG=$$POSTSIGN^TIULC1(TIUTTL)
"RTN","TIURS",130,0)
 I +$L(TIUPSIG),'+$G(CSREQ) X TIUPSIG
"RTN","TIURS",131,0)
 Q
"RTN","TIURS1")
0^81^B55954271
"RTN","TIURS1",1,0)
TIURS1 ; SLC/JER - Additional /es/ actions ;4/9/01
"RTN","TIURS1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,36,58,100**;Jun 20, 1997
"RTN","TIURS1",3,0)
 ;12/11/00 Moved ELSIG,MULTIPRN,LIST here from TIURS
"RTN","TIURS1",4,0)
ELSIG ; Sign rec
"RTN","TIURS1",5,0)
 N TIULST,TIUSLST,TIURJCT,TIUES,TIUI,X,X1,Y,TIUDAARY,TIUCHNG
"RTN","TIURS1",6,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURS1",7,0)
 I $P(TIUPRM0,U,2)'>0 W !,"Electronic signature not yet enabled." H 3 G ELSIGX
"RTN","TIURS1",8,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURS1",9,0)
 S TIUI=0 I $D(VALMY)>9 D CLEAR^VALM1
"RTN","TIURS1",10,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",11,0)
 . N TIU0,TIU12,TIUSTAT,TIUEVNT,TIUTYPE,TIUPOP,TIU15,TIUDPRM
"RTN","TIURS1",12,0)
 . N ASK,SIGNER,COSIGNER,XTRASGNR,TIUDATA,TIUDA,RSTRCTD
"RTN","TIURS1",13,0)
 . S (ASK,TIUPOP)=0
"RTN","TIURS1",14,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURS1",15,0)
 . S TIUDA=$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURS1",16,0)
 . I RSTRCTD D  Q
"RTN","TIURS1",17,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURS1",18,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",19,0)
 . S TIU0=$G(^TIU(8925,+TIUDA,0)),TIU12=$G(^(12)),TIU15=$G(^(15))
"RTN","TIURS1",20,0)
 . S SIGNER=$S(+$P(TIU12,U,4):$P(TIU12,U,4),1:$P(TIU12,U,2))
"RTN","TIURS1",21,0)
 . S COSIGNER=$P(TIU12,U,8)
"RTN","TIURS1",22,0)
 . I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIURS1",23,0)
 . S TIUSTAT=+$P(TIU0,U,5)
"RTN","TIURS1",24,0)
 . S TIUTYPE=$$PNAME^TIULC1(+TIU0)
"RTN","TIURS1",25,0)
 . S TIUEVNT=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIURS1",26,0)
 . D DOCPRM^TIULC1(+TIU0,.TIUDPRM,TIUDA)
"RTN","TIURS1",27,0)
 . S ASK=$$CANDO^TIULP(TIUDA,TIUEVNT)
"RTN","TIURS1",28,0)
 . I +ASK>0 D
"RTN","TIURS1",29,0)
 . . L +^TIU(8925,+TIUDA):1
"RTN","TIURS1",30,0)
 . . E  S ASK="0^ Another user is editing this entry."
"RTN","TIURS1",31,0)
 . I +ASK'>0,$P(ASK,U,2)]"" D  I 1
"RTN","TIURS1",32,0)
 . . D FULL^VALM1
"RTN","TIURS1",33,0)
 . . W !!,"Item #",TIUI,": ",$P(ASK,U,2),! K VALMY(TIUI)
"RTN","TIURS1",34,0)
 . . W !,"Removed from signature list.",!
"RTN","TIURS1",35,0)
 . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",36,0)
 . E  D
"RTN","TIURS1",37,0)
 . . I $S(+$$REQCOSIG^TIULP(+TIU0,+TIUDA,DUZ):1,+$P(TIU15,U,6):1,1:0),(+$P(TIU12,U,8)'>0) D  Q:+TIUPOP
"RTN","TIURS1",38,0)
 . . . N COSIGNER
"RTN","TIURS1",39,0)
 . . . W !!,"Item #",TIUI,": ",TIUTYPE," for "
"RTN","TIURS1",40,0)
 . . . W $$PTNAME^TIULC1($P(TIU0,U,2))," will need cosignature..."
"RTN","TIURS1",41,0)
 . . . S COSIGNER=$$ASKCSNR^TIURS(TIUDA,DUZ)
"RTN","TIURS1",42,0)
 . . . I +COSIGNER'>0 D
"RTN","TIURS1",43,0)
 . . . . S TIUPOP=1
"RTN","TIURS1",44,0)
 . . . . W !!,"Item #",TIUI,": MUST have a cosigner, before you may sign."
"RTN","TIURS1",45,0)
 . . . . W !!,"Removed from signature list.",!
"RTN","TIURS1",46,0)
 . . . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",47,0)
 . . N TIU,TIUY
"RTN","TIURS1",48,0)
 . . D EN^VALM("TIU SIGN/COSIGN")
"RTN","TIURS1",49,0)
 I $D(TIUSLST)'>9 D  G ELSIGX
"RTN","TIURS1",50,0)
 . S VALMSG="** Signature List Empty...Nothing signed. **"
"RTN","TIURS1",51,0)
 I $D(TIUSLST)>9 D
"RTN","TIURS1",52,0)
 . N TIUIO
"RTN","TIURS1",53,0)
 . S TIUES=$$ASKSIG^TIULA1
"RTN","TIURS1",54,0)
 . I '+TIUES S VALMSG="** Nothing Signed. **" D FIXLSTNW^TIULM Q
"RTN","TIURS1",55,0)
 . D FULL^VALM1
"RTN","TIURS1",56,0)
 . D MULTIPRN(.TIUSLST,.TIUIO)
"RTN","TIURS1",57,0)
 . S TIUI=0 F  S TIUI=$O(TIUSLST(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",58,0)
 . . N TIUPY,XTRASGNR
"RTN","TIURS1",59,0)
 . . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI)),TIUDA=$P(TIUDATA,U,2)
"RTN","TIURS1",60,0)
 . . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURS1",61,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURS1",62,0)
 . . S XTRASGNR=+$P(TIUSLST(TIUI),U,3)
"RTN","TIURS1",63,0)
 . . I +$G(XTRASGNR) D ADDSIG^TIURS1(TIUDA,XTRASGNR)
"RTN","TIURS1",64,0)
 . . I '+$G(XTRASGNR) D ES^TIURS(TIUDA,TIUES)
"RTN","TIURS1",65,0)
 . . I +TIUSLST(TIUI),(TIUIO]"") D RPC^TIUPD(.TIUPY,TIUDA,TIUIO,$P(TIUSLST(TIUI),U,2))
"RTN","TIURS1",66,0)
 . D FULL^VALM1
"RTN","TIURS1",67,0)
ELSIGX I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURS1",68,0)
 E  S TIUCHNG("UPDATE")=1
"RTN","TIURS1",69,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURS1",70,0)
 S VALMBCK="R"
"RTN","TIURS1",71,0)
 D VMSG($G(TIULST),.TIUDAARY,"signed")
"RTN","TIURS1",72,0)
 Q
"RTN","TIURS1",73,0)
VMSG(TIULST,TIUDAARY,ACTION) ; Set VALMSG for messagebar, bold changed items
"RTN","TIURS1",74,0)
 N TIUI,LINENO,ACTFIRST
"RTN","TIURS1",75,0)
 S ACTFIRST=$S(ACTION="Encounter Data Edited":1,ACTION="Signers identified/edited":1,ACTION="Title changed":1,1:0)
"RTN","TIURS1",76,0)
 I TIULST']"" D  Q
"RTN","TIURS1",77,0)
 . I ACTFIRST S VALMSG="** No changes made. **" Q
"RTN","TIURS1",78,0)
 . S VALMSG="** Nothing "_ACTION_". **"
"RTN","TIURS1",79,0)
 I ACTION="copied" S ACTION="copied; See end of list"
"RTN","TIURS1",80,0)
 S TIULST=$$NEWLST(TIULST,.TIUDAARY)
"RTN","TIURS1",81,0)
 I TIULST]"" D
"RTN","TIURS1",82,0)
 . I ACTFIRST D  Q
"RTN","TIURS1",83,0)
 . . S VALMSG="** "_ACTION_" for item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_". **"
"RTN","TIURS1",84,0)
 . S VALMSG="** Item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_" "_ACTION_". **"
"RTN","TIURS1",85,0)
 I TIULST']"" D
"RTN","TIURS1",86,0)
 . I ACTFIRST D  Q
"RTN","TIURS1",87,0)
 . . S VALMSG="** "_ACTION_"; item(s) no longer in list. **"
"RTN","TIURS1",88,0)
 . S VALMSG="** Item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_" "_ACTION_", no longer in list. **"
"RTN","TIURS1",89,0)
 . ;S VALMSG="** Item(s) "_ACTION_", no longer in list. **"
"RTN","TIURS1",90,0)
 Q:$G(^TMP("TIUR",$J,"RTN"))="TIUROR"
"RTN","TIURS1",91,0)
 F TIUI=1:1 S LINENO=$P(TIULST,", ",TIUI) Q:'LINENO  D
"RTN","TIURS1",92,0)
 . D CNTRL^VALM10(LINENO,1,$G(VALM("RM")),IOINHI,IOINORM)
"RTN","TIURS1",93,0)
 Q
"RTN","TIURS1",94,0)
NEWLST(TIULST,TIUDAARY) ; Return TIULST with updated item numbers
"RTN","TIURS1",95,0)
 N TIUI,TIULNO,TIUDA,TIUNLNO,TIUNLST
"RTN","TIURS1",96,0)
 S TIUNLST=""
"RTN","TIURS1",97,0)
 F TIUI=1:1 S TIULNO=$P(TIULST,",",TIUI) Q:'TIULNO  D
"RTN","TIURS1",98,0)
 . S TIUDA=TIUDAARY(TIULNO),TIUNLNO=$O(^TMP("TIUR",$J,"IEN",TIUDA,0))
"RTN","TIURS1",99,0)
 . I TIUNLNO S TIUNLST=$G(TIUNLST)_$S($G(TIUNLST)]"":", ",1:"")_TIUNLNO
"RTN","TIURS1",100,0)
 Q TIUNLST
"RTN","TIURS1",101,0)
 ;
"RTN","TIURS1",102,0)
MULTIPRN(TIUSLST,TIUIO) ; ask device
"RTN","TIURS1",103,0)
 N TIUI,TIUASK,TIUION,TIUPOK,IO,TIUPLIST,TIUSCRN S (TIUI,TIUPOK)=0
"RTN","TIURS1",104,0)
 F  S TIUI=$O(TIUSLST(TIUI)) Q:TIUI'>0!+TIUPOK  S:+TIUSLST(TIUI) TIUPOK=1
"RTN","TIURS1",105,0)
 I '+TIUPOK S TIUIO="" Q
"RTN","TIURS1",106,0)
 S TIUPLIST=$$LIST(.TIUSLST)
"RTN","TIURS1",107,0)
 W !!,"Please specify the device for printing item"
"RTN","TIURS1",108,0)
 W $S(TIUPLIST[",":"s",TIUPLIST["-":"s",1:""),": ",TIUPLIST,!!
"RTN","TIURS1",109,0)
 S TIUSCRN="I $L($G(^%ZIS(1,+Y,""TYPE""))),("";HFS;MT;BAR;VTRM;RES;CHAN;IMPC;""'[("";""_^(""TYPE"")_"";""))"
"RTN","TIURS1",110,0)
 S TIUION=$$DEVICE^TIUDEV(.TIUIO,"LAST","N",TIUSCRN,"Q")
"RTN","TIURS1",111,0)
 I '$L(TIUION) S TIUIO=""
"RTN","TIURS1",112,0)
 D ^%ZISC
"RTN","TIURS1",113,0)
 Q
"RTN","TIURS1",114,0)
LIST(LIST) ; build print list
"RTN","TIURS1",115,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIURS1",116,0)
 F  S TIUI=$O(LIST(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",117,0)
 . S:+LIST(TIUI) TIUY=$G(TIUY)_$S($G(TIUY)]"":", ",1:"")_TIUI
"RTN","TIURS1",118,0)
 Q $G(TIUY)
"RTN","TIURS1",119,0)
 ;
"RTN","TIURS1",120,0)
ADDSIG(TIUDA,DA) ; Apply extra signatures to a document
"RTN","TIURS1",121,0)
 N DIE,DR
"RTN","TIURS1",122,0)
 S DIE=8925.7
"RTN","TIURS1",123,0)
 S DR=".04////"_$$NOW^TIULC_";.05////"_DUZ_";.06///^S X=$$SIGNAME^TIULS("_DUZ_");.07///^S X=$$SIGTITL^TIULS("_DUZ_");.08////E"
"RTN","TIURS1",124,0)
 D ^DIE
"RTN","TIURS1",125,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIURS1",126,0)
 Q
"RTN","TIURS1",127,0)
CNVPOST ; Change Titles/Convert Postings
"RTN","TIURS1",128,0)
 N TIUI,TIULST,Y,TIUVIEW,TIUCHNG,TIUDAARY
"RTN","TIURS1",129,0)
 I $G(TIUGLINK) W !,"Please finish attaching the interdisciplinary note before changing title.",! H 3 Q
"RTN","TIURS1",130,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURS1",131,0)
 S TIUI=0
"RTN","TIURS1",132,0)
 I +$O(VALMY(0)) D FULL^VALM1
"RTN","TIURS1",133,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURS1",134,0)
 . N TIU,TIUDA,DFN,TIUDATA,VALMY,XQORM,TIUVIEW,RSTRCTD
"RTN","TIURS1",135,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURS1",136,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURS1",137,0)
 . I RSTRCTD D  Q
"RTN","TIURS1",138,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURS1",139,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",140,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURS1",141,0)
 . I +TIUVIEW'>0 D  Q  ; Exclude records user can't view
"RTN","TIURS1",142,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),! ; Echo denial message
"RTN","TIURS1",143,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",144,0)
 . S TIUCHNG=0
"RTN","TIURS1",145,0)
 . D EN^VALM("TIU CHANGE TITLE")
"RTN","TIURS1",146,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURS1",147,0)
 . I +$G(TIUCHNG) S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURS1",148,0)
 ; -- Update list: --
"RTN","TIURS1",149,0)
 S TIUCHNG("UPDATE")=1
"RTN","TIURS1",150,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURS1",151,0)
 S VALMBCK="R"
"RTN","TIURS1",152,0)
 D VMSG($G(TIULST),.TIUDAARY,"Title changed")
"RTN","TIURS1",153,0)
 Q
"RTN","TIURS1",154,0)
CNVPOST1 ; Convert Single Posting to another title
"RTN","TIURS1",155,0)
 N TIUD0,DIE,DR,TIUTITL,CHKSUM,TIUCHTTL
"RTN","TIURS1",156,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUCHNG=0
"RTN","TIURS1",157,0)
 D FULL^VALM1
"RTN","TIURS1",158,0)
 I +TIUD0=81 S TIUCHTTL="0^You may not change the TITLE of an ADDENDUM."
"RTN","TIURS1",159,0)
 I '$D(TIUCHTTL) S TIUCHTTL=$$CANDO^TIULP(TIUDA,"CHANGE TITLE")
"RTN","TIURS1",160,0)
 I +TIUCHTTL,$$DADORKID^TIUGBR(TIUDA) S TIUCHTTL="0^Interdisciplinary entries must be detached before changing titles." ;**100
"RTN","TIURS1",161,0)
 I +TIUCHTTL'>0 D  Q
"RTN","TIURS1",162,0)
 . W !!,$C(7),$P(TIUCHTTL,U,2),! ; Echo denial
"RTN","TIURS1",163,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",164,0)
 L +^TIU(8925,TIUDA,0):1
"RTN","TIURS1",165,0)
 E  D  Q
"RTN","TIURS1",166,0)
 . W !!?5,$C(7),"Another user is editing this entry.",! ; Echo denial
"RTN","TIURS1",167,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",168,0)
 S TIUTITL=$$ASKTITLE^TIULA3(+$$CLINDOC^TIULC1(+TIUD0,TIUDA),+TIUD0)
"RTN","TIURS1",169,0)
 S DIE=8925,DA=TIUDA
"RTN","TIURS1",170,0)
 S DR=".01////^S X="_TIUTITL_";.04////^S X="_$$DOCCLASS^TIULC1(TIUTITL)
"RTN","TIURS1",171,0)
 D ^DIE
"RTN","TIURS1",172,0)
 I +$G(^TIU(8925,+TIUDA,0))'=+TIUD0 S TIUCHNG=1
"RTN","TIURS1",173,0)
 S CHKSUM=+$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")")
"RTN","TIURS1",174,0)
 D AUDIT^TIUEDI1(TIUDA,CHKSUM,CHKSUM)
"RTN","TIURS1",175,0)
 L -^TIU(8925,TIUDA,0)
"RTN","TIURS1",176,0)
 Q
"RTN","TIURT")
0^87^B42216967
"RTN","TIURT",1,0)
TIURT ; SLC/JER,MAM - Sign On Chart, etc. ;14-MAR-2001 09:52:41
"RTN","TIURT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**71,58,100**;Jun 20, 1997
"RTN","TIURT",3,0)
SIGNCHRT ; Mark signed on chart
"RTN","TIURT",4,0)
 N TIUCHNG,TIUI,TIUY,Y,DIROUT
"RTN","TIURT",5,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURT",6,0)
 S TIUI=0
"RTN","TIURT",7,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURT",8,0)
 . N TIU,DFN,TIUDA,TIUDATA,RSTRCTD
"RTN","TIURT",9,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURT",10,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURT",11,0)
 . I RSTRCTD D  Q
"RTN","TIURT",12,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURT",13,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURT",14,0)
 . D EN^VALM("TIU SIGN ON CHART")
"RTN","TIURT",15,0)
 ; -- Update or Rebuild list: --
"RTN","TIURT",16,0)
 S TIUCHNG("UPDATE")=1
"RTN","TIURT",17,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURT",18,0)
 S VALMBCK="R"
"RTN","TIURT",19,0)
 Q
"RTN","TIURT",20,0)
SIGCHRT1(TIUDA) ; Single record sign on chart
"RTN","TIURT",21,0)
 N SIGMSG D FULL^VALM1
"RTN","TIURT",22,0)
 D OC(TIUDA,.SIGMSG)
"RTN","TIURT",23,0)
 W !,$G(SIGMSG(1)),!,$G(SIGMSG(2)),! H $S($D(SIGMSG(0)):+SIGMSG(0),1:3)
"RTN","TIURT",24,0)
 Q
"RTN","TIURT",25,0)
OC(DA,MSG) ; Mark signed on chart. Edit on-chart signatures.
"RTN","TIURT",26,0)
 N SIGNER,DIE,DR,Y,TIUSTAT,COSIGNER,TIUDA,COSMODE,SIGMODE
"RTN","TIURT",27,0)
 N SIGNAME,COSNAME,SIGTITL,COSTITL,TIU0,TIU12,TIU15,TIU16
"RTN","TIURT",28,0)
 N TIUSFLDS,TIUCFLDS,TIUPSIG,NTIU15
"RTN","TIURT",29,0)
 S MSG=$$READ^TIUU("YO","Mark this Document 'Signed on chart'/Edit Marked Signature(s)","NO","^D OCSIG^TIUDIRH") ; P71 wording
"RTN","TIURT",30,0)
 I 'MSG S TIUCHNG=0 G OCX
"RTN","TIURT",31,0)
 S TIUCHNG=1
"RTN","TIURT",32,0)
 S TIU0=$G(^TIU(8925,+DA,0)),TIU12=$G(^(12)),TIU15=$G(^(15))
"RTN","TIURT",33,0)
 S SIGNER=$$PERSNAME^TIULC1(+$P(TIU12,U,4))
"RTN","TIURT",34,0)
 S COSIGNER=$$PERSNAME^TIULC1(+$P(TIU12,U,8))
"RTN","TIURT",35,0)
 S SIGMODE=$P(TIU15,U,5),COSMODE=$P(TIU15,U,11)
"RTN","TIURT",36,0)
 S TIUSTAT=$$STATUS^TIULC(DA)
"RTN","TIURT",37,0)
 ; P71. Input transform kills null Sig Blk Title but accepts @
"RTN","TIURT",38,0)
 S TIUSFLDS="1501//NOW;1502//"_SIGNER_";S SIGNAME=$$SIGNAME^TIULS(X),SIGTITL=$$SIGTITL^TIULS(X) S:SIGTITL="""" SIGTITL=""@"";1503///^S X=SIGNAME;1504///^S X=SIGTITL;1505////C" ; user edit Signature flds
"RTN","TIURT",39,0)
 S TIUCFLDS="1507//NOW;1508//"_COSIGNER_";S COSNAME=$$SIGNAME^TIULS(X),COSTITL=$$SIGTITL^TIULS(X) S:COSTITL="""" COSTITL=""@"";1509///^S X=COSNAME;1510///^S X=COSTITL;1511////C" ; user edit Co-signature flds
"RTN","TIURT",40,0)
 I TIUSTAT="completed",(SIGMODE="C") S DR=TIUSFLDS ; user edit sig
"RTN","TIURT",41,0)
 I TIUSTAT="completed"&(COSMODE="C") S DR=TIUCFLDS ; user edit co-sig
"RTN","TIURT",42,0)
 I TIUSTAT="uncosigned"&(SIGMODE'="C") S DR=TIUCFLDS ; new co-signature
"RTN","TIURT",43,0)
 I $S(TIUSTAT="unsigned":1,COSMODE="C"&(SIGMODE="C"):1,SIGMODE="C"&(TIUSTAT="uncosigned"):1,1:0) D
"RTN","TIURT",44,0)
 . N TIUWHO
"RTN","TIURT",45,0)
 . I (COSIGNER]""),(SIGNER'=COSIGNER) S TIUWHO=$P($$READ^TIUU("SO^S:signer;C:cosigner;B:both","Which signatures are on chart?","both"),U)
"RTN","TIURT",46,0)
 . E  S TIUWHO="S"
"RTN","TIURT",47,0)
 . ; TIUWHO=S if expsigner=expcosigner or if there is no expcosigner,
"RTN","TIURT",48,0)
 . ; or if user answered S.
"RTN","TIURT",49,0)
 . I $S('$L(TIUWHO):1,"SCB"'[$P(TIUWHO,U):1,1:0) Q
"RTN","TIURT",50,0)
 . I TIUWHO="S" S DR=TIUSFLDS
"RTN","TIURT",51,0)
 . I TIUWHO="C" S DR=TIUCFLDS
"RTN","TIURT",52,0)
 . I TIUWHO="B" S DR=TIUSFLDS_";"_TIUCFLDS
"RTN","TIURT",53,0)
 I $D(DR) S DR=DR_";1512////"_DUZ
"RTN","TIURT",54,0)
 I '$D(DR) D  G OCX
"RTN","TIURT",55,0)
 . S MSG(1)="  No signatures available to mark 'Signed on chart' or edit"
"RTN","TIURT",56,0)
 . S TIU16=$G(^TIU(8925,DA,16))
"RTN","TIURT",57,0)
 . I (TIUSTAT="amended"),'$P(TIU16,U,3) S MSG(1)="  'Chart' amendment signatures are automatic; can't edit",MSG(0)="5HANG"
"RTN","TIURT",58,0)
 S DIE=8925 D ^DIE S NTIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",59,0)
 D OCDELETE(DA,TIU15,.NTIU15,.MSG)
"RTN","TIURT",60,0)
 ; If user left docmt co-signed but not signed, then stuff signer
"RTN","TIURT",61,0)
 ; with cosigner data (and P71 - avoid ^(15)):
"RTN","TIURT",62,0)
 I $P(NTIU15,U,7),'$P(NTIU15,U) D STUFFSIG(DA,.NTIU15)
"RTN","TIURT",63,0)
 ; P71 If user left docmt signed but uncosigned, and entered expected 
"RTN","TIURT",64,0)
 ; cosigner for signer, then stuff cosigner with signer data:
"RTN","TIURT",65,0)
 I $P(NTIU15,U),'$P(NTIU15,U,7),$P(NTIU15,U,2)=$P(TIU12,U,8) D STUFFCOS(DA,.NTIU15)
"RTN","TIURT",66,0)
 S TIUDA=DA D UPDATE^TIUU
"RTN","TIURT",67,0)
 ; P71 Do alert AFTER status update so alert to cosigner=signer is
"RTN","TIURT",68,0)
 ; deleted if complete:
"RTN","TIURT",69,0)
 S DR=".05///"_$$STATUS^TIULC(+DA),DIE=8925 D ^DIE
"RTN","TIURT",70,0)
 S TIU0=$G(^TIU(8925,DA,0))
"RTN","TIURT",71,0)
 D SEND^TIUALRT(+DA)
"RTN","TIURT",72,0)
 D SIGNIRT^TIUDIRT(+DA)
"RTN","TIURT",73,0)
 ; post-signature action
"RTN","TIURT",74,0)
 S TIUPSIG=$$POSTSIGN^TIULC1(+TIU0)
"RTN","TIURT",75,0)
 I +$L(TIUPSIG),(+$P(TIU0,U,5)>6) X TIUPSIG
"RTN","TIURT",76,0)
OCX I $D(MSG)<10 S MSG(1)="  On chart signature data NOT changed."
"RTN","TIURT",77,0)
 Q
"RTN","TIURT",78,0)
 ;
"RTN","TIURT",79,0)
OCDELETE(DA,TIU15,NTIU15,MSG) ; Clean up data if signers/dates deleted or
"RTN","TIURT",80,0)
 ;                         partially deleted
"RTN","TIURT",81,0)
 N TIUSFLDS,TIUCFLDS,DR,DIE,X,Y
"RTN","TIURT",82,0)
 S TIUSFLDS="1501///@;1502///@;1503///@;1504///@;1505///@"
"RTN","TIURT",83,0)
 S TIUCFLDS="1507///@;1508///@;1509///@;1510///@;1511///@"
"RTN","TIURT",84,0)
 D  ; If user altered sign flds and they are deleted or partially
"RTN","TIURT",85,0)
 . ;  deleted, then delete sign flds:
"RTN","TIURT",86,0)
 . I $P(NTIU15,U)=$P(TIU15,U),$P(NTIU15,U,2)=$P(TIU15,U,2) Q
"RTN","TIURT",87,0)
 . S MSG(1)=$S($P(NTIU15,U)&'$P(TIU15,U):"  Marked 'Signed on chart'",1:"  On chart signature edited")
"RTN","TIURT",88,0)
 . I $P(NTIU15,U)=""!($P(NTIU15,U,2)="") D
"RTN","TIURT",89,0)
 . . S DR=TIUSFLDS,DIE=8925 D ^DIE S NTIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",90,0)
 . . S MSG(1)=$S('(($P(NTIU15,U)="")&($P(NTIU15,U,2)="")):"  Incomplete on chart signature. Deleted.",1:"  On chart signature deleted.")
"RTN","TIURT",91,0)
 D  ; If user altered co-sign flds and they are deleted or partially
"RTN","TIURT",92,0)
 . ;  deleted, then delete co-sign flds:
"RTN","TIURT",93,0)
 . I $P(NTIU15,U,7)=$P(TIU15,U,7),$P(NTIU15,U,8)=$P(TIU15,U,8) Q
"RTN","TIURT",94,0)
 . S MSG(2)=$S($P(NTIU15,U,7)&'$P(TIU15,U,8):"  Marked 'Cosigned on chart'",1:"  On chart co-signature edited")
"RTN","TIURT",95,0)
 . I $P(NTIU15,U,7)=""!($P(NTIU15,U,8)="") D
"RTN","TIURT",96,0)
 . . S DR=TIUCFLDS,DIE=8925 D ^DIE S NTIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",97,0)
 . . S MSG(2)=$S('(($P(NTIU15,U,7)="")&($P(NTIU15,U,8)="")):"  Incomplete on chart co-signature. Deleted.",1:"  On chart co-signature deleted.")
"RTN","TIURT",98,0)
 D  ; If user deleted sign flds, but docmt is cosigned, then
"RTN","TIURT",99,0)
 . ;  stuff sign data with co-sign data:
"RTN","TIURT",100,0)
 . I $P(NTIU15,U)=$P(TIU15,U),$P(NTIU15,U,2)=$P(TIU15,U,2) Q
"RTN","TIURT",101,0)
 . I $P(NTIU15,U)="",$P(NTIU15,U,7)'="" D STUFFSIG(DA,.NTIU15) S MSG(1)="  On chart signer deleted, auto-replaced with cosigner.",MSG(0)="4HANG"
"RTN","TIURT",102,0)
 D  ; If user deleted co-sign flds, and docmt is signed, and
"RTN","TIURT",103,0)
 . ;           signer = deleted cosigner, then delete sign flds:
"RTN","TIURT",104,0)
 . I $P(NTIU15,U,7)=$P(TIU15,U,7),$P(NTIU15,U,8)=$P(TIU15,U,8) Q
"RTN","TIURT",105,0)
 . I $P(NTIU15,U,7)="",$P(NTIU15,U),$P(NTIU15,U,2)=$P(TIU15,U,8) S DR=TIUSFLDS,DIE=8925 D ^DIE S NTIU15=$G(^TIU(8925,+DA,15)) S MSG(2)="  On chart signatures deleted."
"RTN","TIURT",106,0)
 Q
"RTN","TIURT",107,0)
 ;
"RTN","TIURT",108,0)
STUFFSIG(DA,TIU15) ; Stuff sig flds w/ TIU15 co-sig flds
"RTN","TIURT",109,0)
 ; TIU15 must be current when received, is returned updated.
"RTN","TIURT",110,0)
 N TIUSTUFF,DR,DIE,X,Y
"RTN","TIURT",111,0)
 S TIUSTUFF="1501////"_$$NOW^TIULC_";1502////^S X=$P(TIU15,U,8);1503////^S X=$P(TIU15,U,9);1504////^S X=$P(TIU15,U,10);1505////C" ; stuff Signer data w/ Cosigner data
"RTN","TIURT",112,0)
 S DR=TIUSTUFF,DIE=8925 D ^DIE S TIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",113,0)
 ; Editing 1501 resets ACLEC xref even tho' it's cosigned, so until that can be fixed, rekill ACLEC by resetting 1507:
"RTN","TIURT",114,0)
 S DR="1507////"_$$NOW^TIULC,DIE=8925 D ^DIE S TIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",115,0)
 Q
"RTN","TIURT",116,0)
 ;
"RTN","TIURT",117,0)
STUFFCOS(DA,TIU15) ; Stuff co-sig flds w/ TIU15 sig flds
"RTN","TIURT",118,0)
 ; TIU15 must be current when received, is returned updated.
"RTN","TIURT",119,0)
 N TIUCTUFF,DR,DIE,X,Y
"RTN","TIURT",120,0)
 S TIUCTUFF="1507////"_$$NOW^TIULC_";1508////^S X=$P(TIU15,U,2);1509////^S X=$P(TIU15,U,3);1510////^S X=$P(TIU15,U,4);1511////C"
"RTN","TIURT",121,0)
 S DR=TIUCTUFF,DIE=8925 D ^DIE S TIU15=$G(^TIU(8925,+DA,15))
"RTN","TIURT",122,0)
 Q
"RTN","TIURT",123,0)
 ;
"RTN","TIURTIT1")
0^82^B29562167
"RTN","TIURTIT1",1,0)
TIURTIT1 ; SLC/JER - Review Documents by TITLE ;2/28/01
"RTN","TIURTIT1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIURTIT1",3,0)
 ; New rtn, created 12/6/00 when splitting TIURTITL
"RTN","TIURTIT1",4,0)
GATHER(TIUI,TIUPREF,CLASS,STATIFNS,EARLY,LATE,XREF) ; Find/sort records for the list
"RTN","TIURTIT1",5,0)
 N TIUT,TIUTP,TIUS,TIUSTAT,TIUSFLD,TIUJ,TIUIFN,TIUQ
"RTN","TIURTIT1",6,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURTIT1",7,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURTIT1",8,0)
 S TIUT=0 F  S TIUT=$O(TYPES(TIUT)) Q:+TIUT'>0  D
"RTN","TIURTIT1",9,0)
 . S TIUTP=+$P($G(TYPES(TIUT)),U,2) Q:TIUTP'>0
"RTN","TIURTIT1",10,0)
 . S TIUS=1 F  S TIUSTAT=$P(STATIFNS,";",TIUS) Q:'TIUSTAT  D
"RTN","TIURTIT1",11,0)
 . . S TIUS=TIUS+1
"RTN","TIURTIT1",12,0)
 . . S TIUJ=LATE F  S TIUJ=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ)) Q:+TIUJ'>0!(+TIUJ>EARLY)  D
"RTN","TIURTIT1",13,0)
 . . . S TIUIFN=0
"RTN","TIURTIT1",14,0)
 . . . F  S TIUIFN=$O(^TIU(8925,XREF,TIUI,TIUTP,TIUSTAT,TIUJ,TIUIFN)) Q:+TIUIFN'>0  D
"RTN","TIURTIT1",15,0)
 . . . . ;Consider adding view check here
"RTN","TIURTIT1",16,0)
 . . . . I TIUTP=81,(+TYPES>1),($P(TYPES(TIUT),U,4)="NOT PICKED"),'+$$DADINTYP(TIUIFN,.TYPES) Q
"RTN","TIURTIT1",17,0)
 . . . . S TIUQ=$$RESOLVE^TIUR1(TIUIFN,TIUSFLD)
"RTN","TIURTIT1",18,0)
 . . . . S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUIFN)=""
"RTN","TIURTIT1",19,0)
 Q
"RTN","TIURTIT1",20,0)
DADINTYP(TIUDA,TYPES) ; Evaluates whether addendum's parent is among
"RTN","TIURTIT1",21,0)
 ;                 the selected types
"RTN","TIURTIT1",22,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIURTIT1",23,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIURTIT1",24,0)
 F  S TIUI=$O(TYPES(TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIURTIT1",25,0)
 . I +$P(TYPES(TIUI),U,2)=TIUDTYP S TIUY=1
"RTN","TIURTIT1",26,0)
 Q TIUY
"RTN","TIURTIT1",27,0)
PUTLIST(TIUPREF,TIUCLASS,STATUS,SCREEN) ; Adds list elements to LM Template
"RTN","TIURTIT1",28,0)
 ;array
"RTN","TIURTIT1",29,0)
 N TIUJ,TIUQ,TIUDA,TIUPICK,TIUORDER,TIUSFLD
"RTN","TIURTIT1",30,0)
 N TIUEXPKD,FORGETAD
"RTN","TIURTIT1",31,0)
 S VALMCNT=0
"RTN","TIURTIT1",32,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIURTIT1",33,0)
 S TIUSFLD=$S(TIUSFLD="P":".02",TIUSFLD="D":".01",TIUSFLD="S":".05",TIUSFLD="C":"1507",TIUSFLD="A":"1202",TIUSFLD="E":"1208",1:"1301")
"RTN","TIURTIT1",34,0)
 S TIUORDER=$S($P(TIUPREF,U,4)="D":-1,1:1)
"RTN","TIURTIT1",35,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIURTIT1",36,0)
 S TIUQ="" F  S TIUQ=$O(^TMP("TIUI",$J,TIUQ)) Q:TIUQ']""  D
"RTN","TIURTIT1",37,0)
 . S TIUJ=0 F  S TIUJ=$O(^TMP("TIUI",$J,TIUQ,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURTIT1",38,0)
 . . S TIUDA=0
"RTN","TIURTIT1",39,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURTIT1",40,0)
 . . . S FORGETAD=1
"RTN","TIURTIT1",41,0)
 . . . ; Replace ID kids/addenda in ^TMP("TIUI",$J) with
"RTN","TIURTIT1",42,0)
 . . . ;their parents. Don't expand parent for sake of addm:
"RTN","TIURTIT1",43,0)
 . . . D REPLACE^TIUR2(TIUDA,TIUQ,TIUSFLD,TIUJ,.TIUEXPKD,FORGETAD)
"RTN","TIURTIT1",44,0)
 D SETLIST(TIUORDER,.VALMCNT)
"RTN","TIURTIT1",45,0)
 S ^TMP("TIUR",$J,0)=+$G(VALMCNT)_U_STATUS("WORDS")
"RTN","TIURTIT1",46,0)
 S TIUJ=0,SCREEN="" F  S TIUJ=$O(SCREEN(TIUJ)) Q:+TIUJ'>0  D
"RTN","TIURTIT1",47,0)
 . S SCREEN=$G(SCREEN)_$S(TIUJ>1:";",1:U)_SCREEN(TIUJ)
"RTN","TIURTIT1",48,0)
 S ^TMP("TIUR",$J,0)=^TMP("TIUR",$J,0)_$G(SCREEN)
"RTN","TIURTIT1",49,0)
 S ^TMP("TIUR",$J,"CLASS")=TIUCLASS
"RTN","TIURTIT1",50,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+$G(VALMCNT)
"RTN","TIURTIT1",51,0)
 I $D(VALMHDR)>9 D HDR^TIURTITH
"RTN","TIURTIT1",52,0)
 I +$G(VALMCNT)'>0 D
"RTN","TIURTIT1",53,0)
 . S ^TMP("TIUR",$J,1,0)="",VALMCNT=2
"RTN","TIURTIT1",54,0)
 . S ^TMP("TIUR",$J,2,0)="     No records found to satisfy search criteria."
"RTN","TIURTIT1",55,0)
 ; -- Expand to show kids that fit:
"RTN","TIURTIT1",56,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D EXPANDKD^TIUR2(.STATUS,.TIUEXPKD)
"RTN","TIURTIT1",57,0)
 Q
"RTN","TIURTIT1",58,0)
 ;
"RTN","TIURTIT1",59,0)
SETLIST(TIUORDER,VALMCNT) ; Set items from ^TMP("TIUI",$J) into
"RTN","TIURTIT1",60,0)
 ;List Template list
"RTN","TIURTIT1",61,0)
 N TIUSVAL,TIUDTM,TIUDA
"RTN","TIURTIT1",62,0)
 S TIUSVAL=""
"RTN","TIURTIT1",63,0)
 F  S TIUSVAL=$O(^TMP("TIUI",$J,TIUSVAL),TIUORDER) Q:TIUSVAL=""  D
"RTN","TIURTIT1",64,0)
 . S TIUDTM=0
"RTN","TIURTIT1",65,0)
 . F  S TIUDTM=$O(^TMP("TIUI",$J,TIUSVAL,TIUDTM)) Q:'TIUDTM  D
"RTN","TIURTIT1",66,0)
 . . S TIUDA=0
"RTN","TIURTIT1",67,0)
 . . F  S TIUDA=$O(^TMP("TIUI",$J,TIUSVAL,TIUDTM,TIUDA)) Q:'TIUDA  D
"RTN","TIURTIT1",68,0)
 . . . D ADDELMNT(TIUDA,.VALMCNT)
"RTN","TIURTIT1",69,0)
 Q
"RTN","TIURTIT1",70,0)
 ;
"RTN","TIURTIT1",71,0)
ADDELMNT(DA,TIUCNT,APPEND) ; Add each element to the list
"RTN","TIURTIT1",72,0)
 N PT,ADT,DDT,AUT,AMD,EDT,SDT,TIULST4
"RTN","TIURTIT1",73,0)
 N TIUREC,TIUD0,TIUD12,TIUD13,TIUD15,TIULI,STATX,DOC
"RTN","TIURTIT1",74,0)
 N PREFIX,TIUGDATA
"RTN","TIURTIT1",75,0)
 I '$D(^TIU(8925,DA,0)) Q
"RTN","TIURTIT1",76,0)
 I $G(^TMP("TIUR",$J,2,0))="     No records found to satisfy search criteria." D
"RTN","TIURTIT1",77,0)
 . K ^TMP("TIUR",$J,2),^TMP("TIUR",$J,"IDX",2),^TMP("TIUR",$J,"IDX",1) S TIUCNT=0
"RTN","TIURTIT1",78,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIURTIT1",79,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIURTIT1",80,0)
 S DOC=$$PNAME^TIULC1(+TIUD0)
"RTN","TIURTIT1",81,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIURTIT1",82,0)
 S PREFIX=$$PREFIX^TIULA2(DA,0)
"RTN","TIURTIT1",83,0)
 S PT=$$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FI MI")
"RTN","TIURTIT1",84,0)
 S TIULI=$E(PT)
"RTN","TIURTIT1",85,0)
 S PT=PREFIX_PT
"RTN","TIURTIT1",86,0)
 S TIULST4=$E($P($G(^DPT(+$P(TIUD0,U,2),0)),U,9),6,9)
"RTN","TIURTIT1",87,0)
 S TIULST4="("_TIULI_TIULST4_")"
"RTN","TIURTIT1",88,0)
 S ADT=$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/YY")
"RTN","TIURTIT1",89,0)
 S DDT=$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/YY")
"RTN","TIURTIT1",90,0)
 S AMD=$$PERSNAME^TIULC1($P(TIUD12,U,8)) S:AMD="UNKNOWN" AMD=""
"RTN","TIURTIT1",91,0)
 S AUT=$$PERSNAME^TIULC1($P(TIUD12,U,2)) S:AUT="UNKNOWN" AUT=""
"RTN","TIURTIT1",92,0)
 S AMD=$$NAME^TIULS(AMD,"LAST, FI MI")
"RTN","TIURTIT1",93,0)
 S AUT=$$NAME^TIULS(AUT,"LAST, FI MI")
"RTN","TIURTIT1",94,0)
 S EDT=$$DATE^TIULS($P(TIUD13,U),"MM/DD/YY")
"RTN","TIURTIT1",95,0)
 S SDT=$S(+$P(TIUD15,U,7):+$P(TIUD15,U,7),+$P(TIUD0,U,5)'<7:+$P(TIUD15,U),1:"")
"RTN","TIURTIT1",96,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURTIT1",97,0)
 S STATX=$P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U)
"RTN","TIURTIT1",98,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIURTIT1",99,0)
 S TIUREC=$$SETFLD^VALM1(TIUCNT,"","NUMBER")
"RTN","TIURTIT1",100,0)
 S TIUREC=$$SETFLD^VALM1(PT,TIUREC,"PATIENT NAME")
"RTN","TIURTIT1",101,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIURTIT1",102,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIURTIT1",103,0)
 S TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"REF DATE")
"RTN","TIURTIT1",104,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(STATX),TIUREC,"STATUS")
"RTN","TIURTIT1",105,0)
 S TIUREC=$$SETFLD^VALM1(SDT,TIUREC,"SIG DATE")
"RTN","TIURTIT1",106,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIURTIT1",107,0)
 S TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"COSIGNER")
"RTN","TIURTIT1",108,0)
 S ^TMP("TIUR",$J,TIUCNT,0)=TIUREC
"RTN","TIURTIT1",109,0)
 S ^TMP("TIUR",$J,"IDX",TIUCNT,TIUCNT)="" W "."
"RTN","TIURTIT1",110,0)
 S ^TMP("TIURIDX",$J,TIUCNT)=TIUCNT_U_DA_U_PREFIX
"RTN","TIURTIT1",111,0)
 S ^TMP("TIUR",$J,"IEN",DA,TIUCNT)="" ;MARGY 11/11/00
"RTN","TIURTIT1",112,0)
 S TIUGDATA=$$IDDATA^TIURECL1(DA,TIUD0)
"RTN","TIURTIT1",113,0)
 I TIUGDATA S ^TMP("TIUR",$J,"IDDATA",DA)=TIUGDATA
"RTN","TIURTIT1",114,0)
 S VALMCNT=TIUCNT
"RTN","TIURTIT1",115,0)
 I +$G(APPEND) D
"RTN","TIURTIT1",116,0)
 . D RESTORE^VALM10(TIUCNT)
"RTN","TIURTIT1",117,0)
 . D CNTRL^VALM10(TIUCNT,1,$G(VALM("RM")),IOINHI,IOINORM),HDR^TIURTITH
"RTN","TIURTIT1",118,0)
 . S VALMSG="** Item #"_TIUCNT_" Added **"
"RTN","TIURTIT1",119,0)
 . S $P(^TMP("TIUR",$J,0),U)=TIUCNT
"RTN","TIURTIT1",120,0)
 . S $P(^TMP("TIUR",$J,"#"),":",2)=TIUCNT
"RTN","TIURTIT1",121,0)
 . S VALMCNT=TIUCNT
"RTN","TIURTIT1",122,0)
 . I $D(VALMHDR)>9 D HDR^TIURTITH
"RTN","TIURTIT1",123,0)
 Q
"RTN","TIURTITL")
0^24^B19866250
"RTN","TIURTITL",1,0)
TIURTITL ; SLC/JER - Review Documents by TITLE ;2/26/01
"RTN","TIURTITL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**58,100**;Jun 20, 1997
"RTN","TIURTITL",3,0)
 ;12/6/00 split, moving GATHER,PUTLIST,ADDELMNT, etc to new rtn TIURTIT1
"RTN","TIURTITL",4,0)
MAKELIST(TIUCLASS) ; Get Search Criteria
"RTN","TIURTITL",5,0)
 N TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL,TIUQUIT
"RTN","TIURTITL",6,0)
 N STATWORD,STATIFN,NOWFLAG
"RTN","TIURTITL",7,0)
 D INITRR^TIULRR(0)
"RTN","TIURTITL",8,0)
STATUS S STATUS=$$SELSTAT^TIULA(.TIUSTAT,"F","ALL")
"RTN","TIURTITL",9,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIURTITL",10,0)
 S TIUI=0
"RTN","TIURTITL",11,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIURTITL",12,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIURTITL",13,0)
 . Q:'STATIFN
"RTN","TIURTITL",14,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIURTITL",15,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIURTITL",16,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURTITL",17,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIURTITL",18,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIURTITL",19,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIURTITL",20,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIURTITL",21,0)
 N TIUDCL
"RTN","TIURTITL",22,0)
 D TITLPICK^TIULA3(.TIUTYP,TIUCLASS)
"RTN","TIURTITL",23,0)
 I +$D(TIUQUIT) S VALMQUIT=1 Q
"RTN","TIURTITL",24,0)
 I +$G(TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIURTITL",25,0)
SCREEN ;
"RTN","TIURTITL",26,0)
 N TIUNAME
"RTN","TIURTITL",27,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIURTITL",28,0)
 S SCREEN=1,SCREEN(1)="ALL^ANY"
"RTN","TIURTITL",29,0)
 D CHECKADD(.TIUTYP)
"RTN","TIURTITL",30,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIURTITL",31,0)
 S TIUEDT=$S($D(TIUQUIK):1,1:$P($$EDATE^TIULA("Reference","",TIUEDFLT),U))
"RTN","TIURTITL",32,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURTITL",33,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIURTITL",34,0)
 S TIULDT=$S($D(TIUQUIK):9999999,1:$P($$LDATE^TIULA("Reference"),U))
"RTN","TIURTITL",35,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURTITL",36,0)
 I TIULDT'>0 G ERLY
"RTN","TIURTITL",37,0)
 I TIUEDT>TIULDT D SWAP^TIUR(.TIUEDT,.TIULDT)
"RTN","TIURTITL",38,0)
 I $L(TIULDT,".")=1 D EXPRANGE^TIUR(.TIUEDT,.TIULDT)
"RTN","TIURTITL",39,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIURTITL",40,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIURTITL",41,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIURTITL",42,0)
 D BUILD(TIUCLASS,.STATUS,.TIUTYP,.SCREEN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIURTITL",43,0)
 ; -- If changed view while attaching ID note, update video for note: --
"RTN","TIURTITL",44,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIURTITL",45,0)
 Q
"RTN","TIURTITL",46,0)
CHECKADD(TYPES) ; Checks whether Addendum is included in the list of types
"RTN","TIURTITL",47,0)
 N TIUI,HIT S (TIUI,HIT)=0
"RTN","TIURTITL",48,0)
 F  S TIUI=$O(TYPES(TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(TYPES(TIUI))["ADDENDUM" S HIT=1
"RTN","TIURTITL",49,0)
 I +HIT'>0 S TYPES(TYPES+1)=+TYPES(TYPES)+1_U_"81^Addendum^NOT PICKED",TYPES=TYPES+1
"RTN","TIURTITL",50,0)
 Q
"RTN","TIURTITL",51,0)
BUILD(TIUCLASS,STATUS,TYPES,SCREEN,EARLY,LATE,NOWFLAG) ; Build List
"RTN","TIURTITL",52,0)
 N TIUCNT,TIUDT,TIUI,TIUJ,TIUK,TIUQ,TIUIFN,TIUREC
"RTN","TIURTITL",53,0)
 N XREF,TIUS,TIUPREF
"RTN","TIURTITL",54,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIURTITL",55,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J),^TMP("TIUTYP",$J)
"RTN","TIURTITL",56,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIURTITL",57,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIURTITL",58,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIURTITL",59,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIURTITL",60,0)
 ; Save docmt types in ^TMP("TIUTYP",$J) for rebuild:
"RTN","TIURTITL",61,0)
 M ^TMP("TIUTYP",$J)=TYPES
"RTN","TIURTITL",62,0)
 S ^TMP("TIUR",$J,"RTN")="TIURTITL"
"RTN","TIURTITL",63,0)
 I '$D(TIUPRM0)!'$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURTITL",64,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIURTITL",65,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIURTITL",66,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIURTITL",67,0)
 . I XREF'="ASUB" D
"RTN","TIURTITL",68,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIURTITL",69,0)
 . . D GATHER^TIURTIT1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF)
"RTN","TIURTITL",70,0)
 . I XREF="ASUB" D
"RTN","TIURTITL",71,0)
 . . S TIUI=$O(^TIU(8925,XREF,$P(SCREEN(TIUK),U,2)),-1)
"RTN","TIURTITL",72,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[$P(SCREEN(TIUK),U,2))  D GATHER^TIURTIT1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF)
"RTN","TIURTITL",73,0)
 D PUTLIST^TIURTIT1(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIURTITL",74,0)
 Q
"RTN","TIURTITL",75,0)
CLEAN ; Clean up your mess!
"RTN","TIURTITL",76,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIURTITL",77,0)
 K VALMY,^TMP("TIUTYP",$J)
"RTN","TIURTITL",78,0)
 Q
"RTN","TIURTITL",79,0)
 ;
"RTN","TIURTITL",80,0)
RBLD ; Rebuild list after actions
"RTN","TIURTITL",81,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIURTITL",82,0)
 N TIURBLD,TIUI,TIUCLASS,TIUTYP,NOWFLAG
"RTN","TIURTITL",83,0)
 S TIURBLD=1
"RTN","TIURTITL",84,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIURTITL",85,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIURTITL",86,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIURTITL",87,0)
 M TIUTYP=^TMP("TIUTYP",$J)
"RTN","TIURTITL",88,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIURTITL",89,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIURTITL",90,0)
 S TIUI=1
"RTN","TIURTITL",91,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIURTITL",92,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIURTITL",93,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIURTITL",94,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIURTITL",95,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIURTITL",96,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIURTITL",97,0)
 D BUILD(TIUCLASS,.STATUS,.TIUTYP,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIURTITL",98,0)
 ; Reexpand previously expanded items:
"RTN","TIURTITL",99,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIURTITL",100,0)
 D BREATHE^TIUROR1(1)
"RTN","TIURTITL",101,0)
 Q
"RTN","TIUSRV")
0^1^B61332508
"RTN","TIUSRV",1,0)
TIUSRV ; SLC/JER - Silent server functions ;13-APR-2001 14:13:26
"RTN","TIUSRV",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,19,28,87,61,100**;Jun 20, 1997
"RTN","TIUSRV",3,0)
RPC(TIUY,TIUDA,REASSIGN) ; RPC for DT
"RTN","TIUSRV",4,0)
 N VALMAR,TIUGDATA,TIUGWHOL K ^TMP("TIUAUDIT",$J)
"RTN","TIUSRV",5,0)
 S TIUY=$NA(^TMP("TIUAUDIT",$J))
"RTN","TIUSRV",6,0)
 D GET(TIUDA,1,+$G(REASSIGN))
"RTN","TIUSRV",7,0)
 K ^TMP("VALM VIDEO",$J)
"RTN","TIUSRV",8,0)
 Q
"RTN","TIUSRV",9,0)
GET(TIUDA,HUSH,REASSIGN) ; Build List
"RTN","TIUSRV",10,0)
 N TIUI,TIUL,TIUREC,TIUDADD,X S (TIUDADD,TIUI)=0,HUSH=+$G(HUSH)
"RTN","TIUSRV",11,0)
 N DA,DIC,DIQ,DR,TIUNAME K ^TMP("TIUAUDIT",$J)
"RTN","TIUSRV",12,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUSRV",13,0)
 I '$D(IOINORM) S X="IOINORM;IOIHI;IORVON;IORVOFF;IOUON;IOUOFF;IOBON;IOBOFF" D ENDR^%ZISS
"RTN","TIUSRV",14,0)
 S:'$D(VALMAR) VALMAR="^TMP(""TIUAUDIT"",$J)"
"RTN","TIUSRV",15,0)
 S VALMEVL=+$G(VALMEVL)
"RTN","TIUSRV",16,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUSRV",17,0)
 S DIC=8925,DIQ="TIUREC(",DA=TIUDA
"RTN","TIUSRV",18,0)
 S DR=".01;.02;.05;.07:.1;1201;1202;1204;1208;1301;1302;1305;1306;1501;1502;1505;1507;1508;1511;1601:1602;1610:1612;1701"
"RTN","TIUSRV",19,0)
 D EN^DIQ1
"RTN","TIUSRV",20,0)
 S TIUI="" F  S TIUI=$O(TIUREC(8925,+TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",21,0)
 . I $G(TIUREC(8925,+TIUDA,TIUI))']"" S TIUREC(8925,+TIUDA,TIUI)="None"
"RTN","TIUSRV",22,0)
 . E  S TIUREC(8925,+TIUDA,TIUI)=$$UP^XLFSTR(TIUREC(8925,+TIUDA,TIUI))
"RTN","TIUSRV",23,0)
 I $D(TIUREC)>9 D
"RTN","TIUSRV",24,0)
 . D SOURCE(.TIUREC,HUSH)
"RTN","TIUSRV",25,0)
 . D:'+$G(REASSIGN) PROBLEM(TIUDA),EDIT(TIUDA)
"RTN","TIUSRV",26,0)
 . D REASSIGN^TIUSRV1(TIUDA,+$G(REASSIGN)) Q:+$G(REASSIGN)
"RTN","TIUSRV",27,0)
 . D IDLINK^TIUSRV1(TIUDA)
"RTN","TIUSRV",28,0)
 . D SIGN(.TIUREC)
"RTN","TIUSRV",29,0)
 . I +$O(^TIU(8925.7,"B",TIUDA,0)) D XTRASIGN(TIUDA)
"RTN","TIUSRV",30,0)
 . I $D(^TIU(8925,+TIUDA,16)) D PRIVACY(.TIUREC)
"RTN","TIUSRV",31,0)
 . D BODY(TIUDA,.VALMCNT)
"RTN","TIUSRV",32,0)
 S:+$G(VALMCNT)<$G(VALM("LINES")) VALMCNT=$G(VALM("LINES"))
"RTN","TIUSRV",33,0)
 Q
"RTN","TIUSRV",34,0)
SOURCE(TIUREC,HUSH) ; Source Info
"RTN","TIUSRV",35,0)
 N OFFSET,START
"RTN","TIUSRV",36,0)
 S OFFSET=2,START=1
"RTN","TIUSRV",37,0)
 W:'+$G(HUSH) !!,"Opening "_TIUREC(8925,+TIUDA,.01)_" record for review..."
"RTN","TIUSRV",38,0)
 D SET(START,1," Source Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",39,0)
 D SET(START+1,OFFSET," Reference Date: "_$G(TIUREC(8925,TIUDA,1301)))
"RTN","TIUSRV",40,0)
 D SET(START+2,OFFSET,"     Entry Date: "_$G(TIUREC(8925,TIUDA,1201)))
"RTN","TIUSRV",41,0)
 D SET(START+3,OFFSET,"Expected Signer: "_$G(TIUREC(8925,TIUDA,1204)))
"RTN","TIUSRV",42,0)
 D SET(START+4,OFFSET,"        Urgency: "_$G(TIUREC(8925,TIUDA,.09)))
"RTN","TIUSRV",43,0)
 D SET(START+5,OFFSET,"     Line Count: "_$G(TIUREC(8925,TIUDA,.1)))
"RTN","TIUSRV",44,0)
 D SET(START+6,OFFSET,"        Subject: "_$G(TIUREC(8925,TIUDA,1701)))
"RTN","TIUSRV",45,0)
 S OFFSET=40
"RTN","TIUSRV",46,0)
 D SET(START+1,OFFSET,"            Author: "_$G(TIUREC(8925,TIUDA,1202)))
"RTN","TIUSRV",47,0)
 D SET(START+2,OFFSET,"        Entered By: "_$G(TIUREC(8925,TIUDA,1302)))
"RTN","TIUSRV",48,0)
 D SET(START+3,OFFSET," Expected Cosigner: "_$G(TIUREC(8925,TIUDA,1208)))
"RTN","TIUSRV",49,0)
 D SET(START+4,OFFSET,"   Document Status: "_$G(TIUREC(8925,TIUDA,.05)))
"RTN","TIUSRV",50,0)
 D SET(START+5,OFFSET,"    TIU Document #: "_+$G(TIUDA))
"RTN","TIUSRV",51,0)
 S VALMCNT=6
"RTN","TIUSRV",52,0)
 Q
"RTN","TIUSRV",53,0)
PROBLEM(TIUDA) ; Problems
"RTN","TIUSRV",54,0)
 N TIUI,DR,DIC,DIQ,TIUCNT,TIUPROB,START S TIUI=0,START=9
"RTN","TIUSRV",55,0)
 D BLANK(8)
"RTN","TIUSRV",56,0)
 D SET(START,1," Associated Problems ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",57,0)
 I '+$O(^TIU(8925.9,"B",+TIUDA,0)) D SET(START,25,"No linked problems.")
"RTN","TIUSRV",58,0)
 F  S TIUI=$O(^TIU(8925.9,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",59,0)
 . S DA=TIUI,DR=".02;.05",DIC="^TIU(8925.9,",DIQ="TIUPROB"
"RTN","TIUSRV",60,0)
 . D EN^DIQ1 Q:$D(TIUPROB)'>9
"RTN","TIUSRV",61,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSRV",62,0)
 . D SET(START+1,19,$$MIXED^TIULS($G(TIUPROB(8925.9,TIUI,.05))))
"RTN","TIUSRV",63,0)
 . D SET(START+1,60,$G(TIUPROB(8925.9,TIUI,.02)))
"RTN","TIUSRV",64,0)
 . S START=START+1
"RTN","TIUSRV",65,0)
 S VALMCNT=START
"RTN","TIUSRV",66,0)
 Q
"RTN","TIUSRV",67,0)
EDIT(TIUDA) ; Edits
"RTN","TIUSRV",68,0)
 N TIUI,DR,DIC,DIQ,TIUCNT,TIUED,START,OFFSET S TIUI=0,START=VALMCNT+2
"RTN","TIUSRV",69,0)
 D BLANK(VALMCNT+1)
"RTN","TIUSRV",70,0)
 D SET(START,1," Edit Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",71,0)
 I '+$O(^TIU(8925.5,"B",+TIUDA,0)) D SET(START,22,"No edits since entry.")
"RTN","TIUSRV",72,0)
 F  S TIUI=$O(^TIU(8925.5,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",73,0)
 . S DA=TIUI,DR=".02:03",DIC="^TIU(8925.5,",DIQ="TIUED"
"RTN","TIUSRV",74,0)
 . D EN^DIQ1 Q:$D(TIUED)'>9!($G(TIUED(8925.5,TIUI,.02))']"")
"RTN","TIUSRV",75,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSRV",76,0)
 . S OFFSET=2
"RTN","TIUSRV",77,0)
 . D SET(START+1,OFFSET,"      Edit Date: "_$G(TIUED(8925.5,TIUI,.02)))
"RTN","TIUSRV",78,0)
 . S OFFSET=44
"RTN","TIUSRV",79,0)
 . D SET(START+1,OFFSET,"     Edited By: "_$G(TIUED(8925.5,TIUI,.03)))
"RTN","TIUSRV",80,0)
 . S START=START+1
"RTN","TIUSRV",81,0)
 S VALMCNT=START
"RTN","TIUSRV",82,0)
 Q
"RTN","TIUSRV",83,0)
SIGN(TIUREC) ; Signature
"RTN","TIUSRV",84,0)
 N OFFSET,START D BLANK(VALMCNT+1)
"RTN","TIUSRV",85,0)
 S OFFSET=2,START=VALMCNT+2
"RTN","TIUSRV",86,0)
 D SET(START,1," Signature Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",87,0)
 D SET(START+1,OFFSET,"    Signed Date: "_$G(TIUREC(8925,TIUDA,1501)))
"RTN","TIUSRV",88,0)
 D SET(START+3,OFFSET,"  Cosigned Date: "_$G(TIUREC(8925,TIUDA,1507)))
"RTN","TIUSRV",89,0)
 S OFFSET=40
"RTN","TIUSRV",90,0)
 D SET(START+1,OFFSET,"         Signed By: "_$G(TIUREC(8925,TIUDA,1502)))
"RTN","TIUSRV",91,0)
 D SET(START+2,OFFSET,"    Signature Mode: "_$G(TIUREC(8925,TIUDA,1505)))
"RTN","TIUSRV",92,0)
 D SET(START+3,OFFSET,"       Cosigned By: "_$G(TIUREC(8925,TIUDA,1508)))
"RTN","TIUSRV",93,0)
 D SET(START+4,OFFSET,"  Cosignature Mode: "_$G(TIUREC(8925,TIUDA,1511)))
"RTN","TIUSRV",94,0)
 S VALMCNT=START+4
"RTN","TIUSRV",95,0)
 Q
"RTN","TIUSRV",96,0)
XTRASIGN(TIUDA) ; Additional signers
"RTN","TIUSRV",97,0)
 N OFFSET,TIUI,DA,DR,DIC,DIQ,TIUCNT,TIUXTRA,START
"RTN","TIUSRV",98,0)
 S TIUI=0,START=VALMCNT+2
"RTN","TIUSRV",99,0)
 D BLANK(VALMCNT+1)
"RTN","TIUSRV",100,0)
 D SET(START,1," Receipt Acknowledged By ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",101,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",102,0)
 . S DA=TIUI,DR=".03:.08",DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIUSRV",103,0)
 . D EN^DIQ1 Q:$D(TIUXTRA)'>9
"RTN","TIUSRV",104,0)
 . S TIUCNT=+$G(TIUCNT)+1,OFFSET=2
"RTN","TIUSRV",105,0)
 . D SET(START+1,OFFSET,"    Signed Date: "_$G(TIUXTRA(8925.7,DA,.04)))
"RTN","TIUSRV",106,0)
 . S OFFSET=40
"RTN","TIUSRV",107,0)
 . D SET(START+1,OFFSET,"         Signed By: "_$G(TIUXTRA(8925.7,DA,.06)))
"RTN","TIUSRV",108,0)
 . D SET(START+2,2,"Expected Signer: "_$G(TIUXTRA(8925.7,DA,.03)))
"RTN","TIUSRV",109,0)
 . D SET(START+2,OFFSET,"    Signature Mode: "_$G(TIUXTRA(8925.7,DA,.08)))
"RTN","TIUSRV",110,0)
 . S (START,VALMCNT)=START+2
"RTN","TIUSRV",111,0)
 Q
"RTN","TIUSRV",112,0)
PRIVACY(TIUREC) ; Privacy Act
"RTN","TIUSRV",113,0)
 N OFFSET,START D BLANK(VALMCNT+1)
"RTN","TIUSRV",114,0)
 S OFFSET=2,START=VALMCNT+2
"RTN","TIUSRV",115,0)
 D SET(START,1," Privacy Act Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",116,0)
 D SET(START+1,OFFSET,"   Amended Date: "_$G(TIUREC(8925,TIUDA,1601)))
"RTN","TIUSRV",117,0)
 D SET(START+2,OFFSET,"   Deleted Date: "_$G(TIUREC(8925,TIUDA,1611)))
"RTN","TIUSRV",118,0)
 D SET(START+3,OFFSET,"         Reason: "_$G(TIUREC(8925,TIUDA,1612)))
"RTN","TIUSRV",119,0)
 S OFFSET=40
"RTN","TIUSRV",120,0)
 D SET(START+1,OFFSET,"        Amended By: "_$G(TIUREC(8925,TIUDA,1602)))
"RTN","TIUSRV",121,0)
 D SET(START+2,OFFSET,"        Deleted By: "_$G(TIUREC(8925,TIUDA,1610)))
"RTN","TIUSRV",122,0)
 S VALMCNT=START+3
"RTN","TIUSRV",123,0)
 Q
"RTN","TIUSRV",124,0)
BODY(TIUDA,TIUL) ; body of document
"RTN","TIUSRV",125,0)
 N CANSEE S CANSEE=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUSRV",126,0)
 S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",127,0)
 D BLANK(TIUL) S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",128,0)
 D SET(TIUL,1," Document Body ",$G(IORVON),$G(IORVOFF)) S TIUL=TIUL+1
"RTN","TIUSRV",129,0)
 D BLANK(TIUL)
"RTN","TIUSRV",130,0)
 I '+CANSEE D NOSEE(CANSEE,.TIUL) Q
"RTN","TIUSRV",131,0)
 ; D TEXT(TIUDA,.TIUL)
"RTN","TIUSRV",132,0)
 I '$D(TIUGDATA) S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIUSRV",133,0)
 D LOADREC^TIUBR1(TIUDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUSRV",134,0)
 K ^TMP("TIU ADDENDUM",$J)
"RTN","TIUSRV",135,0)
 Q
"RTN","TIUSRV",136,0)
TEXT(TIUDA,TIUL) ; Get each component
"RTN","TIUSRV",137,0)
 N TIUKID,TIUDADT,TIUI S TIUI=0
"RTN","TIUSRV",138,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",139,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",140,0)
 . S ^TMP("TIUAUDIT",$J,TIUL,0)=$G(^TIU(8925,+TIUDA,"TEXT",+TIUI,0))
"RTN","TIUSRV",141,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D  Q
"RTN","TIUSRV",142,0)
 . N TIULINE,TIUPARNT K ^TMP("TIU ADDENDUM",$J) S $P(TIULINE,"=",79)=""
"RTN","TIUSRV",143,0)
 . S ^TMP("TIU ADDENDUM",$J)=TIUDA
"RTN","TIUSRV",144,0)
 . D LOADSIG^TIUBR1(TIUDA,.TIUL)
"RTN","TIUSRV",145,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=""
"RTN","TIUSRV",146,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=TIULINE
"RTN","TIUSRV",147,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=""
"RTN","TIUSRV",148,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=" --- Original Document ---"
"RTN","TIUSRV",149,0)
 . S TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=""
"RTN","TIUSRV",150,0)
 . S TIUPARNT=+$P(^TIU(8925,+TIUDA,0),U,6) D TEXT(TIUPARNT,.TIUL)
"RTN","TIUSRV",151,0)
 S TIUKID=0
"RTN","TIUSRV",152,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRV",153,0)
 . I +$$ISADDNDM^TIULC1(TIUKID)'>0 D TEXT(TIUKID,.TIUL)
"RTN","TIUSRV",154,0)
 I '$$ISCOMP(TIUDA) D LOADSIG^TIUBR1(TIUDA,.TIUL)
"RTN","TIUSRV",155,0)
 S TIUKID=0
"RTN","TIUSRV",156,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRV",157,0)
 . ; If acting on an addendum, don't show it again
"RTN","TIUSRV",158,0)
 . I +TIUKID=+$G(^TMP("TIU ADDENDUM",$J)) Q
"RTN","TIUSRV",159,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D LOADADD(TIUKID,.TIUL)
"RTN","TIUSRV",160,0)
 Q
"RTN","TIUSRV",161,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUSRV",162,0)
 N TIUY,TIUTYP
"RTN","TIUSRV",163,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUSRV",164,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUSRV",165,0)
 Q TIUY
"RTN","TIUSRV",166,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUSRV",167,0)
 N TIUDAUTH,TIUDATT,TIUJ,TIUSIG,TIUCSIG,CANSEE
"RTN","TIUSRV",168,0)
 S CANSEE=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUSRV",169,0)
 S TIUJ=0,TIUL=+$G(TIUL)+1,^TMP("TIUAUDIT",$J,TIUL,0)=" "
"RTN","TIUSRV",170,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/YY")
"RTN","TIUSRV",171,0)
 S TIUL=TIUL+1,^TMP("TIUAUDIT",$J,TIUL,0)=TIUDADT_" ADDENDUM:"
"RTN","TIUSRV",172,0)
 I +CANSEE'>0 D  Q
"RTN","TIUSRV",173,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",174,0)
 . S ^TMP("TIUAUDIT",$J,TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUSRV",175,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUSRV",176,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRV",177,0)
 . S ^TMP("TIUAUDIT",$J,TIUL,0)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUSRV",178,0)
 D LOADSIG^TIUBR1(TIUDADD,.TIUL)
"RTN","TIUSRV",179,0)
 Q
"RTN","TIUSRV",180,0)
NOSEE(CANSEE,TIUJ) ; When the user shouldn't see the data...
"RTN","TIUSRV",181,0)
 S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRV",182,0)
 D SET(TIUJ,2,$P(CANSEE,U,2))
"RTN","TIUSRV",183,0)
 Q
"RTN","TIUSRV",184,0)
SET(TIULINE,TIUCOL,TIUTEXT,ON,OFF) ; set display info in array
"RTN","TIUSRV",185,0)
 D:'$D(@VALMAR@(TIULINE,0)) BLANK(.TIULINE)
"RTN","TIUSRV",186,0)
 D SET^VALM10(.TIULINE,$$SETSTR^VALM1(.TIUTEXT,@VALMAR@(TIULINE,0),.TIUCOL,$L(TIUTEXT)))
"RTN","TIUSRV",187,0)
 D:$G(ON)]""!($G(OFF)]"") CNTRL^VALM10(.TIULINE,.TIUCOL,$L(TIUTEXT),$G(ON),$G(OFF))
"RTN","TIUSRV",188,0)
 W:'(TIULINE#5)&'+$G(HUSH) "."
"RTN","TIUSRV",189,0)
 Q
"RTN","TIUSRV",190,0)
 ;
"RTN","TIUSRV",191,0)
BLANK(TIULINE) ; blank line
"RTN","TIUSRV",192,0)
 D SET^VALM10(.TIULINE,$J("",80))
"RTN","TIUSRV",193,0)
 Q
"RTN","TIUSRV1")
0^83^B18146606
"RTN","TIUSRV1",1,0)
TIUSRV1 ; SLC/JER - More silent server functions ;23-MAR-2001 10:27:07
"RTN","TIUSRV1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**61,100**;Jun 20, 1997
"RTN","TIUSRV1",3,0)
REASSIGN(TIUDA,REASSIGN) ; Reassign Hx
"RTN","TIUSRV1",4,0)
 N TIUI,DR,DIC,DIQ,TIUCNT,TIUREASS,START,OFFSET
"RTN","TIUSRV1",5,0)
 S TIUI=0,START=VALMCNT
"RTN","TIUSRV1",6,0)
 I +$P(^TIU(8925,TIUDA,0),U,5)'=15,(+$G(REASSIGN)=0) Q
"RTN","TIUSRV1",7,0)
 D BLANK^TIUSRV(START) S START=START+1
"RTN","TIUSRV1",8,0)
 D SET^TIUSRV(START,2," Reassignment History ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV1",9,0)
 I '+$O(^TIU(8925.5,"AR",+TIUDA,0)) D
"RTN","TIUSRV1",10,0)
 . N TIUI
"RTN","TIUSRV1",11,0)
 . D SET^TIUSRV(START,26,"Document Never Reassigned.")
"RTN","TIUSRV1",12,0)
 . F TIUI=(START+1):1:16 S @VALMAR@(TIUI,0)=" "
"RTN","TIUSRV1",13,0)
 F  S TIUI=$O(^TIU(8925.5,"AR",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV1",14,0)
 . N DA
"RTN","TIUSRV1",15,0)
 . S DA=0 F  S DA=$O(^TIU(8925.5,"AR",TIUDA,TIUI,DA)) Q:+DA'>0  D
"RTN","TIUSRV1",16,0)
 . . S DR="1.01:1.12",DIC="^TIU(8925.5,",DIQ="TIUREASS"
"RTN","TIUSRV1",17,0)
 . . D EN^DIQ1 Q:$D(TIUREASS)'>9!($G(TIUREASS(8925.5,DA,1.01))']"")
"RTN","TIUSRV1",18,0)
 . . S TIUCNT=+$G(TIUCNT)+1 I TIUCNT>1 S START=START+1 D BLANK^TIUSRV(START)
"RTN","TIUSRV1",19,0)
 . . S OFFSET=2
"RTN","TIUSRV1",20,0)
 . . D SET^TIUSRV(START+1,OFFSET,"  Reassign Date: "_$G(TIUREASS(8925.5,DA,1.01)))
"RTN","TIUSRV1",21,0)
 . . D SET^TIUSRV(START+2,OFFSET,"        Patient: "_$G(TIUREASS(8925.5,DA,1.03)))
"RTN","TIUSRV1",22,0)
 . . D SET^TIUSRV(START+3,OFFSET,"Visit Date/time: "_$G(TIUREASS(8925.5,DA,1.05)))
"RTN","TIUSRV1",23,0)
 . . D SET^TIUSRV(START+4,OFFSET,"  Hosp Location: "_$G(TIUREASS(8925.5,DA,1.07)))
"RTN","TIUSRV1",24,0)
 . . D SET^TIUSRV(START+5,OFFSET,"     Visit Type: "_$$UP^XLFSTR($G(TIUREASS(8925.5,DA,1.09))))
"RTN","TIUSRV1",25,0)
 . . S OFFSET=44
"RTN","TIUSRV1",26,0)
 . . D SET^TIUSRV(START+1,OFFSET," Reassigned By: "_$G(TIUREASS(8925.5,DA,1.02)))
"RTN","TIUSRV1",27,0)
 . . D SET^TIUSRV(START+2,OFFSET," --->           "_$G(TIUREASS(8925.5,DA,1.04)))
"RTN","TIUSRV1",28,0)
 . . D SET^TIUSRV(START+3,OFFSET," --->           "_$G(TIUREASS(8925.5,DA,1.06)))
"RTN","TIUSRV1",29,0)
 . . D SET^TIUSRV(START+4,OFFSET," --->           "_$G(TIUREASS(8925.5,DA,1.08)))
"RTN","TIUSRV1",30,0)
 . . D SET^TIUSRV(START+5,OFFSET," --->           "_$$UP^XLFSTR($G(TIUREASS(8925.5,DA,1.1))))
"RTN","TIUSRV1",31,0)
 . . S START=START+5
"RTN","TIUSRV1",32,0)
 S VALMCNT=START
"RTN","TIUSRV1",33,0)
 Q
"RTN","TIUSRV1",34,0)
IDLINK(TIUDA) ; Show Attach/Detach Hx
"RTN","TIUSRV1",35,0)
 N TIUI,TIUCNT S TIUI=0
"RTN","TIUSRV1",36,0)
 Q:'$$IDHX(TIUDA)
"RTN","TIUSRV1",37,0)
 S VALMCNT=VALMCNT+1 D BLANK^TIUSRV(VALMCNT) S VALMCNT=VALMCNT+1
"RTN","TIUSRV1",38,0)
 D SET^TIUSRV(VALMCNT,1," Interdisciplinary Linkage History ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV1",39,0)
 S VALMCNT=VALMCNT+1 D BLANK^TIUSRV(VALMCNT) S VALMCNT=VALMCNT+1
"RTN","TIUSRV1",40,0)
 D SET^TIUSRV(VALMCNT,0,"Date/Time         "_$S(+$G(^TIU(8925,+TIUDA,21)):"ID Parent",1:"Entry #  ")_"   Title                     Action    By") S VALMCNT=VALMCNT+1
"RTN","TIUSRV1",41,0)
 D SET^TIUSRV(VALMCNT,0,"----------------  ----------  ------------------------  --------  -------------")
"RTN","TIUSRV1",42,0)
 ; First, get events for ID Parents
"RTN","TIUSRV1",43,0)
 F  S TIUI=$O(^TIU(8925.5,"AID",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV1",44,0)
 . N TIUD0,TIUD3,TIUY,EVDT,ENTDA,ENTTL,ACTION,DOER
"RTN","TIUSRV1",45,0)
 . Q:'$L($G(^TIU(8925.5,TIUI,3)))
"RTN","TIUSRV1",46,0)
 . S TIUD0=$G(^TIU(8925.5,TIUI,0)),TIUD3=$G(^(3))
"RTN","TIUSRV1",47,0)
 . S ENTDA=+TIUD0
"RTN","TIUSRV1",48,0)
 . S ACTION=$P(TIUD3,U),ACTION=$S(ACTION="d":"detached",1:"attached")
"RTN","TIUSRV1",49,0)
 . S EVDT=$$DATE^TIULS($P(TIUD3,U,2),"MM/DD/CCYY HR:MIN")
"RTN","TIUSRV1",50,0)
 . S ENTTL=$$PNAME^TIULC1(+$G(^TIU(8925,ENTDA,0)))
"RTN","TIUSRV1",51,0)
 . S DOER=$$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD3,U,3)),"LAST,FI")
"RTN","TIUSRV1",52,0)
 . S TIUY="" S TIUY=$$SETSTR^VALM1(EVDT,TIUY,1,16)
"RTN","TIUSRV1",53,0)
 . S TIUY=$$SETSTR^VALM1(ENTDA,TIUY,19,10)
"RTN","TIUSRV1",54,0)
 . S TIUY=$$SETSTR^VALM1(ENTTL,TIUY,31,24)
"RTN","TIUSRV1",55,0)
 . S TIUY=$$SETSTR^VALM1(ACTION,TIUY,57,8)
"RTN","TIUSRV1",56,0)
 . S TIUY=$$SETSTR^VALM1(DOER,TIUY,67,14)
"RTN","TIUSRV1",57,0)
 . S VALMCNT=VALMCNT+1 D SET^TIUSRV(VALMCNT,0,TIUY)
"RTN","TIUSRV1",58,0)
 ; Next, get hx for ID Entries
"RTN","TIUSRV1",59,0)
 F  S TIUI=$O(^TIU(8925.5,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV1",60,0)
 . N TIUD0,TIUD3,TIUY,EVDT,ENTDA,IDDAD,IDTTL,ACTION,DOER
"RTN","TIUSRV1",61,0)
 . Q:'$L($G(^TIU(8925.5,TIUI,3)))
"RTN","TIUSRV1",62,0)
 . S TIUD0=$G(^TIU(8925.5,TIUI,0)),TIUD3=$G(^(3))
"RTN","TIUSRV1",63,0)
 . S ENTDA=+TIUD0,IDDAD=$P(TIUD3,U,5)
"RTN","TIUSRV1",64,0)
 . S ACTION=$P(TIUD3,U),ACTION=$S(ACTION="d":"detached",1:"attached")
"RTN","TIUSRV1",65,0)
 . S EVDT=$$DATE^TIULS($P(TIUD3,U,2),"MM/DD/CCYY HR:MIN")
"RTN","TIUSRV1",66,0)
 . S IDTTL=$$PNAME^TIULC1(+$G(^TIU(8925,IDDAD,0)))
"RTN","TIUSRV1",67,0)
 . S DOER=$$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD3,U,3)),"LAST,FI")
"RTN","TIUSRV1",68,0)
 . S TIUY="" S TIUY=$$SETSTR^VALM1(EVDT,TIUY,1,16)
"RTN","TIUSRV1",69,0)
 . S TIUY=$$SETSTR^VALM1(IDDAD,TIUY,19,10)
"RTN","TIUSRV1",70,0)
 . S TIUY=$$SETSTR^VALM1(IDTTL,TIUY,31,24)
"RTN","TIUSRV1",71,0)
 . S TIUY=$$SETSTR^VALM1(ACTION,TIUY,57,8)
"RTN","TIUSRV1",72,0)
 . S TIUY=$$SETSTR^VALM1(DOER,TIUY,67,14)
"RTN","TIUSRV1",73,0)
 . S VALMCNT=VALMCNT+1 D SET^TIUSRV(VALMCNT,0,TIUY)
"RTN","TIUSRV1",74,0)
 Q
"RTN","TIUSRV1",75,0)
IDHX(TIUDA) ; Boolean fn to evaluate whether ID history exists
"RTN","TIUSRV1",76,0)
 N TIUI,TIUY S TIUY=0
"RTN","TIUSRV1",77,0)
 S TIUI=0
"RTN","TIUSRV1",78,0)
 F  S TIUI=$O(^TIU(8925.5,"B",TIUDA,TIUI)) Q:+TIUI'>0  D  Q:+TIUY
"RTN","TIUSRV1",79,0)
 . S:$L($G(^TIU(8925.5,TIUI,3))) TIUY=1
"RTN","TIUSRV1",80,0)
 S TIUI=0
"RTN","TIUSRV1",81,0)
 F  S TIUI=$O(^TIU(8925.5,"AID",TIUDA,TIUI)) Q:+TIUI'>0  D  Q:+TIUY
"RTN","TIUSRV1",82,0)
 . S:$L($G(^TIU(8925.5,TIUI,3))) TIUY=1
"RTN","TIUSRV1",83,0)
IDHXX Q TIUY
"RTN","TIUSRVA")
0^54^B10527139
"RTN","TIUSRVA",1,0)
TIUSRVA ; SLC/JER - API's for Authorization ;4/16/01
"RTN","TIUSRVA",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,28,47,80,100**;Jun 20, 1997
"RTN","TIUSRVA",3,0)
REQCOS(TIUY,TIUTYP,TIUDA,TIUSER) ; Evaluate cosignature requirement
"RTN","TIUSRVA",4,0)
 ; Initialize return value
"RTN","TIUSRVA",5,0)
 N TIUDPRM
"RTN","TIUSRVA",6,0)
 S TIUY=0
"RTN","TIUSRVA",7,0)
 I +$G(TIUTYP)'>0,'+$G(TIUDA) Q
"RTN","TIUSRVA",8,0)
 I +$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+$G(TIUDA),0))
"RTN","TIUSRVA",9,0)
 S:'+$G(TIUSER) TIUSER=+$G(DUZ)
"RTN","TIUSRVA",10,0)
 S TIUY=+$$REQCOSIG^TIULP(TIUTYP,+$G(TIUDA),+$G(TIUSER))
"RTN","TIUSRVA",11,0)
 Q
"RTN","TIUSRVA",12,0)
URGENCY(Y) ; -- retrieve set values from dd for discharge summary urgency
"RTN","TIUSRVA",13,0)
 N TIUDD,I,X
"RTN","TIUSRVA",14,0)
 D FIELD^DID(8925,.09,"","POINTER","TIUDD")
"RTN","TIUSRVA",15,0)
 F I=1:1 S X=$P(TIUDD("POINTER"),";",I) Q:X=""   S Y(I)=$TR(X,":","^")
"RTN","TIUSRVA",16,0)
 Q
"RTN","TIUSRVA",17,0)
CANDO(Y,TIUDA,TIUACT) ; Boolean function to evaluate privilege
"RTN","TIUSRVA",18,0)
 N TIUPOP,TIUDPRM S TIUPOP=0
"RTN","TIUSRVA",19,0)
 I $S(TIUACT["SIGN":1,TIUACT="EDIT RECORD":1,TIUACT="DELETE RECORD":1,1:0) D  Q:+TIUPOP=1
"RTN","TIUSRVA",20,0)
 . L +^TIU(8925,+TIUDA):1
"RTN","TIUSRVA",21,0)
 . E  S Y="0^ Another session is editing this entry.",TIUPOP=1
"RTN","TIUSRVA",22,0)
 . L -^TIU(8925,+TIUDA)
"RTN","TIUSRVA",23,0)
 I TIUACT["SIGN",+$$NEEDCS(TIUDA) S Y="0^ You must name a cosigner before signing this document." Q
"RTN","TIUSRVA",24,0)
 S Y=$$CANDO^TIULP(TIUDA,TIUACT)
"RTN","TIUSRVA",25,0)
 Q
"RTN","TIUSRVA",26,0)
NEEDCS(TIUDA) ; Does user need a cosigner?
"RTN","TIUSRVA",27,0)
 N TIUD0,TIUD12,TIUY,SIGNER,COSIGNER,XTRASGNR
"RTN","TIUSRVA",28,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUSRVA",29,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8),XTRASGNR=0
"RTN","TIUSRVA",30,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVA",31,0)
 I +XTRASGNR S TIUY=0
"RTN","TIUSRVA",32,0)
 E  I +$$REQCOSIG^TIULP(+TIUD0,TIUDA,DUZ),(+$P(TIUD12,U,8)'>0) S TIUY=1
"RTN","TIUSRVA",33,0)
 Q +$G(TIUY)
"RTN","TIUSRVA",34,0)
WHATACT(Y,TIUDA) ; Evaluate/return whether signature or cosignature
"RTN","TIUSRVA",35,0)
 N TIUD0,TIUD12,TIUSTAT,SIGNER,COSIGNER,XTRASGNR
"RTN","TIUSRVA",36,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIUSRVA",37,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8)
"RTN","TIUSRVA",38,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVA",39,0)
 S TIUSTAT=+$P(TIUD0,U,5)
"RTN","TIUSRVA",40,0)
 S Y=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIUSRVA",41,0)
 Q
"RTN","TIUSRVA",42,0)
CANCHCOS(Y,TIUDA) ; Evaluate/return whether user can change cosigner
"RTN","TIUSRVA",43,0)
 S Y=$$MAYCHNG^TIURA1(TIUDA)
"RTN","TIUSRVA",44,0)
 Q
"RTN","TIUSRVA",45,0)
NEEDJUST(Y,TIUDA) ; Is justification required for deletion?
"RTN","TIUSRVA",46,0)
 N TIUD0 S TIUD0=$G(^TIU(8925,+TIUDA,0)),Y=0
"RTN","TIUSRVA",47,0)
 I +$P(TIUD0,U,5)'<6 S Y=1
"RTN","TIUSRVA",48,0)
 Q
"RTN","TIUSRVA",49,0)
GETTITLE(Y,TIUDA) ; Get the title from a TIU Document Record
"RTN","TIUSRVA",50,0)
 S Y=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVA",51,0)
 Q
"RTN","TIUSRVA",52,0)
CANATTCH(Y,TIUDA) ; Can this document be attached as an ID Child
"RTN","TIUSRVA",53,0)
 N TITLEDA,PARENTDA
"RTN","TIUSRVA",54,0)
 S TITLEDA=+^TIU(8925,TIUDA,0)
"RTN","TIUSRVA",55,0)
 S PARENTDA=+$G(^TIU(8925,TIUDA,21))
"RTN","TIUSRVA",56,0)
 S Y=$$POSSPRNT^TIULP(TITLEDA)
"RTN","TIUSRVA",57,0)
 I +Y S Y="-1"_U_$P(Y,U,2) Q
"RTN","TIUSRVA",58,0)
 I +$$ISCWAD^TIULX(TITLEDA) D  Q
"RTN","TIUSRVA",59,0)
 . S Y="0^ CWAD Documents may not be Attached as ID Entries."
"RTN","TIUSRVA",60,0)
 I +$$ISA^TIULX(TITLEDA,+$$CLASS^TIUCNSLT) D  Q
"RTN","TIUSRVA",61,0)
 . S Y="0^ Consult Results may not be Attached as ID Entries."
"RTN","TIUSRVA",62,0)
 S Y=$$CANDO^TIULP(TIUDA,"ATTACH TO ID NOTE")
"RTN","TIUSRVA",63,0)
 I PARENTDA D  ; GUI changes "attach" to "detach"
"RTN","TIUSRVA",64,0)
 . I 'Y S Y="0^ You may not attach this note from an interdisciplinary note." Q
"RTN","TIUSRVA",65,0)
 . S Y=$$CANDO^TIULP(PARENTDA,"ATTACH ID ENTRY")
"RTN","TIUSRVA",66,0)
 . I 'Y S Y="0^ You may not attach this note from its interdisciplinary note."
"RTN","TIUSRVA",67,0)
 Q
"RTN","TIUSRVA",68,0)
CANRCV(Y,TIUDA) ; Can this document receive an ID Child?
"RTN","TIUSRVA",69,0)
 S Y=$$CANDO^TIULP(TIUDA,"ATTACH ID ENTRY")
"RTN","TIUSRVA",70,0)
 Q
"RTN","TIUSRVD")
0^63^B36840434
"RTN","TIUSRVD",1,0)
TIUSRVD ; SLC/JER - RPC's for document definition ;21-FEB-2001 11:33:22
"RTN","TIUSRVD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,7,22,47,103,100**;Jun 20, 1997
"RTN","TIUSRVD",3,0)
NOTES(TIUY) ; Get list of PN Titles
"RTN","TIUSRVD",4,0)
 D LIST(.TIUY,3)
"RTN","TIUSRVD",5,0)
 Q
"RTN","TIUSRVD",6,0)
SUMMARY(TIUY) ; Get list of DS Titles
"RTN","TIUSRVD",7,0)
 D LIST(.TIUY,244)
"RTN","TIUSRVD",8,0)
 Q
"RTN","TIUSRVD",9,0)
LIST(TIUY,CLASS,TYPE,TIUK) ; Get list of document titles
"RTN","TIUSRVD",10,0)
 N TIUDFLT
"RTN","TIUSRVD",11,0)
 ; TIUK is STATIC
"RTN","TIUSRVD",12,0)
 S TIUK=+$G(TIUK)
"RTN","TIUSRVD",13,0)
 I $G(TYPE)']"" S TYPE="DOC"
"RTN","TIUSRVD",14,0)
 ; If the user has a preferred list of titles for the CLASS, get it
"RTN","TIUSRVD",15,0)
 I +$O(^TIU(8925.98,"AC",DUZ,CLASS,0)) D PERSLIST(.TIUY,DUZ,CLASS,.TIUK,1)
"RTN","TIUSRVD",16,0)
 S TIUK=+$G(TIUK)+1 S TIUY(TIUK)="~LONG LIST"
"RTN","TIUSRVD",17,0)
 D TRAVERSE(.TIUY,CLASS,$G(TYPE),.TIUK)
"RTN","TIUSRVD",18,0)
 S TIUDFLT=$$PERSDOC^TIULE(DUZ,+CLASS)
"RTN","TIUSRVD",19,0)
 I +TIUDFLT S TIUK=+$G(TIUK)+1,TIUY(TIUK)="d"_$P(TIUDFLT,U,2)
"RTN","TIUSRVD",20,0)
 Q
"RTN","TIUSRVD",21,0)
TRAVERSE(TIUY,CLASS,TYPE,TIUK) ; Get all selectable titles for the CLASS
"RTN","TIUSRVD",22,0)
 N I,J,X,CURTYP,Y,TIUI,TIUC,TYPMATCH S (TIUC,TIUI)=0
"RTN","TIUSRVD",23,0)
 S TIUK=+$G(TIUK)
"RTN","TIUSRVD",24,0)
 I $S(+$$CANENTR^TIULP(CLASS)'>0:1,+$$CANPICK^TIULP(CLASS)'>0:1,1:0) Q
"RTN","TIUSRVD",25,0)
 S CURTYP=$P(^TIU(8925.1,+CLASS,0),U,4)
"RTN","TIUSRVD",26,0)
 S TYPMATCH=$$TYPMATCH^TIULA1(TYPE,CURTYP)
"RTN","TIUSRVD",27,0)
 I +TYPMATCH S TIUK=+$G(TIUK)+1
"RTN","TIUSRVD",28,0)
 I  S TIUY(TIUK)="i"_+CLASS_U_$$PNAME^TIULC1(+CLASS)
"RTN","TIUSRVD",29,0)
 S I=0 F  S I=$O(^TIU(8925.1,+CLASS,10,I)) Q:+I'>0  D
"RTN","TIUSRVD",30,0)
 . N J
"RTN","TIUSRVD",31,0)
 . S J=+$G(^TIU(8925.1,+CLASS,10,+I,0)) Q:+J'>0
"RTN","TIUSRVD",32,0)
 . D TRAVERSE(.TIUY,+J,TYPE,.TIUK)
"RTN","TIUSRVD",33,0)
 Q
"RTN","TIUSRVD",34,0)
PERSLIST(TIUY,DUZ,CLASS,TIUC,TIUFLG) ; Get personal list for a user
"RTN","TIUSRVD",35,0)
 N TIUI,TIUDA,TIUDFLT,NOTINLST S NOTINLST=0
"RTN","TIUSRVD",36,0)
 S TIUDA=+$O(^TIU(8925.98,"AC",DUZ,CLASS,0))
"RTN","TIUSRVD",37,0)
 Q:+TIUDA'>0
"RTN","TIUSRVD",38,0)
 I +$G(TIUFLG) S TIUC=1,TIUY(TIUC)="~SHORT LIST"
"RTN","TIUSRVD",39,0)
 S TIUI=0,TIUC=+$G(TIUC)
"RTN","TIUSRVD",40,0)
 F  S TIUI=$O(^TIU(8925.98,TIUDA,10,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",41,0)
 . N TIUPL,TIUTNM,TIUDTYP,TIUSEQ
"RTN","TIUSRVD",42,0)
 . S TIUPL=$G(^TIU(8925.98,TIUDA,10,TIUI,0))
"RTN","TIUSRVD",43,0)
 . S TIUDTYP=$P(TIUPL,U)
"RTN","TIUSRVD",44,0)
 . I $S(+$$CANENTR^TIULP(TIUDTYP)'>0:1,+$$CANPICK^TIULP(TIUDTYP)'>0:1,1:0) Q
"RTN","TIUSRVD",45,0)
 . S TIUTNM=$S($P(TIUPL,U,3)]"":$P(TIUPL,U,3),1:$$PNAME^TIULC1(+TIUDTYP))
"RTN","TIUSRVD",46,0)
 . S TIUSEQ=+$P(TIUPL,U,2),TIUC=+$G(TIUC)+1
"RTN","TIUSRVD",47,0)
 . S TIUSEQ=$S(+TIUSEQ:$S('$D(TIUY(TIUSEQ)):TIUSEQ,1:(TIUSEQ+1)),1:TIUC)
"RTN","TIUSRVD",48,0)
 . S TIUY(TIUSEQ)="i"_TIUDTYP_U_TIUTNM,TIUC=+TIUSEQ
"RTN","TIUSRVD",49,0)
 I +$G(TIUFLG) Q
"RTN","TIUSRVD",50,0)
 S TIUDFLT=$$PERSDOC^TIULE(DUZ,+CLASS)
"RTN","TIUSRVD",51,0)
 S (TIUI,TIUC)=0
"RTN","TIUSRVD",52,0)
 F  S TIUI=$O(TIUY(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",53,0)
 . S TIUC=TIUI
"RTN","TIUSRVD",54,0)
 . I +TIUDFLT,($P($G(TIUY(TIUI)),U)=("i"_+TIUDFLT)) S $P(TIUDFLT,U,2)=$P(TIUY(TIUI),U,2),NOTINLST=0
"RTN","TIUSRVD",55,0)
 . E  S NOTINLST=1
"RTN","TIUSRVD",56,0)
 I +TIUDFLT D
"RTN","TIUSRVD",57,0)
 . ;if default isn't in list, append it as an item
"RTN","TIUSRVD",58,0)
 . I NOTINLST S TIUC=+$G(TIUC)+1,TIUY(TIUC)="i"_TIUDFLT
"RTN","TIUSRVD",59,0)
 . ;otherwise, just append as default
"RTN","TIUSRVD",60,0)
 . S TIUC=+$G(TIUC)+1,TIUY(TIUC)="d"_TIUDFLT
"RTN","TIUSRVD",61,0)
 Q
"RTN","TIUSRVD",62,0)
BLRSHELL(TIUY,TITLE,DFN,VSTR) ; Shell for boilerplate RPC
"RTN","TIUSRVD",63,0)
 K ^TMP("TIUBOIL",$J)
"RTN","TIUSRVD",64,0)
 D BLRPLT(.TIUY,TITLE,DFN,$G(VSTR))
"RTN","TIUSRVD",65,0)
 K ^TMP("TIUBOIL",$J,0)
"RTN","TIUSRVD",66,0)
 Q
"RTN","TIUSRVD",67,0)
BLRPLT(TIUY,TITLE,DFN,VSTR,ROOT) ; Load/Execute the Boilerplate for TITLE
"RTN","TIUSRVD",68,0)
 ;                                 or ROOT
"RTN","TIUSRVD",69,0)
 N TIU,TIUI,TIUJ,TIUK,TIUL,VADM,VAIN,VA,VAERR S TIUI=0
"RTN","TIUSRVD",70,0)
 S:'$D(TIUY) TIUY=$NA(^TMP("TIUBOIL",$J))
"RTN","TIUSRVD",71,0)
 S:'$D(ROOT) ROOT=$NA(^TIU(8925.1,+TITLE,"DFLT")) ; **47**
"RTN","TIUSRVD",72,0)
 I $L($G(VSTR)) D PATVADPT^TIULV(.TIU,DFN,"",$G(VSTR)) ; **47**
"RTN","TIUSRVD",73,0)
 S TIUJ=+$P($G(^TMP("TIUBOIL",$J,0)),U,3)+1
"RTN","TIUSRVD",74,0)
 ; --- Set component header ---
"RTN","TIUSRVD",75,0)
 I ROOT["^TIU(8925.1," D
"RTN","TIUSRVD",76,0)
 . S ^TMP("TIUBOIL",$J,TIUJ,0)=$S($P($G(^TIU(8925.1,+TITLE,0)),U,4)="CO":$P(^TIU(8925.1,+TITLE,0),U)_":   ",1:"")
"RTN","TIUSRVD",77,0)
 I +TIUJ=1,($G(^TMP("TIUBOIL",$J,TIUJ,0))']"") K ^TMP("TIUBOIL",$J,TIUJ,0) S TIUJ=0
"RTN","TIUSRVD",78,0)
 S ^TMP("TIUBOIL",$J,0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIUSRVD",79,0)
 F  S TIUI=$O(@ROOT@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",80,0)
 . S TIUJ=TIUJ+1,X=$G(@ROOT@(TIUI,0))
"RTN","TIUSRVD",81,0)
 . I $L($T(DOLMLINE^TIUSRVF1)),'$D(XWBOS),(X["{FLD:") S X=$$DOLMLINE^TIUSRVF1(X)
"RTN","TIUSRVD",82,0)
 . I X["|" S X=$$BOIL(X,TIUJ)
"RTN","TIUSRVD",83,0)
 . I X["~@" D INSMULT(X,"^TMP(""TIUBOIL"",$J)",.TIUJ) I 1
"RTN","TIUSRVD",84,0)
 . E  S ^TMP("TIUBOIL",$J,TIUJ,0)=X
"RTN","TIUSRVD",85,0)
 . S ^TMP("TIUBOIL",$J,0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIUSRVD",86,0)
 I ROOT["^TIU(8925.1,",+$O(^TIU(8925.1,+TITLE,10,0)) D
"RTN","TIUSRVD",87,0)
 . N TIUFITEM,TIUI D ITEMS^TIUFLT(+TITLE)
"RTN","TIUSRVD",88,0)
 . S TIUI=0 F  S TIUI=$O(TIUFITEM(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",89,0)
 . . S TIUL=+$G(TIUFITEM(+TIUI)) D BLRPLT(.TIUY,TIUL,DFN,$G(VSTR))
"RTN","TIUSRVD",90,0)
 Q
"RTN","TIUSRVD",91,0)
BOIL(LINE,COUNT) ; Execute Boilerplates
"RTN","TIUSRVD",92,0)
 N TIUI,DIC,X,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUSRVD",93,0)
 S DIC=8925.1,DIC(0)="FMXZ"
"RTN","TIUSRVD",94,0)
 S DIC("S")="I $P($G(^TIU(8925.1,+Y,0)),U,4)=""O"""
"RTN","TIUSRVD",95,0)
 F TIUI=2:2:$L(LINE,"|") S X=$P(LINE,"|",TIUI) D
"RTN","TIUSRVD",96,0)
 . D ^DIC
"RTN","TIUSRVD",97,0)
 . I +Y'>0 S X="The OBJECT "_X_" was NOT found...Contact IRM."
"RTN","TIUSRVD",98,0)
 . I +Y>0 D
"RTN","TIUSRVD",99,0)
 . . I $D(^TIU(8925.1,+Y,9)),+$$CANXEC(+Y) X ^(9) S:$E(X,1,2)="~@" X=X_"~@" I 1
"RTN","TIUSRVD",100,0)
 . . E  S X="The OBJECT "_X_" is INACTIVE...Contact IRM."
"RTN","TIUSRVD",101,0)
 . S LINE=$$REPLACE(LINE,X,TIUI)
"RTN","TIUSRVD",102,0)
 Q $TR(LINE,"|","")
"RTN","TIUSRVD",103,0)
CANXEC(TIUODA) ; Evaluate Object Status
"RTN","TIUSRVD",104,0)
 N TIUOST,TIUY S TIUOST=+$P($G(^TIU(8925.1,+TIUODA,0)),U,7)
"RTN","TIUSRVD",105,0)
 S TIUY=$S(TIUOST=11:1,+$G(NOSAVE):1,1:0)
"RTN","TIUSRVD",106,0)
 Q +$G(TIUY)
"RTN","TIUSRVD",107,0)
REPLACE(LINE,X,TIUI) ; Replace the TIUIth object in LINE w/X
"RTN","TIUSRVD",108,0)
 S $P(LINE,"|",TIUI)=X
"RTN","TIUSRVD",109,0)
 Q LINE
"RTN","TIUSRVD",110,0)
INSMULT(LINE,TARGET,TIULCNT) ; Mult-valued results
"RTN","TIUSRVD",111,0)
 N TIUPC
"RTN","TIUSRVD",112,0)
 F TIUPC=2:2:$L(LINE,"~@") D
"RTN","TIUSRVD",113,0)
 . N TIUI,TIULINE,TIUX,TIUSRC,TIUSCNT,TIUTAIL
"RTN","TIUSRVD",114,0)
 . S TIUSRC=$P(LINE,"~@",TIUPC)
"RTN","TIUSRVD",115,0)
 . S TIUTAIL=$P(LINE,"~@",TIUPC+1)
"RTN","TIUSRVD",116,0)
 . S TIULINE=$P(LINE,"~@",(TIUPC-1)),(TIUI,TIUSCNT)=0
"RTN","TIUSRVD",117,0)
 . I $E(TIULINE)=" ",(TIUPC>2) S $E(TIULINE)=""
"RTN","TIUSRVD",118,0)
 . F  S TIUI=$O(@TIUSRC@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",119,0)
 . . N TIUSLINE
"RTN","TIUSRVD",120,0)
 . . S TIUSCNT=TIUSCNT+1
"RTN","TIUSRVD",121,0)
 . . S TIUSLINE=$G(@TIUSRC@(TIUI,0))
"RTN","TIUSRVD",122,0)
 . . S:'+$O(@TIUSRC@(TIUI))&(TIUPC+2>$L(LINE,"~@")) TIUSLINE=TIUSLINE_TIUTAIL
"RTN","TIUSRVD",123,0)
 . . I TIUSCNT=1,($L(TIULINE_TIUSLINE)>73) D  Q
"RTN","TIUSRVD",124,0)
 . . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUSRVD",125,0)
 . . . S @TARGET@(TIULCNT,0)=TIULINE
"RTN","TIUSRVD",126,0)
 . . . S TIULCNT=TIULCNT+1
"RTN","TIUSRVD",127,0)
 . . . S @TARGET@(TIULCNT,0)=TIUSLINE
"RTN","TIUSRVD",128,0)
 . . I TIUSCNT=1,($L(TIULINE_TIUSLINE)'>73) D  Q
"RTN","TIUSRVD",129,0)
 . . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUSRVD",130,0)
 . . . S @TARGET@(TIULCNT,0)=TIULINE_TIUSLINE
"RTN","TIUSRVD",131,0)
 . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUSRVD",132,0)
 . . S @TARGET@(TIULCNT,0)=$G(TIUSLINE)
"RTN","TIUSRVD",133,0)
 . K @TIUSRC
"RTN","TIUSRVD",134,0)
 Q
"RTN","TIUSRVD",135,0)
LNGCNSLT(Y,FROM,DIR) ; Handle long list of titles for CONSULTS
"RTN","TIUSRVD",136,0)
 N CLASS S CLASS=+$$CLASS^TIUCNSLT Q:+CLASS'>0
"RTN","TIUSRVD",137,0)
 D LONGLIST(.Y,CLASS,$G(FROM),$G(DIR,1))
"RTN","TIUSRVD",138,0)
 Q
"RTN","TIUSRVD",139,0)
LONGLIST(Y,CLASS,FROM,DIR,IDNOTE)     ; long list of titles for a class
"RTN","TIUSRVD",140,0)
 ; .Y=returned list, CLASS=ptr to class in 8925.1, FROM=text to $O from,
"RTN","TIUSRVD",141,0)
 ; DIR=$O direction, IDNOTE=flag to indicate selection for ID Entry
"RTN","TIUSRVD",142,0)
 N I,DA,CNT S I=0,CNT=44,DIR=$G(DIR,1)
"RTN","TIUSRVD",143,0)
 F  Q:I'<CNT  S FROM=$O(^TIU(8925.1,"ACL",CLASS,FROM),DIR) Q:FROM=""  D
"RTN","TIUSRVD",144,0)
 . S DA=0
"RTN","TIUSRVD",145,0)
 . F  Q:I'<CNT  S DA=$O(^TIU(8925.1,"ACL",CLASS,FROM,DA)) Q:+DA'>0  D
"RTN","TIUSRVD",146,0)
 . . N INDX
"RTN","TIUSRVD",147,0)
 . . I $S(+$$CANENTR^TIULP(DA)'>0:1,+$$CANPICK^TIULP(DA)'>0:1,1:0) Q
"RTN","TIUSRVD",148,0)
 . . I +$L($T(CANLINK^TIULP)),+$G(IDNOTE),(+$$CANLINK^TIULP(DA)'>0) Q
"RTN","TIUSRVD",149,0)
 . . S INDX=$G(^TIU(8925.1,"ACL",CLASS,FROM,DA))
"RTN","TIUSRVD",150,0)
 . . I FROM=$P($P(INDX,U,2)," ") Q
"RTN","TIUSRVD",151,0)
 . . S I=I+1,Y(I)=DA_"^"_FROM_$S('+INDX:"",1:"  <"_$P(INDX,U,2)_">")
"RTN","TIUSRVD",152,0)
 Q
"RTN","TIUSRVD",153,0)
CNSLCLAS(Y) ; RPC to identify class CONSULTS
"RTN","TIUSRVD",154,0)
 S Y=$$CLASS^TIUCNSLT
"RTN","TIUSRVD",155,0)
 Q
"RTN","TIUSRVLL")
0^39^B44395016
"RTN","TIUSRVLL",1,0)
TIUSRVLL ; SLC/JER - Server functions for LOCAL lists ;1/14/01
"RTN","TIUSRVLL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,100**;Jun 20, 1997
"RTN","TIUSRVLL",3,0)
LIST(TIUY,CLASS,DFN,EARLY,LATE) ; Build List user can select from to browse
"RTN","TIUSRVLL",4,0)
 N TIUCNT,TIUDT,TIUI,TIUJ,TIUK,TIUP,TIUQ,TIUREC,TIUPRM0,TIUPRM1
"RTN","TIUSRVLL",5,0)
 N TIUPRM3,TIUT,TIUTP,XREF,TIUS,TIUCONT,TIUSTAT,TIUTYPE
"RTN","TIUSRVLL",6,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUSRVLL",7,0)
 S EARLY=9999999-+$G(EARLY),TIUCNT=0
"RTN","TIUSRVLL",8,0)
 S (TIUI,LATE)=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUSRVLL",9,0)
 F  S TIUI=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI)) Q:+TIUI'>0!(+TIUI>EARLY)  D GATHER(.TIUY,DFN,CLASS,TIUI)
"RTN","TIUSRVLL",10,0)
 Q
"RTN","TIUSRVLL",11,0)
GATHER(TIUY,DFN,CLASS,TIUI) ; Find/sort records for the list to browse
"RTN","TIUSRVLL",12,0)
 N TIUDA
"RTN","TIUSRVLL",13,0)
 S TIUDA=0
"RTN","TIUSRVLL",14,0)
 F  S TIUDA=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUSRVLL",15,0)
 . I ($P(TIUPRM0,U,6)="S"),(+$$CANDO^TIULP(TIUDA,"VIEW")'>0) Q
"RTN","TIUSRVLL",16,0)
 . I +$G(^TIU(8925,+TIUDA,0))'>0 K ^TIU(8925,"APTCL",DFN,CLASS,TIUI,TIUDA) Q
"RTN","TIUSRVLL",17,0)
 . I +$G(^TIU(8925,+TIUDA,0))=81,(+$P($G(^(0)),U,5)>5) Q
"RTN","TIUSRVLL",18,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSRVLL",19,0)
 . S TIUY(TIUCNT)=TIUDA,TIUY=TIUCNT
"RTN","TIUSRVLL",20,0)
 Q
"RTN","TIUSRVLL",21,0)
 ;
"RTN","TIUSRVLL",22,0)
CONTEXT(TIUY,CLASS,CONTEXT,DFN,EARLY,LATE,PERSON,OCCLIM,SEQUENCE,TIUEXPKD) ; main
"RTN","TIUSRVLL",23,0)
 ; --- Call with:  TIUY     - RETURN ARRAY pass by reference
"RTN","TIUSRVLL",24,0)
 ;                 CLASS    - Pointer to TIU DOCUMENT DEFINITION #8925.1
"RTN","TIUSRVLL",25,0)
 ;                 CONTEXT  - 1=All Signed (by PT),
"RTN","TIUSRVLL",26,0)
 ;                          - 2="Unsigned (by PT&(AUTHOR!TANSCRIBER))
"RTN","TIUSRVLL",27,0)
 ;                          - 3="Uncosigned (by PT&EXPECTED COSIGNER
"RTN","TIUSRVLL",28,0)
 ;                          - 4="Signed notes (by PT&selected author)
"RTN","TIUSRVLL",29,0)
 ;                          - 5="Signed notes (by PT&date range)
"RTN","TIUSRVLL",30,0)
 ;                 DFN      - Pointer to Patient (#2)
"RTN","TIUSRVLL",31,0)
 ;                [EARLY]   - FM date/time to begin search
"RTN","TIUSRVLL",32,0)
 ;                [LATE]    - FM date/time to end search
"RTN","TIUSRVLL",33,0)
 ;                [PERSON]  - Pointer to file 200 (DUZ if not passed)
"RTN","TIUSRVLL",34,0)
 ;                [OCCLIM]  - Occurrence Limit (optional)
"RTN","TIUSRVLL",35,0)
 ;               [SEQUENCE] - "A"=ascending (Regular date/time) (dflt)
"RTN","TIUSRVLL",36,0)
 ;                          - "D"=descending (Reverse date/time)
"RTN","TIUSRVLL",37,0)
 ;               [TIUEXPKD] - Return array, pass by ref.
"RTN","TIUSRVLL",38,0)
 ;                            TIUEXPKD(IFN)="", where we will expand IFN
"RTN","TIUSRVLL",39,0)
 ;                            so ID kids/adda that meet criteria are
"RTN","TIUSRVLL",40,0)
 ;                            displayed under it.
"RTN","TIUSRVLL",41,0)
 K TIUY S TIUY=0
"RTN","TIUSRVLL",42,0)
 I $G(CONTEXT)'>0 Q
"RTN","TIUSRVLL",43,0)
 I $G(CLASS)'>0 Q
"RTN","TIUSRVLL",44,0)
 S:+$G(EARLY)'>0 EARLY=0
"RTN","TIUSRVLL",45,0)
 S:+$G(LATE)'>0 LATE=5000000
"RTN","TIUSRVLL",46,0)
 S:+$G(PERSON)'>0 PERSON=DUZ
"RTN","TIUSRVLL",47,0)
 S:$G(SEQUENCE)']"" SEQUENCE="D"
"RTN","TIUSRVLL",48,0)
 S:+$G(OCCLIM)'>0 OCCLIM=9999999
"RTN","TIUSRVLL",49,0)
 S DFN=+$G(DFN)
"RTN","TIUSRVLL",50,0)
 S EARLY=9999999-EARLY,LATE=9999999-LATE ; CHANGE TO REVERSE DATES
"RTN","TIUSRVLL",51,0)
 ; --------------------
"RTN","TIUSRVLL",52,0)
 I CONTEXT=1!(CONTEXT=5) D  Q
"RTN","TIUSRVLL",53,0)
 . D ACLPT(.TIUY,CLASS,DFN,LATE,EARLY,OCCLIM,SEQUENCE)
"RTN","TIUSRVLL",54,0)
 ; --------------------
"RTN","TIUSRVLL",55,0)
 I CONTEXT=2 D  Q
"RTN","TIUSRVLL",56,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLL",57,0)
 . . D ACLAU(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",58,0)
 . F DFN=0:0 S DFN=$O(^TIU(8925,"ACLAU",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLAU(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",59,0)
 ; --------------------
"RTN","TIUSRVLL",60,0)
 I CONTEXT=3 D  Q
"RTN","TIUSRVLL",61,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLL",62,0)
 . . D ACLEC(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",63,0)
 . F DFN=0:0 S DFN=$O(^TIU(8925,"ACLEC",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLEC(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",64,0)
 ; --------------------
"RTN","TIUSRVLL",65,0)
 I CONTEXT=4 D  Q
"RTN","TIUSRVLL",66,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLL",67,0)
 . . D ACLSB(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",68,0)
 . F DFN=0:0 S DFN=$O(^TIU(8925,"ACLSB",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLSB(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",69,0)
 Q
"RTN","TIUSRVLL",70,0)
 ;
"RTN","TIUSRVLL",71,0)
ACLPT(ARRAY,CLASS,DFN,TIME1,TIME2,OCCLIM,SEQUENCE) ; Signed,
"RTN","TIUSRVLL",72,0)
 ;by patient, [& date].
"RTN","TIUSRVLL",73,0)
 N DATTIM,DA,ROOT,RPARRAY,TIUORDER
"RTN","TIUSRVLL",74,0)
 S ROOT=$NA(^TIU(8925,"ACLPT",CLASS,DFN))
"RTN","TIUSRVLL",75,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",76,0)
 ; Since date/time is inverted, set subscripts forward for descending:
"RTN","TIUSRVLL",77,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",78,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:$S(+DATTIM'>0:1,+DATTIM>TIME2:1,+$G(RPARRAY)'<OCCLIM:1,1:0)  D
"RTN","TIUSRVLL",79,0)
 . F DA=0:0 S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",80,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLL",81,0)
 . . I +^TIU(8925,+DA,0)=81 Q
"RTN","TIUSRVLL",82,0)
 . . ; -- Set records into RPARRAY, replacing kids w parents:
"RTN","TIUSRVLL",83,0)
 . . D REPLACE(DA,DATTIM,.RPARRAY)
"RTN","TIUSRVLL",84,0)
 D SETARRY(.ARRAY,.RPARRAY,TIUORDER)
"RTN","TIUSRVLL",85,0)
 Q
"RTN","TIUSRVLL",86,0)
 ;
"RTN","TIUSRVLL",87,0)
SETARRY(ARRAY,RPARRAY,TIUORDER) ; Set ARRAY(SUB)=DA, which is passed
"RTN","TIUSRVLL",88,0)
 ;back to CONTEXT.  ARRAY holds the right records, in the right order
"RTN","TIUSRVLL",89,0)
 ;for the List Template list.
"RTN","TIUSRVLL",90,0)
 ; TIUORDER=1 or -1: Set ARRAY subscripts forward 1,2 etc., or
"RTN","TIUSRVLL",91,0)
 ;backward -1,-2, etc.
"RTN","TIUSRVLL",92,0)
 ; Requires RPARRAY, with ID kids or adda RePlaced by parents.
"RTN","TIUSRVLL",93,0)
 N DATTIM,TIUDA,SUB
"RTN","TIUSRVLL",94,0)
 S DATTIM=0
"RTN","TIUSRVLL",95,0)
 S SUB=0
"RTN","TIUSRVLL",96,0)
 F  S DATTIM=$O(RPARRAY(DATTIM)) Q:'DATTIM  D
"RTN","TIUSRVLL",97,0)
 . S TIUDA=0
"RTN","TIUSRVLL",98,0)
 . F  S TIUDA=$O(RPARRAY(DATTIM,TIUDA)) Q:'TIUDA  D
"RTN","TIUSRVLL",99,0)
 . . S SUB=SUB+TIUORDER
"RTN","TIUSRVLL",100,0)
 . . S ARRAY(SUB)=TIUDA
"RTN","TIUSRVLL",101,0)
 Q
"RTN","TIUSRVLL",102,0)
 ;
"RTN","TIUSRVLL",103,0)
REPLACE(TIUDA,DATTIM,RPARRAY,EXPAND,FORGETAD) ; Populate RPARRAY with
"RTN","TIUSRVLL",104,0)
 ;records that meet criteria, replacing ID kids or addenda with
"RTN","TIUSRVLL",105,0)
 ;their parents.
"RTN","TIUSRVLL",106,0)
 ; Requires TIUDA, DATTIM;
"RTN","TIUSRVLL",107,0)
 ; opt flag FORGETAD - if 1, don't add note to the expand list
"RTN","TIUSRVLL",108,0)
 ;merely because of an addendum.  Used in search by title.
"RTN","TIUSRVLL",109,0)
 ; Passes back arrays RPARRAY, EXPAND.
"RTN","TIUSRVLL",110,0)
 ; Sort by ref date/time
"RTN","TIUSRVLL",111,0)
 N IDPRNT,ADDMPRNT,ADDMGPNT,PDATTIM,GPDATTIM
"RTN","TIUSRVLL",112,0)
 S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIUSRVLL",113,0)
 I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIUSRVLL",114,0)
 I IDPRNT S PDATTIM=+^TIU(8925,IDPRNT,13),PDATTIM=9999999-PDATTIM
"RTN","TIUSRVLL",115,0)
 S ADDMPRNT=+$P(^TIU(8925,TIUDA,0),U,6) ; assume TIUDA is not component
"RTN","TIUSRVLL",116,0)
 I '$D(^TIU(8925,ADDMPRNT,0)) S ADDMPRNT=0
"RTN","TIUSRVLL",117,0)
 I ADDMPRNT S PDATTIM=+^TIU(8925,ADDMPRNT,13),PDATTIM=9999999-PDATTIM
"RTN","TIUSRVLL",118,0)
 ; -- If TIUDA is not an ID kid, not addm, just put it
"RTN","TIUSRVLL",119,0)
 ;    in RPARRAY and quit: --
"RTN","TIUSRVLL",120,0)
 S EXPAND=+$G(EXPAND)
"RTN","TIUSRVLL",121,0)
 I 'IDPRNT,'ADDMPRNT D  Q
"RTN","TIUSRVLL",122,0)
 . Q:$D(RPARRAY(DATTIM,TIUDA))
"RTN","TIUSRVLL",123,0)
 . S RPARRAY(DATTIM,TIUDA)=""
"RTN","TIUSRVLL",124,0)
 . S RPARRAY=$G(RPARRAY)+1
"RTN","TIUSRVLL",125,0)
 ; -- If TIUDA is an ID kid, put its parent in array:
"RTN","TIUSRVLL",126,0)
 I IDPRNT D  Q
"RTN","TIUSRVLL",127,0)
 . I '$D(EXPAND(IDPRNT)) S EXPAND(IDPRNT)="",EXPAND=EXPAND+1
"RTN","TIUSRVLL",128,0)
 . Q:$D(RPARRAY(PDATTIM,IDPRNT))
"RTN","TIUSRVLL",129,0)
 . S RPARRAY(PDATTIM,IDPRNT)=""
"RTN","TIUSRVLL",130,0)
 . S RPARRAY=$G(RPARRAY)+1
"RTN","TIUSRVLL",131,0)
 ; -- If TIUDA is an addendum, put its parent/gprnt in array:
"RTN","TIUSRVLL",132,0)
 I ADDMPRNT D  Q
"RTN","TIUSRVLL",133,0)
 . I '$G(FORGETAD),'$D(EXPAND(ADDMPRNT)) S EXPAND(ADDMPRNT)="",EXPAND=EXPAND+1
"RTN","TIUSRVLL",134,0)
 . S ADDMGPNT=+$G(^TIU(8925,ADDMPRNT,21))
"RTN","TIUSRVLL",135,0)
 . I '$D(^TIU(8925,ADDMGPNT,0)) S ADDMGPNT=0
"RTN","TIUSRVLL",136,0)
 . I ADDMGPNT D  I 1
"RTN","TIUSRVLL",137,0)
 . . S GPDATTIM=+^TIU(8925,ADDMGPNT,13),GPDATTIM=9999999-GPDATTIM
"RTN","TIUSRVLL",138,0)
 . . I '$D(EXPAND(ADDMGPNT)) S EXPAND(ADDMGPNT)="",EXPAND=EXPAND+1
"RTN","TIUSRVLL",139,0)
 . . Q:$D(RPARRAY(GPDATTIM,ADDMGPNT))
"RTN","TIUSRVLL",140,0)
 . . S RPARRAY(GPDATTIM,ADDMGPNT)=""
"RTN","TIUSRVLL",141,0)
 . . S RPARRAY=$G(RPARRAY)+1
"RTN","TIUSRVLL",142,0)
 . E  D
"RTN","TIUSRVLL",143,0)
 . . Q:$D(RPARRAY(PDATTIM,ADDMPRNT))
"RTN","TIUSRVLL",144,0)
 . . S RPARRAY(PDATTIM,ADDMPRNT)=""
"RTN","TIUSRVLL",145,0)
 . . S RPARRAY=$G(RPARRAY)+1
"RTN","TIUSRVLL",146,0)
 Q
"RTN","TIUSRVLL",147,0)
ACLAU(ARRAY,CLASS,AUTHOR,DFN,TIME1,TIME2,SEQUENCE,TIUEXPKD) ; Unsigned
"RTN","TIUSRVLL",148,0)
 N DATTIM,DA,ROOT,TIUORDER,RPARRAY
"RTN","TIUSRVLL",149,0)
 S ROOT=$NA(^TIU(8925,"ACLAU",CLASS,AUTHOR,DFN))
"RTN","TIUSRVLL",150,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",151,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",152,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLL",153,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",154,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>6 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLL",155,0)
 . . I +$G(^TIU(8925,DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLL",156,0)
 . . ; Don't include ID kids or parents in top level of list;
"RTN","TIUSRVLL",157,0)
 . . ; Do expand kids
"RTN","TIUSRVLL",158,0)
 . . D REPLACE(DA,DATTIM,.RPARRAY,.TIUEXPKD)
"RTN","TIUSRVLL",159,0)
 D SETARRY(.ARRAY,.RPARRAY,TIUORDER)
"RTN","TIUSRVLL",160,0)
 Q
"RTN","TIUSRVLL",161,0)
ACLEC(ARRAY,CLASS,EXCOSIGN,DFN,TIME1,TIME2,SEQUENCE,TIUEXPKD) ; Uncosigned
"RTN","TIUSRVLL",162,0)
 N DATTIM,DA,ROOT,TIUORDER,RPARRAY
"RTN","TIUSRVLL",163,0)
 S ROOT=$NA(^TIU(8925,"ACLEC",CLASS,EXCOSIGN,DFN))
"RTN","TIUSRVLL",164,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",165,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",166,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLL",167,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",168,0)
 . . I +$G(^TIU(8925,DA,0))'>0 K @ROOT@(DATTIM,DA)
"RTN","TIUSRVLL",169,0)
 . . D REPLACE(DA,DATTIM,.RPARRAY,.TIUEXPKD)
"RTN","TIUSRVLL",170,0)
 D SETARRY(.ARRAY,.RPARRAY,TIUORDER)
"RTN","TIUSRVLL",171,0)
 Q
"RTN","TIUSRVLL",172,0)
ACLSB(ARRAY,CLASS,SIGNEDBY,DFN,TIME1,TIME2,SEQUENCE,TIUEXPKD) ; Signed, by author
"RTN","TIUSRVLL",173,0)
 N DATTIM,DA,ROOT,TIUORDER,RPARRAY
"RTN","TIUSRVLL",174,0)
 S ROOT=$NA(^TIU(8925,"ACLSB",CLASS,SIGNEDBY,DFN))
"RTN","TIUSRVLL",175,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",176,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",177,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLL",178,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",179,0)
 . . I +$G(^TIU(8925,DA,0))'>0 K @ROOT@(DATTIM,DA)
"RTN","TIUSRVLL",180,0)
 . . D REPLACE(DA,DATTIM,.RPARRAY,.TIUEXPKD)
"RTN","TIUSRVLL",181,0)
 D SETARRY(.ARRAY,.RPARRAY,TIUORDER)
"RTN","TIUSRVLL",182,0)
 Q
"RTN","TIUSRVLV")
0^93^B9127015
"RTN","TIUSRVLV",1,0)
TIUSRVLV ; SLC/JER - Server fns for lists by Visit ;28-FEB-2001 09:25:40
"RTN","TIUSRVLV",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,47,100**;Jun 20, 1997
"RTN","TIUSRVLV",3,0)
NOTES(TIUY,VISIT,STATUS) ; Gets list of Notes
"RTN","TIUSRVLV",4,0)
 I $S(+$G(VISIT)'>0:1,'$D(^AUPNVSIT(+$G(VISIT),0)):1,1:0) Q
"RTN","TIUSRVLV",5,0)
 D LIST(.TIUY,VISIT,3,$G(STATUS))
"RTN","TIUSRVLV",6,0)
 Q
"RTN","TIUSRVLV",7,0)
SUMMARY(TIUY,VISIT,STATUS) ; Gets list of Summaries
"RTN","TIUSRVLV",8,0)
 I $S(+$G(VISIT)'>0:1,'$D(^AUPNVSIT(+$G(VISIT),0)):1,1:0) Q
"RTN","TIUSRVLV",9,0)
 D LIST(.TIUY,VISIT,244,$G(STATUS))
"RTN","TIUSRVLV",10,0)
 Q
"RTN","TIUSRVLV",11,0)
LIST(TIUY,VISIT,CLASS,STATUS) ; Get documents for a visit
"RTN","TIUSRVLV",12,0)
 N TIUDA,TIUTTL,TIUCCLS,TIUCCPN S TIUDA=0
"RTN","TIUSRVLV",13,0)
 K ^TMP("TIULIST",$J) S TIUY=$NA(^TMP("TIULIST",$J))
"RTN","TIUSRVLV",14,0)
 S TIUCCLS=+$$CLASS^TIUCNSLT,TIUCCPN=+$$ISA^TIULX(TIUCCLS,3)
"RTN","TIUSRVLV",15,0)
 I $S(+$G(VISIT)'>0:1,'$D(^AUPNVSIT(+VISIT)):1,+$G(CLASS)'>0:1,1:0) Q
"RTN","TIUSRVLV",16,0)
 F  S TIUDA=$O(^TIU(8925,"V",VISIT,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUSRVLV",17,0)
 . N TIUTTL,TIUI,TIUD0,TIUSTS S TIUI=0,TIUD0=$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVLV",18,0)
 . Q:+$P(TIUD0,U,6)
"RTN","TIUSRVLV",19,0)
 . S TIUTTL=+TIUD0,TIUSTS=$P(TIUD0,U,5) Q:+TIUTTL'>0
"RTN","TIUSRVLV",20,0)
 . I +$G(STATUS),(TIUSTS'=STATUS) Q
"RTN","TIUSRVLV",21,0)
 . I +$$ISA^TIULX(TIUTTL,CLASS) D ADDELMNT(TIUDA,TIUI) I 1
"RTN","TIUSRVLV",22,0)
 . E  I CLASS=3,'TIUCCPN,+$$ISA^TIULX(TIUTTL,TIUCCLS) D ADDELMNT(TIUDA,TIUI)
"RTN","TIUSRVLV",23,0)
 K ^TMP("TIULIST",$J,"INDX")
"RTN","TIUSRVLV",24,0)
 Q
"RTN","TIUSRVLV",25,0)
ADDELMNT(DA,TIUCNT) ; Add each element to the list
"RTN","TIUSRVLV",26,0)
 N DOC,LOC,PT,AUT,EDT,TIUPT,TIULST4,TIUREC,TIUR0,TIUR12,TIUR13
"RTN","TIUSRVLV",27,0)
 N STATUS,EDTCNT,LOCTYP,TIUADT,TIUDDT
"RTN","TIUSRVLV",28,0)
 S TIUR0=$G(^TIU(8925,+DA,0)),TIUR12=$G(^TIU(8925,+DA,12))
"RTN","TIUSRVLV",29,0)
 S TIUR13=$G(^TIU(8925,+DA,13))
"RTN","TIUSRVLV",30,0)
 ; If doc is an ID Child, return it's parent
"RTN","TIUSRVLV",31,0)
 I +$G(^TIU(8925,DA,21)) S DA=+$G(^TIU(8925,DA,21))
"RTN","TIUSRVLV",32,0)
 ; Don't return duplicates
"RTN","TIUSRVLV",33,0)
 I +$O(^TMP("TIULIST",$J,"INDX",DA,0)) Q
"RTN","TIUSRVLV",34,0)
 S TIUPT=$G(^DPT(+$P(TIUR0,U,2),0)),DOC=$$PNAME^TIULC1(+TIUR0)
"RTN","TIUSRVLV",35,0)
 I DOC="Addendum" S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUR0,U,6),0)))
"RTN","TIUSRVLV",36,0)
 S STATUS=$$LOWER^TIULS($P(^TIU(8925.6,+$P(TIUR0,U,5),0),U))
"RTN","TIUSRVLV",37,0)
 S LOC=$G(^SC(+$P(TIUR12,U,5),0)),LOCTYP=$P(LOC,U,3),LOC=$P(LOC,U)
"RTN","TIUSRVLV",38,0)
 S TIUADT=$S(LOCTYP="W":"Adm: ",1:"Visit: ")_$$DATE^TIULS($P(TIUR0,U,7),"MM/DD/YY")
"RTN","TIUSRVLV",39,0)
 S TIUDDT=$S(+$P(TIUR0,U,8):"Dis: ",1:"")_$$DATE^TIULS($P(TIUR0,U,8),"MM/DD/YY")
"RTN","TIUSRVLV",40,0)
 S PT=$$NAME^TIULS($P(TIUPT,U),"LAST, FIRST MI")
"RTN","TIUSRVLV",41,0)
 S TIULST4=$E($P(TIUPT,U,9),6,9)
"RTN","TIUSRVLV",42,0)
 S TIULST4="("_$E(PT)_TIULST4_")"
"RTN","TIUSRVLV",43,0)
 S AUT=$$SIGNAME^TIULS(+$P(TIUR12,U,2))
"RTN","TIUSRVLV",44,0)
 S EDT=+TIUR13,EDTCNT=+$G(EDTCNT)+1
"RTN","TIUSRVLV",45,0)
 F  Q:+$D(^TMP("TIULIST",$J,9999999-EDT,EDTCNT))'>0  S EDTCNT=EDTCNT+1
"RTN","TIUSRVLV",46,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSRVLV",47,0)
 S TIUREC=DA_U_DOC_U_EDT_U_PT_" "_TIULST4_U_AUT_U_LOC_U_STATUS_U_TIUADT_U_TIUDDT
"RTN","TIUSRVLV",48,0)
 S ^TMP("TIULIST",$J,9999999-EDT,EDTCNT)=TIUREC
"RTN","TIUSRVLV",49,0)
 S ^TMP("TIULIST",$J,"INDX",DA,EDTCNT)=""
"RTN","TIUSRVLV",50,0)
 Q
"RTN","TIUSRVLV",51,0)
DOCCNT(TIUY,DFN,VSTR,VSIT) ; Get # of Documents for a given visit
"RTN","TIUSRVLV",52,0)
 N TIUI,CNT S (TIUY,TIUI)=0
"RTN","TIUSRVLV",53,0)
 I +$G(VSIT) D  Q
"RTN","TIUSRVLV",54,0)
 . F  S TIUI=$O(^TIU(8925,"V",+VSIT,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVLV",55,0)
 . . S TIUY=TIUY+1
"RTN","TIUSRVLV",56,0)
 I +$G(DFN),+$G(VSTR) D
"RTN","TIUSRVLV",57,0)
 . N TIUJ
"RTN","TIUSRVLV",58,0)
 . F  S TIUI=$O(^TIU(8925,"AVSTRV",DFN,VSTR,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVLV",59,0)
 . . S TIUJ=0
"RTN","TIUSRVLV",60,0)
 . . F  S TIUJ=$O(^TIU(8925,"AVSTRV",DFN,VSTR,TIUI,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUSRVLV",61,0)
 . . . S TIUY=TIUY+1
"RTN","TIUSRVLV",62,0)
 Q
"RTN","TIUSRVP")
0^64^B62127442
"RTN","TIUSRVP",1,0)
TIUSRVP ; SLC/JER - Server calls to put data to TIU ; 5-APR-2001 13:54:31
"RTN","TIUSRVP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,7,19,28,47,89,104,100**;Jun 20, 1997
"RTN","TIUSRVP",3,0)
MAKE(SUCCESS,DFN,TITLE,VDT,VLOC,VSIT,TIUX,VSTR,SUPPRESS) ; New Document
"RTN","TIUSRVP",4,0)
 ; SUCCESS = (by ref) SUCCESS Returns TIU DOCUMENT # (PTR to 8925)
"RTN","TIUSRVP",5,0)
 ;         = 0^Explanatory message if no SUCCESS
"RTN","TIUSRVP",6,0)
 ; DFN     = Patient (#2)
"RTN","TIUSRVP",7,0)
 ; TITLE   = Pointer to TIU Document Definition (#8925.1)
"RTN","TIUSRVP",8,0)
 ; [VDT]   = Date(/Time) of Visit
"RTN","TIUSRVP",9,0)
 ; [VLOC]  = Visit Location (pointer to HOSPITAL LOCATION
"RTN","TIUSRVP",10,0)
 ; [VSIT]  = Pointer to visit file (#9000010)
"RTN","TIUSRVP",11,0)
 ; [VSTR]  = Visit string (i.e., VLOC;VDT;VTYPE)
"RTN","TIUSRVP",12,0)
 ; TIUX    = (by ref) array containing identifying fields, as
"RTN","TIUSRVP",13,0)
 ;           well as the body of the document
"RTN","TIUSRVP",14,0)
 ;
"RTN","TIUSRVP",15,0)
 ; -- first, get visit record and demographics (if not provided) --
"RTN","TIUSRVP",16,0)
 ;
"RTN","TIUSRVP",17,0)
 N TIU,TIUDA,LDT,NEWREC
"RTN","TIUSRVP",18,0)
 S SUCCESS=0 ; Initialize SUCCESS to false
"RTN","TIUSRVP",19,0)
 I +$G(VSIT) S VSTR=$$VSTRBLD(+VSIT)
"RTN","TIUSRVP",20,0)
 I $L($G(VSTR)) D
"RTN","TIUSRVP",21,0)
 . S VDT=$S(+$G(VDT):+$G(VDT),1:$P(VSTR,";",2))
"RTN","TIUSRVP",22,0)
 . S LDT=$S(+$G(VDT):$$FMADD^XLFDT(VDT,"","",1),1:"")
"RTN","TIUSRVP",23,0)
 . S VLOC=$S(+$G(VLOC):+$G(VLOC),1:$P(VSTR,";"))
"RTN","TIUSRVP",24,0)
 . ; If the note is for a Ward Location, call MAIN^TIUMOVE
"RTN","TIUSRVP",25,0)
 . I $P($G(^SC(+VLOC,0)),U,3)="W" D MAIN^TIUMOVE(.TIU,DFN,"",VDT,LDT,1,"LAST",0,+VLOC) Q
"RTN","TIUSRVP",26,0)
 . ; Otherwise, call PATVADPT^TIULV
"RTN","TIUSRVP",27,0)
 . D PATVADPT^TIULV(.TIU,DFN,"",VSTR)
"RTN","TIUSRVP",28,0)
 I '+$G(VSIT),'$L($G(VSTR)),+$G(VDT),+$G(VLOC) D
"RTN","TIUSRVP",29,0)
 . S VDT=$G(VDT),LDT=$S(+$G(VDT):$$FMADD^XLFDT(VDT,"","",1),1:"")
"RTN","TIUSRVP",30,0)
 . ; If the note is for a Ward Location, call MAIN^TIUMOVE
"RTN","TIUSRVP",31,0)
 . I $P($G(^SC(+VLOC,0)),U,3)="W" D MAIN^TIUMOVE(.TIU,DFN,"",VDT,LDT,1,"LAST",0,+VLOC) Q
"RTN","TIUSRVP",32,0)
 . ; Otherwise, call MAIN^TIUVSIT
"RTN","TIUSRVP",33,0)
 . D MAIN^TIUVSIT(.TIU,DFN,"",VDT,LDT,"LAST",0,VLOC)
"RTN","TIUSRVP",34,0)
 I '+$G(TIU("VSTR")) D
"RTN","TIUSRVP",35,0)
 . D EVENT^TIUSRVP1(.TIU,DFN)
"RTN","TIUSRVP",36,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S SUCCESS="0^"_$$EZBLD^DIALOG(89250001) Q
"RTN","TIUSRVP",37,0)
 ;
"RTN","TIUSRVP",38,0)
 ; -- second, get/create TIU Document record --
"RTN","TIUSRVP",39,0)
 ;
"RTN","TIUSRVP",40,0)
 S TIUDA=$$GETREC(DFN,.TIU,TITLE,.NEWREC)
"RTN","TIUSRVP",41,0)
 I +TIUDA'>0 S SUCCESS="0^"_$$EZBLD^DIALOG(89250002) Q
"RTN","TIUSRVP",42,0)
 S SUCCESS=+TIUDA
"RTN","TIUSRVP",43,0)
 ;
"RTN","TIUSRVP",44,0)
 ; -- third, file data in TIU Document record --
"RTN","TIUSRVP",45,0)
 ;
"RTN","TIUSRVP",46,0)
 D STUFREC^TIUSRVP1(+TIUDA,.TIUX,DFN,$G(PARENT),TITLE,.TIU)
"RTN","TIUSRVP",47,0)
 S ^TIU(8925,"ASAVE",DUZ,TIUDA)=""
"RTN","TIUSRVP",48,0)
 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",49,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUSRVP",50,0)
 D SETXT0(TIUDA)
"RTN","TIUSRVP",51,0)
 D FILE(.SUCCESS,+TIUDA,.TIUX,+$G(SUPPRESS))
"RTN","TIUSRVP",52,0)
 I +SUCCESS'>0 D DIK^TIURB2(TIUDA) Q
"RTN","TIUSRVP",53,0)
 I +$O(^TIU(8925,+TIUDA,"TEMP",0)) D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVP",54,0)
 I +$G(TIU("STOP")) D DEFER^TIUVSIT(TIUDA,TIU("STOP")) I 1
"RTN","TIUSRVP",55,0)
 E  D QUE^TIUPXAP1
"RTN","TIUSRVP",56,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",57,0)
 . D RELEASE^TIUT(TIUDA,1)
"RTN","TIUSRVP",58,0)
 . D UPDTIRT^TIUDIRT(.TIU,TIUDA) ; **47**
"RTN","TIUSRVP",59,0)
 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",60,0)
 Q
"RTN","TIUSRVP",61,0)
VSTRBLD(VSIT) ; Given a Visit Record, build Visit-Descriptor String
"RTN","TIUSRVP",62,0)
 N TIUY,VSIT0,VLOC,VDT,VSVCAT
"RTN","TIUSRVP",63,0)
 S VSIT0=$G(^AUPNVSIT(+VSIT,0)),VDT=+$P(VSIT0,U),VLOC=+$P(VSIT0,U,22)
"RTN","TIUSRVP",64,0)
 S VSVCAT=$P(VSIT0,U,7)
"RTN","TIUSRVP",65,0)
 S TIUY=VLOC_";"_VDT_";"_VSVCAT
"RTN","TIUSRVP",66,0)
 Q TIUY
"RTN","TIUSRVP",67,0)
SETXT0(TIUDA) ; Set root node of "TEMP" WP-field
"RTN","TIUSRVP",68,0)
 N TIUC,TIUI S (TIUC,TIUI)=0
"RTN","TIUSRVP",69,0)
 F  S TIUI=$O(^TIU(8925,TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVP",70,0)
 . S:$D(^TIU(8925,TIUDA,"TEMP",TIUI,0)) TIUC=TIUC+1
"RTN","TIUSRVP",71,0)
 S ^TIU(8925,TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVP",72,0)
 Q
"RTN","TIUSRVP",73,0)
MAKEADD(TIUDADD,TIUDA,TIUX,SUPPRESS) ; Create addendum record
"RTN","TIUSRVP",74,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUCAN,TIUFPRIV,TIU S TIUFPRIV=1
"RTN","TIUSRVP",75,0)
 S TIUCAN=$$CANDO^TIULP(TIUDA,"MAKE ADDENDUM")
"RTN","TIUSRVP",76,0)
 I TIUCAN'>0 S TIUDADD="0^You may not MAKE AN ADDENDUM for this "_$$STATUS^TIULC(TIUDA)_" "_$$PNAME^TIULC1(+$G(^TIU(8925,+TIUDA,0))) Q
"RTN","TIUSRVP",77,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUSRVP",78,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUSRVP",79,0)
 D ^DIC
"RTN","TIUSRVP",80,0)
 S TIUDADD=+Y
"RTN","TIUSRVP",81,0)
 I +Y'>0 S TIUDADD=TIUDADD_"^Could not create addendum." Q
"RTN","TIUSRVP",82,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVP",83,0)
 S TIU("DOCTYP")=TIUATYP_U_$$PNAME^TIULC1(TIUATYP)
"RTN","TIUSRVP",84,0)
 D STUFREC^TIUSRVP1(+TIUDA,.TIUX,DFN,+$G(TIUDA),TIUATYP,.TIU)
"RTN","TIUSRVP",85,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUSRVP",86,0)
 M ^TIU(8925,+TIUDADD,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUSRVP",87,0)
 D SETXT0(+TIUDADD)
"RTN","TIUSRVP",88,0)
 D FILE(.SUCCESS,+TIUDADD,.TIUX,+$G(SUPPRESS))
"RTN","TIUSRVP",89,0)
 I +SUCCESS'>0 D DIK^TIURB2(TIUDADD) Q
"RTN","TIUSRVP",90,0)
 I +$O(^TIU(8925,+TIUDADD,"TEMP",0)) D MERGTEXT^TIUEDI1(+TIUDADD,.TIU)
"RTN","TIUSRVP",91,0)
 I '+$G(SUPPRESS) D RELEASE^TIUT(+TIUDADD,1)
"RTN","TIUSRVP",92,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUSRVP",93,0)
 Q
"RTN","TIUSRVP",94,0)
UPDATE(SUCCESS,TIUDA,TIUX,SUPPRESS) ; Update existing TIU Document
"RTN","TIUSRVP",95,0)
 N TIU,TIUI,TIUC,TIUD0,TIUD12,TIUD15,TIURCS
"RTN","TIUSRVP",96,0)
 I +$P($G(^TIU(8925,+TIUDA,0)),U,5)>6 D  Q
"RTN","TIUSRVP",97,0)
 . S SUCCESS="0^ TIU Document #"_TIUDA_" is already signed..."
"RTN","TIUSRVP",98,0)
 I $D(TIUX("TEXT")) D
"RTN","TIUSRVP",99,0)
 . K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",100,0)
 . M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT")
"RTN","TIUSRVP",101,0)
 . S (TIUC,TIUI)=0
"RTN","TIUSRVP",102,0)
 . F  S TIUI=$O(^TIU(8925,+TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVP",103,0)
 . . S TIUC=TIUC+1
"RTN","TIUSRVP",104,0)
 . I +TIUC>0 S ^TIU(8925,+TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVP",105,0)
 . K TIUX("TEXT")
"RTN","TIUSRVP",106,0)
 I +$O(TIUX(""))'>0 S:+$G(SUPPRESS) SUCCESS=+TIUDA Q
"RTN","TIUSRVP",107,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUSRVP",108,0)
 D REQCOS^TIUSRVA(.TIURCS,+TIUD0,"",$S(+$G(TIUX(1202)):+$G(TIUX(1202)),+$P(TIUD12,U,2):+$P(TIUD12,U,2),1:DUZ))
"RTN","TIUSRVP",109,0)
 I +TIURCS S TIUX(1506)=1
"RTN","TIUSRVP",110,0)
 ; If title is changed, refile Document class
"RTN","TIUSRVP",111,0)
 I +$G(TIUX(.01))>0,(+$G(TIUX(.01))'=+TIUD0) D
"RTN","TIUSRVP",112,0)
 . S TIUX(.04)=$$DOCCLASS^TIULC1(+$G(TIUX(.01)))
"RTN","TIUSRVP",113,0)
 D FILE(.SUCCESS,+TIUDA,.TIUX,+$G(SUPPRESS))
"RTN","TIUSRVP",114,0)
 I +SUCCESS'>0 K ^TIU(8925,+TIUDA,"TEMP") Q
"RTN","TIUSRVP",115,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVP",116,0)
 I $D(^TIU(8925,+TIUDA,"TEMP")) D
"RTN","TIUSRVP",117,0)
 . K ^TIU(8925,+TIUDA,"TEXT")
"RTN","TIUSRVP",118,0)
 . D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVP",119,0)
 . K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",120,0)
 . S:'+$G(SUCCESS) SUCCESS=+TIUDA
"RTN","TIUSRVP",121,0)
 ; If document is signed re-file /ES/
"RTN","TIUSRVP",122,0)
 S TIUD15=$G(^TIU(8925,+TIUDA,15))
"RTN","TIUSRVP",123,0)
 I +TIUD15 D
"RTN","TIUSRVP",124,0)
 . N TIUBY,DR,DIE,DA,X,Y S TIUBY=$P(TIUD15,U,2) Q:+TIUBY'>0
"RTN","TIUSRVP",125,0)
 . S DR="1503///^S X=$$SIGNAME^TIULS("_TIUBY_");1504///^S X=$$SIGTITL^TIULS("_TIUBY_")"
"RTN","TIUSRVP",126,0)
 . S DA=TIUDA,DIE=8925 D ^DIE
"RTN","TIUSRVP",127,0)
 ; Evaluate/send alerts
"RTN","TIUSRVP",128,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",129,0)
 . I +$P(TIUD0,U,5)<5,'$D(TIUX(.05)) D UPDSTAT(TIUDA,+$G(TIUD0))
"RTN","TIUSRVP",130,0)
 . D SEND^TIUALRT(TIUDA),SENDID^TIUALRT1(TIUDA):+$G(^TIU(8925,+TIUDA,21))
"RTN","TIUSRVP",131,0)
 . D UPDTIRT^TIUDIRT(.TIU,TIUDA)
"RTN","TIUSRVP",132,0)
 Q
"RTN","TIUSRVP",133,0)
UPDSTAT(DA,TITLE)       ; Update the status on commitment
"RTN","TIUSRVP",134,0)
 N DR,DIE S DR=".05////"_$$STATUS^TIUSRVP1(DA,0,TITLE)
"RTN","TIUSRVP",135,0)
 I '+$P($G(^TIU(8925,DA,13)),U,4) S DR=DR_";1304////^S X=$$NOW^XLFDT"
"RTN","TIUSRVP",136,0)
 S DIE=8925
"RTN","TIUSRVP",137,0)
 D ^DIE
"RTN","TIUSRVP",138,0)
 Q
"RTN","TIUSRVP",139,0)
GETREC(DFN,TIU,TITLE,TIUNEW) ; Get or create document record
"RTN","TIUSRVP",140,0)
 N DA,DIC,DIE,DLAYGO,DR,X,Y,TIUDPRM,TIUFPRIV,TIUHIT,TIUSCAT
"RTN","TIUSRVP",141,0)
 S (TIUHIT,DA)=0,TIUFPRIV=1
"RTN","TIUSRVP",142,0)
 S (DIC,DLAYGO)=8925,DIC(0)="FL"
"RTN","TIUSRVP",143,0)
 ; S DIC("S")="I +$G(DFN)=+$P(^TIU(8925,+Y,0),U,2),(+$G(TIU(""VISIT""))=+$P(^TIU(8925,+Y,0),U,3))"
"RTN","TIUSRVP",144,0)
 S X=""""_"`"_+TITLE_"""" D ^DIC K DIC("S")
"RTN","TIUSRVP",145,0)
 I +Y'>0 Q Y_U_" Insufficient data to create a new record."
"RTN","TIUSRVP",146,0)
 S DA=+Y,TIUNEW=+$P(Y,U,3)
"RTN","TIUSRVP",147,0)
 N DIE,DR,TIUVISIT S DIE=8925
"RTN","TIUSRVP",148,0)
 S TIUVISIT=$S(+$G(TIU("VISIT")):+$G(TIU("VISIT")),1:"")
"RTN","TIUSRVP",149,0)
 S TIUSCAT=$S(+$L($P($G(TIU("CAT")),U)):$P($G(TIU("CAT")),U),+$L($P($G(TIU("VSTR")),";",3)):$P($G(TIU("VSTR")),";",3),1:"")
"RTN","TIUSRVP",150,0)
 S DR=".04////"_$$DOCCLASS^TIULC1(+$P(Y,U,2))_";.13////"_TIUSCAT_";1205////"_$P($G(TIU("LOC")),U)_";1211////"_$P($G(TIU("VLOC")),U)
"RTN","TIUSRVP",151,0)
 D ^DIE
"RTN","TIUSRVP",152,0)
 Q +$G(DA)
"RTN","TIUSRVP",153,0)
FILE(SUCCESS,TIUDA,TIUX,SUPPRESS) ; Call FM Filer & commit updates
"RTN","TIUSRVP",154,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIUCMMTX
"RTN","TIUSRVP",155,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS=""
"RTN","TIUSRVP",156,0)
 I +$G(TIUX(1202)) S TIUX(1204)=+$G(TIUX(1202))
"RTN","TIUSRVP",157,0)
 M @FDARR=TIUX
"RTN","TIUSRVP",158,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUSRVP",159,0)
 I $D(TIUMSG)>9 S SUCCESS=0_U_$G(TIUMSG("DIERR",1,"TEXT",1)) Q
"RTN","TIUSRVP",160,0)
 S SUCCESS=TIUDA
"RTN","TIUSRVP",161,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",162,0)
 . N DA
"RTN","TIUSRVP",163,0)
 . S DA=TIUDA
"RTN","TIUSRVP",164,0)
 . S TIUCMMTX=$$COMMIT^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUSRVP",165,0)
 . I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUSRVP",166,0)
 . K ^TIU(8925,"ASAVE",DUZ,TIUDA)
"RTN","TIUSRVP",167,0)
 Q
"RTN","TIUSRVP",168,0)
SIGN(ERR,TIUDA,TIUX) ; API for /es/
"RTN","TIUSRVP",169,0)
 N X,TIUACT,TIUSIGN,TIUD0,TIUD12,TIUSTAT,SIGNER,COSIGNER,VALID,XTRASGNR
"RTN","TIUSRVP",170,0)
 N TIUES S ERR=0
"RTN","TIUSRVP",171,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIUSRVP",172,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8)
"RTN","TIUSRVP",173,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVP",174,0)
 S TIUSTAT=+$P(TIUD0,U,5)
"RTN","TIUSRVP",175,0)
 S TIUACT=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIUSRVP",176,0)
 S TIUSIGN=$$CANDO^TIULP(TIUDA,TIUACT)
"RTN","TIUSRVP",177,0)
 I +TIUSIGN'>0 S ERR="89250004^"_$P(TIUSIGN,U,2) Q
"RTN","TIUSRVP",178,0)
 S VALID=$$VALIDATE($$DECRYP^XUSRB1(TIUX))
"RTN","TIUSRVP",179,0)
 I +VALID'>0 S ERR="89250005^"_$$EZBLD^DIALOG(89250005) Q
"RTN","TIUSRVP",180,0)
 S TIUES=1_U_$P($G(^VA(200,+DUZ,20)),U,2,3)
"RTN","TIUSRVP",181,0)
 I '+$G(XTRASGNR) D ES^TIURS(TIUDA,TIUES)
"RTN","TIUSRVP",182,0)
 I +$G(XTRASGNR) D ADDSIG^TIURS1(TIUDA,XTRASGNR)
"RTN","TIUSRVP",183,0)
 I +$G(^TIU(8925,TIUDA,21)),(TIUACT="SIGNATURE") D AUDLINK^TIUGR1(TIUDA,"a",+$G(^(21)))
"RTN","TIUSRVP",184,0)
 Q
"RTN","TIUSRVP",185,0)
VALIDATE(X) ; Validate /es/-code
"RTN","TIUSRVP",186,0)
 N TIUY S TIUY=0
"RTN","TIUSRVP",187,0)
 D HASH^XUSHSHP I X]"",(X=$P($G(^VA(200,+DUZ,20)),U,4)) S TIUY=1
"RTN","TIUSRVP",188,0)
 Q TIUY
"RTN","TIUSRVP",189,0)
DELETE(ERR,TIUDA,TIURSN) ; API for record deletion
"RTN","TIUSRVP",190,0)
 N TIUDEL,TIUD0 S ERR=0,TIUDEL=$$CANDO^TIULP(TIUDA,"DELETE RECORD")
"RTN","TIUSRVP",191,0)
 I TIUDEL'>0 S ERR="89250003^"_$$EZBLD^DIALOG(89250003) Q
"RTN","TIUSRVP",192,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVP",193,0)
 I +$P(TIUD0,U,5)'<6 D  Q
"RTN","TIUSRVP",194,0)
 . S TIURSN=$G(TIURSN,"A")
"RTN","TIUSRVP",195,0)
 . D DELTEXT^TIURB2(TIUDA,TIURSN)
"RTN","TIUSRVP",196,0)
 D DIK^TIURB2(TIUDA)
"RTN","TIUSRVP",197,0)
 D DELAUDIT^TIUEDI1(TIUDA)
"RTN","TIUSRVP",198,0)
 Q
"RTN","TIUSRVP",199,0)
LOCK(ERR,TIUDA) ; Bid for lock on a TIU Document record
"RTN","TIUSRVP",200,0)
 L +^TIU(8925,+TIUDA):1 I  S ERR=0
"RTN","TIUSRVP",201,0)
 E  S ERR="1^ Another session has this record locked."
"RTN","TIUSRVP",202,0)
 Q
"RTN","TIUSRVP",203,0)
UNLOCK(ERR,TIUDA) ; Decrement Lock on a TIU Document record
"RTN","TIUSRVP",204,0)
 L -^TIU(8925,+TIUDA) S ERR=0
"RTN","TIUSRVP",205,0)
 Q
"RTN","TIUSRVP1")
0^55^B33298781
"RTN","TIUSRVP1",1,0)
TIUSRVP1 ; SLC/JER - More API's in support of PUT ;10-APR-2001 17:15:12
"RTN","TIUSRVP1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,59,89,100**;Jun 20, 1997
"RTN","TIUSRVP1",3,0)
SITEPARM(TIUY) ; Get site parameters for GUI
"RTN","TIUSRVP1",4,0)
 N TIUPRM0,TIUPRM1
"RTN","TIUSRVP1",5,0)
 D SETPARM^TIULE
"RTN","TIUSRVP1",6,0)
 S TIUY=TIUPRM0
"RTN","TIUSRVP1",7,0)
 Q
"RTN","TIUSRVP1",8,0)
DEFDOC(TIUY,HLOC,USER,TIUDT,TIUIEN) ; Get default primary provider
"RTN","TIUSRVP1",9,0)
 N TIUSPRM,TIUDDOC,TIUAUTH
"RTN","TIUSRVP1",10,0)
 D SITEPARM(.TIUSPRM)
"RTN","TIUSRVP1",11,0)
 S TIUDDOC=+$P(TIUSPRM,U,8)
"RTN","TIUSRVP1",12,0)
 S TIUAUTH=$S((+$G(USER)!('+$G(TIUIEN))):0,1:+$P($G(^TIU(8925,+$G(TIUIEN),12)),U,2))
"RTN","TIUSRVP1",13,0)
 S USER=$S(+$G(USER):+$G(USER),+$G(TIUAUTH):+$G(TIUAUTH),1:DUZ)
"RTN","TIUSRVP1",14,0)
 S TIUDT=$S(+$G(TIUDT):+$G(TIUDT),1:DT)
"RTN","TIUSRVP1",15,0)
 S TIUY=$S(TIUDDOC=1:$$DFLTDOC^TIUPXAPI(HLOC),TIUDDOC=2:$$CURDOC(USER),1:"0^")
"RTN","TIUSRVP1",16,0)
 Q
"RTN","TIUSRVP1",17,0)
CURDOC(USER,TIUDT) ; Is the current user a known Provider?
"RTN","TIUSRVP1",18,0)
 N TIUY,TIUPROV S TIUY="0^"
"RTN","TIUSRVP1",19,0)
 S USER=$S(+$G(USER):+$G(USER),1:DUZ)
"RTN","TIUSRVP1",20,0)
 S TIUDT=$S(+$G(TIUDT):+$G(TIUDT),1:DT)
"RTN","TIUSRVP1",21,0)
 S TIUPROV=$$PROVIDER^TIUPXAP1(USER,TIUDT)
"RTN","TIUSRVP1",22,0)
 I +TIUPROV S TIUY=USER_U_$$PERSNAME^TIULC1(USER)
"RTN","TIUSRVP1",23,0)
 Q TIUY
"RTN","TIUSRVP1",24,0)
ISAPROV(TIUY,USER,DATE) ; Is user a provider?
"RTN","TIUSRVP1",25,0)
 S USER=$G(USER,DUZ)
"RTN","TIUSRVP1",26,0)
 S DATE=$G(DATE,DT)
"RTN","TIUSRVP1",27,0)
 S TIUY=$$PROVIDER^TIUPXAP1(USER,DATE)
"RTN","TIUSRVP1",28,0)
 Q
"RTN","TIUSRVP1",29,0)
DOCPARM(TIUY,TIUDA,TIUTYP) ; Get document parameters for GUI
"RTN","TIUSRVP1",30,0)
 I '+$G(TIUTYP),+$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVP1",31,0)
 I '+$G(TIUTYP) S TIUY(0)="" Q
"RTN","TIUSRVP1",32,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUY,$G(TIUDA))
"RTN","TIUSRVP1",33,0)
 I '$D(TIUY) S TIUY(0)=""
"RTN","TIUSRVP1",34,0)
 Q
"RTN","TIUSRVP1",35,0)
CONSTUB(TIUDA,GMRCVP,DFN) ; Create a stub for a Consult Report
"RTN","TIUSRVP1",36,0)
 N DIE,DR,DA
"RTN","TIUSRVP1",37,0)
 D STUB(.TIUDA,"CONSULT REPORT",DFN)
"RTN","TIUSRVP1",38,0)
 I +TIUDA'>0 Q
"RTN","TIUSRVP1",39,0)
 S DIE=8925,DA=+TIUDA,DR="1405////^S X=GMRCVP"
"RTN","TIUSRVP1",40,0)
 D ^DIE
"RTN","TIUSRVP1",41,0)
 Q
"RTN","TIUSRVP1",42,0)
STUB(TIUDA,TIUTITL,DFN) ; Create a stub
"RTN","TIUSRVP1",43,0)
 N TIUVSIT,TIUFPRIV,DIC,DIE,DR,DA,DLAYGO,X,Y S TIUFPRIV=1
"RTN","TIUSRVP1",44,0)
 I +$G(TIUTITL)'>0 S TIUTITL=$$WHATITLE^TIUPUTU(TIUTITL)
"RTN","TIUSRVP1",45,0)
 I +TIUTITL'>0 S TIUDA=-1 Q
"RTN","TIUSRVP1",46,0)
 S (DIC,DLAYGO)=8925,DIC(0)="LF"
"RTN","TIUSRVP1",47,0)
 S X=""""_"`"_+TIUTITL_""""
"RTN","TIUSRVP1",48,0)
 D ^DIC S TIUDA=+Y Q:+Y'>0
"RTN","TIUSRVP1",49,0)
 D EVENT(.TIU,DFN) I $L($G(TIU("VSTR")))'>0 S TIUDA=-1 Q
"RTN","TIUSRVP1",50,0)
 S DIE=DIC,DA=TIUDA
"RTN","TIUSRVP1",51,0)
 S DR=".02////"_+DFN_";.03////"_$P($G(TIU("VISIT")),U)_";.04////"_+$$DOCCLASS^TIULC1(TIUTITL)_";.05///UNDICTATED;.13////E;1301////"_+$$NOW^XLFDT
"RTN","TIUSRVP1",52,0)
 D ^DIE
"RTN","TIUSRVP1",53,0)
 Q
"RTN","TIUSRVP1",54,0)
EVENT(TIUY,DFN) ; Create an Event-type Visit Entry
"RTN","TIUSRVP1",55,0)
 N VDT,VSTR,DGPM
"RTN","TIUSRVP1",56,0)
 S DGPM=$G(^DPT(DFN,.105))
"RTN","TIUSRVP1",57,0)
 I +DGPM'>0 D
"RTN","TIUSRVP1",58,0)
 . S VDT=$$NOW^XLFDT
"RTN","TIUSRVP1",59,0)
 . S VSTR=";"_VDT_";"_"E"
"RTN","TIUSRVP1",60,0)
 D PATVADPT^TIULV(.TIUY,+DFN,DGPM,$G(VSTR))
"RTN","TIUSRVP1",61,0)
 I $G(TIUY("LOC"))="",+DUZ D
"RTN","TIUSRVP1",62,0)
 .N TIUPREF,IDX
"RTN","TIUSRVP1",63,0)
 .S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUSRVP1",64,0)
 .S IDX=+$P(TIUPREF,U,2)
"RTN","TIUSRVP1",65,0)
 .I IDX S TIUY("LOC")=IDX_U_$P($G(^SC(IDX,0)),U,1)
"RTN","TIUSRVP1",66,0)
 Q
"RTN","TIUSRVP1",67,0)
GETPNAME(TIUY,TIUTYPE)  ; Get Print Name of a Document
"RTN","TIUSRVP1",68,0)
 S TIUY=$$PNAME^TIULC1(TIUTYPE)
"RTN","TIUSRVP1",69,0)
 Q
"RTN","TIUSRVP1",70,0)
SAVED(TIUY,TIUDA) ; Was the document committed to the database?
"RTN","TIUSRVP1",71,0)
 N TIUD12,TIUD13,TIUEBY,TIUAUT,TIUECS S TIUY=1
"RTN","TIUSRVP1",72,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12)),TIUD13=$G(^(13))
"RTN","TIUSRVP1",73,0)
 S TIUEBY=$P(TIUD13,U,2),TIUAUT=$P(TIUD12,U,2),TIUECS=$P(TIUD12,U,8)
"RTN","TIUSRVP1",74,0)
 I $D(^TIU(8925,"ASAVE",+DUZ,TIUDA)) D  Q
"RTN","TIUSRVP1",75,0)
 . S TIUY="0^You appear to have been disconnected..."
"RTN","TIUSRVP1",76,0)
 I DUZ'=TIUEBY,(TIUEBY'=TIUAUT),$D(^TIU(8925,"ASAVE",+TIUEBY,TIUDA)) D  Q
"RTN","TIUSRVP1",77,0)
 . S TIUY="0^The transcriber appears to have been disconnected..."
"RTN","TIUSRVP1",78,0)
 I DUZ'=TIUAUT,$D(^TIU(8925,"ASAVE",+TIUAUT,TIUDA)) D  Q
"RTN","TIUSRVP1",79,0)
 . S TIUY="0^The author appears to have been disconnected..."
"RTN","TIUSRVP1",80,0)
 I DUZ'=TIUECS,$D(^TIU(8925,"ASAVE",+TIUECS,TIUDA)) D  Q
"RTN","TIUSRVP1",81,0)
 . S TIUY="0^The expected cosigner appears to have been disconnected..."
"RTN","TIUSRVP1",82,0)
 Q
"RTN","TIUSRVP1",83,0)
STUFREC(TIUDA,TIUREC,DFN,PARENT,TITLE,TIU) ; load TIUREC for create
"RTN","TIUSRVP1",84,0)
 N TIUREQCS,TIUSCAT,TIUSTAT
"RTN","TIUSRVP1",85,0)
 S TIUSTAT=$$STATUS(TIUDA,+$G(SUPPRESS),$G(TITLE))
"RTN","TIUSRVP1",86,0)
 D REQCOS^TIUSRVA(.TIUREQCS,+TITLE,"",$S(+$G(TIUREC(1202)):+$G(TIUREC(1202)),1:DUZ))
"RTN","TIUSRVP1",87,0)
 I +$G(PARENT)'>0 D
"RTN","TIUSRVP1",88,0)
 . S TIUREC(.02)=$G(DFN),TIUREC(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUSRVP1",89,0)
 . S TIUREC(.05)=$S(+$G(TIUREC(.05)):+$G(TIUREC(.05)),+TIUSTAT:TIUSTAT,1:5)
"RTN","TIUSRVP1",90,0)
 . S TIUREC(.07)=$P($G(TIU("EDT")),U),TIUREC(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUSRVP1",91,0)
 . S TIUREC(1401)=$P($G(TIU("AD#")),U)
"RTN","TIUSRVP1",92,0)
 . S TIUREC(1402)=$P($G(TIU("TS")),U)
"RTN","TIUSRVP1",93,0)
 . S TIUREC(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUSRVP1",94,0)
 I +$G(PARENT)>0 D
"RTN","TIUSRVP1",95,0)
 . S TIUREC(.02)=+$P($G(^TIU(8925,+PARENT,0)),U,2)
"RTN","TIUSRVP1",96,0)
 . S TIUREC(.03)=+$P($G(^TIU(8925,+PARENT,0)),U,3)
"RTN","TIUSRVP1",97,0)
 . S TIUREC(.05)=$S(+$G(TIUREC(.05)):+$G(TIUREC(.05)),+TIUSTAT:TIUSTAT,1:5)
"RTN","TIUSRVP1",98,0)
 . S TIUREC(.06)=PARENT,TIUREC(.07)=$P(TIU("EDT"),U)
"RTN","TIUSRVP1",99,0)
 . S TIUREC(.08)=$P(TIU("LDT"),U)
"RTN","TIUSRVP1",100,0)
 . S TIUREC(1401)=$P($G(^TIU(8925,+PARENT,14)),U)
"RTN","TIUSRVP1",101,0)
 . S TIUREC(1402)=$P($G(^TIU(8925,+PARENT,14)),U,2)
"RTN","TIUSRVP1",102,0)
 . S TIUREC(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUSRVP1",103,0)
 S TIUREC(.04)=$$DOCCLASS^TIULC1(TITLE)
"RTN","TIUSRVP1",104,0)
 S TIUSCAT=$S(+$L($P($G(TIU("CAT")),U)):$P($G(TIU("CAT")),U),+$L($P($G(TIU("VSTR")),";",3)):$P($G(TIU("VSTR")),";",3),1:"")
"RTN","TIUSRVP1",105,0)
 S TIUREC(.13)=TIUSCAT
"RTN","TIUSRVP1",106,0)
 S (TIUREC(1202),TIUREC(1204))=$S(+$G(TIUREC(1202)):+$G(TIUREC(1202)),1:+$G(DUZ))
"RTN","TIUSRVP1",107,0)
 S TIUREC(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUSRVP1",108,0)
 S TIUREC(1211)=$P($G(TIU("VLOC")),U)
"RTN","TIUSRVP1",109,0)
 S TIUREC(1201)=$$NOW^XLFDT
"RTN","TIUSRVP1",110,0)
 S TIUREC(1301)=$S($G(TIUREC(1301))]"":$P(TIUREC(1301),U),1:$$NOW^XLFDT)
"RTN","TIUSRVP1",111,0)
 I +$$ISDS^TIULX(TITLE) D
"RTN","TIUSRVP1",112,0)
 . I +$G(TIU("LDT"))'>0 S TIUREC(.12)=1
"RTN","TIUSRVP1",113,0)
 . S TIUREC(.13)="H"
"RTN","TIUSRVP1",114,0)
 . D REFDT(.TIUREC)
"RTN","TIUSRVP1",115,0)
 S TIUREC(1303)="R",TIUREC(1302)=$G(DUZ)
"RTN","TIUSRVP1",116,0)
 I $S(+$G(TIUREC(1208)):1,+$G(TIUREQCS):1,1:0) S TIUREC(1506)=1
"RTN","TIUSRVP1",117,0)
 Q
"RTN","TIUSRVP1",118,0)
REFDT(TIUX) ; Hack Ref Date/time for DS's
"RTN","TIUSRVP1",119,0)
 S TIUX(1301)=$S(+$G(TIU("LDT")):+$G(TIU("LDT")),1:$G(TIUX(1301)))
"RTN","TIUSRVP1",120,0)
 Q
"RTN","TIUSRVP1",121,0)
STATUS(TIUDA,SUPPRESS,TITLE)  ; Compute the status of the current record
"RTN","TIUSRVP1",122,0)
 N TIUDPRM,TIUY
"RTN","TIUSRVP1",123,0)
 ; If the document is an addendum, compute status based on processing
"RTN","TIUSRVP1",124,0)
 ; requirements of the Parent document or its ancestors
"RTN","TIUSRVP1",125,0)
 I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=+$P(^TIU(8925,TIUDA,0),U,6)
"RTN","TIUSRVP1",126,0)
 D DOCPRM^TIULC1(TITLE,.TIUDPRM,$G(TIUDA))
"RTN","TIUSRVP1",127,0)
 I +$P(TIUDPRM(0),U,2),+$G(SUPPRESS) S TIUY=3 G STATUX
"RTN","TIUSRVP1",128,0)
 S TIUY=$S(+$$REQVER^TIULC(+TIUDA,+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUSRVP1",129,0)
STATUX Q TIUY
"RTN","TIUSRVP1",130,0)
IDATTCH(TIUY,TIUDA,TIUDAD) ; Attach TIUDA as ID Child entry to TIUDAD
"RTN","TIUSRVP1",131,0)
 N TIUX
"RTN","TIUSRVP1",132,0)
 S TIUX(2101)=TIUDAD
"RTN","TIUSRVP1",133,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX,1)
"RTN","TIUSRVP1",134,0)
 D AUDLINK^TIUGR1(TIUDA,"a",TIUDAD)
"RTN","TIUSRVP1",135,0)
 D SENDID^TIUALRT1(TIUDA)
"RTN","TIUSRVP1",136,0)
 Q
"RTN","TIUSRVP1",137,0)
IDDTCH(TIUY,TIUDA) ; Detach TIUDA from its ID Parent
"RTN","TIUSRVP1",138,0)
 N TIUX,IDDAD
"RTN","TIUSRVP1",139,0)
 I '+$G(^TIU(8925,TIUDA,21)) D  Q
"RTN","TIUSRVP1",140,0)
 . S TIUY="0^Record #"_TIUDA_" is NOT an ID Entry."
"RTN","TIUSRVP1",141,0)
 S IDDAD=+$G(^TIU(8925,TIUDA,21))
"RTN","TIUSRVP1",142,0)
 S TIUX(2101)="@"
"RTN","TIUSRVP1",143,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX,1)
"RTN","TIUSRVP1",144,0)
 D AUDLINK^TIUGR1(TIUDA,"d",IDDAD)
"RTN","TIUSRVP1",145,0)
 D IDDEL^TIUALRT1(TIUDA)
"RTN","TIUSRVP1",146,0)
 Q
"RTN","TIUSRVR1")
0^62^B22989539
"RTN","TIUSRVR1",1,0)
TIUSRVR1 ; SLC/JER - RPC for record-wise GET ;23-MAR-2001 17:21:18
"RTN","TIUSRVR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,32,87,89,100**;Jun 20, 1997
"RTN","TIUSRVR1",3,0)
TGET(TIUY,TIUDA,ACTION) ; Build ^TMP("TIUVIEW",$J,
"RTN","TIUSRVR1",4,0)
 N TIUL,TIUREC,TIUARR,TIUGDATA,TIUNAME,TIUPRM0,TIUPRM1,X,Y
"RTN","TIUSRVR1",5,0)
 K ^TMP("TIUVIEW",$J),^TMP("TIU FOCUS",$J)
"RTN","TIUSRVR1",6,0)
 S ACTION=$G(ACTION,"VIEW"),TIUL=0
"RTN","TIUSRVR1",7,0)
 D SETPARM^TIULE
"RTN","TIUSRVR1",8,0)
 S TIUGDATA=$$SETGDATA(TIUDA)
"RTN","TIUSRVR1",9,0)
 I +$D(^TIU(8925,TIUDA,"TEMP")) D MERGTEXT^TIUSRVR(TIUDA)
"RTN","TIUSRVR1",10,0)
 S TIUY=$NA(^TMP("TIUVIEW",$J))
"RTN","TIUSRVR1",11,0)
 S TIUARR="^TMP(""TIUVIEW"",$J)"
"RTN","TIUSRVR1",12,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUSRVR1",13,0)
 ; Initialize ^TMP("TIU FOCUS",$J) to the entry that has focus
"RTN","TIUSRVR1",14,0)
 S ^TMP("TIU FOCUS",$J)=TIUDA
"RTN","TIUSRVR1",15,0)
 ; Call INQUIRE to get record
"RTN","TIUSRVR1",16,0)
 D INQUIRE^TIUSRVR2(TIUDA,.TIUREC)
"RTN","TIUSRVR1",17,0)
 ; First, load dictation, transcription data, etc.
"RTN","TIUSRVR1",18,0)
 D LOADTOP(.TIUREC,TIUDA,.TIUL,TIUGDATA)
"RTN","TIUSRVR1",19,0)
 ; Next, load the remainder of the record
"RTN","TIUSRVR1",20,0)
 D LOADREC^TIUSRVR2(TIUDA,.TIUL,TIUGDATA,0,ACTION)
"RTN","TIUSRVR1",21,0)
 K ^TMP("TIU FOCUS",$J)
"RTN","TIUSRVR1",22,0)
 S VALMCNT=+$G(TIUL)
"RTN","TIUSRVR1",23,0)
 Q
"RTN","TIUSRVR1",24,0)
SETGDATA(TIUDA) ; Set TIUGDATA
"RTN","TIUSRVR1",25,0)
 N TIUY,SORT S TIUY=""
"RTN","TIUSRVR1",26,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,TIUDA,0)),.TIUDPRM,TIUDA)
"RTN","TIUSRVR1",27,0)
 S SORT=$S(+$P(TIUDPRM(0),U,18):"TITLE",1:"REFDT")
"RTN","TIUSRVR1",28,0)
 I +$G(^TIU(8925,TIUDA,21)) S TIUY=TIUDA_U_0_U_+$G(^(21))_U_SORT G SETGX
"RTN","TIUSRVR1",29,0)
 I +$O(^TIU(8925,"GDAD",TIUDA,0)) S TIUY=TIUDA_U_1_U_0_U_SORT
"RTN","TIUSRVR1",30,0)
SETGX Q TIUY
"RTN","TIUSRVR1",31,0)
LOADTOP(TIUREC,TIUDA,TIUL,TIUGDATA) ; Load top information
"RTN","TIUSRVR1",32,0)
 N TIUY,SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT
"RTN","TIUSRVR1",33,0)
 ; ---- For ID note, include Title, [Location, & Visit] with each
"RTN","TIUSRVR1",34,0)
 ;      entry, since they vary by entry.
"RTN","TIUSRVR1",35,0)
 ; ---- Follow with Date, Author, etc.
"RTN","TIUSRVR1",36,0)
 ; ---- For ID children in whole note display, shorten top info:
"RTN","TIUSRVR1",37,0)
 ;      Instead of Title, Location, Visit, Date, Author, etc.,
"RTN","TIUSRVR1",38,0)
 ;      use just Title, followed by just Date and Status:
"RTN","TIUSRVR1",39,0)
 S (SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT)=0
"RTN","TIUSRVR1",40,0)
 I $P(TIUGDATA,U,3) S SELCHLD=1 ; Selected record was IDchild
"RTN","TIUSRVR1",41,0)
 I $P(TIUGDATA,U,2) S SELPRNT=1
"RTN","TIUSRVR1",42,0)
 I SELCHLD,TIUDA'=$P(TIUGDATA,U,3) S CURCHLD=1 ; Current rec is IDchild
"RTN","TIUSRVR1",43,0)
 I SELCHLD,TIUDA=$P(TIUGDATA,U,3) S CURPRNT=1
"RTN","TIUSRVR1",44,0)
 I SELPRNT,TIUDA=+TIUGDATA S CURPRNT=1
"RTN","TIUSRVR1",45,0)
 I SELPRNT,TIUDA'=+TIUGDATA S CURCHLD=1
"RTN","TIUSRVR1",46,0)
 I SELPRNT,CURCHLD S SHORT=1 ;Child in whole note: shorten top info
"RTN","TIUSRVR1",47,0)
 I SELCHLD,CURCHLD,$G(TIUGWHOL) S SHORT=1
"RTN","TIUSRVR1",48,0)
 I SELCHLD!SELPRNT D IDTOP(TIUDA,.TIUL,SHORT,CURPRNT) I 1
"RTN","TIUSRVR1",49,0)
 S TIUY=""
"RTN","TIUSRVR1",50,0)
 E  I $L(TIUREC(8925,+TIUDA,.01)) D
"RTN","TIUSRVR1",51,0)
 . S TIUY=$$SETSTR^VALM1("TITLE: "_TIUREC(8925,+TIUDA,.01),TIUY,8,64)
"RTN","TIUSRVR1",52,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",53,0)
 S TIUY=""
"RTN","TIUSRVR1",54,0)
 I SHORT D
"RTN","TIUSRVR1",55,0)
 . S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),TIUY,1,39)
"RTN","TIUSRVR1",56,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),TIUY,42,38)
"RTN","TIUSRVR1",57,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",58,0)
 S TIUY=""
"RTN","TIUSRVR1",59,0)
 I 'SHORT D
"RTN","TIUSRVR1",60,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUSRVR1",61,0)
 . . S TIUY=$$SETSTR^VALM1("DICT DATE: "_TIUREC(8925,+TIUDA,1307),TIUY,4,39)
"RTN","TIUSRVR1",62,0)
 . E  S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),TIUY,1,39)
"RTN","TIUSRVR1",63,0)
 . S TIUY=$$SETSTR^VALM1("ENTRY DATE: "_TIUREC(8925,+TIUDA,1201),$G(TIUY),38,39)
"RTN","TIUSRVR1",64,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",65,0)
 . S TIUY=""
"RTN","TIUSRVR1",66,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUSRVR1",67,0)
 . . S TIUY=$$SETSTR^VALM1("DICTATED BY: "_TIUREC(8925,+TIUDA,1202),TIUY,2,32)
"RTN","TIUSRVR1",68,0)
 . E  S TIUY=$$SETSTR^VALM1("AUTHOR: "_TIUREC(8925,+TIUDA,1202),TIUY,7,32)
"RTN","TIUSRVR1",69,0)
 . I $L(TIUREC(8925,+TIUDA,1209)) D  I 1
"RTN","TIUSRVR1",70,0)
 . . S TIUY=$$SETSTR^VALM1("ATTENDING: "_TIUREC(8925,+TIUDA,1209),TIUY,39,40)
"RTN","TIUSRVR1",71,0)
 . E  S TIUY=$$SETSTR^VALM1("EXP COSIGNER: "_TIUREC(8925,+TIUDA,1208),TIUY,36,40)
"RTN","TIUSRVR1",72,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",73,0)
 . S TIUY=""
"RTN","TIUSRVR1",74,0)
 . S TIUY=$$SETSTR^VALM1("URGENCY: "_TIUREC(8925,+TIUDA,.09),TIUY,6,36)
"RTN","TIUSRVR1",75,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),TIUY,42,38)
"RTN","TIUSRVR1",76,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",77,0)
 S TIUY=""
"RTN","TIUSRVR1",78,0)
 I '$L($G(^TIU(8925,+TIUDA,17))) D  I 1
"RTN","TIUSRVR1",79,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",80,0)
 E  D
"RTN","TIUSRVR1",81,0)
 . S TIUY=$$SETSTR^VALM1("SUBJECT: "_$G(^TIU(8925,+TIUDA,17)),TIUY,6,74)
"RTN","TIUSRVR1",82,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",83,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR1",84,0)
 I +$$HASADDEN^TIULC1(TIUDA) D
"RTN","TIUSRVR1",85,0)
 . S TIUY="   *** "_$$PNAME^TIULC1(+$G(^TIU(8925,TIUDA,0)))
"RTN","TIUSRVR1",86,0)
 . S TIUY=TIUY_" Has ADDENDA ***"
"RTN","TIUSRVR1",87,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",88,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR1",89,0)
 Q
"RTN","TIUSRVR1",90,0)
 ;
"RTN","TIUSRVR1",91,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUSRVR1",92,0)
 N TIUY,TIUTYP
"RTN","TIUSRVR1",93,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUSRVR1",94,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUSRVR1",95,0)
 Q TIUY
"RTN","TIUSRVR1",96,0)
IDTOP(TIUDA,TIUL,SHORT,CURPRNT) ; Load entry-specific info:
"RTN","TIUSRVR1",97,0)
 ;Title, [Location, Visit] for ID entry.
"RTN","TIUSRVR1",98,0)
 ; Called by LOADTOP
"RTN","TIUSRVR1",99,0)
 N TIUY,TIUX,TIU
"RTN","TIUSRVR1",100,0)
 I CURPRNT S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="                         << Interdisciplinary Note >>"
"RTN","TIUSRVR1",101,0)
 I SHORT S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="                      << Interdisciplinary Note - Cont. >>"
"RTN","TIUSRVR1",102,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUSRVR1",103,0)
 S TIUY="",TIUX="TITLE: "_$P($G(TIU("DOCTYP")),U,2)
"RTN","TIUSRVR1",104,0)
 S TIUY=$$SETSTR^VALM1(TIUX,TIUY,1,67)
"RTN","TIUSRVR1",105,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",106,0)
 Q:SHORT
"RTN","TIUSRVR1",107,0)
 S TIUY="",TIUX="LOCATION: "_$P($G(TIU("LOC")),U,2)
"RTN","TIUSRVR1",108,0)
 S TIUY=$$SETSTR^VALM1(TIUX,TIUY,5,31)
"RTN","TIUSRVR1",109,0)
 I $L($G(TIU("WARD"))) D  I 1
"RTN","TIUSRVR1",110,0)
 . S TIUX="ADMISSION DATE: "_$P($G(TIU("EDT")),U,2)
"RTN","TIUSRVR1",111,0)
 . S TIUY=$$SETSTR^VALM1(TIUX,TIUY,34,37)
"RTN","TIUSRVR1",112,0)
 E  D
"RTN","TIUSRVR1",113,0)
 . S TIUX="VISIT DATE: "_$P($G(TIU("EDT")),U,2)
"RTN","TIUSRVR1",114,0)
 . S TIUY=$$SETSTR^VALM1(TIUX,TIUY,38,33)
"RTN","TIUSRVR1",115,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",116,0)
 Q
"RTN","TIUSRVR2")
0^84^B29516546
"RTN","TIUSRVR2",1,0)
TIUSRVR2 ; SLC/JER - RPC for record-wise GET ;4/12/01
"RTN","TIUSRVR2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUSRVR2",3,0)
 ; 4/12/01 Moved signature modules to new rtn TIUSRVR3
"RTN","TIUSRVR2",4,0)
LOADREC(TIUDA,TIUL,TIUGDATA,TIUGWHOL,ACTION) ; Load ^TMP
"RTN","TIUSRVR2",5,0)
 ;Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUSRVR2",6,0)
 ;optional TIUGWHOL = 1 if we're mid-load for browse, and we're already
"RTN","TIUSRVR2",7,0)
 ;                    loading the whole note after the original entry,
"RTN","TIUSRVR2",8,0)
 ;                    so DON'T load the whole note again.
"RTN","TIUSRVR2",9,0)
 N TIUKID,TIUDADT,TIUI,CANSEE
"RTN","TIUSRVR2",10,0)
 N TIUPARNT,TIUPNAME,TIUPDATE
"RTN","TIUSRVR2",11,0)
 N TIUGPRNT,TIUGPNM,TIUGPDT,TIUPDATA,TIUHASKD
"RTN","TIUSRVR2",12,0)
 S ACTION=$G(ACTION,"VIEW")
"RTN","TIUSRVR2",13,0)
 ; ---- If user cannot view, say so and quit: ----
"RTN","TIUSRVR2",14,0)
 ;      TIU*1*100
"RTN","TIUSRVR2",15,0)
 S CANSEE=$S(+$$ISCOMP^TIUSRVR1(TIUDA)>0:1,1:$$CANDO^TIULP(+TIUDA,ACTION))
"RTN","TIUSRVR2",16,0)
 I +CANSEE'>0 D  Q
"RTN","TIUSRVR2",17,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$P(CANSEE,U,2)
"RTN","TIUSRVR2",18,0)
 ; ---- Load text of TIUDA: ----
"RTN","TIUSRVR2",19,0)
 S TIUI=0
"RTN","TIUSRVR2",20,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR2",21,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(^TIU(8925,+TIUDA,"TEXT",+TIUI,0))
"RTN","TIUSRVR2",22,0)
 ; ---- if TIUDA is a COMPONENT, QUIT
"RTN","TIUSRVR2",23,0)
 Q:+$$ISCOMP^TIUSRVR1(TIUDA)
"RTN","TIUSRVR2",24,0)
 ; ---- If TIUDA **IS** an addendum, load addm signature,
"RTN","TIUSRVR2",25,0)
 ;         load original document, quit: ----
"RTN","TIUSRVR2",26,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D  Q
"RTN","TIUSRVR2",27,0)
 . N TIULINE,TIUPARNT S $P(TIULINE,"=",79)=""
"RTN","TIUSRVR2",28,0)
 . D LOADSIG^TIUSRVR3(TIUDA,.TIUL)
"RTN","TIUSRVR2",29,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",30,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIULINE
"RTN","TIUSRVR2",31,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",32,0)
 . S TIUPARNT=+$P(^TIU(8925,+TIUDA,0),U,6)
"RTN","TIUSRVR2",33,0)
 . S TIUPNAME=$$PNAME^TIULC1(+^TIU(8925,TIUPARNT,0))
"RTN","TIUSRVR2",34,0)
 . S TIUPDATE=+$G(^TIU(8925,TIUPARNT,13))
"RTN","TIUSRVR2",35,0)
 . S TIUPDATE=$$DATE^TIULS(TIUPDATE,"MM/DD/YY")
"RTN","TIUSRVR2",36,0)
 . S TIUPDATA=$$IDDATA^TIURECL1(TIUPARNT)
"RTN","TIUSRVR2",37,0)
 . S TIUHASKD=$P(TIUPDATA,U,2),TIUGPRNT=+$P(TIUPDATA,U,3)
"RTN","TIUSRVR2",38,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",39,0)
 . I TIUHASKD D
"RTN","TIUSRVR2",40,0)
 . . S @TIUARR@(TIUL)=" --- Original Addended Interdisciplinary Entry ---"
"RTN","TIUSRVR2",41,0)
 . I TIUGPRNT D
"RTN","TIUSRVR2",42,0)
 . . S @TIUARR@(TIUL)=" --- Original Addended Interdisciplinary Entry ---"
"RTN","TIUSRVR2",43,0)
 . . S TIUGPNM=$$PNAME^TIULC1(+^TIU(8925,TIUGPRNT,0))
"RTN","TIUSRVR2",44,0)
 . . S TIUGPDT=+$G(^TIU(8925,TIUGPRNT,13))
"RTN","TIUSRVR2",45,0)
 . . S TIUGPDT=$$DATE^TIULS(TIUGPDT,"MM/DD/YY")
"RTN","TIUSRVR2",46,0)
 . I 'TIUHASKD,'TIUGPRNT S @TIUARR@(TIUL)=" --- Original Document ---"
"RTN","TIUSRVR2",47,0)
 . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",48,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",49,0)
 . I TIUHASKD D
"RTN","TIUSRVR2",50,0)
 . . S @TIUARR@(TIUL)="                    << Addended Interdisciplinary Entry >>"
"RTN","TIUSRVR2",51,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",52,0)
 . . S @TIUARR@(TIUL)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUSRVR2",53,0)
 . I TIUGPRNT D
"RTN","TIUSRVR2",54,0)
 . . S @TIUARR@(TIUL)="                         << Interdisciplinary Note >>"
"RTN","TIUSRVR2",55,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",56,0)
 . . S @TIUARR@(TIUL)=TIUGPDT_" "_TIUGPNM
"RTN","TIUSRVR2",57,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",58,0)
 . . S @TIUARR@(TIUL)="                    << Addended Interdisciplinary Entry >>"
"RTN","TIUSRVR2",59,0)
 . . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUSRVR2",60,0)
 . I 'TIUHASKD,'TIUGPRNT D
"RTN","TIUSRVR2",61,0)
 . . S @TIUARR@(TIUL)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUSRVR2",62,0)
 . D LOADREC(TIUPARNT,.TIUL,TIUGDATA)
"RTN","TIUSRVR2",63,0)
 ; ---- Load components of TIUDA: ----
"RTN","TIUSRVR2",64,0)
 S TIUKID=0
"RTN","TIUSRVR2",65,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRVR2",66,0)
 . I +$$ISADDNDM^TIULC1(TIUKID)'>0 D LOADREC(TIUKID,.TIUL,$G(TIUGDATA))
"RTN","TIUSRVR2",67,0)
 ; ---- Load signature of TIUDA if TIUDA is not addm
"RTN","TIUSRVR2",68,0)
 ;           or comp: ----
"RTN","TIUSRVR2",69,0)
 I '$$ISCOMP^TIUSRVR1(TIUDA) D LOADSIG^TIUSRVR3(TIUDA,.TIUL)
"RTN","TIUSRVR2",70,0)
 ; ---- Load addenda of TIUDA: ----
"RTN","TIUSRVR2",71,0)
 S TIUKID=0
"RTN","TIUSRVR2",72,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRVR2",73,0)
 . ; If acting on an addendum, don't show it again.
"RTN","TIUSRVR2",74,0)
 . I +TIUKID=+$G(^TMP("TIU FOCUS",$J)) Q
"RTN","TIUSRVR2",75,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D LOADADD(TIUKID,.TIUL)
"RTN","TIUSRVR2",76,0)
 N IDDAD
"RTN","TIUSRVR2",77,0)
 S IDDAD=+$P(TIUGDATA,U,3)
"RTN","TIUSRVR2",78,0)
 ; ---- If Browsed Record is an ID Note, & this cycle has
"RTN","TIUSRVR2",79,0)
 ;      just loaded the parent entry, then load ID kids
"RTN","TIUSRVR2",80,0)
 ;      and quit: **100** ----
"RTN","TIUSRVR2",81,0)
 I $P(TIUGDATA,U,2),TIUDA=+TIUGDATA D LOADKIDS(TIUDA,.TIUL,TIUGDATA) Q
"RTN","TIUSRVR2",82,0)
 ; ---- If Browsed Record is an ID Entry, & this cycle hasn't begun
"RTN","TIUSRVR2",83,0)
 ;      loading the whole note, then load the whole ID Note after
"RTN","TIUSRVR2",84,0)
 ;      the browsed entry and quit: ----
"RTN","TIUSRVR2",85,0)
 I IDDAD,'$G(TIUGWHOL) D  Q
"RTN","TIUSRVR2",86,0)
 . S TIUGWHOL=1
"RTN","TIUSRVR2",87,0)
 . N TIULINE S $P(TIULINE,"=",79)=""
"RTN","TIUSRVR2",88,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",89,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIULINE
"RTN","TIUSRVR2",90,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",91,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=" --- Interdisciplinary Note ---"
"RTN","TIUSRVR2",92,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",93,0)
 . D LOADID(IDDAD,.TIUL,TIUGDATA,TIUGWHOL)
"RTN","TIUSRVR2",94,0)
 ; ---- If Browsed Record is an ID Entry, & this cycle has begun
"RTN","TIUSRVR2",95,0)
 ;      loading the whole ID note, and is currently loading the first
"RTN","TIUSRVR2",96,0)
 ;      entry of the whole note, then load kids and quit: ----
"RTN","TIUSRVR2",97,0)
 I IDDAD,$G(TIUGWHOL),TIUDA=IDDAD D LOADKIDS(TIUDA,.TIUL,TIUGDATA,TIUGWHOL) K TIUGWHOL
"RTN","TIUSRVR2",98,0)
 Q
"RTN","TIUSRVR2",99,0)
 ;
"RTN","TIUSRVR2",100,0)
LOADKIDS(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ID kids of TIUDA
"RTN","TIUSRVR2",101,0)
 ; Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUSRVR2",102,0)
 N TIUK,PRMSORT,KIDDA,TIUD0,TIUD21
"RTN","TIUSRVR2",103,0)
 I $G(^TMP("TIUR",$J,"IDDATA",TIUDA)) S PRMSORT=$P(^TMP("TIUR",$J,"IDDATA",TIUDA),U,4)
"RTN","TIUSRVR2",104,0)
 E  S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD21=$G(^TIU(8925,TIUDA,21)),PRMSORT=$P($$IDDATA^TIURECL1(TIUDA,TIUD0,TIUD21),U,4)
"RTN","TIUSRVR2",105,0)
 D GETIDKID^TIURECL2(TIUDA,PRMSORT) ; sets array ^TMP("TIUIDKID",$J,
"RTN","TIUSRVR2",106,0)
 S TIUK=0
"RTN","TIUSRVR2",107,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:+TIUK'>0  D
"RTN","TIUSRVR2",108,0)
 . S KIDDA=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIUSRVR2",109,0)
 . D LOADID(KIDDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUSRVR2",110,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIUSRVR2",111,0)
 Q
"RTN","TIUSRVR2",112,0)
 ;
"RTN","TIUSRVR2",113,0)
LOADID(TIUDA,TIUL,TIUGDATA,TIUWHOL) ; Load ID note for browse
"RTN","TIUSRVR2",114,0)
 N TIUREC,TIU
"RTN","TIUSRVR2",115,0)
 I '$D(^TIU(8925,+TIUDA,0)) Q
"RTN","TIUSRVR2",116,0)
 ; ---- If ID Kid has focus, don't show it again ----
"RTN","TIUSRVR2",117,0)
 ; I TIUDA=+$G(^TMP("TIU FOCUS",$J)) Q
"RTN","TIUSRVR2",118,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",119,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUSRVR2",120,0)
 D INQUIRE(TIUDA,.TIUREC)
"RTN","TIUSRVR2",121,0)
 ; ---- Load info missing from header since this is ID note entry: ----
"RTN","TIUSRVR2",122,0)
 ; ---- Load dictation, transcription data, etc.: ----
"RTN","TIUSRVR2",123,0)
 D LOADTOP^TIUSRVR1(.TIUREC,TIUDA,.TIUL,$G(TIUGDATA))
"RTN","TIUSRVR2",124,0)
 ; ---- Load the remainder of the record: ----
"RTN","TIUSRVR2",125,0)
 D LOADREC(TIUDA,.TIUL,$G(TIUGDATA),$G(TIUWHOL))
"RTN","TIUSRVR2",126,0)
 Q
"RTN","TIUSRVR2",127,0)
 ;
"RTN","TIUSRVR2",128,0)
INQUIRE(TIUDA,TIUREC) ; Inquire to document TIUDA and set TIUREC
"RTN","TIUSRVR2",129,0)
 N DA,DIC,DIQ,DR
"RTN","TIUSRVR2",130,0)
 S DA=TIUDA,DIC=8925,DIQ="TIUREC("
"RTN","TIUSRVR2",131,0)
 S DR=".01;.02;.05;.09;1201;1202;1208;1209;1301;1307;1501;1502;1505;1506"
"RTN","TIUSRVR2",132,0)
 D EN^DIQ1
"RTN","TIUSRVR2",133,0)
 Q
"RTN","TIUSRVR2",134,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUSRVR2",135,0)
 N TIUDAUTH,TIUDATT,TIUJ,TIUSIG,TIUCSIG,TIUVIEW
"RTN","TIUSRVR2",136,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",137,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/CCYY")
"RTN","TIUSRVR2",138,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUDADT_" ADDENDUM:"
"RTN","TIUSRVR2",139,0)
 S TIUVIEW=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUSRVR2",140,0)
 I '+TIUVIEW D  Q
"RTN","TIUSRVR2",141,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$P(TIUVIEW,U,2)
"RTN","TIUSRVR2",142,0)
 S TIUJ=0
"RTN","TIUSRVR2",143,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUSRVR2",144,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUSRVR2",145,0)
 D LOADSIG^TIUSRVR3(TIUDADD,.TIUL)
"RTN","TIUSRVR2",146,0)
 Q
"RTN","TIUSRVR3")
0^96^B17223226
"RTN","TIUSRVR3",1,0)
TIUSRVR3 ; SLC/JER - Load Signatures for record-wise GET ;4/12/01
"RTN","TIUSRVR3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100**;Jun 20, 1997
"RTN","TIUSRVR3",3,0)
 ; Created 4/12/01 by splitting TIUSRVR2
"RTN","TIUSRVR3",4,0)
LOADSIG(DA,TIUL) ; Get signature and co-signature blocks
"RTN","TIUSRVR3",5,0)
 N DIC,DIQ,DR,TIUSIG,TIUESIG1,TIUESIG2,TIUSIG1,TIUSIG2,TIUS1,TIUS2
"RTN","TIUSRVR3",6,0)
 N TIUSNM,TIUSTTL,TIUS1DT,TIUS2DT,TIUSDT
"RTN","TIUSRVR3",7,0)
 Q:'$D(^TIU(8925,DA,15))
"RTN","TIUSRVR3",8,0)
 S DIC=8925,DIQ="TIUSIG(",DIQ(0)="IE",DR="1204;1208;1501:1505;1507:1511;1601:1605"
"RTN","TIUSRVR3",9,0)
 D EN^DIQ1 I '$D(TIUSIG) Q
"RTN","TIUSRVR3",10,0)
 S TIUS1=$S(TIUSIG(8925,DA,1505,"I")="E":"/es/ ",TIUSIG(8925,DA,1505,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1503,"E"))
"RTN","TIUSRVR3",11,0)
 S TIUS2=$S(TIUSIG(8925,DA,1511,"I")="E":"/es/ ",TIUSIG(8925,DA,1511,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1509,"E"))
"RTN","TIUSRVR3",12,0)
 S TIUESIG1=$G(TIUSIG(8925,DA,1204,"I"))
"RTN","TIUSRVR3",13,0)
 S TIUSIG1=$G(TIUSIG(8925,DA,1502,"I"))
"RTN","TIUSRVR3",14,0)
 S TIUS1DT=$S(+$G(TIUSIG(8925,DA,1501,"I")):"Signed: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1501,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUSRVR3",15,0)
 S TIUESIG2=$G(TIUSIG(8925,DA,1208,"I"))
"RTN","TIUSRVR3",16,0)
 S TIUS2DT=$S(+$G(TIUSIG(8925,DA,1507,"I")):"Cosigned: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1507,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUSRVR3",17,0)
 S TIUSIG2=$G(TIUSIG(8925,DA,1508,"I"))
"RTN","TIUSRVR3",18,0)
 S TIUSNM=$$SETSTR^VALM1(TIUS1,$G(TIUSNM),1,35)
"RTN","TIUSRVR3",19,0)
 S TIUSNM=$$SETSTR^VALM1(TIUS2,$G(TIUSNM),40,35)
"RTN","TIUSRVR3",20,0)
 S TIUSTTL=$$SETSTR^VALM1(TIUSIG(8925,DA,1504,"E"),$G(TIUSTTL),1,35)
"RTN","TIUSRVR3",21,0)
 S TIUSTTL=$$SETSTR^VALM1(TIUSIG(8925,DA,1510,"E"),$G(TIUSTTL),40,35)
"RTN","TIUSRVR3",22,0)
 S TIUSDT=$$SETSTR^VALM1(TIUS1DT,$G(TIUSDT),1,35)
"RTN","TIUSRVR3",23,0)
 S TIUSDT=$$SETSTR^VALM1(TIUS2DT,$G(TIUSDT),40,35)
"RTN","TIUSRVR3",24,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR3",25,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUSNM
"RTN","TIUSRVR3",26,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUSTTL
"RTN","TIUSRVR3",27,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUSDT
"RTN","TIUSRVR3",28,0)
 I TIUSIG1]"",(TIUSIG1'=TIUESIG1) D LOADFOR(TIUSIG1,TIUESIG1,TIUSIG2,TIUESIG2,.TIUL) G XTRA
"RTN","TIUSRVR3",29,0)
 I TIUSIG2]"",(TIUSIG2'=TIUESIG2) D LOADFOR(TIUSIG1,TIUESIG1,TIUSIG2,TIUESIG2,.TIUL)
"RTN","TIUSRVR3",30,0)
XTRA I +$O(^TIU(8925.7,"B",DA,0)) D XTRASIG(DA,.TIUL)
"RTN","TIUSRVR3",31,0)
 I +$G(TIUSIG(8925,DA,1601,"I")) D
"RTN","TIUSRVR3",32,0)
 . N TIUMODE,TIUY
"RTN","TIUSRVR3",33,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR3",34,0)
 . S TIUY=$$DATE^TIULS(TIUSIG(8925,DA,1601,"I"),"MM/DD/CCYY HR:MIN")
"RTN","TIUSRVR3",35,0)
 . S TIUY=TIUY_"  AMENDMENT FILED:"
"RTN","TIUSRVR3",36,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR3",37,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR3",38,0)
 . S TIUMODE=$S(+$G(TIUSIG(8925,DA,1603,"I")):"/es/ ",1:" /s/ ")
"RTN","TIUSRVR3",39,0)
 . S TIUY=$S($G(TIUSIG(8925,DA,1604,"E"))]"":$G(TIUSIG(8925,DA,1604,"E")),1:$G(TIUSIG(8925,DA,1602,"E")))
"RTN","TIUSRVR3",40,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUMODE_TIUY
"RTN","TIUSRVR3",41,0)
 . I $L($G(TIUSIG(8925,DA,1605,"E"))) D
"RTN","TIUSRVR3",42,0)
 . . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(TIUSIG(8925,DA,1605,"E"))
"RTN","TIUSRVR3",43,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$P($G(TIUPRM1),U,5)
"RTN","TIUSRVR3",44,0)
 Q
"RTN","TIUSRVR3",45,0)
XTRASIG(TIUDA,TIUL) ; Load additional signature blocks
"RTN","TIUSRVR3",46,0)
 N TIUI S TIUI=0
"RTN","TIUSRVR3",47,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR3",48,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)="Receipt Acknowledged By:"
"RTN","TIUSRVR3",49,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR3",50,0)
 . N DA,DIC,DR,DIQ,TIUX,TIUXTRA,TIUSGNR,TIUSDT
"RTN","TIUSRVR3",51,0)
 . S DIC="^TIU(8925.7,",DIQ="TIUXTRA",DA=TIUI,DR=".03:.08",DIQ(0)="IE"
"RTN","TIUSRVR3",52,0)
 . D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIUSRVR3",53,0)
 . S TIUSGNR=$S($L($G(TIUXTRA(8925.7,DA,.06,"E"))):"/es/ "_$G(TIUXTRA(8925.7,DA,.06,"E")),1:"     "_$G(TIUXTRA(8925.7,DA,.03,"E")))
"RTN","TIUSRVR3",54,0)
 . S TIUSDT=$S(+$G(TIUXTRA(8925.7,DA,.04,"I")):$$DATE^TIULS(TIUXTRA(8925.7,DA,.04,"I"),"MM/DD/CCYY HR:MIN"),1:"* AWAITING SIGNATURE *")
"RTN","TIUSRVR3",55,0)
 . S TIUX=""
"RTN","TIUSRVR3",56,0)
 . S TIUX=$$SETSTR^VALM1(TIUSDT,TIUX,1,38)
"RTN","TIUSRVR3",57,0)
 . S TIUX=$$SETSTR^VALM1(TIUSGNR,$G(TIUX),30,49)
"RTN","TIUSRVR3",58,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUX,TIUX=""
"RTN","TIUSRVR3",59,0)
 . S TIUX=$$SETSTR^VALM1($G(TIUXTRA(8925.7,DA,.07,"E")),$G(TIUX),35,44)
"RTN","TIUSRVR3",60,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUX
"RTN","TIUSRVR3",61,0)
 Q
"RTN","TIUSRVR3",62,0)
LOADFOR(TIUS1,TIUES1,TIUS2,TIUES2,TIUL) ; Apply "for" block(s)
"RTN","TIUSRVR3",63,0)
 N TIUESN1,TIUEST1,TIUESN2,TIUEST2,TIUFORN,TIUFORT
"RTN","TIUSRVR3",64,0)
 S TIUESN1="for "_$$SIGNAME^TIULS(TIUES1),TIUEST1=$$SIGTITL^TIULS(TIUES1)
"RTN","TIUSRVR3",65,0)
 S TIUESN2="for "_$$SIGNAME^TIULS(TIUES2),TIUEST2=$$SIGTITL^TIULS(TIUES2)
"RTN","TIUSRVR3",66,0)
 I +$G(TIUS1),($G(TIUS1)'=$G(TIUES1)) S TIUFORN=$$SETSTR^VALM1(TIUESN1,$G(TIUFORN),1,35),TIUFORT=$$SETSTR^VALM1(TIUEST1,$G(TIUFORT),1,35)
"RTN","TIUSRVR3",67,0)
 I +$G(TIUS2),($G(TIUS2)'=$G(TIUES2)) S TIUFORN=$$SETSTR^VALM1(TIUESN2,$G(TIUFORN),40,35),TIUFORT=$$SETSTR^VALM1(TIUEST2,$G(TIUFORT),40,35)
"RTN","TIUSRVR3",68,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUFORN
"RTN","TIUSRVR3",69,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUFORT
"RTN","TIUSRVR3",70,0)
 Q
"RTN","TIUT")
0^85^B18525033
"RTN","TIUT",1,0)
TIUT ; SLC/JER - Release from or Send back to transcription ;12/18/00
"RTN","TIUT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,4,32,100**;Jun 20, 1997
"RTN","TIUT",3,0)
SENDBACK(DA) ; Send Document back to transcription
"RTN","TIUT",4,0)
 N DIE,DR,TIUTYP,TIUSBOK
"RTN","TIUT",5,0)
 I $$DADORKID^TIUGBR(DA) S TIUSBOK="0^You cannot send back interdisciplinary entries. They must be detached first."
"RTN","TIUT",6,0)
 I '$D(TIUSBOK) S TIUSBOK=$$CANDO^TIULP(DA,"SEND BACK")
"RTN","TIUT",7,0)
 I +TIUSBOK'>0 D  Q
"RTN","TIUT",8,0)
 . W !,$C(7),$P(TIUSBOK,U,2) ; Echo denial message
"RTN","TIUT",9,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W "" ; pause
"RTN","TIUT",10,0)
 L +^TIU(8925,+DA):1
"RTN","TIUT",11,0)
 E  W !?5,$C(7),"Another user is editing this entry." H 3 Q
"RTN","TIUT",12,0)
 S TIUTYP=$P($P(^TIU(8925.1,+^TIU(8925,+DA,0),0),U),U)
"RTN","TIUT",13,0)
 I +$$CANSEND^TIULP1(DA) D
"RTN","TIUT",14,0)
 . S DR=".05///UNRELEASED;1501///@;1306///@;1305///@;1304///@",DIE=8925 D ^DIE
"RTN","TIUT",15,0)
 . W !,TIUTYP," Sent Back." H 2
"RTN","TIUT",16,0)
 . D SENDTRAN^TIUALRT(DA) S TIUCHNG=1
"RTN","TIUT",17,0)
 . ; D UPDTIRT^TIUIRT(.TIU,+DA)
"RTN","TIUT",18,0)
 E  D
"RTN","TIUT",19,0)
 . W !,$C(7),$C(7),$C(7),TIUTYP," Not Sent Back." H 2
"RTN","TIUT",20,0)
 L -^TIU(8925,+DA)
"RTN","TIUT",21,0)
 Q
"RTN","TIUT",22,0)
RELEASE(DA,TIUREL) ; Release Document from transcription
"RTN","TIUT",23,0)
 ; TIUREL=1 ==> Document released
"RTN","TIUT",24,0)
 N DADTYP,DIE,DR,TIUD0,TIUTYP,TIUTNM,TIULINE,TIUDPRM
"RTN","TIUT",25,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUTYP=+TIUD0,TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUT",26,0)
 ; If status is beyond unsigned quit
"RTN","TIUT",27,0)
 I +$P(TIUD0,U,5)>5 Q
"RTN","TIUT",28,0)
 ; If a document is already released quit
"RTN","TIUT",29,0)
 I +$P($G(^TIU(8925,DA,13)),U,4) Q
"RTN","TIUT",30,0)
 ;S TIUREL=$S($G(TIUREL)]"":+$G(TIUREL),+$P($G(^TIU(8925,DA,13)),U,4):1,1:0)
"RTN","TIUT",31,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,DA)
"RTN","TIUT",32,0)
 ; If Release is required, and not automatic, prompt user to determine
"RTN","TIUT",33,0)
 ; whether document is ready...
"RTN","TIUT",34,0)
 I '+$G(TIUREL),+$P($G(TIUDPRM(0)),U,2) D  Q:'+TIUREL
"RTN","TIUT",35,0)
 . S TIUREL=$$READ^TIUU("YO","Is this "_TIUTNM_" ready to release from DRAFT","YES","^D REL^TIUDIRH")
"RTN","TIUT",36,0)
 . I '+TIUREL W !," NOT RELEASED." H 2
"RTN","TIUT",37,0)
 ; If release is not required, release automatically this assures alerts
"RTN","TIUT",38,0)
 ; printing, etc. happen appropriately, even for documents where release
"RTN","TIUT",39,0)
 ; from draft is not a "normal" processing step
"RTN","TIUT",40,0)
 I '+$G(TIUREL),'+$P($G(TIUDPRM(0)),U,2) S TIUREL=1
"RTN","TIUT",41,0)
 I +$G(TIUREL) D
"RTN","TIUT",42,0)
 . L +^TIU(8925,+DA):1
"RTN","TIUT",43,0)
 . E  W:'$D(ZTQUEUED) !?5,$C(7),"Another user is editing this entry." H 3 Q
"RTN","TIUT",44,0)
 . S TIULINE=$$LINECNT^TIULC(DA)
"RTN","TIUT",45,0)
 . S DR=".05///"_$S(+$$REQVER^TIULC(+DA,+$P($G(TIUDPRM(0)),U,3)):"UNVERIFIED",1:"UNSIGNED")
"RTN","TIUT",46,0)
 . S DR=DR_";.1////"_TIULINE
"RTN","TIUT",47,0)
 . ; If verification is required and user holds autoverify key, stuff
"RTN","TIUT",48,0)
 . ; verifying clerk and verification date
"RTN","TIUT",49,0)
 . I +$$REQVER^TIULC(+DA,+$P($G(TIUDPRM(0)),U,3)),+$D(^XUSEC("TIU AUTOVERIFY",DUZ)) S DR=DR_";1306////"_DUZ_";1305////"_$$NOW^TIULC
"RTN","TIUT",50,0)
 . S DR=DR_";1304////"_$$NOW^TIULC,DIE=8925 D ^DIE
"RTN","TIUT",51,0)
 . L -^TIU(8925,+DA)
"RTN","TIUT",52,0)
 . I '$D(ZTQUEUED),+$$ISA^USRLM(DUZ,"TRANSCRIPTIONIST") W !,"LINES TYPED: ",TIULINE
"RTN","TIUT",53,0)
 I '$D(ZTQUEUED),(+$P($G(TIUDPRM(0)),U,2)=1) W !,$$PNAME^TIULC1(TIUTYP),$S(+$G(TIUREL):" Released.",1:" Unreleased.") H 2
"RTN","TIUT",54,0)
 I +$G(TIUREL) D
"RTN","TIUT",55,0)
 . N TIURELX
"RTN","TIUT",56,0)
 . S TIURELX=$$RELEASE^TIULC1(+TIUD0)
"RTN","TIUT",57,0)
 . I TIURELX]"" X TIURELX
"RTN","TIUT",58,0)
 . I +$P($G(TIUDPRM(0)),U,8)'>0 D MAIN^TIUPD(+DA,"R")
"RTN","TIUT",59,0)
 . D ALERTDEL^TIUALRT(DA)
"RTN","TIUT",60,0)
 . ;If the document does not require verification, or if the document
"RTN","TIUT",61,0)
 . ;does require verification, but the user holds the AUTOVERIFY key,
"RTN","TIUT",62,0)
 . ;send alerts
"RTN","TIUT",63,0)
 . I $S('+$$REQVER^TIULC(+DA,+$P($G(TIUDPRM(0)),U,3)):1,(+$$REQVER^TIULC(+DA,+$P($G(TIUDPRM(0)),U,3))&$D(^XUSEC("TIU AUTOVERIFY",+DUZ))):1,1:0) D SEND^TIUALRT(DA)
"RTN","TIUT",64,0)
 Q
"RTN","TIUT",65,0)
VERIFY(DA) ; Evaluate requirements for verification, prompt as appropriate
"RTN","TIUT",66,0)
 N DADTYP,TIUTYP,TIUDPRM,TIUTNM,TIUD13,TIUY
"RTN","TIUT",67,0)
 S TIUD13=$G(^TIU(8925,+DA,13))
"RTN","TIUT",68,0)
 S TIUTYP=+$G(^TIU(8925,+DA,0))
"RTN","TIUT",69,0)
 ; I +$$ISADDNDM^TIULC1(DA) D  I 1
"RTN","TIUT",70,0)
 ; . S DADTYP=+$G(^TIU(8925,+$P(^TIU(8925,+DA,0),U,6),0))
"RTN","TIUT",71,0)
 ; . D DOCPRM^TIULC1(DADTYP,.TIUDPRM)
"RTN","TIUT",72,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,+DA)
"RTN","TIUT",73,0)
 ; If verification isn't required, or if the user is not authorized to
"RTN","TIUT",74,0)
 ; verify the document, then quit
"RTN","TIUT",75,0)
 I '$D(TIUDPRM(0)) Q
"RTN","TIUT",76,0)
 I '+$$REQVER^TIULC(+DA,+$P(TIUDPRM(0),U,3)) Q
"RTN","TIUT",77,0)
 I '+$$CANDO^TIULP(+DA,"VERIFICATION") Q
"RTN","TIUT",78,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUT",79,0)
 I +$P(TIUD13,U,5) D  I 1
"RTN","TIUT",80,0)
 . W !!,"This "_TIUTNM_" is already verified."
"RTN","TIUT",81,0)
 . S TIUY=$$READ^TIUU("YO","Do you want to UNVERIFY this "_TIUTNM,"NO","^D UNVER^TIUDIRH")
"RTN","TIUT",82,0)
 . I +TIUY W !," UNVERIFIED." D
"RTN","TIUT",83,0)
 . . S DIE=8925,DR="1305///@;1306///@" D ^DIE W "."
"RTN","TIUT",84,0)
 . . D ALERTDEL^TIUALRT(DA)
"RTN","TIUT",85,0)
 E  D
"RTN","TIUT",86,0)
 . N TIUVERX
"RTN","TIUT",87,0)
 . S TIUY=$$READ^TIUU("YO","VERIFY this "_TIUTNM,"NO","^D VER^TIUDIRH")
"RTN","TIUT",88,0)
 . I '+TIUY W !," NOT VERIFIED." Q
"RTN","TIUT",89,0)
 . S DIE=8925,DR=".05///UNSIGNED;1305////"_+$G(DT)_";1306////"_DUZ D ^DIE
"RTN","TIUT",90,0)
 . I +DA W !," VERIFIED." D MAIN^TIUPD(+DA,"V"),SEND^TIUALRT(DA)
"RTN","TIUT",91,0)
 . S TIUVERX=$$VERIFY^TIULC1(+TIUTYP) I TIUVERX]"" X TIUVERX
"RTN","TIUT",92,0)
 Q
"RTN","TIUTSK")
0^86^B10933398
"RTN","TIUTSK",1,0)
TIUTSK ; SLC/JER - TIU's Nightly Daemon ;1/22/01
"RTN","TIUTSK",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,53,100**;Jun 20, 1997
"RTN","TIUTSK",3,0)
MAIN ; All records are read. DC date updated, Record purged, Alerts are 
"RTN","TIUTSK",4,0)
 ; generated if appropriate
"RTN","TIUTSK",5,0)
 N TIUDA,TIUPRM0,TIUPRM1,TIUDATE,TIUENTDT,TIUPDT,TIUODT
"RTN","TIUTSK",6,0)
 D SETPARM^TIULE
"RTN","TIUTSK",7,0)
 ; Traverse "FIX" X-ref to fix temporary reference dates & back-fill
"RTN","TIUTSK",8,0)
 ; Discharge Dates
"RTN","TIUTSK",9,0)
 S TIUDA="" F  S TIUDA=$O(^TIU(8925,"FIX",1,TIUDA)) Q:TIUDA'>0  D
"RTN","TIUTSK",10,0)
 . D UPDDCDT(TIUDA) ;Ref Date fixed/DC Date updated if missing
"RTN","TIUTSK",11,0)
 ; Traverse "F" X-ref to identify records for which the grace period
"RTN","TIUTSK",12,0)
 ; for purge has expired
"RTN","TIUTSK",13,0)
 S TIUPDT=$$FMADD^XLFDT(DT,-$P(TIUPRM0,U,4))
"RTN","TIUTSK",14,0)
 S TIUODT=$$FMADD^XLFDT(DT,-$P(TIUPRM0,U,5))
"RTN","TIUTSK",15,0)
 S TIUENTDT=0
"RTN","TIUTSK",16,0)
 ; Traverse "F" X-ref to identify records overdue for signature or purge
"RTN","TIUTSK",17,0)
 ; NOTE: Following VHA Directive 10-92-077, the purge is disabled until
"RTN","TIUTSK",18,0)
 ;       further notice **53**
"RTN","TIUTSK",19,0)
 F  S TIUENTDT=$O(^TIU(8925,"F",TIUENTDT)) Q:+TIUENTDT'>0!(TIUENTDT>TIUODT)  D
"RTN","TIUTSK",20,0)
 . S TIUDA=0 F  S TIUDA=$O(^TIU(8925,"F",+TIUENTDT,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUTSK",21,0)
 . . ; I (TIUPDT<$$FMADD^XLFDT(DT,-90)),+$$PURGE^TIULC(TIUDA) D PURGE(TIUDA) Purges old records (see NOTE above) **53**
"RTN","TIUTSK",22,0)
 . . I +$$OVERDUE^TIULC(TIUDA) D SEND^TIUALRT(TIUDA,1) ;Alert for overdue
"RTN","TIUTSK",23,0)
 ; If upload buffer rec older than 30 days, delete it & its alerts
"RTN","TIUTSK",24,0)
 S TIUDA=0 F  S TIUDA=$O(^TIU(8925.2,TIUDA)) Q:TIUDA'>0  D
"RTN","TIUTSK",25,0)
 . N TIUDATE
"RTN","TIUTSK",26,0)
 . S TIUDATE=$P($G(^TIU(8925.2,TIUDA,0)),U,3)
"RTN","TIUTSK",27,0)
 . Q:+TIUDATE'>0
"RTN","TIUTSK",28,0)
 . I $$FMDIFF^XLFDT(DT,TIUDATE)>30 D
"RTN","TIUTSK",29,0)
 . . N TIUEI S TIUEI=0
"RTN","TIUTSK",30,0)
 . . ; JOEL, 12/21/00:
"RTN","TIUTSK",31,0)
 . . F  S TIUEI=$O(^TIU(8925.2,TIUDA,"ERR",TIUEI)) Q:+TIUEI'>0  D
"RTN","TIUTSK",32,0)
 . . . N TIUEDA
"RTN","TIUTSK",33,0)
 . . . S TIUEDA=+$G(^TIU(8925.2,TIUDA,"ERR",TIUEI,0)) Q:+TIUEDA'>0
"RTN","TIUTSK",34,0)
 . . . D ALERTDEL^TIUPEVNT(TIUEDA)
"RTN","TIUTSK",35,0)
 . . D BUFPURGE^TIUPUTC(TIUDA)
"RTN","TIUTSK",36,0)
 Q
"RTN","TIUTSK",37,0)
UPDDCDT(TIUDA) ; If missing DC date & Patient Movement file has DC date,
"RTN","TIUTSK",38,0)
 ;         DC date updated.
"RTN","TIUTSK",39,0)
 N DFN,DIE,DR,TIU,TIUDAD,TIUDDT,TIUD0,TIUD14,TIUDGPM
"RTN","TIUTSK",40,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD14=$G(^TIU(8925,+TIUDA,14))
"RTN","TIUTSK",41,0)
 S TIUDGPM=+$P(TIUD14,U)
"RTN","TIUTSK",42,0)
 I +$P($G(^DGPM(+TIUDGPM,0)),U,17)'>0 D  Q
"RTN","TIUTSK",43,0)
 . I +$P(TIUD0,U,12)>0 Q
"RTN","TIUTSK",44,0)
 . S DIE=8925,DR=".12////1",DA=TIUDA D ^DIE
"RTN","TIUTSK",45,0)
 I TIUD0'="",'+$P(TIUD0,U,6),(($P(TIUD0,U,8)="")!(+$P(TIUD0,U,12)>0)) D
"RTN","TIUTSK",46,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUTSK",47,0)
 . I +$G(TIU("LDT"))>0 D
"RTN","TIUTSK",48,0)
 . . S TIUDAD=$P(TIUD0,U,6)
"RTN","TIUTSK",49,0)
 . . D FIXDC(TIUDA,TIUDAD,DFN,.TIU)
"RTN","TIUTSK",50,0)
 Q
"RTN","TIUTSK",51,0)
PURGE(DA) ; When purge criteria met, document and addenda purged
"RTN","TIUTSK",52,0)
 N DR,DIE,TIUTYP,TIUDA,X,Y S TIUDA=0
"RTN","TIUTSK",53,0)
 F  S TIUDA=+$O(^TIU(8925,"DAD",+DA,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUTSK",54,0)
 . I +$$ISADDNDM^TIULC1(TIUDA) D PURGE(TIUDA) I 1
"RTN","TIUTSK",55,0)
 . E  D DIK^TIURB2(TIUDA) ; Remove components entirely. 1/3/01 updated DIK^TIURB to DIK^TIURB2 - Margy
"RTN","TIUTSK",56,0)
 S DIE=8925,DR=".05///PURGED;1609////"_$$NOW^TIULC_";2///@" D ^DIE
"RTN","TIUTSK",57,0)
 S ^TIU(8925,+DA,"TEXT",0)="^^"_2_U_2_U_DT_"^^"
"RTN","TIUTSK",58,0)
 S ^TIU(8925,+DA,"TEXT",1,0)=" "
"RTN","TIUTSK",59,0)
 S ^TIU(8925,+DA,"TEXT",2,0)="  Document Purged on "_$$DATE^TIULS(DT,"MM/DD/YY")_"."
"RTN","TIUTSK",60,0)
 Q
"RTN","TIUTSK",61,0)
FIXDC(DA,PARENT,DFN,TIU) ; Stuff fixed field data
"RTN","TIUTSK",62,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUTSK",63,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUTSK",64,0)
 I +$G(PARENT)'>0 D
"RTN","TIUTSK",65,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUTSK",66,0)
 . S @FDARR@(1402)=$P($G(TIU("TS")),U)
"RTN","TIUTSK",67,0)
 I +$G(PARENT)>0 D
"RTN","TIUTSK",68,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUTSK",69,0)
 . S @FDARR@(1401)=$P(^TIU(8925,+PARENT,14),U)
"RTN","TIUTSK",70,0)
 . S @FDARR@(1402)=$P(^TIU(8925,+PARENT,14),U,2)
"RTN","TIUTSK",71,0)
 S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUTSK",72,0)
 S @FDARR@(.12)="@"
"RTN","TIUTSK",73,0)
 S @FDARR@(1301)=+$G(TIU("LDT"))
"RTN","TIUTSK",74,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUTSK",75,0)
 Q
"VER")
8.0^22.0
"^DD",8925,8925,2101,0)
ID PARENT^P8925'^TIU(8925,^21;1^Q
"^DD",8925,8925,2101,1,0)
^.1^^-1
"^DD",8925,8925,2101,1,1,0)
8925^GDAD
"^DD",8925,8925,2101,1,1,1)
S ^TIU(8925,"GDAD",$E(X,1,30),DA)=""
"^DD",8925,8925,2101,1,1,2)
K ^TIU(8925,"GDAD",$E(X,1,30),DA)
"^DD",8925,8925,2101,1,1,3)
Please don't delete!
"^DD",8925,8925,2101,1,1,"%D",0)
^^8^8^3001026^
"^DD",8925,8925,2101,1,1,"%D",1,0)
This cross-reference is used to find the children of an interdisciplinary
"^DD",8925,8925,2101,1,1,"%D",2,0)
note, given the ID parent note.  It has the form:
"^DD",8925,8925,2101,1,1,"%D",3,0)
 
"^DD",8925,8925,2101,1,1,"%D",4,0)
        ^TIU(8925,"GDAD",ID PARENT note IEN,ID child note IEN)
"^DD",8925,8925,2101,1,1,"%D",5,0)
 
"^DD",8925,8925,2101,1,1,"%D",6,0)
Note that "TIUG" is an informal namespace for ID notes, and that this
"^DD",8925,8925,2101,1,1,"%D",7,0)
cross-reference is similar to the DAD cross-reference on the PARENT field.
"^DD",8925,8925,2101,1,1,"%D",8,0)
"GDAD" gets its "G" from "TIUG".
"^DD",8925,8925,2101,1,1,"DT")
2991229
"^DD",8925,8925,2101,3)
Enter the document this note is being attached to.
"^DD",8925,8925,2101,21,0)
^^8^8^3001025^
"^DD",8925,8925,2101,21,1,0)
Applies to ID (interdisciplinary) notes only.  The ID PARENT is the note
"^DD",8925,8925,2101,21,2,0)
this note is attached to, making this note an entry in an ID note.
"^DD",8925,8925,2101,21,3,0)
 
"^DD",8925,8925,2101,21,4,0)
A note with an ID PARENT is referred to as an ID child note. ID parent
"^DD",8925,8925,2101,21,5,0)
notes and ID child notes are both file entries in file 8925.
"^DD",8925,8925,2101,21,6,0)
  
"^DD",8925,8925,2101,21,7,0)
The entries of an interdisciplinary note consist of the first entry, which
"^DD",8925,8925,2101,21,8,0)
is also the ID PARENT of the ID note, followed by the ID children.
"^DD",8925,8925,2101,"DT")
3000629
"^DD",8925.5,8925.5,3.01,0)
INTERDISCIPLINARY NOTE ACTION^S^a:Attachment;d:Detachment;^3;1^Q
"^DD",8925.5,8925.5,3.01,3)
Indicate the action that was executed
"^DD",8925.5,8925.5,3.01,21,0)
^.001^2^2^3001115^^
"^DD",8925.5,8925.5,3.01,21,1,0)
This set of codes describes the action (i.e., Attachment or Detachment)
"^DD",8925.5,8925.5,3.01,21,2,0)
that was carried out for a given ID Entry.
"^DD",8925.5,8925.5,3.01,"DT")
3001115
"^DD",8925.5,8925.5,3.02,0)
DATE/TIME OF ACTION^D^^3;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",8925.5,8925.5,3.02,3)
Indicate the date/time at which the action occurred.
"^DD",8925.5,8925.5,3.02,21,0)
^^2^2^3001115^
"^DD",8925.5,8925.5,3.02,21,1,0)
This is the Date and Time at which the entry was attached to (or detached
"^DD",8925.5,8925.5,3.02,21,2,0)
from) its ID Parent.
"^DD",8925.5,8925.5,3.02,"DT")
3001115
"^DD",8925.5,8925.5,3.03,0)
PERSON^P200'^VA(200,^3;3^Q
"^DD",8925.5,8925.5,3.03,3)
Indicate the person who performed the action.
"^DD",8925.5,8925.5,3.03,21,0)
^^2^2^3001115^
"^DD",8925.5,8925.5,3.03,21,1,0)
This is the person who attached the ID Entry to (or detached it from) its
"^DD",8925.5,8925.5,3.03,21,2,0)
ID Parent.
"^DD",8925.5,8925.5,3.03,"DT")
3001115
"^DD",8925.5,8925.5,3.04,0)
ID ENTRY STATUS^P8925.6'^TIU(8925.6,^3;4^Q
"^DD",8925.5,8925.5,3.04,3)
Indicate the STATUS of the ID Entry.
"^DD",8925.5,8925.5,3.04,21,0)
^^1^1^3001115^
"^DD",8925.5,8925.5,3.04,21,1,0)
This is the STATUS of the Entry at the time of the action.
"^DD",8925.5,8925.5,3.04,"DT")
3001115
"^DD",8925.5,8925.5,3.05,0)
ID PARENT^P8925'^TIU(8925,^3;5^Q
"^DD",8925.5,8925.5,3.05,1,0)
^.1
"^DD",8925.5,8925.5,3.05,1,1,0)
8925.5^AID
"^DD",8925.5,8925.5,3.05,1,1,1)
S ^TIU(8925.5,"AID",$E(X,1,30),DA)=""
"^DD",8925.5,8925.5,3.05,1,1,2)
K ^TIU(8925.5,"AID",$E(X,1,30),DA)
"^DD",8925.5,8925.5,3.05,1,1,"%D",0)
^^2^2^3001116^
"^DD",8925.5,8925.5,3.05,1,1,"%D",1,0)
This REGULAR FileMan Cross-reference on ID PARENT allows easy access to
"^DD",8925.5,8925.5,3.05,1,1,"%D",2,0)
audit trail events that apply to particular ID PARENT Documents.
"^DD",8925.5,8925.5,3.05,1,1,"DT")
3001116
"^DD",8925.5,8925.5,3.05,3)
Indicate the ID Parent for the action.
"^DD",8925.5,8925.5,3.05,21,0)
^^1^1^3001115^
"^DD",8925.5,8925.5,3.05,21,1,0)
This is the ID Parent when the action occurred.
"^DD",8925.5,8925.5,3.05,"DT")
3001116
"^DD",8925.95,8925.95,.18,0)
ORDER ID ENTRIES BY TITLE^S^1:YES;0:NO;^0;18^Q
"^DD",8925.95,8925.95,.18,3)
To display/print interdisciplinary child entries alphabetically by title under the parent entry, answer YES.  Otherwise they are ordered by date.
"^DD",8925.95,8925.95,.18,21,0)
^^9^9^3001026^
"^DD",8925.95,8925.95,.18,21,1,0)
This prompt applies only to notes with interdisciplinary entries under
"^DD",8925.95,8925.95,.18,21,2,0)
them.
"^DD",8925.95,8925.95,.18,21,3,0)
 
"^DD",8925.95,8925.95,.18,21,4,0)
When an ID note is displayed or printed, the child entries are normally
"^DD",8925.95,8925.95,.18,21,5,0)
ordered by reference date under the parent entry. In some cases it may be
"^DD",8925.95,8925.95,.18,21,6,0)
preferable to order them alphabetically by title. If this parameter is set
"^DD",8925.95,8925.95,.18,21,7,0)
to YES, child entries are displayed by title rather than by date.
"^DD",8925.95,8925.95,.18,21,8,0)
 
"^DD",8925.95,8925.95,.18,21,9,0)
The default order is by date.
"^DD",8925.95,8925.95,.18,"DT")
3000919
"^DD",8925.95,8925.95,.19,0)
SEND ALERTS ON NEW ID ENTRY^S^1:YES;0:NO;^0;19^Q
"^DD",8925.95,8925.95,.19,3)
Should the signer (cosigner) of an interdisciplinary parent note be alerted when a new entry is added to the note?
"^DD",8925.95,8925.95,.19,21,0)
^^7^7^3001114^
"^DD",8925.95,8925.95,.19,21,1,0)
This parameter applies only to interdisciplinary parent notes.
"^DD",8925.95,8925.95,.19,21,2,0)
 
"^DD",8925.95,8925.95,.19,21,3,0)
If this parameter is set to YES, the signer (cosigner) of an
"^DD",8925.95,8925.95,.19,21,4,0)
interdisciplinary parent note is alerted when a new entry is added to the
"^DD",8925.95,8925.95,.19,21,5,0)
note.
"^DD",8925.95,8925.95,.19,21,6,0)
 
"^DD",8925.95,8925.95,.19,21,7,0)
The default is NO.
"^DD",8925.95,8925.95,.19,"DT")
3000919
**INSTALL NAME**
USR*1.0*15
"BLD",2611,0)
USR*1.0*15^AUTHORIZATION/SUBSCRIPTION^0^3010416^y
"BLD",2611,1,0)
^^2^2^3010130^
"BLD",2611,1,1,0)
For the description of this build see patch USR*1*15 in the National Patch
"BLD",2611,1,2,0)
Module.
"BLD",2611,4,0)
^9.64PA^8930.1^3
"BLD",2611,4,8930.1,0)
8930.1
"BLD",2611,4,8930.1,222)
y^n^f^^^^n
"BLD",2611,4,8930.2,0)
8930.2
"BLD",2611,4,8930.2,222)
y^y^f^^n^^y^o^n
"BLD",2611,4,8930.8,0)
8930.8
"BLD",2611,4,8930.8,222)
y^y^f^^n^^y^o^n
"BLD",2611,4,"B",8930.1,8930.1)

"BLD",2611,4,"B",8930.2,8930.2)

"BLD",2611,4,"B",8930.8,8930.8)

"BLD",2611,"INID")
^
"BLD",2611,"INIT")

"BLD",2611,"KRN",0)
^9.67PA^19^18
"BLD",2611,"KRN",.4,0)
.4
"BLD",2611,"KRN",.401,0)
.401
"BLD",2611,"KRN",.402,0)
.402
"BLD",2611,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",2611,"KRN",.402,"NM",1,0)
USR DEFINE AUTHORIZATIONS    FILE #8930.1^8930.1^0
"BLD",2611,"KRN",.402,"NM","B","USR DEFINE AUTHORIZATIONS    FILE #8930.1",1)

"BLD",2611,"KRN",.403,0)
.403
"BLD",2611,"KRN",.5,0)
.5
"BLD",2611,"KRN",.84,0)
.84
"BLD",2611,"KRN",3.6,0)
3.6
"BLD",2611,"KRN",3.8,0)
3.8
"BLD",2611,"KRN",9.2,0)
9.2
"BLD",2611,"KRN",9.8,0)
9.8
"BLD",2611,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",2611,"KRN",9.8,"NM",1,0)
USRAEDT^^0^B5583272
"BLD",2611,"KRN",9.8,"NM",2,0)
USRLA^^0^B5761901
"BLD",2611,"KRN",9.8,"NM","B","USRAEDT",1)

"BLD",2611,"KRN",9.8,"NM","B","USRLA",2)

"BLD",2611,"KRN",19,0)
19
"BLD",2611,"KRN",19,"NM",0)
^9.68A^^
"BLD",2611,"KRN",19.1,0)
19.1
"BLD",2611,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",2611,"KRN",101,0)
101
"BLD",2611,"KRN",409.61,0)
409.61
"BLD",2611,"KRN",771,0)
771
"BLD",2611,"KRN",869.2,0)
869.2
"BLD",2611,"KRN",870,0)
870
"BLD",2611,"KRN",8994,0)
8994
"BLD",2611,"KRN","B",.4,.4)

"BLD",2611,"KRN","B",.401,.401)

"BLD",2611,"KRN","B",.402,.402)

"BLD",2611,"KRN","B",.403,.403)

"BLD",2611,"KRN","B",.5,.5)

"BLD",2611,"KRN","B",.84,.84)

"BLD",2611,"KRN","B",3.6,3.6)

"BLD",2611,"KRN","B",3.8,3.8)

"BLD",2611,"KRN","B",9.2,9.2)

"BLD",2611,"KRN","B",9.8,9.8)

"BLD",2611,"KRN","B",19,19)

"BLD",2611,"KRN","B",19.1,19.1)

"BLD",2611,"KRN","B",101,101)

"BLD",2611,"KRN","B",409.61,409.61)

"BLD",2611,"KRN","B",771,771)

"BLD",2611,"KRN","B",869.2,869.2)

"BLD",2611,"KRN","B",870,870)

"BLD",2611,"KRN","B",8994,8994)

"BLD",2611,"QUES",0)
^9.62^^
"BLD",2611,"REQB",0)
^9.611^^
"DATA",8930.2,1,0)
AUTHOR/DICTATOR^Author (Dictator)^AU
"DATA",8930.2,2,0)
ATTENDING PHYSICIAN^Attending Physician^ATT
"DATA",8930.2,3,0)
TRANSCRIBER^Transciber^TR
"DATA",8930.2,4,0)
EXPECTED COSIGNER^Expected Cosigner^EC
"DATA",8930.2,5,0)
EXPECTED SIGNER^Expected Signer^ES
"DATA",8930.2,6,0)
SURROGATE^Surrogate^SUR
"DATA",8930.2,7,0)
ADDITIONAL SIGNER^Additional Signer^X
"DATA",8930.2,8,0)
COMPLETER^Completer^CP
"DATA",8930.2,8,1,0)
^^3^3^3001026^
"DATA",8930.2,8,1,1,0)
The completer of a document is the person whose signature completes
"DATA",8930.2,8,1,2,0)
(authenticates) the document.  If the document requires cosignature, the
"DATA",8930.2,8,1,3,0)
completer is the cosigner.  Otherwise the completer is the signer.
"DATA",8930.8,1,0)
DICTATION^A^DOC^^DICTATE^BE DICTATED
"DATA",8930.8,2,0)
ENTRY^A^DOC^^ENTER^BE ENTERED
"DATA",8930.8,2,1,0)
^8930.81P^1^1
"DATA",8930.8,2,1,1,0)
7
"DATA",8930.8,3,0)
VERIFICATION^A^DOC^^VERIFY^BE VERIFIED
"DATA",8930.8,3,1,0)
^8930.81P^2^2
"DATA",8930.8,3,1,1,0)
7
"DATA",8930.8,3,1,2,0)
9
"DATA",8930.8,4,0)
SIGNATURE^A^DOC^^SIGN^BE SIGNED
"DATA",8930.8,4,1,0)
^8930.81P^2^2
"DATA",8930.8,4,1,1,0)
7
"DATA",8930.8,4,1,2,0)
9
"DATA",8930.8,5,0)
COSIGNATURE^A^DOC^^COSIGN^BE COSIGNED
"DATA",8930.8,5,1,0)
^8930.81P^1^1
"DATA",8930.8,5,1,1,0)
7
"DATA",8930.8,5,2,0)
^^2^2^3000419^^^
"DATA",8930.8,5,2,1,0)
This event occurs when the second-line signature is obtained for a document.
"DATA",8930.8,5,2,2,0)

"DATA",8930.8,7,0)
VIEW^A^DOC^^VIEW^BE VIEWED
"DATA",8930.8,8,0)
RELEASE FROM TRANSCRIPTION^A^DOC^^RELEASE^BE RELEASED FROM TRANSCRIPTION^FROM TRANSCRIPTION
"DATA",8930.8,8,1,0)
^8930.81P^1^1
"DATA",8930.8,8,1,1,0)
7
"DATA",8930.8,9,0)
EDIT RECORD^A^DOC^^EDIT^BE EDITED
"DATA",8930.8,9,1,0)
^8930.81P^1^1
"DATA",8930.8,9,1,1,0)
7
"DATA",8930.8,9,2,0)
^^3^3^3000419^^^^
"DATA",8930.8,9,2,1,0)
 
"DATA",8930.8,9,2,2,0)
Users authorized to perform this event may edit the text of associated
"DATA",8930.8,9,2,3,0)
documents.
"DATA",8930.8,10,0)
UNSIGNED NOTIFICATION^S^DOC
"DATA",8930.8,11,0)
UNCOSIGNED NOTIFICATION^S^DOC
"DATA",8930.8,14,0)
PRINT RECORD^A^DOC^^PRINT^BE PRINTED
"DATA",8930.8,14,1,0)
^8930.81P^1^1
"DATA",8930.8,14,1,1,0)
7
"DATA",8930.8,15,0)
DELETE RECORD^A^DOC^^DELETE^BE DELETED
"DATA",8930.8,16,0)
COPY RECORD^A^DOC^^COPY^BE COPIED
"DATA",8930.8,16,2,0)
^^2^2^3000419^^
"DATA",8930.8,16,2,1,0)
This describes the copy action, which allows the user to copy a progress
"DATA",8930.8,16,2,2,0)
note (or other document) from one patient or encounter to another.
"DATA",8930.8,17,0)
SEND BACK^A^DOC^^SEND BACK^BE SENT BACK
"DATA",8930.8,17,2,0)
^^3^3^3000419^^^
"DATA",8930.8,17,2,1,0)
This action involves sending back a document to transcription for
"DATA",8930.8,17,2,2,0)
correction (and possibly redictation).  It removes documents which require
"DATA",8930.8,17,2,3,0)
release from view, except by the originator or a transcriptionist.
"DATA",8930.8,18,0)
AMENDMENT^A^DOC^^AMEND^BE AMENDED
"DATA",8930.8,18,2,0)
^^2^2^3000419^^
"DATA",8930.8,18,2,1,0)
This involves the Privacy Act Amendment of a document by authorized
"DATA",8930.8,18,2,2,0)
individuals AFTER Electronic Signature.
"DATA",8930.8,19,0)
MAKE ADDENDUM^A^DOC^^ADDEND^BE ADDENDED
"DATA",8930.8,19,2,0)
^^6^6^3000419^^^
"DATA",8930.8,19,2,1,0)
Addenda may be added to documents for the purposes of clarification,
"DATA",8930.8,19,2,2,0)
augmenting, or disclaming existing information.  Addenda may be thought of
"DATA",8930.8,19,2,3,0)
as extensions of their parent documents, and inherit their properties from
"DATA",8930.8,19,2,4,0)
them (i.e., an addendum to a discharge summary is treated like a discharge
"DATA",8930.8,19,2,5,0)
summary, while an addendum to a progress note is treated like a progress
"DATA",8930.8,19,2,6,0)
note, etc.).
"DATA",8930.8,20,0)
IDENTIFY SIGNERS^A^DOC^^IDENTIFY SIGNERS FOR^HAVE SIGNERS IDENTIFIED
"DATA",8930.8,20,2,0)
^^8^8^3000419^^^^
"DATA",8930.8,20,2,1,0)
This action allows the identification of users whose concurrence is
"DATA",8930.8,20,2,2,0)
expected, but NOT REQUIRED.  It may be used by the author of a note to
"DATA",8930.8,20,2,3,0)
call a given document to another user's (e.g., teammate's) attention.  An
"DATA",8930.8,20,2,4,0)
example might be a Resident or Fellow who wishes for a Staff Physician's
"DATA",8930.8,20,2,5,0)
concurrence on a complex note or consult.  The recipient of the alert for
"DATA",8930.8,20,2,6,0)
concurrence signature may add an addendum or sign the document, but may
"DATA",8930.8,20,2,7,0)
not generally edit the document itself.  His signature in this case does
"DATA",8930.8,20,2,8,0)
NOT complete the document, but merely indicates concurrence.
"DATA",8930.8,21,0)
REASSIGN^A^DOC^^REASSIGN^BE REASSIGNED
"DATA",8930.8,21,2,0)
^^3^3^3000419^^
"DATA",8930.8,21,2,1,0)
Reassignment of records involves the correction of Patient, Visit, or
"DATA",8930.8,21,2,2,0)
Signatory information, and may typically be accomplished by the author or
"DATA",8930.8,21,2,3,0)
MIS prior to signature, or by the CHIEF, MIS following signature.
"DATA",8930.8,22,0)
CHANGE TITLE^A^DOC^^CHANGE THE TITLE OF^HAVE ITS TITLE CHANGED
"DATA",8930.8,22,2,0)
^^3^3^3000419^^
"DATA",8930.8,22,2,1,0)
This describes the action by which a title may be changed at appropriate
"DATA",8930.8,22,2,2,0)
times during the life of a document (e.g., conversion of a posting to
"DATA",8930.8,22,2,3,0)
another title, or to a progress note of a given title, etc.).
"DATA",8930.8,23,0)
LINK WITH REQUEST^A^DOC^^LINK^BE LINKED with a request^with a request
"DATA",8930.8,23,2,0)
^^3^3^3000605^^^^
"DATA",8930.8,23,2,1,0)
This action involves the linking (or re-linking) of a result with a
"DATA",8930.8,23,2,2,0)
request in another application (e.g., a PULMONARY CONSULT with its
"DATA",8930.8,23,2,3,0)
corresponding request).
"DATA",8930.8,24,0)
ATTACH TO ID NOTE^A^DOC^^ATTACH^BE ATTACHED to an ID note^to an ID note
"DATA",8930.8,24,2,0)
^8930.82^9^9^3001024^^
"DATA",8930.8,24,2,1,0)
This action applies to interdisciplinary CHILD notes.  Rules involving
"DATA",8930.8,24,2,2,0)
this action determine whether or not a particular child note can be
"DATA",8930.8,24,2,3,0)
attached to ID parents, and who can do the attaching.
"DATA",8930.8,24,2,4,0)
 
"DATA",8930.8,24,2,5,0)
Two rules are required if a document CHILD is to be attached to a
"DATA",8930.8,24,2,6,0)
document PARENT.  The first rule uses this action, ATTACH TO ID NOTE, and
"DATA",8930.8,24,2,7,0)
permits the particular CHILD to become an entry under an ID parent. The
"DATA",8930.8,24,2,8,0)
second rule uses action ATTACH ID ENTRY, and permits the particular PARENT
"DATA",8930.8,24,2,9,0)
to receive ID children.
"DATA",8930.8,24,3)
Rule applies to individual ID CHILD entries
"DATA",8930.8,25,0)
ATTACH ID ENTRY^A^DOC^^ATTACH AN ID ENTRY TO^BE GIVEN AN ID ATTACHMENT
"DATA",8930.8,25,2,0)
^8930.82^9^9^3001024^^
"DATA",8930.8,25,2,1,0)
This action applies to interdisciplinary PARENT notes.  Rules involving
"DATA",8930.8,25,2,2,0)
this action determine whether or not a particular parent note can receive
"DATA",8930.8,25,2,3,0)
ID children, and who can do the attaching.
"DATA",8930.8,25,2,4,0)
 
"DATA",8930.8,25,2,5,0)
Two rules are required if a document CHILD is to be attached to a
"DATA",8930.8,25,2,6,0)
document PARENT.  The first rule uses action ATTACH TO ID NOTE, and
"DATA",8930.8,25,2,7,0)
permits the particular CHILD to become an entry under an ID parent. The
"DATA",8930.8,25,2,8,0)
second rule uses this action, ATTACH ID ENTRY, and permits the particular
"DATA",8930.8,25,2,9,0)
PARENT to receive ID children.
"DATA",8930.8,25,3)
Rule applies to interdisciplinary PARENT notes
"FIA",8930.1)
USR AUTHORIZATION/SUBSCRIPTION
"FIA",8930.1,0)
^USR(8930.1,
"FIA",8930.1,0,0)
8930.1IP
"FIA",8930.1,0,1)
y^n^f^^^^n
"FIA",8930.1,0,10)

"FIA",8930.1,0,11)

"FIA",8930.1,0,"RLRO")

"FIA",8930.1,0,"VR")
1.0^USR
"FIA",8930.1,8930.1)
0
"FIA",8930.1,8930.11)
0
"FIA",8930.2)
USR ROLE
"FIA",8930.2,0)
^USR(8930.2,
"FIA",8930.2,0,0)
8930.2
"FIA",8930.2,0,1)
y^y^f^^n^^y^o^n
"FIA",8930.2,0,10)

"FIA",8930.2,0,11)

"FIA",8930.2,0,"RLRO")

"FIA",8930.2,0,"VR")
1.0^USR
"FIA",8930.2,8930.2)
0
"FIA",8930.2,8930.21)
0
"FIA",8930.8)
USR ACTION
"FIA",8930.8,0)
^USR(8930.8,
"FIA",8930.8,0,0)
8930.8I
"FIA",8930.8,0,1)
y^y^f^^n^^y^o^n
"FIA",8930.8,0,10)

"FIA",8930.8,0,11)

"FIA",8930.8,0,"RLRO")

"FIA",8930.8,0,"VR")
1.0^USR
"FIA",8930.8,8930.8)
0
"FIA",8930.8,8930.81)
0
"FIA",8930.8,8930.82)
0
"KRN",.402,919,-1)
0^1
"KRN",.402,919,0)
USR DEFINE AUTHORIZATIONS^3010308.1359^^8930.1^^^3010416
"KRN",.402,919,"DR",1,8930.1)
N TIUFPRIV S TIUFPRIV=1;@1;N USRDDEF,USRACT0,USRVERB,USRVMOD,USREND,USRPHRAS,USRFLAG;.01;S USRDDEF=X;S DIC("S")="I $P(^USR(8930.6,+Y,0),U,4)'=""DEFN""";.02;K DIC("S");.03;S:'X Y=.04;
"KRN",.402,919,"DR",1,8930.1,1)
S USRACT0=^USR(8930.8,X,0),USRVERB=$P(USRACT0,U,5),USRVMOD=$P(USRACT0,U,7),USREND=$S($L(USRVMOD):"     "_USRVMOD_".",1:"."),USRPHRAS=$G(^USR(8930.8,X,3));S USRFLAG=$S($P(USRACT0,U)="ATTACH ID ENTRY":1,1:0);
"KRN",.402,919,"DR",1,8930.1,2)
W:($L(USRPHRAS)!$L(USRVMOD)) !,"     This rule authorizes users to ",USRVERB," a note of type: ",!,"         ",$P(^TIU(8925.1,USRDDEF,0),U);W:($L(USRPHRAS)!$L(USRVMOD)&(USREND'=".")) ! W:($L(USRPHRAS)!$L(USRVMOD)) USREND;
"KRN",.402,919,"DR",1,8930.1,3)
W:USRFLAG&($P(^TIU(8925.1,USRDDEF,0),U,4)="CL") "??",!?7,"Rules such as this one which permit notes",!?7,"to be ID PARENTS may not be written for CLASSES.",!,"Please select a TITLE or a DOCUMENT CLASS:";
"KRN",.402,919,"DR",1,8930.1,4)
S:USRFLAG&($P(^TIU(8925.1,USRDDEF,0),U,4)'="DOC")&($P(^TIU(8925.1,USRDDEF,0),U,4)'="DC") Y="@1";
"KRN",.402,919,"DR",1,8930.1,5)
W:USRFLAG !?7,"WARNING: Notes used as ID PARENTS may NOT be used as ID children.",!?16,"Rules such as this one which permit notes to be ID PARENTS",!?16,"OVERRIDE any existing rules permitting them to be children.";.04;.05;.06;1;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",194,-1)
1^1
"PKG",194,0)
AUTHORIZATION/SUBSCRIPTION^USR^User Authorization
"PKG",194,20,0)
^9.402P^^
"PKG",194,22,0)
^9.49I^1^1
"PKG",194,22,1,0)
1.0^2970620
"PKG",194,22,1,"PAH",1,0)
15^3010416
"PKG",194,22,1,"PAH",1,1,0)
^^2^2^3010416
"PKG",194,22,1,"PAH",1,1,1,0)
For the description of this build see patch USR*1*15 in the National Patch
"PKG",194,22,1,"PAH",1,1,2,0)
Module.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","USRAEDT")
0^1^B5583272
"RTN","USRAEDT",1,0)
USRAEDT ; SLC/JER - Business Rule Edit ;2/28/01
"RTN","USRAEDT",2,0)
 ;;1.0;AUTHORIZATION/SUBSCRIPTION;**15**;Jun 20, 1997
"RTN","USRAEDT",3,0)
MAIN ; Controls branching
"RTN","USRAEDT",4,0)
 N DIC,DA,DIE,DR,DLAYGO,X,Y,DWPK,TIUFPRIV,USRY,USRI S TIUFPRIV=1
"RTN","USRAEDT",5,0)
 W !,"Please Enter or Edit a Business Rule:",!
"RTN","USRAEDT",6,0)
 S (DIC,DLAYGO)=8930.1,DIC(0)="AEMQL",DIC("A")="Select DOCUMENT DEFINITION: "
"RTN","USRAEDT",7,0)
 D ^DIC K DIC,DLAYGO Q:+Y'>0  S DA=+Y
"RTN","USRAEDT",8,0)
 S DIE=8930.1,DR="[USR DEFINE AUTHORIZATIONS]"
"RTN","USRAEDT",9,0)
 D ^DIE
"RTN","USRAEDT",10,0)
 I '$D(DA) W !!,"<Business Rule DELETED>" Q
"RTN","USRAEDT",11,0)
 W !!,"You defined the following rule:",!
"RTN","USRAEDT",12,0)
 D XLATE(.USRY,DA)
"RTN","USRAEDT",13,0)
 S USRI=0 F  S USRI=$O(USRY(USRI)) Q:+USRI'>0  D
"RTN","USRAEDT",14,0)
 . W !?(2*USRI),USRY(USRI)
"RTN","USRAEDT",15,0)
 Q
"RTN","USRAEDT",16,0)
XLATE(Y,DA) ; Translate business rule
"RTN","USRAEDT",17,0)
 N STATUS,USRCLASS,USROLE,USRD0,USRI
"RTN","USRAEDT",18,0)
 S USRD0=$G(^USR(8930.1,+DA,0))
"RTN","USRAEDT",19,0)
 S STATUS=$$STATUS(DA,USRD0),USRCLASS=$$CLASS(DA,USRD0)
"RTN","USRAEDT",20,0)
 S USROLE=$$ROLE(DA,USRD0)
"RTN","USRAEDT",21,0)
 S Y=$S($E(STATUS,1,2)="UN":"An",$E(STATUS,1)="A":"An",1:"A")
"RTN","USRAEDT",22,0)
 S Y=Y_" "_STATUS_" "
"RTN","USRAEDT",23,0)
 ;**ID** was " may be "
"RTN","USRAEDT",24,0)
 S Y=Y_$$DOCUMENT(DA,USRD0)_" may "_$$ACTION(DA,USRD0)_" by "
"RTN","USRAEDT",25,0)
 S Y=Y_USRCLASS_$S($P(USRD0,U,5)="&":" who is also ",$P(USRD0,U,5)="!":" OR ",1:"")
"RTN","USRAEDT",26,0)
 S Y=Y_USROLE,Y=$$WRAP^USRLS(Y,75)
"RTN","USRAEDT",27,0)
 F USRI=1:1:$L(Y,"|") S Y(USRI)=$P(Y,"|",USRI)
"RTN","USRAEDT",28,0)
 Q
"RTN","USRAEDT",29,0)
STATUS(DA,USRD0) ; to which status does the rule apply?
"RTN","USRAEDT",30,0)
 N Y
"RTN","USRAEDT",31,0)
 S Y=$P($G(^USR(8930.6,+$P(USRD0,U,2),0)),U)
"RTN","USRAEDT",32,0)
 Q $G(Y)
"RTN","USRAEDT",33,0)
DOCUMENT(DA,USRD0) ; to which document does the rule apply?
"RTN","USRAEDT",34,0)
 N Y
"RTN","USRAEDT",35,0)
 S Y=$$DDHLEV($P($G(^TIU(8925.1,+USRD0,0)),U,4))
"RTN","USRAEDT",36,0)
 S Y=Y_$$UP^XLFSTR($$PNAME^TIULC1(+USRD0))
"RTN","USRAEDT",37,0)
 I $E(Y,$L(Y))="S" S Y=$E(Y,1,$L(Y)-1)
"RTN","USRAEDT",38,0)
 Q $G(Y)
"RTN","USRAEDT",39,0)
DDHLEV(USRDTYP) ; External value of Document Definition Type
"RTN","USRAEDT",40,0)
 N USRY
"RTN","USRAEDT",41,0)
 S USRY=$S(USRDTYP="CL":"(CLASS) ",USRDTYP="DC":"(DOCUMENT CLASS) ",USRDTYP="DOC":"(TITLE) ",1:"")
"RTN","USRAEDT",42,0)
 Q $G(USRY)
"RTN","USRAEDT",43,0)
ACTION(DA,USRD0) ; to which action does rule apply?
"RTN","USRAEDT",44,0)
 ; **100** update with new DOCUMENT VERB fld in 8930.8
"RTN","USRAEDT",45,0)
 N Y,ACTNDA,NODE0
"RTN","USRAEDT",46,0)
 S ACTNDA=+$P(USRD0,U,3),NODE0=$G(^USR(8930.8,ACTNDA,0))
"RTN","USRAEDT",47,0)
 S Y=$P(NODE0,U,6) ;DOCMT VERB
"RTN","USRAEDT",48,0)
ACTX Q $G(Y)
"RTN","USRAEDT",49,0)
 ;
"RTN","USRAEDT",50,0)
CLASS(DA,USRD0) ; to which user class does the rule apply?
"RTN","USRAEDT",51,0)
 N Y
"RTN","USRAEDT",52,0)
 S Y=$$UP^XLFSTR($$CLNAME^USRLM($P(USRD0,U,4)))
"RTN","USRAEDT",53,0)
 ; **ID** was "A ". Omit U to avoid "an User"
"RTN","USRAEDT",54,0)
 I $L(Y) S Y=$S("AEIO"[$E(Y):"an ",1:"a ")_Y
"RTN","USRAEDT",55,0)
 Q $G(Y)
"RTN","USRAEDT",56,0)
ROLE(DA,USRD0) ; to which user role does the rule apply?
"RTN","USRAEDT",57,0)
 N Y,USRDA
"RTN","USRAEDT",58,0)
 S USRDA=$P(USRD0,U,6),Y=$P($G(^USR(8930.2,+USRDA,0)),U)
"RTN","USRAEDT",59,0)
 ;**ID** changed A and An to lower case
"RTN","USRAEDT",60,0)
 I $L(Y) S Y=$S($E(Y)="A":"an ",$E(Y)="E":"an ",1:"a ")_Y
"RTN","USRAEDT",61,0)
 Q Y
"RTN","USRLA")
0^2^B5761901
"RTN","USRLA",1,0)
USRLA ; SLC/JER - Authorization Library functions ; 10/13/00
"RTN","USRLA",2,0)
 ;;1.0;AUTHORIZATION/SUBSCRIPTION;**15**;Jun 20, 1997
"RTN","USRLA",3,0)
CANDO(DOCTYPE,STATUS,EVENT,USER,USRROLE) ; Evaluate Authorization
"RTN","USRLA",4,0)
 ; Receives:  DOCTYPE = Pointer to TIU DOCMT DEF FILE (8925.1)
"RTN","USRLA",5,0)
 ;             STATUS = Pointer to TIU STATUS FILE (8925.6)
"RTN","USRLA",6,0)
 ;              EVENT = Pointer to USR EVENT FILE (8930.8)
"RTN","USRLA",7,0)
 ;               USER = Pointer to NEW PERSON FILE (200)
"RTN","USRLA",8,0)
 ;          [USRROLE] = Pointer to USER ROLE FILE (8930.2)
"RTN","USRLA",9,0)
 ;                      Role, if received, is a particular role
"RTN","USRLA",10,0)
 ;                      already known to belong to USER for docmt
"RTN","USRLA",11,0)
 ;                      being checked.  See CANDO^TIULP.
"RTN","USRLA",12,0)
 N USRC,USRCY,USRRY,USRR,USRY,USRFALSE
"RTN","USRLA",13,0)
 ; First, loop thru Class xref "AC" to determine whether USER
"RTN","USRLA",14,0)
 ; is a member of any subclasses which are authorized to perform
"RTN","USRLA",15,0)
 ; EVENT on DOCTYPE with STATUS.
"RTN","USRLA",16,0)
 S (USRC,USRY,USRFALSE)=0
"RTN","USRLA",17,0)
 F  S USRC=$O(^USR(8930.1,"AC",DOCTYPE,STATUS,EVENT,USRC)) Q:+USRC'>0!(+$G(USRCY)>0&(USRY>0))  D
"RTN","USRLA",18,0)
 . N USRADA,USRAND S USRADA=0
"RTN","USRLA",19,0)
 . F  S USRADA=+$O(^USR(8930.1,"AC",DOCTYPE,STATUS,EVENT,USRC,USRADA)) Q:+USRADA'>0!(+$G(USRY)>0)  D
"RTN","USRLA",20,0)
 . . S USRCY=+$$ISA^USRLM(USER,USRC)
"RTN","USRLA",21,0)
 . . ; If user is NOT a member of the class for which a rule has been
"RTN","USRLA",22,0)
 . . ; defined, set USRFALSE to indicate evaluation of a rule that
"RTN","USRLA",23,0)
 . . ; was NOT satisfied.
"RTN","USRLA",24,0)
 . . I +USRCY'>0 S USRFALSE=1
"RTN","USRLA",25,0)
 . . ; If a match is obtained on user class, check to see whether
"RTN","USRLA",26,0)
 . . ; additional conditions on user role exist.
"RTN","USRLA",27,0)
 . . I +USRCY>0 D
"RTN","USRLA",28,0)
 . . . S USRFALSE=0
"RTN","USRLA",29,0)
 . . . I $P($G(^USR(8930.1,USRADA,0)),U,5)="&",($G(USRROLE)=$P($G(^(0)),U,6)) S USRY=1
"RTN","USRLA",30,0)
 . . . I $P($G(^USR(8930.1,USRADA,0)),U,5)'="&" S USRY=1
"RTN","USRLA",31,0)
 ; In the event that authorization is granted to users with a
"RTN","USRLA",32,0)
 ; particular role with respect to the document, without concern
"RTN","USRLA",33,0)
 ; for class membership, check the Role xref "AR".
"RTN","USRLA",34,0)
 I +USRY'>0,+$G(USRROLE) D
"RTN","USRLA",35,0)
 . S USRR=0
"RTN","USRLA",36,0)
 . F  S USRR=$O(^USR(8930.1,"AR",DOCTYPE,STATUS,EVENT,USRROLE,USRR)) Q:+USRR'>0!(USRY>0)  D
"RTN","USRLA",37,0)
 . . I $P($G(^USR(8930.1,+USRR,0)),U,5)="&",+$P($G(^(0)),U,4) D
"RTN","USRLA",38,0)
 . . . I +$$ISA^USRLM(+$G(USER),+$P($G(^USR(8930.1,+USRR,0)),U,4)) S USRY=1 ; **15** Changed DUZ to USER.
"RTN","USRLA",39,0)
 . . I '+USRY,'+$P($G(^USR(8930.1,+USRR,0)),U,4) S USRY=1
"RTN","USRLA",40,0)
 ; To allow heritability of authorization, if the user is not
"RTN","USRLA",41,0)
 ; authorized to perform the specified action on the specific
"RTN","USRLA",42,0)
 ; document in its current state, AND if no explicit rule for
"RTN","USRLA",43,0)
 ; the current document definition failed (i.e., USRFALSE'>0),
"RTN","USRLA",44,0)
 ; then traverse up the document class hierarchy and evaluate
"RTN","USRLA",45,0)
 ; whether authorization is granted at a higher level.
"RTN","USRLA",46,0)
 I +USRY'>0,(+$G(USRFALSE)'>0) D
"RTN","USRLA",47,0)
 . N USRTYP S USRTYP=0
"RTN","USRLA",48,0)
 . F  S USRTYP=$O(^TIU(8925.1,"AD",DOCTYPE,USRTYP)) Q:+USRTYP'>0!(+USRY>0)  D
"RTN","USRLA",49,0)
 . . S USRY=$$CANDO(USRTYP,STATUS,EVENT,USER,$G(USRROLE))
"RTN","USRLA",50,0)
 Q USRY
"SEC","^DIC",8930.2,8930.2,0,"AUDIT")
@
"SEC","^DIC",8930.2,8930.2,0,"DD")
@
"SEC","^DIC",8930.2,8930.2,0,"DEL")
@
"SEC","^DIC",8930.2,8930.2,0,"LAYGO")
@
"SEC","^DIC",8930.2,8930.2,0,"RD")
@
"SEC","^DIC",8930.2,8930.2,0,"WR")
@
"SEC","^DIC",8930.8,8930.8,0,"AUDIT")
@
"SEC","^DIC",8930.8,8930.8,0,"DD")
@
"SEC","^DIC",8930.8,8930.8,0,"DEL")
@
"SEC","^DIC",8930.8,8930.8,0,"LAYGO")
@
"SEC","^DIC",8930.8,8930.8,0,"RD")
@
"SEC","^DIC",8930.8,8930.8,0,"WR")
@
"VER")
8.0^22.0
"^DD",8930.1,8930.1,0)
FIELD^^3^9
"^DD",8930.1,8930.1,0,"DDA")
N
"^DD",8930.1,8930.1,0,"DT")
2970113
"^DD",8930.1,8930.1,0,"ID","W.02")
S %I=Y,Y=$S('$D(^(0)):"",$D(^USR(8930.6,+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(8930.6,.01,0),U,2) D Y^DIQ:Y]"" W " ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",8930.1,8930.1,0,"ID","W.03")
S %I=Y,Y=$S('$D(^(0)):"",$D(^USR(8930.8,+$P(^(0),U,3),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(8930.8,.01,0),U,2) D Y^DIQ:Y]"" W " ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",8930.1,8930.1,0,"ID","W.04")
S %I=Y,Y=$S('$D(^(0)):"",$D(^USR(8930,+$P(^(0),U,4),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(8930,.01,0),U,2) D Y^DIQ:Y]"" W " ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",8930.1,8930.1,0,"ID","W.05")
W " ",@("$P($P($C(59)_$S($D(^DD(8930.1,.05,0)):$P(^(0),U,3),1:0)_$E("_DIC_"Y,0),0),$C(59)_$P(^(0),U,5)_"":"",2),$C(59),1)")
"^DD",8930.1,8930.1,0,"ID","W.06")
S %I=Y,Y=$S('$D(^(0)):"",$D(^USR(8930.2,+$P(^(0),U,6),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(8930.2,.01,0),U,2) D Y^DIQ:Y]"" W " ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",8930.1,8930.1,0,"IX","AC",8930.1,.01)

"^DD",8930.1,8930.1,0,"IX","AC1",8930.1,.02)

"^DD",8930.1,8930.1,0,"IX","AC2",8930.1,.03)

"^DD",8930.1,8930.1,0,"IX","AC3",8930.1,.04)

"^DD",8930.1,8930.1,0,"IX","AR",8930.1,.01)

"^DD",8930.1,8930.1,0,"IX","AR1",8930.1,.02)

"^DD",8930.1,8930.1,0,"IX","AR2",8930.1,.03)

"^DD",8930.1,8930.1,0,"IX","AR3",8930.1,.06)

"^DD",8930.1,8930.1,0,"IX","B",8930.1,.01)

"^DD",8930.1,8930.1,0,"IX","C",8930.1,.04)

"^DD",8930.1,8930.1,0,"IX","D",8930.1,.06)

"^DD",8930.1,8930.1,0,"NM","USR AUTHORIZATION/SUBSCRIPTION")

"^DD",8930.1,8930.1,0,"VRPK")
AUTHORIZATION/SUBSCRIPTION
"^DD",8930.1,8930.1,.01,0)
DOCUMENT DEFINITION^R*P8925.1'^TIU(8925.1,^0;1^S DIC("S")="I ""^CL^DC^DOC^""[(U_$P(^(0),U,4)_U)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",8930.1,8930.1,.01,1,0)
^.1
"^DD",8930.1,8930.1,.01,1,1,0)
8930.1^B
"^DD",8930.1,8930.1,.01,1,1,1)
S ^USR(8930.1,"B",$E(X,1,30),DA)=""
"^DD",8930.1,8930.1,.01,1,1,2)
K ^USR(8930.1,"B",$E(X,1,30),DA)
"^DD",8930.1,8930.1,.01,1,2,0)
8930.1^AC^MUMPS
"^DD",8930.1,8930.1,.01,1,2,1)
I +$P($G(^USR(8930.1,+DA,0)),U,2),+$P($G(^(0)),U,3),+$P($G(^(0)),U,4) S ^USR(8930.1,"AC",+X,+$P($G(^USR(8930.1,+DA,0)),U,2),+$P($G(^(0)),U,3),+$P($G(^(0)),U,4),DA)=""
"^DD",8930.1,8930.1,.01,1,2,2)
I +$P($G(^USR(8930.1,+DA,0)),U,2),+$P($G(^(0)),U,3),+$P($G(^(0)),U,4) K ^USR(8930.1,"AC",+X,+$P($G(^USR(8930.1,+DA,0)),U,2),+$P($G(^(0)),U,3),+$P($G(^(0)),U,4),DA)
"^DD",8930.1,8930.1,.01,1,2,"%D",0)
^^3^3^2950705^^
"^DD",8930.1,8930.1,.01,1,2,"%D",1,0)
This MUMPS-type, Multi-field cross-reference is used to optimize
"^DD",8930.1,8930.1,.01,1,2,"%D",2,0)
identification of user classes whose members are authorized to perform a
"^DD",8930.1,8930.1,.01,1,2,"%D",3,0)
given action on a document type, which is in a particular status.
"^DD",8930.1,8930.1,.01,1,2,"DT")
2950620
"^DD",8930.1,8930.1,.01,1,3,0)
8930.1^AR^MUMPS
"^DD",8930.1,8930.1,.01,1,3,1)
I +$P($G(^USR(8930.1,+DA,0)),U,2),+$P($G(^(0)),U,3),+$P($G(^(0)),U,6) S ^USR(8930.1,"AR",+X,+$P($G(^USR(8930.1,+DA,0)),U,2),+$P($G(^(0)),U,3),+$P($G(^(0)),U,6),DA)=""
"^DD",8930.1,8930.1,.01,1,3,2)
I +$P($G(^USR(8930.1,+DA,0)),U,2),+$P($G(^(0)),U,3),+$P($G(^(0)),U,6) K ^USR(8930.1,"AR",+X,+$P($G(^USR(8930.1,+DA,0)),U,2),+$P($G(^(0)),U,3),+$P($G(^(0)),U,6),DA)
"^DD",8930.1,8930.1,.01,1,3,"%D",0)
^^4^4^2950705^
"^DD",8930.1,8930.1,.01,1,3,"%D",1,0)
This MUMPS-type, Multi-field cross-reference is used to
"^DD",8930.1,8930.1,.01,1,3,"%D",2,0)
optimize identification of users whose relationship to the document
"^DD",8930.1,8930.1,.01,1,3,"%D",3,0)
allows them to perform a given action on a document type, which is in
"^DD",8930.1,8930.1,.01,1,3,"%D",4,0)
a particular status.
"^DD",8930.1,8930.1,.01,1,3,"DT")
2950705
"^DD",8930.1,8930.1,.01,3)
Enter the Document Definition for which the action is authorized or subscribed to.
"^DD",8930.1,8930.1,.01,12)
Rules are limited to Classes, Document Classes, and Titles.
"^DD",8930.1,8930.1,.01,12.1)
S DIC("S")="I ""^CL^DC^DOC^""[(U_$P(^(0),U,4)_U)"
"^DD",8930.1,8930.1,.01,21,0)
^^2^2^2970113^^^^
"^DD",8930.1,8930.1,.01,21,1,0)
This is a Document Definition of Type Class, Document Class, or Title from
"^DD",8930.1,8930.1,.01,21,2,0)
the Document Definition File 8925.1
"^DD",8930.1,8930.1,.01,"DT")
2970225
"^DD",8930.1,8930.1,.02,0)
STATUS^P8930.6'^USR(8930.6,^0;2^Q
"^DD",8930.1,8930.1,.02,1,0)
^.1
"^DD",8930.1,8930.1,.02,1,1,0)
8930.1^AC1^MUMPS
"^DD",8930.1,8930.1,.02,1,1,1)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,3),+$P($G(^(0)),U,4) S ^USR(8930.1,"AC",+$P($G(^USR(8930.1,+DA,0)),U),+X,+$P($G(^(0)),U,3),+$P($G(^(0)),U,4),DA)=""
"^DD",8930.1,8930.1,.02,1,1,2)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,3),+$P($G(^(0)),U,4) K ^USR(8930.1,"AC",+$P($G(^USR(8930.1,+DA,0)),U),+X,+$P($G(^(0)),U,3),+$P($G(^(0)),U,4),DA)
"^DD",8930.1,8930.1,.02,1,1,"%D",0)
^^3^3^2950705^^
"^DD",8930.1,8930.1,.02,1,1,"%D",1,0)
This MUMPS-type, Multi-field cross-reference is used to optimize
"^DD",8930.1,8930.1,.02,1,1,"%D",2,0)
identification of user classes whose members are authorized to perform a
"^DD",8930.1,8930.1,.02,1,1,"%D",3,0)
given action on a document type, which is in a particular status.
"^DD",8930.1,8930.1,.02,1,1,"DT")
2950620
"^DD",8930.1,8930.1,.02,1,2,0)
8930.1^AR1^MUMPS
"^DD",8930.1,8930.1,.02,1,2,1)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,3),+$P($G(^(0)),U,6) S ^USR(8930.1,"AR",+$P($G(^USR(8930.1,+DA,0)),U),+X,+$P($G(^(0)),U,3),+$P($G(^(0)),U,6),DA)=""
"^DD",8930.1,8930.1,.02,1,2,2)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,3),+$P($G(^(0)),U,6) K ^USR(8930.1,"AR",+$P($G(^USR(8930.1,+DA,0)),U),+X,+$P($G(^(0)),U,3),+$P($G(^(0)),U,6),DA)
"^DD",8930.1,8930.1,.02,1,2,"%D",0)
^^4^4^2950705^
"^DD",8930.1,8930.1,.02,1,2,"%D",1,0)
This MUMPS-type, Multi-field cross-reference is used to
"^DD",8930.1,8930.1,.02,1,2,"%D",2,0)
optimize identification of users whose relationship to the document
"^DD",8930.1,8930.1,.02,1,2,"%D",3,0)
allows them to perform a given action on a document type, which is in
"^DD",8930.1,8930.1,.02,1,2,"%D",4,0)
a particular status.
"^DD",8930.1,8930.1,.02,1,2,"DT")
2950705
"^DD",8930.1,8930.1,.02,3)
Enter the status of document for which the event is authorized.
"^DD",8930.1,8930.1,.02,"DT")
2950705
"^DD",8930.1,8930.1,.03,0)
ACTION^P8930.8'^USR(8930.8,^0;3^Q
"^DD",8930.1,8930.1,.03,1,0)
^.1
"^DD",8930.1,8930.1,.03,1,1,0)
8930.1^AC2^MUMPS
"^DD",8930.1,8930.1,.03,1,1,1)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,4) S ^USR(8930.1,"AC",+$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+X,+$P($G(^(0)),U,4),DA)=""
"^DD",8930.1,8930.1,.03,1,1,2)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,4) K ^USR(8930.1,"AC",+$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+X,+$P($G(^(0)),U,4),DA)
"^DD",8930.1,8930.1,.03,1,1,"%D",0)
^^3^3^2950705^^
"^DD",8930.1,8930.1,.03,1,1,"%D",1,0)
This MUMPS-type, Multi-field cross-reference is used to optimize
"^DD",8930.1,8930.1,.03,1,1,"%D",2,0)
identification of user classes whose members are authorized to perform a
"^DD",8930.1,8930.1,.03,1,1,"%D",3,0)
given action on a document type, which is in a particular status.
"^DD",8930.1,8930.1,.03,1,1,"DT")
2950620
"^DD",8930.1,8930.1,.03,1,2,0)
8930.1^AR2^MUMPS
"^DD",8930.1,8930.1,.03,1,2,1)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,6) S ^USR(8930.1,"AR",+$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+X,+$P($G(^(0)),U,6),DA)=""
"^DD",8930.1,8930.1,.03,1,2,2)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,6) K ^USR(8930.1,"AR",+$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+X,+$P($G(^(0)),U,6),DA)
"^DD",8930.1,8930.1,.03,1,2,"%D",0)
^^4^4^2950705^
"^DD",8930.1,8930.1,.03,1,2,"%D",1,0)
This MUMPS-type, Multi-field cross-reference is used to
"^DD",8930.1,8930.1,.03,1,2,"%D",2,0)
optimize identification of users whose relationship to the document
"^DD",8930.1,8930.1,.03,1,2,"%D",3,0)
allows them to perform a given action on a document type, which is in
"^DD",8930.1,8930.1,.03,1,2,"%D",4,0)
a particular status.
"^DD",8930.1,8930.1,.03,1,2,"DT")
2950705
"^DD",8930.1,8930.1,.03,3)
Enter the action which is permitted for this document type.
"^DD",8930.1,8930.1,.03,21,0)
^^1^1^2961202^^^^
"^DD",8930.1,8930.1,.03,21,1,0)
This is the action to be permitted for a given document type and status.
"^DD",8930.1,8930.1,.03,"DT")
2950705
"^DD",8930.1,8930.1,.04,0)
USER CLASS^P8930'^USR(8930,^0;4^Q
"^DD",8930.1,8930.1,.04,1,0)
^.1
"^DD",8930.1,8930.1,.04,1,1,0)
8930.1^AC3^MUMPS
"^DD",8930.1,8930.1,.04,1,1,1)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,3) S ^USR(8930.1,"AC",+$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,3),+X,DA)=""
"^DD",8930.1,8930.1,.04,1,1,2)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,3) K ^USR(8930.1,"AC",+$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,3),+X,DA)
"^DD",8930.1,8930.1,.04,1,1,"%D",0)
^^3^3^2950705^^^
"^DD",8930.1,8930.1,.04,1,1,"%D",1,0)
This MUMPS-type, Multi-field cross-reference is used to optimize
"^DD",8930.1,8930.1,.04,1,1,"%D",2,0)
identification of user classes whose members are authorized to perform a
"^DD",8930.1,8930.1,.04,1,1,"%D",3,0)
given action on a document type, which is in a particular status.
"^DD",8930.1,8930.1,.04,1,1,"DT")
2950620
"^DD",8930.1,8930.1,.04,1,2,0)
8930.1^C
"^DD",8930.1,8930.1,.04,1,2,1)
S ^USR(8930.1,"C",$E(X,1,30),DA)=""
"^DD",8930.1,8930.1,.04,1,2,2)
K ^USR(8930.1,"C",$E(X,1,30),DA)
"^DD",8930.1,8930.1,.04,1,2,"%D",0)
^^2^2^2970102^
"^DD",8930.1,8930.1,.04,1,2,"%D",1,0)
This REGULAR FileMan cross-reference facilitates look-ups based on USER
"^DD",8930.1,8930.1,.04,1,2,"%D",2,0)
CLASS.
"^DD",8930.1,8930.1,.04,1,2,"DT")
2970102
"^DD",8930.1,8930.1,.04,3)
Identify User Class to which authorization will be granted.
"^DD",8930.1,8930.1,.04,21,0)
^^2^2^2950619^^^^
"^DD",8930.1,8930.1,.04,21,1,0)
This is the User Class which is being authorized to perform an action on a 
"^DD",8930.1,8930.1,.04,21,2,0)
document of the type and status indicated.
"^DD",8930.1,8930.1,.04,"DT")
2970102
"^DD",8930.1,8930.1,.05,0)
AND FLAG^S^&:AND;!:OR;^0;5^Q
"^DD",8930.1,8930.1,.05,1,0)
^.1^^0
"^DD",8930.1,8930.1,.05,3)
Indicate whether the User Class and User Role should be "AND'ed"
"^DD",8930.1,8930.1,.05,21,0)
^^8^8^2950619^^^^
"^DD",8930.1,8930.1,.05,21,1,0)
This field allows the ADPAC to indicate whether the conditions specified 
"^DD",8930.1,8930.1,.05,21,2,0)
by User Class and User Role should be logically "AND'ed," or logically "OR'ed," 
"^DD",8930.1,8930.1,.05,21,3,0)
as they will be unless otherwise specified.  i.e., if you want to specify 
"^DD",8930.1,8930.1,.05,21,4,0)
that an unsigned discharge summary may be signed by a user, where:
"^DD",8930.1,8930.1,.05,21,5,0)

"^DD",8930.1,8930.1,.05,21,6,0)
User Class = Provider AND User Role = Author,
"^DD",8930.1,8930.1,.05,21,7,0)

"^DD",8930.1,8930.1,.05,21,8,0)
then you'll want to set this field to AND.
"^DD",8930.1,8930.1,.05,"DT")
2950619
"^DD",8930.1,8930.1,.06,0)
USER ROLE^P8930.2'^USR(8930.2,^0;6^Q
"^DD",8930.1,8930.1,.06,1,0)
^.1
"^DD",8930.1,8930.1,.06,1,1,0)
8930.1^AR3^MUMPS
"^DD",8930.1,8930.1,.06,1,1,1)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,3) S ^USR(8930.1,"AR",+$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,3),+X,DA)=""
"^DD",8930.1,8930.1,.06,1,1,2)
I +$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,3) K ^USR(8930.1,"AR",+$P($G(^USR(8930.1,+DA,0)),U),+$P($G(^(0)),U,2),+$P($G(^(0)),U,3),+X,DA)
"^DD",8930.1,8930.1,.06,1,1,"%D",0)
^^4^4^2950705^
"^DD",8930.1,8930.1,.06,1,1,"%D",1,0)
This MUMPS-type, Multi-field cross-reference is used to
"^DD",8930.1,8930.1,.06,1,1,"%D",2,0)
optimize identification of users whose relationship to the document
"^DD",8930.1,8930.1,.06,1,1,"%D",3,0)
allows them to perform a given action on a document type, which is in
"^DD",8930.1,8930.1,.06,1,1,"%D",4,0)
a particular status.
"^DD",8930.1,8930.1,.06,1,1,"DT")
2950705
"^DD",8930.1,8930.1,.06,1,2,0)
8930.1^D
"^DD",8930.1,8930.1,.06,1,2,1)
S ^USR(8930.1,"D",$E(X,1,30),DA)=""
"^DD",8930.1,8930.1,.06,1,2,2)
K ^USR(8930.1,"D",$E(X,1,30),DA)
"^DD",8930.1,8930.1,.06,1,2,"%D",0)
^^2^2^2970102^
"^DD",8930.1,8930.1,.06,1,2,"%D",1,0)
This REGULAR FileMan Cross-reference facilitates look-ups based on USER
"^DD",8930.1,8930.1,.06,1,2,"%D",2,0)
ROLE.
"^DD",8930.1,8930.1,.06,1,2,"DT")
2970102
"^DD",8930.1,8930.1,.06,3)
Identify the role of the user with respect to the documents.
"^DD",8930.1,8930.1,.06,21,0)
^^3^3^2950619^^^^
"^DD",8930.1,8930.1,.06,21,1,0)
This identifies the role of the user with respect to the document in
"^DD",8930.1,8930.1,.06,21,2,0)
question (e.g., Author/Dictator, Expected Signer, Expected Cosigner,
"^DD",8930.1,8930.1,.06,21,3,0)
Attending Physician, etc.).
"^DD",8930.1,8930.1,.06,"DT")
2970102
"^DD",8930.1,8930.1,1,0)
DESCRIPTION^8930.11^^1;0
"^DD",8930.1,8930.1,1,21,0)
^^16^16^2941012^^
"^DD",8930.1,8930.1,1,21,1,0)
 
"^DD",8930.1,8930.1,1,21,2,0)
For most entries, the meaning of the entry will be clear from the
"^DD",8930.1,8930.1,1,21,3,0)
description of the associated event in the TIU Event file.  In some cases,
"^DD",8930.1,8930.1,1,21,4,0)
that may not suffice, in which case this field may be used to further
"^DD",8930.1,8930.1,1,21,6,0)
 
"^DD",8930.1,8930.1,1,21,7,0)
For example, if an entry associates the Signature event with a document of
"^DD",8930.1,8930.1,1,21,8,0)
status completed, it might help to note in the description field that such
"^DD",8930.1,8930.1,1,21,9,0)
a signature is a walkup signature.
"^DD",8930.1,8930.1,1,21,10,0)
 
"^DD",8930.1,8930.1,1,21,11,0)
It should not be necessary to describe consequences in this field - those
"^DD",8930.1,8930.1,1,21,12,0)
descriptions may be gotten from the associated protocol descriptions
"^DD",8930.1,8930.1,1,21,13,0)
instead.
"^DD",8930.1,8930.1,1,21,14,0)
 
"^DD",8930.1,8930.1,1,21,15,0)
This field will be used when persons associating users with user classes
"^DD",8930.1,8930.1,1,21,16,0)
wish to know the meaning of events associated with certain user classes.
"^DD",8930.1,8930.1,2,0)
PREREQUISITE ACTION^K^^PRE;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8930.1,8930.1,2,3)
Enter M-code to execute before the event can occur.
"^DD",8930.1,8930.1,2,9)
@
"^DD",8930.1,8930.1,2,"DT")
2950213
"^DD",8930.1,8930.1,3,0)
CONSEQUENCE^K^^POST;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8930.1,8930.1,3,3)
Enter M-code to be executed on completion of the action.
"^DD",8930.1,8930.1,3,9)
@
"^DD",8930.1,8930.1,3,"DT")
2950213
"^DD",8930.1,8930.11,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",8930.1,8930.11,0,"NM","DESCRIPTION")

"^DD",8930.1,8930.11,0,"UP")
8930.1
"^DD",8930.1,8930.11,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",8930.1,8930.11,.01,3)
If the meaning of this entry requires elaboration beyond the description of the associated event in the TIU Event file, elaborate here.
"^DD",8930.1,8930.11,.01,"DT")
2941011
"^DD",8930.2,8930.2,0)
FIELD^^1^4
"^DD",8930.2,8930.2,0,"DDA")
N
"^DD",8930.2,8930.2,0,"DT")
3001026
"^DD",8930.2,8930.2,0,"IX","B",8930.2,.01)

"^DD",8930.2,8930.2,0,"NM","USR ROLE")

"^DD",8930.2,8930.2,0,"PT",8930.1,.06)

"^DD",8930.2,8930.2,0,"VRPK")
AUTHORIZATION/SUBSCRIPTION
"^DD",8930.2,8930.2,.01,0)
USER ROLE^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",8930.2,8930.2,.01,1,0)
^.1
"^DD",8930.2,8930.2,.01,1,1,0)
8930.2^B
"^DD",8930.2,8930.2,.01,1,1,1)
S ^USR(8930.2,"B",$E(X,1,30),DA)=""
"^DD",8930.2,8930.2,.01,1,1,2)
K ^USR(8930.2,"B",$E(X,1,30),DA)
"^DD",8930.2,8930.2,.01,3)
Enter the role of the user with respect to the record.
"^DD",8930.2,8930.2,.01,21,0)
^^3^3^2950213^
"^DD",8930.2,8930.2,.01,21,1,0)
This is role which the user occupies with respect to a given record (e.g., 
"^DD",8930.2,8930.2,.01,21,2,0)
author (dictator), transcriber, expected signer, expected cosigner, 
"^DD",8930.2,8930.2,.01,21,3,0)
attending physician, etc.).
"^DD",8930.2,8930.2,.01,"DT")
2950213
"^DD",8930.2,8930.2,.02,0)
DISPLAY NAME^F^^0;2^K:$L(X)>30!($L(X)<3) X
"^DD",8930.2,8930.2,.02,3)
Enter the name of the user role which will be presented to the user.
"^DD",8930.2,8930.2,.02,"DT")
2950213
"^DD",8930.2,8930.2,.03,0)
CODE^F^^0;3^K:$L(X)>3!($L(X)<1) X
"^DD",8930.2,8930.2,.03,3)
Enter an abbreviated code by which the user role may be identified.
"^DD",8930.2,8930.2,.03,"DT")
2950213
"^DD",8930.2,8930.2,1,0)
DESCRIPTION^8930.21^^1;0
"^DD",8930.2,8930.21,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",8930.2,8930.21,0,"DT")
3001026
"^DD",8930.2,8930.21,0,"NM","DESCRIPTION")

"^DD",8930.2,8930.21,0,"UP")
8930.2
"^DD",8930.2,8930.21,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",8930.2,8930.21,.01,3)
Enter a description of the role.
"^DD",8930.2,8930.21,.01,21,0)
^^2^2^3001026^
"^DD",8930.2,8930.21,.01,21,1,0)
This field permits description of roles such as COMPLETER, which
"^DD",8930.2,8930.21,.01,21,2,0)
may not be obvious.
"^DD",8930.2,8930.21,.01,"DT")
3001026
"^DD",8930.8,8930.8,0)
FIELD^^2^10
"^DD",8930.8,8930.8,0,"DDA")
N
"^DD",8930.8,8930.8,0,"DT")
3000612
"^DD",8930.8,8930.8,0,"ID","PHRASE")
D EN^DDIOL("   "_$$GET1^DIQ(8930.8,+Y,.08),"","?0")
"^DD",8930.8,8930.8,0,"IX","B",8930.8,.01)

"^DD",8930.8,8930.8,0,"NM","USR ACTION")

"^DD",8930.8,8930.8,0,"PT",8925.113,.01)

"^DD",8930.8,8930.8,0,"PT",8925.951,.01)

"^DD",8930.8,8930.8,0,"PT",8930.1,.03)

"^DD",8930.8,8930.8,0,"PT",8930.81,.01)

"^DD",8930.8,8930.8,0,"VRPK")
AUTHORIZATION/SUBSCRIPTION
"^DD",8930.8,8930.8,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",8930.8,8930.8,.01,.1)
ACTION NAME
"^DD",8930.8,8930.8,.01,1,0)
^.1
"^DD",8930.8,8930.8,.01,1,1,0)
8930.8^B
"^DD",8930.8,8930.8,.01,1,1,1)
S ^USR(8930.8,"B",$E(X,1,30),DA)=""
"^DD",8930.8,8930.8,.01,1,1,2)
K ^USR(8930.8,"B",$E(X,1,30),DA)
"^DD",8930.8,8930.8,.01,3)
Please enter the name of the event.
"^DD",8930.8,8930.8,.01,21,0)
^.001^3^3^3001026^^^^
"^DD",8930.8,8930.8,.01,21,1,0)
These are names of events which occur in connection with clinical
"^DD",8930.8,8930.8,.01,21,2,0)
narrative documents.  These are referenced by the User
"^DD",8930.8,8930.8,.01,21,3,0)
Authorization/Subscription file to associate users with events.
"^DD",8930.8,8930.8,.01,23,0)
^^8^8^3001026^
"^DD",8930.8,8930.8,.01,23,1,0)
Warning about changing an action name:
"^DD",8930.8,8930.8,.01,23,2,0)
 
"^DD",8930.8,8930.8,.01,23,3,0)
Action NAMES are checked when evaluating permissions in CANDO^TIULP. In
"^DD",8930.8,8930.8,.01,23,4,0)
addition, action NAME: ATTACH ID ENTRY is checked in input template USR
"^DD",8930.8,8930.8,.01,23,5,0)
DEFINE AUTHORIZATIONS when action ATTACH ID ENTRY is entered.
"^DD",8930.8,8930.8,.01,23,6,0)
 
"^DD",8930.8,8930.8,.01,23,7,0)
These areas (and possibly other new areas) MUST be updated if the NAME of
"^DD",8930.8,8930.8,.01,23,8,0)
an action is changed.
"^DD",8930.8,8930.8,.01,"DT")
2970225
"^DD",8930.8,8930.8,.02,0)
EVENT TYPE^S^A:authorization;S:subscription;^0;2^Q
"^DD",8930.8,8930.8,.02,3)
Indicate the type of event you are defining.
"^DD",8930.8,8930.8,.02,21,0)
^^7^7^2950209^^
"^DD",8930.8,8930.8,.02,21,1,0)
This file contains two types of events: those a user is AUTHORIZED to
"^DD",8930.8,8930.8,.02,21,2,0)
perform and those a user SUBSCRIBES to.  For example, a user is authorized
"^DD",8930.8,8930.8,.02,21,3,0)
to perform the Signature event, but a user subscribes to ("signs up to
"^DD",8930.8,8930.8,.02,21,4,0)
receive") a Notification event.
"^DD",8930.8,8930.8,.02,21,6,0)
This field helps to define the meaning of an event and its relationship to
"^DD",8930.8,8930.8,.02,21,7,0)
a user.
"^DD",8930.8,8930.8,.02,"DT")
2950209
"^DD",8930.8,8930.8,.03,0)
APPLIES TO^S^DOC:document;DEF:definition;^0;3^Q
"^DD",8930.8,8930.8,.03,3)
Indicate whether event applies to documents or their definitions
"^DD",8930.8,8930.8,.03,"DT")
2950207
"^DD",8930.8,8930.8,.04,0)
ASSOCIATED PROTOCOL^P101'^ORD(101,^0;4^Q
"^DD",8930.8,8930.8,.04,1,0)
^.1^^0
"^DD",8930.8,8930.8,.04,3)
Indicate which Protocol corresponds to this event.
"^DD",8930.8,8930.8,.04,"DT")
2970109
"^DD",8930.8,8930.8,.05,0)
USER VERB^F^^0;5^K:$L(X)>25!($L(X)<3) X
"^DD",8930.8,8930.8,.05,3)
Example: In "You cannot SIGN this unsigned document", the user verb is "SIGN".  Uppercase, 3-25 characters.
"^DD",8930.8,8930.8,.05,21,0)
^^9^9^3001024^
"^DD",8930.8,8930.8,.05,21,1,0)
This word or phrase is displayed in explanatory messages when the user is
"^DD",8930.8,8930.8,.05,21,2,0)
denied authority to perform the given action.  Such a message might read,
"^DD",8930.8,8930.8,.05,21,3,0)
"You cannot SIGN this unsigned progress note", where the USER VERB is
"^DD",8930.8,8930.8,.05,21,4,0)
"SIGN".
"^DD",8930.8,8930.8,.05,21,5,0)
 
"^DD",8930.8,8930.8,.05,21,6,0)
The USER VERB must make grammatical sense inserted in a sentence of the
"^DD",8930.8,8930.8,.05,21,7,0)
form: "You cannot [     ] this unsigned progress note."
"^DD",8930.8,8930.8,.05,21,8,0)
 
"^DD",8930.8,8930.8,.05,21,9,0)
Please use uppercase, 3-25 characters.
"^DD",8930.8,8930.8,.05,"DT")
3000215
"^DD",8930.8,8930.8,.06,0)
DOCUMENT VERB^F^^0;6^K:$L(X)>40!($L(X)<3) X
"^DD",8930.8,8930.8,.06,3)
Example: In "An unsigned progress note can BE SIGNED by an author/dictator", the document verb is "BE SIGNED". Uppercase,3-40 characters.
"^DD",8930.8,8930.8,.06,21,0)
^.001^10^10^3001024^^
"^DD",8930.8,8930.8,.06,21,1,0)
This word or phrase is used in business rule options when displaying
"^DD",8930.8,8930.8,.06,21,2,0)
an authorization in sentence form.
"^DD",8930.8,8930.8,.06,21,3,0)
     
"^DD",8930.8,8930.8,.06,21,4,0)
A business rule might read: "An unsigned Progress Note can BE SIGNED by
"^DD",8930.8,8930.8,.06,21,5,0)
an author/dictator." The DOCUMENT VERB in this rule is "BE SIGNED".
"^DD",8930.8,8930.8,.06,21,6,0)
 
"^DD",8930.8,8930.8,.06,21,7,0)
The DOCUMENT VERB must make grammatical sense inserted in a sentence of
"^DD",8930.8,8930.8,.06,21,8,0)
the form: "An unsigned progress note can [      ] by an author/dictator."
"^DD",8930.8,8930.8,.06,21,9,0)
 
"^DD",8930.8,8930.8,.06,21,10,0)
Please use uppercase, 3-40 characters.
"^DD",8930.8,8930.8,.06,"DT")
3000215
"^DD",8930.8,8930.8,.07,0)
USER VERB MODIFIER^F^^0;7^K:$L(X)>18!($L(X)<3) X
"^DD",8930.8,8930.8,.07,3)
Example: In "You cannot LINK this unsigned note with a request", the user verb modifier is "with a request".  Lowercase, 3-18 characters.
"^DD",8930.8,8930.8,.07,21,0)
^^16^16^3001024^
"^DD",8930.8,8930.8,.07,21,1,0)
Sometimes, in writing messages to the user denying a permission, the
"^DD",8930.8,8930.8,.07,21,2,0)
action must be split into two parts.  In such cases, the USER VERB
"^DD",8930.8,8930.8,.07,21,3,0)
MODIFIER is the second part.
"^DD",8930.8,8930.8,.07,21,4,0)
 
"^DD",8930.8,8930.8,.07,21,5,0)
Example: In "You cannot LINK this UNSIGNED PROGRESS NOTE with a request",
"^DD",8930.8,8930.8,.07,21,6,0)
the USER VERB is "LINK", and the USER VERB MODIFIER is "with a request".
"^DD",8930.8,8930.8,.07,21,7,0)
 
"^DD",8930.8,8930.8,.07,21,8,0)
The USER VERB MODIFIER must make grammatical sense when inserted in: 
"^DD",8930.8,8930.8,.07,21,9,0)
     "You cannot LINK this UNSIGNED PROGRESS NOTE [    ]."
"^DD",8930.8,8930.8,.07,21,10,0)
 
"^DD",8930.8,8930.8,.07,21,11,0)
Please use lowercase, 3-18 characters.
"^DD",8930.8,8930.8,.07,21,12,0)
 
"^DD",8930.8,8930.8,.07,21,13,0)
If an action has an IDENTIFYING PHRASE or a USER VERB MODIFIER, the
"^DD",8930.8,8930.8,.07,21,14,0)
business rule ADD or EDIT action presents the user with a clarifying note
"^DD",8930.8,8930.8,.07,21,15,0)
about the rule they are creating immediately after the user enters an
"^DD",8930.8,8930.8,.07,21,16,0)
action.
"^DD",8930.8,8930.8,.07,"DT")
3000612
"^DD",8930.8,8930.8,.08,0)
IDENTIFYING PHRASE^F^^3;1^K:$L(X)>50!($L(X)<3) X
"^DD",8930.8,8930.8,.08,3)
Enter a phrase to help the user distinguish this action from others. 3-50 characters.
"^DD",8930.8,8930.8,.08,21,0)
^.001^10^10^3001024^^
"^DD",8930.8,8930.8,.08,21,1,0)
This field is NOT required.  It is available for use in helping users
"^DD",8930.8,8930.8,.08,21,2,0)
identify the correct action when writing business rules.  It appears
"^DD",8930.8,8930.8,.08,21,3,0)
when selecting actions from a list.
"^DD",8930.8,8930.8,.08,21,4,0)
 
"^DD",8930.8,8930.8,.08,21,5,0)
For examples, see actions ATTACH TO ID NOTE, and ATTACH ID ENTRY.
"^DD",8930.8,8930.8,.08,21,6,0)
 
"^DD",8930.8,8930.8,.08,21,7,0)
If an action has an IDENTIFYING PHRASE or a USER VERB MODIFIER, the
"^DD",8930.8,8930.8,.08,21,8,0)
business rule ADD or EDIT action presents the user with a clarifying note
"^DD",8930.8,8930.8,.08,21,9,0)
about the rule they are creating immediately after the user enters an
"^DD",8930.8,8930.8,.08,21,10,0)
action.
"^DD",8930.8,8930.8,.08,"DT")
3000601
"^DD",8930.8,8930.8,1,0)
IMPLIED EVENT^8930.81P^^1;0
"^DD",8930.8,8930.8,1,21,0)
^^9^9^2941011^
"^DD",8930.8,8930.8,1,21,1,0)
Some events imply other events.  For example, the ability to Sign a
"^DD",8930.8,8930.8,1,21,2,0)
document implies the ability to View the document.  Thus, View is an
"^DD",8930.8,8930.8,1,21,3,0)
implied event for the Signature event.
"^DD",8930.8,8930.8,1,21,4,0)
 
"^DD",8930.8,8930.8,1,21,6,0)
Authorization/Subscription file, the user will be shown implied events for
"^DD",8930.8,8930.8,1,21,7,0)
the given event and asked if they wish to include implied events for the
"^DD",8930.8,8930.8,1,21,8,0)
current entry.  If so, a copy of the current entry will be created for each
"^DD",8930.8,8930.8,1,21,9,0)
implied event.
"^DD",8930.8,8930.8,1,"DT")
2941011
"^DD",8930.8,8930.8,2,0)
DESCRIPTION^8930.82^^2;0
"^DD",8930.8,8930.8,2,21,0)
^^17^17^2941011^
"^DD",8930.8,8930.8,2,21,1,0)
 
"^DD",8930.8,8930.8,2,21,2,0)
The event description will be used in conjunction with the
"^DD",8930.8,8930.8,2,21,3,0)
Authorization/Subscription field to define what it means to associate
"^DD",8930.8,8930.8,2,21,4,0)
users with the event.
"^DD",8930.8,8930.8,2,21,6,0)
In most cases, this event description will suffice to determine the
"^DD",8930.8,8930.8,2,21,7,0)
meaning of User Authorization/Subscription file entries.
"^DD",8930.8,8930.8,2,21,8,0)
 
"^DD",8930.8,8930.8,2,21,9,0)
In rare cases, further description of what an event means when associated
"^DD",8930.8,8930.8,2,21,10,0)
with users, document type and document status will be made in the
"^DD",8930.8,8930.8,2,21,11,0)
description field of the User Authorization/Subscription file.  For
"^DD",8930.8,8930.8,2,21,12,0)
example, a signature event associated with documents of status
"^DD",8930.8,8930.8,2,21,13,0)
completed means a walkup signature.
"^DD",8930.8,8930.8,2,21,14,0)
 
"^DD",8930.8,8930.8,2,21,15,0)
This information will be used by persons creating entries in the User
"^DD",8930.8,8930.8,2,21,16,0)
Authorization/Subscription file and by persons assigning users to user
"^DD",8930.8,8930.8,2,21,17,0)
classes, when checking what events those user classes are associated with.
"^DD",8930.8,8930.81,0)
IMPLIED EVENT SUB-FIELD^^.01^1
"^DD",8930.8,8930.81,0,"IX","B",8930.81,.01)

"^DD",8930.8,8930.81,0,"NM","IMPLIED EVENT")

"^DD",8930.8,8930.81,0,"UP")
8930.8
"^DD",8930.8,8930.81,.01,0)
IMPLIED EVENT^P8930.8'^USR(8930.8,^0;1^Q
"^DD",8930.8,8930.81,.01,1,0)
^.1
"^DD",8930.8,8930.81,.01,1,1,0)
8930.81^B
"^DD",8930.8,8930.81,.01,1,1,1)
S ^USR(8930.8,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",8930.8,8930.81,.01,1,1,2)
K ^USR(8930.8,DA(1),1,"B",$E(X,1,30),DA)
"^DD",8930.8,8930.81,.01,3)
If this event implies another event, enter the implied event, for example, signature implies view.
"^DD",8930.8,8930.81,.01,"DT")
2941011
"^DD",8930.8,8930.82,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",8930.8,8930.82,0,"NM","DESCRIPTION")

"^DD",8930.8,8930.82,0,"UP")
8930.8
"^DD",8930.8,8930.82,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",8930.8,8930.82,.01,3)
Enter a description of the event and what it means to associate users with this event.
"^DD",8930.8,8930.82,.01,"DT")
2940921
"^DIC",8930.1,8930.1,0)
USR AUTHORIZATION/SUBSCRIPTION^8930.1IP
"^DIC",8930.1,8930.1,0,"GL")
^USR(8930.1,
"^DIC",8930.1,8930.1,"%D",0)
^^55^55^2970203^^
"^DIC",8930.1,8930.1,"%D",1,0)
This file associates users with actions on documents.
"^DIC",8930.1,8930.1,"%D",2,0)
 
"^DIC",8930.1,8930.1,"%D",3,0)
Actions are of 2 kinds: authorization actions such as the signature action,
"^DIC",8930.1,8930.1,"%D",4,0)
which an associated user is authorized to perform, and subscription
"^DIC",8930.1,8930.1,"%D",5,0)
actions, such as an unsigned document notification, which the associated
"^DIC",8930.1,8930.1,"%D",6,0)
user "signs up to receive."
"^DIC",8930.1,8930.1,"%D",7,0)
 
"^DIC",8930.1,8930.1,"%D",8,0)
An action may be associated with a USER CLASS in the User Class file
"^DIC",8930.1,8930.1,"%D",9,0)
(e.g. Staff Physician class) AND/OR with a USER ROLE in relation to the
"^DIC",8930.1,8930.1,"%D",10,0)
document (e.g. author of document).
"^DIC",8930.1,8930.1,"%D",11,0)
 
"^DIC",8930.1,8930.1,"%D",12,0)
If an Authorization/Subscription entry has both User Class AND User Role,
"^DIC",8930.1,8930.1,"%D",13,0)
the AND FLAG field permits these requirements to be "AND'ed", that is, a
"^DIC",8930.1,8930.1,"%D",14,0)
user must both belong to the User Class AND must fill the User Role in
"^DIC",8930.1,8930.1,"%D",15,0)
order to perform the action.  If the AND FLAG has value OR, or has no
"^DIC",8930.1,8930.1,"%D",16,0)
value, then User Class and User Role within the same entry are "OR'ed".
"^DIC",8930.1,8930.1,"%D",17,0)
 
"^DIC",8930.1,8930.1,"%D",18,0)
Each file entry associates an action with 1 user class and/or 1 role.  The
"^DIC",8930.1,8930.1,"%D",19,0)
entry makes this association for a given Document Definition (e.g.
"^DIC",8930.1,8930.1,"%D",20,0)
Progress Note) of a given status (e.g. Unsigned).
"^DIC",8930.1,8930.1,"%D",21,0)
 
"^DIC",8930.1,8930.1,"%D",22,0)
Multiple file entries for the SAME action/Document Definition/document
"^DIC",8930.1,8930.1,"%D",23,0)
status allow association with more than one user class/role.  Such entries
"^DIC",8930.1,8930.1,"%D",24,0)
are "OR'ed":  that is, if a user belongs to the user class/role of one OR
"^DIC",8930.1,8930.1,"%D",25,0)
another of these entries, the user may perform the action.
"^DIC",8930.1,8930.1,"%D",26,0)
 
"^DIC",8930.1,8930.1,"%D",27,0)
User classes automatically INCLUDE user subclasses of the given class as
"^DIC",8930.1,8930.1,"%D",28,0)
defined in the User Class file.
"^DIC",8930.1,8930.1,"%D",29,0)
 
"^DIC",8930.1,8930.1,"%D",30,0)
Document Definitions exist in hierarchy in file 8925.1, with Classes at
"^DIC",8930.1,8930.1,"%D",31,0)
the top level, Document Classes at the next level down, and Titles under
"^DIC",8930.1,8930.1,"%D",32,0)
Document Classes.  Authorization/Subscription entries may be defined at
"^DIC",8930.1,8930.1,"%D",33,0)
any of the above levels.  For example, an authorization which applies to
"^DIC",8930.1,8930.1,"%D",34,0)
most or all Progress Notes should be defined at the Class level for
"^DIC",8930.1,8930.1,"%D",35,0)
Document Definition "Progress Note."  On the other hand, an authorization
"^DIC",8930.1,8930.1,"%D",36,0)
which applies only to Progress Notes of Title "Dental Hygiene Note" should
"^DIC",8930.1,8930.1,"%D",37,0)
be defined at the Title level for Document Definition "Dental Hygiene
"^DIC",8930.1,8930.1,"%D",38,0)
Note".
"^DIC",8930.1,8930.1,"%D",39,0)
 
"^DIC",8930.1,8930.1,"%D",40,0)
When using authorizations/subscriptions to determine whether a given
"^DIC",8930.1,8930.1,"%D",41,0)
user should receive/may perform a given action for a Document Definition
"^DIC",8930.1,8930.1,"%D",42,0)
of a given Title, code begins by checking entries for that action and
"^DIC",8930.1,8930.1,"%D",43,0)
status FOR THAT TITLE.  If ANY such entries exist, then entries for higher
"^DIC",8930.1,8930.1,"%D",44,0)
Document Definition levels will be ignored, and the user passes/fails
"^DIC",8930.1,8930.1,"%D",45,0)
based on that level alone.  Thus, if a Title is linked with a certain
"^DIC",8930.1,8930.1,"%D",46,0)
action, status and user class, then rules for that Title, action, and
"^DIC",8930.1,8930.1,"%D",47,0)
status should be entered for ALL user classes which can perform the
"^DIC",8930.1,8930.1,"%D",48,0)
action on the Title, since broader authorization (e.g. Provider class)
"^DIC",8930.1,8930.1,"%D",49,0)
set at higher levels (e.g. Progress Notes) is ignored.
"^DIC",8930.1,8930.1,"%D",50,0)
 
"^DIC",8930.1,8930.1,"%D",51,0)
If such entries do NOT exist, the next higher level of Document Definition
"^DIC",8930.1,8930.1,"%D",52,0)
is checked.  And so on.
"^DIC",8930.1,8930.1,"%D",53,0)
 
"^DIC",8930.1,8930.1,"%D",54,0)
If no entries are found on any level, no users can perform/subscribe to
"^DIC",8930.1,8930.1,"%D",55,0)
the action for the given Document Definition and status.
"^DIC",8930.1,"B","USR AUTHORIZATION/SUBSCRIPTION",8930.1)

"^DIC",8930.2,8930.2,0)
USR ROLE^8930.2
"^DIC",8930.2,8930.2,0,"GL")
^USR(8930.2,
"^DIC",8930.2,"B","USR ROLE",8930.2)

"^DIC",8930.8,8930.8,0)
USR ACTION^8930.8
"^DIC",8930.8,8930.8,0,"GL")
^USR(8930.8,
"^DIC",8930.8,8930.8,"%D",0)
^^10^10^2970203^^
"^DIC",8930.8,8930.8,"%D",1,0)
This file encodes actions which occur in connection with clinical
"^DIC",8930.8,8930.8,"%D",2,0)
narrative documents.
"^DIC",8930.8,8930.8,"%D",3,0)
 
"^DIC",8930.8,8930.8,"%D",4,0)
These actions are referenced by entries in the User
"^DIC",8930.8,8930.8,"%D",5,0)
Authorization/Subscription file to associate users with actions.
"^DIC",8930.8,8930.8,"%D",6,0)
 
"^DIC",8930.8,8930.8,"%D",7,0)
This file contains 2 kinds of actions: those a user is authorized to
"^DIC",8930.8,8930.8,"%D",8,0)
perform on a document, and those a user subscribes to for a document.  For
"^DIC",8930.8,8930.8,"%D",9,0)
example, a user is authorized to perform the Signature action, but a user
"^DIC",8930.8,8930.8,"%D",10,0)
subscribes to ("signs up to receive") a Notification action.
"^DIC",8930.8,"B","USR ACTION",8930.8)

**INSTALL NAME**
OR*3.0*104
"BLD",2773,0)
OR*3.0*104^ORDER ENTRY/RESULTS REPORTING^0^3010416^y
"BLD",2773,4,0)
^9.64PA^^
"BLD",2773,"KRN",0)
^9.67PA^19^17
"BLD",2773,"KRN",.4,0)
.4
"BLD",2773,"KRN",.401,0)
.401
"BLD",2773,"KRN",.402,0)
.402
"BLD",2773,"KRN",.403,0)
.403
"BLD",2773,"KRN",.5,0)
.5
"BLD",2773,"KRN",.84,0)
.84
"BLD",2773,"KRN",3.6,0)
3.6
"BLD",2773,"KRN",3.8,0)
3.8
"BLD",2773,"KRN",9.2,0)
9.2
"BLD",2773,"KRN",9.8,0)
9.8
"BLD",2773,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",2773,"KRN",9.8,"NM",1,0)
ORCNOTE^^0^B56454982
"BLD",2773,"KRN",9.8,"NM","B","ORCNOTE",1)

"BLD",2773,"KRN",19,0)
19
"BLD",2773,"KRN",19.1,0)
19.1
"BLD",2773,"KRN",101,0)
101
"BLD",2773,"KRN",409.61,0)
409.61
"BLD",2773,"KRN",771,0)
771
"BLD",2773,"KRN",870,0)
870
"BLD",2773,"KRN",8994,0)
8994
"BLD",2773,"KRN","B",.4,.4)

"BLD",2773,"KRN","B",.401,.401)

"BLD",2773,"KRN","B",.402,.402)

"BLD",2773,"KRN","B",.403,.403)

"BLD",2773,"KRN","B",.5,.5)

"BLD",2773,"KRN","B",.84,.84)

"BLD",2773,"KRN","B",3.6,3.6)

"BLD",2773,"KRN","B",3.8,3.8)

"BLD",2773,"KRN","B",9.2,9.2)

"BLD",2773,"KRN","B",9.8,9.8)

"BLD",2773,"KRN","B",19,19)

"BLD",2773,"KRN","B",19.1,19.1)

"BLD",2773,"KRN","B",101,101)

"BLD",2773,"KRN","B",409.61,409.61)

"BLD",2773,"KRN","B",771,771)

"BLD",2773,"KRN","B",870,870)

"BLD",2773,"KRN","B",8994,8994)

"BLD",2773,"QUES",0)
^9.62^^
"BLD",2773,"REQB",0)
^9.611^2^2
"BLD",2773,"REQB",1,0)
ORDER ENTRY/RESULTS REPORTING 3.0^2
"BLD",2773,"REQB",2,0)
OR*3.0*65^2
"BLD",2773,"REQB","B","OR*3.0*65",2)

"BLD",2773,"REQB","B","ORDER ENTRY/RESULTS REPORTING 3.0",1)

"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
104^3010416
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORCNOTE")
0^1^B56454982
"RTN","ORCNOTE",1,0)
ORCNOTE ; SLC/MKB - Progress Note actions ;25-JAN-2001 16:18:00
"RTN","ORCNOTE",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**22,48,65,104**;Dec 17, 1997
"RTN","ORCNOTE",3,0)
ELSIG ; Sign rec
"RTN","ORCNOTE",4,0)
 N ASK,TIUEVNT,TIUDA,TIUES,TIUI,X,X1,Y,ORI,NMBR,ORPICK,ORQUIT,IDX,TIUPOP,TIUPRM0,TIUPRM1
"RTN","ORCNOTE",5,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","ORCNOTE",6,0)
 I $P(TIUPRM0,U,2)'>0 W !,"Electronic signature not yet enabled." H 3 G ELSIGX
"RTN","ORCNOTE",7,0)
 S ORPICK="",VALMBCK=""
"RTN","ORCNOTE",8,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("sign") Q:'ORNMBR
"RTN","ORCNOTE",9,0)
 I +ORNMBR D FULL^VALM1
"RTN","ORCNOTE",10,0)
 S ORI=1
"RTN","ORCNOTE",11,0)
 F  S NMBR=$P(ORNMBR,",",ORI) Q:+NMBR'>0!$D(ORQUIT)  D
"RTN","ORCNOTE",12,0)
 . N TIU0,TIU12,TIU15,TIUSTAT,TIUEVNT,TIUTYPE,TIUDA
"RTN","ORCNOTE",13,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR)),ORI=+$G(ORI)+1
"RTN","ORCNOTE",14,0)
 . S TIUDA=+IDX,TIU0=$G(^TIU(8925,+TIUDA,0)),TIU12=$G(^(12)),TIU15=$G(^(15))
"RTN","ORCNOTE",15,0)
 . S TIUSTAT=+$P(TIU0,U,5)
"RTN","ORCNOTE",16,0)
 . S TIUTYPE=$$PNAME^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","ORCNOTE",17,0)
 . S TIUEVNT=$S(+TIUSTAT'>5:"SIGNATURE",1:"COSIGNATURE")
"RTN","ORCNOTE",18,0)
 . S ASK=$$CANDO^TIULP(TIUDA,TIUEVNT)
"RTN","ORCNOTE",19,0)
 . I +ASK>0 D
"RTN","ORCNOTE",20,0)
 . . L +^TIU(8925,+TIUDA):1
"RTN","ORCNOTE",21,0)
 . . E  S ASK="0^ Another user is editing this entry."
"RTN","ORCNOTE",22,0)
 . I +ASK'>0,$P(ASK,U,2)]"" D  I 1
"RTN","ORCNOTE",23,0)
 . . D FULL^VALM1
"RTN","ORCNOTE",24,0)
 . . W !!,"Item #: ",NMBR,!,$P(ASK,U,2),!
"RTN","ORCNOTE",25,0)
 . . W !,"Removed from signature list.",!
"RTN","ORCNOTE",26,0)
 . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","ORCNOTE",27,0)
 . E  D
"RTN","ORCNOTE",28,0)
 . . I $S(+$$REQCOSIG^TIULP(+TIU0,+TIUDA,DUZ):1,+$P(TIU15,U,6):1,1:0),(+$P(TIU12,U,8)'>0) D  Q:+$G(TIUPOP)
"RTN","ORCNOTE",29,0)
 . . . N COSIGNER
"RTN","ORCNOTE",30,0)
 . . . W !!,"Item #",NMBR,": ",TIUTYPE," for "
"RTN","ORCNOTE",31,0)
 . . . W $$PTNAME^TIULC1($P(TIU0,U,2))," will need cosignature..."
"RTN","ORCNOTE",32,0)
 . . . S COSIGNER=$$ASKCSNR^TIURS(TIUDA,DUZ)
"RTN","ORCNOTE",33,0)
 . . . I +COSIGNER'>0 D
"RTN","ORCNOTE",34,0)
 . . . . S TIUPOP=1
"RTN","ORCNOTE",35,0)
 . . . . W !!,"Item #",NMBR,": MUST have a cosigner, before you may sign."
"RTN","ORCNOTE",36,0)
 . . . . W !!,"Removed from signature list.",!
"RTN","ORCNOTE",37,0)
 . . . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","ORCNOTE",38,0)
 . . N TIU,TIUY
"RTN","ORCNOTE",39,0)
 . . D EN^VALM("ORC TIU SIGN/COSIGN")
"RTN","ORCNOTE",40,0)
 I +$G(ORPICK)'>0 D  G ELSIGX
"RTN","ORCNOTE",41,0)
 . S VALMSG="** Signature List Empty...Nothing signed. **"
"RTN","ORCNOTE",42,0)
 I +$G(ORPICK)>0 D
"RTN","ORCNOTE",43,0)
 . S TIUES=$$ASKSIG^TIULA1
"RTN","ORCNOTE",44,0)
 . I '+TIUES S VALMSG="** Nothing Signed. **" Q
"RTN","ORCNOTE",45,0)
 . F ORI=1:1:$L(ORPICK,",") S NMBR=$P(ORPICK,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCNOTE",46,0)
 . . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR)),TIUDA=+IDX
"RTN","ORCNOTE",47,0)
 . . D ES^TIURS(TIUDA,TIUES,NMBR)
"RTN","ORCNOTE",48,0)
 I $G(ORPICK)']"" S VALMSG="** Nothing Signed. **"
"RTN","ORCNOTE",49,0)
 E  S VALMSG="** Item"_$S($L(ORPICK,",")>1:"s ",1:" ")_ORPICK_" Signed. **"
"RTN","ORCNOTE",50,0)
ELSIGX K VALMY S VALMBCK="R"
"RTN","ORCNOTE",51,0)
 Q
"RTN","ORCNOTE",52,0)
ACCEPT(ORPICK,NMBR) ; Adds item(s) to signature list
"RTN","ORCNOTE",53,0)
 D FULL^VALM1
"RTN","ORCNOTE",54,0)
 S ORPICK=$G(ORPICK)_$S($L(ORPICK):",",1:"")_NMBR,OREBUILD=1
"RTN","ORCNOTE",55,0)
 W !,"Item #",NMBR," added to the signature list." H 3
"RTN","ORCNOTE",56,0)
 Q
"RTN","ORCNOTE",57,0)
SIGN ; -- sign notes
"RTN","ORCNOTE",58,0)
 N ORI,NMBR,ORQUIT,IDX,TIUDA S VALMBCK=""
"RTN","ORCNOTE",59,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("sign") Q:'ORNMBR
"RTN","ORCNOTE",60,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCNOTE",61,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCNOTE",62,0)
 . S TIUDA=+IDX Q:'+TIUDA
"RTN","ORCNOTE",63,0)
 . D EDSIG^TIURS(TIUDA,"",1)
"RTN","ORCNOTE",64,0)
 Q
"RTN","ORCNOTE",65,0)
 ;
"RTN","ORCNOTE",66,0)
ADDENDUM ; -- make addendum
"RTN","ORCNOTE",67,0)
 N ORI,NMBR,ORQUIT,IDX,TIUDA,TIUCHNG S VALMBCK=""
"RTN","ORCNOTE",68,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") Q:'ORNMBR
"RTN","ORCNOTE",69,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCNOTE",70,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCNOTE",71,0)
 . S TIUDA=+IDX Q:'+TIUDA
"RTN","ORCNOTE",72,0)
 . I +$$ISADDNDM^TIULC1(TIUDA) D  Q
"RTN","ORCNOTE",73,0)
 . . W !,$C(7),"You may not make addenda to addenda."
"RTN","ORCNOTE",74,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","ORCNOTE",75,0)
 . D CLEAR^VALM1,ADDEND1^TIURA1 I +$G(TIUCHNG) S OREBUILD=1
"RTN","ORCNOTE",76,0)
 . I '+$G(TIUCHNG) S VALMBCK="R"
"RTN","ORCNOTE",77,0)
 Q
"RTN","ORCNOTE",78,0)
 ;
"RTN","ORCNOTE",79,0)
EDIT ; -- edit notes
"RTN","ORCNOTE",80,0)
 N ORI,NMBR,ORQUIT,IDX,TIUDA,TIUCHNG S VALMBCK=""
"RTN","ORCNOTE",81,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("edit") Q:'ORNMBR
"RTN","ORCNOTE",82,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCNOTE",83,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCNOTE",84,0)
 . S TIUDA=+IDX Q:'+TIUDA
"RTN","ORCNOTE",85,0)
 . D CLEAR^VALM1,EDIT1^TIURA I +$G(TIUCHNG) S OREBUILD=1
"RTN","ORCNOTE",86,0)
 S VALMBCK="R"
"RTN","ORCNOTE",87,0)
 Q
"RTN","ORCNOTE",88,0)
COPY ; -- copy notes
"RTN","ORCNOTE",89,0)
 N ORI,NMBR,ORQUIT,IDX,TIUDA,TIUCHNG,ORTAB S VALMBCK=""
"RTN","ORCNOTE",90,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("copy") Q:'ORNMBR
"RTN","ORCNOTE",91,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCNOTE",92,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCNOTE",93,0)
 . S TIUDA=+IDX Q:'+TIUDA
"RTN","ORCNOTE",94,0)
 . D COPY1^TIURC I +$G(TIUCHNG) S OREBUILD=1
"RTN","ORCNOTE",95,0)
 . I '+$G(TIUCHNG) S VALMBCK="R"
"RTN","ORCNOTE",96,0)
 Q
"RTN","ORCNOTE",97,0)
DELETE ; -- delete notes
"RTN","ORCNOTE",98,0)
 N ORI,NMBR,ORQUIT,IDX,TIUDA,TIUCHNG S VALMBCK=""
"RTN","ORCNOTE",99,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("delete") Q:'ORNMBR
"RTN","ORCNOTE",100,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCNOTE",101,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCNOTE",102,0)
 . S TIUDA=+IDX Q:'+TIUDA
"RTN","ORCNOTE",103,0)
 . D DEL^TIURB(TIUDA) I +$G(TIUCHNG) S OREBUILD=1
"RTN","ORCNOTE",104,0)
 Q
"RTN","ORCNOTE",105,0)
SIGNERS ; -- Identify additional signers
"RTN","ORCNOTE",106,0)
 N ORI,NMBR,ORQUIT,IDX,TIUDA,TIUCHNG S VALMBCK=""
"RTN","ORCNOTE",107,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") Q:'ORNMBR
"RTN","ORCNOTE",108,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCNOTE",109,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCNOTE",110,0)
 . S TIUDA=+IDX Q:'+TIUDA
"RTN","ORCNOTE",111,0)
 . D FULL^VALM1,SIGNER^TIURA1
"RTN","ORCNOTE",112,0)
 S VALMBCK="R"
"RTN","ORCNOTE",113,0)
 Q
"RTN","ORCNOTE",114,0)
PRINT ; Print selected documents
"RTN","ORCNOTE",115,0)
 N DFN,TIUDA,TIUDPRM,TIUDARR,TIUDATA,TIUI,DIROUT,TIUDE,POP,TIUPFLG
"RTN","ORCNOTE",116,0)
 N TIUSPG,TIUDEV
"RTN","ORCNOTE",117,0)
 S VALMBCK="" I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("print") Q:'ORNMBR
"RTN","ORCNOTE",118,0)
 D CLEAR^VALM1
"RTN","ORCNOTE",119,0)
 I +$$CHARTANY(ORNMBR) S TIUPFLG=$$FLAG^TIUPRPN3
"RTN","ORCNOTE",120,0)
 S TIUSPG=1
"RTN","ORCNOTE",121,0)
 S TIUDEV=$$DEVICE^TIUDEV(.IO) ; Get Device/allow queueing
"RTN","ORCNOTE",122,0)
 I $S(IO']"":1,TIUDEV']"":1,1:0) G PRINTX
"RTN","ORCNOTE",123,0)
 I $D(IO("Q")) D QUE^TIUDEV("PRINTN^ORCNOTE",TIUDEV) G PRINTX
"RTN","ORCNOTE",124,0)
 D PRINTN
"RTN","ORCNOTE",125,0)
PRINTX N IOSTBM D ^%ZISC,FIXLST^TIULM
"RTN","ORCNOTE",126,0)
 K VALMY S VALMBCK="R"
"RTN","ORCNOTE",127,0)
 Q
"RTN","ORCNOTE",128,0)
CHARTANY(ORNMBR) ; Evaluate selected documents for chart print
"RTN","ORCNOTE",129,0)
 N ORI,NMBR,ORSLT S ORSLT=0
"RTN","ORCNOTE",130,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) Q:+NMBR'>0!+ORSLT  D
"RTN","ORCNOTE",131,0)
 . N IDX,TIUDA
"RTN","ORCNOTE",132,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCNOTE",133,0)
 . S TIUDA=+IDX Q:'TIUDA
"RTN","ORCNOTE",134,0)
 . S ORSLT=+$$CHARTONE^TIURA1(TIUDA)
"RTN","ORCNOTE",135,0)
 Q ORSLT
"RTN","ORCNOTE",136,0)
PRINTN ; Loop through selected doc's & invoke print code as appropriate
"RTN","ORCNOTE",137,0)
 N TIUI,TIUTYP,ORINDX,ORY,DFN K ^TMP("TIUPR",$J)
"RTN","ORCNOTE",138,0)
 N ORI,NMBR,ORQUIT,IDX,TIUDA,TIUCHNG
"RTN","ORCNOTE",139,0)
 U IO
"RTN","ORCNOTE",140,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)!$D(DIROUT)
"RTN","ORCNOTE",141,0)
 . N TIUPMTHD,TIUTYP,TIUPFHDR,TIUPFNBR,TIUPGRP,TIUPRINT,TIUDTYP,TIUFLAG
"RTN","ORCNOTE",142,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCNOTE",143,0)
 . S TIUDA=+IDX Q:'+TIUDA  Q:'$D(^TIU(8925,TIUDA,0))
"RTN","ORCNOTE",144,0)
 . S TIUTYP=$P($G(^TIU(8925,TIUDA,0)),U)
"RTN","ORCNOTE",145,0)
 . ; Evaluate whether user can print record
"RTN","ORCNOTE",146,0)
 . S TIUPRINT=$$CANDO^TIULP(TIUDA,"PRINT RECORD")
"RTN","ORCNOTE",147,0)
 . I +TIUPRINT'>0 D  Q  ; Exclude records user can't print
"RTN","ORCNOTE",148,0)
 . . W !!,"Item #",ORI,": ",!,$P(TIUPRINT,U,2),!
"RTN","ORCNOTE",149,0)
 . . I IO=IO(0),'$D(ZTQUEUED),$$READ^TIUU("EA","RETURN to continue...")
"RTN","ORCNOTE",150,0)
 . I +$G(TIUPFLG) S TIUFLAG=+$$CHARTONE^TIURA1(TIUDA)
"RTN","ORCNOTE",151,0)
 . S DFN=$P($G(^TIU(8925,+TIUDA,0)),U,2)
"RTN","ORCNOTE",152,0)
 . I +TIUTYP D
"RTN","ORCNOTE",153,0)
 . . S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYP)
"RTN","ORCNOTE",154,0)
 . . S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYP)
"RTN","ORCNOTE",155,0)
 . . S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYP)
"RTN","ORCNOTE",156,0)
 . . S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYP)
"RTN","ORCNOTE",157,0)
 . I +$$ISADDNDM^TIULC1(TIUDA) D
"RTN","ORCNOTE",158,0)
 . . S TIUDA=+$P($G(^TIU(8925,TIUDA,0)),U,6)
"RTN","ORCNOTE",159,0)
 . . S TIUDTYP=+$G(^TIU(8925,TIUDA,0))
"RTN","ORCNOTE",160,0)
 . I +$G(^TIU(8925,TIUDA,21))>0 D
"RTN","ORCNOTE",161,0)
 . . S TIUDA=+$G(^TIU(8925,TIUDA,21))
"RTN","ORCNOTE",162,0)
 . . S TIUDTYP=+$G(^TIU(8925,TIUDA,0))
"RTN","ORCNOTE",163,0)
 . Q:+$D(ORINDX(TIUDA))
"RTN","ORCNOTE",164,0)
 . I +$G(TIUDTYP)>0 D
"RTN","ORCNOTE",165,0)
 . . S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUDTYP)
"RTN","ORCNOTE",166,0)
 . . S TIUPGRP=$$PRNTGRP^TIULG(+TIUDTYP)
"RTN","ORCNOTE",167,0)
 . . S TIUPFHDR=$$PRNTHDR^TIULG(+TIUDTYP)
"RTN","ORCNOTE",168,0)
 . . S TIUPFNBR=$$PRNTNBR^TIULG(+TIUDTYP)
"RTN","ORCNOTE",169,0)
 . I $G(TIUPMTHD)]"",+$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") S ORY(TIUPMTHD,$G(TIUPGRP)_"$"_TIUPFHDR_";"_DFN,ORI,TIUDA)=TIUPFNBR
"RTN","ORCNOTE",170,0)
 . E  S ORY(TIUPMTHD,DFN,ORI,TIUDA)=""
"RTN","ORCNOTE",171,0)
 . S ORINDX(TIUDA)=ORI
"RTN","ORCNOTE",172,0)
 S TIUPMTHD="" F  S TIUPMTHD=$O(ORY(TIUPMTHD)) Q:TIUPMTHD=""  D
"RTN","ORCNOTE",173,0)
 . D PRNTDOC^TIURA(TIUPMTHD,.ORY)
"RTN","ORCNOTE",174,0)
 Q
"RTN","ORCNOTE",175,0)
BROWSE ; -- browse document
"RTN","ORCNOTE",176,0)
 N ORI,NMBR,ORQUIT,IDX,TIUDA,TIUCHNG,TIUQUIT S VALMBCK=""
"RTN","ORCNOTE",177,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("browse") Q:'ORNMBR
"RTN","ORCNOTE",178,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCNOTE",179,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCNOTE",180,0)
 . S TIUDA=+IDX Q:'+TIUDA
"RTN","ORCNOTE",181,0)
 . D CLEAR^VALM1,BROWS1^TIURA("TIU BROWSE FOR CLINICIAN")
"RTN","ORCNOTE",182,0)
 . S VALMBCK="R" S:+$G(TIUCHNG) OREBUILD=1
"RTN","ORCNOTE",183,0)
 . I +$G(TIUQUIT) S ORQUIT=1
"RTN","ORCNOTE",184,0)
 Q
"RTN","ORCNOTE",185,0)
 ;
"RTN","ORCNOTE",186,0)
EX ; -- exit action
"RTN","ORCNOTE",187,0)
 D:$G(OREBUILD) TAB^ORCHART(ORTAB,1)
"RTN","ORCNOTE",188,0)
 S:$D(^TMP("OR",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","ORCNOTE",189,0)
 Q
"VER")
8.0^22.0
**END**
**END**
