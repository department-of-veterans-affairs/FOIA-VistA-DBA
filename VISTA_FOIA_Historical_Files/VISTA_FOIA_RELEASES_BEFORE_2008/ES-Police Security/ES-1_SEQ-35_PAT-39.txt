$TXT Created by BECKWITH,RALPH at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Monday, 02/23/04 at 10:14
=============================================================================
Run Date: APR 19, 2004                     Designation: ES*1*39
Package : ES - POLICE & SECURITY              Priority: Mandatory
Version : 1        SEQ #35                      Status: Released
                  Compliance Date: MAY 20, 2004
=============================================================================

Associated patches: (v)ES*1*25     <<= must be installed BEFORE `ES*1*39'
                    (v)ES*1*27     <<= must be installed BEFORE `ES*1*39'
                    (v)ES*1*36     <<= must be installed BEFORE `ES*1*39'

Subject: FIX REPORT PROBLEMS

Category: 
  - Data Dictionary
  - Routine

Description:
============

 When going back and printing old journal entries and offense reports the 
 officers badges/rank are not correct for the timeframe.  Any officer that 
 has had a badge/rank change is causing the old reports to reflect their 
 current badge/rank and not the badge/rank at time of journal/offense data 
 entry.  This has raised concerns about legal issues for court/fraud 
 purposes.
  
 ASSOCIATED NOIS:
 ================ 
 HWH-0703-41270  Officer information incorrect on old reports
  
 ASSOCIATED E3R(s):
 ==================
 N/A
  
 PARTICIPATING TEST SITES:
 =========================
 Big Springs,TX
 Lexington,KY
 Heartland West,KS
 Salisbury,NC 
  
 NOIS OVERVIEW:
 =============
 HWH-0703-41270  Officer information incorrect on old reports
  
    Problem:
    --------
   1. When printing old journal entries using the Print Daily
      Journal [ESP PRINT JOURNAL] Option the officer data for
      the entry will print incorrect rank when there has been
      a subsequent rank change for the officer after the  
      original journal entry.
  
   2. When printing old offense reports using the Print Offense
      Report [ESP PRINT OFFENSE REPORT] Option the officer data
      for the entry will print incorrect officer badge when
      there has been a subsequent badge change for the officer
      after the original offense entry.
  
   
    Resolution:
    ----------
   
   1.When running Add a Journal Entry [ESP ADD JOURNAL ENTRY] or
     Create a Daily Journal [ESP CREATE JOURNAL] the officer
     badge/rank will be captured at that time and reported from
     the DAILY JOURNAL ENTRY file in lieu of pointing back to the
     NEW PERSON file where changes may have occurred.
  
   2.When running Create Offense Report [ESP OFFENSE REPORT INPUT]
     or Edit Offense Report [ESP EDIT OWN OFFENSE REPORT] the 
     investigating officer badge/rank will be captured at that time
     and reported from the ESP OFFENSE REPORT file in lieu of 
     pointing back to the NEW PERSON file where changes may have
     occurred.
  
  
 ROUTINE SUMMARY
 ===============
 The following is a list of the routines included in this patch. The 
 second line of each of these routines now looks like: 
  
   <tab> ;;3.0;DSS EXTRACTS;**[PATCH LIST]**;Dec 22, 1997
  
  
                        CHECK^XTSUMBLD results
   Routine name     Before Patch     After Patch    Patch List
   ------------     ------------     -----------    ----------
  
   ESPCRJO            853851          1278031       **27,37,39** 
   ESPJOU            7434533          7504822       **1,7,12,14,17
                                                      26,27,39**
   ESPOFF            9992957         10987143       **9,12,27,39**
   ESPOFF1          11861002         11861096       **39**
   ESPORP            6622157          6786329       **14,17,27,36,39**
   ESPORP5           5277580          5138226       **11,14,17,21,25
                                                      39**
   ESP0FF2           7874513          7962753       **39**       
   
  
 INSTALLATION INSTRUCTIONS
 =========================
 This patch can be loaded with users in the system.  Installation time
 will be less than 2 minutes.
  
  1.  Choose the PackMan message containing this patch and invoke the 
      INSTALL/CHECK MESSAGE PackMan option.  
  
  2.  (DSM for Open VMS sites only) Disable routine mapping on all systems
      for the routines listed in the Routine Summary.
  
      NOTE:  If the routines included in this patch are not currently
      in your mapped routine set, please skip this step.
  
  3.  Start up the Kernel Installation and Distribution System Menu
      [XPD MAIN]: 
  
           Edits and Distribution ...  
           Utilities ...  
           Installation ...  
  
      Select Kernel Installation & Distribution System Option: Installation
                                                               ---
           1      Load a Distribution
           2      Verify Checksums in Transport Global
           3      Print Transport Global
           4      Compare Transport Global to Current System
           5      Backup a Transport Global
           6      Install Package(s)
                  Restart Install of Package(s)
                  Unload a Distribution
  
  4.  From this menu, you may elect to use the following options
      (When prompted for the INSTALL NAME, enter ES*1.0*39):
      
      a.  Backup a Transport Global - This option will create a backup
          message of any routines exported with this patch. It will
          not backup any other changes such as DD's or templates.
      b.  Compare Transport Global to Current System - This option
          will allow you to view all changes that will be made when
          this patch is installed.  It compares all components of this
          patch (routines, DD's, templates, etc.).
      c.  Verify Checksums in Transport Global - This option will
          allow you to ensure the integrity of the routines that are
          in the transport global.
  
  5.  Use the Install Package(s) option and select the package
      ES*1.0*39.
  
       a.  When prompted 'Want KIDS to INHIBIT LOGONs during the
           install? YES//', answer NO.
  
       b.  When prompted 'Want to DISABLE Scheduled Options, Menu
           Options, and Protocols? YES//' answer YES.
        
       Menu Options:  Edit Offense Report    [ESP EDIT OWN OFFENSE REPORT] 
                      Create Offense Report  [ESP OFFENSE REPORT INPUT]
                      Add a Journal Entry    [ESP ADD JOURNAL ENTRY]
                      Create a Journal Entry [ESP CREATE JOURNAL]
                      Print Daily Journal    [ESP PRINT JOURNAL]
                      Print Offense Report   [ESP PRINT OFFENSE REPORT]
    
  6.  (DSM for Open VMS sites only) Optional - Include the routines
      distributed with this patch in the mapped routine set.
  
      NOTE: This step is only necessary if you performed step 3 or if
      you wish to include the routines in your mapped set.
  
  7.  File re-indexing for #916-ESP DAILY JOURNAL and #912-ESP OFFENSE
      REPORT.
  
      *** Please lock out all police main menu options to prevent
          any use of these files while they are being re-indexed.
      
      RE-INDEX:  
   
      A.  916  ESP DAILY JOURNAL
  
      MNT,VBB>D P^DI
  
  
      VA FileMan 22.0
  
  
      Select OPTION: ?
        Answer with OPTION NUMBER, or NAME
        Choose from:
        1            ENTER OR EDIT FILE ENTRIES
        2            PRINT FILE ENTRIES
        3            SEARCH FILE ENTRIES
        4            MODIFY FILE ATTRIBUTES
        5            INQUIRE TO FILE ENTRIES
        6            UTILITY FUNCTIONS
        7            OTHER OPTIONS
        8            DATA DICTIONARY UTILITIES
        9            TRANSFER ENTRIES
    
  
       Select OPTION: 6  UTILITY FUNCTIONS
   
       Select OPTION: ?
       Answer with UTILITY OPTION NUMBER, or NAME
       Do you want the entire 11-Entry UTILITY OPTION List? Y  (Yes)
       Choose from:
        1            VERIFY FIELDS
        2            CROSS-REFERENCE A FIELD OR FILE
        3            IDENTIFIER
        4            RE-INDEX FILE
        5            INPUT TRANSFORM (SYNTAX)
        6            EDIT FILE
        7            OUTPUT TRANSFORM
        8            TEMPLATE EDIT
        9            UNEDITABLE DATA
        10           MANDATORY/REQUIRED FIELD CHECK
        11           KEY DEFINITION
  
      Select UTILITY OPTION: 4  RE-INDEX FILE
  
      MODIFY WHAT FILE: ESP DAILY JOURNAL// 
  
      THERE ARE 7 INDICES WITHIN THIS FILE
      DO YOU WISH TO RE-CROSS-REFERENCE ONE PARTICULAR INDEX? No// N  (No)
      OK, ARE YOU SURE YOU WANT TO KILL OFF THE EXISTING 7 INDICES? No// Y 
      (Yes)
      DO YOU THEN WANT TO 'RE-CROSS-REFERENCE'? Yes//   (Yes)
      ...SORRY, I'M WORKING AS FAST AS I CAN...............................
      FILE WILL NOW BE 'RE-CROSS-REFERENCED ...............................
    
   
      B.   912    ESP OFFENSE REPORT
  
      MNT,VBB>D P^DI
  
  
      VA FileMan 22.0
  
  
      Select OPTION: 6  UTILITY FUNCTIONS
      Select UTILITY OPTION: 4  RE-INDEX FILE
  
      MODIFY WHAT FILE: NEW PERSON// ESP OFFENSE REPORT    (1379 entries)
  
      THERE ARE 27 INDICES WITHIN THIS FILE
      DO YOU WISH TO RE-CROSS-REFERENCE ONE PARTICULAR INDEX? No// N  (No)
      OK, ARE YOU SURE YOU WANT TO KILL OFF THE EXISTING 27 INDICES? No// Y 
      (Yes)
      DO YOU THEN WANT TO 'RE-CROSS-REFERENCE'? Yes// Y  (Yes)
      ...EXCUSE ME, JUST A MOMENT PLEASE................
      FILE WILL NOW BE 'RE-CROSS-REFERENCED'..............................
  
 Note:     
 The re-indexing will associate the "current" badge/rank with each 
 investigator or officer currently on file for any data entered prior to
 this patch. 
  
 Since the badge/rank will now be stored/reported in/from the pertinent file 
 along with the officer pointer to the new person file, it is necessary to
 run this re-indexing to store the badge/rank within the appropriate files.
 The re-indexing can only pull the most recent badge/rank for an 
 officer for previous cases, BUT all cases entered after this patch will 
 retain the badge/rank at time of data entry.

Routine Information:
====================

Routine Name:
  - ESPCRJO

 * OLD *   ;;1.0;POLICE & SECURITY;**27,37**;Mar 31, 1994
 * NEW *   ;;1.0;POLICE & SECURITY;**27,37,39**;Mar 31, 1994
 * ADD *   SET(NEWKEY,TYPE) ;PULL BADGE/RANK FOR SHIFT OFFICERS
 * ADD *   S 
 HESPN=DA,DIC="^VA(200,",DA=NEWKEY,DR="910.1;910.2",DIQ(0)="E",DIQ="P
 OLINF" D EN^DIQ1
 * ADD *   S:TYPE=1 SX=POLINF(200,DA,910.1,"E") S:TYPE=2 
 SX=POLINF(200,DA,910.2,"
 E")
 * ADD *   S DA=HESPN
 * ADD *   K DIC,DIQ,POLINF,HESPN
 * ADD *   Q SX

Routine Checksum:
1278031

Routine Name:
  - ESPJOU

 * OLD *   ;;1.0;POLICE & SECURITY;**1,7,12,14,17,26,27**;Mar 31, 1994
 * NEW *   ;;1.0;POLICE & SECURITY;**1,7,12,14,17,26,27,39**;Mar 31, 1994
 * OLD *   ..  S 
 DIC="^ESP(916,"_ESPID_",2,"_ESPN_",1,",DA=ESPN1,DR=".01",DIQ(0)=
 "EI" D EN^DIQ1 Q:'$D(^UTILITY("DIQ1",$J,916.31,DA,.01,"E"))
 * NEW *   ..  S 
 DIC="^ESP(916,"_ESPID_",2,"_ESPN_",1,",DA=ESPN1,DR=".01;.03",DIQ
 (0)="EI" D EN^DIQ1 Q:'$D(^UTILITY("DIQ1",$J,916.31,DA,.01,"E"))
 * OLD *   ..  W 
 ?27,$G(^UTILITY("DIQ1",$J,916.31,DA,.01,"E")),?55,$P($G(^VA(200,
 +^("I"),"ESP")),U,2),!
 * NEW *   ..  W 
 ?27,$G(^UTILITY("DIQ1",$J,916.31,DA,.01,"E")),?55,$G(^UTILITY("D
 IQ1",$J,916.31,DA,.03,"E")),!

Routine Checksum:
7504822

Routine Name:
  - ESPOFF

 * OLD *   ;;1.0;POLICE & SECURITY;**9,12,27**;Mar 31, 1994
 * NEW *   ;;1.0;POLICE & SECURITY;**9,12,27,39**;Mar 31, 1994
 * OLD *  POL S ESPX=".06" D RD G:$D(DUOUT)!($D(DTOUT)) NOUPD S:+Y 
 ESPD(.06)=+Y S
 :'+Y ESPD(.06)=""
 * NEW *  POL N TYPE S ESPX=".06" D RD G:$D(DUOUT)!($D(DTOUT)) NOUPD S:'+Y 
 ESPD(.
 06)="" I +Y S ESPD(.06)=+Y D SET(+Y,0)
 * OLD *   S 
 ^TMP($J,"UOR",0)="^"_ESPDTR_"^"_ESPD(.03)_"^"_ESPD(.04)_"^"_ESPD(.05
 )_"^"_ESPD(.06)_"^"_ESPD(.07)_"^O^"_ESPD(.09)
 * NEW *   S 
 ^TMP($J,"UOR",0)="^"_ESPDTR_"^"_ESPD(.03)_"^"_ESPD(.04)_"^"_ESPD(.05
 )_"^"_ESPD(.06)_"^"_ESPD(.07)_"^O^"_ESPD(.09)_"^^"_ESPD(.11)_"^"_ESPD(.12)
 * ADD *  SET(NEWKEY,TYPE) ;PULL BADGE/RANK FOR INVESTIGATOR
 * ADD *   S:TYPE>0 HDA=DA
 * ADD *   S 
 DIC="^VA(200,",DA=NEWKEY,DR="910.1;910.2",DIQ(0)="E",DIQ="POLINF" D 
 EN^DIQ1
 * ADD *   S:TYPE>0 
 SX=$S(TYPE=1:POLINF(200,DA,910.1,"E"),TYPE=2:POLINF(200,DA,91
 0.2,"E"),1:""),DI=.06
 * ADD *   S:TYPE=0 
 ESPD(.11)=POLINF(200,DA,910.1,"E"),ESPD(.12)=POLINF(200,DA,91
 0.2,"E")
 * ADD *   K DIC,DIQ,POLINF
 * ADD *   Q:TYPE=0
 * ADD *   S DA=HDA K HDA
 * ADD *   Q SX

Routine Checksum:
10987143

Routine Name:
  - ESPOFF1

 * OLD *   ;;1.0;POLICE & SECURITY;;Mar 31, 1994
 * NEW *   ;;1.0;POLICE & SECURITY;**39**;Mar 31, 1994
 * OLD *   S 
 ^ESP(912,ESPOFN,0)=ESPOFN_"^"_$P(UOR0,U,2,10),^ESP(912,ESPOFN,1)=$G(
 ^TMP($J,"UOR",1))
 * NEW *   S 
 ^ESP(912,ESPOFN,0)=ESPOFN_"^"_$P(UOR0,U,2,12),^ESP(912,ESPOFN,1)=$G(
 ^TMP($J,"UOR",1))

Routine Checksum:
11861096

Routine Name:
  - ESPORP

 * OLD *   ;;1.0;POLICE & SECURITY;**14,17,27,36**;Mar 31, 1994
 * NEW *   ;;1.0;POLICE & SECURITY;**14,17,27,36,39**;Mar 31, 1994
 * OLD *   S 
 DIC="^ESP(912,",DA=ESPID,DR=".02;.03;.04;.05;.06;.09",DIQ(0)="E" D E
 N^DIQ1 I '$D(^UTILITY("DIQ1",$J,912,DA)) W !,"RECORD DOESN'T EXIST!" G 
 EXIT
 * NEW *   S 
 DIC="^ESP(912,",DA=ESPID,DR=".02;.03;.04;.05;.06;.09;.11;.12",DIQ(0)
 ="E" D EN^DIQ1 I '$D(^UTILITY("DIQ1",$J,912,DA)) W !,"RECORD DOESN'T 
 EXIST!" G E
 XIT
 * ADD *   S BADGE=^UTILITY("DIQ1",$J,912,DA,.11,"E")
 * OLD *  EXIT K 
 %ZIS,CL,DA,DIC,DIQ,DIR,DIRUT,DIWF,DIWL,DIWR,DR,END,ESPDTR,ESPID,
 ESPN,ESPN1,IEN,PAGE,X,Y,ZTDESC,ZTRTN,ZTSAVE
 * NEW *  EXIT K 
 %ZIS,CL,DA,DIC,DIQ,DIR,DIRUT,DIWF,DIWL,DIWR,DR,END,ESPDTR,ESPID,
 ESPN,ESPN1,IEN,PAGE,X,Y,ZTDESC,ZTRTN,ZTSAVE,BADGE

Routine Checksum:
6786329

Routine Name:
  - ESPORP5

 * OLD *   ;;1.0;POLICE & SECURITY;**11,14,17,21,25**;Mar 31, 1994
 * NEW *   ;;1.0;POLICE & SECURITY;**11,14,17,21,25,39**;Mar 31, 1994
 * OLD *   W $G(^UTILITY("DIQ1",$J,200,DA,20.2,"E")),"   # 
 ",$G(^UTILITY("DIQ1",$
 J,200,DA,910.1,"E"))
 * NEW *   W $G(^UTILITY("DIQ1",$J,200,DA,20.2,"E")),"   # ",BADGE

Routine Checksum:
5138226

Routine Name:
  - ESPOFF2

 * OLD *   ;;1.0;POLICE & SECURITY;;Mar 31, 1994
 * NEW *   ;;1.0;POLICE & SECURITY;**39**;Mar 31, 1994
 * OLD *   S DIK="^ESP(912,",DA=ESPOFN D IX1^DIK K DIK,DA
 * NEW *   N DC S DC=$P(UOR0,U,6),DIK="^ESP(912,",DA=ESPOFN D IX1^DIK K 
 DIK,DA,DC

Routine Checksum:
7962753

=============================================================================
User Information:
Entered By  : BECKWITH,RALPH                Date Entered  : JAN 15, 2004
Completed By: ILUSTRISIMO,LUCY              Date Completed: APR 16, 2004
Released By : HUTCHINSON,PATRICIA ANN       Date Released : APR 19, 2004
=============================================================================


Packman Mail Message:
=====================

$END TXT
