Released PSS*1*83 SEQ #84
Extracted from mail message
**KIDS**:PSS*1.0*83^

**INSTALL NAME**
PSS*1.0*83
"BLD",5653,0)
PSS*1.0*83^PHARMACY DATA MANAGEMENT^0^3041018^y
"BLD",5653,1,0)
^^1^1^3040729^
"BLD",5653,1,1,0)
In some cases when ordering a drug the incorrect dispense unit shows.
"BLD",5653,4,0)
^9.64PA^^
"BLD",5653,"KRN",0)
^9.67PA^8989.52^19
"BLD",5653,"KRN",.4,0)
.4
"BLD",5653,"KRN",.401,0)
.401
"BLD",5653,"KRN",.402,0)
.402
"BLD",5653,"KRN",.403,0)
.403
"BLD",5653,"KRN",.5,0)
.5
"BLD",5653,"KRN",.84,0)
.84
"BLD",5653,"KRN",3.6,0)
3.6
"BLD",5653,"KRN",3.8,0)
3.8
"BLD",5653,"KRN",9.2,0)
9.2
"BLD",5653,"KRN",9.8,0)
9.8
"BLD",5653,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5653,"KRN",9.8,"NM",1,0)
PSSORUTL^^0^B78187426
"BLD",5653,"KRN",9.8,"NM",2,0)
PSSOPKI1^^0^B73244254
"BLD",5653,"KRN",9.8,"NM",3,0)
PSSORUTE^^0^B635699
"BLD",5653,"KRN",9.8,"NM","B","PSSOPKI1",2)
 
"BLD",5653,"KRN",9.8,"NM","B","PSSORUTE",3)
 
"BLD",5653,"KRN",9.8,"NM","B","PSSORUTL",1)
 
"BLD",5653,"KRN",19,0)
19
"BLD",5653,"KRN",19.1,0)
19.1
"BLD",5653,"KRN",101,0)
101
"BLD",5653,"KRN",409.61,0)
409.61
"BLD",5653,"KRN",771,0)
771
"BLD",5653,"KRN",870,0)
870
"BLD",5653,"KRN",8989.51,0)
8989.51
"BLD",5653,"KRN",8989.52,0)
8989.52
"BLD",5653,"KRN",8994,0)
8994
"BLD",5653,"KRN","B",.4,.4)
 
"BLD",5653,"KRN","B",.401,.401)
 
"BLD",5653,"KRN","B",.402,.402)
 
"BLD",5653,"KRN","B",.403,.403)
 
"BLD",5653,"KRN","B",.5,.5)
 
"BLD",5653,"KRN","B",.84,.84)
 
"BLD",5653,"KRN","B",3.6,3.6)
 
"BLD",5653,"KRN","B",3.8,3.8)
 
"BLD",5653,"KRN","B",9.2,9.2)
 
"BLD",5653,"KRN","B",9.8,9.8)
 
"BLD",5653,"KRN","B",19,19)
 
"BLD",5653,"KRN","B",19.1,19.1)
 
"BLD",5653,"KRN","B",101,101)
 
"BLD",5653,"KRN","B",409.61,409.61)
 
"BLD",5653,"KRN","B",771,771)
 
"BLD",5653,"KRN","B",870,870)
 
"BLD",5653,"KRN","B",8989.51,8989.51)
 
"BLD",5653,"KRN","B",8989.52,8989.52)
 
"BLD",5653,"KRN","B",8994,8994)
 
"BLD",5653,"QUES",0)
^9.62^^
"BLD",5653,"REQB",0)
^9.611^1^1
"BLD",5653,"REQB",1,0)
PSS*1.0*69^1
"BLD",5653,"REQB","B","PSS*1.0*69",1)
 
"MBREQ")
0
"PKG",488,-1)
1^1
"PKG",488,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",488,20,0)
^9.402P^^
"PKG",488,22,0)
^9.49I^1^1
"PKG",488,22,1,0)
1.0^2970930^3000316^66481
"PKG",488,22,1,"PAH",1,0)
83^3041018
"PKG",488,22,1,"PAH",1,1,0)
^^1^1^3041018
"PKG",488,22,1,"PAH",1,1,1,0)
In some cases when ordering a drug the incorrect dispense unit shows.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSSOPKI1")
0^2^B73244254
"RTN","PSSOPKI1",1,0)
PSSOPKI1 ;BIR/MHA-DEA/PKI CPRS Dosage call ;03/29/02
"RTN","PSSOPKI1",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**61,69,83**;9/30/97
"RTN","PSSOPKI1",3,0)
 ;Reference ^PS(50.607 - DBIA 2221
"RTN","PSSOPKI1",4,0)
 ;Reference ^YSCL(603.01 - DBIA 2697
"RTN","PSSOPKI1",5,0)
 ;
"RTN","PSSOPKI1",6,0)
DOSE(PSSX,PD,TYPE,PSSDFN) ;
"RTN","PSSOPKI1",7,0)
 K PSSX
"RTN","PSSOPKI1",8,0)
 ; PSSX - Target array
"RTN","PSSOPKI1",9,0)
 ; PD - Orderable Item
"RTN","PSSOPKI1",10,0)
 ; TYPE - O:Outpt, U:Unit Dose, I:IV, X:Non-VA Med
"RTN","PSSOPKI1",11,0)
 ; PSSDFN - Patient
"RTN","PSSOPKI1",12,0)
 ;
"RTN","PSSOPKI1",13,0)
 N DLOOP,DCNT1,DLOOP1,LOW,FORM,PSSOIU,PSSLOW,PSSLOW1,PSSLOW2,PSOLC,PL,PSSHOLD,PSSA,PSSZ,PSSC,PSIEN,PSSTRN,PSSDSE,PSSVERB,PSSPREP,PSSCLO,PSSDEA,PSSMAX,PSSDLP,PSNN,PSNNN,PSSREQS,PSSLOW4,PL2,PSSA1,PL3,PSSUNITX,PSSLD,PSSLD1
"RTN","PSSOPKI1",14,0)
 N PSSDOSE,PSSUNTS,PSSUDOS,PSSQT,PSSBCM,PSSHLF
"RTN","PSSOPKI1",15,0)
 S PSSOIU=$S(TYPE="I":1,TYPE="U":1,1:0)
"RTN","PSSOPKI1",16,0)
 F DLOOP=0:0 S DLOOP=$O(^PSDRUG("ASP",PD,DLOOP)) Q:'DLOOP  D
"RTN","PSSOPKI1",17,0)
 .Q:'$O(^PSDRUG(DLOOP,"DOS1",0))
"RTN","PSSOPKI1",18,0)
 .S PSSTRN=$P($G(^PSDRUG(DLOOP,"DOS")),"^"),PSSUNITX=$P($G(^("DOS")),"^",2) Q:PSSTRN=""
"RTN","PSSOPKI1",19,0)
 .S PSSUNITX=$S($P($G(^PS(50.607,+$G(PSSUNITX),0)),"^")'=""&($P($G(^(0)),"^")'["/"):$P($G(^(0)),"^"),1:"")
"RTN","PSSOPKI1",20,0)
 .I $P($G(^PSDRUG(DLOOP,"I")),"^"),+$P($G(^("I")),"^")<DT Q
"RTN","PSSOPKI1",21,0)
 .D APP Q:PSSQT
"RTN","PSSOPKI1",22,0)
 .S PSSDSE=+$P($G(^PS(50.7,PD,0)),"^",2),PSSVERB=$P($G(^PS(50.606,PSSDSE,"MISC")),"^"),PSSPREP=$P($G(^("MISC")),"^",3)
"RTN","PSSOPKI1",23,0)
 .K PSNNN F PSNN=0:0 S PSNN=$O(^PS(50.606,PSSDSE,"NOUN",PSNN)) Q:'PSNN!($D(PSNNN))  S:$P($G(^(PSNN,0)),"^")'="" PSNNN=$P($G(^(0)),"^")
"RTN","PSSOPKI1",24,0)
 .; possible doses
"RTN","PSSOPKI1",25,0)
 .F DLOOP1=0:0 S DLOOP1=$O(^PSDRUG(DLOOP,"DOS1",DLOOP1)) Q:'DLOOP1  D
"RTN","PSSOPKI1",26,0)
 ..Q:'$D(^PSDRUG(DLOOP,"DOS1",DLOOP1,0))
"RTN","PSSOPKI1",27,0)
 ..I PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^",3)'["I" Q
"RTN","PSSOPKI1",28,0)
 ..I 'PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^",3)'["O" Q
"RTN","PSSOPKI1",29,0)
 ..S (PSSDOSE,PSSUNTS,PSSUDOS)=""
"RTN","PSSOPKI1",30,0)
 ..S PSSDOSE=$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^",2)
"RTN","PSSOPKI1",31,0)
 ..S PSSUNTS=$P($G(^PS(50.607,+$P($G(^PSDRUG(DLOOP,"DOS")),"^",2),0)),"^")
"RTN","PSSOPKI1",32,0)
 ..S PSSUDOS=$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^"),PSSBCM=$P($G(^(0)),"^",4) I PSSUDOS["." S PSSHLF(DLOOP)=""
"RTN","PSSOPKI1",33,0)
 ..I PSSDOSE]""&(PSSUDOS]"") D
"RTN","PSSOPKI1",34,0)
 ...S DCNT1=$S('$D(DCNT1):1,1:DCNT1+1)
"RTN","PSSOPKI1",35,0)
 ...S LOW(PSSDOSE,PSSUDOS,DCNT1)=""
"RTN","PSSOPKI1",36,0)
 ...S FORM(PSSDOSE,$S($P($G(^PSDRUG(DLOOP,0)),"^",9)=1:1,1:0),DCNT1)=PSSUDOS
"RTN","PSSOPKI1",37,0)
 ...D PARN
"RTN","PSSOPKI1",38,0)
 ...S PSSX(DCNT1)=PSSDOSE_"^"_PSSUNTS_"^"_$S($E($G(PSSUDOS),1)=".":"0",1:"")_PSSUDOS_"^"_$S($G(PSSNP)'="":$G(PSSNP),1:$G(PSNNN))_"^^"_DLOOP_"^"_$$PRICE^PSSUTLA1 K PSSNP
"RTN","PSSOPKI1",39,0)
 I '$O(PSSX(0)) G DOSE2
"RTN","PSSOPKI1",40,0)
 ; delete n/f duplicate doses
"RTN","PSSOPKI1",41,0)
 S PSSLOW="" F  S PSSLOW=$O(FORM(PSSLOW)) Q:PSSLOW=""  D
"RTN","PSSOPKI1",42,0)
 .I $O(FORM(PSSLOW,0,0)) S PSSLOW2="" F  S PSSLOW2=$O(FORM(PSSLOW,1,PSSLOW2)) Q:PSSLOW2=""  K PSSX(PSSLOW2),LOW(PSSLOW,+$G(FORM(PSSLOW,1,PSSLOW2)),PSSLOW2)
"RTN","PSSOPKI1",43,0)
 ;Lowest UPD
"RTN","PSSOPKI1",44,0)
 S PSSLOW="" F  S PSSLOW=$O(LOW(PSSLOW)) Q:PSSLOW=""  D
"RTN","PSSOPKI1",45,0)
 .S PSOLC=0 S PSSLOW1="" F  S PSSLOW1=$O(LOW(PSSLOW,PSSLOW1)) Q:PSSLOW1=""  D
"RTN","PSSOPKI1",46,0)
 ..S PSOLC=PSOLC+1 S:PSOLC=1 PSSLOW4=$O(LOW(PSSLOW,PSSLOW1,0))
"RTN","PSSOPKI1",47,0)
 ..S PSSLOW2="" F  S PSSLOW2=$O(LOW(PSSLOW,PSSLOW1,PSSLOW2)) Q:PSSLOW2=""  D
"RTN","PSSOPKI1",48,0)
 ...I PSOLC>1 S PSSX(PSSLOW4,(PSOLC-1))=PSSX(PSSLOW2) K PSSX(PSSLOW2)
"RTN","PSSOPKI1",49,0)
 K PSSHOLD S PL="" F  S PL=$O(PSSX(PL)) Q:PL=""  S PSSHOLD($P(PSSX(PL),"^"),PL)=PSSX(PL) I $O(PSSX(PL,0)) D
"RTN","PSSOPKI1",50,0)
 .S PL2="" F  S PL2=$O(PSSX(PL,PL2)) Q:PL2=""  S PSSHOLD($P(PSSX(PL,PL2),"^"),PL,PL2)=PSSX(PL,PL2)
"RTN","PSSOPKI1",51,0)
 K PSSX S PSSA=1,PSSZ="" F  S PSSZ=$O(PSSHOLD(PSSZ)) Q:PSSZ=""  F PSSC=0:0 S PSSC=$O(PSSHOLD(PSSZ,PSSC)) Q:'PSSC  S PSSX(PSSA)=PSSHOLD(PSSZ,PSSC) D SLS D:'$D(PSSX("DD",+$P(PSSX(PSSA),"^",6)))  D:$O(PSSHOLD(PSSZ,PSSC,0)) MULTI S PSSA=PSSA+1
"RTN","PSSOPKI1",52,0)
 .S (PSIEN,DLOOP)=+$P(PSSX(PSSA),"^",6) K PSSMAX D:$G(TYPE)["O" MAX
"RTN","PSSOPKI1",53,0)
 .;ELR;ADDED NEXT LINE PSS*1*83
"RTN","PSSOPKI1",54,0)
 .D SETU
"RTN","PSSOPKI1",55,0)
 .S PSSX("DD",PSIEN)=$P($G(^PSDRUG(PSIEN,0)),"^")_"^"_$P($G(^(660)),"^",6)_"^"_$P($G(^(0)),"^",9)_"^"_$P($G(^(660)),"^",8)_"^"_$P($G(^("DOS")),"^")
"RTN","PSSOPKI1",56,0)
 .S PSSX("DD",PSIEN)=PSSX("DD",PSIEN)_"^"_$G(PSSUNITX)_"^"_$P($G(^PS(50.606,+$G(PSSDSE),0)),"^")_"^"_$G(PSSMAX)
"RTN","PSSOPKI1",57,0)
 .D REQS S PSSX("DD",PSIEN)=PSSX("DD",PSIEN)_"^"_$G(PSSREQS) D DEAPKI^PSSOPKI(PSIEN)
"RTN","PSSOPKI1",58,0)
 .S PSSX("MISC")=$G(PSSVERB)_"^"_$G(PSSPREP)_"^"_$P($G(^PS(50.606,+$G(PSSDSE),"MISC")),"^",4)
"RTN","PSSOPKI1",59,0)
 K PSSHOLD,PSSDZUNT
"RTN","PSSOPKI1",60,0)
 D LEAD^PSSUTLA1 D:$G(TYPE)["O" EN3^PSSUTLA1(PD,245)
"RTN","PSSOPKI1",61,0)
 S PSSX("DEA")=$$OIDEA^PSSOPKI(PD,TYPE)
"RTN","PSSOPKI1",62,0)
 Q
"RTN","PSSOPKI1",63,0)
DOSE2 ;Local doses
"RTN","PSSOPKI1",64,0)
 N PSOCT,PSONDS,PSOND,PSOND1,PSONDX,PSONDU,PSODOS,PSLOC,PSLOCV,PSODUPD,PSOXDOSE
"RTN","PSSOPKI1",65,0)
 S PSOCT=1
"RTN","PSSOPKI1",66,0)
 S PSOXDOSE=+$P($G(^PS(50.7,PD,0)),"^",2) K PSNNN
"RTN","PSSOPKI1",67,0)
 F DLOOP=0:0 S DLOOP=$O(^PSDRUG("ASP",PD,DLOOP)) Q:'DLOOP  D
"RTN","PSSOPKI1",68,0)
 .I $P($G(^PSDRUG(DLOOP,"I")),"^"),+$P($G(^("I")),"^")<DT Q
"RTN","PSSOPKI1",69,0)
 .D APP Q:PSSQT
"RTN","PSSOPKI1",70,0)
 .Q:'$O(^PSDRUG(DLOOP,"DOS2",0))
"RTN","PSSOPKI1",71,0)
 .S PSONDS=$P($G(^PSDRUG(DLOOP,"DOS")),"^"),PSONDU=$P($G(^("DOS")),"^",2),PSOND=$P($G(^("ND")),"^",3),PSOND1=$P($G(^("ND")),"^")
"RTN","PSSOPKI1",72,0)
 .I PSOND,PSOND1 I PSONDS=""!('PSONDU) S PSONDX=$$DFSU^PSNAPIS(PSOND1,PSOND)
"RTN","PSSOPKI1",73,0)
 .I PSONDS="",PSOND,PSOND1 S PSONDS=$P($G(PSONDX),"^",4) D NS
"RTN","PSSOPKI1",74,0)
 .I 'PSONDU,PSOND,PSOND1 S PSONDU=$P($G(PSONDX),"^",5)
"RTN","PSSOPKI1",75,0)
 .D NU
"RTN","PSSOPKI1",76,0)
 .S PSODOS=+$P($G(^PS(50.7,PD,0)),"^",2)
"RTN","PSSOPKI1",77,0)
 .F PSLOC=0:0 S PSLOC=$O(^PSDRUG(DLOOP,"DOS2",PSLOC)) Q:'PSLOC  D
"RTN","PSSOPKI1",78,0)
 ..S PSLOCV=$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^"),PSSBCM=$P($G(^(0)),"^",3) Q:PSLOCV=""
"RTN","PSSOPKI1",79,0)
 ..I PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^",2)'["I" Q
"RTN","PSSOPKI1",80,0)
 ..I 'PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^",2)'["O" Q
"RTN","PSSOPKI1",81,0)
 ..D SET2
"RTN","PSSOPKI1",82,0)
 ;no doses
"RTN","PSSOPKI1",83,0)
 K PSSBCM
"RTN","PSSOPKI1",84,0)
 I '$O(PSSX(0)) K PSLOCV S PSOCT=1 D
"RTN","PSSOPKI1",85,0)
 .F DLOOP=0:0 S DLOOP=$O(^PSDRUG("ASP",PD,DLOOP)) Q:'DLOOP  D
"RTN","PSSOPKI1",86,0)
 ..I $P($G(^PSDRUG(DLOOP,"I")),"^"),+$P($G(^("I")),"^")<DT Q
"RTN","PSSOPKI1",87,0)
 ..D APP Q:PSSQT
"RTN","PSSOPKI1",88,0)
 ..S PSONDS=$P($G(^PSDRUG(DLOOP,"DOS")),"^"),PSONDU=$P($G(^("DOS")),"^",2),PSOND=$P($G(^("ND")),"^",3),PSOND1=$P($G(^("ND")),"^")
"RTN","PSSOPKI1",89,0)
 ..K PSONDX I PSOND,PSOND1 I PSONDS=""!('PSONDU) S PSONDX=$$DFSU^PSNAPIS(PSOND1,PSOND)
"RTN","PSSOPKI1",90,0)
 ..I PSONDS="",PSOND,PSOND1 S PSONDS=$P($G(PSONDX),"^",4) D NS
"RTN","PSSOPKI1",91,0)
 ..I 'PSONDU,PSOND,PSOND1 S PSONDU=$P($G(PSONDX),"^",5)
"RTN","PSSOPKI1",92,0)
 ..D NU
"RTN","PSSOPKI1",93,0)
 ..S PSODOS=+$P($G(^PS(50.7,PD,0)),"^",2)
"RTN","PSSOPKI1",94,0)
 ..D SET3
"RTN","PSSOPKI1",95,0)
 D LEAD^PSSUTLA1 D:$G(TYPE)["O" EN3^PSSUTLA1(PD,245)
"RTN","PSSOPKI1",96,0)
 S PSSX("DEA")=$$OIDEA^PSSOPKI(PD,TYPE)
"RTN","PSSOPKI1",97,0)
 D DUP^PSSUTLA1
"RTN","PSSOPKI1",98,0)
 Q
"RTN","PSSOPKI1",99,0)
SET2 ;
"RTN","PSSOPKI1",100,0)
 I $G(PSLOCV)'="",$G(PSLOCV)["&" D AMP^PSSORPH1
"RTN","PSSOPKI1",101,0)
 K PSSUDOS S PSSX(PSOCT)="^"_$G(PSONDU)_"^^"_$G(PSNNN)_"^"_$G(PSLOCV)_"^"_DLOOP_"^"_$$PRICE^PSSUTLA1
"RTN","PSSOPKI1",102,0)
SET3 ;
"RTN","PSSOPKI1",103,0)
 I '$D(PSSX("DD",DLOOP)) D
"RTN","PSSOPKI1",104,0)
 .D REQS
"RTN","PSSOPKI1",105,0)
 .K PSSMAX I $G(TYPE)["O" D MAX
"RTN","PSSOPKI1",106,0)
 .S PSSX("DD",DLOOP)=$P($G(^PSDRUG(DLOOP,0)),"^")_"^"_$P($G(^(660)),"^",6)_"^"_$P($G(^(0)),"^",9)_"^"_$P($G(^(660)),"^",8)_"^"_$G(PSONDS)_"^"_$G(PSONDU)
"RTN","PSSOPKI1",107,0)
 .S PSSX("DD",DLOOP)=PSSX("DD",DLOOP)_"^"_$P($G(^PS(50.606,+$G(PSODOS),0)),"^")_"^"_$G(PSSMAX)_"^"_$G(PSSREQS) D DEAPKI^PSSOPKI(DLOOP)
"RTN","PSSOPKI1",108,0)
 .S PSSX("MISC")=$P($G(^PS(50.606,+$G(PSODOS),"MISC")),"^")_"^"_$P($G(^("MISC")),"^",3)_"^"_$P($G(^("MISC")),"^",4)
"RTN","PSSOPKI1",109,0)
 S PSOCT=PSOCT+1
"RTN","PSSOPKI1",110,0)
 Q
"RTN","PSSOPKI1",111,0)
MAX ;
"RTN","PSSOPKI1",112,0)
 K PSSMAX S PSSDEA=$P($G(^PSDRUG(DLOOP,0)),"^",3)
"RTN","PSSOPKI1",113,0)
 I PSSDEA["1"!(PSSDEA["2") S PSSMAX=0 Q
"RTN","PSSOPKI1",114,0)
 I PSSDEA["A",PSSDEA'["B" S PSSMAX=0 Q
"RTN","PSSOPKI1",115,0)
 I $P($G(^PSDRUG(DLOOP,"CLOZ1")),"^")="PSOCLO1",$G(PSSDFN) D  Q
"RTN","PSSOPKI1",116,0)
 .S PSSCLO=$O(^YSCL(603.01,"C",PSSDFN,0)) I PSSCLO,$P($G(^YSCL(603.01,+PSSCLO,0)),"^",3)="B" S PSSMAX=1 Q
"RTN","PSSOPKI1",117,0)
 .S PSSMAX=0
"RTN","PSSOPKI1",118,0)
 I PSSDEA["3"!(PSSDEA["4")!(PSSDEA["5") S PSSMAX=5 Q
"RTN","PSSOPKI1",119,0)
 S PSSMAX=11
"RTN","PSSOPKI1",120,0)
 Q
"RTN","PSSOPKI1",121,0)
SLS ;Dosage with /
"RTN","PSSOPKI1",122,0)
 K PSSDZUNT
"RTN","PSSOPKI1",123,0)
 I $P($G(PSSX(PSSA)),"^",2)'["/" S $P(PSSX(PSSA),"^",5)=$P($G(PSSX(PSSA)),"^")_$P($G(PSSX(PSSA)),"^",2) Q
"RTN","PSSOPKI1",124,0)
 N PSSF,PSSF1,PSSF2,PSSG,PSSFA,PSSFA1,PSSFB,PSSFB1,PSSDZI,PSSDZSL,PSSDZND,PSSDZSL1,PSSDZSL2,PSSDZSL3,PSSDZSL4,PSSDZSL5,PSSDZ50
"RTN","PSSOPKI1",125,0)
 S PSSF=$P($G(PSSX(PSSA)),"^"),PSSG=$P($G(PSSX(PSSA)),"^",2)
"RTN","PSSOPKI1",126,0)
 S PSSDZSL=0,PSSDZI=+$P($G(PSSX(PSSA)),"^",6),PSSDZ50=$P($G(^PSDRUG(PSSDZI,"DOS")),"^")
"RTN","PSSOPKI1",127,0)
 S PSSDZND=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(PSSDZI,"ND")),"^"),+$P($G(^PSDRUG(PSSDZI,"ND")),"^",3)) S PSSDZND=+$P($G(PSSDZND),"^",2) ;I $G(PSSDZND),$G(PSSDZ50),+$G(PSSDZND)'=+$G(PSSDZ50) S PSSDZSL=1
"RTN","PSSOPKI1",128,0)
 S PSSFA=$P(PSSG,"/"),PSSFB=$P(PSSG,"/",2),PSSFA1=+$G(PSSFA),PSSFB1=+$G(PSSFB)
"RTN","PSSOPKI1",129,0)
 I '$G(PSSDZND) S $P(PSSX(PSSA),"^",5)=$P(PSSX(PSSA),"^") G SLSQ
"RTN","PSSOPKI1",130,0)
 S PSSDZSL2=PSSDZ50/PSSDZND,PSSDZSL3=PSSDZSL2*+$P($G(PSSX(PSSA)),"^",3) S PSSDZSL4=PSSDZSL3*$S($G(PSSFB1):PSSFB1,1:1) S PSSDZSL5=$S('$G(PSSFB1):PSSDZSL4_$G(PSSFB),1:PSSDZSL4_$P(PSSFB,PSSFB1,2))
"RTN","PSSOPKI1",131,0)
 S PSSF2=$S('$G(PSSFA1):PSSF,1:($G(PSSFA1)*PSSF))_$S($G(PSSFA1):$P(PSSFA,PSSFA1,2),1:PSSFA)_"/"_$G(PSSDZSL5)
"RTN","PSSOPKI1",132,0)
 S PSSDZUNT=$P(PSSG,"/")_"/"_$G(PSSDZSL4)_$S('$G(PSSFB1):$G(PSSFB),1:$P(PSSFB,PSSFB1,2)) S $P(PSSX(PSSA),"^",2)=PSSDZUNT
"RTN","PSSOPKI1",133,0)
 S $P(PSSX(PSSA),"^",5)=PSSF2
"RTN","PSSOPKI1",134,0)
SLSQ Q
"RTN","PSSOPKI1",135,0)
REQS ;
"RTN","PSSOPKI1",136,0)
 S PSSREQS=1
"RTN","PSSOPKI1",137,0)
 Q
"RTN","PSSOPKI1",138,0)
MULTI ;
"RTN","PSSOPKI1",139,0)
 S PL3="" F  S PL3=$O(PSSHOLD(PSSZ,PSSC,PL3)) Q:PL3=""  S PSSX(PSSA,PL3)=PSSHOLD(PSSZ,PSSC,PL3) D SLS^PSSUTLPR D:'$D(PSSX("DD",+$P(PSSX(PSSA,PL3),"^",4)))
"RTN","PSSOPKI1",140,0)
 .S (PSIEN,DLOOP)=+$P(PSSX(PSSA,PL3),"^",6) K PSSMAX D:$G(TYPE)["O" MAX
"RTN","PSSOPKI1",141,0)
 .;ELR;ADDED NEXT LINE PSS*1*83
"RTN","PSSOPKI1",142,0)
 .D SETU
"RTN","PSSOPKI1",143,0)
 .S PSSX("DD",PSIEN)=$P($G(^PSDRUG(PSIEN,0)),"^")_"^"_$P($G(^(660)),"^",6)_"^"_$P($G(^(0)),"^",9)_"^"_$P($G(^(660)),"^",8)_"^"_$P($G(^("DOS")),"^")
"RTN","PSSOPKI1",144,0)
 .S PSSX("DD",PSIEN)=PSSX("DD",PSIEN)_"^"_$G(PSSUNITX)_"^"_$P($G(^PS(50.606,+$G(PSSDSE),0)),"^")_"^"_$G(PSSMAX)
"RTN","PSSOPKI1",145,0)
 .D REQS S PSSX("DD",PSIEN)=PSSX("DD",PSIEN)_"^"_$G(PSSREQS) D DEAPKI^PSSOPKI(PSIEN)
"RTN","PSSOPKI1",146,0)
 .S PSSX("MISC")=$G(PSSVERB)_"^"_$G(PSSPREP)_"^"_$P($G(^PS(50.606,+$G(PSSDSE),"MISC")),"^",4)
"RTN","PSSOPKI1",147,0)
 K PSSJZUNT
"RTN","PSSOPKI1",148,0)
 Q
"RTN","PSSOPKI1",149,0)
PARN ;
"RTN","PSSOPKI1",150,0)
 N PSSNPL K PSSNP
"RTN","PSSOPKI1",151,0)
 Q:$G(PSNNN)=""
"RTN","PSSOPKI1",152,0)
 Q:$L(PSNNN)'>3
"RTN","PSSOPKI1",153,0)
 S PSSNPL=$E(PSNNN,($L(PSNNN)-2),$L(PSNNN))
"RTN","PSSOPKI1",154,0)
 I $G(PSSNPL)="(S)"!($G(PSSNPL)="(s)") D
"RTN","PSSOPKI1",155,0)
 .I $G(PSSUDOS)'>1 S PSSNP=$E(PSNNN,1,($L(PSNNN)-3))
"RTN","PSSOPKI1",156,0)
 .I $G(PSSUDOS)>1 S PSSNP=$E(PSNNN,1,($L(PSNNN)-3))_$E(PSSNPL,2)
"RTN","PSSOPKI1",157,0)
 Q
"RTN","PSSOPKI1",158,0)
APP ; Checking Application Use
"RTN","PSSOPKI1",159,0)
 N APPUSE
"RTN","PSSOPKI1",160,0)
 S PSSQT=0,APPUSE=$P($G(^PSDRUG(DLOOP,2)),"^",3)
"RTN","PSSOPKI1",161,0)
 I $G(TYPE)="O" S:APPUSE'["O" PSSQT=1 Q
"RTN","PSSOPKI1",162,0)
 I $G(TYPE)="X" S:APPUSE'["X" PSSQT=1 Q
"RTN","PSSOPKI1",163,0)
 I APPUSE'["U",APPUSE'["I" S PSSQT=1
"RTN","PSSOPKI1",164,0)
 Q
"RTN","PSSOPKI1",165,0)
NS I PSONDS'?.N&(PSONDS'?.N1".".N) K PSONDS
"RTN","PSSOPKI1",166,0)
 Q
"RTN","PSSOPKI1",167,0)
NU S PSONDU=$S($G(PSONDS)&($G(PSONDU)):$P($G(^PS(50.607,+$G(PSONDU),0)),"^"),1:"")
"RTN","PSSOPKI1",168,0)
 Q
"RTN","PSSOPKI1",169,0)
SETU S PSSUNITX=$P($G(^PSDRUG(PSIEN,"DOS")),"^",2)
"RTN","PSSOPKI1",170,0)
 S PSSUNITX=$S($P($G(^PS(50.607,+$G(PSSUNITX),0)),"^")'=""&($P($G(^(0)),"^")'["/"):$P($G(^(0)),"^"),1:"")
"RTN","PSSOPKI1",171,0)
 Q
"RTN","PSSORUTE")
0^3^B635699
"RTN","PSSORUTE",1,0)
PSSORUTE ;OIFIO BAY PINES/ELR-CONTINUATION OF PSSORUTL ;07/20/04
"RTN","PSSORUTE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**83**;9/30/97
"RTN","PSSORUTE",3,0)
 ;
"RTN","PSSORUTE",4,0)
NU S PSONDU=$S($G(PSONDS)&($G(PSONDU)):$P($G(^PS(50.607,+$G(PSONDU),0)),"^"),1:"")
"RTN","PSSORUTE",5,0)
 Q
"RTN","PSSORUTE",6,0)
SETU S PSSUNITX=$P($G(^PSDRUG(PSIEN,"DOS")),"^",2)
"RTN","PSSORUTE",7,0)
 S PSSUNITX=$S($P($G(^PS(50.607,+$G(PSSUNITX),0)),"^")'=""&($P($G(^(0)),"^")'["/"):$P($G(^(0)),"^"),1:"")
"RTN","PSSORUTE",8,0)
 Q
"RTN","PSSORUTL")
0^1^B78187426
"RTN","PSSORUTL",1,0)
PSSORUTL ;BIR/RSB/RTR-CPRS Dosage call ;03/24/00
"RTN","PSSORUTL",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**34,38,49,53,69,83**;9/30/97
"RTN","PSSORUTL",3,0)
 ;Reference ^PS(50.607 - DBIA 2221
"RTN","PSSORUTL",4,0)
 ;Reference ^YSCL(603.01 - DBIA 2697
"RTN","PSSORUTL",5,0)
 ;Reference to ^PSNAPIS - DBIA 2531
"RTN","PSSORUTL",6,0)
 ;
"RTN","PSSORUTL",7,0)
DOSE(PSSX,PD,TYPE,PSSDFN) ;
"RTN","PSSORUTL",8,0)
 K PSSX
"RTN","PSSORUTL",9,0)
 ; PSSX - Target array
"RTN","PSSORUTL",10,0)
 ; PD - Orderable Item
"RTN","PSSORUTL",11,0)
 ; TYPE - O:Outpt,U:Unit Dose,I:IV,X:Non-VA Med
"RTN","PSSORUTL",12,0)
 ; PSSDFN - Patient
"RTN","PSSORUTL",13,0)
 ;
"RTN","PSSORUTL",14,0)
 N DLOOP,DCNT1,DLOOP1,LOW,FORM,PSSOIU,PSSLOW,PSSLOW1,PSSLOW2,PSOLC,PL,PSSHOLD,PSSA,PSSZ,PSSC,PSIEN,PSSTRN,PSSDSE,PSSVERB,PSSPREP,PSSCLO,PSSDEA,PSSMAX,PSSDLP,PSNN,PSNNN,PSSREQS,PSSLOW4,PL2,PSSA1,PL3,PSSUNITX,PSSLD,PSSLD1
"RTN","PSSORUTL",15,0)
 N PSSDOSE,PSSUNTS,PSSUDOS,PSSQT,PSSBCM,PSSHLF
"RTN","PSSORUTL",16,0)
 S PSSOIU=$S(TYPE="I":1,TYPE="U":1,1:0)
"RTN","PSSORUTL",17,0)
 F DLOOP=0:0 S DLOOP=$O(^PSDRUG("ASP",PD,DLOOP)) Q:'DLOOP  D
"RTN","PSSORUTL",18,0)
 .Q:'$O(^PSDRUG(DLOOP,"DOS1",0))
"RTN","PSSORUTL",19,0)
 .S PSSTRN=$P($G(^PSDRUG(DLOOP,"DOS")),"^"),PSSUNITX=$P($G(^("DOS")),"^",2) Q:PSSTRN=""
"RTN","PSSORUTL",20,0)
 .S PSSUNITX=$S($P($G(^PS(50.607,+$G(PSSUNITX),0)),"^")'=""&($P($G(^(0)),"^")'["/"):$P($G(^(0)),"^"),1:"")
"RTN","PSSORUTL",21,0)
 .I $P($G(^PSDRUG(DLOOP,"I")),"^"),+$P($G(^("I")),"^")<DT Q
"RTN","PSSORUTL",22,0)
 .D APP Q:PSSQT
"RTN","PSSORUTL",23,0)
 .S PSSDSE=+$P($G(^PS(50.7,PD,0)),"^",2),PSSVERB=$P($G(^PS(50.606,PSSDSE,"MISC")),"^"),PSSPREP=$P($G(^("MISC")),"^",3)
"RTN","PSSORUTL",24,0)
 .K PSNNN F PSNN=0:0 S PSNN=$O(^PS(50.606,PSSDSE,"NOUN",PSNN)) Q:'PSNN!($D(PSNNN))  S:$P($G(^(PSNN,0)),"^")'="" PSNNN=$P($G(^(0)),"^")
"RTN","PSSORUTL",25,0)
 .; possible doses
"RTN","PSSORUTL",26,0)
 .F DLOOP1=0:0 S DLOOP1=$O(^PSDRUG(DLOOP,"DOS1",DLOOP1)) Q:'DLOOP1  D
"RTN","PSSORUTL",27,0)
 ..Q:'$D(^PSDRUG(DLOOP,"DOS1",DLOOP1,0))
"RTN","PSSORUTL",28,0)
 ..I PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^",3)'["I" Q
"RTN","PSSORUTL",29,0)
 ..I 'PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^",3)'["O" Q
"RTN","PSSORUTL",30,0)
 ..S (PSSDOSE,PSSUNTS,PSSUDOS)=""
"RTN","PSSORUTL",31,0)
 ..S PSSDOSE=$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^",2)
"RTN","PSSORUTL",32,0)
 ..S PSSUNTS=$P($G(^PS(50.607,+$P($G(^PSDRUG(DLOOP,"DOS")),"^",2),0)),"^")
"RTN","PSSORUTL",33,0)
 ..S PSSUDOS=$P($G(^PSDRUG(DLOOP,"DOS1",DLOOP1,0)),"^"),PSSBCM=$P($G(^(0)),"^",4) I PSSUDOS["." S PSSHLF(DLOOP)=""
"RTN","PSSORUTL",34,0)
 ..I PSSDOSE]""&(PSSUDOS]"") D
"RTN","PSSORUTL",35,0)
 ...S DCNT1=$S('$D(DCNT1):1,1:DCNT1+1)
"RTN","PSSORUTL",36,0)
 ...S LOW(PSSDOSE,PSSUDOS,DCNT1)=""
"RTN","PSSORUTL",37,0)
 ...S FORM(PSSDOSE,$S($P($G(^PSDRUG(DLOOP,0)),"^",9)=1:1,1:0),DCNT1)=PSSUDOS
"RTN","PSSORUTL",38,0)
 ...D PARN
"RTN","PSSORUTL",39,0)
 ...S PSSX(DCNT1)=PSSDOSE_"^"_PSSUNTS_"^"_$S($E($G(PSSUDOS),1)=".":"0",1:"")_PSSUDOS_"^"_$S($G(PSSNP)'="":$G(PSSNP),1:$G(PSNNN))_"^^"_DLOOP_"^"_$$PRICE^PSSUTLA1 K PSSNP
"RTN","PSSORUTL",40,0)
 I '$O(PSSX(0)) G DOSE2
"RTN","PSSORUTL",41,0)
 ; delete n/f duplicate doses
"RTN","PSSORUTL",42,0)
 S PSSLOW="" F  S PSSLOW=$O(FORM(PSSLOW)) Q:PSSLOW=""  D
"RTN","PSSORUTL",43,0)
 .I $O(FORM(PSSLOW,0,0)) S PSSLOW2="" F  S PSSLOW2=$O(FORM(PSSLOW,1,PSSLOW2)) Q:PSSLOW2=""  K PSSX(PSSLOW2),LOW(PSSLOW,+$G(FORM(PSSLOW,1,PSSLOW2)),PSSLOW2)
"RTN","PSSORUTL",44,0)
 ;Lowest UPD
"RTN","PSSORUTL",45,0)
 S PSSLOW="" F  S PSSLOW=$O(LOW(PSSLOW)) Q:PSSLOW=""  D
"RTN","PSSORUTL",46,0)
 .S PSOLC=0 S PSSLOW1="" F  S PSSLOW1=$O(LOW(PSSLOW,PSSLOW1)) Q:PSSLOW1=""  D
"RTN","PSSORUTL",47,0)
 ..S PSOLC=PSOLC+1 S:PSOLC=1 PSSLOW4=$O(LOW(PSSLOW,PSSLOW1,0))
"RTN","PSSORUTL",48,0)
 ..S PSSLOW2="" F  S PSSLOW2=$O(LOW(PSSLOW,PSSLOW1,PSSLOW2)) Q:PSSLOW2=""  D
"RTN","PSSORUTL",49,0)
 ...I PSOLC>1 S PSSX(PSSLOW4,(PSOLC-1))=PSSX(PSSLOW2) K PSSX(PSSLOW2)
"RTN","PSSORUTL",50,0)
 K PSSHOLD S PL="" F  S PL=$O(PSSX(PL)) Q:PL=""  S PSSHOLD($P(PSSX(PL),"^"),PL)=PSSX(PL) I $O(PSSX(PL,0)) D
"RTN","PSSORUTL",51,0)
 .S PL2="" F  S PL2=$O(PSSX(PL,PL2)) Q:PL2=""  S PSSHOLD($P(PSSX(PL,PL2),"^"),PL,PL2)=PSSX(PL,PL2)
"RTN","PSSORUTL",52,0)
 K PSSX S PSSA=1,PSSZ="" F  S PSSZ=$O(PSSHOLD(PSSZ)) Q:PSSZ=""  F PSSC=0:0 S PSSC=$O(PSSHOLD(PSSZ,PSSC)) Q:'PSSC  S PSSX(PSSA)=PSSHOLD(PSSZ,PSSC) D SLS D:'$D(PSSX("DD",+$P(PSSX(PSSA),"^",6)))  D:$O(PSSHOLD(PSSZ,PSSC,0)) MULTI S PSSA=PSSA+1
"RTN","PSSORUTL",53,0)
 .S (PSIEN,DLOOP)=+$P(PSSX(PSSA),"^",6) K PSSMAX D:$G(TYPE)["O" MAX
"RTN","PSSORUTL",54,0)
 .D SETU^PSSORUTE
"RTN","PSSORUTL",55,0)
 .S PSSX("DD",PSIEN)=$P($G(^PSDRUG(PSIEN,0)),"^")_"^"_$P($G(^(660)),"^",6)_"^"_$P($G(^(0)),"^",9)_"^"_$P($G(^(660)),"^",8)_"^"_$P($G(^("DOS")),"^")
"RTN","PSSORUTL",56,0)
 .S PSSX("DD",PSIEN)=PSSX("DD",PSIEN)_"^"_$G(PSSUNITX)_"^"_$P($G(^PS(50.606,+$G(PSSDSE),0)),"^")_"^"_$G(PSSMAX)
"RTN","PSSORUTL",57,0)
 .D REQS S PSSX("DD",PSIEN)=PSSX("DD",PSIEN)_"^"_$G(PSSREQS) D DEA^PSSUTLA1(PSIEN)
"RTN","PSSORUTL",58,0)
 .S PSSX("MISC")=$G(PSSVERB)_"^"_$G(PSSPREP)_"^"_$P($G(^PS(50.606,+$G(PSSDSE),"MISC")),"^",4)
"RTN","PSSORUTL",59,0)
 K PSSHOLD,PSSDZUNT
"RTN","PSSORUTL",60,0)
 D LEAD^PSSUTLA1 D:$G(TYPE)["O" EN3^PSSUTLA1(PD,245)
"RTN","PSSORUTL",61,0)
 S PSSX("DEA")=$$OIDEA^PSSUTLA1(PD,TYPE)
"RTN","PSSORUTL",62,0)
 Q
"RTN","PSSORUTL",63,0)
DOSE2 ;Local doses
"RTN","PSSORUTL",64,0)
 N PSOCT,PSONDS,PSOND,PSOND1,PSONDX,PSONDU,PSODOS,PSLOC,PSLOCV,PSODUPD,PSOXDOSE
"RTN","PSSORUTL",65,0)
 S PSOCT=1
"RTN","PSSORUTL",66,0)
 S PSOXDOSE=+$P($G(^PS(50.7,PD,0)),"^",2) K PSNNN
"RTN","PSSORUTL",67,0)
 F DLOOP=0:0 S DLOOP=$O(^PSDRUG("ASP",PD,DLOOP)) Q:'DLOOP  D
"RTN","PSSORUTL",68,0)
 .I $P($G(^PSDRUG(DLOOP,"I")),"^"),+$P($G(^("I")),"^")<DT Q
"RTN","PSSORUTL",69,0)
 .D APP Q:PSSQT
"RTN","PSSORUTL",70,0)
 .Q:'$O(^PSDRUG(DLOOP,"DOS2",0))
"RTN","PSSORUTL",71,0)
 .S PSONDS=$P($G(^PSDRUG(DLOOP,"DOS")),"^"),PSONDU=$P($G(^("DOS")),"^",2),PSOND=$P($G(^("ND")),"^",3),PSOND1=$P($G(^("ND")),"^")
"RTN","PSSORUTL",72,0)
 .I PSOND,PSOND1 I PSONDS=""!('PSONDU) S PSONDX=$$DFSU^PSNAPIS(PSOND1,PSOND)
"RTN","PSSORUTL",73,0)
 .I PSONDS="",PSOND,PSOND1 S PSONDS=$P($G(PSONDX),"^",4) D NS
"RTN","PSSORUTL",74,0)
 .I 'PSONDU,PSOND,PSOND1 S PSONDU=$P($G(PSONDX),"^",5)
"RTN","PSSORUTL",75,0)
 .D NU
"RTN","PSSORUTL",76,0)
 .S PSODOS=+$P($G(^PS(50.7,PD,0)),"^",2)
"RTN","PSSORUTL",77,0)
 .F PSLOC=0:0 S PSLOC=$O(^PSDRUG(DLOOP,"DOS2",PSLOC)) Q:'PSLOC  D
"RTN","PSSORUTL",78,0)
 ..S PSLOCV=$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^"),PSSBCM=$P($G(^(0)),"^",3) Q:PSLOCV=""
"RTN","PSSORUTL",79,0)
 ..I PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^",2)'["I" Q
"RTN","PSSORUTL",80,0)
 ..I 'PSSOIU,$P($G(^PSDRUG(DLOOP,"DOS2",PSLOC,0)),"^",2)'["O" Q
"RTN","PSSORUTL",81,0)
 ..D SET2
"RTN","PSSORUTL",82,0)
 ;no doses
"RTN","PSSORUTL",83,0)
 K PSSBCM
"RTN","PSSORUTL",84,0)
 I '$O(PSSX(0)) K PSLOCV S PSOCT=1 D
"RTN","PSSORUTL",85,0)
 .F DLOOP=0:0 S DLOOP=$O(^PSDRUG("ASP",PD,DLOOP)) Q:'DLOOP  D
"RTN","PSSORUTL",86,0)
 ..I $P($G(^PSDRUG(DLOOP,"I")),"^"),+$P($G(^("I")),"^")<DT Q
"RTN","PSSORUTL",87,0)
 ..D APP Q:PSSQT
"RTN","PSSORUTL",88,0)
 ..S PSONDS=$P($G(^PSDRUG(DLOOP,"DOS")),"^"),PSONDU=$P($G(^("DOS")),"^",2),PSOND=$P($G(^("ND")),"^",3),PSOND1=$P($G(^("ND")),"^")
"RTN","PSSORUTL",89,0)
 ..K PSONDX I PSOND,PSOND1 I PSONDS=""!('PSONDU) S PSONDX=$$DFSU^PSNAPIS(PSOND1,PSOND)
"RTN","PSSORUTL",90,0)
 ..I PSONDS="",PSOND,PSOND1 S PSONDS=$P($G(PSONDX),"^",4) D NS
"RTN","PSSORUTL",91,0)
 ..I 'PSONDU,PSOND,PSOND1 S PSONDU=$P($G(PSONDX),"^",5)
"RTN","PSSORUTL",92,0)
 ..D NU
"RTN","PSSORUTL",93,0)
 ..S PSODOS=+$P($G(^PS(50.7,PD,0)),"^",2)
"RTN","PSSORUTL",94,0)
 ..D SET3
"RTN","PSSORUTL",95,0)
 D LEAD^PSSUTLA1 D:$G(TYPE)["O" EN3^PSSUTLA1(PD,245)
"RTN","PSSORUTL",96,0)
 S PSSX("DEA")=$$OIDEA^PSSUTLA1(PD,TYPE)
"RTN","PSSORUTL",97,0)
 D DUP^PSSUTLA1
"RTN","PSSORUTL",98,0)
 Q
"RTN","PSSORUTL",99,0)
SET2 I $G(PSLOCV)'="",$G(PSLOCV)["&" D AMP^PSSORPH1
"RTN","PSSORUTL",100,0)
 K PSSUDOS S PSSX(PSOCT)="^"_$G(PSONDU)_"^^"_$G(PSNNN)_"^"_$G(PSLOCV)_"^"_DLOOP_"^"_$$PRICE^PSSUTLA1
"RTN","PSSORUTL",101,0)
SET3 ;
"RTN","PSSORUTL",102,0)
 I '$D(PSSX("DD",DLOOP)) D
"RTN","PSSORUTL",103,0)
 .D REQS
"RTN","PSSORUTL",104,0)
 .K PSSMAX I $G(TYPE)["O" D MAX
"RTN","PSSORUTL",105,0)
 .S PSSX("DD",DLOOP)=$P($G(^PSDRUG(DLOOP,0)),"^")_"^"_$P($G(^(660)),"^",6)_"^"_$P($G(^(0)),"^",9)_"^"_$P($G(^(660)),"^",8)_"^"_$G(PSONDS)_"^"_$G(PSONDU)
"RTN","PSSORUTL",106,0)
 .S PSSX("DD",DLOOP)=PSSX("DD",DLOOP)_"^"_$P($G(^PS(50.606,+$G(PSODOS),0)),"^")_"^"_$G(PSSMAX)_"^"_$G(PSSREQS) D DEA^PSSUTLA1(DLOOP)
"RTN","PSSORUTL",107,0)
 .S PSSX("MISC")=$P($G(^PS(50.606,+$G(PSODOS),"MISC")),"^")_"^"_$P($G(^("MISC")),"^",3)_"^"_$P($G(^("MISC")),"^",4)
"RTN","PSSORUTL",108,0)
 S PSOCT=PSOCT+1
"RTN","PSSORUTL",109,0)
 Q
"RTN","PSSORUTL",110,0)
MAX ;
"RTN","PSSORUTL",111,0)
 K PSSMAX S PSSDEA=$P($G(^PSDRUG(DLOOP,0)),"^",3)
"RTN","PSSORUTL",112,0)
 I PSSDEA["1"!(PSSDEA["2") S PSSMAX=0 Q
"RTN","PSSORUTL",113,0)
 I PSSDEA["A",PSSDEA'["B" S PSSMAX=0 Q
"RTN","PSSORUTL",114,0)
 I $P($G(^PSDRUG(DLOOP,"CLOZ1")),"^")="PSOCLO1",$G(PSSDFN) D  Q
"RTN","PSSORUTL",115,0)
 .S PSSCLO=$O(^YSCL(603.01,"C",PSSDFN,0)) I PSSCLO,$P($G(^YSCL(603.01,+PSSCLO,0)),"^",3)="B" S PSSMAX=1 Q
"RTN","PSSORUTL",116,0)
 .S PSSMAX=0
"RTN","PSSORUTL",117,0)
 I PSSDEA["3"!(PSSDEA["4")!(PSSDEA["5") S PSSMAX=5 Q
"RTN","PSSORUTL",118,0)
 S PSSMAX=11
"RTN","PSSORUTL",119,0)
 Q
"RTN","PSSORUTL",120,0)
SLS ;Dosage with /
"RTN","PSSORUTL",121,0)
 K PSSDZUNT
"RTN","PSSORUTL",122,0)
 I $P($G(PSSX(PSSA)),"^",2)'["/" S $P(PSSX(PSSA),"^",5)=$P($G(PSSX(PSSA)),"^")_$P($G(PSSX(PSSA)),"^",2) Q
"RTN","PSSORUTL",123,0)
 N PSSF,PSSF1,PSSF2,PSSG,PSSFA,PSSFA1,PSSFB,PSSFB1,PSSDZI,PSSDZSL,PSSDZND,PSSDZSL1,PSSDZSL2,PSSDZSL3,PSSDZSL4,PSSDZSL5,PSSDZ50
"RTN","PSSORUTL",124,0)
 S PSSF=$P($G(PSSX(PSSA)),"^"),PSSG=$P($G(PSSX(PSSA)),"^",2)
"RTN","PSSORUTL",125,0)
 S PSSDZSL=0,PSSDZI=+$P($G(PSSX(PSSA)),"^",6),PSSDZ50=$P($G(^PSDRUG(PSSDZI,"DOS")),"^")
"RTN","PSSORUTL",126,0)
 S PSSDZND=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(PSSDZI,"ND")),"^"),+$P($G(^PSDRUG(PSSDZI,"ND")),"^",3)) S PSSDZND=+$P($G(PSSDZND),"^",2) ;I $G(PSSDZND),$G(PSSDZ50),+$G(PSSDZND)'=+$G(PSSDZ50) S PSSDZSL=1
"RTN","PSSORUTL",127,0)
 S PSSFA=$P(PSSG,"/"),PSSFB=$P(PSSG,"/",2),PSSFA1=+$G(PSSFA),PSSFB1=+$G(PSSFB)
"RTN","PSSORUTL",128,0)
 I '$G(PSSDZND) S $P(PSSX(PSSA),"^",5)=$P(PSSX(PSSA),"^") G SLSQ
"RTN","PSSORUTL",129,0)
 S PSSDZSL2=PSSDZ50/PSSDZND,PSSDZSL3=PSSDZSL2*+$P($G(PSSX(PSSA)),"^",3) S PSSDZSL4=PSSDZSL3*$S($G(PSSFB1):PSSFB1,1:1) S PSSDZSL5=$S('$G(PSSFB1):PSSDZSL4_$G(PSSFB),1:PSSDZSL4_$P(PSSFB,PSSFB1,2))
"RTN","PSSORUTL",130,0)
 S PSSF2=$S('$G(PSSFA1):PSSF,1:($G(PSSFA1)*PSSF))_$S($G(PSSFA1):$P(PSSFA,PSSFA1,2),1:PSSFA)_"/"_$G(PSSDZSL5)
"RTN","PSSORUTL",131,0)
 S PSSDZUNT=$P(PSSG,"/")_"/"_$G(PSSDZSL4)_$S('$G(PSSFB1):$G(PSSFB),1:$P(PSSFB,PSSFB1,2)) S $P(PSSX(PSSA),"^",2)=PSSDZUNT
"RTN","PSSORUTL",132,0)
 S $P(PSSX(PSSA),"^",5)=PSSF2
"RTN","PSSORUTL",133,0)
SLSQ Q
"RTN","PSSORUTL",134,0)
REQS S PSSREQS=1
"RTN","PSSORUTL",135,0)
 Q
"RTN","PSSORUTL",136,0)
MULTI S PL3="" F  S PL3=$O(PSSHOLD(PSSZ,PSSC,PL3)) Q:PL3=""  S PSSX(PSSA,PL3)=PSSHOLD(PSSZ,PSSC,PL3) D SLS^PSSUTLPR D:'$D(PSSX("DD",+$P(PSSX(PSSA,PL3),"^",4)))
"RTN","PSSORUTL",137,0)
 .S (PSIEN,DLOOP)=+$P(PSSX(PSSA,PL3),"^",6) K PSSMAX D:$G(TYPE)["O" MAX
"RTN","PSSORUTL",138,0)
 .D SETU^PSSORUTE
"RTN","PSSORUTL",139,0)
 .S PSSX("DD",PSIEN)=$P($G(^PSDRUG(PSIEN,0)),"^")_"^"_$P($G(^(660)),"^",6)_"^"_$P($G(^(0)),"^",9)_"^"_$P($G(^(660)),"^",8)_"^"_$P($G(^("DOS")),"^")
"RTN","PSSORUTL",140,0)
 .S PSSX("DD",PSIEN)=PSSX("DD",PSIEN)_"^"_$G(PSSUNITX)_"^"_$P($G(^PS(50.606,+$G(PSSDSE),0)),"^")_"^"_$G(PSSMAX)
"RTN","PSSORUTL",141,0)
 .D REQS S PSSX("DD",PSIEN)=PSSX("DD",PSIEN)_"^"_$G(PSSREQS) D DEA^PSSUTLA1(PSIEN)
"RTN","PSSORUTL",142,0)
 .S PSSX("MISC")=$G(PSSVERB)_"^"_$G(PSSPREP)_"^"_$P($G(^PS(50.606,+$G(PSSDSE),"MISC")),"^",4)
"RTN","PSSORUTL",143,0)
 K PSSJZUNT
"RTN","PSSORUTL",144,0)
 Q
"RTN","PSSORUTL",145,0)
PARN N PSSNPL K PSSNP
"RTN","PSSORUTL",146,0)
 Q:$G(PSNNN)=""
"RTN","PSSORUTL",147,0)
 Q:$L(PSNNN)'>3
"RTN","PSSORUTL",148,0)
 S PSSNPL=$E(PSNNN,($L(PSNNN)-2),$L(PSNNN))
"RTN","PSSORUTL",149,0)
 I $G(PSSNPL)="(S)"!($G(PSSNPL)="(s)") D
"RTN","PSSORUTL",150,0)
 .I $G(PSSUDOS)'>1 S PSSNP=$E(PSNNN,1,($L(PSNNN)-3))
"RTN","PSSORUTL",151,0)
 .I $G(PSSUDOS)>1 S PSSNP=$E(PSNNN,1,($L(PSNNN)-3))_$E(PSSNPL,2)
"RTN","PSSORUTL",152,0)
 Q
"RTN","PSSORUTL",153,0)
LEAD F PSSLD=0:0 S PSSLD=$O(PSSX(PSSLD)) Q:'PSSLD  D
"RTN","PSSORUTL",154,0)
 .I $E($P(PSSX(PSSLD),"^"),1)="." S $P(PSSX(PSSLD),"^")="0"_$P(PSSX(PSSLD),"^")
"RTN","PSSORUTL",155,0)
 .I $E($P(PSSX(PSSLD),"^",5),1)="." S $P(PSSX(PSSLD),"^",5)="0"_$P(PSSX(PSSLD),"^",5)
"RTN","PSSORUTL",156,0)
 .I $O(PSSX(PSSLD,0)) D
"RTN","PSSORUTL",157,0)
 ..F PSSLD1=0:0 S PSSLD1=$O(PSSX(PSSLD,PSSLD1)) Q:'PSSLD1  D
"RTN","PSSORUTL",158,0)
 ...I $E($P(PSSX(PSSLD,PSSLD1),"^"),1)="." S $P(PSSX(PSSLD,PSSLD1),"^")="0"_$P(PSSX(PSSLD,PSSLD1),"^")
"RTN","PSSORUTL",159,0)
 ...I $E($P(PSSX(PSSLD,PSSLD1),"^",5),1)="." S $P(PSSX(PSSLD,PSSLD1),"^",5)="0"_$P(PSSX(PSSLD,PSSLD1),"^",5)
"RTN","PSSORUTL",160,0)
 S PSSLD="" F  S PSSLD=$O(PSSX("DD",PSSLD)) Q:PSSLD=""  D
"RTN","PSSORUTL",161,0)
 .I $E($P(PSSX("DD",PSSLD),"^",5),1)="." S $P(PSSX("DD",PSSLD),"^",5)="0"_$P(PSSX("DD",PSSLD),"^",5)
"RTN","PSSORUTL",162,0)
 Q
"RTN","PSSORUTL",163,0)
 ;
"RTN","PSSORUTL",164,0)
APP N APPUSE S PSSQT=0,APPUSE=$P($G(^PSDRUG(DLOOP,2)),"^",3)
"RTN","PSSORUTL",165,0)
 I $G(TYPE)="O" S:APPUSE'["O" PSSQT=1 Q
"RTN","PSSORUTL",166,0)
 I $G(TYPE)="X" S:APPUSE'["X" PSSQT=1 Q
"RTN","PSSORUTL",167,0)
 I APPUSE'["U",APPUSE'["I" S PSSQT=1
"RTN","PSSORUTL",168,0)
 Q
"RTN","PSSORUTL",169,0)
NS I PSONDS'?.N&(PSONDS'?.N1".".N) K PSONDS
"RTN","PSSORUTL",170,0)
 Q
"RTN","PSSORUTL",171,0)
NU D NU^PSSORUTE
"RTN","PSSORUTL",172,0)
 Q
"VER")
8.0^22
**END**
**END**
