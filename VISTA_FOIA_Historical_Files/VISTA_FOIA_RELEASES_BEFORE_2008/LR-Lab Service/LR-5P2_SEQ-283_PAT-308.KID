Released LR*5.2*308 SEQ #283
Extracted from mail message
**KIDS**:LR*5.2*308^

**INSTALL NAME**
LR*5.2*308
"BLD",5386,0)
LR*5.2*308^LAB SERVICE^0^3070322^y
"BLD",5386,1,0)
^^262^262^3070322^^^
"BLD",5386,1,1,0)
=====================
"BLD",5386,1,2,0)
Patch Description
"BLD",5386,1,3,0)
================= 
"BLD",5386,1,4,0)
Several updates and enhancements have been identified as requiring 
"BLD",5386,1,5,0)
immediate action after the installation of patch LR*5.2*274, AP CPT 
"BLD",5386,1,6,0)
Coding & NLT Code Update.  This patch LR*5.2*308 includes updates
"BLD",5386,1,7,0)
that have been identified in the NOIS's listed below.  
"BLD",5386,1,8,0)
The following updates are included.  
"BLD",5386,1,9,0)
 
"BLD",5386,1,10,0)
1.  Currently:  If a Current Procedural Terminolgy (CPT) code is not
"BLD",5386,1,11,0)
found or is marked inactive in the CPT file (#81), a general message,
"BLD",5386,1,12,0)
"Nothing Selected" displays, or no message at all displays.  The CPT 
"BLD",5386,1,13,0)
code is not selected and passed to PATIENT CARE ENCOUNTER (PCE).
"BLD",5386,1,14,0)
 
"BLD",5386,1,15,0)
Update:  If one or more CPT's are not found in the CPT file (#81), 
"BLD",5386,1,16,0)
the following message displays and lists the CPT codes:
"BLD",5386,1,17,0)
          "The following CPT Code(s) are not selected:
"BLD",5386,1,18,0)
            Not found in #81: #####,#####,".
"BLD",5386,1,19,0)
For one or more CPTs that are marked inactive in the CPT 
"BLD",5386,1,20,0)
file (#81), the following message displays and lists the CPT codes:
"BLD",5386,1,21,0)
          "The following CPT Code(s) are not selected: 
"BLD",5386,1,22,0)
            CPT(s) inactive in #81: #####,#####".
"BLD",5386,1,23,0)
All CPTs that are inactive or not found in file #81 will not be 
"BLD",5386,1,24,0)
passed to PCE.
"BLD",5386,1,25,0)
 
"BLD",5386,1,26,0)
2.  Currently:  CPTs marked inactive in the WKLD CODE file (#64) 
"BLD",5386,1,27,0)
can be selected and are passed to PCE.
"BLD",5386,1,28,0)
 
"BLD",5386,1,29,0)
Update:  If a selected CPT is marked inactive in file (#64), a 
"BLD",5386,1,30,0)
search is made for another active CPT linked to the same workload code.  
"BLD",5386,1,31,0)
If another active CPT is found, the active CPT replaces the inactive CPT
"BLD",5386,1,32,0)
and is passed to PCE.  The following message will display if an active
"BLD",5386,1,33,0)
replacement is found:
"BLD",5386,1,34,0)
  "The following CPT Code(s) are not selected: 
"BLD",5386,1,35,0)
    Inactive in #64\Active Replacement Found: ##### \ #####; ##### \
"BLD",5386,1,36,0)
#####".
"BLD",5386,1,37,0)
 
"BLD",5386,1,38,0)
If no active replacement found, the selected CPT is not passed to 
"BLD",5386,1,39,0)
PCE and is displayed in the following message:
"BLD",5386,1,40,0)
          "The following CPT Code(s) are not selected: 
"BLD",5386,1,41,0)
            CPT(s) inactive in #64: #####,#####".  
"BLD",5386,1,42,0)
 
"BLD",5386,1,43,0)
3.  Currently:  Inactive CPTs found in the WKLD CODE file (#64) 
"BLD",5386,1,44,0)
can be entered and passed to PCE for non-AP accessions.  When an inactive
"BLD",5386,1,45,0)
CPT is selected and passed to PCE, the entire order is marked invalid for
"BLD",5386,1,46,0)
workload and no workload is passed, and a mail message is generated at the
"BLD",5386,1,47,0)
site which states "No lab OOS location defined".
"BLD",5386,1,48,0)
 
"BLD",5386,1,49,0)
Update:  If a CPT is found inactive in file #64, a search will be 
"BLD",5386,1,50,0)
made for another active replacement CPT linked to the same workload code.
"BLD",5386,1,51,0)
If another active CPT is found, the active CPT replaces the inactive
"BLD",5386,1,52,0)
CPT.  If no active replacement CPT is found, the original CPT is not
"BLD",5386,1,53,0)
passed to PCE, and thus no misleading mail message is generated.
"BLD",5386,1,54,0)
 
"BLD",5386,1,55,0)
4. Currently:  Any subsequent CPT codes entered on an accession 
"BLD",5386,1,56,0)
will replace or overlay the quantity previously passed to PCE.
"BLD",5386,1,57,0)
Example:  CPT 88302 with quantity of 2 entered on day 1; PCE shows
"BLD",5386,1,58,0)
quantity of 2.  On day 2, CPT 88302 with quantity of 1 entered; PCE shows
"BLD",5386,1,59,0)
updated quantity of 1.  It should show 3.
"BLD",5386,1,60,0)
 
"BLD",5386,1,61,0)
Update:  All subsequent CPT code quantities entered for an 
"BLD",5386,1,62,0)
accession will be added to existing quantities stored in PCE.
"BLD",5386,1,63,0)
 
"BLD",5386,1,64,0)
5. Currently:  If a selected CPT is not linked to a workload code 
"BLD",5386,1,65,0)
in the WKLD CODE file (#64), the CPT is passed to PCE, and the message
"BLD",5386,1,66,0)
"Storing in LMIP".  This message incorrectly identifies the CPT as 
"BLD",5386,1,67,0)
having been stored in the WKLD CODE file (#64).
"BLD",5386,1,68,0)
 
"BLD",5386,1,69,0)
Update:  Selected CPT codes that are not linked to a workload code 
"BLD",5386,1,70,0)
in the WKLD CODE file (#64) will not be passed to PCE, and the following
"BLD",5386,1,71,0)
message will display:
"BLD",5386,1,72,0)
          "The following CPT Code(s) are not selected: 
"BLD",5386,1,73,0)
            Not linked to workload in #64: #####, #####".
"BLD",5386,1,74,0)
 
"BLD",5386,1,75,0)
6.  Currently:  If a selected CPT code is linked to multiple workload 
"BLD",5386,1,76,0)
codes, the workload code with the lowest IEN is selected.  This cannot be 
"BLD",5386,1,77,0)
changed; however, the problem has been reduced by increasing the number of 
"BLD",5386,1,78,0)
allowed ES Display Order numbers that can be assigned to a specific 
"BLD",5386,1,79,0)
CPT-workload code combination.  The limit has been increased from 100 to 
"BLD",5386,1,80,0)
1000.  
"BLD",5386,1,81,0)
 
"BLD",5386,1,82,0)
7.  Currently:  When more than one accession is entered for a patient on 
"BLD",5386,1,83,0)
the same date, at the same location, and the specimen collection date/time 
"BLD",5386,1,84,0)
does not contain a unique time, then each accession for this patient will 
"BLD",5386,1,85,0)
have the same encounter/visit number assigned when CPT codes are entered 
"BLD",5386,1,86,0)
and passed to PCE.  
"BLD",5386,1,87,0)
 
"BLD",5386,1,88,0)
Update:  Within Anatomic Pathology (AP) Login, the "Date/time Specimen
"BLD",5386,1,89,0)
taken:" prompt default has been changed from TODAY (date only) to NOW
"BLD",5386,1,90,0)
(date and time).  This helps decrease the chance of having the same
"BLD",5386,1,91,0)
encounter number assigned to more than one accession entered on the same
"BLD",5386,1,92,0)
patient on the same date, at the same location.
"BLD",5386,1,93,0)
 
"BLD",5386,1,94,0)
8. A couple of minor cosmetic updates are included in this patch:
"BLD",5386,1,95,0)
a.  The prompt "Releasing Pathologist:" has been changed to "Provider:" 
"BLD",5386,1,96,0)
since the name entered at this prompt must be an active provider.  
"BLD",5386,1,97,0)
b.  The pathologist or cytotechnologist name, if entered on the accession,
"BLD",5386,1,98,0)
is included in the header information that displays at the time CPT coding 
"BLD",5386,1,99,0)
is entered.
"BLD",5386,1,100,0)
 
"BLD",5386,1,101,0)
The updates described above are displayed in the following screen format.  
"BLD",5386,1,102,0)
This screen format is used in the menu options listed below it:
"BLD",5386,1,103,0)
 
"BLD",5386,1,104,0)
Provider: PROVIDER, ONE//        PRO          PHYSICIAN
"BLD",5386,1,105,0)
 
"BLD",5386,1,106,0)
Select CPT codes:  88302
"BLD",5386,1,107,0)
 
"BLD",5386,1,108,0)
TEST, PATIENT1                        000-99-1234         DOB: Mar 05, 1955
"BLD",5386,1,109,0)
     Collection Date: Jan 06, 2005@11:52
"BLD",5386,1,110,0)
          Acc #: NSP 05 1                                   Loc: 5N
"BLD",5386,1,111,0)
               Specimen: 
"BLD",5386,1,112,0)
     Tissue Specimens: 
"BLD",5386,1,113,0)
               TAIL
"BLD",5386,1,114,0)
     Test(s);  SURGICAL PATH REPORTING/ SURGICAL PATHOLOGY LOG-IN/ 
"BLD",5386,1,115,0)
     Pathologist: PHYSICIAN, ONE
"BLD",5386,1,116,0)
 
"BLD",5386,1,117,0)
                               Selected CPT Codes                           
"BLD",5386,1,118,0)
    
"BLD",5386,1,119,0)
     (1)  88302 LEVEL II - SURGICAL PATHOLOGY, GROSS AND MICROSCOP
"BLD",5386,1,120,0)
          Surgical Pathology Level II  {88518.0000}
"BLD",5386,1,121,0)
 
"BLD",5386,1,122,0)
Menu Options:
"BLD",5386,1,123,0)
       Lab CPT Billing [LRCAPES]
"BLD",5386,1,124,0)
       Verify/release reports, anat path [LRAPR], 
"BLD",5386,1,125,0)
               CPT Coding selection
"BLD",5386,1,126,0)
       Provisional anatomic diagnoses [LRAPAUPAD]
"BLD",5386,1,127,0)
       Autopsy protocol [LRAPAUDAP]
"BLD",5386,1,128,0)
       Autopsy protocol & SNOMED coding [LRAPAUDAB]
"BLD",5386,1,129,0)
       Autopsy protocol & ICD9CM coding [LRAPAUDAA]
"BLD",5386,1,130,0)
       FS/Gross/Micro/Dx [LRAPDGM]
"BLD",5386,1,131,0)
       FS/Gross/Micro/Dx/SNOMED Coding [LRAPDGS]
"BLD",5386,1,132,0)
       FS/Gross/Micro/Dx/ICD9CM Coding [LRAPDGI]
"BLD",5386,1,133,0)
 
"BLD",5386,1,134,0)
9. A couple of general corrections are included in this patch.  For
"BLD",5386,1,135,0)
certain $D statements which read, "'$DATA()#2", the modulo is incorrectly 
"BLD",5386,1,136,0)
applied to the result of the "'$DATA()".  Instead, the NOT operator "'" 
"BLD",5386,1,137,0)
should be applied to the evaluation of "$DATA()#2" to correctly read,
"BLD",5386,1,138,0)
"'($DATA()#2)".  The following statements have been corrected:
"BLD",5386,1,139,0)
 
"BLD",5386,1,140,0)
a. In SETWKL+13^LRCAPES1, Q:'$D(^LAM(LRP,0))#2, has been changed to
"BLD",5386,1,141,0)
   Q:'($D(^LAM(LRP,0))#2).
"BLD",5386,1,142,0)
b. In EN5+4^LRCAPPH1, Q:'$D(^LRO(69,LRCDT,1,LRSN,2,LRTST,0))#2, has been
"BLD",5386,1,143,0)
   changed to Q:'($D(^LRO(69,LRCDT,1,LRSN,2,LRTST,0))#2).
"BLD",5386,1,144,0)
 
"BLD",5386,1,145,0)
Data Dictionary Changes
"BLD",5386,1,146,0)
=======================
"BLD",5386,1,147,0)
VistA Laboratory AP CPT Code Corrections Patch LR*5.2*308 software release
"BLD",5386,1,148,0)
contains the following data dictionary changes:
"BLD",5386,1,149,0)
 
"BLD",5386,1,150,0)
WKLD CODE file (#64)
"BLD",5386,1,151,0)
------------------------
"BLD",5386,1,152,0)
WKLD CODE file (#64), ES DISPLAY ORDER field (#26) has been modified 
"BLD",5386,1,153,0)
to increase the quantity allowed from 100 to 1000.
"BLD",5386,1,154,0)
 
"BLD",5386,1,155,0)
======================
"BLD",5386,1,156,0)
Associated E3Rs - None
"BLD",5386,1,157,0)
---------------
"BLD",5386,1,158,0)
 
"BLD",5386,1,159,0)
Associated NOISs -
"BLD",5386,1,160,0)
----------------  
"BLD",5386,1,161,0)
 
"BLD",5386,1,162,0)
 
"BLD",5386,1,163,0)
CPH-0103-41645 / HD0000000069980
"BLD",5386,1,164,0)
FGH-0103-31657 / HD0000000069982
"BLD",5386,1,165,0)
MIN-0103-41656 / HD0000000069981
"BLD",5386,1,166,0)
BHS-0103-12034 / HD0000000069988
"BLD",5386,1,167,0)
UNY-0103-11749 / HD0000000069985
"BLD",5386,1,168,0)
WBP-0103-21809 / HD0000000069986
"BLD",5386,1,169,0)
SAM-0603-21566 / HD0000000070159
"BLD",5386,1,170,0)
JAC-1103-70158 / HD0000000070386
"BLD",5386,1,171,0)
ALT-0304-20022 / HD0000000070580
"BLD",5386,1,172,0)
SBY-0304-31852 / HD0000000070614
"BLD",5386,1,173,0)
BIL-0304-31578 / HD0000000070606
"BLD",5386,1,174,0)
WRJ-0404-10360 / HD0000000070654
"BLD",5386,1,175,0)
HVH-0404-11404 / HD0000000070684
"BLD",5386,1,176,0)
CPH-0804-41938 / HD0000000070965
"BLD",5386,1,177,0)
MIN-1204-40394 / HD0000000071122
"BLD",5386,1,178,0)
HEH-0304-41954 / HD0000000070618
"BLD",5386,1,179,0)
 
"BLD",5386,1,180,0)
=====================
"BLD",5386,1,181,0)
Test Sites:
"BLD",5386,1,182,0)
===========
"BLD",5386,1,183,0)
 
"BLD",5386,1,184,0)
Boston HCS - VMS/CACHE (large integrated site)
"BLD",5386,1,185,0)
Durham VAMC - VMS/CACHE (large site)
"BLD",5386,1,186,0)
Iowa City VAMC - VMS/CACHE (large integrated site)
"BLD",5386,1,187,0)
Long Beach VAMC - VMS/CACHE (large site)
"BLD",5386,1,188,0)
 
"BLD",5386,1,189,0)
================
"BLD",5386,1,190,0)
Routine Summary:
"BLD",5386,1,191,0)
================
"BLD",5386,1,192,0)
 
"BLD",5386,1,193,0)
The following list of the routine(s) included in this patch.  The
"BLD",5386,1,194,0)
second line of each of these routine(s) will look like:
"BLD",5386,1,195,0)
 
"BLD",5386,1,196,0)
<tab>;;5.2;LAB SERVICE;**[patch list]**;Sep 27 1994
"BLD",5386,1,197,0)
 
"BLD",5386,1,198,0)
               CHECK^XTSUMBLD results
"BLD",5386,1,199,0)
 
"BLD",5386,1,200,0)
Routine      Before    After       Patch
"BLD",5386,1,201,0)
Name         Patch     Patch       List
"BLD",5386,1,202,0)
 
"BLD",5386,1,203,0)
LR308       N/A       3577348    **308**  (Deleted by KIDS)
"BLD",5386,1,204,0)
LRAPLG1     5113296   5107203    **72,121,248,308**
"BLD",5386,1,205,0)
LRAPUTL     9752029   9713709    **259,308**
"BLD",5386,1,206,0)
LRCAPES    13104305  13495108    **274,259,349,308**
"BLD",5386,1,207,0)
LRCAPES1    8132160  13575476    **274,308**
"BLD",5386,1,208,0)
LRCAPPH1   13504461  14078305    **127,136,138,158,263,264,274,291,359,308**
"BLD",5386,1,209,0)
 
"BLD",5386,1,210,0)
 
"BLD",5386,1,211,0)
Software Retrieval
"BLD",5386,1,212,0)
------------------
"BLD",5386,1,213,0)
VistA Laboratory Anatomic Pathology Current Procedural Terminology 
"BLD",5386,1,214,0)
Corrections Patch LR*5.2*308 software is distributed by Packman.
"BLD",5386,1,215,0)
 
"BLD",5386,1,216,0)
Documentation Retrieval
"BLD",5386,1,217,0)
-----------------------
"BLD",5386,1,218,0)
VistA Laboratory Anatomic Pathology (AP) Current Procedural 
"BLD",5386,1,219,0)
Terminology(CPT)Corrections Patch LR*5.2*308 software User Guide
"BLD",5386,1,220,0)
is available at the following Office of Information Field Offices (OIFOs) 
"BLD",5386,1,221,0)
ANONYMOUS.SOFTWARE directories: 
"BLD",5386,1,222,0)
 
"BLD",5386,1,223,0)
OI Field Office    FTP Address                 Directory
"BLD",5386,1,224,0)
---------------    -----------                 ---------
"BLD",5386,1,225,0)
ALBANY             ftp.fo-albany.med.va.gov    [ANONYMOUS.SOFTWARE]
"BLD",5386,1,226,0)
HINES              ftp.fo-hines.med.va.gov     [ANONYMOUS.SOFTWARE]
"BLD",5386,1,227,0)
SALT LAKE CITY     ftp.fo-slc.med.va.gov       [ANONYMOUS.SOFTWARE]
"BLD",5386,1,228,0)
 
"BLD",5386,1,229,0)
 
"BLD",5386,1,230,0)
Documentation Retrieval Formats
"BLD",5386,1,231,0)
-------------------------------
"BLD",5386,1,232,0)
VistA Laboratory Anatomic Pathology (AP) Current Procedural 
"BLD",5386,1,233,0)
Terminology(CPT)Corrections Patch LR*5.2*308 User Guide files are 
"BLD",5386,1,234,0)
exported in the following retrieval formats:
"BLD",5386,1,235,0)
 
"BLD",5386,1,236,0)
File Name           Contents                          Retrieval Formats
"BLD",5386,1,237,0)
---------           --------                          -----------------
"BLD",5386,1,238,0)
LAB_52_308_UG.doc    VistA Laboratory Anatomic Pathology
"BLD",5386,1,239,0)
                     (AP) Current Procedural Terminology
"BLD",5386,1,240,0)
                     (CPT)Corrections Patch LR*5.2*308
"BLD",5386,1,241,0)
                     User Guide                            BINARY
"BLD",5386,1,242,0)
 
"BLD",5386,1,243,0)
LAB_52_308_UG.pdf   VistA Laboratory Anatomic Pathology
"BLD",5386,1,244,0)
                     (AP) Current Procedural Terminology
"BLD",5386,1,245,0)
                     (CPT)Corrections Patch LR*5.2*308
"BLD",5386,1,246,0)
                     User Guide                            BINARY
"BLD",5386,1,247,0)
 
"BLD",5386,1,248,0)
 
"BLD",5386,1,249,0)
VistA Website Locations:
"BLD",5386,1,250,0)
-----------------------
"BLD",5386,1,251,0)
VistA Laboratory Anatomic Pathology (AP) Current Procedural 
"BLD",5386,1,252,0)
Terminology(CPT)Corrections Patch LR*5.2*308 User Guide is accessible in 
"BLD",5386,1,253,0)
MS Word (.doc) and Portable Document Format (.pdf) at the following 
"BLD",5386,1,254,0)
VistA locations:
"BLD",5386,1,255,0)
 
"BLD",5386,1,256,0)
Laboratory Version 5.2 Home Page
"BLD",5386,1,257,0)
--------------------------------
"BLD",5386,1,258,0)
http://vista.med.va.gov/ClinicalSpecialties/lab/
"BLD",5386,1,259,0)
 
"BLD",5386,1,260,0)
VistA Documentation Library (VDL)
"BLD",5386,1,261,0)
---------------------------------
"BLD",5386,1,262,0)
www.va.gov/vdl/
"BLD",5386,4,0)
^9.64PA^64^1
"BLD",5386,4,64,0)
64
"BLD",5386,4,64,2,0)
^9.641^64^1
"BLD",5386,4,64,2,64,0)
WKLD CODE  (File-top level)
"BLD",5386,4,64,2,64,1,0)
^9.6411^26^1
"BLD",5386,4,64,2,64,1,26,0)
ES DISPLAY ORDER
"BLD",5386,4,64,222)
y^n^p^^^^n^^n
"BLD",5386,4,64,224)

"BLD",5386,4,"APDD",64,64)

"BLD",5386,4,"APDD",64,64,26)

"BLD",5386,4,"B",64,64)

"BLD",5386,"INI")
PRE^LR308
"BLD",5386,"INID")
y^y^y
"BLD",5386,"INIT")
POST^LR308
"BLD",5386,"KRN",0)
^9.67PA^8989.52^19
"BLD",5386,"KRN",.4,0)
.4
"BLD",5386,"KRN",.401,0)
.401
"BLD",5386,"KRN",.402,0)
.402
"BLD",5386,"KRN",.403,0)
.403
"BLD",5386,"KRN",.5,0)
.5
"BLD",5386,"KRN",.84,0)
.84
"BLD",5386,"KRN",3.6,0)
3.6
"BLD",5386,"KRN",3.8,0)
3.8
"BLD",5386,"KRN",9.2,0)
9.2
"BLD",5386,"KRN",9.8,0)
9.8
"BLD",5386,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",5386,"KRN",9.8,"NM",1,0)
LRCAPES^^0^B82507767
"BLD",5386,"KRN",9.8,"NM",2,0)
LRCAPES1^^0^B68838767
"BLD",5386,"KRN",9.8,"NM",3,0)
LRCAPPH1^^0^B60854861
"BLD",5386,"KRN",9.8,"NM",4,0)
LRAPLG1^^0^B12975824
"BLD",5386,"KRN",9.8,"NM",5,0)
LRAPUTL^^0^B64931804
"BLD",5386,"KRN",9.8,"NM","B","LRAPLG1",4)

"BLD",5386,"KRN",9.8,"NM","B","LRAPUTL",5)

"BLD",5386,"KRN",9.8,"NM","B","LRCAPES",1)

"BLD",5386,"KRN",9.8,"NM","B","LRCAPES1",2)

"BLD",5386,"KRN",9.8,"NM","B","LRCAPPH1",3)

"BLD",5386,"KRN",19,0)
19
"BLD",5386,"KRN",19,"NM",0)
^9.68A^^
"BLD",5386,"KRN",19.1,0)
19.1
"BLD",5386,"KRN",101,0)
101
"BLD",5386,"KRN",409.61,0)
409.61
"BLD",5386,"KRN",771,0)
771
"BLD",5386,"KRN",870,0)
870
"BLD",5386,"KRN",8989.51,0)
8989.51
"BLD",5386,"KRN",8989.52,0)
8989.52
"BLD",5386,"KRN",8994,0)
8994
"BLD",5386,"KRN","B",.4,.4)

"BLD",5386,"KRN","B",.401,.401)

"BLD",5386,"KRN","B",.402,.402)

"BLD",5386,"KRN","B",.403,.403)

"BLD",5386,"KRN","B",.5,.5)

"BLD",5386,"KRN","B",.84,.84)

"BLD",5386,"KRN","B",3.6,3.6)

"BLD",5386,"KRN","B",3.8,3.8)

"BLD",5386,"KRN","B",9.2,9.2)

"BLD",5386,"KRN","B",9.8,9.8)

"BLD",5386,"KRN","B",19,19)

"BLD",5386,"KRN","B",19.1,19.1)

"BLD",5386,"KRN","B",101,101)

"BLD",5386,"KRN","B",409.61,409.61)

"BLD",5386,"KRN","B",771,771)

"BLD",5386,"KRN","B",870,870)

"BLD",5386,"KRN","B",8989.51,8989.51)

"BLD",5386,"KRN","B",8989.52,8989.52)

"BLD",5386,"KRN","B",8994,8994)

"BLD",5386,"PRE")
LR308
"BLD",5386,"QUES",0)
^9.62^^
"BLD",5386,"REQB",0)
^9.611^4^4
"BLD",5386,"REQB",1,0)
LR*5.2*274^2
"BLD",5386,"REQB",2,0)
LR*5.2*259^2
"BLD",5386,"REQB",3,0)
LR*5.2*248^2
"BLD",5386,"REQB",4,0)
LR*5.2*349^2
"BLD",5386,"REQB","B","LR*5.2*248",3)

"BLD",5386,"REQB","B","LR*5.2*259",2)

"BLD",5386,"REQB","B","LR*5.2*274",1)

"BLD",5386,"REQB","B","LR*5.2*349",4)

"FIA",64)
WKLD CODE
"FIA",64,0)
^LAM(
"FIA",64,0,0)
64I
"FIA",64,0,1)
y^n^p^^^^n^^n
"FIA",64,0,10)

"FIA",64,0,11)

"FIA",64,0,"RLRO")

"FIA",64,0,"VR")
5.2^LR
"FIA",64,64)
1
"FIA",64,64,26)

"INI")
PRE^LR308
"INIT")
POST^LR308
"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2941128
"PKG",26,22,1,"PAH",1,0)
308^3070322^6681
"PKG",26,22,1,"PAH",1,1,0)
^^262^262^3070322
"PKG",26,22,1,"PAH",1,1,1,0)
=====================
"PKG",26,22,1,"PAH",1,1,2,0)
Patch Description
"PKG",26,22,1,"PAH",1,1,3,0)
================= 
"PKG",26,22,1,"PAH",1,1,4,0)
Several updates and enhancements have been identified as requiring 
"PKG",26,22,1,"PAH",1,1,5,0)
immediate action after the installation of patch LR*5.2*274, AP CPT 
"PKG",26,22,1,"PAH",1,1,6,0)
Coding & NLT Code Update.  This patch LR*5.2*308 includes updates
"PKG",26,22,1,"PAH",1,1,7,0)
that have been identified in the NOIS's listed below.  
"PKG",26,22,1,"PAH",1,1,8,0)
The following updates are included.  
"PKG",26,22,1,"PAH",1,1,9,0)
 
"PKG",26,22,1,"PAH",1,1,10,0)
1.  Currently:  If a Current Procedural Terminolgy (CPT) code is not
"PKG",26,22,1,"PAH",1,1,11,0)
found or is marked inactive in the CPT file (#81), a general message,
"PKG",26,22,1,"PAH",1,1,12,0)
"Nothing Selected" displays, or no message at all displays.  The CPT 
"PKG",26,22,1,"PAH",1,1,13,0)
code is not selected and passed to PATIENT CARE ENCOUNTER (PCE).
"PKG",26,22,1,"PAH",1,1,14,0)
 
"PKG",26,22,1,"PAH",1,1,15,0)
Update:  If one or more CPT's are not found in the CPT file (#81), 
"PKG",26,22,1,"PAH",1,1,16,0)
the following message displays and lists the CPT codes:
"PKG",26,22,1,"PAH",1,1,17,0)
          "The following CPT Code(s) are not selected:
"PKG",26,22,1,"PAH",1,1,18,0)
            Not found in #81: #####,#####,".
"PKG",26,22,1,"PAH",1,1,19,0)
For one or more CPTs that are marked inactive in the CPT 
"PKG",26,22,1,"PAH",1,1,20,0)
file (#81), the following message displays and lists the CPT codes:
"PKG",26,22,1,"PAH",1,1,21,0)
          "The following CPT Code(s) are not selected: 
"PKG",26,22,1,"PAH",1,1,22,0)
            CPT(s) inactive in #81: #####,#####".
"PKG",26,22,1,"PAH",1,1,23,0)
All CPTs that are inactive or not found in file #81 will not be 
"PKG",26,22,1,"PAH",1,1,24,0)
passed to PCE.
"PKG",26,22,1,"PAH",1,1,25,0)
 
"PKG",26,22,1,"PAH",1,1,26,0)
2.  Currently:  CPTs marked inactive in the WKLD CODE file (#64) 
"PKG",26,22,1,"PAH",1,1,27,0)
can be selected and are passed to PCE.
"PKG",26,22,1,"PAH",1,1,28,0)
 
"PKG",26,22,1,"PAH",1,1,29,0)
Update:  If a selected CPT is marked inactive in file (#64), a 
"PKG",26,22,1,"PAH",1,1,30,0)
search is made for another active CPT linked to the same workload code.  
"PKG",26,22,1,"PAH",1,1,31,0)
If another active CPT is found, the active CPT replaces the inactive CPT
"PKG",26,22,1,"PAH",1,1,32,0)
and is passed to PCE.  The following message will display if an active
"PKG",26,22,1,"PAH",1,1,33,0)
replacement is found:
"PKG",26,22,1,"PAH",1,1,34,0)
  "The following CPT Code(s) are not selected: 
"PKG",26,22,1,"PAH",1,1,35,0)
    Inactive in #64\Active Replacement Found: ##### \ #####; ##### \
"PKG",26,22,1,"PAH",1,1,36,0)
#####".
"PKG",26,22,1,"PAH",1,1,37,0)
 
"PKG",26,22,1,"PAH",1,1,38,0)
If no active replacement found, the selected CPT is not passed to 
"PKG",26,22,1,"PAH",1,1,39,0)
PCE and is displayed in the following message:
"PKG",26,22,1,"PAH",1,1,40,0)
          "The following CPT Code(s) are not selected: 
"PKG",26,22,1,"PAH",1,1,41,0)
            CPT(s) inactive in #64: #####,#####".  
"PKG",26,22,1,"PAH",1,1,42,0)
 
"PKG",26,22,1,"PAH",1,1,43,0)
3.  Currently:  Inactive CPTs found in the WKLD CODE file (#64) 
"PKG",26,22,1,"PAH",1,1,44,0)
can be entered and passed to PCE for non-AP accessions.  When an inactive
"PKG",26,22,1,"PAH",1,1,45,0)
CPT is selected and passed to PCE, the entire order is marked invalid for
"PKG",26,22,1,"PAH",1,1,46,0)
workload and no workload is passed, and a mail message is generated at the
"PKG",26,22,1,"PAH",1,1,47,0)
site which states "No lab OOS location defined".
"PKG",26,22,1,"PAH",1,1,48,0)
 
"PKG",26,22,1,"PAH",1,1,49,0)
Update:  If a CPT is found inactive in file #64, a search will be 
"PKG",26,22,1,"PAH",1,1,50,0)
made for another active replacement CPT linked to the same workload code.
"PKG",26,22,1,"PAH",1,1,51,0)
If another active CPT is found, the active CPT replaces the inactive
"PKG",26,22,1,"PAH",1,1,52,0)
CPT.  If no active replacement CPT is found, the original CPT is not
"PKG",26,22,1,"PAH",1,1,53,0)
passed to PCE, and thus no misleading mail message is generated.
"PKG",26,22,1,"PAH",1,1,54,0)
 
"PKG",26,22,1,"PAH",1,1,55,0)
4. Currently:  Any subsequent CPT codes entered on an accession 
"PKG",26,22,1,"PAH",1,1,56,0)
will replace or overlay the quantity previously passed to PCE.
"PKG",26,22,1,"PAH",1,1,57,0)
Example:  CPT 88302 with quantity of 2 entered on day 1; PCE shows
"PKG",26,22,1,"PAH",1,1,58,0)
quantity of 2.  On day 2, CPT 88302 with quantity of 1 entered; PCE shows
"PKG",26,22,1,"PAH",1,1,59,0)
updated quantity of 1.  It should show 3.
"PKG",26,22,1,"PAH",1,1,60,0)
 
"PKG",26,22,1,"PAH",1,1,61,0)
Update:  All subsequent CPT code quantities entered for an 
"PKG",26,22,1,"PAH",1,1,62,0)
accession will be added to existing quantities stored in PCE.
"PKG",26,22,1,"PAH",1,1,63,0)
 
"PKG",26,22,1,"PAH",1,1,64,0)
5. Currently:  If a selected CPT is not linked to a workload code 
"PKG",26,22,1,"PAH",1,1,65,0)
in the WKLD CODE file (#64), the CPT is passed to PCE, and the message
"PKG",26,22,1,"PAH",1,1,66,0)
"Storing in LMIP".  This message incorrectly identifies the CPT as 
"PKG",26,22,1,"PAH",1,1,67,0)
having been stored in the WKLD CODE file (#64).
"PKG",26,22,1,"PAH",1,1,68,0)
 
"PKG",26,22,1,"PAH",1,1,69,0)
Update:  Selected CPT codes that are not linked to a workload code 
"PKG",26,22,1,"PAH",1,1,70,0)
in the WKLD CODE file (#64) will not be passed to PCE, and the following
"PKG",26,22,1,"PAH",1,1,71,0)
message will display:
"PKG",26,22,1,"PAH",1,1,72,0)
          "The following CPT Code(s) are not selected: 
"PKG",26,22,1,"PAH",1,1,73,0)
            Not linked to workload in #64: #####, #####".
"PKG",26,22,1,"PAH",1,1,74,0)
 
"PKG",26,22,1,"PAH",1,1,75,0)
6.  Currently:  If a selected CPT code is linked to multiple workload 
"PKG",26,22,1,"PAH",1,1,76,0)
codes, the workload code with the lowest IEN is selected.  This cannot be 
"PKG",26,22,1,"PAH",1,1,77,0)
changed; however, the problem has been reduced by increasing the number of 
"PKG",26,22,1,"PAH",1,1,78,0)
allowed ES Display Order numbers that can be assigned to a specific 
"PKG",26,22,1,"PAH",1,1,79,0)
CPT-workload code combination.  The limit has been increased from 100 to 
"PKG",26,22,1,"PAH",1,1,80,0)
1000.  
"PKG",26,22,1,"PAH",1,1,81,0)
 
"PKG",26,22,1,"PAH",1,1,82,0)
7.  Currently:  When more than one accession is entered for a patient on 
"PKG",26,22,1,"PAH",1,1,83,0)
the same date, at the same location, and the specimen collection date/time 
"PKG",26,22,1,"PAH",1,1,84,0)
does not contain a unique time, then each accession for this patient will 
"PKG",26,22,1,"PAH",1,1,85,0)
have the same encounter/visit number assigned when CPT codes are entered 
"PKG",26,22,1,"PAH",1,1,86,0)
and passed to PCE.  
"PKG",26,22,1,"PAH",1,1,87,0)
 
"PKG",26,22,1,"PAH",1,1,88,0)
Update:  Within Anatomic Pathology (AP) Login, the "Date/time Specimen
"PKG",26,22,1,"PAH",1,1,89,0)
taken:" prompt default has been changed from TODAY (date only) to NOW
"PKG",26,22,1,"PAH",1,1,90,0)
(date and time).  This helps decrease the chance of having the same
"PKG",26,22,1,"PAH",1,1,91,0)
encounter number assigned to more than one accession entered on the same
"PKG",26,22,1,"PAH",1,1,92,0)
patient on the same date, at the same location.
"PKG",26,22,1,"PAH",1,1,93,0)
 
"PKG",26,22,1,"PAH",1,1,94,0)
8. A couple of minor cosmetic updates are included in this patch:
"PKG",26,22,1,"PAH",1,1,95,0)
a.  The prompt "Releasing Pathologist:" has been changed to "Provider:" 
"PKG",26,22,1,"PAH",1,1,96,0)
since the name entered at this prompt must be an active provider.  
"PKG",26,22,1,"PAH",1,1,97,0)
b.  The pathologist or cytotechnologist name, if entered on the accession,
"PKG",26,22,1,"PAH",1,1,98,0)
is included in the header information that displays at the time CPT coding 
"PKG",26,22,1,"PAH",1,1,99,0)
is entered.
"PKG",26,22,1,"PAH",1,1,100,0)
 
"PKG",26,22,1,"PAH",1,1,101,0)
The updates described above are displayed in the following screen format.  
"PKG",26,22,1,"PAH",1,1,102,0)
This screen format is used in the menu options listed below it:
"PKG",26,22,1,"PAH",1,1,103,0)
 
"PKG",26,22,1,"PAH",1,1,104,0)
Provider: PROVIDER, ONE//        PRO          PHYSICIAN
"PKG",26,22,1,"PAH",1,1,105,0)
 
"PKG",26,22,1,"PAH",1,1,106,0)
Select CPT codes:  88302
"PKG",26,22,1,"PAH",1,1,107,0)
 
"PKG",26,22,1,"PAH",1,1,108,0)
TEST, PATIENT1                        000-99-1234         DOB: Mar 05, 1955
"PKG",26,22,1,"PAH",1,1,109,0)
     Collection Date: Jan 06, 2005@11:52
"PKG",26,22,1,"PAH",1,1,110,0)
          Acc #: NSP 05 1                                   Loc: 5N
"PKG",26,22,1,"PAH",1,1,111,0)
               Specimen: 
"PKG",26,22,1,"PAH",1,1,112,0)
     Tissue Specimens: 
"PKG",26,22,1,"PAH",1,1,113,0)
               TAIL
"PKG",26,22,1,"PAH",1,1,114,0)
     Test(s);  SURGICAL PATH REPORTING/ SURGICAL PATHOLOGY LOG-IN/ 
"PKG",26,22,1,"PAH",1,1,115,0)
     Pathologist: PHYSICIAN, ONE
"PKG",26,22,1,"PAH",1,1,116,0)
 
"PKG",26,22,1,"PAH",1,1,117,0)
                               Selected CPT Codes                           
"PKG",26,22,1,"PAH",1,1,118,0)
    
"PKG",26,22,1,"PAH",1,1,119,0)
     (1)  88302 LEVEL II - SURGICAL PATHOLOGY, GROSS AND MICROSCOP
"PKG",26,22,1,"PAH",1,1,120,0)
          Surgical Pathology Level II  {88518.0000}
"PKG",26,22,1,"PAH",1,1,121,0)
 
"PKG",26,22,1,"PAH",1,1,122,0)
Menu Options:
"PKG",26,22,1,"PAH",1,1,123,0)
       Lab CPT Billing [LRCAPES]
"PKG",26,22,1,"PAH",1,1,124,0)
       Verify/release reports, anat path [LRAPR], 
"PKG",26,22,1,"PAH",1,1,125,0)
               CPT Coding selection
"PKG",26,22,1,"PAH",1,1,126,0)
       Provisional anatomic diagnoses [LRAPAUPAD]
"PKG",26,22,1,"PAH",1,1,127,0)
       Autopsy protocol [LRAPAUDAP]
"PKG",26,22,1,"PAH",1,1,128,0)
       Autopsy protocol & SNOMED coding [LRAPAUDAB]
"PKG",26,22,1,"PAH",1,1,129,0)
       Autopsy protocol & ICD9CM coding [LRAPAUDAA]
"PKG",26,22,1,"PAH",1,1,130,0)
       FS/Gross/Micro/Dx [LRAPDGM]
"PKG",26,22,1,"PAH",1,1,131,0)
       FS/Gross/Micro/Dx/SNOMED Coding [LRAPDGS]
"PKG",26,22,1,"PAH",1,1,132,0)
       FS/Gross/Micro/Dx/ICD9CM Coding [LRAPDGI]
"PKG",26,22,1,"PAH",1,1,133,0)
 
"PKG",26,22,1,"PAH",1,1,134,0)
9. A couple of general corrections are included in this patch.  For
"PKG",26,22,1,"PAH",1,1,135,0)
certain $D statements which read, "'$DATA()#2", the modulo is incorrectly 
"PKG",26,22,1,"PAH",1,1,136,0)
applied to the result of the "'$DATA()".  Instead, the NOT operator "'" 
"PKG",26,22,1,"PAH",1,1,137,0)
should be applied to the evaluation of "$DATA()#2" to correctly read,
"PKG",26,22,1,"PAH",1,1,138,0)
"'($DATA()#2)".  The following statements have been corrected:
"PKG",26,22,1,"PAH",1,1,139,0)
 
"PKG",26,22,1,"PAH",1,1,140,0)
a. In SETWKL+13^LRCAPES1, Q:'$D(^LAM(LRP,0))#2, has been changed to
"PKG",26,22,1,"PAH",1,1,141,0)
   Q:'($D(^LAM(LRP,0))#2).
"PKG",26,22,1,"PAH",1,1,142,0)
b. In EN5+4^LRCAPPH1, Q:'$D(^LRO(69,LRCDT,1,LRSN,2,LRTST,0))#2, has been
"PKG",26,22,1,"PAH",1,1,143,0)
   changed to Q:'($D(^LRO(69,LRCDT,1,LRSN,2,LRTST,0))#2).
"PKG",26,22,1,"PAH",1,1,144,0)
 
"PKG",26,22,1,"PAH",1,1,145,0)
Data Dictionary Changes
"PKG",26,22,1,"PAH",1,1,146,0)
=======================
"PKG",26,22,1,"PAH",1,1,147,0)
VistA Laboratory AP CPT Code Corrections Patch LR*5.2*308 software release
"PKG",26,22,1,"PAH",1,1,148,0)
contains the following data dictionary changes:
"PKG",26,22,1,"PAH",1,1,149,0)
 
"PKG",26,22,1,"PAH",1,1,150,0)
WKLD CODE file (#64)
"PKG",26,22,1,"PAH",1,1,151,0)
------------------------
"PKG",26,22,1,"PAH",1,1,152,0)
WKLD CODE file (#64), ES DISPLAY ORDER field (#26) has been modified 
"PKG",26,22,1,"PAH",1,1,153,0)
to increase the quantity allowed from 100 to 1000.
"PKG",26,22,1,"PAH",1,1,154,0)
 
"PKG",26,22,1,"PAH",1,1,155,0)
======================
"PKG",26,22,1,"PAH",1,1,156,0)
Associated E3Rs - None
"PKG",26,22,1,"PAH",1,1,157,0)
---------------
"PKG",26,22,1,"PAH",1,1,158,0)
 
"PKG",26,22,1,"PAH",1,1,159,0)
Associated NOISs -
"PKG",26,22,1,"PAH",1,1,160,0)
----------------  
"PKG",26,22,1,"PAH",1,1,161,0)
 
"PKG",26,22,1,"PAH",1,1,162,0)
 
"PKG",26,22,1,"PAH",1,1,163,0)
CPH-0103-41645 / HD0000000069980
"PKG",26,22,1,"PAH",1,1,164,0)
FGH-0103-31657 / HD0000000069982
"PKG",26,22,1,"PAH",1,1,165,0)
MIN-0103-41656 / HD0000000069981
"PKG",26,22,1,"PAH",1,1,166,0)
BHS-0103-12034 / HD0000000069988
"PKG",26,22,1,"PAH",1,1,167,0)
UNY-0103-11749 / HD0000000069985
"PKG",26,22,1,"PAH",1,1,168,0)
WBP-0103-21809 / HD0000000069986
"PKG",26,22,1,"PAH",1,1,169,0)
SAM-0603-21566 / HD0000000070159
"PKG",26,22,1,"PAH",1,1,170,0)
JAC-1103-70158 / HD0000000070386
"PKG",26,22,1,"PAH",1,1,171,0)
ALT-0304-20022 / HD0000000070580
"PKG",26,22,1,"PAH",1,1,172,0)
SBY-0304-31852 / HD0000000070614
"PKG",26,22,1,"PAH",1,1,173,0)
BIL-0304-31578 / HD0000000070606
"PKG",26,22,1,"PAH",1,1,174,0)
WRJ-0404-10360 / HD0000000070654
"PKG",26,22,1,"PAH",1,1,175,0)
HVH-0404-11404 / HD0000000070684
"PKG",26,22,1,"PAH",1,1,176,0)
CPH-0804-41938 / HD0000000070965
"PKG",26,22,1,"PAH",1,1,177,0)
MIN-1204-40394 / HD0000000071122
"PKG",26,22,1,"PAH",1,1,178,0)
HEH-0304-41954 / HD0000000070618
"PKG",26,22,1,"PAH",1,1,179,0)
 
"PKG",26,22,1,"PAH",1,1,180,0)
=====================
"PKG",26,22,1,"PAH",1,1,181,0)
Test Sites:
"PKG",26,22,1,"PAH",1,1,182,0)
===========
"PKG",26,22,1,"PAH",1,1,183,0)
 
"PKG",26,22,1,"PAH",1,1,184,0)
Boston HCS - VMS/CACHE (large integrated site)
"PKG",26,22,1,"PAH",1,1,185,0)
Durham VAMC - VMS/CACHE (large site)
"PKG",26,22,1,"PAH",1,1,186,0)
Iowa City VAMC - VMS/CACHE (large integrated site)
"PKG",26,22,1,"PAH",1,1,187,0)
Long Beach VAMC - VMS/CACHE (large site)
"PKG",26,22,1,"PAH",1,1,188,0)
 
"PKG",26,22,1,"PAH",1,1,189,0)
================
"PKG",26,22,1,"PAH",1,1,190,0)
Routine Summary:
"PKG",26,22,1,"PAH",1,1,191,0)
================
"PKG",26,22,1,"PAH",1,1,192,0)
 
"PKG",26,22,1,"PAH",1,1,193,0)
The following list of the routine(s) included in this patch.  The
"PKG",26,22,1,"PAH",1,1,194,0)
second line of each of these routine(s) will look like:
"PKG",26,22,1,"PAH",1,1,195,0)
 
"PKG",26,22,1,"PAH",1,1,196,0)
<tab>;;5.2;LAB SERVICE;**[patch list]**;Sep 27 1994
"PKG",26,22,1,"PAH",1,1,197,0)
 
"PKG",26,22,1,"PAH",1,1,198,0)
               CHECK^XTSUMBLD results
"PKG",26,22,1,"PAH",1,1,199,0)
 
"PKG",26,22,1,"PAH",1,1,200,0)
Routine      Before    After       Patch
"PKG",26,22,1,"PAH",1,1,201,0)
Name         Patch     Patch       List
"PKG",26,22,1,"PAH",1,1,202,0)
 
"PKG",26,22,1,"PAH",1,1,203,0)
LR308       N/A       3577348    **308**  (Deleted by KIDS)
"PKG",26,22,1,"PAH",1,1,204,0)
LRAPLG1     5113296   5107203    **72,121,248,308**
"PKG",26,22,1,"PAH",1,1,205,0)
LRAPUTL     9752029   9713709    **259,308**
"PKG",26,22,1,"PAH",1,1,206,0)
LRCAPES    13104305  13495108    **274,259,349,308**
"PKG",26,22,1,"PAH",1,1,207,0)
LRCAPES1    8132160  13575476    **274,308**
"PKG",26,22,1,"PAH",1,1,208,0)
LRCAPPH1   13504461  14078305    **127,136,138,158,263,264,274,291,359,308**
"PKG",26,22,1,"PAH",1,1,209,0)
 
"PKG",26,22,1,"PAH",1,1,210,0)
 
"PKG",26,22,1,"PAH",1,1,211,0)
Software Retrieval
"PKG",26,22,1,"PAH",1,1,212,0)
------------------
"PKG",26,22,1,"PAH",1,1,213,0)
VistA Laboratory Anatomic Pathology Current Procedural Terminology 
"PKG",26,22,1,"PAH",1,1,214,0)
Corrections Patch LR*5.2*308 software is distributed by Packman.
"PKG",26,22,1,"PAH",1,1,215,0)
 
"PKG",26,22,1,"PAH",1,1,216,0)
Documentation Retrieval
"PKG",26,22,1,"PAH",1,1,217,0)
-----------------------
"PKG",26,22,1,"PAH",1,1,218,0)
VistA Laboratory Anatomic Pathology (AP) Current Procedural 
"PKG",26,22,1,"PAH",1,1,219,0)
Terminology(CPT)Corrections Patch LR*5.2*308 software User Guide
"PKG",26,22,1,"PAH",1,1,220,0)
is available at the following Office of Information Field Offices (OIFOs) 
"PKG",26,22,1,"PAH",1,1,221,0)
ANONYMOUS.SOFTWARE directories: 
"PKG",26,22,1,"PAH",1,1,222,0)
 
"PKG",26,22,1,"PAH",1,1,223,0)
OI Field Office    FTP Address                 Directory
"PKG",26,22,1,"PAH",1,1,224,0)
---------------    -----------                 ---------
"PKG",26,22,1,"PAH",1,1,225,0)
ALBANY             ftp.fo-albany.med.va.gov    [ANONYMOUS.SOFTWARE]
"PKG",26,22,1,"PAH",1,1,226,0)
HINES              ftp.fo-hines.med.va.gov     [ANONYMOUS.SOFTWARE]
"PKG",26,22,1,"PAH",1,1,227,0)
SALT LAKE CITY     ftp.fo-slc.med.va.gov       [ANONYMOUS.SOFTWARE]
"PKG",26,22,1,"PAH",1,1,228,0)
 
"PKG",26,22,1,"PAH",1,1,229,0)
 
"PKG",26,22,1,"PAH",1,1,230,0)
Documentation Retrieval Formats
"PKG",26,22,1,"PAH",1,1,231,0)
-------------------------------
"PKG",26,22,1,"PAH",1,1,232,0)
VistA Laboratory Anatomic Pathology (AP) Current Procedural 
"PKG",26,22,1,"PAH",1,1,233,0)
Terminology(CPT)Corrections Patch LR*5.2*308 User Guide files are 
"PKG",26,22,1,"PAH",1,1,234,0)
exported in the following retrieval formats:
"PKG",26,22,1,"PAH",1,1,235,0)
 
"PKG",26,22,1,"PAH",1,1,236,0)
File Name           Contents                          Retrieval Formats
"PKG",26,22,1,"PAH",1,1,237,0)
---------           --------                          -----------------
"PKG",26,22,1,"PAH",1,1,238,0)
LAB_52_308_UG.doc    VistA Laboratory Anatomic Pathology
"PKG",26,22,1,"PAH",1,1,239,0)
                     (AP) Current Procedural Terminology
"PKG",26,22,1,"PAH",1,1,240,0)
                     (CPT)Corrections Patch LR*5.2*308
"PKG",26,22,1,"PAH",1,1,241,0)
                     User Guide                            BINARY
"PKG",26,22,1,"PAH",1,1,242,0)
 
"PKG",26,22,1,"PAH",1,1,243,0)
LAB_52_308_UG.pdf   VistA Laboratory Anatomic Pathology
"PKG",26,22,1,"PAH",1,1,244,0)
                     (AP) Current Procedural Terminology
"PKG",26,22,1,"PAH",1,1,245,0)
                     (CPT)Corrections Patch LR*5.2*308
"PKG",26,22,1,"PAH",1,1,246,0)
                     User Guide                            BINARY
"PKG",26,22,1,"PAH",1,1,247,0)
 
"PKG",26,22,1,"PAH",1,1,248,0)
 
"PKG",26,22,1,"PAH",1,1,249,0)
VistA Website Locations:
"PKG",26,22,1,"PAH",1,1,250,0)
-----------------------
"PKG",26,22,1,"PAH",1,1,251,0)
VistA Laboratory Anatomic Pathology (AP) Current Procedural 
"PKG",26,22,1,"PAH",1,1,252,0)
Terminology(CPT)Corrections Patch LR*5.2*308 User Guide is accessible in 
"PKG",26,22,1,"PAH",1,1,253,0)
MS Word (.doc) and Portable Document Format (.pdf) at the following 
"PKG",26,22,1,"PAH",1,1,254,0)
VistA locations:
"PKG",26,22,1,"PAH",1,1,255,0)
 
"PKG",26,22,1,"PAH",1,1,256,0)
Laboratory Version 5.2 Home Page
"PKG",26,22,1,"PAH",1,1,257,0)
--------------------------------
"PKG",26,22,1,"PAH",1,1,258,0)
http://vista.med.va.gov/ClinicalSpecialties/lab/
"PKG",26,22,1,"PAH",1,1,259,0)
 
"PKG",26,22,1,"PAH",1,1,260,0)
VistA Documentation Library (VDL)
"PKG",26,22,1,"PAH",1,1,261,0)
---------------------------------
"PKG",26,22,1,"PAH",1,1,262,0)
www.va.gov/vdl/
"PRE")
LR308
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","LR308")
0^^B10318611^n/a
"RTN","LR308",1,0)
LR308 ;DALOI/KLL - LR*5.2*308 PATCH ENVIRONMENT CHECK ROUTINE ;07/30/04
"RTN","LR308",2,0)
 ;;5.2;LAB SERVICE;**308**;Sep 27, 1994
"RTN","LR308",3,0)
EN ; Does not prevent loading of the transport global.
"RTN","LR308",4,0)
 ; Environment check is done only during the install.
"RTN","LR308",5,0)
 ;
"RTN","LR308",6,0)
 I '$G(XPDENV) D  Q
"RTN","LR308",7,0)
 .N XQA,XQAMSG
"RTN","LR308",8,0)
 .S XQAMSG="Transport global for patch "_$G(XPDNM,"Unknown patch")
"RTN","LR308",9,0)
 .S XQAMSG=XQAMSG_" loaded on "_$$HTE^XLFDT($H)
"RTN","LR308",10,0)
 .S XQA("G.LMI")=""
"RTN","LR308",11,0)
 .D SETUP^XQALERT
"RTN","LR308",12,0)
 .S MSG="Sending transport global loaded alert to mail group G.LMI"
"RTN","LR308",13,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR308",14,0)
 ;
"RTN","LR308",15,0)
 D CHECK
"RTN","LR308",16,0)
 D EXIT
"RTN","LR308",17,0)
 Q
"RTN","LR308",18,0)
 ;
"RTN","LR308",19,0)
CHECK ; Perform environment check
"RTN","LR308",20,0)
 ;
"RTN","LR308",21,0)
 I $S('$G(IOM):1,'$G(IOSL):1,$G(U)'="^":1,1:0) D  Q
"RTN","LR308",22,0)
 .D BMES^XPDUTL($$CJ^XLFSTR("Terminal Device is not defined",80))
"RTN","LR308",23,0)
 .S XPDQUIT=2
"RTN","LR308",24,0)
 ;
"RTN","LR308",25,0)
 I $S('$G(DUZ):1,$D(DUZ)[0:1,$D(DUZ(0))[0:1,1:0) D  Q
"RTN","LR308",26,0)
 .S MSG="Please log in to set local DUZ... variables"
"RTN","LR308",27,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR308",28,0)
 .S XPDQUIT=2
"RTN","LR308",29,0)
 ;
"RTN","LR308",30,0)
 I '$D(^VA(200,$G(DUZ),0))#2 D  Q
"RTN","LR308",31,0)
 .S MSG="You are not a valid user on this system"
"RTN","LR308",32,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR308",33,0)
 .S XPDQUIT=2
"RTN","LR308",34,0)
 ;
"RTN","LR308",35,0)
 S XPDIQ("XPZ1","B")="NO"
"RTN","LR308",36,0)
 ;
"RTN","LR308",37,0)
 Q
"RTN","LR308",38,0)
 ;
"RTN","LR308",39,0)
EXIT ;
"RTN","LR308",40,0)
 I $G(XPDQUIT) D
"RTN","LR308",41,0)
 .S MSG="--- Install Environment Check FAILED ---"
"RTN","LR308",42,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR308",43,0)
 I '$G(XPDQUIT) D
"RTN","LR308",44,0)
 .D BMES^XPDUTL($$CJ^XLFSTR("--- Environment Check is Ok ---",80))
"RTN","LR308",45,0)
 Q
"RTN","LR308",46,0)
 ;
"RTN","LR308",47,0)
PRE ; KIDS Pre install for LR*5.2*308
"RTN","LR308",48,0)
 ;
"RTN","LR308",49,0)
 N XQA,XQAMSG
"RTN","LR308",50,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")
"RTN","LR308",51,0)
 S XQAMSG=XQAMSG_" started on "_$$HTE^XLFDT($H)
"RTN","LR308",52,0)
 S XQA("G.LMI")=""
"RTN","LR308",53,0)
 D SETUP^XQALERT
"RTN","LR308",54,0)
 ;
"RTN","LR308",55,0)
 S MSG="Sending install started alert to mail group G.LMI"
"RTN","LR308",56,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR308",57,0)
 ;
"RTN","LR308",58,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install started ***",80))
"RTN","LR308",59,0)
 ;
"RTN","LR308",60,0)
 S Y=$$OPTDE^XPDUTL("LRAP",2)
"RTN","LR308",61,0)
 S MSG="Disabling Anatomic Pathology [LRAP] option"
"RTN","LR308",62,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR308",63,0)
 ;
"RTN","LR308",64,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install completed ***",80))
"RTN","LR308",65,0)
 ;
"RTN","LR308",66,0)
 Q
"RTN","LR308",67,0)
 ;
"RTN","LR308",68,0)
POST ; KIDS Post install for LR*5.2*308
"RTN","LR308",69,0)
 ;
"RTN","LR308",70,0)
 N XQA,XQAMSG
"RTN","LR308",71,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install started ***",80))
"RTN","LR308",72,0)
 ;
"RTN","LR308",73,0)
 S Y=$$OPTDE^XPDUTL("LRAP",1)
"RTN","LR308",74,0)
 S MSG="Enabling Anatomic Pathology [LRAP] option"
"RTN","LR308",75,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR308",76,0)
 ;
"RTN","LR308",77,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install completed ***",80))
"RTN","LR308",78,0)
 ;
"RTN","LR308",79,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")
"RTN","LR308",80,0)
 S XQAMSG=XQAMSG_" completed on "_$$HTE^XLFDT($H)
"RTN","LR308",81,0)
 S XQA("G.LMI")=""
"RTN","LR308",82,0)
 D SETUP^XQALERT
"RTN","LR308",83,0)
 ;
"RTN","LR308",84,0)
 S MSG="Sending install completion alert to mail group G.LMI"
"RTN","LR308",85,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR308",86,0)
 ;
"RTN","LR308",87,0)
 Q
"RTN","LRAPLG1")
0^4^B12975824^B12986045
"RTN","LRAPLG1",1,0)
LRAPLG1 ;AVAMC/REG/WTY/KLL - LOG-IN CONT. ;07/30/04
"RTN","LRAPLG1",2,0)
 ;;5.2;LAB SERVICE;**72,121,248,308**;Sep 27, 1994
"RTN","LRAPLG1",3,0)
 ;
"RTN","LRAPLG1",4,0)
 ;Reference to ^%ZOSF("TEST" supported by IA #10096
"RTN","LRAPLG1",5,0)
 ;Reference to ^VA(200 supported by IA #10060
"RTN","LRAPLG1",6,0)
 ;Reference to ^%DT supported by IA #10003
"RTN","LRAPLG1",7,0)
 ;Reference to EN^DDIOL supported by IA #10142
"RTN","LRAPLG1",8,0)
 ;Reference to ^DIE supported by IA #10018
"RTN","LRAPLG1",9,0)
 ;Reference to DISP^SROSPLG supported by IA #893
"RTN","LRAPLG1",10,0)
 ;
"RTN","LRAPLG1",11,0)
 L +^LRO(68,LRAA,1,LRAD):5 I '$T D  Q
"RTN","LRAPLG1",12,0)
 .S MSG="Someone else is logging in specimens.  "
"RTN","LRAPLG1",13,0)
 .S MSG=MSG_"Please wait and try again."
"RTN","LRAPLG1",14,0)
 .D EN^DDIOL(MSG,"","!!") K MSG
"RTN","LRAPLG1",15,0)
 S LRAN=$P(^LRO(68,LRAA,1,LRAD,1,0),"^",3)
"RTN","LRAPLG1",16,0)
 F X=0:0 S LRAN=LRAN+1 Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))
"RTN","LRAPLG1",17,0)
 I $D(^LR(LRXREF,LRH(2),LRABV,LRAN)) F X=0:0 S LRAN=LRAN+1 Q:'$D(^LR(LRXREF,LRH(2),LRABV,LRAN))
"RTN","LRAPLG1",18,0)
 W !!,"Assign ",LRO(68)," (",LRABV,") accession #:  ",LRAN," " S %=1 D YN^LRU
"RTN","LRAPLG1",19,0)
 I %<1 L -^LRO(68,LRAA,1,LRAD) G OUT
"RTN","LRAPLG1",20,0)
 I %=2 D OS G:'$D(LRFND) AU K LRFND L -^LRO(68,LRAA,1,LRAD) G OUT
"RTN","LRAPLG1",21,0)
 S X=^LRO(68,LRAA,1,LRAD,1,0),X(2)=$P(X,"^",4)+1
"RTN","LRAPLG1",22,0)
 S ^LRO(68,LRAA,1,LRAD,1,0)=$P(X,"^",1,2)_"^"_LRAN_"^"_X(2)
"RTN","LRAPLG1",23,0)
 S ^LRO(68,LRAA,1,LRAD,1,LRAN,0)=LRDFN,X=LRAN
"RTN","LRAPLG1",24,0)
 L -^LRO(68,LRAA,1,LRAD)
"RTN","LRAPLG1",25,0)
AU S LRAN=X,LRAC=LRABV_" "_$E(LRAD,2,3)_" "_LRAN I LRSS="AU" D ^LRAUAW Q
"RTN","LRAPLG1",26,0)
 S DA(1)=LRDFN S:'$D(^LR(LRDFN,LRSS,0)) ^(0)="^"_LRSF_"DA^0^0"
"RTN","LRAPLG1",27,0)
DT W !,"Date/time Specimen taken: "
"RTN","LRAPLG1",28,0)
 W $S($E(LRAD,1,3)=$E(DT,1,3):"NOW// ",1:"")
"RTN","LRAPLG1",29,0)
 R X:DTIME G:X[U!('$T) END
"RTN","LRAPLG1",30,0)
 S:X=""&($E(LRAD,1,3)=$E(DT,1,3)) X="N"
"RTN","LRAPLG1",31,0)
 S %DT="ETX",%DT(0)="-N" D ^%DT K %DT
"RTN","LRAPLG1",32,0)
 G:X["?" DT G:Y=-1 END
"RTN","LRAPLG1",33,0)
 S LRSD=Y,LRI=9999999-Y
"RTN","LRAPLG1",34,0)
 L +^LR(LRDFN,LRSS):5 I '$T D  Q
"RTN","LRAPLG1",35,0)
 .S MSG="This record is locked by another user.  "
"RTN","LRAPLG1",36,0)
 .S MSG=MSG_"Please wait and try again."
"RTN","LRAPLG1",37,0)
 .D EN^DDIOL(MSG,"","!!"),X K MSG
"RTN","LRAPLG1",38,0)
F I $D(^LR(LRDFN,LRSS,LRI,0)) S LRI=LRI-.00001 G F
"RTN","LRAPLG1",39,0)
 S ^LR(LRDFN,LRSS,LRI,0)=LRSD
"RTN","LRAPLG1",40,0)
 S X=^LR(LRDFN,LRSS,0),^(0)=$P(X,"^",1,2)_"^"_LRI_"^"_($P(X,"^",4)+1)
"RTN","LRAPLG1",41,0)
 L -^LR(LRDFN,LRSS)
"RTN","LRAPLG1",42,0)
 S LR(.07)=$S($D(SRDOC):SRDOC,1:"") K SRDOC
"RTN","LRAPLG1",43,0)
 S:LR(.07) LR(.07)=$P($G(^VA(200,LR(.07),0)),"^")
"RTN","LRAPLG1",44,0)
 S DIC(0)="EQLMF",DLAYGO=63,DA=LRI,DIE="^LR(LRDFN,LRSS,"
"RTN","LRAPLG1",45,0)
 D @LR("L"),^DIE K DLAYGO
"RTN","LRAPLG1",46,0)
 I $D(Y)!($D(DTOUT)) D  Q
"RTN","LRAPLG1",47,0)
 .W $C(7),!!,"All Prompts not answered  <ENTRY DELETED>"
"RTN","LRAPLG1",48,0)
 .K ^LR(LRDFN,LRSS,DA)
"RTN","LRAPLG1",49,0)
 .S X=^LR(LRDFN,LRSS,0),X(1)=$O(^(0))
"RTN","LRAPLG1",50,0)
 .S ^LR(LRDFN,LRSS,0)=$P(X,"^",1,2)_"^"_X(1)_"^"_($P(X,"^",4)-1)
"RTN","LRAPLG1",51,0)
 .D X
"RTN","LRAPLG1",52,0)
 I LRSS="CY",LRCAPA D CK^LRAPCWK
"RTN","LRAPLG1",53,0)
 I LRSS="SP" S X="SROSPLG" X ^%ZOSF("TEST") I $T D DISP^SROSPLG
"RTN","LRAPLG1",54,0)
 D ^LRUWLF D:LRSS="CY"&LRCAPA ^LRAPCWK D:"SPEM"[LRSS&LRCAPA ^LRAPSWK D:"SPCYEM"[LRSS ^LRSPGD
"RTN","LRAPLG1",55,0)
 D OERR^LR7OB63D
"RTN","LRAPLG1",56,0)
 Q
"RTN","LRAPLG1",57,0)
X ;from LRAUAW
"RTN","LRAPLG1",58,0)
 K:"CYEMSP"[LRSS ^LR(LRXREF,LRH(2),LRABV,LRAN)
"RTN","LRAPLG1",59,0)
 I LRSS="AU",$D(LRRC) D
"RTN","LRAPLG1",60,0)
 .K ^LR("AAUA",+$E(LRRC,1,3),LRABV,LRAN),^LR("AAU",+LRRC,LRDFN)
"RTN","LRAPLG1",61,0)
 I $D(LRRC),LRRC>1 K:"CYEMSP"[LRSS ^LR(LRXR,LRRC,LRDFN,LRI)
"RTN","LRAPLG1",62,0)
 K LRRC
"RTN","LRAPLG1",63,0)
END ;from LRAUAW, LRAPLG2
"RTN","LRAPLG1",64,0)
 L +^LRO(68,LRAA,1,LRAD):5 I '$T D  Q
"RTN","LRAPLG1",65,0)
 .S MSG="Someone else is logging in specimens.  "
"RTN","LRAPLG1",66,0)
 .S MSG=MSG_"Please wait and try again."
"RTN","LRAPLG1",67,0)
 .D EN^DDIOL(MSG,"","!!") K MSG
"RTN","LRAPLG1",68,0)
 K ^LRO(68,LRAA,1,LRAD,1,LRAN),^LRO(68,LRAA,1,"AC",DUZ(2),LRAD,LRAN)
"RTN","LRAPLG1",69,0)
 S X=^LRO(68,LRAA,1,LRAD,1,0),X(1)=$O(^(0)),X(2)=$P(X,"^",4)-1
"RTN","LRAPLG1",70,0)
 S ^LRO(68,LRAA,1,LRAD,1,0)=$P(X,"^",1,2)_"^"_X(1)_"^"_X(2)
"RTN","LRAPLG1",71,0)
 L -^LRO(68,LRAA,1,LRAD)
"RTN","LRAPLG1",72,0)
 Q
"RTN","LRAPLG1",73,0)
OS R !!,"Enter Accession # : ",X:DTIME I X=""!(X[U) S LRFND=1 Q
"RTN","LRAPLG1",74,0)
 I X'?1N.N!(X<1)!(X>99999) W $C(7),!!,"ENTER A WHOLE NUMBER FROM 1 TO 99999",! G OS
"RTN","LRAPLG1",75,0)
 I $D(^LRO(68,LRAA,1,LRAD,1,X,0)),$P(^(0),U) D ^LRUTELL G OS
"RTN","LRAPLG1",76,0)
 S ^LRO(68,LRAA,1,LRAD,1,X,0)=LRDFN I $D(LRXREF),$D(^LR(LRXREF,LRH(2),LRABV,X)) D ^LRAPLG2 S LRFND=1
"RTN","LRAPLG1",77,0)
 Q
"RTN","LRAPLG1",78,0)
OUT Q
"RTN","LRAPUTL")
0^5^B64931804^B65239334
"RTN","LRAPUTL",1,0)
LRAPUTL ;DALOI/WTY - AP UTILITIES;2/26/01
"RTN","LRAPUTL",2,0)
 ;;5.2;LAB SERVICE;**259,308**;Sep 27, 1994
"RTN","LRAPUTL",3,0)
 ;
"RTN","LRAPUTL",4,0)
 ;Reference  to EXTRACT^TIULQ supported by IA #2693
"RTN","LRAPUTL",5,0)
 ;
"RTN","LRAPUTL",6,0)
 Q
"RTN","LRAPUTL",7,0)
ACCYR(LRYROUT,LRYRIN,LRAREA,LRAANM) ;
"RTN","LRAPUTL",8,0)
 ; Return variable (passed by reference):
"RTN","LRAPUTL",9,0)
 ;      LRYROUT = Accession Year LRAD^LRH(0) 
"RTN","LRAPUTL",10,0)
 ;                 where LRAD is format 3010000
"RTN","LRAPUTL",11,0)
 ;                       LRH(0) is format 2001
"RTN","LRAPUTL",12,0)
 ;              = -1 - Error Condition
"RTN","LRAPUTL",13,0)
 ;              =  0 - No change from default value (LRYRIN)
"RTN","LRAPUTL",14,0)
 ;
"RTN","LRAPUTL",15,0)
 ; Input parameters:
"RTN","LRAPUTL",16,0)
 ;      LRYRIN  = Default accession year in yyyy format
"RTN","LRAPUTL",17,0)
 ;      LRAREA  = Accession Area Mnemonic (ex. AU,CY,EM,SP)
"RTN","LRAPUTL",18,0)
 ;      LRAANM  = Accession Area Name (ex. SURGICAL PATHOLOGY)
"RTN","LRAPUTL",19,0)
 ;
"RTN","LRAPUTL",20,0)
 S LRYROUT=-1
"RTN","LRAPUTL",21,0)
 Q:LRAREA=""!(LRYRIN="")!(LRAANM="")
"RTN","LRAPUTL",22,0)
 N LRYR1,LRYR2
"RTN","LRAPUTL",23,0)
 W !!,"Data entry for ",LRYRIN," "
"RTN","LRAPUTL",24,0)
 S %=1 D YN^LRU
"RTN","LRAPUTL",25,0)
 I %<1 D END Q
"RTN","LRAPUTL",26,0)
 I %=1 S LRYROUT=0 K LRYRIN,LRAREA,LRAANM Q
"RTN","LRAPUTL",27,0)
 I %=2 D  I Y<1 D END Q
"RTN","LRAPUTL",28,0)
 .S %DT="AE",%DT(0)="-N",%DT("A")="Enter YEAR: " D ^%DT
"RTN","LRAPUTL",29,0)
 .Q:Y<1
"RTN","LRAPUTL",30,0)
 .S LRYR1=$E(Y,1,3)_"0000",LRYR2=$E(Y,1,3)+1700
"RTN","LRAPUTL",31,0)
 I '$O(^LRO(68,LRAREA,1,LRYR1,1,0)) D  Q
"RTN","LRAPUTL",32,0)
 .W $C(7),!!,"NO ",LRAANM," ACCESSIONS IN FILE FOR ",LRYR2,!!
"RTN","LRAPUTL",33,0)
 .S LRYROUT=-1
"RTN","LRAPUTL",34,0)
 .D END
"RTN","LRAPUTL",35,0)
 S LRYROUT=LRYR1_U_LRYR2
"RTN","LRAPUTL",36,0)
 Q
"RTN","LRAPUTL",37,0)
 ;
"RTN","LRAPUTL",38,0)
LOOKUP(LRDATA,LRYR1,LRAANM,LRAREA,LRYR2,LRAAN) ;
"RTN","LRAPUTL",39,0)
 ;Lookup by accession number or patient name
"RTN","LRAPUTL",40,0)
 K X,Y,LR("CK"),DIR
"RTN","LRAPUTL",41,0)
 S LRDATA=-1 W !
"RTN","LRAPUTL",42,0)
 S DIR(0)="FO",DIR("A")="Select Accession Number/Pt name"
"RTN","LRAPUTL",43,0)
 S DIR("?",1)="Enter the year "_LRYR1_" "_LRAANM_" accession number to"
"RTN","LRAPUTL",44,0)
 S DIR("?",1)=DIR("?",1)_" be updated"
"RTN","LRAPUTL",45,0)
 S DIR("?")="or locate the accession by entering the patient name."
"RTN","LRAPUTL",46,0)
 D ^DIR S LRAN=Y K DIR
"RTN","LRAPUTL",47,0)
 I LRAN=""!(LRAN[U) D END S LRDATA=-1 Q
"RTN","LRAPUTL",48,0)
 I LRAN'?1N.N D  Q
"RTN","LRAPUTL",49,0)
 .D PNAME^LRAPDA
"RTN","LRAPUTL",50,0)
 .I LRAN<1 S LRDATA=-1 Q
"RTN","LRAPUTL",51,0)
 .S LRDATA=LRDFN,LRDATA(1)=$S('LRAU:LRI,1:"")
"RTN","LRAPUTL",52,0)
 .D OE1^LR7OB63D
"RTN","LRAPUTL",53,0)
 D OE1^LR7OB63D
"RTN","LRAPUTL",54,0)
 W "  for "_LRYR1
"RTN","LRAPUTL",55,0)
 I '$D(^LRO(68,LRAAN,1,LRYR2,1,LRAN,0)) D  Q
"RTN","LRAPUTL",56,0)
 .S MSG="Accession # "_LRAN_" for "_LRYR1_" not in "_LRAANM
"RTN","LRAPUTL",57,0)
 .D EN^DDIOL(MSG,"","!!") K MSG
"RTN","LRAPUTL",58,0)
 .S LRDATA=0
"RTN","LRAPUTL",59,0)
 S X=^LRO(68,LRAAN,1,LRYR2,1,LRAN,0),LRDFN=+X
"RTN","LRAPUTL",60,0)
 Q:'$D(^LR(LRDFN,0))  S X=^LR(LRDFN,0) D ^LRUP
"RTN","LRAPUTL",61,0)
 W @IOF
"RTN","LRAPUTL",62,0)
 W !?3,PNM,?35,SSN,?55,"DOB: ",$$FMTE^XLFDT(DOB,1)
"RTN","LRAPUTL",63,0)
 S LRI=+$P($G(^LRO(68,LRAAN,1,LRYR2,1,LRAN,3)),"^",5)
"RTN","LRAPUTL",64,0)
 I LRAREA'="AU",'$D(^LR(LRDFN,LRAREA,LRI,0)) D  Q
"RTN","LRAPUTL",65,0)
 .W $C(7)
"RTN","LRAPUTL",66,0)
 .S MSG(1)="Inverse date missing or incorrect in Accession Area file "
"RTN","LRAPUTL",67,0)
 .S MSG(1)=MSG(1)_"for"
"RTN","LRAPUTL",68,0)
 .S MSG(1,"F")="!"
"RTN","LRAPUTL",69,0)
 .S MSG(2)=LRAANM_"  Year: "_$E(LRYR2,2,3)_"  Accession: "_LRAN
"RTN","LRAPUTL",70,0)
 .S MSG(2,"F")="!"
"RTN","LRAPUTL",71,0)
 .D EN^DDIOL(.MSG) K MSG
"RTN","LRAPUTL",72,0)
 .S LRDATA=-1
"RTN","LRAPUTL",73,0)
 D DEMGRPH(LRAN,LRAD,LRAA)
"RTN","LRAPUTL",74,0)
 S LRDATA=LRDFN,LRDATA(1)=LRI
"RTN","LRAPUTL",75,0)
 Q
"RTN","LRAPUTL",76,0)
DEMGRPH(LRAN,LRAD,LRAA) ;Demographics
"RTN","LRAPUTL",77,0)
 N LRIENS,DA,LRIDT,LRQUIT,LRSPECID,LREDT,LRIDT,LRCDT
"RTN","LRAPUTL",78,0)
 S LRQUIT=0
"RTN","LRAPUTL",79,0)
 S LRIENS=LRAN_","_LRAD_","_LRAA_","
"RTN","LRAPUTL",80,0)
 S LRSPECID="Acc #: "_$$GET1^DIQ(68.02,LRIENS,15,"E")
"RTN","LRAPUTL",81,0)
 S LRSPECID=LRSPECID_$$GET1^DIQ(68.02,LRIENS,16)
"RTN","LRAPUTL",82,0)
 S LREDT=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",9,"I")
"RTN","LRAPUTL",83,0)
 S LRIDT=+$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",13.5,"I")
"RTN","LRAPUTL",84,0)
 I LREDT S LRCDT="Collection Date: "_$$FMTE^XLFDT(LREDT,1)
"RTN","LRAPUTL",85,0)
 W !?5,LRCDT
"RTN","LRAPUTL",86,0)
 W !?10,LRSPECID,!
"RTN","LRAPUTL",87,0)
 I $G(^LRO(68,LRAA,1,LRAD,1,LRAN,"PCE")) W !?15,"PCE ENC # "_^("PCE")
"RTN","LRAPUTL",88,0)
 I $L($G(LRSS)),$O(^LR(LRDFN,LRSS,LRIDT,.1,0)) D
"RTN","LRAPUTL",89,0)
 .N LRX
"RTN","LRAPUTL",90,0)
 .W !?5,"Tissue Specimen(s): ",!
"RTN","LRAPUTL",91,0)
 .S LRX=0 F  S LRX=$O(^LR(LRDFN,LRSS,LRIDT,.1,LRX)) Q:LRX<1!(LRQUIT)  D
"RTN","LRAPUTL",92,0)
 ..I $Y>(IOSL-10) D PG Q:$G(LRQUIT)  D
"RTN","LRAPUTL",93,0)
 ...W @IOF,!?3,PNM,?35,SSN,?55,"DOB: ",$$FMTE^XLFDT(DOB,1),!
"RTN","LRAPUTL",94,0)
 ..W ?15,$P($G(^LR(LRDFN,LRSS,LRIDT,.1,LRX,0)),U),!
"RTN","LRAPUTL",95,0)
 I $O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,0)) D
"RTN","LRAPUTL",96,0)
 .W ?5,"Test(s): "
"RTN","LRAPUTL",97,0)
 .S LRX=0
"RTN","LRAPUTL",98,0)
 .F  S LRX=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRX)) Q:LRX<1!($G(LRQUIT))  D
"RTN","LRAPUTL",99,0)
 ..I $Y>(IOSL-10) D PG Q:$G(LRQUIT)  W @IOF
"RTN","LRAPUTL",100,0)
 ..W ?15,$P($G(^LAB(60,+LRX,0)),U),!
"RTN","LRAPUTL",101,0)
 S:$G(LRQUIT) LRQUIT=0
"RTN","LRAPUTL",102,0)
 Q
"RTN","LRAPUTL",103,0)
GETDOCS(LRDOCS,LRDFN,LRSS,LRI,LRSF) ;Return PCP and provider
"RTN","LRAPUTL",104,0)
 N LRPF,DFN,LRIENS,LRFLD
"RTN","LRAPUTL",105,0)
 S:LRSS="AU" LRSF=63
"RTN","LRAPUTL",106,0)
 I '+$G(LRDFN)!($G(LRSS)="")!('+$G(LRSF)) S LRDOCS=0 Q
"RTN","LRAPUTL",107,0)
 I "AUSPCYEM"'[LRSS S LRDOCS=0 Q
"RTN","LRAPUTL",108,0)
 S LRPF=+$$GET1^DIQ(63,LRDFN_",",.02,"I")
"RTN","LRAPUTL",109,0)
 S DFN=$$GET1^DIQ(63,LRDFN_",",.03,"I")
"RTN","LRAPUTL",110,0)
 S LRDOCS(1)=0
"RTN","LRAPUTL",111,0)
 I LRPF=2 D
"RTN","LRAPUTL",112,0)
 .D INP^VADPT
"RTN","LRAPUTL",113,0)
 .S LRDOCS(1)=+VAIN(2)
"RTN","LRAPUTL",114,0)
 S LRIENS=LRDFN_","
"RTN","LRAPUTL",115,0)
 I LRSS'="AU" S LRIENS=LRI_","_LRIENS,LRFLD=.07
"RTN","LRAPUTL",116,0)
 S:LRSS="AU" LRFLD=13.5
"RTN","LRAPUTL",117,0)
 S LRDOCS(2)=$$GET1^DIQ(LRSF,LRIENS,LRFLD,"I")
"RTN","LRAPUTL",118,0)
 Q
"RTN","LRAPUTL",119,0)
RELEASE(LRRELEAS,LRDFN,LRSS,LRI) ;
"RTN","LRAPUTL",120,0)
 ;Determine if report has been released
"RTN","LRAPUTL",121,0)
 N LRFILE,LRFLDS,LRIENS,LRRELAR,LRCT
"RTN","LRAPUTL",122,0)
 I '+$G(LRDFN) S LRRELEAS=0 Q
"RTN","LRAPUTL",123,0)
 I $G(LRSS)=""!("AUSPEMCY"'[LRSS) S LRRELEAS=0 Q
"RTN","LRAPUTL",124,0)
 I LRSS'="AU",'+$G(LRI) S LRRELEAS=0 Q
"RTN","LRAPUTL",125,0)
 I LRSS="AU" D
"RTN","LRAPUTL",126,0)
 .S LRFILE=63,LRFLDS="14.7;14.8",LRIENS=LRDFN_","
"RTN","LRAPUTL",127,0)
 I LRSS'="AU" D
"RTN","LRAPUTL",128,0)
 .S LRFILE=$S(LRSS="SP":63.08,LRSS="CY":63.09,LRSS="EM":63.02,1:"")
"RTN","LRAPUTL",129,0)
 .S LRFLDS=".11;.13;.15"
"RTN","LRAPUTL",130,0)
 .S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPUTL",131,0)
 Q:LRFILE=""
"RTN","LRAPUTL",132,0)
 D GETS^DIQ(LRFILE,LRIENS,LRFLDS,"I","LRRELAR")
"RTN","LRAPUTL",133,0)
 F LRCT=1:1:$S(LRSS="AU":2,1:3) D
"RTN","LRAPUTL",134,0)
 .S LRRELEAS(LRCT)=+$G(LRRELAR(LRFILE,LRIENS,$P(LRFLDS,";",LRCT),"I"))
"RTN","LRAPUTL",135,0)
 Q
"RTN","LRAPUTL",136,0)
TIUCHK(LRPTR,LRDFN,LRSS,LRI) ;
"RTN","LRAPUTL",137,0)
 ;Check to see if report is in TIU
"RTN","LRAPUTL",138,0)
 N LRTREC,LRROOT,LRFILE,LRIENS,LRFLD,LRREL
"RTN","LRAPUTL",139,0)
 I LRSS=""!("AUSPEMCY"'[LRSS) S LRPTR=0 Q
"RTN","LRAPUTL",140,0)
 I LRSS="AU" D
"RTN","LRAPUTL",141,0)
 .S LRROOT="^LR(LRDFN,101,""A"")",LRIENS=LRDFN_","
"RTN","LRAPUTL",142,0)
 .S LRFILE=63.101
"RTN","LRAPUTL",143,0)
 I LRSS'="AU" D
"RTN","LRAPUTL",144,0)
 .S LRROOT="^LR(LRDFN,LRSS,LRI,.05,""A"")"
"RTN","LRAPUTL",145,0)
 .S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPUTL",146,0)
 .S LRFILE=$S(LRSS="SP":63.19,LRSS="CY":63.47,LRSS="EM":63.49,1:"")
"RTN","LRAPUTL",147,0)
 S LRTREC=$O(@(LRROOT),-1)
"RTN","LRAPUTL",148,0)
 I LRFILE=""!(LRTREC="") S LRPTR=0 Q
"RTN","LRAPUTL",149,0)
 S LRIENS=LRTREC_","_LRIENS
"RTN","LRAPUTL",150,0)
 S LRPTR=+$$GET1^DIQ(LRFILE,LRIENS,1,"I")
"RTN","LRAPUTL",151,0)
 S:LRPTR LRPTR("D")=+$$GET1^DIQ(LRFILE,LRIENS,.01,"I")
"RTN","LRAPUTL",152,0)
 I LRSS="AU" D
"RTN","LRAPUTL",153,0)
 .S LRFILE=63,LRIENS=LRDFN_",",LRFLD=14.7
"RTN","LRAPUTL",154,0)
 I LRSS'="AU" D
"RTN","LRAPUTL",155,0)
 .S LRFLD=$S(LRSS="CY":9,LRSS="SP":8,LRSS="EM":2,1:"")
"RTN","LRAPUTL",156,0)
 .Q:LRFLD=""
"RTN","LRAPUTL",157,0)
 .S LRFILE=+$$GET1^DID(63,LRFLD,"","SPECIFIER"),LRFLD=.11
"RTN","LRAPUTL",158,0)
 .Q:LRFILE=""
"RTN","LRAPUTL",159,0)
 .S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPUTL",160,0)
 S LRREL=+$$GET1^DIQ(LRFILE,LRIENS,LRFLD,"I")
"RTN","LRAPUTL",161,0)
 I 'LRREL K LRPTR S LRPTR=0 Q
"RTN","LRAPUTL",162,0)
 I LRREL'=LRPTR("D") K LRPTR S LRPTR=0
"RTN","LRAPUTL",163,0)
 Q
"RTN","LRAPUTL",164,0)
ESIGINF(LRESINF,LRDFN,LRSS,LRI) ;Return Esig Info
"RTN","LRAPUTL",165,0)
 N LRTIUDA,LRESINF1
"RTN","LRAPUTL",166,0)
 Q:'$D(LRDFN)!('$D(LRSS))
"RTN","LRAPUTL",167,0)
 Q:LRSS=""!("AUSPEMCY"'[LRSS)
"RTN","LRAPUTL",168,0)
 D TIUCHK(.LRTIUDA,LRDFN,LRSS,$G(LRI))
"RTN","LRAPUTL",169,0)
 Q:'+$G(LRTIUDA)
"RTN","LRAPUTL",170,0)
 D EXTRACT^TIULQ(LRTIUDA,"LRESINF1(""ESIG"")",,,,,,1)
"RTN","LRAPUTL",171,0)
 Q:'$D(LRESINF1("ESIG",LRTIUDA))
"RTN","LRAPUTL",172,0)
 S LRESINF(1)=$G(LRESINF1("ESIG",LRTIUDA,1501,"E"))
"RTN","LRAPUTL",173,0)
 S LRESINF(2)=$G(LRESINF1("ESIG",LRTIUDA,1503,"E"))
"RTN","LRAPUTL",174,0)
 Q
"RTN","LRAPUTL",175,0)
NEWLN(LRTEXT,TAB) ;
"RTN","LRAPUTL",176,0)
 S LCT=$G(LCT)+1,BTAB=0
"RTN","LRAPUTL",177,0)
 S TAB=+TAB
"RTN","LRAPUTL",178,0)
 D GLBWRT(LRTEXT,TAB)
"RTN","LRAPUTL",179,0)
 Q
"RTN","LRAPUTL",180,0)
GLBWRT(LRTEXT,TAB) ;Write to global
"RTN","LRAPUTL",181,0)
 D GLB(LCT,TAB,BTAB,LRTEXT,GROOT,.ATAB)
"RTN","LRAPUTL",182,0)
 S BTAB=ATAB
"RTN","LRAPUTL",183,0)
 Q
"RTN","LRAPUTL",184,0)
GLB(LINE,TAB,BTAB,TEXT,ROOT,ATAB) ;
"RTN","LRAPUTL",185,0)
 ; This subroutine is used to store report text to a global.
"RTN","LRAPUTL",186,0)
 ; Input variables:
"RTN","LRAPUTL",187,0)
 ; LINE = Current line number
"RTN","LRAPUTL",188,0)
 ; TAB  = Desired tab position (not required)
"RTN","LRAPUTL",189,0)
 ; BTAB = Current tab position BEFORE text is stored
"RTN","LRAPUTL",190,0)
 ; TEXT = Text string to be stored
"RTN","LRAPUTL",191,0)
 ; ROOT = Global root
"RTN","LRAPUTL",192,0)
 ;
"RTN","LRAPUTL",193,0)
 ; Output variables:
"RTN","LRAPUTL",194,0)
 ; ATAB = Current tab position after text storage
"RTN","LRAPUTL",195,0)
 ;
"RTN","LRAPUTL",196,0)
 N LRSPC,LRINC,FTEXT,LRLINE
"RTN","LRAPUTL",197,0)
 S LRSPC="" F LRINC=1:1:80 S LRSPC=LRSPC_" "
"RTN","LRAPUTL",198,0)
 S:BTAB="" BTAB=0
"RTN","LRAPUTL",199,0)
 S:+TAB=0 TAB=BTAB
"RTN","LRAPUTL",200,0)
 S FTEXT=TEXT
"RTN","LRAPUTL",201,0)
 I TAB,TAB>BTAB D
"RTN","LRAPUTL",202,0)
 .S FTEXT=$E(LRSPC,1,TAB-BTAB)_TEXT
"RTN","LRAPUTL",203,0)
 S:'$D(@(ROOT_"0)")) @(ROOT_"0)")="^^^^"_DT_"^"
"RTN","LRAPUTL",204,0)
 S LRLINE=LINE,LINE=LINE_",0"
"RTN","LRAPUTL",205,0)
 S:'$D(@(ROOT_LINE_")")) @(ROOT_LINE_")")=""
"RTN","LRAPUTL",206,0)
 S @(ROOT_LINE_")")=@(ROOT_LINE_")")_FTEXT
"RTN","LRAPUTL",207,0)
 S $P(@(ROOT_"0)"),"^",3,4)=LRLINE_"^"_LRLINE
"RTN","LRAPUTL",208,0)
 S ATAB=TAB+$L(TEXT)
"RTN","LRAPUTL",209,0)
 Q
"RTN","LRAPUTL",210,0)
PROVIDR ;Entry of provider taken from PRO^LRCAPES        
"RTN","LRAPUTL",211,0)
 S LREND=0
"RTN","LRAPUTL",212,0)
 D
"RTN","LRAPUTL",213,0)
 . N LRPRONM,DIR,DIRUT,DUOUT,X,Y
"RTN","LRAPUTL",214,0)
 . S LRPRONM=$$GET1^DIQ(200,+$G(LRPRO),.01,"I")
"RTN","LRAPUTL",215,0)
 . I $L(LRPRONM),$D(^VA(200,"AK.PROVIDER",LRPRONM,+$G(LRPRO)))#2,$$GET^XUA4A72(+$G(LRPRO),DT)>0 S DIR("B")=LRPRONM
"RTN","LRAPUTL",216,0)
 . S DIR("A")="Provider"
"RTN","LRAPUTL",217,0)
 . S LRPRO=0,DIR(0)="PO^200:ENMZ"
"RTN","LRAPUTL",218,0)
 . S DIR("S")="I $D(^VA(200,""AK.PROVIDER"",$P(^(0),U),+Y)),$$GET^XUA4A72(+Y,DT)>0"
"RTN","LRAPUTL",219,0)
 . D ^DIR
"RTN","LRAPUTL",220,0)
 . I Y>1 S LRPRO=+Y
"RTN","LRAPUTL",221,0)
 I '$G(LRPRO) D  D END^LRCAPES Q
"RTN","LRAPUTL",222,0)
 . W !?5,"No Active Provider Selected",!
"RTN","LRAPUTL",223,0)
 . S LRNOP=1
"RTN","LRAPUTL",224,0)
 . S LRQUIT=1
"RTN","LRAPUTL",225,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))#2 D  D END^LRCAPES
"RTN","LRAPUTL",226,0)
 . W !?5,"The accession is corrupt - missing zero node",!
"RTN","LRAPUTL",227,0)
 . S LRNOP="7^Corrupt Accession"
"RTN","LRAPUTL",228,0)
 . S LRQUIT=1
"RTN","LRAPUTL",229,0)
 Q
"RTN","LRAPUTL",230,0)
REFRRL ;Display informational message on referrals
"RTN","LRAPUTL",231,0)
 S LRMSG2=$P(^DIC(LRDPF,0),"^")
"RTN","LRAPUTL",232,0)
 S LRMSG="*** NOTE: This "_LRMSG2_" report will not be stored in TIU,"
"RTN","LRAPUTL",233,0)
 S LRMSG(1)=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPUTL",234,0)
 S LRMSG(1,"F")="!!"
"RTN","LRAPUTL",235,0)
 S LRMSG="  and therefore, does not have an electronic signature."
"RTN","LRAPUTL",236,0)
 S LRMSG(2)=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPUTL",237,0)
 S LRMSG="A hardcopy signature will be required for this report."
"RTN","LRAPUTL",238,0)
 S LRMSG(3)=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPUTL",239,0)
 D EN^DDIOL(.LRMSG)
"RTN","LRAPUTL",240,0)
 K LRMSG
"RTN","LRAPUTL",241,0)
 Q
"RTN","LRAPUTL",242,0)
PG ;Page break
"RTN","LRAPUTL",243,0)
 N DIR,DIRUT,DUOUT,DTOUT
"RTN","LRAPUTL",244,0)
 S DIR(0)="E" D ^DIR
"RTN","LRAPUTL",245,0)
 I $G(DIRUT) S LRQUIT=1
"RTN","LRAPUTL",246,0)
 Q
"RTN","LRAPUTL",247,0)
END ;
"RTN","LRAPUTL",248,0)
 K LRYRIN,LRAREA,LRAANM
"RTN","LRAPUTL",249,0)
 Q
"RTN","LRCAPES")
0^1^B82507767^B75227462
"RTN","LRCAPES",1,0)
LRCAPES ;DALOI/FHS/KLL -MANUAL PCE CPT WORKLOAD CAPTURE ;07/30/04
"RTN","LRCAPES",2,0)
 ;;5.2;LAB SERVICE;**274,259,349,308**;Sep 27, 1994
"RTN","LRCAPES",3,0)
 ;Reference to $$GET^XUA4A72 - Supported by DBIA #1625
"RTN","LRCAPES",4,0)
EN ;
"RTN","LRCAPES",5,0)
 D EN^LRCAPES1
"RTN","LRCAPES",6,0)
 Q
"RTN","LRCAPES",7,0)
EX1 ;Parse the read entry
"RTN","LRCAPES",8,0)
 N LRXY,LRACTV,LRXY1,LRXY2,LRD2,LRNR,LRWL2,LRINA2,LRREL2,LRQ
"RTN","LRCAPES",9,0)
 Q:'$L($G(LRX))
"RTN","LRCAPES",10,0)
 ;Edit on 5-digit code entry
"RTN","LRCAPES",11,0)
 I LRX?5N,'$D(^TMP("LR",$J,"AK",LRX))#2 D  Q
"RTN","LRCAPES",12,0)
 .S LRXY=$$CPT^ICPTCOD(LRX,DT)
"RTN","LRCAPES",13,0)
 .D CHKCPT^LRCAPES1
"RTN","LRCAPES",14,0)
 .;Don't pass to PCE if CPT is missing or inactive in #81 or #64
"RTN","LRCAPES",15,0)
 .Q:'$P(LRXY,U,7)!(LRNR)
"RTN","LRCAPES",16,0)
 .;If CPT is inactive in #64 and another active CPT exists, replace
"RTN","LRCAPES",17,0)
 .;      the inactive with the active CPT
"RTN","LRCAPES",18,0)
 .I LRACTV D  Q
"RTN","LRCAPES",19,0)
 ..S LRXY=$$CPT^ICPTCOD(LRXY2,DT)
"RTN","LRCAPES",20,0)
 ..S LRCNT=+$G(LRCNT)+1
"RTN","LRCAPES",21,0)
 ..S ^TMP("LR",$J,"LRLST",LRCNT)=$P(LRXY,U)_U_LRWL2_U_$P(LRXY,U,3)_U
"RTN","LRCAPES",22,0)
 ..S LRRF64=$S($G(LRRF64):LRRF64_LRXY1_"\"_LRXY2_",",1:LRXY1_"\"_LRXY2_",")
"RTN","LRCAPES",23,0)
 ..;If CPT passes edits, continue
"RTN","LRCAPES",24,0)
 .S LRCNT=+$G(LRCNT)+1
"RTN","LRCAPES",25,0)
 .S ^TMP("LR",$J,"LRLST",LRCNT)=$P(LRXY,U)_"^^"_$P(LRXY,U,3)_U
"RTN","LRCAPES",26,0)
 ;Edit on ES Display Order # entry
"RTN","LRCAPES",27,0)
 S LRQ="^TMP(""LR"","_$J_",""AK"","_LRX_")"
"RTN","LRCAPES",28,0)
 S LRQ=$Q(@LRQ)
"RTN","LRCAPES",29,0)
 S LRXY=$$CPT^ICPTCOD($QS(LRQ,6),DT)
"RTN","LRCAPES",30,0)
 D CHKCPT^LRCAPES1
"RTN","LRCAPES",31,0)
 Q:'$P(LRXY,U,7)!(LRNR)
"RTN","LRCAPES",32,0)
 ;If CPT is inactive in #64 and another active CPT exists, replace
"RTN","LRCAPES",33,0)
 ;      the inactive with the active CPT
"RTN","LRCAPES",34,0)
 I LRACTV D  Q
"RTN","LRCAPES",35,0)
 .S LRXY=$$CPT^ICPTCOD(LRXY2,DT)
"RTN","LRCAPES",36,0)
 .S LRCNT=+$G(LRCNT)+1
"RTN","LRCAPES",37,0)
 .S ^TMP("LR",$J,"LRLST",LRCNT)=$P(LRXY,U)_U_LRWL2_U_$P(LRXY,U,3)_U
"RTN","LRCAPES",38,0)
 .S LRRF64=$S($G(LRRF64):LRRF64_LRXY1_"\"_LRXY2_",",1:LRXY1_"\"_LRXY2_",")
"RTN","LRCAPES",39,0)
 .;I CPT passes edits, continue
"RTN","LRCAPES",40,0)
 S LRCNT=+$G(LRCNT)+1
"RTN","LRCAPES",41,0)
 S ^TMP("LR",$J,"LRLST",LRCNT)=$QS(LRQ,6)_U_@LRQ
"RTN","LRCAPES",42,0)
 Q
"RTN","LRCAPES",43,0)
END1 ;
"RTN","LRCAPES",44,0)
 D END S LREND=1
"RTN","LRCAPES",45,0)
 Q
"RTN","LRCAPES",46,0)
END ;
"RTN","LRCAPES",47,0)
 I $G(LRAA),$G(LRAD),$G(LRAN) L -^LRO(68,LRAA,1,LRAD,1,LRAN)
"RTN","LRCAPES",48,0)
 K:'$G(LRESCPT) ^TMP("LR",$J,"AK")
"RTN","LRCAPES",49,0)
 I $G(LRDEBUG) W !,"END ",! Q
"RTN","LRCAPES",50,0)
 Q
"RTN","LRCAPES",51,0)
WLN ;Interactive entry point
"RTN","LRCAPES",52,0)
 D KVA^VADPT
"RTN","LRCAPES",53,0)
 K DIC,DIR
"RTN","LRCAPES",54,0)
 K LREND,LRUID,DIC,DIR,LRVBY
"RTN","LRCAPES",55,0)
 K ^TMP("LR",$J,"LRLST")
"RTN","LRCAPES",56,0)
 K LRAA,LRACC,LRAD,LRAN,LRDFN,LRDPF,LRIDT
"RTN","LRCAPES",57,0)
 K LRRB,LRSS,LRTIME,LRTREA,LRUID,LRWRD,PNM,SEX,SSN,AGE
"RTN","LRCAPES",58,0)
 S (LRAA,LRACC,LRAD,LRNOP,LRAN,LREND)=0,LRVBY=1,LRUID=""
"RTN","LRCAPES",59,0)
 S:'$G(LRPRO) LRPRO=DUZ
"RTN","LRCAPES",60,0)
 I '$G(LRESCPT) S LRVBY=$$SELBY^LRWU4("Select Accession By")
"RTN","LRCAPES",61,0)
 D:LRVBY=1 ^LRVERA D:LRVBY=2 UID^LRVERA
"RTN","LRCAPES",62,0)
 I 'LRVBY!(LRAA<1) D END S LREND=1 Q
"RTN","LRCAPES",63,0)
 S LRDFN=+$$GET1^DIQ(68.02,+$G(LRAN)_","_+$G(LRAD)_","_+$G(LRAA)_",",.01)
"RTN","LRCAPES",64,0)
 I 'LRDFN D END S LRNOP=1 D  Q
"RTN","LRCAPES",65,0)
 . W !?5,"This accession is corrupt",!
"RTN","LRCAPES",66,0)
LCK ;
"RTN","LRCAPES",67,0)
 L +^LRO(68,LRAA,1,LRAD,1,LRAN):10 I '$T D  Q
"RTN","LRCAPES",68,0)
 . W !?5,"Someone else is editing this accession",!
"RTN","LRCAPES",69,0)
 . S LRNOP=1
"RTN","LRCAPES",70,0)
 D PT^LRX
"RTN","LRCAPES",71,0)
 S LRUID=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",16)
"RTN","LRCAPES",72,0)
 S LRLLOCX=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",6)
"RTN","LRCAPES",73,0)
 S LRSPECID="Acc #: "_$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",15,"E")
"RTN","LRCAPES",74,0)
 S:$L($G(LRUID)) LRSPECID=LRSPECID_"  UID: "_LRUID
"RTN","LRCAPES",75,0)
 S LREDT=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",9,"I")
"RTN","LRCAPES",76,0)
 I LREDT'?7N.E D  Q
"RTN","LRCAPES",77,0)
 . W !?5,"This accession does not have a Collection Date/Time",!
"RTN","LRCAPES",78,0)
 . W !?10,"CAN NOT PROCEED",!
"RTN","LRCAPES",79,0)
 . S LRNOP="6^Not Accessioned"
"RTN","LRCAPES",80,0)
 I '$G(LRIDT) S LRIDT=+$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",13.5,"I")
"RTN","LRCAPES",81,0)
 S LRCDT="Collection Date: "_$$FMTE^XLFDT(LREDT,1)
"RTN","LRCAPES",82,0)
 I '$L($G(LRSS)) S LRSS=$$GET1^DIQ(68,LRAA_",",.02,"I")
"RTN","LRCAPES",83,0)
 S LRDSSLOC=+$$GET1^DIQ(68,LRAA_",",.8,"I")
"RTN","LRCAPES",84,0)
 S LRDSSLOC=$S($G(LRDSSLOC):LRDSSLOC,1:LRDLOC)
"RTN","LRCAPES",85,0)
 D DEM^LRCAPES1
"RTN","LRCAPES",86,0)
PRO ;Get provider,patient/location information
"RTN","LRCAPES",87,0)
 S LREND=0
"RTN","LRCAPES",88,0)
 D
"RTN","LRCAPES",89,0)
 . N LRPRONM,DIR,DIRUT,DUOUT,X,Y
"RTN","LRCAPES",90,0)
 . S LRPRONM=$$GET1^DIQ(200,+$G(LRPRO),.01,"I")
"RTN","LRCAPES",91,0)
 . I $L(LRPRONM),$D(^VA(200,"AK.PROVIDER",LRPRONM,+$G(LRPRO)))#2,$$GET^XUA4A72(+$G(LRPRO),DT)>0 S DIR("B")=LRPRONM
"RTN","LRCAPES",92,0)
 . ;S DIR("A")="Releasing Pathologist"
"RTN","LRCAPES",93,0)
 . S DIR("A")="Provider"
"RTN","LRCAPES",94,0)
 . S LRPRO=0,DIR(0)="PO^200:ENMZ"
"RTN","LRCAPES",95,0)
 . S DIR("S")="I $D(^VA(200,""AK.PROVIDER"",$P(^(0),U),+Y)),$$GET^XUA4A72(+Y,DT)>0"
"RTN","LRCAPES",96,0)
 . D ^DIR
"RTN","LRCAPES",97,0)
 . I Y>1 S LRPRO=+Y
"RTN","LRCAPES",98,0)
 I '$G(LRPRO) D  D END1 Q
"RTN","LRCAPES",99,0)
 . W !?5,"No Active Provider Selected",!
"RTN","LRCAPES",100,0)
 . S LRNOP=1
"RTN","LRCAPES",101,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))#2 D  D END1 G WLN
"RTN","LRCAPES",102,0)
 . W !?5,"The accession is corrupt - missing zero node",!
"RTN","LRCAPES",103,0)
 . S LRNOP="7^Corrupt Accession"
"RTN","LRCAPES",104,0)
LOC ;Reporting Location
"RTN","LRCAPES",105,0)
 S LRNODE0=^LRO(68,LRAA,1,LRAD,1,LRAN,0)
"RTN","LRCAPES",106,0)
 S LRNOP=0
"RTN","LRCAPES",107,0)
 S (LRLLOCX,LRLLOC)=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",6)
"RTN","LRCAPES",108,0)
 I $L(LRLLOC) S LRLLOC=+$$FIND1^DIC(44,"","OM",LRLLOC)
"RTN","LRCAPES",109,0)
ASKLOC ;Check to see if outpatient location
"RTN","LRCAPES",110,0)
 I '$D(^SC(+$G(LRLLOC),0))#2 D
"RTN","LRCAPES",111,0)
 . N DIR,X,Y
"RTN","LRCAPES",112,0)
 . S LRLLOC=""
"RTN","LRCAPES",113,0)
 . S DIR(0)="PO^44:AEZNMO",DIR("A")=" Ordering Location "
"RTN","LRCAPES",114,0)
 . D ^DIR
"RTN","LRCAPES",115,0)
 . I +Y<1 Q
"RTN","LRCAPES",116,0)
 . S LRLLOC=+Y
"RTN","LRCAPES",117,0)
 I '$G(LRLLOC) D END1 Q
"RTN","LRCAPES",118,0)
 S LRDSSID=+$$GET1^DIQ(44,+LRLLOC,8,"I") ;I 'LRDSSID S LRNOP="2^No Stop Code Number" Q
"RTN","LRCAPES",119,0)
 S LRNINS=$$GET1^DIQ(44,+LRLLOC,3,"I")
"RTN","LRCAPES",120,0)
 S LRNINS=$S(LRNINS:LRNINS,1:DUZ(2))
"RTN","LRCAPES",121,0)
 Q
"RTN","LRCAPES",122,0)
ES() ;Entry point for front end application.
"RTN","LRCAPES",123,0)
 N DFN,LRESCPT,LRDFN,LRLLOC,LRLLOCX,LRNINS,LRTST,LRENCDT,LRDUZ
"RTN","LRCAPES",124,0)
 K LRES,LRESCPT
"RTN","LRCAPES",125,0)
 S LRES=1
"RTN","LRCAPES",126,0)
ASK ; Option entry point - Check and setup PCE reporting variables
"RTN","LRCAPES",127,0)
 D EN^LRCAPES1
"RTN","LRCAPES",128,0)
 N X,Y,T1
"RTN","LRCAPES",129,0)
 S LREND=0
"RTN","LRCAPES",130,0)
 D ^LRPARAM Q:$G(LREND)
"RTN","LRCAPES",131,0)
 K ^TMP("LRPXAPI",$J),^TMP("LR",$J,"LRLST")
"RTN","LRCAPES",132,0)
 S ^TMP("LR",$J,"LRLST")=$$FMADD^XLFDT(DT,2)_U_DT_U_"LAB ES CPT"
"RTN","LRCAPES",133,0)
 S:'$G(LRPKG) LRPKG=$O(^DIC(9.4,"B","LR",0))
"RTN","LRCAPES",134,0)
 S:'$G(LRPKG) LRPKG=$O(^DIC(9.4,"B","LAB SERVICE",0))
"RTN","LRCAPES",135,0)
PKG ;Check to see if Lab Package is installed
"RTN","LRCAPES",136,0)
 I '$G(LRPKG) D  D WKL Q
"RTN","LRCAPES",137,0)
 . W !?5,"LAB SERVICE PACKAGE is not loaded",!
"RTN","LRCAPES",138,0)
PCE ;Check to see if PCE is turned on
"RTN","LRCAPES",139,0)
 S X="PXAI" X ^%ZOSF("TEST") I '$T D:'$G(LRES)  D WKL Q
"RTN","LRCAPES",140,0)
 . W !?5,"PCE Is not installed",!
"RTN","LRCAPES",141,0)
 S LRPCEON=$$PKGON^VSIT("PX")
"RTN","LRCAPES",142,0)
 I '$G(LRES),'LRPCEON D  D WKL Q
"RTN","LRCAPES",143,0)
 . W !?5,"PCE is not turned on",!
"RTN","LRCAPES",144,0)
 S LRDLOC=+$$GET1^DIQ(69.9,"1,",.8,"I")
"RTN","LRCAPES",145,0)
OOS ;Check to see if the LRDLOC is an OOS location
"RTN","LRCAPES",146,0)
 I $G(LRES),$P($G(^SC(LRDLOC,0)),U)'["LAB DIV " D  D WKL Q
"RTN","LRCAPES",147,0)
 . W !?5,"DEFAULT LAB OOS LOCATION is not defined correctly",!
"RTN","LRCAPES",148,0)
 S LRESCPT=1
"RTN","LRCAPES",149,0)
 D:'$G(^TMP("LR",$J,"AK",0,1))'=DUZ_U_DT EN
"RTN","LRCAPES",150,0)
 I $G(LRES) Q $G(LRESCPT)
"RTN","LRCAPES",151,0)
LOOP ;
"RTN","LRCAPES",152,0)
 Q:$G(LREND)
"RTN","LRCAPES",153,0)
 F  D WLN Q:$G(LREND)  I '$G(LRNOP) D CPTEN Q:$G(LREND)
"RTN","LRCAPES",154,0)
 D CLEAN Q
"RTN","LRCAPES",155,0)
CPTEN ;Entry point from CPT API call
"RTN","LRCAPES",156,0)
WKL S (LRNOP,LREND)=0 D READ^LRCAPES1
"RTN","LRCAPES",157,0)
 D DIS^LRCAPES1
"RTN","LRCAPES",158,0)
 I '$O(^TMP("LR",$J,"LRLST",0)) D END Q
"RTN","LRCAPES",159,0)
LOAD ;Setup ^TMP("LRPXAPI" to load CPT workload
"RTN","LRCAPES",160,0)
 K LRXCPT,LRXTST,^TMP("LRPXAPI",$J)
"RTN","LRCAPES",161,0)
 S LRDUZ=LRPRO
"RTN","LRCAPES",162,0)
 I '$G(LRESCPT) S LRNOP="3^PCE Workload Capture Not Setup"
"RTN","LRCAPES",163,0)
 I $G(LRNOP) D  D SENDWKL Q
"RTN","LRCAPES",164,0)
 . I '$D(LRQUIET) W !,$$CJ^XLFSTR("PCE Wkld Abort "_$P(LRNOP,U,2),IOM)
"RTN","LRCAPES",165,0)
 I $G(LRESCPT),'$G(LRNOP) D
"RTN","LRCAPES",166,0)
 . N AFTER812,D,D0,DDER,DI,DIC,DIG,DIH,DISL,DIV
"RTN","LRCAPES",167,0)
 . N I,LRACC,LRCNT,LRI,LRPCEN,PXALOOK,PXASUB,PXJ,PXJJ,LRCCT
"RTN","LRCAPES",168,0)
 . N SDT1,SPEL,SUBL,TYPEI,X,XPARSYS
"RTN","LRCAPES",169,0)
 . S LRTST=0
"RTN","LRCAPES",170,0)
 . F  S LRTST=$O(^TMP("LR",$J,"LRLST",LRTST)) Q:LRTST<1  D
"RTN","LRCAPES",171,0)
 . . S (LRNLTN,CPT)=+$G(^TMP("LR",$J,"LRLST",LRTST)),LRTSTP=$P(^(LRTST),U,2,99)
"RTN","LRCAPES",172,0)
 . . D SET^LRCAPPH1
"RTN","LRCAPES",173,0)
 . D ADDPREV
"RTN","LRCAPES",174,0)
SENDWKL ; Store LMIP workload
"RTN","LRCAPES",175,0)
 D SEND^LRCAPES1
"RTN","LRCAPES",176,0)
 L -^LRO(68,LRAA,1,LRAD,1,LRAN)
"RTN","LRCAPES",177,0)
 S LRNOP=0
"RTN","LRCAPES",178,0)
 Q
"RTN","LRCAPES",179,0)
ADDPREV ;Add CPT quantities from PCE to current totals
"RTN","LRCAPES",180,0)
 N LRSTR2,LRIEN2,LRPX,LRCPT,LRXX,LRCPT2,LRCPT1,LRX1,LRQ1,LRQ2,LRQT,LRCT
"RTN","LRCAPES",181,0)
 S LRSTR2=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,"PCE"))
"RTN","LRCAPES",182,0)
 Q:'LRSTR2
"RTN","LRCAPES",183,0)
 K LRVIS S LRVIS=""
"RTN","LRCAPES",184,0)
 S LRCT=$L(LRSTR2,";")-1,LRVIS=$P(LRSTR2,";",LRCT)
"RTN","LRCAPES",185,0)
 F LRPX=1:1 S LRIEN2=$P(LRSTR2,";",LRPX) Q:LRIEN2=""  D
"RTN","LRCAPES",186,0)
 .D GETCPT^PXAPIOE(LRIEN2,"LRCPT","ERR")
"RTN","LRCAPES",187,0)
 S LRXX=""
"RTN","LRCAPES",188,0)
 F  S LRXX=$O(LRCPT(LRXX)) Q:LRXX=""  D
"RTN","LRCAPES",189,0)
 .Q:$P(LRCPT(LRXX),"^",3)'=LRVIS
"RTN","LRCAPES",190,0)
 .S LRCPT2=""
"RTN","LRCAPES",191,0)
 .S LRCPT2=+$G(LRCPT(LRXX))
"RTN","LRCAPES",192,0)
 .D:LRCPT2
"RTN","LRCAPES",193,0)
 ..S (LRX1,LRQT)=0
"RTN","LRCAPES",194,0)
 ..F  S LRX1=$O(^TMP("LRPXAPI",$J,"PROCEDURE",LRX1)) Q:LRX1=""!(LRQT)  D
"RTN","LRCAPES",195,0)
 ...S LRCPT1=+$G(^TMP("LRPXAPI",$J,"PROCEDURE",LRX1,"PROCEDURE"))
"RTN","LRCAPES",196,0)
 ...I LRCPT1=LRCPT2 D
"RTN","LRCAPES",197,0)
 ....S LRQ1=$P(LRCPT(LRXX),"^",16)
"RTN","LRCAPES",198,0)
 ....S LRQ2=+$G(^TMP("LRPXAPI",$J,"PROCEDURE",LRX1,"QTY"))
"RTN","LRCAPES",199,0)
 ....S ^TMP("LRPXAPI",$J,"PROCEDURE",LRX1,"QTY")=LRQ1+LRQ2
"RTN","LRCAPES",200,0)
 ....S LRQT=1
"RTN","LRCAPES",201,0)
 Q
"RTN","LRCAPES",202,0)
CLEAN ;Final Cleanup
"RTN","LRCAPES",203,0)
 K AFTER812,AGE,CPT,D,D0,DOB,DDER,DFN,DI,DIC,DIG,DIH,DIR,DIRUT
"RTN","LRCAPES",204,0)
 K DISL,DIRUT,DIU,DUOUT,DIV,DQ
"RTN","LRCAPES",205,0)
 K I,J,LRACC,LRCNT,LRI,POP,PXALOOK,PXASUB,PXJ,PXJJ
"RTN","LRCAPES",206,0)
 K SDT1,SPEL,SUBL,T1,TYPEI,X,XPARSYS
"RTN","LRCAPES",207,0)
 K ANS,CLN,CNT,FPRI,LRAA,LRAD,LRAN,LRANSX,LRANSY,LRCDT,LRCNT
"RTN","LRCAPES",208,0)
 K LRDFN,LRDPF,LRDLOC,LRDSSID,LRDSSLOC,LRDUZ,LREDT,LREND,LRES,LRESCPT
"RTN","LRCAPES",209,0)
 K LRIDT,LRIDIV,LRLLOC,LRLLOCX,LRLST,LRNINS,LRNLT,LRNLTN,LRNODE0,LRNOP,LROK
"RTN","LRCAPES",210,0)
 K LRPCEN,LRPCENON,LRPCEVSO,LRPKG,LRPRAC,LRPRO,LRRB,LRQ,LRSS,LRTREA,LRTST,LRURG
"RTN","LRCAPES",211,0)
 K LRSPECID,LRTSTP,LRUID,LRVBY
"RTN","LRCAPES",212,0)
 K LRVSITN,LRWRD,LRX,LRXCPT,LRXTST
"RTN","LRCAPES",213,0)
 K NODE,NODE0,PNM,SEX,SDFLAG,SSN,VA,X1,X2,X3
"RTN","LRCAPES",214,0)
 K ^TMP("LRMOD",$J)
"RTN","LRCAPES",215,0)
 K ^TMP("LR",$J,"AK"),^TMP("LR",$J,"LRLST")
"RTN","LRCAPES",216,0)
 K ^TMP("LRPXAPI",$J)
"RTN","LRCAPES",217,0)
 D KVAR^VADPT
"RTN","LRCAPES",218,0)
 Q
"RTN","LRCAPES",219,0)
CPT(LRAA,LRAD,LRAN,LRPRO) ;AP Release entry point
"RTN","LRCAPES",220,0)
 ;LRAA=accession area, LRAD=accession date, LRAN=accession number
"RTN","LRCAPES",221,0)
 ;LRPRO=provider
"RTN","LRCAPES",222,0)
 N X,Y,I,LRI,LREDT,LRCDT,LRIDT,LRLLOCX,LRSPECID,DIC,LRNOP,LREND,LRES
"RTN","LRCAPES",223,0)
 S (LRLLOCX,LRLLOC)=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",6)
"RTN","LRCAPES",224,0)
 S DIC=44,DIC(0)="ONM",X=LRLLOC D ^DIC
"RTN","LRCAPES",225,0)
 I Y>1 S LRLLOC=+Y
"RTN","LRCAPES",226,0)
 I Y<1 D  Q:$G(LREND)
"RTN","LRCAPES",227,0)
 . S DIC(0)="AEZNM" D ^DIC
"RTN","LRCAPES",228,0)
 . I Y<1 S LRNOP="4^Not an outpatient location",LREND=1 Q
"RTN","LRCAPES",229,0)
 . S LRLLOC=+Y
"RTN","LRCAPES",230,0)
 ;KLL - set LRDSSLOC to LRDLOC, instead of LRLLOC to resolve location
"RTN","LRCAPES",231,0)
 ;      problem occurring in PCE
"RTN","LRCAPES",232,0)
 ;TAC - use accession area OOS location if one exists
"RTN","LRCAPES",233,0)
 S LRDSSLOC=+$$GET1^DIQ(68,LRAA_",",.8,"I")
"RTN","LRCAPES",234,0)
 S LRDSSLOC=$S($G(LRDSSLOC):LRDSSLOC,1:+$G(LRDLOC))
"RTN","LRCAPES",235,0)
 S LRDSSID=+$$GET1^DIQ(44,+LRLLOC,8,"I")
"RTN","LRCAPES",236,0)
 S LRNINS=$$GET1^DIQ(44,+LRLLOC,3,"I")
"RTN","LRCAPES",237,0)
 S LRNINS=$S(LRNINS:LRNINS,1:DUZ(2))
"RTN","LRCAPES",238,0)
 I '$G(LRIDT) S LRIDT=+$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",13.5,"I")
"RTN","LRCAPES",239,0)
 S LRUID=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",16)
"RTN","LRCAPES",240,0)
 S LRLLOCX=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",6)
"RTN","LRCAPES",241,0)
 S LRSPECID="Acc #: "_$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",15,"E")
"RTN","LRCAPES",242,0)
 S:$L($G(LRUID)) LRSPECID=LRSPECID_"  UID: "_LRUID
"RTN","LRCAPES",243,0)
 S LREDT=$$GET1^DIQ(68.02,LRAN_","_LRAD_","_LRAA_",",9,"I")
"RTN","LRCAPES",244,0)
 I 'LREDT S LREDT=$$NOW^XLFDT
"RTN","LRCAPES",245,0)
 S LRCDT="Collection Date: "_$$FMTE^XLFDT(LREDT,1)
"RTN","LRCAPES",246,0)
 I '$G(LRESCPT) D  Q
"RTN","LRCAPES",247,0)
 . D EN^DDIOL("CPT workload is not activated","","!?20")
"RTN","LRCAPES",248,0)
 I $S('$G(LRAA):1,'$G(LRAD):1,'$G(LRAN):1,'$G(LRPRO):1,1:0) Q
"RTN","LRCAPES",249,0)
 I +$G(^LRO(68,LRAA,1,LRAD,1,LRAN,0))'=LRDFN Q
"RTN","LRCAPES",250,0)
 D CPTEN
"RTN","LRCAPES",251,0)
 Q
"RTN","LRCAPES1")
0^2^B68838767^B25817305
"RTN","LRCAPES1",1,0)
LRCAPES1 ;DALOI/FHS/KLL-CONT MANUAL PCE CPT WORKLOAD CAPTURE ;07/30/04
"RTN","LRCAPES1",2,0)
 ;;5.2;LAB SERVICE;**274,308**;Sep 27, 1994
"RTN","LRCAPES1",3,0)
 ;Continuation of LRCAPES
"RTN","LRCAPES1",4,0)
EN ;Setup the order of defined NLT codes
"RTN","LRCAPES1",5,0)
 ; ^ICPTCOD supported by DBIA 1995-A
"RTN","LRCAPES1",6,0)
 Q:$G(^TMP("LR",$J,"AK",0,1))=DUZ_U_DT
"RTN","LRCAPES1",7,0)
 N LRI,LRY,LRX,LRX2,LRX3,LRDES,LRCNT
"RTN","LRCAPES1",8,0)
 K ^TMP("LR",$J,"AK")
"RTN","LRCAPES1",9,0)
 S LRCNT=0
"RTN","LRCAPES1",10,0)
 S ^TMP("LR",$J,"AK",0)=$$FMADD^XLFDT(DT,2)_U_DT_U_"ES CPT code list"
"RTN","LRCAPES1",11,0)
 S ^TMP("LR",$J,"AK",0,1)=DUZ_U_DT
"RTN","LRCAPES1",12,0)
 S LRY="^LAM(""AK"")" F  S LRY=$Q(@LRY) Q:$QS(LRY,1)'="AK"  D
"RTN","LRCAPES1",13,0)
 . N LRDES
"RTN","LRCAPES1",14,0)
 . S LRX2=$QS(LRY,2),LRX3=$QS(LRY,3)
"RTN","LRCAPES1",15,0)
 . Q:'$G(LRX2)!('$G(LRX3))
"RTN","LRCAPES1",16,0)
 . S LRI=0 F  S LRI=$O(^LAM(LRX3,4,"AC","CPT",LRI)) Q:LRI<1  D
"RTN","LRCAPES1",17,0)
 . . S LRX=+$G(^LAM(LRX3,4,LRI,0)),LRX=$$CPT^ICPTCOD(LRX,DT)
"RTN","LRCAPES1",18,0)
 . . Q:'$P(LRX,U,7)
"RTN","LRCAPES1",19,0)
 . . K LRDES S LRDES=$$CPTD^ICPTCOD(+LRX,"LRDES")
"RTN","LRCAPES1",20,0)
 . . S LRCNT=LRCNT+1
"RTN","LRCAPES1",21,0)
 . . I $L(LRDES(1)) S ^TMP("LR",$J,"AK",LRX2,LRI,+LRX)=LRX3_U_$E(LRDES(1),1,55)_U_$$GET1^DIQ(64,LRX3_",",.01,"E")_U_$$GET1^DIQ(64,LRX3_",",1,"E") Q
"RTN","LRCAPES1",22,0)
 . . S ^TMP("LR",$J,"AK",LRX2,LRI,+LRX)=LRX3_U_$P(LRX,U,3)_U_$$GET1^DIQ(64,LRX3_",",.01,"E")_U_$$GET1^DIQ(64,LRX3_",",1,"E")
"RTN","LRCAPES1",23,0)
 Q
"RTN","LRCAPES1",24,0)
SET(DFN,LRPRO,LREDT,LRLOC,LRINS,LRCPT,LRAA,LRAD,LRAN) ; Call to check variable
"RTN","LRCAPES1",25,0)
 S (LREND,LROK)=0,LRAA=+$G(LRAA),LRAD=+$G(LRAD),LRAN=+$G(LRAN)
"RTN","LRCAPES1",26,0)
 I '$D(^DPT(DFN,0))#2 S LROK="1^Error Patient" Q LROK
"RTN","LRCAPES1",27,0)
 I $$GET^XUA4A72(LRPRO,DT)<1 S LROK="2^Inactive Provider" Q LROK
"RTN","LRCAPES1",28,0)
 I LREDT'?7N.E S LROK="3^Date Format" Q LROK
"RTN","LRCAPES1",29,0)
 I '$D(^SC(LRLOC,0))#2 S LROK="4^Location Error" Q LROK
"RTN","LRCAPES1",30,0)
 I "CMZ"'[$P($G(^SC(LRLOC,0)),U,3) S LROK="4.2^Not Inpatient Location" Q LROK
"RTN","LRCAPES1",31,0)
 I '$G(LRDSSID) S LROK="4.2^Not Inpatient Location" Q LROK
"RTN","LRCAPES1",32,0)
 I '$D(^DIC(4,LRINS,0))#2 S LROK="5^Institution Error" Q LROK
"RTN","LRCAPES1",33,0)
 I '$O(LRCPT(0)) S LROK="6^No CPT Codes Passed" Q LROK
"RTN","LRCAPES1",34,0)
 D EN^LRCAPES,READ^LRCAPES1
"RTN","LRCAPES1",35,0)
 D DIS I '$O(^TMP("LR",$J,"LRLST",0)) S LROK="-1" Q LROK
"RTN","LRCAPES1",36,0)
 D LOAD^LRCAPES,CLEAN^LRCAPES
"RTN","LRCAPES1",37,0)
 Q LROK
"RTN","LRCAPES1",38,0)
 ;
"RTN","LRCAPES1",39,0)
SEND ;Send data to PCE via DATA2PCE^PXAPI API
"RTN","LRCAPES1",40,0)
 I $$GET1^DIQ(63,+$G(LRDFN),.02,"I")=2,$G(LRDSSID),$O(^TMP("LRPXAPI",$J,"PROCEDURE",0)) D
"RTN","LRCAPES1",41,0)
 . I '$D(LRQUIET) W !,$$CJ^XLFSTR("Sending PCE Workload",IOM)
"RTN","LRCAPES1",42,0)
 . S:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,"PCE")) ^("PCE")="" S LRPCEN=^("PCE")
"RTN","LRCAPES1",43,0)
 . S LREDT=$S($G(LREDT):LREDT,1:$$NOW^XLFDT)
"RTN","LRCAPES1",44,0)
 . S:'$P(LREDT,".",2) $P(LREDT,".",2)="1201"
"RTN","LRCAPES1",45,0)
 . D SEND^LRCAPPH1
"RTN","LRCAPES1",46,0)
 . I '$D(LRQUIET) W $$CJ^XLFSTR("Visit # "_LRVSITN,80)
"RTN","LRCAPES1",47,0)
 . S ^LRO(68,LRAA,1,LRAD,1,LRAN,"PCE")=$E(LRPCEN_LRVSITN_";",1,80)
"RTN","LRCAPES1",48,0)
 D SETWKL(LRAA,LRAD,LRAN)
"RTN","LRCAPES1",49,0)
 Q
"RTN","LRCAPES1",50,0)
SETWKL(LRAA,LRAD,LRAN) ;Set workload into 68 from CPT coding
"RTN","LRCAPES1",51,0)
 Q:'$P(LRPARAM,U,14)!('$P($G(^LRO(68,+$G(LRAA),0)),U,16))
"RTN","LRCAPES1",52,0)
 I '$G(^LRO(68,+$G(LRAA),1,+$G(LRAD),1,+$G(LRAN),0)) Q
"RTN","LRCAPES1",53,0)
 I '$O(^TMP("LR",$J,"LRLST",0)) K ^TMP("LR",$J,"LRLST") Q
"RTN","LRCAPES1",54,0)
 I '$D(LRQUIET) W !,$$CJ^XLFSTR("Storing LMIP Workload",IOM)
"RTN","LRCAPES1",55,0)
 N LRCNT,LRT,LRP,LRTIME,LRCDEF,LRURGW,LRI,LRADD
"RTN","LRCAPES1",56,0)
 S:'$G(LRURG) LRURG=9
"RTN","LRCAPES1",57,0)
 S (LRADD,LRCNT)=1,LRCDEF="3000",LRURGW=+$G(LRURG)
"RTN","LRCAPES1",58,0)
 S LRT("P")=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,0))
"RTN","LRCAPES1",59,0)
 S LRI=0 F  S LRI=$O(^TMP("LR",$J,"LRLST",LRI)) Q:LRI<1  D
"RTN","LRCAPES1",60,0)
 . S LRP=$P(^TMP("LR",$J,"LRLST",LRI),U,2)
"RTN","LRCAPES1",61,0)
 . I 'LRP D  Q:'LRP
"RTN","LRCAPES1",62,0)
 . . S LRP=+$O(^LAM("AB",$P(^TMP("LR",$J,"LRLST",LRI),U)_";ICPT(",0))
"RTN","LRCAPES1",63,0)
 . Q:'($D(^LAM(LRP,0))#2)
"RTN","LRCAPES1",64,0)
 . S LRT=+$O(^LAM(LRP,7,"B",0))
"RTN","LRCAPES1",65,0)
 . I 'LRT S LRT=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,0))
"RTN","LRCAPES1",66,0)
 . Q:'LRT
"RTN","LRCAPES1",67,0)
 . D SET^LRCAPV1S,STUFI^LRCAPV1
"RTN","LRCAPES1",68,0)
 K ^TMP("LR",$J,"LRLST")
"RTN","LRCAPES1",69,0)
 Q
"RTN","LRCAPES1",70,0)
DIS ;
"RTN","LRCAPES1",71,0)
 N X9
"RTN","LRCAPES1",72,0)
 K X,LRLST,LRCNT,LRI,LRX,LRXY,LRXTST
"RTN","LRCAPES1",73,0)
 K ^TMP("LR",$J,"LRLST")
"RTN","LRCAPES1",74,0)
 N LRNOTFD,LRNOLK,LRIA81,LRIA64,LRRF64
"RTN","LRCAPES1",75,0)
 I $G(LRANSX) D
"RTN","LRCAPES1",76,0)
 . S X=LRANSX D RANGE^LRWU2
"RTN","LRCAPES1",77,0)
 . X (X9_"S LRX=T1 D EX1^LRCAPES")
"RTN","LRCAPES1",78,0)
 I '$O(^TMP("LR",$J,"LRLST",0)) D  Q
"RTN","LRCAPES1",79,0)
 . W !!!,?5,"The following CPT Code(s) are not selected:"
"RTN","LRCAPES1",80,0)
 . W:$G(LRNOTFD) !?8,"Not found in #81: ",LRNOTFD
"RTN","LRCAPES1",81,0)
 . W:$G(LRIA81) !?8,"Inactive in #81: ",LRIA81
"RTN","LRCAPES1",82,0)
 . W:$G(LRIA64) !?8,"Inactive in #64: ",LRIA64
"RTN","LRCAPES1",83,0)
 . W:$G(LRNOLK) !?8,"Not linked to workload: ",LRNOLK
"RTN","LRCAPES1",84,0)
 . W !
"RTN","LRCAPES1",85,0)
 . S LRANSY=0
"RTN","LRCAPES1",86,0)
 D DEM
"RTN","LRCAPES1",87,0)
CHK ;User accepts CPT list
"RTN","LRCAPES1",88,0)
 N DIR
"RTN","LRCAPES1",89,0)
 S DIR("A")="Is this correct "
"RTN","LRCAPES1",90,0)
 S DIR(0)="Y",DIR("B")="Yes" D RD
"RTN","LRCAPES1",91,0)
 I $G(LRANSY)'=1 D
"RTN","LRCAPES1",92,0)
 .K ^TMP("LR",$J,"LRLST")
"RTN","LRCAPES1",93,0)
 .S ^TMP("LR",$J,"LRLST")=$$FMADD^XLFDT(DT,2)_U_DT_U_"LAB ES CPT"
"RTN","LRCAPES1",94,0)
 Q
"RTN","LRCAPES1",95,0)
PG ;Page break
"RTN","LRCAPES1",96,0)
 N DIR,DIRUT,DUOUT,DTOUT
"RTN","LRCAPES1",97,0)
 S DIR(0)="E" D ^DIR
"RTN","LRCAPES1",98,0)
 I $G(DIRUT) S LREND=1 Q
"RTN","LRCAPES1",99,0)
 W @IOF
"RTN","LRCAPES1",100,0)
 Q
"RTN","LRCAPES1",101,0)
RD ;DIR read
"RTN","LRCAPES1",102,0)
 N Y,X,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","LRCAPES1",103,0)
 S (LRANSY,LRANSX)=0
"RTN","LRCAPES1",104,0)
 S LREND=0 W !
"RTN","LRCAPES1",105,0)
 D ^DIR I $D(DIRUT) S LREND=1 Q
"RTN","LRCAPES1",106,0)
 S LRANSY=$G(Y),LRANSX=$G(X)
"RTN","LRCAPES1",107,0)
 Q
"RTN","LRCAPES1",108,0)
READ ;Select CPT codes for accession
"RTN","LRCAPES1",109,0)
 ; Ask if want to see previously loaded CPT codes
"RTN","LRCAPES1",110,0)
 D LSTCPT(LRAA,LRAD,LRAN)
"RTN","LRCAPES1",111,0)
 N DIR,LREND
"RTN","LRCAPES1",112,0)
 S DIR(0)="LO",LREND=0
"RTN","LRCAPES1",113,0)
 S DIR("A")="Select CPT codes"
"RTN","LRCAPES1",114,0)
 S DIR("?")="List or range e.g, 1,3,5-7,88000."
"RTN","LRCAPES1",115,0)
 S DIR("??")="^D HLP^LRCAPES1"
"RTN","LRCAPES1",116,0)
 D RD
"RTN","LRCAPES1",117,0)
 Q
"RTN","LRCAPES1",118,0)
DEM ;
"RTN","LRCAPES1",119,0)
 N LRIENS,DA
"RTN","LRCAPES1",120,0)
 S LRIENS=LRAN_","_LRAD_","_LRAA_","
"RTN","LRCAPES1",121,0)
 W @IOF
"RTN","LRCAPES1",122,0)
 W !?3,PNM,?35,SSN,?55,"DOB: ",$$FMTE^XLFDT(DOB,1)
"RTN","LRCAPES1",123,0)
 W !?5,LRCDT
"RTN","LRCAPES1",124,0)
 W !?10,LRSPECID,?60,"Loc: ",$G(LRLLOCX)
"RTN","LRCAPES1",125,0)
 I $G(^LRO(68,LRAA,1,LRAD,1,LRAN,"PCE")) W !?15,"PCE ENC # "_^("PCE")
"RTN","LRCAPES1",126,0)
 W !?15,"Specimen: ",$$GET1^DIQ(68.05,"1,"_LRIENS,.01,"E")
"RTN","LRCAPES1",127,0)
 I $L($G(LRSS)),$O(^LR(LRDFN,LRSS,LRIDT,.1,0)) D
"RTN","LRCAPES1",128,0)
 . N LRX
"RTN","LRCAPES1",129,0)
 . W !?5,"Tissue Specimens: "
"RTN","LRCAPES1",130,0)
 . S LRX=0 F  S LRX=$O(^LR(LRDFN,LRSS,LRIDT,.1,LRX)) Q:LRX<1  W !,?15,$P($G(^(LRX,0)),U)
"RTN","LRCAPES1",131,0)
 W !?5,"Test(s); "
"RTN","LRCAPES1",132,0)
 S (LREND,LRX)=0 D
"RTN","LRCAPES1",133,0)
 . N LREND
"RTN","LRCAPES1",134,0)
 . F  S LRX=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRX)) Q:LRX<1!($G(LREND))  D
"RTN","LRCAPES1",135,0)
 . . I $Y>(IOSL-5) D PG Q:$G(LREND)
"RTN","LRCAPES1",136,0)
 . . W ?15,$P($G(^LAB(60,+LRX,0)),U)_"/ "
"RTN","LRCAPES1",137,0)
 ;Display pathologist's name
"RTN","LRCAPES1",138,0)
 N LRPATH,LRIENS,LRFL
"RTN","LRCAPES1",139,0)
 S:LRSS="AU" LRPATH=$$GET1^DIQ(63,LRDFN,13.6,"I")
"RTN","LRCAPES1",140,0)
 I LRSS'="AU" D
"RTN","LRCAPES1",141,0)
 .S LRFL=$S(LRSS="EM":63.02,LRSS="CY":63.09,LRSS="SP":63.08,1:0)
"RTN","LRCAPES1",142,0)
 .S LRIENS=LRIDT_","_LRDFN_","
"RTN","LRCAPES1",143,0)
 .S LRPATH=$$GET1^DIQ(LRFL,LRIENS,.02,"I")
"RTN","LRCAPES1",144,0)
 S LRPATH=$$GET1^DIQ(200,+$G(LRPATH),.01,"I")
"RTN","LRCAPES1",145,0)
 W:LRSS="CY" !?5,"Pathologist/Cytotechnologist: ",LRPATH,!
"RTN","LRCAPES1",146,0)
 W:LRSS'="CY" !?5,"Pathologist: ",LRPATH,!
"RTN","LRCAPES1",147,0)
 ;
"RTN","LRCAPES1",148,0)
 Q:'$O(^TMP("LR",$J,"LRLST",0))
"RTN","LRCAPES1",149,0)
 W !!,$$CJ^XLFSTR("Selected CPT Codes",IOM)
"RTN","LRCAPES1",150,0)
 W ! S (LREND,LRX)=0 D
"RTN","LRCAPES1",151,0)
 . N LREND,LRTMP
"RTN","LRCAPES1",152,0)
 . S LRTMP=0
"RTN","LRCAPES1",153,0)
 . F  S LRX=+$O(^TMP("LR",$J,"LRLST",LRX)) Q:LRX<1!($G(LREND))  D
"RTN","LRCAPES1",154,0)
 . . I $Y>(IOSL-5) D PG Q:$G(LREND)
"RTN","LRCAPES1",155,0)
 . . S LRTMP=$G(^TMP("LR",$J,"LRLST",LRX))
"RTN","LRCAPES1",156,0)
 . . W !?5,"("_LRX_")  "_$P(LRTMP,U)_" "_$E($P(LRTMP,U,3),1,50),!
"RTN","LRCAPES1",157,0)
 . . W:$P(LRTMP,U,5) ?10,$E($P(LRTMP,U,4),1,50)_"  {"_$P(LRTMP,U,5)_"}"
"RTN","LRCAPES1",158,0)
 I $G(LRNOTFD)!$G(LRIA81)!$G(LRIA64)!$G(LRNOLK)!$G(LRRF64) D
"RTN","LRCAPES1",159,0)
 . W !!!?5,"The following CPT Codes are NOT Selected"
"RTN","LRCAPES1",160,0)
 . W:$G(LRNOTFD) !?8,"Not found in #81: ",LRNOTFD
"RTN","LRCAPES1",161,0)
 . W:$G(LRIA81) !?8,"Inactive in #81: ",LRIA81
"RTN","LRCAPES1",162,0)
 . W:$G(LRIA64) !?8,"Inactive in #64: ",LRIA64
"RTN","LRCAPES1",163,0)
 . W:$G(LRNOLK) !?8,"Not Linked to Workload: ",LRNOLK
"RTN","LRCAPES1",164,0)
 . W:$G(LRRF64) !?8,"Inactive in #64\Active Replacement Found: ",LRRF64
"RTN","LRCAPES1",165,0)
 Q
"RTN","LRCAPES1",166,0)
CHKCPT ;Edit CPT code - does it exist,active in 81 or 64, linked to workload?
"RTN","LRCAPES1",167,0)
 N LRINACT,LRII
"RTN","LRCAPES1",168,0)
 S (LRNR,LRACTV,LRXY2,LRWL2,LRD2)=0,LRXY1=$P(LRXY,U)
"RTN","LRCAPES1",169,0)
 I LRXY1=-1 S LRNOTFD=$S($G(LRNOTFD):LRNOTFD_LRX_",",1:LRX_",") Q
"RTN","LRCAPES1",170,0)
 I '$P(LRXY,U,7) S LRIA81=$S($G(LRIA81):LRIA81_LRXY1_",",1:LRXY1_",") Q
"RTN","LRCAPES1",171,0)
 I '$O(^LAM("AB",LRXY1_";ICPT(",0)) D  Q
"RTN","LRCAPES1",172,0)
 . S LRNOLK=$S($G(LRNOLK):LRNOLK_LRXY1_",",1:LRXY1_","),LRNR=1
"RTN","LRCAPES1",173,0)
 ;If CPT is not active in 64, look for alternative active CPT
"RTN","LRCAPES1",174,0)
 S LRWL2=+$O(^LAM("AB",LRXY1_";ICPT(",0))
"RTN","LRCAPES1",175,0)
 S:$G(LRQ)'="" LRWL2=$P(@LRQ,"^") ;For ES Display CPTs
"RTN","LRCAPES1",176,0)
 Q:'LRWL2
"RTN","LRCAPES1",177,0)
 S LRD2=+$O(^LAM("AB",LRXY1_";ICPT(",LRWL2,LRD2))
"RTN","LRCAPES1",178,0)
 S LRREL2=$P(^LAM(LRWL2,4,LRD2,0),U,3),LRINA2=$P(^(0),U,4)
"RTN","LRCAPES1",179,0)
 Q:LRREL2&(LRINA2="")
"RTN","LRCAPES1",180,0)
 Q:LREDT>(LRREL2-1)&((LREDT<LRINA2)!(LRINA2=""))
"RTN","LRCAPES1",181,0)
 ;CPT is inactive, search for another linked, active CPT to replace it
"RTN","LRCAPES1",182,0)
 S LRD2="A",LRD2=$O(^LAM(LRWL2,4,LRD2),-1)
"RTN","LRCAPES1",183,0)
 I LRD2>1 D
"RTN","LRCAPES1",184,0)
 .S LRII=0,(LRREL2,LRINA2)=""
"RTN","LRCAPES1",185,0)
 .F  S LRII=$O(^LAM(LRWL2,4,LRII)) Q:'LRII!(LRACTV)  D
"RTN","LRCAPES1",186,0)
 ..S LRXY2=+$P(^LAM(LRWL2,4,LRII,0),U)
"RTN","LRCAPES1",187,0)
 ..Q:LRXY2=LRXY1
"RTN","LRCAPES1",188,0)
 ..S LRREL2=$P(^LAM(LRWL2,4,LRII,0),U,3),LRINA2=$P(^(0),U,4)
"RTN","LRCAPES1",189,0)
 ..I LRREL2&(LRINA2="") S LRACTV=1  Q
"RTN","LRCAPES1",190,0)
 ..I LREDT>(LRREL2-1)&((LREDT<LRINA2)!(LRINA2="")) S LRACTV=1  Q
"RTN","LRCAPES1",191,0)
 ;No replacement active CPT found, 
"RTN","LRCAPES1",192,0)
 I 'LRACTV S LRIA64=$S($G(LRIA64):LRIA64_LRXY1_",",1:LRXY1_","),LRNR=1 Q
"RTN","LRCAPES1",193,0)
 Q
"RTN","LRCAPES1",194,0)
LSTCPT(LRAA,LRAD,LRAN)  ; Show loaded CPT codes if any
"RTN","LRCAPES1",195,0)
 Q:$S('$G(LRAA):1,'$G(LRAD):1,'$G(LRAN):1,1:0)
"RTN","LRCAPES1",196,0)
 N LRSTR
"RTN","LRCAPES1",197,0)
 S LRSTR=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,"PCE")) Q:'LRSTR
"RTN","LRCAPES1",198,0)
 N DA,DIC,DIR,DIRUT,DIR,DR,ERR,DUOUT,IEN,LRDA,LRENC,LREND,LRP,S,X,Y
"RTN","LRCAPES1",199,0)
 S DIR(0)="Y",DIR("A")=" Would you like to see PCE CPT Information"
"RTN","LRCAPES1",200,0)
 S DIR("B")="No" D ^DIR Q:$G(DIRUT)!($G(Y)'=1)
"RTN","LRCAPES1",201,0)
 ;List filed CPT CODES
"RTN","LRCAPES1",202,0)
 W @IOF
"RTN","LRCAPES1",203,0)
 F LRP=1:1 S IEN=$P(LRSTR,";",LRP) Q:IEN=""  D
"RTN","LRCAPES1",204,0)
 . D GETCPT^PXAPIOE(IEN,"LRENC","ERR")
"RTN","LRCAPES1",205,0)
 S (LRDA,LREND)=0 F  S LRDA=$O(LRENC(LRDA)) Q:'LRDA!($G(LREND))  D
"RTN","LRCAPES1",206,0)
 . I $Y>(IOSL-6) D PG W @IOF Q:$G(LREND)
"RTN","LRCAPES1",207,0)
 . S S=0,DA=LRDA,DR="0:99",DIC="^AUPNVCPT(" D EN^DIQ
"RTN","LRCAPES1",208,0)
 Q
"RTN","LRCAPES1",209,0)
HLP ;Help display for CPT selection
"RTN","LRCAPES1",210,0)
 N DIR,DIRUT,DUOUT,DTOUT,LREND,LRX,LRY
"RTN","LRCAPES1",211,0)
 W @IOF
"RTN","LRCAPES1",212,0)
 S LRX="^TMP(""LR"","_$J_",""AK"",0,1)"
"RTN","LRCAPES1",213,0)
 W $$CJ^XLFSTR("List or range e.g, 1,3,5-7,88300.",IOM)
"RTN","LRCAPES1",214,0)
 W $$CJ^XLFSTR("Select from the following or enter CPT separated by a comma",IOM),!
"RTN","LRCAPES1",215,0)
 F  S LRX=$Q(@LRX) Q:$QS(LRX,2)'=$J!($G(LREND))!($QS(LRX,1)'="LR")  D
"RTN","LRCAPES1",216,0)
 . S LRY=@LRX
"RTN","LRCAPES1",217,0)
 . W !?3,$QS(LRX,4),?6," = "_$QS(LRX,6)_"  "_$E($P(LRY,U,2),1,60),!
"RTN","LRCAPES1",218,0)
 . W:$P(LRY,U,4) ?8,$P(LRY,U,3)_" { NLT = "_$P(LRY,U,4)_" }",!
"RTN","LRCAPES1",219,0)
 . I $Y>(IOSL-6) S DIR(0)="E" D RD I '$G(LREND)  W @IOF
"RTN","LRCAPES1",220,0)
 D LSTCPT^LRCAPES1($G(LRAA),$G(LRAD),$G(LRAN))
"RTN","LRCAPES1",221,0)
 Q
"RTN","LRCAPPH1")
0^3^B60854861^B56348077
"RTN","LRCAPPH1",1,0)
LRCAPPH1 ;DALOI/SED/RKS/KLL - PROCESS PHLEBOTOMY WORKLOAD DATA CONT ;07/30/04
"RTN","LRCAPPH1",2,0)
 ;;5.2;LAB SERVICE;**127,136,138,158,263,264,274,291,359,308**;Sep 27, 1994
"RTN","LRCAPPH1",3,0)
 ; Reference to  ^SC( Supported by DBIA #1482
"RTN","LRCAPPH1",4,0)
 ; Reference to  $$CODM^ICPTCOD Supported by DBIA #1995-A
"RTN","LRCAPPH1",5,0)
 ; Reference to  $$CPT^ICPTCOD Supported by DBIA #1995-A
"RTN","LRCAPPH1",6,0)
 ; Reference to  $$DATA2PCE^PXAPI Supported by DBIA #1889-A
"RTN","LRCAPPH1",7,0)
 ; Reference to  $$DELVFILE^PXAPI Supported by DBIA #1889-B
"RTN","LRCAPPH1",8,0)
 ; Reference to  ENCEVENT^PXKENC Supported by DBIA #1889-F
"RTN","LRCAPPH1",9,0)
 ; Reference to  $$NOW^XLFDT Supported by Reference #10103
"RTN","LRCAPPH1",10,0)
 ; Reference to  $$GET^XUA4A72 Supported by Reference #1625
"RTN","LRCAPPH1",11,0)
EN3 ;LREDT = PATIENT ENCOUNTER DATE
"RTN","LRCAPPH1",12,0)
 N LREDT,LRNOP,LRBEID
"RTN","LRCAPPH1",13,0)
 K ^TMP("LRPXAPI",$J),LRXTST,LRVSITN,LRXCPT
"RTN","LRCAPPH1",14,0)
NP ;Not perform entry
"RTN","LRCAPPH1",15,0)
 S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=""
"RTN","LRCAPPH1",16,0)
 S LREDT=$P($G(^LRO(69,LRCDT,1,LRSN,1)),U)
"RTN","LRCAPPH1",17,0)
 N LRDUZ
"RTN","LRCAPPH1",18,0)
 Q:+LREDT'>0!('$D(^LR(+NODE,0))#2)
"RTN","LRCAPPH1",19,0)
 S:$G(LRDBUG) LREDT=$$NOW^XLFDT
"RTN","LRCAPPH1",20,0)
 S EDATE=$P(LREDT,".")
"RTN","LRCAPPH1",21,0)
 S:'$P(LREDT,".",2) $P(LREDT,".",2)="1201"
"RTN","LRCAPPH1",22,0)
 S LOC=+$P(NODE,U,9),LRNINS=$P(NODE(1),U,8),LRPRO=+$P(NODE,U,6) ;CHECK
"RTN","LRCAPPH1",23,0)
 S LRDUZ=+$P(NODE,U,2)
"RTN","LRCAPPH1",24,0)
 S LRNINS=$S($P($G(^SC(LOC,0)),U,4):$P(^(0),U,4),$G(LRNINS):LRNINS,1:LRINS)
"RTN","LRCAPPH1",25,0)
 S LRPRO=$S($$GET^XUA4A72(LRPRO,EDATE)>0:LRPRO,1:LRDPRAC)
"RTN","LRCAPPH1",26,0)
 I $S('$G(LOC):1,"CMZ"'[$P($G(^SC(LOC,0)),U,3):1,1:0) Q
"RTN","LRCAPPH1",27,0)
 I $S('DFN:1,'LOC:1,1:0) S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=1 S LRNOP=1 Q
"RTN","LRCAPPH1",28,0)
 I 'LRNINS S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=2 S LRNOP=2 Q
"RTN","LRCAPPH1",29,0)
 I 'LRPRO S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=3 S LRNOP=3 Q
"RTN","LRCAPPH1",30,0)
 Q:$G(LRNP)
"RTN","LRCAPPH1",31,0)
EN5 ;GET THE CPT CODES FOR THE TESTS
"RTN","LRCAPPH1",32,0)
 I LRCDT,LRSN,$D(^LRO(69,LRCDT,1,LRSN,2,0)) D
"RTN","LRCAPPH1",33,0)
 . S (LRTST,LRCNT,LRXAA)=0 K LRXTST S LRXTST=""
"RTN","LRCAPPH1",34,0)
 . F  S LRTST=$O(^LRO(69,LRCDT,1,LRSN,2,LRTST)) Q:+LRTST'>0  D
"RTN","LRCAPPH1",35,0)
 . . Q:'($D(^LRO(69,LRCDT,1,LRSN,2,LRTST,0))#2)  S LREN5=^(0)
"RTN","LRCAPPH1",36,0)
 . . Q:$S($P(LREN5,U,12):1,$P(LREN5,U,11):1,1:0)  ;Don't send cancel/already sent codes
"RTN","LRCAPPH1",37,0)
 . . S LRTSTP=+$P(LREN5,U),LRAA=+$P(LREN5,U,4) Q:$S('LRTSTP:1,'LRAA:1,1:0)
"RTN","LRCAPPH1",38,0)
 . . ;Turn off old style PCE reporting for CH subscripts.
"RTN","LRCAPPH1",39,0)
 . . ;Data passed via Billing Aware API
"RTN","LRCAPPH1",40,0)
 . . I $P($G(^LRO(68,LRAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",41,0)
 . . S LRBEID=$P(^LRO(69,LRCDT,1,LRSN,2,LRTST,.3),U)
"RTN","LRCAPPH1",42,0)
 . . I '$G(LRDBUG),$P($G(^LRO(68,LRAA,0)),U,2)'="MI" S $P(^LRO(69,LRCDT,1,LRSN,2,LRTST,0),U,12)=1
"RTN","LRCAPPH1",43,0)
 . . I 'LRXAA S LRXAA=LRAA D LOC
"RTN","LRCAPPH1",44,0)
 . . Q:'$G(LRDSSID)
"RTN","LRCAPPH1",45,0)
 . . I LRXAA'=LRAA,$D(^TMP("LRPXAPI",$J,"PROCEDURE")) D SEND K ^TMP("LRPXAPI",$J) S LRXAA=LRAA D LOC Q:'$G(LRDSSID)  D EN6 Q
"RTN","LRCAPPH1",46,0)
 . . D EN6
"RTN","LRCAPPH1",47,0)
 I $D(^TMP("LRPXAPI",$J,"PROCEDURE")),'$G(^LRO(69,"AA",LRCEX,LROA)) D SEND
"RTN","LRCAPPH1",48,0)
END Q:$G(LRDBUG)
"RTN","LRCAPPH1",49,0)
END0 K ^TMP("LRPXAPI",$J),LRINA,LRREL,LRNLT,CPT,LRPRO,LRICPT,EDATE,LRTST
"RTN","LRCAPPH1",50,0)
 K I,LOC,LRI,LRCNT,LRSTP,LRNINS,LROK,LRAA,LRXAA,LRDSSID,LREN5,LRXTST
"RTN","LRCAPPH1",51,0)
 K LRNLTN,LRIDT,LRXTSTU,LRXCPT
"RTN","LRCAPPH1",52,0)
 Q
"RTN","LRCAPPH1",53,0)
EN6 ;Called from LRCAPPNP
"RTN","LRCAPPH1",54,0)
 ;Turn off old style PCE reporting for CH subscripts.
"RTN","LRCAPPH1",55,0)
 ;Data passed via Billing Aware API
"RTN","LRCAPPH1",56,0)
 I $G(LRAA),$P($G(^LRO(68,LRAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",57,0)
 S:'$D(^LRO(69,LRCDT,1,LRSN,"PCE")) ^("PCE")=""
"RTN","LRCAPPH1",58,0)
 N LRFLG
"RTN","LRCAPPH1",59,0)
 S LRNLT=+$P($G(^LAB(60,LRTSTP,64)),U),LRICPT=0
"RTN","LRCAPPH1",60,0)
 Q:+LRNLT'>0
"RTN","LRCAPPH1",61,0)
 Q:'$D(^LAM("AD",LRNLT,"CPT"))  S LRNLTN=$P(^LAM(LRNLT,0),U,2)
"RTN","LRCAPPH1",62,0)
 Q:'LRNLTN
"RTN","LRCAPPH1",63,0)
 F  S LRICPT=$O(^LAM("AD",LRNLT,"CPT",LRICPT)) Q:+LRICPT'>0  S CPT=+$P($G(^LAM(LRNLT,4,LRICPT,0)),U) I CPT,$P(^(0),U,2)="CPT" D
"RTN","LRCAPPH1",64,0)
 . ;CPT must be active in file #64 before edit can continue against #81
"RTN","LRCAPPH1",65,0)
 . S LRFLG=1
"RTN","LRCAPPH1",66,0)
 . S LRREL=$P(^LAM(LRNLT,4,LRICPT,0),U,3),LRINA=$P(^(0),U,4)
"RTN","LRCAPPH1",67,0)
 . I LRREL&(LRINA="") S LRFLG=0
"RTN","LRCAPPH1",68,0)
 . I LRFLG,EDATE>(LRREL-1)&((EDATE<LRINA)!(LRINA="")) S LRFLG=0
"RTN","LRCAPPH1",69,0)
 . Q:'$G(CPT)!(LRFLG)
"RTN","LRCAPPH1",70,0)
 . I '$P($$CPT^ICPTCOD(CPT,$P(LREDT,"."),,),U,7) S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=4 Q
"RTN","LRCAPPH1",71,0)
 . S LRREL=$P(^LAM(LRNLT,4,LRICPT,0),U,3),LRINA=$P(^(0),U,4)
"RTN","LRCAPPH1",72,0)
 . D:LRREL&(LRINA="") SET Q
"RTN","LRCAPPH1",73,0)
 . D:EDATE>(LRREL-1)&((EDATE<LRINA)!(LRINA="")) SET
"RTN","LRCAPPH1",74,0)
 Q
"RTN","LRCAPPH1",75,0)
LOC ;Called from LRCAPPNP
"RTN","LRCAPPH1",76,0)
 I '$G(LRAA) S LRNOP=4 Q
"RTN","LRCAPPH1",77,0)
 S LRDSSLOC=$S($G(^LRO(68,+LRAA,.8)):+^(.8),1:LRDLOC)
"RTN","LRCAPPH1",78,0)
 I 'LRDSSLOC S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=4 S LRNOP=4 Q
"RTN","LRCAPPH1",79,0)
 S LRDSSID=+$P($G(^SC(LRDSSLOC,0)),U,7)
"RTN","LRCAPPH1",80,0)
 I 'LRDSSID S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=5 S LRNOP=5
"RTN","LRCAPPH1",81,0)
 Q
"RTN","LRCAPPH1",82,0)
SET ;SET IF VALID PROCEDURE
"RTN","LRCAPPH1",83,0)
 I $G(LRNP),'$D(LRNPX(CPT))#2 Q
"RTN","LRCAPPH1",84,0)
 I '$D(^TMP("LRMOD",$J,CPT)) S ^(CPT)="" D
"RTN","LRCAPPH1",85,0)
 . N X
"RTN","LRCAPPH1",86,0)
 . S X=$$CODM^ICPTCOD(CPT,"^TMP(""LRMOD"",$J,CPT)",,)
"RTN","LRCAPPH1",87,0)
 ;LRCNT=CPT POSITION IN TABLE LRXCPT
"RTN","LRCAPPH1",88,0)
 ;LRCCT=LOCATION POSITION IN TABLE LRXCPT
"RTN","LRCAPPH1",89,0)
 I $G(LRXCPT(CPT)) S LRCNT=LRXCPT(CPT)
"RTN","LRCAPPH1",90,0)
 I '$G(LRXCPT(CPT)) S (LRCNT,LRCCT)=$G(LRCCT)+1,LRXCPT(CPT)=LRCCT
"RTN","LRCAPPH1",91,0)
 ;S LRCNT=LRXCPT(CPT)
"RTN","LRCAPPH1",92,0)
 I '$G(LRNP) S LRXCPT(CPT,"P",LRCNT)=1+$G(LRXCPT(CPT,"P",LRCNT))
"RTN","LRCAPPH1",93,0)
 I $G(LRNP) D
"RTN","LRCAPPH1",94,0)
 . S LRXCPT(CPT,"P",LRCNT)=($G(LRNPX(CPT))-1)
"RTN","LRCAPPH1",95,0)
 . S LRNPX(CPT)=(LRNPX(CPT)-1)
"RTN","LRCAPPH1",96,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"ENC PROVIDER")=LRPRO
"RTN","LRCAPPH1",97,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"PROCEDURE")=CPT
"RTN","LRCAPPH1",98,0)
 I $G(LRNP) D
"RTN","LRCAPPH1",99,0)
 . Q:$G(LRXCPT(CPT,"P",LRCNT))>0
"RTN","LRCAPPH1",100,0)
 . S LRXCPT(CPT,"P",LRCNT)=1
"RTN","LRCAPPH1",101,0)
 . S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"DELETE")=1
"RTN","LRCAPPH1",102,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"QTY")=$S($G(LRXCPT(CPT,"P",LRCNT)):LRXCPT(CPT,"P",LRCNT),1:1)
"RTN","LRCAPPH1",103,0)
 Q:$G(LRNP)
"RTN","LRCAPPH1",104,0)
 I $G(LRXCPT(CPT,"P",LRCNT))>1,$D(^TMP("LRMOD",$J,CPT,59))>0 D
"RTN","LRCAPPH1",105,0)
 . S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"MODIFIERS",59)=""
"RTN","LRCAPPH1",106,0)
 ;If Manual CPT coding always set modifier to 59 to force PCE to add CPT code.
"RTN","LRCAPPH1",107,0)
 I $G(LRES) S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"MODIFIERS",59)=""
"RTN","LRCAPPH1",108,0)
 I $G(LRAA) D
"RTN","LRCAPPH1",109,0)
 .S MOD=$$GMOD^LRBEBA2(LRAA,CPT)
"RTN","LRCAPPH1",110,0)
 .I MOD'="" S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"MODIFIERS",MOD)="" K MOD
"RTN","LRCAPPH1",111,0)
 S LRXTST(LRTST)=LRNLTN_U_LRTSTP
"RTN","LRCAPPH1",112,0)
 I $G(LRAA),$P($G(^LRO(68,LRAA,0)),U,2)="MI" D
"RTN","LRCAPPH1",113,0)
 . Q:('$D(^TMP("LRPXAPI",$J,"PROCEDURE")))
"RTN","LRCAPPH1",114,0)
 . ;Get PCE data via Billing Aware API for Microbiology
"RTN","LRCAPPH1",115,0)
 . D MICRO1^LRBEBA3(LRCDT,LRSN,LRTST,LRCNT)
"RTN","LRCAPPH1",116,0)
 . I '$D(^TMP("LRPXAPI",$J,"PROCEDURE")) S ^LRO(69,"AA",LRCEX,LROA)=9
"RTN","LRCAPPH1",117,0)
 Q
"RTN","LRCAPPH1",118,0)
SEND ;BUILD ENCOUNTER INFO Called from LRCAPPNP
"RTN","LRCAPPH1",119,0)
 I '$G(LRESCPT) Q:$G(^LRO(69,"AA",$G(LRCEX),$G(LROA)))
"RTN","LRCAPPH1",120,0)
 N LRENCDT ; Check for incorrect time
"RTN","LRCAPPH1",121,0)
 S LRENCDT=$J(LREDT,7,4),LRENCDT(1)=$P(LRENCDT,".",2)
"RTN","LRCAPPH1",122,0)
 S:'LRENCDT(1) LRENCDT(1)=1201
"RTN","LRCAPPH1",123,0)
 I $E(LRENCDT(1),3,4)>59 S LRENCDT(1)=$E(LRENCDT(1),1,2)_59
"RTN","LRCAPPH1",124,0)
 I $E(LRENCDT(1),1,2)>23 S LRENCDT(1)=23_$E(LRENCDT(1),3,4)
"RTN","LRCAPPH1",125,0)
 S $P(LRENCDT,".",2)=LRENCDT(1)
"RTN","LRCAPPH1",126,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"DSS ID")=LRDSSID
"RTN","LRCAPPH1",127,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"ENC D/T")=LRENCDT
"RTN","LRCAPPH1",128,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"HOS LOC")=LRDSSLOC
"RTN","LRCAPPH1",129,0)
 S:LRNINS ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"INSTITUTION")=LRNINS
"RTN","LRCAPPH1",130,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"PATIENT")=DFN
"RTN","LRCAPPH1",131,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"SERVICE CATEGORY")="X"
"RTN","LRCAPPH1",132,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"ENCOUNTER TYPE")="A"
"RTN","LRCAPPH1",133,0)
PCE ;SEND DATA TO PCE
"RTN","LRCAPPH1",134,0)
 N LRLNOW,LRAAX
"RTN","LRCAPPH1",135,0)
 K LRVSITN S (LROK,LRVSITN)=""
"RTN","LRCAPPH1",136,0)
 I $G(LRAA) S LRAAX=$P($G(^LRO(68,LRAA,0)),U,2)
"RTN","LRCAPPH1",137,0)
 I ($G(LRAAX)="CH") S LROK=1,LRVSITN=$G(LRBEVSIT)
"RTN","LRCAPPH1",138,0)
 I ($G(LRAAX)="MI") D
"RTN","LRCAPPH1",139,0)
 . Q:('$D(^TMP("LRPXAPI",$J,"PROCEDURE")))
"RTN","LRCAPPH1",140,0)
 . ;Get PCE data via Billing Aware API for Microbiology
"RTN","LRCAPPH1",141,0)
 . D MICRO2^LRBEBA3(LRCDT,LRSN)
"RTN","LRCAPPH1",142,0)
 . S LROK=$$DATA2PCE^PXAPI("^TMP(""LRPXAPI"",$J)",LRPKG,"LAB DATA",.LRVSITN,$G(LRDUZ))
"RTN","LRCAPPH1",143,0)
 . K ^TMP("LRBEDX",$J)
"RTN","LRCAPPH1",144,0)
 I (";AU;BB;CY;EM;SP;"[(";"_$G(LRSS)_";"))!(";AU;BB;CY;EM;SP;"[(";"_$G(LRAAX)_";")) D
"RTN","LRCAPPH1",145,0)
 .S LROK=$$DATA2PCE^PXAPI("^TMP(""LRPXAPI"",$J)",LRPKG,"LAB DATA",.LRVSITN,$G(LRDUZ))
"RTN","LRCAPPH1",146,0)
 I $G(^XTMP("LRPCELOG",0)) D  ;Used to log/debug contents of ^TMP("LRPXAPI")
"RTN","LRCAPPH1",147,0)
 . F  S LRLNOW=$$NOW^XLFDT Q:'$D(^XTMP("LRPCELOG",1,LRLNOW))  H 1
"RTN","LRCAPPH1",148,0)
 . S ^XTMP("LRPCELOG",1,LRLNOW,0)=U_$G(LRBEID)_U_$G(LRVSITN)
"RTN","LRCAPPH1",149,0)
 . M ^XTMP("LRPCELOG",1,LRLNOW)=^TMP("LRPXAPI",$J)
"RTN","LRCAPPH1",150,0)
 W:$G(LRDBUG) !,"LROK = ",LROK,!,$G(LRVSITN)
"RTN","LRCAPPH1",151,0)
 Q:$G(LRESCPT)
"RTN","LRCAPPH1",152,0)
 I '$G(LRNP),$D(^LRO(69,LRCDT,1,LRSN,"PCE")) S:LRVSITN ^("PCE")=$E(^("PCE")_$S(LROK>0:LRVSITN,1:LROK)_";",1,30) D
"RTN","LRCAPPH1",153,0)
 . I LROK<1,$D(^LRO(69,"AA",LRCEX,LROA)) S ^(LROA)=LROK
"RTN","LRCAPPH1",154,0)
EN7 N LRFND,LRPCE
"RTN","LRCAPPH1",155,0)
 Q:'$G(LRNP)!(LROK<1)!('LRVSITN)
"RTN","LRCAPPH1",156,0)
 S LRPCE=$G(^LRO(69,LRCDT,1,LRSN,"PCE"))
"RTN","LRCAPPH1",157,0)
 I '$F(LRPCE,LRVSITN_"-CPT CANC") D
"RTN","LRCAPPH1",158,0)
 . S LRFND=$F(LRPCE,LRVSITN) Q:'LRFND
"RTN","LRCAPPH1",159,0)
 . I LRFND S LRPCE=$E(LRPCE,1,(LRFND-1))_"-CPT CANC"_$E(LRPCE,LRFND,$L(LRPCE))
"RTN","LRCAPPH1",160,0)
 . S ^LRO(69,LRCDT,1,LRSN,"PCE")=$E(LRPCE,1,30)
"RTN","LRCAPPH1",161,0)
CHK ;Determine if any CPT code remain on the encounter, then delete encounter if false
"RTN","LRCAPPH1",162,0)
 K ^TMP("PXKENC",$J)
"RTN","LRCAPPH1",163,0)
 D ENCEVENT^PXKENC(LRVSITN,1)
"RTN","LRCAPPH1",164,0)
 I $O(^TMP("PXKENC",$J,LRVSITN,"CPT",0)) K ^TMP("PXKENC",$J) Q
"RTN","LRCAPPH1",165,0)
 S LROK=$$DELVFILE^PXAPI("ALL",$G(LRVSITN),LRPKG,"LAB DATA",0,0,0)
"RTN","LRCAPPH1",166,0)
 K ^TMP("PXKENC",$J) Q:LROK<1
"RTN","LRCAPPH1",167,0)
 N LRSN
"RTN","LRCAPPH1",168,0)
 S LRSN=0
"RTN","LRCAPPH1",169,0)
 F  S LRSN=$O(^LRO(69,"C",LRCE,LRCDT,LRSN)) Q:LRSN<1  D DELCAN
"RTN","LRCAPPH1",170,0)
 Q
"RTN","LRCAPPH1",171,0)
DELCAN ;Mark PCE Encounter number as '-CPT CANC-ENC DEL'
"RTN","LRCAPPH1",172,0)
 ;LRVSITN = Encounter IEN
"RTN","LRCAPPH1",173,0)
 S LRPCE=$G(^LRO(69,LRCDT,1,LRSN,"PCE")) Q:'$L(LRPCE)  D
"RTN","LRCAPPH1",174,0)
 . Q:'$G(LRVSITN)
"RTN","LRCAPPH1",175,0)
 . I $F(LRPCE,LRVSITN_"-CPT CANC-ENC DEL;") Q
"RTN","LRCAPPH1",176,0)
 . S LRFND=$F($G(LRPCE),LRVSITN_"-CPT CANC") I LRFND D  Q
"RTN","LRCAPPH1",177,0)
 . . S LRPCE=$E(LRPCE,1,(LRFND-1))_"-ENC DEL"_$E(LRPCE,LRFND,$L(LRPCE))
"RTN","LRCAPPH1",178,0)
 . . S ^LRO(69,LRCDT,1,LRSN,"PCE")=$E(LRPCE,1,30)
"RTN","LRCAPPH1",179,0)
 . S LRFND=$F($G(LRPCE),LRVSITN) I LRFND D
"RTN","LRCAPPH1",180,0)
 . . S LRPCE=$E(LRPCE,1,(LRFND-1))_"-CPT CANC-ENC DEL"_$E(LRPCE,LRFND,$L(LRPCE))
"RTN","LRCAPPH1",181,0)
 . . S ^LRO(69,LRCDT,1,LRSN,"PCE")=$E(LRPCE,1,30)
"RTN","LRCAPPH1",182,0)
 Q
"RTN","LRCAPPH1",183,0)
TEST ;
"RTN","LRCAPPH1",184,0)
 S:'$G(LRDPRAC) LRDPRAC=DUZ
"RTN","LRCAPPH1",185,0)
 S LRDLOC=+$G(^LAB(69.9,1,.8))
"RTN","LRCAPPH1",186,0)
 S:'$G(LRPKG) LRPKG=26 S:'$G(LRDBUG) LRDBUG=1 S LRVSIT=2
"RTN","LRCAPPH1",187,0)
 S:'$G(LRCDT) LRCDT=DT S:'$G(LRSN) LRSN=1 S NODE=^LRO(69,LRCDT,1,LRSN,0)
"RTN","LRCAPPH1",188,0)
 S NODE(1)=^LRO(69,LRCDT,1,LRSN,1)
"RTN","LRCAPPH1",189,0)
 S DFN=$P(^LR(+NODE,0),U,3)
"RTN","LRCAPPH1",190,0)
 D EN3
"RTN","LRCAPPH1",191,0)
 Q
"VER")
8.0^22.0
"^DD",64,64,26,0)
ES DISPLAY ORDER^NJ3,0X^^10;1^K:+X'=X!(X>1000)!(X<1)!(X?.E1"."1N.N) X I $D(X),'$D(DIU(0)),$D(^LAM("AK",X)) D EN^DDIOL("Already Exist on "_$P($G(^LAM($O(^LAM("AK",X,0)),0)),U),"","!?20") K X
"^DD",64,64,26,1,0)
^.1
"^DD",64,64,26,1,1,0)
64^AK
"^DD",64,64,26,1,1,1)
S ^LAM("AK",$E(X,1,30),DA)=""
"^DD",64,64,26,1,1,2)
K ^LAM("AK",$E(X,1,30),DA)
"^DD",64,64,26,1,1,3)
Display Order Field
"^DD",64,64,26,1,1,"%D",0)
^^2^2^3010322^
"^DD",64,64,26,1,1,"%D",1,0)
This cross ref is used to determine the display order of NLT code that are
"^DD",64,64,26,1,1,"%D",2,0)
associated with ES CPT encoding.
"^DD",64,64,26,1,1,"DT")
3010322
"^DD",64,64,26,1,2,0)
^^TRIGGER^64^14
"^DD",64,64,26,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^LAM(D0,0)):^(0),1:"") S X=$P(Y(1),U,16),X=X S DIU=X K Y S X=DIV S X=1 S DIH=$G(^LAM(DIV(0),0)),DIV=X S $P(^(0),U,16)=DIV,DIH=64,DIG=14 D ^DICR
"^DD",64,64,26,1,2,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^LAM(D0,0)):^(0),1:"") S X=$P(Y(1),U,16),X=X S DIU=X K Y S X="" S DIH=$G(^LAM(DIV(0),0)),DIV=X S $P(^(0),U,16)=DIV,DIH=64,DIG=14 D ^DICR
"^DD",64,64,26,1,2,3)
Indicate Professional CPT code
"^DD",64,64,26,1,2,"%D",0)
^^6^6^3020826^
"^DD",64,64,26,1,2,"%D",1,0)
In order to ensure that DSS workload extract will capture professional 
"^DD",64,64,26,1,2,"%D",2,0)
related NLT/CPT codes. This trigger will automatically set the DSS Feeder 
"^DD",64,64,26,1,2,"%D",3,0)
Key to yes.
"^DD",64,64,26,1,2,"%D",4,0)
 
"^DD",64,64,26,1,2,"%D",5,0)
Note: Only techinical workload should be reported as LMIP workload. 
"^DD",64,64,26,1,2,"%D",6,0)
Professional NLT codes should NOT be marked as billable.
"^DD",64,64,26,1,2,"CREATE VALUE")
S X=1
"^DD",64,64,26,1,2,"DELETE VALUE")
@
"^DD",64,64,26,1,2,"DT")
3020826
"^DD",64,64,26,1,2,"FIELD")
DSS Feeder Key
"^DD",64,64,26,3)
Type a Number between 1 and 1000, 0 Decimal Digits
"^DD",64,64,26,21,0)
^^3^3^3040302^
"^DD",64,64,26,21,1,0)
This field is used to by the LAB CPT BILLING option to display those
"^DD",64,64,26,21,2,0)
CPT codes defined by this NLT codes and will be referenced by this number.
"^DD",64,64,26,21,3,0)
The number entered must be unique between 1-1000.
"^DD",64,64,26,"DT")
3040302
"BLD",5386,6)
^283
**END**
**END**
