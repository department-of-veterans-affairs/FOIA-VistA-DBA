
=============================================================================
Run Date: SEP 05, 1995                     Designation: XU*8*3
Package : XU - KERNEL                          Priority: Mandatory
Version : 8         SEQ #2                     Status: Verified
=============================================================================

Associated patches: (v)XM*DBA*49   <<= must be installed BEFORE `XU*8*3'
                    (v)XU*DBA*1    <<= must be installed BEFORE `XU*8*3'

Subject: P-MESSAGE-HFS device fix

Category: 
  - Informational

Description: 
============

  
 *** MSM  SITES ONLY ***
 The following information is for MSM SITES ONLY:
 MSM sites that use the P-MESSAGE-HFS device may have encountered lost 
 allocation chains at the DOS level. This was the result of deleting the 
 host file before the device is closed. In MSM, the $ZOS function is used to 
 perform several commonly used DOS functions of which delete file is one of 
 them. 
 
 For more information, please refer to DBA patches XM*DBA*49 and XU*DBA*1. 
 Patch XU*DBA*1 described the TERMINAL TYPE file, P-MESSAGE-HFS entry, CLOSE 
 EXECUTE field for MSM systems should contain this code:
 
                S X=$ZOS(2,"XM"_DUZ_".DAT")
 
 For Kernel 8.0, this code must be removed from the CLOSE EXECUTE field of 
 the P-MESSAGE-HFS entry of the TERMINAL TYPE file. New code needs to be added 
 to the POST-CLOSE EXECUTE field of the P-MESSAGE-HFS entry of the DEVICE 
 file.
  
 The POST-CLOSE EXECUTE field should look like:
 
        X  "N X S X=$ZOS(2,""XM""_DUZ_"".DAT"")"
 
 EXAMPLE:
 BEFORE this change, your P-MESSAGE-HFS entry of the TERMINAL TYPE file 
 should look like:
 
 NAME: P-MESSAGE-HFS              RIGHT MARGIN: 255
   FORM FEED: #                   PAGE LENGTH: 256
   BACK SPACE: $C(8)              OPEN EXECUTE: S XMREC="R X#255:1"
   CLOSE EXECUTE: U IO:(::0) D ^XMAPHOST,READ^XMAPHOST S X=$ZOS(2, 
 "XM"_DUZ_".DAT") K XMIO Q
   DESCRIPTION: Special terminal type used only for P-MESSAGE-HFS device
 
 BEFORE this change, your P-MESSAGE-HFS entry of the DEVICE file should look 
 like:
 
 NAME: P-MESSAGE-HFS               $I: 51
   ASK DEVICE: YES                 ASK PARAMETERS: NO
   QUEUING: ALLOWED                *MARGIN WIDTH: 255
   LOCAL SYNONYM: MAIL MESSAGE     *FORM FEED: #      
   *PAGE LENGTH: 256               *BACK SPACE: $C(8)                       
   SUBTYPE: P-MESSAGE-HFS          TYPE: HOST FILE SERVER
   OPEN PARAMETERS: ("XM"_DUZ_".DAT":"M")
   LOCATION OF TERMINAL: HFS FILE => MESSAGE
 
 EDIT the DEVICE file(#3.5) as follows:
 
  >D Q^DI
 
  VA FileMan 21.0
 
  Select OPTION: ENTER OR EDIT FILE ENTRIES
 
  INPUT TO WHAT FILE: DEVICE// DEVICE       (14 entries)
  EDIT WHICH FIELD: ALL// POST-CLOSE EXECUTE
  THEN EDIT FIELD:
 
  Select DEVICE NAME: P-MESSAGE-HFS       51
  POST-CLOSE EXECUTE: X "N X S X=$ZOS(2,""XM""_DUZ_"".DAT"")"
 
  Select DEVICE NAME:
 
 AFTER this change, your P-MESSAGE-HFS entry of the DEVICE file should look 
 like:
 
 NAME: P-MESSAGE-HFS               $I: 51
   ASK DEVICE: YES                 ASK PARAMETERS: NO
   QUEUING: ALLOWED                *MARGIN WIDTH: 255
   LOCAL SYNONYM: MAIL MESSAGE     *FORM FEED: #      
   *PAGE LENGTH: 256               *BACK SPACE: $C(8)                       
   SUBTYPE: P-MESSAGE-HFS          TYPE: HOST FILE SERVER
   OPEN PARAMETERS: ("XM"_DUZ_".DAT":"M")
   LOCATION OF TERMINAL: HFS FILE => MESSAGE
   POST-CLOSE EXECUTE: X "N X S X=$ZOS(2,""XM""_DUZ_"".DAT"")"
 
 
 EDIT the TERMINAL TYPE file(#3.2) as follows:
 
  Select OPTION: ENTER OR EDIT FILE ENTRIES
 
  INPUT TO WHAT FILE: DEVICE// TERMINAL TYPE      (90 entries)
  EDIT WHICH FIELD: ALL// CLOSE EXECUTE
  THEN EDIT FIELD:
 
 
  Select TERMINAL TYPE NAME:    P-MESSAGE-HFS
         Special terminal type used only for P-MESSAGE-HFS device
  CLOSE EXECUTE: U IO:(::0) D ^XMAPHOST,READ^XMAPHOST S X=$ZOS(2, 
 "XM"_DUZ_".DAT") K XMIO Q 
 
  Replace S X=$ZOS...K XMIO With K XMIO  Replace
 
    U IO:(::0) D ^XMAPHOST,READ^XMAPHOST K XMIO Q
 
  Select TERMINAL TYPE NAME:
 
 AFTER this change, your P-MESSAGE-HFS entry of the TERMINAL TYPE file 
 should look like:
 
 NAME: P-MESSAGE-HFS                 RIGHT MARGIN: 255
   FORM FEED: #                      PAGE LENGTH: 256
   BACK SPACE: $C(8)                 OPEN EXECUTE: S XMREC="R X#255:1"
   CLOSE EXECUTE: U IO:(::0) D ^XMAPHOST,READ^XMAPHOST K XMIO Q
   DESCRIPTION: Special terminal type used only for P-MESSAGE-HFS device
 
 Select TERMINAL TYPE NAME:
 
 **********************
 
 

Routine Information:
====================

=============================================================================
User Information:                               
Entered By  : CHAN,ALAN                      Date Entered : AUG 30, 1995
Completed By: FORT,WALLY                    Date Completed : SEP 01, 1995
Verified By : NGUYEN,TRUNG V               Date Verified : SEP 05, 1995
=============================================================================


Packman Mail Message:
=====================

No routines included
