Released GMTS*2.7*56 SEQ #53
Extracted from mail message
**KIDS**:GMTS*2.7*56^

**INSTALL NAME**
GMTS*2.7*56
"BLD",3685,0)
GMTS*2.7*56^HEALTH SUMMARY^0^3020827^y
"BLD",3685,1,0)
^^2^2^3020516^
"BLD",3685,1,1,0)
The description of this build is found in the National Patch Module under 
"BLD",3685,1,2,0)
patch GMTS*2.7*56.
"BLD",3685,4,0)
^9.64PA^^
"BLD",3685,"INIT")
POST^GMTSP56
"BLD",3685,"KRN",0)
^9.67PA^8989.52^19
"BLD",3685,"KRN",.4,0)
.4
"BLD",3685,"KRN",.401,0)
.401
"BLD",3685,"KRN",.402,0)
.402
"BLD",3685,"KRN",.403,0)
.403
"BLD",3685,"KRN",.5,0)
.5
"BLD",3685,"KRN",.84,0)
.84
"BLD",3685,"KRN",3.6,0)
3.6
"BLD",3685,"KRN",3.8,0)
3.8
"BLD",3685,"KRN",9.2,0)
9.2
"BLD",3685,"KRN",9.8,0)
9.8
"BLD",3685,"KRN",9.8,"NM",0)
^9.68A^61^61
"BLD",3685,"KRN",9.8,"NM",1,0)
GMTSRM^^0^B15567698
"BLD",3685,"KRN",9.8,"NM",2,0)
GMTSXAW3^^0^B39972203
"BLD",3685,"KRN",9.8,"NM",3,0)
GMTSLRBE^^0^B4353205
"BLD",3685,"KRN",9.8,"NM",4,0)
GMTSLRCE^^0^B9938328
"BLD",3685,"KRN",9.8,"NM",5,0)
GMTSLREE^^0^B12298606
"BLD",3685,"KRN",9.8,"NM",6,0)
GMTSLRME^^0^B24937166
"BLD",3685,"KRN",9.8,"NM",7,0)
GMTSLRPE^^0^B9094292
"BLD",3685,"KRN",9.8,"NM",8,0)
GMTSLRTE^^0^B2568562
"BLD",3685,"KRN",9.8,"NM",9,0)
GMTSLTR^^0^B4398379
"BLD",3685,"KRN",9.8,"NM",10,0)
GMTSMAG^^0^B1724868
"BLD",3685,"KRN",9.8,"NM",11,0)
GMTSMAGE^^0^B2220073
"BLD",3685,"KRN",9.8,"NM",12,0)
GMTSRI^^0^B631350
"BLD",3685,"KRN",9.8,"NM",13,0)
GMTSRAD^^0^B17956816
"BLD",3685,"KRN",9.8,"NM",14,0)
GMTSONE^^0^B67474183
"BLD",3685,"KRN",9.8,"NM",15,0)
GMTSPDX^^0^B23710456
"BLD",3685,"KRN",9.8,"NM",16,0)
GMTSPNJ^^0^B12013409
"BLD",3685,"KRN",9.8,"NM",17,0)
GMTSPNSL^^0^B2225185
"BLD",3685,"KRN",9.8,"NM",18,0)
GMTSPSG^^0^B4106385
"BLD",3685,"KRN",9.8,"NM",19,0)
GMTSPSG5^^0^B3870430
"BLD",3685,"KRN",9.8,"NM",20,0)
GMTSMCPS^^0^B20672813
"BLD",3685,"KRN",9.8,"NM",21,0)
GMTSPCD^^0^B7068645
"BLD",3685,"KRN",9.8,"NM",22,0)
GMTSPSI^^0^B7392552
"BLD",3685,"KRN",9.8,"NM",23,0)
GMTSPSI5^^0^B7099452
"BLD",3685,"KRN",9.8,"NM",24,0)
GMTSPSO^^0^B10468590
"BLD",3685,"KRN",9.8,"NM",25,0)
GMTSPSO7^^0^B8701124
"BLD",3685,"KRN",9.8,"NM",26,0)
GMTSPXEP^^0^B10654385
"BLD",3685,"KRN",9.8,"NM",27,0)
GMTSPXFP^^0^B7002658
"BLD",3685,"KRN",9.8,"NM",28,0)
GMTSPXHP^^0^B757209
"BLD",3685,"KRN",9.8,"NM",29,0)
GMTSPXHR^^0^B9070396
"BLD",3685,"KRN",9.8,"NM",30,0)
GMTSPXIM^^0^B6355325
"BLD",3685,"KRN",9.8,"NM",31,0)
GMTSPXM^^0^B2143554
"BLD",3685,"KRN",9.8,"NM",32,0)
GMTSPXMP^^0^B8188664
"BLD",3685,"KRN",9.8,"NM",33,0)
GMTSPXSK^^0^B5659745
"BLD",3685,"KRN",9.8,"NM",34,0)
GMTSPXTP^^0^B9399666
"BLD",3685,"KRN",9.8,"NM",35,0)
GMTSPXU2^^0^B18783308
"BLD",3685,"KRN",9.8,"NM",36,0)
GMTSPXXP^^0^B5232936
"BLD",3685,"KRN",9.8,"NM",37,0)
GMTSRM1A^^0^B3970206
"BLD",3685,"KRN",9.8,"NM",38,0)
GMTSRM3^^0^B12155047
"BLD",3685,"KRN",9.8,"NM",39,0)
GMTSRM4^^0^B3045155
"BLD",3685,"KRN",9.8,"NM",40,0)
GMTSRN^^0^B7240616
"BLD",3685,"KRN",9.8,"NM",41,0)
GMTSSOWK^^0^B662018
"BLD",3685,"KRN",9.8,"NM",42,0)
GMTSU2^^0^B11984535
"BLD",3685,"KRN",9.8,"NM",43,0)
GMTSUIX^^0^B17986625
"BLD",3685,"KRN",9.8,"NM",44,0)
GMTSULT2^^0^B37575453
"BLD",3685,"KRN",9.8,"NM",45,0)
GMTSULT3^^0^B23011840
"BLD",3685,"KRN",9.8,"NM",46,0)
GMTSULT4^^0^B33394695
"BLD",3685,"KRN",9.8,"NM",47,0)
GMTSULT5^^0^B18612972
"BLD",3685,"KRN",9.8,"NM",48,0)
GMTSULT6^^0^B27875136
"BLD",3685,"KRN",9.8,"NM",49,0)
GMTSUMX2^^0^B70905867
"BLD",3685,"KRN",9.8,"NM",50,0)
GMTSXPD1^^0^B58717118
"BLD",3685,"KRN",9.8,"NM",51,0)
GMTSXPD2^^0^B3819654
"BLD",3685,"KRN",9.8,"NM",52,0)
GMTSXPD4^^0^B44851483
"BLD",3685,"KRN",9.8,"NM",53,0)
GMTSXPD5^^0^B5380825
"BLD",3685,"KRN",9.8,"NM",54,0)
GMTSXPS1^^0^B71832095
"BLD",3685,"KRN",9.8,"NM",55,0)
GMTSXPS2^^0^B15757651
"BLD",3685,"KRN",9.8,"NM",56,0)
GMTSDEM^^0^B36644893
"BLD",3685,"KRN",9.8,"NM",57,0)
GMTSDEM2^^0^B36189740
"BLD",3685,"KRN",9.8,"NM",58,0)
GMTSDEMB^^0^B12998593
"BLD",3685,"KRN",9.8,"NM",59,0)
GMTSDEMP^^0^B20806459
"BLD",3685,"KRN",9.8,"NM",60,0)
GMTSU^^0^B52384100
"BLD",3685,"KRN",9.8,"NM",61,0)
GMTSUP^^0^B35274216
"BLD",3685,"KRN",9.8,"NM","B","GMTSDEM",56)

"BLD",3685,"KRN",9.8,"NM","B","GMTSDEM2",57)

"BLD",3685,"KRN",9.8,"NM","B","GMTSDEMB",58)

"BLD",3685,"KRN",9.8,"NM","B","GMTSDEMP",59)

"BLD",3685,"KRN",9.8,"NM","B","GMTSLRBE",3)

"BLD",3685,"KRN",9.8,"NM","B","GMTSLRCE",4)

"BLD",3685,"KRN",9.8,"NM","B","GMTSLREE",5)

"BLD",3685,"KRN",9.8,"NM","B","GMTSLRME",6)

"BLD",3685,"KRN",9.8,"NM","B","GMTSLRPE",7)

"BLD",3685,"KRN",9.8,"NM","B","GMTSLRTE",8)

"BLD",3685,"KRN",9.8,"NM","B","GMTSLTR",9)

"BLD",3685,"KRN",9.8,"NM","B","GMTSMAG",10)

"BLD",3685,"KRN",9.8,"NM","B","GMTSMAGE",11)

"BLD",3685,"KRN",9.8,"NM","B","GMTSMCPS",20)

"BLD",3685,"KRN",9.8,"NM","B","GMTSONE",14)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPCD",21)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPDX",15)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPNJ",16)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPNSL",17)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPSG",18)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPSG5",19)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPSI",22)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPSI5",23)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPSO",24)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPSO7",25)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXEP",26)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXFP",27)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXHP",28)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXHR",29)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXIM",30)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXM",31)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXMP",32)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXSK",33)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXTP",34)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXU2",35)

"BLD",3685,"KRN",9.8,"NM","B","GMTSPXXP",36)

"BLD",3685,"KRN",9.8,"NM","B","GMTSRAD",13)

"BLD",3685,"KRN",9.8,"NM","B","GMTSRI",12)

"BLD",3685,"KRN",9.8,"NM","B","GMTSRM",1)

"BLD",3685,"KRN",9.8,"NM","B","GMTSRM1A",37)

"BLD",3685,"KRN",9.8,"NM","B","GMTSRM3",38)

"BLD",3685,"KRN",9.8,"NM","B","GMTSRM4",39)

"BLD",3685,"KRN",9.8,"NM","B","GMTSRN",40)

"BLD",3685,"KRN",9.8,"NM","B","GMTSSOWK",41)

"BLD",3685,"KRN",9.8,"NM","B","GMTSU",60)

"BLD",3685,"KRN",9.8,"NM","B","GMTSU2",42)

"BLD",3685,"KRN",9.8,"NM","B","GMTSUIX",43)

"BLD",3685,"KRN",9.8,"NM","B","GMTSULT2",44)

"BLD",3685,"KRN",9.8,"NM","B","GMTSULT3",45)

"BLD",3685,"KRN",9.8,"NM","B","GMTSULT4",46)

"BLD",3685,"KRN",9.8,"NM","B","GMTSULT5",47)

"BLD",3685,"KRN",9.8,"NM","B","GMTSULT6",48)

"BLD",3685,"KRN",9.8,"NM","B","GMTSUMX2",49)

"BLD",3685,"KRN",9.8,"NM","B","GMTSUP",61)

"BLD",3685,"KRN",9.8,"NM","B","GMTSXAW3",2)

"BLD",3685,"KRN",9.8,"NM","B","GMTSXPD1",50)

"BLD",3685,"KRN",9.8,"NM","B","GMTSXPD2",51)

"BLD",3685,"KRN",9.8,"NM","B","GMTSXPD4",52)

"BLD",3685,"KRN",9.8,"NM","B","GMTSXPD5",53)

"BLD",3685,"KRN",9.8,"NM","B","GMTSXPS1",54)

"BLD",3685,"KRN",9.8,"NM","B","GMTSXPS2",55)

"BLD",3685,"KRN",19,0)
19
"BLD",3685,"KRN",19,"NM",0)
^9.68A^^
"BLD",3685,"KRN",19.1,0)
19.1
"BLD",3685,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",3685,"KRN",101,0)
101
"BLD",3685,"KRN",409.61,0)
409.61
"BLD",3685,"KRN",771,0)
771
"BLD",3685,"KRN",870,0)
870
"BLD",3685,"KRN",8989.51,0)
8989.51
"BLD",3685,"KRN",8989.52,0)
8989.52
"BLD",3685,"KRN",8994,0)
8994
"BLD",3685,"KRN","B",.4,.4)

"BLD",3685,"KRN","B",.401,.401)

"BLD",3685,"KRN","B",.402,.402)

"BLD",3685,"KRN","B",.403,.403)

"BLD",3685,"KRN","B",.5,.5)

"BLD",3685,"KRN","B",.84,.84)

"BLD",3685,"KRN","B",3.6,3.6)

"BLD",3685,"KRN","B",3.8,3.8)

"BLD",3685,"KRN","B",9.2,9.2)

"BLD",3685,"KRN","B",9.8,9.8)

"BLD",3685,"KRN","B",19,19)

"BLD",3685,"KRN","B",19.1,19.1)

"BLD",3685,"KRN","B",101,101)

"BLD",3685,"KRN","B",409.61,409.61)

"BLD",3685,"KRN","B",771,771)

"BLD",3685,"KRN","B",870,870)

"BLD",3685,"KRN","B",8989.51,8989.51)

"BLD",3685,"KRN","B",8989.52,8989.52)

"BLD",3685,"KRN","B",8994,8994)

"BLD",3685,"QUES",0)
^9.62^^
"BLD",3685,"REQB",0)
^9.611^8^8
"BLD",3685,"REQB",1,0)
GMTS*2.7*16^2
"BLD",3685,"REQB",2,0)
GMTS*2.7*26^2
"BLD",3685,"REQB",3,0)
GMTS*2.7*37^2
"BLD",3685,"REQB",4,0)
GMTS*2.7*45^2
"BLD",3685,"REQB",5,0)
GMTS*2.7*46^2
"BLD",3685,"REQB",6,0)
GMTS*2.7*49^2
"BLD",3685,"REQB",7,0)
GMTS*2.7*54^2
"BLD",3685,"REQB",8,0)
GMTS*2.7*55^2
"BLD",3685,"REQB","B","GMTS*2.7*16",1)

"BLD",3685,"REQB","B","GMTS*2.7*26",2)

"BLD",3685,"REQB","B","GMTS*2.7*37",3)

"BLD",3685,"REQB","B","GMTS*2.7*45",4)

"BLD",3685,"REQB","B","GMTS*2.7*46",5)

"BLD",3685,"REQB","B","GMTS*2.7*49",6)

"BLD",3685,"REQB","B","GMTS*2.7*54",7)

"BLD",3685,"REQB","B","GMTS*2.7*55",8)

"INIT")
POST^GMTSP56
"MBREQ")
0
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools^^^3010208
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2951020^11
"PKG",126,22,1,"PAH",1,0)
56^3020827^1118
"PKG",126,22,1,"PAH",1,1,0)
^^2^2^3020827
"PKG",126,22,1,"PAH",1,1,1,0)
The description of this build is found in the National Patch Module under 
"PKG",126,22,1,"PAH",1,1,2,0)
patch GMTS*2.7*56.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
62
"RTN","GMTSDEM")
0^56^B36644893
"RTN","GMTSDEM",1,0)
GMTSDEM ; SLC/DLT,KER - Demographics ; 08/27/2002
"RTN","GMTSDEM",2,0)
 ;;2.7;Health Summary;**28,49,55,56**;Oct 20, 1995
"RTN","GMTSDEM",3,0)
 ;                 
"RTN","GMTSDEM",4,0)
 ; External References
"RTN","GMTSDEM",5,0)
 ;   DBIA 10061  OAD^VADPT
"RTN","GMTSDEM",6,0)
 ;   DBIA 10061  OPD^VADPT
"RTN","GMTSDEM",7,0)
 ;   DBIA 10061  SVC^VADPT
"RTN","GMTSDEM",8,0)
 ;   DBIA 10061  ADD^VADPT
"RTN","GMTSDEM",9,0)
 ;   DBIA 10061  DEM^VADPT
"RTN","GMTSDEM",10,0)
 ;   DBIA 10061  ELIG^VADPT
"RTN","GMTSDEM",11,0)
 ;   DBIA  2967  ^DIC(31,
"RTN","GMTSDEM",12,0)
 ;   DBIA 10035  ^DPT( (file #2)
"RTN","GMTSDEM",13,0)
 ;                     
"RTN","GMTSDEM",14,0)
DEMOG ; Demographic (VADPT)
"RTN","GMTSDEM",15,0)
 N I,VA,VADM,VAERR,VAOA,VASV,VAPA,VAPD,VAEL,SCD,SCDS,SCDP,FROM,GMI,TO,IX,X,Z
"RTN","GMTSDEM",16,0)
 D ADR,PER,SVC,BOS,COMB,ELIG,SC,SCDD,MT
"RTN","GMTSDEM",17,0)
 D NOK^GMTSDEM2,CD^GMTSDEMP(+($G(DFN)))
"RTN","GMTSDEM",18,0)
 D INS^GMTSDEM2,TF^GMTSDEMB(+($G(DFN)))
"RTN","GMTSDEM",19,0)
 D SRC^GMTSDEMB,END
"RTN","GMTSDEM",20,0)
 Q
"RTN","GMTSDEM",21,0)
DEMO(DFN) ;
"RTN","GMTSDEM",22,0)
 K ^TMP("GMTSDEMO",$J,+($G(DFN)))
"RTN","GMTSDEM",23,0)
 N GMTSDEMX,I,VA,VADM,VAERR,VAOA,VASV,VAPA,VAPD,VAEL,SCD,SCDS,SCDP,FROM,GMI,TO,IX,X,Z
"RTN","GMTSDEM",24,0)
 S GMTSDEMX="" D DEMOG D:$D(GMTSTEST) ST
"RTN","GMTSDEM",25,0)
 Q
"RTN","GMTSDEM",26,0)
ADR ; Patient Address
"RTN","GMTSDEM",27,0)
 Q:$D(GMTSQIT)  D:$D(GMTSDEMX) NAM Q:$D(GMTSQIT)  N %,%H,VA,VAPA,VAERR D ADD^VADPT
"RTN","GMTSDEM",28,0)
 D WRT("Address",$S($L(VAPA(1)):VAPA(1),1:"Not available"),"Phone",VAPA(8),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM",29,0)
 I VAPA(2)'="" D WRT(($J("",21)_VAPA(2)),,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEM",30,0)
 I VAPA(3)'="" D WRT(($J("",21)_VAPA(3)),,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEM",31,0)
 I VAPA(4)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",32,0)
 . N STR S STR=VAPA(4)_", " S:VAPA(5)'="" STR=STR_$P($G(VAPA(5)),"^",2)_"  "
"RTN","GMTSDEM",33,0)
 . S:VAPA(6)'="" STR=STR_VAPA(6) D WRT("",STR,"County",$P(VAPA(7),"^",2),1)
"RTN","GMTSDEM",34,0)
 D WRT(" ",,,,0)
"RTN","GMTSDEM",35,0)
 Q
"RTN","GMTSDEM",36,0)
NAM ; Name/SSN/DOB/Sex
"RTN","GMTSDEM",37,0)
 N VAPTYP,VAHOW,VAROUT,VADM D DEM^VADPT
"RTN","GMTSDEM",38,0)
 D WRT("Name",$G(VADM(1)),"SSN",$E($P($G(VADM(2)),"^",2),1,11),1)
"RTN","GMTSDEM",39,0)
 D WRT("Date of Birth",$$EDT^GMTSU($P($G(VADM(3)),"^",1)),,,1)
"RTN","GMTSDEM",40,0)
 Q
"RTN","GMTSDEM",41,0)
PER ; Personal
"RTN","GMTSDEM",42,0)
 Q:$D(GMTSQIT)  N %,%H,VA,VADM,VAERR,VAPD D DEM^VADPT,OPD^VADPT
"RTN","GMTSDEM",43,0)
 I VADM(10)'=""!(VADM(4)'="") D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",44,0)
 . D WRT("Marital Status",$P($G(VADM(10)),"^",2),"Age",$P($G(VADM(4)),"^",1),1)
"RTN","GMTSDEM",45,0)
 I VADM(9)'=""!(VADM(5)'="") D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",46,0)
 . D WRT("Religion",$P($G(VADM(9)),"^",2),"Sex",$P($G(VADM(5)),"^",2),1)
"RTN","GMTSDEM",47,0)
 I VAPD(6)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",48,0)
 . D WRT("Occupation",$P($G(VAPD(6)),"^",1),,,1)
"RTN","GMTSDEM",49,0)
 Q
"RTN","GMTSDEM",50,0)
SVC ; Service
"RTN","GMTSDEM",51,0)
 Q:$D(GMTSQIT)  N %,%H,VAEL,VAERR D ELIG^VADPT
"RTN","GMTSDEM",52,0)
 I $P(VAEL(2),"^",1) D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",53,0)
 . D WRT("Period of Service",$P($G(VAEL(2)),"^",2),,,1)
"RTN","GMTSDEM",54,0)
 Q
"RTN","GMTSDEM",55,0)
BOS ; Branch of Service
"RTN","GMTSDEM",56,0)
 Q:$D(GMTSQIT)  N %,%H,VAEL,VAERR,VASV,GMTSI,FROM,TO
"RTN","GMTSDEM",57,0)
 D SVC^VADPT F GMTSI=6,7,8 D
"RTN","GMTSDEM",58,0)
 . Q:'$D(VASV(GMTSI))  Q:+(VASV(GMTSI))=0
"RTN","GMTSDEM",59,0)
 . S FROM=$$EDT^GMTSU($P(VASV(GMTSI,4),U,1))
"RTN","GMTSDEM",60,0)
 . S TO=$$EDT^GMTSU($P(VASV(GMTSI,5),U,1))
"RTN","GMTSDEM",61,0)
 . S:$L(FROM)&('$L(TO)) TO="UNKNOWN"
"RTN","GMTSDEM",62,0)
 . D:GMTSI=6 WRT("Branch of Service",($P(VASV(GMTSI,1),U,2)_" "_FROM_" TO "_TO),,,1)
"RTN","GMTSDEM",63,0)
 . D:GMTSI'=6 WRT("",($P(VASV(GMTSI,1),U,2)_" "_FROM_" TO "_TO),,,1)
"RTN","GMTSDEM",64,0)
 Q
"RTN","GMTSDEM",65,0)
COMB ; Service Connected Disabilities
"RTN","GMTSDEM",66,0)
 Q:$D(GMTSQIT)  N %,%H,VAEL,VAERR,VASV D ELIG^VADPT,SVC^VADPT
"RTN","GMTSDEM",67,0)
 I $P(VAEL(2),U) D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",68,0)
 . D WRT("Combat",$S(VASV(5):"YES",1:"NO"),"POW",$S(VASV(4):"YES",1:"NO"),1)
"RTN","GMTSDEM",69,0)
 Q
"RTN","GMTSDEM",70,0)
ELIG ; Eligibility
"RTN","GMTSDEM",71,0)
 Q:$D(GMTSQIT)  N Z,I,%,%H,VAEL,VAERR D ELIG^VADPT
"RTN","GMTSDEM",72,0)
 I $P(VAEL(1),"^",1) D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",73,0)
 . D WRT("Eligibility",$P(VAEL(1),"^",2),$S(VAEL(8)'="":"Status",1:""),$P(VAEL(8),"^",2),1)
"RTN","GMTSDEM",74,0)
 I $O(VAEL(1,0)) D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",75,0)
 . S I=0 F Z=0:0 D  Q:$D(GMTSQIT)  Q:I=""
"RTN","GMTSDEM",76,0)
 . . Q:$D(GMTSQIT)  S I=$O(VAEL(1,I)) Q:I=""
"RTN","GMTSDEM",77,0)
 . . D WRT("",$P(VAEL(1,I),"^",2),,,1)
"RTN","GMTSDEM",78,0)
 Q
"RTN","GMTSDEM",79,0)
SC ; Service Connected Percent
"RTN","GMTSDEM",80,0)
 Q:$D(GMTSQIT)  N %,%H,VAEL,VAERR D ELIG^VADPT
"RTN","GMTSDEM",81,0)
 D:VAEL(3) WRT("S/C %",$P(VAEL(3),"^",2),,,1)
"RTN","GMTSDEM",82,0)
 Q
"RTN","GMTSDEM",83,0)
SCDD ; Service Connected Disabilities/Diagnosis
"RTN","GMTSDEM",84,0)
 Q:$D(GMTSQIT)  N SCD,SCDP,SCDS,IX,GMTSC S (IX,GMTSC)=0
"RTN","GMTSDEM",85,0)
 F  S IX=$O(^DPT(DFN,.372,IX)) Q:$D(GMTSQIT)  Q:+IX=0  D SCDP  Q:$D(GMTSQIT)
"RTN","GMTSDEM",86,0)
 Q
"RTN","GMTSDEM",87,0)
SCDP ; Service Connected Diagnosis
"RTN","GMTSDEM",88,0)
 Q:$D(GMTSQIT)  N SCD,SCDS,SCDP S SCD=^DPT(DFN,.372,IX,0)
"RTN","GMTSDEM",89,0)
 S SCDS=$S($P(SCD,"^",1):$P(^DIC(31,$P(SCD,"^",1),0),"^",1),1:"")
"RTN","GMTSDEM",90,0)
 S SCDP=$P(SCD,"^",2)_"% "_$S($P(SCD,"^",3):"SC",1:"")
"RTN","GMTSDEM",91,0)
 S GMTSC=+($G(GMTSC))+1
"RTN","GMTSDEM",92,0)
 I +($G(GMTSC))'>1 D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",93,0)
 . S STR="   S/C Disabilities: "_SCDS,STR=STR_$J("",(61-$L(STR)))_SCDP
"RTN","GMTSDEM",94,0)
 . D WRT(STR,,,,0)
"RTN","GMTSDEM",95,0)
 I +($G(GMTSC))>1 D
"RTN","GMTSDEM",96,0)
 . S STR=$J("",21)_SCDS,STR=STR_$J("",(61-$L(STR)))_SCDP
"RTN","GMTSDEM",97,0)
 . D WRT(STR,,,,0)
"RTN","GMTSDEM",98,0)
 Q
"RTN","GMTSDEM",99,0)
MT ; Means Test
"RTN","GMTSDEM",100,0)
 Q:$D(GMTSQIT)  N %,%H,VAEL,VAERR D ELIG^VADPT
"RTN","GMTSDEM",101,0)
 D:VAEL(9)'="" WRT("Means Test",$P(VAEL(9),"^",2),,,1)
"RTN","GMTSDEM",102,0)
 Q
"RTN","GMTSDEM",103,0)
NOK ; Next of Kin
"RTN","GMTSDEM",104,0)
 Q:$D(GMTSQIT)  N %,%H,VAOA S VAOA("A")=1 D OAD^VADPT
"RTN","GMTSDEM",105,0)
 Q:VAOA(9)=""  I VAOA(9)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",106,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEM",107,0)
 . W ?16,"NOK: ",VAOA(9)
"RTN","GMTSDEM",108,0)
 . W:VAOA(10)'="" ?51,"Relation: ",VAOA(10) W !
"RTN","GMTSDEM",109,0)
 I VAOA(1)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",110,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEM",111,0)
 . W:VAOA(1)]"" ?21,VAOA(1)
"RTN","GMTSDEM",112,0)
 . W:VAOA(8)'="" ?54,"Phone: ",VAOA(8) W !
"RTN","GMTSDEM",113,0)
 I VAOA(2)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",114,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(2),!
"RTN","GMTSDEM",115,0)
 I VAOA(3)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",116,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAOA(3),!
"RTN","GMTSDEM",117,0)
 I VAOA(4)'="" D  Q:$D(GMTSQIT)
"RTN","GMTSDEM",118,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDEM",119,0)
 . W ?21,VAOA(4) W:VAOA(5) ", ",$P(VAOA(5),U,2)
"RTN","GMTSDEM",120,0)
 . W:VAOA(6) "  ",VAOA(6) W !
"RTN","GMTSDEM",121,0)
 Q
"RTN","GMTSDEM",122,0)
IEN ; Ineligible for Care Data
"RTN","GMTSDEM",123,0)
 Q:$D(GMTSQIT)  N STR,REM,WRD,%,%H,VAEL,VAERR,GMTSDT D ELIG^VADPT
"RTN","GMTSDEM",124,0)
 I +($P(VAEL(5,1),U,1))>0 D
"RTN","GMTSDEM",125,0)
 . S GMTSDT=$$EDT^GMTSU($P(VAEL(5,1),U,1))
"RTN","GMTSDEM",126,0)
 . Q:$D(GMTSQIT)  D WRT("Ineligible date",GMTSDT,,,1)
"RTN","GMTSDEM",127,0)
 . Q:$D(GMTSQIT)  S STR=$P(VAEL(5,2),U,2)_"  "_VAEL(5,3)_", "_$P(VAEL(5,4),U,2)
"RTN","GMTSDEM",128,0)
 . D WRT("Inelig. TWX source",STR,,,1)
"RTN","GMTSDEM",129,0)
 . Q:$D(GMTSQIT)  S STR=$G(VAEL(5,5))
"RTN","GMTSDEM",130,0)
 . F WRD=1:1 Q:$L(STR)'>58  D
"RTN","GMTSDEM",131,0)
 . . S REM=$P(STR," ",($L(STR," ")-WRD),$L(STR," "))
"RTN","GMTSDEM",132,0)
 . . S STR=$P(STR," ",1,($L(STR," ")-(WRD+1)))
"RTN","GMTSDEM",133,0)
 . D:$L(STR) WRT(($J("",21)_STR),,,,0)
"RTN","GMTSDEM",134,0)
 . D:$L(REM) WRT(($J("",21)_REM),,,,0)
"RTN","GMTSDEM",135,0)
 . D:$L(VAEL(5,6)) WRT("Reason",$E(VAEL(5,6),1,58),,,1)
"RTN","GMTSDEM",136,0)
 Q
"RTN","GMTSDEM",137,0)
 ;                      
"RTN","GMTSDEM",138,0)
WRT(CH1,CD1,CH2,CD2,FMT) ; Write/Save Demographic Line
"RTN","GMTSDEM",139,0)
 ;          
"RTN","GMTSDEM",140,0)
 ;   Input
"RTN","GMTSDEM",141,0)
 ;     CH1 - Column 1 Header or Preformated Line
"RTN","GMTSDEM",142,0)
 ;     CD1 - Column 1 Data
"RTN","GMTSDEM",143,0)
 ;     CH2 - Column 2 Header
"RTN","GMTSDEM",144,0)
 ;     CD2 - Column 2 Data
"RTN","GMTSDEM",145,0)
 ;     FMT - Format in Columns  1=Yes 0=No
"RTN","GMTSDEM",146,0)
 ;          
"RTN","GMTSDEM",147,0)
 ;   If the variable GMTSDEMX exist, then the data will 
"RTN","GMTSDEM",148,0)
 ;   be saved in a global array instead of written to the
"RTN","GMTSDEM",149,0)
 ;   screen.  Global array:
"RTN","GMTSDEM",150,0)
 ;          
"RTN","GMTSDEM",151,0)
 ;     ^TMP("GMTSDEMO",$J,DFN,#)=<demographic text>
"RTN","GMTSDEM",152,0)
 Q:$D(GMTSQIT)  N STR,BL,COL1,COL2,LN
"RTN","GMTSDEM",153,0)
 S LN=+($O(^TMP("GMTSDEMO",$J,+($G(DFN))," "),-1))+1,CH1=$G(CH1),CD1=$G(CD1),CH2=$G(CH2),CD2=$G(CD2),FMT=$G(FMT)
"RTN","GMTSDEM",154,0)
 S:+FMT'>0 STR=CH1
"RTN","GMTSDEM",155,0)
 I +FMT>0 D
"RTN","GMTSDEM",156,0)
 . S BL=$J("",(19-$L(CH1))),CH1=BL_CH1_$S($L(CH1)>0:": ",1:"  ")
"RTN","GMTSDEM",157,0)
 . S BL=$J("",(((59-$L(CH1))-$L(CH2))-2))
"RTN","GMTSDEM",158,0)
 . S CD1=$E(CD1,1,$L(BL)),COL1=CH1_CD1
"RTN","GMTSDEM",159,0)
 . S BL=$J("",((59-$L(COL1))-$L(CH2)))
"RTN","GMTSDEM",160,0)
 . S CH2=BL_CH2_$S($L(CH2)>0:": ",1:"  "),COL2=CH2_$E(CD2,1,17)
"RTN","GMTSDEM",161,0)
 . S STR=COL1_COL2
"RTN","GMTSDEM",162,0)
 I '$D(GMTSDEMX) D CKP^GMTSUP Q:$D(GMTSQIT)  W $G(STR),!
"RTN","GMTSDEM",163,0)
 S:$D(GMTSDEMX) ^TMP("GMTSDEMO",$J,+($G(DFN)),LN)=STR
"RTN","GMTSDEM",164,0)
 Q
"RTN","GMTSDEM",165,0)
 ;                        
"RTN","GMTSDEM",166,0)
ST ; Show ^TMP Global Array
"RTN","GMTSDEM",167,0)
 W !! N NN,NC S NN="^TMP(""GMTSDEMO"","_$J_","_+($G(DFN))_")",NC="^TMP(""GMTSDEMO"","_$J_","_+($G(DFN))_"," F  S NN=$Q(@NN) Q:NN=""!(NN'[NC)  W !,@NN
"RTN","GMTSDEM",168,0)
 Q
"RTN","GMTSDEM",169,0)
END ; Clean-up and quit
"RTN","GMTSDEM",170,0)
 K I,VA,VADM,VAERR,VAOA,VASV,VAPA,VAPD,VAEL,SCD,SCDS,SCDP,FROM
"RTN","GMTSDEM",171,0)
 K GMI,TO,IX,X,Z Q
"RTN","GMTSDEM2")
0^57^B36189740
"RTN","GMTSDEM2",1,0)
GMTSDEM2 ; SLC/DLT,KER - Demographics (cont) ; 08/27/2002
"RTN","GMTSDEM2",2,0)
 ;;2.7;Health Summary;**56**;Oct 20, 1995
"RTN","GMTSDEM2",3,0)
 ;                 
"RTN","GMTSDEM2",4,0)
 ; External References
"RTN","GMTSDEM2",5,0)
 ;   DBIA 10061  OAD^VADPT
"RTN","GMTSDEM2",6,0)
 ;   DBIA   951  ^IBE(355.1
"RTN","GMTSDEM2",7,0)
 ;   DBIA   794  ^DIC(36
"RTN","GMTSDEM2",8,0)
 ;   DBIA  2056  $$GET1^DIQ (file #36, and #355.1)
"RTN","GMTSDEM2",9,0)
 ;   DBIA 10145  ALL^IBCNS1  
"RTN","GMTSDEM2",10,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSDEM2",11,0)
 ;                     
"RTN","GMTSDEM2",12,0)
NOK ; Next of Kin
"RTN","GMTSDEM2",13,0)
 Q:$D(GMTSQIT)  N %,%H,STR,STR1,STR2,NOKTYPE,ADR,VAERR,VAOA K VAOA("A") D OAD^VADPT
"RTN","GMTSDEM2",14,0)
 I $L($G(VAOA(9))) D
"RTN","GMTSDEM2",15,0)
 . ;   Primary Next of Kin
"RTN","GMTSDEM2",16,0)
 . S NOKTYPE="Primary" D DNOK
"RTN","GMTSDEM2",17,0)
 . S VAOA("A")=3 D OAD^VADPT
"RTN","GMTSDEM2",18,0)
 . I $L($G(VAOA(9))) D
"RTN","GMTSDEM2",19,0)
 . . ;   Secondary Next of Kin
"RTN","GMTSDEM2",20,0)
 . . S NOKTYPE="Secondary" D DNOK
"RTN","GMTSDEM2",21,0)
 Q
"RTN","GMTSDEM2",22,0)
DNOK ;   Display Next of Kin
"RTN","GMTSDEM2",23,0)
 D WRT^GMTSDEM("",,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",24,0)
 S STR1=$$UP^XLFSTR(VAOA(9)),STR2=$S('$L(VAOA(10)):"<not given>",1:$$REL($$UP^XLFSTR(VAOA(10))))
"RTN","GMTSDEM2",25,0)
 D WRT^GMTSDEM(($G(NOKTYPE)_" NOK"),STR1,"Relation",STR2,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",26,0)
 S ADR=$G(VAOA(1)) K VAOA(1) I '$L(ADR) S ADR=$G(VAOA(2)) K VAOA(2) I '$L(ADR) S ADR=$G(VAOA(3)) K VAOA(3)
"RTN","GMTSDEM2",27,0)
 S STR=$S('$L(ADR):"<street address not available>",1:$$UP^XLFSTR(ADR))
"RTN","GMTSDEM2",28,0)
 K:STR="<street address not available>" VAOA(1),VAOA(2),VAOA(3)
"RTN","GMTSDEM2",29,0)
 D WRT^GMTSDEM("",STR,"Phone",VAOA(8),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",30,0)
 S ADR=$G(VAOA(2)) K VAOA(2) I '$L(ADR) S ADR=$G(VAOA(3)) K VAOA(3)
"RTN","GMTSDEM2",31,0)
 S STR=$$UP^XLFSTR(ADR) D:$L(STR) WRT^GMTSDEM("",STR,,,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",32,0)
 S ADR=$G(VAOA(3))
"RTN","GMTSDEM2",33,0)
 S STR=$$UP^XLFSTR(ADR) D:$L(STR) WRT^GMTSDEM("",STR,,,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",34,0)
 I VAOA(4)'="" D
"RTN","GMTSDEM2",35,0)
 . S STR=$$UP^XLFSTR(VAOA(4)) S:VAOA(5) STR=STR_", "_$$UP^XLFSTR($P(VAOA(5),U,2)) S:VAOA(6) STR=STR_"  "_$$UP^XLFSTR(VAOA(6))
"RTN","GMTSDEM2",36,0)
 . D WRT^GMTSDEM("",STR,,,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",37,0)
 Q
"RTN","GMTSDEM2",38,0)
REL(X) ; Relation
"RTN","GMTSDEM2",39,0)
 S X=$$UP^XLFSTR($G(X)) Q:'$L(X)  S:X="W" X="SPOUSE" S:X="H" X="SPOUSE" S:X="B" X="BROTHER" S:X="S" X="SISTER" S:X="A" X="AUNT" S:X="U" X="UNCLE" S:X="C" X="COUSIN"
"RTN","GMTSDEM2",40,0)
 S:"WIFE"[X X="SPOUSE" S:"HUSBAND"[X X="SPOUSE" S:"NONE"[X X="NONE" S:"UNKNOWN"[X X="UNKNOWN"
"RTN","GMTSDEM2",41,0)
 S:"BROTHER"[X X="BROTHER" S:"BROTHER"'[X&("BROTHER-IN-LAW"[X) X="BROTHER-IN-LAW" S:"BROTHER"'[X&("BROTHER IN LAW"[X) X="BROTHER-IN-LAW" S:$E(X,1,3)="BRO"&("BROTHER"'[X) X="BROTHER-IN-LAW"
"RTN","GMTSDEM2",42,0)
 S:"SISTER"[X X="SISTER" S:"SISTER"'[X&("SISTER-IN-LAW"[X) X="SISTER-IN-LAW" S:"SISTER"'[X&("SISTER IN LAW"[X) X="SISTER-IN-LAW" S:$E(X,1,3)="SIS"&("SISTER"'[X) X="SISTER-IN-LAW"
"RTN","GMTSDEM2",43,0)
 S:"AUNT"[X X="AUNT" S:"UNCLE"[X X="UNCLE" S:"COUSIN"[X X="COUSIN" S:"FATHER"[X X="FATHER" S:"MOTHER"[X X="MOTHER"
"RTN","GMTSDEM2",44,0)
 S:"FATHER"'[X&("GRANDFATHER"[X) X="GRANDFATHER" S:"FATHER"'[X&("GRAND FATHER"[X) X="GRANDFATHER" S:"MOTHER"'[X&("GRANDMOTHER"[X) X="GRANDMOTHER" S:"MOTHER"'[X&("GRAND MOTHER"[X) X="GRANDMOTHER"
"RTN","GMTSDEM2",45,0)
 S:"SON"[X X="SON" S:"SON"'[X&("SON-IN-LAW"[X) X="SON-IN-LAW" S:"SON"'[X&("SON IN LAW"[X) X="SON-IN-LAW" S:$E(X,1,3)="SON"&("SON"'[X) X="SON-IN-LAW"
"RTN","GMTSDEM2",46,0)
 S:"DAUGHTER"[X X="DAUGHTER" S:"DAUGHTER"'[X&("DAUGHTER-IN-LAW"[X) X="DAUGHTER-IN-LAW" S:"DAUGHTER"'[X&("DAUGHTER IN LAW"[X) X="DAUGHTER-IN-LAW" S:$E(X,1,3)="DAU"&("DAUGHTER"'[X) X="DAUGHTER-IN-LAW"
"RTN","GMTSDEM2",47,0)
 S:"NIECE"'[X&("NIECE IN LAW"[X) X="NIECE" S:"NEPHEW"'[X&("NEPHEW IN LAW"[X) X="NEPHEW"
"RTN","GMTSDEM2",48,0)
 Q X
"RTN","GMTSDEM2",49,0)
 ;                
"RTN","GMTSDEM2",50,0)
INS ; Insuraance Info
"RTN","GMTSDEM2",51,0)
 N I,INSURE,GMTSX,IEN,VAL,CLAIM,COMPANY,TYPE,COB,SUBSCRIB,GROUP,HOLDER,EFFECT,EXPIRE
"RTN","GMTSDEM2",52,0)
 D ALL^IBCNS1(DFN,"INSURE") Q:$O(INSURE(0))=""
"RTN","GMTSDEM2",53,0)
 S I=0 F  S I=$O(INSURE(I)) Q:'I  D   Q:$D(GMTSQIT)
"RTN","GMTSDEM2",54,0)
 . S (COMPANY,TYPE,GROUP,HOLDER,EFFECT,EXPIRE)=""
"RTN","GMTSDEM2",55,0)
 . S GMTSX=INSURE(I,0),IEN=+GMTSX
"RTN","GMTSDEM2",56,0)
 . ;   Insurance Company
"RTN","GMTSDEM2",57,0)
 . S COMPANY=$$GET1^DIQ(36,(+IEN_","),.01) Q:'$L(COMPANY)
"RTN","GMTSDEM2",58,0)
 . S CLAIM=INSURE(I,355.3)
"RTN","GMTSDEM2",59,0)
 . ;   Policy Type
"RTN","GMTSDEM2",60,0)
 . S IEN=$P(CLAIM,"^",9)
"RTN","GMTSDEM2",61,0)
 . S TYPE="" I IEN]"" D
"RTN","GMTSDEM2",62,0)
 . . S TYPE=$$GET1^DIQ(355.1,(+IEN_","),.01) S TYPE=$$ABR(TYPE)
"RTN","GMTSDEM2",63,0)
 . ;   Group Number
"RTN","GMTSDEM2",64,0)
 . S GROUP=$P(CLAIM,"^",4)
"RTN","GMTSDEM2",65,0)
 . S GMTSX=INSURE(I,0),VAL=$P(GMTSX,"^",6)
"RTN","GMTSDEM2",66,0)
 . ;   Insurance Policy Holder
"RTN","GMTSDEM2",67,0)
 . S HOLDER=$S(VAL="v":"SELF",VAL="s":"SPOUSE",1:"OTHER")
"RTN","GMTSDEM2",68,0)
 . ;   Insurace Effect Date
"RTN","GMTSDEM2",69,0)
 . S EFFECT=$P(GMTSX,"^",8)
"RTN","GMTSDEM2",70,0)
 . ;   Insurance Expiration Date
"RTN","GMTSDEM2",71,0)
 . S EXPIRE=$P(GMTSX,"^",4)
"RTN","GMTSDEM2",72,0)
 . ;   Subscriber ID
"RTN","GMTSDEM2",73,0)
 . S SUBSCRIB=$P($G(INSURE(I,0)),"^",2)
"RTN","GMTSDEM2",74,0)
 . ;   Coordination of Benefits
"RTN","GMTSDEM2",75,0)
 . S COB=+($P($G(INSURE(I,0)),"^",20))
"RTN","GMTSDEM2",76,0)
 . S COB=$S(COB=1:"PRIMARY",COB=2:"SECONDARY",COB=3:"TERTIARY",1:"UNKNOWN")
"RTN","GMTSDEM2",77,0)
 . Q:$D(GMTSQIT)  D WRT^GMTSDEM("",,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",78,0)
 . D WRT^GMTSDEM("Insurance Company",$E(COMPANY,1,27),"Holder",HOLDER,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",79,0)
 . I $L(TYPE)!($L(EFFECT)) D WRT^GMTSDEM("Policy Type",$E(TYPE,1,28),"Effective",$$EDT^GMTSU(EFFECT),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",80,0)
 . I $L(GROUP)!($L(EXPIRE)) D WRT^GMTSDEM("Group #",$E(GROUP,1,28),"Expires",$$EDT^GMTSU(EXPIRE),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",81,0)
 . I $L(SUBSCRIB)!($L(COB)) D WRT^GMTSDEM("Subscriber ID",$E(SUBSCRIB,1,28),"Coord. of Benefits",COB,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",82,0)
 Q
"RTN","GMTSDEM2",83,0)
 ;          
"RTN","GMTSDEM2",84,0)
ABR(X) ; Abbreviations
"RTN","GMTSDEM2",85,0)
 S X=$$UP^XLFSTR($G(X)) N TM,AB,SID S TM="PROCEDURES",AB="PROC" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",86,0)
 S TM="SUPPLEMENTAL",AB="SUP" S:X[TM X=$$SW(X,TM,AB) S TM="ORGANIZATION",AB="ORG" S:X[TM X=$$SW(X,TM,AB) S TM="ORIGIZ",AB="ORG" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",87,0)
 S TM="ORGANIZ",AB="ORG" S:X[TM X=$$SW(X,TM,AB) S TM="MAINTENANCE",AB="MAINT" S:X[TM X=$$SW(X,TM,AB) S TM="PROVIDER",AB="PROV" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",88,0)
 S TM="INDIVIDUAL",AB="INDIVID" S:X[TM X=$$SW(X,TM,AB) S TM="ASSOCATION",AB="ASSOC" S:X[TM X=$$SW(X,TM,AB) S TM="ASSOCIATION",AB="ASSOC" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",89,0)
 S TM="PRACT",AB="PRACT" S:X[TM X=$$SW(X,TM,AB) S TM="INSURANCE",AB="INS" S:X[TM X=$$SW(X,TM,AB) S TM="ETC.",AB="ETC" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",90,0)
 S TM="(ONLY)",AB="" S:X[TM X=$$SW(X,TM,AB) S TM="PROTECTION",AB="PROT" S:X[TM X=$$SW(X,TM,AB) S TM="PRACTICE",AB="PRACT" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",91,0)
 Q X
"RTN","GMTSDEM2",92,0)
SW(X,Y,Z) ; Swap Abbreviation with Term
"RTN","GMTSDEM2",93,0)
 N TM,AB
"RTN","GMTSDEM2",94,0)
 S X=$G(X),TM=$$TRIM($G(Y)),AB=$$TRIM($G(Z)) Q:X="" ""  Q:TM="" X  Q:TM=AB X
"RTN","GMTSDEM2",95,0)
 F  Q:X'[TM  S X=$P(X,TM,1)_AB_$P(X,TM,2)
"RTN","GMTSDEM2",96,0)
 Q X
"RTN","GMTSDEM2",97,0)
TRIM(X) ; Trim Spaces
"RTN","GMTSDEM2",98,0)
 S X=$G(X) Q:X="" X F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSDEM2",99,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSDEM2",100,0)
 F  Q:X'["  "  S X=$P(X,"  ",1)_" "_$P(X,"  ",2,229)
"RTN","GMTSDEM2",101,0)
 Q X
"RTN","GMTSDEMB")
0^58^B12998593
"RTN","GMTSDEMB",1,0)
GMTSDEMB ; SLC/DLT,KER - Brief Demographic Component  ; 08/27/2002
"RTN","GMTSDEMB",2,0)
 ;;2.7;Health Summary;**29,49,55,56**;Oct 20, 1995
"RTN","GMTSDEMB",3,0)
 ;                    
"RTN","GMTSDEMB",4,0)
 ; External References
"RTN","GMTSDEMB",5,0)
 ;   DBIA  2056  $$GET1^DIQ (file #4)
"RTN","GMTSDEMB",6,0)
 ;   DBIA 10061  ADD^VADPT
"RTN","GMTSDEMB",7,0)
 ;   DBIA 10061  DEM^VADPT
"RTN","GMTSDEMB",8,0)
 ;   DBIA 10061  ELIG^VADPT
"RTN","GMTSDEMB",9,0)
 ;   DBIA  2990  TFL^VAFCTFU1
"RTN","GMTSDEMB",10,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSDEMB",11,0)
 ;   DBIA  2171  $$LKUP^XUAF4
"RTN","GMTSDEMB",12,0)
 ;                  
"RTN","GMTSDEMB",13,0)
DEMOG ; Brief Demographics (VADPT)
"RTN","GMTSDEMB",14,0)
 N I,IX,VA,VAEL,VADM,VAPA,GMTSS,GMTSOUT,GMTSR D ELIG^VADPT,ADD^VADPT,DEM^VADPT
"RTN","GMTSDEMB",15,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Address: "_$S($L(VAPA(1)):VAPA(1),1:"Not available"),?53," Phone:",?61,VAPA(8),!
"RTN","GMTSDEMB",16,0)
 I VAPA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(2),!
"RTN","GMTSDEMB",17,0)
 I VAPA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(3),!
"RTN","GMTSDEMB",18,0)
 I VAPA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(4),", ",$P(VAPA(5),"^",2),"  ",VAPA(6),!
"RTN","GMTSDEMB",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Eligibility: ",?21,$P(VAEL(1),"^",2)
"RTN","GMTSDEMB",20,0)
 I VADM(4)'="" D CKP^GMTSUP Q:$D(GMTSIT)  W ?56,"Age: ",$P(VADM(4),"^",1),!
"RTN","GMTSDEMB",21,0)
 I VAEL(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Means Test: ",$P(VAEL(9),"^",2)
"RTN","GMTSDEMB",22,0)
 I VADM(5)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Sex: ",$P(VADM(5),"^",2),!
"RTN","GMTSDEMB",23,0)
 D CD^GMTSDEMP(DFN) Q:$D(GMTSQIT)  D TF(DFN) Q:$D(GMTSQIT)  D SRC
"RTN","GMTSDEMB",24,0)
 K I,IX,VA,VAEL,VAPA
"RTN","GMTSDEMB",25,0)
 Q
"RTN","GMTSDEMB",26,0)
TF(X) ; Treating Facilities
"RTN","GMTSDEMB",27,0)
 Q:$D(GMTSQIT)  N DFN,GMTSC,GMTSDS,GMTSI,GMTSIEN,GMTSIT,GMTSS
"RTN","GMTSDEMB",28,0)
 N GMTSTA,GMTSTF,GMTSTF2,GMTSTFC,GMTSTY,GMTSTFT
"RTN","GMTSDEMB",29,0)
 S GMTSTFC=0,DFN=+($G(X)),U="^" D TFL^VAFCTFU1(.GMTSTF,+($G(DFN)))
"RTN","GMTSDEMB",30,0)
 S (GMTSLP,GMTSC,GMTSI,GMTSS)=0
"RTN","GMTSDEMB",31,0)
 F  S GMTSI=$O(GMTSTF(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSDEMB",32,0)
 . S GMTSTFT=$G(GMTSTF(GMTSI))
"RTN","GMTSDEMB",33,0)
 . S:+($G(GMTSTF(GMTSI)))=776!(+($G(GMTSTF(GMTSI)))=200) $P(GMTSTFT,"^",2)="DEPT. OF DEFENSE"
"RTN","GMTSDEMB",34,0)
 . S GMTSTF2((99999999-(+($P($P($G(GMTSTF(GMTSI)),"^",3),".",1)))),+($$LKUP^XUAF4($P($G(GMTSTF(GMTSI)),"^",2))))=GMTSTFT
"RTN","GMTSDEMB",35,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSTF2(GMTSI)) Q:+GMTSI=0  D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",36,0)
 . S GMTSIEN="" F  S GMTSIEN=$O(GMTSTF2(GMTSI,GMTSIEN)) Q:GMTSIEN=""  D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",37,0)
 . . S GMTSTA=$P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",1)
"RTN","GMTSDEMB",38,0)
 . . S GMTSIT=$P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",2) Q:'$L(GMTSIT)
"RTN","GMTSDEMB",39,0)
 . . Q:GMTSIT="NO ICN"
"RTN","GMTSDEMB",40,0)
 . . S GMTSDS=$P($P($G(GMTSTF2(GMTSI,GMTSIEN)),"^",3),".",1)
"RTN","GMTSDEMB",41,0)
 . . S:+GMTSDS>0 GMTSLP=1 S:+GMTSDS'>0 GMTSDS="",GMTSLP=0 Q:+GMTSLP=0
"RTN","GMTSDEMB",42,0)
 . . S:+GMTSDS>0 GMTSDS=$TR($$FMTE^XLFDT(GMTSDS,"5DZ"),"@"," ")
"RTN","GMTSDEMB",43,0)
 . . S:GMTSDS="" GMTSDS="--/--/----" S:+GMTSLP>0 GMTSC=GMTSC+1
"RTN","GMTSDEMB",44,0)
 . . I GMTSC=1 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",45,0)
 . . . N STR
"RTN","GMTSDEMB",46,0)
 . . . D WRT^GMTSDEM("",,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEMB",47,0)
 . . . S STR="  Treating Facility                 Type         Station     Last Seen"
"RTN","GMTSDEMB",48,0)
 . . . D WRT^GMTSDEM(STR,,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEMB",49,0)
 . . . S STR="  ----------------------------      -----------  -------     ----------"
"RTN","GMTSDEMB",50,0)
 . . . D WRT^GMTSDEM(STR,,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEMB",51,0)
 . . Q:$D(GMTSQIT)
"RTN","GMTSDEMB",52,0)
 . . S GMTSTY=$$GET1^DIQ(4,(+GMTSIEN_","),13,"E")
"RTN","GMTSDEMB",53,0)
 . . S:+GMTSTA<0 (GMTSTA,GMTSDS)=""
"RTN","GMTSDEMB",54,0)
 . . S:GMTSIT="NO ICN" GMTSIT="Not available"
"RTN","GMTSDEMB",55,0)
 . . S STR="  "_$G(GMTSIT)
"RTN","GMTSDEMB",56,0)
 . . S STR=STR_$J("",(36-$L(STR)))_$G(GMTSTY)
"RTN","GMTSDEMB",57,0)
 . . S STR=STR_$J("",(49-$L(STR)))_$J($G(GMTSTA),6)
"RTN","GMTSDEMB",58,0)
 . . S STR=STR_$J("",(61-$L(STR)))_$G(GMTSDS)
"RTN","GMTSDEMB",59,0)
 . . D WRT^GMTSDEM(STR,,,,0)
"RTN","GMTSDEMB",60,0)
 . . S GMTSTFC=GMTSTFC+1
"RTN","GMTSDEMB",61,0)
 Q
"RTN","GMTSDEMB",62,0)
SRC ; Source of Info
"RTN","GMTSDEMB",63,0)
 Q:$D(GMTSQIT)  N GMTSS,GMTSR,GMTSN,GMTST S GMTSR=0
"RTN","GMTSDEMB",64,0)
 ;   National Health Summary Type
"RTN","GMTSDEMB",65,0)
 S GMTSN=$S(+($G(^GMT(142,+($G(GMTSTYP)),"VA")))>0:1,1:0)
"RTN","GMTSDEMB",66,0)
 ;   Health Summary Type Name
"RTN","GMTSDEMB",67,0)
 S GMTST=$P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)
"RTN","GMTSDEMB",68,0)
 ;   Remote Data View HS Type
"RTN","GMTSDEMB",69,0)
 S:GMTSN>0&(GMTST["REMOTE") GMTSR=1
"RTN","GMTSDEMB",70,0)
 ;   Demographics Array
"RTN","GMTSDEMB",71,0)
 S:$D(GMTSDEMX) GMTSR=1
"RTN","GMTSDEMB",72,0)
 S GMTSS=$$SITE^GMTSU2 I GMTSR>0,$L(GMTSS) D  Q:$D(GMTSQIT)
"RTN","GMTSDEMB",73,0)
 . D WRT^GMTSDEM("",,,,0) N STR
"RTN","GMTSDEMB",74,0)
 . S STR="  Source of Info: "_GMTSS D WRT^GMTSDEM(STR,,,,0)
"RTN","GMTSDEMB",75,0)
 Q
"RTN","GMTSDEMP")
0^59^B20806459
"RTN","GMTSDEMP",1,0)
GMTSDEMP ; SLC/DLT,KER - Demographic (Providers)   ; 08/27/2002
"RTN","GMTSDEMP",2,0)
 ;;2.7;Health Summary;**55,56**;Oct 20, 1995
"RTN","GMTSDEMP",3,0)
 ;                    
"RTN","GMTSDEMP",4,0)
 ; External References
"RTN","GMTSDEMP",5,0)
 ;   DBIA 10035  ^DPT( (file #2)
"RTN","GMTSDEMP",6,0)
 ;   DBIA  2056  $$GET1^DIQ (file #4, #200 and #404.51)
"RTN","GMTSDEMP",7,0)
 ;   DBIA  1252  $$OUTPTTM^SDUTL3
"RTN","GMTSDEMP",8,0)
 ;   DBIA  1252  $$OUTPTPR^SDUTL3
"RTN","GMTSDEMP",9,0)
 ;   DBIA  1252  $$OUTPTAP^SDUTL3
"RTN","GMTSDEMP",10,0)
 ;   DBIA 10103  $$DT^XLFDT
"RTN","GMTSDEMP",11,0)
 ;                  
"RTN","GMTSDEMP",12,0)
CD(DFN) ; Clinical Demographics (Provider Info)
"RTN","GMTSDEMP",13,0)
 Q:$D(GMTSQIT)  N PAT,TEAM,TMPH,PROV,PHN,ANA,DIG,ASSP,PHN,ANA,DIG,IPRO
"RTN","GMTSDEMP",14,0)
 N LF,IPPH,IPGA,IPGD,ATTN,ATPH,APGA,APGD S LF=1,(TEAM,PROV,ASSP,IPRO,ATTN)=0
"RTN","GMTSDEMP",15,0)
 S (TMPH,PHN,ANA,DIG,PHN,ANA,DIG,IPPH,IPGA,IPGD,ATPH,APGA,APGD)=""
"RTN","GMTSDEMP",16,0)
 S:+($G(DT))=0 DT=$$DT^XLFDT
"RTN","GMTSDEMP",17,0)
 ;
"RTN","GMTSDEMP",18,0)
TEAM ; PCMM TEAM
"RTN","GMTSDEMP",19,0)
 S TEAM=$$OUTPTTM^SDUTL3(+($G(DFN)))
"RTN","GMTSDEMP",20,0)
 I +($G(TEAM))>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",21,0)
 . N PHN S PHN=$$GET1^DIQ(404.51,(+TEAM_","),.02)
"RTN","GMTSDEMP",22,0)
 . D LF Q:$D(GMTSQIT)
"RTN","GMTSDEMP",23,0)
 . S TEAM=$E($P($G(TEAM),"^",2),1,31)
"RTN","GMTSDEMP",24,0)
 . D:$L(TEAM)!($L(PHN)) WRT^GMTSDEM("PCMM Team",TEAM,"Phone",$G(PHN),1)
"RTN","GMTSDEMP",25,0)
 ;
"RTN","GMTSDEMP",26,0)
PROV ; PCMM Outpatient Provider
"RTN","GMTSDEMP",27,0)
 S PROV=$$OUTPTPR^SDUTL3(+($G(DFN))) I +PROV>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",28,0)
 . N PHN,ANA,DIG Q:'$L($P(PROV,"^",2))  S (PHN,ANA,DIG)=""
"RTN","GMTSDEMP",29,0)
 . S PHN=$$GET1^DIQ(200,(+($G(PROV))_","),.132)
"RTN","GMTSDEMP",30,0)
 . S ANA=$$GET1^DIQ(200,(+($G(PROV))_","),.137)
"RTN","GMTSDEMP",31,0)
 . S DIG=$$GET1^DIQ(200,(+($G(PROV))_","),.138)
"RTN","GMTSDEMP",32,0)
 . D LF Q:$D(GMTSQIT)
"RTN","GMTSDEMP",33,0)
 . D WRT^GMTSDEM("PCMM Provider",$E($P($G(PROV),"^",2),1,31),"Phone",$G(PHN),1)
"RTN","GMTSDEMP",34,0)
 . I $L($G(ANA)) D
"RTN","GMTSDEMP",35,0)
 . . D WRT^GMTSDEM("Analog Pager",ANA,$S($L(DIG):"Digital Pager",1:""),$S($L(DIG):DIG,1:""),1)
"RTN","GMTSDEMP",36,0)
 . I '$L($G(ANA)),$L($G(DIG)) D
"RTN","GMTSDEMP",37,0)
 . . D WRT^GMTSDEM("Digital Pager",DIG,"","",1)
"RTN","GMTSDEMP",38,0)
 ;
"RTN","GMTSDEMP",39,0)
ASSP ; PCMM Associate Provider
"RTN","GMTSDEMP",40,0)
 S ASSP=$$OUTPTAP^SDUTL3(+($G(DFN))) I +ASSP>0&(+ASSP'=+PROV) D
"RTN","GMTSDEMP",41,0)
 . N PHN,ANA,DIG S ASSP=+ASSP_"^"_$$GET1^DIQ(200,(+($G(ASSP))_","),.01)
"RTN","GMTSDEMP",42,0)
 . Q:'$L($P(ASSP,"^",2))  S (PHN,ANA,DIG)=""
"RTN","GMTSDEMP",43,0)
 . S PHN=$$GET1^DIQ(200,(+($G(ASSP))_","),.132),ANA=$$GET1^DIQ(200,(+($G(ASSP))_","),.137),DIG=$$GET1^DIQ(200,(+($G(ASSP))_","),.138)
"RTN","GMTSDEMP",44,0)
 . D LF Q:$D(GMTSQIT)  S ASSP=$E($P($G(ASSP),"^",2),1,31)
"RTN","GMTSDEMP",45,0)
 . D WRT^GMTSDEM("PCMM Assoc. Prov",ASSP,"Phone",$G(PHN),1)
"RTN","GMTSDEMP",46,0)
 . I $L($G(ANA)) D WRT^GMTSDEM("Analog Pager",ANA,$S($L(DIG):"Digital Pager",1:""),$S($L(DIG):DIG,1:""),1)
"RTN","GMTSDEMP",47,0)
 . I '$L($G(ANA)),$L($G(DIG)) D WRT^GMTSDEM("Digital Pager",DIG,"","",1)
"RTN","GMTSDEMP",48,0)
 ;
"RTN","GMTSDEMP",49,0)
IPAT ; Inpatient Provider/Attending
"RTN","GMTSDEMP",50,0)
 S ATTN=$G(^DPT(+($G(DFN)),.1041))
"RTN","GMTSDEMP",51,0)
 S IPRO=$G(^DPT(+($G(DFN)),.104)) I +IPRO>0 D
"RTN","GMTSDEMP",52,0)
 . S IPRO=+IPRO_"^"_$$GET1^DIQ(200,(+($G(IPRO))_","),.01)
"RTN","GMTSDEMP",53,0)
 . I '$L($P(IPRO,"^",2)) S IPRO=0,(IPPH,IPGA,IPGD)="" Q
"RTN","GMTSDEMP",54,0)
 . S IPPH=$$GET1^DIQ(200,(+($G(IPRO))_","),.132)
"RTN","GMTSDEMP",55,0)
 . S IPGA=$$GET1^DIQ(200,(+($G(IPRO))_","),.137)
"RTN","GMTSDEMP",56,0)
 . S IPGD=$$GET1^DIQ(200,(+($G(IPRO))_","),.138)
"RTN","GMTSDEMP",57,0)
 ;
"RTN","GMTSDEMP",58,0)
ONEDOC ;   Inpatient Provider and Attending are the Same
"RTN","GMTSDEMP",59,0)
 I +($G(IPRO))=+($G(ATTN)) D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",60,0)
 . Q:$D(GMTSQIT)  I +IPRO>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",61,0)
 . . N PHN,ANA,DIG
"RTN","GMTSDEMP",62,0)
 . . S PHN=$$GET1^DIQ(200,(+($G(IPRO))_","),.132)
"RTN","GMTSDEMP",63,0)
 . . S ANA=$$GET1^DIQ(200,(+($G(IPRO))_","),.137)
"RTN","GMTSDEMP",64,0)
 . . S DIG=$$GET1^DIQ(200,(+($G(IPRO))_","),.138)
"RTN","GMTSDEMP",65,0)
 . . D LF Q:$D(GMTSQIT)
"RTN","GMTSDEMP",66,0)
 . . D WRT^GMTSDEM("Inpat. Prov/Attn",$E($P($G(IPRO),"^",2),1,31),"Phone",$G(PHN),1) Q:$D(GMTSQIT)
"RTN","GMTSDEMP",67,0)
 . . I $L($G(ANA)) D WRT^GMTSDEM("Analog Pager",ANA,$S($L(DIG):"Digital Pager",1:""),$S($L(DIG):DIG,1:""),1) Q:$D(GMTSQIT)
"RTN","GMTSDEMP",68,0)
 . . I '$L($G(ANA)),$L($G(DIG)) D WRT^GMTSDEM("Digital Pager",DIG,"","",1) Q:$D(GMTSQIT)
"RTN","GMTSDEMP",69,0)
 ;
"RTN","GMTSDEMP",70,0)
TWODOCS ;   Inpatient Provider and Attending are Different
"RTN","GMTSDEMP",71,0)
 I +($G(IPRO))'=+($G(ATTN)) D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",72,0)
 . I +IPRO>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",73,0)
 . . N PHN,ANA,DIG
"RTN","GMTSDEMP",74,0)
 . . S PHN=$$GET1^DIQ(200,(+($G(IPRO))_","),.132)
"RTN","GMTSDEMP",75,0)
 . . S ANA=$$GET1^DIQ(200,(+($G(IPRO))_","),.137)
"RTN","GMTSDEMP",76,0)
 . . S DIG=$$GET1^DIQ(200,(+($G(IPRO))_","),.138)
"RTN","GMTSDEMP",77,0)
 . . D LF Q:$D(GMTSQIT)
"RTN","GMTSDEMP",78,0)
 . . D WRT^GMTSDEM("Inpat. Provider",$E($P($G(IPRO),"^",2),1,31),"Phone",$G(PHN),1) Q:$D(GMTSQIT)
"RTN","GMTSDEMP",79,0)
 . . I $L($G(ANA)) D WRT^GMTSDEM("Analog Pager",ANA,$S($L(DIG):"Digital Pager",1:""),$S($L(DIG):DIG,1:""),1) Q:$D(GMTSQIT)
"RTN","GMTSDEMP",80,0)
 . . I '$L($G(ANA)),$L($G(DIG)) D WRT^GMTSDEM("Digital Pager",DIG,"","",1) Q:$D(GMTSQIT)
"RTN","GMTSDEMP",81,0)
 . I +ATTN>0 D  Q:$D(GMTSQIT)
"RTN","GMTSDEMP",82,0)
 . . S ATTN=+ATTN_"^"_$$GET1^DIQ(200,(+($G(ATTN))_","),.01)
"RTN","GMTSDEMP",83,0)
 . . N PHN,ANA,DIG S (PHN,ANA,DIG)=""
"RTN","GMTSDEMP",84,0)
 . . S PHN=$$GET1^DIQ(200,(+($G(ATTN))_","),.132)
"RTN","GMTSDEMP",85,0)
 . . S ANA=$$GET1^DIQ(200,(+($G(ATTN))_","),.137)
"RTN","GMTSDEMP",86,0)
 . . S DIG=$$GET1^DIQ(200,(+($G(ATTN))_","),.138)
"RTN","GMTSDEMP",87,0)
 . . D LF Q:$D(GMTSQIT)
"RTN","GMTSDEMP",88,0)
 . . D WRT^GMTSDEM("Inpat. Attending",$E($P($G(ATTN),"^",2),1,31),"Phone",$G(PHN),1) Q:$D(GMTSQIT)
"RTN","GMTSDEMP",89,0)
 . . I $L($G(ANA)) D WRT^GMTSDEM("Analog Pager",ANA,$S($L(DIG):"Digital Pager",1:""),$S($L(DIG):DIG,1:""),1) Q:$D(GMTSQIT)
"RTN","GMTSDEMP",90,0)
 . . I '$L($G(ANA)),$L($G(DIG)) D WRT^GMTSDEM("Digital Pager",DIG,"","",1) Q:$D(GMTSQIT)
"RTN","GMTSDEMP",91,0)
 Q
"RTN","GMTSDEMP",92,0)
LF ; Line Feed
"RTN","GMTSDEMP",93,0)
 I +($G(LF))>0 S LF=0 D WRT^GMTSDEM("",,,,0) S LF=0
"RTN","GMTSDEMP",94,0)
 Q
"RTN","GMTSLRBE")
0^3^B4353205
"RTN","GMTSLRBE",1,0)
GMTSLRBE ; SLC/JER,KER - Blood Availability Extract ; 08/27/2002
"RTN","GMTSLRBE",2,0)
 ;;2.7;Health Summary;**17,28,56**;Oct 20, 1995
"RTN","GMTSLRBE",3,0)
 ;
"RTN","GMTSLRBE",4,0)
 ;                     
"RTN","GMTSLRBE",5,0)
 ; External References
"RTN","GMTSLRBE",6,0)
 ;   DBIA 10090  ^DIC(4
"RTN","GMTSLRBE",7,0)
 ;   DBIA   528  ^LAB(66
"RTN","GMTSLRBE",8,0)
 ;   DBIA   525  ^LR(
"RTN","GMTSLRBE",9,0)
 ;   DBIA   527  ^LRD(65
"RTN","GMTSLRBE",10,0)
 ;   DBIA 10015  EN^DIQ1 (file #65)
"RTN","GMTSLRBE",11,0)
 ;                     
"RTN","GMTSLRBE",12,0)
XTRCT ; Extract Blood Availability
"RTN","GMTSLRBE",13,0)
 N I1,UN,CNT S CNT=0 K ^TMP("LRB",$J)
"RTN","GMTSLRBE",14,0)
 I $L($P(^LR(LRDFN,0),U,5,6)) S ^TMP("LRB",$J,0)=$P(^(0),U,5)_U_$P(^(0),U,6)
"RTN","GMTSLRBE",15,0)
 S UN="" F  S UN=$O(^LRD(65,"AP",LRDFN,UN)) Q:UN=""!(CNT'<MAX)  D BASET
"RTN","GMTSLRBE",16,0)
 Q
"RTN","GMTSLRBE",17,0)
BASET ; Sets ^TMP("LRB",$J, with data elements
"RTN","GMTSLRBE",18,0)
 N ADT,DA,DIC,DIQ,DON,DR,EFLG,EDT,UID,UDIV,DTYP,COMP,ABO,RH,VOL,XDT,XMR,XMATCH
"RTN","GMTSLRBE",19,0)
 N IDT,GMI,ULOC
"RTN","GMTSLRBE",20,0)
 S (ADT,EFLG,EDT,UID,DTYP,COMP,ABO,RH,VOL,XMR,ULOC)=""
"RTN","GMTSLRBE",21,0)
 S UID=$P(^LRD(65,UN,0),U),EDT=$P(^(0),U,6),ABO=$P(^(0),U,7),RH=$P(^(0),U,8),VOL=$P(^(0),U,11),COMP=$P(^LAB(66,$P(^LRD(65,UN,0),U,4),0),U)
"RTN","GMTSLRBE",22,0)
 S ADT=$P(^LRD(65,UN,2,LRDFN,0),U,2)
"RTN","GMTSLRBE",23,0)
 S UDIV=$P(^LRD(65,UN,0),U,16),UDIV=$S(UDIV'="":$P(^DIC(4,UDIV,0),U),1:UDIV) ;Gets division unit is located at
"RTN","GMTSLRBE",24,0)
 I $D(^LRD(65,UN,8)) S DIC=65,DIQ="DON",DIQ(0)="E",DR=8.3,DA=UN D EN^DIQ1 S:$D(DON) DTYP=DON(65,UN,8.3,"E")
"RTN","GMTSLRBE",25,0)
 S GMI=$O(^LRD(65,UN,3,0)) I +GMI>0 D
"RTN","GMTSLRBE",26,0)
 . S ULOC=$P($G(^LRD(65,UN,3,GMI,0)),U,4)
"RTN","GMTSLRBE",27,0)
 ;   If unit will expire w/in 48 hrs, flag with "*"
"RTN","GMTSLRBE",28,0)
 ;                       w/in 24 hrs, flag with "**"
"RTN","GMTSLRBE",29,0)
 I EDT>DT S EFLG=$S(EDT-DT<2:"*",EDT-DT<1:"**",1:"")
"RTN","GMTSLRBE",30,0)
 S IDT=9999999-ADT
"RTN","GMTSLRBE",31,0)
 I $S(IDT<GMTS1:1,IDT>GMTS2:1,EDT<DT:1,1:0) Q
"RTN","GMTSLRBE",32,0)
 S X=EDT D REGDT4^GMTSU S EDT=X K X
"RTN","GMTSLRBE",33,0)
 F  Q:'$D(^TMP("LRB",$J,IDT))  S IDT=IDT+.0001
"RTN","GMTSLRBE",34,0)
 S ^TMP("LRB",$J,IDT)=EFLG_U_EDT_U_UID_U_COMP_U_VOL_U_ABO_U_RH_U_DTYP_U_UDIV_U_ULOC
"RTN","GMTSLRBE",35,0)
 S CNT=CNT+1
"RTN","GMTSLRBE",36,0)
 Q
"RTN","GMTSLRCE")
0^4^B9938328
"RTN","GMTSLRCE",1,0)
GMTSLRCE ; SLC/JER,KER - Chemistry Extract Routine ; 08/27/2002
"RTN","GMTSLRCE",2,0)
 ;;2.7;Health Summary;**18,28,29,56**;Oct 20, 1995
"RTN","GMTSLRCE",3,0)
 ;                    
"RTN","GMTSLRCE",4,0)
 ; External References
"RTN","GMTSLRCE",5,0)
 ;   DBIA    67  ^LAB(60
"RTN","GMTSLRCE",6,0)
 ;   DBIA   524  ^LAB(61
"RTN","GMTSLRCE",7,0)
 ;   DBIA   525  ^LR(
"RTN","GMTSLRCE",8,0)
 ;   DBIA 10103  $$FMTHL7^XLFDT
"RTN","GMTSLRCE",9,0)
 ;                    
"RTN","GMTSLRCE",10,0)
XTRCT ; Extract
"RTN","GMTSLRCE",11,0)
 ;                    
"RTN","GMTSLRCE",12,0)
 ;   Call with LRDFN, GMTS1, GMTS2,
"RTN","GMTSLRCE",13,0)
 ;   MAX (#occurrences) and SEX (M or F)
"RTN","GMTSLRCE",14,0)
 ;                    
"RTN","GMTSLRCE",15,0)
 N IDT,CNT,AGE D:'$D(GMTSAGE) DEM^GMTSU S AGE=GMTSAGE K ^TMP("LRC",$J)
"RTN","GMTSLRCE",16,0)
 S IDT=GMTS1,CNT=0 F  S IDT=$O(^LR(LRDFN,"CH",IDT)) Q:IDT=""!(IDT>GMTS2)  D:CNT'>MAX CHSET
"RTN","GMTSLRCE",17,0)
 Q
"RTN","GMTSLRCE",18,0)
CHSET ; Sets Chemistry locals for printing
"RTN","GMTSLRCE",19,0)
 N CDT,SITE,SPEC,PTR,ISVALID,GMI,ACC,LOC,COM,RDT,SNOMED
"RTN","GMTSLRCE",20,0)
 S ISVALID=$P(^LR(LRDFN,"CH",IDT,0),U,3) Q:ISVALID=""  S SNOMED=""
"RTN","GMTSLRCE",21,0)
 S CDT=+^LR(LRDFN,"CH",IDT,0),SITE=$P(^(0),U,5),SPEC=$P(^LAB(61,SITE,0),U),SNOMED=$P(^(0),U,2),CNT=CNT+1
"RTN","GMTSLRCE",22,0)
 I $D(EXPAND) D
"RTN","GMTSLRCE",23,0)
 . S SPEC=SNOMED_";"_SPEC,RDT=$P(^LR(LRDFN,"CH",IDT,0),U,3)
"RTN","GMTSLRCE",24,0)
 . S ACC=$P(^(0),U,6),ACC=$P(ACC," ",2,3)_" "_$P(ACC," ")
"RTN","GMTSLRCE",25,0)
 . S LOC=$P(^(0),U,11)
"RTN","GMTSLRCE",26,0)
 . S RDT=$$FMTHL7^XLFDT(RDT)
"RTN","GMTSLRCE",27,0)
 S X=CDT D REGDTM4^GMTSU:'$D(EXPAND)
"RTN","GMTSLRCE",28,0)
 S:$D(EXPAND) X=$$FMTHL7^XLFDT(X) S CDT=X K X
"RTN","GMTSLRCE",29,0)
 S PTR=1 F  S PTR=$O(^LR(LRDFN,"CH",IDT,PTR)) Q:PTR<1  D NXTST
"RTN","GMTSLRCE",30,0)
 I $D(^LR(LRDFN,"CH",IDT,1,0)),($D(^TMP("LRC",$J,IDT))) D
"RTN","GMTSLRCE",31,0)
 . S COM=0 F GMI=1:1 S COM=$O(^LR(LRDFN,"CH",IDT,1,COM)) Q:+COM'>0  S ^TMP("LRC",$J,IDT,"C",GMI)=^LR(LRDFN,"CH",IDT,1,COM,0)
"RTN","GMTSLRCE",32,0)
 Q
"RTN","GMTSLRCE",33,0)
NXTST ; Visit next node in ^(PTR) subtree
"RTN","GMTSLRCE",34,0)
 N RESULT,FLAG,TEST,GMPC,GMSQN,TNM,DESCR,THER,UNIT,HI,LO,CIS
"RTN","GMTSLRCE",35,0)
 S RESULT=$P(^LR(LRDFN,"CH",IDT,PTR),U),FLAG=$P(^(PTR),U,2),CIS=""
"RTN","GMTSLRCE",36,0)
 I $D(EXPAND),(FLAG["*") S FLAG=$S(FLAG="L*":"LL",FLAG="H*":"HH",1:FLAG)
"RTN","GMTSLRCE",37,0)
 S TEST=$O(^LAB(60,"C","CH;"_PTR_";1",0)) Q:TEST'>0
"RTN","GMTSLRCE",38,0)
 S TNM=$S($L($P(^LAB(60,TEST,0),U))<19:$P(^(0),U),1:$P(^(.1),U))
"RTN","GMTSLRCE",39,0)
 ;   Quit if Test Type is neither "Output" or "Both"
"RTN","GMTSLRCE",40,0)
 I $S("BO"'[$P(^LAB(60,TEST,0),U,3):1,1:0) Q
"RTN","GMTSLRCE",41,0)
 S GMSQN=$S($P($G(^LAB(60,TEST,.1)),U,6):$P($G(^(.1)),U,6),1:PTR/1000000)
"RTN","GMTSLRCE",42,0)
 I $D(^LAB(60,TEST,10)) S CIS=^(10)
"RTN","GMTSLRCE",43,0)
 I $D(EXPAND),'$L(CIS) Q
"RTN","GMTSLRCE",44,0)
 I $D(EXPAND) S TNM=CIS_";"_TNM
"RTN","GMTSLRCE",45,0)
 ;   Execute Print Code from file 60 to evaluate RESULT
"RTN","GMTSLRCE",46,0)
 S RESULT=$$RESULT(TEST,RESULT,$G(RWIDTH))
"RTN","GMTSLRCE",47,0)
 S DESCR=$S($D(^LAB(60,TEST,1,SITE,0)):^(0),1:""),THER=$S($L($P(DESCR,U,11,12))>1:1,1:0)
"RTN","GMTSLRCE",48,0)
 S UNIT=$P(DESCR,U,7),LO=$S(THER:$P(DESCR,U,11),1:$P(DESCR,U,2)),HI=$S(THER:$P(DESCR,U,12),1:$P(DESCR,U,3))
"RTN","GMTSLRCE",49,0)
 S @("LO="_$S($L(LO):LO,1:"""""")),@("HI="_$S($L(HI):HI,1:""""""))
"RTN","GMTSLRCE",50,0)
 I $D(EXPAND),'$L(FLAG),(+$G(HI)'<+$G(RESULT)),(+$G(LO)'>+$G(RESULT)) S FLAG="N"
"RTN","GMTSLRCE",51,0)
 F  Q:'$D(^TMP("LRC",$J,IDT,GMSQN))  Q:TEST=+^(GMSQN)  S GMSQN=GMSQN+1
"RTN","GMTSLRCE",52,0)
 Q:$D(^TMP("LRC",$J,IDT,GMSQN))
"RTN","GMTSLRCE",53,0)
 S ^TMP("LRC",$J,IDT,GMSQN)=CDT_U_SPEC_U_TNM_U_RESULT_U_FLAG_U_UNIT_U_LO_U_HI
"RTN","GMTSLRCE",54,0)
 I $D(EXPAND) D XPND
"RTN","GMTSLRCE",55,0)
 Q
"RTN","GMTSLRCE",56,0)
XPND ; Appends additional data if required
"RTN","GMTSLRCE",57,0)
 S ^TMP("LRC",$J,IDT,GMSQN)=^TMP("LRC",$J,IDT,GMSQN)_U_ACC_U_RDT_U_LOC
"RTN","GMTSLRCE",58,0)
 Q
"RTN","GMTSLRCE",59,0)
 ;                      
"RTN","GMTSLRCE",60,0)
RESULT(TEST,RESULT,LRCW) ; Convert result to external format
"RTN","GMTSLRCE",61,0)
 ;                      
"RTN","GMTSLRCE",62,0)
 ;   Where
"RTN","GMTSLRCE",63,0)
 ;         TEST=Test ptr to file 60
"RTN","GMTSLRCE",64,0)
 ;         RESULT=Test result
"RTN","GMTSLRCE",65,0)
 ;         LRCW=Optional width of variable. Default is 0
"RTN","GMTSLRCE",66,0)
 N X,X1
"RTN","GMTSLRCE",67,0)
 I +$G(LRCW)'>0 S LRCW=0
"RTN","GMTSLRCE",68,0)
 S X1=$P($G(^LAB(60,TEST,.1)),"^",3),X1=$S($L(X1):X1,1:"$J(X,LRCW)"),X=RESULT,@("X="_X1)
"RTN","GMTSLRCE",69,0)
 Q X
"RTN","GMTSLREE")
0^5^B12298606
"RTN","GMTSLREE",1,0)
GMTSLREE ; SLC/JER,KER - Electron Microscopy Extract ; 08/27/2002
"RTN","GMTSLREE",2,0)
 ;;2.7;Health Summary;**3,28,56**;Oct 20, 1995
"RTN","GMTSLREE",3,0)
 ;                    
"RTN","GMTSLREE",4,0)
 ; External References
"RTN","GMTSLREE",5,0)
 ;   DBIA   525  ^LR(
"RTN","GMTSLREE",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSLREE",7,0)
 ;                    
"RTN","GMTSLREE",8,0)
XTRCT ; Extract
"RTN","GMTSLREE",9,0)
 N IX0,IX K ^TMP("LREM",$J) S IX=GMTS1
"RTN","GMTSLREE",10,0)
 F IX0=1:0:MAX S IX=$O(^LR(LRDFN,"EM",IX)) Q:IX'>0!(IX>GMTS2)  D APSET
"RTN","GMTSLREE",11,0)
 K AP
"RTN","GMTSLREE",12,0)
 Q
"RTN","GMTSLREE",13,0)
APSET ; Sets ^TMP("LREM",$J
"RTN","GMTSLREE",14,0)
 N ACC,CDT,DA,DIC,DIQ,DR,GMW,SN,X,YR
"RTN","GMTSLREE",15,0)
 S CDT=$P(^LR(LRDFN,"EM",IX,0),U),ACC=$P(^(0),U,6)
"RTN","GMTSLREE",16,0)
 I $S(+$P(^LR(LRDFN,"EM",IX,0),U)'>0:1,+$P(^(0),U,11)'>0:1,1:0) Q
"RTN","GMTSLREE",17,0)
 I $D(ACC) S IX0=IX0+1
"RTN","GMTSLREE",18,0)
 S X=CDT D REGDTM4^GMTSU S CDT=X K X
"RTN","GMTSLREE",19,0)
 S ^TMP("LREM",$J,IX,0)=CDT_U_ACC
"RTN","GMTSLREE",20,0)
 I $D(^LR(LRDFN,"EM",IX,.1)) S ^TMP("LREM",$J,IX,.1)="Site/Specimen"
"RTN","GMTSLREE",21,0)
 S SN=0 F  S SN=$O(^LR(LRDFN,"EM",IX,.1,SN)) Q:SN'>0  S ^TMP("LREM",$J,IX,.1,SN)=$P(^LR(LRDFN,"EM",IX,.1,SN,0),U)
"RTN","GMTSLREE",22,0)
 I $D(^LR(LRDFN,"EM",IX,.2,0)),($P(^(0),U,3)]"") D CLHX
"RTN","GMTSLREE",23,0)
 I $D(^LR(LRDFN,"EM",IX,1,0)),($P(^(0),U,3)]"") D GROSS
"RTN","GMTSLREE",24,0)
 I $D(^LR(LRDFN,"EM",IX,1.1,0)),($P(^(0),U,3)]"") D MIC
"RTN","GMTSLREE",25,0)
 I $D(^LR(LRDFN,"EM",IX,1.2,0)),($P(^(0),U,3)]"") D SUPPR
"RTN","GMTSLREE",26,0)
 I $D(^LR(LRDFN,"EM",IX,1.4,0)),($P(^(0),U,3)]"") D SPDX
"RTN","GMTSLREE",27,0)
 Q
"RTN","GMTSLREE",28,0)
CLHX ; Brief Clinical History text
"RTN","GMTSLREE",29,0)
 N LN
"RTN","GMTSLREE",30,0)
 S ^TMP("LREM",$J,IX,.2)="Brief Clinical Hx"
"RTN","GMTSLREE",31,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"EM",IX,.2,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"EM",IX,.2,LN,0),U) D FORMAT
"RTN","GMTSLREE",32,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LREM",$J,IX,.2,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLREE",33,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLREE",34,0)
 Q
"RTN","GMTSLREE",35,0)
GROSS ; Gross Description text
"RTN","GMTSLREE",36,0)
 N LN
"RTN","GMTSLREE",37,0)
 S ^TMP("LREM",$J,IX,1)="Gross Description"
"RTN","GMTSLREE",38,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"EM",IX,1,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"EM",IX,1,LN,0),U) D FORMAT
"RTN","GMTSLREE",39,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LREM",$J,IX,1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLREE",40,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLREE",41,0)
 Q
"RTN","GMTSLREE",42,0)
MIC ; Microscopic Exam/Diagnosis text
"RTN","GMTSLREE",43,0)
 N LN
"RTN","GMTSLREE",44,0)
 S ^TMP("LREM",$J,IX,1.1)="Microscopic Exam"
"RTN","GMTSLREE",45,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"EM",IX,1.1,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"EM",IX,1.1,LN,0),U) D FORMAT
"RTN","GMTSLREE",46,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LREM",$J,IX,1.1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLREE",47,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLREE",48,0)
 Q
"RTN","GMTSLREE",49,0)
SUPPR ; Supplementary Report date/text
"RTN","GMTSLREE",50,0)
 N SP1 S ^TMP("LREM",$J,IX,1.2)="Supplementary Report"
"RTN","GMTSLREE",51,0)
 S SP1=0
"RTN","GMTSLREE",52,0)
 F  S SP1=$O(^LR(LRDFN,"EM",IX,1.2,SP1)) Q:SP1'>0  D
"RTN","GMTSLREE",53,0)
 . Q:+$P($G(^LR(LRDFN,"EM",IX,1.2,SP1,0)),U,2)'>0
"RTN","GMTSLREE",54,0)
 . S ^TMP("LREM",$J,IX,1.2,SP1,0)=$P($G(^LR(LRDFN,"EM",IX,1.2,SP1,0)),U)
"RTN","GMTSLREE",55,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSLREE",56,0)
 . S SR=0
"RTN","GMTSLREE",57,0)
 . F  S SR=$O(^LR(LRDFN,"EM",IX,1.2,SP1,1,SR)) Q:SR'>0  D
"RTN","GMTSLREE",58,0)
 . . S X=$P($G(^LR(LRDFN,"EM",IX,1.2,SP1,1,SR,0)),U) D FORMAT
"RTN","GMTSLREE",59,0)
 . I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LREM",$J,IX,1.2,SP1,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLREE",60,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLREE",61,0)
 Q
"RTN","GMTSLREE",62,0)
SPDX ; Electron Microscopy DX text
"RTN","GMTSLREE",63,0)
 N LN
"RTN","GMTSLREE",64,0)
 S ^TMP("LREM",$J,IX,1.4)="Surgical Path Dx"
"RTN","GMTSLREE",65,0)
 K ^UTILITY($J,"W") S LN=0 F  S LN=$O(^LR(LRDFN,"EM",IX,1.4,LN)) Q:LN'>0  S X=$P(^LR(LRDFN,"EM",IX,1.4,LN,0),U) D FORMAT
"RTN","GMTSLREE",66,0)
 I $D(^UTILITY($J,"W")) F LN=1:1:^UTILITY($J,"W",3) S ^TMP("LREM",$J,IX,1.4,LN)=^UTILITY($J,"W",DIWL,LN,0)
"RTN","GMTSLREE",67,0)
 K ^UTILITY($J,"W")
"RTN","GMTSLREE",68,0)
 Q
"RTN","GMTSLREE",69,0)
FORMAT ; Format Text
"RTN","GMTSLREE",70,0)
 S DIWF="N",DIWL=3,DIWR=78 D ^DIWP
"RTN","GMTSLREE",71,0)
 Q
"RTN","GMTSLRME")
0^6^B24937166
"RTN","GMTSLRME",1,0)
GMTSLRME ; SLC/JER,KER - Microbiology Extract Routine ; 08/27/2002
"RTN","GMTSLRME",2,0)
 ;;2.7;Health Summary;**25,28,37,56**;Oct 20, 1995
"RTN","GMTSLRME",3,0)
 ;                    
"RTN","GMTSLRME",4,0)
 ; External References
"RTN","GMTSLRME",5,0)
 ;   DBIA    67  ^LAB(60
"RTN","GMTSLRME",6,0)
 ;   DBIA   525  ^LR(
"RTN","GMTSLRME",7,0)
 ;   DBIA   531  ^LRO(68
"RTN","GMTSLRME",8,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSLRME",9,0)
 ;   DBIA 10007  MIX^DIC1
"RTN","GMTSLRME",10,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSLRME",11,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMTSLRME",12,0)
 ;                    
"RTN","GMTSLRME",13,0)
XTRCT ; Extract
"RTN","GMTSLRME",14,0)
 N ACC,CDT,SS,CS,X,DIC,DIQ,DA,DR,MICRO,LOC,RDT,MICCOM K ^TMP("LRM",$J)
"RTN","GMTSLRME",15,0)
 S X=$P(^LR(LRDFN,"MI",IX,0),U),RDT=$P(^(0),U,3),ACC=$P(^(0),U,6),LOC=$P(^(0),U,8) D REGDTM4^GMTSU S CDT=X K X
"RTN","GMTSLRME",16,0)
 D LABTEST($P(^LR(LRDFN,"MI",IX,0),U),ACC)
"RTN","GMTSLRME",17,0)
 ;   Get External format of site/specimen
"RTN","GMTSLRME",18,0)
 ;   collection sample, and comment
"RTN","GMTSLRME",19,0)
 S DIC=63,DIQ="MICRO",DIQ(0)="E",DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)=".05;.055;.99"
"RTN","GMTSLRME",20,0)
 D EN^DIQ1
"RTN","GMTSLRME",21,0)
 S SS=MICRO(63.05,IX,.05,"E")
"RTN","GMTSLRME",22,0)
 S CS=MICRO(63.05,IX,.055,"E"),MICCOM=MICRO(63.05,IX,.99,"E")
"RTN","GMTSLRME",23,0)
 S ^TMP("LRM",$J,0)=CDT_U_ACC_U_SS I $D(EXPAND) S ^TMP("LRM",$J,0)=^TMP("LRM",$J,0)_U_RDT_U_LOC
"RTN","GMTSLRME",24,0)
 S $P(^TMP("LRM",$J,0),U,6)=CS_U_MICCOM
"RTN","GMTSLRME",25,0)
 D ABXLEV,BACT,GRAM,STER,PARA^GMTSLRMX,MYCO^GMTSLRMX,TB^GMTSLRMX,VIRO^GMTSLRMX
"RTN","GMTSLRME",26,0)
 Q
"RTN","GMTSLRME",27,0)
BACT ; Get Bacteriology Work-up
"RTN","GMTSLRME",28,0)
 N DA,DIC,DIQ,DR,STATUS,ISO,ORG,RMK,COM,SMEAR
"RTN","GMTSLRME",29,0)
 ;   Work up
"RTN","GMTSLRME",30,0)
 I $D(^LR(LRDFN,"MI",IX,1)) D
"RTN","GMTSLRME",31,0)
 . S DIC=63,DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)="11.5;11.51;11.57;11.58",DIQ="STATUS"
"RTN","GMTSLRME",32,0)
 . S DIQ(0)="E" D EN^DIQ1
"RTN","GMTSLRME",33,0)
 . ;     Include Status, sputum screen, and urine screen
"RTN","GMTSLRME",34,0)
 . S ^TMP("LRM",$J,"BACT",0)=$E($P(STATUS(63.05,IX,11.5,"E")," ",1),1,6)_U_STATUS(63.05,IX,11.58,"E")_U_STATUS(63.05,IX,11.57,"E")
"RTN","GMTSLRME",35,0)
 . ;     Include sterility control
"RTN","GMTSLRME",36,0)
 . S ^TMP("LRM",$J,"BSTER",0)=STATUS(63.05,IX,11.51,"E")
"RTN","GMTSLRME",37,0)
 S ISO=0 F  S ISO=$O(^LR(LRDFN,"MI",IX,3,ISO)) Q:+ISO'>0  D
"RTN","GMTSLRME",38,0)
 . D ORGNSM S ^TMP("LRM",$J,"BACT",ISO)=$S($D(EXPAND):ISO_";"_ORG,1:ORG)
"RTN","GMTSLRME",39,0)
 . I $O(^LR(LRDFN,"MI",IX,3,ISO,1)) D ANTIBX
"RTN","GMTSLRME",40,0)
 . ;     Get Comment
"RTN","GMTSLRME",41,0)
 . S COM=0
"RTN","GMTSLRME",42,0)
 . F  S COM=$O(^LR(LRDFN,"MI",IX,3,ISO,1,COM)) Q:COM'>0  S ^TMP("LRM",$J,"BACT",ISO,"COM",COM)=^(COM,0)
"RTN","GMTSLRME",43,0)
 ;   Bacteriology smear/prep
"RTN","GMTSLRME",44,0)
 S SMEAR=0
"RTN","GMTSLRME",45,0)
 F  S SMEAR=$O(^LR(LRDFN,"MI",IX,25,SMEAR)) Q:SMEAR'>0  S ^TMP("LRM",$J,"BACT","SMEAR",SMEAR)=^(SMEAR,0)
"RTN","GMTSLRME",46,0)
 ;     Get Remark
"RTN","GMTSLRME",47,0)
 S RMK=0
"RTN","GMTSLRME",48,0)
 F  S RMK=$O(^LR(LRDFN,"MI",IX,4,RMK)) Q:RMK=""  S ^TMP("LRM",$J,"BACT","R",RMK)=^(RMK,0)
"RTN","GMTSLRME",49,0)
 Q
"RTN","GMTSLRME",50,0)
ORGNSM ; Get Organism
"RTN","GMTSLRME",51,0)
 N QTY
"RTN","GMTSLRME",52,0)
 S ORG=+^LR(LRDFN,"MI",IX,3,ISO,0),QTY=$P(^(0),U,2)
"RTN","GMTSLRME",53,0)
 S ORG=$$GET1^DIQ(61.2,ORG,.01,"I")
"RTN","GMTSLRME",54,0)
 S ORG=ORG_U_QTY
"RTN","GMTSLRME",55,0)
 Q
"RTN","GMTSLRME",56,0)
ANTIBX ; Get Antibitiotic susceptibility results on demand
"RTN","GMTSLRME",57,0)
 N ABX S ABX=1
"RTN","GMTSLRME",58,0)
 F  S ABX=$O(^LR(LRDFN,"MI",IX,3,ISO,ABX)) Q:ABX=""!(ABX'<3)  D ABXSET
"RTN","GMTSLRME",59,0)
 Q
"RTN","GMTSLRME",60,0)
ABXSET ; Antibiotic Susceptability Data
"RTN","GMTSLRME",61,0)
 ;   Separate out by Susceptable, Intermediate, and Resistant
"RTN","GMTSLRME",62,0)
 N FOUND,GMTSR,GMABX,ABXI,ABXNM,ABXN
"RTN","GMTSLRME",63,0)
 S ABXI=$$ABXI(ABX),ABXNM=$$ABXNM(ABXI),ABXN=ABX_";"_ABXNM
"RTN","GMTSLRME",64,0)
 I $P(ABXN,";",2)']"" S $P(ABXN,";",2)="UNKNOWN"
"RTN","GMTSLRME",65,0)
 I ("A"[$P(^LR(LRDFN,"MI",IX,3,ISO,ABX),U,3)) D
"RTN","GMTSLRME",66,0)
 . S GMABX=$G(^LR(LRDFN,"MI",IX,3,ISO,ABX))
"RTN","GMTSLRME",67,0)
 . ;     Check for interpreted result (S, I, or R) first
"RTN","GMTSLRME",68,0)
 . S FOUND=0
"RTN","GMTSLRME",69,0)
 . S GMTSR=$P(GMABX,U,2) D SAVE Q:FOUND
"RTN","GMTSLRME",70,0)
 . ;     If not found then check reported result (S,I, or R)
"RTN","GMTSLRME",71,0)
 . S GMTSR=$P(GMABX,U) D SAVE Q:FOUND
"RTN","GMTSLRME",72,0)
 . ;     Neither interpreted nor reported result equaled
"RTN","GMTSLRME",73,0)
 . ;     S, I, or R so we'll store it in the "other" list
"RTN","GMTSLRME",74,0)
 . ;     provided that reported and interpreted are both
"RTN","GMTSLRME",75,0)
 . ;     not null
"RTN","GMTSLRME",76,0)
 . S:$P(GMABX,U)'=""&($P(GMABX,U,2)'="") ^TMP("LRM",$J,"BACT",ISO,"SUSC","O",$P($P(ABXN,U),";",2))=ABXN_U_GMABX
"RTN","GMTSLRME",77,0)
 Q
"RTN","GMTSLRME",78,0)
ABXI(X) ; Antibiotic Susceptability IEN
"RTN","GMTSLRME",79,0)
 S X=$G(X) Q:'$L(X) 0 N DIC,DTOUT,DUOUT,Y S DIC="^LAB(62.06,",D="AD",DIC(0)="" D MIX^DIC1 S X=+($G(Y)) S:X'>0 X=0 Q X
"RTN","GMTSLRME",80,0)
ABXNM(X) ; Antibiotic Susceptability Name
"RTN","GMTSLRME",81,0)
 S X=$G(X) Q:+X'>0 "" S X=$$GET1^DIQ(62.06,+X,.01) Q X
"RTN","GMTSLRME",82,0)
ABXLEV ; Get Serum antibiotic level
"RTN","GMTSLRME",83,0)
 Q:'$D(^LR(LRDFN,"MI",IX,14))  N GMI S GMI=0
"RTN","GMTSLRME",84,0)
 F  S GMI=$O(^LR(LRDFN,"MI",IX,14,GMI)) Q:GMI'>0  S ^TMP("LRM",$J,"CABXL",GMI)=$G(^(GMI,0))
"RTN","GMTSLRME",85,0)
 Q
"RTN","GMTSLRME",86,0)
STER ; Get sterility results if they exist
"RTN","GMTSLRME",87,0)
 N RESULT,STER S STER=0
"RTN","GMTSLRME",88,0)
 F  S STER=$O(^LR(LRDFN,"MI",IX,31,STER)) Q:STER'>0  D
"RTN","GMTSLRME",89,0)
 . S DIQ(0)="E",DIC=63,DA=LRDFN,DA(63.05)=IX,DR=5,DR(63.05)=11.52
"RTN","GMTSLRME",90,0)
 . S DR(63.292)=.01,DIQ="RESULT"
"RTN","GMTSLRME",91,0)
 . S DA(63.292)=STER
"RTN","GMTSLRME",92,0)
 . D EN^DIQ1
"RTN","GMTSLRME",93,0)
 . S ^TMP("LRM",$J,"BSTER",STER)=RESULT(63.292,STER,.01,"E")
"RTN","GMTSLRME",94,0)
 Q
"RTN","GMTSLRME",95,0)
GRAM ; Get Gram Stain Results
"RTN","GMTSLRME",96,0)
 N ISO Q:'$D(^LR(LRDFN,"MI",IX,2))  S ISO=0
"RTN","GMTSLRME",97,0)
 F  S ISO=$O(^LR(LRDFN,"MI",IX,2,ISO)) Q:ISO=""  S ^TMP("LRM",$J,"GRAM",ISO)=^(ISO,0)
"RTN","GMTSLRME",98,0)
 Q
"RTN","GMTSLRME",99,0)
LABTEST(SDT,LRACC) ; Get lab test names and results
"RTN","GMTSLRME",100,0)
 N X,Y,LRAA,LRAN,LRAD,LRBRR,LRTSTS,LRTS
"RTN","GMTSLRME",101,0)
 S LRAD=+$E(SDT)_$P(LRACC," ",2)_"0000",X=$P(LRACC," "),DIC=68,DIC(0)="M"
"RTN","GMTSLRME",102,0)
 Q:'$L(X)  D ^DIC S LRAA=+Y,LRAN=+$P(LRACC," ",3)
"RTN","GMTSLRME",103,0)
 S LRBRR=0
"RTN","GMTSLRME",104,0)
 F  S LRBRR=+$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRBRR)) Q:LRBRR'>0  D
"RTN","GMTSLRME",105,0)
 . S LRTS=+^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRBRR,0),LRTS(1)=$P(^(0),U,5)
"RTN","GMTSLRME",106,0)
 . Q:"BO"'[$P($G(^LAB(60,LRTS,0)),U,3)
"RTN","GMTSLRME",107,0)
 . S LRTSTS=$S($D(^LAB(60,LRTS,0)):$P(^(0),U),1:"deleted test")
"RTN","GMTSLRME",108,0)
 . ;   Lab test name and results in print order
"RTN","GMTSLRME",109,0)
 . S ^TMP("LRM",$J,0,"TEST",$S($D(^LAB(60,LRTS,.1)):$P(^(.1),U,6),1:"")_","_U_LRBRR)=LRTSTS_U_LRTS(1)
"RTN","GMTSLRME",110,0)
 Q
"RTN","GMTSLRME",111,0)
SAVE ; If result = S, I, or R then save
"RTN","GMTSLRME",112,0)
 I $S(GMTSR="I":1,GMTSR="R":1,GMTSR="S":1,1:0) S ^TMP("LRM",$J,"BACT",ISO,"SUSC",GMTSR,$P($P(ABXN,U),";",2))=ABXN_U_GMABX S FOUND=1
"RTN","GMTSLRME",113,0)
 Q
"RTN","GMTSLRPE")
0^7^B9094292
"RTN","GMTSLRPE",1,0)
GMTSLRPE ; SLC/JER,KER - Cytopathology Extract Routine ; 08/27/2002
"RTN","GMTSLRPE",2,0)
 ;;2.7;Health Summary;**3,28,37,56**;Oct 20, 1995
"RTN","GMTSLRPE",3,0)
 ;                    
"RTN","GMTSLRPE",4,0)
 ; External References
"RTN","GMTSLRPE",5,0)
 ;   DBIA   525  ^LR(
"RTN","GMTSLRPE",6,0)
 ;   DBIA   529  ^LAB(61.1   0;1
"RTN","GMTSLRPE",7,0)
 ;   DBIA   526  ^LAB(61.2   0;1
"RTN","GMTSLRPE",8,0)
 ;   DBIA 10133  ^LAB(61.4   0;1
"RTN","GMTSLRPE",9,0)
 ;   DBIA 10134  ^LAB(61.5   0;1
"RTN","GMTSLRPE",10,0)
 ;   DBIA  2056  $$GET1^DIQ (file #61.1, 61.2, 61.4, and 61.5)
"RTN","GMTSLRPE",11,0)
 ;                    
"RTN","GMTSLRPE",12,0)
XTRCT ; Extract
"RTN","GMTSLRPE",13,0)
 N IX0,IX K ^TMP("LRCY",$J) S IX=GMTS1
"RTN","GMTSLRPE",14,0)
 F IX0=1:0:MAX S IX=$O(^LR(LRDFN,"CY",IX)) Q:IX'>0!(IX>GMTS2)  D CYSET
"RTN","GMTSLRPE",15,0)
 Q
"RTN","GMTSLRPE",16,0)
CYSET ; Sets ^TMP("LRCY",$J, with appropriate data elements
"RTN","GMTSLRPE",17,0)
 N ACC,CDT,D1,D2,D3,DA,DIC,DIQ,DR,DX,ICD,OT,SR,RELEASE,SITE,SN,X,YR
"RTN","GMTSLRPE",18,0)
 S CDT=$P(^LR(LRDFN,"CY",IX,0),U),ACC=$P(^(0),U,6),RELEASE=$P(^(0),U,11)
"RTN","GMTSLRPE",19,0)
 I $D(ACC) S IX0=IX0+1
"RTN","GMTSLRPE",20,0)
 S X=CDT D REGDT4^GMTSU S CDT=X K X
"RTN","GMTSLRPE",21,0)
 S ^TMP("LRCY",$J,IX,0)=CDT_U_ACC
"RTN","GMTSLRPE",22,0)
 I $D(^LR(LRDFN,"CY",IX,.1)) S ^TMP("LRCY",$J,IX,1)="Site/Specimen"_U_RELEASE
"RTN","GMTSLRPE",23,0)
 Q:'RELEASE
"RTN","GMTSLRPE",24,0)
 S SN=0 F  S SN=$O(^LR(LRDFN,"CY",IX,.1,SN)) Q:SN'>0  S ^TMP("LRCY",$J,IX,1,SN)=$P(^LR(LRDFN,"CY",IX,.1,SN,0),U)
"RTN","GMTSLRPE",25,0)
 S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,.2,OT)) Q:+OT'>0  S ^TMP("LRCY",$J,IX,"AH",OT)=$G(^LR(LRDFN,"CY",IX,.2,OT,0))
"RTN","GMTSLRPE",26,0)
 S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,1,OT)) Q:OT'>0  S ^TMP("LRCY",$J,IX,"G",OT)=^LR(LRDFN,"CY",IX,1,OT,0)
"RTN","GMTSLRPE",27,0)
 S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,1.1,OT)) Q:OT'>0  S ^TMP("LRCY",$J,IX,"MI",OT)=^LR(LRDFN,"CY",IX,1.1,OT,0)
"RTN","GMTSLRPE",28,0)
 S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,1.2,OT)) Q:OT'>0  D
"RTN","GMTSLRPE",29,0)
 . Q:+$P($G(^LR(LRDFN,"CY",IX,1.2,OT,0)),U,2)'>0
"RTN","GMTSLRPE",30,0)
 . S ^TMP("LRCY",$J,IX,"SR",OT,0)=$P($G(^LR(LRDFN,"CY",IX,1.2,OT,0)),U)
"RTN","GMTSLRPE",31,0)
 . S SR=0 F  S SR=$O(^LR(LRDFN,"CY",IX,1.2,OT,1,SR)) Q:SR'>0  D
"RTN","GMTSLRPE",32,0)
 . . S ^TMP("LRCY",$J,IX,"SR",OT,SR)=$P($G(^LR(LRDFN,"CY",IX,1.2,OT,1,SR,0)),U)
"RTN","GMTSLRPE",33,0)
 S OT=0 F  S OT=$O(^LR(LRDFN,"CY",IX,1.4,OT)) Q:+OT'>0  S ^TMP("LRCY",$J,IX,"NDX",OT)=$P($G(^LR(LRDFN,"CY",IX,1.4,OT,0)),U)
"RTN","GMTSLRPE",34,0)
 Q
"RTN","GMTSLRPE",35,0)
D ; Get Disease Field data
"RTN","GMTSLRPE",36,0)
 N GMI,GMD,DIS S GMD=0 F  S GMD=$O(^LR(LRDFN,"CY",IX,2,OT,1,GMD)) Q:GMD=""  D
"RTN","GMTSLRPE",37,0)
 . S GMI=+^LR(LRDFN,"CY",IX,2,OT,1,GMD,0)
"RTN","GMTSLRPE",38,0)
 . S ^TMP("LRCY",$J,IX,"OT"_OT,"D"_GMD)=$$GET1^DIQ(61.4,GMI,.01,"I")
"RTN","GMTSLRPE",39,0)
 Q
"RTN","GMTSLRPE",40,0)
M ; Get Morphology Field data
"RTN","GMTSLRPE",41,0)
 N GMI,GMM,MORPH S GMM=0 F  S GMM=$O(^LR(LRDFN,"CY",IX,2,OT,2,GMM)) Q:GMM=""  D
"RTN","GMTSLRPE",42,0)
 . S GMI=+^LR(LRDFN,"CY",IX,2,OT,1,GMD,0)
"RTN","GMTSLRPE",43,0)
 . S ^TMP("LRCY",$J,IX,"OT"_OT,"M"_GMM)=$$GET1^DIQ(61.1,GMI,.01,"I")
"RTN","GMTSLRPE",44,0)
 . D E
"RTN","GMTSLRPE",45,0)
 Q
"RTN","GMTSLRPE",46,0)
E ; Get Etiology Field data
"RTN","GMTSLRPE",47,0)
 N GMI,GME,ETIOL S GME=0 F  S GME=$O(^LR(LRDFN,"CY",IX,2,OT,2,GMM,1,GME)) Q:GME'>0  D
"RTN","GMTSLRPE",48,0)
 . S GMI=+^LR(LRDFN,"CY",IX,2,OT,2,GMM,1,GME,0)
"RTN","GMTSLRPE",49,0)
 . S ^TMP("LRCY",$J,IX,"OT"_OT,"M"_GMM,"E"_GME)=$$GET1^DIQ(61.2,GMI,.01,"I")
"RTN","GMTSLRPE",50,0)
 Q
"RTN","GMTSLRPE",51,0)
P ; Get Procedure Field data
"RTN","GMTSLRPE",52,0)
 N GMI,GMP,PROC S GMP=0 F  S GMP=$O(^LR(LRDFN,"CY",IX,2,OT,4,GMP)) Q:GMP=""  D
"RTN","GMTSLRPE",53,0)
 . S GMI=+^LR(LRDFN,"CY",IX,2,OT,4,GMP,0)
"RTN","GMTSLRPE",54,0)
 . S ^TMP("LRCY",$J,IX,"OT"_OT,"P"_GMP)=$$GET1^DIQ(61.5,GMI,.01,"I")
"RTN","GMTSLRPE",55,0)
 Q
"RTN","GMTSLRTE")
0^8^B2568562
"RTN","GMTSLRTE",1,0)
GMTSLRTE ; SLC/JER,KER - Transfusion Record Extract Routine ; 08/27/2002
"RTN","GMTSLRTE",2,0)
 ;;2.7;Health Summary;**56**;Oct 20, 1995
"RTN","GMTSLRTE",3,0)
 ;                     
"RTN","GMTSLRTE",4,0)
 ; External References
"RTN","GMTSLRTE",5,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSLRTE",6,0)
 ;   DBIA   528  ^LAB(66
"RTN","GMTSLRTE",7,0)
 ;   DBIA   525  ^LR(
"RTN","GMTSLRTE",8,0)
 ;                     
"RTN","GMTSLRTE",9,0)
XTRCT ; Extract Transfusion Records
"RTN","GMTSLRTE",10,0)
 N LRDFN,IDT,CNTR,TR,PN,PRODUCT
"RTN","GMTSLRTE",11,0)
 S:'$D(GMTS1) GMTS1=6666666 S:'$D(GMTS2) GMTS2=9999999
"RTN","GMTSLRTE",12,0)
 K ^TMP("LRT",$J)
"RTN","GMTSLRTE",13,0)
 Q:'$D(^DPT(DFN,"LR"))  S LRDFN=+^DPT(DFN,"LR"),IDT=GMTS1-1
"RTN","GMTSLRTE",14,0)
 I '$D(^LR(LRDFN)) Q
"RTN","GMTSLRTE",15,0)
 S IDT=GMTS1-1 F  S IDT=$O(^LR(LRDFN,1.6,IDT)) Q:+IDT'>0!(IDT>GMTS2)  D
"RTN","GMTSLRTE",16,0)
 . S TR=$G(^LR(LRDFN,1.6,IDT,0)) D SET
"RTN","GMTSLRTE",17,0)
 S IDT=0 F  S IDT=$O(CNTR(IDT)) Q:+IDT'>0  D
"RTN","GMTSLRTE",18,0)
 . S ^TMP("LRT",$J,IDT)=9999999-IDT_U
"RTN","GMTSLRTE",19,0)
 . S PN=0 F  S PN=$O(CNTR(IDT,PN)) Q:PN'>0  D
"RTN","GMTSLRTE",20,0)
 . . S PRODUCT=$G(^LAB(66,+PN,0)),^TMP("LRT",$J,$P(PRODUCT,U,2))=$P(PRODUCT,U)
"RTN","GMTSLRTE",21,0)
 . . S ^TMP("LRT",$J,IDT)=^TMP("LRT",$J,IDT)_CNTR(IDT,PN)_"\"_$P(PRODUCT,U,2)_";"
"RTN","GMTSLRTE",22,0)
 D ST
"RTN","GMTSLRTE",23,0)
 Q
"RTN","GMTSLRTE",24,0)
SET ; Save Appropriate Data
"RTN","GMTSLRTE",25,0)
 N COMP,UNITS,TDT,ITDT S TDT=9999999-IDT,ITDT=9999999-$P(TDT,".")
"RTN","GMTSLRTE",26,0)
 S UNITS=+$P(TR,U,7) S:UNITS'>0 UNITS=1
"RTN","GMTSLRTE",27,0)
 S CNTR(ITDT,+$P(TR,U,2))=+$G(CNTR(ITDT,+$P(TR,U,2)))+UNITS
"RTN","GMTSLRTE",28,0)
 Q
"RTN","GMTSLRTE",29,0)
ST N NN,NC S NN="^TMP(""LRT"","_$J_")",NC="^TMP(""LRT"","_$J_","
"RTN","GMTSLRTE",30,0)
 F  S NN=$Q(@NN) Q:NN=""!(NN'[NC)  W !,NN,"=",@NN
"RTN","GMTSLRTE",31,0)
 Q
"RTN","GMTSLTR")
0^9^B4398379
"RTN","GMTSLTR",1,0)
GMTSLTR ; SLC/JER,KER - Print Big Letters ; 08/27/2002
"RTN","GMTSLTR",2,0)
 ;;2.7;Health Summary;**28,56**;Oct 20, 1995
"RTN","GMTSLTR",3,0)
 ;                   
"RTN","GMTSLTR",4,0)
 ; External Reference
"RTN","GMTSLTR",5,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMTSLTR",6,0)
 ;   DBIA  2056  $$GET1^DIQ (file #200)
"RTN","GMTSLTR",7,0)
 ;                   
"RTN","GMTSLTR",8,0)
 Q:'$L($G(GMTSLTR))  I '$D(^UTILITY("GMTSLTR",$J,"A")) D ^GMTSLTR2
"RTN","GMTSLTR",9,0)
B1 ; Setup for banner print
"RTN","GMTSLTR",10,0)
 N GMTSDIV,GMTSLEN,GMTSXXX,GMTSBLNK,X
"RTN","GMTSLTR",11,0)
 S GMTSLEN=$L(GMTSLTR),GMTSDIV=60\GMTSLEN,$P(GMTSXXX,"X",(GMTSDIV\5+1))=""
"RTN","GMTSLTR",12,0)
 S $P(GMTSBLNK," ",(GMTSDIV\5+1))=""
"RTN","GMTSLTR",13,0)
 S GMTSLTY=$E(GMTSLTR,1,$S(GMTSLEN'>2:GMTSLEN,1:(IOM\GMTSDIV-1))),GMTSLTX=""
"RTN","GMTSLTR",14,0)
 F GMTSLT1=1:1:$L(GMTSLTY) D
"RTN","GMTSLTR",15,0)
 . I $A(GMTSLTY,GMTSLT1)>32,$D(^UTILITY("GMTSLTR",$J,$E(GMTSLTY,GMTSLT1))) D
"RTN","GMTSLTR",16,0)
 . . S GMTSLTX=GMTSLTX_$E(GMTSLTY,GMTSLT1)
"RTN","GMTSLTR",17,0)
 W:$L($P($G(GMTSSC),U,2)) "HEALTH SUMMARY REPORT FOR PATIENTS AT: ",$P(GMTSSC,U,2)
"RTN","GMTSLTR",18,0)
 I $L($P($G(GMTSSC),U,4)) S X=$P(GMTSSC,U,4) D REGDTM4^GMTSU W !?34,"FOR: ",X
"RTN","GMTSLTR",19,0)
 I $L($P($G(GMTSSC),U,5)) S X=$P(GMTSSC,U,5) D REGDTM4^GMTSU W " TO ",X
"RTN","GMTSLTR",20,0)
 W ! I $D(GMTSTITL) W ?(IOM-$L(GMTSTITL)\2),GMTSTITL,!!
"RTN","GMTSLTR",21,0)
 I $D(GMTSPNM) W ?10,"Patient: ",GMTSPNM,!
"RTN","GMTSLTR",22,0)
 I $D(GMTSWDN) W "Hospital Location: ",GMTSWDN,!
"RTN","GMTSLTR",23,0)
 I $D(DUZ) W ?33,"User: ",$$GET1^DIQ(200,(+($G(DUZ))_","),.01),!
"RTN","GMTSLTR",24,0)
 W ! F GMTSLT=1:1:6 D B2
"RTN","GMTSLTR",25,0)
 W @IOF
"RTN","GMTSLTR",26,0)
 K GMTSLT1,GMTSLT2,GMTSLT3,GMTSLTX,GMTSLTY,GMTSLT,^UTILITY("GMTSLTR",$J)
"RTN","GMTSLTR",27,0)
 Q
"RTN","GMTSLTR",28,0)
B2 ; Write Banner
"RTN","GMTSLTR",29,0)
 W ! F GMTSLT1=9:-1:1 W ! F GMTSLT3=1:1:$L(GMTSLTX) S X=^UTILITY("GMTSLTR",$J,$E(GMTSLTX,GMTSLT3)) W "   " F GMTSLT2=1:1:5 W $S($E(X,(GMTSLT2-1*9+GMTSLT1)):GMTSXXX,1:GMTSBLNK)
"RTN","GMTSLTR",30,0)
 Q
"RTN","GMTSMAG")
0^10^B1724868
"RTN","GMTSMAG",1,0)
GMTSMAG ;SLC/RMP - Imaging Health Summary Component ; 08/27/2002
"RTN","GMTSMAG",2,0)
 ;;2.7;Health Summary;**26,56**;Oct 20, 1995
"RTN","GMTSMAG",3,0)
 ;                    
"RTN","GMTSMAG",4,0)
 ; External References
"RTN","GMTSMAG",5,0)
 ;   DBIA  2791  ^MAG(2005
"RTN","GMTSMAG",6,0)
 ;   DBIA 10022  %XY^%RCR
"RTN","GMTSMAG",7,0)
 ;                    
"RTN","GMTSMAG",8,0)
MAIN ; Imaging Component
"RTN","GMTSMAG",9,0)
 N %X,%Y,GMI,MAX,MAGDFN,IX,X,PROC,GMTSXX Q:'$D(^MAG(2005,"AC",DFN))
"RTN","GMTSMAG",10,0)
 S MAGDFN=DFN,MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSMAG",11,0)
 D IMGPTRE^GMTSMAGE(.GMTSXX,MAGDFN_"^"_DUZ)
"RTN","GMTSMAG",12,0)
 S %X="GMTSXX",%Y="^TMP(""MAG"",$J," D %XY^%RCR Q:'$D(^TMP("MAG",$J))
"RTN","GMTSMAG",13,0)
 D WRTMAG S IX=0
"RTN","GMTSMAG",14,0)
 F  S IX=$O(^TMP("MAG",$J,IX)) Q:IX=""  S X=^TMP("MAG",$J,IX) D WRT
"RTN","GMTSMAG",15,0)
 K ^TMP("MAG",$J)
"RTN","GMTSMAG",16,0)
 Q
"RTN","GMTSMAG",17,0)
WRTMAG ; Writes Imaging Header
"RTN","GMTSMAG",18,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?1,"Date/Time",?20,"Procedure",?34,"Short Description",!!
"RTN","GMTSMAG",19,0)
 Q
"RTN","GMTSMAG",20,0)
WRT ; Writes Image date/time, procedure, short text
"RTN","GMTSMAG",21,0)
 N Y S Y=$P(X,U) S Y=$$FMTE(Y) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSMAG",22,0)
 . W Y,?20,$E($P(X,U,2),1,12),?34,$E($P(X,U,3),1,43),!
"RTN","GMTSMAG",23,0)
 Q
"RTN","GMTSMAG",24,0)
FMTE(X) ; Fileman to External
"RTN","GMTSMAG",25,0)
 S X=$G(X) D REGDTM4^GMTSU Q X
"RTN","GMTSMAGE")
0^11^B2220073
"RTN","GMTSMAGE",1,0)
GMTSMAGE ;SLC/RMP - Imaging HS Comp Data Extraction  ; 08/27/2002
"RTN","GMTSMAGE",2,0)
 ;;2.7;Health Summary;**26,56**;Oct 20, 1995
"RTN","GMTSMAGE",3,0)
 ;                    
"RTN","GMTSMAGE",4,0)
 ; External References
"RTN","GMTSMAGE",5,0)
 ;   DBIA  2791  ^MAG(2005
"RTN","GMTSMAGE",6,0)
 ;                    
"RTN","GMTSMAGE",7,0)
IMGPTRE(ZY,MAGMESS) ; Return Image Info List for Patient
"RTN","GMTSMAGE",8,0)
 N MAX,Y,MAGDFN,MAGDUZ,CT,PD,T,I,P
"RTN","GMTSMAGE",9,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSMAGE",10,0)
 S MAGDFN=$P(MAGMESS,"^",1),MAGDUZ=$P(MAGMESS,"^",2) S:MAGDUZ="" MAGDUZ=0
"RTN","GMTSMAGE",11,0)
 F I=1:1:10 I $E(MAGDFN,1)=" " S MAGDFN=$E(MAGDFN,2,99)
"RTN","GMTSMAGE",12,0)
 S MAGDFN=+MAGDFN I '$D(^MAG(2005,"APDTPX",MAGDFN)) S ZY(0)="1^0" Q
"RTN","GMTSMAGE",13,0)
 S CT=0,T=0,I=0,P="",PD=""
"RTN","GMTSMAGE",14,0)
 F  S PD=$O(^MAG(2005,"APDTPX",MAGDFN,PD)) Q:PD=""  Q:'$$GT(PD)  D
"RTN","GMTSMAGE",15,0)
 . S P="" F  S P=$O(^MAG(2005,"APDTPX",MAGDFN,PD,P)) Q:P=""  D
"RTN","GMTSMAGE",16,0)
 . . S I="" F  S I=$O(^MAG(2005,"APDTPX",MAGDFN,PD,P,I)) Q:+I<1  D
"RTN","GMTSMAGE",17,0)
 . . . Q:$P($G(^MAG(2005,I,0)),"^",10)  ;   Child of Group
"RTN","GMTSMAGE",18,0)
 . . . S T=T+1 Q:T>250  Q:(MAX>1)&(MAX<(CT+1))  S CT=CT+1
"RTN","GMTSMAGE",19,0)
 . . . D ARRY(.ZY,CT,I)
"RTN","GMTSMAGE",20,0)
 S ZY(0)="1^"_CT S:T>CT ZY(0)=ZY(0)_" of "_T K T,I
"RTN","GMTSMAGE",21,0)
 Q
"RTN","GMTSMAGE",22,0)
GT(ADT) ; Date Range Check
"RTN","GMTSMAGE",23,0)
 Q:ADT>GMTS2 0
"RTN","GMTSMAGE",24,0)
 Q $S(ADT>GMTS1:1,1:0)
"RTN","GMTSMAGE",25,0)
ARRY(ZY,CT,I) ; Build Array
"RTN","GMTSMAGE",26,0)
 S ZY(CT)=$P(^MAG(2005,I,2),"^",5)
"RTN","GMTSMAGE",27,0)
 S $P(ZY(CT),"^",2)=$P(^MAG(2005,I,0),"^",8)
"RTN","GMTSMAGE",28,0)
 S $P(ZY(CT),"^",3)=$P(^MAG(2005,I,2),"^",4)
"RTN","GMTSMAGE",29,0)
 Q
"RTN","GMTSMCPS")
0^20^B20672813
"RTN","GMTSMCPS",1,0)
GMTSMCPS ; WISC/DCB - Medicine 2.2 Health Summary Component ; 08/27/2002
"RTN","GMTSMCPS",2,0)
 ;;2.7;Health Summary;**16,56**;Oct 20, 1995
"RTN","GMTSMCPS",3,0)
 ;
"RTN","GMTSMCPS",4,0)
 ; External References
"RTN","GMTSMCPS",5,0)
 ;   DBIA 10061  KVAR^VADPT
"RTN","GMTSMCPS",6,0)
 ;   DBIA    80  ^MCAR(690
"RTN","GMTSMCPS",7,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSMCPS",8,0)
 ;               
"RTN","GMTSMCPS",9,0)
BEG ; One Line summary only
"RTN","GMTSMCPS",10,0)
 D START(0,"B") Q
"RTN","GMTSMCPS",11,0)
BRIEF ; Brief Summary 
"RTN","GMTSMCPS",12,0)
 D START(1,"B") Q
"RTN","GMTSMCPS",13,0)
ABN ; Print Brief summary for only abnormal or Null
"RTN","GMTSMCPS",14,0)
 D START(2,"B") Q 
"RTN","GMTSMCPS",15,0)
FULL ; Full Summary
"RTN","GMTSMCPS",16,0)
 D START(1,"F") Q
"RTN","GMTSMCPS",17,0)
CAP ; Capture
"RTN","GMTSMCPS",18,0)
 D START(1,"C") Q
"RTN","GMTSMCPS",19,0)
ADBF ; Print Full Summary for only abnormal or null
"RTN","GMTSMCPS",20,0)
 D START(2,"F") Q
"RTN","GMTSMCPS",21,0)
 ;                
"RTN","GMTSMCPS",22,0)
START(BRIEF,MCTYPE) ; Get the record and display the record
"RTN","GMTSMCPS",23,0)
 N TV,VV,SP,MAX
"RTN","GMTSMCPS",24,0)
 K ^TMP("MCAR",$J)
"RTN","GMTSMCPS",25,0)
 S RMAR=$S($D(IOM):IOM,1:IOM)
"RTN","GMTSMCPS",26,0)
 S TV=(.25*RMAR+.5)\1
"RTN","GMTSMCPS",27,0)
 S VV=(.70*RMAR+.5)\1
"RTN","GMTSMCPS",28,0)
 S SP=(RMAR-(TV+VV))-1
"RTN","GMTSMCPS",29,0)
 D KVAR^VADPT
"RTN","GMTSMCPS",30,0)
 I '$D(^MCAR(690,"AC",DFN)) D EXIT Q
"RTN","GMTSMCPS",31,0)
 D SEARCH
"RTN","GMTSMCPS",32,0)
 I '$D(^TMP("MCAR",$J)) D EXIT Q
"RTN","GMTSMCPS",33,0)
 F MCL=1:1 Q:$D(GMTSQIT)  Q:'$D(^TMP("MCAR",$J,MCL))  D GETREC(MCL,RMAR,TV,VV,SP)
"RTN","GMTSMCPS",34,0)
 D EXIT
"RTN","GMTSMCPS",35,0)
 Q
"RTN","GMTSMCPS",36,0)
SEARCH ; Search for Selected Patient
"RTN","GMTSMCPS",37,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSMCPS",38,0)
 D HSUM^GMTSMCMA(DFN,GMTSEND,GMTSBEG,MAX,"",MCTYPE)
"RTN","GMTSMCPS",39,0)
 Q
"RTN","GMTSMCPS",40,0)
GETREC(MCL,RMAR,TV,VV,SP) ; Return Single Record
"RTN","GMTSMCPS",41,0)
 N MCDATE,MCPROC,MCSUM,MCPSUM,LOOP,LINE,BLINE
"RTN","GMTSMCPS",42,0)
 S (LOOP,BLINE)="",$P(BLINE,"-",80)="-"
"RTN","GMTSMCPS",43,0)
 S MCDATE=$$RETURN("DATE/TIME",MCL)
"RTN","GMTSMCPS",44,0)
 S MCPROC=$$RETURN("PROCEDURE",MCL)
"RTN","GMTSMCPS",45,0)
 S MCSUM=$$RETURN("SUMMARY",MCL)
"RTN","GMTSMCPS",46,0)
 I BRIEF=2,("NBT"[$E(MCSUM,1)),(MCSUM'="") Q
"RTN","GMTSMCPS",47,0)
 S MCPSUM=$$RETURN("PROCEDURE SUMMARY",MCL)
"RTN","GMTSMCPS",48,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,MCDATE,?(TV+SP),MCPROC
"RTN","GMTSMCPS",49,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,BLINE
"RTN","GMTSMCPS",50,0)
 D:MCSUM'="" PRINT(MCSUM,VV,"Summary:",TV,SP)
"RTN","GMTSMCPS",51,0)
 D:MCPSUM'="" PRINT(MCPSUM,VV,"Procedure Summary:",TV,SP)
"RTN","GMTSMCPS",52,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSMCPS",53,0)
 Q:+$G(BRIEF)=0
"RTN","GMTSMCPS",54,0)
 F  S LOOP=+$O(^TMP("MCAR",$J,MCL,LOOP)) Q:LOOP=0!$D(GMTSQIT)  D REPORT(LOOP,MCL,RMAR,BLINE,TV,VV,SP)
"RTN","GMTSMCPS",55,0)
 Q
"RTN","GMTSMCPS",56,0)
REPORT(LOOP,MCL,RMAR,BLINE,TV,VV,SP) ; Report for Procedure
"RTN","GMTSMCPS",57,0)
 N LINE,TEMP,HOLD,TITLE,VALUE,UNITS,MLEN,RANGE
"RTN","GMTSMCPS",58,0)
 N TARRAY,VARRY,LARRAY,TMAX,VMAX,MAX,LOOP2
"RTN","GMTSMCPS",59,0)
 S LINE=^TMP("MCAR",$J,MCL,LOOP,1)
"RTN","GMTSMCPS",60,0)
 S TEMP=$P(LINE,U,1),TITLE=$P(TEMP,";",1)_":"
"RTN","GMTSMCPS",61,0)
 S VALUE=$P(LINE,U,3,255),UNITS=$P(LINE,U,2)
"RTN","GMTSMCPS",62,0)
 Q:(VALUE="")&(MCTYPE="C")
"RTN","GMTSMCPS",63,0)
 I $P(TEMP,";",2)="W" D WORD(MCL,LOOP,TITLE,RMAR,TV,VV,SP) Q
"RTN","GMTSMCPS",64,0)
 S VALUE=VALUE_$S(UNITS="":"",1:" "_UNITS)
"RTN","GMTSMCPS",65,0)
 D PRINT(VALUE,VV,TITLE,TV,SP)
"RTN","GMTSMCPS",66,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSMCPS",67,0)
 Q
"RTN","GMTSMCPS",68,0)
WARP(VALUE,LENGTH,TEMP,MAX) ; Warp a field
"RTN","GMTSMCPS",69,0)
 N DIWL,DIWR,DIWF,X,LOOP3,TEMP1 S LOOP3=""
"RTN","GMTSMCPS",70,0)
 K ^UTILITY($J,"W")
"RTN","GMTSMCPS",71,0)
 S DIWL=0,DIWR=LENGTH,X=VALUE D ^DIWP
"RTN","GMTSMCPS",72,0)
 F MAX=1:1 S LOOP3=+$O(^UTILITY($J,"W",DIWL,LOOP3)) Q:LOOP3=0  D
"RTN","GMTSMCPS",73,0)
 . S TEMP1=^UTILITY($J,"W",DIWL,LOOP3,0)
"RTN","GMTSMCPS",74,0)
 . S:$E(TEMP1,$L(TEMP1))=" " TEMP1=$E(TEMP1,1,$L(TEMP1)-1)
"RTN","GMTSMCPS",75,0)
 . S TEMP(LOOP3)=TEMP1
"RTN","GMTSMCPS",76,0)
 S MAX=MAX-1
"RTN","GMTSMCPS",77,0)
 Q
"RTN","GMTSMCPS",78,0)
WORD(MCL,LOOP,TITLE,RMAR,TV,VV,SP) ; Display Word Processing
"RTN","GMTSMCPS",79,0)
 N SLOOP,X,DIWR,DIWL,DIWF,TARRAY,TMAX,LOOP3,SPAC
"RTN","GMTSMCPS",80,0)
 D WARP(TITLE,TV,.TARRAY,.TMAX) K ^UTILITY($J,"W") S DIWR=VV,DIWL=0
"RTN","GMTSMCPS",81,0)
 F SLOOP=0:0 S SLOOP=+$O(^TMP("MCAR",$J,MCL,LOOP,SLOOP)) Q:SLOOP=0  D
"RTN","GMTSMCPS",82,0)
 . S X=$P(^TMP("MCAR",$J,MCL,LOOP,SLOOP),U,3) D ^DIWP
"RTN","GMTSMCPS",83,0)
 S SLOOP=0
"RTN","GMTSMCPS",84,0)
 F LOOP3=1:1 S SLOOP=+$O(^UTILITY($J,"W",DIWL,SLOOP)) Q:(SLOOP=0)!($D(GMTSQIT))  D
"RTN","GMTSMCPS",85,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSMCPS",86,0)
 . W !,$J($G(TARRAY(LOOP3)),TV),?(TV+SP),^UTILITY($J,"W",DIWL,SLOOP,0)
"RTN","GMTSMCPS",87,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSMCPS",88,0)
 Q
"RTN","GMTSMCPS",89,0)
CONVERT(TITLE) ; Convert to Mixed Case   TEMP = Temp
"RTN","GMTSMCPS",90,0)
 N UPPER,LOWER,TEMP,LOOP,HOLD,HOLD2
"RTN","GMTSMCPS",91,0)
 S UPPER="ABCDEFGHIJKLMNOPQRSTUVWXYZ",LOWER="abcdefghijklmnopqrstuvwxyz"
"RTN","GMTSMCPS",92,0)
 F LOOP=1:1:255 S HOLD=$P(TITLE," ",LOOP) Q:HOLD=""  D
"RTN","GMTSMCPS",93,0)
 . S:$D(TEMP) TEMP=TEMP_" "
"RTN","GMTSMCPS",94,0)
 . S HOLD2=$E(HOLD,2,$L(HOLD))
"RTN","GMTSMCPS",95,0)
 . S TEMP=$G(TEMP)_$E(HOLD,1)_$TR(HOLD2,UPPER,LOWER)
"RTN","GMTSMCPS",96,0)
 Q TEMP
"RTN","GMTSMCPS",97,0)
PRINT(VALUE,VV,TITLE,TV,SP) ; Print a Field and its Value
"RTN","GMTSMCPS",98,0)
 N VMAX,TMAX,TARRAY,VARRAY,SPAC,LOOP2
"RTN","GMTSMCPS",99,0)
 S TITLE=$$CONVERT(TITLE)
"RTN","GMTSMCPS",100,0)
 D WARP(VALUE,VV,.VARRAY,.VMAX)
"RTN","GMTSMCPS",101,0)
 D WARP(TITLE,TV,.TARRAY,.TMAX)
"RTN","GMTSMCPS",102,0)
 S MAX=$S(VMAX<TMAX:TMAX,VMAX>TMAX:VMAX,1:TMAX)
"RTN","GMTSMCPS",103,0)
 S SPAC=TMAX-VMAX S SPAC=$S(SPAC'>0:0,1:SPAC)
"RTN","GMTSMCPS",104,0)
 F LOOP2=1:1:MAX D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSMCPS",105,0)
 . W !,$J($G(TARRAY(LOOP2)),TV),?(TV+SP),$G(VARRAY(LOOP2-SPAC))
"RTN","GMTSMCPS",106,0)
 Q:$D(GMTSQIT)
"RTN","GMTSMCPS",107,0)
 Q
"RTN","GMTSMCPS",108,0)
RETURN(TYPE,LINE) ; Return key Elements
"RTN","GMTSMCPS",109,0)
 N MCHOLD,HOLD
"RTN","GMTSMCPS",110,0)
 S MCHOLD=+$O(^TMP("MCAR",$J,LINE,"B",TYPE,""))
"RTN","GMTSMCPS",111,0)
 S HOLD=$P($G(^TMP("MCAR",$J,LINE,MCHOLD,1)),U,3)
"RTN","GMTSMCPS",112,0)
 K ^TMP("MCAR",$J,LINE,"B",TYPE,LINE)
"RTN","GMTSMCPS",113,0)
 K ^TMP("MCAR",$J,LINE,MCHOLD,1)
"RTN","GMTSMCPS",114,0)
 Q HOLD
"RTN","GMTSMCPS",115,0)
EXIT ; Clean up and Quit
"RTN","GMTSMCPS",116,0)
 K PR,OT,DA,MCARPPS,MCI,MCJ,R,MCL,S1,S2,S4,S5,S6,LL,LL1,MAX,VA
"RTN","GMTSMCPS",117,0)
 K ^TMP("MCAR",$J),K,N,MCARDT,MCARNM,MCARPROC,M,RMAR
"RTN","GMTSMCPS",118,0)
 Q
"RTN","GMTSONE")
0^14^B67474183
"RTN","GMTSONE",1,0)
GMTSONE ; HIN/GWB - Oncology Health Summary Comp ; 08/27/2002
"RTN","GMTSONE",2,0)
 ;;2.7;Health Summary;**36,35,42,54,56**;Oct 20, 1995
"RTN","GMTSONE",3,0)
 ;                        
"RTN","GMTSONE",4,0)
 ; External References
"RTN","GMTSONE",5,0)
 ;   DBIA  2924  ^ONCO(160,
"RTN","GMTSONE",6,0)
 ;   DBIA  2888  ^ONCO(165.5,
"RTN","GMTSONE",7,0)
 ;   DBIA 10015  ^UTILITY("DIQ1"
"RTN","GMTSONE",8,0)
 ;   DBIA  2056  GETS^DIQ (file 160 and 165,5)
"RTN","GMTSONE",9,0)
 ;   DBIA 10015  EN^DIQ1 (file 165.5)
"RTN","GMTSONE",10,0)
 ;                    
"RTN","GMTSONE",11,0)
 ; Variables Used but not NEWed or KILLed
"RTN","GMTSONE",12,0)
 ;   DFN, GMTSQIT
"RTN","GMTSONE",13,0)
 ;                    
"RTN","GMTSONE",14,0)
EXTRACT ; Extract Data for Patient DFN
"RTN","GMTSONE",15,0)
 K ^UTILITY("DIQ1",$J),ONC
"RTN","GMTSONE",16,0)
 N CNT,DA,DIC,DIQ,DR,HSFLAG,IEN,IEN1,IEN2,LINE,LOS,NOP,ONC,PTIEN
"RTN","GMTSONE",17,0)
 N SUB,SUBCNT,SUBIEN,SUBLET,TSIEN,TXT,TXT1,TXT2
"RTN","GMTSONE",18,0)
 Q:'$D(^ONCO(160,"B",DFN_";DPT("))  S PTIEN=$O(^ONCO(160,"B",DFN_";DPT(",0))
"RTN","GMTSONE",19,0)
 S SUB="abcdefghijklmnopqrstuvwxyz",HSFLAG=1
"RTN","GMTSONE",20,0)
 S IEN=0 F  S IEN=$O(^ONCO(165.5,"C",PTIEN,IEN)) Q:IEN=""  D
"RTN","GMTSONE",21,0)
 . S DIC="^ONCO(165.5,",DR=".04;3;20;22;24;29;30;37.1;37.2;37.3;38;85;86;87;88;58.1;58.3;58.2;50;51.2;51;442;125;127;128;53.2;53;54.2;54;55.2;55;346;560;91;58;75;76;77;2000;57;57.2;95;22.3"
"RTN","GMTSONE",22,0)
 . S DA=IEN D EN^DIQ1
"RTN","GMTSONE",23,0)
 . S DR="3",DIQ(0)="I" D EN^DIQ1
"RTN","GMTSONE",24,0)
 . D GETS^DIQ(165.5,IEN_",","60*","N","ONC")
"RTN","GMTSONE",25,0)
 S IEN=0 F  S IEN=$O(ONC(165.51,IEN)) Q:IEN'>0  D
"RTN","GMTSONE",26,0)
 . S IEN1=$P(IEN,",",2)
"RTN","GMTSONE",27,0)
 . S IEN2=$P(IEN,",",1)
"RTN","GMTSONE",28,0)
 . M ONC("SUB",IEN1,IEN2)=ONC(165.51,IEN)
"RTN","GMTSONE",29,0)
 . K IEN1,IEN2
"RTN","GMTSONE",30,0)
 K ONC(165.51)
"RTN","GMTSONE",31,0)
 D GETS^DIQ(160,PTIEN_",","16;400*","N","ONC")
"RTN","GMTSONE",32,0)
DISPLAY ; Display Extracted Data
"RTN","GMTSONE",33,0)
 S IEN=0 F CNT=1:1 S IEN=$O(^UTILITY("DIQ1",$J,165.5,IEN)) Q:IEN=""  D
"RTN","GMTSONE",34,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",35,0)
 . W " #",CNT," Cancer Identification"
"RTN","GMTSONE",36,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",37,0)
 . W !," ------------------------"
"RTN","GMTSONE",38,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",39,0)
 . W:$D(^UTILITY("DIQ1",$J,165.5,IEN,2000)) !," Division...................: ",^UTILITY("DIQ1",$J,165.5,IEN,2000)
"RTN","GMTSONE",40,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",41,0)
 . W !," Class of Case..............: ",^UTILITY("DIQ1",$J,165.5,IEN,.04)
"RTN","GMTSONE",42,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",43,0)
 . W !," Date Dx....................: ",^UTILITY("DIQ1",$J,165.5,IEN,3)
"RTN","GMTSONE",44,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",45,0)
 . W !," ICDO-Topography............: ",^UTILITY("DIQ1",$J,165.5,IEN,20)
"RTN","GMTSONE",46,0)
 . I ^UTILITY("DIQ1",$J,165.5,IEN,91)'="Complete" D  Q
"RTN","GMTSONE",47,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",48,0)
 . . W !," Abstract Status............: ",^UTILITY("DIQ1",$J,165.5,IEN,91)
"RTN","GMTSONE",49,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",50,0)
 . . W !!
"RTN","GMTSONE",51,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",52,0)
 . I ^UTILITY("DIQ1",$J,165.5,IEN,3,"I")<3010000 D
"RTN","GMTSONE",53,0)
 . . W !," Histology (ICD-O-2)........: ",^UTILITY("DIQ1",$J,165.5,IEN,22)
"RTN","GMTSONE",54,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",55,0)
 . I ^UTILITY("DIQ1",$J,165.5,IEN,3,"I")>3001231 D
"RTN","GMTSONE",56,0)
 . . W !," Histology (ICD-O-3)........: ",^UTILITY("DIQ1",$J,165.5,IEN,22.3)
"RTN","GMTSONE",57,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",58,0)
 . W !," Grade/Differentiation......: ",^UTILITY("DIQ1",$J,165.5,IEN,24)
"RTN","GMTSONE",59,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",60,0)
 . W !," Abstract Status............: ",^UTILITY("DIQ1",$J,165.5,IEN,91)
"RTN","GMTSONE",61,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",62,0)
 . W !
"RTN","GMTSONE",63,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",64,0)
 . W !," #",CNT," Stage of Disease at Diagnosis"
"RTN","GMTSONE",65,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",66,0)
 . W !," --------------------------------"
"RTN","GMTSONE",67,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",68,0)
 . W !," Size of Tumor..............: ",^UTILITY("DIQ1",$J,165.5,IEN,29)
"RTN","GMTSONE",69,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",70,0)
 . W !," Clinical T.................: ",^UTILITY("DIQ1",$J,165.5,IEN,37.1)
"RTN","GMTSONE",71,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",72,0)
 . W !," Clinical N.................: ",^UTILITY("DIQ1",$J,165.5,IEN,37.2)
"RTN","GMTSONE",73,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",74,0)
 . W !," Clinical M.................: ",^UTILITY("DIQ1",$J,165.5,IEN,37.3)
"RTN","GMTSONE",75,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",76,0)
 . W !," Clinical Stage Group.......: ",^UTILITY("DIQ1",$J,165.5,IEN,38)
"RTN","GMTSONE",77,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",78,0)
 . W !," Pathologic T...............: ",^UTILITY("DIQ1",$J,165.5,IEN,85)
"RTN","GMTSONE",79,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",80,0)
 . W !," Pathologic N...............: ",^UTILITY("DIQ1",$J,165.5,IEN,86)
"RTN","GMTSONE",81,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",82,0)
 . W !," Pathologic M...............: ",^UTILITY("DIQ1",$J,165.5,IEN,87)
"RTN","GMTSONE",83,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",84,0)
 . W !," Pathologic Stage Group.....: ",^UTILITY("DIQ1",$J,165.5,IEN,88)
"RTN","GMTSONE",85,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",86,0)
 . W !
"RTN","GMTSONE",87,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",88,0)
 . W !," #",CNT," First Course of Treatment"
"RTN","GMTSONE",89,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",90,0)
 . W !," ----------------------------"
"RTN","GMTSONE",91,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",92,0)
 . S TXT=^UTILITY("DIQ1",$J,165.5,IEN,58.1) D TXT
"RTN","GMTSONE",93,0)
 . W !," Non cancer-directed surgery: ",^UTILITY("DIQ1",$J,165.5,IEN,58.3)," ",TXT1
"RTN","GMTSONE",94,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",95,0)
 . W:TXT2'="" !,?41,TXT2
"RTN","GMTSONE",96,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",97,0)
 . S TXT=^UTILITY("DIQ1",$J,165.5,IEN,58.2) D TXT
"RTN","GMTSONE",98,0)
 . W !," Surgery of primary site....: ",^UTILITY("DIQ1",$J,165.5,IEN,50)," ",TXT1
"RTN","GMTSONE",99,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",100,0)
 . W:TXT2'="" !,?41,TXT2
"RTN","GMTSONE",101,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",102,0)
 . W !," Reason for no surgery......: ",^UTILITY("DIQ1",$J,165.5,IEN,58)
"RTN","GMTSONE",103,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",104,0)
 . W !," Radiation..................: ",^UTILITY("DIQ1",$J,165.5,IEN,51)," ",^UTILITY("DIQ1",$J,165.5,IEN,51.2)
"RTN","GMTSONE",105,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",106,0)
 . W !," Regional dose:cGy..........: ",^UTILITY("DIQ1",$J,165.5,IEN,442)
"RTN","GMTSONE",107,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",108,0)
 . W !," Radiation treatment volume.: ",^UTILITY("DIQ1",$J,165.5,IEN,125)
"RTN","GMTSONE",109,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",110,0)
 . W !," Intent of radiation........: ",^UTILITY("DIQ1",$J,165.5,IEN,127)
"RTN","GMTSONE",111,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",112,0)
 . W !," Radiation completion status: ",^UTILITY("DIQ1",$J,165.5,IEN,128)
"RTN","GMTSONE",113,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",114,0)
 . W !," Reason for no radiation....: ",^UTILITY("DIQ1",$J,165.5,IEN,75)
"RTN","GMTSONE",115,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",116,0)
 . W !," Chemotherapy...............: ",^UTILITY("DIQ1",$J,165.5,IEN,53)," ",^UTILITY("DIQ1",$J,165.5,IEN,53.2)
"RTN","GMTSONE",117,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",118,0)
 . W !," Reason for no chemotherapy.: ",^UTILITY("DIQ1",$J,165.5,IEN,76)
"RTN","GMTSONE",119,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",120,0)
 . W !," Hormone therapy............: ",^UTILITY("DIQ1",$J,165.5,IEN,54)," ",^UTILITY("DIQ1",$J,165.5,IEN,54.2)
"RTN","GMTSONE",121,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",122,0)
 . W !," Reason for no hormone tx...: ",^UTILITY("DIQ1",$J,165.5,IEN,77)
"RTN","GMTSONE",123,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",124,0)
 . W !," Immunotherapy..............: ",^UTILITY("DIQ1",$J,165.5,IEN,55)," ",^UTILITY("DIQ1",$J,165.5,IEN,55.2)
"RTN","GMTSONE",125,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",126,0)
 . W !," Other treatment............: ",^UTILITY("DIQ1",$J,165.5,IEN,57)," ",^UTILITY("DIQ1",$J,165.5,IEN,57.2)
"RTN","GMTSONE",127,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",128,0)
 . W !," Protocol eligibility status: ",^UTILITY("DIQ1",$J,165.5,IEN,346)
"RTN","GMTSONE",129,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",130,0)
 . W !," Protocol participation.....: ",^UTILITY("DIQ1",$J,165.5,IEN,560)
"RTN","GMTSONE",131,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",132,0)
 . W !
"RTN","GMTSONE",133,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",134,0)
 . I $D(ONC("SUB",IEN)) D
"RTN","GMTSONE",135,0)
 . . W !," #",CNT," Subsequent Treatment"
"RTN","GMTSONE",136,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",137,0)
 . . W !," -----------------------"
"RTN","GMTSONE",138,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",139,0)
 . . S SUBIEN=0
"RTN","GMTSONE",140,0)
 . . F SUBCNT=1:1 S SUBIEN=$O(ONC("SUB",IEN,SUBIEN)) Q:SUBIEN=""  D
"RTN","GMTSONE",141,0)
 . . . S SUBLET=$E(SUB,SUBCNT)
"RTN","GMTSONE",142,0)
 . . . S TXT=$G(ONC("SUB",IEN,SUBIEN,.04)) D TXT
"RTN","GMTSONE",143,0)
 . . . W !," ",SUBLET_"."," Surgery of primary site.: ",$G(ONC("SUB",IEN,SUBIEN,.041))," ",TXT1
"RTN","GMTSONE",144,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",145,0)
 . . . W:TXT2'="" !,?41,TXT2
"RTN","GMTSONE",146,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",147,0)
 . . . W !,"    Radiation...............: ",$G(ONC("SUB",IEN,SUBIEN,.051))," ",$G(ONC("SUB",IEN,SUBIEN,.05))
"RTN","GMTSONE",148,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",149,0)
 . . . W !,"    Chemotherapy............: ",$G(ONC("SUB",IEN,SUBIEN,.061))," ",$G(ONC("SUB",IEN,SUBIEN,.06))
"RTN","GMTSONE",150,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",151,0)
 . . . S TXT=$G(ONC("SUB",IEN,SUBIEN,.07)) D TXT
"RTN","GMTSONE",152,0)
 . . . W !,"    Hormone therapy.........: ",$G(ONC("SUB",IEN,SUBIEN,.071))," ",TXT1
"RTN","GMTSONE",153,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",154,0)
 . . . W:TXT2'="" !,?41,TXT2
"RTN","GMTSONE",155,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",156,0)
 . . . W !,"    Immunotherapy...........: ",$G(ONC("SUB",IEN,SUBIEN,.081))," ",$G(ONC("SUB",IEN,SUBIEN,.08))
"RTN","GMTSONE",157,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",158,0)
 . . . S TXT=$G(ONC("SUB",IEN,SUBIEN,.09)) D TXT
"RTN","GMTSONE",159,0)
 . . . W !,"    Other Treatment.........: ",$G(ONC("SUB",IEN,SUBIEN,.091))," ",TXT1
"RTN","GMTSONE",160,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",161,0)
 . . . W:TXT2'="" !,?41,TXT2
"RTN","GMTSONE",162,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",163,0)
 . . . W !
"RTN","GMTSONE",164,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",165,0)
 . W !," Cancer Status..............: ",^UTILITY("DIQ1",$J,165.5,IEN,95)
"RTN","GMTSONE",166,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",167,0)
 . W !
"RTN","GMTSONE",168,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",169,0)
 . W !
"RTN","GMTSONE",170,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",171,0)
 I '$D(ONC(160.04)) W ! Q
"RTN","GMTSONE",172,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",173,0)
 W " Follow-up"
"RTN","GMTSONE",174,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",175,0)
 W !," ---------"
"RTN","GMTSONE",176,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",177,0)
 S IEN=0 F CNT=1:1 S IEN=$O(ONC(160.04,IEN)) Q:IEN=""  D
"RTN","GMTSONE",178,0)
 . Q:ONC(160.04,IEN,.01)'=ONC(160,PTIEN_",",16)
"RTN","GMTSONE",179,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",180,0)
 . W !," Last Contact or Death......: ",$G(ONC(160.04,IEN,.01))
"RTN","GMTSONE",181,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",182,0)
 . W !," Vital Status...............: ",$G(ONC(160.04,IEN,1))
"RTN","GMTSONE",183,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",184,0)
 . W !," Following Registry.........: ",$G(ONC(160.04,IEN,10))
"RTN","GMTSONE",185,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",186,0)
 . W !
"RTN","GMTSONE",187,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",188,0)
 W !
"RTN","GMTSONE",189,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",190,0)
 K ^UTILITY("DIQ1",$J),CNT,DA,DIC,DIQ,DR,HSFLAG,IEN,LINE,LOS,NOP
"RTN","GMTSONE",191,0)
 K ONC,PTIEN,SUB,SUBIEN,SUBCNT,SUBLET,TSIEN,TXT,TXT1,TXT2
"RTN","GMTSONE",192,0)
 Q
"RTN","GMTSONE",193,0)
TXT ; Print Formatted Text
"RTN","GMTSONE",194,0)
 S (TXT1,TXT2)="",LOS=$L($G(TXT)) I LOS<40 S TXT1=$G(TXT) Q
"RTN","GMTSONE",195,0)
 S NOP=$L($E($G(TXT),1,40)," ")
"RTN","GMTSONE",196,0)
 S TXT1=$P($G(TXT)," ",1,NOP-1),TXT2=$P($G(TXT)," ",NOP,999)
"RTN","GMTSONE",197,0)
 Q
"RTN","GMTSP56")
0^^B4562930
"RTN","GMTSP56",1,0)
GMTSP56 ; CIO/SLC - Post Install GMTS*2.7*56    ; 08/27/2002
"RTN","GMTSP56",2,0)
 ;;2.7;Health Summary;**56**;Oct 20, 1995
"RTN","GMTSP56",3,0)
 ;
"RTN","GMTSP56",4,0)
 ; External References
"RTN","GMTSP56",5,0)
 ;   DBIA 10096  ^%ZOSF("DEL"
"RTN","GMTSP56",6,0)
 ;   DBIA 10096  ^%ZOSF("TEST"
"RTN","GMTSP56",7,0)
 ;   DBIA 10013  ^DIK
"RTN","GMTSP56",8,0)
 ;   DBIA 10141  BMES^XPDUTL
"RTN","GMTSP56",9,0)
 ;   DBIA 10141  MES^XPDUTL
"RTN","GMTSP56",10,0)
 ;                   
"RTN","GMTSP56",11,0)
 Q
"RTN","GMTSP56",12,0)
POST ; Post-Install
"RTN","GMTSP56",13,0)
 N GMTSRTN,GMTSEXT,GMTSCMP,GMTSDEL S GMTSDEL=0
"RTN","GMTSP56",14,0)
 D BM(" Checking for obsolete components NTM and MEAS")
"RTN","GMTSP56",15,0)
 S GMTSRTN="GMTSPXM",GMTSEXT="PXRHS09",GMTSCMP="NTM" D CHKDEL
"RTN","GMTSP56",16,0)
 S GMTSRTN="GMTSPXMP",GMTSEXT="PXRHS20",GMTSCMP="MEAS" D CHKDEL
"RTN","GMTSP56",17,0)
 I +($G(GMTSDEL))=0 D M("   Components not found, nothing deleted")
"RTN","GMTSP56",18,0)
 Q
"RTN","GMTSP56",19,0)
CHKDEL ; Check and Delete
"RTN","GMTSP56",20,0)
 Q:'$L($G(GMTSRTN))  Q:'$L($G(GMTSEXT))  Q:'$L($G(GMTSCMP))
"RTN","GMTSP56",21,0)
 N GMTSROK,GMTSEOK,GMTSCPI,X
"RTN","GMTSP56",22,0)
 S GMTSEOK=$$ROK(GMTSEXT) Q:+GMTSEOK>0
"RTN","GMTSP56",23,0)
 S GMTSROK=$$ROK(GMTSRTN),GMTSCPI=$O(^GMT(142.1,"C",GMTSCMP,0))
"RTN","GMTSP56",24,0)
 I +GMTSCPI>0 D
"RTN","GMTSP56",25,0)
 . N DA,DIK,GMTSTY,GMTSST S GMTSTY=0,GMTSDEL=+($G(GMTSDEL))+1
"RTN","GMTSP56",26,0)
 . D M(("   Deleting Component "_$P($G(^GMT(142.1,+GMTSCPI,0)),"^",1)))
"RTN","GMTSP56",27,0)
 . F  S GMTSTY=$O(^GMT(142,"AE",GMTSCPI,GMTSTY)) Q:+GMTSTY=0  D
"RTN","GMTSP56",28,0)
 . . S GMTSST=0 F  S GMTSST=$O(^GMT(142,"AE",GMTSCPI,GMTSTY,GMTSST)) Q:+GMTSST=0  D
"RTN","GMTSP56",29,0)
 . . . S DA(1)=+GMTSTY,DA=+GMTSST,DIK="^GMT(142,"_DA(1)_",1," D ^DIK
"RTN","GMTSP56",30,0)
 . S DA=GMTSCPI,DIK="^GMT(142.1," D ^DIK
"RTN","GMTSP56",31,0)
 S X=GMTSRTN X ^%ZOSF("DEL")
"RTN","GMTSP56",32,0)
 S GMTSROK=$$ROK(GMTSRTN)
"RTN","GMTSP56",33,0)
 Q
"RTN","GMTSP56",34,0)
ROK(X) ; Routine OK
"RTN","GMTSP56",35,0)
 S X=$G(X) Q:'$L(X) 0  Q:$L(X)>8 0  X ^%ZOSF("TEST") Q:$T 1  Q 0
"RTN","GMTSP56",36,0)
BM(X) ;   Blank Line with Message
"RTN","GMTSP56",37,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSP56",38,0)
M(X) ;   Message
"RTN","GMTSP56",39,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSP56",40,0)
UP(X) ;   Uppercase
"RTN","GMTSP56",41,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSPCD")
0^21^B7068645
"RTN","GMTSPCD",1,0)
GMTSPCD ; SLC/DLT,KER - Queue HS Batch Print Clinic by Date ; 08/27/2002
"RTN","GMTSPCD",2,0)
 ;;2.7;Health Summary;**28,56**;Oct 20, 1995
"RTN","GMTSPCD",3,0)
 ;
"RTN","GMTSPCD",4,0)
 ; External References
"RTN","GMTSPCD",5,0)
 ;   DBIA  10026  ^DIR
"RTN","GMTSPCD",6,0)
 ;   DBIA  10063  ^%ZTLOAD
"RTN","GMTSPCD",7,0)
 ;   DBIA  10040  ^SC("B")
"RTN","GMTSPCD",8,0)
 ;   DBIA  10040  ^SC(  file #44
"RTN","GMTSPCD",9,0)
 ;   DBIA  10006  ^DIC  (file #44 and 3.5)
"RTN","GMTSPCD",10,0)
 ;   DBIA  10000  NOW^%DTC
"RTN","GMTSPCD",11,0)
 ;                        
"RTN","GMTSPCD",12,0)
MAIN ; Controls branching
"RTN","GMTSPCD",13,0)
 W !!,"This option will queue Health Summaries for a specified Visit Date"
"RTN","GMTSPCD",14,0)
 W !,"for all Outpatient Clinics with Appointments on that Visit Date.",!!
"RTN","GMTSPCD",15,0)
 N GMTSCDT
"RTN","GMTSPCD",16,0)
 S GMTSCDT=$$SELDATE Q:GMTSCDT'>0
"RTN","GMTSPCD",17,0)
 W ! N DIR S DIR(0)="D^::%DT",DIR("A")="Date and Time to Queue this Job to run",DIR("B")="NOW" D ^DIR Q:($D(DTOUT)!($D(DUOUT))!($D(DIROUT)))
"RTN","GMTSPCD",18,0)
 S ZTDTH=Y,ZTIO="",ZTSAVE("GMTSCDT")=""
"RTN","GMTSPCD",19,0)
 S ZTRTN="CLINICQ^GMTSPCD",ZTDESC="Create Task HS Jobs for Clinics by Visit Date"
"RTN","GMTSPCD",20,0)
 D ^%ZTLOAD
"RTN","GMTSPCD",21,0)
 Q
"RTN","GMTSPCD",22,0)
CLINICQ ; Loop thru clinics for appointments
"RTN","GMTSPCD",23,0)
 ;   Date stored in GMTSCDT 
"RTN","GMTSPCD",24,0)
 N GMTSDATE,GMTSTYP,GMTSCLN,GMTSCL,LTYPE,GMW,X
"RTN","GMTSPCD",25,0)
 S GMTSCLN=0
"RTN","GMTSPCD",26,0)
 ;   Using "B" xref so print out is numeric/alphabetic
"RTN","GMTSPCD",27,0)
 F  S GMTSCLN=$O(^SC("B",GMTSCLN))  Q:GMTSCLN=""  D
"RTN","GMTSPCD",28,0)
 . S GMTSCL=$O(^SC("B",GMTSCLN,0))
"RTN","GMTSPCD",29,0)
 . Q:$P($G(^SC(GMTSCL,0)),U,3)'="C"
"RTN","GMTSPCD",30,0)
 . S GMTSDATE=+$O(^SC(GMTSCL,"S",GMTSCDT))  Q:'GMTSDATE  Q:GMTSDATE'[GMTSCDT
"RTN","GMTSPCD",31,0)
 . S GMTSTYP=0 S GMTSTYP=$O(^GMT(142,"D",GMTSCL,GMTSTYP)) Q:+GMTSTYP'>0  D QUEUE
"RTN","GMTSPCD",32,0)
 Q
"RTN","GMTSPCD",33,0)
QUEUE ; Queues HS batch print for particular HS Type and Location.
"RTN","GMTSPCD",34,0)
 N DIC,GMPSAP,GMTSCLI,GMTSLOC,GMTSSC,GMTSIO,GMTSDYS,GMV,QUEQIT,X,Y
"RTN","GMTSPCD",35,0)
 S QUEQIT=0
"RTN","GMTSPCD",36,0)
 S GMTSCLI=$O(^GMT(142,GMTSTYP,20,"B",GMTSCL,0))
"RTN","GMTSPCD",37,0)
 S GMTSLOC=$G(^GMT(142,GMTSTYP,20,GMTSCLI,0))
"RTN","GMTSPCD",38,0)
 S X=+GMTSLOC,DIC=44,DIC(0)="NXZ" D ^DIC
"RTN","GMTSPCD",39,0)
 I $S(+Y'>0:1,"WCOR"'[$P($G(Y(0)),U,3):1,1:0) Q
"RTN","GMTSPCD",40,0)
 S GMTSSC(1)=Y_U_$P(Y(0),U,3),$P(GMTSSC(1),U,4)=GMTSCDT
"RTN","GMTSPCD",41,0)
 S GMPSAP=$S($P(GMTSLOC,U,3)="Y":1,1:0)
"RTN","GMTSPCD",42,0)
 S ZTIO=$$GETIO($P(GMTSLOC,U,2)) Q:'$L(ZTIO)
"RTN","GMTSPCD",43,0)
 S ZTDTH=$H,ZTRTN="MAIN^GMTSPL",ZTDESC="Clinic Health Summaries by Visit Date"
"RTN","GMTSPCD",44,0)
 F GMV="GMTSTYP","GMPSAP" S ZTSAVE(GMV)=""
"RTN","GMTSPCD",45,0)
 S ZTSAVE("GMTSSC(")=""
"RTN","GMTSPCD",46,0)
 D ^%ZTLOAD
"RTN","GMTSPCD",47,0)
 Q
"RTN","GMTSPCD",48,0)
GETIO(X) ; Get device for queueing
"RTN","GMTSPCD",49,0)
 N %,%Y,C,DIC,Y
"RTN","GMTSPCD",50,0)
 S DIC=3.5,DIC(0)="NXZ" D ^DIC S Y=$S(+Y'>0:"",1:$P(Y(0),U))
"RTN","GMTSPCD",51,0)
 Q Y
"RTN","GMTSPCD",52,0)
SELDATE() ; Allows entry of Visit/Surgery date or date range
"RTN","GMTSPCD",53,0)
 ; for Print-by-Clinic
"RTN","GMTSPCD",54,0)
 N %,%H,%I,DIR,DEFDT,X,Y
"RTN","GMTSPCD",55,0)
 D NOW^%DTC S (X,DT)=$P(%,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPCD",56,0)
 S DIR(0)="D^::EX",DIR("B")=DEFDT
"RTN","GMTSPCD",57,0)
 S DIR("A")="Please enter the Visit date"
"RTN","GMTSPCD",58,0)
 D ^DIR
"RTN","GMTSPCD",59,0)
 I Y="^^" S DIROUT=1
"RTN","GMTSPCD",60,0)
 Q Y
"RTN","GMTSPDX")
0^15^B23710456
"RTN","GMTSPDX",1,0)
GMTSPDX ;SLC/JER,SBW - PDX Health Summary Driver ; 08/27/2002
"RTN","GMTSPDX",2,0)
 ;;2.7;Health Summary;56;Oct 20, 1995
"RTN","GMTSPDX",3,0)
 ;
"RTN","GMTSPDX",4,0)
 ; External References
"RTN","GMTSPDX",5,0)
 ;   DBIA   298  ^VAT(394.61
"RTN","GMTSPDX",6,0)
 ;   DBIA   820  ^VAT(394.71
"RTN","GMTSPDX",7,0)
 ;   DBIA   819  $$ENCDSP^VAQHSH
"RTN","GMTSPDX",8,0)
 ;   DBIA   818  $$NCRYPTON^VAQUTL2
"RTN","GMTSPDX",9,0)
 ;   DBIA   817  $$TRANENC^VAQUTL3
"RTN","GMTSPDX",10,0)
 ;   DBIA  3587  ^XMB(3.51
"RTN","GMTSPDX",11,0)
 ;   DBIA  2056  $$GET1^DIQ (file 3.51)
"RTN","GMTSPDX",12,0)
 ;   DBIA  3588  ^XMBS(3.519
"RTN","GMTSPDX",13,0)
 ;   DBIA   999  ^DD(142.99
"RTN","GMTSPDX",14,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSPDX",15,0)
 ;   DBIA 10086  ^%ZIS
"RTN","GMTSPDX",16,0)
 ;   DBIA 10089  ^%ZISC
"RTN","GMTSPDX",17,0)
 ;   DBIA 10004  Y^DIQ
"RTN","GMTSPDX",18,0)
 ;   DBIA  1092  DSD^ZISPL
"RTN","GMTSPDX",19,0)
 ;   DBIA  1092  DSDOC^ZISPL
"RTN","GMTSPDX",20,0)
 ;                    
"RTN","GMTSPDX",21,0)
GET(TRAN,DFN,SEGPTR,ROOT,GMTSLCNT,GMTSDLM,GMTSNDM) ; Get HS for PDX
"RTN","GMTSPDX",22,0)
 ;                       
"RTN","GMTSPDX",23,0)
 ; Data retrieved from HS is return in ROOT parameter
"RTN","GMTSPDX",24,0)
 ; reference passing.  Function returns 2 piece 
"RTN","GMTSPDX",25,0)
 ; variable delimited with "^".
"RTN","GMTSPDX",26,0)
 ;                     
"RTN","GMTSPDX",27,0)
 ;   Piece 1 = tot line cnt of data extract to ROOT.
"RTN","GMTSPDX",28,0)
 ;   Piece 2 = contains entry line cnt (GMTSLCNT) + Piece 1
"RTN","GMTSPDX",29,0)
 ;                  
"RTN","GMTSPDX",30,0)
 ; Note: Currently Data begins with GMTSLCNT + 1 and
"RTN","GMTSPDX",31,0)
 ;       Piece 2 is last node # of ROOT
"RTN","GMTSPDX",32,0)
 ;                        
"RTN","GMTSPDX",33,0)
 ;     If TRAN is passed
"RTN","GMTSPDX",34,0)
 ;         The patient pointer of the transaction will be used
"RTN","GMTSPDX",35,0)
 ;         Encryption will be based on the transaction
"RTN","GMTSPDX",36,0)
 ;                        
"RTN","GMTSPDX",37,0)
 ;     If DFN is passed
"RTN","GMTSPDX",38,0)
 ;         Encryption will be based on the site parameter
"RTN","GMTSPDX",39,0)
 ;                        
"RTN","GMTSPDX",40,0)
 ;     Pointer to transaction takes precedence over DFN ... if
"RTN","GMTSPDX",41,0)
 ;         TRAN>0 the DFN will be based on the transaction
"RTN","GMTSPDX",42,0)
 ;                         
"RTN","GMTSPDX",43,0)
 ;   Determin true DFN
"RTN","GMTSPDX",44,0)
 S TRAN=+$G(TRAN),DFN=+$G(DFN)
"RTN","GMTSPDX",45,0)
 Q:(('TRAN)&('DFN)) "-1^Did not pass pointer to transaction or patient"
"RTN","GMTSPDX",46,0)
 I (TRAN) Q:('$D(^VAT(394.61,TRAN))) "-1^Did not pass valid pointer to VAQ - TRANSACTION file"
"RTN","GMTSPDX",47,0)
 I (TRAN) S DFN=+$P($G(^VAT(394.61,TRAN,0)),"^",3) Q:('DFN) "-1^Transaction did not contain pointer to PATIENT file"
"RTN","GMTSPDX",48,0)
 Q:('$D(^DPT(DFN))) "-1^Did not pass valid pointer to PATIENT file"
"RTN","GMTSPDX",49,0)
 ;   NEW variables not cleaned up by %ZIS SPOOLER call
"RTN","GMTSPDX",50,0)
 N C,D0,DA,DI,DIE,DIC,DQ,DR,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM
"RTN","GMTSPDX",51,0)
 N GMTSDUZ,GMTSLO,GMTSLPG,GMTSPNM,GMTSRB,GMTSSN,GMTSSPL,GMTSWARD,GMTSY
"RTN","GMTSPDX",52,0)
 N SEX,SPLDOC,VADM,VAERR,VAIN,X,Y,ZISIOST,LINES,INCOMP
"RTN","GMTSPDX",53,0)
 N %,%X,%XX,%Y,%YY,%Z4,%ZDA,%ZS,%ZY,POP,Y,C
"RTN","GMTSPDX",54,0)
 S GMTSDUZ=$G(DUZ),DUZ=.5
"RTN","GMTSPDX",55,0)
 S Y=$P($G(^GMT(142.99,1,0)),U,4),C=$P(^DD(142.99,.04,0),U,2)
"RTN","GMTSPDX",56,0)
 D Y^DIQ
"RTN","GMTSPDX",57,0)
 S GMTSSPL=Y
"RTN","GMTSPDX",58,0)
 I GMTSSPL']"" S GMTSY="-1^No Spool Device allocated" G GETX
"RTN","GMTSPDX",59,0)
 ;   Convert SEGPTR to entry in file 142.1
"RTN","GMTSPDX",60,0)
 S X=+$P($G(^VAT(394.71,SEGPTR,0)),"^",4)
"RTN","GMTSPDX",61,0)
 I ('X) S GMTSY="-1^Unable to convert PDX data segment to Health Summary component" G GETX
"RTN","GMTSPDX",62,0)
 S SEGPTR=X
"RTN","GMTSPDX",63,0)
 ;   Determin if Component has benn disabled
"RTN","GMTSPDX",64,0)
 S X=$G(^GMT(142.1,SEGPTR,0))
"RTN","GMTSPDX",65,0)
 I (($P(X,"^",6)="T")!($P(X,"^",6)="P")) D  G GETX
"RTN","GMTSPDX",66,0)
 .S GMTSY=$P(X,"^",8)
"RTN","GMTSPDX",67,0)
 .I (GMTSY'="") S GMTSY="-1^"_GMTSY Q
"RTN","GMTSPDX",68,0)
 .S GMTSY="-1^Component has been disabled  "
"RTN","GMTSPDX",69,0)
 .S GMTSY=GMTSY_$S($P(X,"^",6)="T":"(temporary)",1:"(permanent)")
"RTN","GMTSPDX",70,0)
 ;   Open SPOOL Device
"RTN","GMTSPDX",71,0)
 S IOP=GMTSSPL_";HSPDX"_DFN D ^%ZIS
"RTN","GMTSPDX",72,0)
 I POP S GMTSY="-1^Spool open failed" G GETX
"RTN","GMTSPDX",73,0)
 ;   Write Component
"RTN","GMTSPDX",74,0)
 D ONECOMP(DFN,SEGPTR,$G(GMTSDLM),$G(GMTSNDM))
"RTN","GMTSPDX",75,0)
 S SPLDOC=$G(IO("SPOOL")) D ^%ZISC
"RTN","GMTSPDX",76,0)
 I +SPLDOC D
"RTN","GMTSPDX",77,0)
 . N SPLSTAT,SPLPTR,LINES,INCOMP
"RTN","GMTSPDX",78,0)
 . ;   Wait until document is "ready" (Check every 5 seconds)
"RTN","GMTSPDX",79,0)
 . F  Q:$$GET1^DIQ(3.51,(+SPLDOC_","),2,"I")="r"  H 5
"RTN","GMTSPDX",80,0)
 . S SPLPTR=$$GET1^DIQ(3.51,(+SPLDOC_","),9,"I")
"RTN","GMTSPDX",81,0)
 . S LINES=$$GET1^DIQ(3.51,(+SPLDOC_","),8,"I")
"RTN","GMTSPDX",82,0)
 . S INCOMP=+($$GET1^DIQ(3.51,(+SPLDOC_","),10,"I"))
"RTN","GMTSPDX",83,0)
 . I '+SPLPTR!('+LINES) S GMTSY="-1^No data available" Q
"RTN","GMTSPDX",84,0)
 . S GMTSY=$$XFER(SPLPTR,ROOT,INCOMP,+$G(GMTSLCNT))
"RTN","GMTSPDX",85,0)
 . D DSDOC^ZISPL(SPLDOC),DSD^ZISPL(SPLPTR)
"RTN","GMTSPDX",86,0)
 . ;   Check to see if Encryption is ON
"RTN","GMTSPDX",87,0)
 . S:(TRAN) X=$$TRANENC^VAQUTL3(TRAN,0)
"RTN","GMTSPDX",88,0)
 . S:('TRAN) X=$$NCRYPTON^VAQUTL2(0)
"RTN","GMTSPDX",89,0)
 . S:(X) X=$$ENCDSP^VAQHSH(TRAN,ROOT,X,(GMTSLCNT+1),+GMTSY)
"RTN","GMTSPDX",90,0)
 E  S GMTSY="-1^Spool document not created"
"RTN","GMTSPDX",91,0)
GETX ;   End Getting HS for PDX
"RTN","GMTSPDX",92,0)
 S DUZ=+$G(GMTSDUZ)
"RTN","GMTSPDX",93,0)
 Q $G(GMTSY)
"RTN","GMTSPDX",94,0)
 ;                  
"RTN","GMTSPDX",95,0)
ONECOMP(DFN,SEGPTR,GMTSDLM,GMTSNDM) ; Print a single HS component to IO
"RTN","GMTSPDX",96,0)
 N GMTSEG,GMTSEGI,GMTSEGC,GMTSTITL
"RTN","GMTSPDX",97,0)
 S GMTSTITL="PDX TRANSMISSION"
"RTN","GMTSPDX",98,0)
 S GMTSEG(1)=1_U_SEGPTR_U_$G(GMTSNDM)_U_$G(GMTSDLM)_U_U_"N"_U_"L"_U_"Y"
"RTN","GMTSPDX",99,0)
 S (GMTSEGI(SEGPTR),GMTSEGC)=1
"RTN","GMTSPDX",100,0)
 D EN^GMTS1
"RTN","GMTSPDX",101,0)
 Q
"RTN","GMTSPDX",102,0)
 ;                  
"RTN","GMTSPDX",103,0)
XFER(SPLDAT,ROOT,INCOMP,GMTSLCNT) ; Transfer text from SPOOL DOC to ROOT
"RTN","GMTSPDX",104,0)
 N GMTSI,GMTSL,GMTSREC,GMTSPRT,GMTSX S (GMTSI,GMTSL)=0,GMTSPRT=1
"RTN","GMTSPDX",105,0)
 F  S GMTSI=$O(^XMBS(3.519,SPLDAT,2,GMTSI)) Q:+GMTSI'>0  D  Q:$E(GMTSREC,1,7)="*** END"
"RTN","GMTSPDX",106,0)
 . S GMTSREC=$G(^XMBS(3.519,SPLDAT,2,GMTSI,0))
"RTN","GMTSPDX",107,0)
 . ;                              
"RTN","GMTSPDX",108,0)
 . ;   Don't transfer data until a line with 3 hyphens or 
"RTN","GMTSPDX",109,0)
 . ;   ** DECEASED ** is found nor after "*** END" is found
"RTN","GMTSPDX",110,0)
 . ;                              
"RTN","GMTSPDX",111,0)
 . I (GMTSL=0&($E(GMTSREC,1,3)="---")!(GMTSREC["** DECEASED **"))!((GMTSL>0)&($E(GMTSREC,1,7)'="*** END")) D
"RTN","GMTSPDX",112,0)
 . . I GMTSREC["|TOP|" S GMTSPRT=0
"RTN","GMTSPDX",113,0)
 . . S:GMTSPRT GMTSL=GMTSL+1,GMTSLCNT=GMTSLCNT+1,@ROOT@("DISPLAY",GMTSLCNT,0)=GMTSREC
"RTN","GMTSPDX",114,0)
 . . I GMTSREC["(continued)" S GMTSPRT=1
"RTN","GMTSPDX",115,0)
 ;   Incomplete Report Indicator
"RTN","GMTSPDX",116,0)
 I +GMTSL,+($G(INCOMP)) D
"RTN","GMTSPDX",117,0)
 . S GMTSL=GMTSL+1,@ROOT@("DISPLAY",GMTSL,0)="*** Data is incomplete ***"
"RTN","GMTSPDX",118,0)
 ;   Transfer Failed
"RTN","GMTSPDX",119,0)
 I '+GMTSL S GMTSL="-1^Text transfer from Spool Document failed"
"RTN","GMTSPDX",120,0)
 Q $G(GMTSL)_U_$G(GMTSLCNT)
"RTN","GMTSPNJ")
0^16^B12013409
"RTN","GMTSPNJ",1,0)
GMTSPNJ ;SLC/JER - Nightly Job to Queue HS Batch Print-by-Loc ; 08/27/2002
"RTN","GMTSPNJ",2,0)
 ;;2.7;Health Summary;**5,56**;Oct 20, 1995
"RTN","GMTSPNJ",3,0)
 ;
"RTN","GMTSPNJ",4,0)
 ; External References
"RTN","GMTSPNJ",5,0)
 ;   DBIA 10000  C^%DTC
"RTN","GMTSPNJ",6,0)
 ;   DBIA 10000  NOW^%DTC
"RTN","GMTSPNJ",7,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","GMTSPNJ",8,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSPNJ",9,0)
 ;   DBIA  2051  FIND^DIC
"RTN","GMTSPNJ",10,0)
 ;   DBIA 10103  $$DOW^XLFDT
"RTN","GMTSPNJ",11,0)
 ;                   
"RTN","GMTSPNJ",12,0)
 ; Sets GMTSSC=location pointer
"RTN","GMTSPNJ",13,0)
 ; If clinic, sets GMTSCDT=desired appt day
"RTN","GMTSPNJ",14,0)
 ;                   
"RTN","GMTSPNJ",15,0)
 ; Summaries are considered ready Today if GMTSPNJ
"RTN","GMTSPNJ",16,0)
 ; run time is today between 24:00 and 12:00, ready
"RTN","GMTSPNJ",17,0)
 ; Tomorrow if run time is today between 12:00 and
"RTN","GMTSPNJ",18,0)
 ; 24:00.
"RTN","GMTSPNJ",19,0)
 ;                   
"RTN","GMTSPNJ",20,0)
MAIN ; Controls branching
"RTN","GMTSPNJ",21,0)
 N GMTSTYP,GMTSCL,GMW,X
"RTN","GMTSPNJ",22,0)
 S GMTSTYP=0 F  S GMTSTYP=$O(^GMT(142,GMTSTYP)) Q:+GMTSTYP'>0  D
"RTN","GMTSPNJ",23,0)
 . S GMTSCL=0 F  S GMTSCL=$O(^GMT(142,GMTSTYP,20,GMTSCL)) Q:+GMTSCL'>0  D QUEUE
"RTN","GMTSPNJ",24,0)
 Q
"RTN","GMTSPNJ",25,0)
QUEUE ; Queues HS batch print for HS Type and Location
"RTN","GMTSPNJ",26,0)
 N DIC,GMPSAP,GMTSLOC,GMTSSC,GMTSIO,GMTSDYS,GMV,QUEQIT,X,Y,DAY,NEWDAY
"RTN","GMTSPNJ",27,0)
 N GMTSQ,BEGDT,ENDDT,PDATE
"RTN","GMTSPNJ",28,0)
 S QUEQIT=0
"RTN","GMTSPNJ",29,0)
 S GMTSLOC=$G(^GMT(142,GMTSTYP,20,GMTSCL,0))
"RTN","GMTSPNJ",30,0)
 S X=+GMTSLOC,DIC=44,DIC(0)="NXZ" D ^DIC
"RTN","GMTSPNJ",31,0)
 I $S(+Y'>0:1,"WCOR"'[$P($G(Y(0)),U,3):1,1:0) Q
"RTN","GMTSPNJ",32,0)
 S GMTSSC=Y_U_$P(Y(0),U,3)
"RTN","GMTSPNJ",33,0)
 I "COR"[$P(GMTSSC,U,3) D  Q
"RTN","GMTSPNJ",34,0)
 . S DAY=+$P(GMTSLOC,U,4)
"RTN","GMTSPNJ",35,0)
 . ;   Don't print in advance
"RTN","GMTSPNJ",36,0)
 . I DAY'>0 S $P(GMTSSC,U,4)=$$GETDATE(DAY) D QCONT Q
"RTN","GMTSPNJ",37,0)
 . S BEGDT=$$GETDATE(0),ENDDT=$$GETDATE(DAY)
"RTN","GMTSPNJ",38,0)
 . Q:$$NONWDAY(BEGDT)
"RTN","GMTSPNJ",39,0)
 . S NEWDAY=$$WKEND(DAY,BEGDT,ENDDT)
"RTN","GMTSPNJ",40,0)
 . ;   Get last date to be printed
"RTN","GMTSPNJ",41,0)
 . S PDATE=$$GETDATE(+NEWDAY)
"RTN","GMTSPNJ",42,0)
 . F  D  Q:+$G(GMTSQ)
"RTN","GMTSPNJ",43,0)
 . . ;     Set variable before doing QCONT
"RTN","GMTSPNJ",44,0)
 . . S $P(GMTSSC,U,4)=PDATE
"RTN","GMTSPNJ",45,0)
 . . D QCONT
"RTN","GMTSPNJ",46,0)
 . . ;     Decrement to get previous day
"RTN","GMTSPNJ",47,0)
 . . S NEWDAY=NEWDAY-1
"RTN","GMTSPNJ",48,0)
 . . ;     Quit For Loop when non-workdays data has been printed
"RTN","GMTSPNJ",49,0)
 . . I DAY>NEWDAY S GMTSQ=1 Q
"RTN","GMTSPNJ",50,0)
 . . ;     Get date
"RTN","GMTSPNJ",51,0)
 . . S PDATE=$$GETDATE(+NEWDAY)
"RTN","GMTSPNJ",52,0)
 . . ;     Quit For Loop if there's a work
"RTN","GMTSPNJ",53,0)
 . . ;     day between Holiday and Weekend.
"RTN","GMTSPNJ",54,0)
 . . ;     Don't print weekend data twice.
"RTN","GMTSPNJ",55,0)
 . . I +$$NONWDAY(PDATE)'>0 S GMTSQ=1 Q
"RTN","GMTSPNJ",56,0)
 ;                       
"RTN","GMTSPNJ",57,0)
QCONT ; Used so following can be done for 
"RTN","GMTSPNJ",58,0)
 ; multiple dates for Clinics and ORs.
"RTN","GMTSPNJ",59,0)
 I $$CKPAT^GMTSPD(GMTSSC)'>0 Q
"RTN","GMTSPNJ",60,0)
 S GMPSAP=$S($P(GMTSLOC,U,3)="Y":1,1:0)
"RTN","GMTSPNJ",61,0)
 S ZTIO=$$GETIO($P(GMTSLOC,U,2)) Q:'$L(ZTIO)
"RTN","GMTSPNJ",62,0)
 S ZTDTH=$H,ZTRTN="MAIN^GMTSPL",ZTDESC="Health Summary"
"RTN","GMTSPNJ",63,0)
 F GMV="GMTSTYP","GMTSSC","GMPSAP" S ZTSAVE(GMV)=""
"RTN","GMTSPNJ",64,0)
 D ^%ZTLOAD
"RTN","GMTSPNJ",65,0)
 Q
"RTN","GMTSPNJ",66,0)
 ;                       
"RTN","GMTSPNJ",67,0)
GETDATE(DAYS) ; Gets desired Visit/Surgery date
"RTN","GMTSPNJ",68,0)
 ;   Receives: DAYS=Print Days ahead
"RTN","GMTSPNJ",69,0)
 ;   Returns:  FileMan Date/time
"RTN","GMTSPNJ",70,0)
 N %,%H,%I,%T,GMTSDT,GMTSPM,X1,X2,X
"RTN","GMTSPNJ",71,0)
 D NOW^%DTC S GMTSDT=$P(%,"."),GMTSPM=$S(+$E($P(%,".",2),1,2)>12:1,1:0)
"RTN","GMTSPNJ",72,0)
 S X1=GMTSDT,X2=DAYS+GMTSPM D C^%DTC
"RTN","GMTSPNJ",73,0)
 Q X
"RTN","GMTSPNJ",74,0)
 ;                       
"RTN","GMTSPNJ",75,0)
NONWDAY(GMTSDT) ; Determines if non work day (i.e. Sat., Sun., or Holiday) 
"RTN","GMTSPNJ",76,0)
 ; Returns 1 if print day is weekend or holiday
"RTN","GMTSPNJ",77,0)
 N DAYNAME
"RTN","GMTSPNJ",78,0)
 S DAYNAME=$$DOW^XLFDT(GMTSDT)
"RTN","GMTSPNJ",79,0)
 Q $S(DAYNAME="Saturday":1,DAYNAME="Sunday":1,$$HOLIDAY(GMTSDT):1,1:0)
"RTN","GMTSPNJ",80,0)
 ;                       
"RTN","GMTSPNJ",81,0)
WKEND(DAY,BEGDT,ENDDT) ; Updates days in advance for weekend and holiday dates
"RTN","GMTSPNJ",82,0)
 N GMI,X1,X2,X,%H,DAYNAME
"RTN","GMTSPNJ",83,0)
 F GMI=1:1 S X1=BEGDT,X2=GMI D C^%DTC Q:X>ENDDT  D
"RTN","GMTSPNJ",84,0)
 . S DAYNAME=$$DOW^XLFDT(X)
"RTN","GMTSPNJ",85,0)
 . I DAYNAME="Saturday"!(DAYNAME="Sunday")!($$HOLIDAY(X)) S DAY=DAY+1,ENDDT=$$GETDATE(DAY)
"RTN","GMTSPNJ",86,0)
 . ;   If one of days is Saturday, Sunday, or holiday, 
"RTN","GMTSPNJ",87,0)
 . ;   up days by one and recalculate ending date
"RTN","GMTSPNJ",88,0)
 Q DAY
"RTN","GMTSPNJ",89,0)
 ;                       
"RTN","GMTSPNJ",90,0)
HOLIDAY(GMDT) ; Determines if a date is a Holiday.
"RTN","GMTSPNJ",91,0)
 ;   Requires that the Holiday (#40.5) file is updated
"RTN","GMTSPNJ",92,0)
 ;   to determine if a date is a holiday.
"RTN","GMTSPNJ",93,0)
 N GMDATE
"RTN","GMTSPNJ",94,0)
 D FIND^DIC(40.5,"",.01,"QX",GMDT,1,"","","","GMDATE")
"RTN","GMTSPNJ",95,0)
 Q +$G(GMDATE("DILIST",0))
"RTN","GMTSPNJ",96,0)
 ;                       
"RTN","GMTSPNJ",97,0)
GETIO(X) ; Get device for queueing
"RTN","GMTSPNJ",98,0)
 N %,%Y,C,DIC,Y
"RTN","GMTSPNJ",99,0)
 S DIC=3.5,DIC(0)="NXZ" D ^DIC S Y=$S(+Y'>0:"",1:$P(Y(0),U))
"RTN","GMTSPNJ",100,0)
 Q Y
"RTN","GMTSPNSL")
0^17^B2225185
"RTN","GMTSPNSL",1,0)
GMTSPNSL ; SLC/KER - Progress Note - Selected          ; 08/27/2002
"RTN","GMTSPNSL",2,0)
 ;;2.7;Health Summary;**12,30,35,45,56**;Oct 20, 1995
"RTN","GMTSPNSL",3,0)
 ;                          
"RTN","GMTSPNSL",4,0)
 ; External References
"RTN","GMTSPNSL",5,0)
 ;    DBIA  3062  MAIN^TIULAPIS
"RTN","GMTSPNSL",6,0)
 ;    DBIA  2056  $$GET1^DIQ (file #8925.1)
"RTN","GMTSPNSL",7,0)
 ;                     
"RTN","GMTSPNSL",8,0)
MAIN ; Control branching
"RTN","GMTSPNSL",9,0)
 N ADATE,ASUB,ATDATE,ATTYPE,ATYPE,CHILD,COSGEDBY,CURIEN,GMTSA,GMTSAI
"RTN","GMTSPNSL",10,0)
 N GMTSAII,GMTSCNT,GMTSD,GMTSDIC,GMTSEXSG,GMTSI,GMTSIEN,GMTSII,GMTSIQ
"RTN","GMTSPNSL",11,0)
 N GMTSJ,GMTSK,GMTSODIC,GMTSPDIC,GMTSTDIC,GMTSPR,GMTSREC,GMTST,GMTSX
"RTN","GMTSPNSL",12,0)
 N GMTSXTRA,GMTDOC,I,PARIEN,PDATE,PN,PSUB,PTYPE,REASON,SIGNEDBY,TYPE
"RTN","GMTSPNSL",13,0)
 N TIUDOC,TIUSTAT,GMTSTIUC,X,Y K ^TMP("TIU",$J) S GMTSX=1,GMTSI=0,GMTSTIUC="P"
"RTN","GMTSPNSL",14,0)
 F  S GMTSI=$O(GMTSEG(+GMTSEGN,8925.1,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSPNSL",15,0)
 . S TIUDOC(GMTSI)=+$G(GMTSEG(+GMTSEGN,8925.1,GMTSI))
"RTN","GMTSPNSL",16,0)
 . S GMTDOC(GMTSI)=$$GET1^DIQ(8925.1,(+(TIUDOC(GMTSI))_","),.01)
"RTN","GMTSPNSL",17,0)
 . S:$L($G(GMTDOC(GMTSI))) GMTDOC("B",GMTDOC(GMTSI),GMTSI)=""
"RTN","GMTSPNSL",18,0)
 D MAIN^TIULAPIS(DFN,.TIUDOC,"ALL",GMTS1,GMTS2,GMTSNDM,GMTSX)
"RTN","GMTSPNSL",19,0)
 Q:'$D(^TMP("TIU",$J))  D SNOTE^GMTSPN K ^TMP("TIU",$J),PN Q
"RTN","GMTSPSG")
0^18^B4106385
"RTN","GMTSPSG",1,0)
GMTSPSG ; SLC/JER,KER - UD Rx Summary Component (V4.5) ; 08/27/2002
"RTN","GMTSPSG",2,0)
 ;;2.7;Health Summary;**15,28,56**;Oct 20, 1995
"RTN","GMTSPSG",3,0)
 ; 
"RTN","GMTSPSG",4,0)
 ; External References
"RTN","GMTSPSG",5,0)
 ;   DBIA   486  ENHS^PSJEEU0
"RTN","GMTSPSG",6,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSPSG",7,0)
 ;                      
"RTN","GMTSPSG",8,0)
MAIN ; Controls Branching
"RTN","GMTSPSG",9,0)
 I $$VERSION^XPDUTL("PSJ")'<5 G MAIN^GMTSPSG5
"RTN","GMTSPSG",10,0)
 N GMI,IX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,GMR,TN,UDS
"RTN","GMTSPSG",11,0)
 S PSJEDT=$S(GMTS2'=9999999:(9999999-GMTS2),1:""),PSJNKF=1
"RTN","GMTSPSG",12,0)
 K ^UTILITY("PSG",$J) I '$L($T(ENHS^PSJEEU0)) D NOPSJ Q
"RTN","GMTSPSG",13,0)
 D ENHS^PSJEEU0
"RTN","GMTSPSG",14,0)
 I '$D(^UTILITY("PSG",$J)) Q
"RTN","GMTSPSG",15,0)
 S IX=-9999999,GMI=0
"RTN","GMTSPSG",16,0)
 F  S IX=$O(^UTILITY("PSG",$J,IX)) Q:'IX  S GMR=^(IX) D WRT  Q:$D(GMTSQIT)
"RTN","GMTSPSG",17,0)
 W !
"RTN","GMTSPSG",18,0)
 K ^UTILITY("PSG",$J),^UTILITY("PSIV",$J)
"RTN","GMTSPSG",19,0)
 Q
"RTN","GMTSPSG",20,0)
NOPSJ ; Handles case where routine ^PSJEEU0 not installed
"RTN","GMTSPSG",21,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Inpatient Pharmacy version 3.2 or greater is required.",!
"RTN","GMTSPSG",22,0)
 Q
"RTN","GMTSPSG",23,0)
WRT ; Writes the Unit Dose Component
"RTN","GMTSPSG",24,0)
 N SD,FD,DRG,DOSE,GMV,RT,STAT,SIG
"RTN","GMTSPSG",25,0)
 S SD=$P(GMR,U),FD=$P(GMR,U,2),DRG=$P($P(GMR,U,3),";",2),STAT=$P($P(GMR,U,5),";")
"RTN","GMTSPSG",26,0)
 ;                      
"RTN","GMTSPSG",27,0)
 ;   Don't display data when start date is after
"RTN","GMTSPSG",28,0)
 ;   Date Range To Date and stop date is before 
"RTN","GMTSPSG",29,0)
 ;   Date Range End Date. (Need end date because of
"RTN","GMTSPSG",30,0)
 ;   FOR LOOP on $O(^PS(53.1,"AC",DFN,Y)) in PSJEEU0
"RTN","GMTSPSG",31,0)
 ;                      
"RTN","GMTSPSG",32,0)
 I +$G(GMRANGE),(SD>(9999999-GMTS1))!(FD<(9999999-GMTS2)) Q
"RTN","GMTSPSG",33,0)
 F GMV="SD","FD" S X=@GMV D REGDT4^GMTSU S @GMV=X
"RTN","GMTSPSG",34,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>0&('GMTSNPG) !
"RTN","GMTSPSG",35,0)
 I GMTSNPG!(GMI'>0) D HEAD
"RTN","GMTSPSG",36,0)
 S GMI=1
"RTN","GMTSPSG",37,0)
 S DOSE=$P(GMR,U,6),RT=$P($P(GMR,U,7),";",3),SIG=$P(GMR,U,8)
"RTN","GMTSPSG",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E(DRG,1,36),?38,DOSE,?50,STAT,?57,SD,?69,FD,!
"RTN","GMTSPSG",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG WRT W ?2,SIG," ",RT
"RTN","GMTSPSG",40,0)
 Q
"RTN","GMTSPSG",41,0)
HEAD ; Prints Header
"RTN","GMTSPSG",42,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSG",43,0)
 W "Drug",?38,"Dose",?50,"Status",?59,"Start",?71,"Stop",! W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSG",44,0)
 Q
"RTN","GMTSPSG5")
0^19^B3870430
"RTN","GMTSPSG5",1,0)
GMTSPSG5 ; SLC/JER,KER - UD Rx Summary Component (V5) ; 08/27/2002
"RTN","GMTSPSG5",2,0)
 ;;2.7;Health Summary;**15,28,56**;Oct 20, 1995
"RTN","GMTSPSG5",3,0)
 ; 
"RTN","GMTSPSG5",4,0)
 ; External References
"RTN","GMTSPSG5",5,0)
 ;   DBIA   486  ENHS^PSJEEU0
"RTN","GMTSPSG5",6,0)
 ;                    
"RTN","GMTSPSG5",7,0)
MAIN ; Controls Branching
"RTN","GMTSPSG5",8,0)
 N GMI,IX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,GMR,TN,UDS
"RTN","GMTSPSG5",9,0)
 S PSJEDT=$S(GMTS2'=9999999:(9999999-GMTS2),1:""),PSJNKF=1
"RTN","GMTSPSG5",10,0)
 K ^UTILITY("PSG",$J) I '$L($T(ENHS^PSJEEU0)) D NOPSJ Q
"RTN","GMTSPSG5",11,0)
 D ENHS^PSJEEU0
"RTN","GMTSPSG5",12,0)
 I '$D(^UTILITY("PSG",$J)) Q
"RTN","GMTSPSG5",13,0)
 S IX=-9999999,GMI=0
"RTN","GMTSPSG5",14,0)
 F  S IX=$O(^UTILITY("PSG",$J,IX)) Q:'IX  S GMR=^(IX) D WRT  Q:$D(GMTSQIT)
"RTN","GMTSPSG5",15,0)
 W !
"RTN","GMTSPSG5",16,0)
 K ^UTILITY("PSG",$J),^UTILITY("PSIV",$J)
"RTN","GMTSPSG5",17,0)
 Q
"RTN","GMTSPSG5",18,0)
NOPSJ ; Handles case where routine ^PSJEEU0 not installed
"RTN","GMTSPSG5",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Inpatient Pharmacy version 3.2 or greater is required.",!
"RTN","GMTSPSG5",20,0)
 Q
"RTN","GMTSPSG5",21,0)
WRT ; Writes the Unit Dose Component
"RTN","GMTSPSG5",22,0)
 N SD,FD,DRG,DOSE,GMV,RT,STAT,SIG
"RTN","GMTSPSG5",23,0)
 S SD=$P(GMR,U),FD=$P(GMR,U,2),DRG=$P($P(GMR,U,3),";",2),STAT=$P($P(GMR,U,5),";")
"RTN","GMTSPSG5",24,0)
 ;                    
"RTN","GMTSPSG5",25,0)
 ;   Don't display data when start date is after 
"RTN","GMTSPSG5",26,0)
 ;   Date Range To Date and stop date is before 
"RTN","GMTSPSG5",27,0)
 ;   Date Range End Date. (Need end date because of
"RTN","GMTSPSG5",28,0)
 ;   FOR LOOP on $O(^PS(53.1,"AC",DFN,Y)) in PSJEEU0
"RTN","GMTSPSG5",29,0)
 ;                    
"RTN","GMTSPSG5",30,0)
 I +$G(GMRANGE),(SD>(9999999-GMTS1))!(FD<(9999999-GMTS2)) Q
"RTN","GMTSPSG5",31,0)
 F GMV="SD","FD" S X=@GMV D REGDT4^GMTSU S @GMV=X
"RTN","GMTSPSG5",32,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>0&('GMTSNPG) !
"RTN","GMTSPSG5",33,0)
 I GMTSNPG!(GMI'>0) D HEAD
"RTN","GMTSPSG5",34,0)
 S GMI=1
"RTN","GMTSPSG5",35,0)
 S DOSE=$P(GMR,U,6),RT=$P($P(GMR,U,7),";",3),SIG=$P(GMR,U,8)
"RTN","GMTSPSG5",36,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E(DRG,1,36),?38,DOSE,?50,STAT,?57,SD,?69,FD,!
"RTN","GMTSPSG5",37,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG WRT W ?2,SIG," ",RT
"RTN","GMTSPSG5",38,0)
 Q
"RTN","GMTSPSG5",39,0)
HEAD ; Prints Header
"RTN","GMTSPSG5",40,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSG5",41,0)
 W "Drug",?38,"Dose",?50,"Status",?58,"Start",?68,"Stop",! W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSG5",42,0)
 Q
"RTN","GMTSPSI")
0^22^B7392552
"RTN","GMTSPSI",1,0)
GMTSPSI ; SLC/JER,KER - IV Rx Summary Component (V4.5) ; 08/27/2002
"RTN","GMTSPSI",2,0)
 ;;2.7;Health Summary;**15,28,56**;Oct 20, 1995
"RTN","GMTSPSI",3,0)
 ;
"RTN","GMTSPSI",4,0)
 ; External References
"RTN","GMTSPSI",5,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSPSI",6,0)
 ;   DBIA    68  ENHS^PSJEEU0
"RTN","GMTSPSI",7,0)
 ;                     
"RTN","GMTSPSI",8,0)
MAIN ; Controls Branching
"RTN","GMTSPSI",9,0)
 I $$VERSION^XPDUTL("PSJ")'<5 G MAIN^GMTSPSI5
"RTN","GMTSPSI",10,0)
 N GMI,GMTSIDT,MAX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,TN
"RTN","GMTSPSI",11,0)
 S PSJEDT=$S(GMTS2'=9999999:(9999999-GMTS2),1:""),PSJNKF=1
"RTN","GMTSPSI",12,0)
 K ^UTILITY("PSIV",$J) I '$L($T(ENHS^PSJEEU0)) D NOPSJ Q
"RTN","GMTSPSI",13,0)
 D ENHS^PSJEEU0
"RTN","GMTSPSI",14,0)
 I '$D(^UTILITY("PSIV",$J)) Q
"RTN","GMTSPSI",15,0)
 S GMI=0
"RTN","GMTSPSI",16,0)
 S GMTSIDT=-9999999 F  S GMTSIDT=$O(^UTILITY("PSIV",$J,GMTSIDT)) Q:'GMTSIDT  D WRT  Q:$D(GMTSQIT)
"RTN","GMTSPSI",17,0)
 K ^UTILITY("PSIV",$J),^UTILITY("PSG",$J)
"RTN","GMTSPSI",18,0)
 Q
"RTN","GMTSPSI",19,0)
NOPSJ ; Handles case where ^PSJEEU0 not present
"RTN","GMTSPSI",20,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Inpatient Pharmacy version 3.2 or greater is required.",!
"RTN","GMTSPSI",21,0)
 Q
"RTN","GMTSPSI",22,0)
WRT ; Prints IV Pharmacy order
"RTN","GMTSPSI",23,0)
 N GMV,GMW,GMTSAD,GMTSDRUG,SOL,SD,SLN,FD,STAT,IR,SCH
"RTN","GMTSPSI",24,0)
 S SD=$P(^UTILITY("PSIV",$J,GMTSIDT,0),U),FD=$P(^(0),U,2),STAT=$P($P(^(0),U,4),";"),IR=$P(^(0),U,5),SCH=$P(^(0),U,6)
"RTN","GMTSPSI",25,0)
 ;   Don't display data when start date is after To Date
"RTN","GMTSPSI",26,0)
 Q:+$G(GMRANGE)&(SD>(9999999-GMTS1))
"RTN","GMTSPSI",27,0)
 F GMV="SD","FD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSI",28,0)
 I GMI'>0 D HEAD
"RTN","GMTSPSI",29,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>0&('GMTSNPG) !
"RTN","GMTSPSI",30,0)
 S GMI=1
"RTN","GMTSPSI",31,0)
 I $D(^UTILITY("PSIV",$J,GMTSIDT,"A",1)) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E($P($P(^UTILITY("PSIV",$J,GMTSIDT,"A",1),";",2),U),1,36),?38,$P(^(1),U,2),?50,STAT,?57,SD,?69,FD,!
"RTN","GMTSPSI",32,0)
 S GMTSAD=1
"RTN","GMTSPSI",33,0)
 F  S GMTSAD=$O(^UTILITY("PSIV",$J,GMTSIDT,"A",GMTSAD)) Q:GMTSAD'>0  S GMTSDRUG=^(GMTSAD) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E($P($P(GMTSDRUG,";",2),U),1,36),?38,$P(GMTSDRUG,U,2),!
"RTN","GMTSPSI",34,0)
LSTSOL ; Write Solutions
"RTN","GMTSPSI",35,0)
 S SOL=0
"RTN","GMTSPSI",36,0)
 F  S SOL=$O(^UTILITY("PSIV",$J,GMTSIDT,"S",SOL)) Q:SOL'>0  S SLN=^(SOL) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPSI",37,0)
 . D:GMTSNPG HEAD
"RTN","GMTSPSI",38,0)
 . W ?3,$S(SOL=1!GMTSNPG:"In: ",1:"    ")
"RTN","GMTSPSI",39,0)
 . W $P($P(SLN,";",2),U)," ",$P(SLN,U,2)," ",IR," ",SCH,!
"RTN","GMTSPSI",40,0)
 Q
"RTN","GMTSPSI",41,0)
HEAD ; Prints Header
"RTN","GMTSPSI",42,0)
 I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSI",43,0)
 W "Drug",?38,"Dose",?50,"Status",?58,"Start",?68,"Stop",! W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSI",44,0)
 Q
"RTN","GMTSPSI5")
0^23^B7099452
"RTN","GMTSPSI5",1,0)
GMTSPSI5 ; SLC/JER,KER - IV Rx Summary Component (V5) ; 08/27/2002
"RTN","GMTSPSI5",2,0)
 ;;2.7;Health Summary;**15,28,56**;Oct 20, 1995
"RTN","GMTSPSI5",3,0)
 ;
"RTN","GMTSPSI5",4,0)
 ; External References
"RTN","GMTSPSI5",5,0)
 ;   DBIA    68  ENHS^PSJEEU0
"RTN","GMTSPSI5",6,0)
 ;                      
"RTN","GMTSPSI5",7,0)
MAIN ; Controls Branching
"RTN","GMTSPSI5",8,0)
 N GMI,GMTSIDT,MAX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,TN
"RTN","GMTSPSI5",9,0)
 S PSJEDT=$S(GMTS2'=9999999:(9999999-GMTS2),1:""),PSJNKF=1
"RTN","GMTSPSI5",10,0)
 K ^UTILITY("PSIV",$J) I '$L($T(ENHS^PSJEEU0)) D NOPSJ Q
"RTN","GMTSPSI5",11,0)
 D ENHS^PSJEEU0
"RTN","GMTSPSI5",12,0)
 I '$D(^UTILITY("PSIV",$J)) Q
"RTN","GMTSPSI5",13,0)
 S GMI=0
"RTN","GMTSPSI5",14,0)
 S GMTSIDT=-9999999 F  S GMTSIDT=$O(^UTILITY("PSIV",$J,GMTSIDT)) Q:'GMTSIDT  D WRT  Q:$D(GMTSQIT)
"RTN","GMTSPSI5",15,0)
 K ^UTILITY("PSIV",$J),^UTILITY("PSG",$J)
"RTN","GMTSPSI5",16,0)
 Q
"RTN","GMTSPSI5",17,0)
NOPSJ ; Handles case where ^PSJEEU0 not present
"RTN","GMTSPSI5",18,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Inpatient Pharmacy version 3.2 or greater is required.",!
"RTN","GMTSPSI5",19,0)
 Q
"RTN","GMTSPSI5",20,0)
WRT ; Prints IV Pharmacy order
"RTN","GMTSPSI5",21,0)
 N GMV,GMW,GMTSAD,GMTSDRUG,SOL,SD,SLN,FD,STAT,IR,SCH
"RTN","GMTSPSI5",22,0)
 S SD=$P(^UTILITY("PSIV",$J,GMTSIDT,0),U),FD=$P(^(0),U,2),STAT=$P($P(^(0),U,4),";"),IR=$P(^(0),U,5),SCH=$P(^(0),U,6)
"RTN","GMTSPSI5",23,0)
 ;   Don't display data when start date is after To Date
"RTN","GMTSPSI5",24,0)
 Q:+$G(GMRANGE)&(SD>(9999999-GMTS1))
"RTN","GMTSPSI5",25,0)
 F GMV="SD","FD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSI5",26,0)
 I GMI'>0 D HEAD
"RTN","GMTSPSI5",27,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>0&('GMTSNPG) !
"RTN","GMTSPSI5",28,0)
 S GMI=1
"RTN","GMTSPSI5",29,0)
 I $D(^UTILITY("PSIV",$J,GMTSIDT,"A",1)) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E($P($P(^UTILITY("PSIV",$J,GMTSIDT,"A",1),";",2),U),1,36),?38,$P(^(1),U,2),?50,STAT,?57,SD,?69,FD,!
"RTN","GMTSPSI5",30,0)
 S GMTSAD=1
"RTN","GMTSPSI5",31,0)
 F  S GMTSAD=$O(^UTILITY("PSIV",$J,GMTSIDT,"A",GMTSAD)) Q:GMTSAD'>0  S GMTSDRUG=^(GMTSAD) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E($P($P(GMTSDRUG,";",2),U),1,36),?38,$P(GMTSDRUG,U,2),!
"RTN","GMTSPSI5",32,0)
LSTSOL ; Write Solutions
"RTN","GMTSPSI5",33,0)
 S SOL=0
"RTN","GMTSPSI5",34,0)
 F  S SOL=$O(^UTILITY("PSIV",$J,GMTSIDT,"S",SOL)) Q:SOL'>0  S SLN=^(SOL) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPSI5",35,0)
 . D:GMTSNPG HEAD
"RTN","GMTSPSI5",36,0)
 . W ?3,$S(SOL=1!GMTSNPG:"In: ",1:"    ")
"RTN","GMTSPSI5",37,0)
 . W $P($P(SLN,";",2),U)," ",$P(SLN,U,2)," ",IR," ",SCH,!
"RTN","GMTSPSI5",38,0)
 Q
"RTN","GMTSPSI5",39,0)
HEAD ; Prints Header
"RTN","GMTSPSI5",40,0)
 I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSI5",41,0)
 W "Drug",?38,"Dose",?50,"Status",?58,"Start",?68,"Stop",! W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSI5",42,0)
 Q
"RTN","GMTSPSO")
0^24^B10468590
"RTN","GMTSPSO",1,0)
GMTSPSO ; SLC/JER,KER/NDBI - OP Rx Summary Component (V6) ; 08/27/2002
"RTN","GMTSPSO",2,0)
 ;;2.7;Health Summary;**15,28,37,56**;Oct 20, 1995
"RTN","GMTSPSO",3,0)
 ;
"RTN","GMTSPSO",4,0)
 ; External References
"RTN","GMTSPSO",5,0)
 ;   DBIA  10141  $$VERSION^XPDUTL
"RTN","GMTSPSO",6,0)
 ;   DBIA   2931  HS^A7RPSOHS
"RTN","GMTSPSO",7,0)
 ;   DBIA   2931  HS^A7RPSOHS
"RTN","GMTSPSO",8,0)
 ;   DBIA     60  ^PSOHCSUM
"RTN","GMTSPSO",9,0)
 ;   DBIA    522  ^PS(55,
"RTN","GMTSPSO",10,0)
 ;   DBIA  10035  ^DPT(  file #2
"RTN","GMTSPSO",11,0)
 ;   DBIA   3136  ^PS(59.7,
"RTN","GMTSPSO",12,0)
 ;                    
"RTN","GMTSPSO",13,0)
MAIN ; OP Rx HS Comp
"RTN","GMTSPSO",14,0)
 ;   Check for version 7 (or greater)   MAIN^GMTSPSO7
"RTN","GMTSPSO",15,0)
 I $$VERSION^XPDUTL("PSO")'<7 G MAIN^GMTSPSO7
"RTN","GMTSPSO",16,0)
 ;   If not version 7                   MAIN^GMTSPSO
"RTN","GMTSPSO",17,0)
 N ECD,GMR,IX,PSOBEGIN,PSOACT,GMX,GMTOP
"RTN","GMTSPSO",18,0)
 S PSOBEGIN=$S(GMTS2'=9999999:(9999999-GMTS2),1:"")
"RTN","GMTSPSO",19,0)
 I PSOBEGIN="" S PSOACT=1 K PSOBEGIN
"RTN","GMTSPSO",20,0)
 K ^TMP("PSOO",$J)
"RTN","GMTSPSO",21,0)
 D:$$ROK^GMTSU("A7RPSOHS")&($$NDBI^GMTSU) HS^A7RPSOHS(DFN)
"RTN","GMTSPSO",22,0)
 I '$D(^PS(55,DFN,"P")),'$D(^("ARC")),'$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO",23,0)
 I '$O(^PS(55,DFN,"P",0)),$D(^PS(55,DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSO",24,0)
 D ^PSOHCSUM D:$$ROK^GMTSU("A7RPSOHS")&($$NDBI^GMTSU) HS^A7RPSOHS(DFN) I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO",25,0)
 S GMTSLO=GMTSLO+3
"RTN","GMTSPSO",26,0)
 S (GMX,GMTOP,IX)=0
"RTN","GMTSPSO",27,0)
 F  S IX=$O(^TMP("PSOO",$J,IX)) Q:IX'>0  S GMR=$G(^(IX,0)) D WRT
"RTN","GMTSPSO",28,0)
 S GMTSLO=GMTSLO-3
"RTN","GMTSPSO",29,0)
 K ^TMP("PSOO",$J)
"RTN","GMTSPSO",30,0)
 Q
"RTN","GMTSPSO",31,0)
WRT ; Writes OP Pharmacy Segment Record
"RTN","GMTSPSO",32,0)
 N ID,LFD,X,MI,NL,CF,GMD,GMV,GMI,GUI S GUI=$$HF^GMTSU
"RTN","GMTSPSO",33,0)
 S ID=$P(GMR,U),LFD=$P(GMR,U,2),ECD=$P(GMR,U,11),CF=$P(GMR,U,10)
"RTN","GMTSPSO",34,0)
 ;   Don't display when issue date is after To Date
"RTN","GMTSPSO",35,0)
 Q:+$G(GMRANGE)&(ID>(9999999-GMTS1))
"RTN","GMTSPSO",36,0)
 F GMV="ID","LFD","ECD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSO",37,0)
 S MI=$G(^TMP("PSOO",$J,IX,1)),NL=0 I $L(MI)>73 D PARSE
"RTN","GMTSPSO",38,0)
 S GMD=$P($P(GMR,U,4),";",2)
"RTN","GMTSPSO",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO",40,0)
 D:GMTSNPG!(GMX'>0) HEAD W:'GMTOP ! S GMTOP=0 W $P($P(GMR,U,3),";",2)
"RTN","GMTSPSO",41,0)
 W !,?22,$P(GMR,U,6),?35,$P($P(GMR,U,5),";"),?39,$P(GMR,U,7),?54,ID,?65,LFD,?76,"("_$P(GMR,U,8)_")",!
"RTN","GMTSPSO",42,0)
 S GMX=1 I 'NL D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?2,"SIG: ",MI,! S GMTOP=0
"RTN","GMTSPSO",43,0)
 F GMI=1:1:NL D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W:GMI=1 ?2,"SIG: " W ?7,MI(GMI),! S GMTOP=0
"RTN","GMTSPSO",44,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?4,"Provider: ",$E(GMD,1,22) W:CF ?37,"Cost/Fill: $",$J(CF,6,2)
"RTN","GMTSPSO",45,0)
 I "EC"[$P($P(GMR,U,5),";"),ECD]"" W ?57,"Exp/Can Dt: "_ECD
"RTN","GMTSPSO",46,0)
 W ! S GMTOP=0
"RTN","GMTSPSO",47,0)
 Q
"RTN","GMTSPSO",48,0)
PARSE ; Parses Medication Instructions
"RTN","GMTSPSO",49,0)
 N GMI,NW,WPL
"RTN","GMTSPSO",50,0)
 S NL=$S(($L(MI)/73)>($L(MI)\73):($L(MI)\73)+1,1:$L(MI)\73)
"RTN","GMTSPSO",51,0)
 S NW=$L(MI," "),WPL=$S((NW/NL)>(NW\NL):(NW\NL)+1,1:NW\NL)
"RTN","GMTSPSO",52,0)
 F GMI=1:1:NL S MI(GMI)=$P(MI," ",(GMI-1)*WPL+1,GMI*WPL)
"RTN","GMTSPSO",53,0)
 Q
"RTN","GMTSPSO",54,0)
HEAD ; Prints Header
"RTN","GMTSPSO",55,0)
 S GMTOP=1
"RTN","GMTSPSO",56,0)
 I GMX'>0,$D(^DPT(DFN,.1)),^(.1)]"",+($P($G(^PS(59.7,1,40.1)),"^")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSO",57,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Drug....................................",?65,"Last",!
"RTN","GMTSPSO",58,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO",59,0)
 W ?22,"Rx #",?34,"Stat",?39,"Qty",?54,"Issued",?65,"Filled",?76,"Rem"
"RTN","GMTSPSO",60,0)
 W:$Y'>(IOSL-GMTSLO)!(+($G(GUI))>0) !
"RTN","GMTSPSO",61,0)
 Q
"RTN","GMTSPSO7")
0^25^B8701124
"RTN","GMTSPSO7",1,0)
GMTSPSO7 ; SLC/JER/KER - OP Rx Summary Component (V6) ; 08/27/2002
"RTN","GMTSPSO7",2,0)
 ;;2.7;Health Summary;**15,28,37,56**;Oct 20, 1995
"RTN","GMTSPSO7",3,0)
 ;
"RTN","GMTSPSO7",4,0)
 ; External References
"RTN","GMTSPSO7",5,0)
 ;   DBIA     60  ^PSOHCSUM
"RTN","GMTSPSO7",6,0)
 ;   DBIA    522  ^PS(55,
"RTN","GMTSPSO7",7,0)
 ;   DBIA  10035  ^DPT(  file #2
"RTN","GMTSPSO7",8,0)
 ;   DBIA   3136  ^PS(59.7,
"RTN","GMTSPSO7",9,0)
 ;   DBIA  10011  ^DIWP
"RTN","GMTSPSO7",10,0)
 ;                      
"RTN","GMTSPSO7",11,0)
MAIN ; OP Rx HS Component
"RTN","GMTSPSO7",12,0)
 N ECD,GMR,IX,PSOBEGIN,PSOACT,GMX,GMTOP
"RTN","GMTSPSO7",13,0)
 S PSOBEGIN=$S(GMTS2'=9999999:(9999999-GMTS2),1:"")
"RTN","GMTSPSO7",14,0)
 I PSOBEGIN="" S PSOACT=1 K PSOBEGIN
"RTN","GMTSPSO7",15,0)
 K ^TMP("PSOO",$J)
"RTN","GMTSPSO7",16,0)
 I '$D(^PS(55,DFN,"P")),'$D(^("ARC")) Q
"RTN","GMTSPSO7",17,0)
 I '$O(^PS(55,DFN,"P",0)),$D(^PS(55,DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSO7",18,0)
 D ^PSOHCSUM I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO7",19,0)
 S GMTSLO=GMTSLO+3
"RTN","GMTSPSO7",20,0)
 S (GMTOP,GMX,IX)=0
"RTN","GMTSPSO7",21,0)
 F  S IX=$O(^TMP("PSOO",$J,IX)) Q:IX'>0  S GMR=$G(^(IX,0)) D WRT
"RTN","GMTSPSO7",22,0)
 S GMTSLO=GMTSLO-3
"RTN","GMTSPSO7",23,0)
 K ^TMP("PSOO",$J),^UTILITY($J,"W")
"RTN","GMTSPSO7",24,0)
 Q
"RTN","GMTSPSO7",25,0)
WRT ; Writes OP Pharmacy Segment Record
"RTN","GMTSPSO7",26,0)
 N ID,LFD,X,MI,NL,CF,GMD,GMV,GMI,DIWL,DIWR,DIWF,GMSIG,GUI S GUI=$$HF^GMTSU
"RTN","GMTSPSO7",27,0)
 S ID=$P(GMR,U),LFD=$P(GMR,U,2),ECD=$P(GMR,U,11),CF=$P(GMR,U,10)
"RTN","GMTSPSO7",28,0)
 ;   Don't display when issue date is after To Date
"RTN","GMTSPSO7",29,0)
 Q:+$G(GMRANGE)&(ID>(9999999-GMTS1))
"RTN","GMTSPSO7",30,0)
 F GMV="ID","LFD","ECD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSO7",31,0)
 S NL=0,DIWL=1,DIWR=73,DIWF="" K ^UTILITY($J,"W")
"RTN","GMTSPSO7",32,0)
 F  S NL=$O(^TMP("PSOO",$J,IX,NL)) Q:NL'>0  D
"RTN","GMTSPSO7",33,0)
 . S X=$G(^TMP("PSOO",$J,IX,NL,0)) D ^DIWP
"RTN","GMTSPSO7",34,0)
 S GMD=$P($P(GMR,U,4),";",2)
"RTN","GMTSPSO7",35,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO7",36,0)
 D:GMTSNPG!(GMX'>0) HEAD W:'GMTOP ! S GMTOP=0 W $P($P(GMR,U,3),";",2)
"RTN","GMTSPSO7",37,0)
 W !,?22,$P(GMR,U,6),?35,$P($P(GMR,U,5),";"),?39,$P(GMR,U,7),?54,ID,?65,LFD,?76,"("_$P(GMR,U,8)_")",!
"RTN","GMTSPSO7",38,0)
 S GMX=1,GMI=0,GMSIG=1
"RTN","GMTSPSO7",39,0)
 F  S GMI=$O(^UTILITY($J,"W",DIWL,GMI)) Q:GMI'>0!$D(GMTSQIT)  D
"RTN","GMTSPSO7",40,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD
"RTN","GMTSPSO7",41,0)
 . S MI=$G(^UTILITY($J,"W",DIWL,GMI,0))
"RTN","GMTSPSO7",42,0)
 . W:GMSIG=1 ?2,"SIG: " S:GMSIG=1 GMSIG=0 W ?7,MI,! S GMTOP=0
"RTN","GMTSPSO7",43,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?4,"Provider: ",$E(GMD,1,22) W:CF ?37,"Cost/Fill: $",$J(CF,6,2)
"RTN","GMTSPSO7",44,0)
 I "EC"[$P($P(GMR,U,5),";"),ECD]"" W ?57,"Exp/Can Dt: "_ECD
"RTN","GMTSPSO7",45,0)
 W ! S GMTOP=0
"RTN","GMTSPSO7",46,0)
 Q
"RTN","GMTSPSO7",47,0)
HEAD ; Prints Header
"RTN","GMTSPSO7",48,0)
 ;   Only write the next line when there is data
"RTN","GMTSPSO7",49,0)
 S GMTOP=1
"RTN","GMTSPSO7",50,0)
 I GMX'>0,$D(^DPT(DFN,.1)),^(.1)]"",+($P($G(^PS(59.7,1,40.1)),"^")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSO7",51,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Drug....................................",?65,"Last",!
"RTN","GMTSPSO7",52,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO7",53,0)
 W ?22,"Rx #",?34,"Stat",?39,"Qty",?54,"Issued",?65,"Filled",?76,"Rem"
"RTN","GMTSPSO7",54,0)
 W:$Y'>(IOSL-GMTSLO)!(+($G(GUI))>0) !
"RTN","GMTSPSO7",55,0)
 Q
"RTN","GMTSPXEP")
0^26^B10654385
"RTN","GMTSPXEP",1,0)
GMTSPXEP ; SLC/SBW,KER - PCE Patient Education comp ; 08/27/2002
"RTN","GMTSPXEP",2,0)
 ;;2.7;Health Summary;**8,10,28,35,56**;Oct 20, 1995
"RTN","GMTSPXEP",3,0)
 ;
"RTN","GMTSPXEP",4,0)
 ; External References
"RTN","GMTSPXEP",5,0)
 ;   DBIA  3063  EDUC^PXRHS08
"RTN","GMTSPXEP",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPXEP",7,0)
 ;                     
"RTN","GMTSPXEP",8,0)
PTED ; Patient Education
"RTN","GMTSPXEP",9,0)
 N GMTSOVT K ^TMP("PXPE",$J) S GMTSOVT="AICTSORXHDE"
"RTN","GMTSPXEP",10,0)
 ;                      
"RTN","GMTSPXEP",11,0)
 ;   GMTSOVT is a sting containing a set of Service 
"RTN","GMTSPXEP",12,0)
 ;   Categories for:
"RTN","GMTSPXEP",13,0)
 ;                      
"RTN","GMTSPXEP",14,0)
 ;    Ambulatory                      A
"RTN","GMTSPXEP",15,0)
 ;    Inpatient                       I
"RTN","GMTSPXEP",16,0)
 ;    Chart Review                    C
"RTN","GMTSPXEP",17,0)
 ;    Telecommunications              T
"RTN","GMTSPXEP",18,0)
 ;    Day Surgery                     S
"RTN","GMTSPXEP",19,0)
 ;    Observation                     O
"RTN","GMTSPXEP",20,0)
 ;    Nursing Home                    R
"RTN","GMTSPXEP",21,0)
 ;    Ancillary                       X
"RTN","GMTSPXEP",22,0)
 ;    Hospitalization                 H
"RTN","GMTSPXEP",23,0)
 ;    Daily Hospitalization Ancillary D
"RTN","GMTSPXEP",24,0)
 ;    Event-Historical                E
"RTN","GMTSPXEP",25,0)
 ;                      
"RTN","GMTSPXEP",26,0)
 D EDUC^PXRHS08(DFN,GMTSEND,GMTSBEG,GMTSNDM,GMTSOVT)
"RTN","GMTSPXEP",27,0)
 Q:'$D(^TMP("PXPE",$J))  D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR,EDMAIN
"RTN","GMTSPXEP",28,0)
 Q
"RTN","GMTSPXEP",29,0)
MRPTED ; Most recent patient education
"RTN","GMTSPXEP",30,0)
 N GMTSOVT,LATEST K ^TMP("PXPE",$J) S LATEST="R",GMTSOVT="AICTSORXHDE"
"RTN","GMTSPXEP",31,0)
 ;                      
"RTN","GMTSPXEP",32,0)
 ;   Returns most recent Patient Education Topic Types 
"RTN","GMTSPXEP",33,0)
 ;   for time period.  GMTSOVT is a sting containing a
"RTN","GMTSPXEP",34,0)
 ;   set of Service Categories for:
"RTN","GMTSPXEP",35,0)
 ;                      
"RTN","GMTSPXEP",36,0)
 ;    Ambulatory                      A
"RTN","GMTSPXEP",37,0)
 ;    Inpatient                       I
"RTN","GMTSPXEP",38,0)
 ;    Chart Review                    C
"RTN","GMTSPXEP",39,0)
 ;    Telecommunications              T
"RTN","GMTSPXEP",40,0)
 ;    Day Surgery                     S
"RTN","GMTSPXEP",41,0)
 ;    Observation                     O
"RTN","GMTSPXEP",42,0)
 ;    Nursing Home                    R
"RTN","GMTSPXEP",43,0)
 ;    Ancillary                       X
"RTN","GMTSPXEP",44,0)
 ;    Hospitalization                 H
"RTN","GMTSPXEP",45,0)
 ;    Daily Hospitalization Ancillary D
"RTN","GMTSPXEP",46,0)
 ;    Event-Historical                E
"RTN","GMTSPXEP",47,0)
 ;                      
"RTN","GMTSPXEP",48,0)
 D EDUC^PXRHS08(DFN,GMTSEND,GMTSBEG,LATEST,GMTSOVT)
"RTN","GMTSPXEP",49,0)
 Q:'$D(^TMP("PXPE",$J))
"RTN","GMTSPXEP",50,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSPXEP",51,0)
 D EDMAIN
"RTN","GMTSPXEP",52,0)
 Q
"RTN","GMTSPXEP",53,0)
HDR ; Header
"RTN","GMTSPXEP",54,0)
 W ?2,"Date",?12,"Facility",?25,"Topic - Understanding Level",!!
"RTN","GMTSPXEP",55,0)
 Q
"RTN","GMTSPXEP",56,0)
EDMAIN ; Main Education Display
"RTN","GMTSPXEP",57,0)
 N GMDT,GMED,GMIFN,GMN0,GMN1,X,GMTSDAT,ED,LEVEL,GMSITE,PSITE,PDT,LTXT
"RTN","GMTSPXEP",58,0)
 N COMMENT,GMICL,GMTSLN,GMTAB
"RTN","GMTSPXEP",59,0)
 S GMDT=0
"RTN","GMTSPXEP",60,0)
 F  S GMDT=$O(^TMP("PXPE",$J,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXEP",61,0)
 . S GMED=""
"RTN","GMTSPXEP",62,0)
 . F  S GMED=$O(^TMP("PXPE",$J,GMDT,GMED)) Q:GMED']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXEP",63,0)
 . . S GMIFN=0
"RTN","GMTSPXEP",64,0)
 . . F  S GMIFN=$O(^TMP("PXPE",$J,GMDT,GMED,GMIFN)) Q:GMIFN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXEP",65,0)
 . . . S GMN0=$G(^TMP("PXPE",$J,GMDT,GMED,GMIFN,0))
"RTN","GMTSPXEP",66,0)
 . . . Q:GMN0']""
"RTN","GMTSPXEP",67,0)
 . . . S GMN1=$G(^TMP("PXPE",$J,GMDT,GMED,GMIFN,1))
"RTN","GMTSPXEP",68,0)
 . . . S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXEP",69,0)
 . . . S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXEP",70,0)
 . . . S LTXT="",ED=$P(GMN0,U),LEVEL=$P(GMN0,U,3)
"RTN","GMTSPXEP",71,0)
 . . . I LEVEL]"" S LTXT=" - "_LEVEL
"RTN","GMTSPXEP",72,0)
 . . . I LEVEL="POOR"!(LEVEL="FAIR")!(LEVEL="GOOD") S LTXT=LTXT_" UNDERSTANDING"
"RTN","GMTSPXEP",73,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSPXEP",74,0)
 . . . I GMTSDAT'=$G(PDT)!GMTSNPG W GMTSDAT S PDT=GMTSDAT,PSITE=""
"RTN","GMTSPXEP",75,0)
 . . . I GMSITE'=$G(PSITE) W ?12,GMSITE S PSITE=GMSITE
"RTN","GMTSPXEP",76,0)
 . . . W ?25,ED,$G(LTXT),!
"RTN","GMTSPXEP",77,0)
 . . . S COMMENT="",COMMENT=$P(^TMP("PXPE",$J,GMDT,GMED,GMIFN,"COM"),U)
"RTN","GMTSPXEP",78,0)
 . . . I COMMENT]"" S GMICL=26,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D 
"RTN","GMTSPXEP",79,0)
 . . . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXEP",80,0)
 K ^TMP("PXPE",$J)
"RTN","GMTSPXEP",81,0)
 Q
"RTN","GMTSPXEP",82,0)
FORMAT ; Format Line
"RTN","GMTSPXEP",83,0)
 N DIWR,DIWF,X S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXEP",84,0)
 K ^UTILITY($J,"W") S X=COMMENT D ^DIWP
"RTN","GMTSPXEP",85,0)
 Q
"RTN","GMTSPXEP",86,0)
LINE ; Write Line
"RTN","GMTSPXEP",87,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?26,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXEP",88,0)
 Q
"RTN","GMTSPXFP")
0^27^B7002658
"RTN","GMTSPXFP",1,0)
GMTSPXFP ; SLC/SBW,KER - PCE Health Factors Component ; 08/27/2002
"RTN","GMTSPXFP",2,0)
 ;;2.7;Health Summary;**8,10,28,56**;Oct 20, 1995
"RTN","GMTSPXFP",3,0)
 ;
"RTN","GMTSPXFP",4,0)
 ; External References
"RTN","GMTSPXFP",5,0)
 ;   DBIA  1243  HF^PXRHS07
"RTN","GMTSPXFP",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPXFP",7,0)
 ;                    
"RTN","GMTSPXFP",8,0)
HFSEL ; Health Factors Selected
"RTN","GMTSPXFP",9,0)
 N HFSEG,GMTSFC,GMW
"RTN","GMTSPXFP",10,0)
 Q:$O(GMTSEG(GMTSEGN,9999999.64,0))'>0
"RTN","GMTSPXFP",11,0)
 S GMTSFC=0,GMW=0
"RTN","GMTSPXFP",12,0)
 F  S GMTSFC=$O(GMTSEG(GMTSEGN,9999999.64,GMTSFC)) Q:'GMTSFC  D
"RTN","GMTSPXFP",13,0)
 . S HFSEG(GMTSEG(GMTSEGN,9999999.64,GMTSFC))=""
"RTN","GMTSPXFP",14,0)
 K ^TMP("PXF",$J) D HF^PXRHS07(DFN,GMTSEND,GMTSBEG,GMTSNDM,.HFSEG)
"RTN","GMTSPXFP",15,0)
 Q:'$D(^TMP("PXF",$J))  D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR,HFMAIN
"RTN","GMTSPXFP",16,0)
 Q
"RTN","GMTSPXFP",17,0)
HFACT ; Control Health Factor retrieval and display
"RTN","GMTSPXFP",18,0)
 K ^TMP("PXF",$J)
"RTN","GMTSPXFP",19,0)
 D HF^PXRHS07(DFN,GMTSEND,GMTSBEG,GMTSNDM)
"RTN","GMTSPXFP",20,0)
 Q:'$D(^TMP("PXF",$J))
"RTN","GMTSPXFP",21,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXFP",22,0)
 D HFMAIN
"RTN","GMTSPXFP",23,0)
 Q
"RTN","GMTSPXFP",24,0)
HFMAIN ; Main Health Factor Display
"RTN","GMTSPXFP",25,0)
 N GMHFC,GMHF,GMDT,GMIFN,GMN0,GMW,X,GMTSDAT,HF,LEVEL,PHFC,COMMENT
"RTN","GMTSPXFP",26,0)
 N GMICL,GMTAB,GMTSLN
"RTN","GMTSPXFP",27,0)
 S GMHFC="",GMW=0
"RTN","GMTSPXFP",28,0)
 F  S GMHFC=$O(^TMP("PXF",$J,GMHFC)) Q:GMHFC=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",29,0)
 . S GMHF=""
"RTN","GMTSPXFP",30,0)
 . F  S GMHF=$O(^TMP("PXF",$J,GMHFC,GMHF)) Q:GMHF=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",31,0)
 . . S GMDT=0
"RTN","GMTSPXFP",32,0)
 . . F  S GMDT=$O(^TMP("PXF",$J,GMHFC,GMHF,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",33,0)
 . . . S GMIFN=0
"RTN","GMTSPXFP",34,0)
 . . . F  S GMIFN=$O(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN)) Q:GMIFN'>0  D HFDSP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",35,0)
 K ^TMP("PXF",$J)
"RTN","GMTSPXFP",36,0)
 Q
"RTN","GMTSPXFP",37,0)
HDR ; Display Header
"RTN","GMTSPXFP",38,0)
 W "Category",!
"RTN","GMTSPXFP",39,0)
 W "  Health Factor ",?50,"Date",!
"RTN","GMTSPXFP",40,0)
 Q
"RTN","GMTSPXFP",41,0)
HFDSP ; Display Data
"RTN","GMTSPXFP",42,0)
 S GMN0=$G(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN,0))
"RTN","GMTSPXFP",43,0)
 Q:GMN0']""
"RTN","GMTSPXFP",44,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXFP",45,0)
 S HF=$P(GMN0,U),LEVEL=$P(GMN0,U,4)
"RTN","GMTSPXFP",46,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR D
"RTN","GMTSPXFP",47,0)
 . I GMHFC'=$G(PHFC)!GMTSNPG D
"RTN","GMTSPXFP",48,0)
 . . I $G(PHFC)="",'GMTSNPG W ! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",49,0)
 . . W GMHFC,!
"RTN","GMTSPXFP",50,0)
 . . S PHFC=GMHFC
"RTN","GMTSPXFP",51,0)
 . S GMW=1
"RTN","GMTSPXFP",52,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",53,0)
 W ?2,HF
"RTN","GMTSPXFP",54,0)
 W:LEVEL]"" " (",LEVEL,")"
"RTN","GMTSPXFP",55,0)
 W ?50,GMTSDAT,!
"RTN","GMTSPXFP",56,0)
 S COMMENT="",COMMENT=$P(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN,"COM"),U)
"RTN","GMTSPXFP",57,0)
 I COMMENT]"" S GMICL=13,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPXFP",58,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXFP",59,0)
 Q
"RTN","GMTSPXFP",60,0)
FORMAT ; Format Line
"RTN","GMTSPXFP",61,0)
 N DIWR,DIWF,X
"RTN","GMTSPXFP",62,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXFP",63,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXFP",64,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXFP",65,0)
 Q
"RTN","GMTSPXFP",66,0)
LINE ; Write Line
"RTN","GMTSPXFP",67,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXFP",68,0)
 Q
"RTN","GMTSPXHP")
0^28^B757209
"RTN","GMTSPXHP",1,0)
GMTSPXHP ; SLC/SBW - PCE Location of Home component ; 08/27/2002
"RTN","GMTSPXHP",2,0)
 ;;2.7;Health Summary;**56**;Oct 20, 1995
"RTN","GMTSPXHP",3,0)
 ;
"RTN","GMTSPXHP",4,0)
 ; External References
"RTN","GMTSPXHP",5,0)
 ;   DBIA  1254  LOC^PXRHS13
"RTN","GMTSPXHP",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPXHP",7,0)
 ;   DBIA 10029  ^DIWW
"RTN","GMTSPXHP",8,0)
 ;                        
"RTN","GMTSPXHP",9,0)
HOMELOC ; Location of Home
"RTN","GMTSPXHP",10,0)
 N GMTSI,DIWL,DIWR,DIWF,X K ^UTILITY($J,"W"),^TMP("PXLOC",$J)
"RTN","GMTSPXHP",11,0)
 D LOC^PXRHS13(DFN) Q:'$D(^TMP("PXLOC",$J))
"RTN","GMTSPXHP",12,0)
 S DIWL=1,DIWR=80,DIWF="W",GMTSI=0
"RTN","GMTSPXHP",13,0)
 F  S GMTSI=$O(^TMP("PXLOC",$J,GMTSI)) Q:'GMTSI  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHP",14,0)
 . S X=^(GMTSI) D CKP^GMTSUP Q:$D(GMTSQIT)  D ^DIWP
"RTN","GMTSPXHP",15,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D ^DIWW
"RTN","GMTSPXHP",16,0)
 K ^TMP("PXLOC",$J)
"RTN","GMTSPXHP",17,0)
 Q
"RTN","GMTSPXHR")
0^29^B9070396
"RTN","GMTSPXHR",1,0)
GMTSPXHR ; SLC/SBW,KER - PCE Clinical Reminders/Maint ; 08/27/2002
"RTN","GMTSPXHR",2,0)
 ;;2.7;Health Summary;**8,22,23,28,34,56**;Oct 20, 1995
"RTN","GMTSPXHR",3,0)
 ;
"RTN","GMTSPXHR",4,0)
 ; External References
"RTN","GMTSPXHR",5,0)
 ;   DBIA  2182  MAIN^PXRM
"RTN","GMTSPXHR",6,0)
 ;                       
"RTN","GMTSPXHR",7,0)
MAIN ; Entry Point for Clinical Reminders
"RTN","GMTSPXHR",8,0)
 N CM,GMFLAG
"RTN","GMTSPXHR",9,0)
 S CM=0
"RTN","GMTSPXHR",10,0)
 I GMTSEGH["CR" S GMFLAG=0
"RTN","GMTSPXHR",11,0)
 I GMTSEGH["CRS" S GMFLAG=1
"RTN","GMTSPXHR",12,0)
 I GMTSEGH["CM" S GMFLAG=5,CM=1
"RTN","GMTSPXHR",13,0)
 I GMTSEGH["CMB" S GMFLAG=4,CM=1
"RTN","GMTSPXHR",14,0)
 Q:+$G(GMTSAGE)'>0!($G(SEX)="")!($G(DFN)'>0)
"RTN","GMTSPXHR",15,0)
 Q:$O(GMTSEG(GMTSEGN,811.9,0))'>0
"RTN","GMTSPXHR",16,0)
 N GMCR,GMFIRST,CRSEG,GMDISP
"RTN","GMTSPXHR",17,0)
 S GMCR=0,GMFIRST=1
"RTN","GMTSPXHR",18,0)
 F  S GMCR=$O(GMTSEG(GMTSEGN,811.9,GMCR)) Q:'GMCR  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",19,0)
 . S CRSEG=GMTSEG(GMTSEGN,811.9,GMCR)
"RTN","GMTSPXHR",20,0)
 . K ^TMP("PXRHM",$J),^TMP("PXRM",$J)
"RTN","GMTSPXHR",21,0)
 . D MAIN^PXRM(DFN,CRSEG,+$G(GMFLAG))
"RTN","GMTSPXHR",22,0)
 . D:+$D(^TMP("PXRHM",$J)) GETCR
"RTN","GMTSPXHR",23,0)
 I +$G(GMDISP)'>0 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Selected Clinical Reminders not due.",!
"RTN","GMTSPXHR",24,0)
 K ^TMP("PXRHM",$J),^TMP("PXRM",$J)
"RTN","GMTSPXHR",25,0)
 Q
"RTN","GMTSPXHR",26,0)
GETCR ; Get reminders that were returned
"RTN","GMTSPXHR",27,0)
 N ITEM,GMDT,GMN0,X,GMTSDAT,GMTSDUE,GMREM
"RTN","GMTSPXHR",28,0)
 S ITEM=0
"RTN","GMTSPXHR",29,0)
 F  S ITEM=$O(^TMP("PXRHM",$J,ITEM)) Q:ITEM'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",30,0)
 . S GMREM=""
"RTN","GMTSPXHR",31,0)
 . F  S GMREM=$O(^TMP("PXRHM",$J,ITEM,GMREM)) Q:GMREM=""  D CRDISP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",32,0)
 Q
"RTN","GMTSPXHR",33,0)
CRDISP ; Display reminder data
"RTN","GMTSPXHR",34,0)
 N DUECOL,HIST,LASTCOL,STATUS,STATCOL,TYPE
"RTN","GMTSPXHR",35,0)
 S GMN0=$G(^TMP("PXRHM",$J,ITEM,GMREM))
"RTN","GMTSPXHR",36,0)
 Q:GMN0']""
"RTN","GMTSPXHR",37,0)
 S STATUS=$P(GMN0,U,1)
"RTN","GMTSPXHR",38,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDUE=X
"RTN","GMTSPXHR",39,0)
 S X=$P(GMN0,U,3) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXHR",40,0)
 S TYPE=$P(GMN0,U,4)
"RTN","GMTSPXHR",41,0)
 I TYPE["E" S HIST="(hist)"
"RTN","GMTSPXHR",42,0)
 I TYPE["X" S HIST="(exp)"
"RTN","GMTSPXHR",43,0)
 S GMDISP=1
"RTN","GMTSPXHR",44,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",45,0)
 I GMTSNPG D HDR,CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",46,0)
 I GMTSNPG D HDR
"RTN","GMTSPXHR",47,0)
 S STATCOL=41-($L(STATUS)/2)
"RTN","GMTSPXHR",48,0)
 S DUECOL=53-($L(GMTSDUE)/2)
"RTN","GMTSPXHR",49,0)
 S LASTCOL=67-($L(GMTSDAT)/2)
"RTN","GMTSPXHR",50,0)
 W GMREM,?STATCOL,STATUS,?DUECOL,GMTSDUE,?LASTCOL,GMTSDAT,?73,$G(HIST),!
"RTN","GMTSPXHR",51,0)
 I 'CM Q
"RTN","GMTSPXHR",52,0)
 ;   Display activity data on reminder
"RTN","GMTSPXHR",53,0)
 S GMDT=0
"RTN","GMTSPXHR",54,0)
 F  S GMDT=$O(^TMP("PXRHM",$J,ITEM,GMREM,GMDT)) Q:+GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",55,0)
 . S GMN0=$G(^TMP("PXRHM",$J,ITEM,GMREM,GMDT))
"RTN","GMTSPXHR",56,0)
 . Q:GMN0']""
"RTN","GMTSPXHR",57,0)
 . I $P(GMN0,U,2) S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXHR",58,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",59,0)
 . I GMTSNPG D HDR
"RTN","GMTSPXHR",60,0)
 . W ?5,$P(GMN0,U)," on record - ",$G(GMTSDAT),", ",$P(GMN0,U,3),!
"RTN","GMTSPXHR",61,0)
 ;   Display maintenance criteria for reminder
"RTN","GMTSPXHR",62,0)
 S GMDT=0
"RTN","GMTSPXHR",63,0)
 F  S GMDT=$O(^TMP("PXRHM",$J,ITEM,GMREM,"TXT",GMDT)) Q:+GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",64,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",65,0)
 . I GMTSNPG D HDR
"RTN","GMTSPXHR",66,0)
 . W ?5,$G(^TMP("PXRHM",$J,ITEM,GMREM,"TXT",GMDT)),!
"RTN","GMTSPXHR",67,0)
 W !
"RTN","GMTSPXHR",68,0)
 Q
"RTN","GMTSPXHR",69,0)
HDR ; Header
"RTN","GMTSPXHR",70,0)
 I GMFIRST D FIRST Q:$D(GMTSQIT)  S GMFIRST=0
"RTN","GMTSPXHR",71,0)
 W ?36,"--STATUS--",?47,"--DUE DATE--",?61,"--LAST DONE--",!
"RTN","GMTSPXHR",72,0)
 Q
"RTN","GMTSPXHR",73,0)
 ;
"RTN","GMTSPXHR",74,0)
FIRST ; Display Disclaimer
"RTN","GMTSPXHR",75,0)
 N GMREC
"RTN","GMTSPXHR",76,0)
 S GMREC=0
"RTN","GMTSPXHR",77,0)
 F  S GMREC=$O(^TMP("PXRM",$J,"DISC",GMREC)) Q:+GMREC'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",78,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",79,0)
 . W ?1,$G(^TMP("PXRM",$J,"DISC",GMREC)),!
"RTN","GMTSPXHR",80,0)
 W !
"RTN","GMTSPXHR",81,0)
 Q
"RTN","GMTSPXIM")
0^30^B6355325
"RTN","GMTSPXIM",1,0)
GMTSPXIM ; SLC/SBW,KER - PCE Immunization component ; 08/27/2002
"RTN","GMTSPXIM",2,0)
 ;;2.7;Health Summary;**8,10,28,56**;Oct 20, 1995
"RTN","GMTSPXIM",3,0)
 ;
"RTN","GMTSPXIM",4,0)
 ; External References
"RTN","GMTSPXIM",5,0)
 ;   DBIA  1239  IMMUN^PXRHS03
"RTN","GMTSPXIM",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPXIM",7,0)
 ;                       
"RTN","GMTSPXIM",8,0)
IMMUN ; Main Entry Point
"RTN","GMTSPXIM",9,0)
 K ^TMP("PXI",$J) D IMMUN^PXRHS03(DFN) Q:'$D(^TMP("PXI",$J))
"RTN","GMTSPXIM",10,0)
 N GMIMM,GMDT,GMIFN,GMW,GMSITE,GMN0,GMN1,GMSIR,GMSIC,X,GMTSDAT,GML
"RTN","GMTSPXIM",11,0)
 N GMTSX,GMCKP,GMTAB,COMMENT,GMTSLN,GMICL
"RTN","GMTSPXIM",12,0)
 S GMIMM="" D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXIM",13,0)
 F  S GMIMM=$O(^TMP("PXI",$J,GMIMM)) Q:GMIMM=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXIM",14,0)
 . S (GMDT,GMW)=0
"RTN","GMTSPXIM",15,0)
 . F  S GMDT=$O(^TMP("PXI",$J,GMIMM,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXIM",16,0)
 . . S GMIFN=0
"RTN","GMTSPXIM",17,0)
 . . F  S GMIFN=$O(^TMP("PXI",$J,GMIMM,GMDT,GMIFN)) Q:GMIFN'>0  D IMMDSP Q:$D(GMTSQIT)
"RTN","GMTSPXIM",18,0)
 K ^TMP("PXI",$J)
"RTN","GMTSPXIM",19,0)
 Q
"RTN","GMTSPXIM",20,0)
IMMDSP ; Display Immunization data
"RTN","GMTSPXIM",21,0)
 S DIWL=0,CNT=0,COMMENT="",GMN0=$G(^TMP("PXI",$J,GMIMM,GMDT,GMIFN,0)) Q:GMN0']""
"RTN","GMTSPXIM",22,0)
 S GMN1=$G(^TMP("PXI",$J,GMIMM,GMDT,GMIFN,1))
"RTN","GMTSPXIM",23,0)
 S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXIM",24,0)
 S X=$P(GMN0,U,3) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXIM",25,0)
 S GMSIR=$P(GMN0,U,6),GMSIC=$S(+$P(GMN0,U,7):"DO NOT REPEAT",1:"")
"RTN","GMTSPXIM",26,0)
 I GMSIC]"",GMSIR]"" S GMSIR=GMSIR_"; "
"RTN","GMTSPXIM",27,0)
 S GMSIR=GMSIR_GMSIC
"RTN","GMTSPXIM",28,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR I GMW'>0!GMTSNPG W $P(GMN0,U,2) S GML=$L($P(GMN0,U,2))+1
"RTN","GMTSPXIM",29,0)
 W ?16,$P(GMN0,U,4),?23,GMTSDAT,?34,GMSITE
"RTN","GMTSPXIM",30,0)
 I GMSIR']"" W ! G COM
"RTN","GMTSPXIM",31,0)
 I GMSIR]"" S GMICL=47,GMTAB=2,CNT=1 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXIM",32,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXIM",33,0)
COM ; Comments
"RTN","GMTSPXIM",34,0)
 S COMMENT=$P(^TMP("PXI",$J,GMIMM,GMDT,GMIFN,"COM"),U)
"RTN","GMTSPXIM",35,0)
 I COMMENT]"" S GMICL=33,GMTAB=2,CNT=2 D FORMAT I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPXIM",36,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXIM",37,0)
 S GMW=1
"RTN","GMTSPXIM",38,0)
 Q
"RTN","GMTSPXIM",39,0)
HDR ; Header
"RTN","GMTSPXIM",40,0)
 W "Immunization",?14,"Series",?25,"Date",?33,"Facility",?47,"Reaction",!!
"RTN","GMTSPXIM",41,0)
 Q
"RTN","GMTSPXIM",42,0)
FORMAT ; Format Line
"RTN","GMTSPXIM",43,0)
 N DIWR,DIWF,X S DIWL=3,DIWR=80-(GMICL+GMTAB) K ^UTILITY($J,"W")
"RTN","GMTSPXIM",44,0)
 S X=$S(CNT=1:GMSIR,CNT=2:COMMENT) D ^DIWP
"RTN","GMTSPXIM",45,0)
 Q
"RTN","GMTSPXIM",46,0)
LINE ; Writes Line
"RTN","GMTSPXIM",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXIM",48,0)
 W ?($S(CNT=1:47,CNT=2:33,1:0)),^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXIM",49,0)
 Q
"RTN","GMTSPXM")
0^31^B2143554
"RTN","GMTSPXM",1,0)
GMTSPXM ; SLC/SBW,KER - PCE Non Tabular Measurement comp ; 08/27/2002
"RTN","GMTSPXM",2,0)
 ;;2.7;Health Summary;**28,56**;Oct 20, 1995
"RTN","GMTSPXM",3,0)
 ;
"RTN","GMTSPXM",4,0)
 ; External References
"RTN","GMTSPXM",5,0)
 ;   DBIA  1244  MEAS^PXRHS09
"RTN","GMTSPXM",6,0)
 ;                     
"RTN","GMTSPXM",7,0)
MEAS ; Measurements provided within a date range
"RTN","GMTSPXM",8,0)
 K ^TMP("PXM",$J) Q:'$$ROK^GMTSU("PXRHS09")
"RTN","GMTSPXM",9,0)
 D MEAS^PXRHS09(DFN,GMTSEND,GMTSBEG,GMTSNDM) Q:'$D(^TMP("PXM",$J))
"RTN","GMTSPXM",10,0)
 N GMTYP,GMDT,GMIFN,GMN0,X,MTYPE,VALUE,PMTYPE S GMTYP=""
"RTN","GMTSPXM",11,0)
 F  S GMTYP=$O(^TMP("PXM",$J,GMTYP)) Q:GMTYP']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXM",12,0)
 . N GMTSDAT,PDT S GMDT=0
"RTN","GMTSPXM",13,0)
 . F  S GMDT=$O(^TMP("PXM",$J,GMTYP,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXM",14,0)
 . . S GMIFN=0
"RTN","GMTSPXM",15,0)
 . . F  S GMIFN=$O(^TMP("PXM",$J,GMTYP,GMDT,GMIFN)) Q:GMIFN'>0  D MEASDSP Q:$D(GMTSQIT)
"RTN","GMTSPXM",16,0)
 K ^TMP("PXM",$J)
"RTN","GMTSPXM",17,0)
 Q
"RTN","GMTSPXM",18,0)
MEASDSP ; Display Measurement data
"RTN","GMTSPXM",19,0)
 S GMN0=$G(^TMP("PXM",$J,GMTYP,GMDT,GMIFN,0)) Q:GMN0']""
"RTN","GMTSPXM",20,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXM",21,0)
 S MTYPE=$P(GMN0,U),VALUE=$P(GMN0,U,4) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXM",22,0)
 I GMTSNPG!(MTYPE'=$G(PMTYPE)) W MTYPE S PMTYPE=MTYPE
"RTN","GMTSPXM",23,0)
 I GMTSDAT'=$G(PDT)!GMTSNPG W ?5,GMTSDAT S PDT=GMTSDAT
"RTN","GMTSPXM",24,0)
 W ?17,VALUE,!
"RTN","GMTSPXM",25,0)
 Q
"RTN","GMTSPXMP")
0^32^B8188664
"RTN","GMTSPXMP",1,0)
GMTSPXMP ; SLC/SBW,KER - PCE Selected Measurement Comp ; 08/27/2002
"RTN","GMTSPXMP",2,0)
 ;;2.7;Health Summary;**28,56**;Oct 20, 1995
"RTN","GMTSPXMP",3,0)
 ;
"RTN","GMTSPXMP",4,0)
 ; External References
"RTN","GMTSPXMP",5,0)
 ;   DBIA  1248  MEAS^PXRHS20
"RTN","GMTSPXMP",6,0)
 ;                     
"RTN","GMTSPXMP",7,0)
MEASP ; Display Data for Selected Measurement Panels
"RTN","GMTSPXMP",8,0)
 Q:'$$ROK^GMTSU("PXRHS20")  Q:+$O(GMTSEG(GMTSEGN,9001017,0))'>0
"RTN","GMTSPXMP",9,0)
 N GMM,GMW1,MPNAME,PORDER
"RTN","GMTSPXMP",10,0)
 S GMM=0,GMW1=0
"RTN","GMTSPXMP",11,0)
 F  S GMM=$O(GMTSEG(GMTSEGN,9001017,GMM)) Q:'GMM  D
"RTN","GMTSPXMP",12,0)
 . N MPANEL,FORMAT,MNOTE
"RTN","GMTSPXMP",13,0)
 . S MPANEL=GMTSEG(GMTSEGN,9001017,GMM)
"RTN","GMTSPXMP",14,0)
 . K ^TMP("PXM",$J),^TMP("PXF",$J)
"RTN","GMTSPXMP",15,0)
 . D MEAS^PXRHS20(DFN,GMTSDOB,SEX,GMTSEND,GMTSBEG,GMTSNDM,MPANEL)
"RTN","GMTSPXMP",16,0)
 . Q:+$D(^TMP("PXM",$J))'>0!(+$D(^TMP("PXM",$J))'>0)
"RTN","GMTSPXMP",17,0)
 . S MPNAME=$O(^TMP("PXF",$J,""))
"RTN","GMTSPXMP",18,0)
 . Q:MPNAME']""
"RTN","GMTSPXMP",19,0)
 . S PORDER=0
"RTN","GMTSPXMP",20,0)
 . F  S PORDER=$O(^TMP("PXF",$J,MPNAME,PORDER)) Q:PORDER'>0  D
"RTN","GMTSPXMP",21,0)
 . . N GMNODE,MNAME,MLABEL,FWIDTH,X
"RTN","GMTSPXMP",22,0)
 . . S GMNODE=^TMP("PXF",$J,MPNAME,PORDER)
"RTN","GMTSPXMP",23,0)
 . . S MNAME=$P(GMNODE,U)
"RTN","GMTSPXMP",24,0)
 . . S FWIDTH=$P(GMNODE,U,2)
"RTN","GMTSPXMP",25,0)
 . . S MLABEL=$P(GMNODE,U,3)
"RTN","GMTSPXMP",26,0)
 . . S X=$P(GMNODE,U,4) S:X]"" MNOTE(X)=""
"RTN","GMTSPXMP",27,0)
 . . S:FWIDTH'>0 FWIDTH=10
"RTN","GMTSPXMP",28,0)
 . . S FORMAT(PORDER,0)=$P(GMNODE,U)
"RTN","GMTSPXMP",29,0)
 . . S FORMAT(PORDER,1)=$S(MLABEL]"":MLABEL,1:MNAME)
"RTN","GMTSPXMP",30,0)
 . . S FORMAT(PORDER,2)=FWIDTH
"RTN","GMTSPXMP",31,0)
 . D MEASDSP
"RTN","GMTSPXMP",32,0)
 K ^TMP("PXM",$J),^TMP("PXF",$J)
"RTN","GMTSPXMP",33,0)
 Q
"RTN","GMTSPXMP",34,0)
MEASDSP ; Display Measurement Data in Columns
"RTN","GMTSPXMP",35,0)
 N GMTSIDT,GMW,GMCOL,ORDER,LABEL,WIDTH,NAME,GMTSDAT,IFN,VALUE,TVALUE
"RTN","GMTSPXMP",36,0)
 S GMW=1,GMTSIDT=0
"RTN","GMTSPXMP",37,0)
 F  S GMTSIDT=$O(^TMP("PXM",$J,GMTSIDT)) Q:GMTSIDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXMP",38,0)
 . S X=9999999-GMTSIDT D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXMP",39,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXMP",40,0)
 . I GMTSNPG!GMW D PHDR D CKP^GMTSUP Q:$D(GMTSQIT)  I GMTSNPG D PHDR
"RTN","GMTSPXMP",41,0)
 . D PLINE S GMW=0
"RTN","GMTSPXMP",42,0)
 I $O(MNOTE(0))]"" D
"RTN","GMTSPXMP",43,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Notes:",! S X=""
"RTN","GMTSPXMP",44,0)
 . F  S X=$O(MNOTE(X)) Q:X=""  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,X,!
"RTN","GMTSPXMP",45,0)
 Q
"RTN","GMTSPXMP",46,0)
PLINE ; Panel Line
"RTN","GMTSPXMP",47,0)
 W GMTSDAT S GMCOL=12,ORDER=0 F  S ORDER=$O(FORMAT(ORDER)) Q:ORDER'>0  D
"RTN","GMTSPXMP",48,0)
 . S VALUE="",WIDTH=FORMAT(ORDER,2),NAME=FORMAT(ORDER,0)
"RTN","GMTSPXMP",49,0)
 . S IFN=+$O(^TMP("PXM",$J,GMTSIDT,ORDER,""))
"RTN","GMTSPXMP",50,0)
 . S TVALUE=$G(^TMP("PXM",$J,GMTSIDT,ORDER,IFN))
"RTN","GMTSPXMP",51,0)
 . I TVALUE]""  S VALUE=$P(TVALUE,U),X=$P(TVALUE,U,2) S:X]"" MNOTE(X)=""
"RTN","GMTSPXMP",52,0)
 . S:VALUE]"" VALUE=$S($P(WIDTH,".",2)="":$J(VALUE,$P(WIDTH,".",1)),1:$J(VALUE,$P(WIDTH,".",1),$P(WIDTH,".",2)))
"RTN","GMTSPXMP",53,0)
 . W ?GMCOL,VALUE S GMCOL=GMCOL+WIDTH+2
"RTN","GMTSPXMP",54,0)
 W !
"RTN","GMTSPXMP",55,0)
 Q
"RTN","GMTSPXMP",56,0)
PHDR ; Panel Header
"RTN","GMTSPXMP",57,0)
 I GMW1,'GMTSNPG W ! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXMP",58,0)
 I MPNAME]"" W MPNAME," Measurement Panel",!
"RTN","GMTSPXMP",59,0)
 S GMCOL=10,ORDER=0 F  S ORDER=$O(FORMAT(ORDER)) Q:ORDER'>0  D
"RTN","GMTSPXMP",60,0)
 . S LABEL=FORMAT(ORDER,1),WIDTH=FORMAT(ORDER,2)
"RTN","GMTSPXMP",61,0)
 . W ?(GMCOL+1+(WIDTH-$L(LABEL)\2)),LABEL
"RTN","GMTSPXMP",62,0)
 . S GMCOL=GMCOL+WIDTH+2
"RTN","GMTSPXMP",63,0)
 W ! S GMW1=1
"RTN","GMTSPXMP",64,0)
 Q
"RTN","GMTSPXSK")
0^33^B5659745
"RTN","GMTSPXSK",1,0)
GMTSPXSK ; SLC/SBW,KER - PCE Skin Test comp ; 08/27/2002
"RTN","GMTSPXSK",2,0)
 ;;2.7;Health Summary;**8,10,28,56**;Oct 20, 1995
"RTN","GMTSPXSK",3,0)
 ;
"RTN","GMTSPXSK",4,0)
 ; External References
"RTN","GMTSPXSK",5,0)
 ;   DBIA  1240  SKIN^PXRHS04
"RTN","GMTSPXSK",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPXSK",7,0)
 ;                      
"RTN","GMTSPXSK",8,0)
SKIN ; Main Entry Point
"RTN","GMTSPXSK",9,0)
 K ^TMP("PXS",$J) D SKIN^PXRHS04(DFN) Q:'$D(^TMP("PXS",$J))
"RTN","GMTSPXSK",10,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXSK",11,0)
 N GMSK,GMDT,GMIFN,GMW,GMSITE,GMSKIN,GMN0,GMN1,GMRDG,X,GMTSDAT,GMRES
"RTN","GMTSPXSK",12,0)
 N COMMENT,GMICL,GMRDT,GMTSLN,GMTAB S GMSK=""
"RTN","GMTSPXSK",13,0)
 F  S GMSK=$O(^TMP("PXS",$J,GMSK)) Q:GMSK=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXSK",14,0)
 . S (GMDT,GMW)=0
"RTN","GMTSPXSK",15,0)
 . F  S GMDT=$O(^TMP("PXS",$J,GMSK,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXSK",16,0)
 . . S GMIFN=0
"RTN","GMTSPXSK",17,0)
 . . F  S GMIFN=$O(^TMP("PXS",$J,GMSK,GMDT,GMIFN)) Q:GMIFN'>0  D SKINDSP Q:$D(GMTSQIT)
"RTN","GMTSPXSK",18,0)
 K ^TMP("PXS",$J)
"RTN","GMTSPXSK",19,0)
 Q
"RTN","GMTSPXSK",20,0)
HDR ; Display Header
"RTN","GMTSPXSK",21,0)
 W ?38," -  Date  - ",!
"RTN","GMTSPXSK",22,0)
 W "Skin Test",?15,"Reading",?24,"Results",?37,"Admin.",?45,"Reading",?60,"Facility",!!
"RTN","GMTSPXSK",23,0)
 Q
"RTN","GMTSPXSK",24,0)
SKINDSP ; Display Skin Test Data
"RTN","GMTSPXSK",25,0)
 S GMN0=$G(^TMP("PXS",$J,GMSK,GMDT,GMIFN,0)) Q:GMN0']""
"RTN","GMTSPXSK",26,0)
 S GMN1=$G(^TMP("PXS",$J,GMSK,GMDT,GMIFN,1))
"RTN","GMTSPXSK",27,0)
 S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXSK",28,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXSK",29,0)
 S GMSKIN=$P(GMN0,U),GMRDG=$P(GMN0,U,5)
"RTN","GMTSPXSK",30,0)
 S X=$P(GMN0,U,6) D REGDT4^GMTSU S GMRDT=X
"RTN","GMTSPXSK",31,0)
 I GMRDG]"" S GMRDG=$J(GMRDG,2)_" mm"
"RTN","GMTSPXSK",32,0)
 S GMRES=$P(GMN0,U,4)
"RTN","GMTSPXSK",33,0)
 I GMRDG']"",GMRES']"" S GMRES="UNREPORTED"
"RTN","GMTSPXSK",34,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR W:GMW'>0!GMTSNPG GMSKIN W ?15,GMRDG,?24,GMRES,?35,GMTSDAT,?47,GMRDT,?62,$E(GMSITE,1,17),!
"RTN","GMTSPXSK",35,0)
 S COMMENT=$P($G(^TMP("PXS",$J,GMSK,GMDT,GMIFN,"COM")),U)
"RTN","GMTSPXSK",36,0)
 I COMMENT]"" S GMICL=15,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXSK",37,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXSK",38,0)
 S GMW=1
"RTN","GMTSPXSK",39,0)
 Q
"RTN","GMTSPXSK",40,0)
FORMAT ; Format Line
"RTN","GMTSPXSK",41,0)
 N DIWR,DIWF,X S DIWL=3,DIWR=80-(GMICL+GMTAB) K ^UTILITY($J,"W")
"RTN","GMTSPXSK",42,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXSK",43,0)
 Q
"RTN","GMTSPXSK",44,0)
LINE ; Write Line
"RTN","GMTSPXSK",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?15,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXSK",46,0)
 Q
"RTN","GMTSPXTP")
0^34^B9399666
"RTN","GMTSPXTP",1,0)
GMTSPXTP ; SLC/SBW,KER - PCE Treatment Comp ; 08/27/2002
"RTN","GMTSPXTP",2,0)
 ;;2.7;Health Summary;**8,10,28,56**;Oct 20, 1995
"RTN","GMTSPXTP",3,0)
 ;
"RTN","GMTSPXTP",4,0)
 ; External References
"RTN","GMTSPXTP",5,0)
 ;   DBIA  1242  TREAT^PXRHS06
"RTN","GMTSPXTP",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPXTP",7,0)
 ;                      
"RTN","GMTSPXTP",8,0)
TRTMT ; Treatments within a Date Range and Service Category
"RTN","GMTSPXTP",9,0)
 N SERCAT S SERCAT="AICTSORXHDE"
"RTN","GMTSPXTP",10,0)
 ;                   
"RTN","GMTSPXTP",11,0)
 ;   SERCAT is a sting containing service categories:
"RTN","GMTSPXTP",12,0)
 ;       Ambulatory                        A
"RTN","GMTSPXTP",13,0)
 ;       Inpatient                         I
"RTN","GMTSPXTP",14,0)
 ;       Chart Review                      C
"RTN","GMTSPXTP",15,0)
 ;       Telecommunications                T
"RTN","GMTSPXTP",16,0)
 ;       Day Surgery                       S
"RTN","GMTSPXTP",17,0)
 ;       Observation                       O
"RTN","GMTSPXTP",18,0)
 ;       Nursing Home                      R
"RTN","GMTSPXTP",19,0)
 ;       Ancillary                         X
"RTN","GMTSPXTP",20,0)
 ;       Hospitalization                   H
"RTN","GMTSPXTP",21,0)
 ;       Daily Hospitalization Ancillary   D 
"RTN","GMTSPXTP",22,0)
 ;       Historical event encounters       E
"RTN","GMTSPXTP",23,0)
 ;                     
"RTN","GMTSPXTP",24,0)
 K ^TMP("PXT",$J)
"RTN","GMTSPXTP",25,0)
 D TREAT^PXRHS06(DFN,GMTSEND,GMTSBEG,GMTSNDM,SERCAT) Q:'$D(^TMP("PXT",$J))
"RTN","GMTSPXTP",26,0)
 N GMDT,GMIFN,GMSITE,GMN0,GMN1,X,GMTSDAT,TREAT,NUM,PDT
"RTN","GMTSPXTP",27,0)
 N GMTXT,GMTSICL,DIWL,GMTAB,GMTSX,GMCKP,PNARR,GMPSITE,GMTR,PSITE
"RTN","GMTSPXTP",28,0)
 N GMTSLN,GMICL,GMTAB,COMMENT S GMTSICL=24,DIWL=0,GMTAB=2,GMDT=0
"RTN","GMTSPXTP",29,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXTP",30,0)
 F  S GMDT=$O(^TMP("PXT",$J,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXTP",31,0)
 . S GMTR=""
"RTN","GMTSPXTP",32,0)
 . F  S GMTR=$O(^TMP("PXT",$J,GMDT,GMTR)) Q:GMTR']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXTP",33,0)
 . . S GMIFN=0
"RTN","GMTSPXTP",34,0)
 . . F  S GMIFN=$O(^TMP("PXT",$J,GMDT,GMTR,GMIFN)) Q:GMIFN'>0  D TREATDSP Q:$D(GMTSQIT)
"RTN","GMTSPXTP",35,0)
 K ^TMP("PXT",$J)
"RTN","GMTSPXTP",36,0)
 Q
"RTN","GMTSPXTP",37,0)
HDR ; Display Header
"RTN","GMTSPXTP",38,0)
 W ?2,"Date",?10,"Facility",?22,"Treatment (Qty) ; Provider Narrative",!!
"RTN","GMTSPXTP",39,0)
 Q
"RTN","GMTSPXTP",40,0)
TREATDSP ; Display Treatment Data
"RTN","GMTSPXTP",41,0)
 S GMN0=$G(^TMP("PXT",$J,GMDT,GMTR,GMIFN,0)) Q:GMN0']""
"RTN","GMTSPXTP",42,0)
 S GMN1=$G(^TMP("PXT",$J,GMDT,GMTR,GMIFN,1))
"RTN","GMTSPXTP",43,0)
 S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXTP",44,0)
 S X=$P(GMN0,U,2)
"RTN","GMTSPXTP",45,0)
 D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXTP",46,0)
 S TREAT=$P(GMN0,U),NUM=$P(GMN0,U,3)
"RTN","GMTSPXTP",47,0)
 S PNARR=$G(^TMP("PXT",$J,GMDT,GMTR,GMIFN,"P")) S:PNARR=TREAT PNARR=""
"RTN","GMTSPXTP",48,0)
 S GMTXT=TREAT_$S(NUM]"":" ("_NUM_")",1:"")_$S(PNARR]"":"; "_PNARR,1:"")
"RTN","GMTSPXTP",49,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSPXTP",50,0)
 I GMTSDAT'=$G(PDT)!GMTSNPG W GMTSDAT S PDT=GMTSDAT,PSITE=""
"RTN","GMTSPXTP",51,0)
 I GMSITE'=$G(PSITE) W ?12,GMSITE S PSITE=GMSITE
"RTN","GMTSPXTP",52,0)
 D TXTFMT^GMTSPXU1(GMTXT,"",GMTSICL,GMTAB,DIWL)
"RTN","GMTSPXTP",53,0)
 I '$D(^UTILITY($J,"W")) Q
"RTN","GMTSPXTP",54,0)
 S (GMTSX,GMCKP)=0
"RTN","GMTSPXTP",55,0)
 F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0!$D(GMTSQIT)  D
"RTN","GMTSPXTP",56,0)
 . I GMCKP>0 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR W:GMTSNPG GMTSDAT,?10,GMSITE
"RTN","GMTSPXTP",57,0)
 . S GMCKP=1
"RTN","GMTSPXTP",58,0)
 . W ?GMTSICL+$S(GMTSX>1:GMTAB,1:0),$G(^UTILITY($J,"W",DIWL,GMTSX,0)),!
"RTN","GMTSPXTP",59,0)
 S COMMENT=$P($G(^TMP("PXT",$J,GMDT,GMTR,GMIFN,"COM")),U)
"RTN","GMTSPXTP",60,0)
 I COMMENT]"" S GMICL=26,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXTP",61,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXTP",62,0)
 Q
"RTN","GMTSPXTP",63,0)
FORMAT ; Format Line
"RTN","GMTSPXTP",64,0)
 N DIWR,DIWF,X S DIWL=3,DIWR=80-(GMICL+GMTAB) K ^UTILITY($J,"W")
"RTN","GMTSPXTP",65,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXTP",66,0)
 Q
"RTN","GMTSPXTP",67,0)
LINE ; Write Line
"RTN","GMTSPXTP",68,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?26,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXTP",69,0)
 Q
"RTN","GMTSPXU2")
0^35^B18783308
"RTN","GMTSPXU2",1,0)
GMTSPXU2 ;SLC/KKA,SBW - PCE Drivers for visits ; 08/27/2002
"RTN","GMTSPXU2",2,0)
 ;;2.7;Health Summary;**2,56**;Oct 20, 1995
"RTN","GMTSPXU2",3,0)
 ;
"RTN","GMTSPXU2",4,0)
 ; External References
"RTN","GMTSPXU2",5,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSPXU2",6,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSPXU2",7,0)
 ;   DBIA    17  ^DGPM("ATID1")
"RTN","GMTSPXU2",8,0)
 ;   DBIA    17  ^DGPM(  file #405
"RTN","GMTSPXU2",9,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSPXU2",10,0)
 ;   DBIA  1273  VISIT^PXRHS14
"RTN","GMTSPXU2",11,0)
 ;                      
"RTN","GMTSPXU2",12,0)
MENU(DFN,GMTSPX2,GMTSPX1) ; HS Selection Menu
"RTN","GMTSPXU2",13,0)
 ;                      
"RTN","GMTSPXU2",14,0)
 ;   Allows user to choose Outpatient Visits based
"RTN","GMTSPXU2",15,0)
 ;   on V files or Inpatient visits based on patient
"RTN","GMTSPXU2",16,0)
 ;   movement file.
"RTN","GMTSPXU2",17,0)
 N DIR,SEL,DTOUT,DIRUT
"RTN","GMTSPXU2",18,0)
 S (GMTSPX2,GMTSPX1)=""
"RTN","GMTSPXU2",19,0)
 ;                      
"RTN","GMTSPXU2",20,0)
 ;   If PCE not installed just allow for inpatient
"RTN","GMTSPXU2",21,0)
 ;   range selection
"RTN","GMTSPXU2",22,0)
 I $$VERSION^XPDUTL("PX")'>0 D INPAT^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1) Q
"RTN","GMTSPXU2",23,0)
 S DIR(0)="SO^1:Outpatient Visit Date;2:Admission Date"
"RTN","GMTSPXU2",24,0)
 S DIR("?")="Select 1 or 2 or ^ to exit"
"RTN","GMTSPXU2",25,0)
 D ^DIR
"RTN","GMTSPXU2",26,0)
 Q:$D(DIRUT)!(+$G(Y)'>0)
"RTN","GMTSPXU2",27,0)
 S SEL=+Y
"RTN","GMTSPXU2",28,0)
 D:SEL=1 OUTPAT^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1)
"RTN","GMTSPXU2",29,0)
 D:SEL=2 INPAT^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1)
"RTN","GMTSPXU2",30,0)
 Q
"RTN","GMTSPXU2",31,0)
 ;                      
"RTN","GMTSPXU2",32,0)
OUTPAT(DFN,DATEFROM,DATETO) ; Select by Outpatient Visit Date
"RTN","GMTSPXU2",33,0)
 N INPDATE,DIRUT,DTOUT
"RTN","GMTSPXU2",34,0)
 D OUTLOOK(DFN,.INPDATE)
"RTN","GMTSPXU2",35,0)
 Q:INPDATE']""
"RTN","GMTSPXU2",36,0)
 I INPDATE]"" S (DATEFROM,DATETO)=$P(INPDATE,".")
"RTN","GMTSPXU2",37,0)
 Q
"RTN","GMTSPXU2",38,0)
INPAT(DFN,DATEFROM,DATETO) ; Select by Inpatient Visit Date
"RTN","GMTSPXU2",39,0)
 N DIRUT,DTOUT
"RTN","GMTSPXU2",40,0)
 D INLOOK(DFN,.DATEFROM,.DATETO)
"RTN","GMTSPXU2",41,0)
 I DATEFROM']""!(DATETO']"") S (DATEFROM,DATETO)=""
"RTN","GMTSPXU2",42,0)
 Q
"RTN","GMTSPXU2",43,0)
INLOOK(DFN,GMTSADM,GMTSDC) ; Displays Patient's Admission Dates
"RTN","GMTSPXU2",44,0)
 N DIR,Y,X,ADT,RECNR,CTR,HIT,DCDT,ADMDT,SELNR
"RTN","GMTSPXU2",45,0)
 S (GMTSADM,GMTSDC)=""
"RTN","GMTSPXU2",46,0)
 I '$D(^DGPM("ATID1",DFN)) W !!,"No admissions on file for this patient" Q
"RTN","GMTSPXU2",47,0)
 K ^TMP("GMTSPX",$J)
"RTN","GMTSPXU2",48,0)
 S (CTR,HIT,ADT,SELNR)=0
"RTN","GMTSPXU2",49,0)
 F  S ADT=$O(^DGPM("ATID1",DFN,ADT)) Q:+ADT'>0  D  Q:$D(DIRUT)!+$G(Y)
"RTN","GMTSPXU2",50,0)
 . S RECNR=0
"RTN","GMTSPXU2",51,0)
 . F  S RECNR=$O(^DGPM("ATID1",DFN,ADT,RECNR)) Q:RECNR'>0  D  Q:$D(DIRUT)!+$G(Y)
"RTN","GMTSPXU2",52,0)
 . . S ADMDT=$P(^DGPM(RECNR,0),U)
"RTN","GMTSPXU2",53,0)
 . . S DCDT=$P($G(^DGPM(+$P(^DGPM(RECNR,0),U,17),0)),U)
"RTN","GMTSPXU2",54,0)
 . . D:'HIT INHDR S HIT=1,SELNR=SELNR+1,CTR=CTR+1
"RTN","GMTSPXU2",55,0)
 . . W !,?7,SELNR,?15,$$FMTE^XLFDT(ADMDT,"2P")
"RTN","GMTSPXU2",56,0)
 . . W:DCDT]"" ?45,$$FMTE^XLFDT(DCDT,"2P")
"RTN","GMTSPXU2",57,0)
 . . S ^TMP("GMTSPX",$J,SELNR)=ADMDT_U_DCDT
"RTN","GMTSPXU2",58,0)
 . . I CTR>9 D  Q:$D(DTOUT)!$D(DUOUT)!(+$G(Y)>0)
"RTN","GMTSPXU2",59,0)
 . . . S DIR("A")="Enter a number between 1 and "_SELNR_", press return to continue or '^' to exit: "
"RTN","GMTSPXU2",60,0)
 . . . S DIR(0)="NOA^1:"_SELNR D ^DIR S CTR=0 W !
"RTN","GMTSPXU2",61,0)
 Q:$D(DUOUT)!$D(DTOUT)!$D(DIROUT)
"RTN","GMTSPXU2",62,0)
 I SELNR>0,(CTR>0),(CTR'>9)&(+$G(Y)'>0) D
"RTN","GMTSPXU2",63,0)
 . S DIR("A")="Enter a number between 1 and "_SELNR_": "
"RTN","GMTSPXU2",64,0)
 . S DIR(0)="NOA^1:"_SELNR D ^DIR W !
"RTN","GMTSPXU2",65,0)
 Q:$D(DUOUT)!$D(DTOUT)!$D(DIROUT)!(+$G(Y)'>0)
"RTN","GMTSPXU2",66,0)
 S GMTSADM=$P($P($G(^TMP("GMTSPX",$J,+Y)),U),".")
"RTN","GMTSPXU2",67,0)
 S GMTSDC=$P($P($G(^TMP("GMTSPX",$J,+Y)),U,2),".")
"RTN","GMTSPXU2",68,0)
 I GMTSADM]"",GMTSDC="" S GMTSDC=DT
"RTN","GMTSPXU2",69,0)
 K ^TMP("GMTSPX",$J)
"RTN","GMTSPXU2",70,0)
 Q
"RTN","GMTSPXU2",71,0)
 ;                      
"RTN","GMTSPXU2",72,0)
INHDR ; Based on the VISIT File
"RTN","GMTSPXU2",73,0)
 W !!,?15,"ADMISSION DATE/TIME",?45,"DISCHARGE DATE/TIME",!
"RTN","GMTSPXU2",74,0)
 Q
"RTN","GMTSPXU2",75,0)
 ;                      
"RTN","GMTSPXU2",76,0)
OUTLOOK(DFN,OUT) ; Display Outpatient Visits
"RTN","GMTSPXU2",77,0)
 ;                      
"RTN","GMTSPXU2",78,0)
 ;   This option displays outpatient visits from the
"RTN","GMTSPXU2",79,0)
 ;   Visit (#9000010) file to the screen. Outpatient 
"RTN","GMTSPXU2",80,0)
 ;   visits = visits with a service category of:
"RTN","GMTSPXU2",81,0)
 ;                      
"RTN","GMTSPXU2",82,0)
 ;      Ambulatory
"RTN","GMTSPXU2",83,0)
 ;      Observation
"RTN","GMTSPXU2",84,0)
 ;      Day Surgery
"RTN","GMTSPXU2",85,0)
 ;      Nursing Home
"RTN","GMTSPXU2",86,0)
 ;                      
"RTN","GMTSPXU2",87,0)
 ;   A number, the visit date, and the hospital location
"RTN","GMTSPXU2",88,0)
 ;   or credit stop will be display on the screen. The 
"RTN","GMTSPXU2",89,0)
 ;   order of the display will be from most recent visits
"RTN","GMTSPXU2",90,0)
 ;   to oldest visits. The user can pick the visit they 
"RTN","GMTSPXU2",91,0)
 ;   want and the visit date is passed back to the calling
"RTN","GMTSPXU2",92,0)
 ;   routine by parameter passing by reference.  
"RTN","GMTSPXU2",93,0)
 ;                        
"RTN","GMTSPXU2",94,0)
 N DIR,Y,X,VISITDT,CTR,SELNR,RECNR,CLINIC,HIT,VISIT,HLOC
"RTN","GMTSPXU2",95,0)
 S OUT=""
"RTN","GMTSPXU2",96,0)
 K ^TMP("HS",$J),^TMP("PXV",$J)
"RTN","GMTSPXU2",97,0)
 S (CTR,HIT,SELNR,VISITDT,RECNR)=0
"RTN","GMTSPXU2",98,0)
 S VISITDT="",RECNR=""
"RTN","GMTSPXU2",99,0)
 F  D VISIT^PXRHS14(DFN,.VISITDT,.RECNR,1,"ASOR") Q:VISITDT'>0  D  Q:$D(DUOUT)!$D(DTOUT)!(+$G(Y)>0)
"RTN","GMTSPXU2",100,0)
 . S NODE=$G(^TMP("PXV",$J,VISITDT,RECNR))
"RTN","GMTSPXU2",101,0)
 . K ^TMP("PXV",$J)
"RTN","GMTSPXU2",102,0)
 . Q:NODE']""
"RTN","GMTSPXU2",103,0)
 . S VISIT=$P(NODE,U)
"RTN","GMTSPXU2",104,0)
 . S CLINIC=$P(NODE,U,4)
"RTN","GMTSPXU2",105,0)
 . S HLOC=$P(NODE,U,6)
"RTN","GMTSPXU2",106,0)
 . D:'HIT OUTHDR S HIT=1 S SELNR=SELNR+1,CTR=CTR+1
"RTN","GMTSPXU2",107,0)
 . W !,?7,SELNR,?15,$$FMTE^XLFDT(VISIT,"2P"),?45,$S(HLOC]"":HLOC,1:CLINIC)
"RTN","GMTSPXU2",108,0)
 . S ^TMP("HS",$J,SELNR)=RECNR_U_VISIT_U_CLINIC_U_HLOC
"RTN","GMTSPXU2",109,0)
 . I CTR>9 D  Q:$D(DTOUT)!$D(DUOUT)!(+$G(Y)>0)
"RTN","GMTSPXU2",110,0)
 . . S DIR("A")="Enter a number between 1 and "_SELNR_", press return to continue or '^' to exit: "
"RTN","GMTSPXU2",111,0)
 . . S DIR(0)="NOA^1:"_SELNR D ^DIR S CTR=0 W !
"RTN","GMTSPXU2",112,0)
 I SELNR>0&(CTR>0)&(CTR'>9) D
"RTN","GMTSPXU2",113,0)
 . S DIR("A")="Enter a number between 1 and "_SELNR_": "
"RTN","GMTSPXU2",114,0)
 . S DIR(0)="NOA^1:"_SELNR D ^DIR W !
"RTN","GMTSPXU2",115,0)
 I SELNR'>0 W !!,"No Outpatient visits for this patient" Q
"RTN","GMTSPXU2",116,0)
 S OUT=$P($G(^TMP("HS",$J,+$G(Y))),U,2)
"RTN","GMTSPXU2",117,0)
 K ^TMP("HS",$J),^TMP("PXV",$J)
"RTN","GMTSPXU2",118,0)
 Q
"RTN","GMTSPXU2",119,0)
OUTHDR ; Header for screen Display
"RTN","GMTSPXU2",120,0)
 W !!,?15,"VISIT DATE/TIME",?45,"HOSPITAL LOCATION/CLINIC",!
"RTN","GMTSPXU2",121,0)
 Q
"RTN","GMTSPXXP")
0^36^B5232936
"RTN","GMTSPXXP",1,0)
GMTSPXXP ; SLC/SBW,KER - PCE Examination Comp ; 08/27/2002
"RTN","GMTSPXXP",2,0)
 ;;2.7;Health Summary;**8,10,28,56**;Oct 20, 1995
"RTN","GMTSPXXP",3,0)
 ;
"RTN","GMTSPXXP",4,0)
 ; External References
"RTN","GMTSPXXP",5,0)
 ;   DBIA  3063  EXAM^PXRHS05
"RTN","GMTSPXXP",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPXXP",7,0)
 ;                    
"RTN","GMTSPXXP",8,0)
MRE ; Most Recent Examination
"RTN","GMTSPXXP",9,0)
 K ^TMP("PXE",$J)
"RTN","GMTSPXXP",10,0)
 N MAX S MAX=1
"RTN","GMTSPXXP",11,0)
 ;                    
"RTN","GMTSPXXP",12,0)
 ;   This routine could be expanded to included
"RTN","GMTSPXXP",13,0)
 ;   occurrence limits by setting max to GMTSNDM
"RTN","GMTSPXXP",14,0)
 ;   and enabling occurrence limit for the 
"RTN","GMTSPXXP",15,0)
 ;   component. Component name would have to 
"RTN","GMTSPXXP",16,0)
 ;   change also.
"RTN","GMTSPXXP",17,0)
 ;                    
"RTN","GMTSPXXP",18,0)
 D EXAM^PXRHS05(DFN,GMTSEND,GMTSBEG,MAX) Q:'$D(^TMP("PXE",$J))
"RTN","GMTSPXXP",19,0)
 N GMEXAM,GMDT,GMIFN,GMW,GMSITE,GMN0,GMN1,X,GMTSDAT,EXAM,RESULT
"RTN","GMTSPXXP",20,0)
 N COMMENT,GMICL,GMTAB,GMTSLN
"RTN","GMTSPXXP",21,0)
 S GMEXAM="" D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSPXXP",22,0)
 F  S GMEXAM=$O(^TMP("PXE",$J,GMEXAM)) Q:GMEXAM=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXXP",23,0)
 . S (GMDT,GMW)=0
"RTN","GMTSPXXP",24,0)
 . F  S GMDT=$O(^TMP("PXE",$J,GMEXAM,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXXP",25,0)
 . . S GMIFN=0
"RTN","GMTSPXXP",26,0)
 . . F  S GMIFN=$O(^TMP("PXE",$J,GMEXAM,GMDT,GMIFN)) Q:GMIFN'>0  D EXAMDSP Q:$D(GMTSQIT)
"RTN","GMTSPXXP",27,0)
 K ^TMP("PXE",$J)
"RTN","GMTSPXXP",28,0)
 Q
"RTN","GMTSPXXP",29,0)
HDR ; Header
"RTN","GMTSPXXP",30,0)
 W ?5,"Exam",?32,"Result",?47,"Date",?55,"Facility",!!
"RTN","GMTSPXXP",31,0)
 Q
"RTN","GMTSPXXP",32,0)
EXAMDSP ; Display Exam Data
"RTN","GMTSPXXP",33,0)
 S GMN0=$G(^TMP("PXE",$J,GMEXAM,GMDT,GMIFN,0)) Q:GMN0']""
"RTN","GMTSPXXP",34,0)
 S GMN1=$G(^TMP("PXE",$J,GMEXAM,GMDT,GMIFN,1))
"RTN","GMTSPXXP",35,0)
 S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXXP",36,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXXP",37,0)
 S EXAM=$P(GMN0,U),RESULT=$P(GMN0,U,4)
"RTN","GMTSPXXP",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR W:GMW'>0!GMTSNPG EXAM
"RTN","GMTSPXXP",39,0)
 W ?32,RESULT,?45,GMTSDAT,?57,GMSITE,!
"RTN","GMTSPXXP",40,0)
 S COMMENT=$P($G(^TMP("PXE",$J,GMEXAM,GMDT,GMIFN,"COM")),U)
"RTN","GMTSPXXP",41,0)
 I COMMENT]"" S GMICL=13,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D
"RTN","GMTSPXXP",42,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXXP",43,0)
 S GMW=1
"RTN","GMTSPXXP",44,0)
 Q
"RTN","GMTSPXXP",45,0)
FORMAT ; Format Line
"RTN","GMTSPXXP",46,0)
 N DIWR,DIWF,X S DIWL=3,DIWR=80-(GMICL+GMTAB) K ^UTILITY($J,"W")
"RTN","GMTSPXXP",47,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXXP",48,0)
 Q
"RTN","GMTSPXXP",49,0)
LINE ; Write Line
"RTN","GMTSPXXP",50,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXXP",51,0)
 Q
"RTN","GMTSRAD")
0^13^B17956816
"RTN","GMTSRAD",1,0)
GMTSRAD ; SLC/JER,KER HIN/GJC - Radiology Request Status ; 08/27/2002
"RTN","GMTSRAD",2,0)
 ;;2.7;Health Summary;**14,28,56**;Oct 20, 1995
"RTN","GMTSRAD",3,0)
 ;
"RTN","GMTSRAD",4,0)
 ; External References
"RTN","GMTSRAD",5,0)
 ;   DBIA  3125  ^RADPT(
"RTN","GMTSRAD",6,0)
 ;   DBIA  3125  ^RADPT("AO"
"RTN","GMTSRAD",7,0)
 ;   DBIA   504  ^RAO(75.1
"RTN","GMTSRAD",8,0)
 ;   DBIA  2056  $$GET1^DIQ (file 72)
"RTN","GMTSRAD",9,0)
 ;   DBIA  2056  GETS^DIQ (file 70.03)
"RTN","GMTSRAD",10,0)
 ;   DBIA 10015  EN^DIQ1 (file 75.1)
"RTN","GMTSRAD",11,0)
 ;   DBIA 10104  $$LOW^XLFSTR
"RTN","GMTSRAD",12,0)
 ;                  
"RTN","GMTSRAD",13,0)
ENRAD ; Entry Point for HS only
"RTN","GMTSRAD",14,0)
 N MAX K ^TMP("GMTSRAD",$J)
"RTN","GMTSRAD",15,0)
 S MAX=$S(+$G(GMTSNDM)>0:GMTSNDM,1:99999)
"RTN","GMTSRAD",16,0)
 Q:'$D(^RAO(75.1,"AS",DFN))  D GET
"RTN","GMTSRAD",17,0)
 Q:'$D(^TMP("GMTSRAD",$J))  D LOOP
"RTN","GMTSRAD",18,0)
 K ^TMP("GMTSRAD",$J)
"RTN","GMTSRAD",19,0)
 Q
"RTN","GMTSRAD",20,0)
GET ; Extract radiology orders
"RTN","GMTSRAD",21,0)
 N DA,DIC,DIQ,DR,GMI,GMOUT,GMP,GMRDT,GMSTAT,GMPRC,GMSDT,GMDOC S GMI=0
"RTN","GMTSRAD",22,0)
 F  S GMI=$O(^RAO(75.1,"AS",DFN,GMI)) Q:+GMI'>0!+$G(GMOUT)  D
"RTN","GMTSRAD",23,0)
 . S DA=0 F  S DA=$O(^RAO(75.1,"AS",DFN,GMI,DA)) Q:+DA'>0!+$G(GMOUT)  D
"RTN","GMTSRAD",24,0)
 . . N GMORD
"RTN","GMTSRAD",25,0)
 . . S DIC="^RAO(75.1,",DIQ="GMORD(",DIQ(0)="IE",DR="2;5;14;16;23"
"RTN","GMTSRAD",26,0)
 . . D EN^DIQ1
"RTN","GMTSRAD",27,0)
 . . S GMRDT=$G(GMORD(75.1,DA,16,"I")),GMSTAT=$G(GMORD(75.1,DA,5,"E"))
"RTN","GMTSRAD",28,0)
 . . I $S(GMRDT>GMTSEND:1,GMRDT<GMTSBEG:1,1:0) Q
"RTN","GMTSRAD",29,0)
 . . S GMPRC=$G(GMORD(75.1,DA,2,"E")),GMP=$G(GMORD(75.1,DA,2,"I"))
"RTN","GMTSRAD",30,0)
 . . S GMSDT=$G(GMORD(75.1,DA,23,"I")),GMDOC=$E($G(GMORD(75.1,DA,14,"E")),1,14)
"RTN","GMTSRAD",31,0)
 . . I $L(GMPRC)>24 S GMPRC=$$WRAP^GMTSORC(GMPRC,24)
"RTN","GMTSRAD",32,0)
 . . S GMSTAT=$E($$LOW^XLFSTR(GMSTAT))
"RTN","GMTSRAD",33,0)
 . . S ^TMP("GMTSRAD",$J,9999999-GMRDT,DA,+GMP,0)=""
"RTN","GMTSRAD",34,0)
 . . S ^TMP("GMTSRAD",$J,9999999-GMRDT,DA,+GMP)=GMRDT_U_GMSTAT_U_GMPRC_U_GMSDT_U_GMDOC
"RTN","GMTSRAD",35,0)
 . . D REG(DA,GMP)
"RTN","GMTSRAD",36,0)
 Q
"RTN","GMTSRAD",37,0)
HDR ; Write column header
"RTN","GMTSRAD",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Req DT",?11,"Status",?22,"Procedure",?48,"Scheduled DT",?66,"Provider",!
"RTN","GMTSRAD",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSRAD",40,0)
 Q
"RTN","GMTSRAD",41,0)
LOOP ; Loops through ^TMP("GMTSRAD",$J,
"RTN","GMTSRAD",42,0)
 N GMCNT,GMI,GMORD,GMRDT,GMREC S (GMCNT,GMRDT)=0
"RTN","GMTSRAD",43,0)
 D HDR
"RTN","GMTSRAD",44,0)
 F  S GMRDT=$O(^TMP("GMTSRAD",$J,GMRDT)) Q:+GMRDT'>0!(GMCNT=MAX)  D
"RTN","GMTSRAD",45,0)
 . S GMORD=0
"RTN","GMTSRAD",46,0)
 . F  S GMORD=$O(^TMP("GMTSRAD",$J,GMRDT,GMORD)) Q:+GMORD'>0!(GMCNT=MAX)  D
"RTN","GMTSRAD",47,0)
 . . S GMI=0
"RTN","GMTSRAD",48,0)
 . . F  S GMI=$O(^TMP("GMTSRAD",$J,GMRDT,GMORD,GMI)) Q:+GMI'>0!(GMCNT=MAX)  D
"RTN","GMTSRAD",49,0)
 . . . S GMREC(0)=$G(^TMP("GMTSRAD",$J,GMRDT,GMORD,GMI,0))
"RTN","GMTSRAD",50,0)
 . . . S GMREC=$G(^TMP("GMTSRAD",$J,GMRDT,GMORD,GMI)),GMCNT=GMCNT+1 D WRT
"RTN","GMTSRAD",51,0)
 Q
"RTN","GMTSRAD",52,0)
WRT ; Write record
"RTN","GMTSRAD",53,0)
 N GMII,GMRDT1,GMSTAT,GMPRC,GMSDT,GMDOC,GMPRO,X
"RTN","GMTSRAD",54,0)
 S X=+GMREC D REGDT4^GMTSU S GMRDT1=X,GMSTAT=$P(GMREC,U,2)
"RTN","GMTSRAD",55,0)
 S GMPRC=$P(GMREC,U,3)
"RTN","GMTSRAD",56,0)
 S X=$P(GMREC,U,4) D REGDTM4^GMTSU S GMSDT=X,GMDOC=$P(GMREC,U,5)
"RTN","GMTSRAD",57,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSRAD",58,0)
 . I GMTSNPG D HDR
"RTN","GMTSRAD",59,0)
 . W GMRDT1,?13,GMSTAT W:+$G(GMREC(0)) ?17,"Ord: "
"RTN","GMTSRAD",60,0)
 . W ?22,$P(GMPRC,"|"),?48,GMSDT,?66,GMDOC,!
"RTN","GMTSRAD",61,0)
 F GMII=2:1:$L(GMPRC,"|") D
"RTN","GMTSRAD",62,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR W ?22,$P(GMPRC,"|",GMII),!
"RTN","GMTSRAD",63,0)
 I +$G(GMREC(0)) D
"RTN","GMTSRAD",64,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSRAD",65,0)
 . S GMRCNT=0 W ?13,"Actual: "
"RTN","GMTSRAD",66,0)
 . F  S GMRCNT=$O(^TMP("GMTSRAD",$J,GMRDT,GMORD,GMI,GMRCNT)) Q:GMRCNT'>0  D
"RTN","GMTSRAD",67,0)
 .. S GMPRO=$G(^TMP("GMTSRAD",$J,GMRDT,GMORD,GMI,GMRCNT))
"RTN","GMTSRAD",68,0)
 .. D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,$P(GMPRO,"|"),!
"RTN","GMTSRAD",69,0)
 .. F GMII=2:1:$L(GMPRO,"|") D
"RTN","GMTSRAD",70,0)
 ... D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR W ?22,$P(GMPRO,"|",GMII),!
"RTN","GMTSRAD",71,0)
 ... Q
"RTN","GMTSRAD",72,0)
 .. Q
"RTN","GMTSRAD",73,0)
 . Q
"RTN","GMTSRAD",74,0)
 Q
"RTN","GMTSRAD",75,0)
 ;                  
"RTN","GMTSRAD",76,0)
REG(DA,GMP) ; Registered Order Parent/Differs
"RTN","GMTSRAD",77,0)
 ;                 
"RTN","GMTSRAD",78,0)
 ; If the order has been registered, check to see if the
"RTN","GMTSRAD",79,0)
 ; procedure ordered is a parent or if the ordered procedure
"RTN","GMTSRAD",80,0)
 ; differs from the registered procedure.
"RTN","GMTSRAD",81,0)
 ;                 
"RTN","GMTSRAD",82,0)
 ; Input: DA  -> ien of the order in file 75.1
"RTN","GMTSRAD",83,0)
 ;      : GMP -> ien of the ordered procedure
"RTN","GMTSRAD",84,0)
 Q:'$D(^RADPT("AO",DA))
"RTN","GMTSRAD",85,0)
 N GMCNI,GMDFN,GMDTI,GMREG,GMRCNT,GMY2 S GMRCNT=0
"RTN","GMTSRAD",86,0)
 S GMDFN=+$O(^RADPT("AO",DA,0)) Q:'GMDFN
"RTN","GMTSRAD",87,0)
 S GMDTI=+$O(^RADPT("AO",DA,GMDFN,0)) Q:'GMDTI
"RTN","GMTSRAD",88,0)
 S GMY2=$G(^RADPT(GMDFN,"DT",GMDTI,0))
"RTN","GMTSRAD",89,0)
 I '$P(GMY2,"^",5) D  Q
"RTN","GMTSRAD",90,0)
 . S GMCNI=+$O(^RADPT("AO",DA,GMDFN,GMDTI,0)) Q:GMCNI'>0
"RTN","GMTSRAD",91,0)
 . D REG1(DA,GMDFN,GMDTI,GMCNI,GMP)
"RTN","GMTSRAD",92,0)
 . Q
"RTN","GMTSRAD",93,0)
 S GMCNI=0
"RTN","GMTSRAD",94,0)
 F  S GMCNI=$O(^RADPT(GMDFN,"DT",GMDTI,"P",GMCNI)) Q:GMCNI'>0  D
"RTN","GMTSRAD",95,0)
 . D REG1(DA,GMDFN,GMDTI,GMCNI,GMP)
"RTN","GMTSRAD",96,0)
 . Q
"RTN","GMTSRAD",97,0)
 Q
"RTN","GMTSRAD",98,0)
 ;                  
"RTN","GMTSRAD",99,0)
REG1(DA,GMDFN,GMDTI,GMCNI,GMP) ; Registered Order Differs
"RTN","GMTSRAD",100,0)
 ;                    
"RTN","GMTSRAD",101,0)
 ; Check if the ordered procedure differs from
"RTN","GMTSRAD",102,0)
 ; the registered procedure.
"RTN","GMTSRAD",103,0)
 ;                         
"RTN","GMTSRAD",104,0)
 ; Input: DA    -> Order (75.1) ien
"RTN","GMTSRAD",105,0)
 ;        GMDFN -> ien of the patient
"RTN","GMTSRAD",106,0)
 ;        GMDTI -> inv. date/time of exam
"RTN","GMTSRAD",107,0)
 ;        GMCNI -> ien of each case
"RTN","GMTSRAD",108,0)
 ;        GMP   -> ien of the procedure for the order
"RTN","GMTSRAD",109,0)
 ;                     
"RTN","GMTSRAD",110,0)
 ; Sets: ^TMP("GMTSRAD",$J,inv Req Entered Date/Time,
"RTN","GMTSRAD",111,0)
 ;       order ien,proc ien,
"RTN","GMTSRAD",112,0)
 ;                   
"RTN","GMTSRAD",113,0)
 ;            0)=1 if one of the following conditions exist:
"RTN","GMTSRAD",114,0)
 ;            1) the procedure ordered is not the procedure
"RTN","GMTSRAD",115,0)
 ;               registered (exam not cancelled)
"RTN","GMTSRAD",116,0)
 ;            2) the ordered procedure is a parent and the
"RTN","GMTSRAD",117,0)
 ;               descendent procedure(s) have been registered
"RTN","GMTSRAD",118,0)
 ;               (exam not cancelled)
"RTN","GMTSRAD",119,0)
 ;                   
"RTN","GMTSRAD",120,0)
 ; Sets: ^TMP("GMTSRAD",$J,inv Req Entered Date/Time,
"RTN","GMTSRAD",121,0)
 ;       order ien,proc ien,seq #)=Registered Procedure
"RTN","GMTSRAD",122,0)
 N GMIEN,GMPRO,GMREG S GMRCNT=GMRCNT+1
"RTN","GMTSRAD",123,0)
 S GMIEN=GMCNI_","_GMDTI_","_GMDFN_","
"RTN","GMTSRAD",124,0)
 D GETS^DIQ(70.03,GMIEN,"2;3","IE","GMREG")
"RTN","GMTSRAD",125,0)
 S GMPRO=GMREG(70.03,GMIEN,2,"E")
"RTN","GMTSRAD",126,0)
 Q:GMPRO=""
"RTN","GMTSRAD",127,0)
 Q:GMREG(70.03,GMIEN,3,"I")=""
"RTN","GMTSRAD",128,0)
 Q:$$GET1^DIQ(72,GMREG(70.03,GMIEN,3,"I"),3,"I")=0
"RTN","GMTSRAD",129,0)
 Q:GMP=GMREG(70.03,GMIEN,2,"I")
"RTN","GMTSRAD",130,0)
 S ^TMP("GMTSRAD",$J,9999999-GMRDT,DA,+GMP,0)=1
"RTN","GMTSRAD",131,0)
 S:$L(GMPRO)>24 GMPRO=$$WRAP^GMTSORC(GMPRO,24)
"RTN","GMTSRAD",132,0)
 S ^TMP("GMTSRAD",$J,9999999-GMRDT,DA,+GMP,GMRCNT)=GMPRO
"RTN","GMTSRAD",133,0)
 Q
"RTN","GMTSRI")
0^12^B631350
"RTN","GMTSRI",1,0)
GMTSRI ; SLC/DLT,KER - Health Summary Type Inquiry ; 08/27/2002
"RTN","GMTSRI",2,0)
 ;;2.7;Health Summary;**30,56**;Oct 20, 1995
"RTN","GMTSRI",3,0)
 ;                      
"RTN","GMTSRI",4,0)
 ; External References
"RTN","GMTSRI",5,0)
 ;   DBIA 10010  EN1^DIP
"RTN","GMTSRI",6,0)
 ;                     
"RTN","GMTSRI",7,0)
EN ; Inquire/Display a Health Summary Type
"RTN","GMTSRI",8,0)
 S U="^",DIC="^GMT(142,",DIC(0)="AEMQF"
"RTN","GMTSRI",9,0)
 S DIC("A")="Select Health Summary Type: "
"RTN","GMTSRI",10,0)
 S Y=$$TYPE^GMTSULT K DIC("A") G:Y=-1!(Y=U) END S (FR,TO)=$P(Y,"^",2)
"RTN","GMTSRI",11,0)
 S BY=".01",DHD="[GMTS TYPE INQ HEADER]-[GMTS TYPE INQ FOOTER]"
"RTN","GMTSRI",12,0)
 S FLDS="[GMTS TYPE INQ]" S L=0 D EN1^DIP
"RTN","GMTSRI",13,0)
END ; End/Quit without Display
"RTN","GMTSRI",14,0)
 Q
"RTN","GMTSRM")
0^1^B15567698
"RTN","GMTSRM",1,0)
GMTSRM ; SLC/KER - Edit HS Type ; 08/27/2002
"RTN","GMTSRM",2,0)
 ;;2.7;Health Summary;**30,35,29,47,56**;Oct 20, 1995
"RTN","GMTSRM",3,0)
 ;
"RTN","GMTSRM",4,0)
 ; External References
"RTN","GMTSRM",5,0)
 ;    DBIA 10076  ^XUSEC(
"RTN","GMTSRM",6,0)
 ;    DBIA 10076  ^XUSEC("GMTSMGR"
"RTN","GMTSRM",7,0)
 ;    DBIA 10018  ^DIE
"RTN","GMTSRM",8,0)
 ;    DBIA 10010  EN1^DIP
"RTN","GMTSRM",9,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSRM",10,0)
 ;                   
"RTN","GMTSRM",11,0)
MAIN ; Main loop to modify multiple health summary types
"RTN","GMTSRM",12,0)
 N %,DTOUT,DUOUT,DIRUT,EXISTS,GMTSFUNC,GMTSQIT,P
"RTN","GMTSRM",13,0)
 S GMTSQIT=0 F  S EXISTS=0 D SELTYP Q:GMTSQIT
"RTN","GMTSRM",14,0)
 Q
"RTN","GMTSRM",15,0)
SELTYP ; Select Health Summary Type to Edit
"RTN","GMTSRM",16,0)
 N CHANGE,DA,DIC,DIE,DLAYGO,DR,DUOUT,EXISTS,GMTSUM,GMTSNEW,GMTSMGR
"RTN","GMTSRM",17,0)
 N GMTSEG,GMTSIFN,SELCNT,X,Y
"RTN","GMTSRM",18,0)
 W ! S U="^",DIC="^GMT(142,",DIC(0)="AEMQL"
"RTN","GMTSRM",19,0)
 S DIC("A")="Select Health Summary Type: "
"RTN","GMTSRM",20,0)
 S DIC("S")="I +($$AHST^GMTSULT(+($G(Y))))" S DLAYGO=142
"RTN","GMTSRM",21,0)
 S Y=$$TYPE^GMTSULT K DIC S:+Y'>0 GMTSQIT=1 Q:+Y'>0  S (GMTSIFN,DA)=+Y
"RTN","GMTSRM",22,0)
 S GMTSUM=$P(Y,U,2),GMTSNEW=+$P(Y,U,3),GMTSMGR=$S($D(^XUSEC("GMTSMGR",DUZ)):1,1:0)
"RTN","GMTSRM",23,0)
 I 'GMTSMGR,($P(^GMT(142,+DA,0),U,2)]"") D  Q:'GMTSMGR
"RTN","GMTSRM",24,0)
 . S GMTSMGR=$D(^XUSEC($P(^(0),U,2),DUZ))
"RTN","GMTSRM",25,0)
 . W:'GMTSMGR !,$C(7),"This summary report is currently locked to prevent alteration.",!
"RTN","GMTSRM",26,0)
 I 'GMTSMGR,'GMTSNEW,($P(^GMT(142,+DA,0),U,3)'=DUZ) W !,$C(7),"Alteration of this summary report is restricted to its owner.",!,"See the Clinical Coordinator if you need additional help." Q
"RTN","GMTSRM",27,0)
 S DIE="^GMT(142,",(GMTSIFN,DA)=+Y,DR="[GMTS EDIT HLTH SUM TYPE]" D ^DIE
"RTN","GMTSRM",28,0)
 I '$D(^GMT(142,+GMTSIFN,0))!$D(Y)!$D(DUOUT)!$D(DIROUT)!$D(DTOUT) D  Q
"RTN","GMTSRM",29,0)
 . S GMTSQIT=1 D CHKDEL Q
"RTN","GMTSRM",30,0)
 I 'GMTSNEW,($O(^GMT(142,+GMTSIFN,1,0))) S EXISTS=1 D LIST,EXISTS Q
"RTN","GMTSRM",31,0)
 D SELCMP^GMTSRM5 Q:GMTSQIT  D LIST:EXISTS,EXISTS D CHKDEL
"RTN","GMTSRM",32,0)
 Q
"RTN","GMTSRM",33,0)
CHKDEL ; Check for Possible Deletion (New Type without Component)
"RTN","GMTSRM",34,0)
 Q:+($G(GMTSIFN))'>0  Q:'$D(^GMT(142,+($G(GMTSIFN)),0))  D:GMTSMGR!(GMTSNEW)!($P(^GMT(142,+GMTSIFN,0),U,3)'=$G(DUZ)) ADEL^GMTSRM2(+($G(GMTSIFN)))
"RTN","GMTSRM",35,0)
 Q
"RTN","GMTSRM",36,0)
ENADHOC ; Entry point for AD HOC edit
"RTN","GMTSRM",37,0)
 N %,C,CHANGE,DA,DIC,DIE,DR,DUOUT,EXISTS,I,GMTSIFN,GMTSN,GMTSNCNT,GMTSNEW
"RTN","GMTSRM",38,0)
 N GMTSIFN,GMTSUM,P,SELCNT
"RTN","GMTSRM",39,0)
 N GMTSQIT,GMTSFUNC,X,Y
"RTN","GMTSRM",40,0)
 W !!,">>> EDITING the GMTS HS ADHOC OPTION Health Summary Type"
"RTN","GMTSRM",41,0)
 S (GMTSNEW,GMTSQIT)=0
"RTN","GMTSRM",42,0)
 S DIC=142,DIC(0)="XZF",X="GMTS HS ADHOC OPTION"
"RTN","GMTSRM",43,0)
 S Y=$$TYPE^GMTSULT I +Y'>0 D ^GMTSLOAD Q:$D(DIRUT)!$D(DIROUT)  G ENADHOC
"RTN","GMTSRM",44,0)
 S GMTSIFN=+Y,GMTSUM=$P(Y,U,2),EXISTS=1
"RTN","GMTSRM",45,0)
 S DIE="^GMT(142,",DA=GMTSIFN,DR=".08T" D ^DIE
"RTN","GMTSRM",46,0)
 Q:$D(Y)
"RTN","GMTSRM",47,0)
 D LIST,EXISTS
"RTN","GMTSRM",48,0)
 Q
"RTN","GMTSRM",49,0)
EXISTS ; Edit an existing health summary type
"RTN","GMTSRM",50,0)
 N CNT,NXTCMP Q:$D(DUOUT)  S NXTCMP=0,NXTCMP(0)=0
"RTN","GMTSRM",51,0)
 F CNT=$$GETCNT(GMTSIFN):0 D NXTCMP^GMTSRM1,LIST:GMTSQIT Q:GMTSQIT!($D(DUOUT))  K GMTSQIT,GMTSNEW,TWEENER,SOACTION
"RTN","GMTSRM",52,0)
 I NXTCMP>0 W !,"Please hold on while I resequence the summary order" D COPY^GMTSRN,RNMBR^GMTSRN:CHANGE
"RTN","GMTSRM",53,0)
 Q
"RTN","GMTSRM",54,0)
LIST ; Lists existing summary parameters
"RTN","GMTSRM",55,0)
 N B,DIC,DIR,IOP,Y,FR,TO,BY,DHD,FLDS,L
"RTN","GMTSRM",56,0)
 I GMTSQIT'=2 Q:($D(DUOUT)!(GMTSQIT=1))
"RTN","GMTSRM",57,0)
 I GMTSQIT=2,(NXTCMP=0) S GMTSQIT=0 Q
"RTN","GMTSRM",58,0)
 I 'GMTSNEW W ! S DIC=142,DIR(0)="Y",DIR("A")="Do you wish to review the Summary Type structure before continuing",DIR("B")="NO" D ^DIR K DIR I 'Y S:GMTSQIT=2 DUOUT="" S:GMTSQIT=2 GMTSQIT="D" S:$D(DUOUT) GMTSQIT=1 Q
"RTN","GMTSRM",59,0)
 I $D(GMTSQIT),GMTSQIT=2 S GMTSQIT=0
"RTN","GMTSRM",60,0)
 S IOP="HOME",DIC=142,(FR,TO)=GMTSUM,BY=".01",DHD="[GMTS TYPE INQ HEADER]-[GMTS TYPE INQ FOOTER]",FLDS="[GMTS TYPE INQ]",L=0 D EN1^DIP
"RTN","GMTSRM",61,0)
 Q
"RTN","GMTSRM",62,0)
GETCNT(GMTSIFN) ; Determine default summary order for new component
"RTN","GMTSRM",63,0)
 N LI,LCNT S LI=0,LCNT=5 F  S LI=$O(^GMT(142,+GMTSIFN,1,LI)) Q:+LI'>0  S LCNT=$P(LI,".")+5
"RTN","GMTSRM",64,0)
 Q LCNT
"RTN","GMTSRM1A")
0^37^B3970206
"RTN","GMTSRM1A",1,0)
GMTSRM1A ;SLC/JER,SBW - Create/Modify Health Summary (cont) ; 08/27/2002
"RTN","GMTSRM1A",2,0)
 ;;2.7;Health Summary;**56**;Oct 20, 1995
"RTN","GMTSRM1A",3,0)
 ;
"RTN","GMTSRM1A",4,0)
 ; External References
"RTN","GMTSRM1A",5,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSRM1A",6,0)
 ;   DBIA 10018  ^DIE
"RTN","GMTSRM1A",7,0)
 ;                    
"RTN","GMTSRM1A",8,0)
CHKSO ; Checks for existence of Summary Order (SO).
"RTN","GMTSRM1A",9,0)
 ;                    
"RTN","GMTSRM1A",10,0)
 ;   Allows for overwrite or insertion prior
"RTN","GMTSRM1A",11,0)
 ;   to existing "structure" records
"RTN","GMTSRM1A",12,0)
 ;                    
"RTN","GMTSRM1A",13,0)
 N SO,SOACTION,DIR
"RTN","GMTSRM1A",14,0)
 S SO=+Y,CMP(0)=$G(CMP(0))
"RTN","GMTSRM1A",15,0)
 I $D(OLDSO),OLDSO=SO S CMP(.01)=SO Q
"RTN","GMTSRM1A",16,0)
 I $D(OLDSO),OLDSO'=SO S SOACTION="E" D DELCMP^GMTSRM4
"RTN","GMTSRM1A",17,0)
 I '$D(^GMT(142,GMTSIFN,1,SO,0)) S CMP(.01)=+SO,GMTSNEW=1 Q
"RTN","GMTSRM1A",18,0)
 W !,$P(^GMT(142.1,$P(^GMT(142,GMTSIFN,1,SO,0),U,2),0),U)," Already exists at SUMMARY ORDER ",SO
"RTN","GMTSRM1A",19,0)
 S DIR(0)="SO^O:Overwrite;I:Insert Before;A:Append After",DIR("A")="Select Action" D ^DIR K DIR I $D(DIRUT) S GMTSQIT=1 Q
"RTN","GMTSRM1A",20,0)
 I Y="O" S SOACTION="O",OLDSO=SO D DELCMP^GMTSRM4 S GMTSNEW=1,CMP(.01)=SO Q
"RTN","GMTSRM1A",21,0)
 I Y="I" D INSRT^GMTSRM4 Q
"RTN","GMTSRM1A",22,0)
 I Y="A" D APPND^GMTSRM4
"RTN","GMTSRM1A",23,0)
 Q
"RTN","GMTSRM1A",24,0)
LOADSEL ; Load Selection Item Multiple
"RTN","GMTSRM1A",25,0)
 N DA,DC,DIC,DIE,DIEL,DK,DL,DM,DP,DR
"RTN","GMTSRM1A",26,0)
 S:'$D(^GMT(142,GMTSIFN,1,CMP(.01),1,0)) ^(0)="^142.14V^^"
"RTN","GMTSRM1A",27,0)
 S (DIC,DIE)="^GMT(142,"_GMTSIFN_",1,"_CMP(.01)_",1,",DA(2)=GMTSIFN,DA(1)=CMP(.01),DA=IEN S DR=".01////"_"^S X=CMP(142.14,IEN)" D ^DIE
"RTN","GMTSRM1A",28,0)
 Q
"RTN","GMTSRM1A",29,0)
 ;                    
"RTN","GMTSRM1A",30,0)
GETSEL(CMP) ; Get Default Selection Items
"RTN","GMTSRM1A",31,0)
 ;                    
"RTN","GMTSRM1A",32,0)
 ;   Taken from Ad Hoc for Local Components
"RTN","GMTSRM1A",33,0)
 N GMI,GMJ,GMK
"RTN","GMTSRM1A",34,0)
 S GMI=$O(^GMT(142,"B","GMTS HS ADHOC OPTION",0)) Q:+GMI'>0
"RTN","GMTSRM1A",35,0)
 S GMJ=$O(^GMT(142,+GMI,1,"C",+CMP,0)) Q:+GMJ'>0
"RTN","GMTSRM1A",36,0)
 S GMK=0 F  S GMK=$O(^GMT(142,+GMI,1,+GMJ,1,GMK)) Q:+GMK'>0  D
"RTN","GMTSRM1A",37,0)
 . S CMP(142.14,GMK)=$G(^GMT(142,+GMI,1,+GMJ,1,+GMK,0))
"RTN","GMTSRM1A",38,0)
 Q
"RTN","GMTSRM3")
0^38^B12155047
"RTN","GMTSRM3",1,0)
GMTSRM3 ; SLC/DLT - Create/Modify - Selection Items ; 08/27/2002
"RTN","GMTSRM3",2,0)
 ;;2.7;Health Summary;**56**;Oct 20, 1995
"RTN","GMTSRM3",3,0)
 ;
"RTN","GMTSRM3",4,0)
 ; External References
"RTN","GMTSRM3",5,0)
 ;   DBIA  2160  ^XUTL("OR")
"RTN","GMTSRM3",6,0)
 ;   DBIA    67  ^LAB(60,
"RTN","GMTSRM3",7,0)
 ;   DBIA  3137  EN^ORUS
"RTN","GMTSRM3",8,0)
 ;                    
"RTN","GMTSRM3",9,0)
EN ; Entry Logic for Selection Items
"RTN","GMTSRM3",10,0)
 N GMTSN W !!,$S($O(^GMT(142,DA(1),1,DA,1,0)):"Current selection items are:  ",1:"No selection items chosen.")
"RTN","GMTSRM3",11,0)
 S GMTSN=0 F  S GMTSN=$O(^GMT(142,DA(1),1,DA,1,GMTSN)) Q:+GMTSN'>0  S GMTSN(0)=^(GMTSN,0) D SHOWSEL
"RTN","GMTSRM3",12,0)
 W !!,"Select new items one at a time in the sequence you want them displayed."
"RTN","GMTSRM3",13,0)
 W !,"You may select " I SELCNT="" W "any number of items.",!
"RTN","GMTSRM3",14,0)
 E  W "up to ",SELCNT," items.",!
"RTN","GMTSRM3",15,0)
 Q
"RTN","GMTSRM3",16,0)
SHOWSEL ; Writes Current Selection Items
"RTN","GMTSRM3",17,0)
 W ?30,$P(@("^"_$P(GMTSN(0),";",2)_+GMTSN(0)_",0)"),U),!
"RTN","GMTSRM3",18,0)
 Q
"RTN","GMTSRM3",19,0)
EXIT ; Exit Logic for Selection Items
"RTN","GMTSRM3",20,0)
 N GMTSN,SELREF,GMREF I +X,(X["LAB(60,") D
"RTN","GMTSRM3",21,0)
 . S SELREF=U_$P(X,";",2)_+X_",",GMREF=X
"RTN","GMTSRM3",22,0)
 . I '$L($P($G(@(SELREF_"0)")),U,5)) D RESOLVE(GMREF)
"RTN","GMTSRM3",23,0)
 I $S('$D(DA(1)):1,'$D(DA(2)):1,1:0) Q
"RTN","GMTSRM3",24,0)
 S (GMTSNCNT,GMTSN)=0 F  S GMTSN=$O(^GMT(142,DA(2),1,DA(1),1,GMTSN)) Q:'GMTSN  S GMTSNCNT=GMTSNCNT+1
"RTN","GMTSRM3",25,0)
 S $P(^GMT(142,DA(2),1,DA(1),1,0),U,4)=GMTSNCNT
"RTN","GMTSRM3",26,0)
 I SELCNT,(GMTSNCNT'<SELCNT) W !?2,$C(7),"MAXIMUM # OF ITEMS SELECTED.",!
"RTN","GMTSRM3",27,0)
 Q
"RTN","GMTSRM3",28,0)
RESOLVE(GMREF) ; Resolve Compound Items
"RTN","GMTSRM3",29,0)
 N C,IEN,GMI,GMHEAD,P,X,Y K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW")
"RTN","GMTSRM3",30,0)
 S GMHEAD="-- "_$P($G(^LAB(60,+GMREF,.1)),U)_" --"
"RTN","GMTSRM3",31,0)
 S ^XUTL("OR",$J,"GMTS",0)="LAB TEST^1^^0" D COMPILE(+GMREF)
"RTN","GMTSRM3",32,0)
 S ORUS="^XUTL(""OR"","_$J_",""GMTS"",",ORUS("T")="D HEADER^GMTSRM3"
"RTN","GMTSRM3",33,0)
 I +$G(SELCNT) D
"RTN","GMTSRM3",34,0)
 . S ORUS(0)="40MN^"_SELCNT
"RTN","GMTSRM3",35,0)
 . S ORUS("A")="Select 1 - "_SELCNT_" LAB TEST(s): ",ORUS("B")="1-"_SELCNT
"RTN","GMTSRM3",36,0)
 E  S ORUS(0)="40MN",ORUS("A")="Select LAB TEST(s): ",ORUS("B")="ALL"
"RTN","GMTSRM3",37,0)
 D EN^ORUS K ^XUTL("OR",$J,"GMTS"),^("ORU"),^("ORV"),^("ORW")
"RTN","GMTSRM3",38,0)
 I $S('$D(CMP(142.14,DA)):1,$G(CMP(142.14,DA))=GMREF:1,1:0) D
"RTN","GMTSRM3",39,0)
 . I $D(CMP(142.14,+$O(CMP(142.14,DA)))) D
"RTN","GMTSRM3",40,0)
 . . S GMI=DA F  S GMI=$O(CMP(142.14,GMI)) Q:+GMI'>0!(GMI'<(DA+Y))  S CMP(142.14,GMI+Y)=CMP(142.14,GMI)
"RTN","GMTSRM3",41,0)
 . S GMI=0 F  S GMI=$O(Y(GMI)) Q:GMI'>0  D
"RTN","GMTSRM3",42,0)
 . . I '$D(^GMT(142,+$G(DA(2)),1,+$G(DA(1)),1,"B",+$G(Y(GMI))_";LAB(60,")) D
"RTN","GMTSRM3",43,0)
 . . . S CMP(142.14,((GMI-1)+DA))=+$G(Y(GMI))_";LAB(60,"
"RTN","GMTSRM3",44,0)
 S IEN=0 F  S IEN=$O(CMP(142.14,IEN)) Q:IEN'>0  D
"RTN","GMTSRM3",45,0)
 . I $D(^GMT(142,+$G(DA(2)),1,+$G(DA(1)),1,"B",CMP(142.14,IEN))) W $C(7),!,"  Duplicate test omitted." K CMP(142.14,IEN) Q
"RTN","GMTSRM3",46,0)
 . D LOADSEL^GMTSRM1A
"RTN","GMTSRM3",47,0)
 I $P($G(^LAB(60,+$G(^GMT(142,+DA(2),1,+DA(1),1,+DA,0)),0)),U,5)']"" D
"RTN","GMTSRM3",48,0)
 . N REC,SUBREC,SUBSUB S REC=DA(2),SUBREC=DA(1),SUBSUB=DA
"RTN","GMTSRM3",49,0)
 . D DELCOSMO(REC,SUBREC,SUBSUB)
"RTN","GMTSRM3",50,0)
 Q
"RTN","GMTSRM3",51,0)
COMPILE(GMTEST) ; Compile Menu
"RTN","GMTSRM3",52,0)
 N GMC,GMI,GMJ,GMROOT
"RTN","GMTSRM3",53,0)
 S GMI=0 F  S GMI=$O(^LAB(60,GMTEST,2,GMI)) Q:GMI'>0  D
"RTN","GMTSRM3",54,0)
 . S GMJ=+$G(^LAB(60,GMTEST,2,+GMI,0))
"RTN","GMTSRM3",55,0)
 . S GMROOT=$G(^LAB(60,+GMJ,0))
"RTN","GMTSRM3",56,0)
 . I $L($P(GMROOT,U,5)) D
"RTN","GMTSRM3",57,0)
 . . S GMC=+$P($G(^XUTL("OR",$J,"GMTS",0)),U,4)+1
"RTN","GMTSRM3",58,0)
 . . S ^XUTL("OR",$J,"GMTS",GMJ,0)=$P(GMROOT,U),$P(^XUTL("OR",$J,"GMTS",0),U,4)=GMC
"RTN","GMTSRM3",59,0)
 . E  D COMPILE(+$G(^LAB(60,GMTEST,2,GMI,0)))
"RTN","GMTSRM3",60,0)
 Q
"RTN","GMTSRM3",61,0)
HEADER ; Write Header
"RTN","GMTSRM3",62,0)
 W !!?15,"Select the tests which you wish to include, in the",!?19,"sequence in which you wish them to appear."
"RTN","GMTSRM3",63,0)
 W !!?((80-$L(GMHEAD))\2),GMHEAD,!
"RTN","GMTSRM3",64,0)
 Q
"RTN","GMTSRM3",65,0)
DELCOSMO(X1,X2,X3) ; Delete Cosmic Lab Tests from Selection Items
"RTN","GMTSRM3",66,0)
 N TEST S TEST=$G(^GMT(142,X1,1,X2,1,X3,0))
"RTN","GMTSRM3",67,0)
 K ^GMT(142,X1,1,X2,1,"B",TEST),^GMT(142,X1,1,X2,1,X3,0)
"RTN","GMTSRM3",68,0)
 Q
"RTN","GMTSRM4")
0^39^B3045155
"RTN","GMTSRM4",1,0)
GMTSRM4 ;SLC/JER,DLT - Create/Modify - Ins/Apnd/Del Comp ; 08/27/2002
"RTN","GMTSRM4",2,0)
 ;;2.7;Health Summary;**56**;Oct 20, 1995
"RTN","GMTSRM4",3,0)
 ;
"RTN","GMTSRM4",4,0)
 ; External References
"RTN","GMTSRM4",5,0)
 ;   DBIA 10013  ^DIK  (file #142)
"RTN","GMTSRM4",6,0)
 ;                      
"RTN","GMTSRM4",7,0)
INSRT ; Sets Summary Order to Insert Prior to Existing Node
"RTN","GMTSRM4",8,0)
 N LO,NO S (NO,LO)=0 F  S NO=$O(^GMT(142,GMTSIFN,1,NO)) Q:NO=SO  S LO=NO
"RTN","GMTSRM4",9,0)
 S CMP(.01)=+$J(((SO-LO)/2+LO),0,3),CMP(0)="^"_$P($G(CMP(0)),U,2,5),GMTSNEW=1
"RTN","GMTSRM4",10,0)
 I '$D(^GMT(142,GMTSIFN,1,CMP(.01),0)) S CMP(.01)=CMP(.01)
"RTN","GMTSRM4",11,0)
 W !,"Inserted as SUMMARY ORDER: ",CMP(.01)_" "_CMP("NM")
"RTN","GMTSRM4",12,0)
 Q
"RTN","GMTSRM4",13,0)
APPND ; Sets Summary Order to Insert After Existing Node
"RTN","GMTSRM4",14,0)
 N NO S NO=$O(^GMT(142,GMTSIFN,1,SO)) S CMP(.01)=$S(NO>0:+$J(((NO-SO)/2+SO),0,3),1:SO+5),GMTSNEW=1
"RTN","GMTSRM4",15,0)
 I '$D(^GMT(142,GMTSIFN,1,CMP(.01),0)) S CMP(.01)=CMP(.01)
"RTN","GMTSRM4",16,0)
 S CMP(0)="^"_$P($G(CMP(0)),U,2,5)
"RTN","GMTSRM4",17,0)
 W !,"Appended as SUMMARY ORDER: ",CMP(.01)_" "_CMP("NM")
"RTN","GMTSRM4",18,0)
 Q
"RTN","GMTSRM4",19,0)
DELCMP ; Deletes Component from Summary
"RTN","GMTSRM4",20,0)
 N DA,DIK S DIK="^GMT(142,"_GMTSIFN_",1,",DA=OLDSO,DA(1)=GMTSIFN
"RTN","GMTSRM4",21,0)
 S OLDSO("NM")=$S($D(^GMT(142,GMTSIFN,1,OLDSO,0)):$P(^GMT(142.1,$P(^GMT(142,GMTSIFN,1,OLDSO,0),U,2),0),U,1),1:"")
"RTN","GMTSRM4",22,0)
 D ^DIK I SOACTION="D"!(SOACTION="O") W !,$S(SOACTION="O":"Overwriting",1:"Deleting")_" Summary Order "_OLDSO_" "_OLDSO("NM")
"RTN","GMTSRM4",23,0)
 S CNT=$$GETCNT^GMTSRM(GMTSIFN)
"RTN","GMTSRM4",24,0)
 Q
"RTN","GMTSRN")
0^40^B7240616
"RTN","GMTSRN",1,0)
GMTSRN ;SLC/JER - Renumber Selected Health Summary Type ; 08/27/2002
"RTN","GMTSRN",2,0)
 ;;2.7;Health Summary;**36,56**;Oct 20, 1995
"RTN","GMTSRN",3,0)
 ;
"RTN","GMTSRN",4,0)
 ; External References
"RTN","GMTSRN",5,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSRN",6,0)
 ;   DBIA 10076  ^XUSEC(
"RTN","GMTSRN",7,0)
 ;   DBIA 10076  ^XUSEC("GMTSMGR")
"RTN","GMTSRN",8,0)
 ;   DBIA 10013  ^DIK  (file #142)
"RTN","GMTSRN",9,0)
 ;                     
"RTN","GMTSRN",10,0)
MAIN ; Initializes Variables and Controls Branching
"RTN","GMTSRN",11,0)
 N CHANGE,GMTSIFN,GMTSUM,GMTSEG,GMTSI,GMTSJ,GMTSQIT F  D SELECT Q:$D(GMTSQIT)  D COPY,RNMBR:CHANGE W !
"RTN","GMTSRN",12,0)
 Q
"RTN","GMTSRN",13,0)
SELECT ; Select Health Summary Type
"RTN","GMTSRN",14,0)
 N DIR,GMTSKEY,GMTSMGR,GMTSOWN,X,Y
"RTN","GMTSRN",15,0)
 W ! S DIR(0)="PO^142:AEMQZ" D ^DIR K DIR I $D(DIRUT) S GMTSQIT="" Q
"RTN","GMTSRN",16,0)
 S GMTSIFN=+Y,GMTSUM=$P(Y,U,2)
"RTN","GMTSRN",17,0)
 S GMTSKEY=$S($P(^GMT(142,GMTSIFN,0),U,2)]"":$P(^(0),U,2),1:" ZZZ"),GMTSOWN=$S($P(^(0),U,3)>0:$P(^(0),U,3),1:DUZ)
"RTN","GMTSRN",18,0)
 S GMTSMGR=$S($D(^XUSEC("GMTSMGR",DUZ)):1,$D(^XUSEC(GMTSKEY,DUZ)):1,GMTSOWN=DUZ:1,1:0)
"RTN","GMTSRN",19,0)
 I GMTSMGR Q
"RTN","GMTSRN",20,0)
 I '$D(^XUSEC(GMTSKEY,DUZ)) W !,$C(7),"This summary is currently locked to prevent alteration.",! S GMTSQIT="" Q
"RTN","GMTSRN",21,0)
 I GMTSOWN'=DUZ W !,$C(7),"Alteration of this summary is restricted to its owner.",!,"See the Clinical Coordinator if you need additional help." S GMTSQIT=""
"RTN","GMTSRN",22,0)
 Q
"RTN","GMTSRN",23,0)
COPY ; Copies Structure Multiple into GMTSEG(SEQ,
"RTN","GMTSRN",24,0)
 N GMTSI,SEQ K GMTSEG S (CHANGE,GMTSI)=0 I '$D(^GMT(142,GMTSIFN,1,5)) S CHANGE=1
"RTN","GMTSRN",25,0)
 F  S GMTSI=$O(^GMT(142,GMTSIFN,1,GMTSI)) Q:GMTSI'>0  W "." I GMTSI#5'=0 S CHANGE=1
"RTN","GMTSRN",26,0)
 I 'CHANGE Q
"RTN","GMTSRN",27,0)
 S (SEQ,GMTSI)=0 F  S GMTSI=$O(^GMT(142,GMTSIFN,1,GMTSI)) Q:GMTSI'>0  I $P(^(GMTSI,0),U,2) S SEQ=SEQ+1,GMTSEG(SEQ)=^(0) D GETSEL,PURGE W "."
"RTN","GMTSRN",28,0)
 Q
"RTN","GMTSRN",29,0)
GETSEL ; Gets Selection Items from Multiple
"RTN","GMTSRN",30,0)
 N SN S SN=0 F  S SN=$O(^GMT(142,GMTSIFN,1,GMTSI,1,SN)) Q:SN'>0  S GMTSEG(SEQ,SN)=^(SN,0)
"RTN","GMTSRN",31,0)
 Q
"RTN","GMTSRN",32,0)
PURGE ; Deletes Old Node from ^GMT(142,GMTSIFN,1,GMTSI, using ^DIK
"RTN","GMTSRN",33,0)
 N DA,DIK S DA(1)=GMTSIFN,DA=GMTSI,DIK="^GMT(142,"_GMTSIFN_",1," D ^DIK
"RTN","GMTSRN",34,0)
 Q
"RTN","GMTSRN",35,0)
RNMBR ; Traverses GMTSEG(SEQ) - Resets ^GMT(142,GMTSIFN,1,
"RTN","GMTSRN",36,0)
 N DA,DR,DIE,ISEQ,SEQ,CCT S (CCT,SEQ)=0 F  S SEQ=$O(GMTSEG(SEQ)) Q:SEQ'>0  K DA S DIE="^GMT(142,"_GMTSIFN_",1,",DA(1)=GMTSIFN D LOADCMP^GMTSRM5 S CCT=CCT+1 W:CCT#2=0 "."
"RTN","GMTSRN",37,0)
 Q
"RTN","GMTSSOWK")
0^41^B662018
"RTN","GMTSSOWK",1,0)
GMTSSOWK ; SLC/SBW,KER/NDBI - Social Work ; 08/27/2002
"RTN","GMTSSOWK",2,0)
 ;;2.7;Health Summary;**28,56**;Oct 20, 1995
"RTN","GMTSSOWK",3,0)
 ;
"RTN","GMTSSOWK",4,0)
 ; External References
"RTN","GMTSSOWK",5,0)
 ;   DBIA   915  ^SOWKHSUM
"RTN","GMTSSOWK",6,0)
 ;   DBIA  2929  SW^A7RHSM
"RTN","GMTSSOWK",7,0)
 ;                    
"RTN","GMTSSOWK",8,0)
MAIN ; Control branching
"RTN","GMTSSOWK",9,0)
 N GMTSI K ^TMP("SOWK",$J) D ^SOWKHSUM
"RTN","GMTSSOWK",10,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU)&('$D(^TMP("SOWK",$J))) SW^A7RHSM
"RTN","GMTSSOWK",11,0)
 Q:'$D(^TMP("SOWK",$J))  S GMTSI=0
"RTN","GMTSSOWK",12,0)
 F  S GMTSI=$O(^TMP("SOWK",$J,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSSOWK",13,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W $G(^TMP("SOWK",$J,GMTSI)),!
"RTN","GMTSSOWK",14,0)
 K ^TMP("SOWK",$J)
"RTN","GMTSSOWK",15,0)
 Q
"RTN","GMTSU")
0^60^B52384100
"RTN","GMTSU",1,0)
GMTSU ; SLC/JER,KER/NDBI - Health Summary Utilities ; 08/27/2002
"RTN","GMTSU",2,0)
 ;;2.7;Health Summary;**27,28,31,35,37,43,47,56**;Oct 20, 1995
"RTN","GMTSU",3,0)
 ;
"RTN","GMTSU",4,0)
 ; External References
"RTN","GMTSU",5,0)
 ;   DBIA 10096  ^%ZOSF("TEST")
"RTN","GMTSU",6,0)
 ;   DBIA  2934  ^A7RCP (NDBI Global)
"RTN","GMTSU",7,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSU",8,0)
 ;   DBIA 10103  $$FMTHL7^XLFDT
"RTN","GMTSU",9,0)
 ;   DBIA 10103  $$HL7TFM^XLFDT
"RTN","GMTSU",10,0)
 ;   DBIA 10061  OERR^VADPT
"RTN","GMTSU",11,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSU",12,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSU",13,0)
 ;   DBIA  2052  FILE^DID
"RTN","GMTSU",14,0)
 ;   DBIA 10022  %XY^%RCR
"RTN","GMTSU",15,0)
 ;   DBIA  2055  $$VFIELD^DILFD
"RTN","GMTSU",16,0)
 ;   DBIA  2052  $$GET1^DID
"RTN","GMTSU",17,0)
 ;                              
"RTN","GMTSU",18,0)
PROK(X,Y) ; Routine and Patch # OK (in UCI)
"RTN","GMTSU",19,0)
 N GMTS,GMTSI,GMTSO S X=$G(X),Y=$G(Y) Q:'$L(X) 0 Q:Y'=""&(+Y=0)
"RTN","GMTSU",20,0)
 S Y=+Y,GMTS=$$ROK(X) Q:'GMTS 0 Q:+Y=0 1 S GMTSO=0,GMTS=$T(@("+2^"_X)),GMTS=$P($P(GMTS,"**",2),"**",1)
"RTN","GMTSU",21,0)
 F GMTSI=1:1:$L(GMTS,",") S:+($P(GMTS,",",GMTSI))=Y GMTSO=1 Q:GMTSO=1
"RTN","GMTSU",22,0)
 S X=GMTSO Q X
"RTN","GMTSU",23,0)
ROK(X) ; Routine OK (in UCI) (NDBI)
"RTN","GMTSU",24,0)
 S X=$G(X) Q:'$L(X) 0  Q:$L(X)>8 0  X ^%ZOSF("TEST") Q:$T 1  Q 0
"RTN","GMTSU",25,0)
NDBI(X) ; National Database Integration site 1 = yes  0 = no
"RTN","GMTSU",26,0)
 N R,G S X="A7RDUP" X ^%ZOSF("TEST") S R=$T,G=$S($D(^A7RCP):1,1:0),X=R+G,X=$S(X=2:1,1:0) Q X
"RTN","GMTSU",27,0)
 ;                
"RTN","GMTSU",28,0)
CPT(X) ; Use CPT Modifiers  Needs GMTSEG Array
"RTN","GMTSU",29,0)
 S X=+($G(X)) N GMTSN,GMTSC,GMTSM,GMTSA,GMTSI S GMTSN=$G(GMTSEG(X)) S GMTSC=+($P(GMTSN,"^",2)) Q:'GMTSC 0
"RTN","GMTSU",30,0)
 S GMTSM=$S($P(GMTSN,"^",9)="N":0,$P(GMTSN,"^",9)="":1,1:1) Q:'GMTSM 0
"RTN","GMTSU",31,0)
 S GMTSA=$S(+($$CMU(+GMTSC))>0:1,1:0) Q:'GMTSA 0
"RTN","GMTSU",32,0)
 Q 1
"RTN","GMTSU",33,0)
CMU(X) ; Component Uses CPT Modifiers
"RTN","GMTSU",34,0)
 N GMTSA,GMTSN,GMTSI S X=$G(X) Q:'$L(X) 0 S GMTSI=+X,GMTSA=$O(^GMT(142.1,"C",X,0)),GMTSN=$O(^GMT(142.1,"D",X,0)) S:GMTSI=0&(+GMTSA>0) GMTSI=GMTSA S:GMTSI=0&(+GMTSN>0) GMTSI=GMTSN
"RTN","GMTSU",35,0)
 Q:+GMTSI=0 0 S GMTSA=$S($P($G(^GMT(142.1,+GMTSI,0)),"^",14)="Y":1,1:0) Q:'GMTSA 0
"RTN","GMTSU",36,0)
 Q 1
"RTN","GMTSU",37,0)
 ;            
"RTN","GMTSU",38,0)
 ; Dates and Time
"RTN","GMTSU",39,0)
ED(X) ;   Health Summary External Date
"RTN","GMTSU",40,0)
 S X=$G(X) Q:'$L(X) ""  D REGDT4 Q X
"RTN","GMTSU",41,0)
EDT(X) ;   Health Summary External Date and Time
"RTN","GMTSU",42,0)
 S X=$G(X) Q:'$L(X) ""  D REGDTM4 Q X
"RTN","GMTSU",43,0)
REGDT ;   Receives X FM date and returns X in MM/DD/YY format
"RTN","GMTSU",44,0)
 S X=$TR($$FMTE^XLFDT(X,"2DZ"),"@"," ") Q
"RTN","GMTSU",45,0)
REGDT4 ;   Receives X FM date and returns X in MM/DD/YYYY format
"RTN","GMTSU",46,0)
 S X=$TR($$FMTE^XLFDT(X,"5DZ"),"@"," ") Q
"RTN","GMTSU",47,0)
REGDTM ;   Receives X FM date and returns X in MM/DD/YY TT:TT
"RTN","GMTSU",48,0)
 S X=$TR($$FMTE^XLFDT(X,"2ZM"),"@"," ") Q
"RTN","GMTSU",49,0)
REGDTM4 ;   Receives X FM date and returns X in MM/DD/YYYY TT:TT
"RTN","GMTSU",50,0)
 S X=$TR($$FMTE^XLFDT(X,"5ZM"),"@"," ") Q
"RTN","GMTSU",51,0)
SIDT ;   Receives X FM date and returns X in DD MMM YY
"RTN","GMTSU",52,0)
 N MON,MM S X=$P(X,".") S:'X X="" Q:'$L(X)
"RTN","GMTSU",53,0)
 S MON="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"
"RTN","GMTSU",54,0)
 S MM=$E(X,4,5),MM=$S(MM:$P(MON,U,+MM),1:"")
"RTN","GMTSU",55,0)
 S X=$E(X,6,7)_" "_MM_" "_$E(X,2,3) Q
"RTN","GMTSU",56,0)
MTIM ;   Convert Time from X=2890313.1304 to X=13:04
"RTN","GMTSU",57,0)
 S X=$P(X,".",2) Q:'$L(X)  S X=$S(X:$E(X,1,2)_$E("00",0,2-$L($E(X,1,2)))_":"_$E(X,3,4)_$E("00",0,2-$L($E(X,3,4))),1:"")
"RTN","GMTSU",58,0)
 Q
"RTN","GMTSU",59,0)
 ;            
"RTN","GMTSU",60,0)
HF(X) ; Host File - Used to distinguish from Host Files that
"RTN","GMTSU",61,0)
 ; are intended for Printers and Host Files for other
"RTN","GMTSU",62,0)
 ; purposes (windows/files)
"RTN","GMTSU",63,0)
 ;                
"RTN","GMTSU",64,0)
 ;   1 - if Device Type is HFS and not a TCP/IP Printer
"RTN","GMTSU",65,0)
 ;   0 - if Device Type is not HFS or device is a Printer
"RTN","GMTSU",66,0)
 ;            
"RTN","GMTSU",67,0)
 ; Check Device
"RTN","GMTSU",68,0)
 ;   Check Host File Server
"RTN","GMTSU",69,0)
 Q:$G(IOT)'="HFS" 0
"RTN","GMTSU",70,0)
 ;   Check ORWINDEV (Post OR*3.0*85)
"RTN","GMTSU",71,0)
 N GMTS85 S GMTS85=$$PROK("ORWRP",85)
"RTN","GMTSU",72,0)
 Q:+($G(GMTS85))>0&(+($G(ORWINDEV))>0) 0
"RTN","GMTSU",73,0)
 ;   Host File for GUI Scrollable Window
"RTN","GMTSU",74,0)
 Q:$E($G(ION),1,14)["OR WORKSTATION" 1
"RTN","GMTSU",75,0)
 ;   TCP/IP Printer
"RTN","GMTSU",76,0)
 Q:$G(IO)["$PRT"!($G(IO)["PRN|") 0
"RTN","GMTSU",77,0)
 ;   Windows Printer
"RTN","GMTSU",78,0)
 Q:$E($G(ION),1,14)["OR WINDOWS HFS" 0
"RTN","GMTSU",79,0)
 ;   Host Files (file or unspecifed printer)
"RTN","GMTSU",80,0)
 S X=0 S:$G(ION)["HOST FILE" X=1
"RTN","GMTSU",81,0)
 S:$E($G(IOST),1,5)["P-OTH" X=1
"RTN","GMTSU",82,0)
 Q X
"RTN","GMTSU",83,0)
 ;            
"RTN","GMTSU",84,0)
FMHL7DTM ; Convert X - int date/time to HL7 CCYYMMDDHHMM-HHHH
"RTN","GMTSU",85,0)
 S X=$$FMTHL7^XLFDT(+($G(X))) Q
"RTN","GMTSU",86,0)
HL7FMDTM ; Convert X - HL7 CCYYMMDDHHMM-HHHH to int date/time local
"RTN","GMTSU",87,0)
 S X=$$HL7TFM^XLFDT($G(X),"L") Q
"RTN","GMTSU",88,0)
 ;            
"RTN","GMTSU",89,0)
DEM ; Gets Demographic Data from VADPT
"RTN","GMTSU",90,0)
 ;            
"RTN","GMTSU",91,0)
 ;    Input    DFN
"RTN","GMTSU",92,0)
 ;            
"RTN","GMTSU",93,0)
 ;    Output   GMTSPNM     Patient Name
"RTN","GMTSU",94,0)
 ;             GMTSSN      Social Security Number
"RTN","GMTSU",95,0)
 ;             GMTSDOB     Date of Birth
"RTN","GMTSU",96,0)
 ;             SEX         Sex
"RTN","GMTSU",97,0)
 ;             GMTSWARD    Ward
"RTN","GMTSU",98,0)
 ;             GMTSRB      Bed
"RTN","GMTSU",99,0)
 ;             GMTSAGE     Age
"RTN","GMTSU",100,0)
 ;             VADM()      Demographic Array
"RTN","GMTSU",101,0)
 ;             VAIN()      Inpatient Array
"RTN","GMTSU",102,0)
 ;             GMTSPHDR()  Report Header Array
"RTN","GMTSU",103,0)
 ;            
"RTN","GMTSU",104,0)
 K VAHOW D OERR^VADPT S GMTSPNM=VADM(1),GMTSSN=$S($D(VA("PID")):VA("PID"),1:$P(VADM(2),"^",2))
"RTN","GMTSU",105,0)
 S GMTSAGE=$S(+VADM(4)>0:+VADM(4),1:99),SEX=$P(VADM(5),"^")
"RTN","GMTSU",106,0)
 S GMTSWARD=$P(VAIN(4),"^",2),GMTSRB=VAIN(5)
"RTN","GMTSU",107,0)
 S X=$P(VADM(3),"^") D REGDT4 S GMTSDOB=X K VA,GMTSPHDR N DOB,LWARDRB,NMSSN,NMSSNE,WARDRB,WARDRBE,WARDRBS
"RTN","GMTSU",108,0)
 S NMSSN=GMTSPNM_"    "_GMTSSN,NMSSNE=$L(NMSSN)+2,WARDRB=GMTSWARD_" "_GMTSRB
"RTN","GMTSU",109,0)
 S LWARDRB=$L(WARDRB),WARDRBS=40-(LWARDRB/2),WARDRBE=WARDRBS+LWARDRB
"RTN","GMTSU",110,0)
 S DOB="DOB: "_GMTSDOB,GMTSPHDR("NMSSN")=NMSSN,GMTSPHDR("WARDRB")=WARDRB
"RTN","GMTSU",111,0)
 S GMTSPHDR("WARDRBS")=WARDRBS,GMTSPHDR("DOB")=DOB,GMTSPHDR("DOBS")=64
"RTN","GMTSU",112,0)
 I (NMSSNE'<WARDRBS)!(WARDRBE'<64) S GMTSPHDR("TWO")=1
"RTN","GMTSU",113,0)
 Q
"RTN","GMTSU",114,0)
 ;                 
"RTN","GMTSU",115,0)
NAME(X,Y,L) ; Format name
"RTN","GMTSU",116,0)
 ;            
"RTN","GMTSU",117,0)
 ; Input 
"RTN","GMTSU",118,0)
 ;    X    Internal Entry Number of NEW PERSON file 200
"RTN","GMTSU",119,0)
 ;    Y    Flag to specify the first name format
"RTN","GMTSU",120,0)
 ;            0 for First Name Initial (only)
"RTN","GMTSU",121,0)
 ;            1 for First Name
"RTN","GMTSU",122,0)
 ;    L    Maximum Length of Name
"RTN","GMTSU",123,0)
 ;          
"RTN","GMTSU",124,0)
 ; Output  Last,First (name/initial) to specified length
"RTN","GMTSU",125,0)
 ;            
"RTN","GMTSU",126,0)
 N RAWNM,LAST,FIRST,ALPHA,PSN,CH,IEN,FNF,LEN
"RTN","GMTSU",127,0)
 S IEN=+($G(X)),FNF=+($G(Y)),LEN=+($G(L))
"RTN","GMTSU",128,0)
 S RAWNM=$$UNAM^GMTSU2(+IEN) S:LEN=0 LEN=$L(RAWNM)
"RTN","GMTSU",129,0)
 S RAWNM=$S($L(RAWNM):RAWNM,1:"UNKNOWN")
"RTN","GMTSU",130,0)
 S LAST=$P(RAWNM,","),FIRST=$P(RAWNM,",",2),ALPHA=0
"RTN","GMTSU",131,0)
 I $L(FIRST) D
"RTN","GMTSU",132,0)
 . F PSN=1:1 S CH=$E(FIRST,PSN) Q:CH=""  S:CH?1A ALPHA=PSN Q:ALPHA>0
"RTN","GMTSU",133,0)
 S:ALPHA>0 FIRST=$E(FIRST,ALPHA,$L(FIRST))
"RTN","GMTSU",134,0)
 S:'FNF FIRST=$E(FIRST,1)
"RTN","GMTSU",135,0)
 S X=$S($L(FIRST):LAST_","_FIRST,1:LAST),X=$E(X,1,LEN)
"RTN","GMTSU",136,0)
 Q X
"RTN","GMTSU",137,0)
GETRANGE(FROMDATE,TODATE) ; Select Date Range (from and to dates)
"RTN","GMTSU",138,0)
 N DIR,X,Y,DTOUT,DIRUT S DIR(0)="DO^:DT",DIR("A")="Enter Beginning Date (MM/DD/YY)" W !
"RTN","GMTSU",139,0)
 D ^DIR I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) W ! Q
"RTN","GMTSU",140,0)
 S FROMDATE=Y I +FROMDATE>0 D
"RTN","GMTSU",141,0)
 . W "  (",$$UP^XLFSTR($$FMTE^XLFDT(+FROMDATE,1)),")"
"RTN","GMTSU",142,0)
 . N DIR,X,Y S DIR(0)="DO^::EX",DIR("A")="Enter Ending Date (MM/DD/YY)" S DIR("B")="TODAY"
"RTN","GMTSU",143,0)
 . D ^DIR I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) K FROMDATE Q
"RTN","GMTSU",144,0)
 . I Y'>0 K FROMDATE Q
"RTN","GMTSU",145,0)
 . S TODATE=Y Q:TODATE>FROMDATE!(TODATE=FROMDATE) 
"RTN","GMTSU",146,0)
 . N FRDT S FRDT=FROMDATE,FROMDATE=TODATE,TODATE=FRDT
"RTN","GMTSU",147,0)
 W !
"RTN","GMTSU",148,0)
 Q
"RTN","GMTSU",149,0)
 ;                
"RTN","GMTSU",150,0)
OED() ; Other Editor - DIC("S")
"RTN","GMTSU",151,0)
 N COMP,OTHER,OWNER,OWNN,USER,AUSER,NAT S COMP=+($G(DA(1))) Q:'$D(^GMT(142,+COMP,0)) 0
"RTN","GMTSU",152,0)
 S OWNER=$P($G(^GMT(142,+COMP,0)),"^",3),OWNN=$$UNAM^GMTSU2(OWNER),NAT=+($P($G(^GMT(142,+COMP,"VA")),"^",1)),USER=+($G(DUZ)),AUSER=$$UACT^GMTSU2(+USER),OTHER=+($G(X))
"RTN","GMTSU",153,0)
 ;   If National Component and Uneditable
"RTN","GMTSU",154,0)
 W:+NAT=2 !!,"  Nationally exported Health Summary Type (uneditable)",! Q:+NAT=2 0
"RTN","GMTSU",155,0)
 ;   If OWNER is special case (national, uneditable)
"RTN","GMTSU",156,0)
 W:+OWNER>0&(OWNER<1)&(NAT'=1) !!,"  OWNER does not allow 'OTHER EDITORS'",! Q:+OWNER>0&(OWNER<1)&(NAT'=1) 0
"RTN","GMTSU",157,0)
 ;   If OWNER is special case (national, editable)
"RTN","GMTSU",158,0)
 Q:+OWNER>0&(OWNER<1)&(OWNER=USER)&(NAT=1) 1
"RTN","GMTSU",159,0)
 ;   If DUZ is inactive, or not the owner, quit
"RTN","GMTSU",160,0)
 W:+AUSER=0!(+OWNER=0)!(+OWNER'=+USER) !!,"  Only the OWNER may assign 'OTHER EDITORS'",! Q:+AUSER=0!(+OWNER=0)!(+OWNER'=+USER) 0
"RTN","GMTSU",161,0)
 ;   If OTHER is inactive user, quit
"RTN","GMTSU",162,0)
 S AUSER=$$UACT^GMTSU2(OTHER) W:+AUSER=0!(+OTHER'>.999999999) !!,"  Selected 'OTHER EDITOR' is not an active user",! Q:+AUSER=0!(+OTHER'>.999999999) 0
"RTN","GMTSU",163,0)
 ;   If OTHER=OWNER, quit
"RTN","GMTSU",164,0)
 W:+OTHER=+OWNER !!,"  ",OWNN," is the OWNER",! Q:+OTHER=+OWNER 0
"RTN","GMTSU",165,0)
 Q 1
"RTN","GMTSU",166,0)
 ;                
"RTN","GMTSU",167,0)
FCLR(X) ; File Closed Root
"RTN","GMTSU",168,0)
 S X=$G(X) Q:+X=0 "" N GMTSL S GMTSL=$$FLOC(X),X=$S($E(GMTSL,$L(GMTSL))=",":$P(GMTSL,",")_")",1:$E(GMTSL,1,$L(GMTSL)-1)) Q:'$L(X) "" S:'$D(@X) X=""
"RTN","GMTSU",169,0)
 Q X
"RTN","GMTSU",170,0)
FSFN(X) ; File/Sub-File Name
"RTN","GMTSU",171,0)
 N FI,FR,%X,%Y S FI=$G(X) Q:+X=0 "" N DIERR,GMTSN,GMTSE D FILE^DID(+FI,"N","NAME","GMTSN","GMTSE")
"RTN","GMTSU",172,0)
 S X="" S:'$D(DIERR) X=$$UP^XLFSTR($G(GMTSN("NAME"))) Q:$L(X) X
"RTN","GMTSU",173,0)
 K FR S %X="^DD("_+($G(FI))_",0,""NM"",",%Y="FR(" D %XY^%RCR S X=$$UP^XLFSTR($O(FR(""))) S:+X>0 X="" S:$L(X) X=X_" SUB-FILE" Q X
"RTN","GMTSU",174,0)
FNAM(X) ; File Name
"RTN","GMTSU",175,0)
 S X=$G(X) Q:+X=0 "" N DIERR,GMTSN,GMTSE D FILE^DID(+X,"N","NAME","GMTSN","GMTSE") S X="" S:'$D(DIERR) X=$G(GMTSN("NAME")) Q X
"RTN","GMTSU",176,0)
FLOC(X) ; File location
"RTN","GMTSU",177,0)
 S X=$G(X) Q:+X=0 "" N DIERR,GMTSN,GMTSE D FILE^DID(+X,"N","GLOBAL NAME","GMTSN","GMTSE") S X="" S:'$D(DIERR) X=$G(GMTSN("GLOBAL NAME")) Q X
"RTN","GMTSU",178,0)
FHDD(X) ; File has a DD?
"RTN","GMTSU",179,0)
 S X=+($G(X)) Q:+($G(X))=0 0 S X=$$VFIELD^DILFD(X,.01),X=$S($L(X):1,1:0) Q X
"RTN","GMTSU",180,0)
FLDN(X,Y) ; Field Name
"RTN","GMTSU",181,0)
 Q:+($G(X))=0!(+($G(Y))=0) "" S X=$$GET1^DID(+($G(X)),+($G(Y)),,"LABEL") Q X
"RTN","GMTSU",182,0)
FLDS(X,Y) ; Field Set of Codes
"RTN","GMTSU",183,0)
 Q:+($G(X))=0!(+($G(Y))=0) "" Q:$$GET1^DID(+($G(X)),+($G(Y)),,"TYPE")'="SET" "" S X=$$GET1^DID(+($G(X)),+($G(Y)),,"POINTER") Q X
"RTN","GMTSU",184,0)
FLDI(X,Y) ; Field Input Transform
"RTN","GMTSU",185,0)
 Q:+($G(X))=0!(+($G(Y))=0) "" S X=$$GET1^DID(+($G(X)),+($G(Y)),,"INPUT TRANSFORM") Q X
"RTN","GMTSU2")
0^42^B11984535
"RTN","GMTSU2",1,0)
GMTSU2 ; SLC/KER - Health Summary Utilities ; 08/27/2002
"RTN","GMTSU2",2,0)
 ;;2.7;Health Summary;**29,56**;Oct 20, 1995
"RTN","GMTSU2",3,0)
 ;
"RTN","GMTSU2",4,0)
 ; External References
"RTN","GMTSU2",5,0)
 ;   DBIA 10035  ^DPT(  file #2
"RTN","GMTSU2",6,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSU2",7,0)
 ;   DBIA 10090  ^DIC(4,
"RTN","GMTSU2",8,0)
 ;   DBIA  2056  $$GET1^DIQ  (file #200, 2 and 4)
"RTN","GMTSU2",9,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSU2",10,0)
 ;   DBIA 10112  $$SITE^VASITE
"RTN","GMTSU2",11,0)
 ;   DBIA 10112  $$NAME^VASITE
"RTN","GMTSU2",12,0)
 ;   DBIA  2541  $$KSP^XUPARAM
"RTN","GMTSU2",13,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSU2",14,0)
 ;                    
"RTN","GMTSU2",15,0)
 Q
"RTN","GMTSU2",16,0)
 ; User
"RTN","GMTSU2",17,0)
USER(X) ;   Is a user (1 yes 0 no)     0;1
"RTN","GMTSU2",18,0)
 N GMTS Q:+($G(X))=0 "" S GMTS=$$UNAM(+($G(X))),X=$S($L(GMTS)>0:1,1:0) Q X
"RTN","GMTSU2",19,0)
UACT(X) ;   Active User (1 active)     0;11
"RTN","GMTSU2",20,0)
 N GMTS,GMTSN Q:+($G(X))=0 0 S GMTS=$$USER(+($G(X))) Q:+GMTS=0 0
"RTN","GMTSU2",21,0)
 S GMTS=+($$GET1^DIQ(200,+($G(X)),9.2,"I")) S GMTSN=$$NOW^XLFDT Q:GMTS>0&(GMTS<GMTSN) 0 Q 1
"RTN","GMTSU2",22,0)
UNAM(X) ;   User Name                  0;1
"RTN","GMTSU2",23,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.01)
"RTN","GMTSU2",24,0)
UHPH(X) ;   Home Phone               .13;1
"RTN","GMTSU2",25,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.132)
"RTN","GMTSU2",26,0)
UOPH(X) ;   Office Phone             .13;2
"RTN","GMTSU2",27,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.132)
"RTN","GMTSU2",28,0)
UPH3(X) ;   Phone Number #3          .13;3
"RTN","GMTSU2",29,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.133)
"RTN","GMTSU2",30,0)
UPH4(X) ;   Phone Number #4          .13;4
"RTN","GMTSU2",31,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.134)
"RTN","GMTSU2",32,0)
UCPH(X) ;   Commercial Phone         .13;5
"RTN","GMTSU2",33,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.135)
"RTN","GMTSU2",34,0)
UFAX(X) ;   Fax Number               .13;6
"RTN","GMTSU2",35,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.136)
"RTN","GMTSU2",36,0)
UAPG(X) ;   Analog Pager             .13;7
"RTN","GMTSU2",37,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.137)
"RTN","GMTSU2",38,0)
UDPG(X) ;   Digital Pager            .13;8
"RTN","GMTSU2",39,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.138)
"RTN","GMTSU2",40,0)
 ;                    
"RTN","GMTSU2",41,0)
 ; Patient
"RTN","GMTSU2",42,0)
PAT(X) ;   Is a patient (1 yes 0 no)  0;1
"RTN","GMTSU2",43,0)
 N GMTS Q:+($G(X))=0 "" S GMTS=$$PNAM(+($G(X))),X=$S($L(GMTS)>0:1,1:0) Q X
"RTN","GMTSU2",44,0)
PNAM(X) ;   Patient Name               0;1
"RTN","GMTSU2",45,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(2,+($G(X)),.01)
"RTN","GMTSU2",46,0)
PMAR(X) ;   Patient Marital Status     0;5
"RTN","GMTSU2",47,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(2,+($G(X)),.05)
"RTN","GMTSU2",48,0)
PWAR(X) ;   Patient has a Ward Location
"RTN","GMTSU2",49,0)
 N GMTS Q:+($G(X))=0 "" S GMTS=PWLC(X),X=$S($L(GMTS):1,1:0) Q X
"RTN","GMTSU2",50,0)
PWLC(X) ;   Ward Location
"RTN","GMTSU2",51,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(2,+($G(X)),.1)
"RTN","GMTSU2",52,0)
PDIS(X,ARY) ;   Rated Disabilties       .372;0
"RTN","GMTSU2",53,0)
 Q:+($G(X))=0 "" N GMTSI,GMTSC,GMTSR,GMTSD,GMTSS S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^DPT(+($G(X)),.372,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSU2",54,0)
 . S GMTSR=$$GET1^DIQ(2.04,(GMTSI_","_+($G(X))_","),.01),GMTSD=$$GET1^DIQ(2.04,(GMTSI_","_+($G(X))_","),2),GMTSS=$$GET1^DIQ(2.04,(GMTSI_","_+($G(X))_","),3),GMTSC=GMTSC+1,ARY(GMTSC)=GMTSR_"^"_GMTSD_"^"_GMTSS
"RTN","GMTSU2",55,0)
 S X=+($G(GMTSC)) S:X>0 ARY(0)=X,ARY="Rated Disabilities (VA)^Disability Percent^Service Connected" Q X
"RTN","GMTSU2",56,0)
PLAB(X) ;   Lab Patient               LR;1
"RTN","GMTSU2",57,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(2,+($G(X)),63)
"RTN","GMTSU2",58,0)
 ;                    
"RTN","GMTSU2",59,0)
 ; Health Summary
"RTN","GMTSU2",60,0)
MSIT(X) ; Mix Case Site
"RTN","GMTSU2",61,0)
 Q $$EN^GMTSUMX($$SITE)
"RTN","GMTSU2",62,0)
SITE(X) ; Site
"RTN","GMTSU2",63,0)
 N SITE,INTG,PRIM S U="^",X="" S SITE=$$KSP^XUPARAM("INST"),SITE=$$UP^XLFSTR($$GET1^DIQ(4,+($G(SITE)),.01)),INTG=$$UP^XLFSTR($$NAME^VASITE($$NOW^XLFDT)),PRIM=$$UP^XLFSTR($P($$SITE^VASITE($$NOW^XLFDT),"^",2))
"RTN","GMTSU2",64,0)
 S:$L(SITE)&(PRIM=SITE) PRIM="" S:'$L(SITE)&($L(PRIM)) SITE=PRIM,PRIM="" I $L(SITE) S X=SITE S:$L(INTG)&(INTG'=SITE) X=INTG_" ("_SITE_")"
"RTN","GMTSU2",65,0)
 S:'$L(SITE)&($L(INTG)) X=INTG
"RTN","GMTSU2",66,0)
 Q X
"RTN","GMTSU2",67,0)
TSIT(X) ; Site
"RTN","GMTSU2",68,0)
 N SITE S U="^",X=""
"RTN","GMTSU2",69,0)
 S SITE=$$KSP^XUPARAM("INST"),SITE=$$UP^XLFSTR($$GET1^DIQ(4,+($G(SITE)),.01))
"RTN","GMTSU2",70,0)
 S X=SITE Q X
"RTN","GMTSUIX")
0^43^B17986625
"RTN","GMTSUIX",1,0)
GMTSUIX ; SLC/KER - Health Summary Set/Kill Indexes        ; 08/27/2002
"RTN","GMTSUIX",2,0)
 ;;2.7;Health Summary;**30,32,29,56**;Oct 20, 1995
"RTN","GMTSUIX",3,0)
 ;
"RTN","GMTSUIX",4,0)
 ; External References
"RTN","GMTSUIX",5,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSUIX",6,0)
 ;   DBIA  2056  $$GET1^DIQ  (file #200)
"RTN","GMTSUIX",7,0)
 ;   DBIA 10040  ^SC(  file #44
"RTN","GMTSUIX",8,0)
 ;   DBIA 10013  IX1^DIK
"RTN","GMTSUIX",9,0)
 ;                    
"RTN","GMTSUIX",10,0)
 Q
"RTN","GMTSUIX",11,0)
STNT ; Set word indexes for NAME and TITLE
"RTN","GMTSUIX",12,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD S GMTSTR=$G(X) Q:'$L(GMTSTR)  S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",13,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",14,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",15,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",16,0)
 . . . S @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")=""
"RTN","GMTSUIX",17,0)
 Q
"RTN","GMTSUIX",18,0)
KTNT ; Kill word indexes for NAME and TITLE
"RTN","GMTSUIX",19,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD S GMTSTR=$G(X) Q:'$L(GMTSTR)  S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",20,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",21,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",22,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",23,0)
 . . . K @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")
"RTN","GMTSUIX",24,0)
 Q
"RTN","GMTSUIX",25,0)
 ;                    
"RTN","GMTSUIX",26,0)
STO ; Set word indexes for OWNER
"RTN","GMTSUIX",27,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD
"RTN","GMTSUIX",28,0)
 S GMTSTR=+($G(X)) Q:GMTSTR'>0  Q:GMTSTR>0&(GMTSTR<1)
"RTN","GMTSUIX",29,0)
 S GMTSTR=$$GET1^DIQ(200,(+GMTSTR_","),.01)  Q:'$L(GMTSTR)
"RTN","GMTSUIX",30,0)
 S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",31,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",32,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",33,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",34,0)
 . . . S @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")=""
"RTN","GMTSUIX",35,0)
 Q
"RTN","GMTSUIX",36,0)
KTO ; Kill word indexes for OWNER
"RTN","GMTSUIX",37,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD
"RTN","GMTSUIX",38,0)
 S GMTSTR=+($G(X)) Q:GMTSTR'>0  Q:GMTSTR>0&(GMTSTR<1)
"RTN","GMTSUIX",39,0)
 S GMTSTR=$$GET1^DIQ(200,(+GMTSTR_","),.01)  Q:'$L(GMTSTR)
"RTN","GMTSUIX",40,0)
 S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",41,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",42,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",43,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",44,0)
 . . . K @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")
"RTN","GMTSUIX",45,0)
 Q
"RTN","GMTSUIX",46,0)
 ;                    
"RTN","GMTSUIX",47,0)
STL ; Set word indexes for LOCATION
"RTN","GMTSUIX",48,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD,GMTSIEN1,GMTSIEN2
"RTN","GMTSUIX",49,0)
 S GMTSTR=$P($G(^SC(+($G(X)),0)),U,1) Q:'$L(GMTSTR)  S GMTSIEN1=+($G(DA(1))) Q:+GMTSIEN1=0  S GMTSIEN2=+($G(DA)) Q:+GMTSIEN2=0
"RTN","GMTSUIX",50,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",51,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",52,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",53,0)
 . . .S @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN1_","_GMTSIEN2_")")=""
"RTN","GMTSUIX",54,0)
 Q
"RTN","GMTSUIX",55,0)
KTL ; Kill word indexes for LOCATION
"RTN","GMTSUIX",56,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD,GMTSIEN1,GMTSIEN2
"RTN","GMTSUIX",57,0)
 S GMTSTR=$P($G(^SC(+($G(X)),0)),U,1) Q:'$L(GMTSTR)  S GMTSIEN1=+($G(DA(1))) Q:+GMTSIEN1=0  S GMTSIEN2=+($G(DA)) Q:+GMTSIEN2=0
"RTN","GMTSUIX",58,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",59,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",60,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",61,0)
 . . . K @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN1_","_GMTSIEN2_")")
"RTN","GMTSUIX",62,0)
 Q
"RTN","GMTSUIX",63,0)
 ;                    
"RTN","GMTSUIX",64,0)
RXT ; Re-index Health Summary Type file #142
"RTN","GMTSUIX",65,0)
 W:'$D(GMTSQ) !,"Re-indexing Health Summary Type file #142"
"RTN","GMTSUIX",66,0)
 N DIK,DA,IX S DA=0 F  S DA=$O(^GMT(142,DA)) Q:+DA=0  D
"RTN","GMTSUIX",67,0)
 . S IX="~" F  S IX=$O(^GMT(142,DA,1,IX),-1) Q:+IX>0!(IX="")  I IX="0" K:$E(IX,1)?1U!($E(IX,1)?1L) ^GMT(142,DA,1,IX)
"RTN","GMTSUIX",68,0)
 . S IX="~" F  S IX=$O(^GMT(142,DA,20,IX),-1) Q:+IX>0!(IX="")  I IX="0" K:$E(IX,1)?1U!($E(IX,1)?1L) ^GMT(142,DA,20,IX)
"RTN","GMTSUIX",69,0)
 S IX="~" F  S IX=$O(^GMT(142,IX),-1) Q:+IX>0!(IX="")  I IX'="0" K:$E(IX,1)?1U!($E(IX,1)?1L) ^GMT(142,IX)
"RTN","GMTSUIX",70,0)
 W:'$D(GMTSQ) ! S DA=0 F  S DA=$O(^GMT(142,DA)) Q:+DA=0  S DIK="^GMT(142," D IX1^DIK W:'$D(GMTSQ) "."
"RTN","GMTSUIX",71,0)
 Q
"RTN","GMTSUIX",72,0)
 ;                    
"RTN","GMTSUIX",73,0)
UP(X) ; Uppercase
"RTN","GMTSUIX",74,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSUIX",75,0)
TRIM(X) ; Trim Spaces
"RTN","GMTSUIX",76,0)
 S X=$G(X) Q:X="" X F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSUIX",77,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSUIX",78,0)
 F  Q:X'["  "  S X=$P(X,"  ",1)_" "_$P(X,"  ",2,229)
"RTN","GMTSUIX",79,0)
 Q X
"RTN","GMTSULT2")
0^44^B37575453
"RTN","GMTSULT2",1,0)
GMTSULT2 ; SLC/KER - HS Type Lookup (Search/List)   ; 08/27/2002
"RTN","GMTSULT2",2,0)
 ;;2.7;Health Summary;**30,32,35,29,56**;Oct 20, 1995
"RTN","GMTSULT2",3,0)
 ;
"RTN","GMTSULT2",4,0)
 ; External Reference
"RTN","GMTSULT2",5,0)
 ;   DBIA 10016  ^DIM
"RTN","GMTSULT2",6,0)
 ;                   
"RTN","GMTSULT2",7,0)
 Q
"RTN","GMTSULT2",8,0)
LIST(X) ; Get global array of Health Summary Types
"RTN","GMTSULT2",9,0)
 ;                      
"RTN","GMTSULT2",10,0)
 ;  LIST^GMTSULT2(<search string>)
"RTN","GMTSULT2",11,0)
 ;                      
"RTN","GMTSULT2",12,0)
 ;  ^TMP("GMTSULT",$J,#)
"RTN","GMTSULT2",13,0)
 ;                    
"RTN","GMTSULT2",14,0)
 ;     Piece 1 =  Internal Entry Number (IEN) in file 142
"RTN","GMTSULT2",15,0)
 ;     Piece 2 =  Health Summary Type Name
"RTN","GMTSULT2",16,0)
 ;     Piece 3 =  Health Summary Type Title
"RTN","GMTSULT2",17,0)
 ;     Piece 4 =  Health Summary Type Owner
"RTN","GMTSULT2",18,0)
 ;     Piece 5 =  Location Using Health Summary Type
"RTN","GMTSULT2",19,0)
 ;     Piece 6 =  Number of Components in Summary Type
"RTN","GMTSULT2",20,0)
 ;     Piece 7 =  Recommended Display Text (for 
"RTN","GMTSULT2",21,0)
 ;                selection or list box)
"RTN","GMTSULT2",22,0)
 ;                      
"RTN","GMTSULT2",23,0)
 ;  List Builder can use variable DIC("S") and DIC(0)
"RTN","GMTSULT2",24,0)
 ;                      
"RTN","GMTSULT2",25,0)
 ;     DIC("S") Screen out entries for selection/list
"RTN","GMTSULT2",26,0)
 ;                      
"RTN","GMTSULT2",27,0)
 ;     Processes DIC(0) N, OE (combination),X or B
"RTN","GMTSULT2",28,0)
 ;                      
"RTN","GMTSULT2",29,0)
 ;     Does not process DIC(0) components C or M.  Cross
"RTN","GMTSULT2",30,0)
 ;     reference suppression (C) is automatic in a multi-
"RTN","GMTSULT2",31,0)
 ;     term lookup, and the use of multiple indexes is
"RTN","GMTSULT2",32,0)
 ;     implied in the lookup and DD file structure.
"RTN","GMTSULT2",33,0)
 ;                      
"RTN","GMTSULT2",34,0)
 D CLR^GMTSULT N GMTSEO,GMTSEQ,GMTSIF,GMTSBI,GMTSIEN,GMTSWRDS,GMTSDS,GMTSD0
"RTN","GMTSULT2",35,0)
 S GMTSEO=+($$EMO),GMTSEQ=+($$EMQ),GMTSIF=+($$IF($G(X))),GMTSBI=+($$BI)
"RTN","GMTSULT2",36,0)
 S:$L($G(DIC("S")))&('$L($G(GMTSDICS))) GMTSDICS=$G(DIC("S")),GMTSDS=1
"RTN","GMTSULT2",37,0)
 S:$L($G(DIC(0)))&('$L($G(GMTSDIC0))) GMTSDIC0=$G(DIC(0)),GMTSD0=1
"RTN","GMTSULT2",38,0)
 I GMTSIF S GMTSIEN=$$IENF(X) I +GMTSIEN>0 D IENS(GMTSIEN) G:$D(^TMP("GMTSULT",$J,1)) LQ
"RTN","GMTSULT2",39,0)
 I GMTSBI D B^GMTSULT7 G LQ
"RTN","GMTSULT2",40,0)
 D PAR,FND,REO^GMTSULT3
"RTN","GMTSULT2",41,0)
 Q
"RTN","GMTSULT2",42,0)
LQ ; Quit List
"RTN","GMTSULT2",43,0)
 K:+($G(GMTSDS))>0 GMTSDICS K:+($G(GMTSD0))>0 GMTSDIC0
"RTN","GMTSULT2",44,0)
 Q
"RTN","GMTSULT2",45,0)
 ;                      
"RTN","GMTSULT2",46,0)
FND ; Find Health Summary Types (word search)
"RTN","GMTSULT2",47,0)
 N GMTSB,GMTSC,GMTSCTL,GMTSFND,GMTSI,GMTSI1,GMTSI2,GMTSI3,GMTSDS,GMTSD0,GMTSLEX,GMTSLEXM,GMTSASM,GMTSCMP,GMTSLOC,GMTSNAM,GMTSOK,GMTSRC,GMTSOW,GMTSTMP,GMTSTTL,GMTSWDS,GMTSRD,GMTSWRD,Y
"RTN","GMTSULT2",48,0)
 ;   Echo             E or broker
"RTN","GMTSULT2",49,0)
 S GMTSTMP=+($G(GMTSE)),GMTSIF=0 S:'$D(GMTSE) GMTSTMP=$$ECHO^GMTSULT N GMTSE S GMTSE=GMTSTMP,U="^"
"RTN","GMTSULT2",50,0)
 ;   Exact Match      X
"RTN","GMTSULT2",51,0)
 S GMTSLEX=$$EM(X) D:$G(GMTSDIC0)["X"&(GMTSLEX'>0) CLR^GMTSULT G:$G(GMTSDIC0)["X"&(GMTSLEX'>0) FNDQ
"RTN","GMTSULT2",52,0)
 S:+GMTSLEX>0 ^TMP("GMTSULT2",$J,"EM")=+GMTSLEX,^TMP("GMTSULT2",$J,"IEN",+GMTSLEX)=""
"RTN","GMTSULT2",53,0)
 ;   One Exact Match  OE
"RTN","GMTSULT2",54,0)
 S GMTSLEXM=0 S:$G(GMTSDIC0)["O"&($G(GMTSDIC0)["E") GMTSLEXM=1
"RTN","GMTSULT2",55,0)
 ;   Word Search
"RTN","GMTSULT2",56,0)
 S GMTSWDS=$O(GMTSWRDS(" "),-1) S GMTSWRD=$G(GMTSWRDS(1))
"RTN","GMTSULT2",57,0)
 G:'$L(GMTSWRD) FNDQ S GMTSCTL=GMTSWRD,GMTSWRD=$E(GMTSWRD,1,($L(GMTSWRD)-1))_$C($A($E(GMTSWRD,$L(GMTSWRD)))-1)_"~"
"RTN","GMTSULT2",58,0)
 S:+GMTSCTL=GMTSCTL GMTSWRD=GMTSCTL-1
"RTN","GMTSULT2",59,0)
 F  S GMTSWRD=$O(^GMT(142,"AW",GMTSWRD)) Q:GMTSWRD=""!($E(GMTSWRD,1,$L(GMTSCTL))'=GMTSCTL)  D
"RTN","GMTSULT2",60,0)
 . S (GMTSC,GMTSI1)=0
"RTN","GMTSULT2",61,0)
 . F  S GMTSI1=$O(^GMT(142,"AW",GMTSWRD,GMTSI1)) Q:+GMTSI1=0  D
"RTN","GMTSULT2",62,0)
 . . N GMTSIEN,GMTSKWRD S GMTSIEN=GMTSI1,GMTSKWRD=GMTSWRD
"RTN","GMTSULT2",63,0)
 . . D SM^GMTSULT3
"RTN","GMTSULT2",64,0)
 ;   Check for exact match in results
"RTN","GMTSULT2",65,0)
 S GMTSI=+($G(^TMP("GMTSULT2",$J,"EMI")))
"RTN","GMTSULT2",66,0)
 S GMTSB=$G(^TMP("GMTSULT2",$J,"EMB")) I GMTSI>0,$L(GMTSB)>0 D
"RTN","GMTSULT2",67,0)
 . S ^TMP("GMTSULT2",$J,"E")=$G(^TMP("GMTSULT2",$J,GMTSI))
"RTN","GMTSULT2",68,0)
 . K ^TMP("GMTSULT2",$J,GMTSI),^TMP("GMTSULT2",$J,"B",GMTSB),^TMP("GMTSULT2",$J,"EMB"),^TMP("GMTSULT2",$J,"EMI"),^TMP("GMTSULT2",$J,"EM")
"RTN","GMTSULT2",69,0)
FNDQ ; Find Quit
"RTN","GMTSULT2",70,0)
 K:+($G(GMTSDS))>0 GMTSDICS K:+($G(GMTSD0))>0 GMTSDIC0
"RTN","GMTSULT2",71,0)
 Q
"RTN","GMTSULT2",72,0)
 ;                      
"RTN","GMTSULT2",73,0)
PAR ; Parse User Input
"RTN","GMTSULT2",74,0)
 K GMTSWRDS N GMTSC,GMTSCT,GMTSPSN,GMTSTR,GMTSWRD
"RTN","GMTSULT2",75,0)
 S U="^",GMTSTR=$G(X) Q:'$L(GMTSTR)  S GMTSC=1,GMTSCT=0 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSULT2",76,0)
 . S GMTSWRD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWRD D
"RTN","GMTSULT2",77,0)
 . . S GMTSWRD=$TR($E($E(GMTSTR,GMTSC,GMTSPSN-1),1,30),"""",""),GMTSC=GMTSPSN+1
"RTN","GMTSULT2",78,0)
 . . I $L(GMTSWRD)>0 S GMTSCT=GMTSCT+1,GMTSWRDS(GMTSCT)=$$UP(GMTSWRD)
"RTN","GMTSULT2",79,0)
 Q
"RTN","GMTSULT2",80,0)
IENF(X) ; Internal Entry Number Find
"RTN","GMTSULT2",81,0)
 N GMTS0,GMTSI S GMTSI=$G(X),X=$G(X),GMTS0=$G(DIC(0)) S:$E(X,1)="`" GMTSI=$E(GMTSI,2,$L(GMTSI)) S GMTSI=+GMTSI
"RTN","GMTSULT2",82,0)
 I GMTS0["N",+GMTSI>0,$D(^GMT(142,+GMTSI,0)) S X=+GMTSI Q X
"RTN","GMTSULT2",83,0)
 I $E(X,1)="`",+GMTSI>0,$D(^GMT(142,+GMTSI,0)) S X=+GMTSI Q X
"RTN","GMTSULT2",84,0)
 Q -1
"RTN","GMTSULT2",85,0)
IENS(X) ; Internal Entry Number Save
"RTN","GMTSULT2",86,0)
 N GMTSI1,GMTSI2,GMTSI3,GMTSIEN S (GMTSIEN,GMTSI1)=+X Q:+GMTSI1=0  Q:'$D(^GMT(142,+GMTSI1,0))
"RTN","GMTSULT2",87,0)
 D SM^GMTSULT3,REO^GMTSULT3
"RTN","GMTSULT2",88,0)
 Q
"RTN","GMTSULT2",89,0)
CM(X) ; Get Number of Components
"RTN","GMTSULT2",90,0)
 S X=+($G(X)) Q:X=0 "No components" Q:'$D(^GMT(142,+X,1)) "No components"
"RTN","GMTSULT2",91,0)
 N GMTSI,GMTSC S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,+X,1,GMTSI)) Q:+GMTSI=0  S GMTSC=GMTSC+1
"RTN","GMTSULT2",92,0)
 S X=$S(+GMTSC>1:(+GMTSC_" components"),+GMTSC=1:(+GMTSC_" component"),1:"No components")
"RTN","GMTSULT2",93,0)
 Q X
"RTN","GMTSULT2",94,0)
EM(X) ; Exact Match when DIC(0) contains X
"RTN","GMTSULT2",95,0)
 S X=$G(X) Q:'$L(X) -1 N GMTSC,GMTSI,GMTSM,GMTSN,GMTSO,GMTSU S U="^"
"RTN","GMTSULT2",96,0)
 S GMTSU=$$UP(X),(GMTSC,GMTSO)=$$UP($E(X,1,30)),GMTSM=0,GMTSO=$E(GMTSO,1,($L(GMTSO)-1))_$C($A($E(GMTSO,$L(GMTSO)))-1)_"~",GMTSM=0
"RTN","GMTSULT2",97,0)
 F  S GMTSO=$O(^GMT(142,"AB",GMTSO)) Q:GMTSO=""!(GMTSO'[GMTSC)  D  Q:+GMTSM>0
"RTN","GMTSULT2",98,0)
 . S GMTSI=0 F  S GMTSI=$O(^GMT(142,"AB",GMTSO,GMTSI)) Q:+GMTSI=0  D  Q:+GMTSM>0
"RTN","GMTSULT2",99,0)
 . . S GMTSN=$P($G(^GMT(142,+GMTSI,0)),U,1) S:$$UP(GMTSN)=GMTSU GMTSM=GMTSI_U_GMTSN
"RTN","GMTSULT2",100,0)
 S:+GMTSM=0 GMTSM=-1 S X=GMTSM D Y^GMTSULT6(+GMTSM)
"RTN","GMTSULT2",101,0)
 Q X
"RTN","GMTSULT2",102,0)
 ;                      
"RTN","GMTSULT2",103,0)
DICS(S,X,DA) ; Check DIC("S") Screen
"RTN","GMTSULT2",104,0)
 N Y,GMTST,GMTSOX,GMTSDICS,GMTSIEN S (GMTSIEN,Y,DA)=+($G(DA)),GMTSDICS=$G(S),GMTSOX=$G(X) S X=GMTSDICS Q:'$L(GMTSDICS) 1
"RTN","GMTSULT2",105,0)
 D ^DIM Q:'$L($G(X)) 1 S GMTST=$G(^GMT(142,+GMTSIEN,0)) Q:'$D(^GMT(142,+GMTSIEN,0)) 0 S X=GMTSOX,(Y,DA)=GMTSIEN Q:GMTSIEN'>0 0
"RTN","GMTSULT2",106,0)
 X GMTSDICS S X=$T Q X
"RTN","GMTSULT2",107,0)
 ;                      
"RTN","GMTSULT2",108,0)
 ; Processing flags
"RTN","GMTSULT2",109,0)
EMQ(X) ;   Exact match flag
"RTN","GMTSULT2",110,0)
 N GMTS0 S X=0,GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",111,0)
 S:$G(GMTS0)["X" X=1 Q X
"RTN","GMTSULT2",112,0)
EMO(X) ;   Exact match flag, only one
"RTN","GMTSULT2",113,0)
 N GMTS0 S X=0 S GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",114,0)
 S:$G(GMTS0)["O"&($G(GMTS0)["E") X=1 Q X
"RTN","GMTSULT2",115,0)
BI(X) ;   Use the B Index flag
"RTN","GMTSULT2",116,0)
 N GMTS0 S X=0 S GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",117,0)
 S:$G(GMTS0)["B" X=1 Q X
"RTN","GMTSULT2",118,0)
IF(X) ;   Internal Entry Number Flag
"RTN","GMTSULT2",119,0)
 N GMTS0,GMTSI S GMTSI=0,GMTS0=$G(DIC(0)) Q:'$L($G(X)) 0
"RTN","GMTSULT2",120,0)
 I $E(X,1)="`",$L($G(^GMT(142,+($E(X,2,$L(X))),0))) S GMTSI=1
"RTN","GMTSULT2",121,0)
 I +X>0,$L($G(^GMT(142,+X,0))),GMTS0["N" S GMTSI=1
"RTN","GMTSULT2",122,0)
 S X=GMTSI Q X
"RTN","GMTSULT2",123,0)
 ;                      
"RTN","GMTSULT2",124,0)
 ; TMP Global
"RTN","GMTSULT2",125,0)
TMP ;   Show first ^TMP Global
"RTN","GMTSULT2",126,0)
 N GMTSND,GMTSNC,GMTSNQ,GMTSC,GMTSTMP
"RTN","GMTSULT2",127,0)
 S GMTSC=0,GMTSTMP="",GMTSNQ="^TMP(""GMTSULT2"","_$J_")",GMTSNC="^TMP(""GMTSULT2"","_$J_","
"RTN","GMTSULT2",128,0)
 F  S GMTSNQ=$Q(@GMTSNQ) Q:GMTSNQ=""!(GMTSNQ'[GMTSNC)  D
"RTN","GMTSULT2",129,0)
 . S GMTSC=GMTSC+1 W:GMTSC=1 ! S GMTSND=@GMTSNQ W !,GMTSNQ,"=",GMTSND
"RTN","GMTSULT2",130,0)
 W:GMTSC>0 !
"RTN","GMTSULT2",131,0)
TMP2 ;   Show second ^TMP Global
"RTN","GMTSULT2",132,0)
 S GMTSC=0,GMTSNQ="^TMP(""GMTSULT"","_$J_")",GMTSNC="^TMP(""GMTSULT"","_$J_","
"RTN","GMTSULT2",133,0)
 F  S GMTSNQ=$Q(@GMTSNQ) Q:GMTSNQ=""!(GMTSNQ'[GMTSNC)  D
"RTN","GMTSULT2",134,0)
 . S GMTSC=GMTSC+1 W:'$D(GMTSTMP)&(GMTSC=1) ! S GMTSND=@GMTSNQ W !,GMTSNQ,"=",GMTSND
"RTN","GMTSULT2",135,0)
 W:GMTSC>0 !
"RTN","GMTSULT2",136,0)
 Q
"RTN","GMTSULT2",137,0)
 ; Miscellaneous
"RTN","GMTSULT2",138,0)
UP(X) ;   Uppercase
"RTN","GMTSULT2",139,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSULT2",140,0)
OW(X) ;   Mix Case (owner name)
"RTN","GMTSULT2",141,0)
 Q:$G(X)'["," $$EN^GMTSUMX($G(X))
"RTN","GMTSULT2",142,0)
 Q $$EN^GMTSUMX(($P($G(X),",",1)_", "_$P($G(X),",",2)))
"RTN","GMTSULT2",143,0)
MX(X) ;   Mix Case
"RTN","GMTSULT2",144,0)
 Q $$EN^GMTSUMX(X)
"RTN","GMTSULT3")
0^45^B23011840
"RTN","GMTSULT3",1,0)
GMTSULT3 ; SLC/KER - HS Type Lookup (Save)          ; 08/27/2002
"RTN","GMTSULT3",2,0)
 ;;2.7;Health Summary;**30,32,56**;Oct 20, 1995
"RTN","GMTSULT3",3,0)
 ;
"RTN","GMTSULT3",4,0)
 ; External References
"RTN","GMTSULT3",5,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSULT3",6,0)
 ;   DBIA  2056  $$GET1^DIQ  (file #200)
"RTN","GMTSULT3",7,0)
 ;                     
"RTN","GMTSULT3",8,0)
 Q
"RTN","GMTSULT3",9,0)
SM ; Save match
"RTN","GMTSULT3",10,0)
 ;                      
"RTN","GMTSULT3",11,0)
 ;   GMTSIEN    Type Internal Entry Number
"RTN","GMTSULT3",12,0)
 ;   GMTSKWRD   Keyword from AW index
"RTN","GMTSULT3",13,0)
 ;   GMTSWRDS   Parsed word array
"RTN","GMTSULT3",14,0)
 ;   GMTSEO     Exact Match (One)      OE
"RTN","GMTSULT3",15,0)
 ;   GMTSEQ     Exact Match Required   X
"RTN","GMTSULT3",16,0)
 ;   GMTSIF     Interal Entry Number   N
"RTN","GMTSULT3",17,0)
 ;                      
"RTN","GMTSULT3",18,0)
 S GMTSIEN=+($G(GMTSIEN)),GMTSKWRD=$G(GMTSKWRD),GMTSEO=+($G(GMTSEO)),GMTSEQ=+($G(GMTSEQ)),GMTSIF=+($G(GMTSIF)),U="^"
"RTN","GMTSULT3",19,0)
 N GMTSCOMP,GMTSCF,GMTSWRD,GMTSWDS,GMTSEQ,GMTSLOK,GMTSOK,GMTSLT,GMTSLI,GMTSASM,GMTSI1,GMTSI2,GMTSI3,GMTSNAM,GMTSTTL,GMTSOW,GMTSLOC,GMTSCMP,GMTSRC
"RTN","GMTSULT3",20,0)
 S (GMTSNAM,GMTSTTL,GMTSOW,GMTSLOC,GMTSCMP,GMTSRC)="",GMTSLOK=0,GMTSRC="Name",GMTSWRD=$G(GMTSWRDS(1)),GMTSWDS=+($O(GMTSWRDS(" "),-1))
"RTN","GMTSULT3",21,0)
 ; Get Internal Entry Number (IEN)
"RTN","GMTSULT3",22,0)
 S GMTSI1=+($G(GMTSIEN)) Q:'$D(^GMT(142,GMTSI1,0))
"RTN","GMTSULT3",23,0)
 ; Check Screen - DIC("S")
"RTN","GMTSULT3",24,0)
 S GMTSOK=1 I $L($G(GMTSDICS)) S GMTSOK=$$DICS^GMTSULT2(GMTSDICS,X,GMTSI1) Q:'GMTSOK
"RTN","GMTSULT3",25,0)
 ; Get Health Summary Type
"RTN","GMTSULT3",26,0)
 ;   Components
"RTN","GMTSULT3",27,0)
 S GMTSCMP=$$CM^GMTSULT2(+GMTSI1)
"RTN","GMTSULT3",28,0)
 ;   Name
"RTN","GMTSULT3",29,0)
 S GMTSNAM=$P($G(^GMT(142,+GMTSI1,0)),U,1)
"RTN","GMTSULT3",30,0)
 ;   Title
"RTN","GMTSULT3",31,0)
 S GMTSTTL=$P($G(^GMT(142,+GMTSI1,"T")),U,1)
"RTN","GMTSULT3",32,0)
 S:$L(GMTSTTL) GMTSRC="Title"
"RTN","GMTSULT3",33,0)
 ;   Owner
"RTN","GMTSULT3",34,0)
 S GMTSOW=+($P($G(^GMT(142,+GMTSI1,0)),U,3)) S:GMTSOW<1 GMTSOW=""
"RTN","GMTSULT3",35,0)
 S:+GMTSOW>0 GMTSOW=$$GET1^DIQ(200,(+GMTSOW_","),.01)
"RTN","GMTSULT3",36,0)
 I $L($G(GMTSKWRD)) S:$L(GMTSOW)&(GMTSOW[GMTSKWRD) GMTSRC="Title/Owner"
"RTN","GMTSULT3",37,0)
 ;   Name/Title
"RTN","GMTSULT3",38,0)
 D NT^GMTSULT4
"RTN","GMTSULT3",39,0)
 ;   Location
"RTN","GMTSULT3",40,0)
 D LC^GMTSULT4
"RTN","GMTSULT3",41,0)
 S:'$L($G(GMTSLT("C")))&($L($G(GMTSLI("C")))) GMTSLOC=$G(GMTSLI("C"))
"RTN","GMTSULT3",42,0)
 ; Get Composite String
"RTN","GMTSULT3",43,0)
 D CMA^GMTSULT4
"RTN","GMTSULT3",44,0)
 ; Find words in string
"RTN","GMTSULT3",45,0)
 S (GMTSCF,GMTSFND)=0 I GMTSWDS>0 F GMTSI=1:1:GMTSWDS D
"RTN","GMTSULT3",46,0)
 . Q:'$L(GMTSWRDS(GMTSI))
"RTN","GMTSULT3",47,0)
 . S GMTSCF=+($$CHKW^GMTSULT4(GMTSWRDS(GMTSI)))
"RTN","GMTSULT3",48,0)
 . S:GMTSCF GMTSFND=GMTSFND+1
"RTN","GMTSULT3",49,0)
 . S:$L(GMTSOW)&(GMTSOW[$$UP^GMTSULT2(GMTSWRDS(GMTSI))) GMTSRC="Title/Owner"
"RTN","GMTSULT3",50,0)
 ;
"RTN","GMTSULT3",51,0)
 ; If input is not an Internal Entry Number    +GMTSIF=0
"RTN","GMTSULT3",52,0)
 ; and not all of the words were found          GMTSFND'=GMTSWDS
"RTN","GMTSULT3",53,0)
 ; then quit
"RTN","GMTSULT3",54,0)
 ;
"RTN","GMTSULT3",55,0)
 Q:'(+($G(GMTSIF)))&(GMTSFND'=GMTSWDS)
"RTN","GMTSULT3",56,0)
 ;                      
"RTN","GMTSULT3",57,0)
 ; Save Health Summary Type
"RTN","GMTSULT3",58,0)
 ;   Exact match only        DIC(0)["O" & DIC(0)["E"
"RTN","GMTSULT3",59,0)
 I '(+($G(GMTSIF))),+($G(GMTSEO)),($$UP^GMTSULT2(GMTSNAM)'=$$UP^GMTSULT2(X)&($$UP^GMTSULT2(GMTSLOC)'=$$UP^GMTSULT2(X))) Q
"RTN","GMTSULT3",60,0)
 S:$L(GMTSLOC) GMTSRC="Location"
"RTN","GMTSULT3",61,0)
 ;   Quit if Health Summary is already saved
"RTN","GMTSULT3",62,0)
 Q:$D(^TMP("GMTSULT2",$J,"IEN",+GMTSI1))&(+($G(^TMP("GMTSULT2",$J,"EM")))'=+GMTSI1)
"RTN","GMTSULT3",63,0)
 ;                      
"RTN","GMTSULT3",64,0)
 ;   Assemble string and store in TMP Global
"RTN","GMTSULT3",65,0)
 ;      IEN^Name^Title^Owner^Location^Components^Source
"RTN","GMTSULT3",66,0)
 S GMTSC=+($O(^TMP("GMTSULT2",$J," "),-1))+1
"RTN","GMTSULT3",67,0)
 S GMTSASM=GMTSI1_U_GMTSNAM_U_GMTSTTL_U_GMTSOW_U_GMTSLOC_U_GMTSCMP_U_GMTSRC
"RTN","GMTSULT3",68,0)
 S ^TMP("GMTSULT2",$J,"IEN",+GMTSI1)="",^TMP("GMTSULT2",$J,GMTSC)=GMTSASM,^TMP("GMTSULT2",$J,"B",(GMTSNAM_" "),GMTSC)=""
"RTN","GMTSULT3",69,0)
 S:+($G(^TMP("GMTSULT2",$J,"EM")))=GMTSI1 ^TMP("GMTSULT2",$J,"EMI")=GMTSC,^TMP("GMTSULT2",$J,"EMB")=GMTSNAM_" "
"RTN","GMTSULT3",70,0)
 Q
"RTN","GMTSULT3",71,0)
 ;                      
"RTN","GMTSULT3",72,0)
REO ; Reorder List
"RTN","GMTSULT3",73,0)
 S GMTSEO=+($G(GMTSEO)),GMTSEQ=+($G(GMTSEQ)),GMTSIF=+($G(GMTSIF))
"RTN","GMTSULT3",74,0)
 N GMTSC,GMTSFND,GMTSG,GMTSI,GMTSIEN,GMTSKEY,GMTSL,GMTSCMP,GMTSOW,GMTSTTL,GMTSLOC,GMTSMN,GMTSNM
"RTN","GMTSULT3",75,0)
 S GMTSI=0,GMTSFND=""
"RTN","GMTSULT3",76,0)
 ;   Add exact match to the top of the selection list
"RTN","GMTSULT3",77,0)
 I '$D(^TMP("GMTSULT2",$J,"E")),+($G(GMTSEO)) K ^TMP("GMTSULT2",$J)
"RTN","GMTSULT3",78,0)
 I $D(^TMP("GMTSULT2",$J,"E")) D
"RTN","GMTSULT3",79,0)
 . S GMTSI=0,GMTSC="E" D ADD
"RTN","GMTSULT3",80,0)
 . S ^TMP("GMTSULT",$J,0)=GMTSI
"RTN","GMTSULT3",81,0)
 . K ^TMP("GMTSULT2",$J,"E")
"RTN","GMTSULT3",82,0)
 . ;   Kill global (quit) if Exact Match is found
"RTN","GMTSULT3",83,0)
 . ;     and DIR(0) either contains OE or X
"RTN","GMTSULT3",84,0)
 . K:+($G(GMTSEQ)) ^TMP("GMTSULT2",$J) K:+($G(GMTSEO)) ^TMP("GMTSULT2",$J)
"RTN","GMTSULT3",85,0)
 ;   Kill global (quit) if Exact Match is not
"RTN","GMTSULT3",86,0)
 ;     found and DIR(0)["OE"
"RTN","GMTSULT3",87,0)
 I '$D(^TMP("GMTSULT2",$J,"E")),+($G(GMTSEO)) K ^TMP("GMTSULT2",$J)
"RTN","GMTSULT3",88,0)
 ;   Add remaining entries in Alphabetical Order
"RTN","GMTSULT3",89,0)
 F  S GMTSFND=$O(^TMP("GMTSULT2",$J,"B",GMTSFND)) Q:GMTSFND=""  D
"RTN","GMTSULT3",90,0)
 . S GMTSC=0 F  S GMTSC=$O(^TMP("GMTSULT2",$J,"B",GMTSFND,GMTSC)) Q:+GMTSC=0  D
"RTN","GMTSULT3",91,0)
 . . D ADD
"RTN","GMTSULT3",92,0)
 D CLEAN^GMTSULT
"RTN","GMTSULT3",93,0)
 Q
"RTN","GMTSULT3",94,0)
 ;                      
"RTN","GMTSULT3",95,0)
ADD ; Add to list in appropriate order
"RTN","GMTSULT3",96,0)
 N GMTS0,GMTS1,GMTS2,GMTS3,GMTS4,GMTS5,GMTS6,GMTS7
"RTN","GMTSULT3",97,0)
 S GMTSI=+($G(GMTSI))+1,GMTS0=$G(^TMP("GMTSULT2",$J,GMTSC))
"RTN","GMTSULT3",98,0)
 ;                      
"RTN","GMTSULT3",99,0)
 ;   Piece    Data Element
"RTN","GMTSULT3",100,0)
 ;                      
"RTN","GMTSULT3",101,0)
 ;     1      Internal Entry Number
"RTN","GMTSULT3",102,0)
 S (GMTS1,GMTSIEN)=+($P(GMTS0,U,1))
"RTN","GMTSULT3",103,0)
 ;     2      Health Summary Name
"RTN","GMTSULT3",104,0)
 S (GMTSG,GMTSMN,GMTS2)=$$MX^GMTSULT2($P(GMTS0,U,2))
"RTN","GMTSULT3",105,0)
 S GMTSNM=$$UP^GMTSULT2(GMTSMN)
"RTN","GMTSULT3",106,0)
 ;     3      Health Summary Title
"RTN","GMTSULT3",107,0)
 S (GMTS3,GMTSTTL)=$$MX^GMTSULT2($P(GMTS0,U,3)),GMTSTTL=GMTSTTL_")"
"RTN","GMTSULT3",108,0)
 ;     4      Health Summary Owner
"RTN","GMTSULT3",109,0)
 S (GMTS4,GMTSOW)=$$MX^GMTSULT2($P(GMTS0,U,4)),GMTSOW=GMTSOW_")"
"RTN","GMTSULT3",110,0)
 ;     5      Health Summary Location
"RTN","GMTSULT3",111,0)
 S (GMTS5,GMTSLOC)=$$MX^GMTSULT2($P(GMTS0,U,5)),GMTSLOC=GMTSLOC_")"
"RTN","GMTSULT3",112,0)
 ;     6      Health Summary Components
"RTN","GMTSULT3",113,0)
 S (GMTS6,GMTSCMP)=$P(GMTS0,U,6)
"RTN","GMTSULT3",114,0)
 S GMTSL=$P(GMTS0,U,4)
"RTN","GMTSULT3",115,0)
 ;     7      Recommended Display Text
"RTN","GMTSULT3",116,0)
 S GMTSKEY=$$UP^GMTSULT2($P(GMTS0,U,7))
"RTN","GMTSULT3",117,0)
 ;                      
"RTN","GMTSULT3",118,0)
 ;   Recommended Display Text
"RTN","GMTSULT3",119,0)
 D RDT^GMTSULT4
"RTN","GMTSULT3",120,0)
 ;                      
"RTN","GMTSULT3",121,0)
 ;   Assemble string and store in TMP Global
"RTN","GMTSULT3",122,0)
 ;      IEN^Name^Title^Owner^Location^Components^Display Text
"RTN","GMTSULT3",123,0)
 S:$L(GMTSG)&(GMTSG'[")")&(GMTSG'["(")&(+GMTS6=0)&($L(GMTS6)) GMTSG=GMTSG_" ("_GMTS6_")" S GMTS7=GMTSG
"RTN","GMTSULT3",124,0)
 S ^TMP("GMTSULT",$J,GMTSI)=GMTS1_U_GMTS2_U_GMTS3_U_GMTS4_U_GMTS5_U_GMTS6_U_GMTS7
"RTN","GMTSULT3",125,0)
 S ^TMP("GMTSULT",$J,0)=GMTSI
"RTN","GMTSULT3",126,0)
 Q
"RTN","GMTSULT4")
0^46^B33394695
"RTN","GMTSULT4",1,0)
GMTSULT4 ; SLC/KER - HS Type Lookup (Array)         ; 08/27/2002
"RTN","GMTSULT4",2,0)
 ;;2.7;Health Summary;**30,32,56**;Oct 20, 1995
"RTN","GMTSULT4",3,0)
 ;
"RTN","GMTSULT4",4,0)
 ; External References
"RTN","GMTSULT4",5,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSULT4",6,0)
 ;   DBIA  2056  $$GET1^DIQ  (file #200)
"RTN","GMTSULT4",7,0)
 ;   DBIA 10040  ^SC(  file #44
"RTN","GMTSULT4",8,0)
 ;                   
"RTN","GMTSULT4",9,0)
 Q
"RTN","GMTSULT4",10,0)
NT ; In Name/Title Array
"RTN","GMTSULT4",11,0)
 Q:$D(GMTSINPT)  Q:+GMTSWDS'>0  K GMTSLT D CMN
"RTN","GMTSULT4",12,0)
 S GMTSFND=0,GMTSLT("W")=+($G(GMTSWDS))
"RTN","GMTSULT4",13,0)
 N GMTSNT F GMTSI=1:1:GMTSWDS D
"RTN","GMTSULT4",14,0)
 . Q:'$L(GMTSWRDS(GMTSI))
"RTN","GMTSULT4",15,0)
 . S GMTSNT=+($$CHKW(GMTSWRDS(GMTSI)))
"RTN","GMTSULT4",16,0)
 . S:GMTSNT GMTSFND=GMTSFND+1,GMTSLT(GMTSI1)=(+($G(GMTSLT(GMTSI1)))+1)
"RTN","GMTSULT4",17,0)
 I GMTSFND>0,GMTSFND=GMTSWDS,'$D(GMTSLT(GMTSI1)) S GMTSLT(0)=+($G(GMTSLT(0)))+1
"RTN","GMTSULT4",18,0)
 ; Reorder
"RTN","GMTSULT4",19,0)
 S GMTSFND=0 F  S GMTSFND=$O(GMTSLT(GMTSFND)) Q:+GMTSFND=0  D
"RTN","GMTSULT4",20,0)
 . S:+($G(GMTSLT(GMTSFND)))>0&(+($G(GMTSLT(GMTSFND)))=+($G(GMTSLT("W")))) GMTSLT("B",+GMTSFND)=""
"RTN","GMTSULT4",21,0)
 . K:+($G(GMTSLT(GMTSFND)))>0&(+($G(GMTSLT(GMTSFND)))'=+($G(GMTSLT("W")))) GMTSLT(+GMTSFND)
"RTN","GMTSULT4",22,0)
 K GMTSLT("W") K:'$D(GMTSLT("B")) GMTSLT
"RTN","GMTSULT4",23,0)
 S:$D(GMTSLT("B")) GMTSLT("C")=$$MX($P($G(^GMT(142,+($G(GMTSIEN)),0)),"^",1))
"RTN","GMTSULT4",24,0)
 Q
"RTN","GMTSULT4",25,0)
LC ; Location Array  (Needs either GMTSIEN or GMTSI1)
"RTN","GMTSULT4",26,0)
 Q:$D(GMTSINPT)  Q:+GMTSWDS'>0
"RTN","GMTSULT4",27,0)
 I '$D(GMTSI1),$D(GMTSIEN),$D(^GMT(142,+($G(GMTSIEN)),0)) N GMTSI1 S GMTSI1=+($G(GMTSIEN))
"RTN","GMTSULT4",28,0)
 Q:'$D(GMTSI1)
"RTN","GMTSULT4",29,0)
 N GMTSF,GMTSI,GMTSI2,GMTSI3,GMTSL,GMTSLC K GMTSLI
"RTN","GMTSULT4",30,0)
 S GMTSI2=0  F  S GMTSI2=$O(^GMT(142,GMTSI1,20,GMTSI2)) Q:+GMTSI2=0  D
"RTN","GMTSULT4",31,0)
 . S GMTSI3=+($G(^GMT(142,GMTSI1,20,GMTSI2,0)))
"RTN","GMTSULT4",32,0)
 . S GMTSL=$P($G(^SC(+GMTSI3,0)),"^",1)
"RTN","GMTSULT4",33,0)
 . S GMTSF=0 I GMTSWDS>0 S GMTSLI("W")=+($G(GMTSWDS))
"RTN","GMTSULT4",34,0)
 . F GMTSI=1:1:GMTSWDS D
"RTN","GMTSULT4",35,0)
 . . Q:'$L(GMTSWRDS(GMTSI))
"RTN","GMTSULT4",36,0)
 . . S:$$UP(GMTSL)[$$UP(GMTSWRDS(GMTSI)) GMTSF=GMTSF+1
"RTN","GMTSULT4",37,0)
 . I GMTSF=GMTSWDS D
"RTN","GMTSULT4",38,0)
 . . S:'$D(GMTSLI(GMTSI1,GMTSI2)) GMTSLI(0)=+($G(GMTSLI(0)))+1
"RTN","GMTSULT4",39,0)
 . . S GMTSLI(GMTSI2)=GMTSF_"^"_GMTSL
"RTN","GMTSULT4",40,0)
 . . S GMTSLI("I")=GMTSI1
"RTN","GMTSULT4",41,0)
 S GMTSF=0 F  S GMTSF=$O(GMTSLI(GMTSF)) Q:+GMTSF=0  D
"RTN","GMTSULT4",42,0)
 . S:+($G(GMTSLI(GMTSF)))>0&(+($G(GMTSLI(GMTSF)))=+($G(GMTSLI("W")))) GMTSLI("B",+GMTSF)=""
"RTN","GMTSULT4",43,0)
 . K:+($G(GMTSLI(GMTSF)))>0&(+($G(GMTSLI(GMTSF)))'=+($G(GMTSLI("W")))) GMTSLI(+GMTSF)
"RTN","GMTSULT4",44,0)
 K:'$D(GMTSLI("B")) GMTSLI
"RTN","GMTSULT4",45,0)
 I $D(GMTSLI("B"))  D
"RTN","GMTSULT4",46,0)
 . N GMTSI,GMTSC,GMTST,GMTSE S (GMTSE,GMTSC)=0,GMTST=+($G(GMTSLI(0))) Q:GMTST=0
"RTN","GMTSULT4",47,0)
 . S GMTSI="",GMTSF=0 F  S GMTSF=$O(GMTSLI(GMTSF)) Q:GMTSE  Q:+GMTSF=0  D  Q:GMTSE
"RTN","GMTSULT4",48,0)
 . . I ($L($G(GMTSI))+$L($P($G(GMTSLI(GMTSF)),"^",2)))>60 S GMTSI="",GMTSE=1 Q
"RTN","GMTSULT4",49,0)
 . . S GMTSC=GMTSC+1
"RTN","GMTSULT4",50,0)
 . . S:GMTSI'=""&(GMTSC>1)&(GMTSC'=GMTST) GMTSI=GMTSI_", "_$$MX($P(GMTSLI(GMTSF),"^",2))
"RTN","GMTSULT4",51,0)
 . . S:GMTSI'=""&(GMTSC>1)&(GMTSC=GMTST) GMTSI=GMTSI_" and "_$$MX($P(GMTSLI(GMTSF),"^",2))
"RTN","GMTSULT4",52,0)
 . . S:GMTSI="" GMTSI=$$MX($P(GMTSLI(GMTSF),"^",2))
"RTN","GMTSULT4",53,0)
 . S:$L(GMTSI) GMTSLI("C")=GMTSI
"RTN","GMTSULT4",54,0)
 K:'$D(GMTSLI("C")) GMTSLI K GMTSLI("W")
"RTN","GMTSULT4",55,0)
 Q
"RTN","GMTSULT4",56,0)
CHKW(X) ; Check Words
"RTN","GMTSULT4",57,0)
 S X=$$UP($G(X)) Q:'$L(X) 0
"RTN","GMTSULT4",58,0)
 N I,OK S OK=0,I=0 F  S I=$O(GMTSCOMP(I)) Q:+I=0  S:$$UP($G(GMTSCOMP(I)))[X OK=1 Q:OK
"RTN","GMTSULT4",59,0)
 S X=+($G(OK)) Q X
"RTN","GMTSULT4",60,0)
 ;                             
"RTN","GMTSULT4",61,0)
CM ; Composite Array 
"RTN","GMTSULT4",62,0)
 K GMTSCOMP S GMTSIEN=+($G(GMTSIEN)) G:GMTSIEN=0 CMQ
"RTN","GMTSULT4",63,0)
 N GMTSWL,GMTSL,GMTS2
"RTN","GMTSULT4",64,0)
 D:$D(GMTSNAM) CMP($$UP($$UP(GMTSNAM))) D:'$D(GMTSNAM) CMP($$UP($P($G(^GMT(142,+GMTSIEN,0)),"^",1)))
"RTN","GMTSULT4",65,0)
 D:$D(GMTSTTL) CMP($$UP($G(GMTSTTL))) D:'$D(GMTSTTL) CMP($$UP($P($G(^GMT(142,+GMTSIEN,"T")),"^",1)))
"RTN","GMTSULT4",66,0)
 D:$D(GMTSOW) CMP($$UP($G(GMTSOW)))
"RTN","GMTSULT4",67,0)
 I '$D(GMTSOW),+($P($G(^GMT(142,+GMTSIEN,0)),"^",3))>1 D CMP($$UP($$GET1^DIQ(200,(+($P($G(^GMT(142,+GMTSIEN,0)),"^",3))_","),.01)))
"RTN","GMTSULT4",68,0)
 G:$D(GMTSNO) CMQ
"RTN","GMTSULT4",69,0)
 S GMTS2=0  F  S GMTS2=$O(^GMT(142,GMTSIEN,20,GMTS2)) Q:+GMTS2=0  D
"RTN","GMTSULT4",70,0)
 . S GMTSL=+($G(^GMT(142,GMTSIEN,20,GMTS2,0)))
"RTN","GMTSULT4",71,0)
 . S GMTSL=$P($G(^SC(+GMTSL,0)),"^",1) D CMP($$UP(GMTSL))
"RTN","GMTSULT4",72,0)
CMQ ;   Composite Array Quit
"RTN","GMTSULT4",73,0)
 D CMC Q
"RTN","GMTSULT4",74,0)
CMA ;   Composite Array (name only)
"RTN","GMTSULT4",75,0)
 N GMTSNO D CM Q
"RTN","GMTSULT4",76,0)
CMN ;   Composite Array (name only)
"RTN","GMTSULT4",77,0)
 N GMTSNO S GMTSNO="" D CM Q
"RTN","GMTSULT4",78,0)
CMP(X) ;   Composite Array Word Parse
"RTN","GMTSULT4",79,0)
 N GMTSX,GMTSP,GMTSC,GMTSW S GMTSX=$G(X) Q:'$L(GMTSX)
"RTN","GMTSULT4",80,0)
 S GMTSC=1 F GMTSP=1:1:$L(GMTSX)+1 D
"RTN","GMTSULT4",81,0)
 . S GMTSW=$E(GMTSX,GMTSP) I "(,.?! '-/&:;)"[GMTSW D
"RTN","GMTSULT4",82,0)
 . . S GMTSW=$E($E(GMTSX,GMTSC,GMTSP-1),1,30),GMTSC=GMTSP+1 I $L(GMTSW)>0 D
"RTN","GMTSULT4",83,0)
 . . . S:$L(GMTSW) GMTSWL(GMTSW)=""
"RTN","GMTSULT4",84,0)
 Q
"RTN","GMTSULT4",85,0)
CMC ;   Composite Array Compile
"RTN","GMTSULT4",86,0)
 S GMTSCOMP("B")="" N GMTSW,GMTSLI S GMTSW=""
"RTN","GMTSULT4",87,0)
 F  S GMTSW=$O(GMTSWL(GMTSW)) Q:GMTSW=""  D
"RTN","GMTSULT4",88,0)
 . I $L(GMTSCOMP("B")_" "_GMTSW)>200 D CMCA S GMTSCOMP("B")=GMTSCOMP("B")_" "_$$UP(GMTSW) K GMTSWL(GMTSW) Q
"RTN","GMTSULT4",89,0)
 . S GMTSCOMP("B")=GMTSCOMP("B")_" "_$$UP(GMTSW) K GMTSWL(GMTSW) Q
"RTN","GMTSULT4",90,0)
 F  Q:$E(GMTSCOMP("B"),1)'=" "  S GMTSCOMP("B")=$E(GMTSCOMP("B"),2,$L(GMTSCOMP("B")))
"RTN","GMTSULT4",91,0)
 S GMTSLI=+($O(GMTSCOMP(" "),-1)) I $D(GMTSCOMP("B")) S GMTSCOMP((GMTSLI+1))=GMTSCOMP("B") K GMTSCOMP("B")
"RTN","GMTSULT4",92,0)
 Q
"RTN","GMTSULT4",93,0)
CMCA ;   Composite Array Compile (Add String)
"RTN","GMTSULT4",94,0)
 N I S I=+($O(GMTSCOMP(" "),-1))+1 S GMTSCOMP(I)=GMTSCOMP("B"),GMTSCOMP("B")=""
"RTN","GMTSULT4",95,0)
 F  Q:$E(GMTSCOMP(I),1)'=" "  S GMTSCOMP(I)=$E(GMTSCOMP(I),2,$L(GMTSCOMP(I)))
"RTN","GMTSULT4",96,0)
 Q
"RTN","GMTSULT4",97,0)
 ;                                   
"RTN","GMTSULT4",98,0)
RDT ;   Recommended Display Text
"RTN","GMTSULT4",99,0)
 ;     Name (used by Location)
"RTN","GMTSULT4",100,0)
 I GMTSKEY["LOC" D
"RTN","GMTSULT4",101,0)
 . Q:'$L(GMTS5)
"RTN","GMTSULT4",102,0)
 . S:$$UP(GMTS2)'=$$UP(GMTS5) GMTSG=GMTSMN_" (used by "_GMTSLOC
"RTN","GMTSULT4",103,0)
 . S:$$UP(GMTSMN)=$$UP(GMTSLOC) GMTSG=GMTSMN
"RTN","GMTSULT4",104,0)
 ;     Name (Title)
"RTN","GMTSULT4",105,0)
 I GMTSKEY["TITL",GMTSKEY'["OWN" D
"RTN","GMTSULT4",106,0)
 . Q:'$L(GMTS3)
"RTN","GMTSULT4",107,0)
 . I $$UP(GMTS3)=$$UP(GMTS2) S GMTSG=GMTS2 Q
"RTN","GMTSULT4",108,0)
 . S:GMTSKEY["TITL"&($$UP(GMTSMN)'=$$UP(GMTSL)) GMTSG=GMTSMN_" ("_$$MX(GMTS3)_")"
"RTN","GMTSULT4",109,0)
 . S:GMTSKEY["TITL"&($$UP(GMTSMN)=$$UP(GMTSL)) GMTSG=GMTSMN
"RTN","GMTSULT4",110,0)
 I GMTSKEY["TITL",GMTSKEY["OWN" D
"RTN","GMTSULT4",111,0)
 . Q:'$L(GMTS3)
"RTN","GMTSULT4",112,0)
 . ;     Name (Title, Owner) if Title'=Name and Owner
"RTN","GMTSULT4",113,0)
 . S:$$UP(GMTSMN)'=$$UP(GMTS3)&($L(GMTS4)) GMTSG=GMTSMN_" ("_$$MX(GMTS3)_", HS Owner "_$$OW(GMTSOW)
"RTN","GMTSULT4",114,0)
 . ;     Name (Title) if Title'=Name and no Owner
"RTN","GMTSULT4",115,0)
 . S:$$UP(GMTSMN)'=$$UP(GMTS3)&('$L(GMTS4)) GMTSG=GMTSMN_" ("_$$MX(GMTSTTL)
"RTN","GMTSULT4",116,0)
 . ;     Name (Owner) if Title=Name and Owner
"RTN","GMTSULT4",117,0)
 . S:$$UP(GMTSMN)=$$UP(GMTS3)&($L(GMTS4)) GMTSG=GMTSMN_" (HS Owner "_$$OW(GMTSOW)
"RTN","GMTSULT4",118,0)
 . S:$$UP(GMTSMN)=$$UP(GMTS3)&('$L(GMTS4)) GMTSG=GMTSMN
"RTN","GMTSULT4",119,0)
 ;                      
"RTN","GMTSULT4",120,0)
 ;   Assemble string and store in TMP Global
"RTN","GMTSULT4",121,0)
 ;      IEN^Name^Title^Owner^Location^Components^Display Text
"RTN","GMTSULT4",122,0)
 S:$L(GMTSG)&(GMTSG'[")")&(GMTSG'["(")&(+GMTS6=0)&($L(GMTS6)) GMTSG=GMTSG_" ("_GMTS6_")" S GMTS7=GMTSG
"RTN","GMTSULT4",123,0)
 S ^TMP("GMTSULT",$J,GMTSI)=GMTS1_U_GMTS2_U_GMTS3_U_GMTS4_U_GMTS5_U_GMTS6_U_GMTS7
"RTN","GMTSULT4",124,0)
 S ^TMP("GMTSULT",$J,0)=GMTSI
"RTN","GMTSULT4",125,0)
 Q
"RTN","GMTSULT4",126,0)
 ;                      
"RTN","GMTSULT4",127,0)
 ; Miscellaneous
"RTN","GMTSULT4",128,0)
UP(X) ;   Uppercase
"RTN","GMTSULT4",129,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSULT4",130,0)
OW(X) ;   Mix Case (owner name)
"RTN","GMTSULT4",131,0)
 Q:$G(X)'["," $$EN^GMTSUMX($G(X))
"RTN","GMTSULT4",132,0)
 Q $$EN^GMTSUMX(($P($G(X),",",1)_", "_$P($G(X),",",2)))
"RTN","GMTSULT4",133,0)
MX(X) ;   Mix Case
"RTN","GMTSULT4",134,0)
 Q $$EN^GMTSUMX(X)
"RTN","GMTSULT5")
0^47^B18612972
"RTN","GMTSULT5",1,0)
GMTSULT5 ; SLC/KER - HS Type Lookup (User Input)  ; 08/27/2002
"RTN","GMTSULT5",2,0)
 ;;2.7;Health Summary;**30,35,56**;Oct 20, 1995
"RTN","GMTSULT5",3,0)
 ;
"RTN","GMTSULT5",4,0)
 ; External References
"RTN","GMTSULT5",5,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSULT5",6,0)
 ;   DBIA 10006  ^DIC  (file #142)
"RTN","GMTSULT5",7,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSULT5",8,0)
 ;   DBIA  2056  $$GET1^DIQ  (file #200)
"RTN","GMTSULT5",9,0)
 ;                      
"RTN","GMTSULT5",10,0)
 Q
"RTN","GMTSULT5",11,0)
INPUT(X) ; Get User's Input
"RTN","GMTSULT5",12,0)
 N Y,GMTSDISV,GMTSB,GMTSD,DIR S GMTSDISV=0 D GDISV
"RTN","GMTSULT5",13,0)
 S DIR(0)="FAO^1:30^N GMTS S X=$$DEF^GMTSULT5(X),GMTS=$$INPT^GMTSULT5(X) K:'GMTS X"
"RTN","GMTSULT5",14,0)
 S DIR("?")="^D IN1^GMTSULT5",DIR("??")="^D IN2^GMTSULT5"
"RTN","GMTSULT5",15,0)
 S:'$L($G(GMTSDICA)) DIR("A")="Select HEALTH SUMMARY TYPE:  " S:$L($G(GMTSDICA)) DIR("A")=GMTSDICA
"RTN","GMTSULT5",16,0)
 S GMTSD=0 S:$L($G(GMTSDICB)) DIR("A")=DIR("A")_$G(GMTSDICB)_"//  "
"RTN","GMTSULT5",17,0)
 I $L($G(DIR("B"))) W !,DIR("A") S X=DIR("B") Q X
"RTN","GMTSULT5",18,0)
 D ^DIR K:X=""&($L($G(GMTSDICB)))&('$D(DTOUT)) DIRUT
"RTN","GMTSULT5",19,0)
 S:X=""&($L($G(GMTSDICB))) (X,Y)=GMTSDICB,GMTSDEF=1 Q:$D(DTOUT)!($D(DUOUT)) X
"RTN","GMTSULT5",20,0)
 S:X=" "&($L(Y))&($G(GMTSDIC0)'["F")&(GMTSDISV>0)&($L($P($G(^GMT(142,+GMTSDISV,0)),"^",1))) X="`"_GMTSDISV
"RTN","GMTSULT5",21,0)
 Q X
"RTN","GMTSULT5",22,0)
 ;                        
"RTN","GMTSULT5",23,0)
 ; Help
"RTN","GMTSULT5",24,0)
IN1 ;   Single Question Mark Help ? for User Input
"RTN","GMTSULT5",25,0)
 N %,%A,%B,%B1,%B2,%B3,%BA,%C,%E,%G,%H,%I,%J,%N,%P,%S,%T,%W,%X,%Y,%BU,%J1,%A0,%W0,%D1,%D2,%DT,%K,%M
"RTN","GMTSULT5",26,0)
 I X=" "&($G(GMTSDIC0)'["F") D  Q
"RTN","GMTSULT5",27,0)
 . D GDISV
"RTN","GMTSULT5",28,0)
 . S:+($G(GMTSDISV))>0 X=$P($G(^GMT(142,+($G(GMTSDISV)),0)),U,1),(Y,GMTSD)=+GMTSDISV
"RTN","GMTSULT5",29,0)
 D GHT Q
"RTN","GMTSULT5",30,0)
IN2 ;   Double Question Mark Help ? with listing
"RTN","GMTSULT5",31,0)
 N %,%A,%B,%B1,%B2,%B3,%BA,%C,%E,%G,%H,%I,%J,%N,%P,%S,%T,%W,%X,%Y,%BU,%J1,%A0,%W0,%D1,%D2,%DT,%K,%M
"RTN","GMTSULT5",32,0)
 W !!,"Choose from:"
"RTN","GMTSULT5",33,0)
 N GMTSHS,GMTSC,GMTSCT,GMTSIEN,GMTSOK,GMTSTR,GMTSTL,GMTST,GMTSPL,GMTSTT,GMTSRR
"RTN","GMTSULT5",34,0)
 S (GMTSC,GMTST)=0,GMTSCT=1,GMTSHS="",GMTSPL=+($G(IOSL))-8 S:GMTSPL'>0 GMTSPL=18
"RTN","GMTSULT5",35,0)
 S GMTSTT=0,GMTSHS="" F  S GMTSHS=$O(^GMT(142,"B",GMTSHS)) Q:GMTSHS=""  S GMTSIEN=0 F  S GMTSIEN=$O(^GMT(142,"B",GMTSHS,GMTSIEN)) Q:+GMTSIEN=0  S GMTSTT=GMTSTT+1
"RTN","GMTSULT5",36,0)
 S GMTSRR=GMTSTT F  S GMTSHS=$O(^GMT(142,"B",GMTSHS)) Q:GMTSHS=""!('GMTSCT)  Q:GMTST>0  D  Q:'GMTSCT  Q:GMTST>0
"RTN","GMTSULT5",37,0)
 . S GMTSIEN=0 F  S GMTSIEN=$O(^GMT(142,"B",GMTSHS,GMTSIEN)) Q:+GMTSIEN=0!('GMTSCT)  Q:GMTST>0  D  Q:'GMTSCT  Q:+GMTST>0
"RTN","GMTSULT5",38,0)
 . . S GMTSTL="",GMTSOK=1,GMTSTR=$P($G(^GMT(142,GMTSIEN,0)),U,1) Q:'$L(GMTSTR)
"RTN","GMTSULT5",39,0)
 . . S GMTSOK=1 I $L($G(GMTSDICS)) S GMTSOK=$$DICS^GMTSULT2(GMTSDICS,X,GMTSIEN) Q:'GMTSOK
"RTN","GMTSULT5",40,0)
 . . F  Q:$L(GMTSTR)>33  S GMTSTR=GMTSTR_" "
"RTN","GMTSULT5",41,0)
 . . S GMTSTL=$P($G(^GMT(142,GMTSIEN,"T")),U,1)
"RTN","GMTSULT5",42,0)
 . . S:$L(GMTSTL) GMTSTR=GMTSTR_GMTSTL
"RTN","GMTSULT5",43,0)
 . . S GMTSC=GMTSC+1,GMTSRR=GMTSRR-1 W !,?3,GMTSTR I +GMTSC>GMTSPL D IN2C S GMTSC=0
"RTN","GMTSULT5",44,0)
 W ! D:GMTST'>1 GHT Q
"RTN","GMTSULT5",45,0)
IN2C ;   Ask to Continue Listing
"RTN","GMTSULT5",46,0)
 N X W !,?3,"""^"" TO STOP:" R X:300
"RTN","GMTSULT5",47,0)
 S:'$T!(X["^") GMTSC=0 S:X["^" GMTST=1
"RTN","GMTSULT5",48,0)
 S:X["^^" GMTST=2 Q
"RTN","GMTSULT5",49,0)
GHT ;   General Help Text
"RTN","GMTSULT5",50,0)
 W !,?5,"Answer with Health Summary Type name, title, owner or hospital"
"RTN","GMTSULT5",51,0)
 W !,?5,"location using the summary.  Your response must be at least 2"
"RTN","GMTSULT5",52,0)
 W !,?5,"characters and no more than 30 characters and must not contain"
"RTN","GMTSULT5",53,0)
 W !,?5,"an embedded uparrow" Q
"RTN","GMTSULT5",54,0)
 ;                        
"RTN","GMTSULT5",55,0)
 ; Defaults values
"RTN","GMTSULT5",56,0)
DEF(X) ;   Default
"RTN","GMTSULT5",57,0)
 S X=$G(X)
"RTN","GMTSULT5",58,0)
 I +X>0,$D(^GMT(142,+X,0)),($G(GMTSDIC0)["N"!($G(GMTSDIC0)["N")) D  Q X
"RTN","GMTSULT5",59,0)
 . S (Y,GMTSD)=+X,X=$P($G(^GMT(142,+Y,0)),U,1)
"RTN","GMTSULT5",60,0)
 I $E(X,1)="`",+($E(X,2,$L(X)))>0,$D(^GMT(142,+($E(X,2,$L(X))),0)) D  Q X
"RTN","GMTSULT5",61,0)
 . S (Y,GMTSD)=+($E(X,2,$L(X))),X=$P($G(^GMT(142,+Y,0)),U,1)
"RTN","GMTSULT5",62,0)
 I X=" "&($G(GMTSDIC0)'["F") D
"RTN","GMTSULT5",63,0)
 . D GDISV S:+($G(GMTSDISV))>0 X=$P($G(^GMT(142,+($G(GMTSDISV)),0)),U,1),(Y,GMTSD)=+GMTSDISV
"RTN","GMTSULT5",64,0)
 Q X
"RTN","GMTSULT5",65,0)
GDISV ;   Get Default Value (Spacebar-Return)
"RTN","GMTSULT5",66,0)
 N DIC,Y,X,DLAYGO,DINUM,DTOUT,DUOUT,%,%A,%B,%B1,%B2,%B3,%BA,%C,%E,%G,%H,%I,%J,%N,%P,%S,%T,%W,%X,%Y,%BU,%J1,%A0,%W0,%D1,%D2,%DT,%K,%M
"RTN","GMTSULT5",67,0)
 Q:+($G(DUZ))=0  Q:'$L($$GET1^DIQ(200,(+($G(DUZ))_","),.01))
"RTN","GMTSULT5",68,0)
 S DIC=142,DIC(0)="Z",X=" " D ^DIC S GMTSDISV=$S(+Y>0:+Y,1:"")
"RTN","GMTSULT5",69,0)
 Q
"RTN","GMTSULT5",70,0)
 ;                        
"RTN","GMTSULT5",71,0)
 ; Miscellaneous
"RTN","GMTSULT5",72,0)
INPT(X) ;   Input Transform
"RTN","GMTSULT5",73,0)
 N %,%A,%B,%B1,%B2,%B3,%BA,%C,%E,%G,%H,%I,%J,%N,%P,%S,%T,%W,%X,%Y,%BU,%J1,%A0,%W0,%D1,%D2,%DT,%K,%M
"RTN","GMTSULT5",74,0)
 N GMTSINPT,GMTSI,GMTST S (GMTST,X)=$G(X) I $L(X)=1,X'=" " Q 0
"RTN","GMTSULT5",75,0)
 I X=" "&($G(GMTSDIC0)'["F") D
"RTN","GMTSULT5",76,0)
 . D GDISV S:+($G(GMTSDISV))>0 X=$P($G(^GMT(142,+($G(GMTSDISV)),0)),U,1),(Y,GMTSD)=+GMTSDISV
"RTN","GMTSULT5",77,0)
 K ^TMP("GMTSULT",$J),^TMP("GMTSULT2",$J) S GMTSINPT="" D LIST^GMTSULT2(X) S X=$S($D(^TMP("GMTSULT",$J,0)):1,1:0)
"RTN","GMTSULT5",78,0)
 I +X=0,$L($G(GMTST))>2,$L($G(GMTST))<31,+($G(GMTSLGO))=142,$G(GMTSDIC0)["L" S X=1 Q X
"RTN","GMTSULT5",79,0)
 K ^TMP("GMTSULT",$J),^TMP("GMTSULT2",$J) Q X
"RTN","GMTSULT6")
0^48^B27875136
"RTN","GMTSULT6",1,0)
GMTSULT6 ; SLC/KER - HS Type Lookup (Select)     ; 08/27/2002
"RTN","GMTSULT6",2,0)
 ;;2.7;Health Summary;**30,32,56**;Oct 20, 1995
"RTN","GMTSULT6",3,0)
 ;
"RTN","GMTSULT6",4,0)
 ; External References
"RTN","GMTSULT6",5,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSULT6",6,0)
 ;   DBIA 10006  ^DIC  (file #142)
"RTN","GMTSULT6",7,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSULT6",8,0)
 ;   DBIA  2056  $$GET1^DIQ  (file #200)
"RTN","GMTSULT6",9,0)
 ;   DBIA 10016  ^DIM
"RTN","GMTSULT6",10,0)
 ;   DBIA  2055  RECALL^DILFD
"RTN","GMTSULT6",11,0)
 Q
"RTN","GMTSULT6",12,0)
 ;                          
"RTN","GMTSULT6",13,0)
MULTI ; Selection when Multiple Entries are found
"RTN","GMTSULT6",14,0)
 I $L($G(GMTSDICB)),GMTSDEF=1 D DEF Q
"RTN","GMTSULT6",15,0)
 S GMTSDICW=$$DICW($G(GMTSDICW)) K:'$L(GMTSDICW) GMTSDICW
"RTN","GMTSULT6",16,0)
 N GMTSIEN,GMTSE,GMTSO,GMTST,GMTSTOT,GMTSM S GMTSTOT=^TMP("GMTSULT",$J,0) Q:+GMTSTOT=0  I +GMTSTOT=1 D ONE Q
"RTN","GMTSULT6",17,0)
 W ! W:+GMTSTOT>1 !,GMTSTOT," Health Summary Types found"
"RTN","GMTSULT6",18,0)
 N GMTSI,GMTSS,GMTSEX,X,GMTSTR,GMTSTR2,GMTSTR3,GMTSLEN S GMTSLEN=75,GMTSS=0,GMTSEX=0
"RTN","GMTSULT6",19,0)
 ;   List 5 at a time
"RTN","GMTSULT6",20,0)
 F GMTSI=1:1:^TMP("GMTSULT",$J,0) Q:((GMTSS>0)&(GMTSS<GMTSI+1))  Q:GMTSEX  D  Q:GMTSEX
"RTN","GMTSULT6",21,0)
 . S GMTSE=$G(^TMP("GMTSULT",$J,GMTSI))
"RTN","GMTSULT6",22,0)
 . S GMTSM=GMTSI W:GMTSI#5=1 ! W !,$J(GMTSI,4),".  "
"RTN","GMTSULT6",23,0)
 . S GMTSIEN=+GMTSE,(GMTST,GMTSTR)=$P(GMTSE,U,7),GMTSO=$P(GMTSE,U,2)
"RTN","GMTSULT6",24,0)
 . S:'$L(GMTSTR)&($L(GMTSO)) GMTSTR=GMTSO
"RTN","GMTSULT6",25,0)
 . D WRM1
"RTN","GMTSULT6",26,0)
 . W:GMTSI#5=0 ! S:GMTSI#5=0 GMTSS=$$SEL(GMTSM) S:GMTSS["^" GMTSEX=1
"RTN","GMTSULT6",27,0)
 I GMTSI#5'=0,+GMTSS=0 W ! S GMTSS=$$SEL(GMTSM) S:GMTSS["^" GMTSEX=1
"RTN","GMTSULT6",28,0)
 I 'GMTSEX,+GMTSS>0 D  Q
"RTN","GMTSULT6",29,0)
 . N GMTSNAM K Y S Y=+($G(^TMP("GMTSULT",$J,+GMTSS)))
"RTN","GMTSULT6",30,0)
 . S GMTSNAM=$P($G(^GMT(142,+Y,0)),"^",1) I '$L(GMTSNAM) K Y S Y=-1 Q
"RTN","GMTSULT6",31,0)
 . D Y(+Y)
"RTN","GMTSULT6",32,0)
 K Y S Y=-1
"RTN","GMTSULT6",33,0)
 Q
"RTN","GMTSULT6",34,0)
WRM1 ;   Write one entry of muli selection
"RTN","GMTSULT6",35,0)
 N Y,GMTS S Y=+GMTSIEN,GMTS=$G(^GMT(142,+Y,0))
"RTN","GMTSULT6",36,0)
 I '$D(GMTSDICW) W:$L(GMTSTR)'>GMTSLEN GMTSTR D:$L(GMTSTR)>GMTSLEN LONG Q
"RTN","GMTSULT6",37,0)
 I $D(GMTSDICW),$G(GMTSDIC0)'["S" W $P(GMTS,"^",1),"  " X GMTSDICW Q
"RTN","GMTSULT6",38,0)
 I $D(GMTSDICW),$G(GMTSDIC0)["S" X GMTSDICW Q
"RTN","GMTSULT6",39,0)
 Q
"RTN","GMTSULT6",40,0)
SEL(X) ;   Select multiple
"RTN","GMTSULT6",41,0)
 N Y,GMTSM,DTOUT,DUOUT,DIRUT,DIROUT S GMTSM=+($G(X)) Q:GMTSM=0 -1
"RTN","GMTSULT6",42,0)
 S:+($O(^TMP("GMTSULT",$J,+($G(GMTSI)))))>0 DIR("A")="Press <RETURN> for more, '^' to exit, or Select 1-"_GMTSM_":  "
"RTN","GMTSULT6",43,0)
 S:+($O(^TMP("GMTSULT",$J,+($G(GMTSI)))))'>0 DIR("A")="Select 1-"_GMTSM_":  "
"RTN","GMTSULT6",44,0)
 S (DIR("?"),DIR("??"))="Answer must be from 1 to "_GMTSM_", or <Return> to continue  "
"RTN","GMTSULT6",45,0)
 S DIR(0)="NAO^1:"_GMTSM_":0" D ^DIR S:$D(DTOUT)!(X[U) X=U K DIR Q X
"RTN","GMTSULT6",46,0)
 Q
"RTN","GMTSULT6",47,0)
 ;                          
"RTN","GMTSULT6",48,0)
ONE ; One entry on the selection list
"RTN","GMTSULT6",49,0)
 I $L($G(GMTSDICB)),GMTSDEF=1 D DEF Q
"RTN","GMTSULT6",50,0)
 N GMTSEX,GMTSIEN,GMTSTR,GMTSTR2,GMTSY,GMTSX,GMTSLEN,DIR,X
"RTN","GMTSULT6",51,0)
 S GMTSLEN=75,Y=0 S:GMTSQ!($G(GMTSDIC0)["E") GMTSQ=1,Y=1
"RTN","GMTSULT6",52,0)
 S GMTSEX=0
"RTN","GMTSULT6",53,0)
 ;   No Echo or if Ask
"RTN","GMTSULT6",54,0)
 S GMTSIEN=+($G(^TMP("GMTSULT",$J,1)))
"RTN","GMTSULT6",55,0)
 I 'GMTSQ!($G(GMTSDIC0)["A") D
"RTN","GMTSULT6",56,0)
 . N X S GMTSTR=$P($G(^TMP("GMTSULT",$J,1)),U,7)
"RTN","GMTSULT6",57,0)
 . S:'$L(GMTSTR) GMTSTR=$P($G(^TMP("GMTSULT",$J,1)),U,2)
"RTN","GMTSULT6",58,0)
 . D WRO1 S Y=$$OK S:Y["^" GMTSEX=1
"RTN","GMTSULT6",59,0)
 I 'GMTSEX,+Y>0 D  Q
"RTN","GMTSULT6",60,0)
 . N GMTSNAM K Y S Y=+($G(^TMP("GMTSULT",$J,1)))
"RTN","GMTSULT6",61,0)
 . S GMTSNAM=$P($G(^GMT(142,+Y,0)),"^",1) I '$L(GMTSNAM) K Y S Y=-1 Q
"RTN","GMTSULT6",62,0)
 . D Y(+Y)
"RTN","GMTSULT6",63,0)
 K Y S Y=-1
"RTN","GMTSULT6",64,0)
 Q
"RTN","GMTSULT6",65,0)
WRO1 ;   Write one entry of single selection
"RTN","GMTSULT6",66,0)
 W !!,"  " N Y,GMTS S Y=+GMTSIEN,GMTS=$G(^GMT(142,+Y,0))
"RTN","GMTSULT6",67,0)
 I '$D(GMTSDICW) W:$L(GMTSTR)'>GMTSLEN GMTSTR D:$L(GMTSTR)>GMTSLEN LONG W ! Q
"RTN","GMTSULT6",68,0)
 I $D(GMTSDICW),$G(GMTSDIC0)'["S" W $P(GMTS,"^",1),"  " X GMTSDICW W ! Q
"RTN","GMTSULT6",69,0)
 I $D(GMTSDICW),$G(GMTSDIC0)["S" X GMTSDICW W ! Q
"RTN","GMTSULT6",70,0)
 Q
"RTN","GMTSULT6",71,0)
OK(X) ;   Select one if DIC(0)["A" Ask OK
"RTN","GMTSULT6",72,0)
 N DIR,DTOUT,DUOUT,DIROUT S DIR(0)="YAO",DIR("B")="YES"
"RTN","GMTSULT6",73,0)
 S DIR("A")="  OK?  " D ^DIR S:X'["^" X=+Y S:$D(DTOUT)!($D(DUOUT)) X="^" S:X["^" X="^" Q X
"RTN","GMTSULT6",74,0)
 ;                          
"RTN","GMTSULT6",75,0)
DEF ; Select Default Entry
"RTN","GMTSULT6",76,0)
 N GMTSNAM K Y S Y=+($G(^TMP("GMTSULT",$J,1)))
"RTN","GMTSULT6",77,0)
 S GMTSNAM=$P($G(^GMT(142,+Y,0)),"^",1) I '$L(GMTSNAM) K Y S Y=-1 Q
"RTN","GMTSULT6",78,0)
 D Y(+Y)
"RTN","GMTSULT6",79,0)
 Q
"RTN","GMTSULT6",80,0)
 ;                       
"RTN","GMTSULT6",81,0)
 ; Display
"RTN","GMTSULT6",82,0)
LONG ;   Handle a long string
"RTN","GMTSULT6",83,0)
 N GMTSP,GMTSOK,GMTSCHR,GMTSPSN,GMTSTO,GMTSREM,GMTSLN,GMTSOLD S GMTSLN=0,GMTSOLD=GMTSTR,GMTSP=5
"RTN","GMTSULT6",84,0)
 F  Q:$L(GMTSTR)<(GMTSLEN+1)  D PARSE Q:$L(GMTSTR)<(GMTSLEN+1)
"RTN","GMTSULT6",85,0)
 S GMTSLN=GMTSLN+1 W:GMTSLN>1 ! W ?GMTSP,GMTSTR
"RTN","GMTSULT6",86,0)
 Q
"RTN","GMTSULT6",87,0)
PARSE ;   Parse a long string to screen length
"RTN","GMTSULT6",88,0)
 S GMTSOK=0,GMTSCHR="" F GMTSPSN=GMTSLEN:-1:0 Q:+GMTSOK=1  D  Q:+GMTSOK=1
"RTN","GMTSULT6",89,0)
 . I $E(GMTSTR,GMTSPSN)=" " S GMTSCHR=" ",GMTSOK=1 Q
"RTN","GMTSULT6",90,0)
 . I $E(GMTSTR,GMTSPSN)="," S GMTSCHR=",",GMTSOK=1 Q
"RTN","GMTSULT6",91,0)
 . I $E(GMTSTR,GMTSPSN)="/" S GMTSCHR="/",GMTSOK=1 Q
"RTN","GMTSULT6",92,0)
 . I $E(GMTSTR,GMTSPSN)="-" S GMTSCHR="-",GMTSOK=1 Q
"RTN","GMTSULT6",93,0)
 I GMTSCHR=" " S GMTSTO=$E(GMTSTR,1,GMTSPSN-1),GMTSREM=$E(GMTSTR,GMTSPSN+1,$L(GMTSTR))
"RTN","GMTSULT6",94,0)
 I GMTSCHR="," S GMTSTO=$E(GMTSTR,1,GMTSPSN),GMTSREM=$E(GMTSTR,(GMTSPSN+1),$L(GMTSTR)) S:$E(GMTSREM,1)=" " GMTSREM=$E(GMTSREM,2,$L(GMTSREM))
"RTN","GMTSULT6",95,0)
 I GMTSCHR="/" S GMTSTO=$E(GMTSTR,1,GMTSPSN),GMTSREM=$E(GMTSTR,(GMTSPSN+1),$L(GMTSTR)) S:$E(GMTSREM,1)=" " GMTSREM=$E(GMTSREM,2,$L(GMTSREM))
"RTN","GMTSULT6",96,0)
 I GMTSCHR="-" S GMTSTO=$E(GMTSTR,1,GMTSPSN),GMTSREM=$E(GMTSTR,(GMTSPSN+1),$L(GMTSTR)) S:$E(GMTSREM,1)=" " GMTSREM=$E(GMTSREM,2,$L(GMTSREM))
"RTN","GMTSULT6",97,0)
 S GMTSTR=GMTSREM,GMTSLN=GMTSLN+1 W:GMTSLN>1 ! W ?GMTSP,GMTSTO
"RTN","GMTSULT6",98,0)
 Q
"RTN","GMTSULT6",99,0)
DICW(X) ;   Check for valid DIC("W")
"RTN","GMTSULT6",100,0)
 S X=$G(X) Q:'$L(X) ""
"RTN","GMTSULT6",101,0)
 D ^DIM I '$D(X) Q ""
"RTN","GMTSULT6",102,0)
 Q X
"RTN","GMTSULT6",103,0)
 ;                       
"RTN","GMTSULT6",104,0)
 ; Post Selection
"RTN","GMTSULT6",105,0)
Y(X) ;   Set Y
"RTN","GMTSULT6",106,0)
 K Y S X=+($G(X))
"RTN","GMTSULT6",107,0)
 S:X'>0!('$D(^GMT(142,+X,0))) Y=-1 Q:X'>0!('$D(^GMT(142,+X,0)))
"RTN","GMTSULT6",108,0)
 S Y=+X_"^"_$P($G(^GMT(142,+X,0)),"^",1)
"RTN","GMTSULT6",109,0)
 S:$G(GMTSDIC0)["Z"!($G(DIC(0))["Z") Y(0)=$G(^GMT(142,+X,0)),Y(0,0)=$P($G(^GMT(142,+X,0)),"^",1),Y(0,1)=$$MX(Y(0,0))
"RTN","GMTSULT6",110,0)
 I +($G(GMTSWY))=0 W:$G(GMTSDIC0)["E"!($G(DIC(0))["E") "  ",$P($G(^GMT(142,+X,0)),"^",1) S GMTSWY=1
"RTN","GMTSULT6",111,0)
 D:$G(GMTSDIC0)'["F"&($G(DIC(0))'["F") SDISV
"RTN","GMTSULT6",112,0)
 Q
"RTN","GMTSULT6",113,0)
SDISV ;   Save Default Value (Spacebar-Return)
"RTN","GMTSULT6",114,0)
 Q:$G(GMTSDIC0)["F"  Q:+($G(DUZ))=0  Q:'$L($$GET1^DIQ(200,(+($G(DUZ))_","),.01))  Q:+($G(Y))=0  Q:'$D(^GMT(142,+($G(Y)),0))
"RTN","GMTSULT6",115,0)
 D RECALL^DILFD(142,+($G(Y))_",",+($G(DUZ))) Q
"RTN","GMTSULT6",116,0)
 Q
"RTN","GMTSULT6",117,0)
MX(X) ; Mix Case
"RTN","GMTSULT6",118,0)
 Q $$EN^GMTSUMX(X)
"RTN","GMTSUMX2")
0^49^B70905867
"RTN","GMTSUMX2",1,0)
GMTSUMX2 ; SLC/KER - Convert Text to Mix Case (1-4) ; 08/27/2002
"RTN","GMTSUMX2",2,0)
 ;;2.7;Health Summary;**30,37,56**;Oct 20, 1995
"RTN","GMTSUMX2",3,0)
 ;         
"RTN","GMTSUMX2",4,0)
1 I "^B^C^D^E^F^G^H^I^J^K^M^N^O^P^Q^S^T^U^V^X^Y^Z^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",5,0)
 I "^W^L^R^"[X S Y=$$LO(X) Q
"RTN","GMTSUMX2",6,0)
 I "^MM^CM^IN^FT^CM^CC^"[X S Y=$$LO(X) Q
"RTN","GMTSUMX2",7,0)
 Q
"RTN","GMTSUMX2",8,0)
2 ; 2 Characters
"RTN","GMTSUMX2",9,0)
 S J=$G(J)
"RTN","GMTSUMX2",10,0)
 I J'="",J'=" ","^OR^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",11,0)
 S:X="DA" Y="dA" S:X="DC" Y="dC" S:X="DG" Y="dG" S:X="DT" Y="dT" S:X="DU" Y="dU" S:X="GB" Y="gB" S:X="GC" Y="gC" S:X="GH" Y="gH" S:X="KB" Y="kB" Q:$L($G(Y))
"RTN","GMTSUMX2",12,0)
 S:X="KD" Y="kD" S:X="PH" Y="pH" S:X="PX" Y="pX" Q:$L($G(Y))
"RTN","GMTSUMX2",13,0)
 I "^WO^W/^IN^IS^IT^AT^OR^TO^OF^ON^BE^BY^"[X S Y=$$LO(X) Q
"RTN","GMTSUMX2",14,0)
 I "^ST^"[X S Y=$$MX(X) Q
"RTN","GMTSUMX2",15,0)
 I "^DG^DI^DS^EC^EN^ES^FB^ID^FH^HL^IB^LA^LR^MD^MC^NS^OR^PX^RA^RG^RT^SD^SR^SW^VA^WV^XH^XM^XT^XU^YS^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",16,0)
 I "^BA^BT^CD^CH^CM^CN^CP^CR^CY^BW^7S^OL^CA^MC^EP^II^RO^ZP^ZY^SH^ES^MF^GP^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",17,0)
 I "^CW^DD^DI^DS^EM^HF^IM^LH^LO^OD^OE^PN^RI^RP^RS^SP^SR^ST^SW^TP^TR^TS^VS^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",18,0)
 I "^EP^AA^AB^AC^AD^AF^AG^AH^AP^AR^AV^BA^BB^BC^BE^BG^BH^BK^BL^BM^BP^BR^BS^BW^CA^CB^CD^CE^CF^CG^CH^CI^CK^CL^CO^CP^CR^CS^CT^CV^DB^DD^DL^DM^DN^DP^DQ^DR^EA^EB^EC^EF^EM^EO^EP^ET^FA^FD^FK^FR^FU^GA^GI^GL^GP^GR^GS^GT^HA^HB^HC^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",19,0)
 I "^HC^HL^HO^HP^HR^HS^HT^HU^HX^IA^IB^IE^IF^II^IL^IP^IV^IX^KO^KS^LA^LD^LE^LF^LH^LL^LR^LY^MA^MB^MC^ME^MF^MI^MK^MP^MR^MS^MT^NA^NB^NF^NG^NH^NK^NL^NP^NS^NT^OC^OD^OH^OP^OT^OX^PA^PC^PD^PE^PF^PG^PI^PK^PL^PM^PP^PR^PS^PT^PZ^RA^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",20,0)
 I "^RA^RC^RF^RH^RI^RP^RR^RS^RX^SA^SB^SC^SD^SE^SF^SG^SH^SI^SK^SL^SM^SP^SR^SS^SV^TA^TB^TC^TF^TH^TI^TK^TL^TP^TT^UK^UD^UV^VA^VC^VH^VI^VO^VP^VZ^WB^WS^XI^YM^YY^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",21,0)
 I "^AN^AS^AT^BY^CM^DE^IN^MG^NO^OF^ON^OR^SQ^TO^UP^YL^"[X S Y=$$LO(X) Q
"RTN","GMTSUMX2",22,0)
 Q
"RTN","GMTSUMX2",23,0)
3 ; 3 Characters
"RTN","GMTSUMX2",24,0)
 S:X="BRZ" Y="BrZ" S:X="COA" Y="CoA" S:X="COM" Y="CoM" S:X="EIF" Y="eIF" S:X="HGH" Y="hGH" S:X="HPR" Y="HPr" S:X="IGA" Y="IgA" S:X="IGD" Y="IgD" S:X="IGE" Y="IgE" Q:$L($G(Y))
"RTN","GMTSUMX2",25,0)
 S:X="IGG" Y="IgG" S:X="IGM" Y="IgM" S:X="IIB" Y="IIb" S:X="KDA" Y="kDa" S:X="MEC" Y="MeC" S:X="MEO" Y="MeO" S:X="NAC" Y="NAc" S:X="NIA" Y="NIa" S:X="OET" Y="OEt" Q:$L($G(Y))
"RTN","GMTSUMX2",26,0)
 S:X="OME" Y="OMe" S:X="PNA" Y="pNA" S:X="PRP" Y="PrP" S:X="SMB" Y="SmB" S:X="VPG" Y="VPg" Q:$L($G(Y))
"RTN","GMTSUMX2",27,0)
 I "^DIR^MED^APR^AUG^BAY^FEB^HOT^JAN^JCT^JUL^JUN^LAS^LOS^MAR^FAC^MAY^MTN^NEW^NOV^OCT^OUT^SAN^SEP^SKY^"[X S Y=$$MX(X) Q
"RTN","GMTSUMX2",28,0)
 I "^ALL^AND^ARE^BUT^SET^NOW^ANY^HAD^DUE^MED^TOO^FAR^OWN^MIN^ITS^HIM^OUR^HIS^HER^NEW^LOW^ITS^MAY^HOW^OUT^WAS^W/O^FOR^NOT^THE^CAN^PUT^"[X S Y=$$LO(X) Q
"RTN","GMTSUMX2",29,0)
 I "^ADC^ADR^ADT^BDS^BLO^BPN^BSR^CRS^OER^OEX^CVF^CVP^DCS^DEM^EDL^HCS^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",30,0)
 I "^MIC^NSR^NTM^OPC^ORC^PLA^PLI^PLL^PRC^SCD^SHF^SLT^SPN^SRI^SRO^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",31,0)
 I "^CWT^IOL^SVS^VSO^EES^EPO^DVC^ASC^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",32,0)
 I "^ICU^NOS^NEC^SLC^ISC^A3A^A3F^A7R^DPT^DVB^ECT^ECX^EDR^EEO^GEC^IBD^IBJ^CPT^ICD^IMR^IVM^LA7^LEX^LRS^LRX^MC2^MPR^NUR^PCE^ORA^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",33,0)
 I "^NLM^DIC^DIR^DIK^XMB^ORB^PRC^PRS^PSA^PSD^PSG^PSJ^PSN^PSO^PSS^PSU^PSX^QAC^QAM^QAN^QAO^QAP^QAQ^QAR^QIE^QIP^RTY^SPN^TIU^USR^VAQ^VON^XPD^XUC^XWB^YSA^ZDG^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",34,0)
 I "^ABA^ABC^ABO^ABP^ACE^ACP^ADA^ADH^ADV^ADP^AFO^AII^ALS^AMC^AMP^ANF^ANP^ASA^ATF^ATP^ATX^AVP^AVT^AZT^BAM^BCG^BCP^BDB^BDS^BIM^BLS^BMP^BNP^BOC^BPV^BRL^BSA^BSP^CAD^CAF^CAM^CAP^CAT^CAZ^CBC^CBZ^CCK^CDP^CDR^CEA^CEF^CFA^CGP^CGS^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",35,0)
 I "^CGS^CHO^CMC^CMF^CMP^CMV^CNP^CNS^CPE^CPK^CRF^CRH^CSF^CTP^CYT^DAB^DAP^DAT^DBP^DDE^DDT^DFA^DHP^DIP^DJD^DME^DNA^DNP^DTP^EAP^EBP^EBV^ECE^ECG^EEE^EEG^EGF^EHV^EIA^EKG^EMD^EMG^EMS^ENA^ENK^FAD^FAP^FDA^FDP^FGF^FMN^FSH^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",36,0)
 I "^FSH^FSP^FTC^GAP^GDP^GLP^GMP^GPC^GPD^GRF^GRP^GSH^GTH^GTP^GVP^HBP^HCG^HCL^HCO^HCT^HCV^HDL^HFO^HHV^HIB^HIV^HLA^HLH^HMG^HNF^HNP^HOE^HPA^HPC^HPV^HRP^HSA^HSV^IAA^ICI^ICP^IDA^IFN^IGF^IIA^III^IMP^ITF^IUD^JMV^KAP^KLH^LAI^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",37,0)
 I "^LAI^LAP^LAV^LDH^LDL^LPH^LSD^LSO^MAA^MAM^MAP^MBP^MCA^MCP^MDL^MDP^MDV^MEA^MEN^MEP^MHC^MIF^MIP^MPA^MPS^MRA^MRC^MRI^MRP^MSA^MSH^MTP^NAD^NAG^NAP^NBD^NCA^NCS^NEC^NGF^NHE^NKA^NMN^NOS^NPY^NSC^NYU^OMP^OMT^ORF^OTF^PAF^PAL^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",38,0)
 I "^PAL^PAP^PAS^PBP^PCA^PCP^PEG^PEP^PET^PHA^PIP^PIV^PKI^PLP^POC^PPD^PPP^PRV^PSA^PSP^PTB^PTC^PTH^PTT^PTX^RAB^RAG^RAP^RBC^RBP^RGD^RII^RMI^RNA^RNP^RSV^SAA^SAM^SAP^SCP^SDZ^SEO^SER^SFV^SHV^SIV^SKF^SKN^SMP^SOD^SOS^SPM^SRV^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",39,0)
 I "^RAS^SRV^STP^TAG^TAP^TCF^TCP^TDP^TEF^TEM^TFA^TGF^TMV^TNF^TNP^TPA^TPN^TRH^TRP^TSA^TSH^TTP^TTR^UDP^UMP^URO^USF^UTP^VII^VIP^VLA^VSG^VZV^WBC^WGA^WHO^XII^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",40,0)
 I "^MAA^MPP^NEC^NOS^ZTA^CPD^R/O^MDA^3MC^ACP^SFN^URR^SNF^SLC^ISC^III^ATP^CMP^AAF^APV^LSD^PCP^HTP^RNA^DNA^ISC^NLM^IMP^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",41,0)
 I "^ONE^TWO^SIX^TEN^AND^ANY^BIS^BUT^CIS^DES^DUE^FOR^LPM^NON^NOT^OXO^PER^PRE^PRO^PSI^THE^USE^"[X S Y=$$LO(X) Q
"RTN","GMTSUMX2",42,0)
 Q
"RTN","GMTSUMX2",43,0)
4 ; 4 Characters
"RTN","GMTSUMX2",44,0)
 S:X="APOA" Y="ApoA" S:X="BBVI" Y="BbvI" S:X="BPTH" Y="bPTH" S:X="BSUE" Y="BsuE" S:X="CAMP" Y="cAMP" S:X="CGMP" Y="cGMP" S:X="COTE" Y="CotE" S:X="DATP" Y="dATP" Q:$L($G(Y))
"RTN","GMTSUMX2",45,0)
 S:X="DCMP" Y="dCMP" S:X="DCTP" Y="dCTP" S:X="DGMP" Y="dGMP" S:X="DGTP" Y="dGTP" S:X="DSBA" Y="dsbA" S:X="DTDP" Y="dTDP" S:X="DTTP" Y="dTTP" S:X="DUMP" Y="dUMP" Q:$L($G(Y))
"RTN","GMTSUMX2",46,0)
 S:X="DURD" Y="dUrd" S:X="DUTP" Y="dUTP" S:X="ECAI" Y="EcaI" S:X="ECOK" Y="EcoK" S:X="ERBB" Y="erbB" S:X="FELV" Y="FeLV" S:X="FMET" Y="fMet" S:X="GNRH" Y="GnRH" Q:$L($G(Y))
"RTN","GMTSUMX2",47,0)
 S:X="GPII" Y="gpII" S:X="HARG" Y="hArg" S:X="HELA" Y="HeLa" S:X="HGRF" Y="hGRF" S:X="HHAI" Y="HhaI" S:X="HPAI" Y="HpaI" S:X="HPTH" Y="hPTH" S:X="IIIA" Y="IIIa" Q:$L($G(Y))
"RTN","GMTSUMX2",48,0)
 S:X="KPNI" Y="KpnI" S:X="MCRB" Y="McrB" S:X="MESH" Y="MeSH" S:X="MRNA" Y="mRNA" S:X="NHET" Y="NHEt" S:X="NHME" Y="NHMe" S:X="OBZL" Y="OBzl" S:X="OTBU" Y="OtBu" Q:$L($G(Y))
"RTN","GMTSUMX2",49,0)
 S:X="PGLU" Y="pGlu" S:X="PSTI" Y="PstI" S:X="REGA" Y="regA" S:X="RRNA" Y="rRNA" S:X="SCEI" Y="SceI" S:X="TAQI" Y="TaqI" S:X="TRFA" Y="TrfA" S:X="TRKA" Y="trkA" Q:$L($G(Y))
"RTN","GMTSUMX2",50,0)
 S:X="TRKB" Y="trkB" S:X="TRNA" Y="tRNA" Q:$L($G(Y))
"RTN","GMTSUMX2",51,0)
 I "^BATH^CITH^CITY^EAST^ERIE^FORT^HOME^IOWA^IRON^JUAN^JULY^JUNE^LAKE^LOMA^LONG^LYON^PALM^PALO^PARK^RENO^ROCK^SALT^SIDE^WACO^WEST^YORK^"[X S Y=$$MX(X) Q
"RTN","GMTSUMX2",52,0)
 I "^BADR^BDEM^BMIC^EADT^MAGI^MEDA^MEDB^MEDC^MEDF^MHPE^RXIV^RXOP^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",53,0)
 I "^RXUD^SCL1^SCL2^HISA^HPSA^CRNA^HCFA^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",54,0)
 ;I "^^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",55,0)
 I "^A1B5^A1BG^A4A7^A4A8^A6K7^ABSV^ACKQ^DENT^DGHI^DGPW^DGY1^DGY3^DGYA^DGYB^DGYC^DGYD^DGYF^DGYG^DGYJ^DGYK^DGYL^DGYN^DGYO^DGYP^DGYQ^DGYR^DGYS^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",56,0)
 I "^DGYU^DGYV^DGYW^DGYX^DGYZ^DIPK^DVBA^DVBC^DVBQ^DVBT^DVBU^DVBW^DVBX^DVBY^EEOA^EEOP^ENXE^ENXF^ENXG^ENXI^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",57,0)
 I "^ENXJ^ENXK^FBAA^GECD^GECP^GECS^GMAA^GMD1^GMN1^GMN2^GMN3^GMN4^GMN5^GMPL^GMPT^GMRA^GMRC^GMRD^GMRE^GMRG"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",58,0)
 I "^GMRP^GMRQ^GMRR^GMRS^GMRV^GMRY^GMTS^HBHC^IBDE^IBDP^IBQL^IBQY^IBY3^IBY4^IBY5^IBY6^IBY7^IBY8^IBY9^IBYA^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",59,0)
 I "^IBYB^IBYC^IBYD^IBYE^IBYF^IBYG^IBYH^IBYK^IBYL^IBYN^ICPT^LBRN^LBRT^LBRY^LR00^LR01^LR03^LRAR^LRLS^MCXX^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",60,0)
 I "^NURA^NURC^NURE^NURQ^NURX^ONCO^PRCA^PRCP^PRMQ^PRPF^PRSX^PRX0^PRX1^PRX8^PRXB^PRXC^PRXE^PRXF^PRXG^PRXI^PRXJ^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",61,0)
 I "^PRXK^PRXP^PRYA^PRYB^PRYC^PRYD^PRYF^PRYH^PRYJ^PRYL^PRYN^PRYP^PSA1^PSD1^PSGW^PSIV^PSJ1^PSJ4^PSOA^PSOB^PSOC^PSOD^PSOE^PSOG^PSOH^PSOJ^PSOL^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",62,0)
 I "^PSOY^PSW1^PSXC^QAN1^QAR1^QAR2^QARF^QARY^RAAA^RAAB^RAAC^RAAE^RAAF^RMPC^RMPF^RMPJ^RMPR^RMPT^RTYB^RTYC^RTYD^SDYA^SDYM^SDYN^SDYP^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",63,0)
 I "^SOWA^SOWC^SOWK^SROA^SRRS^SRRT^TIUJ^TIUW^TIUX^VALM^VEEM^VSIT^XQOR^XUFI^YS01^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",64,0)
 I "^AIDS^ANCA^ARPP^ATLV^BPDE^BUSI^CENP^CGRP^COOH^CPAP^CPEP^DHEA^DMBA^DSIP^DTPA^EBNA^EDTA^ERCC^ERCP^ESRD^FANA^FITC^FKBP^GABA^GATA^GHRH^GLUT^GYKI^HCMV^HIDA^HMSN^HSAN^HTLV^IDDM^INTP^IPPB^KAFO^LATS^LHRH^MAGE^MLVP^MPTP^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",65,0)
 I "^ANIT^CAMP^DOPS^MPTP^HETE^OERR^GMPT^GMPL^MTLU^UMLS^BPDE^DMBA^PABA^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",66,0)
 I "^MPTP^NADH^NADP^NAPS^NETT^NGFI^NRDC^NSCL^PAPS^POMC^PSAP^RTEM^SACH^SGOT^SNAP^SRIF^SRIH^TAPA^TATA^TCDD^TENS^TIMP^TLSO^UDPG^VIII^VLDL^WHFO^XIII^"[X S Y=$$UP(X) Q
"RTN","GMTSUMX2",67,0)
 I "^USED^EACH^DTMN,FOUR^FIVE^NINE^HOUR^INTO^LESS^LIKE^MORE^ONLY^OPEN^OVER^PART^SITE^THAN^TYPE^WITH^"[X S Y=$$LO(X) Q
"RTN","GMTSUMX2",68,0)
 I "^BEST^IT'S^LATE^SITE^FROM^SOME^WITH^UPON^THEY^THEN^INTO^MORE^THAN^THAT^THIS^THUS^HAVE^BEEN^NOTE^DONE^MUST^MERE^SURE^KIND^WHEN^WHAT^"[X S Y=$$LO(X) Q
"RTN","GMTSUMX2",69,0)
 I "^LOST^LIKE^OURS^ALSO^EACH^ONLY^HERE^SUCH^SEEN^SAME^LESS^AREA^MANY^EVEN^LEFT^MOST^"[X S Y=$$LO(X) Q
"RTN","GMTSUMX2",70,0)
 Q
"RTN","GMTSUMX2",71,0)
 ;          
"RTN","GMTSUMX2",72,0)
LO(X) Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","GMTSUMX2",73,0)
UP(X) Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSUMX2",74,0)
MX(X) Q $TR($E(X,1),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$TR($E(X,2,$L(X)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","GMTSUP")
0^61^B35274216
"RTN","GMTSUP",1,0)
GMTSUP ; SLC/KER - Utilities for Paging HS           ; 08/27/2002
"RTN","GMTSUP",2,0)
 ;;2.7;Health Summary;**2,7,21,27,28,30,35,47,56**;Oct 20, 1995
"RTN","GMTSUP",3,0)
 ;
"RTN","GMTSUP",4,0)
 ; External References
"RTN","GMTSUP",5,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSUP",6,0)
 ;   DBIA    82  EN^XQORM
"RTN","GMTSUP",7,0)
 ;                       
"RTN","GMTSUP",8,0)
CKP ; Check page position, pause and prompt
"RTN","GMTSUP",9,0)
 Q:$D(GMTSQIT)  S GMTSNPG=0
"RTN","GMTSUP",10,0)
 K:$L($G(GMTSOBJ("LABEL"))) GMTSOBJ("REPORT HEADER")
"RTN","GMTSUP",11,0)
 I $G(GMTSWRIT)=1 D BREAK S GMTSWRIT=0
"RTN","GMTSUP",12,0)
 I +($$HF^GMTSU) D BREAK:(GMTSEGN'=$G(GMTSLCMP)) Q
"RTN","GMTSUP",13,0)
 Q:+$G(GMTSLPG)'>0&($Y'>(IOSL-GMTSLO))
"RTN","GMTSUP",14,0)
 I $E(IOST,1)="C" S:'$D(GMTSTOF) GMTSTOF=1 D CKP1
"RTN","GMTSUP",15,0)
 I '$D(GMTSQIT) W @IOF D HEADER,BREAK S GMTSNPG=1,GMTSTOF=GMTSEGN
"RTN","GMTSUP",16,0)
 I $D(GMTSQIT),(GMTSQIT]""),($D(GMTSTYP)) W @IOF D HEADER S GMTSTOF=GMTSEGN
"RTN","GMTSUP",17,0)
 Q
"RTN","GMTSUP",18,0)
CKP1 ; Help Display of Optional Components for Navigation
"RTN","GMTSUP",19,0)
 N DA,I,J,K,L,X,XQORM,Y,GMTSY,TYP,DIC
"RTN","GMTSUP",20,0)
 I $S('$D(GMTSTYP):1,$D(GMTOPT):1,1:0) N DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!(GMTSLPG) GMTSQIT="" Q
"RTN","GMTSUP",21,0)
 S TYP=GMTSTYP
"RTN","GMTSUP",22,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION" S Y=$$TYPE^GMTSULT
"RTN","GMTSUP",23,0)
 S GMTSTYP=+Y K DIC,X,Y
"RTN","GMTSUP",24,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="1AF\+",XQORM("A")="Press <RET> to continue, ^ to exit, or select component: "
"RTN","GMTSUP",25,0)
 S XQORM("??")="D HELP^GMTSUP1" I GMTSLPG W "* END * "
"RTN","GMTSUP",26,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")"
"RTN","GMTSUP",27,0)
 D EN^XQORM W ! D @$S(Y=1:"BRNCH",1:"EVAL")
"RTN","GMTSUP",28,0)
 I $D(GMTSY),(GMTSY=0) K GMTSY G CKP1
"RTN","GMTSUP",29,0)
 S GMTSTYP=TYP
"RTN","GMTSUP",30,0)
 Q
"RTN","GMTSUP",31,0)
BREAK ; Writes the Component Header
"RTN","GMTSUP",32,0)
 ;           
"RTN","GMTSUP",33,0)
 ;   If the variable GMTSOBJ exist, then the 
"RTN","GMTSUP",34,0)
 ;   Component Headers are suppressed with the
"RTN","GMTSUP",35,0)
 ;   following exceptions:
"RTN","GMTSUP",36,0)
 ;           
"RTN","GMTSUP",37,0)
 ;       If GMTSOBJ("COMPONENT HEADER") exist,
"RTN","GMTSUP",38,0)
 ;       then the Component Header will NOT be
"RTN","GMTSUP",39,0)
 ;       suppressed
"RTN","GMTSUP",40,0)
 ;           
"RTN","GMTSUP",41,0)
 ;       If GMTSOBJ("BLANK LINE") exist, a blank
"RTN","GMTSUP",42,0)
 ;       line will be written after the Component
"RTN","GMTSUP",43,0)
 ;       Header
"RTN","GMTSUP",44,0)
 ;              
"RTN","GMTSUP",45,0)
 N GMTSM,GMTSF S GMTSM=$$MUL,GMTSF=$$FST
"RTN","GMTSUP",46,0)
 I +GMTSM=0,$D(GMTSOBJ),'$D(GMTSOBJ("COMPONENT HEADER")),'$D(GMTSOBJ("BLANK LINE")) Q
"RTN","GMTSUP",47,0)
 N GMTS S:'$D(GMTSLCMP) GMTSLCMP=0 S GMTSNPG=1,GMTS=$$CHDR
"RTN","GMTSUP",48,0)
 ;
"RTN","GMTSUP",49,0)
 I $Y'>(IOSL-GMTSLO)!(+($$HF^GMTSU)) D
"RTN","GMTSUP",50,0)
 . I $D(GMTSOBJ) D  Q
"RTN","GMTSUP",51,0)
 . . S GMTSLCMP=GMTSEGN
"RTN","GMTSUP",52,0)
 . . I +($G(GMTSM))>0!($D(GMTSOBJ("COMPONENT HEADER"))) D
"RTN","GMTSUP",53,0)
 . . . W:+GMTSF=0 ! W !,GMTS,! W:$D(GMTSOBJ("BLANK LINE")) !
"RTN","GMTSUP",54,0)
 . W !,GMTS,!
"RTN","GMTSUP",55,0)
 . W:$Y'>(IOSL-GMTSLO) ?34,$S(GMTSEGN=GMTSLCMP:"(continued)",1:""),!
"RTN","GMTSUP",56,0)
 . S GMTSLCMP=GMTSEGN
"RTN","GMTSUP",57,0)
 Q
"RTN","GMTSUP",58,0)
OLDB ;
"RTN","GMTSUP",59,0)
 S:'$D(GMTSLCMP) GMTSLCMP=0
"RTN","GMTSUP",60,0)
 S GMTS="",GMTSNPG=1
"RTN","GMTSUP",61,0)
 S $P(GMTS,"-",79-$L(GMTSEGH_GMTSEGL)/2)=""
"RTN","GMTSUP",62,0)
 S GMTS=GMTS_" "_GMTSEGH_GMTSEGL_" "_GMTS
"RTN","GMTSUP",63,0)
 I $Y'>(IOSL-GMTSLO)!(+($$HF^GMTSU)) D
"RTN","GMTSUP",64,0)
 . W !,GMTS,!
"RTN","GMTSUP",65,0)
 . W:$Y'>(IOSL-GMTSLO) ?34,$S(GMTSEGN=GMTSLCMP:"(continued)",1:""),!
"RTN","GMTSUP",66,0)
 . S GMTSLCMP=GMTSEGN
"RTN","GMTSUP",67,0)
        Q
"RTN","GMTSUP",68,0)
HEADER ; Print Running Header
"RTN","GMTSUP",69,0)
 ;           
"RTN","GMTSUP",70,0)
 ;   If the variable GMTSOBJ exist, then the 
"RTN","GMTSUP",71,0)
 ;   Report Headers are suppressed with the 
"RTN","GMTSUP",72,0)
 ;   following exceptions:
"RTN","GMTSUP",73,0)
 ;           
"RTN","GMTSUP",74,0)
 ;       If GMTSOBJ("DATE LINE") exist, then the
"RTN","GMTSUP",75,0)
 ;       Location/Report Date line will NOT be
"RTN","GMTSUP",76,0)
 ;       suppressed.
"RTN","GMTSUP",77,0)
 ;           
"RTN","GMTSUP",78,0)
 ;       If GMTSOBJ("CONFIDENTIAL") exist, then
"RTN","GMTSUP",79,0)
 ;       the Confidential Header Name line will
"RTN","GMTSUP",80,0)
 ;       NOT be suppressed.
"RTN","GMTSUP",81,0)
 ;           
"RTN","GMTSUP",82,0)
 ;       If GMTSOBJ("REPORT HEADER") exist, then
"RTN","GMTSUP",83,0)
 ;       the Report Header containing the patient's
"RTN","GMTSUP",84,0)
 ;       name, SSAN, ward and DOB will NOT be
"RTN","GMTSUP",85,0)
 ;       suppressed.
"RTN","GMTSUP",86,0)
 ;              
"RTN","GMTSUP",87,0)
 ;       If the variable GMTSOBJ("LABEL") contains
"RTN","GMTSUP",88,0)
 ;       text, then this text will be used instead of
"RTN","GMTSUP",89,0)
 ;       the Report Header.
"RTN","GMTSUP",90,0)
 ;                 
"RTN","GMTSUP",91,0)
 ;       If GMTSOBJ("REPORT DECEASED") exist, then
"RTN","GMTSUP",92,0)
 ;       the optional line that displays for Deceased
"RTN","GMTSUP",93,0)
 ;       patients will NOT be suppressed.
"RTN","GMTSUP",94,0)
 ;                 
"RTN","GMTSUP",95,0)
 N GMTSVDT,DATA S DATA="" I +$G(GMTSPXD1)&+$G(GMTSPXD2) D
"RTN","GMTSUP",96,0)
 . Q:$G(GMTSOBJ)  S DATA="Printed for data "
"RTN","GMTSUP",97,0)
 . I GMTSPXD1=GMTSPXD2 S DATA=DATA_"on "_GMTSPXD1 Q
"RTN","GMTSUP",98,0)
 . S DATA=DATA_"from "_GMTSPXD2_" to "_GMTSPXD1
"RTN","GMTSUP",99,0)
 I $D(GMTSCDT(0)),'$D(GMTSOBJ) S GMTSVDT=GMTSCDT(0) S:GMTSDTM'["Printed:" GMTSDTM="Printed: "_GMTSDTM
"RTN","GMTSUP",100,0)
 ;   Location and Date of Report
"RTN","GMTSUP",101,0)
 I '$D(GMTSOBJ)!($D(GMTSOBJ("DATE LINE"))) D
"RTN","GMTSUP",102,0)
 . W !,$S($L($P($G(GMTSSC),U,2)):"Location: "_$P(GMTSSC,U,2)_" ",1:"")
"RTN","GMTSUP",103,0)
 . W $S($D(GMTSVDT):GMTSVDT,1:"")
"RTN","GMTSUP",104,0)
 . W DATA,?(79-$L(GMTSDTM)),GMTSDTM
"RTN","GMTSUP",105,0)
 ;   Confidential Header Name
"RTN","GMTSUP",106,0)
 S:'$D(GMTSPG) GMTSPG=0
"RTN","GMTSUP",107,0)
 S GMTSPG=GMTSPG+1,GMTSHDR=" CONFIDENTIAL "_GMTSTITL_" SUMMARY "_$S($E(IOST,1)="C":"",1:"  pg. "_GMTSPG)
"RTN","GMTSUP",108,0)
 S GMTS="",$P(GMTS,"*",(77-$L(GMTSHDR))\2)="*" S GMTSHDR=GMTS_" "_GMTSHDR_" "_GMTS
"RTN","GMTSUP",109,0)
 I '$D(GMTSOBJ)!($D(GMTSOBJ("CONFIDENTIAL"))) W !,GMTSHDR,"*"
"RTN","GMTSUP",110,0)
 ;   Name, SSAN, Ward, DOB
"RTN","GMTSUP",111,0)
 I '$D(GMTSLFG) D
"RTN","GMTSUP",112,0)
 . I $G(GMTSPHDR("TWO")) D
"RTN","GMTSUP",113,0)
 . . I $D(GMTSOBJ),'$D(GMTSOBJ("REPORT HEADER")),$L($G(GMTSOBJ("LABEL"))) W !,GMTSOBJ("LABEL") Q
"RTN","GMTSUP",114,0)
 . . I $D(GMTSOBJ),'$D(GMTSOBJ("REPORT HEADER")) Q
"RTN","GMTSUP",115,0)
 . . W !,GMTSPHDR("NMSSN"),?GMTSPHDR("DOBS"),GMTSPHDR("DOB")
"RTN","GMTSUP",116,0)
 . . W !,?GMTSPHDR("WARDRBS"),GMTSPHDR("WARDRB")
"RTN","GMTSUP",117,0)
 . E  D
"RTN","GMTSUP",118,0)
 . . I $D(GMTSOBJ),'$D(GMTSOBJ("REPORT HEADER")),$L($G(GMTSOBJ("LABEL"))) W !,GMTSOBJ("LABEL") Q
"RTN","GMTSUP",119,0)
 . . I $D(GMTSOBJ),'$D(GMTSOBJ("REPORT HEADER")) Q
"RTN","GMTSUP",120,0)
 . . W !,GMTSPHDR("NMSSN"),?GMTSPHDR("WARDRBS")
"RTN","GMTSUP",121,0)
 . . W GMTSPHDR("WARDRB"),?GMTSPHDR("DOBS"),GMTSPHDR("DOB")
"RTN","GMTSUP",122,0)
 ;   Deceased
"RTN","GMTSUP",123,0)
 I '$D(GMTSOBJ)!($D(GMTSOBJ("DECEASED"))) D
"RTN","GMTSUP",124,0)
 . W:+$G(VADM(6)) !,?26,"** DECEASED   "_$P(VADM(6),U,2)_" **"
"RTN","GMTSUP",125,0)
 W:'$D(GMTSOBJ) !
"RTN","GMTSUP",126,0)
 Q
"RTN","GMTSUP",127,0)
BRNCH ; Checks abbreviation to branch to a different component
"RTN","GMTSUP",128,0)
 N GMTINX,LIM,CREC,SBS
"RTN","GMTSUP",129,0)
 I Y,("+-"[X) S:X="-" GMTSEGN=GMTSTOF-1 S (GMTSY,GMTSQIT)=1,GMTSLPG=0 Q
"RTN","GMTSUP",130,0)
 I X="^^" S DIROUT=1,GMTSQIT="" Q
"RTN","GMTSUP",131,0)
 I Y,(X?1"^^".E) Q
"RTN","GMTSUP",132,0)
 S GMTINX=$S($D(^GMT(142,GMTSTYP,1,+Y(1),0)):$P(^(0),U,2),1:"")
"RTN","GMTSUP",133,0)
 I 'GMTINX S GMTSY=0 Q
"RTN","GMTSUP",134,0)
 I '$D(GMTSEGI(GMTINX)) N GMI,GMJ,GMTSDFLT S GMI=1,GMJ=GMTSEGC,GMTSDFLT=1 D LOAD^GMTSADH S GMTSEGC=GMTSEGC+1
"RTN","GMTSUP",135,0)
 I '$D(GMTSEGI(GMTINX)) S GMTINX="",GMTSY=0 Q
"RTN","GMTSUP",136,0)
 S LIM=$P(Y(1),U,4) I LIM'["=" G NOLIM
"RTN","GMTSUP",137,0)
 S CREC=^GMT(142.1,GMTINX,0),SBS=GMTSEGI(GMTINX) D CMPLIM^GMTSADH2
"RTN","GMTSUP",138,0)
 I $D(DIROUT) S GMTSQIT="" Q
"RTN","GMTSUP",139,0)
NOLIM ; No limits
"RTN","GMTSUP",140,0)
 S GMTSEGN=GMTSEGI(GMTINX)-1,(GMTSY,GMTSQIT)=1,GMTSLPG=0
"RTN","GMTSUP",141,0)
 Q
"RTN","GMTSUP",142,0)
 ;
"RTN","GMTSUP",143,0)
EVAL ; Evaluate input to determine quit or continue
"RTN","GMTSUP",144,0)
 Q:'$D(X)
"RTN","GMTSUP",145,0)
 S:$D(GMTSEXIT) GMTSEXIT=$G(X)
"RTN","GMTSUP",146,0)
 S:$D(DTOUT) DIROUT=1 I $S(X="^^":1,GMTSLPG:1,$D(DIROUT):1,X="^":1,1:0) S GMTSQIT=""
"RTN","GMTSUP",147,0)
 I +$G(GMPSAP),(X="^") S GMDUOUT=1
"RTN","GMTSUP",148,0)
 Q
"RTN","GMTSUP",149,0)
MUL(X) ; Multiple Components in Type
"RTN","GMTSUP",150,0)
 N GMTSF,GMTSL S GMTSF=$O(GMTSEG(0)),GMTSL=$O(GMTSEG(" "),-1)
"RTN","GMTSUP",151,0)
 Q:+GMTSF=+GMTSL 0  Q 1
"RTN","GMTSUP",152,0)
FST(X) ; First Component in Type
"RTN","GMTSUP",153,0)
 N GMTSF,GMTSL S GMTSF=$O(GMTSEG(0)),GMTSL=+($G(GMTSEGN))
"RTN","GMTSUP",154,0)
 Q:+GMTSF=+GMTSL 1  Q 0
"RTN","GMTSUP",155,0)
CHDR(X) ; Component Header
"RTN","GMTSUP",156,0)
 N GMTSN,GMTSH,GMTSL,GMTS S GMTSN=$$CNAM,GMTSH=$G(GMTSEGH)
"RTN","GMTSUP",157,0)
 S GMTSL=$G(GMTSEGL),GMTS="",$P(GMTS,"-",79-$L(GMTSH_GMTSL)/2)=""
"RTN","GMTSUP",158,0)
 S X=GMTS_" "_GMTSH_GMTSL_" "_GMTS Q:'$D(GMTSOBJ) X
"RTN","GMTSUP",159,0)
 S:$L(GMTSH)&($D(GMTSOBJ("COMPONENT HEADER"))) GMTSN=GMTSH
"RTN","GMTSUP",160,0)
 S:$L(GMTSL)&($L(GMTSN))&($D(GMTSOBJ("LIMITS"))) GMTSN=GMTSN_" "_GMTSL
"RTN","GMTSUP",161,0)
 S X=GMTSN Q X
"RTN","GMTSUP",162,0)
CNAM(X) ; Component Name
"RTN","GMTSUP",163,0)
 N GMTSH S GMTSH=+($P($G(GMTSEG(+($G(GMTSEGN)))),"^",2))
"RTN","GMTSUP",164,0)
 S X=$P($G(^GMT(142.1,+GMTSH,0)),"^",1) Q X
"RTN","GMTSXAW3")
0^2^B39972203
"RTN","GMTSXAW3",1,0)
GMTSXAW3 ; SLC/KER - List Parameters/Allowable 2           ; 08/27/2002
"RTN","GMTSXAW3",2,0)
 ;;2.7;Health Summary;**47,49,56**;Oct 20, 1995
"RTN","GMTSXAW3",3,0)
 ;
"RTN","GMTSXAW3",4,0)
 ; External References in GMTSXAW2
"RTN","GMTSXAW3",5,0)
 ;   DBIA  2051  FIND^DIC
"RTN","GMTSXAW3",6,0)
 ;   DBIA  2051  $$FIND1^DIC
"RTN","GMTSXAW3",7,0)
 ;   DBIA  2051  LIST^DIC
"RTN","GMTSXAW3",8,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSXAW3",9,0)
 ;   DBIA  2541  $$KSP^XUPARAM
"RTN","GMTSXAW3",10,0)
 ;   DBIA  2324  $$CLNAME^USRLM
"RTN","GMTSXAW3",11,0)
 ;   DBIA  2324  WHATIS^USRLM
"RTN","GMTSXAW3",12,0)
 ;   DBIA 10112  $$PRIM^VASITE
"RTN","GMTSXAW3",13,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSXAW3",14,0)
 ;   DBIA  2054  $$CREF^DILF
"RTN","GMTSXAW3",15,0)
 ;   DBIA 10076  ^XUSEC("GMTSMGR")
"RTN","GMTSXAW3",16,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMTSXAW3",17,0)
 ;   DBIA 10114  ^%ZIS(1,
"RTN","GMTSXAW3",18,0)
 ;   DBIA 10048  ^DIC(9.4,
"RTN","GMTSXAW3",19,0)
 ;   DBIA 10090  ^DIC(4,
"RTN","GMTSXAW3",20,0)
 ;   DBIA 10093  ^DIC(49,
"RTN","GMTSXAW3",21,0)
 ;   DBIA  3005  ^OR(100.21
"RTN","GMTSXAW3",22,0)
 ;   DBIA  1996  ^DIC(4.2,
"RTN","GMTSXAW3",23,0)
 ;   DBIA  2324  ^USR(8930.3,
"RTN","GMTSXAW3",24,0)
 ;   DBIA  2324  ^USR(8930,
"RTN","GMTSXAW3",25,0)
 ;   DBIA  3407  ^XTV(8989.51,     Pending
"RTN","GMTSXAW3",26,0)
 ;   DBIA  3408  ^XTV(8989.518,    Pending
"RTN","GMTSXAW3",27,0)
 ;   DBIA 10103  $$DT^XLFDT
"RTN","GMTSXAW3",28,0)
 ;            
"RTN","GMTSXAW3",29,0)
 Q
"RTN","GMTSXAW3",30,0)
SET(GMTSA,GMTSP,GMTSN,GMTSALW,GMTSI,GMTSF) ; Create Array Entry
"RTN","GMTSXAW3",31,0)
 ;            
"RTN","GMTSXAW3",32,0)
 ;   GMTSA    Identifier    SYS          USR           Req
"RTN","GMTSXAW3",33,0)
 ;   GMTSP    Variable Ptr  97;DIC(4.2,  1118;VA(200,  Req
"RTN","GMTSXAW3",34,0)
 ;   GMTSN    Name          System       User          Req
"RTN","GMTSXAW3",35,0)
 ;  .GMTSALW  Array Root    GMTSALW(                   Req
"RTN","GMTSXAW3",36,0)
 ;   GMTSI    Array IEN     GMTSALW(GMTSI)             Req
"RTN","GMTSXAW3",37,0)
 ;   GMTSF    Value Flag    Include only values        Opt
"RTN","GMTSXAW3",38,0)
 ;            
"RTN","GMTSXAW3",39,0)
 Q:'$L(GMTSA)  Q:'$L(GMTSP)  Q:'$L(GMTSN)  I +($G(GMTSF))>0 D  Q
"RTN","GMTSXAW3",40,0)
 . N GMTSD S GMTSD=";"_$P(GMTSP,";",2)
"RTN","GMTSXAW3",41,0)
 . S GMTSALW("CHK",GMTSP,GMTSD)="" Q:+($G(GMTSF))>1
"RTN","GMTSXAW3",42,0)
 . S GMTSALW("ENT",GMTSA,GMTSP)=""
"RTN","GMTSXAW3",43,0)
 . S GMTSALW("VAL",GMTSP,GMTSA)=""
"RTN","GMTSXAW3",44,0)
 N GMTS2 S GMTSI=+($G(GMTSI)) Q:GMTSI=0
"RTN","GMTSXAW3",45,0)
 S GMTS2=$O(GMTSALW(GMTSI,GMTSA," "),-1)+1
"RTN","GMTSXAW3",46,0)
 S GMTSALW(GMTSI,GMTSA,GMTS2)=GMTSP_"^"_GMTSN
"RTN","GMTSXAW3",47,0)
 S GMTSALW(GMTSI,GMTSA,"VAL",GMTSP,GMTS2)=""
"RTN","GMTSXAW3",48,0)
 S GMTSALW("ENT",GMTSA,GMTSP,GMTSI,GMTS2)=""
"RTN","GMTSXAW3",49,0)
 S GMTSALW("VAL",GMTSP,GMTSI,GMTS2)=GMTSA
"RTN","GMTSXAW3",50,0)
 Q
"RTN","GMTSXAW3",51,0)
 ; Lookups
"RTN","GMTSXAW3",52,0)
LST(X,Y) ;   Default Entities    8989.513  Lookup    .01, .02
"RTN","GMTSXAW3",53,0)
 Q:+($G(X))'>0  N GMTSM,GMTSP S GMTSP=+($G(X)) Q:+($G(GMTSP))'>0
"RTN","GMTSXAW3",54,0)
 D LIST^DIC(8989.513,(","_+GMTSP_","),".01;.02","I","*",,,,,.Y,.GMTSM)
"RTN","GMTSXAW3",55,0)
 Q
"RTN","GMTSXAW3",56,0)
OTL(X,GMTSOTL) ;   OR Team List        100.21    Lookup    .01
"RTN","GMTSXAW3",57,0)
 N GMTSNM S GMTSNM=$G(X) Q:'$L($G(GMTSNM))  N GMTSM
"RTN","GMTSXAW3",58,0)
 D FIND^DIC(100.21,,".01",,GMTSNM,"*","C",,,"GMTSOTL","GMTSM")
"RTN","GMTSXAW3",59,0)
 Q
"RTN","GMTSXAW3",60,0)
UCL(X,GMTS) ;   User Classes        8930.3    Lookup    .01, .02, .03, .04
"RTN","GMTSXAW3",61,0)
 N USRT S X=+($G(X)) Q:X=0  D WHATIS^USRLM(X,"USRT")
"RTN","GMTSXAW3",62,0)
 N GMTSNM,GMTSCT,GMTSI,GMTSIEN,GMTSC,GMTSCLS,GMTSEFF,GMTSEXP,GMTSCLN,GMTSU,GMTSUN
"RTN","GMTSXAW3",63,0)
 S GMTSU=+($G(USRT(0))),GMTSUN=$P($G(USRT(0)),"^",2),GMTSC=$P($G(USRT(0)),"^",3)
"RTN","GMTSXAW3",64,0)
 S GMTSC=0,GMTSI="" F  S GMTSI=$O(USRT(GMTSI)) Q:GMTSI=""  D
"RTN","GMTSXAW3",65,0)
 . S GMTSIEN=$P($G(USRT(GMTSI)),"^",2) Q:+GMTSIEN=0  S GMTSCLS=$P($G(USRT(GMTSI)),"^",1),GMTSEFF=$P($G(USRT(GMTSI)),"^",4),GMTSEXP=$P($G(USRT(GMTSI)),"^",5),GMTSCLN=$P($G(USRT(GMTSI)),"^",3)
"RTN","GMTSXAW3",66,0)
 . S GMTSC=GMTSC+1,GMTS("ID",GMTSC,.01)=GMTSUN,GMTS("ID",GMTSC,.01,"E")=GMTSU,GMTS("ID",GMTSC,.02)=GMTSCLS,GMTS("ID",GMTSC,.03)=GMTSEFF,GMTS("ID",GMTSC,.04)=GMTSEXP,GMTS("ID",GMTSC,"IEN")=GMTSIEN
"RTN","GMTSXAW3",67,0)
 Q
"RTN","GMTSXAW3",68,0)
HSD(X) ;   HS Definition
"RTN","GMTSXAW3",69,0)
 S X=$$PDI("ORWRP HEALTH SUMMARY TYPE LIST") Q X
"RTN","GMTSXAW3",70,0)
SI(X) ;   System Infor        4.2       Lookup
"RTN","GMTSXAW3",71,0)
 Q $$FIND1^DIC(4.2,"","QX",$$KSP^XUPARAM("WHERE"))
"RTN","GMTSXAW3",72,0)
ABR(X) ;   Abbreviation        8989.518  .02
"RTN","GMTSXAW3",73,0)
 N GMTS S X=$G(X) Q:'$L(X) "XXX"
"RTN","GMTSXAW3",74,0)
 S:X[";" X=$P(X,";",2) S:X'["^" X="^"_X
"RTN","GMTSXAW3",75,0)
 S:$E(X,$L(X))'="("&(X["(")&(X'[",") X=X_"," S X=X_"0"
"RTN","GMTSXAW3",76,0)
 S GMTS=$$CREF^DILF(X) I X'=GMTS,GMTS["0" D  Q X
"RTN","GMTSXAW3",77,0)
 . S X=+($P($G(@GMTS),"^",2)) I +X'>0 S X="XXX" Q
"RTN","GMTSXAW3",78,0)
 . S X=$$UP^GMTSXA($$GET1^DIQ(8989.518,(X_","),.02))
"RTN","GMTSXAW3",79,0)
 . S:$L(X)'=3 X="XXX"
"RTN","GMTSXAW3",80,0)
 Q "XXX"
"RTN","GMTSXAW3",81,0)
ETI(X) ;   Entity IEN          8989.518  Lookup
"RTN","GMTSXAW3",82,0)
 Q:$L($G(X))'=3 0 N GMTSM
"RTN","GMTSXAW3",83,0)
 Q $$FIND1^DIC(8989.518,,"CO",$G(X),"C",,.GMTSM)
"RTN","GMTSXAW3",84,0)
EFN(X) ;   Entity File #       8989.518  .001
"RTN","GMTSXAW3",85,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.001)
"RTN","GMTSXAW3",86,0)
ENM(X) ;   Entity Name         8989.518  .01
"RTN","GMTSXAW3",87,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.01)
"RTN","GMTSXAW3",88,0)
EAB(X) ;   Entity Abbrv        8989.518  .02
"RTN","GMTSXAW3",89,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.02)
"RTN","GMTSXAW3",90,0)
EMC(X) ;   Entity Mix Case     8989.518  .03
"RTN","GMTSXAW3",91,0)
 Q $$GET1^DIQ(8989.518,(+($G(X))_","),.03)
"RTN","GMTSXAW3",92,0)
PDI(X) ;   Param Def IEN       8989.51    Lookup
"RTN","GMTSXAW3",93,0)
 S X=$G(X) Q:'$L(X) "" N DIC,DTOUT,DUOUT,Y,GMTSM
"RTN","GMTSXAW3",94,0)
 Q $$FIND1^DIC(8989.51,,"CO",$G(X),.GMTSM)
"RTN","GMTSXAW3",95,0)
PDN(X) ;   Param Def Name      8989.51   .01
"RTN","GMTSXAW3",96,0)
 Q $$GET1^DIQ(8989.51,(+($G(X))_","),.01)
"RTN","GMTSXAW3",97,0)
UVP(X) ;   User Var Ptr        200
"RTN","GMTSXAW3",98,0)
 N GMTS S GMTS=+($G(X)) Q:'$L($$UNM(GMTS)) ""
"RTN","GMTSXAW3",99,0)
 S X=GMTS_";VA(200," Q X
"RTN","GMTSXAW3",100,0)
USR(X) ;   Get User            200       Lookup
"RTN","GMTSXAW3",101,0)
 N DIC,Y,DTOUT,DUOUT,GMTSN,GMTSP S GMTSN=$$UNM(+($G(DUZ))),GMTSP=$G(X),DIC="^VA(200,",DIC(0)="AEMQ",DIC("A")="Select User:  "
"RTN","GMTSXAW3",102,0)
 S:$L(GMTSP) DIC("A")=GMTSP S DIC("S")="I $$ACTIVE^XUSER(+($G(Y)))>0" S:$L(GMTSN) DIC("B")=GMTSN D ^DIC S X=+Y
"RTN","GMTSXAW3",103,0)
 Q X
"RTN","GMTSXAW3",104,0)
UNM(X) ;   User Name           200       .01
"RTN","GMTSXAW3",105,0)
 Q $$GET1^DIQ(200,(+($G(X))_","),.01)
"RTN","GMTSXAW3",106,0)
MGR(X) ;   HS Manager
"RTN","GMTSXAW3",107,0)
 Q $S(((+($G(DUZ))>0)&($D(^XUSEC("GMTSMGR",+($G(DUZ)))))):1,1:0)
"RTN","GMTSXAW3",108,0)
PK(X) ;   Package             9.4       Lookup
"RTN","GMTSXAW3",109,0)
 S X=$G(X) Q:'$L(X) "" N DIC,DTOUT,DUOUT,Y,GMTSM
"RTN","GMTSXAW3",110,0)
 Q $$FIND1^DIC(9.4,,"CO",$G(X),"C",,.GMTSM)
"RTN","GMTSXAW3",111,0)
DEV(X) ;   Device Name         3.5       .01
"RTN","GMTSXAW3",112,0)
 Q $$GET1^DIQ(3.5,(+($G(X))_","),.01)
"RTN","GMTSXAW3",113,0)
DIV(X) ;   Division Name       4         .01
"RTN","GMTSXAW3",114,0)
 Q $$GET1^DIQ(4,(+($G(X))_","),.01)
"RTN","GMTSXAW3",115,0)
UD(X) ;   User's Division     200.02    .01
"RTN","GMTSXAW3",116,0)
 N GMTSINST,GMTSDIV,GMTSUSR,GMTSMD,GMTSKS,GMTSKSM,GMTSDS,GMTSDSM,GMTSDZ,GMTSDZM
"RTN","GMTSXAW3",117,0)
 S:+($G(DT))'>0 DT=$$DT^XLFDT S U="^",GMTSUSR=+($G(X))
"RTN","GMTSXAW3",118,0)
 S GMTSKS=$$KSP^XUPARAM("INST"),GMTSKSM=$$GET1^DIQ(4,(+GMTSKS_","),5,"I"),GMTSKSM=$S(GMTSKSM["Y":1,1:0)
"RTN","GMTSXAW3",119,0)
 S GMTSDS=$O(^VA(200,GMTSUSR,2,"AX1",1,0)),GMTSDSM=$$GET1^DIQ(4,(+GMTSDS_","),5,"I"),GMTSDSM=$S(GMTSDSM["Y":1,1:0)
"RTN","GMTSXAW3",120,0)
 S GMTSDZ=+($G(DUZ(2))),GMTSDZM=$$GET1^DIQ(4,(+GMTSDZ_","),5,"I"),GMTSDZM=$S(GMTSDZM["Y":1,1:0)
"RTN","GMTSXAW3",121,0)
 S GMTSMD=GMTSDZM+GMTSDSM+GMTSKSM
"RTN","GMTSXAW3",122,0)
 ;     Not a Multi-Divisional Institution
"RTN","GMTSXAW3",123,0)
 I +GMTSMD'>0&(+GMTSKS>0) S X=+GMTSKS_";DIC(4," Q X
"RTN","GMTSXAW3",124,0)
 ;     Login Division          
"RTN","GMTSXAW3",125,0)
 I +GMTSDZ>0,$D(^DIC(4,+GMTSDZ)) S X=+GMTSDZ_";DIC(4," Q X
"RTN","GMTSXAW3",126,0)
 ;     No Login Division
"RTN","GMTSXAW3",127,0)
 I +GMTSDS'>0&(+GMTSDZ'>0)&(+GMTSKS>0) S X=+GMTSKS_";DIC(4," Q X
"RTN","GMTSXAW3",128,0)
 ;     Default Division
"RTN","GMTSXAW3",129,0)
 I +GMTSDS>0 S X=+GMTSDS_";DIC(4," Q X
"RTN","GMTSXAW3",130,0)
 Q ""
"RTN","GMTSXAW3",131,0)
DD(X) ;   Division (Default)  200.02    .01
"RTN","GMTSXAW3",132,0)
 Q:+($G(X))'>0 ""  K ^TMP("DILIST",$J) D DS(+($G(X)),.Y)
"RTN","GMTSXAW3",133,0)
 N GMTSDD,GMTSI S GMTSDD=""
"RTN","GMTSXAW3",134,0)
 S GMTSI=0 F  S GMTSI=$O(^TMP("DILIST",$J,"ID",GMTSI)) Q:+GMTSI=0!($L(GMTSDD))  D
"RTN","GMTSXAW3",135,0)
 . I $G(^TMP("DILIST",$J,"ID",GMTSI,1))=1 S GMTSDD=$G(^TMP("DILIST",$J,"ID",GMTSI,.01))
"RTN","GMTSXAW3",136,0)
 K ^TMP("DILIST",$J) S X=$G(GMTSDD) Q X
"RTN","GMTSXAW3",137,0)
DS(X,Y) ;   Divisions           200.02    Lookup    .01, 1
"RTN","GMTSXAW3",138,0)
 Q:+($G(X))'>0  N GMTSM,GMTSP S GMTSP=+($G(X)) Q:+($G(GMTSP))'>0
"RTN","GMTSXAW3",139,0)
 D LIST^DIC(200.02,(","_+GMTSP_","),".01;1","I","*",,,,,.Y,.GMTSM)
"RTN","GMTSXAW3",140,0)
 Q
"RTN","GMTSXAW3",141,0)
DE(X) ;   Division (Primary)  40.8      Lookup    .07
"RTN","GMTSXAW3",142,0)
 N PRIM S PRIM=$$PRIM^VASITE S X=$$GET1^DIQ(40.8,(PRIM_","),.07,"I")
"RTN","GMTSXAW3",143,0)
 Q X
"RTN","GMTSXAW3",144,0)
SYS(X) ;   System Name         4.2       .01
"RTN","GMTSXAW3",145,0)
 Q $$GET1^DIQ(4.2,(+($G(X))_","),.01)
"RTN","GMTSXAW3",146,0)
PKG(X) ;   Package Name        9.4       .01
"RTN","GMTSXAW3",147,0)
 Q $$GET1^DIQ(9.4,(+($G(X))_","),.01)
"RTN","GMTSXAW3",148,0)
SRI(X) ;   Service (I)         200        29
"RTN","GMTSXAW3",149,0)
 Q $$GET1^DIQ(200,(+($G(X))_","),29,"I")
"RTN","GMTSXAW3",150,0)
SRV(X) ;   Service Name        49        .01
"RTN","GMTSXAW3",151,0)
 Q $$GET1^DIQ(49,(+($G(X))_","),.01)
"RTN","GMTSXAW3",152,0)
CLS(X) ;   User Class Name     8930      .01
"RTN","GMTSXAW3",153,0)
 Q $$UP^GMTSXA($$CLNAME^USRLM(+($G(X))))
"RTN","GMTSXAW3",154,0)
SYSV(X) ;   System Var Ptr
"RTN","GMTSXAW3",155,0)
 N GMTSYS S GMTSYS=$$KSP^XUPARAM("WHERE") I $L(GMTSYS) D  Q:'$L(GMTSYS) ""
"RTN","GMTSXAW3",156,0)
 . N DIC,DTOUT,DUOUT,X,Y S DIC="^DIC(4.2,",X=GMTSYS,DIC(0)="MXO"
"RTN","GMTSXAW3",157,0)
 . D ^DIC S GMTSYS=+Y S:GMTSYS'>0 GMTSYS="" S GMTSYS=$S(+GMTSYS>0:(GMTSYS_";"_$P(DIC,"^",2)),1:"")
"RTN","GMTSXAW3",158,0)
 S X=GMTSYS Q X
"RTN","GMTSXAW3",159,0)
USRV(X) ;   User Var Ptr
"RTN","GMTSXAW3",160,0)
 N GMTSU,GMTSUV S GMTSU=$G(X) I $L($$UNM(+($G(X)))) S X=+($G(X))_";VA(200," Q X
"RTN","GMTSXAW3",161,0)
 N DIC,DTOUT,DUOUT,X,Y S DIC="^VA(200,",X=GMTSU,DIC(0)="MXO" D ^DIC S GMTSU=+Y,GMTSUV=""
"RTN","GMTSXAW3",162,0)
 S:GMTSU'>0 GMTSUV="" S:GMTSU>0 GMTSUV=GMTSU_";"_$P(DIC,"^",2) S X=GMTSUV Q X
"RTN","GMTSXPD1")
0^50^B58717118
"RTN","GMTSXPD1",1,0)
GMTSXPD1 ; SLC/KER - Health Summary Dist (Component)     ; 08/27/2002
"RTN","GMTSXPD1",2,0)
 ;;2.7;Health Summary;**35,56**;Oct 20, 1995
"RTN","GMTSXPD1",3,0)
 ;
"RTN","GMTSXPD1",4,0)
 ; External References
"RTN","GMTSXPD1",5,0)
 ;   DBIA  1023  $$FIRSTUP^VAQUTL50
"RTN","GMTSXPD1",6,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSXPD1",7,0)
 ;   DBIA 10018  ^DIE  (file #142.1)
"RTN","GMTSXPD1",8,0)
 ;   DBIA 10013  IX^DIK
"RTN","GMTSXPD1",9,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSXPD1",10,0)
 ;   DBIA 10030  ^DD(
"RTN","GMTSXPD1",11,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","GMTSXPD1",12,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSXPD1",13,0)
 ;   DBIA  2056  $$GET1^DIQ (file 200)
"RTN","GMTSXPD1",14,0)
 ;   DBIA 10141  BMES^XPDUTL
"RTN","GMTSXPD1",15,0)
 ;   DBIA 10141  MES^XPDUTL
"RTN","GMTSXPD1",16,0)
 ;                     
"RTN","GMTSXPD1",17,0)
 Q
"RTN","GMTSXPD1",18,0)
ADD(GMTSINI) ; Add Health Summary Component
"RTN","GMTSXPD1",19,0)
 ;                 
"RTN","GMTSXPD1",20,0)
 ;  ADD(<array>)
"RTN","GMTSXPD1",21,0)
 ;     GMTSIEN   GMTSINI(0)     Internal Entry Number File 142.1
"RTN","GMTSXPD1",22,0)
 ;     GMTSNAME  GMTSINI(.01)   Component Name
"RTN","GMTSXPD1",23,0)
 ;     GMTSRTN   GMTSINI(1)     Display Routine
"RTN","GMTSXPD1",24,0)
 ;     GMTSEXTR  GMTSINI(1.1)   Extract Routine (m)
"RTN","GMTSXPD1",25,0)
 ;     GMTSTIML  GMTSINI(2)     Time Limits Applicable
"RTN","GMTSXPD1",26,0)
 ;     GMTSABBR  GMTSINI(3)     Abbreviation
"RTN","GMTSXPD1",27,0)
 ;     GMTSDESC  GMTSINI(3.5)   Description (m)
"RTN","GMTSXPD1",28,0)
 ;     GMTSOCCL  GMTSINI(4)     Occurrence Limits Applicable
"RTN","GMTSXPD1",29,0)
 ;     GMTSDAF   GMTSINI(5)     Disable Flag (null, T or P)
"RTN","GMTSXPD1",30,0)
 ;     GMTSSKEY  GMTSINI(6)     Security Key (Component Locking)
"RTN","GMTSXPD1",31,0)
 ;     GMTSSELF  GMTSINI(7)     Selection File (m)
"RTN","GMTSXPD1",32,0)
 ;     GMTSOOM   GMTSINI(8)     Out of Order Message
"RTN","GMTSXPD1",33,0)
 ;     GMTSDHDN  GMTSINI(9)     Default Header Name
"RTN","GMTSXPD1",34,0)
 ;     GMTSHOSL  GMTSINI(10)    Hospital Location Applicable
"RTN","GMTSXPD1",35,0)
 ;     GMTSICDT  GMTSINI(11)    ICD Text Applicable
"RTN","GMTSXPD1",36,0)
 ;     GMTSPROV  GMTSINI(12)    Provider Narrative Text Applicable
"RTN","GMTSXPD1",37,0)
 ;     GMTSPREF  GMTSINI(13)    Prefix
"RTN","GMTSXPD1",38,0)
 ;     GMTSCPTM  GMTSINI(14)    CPT Modifiers Applicable
"RTN","GMTSXPD1",39,0)
 ;                 
"RTN","GMTSXPD1",40,0)
 N GMTSENV S GMTSENV=$$ENV Q:'GMTSENV 0
"RTN","GMTSXPD1",41,0)
 N GMTSIEN,GMTSNAME,GMTSMNM,GMTSABBR,GMTSTAG,GMTSRTN,GMTSTIML,GMTSOCCL,GMTSSELF
"RTN","GMTSXPD1",42,0)
 N GMTSSKEY,GMTSDHDN,GMTSHOSL,GMTSICDT,GMTSPROV,GMTSDAF,GMTSOOM,GMTSINCL,GMTSPREF,GMTSCPTM
"RTN","GMTSXPD1",43,0)
 N DIE,DIK,DA,DR,DIC,DLAYGO,DINUM,X,Y,INCLUDE,GMTS,GMTSROUT,GMTSTAT
"RTN","GMTSXPD1",44,0)
 S GMTSNAME=$G(GMTSINI(.01)),GMTSMNM=$$FIRSTUP^VAQUTL50(GMTSNAME),GMTSIEN=+($G(GMTSINI(0))),GMTSRTN=$G(GMTSINI(1))
"RTN","GMTSXPD1",45,0)
 S GMTSTAG=$P(GMTSRTN,";",1),GMTSRTN=$P(GMTSRTN,";",2) S:$L(GMTSTAG)&('$L(GMTSRTN)) GMTSRTN=GMTSTAG,GMTSTAG=""
"RTN","GMTSXPD1",46,0)
 S GMTSROUT="",GMTSTAT=$D(^GMT(142.1,+GMTSIEN,0))
"RTN","GMTSXPD1",47,0)
 I '$L($G(GMTSNAME))!(+($G(GMTSIEN))'>0)!('$L($G(GMTSRTN))) Q 0
"RTN","GMTSXPD1",48,0)
 D INST S GMTS=+$O(^GMT(142.1,"B",GMTSNAME,0)) D:GMTS=GMTSIEN ALRDY I GMTS=GMTSIEN Q 0
"RTN","GMTSXPD1",49,0)
 S GMTSNAME=$$NAME^GMTSXPD2($G(GMTSNAME)) D:'$L($G(GMTSNAME)) NNAME Q:'$L(GMTSNAME) 0
"RTN","GMTSXPD1",50,0)
 S GMTSROUT=$$ROUT^GMTSXPD2((GMTSTAG_";"_GMTSRTN)) D:'$L($G(GMTSROUT)) NRTN Q:'$L(GMTSROUT) 0
"RTN","GMTSXPD1",51,0)
 S GMTSTIML=$$TIML^GMTSXPD2($G(GMTSINI(2))),GMTSABBR=$$ABBR^GMTSXPD2($G(GMTSINI(3)))
"RTN","GMTSXPD1",52,0)
 S GMTSOCCL=$$OCCL^GMTSXPD2($G(GMTSINI(4))),GMTSDAF=$$DAF^GMTSXPD2($G(GMTSINI(5)))
"RTN","GMTSXPD1",53,0)
 S GMTSSKEY=$$LOCK^GMTSXPD2($G(GMTSINI(6))),GMTSOOM=$$OOM^GMTSXPD2($G(GMTSINI(8)))
"RTN","GMTSXPD1",54,0)
 S GMTSDHDN=$$DHDN^GMTSXPD2($G(GMTSINI(9))),GMTSHOSL=$$HOSL^GMTSXPD2($G(GMTSINI(10)))
"RTN","GMTSXPD1",55,0)
 S GMTSICDT=$$ICDT^GMTSXPD2($G(GMTSINI(11))),GMTSPROV=$$PROV^GMTSXPD2($G(GMTSINI(12)))
"RTN","GMTSXPD1",56,0)
 S GMTSPREF=$$PREF^GMTSXPD2($G(GMTSINI(13))),GMTSCPTM=$$CPTM^GMTSXPD2($G(GMTSINI(14)))
"RTN","GMTSXPD1",57,0)
 S:$L(GMTSDAF)&('$L(GMTSOOM)) GMTSOOM="Component "_GMTSNAME_$S(GMTSDAF="T":" Temporarily",GMTSDAF="P":" Permanently",1:"")_" Disabled"
"RTN","GMTSXPD1",58,0)
 S DINUM=0,DIE="^GMT(142.1,",(DIC,DLAYGO)=142.1,DIC(0)="NXL",X=GMTSNAME S:'$D(^GMT(142.1,+($G(GMTSIEN)),0)) DINUM=+($G(GMTSIEN))
"RTN","GMTSXPD1",59,0)
 I +DINUM'>1 D EXIST Q 0
"RTN","GMTSXPD1",60,0)
 D ^DIC S DA=+($G(Y)) D:+($G(Y))'>0 FAILED Q:+($G(Y))'>0 0
"RTN","GMTSXPD1",61,0)
 S DR="1///^S X="""_$G(GMTSTAG)_"""_$C(59)_"""_$G(GMTSRTN)_""""
"RTN","GMTSXPD1",62,0)
 S:$L($G(GMTSTIML)) DR=DR_";2///"_GMTSTIML
"RTN","GMTSXPD1",63,0)
 S:$L($G(GMTSABBR)) DR=DR_";3///"_GMTSABBR S:$L($G(GMTSOCCL)) DR=DR_";4///"_GMTSOCCL
"RTN","GMTSXPD1",64,0)
 S:$L($G(GMTSDAF)) DR=DR_";5///"_GMTSDAF S:$L($G(GMTSSKEY)) DR=DR_";6///"_GMTSSKEY
"RTN","GMTSXPD1",65,0)
 S:$L($G(GMTSOOM)) DR=DR_";8///"_GMTSOOM S:$L($G(GMTSDHDN)) DR=DR_";9///"_GMTSDHDN
"RTN","GMTSXPD1",66,0)
 S:$L($G(GMTSHOSL)) DR=DR_";10///"_GMTSHOSL S:$L($G(GMTSICDT)) DR=DR_";11///"_GMTSICDT
"RTN","GMTSXPD1",67,0)
 S:$L($G(GMTSPROV)) DR=DR_";12///"_GMTSPROV S:$L($G(GMTSPREF)) DR=DR_";13///"_GMTSPREF
"RTN","GMTSXPD1",68,0)
 S:$L($G(GMTSCPTM)) DR=DR_";14///"_GMTSCPTM
"RTN","GMTSXPD1",69,0)
 S DIE="^GMT(142.1," D ^DIE D:$D(GMTSINI) DES(.GMTSINI),SEL(.GMTSINI),EXT(.GMTSINI)
"RTN","GMTSXPD1",70,0)
 S DIK="^GMT(142.1," D IX^DIK D:GMTSTAT&($D(^GMT(142.1,+($G(DA)),0))) SCESE D:'GMTSTAT&($D(^GMT(142.1,+($G(DA)),0))) SCESS
"RTN","GMTSXPD1",71,0)
 I $D(GMTSINI("PDX")) S GMTSNAME=$G(GMTSNAME),GMTSTIML=$G(GMTSTIML),GMTSOCCL=$G(GMTSOCCL) D PDX^GMTSXPD5(GMTSNAME,GMTSTIML,GMTSOCCL)
"RTN","GMTSXPD1",72,0)
 Q 1
"RTN","GMTSXPD1",73,0)
 ;
"RTN","GMTSXPD1",74,0)
DES(GMTSINI) ; Description
"RTN","GMTSXPD1",75,0)
 N GMTSD0,GMTSD1,GMTSN,GMTSD,GMTSDT,GMTSIEN S GMTSIEN=+($G(GMTSINI(0))),(GMTSD0,GMTSD1)=0,GMTSDT=$P($$NOW^XLFDT,".",1)
"RTN","GMTSXPD1",76,0)
 F  S GMTSD1=$O(GMTSINI(3.5,GMTSD1)) Q:+GMTSD1=0  S GMTSD0=GMTSD0+1
"RTN","GMTSXPD1",77,0)
 Q:+($G(GMTSD0))=0  S GMTSINI(3.5)=GMTSD0,GMTSD1=+($G(GMTSINI(3.5))),GMTSD0="^^"_GMTSD1_"^"_GMTSD1_"^"_GMTSDT_"^"
"RTN","GMTSXPD1",78,0)
 S GMTSN="^GMT(142.1,"_GMTSIEN_",3.5,0)",GMTSD=GMTSD0,@GMTSN=GMTSD,GMTSD1=0
"RTN","GMTSXPD1",79,0)
 F  S GMTSD1=$O(GMTSINI(3.5,GMTSD1)) Q:+GMTSD1=0  S GMTSN="^GMT(142.1,"_GMTSIEN_",3.5,"_GMTSD1_",0)",GMTSD=$G(GMTSINI(3.5,GMTSD1)),@GMTSN=GMTSD
"RTN","GMTSXPD1",80,0)
 Q
"RTN","GMTSXPD1",81,0)
SEL(GMTSINI) ; Selection Items
"RTN","GMTSXPD1",82,0)
 N GMTSD0,GMTSD1,GMTSN,GMTSF,GMTST,GMTSD,GMTSIEN S GMTSIEN=+($G(GMTSINI(0))),(GMTSD0,GMTSD1)=0
"RTN","GMTSXPD1",83,0)
 F  S GMTSD1=$O(GMTSINI(7,GMTSD1)) Q:+GMTSD1=0  D
"RTN","GMTSXPD1",84,0)
 . S GMTSD=$G(GMTSINI(7,GMTSD1)),GMTSF=+($P(GMTSD,"^",1)) Q:+GMTSF=0  Q:'$D(^DD(+GMTSF))  S GMTSD0=GMTSD0+1
"RTN","GMTSXPD1",85,0)
 Q:+($G(GMTSD0))=0  S GMTSINI(7)=GMTSD0,GMTSD1=+($G(GMTSINI(7)))
"RTN","GMTSXPD1",86,0)
 S GMTSD0="^142.17P^"_GMTSD1_"^"_GMTSD1,GMTSN="^GMT(142.1,"_GMTSIEN_",1,0)",GMTSD=GMTSD0,@GMTSN=GMTSD
"RTN","GMTSXPD1",87,0)
 S GMTSD1=0 F  S GMTSD1=$O(GMTSINI(7,GMTSD1)) Q:+GMTSD1=0  D
"RTN","GMTSXPD1",88,0)
 . S GMTSN="^GMT(142.1,"_GMTSIEN_",1,"_GMTSD1_",0)"
"RTN","GMTSXPD1",89,0)
 . S GMTSD=$G(GMTSINI(7,GMTSD1)),GMTSF=+($P(GMTSD,"^",1)) Q:+GMTSF=0  Q:'$D(^DD(GMTSF))
"RTN","GMTSXPD1",90,0)
 . S GMTST=+($P(GMTSD,"^",2)) S:GMTST=0 GMTST=""
"RTN","GMTSXPD1",91,0)
 . S GMTSD=GMTSF S:GMTST>0 $P(GMTSD,"^",2)=GMTST S @GMTSN=GMTSD
"RTN","GMTSXPD1",92,0)
 . S GMTSN="^GMT(142.1,"_GMTSIEN_",1,""B"","_GMTSF_","_GMTSD1_")",GMTSD="",@GMTSN=GMTSD
"RTN","GMTSXPD1",93,0)
 Q
"RTN","GMTSXPD1",94,0)
EXT(GMTSINI) ; Extract Routines
"RTN","GMTSXPD1",95,0)
 N GMTSD0,GMTSD1,GMTSN,GMTSF,GMTST,GMTSD,GMTSIEN S GMTSIEN=+($G(GMTSINI(0))),(GMTSD0,GMTSD1)=0
"RTN","GMTSXPD1",96,0)
 F  S GMTSD1=$O(GMTSINI(1.1,GMTSD1)) Q:+GMTSD1=0  D
"RTN","GMTSXPD1",97,0)
 . S GMTSD=$G(GMTSINI(1.1,GMTSD1)) Q:'$L(GMTSD)  S GMTSTAG=$P(GMTSD,";",1),GMTSRTN=$P(GMTSD,";",2)
"RTN","GMTSXPD1",98,0)
 . S:$L(GMTSTAG)&('$L(GMTSRTN)) GMTSRTN=GMTSTAG,GMTSTAG="" Q:'$L(GMTSRTN)  S GMTSD0=GMTSD0+1
"RTN","GMTSXPD1",99,0)
 Q:+($G(GMTSD0))=0  S GMTSINI(1.1)=GMTSD0,GMTSD1=+($G(GMTSINI(1.1)))
"RTN","GMTSXPD1",100,0)
 S GMTSD0="^142.11^"_GMTSD1_"^"_GMTSD1,GMTSN="^GMT(142.1,"_GMTSIEN_",.1,0)",GMTSD=GMTSD0,@GMTSN=GMTSD
"RTN","GMTSXPD1",101,0)
 S (GMTSD0,GMTSD1)=0 F  S GMTSD1=$O(GMTSINI(1.1,GMTSD1)) Q:+GMTSD1=0  D
"RTN","GMTSXPD1",102,0)
 . S GMTSD=$G(GMTSINI(1.1,GMTSD1)) Q:'$L(GMTSD)  S GMTSTAG=$P(GMTSD,";",1),GMTSRTN=$P(GMTSD,";",2) S:$L(GMTSTAG)&('$L(GMTSRTN)) GMTSRTN=GMTSTAG,GMTSTAG="" Q:'$L(GMTSRTN)
"RTN","GMTSXPD1",103,0)
 . S GMTSD0=GMTSD0+1,GMTSN="^GMT(142.1,"_GMTSIEN_",.1,"_GMTSD0_",0)",GMTSD=$G(GMTSINI(1.1,GMTSD1)),@GMTSN=GMTSD
"RTN","GMTSXPD1",104,0)
 . S GMTSN="^GMT(142.1,"_GMTSIEN_",.1,""B"","""_GMTSD_""","_GMTSD0_")",GMTSD="",@GMTSN=GMTSD
"RTN","GMTSXPD1",105,0)
 Q
"RTN","GMTSXPD1",106,0)
 ;              
"RTN","GMTSXPD1",107,0)
 ; Messages
"RTN","GMTSXPD1",108,0)
INST ;   Installing Component
"RTN","GMTSXPD1",109,0)
 N GMTST S GMTST=" Filing """_$$UP(GMTSMNM)_""" component in Health Summary" D BM(GMTST) Q
"RTN","GMTSXPD1",110,0)
 ;   Reasons to Abort Install
"RTN","GMTSXPD1",111,0)
HSVNF ;     Health Summary Version not found
"RTN","GMTSXPD1",112,0)
 N GMTST S GMTST="   Health Summary Version 2.7 not found" D BM(GMTST) Q
"RTN","GMTSXPD1",113,0)
ALRDY ;     Component Already Installed
"RTN","GMTSXPD1",114,0)
 N GMTST S GMTST="   Component has already been installed" D M(GMTST) Q
"RTN","GMTSXPD1",115,0)
NNAME ;     No Name
"RTN","GMTSXPD1",116,0)
 N GMTST S GMTST="   No or invalid Health Summary Component name" D M(GMTST) D NOTI Q
"RTN","GMTSXPD1",117,0)
NRTN ;     No Routine
"RTN","GMTSXPD1",118,0)
 N GMTST S GMTST="   No or invalid Health Summary display routine" D M(GMTST) D NOTI Q
"RTN","GMTSXPD1",119,0)
FAILED ;     Failed Installation
"RTN","GMTSXPD1",120,0)
 N GMTST S GMTST="   Failed to install component" D M(GMTST) Q
"RTN","GMTSXPD1",121,0)
EXIST ;     DINUMed entry Exist
"RTN","GMTSXPD1",122,0)
 N GMTST S GMTST="   Can not add component, DINUM'ed entry already exist" D M(GMTST) Q
"RTN","GMTSXPD1",123,0)
NOTI ;     Not Installed
"RTN","GMTSXPD1",124,0)
 N GMTST S GMTST="   Could not install new component" D M(GMTST) Q
"RTN","GMTSXPD1",125,0)
 ;   Success
"RTN","GMTSXPD1",126,0)
SCESS ;     Successfully Installed
"RTN","GMTSXPD1",127,0)
 N GMTSD S GMTSD=0 D DISAB Q:+($G(GMTSD))
"RTN","GMTSXPD1",128,0)
 N GMTST S GMTST="   Successfully installed new component" D M(GMTST) Q
"RTN","GMTSXPD1",129,0)
SCESE ;     Successfully Edited
"RTN","GMTSXPD1",130,0)
 N GMTSD S GMTSD=0 D DISAB Q:+($G(GMTSD))
"RTN","GMTSXPD1",131,0)
 N GMTST S GMTST="   Successfully edited/updated component" D M(GMTST) Q
"RTN","GMTSXPD1",132,0)
DISAB ;     Disabled Component
"RTN","GMTSXPD1",133,0)
 Q:+($G(GMTSIEN))=0  Q:$P($G(^GMT(142.1,+($G(GMTSIEN)),0)),"^",6)=""
"RTN","GMTSXPD1",134,0)
 N GMTSF,GMTSM,GMTST S GMTSF=$P($G(^GMT(142.1,+($G(GMTSIEN)),0)),"^",6)
"RTN","GMTSXPD1",135,0)
 S GMTSF=$S(GMTSF="T":"Temporarily",GMTSF="P":"Permanently",1:"") Q:'$L(GMTSF)
"RTN","GMTSXPD1",136,0)
 S GMTSD=1,GMTST="",GMTSM=$P($G(^GMT(142.1,+($G(GMTSIEN)),0)),"^",8)
"RTN","GMTSXPD1",137,0)
 S GMTST="   Componet """_$$UP(GMTSMNM)_""" is installed, but "_GMTSF_" disabled" D M(GMTST)
"RTN","GMTSXPD1",138,0)
 S GMTST="" S:$L(GMTSM) GMTST="   Out of order message:  """_GMTSM_"""" D:$L(GMTST) M(GMTST)
"RTN","GMTSXPD1",139,0)
 Q
"RTN","GMTSXPD1",140,0)
 ;                 
"RTN","GMTSXPD1",141,0)
 ; Other
"RTN","GMTSXPD1",142,0)
ENV(X) ;   Environment check
"RTN","GMTSXPD1",143,0)
 D HOME^%ZIS I '$D(^VA(200,+($G(DUZ)),0)) D BM("    User (DUZ) not defined"),M("") Q 0
"RTN","GMTSXPD1",144,0)
 I '$L($P($G(^VA(200,+($G(DUZ)),0)),"^",1)) D BM("    Invalid User defined (DUZ)"),M("") Q 0
"RTN","GMTSXPD1",145,0)
 Q 1
"RTN","GMTSXPD1",146,0)
BM(X) ;   Blank Line with Message
"RTN","GMTSXPD1",147,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSXPD1",148,0)
M(X) ;   Message
"RTN","GMTSXPD1",149,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSXPD1",150,0)
UP(X) ;   Uppercase
"RTN","GMTSXPD1",151,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXPD2")
0^51^B3819654
"RTN","GMTSXPD2",1,0)
GMTSXPD2 ; SLC/KER - Health Summary Dist (Component)     ; 08/27/2002
"RTN","GMTSXPD2",2,0)
 ;;2.7;Health Summary;**35,56**;Oct 20, 1995
"RTN","GMTSXPD2",3,0)
 ;
"RTN","GMTSXPD2",4,0)
 ; External References
"RTN","GMTSXPD2",5,0)
 ;   DBIA  1340  ^DIC(19.1,
"RTN","GMTSXPD2",6,0)
 ;   DBIA  2052  $$GET1^DID
"RTN","GMTSXPD2",7,0)
 ;                    
"RTN","GMTSXPD2",8,0)
 Q
"RTN","GMTSXPD2",9,0)
 ; Check Input
"RTN","GMTSXPD2",10,0)
NAME(X) ;   Check Name (required)
"RTN","GMTSXPD2",11,0)
 S X=$G(X) K:X[""""!($A(X)=45) X Q:'$D(X) ""
"RTN","GMTSXPD2",12,0)
 I $D(X) K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"RTN","GMTSXPD2",13,0)
 I $L($G(X)),'$D(^GMT(142.1,+($G(Y)),0)) D
"RTN","GMTSXPD2",14,0)
 . K:$D(^GMT(142.1,"B",X)) X Q:'$D(X)  Q:+($G(Y))'>0  I $P($G(^GMT(142.1,+($G(Y)),0)),"^",1)'=$G(X) K X
"RTN","GMTSXPD2",15,0)
 S X=$G(X) Q X
"RTN","GMTSXPD2",16,0)
ROUT(X) ;   Check Routine (required)
"RTN","GMTSXPD2",17,0)
 S X=$G(X) K:X[""""!($A(X)=45) X Q:'$D(X) ""
"RTN","GMTSXPD2",18,0)
 K:$L(X)>17!($L(X)<3)!'(X?1U1.7UN1";"1U1.7UN) X Q:'$D(X) ""
"RTN","GMTSXPD2",19,0)
 I @("$L($T("_$P(X,";")_"^"_$P(X,";",2)_"))'>0") K X
"RTN","GMTSXPD2",20,0)
 S X=$G(X) Q X
"RTN","GMTSXPD2",21,0)
TIML(X) ;   Check Time Limits
"RTN","GMTSXPD2",22,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",23,0)
ABBR(X) ;   Check Abbreviation
"RTN","GMTSXPD2",24,0)
 S X=$G(X) S:X[""""!($A(X)=45) X="" S:$L(X)>4!($L(X)<2)!'(X?2.4UN) X="" Q X
"RTN","GMTSXPD2",25,0)
OCCL(X) ;   Check Occurrence Limits
"RTN","GMTSXPD2",26,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",27,0)
LOCK(X) ;   Check Lock
"RTN","GMTSXPD2",28,0)
 S X=$G(X) S:X[""""!($A(X)=45) X="" S:$L(X)>30!($L(X)<1) X="" Q:'$L(X) ""
"RTN","GMTSXPD2",29,0)
 S:'$D(^DIC(19.1,"B",X)) X="" Q X
"RTN","GMTSXPD2",30,0)
DHDN(X) ;   Check Default Header Name
"RTN","GMTSXPD2",31,0)
 S X=$G(X) S:X[""""!($A(X)=45) X="" S:$L(X)>20!($L(X)<2) X="" Q X
"RTN","GMTSXPD2",32,0)
HOSL(X) ;   Check Hospital Locaiton Flag
"RTN","GMTSXPD2",33,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",34,0)
ICDT(X) ;   Check ICD Text Flag
"RTN","GMTSXPD2",35,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",36,0)
PROV(X) ;   Check Provider Narrative Flag
"RTN","GMTSXPD2",37,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",38,0)
PREF(X) ;   Check Prefix
"RTN","GMTSXPD2",39,0)
 S X=$G(X) N GMTS S GMTS=$$GET1^DID(142.1,13,,"LABEL") Q:'$L(GMTS) ""
"RTN","GMTSXPD2",40,0)
 S:X[""""!($A(X)=45) X="" S:$L(X)>4!($L(X)<2) X="" S:$E(X,1,2)'?2U X="" S:X'?1U.UN X="" Q X
"RTN","GMTSXPD2",41,0)
CPTM(X) ;   Check CPT Modifier Flag
"RTN","GMTSXPD2",42,0)
 S X=$G(X) N GMTS S GMTS=$$GET1^DID(142.1,14,,"LABEL") Q:'$L(GMTS) ""
"RTN","GMTSXPD2",43,0)
 Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",44,0)
DAF(X) ;   Check Disable Flag
"RTN","GMTSXPD2",45,0)
 S X=$G(X) Q:X="T" "T" Q:X="T" "P" Q ""
"RTN","GMTSXPD2",46,0)
OOM(X) ;   Check Out of Order Message
"RTN","GMTSXPD2",47,0)
 S X=$G(X) Q:$L(X)<3 "" Q:$L(X)>78 "" Q X
"RTN","GMTSXPD2",48,0)
 Q
"RTN","GMTSXPD4")
0^52^B44851483
"RTN","GMTSXPD4",1,0)
GMTSXPD4 ; SLC/KER - Health Summary Dist (Re-Build)      ; 08/27/2002
"RTN","GMTSXPD4",2,0)
 ;;2.7;Health Summary;**35,56**;Oct 20, 1995
"RTN","GMTSXPD4",3,0)
 ;
"RTN","GMTSXPD4",4,0)
 ; External References
"RTN","GMTSXPD4",5,0)
 ;   DBIA 10013  ^DIK  (file #142)
"RTN","GMTSXPD4",6,0)
 ;   DBIA  2052  $$GET1^DID
"RTN","GMTSXPD4",7,0)
 ;   DBIA 10018  ^DIE  (file #142)
"RTN","GMTSXPD4",8,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","GMTSXPD4",9,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSXPD4",10,0)
 ;   DBIA  2056  $$GET1^DIQ (file 200)
"RTN","GMTSXPD4",11,0)
 ;   DBIA 10141  BMES^XPDUTL
"RTN","GMTSXPD4",12,0)
 ;   DBIA 10141  MES^XPDUTL
"RTN","GMTSXPD4",13,0)
 ;                    
"RTN","GMTSXPD4",14,0)
 Q
"RTN","GMTSXPD4",15,0)
 ; Re-Build Ad Hoc Health Summary Type
"RTN","GMTSXPD4",16,0)
 ;                      
"RTN","GMTSXPD4",17,0)
 ;   Input Variables   INCLUDE
"RTN","GMTSXPD4",18,0)
 ;                        0    exclude DISABLED components
"RTN","GMTSXPD4",19,0)
 ;                        1    include DISABLED components
"RTN","GMTSXPD4",20,0)
 ;                      
"RTN","GMTSXPD4",21,0)
IN ;   Re-Build w/INCLUDE
"RTN","GMTSXPD4",22,0)
 N INCLUDE S INCLUDE=1 D RB Q
"RTN","GMTSXPD4",23,0)
EX ;   Re-Build w/EXCLUDE
"RTN","GMTSXPD4",24,0)
 N INCLUDE S INCLUDE=0 D RB Q
"RTN","GMTSXPD4",25,0)
RB ;   Re-Build (main)
"RTN","GMTSXPD4",26,0)
 N GMTSENV S GMTSENV=$$ENV Q:'GMTSENV
"RTN","GMTSXPD4",27,0)
 N DA,DIC,DIE,DIK,DLAYGO,DR,GMTSC,GMTSDA,GMTSDIAB,GMTSE,GMTSEG,GMTSEL
"RTN","GMTSXPD4",28,0)
 N GMTSELC,GMTSELT,GMTSEQ,GMTSI,GMTSICD,GMTSIFN,GMTSISEQ,GMTSITEM
"RTN","GMTSXPD4",29,0)
 N GMTSJ,GMTSL,GMTSLOC,GMTSNAR,GMTSCPT,GMTSNEW,GMTSNM,GMTSOCC,GMTSOK
"RTN","GMTSXPD4",30,0)
 N GMTSORD,GMTSQ,GMTST1,GMTST2,GMTST3,GMTSTIM,GMTSTYP,X,Y
"RTN","GMTSXPD4",31,0)
 S GMTSOK=0,GMTSE=59,GMTSC=0 D BM(" Ad Hoc Summary") S GMTST1="   Gathering Ad Hoc Summary information",GMTST2="   Purging old Ad Hoc Summary",GMTST3="   Rebuilding Ad Hoc Summary"
"RTN","GMTSXPD4",32,0)
 D M($G(GMTST1)) N GMTSNEW,GMTSTYP,DLAYGO S DLAYGO=142
"RTN","GMTSXPD4",33,0)
 S DIC=142,DIC(0)="LXF",X="GMTS HS ADHOC OPTION" S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSXPD4",34,0)
 I +Y'>0 D BM("** GMTS AD HOC OPTION Summary Type is missing **") Q
"RTN","GMTSXPD4",35,0)
 D GA,RN D:+($G(GMTSOK))>0 BM(" Ad Hoc Health Summary successfully rebuilt")
"RTN","GMTSXPD4",36,0)
 D:+($G(GMTSOK))'>0 BM(" Failed to successfully rebuild the Ad Hoc Health Summary")
"RTN","GMTSXPD4",37,0)
 Q
"RTN","GMTSXPD4",38,0)
GA ;     Gather Information
"RTN","GMTSXPD4",39,0)
 N GMTSL,GMTSQ,GMTSC,GMTSE
"RTN","GMTSXPD4",40,0)
 S GMTSE=59,GMTSC=0,GMTSL=$L($G(GMTST1))
"RTN","GMTSXPD4",41,0)
 S (GMTSIFN,GMTSTYP)=+Y,GMTSNEW=+$P(Y,"^",3)
"RTN","GMTSXPD4",42,0)
 S:'$D(^GMT(142,GMTSIFN,1,0)) ^(0)="^142.01IA^0^0"
"RTN","GMTSXPD4",43,0)
 S GMTSC=0,GMTSNM="" F GMTSC=1:1 S GMTSNM=$O(^GMT(142.1,"B",GMTSNM)) Q:GMTSNM']""  S GMTSC=+($G(GMTSC))+1
"RTN","GMTSXPD4",44,0)
 S GMTSC=GMTSC-1,GMTSQ=GMTSC\(GMTSE-$L(GMTST1))
"RTN","GMTSXPD4",45,0)
 S GMTSC=0,GMTSNM="" F GMTSC=1:1 S GMTSNM=$O(^GMT(142.1,"B",GMTSNM)) Q:GMTSNM']""  D
"RTN","GMTSXPD4",46,0)
 . S GMTSJ=$O(^(GMTSNM,0)) Q:GMTSJ'>0  D LA
"RTN","GMTSXPD4",47,0)
 . Q:$D(GMTSQT)  Q:+GMTSQ'>0
"RTN","GMTSXPD4",48,0)
 . S GMTSC=GMTSC+1 S:GMTSC#GMTSQ=0 GMTSL=GMTSL+1 Q:GMTSL>GMTSE
"RTN","GMTSXPD4",49,0)
 . W:GMTSC#GMTSQ=0 "."
"RTN","GMTSXPD4",50,0)
 I '$D(GMTSQT),GMTSL'>GMTSE F  S GMTSL=GMTSL+1 Q:GMTSL>GMTSE  W "."
"RTN","GMTSXPD4",51,0)
 W:'$D(GMTSQT) ?GMTSE," < done >"
"RTN","GMTSXPD4",52,0)
 S GMTSI=0 I 'GMTSNEW D PA
"RTN","GMTSXPD4",53,0)
 Q
"RTN","GMTSXPD4",54,0)
PA ;     Purge Ad Hoc Health Summary
"RTN","GMTSXPD4",55,0)
 N GMTSI,GMTSL,GMTSQ,GMTSC,GMTSE S GMTSE=59,GMTSL=$L($G(GMTST2)) D M($G(GMTST2))
"RTN","GMTSXPD4",56,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,GMTSIFN,1,GMTSI)) Q:GMTSI'>0  S GMTSC=+($G(GMTSC))+1
"RTN","GMTSXPD4",57,0)
 S GMTSC=GMTSC-1,GMTSQ=GMTSC\(GMTSE-$L(GMTST1))
"RTN","GMTSXPD4",58,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,GMTSIFN,1,GMTSI)) Q:GMTSI'>0  D
"RTN","GMTSXPD4",59,0)
 . N DA,DIK S U="^",DA(1)=GMTSIFN,DA=GMTSI,DIK="^GMT(142,"_GMTSIFN_",1," D ^DIK
"RTN","GMTSXPD4",60,0)
 . Q:$D(GMTSQT)  Q:+GMTSQ'>0
"RTN","GMTSXPD4",61,0)
 . S GMTSC=GMTSC+1 S:GMTSC#GMTSQ=0 GMTSL=GMTSL+1 Q:GMTSL>GMTSE
"RTN","GMTSXPD4",62,0)
 . W:GMTSC#GMTSQ=0 "."
"RTN","GMTSXPD4",63,0)
 I '$D(GMTSQT),GMTSL'>GMTSE F  S GMTSL=GMTSL+1 Q:GMTSL>GMTSE  W "."
"RTN","GMTSXPD4",64,0)
 W:'$D(GMTSQT) ?GMTSE," < done >"
"RTN","GMTSXPD4",65,0)
 Q
"RTN","GMTSXPD4",66,0)
RN ;     Renumber - Resets ^GMT(142,GMTSIFN,1,
"RTN","GMTSXPD4",67,0)
 N DA,DR,DIE,GMTSEQ,GMTSL
"RTN","GMTSXPD4",68,0)
 N GMTSL,GMTSQ,GMTSC,GMTSE S GMTSE=59,GMTSL=$L($G(GMTST3)) D M($G(GMTST3))
"RTN","GMTSXPD4",69,0)
 S (GMTSEQ,GMTSC)=0 F  S GMTSEQ=$O(GMTSEG(GMTSEQ)) Q:GMTSEQ'>0  S GMTSC=+($G(GMTSC))+1
"RTN","GMTSXPD4",70,0)
 S GMTSC=GMTSC-1,GMTSQ=GMTSC\(GMTSE-$L(GMTST3))
"RTN","GMTSXPD4",71,0)
 S (GMTSEQ,GMTSC)=0 F  S GMTSEQ=$O(GMTSEG(GMTSEQ)) Q:GMTSEQ'>0  D
"RTN","GMTSXPD4",72,0)
 . K DA S DIE="^GMT(142,"_GMTSIFN_",1,",DA(1)=GMTSIFN D AC
"RTN","GMTSXPD4",73,0)
 . Q:$D(GMTSQT)  Q:+GMTSQ'>0
"RTN","GMTSXPD4",74,0)
 . S GMTSC=GMTSC+1 S:GMTSC#GMTSQ=0 GMTSL=GMTSL+1 Q:GMTSL>GMTSE
"RTN","GMTSXPD4",75,0)
 . W:GMTSC#GMTSQ=0 "."
"RTN","GMTSXPD4",76,0)
 I '$D(GMTSQT),GMTSL'>GMTSE F  S GMTSL=GMTSL+1 Q:GMTSL>GMTSE  W "."
"RTN","GMTSXPD4",77,0)
 W:'$D(GMTSQT) ?GMTSE," < done >" S GMTSOK=1
"RTN","GMTSXPD4",78,0)
 Q
"RTN","GMTSXPD4",79,0)
LA ;     Load Array GMTSEG(#)
"RTN","GMTSXPD4",80,0)
 N GMTSOCC,GMTSTIM,GMTSORD,GMTSLOC,GMTSICD,GMTSNAR,GMTSCPT
"RTN","GMTSXPD4",81,0)
 Q:'$D(^GMT(142.1,GMTSJ,0))
"RTN","GMTSXPD4",82,0)
 S GMTSORD=$O(^GMT(142,"AE",GMTSJ,GMTSTYP,0))
"RTN","GMTSXPD4",83,0)
 I GMTSORD>0 D
"RTN","GMTSXPD4",84,0)
 . S GMTSOCC=$S($P(^GMT(142.1,GMTSJ,0),"^",5)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",3),1:"")
"RTN","GMTSXPD4",85,0)
 . S GMTSTIM=$S($P(^GMT(142.1,GMTSJ,0),"^",3)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",4),1:"")
"RTN","GMTSXPD4",86,0)
 . S GMTSLOC=$S($P(^GMT(142.1,GMTSJ,0),"^",10)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",6),1:"")
"RTN","GMTSXPD4",87,0)
 . S GMTSICD=$S($P(^GMT(142.1,GMTSJ,0),"^",11)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",7),1:"")
"RTN","GMTSXPD4",88,0)
 . S GMTSNAR=$S($P(^GMT(142.1,GMTSJ,0),"^",12)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",8),1:"")
"RTN","GMTSXPD4",89,0)
 . S GMTSCPT=$S($P(^GMT(142.1,GMTSJ,0),"^",14)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",9),1:"")
"RTN","GMTSXPD4",90,0)
 E  D
"RTN","GMTSXPD4",91,0)
 . S GMTSOCC=$S($P(^GMT(142.1,GMTSJ,0),"^",5)="Y":10,1:"")
"RTN","GMTSXPD4",92,0)
 . S GMTSTIM=$S($P(^GMT(142.1,GMTSJ,0),"^",3)="Y":"1Y",1:"")
"RTN","GMTSXPD4",93,0)
 . S GMTSLOC=$S($P(^GMT(142.1,GMTSJ,0),"^",10)="Y":"Y",1:"")
"RTN","GMTSXPD4",94,0)
 . S GMTSICD=$S($P(^GMT(142.1,GMTSJ,0),"^",11)="Y":"L",1:"")
"RTN","GMTSXPD4",95,0)
 . S GMTSNAR=$S($P(^GMT(142.1,GMTSJ,0),"^",12)="Y":"Y",1:"")
"RTN","GMTSXPD4",96,0)
 . S GMTSCPT=$S($P(^GMT(142.1,GMTSJ,0),"^",12)="Y":"Y",1:"")
"RTN","GMTSXPD4",97,0)
 ; Defaults for CPT Modifiers
"RTN","GMTSXPD4",98,0)
 S:$P(^GMT(142.1,GMTSJ,0),"^",14)="Y"&(GMTSCPT="") GMTSCPT="Y"
"RTN","GMTSXPD4",99,0)
 S:$$GET1^DID(142.1,14,,"LABEL")="" GMTSCPT=""
"RTN","GMTSXPD4",100,0)
 D SG
"RTN","GMTSXPD4",101,0)
 Q
"RTN","GMTSXPD4",102,0)
SG ;       Set GMTSEG(#)        Component
"RTN","GMTSXPD4",103,0)
 ;         Disabled
"RTN","GMTSXPD4",104,0)
 N GMTSDIAB S GMTSDIAB=$S($P(^GMT(142.1,GMTSJ,0),"^",6)="P":1,$P(^(0),"^",6)="T":1,1:0) I (INCLUDE=0),(GMTSDIAB=1) Q
"RTN","GMTSXPD4",105,0)
 ;         Include
"RTN","GMTSXPD4",106,0)
 S GMTSEG(GMTSC)=(5*GMTSC)_"^"_GMTSJ_"^"_GMTSOCC_"^"_GMTSTIM_"^^"_GMTSLOC_"^"_GMTSICD_"^"_GMTSNAR_"^"_GMTSCPT I GMTSORD>0 D SL
"RTN","GMTSXPD4",107,0)
 Q
"RTN","GMTSXPD4",108,0)
SL ;       Set GMTSEG(#,#)      Selection item
"RTN","GMTSXPD4",109,0)
 N GMTSELT,GMTSITEM
"RTN","GMTSXPD4",110,0)
 S GMTSELT=0 F  S GMTSELT=$O(^GMT(142,GMTSTYP,1,+GMTSORD,1,GMTSELT)) Q:GMTSELT'>0  D
"RTN","GMTSXPD4",111,0)
 . S GMTSITEM=^(GMTSELT,0) S GMTSEG(GMTSC,GMTSELT)=GMTSITEM
"RTN","GMTSXPD4",112,0)
 Q
"RTN","GMTSXPD4",113,0)
AC ;     Add Components to Ad Hoc Summary
"RTN","GMTSXPD4",114,0)
 N GMTSISEQ,DA,DIE,DR,GMTSELC,GMTSDA,GMTSEL
"RTN","GMTSXPD4",115,0)
 S (GMTSISEQ,DA)=GMTSEQ*5,DIE="^GMT(142,"_GMTSIFN_",1,",DA(1)=GMTSIFN
"RTN","GMTSXPD4",116,0)
 S DR=".01///"_DA
"RTN","GMTSXPD4",117,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",2)) DR=DR_";1///"_$P(GMTSEG(GMTSEQ),"^",2)
"RTN","GMTSXPD4",118,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",3)) DR=DR_";2///"_$P(GMTSEG(GMTSEQ),"^",3)
"RTN","GMTSXPD4",119,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",4)) DR=DR_";3///"_$P(GMTSEG(GMTSEQ),"^",4)
"RTN","GMTSXPD4",120,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",5)) DR=DR_";5///"_$P(GMTSEG(GMTSEQ),"^",5)
"RTN","GMTSXPD4",121,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",6)) DR=DR_";6///"_$P(GMTSEG(GMTSEQ),"^",6)
"RTN","GMTSXPD4",122,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",7)) DR=DR_";7///"_$P(GMTSEG(GMTSEQ),"^",7)
"RTN","GMTSXPD4",123,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",8)) DR=DR_";8///"_$P(GMTSEG(GMTSEQ),"^",8)
"RTN","GMTSXPD4",124,0)
 S:$L($P($G(GMTSEG(GMTSEQ)),"^",9))>0&($L($$GET1^DID(142.1,14,,"LABEL"))>0) DR=DR_";9///"_$P(GMTSEG(GMTSEQ),"^",9)
"RTN","GMTSXPD4",125,0)
 D ^DIE S (GMTSELC,GMTSEL)=0 F  S GMTSEL=$O(GMTSEG(GMTSEQ,GMTSEL)) Q:'GMTSEL  D AS
"RTN","GMTSXPD4",126,0)
 I GMTSELC>0 S:'$D(^GMT(142,GMTSIFN,1,GMTSISEQ,1,0)) ^(0)="^142.14V^"_GMTSDA_"^"_GMTSELC
"RTN","GMTSXPD4",127,0)
 Q
"RTN","GMTSXPD4",128,0)
AS ;     Add Selection Items to Ad Hoc Summary
"RTN","GMTSXPD4",129,0)
 N DIE,DA,DR
"RTN","GMTSXPD4",130,0)
 S:'$D(^GMT(142,GMTSIFN,1,GMTSISEQ,1,0)) ^(0)="^142.14V^^"
"RTN","GMTSXPD4",131,0)
 S DIE="^GMT(142,"_GMTSIFN_",1,"_GMTSISEQ_",1,"
"RTN","GMTSXPD4",132,0)
 S DA(2)=GMTSIFN,DA(1)=GMTSISEQ,DA=GMTSEL
"RTN","GMTSXPD4",133,0)
 S DR=".01////"_"^S X=GMTSEG(GMTSEQ,GMTSEL)" D ^DIE
"RTN","GMTSXPD4",134,0)
 S GMTSDA=DA,GMTSELC=GMTSELC+1
"RTN","GMTSXPD4",135,0)
 Q
"RTN","GMTSXPD4",136,0)
 ;                      
"RTN","GMTSXPD4",137,0)
 ; Misc
"RTN","GMTSXPD4",138,0)
ENV(X) ;   Environment check
"RTN","GMTSXPD4",139,0)
 D HOME^%ZIS I +($G(DUZ))=0 D BM("    User (DUZ) not defined"),M(" ") Q 0
"RTN","GMTSXPD4",140,0)
 I '$L($$GET1^DIQ(200,(+($G(DUZ))_","),.01)) D BM("    Invalid User defined (DUZ)"),M(" ") Q 0
"RTN","GMTSXPD4",141,0)
 Q 1
"RTN","GMTSXPD4",142,0)
BM(X) ;   Blank Line with Message
"RTN","GMTSXPD4",143,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSXPD4",144,0)
M(X) ;   Message
"RTN","GMTSXPD4",145,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSXPD4",146,0)
UP(X) ;   Uppercase
"RTN","GMTSXPD4",147,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXPD5")
0^53^B5380825
"RTN","GMTSXPD5",1,0)
GMTSXPD5 ; SLC/KER - Health Summary Dist (PDX)           ; 08/27/2002
"RTN","GMTSXPD5",2,0)
 ;;2.7;Health Summary;**35,56**;Oct 20, 1995
"RTN","GMTSXPD5",3,0)
 ;
"RTN","GMTSXPD5",4,0)
 ; External References
"RTN","GMTSXPD5",5,0)
 ;   DBIA  1023  $$FIRSTUP^VAQUTL50
"RTN","GMTSXPD5",6,0)
 ;   DBIA  1023  $$ADDSEG^VAQUTL50
"RTN","GMTSXPD5",7,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","GMTSXPD5",8,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSXPD5",9,0)
 ;   DBIA  2056  $$GET1^DIQ (file 200)
"RTN","GMTSXPD5",10,0)
 ;   DBIA 10141  BMES^XPDUTL
"RTN","GMTSXPD5",11,0)
 ;   DBIA 10141  MES^XPDUTL
"RTN","GMTSXPD5",12,0)
 ;                     
"RTN","GMTSXPD5",13,0)
 Q
"RTN","GMTSXPD5",14,0)
PDX(GMTSCOMP,GMTSTIM,GMTSOCC) ; Install PDX Data Segment
"RTN","GMTSXPD5",15,0)
 ;                    
"RTN","GMTSXPD5",16,0)
 ;  PDX( )
"RTN","GMTSXPD5",17,0)
 ;          GMTSCOMP   Component Name (.01 of 142.1)
"RTN","GMTSXPD5",18,0)
 ;          GMTSTIM    Time Limits Applicable
"RTN","GMTSXPD5",19,0)
 ;          GMTSOCC    Occurrence Limits Applicable
"RTN","GMTSXPD5",20,0)
 ;               
"RTN","GMTSXPD5",21,0)
 N GMTSENV S GMTSENV=$$ENV Q:'GMTSENV  N GMTSNAME,GMTSERR,GMTS Q:'$L(GMTSCOMP)
"RTN","GMTSXPD5",22,0)
 S (GMTS,GMTSERR)="",GMTSTIM=$G(GMTSTIM),GMTSOCC=$G(GMTSOCC),GMTSNAME=$$FIRSTUP^VAQUTL50(GMTSCOMP)
"RTN","GMTSXPD5",23,0)
 D INSP S GMTS=+$O(^GMT(142.1,"B",GMTSCOMP,0)) I ('GMTS) D NOPDX Q
"RTN","GMTSXPD5",24,0)
 S GMTSERR=$$ADDSEG^VAQUTL50(GMTS,GMTSTIM,GMTSOCC)
"RTN","GMTSXPD5",25,0)
 I (GMTSERR<0) D PDXER Q
"RTN","GMTSXPD5",26,0)
 D PDXOK Q
"RTN","GMTSXPD5",27,0)
 ;                    
"RTN","GMTSXPD5",28,0)
 ; PDX Messages
"RTN","GMTSXPD5",29,0)
INSP ;   Installing PDX Segment
"RTN","GMTSXPD5",30,0)
 N GMTST
"RTN","GMTSXPD5",31,0)
 S GMTST=" Adding """_$$UP(GMTSNAME)_""" component to the PDX package" D BM(GMTST) Q
"RTN","GMTSXPD5",32,0)
NOPDX ;   No PDX Segment Installed
"RTN","GMTSXPD5",33,0)
 N GMTST
"RTN","GMTSXPD5",34,0)
 S GMTST="   Component not found in Health Summary" D M(GMTST)
"RTN","GMTSXPD5",35,0)
 S GMTST="   and not added to PDX package" D M(GMTST),M("") Q
"RTN","GMTSXPD5",36,0)
PDXER ;   Error filing PDX Segment
"RTN","GMTSXPD5",37,0)
 N GMTST
"RTN","GMTSXPD5",38,0)
 S GMTST=$P($G(GMTSERR),"^",2) Q:'$L(GMTST)
"RTN","GMTSXPD5",39,0)
 S GMTST="   "_GMTST D M(GMTST),M("") Q
"RTN","GMTSXPD5",40,0)
PDXOK ;   PDX Segment filled ok
"RTN","GMTSXPD5",41,0)
 N GMTST
"RTN","GMTSXPD5",42,0)
 S GMTST="   Component successfully added" D M(GMTST),M("") Q
"RTN","GMTSXPD5",43,0)
 ;                    
"RTN","GMTSXPD5",44,0)
 ; Misc
"RTN","GMTSXPD5",45,0)
ENV(X) ;   Environment check
"RTN","GMTSXPD5",46,0)
 D HOME^%ZIS I +($G(DUZ))=0 D BM("    User (DUZ) not defined"),M(" ") Q 0
"RTN","GMTSXPD5",47,0)
 I '$L($$GET1^DIQ(200,(+($G(DUZ))_","),.01)) D BM("    Invalid User defined (DUZ)"),M(" ") Q 0
"RTN","GMTSXPD5",48,0)
 Q 1
"RTN","GMTSXPD5",49,0)
BM(X) ;   Blank Line with Message
"RTN","GMTSXPD5",50,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSXPD5",51,0)
M(X) ;   Message
"RTN","GMTSXPD5",52,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSXPD5",53,0)
UP(X) ;   Uppercase
"RTN","GMTSXPD5",54,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXPS1")
0^54^B71832095
"RTN","GMTSXPS1",1,0)
GMTSXPS1 ; SLC/KER - Health Summary Status       ; 08/27/2002
"RTN","GMTSXPS1",2,0)
 ;;2.7;Health Summary;**35,34,46,56**;Oct 20, 1995
"RTN","GMTSXPS1",3,0)
 ;
"RTN","GMTSXPS1",4,0)
 ; External References
"RTN","GMTSXPS1",5,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","GMTSXPS1",6,0)
 ;   DBIA 10086  ^%ZIS
"RTN","GMTSXPS1",7,0)
 ;   DBIA 10089  ^%ZISC
"RTN","GMTSXPS1",8,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","GMTSXPS1",9,0)
 ;   DBIA 10096  ^%ZOSF("UCI")
"RTN","GMTSXPS1",10,0)
 ;   DBIA 10096  ^%ZOSF("PROD")
"RTN","GMTSXPS1",11,0)
 ;   DBIA 10096  ^%ZOSF("TEST")
"RTN","GMTSXPS1",12,0)
 ;   DBIA 10060  ^VA(200,
"RTN","GMTSXPS1",13,0)
 ;   DBIA  2056  $$GET1^DIQ (file #4 and 200)
"RTN","GMTSXPS1",14,0)
 ;   DBIA  1131  ^XMB("NETNAME")
"RTN","GMTSXPS1",15,0)
 ;   DBIA 10091  ^XMB(1,  file #4.3
"RTN","GMTSXPS1",16,0)
 ;   DBIA 10070  ^XMD
"RTN","GMTSXPS1",17,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSXPS1",18,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSXPS1",19,0)
 ;                    
"RTN","GMTSXPS1",20,0)
EN ; Display status only
"RTN","GMTSXPS1",21,0)
 N POP,GMTSENV S GMTSENV=$$ENV Q:'GMTSENV
"RTN","GMTSXPS1",22,0)
 K ^TMP($J,"GMTSINFO"),GMTSMAIL N X,Y,ZTSAVE D HDR
"RTN","GMTSXPS1",23,0)
 D:'$D(GMTSHORT) FI,INS^GMTSXPS2 D OUTPUT Q
"RTN","GMTSXPS1",24,0)
SEND ; Send status to G.GMTS@ISC-SLC.VA.GOV
"RTN","GMTSXPS1",25,0)
 N POP,GMTSENV S GMTSENV=$$ENV2 Q:'GMTSENV
"RTN","GMTSXPS1",26,0)
 S GMTSIENS=$G(GMTSIENS) S:$L(GMTSIENS) GMTSIENS=";"_GMTSIENS_";"
"RTN","GMTSXPS1",27,0)
 S GMTSENV=$$ROK("XMD") Q:'GMTSENV  K ^TMP($J,"GMTSINFO") N X,Y,ZTSAVE,ZTQUEUED,ZTREQ,ZTRTN
"RTN","GMTSXPS1",28,0)
 S:$D(GMTSHORT) ZTSAVE("GMTSHORT")="" S:$L($G(GMTSBLD)) ZTSAVE("GMTSBLD")="" S:$D(GMTSINST) ZTSAVE("GMTSINST")="" S:$L($G(GMTSIENS)) ZTSAVE("GMTSIENS")=""
"RTN","GMTSXPS1",29,0)
 S ZTRTN="SENDTO^GMTSXPS1",ZTDESC="Health Summary Status Report Msg",ZTIO="",ZTDTH=$H D ^%ZTLOAD,HOME^%ZIS K Y,ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN Q
"RTN","GMTSXPS1",30,0)
SENDTO ;   Send (Tasked)
"RTN","GMTSXPS1",31,0)
 N GMTSMAIL S GMTSMAIL="" S:$D(ZTQUEUED) ZTREQ="@"
"RTN","GMTSXPS1",32,0)
 N X,Y D HDR D:'$D(GMTSHORT) FI,INS^GMTSXPS2 D OUTPUT Q
"RTN","GMTSXPS1",33,0)
 ;                           
"RTN","GMTSXPS1",34,0)
HDR ; Report Header
"RTN","GMTSXPS1",35,0)
 N X D TITLE,ASOF D:$D(GMTSINST) MTBY D INAC,BLD D BL
"RTN","GMTSXPS1",36,0)
 Q
"RTN","GMTSXPS1",37,0)
TITLE ;   As of date
"RTN","GMTSXPS1",38,0)
 N X S X=$S($D(GMTSINST)&('$L($G(GMTSBLD))):"Health Summary Installation",$D(GMTSINST)&($L($G(GMTSBLD))):($G(GMTSBLD)_" Installation"),1:"Health Summary Status") D TT(X),BL Q
"RTN","GMTSXPS1",39,0)
ASOF ;   As of date
"RTN","GMTSXPS1",40,0)
 N X S X=$$NOW S:$L(X) X=$$TB($S($D(GMTSINST):"  Installed on:",1:"  As of:"))_X D:$L(X) TL(X) Q
"RTN","GMTSXPS1",41,0)
INAC ;   In Account
"RTN","GMTSXPS1",42,0)
 N X S X=$$UCI($$U) S:$L(X) X=$$TB("  Install Account:")_X D:$L(X) TL(X) Q
"RTN","GMTSXPS1",43,0)
MTBY ;   Maintained by
"RTN","GMTSXPS1",44,0)
 N X,Y S X=$$P,Y=$P(X,"^",2),X=$P(X,"^",1) S:$L(X) X=$$TB($S($D(GMTSINST):"  Installed by:",1:"  Maintained by:"))_X S:$L(X)&($L(Y)) X=X_"    "_Y D:$L(X) TL(X) Q
"RTN","GMTSXPS1",45,0)
BLD ;   Install Build
"RTN","GMTSXPS1",46,0)
 Q:$D(GMTSINST)&($L($G(GMTSBLD)))  N X S X=$G(GMTSBLD) Q:'$L(X)  S:$L(X) X=$$TB("  Build:")_X D:$L(X) TL(X) Q
"RTN","GMTSXPS1",47,0)
 ;                          
"RTN","GMTSXPS1",48,0)
FI ; Health Summary Files
"RTN","GMTSXPS1",49,0)
 Q:$D(GMTSHORT)
"RTN","GMTSXPS1",50,0)
 N X S X="",X=X_$J("",37-$L(X))_" Total",X=X_$J("",48-$L(X))_"Last" D TL(X)
"RTN","GMTSXPS1",51,0)
 S X="  File",X=X_$J("",37-$L(X))_"Entries",X=X_$J("",48-$L(X))_"Entry" D TL(X)
"RTN","GMTSXPS1",52,0)
 S X="",$P(X,"-",51)="-",X="  "_X D TL(X)
"RTN","GMTSXPS1",53,0)
 D F142,F1421,F14299,BL
"RTN","GMTSXPS1",54,0)
 Q
"RTN","GMTSXPS1",55,0)
F142 ;   Health Summary Type file 142
"RTN","GMTSXPS1",56,0)
 N X,GMTSA,GMTSAT,GMTSAP,GMTSL,GMTST,GMTSI S X="  Health Summary Type",(GMTSL,GMTST,GMTSI)=0
"RTN","GMTSXPS1",57,0)
 F  S GMTSI=$O(^GMT(142,GMTSI)) Q:+GMTSI=0  S GMTSL=GMTSI,GMTST=GMTST+1
"RTN","GMTSXPS1",58,0)
 S X=X_$J("",32-$L(X))_$J(GMTST,10),X=X_$J("",42-$L(X))_$J(GMTSL,10) D TL(X)
"RTN","GMTSXPS1",59,0)
 S GMTSA=$O(^GMT(142,"B","GMTS HS ADHOC OPTION",0))
"RTN","GMTSXPS1",60,0)
 S X="    Ad Hoc Health Summary Type",(GMTSL,GMTST,GMTSI)=0
"RTN","GMTSXPS1",61,0)
 I GMTSA=0 S X=X_$J("",37-$L(X))_"Missing Ad Hoc Health Summary Type" D TL(X) Q
"RTN","GMTSXPS1",62,0)
 F  S GMTSI=$O(^GMT(142,GMTSA,1,GMTSI)) Q:+GMTSI=0  S GMTSL=GMTSI,GMTST=GMTST+1
"RTN","GMTSXPS1",63,0)
 S X=X_$J("",32-$L(X))_$J(GMTST,10),X=X_$J("",42-$L(X))_$J(GMTSL,10) S:GMTSA'=12 X=X_$J("",57-$L(X))_"Invalid IEN" D TL(X)
"RTN","GMTSXPS1",64,0)
 Q
"RTN","GMTSXPS1",65,0)
F1421 ;   Health Summary Component file 142.1
"RTN","GMTSXPS1",66,0)
 N X,GMTSA,GMTSAC,GMTSAT,GMTSAP,GMTSL,GMTST,GMTSE,GMTSI
"RTN","GMTSXPS1",67,0)
 S X="  Health Summary Component",(GMTSAT,GMTSAP,GMTSAC,GMTSL,GMTST,GMTSI,GMTSE)=0
"RTN","GMTSXPS1",68,0)
 F  S GMTSI=$O(^GMT(142.1,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXPS1",69,0)
 . S GMTSL=GMTSI,GMTST=GMTST+1 S:GMTSI<501 GMTSE=GMTSE+1
"RTN","GMTSXPS1",70,0)
 . S GMTSA=$P($G(^GMT(142.1,GMTSI,0)),"^",6) S:GMTSA="T" GMTSAT=+($G(GMTSAT))+1 S:GMTSA="P" GMTSAP=+($G(GMTSAP))+1 S:GMTSA="" GMTSAC=+($G(GMTSAC))+1
"RTN","GMTSXPS1",71,0)
 S X=X_$J("",32-$L(X))_$J(GMTST,10),X=X_$J("",42-$L(X))_$J(GMTSL,10) D TL(X)
"RTN","GMTSXPS1",72,0)
 I +($G(GMTSE))>0 S X="    Exported",X=X_$J("",32-$L(X))_$J(GMTSE,10) D TL(X)
"RTN","GMTSXPS1",73,0)
 I +($G(GMTSAT))>0 S X="    Temporarily Disabled",X=X_$J("",32-$L(X))_$J(GMTSAT,10) D TL(X)
"RTN","GMTSXPS1",74,0)
 I +($G(GMTSAP))>0 S X="    Permanently Disabled",X=X_$J("",32-$L(X))_$J(GMTSAP,10) D TL(X)
"RTN","GMTSXPS1",75,0)
 I +($G(GMTSAC))>0&(+($G(GMTSAC))'=+($G(GMTST))) S X="    Active Components",X=X_$J("",32-$L(X))_$J(GMTSAC,10) D TL(X)
"RTN","GMTSXPS1",76,0)
 D STA^GMTSXPS3
"RTN","GMTSXPS1",77,0)
 Q
"RTN","GMTSXPS1",78,0)
F14299 ;   Health Summary Parameter file 142.9
"RTN","GMTSXPS1",79,0)
 N X,GMTSA,GMTSL,GMTST,GMTSI S X="  Health Summary Parameters",(GMTSL,GMTST,GMTSI)=0
"RTN","GMTSXPS1",80,0)
 F  S GMTSI=$O(^GMT(142.99,GMTSI)) Q:+GMTSI=0  S GMTSL=GMTSI,GMTST=GMTST+1
"RTN","GMTSXPS1",81,0)
 S X=X_$J("",32-$L(X))_$J(GMTST,10),X=X_$J("",42-$L(X))_$J(GMTSL,10) D TL(X)
"RTN","GMTSXPS1",82,0)
 Q
"RTN","GMTSXPS1",83,0)
 ;                            
"RTN","GMTSXPS1",84,0)
 ; Retrieve Data
"RTN","GMTSXPS1",85,0)
U(X) ;   UCI where Health Summary is installed
"RTN","GMTSXPS1",86,0)
 N GMTSU,GMTSP,GMTST S GMTST=$G(X) X ^%ZOSF("UCI") S GMTSU=Y
"RTN","GMTSXPS1",87,0)
 S:Y=^%ZOSF("PROD") GMTSP=" (Production)" S:Y'=^%ZOSF("PROD") GMTSP=" (Test)" S:GMTSU["DEM" GMTSP=" (Demo)"
"RTN","GMTSXPS1",88,0)
 S X="",$P(X,"^",1)=GMTSU,$P(X,"^",2)=GMTSP Q X
"RTN","GMTSXPS1",89,0)
UCI(X) ;   UCI Format
"RTN","GMTSXPS1",90,0)
 S X=$G(X) N GMTSA,GMTST S GMTSA=$P(X,"^",1),GMTST=$P(X,"^",2) S:$L(GMTST) GMTST=$$MX($$TRIM($$PA(GMTST)))
"RTN","GMTSXPS1",91,0)
 S:$L($P(GMTSA,",",1))=3&($L($P(GMTSA,",",2))=3) GMTSA="["_GMTSA_"]" S:$L(GMTSA)&($L(GMTST)) GMTST="("_GMTST_")"
"RTN","GMTSXPS1",92,0)
 S X="" S:$L(GMTSA) X=GMTSA S:$L(X)&($L(GMTST)) X=X_"  "_GMTST S:'$L(X)&($L(GMTST)) X=GMTST
"RTN","GMTSXPS1",93,0)
 Q X
"RTN","GMTSXPS1",94,0)
P(X) ;   Person
"RTN","GMTSXPS1",95,0)
 S X=+($G(DUZ)) Q:'$L($P($G(^VA(200,+($G(X)),0)),"^",1)) "UNKNOWN^"
"RTN","GMTSXPS1",96,0)
 N GMTSDUZ,GMTSPH S GMTSDUZ=+($G(DUZ))
"RTN","GMTSXPS1",97,0)
 S GMTSPH=$P($G(^VA(200,GMTSDUZ,.13)),"^",2) S:GMTSPH="" GMTSPH=$P($G(^VA(200,GMTSDUZ,.13)),"^",1) S:GMTSPH="" GMTSPH=$P($G(^VA(200,GMTSDUZ,.13)),"^",3) S:GMTSPH="" GMTSPH=$P($G(^VA(200,GMTSDUZ,.13)),"^",4)
"RTN","GMTSXPS1",98,0)
 S GMTSDUZ=$P(^VA(200,GMTSDUZ,0),"^",1),X=GMTSDUZ_"^"_GMTSPH Q X
"RTN","GMTSXPS1",99,0)
INST(X) ;   Institution
"RTN","GMTSXPS1",100,0)
 S X=$G(^XMB("NETNAME")) I $L(X) S:X[".VA.GOV" X=$P(X,".VA.GOV",1) S:X["." X=$P(X,".",$L(X,".")) Q X
"RTN","GMTSXPS1",101,0)
 S X=$P($G(^XMB(1,1,"XUS")),"^",17) I +X>0 S X=$$GET1^DIQ(4,+X,.01,"E") Q:$L(X) X
"RTN","GMTSXPS1",102,0)
 S X="" Q X
"RTN","GMTSXPS1",103,0)
 ;                     
"RTN","GMTSXPS1",104,0)
OUTPUT ; Show global array (display or mail)
"RTN","GMTSXPS1",105,0)
 D:$D(GMTSMAIL) MAIL,CLR D:'$D(GMTSMAIL) DSP,CLR Q
"RTN","GMTSXPS1",106,0)
DISPLAY ;   Display global array
"RTN","GMTSXPS1",107,0)
 N GMTSI S GMTSI=0 F  S GMTSI=$O(^TMP($J,"GMTSINFO",GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXPS1",108,0)
 . W !,^TMP($J,"GMTSINFO",GMTSI)
"RTN","GMTSXPS1",109,0)
 Q
"RTN","GMTSXPS1",110,0)
MAIL ;   Mail global array in message
"RTN","GMTSXPS1",111,0)
 N DIFROM S U="^",XMSUB="Health Summary Info"
"RTN","GMTSXPS1",112,0)
 S:$D(GMTSINST)&($L($G(GMTSBLD))) XMSUB="Health Summary "_GMTSBLD_" Install"
"RTN","GMTSXPS1",113,0)
 S XMY("G.GMTS@ISC-SLC.VA.GOV")=""
"RTN","GMTSXPS1",114,0)
 S XMTEXT="^TMP($J,""GMTSINFO"",",XMDUZ=.5 D ^XMD
"RTN","GMTSXPS1",115,0)
 K ^TMP($J,"GMTSINFO"),%Z,XCNP,XMSCR,XMDUZ,XMY("G.GMTS@ISC-SLC.VA.GOV"),XMZ,XMSUB,XMY,XMTEXT,XMDUZ Q
"RTN","GMTSXPS1",116,0)
 Q
"RTN","GMTSXPS1",117,0)
 ;                            
"RTN","GMTSXPS1",118,0)
 ; Temporary Global
"RTN","GMTSXPS1",119,0)
BL ;   Blank Line
"RTN","GMTSXPS1",120,0)
 N GMTSNX S GMTSNX=+($$NX),^TMP($J,"GMTSINFO",GMTSNX)="" Q
"RTN","GMTSXPS1",121,0)
TT(X) ;   Title Line
"RTN","GMTSXPS1",122,0)
 Q:'$L($G(X))  D TL(X) N GMTSBK S GMTSBK="===============================================================================",GMTSBK=$E(GMTSBK,1,$L($G(X))) D:$L(GMTSBK) TL(GMTSBK) Q
"RTN","GMTSXPS1",123,0)
TL(X) ;   Text Line
"RTN","GMTSXPS1",124,0)
 N GMTSNX S GMTSNX=+($$NX),^TMP($J,"GMTSINFO",GMTSNX)=$G(X) Q
"RTN","GMTSXPS1",125,0)
BK1 ;   Break Line
"RTN","GMTSXPS1",126,0)
 N GMTSNX S GMTSNX=+($$NX),^TMP($J,"GMTSINFO",GMTSNX)="-------------------------------------------------------------------------------" Q
"RTN","GMTSXPS1",127,0)
NX(X) ;   Next Line #
"RTN","GMTSXPS1",128,0)
 S (X,^TMP($J,"GMTSINFO",0))=+($G(^TMP($J,"GMTSINFO",0)))+1 Q X
"RTN","GMTSXPS1",129,0)
ST ;   Show ^TMP($J,"GMTSINFO")
"RTN","GMTSXPS1",130,0)
 N GMTSNN,GMTSNC S GMTSNN="^TMP("_$J_",""GMTSINFO"")",GMTSNC="^TMP("_$J_",""GMTSINFO"","
"RTN","GMTSXPS1",131,0)
 F  S GMTSNN=$Q(@GMTSNN) Q:GMTSNN=""!(GMTSNN'[GMTSNC)  W:GMTSNN'[",0)" !,@GMTSNN
"RTN","GMTSXPS1",132,0)
 Q
"RTN","GMTSXPS1",133,0)
 ;                            
"RTN","GMTSXPS1",134,0)
DSP ; Display ^TMP($J,"GMTSINFO")
"RTN","GMTSXPS1",135,0)
 D DEV Q
"RTN","GMTSXPS1",136,0)
DEV ;   Select a device
"RTN","GMTSXPS1",137,0)
 N %,%ZIS,IOP,ZTRTN,ZTSAVE,ZTDESC,ZTDTH,ZTIO,ZTSK
"RTN","GMTSXPS1",138,0)
 S ZTRTN="DSPI^GMTSXPS1",ZTDESC="printing Health Summary install information"
"RTN","GMTSXPS1",139,0)
 S ZTIO=ION,ZTDTH=$H,%ZIS="PQ",ZTSAVE("^TMP($J,""GMTSINFO"",")=""
"RTN","GMTSXPS1",140,0)
 D ^%ZIS Q:POP  S ZTIO=ION I $D(IO("Q")) D QUE,^%ZISC Q
"RTN","GMTSXPS1",141,0)
 D NOQUE Q
"RTN","GMTSXPS1",142,0)
NOQUE ;   Do not que task
"RTN","GMTSXPS1",143,0)
 W @IOF W:IOST["P-" !,"< Not queued, printing Health Summary Info >",! H 2 U:IOST["P-" IO D @ZTRTN,^%ZISC Q
"RTN","GMTSXPS1",144,0)
QUE ;   Task queued to print user defaults
"RTN","GMTSXPS1",145,0)
 K IO("Q") D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued",1:"Request Cancelled"),! H 2 Q
"RTN","GMTSXPS1",146,0)
 Q
"RTN","GMTSXPS1",147,0)
DSPI ;   Display installation information
"RTN","GMTSXPS1",148,0)
 I '$D(ZTQUEUED),$G(IOST)'["P-" I '$D(^TMP($J,"GMTSINFO")) W !,"Health Summary Installation not found"
"RTN","GMTSXPS1",149,0)
 I IOST["P-" U IO
"RTN","GMTSXPS1",150,0)
 G:'$D(^TMP($J,"GMTSINFO")) DSPQ
"RTN","GMTSXPS1",151,0)
 N GMTSCONT,GMTSI,GMTSLC,GMTSEOP S GMTSCONT="",(GMTSLC,GMTSI)=0,GMTSEOP=+($G(IOSL)) S:GMTSEOP=0 GMTSEOP=24
"RTN","GMTSXPS1",152,0)
 F  S GMTSI=$O(^TMP($J,"GMTSINFO",GMTSI)) Q:+GMTSI=0!(GMTSCONT["^")  D
"RTN","GMTSXPS1",153,0)
 . W !,^TMP($J,"GMTSINFO",GMTSI) D LF Q:GMTSCONT["^"
"RTN","GMTSXPS1",154,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","GMTSXPS1",155,0)
 W:$G(IOST)["P-" @IOF
"RTN","GMTSXPS1",156,0)
DSPQ ;   Quit Display
"RTN","GMTSXPS1",157,0)
 Q
"RTN","GMTSXPS1",158,0)
LF ;   Line Feed
"RTN","GMTSXPS1",159,0)
 S GMTSLC=GMTSLC+1 D:IOST["P-"&(GMTSLC>(GMTSEOP-7)) CONT D:IOST'["P-"&(GMTSLC>(GMTSEOP-4)) CONT
"RTN","GMTSXPS1",160,0)
 Q
"RTN","GMTSXPS1",161,0)
CONT ;   Page/Form Feed
"RTN","GMTSXPS1",162,0)
 S GMTSLC=0 W:IOST["P-" @IOF Q:IOST["P-"  W !!,"Press <Return> to continue  " R GMTSCONT:300 S:'$T GMTSCONT="^" S:GMTSCONT'["^" GMTSCONT=""
"RTN","GMTSXPS1",163,0)
 Q
"RTN","GMTSXPS1",164,0)
 ;                       
"RTN","GMTSXPS1",165,0)
 ; Miscellaneous
"RTN","GMTSXPS1",166,0)
TB(X) ;   Tab
"RTN","GMTSXPS1",167,0)
 S X=X F  Q:$L(X)>19  S X=X_" "
"RTN","GMTSXPS1",168,0)
 Q X
"RTN","GMTSXPS1",169,0)
PA(X) ;   Remove Parenthesis
"RTN","GMTSXPS1",170,0)
 Q $TR(X,"()","")
"RTN","GMTSXPS1",171,0)
LO(X) ;   Lowercase
"RTN","GMTSXPS1",172,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","GMTSXPS1",173,0)
UP(X) ;   Uppercase
"RTN","GMTSXPS1",174,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXPS1",175,0)
MX(X) ;   Mixed Case
"RTN","GMTSXPS1",176,0)
 Q $TR($E(X,1),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$TR($E(X,2,$L(X)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","GMTSXPS1",177,0)
TRIM(X) ;   Trim Space Characters
"RTN","GMTSXPS1",178,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSXPS1",179,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSXPS1",180,0)
 Q X
"RTN","GMTSXPS1",181,0)
CLR ;   Clean up
"RTN","GMTSXPS1",182,0)
 K ^TMP($J,"GMTSINFO") Q
"RTN","GMTSXPS1",183,0)
NOW(X) ;   Today's Date
"RTN","GMTSXPS1",184,0)
 S X=$$EDT($$NOW^XLFDT) Q X
"RTN","GMTSXPS1",185,0)
EDT(X) ;   External Date Foramt
"RTN","GMTSXPS1",186,0)
 S X=+($G(X)) Q:X=0 "" S X=$$FMTE^XLFDT(+X,"5Z") S:X["@" X=$P(X,"@",1)_"  "_$P(X,"@",2) Q X
"RTN","GMTSXPS1",187,0)
ROK(X) ;   Routine OK (in UCI) (NDBI)
"RTN","GMTSXPS1",188,0)
 S X=$G(X) Q:'$L(X) 0 Q:$L(X)>8 0 X ^%ZOSF("TEST") Q:$T 1 Q 0
"RTN","GMTSXPS1",189,0)
ENV(X) ;   Environment check
"RTN","GMTSXPS1",190,0)
 D HOME^%ZIS I '$D(^VA(200,+($G(DUZ)),0)) W !!,"    User (DUZ) not defined",! Q 0
"RTN","GMTSXPS1",191,0)
 Q 1
"RTN","GMTSXPS1",192,0)
ENV2(X) ;   Environment check
"RTN","GMTSXPS1",193,0)
 D HOME^%ZIS I '$D(^VA(200,+($G(DUZ)),0)) Q 0
"RTN","GMTSXPS1",194,0)
 Q 1
"RTN","GMTSXPS2")
0^55^B15757651
"RTN","GMTSXPS2",1,0)
GMTSXPS2 ; SLC/KER - Health Summary Status     ; 08/27/2002
"RTN","GMTSXPS2",2,0)
 ;;2.7;Health Summary;**35,56**;Oct 20, 1995
"RTN","GMTSXPS2",3,0)
 ;
"RTN","GMTSXPS2",4,0)
 ; External References
"RTN","GMTSXPS2",5,0)
 ;   DBIA 10048  ^DIC(9.4,
"RTN","GMTSXPS2",6,0)
 ;   DBIA 10006  IX^DIC
"RTN","GMTSXPS2",7,0)
 ;   DBIA  2056  $$GET1^DIQ (file 9.4)
"RTN","GMTSXPS2",8,0)
 ;                     
"RTN","GMTSXPS2",9,0)
 Q
"RTN","GMTSXPS2",10,0)
INS ; Get Installations
"RTN","GMTSXPS2",11,0)
 N GMTS0,GMTSDT,GMTSEQ,GMTSI,GMTSIENS,GMTSIN,GMTSN,GMTSNM,GMTSP
"RTN","GMTSXPS2",12,0)
 N GMTSPAT,GMTSPD,GMTSPDE,GMTSPI,GMTSST,GMTSTDT,GMTSTN,GMTSTNM
"RTN","GMTSXPS2",13,0)
 N GMTSV,GMTSVD,GMTSVDE,GMTSVDS,GMTSVI,GMTSNX,X,DIC,X,Y,DTOUT
"RTN","GMTSXPS2",14,0)
 N DUOUT,DLAYGO,DINUM S GMTSI=$$PKGI Q:+GMTSI=0  S GMTSV=2.7
"RTN","GMTSXPS2",15,0)
 S GMTSVI=$$VERI(GMTSI,GMTSV) Q:GMTSVI=0
"RTN","GMTSXPS2",16,0)
 S GMTSIENS=GMTSVI_","_GMTSI_","
"RTN","GMTSXPS2",17,0)
 S GMTSVDE=$$GET1^DIQ(9.49,GMTSIENS,2,"I")
"RTN","GMTSXPS2",18,0)
 S GMTSVDS=$$GET1^DIQ(9.49,GMTSIENS,1,"I")
"RTN","GMTSXPS2",19,0)
 S GMTSVD="" S:+GMTSVDE>0 GMTSVD=+GMTSVDE
"RTN","GMTSXPS2",20,0)
 S:+GMTSVD=0&(+GMTSVDS>0) GMTSVD=+GMTSVDS S:+GMTSVD>0&(+GMTSVDE>+GMTSVD) GMTSVD=+GMTSVDE Q:+GMTSVD=0
"RTN","GMTSXPS2",21,0)
 S GMTSVDE=$$EDT^GMTSXPS1($P(GMTSVD,".",1)) K GMTSVDS S GMTSIN(1,1)="Health Summary "_GMTSV_"^"_GMTSVDE
"RTN","GMTSXPS2",22,0)
 S GMTSPI=0 F  S GMTSPI=$O(^DIC(9.4,GMTSI,22,GMTSVI,"PAH",GMTSPI)) Q:+GMTSPI=0  D
"RTN","GMTSXPS2",23,0)
 . S GMTSIENS=GMTSPI_","_GMTSVI_","_GMTSI_","
"RTN","GMTSXPS2",24,0)
 . S GMTSP=$$GET1^DIQ(9.4901,GMTSIENS,.01) Q:'$L(GMTSP)  Q:+GMTSP=0
"RTN","GMTSXPS2",25,0)
 . S GMTSPD=$$GET1^DIQ(9.4901,GMTSIENS,.02,"I") Q:+GMTSPD=0
"RTN","GMTSXPS2",26,0)
 . S GMTSEQ="Test" S:GMTSP["SEQ #" GMTSEQ=+($P(GMTSP,"SEQ #",2)) S:+($G(GMTSEQ))=0 GMTSEQ="Test"
"RTN","GMTSXPS2",27,0)
 . S GMTSPAT=+GMTSP,GMTSPDE=$$EDT^GMTSXPS1(GMTSPD) Q:'$L(GMTSPDE)
"RTN","GMTSXPS2",28,0)
 . S GMTSIN(2,GMTSPAT,GMTSEQ)="GMTS*"_GMTSV_"*"_GMTSP_"^"_GMTSPDE
"RTN","GMTSXPS2",29,0)
 . S:$L(GMTSEQ)&(+GMTSEQ>0) GMTSIN(2,"SEQ",GMTSEQ,GMTSPAT)="GMTS*"_GMTSV_"*"_GMTSP_"^"_GMTSPDE
"RTN","GMTSXPS2",30,0)
 . S:$L(GMTSEQ)&(GMTSEQ["Test") GMTSIN(2,"SEQT",GMTSEQ,GMTSPAT)="GMTS*"_GMTSV_"*"_GMTSP_"^"_GMTSPDE
"RTN","GMTSXPS2",31,0)
 ;   Package
"RTN","GMTSXPS2",32,0)
 S GMTSN=GMTSIN(1,1),GMTSNM=$P(GMTSN,"^",1),GMTSDT=$P(GMTSN,"^",2),GMTSST="" D HD,SI
"RTN","GMTSXPS2",33,0)
 ;   Patches Installed in Sequence
"RTN","GMTSXPS2",34,0)
 S GMTSEQ=0 F  S GMTSEQ=$O(GMTSIN(2,"SEQ",GMTSEQ)) Q:+GMTSEQ=0  D
"RTN","GMTSXPS2",35,0)
 . S GMTSP=0 F  S GMTSP=$O(GMTSIN(2,"SEQ",GMTSEQ,GMTSP)) Q:+GMTSP=0  D
"RTN","GMTSXPS2",36,0)
 . . S GMTSN=$G(GMTSIN(2,GMTSP,GMTSEQ)) Q:'$L(GMTSN)
"RTN","GMTSXPS2",37,0)
 . . S GMTSNM=$P(GMTSN,"^",1) Q:'$L(GMTSNM)
"RTN","GMTSXPS2",38,0)
 . . S GMTSDT=$P(GMTSN,"^",2) Q:'$L(GMTSDT)
"RTN","GMTSXPS2",39,0)
 . . S GMTSST=""
"RTN","GMTSXPS2",40,0)
 . . I $D(GMTSIN(2,"SEQT","Test",GMTSP)) D
"RTN","GMTSXPS2",41,0)
 . . . N GMTSTN,GMTSTNM,GMTSTDT S GMTSTN=$G(GMTSIN(2,GMTSP,"Test")) I '$L(GMTSTN) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",42,0)
 . . . S GMTSTNM=$P(GMTSTN,"^",1) I '$L(GMTSTNM) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",43,0)
 . . . S GMTSTDT=$P(GMTSTN,"^",2) I '$L(GMTSTDT) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",44,0)
 . . . N GMTSNM,GMTSDT,GMTSST S GMTSNM=GMTSTNM,GMTSDT=GMTSTDT,GMTSST="Test"
"RTN","GMTSXPS2",45,0)
 . . . D SI K GMTSIN(2,"SEQT","Test",GMTSP)
"RTN","GMTSXPS2",46,0)
 . . D SI
"RTN","GMTSXPS2",47,0)
 ;   Other Patches Installed (test patches)
"RTN","GMTSXPS2",48,0)
 I $D(GMTSIN(2,"SEQT")) D
"RTN","GMTSXPS2",49,0)
 . N GMTSP,GMTSTN,GMTSTNM,GMTSTDT
"RTN","GMTSXPS2",50,0)
 . S GMTSP=0 F  S GMTSP=$O(GMTSIN(2,"SEQT","Test",GMTSP)) Q:+GMTSP=0  D
"RTN","GMTSXPS2",51,0)
 . . S GMTSTN=$G(GMTSIN(2,GMTSP,"Test")) I '$L(GMTSTN) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",52,0)
 . . S GMTSTNM=$P(GMTSTN,"^",1) I '$L(GMTSTNM) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",53,0)
 . . S GMTSTDT=$P(GMTSTN,"^",2) I '$L(GMTSTDT) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",54,0)
 . . S GMTSNM=GMTSTNM,GMTSDT=GMTSTDT,GMTSST="Test"
"RTN","GMTSXPS2",55,0)
 . . D SI K GMTSIN(2,"SEQT","Test",GMTSP)
"RTN","GMTSXPS2",56,0)
 D BL^GMTSXPS1
"RTN","GMTSXPS2",57,0)
 Q
"RTN","GMTSXPS2",58,0)
PKGI(X) ; Package
"RTN","GMTSXPS2",59,0)
 N D,Y,DIC,DTOUT,DUOUT S DIC(0)="I",D="C"
"RTN","GMTSXPS2",60,0)
 S X="GMTS",DIC="^DIC(9.4,"
"RTN","GMTSXPS2",61,0)
 D IX^DIC S X=0 S:+Y>0 X=+Y Q X
"RTN","GMTSXPS2",62,0)
VERI(X,Y) ; Version
"RTN","GMTSXPS2",63,0)
 N DA,D,DIC,DTOUT,DUOUT S DIC(0)="I",D="B" S DA(1)=+($G(X))
"RTN","GMTSXPS2",64,0)
 Q:DA(1)=0 0 S X=+($G(Y)) Q:X=0 0 S DIC="^DIC(9.4,"_DA(1)_",22,"
"RTN","GMTSXPS2",65,0)
 D IX^DIC S X=0 S:+Y>0 X=+Y Q X
"RTN","GMTSXPS2",66,0)
 ; Report
"RTN","GMTSXPS2",67,0)
HD ;   Header
"RTN","GMTSXPS2",68,0)
 N X S X="  Install Name",X=X_$J("",28-$L(X))_"Date" D TL^GMTSXPS1(X) S X="" S $P(X,"-",42)="-",X="  "_X D TL^GMTSXPS1(X)
"RTN","GMTSXPS2",69,0)
 Q
"RTN","GMTSXPS2",70,0)
SI ;   Site Installs
"RTN","GMTSXPS2",71,0)
 S GMTSNM=$G(GMTSNM) Q:'$L(GMTSNM)  S GMTSDT=$G(GMTSDT) Q:'$L(GMTSDT)  S GMTSST=$G(GMTSST)
"RTN","GMTSXPS2",72,0)
 N X S X="  "_GMTSNM,X=X_$J("",28-$L(X))_GMTSDT S:$L(GMTSST) X=X_$J("",40-$L(X))_GMTSST D TL^GMTSXPS1(X)
"RTN","GMTSXPS2",73,0)
 Q
"VER")
8.0^22.0
**END**
**END**
