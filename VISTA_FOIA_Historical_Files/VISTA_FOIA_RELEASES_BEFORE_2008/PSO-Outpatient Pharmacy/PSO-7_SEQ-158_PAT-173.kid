Released PSO*7*173 SEQ #158
Extracted from mail message
**KIDS**:PSO*7.0*173^

**INSTALL NAME**
PSO*7.0*173
"BLD",1051,0)
PSO*7.0*173^OUTPATIENT PHARMACY^0^3040816^y
"BLD",1051,1,0)
^^5^5^3040722^
"BLD",1051,1,1,0)
  When using the option Print from Suspense File (PSO PNDLBL) the
"BLD",1051,1,2,0)
  possibility exists that duplicate labels could be printed if
"BLD",1051,1,3,0)
  this option was used previously and is still running.  This patch
"BLD",1051,1,4,0)
  will resolve this issue by delaying the second job until the first
"BLD",1051,1,5,0)
  job finishes.
"BLD",1051,4,0)
^9.64PA^^
"BLD",1051,"ABPKG")
n
"BLD",1051,"KRN",0)
^9.67PA^8989.52^19
"BLD",1051,"KRN",.4,0)
.4
"BLD",1051,"KRN",.401,0)
.401
"BLD",1051,"KRN",.402,0)
.402
"BLD",1051,"KRN",.403,0)
.403
"BLD",1051,"KRN",.5,0)
.5
"BLD",1051,"KRN",.84,0)
.84
"BLD",1051,"KRN",3.6,0)
3.6
"BLD",1051,"KRN",3.8,0)
3.8
"BLD",1051,"KRN",9.2,0)
9.2
"BLD",1051,"KRN",9.8,0)
9.8
"BLD",1051,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1051,"KRN",9.8,"NM",1,0)
PSOSULBL^^0^B31659399
"BLD",1051,"KRN",9.8,"NM","B","PSOSULBL",1)

"BLD",1051,"KRN",19,0)
19
"BLD",1051,"KRN",19.1,0)
19.1
"BLD",1051,"KRN",101,0)
101
"BLD",1051,"KRN",409.61,0)
409.61
"BLD",1051,"KRN",771,0)
771
"BLD",1051,"KRN",870,0)
870
"BLD",1051,"KRN",8989.51,0)
8989.51
"BLD",1051,"KRN",8989.52,0)
8989.52
"BLD",1051,"KRN",8994,0)
8994
"BLD",1051,"KRN","B",.4,.4)

"BLD",1051,"KRN","B",.401,.401)

"BLD",1051,"KRN","B",.402,.402)

"BLD",1051,"KRN","B",.403,.403)

"BLD",1051,"KRN","B",.5,.5)

"BLD",1051,"KRN","B",.84,.84)

"BLD",1051,"KRN","B",3.6,3.6)

"BLD",1051,"KRN","B",3.8,3.8)

"BLD",1051,"KRN","B",9.2,9.2)

"BLD",1051,"KRN","B",9.8,9.8)

"BLD",1051,"KRN","B",19,19)

"BLD",1051,"KRN","B",19.1,19.1)

"BLD",1051,"KRN","B",101,101)

"BLD",1051,"KRN","B",409.61,409.61)

"BLD",1051,"KRN","B",771,771)

"BLD",1051,"KRN","B",870,870)

"BLD",1051,"KRN","B",8989.51,8989.51)

"BLD",1051,"KRN","B",8989.52,8989.52)

"BLD",1051,"KRN","B",8994,8994)

"BLD",1051,"QUES",0)
^9.62^^
"BLD",1051,"REQB",0)
^9.611^1^1
"BLD",1051,"REQB",1,0)
PSO*7.0*139^2
"BLD",1051,"REQB","B","PSO*7.0*139",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
7.0^2971216^2980805^5
"PKG",16,22,1,"PAH",1,0)
173^3040816
"PKG",16,22,1,"PAH",1,1,0)
^^5^5^3040816
"PKG",16,22,1,"PAH",1,1,1,0)
  When using the option Print from Suspense File (PSO PNDLBL) the
"PKG",16,22,1,"PAH",1,1,2,0)
  possibility exists that duplicate labels could be printed if
"PKG",16,22,1,"PAH",1,1,3,0)
  this option was used previously and is still running.  This patch
"PKG",16,22,1,"PAH",1,1,4,0)
  will resolve this issue by delaying the second job until the first
"PKG",16,22,1,"PAH",1,1,5,0)
  job finishes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSOSULBL")
0^1^B31659399
"RTN","PSOSULBL",1,0)
PSOSULBL ;BHAM ISC/RTR,SAB-Print Suspended labels ;4/8/93
"RTN","PSOSULBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**139,173**;DEC 1997
"RTN","PSOSULBL",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOSULBL",4,0)
 K PDUZ,REPRINT G ^PSOSULB1
"RTN","PSOSULBL",5,0)
BEG ;
"RTN","PSOSULBL",6,0)
 K PSORUNIN,PSORETRY
"RTN","PSOSULBL",7,0)
 S PSORUNIN="PSOSUSP"_($G(PSOSITE))
"RTN","PSOSULBL",8,0)
 L +@PSORUNIN:10 I '$T D
"RTN","PSOSULBL",9,0)
 . F PSORETRY=1:1:120 L +@PSORUNIN:60 I $T Q  ;waits a Maximum of 2 hours before continuing
"RTN","PSOSULBL",10,0)
 . Q
"RTN","PSOSULBL",11,0)
 K ^UTILITY($J,"PSOPRO") S PSOSEQ=1 F DFN=0:0 S DFN=$O(^PS(52.5,"AC",DFN)) Q:'DFN  D  D:'PSRT PID^VADPT6 D CHKDEAD D:'DEAD&($G(PSOSFLAG)) PRT
"RTN","PSOSULBL",12,0)
 .S PSOSFLAG=0 F ZZ=0:0 S ZZ=$O(^PS(52.5,"AC",DFN,ZZ)) Q:'ZZ!$G(PSOSFLAG)  I ZZ'>PRTDT S PSOSFLAG=1
"RTN","PSOSULBL",13,0)
 D PPL
"RTN","PSOSULBL",14,0)
 D:$D(^UTILITY($J,"PSOPRO"))&($P(PSOPAR,"^",8)) PROF
"RTN","PSOSULBL",15,0)
 G EXIT
"RTN","PSOSULBL",16,0)
PRT F SDT=0:0 S SDT=$O(^PS(52.5,"AC",DFN,SDT)) D:SDT CHK Q:'SDT
"RTN","PSOSULBL",17,0)
 Q
"RTN","PSOSULBL",18,0)
EXIT ;
"RTN","PSOSULBL",19,0)
 K ^TMP($J)
"RTN","PSOSULBL",20,0)
 I $D(PSORUNIN) L -@PSORUNIN
"RTN","PSOSULBL",21,0)
 D ^%ZISC
"RTN","PSOSULBL",22,0)
 K %,%ZIS,CNT,COM,DA,DEAD,DFN,DIRUT,DTTM,G,HDPPL,JJ,JJJ,JJJJ,PDUZ,IOP,ORD,PFIOQ,PSLION,PSRT,POP,PRF,PRTDT,PSLIO,PSNP,PSODBQ,PSOSEQ,PSOSFLAG,PSOSU,PSOTIME,PSOOUT,PSOPRFLG,PSOSEQ,PSOSUSPR,PSSPND,PST,PTL,PPLHLD,PSFNIEN,ZTSK
"RTN","PSOSULBL",23,0)
 K PSORUNIN,PSORETRY,PSRTONE,PSSRT,PSUSDEA,RF,RFCNT,RX,SDT,SFN,SREC,STOP,SUSPT,VADM,VAPA,X,X1,X2,XAK,XDATE,Y,Z,ZZ,WWW,PSDDDATE,SINRX,RXPR,RXPR1,GGGG,XXX,ZII,ZTDESC,ZTRTN,ZTSAVE,RRRR,RXRP,RXRP1,RXFL S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOSULBL",24,0)
CHK I SDT'>XDATE D TMP Q
"RTN","PSOSULBL",25,0)
 Q
"RTN","PSOSULBL",26,0)
TMP F SFN=0:0 S SFN=$O(^PS(52.5,"AC",DFN,SDT,SFN)) Q:'SFN  I +$P($G(^PS(52.5,+SFN,0)),"^",6)=$G(PSOSITE),'$G(^("P")),$P(^PSRX($P(^(0),"^"),0),"^",2)=DFN,$D(^DPT(DFN,0)),$P(^PSRX($P(^PS(52.5,SFN,0),"^"),"STA"),"^")<9  D
"RTN","PSOSULBL",27,0)
 .I +$P($G(^PSRX($P(^PS(52.5,SFN,0),"^"),2)),"^",6)<DT,+$P($G(^("STA")),"^")<11 S RXREC=$P(^PS(52.5,SFN,0),"^") D  S DIE=52,DA=$P(^PS(52.5,SFN,0),"^"),DR="100///"_11 D ^DIE S DA=SFN,DIK="^PS(52.5," D ^DIK K DIE,DIK,DA Q
"RTN","PSOSULBL",28,0)
 ..D EX^PSOSUTL K RXREC Q
"RTN","PSOSULBL",29,0)
 .I PSRT="D" S PSSRT=$S($G(PSRTONE)="I":VA("PID"),1:$P(^DPT(DFN,0),"^")_$P(^(0),"^",9))  S PSUSDEA=$P($G(^PS(52.5,SFN,0)),"^",10) S SRT=$S(PSUSDEA["A"!(PSUSDEA["C"):"A-"_PSSRT,PSUSDEA["S":"S-"_PSSRT,1:"Z-"_PSSRT)
"RTN","PSOSULBL",30,0)
 .I PSRT'="D" S SRT=$S(PSRT:$P(^DPT(DFN,0),"^")_$P(^(0),"^",9),1:VA("PID"))
"RTN","PSOSULBL",31,0)
 .S ^TMP($J,SRT,SFN)=+^PS(52.5,SFN,0)
"RTN","PSOSULBL",32,0)
 Q
"RTN","PSOSULBL",33,0)
PPL K PPL,PPL1 S ORD="" F  S ORD=$O(^TMP($J,ORD)) Q:ORD=""  D PPL1
"RTN","PSOSULBL",34,0)
 Q
"RTN","PSOSULBL",35,0)
PPL1 S (PSOPRFLG,SUSPT)=1 S:$D(PSOPROP) PFIO=PSOPROP
"RTN","PSOSULBL",36,0)
 S:'$D(PDUZ) PDUZ=DUZ K RXPR,RXPR1,PPL F SFN=0:0 S SFN=$O(^TMP($J,ORD,SFN)) Q:'SFN  I $D(^PS(52.5,SFN,0)) S SINRX=$P($G(^PS(52.5,SFN,0)),"^") D
"RTN","PSOSULBL",37,0)
 .I $L($G(PPL))<240 S PPL=$P(^TMP($J,ORD,SFN),"^")_","_$G(PPL) S RXPR(SINRX)=$P(^PS(52.5,SFN,0),"^",5),RXFL(SINRX)=$P($G(^PS(52.5,SFN,0)),"^",13) S:$P(^PS(52.5,SFN,0),"^",12) RXRP(SINRX)=1
"RTN","PSOSULBL",38,0)
 .E  S PPL1=$P(^TMP($J,ORD,SFN),"^")_","_$G(PPL1) S RXPR1(SINRX)=$P(^PS(52.5,SFN,0),"^",5),RXFL(SINRX)=$P($G(^PS(52.5,SFN,0)),"^",13) S:$P(^PS(52.5,SFN,0),"^",12) RXRP1(SINRX)=1
"RTN","PSOSULBL",39,0)
 .S DFN=$P(^PS(52.5,SFN,0),"^",3) I $P(PSOPAR,"^",8),'$D(^PSRX($P(^PS(52.5,SFN,0),"^"),1)),'$G(RXPR(SINRX)),'$G(RXPR1(SINRX)) S PSOPRFLG=0
"RTN","PSOSULBL",40,0)
 S PSNP=$S($P(PSOPAR,"^",8):1,1:0) I $G(PPL) S PPLHLD=$G(PPL1),HDPPL=PPL K PPL1 S (PSODBQ,PSOSUSPR)=1 F GGGG=0:0 S GGGG=$O(RXPR(GGGG)) Q:'GGGG  K:'$G(RXPR(GGGG)) RXPR(GGGG)
"RTN","PSOSULBL",41,0)
 I $G(PPL) D DQ^PSOLBL,SEQ D:'$G(PSOPRFLG)
"RTN","PSOSULBL",42,0)
 .I $G(PSOPROP)'=$G(PSLION) S ^UTILITY($J,"PSOPRO",DFN)="" Q
"RTN","PSOSULBL",43,0)
 .D DQ^PSOPRFSS
"RTN","PSOSULBL",44,0)
 I $G(PPLHLD) K RXPR S (PPL,HDPPL)=PPLHLD,(PSODBQ,PSOSUSPR)=1,PSNP=0 S:'$D(PDUZ) PDUZ=DUZ F XXX=0:0 S XXX=$O(RXPR1(XXX)) Q:'XXX  S:$G(RXPR1(XXX)) RXPR(XXX)=RXPR1(XXX)
"RTN","PSOSULBL",45,0)
 I $G(PPLHLD) F RRRR=0:0 S RRRR=$O(RXRP1(RRRR)) Q:'RRRR  S:$D(RXRP1(RRRR)) RXRP(RRRR)=1
"RTN","PSOSULBL",46,0)
 I $G(PPLHLD) D DQ^PSOLBL,SEQ D:'$G(PSOPRFLG)
"RTN","PSOSULBL",47,0)
 .I $G(PSOPROP)'=$G(PSLION) S ^UTILITY($J,"PSOPRO",DFN)="" Q
"RTN","PSOSULBL",48,0)
 .D DQ^PSOPRFSS
"RTN","PSOSULBL",49,0)
 K PPL,PPL1,PPLHLD,RXPR,RXPR1,RXFL Q
"RTN","PSOSULBL",50,0)
SEQ ;
"RTN","PSOSULBL",51,0)
 S SQCOUNT=0 F JJJ=1:1:$L(HDPPL) S:$E(HDPPL,JJJ)="," SQCOUNT=SQCOUNT+1
"RTN","PSOSULBL",52,0)
 F JJJJ=1:1:SQCOUNT S PSFNIEN=$P(HDPPL,",",JJJJ) D:PSFNIEN
"RTN","PSOSULBL",53,0)
 .S PSFNIEN=$O(^PS(52.5,"B",PSFNIEN,0)) I PSFNIEN D
"RTN","PSOSULBL",54,0)
 ..S $P(^PS(52.5,PSFNIEN,0),"^",11)=PSOSEQ,PSOSEQ=PSOSEQ+1 S:$P(^PS(52.5,PSFNIEN,0),"^",8)&($P(^(0),"^",9))&($P(^(0),"^",6)) ^PS(52.5,"AS",$P(^PS(52.5,PSFNIEN,0),"^",8),$P(^(0),"^",9),$P(^(0),"^",6),$P(^(0),"^",11),PSFNIEN)=""
"RTN","PSOSULBL",55,0)
 Q
"RTN","PSOSULBL",56,0)
CHKDEAD D DEM^VADPT I VADM(1)="" S DEAD=0 Q
"RTN","PSOSULBL",57,0)
 I VADM(6)="" S DEAD=0 Q
"RTN","PSOSULBL",58,0)
 S PSDDDATE=$P(VADM(6),"^",2) F WWW=0:0 S WWW=$O(^PS(55,DFN,"P",WWW)) Q:'WWW  I $D(^PS(55,DFN,"P",WWW,0)),$P($G(^(0)),"^") S (DA,RXREC)=$P(^(0),"^") S SFN=$O(^PS(52.5,"B",RXREC,0)) I SFN,$D(^PS(52.5,SFN,0)) S RX=$P(^(0),"^") D DEAD
"RTN","PSOSULBL",59,0)
 Q
"RTN","PSOSULBL",60,0)
DEAD S $P(^PSRX(RX,"STA"),"^")=12,COM="Died ("_$G(PSDDDATE)_")",DA(1)=RX
"RTN","PSOSULBL",61,0)
 S DEAD=1 D ARECD^PSOSUTL S DIK="^PS(52.5,",DA=SFN D ^DIK K DIK
"RTN","PSOSULBL",62,0)
 Q
"RTN","PSOSULBL",63,0)
PROF ;
"RTN","PSOSULBL",64,0)
 S ZTRTN="PRPROF^PSOSULBL",ZTDESC="PRINT PROFILES FROM SUSPENSE",ZTDTH=$H,ZTIO=PSOPROP
"RTN","PSOSULBL",65,0)
 S ZTSAVE("^UTILITY($J,""PSOPRO"",")="",ZTSAVE("PSOPAR")="",ZTSAVE("PSODTCUT")="",ZTSAVE("PSOSITE")="",ZTSAVE("PSOPRPAS")="" D ^%ZTLOAD Q
"RTN","PSOSULBL",66,0)
PRPROF ;
"RTN","PSOSULBL",67,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"PSOPRO",LLL)) Q:'LLL  I $D(^DPT(LLL,0)) S DFN=LLL D DQ^PSOPRFSS
"RTN","PSOSULBL",68,0)
 K PSOPAR,PSODTCUT,PSOSITE,PSOPRPAS,LLL,DFN,^UTILITY($J,"PSOPRO") D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOSULBL",69,0)
 Q
"VER")
8.0^22.0
**END**
**END**
