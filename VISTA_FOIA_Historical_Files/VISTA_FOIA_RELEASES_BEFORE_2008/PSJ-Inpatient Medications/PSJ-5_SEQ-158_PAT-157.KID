Released PSJ*5*157 SEQ #158
Extracted from mail message
**KIDS**:PSJ*5.0*157^

**INSTALL NAME**
PSJ*5.0*157
"BLD",6460,0)
PSJ*5.0*157^INPATIENT MEDICATIONS^0^3060731^y
"BLD",6460,1,0)
^^9^9^3060726^
"BLD",6460,1,1,0)
This patch addresses Remedy ticket HD101591.
"BLD",6460,1,2,0)
 
"BLD",6460,1,3,0)
HD101591, will show the pharmacist an expected first 
"BLD",6460,1,4,0)
dose date/time for IV orders during the finishing process.  Currently, 
"BLD",6460,1,5,0)
for IV's ordered either backdoor or through the CPRS IV Meds Dialog, no 
"BLD",6460,1,6,0)
"Expected First Dose" is displayed.  Unit dose orders, and IV's ordered 
"BLD",6460,1,7,0)
through the Inpatient Meds dialog on CPRS do display an expected first 
"BLD",6460,1,8,0)
dose.  An Expected First dose will not display if the schedule type for
"BLD",6460,1,9,0)
the order is ON CALL or PRN.
"BLD",6460,4,0)
^9.64PA^^
"BLD",6460,6)
7^
"BLD",6460,"KRN",0)
^9.67PA^8989.52^19
"BLD",6460,"KRN",.4,0)
.4
"BLD",6460,"KRN",.401,0)
.401
"BLD",6460,"KRN",.402,0)
.402
"BLD",6460,"KRN",.403,0)
.403
"BLD",6460,"KRN",.5,0)
.5
"BLD",6460,"KRN",.84,0)
.84
"BLD",6460,"KRN",3.6,0)
3.6
"BLD",6460,"KRN",3.8,0)
3.8
"BLD",6460,"KRN",9.2,0)
9.2
"BLD",6460,"KRN",9.8,0)
9.8
"BLD",6460,"KRN",9.8,"NM",0)
^9.68A^9^5
"BLD",6460,"KRN",9.8,"NM",5,0)
PSIVOPT2^^0^34249546
"BLD",6460,"KRN",9.8,"NM",6,0)
PSIVORC1^^0^33734585
"BLD",6460,"KRN",9.8,"NM",7,0)
PSIVORE^^0^41519347
"BLD",6460,"KRN",9.8,"NM",8,0)
PSJCOMR^^0^76543767
"BLD",6460,"KRN",9.8,"NM",9,0)
PSJUTL^^0^59274204
"BLD",6460,"KRN",9.8,"NM","B","PSIVOPT2",5)

"BLD",6460,"KRN",9.8,"NM","B","PSIVORC1",6)

"BLD",6460,"KRN",9.8,"NM","B","PSIVORE",7)

"BLD",6460,"KRN",9.8,"NM","B","PSJCOMR",8)

"BLD",6460,"KRN",9.8,"NM","B","PSJUTL",9)

"BLD",6460,"KRN",19,0)
19
"BLD",6460,"KRN",19.1,0)
19.1
"BLD",6460,"KRN",101,0)
101
"BLD",6460,"KRN",409.61,0)
409.61
"BLD",6460,"KRN",771,0)
771
"BLD",6460,"KRN",870,0)
870
"BLD",6460,"KRN",8989.51,0)
8989.51
"BLD",6460,"KRN",8989.52,0)
8989.52
"BLD",6460,"KRN",8994,0)
8994
"BLD",6460,"KRN","B",.4,.4)

"BLD",6460,"KRN","B",.401,.401)

"BLD",6460,"KRN","B",.402,.402)

"BLD",6460,"KRN","B",.403,.403)

"BLD",6460,"KRN","B",.5,.5)

"BLD",6460,"KRN","B",.84,.84)

"BLD",6460,"KRN","B",3.6,3.6)

"BLD",6460,"KRN","B",3.8,3.8)

"BLD",6460,"KRN","B",9.2,9.2)

"BLD",6460,"KRN","B",9.8,9.8)

"BLD",6460,"KRN","B",19,19)

"BLD",6460,"KRN","B",19.1,19.1)

"BLD",6460,"KRN","B",101,101)

"BLD",6460,"KRN","B",409.61,409.61)

"BLD",6460,"KRN","B",771,771)

"BLD",6460,"KRN","B",870,870)

"BLD",6460,"KRN","B",8989.51,8989.51)

"BLD",6460,"KRN","B",8989.52,8989.52)

"BLD",6460,"KRN","B",8994,8994)

"BLD",6460,"QUES",0)
^9.62^^
"BLD",6460,"REQB",0)
^9.611^6^2
"BLD",6460,"REQB",5,0)
PSJ*5.0*135^1
"BLD",6460,"REQB",6,0)
PSJ*5.0*136^1
"BLD",6460,"REQB","B","PSJ*5.0*135",5)

"BLD",6460,"REQB","B","PSJ*5.0*136",6)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,20,0)
^9.402P^^
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
157^3060731^33289
"PKG",203,22,1,"PAH",1,1,0)
^^9^9^3060731
"PKG",203,22,1,"PAH",1,1,1,0)
This patch addresses Remedy ticket HD101591.
"PKG",203,22,1,"PAH",1,1,2,0)
 
"PKG",203,22,1,"PAH",1,1,3,0)
HD101591, will show the pharmacist an expected first 
"PKG",203,22,1,"PAH",1,1,4,0)
dose date/time for IV orders during the finishing process.  Currently, 
"PKG",203,22,1,"PAH",1,1,5,0)
for IV's ordered either backdoor or through the CPRS IV Meds Dialog, no 
"PKG",203,22,1,"PAH",1,1,6,0)
"Expected First Dose" is displayed.  Unit dose orders, and IV's ordered 
"PKG",203,22,1,"PAH",1,1,7,0)
through the Inpatient Meds dialog on CPRS do display an expected first 
"PKG",203,22,1,"PAH",1,1,8,0)
dose.  An Expected First dose will not display if the schedule type for
"PKG",203,22,1,"PAH",1,1,9,0)
the order is ON CALL or PRN.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PSIVOPT2")
0^5^B34249546^B33907148
"RTN","PSIVOPT2",1,0)
PSIVOPT2 ;BIR/PR,MLM-OPTION DRIVER (CONT) ;02 Mar 99 / 9:27 AM
"RTN","PSIVOPT2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,29,58,110,127,133,135,157**;16 DEC 97
"RTN","PSIVOPT2",3,0)
 ;
"RTN","PSIVOPT2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVOPT2",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVOPT2",6,0)
 ;
"RTN","PSIVOPT2",7,0)
D ; Discontinue order.
"RTN","PSIVOPT2",8,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) W !,$C(7),"Order Unchanged." S COMQUIT=1 Q
"RTN","PSIVOPT2",9,0)
 ;* 8/2* D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED"),D1
"RTN","PSIVOPT2",10,0)
 I '$$REQPROV^PSGOEC W !,$C(7),"Order Unchanged." S COMQUIT=1 Q
"RTN","PSIVOPT2",11,0)
 I 'PSJCOM D
"RTN","PSIVOPT2",12,0)
 .D D1
"RTN","PSIVOPT2",13,0)
 .S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG^PSIVORAL S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3)
"RTN","PSIVOPT2",14,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSIVOPT2",15,0)
 .I ON55'["P" N COMFLG,O,OO S (COMFLG,O)=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSIVOPT2",16,0)
 .. Q:OO=ON55  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSIVOPT2",17,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSIVOPT2",18,0)
 .I OO["V" S ON55=OO D D1 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG^PSIVORAL N PSJORD S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),PSJORD=ON55 D HL^PSIVORA Q
"RTN","PSIVOPT2",19,0)
 .I OO["U" N PSGORD,PSJORD,PSJNOO K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,PSGP=DFN,DA=+OO,DA(1)=PSGP,(PSGORD,PSJORD)=OO,PSJNOO=P("NAT") D
"RTN","PSIVOPT2",20,0)
 ..S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))  D ASET^PSGOEC,AC^PSGOEC
"RTN","PSIVOPT2",21,0)
 Q
"RTN","PSIVOPT2",22,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSIVOPT2",23,0)
 S NSTOP=$$DATE^PSJUTL2(),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSIVOPT2",24,0)
 K TMP
"RTN","PSIVOPT2",25,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",109)=NSTOP
"RTN","PSIVOPT2",26,0)
 S:'$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) TMP(55.01,""_+ON55_","_DFN_","_"",116)=STP
"RTN","PSIVOPT2",27,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",100)="D"
"RTN","PSIVOPT2",28,0)
 S TMP(55.01,""_+ON55_","_DFN_","_"",.03)=NSTOP
"RTN","PSIVOPT2",29,0)
 S PSIVACT=1
"RTN","PSIVOPT2",30,0)
 D FILE^DIE("","TMP")
"RTN","PSIVOPT2",31,0)
 K TMP
"RTN","PSIVOPT2",32,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSIVOPT2",33,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSIVOPT2",34,0)
 Q
"RTN","PSIVOPT2",35,0)
 ;
"RTN","PSIVOPT2",36,0)
R ; Renew order.
"RTN","PSIVOPT2",37,0)
 ;I PSJCOM D RIV^PSJCOMR Q
"RTN","PSIVOPT2",38,0)
 I PSJCOM D ^PSJCOMR Q
"RTN","PSIVOPT2",39,0)
 I P(17)="D",P(12) N ERR D RI W:$G(ERR)=1 $C(7),"  Order unchanged." I $G(ERR)<2 S COMQUIT=1 Q
"RTN","PSIVOPT2",40,0)
 NEW PSGORQF S PSIVRNFG=1 D ORDCHK^PSJLIFN K PSIVRNFG W !
"RTN","PSIVOPT2",41,0)
 I $G(PSGORQF) S COMQUIT=1 Q
"RTN","PSIVOPT2",42,0)
 ;
"RTN","PSIVOPT2",43,0)
R1 ;
"RTN","PSIVOPT2",44,0)
 I $$EXPIRED^PSGOER(DFN,ON55) D  Q
"RTN","PSIVOPT2",45,0)
 .W !?3,"  THIS ORDER HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED ADMINISTRATIONS"
"RTN","PSIVOPT2",46,0)
 .W !?20,"  AND CANNOT BE RENEWED!"
"RTN","PSIVOPT2",47,0)
 N PSJRNWDT,PSJOSTOP,OREASON S PSJRNWDT=$$DATE2^PSJUTL2(PSGDT) S:$G(ON55) PSJOSTOP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3) I '(PSJOSTOP>P(2)),$G(PSGDT) S PSJOSTOP=PSGDT
"RTN","PSIVOPT2",48,0)
 S (PSIVOK,EDIT)="25^1" S P2=P(2),P(2)=PSJRNWDT D EDIT^PSIVEDT S P(2)=P2 K P2 I X="^" Q
"RTN","PSIVOPT2",49,0)
 S P(11)=$$ENRNAT^PSGOU($P($G(^PS(55,DFN,"IV",+ON55,2)),U,10),+VAIN(4),P(9),P(11))
"RTN","PSIVOPT2",50,0)
 D OK G:X["N" R1 I X=U D RD Q
"RTN","PSIVOPT2",51,0)
 S PSIVCHG=2
"RTN","PSIVOPT2",52,0)
 S P(17)="A",OREASON=P("RES"),P("RES")="R",P("FRES")="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D  Q:'$D(P("NAT"))
"RTN","PSIVOPT2",53,0)
 .D NATURE^PSIVOREN I '$D(P("NAT")) D RD Q
"RTN","PSIVOPT2",54,0)
 .S ON=ON55
"RTN","PSIVOPT2",55,0)
 S P(16)="",PSJORIFN="",PSIVACT=1,P("21FLG")="",P("RES")=OREASON D SET55^PSIVORFB
"RTN","PSIVOPT2",56,0)
 D:$P(^PS(55,DFN,"IV",+ON55,0),U,17)="A" RUPDATE^PSIVOREN(DFN,ON55,P(2))
"RTN","PSIVOPT2",57,0)
 I PSJIVORF,$P(^PS(55,DFN,"IV",+ON55,0),U,17)'="A" S X=$$LS^PSSLOCK(DFN,+ON55_"V") D
"RTN","PSIVOPT2",58,0)
 .D EXPOE^PSGOER(DFN,ON55)
"RTN","PSIVOPT2",59,0)
 .S P("RES")="R",PSJREN=1
"RTN","PSIVOPT2",60,0)
 .D ENUDTX^PSJOREN(DFN,ON55,"NR"),EN1^PSJHL2(DFN,"SN",+ON55_"V","ORDER RENEWED"),UPDREN(DFN,ON55,PSJRNWDT,P(6),PSJOSTOP,P("NAT"))
"RTN","PSIVOPT2",61,0)
 S OD=P(2)
"RTN","PSIVOPT2",62,0)
 D VF1^PSJLIACT("","",1),UNL^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT2",63,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"R")
"RTN","PSIVOPT2",64,0)
 I $G(PSJOSTOP),$G(ON55),$G(DFN) D STIX^PSIVOREN(PSJOSTOP,ON55,DFN)
"RTN","PSIVOPT2",65,0)
 Q
"RTN","PSIVOPT2",66,0)
 ;
"RTN","PSIVOPT2",67,0)
RD ; Delete for renew.
"RTN","PSIVOPT2",68,0)
 ;Q:'$G(PSJVFY)
"RTN","PSIVOPT2",69,0)
 ;D DEL55^PSIVORE2 S (ON55,P("OLDON"))=P("PON") D GT55^PSIVORFB
"RTN","PSIVOPT2",70,0)
 Q
"RTN","PSIVOPT2",71,0)
 ;
"RTN","PSIVOPT2",72,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSIVOPT2",73,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I ($G(P("PD"))="") D GTPD^PSIVORE2
"RTN","PSIVOPT2",74,0)
 D ^PSIVCHK I $D(DUOUT) S X="^",COMQUIT=1 Q
"RTN","PSIVOPT2",75,0)
 I ERR=1 S X="N",COMQUIT=1 Q
"RTN","PSIVOPT2",76,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVOPT2",77,0)
 ;PSJ*5*157 EFD FOR IV
"RTN","PSIVOPT2",78,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSIVOPT2",79,0)
 I $G(PSIVCHG),($G(PSIVREA)'="R") W !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVOPT2",80,0)
 S X="Is this O.K.: ^"_$S(ERR:"N",1:"Y")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSIVOPT2",81,0)
 Q
"RTN","PSIVOPT2",82,0)
 ;
"RTN","PSIVOPT2",83,0)
RI ; Reinstate Auto-DC'ed order.
"RTN","PSIVOPT2",84,0)
 N DA,DIE,DIR,DIU,DR,PSIVACT,PSIVALT,PSIVALCK,PSIVREA W !!,$C(7),"This order has been Auto-DC'ed."
"RTN","PSIVOPT2",85,0)
 S DIR(0)="Y",DIR("A")="Reinstate this order" D ^DIR K DIR I 'Y S ERR=1 Q
"RTN","PSIVOPT2",86,0)
 D NOW^%DTC I %>$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) D
"RTN","PSIVOPT2",87,0)
 .K DIR S ERR=1,DIR(0)="Y",DIR("A",1)="The original stop date of this order has past.",DIR("A")="Do you wish to renew this order" D ^DIR K DIR S ERR=$S(Y:2,1:1)
"RTN","PSIVOPT2",88,0)
 Q:$G(ERR)  S X=$G(^VA(200,+P(6),"PS")) I $S('X:1,'$P(X,U,4):0,DT<$P(X,U,4):0,1:1) S ERR=1
"RTN","PSIVOPT2",89,0)
 I $G(ERR) W !!,$C(7),"This order's provider is no longer valid. Please enter a valid provider." S (EDIT,PSIVOK)=1 D EDIT^PSIVEDT I $G(DONE) W $C(7),"Order unchanged." S ERR=1 Q
"RTN","PSIVOPT2",90,0)
 N PSGALO S PSGALO=18530 D ENARI^PSIVOPT(DFN,ON,DUZ,PSGALO)
"RTN","PSIVOPT2",91,0)
 Q
"RTN","PSIVOPT2",92,0)
 ;
"RTN","PSIVOPT2",93,0)
UPDREN(DFN,ORD,RNWDT,PROV,OSTOPDT,PSJNOO) ;
"RTN","PSIVOPT2",94,0)
 Q:'DFN!'ORD!'RNWDT!'PROV!'OSTOPDT!(PSJNOO="")
"RTN","PSIVOPT2",95,0)
 K DR,DA,DIC,DIE,DD,DO N ND0,PSGOEORD
"RTN","PSIVOPT2",96,0)
 S DIC="^PS(55,"_DFN_",""IV"","_+ORD S ND0=$G(@(DIC_",0)")),PSGOEORD=$P(ND0,"^",21) I $G(ON)["P",$G(PSGOLDOE) S PSGOEORD=PSGOLDOE
"RTN","PSIVOPT2",97,0)
 S DIC=DIC_",14,",DIC(0)="L",DIC("P")="55.1138DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=DFN,DA(1)=+ORD D
"RTN","PSIVOPT2",98,0)
 .S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$G(DUZ)_";2////"_$G(PROV)_";3////"_$G(OSTOPDT)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSIVOPT2",99,0)
 .Q
"RTN","PSIVOPT2",100,0)
 K DO,DINUM
"RTN","PSIVORC1")
0^6^B33734585^B33400994
"RTN","PSIVORC1",1,0)
PSIVORC1 ;BIR/MLM-PROCESS INCOMPLETE IV ORDER - CONT ;13 Jan 98 / 11:36 AM
"RTN","PSIVORC1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,37,69,110,157**;16 DEC 97
"RTN","PSIVORC1",3,0)
 ;
"RTN","PSIVORC1",4,0)
 ; Reference to ^DD("DD" is supported by DBIA 10017.
"RTN","PSIVORC1",5,0)
 ; Reference to ^DD( is supported by DBIA 2255.
"RTN","PSIVORC1",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVORC1",7,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSIVORC1",8,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSIVORC1",9,0)
 ; Reference to ^DID is supported by DBIA 2052.
"RTN","PSIVORC1",10,0)
 ; Reference to ^VALM is supported by DBIA 10118.
"RTN","PSIVORC1",11,0)
 ;
"RTN","PSIVORC1",12,0)
53 ; IV Type
"RTN","PSIVORC1",13,0)
 ;*S DONE=0 N DIR S DIR(0)="SNA^A:ADMIXTURE;C:CHEMOTHERAPY;"_$S($E(PSIVAC)'["C":"H:HYPERAL;",1:"")_"P:PIGGYBACK;S:SYRINGE",DIR("A")="IV TYPE: "
"RTN","PSIVORC1",14,0)
 S DONE=0 N DIR S DIR(0)="SNA^A:ADMIXTURE;C:CHEMOTHERAPY;H:HYPERAL;P:PIGGYBACK;S:SYRINGE",DIR("A")="IV TYPE: "
"RTN","PSIVORC1",15,0)
 I $G(P("RES"))'="R" S:P(4)]"" DIR("B")="ADMIXTURE",P(4)=""
"RTN","PSIVORC1",16,0)
 D DIRQ,^DIR S:$D(DTOUT)!(X="^") DONE=1 Q:DONE  G:$E(X)="^" 53 S P(4)=Y D:"CS"[P(4) @P(4)
"RTN","PSIVORC1",17,0)
 I PSIVAC'="PN" D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC1",18,0)
OTYP ; Get order type, display type.
"RTN","PSIVORC1",19,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3) S:PSIVAC'="CF" P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I")
"RTN","PSIVORC1",20,0)
 Q
"RTN","PSIVORC1",21,0)
 ;
"RTN","PSIVORC1",22,0)
C ; Edit Chemo order
"RTN","PSIVORC1",23,0)
 N DIR S DIR(0)="SA^A:ADMIXTURE;P:PIGGYBACK;S:SYRINGE",DIR("A")="CHEMOTHERAPY TYPE: " D DIRQ,^DIR S:$D(DTOUT)!(X=U) DONE=1 Q:$E(X)="^"!(DONE)  S P(23)=Y D:P(23)["S" S
"RTN","PSIVORC1",24,0)
 Q
"RTN","PSIVORC1",25,0)
 ;
"RTN","PSIVORC1",26,0)
S ; Edit Syringe order
"RTN","PSIVORC1",27,0)
56 ; Intermittent Syringe
"RTN","PSIVORC1",28,0)
 N DIR S DIR(0)="Y",DIR("??")="^S F1=53.1,F2=56 D ENHLP^PSIVORC1",DIR("A")="INTERMITTENT SYRINGE" D ^DIR Q:$D(DIRUT)  S P(5)=Y
"RTN","PSIVORC1",29,0)
 ;
"RTN","PSIVORC1",30,0)
55 ; Syringe Size
"RTN","PSIVORC1",31,0)
 N DA,DIR S DIR(0)="53.1,55" D ^DIR I $D(DTOUT)!$D(DUOUT) S DONE=1 Q
"RTN","PSIVORC1",32,0)
 S P("SYRS")=Y
"RTN","PSIVORC1",33,0)
 Q
"RTN","PSIVORC1",34,0)
 ;
"RTN","PSIVORC1",35,0)
DIRQ ; Set DIR("?") for IV Type prompt.
"RTN","PSIVORC1",36,0)
 S DIR("?")="Enter a code from the list above.",DIR("??")="^S F1=55.01,F2="_$S(DIR("A")["CHEMO":106,1:.04)_" D ENHLP^PSIVORC1"
"RTN","PSIVORC1",37,0)
 S DIR("?",1)="CHOOSE FROM:",Y=$P(DIR(0),U,2) F X=1:1:5 S DIR("?",X+1)="              "_$P($P(Y,";",X),":")_"    "_$P($P(Y,";",X),":",2)
"RTN","PSIVORC1",38,0)
 Q
"RTN","PSIVORC1",39,0)
 ;
"RTN","PSIVORC1",40,0)
CKFLDS ; Find required fields missing data.
"RTN","PSIVORC1",41,0)
 NEW PSIVASX,PSIVASY,FIL,DRGTMP
"RTN","PSIVORC1",42,0)
 S EDIT="" F PSIVASX="AD","SOL" D
"RTN","PSIVORC1",43,0)
 .I '$D(DRG(PSIVASX)) S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58) Q
"RTN","PSIVORC1",44,0)
 .S DNE=0 F PSIVASY=0:0 S PSIVASY=$O(DRG(PSIVASX,PSIVASY)) Q:'PSIVASY!DNE  D
"RTN","PSIVORC1",45,0)
 .. I $P(DRG(PSIVASX,PSIVASY),U,3)="" S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58),DNE=1
"RTN","PSIVORC1",46,0)
 .. ;S FIL=$S(PSIVASX="AD":"52.6",1:"52.7")
"RTN","PSIVORC1",47,0)
 .. ;S DRGTMP=DRG(PSIVASX,PSIVASY) D ORDERCHK^PSIVEDRG(DFN)
"RTN","PSIVORC1",48,0)
 S:'P("MR") EDIT=EDIT_U_3 F X=8,6,2,3 I P(X)="" S EDIT=EDIT_U_$S(X=8:59,X=6:1,X=2:10,X=3:25,1:"")
"RTN","PSIVORC1",49,0)
 I P("DTYP")=1 S:P(9)="" EDIT=EDIT_U_26 S:P(11)="" EDIT=EDIT_U_39
"RTN","PSIVORC1",50,0)
 S:$E(EDIT,1)=U EDIT=$E(EDIT,2,999)
"RTN","PSIVORC1",51,0)
 Q
"RTN","PSIVORC1",52,0)
 ;
"RTN","PSIVORC1",53,0)
DONE ; Kill variables and exit
"RTN","PSIVORC1",54,0)
 K ACTION,AD,DFN,DNE,DONE,DONE1,DRG,DRGI,DRGN,DRGT,DRGTN,EDIT,ERR,F1,F2,FIL,HDT,J,LN,LN2,ND,ON,ON1,ON55,ORIFN,P,P16,PC,PDM,PG,PN,PNME,PNOW,PSGLMT,PSGODDD
"RTN","PSIVORC1",55,0)
 K PSGSS,PSGSSH,PSIV,PSIVAC,PSIVAT,PSIVCV,PSIVE,PSIVHD,PSIVLN,PSIVOK,PSIVOLD,PSIVORUT,PSIVREA,PSIVSC1,PSIVSTR,PSIVSTRT,PSIVTYPE,PSIVUP,PSIVX,PSIVX1
"RTN","PSIVORC1",56,0)
 K PSJIVORF,PSJORF,PSJORIFN,PSJORL,PSJORNP,PSJORPF,PSJORSTS,PSJIVOF,PSJNKF,PSJORD,RB,RF,SOL,STOP,TYP,UL80,WD,WDN,WG,^TMP("PSIV",$J) D ENIVKV^PSGSETU
"RTN","PSIVORC1",57,0)
 Q
"RTN","PSIVORC1",58,0)
ENHLP ; order entry fields' help
"RTN","PSIVORC1",59,0)
 N PSJHP,PSJX,PSJD
"RTN","PSIVORC1",60,0)
 ;
"RTN","PSIVORC1",61,0)
 D FIELD^DID(F1,F2,"","HELP-PROMPT","PSJHP")
"RTN","PSIVORC1",62,0)
 I X="?",$D(PSJHP("HELP-PROMPT")) S F=$G(PSJHP("HELP-PROMPT")) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSIVORC1",63,0)
 ;I X="?",$D(^DD(F1,F2,3)) S F=^(3) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSIVORC1",64,0)
 ;
"RTN","PSIVORC1",65,0)
 W:$D(^DD(F1,F2,12)) !,"("_^(12)_")" D FIELD^DID(F1,F2,"","XECUTABLE HELP","PSJX") I $D(PSJX("XECUTABLE HELP")) X PSJX("XECUTABLE HELP")
"RTN","PSIVORC1",66,0)
 ;
"RTN","PSIVORC1",67,0)
 ; new code
"RTN","PSIVORC1",68,0)
 D FIELD^DID(F1,F2,"","DESCRIPTION","PSJD")
"RTN","PSIVORC1",69,0)
 G:$S($G(X)="?":1,1:'$O(PSJD("DESCRIPTION",0))) SC F F=0:0 S F=$O(PSJD("DESCRIPTION",F)) Q:'F  I $D(PSJD("DESCRIPTION",F)) W !?2,PSJD("DESCRIPTION",F)
"RTN","PSIVORC1",70,0)
SC ;
"RTN","PSIVORC1",71,0)
 I F2=5!(F2=6) W !,"CHOOSE FROM:",!?8,0,?16,"NO",!?8,1,?16,"YES" Q
"RTN","PSIVORC1",72,0)
 Q
"RTN","PSIVORC1",73,0)
COMPLTE ;
"RTN","PSIVORC1",74,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) D ^PSIVCHK I $D(DUOUT) W $C(7),!,"Order Unchanged.",! Q
"RTN","PSIVORC1",75,0)
 G:'$D(PSIVFN1) EDIT1
"RTN","PSIVORC1",76,0)
 I ERR=1 S Y=0 G EDIT1
"RTN","PSIVORC1",77,0)
 D CKORD^PSIVORC2 I PSIVCHG D NOW^%DTC S P("LOG")=$E(%,1,12),P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U),P("INS")=""
"RTN","PSIVORC1",78,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2)
"RTN","PSIVORC1",79,0)
 W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVORC1",80,0)
EDIT ;
"RTN","PSIVORC1",81,0)
 I ERR=1 W !,"Please re-edit this order" K DIR S DIR(0)="E" D ^DIR K DIR W:'Y $C(7),"order unchanged." Q:'Y  S Y=0 G EDIT1
"RTN","PSIVORC1",82,0)
 ;PSJ*5*157 EFD FOR IV
"RTN","PSIVORC1",83,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSIVORC1",84,0)
 W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVORC1",85,0)
 K DIR S DIR(0)="Y",DIR("A")="Is this O.K.",DIR("B")=$S(ERR:"NO",1:"YES"),DIR("?",1)="Enter ""Y"" to make this an active order (only allowed if no errors were"
"RTN","PSIVORC1",86,0)
 S DIR("?")="found in order), ""N"" to edit the order, or ""^"" to leave order unchanged.",DIR("??")="^S HELP=""EDIT"" D ^PSIVHLP"
"RTN","PSIVORC1",87,0)
 D ^DIR K DIR I $D(DIRUT) K DIRUT W $C(7),"Order unchanged." Q
"RTN","PSIVORC1",88,0)
 ;*  Kill Unit dose variables when calling from ^PSJLIFNI.
"RTN","PSIVORC1",89,0)
 I +Y,$G(PSJLIFNI) D
"RTN","PSIVORC1",90,0)
 . K ND,ND4,ND6,NDP2
"RTN","PSIVORC1",91,0)
 . K PSGAT,PSGCANFL,PSGDI,PSGDO,PSGDT,PSGEB,PSGEBN,PSGEFN,PSGFD,PSGFDN
"RTN","PSIVORC1",92,0)
 . K PSGHSM,PSGLI,PSGLIN,PSGLMT,PSGMR,PSGMRN,PSGNEDFD,PSGNEF,PSGNEFD
"RTN","PSIVORC1",93,0)
 . K PSGNESD,PSGOAT,PSGODO,PSGODT,PSGEA,PSGOEAV,PSGOEEF
"RTN","PSIVORC1",94,0)
 . K PSGOEEWF,PSGOEEG,PSGOEF,PSGOENG,PSGOES,PSGOFD,PSGOFDN,PSGOHSM
"RTN","PSIVORC1",95,0)
 . K PSGOINST,PSGOMR,PSGOMRN,PSGONC
"RTN","PSIVORC1",96,0)
 . K PSGOPD,PSOPDN,PSGOPR,PSGOPRN,PSGOSD,PSGOSDN,PSGOSI,PSGOSM
"RTN","PSIVORC1",97,0)
 . K PSGOST,PSGOSTN
"RTN","PSIVORC1",98,0)
 . K PSGPD,PSGPDN,PSGPDRG,PSGDRGN,PSGPFLG,PSGPI,PSGPR,PSGPRIO,PSGPRN
"RTN","PSIVORC1",99,0)
 . K PSGPTMP,PSGRRF,PSG0XT,PSGS0Y,PSGSCH,PSGSD,PSGSDN,PSGSI,PSGSM
"RTN","PSIVORC1",100,0)
 . K PSGST,PSGSTAT,PSGSTN,PSJACNWP,PSJACOK,PSJCOI
"RTN","PSIVORC1",101,0)
EDIT1 ;
"RTN","PSIVORC1",102,0)
 NEW XFLG,PSIVY S PSIVY=Y
"RTN","PSIVORC1",103,0)
 NEW X S X=^TMP("PSJI",$J,0),VALMBG=$S((X<17):1,1:(X-(X#16)))
"RTN","PSIVORC1",104,0)
 I PSIVY=0!'$G(PSIVFN1) S PSIVFN1=1 D EN^VALM("PSJ LM IV AC/EDIT") Q
"RTN","PSIVORC1",105,0)
 S PSIVCHG=0 D EDCHK^PSIVORC2 K PSIVCHG
"RTN","PSIVORC1",106,0)
 S VALMBCK="Q",PSIVACEP=1
"RTN","PSIVORC1",107,0)
 Q
"RTN","PSIVORE")
0^7^B41519347^B41019563
"RTN","PSIVORE",1,0)
PSIVORE ;BIR/PR,MLM-ORDER ENTRY ;25 Nov 98 / 3:34 PM
"RTN","PSIVORE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**18,29,50,56,58,81,110,127,133,157**;16 DEC 97
"RTN","PSIVORE",3,0)
 ;
"RTN","PSIVORE",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVORE",5,0)
 ; Reference to ^ORX2 is supported by DBIA #867
"RTN","PSIVORE",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVORE",7,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSIVORE",8,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSIVORE",9,0)
 ; Reference to EN^VALM is supported by DBIA 10118.
"RTN","PSIVORE",10,0)
 ; Reference to ^VADPT is supported by DBIA 10061.
"RTN","PSIVORE",11,0)
 ;
"RTN","PSIVORE",12,0)
 N PSJNEW,PSJOUT,PSGPTMP,PPAGE,FLAG S PSJNEW=1
"RTN","PSIVORE",13,0)
 ;
"RTN","PSIVORE",14,0)
 D SITE Q:'$G(PSIVQ)  K PSIVQ S PSGOP=""
"RTN","PSIVORE",15,0)
 ;
"RTN","PSIVORE",16,0)
BEG ;Get patient and make sure he is living.
"RTN","PSIVORE",17,0)
 L +^PS(53.45,DUZ):1 E  D LOCKERR^PSJOE G Q
"RTN","PSIVORE",18,0)
 ;* F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  D ASK
"RTN","PSIVORE",19,0)
 ;* F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  S X=DFN_";DPT(" D LK^ORX2 Q:'Y  D ASK S X=DFN_";DPT(" D ULK^ORX2
"RTN","PSIVORE",20,0)
 NEW PSJLK
"RTN","PSIVORE",21,0)
 F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  S PSJLK='$$L^PSSLOCK(DFN,1) Q:PSJLK  D ASK,UL^PSSLOCK(DFN)
"RTN","PSIVORE",22,0)
 I PSGOP,$P(PSJSYSL,"^",2)]"" D ENQL^PSGLW
"RTN","PSIVORE",23,0)
 G Q
"RTN","PSIVORE",24,0)
 ;
"RTN","PSIVORE",25,0)
ASK ;See if patient has been admitted.
"RTN","PSIVORE",26,0)
 I VADM(6) W !?5,"Patient has died." Q
"RTN","PSIVORE",27,0)
 I 'VAIN(4) K DIK S DIR(0)="Y",DIR("A")="Do you wish to continue",DIR("B")="NO",DIR("??")="^S HELP=""ADMYN"" D ^PSIVHLP1" W !,"This patient has not been admitted." D ^DIR K DIR Q:'Y
"RTN","PSIVORE",28,0)
 S:VAIN(4) WSCHADM=+VAIN(4)
"RTN","PSIVORE",29,0)
 ;
"RTN","PSIVORE",30,0)
SETN ;Set up patient 0 node if needed.
"RTN","PSIVORE",31,0)
 I '$D(^PS(55,DFN,0)) K DO,DA,DD,DIC,PSIVFN S:$D(^(5.1)) PSIVFN=^(5.1) K:$D(PSIVFN) ^(5.1) S (DINUM,X)=DFN,DIC(0)="L",DIC="^PS(55," D FILE^DICN S:$D(PSIVFN) ^PS(55,DFN,5.1)=PSIVFN D  K DIC,PSIVFN,DO,DA,DD,DINUM
"RTN","PSIVORE",32,0)
 .; Mark PSJ and PSO as converted
"RTN","PSIVORE",33,0)
 .S $P(^PS(55,DFN,5.1),"^",11)=2
"RTN","PSIVORE",34,0)
 S PSJNARC=1
"RTN","PSIVORE",35,0)
 S PSGP=DFN,PSJPWD=+VAIN(4),PSIVAC="P",PSIVBR="D ^PSIVOPT" D HK,ENCHS1^PSIV Q:'$D(DFN)
"RTN","PSIVORE",36,0)
 Q
"RTN","PSIVORE",37,0)
 ;
"RTN","PSIVORE",38,0)
NEW ;Ask to enter new order.
"RTN","PSIVORE",39,0)
 D:'$D(VADM(1)) DEM^VADPT
"RTN","PSIVORE",40,0)
 K P,PSIVCHG,PSIVTYPE,PSJOE,DIR S DIR(0)="Y",DIR("A")="New order for "_VADM(1),DIR("B")="YES",DIR("??")="^S HELP=""NEWORD"" D ^PSIVHLP" D ^DIR K DIR Q:'Y
"RTN","PSIVORE",41,0)
 NEW X S X=DFN_";DPT(" D LK^ORX2 Q:'Y  S PSJLSORX=1
"RTN","PSIVORE",42,0)
INMED K ON55,PSJOUT S (P(4),P("OT"),P("FRES"))="" D NEW55^PSIVORFB I '$D(ON55) D ULK G:'$D(PSJOE)&('$D(PSJOUT)) NEW G Q
"RTN","PSIVORE",43,0)
 S P("RES")="N",PSIVAC="PN",P("PON")=ON55,PSIVUP=+$$GTPCI^PSIVUTL D NEW^PSIVORE2 I $G(P(2))="" D DEL55^PSIVORE2 D ULK G:'$D(PSJOE) NEW Q
"RTN","PSIVORE",44,0)
 D OK L -^PS(55,DFN,"IV",+ON55) D ULK G:'$D(PSJOE) NEW
"RTN","PSIVORE",45,0)
 ;
"RTN","PSIVORE",46,0)
Q ; Kill and exit.
"RTN","PSIVORE",47,0)
 L:'$D(PSJOE) -^PS(53.45,DUZ) S PSJNKF=1 D Q^PSIV
"RTN","PSIVORE",48,0)
 K FIL,I1,ND,PC,PDM,PSGDT,PSGID,PSGLMT,PSGSI,PSJNARC,PSIVAC,PSIVCHG,PSIVUP,PSIVX,PSJOPC
"RTN","PSIVORE",49,0)
 Q
"RTN","PSIVORE",50,0)
 ;
"RTN","PSIVORE",51,0)
ULK ;
"RTN","PSIVORE",52,0)
 Q:'$G(PSJLSORX)  ;If NEW^PSIVORE did not lock, don't kill it here.
"RTN","PSIVORE",53,0)
 NEW X S X=DFN_";DPT(" D ULK^ORX2 K PSJLSORX
"RTN","PSIVORE",54,0)
 Q
"RTN","PSIVORE",55,0)
HK ;Queue job to print MAR labels generated for this patient.
"RTN","PSIVORE",56,0)
 I PSGOP,PSGOP'=DFN D
"RTN","PSIVORE",57,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSIVORE",58,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,U,2)]"" ENQL^PSGLW
"RTN","PSIVORE",59,0)
 S PSGOP=DFN
"RTN","PSIVORE",60,0)
 Q
"RTN","PSIVORE",61,0)
 ;
"RTN","PSIVORE",62,0)
SITE ;See if site parameters are ok.
"RTN","PSIVORE",63,0)
 K PSIVQ D ^PSIVXU Q:$D(XQUIT)
"RTN","PSIVORE",64,0)
 I '$D(PSIVSN)!('$D(PSIVSITE)) W $C(7),$C(7),!!,"You have no IV ROOM parameters ... PLEASE ... PLEASE ...",!,"Exit this package and reenter properly !!",!! Q
"RTN","PSIVORE",65,0)
 D ORPARM^PSIVOREN S PSIVQ=1
"RTN","PSIVORE",66,0)
 Q
"RTN","PSIVORE",67,0)
 ;
"RTN","PSIVORE",68,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSIVORE",69,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I $G(P("PD"))="" D GTPD^PSIVORE2
"RTN","PSIVORE",70,0)
 D ^PSIVCHK I $D(DUOUT) S X="^" G DOA
"RTN","PSIVORE",71,0)
 I ERR=1 S X="N" G BAD
"RTN","PSIVORE",72,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVORE",73,0)
 ;PSJ*5*157 EFD for IVs
"RTN","PSIVORE",74,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSIVORE",75,0)
 W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVORE",76,0)
 I '$G(PSIVCOPY) G:PSIVAC["R" OK1 S X="Is this O.K.: ^"_$S(ERR:"NO",1:"YES")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV
"RTN","PSIVORE",77,0)
 S PSJIVBD=1 ;var use to indicate order enter from back door
"RTN","PSIVORE",78,0)
BAD ;; I X["N" D GSTRING^PSIVORE1,^PSIVORV2,GTFLDS^PSIVORFE G OK
"RTN","PSIVORE",79,0)
 I ON55["V",($G(P(21))="") S P(17)="N"
"RTN","PSIVORE",80,0)
 I X["N" NEW PSGEBN,PSGLI S (P("INS"),PSGEBN,PSGLI)="",(PSJORD,ON)=ON55 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q" Q
"RTN","PSIVORE",81,0)
 I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSIVORE",82,0)
DOA I X["^" D DEL55^PSIVORE2 Q
"RTN","PSIVORE",83,0)
 Q:$$NONVF("SN")
"RTN","PSIVORE",84,0)
OK1 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))),P(17)="A",ORSTS=6,ON=ON55,PSJORNP=+P(6)
"RTN","PSIVORE",85,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN
"RTN","PSIVORE",86,0)
 I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) D DEL55^PSIVORE2 Q
"RTN","PSIVORE",87,0)
 D SET55^PSIVORFB
"RTN","PSIVORE",88,0)
 I PSJIVORF,($G(P(22))=.5) D CLINIC^PSIVOREN
"RTN","PSIVORE",89,0)
 I PSJIVORF D SET^PSIVORFE S ORNATR=P("NAT"),ON=+ON55,OD=P(2) D EN1^PSJHL2(DFN,"SN",+ON55_"V","SEND ORDER NUMBER") ;,EN1^PSJHL2(DFN,"SC",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORE",90,0)
 D VF1^PSJLIACT("V","ORDER ENTERED AS ACTIVE BY ",1)
"RTN","PSIVORE",91,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORE",92,0)
 ;
"RTN","PSIVORE",93,0)
CAL ;Calculate doses.
"RTN","PSIVORE",94,0)
 ;S OD=P(2) D EN,^PSIVORE1,^PSIVOPT
"RTN","PSIVORE",95,0)
 S OD=P(2) D EN,^PSIVOPT
"RTN","PSIVORE",96,0)
 Q
"RTN","PSIVORE",97,0)
 ;
"RTN","PSIVORE",98,0)
EN ;Update schedule interval P(15) only on continuous orders.
"RTN","PSIVORE",99,0)
 ;This includes Hyp/Adm/Continuous Syringes/Chemos =>P(5)=0
"RTN","PSIVORE",100,0)
 Q:'$D(DFN)!('$D(ON55))  Q:$P(^PS(55,DFN,"IV",+ON55,0),U,4)="P"!($P(^(0),U,5))!($P(^(0),U,23)="P")
"RTN","PSIVORE",101,0)
 D SPSOL S XXX=$P(^PS(55,DFN,"IV",+ON55,0),U,8) G:'SPSOL ENQ I XXX?1N.N.1"."1N.N1" ml/hr" S P(15)=$S('XXX:0,1:SPSOL\XXX*60+(SPSOL#XXX/XXX*60+.5)\1),$P(^PS(55,DFN,"IV",+ON55,0),U,15)=P(15) G ENQ
"RTN","PSIVORE",102,0)
 S P(15)=$S('$P(XXX,"@",2):0,1:1440/$P(XXX,"@",2)\1),$P(^PS(55,DFN,"IV",+ON55,0),U,15)=P(15)
"RTN","PSIVORE",103,0)
ENQ K SPSOL,XXX Q
"RTN","PSIVORE",104,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(^PS(55,DFN,"IV",+ON55,"SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(^(XXX,0),U,2)
"RTN","PSIVORE",105,0)
 K XXX Q
"RTN","PSIVORE",106,0)
ENIN ;Entry for Combined IV/UD order entry. Called by PSJOE0.
"RTN","PSIVORE",107,0)
 D HOLDHDR^PSJOE
"RTN","PSIVORE",108,0)
 W !
"RTN","PSIVORE",109,0)
 N PSJOUT S (DONE,FLAG)=0,PSIVAC="PN"
"RTN","PSIVORE",110,0)
ENIN1 ;
"RTN","PSIVORE",111,0)
 N DA,DIR,PSJOE,PSJPCAF,PSJSYSL,WSCHADM S:$G(VAIN(4)) WSCHADM=VAIN(4)
"RTN","PSIVORE",112,0)
 K P,PSIVCHG,PSJCOM
"RTN","PSIVORE",113,0)
 S PSJOE=1,DIR(0)="55.01,.04O",DIR("A")="Select IV TYPE" D ^DIR
"RTN","PSIVORE",114,0)
 I X]"",X'="^",$P("^PROFILE",X)="" S PSJOEPF=X Q
"RTN","PSIVORE",115,0)
 S:$D(DTOUT) X="^" I "^"[X S PSJORQF=PSJORQF+$S(X="^":2,$G(FLAG):0,1:1),X="." Q
"RTN","PSIVORE",116,0)
 S FLAG=1,PSIVTYPE=Y,(P(5),P(23))="" I "SC"[Y D @(Y_"^PSIVORC1") S $P(PSIVTYPE,U,2)=P(23)
"RTN","PSIVORE",117,0)
 D INMED G:'$D(PSJOUT) ENIN S:$D(PSJOUT) PSJORQF=2
"RTN","PSIVORE",118,0)
 Q
"RTN","PSIVORE",119,0)
NONVF(PSJOC)  ;If file at NonVF then quit with 1
"RTN","PSIVORE",120,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORE",121,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORE",122,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORE",123,0)
 K DA D ENGNN^PSGOETO S ON=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORE",124,0)
 D GTPD^PSIVORE2
"RTN","PSIVORE",125,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) D:ON55["V" DEL55 Q 1
"RTN","PSIVORE",126,0)
 D:$G(VAIN(4))="" CLINIC^PSIVOREN
"RTN","PSIVORE",127,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORE",128,0)
 D PUT531^PSIVORFA
"RTN","PSIVORE",129,0)
 D:$G(PSJOC)]"" EN1^PSJHL2(DFN,PSJOC,ON,"SEND ORDER NUMBER")
"RTN","PSIVORE",130,0)
 D:ON55["V" DEL55
"RTN","PSIVORE",131,0)
 NEW PSJORD S (ON55,PSJORD)=ON
"RTN","PSIVORE",132,0)
 D VF^PSIVORC2
"RTN","PSIVORE",133,0)
 Q 1
"RTN","PSIVORE",134,0)
DEL55 ;
"RTN","PSIVORE",135,0)
 Q:ON55["P"
"RTN","PSIVORE",136,0)
 S X=$G(^PS(55,DFN,"IV",+ON55,0))
"RTN","PSIVORE",137,0)
 I $P(X,U,21)]"",($G(^PS(55,DFN,"IV",+ON55,2))]"") S $P(^(2),U,6)=ON,$P(^PS(53.1,+ON,0),U,25)=ON55 Q
"RTN","PSIVORE",138,0)
 NEW PSIVORFA S PSIVORFA=1
"RTN","PSIVORE",139,0)
 D DEL55^PSIVORE2
"RTN","PSIVORE",140,0)
 Q 
"RTN","PSJCOMR")
0^8^B76543767^B76222009
"RTN","PSJCOMR",1,0)
PSJCOMR ;BIR/CML3-RENEW A COMPLEX ORDER SERIES ;07 MAR 96 / 1:23 PM
"RTN","PSJCOMR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127,136,157**;16 DEC 97
"RTN","PSJCOMR",3,0)
 ;
"RTN","PSJCOMR",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSJCOMR",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSJCOMR",6,0)
 ; Reference to NOW^%DTC is supported by DBIA 10000.
"RTN","PSJCOMR",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOMR",8,0)
 ;
"RTN","PSJCOMR",9,0)
 ; renew a complex order series
"RTN","PSJCOMR",10,0)
 Q:'PSJCOM  K COMQUIT
"RTN","PSJCOMR",11,0)
 W !!,"This order is part of a complex order. If you "_$S($P(PSJSYSP0,"^",3):"RENEW",1:"MARK")_" this order the",!,"following orders will be "_$S($P(PSJSYSP0,"^",3):"RENEWED",1:"MARKED")_" too." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSJCOMR",12,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS COMPLEX ORDER SERIES",1:"MARK THIS COMPLEX ORDER SERIES FOR RENEWAL"),DIR("B")="YES"
"RTN","PSJCOMR",13,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this complex order series",1:"mark this complex order series for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR K DIR
"RTN","PSJCOMR",14,0)
 I 'Y N DIR D ABORT G DONE
"RTN","PSJCOMR",15,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSJCOMR",16,0)
 I '$D(DIRUT),PSJSYSU I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSJCOMR",17,0)
 D DONE,ABORT^PSGOEE
"RTN","PSJCOMR",18,0)
 Q
"RTN","PSJCOMR",19,0)
 ;
"RTN","PSJCOMR",20,0)
UNMARK ;  
"RTN","PSJCOMR",21,0)
 W !!,"THIS COMPLEX ORDER SERIES HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSJCOMR",22,0)
 S DIR("?",1)="  Answer 'YES' to unmark this complex order series.  Answer 'NO' (or '^') to leave the complex",DIR("?")="order series marked.  (An answer is required.)" D ^DIR
"RTN","PSJCOMR",23,0)
 I 'Y N DIR D ABORT^PSGOEE G DONE
"RTN","PSJCOMR",24,0)
 N PSGORD,XX,X S XX=0,X="" F  S XX=$O(^PS(55,"ACX",PSJCOM,XX)) Q:'XX  F  S X=$O(^PS(55,"ACX",PSJCOM,XX,X)) Q:X=""  S PSGORD=X D
"RTN","PSJCOMR",25,0)
 .S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4))
"RTN","PSJCOMR",26,0)
 .S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSJCOMR",27,0)
 ;
"RTN","PSJCOMR",28,0)
DONE ;
"RTN","PSJCOMR",29,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGOPR,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSJCOMR",30,0)
 ;
"RTN","PSJCOMR",31,0)
NEW ; get info, write record
"RTN","PSJCOMR",32,0)
 K ^TMP("PSJCOMR",$J)
"RTN","PSJCOMR",33,0)
 N DUOUT,PSGORD,TMPP,TMPO,PS55ACX,TMPDUZ,TMPOE,COMQUIT S TMPP=0 K PS55ACX M PS55ACX(55,"ACX",PSJCOM)=^PS(55,"ACX",PSJCOM)
"RTN","PSJCOMR",34,0)
 F  S TMPP=$O(PS55ACX(55,"ACX",PSJCOM,TMPP)) Q:'TMPP!$G(COMQUIT)  D
"RTN","PSJCOMR",35,0)
 . S TMPO=0 F  S TMPO=$O(PS55ACX(55,"ACX",PSJCOM,TMPP,TMPO)) Q:TMPO=""!$G(COMQUIT)  S PSGORD=TMPO D:PSGORD["U" NEWUD  I PSGORD["V" D NEWIV
"RTN","PSJCOMR",36,0)
 I $G(COMQUIT)!$G(DUOUT)  W !!,"By not verifying all the orders, none of the orders will be verified." D PAUSE^VALM1 Q
"RTN","PSJCOMR",37,0)
 I '$G(COMQUIT)&'$G(DUOUT) S TMPOE=0 F  S TMPOE=$O(^PS(55,"ACX",PSJCOM,TMPOE)) Q:TMPOE=""  S TMPO=0 F  S TMPO=$O(^PS(55,"ACX",PSJCOM,TMPOE,TMPO)) Q:'TMPO!$G(COMQUIT)  S PSGORD=TMPO D
"RTN","PSJCOMR",38,0)
 . K VSTRING S VSTRING=$G(^TMP("PSJCOMR",$J,PSJCOM,TMPO)) I PSGORD'=$P(VSTRING,"^",2) S COMQUIT=1 Q
"RTN","PSJCOMR",39,0)
 . S PSGP=$P(VSTRING,"^"),PSGDT=$P(VSTRING,"^",3),PSGOEPR=$P(VSTRING,"^",4),PSGOFD=$P(VSTRING,"^",5),PSGFD=$P(VSTRING,"^",6),PSJNOO=$P(VSTRING,"^",7),TMPDUZ=$P(VSTRING,"^",8)
"RTN","PSJCOMR",40,0)
 . D:PSGORD["U" FILEUD D:PSGORD["V" FILEIV
"RTN","PSJCOMR",41,0)
 K ^TMP("PSJCOMR",$J),VSTRING
"RTN","PSJCOMR",42,0)
 Q
"RTN","PSJCOMR",43,0)
NEWUD N PSJABT,PSGDRG,PSJREN,X,XX,PSGORDP,UDSTRING S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSJCOMR",44,0)
 D OC55
"RTN","PSJCOMR",45,0)
 Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSJCOMR",46,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSJCOMR",47,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSJCOMR",48,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSJCOMR",49,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I '$D(PSGFOK(106)) D DONE,ABORT^PSGOEE S VALMBCK="R" Q
"RTN","PSJCOMR",50,0)
 W !!,"...updating order..." N PSGOEAV S PSGOEAV=+PSJSYSU,PSGOORD=PSGORD,PSGOER1=$G(^PS(55,PSGP,5,+PSGORD,.2)),PSGSI=$G(^(6)) W "."
"RTN","PSJCOMR",51,0)
 S PSGMR=$P(PSGOER0,"^",3),PSGSM=$P(PSGOER0,"^",5),PSGHSM=$P(PSGOER0,"^",6)
"RTN","PSJCOMR",52,0)
 S PSGMRN=$$ENMRN^PSGMI(PSGMR),PSGPDRGN=$$ENPDN^PSGMI(PSGPDRG),PSGDO=$P(PSGOER1,"^",2),PSGSCH=$P(PSGOER2,"^")
"RTN","PSJCOMR",53,0)
 S PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6),PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSJCOMR",54,0)
 S:PSJPWD'=$P(PSGOER2,U,10) PSGS0Y=$$ENRNAT^PSGOU($P(PSGOER2,U,10),+PSJPWD,PSGSCH,PSGS0Y)
"RTN","PSJCOMR",55,0)
 S UDSTRING=PSGP_"^"_PSGORD_"^"_PSGDT_"^"_PSGOEPR_"^"_PSGOFD_"^"_PSGFD_"^"_PSJNOO F II=1:1:$L(UDSTRING,"^") I $P(UDSTRING,"^",II)="" K UDSTRING
"RTN","PSJCOMR",56,0)
 I '$D(UDSTRING) S COMQUIT=1 Q
"RTN","PSJCOMR",57,0)
 S:$G(DUZ) UDSTRING=UDSTRING_"^"_DUZ D TEMP(UDSTRING)
"RTN","PSJCOMR",58,0)
 Q
"RTN","PSJCOMR",59,0)
 ;
"RTN","PSJCOMR",60,0)
FILEUD ;
"RTN","PSJCOMR",61,0)
 ;Changed the reference to the type "O" for order numbers previously in v4.5
"RTN","PSJCOMR",62,0)
 N X,PSJORD,PSGOERDP,PSGOREAS,PSGRZERO S PSJORD=PSGORD K PSJPREX
"RTN","PSJCOMR",63,0)
 ;Make sure Admin times for parent don't carry to children;BHW;PSJ*5*136
"RTN","PSJCOMR",64,0)
 S X=$$LS^PSSLOCK(PSGP,PSGORD)  S PSGRTWO=^PS(55,+$G(PSGP),5,+PSGORD,2) S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOREAS=$P(@(PSGRZERO),"^",24) D
"RTN","PSJCOMR",65,0)
 . S (PSGAT,PSGS0Y)=$P(PSGRTWO,"^",5)
"RTN","PSJCOMR",66,0)
 . S $P(@PSGRZERO,"^",24)="R" D UPDREN^PSGOER(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO,$G(TMPDUZ)),UPDRENOE^PSGOER(PSGP,PSGORD) S $P(@PSGRZERO,"^",24)=PSGOREAS
"RTN","PSJCOMR",67,0)
 I +$G(PSJSYSU)=3,$G(PSJCOM) D CMPLX2^PSJCOM1(PSGP,PSJCOM,PSGORD) I $G(PSGPXN) S PSJPREX=1
"RTN","PSJCOMR",68,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSJCOMR",69,0)
 I '$G(PSGOERDP),$P(PSJSYSW0,"^",4) I $G(PSGFD),$G(PSGWLL),(PSGFD'<PSGWLL) S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSJCOMR",70,0)
 D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSJCOMR",71,0)
 W ".DONE!" S VALMBCK="Q"
"RTN","PSJCOMR",72,0)
 Q
"RTN","PSJCOMR",73,0)
 ;
"RTN","PSJCOMR",74,0)
MARK ;
"RTN","PSJCOMR",75,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSJCOMR",76,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSJCOMR",77,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSJCOMR",78,0)
 Q
"RTN","PSJCOMR",79,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSJCOMR",80,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0))
"RTN","PSJCOMR",81,0)
 S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSJCOMR",82,0)
 Q
"RTN","PSJCOMR",83,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSJCOMR",84,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG
"RTN","PSJCOMR",85,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSJCOMR",86,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(55,PSGP,5,+PSGORD,1,1,0)))
"RTN","PSJCOMR",87,0)
 I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSJCOMR",88,0)
 . F PSGDDI=1:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0)) K PSJPDRG D IVSOL^PSGSICHK
"RTN","PSJCOMR",89,0)
 Q
"RTN","PSJCOMR",90,0)
 ;
"RTN","PSJCOMR",91,0)
RIV ; Renew order.
"RTN","PSJCOMR",92,0)
 Q:'PSJCOM  N PSGORD,TMPP,TMPO S (TMPP,TMPO)=0 K PS55ACX M PS55ACX(55,"ACX",PSJCOM)=^PS(55,"ACX",PSJCOM)
"RTN","PSJCOMR",93,0)
 F  S TMPP=$O(PS55ACX(55,"ACX",PSJCOM,TMPP)) Q:'TMPP  S TMPO=0 F  S TMPO=$O(PS55ACX(55,"ACX",PSJCOM,TMPP,TMPO)) Q:TMPO=""  D
"RTN","PSJCOMR",94,0)
 . S PSGORD=TMPO D:PSGORD["U" NEWUD  D:PSGORD["V" NEWIV
"RTN","PSJCOMR",95,0)
 Q
"RTN","PSJCOMR",96,0)
NEWIV ;Renew complex IV orders
"RTN","PSJCOMR",97,0)
 N X,XX
"RTN","PSJCOMR",98,0)
 I P(17)="D",P(12) N ERR D RI W:$G(ERR)=1 $C(7),"  Order unchanged." Q:$G(ERR)<2
"RTN","PSJCOMR",99,0)
 NEW PSGORQF S PSIVRNFG=1 D ORDCHK^PSJLIFN K PSIVRNFG Q:$G(PSGORQF)  W !
"RTN","PSJCOMR",100,0)
 I $G(PSGORD)["V" S ON55=PSGORD S P("OLDON")=$P(^PS(55,DFN,"IV",+PSGORD,2),"^",5) S:'P("OLDON") P("OLDON")=ON55
"RTN","PSJCOMR",101,0)
 ;
"RTN","PSJCOMR",102,0)
R1 N PSIVND0,PSIVND2,PSIVREAS,PSIVOFD,IVSTRING,P2,PSJBKDR S PSJBKDR=1
"RTN","PSJCOMR",103,0)
 S P("NEWON")=ON55,(PSIVOK,EDIT)="25^1",P2=P(2) S P(2)=$$DATE^PSJUTL2 D EDIT^PSIVEDT S P(2)=P2 I X="^" D RD Q
"RTN","PSJCOMR",104,0)
 S:+VAIN(4)'=$P($G(^PS(55,DFN,"IV",+P("OLDON"),2)),U,10) P(11)=$$ENRNAT^PSGOU($P($G(^PS(55,DFN,"IV",+P("OLDON"),2)),U,10),+VAIN(4),P(9),P(11))
"RTN","PSJCOMR",105,0)
 S PSIVCHG=2
"RTN","PSJCOMR",106,0)
 D OK G:X["N" R1 I X=U D RD Q
"RTN","PSJCOMR",107,0)
 S P(17)="A",P("RES")="R",P("FRES")="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D  Q:'$D(P("NAT"))
"RTN","PSJCOMR",108,0)
 .D NATURE^PSIVOREN I '$D(P("NAT")) D RD S COMQUIT=1 Q
"RTN","PSJCOMR",109,0)
 .S ON=ON55 ;D SET^PSIVORFE
"RTN","PSJCOMR",110,0)
 S P(16)="",PSJORIFN="",PSIVACT=1,P("21FLG")="",PSIVOFD=$P($G(^PS(55,DFN,"IV",+PSGORD,0)),"^",3)
"RTN","PSJCOMR",111,0)
 S IVSTRING=DFN_"^"_ON55_"^"_$$DATE^PSJUTL2()_"^"_+$G(P(6))_"^"_PSIVOFD_"^"_P(3)_"^"_P("NAT") F II=1:1:$L(IVSTRING,"^") I $P(IVSTRING,"^",II)="" K IVSTRING
"RTN","PSJCOMR",112,0)
 I '$D(IVSTRING) S COMQUIT=1 Q
"RTN","PSJCOMR",113,0)
 S:$G(DUZ) IVSTRING=IVSTRING_"^"_DUZ D TEMP(IVSTRING)
"RTN","PSJCOMR",114,0)
 Q
"RTN","PSJCOMR",115,0)
 ;
"RTN","PSJCOMR",116,0)
FILEIV ;
"RTN","PSJCOMR",117,0)
 N X,ON,ON55,PSJORD,P,PSIVTMP,PSIVZERO,OREAS
"RTN","PSJCOMR",118,0)
 S X=$$LS^PSSLOCK(DFN,+PSGORD_"V") S PSIVZERO="^PS(55,"_DFN_",""IV"","_+PSGORD_",0)" S PSIVTMP0=$G(@PSIVZERO) Q:'PSIVTMP0
"RTN","PSJCOMR",119,0)
 S PSIVTMP2="^PS(55,"_DFN_",""IV"","_+PSGORD_",2)",OREAS=$P(PSIVTMP2,"^",8),$P(@PSIVTMP2,"^",8)="R"
"RTN","PSJCOMR",120,0)
 F I=1:1:$L(PSIVTMP0,"^") S P(I)=$P(PSIVTMP0,"^",I)
"RTN","PSJCOMR",121,0)
 S (ON,ON55,PSJORD)=PSGORD,P(3)=PSGFD,P(6)=PSGOEPR,P("NAT")=PSJNOO,PSIVOFD=PSGOFD D RUPDATE^PSIVOREN(DFN,ON55,P(2))
"RTN","PSJCOMR",122,0)
 Q:'PSJIVORF
"RTN","PSJCOMR",123,0)
 D EN1^PSJHL2(DFN,"SN",+ON55_"V","ORDER RENEWED")
"RTN","PSJCOMR",124,0)
 S OD=P(2) D EN^PSIVORE
"RTN","PSJCOMR",125,0)
 D VF1^PSJLIACT("","",0),UNL^PSSLOCK(DFN,+ON55_"V") S $P(@PSIVTMP2,"^",8)=OREAS
"RTN","PSJCOMR",126,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"R")
"RTN","PSJCOMR",127,0)
 Q
"RTN","PSJCOMR",128,0)
 ;
"RTN","PSJCOMR",129,0)
TEMP(VARS) ;
"RTN","PSJCOMR",130,0)
 Q:'PSJCOM  S ^TMP("PSJCOMR",$J,PSJCOM,PSGORD)=VARS
"RTN","PSJCOMR",131,0)
 Q
"RTN","PSJCOMR",132,0)
 ;
"RTN","PSJCOMR",133,0)
RD ; Delete for renew.
"RTN","PSJCOMR",134,0)
 D DEL55^PSIVORE2 S (ON55,P("PON"))=P("OLDON") D GT55^PSIVORFB
"RTN","PSJCOMR",135,0)
 Q
"RTN","PSJCOMR",136,0)
 ;
"RTN","PSJCOMR",137,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSJCOMR",138,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I ($G(P("PD"))="") D GTPD^PSIVORE2
"RTN","PSJCOMR",139,0)
 D ^PSIVCHK I $D(DUOUT) S X="^" Q
"RTN","PSJCOMR",140,0)
 I ERR=1 S X="N" Q
"RTN","PSJCOMR",141,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSJCOMR",142,0)
 D EFDIV^PSJUTL($G(ZZND))
"RTN","PSJCOMR",143,0)
 S X="Is this O.K.: ^"_$S(ERR:"N",1:"Y")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSJCOMR",144,0)
 Q
"RTN","PSJCOMR",145,0)
 ;
"RTN","PSJCOMR",146,0)
RI ; Reinstate Auto-DC'ed order.
"RTN","PSJCOMR",147,0)
 N DA,DIE,DIR,DIU,DR,PSIVACT,PSIVALT,PSIVALCK,PSIVREA W !!,$C(7),"This order has been Auto-DC'ed."
"RTN","PSJCOMR",148,0)
 S DIR(0)="Y",DIR("A")="Reinstate this order" D ^DIR K DIR I 'Y S ERR=1 Q
"RTN","PSJCOMR",149,0)
 D NOW^%DTC I %>$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) D
"RTN","PSJCOMR",150,0)
 .K DIR S ERR=1,DIR(0)="Y",DIR("A",1)="The original stop date of this order has past.",DIR("A")="Do you wish to renew this order" D ^DIR K DIR S ERR=$S(Y:2,1:1)
"RTN","PSJCOMR",151,0)
 Q:$G(ERR)  S X=$G(^VA(200,+P(6),"PS")) I $S('X:1,'$P(X,U,4):0,DT<$P(X,U,4):0,1:1) S ERR=1
"RTN","PSJCOMR",152,0)
 I $G(ERR) W !!,$C(7),"This order's provider is no longer valid. Please enter a valid provider." S (EDIT,PSIVOK)=1 D EDIT^PSIVEDT I $G(DONE) W $C(7),"Order unchanged." S ERR=1 Q
"RTN","PSJCOMR",153,0)
 N PSGALO S PSGALO=18530 D ENARI^PSIVOPT(DFN,ON,DUZ,PSGALO)
"RTN","PSJCOMR",154,0)
 Q
"RTN","PSJCOMR",155,0)
 ;
"RTN","PSJCOMR",156,0)
ABORT ; No changes
"RTN","PSJCOMR",157,0)
 W !!,$C(7),"No changes made to this order." D PAUSE^VALM1 K PSGOEEF S PSGOEEF=0
"RTN","PSJCOMR",158,0)
 Q
"RTN","PSJUTL")
0^9^B59274204^B55612120
"RTN","PSJUTL",1,0)
PSJUTL ;BIR/MLM-MISC. INPATIENT UTILITIES ;17 Mar 98 / 11:05 AM
"RTN","PSJUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**9,47,58,80,110,136,157**;16 DEC 97
"RTN","PSJUTL",3,0)
 ;
"RTN","PSJUTL",4,0)
 ; Reference to ^DIC(42 is supported by DBIA 10039.
"RTN","PSJUTL",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJUTL",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJUTL",7,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJUTL",8,0)
 ; Reference to ^DIC1 is supported by DBIA 10007.
"RTN","PSJUTL",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJUTL",10,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJUTL",11,0)
 ;
"RTN","PSJUTL",12,0)
ENDL ; device look-up
"RTN","PSJUTL",13,0)
 N DA,DIC,DIE,DIX,DO,DR
"RTN","PSJUTL",14,0)
 S DIC="^%ZIS(1,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",15,0)
 S X=Y(0,0)
"RTN","PSJUTL",16,0)
 Q
"RTN","PSJUTL",17,0)
 ;
"RTN","PSJUTL",18,0)
ENDH(X) ; device help
"RTN","PSJUTL",19,0)
 N D,XQH,DA,DIC,DIE,DO,DR,DZ
"RTN","PSJUTL",20,0)
 S DIC="^%ZIS(1,",DIC(0)="EIM" D DO^DIC1,^DIC
"RTN","PSJUTL",21,0)
 Q
"RTN","PSJUTL",22,0)
 ;
"RTN","PSJUTL",23,0)
READ ; hold screen
"RTN","PSJUTL",24,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSJUTL",25,0)
 W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","PSJUTL",26,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSJUTL",27,0)
 Q
"RTN","PSJUTL",28,0)
 ;
"RTN","PSJUTL",29,0)
ENOISC(PSJOI,USAGE)          ;Set DIC("S") so that only Orderable Items with at 
"RTN","PSJUTL",30,0)
 ;least 1 active dispense drug for the specified usage.
"RTN","PSJUTL",31,0)
 ;Input:  PSJOI IEN of Orderable Item selected
"RTN","PSJUTL",32,0)
 ;        USAGE - Type of drugs (UD,IV,etc) to be selected
"RTN","PSJUTL",33,0)
 ;Output: 1-At least one dispense drug found
"RTN","PSJUTL",34,0)
 ;        0-None found
"RTN","PSJUTL",35,0)
 N FOUND,PSJ
"RTN","PSJUTL",36,0)
 S PSJ=$P($G(^PS(50.7,+PSJOI,0)),U,4),FOUND=$S('PSJ:1,PSJ>DT:1,1:0)
"RTN","PSJUTL",37,0)
 I FOUND S FOUND=0 F PSJ=0:0 S PSJ=$O(^PSDRUG("ASP",PSJOI,PSJ)) Q:FOUND!'PSJ  I $P($G(^PSDRUG(PSJ,2)),U,3)[USAGE,'$G(^("I"))!($G(^("I"))'<DT) S FOUND=1
"RTN","PSJUTL",38,0)
 Q FOUND
"RTN","PSJUTL",39,0)
 ;
"RTN","PSJUTL",40,0)
AADR ; display allergies and adverse reactions
"RTN","PSJUTL",41,0)
 D ATS^PSJMUTL(60,50,1) N A,B
"RTN","PSJUTL",42,0)
 I (PSGALG=0)&(PSGADR=0) W !!,"No allergies or ADRs on file."
"RTN","PSJUTL",43,0)
 I PSGALG'=0 W !!,"Allergies: " S B="PSGALG" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",44,0)
 I PSGADR'=0 W !,"      ADR: " S B="PSGADR" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",45,0)
 D READ K PSGALG,PSGADR Q
"RTN","PSJUTL",46,0)
 ;
"RTN","PSJUTL",47,0)
ENALU ; application look-up
"RTN","PSJUTL",48,0)
 N PSJ S PSJ=DA(1) N DA,DIC,DIE,DIX,DO,DR S DIC="^PS(50.35,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",49,0)
 S X=$P(Y(0),"^",2) K:$S(X="":1,1:$D(^PS(50.3,PSJ,1,"B",X))) X
"RTN","PSJUTL",50,0)
 Q
"RTN","PSJUTL",51,0)
 ;
"RTN","PSJUTL",52,0)
ENAQ ; application query
"RTN","PSJUTL",53,0)
 S X=DZ N D,DA,DIC,DIE,DO,DR,DZ,XQH S DIC="^PS(50.35,",DIC(0)="EIMQ" D DO^DIC1,^DIC
"RTN","PSJUTL",54,0)
 Q
"RTN","PSJUTL",55,0)
 ;
"RTN","PSJUTL",56,0)
ENPC(PSJTYP,PSJSYSP,LEN,TEXT) ; Copy Provider Comments -> Special Instructions.
"RTN","PSJUTL",57,0)
 Q:'$D(^PS(53.1,+$G(PSJORD),12,1,0)) ""
"RTN","PSJUTL",58,0)
 N DIR,PSGSI,PSGOEE,X,Y
"RTN","PSJUTL",59,0)
 S Y="" F X=0:0 S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  S Y=Y_^(X,0)_" " Q:$L(Y)>LEN
"RTN","PSJUTL",60,0)
 S:$G(PSJTYP)'="V" Y=$$ENSET^PSGSICHK(Y) S:$G(PSJTYP)="V" Y=$E(Y,1,$L(Y)-1)
"RTN","PSJUTL",61,0)
 I $L(Y)'<LEN S PSGOEE=0 D REDISP Q PSGSI
"RTN","PSJUTL",62,0)
 ;Display Provider Comments Prior to Asking the Copy Provider Comments Question;BHW;PSJ*5*136
"RTN","PSJUTL",63,0)
 N PSJTMP S PSJTMP=0
"RTN","PSJUTL",64,0)
 W !,"PROVIDER COMMENTS:"
"RTN","PSJUTL",65,0)
 F  S PSJTMP=$O(^PS(53.1,+$G(PSJORD),12,PSJTMP)) Q:'PSJTMP  W !,^PS(53.1,+$G(PSJORD),12,PSJTMP,0)
"RTN","PSJUTL",66,0)
 S PSGSI=Y W ! S DIR(0)="S^Y:Yes;N:No;!:Copy and flag for display in a BCMA Message Box",DIR("A")="Copy the Provider Comments into "_$$ENFIELD(PSJTYP)_" (Yes/No/!)",DIR("??")="^D ENPCHLP1^PSJUTL(PSJTYP)" D ^DIR
"RTN","PSJUTL",67,0)
 Q:Y="Y" PSGSI
"RTN","PSJUTL",68,0)
 Q:Y="!" PSGSI_"^1"
"RTN","PSJUTL",69,0)
 Q ""
"RTN","PSJUTL",70,0)
 ;
"RTN","PSJUTL",71,0)
REDISP ; Redisplay Provider Comments and allow entry of Spec. Instructions.
"RTN","PSJUTL",72,0)
 D CLEAR^VALM1 F X=0:0 S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  W ^(X,0),!
"RTN","PSJUTL",73,0)
 W !! S PSGSI=""
"RTN","PSJUTL",74,0)
 D:PSJTYP'="V" 8^PSGOE81
"RTN","PSJUTL",75,0)
 I PSJTYP="V" D 64^PSIVEDT1 S PSGSI=P("OPI")
"RTN","PSJUTL",76,0)
 Q
"RTN","PSJUTL",77,0)
 ;
"RTN","PSJUTL",78,0)
ENPCHLP1(Y) ; Display help messages for Provider Comment copy.
"RTN","PSJUTL",79,0)
 W !,"Enter ""YES"" to copy Provider Comments into the ",$$ENFIELD(Y)," field",!,"or ""NO"" to bypass",!,"or ""!"" to copy the Provider Comments into the ",$$ENFIELD(PSJTYP)," field",!,"and flag them for display in a BCMA Message Box",!!
"RTN","PSJUTL",80,0)
 Q
"RTN","PSJUTL",81,0)
ENPCHLP2(Y,X) ;
"RTN","PSJUTL",82,0)
 W !,"The Provider Comments entered for this order are longer than the space available",!,"in the ",$$ENFIELD(Y)," field.",!!,"Enter ""YES"" to copy the first ",X-3," characters into the ",$$ENFIELD(Y),!,"field, or ""NO"" to continue.",!!
"RTN","PSJUTL",83,0)
 Q
"RTN","PSJUTL",84,0)
ENBCMA(PSJTYP)  ;
"RTN","PSJUTL",85,0)
 N DIR,X,Y
"RTN","PSJUTL",86,0)
 W !!,"Would you like to flag the ",$$ENFIELD(PSJTYP)," field for display in a BCMA",!,"Message box?"
"RTN","PSJUTL",87,0)
 W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Flag the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",88,0)
 K PSJCOMSI I $G(PSJCOM),$G(PSJORD)'["P" N TEXT S TEXT=$S(PSJTYP="U":$G(PSGSI),1:$G(P("OPI"))) S PSJCOMSI=$$COMSI(PSJCOM,TEXT)
"RTN","PSJUTL",89,0)
 Q:Y="Y" $S($G(PSJTYP)="U":$P(PSGSI,"^")_"^1",1:$P(P("OPI"),"^")_"^1")
"RTN","PSJUTL",90,0)
 Q $S(PSJTYP="U":$P(PSGSI,"^"),1:$P($G(P("OPI")),"^"))
"RTN","PSJUTL",91,0)
ENFIELD(Y) ;
"RTN","PSJUTL",92,0)
 Q $S(Y="V":"Other Print Info",1:"Special Instructions")
"RTN","PSJUTL",93,0)
 ;
"RTN","PSJUTL",94,0)
COMSI(PARENT,INSTR) ;
"RTN","PSJUTL",95,0)
 N DIR,X,Y
"RTN","PSJUTL",96,0)
 W !!!!?15,"** WARNING **",!?5,"This order is part of a complex order."
"RTN","PSJUTL",97,0)
 W !!,"Would you like to copy the ",$$ENFIELD(PSJTYP)
"RTN","PSJUTL",98,0)
 W !,"to the other orders in the complex order?"
"RTN","PSJUTL",99,0)
 S DIR(0)="S^Y:Yes;N:No",DIR("A")="     Copy the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",100,0)
 Q:Y="Y" 1
"RTN","PSJUTL",101,0)
 Q 0
"RTN","PSJUTL",102,0)
 ;
"RTN","PSJUTL",103,0)
ENORL(X) ; Return patient's location as variable ptr.
"RTN","PSJUTL",104,0)
 Q $S(+$G(^DIC(42,+X,44)):+$G(^(44))_";SC(",$D(^DIC(42,+X,0)):+X_";DIC(42,",1:"")
"RTN","PSJUTL",105,0)
 ;
"RTN","PSJUTL",106,0)
ENMARD() ; validate MAR SELECTION DEFAULT string in WARD PARMS file.
"RTN","PSJUTL",107,0)
 N PSJANS,PSJX1,PSJX2,RANGE,Q
"RTN","PSJUTL",108,0)
 S RANGE="1:6" F PSJX1=1:1:6 S RANGE(PSJX1)=""
"RTN","PSJUTL",109,0)
 S:$E(X)="-" X=+RANGE_X S:$E($L(X))="-" X=X_$P(RANGE,":",2)
"RTN","PSJUTL",110,0)
 S PSJANS="" F Q=1:1:$L(X,",") S PSJX1=$P(X,",",Q) D FS Q:'$D(PSJANS)
"RTN","PSJUTL",111,0)
 Q:'$G(PSJANS) 0
"RTN","PSJUTL",112,0)
 S PSJANS=$E(PSJANS,1,$L(PSJANS)-1) F Q=1:1:$L(PSJANS,",") D  Q:'$D(PSJANS)
"RTN","PSJUTL",113,0)
 .I $P(PSJANS,",",Q)=1,$L(PSJANS,",")>1 W !!,"All Medications (1) may not be selected in combination with other types." K PSJANS Q
"RTN","PSJUTL",114,0)
 .W ?47,$P(PSJANS,",",Q)," - ",$P($T(@$P(PSJANS,",",Q)),";;",2),!
"RTN","PSJUTL",115,0)
 S:$G(PSJANS) X=PSJANS Q $G(PSJANS)
"RTN","PSJUTL",116,0)
 ;
"RTN","PSJUTL",117,0)
FS ;
"RTN","PSJUTL",118,0)
 I $S(PSJX1?1.N1"-"1.N:0,PSJX1'?1.N:1,'$D(RANGE(PSJX1)):1,1:","_PSJANS[PSJX1) K PSJANS Q
"RTN","PSJUTL",119,0)
 I PSJX1'["-" S PSJANS=PSJANS_PSJX1_"," Q
"RTN","PSJUTL",120,0)
 S PSJX2=+PSJX1,PSJANS=PSJANS_PSJX2_","
"RTN","PSJUTL",121,0)
 F  S PSJX2=$O(RANGE(PSJX2)) K:$S(X="":1,","_PSJANS[PSJX2:1,1:PSJX2>$P(PSJX1,"-",2)) PSJANS Q:'$D(PSJANS)  S PSJANS=PSJANS_PSJX2_"," Q:PSJX2=$P(PSJX1,"-",2)
"RTN","PSJUTL",122,0)
 Q
"RTN","PSJUTL",123,0)
 ;
"RTN","PSJUTL",124,0)
ENMARDH ;Help text for MAR default answer.
"RTN","PSJUTL",125,0)
 W !!?2,"Enter the number corresponding to the type of orders to be included on MARs",!,"printed for this ward. Multiple types (except 1) may be selected using ""-""",!,"or "","" as delimiters.",!!,"Choose from: ",!
"RTN","PSJUTL",126,0)
 N X F X=1:1:6 W !?13,X," - ",$P($T(@X),";;",2)
"RTN","PSJUTL",127,0)
 W !
"RTN","PSJUTL",128,0)
 Q
"RTN","PSJUTL",129,0)
1 ;;All Medications
"RTN","PSJUTL",130,0)
2 ;;Non-IV Medications only
"RTN","PSJUTL",131,0)
3 ;;IV Piggybacks
"RTN","PSJUTL",132,0)
4 ;;LVPs
"RTN","PSJUTL",133,0)
5 ;;TPNs
"RTN","PSJUTL",134,0)
6 ;;Chemotherapy Medications (IV)
"RTN","PSJUTL",135,0)
 ;
"RTN","PSJUTL",136,0)
EFD ;The following EFD Tags are used to Calculate the Expected First Dose for backdoor
"RTN","PSJUTL",137,0)
 ;orders.  The call to $$ENQ^PSJORP2 is used to actually perform the calculation.
"RTN","PSJUTL",138,0)
 ;The program $$ENQ^PSJORP2 requires the variable INFO to equal the following:
"RTN","PSJUTL",139,0)
 ;BHW;PSJ*5*136
"RTN","PSJUTL",140,0)
 ; INFO (piece 1) = START DATE/TIME      ;PSGNESD (NEW ORDER)
"RTN","PSJUTL",141,0)
 ; INFO (piece 2) = STOP DATE/TIME       ;PSGNEFD (NEW ORDER)
"RTN","PSJUTL",142,0)
 ; INFO (piece 3) = SCHEDULE             ;PSGSCH  (NEW ORDER)
"RTN","PSJUTL",143,0)
 ; INFO (piece 4) = SCHEDULE TYPE        ;PSGST   (NEW ORDER)
"RTN","PSJUTL",144,0)
 ; INFO (piece 5) = ORDERABLE ITEM       ;PSGDRG  (NEW ORDER)
"RTN","PSJUTL",145,0)
 ; INFO (piece 6) = ADMIN TIMES          ;PSGS0Y  (NEW ORDER)
"RTN","PSJUTL",146,0)
 ; 
"RTN","PSJUTL",147,0)
EFDNEW ;Call Here if NEW or RENEWED Order
"RTN","PSJUTL",148,0)
 N INFO
"RTN","PSJUTL",149,0)
 S INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",150,0)
 D EFDDISP
"RTN","PSJUTL",151,0)
 QUIT
"RTN","PSJUTL",152,0)
EFDACT ;Call here if Editing Fields for an ACTIVE order
"RTN","PSJUTL",153,0)
 ; Field 10 = Start Date
"RTN","PSJUTL",154,0)
 ; Field 34 = Stop Date
"RTN","PSJUTL",155,0)
 ; Field 41 = Admin Times
"RTN","PSJUTL",156,0)
 N INFO,KEY,ORDER,LAST
"RTN","PSJUTL",157,0)
 ;Loop Fields to be edited, in order, and determine when to Display expected first dose message
"RTN","PSJUTL",158,0)
 F KEY=1:1 S ORDER=$P(PSGOEER,";",KEY) Q:'$L(ORDER)  I "10^34^41"[$P(ORDER,U,1) S ORDER(KEY)=$P(ORDER,U,1)
"RTN","PSJUTL",159,0)
 ;If there are no entries in ORDER, then were Not Editing Start/Stop or Admin Times
"RTN","PSJUTL",160,0)
 S LAST=$O(ORDER(99),-1) Q:'LAST
"RTN","PSJUTL",161,0)
 ;Only display EFD once, so Quit if this call is not for the Last field in the Edit
"RTN","PSJUTL",162,0)
 S LAST=ORDER(LAST)
"RTN","PSJUTL",163,0)
 I LAST'=PSGF2 Q
"RTN","PSJUTL",164,0)
 S INFO=($G(PSGSD))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",165,0)
 D EFDDISP
"RTN","PSJUTL",166,0)
 QUIT
"RTN","PSJUTL",167,0)
EFDNV ;Call here if Editing Fields for a NON-VERIFIED order
"RTN","PSJUTL",168,0)
 ; Field 10 = Start Date
"RTN","PSJUTL",169,0)
 ; Field 25 = Stop Date
"RTN","PSJUTL",170,0)
 ; Field 39 = Admin Times
"RTN","PSJUTL",171,0)
 N INFO,KEY,ORDER,LAST
"RTN","PSJUTL",172,0)
 ;Check if called during finish process
"RTN","PSJUTL",173,0)
 I '$D(PSGOEER) D  D EFDDISP Q
"RTN","PSJUTL",174,0)
 . S INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",175,0)
 . Q
"RTN","PSJUTL",176,0)
 ;Loop Fields to be edited, in order, and determine when to Display expected first dose message
"RTN","PSJUTL",177,0)
 F KEY=1:1 S ORDER=$P(PSGOEER,";",KEY) Q:'$L(ORDER)  I "10^25^39"[$P(ORDER,U,1) S ORDER(KEY)=$P(ORDER,U,1)
"RTN","PSJUTL",178,0)
 ;If there are no entries in ORDER, then were Not Editing Start/Stop or Admin Times
"RTN","PSJUTL",179,0)
 S LAST=$O(ORDER(99),-1) Q:'LAST
"RTN","PSJUTL",180,0)
 ;Only display EFD once, so Quit if this call is not for the Last field in the Edit
"RTN","PSJUTL",181,0)
 S LAST=ORDER(LAST)
"RTN","PSJUTL",182,0)
 I LAST'=PSGF2 Q
"RTN","PSJUTL",183,0)
 S INFO=($G(PSGSD))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",184,0)
 D EFDDISP
"RTN","PSJUTL",185,0)
 QUIT
"RTN","PSJUTL",186,0)
EFDIV(PSGZZND) ;Set variables for EFD on IV orders.
"RTN","PSJUTL",187,0)
 S PSGNESD=P(2),PSGNEFD=P(3),PSGSCH=P(9),PSGST=$P($G(PSGZZND),"^",5),PSGDRG=$P($G(P("PD")),"^"),PSGS0Y=P(11)
"RTN","PSJUTL",188,0)
 D EFDNEW
"RTN","PSJUTL",189,0)
 W !
"RTN","PSJUTL",190,0)
 Q
"RTN","PSJUTL",191,0)
EFDDISP ;Display Expected First Dose
"RTN","PSJUTL",192,0)
 N Y
"RTN","PSJUTL",193,0)
 Q:$G(PSGST)="OC"!($G(PSGST)="P")
"RTN","PSJUTL",194,0)
 Q:$G(PSGSCH)["ON CALL"!($G(PSGSCH)["ON-CALL")!($G(PSGSCH)["ONCALL")
"RTN","PSJUTL",195,0)
 Q:$G(PSGSCH)["PRN"
"RTN","PSJUTL",196,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSJUTL",197,0)
 ;
"RTN","PSJUTL",198,0)
 S Y=$$ENQ^PSJORP2(PSGP,INFO)
"RTN","PSJUTL",199,0)
 I 'Y S Y="Unable to Calculate"
"RTN","PSJUTL",200,0)
 X ^DD("DD")
"RTN","PSJUTL",201,0)
 W !,"Expected First Dose: ",Y H 2
"RTN","PSJUTL",202,0)
 Q
"VER")
8.0^22.0
"BLD",6460,6)
^158
**END**
**END**
