Released OR*3*245 SEQ #243
Extracted from mail message
**KIDS**:OR*3.0*245^

**INSTALL NAME**
OR*3.0*245
"BLD",6624,0)
OR*3.0*245^ORDER ENTRY/RESULTS REPORTING^0^3070326^y
"BLD",6624,1,0)
^^2^2^3060411^
"BLD",6624,1,1,0)
Adds option for editing quick orders by user.  Fixes bugs when editing 
"BLD",6624,1,2,0)
quick orders.
"BLD",6624,4,0)
^9.64PA^101.44^1
"BLD",6624,4,101.44,0)
101.44
"BLD",6624,4,101.44,2,0)
^9.641^101.441^1
"BLD",6624,4,101.44,2,101.441,0)
QUICK ORDER  (sub-file)
"BLD",6624,4,101.44,2,101.441,1,0)
^9.6411^.01^1
"BLD",6624,4,101.44,2,101.441,1,.01,0)
QUICK ORDER
"BLD",6624,4,101.44,222)
y^n^p^^^^n^^n
"BLD",6624,4,101.44,224)

"BLD",6624,4,"APDD",101.44,101.441)

"BLD",6624,4,"APDD",101.44,101.441,.01)

"BLD",6624,4,"B",101.44,101.44)

"BLD",6624,6)
3^
"BLD",6624,6.3)
2
"BLD",6624,"INIT")
POST^ORY245
"BLD",6624,"KRN",0)
^9.67PA^8989.52^19
"BLD",6624,"KRN",.4,0)
.4
"BLD",6624,"KRN",.401,0)
.401
"BLD",6624,"KRN",.402,0)
.402
"BLD",6624,"KRN",.403,0)
.403
"BLD",6624,"KRN",.5,0)
.5
"BLD",6624,"KRN",.84,0)
.84
"BLD",6624,"KRN",3.6,0)
3.6
"BLD",6624,"KRN",3.8,0)
3.8
"BLD",6624,"KRN",9.2,0)
9.2
"BLD",6624,"KRN",9.8,0)
9.8
"BLD",6624,"KRN",9.8,"NM",0)
^9.68A^9^8
"BLD",6624,"KRN",9.8,"NM",1,0)
ORCMEDT7^^0^B52953829
"BLD",6624,"KRN",9.8,"NM",3,0)
ORY245^^0^B5769223
"BLD",6624,"KRN",9.8,"NM",4,0)
ORCMEDT1^^0^B43946134
"BLD",6624,"KRN",9.8,"NM",5,0)
ORCMEDT4^^0^B65048297
"BLD",6624,"KRN",9.8,"NM",6,0)
ORCMEDT8^^0^B76519203
"BLD",6624,"KRN",9.8,"NM",7,0)
ORWUL^^0^B51080306
"BLD",6624,"KRN",9.8,"NM",8,0)
ORCRC^^0^B33261642
"BLD",6624,"KRN",9.8,"NM",9,0)
ORWDXQ^^0^B14448552
"BLD",6624,"KRN",9.8,"NM","B","ORCMEDT1",4)

"BLD",6624,"KRN",9.8,"NM","B","ORCMEDT4",5)

"BLD",6624,"KRN",9.8,"NM","B","ORCMEDT7",1)

"BLD",6624,"KRN",9.8,"NM","B","ORCMEDT8",6)

"BLD",6624,"KRN",9.8,"NM","B","ORCRC",8)

"BLD",6624,"KRN",9.8,"NM","B","ORWDXQ",9)

"BLD",6624,"KRN",9.8,"NM","B","ORWUL",7)

"BLD",6624,"KRN",9.8,"NM","B","ORY245",3)

"BLD",6624,"KRN",19,0)
19
"BLD",6624,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",6624,"KRN",19,"NM",1,0)
ORCM QUICK ORDERS BY USER^^0
"BLD",6624,"KRN",19,"NM","B","ORCM QUICK ORDERS BY USER",1)

"BLD",6624,"KRN",19.1,0)
19.1
"BLD",6624,"KRN",101,0)
101
"BLD",6624,"KRN",409.61,0)
409.61
"BLD",6624,"KRN",771,0)
771
"BLD",6624,"KRN",870,0)
870
"BLD",6624,"KRN",8989.51,0)
8989.51
"BLD",6624,"KRN",8989.52,0)
8989.52
"BLD",6624,"KRN",8994,0)
8994
"BLD",6624,"KRN","B",.4,.4)

"BLD",6624,"KRN","B",.401,.401)

"BLD",6624,"KRN","B",.402,.402)

"BLD",6624,"KRN","B",.403,.403)

"BLD",6624,"KRN","B",.5,.5)

"BLD",6624,"KRN","B",.84,.84)

"BLD",6624,"KRN","B",3.6,3.6)

"BLD",6624,"KRN","B",3.8,3.8)

"BLD",6624,"KRN","B",9.2,9.2)

"BLD",6624,"KRN","B",9.8,9.8)

"BLD",6624,"KRN","B",19,19)

"BLD",6624,"KRN","B",19.1,19.1)

"BLD",6624,"KRN","B",101,101)

"BLD",6624,"KRN","B",409.61,409.61)

"BLD",6624,"KRN","B",771,771)

"BLD",6624,"KRN","B",870,870)

"BLD",6624,"KRN","B",8989.51,8989.51)

"BLD",6624,"KRN","B",8989.52,8989.52)

"BLD",6624,"KRN","B",8994,8994)

"BLD",6624,"QUES",0)
^9.62^^
"BLD",6624,"REQB",0)
^9.611^1^1
"BLD",6624,"REQB",1,0)
OR*3.0*215^2
"BLD",6624,"REQB","B","OR*3.0*215",1)

"FIA",101.44)
ORDER QUICK VIEW
"FIA",101.44,0)
^ORD(101.44,
"FIA",101.44,0,0)
101.44
"FIA",101.44,0,1)
y^n^p^^^^n^^n
"FIA",101.44,0,10)

"FIA",101.44,0,11)

"FIA",101.44,0,"RLRO")

"FIA",101.44,0,"VR")
3.0^OR
"FIA",101.44,101.44)
1
"FIA",101.44,101.44,10)

"FIA",101.44,101.441)
1
"FIA",101.44,101.441,.01)

"INIT")
POST^ORY245
"KRN",19,17342,-1)
0^1
"KRN",19,17342,0)
ORCM QUICK ORDERS BY USER^Edit personal quick orders by user^^R^^^^^^^^
"KRN",19,17342,1,0)
^19.06^5^5^3060801^^^
"KRN",19,17342,1,1,0)
This option lets you change all quick orders for a specific user.
"KRN",19,17342,1,2,0)
The dialog for creating a quick order is similar to a dialog for entering 
"KRN",19,17342,1,3,0)
an order. The responses you enter will become the pre-defined 
"KRN",19,17342,1,4,0)
responses for this quick order. End users will have the opportunity to
"KRN",19,17342,1,5,0)
edit these pre-defined responses, if desired.
"KRN",19,17342,25)
QCKBYUSR^ORCMEDT7
"KRN",19,17342,"U")
EDIT PERSONAL QUICK ORDERS BY 
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",167,-1)
1^1
"PKG",167,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2971217^2980417^1271
"PKG",167,22,1,"PAH",1,0)
245^3070326^33284
"PKG",167,22,1,"PAH",1,1,0)
^^2^2^3070326
"PKG",167,22,1,"PAH",1,1,1,0)
Adds option for editing quick orders by user.  Fixes bugs when editing 
"PKG",167,22,1,"PAH",1,1,2,0)
quick orders.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","ORCMEDT1")
0^4^B43946134^B41953303
"RTN","ORCMEDT1",1,0)
ORCMEDT1 ;SLC/MKB-QO,Set editor ;11/6/01  13:33
"RTN","ORCMEDT1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**8,46,57,95,110,245**;Dec 17, 1997;Build 2
"RTN","ORCMEDT1",3,0)
OI ; -- Enter/edit generic orderable items
"RTN","ORCMEDT1",4,0)
 N X,Y,DA,DR,DIE,DIC,ID,DLAYGO,ORDG
"RTN","ORCMEDT1",5,0)
 F  S ORDG=$$DGRP Q:ORDG'>0  D  W !!
"RTN","ORCMEDT1",6,0)
 . F  S D="S."_$P(ORDG,U,4) D   Q:Y'>0  S DA=+Y,ID=DA_";99ORD",DR=".01"_$S($P(Y,U,3):";2///^S X=ID;5////"_+ORDG,1:"") D ^DIE W ! ;110
"RTN","ORCMEDT1",7,0)
 .. S DIC="^ORD(101.43,",DIC(0)="AEQL",DLAYGO=101.43,DIE=DIC D IX^DIC ;110
"RTN","ORCMEDT1",8,0)
 Q
"RTN","ORCMEDT1",9,0)
 ;
"RTN","ORCMEDT1",10,0)
DGRP() ; -- Returns sub-display group of Nursing or Other for generic OI
"RTN","ORCMEDT1",11,0)
 N X,Y,DIC,ORGRP,ORDG,ORI
"RTN","ORCMEDT1",12,0)
 F ORI="NURS","OTHER" S ORDG=+$O(^ORD(100.98,"B",ORI,0)) D DG^ORCHANG1(ORDG,"BILD",.ORGRP)
"RTN","ORCMEDT1",13,0)
 S DIC="^ORD(100.98,",DIC(0)="AEQ",DIC("S")="I $D(ORGRP(+Y))"
"RTN","ORCMEDT1",14,0)
 S DIC("A")="Type of Orderable: " D ^DIC
"RTN","ORCMEDT1",15,0)
 S:Y>0 Y=+Y_U_$G(^ORD(100.98,+Y,0))
"RTN","ORCMEDT1",16,0)
 Q Y
"RTN","ORCMEDT1",17,0)
 ;
"RTN","ORCMEDT1",18,0)
QUICK ; -- Enter/edit quick order dialogs
"RTN","ORCMEDT1",19,0)
 N ORQDLG,ORDG
"RTN","ORCMEDT1",20,0)
 F  S ORQDLG=$$DIALOG^ORCMEDT0("Q") Q:ORQDLG="^"  D QCK0(ORQDLG) W !
"RTN","ORCMEDT1",21,0)
 Q
"RTN","ORCMEDT1",22,0)
QCK0(ORQDLG) ; -- edit quick order ORQDLG
"RTN","ORCMEDT1",23,0)
 N ORDIALOG,DA,DR,DIE,DIDEL,ORQUIT,ORVP,ORL,ACTION,FIRST,ORTYPE,ORNAME,X,Y,BEFORCRC,AFTERCRC
"RTN","ORCMEDT1",24,0)
 Q:'$G(ORQDLG)  S DA=ORQDLG,(ORVP,ORL)=0,FIRST=1,ORTYPE="Z"
"RTN","ORCMEDT1",25,0)
 S ORNAME=$$NAME^ORCMEDT4(ORQDLG) Q:(ORNAME="@")!(ORNAME="^")  ;deleted,^
"RTN","ORCMEDT1",26,0)
 S BEFORCRC=$$RAWCRC^ORCMEDT8(ORQDLG)
"RTN","ORCMEDT1",27,0)
 S DR=".01///^S X=ORNAME;2;8;20"_$S(DUZ(0)="@":";30",1:""),DIE="^ORD(101.41,"
"RTN","ORCMEDT1",28,0)
 D ^DIE G:$D(Y)!$D(DTOUT) QR  D GETQDLG^ORCD(ORQDLG) G:'$G(ORDIALOG) QR
"RTN","ORCMEDT1",29,0)
 I '$P($G(^ORD(101.41,ORQDLG,0)),U,7) S X=+$P($G(^ORD(101.41,+ORDIALOG,0)),U,7) S:X $P(^ORD(101.41,ORQDLG,0),U,7)=X,^ORD(101.41,"APKG",X,ORQDLG)=""
"RTN","ORCMEDT1",30,0)
 W ! I $D(^ORD(101.41,+ORDIALOG,3.1)) X ^(3.1) G:$G(ORQUIT) QQ
"RTN","ORCMEDT1",31,0)
Q1 D DIALOG^ORCDLG G:$G(ORQUIT) QQ
"RTN","ORCMEDT1",32,0)
 D DISPLAY^ORCDLG S ACTION=$$OK G:ACTION="^" QQ
"RTN","ORCMEDT1",33,0)
 D:ACTION="P" SAVE^ORCMEDT0,AUTO(ORQDLG) I ACTION="E" S FIRST=0 G Q1 ;fall thru if "C"
"RTN","ORCMEDT1",34,0)
QQ X:$D(^ORD(101.41,+ORDIALOG,4)) ^(4)
"RTN","ORCMEDT1",35,0)
QR S AFTERCRC=$$RAWCRC^ORCMEDT8(ORQDLG)
"RTN","ORCMEDT1",36,0)
 I BEFORCRC'=AFTERCRC D UPDQNAME^ORCMEDT8(ORQDLG) ; Rename personal quick order if modified
"RTN","ORCMEDT1",37,0)
 Q
"RTN","ORCMEDT1",38,0)
 ;
"RTN","ORCMEDT1",39,0)
OK() ; -- Ready to save?
"RTN","ORCMEDT1",40,0)
 N X,Y,DIR S DIR(0)="SAM^P:PLACE;E:EDIT;C:CANCEL;",DIR("B")="PLACE"
"RTN","ORCMEDT1",41,0)
 S DIR("A")="(P)lace, (E)dit, or (C)ancel this quick order? "
"RTN","ORCMEDT1",42,0)
 S DIR("?")="Enter P to save this quick order, or E to change any of the displayed values; enter C to quit without saving these responses"
"RTN","ORCMEDT1",43,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCMEDT1",44,0)
 Q Y
"RTN","ORCMEDT1",45,0)
 ;
"RTN","ORCMEDT1",46,0)
SAVE G SAVE^ORCMEDT0
"RTN","ORCMEDT1",47,0)
 ;
"RTN","ORCMEDT1",48,0)
AUTO(DLG) ; -- set AutoAccept flag for GUI
"RTN","ORCMEDT1",49,0)
 N X,Y,DIR
"RTN","ORCMEDT1",50,0)
 S DIR(0)="YA",DIR("A")="Auto-accept this order? "
"RTN","ORCMEDT1",51,0)
 S DIR("B")=$S($P($G(^ORD(101.41,+DLG,5)),U,8):"YES",1:"NO")
"RTN","ORCMEDT1",52,0)
 S DIR("?")="Enter YES if this order can be placed simply by selecting it, or NO if the dialog should be presented to complete the order."
"RTN","ORCMEDT1",53,0)
 D ^DIR S:Y=1!(Y=0) $P(^ORD(101.41,+DLG,5),U,8)=$S(Y:1,1:"")
"RTN","ORCMEDT1",54,0)
 I $P($G(^ORD(101.41,+DLG,0)),"^",8)'=1&($P($G(^(0)),"^",9)=2)&(Y) D EXPLAIN S $P(^ORD(101.41,+DLG,5),"^",8)="" ;Reset auto-accept to no if explanation required. 
"RTN","ORCMEDT1",55,0)
 Q
"RTN","ORCMEDT1",56,0)
 ;
"RTN","ORCMEDT1",57,0)
SET ; -- Order Sets
"RTN","ORCMEDT1",58,0)
 N ORSET,ORDG
"RTN","ORCMEDT1",59,0)
 F  S ORSET=$$DIALOG^ORCMEDT0("O") Q:ORSET="^"  D SET0(ORSET) W !
"RTN","ORCMEDT1",60,0)
 Q
"RTN","ORCMEDT1",61,0)
SET0(ORSET) ; -- edit order set ORSET
"RTN","ORCMEDT1",62,0)
 N DA,DR,DIE,DIC,DIK,X,Y,SEQ,ITM,LCNT,QUIT,ORNAME Q:'$G(ORSET)
"RTN","ORCMEDT1",63,0)
 S ORNAME=$$NAME^ORCMEDT4(ORSET) Q:(ORNAME="@")!(ORNAME="^")  ;deleted,^
"RTN","ORCMEDT1",64,0)
 S DR=".01///^S X=ORNAME;2;20"_$S(DUZ(0)="@":";30;40",1:""),DA=ORSET
"RTN","ORCMEDT1",65,0)
 S DIE="^ORD(101.41," D ^DIE Q:$D(Y)  Q:'$G(DA)
"RTN","ORCMEDT1",66,0)
S1 I $O(^ORD(101.41,+ORSET,10,0)) D  Q:QUIT  ;Show existing components
"RTN","ORCMEDT1",67,0)
 . W !,"ORDER SET COMPONENTS:" S (SEQ,LCNT,QUIT)=0
"RTN","ORCMEDT1",68,0)
 . S DIK="^ORD(101.41,"_+ORSET_",10,",DA(1)=+ORSET ;just in case
"RTN","ORCMEDT1",69,0)
 . F  S SEQ=$O(^ORD(101.41,+ORSET,10,"B",SEQ)) Q:SEQ'>0  D
"RTN","ORCMEDT1",70,0)
 . . S DA=0 F  S DA=$O(^ORD(101.41,+ORSET,10,"B",SEQ,DA)) Q:DA'>0  D
"RTN","ORCMEDT1",71,0)
 . . . S ITM=$P($G(^ORD(101.41,+ORSET,10,DA,0)),U,2) I ITM'>0 D ^DIK Q
"RTN","ORCMEDT1",72,0)
 . . . S LCNT=LCNT+1 I LCNT>(IOSL-3) R !,"Press <return> to continue ...",X:DTIME S LCNT=0 I X["^" S QUIT=1 Q
"RTN","ORCMEDT1",73,0)
 . . . W !?3,SEQ,?10,$P(^ORD(101.41,ITM,0),U)
"RTN","ORCMEDT1",74,0)
S2 S QUIT=0 F  D  Q:QUIT  W ! ;Enter/edit components
"RTN","ORCMEDT1",75,0)
 . S DIC="^ORD(101.41,"_+ORSET_",10,",DIC(0)="AEQLM",D="B^D"
"RTN","ORCMEDT1",76,0)
 . S DIC("A")="Select COMPONENT SEQUENCE#: ",DIC("P")=$P(^DD(101.41,10,0),U,2)
"RTN","ORCMEDT1",77,0)
 . K DA S DA(1)=+ORSET D MIX^DIC1 I Y'>0 S QUIT=1 Q
"RTN","ORCMEDT1",78,0)
 . S DA=+Y,DIE=DIC,DR=".01;2R" D ^DIE Q:'$G(DA)
"RTN","ORCMEDT1",79,0)
 . I $D(^ORD(101.41,+ORSET,10,DA,0)),'$P(^(0),U,2) S DIK=DIE D ^DIK
"RTN","ORCMEDT1",80,0)
 Q
"RTN","ORCMEDT1",81,0)
 ;
"RTN","ORCMEDT1",82,0)
PROTOCOL ; -- Convert additional protocols to dialogs
"RTN","ORCMEDT1",83,0)
 N X,Y,DIC,ORERR
"RTN","ORCMEDT1",84,0)
 F  S DIC="^ORD(101,",DIC(0)="AEQM" D ^DIC Q:Y'>0  D  W !
"RTN","ORCMEDT1",85,0)
 . S ORP=+Y,ORM=$$MENU Q:ORM="^"  ; What about "^^"-jumping? (ORWARD)
"RTN","ORCMEDT1",86,0)
 . W !,"Converting ..." D ONE(ORP,ORM,.ORERR) I '$G(ORERR) W " done." Q
"RTN","ORCMEDT1",87,0)
 . W " unable to convert.",!,">> "_$P(ORERR,U,2) K ORERR
"RTN","ORCMEDT1",88,0)
 Q
"RTN","ORCMEDT1",89,0)
ONE(PITEM,ORADD,ERROR) ; -- Convert single item protocol, add to menu(s)
"RTN","ORCMEDT1",90,0)
 N PMENU,DMENU,NAME,ORPOS,POS,XUTL,DA,DIK
"RTN","ORCMEDT1",91,0)
 I $D(^ORD(100.99,1,101.41,PITEM,0)) S DA=PITEM,DA(1)=1,DIK="^ORD(100.99,1,101.41," D ^DIK ; delete error entry
"RTN","ORCMEDT1",92,0)
 S NAME=$P($G(^ORD(101,PITEM,0)),U),DITEM=$$ITEM^ORCONVRT(PITEM)
"RTN","ORCMEDT1",93,0)
 I 'DITEM!$D(^ORD(100.99,1,101.41,PITEM,0)) S ERROR=$G(^(0)) Q
"RTN","ORCMEDT1",94,0)
 Q:'$G(ORADD)  ;to add, may enter here with PITEM & DITEM defined
"RTN","ORCMEDT1",95,0)
ADD S PMENU=0 F  S PMENU=$O(^ORD(101,"AD",PITEM,PMENU)) Q:PMENU'>0  D  W "."
"RTN","ORCMEDT1",96,0)
 . S DMENU=$O(^ORD(101.41,"AB",$P(^ORD(101,PMENU,0),U),0)) Q:'DMENU
"RTN","ORCMEDT1",97,0)
 . S ORPOS=$$FINDXUTL(PMENU,PITEM) Q:'ORPOS
"RTN","ORCMEDT1",98,0)
 . S XUTL=$G(^XUTL("XQORM",PMENU_";ORD(101,",ORPOS,0))
"RTN","ORCMEDT1",99,0)
 . S DA=$O(^ORD(101.41,DMENU,10,"B",ORPOS,0)) I DA Q:$P(^ORD(101.41,DMENU,10,DA,0),U,2)=DITEM  S POS=$O(^ORD(101.41,DMENU,10,"B",""),-1),ORPOS=($P(POS,".")+1)_".1",DA="" ; move to end, if collision
"RTN","ORCMEDT1",100,0)
 . S DA=$$NEXT^ORCONVRT(DMENU)
"RTN","ORCMEDT1",101,0)
 . S ^ORD(101.41,DMENU,10,DA,0)=ORPOS_U_DITEM_U_$P(XUTL,U,4)_U_$S($P(XUTL,U,3)'=$P(^ORD(101.41,DITEM,0),U,2):$P(XUTL,U,3),1:"")
"RTN","ORCMEDT1",102,0)
 . S ^ORD(101.41,DMENU,10,"B",ORPOS,DA)="",^ORD(101.41,DMENU,10,"D",DITEM,DA)=""
"RTN","ORCMEDT1",103,0)
 . S ^ORD(101.41,"AD",DITEM,DMENU,DA)="",^ORD(101.41,DMENU,99)=$H
"RTN","ORCMEDT1",104,0)
 Q
"RTN","ORCMEDT1",105,0)
 ;
"RTN","ORCMEDT1",106,0)
FINDXUTL(MENU,ITEM) ; -- Returns position of ITEM in MENU
"RTN","ORCMEDT1",107,0)
 N XQORM,POS
"RTN","ORCMEDT1",108,0)
 S XQORM=MENU_";ORD(101," D XREF^XQORM
"RTN","ORCMEDT1",109,0)
 S POS=0 F  S POS=$O(^XUTL("XQORM",XQORM,POS)) Q:POS'>0  I $P(^(POS,0),U,2)=ITEM Q
"RTN","ORCMEDT1",110,0)
 Q POS
"RTN","ORCMEDT1",111,0)
 ;
"RTN","ORCMEDT1",112,0)
MENU() ; -- Add converted item to menus?
"RTN","ORCMEDT1",113,0)
 N X,Y,DIR S DIR(0)="YA"
"RTN","ORCMEDT1",114,0)
 S DIR("A")="Add this item to the same menus again? ",DIR("B")="YES"
"RTN","ORCMEDT1",115,0)
 S DIR("?")="Enter YES to have this item placed on the same menus in the Order Dialog file as it was in the Protocol file"
"RTN","ORCMEDT1",116,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCMEDT1",117,0)
 Q Y
"RTN","ORCMEDT1",118,0)
EXPLAIN ;Give reason why user can't set auto-accept to yes
"RTN","ORCMEDT1",119,0)
 W !!,"The combination of VERIFY set to NO and ASK FOR ANOTHER ORDER set to",!,"YES, DON'T ASK and AUTO-ACCEPT set to YES is not allowed."
"RTN","ORCMEDT1",120,0)
 W !!,"This combination of settings could cause CPRS to enter into an infinite loop",!,"creating the same order over and over.  If you wish to have"
"RTN","ORCMEDT1",121,0)
 W !,"AUTO-ACCEPT set to YES you must change one of the other two fields",!,"to a different value.",!!,"AUTO-ACCEPT is being set to NO for you."
"RTN","ORCMEDT1",122,0)
 Q
"RTN","ORCMEDT4")
0^5^B65048297^B44329090
"RTN","ORCMEDT4",1,0)
ORCMEDT4 ;SLC/MKB-Prompt Editor ;6/19/01  15:05
"RTN","ORCMEDT4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**8,46,95,245**;Dec 17, 1997;Build 2
"RTN","ORCMEDT4",3,0)
EN ; -- Enter/edit prompts
"RTN","ORCMEDT4",4,0)
 N PRMT F  S PRMT=+$$PROMPT Q:PRMT'>0  D  W !
"RTN","ORCMEDT4",5,0)
 . I $P($G(^ORD(101.41,PRMT,0)),U,7)=$O(^DIC(9.4,"C","OR",0)) D  Q
"RTN","ORCMEDT4",6,0)
 . . N DIC,DA S DIC="^ORD(101.41,",DA=PRMT D EN^DIQ
"RTN","ORCMEDT4",7,0)
 . . W !,"This prompt is not editable!"
"RTN","ORCMEDT4",8,0)
 . D EDIT(PRMT)
"RTN","ORCMEDT4",9,0)
 Q
"RTN","ORCMEDT4",10,0)
 ;
"RTN","ORCMEDT4",11,0)
EDIT(DA) ; -- Edit prompt DA
"RTN","ORCMEDT4",12,0)
 N DR,DIE,NAME,TEXT,TYPE,DOMAIN,OR0,OR1,ORP
"RTN","ORCMEDT4",13,0)
 Q:'$G(DA)  S OR0=$G(^ORD(101.41,DA,0)),OR1=$G(^(1)),ORP=DA
"RTN","ORCMEDT4",14,0)
 S NAME=$$NAME(DA) Q:(NAME="@")!(NAME="^")  ;deleted or quit
"RTN","ORCMEDT4",15,0)
 S TEXT=$$DTEXT($P(OR0,U,2)) Q:TEXT="^"
"RTN","ORCMEDT4",16,0)
 S TYPE=$$DATATYPE($P(OR1,U)) Q:TYPE="^"  S DOMAIN=$P(OR1,U,2)
"RTN","ORCMEDT4",17,0)
 D @$S(TYPE="D"!(TYPE="R"):"DATE",TYPE="F":"TEXT",TYPE="N":"NMBR",TYPE="P":"PTR",TYPE="S":"SET",1:"OTHER") Q:DOMAIN="^"
"RTN","ORCMEDT4",18,0)
 S $P(^ORD(101.41,DA,1),U,1,2)=TYPE_U_DOMAIN,DIE="^ORD(101.41,"
"RTN","ORCMEDT4",19,0)
 S DR=$S(NAME'=$P(OR0,U):".01///^S X=NAME;",1:"")_$S(TEXT'=$P(OR0,U,2):"2///^S X=TEXT;",1:"")_"20"_";13" D ^DIE ;95
"RTN","ORCMEDT4",20,0)
 Q
"RTN","ORCMEDT4",21,0)
 ;
"RTN","ORCMEDT4",22,0)
PROMPT() ; -- Find prompt in #101.41
"RTN","ORCMEDT4",23,0)
 N X,Y,DIC,DLAYGO
"RTN","ORCMEDT4",24,0)
 S DIC="^ORD(101.41,",DIC(0)="AEQLM",DLAYGO=101.41
"RTN","ORCMEDT4",25,0)
 S DIC("A")="Select PROMPT: ",DIC("S")="I $P(^(0),U,4)=""P"""
"RTN","ORCMEDT4",26,0)
 S DIC("DR")="4////P" D ^DIC
"RTN","ORCMEDT4",27,0)
 Q Y
"RTN","ORCMEDT4",28,0)
 ;
"RTN","ORCMEDT4",29,0)
NAME(IFN) ; -- Edit .01 name of dialog IFN
"RTN","ORCMEDT4",30,0)
 N X,Y,DIR,OLDNAME,ISPQO,NODELETE,DA,DIK,TYPE
"RTN","ORCMEDT4",31,0)
 S DIR(0)="FAO^3:63",DIR("A")="NAME: "
"RTN","ORCMEDT4",32,0)
 S OLDNAME=$P($G(^ORD(101.41,IFN,0)),U),ISPQO=0,NODELETE=1
"RTN","ORCMEDT4",33,0)
 S TYPE=$P($G(^ORD(101.41,IFN,0)),U,4)
"RTN","ORCMEDT4",34,0)
 I TYPE="Q",$E(OLDNAME,1,6)="ORWDQ " S ISPQO=1
"RTN","ORCMEDT4",35,0)
 I ISPQO!(TYPE="P") S NODELETE=0 ; OK to delete personal quick orders and prompts
"RTN","ORCMEDT4",36,0)
 S DIR("B")=OLDNAME
"RTN","ORCMEDT4",37,0)
 S DIR("?")="Enter a unique name, up to 63 characters in length."
"RTN","ORCMEDT4",38,0)
NM I $L($P($G(^ORD(101.41,IFN,0)),U,3))>0 W !,!,"(This "_$$GETITM(IFN)_" has been disabled)"
"RTN","ORCMEDT4",39,0)
 D ^DIR S:$D(DTOUT)!(X["^") Y="^"
"RTN","ORCMEDT4",40,0)
 I X="@" D  G NM:X=""
"RTN","ORCMEDT4",41,0)
 . I $D(^ORD(101.41,"AD",IFN)) W $C(7),!,"Cannot delete - currently in use!",! S X="" Q
"RTN","ORCMEDT4",42,0)
 . I $$INUSE^ORCMEDT5(IFN) W $C(7),!,"Cannot delete - currently an Add Orders Menu!",! S X="" Q
"RTN","ORCMEDT4",43,0)
 . I NODELETE D DISABLE(IFN) S X="" Q
"RTN","ORCMEDT4",44,0)
 . I '$$SURE(IFN) S X="" Q  ;reask       
"RTN","ORCMEDT4",45,0)
 . N IDX1,IDX2 S IDX1=0
"RTN","ORCMEDT4",46,0)
 . F  S IDX1=$O(^ORD(101.44,"C",IFN,IDX1)) Q:'IDX1  D
"RTN","ORCMEDT4",47,0)
 . . S IDX2=0
"RTN","ORCMEDT4",48,0)
 . . F  S IDX2=$O(^ORD(101.44,"C",IFN,IDX1,IDX2)) Q:'IDX2  D
"RTN","ORCMEDT4",49,0)
 . . . S DA=IDX2,DA(1)=IDX1,DIK="^ORD(101.44,"_IDX1_",10," D ^DIK
"RTN","ORCMEDT4",50,0)
 . K DA S DA=IFN,DIK="^ORD(101.41," D ^DIK W "  ...deleted." S (X,Y)="@"
"RTN","ORCMEDT4",51,0)
 I ISPQO,Y'="^",X'="@",Y'=OLDNAME D  G NM
"RTN","ORCMEDT4",52,0)
 . W $C(7),!,"Cannot rename a personal quick order",!
"RTN","ORCMEDT4",53,0)
 Q Y
"RTN","ORCMEDT4",54,0)
 ;
"RTN","ORCMEDT4",55,0)
GETITM(DLG) ;
"RTN","ORCMEDT4",56,0)
 N ITM
"RTN","ORCMEDT4",57,0)
 S ITM=$P($G(^ORD(101.41,DLG,0)),U,4)
"RTN","ORCMEDT4",58,0)
 I ITM="Q",$E($P($G(^ORD(101.41,IFN,0)),U),1,6)="ORWDQ " Q "personal quick order"
"RTN","ORCMEDT4",59,0)
 S ITM=$S(ITM="P":"prompt",ITM="D":"dialog",ITM="Q":"quick order",ITM="O":"order set",ITM="A":"action",ITM="M":"menu",1:"item")
"RTN","ORCMEDT4",60,0)
 Q ITM
"RTN","ORCMEDT4",61,0)
 ;
"RTN","ORCMEDT4",62,0)
SURE(DLG) ; -- Are you sure?
"RTN","ORCMEDT4",63,0)
 N X,Y,DIR,ITM,DA
"RTN","ORCMEDT4",64,0)
 S ITM=$$GETITM(DLG)
"RTN","ORCMEDT4",65,0)
 S DIR(0)="YA",DIR("A")="Are you sure you want to delete this "_ITM_"? "
"RTN","ORCMEDT4",66,0)
 S DIR("?")="Enter YES if you want to delete this "_ITM_" from the file, or NO to quit."
"RTN","ORCMEDT4",67,0)
 D ^DIR
"RTN","ORCMEDT4",68,0)
 Q +Y
"RTN","ORCMEDT4",69,0)
 ;
"RTN","ORCMEDT4",70,0)
DISABLE(DLG) ; Disable item - return true if disabled
"RTN","ORCMEDT4",71,0)
 N DIR,X,Y,ITM,DA,DR,DIE,DIDEL,DISABLED
"RTN","ORCMEDT4",72,0)
 W $C(7),!,!,"Deletion not allowed outside of FileMan."
"RTN","ORCMEDT4",73,0)
 S ITM=$$GETITM(DLG)
"RTN","ORCMEDT4",74,0)
 S DISABLED=$L($P($G(^ORD(101.41,IFN,0)),U,3))>0
"RTN","ORCMEDT4",75,0)
 S DIR(0)="YA"
"RTN","ORCMEDT4",76,0)
 I DISABLED D  I 1
"RTN","ORCMEDT4",77,0)
 . S DIR("A",1)="This "_ITM_" is already disabled."
"RTN","ORCMEDT4",78,0)
 . S DIR("A")="Would you like to edit the disable message? "
"RTN","ORCMEDT4",79,0)
 . S DIR("?")="Enter YES if you want to edit the disabled message, or NO to quit."
"RTN","ORCMEDT4",80,0)
 . S DIR("B")="NO"
"RTN","ORCMEDT4",81,0)
 E  D
"RTN","ORCMEDT4",82,0)
 . S DIR("A")="Would you like to disable this "_ITM_"? "
"RTN","ORCMEDT4",83,0)
 . S DIR("?")="Enter YES if you want to disable this "_ITM_", or NO to quit."
"RTN","ORCMEDT4",84,0)
 . S DIR("B")="YES"
"RTN","ORCMEDT4",85,0)
 D ^DIR
"RTN","ORCMEDT4",86,0)
 I '+Y Q
"RTN","ORCMEDT4",87,0)
 W !,"Enter disable message:"
"RTN","ORCMEDT4",88,0)
 S DA=DLG,DR="3",DIE="^ORD(101.41,"
"RTN","ORCMEDT4",89,0)
 D ^DIE
"RTN","ORCMEDT4",90,0)
 Q
"RTN","ORCMEDT4",91,0)
 ;
"RTN","ORCMEDT4",92,0)
DTEXT(X) ; -- Enter/edit display text of prompt
"RTN","ORCMEDT4",93,0)
 N Y,DIR
"RTN","ORCMEDT4",94,0)
 S DIR(0)="FA^3:63",DIR("A")="TEXT OF PROMPT: " S:$L($G(X)) DIR("B")=X
"RTN","ORCMEDT4",95,0)
 S DIR("?")="Enter the text of this prompt, including any punctuation and spaces"
"RTN","ORCMEDT4",96,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCMEDT4",97,0)
 Q Y
"RTN","ORCMEDT4",98,0)
 ;
"RTN","ORCMEDT4",99,0)
DATATYPE(X) ; -- Returns desired datatype for prompt
"RTN","ORCMEDT4",100,0)
 N DIR,Y S DIR("A")="TYPE OF PROMPT: "
"RTN","ORCMEDT4",101,0)
 S DIR(0)="SAM^D:date/time;R:relative date/time;F:free text;N:numeric;S:set of codes;P:pointer to a file;Y:yes/no;W:word processing;"
"RTN","ORCMEDT4",102,0)
 S:$L($G(X)) DIR("B")=$P($P(DIR(0),X_":",2),";")
"RTN","ORCMEDT4",103,0)
 S DIR("?")="Select the type of data to be entered at this prompt"
"RTN","ORCMEDT4",104,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCMEDT4",105,0)
 Q Y
"RTN","ORCMEDT4",106,0)
 ;
"RTN","ORCMEDT4",107,0)
DATE ; -- date parameters
"RTN","ORCMEDT4",108,0)
 N X,Y,DIR,ORX,ORT,ORS,ORR
"RTN","ORCMEDT4",109,0)
 S X=$P(DOMAIN,":",3),ORX=X["X",ORT=X["T",ORS=X["S",ORR=X["R",DIR(0)="YA"
"RTN","ORCMEDT4",110,0)
 ; Still need to handle Earliest and Latest dates allowed
"RTN","ORCMEDT4",111,0)
 S DIR("A")="CAN DATE BE IMPRECISE? ",DIR("B")=$S(ORX:"NO",1:"YES")
"RTN","ORCMEDT4",112,0)
 D ^DIR S ORX='Y I $D(DUOUT)!($D(DTOUT)) S DOMAIN="^" Q
"RTN","ORCMEDT4",113,0)
 S DIR("A")="CAN TIME OF DAY BE ENTERED? ",DIR("B")=$S(ORT:"YES",1:"NO")
"RTN","ORCMEDT4",114,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) S DOMAIN="^" Q
"RTN","ORCMEDT4",115,0)
 S ORT=Y I 'Y S (ORS,ORR)=0 G DQ
"RTN","ORCMEDT4",116,0)
 S DIR("A")="CAN SECONDS BE ENTERED? ",DIR("B")=$S(ORS:"YES",1:"NO")
"RTN","ORCMEDT4",117,0)
 D ^DIR S ORS=Y I $D(DUOUT)!($D(DTOUT)) S DOMAIN="^" Q
"RTN","ORCMEDT4",118,0)
 S DIR("A")="IS TIME REQUIRED? ",DIR("B")=$S(ORR:"YES",1:"NO")
"RTN","ORCMEDT4",119,0)
 D ^DIR S ORR=Y I $D(DUOUT)!($D(DTOUT)) S DOMAIN="^" Q
"RTN","ORCMEDT4",120,0)
DQ S DOMAIN="::E"_$S(ORX:"X",1:"")_$S(ORT:"T",1:"")_$S(ORS:"S",1:"")_$S(ORR:"R",1:"")
"RTN","ORCMEDT4",121,0)
 Q
"RTN","ORCMEDT4",122,0)
 ;
"RTN","ORCMEDT4",123,0)
TEXT ; -- free text
"RTN","ORCMEDT4",124,0)
 N X,Y,DIR
"RTN","ORCMEDT4",125,0)
 S DIR(0)="NAO^1:245",DIR("A")="MINIMUM LENGTH: "
"RTN","ORCMEDT4",126,0)
 S:+DOMAIN DIR("B")=+DOMAIN
"RTN","ORCMEDT4",127,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) S DOMAIN="^" Q
"RTN","ORCMEDT4",128,0)
 S $P(DOMAIN,":")=Y,DIR("A")="MAXIMUM LENGTH: " K DIR("B")
"RTN","ORCMEDT4",129,0)
 S:$P(DOMAIN,":",2) DIR("B")=$P(DOMAIN,":",2)
"RTN","ORCMEDT4",130,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) S DOMAIN="^" Q
"RTN","ORCMEDT4",131,0)
 S $P(DOMAIN,":",2)=Y
"RTN","ORCMEDT4",132,0)
 ; Opt pattern match ??
"RTN","ORCMEDT4",133,0)
 Q
"RTN","ORCMEDT4",134,0)
 ;
"RTN","ORCMEDT4",135,0)
NMBR ; -- numeric
"RTN","ORCMEDT4",136,0)
 N X,Y,DIR,STR
"RTN","ORCMEDT4",137,0)
 S DIR(0)="NAO^::"_+$P(DOMAIN,":",3),DIR("A")="INCLUSIVE LOWER BOUND: ",DIR("B")=+DOMAIN ;95
"RTN","ORCMEDT4",138,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) S DOMAIN="^" Q
"RTN","ORCMEDT4",139,0)
 S STR=Y,DIR(0)="NAO^"_Y_"::"_+$P(DOMAIN,":",3),DIR("A")="INCLUSIVE UPPER BOUND: ",DIR("B")=+$P(DOMAIN,":",2) ;95
"RTN","ORCMEDT4",140,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) S DOMAIN="^" Q
"RTN","ORCMEDT4",141,0)
 S STR=STR_":"_Y,DIR(0)="NAO",DIR("A")="MAXIMUM NUMBER OF FRACTIONAL DIGITS: ",DIR("B")=+$P(DOMAIN,":",3) ;95
"RTN","ORCMEDT4",142,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) S DOMAIN="^" Q
"RTN","ORCMEDT4",143,0)
 S DOMAIN=STR_":"_Y
"RTN","ORCMEDT4",144,0)
 Q
"RTN","ORCMEDT4",145,0)
 ;
"RTN","ORCMEDT4",146,0)
PTR ; -- pointer
"RTN","ORCMEDT4",147,0)
 I DUZ(0)="@"!($L(DOMAIN)&'DOMAIN) D ROOT Q  ; allow file root
"RTN","ORCMEDT4",148,0)
 N X,Y,DIR,DIE,DR,FILE,STR,SCR
"RTN","ORCMEDT4",149,0)
 S DIR(0)="PA^1:AEQM",DIR("A")="POINT TO WHICH FILE: "
"RTN","ORCMEDT4",150,0)
 S:$L(DOMAIN) DIR("B")=$$FILENAME(+DOMAIN)
"RTN","ORCMEDT4",151,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) S DOMAIN="^" Q
"RTN","ORCMEDT4",152,0)
 S FILE=+Y,STR=$P(DOMAIN,":",2) S:'$L(STR) STR="EQ"
"RTN","ORCMEDT4",153,0)
 S DOMAIN=FILE_":"_STR
"RTN","ORCMEDT4",154,0)
 Q
"RTN","ORCMEDT4",155,0)
 ;
"RTN","ORCMEDT4",156,0)
ROOT ; -- pointer via file root
"RTN","ORCMEDT4",157,0)
 N X,Y,DIR,STR
"RTN","ORCMEDT4",158,0)
 S DIR(0)="FA^1:100",DIR("A")="POINT TO WHICH FILE: "
"RTN","ORCMEDT4",159,0)
 S DIR("?")="Enter the file or subfile by name, file number, or global root (without the leading '^')."
"RTN","ORCMEDT4",160,0)
 S:$L(DOMAIN) DIR("B")=$S(+DOMAIN:$$FILENAME(+DOMAIN),1:$P(DOMAIN,":"))
"RTN","ORCMEDT4",161,0)
RT1 D ^DIR I $D(DTOUT)!$D(DUOUT) S DOMAIN="^" Q
"RTN","ORCMEDT4",162,0)
 I $L(DOMAIN),$L(X),X=$G(DIR("B")) S Y=$P(DOMAIN,":") G RTQ ; default
"RTN","ORCMEDT4",163,0)
 I +Y=Y S X=$$FILENAME(+Y) I $L(X) W "   "_X G RTQ ; valid file number
"RTN","ORCMEDT4",164,0)
 I $L(Y),+Y'=Y D  G:$D(Y) RTQ ; valid root or name
"RTN","ORCMEDT4",165,0)
 . I "(,"[$E(Y,$L(Y)) Q:$D(@(U_Y_"0)"))  ; valid file root
"RTN","ORCMEDT4",166,0)
 . S DIC=1,DIC(0)="EQ",X=Y D ^DIC S:Y>0 Y=+Y K:Y'>0 Y
"RTN","ORCMEDT4",167,0)
 W $C(7),!,"Invalid file!" G RT1
"RTN","ORCMEDT4",168,0)
RTQ S STR=$P(DOMAIN,":",2),DOMAIN=Y_":"_$S($L(STR):STR,1:"EQ")
"RTN","ORCMEDT4",169,0)
 Q
"RTN","ORCMEDT4",170,0)
 ;
"RTN","ORCMEDT4",171,0)
SET ; -- set of codes
"RTN","ORCMEDT4",172,0)
 N I,ORI,ORJ,ITEM,X,Y,ORQUIT,NEWLNG S ORJ=0
"RTN","ORCMEDT4",173,0)
 F I=1:1:$L(DOMAIN,";") S:$P(DOMAIN,";",I)'="" ITEM(I)=$P(DOMAIN,";",I)
"RTN","ORCMEDT4",174,0)
 S ORI=0 F  S ORI=$O(ITEM(ORI)) Q:ORI'>0  D SETEDIT Q:$G(ORQUIT)!(Y="")
"RTN","ORCMEDT4",175,0)
 I $G(ORQUIT) S DOMAIN="^" Q
"RTN","ORCMEDT4",176,0)
 S ORI=ORJ F  S ORI=ORI+1 D SETEDIT Q:$G(ORQUIT)!(Y="")  ; new codes
"RTN","ORCMEDT4",177,0)
 I $G(ORQUIT) S DOMAIN="^" Q
"RTN","ORCMEDT4",178,0)
 ; now done editing, rebuild DOMAIN
"RTN","ORCMEDT4",179,0)
 S I=0,DOMAIN="" F  S I=$O(ITEM(I)) Q:I'>0  S NEWLNG=$L(DOMAIN)+$L(ITEM(I))+1 S:NEWLNG'>235 DOMAIN=DOMAIN_ITEM(I)_";" I NEWLNG>235 W $C(7),!,"Domain too long - unable to store all codes."  H 2 Q
"RTN","ORCMEDT4",180,0)
 Q
"RTN","ORCMEDT4",181,0)
SETEDIT ; -- edit each item in DOMAIN
"RTN","ORCMEDT4",182,0)
 N DIR,TEXT,CODE S DIR(0)="FAO^1:5",DIR("A")="INTERNALLY-STORED CODE: "
"RTN","ORCMEDT4",183,0)
 S CODE=$P($G(ITEM(ORI)),":"),TEXT=$P($G(ITEM(ORI)),":",2),ORJ=ORI
"RTN","ORCMEDT4",184,0)
 S:$L(CODE) DIR("B")=CODE
"RTN","ORCMEDT4",185,0)
 D ^DIR S:$D(DUOUT)!($D(DTOUT)) ORQUIT=1 Q:$G(ORQUIT)!(X="")
"RTN","ORCMEDT4",186,0)
 I X="@" K ITEM(ORI) Q
"RTN","ORCMEDT4",187,0)
 S CODE=X W "  WILL STAND FOR: " W:$L(TEXT) TEXT_"// "
"RTN","ORCMEDT4",188,0)
SE1 R Y:DTIME I '$T!(Y["^") S ORQUIT=1 Q
"RTN","ORCMEDT4",189,0)
 S:Y="" Y=TEXT I "@"[Y W $C(7),!,"  Required value!",!,"'"_CODE_"' WILL STAND FOR: " W:$L(TEXT) TEXT_"// " G SE1
"RTN","ORCMEDT4",190,0)
 S TEXT=Y,ITEM(ORI)=CODE_":"_TEXT
"RTN","ORCMEDT4",191,0)
 Q
"RTN","ORCMEDT4",192,0)
 ;
"RTN","ORCMEDT4",193,0)
OTHER ; -- no parameters needed
"RTN","ORCMEDT4",194,0)
 S DOMAIN=""
"RTN","ORCMEDT4",195,0)
 Q
"RTN","ORCMEDT4",196,0)
 ;
"RTN","ORCMEDT4",197,0)
FILENAME(FNUM) ; -- Returns name of file FNUM
"RTN","ORCMEDT4",198,0)
 N ORY,Y D:$G(FNUM) FILE^DID(+FNUM,,"NAME","ORY")
"RTN","ORCMEDT4",199,0)
 S Y=$G(ORY("NAME"))
"RTN","ORCMEDT4",200,0)
 Q Y
"RTN","ORCMEDT7")
0^1^B52953829^n/a
"RTN","ORCMEDT7",1,0)
ORCMEDT7 ;SLC/JM-QO,Edit Quick Orders By User ;2/1/06
"RTN","ORCMEDT7",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**245**;Dec 17, 1997;Build 2
"RTN","ORCMEDT7",3,0)
 Q
"RTN","ORCMEDT7",4,0)
QCKBYUSR ; Edit quick orders by user
"RTN","ORCMEDT7",5,0)
 N ORDGINFO,ORTEXT,ORIEN,ORFMDATA,ORUSER,ORDG,ORLINE0
"RTN","ORCMEDT7",6,0)
 K ^TMP("ORWDQUSR",$J)
"RTN","ORCMEDT7",7,0)
 S ORUSER=0
"RTN","ORCMEDT7",8,0)
 F  S ORDGINFO=$$QCKUSRDG(ORUSER) Q:ORDGINFO=0  S:ORDGINFO<0 ORUSER=0 I +ORDGINFO>0,$D(^ORD(101.41,+ORDGINFO,0)) D
"RTN","ORCMEDT7",9,0)
 . S ORIEN=$P(ORDGINFO,U,1)
"RTN","ORCMEDT7",10,0)
 . S ORFMDATA=$P(ORDGINFO,U,2)
"RTN","ORCMEDT7",11,0)
 . S ORUSER=$P(ORDGINFO,U,3)
"RTN","ORCMEDT7",12,0)
 . S ORLINE0=$G(^ORD(101.41,ORIEN,0))
"RTN","ORCMEDT7",13,0)
 . S ORTEXT=$P(ORLINE0,U,2)
"RTN","ORCMEDT7",14,0)
 . S ORDG=+$P(ORLINE0,U,5)
"RTN","ORCMEDT7",15,0)
 . D QCK0^ORCMEDT1(ORIEN) ; edit quick order
"RTN","ORCMEDT7",16,0)
 . D VERIFYDA(.ORFMDATA,ORIEN)
"RTN","ORCMEDT7",17,0)
 . I +ORFMDATA D
"RTN","ORCMEDT7",18,0)
 . . ; If quick order not deleted, and display text changes, change 101.44 display text to match
"RTN","ORCMEDT7",19,0)
 . . I $D(^ORD(101.41,ORIEN,0)),ORTEXT'=$P(^ORD(101.41,ORIEN,0),U,2) D
"RTN","ORCMEDT7",20,0)
 . . . N DIE,DA,DR,DIDEL
"RTN","ORCMEDT7",21,0)
 . . . S DA(1)=$P(ORFMDATA,";",1)
"RTN","ORCMEDT7",22,0)
 . . . S DIE="^ORD(101.44,"_DA(1)_",10,"
"RTN","ORCMEDT7",23,0)
 . . . S DA=$P(ORFMDATA,";",2)
"RTN","ORCMEDT7",24,0)
 . . . ; 101.44 Display text holds 132 chars, 101.41 only 80. so this is ok
"RTN","ORCMEDT7",25,0)
 . . . S DR="2///"_$P(^ORD(101.41,ORIEN,0),U,2)
"RTN","ORCMEDT7",26,0)
 . . . D ^DIE
"RTN","ORCMEDT7",27,0)
 . K ^TMP("ORWDQUSR",$J,"A",ORUSER) ; Force reload of user Quick Order info
"RTN","ORCMEDT7",28,0)
 . W !
"RTN","ORCMEDT7",29,0)
 K ^TMP("ORWDQUSR",$J)
"RTN","ORCMEDT7",30,0)
 Q
"RTN","ORCMEDT7",31,0)
QCKUSRDG(ORLSTUSR) ; Get quick order dialog by user
"RTN","ORCMEDT7",32,0)
 N DIC,DIR,DA,X,Y,ORIDX,ORUSER,ORLEN,ORPRE,ORDIALOG,ORHEADER,ORGROUP,ORCOUNT,USERNAME
"RTN","ORCMEDT7",33,0)
 N DTOUT,DUOUT,DIROUT,DIRUT,OREXIT,ORINPUT,ORDGNAME,ORDGIEN,ORLASTGP,ORFMDATA,ORFIRST
"RTN","ORCMEDT7",34,0)
 S ORDIALOG=0
"RTN","ORCMEDT7",35,0)
 S ORUSER=$$GETUSER(ORLSTUSR)
"RTN","ORCMEDT7",36,0)
 I ORUSER>0 D
"RTN","ORCMEDT7",37,0)
 . S ORPRE="ORWDQ USR"_ORUSER,ORLEN=$L(ORPRE)
"RTN","ORCMEDT7",38,0)
 . S ORIDX=$O(^ORD(101.44,"B",ORPRE))
"RTN","ORCMEDT7",39,0)
 . I $E(ORIDX,1,ORLEN)=ORPRE D  I 1
"RTN","ORCMEDT7",40,0)
 . . D QULIST(ORUSER)
"RTN","ORCMEDT7",41,0)
 . . S USERNAME=$P($G(^VA(200,ORUSER,0)),U,1)
"RTN","ORCMEDT7",42,0)
 . . S ORHEADER=USERNAME_" personal quick orders:"
"RTN","ORCMEDT7",43,0)
 . . S ORCOUNT=0,ORIDX=0,OREXIT=0,ORLASTGP=U,ORFIRST=1
"RTN","ORCMEDT7",44,0)
 . . F  S ORIDX=$O(^TMP("ORWDQUSR",$J,"A",ORUSER,ORIDX)) Q:'+ORIDX  D  Q:+OREXIT!(ORDIALOG>0)
"RTN","ORCMEDT7",45,0)
 . . . S ORCOUNT=ORCOUNT+1
"RTN","ORCMEDT7",46,0)
 . . . I ORCOUNT=1 D
"RTN","ORCMEDT7",47,0)
 . . . . I ORFIRST S ORFIRST=0 W !,!
"RTN","ORCMEDT7",48,0)
 . . . . W !,ORHEADER,!
"RTN","ORCMEDT7",49,0)
 . . . S ORGROUP=$O(^TMP("ORWDQUSR",$J,"A",ORUSER,ORIDX,""))
"RTN","ORCMEDT7",50,0)
 . . . S ORDGIEN=$O(^TMP("ORWDQUSR",$J,"A",ORUSER,ORIDX,ORGROUP,""))
"RTN","ORCMEDT7",51,0)
 . . . S ORFMDATA=$O(^TMP("ORWDQUSR",$J,"A",ORUSER,ORIDX,ORGROUP,ORDGIEN,""))
"RTN","ORCMEDT7",52,0)
 . . . S ORDGNAME=$G(^TMP("ORWDQUSR",$J,"A",ORUSER,ORIDX,ORGROUP,ORDGIEN,ORFMDATA))
"RTN","ORCMEDT7",53,0)
 . . . I (ORCOUNT=1)!(ORGROUP'=ORLASTGP) D
"RTN","ORCMEDT7",54,0)
 . . . . S ORLASTGP=ORGROUP
"RTN","ORCMEDT7",55,0)
 . . . . S ORCOUNT=ORCOUNT+1
"RTN","ORCMEDT7",56,0)
 . . . . W ?4,ORGROUP,!
"RTN","ORCMEDT7",57,0)
 . . . W ?7,ORIDX,?12,ORDGNAME,!
"RTN","ORCMEDT7",58,0)
 . . . I ORCOUNT'<18 D
"RTN","ORCMEDT7",59,0)
 . . . . S DIR("A",1)="Press <RETURN> to see more, '^' to exit this list, OR"
"RTN","ORCMEDT7",60,0)
 . . . . S ORDIALOG=$$QUIDX()
"RTN","ORCMEDT7",61,0)
 . . . . S ORCOUNT=0
"RTN","ORCMEDT7",62,0)
 . . I ORDIALOG'>0,'+OREXIT D
"RTN","ORCMEDT7",63,0)
 . . . S ORIDX=$O(^TMP("ORWDQUSR",$J,"A",ORUSER,999999),-1)
"RTN","ORCMEDT7",64,0)
 . . . I ORIDX<1 D  I 1
"RTN","ORCMEDT7",65,0)
 . . . . ; If user had quick orders, but doesn't any more, there will be false positives in "B" xref
"RTN","ORCMEDT7",66,0)
 . . . . D QULIST(0)
"RTN","ORCMEDT7",67,0)
 . . . . K ^TMP("ORWDQUSR",$J,"B",USERNAME)
"RTN","ORCMEDT7",68,0)
 . . . . D SHOWUSRS
"RTN","ORCMEDT7",69,0)
 . . . E  D
"RTN","ORCMEDT7",70,0)
 . . . . S DIR("A",1)=""
"RTN","ORCMEDT7",71,0)
 . . . . S ORDIALOG=$$QUIDX()
"RTN","ORCMEDT7",72,0)
 . E  D SHOWUSRS
"RTN","ORCMEDT7",73,0)
 Q ORDIALOG
"RTN","ORCMEDT7",74,0)
GETUSER(ORUSER) ;
"RTN","ORCMEDT7",75,0)
 I +ORUSER Q ORUSER
"RTN","ORCMEDT7",76,0)
 N DIC,Y,X,DLAYGO,DINUM
"RTN","ORCMEDT7",77,0)
 S DIC="^VA(200,",DIC(0)="AEMQ"
"RTN","ORCMEDT7",78,0)
 D ^DIC
"RTN","ORCMEDT7",79,0)
 Q +Y
"RTN","ORCMEDT7",80,0)
SHOWUSRS ;
"RTN","ORCMEDT7",81,0)
 S ORDIALOG=-1 ; Repeats loop
"RTN","ORCMEDT7",82,0)
 W !,!,$P($G(^VA(200,ORUSER,0)),U,1)_" does not have any personal quick orders."
"RTN","ORCMEDT7",83,0)
 S DIR("A")="Would you like to see a list of users with personal quick orders"
"RTN","ORCMEDT7",84,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","ORCMEDT7",85,0)
 D ^DIR
"RTN","ORCMEDT7",86,0)
 I +Y D  I 1
"RTN","ORCMEDT7",87,0)
 . W !,!,"   Choose from:",!
"RTN","ORCMEDT7",88,0)
 . D QULIST(0)
"RTN","ORCMEDT7",89,0)
 . S ORUSER="",ORIDX=2,OREXIT=0
"RTN","ORCMEDT7",90,0)
 . F  S ORUSER=$O(^TMP("ORWDQUSR",$J,"B",ORUSER)) Q:OREXIT!(ORUSER="")  D  Q:OREXIT
"RTN","ORCMEDT7",91,0)
 . . W "   ",ORUSER,!
"RTN","ORCMEDT7",92,0)
 . . S ORIDX=ORIDX+1
"RTN","ORCMEDT7",93,0)
 . . I ORIDX=22 D
"RTN","ORCMEDT7",94,0)
 . . . S ORIDX=0
"RTN","ORCMEDT7",95,0)
 . . . R "   '^' TO STOP: ",ORINPUT:$G(DTIME,300)
"RTN","ORCMEDT7",96,0)
 . . . E  S OREXIT=1
"RTN","ORCMEDT7",97,0)
 . . . W $C(13),$J("",20),$C(13) Q:OREXIT
"RTN","ORCMEDT7",98,0)
 . . . I ORINPUT[U S OREXIT=1
"RTN","ORCMEDT7",99,0)
 E  I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) S ORDIALOG=0
"RTN","ORCMEDT7",100,0)
 Q
"RTN","ORCMEDT7",101,0)
QUIDX() ; Get quick order dialog info 
"RTN","ORCMEDT7",102,0)
 N ORGROUP,ORDGIEN,ORFMDATA,ORRESULT
"RTN","ORCMEDT7",103,0)
 S DIR("A")="CHOOSE 1-"_ORIDX_": "
"RTN","ORCMEDT7",104,0)
 S DIR(0)="NOA^1:"_ORIDX
"RTN","ORCMEDT7",105,0)
 D ^DIR
"RTN","ORCMEDT7",106,0)
 I +Y>0,+Y'>ORIDX D  Q ORRESULT
"RTN","ORCMEDT7",107,0)
 . S ORGROUP=$O(^TMP("ORWDQUSR",$J,"A",ORUSER,+Y,""))
"RTN","ORCMEDT7",108,0)
 . S ORDGIEN=$O(^TMP("ORWDQUSR",$J,"A",ORUSER,+Y,ORGROUP,""))
"RTN","ORCMEDT7",109,0)
 . I $$CONFLICT(ORUSER,ORDGIEN) S OREXIT=1,ORRESULT=-1 Q
"RTN","ORCMEDT7",110,0)
 . S ORFMDATA=$O(^TMP("ORWDQUSR",$J,"A",ORUSER,+Y,ORGROUP,ORDGIEN,""))
"RTN","ORCMEDT7",111,0)
 . S ORRESULT=ORDGIEN_U_ORFMDATA_U_ORUSER
"RTN","ORCMEDT7",112,0)
 W !
"RTN","ORCMEDT7",113,0)
 I Y[U S OREXIT=1
"RTN","ORCMEDT7",114,0)
 Q -1 ; -1 Value repeats the enter name loop / 0 exits loop
"RTN","ORCMEDT7",115,0)
QULIST(ORUSER) ; Build user info
"RTN","ORCMEDT7",116,0)
 N PRE,ID,LEN
"RTN","ORCMEDT7",117,0)
 S PRE="ORWDQ USR"
"RTN","ORCMEDT7",118,0)
 I ORUSER=0 D  Q
"RTN","ORCMEDT7",119,0)
 . ; "B" node is list of all users with Quick Orders
"RTN","ORCMEDT7",120,0)
 . I $D(^TMP("ORWDQUSR",$J,"B")) Q
"RTN","ORCMEDT7",121,0)
 . N LASTUSER,USERNAME,USER
"RTN","ORCMEDT7",122,0)
 . S LASTUSER=0,ID=PRE,LEN=$L(PRE)
"RTN","ORCMEDT7",123,0)
 . F  S ID=$O(^ORD(101.44,"B",ID))  Q:($E(ID,1,LEN)'=PRE)  D
"RTN","ORCMEDT7",124,0)
 . . S USER=$P($E(ID,LEN+1,999)," ")
"RTN","ORCMEDT7",125,0)
 . . I USER'=LASTUSER D
"RTN","ORCMEDT7",126,0)
 . . . S LASTUSER=USER
"RTN","ORCMEDT7",127,0)
 . . . S USERNAME=$P($G(^VA(200,USER,0)),U,1)
"RTN","ORCMEDT7",128,0)
 . . . S ^TMP("ORWDQUSR",$J,"B",USERNAME)=""
"RTN","ORCMEDT7",129,0)
 . Q
"RTN","ORCMEDT7",130,0)
 ;
"RTN","ORCMEDT7",131,0)
 ; "A" node is list of quick orders for an individual user
"RTN","ORCMEDT7",132,0)
 ; Temp array nodes are "ORWDQUSR",$J,"A"
"RTN","ORCMEDT7",133,0)
 ;   User IEN, Index Number, Display Group, Quick Order IEN, 101.44 IEN
"RTN","ORCMEDT7",134,0)
 ;   Data value is Quick Order Name - (Name can be 132 chars so can't be node)
"RTN","ORCMEDT7",135,0)
 ;
"RTN","ORCMEDT7",136,0)
 I $D(^TMP("ORWDQUSR",$J,"A",ORUSER)) Q
"RTN","ORCMEDT7",137,0)
 N GROUP,IDX,NUMBER,QOINDEX,QCKORDER,ORFMDATA
"RTN","ORCMEDT7",138,0)
 S PRE=PRE_ORUSER,ID=PRE,NUMBER=0,LEN=$L(PRE)
"RTN","ORCMEDT7",139,0)
 F  S ID=$O(^ORD(101.44,"B",ID))  Q:($E(ID,1,LEN)'=PRE)  D
"RTN","ORCMEDT7",140,0)
 . S GROUP=$P(ID," ",3,999)
"RTN","ORCMEDT7",141,0)
 . S GROUP=$O(^ORD(100.98,"B",GROUP,0))
"RTN","ORCMEDT7",142,0)
 . I +GROUP S GROUP=$P($G(^ORD(100.98,GROUP,0)),U,1)
"RTN","ORCMEDT7",143,0)
 . S IDX=$O(^ORD(101.44,"B",ID,0)),QOINDEX=0
"RTN","ORCMEDT7",144,0)
 . F  S QOINDEX=$O(^ORD(101.44,IDX,10,QOINDEX)) Q:'+QOINDEX  D
"RTN","ORCMEDT7",145,0)
 . . S QCKORDER=$G(^ORD(101.44,IDX,10,QOINDEX,0))
"RTN","ORCMEDT7",146,0)
 . . I +QCKORDER,+$D(^ORD(101.41,+QCKORDER)) D
"RTN","ORCMEDT7",147,0)
 . . . S NUMBER=NUMBER+1
"RTN","ORCMEDT7",148,0)
 . . . S ORFMDATA=IDX_";"_QOINDEX
"RTN","ORCMEDT7",149,0)
 . . . S ^TMP("ORWDQUSR",$J,"A",ORUSER,NUMBER,GROUP,$P(QCKORDER,U,1),ORFMDATA)=$P(QCKORDER,U,2)
"RTN","ORCMEDT7",150,0)
 Q
"RTN","ORCMEDT7",151,0)
VERIFYDA(ORFMDATA,ORIEN) ;
"RTN","ORCMEDT7",152,0)
 ; Make sure FileMan pointers are still correct
"RTN","ORCMEDT7",153,0)
 ; - may have changes via CPRS GUI or QCK0^ORCMEDT1(ORIEN)
"RTN","ORCMEDT7",154,0)
 N IDX1,IDX2,IEN
"RTN","ORCMEDT7",155,0)
 S IDX1=$P(ORFMDATA,";",1)
"RTN","ORCMEDT7",156,0)
 S IDX2=$P(ORFMDATA,";",2)
"RTN","ORCMEDT7",157,0)
 S IEN=$P($G(^ORD(101.44,IDX1,10,IDX2,0)),U,1)
"RTN","ORCMEDT7",158,0)
 I IEN=ORIEN Q
"RTN","ORCMEDT7",159,0)
 S ORFMDATA=""
"RTN","ORCMEDT7",160,0)
 S IDX2=0
"RTN","ORCMEDT7",161,0)
 F  S IDX2=$O(^ORD(101.44,IDX1,10,IDX2)) Q:'+IDX2  D  Q:+ORFMDATA
"RTN","ORCMEDT7",162,0)
 . I $P($G(^ORD(101.44,IDX1,10,IDX2,0)),U,1)=ORIEN S ORFMDATA=IDX1_";"_IDX2
"RTN","ORCMEDT7",163,0)
 Q
"RTN","ORCMEDT7",164,0)
CONFLICT(ORUSER,DIALOG) ; Determine if another user shares the personal quick order
"RTN","ORCMEDT7",165,0)
 N DG,OTHERS,USR,NAME,ABORT,DIR,Y,DA,X,DTOUT,DUOUT,DIROUT,DIRUT,COUNT,TEMP
"RTN","ORCMEDT7",166,0)
 S (DG,ABORT)=0
"RTN","ORCMEDT7",167,0)
 F  S DG=$O(^ORD(101.44,"C",DIALOG,DG)) Q:'+DG  D
"RTN","ORCMEDT7",168,0)
 . S USR=$P($G(^ORD(101.44,DG,0)),U,1)
"RTN","ORCMEDT7",169,0)
 . I $P(USR," ",1)="ORWDQ" D
"RTN","ORCMEDT7",170,0)
 . . S USR=$P(USR," ",2)
"RTN","ORCMEDT7",171,0)
 . . I $E(USR,1,3)="USR" D
"RTN","ORCMEDT7",172,0)
 . . . S USR=$E(USR,4,999)
"RTN","ORCMEDT7",173,0)
 . . . I USR'=ORUSER D
"RTN","ORCMEDT7",174,0)
 . . . . S NAME=$P($G(^VA(200,USR,0)),U,1)
"RTN","ORCMEDT7",175,0)
 . . . . S OTHERS(NAME)=""
"RTN","ORCMEDT7",176,0)
 I $D(OTHERS) D
"RTN","ORCMEDT7",177,0)
 . S OTHERS($P($G(^VA(200,ORUSER,0)),U,1))=""
"RTN","ORCMEDT7",178,0)
 . W !,$C(7),!,!
"RTN","ORCMEDT7",179,0)
 . W "             *********************",!
"RTN","ORCMEDT7",180,0)
 . W "             *****  WARNING  *****",!
"RTN","ORCMEDT7",181,0)
 . W "             *********************",!,!
"RTN","ORCMEDT7",182,0)
 . W "  Multiple users share this personal quick order.",!
"RTN","ORCMEDT7",183,0)
 . W "  Modifying this personal quick order will change",!
"RTN","ORCMEDT7",184,0)
 . W "  it for all of the following users:",!,!
"RTN","ORCMEDT7",185,0)
 . S NAME="",COUNT=7
"RTN","ORCMEDT7",186,0)
 . F  S NAME=$O(OTHERS(NAME)) Q:NAME=""  D  Q:ABORT
"RTN","ORCMEDT7",187,0)
 . . S COUNT=COUNT+1
"RTN","ORCMEDT7",188,0)
 . . I COUNT>20 D  Q:ABORT
"RTN","ORCMEDT7",189,0)
 . . . S COUNT=0,TEMP=""
"RTN","ORCMEDT7",190,0)
 . . . W !
"RTN","ORCMEDT7",191,0)
 . . . R "  Press <RETURN> to continue, '^' to exit: ",TEMP:$G(DTIME,300)
"RTN","ORCMEDT7",192,0)
 . . . E  S ABORT=1
"RTN","ORCMEDT7",193,0)
 . . . W $C(13),$J("",50),$C(13) Q:ABORT
"RTN","ORCMEDT7",194,0)
 . . . I (TEMP[U)!$D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) S ABORT=1
"RTN","ORCMEDT7",195,0)
 . . W "    ",NAME,!
"RTN","ORCMEDT7",196,0)
 . I 'ABORT D
"RTN","ORCMEDT7",197,0)
 . . S DIR("A")="Are you sure you want to edit this personal quick order? "
"RTN","ORCMEDT7",198,0)
 . . S DIR(0)="YA",DIR("B")="NO" W ! D ^DIR
"RTN","ORCMEDT7",199,0)
 . . W !
"RTN","ORCMEDT7",200,0)
 . . I '+Y S ABORT=1
"RTN","ORCMEDT7",201,0)
 Q ABORT
"RTN","ORCMEDT8")
0^6^B76519203^n/a
"RTN","ORCMEDT8",1,0)
ORCMEDT8 ;SLC/JM-QO, Generate quick order CRC ;3/3/06
"RTN","ORCMEDT8",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**245**;Dec 17, 1997;Build 2
"RTN","ORCMEDT8",3,0)
 Q
"RTN","ORCMEDT8",4,0)
 ;
"RTN","ORCMEDT8",5,0)
UPDQNAME(ORIEN) ; Rename personal quick order name if needed
"RTN","ORCMEDT8",6,0)
 N OLDNAME,NEWNAME,DA,DR,DIE,DIDEL
"RTN","ORCMEDT8",7,0)
 I $P($G(^ORD(101.41,ORIEN,0)),U,4)'="Q" Q
"RTN","ORCMEDT8",8,0)
 S OLDNAME=$P($G(^ORD(101.41,ORIEN,0)),U,1)
"RTN","ORCMEDT8",9,0)
 I $E($P(OLDNAME,U),1,6)'="ORWDQ " Q
"RTN","ORCMEDT8",10,0)
 S NEWNAME="ORWDQ "_$$CRC4QCK(ORIEN)
"RTN","ORCMEDT8",11,0)
 I OLDNAME'=NEWNAME D
"RTN","ORCMEDT8",12,0)
 . S NEWNAME=$$ENSURNEW(NEWNAME)
"RTN","ORCMEDT8",13,0)
 . S DA=ORIEN,DR=".01///"_NEWNAME,DIE="^ORD(101.41," D ^DIE
"RTN","ORCMEDT8",14,0)
 Q
"RTN","ORCMEDT8",15,0)
 ;
"RTN","ORCMEDT8",16,0)
ENSURNEW(NAME) ; Ensures the name is a new entry
"RTN","ORCMEDT8",17,0)
 N IDX,BASENAME,ABC,NEWNAME
"RTN","ORCMEDT8",18,0)
 S NEWNAME=NAME
"RTN","ORCMEDT8",19,0)
 S IDX=0,BASENAME=NEWNAME,ABC=97 ; Find an unused name
"RTN","ORCMEDT8",20,0)
 F  S IDX=$O(^ORD(101.41,"B",NEWNAME,0))  Q:'IDX  D
"RTN","ORCMEDT8",21,0)
 . S NEWNAME=BASENAME_$C(ABC) ; append letter 'a' - 'z'
"RTN","ORCMEDT8",22,0)
 . S ABC=ABC+1 I ABC>122 S BASENAME=BASENAME_"a",ABC=97
"RTN","ORCMEDT8",23,0)
 Q NEWNAME
"RTN","ORCMEDT8",24,0)
RAWCRC(ORIEN) ; Get a raw CRC value to determine if a record has changed
"RTN","ORCMEDT8",25,0)
 N ORDATA,RESULT,ADDCRLF,LASTLINE,LASTIDX,OLDCRC
"RTN","ORCMEDT8",26,0)
 S (RESULT,OLDCRC)=""
"RTN","ORCMEDT8",27,0)
 I $P($G(^ORD(101.41,ORIEN,0)),U,4)'="Q" G RWQ
"RTN","ORCMEDT8",28,0)
 I $E($P($G(^ORD(101.41,ORIEN,0)),U),1,6)'="ORWDQ " G RWQ
"RTN","ORCMEDT8",29,0)
 D LOADRSP^ORWDX(.ORDATA,ORIEN)
"RTN","ORCMEDT8",30,0)
 D PARSE
"RTN","ORCMEDT8",31,0)
RWQ Q RESULT
"RTN","ORCMEDT8",32,0)
 ;
"RTN","ORCMEDT8",33,0)
 ; The following code attemps to duplicate the CRC calculated by the Delphi code
"RTN","ORCMEDT8",34,0)
 ; in CPRS for quick orders.  It will not match all the time, since not all the
"RTN","ORCMEDT8",35,0)
 ; data neded to make the determination is stored on the M side, but it does it's best.
"RTN","ORCMEDT8",36,0)
 ;
"RTN","ORCMEDT8",37,0)
CRC4QCK(ORIEN) ; Get CRC for a personal quick order
"RTN","ORCMEDT8",38,0)
 N ORDATA,DISPGRP,DEFDLG,FORMID,RESULT,FORMDATA,ADDCRLF
"RTN","ORCMEDT8",39,0)
 N LASTLINE,LASTIDX,OLDCRC,FORMINFO,IDINFO,NEXTFORM
"RTN","ORCMEDT8",40,0)
 S RESULT="",FORMID=0
"RTN","ORCMEDT8",41,0)
 ; Must be personal quick order
"RTN","ORCMEDT8",42,0)
 I $P($G(^ORD(101.41,ORIEN,0)),U,4)'="Q" G EXT
"RTN","ORCMEDT8",43,0)
 I $E($P($G(^ORD(101.41,ORIEN,0)),U),1,6)'="ORWDQ " G EXT
"RTN","ORCMEDT8",44,0)
 S OLDCRC=$E($P($G(^ORD(101.41,ORIEN,0)),U,1),7,14)
"RTN","ORCMEDT8",45,0)
 F  Q:(RESULT=OLDCRC)!(FORMID="")  D
"RTN","ORCMEDT8",46,0)
 . K ORDATA D LOADRSP^ORWDX(.ORDATA,ORIEN)
"RTN","ORCMEDT8",47,0)
 . ; First pass don't use any form id - get baseline CRC
"RTN","ORCMEDT8",48,0)
 . I FORMID=1 D  Q:FORMID=""
"RTN","ORCMEDT8",49,0)
 . . S FORMID=""
"RTN","ORCMEDT8",50,0)
 . . S DISPGRP=$P($G(^ORD(101.41,ORIEN,0)),U,5) I '+DISPGRP Q  ; Must have a valid display group
"RTN","ORCMEDT8",51,0)
 . . S DEFDLG=$P($G(^ORD(100.98,DISPGRP,0)),U,4) I '+DEFDLG Q  ; Display group must have a valid default dialog
"RTN","ORCMEDT8",52,0)
 . . D FORMID^ORWDXM(.FORMID,DEFDLG) I '+FORMID S FORMID="" Q  ; Default dialog must have a valid windows form ID
"RTN","ORCMEDT8",53,0)
 . . I (FORMID=130)!(FORMID=140) D
"RTN","ORCMEDT8",54,0)
 . . . N NEWFORM D CHK94^ORWDPS1(.NEWFORM) I NEWFORM=1 S FORMID=135
"RTN","ORCMEDT8",55,0)
 . . D FORMINFO(.FORMINFO,.IDINFO,.NEXTFORM)
"RTN","ORCMEDT8",56,0)
 . I FORMID=0 S FORMID=1
"RTN","ORCMEDT8",57,0)
 . E  D SORTDATA I FORMDATA="" S FORMID="" Q  ; Updates FORMID
"RTN","ORCMEDT8",58,0)
 . D PARSE
"RTN","ORCMEDT8",59,0)
EXT Q RESULT
"RTN","ORCMEDT8",60,0)
 ;
"RTN","ORCMEDT8",61,0)
PARSE ; Parse Data
"RTN","ORCMEDT8",62,0)
 N DATAIDX,IDX,LINE,CODE,CRCDATA,OUTPUT,DONE,ISMASTER,LASTMSTR,FIRST,P3,LK4SPACE
"RTN","ORCMEDT8",63,0)
 S DATAIDX="",(IDX,DONE,ISMASTER,LASTMSTR,LASTIDX)=0,LASTLINE=""
"RTN","ORCMEDT8",64,0)
 F  D GETLINE Q:DONE  D  Q:DONE
"RTN","ORCMEDT8",65,0)
 . I ISMASTER D
"RTN","ORCMEDT8",66,0)
 . . S OUTPUT=+$P(LINE,U,1)_U_+$P(LINE,U,2)_U
"RTN","ORCMEDT8",67,0)
 . . S IDX=IDX+1,CRCDATA(IDX)=OUTPUT
"RTN","ORCMEDT8",68,0)
 . . S FIRST=1,P3=$P(LINE,U,3)
"RTN","ORCMEDT8",69,0)
 . . I P3="COMMENT" S ADDCRLF=1,LK4SPACE=1
"RTN","ORCMEDT8",70,0)
 . . E  D
"RTN","ORCMEDT8",71,0)
 . . . I P3="STATEMENTS" S ADDCRLF=1,LK4SPACE=0
"RTN","ORCMEDT8",72,0)
 . . . E  S ADDCRLF=0,LK4SPACE=0
"RTN","ORCMEDT8",73,0)
 . . F  D GETLINE Q:DONE!ISMASTER  D
"RTN","ORCMEDT8",74,0)
 . . . I CODE="i" S IDX=IDX+1,CRCDATA(IDX)=LINE
"RTN","ORCMEDT8",75,0)
 . . . I CODE="t" D
"RTN","ORCMEDT8",76,0)
 . . . . I FIRST S FIRST=0,OUTPUT=LINE
"RTN","ORCMEDT8",77,0)
 . . . . E  D
"RTN","ORCMEDT8",78,0)
 . . . . . I $L(LASTLINE)=0 S OUTPUT=$C(13)_$C(10)_LINE Q
"RTN","ORCMEDT8",79,0)
 . . . . . I LK4SPACE,$L(LASTLINE)>1,$E(LASTLINE,$L(LASTLINE))=" " S OUTPUT=""
"RTN","ORCMEDT8",80,0)
 . . . . . E  D
"RTN","ORCMEDT8",81,0)
 . . . . . . I ADDCRLF S OUTPUT=$C(13)_$C(10) ; ,$L(LASTLINE)<65
"RTN","ORCMEDT8",82,0)
 . . . . . . E  S OUTPUT=" "
"RTN","ORCMEDT8",83,0)
 . . . . . S OUTPUT=OUTPUT_LINE
"RTN","ORCMEDT8",84,0)
 . . . . S LASTLINE=LINE
"RTN","ORCMEDT8",85,0)
 . . . . S IDX=IDX+1,CRCDATA(IDX)=OUTPUT
"RTN","ORCMEDT8",86,0)
 . . . . I ADDCRLF S LASTIDX=IDX
"RTN","ORCMEDT8",87,0)
 . . I ISMASTER,'DONE S LASTMSTR=1
"RTN","ORCMEDT8",88,0)
 S RESULT=$$CRC4ARRY^ORCRC(.CRCDATA)
"RTN","ORCMEDT8",89,0)
 ; Same data can generate 2 different CRCs - CRLF on end of comments are stripped
"RTN","ORCMEDT8",90,0)
 I OLDCRC'="",RESULT'=OLDCRC,LASTIDX>0 D
"RTN","ORCMEDT8",91,0)
 . S CRCDATA(LASTIDX)=CRCDATA(LASTIDX)_$C(13)_$C(10)
"RTN","ORCMEDT8",92,0)
 . S RESULT=$$CRC4ARRY^ORCRC(.CRCDATA)
"RTN","ORCMEDT8",93,0)
 Q
"RTN","ORCMEDT8",94,0)
 ;
"RTN","ORCMEDT8",95,0)
SORTDATA ; Sorts data by fields according to FormID
"RTN","ORCMEDT8",96,0)
 N IN,OUT,LINE,DATA,ID,CODE,INDEX,END,IDX,RTN,SUBFORM,SUBFORM2,SUBIDX,NODE
"RTN","ORCMEDT8",97,0)
 S SUBFORM="",SUBFORM2=""
"RTN","ORCMEDT8",98,0)
 S FORMDATA=$G(FORMINFO(FORMID)) I FORMDATA="" Q
"RTN","ORCMEDT8",99,0)
 I $E(FORMDATA,1,2)'="00" S RTN="SUBID"_$E(FORMDATA,1,2) D @RTN S FORMDATA=$G(FORMINFO(FORMID)) I FORMDATA="" Q
"RTN","ORCMEDT8",100,0)
 S IN=0,OUT=0,END=1000000,IDX=0
"RTN","ORCMEDT8",101,0)
 F  S IN=$O(ORDATA(IN)) Q:'+IN  D
"RTN","ORCMEDT8",102,0)
 . S LINE=ORDATA(IN)
"RTN","ORCMEDT8",103,0)
 . I $E(LINE)="~" D
"RTN","ORCMEDT8",104,0)
 . . S IDX=1,ID=$P(LINE,U,3),CODE="."_IDINFO(ID)_".",NODE=$P(LINE,U,2)
"RTN","ORCMEDT8",105,0)
 . . S INDEX=$F(FORMDATA,CODE),SUBIDX=0
"RTN","ORCMEDT8",106,0)
 . . I INDEX=0,SUBFORM'="" D
"RTN","ORCMEDT8",107,0)
 . . . S INDEX=($F(FORMDATA,".ZZZ."))
"RTN","ORCMEDT8",108,0)
 . . . I INDEX>0 S SUBIDX=$F(SUBFORM,CODE) I SUBIDX<1 S INDEX=0
"RTN","ORCMEDT8",109,0)
 . . I INDEX=0,SUBFORM2'="" D
"RTN","ORCMEDT8",110,0)
 . . . S INDEX=($F(FORMDATA,".XXX."))
"RTN","ORCMEDT8",111,0)
 . . . I INDEX>0 S SUBIDX=$F(SUBFORM2,CODE) I SUBIDX<1 S INDEX=0
"RTN","ORCMEDT8",112,0)
 . . I INDEX=0 S OUT=END,END=END+1
"RTN","ORCMEDT8",113,0)
 . . E  D
"RTN","ORCMEDT8",114,0)
 . . . I SUBIDX>0 D  I 1
"RTN","ORCMEDT8",115,0)
 . . . . S OUT=(INDEX-4)*250
"RTN","ORCMEDT8",116,0)
 . . . . S SUBIDX=(SUBIDX-4)\4
"RTN","ORCMEDT8",117,0)
 . . . . S OUT=OUT+SUBIDX+(NODE*20)
"RTN","ORCMEDT8",118,0)
 . . . E  S OUT=(INDEX-4)*250
"RTN","ORCMEDT8",119,0)
 . I IDX>0 D
"RTN","ORCMEDT8",120,0)
 . . S DATA(OUT,IDX)=LINE
"RTN","ORCMEDT8",121,0)
 . . S IDX=IDX+1
"RTN","ORCMEDT8",122,0)
 K ORDATA
"RTN","ORCMEDT8",123,0)
 S (IN,OUT,INDEX)=0
"RTN","ORCMEDT8",124,0)
 F  S IN=$O(DATA(IN)) Q:'+IN  D
"RTN","ORCMEDT8",125,0)
 . F  S INDEX=$O(DATA(IN,INDEX)) Q:'+INDEX  D
"RTN","ORCMEDT8",126,0)
 . . S OUT=OUT+1
"RTN","ORCMEDT8",127,0)
 . . S ORDATA(OUT)=DATA(IN,INDEX)
"RTN","ORCMEDT8",128,0)
 S FORMID=$G(NEXTFORM(FORMID))
"RTN","ORCMEDT8",129,0)
 Q
"RTN","ORCMEDT8",130,0)
 ;
"RTN","ORCMEDT8",131,0)
GETLINE ;
"RTN","ORCMEDT8",132,0)
 I LASTMSTR S LASTMSTR=0 Q
"RTN","ORCMEDT8",133,0)
 S DATAIDX=$O(ORDATA(DATAIDX))
"RTN","ORCMEDT8",134,0)
 S DONE=(DATAIDX="")
"RTN","ORCMEDT8",135,0)
 I 'DONE S CODE=$E(ORDATA(DATAIDX),1),LINE=$E(ORDATA(DATAIDX),2,9999),ISMASTER=(CODE="~")
"RTN","ORCMEDT8",136,0)
 Q
"RTN","ORCMEDT8",137,0)
 ;
"RTN","ORCMEDT8",138,0)
FORMINFO(FORMINFO,IDINFO,NEXTFORM) ; populates FORMINFO,IDINFO and NEXTFORM arrays
"RTN","ORCMEDT8",139,0)
 N IDX,LINE,CODE,RTN,NEXT
"RTN","ORCMEDT8",140,0)
 S IDX=1
"RTN","ORCMEDT8",141,0)
 F  S LINE=$E($T(FORMTBL+IDX),21,999) Q:$L(LINE)<1  D
"RTN","ORCMEDT8",142,0)
 . S CODE=$E(LINE,1,3),NEXT=$E(LINE,5,7),LINE=$E(LINE,9,999)
"RTN","ORCMEDT8",143,0)
 . S FORMINFO(CODE)=LINE
"RTN","ORCMEDT8",144,0)
 . I NEXT'="   " S NEXTFORM(CODE)=NEXT
"RTN","ORCMEDT8",145,0)
 . S IDX=IDX+1
"RTN","ORCMEDT8",146,0)
 S IDX=1
"RTN","ORCMEDT8",147,0)
 F  S LINE=$E($T(IDTABLE+IDX),4,999) Q:$L(LINE)<1  D
"RTN","ORCMEDT8",148,0)
 . S CODE=$E(LINE,1,3),LINE=$E(LINE,5,99)
"RTN","ORCMEDT8",149,0)
 . S IDINFO(LINE)=CODE,IDX=IDX+1
"RTN","ORCMEDT8",150,0)
 Q
"RTN","ORCMEDT8",151,0)
 ;
"RTN","ORCMEDT8",152,0)
HASCODE(CODE) ; scans data for code
"RTN","ORCMEDT8",153,0)
 N RESULT,IDX,LINE S IDX="",RESULT=0
"RTN","ORCMEDT8",154,0)
 F  S IDX=$O(ORDATA(IDX)) Q:IDX=""  D  Q:IDX=""
"RTN","ORCMEDT8",155,0)
 . S LINE=ORDATA(IDX)
"RTN","ORCMEDT8",156,0)
 . I $E(LINE)="~" D
"RTN","ORCMEDT8",157,0)
 . . S LINE=$P(LINE,U,3)
"RTN","ORCMEDT8",158,0)
 . . I LINE=CODE S RESULT=1,IDX=""
"RTN","ORCMEDT8",159,0)
 Q RESULT
"RTN","ORCMEDT8",160,0)
 ;
"RTN","ORCMEDT8",161,0)
SUBID ; SubID codes are used to change the form ID depending on depending on data
"RTN","ORCMEDT8",162,0)
 ; Data below is FormID;SubID.list of ID codes in order of use
"RTN","ORCMEDT8",163,0)
 ; SubID's are used to change the FormID depending on data values.
"RTN","ORCMEDT8",164,0)
 Q
"RTN","ORCMEDT8",165,0)
SUBID01 ; Generic Meds dialog
"RTN","ORCMEDT8",166,0)
 N INPT,COMPLEX
"RTN","ORCMEDT8",167,0)
 S INPT=$$HASCODE("NOW"),COMPLEX=$$HASCODE("DAYS")
"RTN","ORCMEDT8",168,0)
 I INPT D  I 1
"RTN","ORCMEDT8",169,0)
 . I COMPLEX S FORMID="INX",SUBFORM=$G(FORMINFO("MDX"))
"RTN","ORCMEDT8",170,0)
 . E  S FORMID="INP"
"RTN","ORCMEDT8",171,0)
 E  I COMPLEX S FORMID="OPX",SUBFORM=$G(FORMINFO("MDX"))
"RTN","ORCMEDT8",172,0)
 Q
"RTN","ORCMEDT8",173,0)
SUBID02 ; IV Meds
"RTN","ORCMEDT8",174,0)
 S SUBFORM=$G(FORMINFO("IVL"))
"RTN","ORCMEDT8",175,0)
 Q
"RTN","ORCMEDT8",176,0)
SUBID03 ; Delphi code adds URGENCY prompt that does not exist in dialog on M side
"RTN","ORCMEDT8",177,0)
 I '$$HASCODE("URGENCY") D
"RTN","ORCMEDT8",178,0)
 . N X
"RTN","ORCMEDT8",179,0)
 . S X=$O(ORDATA(999999),-1)+1
"RTN","ORCMEDT8",180,0)
 . S ORDATA(X)="~0^1^URGENCY"
"RTN","ORCMEDT8",181,0)
 Q
"RTN","ORCMEDT8",182,0)
SUBID04 ; Blood Bank will probably be wrong - quick orders not working in v26
"RTN","ORCMEDT8",183,0)
 S SUBFORM=$G(FORMINFO("BBK"))
"RTN","ORCMEDT8",184,0)
 S SUBFORM2=$G(FORMINFO("BBX"))
"RTN","ORCMEDT8",185,0)
 Q
"RTN","ORCMEDT8",186,0)
SUBID05 ; Diet
"RTN","ORCMEDT8",187,0)
 I FORMID="117" S SUBFORM=$G(FORMINFO("DLN"))
"RTN","ORCMEDT8",188,0)
 I FORMID="TBF" S SUBFORM=$G(FORMINFO("TBL"))
"RTN","ORCMEDT8",189,0)
 Q
"RTN","ORCMEDT8",190,0)
FORMTBL ; Form Table - Forms allowing personal quick orders, as of CPRS GUI v26 (OR*3*215)
"RTN","ORCMEDT8",191,0)
 ;;Consult         ;110;CS2;00.ORD.CLS.URG.PLA.MSC.COD.PRV.COM.
"RTN","ORCMEDT8",192,0)
 ;;                ;CS2;   ;00.ORD.CLS.URG.PLA.MSC.COD.COM.PRV.
"RTN","ORCMEDT8",193,0)
 ;;Procedure       ;112;PR2;00.SER.ORD.CLS.URG.PLA.MSC.COD.PRV.COM.
"RTN","ORCMEDT8",194,0)
 ;;                ;PR2;PR3;00.SER.ORD.COM.CLS.URG.PLA.MSC.COD.PRV.
"RTN","ORCMEDT8",195,0)
 ;;                ;PR3;   ;00.SER.ORD.CLS.URG.PLA.MSC.COD.COM.PRV.
"RTN","ORCMEDT8",196,0)
 ;;Diet            ;117;TBF;05.STT.STP.ZZZ.COM.DEL.CAN.
"RTN","ORCMEDT8",197,0)
 ;;                ;TBF;OPM;05.ZZZ.COM.CAN.
"RTN","ORCMEDT8",198,0)
 ;;                ;OPM;   ;00.ORD.MEL.STT.STP.SCH.COM.DEL.
"RTN","ORCMEDT8",199,0)
 ;;                ;DLN;   ;00.ORD.
"RTN","ORCMEDT8",200,0)
 ;;                ;TBL;   ;00.ORD.STR.INS.
"RTN","ORCMEDT8",201,0)
 ;;Lab             ;120;   ;00.ORD.SAM.SPE.URG.COM.COL.STT.SCH.DAY.
"RTN","ORCMEDT8",202,0)
 ;;Blood Bank      ;125;BB2;04.ZZZ.DTE.COL.URG.COM.STT.MSC.REA.YN0.XXX.
"RTN","ORCMEDT8",203,0)
 ;;                ;BB2;   ;04.ZZZ.URG.COM.COL.DTE.MSC.REA.YN0.STT.XXX.
"RTN","ORCMEDT8",204,0)
 ;;                ;BBK;   ;00.ORD.QTY.MDF.SPC.
"RTN","ORCMEDT8",205,0)
 ;;                ;BBX;   ;00.RES.
"RTN","ORCMEDT8",206,0)
 ;;Inpatient Meds  ;130;   ;00.ORD.DRG.INS.ROU.SCH.URG.COM.
"RTN","ORCMEDT8",207,0)
 ;;Generic Meds    ;135;   ;01.ORD.INS.DRG.DOS.STR.NAM.ROU.SCH.URG.COM.SUP.QTY.REF.SC0.PCK.PI0.SIG.
"RTN","ORCMEDT8",208,0)
 ;;                ;INP;   ;00.ORD.INS.DRG.DOS.STR.NAM.ROU.SCH.URG.COM.NOW.SIG.
"RTN","ORCMEDT8",209,0)
 ;;                ;OPX;   ;00.ORD.STR.NAM.DRG.ZZZ.URG.COM.SUP.QTY.REF.SC0.PCK.PI0.SIG.
"RTN","ORCMEDT8",210,0)
 ;;                ;INX;   ;00.ORD.STR.NAM.DRG.ZZZ.URG.COM.NOW.SIG.
"RTN","ORCMEDT8",211,0)
 ;;                ;MDX;   ;00.INS.DOS.ROU.SCH.DAY.CNJ.
"RTN","ORCMEDT8",212,0)
 ;;Outpatient Meds ;140;   ;00.ORD.DRG.INS.MSC.ROU.SCH.QTY.REF.PCK.URG.COM.SC0.
"RTN","ORCMEDT8",213,0)
 ;;Non-VA Meds     ;145;   ;03.ORD.INS.DRG.DOS.STR.NAM.ROU.SCH.URG.COM.STT.STA.NOW.SIG.
"RTN","ORCMEDT8",214,0)
 ;;Radiology       ;160;   ;00.ORD.STT.URG.MOD.CLS.IML.PRG.YN0.PRE.COM.MDF.PRV.CON.RSH.LOC.
"RTN","ORCMEDT8",215,0)
 ;;IV Meds         ;180;   ;02.ZZZ.RAT.URG.DAY.COM.SCH.
"RTN","ORCMEDT8",216,0)
 ;;                ;IVL;   ;00.ORD.VOL.ADD.STR.UNT.
"RTN","ORCMEDT8",217,0)
 ;;
"RTN","ORCMEDT8",218,0)
IDTABLE ; ID table - returns codes used in the form table IDINFO("LONGNAME")=SHORNAME
"RTN","ORCMEDT8",219,0)
 ;;ADD;ADDITIVE
"RTN","ORCMEDT8",220,0)
 ;;CAN;CANCEL
"RTN","ORCMEDT8",221,0)
 ;;CLS;CLASS
"RTN","ORCMEDT8",222,0)
 ;;COD;CODE
"RTN","ORCMEDT8",223,0)
 ;;COL;COLLECT
"RTN","ORCMEDT8",224,0)
 ;;COM;COMMENT
"RTN","ORCMEDT8",225,0)
 ;;CNJ;CONJ
"RTN","ORCMEDT8",226,0)
 ;;CON;CONTRACT
"RTN","ORCMEDT8",227,0)
 ;;DTE;DATETIME
"RTN","ORCMEDT8",228,0)
 ;;DAY;DAYS
"RTN","ORCMEDT8",229,0)
 ;;DEL;DELIVERY
"RTN","ORCMEDT8",230,0)
 ;;DOS;DOSE
"RTN","ORCMEDT8",231,0)
 ;;DRG;DRUG
"RTN","ORCMEDT8",232,0)
 ;;IML;IMLOC
"RTN","ORCMEDT8",233,0)
 ;;INS;INSTR
"RTN","ORCMEDT8",234,0)
 ;;ISO;ISOLATION
"RTN","ORCMEDT8",235,0)
 ;;LOC;LOCATION
"RTN","ORCMEDT8",236,0)
 ;;MEL;MEAL
"RTN","ORCMEDT8",237,0)
 ;;MSC;MISC
"RTN","ORCMEDT8",238,0)
 ;;MOD;MODE
"RTN","ORCMEDT8",239,0)
 ;;MDF;MODIFIER
"RTN","ORCMEDT8",240,0)
 ;;NAM;NAME
"RTN","ORCMEDT8",241,0)
 ;;NOW;NOW
"RTN","ORCMEDT8",242,0)
 ;;ORD;ORDERABLE
"RTN","ORCMEDT8",243,0)
 ;;PI0;PI
"RTN","ORCMEDT8",244,0)
 ;;PCK;PICKUP
"RTN","ORCMEDT8",245,0)
 ;;PLA;PLACE
"RTN","ORCMEDT8",246,0)
 ;;PRG;PREGNANT
"RTN","ORCMEDT8",247,0)
 ;;PRE;PREOP
"RTN","ORCMEDT8",248,0)
 ;;PRV;PROVIDER
"RTN","ORCMEDT8",249,0)
 ;;QTY;QTY
"RTN","ORCMEDT8",250,0)
 ;;RAT;RATE
"RTN","ORCMEDT8",251,0)
 ;;REA;REASON
"RTN","ORCMEDT8",252,0)
 ;;REF;REFILLS
"RTN","ORCMEDT8",253,0)
 ;;RSH:RESEARCH
"RTN","ORCMEDT8",254,0)
 ;;RES;RESULTS
"RTN","ORCMEDT8",255,0)
 ;;ROU;ROUTE
"RTN","ORCMEDT8",256,0)
 ;;SAM;SAMPLE
"RTN","ORCMEDT8",257,0)
 ;;SC0;SC
"RTN","ORCMEDT8",258,0)
 ;;SCH;SCHEDULE
"RTN","ORCMEDT8",259,0)
 ;;SER;SERVICE
"RTN","ORCMEDT8",260,0)
 ;;SIG;SIG
"RTN","ORCMEDT8",261,0)
 ;;SPE;SPECIMEN
"RTN","ORCMEDT8",262,0)
 ;;SPC;SPECSTS
"RTN","ORCMEDT8",263,0)
 ;;STT;START
"RTN","ORCMEDT8",264,0)
 ;;STA;STATEMENTS
"RTN","ORCMEDT8",265,0)
 ;;STP;STOP
"RTN","ORCMEDT8",266,0)
 ;;STR;STRENGTH
"RTN","ORCMEDT8",267,0)
 ;;SUP;SUPPLY
"RTN","ORCMEDT8",268,0)
 ;;TIM;TIME
"RTN","ORCMEDT8",269,0)
 ;;UNT;UNITS
"RTN","ORCMEDT8",270,0)
 ;;URG;URGENCY
"RTN","ORCMEDT8",271,0)
 ;;VIS;VISITSTR
"RTN","ORCMEDT8",272,0)
 ;;VOL;VOLUME
"RTN","ORCMEDT8",273,0)
 ;;XFU;XFUSION
"RTN","ORCMEDT8",274,0)
 ;;YN0;YN
"RTN","ORCMEDT8",275,0)
 ;;XXX;XXX
"RTN","ORCMEDT8",276,0)
 ;;ZZZ;ZZZ
"RTN","ORCMEDT8",277,0)
 ;;              
"RTN","ORCRC")
0^8^B33261642^n/a
"RTN","ORCRC",1,0)
ORCRC ;SLC/JM - standard CRC routine ;3/1/06
"RTN","ORCRC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**245**;Dec 17, 1997;Build 2
"RTN","ORCRC",3,0)
 Q
"RTN","ORCRC",4,0)
 ;
"RTN","ORCRC",5,0)
 ; CRC4ARRY entry point returns same CRC as the CRCForStrings routine in ORFn
"RTN","ORCRC",6,0)
 ; in the Delphi code used by CPRS.  Value returned is in HEX format
"RTN","ORCRC",7,0)
 ;
"RTN","ORCRC",8,0)
 ; Delphi logic:
"RTN","ORCRC",9,0)
 ;  
"RTN","ORCRC",10,0)
 ;  Result:=$FFFFFFFF;
"RTN","ORCRC",11,0)
 ;  for i := 0 to AStringList.Count - 1 do
"RTN","ORCRC",12,0)
 ;    for j := 1 to Length(AStringList[i]) do
"RTN","ORCRC",13,0)
 ;      Result:=((Result shr 8) and $00FFFFFF) xor
"RTN","ORCRC",14,0)
 ;        CRC32_TABLE[(Result xor Ord(AStringList[i][j])) and $000000FF];
"RTN","ORCRC",15,0)
 ;
"RTN","ORCRC",16,0)
CRC4ARRY(ARRAY) ; Returns a CRC for an array of strings
"RTN","ORCRC",17,0)
 N RESULT,LINE,IDX,I,CHR,MASK1,MASK2,TBLIDX,TBLVALUE,BINTBL,HEXTBL
"RTN","ORCRC",18,0)
 S BINTBL=".0000.0001.0010.0011.0100.0101.0110.0111.1000.1001.1010.1011.1100.1101.1110.1111."
"RTN","ORCRC",19,0)
 S HEXTBL="0123456789ABCDEF"
"RTN","ORCRC",20,0)
 S MASK1=$$HEX2BIN("FFFFFF")
"RTN","ORCRC",21,0)
 S MASK2=$$HEX2BIN("FF")
"RTN","ORCRC",22,0)
 S RESULT=$$HEX2BIN("FFFFFFFF"),IDX=""
"RTN","ORCRC",23,0)
 F  S IDX=$O(ARRAY(IDX)) Q:IDX=""  D
"RTN","ORCRC",24,0)
 . S LINE=ARRAY(IDX),LEN=$L(LINE)
"RTN","ORCRC",25,0)
 . F I=1:1:LEN D
"RTN","ORCRC",26,0)
 . . S CHR=$A($E(LINE,I)),CHR=$$INT2HEX(CHR,2),CHR=$$HEX2BIN(CHR)
"RTN","ORCRC",27,0)
 . . S TBLIDX=$$AND(RESULT,MASK2),TBLIDX=$$XOR(TBLIDX,CHR)
"RTN","ORCRC",28,0)
 . . S TBLIDX=$$BIN2HEX(TBLIDX),TBLIDX=$$HEX2INT(TBLIDX)
"RTN","ORCRC",29,0)
 . . I TBLIDX'<0,TBLIDX<256 D  I 1
"RTN","ORCRC",30,0)
 . . . S TBLVALUE=$$CRCTABLE(TBLIDX),TBLVALUE=$$HEX2BIN(TBLVALUE)
"RTN","ORCRC",31,0)
 . . E  S TBLVALUE=0
"RTN","ORCRC",32,0)
 . . S RESULT=$$SHR(RESULT,8),RESULT=$$AND(RESULT,MASK1)
"RTN","ORCRC",33,0)
 . . S RESULT=$$XOR(RESULT,TBLVALUE)
"RTN","ORCRC",34,0)
 S RESULT=$$BIN2HEX(RESULT)
"RTN","ORCRC",35,0)
 F  Q:$L(RESULT)'<8  S RESULT="0"_RESULT
"RTN","ORCRC",36,0)
 Q RESULT
"RTN","ORCRC",37,0)
 ;
"RTN","ORCRC",38,0)
 ; Supporting routines needed by CRC4ARRY
"RTN","ORCRC",39,0)
 ;
"RTN","ORCRC",40,0)
XOR(BIN1,BIN2) ; Exclusive OR of 2 binary numbers - returns binary value
"RTN","ORCRC",41,0)
 N BIN,IDX1,IDX2,LEN,LEN1,LEN2,IDX,BIT,BITS
"RTN","ORCRC",42,0)
 S BIN="",LEN1=$L(BIN1),LEN2=$L(BIN2),LEN=LEN1 I LEN2<LEN S LEN=LEN2
"RTN","ORCRC",43,0)
 F IDX=1:1:LEN  D
"RTN","ORCRC",44,0)
 . S BIT="0",BITS=$E(BIN1,LEN1)_$E(BIN2,LEN2)
"RTN","ORCRC",45,0)
 . I (BITS="10")!(BITS="01") S BIT="1"
"RTN","ORCRC",46,0)
 . S BIN=BIT_BIN,LEN1=LEN1-1,LEN2=LEN2-1
"RTN","ORCRC",47,0)
 I LEN1>0 S BIN=$E(BIN1,1,LEN1)_BIN I 1
"RTN","ORCRC",48,0)
 E  I LEN2>0 S BIN=$E(BIN2,1,LEN2)_BIN
"RTN","ORCRC",49,0)
 Q BIN
"RTN","ORCRC",50,0)
AND(BIN1,BIN2) ; AND of 2 binary numbers - returns binary value
"RTN","ORCRC",51,0)
 N BIN,IDX1,IDX2,LEN,LEN1,LEN2,IDX,BIT
"RTN","ORCRC",52,0)
 S BIN="",LEN1=$L(BIN1),LEN2=$L(BIN2),LEN=LEN1 I LEN2<LEN S LEN=LEN2
"RTN","ORCRC",53,0)
 F IDX=1:1:LEN  D
"RTN","ORCRC",54,0)
 . S BIT="0"
"RTN","ORCRC",55,0)
 . I $E(BIN1,LEN1)="1",$E(BIN2,LEN2)="1" S BIT="1"
"RTN","ORCRC",56,0)
 . S BIN=BIT_BIN,LEN1=LEN1-1,LEN2=LEN2-1
"RTN","ORCRC",57,0)
 Q BIN
"RTN","ORCRC",58,0)
SHR(BIN,SHIFT) ; Shift right SHIFT bits of binary number - returns binary value
"RTN","ORCRC",59,0)
 I $L(BIN)'>SHIFT S BIN=""
"RTN","ORCRC",60,0)
 E  S BIN=$E(BIN,1,$L(BIN)-SHIFT)
"RTN","ORCRC",61,0)
 Q BIN
"RTN","ORCRC",62,0)
HEX2BIN(HEX) ; Converts hex to binary - assumes valid input
"RTN","ORCRC",63,0)
 N LEN,BIN,IDX,OFFSET
"RTN","ORCRC",64,0)
 S LEN=$L(HEX),BIN=""
"RTN","ORCRC",65,0)
 F IDX=1:1:LEN D
"RTN","ORCRC",66,0)
 . S OFFSET=$F(HEXTBL,$E(HEX,IDX))-2,OFFSET=(OFFSET*5)+2
"RTN","ORCRC",67,0)
 . S BIN=BIN_$E(BINTBL,OFFSET,OFFSET+3)
"RTN","ORCRC",68,0)
 Q BIN
"RTN","ORCRC",69,0)
BIN2HEX(BIN) ; Converts binary to hex - assumes valid input
"RTN","ORCRC",70,0)
 N LEN,HEX,IDX,CHAR,DIGIT
"RTN","ORCRC",71,0)
 S LEN=$L(BIN)
"RTN","ORCRC",72,0)
 I LEN#4'=0 S BIN=$E("000",1,4-LEN#4)_BIN
"RTN","ORCRC",73,0)
 S LEN=$L(BIN)/4,HEX=""
"RTN","ORCRC",74,0)
 F IDX=1:1:LEN D
"RTN","ORCRC",75,0)
 . S DIGIT="."_$E(BIN,1,4)_".",BIN=$E(BIN,5,9999)
"RTN","ORCRC",76,0)
 . S CHAR=($F(BINTBL,DIGIT)-7)/5,HEX=HEX_$E(HEXTBL,CHAR+1)
"RTN","ORCRC",77,0)
 Q HEX
"RTN","ORCRC",78,0)
INT2HEX(INT,SIZE) ; Converts int to hex
"RTN","ORCRC",79,0)
 N HEX,DIGIT S HEX=""
"RTN","ORCRC",80,0)
 I $G(SIZE)<1 S SIZE=1
"RTN","ORCRC",81,0)
 F  Q:INT'>0  D
"RTN","ORCRC",82,0)
 . S DIGIT=INT#16,DIGIT=$E(HEXTBL,DIGIT+1)
"RTN","ORCRC",83,0)
 . S HEX=DIGIT_HEX,INT=INT\16
"RTN","ORCRC",84,0)
 F  Q:$L(HEX)'<SIZE  S HEX="0"_HEX
"RTN","ORCRC",85,0)
 Q HEX
"RTN","ORCRC",86,0)
HEX2INT(HEX) ; Converts hex to integer
"RTN","ORCRC",87,0)
 N INT,IDX,DIGIT S INT=0
"RTN","ORCRC",88,0)
 F  Q:HEX=""  D
"RTN","ORCRC",89,0)
 . S INT=INT*16
"RTN","ORCRC",90,0)
 . S DIGIT=$F(HEXTBL,$E(HEX,1,1))-2
"RTN","ORCRC",91,0)
 . S INT=INT+DIGIT,HEX=$E(HEX,2,9999)
"RTN","ORCRC",92,0)
 Q INT
"RTN","ORCRC",93,0)
CRCTABLE(IDX) ; Returns crc hex value from table
"RTN","ORCRC",94,0)
 N VALUE,LINE,OFFSET
"RTN","ORCRC",95,0)
 I (IDX<0)!(IDX>255) Q 0
"RTN","ORCRC",96,0)
 S LINE=(IDX/8)+1
"RTN","ORCRC",97,0)
 S LINE=$T(TBL+LINE)
"RTN","ORCRC",98,0)
 S OFFSET=IDX#8
"RTN","ORCRC",99,0)
 S IDX=(OFFSET*10)+4
"RTN","ORCRC",100,0)
 S VALUE=$E(LINE,IDX,IDX+7)
"RTN","ORCRC",101,0)
 Q $TR(VALUE," ")
"RTN","ORCRC",102,0)
TBL ; CRC table - DO NOT CHANGE THESE VALUES!
"RTN","ORCRC",103,0)
 ;;0         77073096  EE0E612C  990951BA  76DC419   706AF48F  E963A535  9E6495A3 
"RTN","ORCRC",104,0)
 ;;EDB8832   79DCB8A4  E0D5E91E  97D2D988  9B64C2B   7EB17CBD  E7B82D07  90BF1D91 
"RTN","ORCRC",105,0)
 ;;1DB71064  6AB020F2  F3B97148  84BE41DE  1ADAD47D  6DDDE4EB  F4D4B551  83D385C7 
"RTN","ORCRC",106,0)
 ;;136C9856  646BA8C0  FD62F97A  8A65C9EC  14015C4F  63066CD9  FA0F3D63  8D080DF5 
"RTN","ORCRC",107,0)
 ;;3B6E20C8  4C69105E  D56041E4  A2677172  3C03E4D1  4B04D447  D20D85FD  A50AB56B 
"RTN","ORCRC",108,0)
 ;;35B5A8FA  42B2986C  DBBBC9D6  ACBCF940  32D86CE3  45DF5C75  DCD60DCF  ABD13D59 
"RTN","ORCRC",109,0)
 ;;26D930AC  51DE003A  C8D75180  BFD06116  21B4F4B5  56B3C423  CFBA9599  B8BDA50F 
"RTN","ORCRC",110,0)
 ;;2802B89E  5F058808  C60CD9B2  B10BE924  2F6F7C87  58684C11  C1611DAB  B6662D3D 
"RTN","ORCRC",111,0)
 ;;76DC4190  1DB7106   98D220BC  EFD5102A  71B18589  6B6B51F   9FBFE4A5  E8B8D433 
"RTN","ORCRC",112,0)
 ;;7807C9A2  F00F934   9609A88E  E10E9818  7F6A0DBB  86D3D2D   91646C97  E6635C01 
"RTN","ORCRC",113,0)
 ;;6B6B51F4  1C6C6162  856530D8  F262004E  6C0695ED  1B01A57B  8208F4C1  F50FC457 
"RTN","ORCRC",114,0)
 ;;65B0D9C6  12B7E950  8BBEB8EA  FCB9887C  62DD1DDF  15DA2D49  8CD37CF3  FBD44C65 
"RTN","ORCRC",115,0)
 ;;4DB26158  3AB551CE  A3BC0074  D4BB30E2  4ADFA541  3DD895D7  A4D1C46D  D3D6F4FB 
"RTN","ORCRC",116,0)
 ;;4369E96A  346ED9FC  AD678846  DA60B8D0  44042D73  33031DE5  AA0A4C5F  DD0D7CC9 
"RTN","ORCRC",117,0)
 ;;5005713C  270241AA  BE0B1010  C90C2086  5768B525  206F85B3  B966D409  CE61E49F 
"RTN","ORCRC",118,0)
 ;;5EDEF90E  29D9C998  B0D09822  C7D7A8B4  59B33D17  2EB40D81  B7BD5C3B  C0BA6CAD 
"RTN","ORCRC",119,0)
 ;;EDB88320  9ABFB3B6  3B6E20C   74B1D29A  EAD54739  9DD277AF  4DB2615   73DC1683 
"RTN","ORCRC",120,0)
 ;;E3630B12  94643B84  D6D6A3E   7A6A5AA8  E40ECF0B  9309FF9D  A00AE27   7D079EB1 
"RTN","ORCRC",121,0)
 ;;F00F9344  8708A3D2  1E01F268  6906C2FE  F762575D  806567CB  196C3671  6E6B06E7 
"RTN","ORCRC",122,0)
 ;;FED41B76  89D32BE0  10DA7A5A  67DD4ACC  F9B9DF6F  8EBEEFF9  17B7BE43  60B08ED5 
"RTN","ORCRC",123,0)
 ;;D6D6A3E8  A1D1937E  38D8C2C4  4FDFF252  D1BB67F1  A6BC5767  3FB506DD  48B2364B 
"RTN","ORCRC",124,0)
 ;;D80D2BDA  AF0A1B4C  36034AF6  41047A60  DF60EFC3  A867DF55  316E8EEF  4669BE79 
"RTN","ORCRC",125,0)
 ;;CB61B38C  BC66831A  256FD2A0  5268E236  CC0C7795  BB0B4703  220216B9  5505262F 
"RTN","ORCRC",126,0)
 ;;C5BA3BBE  B2BD0B28  2BB45A92  5CB36A04  C2D7FFA7  B5D0CF31  2CD99E8B  5BDEAE1D 
"RTN","ORCRC",127,0)
 ;;9B64C2B0  EC63F226  756AA39C  26D930A   9C0906A9  EB0E363F  72076785  5005713 
"RTN","ORCRC",128,0)
 ;;95BF4A82  E2B87A14  7BB12BAE  CB61B38   92D28E9B  E5D5BE0D  7CDCEFB7  BDBDF21 
"RTN","ORCRC",129,0)
 ;;86D3D2D4  F1D4E242  68DDB3F8  1FDA836E  81BE16CD  F6B9265B  6FB077E1  18B74777 
"RTN","ORCRC",130,0)
 ;;88085AE6  FF0F6A70  66063BCA  11010B5C  8F659EFF  F862AE69  616BFFD3  166CCF45 
"RTN","ORCRC",131,0)
 ;;A00AE278  D70DD2EE  4E048354  3903B3C2  A7672661  D06016F7  4969474D  3E6E77DB 
"RTN","ORCRC",132,0)
 ;;AED16A4A  D9D65ADC  40DF0B66  37D83BF0  A9BCAE53  DEBB9EC5  47B2CF7F  30B5FFE9 
"RTN","ORCRC",133,0)
 ;;BDBDF21C  CABAC28A  53B39330  24B4A3A6  BAD03605  CDD70693  54DE5729  23D967BF 
"RTN","ORCRC",134,0)
 ;;B3667A2E  C4614AB8  5D681B02  2A6F2B94  B40BBE37  C30C8EA1  5A05DF1B  2D02EF8D
"RTN","ORWDXQ")
0^9^B14448552^B13199017
"RTN","ORWDXQ",1,0)
ORWDXQ ; SLC/KCM - Utilities for Quick Orders;06:18 PM  27 Apr 1998
"RTN","ORWDXQ",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,245**;Dec 17, 1997;Build 2
"RTN","ORWDXQ",3,0)
 ;
"RTN","ORWDXQ",4,0)
DLGNAME(VAL,INAME)      ; Return display name for a dialog (DELETE??)
"RTN","ORWDXQ",5,0)
 N IEN S IEN=$O(^ORD(101.41,"B",INAME,0))
"RTN","ORWDXQ",6,0)
 S VAL=$P($G(^ORD(101.41,IEN,5)),U,4)
"RTN","ORWDXQ",7,0)
 Q
"RTN","ORWDXQ",8,0)
DLGSAVE(VAL,CRC,DNAME,DGRP,RSP)    ; Return IEN of new or existing quick order
"RTN","ORWDXQ",9,0)
 N ROOT,NM,IEN
"RTN","ORWDXQ",10,0)
 S ROOT="ORWDQ "_CRC,VAL=0,IEN=+$O(^ORD(101.41,"B",ROOT,0))
"RTN","ORWDXQ",11,0)
 I IEN=0 D SAVENEW(.VAL,ROOT,DNAME,DGRP,.RSP) I 1
"RTN","ORWDXQ",12,0)
 E  I $$MATCH(IEN,DGRP,.RSP) S VAL=IEN I 1
"RTN","ORWDXQ",13,0)
 E  D
"RTN","ORWDXQ",14,0)
 . D UPDQNAME^ORCMEDT8(IEN)
"RTN","ORWDXQ",15,0)
 . S ROOT=$$ENSURNEW^ORCMEDT8(ROOT)
"RTN","ORWDXQ",16,0)
 . D SAVENEW(.VAL,ROOT,DNAME,DGRP,.RSP)
"RTN","ORWDXQ",17,0)
 Q
"RTN","ORWDXQ",18,0)
OLDELSE E  D  ; this creates other entries if CRC matches...
"RTN","ORWDXQ",19,0)
 . S NM=ROOT
"RTN","ORWDXQ",20,0)
 . F  S NM=$O(^ORD(101.41,"B",NM)) Q:$E(NM,1,$L(ROOT))'=ROOT  D
"RTN","ORWDXQ",21,0)
 . . S IEN=0 F  S IEN=$O(^ORD(101.41,"B",ROOT,0)) Q:IEN'>0  D  Q:VAL
"RTN","ORWDXQ",22,0)
 . . . I $$MATCH(IEN,DGRP,RSP) S VAL=IEN
"RTN","ORWDXQ",23,0)
 . . I 'VAL D                         ; new entry by same CRC (rare!)
"RTN","ORWDXQ",24,0)
 . . . F I=1:1 I '$D(^ORD(101.41,"B",ROOT_" "_I)) Q
"RTN","ORWDXQ",25,0)
 . . . D SAVENEW(VAL,ROOT_" "_I,DNAME,DGRP,RSP)
"RTN","ORWDXQ",26,0)
 Q
"RTN","ORWDXQ",27,0)
MATCH(IEN,DGRP,RSP)     ; Called by DLGSAVE
"RTN","ORWDXQ",28,0)
 ; Return true if the responses passed in match dialog
"RTN","ORWDXQ",29,0)
 I $P(^ORD(101.41,IEN,0),U,5)'=DGRP Q 0  ; display group must match
"RTN","ORWDXQ",30,0)
 N TST,RSLT,DLG,INST,VAL,I,J,L
"RTN","ORWDXQ",31,0)
 S RSLT=1 M TST=RSP
"RTN","ORWDXQ",32,0)
 S I=0 F  S I=$O(^ORD(101.41,IEN,6,I)) Q:'I  D  Q:'RSLT
"RTN","ORWDXQ",33,0)
 . S DLG=$P(^ORD(101.41,IEN,6,I,0),U,2),INST=$P(^(0),U,3)
"RTN","ORWDXQ",34,0)
 . S VAL="ORDIALOG(""WP"","_DLG_","_INST_")"
"RTN","ORWDXQ",35,0)
 . I $D(^ORD(101.41,IEN,6,I,1)) S VAL=^(1)
"RTN","ORWDXQ",36,0)
 . I '$D(TST(DLG,INST)) S RSLT=0 Q
"RTN","ORWDXQ",37,0)
 . I TST(DLG,INST)'=VAL S RSLT=0 Q
"RTN","ORWDXQ",38,0)
 . I $D(^ORD(101.41,IEN,6,I,2))>1 D  Q:'RSLT
"RTN","ORWDXQ",39,0)
 . . N A,B,JMAX
"RTN","ORWDXQ",40,0)
 . . S (J,L)=0 F  S L=$O(^ORD(101.41,IEN,6,I,2,L)) Q:'L  S J=J+1,A(J)=^(L,0)
"RTN","ORWDXQ",41,0)
 . . S JMAX=J
"RTN","ORWDXQ",42,0)
 . . S (J,L)=0 F  S L=$O(TST("WP",DLG,INST,L)) Q:'L  S J=J+1,B(J)=TST("WP",DLG,INST,L,0)
"RTN","ORWDXQ",43,0)
 . . I JMAX'=J S RSLT=0 Q
"RTN","ORWDXQ",44,0)
 . . S J=0 F  S J=$O(A(J)) Q:'J  S:A(J)'=$G(B(J)) RSLT=0  Q:'RSLT  K A(J),B(J)
"RTN","ORWDXQ",45,0)
 . . I ($D(A)>1)!($D(B)>1) S RSLT=0
"RTN","ORWDXQ",46,0)
 . . K TST("WP",DLG,INST)
"RTN","ORWDXQ",47,0)
 . K TST(DLG,INST)
"RTN","ORWDXQ",48,0)
 I $D(TST)>1 S RSLT=0
"RTN","ORWDXQ",49,0)
 Q RSLT
"RTN","ORWDXQ",50,0)
SAVENEW(ORQDLG,INM,DTX,DG,ORDIALOG)   ; Called by DLGSAVE
"RTN","ORWDXQ",51,0)
 ; save the entries in ORDIALOG as a new quick order
"RTN","ORWDXQ",52,0)
 ; INM=.01 name, DTX=display text, DGR=display group
"RTN","ORWDXQ",53,0)
 S ORQDLG=0,ORDIALOG=$$DEFDLG(DG) Q:'ORDIALOG
"RTN","ORWDXQ",54,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORWDXQ",55,0)
 N FDA,FDAIEN,DIERR,ORDG
"RTN","ORWDXQ",56,0)
 S FDA(101.41,"+1,",.01)=INM
"RTN","ORWDXQ",57,0)
 S FDA(101.41,"+1,",2)=DTX
"RTN","ORWDXQ",58,0)
 S FDA(101.41,"+1,",4)="Q"
"RTN","ORWDXQ",59,0)
 S FDA(101.41,"+1,",5)=DG
"RTN","ORWDXQ",60,0)
 D UPDATE^DIE("","FDA","FDAIEN")
"RTN","ORWDXQ",61,0)
 S ORQDLG=FDAIEN(1)
"RTN","ORWDXQ",62,0)
 D SAVE^ORCMEDT1
"RTN","ORWDXQ",63,0)
 Q
"RTN","ORWDXQ",64,0)
DEFDLG(DG)    ; Return IEN of default dialog for display group
"RTN","ORWDXQ",65,0)
 N DLG,DAD S DLG=+$P($G(^ORD(100.98,DG,0)),U,4)
"RTN","ORWDXQ",66,0)
 I 'DLG S DAD=$O(^ORD(100.98,"AD",DG,0)) I DAD S DLG=$$DEFDLG(DAD)
"RTN","ORWDXQ",67,0)
 Q DLG
"RTN","ORWDXQ",68,0)
GETQLST(LST,DGRP,PRE)        ; Return quick list for a display group
"RTN","ORWDXQ",69,0)
 N LVW,ILST,I,X0
"RTN","ORWDXQ",70,0)
 S PRE=$G(PRE),ILST=0
"RTN","ORWDXQ",71,0)
 D QV4DG^ORWUL(.LVW,DGRP) S LVW=+LVW Q:'LVW
"RTN","ORWDXQ",72,0)
 S I=0 F  S I=$O(^ORD(101.44,LVW,10,I)) Q:'I  D
"RTN","ORWDXQ",73,0)
 . S X0=$G(^ORD(101.44,LVW,10,I,0))
"RTN","ORWDXQ",74,0)
 . I $P($G(^ORD(101.41,+X0,0)),U,3)]"" Q  ; quick order is disabled
"RTN","ORWDXQ",75,0)
 . S ILST=ILST+1,LST(ILST)=PRE_X0
"RTN","ORWDXQ",76,0)
 Q
"RTN","ORWDXQ",77,0)
 ;N DNAM,DLG,I,ILST,X
"RTN","ORWDXQ",78,0)
 ;S ILST=0,X="ORWDQ "_$S(+DGRP:$P(^ORD(100.98,DGRP,0),U,3),1:DGRP),PRE=$G(PRE)
"RTN","ORWDXQ",79,0)
 ;D GETLST^XPAR(.TMP,"ALL",X,"N")
"RTN","ORWDXQ",80,0)
 ;S I=0 F  S I=$O(TMP(I)) Q:'I  S DLG=+TMP(I) I +DLG D
"RTN","ORWDXQ",81,0)
 ;. S DNAM=$$GET^XPAR(DUZ_";VA(200,","ORWDQ DISPLAY NAME",DLG,"I")
"RTN","ORWDXQ",82,0)
 ;. I '$L(DNAM) S DNAM=$P(^ORD(101.41,DLG,0),U,2)
"RTN","ORWDXQ",83,0)
 ;. I $P($G(^ORD(101.41,DLG,0)),U,3)]"" Q  ; quick order is disabled
"RTN","ORWDXQ",84,0)
 ;. S ILST=ILST+1,LST(ILST)=PRE_DLG_U_DNAM
"RTN","ORWDXQ",85,0)
 ;Q
"RTN","ORWDXQ",86,0)
PUTQLST(VAL,DG,QLST)  ; Save quick list
"RTN","ORWDXQ",87,0)
 N PNM
"RTN","ORWDXQ",88,0)
 S PNM="ORWDQ USR"_DUZ_" "_$P(^ORD(100.98,DG,0),U,3)
"RTN","ORWDXQ",89,0)
 D QVSAVE^ORWUL(.VAL,PNM,.QLST)
"RTN","ORWDXQ",90,0)
 D EN^XPAR(DUZ_";VA(200,","ORWDQ QUICK VIEW","`"_DG,PNM)
"RTN","ORWDXQ",91,0)
 Q
"RTN","ORWDXQ",92,0)
 ;N PNM,USER,I,DLG,QNM,CUR
"RTN","ORWDXQ",93,0)
 ;S PNM="ORWDQ "_$P(^ORD(100.98,DG,0),U,3),USER=DUZ_";VA(200,"
"RTN","ORWDXQ",94,0)
 ;D NDEL^XPAR(USER,PNM) ; remove all instances for this quick list
"RTN","ORWDXQ",95,0)
 ;S I=0 F  S I=$O(QLST(I)) Q:'I  D ADD^XPAR(USER,PNM,I,"`"_+QLST(I))
"RTN","ORWDXQ",96,0)
 ;S I=0 F  S I=$O(QLST(I)) Q:'I  D
"RTN","ORWDXQ",97,0)
 ;. S DLG=+QLST(I),QNM=$P(QLST(I),U,2)
"RTN","ORWDXQ",98,0)
 ;. S CUR=$$GET^XPAR(USER,"ORWDQ DISPLAY NAME",DLG,"I")
"RTN","ORWDXQ",99,0)
 ;. I QNM=CUR Q
"RTN","ORWDXQ",100,0)
 ;. I CUR="",(QNM=$P($G(^ORD(101.41,DLG,0)),U,2)) Q
"RTN","ORWDXQ",101,0)
 ;. D EN^XPAR(USER,"ORWDQ DISPLAY NAME","`"_DLG,QNM)
"RTN","ORWDXQ",102,0)
 ;Q
"RTN","ORWDXQ",103,0)
GETQNAM(VAL,CRC)    ; Return current quick name
"RTN","ORWDXQ",104,0)
 N ROOT S ROOT="ORWDQ "_CRC,VAL=""
"RTN","ORWDXQ",105,0)
 I '$D(^ORD(101.41,"B",ROOT)) Q
"RTN","ORWDXQ",106,0)
 S DLG=$O(^ORD(101.41,"B",ROOT,0))
"RTN","ORWDXQ",107,0)
 ; S VAL=$$GET^XPAR(DUZ_";VA(200,","ORWDQ DISPLAY NAME",DLG,"I")
"RTN","ORWDXQ",108,0)
 I '$L(VAL) S VAL=$P($G(^ORD(101.41,DLG,0)),U,2)
"RTN","ORWDXQ",109,0)
 Q
"RTN","ORWDXQ",110,0)
PUTQNAM(VAL,DLG,QNAM)   ; Save display name for a quick order dialog
"RTN","ORWDXQ",111,0)
 ; see if DLG used QNAM as display text (quit if so)
"RTN","ORWDXQ",112,0)
 ; otherwise save in ORWDQ DISPLAY NAME
"RTN","ORWDXQ",113,0)
 Q
"RTN","ORWUL")
0^7^B51080306^B48138721
"RTN","ORWUL",1,0)
ORWUL ; SLC/KCM/JLI - Listview Selection ;1/25/02  14:09 [2/4/02 12:23pm] 2/27/06
"RTN","ORWUL",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,117,131,132,164,215,245**;Dec 17, 1997;Build 2
"RTN","ORWUL",3,0)
 ;
"RTN","ORWUL",4,0)
QV4DG(VAL,DGRP) ; return the quick order list, given a display group name
"RTN","ORWUL",5,0)
 N NM
"RTN","ORWUL",6,0)
 S VAL="0^0"
"RTN","ORWUL",7,0)
 I 'DGRP S DGRP=+$O(^ORD(100.98,"B",DGRP,0))
"RTN","ORWUL",8,0)
 S NM=$$GET^XPAR("ALL","ORWDQ QUICK VIEW",DGRP,"I")
"RTN","ORWUL",9,0)
 Q:'$L(NM)
"RTN","ORWUL",10,0)
 D QV4NM(.VAL,NM)
"RTN","ORWUL",11,0)
 Q
"RTN","ORWUL",12,0)
QV4NM(VAL,QVNAM)       ; return the current quick list and item count
"RTN","ORWUL",13,0)
 ; VAL: ListIEN^ItemCount
"RTN","ORWUL",14,0)
 N J,CNT ;117
"RTN","ORWUL",15,0)
 S VAL=+$O(^ORD(101.44,"B",QVNAM,0))
"RTN","ORWUL",16,0)
 S (J,CNT)=0 F  S J=$O(^ORD(101.44,VAL,10,J)) Q:'+J  I '$$QODIS(VAL,J) S CNT=CNT+1 ;117
"RTN","ORWUL",17,0)
 S $P(VAL,U,2)=CNT ;117
"RTN","ORWUL",18,0)
 Q
"RTN","ORWUL",19,0)
QVSUB(LST,IEN,FIRST,LAST)       ; return subset of orders in view
"RTN","ORWUL",20,0)
 N I,J,ID ;117
"RTN","ORWUL",21,0)
 I $L(FIRST),$L(LAST) D
"RTN","ORWUL",22,0)
 . F I=+FIRST:1:+LAST D
"RTN","ORWUL",23,0)
 .. I $D(^ORD(101.44,IEN,10,I,0))>0 D
"RTN","ORWUL",24,0)
 ... I '$$QODIS(IEN,I) S LST(I)=^ORD(101.44,IEN,10,I,0)
"RTN","ORWUL",25,0)
 E  D
"RTN","ORWUL",26,0)
 . S (I,J)=0 F  S I=$O(^ORD(101.44,IEN,10,I)) Q:'+I  I '$$QODIS(IEN,I) S J=J+1,LST(J)=^ORD(101.44,IEN,10,I,0) ;117
"RTN","ORWUL",27,0)
 Q
"RTN","ORWUL",28,0)
QODIS(IEN,SUB) ;Determines if personal quick order is disabled
"RTN","ORWUL",29,0)
 ;returns 1 if it is else 0.  This section added with patch 117
"RTN","ORWUL",30,0)
 I $P($G(^ORD(101.41,+$P($G(^ORD(101.44,IEN,10,SUB,0)),"^"),0)),"^",3)'="" Q 1
"RTN","ORWUL",31,0)
 Q 0
"RTN","ORWUL",32,0)
QVIDX(VAL,IEN,FROM)     ; return index of item beginning with FROM
"RTN","ORWUL",33,0)
 N I,X
"RTN","ORWUL",34,0)
 S VAL=0
"RTN","ORWUL",35,0)
 S X=$O(^ORD(101.44,IEN,10,"C",FROM))
"RTN","ORWUL",36,0)
 I '$L(X) Q
"RTN","ORWUL",37,0)
 S I=$O(^ORD(101.44,IEN,10,"C",X,0))
"RTN","ORWUL",38,0)
 Q:'I
"RTN","ORWUL",39,0)
 S:'$$QODIS(IEN,I) VAL=+I_U_X
"RTN","ORWUL",40,0)
 Q
"RTN","ORWUL",41,0)
FV4DG(VAL,DGNM)       ; return the current full list & item count
"RTN","ORWUL",42,0)
 S VAL=$O(^ORD(101.44,"B","ORWDSET "_DGNM,0))
"RTN","ORWUL",43,0)
 I 'VAL D
"RTN","ORWUL",44,0)
 . N UPDTIME,ATTEMPT
"RTN","ORWUL",45,0)
 . S UPDTIME=$G(^ORD(101.43,"AH","S."_DGNM)),ATTEMPT=0
"RTN","ORWUL",46,0)
 . I UPDTIME="" S UPDTIME=$H,^ORD(101.43,"AH","S."_DGNM)=UPDTIME
"RTN","ORWUL",47,0)
 . D FVBLD
"RTN","ORWUL",48,0)
 . S VAL=$O(^ORD(101.44,"B","ORWDSET "_DGNM,0))
"RTN","ORWUL",49,0)
 I ($P(^ORD(101.44,+VAL,0),U,6)'=$G(^ORD(101.43,"AH","S."_DGNM))) D
"RTN","ORWUL",50,0)
 . ; -- see if a task is already queued to rebuild this
"RTN","ORWUL",51,0)
 . L +^XTMP("ORWDSET "_DGNM):2 E  Q
"RTN","ORWUL",52,0)
 . N ZTSK S ZTSK=+$G(^XTMP("ORWDSET "_DGNM,"TASK"))
"RTN","ORWUL",53,0)
 . I ZTSK D ISQED^%ZTLOAD S ZTSK=+ZTSK(0)
"RTN","ORWUL",54,0)
 . I ZTSK L -^XTMP("ORWDSET "_DGNM) Q
"RTN","ORWUL",55,0)
 . ; -- create a task to rebuild the list
"RTN","ORWUL",56,0)
 . D FVBLDQ(DGNM)
"RTN","ORWUL",57,0)
 . L -^XTMP("ORWDSET "_DGNM)
"RTN","ORWUL",58,0)
 S $P(VAL,U,2)=$P($G(^ORD(101.44,+VAL,20,0)),U,4)
"RTN","ORWUL",59,0)
 Q
"RTN","ORWUL",60,0)
FVSUB(LST,IEN,FIRST,LAST)       ; return subset of orders in view
"RTN","ORWUL",61,0)
 N I
"RTN","ORWUL",62,0)
 F I=FIRST:1:LAST D
"RTN","ORWUL",63,0)
 .;AGP change returned valued to returned data or @ if record does not
"RTN","ORWUL",64,0)
 .;exist. The @ sign is used by the delphi code to identified a
"RTN","ORWUL",65,0)
 .;non-existence record
"RTN","ORWUL",66,0)
 .S LST(I)=$S($D(^ORD(101.44,IEN,20,$G(I)))>0:^ORD(101.44,IEN,20,I,0),1:"@")
"RTN","ORWUL",67,0)
 Q
"RTN","ORWUL",68,0)
FVIDX(VAL,IEN,FROM)     ; return index of item beginning with FROM
"RTN","ORWUL",69,0)
 N I,X
"RTN","ORWUL",70,0)
 S VAL=0
"RTN","ORWUL",71,0)
 S X=$O(^ORD(101.44,IEN,20,"C",FROM))
"RTN","ORWUL",72,0)
 I '$L(X) Q
"RTN","ORWUL",73,0)
 S I=$O(^ORD(101.44,IEN,20,"C",X,0))
"RTN","ORWUL",74,0)
 Q:'I
"RTN","ORWUL",75,0)
 S VAL=+I_U_X
"RTN","ORWUL",76,0)
 Q
"RTN","ORWUL",77,0)
FVBLDQ(DGNM,ATTEMPT)    ; queue rebuild of set
"RTN","ORWUL",78,0)
 N ZTRTN,ZTIO,ZTDTH,ZTSAVE,ZTDESC,ZTUCI,ZTCPU,ZTPRI,ZTKIL,ZTSYNC,ZTSK
"RTN","ORWUL",79,0)
 N UPDTIME S UPDTIME=$G(^ORD(101.43,"AH","S."_DGNM))
"RTN","ORWUL",80,0)
 I '$G(UPDTIME) S UPDTIME=$H,^ORD(101.43,"AH","S."_DGNM)=UPDTIME
"RTN","ORWUL",81,0)
 S ATTEMPT=$G(ATTEMPT)+1
"RTN","ORWUL",82,0)
 S ZTRTN="FVBLD^ORWUL",ZTIO="",ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,0,0,2)
"RTN","ORWUL",83,0)
 S ZTSAVE("ATTEMPT")="",ZTSAVE("UPDTIME")="",ZTSAVE("DGNM")=""
"RTN","ORWUL",84,0)
 S ZTDESC="Rebuild quick view for "_DGNM
"RTN","ORWUL",85,0)
 D ^%ZTLOAD
"RTN","ORWUL",86,0)
 S ^XTMP("ORWDSET "_DGNM,0)=$$FMADD^XLFDT($$NOW^XLFDT,2)_U_$$NOW^XLFDT
"RTN","ORWUL",87,0)
 S ^XTMP("ORWDSET "_DGNM,"TASK")=ZTSK
"RTN","ORWUL",88,0)
 Q
"RTN","ORWUL",89,0)
FVBLD ; rebuild an ORWSET entry
"RTN","ORWUL",90,0)
 ; ATTEMPT, UPDTIME, DGNM expected in environment
"RTN","ORWUL",91,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORWUL",92,0)
 I $D(ZTQUEUED),(ATTEMPT<20),(UPDTIME'=$G(^ORD(101.43,"AH","S."_DGNM))) D FVBLDQ(DGNM,ATTEMPT) Q 
"RTN","ORWUL",93,0)
 ; -- create new entry in 101.44 for the set
"RTN","ORWUL",94,0)
 N FDA,FDAIEN,LVW,ADDL
"RTN","ORWUL",95,0)
 S FDA(101.44,"+1,",.01)="ORWDNEW "_DGNM
"RTN","ORWUL",96,0)
 S FDA(101.44,"+1,",6)=UPDTIME
"RTN","ORWUL",97,0)
 D UPDATE^DIE("","FDA","FDAIEN")
"RTN","ORWUL",98,0)
 S LVW=+FDAIEN(1) I 'LVW G FVBLDX
"RTN","ORWUL",99,0)
 ; -- copy all the active items into the list multiple
"RTN","ORWUL",100,0)
 N ASET,SEQ,NM,OI,INACT,CURTM,NMLST,X,Y
"RTN","ORWUL",101,0)
 S ASET="S."_DGNM,SEQ=0,CURTM=$$NOW^XLFDT
"RTN","ORWUL",102,0)
 K ^ORD(101.44,LVW,20)
"RTN","ORWUL",103,0)
 S ^ORD(101.44,LVW,20,0)="^101.442PA"
"RTN","ORWUL",104,0)
 S NM="" F  S NM=$O(^ORD(101.43,ASET,NM)) Q:NM=""  D
"RTN","ORWUL",105,0)
 . K NMLST
"RTN","ORWUL",106,0)
 . S OI=0 F  S OI=$O(^ORD(101.43,ASET,NM,OI)) Q:'OI  D
"RTN","ORWUL",107,0)
 . . S X=^ORD(101.43,ASET,NM,OI),INACT=$P(X,U,3)
"RTN","ORWUL",108,0)
 . . Q:$P(X,U,5)  I INACT,CURTM>INACT Q
"RTN","ORWUL",109,0)
 . . I 'X S ADDL=""
"RTN","ORWUL",110,0)
 . . E    S ADDL="     <"_$P(X,U,4)_">"
"RTN","ORWUL",111,0)
 . . I $P($G(^ORD(101.43,OI,"PS")),U,6) S ADDL=ADDL_"     NF"
"RTN","ORWUL",112,0)
 . . S NMLST($P(X,U,2)_ADDL,OI)=""
"RTN","ORWUL",113,0)
 . I '$D(NMLST) Q
"RTN","ORWUL",114,0)
 . S X="" F  S X=$O(NMLST(X)) Q:X=""  D
"RTN","ORWUL",115,0)
 . . S Y=0 F  S Y=$O(NMLST(X,Y)) Q:'Y  D
"RTN","ORWUL",116,0)
 . . . S SEQ=SEQ+1
"RTN","ORWUL",117,0)
 . . . S ^ORD(101.44,LVW,20,SEQ,0)=Y_U_X
"RTN","ORWUL",118,0)
 . . . S ^ORD(101.44,LVW,20,"C",$$UP^XLFSTR(X),SEQ)=""
"RTN","ORWUL",119,0)
 S ^ORD(101.44,LVW,20,0)="^101.442PA^"_SEQ_U_SEQ
"RTN","ORWUL",120,0)
 ; -- switch the names of the entries (SET->OLD, NEW->SET)
"RTN","ORWUL",121,0)
 L +^ORD(101.44,"ORWDSET "_DGNM):60
"RTN","ORWUL",122,0)
 S IEN=$O(^ORD(101.44,"B","ORWDSET "_DGNM,0))
"RTN","ORWUL",123,0)
 I IEN K FDA S FDA(101.44,IEN_",",.01)="ORWDOLD "_$H
"RTN","ORWUL",124,0)
 D FILE^DIE("","FDA")
"RTN","ORWUL",125,0)
 K FDA S FDA(101.44,LVW_",",.01)="ORWDSET "_DGNM
"RTN","ORWUL",126,0)
 D FILE^DIE("","FDA")
"RTN","ORWUL",127,0)
 L -^ORD(101.44,"ORWDSET "_DGNM)
"RTN","ORWUL",128,0)
FVBLDX ; -- clean up ^XTMP node
"RTN","ORWUL",129,0)
 K ^XTMP("ORWDSET "_DGNM)
"RTN","ORWUL",130,0)
 D FVCLN
"RTN","ORWUL",131,0)
 Q
"RTN","ORWUL",132,0)
FVCLN ; clean up old set-type entries in the 101.44
"RTN","ORWUL",133,0)
 N LNM,DIK,DA
"RTN","ORWUL",134,0)
 S LNM="ORWDOLD",DIK="^ORD(101.44,"
"RTN","ORWUL",135,0)
 F  S LNM=$O(^ORD(101.44,"B",LNM)) Q:$E(LNM,1,7)'="ORWDOLD"  D
"RTN","ORWUL",136,0)
 . I ($H-$P(LNM," ",2))<2 Q  ; wait until entry is 2 days old
"RTN","ORWUL",137,0)
 . S DA=0 F  S DA=$O(^ORD(101.44,"B",LNM,DA)) Q:'DA  D ^DIK
"RTN","ORWUL",138,0)
 Q
"RTN","ORWUL",139,0)
QVSAVE(LVW,X,QLST)       ; Save a quick order list
"RTN","ORWUL",140,0)
 ;    X:  Name of List
"RTN","ORWUL",141,0)
 ; QLST: Ptr101.41^DisplayName
"RTN","ORWUL",142,0)
 N DIC,DA,DLAYGO,Y,LVW,SEQ,I
"RTN","ORWUL",143,0)
 S DIC="^ORD(101.44,",DIC(0)="L",DLAYGO=101.44,LVW=0
"RTN","ORWUL",144,0)
 D ^DIC Q:'Y
"RTN","ORWUL",145,0)
 S LVW=+Y,SEQ=0
"RTN","ORWUL",146,0)
 I $D(^ORD(101.44,LVW,10)) D  ; KILL "C" XREF
"RTN","ORWUL",147,0)
 . N IDX,QOIEN S IDX=0
"RTN","ORWUL",148,0)
 . F  S IDX=$O(^ORD(101.44,LVW,10,IDX)) Q:'IDX  D
"RTN","ORWUL",149,0)
 . . S QOIEN=$P(^ORD(101.44,LVW,10,IDX,0),U)
"RTN","ORWUL",150,0)
 . . K ^ORD(101.44,"C",QOIEN,LVW,IDX)
"RTN","ORWUL",151,0)
 K ^ORD(101.44,LVW,10)
"RTN","ORWUL",152,0)
 S ^ORD(101.44,LVW,10,0)="^101.441PA"
"RTN","ORWUL",153,0)
 S I=0  F  S I=$O(QLST(I)) Q:'I  D
"RTN","ORWUL",154,0)
 . S SEQ=SEQ+1,^ORD(101.44,LVW,10,SEQ,0)=QLST(I)
"RTN","ORWUL",155,0)
 . S ^ORD(101.44,LVW,10,"C",$$UP^XLFSTR($P(QLST(I),U,2)),SEQ)=""
"RTN","ORWUL",156,0)
 . S ^ORD(101.44,"C",+QLST(I),LVW,SEQ)=""
"RTN","ORWUL",157,0)
 S ^ORD(101.44,LVW,10,0)="^101.441PA^"_SEQ_U_SEQ
"RTN","ORWUL",158,0)
 Q
"RTN","ORWUL",159,0)
MVRX ; move pharmacy quick orders into 101.44
"RTN","ORWUL",160,0)
 D MVQO("O RX")
"RTN","ORWUL",161,0)
 D MVQO("UD RX")
"RTN","ORWUL",162,0)
 Q
"RTN","ORWUL",163,0)
MVALL ; move all quick order lists into 101.44
"RTN","ORWUL",164,0)
 Q:$E($O(^ORD(101.44,"B","ORWDQ")),1,5)="ORWDQ"
"RTN","ORWUL",165,0)
 N SNM
"RTN","ORWUL",166,0)
 D BMES^XPDUTL("Moving personal quick orders into 101.44")
"RTN","ORWUL",167,0)
 F SNM="ANI","CARD","CSLT","CT","DO","IV RX","LAB","MAM","MRI","NM","O RX","PROC","RAD","TF","UD RX","US","VAS","XRAY" D
"RTN","ORWUL",168,0)
 . D MES^XPDUTL("-- moving: "_SNM)
"RTN","ORWUL",169,0)
 . D MVQO(SNM)
"RTN","ORWUL",170,0)
 Q
"RTN","ORWUL",171,0)
MVQO(DGNM)      ; move quick orders
"RTN","ORWUL",172,0)
 N ENT,PAR,ORTLST,QLST,DLG,X,X0,I,NOP,DNM
"RTN","ORWUL",173,0)
 S PAR=$O(^XTV(8989.51,"B","ORWDQ "_DGNM,0))
"RTN","ORWUL",174,0)
 S ENT="" F  S ENT=$O(^XTV(8989.5,"AC",PAR,ENT)) Q:'ENT  D
"RTN","ORWUL",175,0)
 . K ORTLST,QLST D GETLST^XPAR(.ORTLST,ENT,PAR,"I")
"RTN","ORWUL",176,0)
 . S I=0 F  S I=$O(ORTLST(I)) Q:'I  D
"RTN","ORWUL",177,0)
 . . S DLG=+ORTLST(I) Q:'DLG
"RTN","ORWUL",178,0)
 . . S X0=$G(^ORD(101.41,DLG,0)) Q:'$L(X0)
"RTN","ORWUL",179,0)
 . . S DNM=$$GET^XPAR(ENT,"ORWDQ DISPLAY NAME",DLG,"I")
"RTN","ORWUL",180,0)
 . . I '$L(DNM) S DNM=$P(^ORD(101.41,DLG,0),U,2)
"RTN","ORWUL",181,0)
 . . S QLST(I)=DLG_U_DNM
"RTN","ORWUL",182,0)
 . S X=$O(^XTV(8989.51,PAR,30,"AG",$P(ENT,";",2),0))
"RTN","ORWUL",183,0)
 . S X=$P(^XTV(8989.51,PAR,30,X,0),U,2)
"RTN","ORWUL",184,0)
 . S X=$P(^XTV(8989.518,X,0),U,2)
"RTN","ORWUL",185,0)
 . S X="ORWDQ "_X_$P(ENT,";")_" "_DGNM
"RTN","ORWUL",186,0)
 . D QVSAVE(.NOP,X,.QLST)
"RTN","ORWUL",187,0)
 . D EN^XPAR(ENT,"ORWDQ QUICK VIEW",DGNM,X)
"RTN","ORWUL",188,0)
 . ; D NDEL^XPAR(ENT,PAR) ; -- add later, after sure about conversion
"RTN","ORWUL",189,0)
 Q
"RTN","ORWUL",190,0)
ZCLEAN ; cleanup ORWDQ entries in Quick View file
"RTN","ORWUL",191,0)
 N ANAM,ANIEN,DIK,DA
"RTN","ORWUL",192,0)
 S ANAM="ORWDQ",DIK="^ORD(101.44,"
"RTN","ORWUL",193,0)
 F  S ANAM=$O(^ORD(101.44,"B",ANAM)) Q:$E(ANAM,1,5)'="ORWDQ"  D
"RTN","ORWUL",194,0)
 . W !,"deleting "_ANAM
"RTN","ORWUL",195,0)
 . S ANIEN=$O(^ORD(101.44,"B",ANAM,0))
"RTN","ORWUL",196,0)
 . S DA=ANIEN D ^DIK
"RTN","ORWUL",197,0)
 W !,"rebuilding entries"
"RTN","ORWUL",198,0)
 D MVALL
"RTN","ORWUL",199,0)
 Q
"RTN","ORY245")
0^3^B5769223^n/a
"RTN","ORY245",1,0)
ORY245 ;SLC/JM -- post-install for OR*3*245 ; 1/19/2006
"RTN","ORY245",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**245**;Dec 17, 1997;Build 2
"RTN","ORY245",3,0)
 Q
"RTN","ORY245",4,0)
POST ; Used to insert new ORCM QUICK ORDERS BY USER option into ORCM MGMT menu
"RTN","ORY245",5,0)
 N OROPTION,ORMENU
"RTN","ORY245",6,0)
 N DO,DA,DD,DI,DIC,DIE,DLAYGO,DQ,DR,X,Y,DINUM
"RTN","ORY245",7,0)
 D BLDXREF
"RTN","ORY245",8,0)
 ; find option
"RTN","ORY245",9,0)
 S OROPTION=$O(^DIC(19,"B","ORCM QUICK ORDERS BY USER",0)) I '+OROPTION D  Q
"RTN","ORY245",10,0)
 . D BMES^XPDUTL("An error occurred during the installation.")
"RTN","ORY245",11,0)
 . D MES^XPDUTL("The new option ORCM QUICK ORDERS BY USER was not found.")
"RTN","ORY245",12,0)
 ; find menu
"RTN","ORY245",13,0)
 S ORMENU=$O(^DIC(19,"B","ORCM MGMT",0)) I '+ORMENU D  Q
"RTN","ORY245",14,0)
 . D BMES^XPDUTL("Unable to attach the new ORCM QUICK ORDERS BY USER option.")
"RTN","ORY245",15,0)
 . D MES^XPDUTL("Menu ORCM MGMT was not found.")
"RTN","ORY245",16,0)
 ; If option already attached to menu then install has been run before
"RTN","ORY245",17,0)
 I +$O(^DIC(19,ORMENU,10,"B",OROPTION,0)) D  Q
"RTN","ORY245",18,0)
 . D BMES^XPDUTL("Option ORCM QUICK ORDERS BY USER is already attached to ORCM MGMT menu.")
"RTN","ORY245",19,0)
 ; Attach option to menu
"RTN","ORY245",20,0)
 I '$D(^DIC(19,ORMENU,10,0)) S ^(0)="^19.01PI^^"
"RTN","ORY245",21,0)
 S DIC="^DIC(19,"_ORMENU_",10,",DIC(0)="L",DLAYGO=19,DA(1)=ORMENU,X=OROPTION,DIC("DR")="2///QU;3///4.5"
"RTN","ORY245",22,0)
 D FILE^DICN
"RTN","ORY245",23,0)
 I +$O(^DIC(19,ORMENU,10,"B",OROPTION,0)) D  I 1
"RTN","ORY245",24,0)
 . D BMES^XPDUTL("New option ORCM QUICK ORDERS BY USER successfully attached to ORCM MGMT menu.")
"RTN","ORY245",25,0)
 E  D BMES^XPDUTL("Error trying to attach ORCM QUICK ORDERS BY USER to ORCM MGMT menu.")
"RTN","ORY245",26,0)
 Q
"RTN","ORY245",27,0)
BLDXREF ; index new cross reference
"RTN","ORY245",28,0)
 N DIK,DA,MSG1,MSG2,IEN
"RTN","ORY245",29,0)
 I $D(^ORD(101.44,"C"))=0 S MSG1="Populating",MSG2="populated"
"RTN","ORY245",30,0)
 E  S MSG1="Reindexing",MSG2="reindexed"
"RTN","ORY245",31,0)
 D BMES^XPDUTL(MSG1_" the new C cross reference of the ORDER QUICK VIEW file.")
"RTN","ORY245",32,0)
 K ^ORD(101.44,"C")
"RTN","ORY245",33,0)
 S IEN=0
"RTN","ORY245",34,0)
 F  S IEN=$O(^ORD(101.44,IEN)) Q:'IEN  D
"RTN","ORY245",35,0)
 . S DIK="^ORD(101.44,"_IEN_",10,",DIK(1)=".01^C",DA(1)=IEN D ENALL^DIK
"RTN","ORY245",36,0)
 D BMES^XPDUTL("The C cross reference of the ORDER QUICK VIEW file has been "_MSG2_".")
"RTN","ORY245",37,0)
 Q
"UP",101.44,101.441,-1)
101.44^10
"UP",101.44,101.441,0)
101.441
"VER")
8.0^22.0
"^DD",101.44,101.44,10,0)
QUICK ORDER^101.441PA^^10;0
"^DD",101.44,101.44,10,21,0)
^^1^1^3010416^
"^DD",101.44,101.44,10,21,1,0)
This multiple contains the quick orders that belong to a given list.
"^DD",101.44,101.441,0)
QUICK ORDER SUB-FIELD^^2^2
"^DD",101.44,101.441,0,"NM","QUICK ORDER")

"^DD",101.44,101.441,.01,0)
QUICK ORDER^MP101.41'^ORD(101.41,^0;1^Q
"^DD",101.44,101.441,.01,1,0)
^.1
"^DD",101.44,101.441,.01,1,1,0)
101.44^C
"^DD",101.44,101.441,.01,1,1,1)
S ^ORD(101.44,"C",$E(X,1,30),DA(1),DA)=""
"^DD",101.44,101.441,.01,1,1,2)
K ^ORD(101.44,"C",$E(X,1,30),DA(1),DA)
"^DD",101.44,101.441,.01,1,1,"%D",0)
^^3^3^3060227^
"^DD",101.44,101.441,.01,1,1,"%D",1,0)
This cross reference is used to ensure that quick order views of
"^DD",101.44,101.441,.01,1,1,"%D",2,0)
personal quick orders are deleted when personal quick orders
"^DD",101.44,101.441,.01,1,1,"%D",3,0)
are deleted.
"^DD",101.44,101.441,.01,1,1,"DT")
3060227
"^DD",101.44,101.441,.01,3)
Select a quick order.
"^DD",101.44,101.441,.01,21,0)
^.001^1^1^3010416^^
"^DD",101.44,101.441,.01,21,1,0)
This points to a quick order in the Order Dialog file (101.41).
"^DD",101.44,101.441,.01,"DT")
3060227
"BLD",6624,6)
^243
**END**
**END**
