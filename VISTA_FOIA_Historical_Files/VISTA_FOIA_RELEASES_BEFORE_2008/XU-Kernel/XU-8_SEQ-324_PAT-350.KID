Released XU*8*350 SEQ #324
Extracted from mail message
**KIDS**:XU*8.0*350^

**INSTALL NAME**
XU*8.0*350
"BLD",878,0)
XU*8.0*350^KERNEL^0^3060125^y
"BLD",878,1,0)
^^2^2^3051222^
"BLD",878,1,1,0)
See patch XU*8*350 in the National Patch Module on FORUM for complete
"BLD",878,1,2,0)
information on this patch.
"BLD",878,4,0)
^9.64PA^9.6^2
"BLD",878,4,9.6,0)
9.6
"BLD",878,4,9.6,2,0)
^9.641^9.6^1
"BLD",878,4,9.6,2,9.6,0)
BUILD  (File-top level)
"BLD",878,4,9.6,2,9.6,1,0)
^9.6411^62^2
"BLD",878,4,9.6,2,9.6,1,61,0)
TEST#
"BLD",878,4,9.6,2,9.6,1,62,0)
SEQ#
"BLD",878,4,9.6,222)
y^y^p^^^^n^^n
"BLD",878,4,9.6,224)

"BLD",878,4,9.7,0)
9.7
"BLD",878,4,9.7,2,0)
^9.641^9.7^1
"BLD",878,4,9.7,2,9.7,0)
INSTALL  (File-top level)
"BLD",878,4,9.7,2,9.7,1,0)
^9.6411^62^2
"BLD",878,4,9.7,2,9.7,1,61,0)
TEST#
"BLD",878,4,9.7,2,9.7,1,62,0)
SEQ#
"BLD",878,4,9.7,222)
y^y^p^^^^n^^n
"BLD",878,4,9.7,224)

"BLD",878,4,"APDD",9.6,9.6)

"BLD",878,4,"APDD",9.6,9.6,61)

"BLD",878,4,"APDD",9.6,9.6,62)

"BLD",878,4,"APDD",9.7,9.7)

"BLD",878,4,"APDD",9.7,9.7,61)

"BLD",878,4,"APDD",9.7,9.7,62)

"BLD",878,4,"B",9.6,9.6)

"BLD",878,4,"B",9.7,9.7)

"BLD",878,6.3)
7
"BLD",878,"ABPKG")
n
"BLD",878,"KRN",0)
^9.67PA^8989.52^19
"BLD",878,"KRN",.4,0)
.4
"BLD",878,"KRN",.401,0)
.401
"BLD",878,"KRN",.402,0)
.402
"BLD",878,"KRN",.403,0)
.403
"BLD",878,"KRN",.5,0)
.5
"BLD",878,"KRN",.84,0)
.84
"BLD",878,"KRN",3.6,0)
3.6
"BLD",878,"KRN",3.8,0)
3.8
"BLD",878,"KRN",9.2,0)
9.2
"BLD",878,"KRN",9.8,0)
9.8
"BLD",878,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",878,"KRN",9.8,"NM",1,0)
XPDIP^^0^39673736
"BLD",878,"KRN",9.8,"NM",2,0)
XPDIST^^0^15492727
"BLD",878,"KRN",9.8,"NM","B","XPDIP",1)

"BLD",878,"KRN",9.8,"NM","B","XPDIST",2)

"BLD",878,"KRN",19,0)
19
"BLD",878,"KRN",19,"NM",0)
^9.68A^^
"BLD",878,"KRN",19.1,0)
19.1
"BLD",878,"KRN",101,0)
101
"BLD",878,"KRN",409.61,0)
409.61
"BLD",878,"KRN",771,0)
771
"BLD",878,"KRN",870,0)
870
"BLD",878,"KRN",8989.51,0)
8989.51
"BLD",878,"KRN",8989.52,0)
8989.52
"BLD",878,"KRN",8994,0)
8994
"BLD",878,"KRN","B",.4,.4)

"BLD",878,"KRN","B",.401,.401)

"BLD",878,"KRN","B",.402,.402)

"BLD",878,"KRN","B",.403,.403)

"BLD",878,"KRN","B",.5,.5)

"BLD",878,"KRN","B",.84,.84)

"BLD",878,"KRN","B",3.6,3.6)

"BLD",878,"KRN","B",3.8,3.8)

"BLD",878,"KRN","B",9.2,9.2)

"BLD",878,"KRN","B",9.8,9.8)

"BLD",878,"KRN","B",19,19)

"BLD",878,"KRN","B",19.1,19.1)

"BLD",878,"KRN","B",101,101)

"BLD",878,"KRN","B",409.61,409.61)

"BLD",878,"KRN","B",771,771)

"BLD",878,"KRN","B",870,870)

"BLD",878,"KRN","B",8989.51,8989.51)

"BLD",878,"KRN","B",8989.52,8989.52)

"BLD",878,"KRN","B",8994,8994)

"BLD",878,"QUES",0)
^9.62^^
"BLD",878,"REQB",0)
^9.611^^
"FIA",9.6)
BUILD
"FIA",9.6,0)
^XPD(9.6,
"FIA",9.6,0,0)
9.6I
"FIA",9.6,0,1)
y^y^p^^^^n^^n
"FIA",9.6,0,10)

"FIA",9.6,0,11)

"FIA",9.6,0,"RLRO")

"FIA",9.6,0,"VR")
8.0^XU
"FIA",9.6,9.6)
1
"FIA",9.6,9.6,61)

"FIA",9.6,9.6,62)

"FIA",9.7)
INSTALL
"FIA",9.7,0)
^XPD(9.7,
"FIA",9.7,0,0)
9.7I
"FIA",9.7,0,1)
y^y^p^^^^n^^n
"FIA",9.7,0,10)

"FIA",9.7,0,11)

"FIA",9.7,0,"RLRO")

"FIA",9.7,0,"VR")
8.0^XU
"FIA",9.7,9.7)
1
"FIA",9.7,9.7,61)

"FIA",9.7,9.7,62)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3051215^2970507^.5
"PKG",3,22,1,"PAH",1,0)
350^3060125
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3060125
"PKG",3,22,1,"PAH",1,1,1,0)
See patch XU*8*350 in the National Patch Module on FORUM for complete
"PKG",3,22,1,"PAH",1,1,2,0)
information on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XPDIP")
0^1^B39673736
"RTN","XPDIP",1,0)
XPDIP ;SFISC/RSD - Install Package & Routine file ;06/23/2005  17:05
"RTN","XPDIP",2,0)
 ;;8.0;KERNEL;**15,21,28,30,41,44,51,58,83,92,100,108,137,229,350**;Jul 10, 1995;Build 7
"RTN","XPDIP",3,0)
 Q
"RTN","XPDIP",4,0)
PKG ;
"RTN","XPDIP",5,0)
 N %,OLDA,DA,DIK,XPD,XPDFIL,XPDPKG,XPDBLDA,Y
"RTN","XPDIP",6,0)
 ;update variable for graphic display
"RTN","XPDIP",7,0)
 I $D(XPDIDVT) S XPDIDTOT=10,XPDIDMOD=1,XPDIDCNT=0 D:XPDIDVT UPDATE^XPDID(0)
"RTN","XPDIP",8,0)
 ;XPDPKG=ien of Package file, OLDA=old Package ien
"RTN","XPDIP",9,0)
 S Y=$$PKGADD,XPDPKG=$P(Y,U),OLDA=$P(Y,U,2)
"RTN","XPDIP",10,0)
 ;Package file entry not sent, XPDPKG=0
"RTN","XPDIP",11,0)
 G:'XPDPKG PKGEND
"RTN","XPDIP",12,0)
 ;update version multiple
"RTN","XPDIP",13,0)
 S DA=XPDPKG D PKGV
"RTN","XPDIP",14,0)
PKGH I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+2 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",15,0)
 S %=$P(^DIC(9.4,XPDPKG,0),U,4)
"RTN","XPDIP",16,0)
 ;repoint Help Frame (0;4)
"RTN","XPDIP",17,0)
 I $L(%),'% S $P(^DIC(9.4,XPDPKG,0),U,4)=$$LK^XPDIA("^DIC(9.2)",%),DIK="^DIC(9.4," D IX1^DIK
"RTN","XPDIP",18,0)
 ;update node 20 for Patient Merge
"RTN","XPDIP",19,0)
 N REC,IEN
"RTN","XPDIP",20,0)
 S REC=0
"RTN","XPDIP",21,0)
 F  S REC=$O(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC)) Q:'REC  D
"RTN","XPDIP",22,0)
 . ;;Only install if have a routine defined
"RTN","XPDIP",23,0)
 . K IEN I '$L($P($G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,0)),U,3)) Q
"RTN","XPDIP",24,0)
 . S IEN(9.402,"?+1,"_XPDPKG_",",.01)=$P($G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,0)),U,1)
"RTN","XPDIP",25,0)
 . S IEN(9.402,"?+1,"_XPDPKG_",",3)=$P($G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,0)),U,3)
"RTN","XPDIP",26,0)
 . S IEN(9.402,"?+1,"_XPDPKG_",",4)=$G(^XTMP("XPDI",XPDA,"PKG",OLDA,20,REC,1))
"RTN","XPDIP",27,0)
 . D UPDATE^DIE("","IEN")
"RTN","XPDIP",28,0)
 . Q
"RTN","XPDIP",29,0)
 ;
"RTN","XPDIP",30,0)
PKGEND S XPDBLDA=$$BLD(XPDBLD) Q:'XPDBLDA
"RTN","XPDIP",31,0)
 ;Move the Test/SEQ number from build to Install file.
"RTN","XPDIP",32,0)
 S ^XPD(9.7,XPDA,6)=$G(^XPD(9.6,XPDBLDA,6))
"RTN","XPDIP",33,0)
 ;move Alpha/Beta testing info to Kernel site para file
"RTN","XPDIP",34,0)
 I XPDPKG S %=$G(^XPD(9.6,XPDBLDA,"ABPKG")) D
"RTN","XPDIP",35,0)
 .;Install message and they have an address, set flag in XPDIST
"RTN","XPDIP",36,0)
 .I $P(%,U)="y",$P(%,U,2)="y",$L($P(%,U,3)) S $P(XPDIST,U,2)=$P(%,U,3)
"RTN","XPDIP",37,0)
 .D EN^XQABLOAD(XPDBLDA)
"RTN","XPDIP",38,0)
 Q
"RTN","XPDIP",39,0)
PKGADD() ;check Package file, add if not there
"RTN","XPDIP",40,0)
 ;return new Package file ien^old ien
"RTN","XPDIP",41,0)
 N DA,DIK,XPD,XPDFIL,XPDO,X,Y
"RTN","XPDIP",42,0)
 S DA=+$P(^XPD(9.7,XPDA,0),U,2),XPDO=+$O(^XTMP("XPDI",XPDA,"PKG",0)),X=$P($G(^(XPDO,0)),U)
"RTN","XPDIP",43,0)
 I DA,$D(^DIC(9.4,DA,0)) Q DA_U_XPDO
"RTN","XPDIP",44,0)
 ;quit if there was no package entry sent
"RTN","XPDIP",45,0)
 Q:'XPDO "0^0"
"RTN","XPDIP",46,0)
 S XPDFIL=9.4,Y=$$DIC^XPDIK(9.4,X) Q:'Y "0^0"
"RTN","XPDIP",47,0)
 S DA=+Y
"RTN","XPDIP",48,0)
 ;if new entry in package file, bring in everything
"RTN","XPDIP",49,0)
 I $P(Y,U,3) D
"RTN","XPDIP",50,0)
 .M ^DIC(9.4,DA)=^XTMP("XPDI",XPDA,"PKG",XPDO)
"RTN","XPDIP",51,0)
 .;kill the -1 flag node first
"RTN","XPDIP",52,0)
 .K ^DIC(9.4,DA,-1)
"RTN","XPDIP",53,0)
 .;re-cross ref after adding a new package
"RTN","XPDIP",54,0)
 .S DIK="^DIC(9.4," D IX1^DIK
"RTN","XPDIP",55,0)
 ;add package to file 9.7
"RTN","XPDIP",56,0)
 S XPD(9.7,XPDA_",",1)=DA D FILE^DIE("","XPD")
"RTN","XPDIP",57,0)
 Q DA_U_XPDO
"RTN","XPDIP",58,0)
 ;
"RTN","XPDIP",59,0)
BLD(XPDBLD) ;add Build entry, XPDBLD=Build ien in ^XTMP("XPDI",XPDA,"BLD",
"RTN","XPDIP",60,0)
 N %,DA,DIK,XPDFIL,Y
"RTN","XPDIP",61,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+4 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",62,0)
 ;XPDBLD=Build ien in ^XTMP, set in XPDIJ
"RTN","XPDIP",63,0)
 S XPDFIL=9.6,Y=$$DIC^XPDIK(9.6,XPDNM) Q:'Y ""
"RTN","XPDIP",64,0)
 S DA=+Y
"RTN","XPDIP",65,0)
 ;Build entry not new, remove old data
"RTN","XPDIP",66,0)
 I '$P(Y,U,3) S %=$P(^XPD(9.6,DA,0),U,2) K ^XPD(9.6,DA) K:% ^XPD(9.6,"C",%,DA)
"RTN","XPDIP",67,0)
 M ^XPD(9.6,DA)=^XTMP("XPDI",XPDA,"BLD",XPDBLD)
"RTN","XPDIP",68,0)
 ;reset Package File Link (0;2)
"RTN","XPDIP",69,0)
 ;XPDIST = national site tracking^A/B install message address
"RTN","XPDIP",70,0)
 S $P(^XPD(9.6,DA,0),U,2)=$S(XPDPKG:XPDPKG,1:"") S:$P(^(0),U,5)="y" XPDIST=1
"RTN","XPDIP",71,0)
 ;re-index cross-ref. on fields .01 and 1
"RTN","XPDIP",72,0)
 S DIK="^XPD(9.6," F Y=.01,1 S DIK(1)=Y D EN1^DIK
"RTN","XPDIP",73,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIP",74,0)
 Q DA
"RTN","XPDIP",75,0)
 ;
"RTN","XPDIP",76,0)
 ;update the version multiple in the package file
"RTN","XPDIP",77,0)
PKGV N %
"RTN","XPDIP",78,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+2 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",79,0)
 ;%=ien in the Version multiple_U_ien in Patch multiple in ^XTMP
"RTN","XPDIP",80,0)
 S %=$G(^XTMP("XPDI",XPDA,"PKG",OLDA,-1))
"RTN","XPDIP",81,0)
 I XPDNM'["*" D  Q
"RTN","XPDIP",82,0)
 .S %=+% Q:'$D(^XTMP("XPDI",XPDA,"PKG",OLDA,22,%,0))  S %=^(0) S:$D(^(1)) %(1)=$NA(^(1))
"RTN","XPDIP",83,0)
 .S $P(%,U,3,4)=DT_U_DUZ,%=$$PKGVER(DA,.%)
"RTN","XPDIP",84,0)
 ;update patch history multiple
"RTN","XPDIP",85,0)
 Q:'$D(^XTMP("XPDI",XPDA,"PKG",OLDA,22,+%,"PAH",+$P(%,U,2),0))  S %=$P(^(0),U) S:$D(^(1)) %(1)=$NA(^(1))
"RTN","XPDIP",86,0)
 ;check File Comment, %=patch number
"RTN","XPDIP",87,0)
 S:^XPD(9.7,XPDA,2)[" SEQ #" %=$P(^(2),"*",3)
"RTN","XPDIP",88,0)
 S $P(%,U,2,3)=DT_U_DUZ,%=$$PKGPAT(DA,$$VER^XPDUTL(XPDNM),.%)
"RTN","XPDIP",89,0)
 Q
"RTN","XPDIP",90,0)
 ;
"RTN","XPDIP",91,0)
PKGVER(XPDPDA,XPDI) ;update version in package file, XPDPDA=Package file ien, return ien
"RTN","XPDIP",92,0)
 ;XPDI=version^date distr.^date installed^install by
"RTN","XPDIP",93,0)
 ;XPDI(1)=root of description field
"RTN","XPDIP",94,0)
 N I,X,XPD,XPDIEN,XPDJ,XPDV
"RTN","XPDIP",95,0)
 S XPDIEN=","_XPDPDA_",",XPDV=$$MDIC(9.49,XPDIEN,$P(XPDI,U)) Q:'XPDV 0
"RTN","XPDIP",96,0)
 S XPD(9.4,XPDPDA_",",13)=$P(XPDI,U),X="XPD(9.49,"""_XPDV_XPDIEN_""")"
"RTN","XPDIP",97,0)
 F I=1:1:3 S:$P(XPDI,U,I+1)]"" @X@(I)=$P(XPDI,U,I+1)
"RTN","XPDIP",98,0)
 S:$D(XPDI(1)) @X@(41)=XPDI(1)
"RTN","XPDIP",99,0)
 D FILE^DIE("","XPD")
"RTN","XPDIP",100,0)
 Q XPDV
"RTN","XPDIP",101,0)
 ;
"RTN","XPDIP",102,0)
PKGPAT(XPDPDA,XPDV,XPDI) ;update patch history
"RTN","XPDIP",103,0)
 ;INPUT: XPDPDA=Package file ien, XPDV=version
"RTN","XPDIP",104,0)
 ;XPDI=patch^date installed^install by,   returns version ien^patch ien
"RTN","XPDIP",105,0)
 N I,X,XPD,XPDP,XPDIEN
"RTN","XPDIP",106,0)
 ;quit if we can't find the version multiple, resets XPDV=ien of version
"RTN","XPDIP",107,0)
 S XPDIEN=","_XPDPDA_",",XPDV=$$MDIC(9.49,XPDIEN,XPDV) Q:'XPDV 0
"RTN","XPDIP",108,0)
 S XPDIEN=","_XPDV_XPDIEN,XPDP=$$MDIC(9.4901,XPDIEN,$P(XPDI,U)) Q:'XPDP 0
"RTN","XPDIP",109,0)
 S X="XPD(9.4901,"""_XPDP_XPDIEN_""")"
"RTN","XPDIP",110,0)
 F I=.02,.03 S:$P(XPDI,U,I*100)]"" @X@(I)=$P(XPDI,U,I*100)
"RTN","XPDIP",111,0)
 S:$D(XPDI(1)) @X@(1)=XPDI(1)
"RTN","XPDIP",112,0)
 D FILE^DIE("","XPD")
"RTN","XPDIP",113,0)
 Q XPDV_U_XPDP
"RTN","XPDIP",114,0)
 ;
"RTN","XPDIP",115,0)
 ;XPDF=subfile #,XPDIEN=ien string, X=input
"RTN","XPDIP",116,0)
MDIC(XPDF,XPDIEN,XPDX) ;
"RTN","XPDIP",117,0)
 N DIERR,XPD,XPDN
"RTN","XPDIP",118,0)
 D FIND^DIC(XPDF,XPDIEN,"","XQf",XPDX,5,"","","","XPD")
"RTN","XPDIP",119,0)
 ;one or more matches, just return first one
"RTN","XPDIP",120,0)
 I $G(XPD(0)) D:XPD(0)>1  Q XPD(1)
"RTN","XPDIP",121,0)
 .N %
"RTN","XPDIP",122,0)
 .S %(1)=$P(^DD(XPDF,.01,0),U)_"  "_XPDX_"  is Duplicated,",%(2)=" only ien #"_XPD(1)_" was updated."
"RTN","XPDIP",123,0)
 .D MES^XPDUTL(.%)
"RTN","XPDIP",124,0)
 ;add a new entry
"RTN","XPDIP",125,0)
 S XPDN(XPDF,"+1"_XPDIEN,.01)=XPDX K XPD
"RTN","XPDIP",126,0)
 D UPDATE^DIE("","XPDN","XPD")
"RTN","XPDIP",127,0)
 I '$G(XPD(1)) D BMES^XPDUTL(" "_$P(^DD(XPDF,.01,0),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIP",128,0)
 Q XPD(1)
"RTN","XPDIP",129,0)
 ;
"RTN","XPDIP",130,0)
RTN ;move rtns to install file
"RTN","XPDIP",131,0)
 N XPD,XPDC,XPDCR,XPDI,XPDJ,XPDK,XPDL,XPDM,XPDR,XPDRH,X,NOW
"RTN","XPDIP",132,0)
 K ^XPD(9.7,XPDA,"RTN"),^TMP($J)
"RTN","XPDIP",133,0)
 S (XPDC,XPDCR,XPDRH)=0,XPDJ="",NOW=$$NOW^XLFDT()
"RTN","XPDIP",134,0)
 ;get all routines that were loaded, XPDM=action
"RTN","XPDIP",135,0)
 ;actions are 0=load, 1=delete, 2=skip
"RTN","XPDIP",136,0)
 F  S XPDJ=$O(^XTMP("XPDI",XPDA,"RTN",XPDJ)) Q:XPDJ=""  S XPDM=^(XPDJ) D:'XPDM
"RTN","XPDIP",137,0)
 .;XPD, build array to update ROUTINE multiple in INSTALL file
"RTN","XPDIP",138,0)
 .S XPDC=XPDC+1,^TMP($J,"XPDL",XPDC)=XPDC,^TMP($J,"XPD",9.704,"+"_XPDC_","_XPDA_",",.01)=XPDJ
"RTN","XPDIP",139,0)
 .;XPDR, build array to update ROUTINE file, Set install date
"RTN","XPDIP",140,0)
 .;S:'$D(^DIC(9.8,"B",XPDJ)) XPDCR=XPDCR+1,^TMP($J,"XPDR",9.8,"?+"_XPDCR_",",.01)=XPDJ,^(1)="R"
"RTN","XPDIP",141,0)
 .S XPDCR=XPDCR+1,^TMP($J,"XPDR",9.8,"?+"_XPDCR_",",.01)=XPDJ,^(1)="R",^(7.4)=NOW ;**229
"RTN","XPDIP",142,0)
 ;if we are doing VT graphic display, update only 40%
"RTN","XPDIP",143,0)
 I $D(XPDIDVT) S XPDIDCNT=XPDIDTOT*.4 D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",144,0)
 F XPDK="DIKZ","DIEZ","DIPZ" D
"RTN","XPDIP",145,0)
 .S XPDI=0
"RTN","XPDIP",146,0)
 .;loop thru list of compile template routines
"RTN","XPDIP",147,0)
 .;XTMP("XPDI",XPDA,"DIKZ",ien,routine name)
"RTN","XPDIP",148,0)
 .F  S XPDI=$O(^XTMP("XPDI",XPDA,XPDK,XPDI)),XPDJ="" Q:'XPDI  D
"RTN","XPDIP",149,0)
 ..I 'XPDRH D BMES^XPDUTL(" The following Routines were created during this install:") S XPDRH=1
"RTN","XPDIP",150,0)
 ..F  S XPDJ=$O(^XTMP("XPDI",XPDA,XPDK,XPDI,XPDJ)) Q:XPDJ=""  D:'$D(^XTMP("XPDI",XPDA,"RTN",XPDJ))
"RTN","XPDIP",151,0)
 ...S XPDC=XPDC+1,^TMP($J,"XPDL",XPDC)=XPDC,^TMP($J,"XPD",9.704,"+"_XPDC_","_XPDA_",",.01)=XPDJ
"RTN","XPDIP",152,0)
 ...D MES^XPDUTL("     "_XPDJ)
"RTN","XPDIP",153,0)
 ;update routine multiple in Install file with routines and
"RTN","XPDIP",154,0)
 ;compile template routines
"RTN","XPDIP",155,0)
 I $D(^TMP($J,"XPD"))>9 D
"RTN","XPDIP",156,0)
 .D UPDATE^DIE("","^TMP($J,""XPD"")","^TMP($J,""XPDL"")")
"RTN","XPDIP",157,0)
 .;if we are doing VT graphic display, update only 40%
"RTN","XPDIP",158,0)
 .I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+(XPDIDTOT*.40) D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIP",159,0)
 ;update Routine file
"RTN","XPDIP",160,0)
 D:$D(^TMP($J,"XPDR"))>9 UPDATE^DIE("","^TMP($J,""XPDR"")")
"RTN","XPDIP",161,0)
 ;if we are doing VT graphic display, update 100%
"RTN","XPDIP",162,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIP",163,0)
 Q
"RTN","XPDIST")
0^2^B15492727
"RTN","XPDIST",1,0)
XPDIST ;SFISC/RSD - site tracking; [5/7/02 5:53am] ;01/25/2006
"RTN","XPDIST",2,0)
 ;;8.0;KERNEL;**66,108,185,233,350**;Jul 10, 1995;Build 7
"RTN","XPDIST",3,0)
 ;Returns ""=failed, XMZ=sent
"RTN","XPDIST",4,0)
 ;D0=ien in file 9.7, XPY=national site tracking^address(optional)
"RTN","XPDIST",5,0)
EN(D0,XPY) ;send message
"RTN","XPDIST",6,0)
 N %,DIFROM,XPD,XPD0,XPD1,XPD2,XPDV,XPDTEXT,XPZ,XMDUZ,XMSUB,XMTEXT,XMY,XMZ,X,X1,Z,Y,XPD6
"RTN","XPDIST",7,0)
 ;Get data needed
"RTN","XPDIST",8,0)
 I '$D(^XPD(9.7,$G(D0),0)) D BMES^XPDUTL(" INSTALL file entry missing") Q ""
"RTN","XPDIST",9,0)
 ;p350 -add node 6 for the Test# and Seq#. -REM
"RTN","XPDIST",10,0)
 S XPD0=^XPD(9.7,D0,0),XPD1=$G(^(1)),XPD2=$G(^(2)),XPD6=$G(^(6))
"RTN","XPDIST",11,0)
 I '$P(XPD0,U,2) D BMES^XPDUTL(" No link to PACKAGE file") Q ""
"RTN","XPDIST",12,0)
 S XPD=$P($G(^DIC(9.4,+$P(XPD0,U,2),0)),U),XPDV=$$VER^XPDUTL($P(XPD0,U))
"RTN","XPDIST",13,0)
 I XPD="" D BMES^XPDUTL(" PACKAGE file entry missing") Q ""
"RTN","XPDIST",14,0)
 ;XPZ(1)=start, XPZ(2)=completion date/time, XPZ(3)=run time
"RTN","XPDIST",15,0)
 S XPZ(1)=$P(XPD1,U),XPZ(2)=$P(XPD1,U,3),XPZ(3)=$$FMDIFF^XLFDT(XPZ(2),XPZ(1),3),XPZ(1)=$$FMTE^XLFDT(XPZ(1)),XPZ(2)=$$FMTE^XLFDT(XPZ(2))
"RTN","XPDIST",16,0)
 D LOCAL
"RTN","XPDIST",17,0)
 D REMEDY ;p350 -REM
"RTN","XPDIST",18,0)
 Q $$FORUM()
"RTN","XPDIST",19,0)
 ;
"RTN","XPDIST",20,0)
 ;
"RTN","XPDIST",21,0)
FORUM() ;send to Server on FORUM
"RTN","XPDIST",22,0)
 Q:$G(XPY)="" ""
"RTN","XPDIST",23,0)
 S:XPY XMY("S.A5CSTS@FORUM.VA.GOV")="" ;,XMY("ESSRESOURCE@MED.VA.GOV")=""
"RTN","XPDIST",24,0)
 S:$L($P(XPY,U,2)) XMY($P(XPY,U,2))=""
"RTN","XPDIST",25,0)
 K ^TMP($J)
"RTN","XPDIST",26,0)
 ;Quit if not VA production primary domain
"RTN","XPDIST",27,0)
 I $G(^XMB("NETNAME"))'[".VA.GOV" D BMES^XPDUTL(" Not a VA primary domain") Q ""
"RTN","XPDIST",28,0)
 X ^%ZOSF("UCI") S %=^%ZOSF("PROD")
"RTN","XPDIST",29,0)
 S:%'["," Y=$P(Y,",")
"RTN","XPDIST",30,0)
 I Y'=% D BMES^XPDUTL(" Not a production UCI") Q ""
"RTN","XPDIST",31,0)
 ;Message for server
"RTN","XPDIST",32,0)
 S XPDTEXT(1,0)="PACKAGE INSTALL"
"RTN","XPDIST",33,0)
 S XPDTEXT(2,0)="SITE: "_$G(^XMB("NETNAME"))
"RTN","XPDIST",34,0)
 S XPDTEXT(3,0)="PACKAGE: "_XPD
"RTN","XPDIST",35,0)
 S XPDTEXT(4,0)="VERSION: "_XPDV
"RTN","XPDIST",36,0)
 S XPDTEXT(5,0)="Start time: "_XPZ(1)
"RTN","XPDIST",37,0)
 S XPDTEXT(6,0)="Completion time: "_XPZ(2)
"RTN","XPDIST",38,0)
 S XPDTEXT(7,0)="Run time: "_XPZ(3)
"RTN","XPDIST",39,0)
 S XPDTEXT(8,0)="DATE: "_DT
"RTN","XPDIST",40,0)
 S XPDTEXT(9,0)="Installed by: "_$P($G(^VA(200,+$P(XPD0,U,11),0)),U)
"RTN","XPDIST",41,0)
 S XPDTEXT(10,0)="Install Name: "_$P(XPD0,U)
"RTN","XPDIST",42,0)
 S XPDTEXT(11,0)="Distribution Date: "_$P(XPD1,U,4)
"RTN","XPDIST",43,0)
 S XPDTEXT(12,0)=XPD2
"RTN","XPDIST",44,0)
 S XMDUZ=$S($P(XPD0,U,11):+$P(XPD0,U,11),1:.5),XMTEXT="XPDTEXT(",XMSUB=$P(XPD0,U)_" INSTALLATION"
"RTN","XPDIST",45,0)
 D ^XMD
"RTN","XPDIST",46,0)
 K ^TMP($J)
"RTN","XPDIST",47,0)
 Q "#"_$G(XMZ)
"RTN","XPDIST",48,0)
 ;
"RTN","XPDIST",49,0)
LOCAL ;Send a message to local mail group
"RTN","XPDIST",50,0)
 S X=$$MAILGRP^XPDUTL(XPD) Q:X=""
"RTN","XPDIST",51,0)
 K ^TMP($J),XMY
"RTN","XPDIST",52,0)
 S XMY(X)="" D GETENV^%ZOSV
"RTN","XPDIST",53,0)
 ;Message for users
"RTN","XPDIST",54,0)
 S XPDTEXT(1,0)="PACKAGE INSTALL"
"RTN","XPDIST",55,0)
 S XPDTEXT(2,0)="SITE: "_$G(^XMB("NETNAME"))
"RTN","XPDIST",56,0)
 S XPDTEXT(3,0)="PACKAGE: "_XPD
"RTN","XPDIST",57,0)
 S XPDTEXT(4,0)="VERSION: "_XPDV
"RTN","XPDIST",58,0)
 S XPDTEXT(5,0)="Start time: "_XPZ(1)
"RTN","XPDIST",59,0)
 S XPDTEXT(6,0)="Completion time: "_XPZ(2)
"RTN","XPDIST",60,0)
 S XPDTEXT(7,0)="Environment: "_Y
"RTN","XPDIST",61,0)
 S XPDTEXT(8,0)="Installed by: "_$P($G(^VA(200,+$P(XPD0,U,11),0)),U)
"RTN","XPDIST",62,0)
 S XPDTEXT(9,0)="Install Name: "_$P(XPD0,U)
"RTN","XPDIST",63,0)
 S XPDTEXT(10,0)="Distribution Date: "_$$FMTE^XLFDT($P(XPD1,U,4))
"RTN","XPDIST",64,0)
 S XMDUZ=$S($P(XPD0,U,11):+$P(XPD0,U,11),1:.5),XMTEXT="XPDTEXT(",XMSUB=$P(XPD0,U)_" INSTALLATION"
"RTN","XPDIST",65,0)
 D ^XMD
"RTN","XPDIST",66,0)
 K XMTEXT
"RTN","XPDIST",67,0)
 Q
"RTN","XPDIST",68,0)
 ;
"RTN","XPDIST",69,0)
REMEDY ;Send to Remedy Server - ESSRESOURCE@MED.VA.GOV *p350 -REM
"RTN","XPDIST",70,0)
 Q:$G(XPY)=""
"RTN","XPDIST",71,0)
 S:XPY XMY("ESSRESOURCE@MED.VA.GOV")=""
"RTN","XPDIST",72,0)
 S:$L($P(XPY,U,2)) XMY($P(XPY,U,2))=""
"RTN","XPDIST",73,0)
 K ^TMP($J)
"RTN","XPDIST",74,0)
 ;Quit if not VA production primary domain
"RTN","XPDIST",75,0)
 I $G(^XMB("NETNAME"))'[".VA.GOV" D BMES^XPDUTL(" Not a VA primary domain") Q
"RTN","XPDIST",76,0)
 X ^%ZOSF("UCI") S %=^%ZOSF("PROD")
"RTN","XPDIST",77,0)
 S:%'["," Y=$P(Y,",")
"RTN","XPDIST",78,0)
 I Y'=% D BMES^XPDUTL(" Not a production UCI") Q
"RTN","XPDIST",79,0)
 ;Message for server (all in one string)
"RTN","XPDIST",80,0)
 ;XMTEXT=Type(1),Domain(2-65),Pkg(66-95),Version(96-125),
"RTN","XPDIST",81,0)
 ;       StartTime(126-147),CompleteTime(148-169),RunTime(170-177),
"RTN","XPDIST",82,0)
 ;       Date(178-199),InstalledBy(200-229),InstallName(230-259),
"RTN","XPDIST",83,0)
 ;       DistributionDate(260-281),Seq#(282-286),
"RTN","XPDIST",84,0)
 ;       PatchTestVersion(287-317)
"RTN","XPDIST",85,0)
 ;
"RTN","XPDIST",86,0)
 S X1=1_$G(^XMB("NETNAME")) ;Type is always "1"(1=patch,0=pkg).
"RTN","XPDIST",87,0)
 S $E(X1,66,95)=XPD,$E(X1,96,125)=XPDV,$E(X1,126,147)=XPZ(1),$E(X1,148,169)=XPZ(2),$E(X1,170,177)=XPZ(3),$E(X1,178,199)=DT
"RTN","XPDIST",88,0)
 S $E(X1,200,229)=$P($G(^VA(200,+$P(XPD0,U,11),0)),U),$E(X1,230,259)=$P(XPD0,U),$E(X1,260,281)=$P(XPD1,U,4),$E(X1,282,286)=$P(XPD6,U,2),$E(X1,287,317)=$P(XPD6,U)
"RTN","XPDIST",89,0)
 S XPDTEXT(1,0)=X1
"RTN","XPDIST",90,0)
 S XMDUZ=$S($P(XPD0,U,11):+$P(XPD0,U,11),1:.5),XMTEXT="XPDTEXT(",XMSUB="KIDS-"_$P(XPD0,U)_" INSTALLATION"
"RTN","XPDIST",91,0)
 D ^XMD
"RTN","XPDIST",92,0)
 K ^TMP($J),XMTEXT
"RTN","XPDIST",93,0)
 Q
"VER")
8.0^22.0
"^DD",9.6,9.6,61,0)
TEST#^NJ3,0^^6;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9.6,9.6,61,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9.6,9.6,61,21,0)
^^2^2^3050609^
"^DD",9.6,9.6,61,21,1,0)
This is just a place holder to reserve the database location in the 
"^DD",9.6,9.6,61,21,2,0)
INSTALL file.
"^DD",9.6,9.6,61,"DT")
3050609
"^DD",9.6,9.6,62,0)
SEQ#^NJ3,0^^6;2^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9.6,9.6,62,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9.6,9.6,62,21,0)
^^2^2^3050609^
"^DD",9.6,9.6,62,21,1,0)
This is just a place holder to reserve the database location in the 
"^DD",9.6,9.6,62,21,2,0)
INSTALL file.
"^DD",9.6,9.6,62,"DT")
3050609
"^DD",9.7,9.7,61,0)
TEST#^NJ3,0^^6;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9.7,9.7,61,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9.7,9.7,61,21,0)
^^1^1^3050609^
"^DD",9.7,9.7,61,21,1,0)
This field holds the Test Version Number from the patch module on FORUM.
"^DD",9.7,9.7,61,"DT")
3050609
"^DD",9.7,9.7,62,0)
SEQ#^NJ3,0^^6;2^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9.7,9.7,62,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9.7,9.7,62,21,0)
^.001^1^1^3050628^^
"^DD",9.7,9.7,62,21,1,0)
This field holds the Release Sequence # from the Patch Module on FORUM.
"^DD",9.7,9.7,62,"DT")
3050609
"BLD",878,6)
^324
**END**
**END**
