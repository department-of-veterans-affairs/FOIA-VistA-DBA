EMERGENCY Released EAS*1*37 SEQ #29
Extracted from mail message
**KIDS**:EAS*1.0*37^

**INSTALL NAME**
EAS*1.0*37
"BLD",4310,0)
EAS*1.0*37^ENROLLMENT APPLICATION SYSTEM^0^3030707^y
"BLD",4310,4,0)
^9.64PA^^
"BLD",4310,"KRN",0)
^9.67PA^8989.52^19
"BLD",4310,"KRN",.4,0)
.4
"BLD",4310,"KRN",.401,0)
.401
"BLD",4310,"KRN",.402,0)
.402
"BLD",4310,"KRN",.403,0)
.403
"BLD",4310,"KRN",.5,0)
.5
"BLD",4310,"KRN",.84,0)
.84
"BLD",4310,"KRN",3.6,0)
3.6
"BLD",4310,"KRN",3.8,0)
3.8
"BLD",4310,"KRN",9.2,0)
9.2
"BLD",4310,"KRN",9.8,0)
9.8
"BLD",4310,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4310,"KRN",9.8,"NM",1,0)
EASUER^^0^B14505031
"BLD",4310,"KRN",9.8,"NM","B","EASUER",1)
 
"BLD",4310,"KRN",19,0)
19
"BLD",4310,"KRN",19.1,0)
19.1
"BLD",4310,"KRN",101,0)
101
"BLD",4310,"KRN",409.61,0)
409.61
"BLD",4310,"KRN",771,0)
771
"BLD",4310,"KRN",870,0)
870
"BLD",4310,"KRN",8989.51,0)
8989.51
"BLD",4310,"KRN",8989.52,0)
8989.52
"BLD",4310,"KRN",8994,0)
8994
"BLD",4310,"KRN","B",.4,.4)
 
"BLD",4310,"KRN","B",.401,.401)
 
"BLD",4310,"KRN","B",.402,.402)
 
"BLD",4310,"KRN","B",.403,.403)
 
"BLD",4310,"KRN","B",.5,.5)
 
"BLD",4310,"KRN","B",.84,.84)
 
"BLD",4310,"KRN","B",3.6,3.6)
 
"BLD",4310,"KRN","B",3.8,3.8)
 
"BLD",4310,"KRN","B",9.2,9.2)
 
"BLD",4310,"KRN","B",9.8,9.8)
 
"BLD",4310,"KRN","B",19,19)
 
"BLD",4310,"KRN","B",19.1,19.1)
 
"BLD",4310,"KRN","B",101,101)
 
"BLD",4310,"KRN","B",409.61,409.61)
 
"BLD",4310,"KRN","B",771,771)
 
"BLD",4310,"KRN","B",870,870)
 
"BLD",4310,"KRN","B",8989.51,8989.51)
 
"BLD",4310,"KRN","B",8989.52,8989.52)
 
"BLD",4310,"KRN","B",8994,8994)
 
"BLD",4310,"QUES",0)
^9.62^^
"BLD",4310,"REQB",0)
^9.611^1^1
"BLD",4310,"REQB",1,0)
EAS*1.0*25^1
"BLD",4310,"REQB","B","EAS*1.0*25",1)
 
"MBREQ")
0
"PKG",551,-1)
1^1
"PKG",551,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",551,20,0)
^9.402P^1^1
"PKG",551,20,1,0)
2^^EASXDR
"PKG",551,20,1,1)
 
"PKG",551,20,"B",2,1)
 
"PKG",551,22,0)
^9.49I^1^1
"PKG",551,22,1,0)
1.0^3010315^3010516^66481
"PKG",551,22,1,"PAH",1,0)
37^3030707
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","EASUER")
0^1^B14505031
"RTN","EASUER",1,0)
EASUER ;ALB/CKN - GEOGRAPHIC MEANS TEST PHASE II ; 03-MAR-2003
"RTN","EASUER",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**25,37**;Mar 15, 2001
"RTN","EASUER",3,0)
 ;This routine contains several APIs that will be called from
"RTN","EASUER",4,0)
 ;different packages like Scheduling, PCE and Fee basis to notify
"RTN","EASUER",5,0)
 ;Enrollment package whenever any inpatient/outpatient encounter occurs,
"RTN","EASUER",6,0)
 ;or any appointment made or any changes made to fee basis authorization.
"RTN","EASUER",7,0)
 Q
"RTN","EASUER",8,0)
SCHED ;This API will be called from SDAM APPOINTMENT EVENTS via EAS UE SCHED 
"RTN","EASUER",9,0)
 ;EVENT protocol whenever any changes made to veteran's appointment.
"RTN","EASUER",10,0)
 ;Input variables used in this api:
"RTN","EASUER",11,0)
 ;             SDATA     -  piece 1 - ien of multiple entry of the 
"RTN","EASUER",12,0)
 ;                                    APPOINTMENTS multiple of the
"RTN","EASUER",13,0)
 ;                                    HOSPITAL LOCATION file.
"RTN","EASUER",14,0)
 ;                          piece 2 - ien of PATIENT file (DFN)
"RTN","EASUER",15,0)
 ;                          piece 3 - internal Date/time of appt.
"RTN","EASUER",16,0)
 ;                          piece 4 - ien of clinic in the HOSPITAL
"RTN","EASUER",17,0)
 ;                                    LOCATION file.
"RTN","EASUER",18,0)
 ;             SDAMEVT   -  ien pointing to an entry in the APPOINTMENT
"RTN","EASUER",19,0)
 ;                          TRANSACTION file (#409.66).
"RTN","EASUER",20,0)
 ;
"RTN","EASUER",21,0)
 N DFN,APT,APTDT
"RTN","EASUER",22,0)
 S DFN=$P($G(SDATA),"^",2) Q:DFN=""  ;Veteran's IEN
"RTN","EASUER",23,0)
 I $G(SDAMEVT)=1 D  ;if new appointment is made
"RTN","EASUER",24,0)
 . S APTDT=$P($G(SDATA),"^",3),APTDT=$$FY(APTDT)
"RTN","EASUER",25,0)
 . ;check current User Enrollee data and update it if necessary.
"RTN","EASUER",26,0)
 . I $$UPDCHK(DFN,APTDT) D FILE(DFN,APTDT)
"RTN","EASUER",27,0)
 Q
"RTN","EASUER",28,0)
ENC ;This API will be called from PXK VISIT DATA EVENT via EAS UE PCE EVENT
"RTN","EASUER",29,0)
 ;whenever any inpatient/outpatient encounter occurs.
"RTN","EASUER",30,0)
 ;Input:
"RTN","EASUER",31,0)
 ;^TMP("PXKCO",$J,VISIT,"V FILE STRING",V FILE RECORD,DDSUBSCRIPT,"AFTER/BEFORE")=DATA
"RTN","EASUER",32,0)
 ;where: subscript piece 1 - string notation representing package "PXKCO"
"RTN","EASUER",33,0)
 ;       subscript piece 2 - Job number ($J)
"RTN","EASUER",34,0)
 ;       subscript piece 3 - ien of VISIT file
"RTN","EASUER",35,0)
 ;       subscript piece 4 - string representing the VISIT or V file
"RTN","EASUER",36,0)
 ;                           data category
"RTN","EASUER",37,0)
 ;       subscript piece 5 - ien of the entry in the file represented in
"RTN","EASUER",38,0)
 ;                           subscript #4
"RTN","EASUER",39,0)
 ;       subscript piece 6 - subscript or DD node on which the data is stored.
"RTN","EASUER",40,0)
 ;       subscript piece 7 - string designating whether or not the data
"RTN","EASUER",41,0)
 ;                           is an "after" or "before" reflection of data.
"RTN","EASUER",42,0)
 ;
"RTN","EASUER",43,0)
 N VSIT,NODE,DFN,VDT
"RTN","EASUER",44,0)
 I '$D(^TMP("PXKCO",$J)) Q
"RTN","EASUER",45,0)
 S VSIT=$O(^TMP("PXKCO",$J,"")) Q:VSIT=""  ;ien of VISIT file
"RTN","EASUER",46,0)
 S NODE=$G(^AUPNVSIT(VSIT,0))
"RTN","EASUER",47,0)
 ;get Veteran's IEN and encounter date
"RTN","EASUER",48,0)
 S DFN=$P($G(NODE),"^",5),VDT=$P($G(NODE),"^",1)
"RTN","EASUER",49,0)
 S VDT=$$FY(VDT)
"RTN","EASUER",50,0)
 ;check current User Enrollee data and update if necessary
"RTN","EASUER",51,0)
 I $$UPDCHK(DFN,VDT) D FILE(DFN,VDT)
"RTN","EASUER",52,0)
 Q
"RTN","EASUER",53,0)
FBAUTH(FBDFN,FBTODT) ;This Enrollment api will be called from Fee basis
"RTN","EASUER",54,0)
 ;applications at the time of any fee basis authorization changes.
"RTN","EASUER",55,0)
 ;Input:         FBDFN  -  Veteran's ien
"RTN","EASUER",56,0)
 ;              FBTODT  -  Latest date of authorization.
"RTN","EASUER",57,0)
 ;
"RTN","EASUER",58,0)
 N XDT
"RTN","EASUER",59,0)
 S XDT=$$FY(FBTODT)
"RTN","EASUER",60,0)
 I $$UPDCHK(FBDFN,XDT) D FILE(FBDFN,XDT)
"RTN","EASUER",61,0)
 Q
"RTN","EASUER",62,0)
INP ;This Enrollment api will be called from DGPM MOVEMENT EVENT via 
"RTN","EASUER",63,0)
 ;EAS UE INP EVENT protocol whenever inpatient veteran is admitted,
"RTN","EASUER",64,0)
 ;transfered,discharged or any movement.
"RTN","EASUER",65,0)
 ;supported variables of this event:
"RTN","EASUER",66,0)
 ;       DFN  - Pointer to patient in PATIENT file (#2)
"RTN","EASUER",67,0)
 ;    DGPMDA  - Pointer to primary movement in PATIENT MOVEMENT file.
"RTN","EASUER",68,0)
 ;     DGPMP  - Zero node of primary movement prior to add/edit/del
"RTN","EASUER",69,0)
 ;     DGPMA  - Zero node of primary movement after add/edit/delete
"RTN","EASUER",70,0)
 ;
"RTN","EASUER",71,0)
 N XDT
"RTN","EASUER",72,0)
 I '$G(DFN)!'$G(DGPMDA) Q
"RTN","EASUER",73,0)
 S XDT=$P($G(^DGPM(DGPMDA,0)),"^")  ;Date of movement
"RTN","EASUER",74,0)
 S XDT=$$FY(XDT) I $$UPDCHK(DFN,XDT) D FILE(DFN,XDT)
"RTN","EASUER",75,0)
 Q
"RTN","EASUER",76,0)
UESTAT(DFN) ;This api will be called at the time of Annual MT renewal
"RTN","EASUER",77,0)
 ;process to check if veteran has UE status for current FY.
"RTN","EASUER",78,0)
 N UESTAT,UESITE,UESTN,CURSTN,PRNT
"RTN","EASUER",79,0)
 I '$G(DFN) Q 0  ;No DFN
"RTN","EASUER",80,0)
 S UESTAT=$P($G(^DPT(DFN,.361)),"^",7)
"RTN","EASUER",81,0)
 I UESTAT="" Q 0  ;Not User Enrollee
"RTN","EASUER",82,0)
 I UESTAT<$$FY(DT) Q 0  ;Not User Enrollee for current FY
"RTN","EASUER",83,0)
 S UESITE=$P($G(^DPT(DFN,.361)),"^",8) Q:+UESITE=0 0
"RTN","EASUER",84,0)
 S UESTN=$P($G(^DIC(4,UESITE,99)),"^")
"RTN","EASUER",85,0)
 S CURSTN=$P($$SITE^VASITE,"^",3)
"RTN","EASUER",86,0)
 S PRNT=$$PSITE(CURSTN),CURSTN=$P($G(^DIC(4,PRNT,99)),"^")
"RTN","EASUER",87,0)
 I UESTN'=CURSTN Q 2  ;Not same site
"RTN","EASUER",88,0)
 Q 1
"RTN","EASUER",89,0)
UPDCHK(DFN,APTDT) ;This api will determine whether to update User Enrollee data.
"RTN","EASUER",90,0)
 I '$G(DFN) Q 0  ;No DFN
"RTN","EASUER",91,0)
 I $P($G(^DPT(DFN,"VET")),"^")="N" Q 0  ;Quit if Non veteran
"RTN","EASUER",92,0)
 I APTDT<3030000 Q 0  ;Quit if APTDT is less than FY 2003
"RTN","EASUER",93,0)
 N CURSTAT
"RTN","EASUER",94,0)
 S CURSTAT=$P($G(^DPT(DFN,.361)),"^",7)
"RTN","EASUER",95,0)
 I APTDT>CURSTAT Q 1
"RTN","EASUER",96,0)
 Q 0
"RTN","EASUER",97,0)
FY(XDATE) ;Returns a fiscal year for the date
"RTN","EASUER",98,0)
 N ENFY S ENFY=""
"RTN","EASUER",99,0)
 I $G(XDATE)?7N.E S ENFY=$S($E(XDATE,4,5)<10:$E(XDATE,1,3),1:$E(XDATE,1,3)+1)
"RTN","EASUER",100,0)
 Q ENFY_"0000"
"RTN","EASUER",101,0)
PSITE(STA) ;Get parent site IEN
"RTN","EASUER",102,0)
 N PRNT
"RTN","EASUER",103,0)
 S PRNT=+$$PRNT^XUAF4(STA)
"RTN","EASUER",104,0)
 I 'PRNT S PRNT=+$$PRNT^XUAF4($E($G(STA),1,3))
"RTN","EASUER",105,0)
 I 'PRNT S PRNT=$O(^DIC(4,"D",$E($G(STA),1,3),""))
"RTN","EASUER",106,0)
 Q PRNT
"RTN","EASUER",107,0)
FILE(XIEN,XDT) ;Update User Enrollee fields and queue Z07
"RTN","EASUER",108,0)
 N DATA,FILEUPD,SITE,PRNT,EVENT,IYR
"RTN","EASUER",109,0)
 S SITE=$$SITE^VASITE,SITE=$P($G(SITE),"^",3)
"RTN","EASUER",110,0)
 S PRNT=$$PSITE(SITE) Q:'+$G(PRNT)
"RTN","EASUER",111,0)
 S DATA(.3617)=XDT,DATA(.3618)=PRNT
"RTN","EASUER",112,0)
 I '$$UPD^DGENDBS(2,.XIEN,.DATA) Q
"RTN","EASUER",113,0)
 S IYR=$$INCYR(XIEN)
"RTN","EASUER",114,0)
 S EVENT("ENROLL")=1 I $$LOG^IVMPLOG(XIEN,IYR,.EVENT)
"RTN","EASUER",115,0)
 Q
"RTN","EASUER",116,0)
INCYR(XIEN) ;Get valid income year
"RTN","EASUER",117,0)
 ;N INCYR,LMT,R3015,I,TEMP
"RTN","EASUER",118,0)
 I $D(^IVM(301.5,"APT",XIEN)) D  Q INCYR
"RTN","EASUER",119,0)
 . S INCYR=$O(^IVM(301.5,"APT",XIEN,""),-1)
"RTN","EASUER",120,0)
 F I=1,2,4 D
"RTN","EASUER",121,0)
 . S LMT=$$LST^DGMTU(XIEN,,I)
"RTN","EASUER",122,0)
 . I +$G(LMT) S TEMP($P(LMT,"^",2))=""
"RTN","EASUER",123,0)
 I $D(TEMP) S LMT=$O(TEMP(""),-1),INCYR=($E(LMT,1,3)-1)_"0000" Q INCYR
"RTN","EASUER",124,0)
 S INCYR=($E(DT,1,3)-1)_"0000"
"RTN","EASUER",125,0)
 Q INCYR
"VER")
8.0^22
**END**
**END**
