Released GMTS*2.7*35 SEQ #34
Extracted from mail message
**KIDS**:GMTS*2.7*35^

**INSTALL NAME**
GMTS*2.7*35
"BLD",2065,0)
GMTS*2.7*35^HEALTH SUMMARY^0^3000509^y
"BLD",2065,1,0)
^^2^2^3000412^^^^
"BLD",2065,1,1,0)
The description of this patch may be found on the National Patch Module 
"BLD",2065,1,2,0)
under GMTS*2.7*35.
"BLD",2065,4,0)
^9.64PA^142^2
"BLD",2065,4,142,0)
142
"BLD",2065,4,142,222)
y^y^f^^^^n
"BLD",2065,4,142.1,0)
142.1
"BLD",2065,4,142.1,222)
y^y^f^^^^n
"BLD",2065,4,"B",142,142)

"BLD",2065,4,"B",142.1,142.1)

"BLD",2065,"INIT")
POST^GMTSP35
"BLD",2065,"KRN",0)
^9.67PA^19^17
"BLD",2065,"KRN",.4,0)
.4
"BLD",2065,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",2065,"KRN",.401,0)
.401
"BLD",2065,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",2065,"KRN",.402,0)
.402
"BLD",2065,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",2065,"KRN",.403,0)
.403
"BLD",2065,"KRN",.5,0)
.5
"BLD",2065,"KRN",.5,"NM",0)
^9.68A^^0
"BLD",2065,"KRN",.84,0)
.84
"BLD",2065,"KRN",3.6,0)
3.6
"BLD",2065,"KRN",3.8,0)
3.8
"BLD",2065,"KRN",9.2,0)
9.2
"BLD",2065,"KRN",9.8,0)
9.8
"BLD",2065,"KRN",9.8,"NM",0)
^9.68A^35^35
"BLD",2065,"KRN",9.8,"NM",1,0)
GMTSVS^^0^B32240925
"BLD",2065,"KRN",9.8,"NM",2,0)
GMTSVSD^^0^B50978635
"BLD",2065,"KRN",9.8,"NM",3,0)
GMTSADHC^^0^B18027489
"BLD",2065,"KRN",9.8,"NM",4,0)
GMTSDSB^^0^B3394911
"BLD",2065,"KRN",9.8,"NM",5,0)
GMTSPN1^^0^B28895017
"BLD",2065,"KRN",9.8,"NM",6,0)
GMTSPNS1^^0^B30869514
"BLD",2065,"KRN",9.8,"NM",7,0)
GMTSPNSL^^0^B42887973
"BLD",2065,"KRN",9.8,"NM",8,0)
GMTSU^^0^B18185397
"BLD",2065,"KRN",9.8,"NM",9,0)
GMTSPN^^0^B45112042
"BLD",2065,"KRN",9.8,"NM",10,0)
GMTSVSS^^0^B40993682
"BLD",2065,"KRN",9.8,"NM",11,0)
GMTSUP^^0^B16334574
"BLD",2065,"KRN",9.8,"NM",12,0)
GMTSPLST^^0^B26965445
"BLD",2065,"KRN",9.8,"NM",13,0)
GMTS^^0^B26732244
"BLD",2065,"KRN",9.8,"NM",14,0)
GMTSADH^^0^B14047494
"BLD",2065,"KRN",9.8,"NM",15,0)
GMTSADH5^^0^B31727889
"BLD",2065,"KRN",9.8,"NM",16,0)
GMTSADOR^^0^B10979558
"BLD",2065,"KRN",9.8,"NM",17,0)
GMTSDVR^^0^B32939032
"BLD",2065,"KRN",9.8,"NM",18,0)
GMTSGAF^^0^B37974325
"BLD",2065,"KRN",9.8,"NM",19,0)
GMTSXPD1^^0^B53387037
"BLD",2065,"KRN",9.8,"NM",20,0)
GMTSXPD2^^0^B3708226
"BLD",2065,"KRN",9.8,"NM",21,0)
GMTSXPD3^^0^B50732572
"BLD",2065,"KRN",9.8,"NM",22,0)
GMTSXPD4^^0^B41481026
"BLD",2065,"KRN",9.8,"NM",23,0)
GMTSDS^^0^B42009860
"BLD",2065,"KRN",9.8,"NM",24,0)
GMTSXPS1^^0^B61714357
"BLD",2065,"KRN",9.8,"NM",25,0)
GMTSXPS2^^0^B14582720
"BLD",2065,"KRN",9.8,"NM",26,0)
GMTSXPS3^^0^B33354123
"BLD",2065,"KRN",9.8,"NM",27,0)
GMTSDGC1^^0^B10808660
"BLD",2065,"KRN",9.8,"NM",28,0)
GMTSRM^^0^B21174718
"BLD",2065,"KRN",9.8,"NM",29,0)
GMTSULT^^0^B42733150
"BLD",2065,"KRN",9.8,"NM",30,0)
GMTSULT2^^0^B36134429
"BLD",2065,"KRN",9.8,"NM",31,0)
GMTSULT5^^0^B16737846
"BLD",2065,"KRN",9.8,"NM",32,0)
GMTSPXEP^^0^B9646705
"BLD",2065,"KRN",9.8,"NM",33,0)
GMTSONE^^0^B26649444
"BLD",2065,"KRN",9.8,"NM",34,0)
GMTSDGCH^^0^B18253434
"BLD",2065,"KRN",9.8,"NM",35,0)
GMTSXPD5^^0^B4759365
"BLD",2065,"KRN",9.8,"NM","B","GMTS",13)

"BLD",2065,"KRN",9.8,"NM","B","GMTSADH",14)

"BLD",2065,"KRN",9.8,"NM","B","GMTSADH5",15)

"BLD",2065,"KRN",9.8,"NM","B","GMTSADHC",3)

"BLD",2065,"KRN",9.8,"NM","B","GMTSADOR",16)

"BLD",2065,"KRN",9.8,"NM","B","GMTSDGC1",27)

"BLD",2065,"KRN",9.8,"NM","B","GMTSDGCH",34)

"BLD",2065,"KRN",9.8,"NM","B","GMTSDS",23)

"BLD",2065,"KRN",9.8,"NM","B","GMTSDSB",4)

"BLD",2065,"KRN",9.8,"NM","B","GMTSDVR",17)

"BLD",2065,"KRN",9.8,"NM","B","GMTSGAF",18)

"BLD",2065,"KRN",9.8,"NM","B","GMTSONE",33)

"BLD",2065,"KRN",9.8,"NM","B","GMTSPLST",12)

"BLD",2065,"KRN",9.8,"NM","B","GMTSPN",9)

"BLD",2065,"KRN",9.8,"NM","B","GMTSPN1",5)

"BLD",2065,"KRN",9.8,"NM","B","GMTSPNS1",6)

"BLD",2065,"KRN",9.8,"NM","B","GMTSPNSL",7)

"BLD",2065,"KRN",9.8,"NM","B","GMTSPXEP",32)

"BLD",2065,"KRN",9.8,"NM","B","GMTSRM",28)

"BLD",2065,"KRN",9.8,"NM","B","GMTSU",8)

"BLD",2065,"KRN",9.8,"NM","B","GMTSULT",29)

"BLD",2065,"KRN",9.8,"NM","B","GMTSULT2",30)

"BLD",2065,"KRN",9.8,"NM","B","GMTSULT5",31)

"BLD",2065,"KRN",9.8,"NM","B","GMTSUP",11)

"BLD",2065,"KRN",9.8,"NM","B","GMTSVS",1)

"BLD",2065,"KRN",9.8,"NM","B","GMTSVSD",2)

"BLD",2065,"KRN",9.8,"NM","B","GMTSVSS",10)

"BLD",2065,"KRN",9.8,"NM","B","GMTSXPD1",19)

"BLD",2065,"KRN",9.8,"NM","B","GMTSXPD2",20)

"BLD",2065,"KRN",9.8,"NM","B","GMTSXPD3",21)

"BLD",2065,"KRN",9.8,"NM","B","GMTSXPD4",22)

"BLD",2065,"KRN",9.8,"NM","B","GMTSXPD5",35)

"BLD",2065,"KRN",9.8,"NM","B","GMTSXPS1",24)

"BLD",2065,"KRN",9.8,"NM","B","GMTSXPS2",25)

"BLD",2065,"KRN",9.8,"NM","B","GMTSXPS3",26)

"BLD",2065,"KRN",19,0)
19
"BLD",2065,"KRN",19,"NM",0)
^9.68A^^0
"BLD",2065,"KRN",19.1,0)
19.1
"BLD",2065,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",2065,"KRN",101,0)
101
"BLD",2065,"KRN",101,"NM",0)
^9.68A^^0
"BLD",2065,"KRN",409.61,0)
409.61
"BLD",2065,"KRN",771,0)
771
"BLD",2065,"KRN",870,0)
870
"BLD",2065,"KRN",8994,0)
8994
"BLD",2065,"KRN","B",.4,.4)

"BLD",2065,"KRN","B",.401,.401)

"BLD",2065,"KRN","B",.402,.402)

"BLD",2065,"KRN","B",.403,.403)

"BLD",2065,"KRN","B",.5,.5)

"BLD",2065,"KRN","B",.84,.84)

"BLD",2065,"KRN","B",3.6,3.6)

"BLD",2065,"KRN","B",3.8,3.8)

"BLD",2065,"KRN","B",9.2,9.2)

"BLD",2065,"KRN","B",9.8,9.8)

"BLD",2065,"KRN","B",19,19)

"BLD",2065,"KRN","B",19.1,19.1)

"BLD",2065,"KRN","B",101,101)

"BLD",2065,"KRN","B",409.61,409.61)

"BLD",2065,"KRN","B",771,771)

"BLD",2065,"KRN","B",870,870)

"BLD",2065,"KRN","B",8994,8994)

"BLD",2065,"QUES",0)
^9.62^^
"BLD",2065,"REQB",0)
^9.611^6^6
"BLD",2065,"REQB",1,0)
GMRV*4.0*7^2
"BLD",2065,"REQB",2,0)
YS*5.01*53^2
"BLD",2065,"REQB",3,0)
GMTS*2.7*31^2
"BLD",2065,"REQB",4,0)
GMTS*2.7*33^2
"BLD",2065,"REQB",5,0)
GMTS*2.7*36^2
"BLD",2065,"REQB",6,0)
GMTS*2.7*32^2
"BLD",2065,"REQB","B","GMRV*4.0*7",1)

"BLD",2065,"REQB","B","GMTS*2.7*31",3)

"BLD",2065,"REQB","B","GMTS*2.7*32",6)

"BLD",2065,"REQB","B","GMTS*2.7*33",4)

"BLD",2065,"REQB","B","GMTS*2.7*36",5)

"BLD",2065,"REQB","B","YS*5.01*53",2)

"FIA",142)
HEALTH SUMMARY TYPE
"FIA",142,0)
^GMT(142,
"FIA",142,0,0)
142
"FIA",142,0,1)
y^y^f^^^^n
"FIA",142,0,10)

"FIA",142,0,11)

"FIA",142,0,"RLRO")

"FIA",142,0,"VR")
2.7^GMTS
"FIA",142,142)
0
"FIA",142,142.01)
0
"FIA",142,142.14)
0
"FIA",142,142.2)
0
"FIA",142.1)
HEALTH SUMMARY COMPONENT
"FIA",142.1,0)
^GMT(142.1,
"FIA",142.1,0,0)
142.1I
"FIA",142.1,0,1)
y^y^f^^^^n
"FIA",142.1,0,10)

"FIA",142.1,0,11)

"FIA",142.1,0,"RLRO")

"FIA",142.1,0,"VR")
2.7^GMTS
"FIA",142.1,142.1)
0
"FIA",142.1,142.11)
0
"FIA",142.1,142.17)
0
"FIA",142.1,142.35)
0
"INIT")
POST^GMTSP35
"MBREQ")
0
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2951020^11
"PKG",126,22,1,"PAH",1,0)
35^3000509
"PKG",126,22,1,"PAH",1,1,0)
^^2^2^3000509
"PKG",126,22,1,"PAH",1,1,1,0)
The description of this patch may be found on the National Patch Module 
"PKG",126,22,1,"PAH",1,1,2,0)
under GMTS*2.7*35.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
36
"RTN","GMTS")
0^13^B26732244
"RTN","GMTS",1,0)
GMTS ; SLC/KER - Health Summary Main Routine ; 04/11/2000
"RTN","GMTS",2,0)
 ;;2.7;Health Summary;**16,24,28,30,31,35**;Oct 20, 1995
"RTN","GMTS",3,0)
 ;
"RTN","GMTS",4,0)
MAIN ; Controls branching
"RTN","GMTS",5,0)
 ; GMTSPXGO & GMRANGE are set in 2 calling options, They aren't meant
"RTN","GMTS",6,0)
 ; to be used together.
"RTN","GMTS",7,0)
 I +$G(GMTSPXGO)'>0,$L($T(PATIENT^ORU1)),($$VERSION^XPDUTL("OR")>2.19) D MAIN^GMTSDVR Q
"RTN","GMTS",8,0)
 N DIROUT,DUOUT,ZTRTN,GMTSPX1,GMTSPX2,GMNAME,GMPSAP
"RTN","GMTS",9,0)
 S GMTSTYP=0 K DIC,DIROUT,DUOUT
"RTN","GMTS",10,0)
 S DIC("B")=$P($G(^GMT(142,+$G(^DISV(+$G(DUZ),"^GMT(142,")),0)),U)
"RTN","GMTS",11,0)
 F  Q:$D(DIROUT)!$D(DUOUT)  D SELTYP Q:GMTSTYP'>0!$D(DIROUT)!$D(DUOUT)  D
"RTN","GMTS",12,0)
 . N GMPAT,DFN,GMTSMULT
"RTN","GMTS",13,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DIROUT)!$D(DUOUT)!(+$D(GMPAT)'>0)!+$G(ORVP)
"RTN","GMTS",14,0)
 . . K GMPAT,DFN
"RTN","GMTS",15,0)
 . . I +$G(ORVP) D
"RTN","GMTS",16,0)
 . . . S (DFN,GMPAT(1))=+ORVP,GMNAME=$P($G(^DPT(+DFN,0)),U) Q:GMNAME=""  S GMPATT(GMNAME,DFN)="",(GMTSPX1,GMTSPX2)=""
"RTN","GMTS",17,0)
 . . . W !!,"For patient ",GMNAME," please answer the following."
"RTN","GMTS",18,0)
 . . . I +$G(GMTSPXGO)>0 D MENU^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1)
"RTN","GMTS",19,0)
 . . . I $G(GMTSPX1)']""!($G(GMTSPX2)']"") S DIROUT=1 K GMPAT,GMPATT Q
"RTN","GMTS",20,0)
 . . . Q:$D(DIROUT)  S GMPAT(GMNAME_(9999999-GMTSPX1),+DFN)=+DFN_U_$G(GMTSPX1)_U_$G(GMTSPX2)
"RTN","GMTS",21,0)
 . . I '(+($G(ORVP))) F  Q:$D(DIROUT)  K GMPATT D SELPT Q:$D(DIROUT)!('$D(GMPATT))  S GMNAME="" F  S GMNAME=$O(GMPATT(GMNAME)) Q:GMNAME=""!$D(DIROUT)  F DFN=0:0 S DFN=$O(GMPATT(GMNAME,DFN)) Q:DFN=""  D  Q:$D(DIROUT)
"RTN","GMTS",22,0)
 . . . S (GMTSPX1,GMTSPX2)="" W !!,"For patient ",GMNAME," please answer the following."
"RTN","GMTS",23,0)
 . . . I +$G(GMTSPXGO)>0 D MENU^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1) I $G(GMTSPX1)']""!($G(GMTSPX2)']"") Q
"RTN","GMTS",24,0)
 . . . Q:$D(DIROUT)
"RTN","GMTS",25,0)
 . . . S GMPAT(GMNAME_(9999999-GMTSPX1),+DFN)=+DFN_U_$G(GMTSPX1)_U_$G(GMTSPX2)
"RTN","GMTS",26,0)
 . . Q:$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTS",27,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX1,.GMTSPX2) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTS",28,0)
 . . Q:$D(DIROUT)
"RTN","GMTS",29,0)
 . . D RESUB^GMTSDVR(.GMPAT)
"RTN","GMTS",30,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DTOUT)
"RTN","GMTS",31,0)
 . . S ZTRTN="PQ^GMTS"
"RTN","GMTS",32,0)
 . . D HSOUT^GMTSDVR,END W !
"RTN","GMTS",33,0)
 K GMTSTYP,GMTSTITL,GMTSEG,GMTSEGI,GMTSEGC,GMX,DFN,X,Y,I,GMP,GMPATT
"RTN","GMTS",34,0)
 Q
"RTN","GMTS",35,0)
SELTYP ; Select a Health Summary Type for printing
"RTN","GMTS",36,0)
 Q:GMTSTYP=-1  S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTS",37,0)
 S Y=$$TYPE^GMTSULT K DIC S GMTSTYP=+Y,GMTSTITL=$S($D(^GMT(142,+Y,"T")):^("T"),1:"") S:GMTSTITL="" GMTSTITL=$P(Y,"^",2)
"RTN","GMTS",38,0)
 I GMTSTYP>0,$S($D(^GMT(142,GMTSTYP,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"This Summary Type includes no components...Please choose another." G SELTYP
"RTN","GMTS",39,0)
SELTYP1 ; Loop through HS Type and call LOADSEG to get each component record
"RTN","GMTS",40,0)
 K GMTSEG,GMTSEGI S (GMI,S1)=0 F  S S1=$O(^GMT(142,GMTSTYP,1,S1)) Q:'S1  S GMX=^(S1,0) D LOADSEG
"RTN","GMTS",41,0)
 S GMTSEGC=GMI K S1,S2,GMI
"RTN","GMTS",42,0)
 Q
"RTN","GMTS",43,0)
LOADSEG ; Load ENABLED COMPONENTS into GMTSEG array
"RTN","GMTS",44,0)
 S GMTS0=^GMT(142.1,$P(GMX,"^",2),0)
"RTN","GMTS",45,0)
 S GMI=GMI+1,GMTSEG(GMI)=GMX,GMTSEGI($P(GMX,U,2))=GMI D SELFILE
"RTN","GMTS",46,0)
 Q
"RTN","GMTS",47,0)
SELPT ; Select a patient for printing of Health Summary
"RTN","GMTS",48,0)
 N DUOUT,GMTSPRO,GMTSVER K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP
"RTN","GMTS",49,0)
 S GMTSVER=+($$VERSION^XPDUTL("OR")),GMTSPRO=+($$PROK^GMTSU("ORU1",11))
"RTN","GMTS",50,0)
 D:+GMTSVER>2.9&(GMTSPRO) PATIENT^ORU1(.GMP,,"I  $P($G(^(""OOS"")),""^"")")
"RTN","GMTS",51,0)
 D:+GMTSVER'>2.9!('GMTSPRO) PATIENT^ORU1(.GMP)
"RTN","GMTS",52,0)
 D PATCOPY^GMTSDVR(.GMP,.GMPATT)
"RTN","GMTS",53,0)
 Q
"RTN","GMTS",54,0)
SELFILE ; Loop through SELECTION ITEM multiple and load GMTSEG( with ITEMS
"RTN","GMTS",55,0)
 N SF,SR,S2 S S2=0 F  S S2=$O(^GMT(142,GMTSTYP,1,S1,1,S2)) Q:'S2  D
"RTN","GMTS",56,0)
 . S ENTRY=^(S2,0),SR=U_$P(ENTRY,";",2) Q:SR="^"
"RTN","GMTS",57,0)
 . S SF=+$P(@(SR_"0)"),U,2) Q:+SF=0
"RTN","GMTS",58,0)
 . S GMTSEG(GMI,SF,S2)=$P(ENTRY,";"),GMTSEG(GMI,SF,0)=SR
"RTN","GMTS",59,0)
 Q
"RTN","GMTS",60,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTS",61,0)
 N DFN,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTS",62,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTS",63,0)
 N TRFAC,VAERR,VAIN
"RTN","GMTS",64,0)
 S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTS",65,0)
 . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTS",66,0)
 . I +$G(GMTSPXGO)>0 S GMTSPX1=$P($G(GMPAT(GMTJ)),U,2) D
"RTN","GMTS",67,0)
 . . S GMTSPX2=$P($G(GMPAT(GMTJ)),U,3)
"RTN","GMTS",68,0)
 . . I +GMTSPX1'>0!+GMTSPX2'>0 K GMTSPX1,GMTSPX2
"RTN","GMTS",69,0)
 . N GMDUOUT
"RTN","GMTS",70,0)
 . D EN^GMTS1
"RTN","GMTS",71,0)
 . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTS",72,0)
 . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTS",73,0)
 Q
"RTN","GMTS",74,0)
HSOUT ; Output Summary, with DEVICE handling
"RTN","GMTS",75,0)
 K ZTSK
"RTN","GMTS",76,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D EN^GMTS1 Q
"RTN","GMTS",77,0)
 K IOP S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTS",78,0)
 G:$D(IO("Q")) QUE
"RTN","GMTS",79,0)
NOQUE ; Print non-queued output to selected device
"RTN","GMTS",80,0)
 D EN^GMTS1
"RTN","GMTS",81,0)
 D ^%ZISC
"RTN","GMTS",82,0)
 Q
"RTN","GMTS",83,0)
QUE ; Call TaskMan to Queue output
"RTN","GMTS",84,0)
 K IO("Q"),ZTSAVE F %="DFN","GMTS*","ENTRY" S ZTSAVE(%)=""
"RTN","GMTS",85,0)
 S ZTRTN="EN^GMTS1",ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTS",86,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTS",87,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTS",88,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTS",89,0)
 Q
"RTN","GMTS",90,0)
END ; Clean up environmental variables and EXIT Health Summary
"RTN","GMTS",91,0)
 K %T,DIC,GMTS,GMTSLO,GMTSPNM,GMTSRB,GMTSWARD,GMTSDOB,DIC,X,Y,VA,VAIN,VAINDT,VADM,VAEL,VAPA,VAERR,GMTSSN,GMTS0,GMTS1,GMTS2
"RTN","GMTS",92,0)
 K GMTSAGE,GMTSTIM,GMTSEGN,GMTSEGH,GMTSEGL,GMTSHDR,GMTSNPG,GMTSPG,GMTSQIT,GMTSX,ENTRY,Z1,GMTSDTM,GMTSLOCK,GMTSLPG,SEX,POP,C,GMTSTOF
"RTN","GMTS",93,0)
 Q
"RTN","GMTS",94,0)
ENCWA ;Entry point printing components
"RTN","GMTS",95,0)
 ;GMTSPRM can be set to any component abbreviations except ones that 
"RTN","GMTS",96,0)
 ;require selection items. Needs to be valid component abbreviation 
"RTN","GMTS",97,0)
 ;from the "C" x-ref of File 142.1.
"RTN","GMTS",98,0)
 ;
"RTN","GMTS",99,0)
 ;call with DFN,GMTSPRM="CD,CN,CW,ADR",GMTSTITL="TITLE"
"RTN","GMTS",100,0)
 ;          GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTS",101,0)
 ;          GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTS",102,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTS",103,0)
 ;        is desired.
"RTN","GMTS",104,0)
 N GMI,GMJ,GMTSEG,GMTSEGI,GMTSEGC
"RTN","GMTS",105,0)
 S GMTS1="9999999",GMTS2="6666666",GMI=0,GMTSPNF=1
"RTN","GMTS",106,0)
 I '$D(GMTSPRM) W !,"The parameter GMTSPRM is undefined.",! Q
"RTN","GMTS",107,0)
 I '$D(GMTSTITL) W !,"The parameter GMTSTITL is undefined.",! Q
"RTN","GMTS",108,0)
 I '+$G(DFN) W !,"The parameter DFN is undefined.",! Q
"RTN","GMTS",109,0)
 F GMJ=1:1:$L(GMTSPRM,",") S ABB=$P(GMTSPRM,",",GMJ) D LOAD Q:GMJ=-1
"RTN","GMTS",110,0)
 S GMTSEGC=GMI K ABB,IFN
"RTN","GMTS",111,0)
 D EN^GMTS1
"RTN","GMTS",112,0)
 D END K GMTSEG,GMTSEGI,GMTSEGC,GMTSTITL,GMTSPRM,GMTSPNF
"RTN","GMTS",113,0)
 Q
"RTN","GMTS",114,0)
LOAD ; Load GMTSEG() using GMTSPRM abbreviations
"RTN","GMTS",115,0)
 S IFN=$O(^GMT(142.1,"C",ABB,"")) Q:IFN=""
"RTN","GMTS",116,0)
 S GMI=GMI+1,GMTSEG(GMI)=GMI_"^"_IFN,GMTSEGI(IFN)=GMI
"RTN","GMTS",117,0)
 Q
"RTN","GMTSADH")
0^14^B14047494
"RTN","GMTSADH",1,0)
GMTSADH ;SLC/JER,MAM - Ad Hoc Summary Driver ; 04/11/2000
"RTN","GMTSADH",2,0)
 ;;2.7;Health Summary;**30,35**;Oct 20, 1995
"RTN","GMTSADH",3,0)
MAIN N C,DFN,GMTSEG,GMTSEGI,GMTSEGC,GMTSQIT,GMTSTYP,GMTSTITL,GMW,X,Y
"RTN","GMTSADH",4,0)
 N DIC,DIPGM,I,POP,%,DIROUT,DUOUT,DTOUT,ZTRTN
"RTN","GMTSADH",5,0)
 N GMTSQIT,FROM,GMI,I1,ISVALID,LRDFN,PTR,SEX,TO,VAOA,VASD,VASV
"RTN","GMTSADH",6,0)
 I $L($T(PATIENT^ORU1)),($$VERSION^XPDUTL("OR")>2.19) D MAIN^GMTSADHC Q
"RTN","GMTSADH",7,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION"
"RTN","GMTSADH",8,0)
 S Y=$$TYPE^GMTSULT K DIC S GMTSTYP=+Y,GMTSTITL="AD HOC"
"RTN","GMTSADH",9,0)
 F  K GMTSEG,GMTSEGI,GMTSEGC D BUILD D  Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT) 
"RTN","GMTSADH",10,0)
 . N GMPAT,DFN,GMTSMULT
"RTN","GMTSADH",11,0)
 . F  D  Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)!(+$D(GMPAT)'>0)
"RTN","GMTSADH",12,0)
 . . Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSADH",13,0)
 . . K GMPAT,GMTSMULT
"RTN","GMTSADH",14,0)
 . . F  Q:$D(DIROUT)  K DFN W ! D SELPT^GMTS Q:+($G(DFN))'>0  S GMPAT(GMNAME,+($G(DFN)))=+($G(DFN))
"RTN","GMTSADH",15,0)
 . . Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)!(+$D(GMPAT)'>0)
"RTN","GMTSADH",16,0)
 . . D RESUB^GMTSDVR(.GMPAT)
"RTN","GMTSADH",17,0)
 . . S ZTRTN="PQ^GMTS"
"RTN","GMTSADH",18,0)
 . . N DUOUT
"RTN","GMTSADH",19,0)
 . . D HSOUT^GMTSDVR,END^GMTS W !
"RTN","GMTSADH",20,0)
 Q
"RTN","GMTSADH",21,0)
BUILD ; Conducts Dialogue to build ad hoc summary
"RTN","GMTSADH",22,0)
 N GMI,GMJ,GMW,X,XQORM,Y
"RTN","GMTSADH",23,0)
 Q:$D(GMTSQIT)!($D(DIROUT))
"RTN","GMTSADH",24,0)
 W @IOF
"RTN","GMTSADH",25,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")",XQORM("M")=6
"RTN","GMTSADH",26,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="AD",XQORM("A")="Select NEW set of COMPONENT(S): ",XQORM("??")="D HELP^GMTSADH" D ^XQORM I Y'>0 S DIROUT=1 Q
"RTN","GMTSADH",27,0)
 I +Y,(X?1"^^".E) D RJUMP^GMTSUP1 G BUILD
"RTN","GMTSADH",28,0)
 S GMTSEGC=Y
"RTN","GMTSADH",29,0)
 S (X,GMI,GMJ)=0 F  S GMI=$O(Y(GMI)) Q:'GMI  D LOAD
"RTN","GMTSADH",30,0)
 D GETLIM^GMTSADH1
"RTN","GMTSADH",31,0)
 Q
"RTN","GMTSADH",32,0)
LOAD ; Load enabled components into GMTSEG
"RTN","GMTSADH",33,0)
 N SREC,STRN
"RTN","GMTSADH",34,0)
 S STRN=+Y(GMI),SREC=^GMT(142,GMTSTYP,1,STRN,0)
"RTN","GMTSADH",35,0)
LOAD1 ; Load an individual component into GMTSEG( and GMTSEGI(
"RTN","GMTSADH",36,0)
 S GMJ=GMJ+1,GMTSEG(GMJ)=SREC,GMTSEGI($P(SREC,U,2))=GMJ D LOADSEL
"RTN","GMTSADH",37,0)
 Q
"RTN","GMTSADH",38,0)
LOADSEL ; Loads GMTSEG(J,FN,IFN), when Selection items are present
"RTN","GMTSADH",39,0)
 N S2,SJ,SEL,SR,SF S S2=0,SJ=GMJ
"RTN","GMTSADH",40,0)
 F  S S2=$O(^GMT(142,GMTSTYP,1,STRN,1,S2)) Q:'S2  D
"RTN","GMTSADH",41,0)
 . S SEL=^(S2,0),SR=U_$P(SEL,";",2) Q:SR="^"
"RTN","GMTSADH",42,0)
 . S SF=+$P(@(SR_"0)"),U,2) Q:+SF=0
"RTN","GMTSADH",43,0)
 . S GMTSEG(GMJ,SF,S2)=$P(SEL,";"),GMTSEG(GMJ,SF,0)=SR
"RTN","GMTSADH",44,0)
 Q
"RTN","GMTSADH",45,0)
HELP ; 
"RTN","GMTSADH",46,0)
 N GMJ,GMTSTXT,HLP
"RTN","GMTSADH",47,0)
 S HLP=$S(X="??":"HTX2",X="?":"HTX1",1:"") I $L(HLP) W ! F GMJ=1:1 S GMTSTXT=$T(@HLP+GMJ) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSADH",48,0)
 I X="???" W !! D HELP2^GMTSUP1
"RTN","GMTSADH",49,0)
 D REDISP
"RTN","GMTSADH",50,0)
 Q
"RTN","GMTSADH",51,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSADH",52,0)
 N I,DIR,X,Y
"RTN","GMTSADH",53,0)
 S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y
"RTN","GMTSADH",54,0)
 W @IOF
"RTN","GMTSADH",55,0)
 D DISP^XQORM1 W !
"RTN","GMTSADH",56,0)
 Q
"RTN","GMTSADH",57,0)
HTX1 ;;Help Text for "?" and "??"
"RTN","GMTSADH",58,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADH",59,0)
 ;;
"RTN","GMTSADH",60,0)
 ;;Enter: ??  to see HELP for MULTIPLE SELECTION
"RTN","GMTSADH",61,0)
 ;;       ??? to see HELP for "^^"-jump
"RTN","GMTSADH",62,0)
 ;;
"RTN","GMTSADH",63,0)
 ;;ZZZZ
"RTN","GMTSADH",64,0)
HTX2 ; HELP for ??
"RTN","GMTSADH",65,0)
 ;;
"RTN","GMTSADH",66,0)
 ;;The Health Summary components you select at this prompt create
"RTN","GMTSADH",67,0)
 ;;an ADHOC Health Summary.
"RTN","GMTSADH",68,0)
 ;;
"RTN","GMTSADH",69,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADH",70,0)
 ;;
"RTN","GMTSADH",71,0)
 ;;ALL items may be selected by typing "ALL".
"RTN","GMTSADH",72,0)
 ;;
"RTN","GMTSADH",73,0)
 ;;EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSADH",74,0)
 ;;  For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSADH",75,0)
 ;;
"RTN","GMTSADH",76,0)
 ;;NOTE: Menu items are ordered alphabetically by the Component NAME.
"RTN","GMTSADH",77,0)
 ;;      However, the displayed text is the Header Name which generally 
"RTN","GMTSADH",78,0)
 ;;      is different from the Component Name. Component may be picked
"RTN","GMTSADH",79,0)
 ;;      by their abbreviation, Header Name or Component Name.
"RTN","GMTSADH",80,0)
 ;;
"RTN","GMTSADH",81,0)
 ;;ZZZZ
"RTN","GMTSADH5")
0^15^B31727889
"RTN","GMTSADH5",1,0)
GMTSADH5 ; DCM/SLC - Health Summary Ad Hoc RPC's ; 04/11/2000
"RTN","GMTSADH5",2,0)
 ;;2.7;Health Summary;**36,35**;Oct 20, 1995
"RTN","GMTSADH5",3,0)
 ;                     
"RTN","GMTSADH5",4,0)
COMP(Y) ;Get ADHOC sub components (FILE 142.1)
"RTN","GMTSADH5",5,0)
 ;  Y(i)=(1)I;IFN^(2)Component Name [Abb]^(3)Occ Limit^
"RTN","GMTSADH5",6,0)
 ;     (4)Time Limit^(5)Header Name^(6)Hosp Loc Disp^
"RTN","GMTSADH5",7,0)
 ;     (7)ICD Text Disp^(8)Prov Narr Disp^(9)Summary Order
"RTN","GMTSADH5",8,0)
 N GMTSI,GMTSII,GMTSIFN,GMTSC,X,X1
"RTN","GMTSADH5",9,0)
 S Y(1)=$O(^GMT(142,"B","GMTS HS ADHOC OPTION",0))
"RTN","GMTSADH5",10,0)
 I 'Y(1) S Y(1)=-1 Q  ; Error, no ADHOC type defined
"RTN","GMTSADH5",11,0)
 S (GMTSC,GMTSI)=0,GMTSII=Y(1)
"RTN","GMTSADH5",12,0)
 F  S GMTSI=$O(^GMT(142,GMTSII,1,GMTSI)) Q:'GMTSI  S X=^(GMTSI,0) D
"RTN","GMTSADH5",13,0)
 . S GMTSIFN=$P(X,"^",2),X1=$G(^GMT(142.1,+GMTSIFN,0))
"RTN","GMTSADH5",14,0)
 . Q:'$L(X1)  Q:$P(X1,"^",6)="P"  S GMTSC=GMTSC+1
"RTN","GMTSADH5",15,0)
 . S Y(GMTSC)=GMTSI_";"_GMTSIFN_"^"_$P(X1,"^")_" ["_$P(X1,"^",4)_"]"_"^"_$S($P(X1,"^",5)="Y":$P(X,"^",3),1:"")
"RTN","GMTSADH5",16,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",3)="Y":$P(X,"^",4),1:"")
"RTN","GMTSADH5",17,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($L($P(X1,"^",9)):$P(X1,"^",9),1:$P(X,"^",5))_"^"_$S($P(X1,"^",10)="Y":$P(X,"^",6),1:"")
"RTN","GMTSADH5",18,0)
 . S Y(GMTSC)=Y(GMTSC)_"^"_$S($P(X1,"^",11)="Y":$P(X,"^",7),1:"")_"^"_$S($P(X1,"^",12)="Y":$P(X,"^",8),1:"")_"^"_$P(X,"^")
"RTN","GMTSADH5",19,0)
 Q
"RTN","GMTSADH5",20,0)
 ;
"RTN","GMTSADH5",21,0)
COMPSUB(Y,GMTSUB) ;Get subcomponents from a predefined ADHOC component
"RTN","GMTSADH5",22,0)
 ;GMTSUB=desired Adhoc subcomponent
"RTN","GMTSADH5",23,0)
 ;Y(i)=ifn of pointed to file entry^name
"RTN","GMTSADH5",24,0)
 Q:'$G(GMTSUB)
"RTN","GMTSADH5",25,0)
 N GMTSI,GMTSII,GMTSIFN,GMTSC,X,X1
"RTN","GMTSADH5",26,0)
 S X=$O(^GMT(142,"B","GMTS HS ADHOC OPTION",0))
"RTN","GMTSADH5",27,0)
 I 'X Q  ; Error, no ADHOC type defined
"RTN","GMTSADH5",28,0)
 S (GMTSC,GMTSI)=0,GMTSII=X
"RTN","GMTSADH5",29,0)
 F  S GMTSI=$O(^GMT(142,GMTSII,1,GMTSUB,1,GMTSI)) Q:'GMTSI  S X=^(GMTSI,0) D
"RTN","GMTSADH5",30,0)
 . S GMTSIFN=+X,X1=$P(X,";",2)
"RTN","GMTSADH5",31,0)
 . I '$D(@("^"_X1_+X_",0)")) Q
"RTN","GMTSADH5",32,0)
 . S X=@("^"_X1_+X_",0)"),GMTSC=GMTSC+1,Y(GMTSC)=GMTSIFN_"^"_$P(X,"^")
"RTN","GMTSADH5",33,0)
 Q
"RTN","GMTSADH5",34,0)
 ;                 
"RTN","GMTSADH5",35,0)
FILES(Y,GMTSCP)   ; Get Files to select from for a component
"RTN","GMTSADH5",36,0)
 Q:'$G(GMTSCP)  Q:'$D(^GMT(142.1,GMTSCP,1))  N GMTSI,GMTSC,X S (GMTSI,GMTSC)=0
"RTN","GMTSADH5",37,0)
 F  S GMTSI=$O(^GMT(142.1,GMTSCP,1,GMTSI)) Q:'GMTSI  S X=^(GMTSI,0),GMTSC=GMTSC+1,Y(GMTSC)=GMTSI_"^"_$P($G(^DIC(+X,0)),"^")_"^"_X
"RTN","GMTSADH5",38,0)
 Q
"RTN","GMTSADH5",39,0)
 ;                     
"RTN","GMTSADH5",40,0)
FILESEL(GMTSRT,GMTSFI,GMTSFM,DIR) ; Get file entries
"RTN","GMTSADH5",41,0)
 Q:'$G(GMTSFI)
"RTN","GMTSADH5",42,0)
 K ^TMP("ORDATA",$J)
"RTN","GMTSADH5",43,0)
 N GMTSI,GMTSJ,GMTSC,X,GMTSGL,GMTSGLB,GMTSCNT
"RTN","GMTSADH5",44,0)
 S GMTSI=$G(GMTSFM),GMTSCNT=44,GMTSC=0,GMTSRT=$NA(^TMP("ORDATA",$J,1))
"RTN","GMTSADH5",45,0)
 S:'$D(DIR) DIR=1
"RTN","GMTSADH5",46,0)
 I GMTSFI=60 D  Q  ; DBIA #2387
"RTN","GMTSADH5",47,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^LAB(60,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^LAB(60,"B",GMTSI,GMTSJ)) Q:'GMTSJ  D
"RTN","GMTSADH5",48,0)
 . . I $D(^LAB(60,GMTSJ,0)) S X=^(0) I $P(X,"^",4)="CH","BO"[$P(X,"^",3) S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",49,0)
 I GMTSFI=9999999.64 D  Q  ; DBIA #1989
"RTN","GMTSADH5",50,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^AUTTHF("B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^AUTTHF("B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^AUTTHF(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",51,0)
 . . I $P(X,"^",10)="C",+$P(X,"^",11)'=1 S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",52,0)
 I GMTSFI=811.9 D  Q
"RTN","GMTSADH5",53,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^PXD(811.9,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^PXD(811.9,"B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^PXD(811.9,GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",54,0)
 . . I $P(X,"^",6)'=1 S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",55,0)
 I GMTSFI=8925.1 D  Q
"RTN","GMTSADH5",56,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^TIU(8925.1,"B",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^TIU(8925.1,"B",GMTSI,GMTSJ)) Q:'GMTSJ  I $D(^TIU(8925.1,GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",57,0)
 . . I $P(X,"^",4)="DOC",$$ISA^TIULX(GMTSJ,3) S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",58,0)
 ;I GMTSFI=81 D  Q
"RTN","GMTSADH5",59,0)
 ;. F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(^ICPT("C",GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(^ICPT("C",GMTSI,GMTSJ)) Q:'GMTSJ   I $D(^ICPT(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",60,0)
 ;. . S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_$P(X,"^",2)_" ["_$P(X,"^")_"]"
"RTN","GMTSADH5",61,0)
 I $D(^DIC(GMTSFI,0,"GL")) S GMTSGL=^("GL"),GMTSGL=$S($E(GMTSGL,$L(GMTSGL))=",":$P(GMTSGL,",")_")",1:$E(GMTSGL,1,$L(GMTSGL)-1)),GMTSGLB=^("GL")_"""B"")" D
"RTN","GMTSADH5",62,0)
 . F  Q:GMTSC'<GMTSCNT  S GMTSI=$O(@GMTSGLB@(GMTSI),DIR) Q:GMTSI=""  S GMTSJ=0 F  S GMTSJ=$O(@GMTSGLB@(GMTSI,GMTSJ)) Q:'GMTSJ  I $D(@GMTSGL@(GMTSJ,0)) S X=^(0) D
"RTN","GMTSADH5",63,0)
 . . S GMTSC=GMTSC+1,^TMP("ORDATA",$J,1,GMTSC)=GMTSJ_"^"_GMTSI
"RTN","GMTSADH5",64,0)
 Q
"RTN","GMTSADH5",65,0)
 ;                     
"RTN","GMTSADH5",66,0)
REPORT(GMTSEG,GMTSEGC,GMTSEGI,GMTSCPS,DFN) ; Build Report
"RTN","GMTSADH5",67,0)
 ; Uses array of Components passed in GMTSCPS()
"RTN","GMTSADH5",68,0)
 ;   GMTSCPS(i)=array of subcomponents chosen,
"RTN","GMTSADH5",69,0)
 ;   value is pointer at ^GMT(142,DA(1),1,DA)
"RTN","GMTSADH5",70,0)
 Q:'$G(DFN)
"RTN","GMTSADH5",71,0)
 N GMTSCNT,DIC,DIZ,DIW,DIWI,DIWT,DIWTC,X,GMTSI,GMTSJ,GMTSK,GMTSTYP,GMTSTITL
"RTN","GMTSADH5",72,0)
 S X="GMTS HS ADHOC",DIC=142,DIZ(0)="ZF" D ^DIC Q:'Y
"RTN","GMTSADH5",73,0)
 S GMTSTYP=+Y,GMTSTITL="AD HOC",(GMTSJ,GMTSI)=0,GMTSEGC=$O(GMTSCPS(99999999),-1)
"RTN","GMTSADH5",74,0)
 F  S GMTSI=$O(GMTSCPS(GMTSI)) Q:'GMTSI  D
"RTN","GMTSADH5",75,0)
 . N GMTSREC,GMTSS2,GMTSSJ,GMTSEL
"RTN","GMTSADH5",76,0)
 . S GMTSREC=^GMT(142,GMTSTYP,1,+GMTSCPS(GMTSI),0),GMTSJ=GMTSJ+1
"RTN","GMTSADH5",77,0)
 . S GMTSEG(GMTSJ)=GMTSREC,GMTSEGI($P(GMTSREC,U,2))=GMTSJ,GMTSS2=0,GMTSSJ=GMTSJ
"RTN","GMTSADH5",78,0)
 . S $P(GMTSEG(GMTSJ),"^",3)=$P(GMTSCPS(GMTSI),"^",2)
"RTN","GMTSADH5",79,0)
 . S $P(GMTSEG(GMTSJ),"^",4)=$P(GMTSCPS(GMTSI),"^",3)
"RTN","GMTSADH5",80,0)
 . I $L($P(GMTSCPS(GMTSI),"^",4)) S $P(GMTSEG(GMTSJ),"^",5)=$P(GMTSCPS(GMTSI),"^",4)
"RTN","GMTSADH5",81,0)
 . I $L($P(GMTSCPS(GMTSI),"^",5)) S $P(GMTSEG(GMTSJ),"^",6)=$P(GMTSCPS(GMTSI),"^",5)
"RTN","GMTSADH5",82,0)
 . S $P(GMTSEG(GMTSJ),"^",7)=$P(GMTSCPS(GMTSI),"^",6)
"RTN","GMTSADH5",83,0)
 . I $L($P(GMTSCPS(GMTSI),"^",7)) S $P(GMTSEG(GMTSJ),"^",8)=$P(GMTSCPS(GMTSI),"^",7)
"RTN","GMTSADH5",84,0)
 . S (GMTSCNT,GMTSK)=0
"RTN","GMTSADH5",85,0)
 . F  S GMTSK=$O(GMTSCPS(GMTSK)) Q:'GMTSK  I +GMTSCPS(GMTSI)=+GMTSCPS(GMTSK),$P(GMTSCPS(GMTSK),"^",9),$P(GMTSCPS(GMTSK),"^",10) D
"RTN","GMTSADH5",86,0)
 . . S GMTSCNT=GMTSCNT+1
"RTN","GMTSADH5",87,0)
 . . S:'$D(GMTSEG(GMTSJ,$P(GMTSCPS(GMTSK),"^",9),0)) GMTSEG(GMTSJ,$P(GMTSCPS(GMTSK),"^",9),0)=$$GET1^DID($P(GMTSCPS(GMTSK),"^",9),,,"GLOBAL NAME")
"RTN","GMTSADH5",88,0)
 . . S GMTSEG(GMTSJ,$P(GMTSCPS(GMTSK),"^",9),GMTSCNT)=$P(GMTSCPS(GMTSK),"^",10)
"RTN","GMTSADH5",89,0)
 . . K GMTSCPS(GMTSK)
"RTN","GMTSADH5",90,0)
 Q
"RTN","GMTSADH5",91,0)
 ;                     
"RTN","GMTSADH5",92,0)
SUBITEM(Y,GMTSTEST) ; Get Subitems for a Test Panel
"RTN","GMTSADH5",93,0)
 Q:'$G(GMTSTEST)  N GMTSCNT S GMTSCNT=0
"RTN","GMTSADH5",94,0)
 I '$L($P(^LAB(60,GMTSTEST,0),"^",5)),$O(^LAB(60,GMTSTEST,2,0)) D COMPILE(GMTSTEST,GMTSCNT)
"RTN","GMTSADH5",95,0)
 Q
"RTN","GMTSADH5",96,0)
 ;                     
"RTN","GMTSADH5",97,0)
COMPILE(GMTSTEST,GMTSCNT) ; Expand lab panels
"RTN","GMTSADH5",98,0)
 N GMTSI,GMTSJ,GMTSRT S GMTSI=0
"RTN","GMTSADH5",99,0)
 F  S GMTSI=$O(^LAB(60,GMTSTEST,2,GMTSI)) Q:GMTSI'>0  D
"RTN","GMTSADH5",100,0)
 . S GMTSJ=+$G(^LAB(60,GMTSTEST,2,+GMTSI,0))
"RTN","GMTSADH5",101,0)
 . S GMTSRT=$G(^LAB(60,+GMTSJ,0))
"RTN","GMTSADH5",102,0)
 . I $L($P(GMTSRT,U,5)),("BO"[$P(GMTSRT,U,3)) D
"RTN","GMTSADH5",103,0)
 . . S GMTSCNT=GMTSCNT+1
"RTN","GMTSADH5",104,0)
 . . S Y(GMTSCNT)=+GMTSJ_"^"_GMTSRT
"RTN","GMTSADH5",105,0)
 . E  D COMPILE(+$G(^LAB(60,GMTSTEST,2,GMTSI,0)),GMTSCNT)
"RTN","GMTSADH5",106,0)
 Q
"RTN","GMTSADHC")
0^3^B18027489
"RTN","GMTSADHC",1,0)
GMTSADHC ; SLC/KER - Ad Hoc Summary Driver ; 04/11/2000
"RTN","GMTSADHC",2,0)
 ;;2.7;Health Summary;**6,27,28,30,31,35**;Oct 20, 1995
"RTN","GMTSADHC",3,0)
MAIN N I,XQORSPEW,%T
"RTN","GMTSADHC",4,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION"
"RTN","GMTSADHC",5,0)
 S Y=$$TYPE^GMTSULT K DIC Q:+Y'>0  S GMTSTYP=+Y,GMTSTITL="AD HOC"
"RTN","GMTSADHC",6,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!'$D(GMTSEG)
"RTN","GMTSADHC",7,0)
 . K GMTSEG,GMTSEGI,GMTSEGC
"RTN","GMTSADHC",8,0)
 . D BUILD
"RTN","GMTSADHC",9,0)
 . Q:$D(DUOUT)!$D(DIROUT)!'$D(GMTSEG)
"RTN","GMTSADHC",10,0)
 . N GMPAT,GMP
"RTN","GMTSADHC",11,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)!+$G(ORVP)
"RTN","GMTSADHC",12,0)
 . . K GMP,GMPAT
"RTN","GMTSADHC",13,0)
 . . I +$G(ORVP) S GMPAT(1)=+ORVP
"RTN","GMTSADHC",14,0)
 . . E  F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PTPC Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,$P($G(^VA(200,DUZ,100.1)),U,6)]"":1,1:0)  D
"RTN","GMTSADHC",15,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSADHC",16,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSADHC",17,0)
 . . D RESUB^GMTSDVR(.GMPAT)
"RTN","GMTSADHC",18,0)
 . . S ZTRTN="PQ^GMTSADHC"
"RTN","GMTSADHC",19,0)
 . . W !
"RTN","GMTSADHC",20,0)
 . . D HSOUT^GMTSDVR
"RTN","GMTSADHC",21,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSADHC",22,0)
 Q
"RTN","GMTSADHC",23,0)
PTPC ; Combined Patient/Patient Copy
"RTN","GMTSADHC",24,0)
 N GMTSPRO,GMTSVER S GMTSVER=+($$VERSION^XPDUTL("OR")),GMTSPRO=+($$PROK^GMTSU("ORU1",11))
"RTN","GMTSADHC",25,0)
 D:GMTSVER>2.9&(GMTSPRO) PATIENT^ORU1(.GMP,,"I  $P($G(^(""OOS"")),""^"")")
"RTN","GMTSADHC",26,0)
 D:GMTSVER'>2.9!('GMTSPRO) PATIENT^ORU1(.GMP) D PATCOPY^GMTSDVR(.GMP,.GMPAT)
"RTN","GMTSADHC",27,0)
 Q
"RTN","GMTSADHC",28,0)
PQ ; Queued subroutine to print Ad Hoc HS for each patient
"RTN","GMTSADHC",29,0)
 N GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG
"RTN","GMTSADHC",30,0)
 N GMTSPHDR,GMTSPNM,GMTSRB,GMTSSN,GMTSTOF,GMTSWARD,VADM,VAERR,VAIN,VAROOT
"RTN","GMTSADHC",31,0)
 S GMPAT=0 F  S GMPAT=$O(GMPAT(GMPAT)) Q:GMPAT'>0  D  Q:$D(GMTSQIT)!$D(DIROUT)
"RTN","GMTSADHC",32,0)
 . S DFN=+$G(GMPAT(GMPAT)) D EN^GMTS1
"RTN","GMTSADHC",33,0)
 Q
"RTN","GMTSADHC",34,0)
BUILD ; Conducts Dialogue to build ad hoc summary
"RTN","GMTSADHC",35,0)
 N GMI,GMJ,X,XQORM,Y
"RTN","GMTSADHC",36,0)
 Q:$D(GMTSQIT)!($D(DIROUT))
"RTN","GMTSADHC",37,0)
 W @IOF
"RTN","GMTSADHC",38,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")",XQORM("M")=6
"RTN","GMTSADHC",39,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="AD",XQORM("A")="Select NEW set of COMPONENT(S): ",XQORM("??")="D HELP^GMTSADH" D EN^XQORM I Y'>0 S GMTSQIT="" Q
"RTN","GMTSADHC",40,0)
 I +Y,(X?1"^^".E) D RJUMP^GMTSUP1 G BUILD
"RTN","GMTSADHC",41,0)
 S GMTSEGC=Y
"RTN","GMTSADHC",42,0)
 S (X,GMI,GMJ)=0 F  S GMI=$O(Y(GMI)) Q:'GMI  D LOAD
"RTN","GMTSADHC",43,0)
 D GETLIM^GMTSADH1
"RTN","GMTSADHC",44,0)
 Q
"RTN","GMTSADHC",45,0)
LOAD ; Load enabled components into GMTSEG
"RTN","GMTSADHC",46,0)
 N SREC,STRN
"RTN","GMTSADHC",47,0)
 S STRN=+Y(GMI),SREC=^GMT(142,GMTSTYP,1,STRN,0)
"RTN","GMTSADHC",48,0)
LOAD1 S GMJ=GMJ+1,GMTSEG(GMJ)=SREC,GMTSEGI($P(SREC,U,2))=GMJ D LOADSEL
"RTN","GMTSADHC",49,0)
 Q
"RTN","GMTSADHC",50,0)
LOADSEL ; Loads GMTSEG(J,FN,IFN), when Selection items are present
"RTN","GMTSADHC",51,0)
 N SR,SF,S2,SEL S S2=0 F  S S2=$O(^GMT(142,GMTSTYP,1,STRN,1,S2)) Q:'S2  D
"RTN","GMTSADHC",52,0)
 . S SEL=^(S2,0),SR=U_$P(SEL,";",2) Q:SR="^"
"RTN","GMTSADHC",53,0)
 . S SF=+$P(@(SR_"0)"),U,2) Q:+SF=0
"RTN","GMTSADHC",54,0)
 . S GMTSEG(GMJ,SF,S2)=$P(SEL,";"),GMTSEG(GMI,SF,0)=SR
"RTN","GMTSADHC",55,0)
 Q
"RTN","GMTSADHC",56,0)
HELP ; 
"RTN","GMTSADHC",57,0)
 N GMJ,GMTSTXT,HLP
"RTN","GMTSADHC",58,0)
 S HLP=$S(X="??":"HTX2",X="?":"HTX1",1:"") I $L(HLP) W ! F GMJ=1:1 S GMTSTXT=$T(@HLP+GMJ) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSADHC",59,0)
 I X="???" W !! D HELP2^GMTSUP1
"RTN","GMTSADHC",60,0)
 D REDISP
"RTN","GMTSADHC",61,0)
 Q
"RTN","GMTSADHC",62,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSADHC",63,0)
 N I,DIR,X,Y
"RTN","GMTSADHC",64,0)
 S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y
"RTN","GMTSADHC",65,0)
 W @IOF
"RTN","GMTSADHC",66,0)
 D DISP^XQORM1 W !
"RTN","GMTSADHC",67,0)
 Q
"RTN","GMTSADHC",68,0)
HTX1 ;;Help Text for "?" and "??"
"RTN","GMTSADHC",69,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADHC",70,0)
 ;;
"RTN","GMTSADHC",71,0)
 ;;Enter: ??  to see HELP for MULTIPLE SELECTION
"RTN","GMTSADHC",72,0)
 ;;       ??? to see HELP for "^^"-jump
"RTN","GMTSADHC",73,0)
 ;;
"RTN","GMTSADHC",74,0)
 ;;ZZZZ
"RTN","GMTSADHC",75,0)
HTX2 ; HELP for ??
"RTN","GMTSADHC",76,0)
 ;;
"RTN","GMTSADHC",77,0)
 ;;The Health Summary components you select at this prompt create
"RTN","GMTSADHC",78,0)
 ;;an ADHOC Health Summary.
"RTN","GMTSADHC",79,0)
 ;;
"RTN","GMTSADHC",80,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADHC",81,0)
 ;;
"RTN","GMTSADHC",82,0)
 ;;ALL items may be selected by typing "ALL".
"RTN","GMTSADHC",83,0)
 ;;
"RTN","GMTSADHC",84,0)
 ;;EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSADHC",85,0)
 ;;  For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSADHC",86,0)
 ;;
"RTN","GMTSADHC",87,0)
 ;;NOTE: Menu items are ordered alphabetically by the Component NAME.
"RTN","GMTSADHC",88,0)
 ;;      However, the displayed text is the Header Name which generally 
"RTN","GMTSADHC",89,0)
 ;;      is different from the Component Name. Component may be picked
"RTN","GMTSADHC",90,0)
 ;;      by their abbreviation, Header Name or Component Name.
"RTN","GMTSADHC",91,0)
 ;;
"RTN","GMTSADHC",92,0)
 ;;ZZZZ
"RTN","GMTSADOR")
0^16^B10979558
"RTN","GMTSADOR",1,0)
GMTSADOR ;SLC/KER - Ad Hoc Summary Driver ; 04/11/2000
"RTN","GMTSADOR",2,0)
 ;;2.7;Health Summary;**30,35**;Oct 20, 1995
"RTN","GMTSADOR",3,0)
 ;
"RTN","GMTSADOR",4,0)
MAIN ;External call to allow user to define components and defaults through
"RTN","GMTSADOR",5,0)
 ;the AD Hoc menu interface and print health summaries for a programmer-
"RTN","GMTSADOR",6,0)
 ;specified patient and device. Called with:
"RTN","GMTSADOR",7,0)
 ;  DFN=Patient internal file record number (optional)
"RTN","GMTSADOR",8,0)
 ;      For OE/RR interface sets DFN to Patient DFN in the ORVP variable.
"RTN","GMTSADOR",9,0)
 ;      If not defined a patient will be prompted for.
"RTN","GMTSADOR",10,0)
 ;
"RTN","GMTSADOR",11,0)
 N C,GMTSEG,GMTSEGI,GMTSEGC,GMTSQIT,GMTSTYP,GMTSTITL,GMW,X,Y
"RTN","GMTSADOR",12,0)
 N DIC,DIPGM,I,POP,%,GMTSMULT
"RTN","GMTSADOR",13,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION" S Y=$$TYPE^GMTSULT K DIC Q:+Y'>0  S GMTSTYP=+Y,GMTSTITL="AD HOC"
"RTN","GMTSADOR",14,0)
 I $G(DFN)'>0 S DFN=$S($D(ORVP):$P(ORVP,";"),1:"") D:+DFN'>0 SELPT^GMTS
"RTN","GMTSADOR",15,0)
 Q:+($G(DFN))'>0
"RTN","GMTSADOR",16,0)
 F  K GMTSEG,GMTSEGI,GMTSEGC D BUILD Q:$D(GMTSQIT)!($D(DIROUT))  D HSOUT^GMTS,END^GMTS S:$D(DTOUT) GMTSQIT="" Q:$D(GMTSQIT)!($D(DIROUT))
"RTN","GMTSADOR",17,0)
 D END
"RTN","GMTSADOR",18,0)
 Q
"RTN","GMTSADOR",19,0)
BUILD ; Conducts Dialogue to build ad hoc summary
"RTN","GMTSADOR",20,0)
 N GMI,GMJ,GMW,X,XQORM,Y
"RTN","GMTSADOR",21,0)
 Q:$D(GMTSQIT)!($D(DIROUT))
"RTN","GMTSADOR",22,0)
 W @IOF
"RTN","GMTSADOR",23,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""Y"")"
"RTN","GMTSADOR",24,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="DA",XQORM("A")="Select COMPONENT(S): ",XQORM("??")="D HELP^GMTSADH" D ^XQORM I Y'>0 S GMTSQIT="" Q
"RTN","GMTSADOR",25,0)
 I +Y,(X?1"^^".E) D RJUMP^GMTSUP1 G BUILD
"RTN","GMTSADOR",26,0)
 S GMTSEGC=Y
"RTN","GMTSADOR",27,0)
 S (X,GMI,GMJ)=0 F  S GMI=$O(Y(GMI)) Q:'GMI  D LOAD
"RTN","GMTSADOR",28,0)
 D GETLIM^GMTSADH1
"RTN","GMTSADOR",29,0)
 Q
"RTN","GMTSADOR",30,0)
LOAD ; Load enabled components into GMTSEG
"RTN","GMTSADOR",31,0)
 N SREC,STRN
"RTN","GMTSADOR",32,0)
 S STRN=+Y(GMI),SREC=^GMT(142,GMTSTYP,1,STRN,0)
"RTN","GMTSADOR",33,0)
LOAD1 S GMJ=GMJ+1,GMTSEG(GMJ)=SREC,GMTSEGI($P(SREC,U,2))=GMJ D LOADSEL
"RTN","GMTSADOR",34,0)
 Q
"RTN","GMTSADOR",35,0)
LOADSEL ; Loads GMTSEG(J,FN,IFN), when Selection items are present
"RTN","GMTSADOR",36,0)
 N S2,SEL,SR,SF S S2=0 F  S S2=$O(^GMT(142,GMTSTYP,1,STRN,1,S2)) Q:'S2  D
"RTN","GMTSADOR",37,0)
 . S SEL=^(S2,0),SR=U_$P(SEL,";",2) Q:SR="^"
"RTN","GMTSADOR",38,0)
 . S SF=+$P(@(SR_"0)"),U,2) Q:+SF=0
"RTN","GMTSADOR",39,0)
 . S GMTSEG(GMJ,SF,S2)=$P(SEL,";"),GMTSEG(GMJ,SF,0)=SR
"RTN","GMTSADOR",40,0)
 Q
"RTN","GMTSADOR",41,0)
END ; Cleans up any residual locals
"RTN","GMTSADOR",42,0)
 K GMTSQIT,FROM,GMI,I1,ISVALID,LRDFN,PTR,SEX,TO,VAOA,VASD,VASV,X
"RTN","GMTSADOR",43,0)
 Q
"RTN","GMTSADOR",44,0)
HELP ; 
"RTN","GMTSADOR",45,0)
 N GMJ,GMTSTXT,HLP
"RTN","GMTSADOR",46,0)
 S HLP=$S(X="??":"HTX2",X="?":"HTX1",1:"") I $L(HLP) W ! F GMJ=1:1 S GMTSTXT=$T(@HLP+GMJ) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSADOR",47,0)
 I X="???" W !! D HELP2^GMTSUP1
"RTN","GMTSADOR",48,0)
 D REDISP
"RTN","GMTSADOR",49,0)
 Q
"RTN","GMTSADOR",50,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSADOR",51,0)
 N I,DIR,X,Y
"RTN","GMTSADOR",52,0)
 S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y
"RTN","GMTSADOR",53,0)
 W @IOF
"RTN","GMTSADOR",54,0)
 D DISP^XQORM1 W !
"RTN","GMTSADOR",55,0)
 Q
"RTN","GMTSADOR",56,0)
HTX1 ;;Help Text for "?"
"RTN","GMTSADOR",57,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADOR",58,0)
 ;;
"RTN","GMTSADOR",59,0)
 ;;Enter: ??  to see HELP for MULTIPLE SELECTION
"RTN","GMTSADOR",60,0)
 ;;       ??? to see HELP for "^^"-jump
"RTN","GMTSADOR",61,0)
 ;;
"RTN","GMTSADOR",62,0)
 ;;ZZZZ
"RTN","GMTSADOR",63,0)
HTX2 ; HELP for ??
"RTN","GMTSADOR",64,0)
 ;;
"RTN","GMTSADOR",65,0)
 ;;The Health Summary components you select at this prompt create
"RTN","GMTSADOR",66,0)
 ;;an ADHOC Health Summary.
"RTN","GMTSADOR",67,0)
 ;;
"RTN","GMTSADOR",68,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADOR",69,0)
 ;;
"RTN","GMTSADOR",70,0)
 ;;ALL items may be selected by typing "ALL".
"RTN","GMTSADOR",71,0)
 ;;
"RTN","GMTSADOR",72,0)
 ;;EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSADOR",73,0)
 ;;  For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSADOR",74,0)
 ;;
"RTN","GMTSADOR",75,0)
 ;;ZZZZ
"RTN","GMTSDGC1")
0^27^B10808660
"RTN","GMTSDGC1",1,0)
GMTSDGC1 ; SLC/KER/SBW - Subroutines for Ext ADT Hist    ; 04/11/2000
"RTN","GMTSDGC1",2,0)
 ;;2.7;Health Summary;**5,35**;Oct 20, 1995
"RTN","GMTSDGC1",3,0)
 ;
"RTN","GMTSDGC1",4,0)
OTHER(DFN,PTF,CODE,GMVAIP,MDA) ; Additional data to include
"RTN","GMTSDGC1",5,0)
 N LOS,ICD,DGPMIFN,GMI,GMX,NODIAG,GMTO,GMTNO,BD,BDSC
"RTN","GMTSDGC1",6,0)
 N DP,DSPL,OP,OPTR
"RTN","GMTSDGC1",7,0)
 I CODE=1 D  Q  ;Other data for Admission entries
"RTN","GMTSDGC1",8,0)
 . Q:$G(GMVAIP("DN",1))'=""
"RTN","GMTSDGC1",9,0)
 . D GETDATA
"RTN","GMTSDGC1",10,0)
 . I $G(GMVAIP("MF"))]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?10,"Adm. Diag.: ",GMVAIP("MF")
"RTN","GMTSDGC1",11,0)
 . W ?64,"LOS: ",LOS,!
"RTN","GMTSDGC1",12,0)
 . Q:'$D(ICD)
"RTN","GMTSDGC1",13,0)
 . S GMI=0
"RTN","GMTSDGC1",14,0)
 . F  S GMI=$O(ICD(GMI)) Q:'GMI  D CKP^GMTSUP Q:$D(GMTSQIT)  S GMX="" F  S GMX=$O(ICD(GMI,80,GMX)) Q:'GMX  D NXTICD
"RTN","GMTSDGC1",15,0)
 I CODE=2 D  Q  ;Other data for Transfer entries
"RTN","GMTSDGC1",16,0)
 . N TRFAC
"RTN","GMTSDGC1",17,0)
 . S TRFAC=$P(^DGPM(MDA,0),U,5)
"RTN","GMTSDGC1",18,0)
 . I $P($G(GMVAIP("WL")),U,2)]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,$S($P(VAIP("MT"),U,2)'["TO":"To ",1:""),$P(VAIP("WL"),U,2),$S($L(TRFAC):"  at "_TRFAC,1:""),!
"RTN","GMTSDGC1",19,0)
 I CODE=3 D  Q  ;Other data for Discharge entries
"RTN","GMTSDGC1",20,0)
 . ; Discharge data
"RTN","GMTSDGC1",21,0)
 . D GETDATA
"RTN","GMTSDGC1",22,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?10,"Bedsection: ",BDSC,?64,"LOS: ",LOS,!
"RTN","GMTSDGC1",23,0)
 . S NODIAG=1,GMI=0
"RTN","GMTSDGC1",24,0)
 . F  S GMI=$O(ICD(GMI)) Q:GMI'>0  S GMX=0 F  S GMX=$O(ICD(GMI,80,GMX)) Q:GMX'>0  D NXTICD
"RTN","GMTSDGC1",25,0)
 . I NODIAG D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSDGC1",26,0)
 . . W ?5,"Principal Diag.: No discharge diagnosis available.",!
"RTN","GMTSDGC1",27,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "   Disposition Place: ",DSPL,!
"RTN","GMTSDGC1",28,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "   Outpat. Treatment: ",OPTR,!
"RTN","GMTSDGC1",29,0)
 . I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGC1",30,0)
 I CODE=6 D  Q  ;Other data for Treating Specialty entries
"RTN","GMTSDGC1",31,0)
 . N DIWL,DIWF,DIWR,GMJ,GMJ1
"RTN","GMTSDGC1",32,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSDGC1",33,0)
 . S DIWL=22,DIWR=78,DIWF="C56"
"RTN","GMTSDGC1",34,0)
 . I $D(^DGPM(MDA,"DX")) D
"RTN","GMTSDGC1",35,0)
 . . F GMJ=1:1:$P(^DGPM(MDA,"DX",0),"^",4) S X=^DGPM(MDA,"DX",GMJ,0) D ^DIWP
"RTN","GMTSDGC1",36,0)
 . I $D(^UTILITY($J,"W")) D
"RTN","GMTSDGC1",37,0)
 . . S GMJ=$O(^UTILITY($J,"W",0)) Q:'GMJ
"RTN","GMTSDGC1",38,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"TS Diag.: "
"RTN","GMTSDGC1",39,0)
 . . S GMJ1=0
"RTN","GMTSDGC1",40,0)
 . . F  S GMJ1=$O(^UTILITY($J,"W",GMJ,GMJ1)) Q:'GMJ1  D CKP^GMTSUP Q:$D(GMTSQIT)  W ?22,^UTILITY($J,"W",GMJ,GMJ1,0),!
"RTN","GMTSDGC1",41,0)
 . K ^UTILITY($J,"W")
"RTN","GMTSDGC1",42,0)
 Q
"RTN","GMTSDGC1",43,0)
GETDATA ; Gets LOS, ICD and bedsection data
"RTN","GMTSDGC1",44,0)
 N DIC,DR,DA,DIQ,GMTSI,X,PTFA
"RTN","GMTSDGC1",45,0)
 S DGPMIFN=$G(GMVAIP("AN"))
"RTN","GMTSDGC1",46,0)
 I DGPMIFN D ^DGPMLOS S LOS=+X
"RTN","GMTSDGC1",47,0)
 I '$D(^DGPT(PTF,70)) D  Q
"RTN","GMTSDGC1",48,0)
 . S (BDSC,DSPL,OPTR)="UNKNOWN"
"RTN","GMTSDGC1",49,0)
 S DIC=45,DA=+PTF,DR="71;73;75;",DIQ="PTFA(" D EN^DIQ1
"RTN","GMTSDGC1",50,0)
 S BDSC=$S(PTFA(45,+DA,71)]"":PTFA(45,+DA,71),1:"UNKNOWN")
"RTN","GMTSDGC1",51,0)
 S OPTR=$S(PTFA(45,+DA,73)]"":PTFA(45,+DA,73),1:"UNKNOWN")
"RTN","GMTSDGC1",52,0)
 S DSPL=$S(PTFA(45,+DA,75)]"":PTFA(45,+DA,75),1:"UNKNOWN")
"RTN","GMTSDGC1",53,0)
 Q:'$D(^ICD9)
"RTN","GMTSDGC1",54,0)
 S ICD=^DGPT(PTF,70),DIC=80,DR=".01;3"
"RTN","GMTSDGC1",55,0)
 I $P(ICD,U,11)'="" S DA=$P(ICD,U,11),DIQ="ICD(1," D EN^DIQ1
"RTN","GMTSDGC1",56,0)
 I $P(ICD,U,10)'="" S DA=$P(ICD,U,10),DIQ="ICD(2," D EN^DIQ1
"RTN","GMTSDGC1",57,0)
 F GMTSI=16:1:24 I $P(ICD,U,GMTSI)'="" S DA=$P(ICD,U,GMTSI),DIQ="ICD((GMTSI-13)," D EN^DIQ1
"RTN","GMTSDGC1",58,0)
 Q
"RTN","GMTSDGC1",59,0)
NXTICD ; Print the next ICD
"RTN","GMTSDGC1",60,0)
 S (GMTO,GMTNO)="" S GMTO=$G(ICD(GMI,80,GMX,3)),GMTNO=$G(ICD(GMI,80,GMX,.01))
"RTN","GMTSDGC1",61,0)
 W:GMI=1 ?5,"Principal Diag.: "
"RTN","GMTSDGC1",62,0)
 W:GMI=2 ?16,"DXLS: "
"RTN","GMTSDGC1",63,0)
 W:GMI=3 ?14,"ICD DX: "
"RTN","GMTSDGC1",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?22,GMTO,?62,GMTNO,!
"RTN","GMTSDGC1",65,0)
 S NODIAG=0
"RTN","GMTSDGC1",66,0)
 Q
"RTN","GMTSDGCH")
0^34^B18253434
"RTN","GMTSDGCH",1,0)
GMTSDGCH ; SLC/KER/NDBI - Extended ADT Hist ; 04/11/2000
"RTN","GMTSDGCH",2,0)
 ;;2.7;Health Summary;**28,35,NDBI**;Oct 20, 1995
"RTN","GMTSDGCH",3,0)
 ;
"RTN","GMTSDGCH",4,0)
MAIN ; Loop through admissions starting from most recent
"RTN","GMTSDGCH",5,0)
 N FLAG,IN,IM,ADA,ADM,MDA,MDM,X,DOC,CNTR,CODE,TYPE,TT,SPEC
"RTN","GMTSDGCH",6,0)
 N ITS,TS,TSDM,TSDA,VAHOW,VA200,GMC,GMMDA
"RTN","GMTSDGCH",7,0)
 K VAIP
"RTN","GMTSDGCH",8,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSDGCH",9,0)
 E  S CNTR=100
"RTN","GMTSDGCH",10,0)
 S VA200=1,VAHOW=1,FLAG=-1,ADM=GMTS1,GMC=0
"RTN","GMTSDGCH",11,0)
 D DISAB,FADM
"RTN","GMTSDGCH",12,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) LST^A7RHSM(DFN,.A7RHS) ; NDBI
"RTN","GMTSDGCH",13,0)
 F  S ADM=$O(^DGPM("ATID1",DFN,ADM)) D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) DSP^A7RHSM(ADM) Q:('ADM)!(ADM>GMTS2)!(CNTR=0)!('DFN)  S GMC=0 D MVTS I GMC>0 D ICDP^GMTSDGC2(DFN,PTF),ICDS^GMTSDGC2(DFN,PTF) ; NDBI
"RTN","GMTSDGCH",14,0)
 D KVAR^VADPT
"RTN","GMTSDGCH",15,0)
 K ^UTILITY($J)
"RTN","GMTSDGCH",16,0)
 KILL A7RHS ; NDBI
"RTN","GMTSDGCH",17,0)
 Q
"RTN","GMTSDGCH",18,0)
MVTS ; Loop through mvts chronologically, per admission
"RTN","GMTSDGCH",19,0)
 S ADA=0,ADA=$O(^DGPM("ATID1",DFN,ADM,ADA)) Q:'ADA
"RTN","GMTSDGCH",20,0)
 N VAIP,PREVDR,PREVSP
"RTN","GMTSDGCH",21,0)
 K ^UTILITY($J)
"RTN","GMTSDGCH",22,0)
 S (VAIP("E"),GMMDA)=ADA D IN5^VADPT
"RTN","GMTSDGCH",23,0)
 I $D(VAIP) D CKP^GMTSUP Q:$D(GMTSQIT)  W:FLAG>0 ! D PRNT
"RTN","GMTSDGCH",24,0)
 D SETUTL
"RTN","GMTSDGCH",25,0)
 S MDM=""
"RTN","GMTSDGCH",26,0)
 F  S MDM=$O(^UTILITY($J,"GMTSMVTS",MDM)) Q:'MDM  D GET
"RTN","GMTSDGCH",27,0)
 S CNTR=CNTR-1
"RTN","GMTSDGCH",28,0)
 K ^UTILITY($J)
"RTN","GMTSDGCH",29,0)
 Q
"RTN","GMTSDGCH",30,0)
GET ; D IN5^VADPT for each mvt, print info
"RTN","GMTSDGCH",31,0)
 I ^UTILITY($J,"GMTSMVTS",MDM)=ADA Q
"RTN","GMTSDGCH",32,0)
 K VAIP
"RTN","GMTSDGCH",33,0)
 S (VAIP("E"),GMMDA)=^UTILITY($J,"GMTSMVTS",MDM) D IN5^VADPT
"RTN","GMTSDGCH",34,0)
 I $D(VAIP) D PRNT
"RTN","GMTSDGCH",35,0)
 Q
"RTN","GMTSDGCH",36,0)
PRNT ; output line of data
"RTN","GMTSDGCH",37,0)
 S X=+$P(VAIP("MD"),U) D REGDT4^GMTSU
"RTN","GMTSDGCH",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGCH",39,0)
 S DOC=$E($P($G(VAIP("DR")),U,2),1,10),TYPE=$P($G(VAIP("MT")),U,2)
"RTN","GMTSDGCH",40,0)
 S CODE=+$P($G(VAIP("TT")),U),SPEC=$P(VAIP(("TS")),U,2)
"RTN","GMTSDGCH",41,0)
 S PTF=+$G(VAIP("PT"))
"RTN","GMTSDGCH",42,0)
 S TT=$S(CODE=0:"NON",CODE=1:"ADM",CODE=2:"TR ",CODE=3:"DC ",CODE=4:"CIL",CODE=5:"COL",CODE=6:"TS ",1:"   ")
"RTN","GMTSDGCH",43,0)
 I 'GMTSNPG,$D(PREVDR),PREVDR=$P(VAIP("DR"),U) S DOC="  "" "
"RTN","GMTSDGCH",44,0)
 I 'GMTSNPG,$D(PREVSP),PREVSP=$P(VAIP("TS"),U) S SPEC="    "" "
"RTN","GMTSDGCH",45,0)
 S GMC=1
"RTN","GMTSDGCH",46,0)
 W X,?12,TT,"  ",$E(TYPE,1,35),?56,$E(SPEC,1,11),?69,DOC,!
"RTN","GMTSDGCH",47,0)
 D OTHER^GMTSDGC1(DFN,PTF,CODE,.VAIP,$G(GMMDA))
"RTN","GMTSDGCH",48,0)
 S FLAG=2,PREVDR=$P(VAIP("DR"),U),PREVSP=$P(VAIP("TS"),U)
"RTN","GMTSDGCH",49,0)
 Q
"RTN","GMTSDGCH",50,0)
SETUTL ;
"RTN","GMTSDGCH",51,0)
 S (TSDM,MDM)=0
"RTN","GMTSDGCH",52,0)
 F  S TSDM=$O(^DGPM("ATS",DFN,ADA,TSDM)) Q:'TSDM  D NEXT1
"RTN","GMTSDGCH",53,0)
 F  S MDM=$O(^DGPM("APCA",DFN,ADA,MDM)) Q:'MDM  D NEXT2
"RTN","GMTSDGCH",54,0)
 Q
"RTN","GMTSDGCH",55,0)
NEXT1 ;
"RTN","GMTSDGCH",56,0)
 S TS="",TS=$O(^DGPM("ATS",DFN,ADA,TSDM,TS)) Q:'TS
"RTN","GMTSDGCH",57,0)
 S TSDA=0,TSDA=$O(^DGPM("ATS",DFN,ADA,TSDM,TS,TSDA)) Q:'TSDA
"RTN","GMTSDGCH",58,0)
 S ^UTILITY($J,"GMTSMVTS",9999999-TSDM)=TSDA
"RTN","GMTSDGCH",59,0)
 Q
"RTN","GMTSDGCH",60,0)
NEXT2 ;
"RTN","GMTSDGCH",61,0)
 S MDA=0,MDA=$O(^DGPM("APCA",DFN,ADA,MDM,MDA)) Q:'MDA
"RTN","GMTSDGCH",62,0)
 I MDA'=ADA S ^UTILITY($J,"GMTSMVTS",MDM)=MDA
"RTN","GMTSDGCH",63,0)
 Q
"RTN","GMTSDGCH",64,0)
DISAB ; Initializes Variables and Controls Looping for disability display
"RTN","GMTSDGCH",65,0)
 N GMW,GMTSI,VA,VADM,VAEL,VAERR,VAPA
"RTN","GMTSDGCH",66,0)
 D ELIG^VADPT I +$G(VAEL("EL")) D
"RTN","GMTSDGCH",67,0)
 . S FLAG=2
"RTN","GMTSDGCH",68,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Eligibility: ",$E($P(VAEL("EL"),U,2),1,40)
"RTN","GMTSDGCH",69,0)
 . W:VAEL("ES")]"" ?55,$P(VAEL("ES"),U,2)
"RTN","GMTSDGCH",70,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W:+VAEL("SC") !,"Total S/C %: ",$P(VAEL("SC"),U,2)
"RTN","GMTSDGCH",71,0)
 . I '$D(^DPT(DFN,.372)) D  Q
"RTN","GMTSDGCH",72,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"   No rated disabilities"
"RTN","GMTSDGCH",73,0)
 . S GMTSI=0
"RTN","GMTSDGCH",74,0)
 . F  S GMTSI=$O(^DPT(DFN,.372,GMTSI)) Q:GMTSI'>0  D
"RTN","GMTSDGCH",75,0)
 . . ; Resolves pointers and prints disability record
"RTN","GMTSDGCH",76,0)
 . . N DA,DIQ,DR,DIC,GMTSDIS
"RTN","GMTSDGCH",77,0)
 . . S DIC="^DPT("_DFN_",.372,",DA=GMTSI,DR=".01;2;3",DIQ="GMTSDIS",DIQ(0)="E"
"RTN","GMTSDGCH",78,0)
 . . D EN^DIQ1
"RTN","GMTSDGCH",79,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?3,GMTSDIS(2.04,DA,.01,"E"),?51,$J(GMTSDIS(2.04,DA,2,"E"),3),"%",?60,$S(GMTSDIS(2.04,DA,3,"E")="YES":"S/C",1:"NSC")
"RTN","GMTSDGCH",80,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGCH",81,0)
 Q
"RTN","GMTSDGCH",82,0)
FADM ; Retrieve future scheduled admissions and display this data
"RTN","GMTSDGCH",83,0)
 N GMDT,NODE,X
"RTN","GMTSDGCH",84,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGCH",85,0)
 D GETFADM^GMTSDGA2
"RTN","GMTSDGCH",86,0)
 Q:'$D(^TMP("GMFADM",$J))
"RTN","GMTSDGCH",87,0)
 S GMDT=0
"RTN","GMTSDGCH",88,0)
 F  S GMDT=$O(^TMP("GMFADM",$J,GMDT)) Q:GMDT'>0  D
"RTN","GMTSDGCH",89,0)
 . S NODE=$G(^TMP("GMFADM",$J,GMDT))
"RTN","GMTSDGCH",90,0)
 . S X=$P(NODE,U) D REGDT4^GMTSU
"RTN","GMTSDGCH",91,0)
 . I FLAG>0 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDGCH",92,0)
 . E  S FLAG=2
"RTN","GMTSDGCH",93,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W X,?16,"Scheduled Admission",?55,$E($P(NODE,U,5),1,12),?69,$E($P(NODE,U,3),1,10),!
"RTN","GMTSDGCH",94,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGCH",95,0)
 . I $P(NODE,U,2)]"" W ?10,"Adm. Diag.: ",$P(NODE,U,2)
"RTN","GMTSDGCH",96,0)
 . I $P(NODE,U,6)>0 W ?55,"Expected LOS: ",$P(NODE,U,6),!
"RTN","GMTSDGCH",97,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSDGCH",98,0)
 . I $P(NODE,U,4)]"" W ?13,"Surgery: ",$P(NODE,U,4),!
"RTN","GMTSDGCH",99,0)
 K ^TMP("GMFADM",$J)
"RTN","GMTSDGCH",100,0)
 Q
"RTN","GMTSDS")
0^23^B42009860
"RTN","GMTSDS",1,0)
GMTSDS ; SLC/KER - Discharge Summary              ; 04/11/2000
"RTN","GMTSDS",2,0)
 ;;2.7;Health Summary;**12,28,35**;Feb 28, 1996
"RTN","GMTSDS",3,0)
 ;
"RTN","GMTSDS",4,0)
MAIN ; Control branching
"RTN","GMTSDS",5,0)
 N GMTSI,GMTSJ,GMTSCNT,GMTSREC,GMTSXTRA,SIGNEDBY,COSGEDBY,CONEED,COSAME
"RTN","GMTSDS",6,0)
 K ^TMP("TIU",$J)
"RTN","GMTSDS",7,0)
 D MAIN^TIULAPIC(DFN,244,GMTS1,GMTS2,GMTSNDM,1)
"RTN","GMTSDS",8,0)
 I '$D(^TMP("TIU",$J)) Q
"RTN","GMTSDS",9,0)
 S GMTSI=0 F  S GMTSI=$O(^TMP("TIU",$J,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSDS",10,0)
 . S GMTSJ=0 F  S GMTSJ=$O(^TMP("TIU",$J,GMTSI,GMTSJ)) Q:+GMTSJ'>0  D
"RTN","GMTSDS",11,0)
 . . D WRTREC(GMTSI,GMTSJ)
"RTN","GMTSDS",12,0)
 . . D WRTTEXT(GMTSI,GMTSJ)
"RTN","GMTSDS",13,0)
 . . D WRTSIG(GMTSI,GMTSJ)
"RTN","GMTSDS",14,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,1601,"I")) D AMENDMNT^GMTSPN1(GMTSI,GMTSJ)
"RTN","GMTSDS",15,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD")) D ADDEND^GMTSPN1(GMTSI,GMTSJ)
"RTN","GMTSDS",16,0)
 K ^TMP("TIU",$J)
"RTN","GMTSDS",17,0)
 Q
"RTN","GMTSDS",18,0)
WRTREC(GMTSI,GMTSJ) ; Writes record header
"RTN","GMTSDS",19,0)
 N ADMIT,DISCHG,AUTHOR,ATTNDNG,TSPEC,STATUS,X K GMTSD
"RTN","GMTSDS",20,0)
 S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSDS",21,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,.07,"I") D REGDT4^GMTSU S ADMIT=X
"RTN","GMTSDS",22,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,.08,"I") D REGDT4^GMTSU S DISCHG=X
"RTN","GMTSDS",23,0)
 S:+DISCHG'>0 DISCHG="Present"
"RTN","GMTSDS",24,0)
 S AUTHOR=^TMP("TIU",$J,GMTSI,GMTSJ,1202,"E")
"RTN","GMTSDS",25,0)
 S ATTNDNG=^TMP("TIU",$J,GMTSI,GMTSJ,1209,"E")
"RTN","GMTSDS",26,0)
 S TSPEC=^TMP("TIU",$J,GMTSI,GMTSJ,1402,"E")
"RTN","GMTSDS",27,0)
 S STATUS=^TMP("TIU",$J,GMTSI,GMTSJ,.05,"E")
"RTN","GMTSDS",28,0)
 ;
"RTN","GMTSDS",29,0)
 S GMTSD("DATE")=^TMP("TIU",$J,GMTSI,GMTSJ,1301,"I")
"RTN","GMTSDS",30,0)
 I GMTSD("DATE")]"" S GMTSD("DATE")=$$NDT(GMTSD("DATE"))
"RTN","GMTSDS",31,0)
 S GMTSD("DOCTYPE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,.01,"E"))
"RTN","GMTSDS",32,0)
 S GMTSD("AUTHOR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"E"))
"RTN","GMTSDS",33,0)
 S GMTSD("EXPSIGNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1204,"E"))
"RTN","GMTSDS",34,0)
 S GMTSD("LOC")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1205,"E"))
"RTN","GMTSDS",35,0)
 ;
"RTN","GMTSDS",36,0)
 S GMTSD("SIGDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1501,"I"))
"RTN","GMTSDS",37,0)
 I GMTSD("SIGDT")]"" S GMTSD("SIGDT")=$$NDT(GMTSD("SIGDT"))
"RTN","GMTSDS",38,0)
 S SIGNEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1502,"I"))
"RTN","GMTSDS",39,0)
 S GMTSD("SIGBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1503,"E"))
"RTN","GMTSDS",40,0)
 S GMTSD("STITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1504,"E"))
"RTN","GMTSDS",41,0)
 ;
"RTN","GMTSDS",42,0)
 S GMTSD("EXPCOSNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1208,"E"))
"RTN","GMTSDS",43,0)
 S GMTSD("COSDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1507,"I"))
"RTN","GMTSDS",44,0)
 I GMTSD("COSDT")]"" S GMTSD("COSDT")=$$NDT(GMTSD("COSDT"))
"RTN","GMTSDS",45,0)
 S COSGEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1508,"I"))
"RTN","GMTSDS",46,0)
 S CONEED=0 S:+($G(COSGEDBY))>0 CONEED=1
"RTN","GMTSDS",47,0)
 S GMTSD("COBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1509,"E"))
"RTN","GMTSDS",48,0)
 S GMTSD("COTITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1510,"E"))
"RTN","GMTSDS",49,0)
 S COSAME=$S(+($G(SIGNEDBY))>0&(+($G(SIGNEDBY))=+($G(COSGEDBY))):1,1:0)
"RTN","GMTSDS",50,0)
 S:CONEED>0 CONEED=$S(COSAME=1:0,1:CONEED)
"RTN","GMTSDS",51,0)
 S GMTSD("SUBJ")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1701,"E"))
"RTN","GMTSDS",52,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,1505,"I"))="C" D
"RTN","GMTSDS",53,0)
 . S GMTSD("SCHART")="Signed on Chart",GMTSD("SCHARTBY")="."
"RTN","GMTSDS",54,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1512,"E"))'="" GMTSD("SCHARTBY")=" by:      "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,1512,"E"))
"RTN","GMTSDS",55,0)
 ;I $G(^TMP("TIU",$J,GMTSI,GMTSJ,1511,"I"))="C" D
"RTN","GMTSDS",56,0)
 I CONEED,$G(^TMP("TIU",$J,GMTSI,GMTSJ,1511,"I"))="C" D
"RTN","GMTSDS",57,0)
 . S GMTSD("COCHART")="Cosigned on Chart",GMTSD("COCHARTBY")="."
"RTN","GMTSDS",58,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1513,"E"))'="" GMTSD("COCHARTBY")=" by:  "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,1513,"E"))
"RTN","GMTSDS",59,0)
 S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"I"))'=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1502,"I")) GMTSD("AUTH")="AUTHOR:  "_GMTSD("AUTHOR")
"RTN","GMTSDS",60,0)
 ;
"RTN","GMTSDS",61,0)
 I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDS",62,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ADMIT,?12,"-",?14,DISCHG,?56,"Status: ",STATUS,!
"RTN","GMTSDS",63,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?3,"Last Tr Specialty: ",TSPEC,?49,"Dict'd By: ",AUTHOR,!
"RTN","GMTSDS",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?47,"Approved By: ",ATTNDNG,!
"RTN","GMTSDS",65,0)
 Q
"RTN","GMTSDS",66,0)
WRTTEXT(GMTSI,GMTSJ) ; Write Discharge Summary text
"RTN","GMTSDS",67,0)
 N GMTSK S GMTSK=0 F  S GMTSK=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"TEXT",GMTSK)) Q:+GMTSK'>0  D
"RTN","GMTSDS",68,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W $G(^TMP("TIU",$J,GMTSI,GMTSJ,"TEXT",GMTSK,0)),!
"RTN","GMTSDS",69,0)
 Q
"RTN","GMTSDS",70,0)
WRTSIG(GMTSI,GMTSJ) ; Write Signatures
"RTN","GMTSDS",71,0)
 I ^TMP("TIU",$J,GMTSI,GMTSJ,1501,"I")="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"**DRAFT COPY - DRAFT COPY -- ABOVE NOTE IS UNSIGNED --"
"RTN","GMTSDS",72,0)
 I  W " DRAFT COPY - DRAFT COPY**"
"RTN","GMTSDS",73,0)
 I $D(GMTSD("SCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J(GMTSD("SCHART"),24),GMTSD("SCHARTBY")
"RTN","GMTSDS",74,0)
 I GMTSD("SIGBLK")'="" D
"RTN","GMTSDS",75,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Signed by:",24)
"RTN","GMTSDS",76,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1505,"I"))="E" " /es/ "
"RTN","GMTSDS",77,0)
 . W ?30,GMTSD("SIGBLK")
"RTN","GMTSDS",78,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,GMTSD("STITLE")
"RTN","GMTSDS",79,0)
 . I $L(GMTSD("STITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSDS",80,0)
 . E  W:$L(GMTSD("STITLE"))>0 " "
"RTN","GMTSDS",81,0)
 . W $G(GMTSD("SIGDT"))
"RTN","GMTSDS",82,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDS",83,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.137)
"RTN","GMTSDS",84,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.138)
"RTN","GMTSDS",85,0)
 ;I $G(^TMP("TIU",$J,GMTSI,GMTSJ,.05,"E"))="UNCOSIGNED" D
"RTN","GMTSDS",86,0)
 I +($G(CONEED)),$G(^TMP("TIU",$J,GMTSI,GMTSJ,.05,"E"))="UNCOSIGNED" D
"RTN","GMTSDS",87,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,"** REQUIRES COSIGNATURE **"
"RTN","GMTSDS",88,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDS",89,0)
 ;I $D(GMTSD("COCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J(GMTSD("COCHART"),24),GMTSD("COCHARTBY")
"RTN","GMTSDS",90,0)
 I +($G(CONEED)),$D(GMTSD("COCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J(GMTSD("COCHART"),24),GMTSD("COCHARTBY")
"RTN","GMTSDS",91,0)
 ;I GMTSD("COBLK")'="" D
"RTN","GMTSDS",92,0)
 I +($G(CONEED)),GMTSD("COBLK")'="" D
"RTN","GMTSDS",93,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Cosigned By:",24)
"RTN","GMTSDS",94,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1511,"I"))="E" " /es/ "
"RTN","GMTSDS",95,0)
 . W ?30,GMTSD("COBLK")
"RTN","GMTSDS",96,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,GMTSD("COTITLE")
"RTN","GMTSDS",97,0)
 . I $L(GMTSD("COTITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSDS",98,0)
 . E  W:$L(GMTSD("COTITLE"))>0 " "
"RTN","GMTSDS",99,0)
 . W $G(GMTSD("COSDT"))
"RTN","GMTSDS",100,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDS",101,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.137)
"RTN","GMTSDS",102,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.138)
"RTN","GMTSDS",103,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDS",104,0)
 I +$O(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",0)) D
"RTN","GMTSDS",105,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Receipt Acknowledged by:",24)
"RTN","GMTSDS",106,0)
 S GMTSXTRA=0
"RTN","GMTSDS",107,0)
 F  S GMTSXTRA=+$O(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA)) Q:+GMTSXTRA'>0  D
"RTN","GMTSDS",108,0)
 . I +$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"DATE"))'>0 D  Q
"RTN","GMTSDS",109,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ! W "* AWAITING SIGNATURE *" D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDS",110,0)
 . I +GMTSXTRA>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDS",111,0)
 . W ?22," /es/ ",$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"NAME"))
"RTN","GMTSDS",112,0)
 . W !?25,$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"TITLE"))
"RTN","GMTSDS",113,0)
 . I $L($G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"TITLE")))>51 D
"RTN","GMTSDS",114,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?28
"RTN","GMTSDS",115,0)
 . E  W:$L($G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"TITLE")))>0 " "
"RTN","GMTSDS",116,0)
 . W $$NDT($G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"DATE")))
"RTN","GMTSDS",117,0)
 . N GMTSBPR S GMTSBPR=$$GET1^DIQ(200,+$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"EXTRA")),.137)_"^"_$$GET1^DIQ(200,+$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"EXTRA")),.138)
"RTN","GMTSDS",118,0)
 . I +GMTSBPR D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$P(GMTSBPR,U)
"RTN","GMTSDS",119,0)
 . I +$P(GMTSBPR,U,2) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager: ",$P(GMTSBPR,U,2)
"RTN","GMTSDS",120,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSDS",121,0)
 Q
"RTN","GMTSDS",122,0)
ND(X) S X=$G(X) D REGDT4^GMTSU Q X
"RTN","GMTSDS",123,0)
NDT(X) S X=$G(X) D REGDTM4^GMTSU Q X
"RTN","GMTSDSB")
0^4^B3394911
"RTN","GMTSDSB",1,0)
GMTSDSB ; SLC/JER,KER - Brief Discharge Summary ; 04/11/2000
"RTN","GMTSDSB",2,0)
 ;;2.7;Health Summary;**12,28,35**;Feb 28, 1996
"RTN","GMTSDSB",3,0)
 ;
"RTN","GMTSDSB",4,0)
MAIN ; Control branching
"RTN","GMTSDSB",5,0)
 N GMTSI,GMTSJ,GMTSREC
"RTN","GMTSDSB",6,0)
 K ^TMP("TIU",$J)
"RTN","GMTSDSB",7,0)
 D MAIN^TIULAPIC(DFN,244,GMTS1,GMTS2,GMTSNDM,0)
"RTN","GMTSDSB",8,0)
 I '$D(^TMP("TIU",$J)) Q
"RTN","GMTSDSB",9,0)
 D WRTHDR
"RTN","GMTSDSB",10,0)
 S GMTSI=0
"RTN","GMTSDSB",11,0)
 F  S GMTSI=$O(^TMP("TIU",$J,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSDSB",12,0)
 . S GMTSJ=0
"RTN","GMTSDSB",13,0)
 . F  S GMTSJ=$O(^TMP("TIU",$J,GMTSI,GMTSJ)) Q:+GMTSJ'>0  D
"RTN","GMTSDSB",14,0)
 . . D WRTREC(GMTSI,GMTSJ)
"RTN","GMTSDSB",15,0)
 Q
"RTN","GMTSDSB",16,0)
WRTHDR ; Writes Header for new pages
"RTN","GMTSDSB",17,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Admitted",?11,"Disch'd",?21,"Dictated By",?36,"Approved By",?51,"Cosigned",?61,"Status",!!
"RTN","GMTSDSB",18,0)
 Q
"RTN","GMTSDSB",19,0)
WRTREC(GMTSI,GMTSJ) ; Writes record header
"RTN","GMTSDSB",20,0)
 N ADMIT,DISCHG,AUTHOR,ATTNDNG,COSIG,TSPEC,STATUS,X
"RTN","GMTSDSB",21,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,.07,"I") D REGDT4^GMTSU S ADMIT=X
"RTN","GMTSDSB",22,0)
 S X=^TMP("TIU",$J,GMTSI,GMTSJ,.08,"I") D REGDT4^GMTSU S DISCHG=X
"RTN","GMTSDSB",23,0)
 S AUTHOR=$E(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"E"),1,13)
"RTN","GMTSDSB",24,0)
 S:+DISCHG'>0 DISCHG="Present"
"RTN","GMTSDSB",25,0)
 S ATTNDNG=$E(^TMP("TIU",$J,GMTSI,GMTSJ,1209,"E"),1,13)
"RTN","GMTSDSB",26,0)
 S TSPEC=^TMP("TIU",$J,GMTSI,GMTSJ,1402,"E")
"RTN","GMTSDSB",27,0)
 S STATUS=^TMP("TIU",$J,GMTSI,GMTSJ,.05,"E")
"RTN","GMTSDSB",28,0)
 S COSIG=$$EDT^GMTSU(^TMP("TIU",$J,GMTSI,GMTSJ,1507,"I"))
"RTN","GMTSDSB",29,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR W ADMIT,?12,DISCHG,?24,AUTHOR,?39,ATTNDNG,?54,COSIG,?64,STATUS,!
"RTN","GMTSDSB",30,0)
 Q
"RTN","GMTSDVR")
0^17^B32939032
"RTN","GMTSDVR",1,0)
GMTSDVR ; SLC/JER,KER - Health Summary Driver ; 04/11/2000
"RTN","GMTSDVR",2,0)
 ;;2.7;Health Summary;**6,16,27,28,30,31,35**;Oct 20, 1995
"RTN","GMTSDVR",3,0)
 ;
"RTN","GMTSDVR",4,0)
MAIN ; Control branching
"RTN","GMTSDVR",5,0)
 N C,I,GMTYP,VADM,VAROOT,ZTRTN,GMPSAP
"RTN","GMTSDVR",6,0)
 K DIROUT,DUOUT
"RTN","GMTSDVR",7,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",8,0)
 . D SELTYP Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",9,0)
 . N GMPAT,GMP
"RTN","GMTSDVR",10,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)!(+($G(ORVP))>0)
"RTN","GMTSDVR",11,0)
 . . K GMP,GMPAT
"RTN","GMTSDVR",12,0)
 . . I +($G(ORVP)) S GMPAT(1)=+($G(ORVP))
"RTN","GMTSDVR",13,0)
 . . E  F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PTPC Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,$P($G(^VA(200,DUZ,100.1)),U,6)]"":1,1:0)  D
"RTN","GMTSDVR",14,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSDVR",15,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSDVR",16,0)
 . . N GMTSPX1,GMTSPX2
"RTN","GMTSDVR",17,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX2,.GMTSPX1) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTSDVR",18,0)
 . . Q:$D(DUOUT)!$D(DIROUT)
"RTN","GMTSDVR",19,0)
 . . D RESUB(.GMPAT)
"RTN","GMTSDVR",20,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSDVR",21,0)
 . . S ZTRTN="PQ^GMTSDVR"
"RTN","GMTSDVR",22,0)
 . . D HSOUT
"RTN","GMTSDVR",23,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSDVR",24,0)
 Q
"RTN","GMTSDVR",25,0)
PTPC ; Combined Patient/Patient Copy
"RTN","GMTSDVR",26,0)
 N GMTSPRO,GMTSVER S GMTSVER=+($$VERSION^XPDUTL("OR")),GMTSPRO=+($$PROK^GMTSU("ORU1",11))
"RTN","GMTSDVR",27,0)
 D:GMTSVER>2.9&(GMTSPRO) PATIENT^ORU1(.GMP,,"I  $P($G(^(""OOS"")),""^"")")
"RTN","GMTSDVR",28,0)
 D:GMTSVER'>2.9!('GMTSPRO) PATIENT^ORU1(.GMP) D PATCOPY^GMTSDVR(.GMP,.GMPAT)
"RTN","GMTSDVR",29,0)
 Q
"RTN","GMTSDVR",30,0)
PATCOPY(GMP,GMPAT) ;Copies patients retrieved from ^ORU1 in GMP array
"RTN","GMTSDVR",31,0)
 ;                to GMPAT array
"RTN","GMTSDVR",32,0)
 N IFN,GMDFN
"RTN","GMTSDVR",33,0)
 S IFN=0
"RTN","GMTSDVR",34,0)
 ; GMPAT(NAME,GMDFN) - want array in alphabetic order by patient
"RTN","GMTSDVR",35,0)
 F  S IFN=$O(GMP(IFN)) Q:IFN'>0  D
"RTN","GMTSDVR",36,0)
 . S GMDFN=+$G(GMP(IFN))
"RTN","GMTSDVR",37,0)
 . ; Getting name from ^DPT because name returned from ^ORUS sometimes
"RTN","GMTSDVR",38,0)
 . ; has trailing spaces which could allow duplicate recs for a patient
"RTN","GMTSDVR",39,0)
 . S GMPAT($P($G(^DPT(GMDFN,0)),U),+GMDFN)=+GMDFN
"RTN","GMTSDVR",40,0)
 Q
"RTN","GMTSDVR",41,0)
RESUB(GMP) ;Subscripts in GMP array are convert to one numeric subscript.
"RTN","GMTSDVR",42,0)
 ;        Done inorder to have GMP array in alphabetic order by patient.
"RTN","GMTSDVR",43,0)
 N NAME,GMDFN,CNT
"RTN","GMTSDVR",44,0)
 S CNT=0,NAME=""
"RTN","GMTSDVR",45,0)
 F  S NAME=$O(GMP(NAME)) Q:NAME']""  D
"RTN","GMTSDVR",46,0)
 . S GMDFN=0
"RTN","GMTSDVR",47,0)
 . F  S GMDFN=$O(GMP(NAME,GMDFN)) Q:GMDFN'>0  D
"RTN","GMTSDVR",48,0)
 . . S CNT=CNT+1
"RTN","GMTSDVR",49,0)
 . . S GMP(CNT)=GMP(NAME,GMDFN)
"RTN","GMTSDVR",50,0)
 . . K GMP(NAME,GMDFN)
"RTN","GMTSDVR",51,0)
 Q
"RTN","GMTSDVR",52,0)
ENXQ ; External call for tasked HS print
"RTN","GMTSDVR",53,0)
 ; Input: GMTSTYP=Record # of HS type in file 142
"RTN","GMTSDVR",54,0)
 ;            DFN=Record # of patient in file 2
"RTN","GMTSDVR",55,0)
 ;        GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTSDVR",56,0)
 ;        GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTSDVR",57,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTSDVR",58,0)
 ;        is desired.
"RTN","GMTSDVR",59,0)
 ; To call from TaskMan:
"RTN","GMTSDVR",60,0)
 ;        S ZTRTN="ENXQ^GMTSDVR",ZTSAVE("GMTSTYP")="",ZTSAVE("DFN")=""
"RTN","GMTSDVR",61,0)
 ;        D ^%ZTLOAD
"RTN","GMTSDVR",62,0)
 D ENX(DFN,GMTSTYP,$G(GMTSPX2),$G(GMTSPX1))
"RTN","GMTSDVR",63,0)
 Q
"RTN","GMTSDVR",64,0)
ENX(DFN,GMTSTYP,GMTSPX2,GMTSPX1) ; External call to print a Health Summary
"RTN","GMTSDVR",65,0)
 ; call with: GMTSTYP=HEALTH SUMMARY TYPE file record number
"RTN","GMTSDVR",66,0)
 ;                DFN=PATIENT file record number
"RTN","GMTSDVR",67,0)
 ;
"RTN","GMTSDVR",68,0)
 ;            GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTSDVR",69,0)
 ;            GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTSDVR",70,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTSDVR",71,0)
 ;        is desired.
"RTN","GMTSDVR",72,0)
 N DI,DX,DY,GMQUIT,GMTYP,GMPAT,VADM,VAIN,VAROOT
"RTN","GMTSDVR",73,0)
 F  Q:($D(^GMT(142,+GMTSTYP,1))>9)&$D(^DPT(DFN))!+$G(GMQUIT)  D
"RTN","GMTSDVR",74,0)
 . I $D(^GMT(142,+GMTSTYP,1))'>9 D
"RTN","GMTSDVR",75,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",76,0)
 . . W !?3,"Invalid HEALTH SUMMARY TYPE." D SELTYP S GMTSTYP=+$G(GMTYP(1))
"RTN","GMTSDVR",77,0)
 . I '$D(^DPT(DFN)) D
"RTN","GMTSDVR",78,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",79,0)
 . . W !?3,"Invalid PATIENT ID." D PATIENT^ORU1(.GMPAT) S DFN=+$G(GMPAT(1))
"RTN","GMTSDVR",80,0)
 Q:+$G(GMQUIT)
"RTN","GMTSDVR",81,0)
 S:$D(GMTYP)'>9 GMTYP(0)=1,GMTYP(1)=+$G(GMTSTYP)_U_$P($G(^GMT(142,+GMTSTYP,0)),U)
"RTN","GMTSDVR",82,0)
 S:$D(GMPAT)'>9 GMPAT=1,GMPAT(0)=1,GMPAT(1)=DFN_U_$P($G(^DPT(DFN,0)),U)
"RTN","GMTSDVR",83,0)
 D PQ
"RTN","GMTSDVR",84,0)
 Q
"RTN","GMTSDVR",85,0)
SELTYP ; Select Health Summary Type(s)
"RTN","GMTSDVR",86,0)
 N DIC,X,Y
"RTN","GMTSDVR",87,0)
 S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEMQZ"
"RTN","GMTSDVR",88,0)
 S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSDVR",89,0)
 I $D(GMTYP)<10 S DIC("B")=$S($D(^DISV(DUZ,"^GMT(142,"))=10:$G(^DISV(DUZ,"^GMT(142,",$O(^("^GMT(142,",0)))),1:$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U))
"RTN","GMTSDVR",90,0)
 K GMTYP S Y=$$TYPE^GMTSULT Q:+Y'>0
"RTN","GMTSDVR",91,0)
 I $S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"The Summary Type "_$P(Y,U,2)_" includes no components...Please choose another",! Q
"RTN","GMTSDVR",92,0)
 S GMTYP(0)=1,GMTYP(1)=Y_U_$P(Y,U,2)_U_$P(Y,U,2)_U_$P(Y,U,2)
"RTN","GMTSDVR",93,0)
 Q
"RTN","GMTSDVR",94,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTSDVR",95,0)
 N DFN,GMTI,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTSDVR",96,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSTYP,GMTSTITL,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTSDVR",97,0)
 N GMTSPHDR,TRFAC,VAERR,VAIN
"RTN","GMTSDVR",98,0)
 S GMTI=0 F  S GMTI=$O(GMTYP(GMTI)) Q:GMTI'>0!$D(DIROUT)  D
"RTN","GMTSDVR",99,0)
 .N GMTSEG,GMTSEGC,GMTSEGI
"RTN","GMTSDVR",100,0)
 .S GMTSTYP=+$G(GMTYP(GMTI)),GMTSTITL=$G(^GMT(142,+GMTSTYP,"T"))
"RTN","GMTSDVR",101,0)
 .S:'$L(GMTSTITL) GMTSTITL=$P(GMTYP(GMTI),U,2)
"RTN","GMTSDVR",102,0)
 .D LOADSEG
"RTN","GMTSDVR",103,0)
 .S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTSDVR",104,0)
 . . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTSDVR",105,0)
 . . N GMDUOUT
"RTN","GMTSDVR",106,0)
 . . D EN^GMTS1
"RTN","GMTSDVR",107,0)
 . . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSDVR",108,0)
 . . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTSDVR",109,0)
 Q
"RTN","GMTSDVR",110,0)
LOADSEG ;LOAD ENABLED COMPONENTS INTO GMTSEG ARRAY
"RTN","GMTSDVR",111,0)
 N GMTI,GMTJ,GMX
"RTN","GMTSDVR",112,0)
 S (GMTI,GMTJ)=0 F  S GMTJ=$O(^GMT(142,GMTSTYP,1,GMTJ)) Q:GMTJ'>0  S GMX=^(GMTJ,0) D
"RTN","GMTSDVR",113,0)
 .S GMTI=GMTI+1,GMTSEG(GMTI)=GMX,GMTSEGI($P(GMX,U,2))=GMTI D SELFILE
"RTN","GMTSDVR",114,0)
 S GMTSEGC=GMTI
"RTN","GMTSDVR",115,0)
 Q
"RTN","GMTSDVR",116,0)
SELFILE ; Get Selection item information for GMTSEG(
"RTN","GMTSDVR",117,0)
 N GMTK S GMTK=0 F  S GMTK=$O(^GMT(142,GMTSTYP,1,GMTJ,1,GMTK)) Q:GMTK'>0  D
"RTN","GMTSDVR",118,0)
 . N GMTSE,GMTSR,GMTSF S GMTSE=^(GMTK,0),GMTSR=U_$P(GMTSE,";",2) Q:GMTSR="^"
"RTN","GMTSDVR",119,0)
 . S GMTSF=+$P(@(GMTSR_"0)"),U,2) Q:+GMTSF=0
"RTN","GMTSDVR",120,0)
 . S GMTSEG(GMTI,GMTSF,GMTK)=$P(GMTSE,";"),GMTSEG(GMTI,GMTSF,0)=GMTSR
"RTN","GMTSDVR",121,0)
 Q
"RTN","GMTSDVR",122,0)
HSOUT ; Output summary, with device control
"RTN","GMTSDVR",123,0)
 ; Call with: ZTRTN
"RTN","GMTSDVR",124,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D @ZTRTN Q
"RTN","GMTSDVR",125,0)
 N %ZIS,IOP
"RTN","GMTSDVR",126,0)
 S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTSDVR",127,0)
 G:$D(IO("Q")) QUE
"RTN","GMTSDVR",128,0)
NOQUE D @ZTRTN
"RTN","GMTSDVR",129,0)
 D ^%ZISC
"RTN","GMTSDVR",130,0)
 Q
"RTN","GMTSDVR",131,0)
QUE ; Queue output
"RTN","GMTSDVR",132,0)
 N %,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTSK
"RTN","GMTSDVR",133,0)
 Q:'$D(ZTRTN)  K IO("Q"),ZTSAVE F %="DFN","GM*","ENTRY","O*" S ZTSAVE(%)=""
"RTN","GMTSDVR",134,0)
 S ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTSDVR",135,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTSDVR",136,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTSDVR",137,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTSDVR",138,0)
 Q
"RTN","GMTSDVR",139,0)
ACTPROF(GMDFN) ; Check & print Action Profile for patient if +$G(GMPSAP)
"RTN","GMTSDVR",140,0)
 N DFN,PSTYPE,PSONOPG,PSOPAR,PSOINST
"RTN","GMTSDVR",141,0)
 I +$G(GMPSAP) D
"RTN","GMTSDVR",142,0)
 . S (PSTYPE,PSONOPG)=1,DFN=GMDFN
"RTN","GMTSDVR",143,0)
 . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSDVR",144,0)
 . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSDVR",145,0)
 . D DFN^PSOSD1
"RTN","GMTSDVR",146,0)
 . S DFN=GMDFN ;Have to reset DFN because ^PSOSD1 call kills it and it is
"RTN","GMTSDVR",147,0)
 . ; needed for the ^GMTSPL call.
"RTN","GMTSDVR",148,0)
 . D PAGE^GMTSPL
"RTN","GMTSGAF")
0^18^B37974325
"RTN","GMTSGAF",1,0)
GMTSGAF ; SLC/KER - MH Gbl Assessment Funct (GAF)    ; 04/11/2000
"RTN","GMTSGAF",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSGAF",3,0)
 ;
"RTN","GMTSGAF",4,0)
 Q
"RTN","GMTSGAF",5,0)
EN ; Global Assessment Functioning Score
"RTN","GMTSGAF",6,0)
 S:+($G(GMTSNDM))'>1 GMTSNDM=10 S:+($G(GMTSBEG))'>2700101 GMTSBEG=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),-1095,0,0,1),GMTSEND=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),1,0,0,1),GMTS2=9999999-GMTSBEG,GMTS1=9999999-GMTSEND
"RTN","GMTSGAF",7,0)
 S:'$L($P(GMTSBEG,".",2)) GMTSBEG=$$FMADD^XLFDT(GMTSBEG,0,0,0,1)
"RTN","GMTSGAF",8,0)
 S:+($G(GMTSEND))'>2700101!(+($G(GMTSEND))>+($$FMADD^XLFDT($P($$NOW^XLFDT,".",1),+1,0,0,2))) GMTSEND=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),1,0,0,1),GMTS1=9999999-GMTSEND
"RTN","GMTSGAF",9,0)
 S:'$L($P(GMTSEND,".",2)) GMTSEND=$$FMADD^XLFDT(GMTSEND,0,0,0,1)
"RTN","GMTSGAF",10,0)
 S:+($G(GMTSEND))>0&(+($G(GMTS1))=0) GMTS1=9999999-GMTSEND S:+($G(GMTSBEG))>0&(+($G(GMTS2))=0) GMTS2=9999999-GMTSBEG
"RTN","GMTSGAF",11,0)
 S GMTSLO=+($G(GMTSLO)) S:GMTSLO=0 GMTSLO=3 S GMTSLPG=+($G(GMTSLPG)),GMTSDTM=$G(GMTSDTM) S:'$L(GMTSDTM) GMTSDTM=$$DTM
"RTN","GMTSGAF",12,0)
 S:'$D(GMTSTITL)!('$L($G(GMTSTITL))) GMTSTITL="GLOBAL ASSESSMENT FUNCTIONING"
"RTN","GMTSGAF",13,0)
 S DFN=+($G(DFN)) Q:'$L($P($G(^DPT(DFN,0)),"^",1))
"RTN","GMTSGAF",14,0)
 N %,%DT,%H,%I,%T,%X,I,N,VA,VADM,VAERR,X,Y,YS,YSGAF
"RTN","GMTSGAF",15,0)
 N GMTSBAR,GMTSCNT,GMTSCOM,GMTSCORE,GMTSCS,GMTSCW,GMTSDATE,GMTSDT,GMTSGAF,GMTSGAF1,GMTSGAF2,GMTSGAF3,GMTSGAFN,GMTSI,GMTSJ,GMTSLEN,GMTSPROV,GMTSRV
"RTN","GMTSGAF",16,0)
 S GMTSGAF1=$$ITM(+($G(GMTS1))),GMTSGAF2=$$ITM(+($G(GMTS2))),GMTSGAF3=$$TOM,GMTSGAFN=+($G(GMTSNDM)) S:GMTSGAFN=0 GMTSGAFN=10
"RTN","GMTSGAF",17,0)
 S GMTSCW(0)=+($G(IOM)) S:GMTSCW(0)=0 GMTSCW(0)=80
"RTN","GMTSGAF",18,0)
 S GMTSCW(1)=5,GMTSCW(2)=10,GMTSCW(3)=20,GMTSCW(4)=GMTSCW(0)-(GMTSCW(1)+GMTSCW(2)+GMTSCW(3)+8)
"RTN","GMTSGAF",19,0)
 S GMTSCW("L")=(GMTSCW(1)+GMTSCW(2)+GMTSCW(3)+GMTSCW(4)+6)
"RTN","GMTSGAF",20,0)
 S GMTSCS(1)=1,GMTSCS(2)=GMTSCS(1)+GMTSCW(1)+2,GMTSCS(3)=GMTSCS(2)+GMTSCW(2)+2,GMTSCS(4)=GMTSCS(3)+GMTSCW(3)+2
"RTN","GMTSGAF",21,0)
 S YS("DFN")=DFN,YS("BEGIN")=$S($L(GMTSGAF2):GMTSGAF2,1:GMTSGAF3),YS("END")=$S($L(GMTSGAF1):GMTSGAF1,1:"01/01/1970"),YS("LIMIT")=GMTSGAFN
"RTN","GMTSGAF",22,0)
 ; Remove Reverse Video Bar Graph
"RTN","GMTSGAF",23,0)
 ; GMTSRV=$$URV
"RTN","GMTSGAF",24,0)
 D GET Q:'$D(^TMP($J,"GMTSGAF",DFN))  D OUT Q
"RTN","GMTSGAF",25,0)
OUT ; Output
"RTN","GMTSGAF",26,0)
 N GMTSI,GMTSJ,GMTSCORE,GMTSDATE,GMTSPROV,GMTSCOM S DFN=+($G(DFN)) Q:DFN=0  D HDR S GMTSI=0 F  S GMTSI=$O(^TMP($J,"GMTSGAF",DFN,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSGAF",27,0)
 . S GMTSJ=$G(^TMP($J,"GMTSGAF",DFN,GMTSI)),GMTSCORE=$P(GMTSJ,"^",1),GMTSDATE=$P(GMTSJ,"^",2),GMTSPROV=$P(GMTSJ,"^",3),GMTSCOM=$P(GMTSJ,"^",4) S:GMTSCORE=""&(GMTSDATE["----")&($L(GMTSCOM)) GMTSCORE=">>" D LINE
"RTN","GMTSGAF",28,0)
 K ^TMP($J,"GMTSGAF",DFN) Q
"RTN","GMTSGAF",29,0)
LINE ; Output One Line
"RTN","GMTSGAF",30,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCS(1),$J($E(GMTSCORE,1,2),3),?GMTSCS(2),GMTSDATE,?GMTSCS(3),$E(GMTSPROV,1,GMTSCW(3)),?GMTSCS(4),GMTSCOM,! Q
"RTN","GMTSGAF",31,0)
HDR ; Header
"RTN","GMTSGAF",32,0)
 N GMTSI S GMTSI="",$P(GMTSI,"-",+($G(GMTSCW("L"))))="-"
"RTN","GMTSGAF",33,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W ?GMTSCS(1)," GAF ",?GMTSCS(2),"Date",!
"RTN","GMTSGAF",34,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W ?GMTSCS(1),"Score",?GMTSCS(2),"Determined",?GMTSCS(3),"Determined by",?GMTSCS(4),"Graph/Comment",!
"RTN","GMTSGAF",35,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W ?GMTSCS(1),GMTSI,!
"RTN","GMTSGAF",36,0)
 Q
"RTN","GMTSGAF",37,0)
GET ; Get and Format Data
"RTN","GMTSGAF",38,0)
 N %DT,X,Y,GMTSGPH,GMTSCORE,GMTSDT,GMTSDATE,GMTSPROV,GMTSCOM S DFN=+($G(DFN)),GMTSGPH=0 K ^TMP($J,"GMTSGAF",DFN),YSGAF D GAFHX^YSGAFAPI(.YSGAF,.YS),SPC
"RTN","GMTSGAF",39,0)
 I +($P($G(YSGAF("DEC")),".",1))>0 D
"RTN","GMTSGAF",40,0)
 . S GMTSDT=+($P($G(YSGAF("DEC")),".",1)),GMTSCOM="Deceased ("_$$FMTE^XLFDT(GMTSDT,"5ZD")_")" D SD(GMTSDT,DFN,"","","",GMTSCOM)
"RTN","GMTSGAF",41,0)
 I +($P($G(YSGAF("DUE")),".",1))>0 D
"RTN","GMTSGAF",42,0)
 . S GMTSDT=+($P($G(YSGAF("DUE")),".",1)) Q:GMTSDT>$$TOD  S GMTSCOM="Due since "_$$FMTE^XLFDT(GMTSDT,"5ZD") D SD(GMTSDT,DFN,"","","",GMTSCOM)
"RTN","GMTSGAF",43,0)
 N I S I=1 F  S I=$O(YSGAF(I)) Q:+I=0  D
"RTN","GMTSGAF",44,0)
 . S GMTSDT=$P(YSGAF(I),"^",1),GMTSDATE=$P(GMTSDT,".",1),GMTSDATE=$$FMTE^XLFDT(GMTSDATE,"5ZD")
"RTN","GMTSGAF",45,0)
 . Q:+($G(YSGAF("DEC")))>0&(+GMTSDATE>+($G(YSGAF("DEC"))))
"RTN","GMTSGAF",46,0)
 . S GMTSCORE=$P(YSGAF(I),"^",5),GMTSPROV=$P(YSGAF(I),"^",7)
"RTN","GMTSGAF",47,0)
 . S GMTSCOM=+($P($G(YSGAF("ERR",I)),".",1)) S:+GMTSCOM=0 GMTSCOM=""
"RTN","GMTSGAF",48,0)
 . S:+GMTSCOM>0 GMTSCOM="Entered in error ("_$$FMTE^XLFDT(GMTSCOM,"5ZD")_")"
"RTN","GMTSGAF",49,0)
 . S:GMTSCOM="" GMTSCOM=$$B(GMTSCORE,31)
"RTN","GMTSGAF",50,0)
 . D:'$D(YSGAF("ERR",I)) SD(GMTSDT,DFN,GMTSCORE,GMTSDATE,GMTSPROV,GMTSCOM)
"RTN","GMTSGAF",51,0)
 Q
"RTN","GMTSGAF",52,0)
SPC ; Get Special Case (Deceased, Due, Entered-in-Error)
"RTN","GMTSGAF",53,0)
 N GMTSI S YSGAF("P")=$P($G(^DPT(+($G(DFN)),0)),"^",1)
"RTN","GMTSGAF",54,0)
 S GMTSI=$$DEC(+($G(DFN))) S:+GMTSI>0 YSGAF("DEC")=GMTSI I +GMTSI=0 S GMTSI=$$DUE S:+GMTSI>0 YSGAF("DUE")=GMTSI
"RTN","GMTSGAF",55,0)
 K:+($G(YSGAF("DEC")))>0 YSGAF("DUE") S GMTSI=$$ERR S:+GMTSI>0 YSGAF("ERR")=GMTSI
"RTN","GMTSGAF",56,0)
 Q
"RTN","GMTSGAF",57,0)
SD(GMTSI,DFN,GMTSCORE,GMTSDATE,GMTSPROV,GMTSCOM) ; Save Data
"RTN","GMTSGAF",58,0)
 S GMTSCORE=$G(GMTSCORE),GMTSCORE=$$GAF(GMTSCORE),DFN=+($G(DFN))
"RTN","GMTSGAF",59,0)
 S GMTSI=+($G(GMTSI)),GMTSI=9999999.999999-GMTSI
"RTN","GMTSGAF",60,0)
 S GMTSPROV=$G(GMTSPROV),GMTSDATE=$G(GMTSDATE)
"RTN","GMTSGAF",61,0)
 S:GMTSDATE="" GMTSDATE="--/--/----"
"RTN","GMTSGAF",62,0)
 S ^TMP($J,"GMTSGAF",DFN,GMTSI)=GMTSCORE_"^"_GMTSDATE_"^"_GMTSPROV_"^"_$G(GMTSCOM)
"RTN","GMTSGAF",63,0)
 Q
"RTN","GMTSGAF",64,0)
ERR(X) ; Entered in Error
"RTN","GMTSGAF",65,0)
 N GMTSCNT,GMTSI,GMTSGAF,GMTSJ,GMTSDATE S (GMTSCNT,GMTSI)=0,GMTSDATE="" F  S GMTSI=$O(YSGAF(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSGAF",66,0)
 . S GMTSGAF=$P(YSGAF(GMTSI),"^",8) Q:GMTSGAF'["entered in error"
"RTN","GMTSGAF",67,0)
 . S YSGAF("ERR")="" F GMTSJ=1:1:$L(GMTSGAF," ") S:$P(GMTSGAF," ",GMTSJ)["@"&(GMTSJ>2) GMTSDATE=$P(GMTSGAF," ",GMTSJ-1,GMTSJ) S:$L(GMTSDATE) GMTSDATE=$$ETF(GMTSDATE)
"RTN","GMTSGAF",68,0)
 . S:$L(GMTSDATE) YSGAF("ERR",GMTSI)=GMTSDATE,GMTSCNT=GMTSCNT+1
"RTN","GMTSGAF",69,0)
 S X=GMTSCNT Q X
"RTN","GMTSGAF",70,0)
DUE(X) ; GAF Score Due Date
"RTN","GMTSGAF",71,0)
 S:'$D(YSGAF(2)) YSGAF(1)="[NO DATA]" N GMTSI,GMTSJ,GMTSDATE S (GMTSI,GMTSJ,GMTSDATE)=0
"RTN","GMTSGAF",72,0)
 F  S GMTSI=$O(YSGAF(GMTSI)) Q:+GMTSI=0  S GMTSJ=$P(YSGAF(GMTSI),"^",1) S:GMTSJ>GMTSDATE GMTSDATE=GMTSJ
"RTN","GMTSGAF",73,0)
 S GMTSDATE=$S(GMTSDATE>0:$$FMADD^XLFDT(GMTSDATE,90,0,0,0),1:"") S X=GMTSDATE Q X
"RTN","GMTSGAF",74,0)
ITM(X) ; Inverse date to Mental Health formats
"RTN","GMTSGAF",75,0)
 S X=+($G(X)) Q:X=0 "" S X=9999999.999999-X,X=$$FMTE^XLFDT(X,"5ZD") Q X
"RTN","GMTSGAF",76,0)
ETF(X) ; External to Fileman format
"RTN","GMTSGAF",77,0)
 N %DT,Y S X=$G(X),%DT="PST" D ^%DT S X=Y S:+X'>0 X="" Q X
"RTN","GMTSGAF",78,0)
TOM(X) ; Tomorrow
"RTN","GMTSGAF",79,0)
 S X=$$FMTE^XLFDT($$FMADD^XLFDT($$NOW^XLFDT,1,0,0,0),"5ZD") Q X
"RTN","GMTSGAF",80,0)
TOD(X) ; Today
"RTN","GMTSGAF",81,0)
 S X=$$NOW^XLFDT Q X
"RTN","GMTSGAF",82,0)
DEC(X) ; Deceased Date
"RTN","GMTSGAF",83,0)
 N %,%H,%I,%X,%T,VA,VADM,VAERR,DFN S DFN=+($G(X)) Q:DFN=0 "" Q:'$D(^DPT(+DFN,0)) ""
"RTN","GMTSGAF",84,0)
 D DEM^VADPT S X=+$G(VADM(6)) S:X=0 X="" Q X
"RTN","GMTSGAF",85,0)
B(X,Y) ; Graph Bar
"RTN","GMTSGAF",86,0)
 N GMTSGAF,GMTSCHAR,GMTSCW,GMTSLEN,GMTSI,GMTSBAR S GMTSGAF=$G(X),GMTSCW=+($G(Y)) Q:GMTSCW=0 ""
"RTN","GMTSGAF",87,0)
 ; Remove Reverse Video Bar Graph
"RTN","GMTSGAF",88,0)
 ; S GMTSCHAR=$S(+($G(GMTSRV))>0:" ",1:"#")
"RTN","GMTSGAF",89,0)
 S GMTSCHAR="#" F  Q:$E(GMTSGAF,1)'="0"  S GMTSGAF=$E(GMTSGAF,2,$L(GMTSGAF))
"RTN","GMTSGAF",90,0)
 S GMTSGAF=+GMTSGAF Q:GMTSGAF=0 ""
"RTN","GMTSGAF",91,0)
 I GMTSGAF>99 S GMTSBAR="",$P(GMTSBAR,GMTSCHAR,GMTSCW)=GMTSCHAR
"RTN","GMTSGAF",92,0)
 I GMTSGAF'>99 S GMTSI=GMTSCW/100,GMTSLEN=GMTSI*GMTSGAF,GMTSLEN=$FN(GMTSLEN,"",0),GMTSBAR="",$P(GMTSBAR,GMTSCHAR,GMTSLEN)=GMTSCHAR
"RTN","GMTSGAF",93,0)
 ; Remove Reverse Video Bar Graph
"RTN","GMTSGAF",94,0)
 ;I +($G(GMTSRV)),$L(GMTSBAR),GMTSBAR[" " D
"RTN","GMTSGAF",95,0)
 ;. N X,IORVON,IORVOFF S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","GMTSGAF",96,0)
 ;. S GMTSBAR=IORVON_GMTSBAR_IORVOFF D KILL^%ZISS
"RTN","GMTSGAF",97,0)
 S X=GMTSBAR Q X
"RTN","GMTSGAF",98,0)
GAF(X) ; 2 Digit GAF Score
"RTN","GMTSGAF",99,0)
 S X=$E($G(X),1,2) Q:X=""!(X="--") "" S X=+X Q:X=0 "00" S:$L(X)'>1 X="0"_X Q X
"RTN","GMTSGAF",100,0)
DTM(X) ; Current Date and Time (External)
"RTN","GMTSGAF",101,0)
 S X=$$NOW^XLFDT D REGDTM4^GMTSU Q X
"RTN","GMTSGAF",102,0)
URV(X) ; Use Reverse Video
"RTN","GMTSGAF",103,0)
 Q:$E($G(IOST),1,2)'="C-" 0
"RTN","GMTSGAF",104,0)
 N GMTSIO,IORVON,IORVOFF S GMTSIO=0,X="IORVON;IORVOFF" D ENDR^%ZISS S GMTSIO=0
"RTN","GMTSGAF",105,0)
 Q:$G(IORVON)["^" 0 Q:$G(IORVOFF)["^" 0
"RTN","GMTSGAF",106,0)
 S:$G(IORVON)[$C(27)!($G(IORVON)[$C(27)) GMTSIO=1
"RTN","GMTSGAF",107,0)
 S:$L($G(IORVON))>0!($L($G(IORVON))>0) GMTSIO=1
"RTN","GMTSGAF",108,0)
 D KILL^%ZISS S X=GMTSIO Q X
"RTN","GMTSONE")
0^33^B26649444
"RTN","GMTSONE",1,0)
GMTSONE ; HIN/GWB - Oncology Health Summary Comp ; 04/11/2000
"RTN","GMTSONE",2,0)
 ;;2.7;Health Summary;**36,35**;Oct 20, 1995
"RTN","GMTSONE",3,0)
 ;
"RTN","GMTSONE",4,0)
EXTRACT ; Extract data for patient DFN
"RTN","GMTSONE",5,0)
 K ^UTILITY("DIQ1",$J) Q:'$D(^ONCO(160,"B",DFN_";DPT("))  S PTIEN=$O(^ONCO(160,"B",DFN_";DPT(",0))
"RTN","GMTSONE",6,0)
 S IEN=0 F  S IEN=$O(^ONCO(165.5,"C",PTIEN,IEN)) Q:IEN=""  D
"RTN","GMTSONE",7,0)
 . S DIC="^ONCO(165.5,",DR="3;20;22;24;29;30;37.1;37.2;37.3;38;85;86;87;88;58.1;58.3;58.2;50;51.2;51;442;125;127;128;53.2;53;54.2;54;55.2;55;346;560;91;58;75;76;77;2000",DA=IEN D EN^DIQ1
"RTN","GMTSONE",8,0)
DISPLAY ; Display extracted data
"RTN","GMTSONE",9,0)
 S IEN=0 F CNT=1:1 S IEN=$O(^UTILITY("DIQ1",$J,165.5,IEN)) Q:IEN=""  D
"RTN","GMTSONE",10,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",11,0)
 . W " #",CNT," Cancer Identification"
"RTN","GMTSONE",12,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",13,0)
 . W !," ------------------------"
"RTN","GMTSONE",14,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",15,0)
 . W:$D(^UTILITY("DIQ1",$J,165.5,IEN,2000)) !," Division...................: ",^UTILITY("DIQ1",$J,165.5,IEN,2000)
"RTN","GMTSONE",16,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",17,0)
 . W !," Date Dx....................: ",^UTILITY("DIQ1",$J,165.5,IEN,3)
"RTN","GMTSONE",18,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",19,0)
 . W !," ICDO-Topography............: ",^UTILITY("DIQ1",$J,165.5,IEN,20)
"RTN","GMTSONE",20,0)
 . I ^UTILITY("DIQ1",$J,165.5,IEN,91)'="Complete" D  Q
"RTN","GMTSONE",21,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",22,0)
 . . W !," Abstract Status............: ",^UTILITY("DIQ1",$J,165.5,IEN,91)
"RTN","GMTSONE",23,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",24,0)
 . . W !!
"RTN","GMTSONE",25,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",26,0)
 . W !," Histology..................: ",^UTILITY("DIQ1",$J,165.5,IEN,22)
"RTN","GMTSONE",27,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",28,0)
 . W !," Grade/Differentiation......: ",^UTILITY("DIQ1",$J,165.5,IEN,24)
"RTN","GMTSONE",29,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",30,0)
 . W !
"RTN","GMTSONE",31,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",32,0)
 . W !," #",CNT," Stage of Disease at Diagnosis"
"RTN","GMTSONE",33,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",34,0)
 . W !," --------------------------------"
"RTN","GMTSONE",35,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",36,0)
 . W !," Size of Tumor..............: ",^UTILITY("DIQ1",$J,165.5,IEN,29)
"RTN","GMTSONE",37,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",38,0)
 . W !," Clincial T.................: ",^UTILITY("DIQ1",$J,165.5,IEN,37.1)
"RTN","GMTSONE",39,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",40,0)
 . W !," Clincial N.................: ",^UTILITY("DIQ1",$J,165.5,IEN,37.2)
"RTN","GMTSONE",41,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",42,0)
 . W !," Clincial M.................: ",^UTILITY("DIQ1",$J,165.5,IEN,37.3)
"RTN","GMTSONE",43,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",44,0)
 . W !," Clinical Stage Group.......: ",^UTILITY("DIQ1",$J,165.5,IEN,38)
"RTN","GMTSONE",45,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",46,0)
 . W !," Pathologic T...............: ",^UTILITY("DIQ1",$J,165.5,IEN,85)
"RTN","GMTSONE",47,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",48,0)
 . W !," Pathologic N...............: ",^UTILITY("DIQ1",$J,165.5,IEN,86)
"RTN","GMTSONE",49,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",50,0)
 . W !," Pathologic M...............: ",^UTILITY("DIQ1",$J,165.5,IEN,87)
"RTN","GMTSONE",51,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",52,0)
 . W !," Pathologic Stage Group.....: ",^UTILITY("DIQ1",$J,165.5,IEN,88)
"RTN","GMTSONE",53,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",54,0)
 . W !
"RTN","GMTSONE",55,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",56,0)
 . W !," #",CNT," First Course of Treatment"
"RTN","GMTSONE",57,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",58,0)
 . W !," ----------------------------"
"RTN","GMTSONE",59,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",60,0)
 . S TXT=^UTILITY("DIQ1",$J,165.5,IEN,58.1) D TXT
"RTN","GMTSONE",61,0)
 . W !," Non cancer-directed surgery: ",^UTILITY("DIQ1",$J,165.5,IEN,58.3)," ",TXT1
"RTN","GMTSONE",62,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",63,0)
 . W:TXT2'="" !,?41,TXT2
"RTN","GMTSONE",64,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",65,0)
 . S TXT=^UTILITY("DIQ1",$J,165.5,IEN,58.2) D TXT
"RTN","GMTSONE",66,0)
 . W !," Surgery of primary site....: ",^UTILITY("DIQ1",$J,165.5,IEN,50)," ",TXT1
"RTN","GMTSONE",67,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",68,0)
 . W:TXT2'="" !,?41,TXT2
"RTN","GMTSONE",69,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",70,0)
 . W !," Reason for no surgery......: ",^UTILITY("DIQ1",$J,165.5,IEN,58)
"RTN","GMTSONE",71,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",72,0)
 . W !," Radiation..................: ",^UTILITY("DIQ1",$J,165.5,IEN,51)," ",^UTILITY("DIQ1",$J,165.5,IEN,51.2)
"RTN","GMTSONE",73,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",74,0)
 . W !," Regional dose:cGy..........: ",^UTILITY("DIQ1",$J,165.5,IEN,442)
"RTN","GMTSONE",75,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",76,0)
 . W !," Radiation treatment volume.: ",^UTILITY("DIQ1",$J,165.5,IEN,125)
"RTN","GMTSONE",77,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",78,0)
 . W !," Intent of radiation........: ",^UTILITY("DIQ1",$J,165.5,IEN,127)
"RTN","GMTSONE",79,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",80,0)
 . W !," Radiation completion status: ",^UTILITY("DIQ1",$J,165.5,IEN,128)
"RTN","GMTSONE",81,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",82,0)
 . W !," Reason for no radiation....: ",^UTILITY("DIQ1",$J,165.5,IEN,75)
"RTN","GMTSONE",83,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",84,0)
 . W !," Chemotherapy...............: ",^UTILITY("DIQ1",$J,165.5,IEN,53)," ",^UTILITY("DIQ1",$J,165.5,IEN,53.2)
"RTN","GMTSONE",85,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",86,0)
 . W !," Reason for no chemotherapy.: ",^UTILITY("DIQ1",$J,165.5,IEN,76)
"RTN","GMTSONE",87,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",88,0)
 . W !," Hormone therapy............: ",^UTILITY("DIQ1",$J,165.5,IEN,54)," ",^UTILITY("DIQ1",$J,165.5,IEN,54.2)
"RTN","GMTSONE",89,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",90,0)
 . W !," Reason for no hormone tx...: ",^UTILITY("DIQ1",$J,165.5,IEN,77)
"RTN","GMTSONE",91,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",92,0)
 . W !," Immunotherapy..............: ",^UTILITY("DIQ1",$J,165.5,IEN,55)," ",^UTILITY("DIQ1",$J,165.5,IEN,55.2)
"RTN","GMTSONE",93,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",94,0)
 . W !," Protocol eligibility status: ",^UTILITY("DIQ1",$J,165.5,IEN,346)
"RTN","GMTSONE",95,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",96,0)
 . W !," Protocol participation.....: ",^UTILITY("DIQ1",$J,165.5,IEN,560)
"RTN","GMTSONE",97,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSONE",98,0)
 . W !!
"RTN","GMTSONE",99,0)
 K ^UTILITY("DIQ1",$J),CNT,DA,DIC,DR,IEN,LINE,LOS,NOP,PTIEN,TXT,TXT1,TXT2
"RTN","GMTSONE",100,0)
 Q
"RTN","GMTSONE",101,0)
TXT S (TXT1,TXT2)="",LOS=$L($G(TXT)) I LOS<40 S TXT1=$G(TXT) Q
"RTN","GMTSONE",102,0)
 S NOP=$L($E($G(TXT),1,40)," ")
"RTN","GMTSONE",103,0)
 S TXT1=$P($G(TXT)," ",1,NOP-1),TXT2=$P($G(TXT)," ",NOP,999)
"RTN","GMTSONE",104,0)
 Q
"RTN","GMTSP35")
0^^B9396128
"RTN","GMTSP35",1,0)
GMTSP35 ; CIO/SLC - Post Install GMTS*2.7*35    ; 04/11/2000
"RTN","GMTSP35",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSP35",3,0)
 ;
"RTN","GMTSP35",4,0)
 Q
"RTN","GMTSP35",5,0)
POST ; Post Install
"RTN","GMTSP35",6,0)
 N GMTSIN,GMTSINST,GMTSTL,GMTSGAF,GMTSVSD,GMTSINST,GMTSBLD
"RTN","GMTSP35",7,0)
 D CI D TO^GMTSXPD3("GAF","3Y",10),TO^GMTSXPD3("VSD","1Y",3)
"RTN","GMTSP35",8,0)
 I +$$ROK("GMTSXPS1")>0 S GMTSINST="",GMTSBLD="GMTS*2.7*35" D SEND^GMTSXPS1
"RTN","GMTSP35",9,0)
 Q
"RTN","GMTSP35",10,0)
CI ; Component Install
"RTN","GMTSP35",11,0)
 N GMTSOK,GMTSIN,GMTSINST,GMTSTL,GMTSINST,GMTSTOT,GMTSBLD,GMTSCPS,GMTSCP,GMTSCI
"RTN","GMTSP35",12,0)
 S GMTSCPS="GAF;VSD",GMTSOK=0,GMTSOK=GMTSOK+$$ROK("GMTSXPD1"),GMTSOK=GMTSOK+$$ROK("GMTSXPD3")
"RTN","GMTSP35",13,0)
 I GMTSOK'=2 D  Q
"RTN","GMTSP35",14,0)
 . W !!," >> Can not install components GAF, and VSD"
"RTN","GMTSP35",15,0)
 . W !,"    Could not find install routines GMTSXPD*"
"RTN","GMTSP35",16,0)
 F GMTSCI=1:1 Q:'$L($P(GMTSCPS,";",GMTSCI))  D
"RTN","GMTSP35",17,0)
 . S GMTSCP=$P(GMTSCPS,";",GMTSCI)
"RTN","GMTSP35",18,0)
 . D ARRAY Q:'$D(GMTSIN)
"RTN","GMTSP35",19,0)
 . S GMTSINST=$$ADD^GMTSXPD1(.GMTSIN)
"RTN","GMTSP35",20,0)
 . S GMTSTOT=+($G(GMTSTOT))+GMTSINST
"RTN","GMTSP35",21,0)
 D:+($G(GMTSTOT))>0 BUILD^GMTSXPD3
"RTN","GMTSP35",22,0)
 Q
"RTN","GMTSP35",23,0)
ROK(X) ; Routine OK
"RTN","GMTSP35",24,0)
 S X=$G(X) Q:'$L(X) 0 Q:$L(X)>8 0 X ^%ZOSF("TEST") Q:$T 1 Q 0
"RTN","GMTSP35",25,0)
ARRAY ; Build Array
"RTN","GMTSP35",26,0)
 K GMTSIN N GMTSI,GMTSTXT,GMTSEX,GMTSFLD,GMTSV,GMTSPDX,GMTSDD,GMTSFLDS
"RTN","GMTSP35",27,0)
 S GMTSPDX=0,GMTSCP=$G(GMTSCP) Q:'$L(GMTSCP)
"RTN","GMTSP35",28,0)
 S GMTSDD(0)="1;.01^2;1^3;2^4;3^5;4^6;5^7;6^8;8^9;9^10;10^11;11^12;12^13;13^14;14"
"RTN","GMTSP35",29,0)
 S GMTSDD(.1)="1.1",GMTSDD(.1,0)="1;.01",GMTSDD(1)="7",GMTSDD(1,0)="1;.01^2;1",GMTSDD(3.5)="3.5",GMTSDD(3.5,0)="1;.01"
"RTN","GMTSP35",30,0)
 S GMTSFLDS=".01;1;2;3;4;5;6;8;9;10;11;12;13;14^1.1;7;3.5"
"RTN","GMTSP35",31,0)
 N GMTSND,GMTSNS,GMTSNI,GMTSNP,GMTSNV,GMTSV,GMTSTR
"RTN","GMTSP35",32,0)
 F GMTSI=1:1 D  Q:'$L(GMTSTXT)
"RTN","GMTSP35",33,0)
 . S GMTSTXT="",GMTSEX="S GMTSTXT=$T("_GMTSCP_"+"_GMTSI_")"
"RTN","GMTSP35",34,0)
 . X GMTSEX S:$L(GMTSTXT,";")'>3 GMTSTXT="" Q:'$L(GMTSTXT)
"RTN","GMTSP35",35,0)
 . S GMTSND=$P(GMTSTXT,";",2),GMTSNS=$P(GMTSTXT,";",3)
"RTN","GMTSP35",36,0)
 . S GMTSNI=$P(GMTSTXT,";",4),GMTSNV=$P(GMTSTXT,";",5,299)
"RTN","GMTSP35",37,0)
 . S:GMTSND="PDX"&(GMTSNV=1) GMTSPDX=1 Q:GMTSND="PDX"
"RTN","GMTSP35",38,0)
 . S:GMTSND="IEN"&(+($G(GMTSNV))>0) GMTSIN(0)=+($G(GMTSNV)) Q:GMTSND="IEN"
"RTN","GMTSP35",39,0)
 . F GMTSNP=1:1:$L(GMTSNV,"^") D
"RTN","GMTSP35",40,0)
 . . S GMTSV=$P(GMTSNV,"^",GMTSNP) Q:'$L(GMTSV)
"RTN","GMTSP35",41,0)
 . . S GMTSTR=$P($G(GMTSDD(GMTSND)),"^",GMTSNP),GMTSFLD=$P(GMTSTR,";",2)
"RTN","GMTSP35",42,0)
 . . S:$L(GMTSNS) GMTSTR=$P($G(GMTSDD(GMTSND,GMTSNS)),"^",GMTSNP),GMTSFLD=$G(GMTSDD(GMTSND))
"RTN","GMTSP35",43,0)
 . . S:GMTSNI'>0 GMTSIN(GMTSFLD)=GMTSV
"RTN","GMTSP35",44,0)
 . . S:GMTSNI>0 GMTSIN(GMTSFLD,GMTSNI)=GMTSV,GMTSIN(GMTSFLD)=+($G(GMTSIN(GMTSFLD)))+1
"RTN","GMTSP35",45,0)
 S:GMTSPDX GMTSIN("PDX")=1 F GMTSI=1:1 Q:'$L($P($P(GMTSFLDS,"^",1),";",GMTSI))  D
"RTN","GMTSP35",46,0)
 . S GMTSFLD=$P($P(GMTSFLDS,"^",1),";",GMTSI) S:$L(GMTSFLD)&('$D(GMTSIN(GMTSFLD))) GMTSIN(GMTSFLD)=""
"RTN","GMTSP35",47,0)
 F GMTSI=1:1 Q:'$L($P($P(GMTSFLDS,"^",2),";",GMTSI))  D
"RTN","GMTSP35",48,0)
 . S GMTSFLD=$P($P(GMTSFLDS,"^",2),";",GMTSI) S:$L(GMTSFLD)&('$D(GMTSIN(GMTSFLD))) GMTSIN(GMTSFLD)=0
"RTN","GMTSP35",49,0)
 Q
"RTN","GMTSP35",50,0)
 ;
"RTN","GMTSP35",51,0)
GAF ; Global Assess Funct
"RTN","GMTSP35",52,0)
 ;IEN;;;238
"RTN","GMTSP35",53,0)
 ;0;;;GLOBAL ASSESSMENT FUNCTIONING^EN;GMTSGAF^Y^GAF^Y^^^^Global Assess Funct^^^^YS
"RTN","GMTSP35",54,0)
 ;.1;0;1;GAFHX;YSGAFAPI
"RTN","GMTSP35",55,0)
 ;3.5;0;1;This component displays the GAF score taken from the Global Assessment
"RTN","GMTSP35",56,0)
 ;3.5;0;2;Functioning scale to evaluate the psychological,social, and occupational
"RTN","GMTSP35",57,0)
 ;3.5;0;3;functioning on a hypothetical continuum of mental health/illness.  Also
"RTN","GMTSP35",58,0)
 ;3.5;0;4;displayed is the date of the assessment and the name of the health care
"RTN","GMTSP35",59,0)
 ;3.5;0;5;professional who provided the assessment.
"RTN","GMTSP35",60,0)
 ;PDX;;;1
"RTN","GMTSP35",61,0)
 ;
"RTN","GMTSP35",62,0)
VSD ; Detailed Vitals
"RTN","GMTSP35",63,0)
 ;IEN;;;237
"RTN","GMTSP35",64,0)
 ;0;;;VITAL SIGNS DETAILED DISPLAY^EN;GMTSVSD^Y^VSD^Y^^^^Detailed Vitals^^^^GMRV
"RTN","GMTSP35",65,0)
 ;.1;0;1;EN1;GMRVUT0
"RTN","GMTSP35",66,0)
 ;3.5;0;1;This component contains vital measurements extracted from the Vital Signs
"RTN","GMTSP35",67,0)
 ;3.5;0;2;module, and differs from other Health Summary Vital Signs displays by
"RTN","GMTSP35",68,0)
 ;3.5;0;3;including the Vital Signs Qualifiers (sitting,standing, left arm, etc.)
"RTN","GMTSP35",69,0)
 ;3.5;0;4;with the vitals measurement.  Time and maximum occurrence limits apply.
"RTN","GMTSP35",70,0)
 ;3.5;0;5;Data presented includes measurement date and time, temperature, blood
"RTN","GMTSP35",71,0)
 ;3.5;0;6;pressure, pulse, height, weight, respiratory rate,CVP, PO2, circumference
"RTN","GMTSP35",72,0)
 ;3.5;0;7;and girth, and pain.
"RTN","GMTSP35",73,0)
 ;PDX;;;1
"RTN","GMTSP35",74,0)
 ;
"RTN","GMTSPLST")
0^12^B26965445
"RTN","GMTSPLST",1,0)
GMTSPLST ; SLC/JER,KER - Problem List ; 04/11/2000
"RTN","GMTSPLST",2,0)
 ;;2.7;Health Summary;**28,35**;Oct 20, 1995
"RTN","GMTSPLST",3,0)
 ;
"RTN","GMTSPLST",4,0)
ACTIVE ; Get Active Problems
"RTN","GMTSPLST",5,0)
 N STATUS S STATUS="A" D MAIN Q
"RTN","GMTSPLST",6,0)
INACT ; Get Inactive Problems
"RTN","GMTSPLST",7,0)
 N STATUS S STATUS="I" D MAIN Q
"RTN","GMTSPLST",8,0)
ALL ; Get All Problems (Active and Inactive)
"RTN","GMTSPLST",9,0)
 N STATUS S STATUS="ALL" D MAIN Q
"RTN","GMTSPLST",10,0)
MAIN ; Driver
"RTN","GMTSPLST",11,0)
 D GETLIST^GMPLHS(DFN,STATUS) Q:'$D(^TMP("GMPLHS",$J))  D SUBHDR D WRT K ^TMP("GMPLHS",$J) Q
"RTN","GMTSPLST",12,0)
 ;                    
"RTN","GMTSPLST",13,0)
WRT ;   Writes Problem List Component,X
"RTN","GMTSPLST",14,0)
 N GMREC,GMTSICL,GMTAB,LINE1,DIWL
"RTN","GMTSPLST",15,0)
 S GMTSICL=32 ;       GMTSICL # of blank columns for problem
"RTN","GMTSPLST",16,0)
 S DIWL=0 ;       DIWL used in TXTFMT call
"RTN","GMTSPLST",17,0)
 S GMTAB=0 ;       GMTAB used to offset data after 1st line
"RTN","GMTSPLST",18,0)
 S GMREC=0
"RTN","GMTSPLST",19,0)
 F  S GMREC=$O(^TMP("GMPLHS",$J,GMREC)) Q:GMREC'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPLST",20,0)
 . N GMNODE,GMDIAG,GMDIAC,GMDIAT,GMDIAS,LASTMDT,STAT,ONSETDT,PROV,SERV
"RTN","GMTSPLST",21,0)
 . N RESDT,NARR,GMICD,GMDSM,GMDSMS,CODE,LEXI,LEX,PLIFN,ADDINFO,GMTSX,X
"RTN","GMTSPLST",22,0)
 . S GMNODE=$G(^TMP("GMPLHS",$J,GMREC,0))
"RTN","GMTSPLST",23,0)
 . Q:GMNODE']""
"RTN","GMTSPLST",24,0)
 . S GMDIAG=$P(GMNODE,U),LASTMDT=$P(GMNODE,U,2),STAT=$P(GMNODE,U,5)
"RTN","GMTSPLST",25,0)
 . S X=LASTMDT D REGDT4^GMTSU S LASTMDT=X
"RTN","GMTSPLST",26,0)
 . S ONSETDT=$P(GMNODE,U,6),PROV=$P(GMNODE,U,7)
"RTN","GMTSPLST",27,0)
 . S RESDT=$P(GMNODE,U,10),GMICD=""
"RTN","GMTSPLST",28,0)
 . I STAT="A",+ONSETDT S X=ONSETDT D REGDT4^GMTSU S ADDINFO="Onset "_X
"RTN","GMTSPLST",29,0)
 . I STAT="I",+RESDT S X=RESDT D REGDT4^GMTSU S ADDINFO="Resolved "_X
"RTN","GMTSPLST",30,0)
 . S NARR=""
"RTN","GMTSPLST",31,0)
 . S:$G(GMPXNARR)'="N" NARR=$G(^TMP("GMPLHS",$J,GMREC,"N"))
"RTN","GMTSPLST",32,0)
 . I $G(GMPXICDF)]"",$G(GMPXICDF)'="N",GMDIAG]"" D
"RTN","GMTSPLST",33,0)
 . . D GETICDDX^GMTSPXU1(.GMDIAG,$G(GMPXICDF)) S GMICD=GMDIAG
"RTN","GMTSPLST",34,0)
 . S GMDIAC=$P($G(GMICD),"-",1),GMDIAT=$P($G(GMICD),"-",2,299)
"RTN","GMTSPLST",35,0)
 . ;
"RTN","GMTSPLST",36,0)
 . S LEX=$G(^TMP("GMPLHS",$J,GMREC,"L"))
"RTN","GMTSPLST",37,0)
 . S LEXI=+LEX,LEX=$P(LEX,"^",2) S:$$UP(LEX)["UNRESOLVED"!(+LEXI'>1) (LEXI,LEX)=""
"RTN","GMTSPLST",38,0)
 . S (CODE,GMDIAS,GMDSMS,GMDSM)="" S:+LEXI>0 GMDSM=$$DSMONE^LEXU(+LEXI)
"RTN","GMTSPLST",39,0)
 . S:GMDIAC["799.9" GMDSM=""
"RTN","GMTSPLST",40,0)
 . S:$L(GMDSM)>2&(GMDSM'[".") GMDSM=GMDSM_"."
"RTN","GMTSPLST",41,0)
 . S:$L(GMDIAC) GMDIAS="(ICD "_GMDIAC_")"
"RTN","GMTSPLST",42,0)
 . S:$L(GMDSM) GMDSMS="(DSM "_GMDSM_")"
"RTN","GMTSPLST",43,0)
 . S:$L(GMDIAC)&($L(GMDSM))&(GMDIAC=GMDSM) GMDIAS="(ICD/DSM "_GMDIAC_")",GMDSMS=""
"RTN","GMTSPLST",44,0)
 . S:$L(GMDIAS) CODE=GMDIAS S:$L(GMDSMS) CODE=CODE_" "_GMDSMS F  Q:$E(CODE,1)'=" "  S CODE=$E(CODE,2,$L(CODE))
"RTN","GMTSPLST",45,0)
 . S:$L(LEX)&($L(CODE)) LEX=LEX_" "_CODE
"RTN","GMTSPLST",46,0)
 . S:$L(GMDIAT)&($L(CODE)) GMICD=GMDIAT_" "_CODE
"RTN","GMTSPLST",47,0)
 . ; Unresolved or Unspecified
"RTN","GMTSPLST",48,0)
 . I GMDIAC["799.9",$L($G(NARR)) D
"RTN","GMTSPLST",49,0)
 . . N UNARR S UNARR=$$UP(NARR)
"RTN","GMTSPLST",50,0)
 . . I UNARR["UNKNOWN AND UNSPECIFIED"!(UNARR["UNKNOWN OR UNSPECIFIED")!(UNARR["MORBIDITY OR MORTALITY") D  Q
"RTN","GMTSPLST",51,0)
 . . . S GMICD=GMDIAT_" "_CODE,NARR=""
"RTN","GMTSPLST",52,0)
 . . S GMICD=$$UP($E(NARR,1))_$E(NARR,2,$L(NARR))_" "_CODE
"RTN","GMTSPLST",53,0)
 . . S:$L(LEX) GMICD=LEX S NARR=""
"RTN","GMTSPLST",54,0)
 . ; Specified by Lexicon
"RTN","GMTSPLST",55,0)
 . I GMDIAC'["799.9",$L($G(LEX)) D
"RTN","GMTSPLST",56,0)
 . . S GMICD=LEX,NARR=""
"RTN","GMTSPLST",57,0)
 . ; Specified by Provider Narrative
"RTN","GMTSPLST",58,0)
 . I GMDIAC'["799.9",'$L($G(LEX)) D
"RTN","GMTSPLST",59,0)
 . . S:$L(NARR)&($$UP(GMDIAT)'=$$UP(NARR)) GMICD=GMICD_"; "_NARR S NARR=""
"RTN","GMTSPLST",60,0)
 . S:$L(GMICD) GMICD=GMICD_$S($G(ADDINFO)]"":", "_ADDINFO,1:""),NARR=""
"RTN","GMTSPLST",61,0)
 . S GMICD=$$RF(GMICD) D TXTFMT^GMTSPXU1(GMICD,$G(NARR),GMTSICL,GMTAB,DIWL)
"RTN","GMTSPLST",62,0)
 . I '$D(^UTILITY($J,"W")) Q
"RTN","GMTSPLST",63,0)
 . S GMTSX=0,LINE1=1
"RTN","GMTSPLST",64,0)
 . F  S GMTSX=$O(^UTILITY($J,"W",DIWL,GMTSX)) Q:GMTSX'>0!$D(GMTSQIT)  D
"RTN","GMTSPLST",65,0)
 . . D:LINE1 L1 D:'LINE1 LN S LINE1=0
"RTN","GMTSPLST",66,0)
 . D DC
"RTN","GMTSPLST",67,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG SUBHDR2 W !
"RTN","GMTSPLST",68,0)
 Q
"RTN","GMTSPLST",69,0)
L1 ;     Line #1 Problem, date, provider
"RTN","GMTSPLST",70,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG SUBHDR2 W:STATUS="ALL" STAT W ?3,$G(^UTILITY($J,"W",DIWL,GMTSX,0)),?53,LASTMDT,?65,$E(PROV,1,15),! Q
"RTN","GMTSPLST",71,0)
LN ;     Line >1 Problem (other)
"RTN","GMTSPLST",72,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG SUBHDR2 W ?3,$G(^UTILITY($J,"W",DIWL,GMTSX,0)),! Q
"RTN","GMTSPLST",73,0)
 ;                    
"RTN","GMTSPLST",74,0)
DC ;   Comments are displayed if there are any
"RTN","GMTSPLST",75,0)
 N LOC,GMR,NODE,DATE,X,UCNT,CNT,CMT,T,I S LOC="",CNT=0
"RTN","GMTSPLST",76,0)
 F  S LOC=$O(^TMP("GMPLHS",$J,GMREC,"C",LOC)) Q:LOC']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPLST",77,0)
 . S (CNT,UCNT)=0 S:+($O(^TMP("GMPLHS",$J,GMREC,"C",LOC," "),-1))>1 UCNT=1
"RTN","GMTSPLST",78,0)
 . S GMR=0 F  S GMR=$O(^TMP("GMPLHS",$J,GMREC,"C",LOC,GMR)) Q:+GMR'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPLST",79,0)
 . . S NODE=$G(^TMP("GMPLHS",$J,GMREC,"C",LOC,GMR,0)) Q:NODE']""
"RTN","GMTSPLST",80,0)
 . . S CMT=$P(NODE,U) I $L($G(CMT)) D LC
"RTN","GMTSPLST",81,0)
 Q
"RTN","GMTSPLST",82,0)
LC ;     List Comments (unnumbered and numbered)
"RTN","GMTSPLST",83,0)
 S CNT=CNT+1 K ^UTILITY($J,"W") D:UCNT CF(CNT,CMT) D:'UCNT CF(0,CMT)
"RTN","GMTSPLST",84,0)
 I $D(^UTILITY($J,"W",0)) N I,T S I=0 F  S I=$O(^UTILITY($J,"W",0,I)) Q:+I=0  D
"RTN","GMTSPLST",85,0)
 . S T=$$RT($G(^UTILITY($J,"W",0,I,0))) Q:'$L(T)  D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG SUBHDR2 W:I=1 ?3 W:I>1 ?7 W $G(T),!
"RTN","GMTSPLST",86,0)
 Q
"RTN","GMTSPLST",87,0)
CF(GMC,GMT) ;     Formats GMC (count) and GMT (text) together
"RTN","GMTSPLST",88,0)
 S GMC=+($G(GMC)),GMT=$G(GMT) Q:'$L(GMT)  S GMT=$$LD(GMT)
"RTN","GMTSPLST",89,0)
 N GMCOL,DIWL,DIWR,DIWF,X S GMCOL=34,DIWL=0,DIWR=80-(GMCOL) K ^UTILITY($J,"W")
"RTN","GMTSPLST",90,0)
 S:+($G(GMC))=0 X="    "_GMT S:+($G(GMC))>0 X=$J(GMC,2)_". "_GMT D:$G(X)]"" ^DIWP
"RTN","GMTSPLST",91,0)
 Q
"RTN","GMTSPLST",92,0)
SUBHDR ; Subheader for Problem List Component
"RTN","GMTSPLST",93,0)
 N NUM,TOT,NODE S NODE=$G(^TMP("GMPLHS",$J,STATUS,0)) S NUM=$P(NODE,U),TOT=$P(NODE,U,2)
"RTN","GMTSPLST",94,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S:TOT>NUM NUM=NUM_" of "_TOT W ?50,NUM_$S(STATUS="A":" Active",STATUS="I":" Inactive",1:"")_" Problems",!
"RTN","GMTSPLST",95,0)
SUBHDR2 ; Will be written on new pages
"RTN","GMTSPLST",96,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:STATUS="ALL" "ST" W ?3,"PROBLEM",?53,"LAST MOD",?65,"PROVIDER",! Q
"RTN","GMTSPLST",97,0)
 ;                    
"RTN","GMTSPLST",98,0)
RF(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSPLST",99,0)
 F  Q:$E(X,1)'=";"  S X=$E(X,2,$L(X))
"RTN","GMTSPLST",100,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSPLST",101,0)
 S X=$$LD(X) Q X
"RTN","GMTSPLST",102,0)
LD(X) ; Leading Character
"RTN","GMTSPLST",103,0)
 Q $TR($E(X,1),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(X,2,$L(X))
"RTN","GMTSPLST",104,0)
RT(X) ; Right Space Trim
"RTN","GMTSPLST",105,0)
 S X=$G(X) F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSPLST",106,0)
 Q X
"RTN","GMTSPLST",107,0)
UP(X) Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSPN")
0^9^B45112042
"RTN","GMTSPN",1,0)
GMTSPN ; SLC/KER - Progress Note                     ; 04/11/2000
"RTN","GMTSPN",2,0)
 ;;2.7;Health Summary;**12,28,33,35**;Oct 20, 1995
"RTN","GMTSPN",3,0)
 ;
"RTN","GMTSPN",4,0)
PN ;Progress Note Health Summary Component
"RTN","GMTSPN",5,0)
 ;By Patient Name, Date and or Occurrence
"RTN","GMTSPN",6,0)
 N COSGEDBY,SIGNEDBY,PN,TIUSTAT,TIUTYPE,DIC,TIUFPRIV,TIUXREF S TIUFPRIV=1
"RTN","GMTSPN",7,0)
 S TIUSTAT="ALL",TIUXREF="""APT"""
"RTN","GMTSPN",8,0)
 N X,Y S X="PROGRESS NOTES",DIC="^TIU(8925.1,",DIC(0)="X",DIC("S")="I $P($G(^(0)),U,4)=""CL""" D ^DIC K DIC("S") S:Y>0 TIUTYPE=+Y
"RTN","GMTSPN",9,0)
 D MAIN
"RTN","GMTSPN",10,0)
 Q
"RTN","GMTSPN",11,0)
MAIN ; Control branching
"RTN","GMTSPN",12,0)
 N GMTSI,GMTSJ,GMTSCNT,GMTSREC,PN,DIC
"RTN","GMTSPN",13,0)
 K ^TMP("TIU",$J) D EXTIU(DFN,TIUTYPE,GMTS1,GMTS2,GMTSNDM,1)
"RTN","GMTSPN",14,0)
 I '$D(^TMP("TIU",$J)) Q
"RTN","GMTSPN",15,0)
 S GMTSI=0
"RTN","GMTSPN",16,0)
 F  S GMTSI=$O(^TMP("TIU",$J,GMTSI)) Q:+GMTSI'>0!$D(GMTSQIT)  D
"RTN","GMTSPN",17,0)
 . S GMTSJ=0
"RTN","GMTSPN",18,0)
 . F  S GMTSJ=$O(^TMP("TIU",$J,GMTSI,GMTSJ)) Q:+GMTSJ'>0!$D(GMTSQIT)  D
"RTN","GMTSPN",19,0)
 . . N PN
"RTN","GMTSPN",20,0)
 . . D WRTREC(GMTSI,GMTSJ)
"RTN","GMTSPN",21,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,"PROBLEM")) D WRTPROB(GMTSI,GMTSJ)
"RTN","GMTSPN",22,0)
 . . D WRTTEXT(GMTSI,GMTSJ)
"RTN","GMTSPN",23,0)
 . . D WRTSIG(GMTSI,GMTSJ)
"RTN","GMTSPN",24,0)
 . . I +$G(^TMP("TIU",$J,GMTSI,GMTSJ,1601,"I")) D AMENDMNT^GMTSPN1(GMTSI,GMTSJ)
"RTN","GMTSPN",25,0)
 . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD")) D ADDEND^GMTSPN1(GMTSI,GMTSJ)
"RTN","GMTSPN",26,0)
 K ^TMP("TIU",$J)
"RTN","GMTSPN",27,0)
 Q
"RTN","GMTSPN",28,0)
WRTREC(GMTSI,GMTSJ) ; Writes record header
"RTN","GMTSPN",29,0)
VARI ;Sets variables
"RTN","GMTSPN",30,0)
 N GMTSXTRA
"RTN","GMTSPN",31,0)
 S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPN",32,0)
 S PN("DATE")=^TMP("TIU",$J,GMTSI,GMTSJ,1301,"I")
"RTN","GMTSPN",33,0)
 I PN("DATE")]"" S PN("DATE")=$$NDT(PN("DATE"))
"RTN","GMTSPN",34,0)
 S PN("DOCTYPE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,.01,"E"))
"RTN","GMTSPN",35,0)
 S PN("AUTHOR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"E"))
"RTN","GMTSPN",36,0)
 S PN("EXPSIGNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1204,"E"))
"RTN","GMTSPN",37,0)
 S PN("LOC")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1205,"E"))
"RTN","GMTSPN",38,0)
 S PN("EXPCOSNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1208,"E"))
"RTN","GMTSPN",39,0)
 S PN("SIGDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1501,"I"))
"RTN","GMTSPN",40,0)
 I PN("SIGDT")]"" S PN("SIGDT")=$$NDT(PN("SIGDT"))
"RTN","GMTSPN",41,0)
 S SIGNEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1502,"I"))
"RTN","GMTSPN",42,0)
 S PN("SIGBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1503,"E"))
"RTN","GMTSPN",43,0)
 S PN("STITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1504,"E"))
"RTN","GMTSPN",44,0)
 S PN("COSDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1507,"I"))
"RTN","GMTSPN",45,0)
 I PN("COSDT")]"" S PN("COSDT")=$$NDT(PN("COSDT"))
"RTN","GMTSPN",46,0)
 S COSGEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1508,"I"))
"RTN","GMTSPN",47,0)
 S PN("COBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1509,"E"))
"RTN","GMTSPN",48,0)
 S PN("COTITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1510,"E"))
"RTN","GMTSPN",49,0)
 S PN("SUBJ")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1701,"E"))
"RTN","GMTSPN",50,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,1505,"I"))="C" D
"RTN","GMTSPN",51,0)
 . S PN("SCHART")="Signed on Chart",PN("SCHARTBY")="."
"RTN","GMTSPN",52,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1512,"E"))'="" PN("SCHARTBY")=" by:      "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,1512,"E"))
"RTN","GMTSPN",53,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,1511,"I"))="C" D
"RTN","GMTSPN",54,0)
 . S PN("COCHART")="Cosigned on Chart",PN("COCHARTBY")="."
"RTN","GMTSPN",55,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1513,"E"))'="" PN("COCHARTBY")=" by:  "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,1513,"E"))
"RTN","GMTSPN",56,0)
 S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1202,"I"))'=$G(^TMP("TIU",$J,GMTSI,GMTSJ,1502,"I")) PN("AUTH")="AUTHOR:  "_PN("AUTHOR")
"RTN","GMTSPN",57,0)
WRITE ;Header lines
"RTN","GMTSPN",58,0)
 I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",59,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W PN("DATE"),?21,"Title:  ",$$UP^XLFSTR(PN("DOCTYPE"))
"RTN","GMTSPN",60,0)
 I $D(PN("AUTH")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?21,PN("AUTH")
"RTN","GMTSPN",61,0)
 I PN("SUBJ")'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",PN("SUBJ")
"RTN","GMTSPN",62,0)
 Q
"RTN","GMTSPN",63,0)
WRTTEXT(GMTSI,GMTSJ) ; Write Progress Note text
"RTN","GMTSPN",64,0)
 N GMTSK S GMTSK=0
"RTN","GMTSPN",65,0)
 F  S GMTSK=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"TEXT",GMTSK)) Q:+GMTSK'>0  D
"RTN","GMTSPN",66,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$G(^TMP("TIU",$J,GMTSI,GMTSJ,"TEXT",GMTSK,0))
"RTN","GMTSPN",67,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",68,0)
 Q
"RTN","GMTSPN",69,0)
WRTSIG(GMTSI,GMTSJ) ;Writes Signatures 
"RTN","GMTSPN",70,0)
 I ^TMP("TIU",$J,GMTSI,GMTSJ,1501,"I")="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"**DRAFT COPY - DRAFT COPY -- ABOVE NOTE IS UNSIGNED --"
"RTN","GMTSPN",71,0)
 I  W " DRAFT COPY - DRAFT COPY**"
"RTN","GMTSPN",72,0)
 I $D(PN("SCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J(PN("SCHART"),24),PN("SCHARTBY")
"RTN","GMTSPN",73,0)
 I PN("SIGBLK")'="" D
"RTN","GMTSPN",74,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Signed by:",24)
"RTN","GMTSPN",75,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1505,"I"))="E" " /es/ "
"RTN","GMTSPN",76,0)
 . W ?30,PN("SIGBLK")
"RTN","GMTSPN",77,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,PN("STITLE")
"RTN","GMTSPN",78,0)
 . I $L(PN("STITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSPN",79,0)
 . E  W:$L(PN("STITLE"))>0 " "
"RTN","GMTSPN",80,0)
 . W $G(PN("SIGDT"))
"RTN","GMTSPN",81,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",82,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.137)
"RTN","GMTSPN",83,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.138)
"RTN","GMTSPN",84,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,.05,"E"))="UNCOSIGNED" D
"RTN","GMTSPN",85,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?30,"** REQUIRES COSIGNATURE **"
"RTN","GMTSPN",86,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",87,0)
 ;
"RTN","GMTSPN",88,0)
 I $D(PN("COCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J(PN("COCHART"),24),PN("COCHARTBY")
"RTN","GMTSPN",89,0)
 I PN("COBLK")'="" D
"RTN","GMTSPN",90,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Cosigned By:",24)
"RTN","GMTSPN",91,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,1511,"I"))="E" " /es/ " W PN("COBLK")
"RTN","GMTSPN",92,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,PN("COTITLE")
"RTN","GMTSPN",93,0)
 . I $L(PN("COTITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSPN",94,0)
 . E  W:$L(PN("COTITLE"))>0 " "
"RTN","GMTSPN",95,0)
 . W $G(PN("COSDT"))
"RTN","GMTSPN",96,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",97,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.137)
"RTN","GMTSPN",98,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.138)
"RTN","GMTSPN",99,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",100,0)
 I +$O(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",0)) D
"RTN","GMTSPN",101,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Receipt Acknowledged by:",24)
"RTN","GMTSPN",102,0)
 S GMTSXTRA=0
"RTN","GMTSPN",103,0)
 F  S GMTSXTRA=+$O(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA)) Q:+GMTSXTRA'>0  D
"RTN","GMTSPN",104,0)
 . I +$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"DATE"))'>0 D  Q
"RTN","GMTSPN",105,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W ! W "* AWAITING SIGNATURE *" D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",106,0)
 . I +GMTSXTRA>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",107,0)
 . W ?22," /es/ ",$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"NAME"))
"RTN","GMTSPN",108,0)
 . W !?25,$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"TITLE"))
"RTN","GMTSPN",109,0)
 . I $L($G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"TITLE")))>51 D
"RTN","GMTSPN",110,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?28
"RTN","GMTSPN",111,0)
 . E  W:$L($G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"TITLE")))>0 " "
"RTN","GMTSPN",112,0)
 . W $$NDT($G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"DATE")))
"RTN","GMTSPN",113,0)
 . N GMTSBPR
"RTN","GMTSPN",114,0)
 . S GMTSBPR=$$GET1^DIQ(200,+$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"EXTRA")),.137)_"^"_$$GET1^DIQ(200,+$G(^TMP("TIU",$J,GMTSI,GMTSJ,"EXTRASGNR",GMTSXTRA,"EXTRA")),.138)
"RTN","GMTSPN",115,0)
 . I +GMTSBPR D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$P(GMTSBPR,U)
"RTN","GMTSPN",116,0)
 . I +$P(GMTSBPR,U,2) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$P(GMTSBPR,U,2)
"RTN","GMTSPN",117,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",118,0)
 Q
"RTN","GMTSPN",119,0)
WRTPROB(GMTSI,GMTSJ) ;Writes list of problems associated with this document
"RTN","GMTSPN",120,0)
 N GMTSPR
"RTN","GMTSPN",121,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"PROBLEM(S):  "
"RTN","GMTSPN",122,0)
 S GMTSPR=0
"RTN","GMTSPN",123,0)
 F  S GMTSPR=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"PROBLEM",GMTSPR)) Q:+GMTSPR'>0  D
"RTN","GMTSPN",124,0)
 .  D:GMTSPR>1 CKP^GMTSUP Q:$D(GMTSQIT)  W !?15,^TMP("TIU",$J,GMTSI,GMTSJ,"PROBLEM",GMTSPR,0)
"RTN","GMTSPN",125,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN",126,0)
 Q
"RTN","GMTSPN",127,0)
EXTIU(DFN,GMTST,GMTS1,GMTS2,GMTSN,GMTSX) ; Extract Patient/Visit VIA TIU
"RTN","GMTSPN",128,0)
 N GMTSPV S GMTSPV=+($G(GMTSPXGO)) I GMTSPV,$L($T(VISIT^TIULAPIC)) D VISIT^TIULAPIC($G(DFN),$G(GMTST),$G(GMTS1),$G(GMTS2),$G(GMTSN),$G(GMTSX)) Q
"RTN","GMTSPN",129,0)
 D MAIN^TIULAPIC($G(DFN),$G(GMTST),$G(GMTS1),$G(GMTS2),$G(GMTSN),$G(GMTSX))
"RTN","GMTSPN",130,0)
 Q
"RTN","GMTSPN",131,0)
ND(X) S X=$G(X) D REGDT4^GMTSU Q X
"RTN","GMTSPN",132,0)
NDT(X) S X=$G(X) D REGDTM4^GMTSU Q X
"RTN","GMTSPN1")
0^5^B28895017
"RTN","GMTSPN1",1,0)
GMTSPN1 ;SLC/DJP - Progress Note Addenda/Amendment Display ; 04/11/2000
"RTN","GMTSPN1",2,0)
 ;;2.7;Health Summary;**12,35**;Oct 20, 1995
"RTN","GMTSPN1",3,0)
 ;
"RTN","GMTSPN1",4,0)
AMENDMNT(GMTSDT,GMTSK) ;If PN has been amended, next lines are printed
"RTN","GMTSPN1",5,0)
 N GMTSI
"RTN","GMTSPN1",6,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!,^TMP("TIU",$J,GMTSDT,GMTSK,1601,"E"),"  AMENDMENT FILED:"
"RTN","GMTSPN1",7,0)
 I $G(^TMP("TIU",$J,GMTSDT,GMTSK,1603,"E"))'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !!?10 F GMTSI=1:1:$L(^TMP("TIU",$J,GMTSDT,GMTSK,1602,"E")) W "_"
"RTN","GMTSPN1",8,0)
 I $G(^TMP("TIU",$J,GMTSDT,GMTSK,1604,"E"))="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?28,"  /es/ ",^TMP("TIU",$J,GMTSDT,GMTSK,1604,"E")
"RTN","GMTSPN1",9,0)
 I $G(^TMP("TIU",$J,GMTSDT,GMTSK,1605,"E"))="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,^TMP("TIU",$J,GMTSDT,GMTSK,1605,"E")
"RTN","GMTSPN1",10,0)
 Q
"RTN","GMTSPN1",11,0)
 ;
"RTN","GMTSPN1",12,0)
ADDEND(GMTSI,GMTSJ) ;Addenda for Display and Health Summary Component
"RTN","GMTSPN1",13,0)
 S GMTSAD=0
"RTN","GMTSPN1",14,0)
 F  S GMTSAD=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",GMTSAD)) Q:+GMTSAD'>0  D
"RTN","GMTSPN1",15,0)
 . N PN D WRTADD(GMTSI,GMTSJ,GMTSAD),WRTATEXT(GMTSI,GMTSJ,GMTSAD),WRTASIG(GMTSI,GMTSJ,GMTSAD)
"RTN","GMTSPN1",16,0)
 K PN
"RTN","GMTSPN1",17,0)
 Q
"RTN","GMTSPN1",18,0)
 ;
"RTN","GMTSPN1",19,0)
WRTADD(GMTSI,GMTSJ,ADDEND) ;Writes record header for addendum
"RTN","GMTSPN1",20,0)
ADVARI ;Sets variables for addendum
"RTN","GMTSPN1",21,0)
 S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPN1",22,0)
 S PN("DATE")=$$EDT^GMTSU(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1301,"I"))
"RTN","GMTSPN1",23,0)
 S PN("DOCTYPE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,.01,"E"))
"RTN","GMTSPN1",24,0)
 S PN("AUTHOR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1202,"E"))
"RTN","GMTSPN1",25,0)
 S PN("EXPSIGNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1204,"E"))
"RTN","GMTSPN1",26,0)
 S PN("LOC")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1205,"E"))
"RTN","GMTSPN1",27,0)
 S PN("EXPCOSNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1208,"E"))
"RTN","GMTSPN1",28,0)
 S:^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1307,"I")'="" PN("DDATE")=$$ED^GMTSU(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1307,"I"))
"RTN","GMTSPN1",29,0)
 S:^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1501,"I")'="" PN("SIGNDATE")=$$ED^GMTSU(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1501,"I"))
"RTN","GMTSPN1",30,0)
 S SIGNEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1502,"I"))
"RTN","GMTSPN1",31,0)
 S PN("SIGNBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1503,"E"))
"RTN","GMTSPN1",32,0)
 S PN("STITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1504,"E"))
"RTN","GMTSPN1",33,0)
 S PN("SIGDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1501,"I"))
"RTN","GMTSPN1",34,0)
 I PN("SIGDT")]"" S PN("SIGDT")=$$EDT^GMTSU(PN("SIGDT"))
"RTN","GMTSPN1",35,0)
 S COSGEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1508,"I"))
"RTN","GMTSPN1",36,0)
 S PN("COBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1509,"E"))
"RTN","GMTSPN1",37,0)
 S PN("COTITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1510,"E"))
"RTN","GMTSPN1",38,0)
 S PN("COSDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1507,"I"))
"RTN","GMTSPN1",39,0)
 I PN("COSDT")]"" S PN("COSDT")=$$EDT^GMTSU(PN("COSDT"))
"RTN","GMTSPN1",40,0)
 S PN("SUBJ")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1701,"E"))
"RTN","GMTSPN1",41,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1505,"I"))="C" D
"RTN","GMTSPN1",42,0)
 . S PN("SCHART")="Signed on Chart",PN("SCHARTBY")="."
"RTN","GMTSPN1",43,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1512,"E"))'="" PN("SCHARTBY")=" by:  "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1512,"E"))
"RTN","GMTSPN1",44,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1511,"I"))="C" D
"RTN","GMTSPN1",45,0)
 . S PN("COCHART")="Cosigned on Chart",PN("COCHARTBY")="."
"RTN","GMTSPN1",46,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1513,"E"))'="" PN("COCHARTBY")=" by:  "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1513,"E"))
"RTN","GMTSPN1",47,0)
 S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1202,"I"))'=$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1502,"I")) PN("AUTH")="AUTHOR:  "_PN("AUTHOR")
"RTN","GMTSPN1",48,0)
WRITEAD ;Header lines for Addendum
"RTN","GMTSPN1",49,0)
 I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",50,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W PN("DATE"),?21,"Title:  ",$$UP^XLFSTR(PN("DOCTYPE"))
"RTN","GMTSPN1",51,0)
 I $D(PN("AUTH")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?21,PN("AUTH")
"RTN","GMTSPN1",52,0)
 I PN("SUBJ")'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?21,"Subject:  ",PN("SUBJ") D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",53,0)
 Q
"RTN","GMTSPN1",54,0)
WRTATEXT(GMTSI,GMTSJ,ADDEND) ; Write Progress Note Addenda text
"RTN","GMTSPN1",55,0)
 N GMTSK S GMTSK=0
"RTN","GMTSPN1",56,0)
 F  S GMTSK=$O(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,"TEXT",GMTSK)) Q:+GMTSK'>0  D
"RTN","GMTSPN1",57,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,"TEXT",GMTSK,0))
"RTN","GMTSPN1",58,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",59,0)
 Q
"RTN","GMTSPN1",60,0)
WRTASIG(GMTSI,GMTSJ,ADDEND) ; Writes Addenda Signatures 
"RTN","GMTSPN1",61,0)
 I ^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1501,"I")="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"**DRAFT COPY - DRAFT COPY -- ABOVE ADDENDUM IS UNSIGNED --"
"RTN","GMTSPN1",62,0)
 I  W " DRAFT COPY - DRAFT COPY**"
"RTN","GMTSPN1",63,0)
 I $D(PN("SCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J(PN("SCHART"),24),PN("SCHARTBY")
"RTN","GMTSPN1",64,0)
 I $G(PN("SIGNBLK"))'="" D
"RTN","GMTSPN1",65,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Signed by:",24)
"RTN","GMTSPN1",66,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1505,"I"))="E" " /es/ "
"RTN","GMTSPN1",67,0)
 . W ?30,PN("SIGNBLK")
"RTN","GMTSPN1",68,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,PN("STITLE")
"RTN","GMTSPN1",69,0)
 . I $L(PN("STITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSPN1",70,0)
 . E  W:$L(PN("STITLE"))>0 " "
"RTN","GMTSPN1",71,0)
 . W $G(PN("SIGDT"))
"RTN","GMTSPN1",72,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",73,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.137)
"RTN","GMTSPN1",74,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.138)
"RTN","GMTSPN1",75,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,.05,"E"))="UNCOSIGNED" D
"RTN","GMTSPN1",76,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27,"** REQUIRES COSIGNATURE **"
"RTN","GMTSPN1",77,0)
 I $D(PN("COCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J(PN("COCHART"),24),PN("COCHARTBY")
"RTN","GMTSPN1",78,0)
 I PN("COBLK")'="" D
"RTN","GMTSPN1",79,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Cosigned By:",24)
"RTN","GMTSPN1",80,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,"ZADD",ADDEND,1511,"I"))="E" " /es/ "
"RTN","GMTSPN1",81,0)
 . W ?30,PN("COBLK")
"RTN","GMTSPN1",82,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,PN("COTITLE")
"RTN","GMTSPN1",83,0)
 . I $L(PN("COTITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSPN1",84,0)
 . E  W:$L(PN("COTITLE")) " "
"RTN","GMTSPN1",85,0)
 . W $G(PN("COSDT"))
"RTN","GMTSPN1",86,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",87,0)
 . I +($$GET1^DIQ(200,+COSGEDBY,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,+COSGEDBY,.137)
"RTN","GMTSPN1",88,0)
 . I +($$GET1^DIQ(200,+COSGEDBY,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$$GET1^DIQ(200,+COSGEDBY,.138)
"RTN","GMTSPN1",89,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPN1",90,0)
 Q
"RTN","GMTSPNS1")
0^6^B30869514
"RTN","GMTSPNS1",1,0)
GMTSPNS1 ;SLC/DJP - Selected PN Addenda/Amendment ; 04/11/2000
"RTN","GMTSPNS1",2,0)
 ;;2.7;Health Summary;**12,35**;Oct 20, 1995
"RTN","GMTSPNS1",3,0)
 ;
"RTN","GMTSPNS1",4,0)
AMENDMNT(GMTSI,GMTSJ,GMTSK) ;If PN has been amended, next lines are printed
"RTN","GMTSPNS1",5,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!,^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1601,"E"),"  AMENDMENT FILED:"
"RTN","GMTSPNS1",6,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1603,"E"))'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !!?10 F TIUI=1:1:$L(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1602,"E")) W "_"
"RTN","GMTSPNS1",7,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1604,"E"))="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?28," /es/ ",^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1604,"E")
"RTN","GMTSPNS1",8,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1605,"E"))="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1605,"E")
"RTN","GMTSPNS1",9,0)
 Q
"RTN","GMTSPNS1",10,0)
 ;
"RTN","GMTSPNS1",11,0)
ADDEND(GMTSI,GMTSJ,GMTSK) ; Display Addenda
"RTN","GMTSPNS1",12,0)
 N GMTSAD
"RTN","GMTSPNS1",13,0)
 S GMTSAD=0
"RTN","GMTSPNS1",14,0)
 F  S GMTSAD=$O(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",GMTSAD)) Q:+GMTSAD'>0  D
"RTN","GMTSPNS1",15,0)
 . N PN
"RTN","GMTSPNS1",16,0)
 . D WRTADD(GMTSI,GMTSJ,GMTSK,GMTSAD)
"RTN","GMTSPNS1",17,0)
 . D WRTATEXT(GMTSI,GMTSJ,GMTSK,GMTSAD)
"RTN","GMTSPNS1",18,0)
 . D WRTASIG(GMTSI,GMTSJ,GMTSK,GMTSAD)
"RTN","GMTSPNS1",19,0)
 Q
"RTN","GMTSPNS1",20,0)
 ;
"RTN","GMTSPNS1",21,0)
WRTADD(GMTSI,GMTSJ,GMTSK,ADDEND) ;Writes record header for addendum
"RTN","GMTSPNS1",22,0)
ADVARI ;Sets variables for addendum
"RTN","GMTSPNS1",23,0)
 S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPNS1",24,0)
 S PN("DATE")=$$EDT^GMTSU(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1301,"I"))
"RTN","GMTSPNS1",25,0)
 S PN("DOCTYPE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,.01,"E"))
"RTN","GMTSPNS1",26,0)
 S PN("AUTHOR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1202,"E"))
"RTN","GMTSPNS1",27,0)
 S PN("EXPSIGNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1204,"E"))
"RTN","GMTSPNS1",28,0)
 S PN("LOC")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1205,"E"))
"RTN","GMTSPNS1",29,0)
 S PN("EXPCOSNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1208,"E"))
"RTN","GMTSPNS1",30,0)
 S PN("SIGDT")=^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1501,"I")
"RTN","GMTSPNS1",31,0)
 I PN("SIGDT")]"" S PN("SIGDT")=$$EDT^GMTSU(PN("SIGDT"))
"RTN","GMTSPNS1",32,0)
 S SIGNEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1502,"I"))
"RTN","GMTSPNS1",33,0)
 S PN("SIGNBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1503,"E"))
"RTN","GMTSPNS1",34,0)
 S PN("STITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1504,"E"))
"RTN","GMTSPNS1",35,0)
 S PN("COSDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1507,"I"))
"RTN","GMTSPNS1",36,0)
 I PN("COSDT")]"" S PN("COSDT")=$$EDT^GMTSU(PN("COSDT"))
"RTN","GMTSPNS1",37,0)
 S COSGEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1508,"I"))
"RTN","GMTSPNS1",38,0)
 S PN("COBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1509,"E"))
"RTN","GMTSPNS1",39,0)
 S PN("COTITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1510,"E"))
"RTN","GMTSPNS1",40,0)
 S PN("SUBJ")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1701,"E"))
"RTN","GMTSPNS1",41,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1505,"I"))="C" D
"RTN","GMTSPNS1",42,0)
 . S PN("SCHART")="Signed on Chart",PN("SCHARTBY")="."
"RTN","GMTSPNS1",43,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1512,"E"))'="" PN("SCHARTBY")=" by:      "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1512,"E"))
"RTN","GMTSPNS1",44,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1511,"I"))="C" D
"RTN","GMTSPNS1",45,0)
 . S PN("COCHART")="Cosigned on Chart",PN("COCHARTBY")="."
"RTN","GMTSPNS1",46,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1513,"E"))'="" PN("COCHARTBY")=" by:      "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1513,"E"))
"RTN","GMTSPNS1",47,0)
 S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1202,"I"))'=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1502,"I")) PN("AUTH")="AUTHOR:  "_PN("AUTHOR")
"RTN","GMTSPNS1",48,0)
WRITEAD ;Header lines for Addendum
"RTN","GMTSPNS1",49,0)
 I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNS1",50,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W PN("DATE"),?21,"Title:  ",$$UP^XLFSTR(PN("DOCTYPE"))
"RTN","GMTSPNS1",51,0)
 I $D(PN("AUTH")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?21,PN("AUTH")
"RTN","GMTSPNS1",52,0)
 I PN("SUBJ")'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",PN("SUBJ")
"RTN","GMTSPNS1",53,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNS1",54,0)
 Q
"RTN","GMTSPNS1",55,0)
WRTATEXT(GMTSI,GMTSJ,GMTSD,ADDEND) ; Write Progress Note Addenda text
"RTN","GMTSPNS1",56,0)
 N GMTSK S GMTSK=0
"RTN","GMTSPNS1",57,0)
 F  S GMTSK=$O(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSD,"ZADD",ADDEND,"TEXT",GMTSK)) Q:+GMTSK'>0  D
"RTN","GMTSPNS1",58,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSD,"ZADD",ADDEND,"TEXT",GMTSK,0))
"RTN","GMTSPNS1",59,0)
 . ; D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNS1",60,0)
 Q
"RTN","GMTSPNS1",61,0)
WRTASIG(GMTSI,GMTSJ,GMTSK,ADDEND) ;Writes Addenda Signatures 
"RTN","GMTSPNS1",62,0)
 I ^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1501,"I")="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"**DRAFT COPY - DRAFT COPY -- ABOVE ADDENDUM IS UNSIGNED --"
"RTN","GMTSPNS1",63,0)
 I  W " DRAFT COPY - DRAFT COPY**"
"RTN","GMTSPNS1",64,0)
 I $D(PN("SCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?2,PN("SCHART"),PN("SCHARTBY") D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNS1",65,0)
 I PN("SIGNBLK")'="" D
"RTN","GMTSPNS1",66,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Signed by:",24)
"RTN","GMTSPNS1",67,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1505,"I"))="E" " /es/ " W ?30,PN("SIGNBLK")
"RTN","GMTSPNS1",68,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1505,"I"))="C" ?30,PN("SIGNBLK")
"RTN","GMTSPNS1",69,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,PN("STITLE")
"RTN","GMTSPNS1",70,0)
 . I $L(PN("STITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSPNS1",71,0)
 . E  W:$L(PN("STITLE"))>0 " "
"RTN","GMTSPNS1",72,0)
 . W $G(PN("SIGDT"))
"RTN","GMTSPNS1",73,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNS1",74,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.137)
"RTN","GMTSPNS1",75,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.138)
"RTN","GMTSPNS1",76,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,.05,"E"))="UNCOSIGNED" D
"RTN","GMTSPNS1",77,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27,"** REQUIRES COSIGNATURE **"
"RTN","GMTSPNS1",78,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNS1",79,0)
 I $D(PN("COCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,PN("COCHART"),PN("COCHARTBY") D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNS1",80,0)
 I PN("COBLK")'="" D
"RTN","GMTSPNS1",81,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Cosigned By:",24)
"RTN","GMTSPNS1",82,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD",ADDEND,1511,"I"))="E" " /es/ "
"RTN","GMTSPNS1",83,0)
 . W ?30,PN("COBLK")
"RTN","GMTSPNS1",84,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,PN("COTITLE")
"RTN","GMTSPNS1",85,0)
 . I $L(PN("COTITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSPNS1",86,0)
 . E  W:$L(PN("COTITLE")) " "
"RTN","GMTSPNS1",87,0)
 . W $G(PN("COSDT"))
"RTN","GMTSPNS1",88,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNS1",89,0)
 . I +($$GET1^DIQ(200,+COSGEDBY,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,+COSGEDBY,.137)
"RTN","GMTSPNS1",90,0)
 . I +($$GET1^DIQ(200,+COSGEDBY,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$$GET1^DIQ(200,+COSGEDBY,.138)
"RTN","GMTSPNS1",91,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNS1",92,0)
 Q
"RTN","GMTSPNSL")
0^7^B42887973
"RTN","GMTSPNSL",1,0)
GMTSPNSL ; SLC/JER - Selected Progress Note Component ; 04/11/2000
"RTN","GMTSPNSL",2,0)
 ;;2.7;Health Summary;**12,30,35**;Oct 20, 1995
"RTN","GMTSPNSL",3,0)
 ;
"RTN","GMTSPNSL",4,0)
MAIN ; Control branching
"RTN","GMTSPNSL",5,0)
 N GMTSI,GMTSJ,GMTSCNT,GMTSXTRA,GMTSREC,PN,TIUDOC,TIUSTAT
"RTN","GMTSPNSL",6,0)
 K ^TMP("TIU",$J)
"RTN","GMTSPNSL",7,0)
 S GMTSI=0
"RTN","GMTSPNSL",8,0)
 F  S GMTSI=$O(GMTSEG(+GMTSEGN,8925.1,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSPNSL",9,0)
 . S TIUDOC(GMTSI)=+$G(GMTSEG(+GMTSEGN,8925.1,GMTSI))
"RTN","GMTSPNSL",10,0)
 D MAIN^TIULAPIS(DFN,.TIUDOC,"ALL",GMTS1,GMTS2,GMTSNDM,1)
"RTN","GMTSPNSL",11,0)
 I '$D(^TMP("TIU",$J)) Q
"RTN","GMTSPNSL",12,0)
 S GMTSI=0
"RTN","GMTSPNSL",13,0)
 F  S GMTSI=$O(^TMP("TIU",$J,GMTSI)) Q:+GMTSI'>0  D
"RTN","GMTSPNSL",14,0)
 . S GMTSJ=0
"RTN","GMTSPNSL",15,0)
 . F  S GMTSJ=$O(^TMP("TIU",$J,GMTSI,GMTSJ)) Q:+GMTSJ'>0  D
"RTN","GMTSPNSL",16,0)
 . . S GMTSK=0
"RTN","GMTSPNSL",17,0)
 . . F  S GMTSK=$O(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK)) Q:+GMTSK'>0  D
"RTN","GMTSPNSL",18,0)
 . . . N PN
"RTN","GMTSPNSL",19,0)
 . . . D WRTREC(GMTSI,GMTSJ,GMTSK)
"RTN","GMTSPNSL",20,0)
 . . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"PROBLEM")) D WRTPROB(GMTSI,GMTSJ,GMTSK)
"RTN","GMTSPNSL",21,0)
 . . . D WRTTEXT(GMTSI,GMTSJ,GMTSK)
"RTN","GMTSPNSL",22,0)
 . . . D WRTSIG(GMTSI,GMTSJ,GMTSK)
"RTN","GMTSPNSL",23,0)
 . . . I +$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1601,"I")) D AMENDMNT^GMTSPNS1(GMTSI,GMTSJ,GMTSK)
"RTN","GMTSPNSL",24,0)
 . . . I $D(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"ZADD")) D ADDEND^GMTSPNS1(GMTSI,GMTSJ,GMTSK)
"RTN","GMTSPNSL",25,0)
 K ^TMP("TIU",$J)
"RTN","GMTSPNSL",26,0)
 Q
"RTN","GMTSPNSL",27,0)
WRTREC(GMTSI,GMTSJ,GMTSK) ; Writes record header
"RTN","GMTSPNSL",28,0)
VARI ;Sets variables
"RTN","GMTSPNSL",29,0)
 S GMTSCNT=+$G(GMTSCNT)+1
"RTN","GMTSPNSL",30,0)
 S PN("DATE")=^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1301,"I")
"RTN","GMTSPNSL",31,0)
 I PN("DATE")]"" S PN("DATE")=$$EDT^GMTSU(PN("DATE"))
"RTN","GMTSPNSL",32,0)
 S PN("DOCTYPE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,.01,"E"))
"RTN","GMTSPNSL",33,0)
 S PN("AUTHOR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1202,"E"))
"RTN","GMTSPNSL",34,0)
 S PN("EXPSIGNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1204,"E"))
"RTN","GMTSPNSL",35,0)
 S PN("LOC")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1205,"E"))
"RTN","GMTSPNSL",36,0)
 S PN("EXPCOSNR")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1208,"E"))
"RTN","GMTSPNSL",37,0)
 S PN("SIGDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1501,"I"))
"RTN","GMTSPNSL",38,0)
 I PN("SIGDT")]"" S PN("SIGDT")=$$EDT^GMTSU(PN("SIGDT"))
"RTN","GMTSPNSL",39,0)
 S SIGNEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1502,"I"))
"RTN","GMTSPNSL",40,0)
 S PN("SIGBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1503,"E"))
"RTN","GMTSPNSL",41,0)
 S PN("STITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1504,"E"))
"RTN","GMTSPNSL",42,0)
 S COSGEDBY=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1508,"I"))
"RTN","GMTSPNSL",43,0)
 S PN("COSDT")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1507,"I"))
"RTN","GMTSPNSL",44,0)
 I PN("COSDT")]"" S PN("COSDT")=$$EDT^GMTSU(PN("COSDT"))
"RTN","GMTSPNSL",45,0)
 S PN("COBLK")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1509,"E"))
"RTN","GMTSPNSL",46,0)
 S PN("COTITLE")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1510,"E"))
"RTN","GMTSPNSL",47,0)
 S PN("SUBJ")=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1701,"E"))
"RTN","GMTSPNSL",48,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1505,"I"))="C" D
"RTN","GMTSPNSL",49,0)
 . S PN("SCHART")="Signed on Chart",PN("SCHARTBY")="."
"RTN","GMTSPNSL",50,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1512,"E"))'="" PN("SCHARTBY")=" by:      "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1512,"E"))
"RTN","GMTSPNSL",51,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1511,"I"))="C" D
"RTN","GMTSPNSL",52,0)
 . S PN("COCHART")="Cosigned on Chart",PN("COCHARTBY")="."
"RTN","GMTSPNSL",53,0)
 . S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1513,"E"))'="" PN("COCHARTBY")=" by:      "_$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1513,"E"))
"RTN","GMTSPNSL",54,0)
 S:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1202,"I"))'=$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1502,"I")) PN("AUTH")="AUTHOR:  "_PN("AUTHOR")
"RTN","GMTSPNSL",55,0)
WRITE ;Header lines
"RTN","GMTSPNSL",56,0)
 I GMTSCNT>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",57,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W PN("DATE"),?21,"Title:  ",$$UP^XLFSTR(PN("DOCTYPE"))
"RTN","GMTSPNSL",58,0)
 I $D(PN("AUTH")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?21,PN("AUTH")
"RTN","GMTSPNSL",59,0)
 I PN("SUBJ")'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !?19,"Subject:  ",PN("SUBJ")
"RTN","GMTSPNSL",60,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",61,0)
 Q
"RTN","GMTSPNSL",62,0)
WRTTEXT(GMTSI,GMTSJ,GMTSR) ; Write Progress Note text
"RTN","GMTSPNSL",63,0)
 N GMTSK S GMTSK=0
"RTN","GMTSPNSL",64,0)
 F  S GMTSK=$O(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSR,"TEXT",GMTSK)) Q:+GMTSK'>0  D
"RTN","GMTSPNSL",65,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSR,"TEXT",GMTSK,0))
"RTN","GMTSPNSL",66,0)
 Q
"RTN","GMTSPNSL",67,0)
WRTSIG(GMTSI,GMTSJ,GMTSK) ;Writes Signatures 
"RTN","GMTSPNSL",68,0)
 I ^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1501,"I")="" D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"**DRAFT COPY - DRAFT COPY -- ABOVE NOTE IS UNSIGNED --"
"RTN","GMTSPNSL",69,0)
 I  W " DRAFT COPY - DRAFT COPY**"
"RTN","GMTSPNSL",70,0)
 I $D(PN("SCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?12,PN("SCHART"),PN("SCHARTBY")
"RTN","GMTSPNSL",71,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",72,0)
 I PN("SIGBLK")'="" D
"RTN","GMTSPNSL",73,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Signed by:",24)
"RTN","GMTSPNSL",74,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1505,"I"))="E" " /es/ "
"RTN","GMTSPNSL",75,0)
 . W ?30,PN("SIGBLK")
"RTN","GMTSPNSL",76,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,PN("STITLE")
"RTN","GMTSPNSL",77,0)
 . I $L(PN("STITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSPNSL",78,0)
 . E  W:$L(PN("STITLE"))>0 " "
"RTN","GMTSPNSL",79,0)
 . W $G(PN("SIGDT"))
"RTN","GMTSPNSL",80,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",81,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.137)
"RTN","GMTSPNSL",82,0)
 . I +($$GET1^DIQ(200,+SIGNEDBY,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$$GET1^DIQ(200,+SIGNEDBY,.138)
"RTN","GMTSPNSL",83,0)
 I $G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,.05,"E"))="UNCOSIGNED" D
"RTN","GMTSPNSL",84,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?30,"** REQUIRES COSIGNATURE **"
"RTN","GMTSPNSL",85,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",86,0)
 I $D(PN("COCHART")) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J(PN("COCHART"),20),PN("COCHARTBY") D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",87,0)
 I PN("COBLK")'="" D
"RTN","GMTSPNSL",88,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Cosigned By:",24)
"RTN","GMTSPNSL",89,0)
 . W:$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,1511,"I"))="E" " /es/ "
"RTN","GMTSPNSL",90,0)
 . W ?30,PN("COBLK")
"RTN","GMTSPNSL",91,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?25,PN("COTITLE")
"RTN","GMTSPNSL",92,0)
 . I $L(PN("COTITLE"))>37 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I 1
"RTN","GMTSPNSL",93,0)
 . E  W:$L(PN("COTITLE")) " "
"RTN","GMTSPNSL",94,0)
 . W $G(PN("COSDT"))
"RTN","GMTSPNSL",95,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",96,0)
 . I +($$GET1^DIQ(200,+COSGEDBY,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,+COSGEDBY,.137)
"RTN","GMTSPNSL",97,0)
 . I +($$GET1^DIQ(200,+COSGEDBY,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",$$GET1^DIQ(200,+COSGEDBY,.138)
"RTN","GMTSPNSL",98,0)
 I +$O(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"EXTRASGNR",0)) D
"RTN","GMTSPNSL",99,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("Receipt Acknowledged by:",24)
"RTN","GMTSPNSL",100,0)
 S GMTSXTRA=0
"RTN","GMTSPNSL",101,0)
 F  S GMTSXTRA=+$O(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"EXTRASGNR",GMTSXTRA)) Q:+GMTSXTRA'>0  D
"RTN","GMTSPNSL",102,0)
 . I +$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"EXTRASGNR",GMTSXTRA,"DATE"))'>0 Q
"RTN","GMTSPNSL",103,0)
 . I +GMTSXTRA>1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",104,0)
 . W ?22,"/es/ ",$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"EXTRASGNR",GMTSXTRA,"NAME"))
"RTN","GMTSPNSL",105,0)
 . W !?25,$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"EXTRASGNR",GMTSXTRA,"TITLE"))
"RTN","GMTSPNSL",106,0)
 . I $L($G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"EXTRASGNR",GMTSXTRA,"TITLE")))>51 D
"RTN","GMTSPNSL",107,0)
 . . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?28
"RTN","GMTSPNSL",108,0)
 . E  W:$L($G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"EXTRASGNR",GMTSXTRA,"TITLE")))>0 " "
"RTN","GMTSPNSL",109,0)
 . W $$EDT^GMTSU($G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"EXTRASGNR",GMTSXTRA,"DATE")))
"RTN","GMTSPNSL",110,0)
 . N GMTSEXS S GMTSEXS=+$G(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"EXTRASGNR",GMTSXTRA,"EXTRA"))
"RTN","GMTSPNSL",111,0)
 . I +($$GET1^DIQ(200,GMTSEXS,.137)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",$$GET1^DIQ(200,GMTSEXS,.137)
"RTN","GMTSPNSL",112,0)
 . I +($$GET1^DIQ(200,GMTSEXS,.138)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager: ",$$GET1^DIQ(200,GMTSEXS,.138)
"RTN","GMTSPNSL",113,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",114,0)
 I +$O(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"EXTRASGNR",0))=0 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",115,0)
 Q
"RTN","GMTSPNSL",116,0)
WRTPROB(GMTSI,GMTSJ,GMTSK) ;Writes list of problems associated with note
"RTN","GMTSPNSL",117,0)
 N GMTSPR
"RTN","GMTSPNSL",118,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"PROBLEM(S):  "
"RTN","GMTSPNSL",119,0)
 S GMTSPR=0
"RTN","GMTSPNSL",120,0)
 F  S GMTSPR=$O(^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"PROBLEM",GMTSPR)) Q:+GMTSPR'>0  D
"RTN","GMTSPNSL",121,0)
 .  D:GMTSPR>1 CKP^GMTSUP Q:$D(GMTSQIT)  W !?15,^TMP("TIU",$J,GMTSI,GMTSJ,GMTSK,"PROBLEM",GMTSPR,0)
"RTN","GMTSPNSL",122,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSPNSL",123,0)
 Q
"RTN","GMTSPXEP")
0^32^B9646705
"RTN","GMTSPXEP",1,0)
GMTSPXEP ; SLC/SBW,KER - PCE Patient Education comp ; 04/11/2000
"RTN","GMTSPXEP",2,0)
 ;;2.7;Health Summary;**8,10,28,35**;Oct 20, 1995
"RTN","GMTSPXEP",3,0)
 ;
"RTN","GMTSPXEP",4,0)
PTED ; Patient education
"RTN","GMTSPXEP",5,0)
 N GMTSOVT
"RTN","GMTSPXEP",6,0)
 K ^TMP("PXPE",$J)
"RTN","GMTSPXEP",7,0)
 ;
"RTN","GMTSPXEP",8,0)
 S GMTSOVT="AICTSORXHDE" ; NOTE: This is the set of Service Categories
"RTN","GMTSPXEP",9,0)
 ; for "Ambulatory (A), Inpatient (I), Chart Review (C),
"RTN","GMTSPXEP",10,0)
 ; Telecommunications (T), Day Surgery (S), Observation (O),
"RTN","GMTSPXEP",11,0)
 ; Nursing Home (R), Ancillary (X), Hospitalization (H), 
"RTN","GMTSPXEP",12,0)
 ; Daily Hospitalization ancillary (D) encounters, and
"RTN","GMTSPXEP",13,0)
 ; Event-Historical (E)
"RTN","GMTSPXEP",14,0)
 ;
"RTN","GMTSPXEP",15,0)
 D EDUC^PXRHS08(DFN,GMTSEND,GMTSBEG,GMTSNDM,GMTSOVT)
"RTN","GMTSPXEP",16,0)
 ;D:+$D(^TMP("PXPE",$J)) EDMAIN
"RTN","GMTSPXEP",17,0)
 Q:'$D(^TMP("PXPE",$J))
"RTN","GMTSPXEP",18,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXEP",19,0)
 D EDMAIN
"RTN","GMTSPXEP",20,0)
 Q
"RTN","GMTSPXEP",21,0)
MRPTED ; Most recent patient education
"RTN","GMTSPXEP",22,0)
 N GMTSOVT,LATEST
"RTN","GMTSPXEP",23,0)
 K ^TMP("PXPE",$J)
"RTN","GMTSPXEP",24,0)
 S LATEST="R" ;Returns most recent Pat. Ed. Topic Types for time period.
"RTN","GMTSPXEP",25,0)
 ;
"RTN","GMTSPXEP",26,0)
 S GMTSOVT="AICTSORXHDE" ; NOTE: This is the set of Service Categories
"RTN","GMTSPXEP",27,0)
 ; for "Ambulatory (A), Inpatient (I), Chart Review (C),
"RTN","GMTSPXEP",28,0)
 ; Telecommunications (T), Day Surgery (S), Observation (O),
"RTN","GMTSPXEP",29,0)
 ; Nursing Home (R), Ancillary (X), Hospitalization (H), 
"RTN","GMTSPXEP",30,0)
 ; Daily Hospitalization ancillary (D) encounters, and
"RTN","GMTSPXEP",31,0)
 ; Event-Historical (E)
"RTN","GMTSPXEP",32,0)
 ;
"RTN","GMTSPXEP",33,0)
 D EDUC^PXRHS08(DFN,GMTSEND,GMTSBEG,LATEST,GMTSOVT)
"RTN","GMTSPXEP",34,0)
 Q:'$D(^TMP("PXPE",$J))
"RTN","GMTSPXEP",35,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSPXEP",36,0)
 D EDMAIN
"RTN","GMTSPXEP",37,0)
 Q
"RTN","GMTSPXEP",38,0)
HDR ;Header
"RTN","GMTSPXEP",39,0)
 W ?2,"Date",?12,"Facility",?25,"Topic - Understanding Level",!!
"RTN","GMTSPXEP",40,0)
 Q
"RTN","GMTSPXEP",41,0)
EDMAIN ;
"RTN","GMTSPXEP",42,0)
 N GMDT,GMED,GMIFN,GMN0,GMN1,X,GMTSDAT,ED,LEVEL,GMSITE,PSITE,PDT,LTXT
"RTN","GMTSPXEP",43,0)
 N COMMENT,GMICL,GMTSLN,GMTAB
"RTN","GMTSPXEP",44,0)
 S GMDT=0
"RTN","GMTSPXEP",45,0)
 F  S GMDT=$O(^TMP("PXPE",$J,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXEP",46,0)
 . S GMED=""
"RTN","GMTSPXEP",47,0)
 . F  S GMED=$O(^TMP("PXPE",$J,GMDT,GMED)) Q:GMED']""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXEP",48,0)
 . . S GMIFN=0
"RTN","GMTSPXEP",49,0)
 . . F  S GMIFN=$O(^TMP("PXPE",$J,GMDT,GMED,GMIFN)) Q:GMIFN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXEP",50,0)
 . . . S GMN0=$G(^TMP("PXPE",$J,GMDT,GMED,GMIFN,0))
"RTN","GMTSPXEP",51,0)
 . . . Q:GMN0']""
"RTN","GMTSPXEP",52,0)
 . . . S GMN1=$G(^TMP("PXPE",$J,GMDT,GMED,GMIFN,1))
"RTN","GMTSPXEP",53,0)
 . . . S GMSITE=$S($P(GMN1,U,3)]"":$E($P(GMN1,U,3),1,10),$P(GMN1,U,4)]"":$E($P(GMN1,U,4),1,10),1:"No Site")
"RTN","GMTSPXEP",54,0)
 . . . S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXEP",55,0)
 . . . S LTXT="",ED=$P(GMN0,U),LEVEL=$P(GMN0,U,3)
"RTN","GMTSPXEP",56,0)
 . . . I LEVEL]"" S LTXT=" - "_LEVEL
"RTN","GMTSPXEP",57,0)
 . . . I LEVEL="POOR"!(LEVEL="FAIR")!(LEVEL="GOOD") S LTXT=LTXT_" UNDERSTANDING"
"RTN","GMTSPXEP",58,0)
 . . . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR
"RTN","GMTSPXEP",59,0)
 . . . I GMTSDAT'=$G(PDT)!GMTSNPG W GMTSDAT S PDT=GMTSDAT,PSITE=""
"RTN","GMTSPXEP",60,0)
 . . . I GMSITE'=$G(PSITE) W ?12,GMSITE S PSITE=GMSITE
"RTN","GMTSPXEP",61,0)
 . . . W ?25,ED,$G(LTXT),!
"RTN","GMTSPXEP",62,0)
 . . . S COMMENT="",COMMENT=$P(^TMP("PXPE",$J,GMDT,GMED,GMIFN,"COM"),U)
"RTN","GMTSPXEP",63,0)
 . . . I COMMENT]"" S GMICL=26,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D 
"RTN","GMTSPXEP",64,0)
 . . . . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXEP",65,0)
 K ^TMP("PXPE",$J)
"RTN","GMTSPXEP",66,0)
 Q
"RTN","GMTSPXEP",67,0)
FORMAT ;formats line of text
"RTN","GMTSPXEP",68,0)
 N DIWR,DIWF,X
"RTN","GMTSPXEP",69,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXEP",70,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXEP",71,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXEP",72,0)
 Q
"RTN","GMTSPXEP",73,0)
LINE ;writes  formatted lines of text
"RTN","GMTSPXEP",74,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?26,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXEP",75,0)
 Q
"RTN","GMTSRM")
0^28^B21174718
"RTN","GMTSRM",1,0)
GMTSRM ; SLC/KER - Create/Modify Health Summary Type ; 04/11/2000
"RTN","GMTSRM",2,0)
 ;;2.7;Health Summary;**30,35**;Oct 20, 1995
"RTN","GMTSRM",3,0)
 ;
"RTN","GMTSRM",4,0)
MAIN ;Main loop to modify multiple health summary types
"RTN","GMTSRM",5,0)
 N %,DTOUT,DUOUT,DIRUT,EXISTS,GMTSFUNC,GMTSQIT,P
"RTN","GMTSRM",6,0)
 S GMTSQIT=0 F  S EXISTS=0 D SELTYP Q:GMTSQIT
"RTN","GMTSRM",7,0)
 Q
"RTN","GMTSRM",8,0)
SELTYP ; Select Health Summary Type to Edit
"RTN","GMTSRM",9,0)
 N CHANGE,DA,DIC,DIE,DLAYGO,DR,DUOUT,EXISTS,GMTSUM,GMTSNEW,GMTSMGR
"RTN","GMTSRM",10,0)
 N GMTSEG,GMTSIFN,SELCNT,X,Y
"RTN","GMTSRM",11,0)
 W ! S U="^",DIC="^GMT(142,",DIC(0)="AEMQL"
"RTN","GMTSRM",12,0)
 S DIC("A")="Select Health Summary Type: "
"RTN","GMTSRM",13,0)
 S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION""",DLAYGO=142
"RTN","GMTSRM",14,0)
 S Y=$$TYPE^GMTSULT K DIC S:+Y'>0 GMTSQIT=1 Q:+Y'>0  S (GMTSIFN,DA)=+Y
"RTN","GMTSRM",15,0)
 S GMTSUM=$P(Y,U,2),GMTSNEW=+$P(Y,U,3),GMTSMGR=$S($D(^XUSEC("GMTSMGR",DUZ)):1,1:0)
"RTN","GMTSRM",16,0)
 I 'GMTSMGR,($P(^GMT(142,+DA,0),U,2)]"") D  Q:'GMTSMGR
"RTN","GMTSRM",17,0)
 . S GMTSMGR=$D(^XUSEC($P(^(0),U,2),DUZ))
"RTN","GMTSRM",18,0)
 . W:'GMTSMGR !,$C(7),"This summary report is currently locked to prevent alteration.",!
"RTN","GMTSRM",19,0)
 I 'GMTSMGR,'GMTSNEW,($P(^GMT(142,+DA,0),U,3)'=DUZ) W !,$C(7),"Alteration of this summary report is restricted to its owner.",!,"See the Clinical Coordinator if you need additional help." Q
"RTN","GMTSRM",20,0)
 S DIE="^GMT(142,",(GMTSIFN,DA)=+Y,DR="[GMTS EDIT HLTH SUM TYPE]" D ^DIE
"RTN","GMTSRM",21,0)
 I '$D(^GMT(142,+GMTSIFN,0))!$D(Y)!$D(DUOUT)!$D(DIROUT)!$D(DTOUT) D  Q
"RTN","GMTSRM",22,0)
 . S GMTSQIT=1 D CHKDEL Q
"RTN","GMTSRM",23,0)
 I 'GMTSNEW,($O(^GMT(142,+GMTSIFN,1,0))) S EXISTS=1 D LIST,EXISTS Q
"RTN","GMTSRM",24,0)
 D SELCMP^GMTSRM5 Q:GMTSQIT  D LIST:EXISTS,EXISTS D CHKDEL
"RTN","GMTSRM",25,0)
 Q
"RTN","GMTSRM",26,0)
CHKDEL ; Check for Possible Deletion (New Type without Component)
"RTN","GMTSRM",27,0)
 Q:+($G(GMTSNEW))'>0  Q:+($G(GMTSIFN))'>0  Q:'$D(^GMT(142,+($G(GMTSIFN)),0))
"RTN","GMTSRM",28,0)
 Q:$D(^GMT(142,+($G(GMTSIFN)),1,"B"))  Q:'$L($P($G(^GMT(142,+($G(GMTSIFN)),0)),"^",1))
"RTN","GMTSRM",29,0)
 N DA,GMTSNAM,GMTSH1,GMTSH2,GMTSH3,GMTSH4 S DA=GMTSIFN,GMTSNAM=$P($G(^GMT(142,GMTSIFN,0)),"^",1) Q:'$L(GMTSNAM)
"RTN","GMTSRM",30,0)
 S GMTSH1="  Health Summary Type """_GMTSNAM_""" has no components.",GMTSH2="Enter either 'Y' or 'N' ",GMTSH3="'Y' Delete the Health Summary Type",GMTSH4="'N' Do NOT Delete the Health Summary Type" W !!,GMTSH1
"RTN","GMTSRM",31,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT S DIR(0)="YAO",DIR("A")="    Delete """_GMTSNAM_"""?  (Y/N)  "
"RTN","GMTSRM",32,0)
 S DIR("?")="^W !,?6,GMTSH2",DIR("??")="^W !,?4,GMTSH1,!!,?8,""Enter"",?15,GMTSH3,!,?15,GMTSH4" W ! D ^DIR
"RTN","GMTSRM",33,0)
 I +($G(Y))>0,$G(X)'["^" D
"RTN","GMTSRM",34,0)
 . N DIK S U="^",DIK="^GMT(142," Q:DA'>0  Q:'$D(^GMT(142,DA,0))  Q:$D(^GMT(142,DA,1,"B"))  D ^DIK
"RTN","GMTSRM",35,0)
 W:'$D(^GMT(142,DA,0)) "    < deleted >" W:$D(^GMT(142,DA,0)) "    < not deleted >"
"RTN","GMTSRM",36,0)
 Q
"RTN","GMTSRM",37,0)
ENADHOC ; Entry point for AD HOC edit
"RTN","GMTSRM",38,0)
 N %,C,CHANGE,DA,DIC,DIE,DR,DUOUT,EXISTS,I,GMTSIFN,GMTSN,GMTSNCNT,GMTSNEW
"RTN","GMTSRM",39,0)
 N GMTSIFN,GMTSUM,P,SELCNT
"RTN","GMTSRM",40,0)
 N GMTSQIT,GMTSFUNC,X,Y
"RTN","GMTSRM",41,0)
 W !!,">>> EDITING the GMTS HS ADHOC OPTION Health Summary Type"
"RTN","GMTSRM",42,0)
 S (GMTSNEW,GMTSQIT)=0
"RTN","GMTSRM",43,0)
 S DIC=142,DIC(0)="XZF",X="GMTS HS ADHOC OPTION"
"RTN","GMTSRM",44,0)
 S Y=$$TYPE^GMTSULT I +Y'>0 D ^GMTSLOAD Q:$D(DIRUT)!$D(DIROUT)  G ENADHOC
"RTN","GMTSRM",45,0)
 S GMTSIFN=+Y,GMTSUM=$P(Y,U,2),EXISTS=1
"RTN","GMTSRM",46,0)
 S DIE="^GMT(142,",DA=GMTSIFN,DR=".08T" D ^DIE
"RTN","GMTSRM",47,0)
 Q:$D(Y)
"RTN","GMTSRM",48,0)
 D LIST,EXISTS
"RTN","GMTSRM",49,0)
 Q
"RTN","GMTSRM",50,0)
EXISTS ;Edit an existing health summary type
"RTN","GMTSRM",51,0)
 N CNT,NXTCMP
"RTN","GMTSRM",52,0)
 Q:$D(DUOUT)
"RTN","GMTSRM",53,0)
 S NXTCMP=0 ;NXTCMP tracks whether any component changes may have been made.
"RTN","GMTSRM",54,0)
 S NXTCMP(0)=0 F CNT=$$GETCNT(GMTSIFN):0 D NXTCMP^GMTSRM1,LIST:GMTSQIT Q:GMTSQIT!($D(DUOUT))  K GMTSQIT,GMTSNEW,TWEENER,SOACTION
"RTN","GMTSRM",55,0)
 I NXTCMP>0 W !,"Please hold on while I resequence the summary order" D COPY^GMTSRN,RNMBR^GMTSRN:CHANGE
"RTN","GMTSRM",56,0)
 Q
"RTN","GMTSRM",57,0)
LIST ; Lists existing summary parameters
"RTN","GMTSRM",58,0)
 N B,DIC,DIR,IOP,Y,FR,TO,BY,DHD,FLDS,L
"RTN","GMTSRM",59,0)
 I GMTSQIT'=2 Q:($D(DUOUT)!(GMTSQIT=1))  ;List after return from NXTCMP^GMTSRM1
"RTN","GMTSRM",60,0)
 I GMTSQIT=2,(NXTCMP=0) S GMTSQIT=0 Q
"RTN","GMTSRM",61,0)
 I 'GMTSNEW W ! S DIC=142,DIR(0)="Y",DIR("A")="Do you wish to review the Summary Type structure before continuing",DIR("B")="NO" D ^DIR K DIR I 'Y S:GMTSQIT=2 DUOUT="" S:GMTSQIT=2 GMTSQIT="D" S:$D(DUOUT) GMTSQIT=1 Q
"RTN","GMTSRM",62,0)
 I $D(GMTSQIT),GMTSQIT=2 S GMTSQIT=0 ;Allow for reiterative updates of Components.
"RTN","GMTSRM",63,0)
 S IOP="HOME",DIC=142,(FR,TO)=GMTSUM,BY=".01",DHD="[GMTS TYPE INQ HEADER]-[GMTS TYPE INQ FOOTER]",FLDS="[GMTS TYPE INQ]",L=0 D EN1^DIP
"RTN","GMTSRM",64,0)
 Q
"RTN","GMTSRM",65,0)
GETCNT(GMTSIFN) ; Determine default summary order for new component
"RTN","GMTSRM",66,0)
 N LI,LCNT
"RTN","GMTSRM",67,0)
 S LI=0,LCNT=5 F  S LI=$O(^GMT(142,+GMTSIFN,1,LI)) Q:+LI'>0  S LCNT=$P(LI,".")+5
"RTN","GMTSRM",68,0)
 Q LCNT
"RTN","GMTSU")
0^8^B18185397
"RTN","GMTSU",1,0)
GMTSU ; SLC/JER,KER/NDBI - Health Summary Utilities ; 04/11/2000
"RTN","GMTSU",2,0)
 ;;2.7;Health Summary;**27,28,31,35**;Oct 20, 1995
"RTN","GMTSU",3,0)
 ;
"RTN","GMTSU",4,0)
MTIM ;CONVERT TIME from X=2890313.1304 INTO X=13:04
"RTN","GMTSU",5,0)
 S X=$P(X,".",2) Q:'$L(X)
"RTN","GMTSU",6,0)
 S X=$S(X:$E(X,1,2)_$E("00",0,2-$L($E(X,1,2)))_":"_$E(X,3,4)_$E("00",0,2-$L($E(X,3,4))),1:"")
"RTN","GMTSU",7,0)
 Q
"RTN","GMTSU",8,0)
PROK(X,Y) ; Routine and Patch # OK (in UCI)
"RTN","GMTSU",9,0)
 N GMTS,GMTSI,GMTSO S X=$G(X),Y=$G(Y) Q:'$L(X) 0 Q:Y'=""&(+Y=0)
"RTN","GMTSU",10,0)
 S Y=+Y,GMTS=$$ROK(X) Q:'GMTS 0 Q:+Y=0 1 S GMTSO=0,GMTS=$T(@("+2^"_X)),GMTS=$P($P(GMTS,"**",2),"**",1)
"RTN","GMTSU",11,0)
 F GMTSI=1:1:$L(GMTS,",") S:+($P(GMTS,",",GMTSI))=Y GMTSO=1 Q:GMTSO=1
"RTN","GMTSU",12,0)
 S X=GMTSO Q X
"RTN","GMTSU",13,0)
ROK(X) ; Routine OK (in UCI) (NDBI)
"RTN","GMTSU",14,0)
 S X=$G(X) Q:'$L(X) 0 Q:$L(X)>8 0 X ^%ZOSF("TEST") Q:$T 1 Q 0
"RTN","GMTSU",15,0)
NDBI(X) ; National Database Integration site 1 = yes  0 = no
"RTN","GMTSU",16,0)
 N R,G S X="A7RDUP" X ^%ZOSF("TEST") S R=$T,G=$S($D(^A7RCP):1,1:0),X=R+G,X=$S(X=2:1,1:0) Q X
"RTN","GMTSU",17,0)
CPT(X) ; Use CPT Modifiers  Need GMTSEG Array
"RTN","GMTSU",18,0)
 N GMTSN,GMTSC,GMTSM,GMTSA,GMTSI S GMTSN=$G(GMTSEG(+($G(GMTSEGN))))
"RTN","GMTSU",19,0)
 S GMTSC=+($P(GMTSN,"^",2)) Q:'GMTSC 0
"RTN","GMTSU",20,0)
 S GMTSM=$S($P(GMTSN,"^",9)="N":0,1:1) Q:'GMTSM 0
"RTN","GMTSU",21,0)
 S GMTSA=$S($P($G(^GMT(142.1,+GMTSC,0)),"^",14)="Y":1,1:0) Q:'GMTSA 0
"RTN","GMTSU",22,0)
 Q 1
"RTN","GMTSU",23,0)
ED(X) ; External Date
"RTN","GMTSU",24,0)
 S X=$G(X) Q:'$L(X) ""
"RTN","GMTSU",25,0)
 D REGDT4 Q X
"RTN","GMTSU",26,0)
EDT(X) ; External Date and Time
"RTN","GMTSU",27,0)
 S X=$G(X) Q:'$L(X) ""
"RTN","GMTSU",28,0)
 D REGDTM4 Q X
"RTN","GMTSU",29,0)
REGDT ; Receives X in internal date.time, and returns X in MM/DD/YY format
"RTN","GMTSU",30,0)
 S X=$TR($$FMTE^XLFDT(X,"2DZ"),"@"," ") Q
"RTN","GMTSU",31,0)
REGDT4 ; Receives X in internal date.time, and returns X in MM/DD/YYYY format
"RTN","GMTSU",32,0)
 S X=$TR($$FMTE^XLFDT(X,"5DZ"),"@"," ") Q
"RTN","GMTSU",33,0)
REGDTM ;Receives X in internal date.time, and returns X in MM/DD/YY TT:TT
"RTN","GMTSU",34,0)
 S X=$TR($$FMTE^XLFDT(X,"2ZM"),"@"," ") Q
"RTN","GMTSU",35,0)
REGDTM4 ;Receives X in internal date.time, and returns X in MM/DD/YYYY TT:TT
"RTN","GMTSU",36,0)
 S X=$TR($$FMTE^XLFDT(X,"5ZM"),"@"," ") Q
"RTN","GMTSU",37,0)
SIDT ; Receives X as internal date/time and returns X in DD MMM YY
"RTN","GMTSU",38,0)
 N MON,MM
"RTN","GMTSU",39,0)
 S X=$P(X,".") I 'X S X="" Q
"RTN","GMTSU",40,0)
 S MON="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"
"RTN","GMTSU",41,0)
 S MM=$E(X,4,5),MM=$S(MM:$P(MON,U,MM),1:"")
"RTN","GMTSU",42,0)
 S X=$E(X,6,7)_" "_MM_" "_$E(X,2,3)
"RTN","GMTSU",43,0)
 Q
"RTN","GMTSU",44,0)
 ;                       
"RTN","GMTSU",45,0)
HF(X) ; Host File - Used to distinguish from Host Files that are intended
"RTN","GMTSU",46,0)
 ; for Printers and Host Files for other purposes (windows/files)
"RTN","GMTSU",47,0)
 ;       1  -  if Device Type is HFS and not a TCP/IP Printer
"RTN","GMTSU",48,0)
 ;       0  -  if Device Type is not HFS or device is a Printer
"RTN","GMTSU",49,0)
 ;                       
"RTN","GMTSU",50,0)
 Q:$G(IOT)'="HFS" 0 Q:$E($G(ION),1,4)["OR W" 1 Q:$G(IO)["$PRT"!($G(IO)["PRN|") 0
"RTN","GMTSU",51,0)
 S X=0 S:$G(ION)["HOST FILE" X=1 S:$E($G(IOST),1,5)["P-OTH" X=1
"RTN","GMTSU",52,0)
 Q X
"RTN","GMTSU",53,0)
FMHL7DTM ; Recieves X as internal date/time and returns X in CCYYMMDDHHMM
"RTN","GMTSU",54,0)
 N T
"RTN","GMTSU",55,0)
 S T=$P(X,".",2)
"RTN","GMTSU",56,0)
 S T=$S(T:$E(T,1,2)_$E("00",0,2-$L($E(T,1,2)))_$E(T,3,4)_$E("00",0,2-$L($E(T,3,4))),1:"0000")
"RTN","GMTSU",57,0)
 S X=($E($P(X,"."),1,3)+1700)_$E($P(X,"."),4,7)_T
"RTN","GMTSU",58,0)
 Q
"RTN","GMTSU",59,0)
HL7FMDTM ; Recieves X as CCYYMMDDHHMM and returns X as internal date/time
"RTN","GMTSU",60,0)
 N DATE,TIME
"RTN","GMTSU",61,0)
 S DATE=$E(X,1,8),TIME=$E(X,9,12)
"RTN","GMTSU",62,0)
 S DATE=DATE-17000000,X=DATE_"."_TIME
"RTN","GMTSU",63,0)
 Q
"RTN","GMTSU",64,0)
DEM ; Gets Demographic Data from VADPT
"RTN","GMTSU",65,0)
 ; Receives: DFN
"RTN","GMTSU",66,0)
 ; Returns: GMTSPNM,GMTSSN,GMTSDOB,SEX,GMTSWARD,GMTSRB,GMTSAGE
"RTN","GMTSU",67,0)
 K VAHOW D OERR^VADPT
"RTN","GMTSU",68,0)
 S GMTSPNM=VADM(1)
"RTN","GMTSU",69,0)
 S GMTSSN=$S($D(VA("PID")):VA("PID"),1:$P(VADM(2),"^",2))
"RTN","GMTSU",70,0)
 S GMTSAGE=$S(+VADM(4)>0:+VADM(4),1:99),SEX=$P(VADM(5),"^")
"RTN","GMTSU",71,0)
 S GMTSWARD=$P(VAIN(4),"^",2),GMTSRB=VAIN(5)
"RTN","GMTSU",72,0)
 S X=$P(VADM(3),"^") D REGDT4 S GMTSDOB=X
"RTN","GMTSU",73,0)
 K VA
"RTN","GMTSU",74,0)
 ;Establish the information for the patient header.
"RTN","GMTSU",75,0)
 K GMTSPHDR
"RTN","GMTSU",76,0)
 N DOB,LWARDRB,NMSSN,NMSSNE,WARDRB,WARDRBE,WARDRBS
"RTN","GMTSU",77,0)
 S NMSSN=GMTSPNM_"    "_GMTSSN
"RTN","GMTSU",78,0)
 S NMSSNE=$L(NMSSN)+2
"RTN","GMTSU",79,0)
 S WARDRB=GMTSWARD_" "_GMTSRB
"RTN","GMTSU",80,0)
 S LWARDRB=$L(WARDRB)
"RTN","GMTSU",81,0)
 S WARDRBS=40-(LWARDRB/2),WARDRBE=WARDRBS+LWARDRB
"RTN","GMTSU",82,0)
 S DOB="DOB: "_GMTSDOB
"RTN","GMTSU",83,0)
 S GMTSPHDR("NMSSN")=NMSSN
"RTN","GMTSU",84,0)
 S GMTSPHDR("WARDRB")=WARDRB
"RTN","GMTSU",85,0)
 S GMTSPHDR("WARDRBS")=WARDRBS
"RTN","GMTSU",86,0)
 S GMTSPHDR("DOB")=DOB
"RTN","GMTSU",87,0)
 S GMTSPHDR("DOBS")=64
"RTN","GMTSU",88,0)
 I (NMSSNE'<WARDRBS)!(WARDRBE'<64) S GMTSPHDR("TWO")=1
"RTN","GMTSU",89,0)
 Q
"RTN","GMTSU",90,0)
NAME ; Format names ;6/30/89  11:20 ;
"RTN","GMTSU",91,0)
 ; Recieves: FILE (3 for User, 16 for Person, 6 for Provider)
"RTN","GMTSU",92,0)
 ;           IFN (Internal file # for above file),
"RTN","GMTSU",93,0)
 ;           NML (Desired length for name to be returned)
"RTN","GMTSU",94,0)
 ;           FNF (Flag to specify first name format: 0 for FI, 1 for FN)
"RTN","GMTSU",95,0)
 ; Returns: Lastname,First(name/initial) to specified length as NM
"RTN","GMTSU",96,0)
 ;
"RTN","GMTSU",97,0)
 N DIC,RAWNM,LN,FN,FA,NI,CH,X,Y
"RTN","GMTSU",98,0)
 S DIC=FILE,DIC(0)="NXZ",X=IFN D ^DIC S RAWNM=$S($D(Y(0,0)):Y(0,0),1:"UNKNOWN")
"RTN","GMTSU",99,0)
 S LN=$P(RAWNM,","),FN=$P(RAWNM,",",2)
"RTN","GMTSU",100,0)
 S FA=0 I $L(FN) F NI=1:1 S CH=$E(FN,NI) Q:CH?1A  S FA=NI
"RTN","GMTSU",101,0)
 I FA S FN=$E(FN,FA+1,$L(FN))
"RTN","GMTSU",102,0)
 I 'FNF S FN=$E(FN,1)
"RTN","GMTSU",103,0)
 S NM=$S($L(FN):LN_","_FN,1:LN),NM=$E(NM,1,NML)
"RTN","GMTSU",104,0)
 K FILE,IFN,NML,FNF
"RTN","GMTSU",105,0)
 Q
"RTN","GMTSU",106,0)
GETRANGE(FROMDATE,TODATE) ; Selection by Date Range (from and to dates)
"RTN","GMTSU",107,0)
 ;      VARIABLES LIST (OUTPUT)
"RTN","GMTSU",108,0)
 ; FROMDATE = FROM DATE
"RTN","GMTSU",109,0)
 ; TODATE = TO DATE
"RTN","GMTSU",110,0)
 N DIR,X,Y,DTOUT,DIRUT S DIR(0)="DO^:DT",DIR("A")="Enter Beginning Date (MM/DD/YY)"
"RTN","GMTSU",111,0)
 W ! D ^DIR I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) W ! Q
"RTN","GMTSU",112,0)
 S FROMDATE=Y I +FROMDATE>0 D
"RTN","GMTSU",113,0)
 . W "  (",$$UP^XLFSTR($$FMTE^XLFDT(+FROMDATE,1)),")"
"RTN","GMTSU",114,0)
 . N DIR,X,Y
"RTN","GMTSU",115,0)
 . S DIR(0)="DO^::EX",DIR("A")="Enter Ending Date (MM/DD/YY)"
"RTN","GMTSU",116,0)
 . S DIR("B")="TODAY"
"RTN","GMTSU",117,0)
 . D ^DIR
"RTN","GMTSU",118,0)
 . I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) K FROMDATE Q
"RTN","GMTSU",119,0)
 . I Y'>0 K FROMDATE Q
"RTN","GMTSU",120,0)
 . S TODATE=Y Q:TODATE>FROMDATE!(TODATE=FROMDATE) 
"RTN","GMTSU",121,0)
 . ; If 2nd date older than 1st date entered (Dates entered in reverse order)
"RTN","GMTSU",122,0)
 . N FRDT S FRDT=FROMDATE,FROMDATE=TODATE,TODATE=FRDT
"RTN","GMTSU",123,0)
 W !
"RTN","GMTSU",124,0)
 Q
"RTN","GMTSULT")
0^29^B42733150
"RTN","GMTSULT",1,0)
GMTSULT ; SLC/KER - HS Type Lookup                      ; 04/11/2000
"RTN","GMTSULT",2,0)
 ;;2.7;Health Summary;**30,35**;Oct 20, 1995
"RTN","GMTSULT",3,0)
 ;;
"RTN","GMTSULT",4,0)
 N DIC,DTOUT,DUOUT,DIRUT D DICHK S DIC(0)="AEMQZ" S Y=$$TYPE^GMTSULT
"RTN","GMTSULT",5,0)
 Q
"RTN","GMTSULT",6,0)
 ;                   
"RTN","GMTSULT",7,0)
EN ; Lookup (general)
"RTN","GMTSULT",8,0)
 Q:$G(DIC(0))["I"
"RTN","GMTSULT",9,0)
 K DTOUT,DUOUT N GMTSDICW,GMTSDICS,GMTSDIC,GMTSLGO,GMTSDIC0,GMTSDICB,GMTSDEF,GMTSWY,GMTSDISV,GMTSDICA,GMTSLERR,GMTSE,GMTSQ,GMTSX,DIR,DIRUT,DIROUT,GMTS
"RTN","GMTSULT",10,0)
 S GMTSE=$$ECHO D LD S U="^"
"RTN","GMTSULT",11,0)
 S (GMTSDEF,GMTSQ)=0,GMTSX=$G(X) S:$L(GMTSDIC0)&(GMTSDIC0'["A") GMTSQ=1 K Y
"RTN","GMTSULT",12,0)
 ;                   
"RTN","GMTSULT",13,0)
 ; Get X
"RTN","GMTSULT",14,0)
 ;   Ask the entry          DIC(0)["A" (INPUT^GMTSULT5)
"RTN","GMTSULT",15,0)
 S:GMTSDIC0'["A"&($L(GMTSX)) X=GMTSX
"RTN","GMTSULT",16,0)
 K GMTSLERR S:GMTSDIC0["A"!('$L(GMTSX)) X=$$INPUT^GMTSULT5
"RTN","GMTSULT",17,0)
 I $D(DTOUT)!($D(DUOUT)) S Y=-1 S:$D(DTOUT) DTOUT=1 S:$D(DUOUT) DUOUT=1 Q
"RTN","GMTSULT",18,0)
 ;   Is X an IEN            From Spacebar-Return
"RTN","GMTSULT",19,0)
 I $$XIEN(X) D  Q
"RTN","GMTSULT",20,0)
 . K Y S Y=+($$XIEN(X)) D Y^GMTSULT6(+Y),RD,CLR
"RTN","GMTSULT",21,0)
 ;   No Input or Error      X="" or X["^" or '$D(X)
"RTN","GMTSULT",22,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT))!($G(X)="")!($G(X)["^") D  Q
"RTN","GMTSULT",23,0)
 . K Y W !!,?5 W:'$L($G(GMTSLERR)) "No Health Summary Type selected"
"RTN","GMTSULT",24,0)
 . W:$L($G(GMTSLERR)) GMTSLERR W ! S Y=-1 D RD,CLR
"RTN","GMTSULT",25,0)
 ;   Exact Match Required   DIC(0)["X"
"RTN","GMTSULT",26,0)
 I GMTSDIC0["X",$L(X) D  Q
"RTN","GMTSULT",27,0)
 . K Y S Y=-1,GMTSX=$$EM^GMTSULT2(X) D:+GMTSX>0 Y^GMTSULT6(+GMTSX) D RD,CLR
"RTN","GMTSULT",28,0)
 ;                   
"RTN","GMTSULT",29,0)
 ; Select
"RTN","GMTSULT",30,0)
 ;   Get Selection List
"RTN","GMTSULT",31,0)
 D LIST^GMTSULT2(X)
"RTN","GMTSULT",32,0)
 ;   Select from multiple entries
"RTN","GMTSULT",33,0)
 D:+($G(^TMP("GMTSULT",$J,0)))>1 MULTI^GMTSULT6
"RTN","GMTSULT",34,0)
 ;   Select from one entry
"RTN","GMTSULT",35,0)
 D:+($G(^TMP("GMTSULT",$J,0)))=1 ONE^GMTSULT6
"RTN","GMTSULT",36,0)
 S:'$D(Y)!(+($G(Y))'>0) Y=-1
"RTN","GMTSULT",37,0)
 ;                   
"RTN","GMTSULT",38,0)
 ; DLAYGO allowed
"RTN","GMTSULT",39,0)
 ;   Add entry
"RTN","GMTSULT",40,0)
 I $L(X),Y=-1,$G(GMTSDIC0)["L",+($G(GMTSLGO))=142 D
"RTN","GMTSULT",41,0)
 . Q:$L(X)<3!($L(X)>30)  K Y(0) N DLAYGO,GMTSOD0,GMTSOX S GMTSOD0=DIC(0),GMTSOX=X
"RTN","GMTSULT",42,0)
 . N X,DA,DIC,DIK S DIC(0)="LM",(DIK,DIC)="^GMT(142,",DLAYGO=142,X=GMTSOX
"RTN","GMTSULT",43,0)
 . L +^GMT(142):2 W:'$T !,"  Can not add Health Summary Type, the file is in ",!,"  use by another user.  Please try again later."
"RTN","GMTSULT",44,0)
 . D:$T ADD L -^GMT(142) S (GMTSDIC0,DIC(0))=GMTSOD0
"RTN","GMTSULT",45,0)
 D RD,CLR
"RTN","GMTSULT",46,0)
 Q
"RTN","GMTSULT",47,0)
ADD ;   Add Health Summary Type
"RTN","GMTSULT",48,0)
 N GMTSOK S GMTSOK=+($$ASKA(X)) Q:'GMTSOK
"RTN","GMTSULT",49,0)
 S DA=$O(^GMT(142,"!"),-1) F  Q:'$D(^GMT(142,DA))  S DA=DA+1
"RTN","GMTSULT",50,0)
 I DA'>0!($D(^GMT(142,DA))) S Y=-1 Q
"RTN","GMTSULT",51,0)
 S $P(^GMT(142,DA,0),"^",1)=X D SI I '$D(^GMT(142,"B",$E(X,1,30),DA)) D KI K ^GMT(142,DA) S Y=-1 Q
"RTN","GMTSULT",52,0)
 S Y=DA_"^"_X_"^1"
"RTN","GMTSULT",53,0)
 Q
"RTN","GMTSULT",54,0)
ASKA(X) ; Ask if adding
"RTN","GMTSULT",55,0)
 N GMTSN,GMTSNX S GMTSN=$G(X) Q:'$L(X) 0
"RTN","GMTSULT",56,0)
 N DIR,DTOUT,DIROUT,DIRUT,DUOUT S GMTSNX=+($$N)+1,GMTSNX=$S(GMTSNX=0:"",GMTSNX=1:(GMTSNX_"st"),GMTSNX=2:(GMTSNX_"nd"),GMTSNX=3:(GMTSNX_"rd"),1:(GMTSNX_"th"))
"RTN","GMTSULT",57,0)
 S DIR(0)="YAO",DIR("A",1)="Are you adding '"_GMTSN_"' as ",DIR("A")="    a new HEALTH SUMMARY TYPE"_$S($L(GMTSNX):(" (the "_GMTSNX_")"),1:"")_"?   ",DIR("B")="No"
"RTN","GMTSULT",58,0)
 W ! D ^DIR S:$D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) X="^" S:X["^" X="^" Q:X="^" 0
"RTN","GMTSULT",59,0)
 S X=+($G(Y)) S:+X'>0 X=0 Q X
"RTN","GMTSULT",60,0)
N(X) ; Number of Types
"RTN","GMTSULT",61,0)
 N I S (I,X)=0 F  S I=$O(^GMT(142,I)) Q:+I=0  S X=X+1
"RTN","GMTSULT",62,0)
 Q X
"RTN","GMTSULT",63,0)
SI ;   Set Indexes
"RTN","GMTSULT",64,0)
 D MS N GMTSIEN,GMTSIX,GMTSOX,GMTSCD S GMTSIEN=+($G(DA)),GMTSOX=$G(X) Q:GMTSIEN'>0  Q:'$D(^GMT(142,GMTSIEN,0))  Q:'$L(X)  N X,DA
"RTN","GMTSULT",65,0)
 S DA=GMTSIEN,GMTSIX=0 F  S GMTSIX=$O(^TMP($J,142,.01,1,GMTSIX)) Q:+GMTSIX=0  D
"RTN","GMTSULT",66,0)
 . S X=$G(^TMP($J,142,.01,1,GMTSIX,1)) D ^DIM Q:'$D(X)  S GMTSCD=X,X=GMTSOX,DA=GMTSIEN X GMTSCD
"RTN","GMTSULT",67,0)
 D MK
"RTN","GMTSULT",68,0)
 Q
"RTN","GMTSULT",69,0)
KI ;   Kill Indexes
"RTN","GMTSULT",70,0)
 D MS N GMTSIEN,GMTSIX,GMTSOX,GMTSCD S GMTSIEN=+($G(DA)),GMTSOX=$G(X) N X,DA
"RTN","GMTSULT",71,0)
 S DA=GMTSIEN,GMTSIX=0 F  S GMTSIX=$O(^TMP($J,142,.01,1,GMTSIX)) Q:+GMTSIX=0  D
"RTN","GMTSULT",72,0)
 . S X=$G(^TMP($J,142,.01,1,GMTSIX,2)) D ^DIM Q:'$D(X)
"RTN","GMTSULT",73,0)
 . S GMTSCD=X,X=GMTSOX W !,GMTSCD,?60,X,?70,DA
"RTN","GMTSULT",74,0)
 D MK
"RTN","GMTSULT",75,0)
 Q
"RTN","GMTSULT",76,0)
MS ;   Merge Set
"RTN","GMTSULT",77,0)
 M ^TMP($J,142,.01,1)=^DD(142,.01,1) Q
"RTN","GMTSULT",78,0)
MK ;   Merge Kill
"RTN","GMTSULT",79,0)
 K ^TMP($J,141,.01,1) Q
"RTN","GMTSULT",80,0)
 ;                   
"RTN","GMTSULT",81,0)
 ; Sample Lookups
"RTN","GMTSULT",82,0)
DIC ;   DIC call (all types)
"RTN","GMTSULT",83,0)
 S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEQM" D ^DIC Q
"RTN","GMTSULT",84,0)
DIC2 ;   DIC call less Ad Hoc
"RTN","GMTSULT",85,0)
 S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION""" D ^DIC Q
"RTN","GMTSULT",86,0)
SL1 ;   Special Lookup (all types)
"RTN","GMTSULT",87,0)
 N DIC S DIC=142,DIC("A")="Select Health Summary Type: "
"RTN","GMTSULT",88,0)
 S DIC(0)="AEQ" S Y=$$TYPE^GMTSULT Q
"RTN","GMTSULT",89,0)
SL2 ;   Special Lookup less Ad Hoc
"RTN","GMTSULT",90,0)
 N DIC S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEQ",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION""" S Y=$$TYPE^GMTSULT Q
"RTN","GMTSULT",91,0)
SL3 ;   Special Lookup less Ad Hoc (w DLAYGO)
"RTN","GMTSULT",92,0)
 N DIC S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEQL",DLAYGO=142,DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION""" S Y=$$TYPE^GMTSULT Q
"RTN","GMTSULT",93,0)
SL4 ;   Special Lookup less Ad Hoc (w Exact Match req, DLAYGO)
"RTN","GMTSULT",94,0)
 N DIC S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="OAEQL",DLAYGO=142,DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION""" S Y=$$TYPE^GMTSULT Q
"RTN","GMTSULT",95,0)
 ;                   
"RTN","GMTSULT",96,0)
TYPE(GMTSI) ; Get Health Summary Type
"RTN","GMTSULT",97,0)
 ;                   
"RTN","GMTSULT",98,0)
 ;  S Y=$$TYPE^GMTSULT
"RTN","GMTSULT",99,0)
 ;                   
"RTN","GMTSULT",100,0)
 ;  Mandatory Preset Variables
"RTN","GMTSULT",101,0)
 ;                   
"RTN","GMTSULT",102,0)
 ;    DIC(0)
"RTN","GMTSULT",103,0)
 ;                   
"RTN","GMTSULT",104,0)
 ;  Optional Preset Variables
"RTN","GMTSULT",105,0)
 ;                   
"RTN","GMTSULT",106,0)
 ;    DIC("A")
"RTN","GMTSULT",107,0)
 ;    DIC("B")
"RTN","GMTSULT",108,0)
 ;    DLAYGO
"RTN","GMTSULT",109,0)
 ;                   
"RTN","GMTSULT",110,0)
 ;  Returns the Internal Entry Number of the
"RTN","GMTSULT",111,0)
 ;  selected Health Summary Type
"RTN","GMTSULT",112,0)
 ;                   
"RTN","GMTSULT",113,0)
 K Y S:$L($G(X)) X=$G(X)
"RTN","GMTSULT",114,0)
 D EN^GMTSULT S GMTSI=-1 S:+($G(Y))>0&($D(^GMT(142,+($G(Y)),0))) GMTSI=$G(Y) Q GMTSI
"RTN","GMTSULT",115,0)
 ;                   
"RTN","GMTSULT",116,0)
EN2 ; Lookup (Not Ad Hoc Summary)
"RTN","GMTSULT",117,0)
 D NA D EN Q
"RTN","GMTSULT",118,0)
NA ; DIC("S") (Not Ad Hoc Summary)
"RTN","GMTSULT",119,0)
 S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION""" Q
"RTN","GMTSULT",120,0)
XIEN(X) ; Is X in a Y or `IEN format  Quit +IEN
"RTN","GMTSULT",121,0)
 N GMTSX,GMTSL,GMTSI,GMTSNAM,GMTSY
"RTN","GMTSULT",122,0)
 S GMTSX=$G(X),GMTSL=$E(GMTSX,1),GMTSI=$E(GMTSX,2,$L(GMTSX))
"RTN","GMTSULT",123,0)
 I GMTSL="`",+GMTSI>0,+GMTSI=GMTSI,$D(^GMT(142,+GMTSI,0)),$L($P($G(^GMT(142,+GMTSI,0)),"^",1)) S X=GMTSI Q X
"RTN","GMTSULT",124,0)
 S GMTSI=$S($D(^GMT(142,+GMTSX,0)):+X,1:-1)
"RTN","GMTSULT",125,0)
 S GMTSNAM=$P($G(^GMT(142,+GMTSX,0)),"^",1)
"RTN","GMTSULT",126,0)
 I GMTSI=+GMTSX&(GMTSNAM=$P(GMTSX,"^",2)) S X=GMTSI Q X
"RTN","GMTSULT",127,0)
 Q 0
"RTN","GMTSULT",128,0)
LD ; Load DIC Variables
"RTN","GMTSULT",129,0)
 D DICHK S (DIC,GMTSDIC)="^GMT(142,",GMTSDIC0="AEM"
"RTN","GMTSULT",130,0)
 S:$L($G(DLAYGO)) GMTSLGO=$G(DLAYGO)
"RTN","GMTSULT",131,0)
 S GMTSDICA="Select HEALTH SUMMARY TYPE:  " K Y
"RTN","GMTSULT",132,0)
 S:$L($G(DIC("W"))) GMTSDICW=DIC("W")
"RTN","GMTSULT",133,0)
 S:$L($G(DIC("S"))) GMTSDICS=DIC("S")
"RTN","GMTSULT",134,0)
 S:$L($G(DIC("A"))) GMTSDICA=DIC("A")
"RTN","GMTSULT",135,0)
 S:$L($G(DIC("B"))) GMTSDICB=DIC("B")
"RTN","GMTSULT",136,0)
 S:$L($G(DIC(0))) GMTSDIC0=DIC(0)
"RTN","GMTSULT",137,0)
 Q
"RTN","GMTSULT",138,0)
DICHK ; Check DIC variables
"RTN","GMTSULT",139,0)
 N GMTSDISV,GMTSUSR,GMTSB
"RTN","GMTSULT",140,0)
 K DIC("DR"),DIC("P"),DIC("V"),DINUM,DTOUT,DUOUT
"RTN","GMTSULT",141,0)
 S GMTSUSR=+($G(DUZ)),GMTSDISV=+($G(^DISV(GMTSUSR,"^GMT(142,")))
"RTN","GMTSULT",142,0)
 S GMTSB=$P($G(^GMT(142,+GMTSDISV,0)),"^",1)
"RTN","GMTSULT",143,0)
 S:'$L($G(DIC(0))) DIC(0)="AEMZB" S:'$L($G(DIC)) DIC="^GMT(142,"
"RTN","GMTSULT",144,0)
 I +($G(GMTSE))=0 F  Q:DIC(0)'["E"  S DIC(0)=$P(DIC(0),"E",1)_$P(DIC(0),"E",2)
"RTN","GMTSULT",145,0)
 S:'$L($G(DIC("A"))) DIC("A")="Select HEALTH SUMMARY TYPE:  "
"RTN","GMTSULT",146,0)
 Q
"RTN","GMTSULT",147,0)
RD ; Restore DIC Variables
"RTN","GMTSULT",148,0)
 S:$L($G(GMTSDIC)) DIC=GMTSDIC
"RTN","GMTSULT",149,0)
 S:$L($G(GMTSDICS)) DIC("S")=GMTSDICS
"RTN","GMTSULT",150,0)
 S:$L($G(GMTSDICW)) DIC("W")=GMTSDICW
"RTN","GMTSULT",151,0)
 S:$L($G(GMTSDICA)) DIC("A")=GMTSDICA S:$L($G(GMTSDICB)) DIC("B")=GMTSDICB S:$L($G(GMTSDIC0)) DIC(0)=GMTSDIC0
"RTN","GMTSULT",152,0)
 I $L($G(X)),X["`" D
"RTN","GMTSULT",153,0)
 . N GMTSI,GMTSL S GMTSL=$E(X,1),GMTSI=$E(X,2,$L(X))
"RTN","GMTSULT",154,0)
 . I GMTSL="`",+GMTSI>0,$D(^GMT(142,+GMTSI,0)),$L($P($G(^GMT(142,+GMTSI,0)),"^",1)) S X=$P($G(^GMT(142,+GMTSI,0)),"^",1)
"RTN","GMTSULT",155,0)
 K GMTSDICS,GMTSDIC,GMTSDIC0,GMTSDICB,GMTSDISV,GMTSDICA Q
"RTN","GMTSULT",156,0)
ECHO(X) ; Echo Results (writes/reads)
"RTN","GMTSULT",157,0)
 S X=$$ROK("XWBLIB") Q:'X 1 S X=$$BROKER^XWBLIB Q:X 0 Q 1
"RTN","GMTSULT",158,0)
ROK(X) ; Routine OK (in UCI)
"RTN","GMTSULT",159,0)
 S X=$G(X) Q:'$L(X) 0 Q:$L(X)>8 0 X ^%ZOSF("TEST") Q:$T 1 Q 0
"RTN","GMTSULT",160,0)
CLR ;   Kill all global arrays used (this session)
"RTN","GMTSULT",161,0)
 K ^TMP("GMTSULT",$J),^TMP("GMTSULT2",$J) Q
"RTN","GMTSULT",162,0)
CLEAN ;   Kill temporary global array used
"RTN","GMTSULT",163,0)
 K ^TMP("GMTSULT2",$J) Q
"RTN","GMTSULT",164,0)
 ; Miscellaneous
"RTN","GMTSULT2")
0^30^B36134429
"RTN","GMTSULT2",1,0)
GMTSULT2 ; SLC/KER - HS Type Lookup (Search/List)   ; 04/11/2000
"RTN","GMTSULT2",2,0)
 ;;2.7;Health Summary;**30,32,35**;Oct 20, 1995
"RTN","GMTSULT2",3,0)
 ;
"RTN","GMTSULT2",4,0)
 Q
"RTN","GMTSULT2",5,0)
LIST(X) ; Get global array of Health Summary Types
"RTN","GMTSULT2",6,0)
 ;                      
"RTN","GMTSULT2",7,0)
 ;  LIST^GMTSULT2(<search string>)
"RTN","GMTSULT2",8,0)
 ;                      
"RTN","GMTSULT2",9,0)
 ;  ^TMP("GMTSULT",$J,#)
"RTN","GMTSULT2",10,0)
 ;                    
"RTN","GMTSULT2",11,0)
 ;     Piece 1 =  Internal Entry Number (IEN) in file 142
"RTN","GMTSULT2",12,0)
 ;     Piece 2 =  Health Summary Type Name
"RTN","GMTSULT2",13,0)
 ;     Piece 3 =  Health Summary Type Title
"RTN","GMTSULT2",14,0)
 ;     Piece 4 =  Health Summary Type Owner
"RTN","GMTSULT2",15,0)
 ;     Piece 5 =  Location Using Health Summary Type
"RTN","GMTSULT2",16,0)
 ;     Piece 6 =  Number of Components in Summary Type
"RTN","GMTSULT2",17,0)
 ;     Piece 7 =  Recommended Display Text (for 
"RTN","GMTSULT2",18,0)
 ;                selection or list box)
"RTN","GMTSULT2",19,0)
 ;                      
"RTN","GMTSULT2",20,0)
 ;  List Builder can use variable DIC("S") and DIC(0)
"RTN","GMTSULT2",21,0)
 ;                      
"RTN","GMTSULT2",22,0)
 ;     DIC("S") Screen out entries for selection/list
"RTN","GMTSULT2",23,0)
 ;                      
"RTN","GMTSULT2",24,0)
 ;     Processes DIC(0) N, OE (combination),X or B
"RTN","GMTSULT2",25,0)
 ;                      
"RTN","GMTSULT2",26,0)
 ;     Does not process DIC(0) components C or M.  Cross
"RTN","GMTSULT2",27,0)
 ;     reference suppression (C) is automatic in a multi-
"RTN","GMTSULT2",28,0)
 ;     term lookup, and the use of multiple indexes is
"RTN","GMTSULT2",29,0)
 ;     implied in the lookup and DD file structure.
"RTN","GMTSULT2",30,0)
 ;                      
"RTN","GMTSULT2",31,0)
 D CLR^GMTSULT N GMTSEO,GMTSEQ,GMTSIF,GMTSBI,GMTSIEN,GMTSWRDS,GMTSDS,GMTSD0
"RTN","GMTSULT2",32,0)
 S GMTSEO=+($$EMO),GMTSEQ=+($$EMQ),GMTSIF=+($$IF($G(X))),GMTSBI=+($$BI)
"RTN","GMTSULT2",33,0)
 S:$L($G(DIC("S")))&('$L($G(GMTSDICS))) GMTSDICS=$G(DIC("S")),GMTSDS=1
"RTN","GMTSULT2",34,0)
 S:$L($G(DIC(0)))&('$L($G(GMTSDIC0))) GMTSDIC0=$G(DIC(0)),GMTSD0=1
"RTN","GMTSULT2",35,0)
 I GMTSIF S GMTSIEN=$$IENF(X) I +GMTSIEN>0 D IENS(GMTSIEN) G:$D(^TMP("GMTSULT",$J,1)) LQ
"RTN","GMTSULT2",36,0)
 I GMTSBI D B^GMTSULT7 G LQ
"RTN","GMTSULT2",37,0)
 D PAR,FND,REO^GMTSULT3
"RTN","GMTSULT2",38,0)
 Q
"RTN","GMTSULT2",39,0)
LQ ; Quit List
"RTN","GMTSULT2",40,0)
 K:+($G(GMTSDS))>0 GMTSDICS K:+($G(GMTSD0))>0 GMTSDIC0
"RTN","GMTSULT2",41,0)
 Q
"RTN","GMTSULT2",42,0)
 ;                      
"RTN","GMTSULT2",43,0)
FND ; Find Health Summary Types (word search)
"RTN","GMTSULT2",44,0)
 N GMTSB,GMTSC,GMTSCTL,GMTSFND,GMTSI,GMTSI1,GMTSI2,GMTSI3,GMTSDS,GMTSD0,GMTSLEX,GMTSLEXM,GMTSASM,GMTSCMP,GMTSLOC,GMTSNAM,GMTSOK,GMTSRC,GMTSOW,GMTSTMP,GMTSTTL,GMTSWDS,GMTSRD,GMTSWRD,Y
"RTN","GMTSULT2",45,0)
 ;   Echo             E or broker
"RTN","GMTSULT2",46,0)
 S GMTSTMP=+($G(GMTSE)),GMTSIF=0 S:'$D(GMTSE) GMTSTMP=$$ECHO^GMTSULT N GMTSE S GMTSE=GMTSTMP,U="^"
"RTN","GMTSULT2",47,0)
 ;   Exact Match      X
"RTN","GMTSULT2",48,0)
 S GMTSLEX=$$EM(X) D:$G(GMTSDIC0)["X"&(GMTSLEX'>0) CLR^GMTSULT G:$G(GMTSDIC0)["X"&(GMTSLEX'>0) FNDQ
"RTN","GMTSULT2",49,0)
 S:+GMTSLEX>0 ^TMP("GMTSULT2",$J,"EM")=+GMTSLEX,^TMP("GMTSULT2",$J,"IEN",+GMTSLEX)=""
"RTN","GMTSULT2",50,0)
 ;   One Exact Match  OE
"RTN","GMTSULT2",51,0)
 S GMTSLEXM=0 S:$G(GMTSDIC0)["O"&($G(GMTSDIC0)["E") GMTSLEXM=1
"RTN","GMTSULT2",52,0)
 ;   Word Search
"RTN","GMTSULT2",53,0)
 S GMTSWDS=$O(GMTSWRDS(" "),-1) S GMTSWRD=$G(GMTSWRDS(1))
"RTN","GMTSULT2",54,0)
 G:'$L(GMTSWRD) FNDQ S GMTSCTL=GMTSWRD,GMTSWRD=$E(GMTSWRD,1,($L(GMTSWRD)-1))_$C($A($E(GMTSWRD,$L(GMTSWRD)))-1)_"~"
"RTN","GMTSULT2",55,0)
 S:+GMTSCTL=GMTSCTL GMTSWRD=GMTSCTL-1
"RTN","GMTSULT2",56,0)
 F  S GMTSWRD=$O(^GMT(142,"AW",GMTSWRD)) Q:GMTSWRD=""!($E(GMTSWRD,1,$L(GMTSCTL))'=GMTSCTL)  D
"RTN","GMTSULT2",57,0)
 . S (GMTSC,GMTSI1)=0
"RTN","GMTSULT2",58,0)
 . F  S GMTSI1=$O(^GMT(142,"AW",GMTSWRD,GMTSI1)) Q:+GMTSI1=0  D
"RTN","GMTSULT2",59,0)
 . . N GMTSIEN,GMTSKWRD S GMTSIEN=GMTSI1,GMTSKWRD=GMTSWRD
"RTN","GMTSULT2",60,0)
 . . D SM^GMTSULT3
"RTN","GMTSULT2",61,0)
 ;   Check for exact match in results
"RTN","GMTSULT2",62,0)
 S GMTSI=+($G(^TMP("GMTSULT2",$J,"EMI")))
"RTN","GMTSULT2",63,0)
 S GMTSB=$G(^TMP("GMTSULT2",$J,"EMB")) I GMTSI>0,$L(GMTSB)>0 D
"RTN","GMTSULT2",64,0)
 . S ^TMP("GMTSULT2",$J,"E")=$G(^TMP("GMTSULT2",$J,GMTSI))
"RTN","GMTSULT2",65,0)
 . K ^TMP("GMTSULT2",$J,GMTSI),^TMP("GMTSULT2",$J,"B",GMTSB),^TMP("GMTSULT2",$J,"EMB"),^TMP("GMTSULT2",$J,"EMI"),^TMP("GMTSULT2",$J,"EM")
"RTN","GMTSULT2",66,0)
FNDQ ; Find Quit
"RTN","GMTSULT2",67,0)
 K:+($G(GMTSDS))>0 GMTSDICS K:+($G(GMTSD0))>0 GMTSDIC0
"RTN","GMTSULT2",68,0)
 Q
"RTN","GMTSULT2",69,0)
 ;                      
"RTN","GMTSULT2",70,0)
PAR ; Parse User Input
"RTN","GMTSULT2",71,0)
 K GMTSWRDS N GMTSC,GMTSCT,GMTSPSN,GMTSTR,GMTSWRD
"RTN","GMTSULT2",72,0)
 S U="^",GMTSTR=$G(X) Q:'$L(GMTSTR)  S GMTSC=1,GMTSCT=0 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSULT2",73,0)
 . S GMTSWRD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWRD D
"RTN","GMTSULT2",74,0)
 . . S GMTSWRD=$TR($E($E(GMTSTR,GMTSC,GMTSPSN-1),1,30),"""",""),GMTSC=GMTSPSN+1
"RTN","GMTSULT2",75,0)
 . . I $L(GMTSWRD)>0 S GMTSCT=GMTSCT+1,GMTSWRDS(GMTSCT)=$$UP(GMTSWRD)
"RTN","GMTSULT2",76,0)
 Q
"RTN","GMTSULT2",77,0)
IENF(X) ; Internal Entry Number Find
"RTN","GMTSULT2",78,0)
 N GMTS0,GMTSI S GMTSI=$G(X),X=$G(X),GMTS0=$G(DIC(0)) S:$E(X,1)="`" GMTSI=$E(GMTSI,2,$L(GMTSI)) S GMTSI=+GMTSI
"RTN","GMTSULT2",79,0)
 I GMTS0["N",+GMTSI>0,$D(^GMT(142,+GMTSI,0)) S X=+GMTSI Q X
"RTN","GMTSULT2",80,0)
 I $E(X,1)="`",+GMTSI>0,$D(^GMT(142,+GMTSI,0)) S X=+GMTSI Q X
"RTN","GMTSULT2",81,0)
 Q -1
"RTN","GMTSULT2",82,0)
IENS(X) ; Internal Entry Number Save
"RTN","GMTSULT2",83,0)
 N GMTSI1,GMTSI2,GMTSI3,GMTSIEN S (GMTSIEN,GMTSI1)=+X Q:+GMTSI1=0  Q:'$D(^GMT(142,+GMTSI1,0))
"RTN","GMTSULT2",84,0)
 D SM^GMTSULT3,REO^GMTSULT3
"RTN","GMTSULT2",85,0)
 Q
"RTN","GMTSULT2",86,0)
CM(X) ; Get Number of Components
"RTN","GMTSULT2",87,0)
 S X=+($G(X)) Q:X=0 "No components" Q:'$D(^GMT(142,+X,1)) "No components"
"RTN","GMTSULT2",88,0)
 N GMTSI,GMTSC S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,+X,1,GMTSI)) Q:+GMTSI=0  S GMTSC=GMTSC+1
"RTN","GMTSULT2",89,0)
 S X=$S(+GMTSC>1:(+GMTSC_" components"),+GMTSC=1:(+GMTSC_" component"),1:"No components")
"RTN","GMTSULT2",90,0)
 Q X
"RTN","GMTSULT2",91,0)
EM(X) ; Exact Match when DIC(0) contains X
"RTN","GMTSULT2",92,0)
 S X=$G(X) Q:'$L(X) -1 N GMTSC,GMTSI,GMTSM,GMTSN,GMTSO,GMTSU S U="^"
"RTN","GMTSULT2",93,0)
 S GMTSU=$$UP(X),(GMTSC,GMTSO)=$$UP($E(X,1,30)),GMTSM=0,GMTSO=$E(GMTSO,1,($L(GMTSO)-1))_$C($A($E(GMTSO,$L(GMTSO)))-1)_"~",GMTSM=0
"RTN","GMTSULT2",94,0)
 F  S GMTSO=$O(^GMT(142,"AB",GMTSO)) Q:GMTSO=""!(GMTSO'[GMTSC)  D  Q:+GMTSM>0
"RTN","GMTSULT2",95,0)
 . S GMTSI=0 F  S GMTSI=$O(^GMT(142,"AB",GMTSO,GMTSI)) Q:+GMTSI=0  D  Q:+GMTSM>0
"RTN","GMTSULT2",96,0)
 . . S GMTSN=$P($G(^GMT(142,+GMTSI,0)),U,1) S:$$UP(GMTSN)=GMTSU GMTSM=GMTSI_U_GMTSN
"RTN","GMTSULT2",97,0)
 S:+GMTSM=0 GMTSM=-1 S X=GMTSM D Y^GMTSULT6(+GMTSM)
"RTN","GMTSULT2",98,0)
 Q X
"RTN","GMTSULT2",99,0)
 ;                      
"RTN","GMTSULT2",100,0)
DICS(S,X,DA) ; Check DIC("S") Screen
"RTN","GMTSULT2",101,0)
 ;   LAYGO allowed (no screen)
"RTN","GMTSULT2",102,0)
 I +($G(GMTSLGO))=142,$G(GMTSDIC0)["L" Q 1
"RTN","GMTSULT2",103,0)
 ;   LAYGO not allowed (screen)
"RTN","GMTSULT2",104,0)
 N Y,GMTST,GMTSOX,GMTSDICS S GMTSDICS=$G(S),GMTSOX=$G(X) S X=GMTSDICS Q:'$L(GMTSDICS) 1
"RTN","GMTSULT2",105,0)
 D ^DIM Q:'$L($G(X)) 1
"RTN","GMTSULT2",106,0)
 S (Y,DA)=+($G(DA)),GMTST=$G(^GMT(142,+Y,0)),X=GMTSOX X GMTSDICS S X=$T Q X
"RTN","GMTSULT2",107,0)
 ;                      
"RTN","GMTSULT2",108,0)
 ; Processing flags
"RTN","GMTSULT2",109,0)
EMQ(X) ;   Exact match flag
"RTN","GMTSULT2",110,0)
 N GMTS0 S X=0,GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",111,0)
 S:$G(GMTS0)["X" X=1 Q X
"RTN","GMTSULT2",112,0)
EMO(X) ;   Exact match flag, only one
"RTN","GMTSULT2",113,0)
 N GMTS0 S X=0 S GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",114,0)
 S:$G(GMTS0)["O"&($G(GMTS0)["E") X=1 Q X
"RTN","GMTSULT2",115,0)
BI(X) ;   Use the B Index flag
"RTN","GMTSULT2",116,0)
 N GMTS0 S X=0 S GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",117,0)
 S:$G(GMTS0)["B" X=1 Q X
"RTN","GMTSULT2",118,0)
IF(X) ;   Internal Entry Number Flag
"RTN","GMTSULT2",119,0)
 N GMTS0,GMTSI S GMTSI=0,GMTS0=$G(DIC(0)) Q:'$L($G(X)) 0
"RTN","GMTSULT2",120,0)
 I $E(X,1)="`",$L($G(^GMT(142,+($E(X,2,$L(X))),0))) S GMTSI=1
"RTN","GMTSULT2",121,0)
 I +X>0,$L($G(^GMT(142,+X,0))),GMTS0["N" S GMTSI=1
"RTN","GMTSULT2",122,0)
 S X=GMTSI Q X
"RTN","GMTSULT2",123,0)
 ;                      
"RTN","GMTSULT2",124,0)
 ; TMP Global
"RTN","GMTSULT2",125,0)
TMP ;   Show first ^TMP Global
"RTN","GMTSULT2",126,0)
 N GMTSND,GMTSNC,GMTSNQ,GMTSC,GMTSTMP
"RTN","GMTSULT2",127,0)
 S GMTSC=0,GMTSTMP="",GMTSNQ="^TMP(""GMTSULT2"","_$J_")",GMTSNC="^TMP(""GMTSULT2"","_$J_","
"RTN","GMTSULT2",128,0)
 F  S GMTSNQ=$Q(@GMTSNQ) Q:GMTSNQ=""!(GMTSNQ'[GMTSNC)  D
"RTN","GMTSULT2",129,0)
 . S GMTSC=GMTSC+1 W:GMTSC=1 ! S GMTSND=@GMTSNQ W !,GMTSNQ,"=",GMTSND
"RTN","GMTSULT2",130,0)
 W:GMTSC>0 !
"RTN","GMTSULT2",131,0)
TMP2 ;   Show second ^TMP Global
"RTN","GMTSULT2",132,0)
 S GMTSC=0,GMTSNQ="^TMP(""GMTSULT"","_$J_")",GMTSNC="^TMP(""GMTSULT"","_$J_","
"RTN","GMTSULT2",133,0)
 F  S GMTSNQ=$Q(@GMTSNQ) Q:GMTSNQ=""!(GMTSNQ'[GMTSNC)  D
"RTN","GMTSULT2",134,0)
 . S GMTSC=GMTSC+1 W:'$D(GMTSTMP)&(GMTSC=1) ! S GMTSND=@GMTSNQ W !,GMTSNQ,"=",GMTSND
"RTN","GMTSULT2",135,0)
 W:GMTSC>0 !
"RTN","GMTSULT2",136,0)
 Q
"RTN","GMTSULT2",137,0)
 ; Miscellaneous
"RTN","GMTSULT2",138,0)
UP(X) ;   Uppercase
"RTN","GMTSULT2",139,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSULT2",140,0)
OW(X) ;   Mix Case (owner name)
"RTN","GMTSULT2",141,0)
 Q:$G(X)'["," $$EN^GMTSUMX($G(X))
"RTN","GMTSULT2",142,0)
 Q $$EN^GMTSUMX(($P($G(X),",",1)_", "_$P($G(X),",",2)))
"RTN","GMTSULT2",143,0)
MX(X) ;   Mix Case
"RTN","GMTSULT2",144,0)
 Q $$EN^GMTSUMX(X)
"RTN","GMTSULT5")
0^31^B16737846
"RTN","GMTSULT5",1,0)
GMTSULT5 ; SLC/KER - HS Type Lookup (User Input)  ; 04/11/2000
"RTN","GMTSULT5",2,0)
 ;;2.7;Health Summary;**30,35**;Oct 20, 1995
"RTN","GMTSULT5",3,0)
 ;;
"RTN","GMTSULT5",4,0)
 Q
"RTN","GMTSULT5",5,0)
 ;                        
"RTN","GMTSULT5",6,0)
INPUT(X) ; Get User's Input
"RTN","GMTSULT5",7,0)
 N Y,GMTSDISV,GMTSB,GMTSD,DIR S GMTSDISV=0 D GDISV
"RTN","GMTSULT5",8,0)
 S DIR(0)="FAO^1:30^N GMTS S X=$$DEF^GMTSULT5(X),GMTS=$$INPT^GMTSULT5(X) K:'GMTS X"
"RTN","GMTSULT5",9,0)
 S DIR("?")="^D IN1^GMTSULT5",DIR("??")="^D IN2^GMTSULT5"
"RTN","GMTSULT5",10,0)
 S:'$L($G(GMTSDICA)) DIR("A")="Select HEALTH SUMMARY TYPE:  " S:$L($G(GMTSDICA)) DIR("A")=GMTSDICA
"RTN","GMTSULT5",11,0)
 S GMTSD=0 S:$L($G(GMTSDICB)) DIR("A")=DIR("A")_$G(GMTSDICB)_"//  "
"RTN","GMTSULT5",12,0)
 I $L($G(DIR("B"))) W !,DIR("A") S X=DIR("B") Q X
"RTN","GMTSULT5",13,0)
 D ^DIR K:X=""&($L($G(GMTSDICB)))&('$D(DTOUT)) DIRUT
"RTN","GMTSULT5",14,0)
 S:X=""&($L($G(GMTSDICB))) (X,Y)=GMTSDICB,GMTSDEF=1 Q:$D(DTOUT)!($D(DUOUT)) X
"RTN","GMTSULT5",15,0)
 S:X=" "&($L(Y))&($G(GMTSDIC0)'["F")&(GMTSDISV>0)&($L($P($G(^GMT(142,+GMTSDISV,0)),"^",1))) X="`"_GMTSDISV
"RTN","GMTSULT5",16,0)
 Q X
"RTN","GMTSULT5",17,0)
 ;                        
"RTN","GMTSULT5",18,0)
 ; Help
"RTN","GMTSULT5",19,0)
IN1 ;   Single Question Mark Help ? for User Input
"RTN","GMTSULT5",20,0)
 N %,%A,%B,%B1,%B2,%B3,%BA,%C,%E,%G,%H,%I,%J,%N,%P,%S,%T,%W,%X,%Y,%BU,%J1,%A0,%W0,%D1,%D2,%DT,%K,%M
"RTN","GMTSULT5",21,0)
 I X=" "&($G(GMTSDIC0)'["F") D  Q
"RTN","GMTSULT5",22,0)
 . D GDISV
"RTN","GMTSULT5",23,0)
 . S:+($G(GMTSDISV))>0 X=$P($G(^GMT(142,+($G(GMTSDISV)),0)),U,1),(Y,GMTSD)=+GMTSDISV
"RTN","GMTSULT5",24,0)
 D GHT Q
"RTN","GMTSULT5",25,0)
IN2 ;   Double Question Mark Help ? with listing
"RTN","GMTSULT5",26,0)
 N %,%A,%B,%B1,%B2,%B3,%BA,%C,%E,%G,%H,%I,%J,%N,%P,%S,%T,%W,%X,%Y,%BU,%J1,%A0,%W0,%D1,%D2,%DT,%K,%M
"RTN","GMTSULT5",27,0)
 W !!,"Choose from:"
"RTN","GMTSULT5",28,0)
 N GMTSHS,GMTSC,GMTSCT,GMTSIEN,GMTSOK,GMTSTR,GMTSTL,GMTST,GMTSPL,GMTSTT,GMTSRR
"RTN","GMTSULT5",29,0)
 S (GMTSC,GMTST)=0,GMTSCT=1,GMTSHS="",GMTSPL=+($G(IOSL))-8 S:GMTSPL'>0 GMTSPL=18
"RTN","GMTSULT5",30,0)
 S GMTSTT=0,GMTSHS="" F  S GMTSHS=$O(^GMT(142,"B",GMTSHS)) Q:GMTSHS=""  S GMTSIEN=0 F  S GMTSIEN=$O(^GMT(142,"B",GMTSHS,GMTSIEN)) Q:+GMTSIEN=0  S GMTSTT=GMTSTT+1
"RTN","GMTSULT5",31,0)
 S GMTSRR=GMTSTT F  S GMTSHS=$O(^GMT(142,"B",GMTSHS)) Q:GMTSHS=""!('GMTSCT)  Q:GMTST>0  D  Q:'GMTSCT  Q:GMTST>0
"RTN","GMTSULT5",32,0)
 . S GMTSIEN=0 F  S GMTSIEN=$O(^GMT(142,"B",GMTSHS,GMTSIEN)) Q:+GMTSIEN=0!('GMTSCT)  Q:GMTST>0  D  Q:'GMTSCT  Q:+GMTST>0
"RTN","GMTSULT5",33,0)
 . . S GMTSTL="",GMTSOK=1,GMTSTR=$P($G(^GMT(142,GMTSIEN,0)),U,1) Q:'$L(GMTSTR)
"RTN","GMTSULT5",34,0)
 . . S GMTSOK=1 I $L($G(GMTSDICS)) S GMTSOK=$$DICS^GMTSULT2(GMTSDICS,X,GMTSIEN) Q:'GMTSOK
"RTN","GMTSULT5",35,0)
 . . F  Q:$L(GMTSTR)>33  S GMTSTR=GMTSTR_" "
"RTN","GMTSULT5",36,0)
 . . S GMTSTL=$P($G(^GMT(142,GMTSIEN,"T")),U,1)
"RTN","GMTSULT5",37,0)
 . . S:$L(GMTSTL) GMTSTR=GMTSTR_GMTSTL
"RTN","GMTSULT5",38,0)
 . . S GMTSC=GMTSC+1,GMTSRR=GMTSRR-1 W !,?3,GMTSTR I +GMTSC>GMTSPL D IN2C S GMTSC=0
"RTN","GMTSULT5",39,0)
 W ! D:GMTST'>1 GHT Q
"RTN","GMTSULT5",40,0)
IN2C ;   Ask to Continue Listing
"RTN","GMTSULT5",41,0)
 N X W !,?3,"""^"" TO STOP:" R X:300
"RTN","GMTSULT5",42,0)
 S:'$T!(X["^") GMTSC=0 S:X["^" GMTST=1
"RTN","GMTSULT5",43,0)
 S:X["^^" GMTST=2 Q
"RTN","GMTSULT5",44,0)
GHT ;   General Help Text
"RTN","GMTSULT5",45,0)
 W !,?5,"Answer with Health Summary Type name, title, owner or hospital"
"RTN","GMTSULT5",46,0)
 W !,?5,"location using the summary.  Your response must be at least 2"
"RTN","GMTSULT5",47,0)
 W !,?5,"characters and no more than 30 characters and must not contain"
"RTN","GMTSULT5",48,0)
 W !,?5,"an embedded uparrow" Q
"RTN","GMTSULT5",49,0)
 ;                        
"RTN","GMTSULT5",50,0)
 ; Defaults values
"RTN","GMTSULT5",51,0)
DEF(X) ;   Default
"RTN","GMTSULT5",52,0)
 S X=$G(X)
"RTN","GMTSULT5",53,0)
 I +X>0,$D(^GMT(142,+X,0)),($G(GMTSDIC0)["N"!($G(GMTSDIC0)["N")) D  Q X
"RTN","GMTSULT5",54,0)
 . S (Y,GMTSD)=+X,X=$P($G(^GMT(142,+Y,0)),U,1)
"RTN","GMTSULT5",55,0)
 I $E(X,1)="`",+($E(X,2,$L(X)))>0,$D(^GMT(142,+($E(X,2,$L(X))),0)) D  Q X
"RTN","GMTSULT5",56,0)
 . S (Y,GMTSD)=+($E(X,2,$L(X))),X=$P($G(^GMT(142,+Y,0)),U,1)
"RTN","GMTSULT5",57,0)
 I X=" "&($G(GMTSDIC0)'["F") D
"RTN","GMTSULT5",58,0)
 . D GDISV S:+($G(GMTSDISV))>0 X=$P($G(^GMT(142,+($G(GMTSDISV)),0)),U,1),(Y,GMTSD)=+GMTSDISV
"RTN","GMTSULT5",59,0)
 Q X
"RTN","GMTSULT5",60,0)
GDISV ;   Get Default Value (Spacebar-Return)
"RTN","GMTSULT5",61,0)
 Q:+($G(DUZ))=0  Q:'$L($P($G(^VA(200,+($G(DUZ)),0)),"^",1))
"RTN","GMTSULT5",62,0)
 Q:'$D(^DISV(+($G(DUZ)),"^GMT(142,"))  S GMTSDISV=+($G(^DISV(+($G(DUZ)),"^GMT(142,")))
"RTN","GMTSULT5",63,0)
 Q
"RTN","GMTSULT5",64,0)
 ;                        
"RTN","GMTSULT5",65,0)
 ; Miscellaneous
"RTN","GMTSULT5",66,0)
INPT(X) ;   Input Transform
"RTN","GMTSULT5",67,0)
 N %,%A,%B,%B1,%B2,%B3,%BA,%C,%E,%G,%H,%I,%J,%N,%P,%S,%T,%W,%X,%Y,%BU,%J1,%A0,%W0,%D1,%D2,%DT,%K,%M
"RTN","GMTSULT5",68,0)
 N GMTSINPT,GMTSI,GMTST S (GMTST,X)=$G(X) I $L(X)=1,X'=" " Q 0
"RTN","GMTSULT5",69,0)
 I X=" "&($G(GMTSDIC0)'["F") D
"RTN","GMTSULT5",70,0)
 . D GDISV S:+($G(GMTSDISV))>0 X=$P($G(^GMT(142,+($G(GMTSDISV)),0)),U,1),(Y,GMTSD)=+GMTSDISV
"RTN","GMTSULT5",71,0)
 K ^TMP("GMTSULT",$J),^TMP("GMTSULT2",$J) S GMTSINPT="" D LIST^GMTSULT2(X) S X=$S($D(^TMP("GMTSULT",$J,0)):1,1:0)
"RTN","GMTSULT5",72,0)
 I +X=0,$L($G(GMTST))>2,$L($G(GMTST))<31,+($G(GMTSLGO))=142,$G(GMTSDIC0)["L" S X=1 Q X
"RTN","GMTSULT5",73,0)
 K ^TMP("GMTSULT",$J),^TMP("GMTSULT2",$J) Q X
"RTN","GMTSUP")
0^11^B16334574
"RTN","GMTSUP",1,0)
GMTSUP ; SLC/KER - Utilities for Paging HS           ; 04/11/2000
"RTN","GMTSUP",2,0)
 ;;2.7;Health Summary;**2,7,21,27,28,30,35**;Oct 20, 1995
"RTN","GMTSUP",3,0)
 ;
"RTN","GMTSUP",4,0)
CKP ; Check page position, pause and prompt
"RTN","GMTSUP",5,0)
 Q:$D(GMTSQIT)
"RTN","GMTSUP",6,0)
 S GMTSNPG=0
"RTN","GMTSUP",7,0)
 I $G(GMTSWRIT)=1 D
"RTN","GMTSUP",8,0)
 . D BREAK
"RTN","GMTSUP",9,0)
 . S GMTSWRIT=0
"RTN","GMTSUP",10,0)
 I +($$HF^GMTSU) D BREAK:(GMTSEGN'=$G(GMTSLCMP)) Q
"RTN","GMTSUP",11,0)
 Q:+$G(GMTSLPG)'>0&($Y'>(IOSL-GMTSLO))
"RTN","GMTSUP",12,0)
 I $E(IOST,1)="C" S:'$D(GMTSTOF) GMTSTOF=1 D CKP1
"RTN","GMTSUP",13,0)
 I '$D(GMTSQIT) W @IOF D HEADER,BREAK S GMTSNPG=1,GMTSTOF=GMTSEGN
"RTN","GMTSUP",14,0)
 I $D(GMTSQIT),(GMTSQIT]""),($D(GMTSTYP)) W @IOF D HEADER S GMTSTOF=GMTSEGN
"RTN","GMTSUP",15,0)
 Q
"RTN","GMTSUP",16,0)
CKP1 ;Help Display of Optional Components for Navigation
"RTN","GMTSUP",17,0)
 N DA,I,J,K,L,X,XQORM,Y,GMTSY,TYP,DIC
"RTN","GMTSUP",18,0)
 I $S('$D(GMTSTYP):1,$D(GMTOPT):1,1:0) N DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!(GMTSLPG) GMTSQIT="" Q
"RTN","GMTSUP",19,0)
 S TYP=GMTSTYP
"RTN","GMTSUP",20,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION" S Y=$$TYPE^GMTSULT
"RTN","GMTSUP",21,0)
 S GMTSTYP=+Y K DIC,X,Y
"RTN","GMTSUP",22,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="1AF\+",XQORM("A")="Press <RET> to continue, ^ to exit, or select component: "
"RTN","GMTSUP",23,0)
 S XQORM("??")="D HELP^GMTSUP1" I GMTSLPG W "* END * "
"RTN","GMTSUP",24,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")"
"RTN","GMTSUP",25,0)
 D ^XQORM W ! D @$S(Y=1:"BRNCH",1:"EVAL")
"RTN","GMTSUP",26,0)
 I $D(GMTSY),(GMTSY=0) K GMTSY G CKP1
"RTN","GMTSUP",27,0)
 S GMTSTYP=TYP
"RTN","GMTSUP",28,0)
 Q
"RTN","GMTSUP",29,0)
BREAK ; Writes the component header
"RTN","GMTSUP",30,0)
 S:'$D(GMTSLCMP) GMTSLCMP=0
"RTN","GMTSUP",31,0)
 S GMTS="",GMTSNPG=1,$P(GMTS,"-",79-$L(GMTSEGH_GMTSEGL)/2)="",GMTS=GMTS_" "_GMTSEGH_GMTSEGL_" "_GMTS
"RTN","GMTSUP",32,0)
 I $Y'>(IOSL-GMTSLO)!(+($$HF^GMTSU)) W !,GMTS,! W:$Y'>(IOSL-GMTSLO) ?34,$S(GMTSEGN=GMTSLCMP:"(continued)",1:""),! S GMTSLCMP=GMTSEGN
"RTN","GMTSUP",33,0)
 Q
"RTN","GMTSUP",34,0)
HEADER ; Print Running Header
"RTN","GMTSUP",35,0)
 N GMTSVDT,DATA
"RTN","GMTSUP",36,0)
 ; GMTSCDT(0) may contain multiple dates that could cause a line to
"RTN","GMTSUP",37,0)
 ; wrap inappropriately. If this creates a problem, a change will be
"RTN","GMTSUP",38,0)
 ; required to accommodate it.
"RTN","GMTSUP",39,0)
 S DATA=""
"RTN","GMTSUP",40,0)
 I +$G(GMTSPXD1)&+$G(GMTSPXD2) D
"RTN","GMTSUP",41,0)
 . S DATA="Printed for data "
"RTN","GMTSUP",42,0)
 . I GMTSPXD1=GMTSPXD2 S DATA=DATA_"on "_GMTSPXD1 Q
"RTN","GMTSUP",43,0)
 . S DATA=DATA_"from "_GMTSPXD2_" to "_GMTSPXD1
"RTN","GMTSUP",44,0)
 I $D(GMTSCDT(0)) S GMTSVDT=GMTSCDT(0) S:GMTSDTM'["Printed:" GMTSDTM="Printed: "_GMTSDTM
"RTN","GMTSUP",45,0)
 W !,$S($L($P($G(GMTSSC),U,2)):"Location: "_$P(GMTSSC,U,2)_" ",1:""),$S($D(GMTSVDT):GMTSVDT,1:""),DATA,?(79-$L(GMTSDTM)),GMTSDTM
"RTN","GMTSUP",46,0)
 S:'$D(GMTSPG) GMTSPG=0 S GMTSPG=GMTSPG+1,GMTSHDR=" CONFIDENTIAL "_GMTSTITL_" SUMMARY "_$S($E(IOST,1)="C":"",1:"  pg. "_GMTSPG) S GMTS="",$P(GMTS,"*",(77-$L(GMTSHDR))\2)="*" S GMTSHDR=GMTS_" "_GMTSHDR_" "_GMTS
"RTN","GMTSUP",47,0)
 W !,GMTSHDR,"*"
"RTN","GMTSUP",48,0)
 I '$D(GMTSLFG) D
"RTN","GMTSUP",49,0)
 . ;GMTSPHDR (patient header) is setup in DEM^GMTSU.
"RTN","GMTSUP",50,0)
 . I $G(GMTSPHDR("TWO")) D
"RTN","GMTSUP",51,0)
 .. W !,GMTSPHDR("NMSSN"),?GMTSPHDR("DOBS"),GMTSPHDR("DOB"),!?GMTSPHDR("WARDRBS"),GMTSPHDR("WARDRB"),!
"RTN","GMTSUP",52,0)
 . E  W !,GMTSPHDR("NMSSN"),?GMTSPHDR("WARDRBS"),GMTSPHDR("WARDRB"),?GMTSPHDR("DOBS"),GMTSPHDR("DOB"),!
"RTN","GMTSUP",53,0)
 W:+$G(VADM(6)) ?26,"** DECEASED   "_$P(VADM(6),U,2)_" **"
"RTN","GMTSUP",54,0)
 Q
"RTN","GMTSUP",55,0)
BRNCH ;Checks for appropriate abbreviation to branch to a different component
"RTN","GMTSUP",56,0)
 N GMTINX,LIM,CREC,SBS
"RTN","GMTSUP",57,0)
 I Y,("+-"[X) S:X="-" GMTSEGN=GMTSTOF-1 S (GMTSY,GMTSQIT)=1,GMTSLPG=0 Q
"RTN","GMTSUP",58,0)
 I X="^^" S DIROUT=1,GMTSQIT="" Q
"RTN","GMTSUP",59,0)
 I Y,(X?1"^^".E) D  Q
"RTN","GMTSUP",60,0)
 .N GMTSAV
"RTN","GMTSUP",61,0)
 .S GMTSAV=X D RJUMP^GMTSUP1
"RTN","GMTSUP",62,0)
 .I GMTSAV'["?" S (GMTSQIT,GMTSY)=1,GMTSEGN=GMTSTOF-1,GMTSLPG=0
"RTN","GMTSUP",63,0)
 .E  S GMTSY=0
"RTN","GMTSUP",64,0)
 S GMTINX=$S($D(^GMT(142,GMTSTYP,1,+Y(1),0)):$P(^(0),U,2),1:"")
"RTN","GMTSUP",65,0)
 I 'GMTINX S GMTSY=0 Q
"RTN","GMTSUP",66,0)
 I '$D(GMTSEGI(GMTINX)) N GMI,GMJ,GMTSDFLT S GMI=1,GMJ=GMTSEGC,GMTSDFLT=1 D LOAD^GMTSADH S GMTSEGC=GMTSEGC+1
"RTN","GMTSUP",67,0)
 I '$D(GMTSEGI(GMTINX)) S GMTINX="",GMTSY=0 Q
"RTN","GMTSUP",68,0)
 S LIM=$P(Y(1),U,4) I LIM'["=" G NOLIM
"RTN","GMTSUP",69,0)
 S CREC=^GMT(142.1,GMTINX,0),SBS=GMTSEGI(GMTINX) D CMPLIM^GMTSADH2
"RTN","GMTSUP",70,0)
 I $D(DIROUT) S GMTSQIT="" Q
"RTN","GMTSUP",71,0)
NOLIM S GMTSEGN=GMTSEGI(GMTINX)-1,(GMTSY,GMTSQIT)=1,GMTSLPG=0
"RTN","GMTSUP",72,0)
 Q
"RTN","GMTSUP",73,0)
 ;
"RTN","GMTSUP",74,0)
EVAL ; Evaluate input to determine quit or continue
"RTN","GMTSUP",75,0)
 Q:'$D(X)
"RTN","GMTSUP",76,0)
 S:$D(DTOUT) DIROUT=1 I $S(X="^^":1,GMTSLPG:1,$D(DIROUT):1,X="^":1,1:0) S GMTSQIT=""
"RTN","GMTSUP",77,0)
 I +$G(GMPSAP),(X="^") S GMDUOUT=1
"RTN","GMTSUP",78,0)
 Q
"RTN","GMTSVS")
0^1^B32240925
"RTN","GMTSVS",1,0)
GMTSVS ; SLC/KER - Vital Signs Component          ; 04/11/2000
"RTN","GMTSVS",2,0)
 ;;2.7;Health Summary;**8,20,28,35**;Oct 20, 1995
"RTN","GMTSVS",3,0)
 ;                          
"RTN","GMTSVS",4,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVS",5,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVS",6,0)
 ;                          
"RTN","GMTSVS",7,0)
OUTPAT ; Outpatient Vital Signs Main Control
"RTN","GMTSVS",8,0)
 N GMRVSTR
"RTN","GMTSVS",9,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSVS",10,0)
 E  S CNTR=100
"RTN","GMTSVS",11,0)
 K ^UTILITY($J,"GMRVD"),ARRAY
"RTN","GMTSVS",12,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0
"RTN","GMTSVS",13,0)
 S TN=0,LF=0,GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN",GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",14,0)
 S GMRVSTR("LT")="^C^" ;Set to only get Vital Sign for Clinics
"RTN","GMTSVS",15,0)
 D EN1^GMRVUT0
"RTN","GMTSVS",16,0)
 ; If no data, display message and get
"RTN","GMTSVS",17,0)
 ; most recent inpatient measurements
"RTN","GMTSVS",18,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVS",19,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!
"RTN","GMTSVS",20,0)
 . S GMTSNDM=1
"RTN","GMTSVS",21,0)
 . D ENVS
"RTN","GMTSVS",22,0)
 D FIRST,SECOND:GMTSVMVR>3,KILLVS Q
"RTN","GMTSVS",23,0)
 ;                          
"RTN","GMTSVS",24,0)
ENVS ; Set up for Vitals Extraction Routine
"RTN","GMTSVS",25,0)
 I $D(GMTSNDM),GMTSNDM>0 S CNTR=GMTSNDM
"RTN","GMTSVS",26,0)
 E  S CNTR=100
"RTN","GMTSVS",27,0)
 K ^UTILITY($J,"GMRVD"),ARRAY
"RTN","GMTSVS",28,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0,TN=0,LF=0,GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN",GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",29,0)
 D EN1^GMRVUT0 I '$D(^UTILITY($J,"GMRVD")) D KILLVS Q
"RTN","GMTSVS",30,0)
 D FIRST,SECOND:GMTSVMVR>3,KILLVS Q
"RTN","GMTSVS",31,0)
 ;                          
"RTN","GMTSVS",32,0)
FIRST ; First Set of Vitals
"RTN","GMTSVS",33,0)
 ;  1     2      3     4   5     6       7         8
"RTN","GMTSVS",34,0)
 ; Date^Temp()^Pulse^Respt^BP^Height()^Weight()^Control
"RTN","GMTSVS",35,0)
 N GMW,GMTSCCNT,GMTSCTL S CNTR("HOLDER")=CNTR S GMTSVMVR=$$VERSION^XPDUTL("GMRV")
"RTN","GMTSVS",36,0)
 I GMTSVMVR'>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",37,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?20,"TEMP",?29,"PULSE",?36,"RESP",?45,"BP",?55,"HT",?68,"WT",!
"RTN","GMTSVS",38,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"F(C)",?55,"IN(CM)",?68,"LB(KG)",!
"RTN","GMTSVS",39,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"----",?29,"-----",?36,"----",?45,"--",?55,"------",?68,"------",!!
"RTN","GMTSVS",40,0)
 I GMTSVMVR>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",41,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?18,"TEMP",?30,"PULSE",?37,"RESP",?42,"BP",?51,"HT",?62,"WT",!
"RTN","GMTSVS",42,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"F(C)",?51,"IN(CM)",?62,"LB(KG)[BMI]",!
"RTN","GMTSVS",43,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"----",?30,"-----",?37,"----",?42,"--",?51,"------",?62,"-----------",!!
"RTN","GMTSVS",44,0)
 S GMTSCCNT=0,GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D FLOOP,FWRT
"RTN","GMTSVS",45,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",46,0)
 Q
"RTN","GMTSVS",47,0)
FLOOP ;   Loop through first set of vitals by date
"RTN","GMTSVS",48,0)
 S (GMTSCTL,GMTSVT)=""
"RTN","GMTSVS",49,0)
 F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D FFMT
"RTN","GMTSVS",50,0)
 Q
"RTN","GMTSVS",51,0)
FFMT ;   Extract and format first set of vitals
"RTN","GMTSVS",52,0)
 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN),X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X
"RTN","GMTSVS",53,0)
 S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X S TDT=TDT_" "_TI,$P(ARRAY,U,1)=TDT
"RTN","GMTSVS",54,0)
 S GMTAB=$S(GMTSVT="T":2,GMTSVT="P":3,GMTSVT="R":4,GMTSVT="BP":5,GMTSVT="HT":6,GMTSVT="WT":7,1:0)
"RTN","GMTSVS",55,0)
 I GMTAB="2" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),1)_"("_$$FN($P(GMTSVS,U,13),1)_")"
"RTN","GMTSVS",56,0)
 I GMTAB="6" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),1)_"("_$$FN($P(GMTSVS,U,13),0)_")"
"RTN","GMTSVS",57,0)
 I GMTAB="7" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),0)_"("_$$FN($P(GMTSVS,U,13),1)_")"
"RTN","GMTSVS",58,0)
 I "^2^6^7^"'[GMTAB S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",59,0)
 I GMTAB=7,$P(GMTSVS,U,14)]"" S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"["_$P(GMTSVS,U,14)_"]"
"RTN","GMTSVS",60,0)
 S:GMTAB>1 GMTSCTL=GMTSCTL_$P(ARRAY,U,GMTAB),$P(ARRAY,U,8)=GMTSCTL
"RTN","GMTSVS",61,0)
 Q
"RTN","GMTSVS",62,0)
FWRT ;   Write first set of vitals by date
"RTN","GMTSVS",63,0)
 Q:$P($G(ARRAY),U,8)=""  S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",65,0)
 I GMTSVMVR'>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?37,$P(ARRAY,U,4),?42,$P(ARRAY,U,5),?54,$P(ARRAY,U,6),?67,$P(ARRAY,U,7),!
"RTN","GMTSVS",66,0)
 I GMTSVMVR>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?37,$P(ARRAY,U,4),?42,$P(ARRAY,U,5),?51,$P(ARRAY,U,6),?62,$P(ARRAY,U,7),!
"RTN","GMTSVS",67,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",68,0)
 K ARRAY
"RTN","GMTSVS",69,0)
 Q
"RTN","GMTSVS",70,0)
 ;                          
"RTN","GMTSVS",71,0)
SECOND ; Second Set of Vitals
"RTN","GMTSVS",72,0)
 ;  1    2   3     4     5      6
"RTN","GMTSVS",73,0)
 ; Date^CVP^PO2^Cir/Gir^Pain^Control
"RTN","GMTSVS",74,0)
 N GMW,GMTSCCNT,GMTSCTL S (GMTSCCNT,END)=0,CNTR=CNTR("HOLDER")
"RTN","GMTSVS",75,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",76,0)
 W !,"Measurement DT",?18,"CVP",?30,"PO2",?42,"CG"
"RTN","GMTSVS",77,0)
 W !,?18,"CMH20(MMHG)",?30,"(L/MIN)(%)",?42,"IN(CM)",?61,"Pain",!,?18,"-----------",?30,"----------",?42,"------",?61,"----",!!
"RTN","GMTSVS",78,0)
 S GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D SLOOP,SWRT
"RTN","GMTSVS",79,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",80,0)
 Q
"RTN","GMTSVS",81,0)
SLOOP ;   Loop through second set of vitals by date
"RTN","GMTSVS",82,0)
 S (GMTSCTL,GMTSVT)="" F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D SFMT
"RTN","GMTSVS",83,0)
 Q
"RTN","GMTSVS",84,0)
SFMT ;   Extract and format second set of vitals
"RTN","GMTSVS",85,0)
 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN)
"RTN","GMTSVS",86,0)
 S X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X S TDT=TDT_" "_TI,$P(ARRAY,U,1)=TDT
"RTN","GMTSVS",87,0)
 S GMTAB=$S(GMTSVT="CVP":2,GMTSVT="PO2":3,GMTSVT="CG":4,GMTSVT="PN":5,1:0)
"RTN","GMTSVS",88,0)
 S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",89,0)
 I GMTAB=2 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$P(GMTSVS,U,13)_")"
"RTN","GMTSVS",90,0)
 I GMTAB=3 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$P(GMTSVS,U,15)_")("_$P(GMTSVS,U,16)_")"
"RTN","GMTSVS",91,0)
 I GMTAB=4 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"("_$$FN($P(GMTSVS,U,13),0)_")"_$S($P(GMTSVS,U,17)]"":"["_$P(GMTSVS,U,17)_"]",1:"")
"RTN","GMTSVS",92,0)
 I GMTAB=5 S $P(ARRAY,U,GMTAB)=$S($L($P(ARRAY,U,GMTAB))&(+($P(ARRAY,U,GMTAB))'=99):$$FN($P(ARRAY,U,GMTAB),0),$L($P(ARRAY,U,GMTAB))&(+($P(ARRAY,U,GMTAB))=99):"No Response",1:"")
"RTN","GMTSVS",93,0)
 S:GMTAB>1 GMTSCTL=$G(GMTSCTL)_$P($G(ARRAY),U,GMTAB),$P(ARRAY,U,6)=GMTSCTL
"RTN","GMTSVS",94,0)
 Q
"RTN","GMTSVS",95,0)
SWRT ;   Write second set of vitals by date
"RTN","GMTSVS",96,0)
 Q:$P($G(ARRAY),U,6)=""
"RTN","GMTSVS",97,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",98,0)
 I GMTSNPG=1 D
"RTN","GMTSVS",99,0)
 . W !,"Measurement DT",?18,"CVP",?30,"PO2",?42,"CG"
"RTN","GMTSVS",100,0)
 . W !,?18,"CMH20(MMHG)",?30,"(L/MIN)(%)",?42,"IN(CM)",?61,"Pain",!,?18,"-----------",?30,"----------",?42,"------",?61,"----",!!
"RTN","GMTSVS",101,0)
 S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",102,0)
 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?42,$P(ARRAY,U,4),?61,$P(ARRAY,U,5),!
"RTN","GMTSVS",103,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",104,0)
 K ARRAY
"RTN","GMTSVS",105,0)
 Q
"RTN","GMTSVS",106,0)
 ;                          
"RTN","GMTSVS",107,0)
KILLVS ; Kill Variables
"RTN","GMTSVS",108,0)
 K CNTR,T1,T2,TDT,TI,END,TN,IEN,LF,GMTSVMVR,GMTSVS,GMTSVT,GMT,ARRAY,GMTAB,X
"RTN","GMTSVS",109,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVS",110,0)
 Q
"RTN","GMTSVS",111,0)
FN(X,Y) ; Format Number 
"RTN","GMTSVS",112,0)
 N VAL S VAL=+($G(X)),Y=$G(Y) Q:+Y'=Y X
"RTN","GMTSVS",113,0)
 S X=$FN(VAL,"",Y) Q X
"RTN","GMTSVSD")
0^2^B50978635
"RTN","GMTSVSD",1,0)
GMTSVSD ; SLC/KER - Vital Signs (Detailed)           ; 04/11/2000
"RTN","GMTSVSD",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSVSD",3,0)
 ;
"RTN","GMTSVSD",4,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVSD",5,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVSD",6,0)
 ;                     
"RTN","GMTSVSD",7,0)
 Q
"RTN","GMTSVSD",8,0)
EN ; Detailed Vital Signs main control
"RTN","GMTSVSD",9,0)
 N GMRVSTR,GMTSC1,GMTSC2,GMTSC3,GMTSC4,GMTSCNT,GMTSCD,GMTSCHR,GMTSCI
"RTN","GMTSVSD",10,0)
 N GMTSCW1,GMTSCW2,GMTSCW3,GMTSCW4,GMTSCW5,GMTSLN,GMTSMEAS,GMTSN
"RTN","GMTSVSD",11,0)
 N GMTSOK,GMTSP,GMTSPSN,GMTSQ,GMTSREM,GMTSROV,GMTST,GMTSTO,GMTSV
"RTN","GMTSVSD",12,0)
 N GMTSVCT,GMTSVD,GMTSVI,GMTSVSD,GMTSVSDT,GMTSVT,X,Y,GMTSLM,GMTSLML
"RTN","GMTSVSD",13,0)
 S GMTSLM=0 S:$D(VALM("BM"))&($G(VALM("LINES"))>0) GMTSLM=1
"RTN","GMTSVSD",14,0)
 S GMTSLML=9999999009 S:GMTSLM GMTSLML=+($G(VALM("LINES")))
"RTN","GMTSVSD",15,0)
 S GMTSLO=+($G(GMTSLO)) S:GMTSLO=0 GMTSLO=3 S GMTSLPG=+($G(GMTSLPG)),GMTSDTM=$G(GMTSDTM) S:'$L(GMTSDTM) GMTSDTM=$$DTM
"RTN","GMTSVSD",16,0)
 S:'$D(GMTSTITL)!('$L($G(GMTSTITL))) GMTSTITL="VITALS DETAILED DISPLAY" K ^TMP("GMTSVSD",$J),^UTILITY($J,"GMRVD")
"RTN","GMTSVSD",17,0)
 S GMTSNDM=+($G(GMTSNDM)) S:GMTSNDM=0 GMTSNDM=1 S GMTSVCT=GMTSNDM
"RTN","GMTSVSD",18,0)
 S GMRVSTR("LT")="^C^" D GET S GMTSNDM=+($G(GMTSVCT)) D:$D(^UTILITY($J,"GMRVD")) ST
"RTN","GMTSVSD",19,0)
 K GMRVSTR("LT") D GET S GMTSNDM=+($G(GMTSVCT)) D:$D(^UTILITY($J,"GMRVD")) ST K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSD",20,0)
 S GMTSCW1=0,GMTSCW2=18,GMTSCW3=36,GMTSCW4=53,GMTSCW5=+($G(IOM))-2
"RTN","GMTSVSD",21,0)
 S:GMTSCW5'>49 GMTSCW5=78 I '$D(^TMP("GMTSVSD",$J)) D NOD Q
"RTN","GMTSVSD",22,0)
 D REM,OUT
"RTN","GMTSVSD",23,0)
 Q
"RTN","GMTSVSD",24,0)
 ;                
"RTN","GMTSVSD",25,0)
GET ; Get Data
"RTN","GMTSVSD",26,0)
 K ^UTILITY($J,"GMRVD") N GMTSNDM S GMTSNDM=+($G(GMTSVCT)) S:+GMTSNDM'>0 GMTSNDM=1 S GMTSNDM=GMTSNDM*100
"RTN","GMTSVSD",27,0)
 S GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN"
"RTN","GMTSVSD",28,0)
 S GMRVSTR(0)=$G(GMTSBEG)_"^"_$G(GMTSEND)_"^"_$G(GMTSNDM)_"^"_1 D EN1^GMRVUT0 S GMTSNDM=+($G(GMTSVCT))
"RTN","GMTSVSD",29,0)
 Q
"RTN","GMTSVSD",30,0)
NOD ;   No Data Found
"RTN","GMTSVSD",31,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W "*** No vital measurements ***",! S GMTSNDM=1 Q
"RTN","GMTSVSD",32,0)
REM ;   Remove Excess Data
"RTN","GMTSVSD",33,0)
 S GMTSNDM=+($G(GMTSNDM)) S:GMTSNDM=0 GMTSNDM=1 N GMTSVD,GMTSVT,GMTSVI,GMTST
"RTN","GMTSVSD",34,0)
 S GMTSVD=0 F  S GMTSVD=$O(^TMP("GMTSVSD",$J,GMTSVD)) Q:+GMTSVD=0  D
"RTN","GMTSVSD",35,0)
 . S GMTSVT="" F  S GMTSVT=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT)) Q:GMTSVT=""  D
"RTN","GMTSVSD",36,0)
 . . S GMTSVI=0 F  S GMTSVI=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:+GMTSVI=0  D
"RTN","GMTSVSD",37,0)
 . . . I +($G(GMTST(GMTSVT)))>(GMTSNDM-1) K ^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI) Q
"RTN","GMTSVSD",38,0)
 . . . S GMTST(GMTSVT)=+($G(GMTST(GMTSVT)))+1
"RTN","GMTSVSD",39,0)
 Q
"RTN","GMTSVSD",40,0)
 ;                
"RTN","GMTSVSD",41,0)
OUT ; Output Data
"RTN","GMTSVSD",42,0)
 D HDR Q:$D(GMTSQIT)  N GMTSVD,GMTSVT,GMTSVSDT,GMTSVSD,GMTSVI,GMTSCNT S GMTSCNT=0
"RTN","GMTSVSD",43,0)
 S GMTSVD=0 F  S GMTSVD=$O(^TMP("GMTSVSD",$J,GMTSVD)) Q:GMTSVD<1!(GMTSVD="")  D
"RTN","GMTSVSD",44,0)
 . S GMTSVT="" F  S GMTSVT=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT)) Q:GMTSVT=""  D
"RTN","GMTSVSD",45,0)
 . . S GMTSVI=0 F  S GMTSVI=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:+GMTSVI=0  D
"RTN","GMTSVSD",46,0)
 . . . S GMTSVSD=$G(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:'$L(GMTSVSD)  S GMTSVSDT=$P(GMTSVSD,"^",1) Q:'$L(GMTSVSDT)  Q:+GMTSVSDT'>0  D ADD
"RTN","GMTSVSD",47,0)
 . I +($O(^TMP("GMTSVSD",$J,GMTSVD)))'=GMTSVD D WRL
"RTN","GMTSVSD",48,0)
 I GMTSCNT=0 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W "No data",!
"RTN","GMTSVSD",49,0)
 Q
"RTN","GMTSVSD",50,0)
ADD ;   Add to Output Array
"RTN","GMTSVSD",51,0)
 N GMTST,GMTSTO,GMTSV,GMTSQ S GMTST=$G(GMTSVT) Q:'$L(GMTST)
"RTN","GMTSVSD",52,0)
 S GMTSTO=$$VO(GMTST) Q:GMTSTO'>0  S GMTST=$$VT(GMTST) Q:'$L(GMTST)
"RTN","GMTSVSD",53,0)
 S GMTSV=$$VM(GMTSVT,GMTSVSD)
"RTN","GMTSVSD",54,0)
 S GMTSQ=$$VQ(GMTSVSD),GMTSROV(GMTSTO)=GMTST_"^"_GMTSV_"^"_GMTSQ,GMTSCNT=+($G(GMTSCNT))+1,GMTSROV("DT")=$$EDT^GMTSU(GMTSVSDT)
"RTN","GMTSVSD",55,0)
 Q
"RTN","GMTSVSD",56,0)
WRL ;   Write Line from Array
"RTN","GMTSVSD",57,0)
 N GMTSCI,GMTSCD,GMTSC1,GMTSC2,GMTSC3,GMTSC4
"RTN","GMTSVSD",58,0)
 S (GMTSCD,GMTSC1)=$G(GMTSROV("DT")) I '$L(GMTSC1) K GMTSROV Q
"RTN","GMTSVSD",59,0)
 S GMTSCI=0 F  S GMTSCI=$O(GMTSROV(GMTSCI)) Q:+GMTSCI=0  Q:$D(GMTSQIT)  D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",60,0)
 . S GMTSC2=$G(GMTSROV(GMTSCI)),GMTSC3=$P(GMTSC2,"^",2),GMTSC4=$P(GMTSC2,"^",3),GMTSC2=$P(GMTSC2,"^",1)
"RTN","GMTSVSD",61,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVSD",62,0)
 . I +($G(GMTSLM))>0 S:+($$LMP)>0 GMTSC1=GMTSCD
"RTN","GMTSVSD",63,0)
 . I GMTSNPG'=1 W GMTSC1,?GMTSCW2,GMTSC2,?GMTSCW3,GMTSC3 D QUAL
"RTN","GMTSVSD",64,0)
 . I GMTSNPG=1 S GMTSC1=GMTSCD D HDR W GMTSC1,?GMTSCW2,GMTSC2,?GMTSCW3,GMTSC3 D QUAL
"RTN","GMTSVSD",65,0)
 . S GMTSC1="   ""        ""  "
"RTN","GMTSVSD",66,0)
 . Q:$D(GMTSQIT)
"RTN","GMTSVSD",67,0)
 K GMTSROV
"RTN","GMTSVSD",68,0)
 Q
"RTN","GMTSVSD",69,0)
LMP(X) ;
"RTN","GMTSVSD",70,0)
 Q:+($G(GMTSLML))'>0 0
"RTN","GMTSVSD",71,0)
 N GMTSP,GMTSD S GMTSP=$Y,GMTSD=0 S:GMTSP#GMTSLML=0 GMTSD=1 S X=GMTSD Q X
"RTN","GMTSVSD",72,0)
QUAL ;   Write Vital Qualifiers
"RTN","GMTSVSD",73,0)
 N GMTSOK,GMTSLN,GMTSTO,GMTSREM,GMTSPSN,GMTSCHR S GMTSLN=GMTSCW5-GMTSCW4
"RTN","GMTSVSD",74,0)
 I $L(GMTSC4)'>(GMTSLN-1) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,GMTSC4,! Q
"RTN","GMTSVSD",75,0)
 S GMTSREM=GMTSC4 F  Q:$D(GMTSQIT)  D QPARSE Q:$D(GMTSQIT)  Q:'$L(GMTSREM)
"RTN","GMTSVSD",76,0)
 Q
"RTN","GMTSVSD",77,0)
QPARSE ;     Parse Qualifier (wrap)
"RTN","GMTSVSD",78,0)
 I $L(GMTSREM)'>(GMTSLN-1) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,GMTSREM,! S GMTSREM="" Q
"RTN","GMTSVSD",79,0)
 S GMTSOK=0 F GMTSPSN=GMTSLN:-1:0 Q:+GMTSOK=1  D  Q:+GMTSOK=1
"RTN","GMTSVSD",80,0)
 . I $E(GMTSREM,GMTSPSN)=" " S GMTSCHR=" ",GMTSOK=1 Q
"RTN","GMTSVSD",81,0)
 . I $E(GMTSREM,GMTSPSN)="," S GMTSCHR=",",GMTSOK=1 Q
"RTN","GMTSVSD",82,0)
 . I $E(GMTSREM,GMTSPSN)="/"!($E(GMTSREM,GMTSPSN)="-")!($E(GMTSREM,GMTSPSN)=")") S GMTSCHR=$E(GMTSREM,GMTSPSN),GMTSOK=1 Q
"RTN","GMTSVSD",83,0)
 I GMTSCHR=" " D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",84,0)
 . S GMTSTO=$E(GMTSREM,1,(GMTSPSN-1)),GMTSREM=$E(GMTSREM,(GMTSPSN+1),$L(GMTSREM)),GMTSREM=$$TRIM(GMTSREM) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,$G(GMTSTO),!
"RTN","GMTSVSD",85,0)
 I GMTSCHR="/"!(GMTSCHR=",")!(GMTSCHR="-")!(GMTSCHR=")") D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",86,0)
 . S GMTSTO=$E(GMTSREM,1,(GMTSPSN)),GMTSREM=$E(GMTSREM,(GMTSPSN+1),$L(GMTSREM)),GMTSREM=$$TRIM(GMTSREM) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,$G(GMTSTO),!
"RTN","GMTSVSD",87,0)
 Q
"RTN","GMTSVSD",88,0)
 ;                
"RTN","GMTSVSD",89,0)
 ; Miscellaneous
"RTN","GMTSVSD",90,0)
FM(X) ;   Format Vitals Measurement
"RTN","GMTSVSD",91,0)
 S X=$$TRIM($G(X)) Q:+X'=X X
"RTN","GMTSVSD",92,0)
 S:X["." X=$FN(X,"",2) Q X
"RTN","GMTSVSD",93,0)
TRIM(X) ;   Trim Blank Spaces
"RTN","GMTSVSD",94,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSVSD",95,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSVSD",96,0)
 Q X
"RTN","GMTSVSD",97,0)
VO(X) ;   Vital Array Order
"RTN","GMTSVSD",98,0)
 S X=$G(X) Q:X="T" 1 Q:X="P" 2 Q:X="R" 3 Q:X="BP" 4 Q:X="HT" 5 Q:X="WT" 6 Q:X="CG" 7 Q:X="PN" 8 Q:X="CVP" 9 Q:X="PO2" 10 Q ""
"RTN","GMTSVSD",99,0)
VT(X) ;   Vital Type
"RTN","GMTSVSD",100,0)
 S X=$G(X) Q:X="BP" "BP" Q:X="T" "Temp F (C)" Q:X="R" "Respir" Q:X="P" "Pulse" Q:X="HT" "Ht in (cm)"
"RTN","GMTSVSD",101,0)
 Q:X="WT" "Wt lbs (kg)[BMI]" Q:X="CVP" "CVP cm H2O(mm HG)" Q:X="PO2" "PO2 (L/Min)(%)" Q:X="CG" "C/G in (cm)" Q:X="PN" "Pain" Q ""
"RTN","GMTSVSD",102,0)
VM(X,Y) ;   Vital Type Measurement
"RTN","GMTSVSD",103,0)
 N GMTSMEAS,GMTSID S GMTSMEAS="",(GMTSID,X)=$G(X) Q:"^BP^T^R^P^HT^WT^CVP^PO2^CG^PN^"'[("^"_X_"^") ""
"RTN","GMTSVSD",104,0)
 S Y=$G(Y) Q:'$L(Y) ""
"RTN","GMTSVSD",105,0)
 ;     If data for T, Ht or Wt piece 8 and 13 else  piece 8
"RTN","GMTSVSD",106,0)
 I X="T"!(X="HT")!(X="WT") S GMTSMEAS=$P(Y,"^",8)_" ("_$P(Y,"^",13)_")"
"RTN","GMTSVSD",107,0)
 E  S GMTSMEAS=$P(Y,"^",8)
"RTN","GMTSVSD",108,0)
 ;     WT - Weight and BMI (piece 14)
"RTN","GMTSVSD",109,0)
 I X="WT",$L($P(Y,"^",14)) S GMTSMEAS=GMTSMEAS_"["_$P(Y,"^",14)_"]"
"RTN","GMTSVSD",110,0)
 ;     CVP - Central Venous Pressure/CG - Circum/Girth
"RTN","GMTSVSD",111,0)
 I X="CVP"!(X="CG") S GMTSMEAS=$P(Y,"^",8) S:$L($P(Y,"^",13)) GMTSMEAS=GMTSMEAS_" ("_$P(Y,"^",13)_")"
"RTN","GMTSVSD",112,0)
 ;     PO2 - Pulse Oximetry
"RTN","GMTSVSD",113,0)
 I X="PO2" S GMTSMEAS=$P(Y,"^",8) S:$L($P(Y,"^",15)) GMTSMEAS=GMTSMEAS_" ("_$P(Y,"^",15)_")"
"RTN","GMTSVSD",114,0)
 ;     PN - Pain
"RTN","GMTSVSD",115,0)
 S:X="PN" GMTSMEAS=$P(Y,"^",8) S:X="PN"&(GMTSMEAS=99) GMTSMEAS="No Response"
"RTN","GMTSVSD",116,0)
 S X=GMTSMEAS Q X
"RTN","GMTSVSD",117,0)
VQ(X) ;   Vital Qualifiers
"RTN","GMTSVSD",118,0)
 S X=$G(X),X=$P(X,"^",17) S:$L(X) X=$$AQ(X) Q X
"RTN","GMTSVSD",119,0)
HDR ;   Header
"RTN","GMTSVSD",120,0)
 N GMTSLN D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR
"RTN","GMTSVSD",121,0)
 W "Date",?GMTSCW2,"Vital",?GMTSCW3,"Measurement",?GMTSCW4,"Qualifiers",!
"RTN","GMTSVSD",122,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W $$LN((GMTSCW2-2)),?GMTSCW2,$$LN((GMTSCW3-(GMTSCW2+2))),?GMTSCW3,$$LN((GMTSCW4-(GMTSCW3+2))),?GMTSCW4,$$LN((GMTSCW5-(GMTSCW4+2)))
"RTN","GMTSVSD",123,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W !
"RTN","GMTSVSD",124,0)
 ;
"RTN","GMTSVSD",125,0)
 S GMTSNPG=0 Q
"RTN","GMTSVSD",126,0)
ST ;   Save in ^TMP Global
"RTN","GMTSVSD",127,0)
 Q:'$D(^UTILITY($J,"GMRVD"))  M ^TMP("GMTSVSD",$J)=^UTILITY($J,"GMRVD") Q
"RTN","GMTSVSD",128,0)
AQ(X) ;   All Qualifiers Field
"RTN","GMTSVSD",129,0)
 S X=$G(X) F  Q:X'[";"  S X=$P(X,";",1)_", "_$P(X,";",2,299)
"RTN","GMTSVSD",130,0)
 S X=$$MC(X) Q X
"RTN","GMTSVSD",131,0)
MC(X) ;   Mix Case for Qualifiers
"RTN","GMTSVSD",132,0)
 N GMTSP S X=$TR($G(X),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz") F GMTSP=1:1:$L(X) D
"RTN","GMTSVSD",133,0)
 . S:GMTSP=1 X=$TR($E(X,GMTSP),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(X,(GMTSP+1),$L(X)) Q:GMTSP=1
"RTN","GMTSVSD",134,0)
 . S:" /-,"[$E(X,(GMTSP-1)) X=$E(X,1,(GMTSP-1))_$TR($E(X,GMTSP),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(X,(GMTSP+1),$L(X))
"RTN","GMTSVSD",135,0)
 Q X
"RTN","GMTSVSD",136,0)
DTM(X) ;   Current Date and Time
"RTN","GMTSVSD",137,0)
 S X=$$NOW^XLFDT D REGDTM4^GMTSU Q X
"RTN","GMTSVSD",138,0)
FN(X,Y) ;   Format Number 
"RTN","GMTSVSD",139,0)
 N GMTSV S X=$G(X),GMTSV=+($G(X)),Y=$G(Y) S:+Y=Y X=$FN(GMTSV,"",+Y) Q X
"RTN","GMTSVSD",140,0)
LN(X) ;   Dashed Line
"RTN","GMTSVSD",141,0)
 S X=+($G(X)) Q:X=0 "" N GMTSLN S GMTSLN="",$P(GMTSLN,"-",X)="-" S X=GMTSLN Q X
"RTN","GMTSVSD",142,0)
EDT(X) ; External Date and Time
"RTN","GMTSVSD",143,0)
 S X=$G(X) Q:'$L(X) ""
"RTN","GMTSVSD",144,0)
 D REGDTM4^GMTSU Q X
"RTN","GMTSVSS")
0^10^B40993682
"RTN","GMTSVSS",1,0)
GMTSVSS ; SLC/KER - Selected Vital Signs           ; 04/11/2000
"RTN","GMTSVSS",2,0)
 ;;2.7;Health Summary;**8,20,28,35**;Oct 20, 1995
"RTN","GMTSVSS",3,0)
 ; 
"RTN","GMTSVSS",4,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVSS",5,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVSS",6,0)
 ;                          
"RTN","GMTSVSS",7,0)
OUTPAT ; Outpatient Select Vitals Signs Main control
"RTN","GMTSVSS",8,0)
 N CNT,COL,COLL,HDR,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,GMRVSTR,LOOP,MAX,ROW,WIDTH
"RTN","GMTSVSS",9,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSS",10,0)
 I $D(GMTSNDM),GMTSNDM>0 S MAX=GMTSNDM
"RTN","GMTSVSS",11,0)
 E  S MAX=100
"RTN","GMTSVSS",12,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",13,0)
 I '$D(GMRVSTR) Q
"RTN","GMTSVSS",14,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",15,0)
 S GMRVSTR("LT")="^C^" ;Set to only get Vital Sign for Clinics
"RTN","GMTSVSS",16,0)
 D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",17,0)
 ; If no data, display message and get most recent inpatient measurements
"RTN","GMTSVSS",18,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVSS",19,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!
"RTN","GMTSVSS",20,0)
 .S GMTSNDM=1
"RTN","GMTSVSS",21,0)
 .D ENVS
"RTN","GMTSVSS",22,0)
 .Q
"RTN","GMTSVSS",23,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",24,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",25,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",26,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",27,0)
 .D NXTROW
"RTN","GMTSVSS",28,0)
 .W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",29,0)
 .S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",30,0)
 .Q
"RTN","GMTSVSS",31,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",32,0)
 Q
"RTN","GMTSVSS",33,0)
ENVS ; Set up for extraction routine
"RTN","GMTSVSS",34,0)
 N CNT,COL,COLL,HDR,HDR1,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,LOOP,MAX,ROW,WIDTH
"RTN","GMTSVSS",35,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSS",36,0)
 I $D(GMTSNDM),GMTSNDM>0 S MAX=GMTSNDM
"RTN","GMTSVSS",37,0)
 E  S MAX=100
"RTN","GMTSVSS",38,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",39,0)
 I '$D(GMRVSTR) Q
"RTN","GMTSVSS",40,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",41,0)
 D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",42,0)
 I '$D(^UTILITY($J,"GMRVD")) Q
"RTN","GMTSVSS",43,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",44,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",45,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",46,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",47,0)
 .D NXTROW
"RTN","GMTSVSS",48,0)
 .W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",49,0)
 .S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",50,0)
 .Q
"RTN","GMTSVSS",51,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",52,0)
 Q
"RTN","GMTSVSS",53,0)
BLDSTR ; Builds GMRVSTR string for extract call
"RTN","GMTSVSS",54,0)
 N DA,DIC,DIQ,DR,VIT
"RTN","GMTSVSS",55,0)
 S GMTSVMVR=+$$VERSION^XPDUTL("GMRV") ;get vitals package version #
"RTN","GMTSVSS",56,0)
 S DIQ="VIT(",DIQ(0)="E",DIC=120.51,DR="1",DA=GMTSDA
"RTN","GMTSVSS",57,0)
 D EN^DIQ1 S VIT=VIT(120.51,DA,1,"E")
"RTN","GMTSVSS",58,0)
 S GMRVSTR=$S($D(GMRVSTR):GMRVSTR_";"_VIT,1:VIT)
"RTN","GMTSVSS",59,0)
 Q
"RTN","GMTSVSS",60,0)
BLDHDR ; Builds the HDR array
"RTN","GMTSVSS",61,0)
 N ABB,GMTSI S COL=18
"RTN","GMTSVSS",62,0)
 F GMTSI=1:1:$L(GMRVSTR,";") D
"RTN","GMTSVSS",63,0)
 .S (HDR(GMTSI-1),ABB)=$P(GMRVSTR,";",GMTSI)
"RTN","GMTSVSS",64,0)
 .S HDR(GMTSI-1)=HDR(GMTSI-1)_U
"RTN","GMTSVSS",65,0)
 .S HDR(GMTSI-1)=HDR(GMTSI-1)_$S(ABB="BP":"BP",ABB="PN":"PAIN",ABB="HT":"HEIGHT",ABB="WT":"WEIGHT",ABB="P":"PULSE",ABB="R":"RESP",ABB="T":"TEMP",1:ABB)
"RTN","GMTSVSS",66,0)
 .S WIDTH=$S($P(HDR(GMTSI-1),U)="T":13,$P(HDR(GMTSI-1),U)="P":7,$P(HDR(GMTSI-1),U)="R":6,$P(HDR(GMTSI-1),U)="WT":20,$P(HDR(GMTSI-1),U)="CG":20,1:12)
"RTN","GMTSVSS",67,0)
 .S COLL=$P(COL,U,GMTSI)+WIDTH
"RTN","GMTSVSS",68,0)
 .S COL=COL_U
"RTN","GMTSVSS",69,0)
 .S COL=COL_COLL
"RTN","GMTSVSS",70,0)
 .S HDR(GMTSI-1)=HDR(GMTSI-1)_U_COLL_U_WIDTH
"RTN","GMTSVSS",71,0)
 .Q
"RTN","GMTSVSS",72,0)
 S ROW=1,COL(ROW)=18,COLL=18,CNT=0
"RTN","GMTSVSS",73,0)
 F LOOP=0:1 Q:'$D(HDR(LOOP))  D
"RTN","GMTSVSS",74,0)
 .I $P(HDR(LOOP),U,4)+COLL'>80 D  Q
"RTN","GMTSVSS",75,0)
 ..S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",76,0)
 ..S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",77,0)
 ..S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",78,0)
 ..S CNT=CNT+1
"RTN","GMTSVSS",79,0)
 ..K HDR(LOOP)
"RTN","GMTSVSS",80,0)
 ..Q
"RTN","GMTSVSS",81,0)
 .S ROW=ROW+1,COL(ROW)=18,COLL=18,CNT=0
"RTN","GMTSVSS",82,0)
 .S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",83,0)
 .S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",84,0)
 .S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",85,0)
 .S CNT=CNT+1
"RTN","GMTSVSS",86,0)
 .K HDR(LOOP)
"RTN","GMTSVSS",87,0)
 .Q
"RTN","GMTSVSS",88,0)
 Q
"RTN","GMTSVSS",89,0)
WRTHDR ; Writes Header
"RTN","GMTSVSS",90,0)
 N GMI
"RTN","GMTSVSS",91,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT"
"RTN","GMTSVSS",92,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",93,0)
 .W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",94,0)
 .Q
"RTN","GMTSVSS",95,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",96,0)
 . W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",97,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",98,0)
 Q
"RTN","GMTSVSS",99,0)
WRTHDR1 ;Writes 2nd line of header
"RTN","GMTSVSS",100,0)
 N GMI
"RTN","GMTSVSS",101,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",102,0)
 . I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",103,0)
 . I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)"
"RTN","GMTSVSS",104,0)
 . I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",105,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",106,0)
 . I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",107,0)
 . I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)[BMI]"
"RTN","GMTSVSS",108,0)
 . I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",109,0)
 . I $P(HDR(GMI),U)="CVP" W ?$P(COL,U,GMI+1),"CMH20(MMHG)"
"RTN","GMTSVSS",110,0)
 . I $P(HDR(GMI),U)="PO2" W ?$P(COL,U,GMI+1),"(L/MIN)(%)"
"RTN","GMTSVSS",111,0)
 . I $P(HDR(GMI),U)="CG" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",112,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSVSS",113,0)
 Q
"RTN","GMTSVSS",114,0)
WRT ; Writes vitals record for one observation time
"RTN","GMTSVSS",115,0)
 N GMLEN,GMTSBMI,GMTSI,GMTSVAL,GMTDT,GMTSVI,GMTSVT,GMTSMET,GMTSPERC,GMTSLMIN,GMTSQUAL,IEN,X
"RTN","GMTSVSS",116,0)
 S GMTSVI="",X=9999999-GMTSDT D REGDTM4^GMTSU S GMTDT=X
"RTN","GMTSVSS",117,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR,WRTHDR1 W GMTDT
"RTN","GMTSVSS",118,0)
 I GMTSVMVR'>3 F GMTSI=0:1:5 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",119,0)
 . S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",120,0)
 . I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",121,0)
 . . S GMTSVAL=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",122,0)
 . . W ?$P(COL,U,GMTSI+1),GMTSVAL
"RTN","GMTSVSS",123,0)
 . . S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13) I GMTSMET'="" W "("_$P(^(+IEN),U,13)_")"
"RTN","GMTSVSS",124,0)
 . . Q
"RTN","GMTSVSS",125,0)
 . Q
"RTN","GMTSVSS",126,0)
 I GMTSVMVR>3 F GMTSI=0:1 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",127,0)
 . S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",128,0)
 . I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",129,0)
 . . S GMTSVAL=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",130,0)
 . . S:GMTSVT="PN"&(GMTSVAL=99) GMTSVAL="No Response"
"RTN","GMTSVSS",131,0)
 . . W ?$P(COL,U,GMTSI+1),GMTSVAL
"RTN","GMTSVSS",132,0)
 . . S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13,17)
"RTN","GMTSVSS",133,0)
 . . S GMTSLMIN=$P(GMTSMET,U,3),GMTSPERC=$P(GMTSMET,U,4)
"RTN","GMTSVSS",134,0)
 . . S GMTSQUAL=$P(GMTSMET,U,5) S:GMTSQUAL]"" GMTSQUAL=$E(GMTSQUAL,1,5)
"RTN","GMTSVSS",135,0)
 . . S GMTSBMI=$P(GMTSMET,U,2),GMTSMET=$P(GMTSMET,U,1)
"RTN","GMTSVSS",136,0)
 . . I GMTSMET'="" W "("_GMTSMET_")" ;centigrade/kilos/centimeters
"RTN","GMTSVSS",137,0)
 . . I GMTSBMI'="" W "["_GMTSBMI_"]" ;body mass index
"RTN","GMTSVSS",138,0)
 . . I GMTSLMIN'="" W "["_GMTSLMIN_"]" ;liters/min supplemental O2
"RTN","GMTSVSS",139,0)
 . . I GMTSPERC'="" W "["_GMTSPERC_"]" ;% supplemental O2
"RTN","GMTSVSS",140,0)
 . . I GMTSVT="CG",GMTSQUAL]"" W "["_GMTSQUAL_"]" ;qualifiers
"RTN","GMTSVSS",141,0)
 . . Q
"RTN","GMTSVSS",142,0)
 . Q
"RTN","GMTSVSS",143,0)
 Q
"RTN","GMTSVSS",144,0)
NXTROW ; get the next row of vital signs
"RTN","GMTSVSS",145,0)
 Q:$G(ROW)'>0
"RTN","GMTSVSS",146,0)
 K HDR
"RTN","GMTSVSS",147,0)
 S %X="HDR1(ROW,",%Y="HDR(" D %XY^%RCR
"RTN","GMTSVSS",148,0)
 S COL=COL(ROW)
"RTN","GMTSVSS",149,0)
 K %X,%Y
"RTN","GMTSVSS",150,0)
 Q
"RTN","GMTSXPD1")
0^19^B53387037
"RTN","GMTSXPD1",1,0)
GMTSXPD1 ; SLC/KER - Health Summary Dist (Component)     ; 04/11/2000
"RTN","GMTSXPD1",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSXPD1",3,0)
 ;
"RTN","GMTSXPD1",4,0)
 Q
"RTN","GMTSXPD1",5,0)
 ;
"RTN","GMTSXPD1",6,0)
ADD(GMTSINI) ; Add Health Summary Component
"RTN","GMTSXPD1",7,0)
 ;                 
"RTN","GMTSXPD1",8,0)
 ;  ADD(<array>)
"RTN","GMTSXPD1",9,0)
 ;     GMTSIEN   GMTSINI(0)     Internal Entry Number File 142.1
"RTN","GMTSXPD1",10,0)
 ;     GMTSNAME  GMTSINI(.01)   Component Name
"RTN","GMTSXPD1",11,0)
 ;     GMTSRTN   GMTSINI(1)     Display Routine
"RTN","GMTSXPD1",12,0)
 ;     GMTSEXTR  GMTSINI(1.1)   Extract Routine (m)
"RTN","GMTSXPD1",13,0)
 ;     GMTSTIML  GMTSINI(2)     Time Limits Applicable
"RTN","GMTSXPD1",14,0)
 ;     GMTSABBR  GMTSINI(3)     Abbreviation
"RTN","GMTSXPD1",15,0)
 ;     GMTSDESC  GMTSINI(3.5)   Description (m)
"RTN","GMTSXPD1",16,0)
 ;     GMTSOCCL  GMTSINI(4)     Occurrence Limits Applicable
"RTN","GMTSXPD1",17,0)
 ;     GMTSDAF   GMTSINI(5)     Disable Flag (null, T or P)
"RTN","GMTSXPD1",18,0)
 ;     GMTSSKEY  GMTSINI(6)     Security Key (Component Locking)
"RTN","GMTSXPD1",19,0)
 ;     GMTSSELF  GMTSINI(7)     Selection File (m)
"RTN","GMTSXPD1",20,0)
 ;     GMTSOOM   GMTSINI(8)     Out of Order Message
"RTN","GMTSXPD1",21,0)
 ;     GMTSDHDN  GMTSINI(9)     Default Header Name
"RTN","GMTSXPD1",22,0)
 ;     GMTSHOSL  GMTSINI(10)    Hospital Location Applicable
"RTN","GMTSXPD1",23,0)
 ;     GMTSICDT  GMTSINI(11)    ICD Text Applicable
"RTN","GMTSXPD1",24,0)
 ;     GMTSPROV  GMTSINI(12)    Provider Narrative Text Applicable
"RTN","GMTSXPD1",25,0)
 ;     GMTSPREF  GMTSINI(13)    Prefix
"RTN","GMTSXPD1",26,0)
 ;     GMTSCPTM  GMTSINI(14)    CPT Modifiers Applicable
"RTN","GMTSXPD1",27,0)
 ;                 
"RTN","GMTSXPD1",28,0)
 N GMTSENV S GMTSENV=$$ENV Q:'GMTSENV 0
"RTN","GMTSXPD1",29,0)
 N GMTSIEN,GMTSNAME,GMTSMNM,GMTSABBR,GMTSTAG,GMTSRTN,GMTSTIML,GMTSOCCL,GMTSSELF
"RTN","GMTSXPD1",30,0)
 N GMTSSKEY,GMTSDHDN,GMTSHOSL,GMTSICDT,GMTSPROV,GMTSDAF,GMTSOOM,GMTSINCL,GMTSPREF,GMTSCPTM
"RTN","GMTSXPD1",31,0)
 N DIE,DIK,DA,DR,DIC,DLAYGO,DINUM,X,Y,INCLUDE,GMTS,GMTSROUT,GMTSTAT
"RTN","GMTSXPD1",32,0)
 S GMTSNAME=$G(GMTSINI(.01)),GMTSMNM=$$FIRSTUP^VAQUTL50(GMTSNAME),GMTSIEN=+($G(GMTSINI(0))),GMTSRTN=$G(GMTSINI(1))
"RTN","GMTSXPD1",33,0)
 S GMTSTAG=$P(GMTSRTN,";",1),GMTSRTN=$P(GMTSRTN,";",2) S:$L(GMTSTAG)&('$L(GMTSRTN)) GMTSRTN=GMTSTAG,GMTSTAG=""
"RTN","GMTSXPD1",34,0)
 S GMTSROUT="",GMTSTAT=$D(^GMT(142.1,+GMTSIEN,0))
"RTN","GMTSXPD1",35,0)
 I '$L($G(GMTSNAME))!(+($G(GMTSIEN))'>0)!('$L($G(GMTSRTN))) Q 0
"RTN","GMTSXPD1",36,0)
 D INST S GMTS=+$O(^GMT(142.1,"B",GMTSNAME,0)) D:GMTS=GMTSIEN ALRDY I GMTS=GMTSIEN Q 0
"RTN","GMTSXPD1",37,0)
 S GMTSNAME=$$NAME^GMTSXPD2($G(GMTSNAME)) D:'$L($G(GMTSNAME)) NNAME Q:'$L(GMTSNAME) 0
"RTN","GMTSXPD1",38,0)
 S GMTSROUT=$$ROUT^GMTSXPD2((GMTSTAG_";"_GMTSRTN)) D:'$L($G(GMTSROUT)) NRTN Q:'$L(GMTSROUT) 0
"RTN","GMTSXPD1",39,0)
 S GMTSTIML=$$TIML^GMTSXPD2($G(GMTSINI(2))),GMTSABBR=$$ABBR^GMTSXPD2($G(GMTSINI(3)))
"RTN","GMTSXPD1",40,0)
 S GMTSOCCL=$$OCCL^GMTSXPD2($G(GMTSINI(4))),GMTSDAF=$$DAF^GMTSXPD2($G(GMTSINI(5)))
"RTN","GMTSXPD1",41,0)
 S GMTSSKEY=$$LOCK^GMTSXPD2($G(GMTSINI(6))),GMTSOOM=$$OOM^GMTSXPD2($G(GMTSINI(8)))
"RTN","GMTSXPD1",42,0)
 S GMTSDHDN=$$DHDN^GMTSXPD2($G(GMTSINI(9))),GMTSHOSL=$$HOSL^GMTSXPD2($G(GMTSINI(10)))
"RTN","GMTSXPD1",43,0)
 S GMTSICDT=$$ICDT^GMTSXPD2($G(GMTSINI(11))),GMTSPROV=$$PROV^GMTSXPD2($G(GMTSINI(12)))
"RTN","GMTSXPD1",44,0)
 S GMTSPREF=$$PREF^GMTSXPD2($G(GMTSINI(13))),GMTSCPTM=$$CPTM^GMTSXPD2($G(GMTSINI(14)))
"RTN","GMTSXPD1",45,0)
 S:$L(GMTSDAF)&('$L(GMTSOOM)) GMTSOOM="Component "_GMTSNAME_$S(GMTSDAF="T":" Temporarily",GMTSDAF="P":" Permanently",1:"")_" Disabled"
"RTN","GMTSXPD1",46,0)
 S DINUM=0,DIE="^GMT(142.1,",(DIC,DLAYGO)=142.1,DIC(0)="NXL",X=GMTSNAME S:'$D(^GMT(142.1,+($G(GMTSIEN)),0)) DINUM=+($G(GMTSIEN))
"RTN","GMTSXPD1",47,0)
 I +DINUM'>1 D EXIST Q 0
"RTN","GMTSXPD1",48,0)
 D ^DIC S DA=+($G(Y)) D:+($G(Y))'>0 FAILED Q:+($G(Y))'>0 0
"RTN","GMTSXPD1",49,0)
 S DR="1///^S X="""_$G(GMTSTAG)_"""_$C(59)_"""_$G(GMTSRTN)_""""
"RTN","GMTSXPD1",50,0)
 S:$L($G(GMTSTIML)) DR=DR_";2///"_GMTSTIML
"RTN","GMTSXPD1",51,0)
 S:$L($G(GMTSABBR)) DR=DR_";3///"_GMTSABBR S:$L($G(GMTSOCCL)) DR=DR_";4///"_GMTSOCCL
"RTN","GMTSXPD1",52,0)
 S:$L($G(GMTSDAF)) DR=DR_";5///"_GMTSDAF S:$L($G(GMTSSKEY)) DR=DR_";6///"_GMTSSKEY
"RTN","GMTSXPD1",53,0)
 S:$L($G(GMTSOOM)) DR=DR_";8///"_GMTSOOM S:$L($G(GMTSDHDN)) DR=DR_";9///"_GMTSDHDN
"RTN","GMTSXPD1",54,0)
 S:$L($G(GMTSHOSL)) DR=DR_";10///"_GMTSHOSL S:$L($G(GMTSICDT)) DR=DR_";11///"_GMTSICDT
"RTN","GMTSXPD1",55,0)
 S:$L($G(GMTSPROV)) DR=DR_";12///"_GMTSPROV S:$L($G(GMTSPREF)) DR=DR_";13///"_GMTSPREF
"RTN","GMTSXPD1",56,0)
 S:$L($G(GMTSCPTM)) DR=DR_";14///"_GMTSCPTM
"RTN","GMTSXPD1",57,0)
 S DIE="^GMT(142.1," D ^DIE D:$D(GMTSINI) DES(.GMTSINI),SEL(.GMTSINI),EXT(.GMTSINI)
"RTN","GMTSXPD1",58,0)
 S DIK="^GMT(142.1," D IX^DIK D:GMTSTAT&($D(^GMT(142.1,+($G(DA)),0))) SCESE D:'GMTSTAT&($D(^GMT(142.1,+($G(DA)),0))) SCESS
"RTN","GMTSXPD1",59,0)
 I $D(GMTSINI("PDX")) S GMTSNAME=$G(GMTSNAME),GMTSTIML=$G(GMTSTIML),GMTSOCCL=$G(GMTSOCCL) D PDX^GMTSXPD5(GMTSNAME,GMTSTIML,GMTSOCCL)
"RTN","GMTSXPD1",60,0)
 Q 1
"RTN","GMTSXPD1",61,0)
 ;                 
"RTN","GMTSXPD1",62,0)
DES(GMTSINI) ; Description
"RTN","GMTSXPD1",63,0)
 N GMTSD0,GMTSD1,GMTSN,GMTSD,GMTSDT,GMTSIEN S GMTSIEN=+($G(GMTSINI(0))),(GMTSD0,GMTSD1)=0,GMTSDT=$P($$NOW^XLFDT,".",1)
"RTN","GMTSXPD1",64,0)
 F  S GMTSD1=$O(GMTSINI(3.5,GMTSD1)) Q:+GMTSD1=0  S GMTSD0=GMTSD0+1
"RTN","GMTSXPD1",65,0)
 Q:+($G(GMTSD0))=0  S GMTSINI(3.5)=GMTSD0,GMTSD1=+($G(GMTSINI(3.5))),GMTSD0="^^"_GMTSD1_"^"_GMTSD1_"^"_GMTSDT_"^"
"RTN","GMTSXPD1",66,0)
 S GMTSN="^GMT(142.1,"_GMTSIEN_",3.5,0)",GMTSD=GMTSD0,@GMTSN=GMTSD,GMTSD1=0
"RTN","GMTSXPD1",67,0)
 F  S GMTSD1=$O(GMTSINI(3.5,GMTSD1)) Q:+GMTSD1=0  S GMTSN="^GMT(142.1,"_GMTSIEN_",3.5,"_GMTSD1_",0)",GMTSD=$G(GMTSINI(3.5,GMTSD1)),@GMTSN=GMTSD
"RTN","GMTSXPD1",68,0)
 Q
"RTN","GMTSXPD1",69,0)
SEL(GMTSINI) ; Selection Items
"RTN","GMTSXPD1",70,0)
 N GMTSD0,GMTSD1,GMTSN,GMTSF,GMTST,GMTSD,GMTSIEN S GMTSIEN=+($G(GMTSINI(0))),(GMTSD0,GMTSD1)=0
"RTN","GMTSXPD1",71,0)
 F  S GMTSD1=$O(GMTSINI(7,GMTSD1)) Q:+GMTSD1=0  D
"RTN","GMTSXPD1",72,0)
 . S GMTSD=$G(GMTSINI(7,GMTSD1)),GMTSF=+($P(GMTSD,"^",1)) Q:+GMTSF=0  Q:'$D(^DD(+GMTSF))  S GMTSD0=GMTSD0+1
"RTN","GMTSXPD1",73,0)
 Q:+($G(GMTSD0))=0  S GMTSINI(7)=GMTSD0,GMTSD1=+($G(GMTSINI(7)))
"RTN","GMTSXPD1",74,0)
 S GMTSD0="^142.17P^"_GMTSD1_"^"_GMTSD1,GMTSN="^GMT(142.1,"_GMTSIEN_",1,0)",GMTSD=GMTSD0,@GMTSN=GMTSD
"RTN","GMTSXPD1",75,0)
 S GMTSD1=0 F  S GMTSD1=$O(GMTSINI(7,GMTSD1)) Q:+GMTSD1=0  D
"RTN","GMTSXPD1",76,0)
 . S GMTSN="^GMT(142.1,"_GMTSIEN_",1,"_GMTSD1_",0)"
"RTN","GMTSXPD1",77,0)
 . S GMTSD=$G(GMTSINI(7,GMTSD1)),GMTSF=+($P(GMTSD,"^",1)) Q:+GMTSF=0  Q:'$D(^DD(GMTSF))
"RTN","GMTSXPD1",78,0)
 . S GMTST=+($P(GMTSD,"^",2)) S:GMTST=0 GMTST=""
"RTN","GMTSXPD1",79,0)
 . S GMTSD=GMTSF S:GMTST>0 $P(GMTSD,"^",2)=GMTST S @GMTSN=GMTSD
"RTN","GMTSXPD1",80,0)
 . S GMTSN="^GMT(142.1,"_GMTSIEN_",1,""B"","_GMTSF_","_GMTSD1_")",GMTSD="",@GMTSN=GMTSD
"RTN","GMTSXPD1",81,0)
 Q
"RTN","GMTSXPD1",82,0)
EXT(GMTSINI) ; Extract Routines
"RTN","GMTSXPD1",83,0)
 N GMTSD0,GMTSD1,GMTSN,GMTSF,GMTST,GMTSD,GMTSIEN S GMTSIEN=+($G(GMTSINI(0))),(GMTSD0,GMTSD1)=0
"RTN","GMTSXPD1",84,0)
 F  S GMTSD1=$O(GMTSINI(1.1,GMTSD1)) Q:+GMTSD1=0  D
"RTN","GMTSXPD1",85,0)
 . S GMTSD=$G(GMTSINI(1.1,GMTSD1)) Q:'$L(GMTSD)  S GMTSTAG=$P(GMTSD,";",1),GMTSRTN=$P(GMTSD,";",2)
"RTN","GMTSXPD1",86,0)
 . S:$L(GMTSTAG)&('$L(GMTSRTN)) GMTSRTN=GMTSTAG,GMTSTAG="" Q:'$L(GMTSRTN)  S GMTSD0=GMTSD0+1
"RTN","GMTSXPD1",87,0)
 Q:+($G(GMTSD0))=0  S GMTSINI(1.1)=GMTSD0,GMTSD1=+($G(GMTSINI(1.1)))
"RTN","GMTSXPD1",88,0)
 S GMTSD0="^142.11^"_GMTSD1_"^"_GMTSD1,GMTSN="^GMT(142.1,"_GMTSIEN_",.1,0)",GMTSD=GMTSD0,@GMTSN=GMTSD
"RTN","GMTSXPD1",89,0)
 S (GMTSD0,GMTSD1)=0 F  S GMTSD1=$O(GMTSINI(1.1,GMTSD1)) Q:+GMTSD1=0  D
"RTN","GMTSXPD1",90,0)
 . S GMTSD=$G(GMTSINI(1.1,GMTSD1)) Q:'$L(GMTSD)  S GMTSTAG=$P(GMTSD,";",1),GMTSRTN=$P(GMTSD,";",2) S:$L(GMTSTAG)&('$L(GMTSRTN)) GMTSRTN=GMTSTAG,GMTSTAG="" Q:'$L(GMTSRTN)
"RTN","GMTSXPD1",91,0)
 . S GMTSD0=GMTSD0+1,GMTSN="^GMT(142.1,"_GMTSIEN_",.1,"_GMTSD0_",0)",GMTSD=$G(GMTSINI(1.1,GMTSD1)),@GMTSN=GMTSD
"RTN","GMTSXPD1",92,0)
 . S GMTSN="^GMT(142.1,"_GMTSIEN_",.1,""B"","""_GMTSD_""","_GMTSD0_")",GMTSD="",@GMTSN=GMTSD
"RTN","GMTSXPD1",93,0)
 Q
"RTN","GMTSXPD1",94,0)
 ;              
"RTN","GMTSXPD1",95,0)
 ; Messages
"RTN","GMTSXPD1",96,0)
INST ;   Installing Component
"RTN","GMTSXPD1",97,0)
 N GMTST S GMTST=" Filing """_$$UP(GMTSMNM)_""" component in Health Summary" D BM(GMTST) Q
"RTN","GMTSXPD1",98,0)
 ;   Reasons to Abort Install
"RTN","GMTSXPD1",99,0)
HSVNF ;     Health Summary Version not found
"RTN","GMTSXPD1",100,0)
 N GMTST S GMTST="   Health Summary Version 2.7 not found" D BM(GMTST) Q
"RTN","GMTSXPD1",101,0)
ALRDY ;     Component Already Installed
"RTN","GMTSXPD1",102,0)
 N GMTST S GMTST="   Component has already been installed" D M(GMTST) Q
"RTN","GMTSXPD1",103,0)
NNAME ;     No Name
"RTN","GMTSXPD1",104,0)
 N GMTST S GMTST="   No or invalid Health Summary Component name" D M(GMTST) D NOTI Q
"RTN","GMTSXPD1",105,0)
NRTN ;     No Routine
"RTN","GMTSXPD1",106,0)
 N GMTST S GMTST="   No or invalid Health Summary display routine" D M(GMTST) D NOTI Q
"RTN","GMTSXPD1",107,0)
FAILED ;     Failed Installation
"RTN","GMTSXPD1",108,0)
 N GMTST S GMTST="   Failed to install component" D M(GMTST) Q
"RTN","GMTSXPD1",109,0)
EXIST ;     DINUMed entry Exist
"RTN","GMTSXPD1",110,0)
 N GMTST S GMTST="   Can not add component, DINUM'ed entry already exist" D M(GMTST) Q
"RTN","GMTSXPD1",111,0)
NOTI ;     Not Installed
"RTN","GMTSXPD1",112,0)
 N GMTST S GMTST="   Could not install new component" D M(GMTST) Q
"RTN","GMTSXPD1",113,0)
 ;   Success
"RTN","GMTSXPD1",114,0)
SCESS ;     Successfully Installed
"RTN","GMTSXPD1",115,0)
 N GMTSD S GMTSD=0 D DISAB Q:+($G(GMTSD))
"RTN","GMTSXPD1",116,0)
 N GMTST S GMTST="   Successfully installed new component" D M(GMTST) Q
"RTN","GMTSXPD1",117,0)
SCESE ;     Successfully Edited
"RTN","GMTSXPD1",118,0)
 N GMTSD S GMTSD=0 D DISAB Q:+($G(GMTSD))
"RTN","GMTSXPD1",119,0)
 N GMTST S GMTST="   Successfully edited/updated component" D M(GMTST) Q
"RTN","GMTSXPD1",120,0)
DISAB ;     Disabled Component
"RTN","GMTSXPD1",121,0)
 Q:+($G(GMTSIEN))=0  Q:$P($G(^GMT(142.1,+($G(GMTSIEN)),0)),"^",6)=""
"RTN","GMTSXPD1",122,0)
 N GMTSF,GMTSM,GMTST S GMTSF=$P($G(^GMT(142.1,+($G(GMTSIEN)),0)),"^",6)
"RTN","GMTSXPD1",123,0)
 S GMTSF=$S(GMTSF="T":"Temporarily",GMTSF="P":"Permanently",1:"") Q:'$L(GMTSF)
"RTN","GMTSXPD1",124,0)
 S GMTSD=1,GMTST="",GMTSM=$P($G(^GMT(142.1,+($G(GMTSIEN)),0)),"^",8)
"RTN","GMTSXPD1",125,0)
 S GMTST="   Componet """_$$UP(GMTSMNM)_""" is installed, but "_GMTSF_" disabled" D M(GMTST)
"RTN","GMTSXPD1",126,0)
 S GMTST="" S:$L(GMTSM) GMTST="   Out of order message:  """_GMTSM_"""" D:$L(GMTST) M(GMTST)
"RTN","GMTSXPD1",127,0)
 Q
"RTN","GMTSXPD1",128,0)
 ;                 
"RTN","GMTSXPD1",129,0)
 ; Other
"RTN","GMTSXPD1",130,0)
ENV(X) ;   Environment check
"RTN","GMTSXPD1",131,0)
 D HOME^%ZIS I '$D(^VA(200,+($G(DUZ)),0)) D BM("    User (DUZ) not defined"),M("") Q 0
"RTN","GMTSXPD1",132,0)
 I '$L($P($G(^VA(200,+($G(DUZ)),0)),"^",1)) D BM("    Invalid User defined (DUZ)"),M("") Q 0
"RTN","GMTSXPD1",133,0)
 Q 1
"RTN","GMTSXPD1",134,0)
BM(X) ;   Blank Line with Message
"RTN","GMTSXPD1",135,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSXPD1",136,0)
M(X) ;   Message
"RTN","GMTSXPD1",137,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSXPD1",138,0)
UP(X) ;   Uppercase
"RTN","GMTSXPD1",139,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXPD2")
0^20^B3708226
"RTN","GMTSXPD2",1,0)
GMTSXPD2 ; SLC/KER - Health Summary Dist (Component)     ; 04/11/2000
"RTN","GMTSXPD2",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSXPD2",3,0)
 ;
"RTN","GMTSXPD2",4,0)
 Q
"RTN","GMTSXPD2",5,0)
 ;                 
"RTN","GMTSXPD2",6,0)
 ; Check Input
"RTN","GMTSXPD2",7,0)
NAME(X) ;   Check Name (required)
"RTN","GMTSXPD2",8,0)
 S X=$G(X) K:X[""""!($A(X)=45) X Q:'$D(X) ""
"RTN","GMTSXPD2",9,0)
 I $D(X) K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"RTN","GMTSXPD2",10,0)
 I $L($G(X)),'$D(^GMT(142.1,+($G(Y)),0)) D
"RTN","GMTSXPD2",11,0)
 . K:$D(^GMT(142.1,"B",X)) X Q:'$D(X)  Q:+($G(Y))'>0  I $P($G(^GMT(142.1,+($G(Y)),0)),"^",1)'=$G(X) K X
"RTN","GMTSXPD2",12,0)
 S X=$G(X) Q X
"RTN","GMTSXPD2",13,0)
ROUT(X) ;   Check Routine (required)
"RTN","GMTSXPD2",14,0)
 S X=$G(X) K:X[""""!($A(X)=45) X Q:'$D(X) ""
"RTN","GMTSXPD2",15,0)
 K:$L(X)>17!($L(X)<3)!'(X?1U1.7UN1";"1U1.7UN) X Q:'$D(X) ""
"RTN","GMTSXPD2",16,0)
 I @("$L($T("_$P(X,";")_"^"_$P(X,";",2)_"))'>0") K X
"RTN","GMTSXPD2",17,0)
 S X=$G(X) Q X
"RTN","GMTSXPD2",18,0)
TIML(X) ;   Check Time Limits
"RTN","GMTSXPD2",19,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",20,0)
ABBR(X) ;   Check Abbreviation
"RTN","GMTSXPD2",21,0)
 S X=$G(X) S:X[""""!($A(X)=45) X="" S:$L(X)>4!($L(X)<2)!'(X?2.4UN) X="" Q X
"RTN","GMTSXPD2",22,0)
OCCL(X) ;   Check Occurrence Limits
"RTN","GMTSXPD2",23,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",24,0)
LOCK(X) ;   Check Lock
"RTN","GMTSXPD2",25,0)
 S X=$G(X) S:X[""""!($A(X)=45) X="" S:$L(X)>30!($L(X)<1) X="" Q:'$L(X) "" S:'$D(^DIC(19.1,"B",X)) X="" Q X
"RTN","GMTSXPD2",26,0)
DHDN(X) ;   Check Default Header Name
"RTN","GMTSXPD2",27,0)
 S X=$G(X) S:X[""""!($A(X)=45) X="" S:$L(X)>20!($L(X)<2) X="" Q X
"RTN","GMTSXPD2",28,0)
HOSL(X) ;   Check Hospital Locaiton Flag
"RTN","GMTSXPD2",29,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",30,0)
ICDT(X) ;   Check ICD Text Flag
"RTN","GMTSXPD2",31,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",32,0)
PROV(X) ;   Check Provider Narrative Flag
"RTN","GMTSXPD2",33,0)
 S X=$G(X) Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",34,0)
PREF(X) ;   Check Prefix
"RTN","GMTSXPD2",35,0)
 S X=$G(X) N GMTS S GMTS=$$GET1^DID(142.1,13,,"LABEL") Q:'$L(GMTS) ""
"RTN","GMTSXPD2",36,0)
 S:X[""""!($A(X)=45) X="" S:$L(X)>4!($L(X)<2) X="" S:$E(X,1,2)'?2U X="" S:X'?1U.UN X="" Q X
"RTN","GMTSXPD2",37,0)
CPTM(X) ;   Check CPT Modifier Flag
"RTN","GMTSXPD2",38,0)
 S X=$G(X) N GMTS S GMTS=$$GET1^DID(142.1,14,,"LABEL") Q:'$L(GMTS) ""
"RTN","GMTSXPD2",39,0)
 Q:X="1"!(X="Y") "Y" Q ""
"RTN","GMTSXPD2",40,0)
DAF(X) ;   Check Disable Flag
"RTN","GMTSXPD2",41,0)
 S X=$G(X) Q:X="T" "T" Q:X="T" "P" Q ""
"RTN","GMTSXPD2",42,0)
OOM(X) ;   Check Out of Order Message
"RTN","GMTSXPD2",43,0)
 S X=$G(X) Q:$L(X)<3 "" Q:$L(X)>78 "" Q X
"RTN","GMTSXPD2",44,0)
 Q
"RTN","GMTSXPD3")
0^21^B50732572
"RTN","GMTSXPD3",1,0)
GMTSXPD3 ; SLC/KER - Health Summary Dist (Index/ADH)     ; 04/11/2000
"RTN","GMTSXPD3",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSXPD3",3,0)
 Q
"RTN","GMTSXPD3",4,0)
 ;                      
"RTN","GMTSXPD3",5,0)
BUILD ; Rebuild AD Hoc Health Summary 
"RTN","GMTSXPD3",6,0)
 ;   Set Variable GMTSQT for QUIET Rebuild
"RTN","GMTSXPD3",7,0)
 N GMTSENV,DIK,DA,X,Y,INCLUDE S GMTSENV=$$ENV Q:'GMTSENV  S INCLUDE=0 D M(" "),RC,RT,RB
"RTN","GMTSXPD3",8,0)
 Q
"RTN","GMTSXPD3",9,0)
BUILDQ ; Quiet Rebuild
"RTN","GMTSXPD3",10,0)
 N GMTSQT S GMTSQT="" D BUILD Q
"RTN","GMTSXPD3",11,0)
 ;
"RTN","GMTSXPD3",12,0)
TSK(X) ; Tasked Rebuild 
"RTN","GMTSXPD3",13,0)
 ;   Returns   0  Not tasked
"RTN","GMTSXPD3",14,0)
 ;            -1  Currently running
"RTN","GMTSXPD3",15,0)
 ;             #  Task Number
"RTN","GMTSXPD3",16,0)
 ;
"RTN","GMTSXPD3",17,0)
 S X=0,ZTRTN="TSKB^GMTSXPD3",ZTDESC="Rebuilding AD Hoc Health Summary",ZTIO="",ZTDTH=$H
"RTN","GMTSXPD3",18,0)
 S:$D(^TMP("GMTSXPD3")) X=-1 Q:X<0 X
"RTN","GMTSXPD3",19,0)
 I '$D(^TMP("GMTSXPD3")) S ^TMP("GMTSXPD3")="" D ^%ZTLOAD
"RTN","GMTSXPD3",20,0)
 S X=+($G(ZTSK)) D HOME^%ZIS K ZTSAVE,ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSK
"RTN","GMTSXPD3",21,0)
 Q X
"RTN","GMTSXPD3",22,0)
TSKB S ^TMP("GMTSXPD3")="" S:$D(ZTQUEUED) ZTREQ="@" D BUILDQ K ^TMP("GMTSXPD3")
"RTN","GMTSXPD3",23,0)
 Q
"RTN","GMTSXPD3",24,0)
TO(GMTSCOM,GMTSTIM,GMTSOCC) ;  Update Ad Hoc default time and occurrences
"RTN","GMTSXPD3",25,0)
 N GMTSTAD,GMTSTAS,GMTSTAN,GMTSTNN,GMTSTOT,GMTSTOC,GMTSTOO,GMTSTAV
"RTN","GMTSXPD3",26,0)
 N GMTSTTA,GMTSTOA,GMTSTQN,GMTST1,GMTST2,GMTSTLL,GMTSOLL
"RTN","GMTSXPD3",27,0)
 S GMTSCOM=$G(GMTSCOM) Q:'$L(GMTSCOM)  S GMTSTIM=$$UP($G(GMTSTIM)),GMTSTAD=$$A S:+GMTSTIM=0 GMTSTIM=""
"RTN","GMTSXPD3",28,0)
 S GMTSOCC=+($G(GMTSOCC)) S:GMTSOCC=0 GMTSOCC="" S GMTSCOM=$$R(GMTSCOM),GMTSTOC=$$C(GMTSCOM),GMTSTTA=0 S:GMTSCOM=GMTSTOC GMTSTTA=$$TA(GMTSCOM)
"RTN","GMTSXPD3",29,0)
 S GMTSTOA=0 S:GMTSCOM=GMTSTOC GMTSTOA=$$OA(GMTSCOM) S GMTSTOT=$$T(GMTSTIM),GMTSTOO=$$O(GMTSOCC)
"RTN","GMTSXPD3",30,0)
 S GMTSTAD=$$A,GMTSTAS=$$S(GMTSTAD,GMTSTOC),GMTSTAN=$$N(GMTSTAD,GMTSTAS),GMTSTAV=""
"RTN","GMTSXPD3",31,0)
 S:$L(GMTSTAN) GMTSTAV=@GMTSTAN S GMTSTNN=GMTSTAV,GMTSTQN="" S:$L(GMTSTNN,"^")>2&(GMTSTOO=GMTSOCC) $P(GMTSTNN,"^",3)=GMTSOCC
"RTN","GMTSXPD3",32,0)
 S:$L(GMTSOCC)&(GMTSTOO=GMTSOCC) $P(GMTSTNN,"^",3)=GMTSOCC S:$L(GMTSTNN,"^")>3&(GMTSTOT=GMTSTIM) $P(GMTSTNN,"^",4)=GMTSTIM
"RTN","GMTSXPD3",33,0)
 S:$L(GMTSTIM)&(GMTSTOT=GMTSTIM) $P(GMTSTNN,"^",4)=GMTSTIM S:'GMTSTTA&($L(GMTSTNN,"^")>3) GMTSTNN=$P(GMTSTNN,"^",1,3)
"RTN","GMTSXPD3",34,0)
 S:'GMTSTTA&($P(GMTSTNN,"^",3)="") GMTSTNN=$P(GMTSTNN,"^",1,2) S:'GMTSTOA&($L(GMTSTNN,"^")=3) GMTSTNN=$P(GMTSTNN,"^",1,2)
"RTN","GMTSXPD3",35,0)
 S:'GMTSTOA&($L(GMTSTNN,"^")>3) $P(GMTSTNN,"^",3)=""
"RTN","GMTSXPD3",36,0)
 S:+GMTSTAS>0&($D(^GMT(142,+($G(GMTSTAD)),1,+GMTSTAS,0))) $P(GMTSTQN,"^",1)=GMTSTAS
"RTN","GMTSXPD3",37,0)
 S:+GMTSTOC>0&(GMTSTOC=GMTSCOM)&($D(^GMT(142.1,+($G(GMTSTOC)),0))) $P(GMTSTQN,"^",2)=GMTSTOC
"RTN","GMTSXPD3",38,0)
 S:+GMTSTOA>0&($L(GMTSTOO)) $P(GMTSTQN,"^",3)=GMTSTOO,GMTSOCC=GMTSTOO
"RTN","GMTSXPD3",39,0)
 S:+GMTSTTA>0&($L(GMTSTOT)) $P(GMTSTQN,"^",4)=GMTSTOT,GMTSTIM=GMTSTOT
"RTN","GMTSXPD3",40,0)
 S:+GMTSTOA=0&($L(GMTSTOO)) GMTSTOO="" S:+GMTSTTA=0&($L(GMTSTOT)) GMTSTOT=""
"RTN","GMTSXPD3",41,0)
 Q:'$L(GMTSTAN)  Q:'$L(GMTSTQN)  Q:'$D(^GMT(142,+($G(GMTSTAD)),0))  Q:'$D(^GMT(142,+($G(GMTSTAD)),1,+($G(GMTSTAS)),0))
"RTN","GMTSXPD3",42,0)
 Q:GMTSTOT'=GMTSTIM  Q:GMTSTOO'=GMTSOCC  Q:GMTSCOM'=GMTSTOC  Q:$P(GMTSTNN,"^",1,2)'=$P(GMTSTQN,"^",1,2)
"RTN","GMTSXPD3",43,0)
 S GMTSCOM=$P(GMTSTQN,"^",2),GMTSOCC=$P(GMTSTQN,"^",3),GMTSTIM=$P(GMTSTQN,"^",4)
"RTN","GMTSXPD3",44,0)
 Q:+GMTSCOM=0  S GMTSCOM=$P($G(^GMT(142.1,+GMTSCOM,0)),"^",1) Q:'$L(GMTSCOM)
"RTN","GMTSXPD3",45,0)
 S GMTST1=" Setting time and occurrence limits for GMTS HS ADHOC OPTION component" D BM(GMTST1)
"RTN","GMTSXPD3",46,0)
 S GMTSOLL=$$OLL(+GMTSOCC),GMTSTLL=$$TLL(GMTSTIM)
"RTN","GMTSXPD3",47,0)
 I $L(GMTSOLL),$L(GMTSTLL) D
"RTN","GMTSXPD3",48,0)
 . S GMTST1=" "_GMTSCOM_" (Limits - "_GMTSTLL_" and "_GMTSOLL_")" D M(GMTST1)
"RTN","GMTSXPD3",49,0)
 I '$L(GMTSOLL)!('$L(GMTSTLL)) D
"RTN","GMTSXPD3",50,0)
 . S GMTST1=" "_GMTSCOM D M(GMTST1)
"RTN","GMTSXPD3",51,0)
 . S GMTST1=$S($L($G(GMTSTIM))&($L($G(GMTSTLL))):"   Limits:        ",1:"   Time Limits:        ")
"RTN","GMTSXPD3",52,0)
 . S GMTST2=$S($L($G(GMTSTIM))&('$L($G(GMTSTLL))):GMTSTIM,$L($G(GMTSTIM))&($L($G(GMTSTLL))):GMTSTLL,1:"No time limit <null>") D M((GMTST1_GMTST2))
"RTN","GMTSXPD3",53,0)
 . S GMTST1=$S($L($G(GMTSTIM))&($L($G(GMTSTLL))):"                  ",1:"   Occurrence Limits:  ")
"RTN","GMTSXPD3",54,0)
 . S GMTST2=$S($L($G(GMTSOCC))&('$L($G(GMTSOLL))):GMTSOCC,$L($G(GMTSOCC))&($L($G(GMTSOLL))):GMTSOLL,1:"No occurrence limit <null>") D M((GMTST1_GMTST2))
"RTN","GMTSXPD3",55,0)
 S @GMTSTAN=GMTSTQN
"RTN","GMTSXPD3",56,0)
 Q
"RTN","GMTSXPD3",57,0)
 ;                      
"RTN","GMTSXPD3",58,0)
 ; Indexing                     
"RTN","GMTSXPD3",59,0)
RT ;   Re-Index HS Type File
"RTN","GMTSXPD3",60,0)
 N GMTST,GMTSL,GMTSQ,GMTSC,GMTSE,DA,DIK,DIC,X,Y
"RTN","GMTSXPD3",61,0)
 S U="^",GMTSE=59,GMTST=" Re-Indexing Health Summary Type file "
"RTN","GMTSXPD3",62,0)
 S GMTSL=$L(GMTST),(GMTSC,DA)=0 F  S DA=$O(^GMT(142,DA)) Q:+DA=0  S GMTSC=GMTSC+1
"RTN","GMTSXPD3",63,0)
 S GMTSC=GMTSC-1,GMTSQ=GMTSC\(GMTSE-$L(GMTST)) D M(GMTST)
"RTN","GMTSXPD3",64,0)
 S DIK="^GMT(142,",(GMTSC,DA)=0 F  S DA=$O(^GMT(142,DA)) Q:+DA=0  D
"RTN","GMTSXPD3",65,0)
 . D IX^DIK Q:$D(GMTSQT)
"RTN","GMTSXPD3",66,0)
 . S GMTSC=GMTSC+1 S:GMTSC#GMTSQ=0 GMTSL=GMTSL+1 Q:GMTSL>GMTSE
"RTN","GMTSXPD3",67,0)
 . W:GMTSC#GMTSQ=0 "."
"RTN","GMTSXPD3",68,0)
 I '$D(GMTSQT),GMTSL'>GMTSE F  S GMTSL=GMTSL+1 Q:GMTSL>GMTSE  W "."
"RTN","GMTSXPD3",69,0)
 W:'$D(GMTSQT) ?GMTSE," < done >"
"RTN","GMTSXPD3",70,0)
 Q
"RTN","GMTSXPD3",71,0)
RC ;   Re-Index HS Component File
"RTN","GMTSXPD3",72,0)
 N GMTST,GMTSL,GMTSQ,GMTSC,GMTSE,DA,DIK,DIC,X,Y
"RTN","GMTSXPD3",73,0)
 S U="^",GMTSE=59,GMTST=" Re-Indexing Health Summary Component file ",GMTSL=$L(GMTST),(GMTSC,DA)=0
"RTN","GMTSXPD3",74,0)
 F  S DA=$O(^GMT(142.1,DA)) Q:+DA=0  S GMTSC=GMTSC+1
"RTN","GMTSXPD3",75,0)
 S GMTSC=GMTSC-1,GMTSQ=GMTSC\(GMTSE-$L(GMTST)) D M(GMTST)
"RTN","GMTSXPD3",76,0)
 S DIK="^GMT(142.1,",(GMTSC,DA)=0 F  S DA=$O(^GMT(142.1,DA)) Q:+DA=0  D
"RTN","GMTSXPD3",77,0)
 . D IX^DIK Q:$D(GMTSQT)
"RTN","GMTSXPD3",78,0)
 . S GMTSC=GMTSC+1 S:GMTSC#GMTSQ=0 GMTSL=GMTSL+1 Q:GMTSL>GMTSE
"RTN","GMTSXPD3",79,0)
 . W:GMTSC#GMTSQ=0 "."
"RTN","GMTSXPD3",80,0)
 I '$D(GMTSQT),GMTSL'>GMTSE F  S GMTSL=GMTSL+1 Q:GMTSL>GMTSE  W "."
"RTN","GMTSXPD3",81,0)
 W:'$D(GMTSQT) ?GMTSE," < done >"
"RTN","GMTSXPD3",82,0)
 Q
"RTN","GMTSXPD3",83,0)
RA ;   Re-Index HS Type "Ad Hoc"
"RTN","GMTSXPD3",84,0)
 N GMTST,DA,DIK S DIK="^GMT(142,",DA=$$A,U="^" Q:+DA=0  D IX1^DIK
"RTN","GMTSXPD3",85,0)
 Q
"RTN","GMTSXPD3",86,0)
RB ;   Re-Build Ad Hoc Health Summary Type
"RTN","GMTSXPD3",87,0)
 D RB^GMTSXPD4 Q
"RTN","GMTSXPD3",88,0)
 ;                      
"RTN","GMTSXPD3",89,0)
 ; Check Input
"RTN","GMTSXPD3",90,0)
T(X) ;   Time Input Transform
"RTN","GMTSXPD3",91,0)
 S X=$$UP^XLFSTR($G(X)) S:$L(X)>5!($L(X)<1)!'((X?1N.N1U)!(X?1N.N1"D")!(X?1N.N1"W")!(X?1N.N1"M")!(X?1N.N1"Y")) X="1Y" Q X
"RTN","GMTSXPD3",92,0)
O(X) ;   Occurrence Input Transform
"RTN","GMTSXPD3",93,0)
 S X=$G(X) S:+X'=X!(X>99999)!(X<1)!(X?.E1"."1N.N) X="10" Q X
"RTN","GMTSXPD3",94,0)
C(X) ;   Component Input Transform
"RTN","GMTSXPD3",95,0)
 S X=$G(X) Q:'$L(X) "Error" Q:+X'>0 "Error" Q:'$D(^GMT(142.1,+X,0)) "Error" S X=+X Q X
"RTN","GMTSXPD3",96,0)
R(X) ;   Resolve Pointer
"RTN","GMTSXPD3",97,0)
 S X=$G(X) Q:'$L(X) "" N GMTSA S GMTSA=X I $D(^GMT(142.1,+X,0)) S X=+X Q X
"RTN","GMTSXPD3",98,0)
 S:$D(^GMT(142.1,"B",X)) GMTSA=+($O(^GMT(142.1,"B",X,0))) S:GMTSA=X&($D(^GMT(142.1,"B",$$UP(X)))) GMTSA=+($O(^GMT(142.1,"B",$$UP(X),0))) I GMTSA'=X S X=GMTSA Q X
"RTN","GMTSXPD3",99,0)
 S:GMTSA=X&($D(^GMT(142.1,"C",X))) GMTSA=+($O(^GMT(142.1,"C",X,0))) S:GMTSA=X&($D(^GMT(142.1,"C",$$UP(X)))) GMTSA=+($O(^GMT(142.1,"C",$$UP(X),0))) I GMTSA'=X S X=GMTSA Q X
"RTN","GMTSXPD3",100,0)
 S:GMTSA=X&($D(^GMT(142.1,"D",X))) GMTSA=+($O(^GMT(142.1,"D",X,0))) S:GMTSA=X&($D(^GMT(142.1,"D",$$UP(X)))) GMTSA=+($O(^GMT(142.1,"D",$$UP(X),0))) I GMTSA'=X S X=GMTSA Q X
"RTN","GMTSXPD3",101,0)
 Q ""
"RTN","GMTSXPD3",102,0)
A(X) ;   Ad Hoc IEN
"RTN","GMTSXPD3",103,0)
 S X=0 S X=+($O(^GMT(142,"AB","GMTS HS ADHOC OPTION",0))) Q:+X>0 +X
"RTN","GMTSXPD3",104,0)
 S X=+($O(^GMT(142,"B","GMTS HS ADHOC OPTION",0))) Q:+X>0 +X
"RTN","GMTSXPD3",105,0)
 S X=+($O(^GMT(142,"E","Ad Hoc Health Summary Type",0))) Q:+X>0 +X Q 0
"RTN","GMTSXPD3",106,0)
S(GMTSA,GMTSC) ;   Structure IEN
"RTN","GMTSXPD3",107,0)
 N GMTST1,GMTST2 S GMTSA=+($G(GMTSA)) Q:GMTSA=0 ""
"RTN","GMTSXPD3",108,0)
 S GMTSC=+($G(GMTSC)) Q:GMTSC=0 ""
"RTN","GMTSXPD3",109,0)
 Q:'$D(^GMT(142,GMTSA,1,"C",GMTSC)) ""
"RTN","GMTSXPD3",110,0)
 Q:'$D(^GMT(142,"AE",GMTSC,GMTSA)) ""
"RTN","GMTSXPD3",111,0)
 S GMTST1=+($O(^GMT(142,GMTSA,1,"C",GMTSC,0)))
"RTN","GMTSXPD3",112,0)
 S GMTST2=+($O(^GMT(142,"AE",GMTSC,GMTSA,0)))
"RTN","GMTSXPD3",113,0)
 Q:GMTST1'=GMTST2!(GMTST1=0)!(GMTST2=0) "" S GMTSA=GMTST1 Q GMTSA
"RTN","GMTSXPD3",114,0)
N(GMTSA,GMTSC) ;   Structure IEN
"RTN","GMTSXPD3",115,0)
 N GMTST1,GMTST2
"RTN","GMTSXPD3",116,0)
 S GMTSA=+($G(GMTSA)) Q:GMTSA=0 "" S GMTSC=+($G(GMTSC)) Q:GMTSC=0 ""
"RTN","GMTSXPD3",117,0)
 S GMTST1="^GMT(142,"_GMTSA_",1,"_GMTSC_",0)",GMTST2=$G(@GMTST1)
"RTN","GMTSXPD3",118,0)
 Q:'$D(@GMTST1) "" Q:'$L(GMTST2) "" S GMTSA=GMTST1 Q GMTSA
"RTN","GMTSXPD3",119,0)
 Q
"RTN","GMTSXPD3",120,0)
TA(X) ;   Time Limits Applicable             S   Y:yes     0;3
"RTN","GMTSXPD3",121,0)
 N GMTSA S GMTSA=$P($G(^GMT(142.1,+($G(X)),0)),"^",3),X=$S(GMTSA="Y":1,1:0) Q X
"RTN","GMTSXPD3",122,0)
OA(X) ;   Maximum Occurrences Applicable     S   Y:yes     0;5
"RTN","GMTSXPD3",123,0)
 N GMTSA S GMTSA=$P($G(^GMT(142.1,+($G(X)),0)),"^",5),X=$S(GMTSA="Y":1,1:0) Q X
"RTN","GMTSXPD3",124,0)
TLL(X) ;   Time Limits (Litteral)
"RTN","GMTSXPD3",125,0)
 S X=$$UP($G(X))
"RTN","GMTSXPD3",126,0)
 N GMTSU,GMTSQ S GMTSQ=+X,GMTSU=$E(X,$L(X)) Q:GMTSU="^"!(GMTSU="") "" Q:GMTSQ=0 ""
"RTN","GMTSXPD3",127,0)
 Q:"^D^W^M^Y^"'[GMTSU "" S GMTSU=$S(GMTSU="D":" day",GMTSU="W":" week",GMTSU="M":" month",GMTSU="Y":" year",1:"") Q:'$L(GMTSU) ""
"RTN","GMTSXPD3",128,0)
 S GMTSU=$S(+GMTSQ>1:(GMTSU_"s"),1:GMTSU) S X=+GMTSQ_GMTSU
"RTN","GMTSXPD3",129,0)
 Q X
"RTN","GMTSXPD3",130,0)
OLL(X) ;   Occurrence Limits (Litteral)
"RTN","GMTSXPD3",131,0)
 S X=+($G(X)) Q:X=0 ""
"RTN","GMTSXPD3",132,0)
 N GMTSU,GMTSQ S GMTSQ=+X,GMTSU=" occurrence",GMTSU=$S(+GMTSQ>1:(GMTSU_"s"),1:GMTSU) S X=+GMTSQ_GMTSU
"RTN","GMTSXPD3",133,0)
 Q X
"RTN","GMTSXPD3",134,0)
 ;                      
"RTN","GMTSXPD3",135,0)
 ; Other
"RTN","GMTSXPD3",136,0)
ENV(X) ;   Environment check
"RTN","GMTSXPD3",137,0)
 D HOME^%ZIS I '$D(^VA(200,+($G(DUZ)),0)) D BM("    User (DUZ) not defined"),M("") Q 0
"RTN","GMTSXPD3",138,0)
 I '$L($P($G(^VA(200,+($G(DUZ)),0)),"^",1)) D BM("    Invalid User defined (DUZ)"),M("") Q 0
"RTN","GMTSXPD3",139,0)
 Q 1
"RTN","GMTSXPD3",140,0)
BM(X) ;   Blank Line with Message
"RTN","GMTSXPD3",141,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSXPD3",142,0)
M(X) ;   Message
"RTN","GMTSXPD3",143,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSXPD3",144,0)
UP(X) ;   Uppercase
"RTN","GMTSXPD3",145,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXPD4")
0^22^B41481026
"RTN","GMTSXPD4",1,0)
GMTSXPD4 ; SLC/KER - Health Summary Dist (Re-Build)      ; 04/11/2000
"RTN","GMTSXPD4",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSXPD4",3,0)
 ;
"RTN","GMTSXPD4",4,0)
 Q
"RTN","GMTSXPD4",5,0)
 ;                      
"RTN","GMTSXPD4",6,0)
 ; Re-Build Ad Hoc Health Summary Type
"RTN","GMTSXPD4",7,0)
 ;                      
"RTN","GMTSXPD4",8,0)
 ;   Input Variables   INCLUDE
"RTN","GMTSXPD4",9,0)
 ;                        0    exclude DISABLED components
"RTN","GMTSXPD4",10,0)
 ;                        1    include DISABLED components
"RTN","GMTSXPD4",11,0)
 ;                      
"RTN","GMTSXPD4",12,0)
IN ;   Re-Build w/INCLUDE
"RTN","GMTSXPD4",13,0)
 N INCLUDE S INCLUDE=1 D RB Q
"RTN","GMTSXPD4",14,0)
EX ;   Re-Build w/EXCLUDE
"RTN","GMTSXPD4",15,0)
 N INCLUDE S INCLUDE=0 D RB Q
"RTN","GMTSXPD4",16,0)
RB ;   Re-Build (main)
"RTN","GMTSXPD4",17,0)
 N GMTSENV S GMTSENV=$$ENV Q:'GMTSENV
"RTN","GMTSXPD4",18,0)
 N DA,DIC,DIE,DIK,DLAYGO,DR,GMTSC,GMTSDA,GMTSDIAB,GMTSE,GMTSEG,GMTSEL
"RTN","GMTSXPD4",19,0)
 N GMTSELC,GMTSELT,GMTSEQ,GMTSI,GMTSICD,GMTSIFN,GMTSISEQ,GMTSITEM
"RTN","GMTSXPD4",20,0)
 N GMTSJ,GMTSL,GMTSLOC,GMTSNAR,GMTSCPT,GMTSNEW,GMTSNM,GMTSOCC,GMTSOK
"RTN","GMTSXPD4",21,0)
 N GMTSORD,GMTSQ,GMTST1,GMTST2,GMTST3,GMTSTIM,GMTSTYP,X,Y
"RTN","GMTSXPD4",22,0)
 S GMTSOK=0,GMTSE=59,GMTSC=0 D BM(" Ad Hoc Summary") S GMTST1="   Gathering Ad Hoc Summary information",GMTST2="   Purging old Ad Hoc Summary",GMTST3="   Rebuilding Ad Hoc Summary"
"RTN","GMTSXPD4",23,0)
 D M($G(GMTST1)) N GMTSNEW,GMTSTYP,DLAYGO S DLAYGO=142
"RTN","GMTSXPD4",24,0)
 S DIC=142,DIC(0)="LXF",X="GMTS HS ADHOC OPTION" S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSXPD4",25,0)
 I +Y'>0 D BM("** GMTS AD HOC OPTION Summary Type is missing **") Q
"RTN","GMTSXPD4",26,0)
 D GA,RN D:+($G(GMTSOK))>0 BM(" Ad Hoc Health Summary successfully rebuilt")
"RTN","GMTSXPD4",27,0)
 D:+($G(GMTSOK))'>0 BM(" Failed to successfully rebuild the Ad Hoc Health Summary")
"RTN","GMTSXPD4",28,0)
 Q
"RTN","GMTSXPD4",29,0)
GA ;     Gather Information
"RTN","GMTSXPD4",30,0)
 N GMTSL,GMTSQ,GMTSC,GMTSE
"RTN","GMTSXPD4",31,0)
 S GMTSE=59,GMTSC=0,GMTSL=$L($G(GMTST1))
"RTN","GMTSXPD4",32,0)
 S (GMTSIFN,GMTSTYP)=+Y,GMTSNEW=+$P(Y,"^",3)
"RTN","GMTSXPD4",33,0)
 S:'$D(^GMT(142,GMTSIFN,1,0)) ^(0)="^142.01IA^0^0"
"RTN","GMTSXPD4",34,0)
 S GMTSC=0,GMTSNM="" F GMTSC=1:1 S GMTSNM=$O(^GMT(142.1,"B",GMTSNM)) Q:GMTSNM']""  S GMTSC=+($G(GMTSC))+1
"RTN","GMTSXPD4",35,0)
 S GMTSC=GMTSC-1,GMTSQ=GMTSC\(GMTSE-$L(GMTST1))
"RTN","GMTSXPD4",36,0)
 S GMTSC=0,GMTSNM="" F GMTSC=1:1 S GMTSNM=$O(^GMT(142.1,"B",GMTSNM)) Q:GMTSNM']""  D
"RTN","GMTSXPD4",37,0)
 . S GMTSJ=$O(^(GMTSNM,0)) Q:GMTSJ'>0  D LA
"RTN","GMTSXPD4",38,0)
 . Q:$D(GMTSQT)  Q:+GMTSQ'>0
"RTN","GMTSXPD4",39,0)
 . S GMTSC=GMTSC+1 S:GMTSC#GMTSQ=0 GMTSL=GMTSL+1 Q:GMTSL>GMTSE
"RTN","GMTSXPD4",40,0)
 . W:GMTSC#GMTSQ=0 "."
"RTN","GMTSXPD4",41,0)
 I '$D(GMTSQT),GMTSL'>GMTSE F  S GMTSL=GMTSL+1 Q:GMTSL>GMTSE  W "."
"RTN","GMTSXPD4",42,0)
 W:'$D(GMTSQT) ?GMTSE," < done >"
"RTN","GMTSXPD4",43,0)
 S GMTSI=0 I 'GMTSNEW D PA
"RTN","GMTSXPD4",44,0)
 Q
"RTN","GMTSXPD4",45,0)
PA ;     Purge Ad Hoc Health Summary
"RTN","GMTSXPD4",46,0)
 N GMTSI,GMTSL,GMTSQ,GMTSC,GMTSE S GMTSE=59,GMTSL=$L($G(GMTST2)) D M($G(GMTST2))
"RTN","GMTSXPD4",47,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,GMTSIFN,1,GMTSI)) Q:GMTSI'>0  S GMTSC=+($G(GMTSC))+1
"RTN","GMTSXPD4",48,0)
 S GMTSC=GMTSC-1,GMTSQ=GMTSC\(GMTSE-$L(GMTST1))
"RTN","GMTSXPD4",49,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,GMTSIFN,1,GMTSI)) Q:GMTSI'>0  D
"RTN","GMTSXPD4",50,0)
 . N DA,DIK S U="^",DA(1)=GMTSIFN,DA=GMTSI,DIK="^GMT(142,"_GMTSIFN_",1," D ^DIK
"RTN","GMTSXPD4",51,0)
 . Q:$D(GMTSQT)  Q:+GMTSQ'>0
"RTN","GMTSXPD4",52,0)
 . S GMTSC=GMTSC+1 S:GMTSC#GMTSQ=0 GMTSL=GMTSL+1 Q:GMTSL>GMTSE
"RTN","GMTSXPD4",53,0)
 . W:GMTSC#GMTSQ=0 "."
"RTN","GMTSXPD4",54,0)
 I '$D(GMTSQT),GMTSL'>GMTSE F  S GMTSL=GMTSL+1 Q:GMTSL>GMTSE  W "."
"RTN","GMTSXPD4",55,0)
 W:'$D(GMTSQT) ?GMTSE," < done >"
"RTN","GMTSXPD4",56,0)
 Q
"RTN","GMTSXPD4",57,0)
RN ;     Renumber - Resets ^GMT(142,GMTSIFN,1,
"RTN","GMTSXPD4",58,0)
 N DA,DR,DIE,GMTSEQ,GMTSL
"RTN","GMTSXPD4",59,0)
 N GMTSL,GMTSQ,GMTSC,GMTSE S GMTSE=59,GMTSL=$L($G(GMTST3)) D M($G(GMTST3))
"RTN","GMTSXPD4",60,0)
 S (GMTSEQ,GMTSC)=0 F  S GMTSEQ=$O(GMTSEG(GMTSEQ)) Q:GMTSEQ'>0  S GMTSC=+($G(GMTSC))+1
"RTN","GMTSXPD4",61,0)
 S GMTSC=GMTSC-1,GMTSQ=GMTSC\(GMTSE-$L(GMTST3))
"RTN","GMTSXPD4",62,0)
 S (GMTSEQ,GMTSC)=0 F  S GMTSEQ=$O(GMTSEG(GMTSEQ)) Q:GMTSEQ'>0  D
"RTN","GMTSXPD4",63,0)
 . K DA S DIE="^GMT(142,"_GMTSIFN_",1,",DA(1)=GMTSIFN D AC
"RTN","GMTSXPD4",64,0)
 . Q:$D(GMTSQT)  Q:+GMTSQ'>0
"RTN","GMTSXPD4",65,0)
 . S GMTSC=GMTSC+1 S:GMTSC#GMTSQ=0 GMTSL=GMTSL+1 Q:GMTSL>GMTSE
"RTN","GMTSXPD4",66,0)
 . W:GMTSC#GMTSQ=0 "."
"RTN","GMTSXPD4",67,0)
 I '$D(GMTSQT),GMTSL'>GMTSE F  S GMTSL=GMTSL+1 Q:GMTSL>GMTSE  W "."
"RTN","GMTSXPD4",68,0)
 W:'$D(GMTSQT) ?GMTSE," < done >" S GMTSOK=1
"RTN","GMTSXPD4",69,0)
 Q
"RTN","GMTSXPD4",70,0)
LA ;     Load Array GMTSEG(#)
"RTN","GMTSXPD4",71,0)
 N GMTSOCC,GMTSTIM,GMTSORD,GMTSLOC,GMTSICD,GMTSNAR,GMTSCPT
"RTN","GMTSXPD4",72,0)
 Q:'$D(^GMT(142.1,GMTSJ,0))
"RTN","GMTSXPD4",73,0)
 S GMTSORD=$O(^GMT(142,"AE",GMTSJ,GMTSTYP,0))
"RTN","GMTSXPD4",74,0)
 I GMTSORD>0 D
"RTN","GMTSXPD4",75,0)
 . S GMTSOCC=$S($P(^GMT(142.1,GMTSJ,0),"^",5)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",3),1:"")
"RTN","GMTSXPD4",76,0)
 . S GMTSTIM=$S($P(^GMT(142.1,GMTSJ,0),"^",3)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",4),1:"")
"RTN","GMTSXPD4",77,0)
 . S GMTSLOC=$S($P(^GMT(142.1,GMTSJ,0),"^",10)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",6),1:"")
"RTN","GMTSXPD4",78,0)
 . S GMTSICD=$S($P(^GMT(142.1,GMTSJ,0),"^",11)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",7),1:"")
"RTN","GMTSXPD4",79,0)
 . S GMTSNAR=$S($P(^GMT(142.1,GMTSJ,0),"^",12)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",8),1:"")
"RTN","GMTSXPD4",80,0)
 . S GMTSCPT=$S($P(^GMT(142.1,GMTSJ,0),"^",14)="Y":$P($G(^GMT(142,GMTSTYP,1,GMTSORD,0)),"^",9),1:"")
"RTN","GMTSXPD4",81,0)
 E  D
"RTN","GMTSXPD4",82,0)
 . S GMTSOCC=$S($P(^GMT(142.1,GMTSJ,0),"^",5)="Y":10,1:"")
"RTN","GMTSXPD4",83,0)
 . S GMTSTIM=$S($P(^GMT(142.1,GMTSJ,0),"^",3)="Y":"1Y",1:"")
"RTN","GMTSXPD4",84,0)
 . S GMTSLOC=$S($P(^GMT(142.1,GMTSJ,0),"^",10)="Y":"Y",1:"")
"RTN","GMTSXPD4",85,0)
 . S GMTSICD=$S($P(^GMT(142.1,GMTSJ,0),"^",11)="Y":"L",1:"")
"RTN","GMTSXPD4",86,0)
 . S GMTSNAR=$S($P(^GMT(142.1,GMTSJ,0),"^",12)="Y":"Y",1:"")
"RTN","GMTSXPD4",87,0)
 . S GMTSCPT=$S($P(^GMT(142.1,GMTSJ,0),"^",12)="Y":"Y",1:"")
"RTN","GMTSXPD4",88,0)
 ; Defaults for CPT Modifiers
"RTN","GMTSXPD4",89,0)
 S:$P(^GMT(142.1,GMTSJ,0),"^",14)="Y"&(GMTSCPT="") GMTSCPT="Y"
"RTN","GMTSXPD4",90,0)
 S:$$GET1^DID(142.1,14,,"LABEL")="" GMTSCPT=""
"RTN","GMTSXPD4",91,0)
 D SG
"RTN","GMTSXPD4",92,0)
 Q
"RTN","GMTSXPD4",93,0)
SG ;       Set GMTSEG(#)        Component
"RTN","GMTSXPD4",94,0)
 ;         Disabled
"RTN","GMTSXPD4",95,0)
 N GMTSDIAB S GMTSDIAB=$S($P(^GMT(142.1,GMTSJ,0),"^",6)="P":1,$P(^(0),"^",6)="T":1,1:0) I (INCLUDE=0),(GMTSDIAB=1) Q
"RTN","GMTSXPD4",96,0)
 ;         Include
"RTN","GMTSXPD4",97,0)
 S GMTSEG(GMTSC)=(5*GMTSC)_"^"_GMTSJ_"^"_GMTSOCC_"^"_GMTSTIM_"^^"_GMTSLOC_"^"_GMTSICD_"^"_GMTSNAR_"^"_GMTSCPT I GMTSORD>0 D SL
"RTN","GMTSXPD4",98,0)
 Q
"RTN","GMTSXPD4",99,0)
SL ;       Set GMTSEG(#,#)      Selection item
"RTN","GMTSXPD4",100,0)
 N GMTSELT,GMTSITEM
"RTN","GMTSXPD4",101,0)
 S GMTSELT=0 F  S GMTSELT=$O(^GMT(142,GMTSTYP,1,+GMTSORD,1,GMTSELT)) Q:GMTSELT'>0  D
"RTN","GMTSXPD4",102,0)
 . S GMTSITEM=^(GMTSELT,0) S GMTSEG(GMTSC,GMTSELT)=GMTSITEM
"RTN","GMTSXPD4",103,0)
 Q
"RTN","GMTSXPD4",104,0)
AC ;     Add Components to Ad Hoc Summary
"RTN","GMTSXPD4",105,0)
 N GMTSISEQ,DA,DIE,DR,GMTSELC,GMTSDA,GMTSEL
"RTN","GMTSXPD4",106,0)
 S (GMTSISEQ,DA)=GMTSEQ*5,DIE="^GMT(142,"_GMTSIFN_",1,",DA(1)=GMTSIFN
"RTN","GMTSXPD4",107,0)
 S DR=".01///"_DA
"RTN","GMTSXPD4",108,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",2)) DR=DR_";1///"_$P(GMTSEG(GMTSEQ),"^",2)
"RTN","GMTSXPD4",109,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",3)) DR=DR_";2///"_$P(GMTSEG(GMTSEQ),"^",3)
"RTN","GMTSXPD4",110,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",4)) DR=DR_";3///"_$P(GMTSEG(GMTSEQ),"^",4)
"RTN","GMTSXPD4",111,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",5)) DR=DR_";5///"_$P(GMTSEG(GMTSEQ),"^",5)
"RTN","GMTSXPD4",112,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",6)) DR=DR_";6///"_$P(GMTSEG(GMTSEQ),"^",6)
"RTN","GMTSXPD4",113,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",7)) DR=DR_";7///"_$P(GMTSEG(GMTSEQ),"^",7)
"RTN","GMTSXPD4",114,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",8)) DR=DR_";8///"_$P(GMTSEG(GMTSEQ),"^",8)
"RTN","GMTSXPD4",115,0)
 S:$L($P(GMTSEG(GMTSEQ),"^",9))&($L($$GET1^DID(142.1,14,,"LABEL"))) DR=DR_";9///"_$P(GMTSEG(GMTSEQ),"^",9)
"RTN","GMTSXPD4",116,0)
 D ^DIE S (GMTSELC,GMTSEL)=0 F  S GMTSEL=$O(GMTSEG(GMTSEQ,GMTSEL)) Q:'GMTSEL  D AS
"RTN","GMTSXPD4",117,0)
 I GMTSELC>0 S:'$D(^GMT(142,GMTSIFN,1,GMTSISEQ,1,0)) ^(0)="^142.14V^"_GMTSDA_"^"_GMTSELC
"RTN","GMTSXPD4",118,0)
 Q
"RTN","GMTSXPD4",119,0)
AS ;     Add Selection Items to Ad Hoc Summary
"RTN","GMTSXPD4",120,0)
 N DIE,DA,DR
"RTN","GMTSXPD4",121,0)
 S:'$D(^GMT(142,GMTSIFN,1,GMTSISEQ,1,0)) ^(0)="^142.14V^^"
"RTN","GMTSXPD4",122,0)
 S DIE="^GMT(142,"_GMTSIFN_",1,"_GMTSISEQ_",1,"
"RTN","GMTSXPD4",123,0)
 S DA(2)=GMTSIFN,DA(1)=GMTSISEQ,DA=GMTSEL
"RTN","GMTSXPD4",124,0)
 S DR=".01////"_"^S X=GMTSEG(GMTSEQ,GMTSEL)" D ^DIE
"RTN","GMTSXPD4",125,0)
 S GMTSDA=DA,GMTSELC=GMTSELC+1
"RTN","GMTSXPD4",126,0)
 Q
"RTN","GMTSXPD4",127,0)
 ;                      
"RTN","GMTSXPD4",128,0)
 ; Misc
"RTN","GMTSXPD4",129,0)
ENV(X) ;   Environment check
"RTN","GMTSXPD4",130,0)
 D HOME^%ZIS I '$D(^VA(200,+($G(DUZ)),0)) D BM("    User (DUZ) not defined"),M(" ") Q 0
"RTN","GMTSXPD4",131,0)
 I '$L($P($G(^VA(200,+($G(DUZ)),0)),"^",1)) D BM("    Invalid User defined (DUZ)"),M(" ") Q 0
"RTN","GMTSXPD4",132,0)
 Q 1
"RTN","GMTSXPD4",133,0)
BM(X) ;   Blank Line with Message
"RTN","GMTSXPD4",134,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSXPD4",135,0)
M(X) ;   Message
"RTN","GMTSXPD4",136,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSXPD4",137,0)
UP(X) ;   Uppercase
"RTN","GMTSXPD4",138,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXPD5")
0^35^B4759365
"RTN","GMTSXPD5",1,0)
GMTSXPD5 ; SLC/KER - Health Summary Dist (PDX)           ; 04/11/2000
"RTN","GMTSXPD5",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSXPD5",3,0)
 ;
"RTN","GMTSXPD5",4,0)
 Q
"RTN","GMTSXPD5",5,0)
PDX(GMTSCOMP,GMTSTIM,GMTSOCC) ; Install PDX Data Segment
"RTN","GMTSXPD5",6,0)
 ;                    
"RTN","GMTSXPD5",7,0)
 ;  PDX( )
"RTN","GMTSXPD5",8,0)
 ;          GMTSCOMP   Component Name (.01 of 142.1)
"RTN","GMTSXPD5",9,0)
 ;          GMTSTIM    Time Limits Applicable
"RTN","GMTSXPD5",10,0)
 ;          GMTSOCC    Occurrence Limits Applicable
"RTN","GMTSXPD5",11,0)
 ;               
"RTN","GMTSXPD5",12,0)
 N GMTSENV S GMTSENV=$$ENV Q:'GMTSENV  N GMTSNAME,GMTSERR,GMTS Q:'$L(GMTSCOMP)
"RTN","GMTSXPD5",13,0)
 S (GMTS,GMTSERR)="",GMTSTIM=$G(GMTSTIM),GMTSOCC=$G(GMTSOCC),GMTSNAME=$$FIRSTUP^VAQUTL50(GMTSCOMP)
"RTN","GMTSXPD5",14,0)
 D INSP S GMTS=+$O(^GMT(142.1,"B",GMTSCOMP,0)) I ('GMTS) D NOPDX Q
"RTN","GMTSXPD5",15,0)
 S GMTSERR=$$ADDSEG^VAQUTL50(GMTS,GMTSTIM,GMTSOCC)
"RTN","GMTSXPD5",16,0)
 I (GMTSERR<0) D PDXER Q
"RTN","GMTSXPD5",17,0)
 D PDXOK Q
"RTN","GMTSXPD5",18,0)
 ;                    
"RTN","GMTSXPD5",19,0)
 ; PDX Messages
"RTN","GMTSXPD5",20,0)
INSP ;   Installing PDX Segment
"RTN","GMTSXPD5",21,0)
 N GMTST
"RTN","GMTSXPD5",22,0)
 S GMTST=" Adding """_$$UP(GMTSNAME)_""" component to the PDX package" D BM(GMTST) Q
"RTN","GMTSXPD5",23,0)
NOPDX ;   No PDX Segment Installed
"RTN","GMTSXPD5",24,0)
 N GMTST
"RTN","GMTSXPD5",25,0)
 S GMTST="   Component not found in Health Summary" D M(GMTST)
"RTN","GMTSXPD5",26,0)
 S GMTST="   and not added to PDX package" D M(GMTST),M("") Q
"RTN","GMTSXPD5",27,0)
PDXER ;   Error filing PDX Segment
"RTN","GMTSXPD5",28,0)
 N GMTST
"RTN","GMTSXPD5",29,0)
 S GMTST=$P($G(GMTSERR),"^",2) Q:'$L(GMTST)
"RTN","GMTSXPD5",30,0)
 S GMTST="   "_GMTST D M(GMTST),M("") Q
"RTN","GMTSXPD5",31,0)
PDXOK ;   PDX Segment filled ok
"RTN","GMTSXPD5",32,0)
 N GMTST
"RTN","GMTSXPD5",33,0)
 S GMTST="   Component successfully added" D M(GMTST),M("") Q
"RTN","GMTSXPD5",34,0)
 ;                    
"RTN","GMTSXPD5",35,0)
 ; Misc
"RTN","GMTSXPD5",36,0)
ENV(X) ;   Environment check
"RTN","GMTSXPD5",37,0)
 D HOME^%ZIS I '$D(^VA(200,+($G(DUZ)),0)) D BM("    User (DUZ) not defined"),M(" ") Q 0
"RTN","GMTSXPD5",38,0)
 I '$L($P($G(^VA(200,+($G(DUZ)),0)),"^",1)) D BM("    Invalid User defined (DUZ)"),M(" ") Q 0
"RTN","GMTSXPD5",39,0)
 Q 1
"RTN","GMTSXPD5",40,0)
BM(X) ;   Blank Line with Message
"RTN","GMTSXPD5",41,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSXPD5",42,0)
M(X) ;   Message
"RTN","GMTSXPD5",43,0)
 Q:$D(GMTSQT)  D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSXPD5",44,0)
UP(X) ;   Uppercase
"RTN","GMTSXPD5",45,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXPS1")
0^24^B61714357
"RTN","GMTSXPS1",1,0)
GMTSXPS1 ; SLC/KER - Health Summary Status                      ; 04/11/2000
"RTN","GMTSXPS1",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSXPS1",3,0)
 ;
"RTN","GMTSXPS1",4,0)
EN ; Display status only
"RTN","GMTSXPS1",5,0)
 N POP,GMTSENV S GMTSENV=$$ENV Q:'GMTSENV
"RTN","GMTSXPS1",6,0)
 K ^TMP($J,"GMTSINFO"),GMTSMAIL N X,Y,ZTSAVE D HDR,FI,INS^GMTSXPS2,OUTPUT Q
"RTN","GMTSXPS1",7,0)
SEND ; Send status to G.GMTS@ISC-SLC.VA.GOV
"RTN","GMTSXPS1",8,0)
 N POP,GMTSENV S GMTSENV=$$ENV2 Q:'GMTSENV
"RTN","GMTSXPS1",9,0)
 S GMTSENV=$$ROK("XMD") Q:'GMTSENV
"RTN","GMTSXPS1",10,0)
 K ^TMP($J,"GMTSINFO") N X,Y,ZTSAVE,ZTQUEUED,ZTREQ,ZTRTN S:$L($G(GMTSBLD)) ZTSAVE("GMTSBLD")="" S:$D(GMTSINST) ZTSAVE("GMTSINST")=""
"RTN","GMTSXPS1",11,0)
 S ZTRTN="SENDTO^GMTSXPS1",ZTDESC="Health Symmary Status Report Msg",ZTIO="",ZTDTH=$H D ^%ZTLOAD,HOME^%ZIS K Y,ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN Q
"RTN","GMTSXPS1",12,0)
SENDTO ;   Send (Tasked)
"RTN","GMTSXPS1",13,0)
 N GMTSMAIL S GMTSMAIL="" S:$D(ZTQUEUED) ZTREQ="@"
"RTN","GMTSXPS1",14,0)
 N X,Y D HDR,FI,INS^GMTSXPS2,OUTPUT Q
"RTN","GMTSXPS1",15,0)
 ;                           
"RTN","GMTSXPS1",16,0)
HDR ; Report Header
"RTN","GMTSXPS1",17,0)
 N X D TITLE,ASOF D:$D(GMTSINST) MTBY D INAC,BLD D BL
"RTN","GMTSXPS1",18,0)
 Q
"RTN","GMTSXPS1",19,0)
TITLE ;   As of date
"RTN","GMTSXPS1",20,0)
 N X S X=$S($D(GMTSINST)&('$L($G(GMTSBLD))):"Health Summary Installation",$D(GMTSINST)&($L($G(GMTSBLD))):($G(GMTSBLD)_" Installation"),1:"Health Summary Status") D TT(X),BL Q
"RTN","GMTSXPS1",21,0)
ASOF ;   As of date
"RTN","GMTSXPS1",22,0)
 N X S X=$$NOW S:$L(X) X=$$TB($S($D(GMTSINST):"  Installed on:",1:"  As of:"))_X D:$L(X) TL(X) Q
"RTN","GMTSXPS1",23,0)
INAC ;   In Account
"RTN","GMTSXPS1",24,0)
 N X S X=$$UCI($$U) S:$L(X) X=$$TB("  Install Account:")_X D:$L(X) TL(X) Q
"RTN","GMTSXPS1",25,0)
MTBY ;   Maintained by
"RTN","GMTSXPS1",26,0)
 N X,Y S X=$$P,Y=$P(X,"^",2),X=$P(X,"^",1) S:$L(X) X=$$TB($S($D(GMTSINST):"  Installed by:",1:"  Maintained by:"))_X S:$L(X)&($L(Y)) X=X_"    "_Y D:$L(X) TL(X) Q
"RTN","GMTSXPS1",27,0)
BLD ;   Install Build
"RTN","GMTSXPS1",28,0)
 Q:$D(GMTSINST)&($L($G(GMTSBLD)))  N X S X=$G(GMTSBLD) Q:'$L(X)  S:$L(X) X=$$TB("  Build:")_X D:$L(X) TL(X) Q
"RTN","GMTSXPS1",29,0)
 ;                          
"RTN","GMTSXPS1",30,0)
FI ; Health Summary Files
"RTN","GMTSXPS1",31,0)
 N X S X="",X=X_$J("",37-$L(X))_" Total",X=X_$J("",48-$L(X))_"Last" D TL(X)
"RTN","GMTSXPS1",32,0)
 S X="  File",X=X_$J("",37-$L(X))_"Entries",X=X_$J("",48-$L(X))_"Entry" D TL(X)
"RTN","GMTSXPS1",33,0)
 S X="",$P(X,"-",51)="-",X="  "_X D TL(X)
"RTN","GMTSXPS1",34,0)
 D F142,F1421,F14299,BL
"RTN","GMTSXPS1",35,0)
 Q
"RTN","GMTSXPS1",36,0)
F142 ;   Health Summary Type file 142
"RTN","GMTSXPS1",37,0)
 N X,GMTSA,GMTSAT,GMTSAP,GMTSL,GMTST,GMTSI S X="  Health Summary Type",(GMTSL,GMTST,GMTSI)=0
"RTN","GMTSXPS1",38,0)
 F  S GMTSI=$O(^GMT(142,GMTSI)) Q:+GMTSI=0  S GMTSL=GMTSI,GMTST=GMTST+1
"RTN","GMTSXPS1",39,0)
 S X=X_$J("",32-$L(X))_$J(GMTST,10),X=X_$J("",42-$L(X))_$J(GMTSL,10) D TL(X)
"RTN","GMTSXPS1",40,0)
 S GMTSA=$O(^GMT(142,"B","GMTS HS ADHOC OPTION",0))
"RTN","GMTSXPS1",41,0)
 S X="    Ad Hoc Health Summary Type",(GMTSL,GMTST,GMTSI)=0
"RTN","GMTSXPS1",42,0)
 I GMTSA=0 S X=X_$J("",37-$L(X))_"Missing Ad Hoc Health Summary Type" D TL(X) Q
"RTN","GMTSXPS1",43,0)
 F  S GMTSI=$O(^GMT(142,GMTSA,1,GMTSI)) Q:+GMTSI=0  S GMTSL=GMTSI,GMTST=GMTST+1
"RTN","GMTSXPS1",44,0)
 S X=X_$J("",32-$L(X))_$J(GMTST,10),X=X_$J("",42-$L(X))_$J(GMTSL,10) S:GMTSA'=12 X=X_$J("",57-$L(X))_"Invalid IEN" D TL(X)
"RTN","GMTSXPS1",45,0)
 Q
"RTN","GMTSXPS1",46,0)
F1421 ;   Health Summary Component file 142.1
"RTN","GMTSXPS1",47,0)
 N X,GMTSA,GMTSAC,GMTSAT,GMTSAP,GMTSL,GMTST,GMTSE,GMTSI
"RTN","GMTSXPS1",48,0)
 S X="  Health Summary Component",(GMTSAT,GMTSAP,GMTSAC,GMTSL,GMTST,GMTSI,GMTSE)=0
"RTN","GMTSXPS1",49,0)
 F  S GMTSI=$O(^GMT(142.1,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXPS1",50,0)
 . S GMTSL=GMTSI,GMTST=GMTST+1 S:GMTSI<501 GMTSE=GMTSE+1
"RTN","GMTSXPS1",51,0)
 . S GMTSA=$P($G(^GMT(142.1,GMTSI,0)),"^",6) S:GMTSA="T" GMTSAT=+($G(GMTSAT))+1 S:GMTSA="P" GMTSAP=+($G(GMTSAP))+1 S:GMTSA="" GMTSAC=+($G(GMTSAC))+1
"RTN","GMTSXPS1",52,0)
 S X=X_$J("",32-$L(X))_$J(GMTST,10),X=X_$J("",42-$L(X))_$J(GMTSL,10) D TL(X)
"RTN","GMTSXPS1",53,0)
 I +($G(GMTSE))>0 S X="    Exported",X=X_$J("",32-$L(X))_$J(GMTSE,10) D TL(X)
"RTN","GMTSXPS1",54,0)
 I +($G(GMTSAT))>0 S X="    Temporarily Disabled",X=X_$J("",32-$L(X))_$J(GMTSAT,10) D TL(X)
"RTN","GMTSXPS1",55,0)
 I +($G(GMTSAP))>0 S X="    Permanently Disabled",X=X_$J("",32-$L(X))_$J(GMTSAP,10) D TL(X)
"RTN","GMTSXPS1",56,0)
 I +($G(GMTSAC))>0&(+($G(GMTSAC))'=+($G(GMTST))) S X="    Active Components",X=X_$J("",32-$L(X))_$J(GMTSAC,10) D TL(X)
"RTN","GMTSXPS1",57,0)
 D STA^GMTSXPS3
"RTN","GMTSXPS1",58,0)
 Q
"RTN","GMTSXPS1",59,0)
F14299 ;   Health Summary Parameter file 142.9
"RTN","GMTSXPS1",60,0)
 N X,GMTSA,GMTSL,GMTST,GMTSI S X="  Health Summary Parameters",(GMTSL,GMTST,GMTSI)=0
"RTN","GMTSXPS1",61,0)
 F  S GMTSI=$O(^GMT(142.99,GMTSI)) Q:+GMTSI=0  S GMTSL=GMTSI,GMTST=GMTST+1
"RTN","GMTSXPS1",62,0)
 S X=X_$J("",32-$L(X))_$J(GMTST,10),X=X_$J("",42-$L(X))_$J(GMTSL,10) D TL(X)
"RTN","GMTSXPS1",63,0)
 Q
"RTN","GMTSXPS1",64,0)
 ;                            
"RTN","GMTSXPS1",65,0)
 ; Retrieve Data
"RTN","GMTSXPS1",66,0)
U(X) ;   UCI where Health Summary is installed
"RTN","GMTSXPS1",67,0)
 N GMTSU,GMTSP,GMTST S GMTST=$G(X) X ^%ZOSF("UCI") S GMTSU=Y
"RTN","GMTSXPS1",68,0)
 S:Y=^%ZOSF("PROD") GMTSP=" (Production)" S:Y'=^%ZOSF("PROD") GMTSP=" (Test)" S:GMTSU["DEM" GMTSP=" (Demo)"
"RTN","GMTSXPS1",69,0)
 S X="",$P(X,"^",1)=GMTSU,$P(X,"^",2)=GMTSP Q X
"RTN","GMTSXPS1",70,0)
UCI(X) ;   UCI Format
"RTN","GMTSXPS1",71,0)
 S X=$G(X) N GMTSA,GMTST S GMTSA=$P(X,"^",1),GMTST=$P(X,"^",2) S:$L(GMTST) GMTST=$$MX($$TRIM($$PA(GMTST)))
"RTN","GMTSXPS1",72,0)
 S:$L($P(GMTSA,",",1))=3&($L($P(GMTSA,",",2))=3) GMTSA="["_GMTSA_"]" S:$L(GMTSA)&($L(GMTST)) GMTST="("_GMTST_")"
"RTN","GMTSXPS1",73,0)
 S X="" S:$L(GMTSA) X=GMTSA S:$L(X)&($L(GMTST)) X=X_"  "_GMTST S:'$L(X)&($L(GMTST)) X=GMTST
"RTN","GMTSXPS1",74,0)
 Q X
"RTN","GMTSXPS1",75,0)
P(X) ;   Person
"RTN","GMTSXPS1",76,0)
 S X=+($G(DUZ)) Q:'$L($P($G(^VA(200,+($G(X)),0)),"^",1)) "UNKNOWN^"
"RTN","GMTSXPS1",77,0)
 N GMTSDUZ,GMTSPH S GMTSDUZ=+($G(DUZ))
"RTN","GMTSXPS1",78,0)
 S GMTSPH=$P($G(^VA(200,GMTSDUZ,.13)),"^",2) S:GMTSPH="" GMTSPH=$P($G(^VA(200,GMTSDUZ,.13)),"^",1) S:GMTSPH="" GMTSPH=$P($G(^VA(200,GMTSDUZ,.13)),"^",3) S:GMTSPH="" GMTSPH=$P($G(^VA(200,GMTSDUZ,.13)),"^",4)
"RTN","GMTSXPS1",79,0)
 S GMTSDUZ=$P(^VA(200,GMTSDUZ,0),"^",1),X=GMTSDUZ_"^"_GMTSPH Q X
"RTN","GMTSXPS1",80,0)
INST(X) ;   Institution
"RTN","GMTSXPS1",81,0)
 S X=$G(^XMB("NETNAME")) I $L(X) S:X[".VA.GOV" X=$P(X,".VA.GOV",1) S:X["." X=$P(X,".",$L(X,".")) Q X
"RTN","GMTSXPS1",82,0)
 S X=$P($G(^XMB(1,1,"XUS")),"^",17) I +X>0 S X=$$GET1^DIQ(4,+X,.01,"E") Q:$L(X) X
"RTN","GMTSXPS1",83,0)
 S X="" Q X
"RTN","GMTSXPS1",84,0)
 ;                     
"RTN","GMTSXPS1",85,0)
OUTPUT ; Show global array (display or mail)
"RTN","GMTSXPS1",86,0)
 D:$D(GMTSMAIL) MAIL,CLR D:'$D(GMTSMAIL) DSP,CLR Q
"RTN","GMTSXPS1",87,0)
DISPLAY ;   Display global array
"RTN","GMTSXPS1",88,0)
 N GMTSI S GMTSI=0 F  S GMTSI=$O(^TMP($J,"GMTSINFO",GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXPS1",89,0)
 . W !,^TMP($J,"GMTSINFO",GMTSI)
"RTN","GMTSXPS1",90,0)
 Q
"RTN","GMTSXPS1",91,0)
MAIL ;   Mail global array in message
"RTN","GMTSXPS1",92,0)
 N DIFROM S U="^",XMSUB="Health Summary Info"
"RTN","GMTSXPS1",93,0)
 S:$D(GMTSINST)&($L($G(GMTSBLD))) XMSUB="Health Summary "_GMTSBLD_" Install"
"RTN","GMTSXPS1",94,0)
 S XMY("G.GMTS@ISC-SLC.VA.GOV")=""
"RTN","GMTSXPS1",95,0)
 S XMTEXT="^TMP($J,""GMTSINFO"",",XMDUZ=.5 D ^XMD
"RTN","GMTSXPS1",96,0)
 K ^TMP($J,"GMTSINFO"),%Z,XCNP,XMSCR,XMDUZ,XMY("G.GMTS@ISC-SLC.VA.GOV"),XMZ,XMSUB,XMY,XMTEXT,XMDUZ Q
"RTN","GMTSXPS1",97,0)
 Q
"RTN","GMTSXPS1",98,0)
 ;                            
"RTN","GMTSXPS1",99,0)
 ; Temporary Global
"RTN","GMTSXPS1",100,0)
BL ;   Blank Line
"RTN","GMTSXPS1",101,0)
 N GMTSNX S GMTSNX=+($$NX),^TMP($J,"GMTSINFO",GMTSNX)="" Q
"RTN","GMTSXPS1",102,0)
TT(X) ;   Title Line
"RTN","GMTSXPS1",103,0)
 Q:'$L($G(X))  D TL(X) N GMTSBK S GMTSBK="===============================================================================",GMTSBK=$E(GMTSBK,1,$L($G(X))) D:$L(GMTSBK) TL(GMTSBK) Q
"RTN","GMTSXPS1",104,0)
TL(X) ;   Text Line
"RTN","GMTSXPS1",105,0)
 N GMTSNX S GMTSNX=+($$NX),^TMP($J,"GMTSINFO",GMTSNX)=$G(X) Q
"RTN","GMTSXPS1",106,0)
BK1 ;   Break Line
"RTN","GMTSXPS1",107,0)
 N GMTSNX S GMTSNX=+($$NX),^TMP($J,"GMTSINFO",GMTSNX)="-------------------------------------------------------------------------------" Q
"RTN","GMTSXPS1",108,0)
NX(X) ;   Next Line #
"RTN","GMTSXPS1",109,0)
 S (X,^TMP($J,"GMTSINFO",0))=+($G(^TMP($J,"GMTSINFO",0)))+1 Q X
"RTN","GMTSXPS1",110,0)
ST ;   Show ^TMP($J,"GMTSINFO")
"RTN","GMTSXPS1",111,0)
 N GMTSNN,GMTSNC S GMTSNN="^TMP("_$J_",""GMTSINFO"")",GMTSNC="^TMP("_$J_",""GMTSINFO"","
"RTN","GMTSXPS1",112,0)
 F  S GMTSNN=$Q(@GMTSNN) Q:GMTSNN=""!(GMTSNN'[GMTSNC)  W:GMTSNN'[",0)" !,@GMTSNN
"RTN","GMTSXPS1",113,0)
 Q
"RTN","GMTSXPS1",114,0)
 ;                            
"RTN","GMTSXPS1",115,0)
DSP ; Display ^TMP($J,"GMTSINFO")
"RTN","GMTSXPS1",116,0)
 D DEV Q
"RTN","GMTSXPS1",117,0)
DEV ;   Select a device
"RTN","GMTSXPS1",118,0)
 N %,%ZIS,IOP,ZTRTN,ZTSAVE,ZTDESC,ZTDTH,ZTIO,ZTSK
"RTN","GMTSXPS1",119,0)
 S ZTRTN="DSPI^GMTSXPS1",ZTDESC="printing Health Summary install information"
"RTN","GMTSXPS1",120,0)
 S ZTIO=ION,ZTDTH=$H,%ZIS="PQ",ZTSAVE("^TMP($J,""GMTSINFO"",")=""
"RTN","GMTSXPS1",121,0)
 D ^%ZIS Q:POP  S ZTIO=ION I $D(IO("Q")) D QUE,^%ZISC Q
"RTN","GMTSXPS1",122,0)
 D NOQUE Q
"RTN","GMTSXPS1",123,0)
NOQUE ;   Do not que task
"RTN","GMTSXPS1",124,0)
 W @IOF W:IOST["P-" !,"< Not queued, printing Health Summary Info >",! H 2 U:IOST["P-" IO D @ZTRTN,^%ZISC Q
"RTN","GMTSXPS1",125,0)
QUE ;   Task queued to print user defaults
"RTN","GMTSXPS1",126,0)
 K IO("Q") D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued",1:"Request Cancelled"),! H 2 Q
"RTN","GMTSXPS1",127,0)
 Q
"RTN","GMTSXPS1",128,0)
DSPI ;   Display installation information
"RTN","GMTSXPS1",129,0)
 I '$D(ZTQUEUED),$G(IOST)'["P-" I '$D(^TMP($J,"GMTSINFO")) W !,"Health Summary Installation not found"
"RTN","GMTSXPS1",130,0)
 I IOST["P-" U IO
"RTN","GMTSXPS1",131,0)
 G:'$D(^TMP($J,"GMTSINFO")) DSPQ
"RTN","GMTSXPS1",132,0)
 N GMTSCONT,GMTSI,GMTSLC,GMTSEOP S GMTSCONT="",(GMTSLC,GMTSI)=0,GMTSEOP=+($G(IOSL)) S:GMTSEOP=0 GMTSEOP=24
"RTN","GMTSXPS1",133,0)
 F  S GMTSI=$O(^TMP($J,"GMTSINFO",GMTSI)) Q:+GMTSI=0!(GMTSCONT["^")  D
"RTN","GMTSXPS1",134,0)
 . W !,^TMP($J,"GMTSINFO",GMTSI) D LF Q:GMTSCONT["^"
"RTN","GMTSXPS1",135,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","GMTSXPS1",136,0)
 W:$G(IOST)["P-" @IOF
"RTN","GMTSXPS1",137,0)
DSPQ ;   Quit Display
"RTN","GMTSXPS1",138,0)
 Q
"RTN","GMTSXPS1",139,0)
LF ;   Line Feed
"RTN","GMTSXPS1",140,0)
 S GMTSLC=GMTSLC+1 D:IOST["P-"&(GMTSLC>(GMTSEOP-7)) CONT D:IOST'["P-"&(GMTSLC>(GMTSEOP-4)) CONT
"RTN","GMTSXPS1",141,0)
 Q
"RTN","GMTSXPS1",142,0)
CONT ;   Page/Form Feed
"RTN","GMTSXPS1",143,0)
 S GMTSLC=0 W:IOST["P-" @IOF Q:IOST["P-"  W !!,"Press <Return> to continue  " R GMTSCONT:300 S:'$T GMTSCONT="^" S:GMTSCONT'["^" GMTSCONT=""
"RTN","GMTSXPS1",144,0)
 Q
"RTN","GMTSXPS1",145,0)
 ;                       
"RTN","GMTSXPS1",146,0)
 ; Miscellaneous
"RTN","GMTSXPS1",147,0)
TB(X) ;   Tab
"RTN","GMTSXPS1",148,0)
 S X=X F  Q:$L(X)>19  S X=X_" "
"RTN","GMTSXPS1",149,0)
 Q X
"RTN","GMTSXPS1",150,0)
PA(X) ;   Remove Parenthesis
"RTN","GMTSXPS1",151,0)
 Q $TR(X,"()","")
"RTN","GMTSXPS1",152,0)
LO(X) ;   Lowercase
"RTN","GMTSXPS1",153,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","GMTSXPS1",154,0)
UP(X) ;   Uppercase
"RTN","GMTSXPS1",155,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXPS1",156,0)
MX(X) ;   Mixed Case
"RTN","GMTSXPS1",157,0)
 Q $TR($E(X,1),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$TR($E(X,2,$L(X)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","GMTSXPS1",158,0)
TRIM(X) ;   Trim Space Characters
"RTN","GMTSXPS1",159,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSXPS1",160,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSXPS1",161,0)
 Q X
"RTN","GMTSXPS1",162,0)
CLR ;   Clean up
"RTN","GMTSXPS1",163,0)
 K ^TMP($J,"GMTSINFO") Q
"RTN","GMTSXPS1",164,0)
NOW(X) ;   Today's Date
"RTN","GMTSXPS1",165,0)
 S X=$$EDT($$NOW^XLFDT) Q X
"RTN","GMTSXPS1",166,0)
EDT(X) ;   External Date Foramt
"RTN","GMTSXPS1",167,0)
 S X=+($G(X)) Q:X=0 "" S X=$$FMTE^XLFDT(+X,"5Z") S:X["@" X=$P(X,"@",1)_"  "_$P(X,"@",2) Q X
"RTN","GMTSXPS1",168,0)
ROK(X) ;   Routine OK (in UCI) (NDBI)
"RTN","GMTSXPS1",169,0)
 S X=$G(X) Q:'$L(X) 0 Q:$L(X)>8 0 X ^%ZOSF("TEST") Q:$T 1 Q 0
"RTN","GMTSXPS1",170,0)
ENV(X) ;   Environment check
"RTN","GMTSXPS1",171,0)
 D HOME^%ZIS I '$D(^VA(200,+($G(DUZ)),0)) W !!,"    User (DUZ) not defined",! Q 0
"RTN","GMTSXPS1",172,0)
 Q 1
"RTN","GMTSXPS1",173,0)
ENV2(X) ;   Environment check
"RTN","GMTSXPS1",174,0)
 D HOME^%ZIS I '$D(^VA(200,+($G(DUZ)),0)) Q 0
"RTN","GMTSXPS1",175,0)
 Q 1
"RTN","GMTSXPS2")
0^25^B14582720
"RTN","GMTSXPS2",1,0)
GMTSXPS2 ; SLC/KER - Health Summary Status                      ; 04/11/2000
"RTN","GMTSXPS2",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSXPS2",3,0)
 ;
"RTN","GMTSXPS2",4,0)
 Q
"RTN","GMTSXPS2",5,0)
INS ; Get Installations
"RTN","GMTSXPS2",6,0)
 N GMTS0,GMTSDT,GMTSEQ,GMTSI,GMTSIN,GMTSN,GMTSNM,GMTSP,GMTSPAT,GMTSPD
"RTN","GMTSXPS2",7,0)
 N GMTSPDE,GMTSPI,GMTSST,GMTSTDT,GMTSTN,GMTSTNM,GMTSV,GMTSVD,GMTSVDE
"RTN","GMTSXPS2",8,0)
 N GMTSVDS,GMTSVI,GMTSNX,X S GMTSI=$$PKGI Q:+GMTSI=0
"RTN","GMTSXPS2",9,0)
 S GMTSV=2.7 S GMTSVI=$$VERI(GMTSI,GMTSV) Q:GMTSVI=0
"RTN","GMTSXPS2",10,0)
 S GMTSVDS=$G(^DIC(9.4,GMTSI,22,GMTSVI,0)),GMTSVDE=$P(GMTSVDS,"^",3),GMTSVDS=$P(GMTSVDS,"^",2) S GMTSVD="" S:+GMTSVDE>0 GMTSVD=+GMTSVDE
"RTN","GMTSXPS2",11,0)
 S:+GMTSVD=0&(+GMTSVDS>0) GMTSVD=+GMTSVDS S:+GMTSVD>0&(+GMTSVDE>+GMTSVD) GMTSVD=+GMTSVDE Q:+GMTSVD=0
"RTN","GMTSXPS2",12,0)
 S GMTSVDE=$$EDT^GMTSXPS1($P(GMTSVD,".",1)) K GMTSVDS S GMTSIN(1,1)="Health Summary "_GMTSV_"^"_GMTSVDE
"RTN","GMTSXPS2",13,0)
 S GMTSPI=0 F  S GMTSPI=$O(^DIC(9.4,GMTSI,22,GMTSVI,"PAH",GMTSPI)) Q:+GMTSPI=0  D
"RTN","GMTSXPS2",14,0)
 . S GMTS0=$G(^DIC(9.4,GMTSI,22,GMTSVI,"PAH",GMTSPI,0)),GMTSP=$P(GMTS0,"^",1),GMTSEQ="Test" S:GMTSP["SEQ #" GMTSEQ=+($P(GMTSP,"SEQ #",2)) S:+($G(GMTSEQ))=0 GMTSEQ="Test"
"RTN","GMTSXPS2",15,0)
 . S GMTSPAT=+GMTSP Q:GMTSPAT=0  S GMTSPD=+($P(GMTS0,"^",2)) Q:GMTSPD=0  S GMTSPDE=$$EDT^GMTSXPS1(GMTSPD) Q:'$L(GMTSPDE)
"RTN","GMTSXPS2",16,0)
 . S GMTSIN(2,GMTSPAT,GMTSEQ)="GMTS*"_GMTSV_"*"_GMTSP_"^"_GMTSPDE
"RTN","GMTSXPS2",17,0)
 . S:$L(GMTSEQ)&(+GMTSEQ>0) GMTSIN(2,"SEQ",GMTSEQ,GMTSPAT)="GMTS*"_GMTSV_"*"_GMTSP_"^"_GMTSPDE
"RTN","GMTSXPS2",18,0)
 . S:$L(GMTSEQ)&(GMTSEQ["Test") GMTSIN(2,"SEQT",GMTSEQ,GMTSPAT)="GMTS*"_GMTSV_"*"_GMTSP_"^"_GMTSPDE
"RTN","GMTSXPS2",19,0)
 ;   Package
"RTN","GMTSXPS2",20,0)
 S GMTSN=GMTSIN(1,1),GMTSNM=$P(GMTSN,"^",1),GMTSDT=$P(GMTSN,"^",2),GMTSST="" D HD,SI
"RTN","GMTSXPS2",21,0)
 ;   Patches Installed in Sequence
"RTN","GMTSXPS2",22,0)
 S GMTSEQ=0 F  S GMTSEQ=$O(GMTSIN(2,"SEQ",GMTSEQ)) Q:+GMTSEQ=0  D
"RTN","GMTSXPS2",23,0)
 . S GMTSP=0 F  S GMTSP=$O(GMTSIN(2,"SEQ",GMTSEQ,GMTSP)) Q:+GMTSP=0  D
"RTN","GMTSXPS2",24,0)
 . . S GMTSN=$G(GMTSIN(2,GMTSP,GMTSEQ)) Q:'$L(GMTSN)
"RTN","GMTSXPS2",25,0)
 . . S GMTSNM=$P(GMTSN,"^",1) Q:'$L(GMTSNM)
"RTN","GMTSXPS2",26,0)
 . . S GMTSDT=$P(GMTSN,"^",2) Q:'$L(GMTSDT)
"RTN","GMTSXPS2",27,0)
 . . S GMTSST=""
"RTN","GMTSXPS2",28,0)
 . . I $D(GMTSIN(2,"SEQT","Test",GMTSP)) D
"RTN","GMTSXPS2",29,0)
 . . . N GMTSTN,GMTSTNM,GMTSTDT S GMTSTN=$G(GMTSIN(2,GMTSP,"Test")) I '$L(GMTSTN) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",30,0)
 . . . S GMTSTNM=$P(GMTSTN,"^",1) I '$L(GMTSTNM) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",31,0)
 . . . S GMTSTDT=$P(GMTSTN,"^",2) I '$L(GMTSTDT) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",32,0)
 . . . N GMTSNM,GMTSDT,GMTSST S GMTSNM=GMTSTNM,GMTSDT=GMTSTDT,GMTSST="Test"
"RTN","GMTSXPS2",33,0)
 . . . D SI K GMTSIN(2,"SEQT","Test",GMTSP)
"RTN","GMTSXPS2",34,0)
 . . D SI
"RTN","GMTSXPS2",35,0)
 ;   Other Patches Installed (test patches)
"RTN","GMTSXPS2",36,0)
 I $D(GMTSIN(2,"SEQT")) D
"RTN","GMTSXPS2",37,0)
 . N GMTSP,GMTSTN,GMTSTNM,GMTSTDT
"RTN","GMTSXPS2",38,0)
 . S GMTSP=0 F  S GMTSP=$O(GMTSIN(2,"SEQT","Test",GMTSP)) Q:+GMTSP=0  D
"RTN","GMTSXPS2",39,0)
 . . S GMTSTN=$G(GMTSIN(2,GMTSP,"Test")) I '$L(GMTSTN) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",40,0)
 . . S GMTSTNM=$P(GMTSTN,"^",1) I '$L(GMTSTNM) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",41,0)
 . . S GMTSTDT=$P(GMTSTN,"^",2) I '$L(GMTSTDT) K GMTSIN(2,"SEQT","Test",GMTSP) Q
"RTN","GMTSXPS2",42,0)
 . . S GMTSNM=GMTSTNM,GMTSDT=GMTSTDT,GMTSST="Test"
"RTN","GMTSXPS2",43,0)
 . . D SI K GMTSIN(2,"SEQT","Test",GMTSP)
"RTN","GMTSXPS2",44,0)
 D BL^GMTSXPS1
"RTN","GMTSXPS2",45,0)
 Q
"RTN","GMTSXPS2",46,0)
PKGI(X) ; Package
"RTN","GMTSXPS2",47,0)
 N D,Y,DIC,DTOUT,DUOUT S DIC(0)="I",D="C"
"RTN","GMTSXPS2",48,0)
 S X="GMTS",DIC="^DIC(9.4,"
"RTN","GMTSXPS2",49,0)
 D IX^DIC S X=0 S:+Y>0 X=+Y Q X
"RTN","GMTSXPS2",50,0)
VERI(X,Y) ; Version
"RTN","GMTSXPS2",51,0)
 N DA,D,DIC,DTOUT,DUOUT S DIC(0)="I",D="B" S DA(1)=+($G(X)) Q:DA(1)=0 0 S X=+($G(Y)) Q:X=0 0 S DIC="^DIC(9.4,"_DA(1)_",22,"
"RTN","GMTSXPS2",52,0)
 D IX^DIC S X=0 S:+Y>0 X=+Y Q X
"RTN","GMTSXPS2",53,0)
 ; Report
"RTN","GMTSXPS2",54,0)
HD ;   Header
"RTN","GMTSXPS2",55,0)
 N X S X="  Install Name",X=X_$J("",28-$L(X))_"Date" D TL^GMTSXPS1(X) S X="" S $P(X,"-",42)="-",X="  "_X D TL^GMTSXPS1(X)
"RTN","GMTSXPS2",56,0)
 Q
"RTN","GMTSXPS2",57,0)
SI ;   Site Installs
"RTN","GMTSXPS2",58,0)
 S GMTSNM=$G(GMTSNM) Q:'$L(GMTSNM)  S GMTSDT=$G(GMTSDT) Q:'$L(GMTSDT)  S GMTSST=$G(GMTSST)
"RTN","GMTSXPS2",59,0)
 N X S X="  "_GMTSNM,X=X_$J("",28-$L(X))_GMTSDT S:$L(GMTSST) X=X_$J("",40-$L(X))_GMTSST D TL^GMTSXPS1(X)
"RTN","GMTSXPS2",60,0)
 Q
"RTN","GMTSXPS3")
0^26^B33354123
"RTN","GMTSXPS3",1,0)
GMTSXPS3 ; SLC/KER - Health Summary Status                      ; 04/11/2000
"RTN","GMTSXPS3",2,0)
 ;;2.7;Health Summary;**35**;Oct 20, 1995
"RTN","GMTSXPS3",3,0)
 ;
"RTN","GMTSXPS3",4,0)
 Q
"RTN","GMTSXPS3",5,0)
STA ; Status of Components
"RTN","GMTSXPS3",6,0)
 D CLR,EXP,CHK,CLR Q
"RTN","GMTSXPS3",7,0)
CHK ;   Check Health Summary Components
"RTN","GMTSXPS3",8,0)
 N GMTSI,GMTSSNM,GMTSSAB,GMTSSDF,GMTSENM,GMTSEAB,GMTSEDF,GMTSCNT,GMTSDUP,X
"RTN","GMTSXPS3",9,0)
 S (GMTSCNT,GMTSI)=0 F  S GMTSI=$O(^GMT(142.1,GMTSI)) Q:+GMTSI=0  D IE
"RTN","GMTSXPS3",10,0)
 S GMTSI=0 F  S GMTSI=$O(^TMP($J,"GMTSST",GMTSI)) Q:+GMTSI=0  D EI
"RTN","GMTSXPS3",11,0)
 Q
"RTN","GMTSXPS3",12,0)
IE ;     Compare Installed to Exported
"RTN","GMTSXPS3",13,0)
 S GMTSSNM=$P($G(^GMT(142.1,GMTSI,0)),"^",1),GMTSSAB=$P($G(^GMT(142.1,GMTSI,0)),"^",4),GMTSSDF=$P($G(^GMT(142.1,GMTSI,0)),"^",6)
"RTN","GMTSXPS3",14,0)
 S GMTSENM=$P($G(^TMP($J,"GMTSST",GMTSI)),"^",1),GMTSEAB=$P($G(^TMP($J,"GMTSST",GMTSI)),"^",2),GMTSEDF=$P($G(^TMP($J,"GMTSST",GMTSI)),"^",3)
"RTN","GMTSXPS3",15,0)
 I GMTSI<501,$L(GMTSSNM),GMTSENM="",'$D(^GMT(142.1,"B",GMTSSNM)) S X="      "_GMTSSNM_" not exported" D CL(X) Q
"RTN","GMTSXPS3",16,0)
 I GMTSI<501,$L(GMTSSNM),GMTSENM="",$D(^GMT(142.1,"B",GMTSSNM)) S GMTSDUP=0 D DP Q:+GMTSDUP>1
"RTN","GMTSXPS3",17,0)
 I GMTSI<501,$L(GMTSSNM),GMTSENM="",$D(^GMT(142.1,"B",GMTSSNM)) S X="      "_GMTSSNM_" w/wrong IEN ("_GMTSI_")" D CL(X) Q
"RTN","GMTSXPS3",18,0)
 I GMTSI<501,GMTSSNM'=GMTSENM S X="      "_"Not exported as "_GMTSSNM D CL(X) Q
"RTN","GMTSXPS3",19,0)
 I GMTSI<501,GMTSSDF="P",GMTSEDF'="P" S X="      "_GMTSSNM_" disabled at site" D CL(X) Q
"RTN","GMTSXPS3",20,0)
 I GMTSI<501,GMTSSDF="",GMTSEDF="P" S X="      Disable component "_GMTSSNM_" in use" D CL(X) Q
"RTN","GMTSXPS3",21,0)
 I GMTSI>500,GMTSENM="" S X="      "_GMTSSNM_" (local component)" D CL(X) Q
"RTN","GMTSXPS3",22,0)
 Q
"RTN","GMTSXPS3",23,0)
EI ;     Compare Exported to Installed
"RTN","GMTSXPS3",24,0)
 S GMTSSNM=$P($G(^GMT(142.1,GMTSI,0)),"^",1),GMTSSAB=$P($G(^GMT(142.1,GMTSI,0)),"^",4),GMTSSDF=$P($G(^GMT(142.1,GMTSI,0)),"^",6)
"RTN","GMTSXPS3",25,0)
 S GMTSENM=$P($G(^TMP($J,"GMTSST",GMTSI)),"^",1),GMTSEAB=$P($G(^TMP($J,"GMTSST",GMTSI)),"^",2),GMTSEDF=$P($G(^TMP($J,"GMTSST",GMTSI)),"^",3)
"RTN","GMTSXPS3",26,0)
 I GMTSI<501,GMTSSNM="" S X="      "_GMTSENM_" exported/not found" D CL(X) Q
"RTN","GMTSXPS3",27,0)
 I GMTSI<501,GMTSSNM'=GMTSENM S X="      "_GMTSSNM_" exported/modified" D CL(X) Q
"RTN","GMTSXPS3",28,0)
 Q
"RTN","GMTSXPS3",29,0)
DP ;     Duplicate Components
"RTN","GMTSXPS3",30,0)
 N X,GMTSI,GMTSIS Q:'$L($G(GMTSSNM))
"RTN","GMTSXPS3",31,0)
 S GMTSIS="",GMTSI=0 F  S GMTSI=$O(^GMT(142.1,"B",GMTSSNM,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXPS3",32,0)
 . S GMTSDUP=+($G(GMTSDUP))+1,GMTSIS=GMTSIS_"/"_GMTSI
"RTN","GMTSXPS3",33,0)
 S:$E(GMTSIS,1)="/" GMTSIS=$E(GMTSIS,2,$L(GMTSIS)) S:GMTSIS'["/" GMTSDUP=1
"RTN","GMTSXPS3",34,0)
 I +($G(GMTSDUP))>1 S X="      "_GMTSSNM_" duplicated ("_GMTSIS_")" D CL(X)
"RTN","GMTSXPS3",35,0)
 Q
"RTN","GMTSXPS3",36,0)
 ;                            
"RTN","GMTSXPS3",37,0)
 ; Miscellaneous
"RTN","GMTSXPS3",38,0)
EXP ;   Retrieve Exported Components
"RTN","GMTSXPS3",39,0)
 N GMTSEX,GMTSTXT,GMTSI,GMTSCI,GMTSNM,GMTSAB,GMTSDF S GMTSTXT="" F GMTSI=1:1 D  Q:'$L(GMTSTXT)
"RTN","GMTSXPS3",40,0)
 . S GMTSTXT="" S GMTSEX="S GMTSTXT=$T(COMP+"_GMTSI_")" X GMTSEX S GMTSTXT=$P(GMTSTXT,";",3,299) Q:GMTSTXT=""  S GMTSCI=+($P(GMTSTXT,";",1)) Q:GMTSCI=0  S GMTSNM=$P(GMTSTXT,";",2) Q:GMTSNM=""
"RTN","GMTSXPS3",41,0)
 . S GMTSAB=$P(GMTSTXT,";",3) Q:GMTSAB=""  S GMTSDF=$P(GMTSTXT,";",4),^TMP($J,"GMTSST",GMTSCI)=GMTSNM_"^"_GMTSAB_"^"_GMTSDF
"RTN","GMTSXPS3",42,0)
 Q
"RTN","GMTSXPS3",43,0)
CLR ;   Clean up
"RTN","GMTSXPS3",44,0)
 K ^TMP($J,"GMTSST") Q
"RTN","GMTSXPS3",45,0)
CL(X) ;   Component Status Line
"RTN","GMTSXPS3",46,0)
 S X=$G(X) S:$L(X) GMTSCNT=+($G(GMTSCNT))+1 D:GMTSCNT=1 TL^GMTSXPS1("    Component Status:")
"RTN","GMTSXPS3",47,0)
 D TL^GMTSXPS1(X) Q
"RTN","GMTSXPS3",48,0)
COMP ;   Components List (exported)
"RTN","GMTSXPS3",49,0)
 ;;1;ADVERSE REACTIONS/ALLERGIES;ADR
"RTN","GMTSXPS3",50,0)
 ;;2;MAS DEMOGRAPHICS BRIEF;BDEM
"RTN","GMTSXPS3",51,0)
 ;;3;LAB CHEMISTRY & HEMATOLOGY;CH
"RTN","GMTSXPS3",52,0)
 ;;4;CLINICAL WARNINGS;CW
"RTN","GMTSXPS3",53,0)
 ;;5;CRISIS NOTES;CN
"RTN","GMTSXPS3",54,0)
 ;;6;MAS DEMOGRAPHICS;DEM
"RTN","GMTSXPS3",55,0)
 ;;7;DIETETICS;DI
"RTN","GMTSXPS3",56,0)
 ;;8;MAS DISCHARGES;DC
"RTN","GMTSXPS3",57,0)
 ;;9;MAS CLINIC VISITS FUTURE;CVF
"RTN","GMTSXPS3",58,0)
 ;;10;MAS ADMISSIONS/DISCHARGES;ADC
"RTN","GMTSXPS3",59,0)
 ;;11;MAS DISCHARGE DIAGNOSIS;DD
"RTN","GMTSXPS3",60,0)
 ;;12;MAS SURGERIES ICD CODES;OPC
"RTN","GMTSXPS3",61,0)
 ;;14;MAS CLINIC VISITS PAST;CVP
"RTN","GMTSXPS3",62,0)
 ;;15;PROGRESS NOTES;PN
"RTN","GMTSXPS3",63,0)
 ;;16;MAS TRANSFERS;TR
"RTN","GMTSXPS3",64,0)
 ;;17;MAS TREATING SPECIALTY;TS
"RTN","GMTSXPS3",65,0)
 ;;18;LAB CUMULATIVE SELECTED 1;SCL1
"RTN","GMTSXPS3",66,0)
 ;;19;LAB CUMULATIVE SELECTED 2;SCL2
"RTN","GMTSXPS3",67,0)
 ;;20;LAB CUMULATIVE SELECTED 3;SCL3
"RTN","GMTSXPS3",68,0)
 ;;21;LAB CUMULATIVE SELECTED 4;SCL4
"RTN","GMTSXPS3",69,0)
 ;;23;SURGERY REPORTS;SR
"RTN","GMTSXPS3",70,0)
 ;;24;MAS DISABILITIES;DS
"RTN","GMTSXPS3",71,0)
 ;;25;ADVANCE DIRECTIVE;CD
"RTN","GMTSXPS3",72,0)
 ;;26;PROGRESS NOTES BRIEF;BPN
"RTN","GMTSXPS3",73,0)
 ;;27;SURGERY REPORTS BRIEF;BSR
"RTN","GMTSXPS3",74,0)
 ;;28;PHARMACY OUTPATIENT;RXOP
"RTN","GMTSXPS3",75,0)
 ;;29;PHARMACY UNIT DOSE;RXUD
"RTN","GMTSXPS3",76,0)
 ;;30;PHARMACY INTRAVENOUS;RXIV
"RTN","GMTSXPS3",77,0)
 ;;31;LAB ORDERS BRIEF;BLO
"RTN","GMTSXPS3",78,0)
 ;;32;LAB ORDERS;LO
"RTN","GMTSXPS3",79,0)
 ;;33;LAB TESTS SELECTED;SLT
"RTN","GMTSXPS3",80,0)
 ;;34;RADIOLOGY STATUS;RS
"RTN","GMTSXPS3",81,0)
 ;;35;RADIOLOGY PROFILE;RP
"RTN","GMTSXPS3",82,0)
 ;;36;LAB BLOOD TRANSFUSIONS;BT
"RTN","GMTSXPS3",83,0)
 ;;37;LAB MICROBIOLOGY BRIEF;BMIC
"RTN","GMTSXPS3",84,0)
 ;;38;LAB MICROBIOLOGY;MIC
"RTN","GMTSXPS3",85,0)
 ;;43;LAB CUMULATIVE SELECTED;SCLU
"RTN","GMTSXPS3",86,0)
 ;;45;LAB BLOOD AVAILABILITY;BA
"RTN","GMTSXPS3",87,0)
 ;;46;LAB SURGICAL PATHOLOGY;SP
"RTN","GMTSXPS3",88,0)
 ;;47;VITAL SIGNS;VS
"RTN","GMTSXPS3",89,0)
 ;;48;LAB CYTOPATHOLOGY;CY
"RTN","GMTSXPS3",90,0)
 ;;49;VITAL SIGNS SELECTED;SVS
"RTN","GMTSXPS3",91,0)
 ;;50;MAS PROCEDURES ICD CODES;PRC
"RTN","GMTSXPS3",92,0)
 ;;51;MEDICINE SUMMARY;MEDS
"RTN","GMTSXPS3",93,0)
 ;;52;RADIOLOGY IMPRESSION;RI
"RTN","GMTSXPS3",94,0)
 ;;54;ORDERS CURRENT;ORC
"RTN","GMTSXPS3",95,0)
 ;;55;MAS ADT HISTORY;ADT
"RTN","GMTSXPS3",96,0)
 ;;56;RADIOLOGY IMPRESSION SELECTED;SRI
"RTN","GMTSXPS3",97,0)
 ;;57;DISCHARGE SUMMARY;DCS
"RTN","GMTSXPS3",98,0)
 ;;58;DISCHARGE SUMMARY BRIEF;BDS
"RTN","GMTSXPS3",99,0)
 ;;59;PROBLEM LIST ACTIVE;PLA
"RTN","GMTSXPS3",100,0)
 ;;60;PROBLEM LIST INACTIVE;PLI
"RTN","GMTSXPS3",101,0)
 ;;61;PROBLEM LIST ALL;PLL
"RTN","GMTSXPS3",102,0)
 ;;62;SOCIAL WORK;SW
"RTN","GMTSXPS3",103,0)
 ;;64;MAS ADT HISTORY EXPANDED;EADT
"RTN","GMTSXPS3",104,0)
 ;;65;COMPENSATION AND PENSION EXAMS;CP
"RTN","GMTSXPS3",105,0)
 ;;66;MEDICINE ABNORMAL BRIEF;MEDA
"RTN","GMTSXPS3",106,0)
 ;;67;MEDICINE BRIEF REPORT;MEDB
"RTN","GMTSXPS3",107,0)
 ;;68;MEDICINE FULL CAPTIONED;MEDC
"RTN","GMTSXPS3",108,0)
 ;;69;MEDICINE FULL REPORT;MEDF
"RTN","GMTSXPS3",109,0)
 ;;71;MENTAL HEALTH PHYSICAL EXAM;MHPE
"RTN","GMTSXPS3",110,0)
 ;;72;LAB ELECTRON MICROSCOPY;EM
"RTN","GMTSXPS3",111,0)
 ;;73;ADVERSE REACTIONS/ALLERG BRIEF;BADR
"RTN","GMTSXPS3",112,0)
 ;;74;SPINAL CORD DYSFUNCTION;SCD
"RTN","GMTSXPS3",113,0)
 ;;75;VITAL SIGNS OUTPATIENT;VSO
"RTN","GMTSXPS3",114,0)
 ;;76;VITAL SIGNS SELECTED OUTPAT.;SVSO
"RTN","GMTSXPS3",115,0)
 ;;77;SURGERY ONLY REPORTS;SRO
"RTN","GMTSXPS3",116,0)
 ;;78;SURGERY NON OR PROCEDURES;NSR
"RTN","GMTSXPS3",117,0)
 ;;79;SURGERY SEL NON OR PROCEDURES;SNSR
"RTN","GMTSXPS3",118,0)
 ;;201;PCE LOCATION OF HOME;LH;P
"RTN","GMTSXPS3",119,0)
 ;;202;CLINICAL REMINDERS DUE;CR
"RTN","GMTSXPS3",120,0)
 ;;203;PCE HEALTH FACTORS SELECTED;SHF;P
"RTN","GMTSXPS3",121,0)
 ;;204;PCE HEALTH FACTORS ALL;HF;P
"RTN","GMTSXPS3",122,0)
 ;;205;PCE OUTPATIENT ENCOUNTERS;OE
"RTN","GMTSXPS3",123,0)
 ;;206;PCE MEASUREMENTS NON-TABULAR;NTM;P
"RTN","GMTSXPS3",124,0)
 ;;207;PCE IMMUNIZATIONS;IM;P
"RTN","GMTSXPS3",125,0)
 ;;208;PCE SKIN TESTS;ST;P
"RTN","GMTSXPS3",126,0)
 ;;209;PCE MEASUREMENTS SELECTED;MEAS;P
"RTN","GMTSXPS3",127,0)
 ;;212;PCE EDUCATION;ED
"RTN","GMTSXPS3",128,0)
 ;;213;PCE EDUCATION LATEST;EDL
"RTN","GMTSXPS3",129,0)
 ;;220;PCE OUTPATIENT DIAGNOSIS;OD;P
"RTN","GMTSXPS3",130,0)
 ;;230;PCE EXAMS LATEST;EXAM;P
"RTN","GMTSXPS3",131,0)
 ;;231;PCE TREATMENTS PROVIDED;TP;P
"RTN","GMTSXPS3",132,0)
 ;;232;CLINICAL REMINDERS MAINTENANCE;CM
"RTN","GMTSXPS3",133,0)
 ;;233;PROGRESS NOTES SELECTED;SPN
"RTN","GMTSXPS3",134,0)
 ;;234;CLINICAL REMINDERS SUMMARY;CRS
"RTN","GMTSXPS3",135,0)
 ;;235;MAG IMAGING;MAGI
"RTN","GMTSXPS3",136,0)
 ;;236;ONCOLOGY;ONC
"RTN","GMTSXPS3",137,0)
 ;;237;VITAL SIGNS DETAILED DISPLAY;VSD
"RTN","GMTSXPS3",138,0)
 ;;238;GLOBAL ASSESSMENT FUNCTIONING;GAF
"SEC","^DIC",142,142,0,"AUDIT")
@
"SEC","^DIC",142,142,0,"DD")
@
"SEC","^DIC",142,142,0,"LAYGO")
@
"SEC","^DIC",142.1,142.1,0,"AUDIT")
@
"SEC","^DIC",142.1,142.1,0,"DD")
@
"SEC","^DIC",142.1,142.1,0,"DEL")
@
"SEC","^DIC",142.1,142.1,0,"LAYGO")
@
"SEC","^DIC",142.1,142.1,0,"WR")
@
"VER")
8.0^22.0
"^DD",142,142,0)
FIELD^^.09^10
"^DD",142,142,0,"DDA")
N
"^DD",142,142,0,"DT")
3000329
"^DD",142,142,0,"IX","AB",142,.01)

"^DD",142,142,0,"IX","AE",142.01,1)

"^DD",142,142,0,"IX","AM",142,99)

"^DD",142,142,0,"IX","AW",142,.01)

"^DD",142,142,0,"IX","AW2",142,.02)

"^DD",142,142,0,"IX","AW3",142.2,.01)

"^DD",142,142,0,"IX","AWO",142,.06)

"^DD",142,142,0,"IX","B",142,.01)

"^DD",142,142,0,"IX","C",142,.06)

"^DD",142,142,0,"IX","D",142.2,.01)

"^DD",142,142,0,"IX","E",142,.02)

"^DD",142,142,0,"NM","HEALTH SUMMARY TYPE")

"^DD",142,142,0,"PT",43,43)

"^DD",142,142,0,"PT",71,13)

"^DD",142,142,0,"PT",350.9,2.08)

"^DD",142,142,0,"PT",350.9,2.09)

"^DD",142,142,0,"PT",357.6,.11)

"^DD",142,142,0,"PT",358.6,.11)

"^DD",142,142,0,"VRPK")
GMTS
"^DD",142,142,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",142,142,.01,1,0)
^.1
"^DD",142,142,.01,1,1,0)
142^B
"^DD",142,142,.01,1,1,1)
S ^GMT(142,"B",$E(X,1,30),DA)=""
"^DD",142,142,.01,1,1,2)
K ^GMT(142,"B",$E(X,1,30),DA)
"^DD",142,142,.01,1,1,"%D",0)
^^2^2^2950731^^
"^DD",142,142,.01,1,1,"%D",1,0)
This REGULAR "B" cross-reference is used for Health Summary Type look-up
"^DD",142,142,.01,1,1,"%D",2,0)
by name.
"^DD",142,142,.01,1,2,0)
142^AW^MUMPS
"^DD",142,142,.01,1,2,1)
D STNT^GMTSUIX
"^DD",142,142,.01,1,2,2)
D KTNT^GMTSUIX
"^DD",142,142,.01,1,2,"DT")
2981214
"^DD",142,142,.01,1,3,0)
142^AB^MUMPS
"^DD",142,142,.01,1,3,1)
S ^GMT(142,"AB",$$UP^XLFSTR($E(X,1,30)),DA)=""
"^DD",142,142,.01,1,3,2)
K ^GMT(142,"AB",$$UP^XLFSTR($E(X,1,30)),DA)
"^DD",142,142,.01,1,3,"%D",0)
^^3^3^2990201^
"^DD",142,142,.01,1,3,"%D",1,0)
^GMT(142,"AB",UP,IEN) - Where UP is an uppercase version of the Health 
"^DD",142,142,.01,1,3,"%D",2,0)
Summary Type and IEN is the location where the Health Summary Type is 
"^DD",142,142,.01,1,3,"%D",3,0)
stored.
"^DD",142,142,.01,1,3,"DT")
2990201
"^DD",142,142,.01,3)
Answer must be 3-30 characters in length.
"^DD",142,142,.01,21,0)
^^7^7^2950728^^^^
"^DD",142,142,.01,21,1,0)
Enter the NAME of the Health Summary Type.  This name will appear
"^DD",142,142,.01,21,2,0)
in the health summary header.  The word "CONFIDENTIAL" will appear
"^DD",142,142,.01,21,3,0)
in front of this name and the word "SUMMARY" will appear at the end
"^DD",142,142,.01,21,4,0)
to complete the header.  For example:
"^DD",142,142,.01,21,5,0)
 
"^DD",142,142,.01,21,6,0)
    Name entered: ICU
"^DD",142,142,.01,21,7,0)
Generated header: CONFIDENTIAL ICU SUMMARY
"^DD",142,142,.01,"DEL",1,0)
I $P(^GMT(142,DA,0),U,4)="Y" W $C(7),!,"CANNOT DELETE THIS HEALTH SUMMARY TYPE!!  IT IS USED BY THE AD HOC OPTION"
"^DD",142,142,.01,"DT")
2990201
"^DD",142,142,.02,0)
TITLE^F^^T;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<3) X
"^DD",142,142,.02,1,0)
^.1
"^DD",142,142,.02,1,1,0)
142^E
"^DD",142,142,.02,1,1,1)
S ^GMT(142,"E",$E(X,1,30),DA)=""
"^DD",142,142,.02,1,1,2)
K ^GMT(142,"E",$E(X,1,30),DA)
"^DD",142,142,.02,1,1,"%D",0)
^^2^2^2920227^
"^DD",142,142,.02,1,1,"%D",1,0)
This whole-file, regular FileMan cross-reference is used for look-ups
"^DD",142,142,.02,1,1,"%D",2,0)
of Health Summary Types by TITLE.
"^DD",142,142,.02,1,2,0)
142^AW2^MUMPS
"^DD",142,142,.02,1,2,1)
D STNT^GMTSUIX
"^DD",142,142,.02,1,2,2)
D KTNT^GMTSUIX
"^DD",142,142,.02,1,2,"DT")
2981214
"^DD",142,142,.02,3)
ANSWER MUST BE 3-30 CHARACTERS IN LENGTH
"^DD",142,142,.02,21,0)
5^^7^7^2920928^^^^
"^DD",142,142,.02,21,1,0)
Enter the TITLE only if you wish to replace NAME with title in the health
"^DD",142,142,.02,21,2,0)
summary header.  For Example:
"^DD",142,142,.02,21,3,0)
 
"^DD",142,142,.02,21,4,0)
    Name entered: ICU
"^DD",142,142,.02,21,5,0)
   Title entered: INTENSIVE CARE UNIT
"^DD",142,142,.02,21,6,0)
Generated header: CONFIDENTIAL INTENSIVE CARE UNIT SUMMARY
"^DD",142,142,.02,21,7,0)
 
"^DD",142,142,.02,"DT")
2981214
"^DD",142,142,.05,0)
LOCK^FX^^0;2^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X I $D(X) Q:$D(^DIC(19.1,"B",X))  W !,$C(7),"Lock name must match exactly with a key in the SECURITY KEY file." K X
"^DD",142,142,.05,3)
Enter the name of the security key required to modify this summary type
"^DD",142,142,.05,21,0)
^^9^9^2950731^^^^
"^DD",142,142,.05,21,1,0)
When a Health Summary Type contains a Lock, edit access is normally
"^DD",142,142,.05,21,2,0)
restricted to persons who hold a security key in the SECURITY KEY
"^DD",142,142,.05,21,3,0)
file which is the same as the Lock value. If a Health Summary Type
"^DD",142,142,.05,21,4,0)
contains a Lock, users who hold that security key are NOT restricted
"^DD",142,142,.05,21,5,0)
by Ownership. A holder of the GMTSMGR security key is NOT restricted
"^DD",142,142,.05,21,6,0)
by Locks or Ownership.
"^DD",142,142,.05,21,7,0)
 
"^DD",142,142,.05,21,8,0)
NOTE: Generic Health Summary Types issued with the Health Summary
"^DD",142,142,.05,21,9,0)
package contain the Lock GMTSMGR.
"^DD",142,142,.05,"DT")
2950731
"^DD",142,142,.06,0)
OWNER^P200'^VA(200,^0;3^Q
"^DD",142,142,.06,1,0)
^.1
"^DD",142,142,.06,1,1,0)
142^C
"^DD",142,142,.06,1,1,1)
S ^GMT(142,"C",$E(X,1,30),DA)=""
"^DD",142,142,.06,1,1,2)
K ^GMT(142,"C",$E(X,1,30),DA)
"^DD",142,142,.06,1,1,"%D",0)
^^2^2^2920227^
"^DD",142,142,.06,1,1,"%D",1,0)
This whole-file, regular FileMan cross-reference is used by the Health
"^DD",142,142,.06,1,1,"%D",2,0)
Summary Type selection to look-up summary types by OWNER.
"^DD",142,142,.06,1,2,0)
142^AWO^MUMPS
"^DD",142,142,.06,1,2,1)
D STO^GMTSUIX
"^DD",142,142,.06,1,2,2)
D KTO^GMTSUIX
"^DD",142,142,.06,1,2,"DT")
2990422
"^DD",142,142,.06,21,0)
15^^14^14^2950728^^
"^DD",142,142,.06,21,1,0)
Edit access to each health summary type is normally restricted to
"^DD",142,142,.06,21,2,0)
its Owner.
"^DD",142,142,.06,21,3,0)
 
"^DD",142,142,.06,21,4,0)
Exception 1: Holders of the GMTSMGR security key are NOT restricted
"^DD",142,142,.06,21,5,0)
             by Ownership.
"^DD",142,142,.06,21,6,0)
 
"^DD",142,142,.06,21,7,0)
Exception 2: If a health summary type contains a lock, users who hold
"^DD",142,142,.06,21,8,0)
             that lock key are NOT restricted by Ownership.
"^DD",142,142,.06,21,9,0)
 
"^DD",142,142,.06,21,10,0)
NOTE: When a new health summary type is created, the creator's entry
"^DD",142,142,.06,21,11,0)
number in the new Person File is AUTOMATICALLY entered as Owner unless
"^DD",142,142,.06,21,12,0)
the creator holds the GMTSMGR security key.  A creator who holds the
"^DD",142,142,.06,21,13,0)
GMTSMGR key may enter an Owner (IFN from new Person file) of his/her
"^DD",142,142,.06,21,14,0)
choice.
"^DD",142,142,.06,"DT")
2990422
"^DD",142,142,.07,0)
RESTRICT DELETION^SI^Y:YES;^0;4^Q
"^DD",142,142,.07,21,0)
^^3^3^2920914^
"^DD",142,142,.07,21,1,0)
This field is referred to by the Create/Modify and Delete Health Summary
"^DD",142,142,.07,21,2,0)
Type options for the screening of certain summary types (esp., GMTS HS
"^DD",142,142,.07,21,3,0)
ADHOC OPTION) from deletion.
"^DD",142,142,.07,"DT")
2901227
"^DD",142,142,.08,0)
SUPPRESS COMP WITHOUT DATA^S^Y:yes;N:no;^0;5^Q
"^DD",142,142,.08,.1)
SUPPRESS PRINT OF COMPONENTS WITHOUT DATA
"^DD",142,142,.08,21,0)
^^6^6^2950731^^
"^DD",142,142,.08,21,1,0)
This field allows health summary types to be set up to suppress printing
"^DD",142,142,.08,21,2,0)
of components that contain no data when health summaries are printed from
"^DD",142,142,.08,21,3,0)
a device. When health summary types are displayed on the screen,
"^DD",142,142,.08,21,4,0)
components that contain no data will still be displayed with a "No data
"^DD",142,142,.08,21,5,0)
available" message. This is done to eliminate any confusion that may occur
"^DD",142,142,.08,21,6,0)
when jumping between components.
"^DD",142,142,.08,"DT")
2950815
"^DD",142,142,.09,0)
NATIONALLY EXPORTED TYPE^S^1:Nationally Exported, Site Editable;2:Nationally Exported, Uneditable;^VA;1^Q
"^DD",142,142,.09,21,0)
^^3^3^3000224^^
"^DD",142,142,.09,21,1,0)
This field is used to distinguish between nationally exported Health Summary 
"^DD",142,142,.09,21,2,0)
Types and Health Summary Types created at the site.  It serves to protect 
"^DD",142,142,.09,21,3,0)
nationally exported Health Summary Types from being deleted at the site.
"^DD",142,142,.09,"DT")
3000224
"^DD",142,142,1,0)
STRUCTURE^142.01IA^^1;0
"^DD",142,142,1,21,0)
^^4^4^3000329^^^^
"^DD",142,142,1,21,1,0)
This multiple contains the components to be included in any given health
"^DD",142,142,1,21,2,0)
summary type, along with the time and occurrence limits, selection items
"^DD",142,142,1,21,3,0)
to be used, hospital location displayed, ICD text displayed, and provider
"^DD",142,142,1,21,4,0)
narrative displayed.
"^DD",142,142,20,0)
LOCATION(S) USING THE SUMMARY^142.2P^^20;0
"^DD",142,142,20,21,0)
^^3^3^2950731^^^^
"^DD",142,142,20,21,1,0)
Allows the entry of the hospital location (ward or clinic) which has
"^DD",142,142,20,21,2,0)
requested automatic nightly queueing of one or more health summary
"^DD",142,142,20,21,3,0)
types to a specified device.
"^DD",142,142,99,0)
TIMESTAMP^F^^99;1^K:$L(X)>15!($L(X)<1) X
"^DD",142,142,99,1,0)
^.1
"^DD",142,142,99,1,1,0)
142^AM^MUMPS
"^DD",142,142,99,1,1,1)
D SET^GMTSDD
"^DD",142,142,99,1,1,2)
D KILL^GMTSDD
"^DD",142,142,99,1,1,"%D",0)
^^5^5^2950731^
"^DD",142,142,99,1,1,"%D",1,0)
This MUMPS type cross-reference is used to maintain the navigational menus
"^DD",142,142,99,1,1,"%D",2,0)
when changes occur in the structure of a given Health Summary Type. The
"^DD",142,142,99,1,1,"%D",3,0)
executed code will rebuild navigational menus when the TIMESTAMP field is
"^DD",142,142,99,1,1,"%D",4,0)
modified. The ^XUTL("XQORM", global is used by the Unwinder utility to
"^DD",142,142,99,1,1,"%D",5,0)
generate the ad hoc and navigational menus.
"^DD",142,142,99,3)
Answer must be 1-15 characters in length.
"^DD",142,142,99,9)
^
"^DD",142,142,99,21,0)
^^6^6^2950731^
"^DD",142,142,99,21,1,0)
This is the $H formatted time associated with the most recent modification
"^DD",142,142,99,21,2,0)
to this health summary type. It is compared with the timestamp in the
"^DD",142,142,99,21,3,0)
^XUTL( multiple associated with this summary type, when ^XQORM is called
"^DD",142,142,99,21,4,0)
to generate help menus for interactive navigation. If a difference exists,
"^DD",142,142,99,21,5,0)
then the menus are "recompiled." This field is NOT to be edited
"^DD",142,142,99,21,6,0)
interactively under any circumstances!
"^DD",142,142,99,"DT")
2900111
"^DD",142,142.01,0)
STRUCTURE SUB-FIELD^^9^10
"^DD",142,142.01,0,"DT")
3000329
"^DD",142,142.01,0,"ID",1)
S %I=Y,Y=$S('$D(^(0)):"",$D(^GMT(142.1,+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(142.1,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",142,142.01,0,"IX","AM",142.01,.01)

"^DD",142,142.01,0,"IX","AM1",142.01,1)

"^DD",142,142.01,0,"IX","AM5",142.01,5)

"^DD",142,142.01,0,"IX","B",142.01,.01)

"^DD",142,142.01,0,"IX","C",142.01,1)

"^DD",142,142.01,0,"NM","STRUCTURE")

"^DD",142,142.01,0,"UP")
142
"^DD",142,142.01,.01,0)
SUMMARY ORDER^MRNJ8,3XO^^0;1^K:+X'=X!(X>9999.999)!(X<.001)!(X'?1.4N.E) X S:$D(X) DINUM=X
"^DD",142,142.01,.01,1,0)
^.1
"^DD",142,142.01,.01,1,1,0)
142.01^B
"^DD",142,142.01,.01,1,1,1)
S ^GMT(142,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",142,142.01,.01,1,1,2)
K ^GMT(142,DA(1),1,"B",$E(X,1,30),DA)
"^DD",142,142.01,.01,1,1,"%D",0)
^^3^3^2920302^^
"^DD",142,142.01,.01,1,1,"%D",1,0)
This REGULAR "B" cross-reference is created by FileMan and because the
"^DD",142,142.01,.01,1,1,"%D",2,0)
multiple is DINUM'ed by SUMMARY ORDER, it serves little useful function
"^DD",142,142.01,.01,1,1,"%D",3,0)
in either look-up or sorting.
"^DD",142,142.01,.01,1,2,0)
142.01^AM^MUMPS
"^DD",142,142.01,.01,1,2,1)
D REDOX^GMTSDD
"^DD",142,142.01,.01,1,2,2)
D REDOX^GMTSDD
"^DD",142,142.01,.01,1,2,"%D",0)
^^4^4^2950731^^^^
"^DD",142,142.01,.01,1,2,"%D",1,0)
This MUMPS-type cross-reference is used to rebuild the ad hoc and
"^DD",142,142.01,.01,1,2,"%D",2,0)
navigational menus when the sequence of components within any Health
"^DD",142,142.01,.01,1,2,"%D",3,0)
Summary Type is changed. The ^XUTL("XQORM", global is used by the Unwinder
"^DD",142,142.01,.01,1,2,"%D",4,0)
utility to generate the ad hoc and navigational menus.
"^DD",142,142.01,.01,2)
S Y(0)=Y S Y=Y
"^DD",142,142.01,.01,2.1)
S Y=Y
"^DD",142,142.01,.01,3)
Type a Number between .001 and 9999.999
"^DD",142,142.01,.01,21,0)
^^4^4^2950821^^^^
"^DD",142,142.01,.01,21,1,0)
This is the sequence in which each successive component is to appear
"^DD",142,142.01,.01,21,2,0)
within the health summary.  By default, it will be an integer number,
"^DD",142,142.01,.01,21,3,0)
beginning with five, and incremented by five, so as to allow insertion
"^DD",142,142.01,.01,21,4,0)
of new components as necessary.
"^DD",142,142.01,.01,"DT")
2900418
"^DD",142,142.01,1,0)
COMPONENT NAME^RP142.1'^GMT(142.1,^0;2^Q
"^DD",142,142.01,1,1,0)
^.1
"^DD",142,142.01,1,1,1,0)
142.01^C
"^DD",142,142.01,1,1,1,1)
S ^GMT(142,DA(1),1,"C",$E(X,1,30),DA)=""
"^DD",142,142.01,1,1,1,2)
K ^GMT(142,DA(1),1,"C",$E(X,1,30),DA)
"^DD",142,142.01,1,1,1,"%D",0)
^^4^4^2920714^^^
"^DD",142,142.01,1,1,1,"%D",1,0)
This REGULAR FileMan type cross-reference is used both in look-ups of
"^DD",142,142.01,1,1,1,"%D",2,0)
components and to determine whether the selected component already
"^DD",142,142.01,1,1,1,"%D",3,0)
exists in the current Health Summary Type during the Create/Modify
"^DD",142,142.01,1,1,1,"%D",4,0)
process.
"^DD",142,142.01,1,1,2,0)
142.01^AM1^MUMPS
"^DD",142,142.01,1,1,2,1)
D REDOX^GMTSDD
"^DD",142,142.01,1,1,2,2)
D REDOX^GMTSDD
"^DD",142,142.01,1,1,2,"%D",0)
^^4^4^2950731^
"^DD",142,142.01,1,1,2,"%D",1,0)
This MUMPS type cross-reference is used to recompile the navigational and
"^DD",142,142.01,1,1,2,"%D",2,0)
ad hoc menus when components are added to/deleted from a given Health
"^DD",142,142.01,1,1,2,"%D",3,0)
Summary Type. The ^XUTL("XQORM", global is used by the Unwinder utility to
"^DD",142,142.01,1,1,2,"%D",4,0)
generate the ad hoc and navigational menus.
"^DD",142,142.01,1,1,3,0)
142^AE
"^DD",142,142.01,1,1,3,1)
S ^GMT(142,"AE",$E(X,1,30),DA(1),DA)=""
"^DD",142,142.01,1,1,3,2)
K ^GMT(142,"AE",$E(X,1,30),DA(1),DA)
"^DD",142,142.01,1,1,3,"%D",0)
^^4^4^2920302^^
"^DD",142,142.01,1,1,3,"%D",1,0)
This cross-reference is used by the routine ^GMTSDD to build the navigational
"^DD",142,142.01,1,1,3,"%D",2,0)
menu for each Health Summary Type, and by ^GMTSLOAD when saving the current
"^DD",142,142.01,1,1,3,"%D",3,0)
default parameters, prior to deleting and rebuilding the Ad Hoc Health
"^DD",142,142.01,1,1,3,"%D",4,0)
Summary Type.
"^DD",142,142.01,1,3)
Enter the name of the segment (e.g., DEMOGRAPHICS)
"^DD",142,142.01,1,21,0)
^^3^3^2950829^^^
"^DD",142,142.01,1,21,1,0)
This is the name of the next health summary component to be included in
"^DD",142,142.01,1,21,2,0)
the report (e.g., SURGERY REPORTS, or CHEMISTRY & HEMATOLOGY).  Valid
"^DD",142,142.01,1,21,3,0)
abbreviations (e.g., SR or CH) or partial names may also be entered.
"^DD",142,142.01,1,"DT")
2900329
"^DD",142,142.01,2,0)
OCCURRENCE LIMIT^NJ5,0^^0;3^K:+X'=X!(X>99999)!(X<1)!(X?.E1"."1N.N) X
"^DD",142,142.01,2,3)
Enter occurrence limit of information to display.  Omit if no limit.  Occurrence limit displays are based on most recent information first. 
"^DD",142,142.01,2,21,0)
^^6^6^2940418^^
"^DD",142,142.01,2,21,1,0)
This is an integer number describing the number of occurrences (e.g., lab
"^DD",142,142.01,2,21,2,0)
orders, surgeries, radiology procedures, etc.) to be reported by the
"^DD",142,142.01,2,21,3,0)
component.  For example, if 5 is entered the component will only present
"^DD",142,142.01,2,21,4,0)
the five most recent occurrences.  If no limit is entered, the component
"^DD",142,142.01,2,21,5,0)
will report as many occurrences as may be found within the specified
"^DD",142,142.01,2,21,6,0)
time interval.
"^DD",142,142.01,3,0)
TIME LIMIT^FX^^0;4^S X=$$UP^XLFSTR(X) K:$L(X)>5!($L(X)<1)!'((X?1N.N1U)!(X?1N.N1"D")!(X?1N.N1"W")!(X?1N.N1"M")!(X?1N.N1"Y")) X
"^DD",142,142.01,3,3)
Enter time limit to display (e.g., 20D, 8W, 3M, 5Y).  Omit if no limit. Time limit displays are based on most recent information first.
"^DD",142,142.01,3,21,0)
^^8^8^2940914^
"^DD",142,142.01,3,21,1,0)
This is a code describing how far back the component should search for a
"^DD",142,142.01,3,21,2,0)
given patient's data.  It will be a number, followed by the letter D for
"^DD",142,142.01,3,21,3,0)
days, W for weeks, M for months or Y for years (e.g., 30D would denote the
"^DD",142,142.01,3,21,4,0)
past 30 days' patient data should be included in the component).  If no
"^DD",142,142.01,3,21,5,0)
limit is indicated, the component assumes an indefinite time interval.
"^DD",142,142.01,3,21,6,0)
Exceptions are the Outpatient, Unit Dose and Intravenous Pharmacy
"^DD",142,142.01,3,21,7,0)
components, which will show active orders only when no time limit is
"^DD",142,142.01,3,21,8,0)
entered.
"^DD",142,142.01,3,"DT")
2950823
"^DD",142,142.01,4,0)
SELECTION ITEM^142.14AV^^1;0
"^DD",142,142.01,4,21,0)
^^7^7^2960910^^^^
"^DD",142,142.01,4,21,1,0)
If the component allows selection of specific items, they will be selected
"^DD",142,142.01,4,21,2,0)
here.  Component examples are Lab Tests Selected, Lab Cumulative's
"^DD",142,142.01,4,21,3,0)
Selected, Radiology Impressions Selected, and Vital Signs Selected.
"^DD",142,142.01,4,21,4,0)
 
"^DD",142,142.01,4,21,5,0)
You will be asked to enter selection items such as Lab Tests, Radiology
"^DD",142,142.01,4,21,6,0)
Procedures, Vital Sign Types, Measurement Panel, Clinical
"^DD",142,142.01,4,21,7,0)
Reminder/Maintenance, Health Factor, depending on the component.
"^DD",142,142.01,4,21,8,0)
Factor, depending on the component.
"^DD",142,142.01,4,22)

"^DD",142,142.01,5,0)
HEADER NAME^F^^0;5^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>20!($L(X)<2) X
"^DD",142,142.01,5,1,0)
^.1
"^DD",142,142.01,5,1,1,0)
142.01^AM5^MUMPS
"^DD",142,142.01,5,1,1,1)
D REDOX^GMTSDD
"^DD",142,142.01,5,1,1,2)
D REDOX^GMTSDD
"^DD",142,142.01,5,1,1,"%D",0)
^^3^3^2950731^
"^DD",142,142.01,5,1,1,"%D",1,0)
This MUMPS type cross reference will recompile the AD HOC menu when an
"^DD",142,142.01,5,1,1,"%D",2,0)
entry is modified. The ^XUTL("XQORM", global is used by the Unwinder
"^DD",142,142.01,5,1,1,"%D",3,0)
utility to generate the ad hoc menu.
"^DD",142,142.01,5,1,1,"DT")
2911212
"^DD",142,142.01,5,3)
Answer must be 2-20 characters in length.
"^DD",142,142.01,5,21,0)
^^4^4^2911127^^^^
"^DD",142,142.01,5,21,1,0)
This is the name that will appear in both menus and headers within this
"^DD",142,142.01,5,21,2,0)
Health Summary type.  (e.g., if you are setting up the LAB SELECTED
"^DD",142,142.01,5,21,3,0)
CUMULATIVE component, and would like it to include the tests from a Chem 7,
"^DD",142,142.01,5,21,4,0)
you might enter Chem 7).
"^DD",142,142.01,5,"DT")
2911212
"^DD",142,142.01,6,0)
HOSPITAL LOCATION DISPLAYED^S^Y:yes;N:no;^0;6^Q
"^DD",142,142.01,6,3)
Enter Yes if Hospital Location abbreviation should appear in this component.
"^DD",142,142.01,6,21,0)
^^4^4^2950728^^^
"^DD",142,142.01,6,21,1,0)
This field controls whether or not the hospital location abbreviation will
"^DD",142,142.01,6,21,2,0)
be displayed in any components where hospital location applies (e.g., PCE
"^DD",142,142.01,6,21,3,0)
Outpatient Encounters, PCE Outpatient Diagnosis). The text displayed is
"^DD",142,142.01,6,21,4,0)
obtained from the Hospital Location file.
"^DD",142,142.01,6,"DT")
2940418
"^DD",142,142.01,7,0)
ICD TEXT DISPLAYED^S^L:long text;S:short text;C:code only;T:text only;N:none;^0;7^Q
"^DD",142,142.01,7,3)
Indicate whether the long form, short form, code only, text only, or no form of ICD diagnosis text should appear in applicable components.
"^DD",142,142.01,7,21,0)
^^7^7^2950728^
"^DD",142,142.01,7,21,1,0)
This field controls hows ICD text is displayed in components where ICD
"^DD",142,142.01,7,21,2,0)
Text applies (e.g., PCE Outpatient Encounters, PCE Outpatient Diagnosis
"^DD",142,142.01,7,21,3,0)
and Problem List All). The applicable component display/print can be
"^DD",142,142.01,7,21,4,0)
customized to include ICD Text in the following format: code and long
"^DD",142,142.01,7,21,5,0)
description, code and short description, code only, long description only
"^DD",142,142.01,7,21,6,0)
or nothing. This control is independent of whether provider narrative is
"^DD",142,142.01,7,21,7,0)
displayed -- either or both may be specified.
"^DD",142,142.01,7,"DT")
2950119
"^DD",142,142.01,8,0)
PROVIDER NARRATIVE DISPLAYED^S^Y:yes;N:no;^0;8^Q
"^DD",142,142.01,8,3)
Enter 'N' to eliminate the provider narrative from component display.
"^DD",142,142.01,8,21,0)
^^6^6^3000329^^
"^DD",142,142.01,8,21,1,0)
This field controls whether provider narrative is displayed or not. It
"^DD",142,142.01,8,21,2,0)
applies to components where provider narrative is applicable (e.g., PCE
"^DD",142,142.01,8,21,3,0)
Outpatient Encounters, PCE Outpatient Diagnosis, Problem List All). This
"^DD",142,142.01,8,21,4,0)
control is independent of whether or not ICD text is displayed -- either
"^DD",142,142.01,8,21,5,0)
or both may be specified. If not specified, provider narrative will be
"^DD",142,142.01,8,21,6,0)
displayed by default.
"^DD",142,142.01,8,"DT")
2940419
"^DD",142,142.01,9,0)
CPT MODIFIERS DISPLAYED^S^Y:YES;N:NO;^0;9^Q
"^DD",142,142.01,9,3)
Enter 'N' to eliminate the CPT Modifiers from component display. 
"^DD",142,142.01,9,21,0)
^^4^4^3000329^
"^DD",142,142.01,9,21,1,0)
This field controls whether CPT Modifiers are displayed or not. It applies to 
"^DD",142,142.01,9,21,2,0)
components where CPT Modifiers are applicable (e.g. surgical components) This 
"^DD",142,142.01,9,21,3,0)
control is independent of whether or not CPT text is displayed.  If not 
"^DD",142,142.01,9,21,4,0)
specified, CPT Modifiers will be displayed by default.
"^DD",142,142.01,9,"DT")
3000329
"^DD",142,142.14,0)
SELECTION ITEM SUB-FIELD^^.01^1
"^DD",142,142.14,0,"DT")
2920928
"^DD",142,142.14,0,"IX","B",142.14,.01)

"^DD",142,142.14,0,"NM","SELECTION ITEM")

"^DD",142,142.14,0,"UP")
142.01
"^DD",142,142.14,.01,0)
SELECTION ITEM^MV^^0;1^Q
"^DD",142,142.14,.01,1,0)
^.1
"^DD",142,142.14,.01,1,1,0)
142.14^B
"^DD",142,142.14,.01,1,1,1)
S ^GMT(142,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",142,142.14,.01,1,1,2)
K ^GMT(142,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",142,142.14,.01,1,1,3)
Required Index for Variable Pointer
"^DD",142,142.14,.01,1,1,"%D",0)
^^2^2^2920302^
"^DD",142,142.14,.01,1,1,"%D",1,0)
This REGULAR FileMan type cross-reference is used in look-ups of selection
"^DD",142,142.14,.01,1,1,"%D",2,0)
items during the Create/Modify and parameter collection dialogues.
"^DD",142,142.14,.01,3)
Selection items can only be selected when appropriate for the component.
"^DD",142,142.14,.01,21,0)
^^7^7^2960910^^^^
"^DD",142,142.14,.01,21,1,0)
When a given component allows the selection of specific items, (e.g., lab
"^DD",142,142.14,.01,21,2,0)
tests, radiology procedures, vital measurements, measurement panels,
"^DD",142,142.14,.01,21,3,0)
clinical reminders/maintenance items, health factors, etc.), you may
"^DD",142,142.14,.01,21,4,0)
select the item by simply entering its name (e.g., POTASSIUM, or PULSE, as
"^DD",142,142.14,.01,21,5,0)
appropriate). If a limit has been specified for the number of items to be
"^DD",142,142.14,.01,21,6,0)
selected, then the build health summary option will restrict you to that
"^DD",142,142.14,.01,21,7,0)
number.
"^DD",142,142.14,.01,"DT")
2920928
"^DD",142,142.14,.01,"V",0)
^.12P^8^7
"^DD",142,142.14,.01,"V",1,0)
60^LABORATORY TEST^1^L^y^n
"^DD",142,142.14,.01,"V",1,1)
S DIC("S")="I ($P(^(0),U,4)=""CH""),(""BO""[$P(^(0),U,3))"
"^DD",142,142.14,.01,"V",1,2)
Only Chemistry & Hematology tests may be selected.
"^DD",142,142.14,.01,"V",2,0)
120.51^VITAL TYPE^2^V^n^n
"^DD",142,142.14,.01,"V",3,0)
71^RADIOLOGY TEST^3^R^n^n
"^DD",142,142.14,.01,"V",5,0)
9001017^MEASUREMENT PANEL^4^M^^n
"^DD",142,142.14,.01,"V",6,0)
811.9^CLINICAL REMINDER/MAINTENANCE^5^C^y^n
"^DD",142,142.14,.01,"V",6,1)
S DIC("S")="I +$P(^(0),U,6)'=1"
"^DD",142,142.14,.01,"V",6,2)
Allow selection of items that aren't inactive.
"^DD",142,142.14,.01,"V",7,0)
9999999.64^HEALTH FACTOR^6^F^y^n
"^DD",142,142.14,.01,"V",7,1)
S DIC("S")="I $P(^(0),U,10)=""C"",+$P(^(0),U,11)'=1"
"^DD",142,142.14,.01,"V",7,2)
Forces selection of health factor categories rather than individual health factors and forces selection of health factor categories that aren't inactive.
"^DD",142,142.14,.01,"V",8,0)
8925.1^PROGRESS NOTE TITLE^8^PN^y^n
"^DD",142,142.14,.01,"V",8,1)
S DIC("S")="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"",+$$ISA^TIULX(+Y,3)"
"^DD",142,142.14,.01,"V",8,2)
Only a PROGRESS NOTE TITLE may be selected.
"^DD",142,142.14,.01,"V",9,0)
81^CPT^7^CPT^n^n
"^DD",142,142.2,0)
LOCATION(S) USING THE SUMMARY SUB-FIELD^^.04^4
"^DD",142,142.2,0,"DT")
2920210
"^DD",142,142.2,0,"IX","B",142.2,.01)

"^DD",142,142.2,0,"NM","LOCATION(S) USING THE SUMMARY")

"^DD",142,142.2,0,"UP")
142
"^DD",142,142.2,.01,0)
LOCATION(S) USING THE SUMMARY^MP44'^SC(^0;1^Q
"^DD",142,142.2,.01,1,0)
^.1
"^DD",142,142.2,.01,1,1,0)
142.2^B
"^DD",142,142.2,.01,1,1,1)
S ^GMT(142,DA(1),20,"B",$E(X,1,30),DA)=""
"^DD",142,142.2,.01,1,1,2)
K ^GMT(142,DA(1),20,"B",$E(X,1,30),DA)
"^DD",142,142.2,.01,1,1,"%D",0)
^^2^2^2920302^
"^DD",142,142.2,.01,1,1,"%D",1,0)
This REGULAR FileMan type cross-reference is used for look-ups of locations
"^DD",142,142.2,.01,1,1,"%D",2,0)
for which Health Summaries are scheduled.
"^DD",142,142.2,.01,1,2,0)
142^D
"^DD",142,142.2,.01,1,2,1)
S ^GMT(142,"D",$E(X,1,30),DA(1),DA)=""
"^DD",142,142.2,.01,1,2,2)
K ^GMT(142,"D",$E(X,1,30),DA(1),DA)
"^DD",142,142.2,.01,1,2,"%D",0)
^^2^2^2920302^^^^
"^DD",142,142.2,.01,1,2,"%D",1,0)
This whole-file, REGULAR FileMan cross-reference is used for look-ups
"^DD",142,142.2,.01,1,2,"%D",2,0)
of the Health Summary types which are queued for each location.
"^DD",142,142.2,.01,1,3,0)
142^AW3^MUMPS
"^DD",142,142.2,.01,1,3,1)
D STL^GMTSUIX
"^DD",142,142.2,.01,1,3,2)
D KTL^GMTSUIX
"^DD",142,142.2,.01,1,3,"DT")
2981214
"^DD",142,142.2,.01,21,0)
^^3^3^2920214^^
"^DD",142,142.2,.01,21,1,0)
Enter the name of the hospital location (ward or clinic) which is to have
"^DD",142,142.2,.01,21,2,0)
this health summary type generated on a nightly basis to the device
"^DD",142,142.2,.01,21,3,0)
specified below.
"^DD",142,142.2,.01,"DT")
2981214
"^DD",142,142.2,.02,0)
DEVICE FOR NIGHTLY PRINT^P3.5'^%ZIS(1,^0;2^Q
"^DD",142,142.2,.02,3)
Specify the printer nearest LOCATION.
"^DD",142,142.2,.02,21,0)
^^3^3^2950731^^
"^DD",142,142.2,.02,21,1,0)
Enter the name of the device on which the summaries for this location
"^DD",142,142.2,.02,21,2,0)
are to be queued to run each night. Preferably the printer nearest to
"^DD",142,142.2,.02,21,3,0)
the specified location.
"^DD",142,142.2,.02,"DT")
2900904
"^DD",142,142.2,.03,0)
PRINT ACTION PROFILE^S^Y:yes;N:no;^0;3^Q
"^DD",142,142.2,.03,3)
Enter 'Y'es to queue the OUTPATIENT Action Profile with Health Summary
"^DD",142,142.2,.03,21,0)
^^3^3^2920210^
"^DD",142,142.2,.03,21,1,0)
This flag will cause the scheduled option GMTS TASK STARTUP to queue the
"^DD",142,142.2,.03,21,2,0)
OUTPATIENT PHARMACY Action Profile "in tandem" with the Health Summary
"^DD",142,142.2,.03,21,3,0)
for any location where the Health Summary may be queued to print.
"^DD",142,142.2,.03,"DT")
2920210
"^DD",142,142.2,.04,0)
PRINT DAYS AHEAD^NJ2,0^^0;4^K:+X'=X!(X>10)!(X<0)!(X?.E1"."1N.N) X
"^DD",142,142.2,.04,3)
0 means available early morning on day of clinic, 1 means available early morning one day before clinic,etc
"^DD",142,142.2,.04,21,0)
^^5^5^2901017^
"^DD",142,142.2,.04,21,1,0)
Determines the number of days prior to scheduled appointments you wish
"^DD",142,142.2,.04,21,2,0)
to have health summaries printed for a given clinic.  That is, if you
"^DD",142,142.2,.04,21,3,0)
wish to have summaries printed on the night before the patients are
"^DD",142,142.2,.04,21,4,0)
scheduled for clinic, enter 0.  If you wish them to be printed two days
"^DD",142,142.2,.04,21,5,0)
in advance of scheduled visits enter 2, etc.
"^DD",142,142.2,.04,"DT")
2900904
"^DD",142.1,142.1,0)
FIELD^^14^18
"^DD",142.1,142.1,0,"DDA")
N
"^DD",142.1,142.1,0,"DT")
3000329
"^DD",142.1,142.1,0,"IX","AM",142.1,5)

"^DD",142.1,142.1,0,"IX","AM1",142.1,.01)

"^DD",142.1,142.1,0,"IX","AM2",142.1,3)

"^DD",142.1,142.1,0,"IX","AM9",142.1,9)

"^DD",142.1,142.1,0,"IX","B",142.1,.01)

"^DD",142.1,142.1,0,"IX","C",142.1,3)

"^DD",142.1,142.1,0,"IX","D",142.1,9)

"^DD",142.1,142.1,0,"NM","HEALTH SUMMARY COMPONENT")

"^DD",142.1,142.1,0,"PT",142.01,1)

"^DD",142.1,142.1,0,"PT",394.71,.04)

"^DD",142.1,142.1,0,"VRPK")
GMTS
"^DD",142.1,142.1,.001,0)
NUMBER^NJ10,0X^^ ^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X I $D(X) D CHKNUM^GMTSDD
"^DD",142.1,142.1,.001,3)
Enter your station number, followed by 001 to 999.
"^DD",142.1,142.1,.001,21,0)
^^4^4^2920914^^^^
"^DD",142.1,142.1,.001,21,1,0)
This is the internal record number of the component record.  If you are
"^DD",142.1,142.1,.001,21,2,0)
creating a new component, then this should be a sequential number,
"^DD",142.1,142.1,.001,21,3,0)
preceded by your station number (e.g., station number 660 should number
"^DD",142.1,142.1,.001,21,4,0)
custom-built components from 660001-660999, etc.).
"^DD",142.1,142.1,.001,"DT")
2920914
"^DD",142.1,142.1,.01,0)
NAME^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X D:$D(X) CHKNAME^GMTSDD
"^DD",142.1,142.1,.01,1,0)
^.1
"^DD",142.1,142.1,.01,1,1,0)
142.1^B
"^DD",142.1,142.1,.01,1,1,1)
S ^GMT(142.1,"B",$E(X,1,30),DA)=""
"^DD",142.1,142.1,.01,1,1,2)
K ^GMT(142.1,"B",$E(X,1,30),DA)
"^DD",142.1,142.1,.01,1,1,"%D",0)
^^2^2^2920302^
"^DD",142.1,142.1,.01,1,1,"%D",1,0)
This whole-file, REGULAR FileMan cross-reference is used for look-ups of
"^DD",142.1,142.1,.01,1,1,"%D",2,0)
components by NAME.
"^DD",142.1,142.1,.01,1,2,0)
142.1^AM1^MUMPS
"^DD",142.1,142.1,.01,1,2,1)
D REDO^GMTSDD
"^DD",142.1,142.1,.01,1,2,2)
D REDO^GMTSDD
"^DD",142.1,142.1,.01,1,2,"%D",0)
^^4^4^2950731^
"^DD",142.1,142.1,.01,1,2,"%D",1,0)
This MUMPS type cross-reference is used to rebuild the ad hoc and
"^DD",142.1,142.1,.01,1,2,"%D",2,0)
navigational menus when the NAME of a given component is modified. The
"^DD",142.1,142.1,.01,1,2,"%D",3,0)
^XUTL("XQORM", global is used by the Unwinder utility to generate the ad
"^DD",142.1,142.1,.01,1,2,"%D",4,0)
hoc and navigational menus.
"^DD",142.1,142.1,.01,3)
Answer must be 3-30 characters in length.
"^DD",142.1,142.1,.01,21,0)
^^3^3^2920109^^^^
"^DD",142.1,142.1,.01,21,1,0)
This is the name of the health summary component, which both uniquely
"^DD",142.1,142.1,.01,21,2,0)
identifies the component's record for look-ups, sorts, etc. and is also
"^DD",142.1,142.1,.01,21,3,0)
displayed in the component header, when the health summary is run.
"^DD",142.1,142.1,.01,"DEL",1,0)
I $S(+$G(DUZ(2))'>0:1,DUZ(2)=5000:0,(DA'<(DUZ(2)_"001")&(DA'>(DUZ(2)_"999"))):0,1:1) W !,$S(+$G(DUZ(2)):"ONLY Components Created at your site can be deleted",1:"DUZ(2) MUST equal your STATION NUMBER")
"^DD",142.1,142.1,.01,"DEL",2,0)
I '$D(GMCMP) W $C(7),!!,"You may only delete COMPONENTS using the GMTS IRM COMP ENTER/EDIT OPTION.",!
"^DD",142.1,142.1,.01,"DT")
2911212
"^DD",142.1,142.1,1,0)
PRINT ROUTINE^RFX^^0;2^K:$L(X)>17!($L(X)<3)!'(X?1U1.7UN1";"1U1.7UN) X I $D(X) D CHKRTN^GMTSDD
"^DD",142.1,142.1,1,3)
Component Print Routine in form LINETAG;ROUTINENAME (e.g., MAIN;GMTSLRC)
"^DD",142.1,142.1,1,8.5)
@
"^DD",142.1,142.1,1,9)
@
"^DD",142.1,142.1,1,21,0)
3^^3^3^2990428^^
"^DD",142.1,142.1,1,21,1,0)
This is the entry point and routine to be called when the component is
"^DD",142.1,142.1,1,21,2,0)
run for a given health summary type.  Enter the line label, followed by
"^DD",142.1,142.1,1,21,3,0)
a semi-colon, followed by the routine name (e.g., MAIN;GMTSLRC).
"^DD",142.1,142.1,1,"DT")
2920109
"^DD",142.1,142.1,1.1,0)
EXTERNAL/EXTRACT ROUTINE^142.11^^.1;0
"^DD",142.1,142.1,1.1,21,0)
^^1^1^2990616^^^^
"^DD",142.1,142.1,1.1,21,1,0)
Source of Health Summaary Component data.
"^DD",142.1,142.1,2,0)
TIME LIMITS APPLICABLE^S^Y:yes;^0;3^Q
"^DD",142.1,142.1,2,3)
Enter YES if time limits apply to this component.
"^DD",142.1,142.1,2,21,0)
^^3^3^2950728^^^^
"^DD",142.1,142.1,2,21,1,0)
This field is set up by the programmer to indicate whether the routine to
"^DD",142.1,142.1,2,21,2,0)
print this component will allow a time range to be applied to the data
"^DD",142.1,142.1,2,21,3,0)
to be displayed in the Health Summary.
"^DD",142.1,142.1,2,"DT")
2920109
"^DD",142.1,142.1,3,0)
ABBREVIATION^F^^0;4^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>4!($L(X)<2)!'(X?2.4UN) X
"^DD",142.1,142.1,3,1,0)
^.1
"^DD",142.1,142.1,3,1,1,0)
142.1^C
"^DD",142.1,142.1,3,1,1,1)
S ^GMT(142.1,"C",$E(X,1,30),DA)=""
"^DD",142.1,142.1,3,1,1,2)
K ^GMT(142.1,"C",$E(X,1,30),DA)
"^DD",142.1,142.1,3,1,1,"%D",0)
^^2^2^2920302^
"^DD",142.1,142.1,3,1,1,"%D",1,0)
This whole-file, REGULAR FileMan cross-reference is used in look-ups of
"^DD",142.1,142.1,3,1,1,"%D",2,0)
components by ABBREVIATION.
"^DD",142.1,142.1,3,1,2,0)
142.1^AM2^MUMPS
"^DD",142.1,142.1,3,1,2,1)
D REDO^GMTSDD
"^DD",142.1,142.1,3,1,2,2)
D REDO^GMTSDD
"^DD",142.1,142.1,3,1,2,"%D",0)
^^4^4^2950731^^
"^DD",142.1,142.1,3,1,2,"%D",1,0)
This MUMPS type cross-reference is used to rebuild the ad hoc and
"^DD",142.1,142.1,3,1,2,"%D",2,0)
navigational menus when the ABBREVIATION of a given component is modified.
"^DD",142.1,142.1,3,1,2,"%D",3,0)
The ^XUTL("XQORM", global is used by the Unwinder utility to generate the
"^DD",142.1,142.1,3,1,2,"%D",4,0)
ad hoc and navigational menus.
"^DD",142.1,142.1,3,3)
Answer must be 2-4 characters in length.
"^DD",142.1,142.1,3,21,0)
^^4^4^2950731^^^^
"^DD",142.1,142.1,3,21,1,0)
This 2-4 character abbreviation should uniquely identify the component,
"^DD",142.1,142.1,3,21,2,0)
since it is used both for lookup in the build health summary and ad hoc
"^DD",142.1,142.1,3,21,3,0)
health summary options, and for navigation between components when the
"^DD",142.1,142.1,3,21,4,0)
health summary is run interactively.
"^DD",142.1,142.1,3,"DT")
2920110
"^DD",142.1,142.1,3.5,0)
DESCRIPTION^142.35^^3.5;0
"^DD",142.1,142.1,4,0)
MAXIMUM OCCURRENCES APPLICABLE^S^Y:yes;^0;5^Q
"^DD",142.1,142.1,4,3)
Enter YES if maximum occurrence limits apply to this component.
"^DD",142.1,142.1,4,21,0)
^^3^3^2950728^^^^
"^DD",142.1,142.1,4,21,1,0)
This field is used by the programmer to indicate whether the routine which
"^DD",142.1,142.1,4,21,2,0)
prints this component is set up to handle maximum occurrence limits
"^DD",142.1,142.1,4,21,3,0)
on the Health Summary.
"^DD",142.1,142.1,4,"DT")
2920109
"^DD",142.1,142.1,5,0)
DISABLE FLAG^S^T:temporary;P:permanent;^0;6^Q
"^DD",142.1,142.1,5,1,0)
^.1
"^DD",142.1,142.1,5,1,1,0)
142.1^AM^MUMPS
"^DD",142.1,142.1,5,1,1,1)
D REDO^GMTSDD
"^DD",142.1,142.1,5,1,1,2)
D REDO^GMTSDD
"^DD",142.1,142.1,5,1,1,"%D",0)
^^4^4^2950731^
"^DD",142.1,142.1,5,1,1,"%D",1,0)
This MUMPS type cross-reference is used to rebuild the ad hoc and
"^DD",142.1,142.1,5,1,1,"%D",2,0)
navigational menus when a given component is DISABLED. The ^XUTL("XQORM",
"^DD",142.1,142.1,5,1,1,"%D",3,0)
global is used by the Unwinder utility to generate the ad hoc and
"^DD",142.1,142.1,5,1,1,"%D",4,0)
navigational menus.
"^DD",142.1,142.1,5,21,0)
^^10^10^2951017^^^^
"^DD",142.1,142.1,5,21,1,0)
IRM Staff or Clin Coordinator:  Use this field to disable (inactivate)
"^DD",142.1,142.1,5,21,2,0)
a health summary component (e.g., Lab Orders).  Setting this DISABLE
"^DD",142.1,142.1,5,21,3,0)
FLAG field to P(ermanent) causes a component to be non-selectable for use,
"^DD",142.1,142.1,5,21,4,0)
and prevents the component from being printed in any Health Summary
"^DD",142.1,142.1,5,21,5,0)
in which it is included.  Setting DISABLE FLAG to T(emporary) causes
"^DD",142.1,142.1,5,21,6,0)
a component to be non-selectable for use, but its OUT OF ORDER MESSAGE
"^DD",142.1,142.1,5,21,7,0)
will appear in any Health Summary in which it is included.
"^DD",142.1,142.1,5,21,8,0)
 
"^DD",142.1,142.1,5,21,9,0)
Use the at-sign (@) at the DISABLE FLAG: permanent (or temporary)// prompt,
"^DD",142.1,142.1,5,21,10,0)
to enable the component for use.
"^DD",142.1,142.1,5,"DT")
2911122
"^DD",142.1,142.1,6,0)
LOCK^FX^^0;7^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X I $D(X) Q:$D(^DIC(19.1,"B",X))  K X W !,$C(7),"Lock name must match exactly with a key in the SECURITY KEY file."
"^DD",142.1,142.1,6,3)
Enter the name of the security key required to have access to this component.
"^DD",142.1,142.1,6,21,0)
^^2^2^2901017^^^^
"^DD",142.1,142.1,6,21,1,0)
To be used for components such as psychology test results
"^DD",142.1,142.1,6,21,2,0)
Restricts viewing access under Print Health Summary Menu
"^DD",142.1,142.1,6,"DT")
2950816
"^DD",142.1,142.1,7,0)
SELECTION FILE^142.17P^^1;0
"^DD",142.1,142.1,7,21,0)
^^10^10^2960808^
"^DD",142.1,142.1,7,21,1,0)
Enter the name or number of the file from which selection items (e.g., lab
"^DD",142.1,142.1,7,21,2,0)
tests (file 60), radiology procedures (file 71), vital signs (file
"^DD",142.1,142.1,7,21,3,0)
120.51), PCE reminder/maintenance item (file 811.9) may be chosen for this
"^DD",142.1,142.1,7,21,4,0)
component.
"^DD",142.1,142.1,7,21,5,0)
 
"^DD",142.1,142.1,7,21,6,0)
The file you identify here must have its "Application Group"
"^DD",142.1,142.1,7,21,7,0)
multiple include "GMTS" BEFORE it can be selected as a selection file.
"^DD",142.1,142.1,7,21,8,0)
 
"^DD",142.1,142.1,7,21,9,0)
Components which require selection of items should have its component
"^DD",142.1,142.1,7,21,10,0)
name include the word "SELECTED".
"^DD",142.1,142.1,8,0)
OUT OF ORDER MESSAGE^F^^0;8^K:$L(X)>78!($L(X)<3) X
"^DD",142.1,142.1,8,3)
Answer must be 3-78 characters in length.
"^DD",142.1,142.1,8,21,0)
^^3^3^2910117^
"^DD",142.1,142.1,8,21,1,0)
This field is used when a health summary component is temporarily disabled.
"^DD",142.1,142.1,8,21,2,0)
If it is filled in, the message here will be displayed whenever the user
"^DD",142.1,142.1,8,21,3,0)
attempts to select the component
"^DD",142.1,142.1,8,"DT")
2910117
"^DD",142.1,142.1,9,0)
DEFAULT HEADER NAME^F^^0;9^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>20!($L(X)<2) X
"^DD",142.1,142.1,9,1,0)
^.1
"^DD",142.1,142.1,9,1,1,0)
142.1^AM9^MUMPS
"^DD",142.1,142.1,9,1,1,1)
D REDO^GMTSDD
"^DD",142.1,142.1,9,1,1,2)
D REDO^GMTSDD
"^DD",142.1,142.1,9,1,1,"%D",0)
^^4^4^2950731^
"^DD",142.1,142.1,9,1,1,"%D",1,0)
This MUMPS type cross-reference is used to recompile the ad hoc and
"^DD",142.1,142.1,9,1,1,"%D",2,0)
navigational menus when the DEFAULT HEADER NAME of a given component is
"^DD",142.1,142.1,9,1,1,"%D",3,0)
modified. The ^XUTL("XQORM", global is used by the Unwinder utility to
"^DD",142.1,142.1,9,1,1,"%D",4,0)
generate the ad hoc and navigational menus.
"^DD",142.1,142.1,9,1,1,"DT")
2911122
"^DD",142.1,142.1,9,1,2,0)
142.1^D^MUMPS
"^DD",142.1,142.1,9,1,2,1)
S ^GMT(142.1,"D",$$UP^XLFSTR(X),DA)=""
"^DD",142.1,142.1,9,1,2,2)
K ^GMT(142.1,"D",$$UP^XLFSTR(X),DA)
"^DD",142.1,142.1,9,1,2,"%D",0)
^^2^2^2951016^
"^DD",142.1,142.1,9,1,2,"%D",1,0)
This MUMPS type cross-reference is used in look-ups of components
"^DD",142.1,142.1,9,1,2,"%D",2,0)
by DEFAULT HEADER NAME.
"^DD",142.1,142.1,9,1,2,"DT")
2951016
"^DD",142.1,142.1,9,3)
Answer must be 2-20 characters in length.
"^DD",142.1,142.1,9,21,0)
^^5^5^2920928^^^^
"^DD",142.1,142.1,9,21,1,0)
The DEFAULT HEADER NAME will appear in menus and component headers in
"^DD",142.1,142.1,9,21,2,0)
preference to the COMPONENT NAME, but NOT in preference to the local
"^DD",142.1,142.1,9,21,3,0)
HEADER NAME, if it is defined for that component within a given Health 
"^DD",142.1,142.1,9,21,4,0)
Summary Type.  If defined the local HEADER NAME will have precedence
"^DD",142.1,142.1,9,21,5,0)
within a given Health Summary Type.
"^DD",142.1,142.1,9,"DT")
2951016
"^DD",142.1,142.1,10,0)
HOSPITAL LOCATION APPLICABLE^S^Y:yes;^0;10^Q
"^DD",142.1,142.1,10,3)
Enter YES if Hospital Location abbreviation display applies to this component.
"^DD",142.1,142.1,10,21,0)
^^3^3^2950731^
"^DD",142.1,142.1,10,21,1,0)
This field is used by the programmer to indicate whether the routine which
"^DD",142.1,142.1,10,21,2,0)
prints this component is set up to handle the display of the hospital
"^DD",142.1,142.1,10,21,3,0)
location abbreviation on the Health Summary.
"^DD",142.1,142.1,10,21,4,0)
file related components (PCE related components).
"^DD",142.1,142.1,10,"DT")
2940418
"^DD",142.1,142.1,11,0)
ICD TEXT APPLICABLE^S^Y:yes;^0;11^Q
"^DD",142.1,142.1,11,3)
Enter YES if ICD Text display applies to this component.
"^DD",142.1,142.1,11,21,0)
^^3^3^2950731^
"^DD",142.1,142.1,11,21,1,0)
This field is used by the programmer to indicate whether the routine which
"^DD",142.1,142.1,11,21,2,0)
prints this component is set up to handle the display of standardized ICD
"^DD",142.1,142.1,11,21,3,0)
text on the Health Summary.
"^DD",142.1,142.1,11,21,4,0)
(PCE related components).
"^DD",142.1,142.1,11,"DT")
2940418
"^DD",142.1,142.1,12,0)
PROVIDER NARRATIVE APPLICABLE^S^Y:yes;^0;12^Q
"^DD",142.1,142.1,12,3)
Enter YES if Provider Narrative display applies to this component.
"^DD",142.1,142.1,12,21,0)
^^3^3^3000329^^^
"^DD",142.1,142.1,12,21,1,0)
This field is used by the programmer to indicate whether the routine which
"^DD",142.1,142.1,12,21,2,0)
prints this component is set up to handle the display of the provider
"^DD",142.1,142.1,12,21,3,0)
narrative on the Health Summary.
"^DD",142.1,142.1,12,21,4,0)
(PCE related components).
"^DD",142.1,142.1,12,"DT")
2940418
"^DD",142.1,142.1,13,0)
PREFIX^F^^0;13^K:$L(X)>4!($L(X)<2) X
"^DD",142.1,142.1,13,3)
Answer must be 2-4 characters in length.
"^DD",142.1,142.1,13,21,0)
^^1^1^2990617^
"^DD",142.1,142.1,13,21,1,0)
Namespace of the component's supporting package.
"^DD",142.1,142.1,13,"DT")
2990617
"^DD",142.1,142.1,14,0)
CPT MODIFIER APPLICABLE^S^Y:YES;^0;14^Q
"^DD",142.1,142.1,14,21,0)
^^3^3^3000329^^^
"^DD",142.1,142.1,14,21,1,0)
This field is used by the programmer to indicate whether the routine which
"^DD",142.1,142.1,14,21,2,0)
prints this component is set up to handle the display of CPT Modifiers
"^DD",142.1,142.1,14,21,3,0)
on the Health Summary.
"^DD",142.1,142.1,14,"DT")
3000329
"^DD",142.1,142.11,0)
EXTERNAL/EXTRACT ROUTINE SUB-FIELD^^.01^1
"^DD",142.1,142.11,0,"DT")
2990616
"^DD",142.1,142.11,0,"IX","B",142.11,.01)

"^DD",142.1,142.11,0,"NM","EXTERNAL/EXTRACT ROUTINE")

"^DD",142.1,142.11,0,"UP")
142.1
"^DD",142.1,142.11,.01,0)
EXTERNAL/EXTRACT ROUTINE^MF^^0;1^K:$L(X)>40!($L(X)<3) X
"^DD",142.1,142.11,.01,.1)
ROUTINE
"^DD",142.1,142.11,.01,1,0)
^.1
"^DD",142.1,142.11,.01,1,1,0)
142.11^B
"^DD",142.1,142.11,.01,1,1,1)
S ^GMT(142.1,DA(1),.1,"B",$E(X,1,30),DA)=""
"^DD",142.1,142.11,.01,1,1,2)
K ^GMT(142.1,DA(1),.1,"B",$E(X,1,30),DA)
"^DD",142.1,142.11,.01,3)
Answer must be 3-40 characters in length.
"^DD",142.1,142.11,.01,21,0)
^^5^5^2990616^^
"^DD",142.1,142.11,.01,21,1,0)
This is the entry point and routine to be called by the Health Summary 
"^DD",142.1,142.11,.01,21,2,0)
component print routine to extract report data.  This entry point may be in 
"^DD",142.1,142.11,.01,21,3,0)
the Health Summary namespace or an exteral call with an associated Database 
"^DD",142.1,142.11,.01,21,4,0)
Integration Agreement.  Enter the line label, followed by a semi-colon, 
"^DD",142.1,142.11,.01,21,5,0)
followed by the routine name (e.g., MAIN;GMTSLRCE)
"^DD",142.1,142.11,.01,"DT")
2990616
"^DD",142.1,142.17,0)
SELECTION FILE SUB-FIELD^^1^2
"^DD",142.1,142.17,0,"DT")
2910103
"^DD",142.1,142.17,0,"IX","B",142.17,.01)

"^DD",142.1,142.17,0,"NM","SELECTION FILE")

"^DD",142.1,142.17,0,"UP")
142.1
"^DD",142.1,142.17,.01,0)
SELECTION FILE^M*P1'^DIC(^0;1^S DIC("S")="I $D(^DIC(""AC"",""GMTS"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",142.1,142.17,.01,1,0)
^.1
"^DD",142.1,142.17,.01,1,1,0)
142.17^B
"^DD",142.1,142.17,.01,1,1,1)
S ^GMT(142.1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",142.1,142.17,.01,1,1,2)
K ^GMT(142.1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",142.1,142.17,.01,1,1,"%D",0)
^^2^2^2920302^
"^DD",142.1,142.17,.01,1,1,"%D",1,0)
This REGULAR FileMan type cross-reference is used during look-ups of
"^DD",142.1,142.17,.01,1,1,"%D",2,0)
selection items in the Create/Modify and parameter edit dialogues.
"^DD",142.1,142.17,.01,12)
Only files that belong to the "GMTS" application group are allowed.
"^DD",142.1,142.17,.01,12.1)
S DIC("S")="I $D(^DIC(""AC"",""GMTS"",+Y))"
"^DD",142.1,142.17,.01,21,0)
^^3^3^2940714^^^^
"^DD",142.1,142.17,.01,21,1,0)
Enter the names or numbers of the files from which selection items
"^DD",142.1,142.17,.01,21,2,0)
(e.g., lab tests (file 60), radiology procedures (file 71), or vital 
"^DD",142.1,142.17,.01,21,3,0)
signs (file 120.51)) may be chosen for this component.
"^DD",142.1,142.17,.01,"DT")
2910103
"^DD",142.1,142.17,1,0)
SELECTION COUNT LIMIT^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",142.1,142.17,1,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",142.1,142.17,1,21,0)
^^4^4^2901017^
"^DD",142.1,142.17,1,21,1,0)
Enter the MAXIMUM number of selection items which may be selected for
"^DD",142.1,142.17,1,21,2,0)
any single appearance of this component in a given health summary type.
"^DD",142.1,142.17,1,21,3,0)
That is, a value of 7 will allow the user to select as many as seven
"^DD",142.1,142.17,1,21,4,0)
items, etc.
"^DD",142.1,142.17,1,"DT")
2900521
"^DD",142.1,142.35,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",142.1,142.35,0,"DT")
2910103
"^DD",142.1,142.35,0,"NM","DESCRIPTION")

"^DD",142.1,142.35,0,"UP")
142.1
"^DD",142.1,142.35,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",142.1,142.35,.01,"DT")
2910103
"^DIC",142,142,0)
HEALTH SUMMARY TYPE^142
"^DIC",142,142,0,"GL")
^GMT(142,
"^DIC",142,142,"%D",0)
^^11^11^2980401^^^^
"^DIC",142,142,"%D",1,0)
This file contains the structure of a Health Summary.  Components from the
"^DIC",142,142,"%D",2,0)
Health Summary Components file (142.1) may be selected and restricted by
"^DIC",142,142,"%D",3,0)
number of occurrences or time limits. The original creator of a type of 
"^DIC",142,142,"%D",4,0)
Health Summary is the owner of that type.  Health Summaries that are
"^DIC",142,142,"%D",5,0)
"owned" may not be modified or deleted by anyone else, except the Clinical
"^DIC",142,142,"%D",6,0)
Coordinator.  "Owned" Health Summaries may be used by other users to
"^DIC",142,142,"%D",7,0)
print patient information.  
"^DIC",142,142,"%D",8,0)
  
"^DIC",142,142,"%D",9,0)
The GMTSMGR security key is included on generic Health Summaries sent out 
"^DIC",142,142,"%D",10,0)
with the Health Summary Package.  These types of Health Summaries should 
"^DIC",142,142,"%D",11,0)
not be deleted.
"^DIC",142,142,"%D",12,0)
 
"^DIC",142,142,"%D",13,0)
Fields 2,3,4,5 and 6 are used ONLY by Indian Health Service.
"^DIC",142,142,"%D",14,0)
Specifically, fields 4 (MEASUREMENT PANEL) and 6 (SURVEILLANCE PANEL)
"^DIC",142,142,"%D",15,0)
point to files 9001017 and 9001018 respectively, which WILL NOT be
"^DIC",142,142,"%D",16,0)
present at non-PCC sites.
"^DIC",142,"B","HEALTH SUMMARY TYPE",142)

"^DIC",142.1,142.1,0)
HEALTH SUMMARY COMPONENT^142.1I
"^DIC",142.1,142.1,0,"GL")
^GMT(142.1,
"^DIC",142.1,142.1,"%D",0)
^^5^5^2980401^^^^
"^DIC",142.1,142.1,"%D",1,0)
This file contains all components which may be used to create a Health
"^DIC",142.1,142.1,"%D",2,0)
Summary. These entries are typically defined by a programmer. Components
"^DIC",142.1,142.1,"%D",3,0)
which represent packages which are not in use may be disabled, so they
"^DIC",142.1,142.1,"%D",4,0)
will not be selected by users to build new types of Health Summary
"^DIC",142.1,142.1,"%D",5,0)
reports.
"^DIC",142.1,"B","HEALTH SUMMARY COMPONENT",142.1)

**END**
**END**
