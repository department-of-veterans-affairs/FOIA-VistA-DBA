Released RG*1*23 SEQ #22
Extracted from mail message
**KIDS**:RG*1.0*23^

**INSTALL NAME**
RG*1.0*23
"BLD",1411,0)
RG*1.0*23^CLINICAL INFO RESOURCE NETWORK^0^3011220^y
"BLD",1411,1,0)
^^3^3^3011108^
"BLD",1411,1,1,0)
REMOTE DATA QUERY FEATURES
"BLD",1411,1,2,0)
Refer to patch RG*1*23 in the FORUM Patch Module for a complete
"BLD",1411,1,3,0)
description.
"BLD",1411,4,0)
^9.64PA^991.8^2
"BLD",1411,4,991.1,0)
991.1
"BLD",1411,4,991.1,2,0)
^9.641^991.12^1
"BLD",1411,4,991.1,2,991.12,0)
EXCEPTION  (sub-file)
"BLD",1411,4,991.1,2,991.12,1,0)
^9.6411^11^1
"BLD",1411,4,991.1,2,991.12,1,11,0)
NOTES
"BLD",1411,4,991.1,222)
y^n^p^^^^n
"BLD",1411,4,991.8,0)
991.8
"BLD",1411,4,991.8,2,0)
^9.641^991.8^1
"BLD",1411,4,991.8,2,991.8,0)
CIRN SITE PARAMETER  (File-top level)
"BLD",1411,4,991.8,2,991.8,1,0)
^9.6411^.04^1
"BLD",1411,4,991.8,2,991.8,1,.04,0)
LOCAL/MISSING DATE LAST RAN
"BLD",1411,4,991.8,222)
y^n^p^^^^n
"BLD",1411,4,"APDD",991.1,991.12)

"BLD",1411,4,"APDD",991.1,991.12,11)

"BLD",1411,4,"APDD",991.8,991.8)

"BLD",1411,4,"APDD",991.8,991.8,.04)

"BLD",1411,4,"B",991.1,991.1)

"BLD",1411,4,"B",991.8,991.8)

"BLD",1411,"ABNS",0)
^9.66A^^
"BLD",1411,"ABPKG")
n^^
"BLD",1411,"KRN",0)
^9.67PA^8989.52^19
"BLD",1411,"KRN",.4,0)
.4
"BLD",1411,"KRN",.401,0)
.401
"BLD",1411,"KRN",.402,0)
.402
"BLD",1411,"KRN",.403,0)
.403
"BLD",1411,"KRN",.5,0)
.5
"BLD",1411,"KRN",.84,0)
.84
"BLD",1411,"KRN",3.6,0)
3.6
"BLD",1411,"KRN",3.8,0)
3.8
"BLD",1411,"KRN",9.2,0)
9.2
"BLD",1411,"KRN",9.8,0)
9.8
"BLD",1411,"KRN",9.8,"NM",0)
^9.68A^10^10
"BLD",1411,"KRN",9.8,"NM",1,0)
RGRPDAT^^0^B49477948
"BLD",1411,"KRN",9.8,"NM",2,0)
RGEX01^^0^B28861807
"BLD",1411,"KRN",9.8,"NM",3,0)
RGEX03^^0^B74365453
"BLD",1411,"KRN",9.8,"NM",4,0)
RGEX04^^0^B5258578
"BLD",1411,"KRN",9.8,"NM",5,0)
RGEX05^^0^B5703462
"BLD",1411,"KRN",9.8,"NM",6,0)
RGRSDYN^^0^B5871265
"BLD",1411,"KRN",9.8,"NM",7,0)
RGRSDYN1^^0^B15400335
"BLD",1411,"KRN",9.8,"NM",8,0)
RGEXHND1^^0^B35335138
"BLD",1411,"KRN",9.8,"NM",9,0)
RGMTHL2^^0^B28076092
"BLD",1411,"KRN",9.8,"NM",10,0)
RGSYSTAT^^0^B37589419
"BLD",1411,"KRN",9.8,"NM","B","RGEX01",2)

"BLD",1411,"KRN",9.8,"NM","B","RGEX03",3)

"BLD",1411,"KRN",9.8,"NM","B","RGEX04",4)

"BLD",1411,"KRN",9.8,"NM","B","RGEX05",5)

"BLD",1411,"KRN",9.8,"NM","B","RGEXHND1",8)

"BLD",1411,"KRN",9.8,"NM","B","RGMTHL2",9)

"BLD",1411,"KRN",9.8,"NM","B","RGRPDAT",1)

"BLD",1411,"KRN",9.8,"NM","B","RGRSDYN",6)

"BLD",1411,"KRN",9.8,"NM","B","RGRSDYN1",7)

"BLD",1411,"KRN",9.8,"NM","B","RGSYSTAT",10)

"BLD",1411,"KRN",19,0)
19
"BLD",1411,"KRN",19,"NM",0)
^9.68A^6^6
"BLD",1411,"KRN",19,"NM",1,0)
RG REMOTE PDAT MENU^^0
"BLD",1411,"KRN",19,"NM",2,0)
RG REMOTE PDAT SEND^^0
"BLD",1411,"KRN",19,"NM",3,0)
RG REMOTE PDAT CHECK^^0
"BLD",1411,"KRN",19,"NM",4,0)
RG REMOTE PDAT DISPLAY^^0
"BLD",1411,"KRN",19,"NM",5,0)
RG EXCEPTION MENU^^2
"BLD",1411,"KRN",19,"NM",6,0)
RG EXCEPTION TF INQUIRY^^0
"BLD",1411,"KRN",19,"NM","B","RG EXCEPTION MENU",5)

"BLD",1411,"KRN",19,"NM","B","RG EXCEPTION TF INQUIRY",6)

"BLD",1411,"KRN",19,"NM","B","RG REMOTE PDAT CHECK",3)

"BLD",1411,"KRN",19,"NM","B","RG REMOTE PDAT DISPLAY",4)

"BLD",1411,"KRN",19,"NM","B","RG REMOTE PDAT MENU",1)

"BLD",1411,"KRN",19,"NM","B","RG REMOTE PDAT SEND",2)

"BLD",1411,"KRN",19.1,0)
19.1
"BLD",1411,"KRN",101,0)
101
"BLD",1411,"KRN",101,"NM",0)
^9.68A^21^21
"BLD",1411,"KRN",101,"NM",1,0)
RG EXCPT PDAT MENU^^0
"BLD",1411,"KRN",101,"NM",2,0)
RG EXCPT RSEND^^0
"BLD",1411,"KRN",101,"NM",3,0)
RG EXCPT RCHK^^0
"BLD",1411,"KRN",101,"NM",4,0)
RG EXCPT RDISP^^0
"BLD",1411,"KRN",101,"NM",5,0)
RG EXCPT MPI/PD DATA^^0
"BLD",1411,"KRN",101,"NM",6,0)
RG EXCPT ACTION MENU^^0
"BLD",1411,"KRN",101,"NM",7,0)
RG EXCPT EDIT NOTE^^0
"BLD",1411,"KRN",101,"NM",8,0)
RG EXCPT TF INQUIRY^^1^
"BLD",1411,"KRN",101,"NM",9,0)
RG EXCPT DATE SORT^^0
"BLD",1411,"KRN",101,"NM",10,0)
RG EXCPT DISPLAY ONLY QUERY^^0
"BLD",1411,"KRN",101,"NM",11,0)
RG EXCPT EDIT PATIENT DATA^^0
"BLD",1411,"KRN",101,"NM",12,0)
RG EXCPT HINQ INQUIRY^^0
"BLD",1411,"KRN",101,"NM",13,0)
RG EXCPT MAIN MENU^^0
"BLD",1411,"KRN",101,"NM",14,0)
RG EXCPT PATIENT AUDIT^^0
"BLD",1411,"KRN",101,"NM",15,0)
RG EXCPT PATIENT INQUIRY^^0
"BLD",1411,"KRN",101,"NM",16,0)
RG EXCPT PATIENT SORT^^0
"BLD",1411,"KRN",101,"NM",17,0)
RG EXCPT SELECT^^0
"BLD",1411,"KRN",101,"NM",18,0)
RG EXCPT SELECT TYPE^^0
"BLD",1411,"KRN",101,"NM",19,0)
RG EXCPT SING PATIENT INIT^^0
"BLD",1411,"KRN",101,"NM",20,0)
RG EXCPT TYPE SORT^^0
"BLD",1411,"KRN",101,"NM",21,0)
RG EXCPT UPDATE STATUS^^0
"BLD",1411,"KRN",101,"NM","B","RG EXCPT ACTION MENU",6)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT DATE SORT",9)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT DISPLAY ONLY QUERY",10)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT EDIT NOTE",7)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT EDIT PATIENT DATA",11)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT HINQ INQUIRY",12)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT MAIN MENU",13)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT MPI/PD DATA",5)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT PATIENT AUDIT",14)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT PATIENT INQUIRY",15)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT PATIENT SORT",16)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT PDAT MENU",1)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT RCHK",3)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT RDISP",4)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT RSEND",2)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT SELECT",17)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT SELECT TYPE",18)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT SING PATIENT INIT",19)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT TF INQUIRY",8)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT TYPE SORT",20)

"BLD",1411,"KRN",101,"NM","B","RG EXCPT UPDATE STATUS",21)

"BLD",1411,"KRN",409.61,0)
409.61
"BLD",1411,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",1411,"KRN",409.61,"NM",1,0)
RG EXCPT PDAT^^0
"BLD",1411,"KRN",409.61,"NM",2,0)
RG EXCPT RPDAT^^0
"BLD",1411,"KRN",409.61,"NM","B","RG EXCPT PDAT",1)

"BLD",1411,"KRN",409.61,"NM","B","RG EXCPT RPDAT",2)

"BLD",1411,"KRN",771,0)
771
"BLD",1411,"KRN",870,0)
870
"BLD",1411,"KRN",8989.51,0)
8989.51
"BLD",1411,"KRN",8989.52,0)
8989.52
"BLD",1411,"KRN",8994,0)
8994
"BLD",1411,"KRN","B",.4,.4)

"BLD",1411,"KRN","B",.401,.401)

"BLD",1411,"KRN","B",.402,.402)

"BLD",1411,"KRN","B",.403,.403)

"BLD",1411,"KRN","B",.5,.5)

"BLD",1411,"KRN","B",.84,.84)

"BLD",1411,"KRN","B",3.6,3.6)

"BLD",1411,"KRN","B",3.8,3.8)

"BLD",1411,"KRN","B",9.2,9.2)

"BLD",1411,"KRN","B",9.8,9.8)

"BLD",1411,"KRN","B",19,19)

"BLD",1411,"KRN","B",19.1,19.1)

"BLD",1411,"KRN","B",101,101)

"BLD",1411,"KRN","B",409.61,409.61)

"BLD",1411,"KRN","B",771,771)

"BLD",1411,"KRN","B",870,870)

"BLD",1411,"KRN","B",8989.51,8989.51)

"BLD",1411,"KRN","B",8989.52,8989.52)

"BLD",1411,"KRN","B",8994,8994)

"BLD",1411,"QUES",0)
^9.62^^
"BLD",1411,"REQB",0)
^9.611^4^4
"BLD",1411,"REQB",1,0)
DG*5.3*414^2
"BLD",1411,"REQB",2,0)
RG*1.0*17^2
"BLD",1411,"REQB",3,0)
RG*1.0*19^2
"BLD",1411,"REQB",4,0)
RG*1.0*21^2
"BLD",1411,"REQB","B","DG*5.3*414",1)

"BLD",1411,"REQB","B","RG*1.0*17",2)

"BLD",1411,"REQB","B","RG*1.0*19",3)

"BLD",1411,"REQB","B","RG*1.0*21",4)

"FIA",991.1)
CIRN HL7 EXCEPTION LOG
"FIA",991.1,0)
^RGHL7(991.1,
"FIA",991.1,0,0)
991.1
"FIA",991.1,0,1)
y^n^p^^^^n
"FIA",991.1,0,10)

"FIA",991.1,0,11)

"FIA",991.1,0,"RLRO")

"FIA",991.1,0,"VR")
1.0^RG
"FIA",991.1,991.1)
1
"FIA",991.1,991.12)
1
"FIA",991.1,991.12,11)

"FIA",991.1,991.1211)
0
"FIA",991.8)
CIRN SITE PARAMETER
"FIA",991.8,0)
^RGSITE(991.8,
"FIA",991.8,0,0)
991.8
"FIA",991.8,0,1)
y^n^p^^^^n
"FIA",991.8,0,10)

"FIA",991.8,0,11)

"FIA",991.8,0,"RLRO")

"FIA",991.8,0,"VR")
1.0^RG
"FIA",991.8,991.8)
1
"FIA",991.8,991.8,.04)

"KRN",19,6403,-1)
2^5
"KRN",19,6403,0)
RG EXCEPTION MENU^Message Exception Menu^^M^^^^^^^^272
"KRN",19,6403,10,0)
^19.01IP^5^4
"KRN",19,6403,10,3,0)
6712^^10
"KRN",19,6403,10,3,"^")
RG EXCEPTION TF INQUIRY
"KRN",19,6403,10,5,0)
6754^^15
"KRN",19,6403,10,5,"^")
RG REMOTE PDAT MENU
"KRN",19,6403,"U")
MESSAGE EXCEPTION MENU
"KRN",19,6712,-1)
0^6
"KRN",19,6712,0)
RG EXCEPTION TF INQUIRY^Patient MPI/PD Data Inquiry^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6712,1,0)
^19.06^5^5^3011220^^
"KRN",19,6712,1,1,0)
This report provides MPI/PD Data for a selected patient.  
"KRN",19,6712,1,2,0)
Information displayed includes the Integration Control Number (ICN),
"KRN",19,6712,1,3,0)
the Coordinating Master of Record (CMOR) site, MPI/PD Activity Score,
"KRN",19,6712,1,4,0)
Subscription Control Number, Treating Facility list, CMOR History 
"KRN",19,6712,1,5,0)
and CMOR Change Request History.
"KRN",19,6712,25)
PDAT^RGEX01
"KRN",19,6712,"U")
PATIENT MPI/PD DATA INQUIRY
"KRN",19,6751,-1)
0^2
"KRN",19,6751,0)
RG REMOTE PDAT SEND^Send Remote Patient Data Query^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6751,1,0)
^19.06^5^5^3011115^^
"KRN",19,6751,1,1,0)
This option allows you to send remote patient data queries from 
"KRN",19,6751,1,2,0)
your facility to any facility at which a selected patient has 
"KRN",19,6751,1,3,0)
been seen.  The remote data fields retrieved are the same as 
"KRN",19,6751,1,4,0)
those that are available for local data using the Patient MPI/PD 
"KRN",19,6751,1,5,0)
Data Inquiry [RG EXCEPTION TF INQUIRY] option.
"KRN",19,6751,25)
SEND2^RGRPDAT
"KRN",19,6751,"U")
SEND REMOTE PATIENT DATA QUERY
"KRN",19,6752,-1)
0^3
"KRN",19,6752,0)
RG REMOTE PDAT CHECK^Check Remote Patient Data Query^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6752,1,0)
^19.06^3^3^3011115^^^
"KRN",19,6752,1,1,0)
This option allows you to check the status of a remote patient 
"KRN",19,6752,1,2,0)
data query previously sent using the Send Remote Patient 
"KRN",19,6752,1,3,0)
Data Query [RG REMOTE PDAT SEND] option.
"KRN",19,6752,25)
CHKSTAT2^RGRPDAT
"KRN",19,6752,"U")
CHECK REMOTE PATIENT DATA QUER
"KRN",19,6753,-1)
0^4
"KRN",19,6753,0)
RG REMOTE PDAT DISPLAY^Display Remote Patient Data Query^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6753,1,0)
^19.06^3^3^3011115^^
"KRN",19,6753,1,1,0)
This option allows you to display a patient data query previously
"KRN",19,6753,1,2,0)
sent using the Send Remote Patient Data Query [RG REMOTE PDAT SEND]
"KRN",19,6753,1,3,0)
option.
"KRN",19,6753,25)
DISP2^RGRPDAT
"KRN",19,6753,"U")
DISPLAY REMOTE PATIENT DATA QU
"KRN",19,6754,-1)
0^1
"KRN",19,6754,0)
RG REMOTE PDAT MENU^Remote Patient Data Query Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6754,1,0)
^19.06^7^7^3011220^^^^
"KRN",19,6754,1,1,0)
This menu provides options to query any facility at which a selected
"KRN",19,6754,1,2,0)
patient has been seen, check the query, and display the remote patient
"KRN",19,6754,1,3,0)
data that is returned from that site.  The remote data fields retrieved
"KRN",19,6754,1,4,0)
include the Integration Control Number (ICN), the Coordinating Master
"KRN",19,6754,1,5,0)
of Record (CMOR) site, MPI/PD Activity Score, Subscription Control
"KRN",19,6754,1,6,0)
Number, Treating Facility list, CMOR History and CMOR Change Request 
"KRN",19,6754,1,7,0)
History.
"KRN",19,6754,10,0)
^19.01IP^3^3
"KRN",19,6754,10,1,0)
6751^^10
"KRN",19,6754,10,1,"^")
RG REMOTE PDAT SEND
"KRN",19,6754,10,2,0)
6752^^20
"KRN",19,6754,10,2,"^")
RG REMOTE PDAT CHECK
"KRN",19,6754,10,3,0)
6753^^30
"KRN",19,6754,10,3,"^")
RG REMOTE PDAT DISPLAY
"KRN",19,6754,99)
58750,57087
"KRN",19,6754,"U")
REMOTE PATIENT DATA QUERY MENU
"KRN",101,1692,-1)
0^13
"KRN",101,1692,0)
RG EXCPT MAIN MENU^MPI/PD EXCEPTION MENU^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1692,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1692,1,1,0)
This protocol serves as the main menu of exception handling options
"KRN",101,1692,1,2,0)
under the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1692,4)
40^4
"KRN",101,1692,10,0)
^101.01PA^7^7
"KRN",101,1692,10,3,0)
1693^SE^15^^^Select Exception
"KRN",101,1692,10,3,"^")
RG EXCPT SELECT
"KRN",101,1692,10,4,0)
1699^ST^10^^^Sort by Exception Type
"KRN",101,1692,10,4,"^")
RG EXCPT TYPE SORT
"KRN",101,1692,10,5,0)
1700^SD^5^^^Sort Exceptions by Date
"KRN",101,1692,10,5,"^")
RG EXCPT DATE SORT
"KRN",101,1692,10,6,0)
1701^SN^7^^^Sort by Patient Name
"KRN",101,1692,10,6,"^")
RG EXCPT PATIENT SORT
"KRN",101,1692,10,7,0)
1702^VT^12^^^View Selected Exception Type
"KRN",101,1692,10,7,"^")
RG EXCPT SELECT TYPE
"KRN",101,1692,26)
D SHOW^VALM
"KRN",101,1692,28)
Select Action:
"KRN",101,1692,99)
58639,51005
"KRN",101,1693,-1)
0^17
"KRN",101,1693,0)
RG EXCPT SELECT^Select Exception^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1693,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1693,1,1,0)
This protocol allows the user to select an exception for processing
"KRN",101,1693,1,2,0)
from the MPI/PD Exceptions screen in the MPI/PD Exception Handling
"KRN",101,1693,1,3,0)
option [RG EXCEPTION HANDLING].
"KRN",101,1693,20)
D SELECT^RGEXHND1
"KRN",101,1693,99)
58043,62323
"KRN",101,1694,-1)
0^6
"KRN",101,1694,0)
RG EXCPT ACTION MENU^MPI/PD EXCEPTION HANDLING^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1694,1,0)
^101.06^4^4^3011030^^^^
"KRN",101,1694,1,1,0)
This protocol serves as the action menu and allows several
"KRN",101,1694,1,2,0)
actions to be taken for a patient selected from the MPI/PD
"KRN",101,1694,1,3,0)
Exception Menu [RG EXCPT MAIN MENU].  This is activated through
"KRN",101,1694,1,4,0)
the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1694,4)
26^4
"KRN",101,1694,10,0)
^101.01PA^11^11
"KRN",101,1694,10,3,0)
1695^UPD^50^^^Update to Processed
"KRN",101,1694,10,3,"^")
RG EXCPT UPDATE STATUS
"KRN",101,1694,10,4,0)
1696^DO^42^^^MPI Display Only Qry
"KRN",101,1694,10,4,"^")
RG EXCPT DISPLAY ONLY QUERY
"KRN",101,1694,10,5,0)
1697^SPI^45^^^Single Patient Init
"KRN",101,1694,10,5,"^")
RG EXCPT SING PATIENT INIT
"KRN",101,1694,10,6,0)
1698^ED^47^^^Edit Patient Data
"KRN",101,1694,10,6,"^")
RG EXCPT EDIT PATIENT DATA
"KRN",101,1694,10,7,0)
1703^PI^35^^^Patient Inquiry
"KRN",101,1694,10,7,"^")
RG EXCPT PATIENT INQUIRY
"KRN",101,1694,10,8,0)
1704^AUD^30^^^Patient Audit
"KRN",101,1694,10,8,"^")
RG EXCPT PATIENT AUDIT
"KRN",101,1694,10,9,0)
1705^HI^40^^^Hinq Inquiry
"KRN",101,1694,10,9,"^")
RG EXCPT HINQ INQUIRY
"KRN",101,1694,10,10,0)
1806^DI^80^^^MPI/PD Data Inquiry
"KRN",101,1694,10,10,"^")
RG EXCPT MPI/PD DATA
"KRN",101,1694,10,11,0)
1846^NT^90^^^Edit Note
"KRN",101,1694,10,11,"^")
RG EXCPT EDIT NOTE
"KRN",101,1694,20)

"KRN",101,1694,26)
D SHOW^VALM
"KRN",101,1694,28)
Select Action:
"KRN",101,1694,99)
58742,36838
"KRN",101,1695,-1)
0^21
"KRN",101,1695,0)
RG EXCPT UPDATE STATUS^Update Status to Processed^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1695,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1695,1,1,0)
This protocol allows the user to update the exception status 
"KRN",101,1695,1,2,0)
to PROCESSED from the MPI/PD Exception Handling option [RG 
"KRN",101,1695,1,3,0)
EXCEPTION HANDLING].
"KRN",101,1695,2,0)
^101.02A^^0
"KRN",101,1695,4)
^^^
"KRN",101,1695,20)
D UPD^RGEX03
"KRN",101,1695,99)
58043,62323
"KRN",101,1696,-1)
0^10
"KRN",101,1696,0)
RG EXCPT DISPLAY ONLY QUERY^Display Only Query to MPI^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1696,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1696,1,1,0)
This protocol allows the user to perform a Display Only Query to the MPI
"KRN",101,1696,1,2,0)
from the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1696,20)
D DISP^RGEX03
"KRN",101,1696,99)
58043,62323
"KRN",101,1697,-1)
0^19
"KRN",101,1697,0)
RG EXCPT SING PATIENT INIT^Single Patient Init to MPI^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1697,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1697,1,1,0)
This protocol allows the user to perform a Single Patient
"KRN",101,1697,1,2,0)
Initialization to the MPI from the MPI/PD Exception Handling 
"KRN",101,1697,1,3,0)
option [RG EXCEPTION HANDLING].
"KRN",101,1697,20)
D INTL^RGEX03
"KRN",101,1697,99)
58043,62323
"KRN",101,1698,-1)
0^11
"KRN",101,1698,0)
RG EXCPT EDIT PATIENT DATA^Edit Patient Data^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1698,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1698,1,1,0)
This protocol allows the user to edit patient data from the 
"KRN",101,1698,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1698,20)
D LOAD^RGEX03
"KRN",101,1698,99)
58043,62323
"KRN",101,1699,-1)
0^20
"KRN",101,1699,0)
RG EXCPT TYPE SORT^Sort by Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1699,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1699,1,1,0)
This protocol allows the user to sort exceptions by type in the
"KRN",101,1699,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1699,20)
S RGSORT="ST" D SORT^RGEX01
"KRN",101,1699,99)
58043,62323
"KRN",101,1700,-1)
0^9
"KRN",101,1700,0)
RG EXCPT DATE SORT^Sort by Exception Date^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1700,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1700,1,1,0)
This protocol allows the user to sort exceptions by date in the
"KRN",101,1700,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1700,20)
S RGSORT="SD" D SORT^RGEX01
"KRN",101,1700,99)
58043,62323
"KRN",101,1701,-1)
0^16
"KRN",101,1701,0)
RG EXCPT PATIENT SORT^Sort by Patient ^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1701,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1701,1,1,0)
This protocol allows the user to sort exceptions by patient in
"KRN",101,1701,1,2,0)
the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1701,20)
S RGSORT="SN" D SORT^RGEX01
"KRN",101,1701,99)
58043,62323
"KRN",101,1702,-1)
0^18
"KRN",101,1702,0)
RG EXCPT SELECT TYPE^View Selected Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1702,1,0)
^101.06^4^4^3010719^^^^
"KRN",101,1702,1,1,0)
This protocol allows the user to select an exception type to 
"KRN",101,1702,1,2,0)
view, all others will be filtered out, for exception processing
"KRN",101,1702,1,3,0)
from the MPI/PD Exceptions screen in the MPI/PD Exception Handling
"KRN",101,1702,1,4,0)
option [RG EXCEPTION HANDLING].
"KRN",101,1702,20)
S RGSORT="VT" D SORT^RGEX01
"KRN",101,1702,27)

"KRN",101,1702,99)
58043,62323
"KRN",101,1703,-1)
0^15
"KRN",101,1703,0)
RG EXCPT PATIENT INQUIRY^Patient Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1703,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1703,1,1,0)
This protocol allows the user to do a Patient Inquiry from the 
"KRN",101,1703,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1703,20)
D INQ^RGEX03
"KRN",101,1703,99)
58043,62323
"KRN",101,1704,-1)
0^14
"KRN",101,1704,0)
RG EXCPT PATIENT AUDIT^Patient Audit^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1704,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1704,1,1,0)
This protocol allows the user to audit the changes made in the
"KRN",101,1704,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1704,20)
D PA^RGEX03
"KRN",101,1704,99)
58043,62323
"KRN",101,1705,-1)
0^12
"KRN",101,1705,0)
RG EXCPT HINQ INQUIRY^Hinq Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1705,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1705,1,1,0)
This protocol allows the user to do a HINQ Inquiry for a 
"KRN",101,1705,1,2,0)
selected patient in the MPI/PD Exception Handling option 
"KRN",101,1705,1,3,0)
[RG EXCEPTION HANDLING].
"KRN",101,1705,20)
D HI^RGEX03
"KRN",101,1705,99)
58043,62323
"KRN",101,1806,-1)
0^5
"KRN",101,1806,0)
RG EXCPT MPI/PD DATA^MPI/PD Data Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1806,1,0)
^101.06^2^2^3011022^^^^
"KRN",101,1806,1,1,0)
This protocol displays Master Patient Index/Patient Demographics 
"KRN",101,1806,1,2,0)
(MPI/PD) information for the selected patient.
"KRN",101,1806,2,0)
^101.02A^2^1
"KRN",101,1806,2,2,0)
DI
"KRN",101,1806,2,"B","DI",2)

"KRN",101,1806,20)
D PDAT^RGEX03
"KRN",101,1806,99)
58734,46469
"KRN",101,1842,-1)
0^2
"KRN",101,1842,0)
RG EXCPT RSEND^Send Remote Patient Data Query^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1842,1,0)
^^2^2^3011016^
"KRN",101,1842,1,1,0)
This protocol allows the user to send a remote patient data query to
"KRN",101,1842,1,2,0)
treating facility sites.
"KRN",101,1842,20)
D RSEND^RGEX04
"KRN",101,1842,99)
58728,59197
"KRN",101,1843,-1)
0^3
"KRN",101,1843,0)
RG EXCPT RCHK^Check Remote Patient Data Query^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1843,1,0)
^^2^2^3011016^
"KRN",101,1843,1,1,0)
This protocol allows the user to check the status of a remote patient data
"KRN",101,1843,1,2,0)
query.
"KRN",101,1843,20)
D RCHK^RGEX04
"KRN",101,1843,99)
58728,59359
"KRN",101,1844,-1)
0^4
"KRN",101,1844,0)
RG EXCPT RDISP^Display Patient Data Query^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1844,1,0)
^^2^2^3011016^
"KRN",101,1844,1,1,0)
This protocol allows the user to check the status of a remote patient data
"KRN",101,1844,1,2,0)
query.
"KRN",101,1844,20)
D RDISP^RGEX04
"KRN",101,1844,99)
58728,59436
"KRN",101,1845,-1)
0^1
"KRN",101,1845,0)
RG EXCPT PDAT MENU^MPI/PD PATIENT DATA ACTION MENU^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1845,1,0)
^^2^2^3011016^
"KRN",101,1845,1,1,0)
This protocol serves as the action menu for the MPI/PD Exception Handling
"KRN",101,1845,1,2,0)
Patient Data Query actions.
"KRN",101,1845,4)
40
"KRN",101,1845,10,0)
^101.01PA^3^3
"KRN",101,1845,10,1,0)
1842^SND^5^^^Send Remote Query
"KRN",101,1845,10,1,"^")
RG EXCPT RSEND
"KRN",101,1845,10,2,0)
1843^CHK^10^^^Check Remote Query
"KRN",101,1845,10,2,"^")
RG EXCPT RCHK
"KRN",101,1845,10,3,0)
1844^DSP^15^^^Display Query Data
"KRN",101,1845,10,3,"^")
RG EXCPT RDISP
"KRN",101,1845,26)
D SHOW^VALM
"KRN",101,1845,28)
Select Action:
"KRN",101,1845,99)
58728,59920
"KRN",101,1846,-1)
0^7
"KRN",101,1846,0)
RG EXCPT EDIT NOTE^Edit Notes^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1846,1,0)
^^1^1^3011030^
"KRN",101,1846,1,1,0)
This protocol allows the user to add/edit notes to the exception.
"KRN",101,1846,20)
D EDTNOT^RGEX03
"KRN",101,1846,99)
58742,35539
"KRN",101,1864,-1)
1^8
"KRN",101,1864,0)
RG EXCPT TF INQUIRY
"KRN",409.61,253,-1)
0^1
"KRN",409.61,253,0)
RG EXCPT PDAT^1^^80^5^18^1^1^^RG EXCPT PDAT MENU^MPI/PD PATIENT DATA ACTIONS^1^^1
"KRN",409.61,253,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,253,"ARRAY")
 ^TMP("RGEXC4",$J)
"KRN",409.61,253,"COL",0)
^409.621^1^1
"KRN",409.61,253,"COL",1,0)
EXCEPTION^2^70^Patient Data^H^0
"KRN",409.61,253,"COL","AIDENT",0,1)

"KRN",409.61,253,"COL","B","EXCEPTION",1)

"KRN",409.61,253,"FNL")
D EXIT^RGEX04
"KRN",409.61,253,"HDR")
D HDR^RGEX04
"KRN",409.61,253,"HLP")
D HELP^RGEX04
"KRN",409.61,253,"INIT")
D INIT^RGEX04
"KRN",409.61,254,-1)
0^2
"KRN",409.61,254,0)
RG EXCPT RPDAT^1^^80^5^18^1^1^^^MPI/PD REMOTE DATA QUERY^1^^1
"KRN",409.61,254,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,254,"ARRAY")
 ^TMP("RGEXC5",$J)
"KRN",409.61,254,"COL",0)
^409.621^1^1
"KRN",409.61,254,"COL",1,0)
EXCEPTION^2^70^REMOTE PATIENT DATA^H^0
"KRN",409.61,254,"COL","AIDENT",0,1)

"KRN",409.61,254,"COL","B","EXCEPTION",1)

"KRN",409.61,254,"FNL")
D EXIT^RGEX05
"KRN",409.61,254,"HDR")
D HDR^RGEX05
"KRN",409.61,254,"HLP")
D HELP^RGEX05
"KRN",409.61,254,"INIT")
D INIT^RGEX05
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
23^3011220
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3011220
"PKG",272,22,1,"PAH",1,1,1,0)
REMOTE DATA QUERY FEATURES
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*23 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","RGEX01")
0^2^B28861807
"RTN","RGEX01",1,0)
RGEX01 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/07/99
"RTN","RGEX01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23**;30 Apr 99
"RTN","RGEX01",3,0)
 ;
"RTN","RGEX01",4,0)
 ;Reference to MAIN^VAFCPDAT supported by IA #3299
"RTN","RGEX01",5,0)
EN ; -- main entry point for RG EXCPT SUMMARY
"RTN","RGEX01",6,0)
 N STDT,ENDDT,PRGSTAT,XFLAG
"RTN","RGEX01",7,0)
 S XFLAG=0
"RTN","RGEX01",8,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1)
"RTN","RGEX01",9,0)
 I $D(STDT) S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGEX01",10,0)
 S PRGSTAT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",3)
"RTN","RGEX01",11,0)
 I PRGSTAT="" D
"RTN","RGEX01",12,0)
 . W $C(7)
"RTN","RGEX01",13,0)
 . W !!,"The MPI/PD Exception Purge process has not been run."
"RTN","RGEX01",14,0)
 . S DIR(0)="YA",DIR("B")="NO"
"RTN","RGEX01",15,0)
 . S DIR("??")="^D HLPPRG^RGEX01"
"RTN","RGEX01",16,0)
 . S DIR("A")="Do you want to run it now? "
"RTN","RGEX01",17,0)
 . D ^DIR K DIR
"RTN","RGEX01",18,0)
 . I $D(DIRUT)!$D(DUOUT) S XFLAG=1 Q
"RTN","RGEX01",19,0)
 . I Y>0 D
"RTN","RGEX01",20,0)
 .. W !!,"The MPI/PD Exception Purge process will now run."
"RTN","RGEX01",21,0)
 .. W !,"Please come back to this option in ten minutes."
"RTN","RGEX01",22,0)
 .. S XFLAG=1 D QUEPRG
"RTN","RGEX01",23,0)
 L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 I '$T W $C(7),!!,"The MPI/PD Exception Purge process is currently running.",!,"Please try this option again in ten minutes." S XFLAG=1 G EXIT
"RTN","RGEX01",24,0)
 L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",25,0)
 I $G(PRGSTAT)="C" D
"RTN","RGEX01",26,0)
 . W !!,"The MPI/PD Exception Purge process last ran "_STDT_"."
"RTN","RGEX01",27,0)
 . S DIR(0)="YA",DIR("B")="NO",DIR("??")="^D HLPPRG^RGEX01"
"RTN","RGEX01",28,0)
 . S DIR("A")="Do you want to run the MPI/PD Exception Purge process now? "
"RTN","RGEX01",29,0)
 . D ^DIR K DIR,RGANS S RGANS=Y
"RTN","RGEX01",30,0)
 . I $D(DIRUT)!$D(DUOUT) S XFLAG=1 Q
"RTN","RGEX01",31,0)
 . L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 D
"RTN","RGEX01",32,0)
 ..I '$T S RGANS=1 Q
"RTN","RGEX01",33,0)
 ..L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",34,0)
 . I RGANS>0 D
"RTN","RGEX01",35,0)
 .. W !!,"The MPI/PD Exception Purge process will now run."
"RTN","RGEX01",36,0)
 .. W !,"Please come back to this option in ten minutes."
"RTN","RGEX01",37,0)
 .. S XFLAG=1 D QUEPRG
"RTN","RGEX01",38,0)
 I XFLAG=1 G EXIT
"RTN","RGEX01",39,0)
 K RGANS
"RTN","RGEX01",40,0)
 D WAIT^DICD
"RTN","RGEX01",41,0)
 D EN^VALM("RG EXCPT SUMMARY")
"RTN","RGEX01",42,0)
 Q
"RTN","RGEX01",43,0)
 ;
"RTN","RGEX01",44,0)
HDR ; -- header code
"RTN","RGEX01",45,0)
 S VALMHDR(1)="MPI/PD Exception Handling"
"RTN","RGEX01",46,0)
 S VALMHDR(2)=""
"RTN","RGEX01",47,0)
 Q
"RTN","RGEX01",48,0)
 ;
"RTN","RGEX01",49,0)
INIT ; -- init variables and list array
"RTN","RGEX01",50,0)
 I '$D(RGSORT) S RGSORT="SD"
"RTN","RGEX01",51,0)
 K @VALMAR
"RTN","RGEX01",52,0)
 I RGSORT="SD" D DTLIST^RGEXHND1
"RTN","RGEX01",53,0)
 E  I RGSORT="ST" D EXCLST^RGEXHND1
"RTN","RGEX01",54,0)
 E  I RGSORT="SN" D PATLST^RGEXHND1
"RTN","RGEX01",55,0)
 E  I RGSORT="VT" D SELTYP^RGEXHND1
"RTN","RGEX01",56,0)
 Q
"RTN","RGEX01",57,0)
 ;
"RTN","RGEX01",58,0)
SORT ;
"RTN","RGEX01",59,0)
 D INIT
"RTN","RGEX01",60,0)
 S VALMBCK="R"
"RTN","RGEX01",61,0)
 Q
"RTN","RGEX01",62,0)
HELP ; -- help code
"RTN","RGEX01",63,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX01",64,0)
 Q
"RTN","RGEX01",65,0)
HLPPRG ;
"RTN","RGEX01",66,0)
 W !,"Enter Y(YES) to run the MPI/PD Exception Purge process now."
"RTN","RGEX01",67,0)
 W !!,"Enter N(NO) to go directly into the MPI/PD Exception Handling option."
"RTN","RGEX01",68,0)
 Q
"RTN","RGEX01",69,0)
 ;
"RTN","RGEX01",70,0)
EXIT ; -- exit code
"RTN","RGEX01",71,0)
 K VADM,RGDFN,RGNM,RGSORT,RGSSN,STAT,STRING,NDX,NM,IEN,IEN2,X,DATA,CNT,EXCTYPE,ETYPE,^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEX01",72,0)
 Q
"RTN","RGEX01",73,0)
QUEPRG S ZTRTN="MAIN^RGEVPRG",ZTDESC="PURGE ZZ*, OVER 30 DAY AND DUPLICATE RECORDS FROM THE CIRN HL7 EXCEPTION LOG FILE"
"RTN","RGEX01",74,0)
 D NOW^%DTC
"RTN","RGEX01",75,0)
 S ZTIO="",ZTDTH=%
"RTN","RGEX01",76,0)
 I $D(DUZ) S ZTSAVE("DUZ")=DUZ
"RTN","RGEX01",77,0)
 D ^%ZTLOAD
"RTN","RGEX01",78,0)
 D HOME^%ZIS K IO("Q")
"RTN","RGEX01",79,0)
 K ZTDESC,ZTDTH,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK,%
"RTN","RGEX01",80,0)
 Q
"RTN","RGEX01",81,0)
 ;
"RTN","RGEX01",82,0)
EXPND ; -- expand code
"RTN","RGEX01",83,0)
 Q
"RTN","RGEX01",84,0)
CUREX() ;Call to check if there are any patients in the CIRN HL7 EXCEPTION
"RTN","RGEX01",85,0)
 ;LOG file (#991.1) that currently need to be resolved
"RTN","RGEX01",86,0)
 N STAT,EXCTYP,RGEX
"RTN","RGEX01",87,0)
 S STAT="",EXCTYP="",RGEX=0
"RTN","RGEX01",88,0)
 F  S STAT=$O(^RGHL7(991.1,"ASTAT",STAT)) Q:STAT=""!RGEX=1  D
"RTN","RGEX01",89,0)
 . F  S EXCTYP=$O(^RGHL7(991.1,"ASTAT",STAT,EXCTYP)) Q:'EXCTYP!RGEX=1  D
"RTN","RGEX01",90,0)
 .. I (EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)))&(STAT=0) S RGEX=1
"RTN","RGEX01",91,0)
 Q RGEX
"RTN","RGEX01",92,0)
PROC ; For a given patient, set exceptions STATUS to PROCESSED.
"RTN","RGEX01",93,0)
 ; DFN must be defined
"RTN","RGEX01",94,0)
 Q:'$D(DFN)
"RTN","RGEX01",95,0)
 S EXCTYP=""
"RTN","RGEX01",96,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX01",97,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEX01",98,0)
 . S RGDFN="",ICN=""
"RTN","RGEX01",99,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEX01",100,0)
 .. I DFN=RGDFN D
"RTN","RGEX01",101,0)
 ... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX01",102,0)
 ... ;Only set to PROCESSED if patient has national ICN.
"RTN","RGEX01",103,0)
 ... I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX01",104,0)
 .... ;Exclude Death exceptions, they must be processed manually.
"RTN","RGEX01",105,0)
 .... I (EXCTYP>217)!(EXCTYP<215) D
"RTN","RGEX01",106,0)
 ..... S IEN=0
"RTN","RGEX01",107,0)
 ..... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEX01",108,0)
 ...... S IEN2=0
"RTN","RGEX01",109,0)
 ...... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX01",110,0)
 ....... L +^RGHL7(991.1,IEN):10
"RTN","RGEX01",111,0)
 ....... S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX01",112,0)
 ....... D ^DIE K DIE,DA,DR
"RTN","RGEX01",113,0)
 ....... L -^RGHL7(991.1,IEN)
"RTN","RGEX01",114,0)
 K IEN,IEN2,RGDFN,EXCTYP,ICN
"RTN","RGEX01",115,0)
 Q
"RTN","RGEX01",116,0)
PDAT ;
"RTN","RGEX01",117,0)
 K DIRUT
"RTN","RGEX01",118,0)
 W !,"This report prints MPI/PD Data for a selected patient.  The"
"RTN","RGEX01",119,0)
 W !,"information displayed includes the Integration Control Number"
"RTN","RGEX01",120,0)
 W !,"(ICN), Coordinating Master of Record (CMOR), MPI/PD Activity"
"RTN","RGEX01",121,0)
 W !,"Score, Subscription Control Number, Treating Facility list,"
"RTN","RGEX01",122,0)
 W !,"CMOR History and CMOR Change Request History."
"RTN","RGEX01",123,0)
 W !!,"The information is pulled from the Patient (#2) file, Treating"
"RTN","RGEX01",124,0)
 W !,"Facility List (#391.91) file and MPIF CMOR Request (#984.9) file."
"RTN","RGEX01",125,0)
ASK ;Ask for PATIENT
"RTN","RGEX01",126,0)
 I $D(DIRUT) G QUIT
"RTN","RGEX01",127,0)
 W !!,"Patient lookup can be done by Patient Name/SSN or by ICN.",!
"RTN","RGEX01",128,0)
 N DFN,ICN
"RTN","RGEX01",129,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: ",D="SSN^AICN^B^BS^BS5"
"RTN","RGEX01",130,0)
 D MIX^DIC1 K DIC
"RTN","RGEX01",131,0)
 G:Y<0 QUIT
"RTN","RGEX01",132,0)
 S DFN=+Y
"RTN","RGEX01",133,0)
 D MAIN^VAFCPDAT
"RTN","RGEX01",134,0)
 G ASK
"RTN","RGEX01",135,0)
 Q
"RTN","RGEX01",136,0)
QUIT ;
"RTN","RGEX01",137,0)
 K DFN,ICN,D,Y,HOME
"RTN","RGEX03")
0^3^B74365453
"RTN","RGEX03",1,0)
RGEX03 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/13/99
"RTN","RGEX03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23**;30 Apr 99
"RTN","RGEX03",3,0)
 ;
"RTN","RGEX03",4,0)
 ;Reference to START^VAFCPDAT supported by IA #3299
"RTN","RGEX03",5,0)
 ;Reference to ^DIA(2 supported by IA #2097
"RTN","RGEX03",6,0)
 ;Reference to ^DPT( supported by IA #2969
"RTN","RGEX03",7,0)
 ;Reference to HINQ^DG10 supported by IA #2076
"RTN","RGEX03",8,0)
 ;Reference to CIRNEXC^MPIFQ0 supported by IA #2942
"RTN","RGEX03",9,0)
 ;Reference to VTQ^MPIFSAQ supported by IA #2941
"RTN","RGEX03",10,0)
 ;
"RTN","RGEX03",11,0)
EN(DATA) ; -- main entry point for RG EXCPT ACTION
"RTN","RGEX03",12,0)
 D EN^VALM("RG EXCPT ACTION")
"RTN","RGEX03",13,0)
 Q
"RTN","RGEX03",14,0)
 ;
"RTN","RGEX03",15,0)
HDR ; -- header code
"RTN","RGEX03",16,0)
 S VALMHDR(1)="MPI/PD EXCEPTION HANDLING ACTIONS."
"RTN","RGEX03",17,0)
 S VALMHDR(2)=""
"RTN","RGEX03",18,0)
 Q
"RTN","RGEX03",19,0)
 ;
"RTN","RGEX03",20,0)
INIT ; -- init variables and list array
"RTN","RGEX03",21,0)
 K ^TMP("RGEXC2",$J)
"RTN","RGEX03",22,0)
 K @VALMAR
"RTN","RGEX03",23,0)
 I DATA="" Q
"RTN","RGEX03",24,0)
 S STR="",LIN=1,STATUS="",NAME="",DOB="",SSN=""
"RTN","RGEX03",25,0)
 S NAME=$P(DATA,"^",1),DOB=$P(DATA,"^",8),SSN=$P(DATA,"^",2)
"RTN","RGEX03",26,0)
 S STR=$$SETSTR^VALM1("Name:",STR,6,6)
"RTN","RGEX03",27,0)
 S STR=$$SETSTR^VALM1(NAME,STR,14,30)
"RTN","RGEX03",28,0)
 D ADDTMP
"RTN","RGEX03",29,0)
 S STR=$$SETSTR^VALM1(" SSN:",STR,6,6)
"RTN","RGEX03",30,0)
 S STR=$$SETSTR^VALM1(SSN,STR,14,12)
"RTN","RGEX03",31,0)
 D ADDTMP
"RTN","RGEX03",32,0)
 S STR=$$SETSTR^VALM1(" DOB:",STR,6,6)
"RTN","RGEX03",33,0)
 S STR=$$SETSTR^VALM1(DOB,STR,14,20)
"RTN","RGEX03",34,0)
 D ADDTMP
"RTN","RGEX03",35,0)
 S STR=$$SETSTR^VALM1(" DFN:",STR,6,6)
"RTN","RGEX03",36,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",5),STR,14,12)
"RTN","RGEX03",37,0)
 D ADDTMP
"RTN","RGEX03",38,0)
 S STR=$$SETSTR^VALM1(" ICN:",STR,6,6)
"RTN","RGEX03",39,0)
 S ICN="" S ICN=$P(DATA,"^",6) I ICN<0 S ICN=""
"RTN","RGEX03",40,0)
 S STR=$$SETSTR^VALM1(ICN,STR,14,15)
"RTN","RGEX03",41,0)
 D ADDTMP
"RTN","RGEX03",42,0)
 S STR=$$SETSTR^VALM1("Date of Death:",STR,6,20)
"RTN","RGEX03",43,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",13),STR,26,20)
"RTN","RGEX03",44,0)
 D ADDTMP
"RTN","RGEX03",45,0)
 S STR=$$SETSTR^VALM1("Exception Type:",STR,6,20)
"RTN","RGEX03",46,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",4),STR,26,50)
"RTN","RGEX03",47,0)
 D ADDTMP
"RTN","RGEX03",48,0)
 S STR=$$SETSTR^VALM1("Exception Date:",STR,6,20)
"RTN","RGEX03",49,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",3),STR,26,30)
"RTN","RGEX03",50,0)
 D ADDTMP
"RTN","RGEX03",51,0)
 S STATUS=$P(DATA,"^",9)
"RTN","RGEX03",52,0)
 I STATUS<1 S STATUS="NOT PROCESSED"
"RTN","RGEX03",53,0)
 E  S STATUS="PROCESSED"
"RTN","RGEX03",54,0)
 ;S STR=$$SETSTR^VALM1(LIN,STR,2,4)
"RTN","RGEX03",55,0)
 S STR=$$SETSTR^VALM1("Exception Status:",STR,6,20)
"RTN","RGEX03",56,0)
 S STR=$$SETSTR^VALM1(STATUS,STR,26,15)
"RTN","RGEX03",57,0)
 D ADDTMP
"RTN","RGEX03",58,0)
ADDNOTE ;Display Exception Notes, Word Processing field
"RTN","RGEX03",59,0)
 D ADDTMP
"RTN","RGEX03",60,0)
 S STR=$$SETSTR^VALM1("Exception Notes:",STR,6,20)
"RTN","RGEX03",61,0)
 D ADDTMP
"RTN","RGEX03",62,0)
 N IEN,IEN2,IENS,N,NOTE
"RTN","RGEX03",63,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",64,0)
 S IENS=IEN2_","_IEN_","
"RTN","RGEX03",65,0)
 S N=$$GET1^DIQ(991.12,IENS,11,"","NT")
"RTN","RGEX03",66,0)
 S L=0 F  S L=$O(NT(L)) Q:'L  D
"RTN","RGEX03",67,0)
 . S NOTE=NT(L)
"RTN","RGEX03",68,0)
 . S STR=$$SETSTR^VALM1(NOTE,STR,6,74)
"RTN","RGEX03",69,0)
 . D ADDTMP
"RTN","RGEX03",70,0)
 S VALMCNT=LIN-1
"RTN","RGEX03",71,0)
 S DFN=$P(DATA,"^",5)
"RTN","RGEX03",72,0)
 S VAFCDFN=DFN
"RTN","RGEX03",73,0)
 K L,NT
"RTN","RGEX03",74,0)
 Q
"RTN","RGEX03",75,0)
ADDTMP ;
"RTN","RGEX03",76,0)
 S ^TMP("RGEXC2",$J,LIN,0)=STR
"RTN","RGEX03",77,0)
 S ^TMP("RGEXC2",$J,"IDX",LIN,LIN)=""
"RTN","RGEX03",78,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX03",79,0)
 Q
"RTN","RGEX03",80,0)
 ;
"RTN","RGEX03",81,0)
UPD ;
"RTN","RGEX03",82,0)
 W !,"This option updates the exception status to PROCESSED."
"RTN","RGEX03",83,0)
 W !,"After it is processed it will not be listed in the summary."
"RTN","RGEX03",84,0)
 S DIR("A")="Are you sure you want to change the status?"
"RTN","RGEX03",85,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEX03",86,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEX03",87,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",88,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",89,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",90,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",91,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",92,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",93,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",94,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",95,0)
 . D INIT
"RTN","RGEX03",96,0)
 K DIR,DIRUT
"RTN","RGEX03",97,0)
 S VALMBCK="R"
"RTN","RGEX03",98,0)
 Q
"RTN","RGEX03",99,0)
PA ;Patient Audit
"RTN","RGEX03",100,0)
 S PDFN=DFN
"RTN","RGEX03",101,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)) S VALMSG="This patient has no audit data available.",VALMBCK="" G PAQ
"RTN","RGEX03",102,0)
 N IEN S DFN=VAFCDFN,QFLG=1 D FULL^VALM1 D:$T(ASK2^RGMTAUD)]"" ASK2^RGMTAUD S VALMBCK="R"
"RTN","RGEX03",103,0)
 S DFN=PDFN
"RTN","RGEX03",104,0)
 K QFLG,PDFN
"RTN","RGEX03",105,0)
PAQ Q
"RTN","RGEX03",106,0)
HI ;Hinq Inquiry
"RTN","RGEX03",107,0)
 S VALMBCK=""
"RTN","RGEX03",108,0)
 D HINQ^DG10
"RTN","RGEX03",109,0)
 D PAUSE^VALM1
"RTN","RGEX03",110,0)
 S VALMBCK="R"
"RTN","RGEX03",111,0)
 Q
"RTN","RGEX03",112,0)
DISP ; Display Only Query
"RTN","RGEX03",113,0)
 S VALMBCK=""
"RTN","RGEX03",114,0)
 D FULL^VALM1
"RTN","RGEX03",115,0)
 S MPIVAR("DFN")=DFN
"RTN","RGEX03",116,0)
 S MPIVAR("SSN")=SSN
"RTN","RGEX03",117,0)
 S MPIVAR("NM")=NAME
"RTN","RGEX03",118,0)
 S MPIVAR("DOB")=$P($P(DATA,"^",7),".",1)
"RTN","RGEX03",119,0)
 D VTQ^MPIFSAQ(.MPIVAR)
"RTN","RGEX03",120,0)
 D PAUSE^VALM1
"RTN","RGEX03",121,0)
 S VALMBCK="R"
"RTN","RGEX03",122,0)
 K MPIVAR
"RTN","RGEX03",123,0)
 Q
"RTN","RGEX03",124,0)
INTL ; Single Patient Initialization to MPI
"RTN","RGEX03",125,0)
 S VALMBCK="",MPIFRES="",MPIFINT=""
"RTN","RGEX03",126,0)
 D FULL^VALM1
"RTN","RGEX03",127,0)
 D CIRNEXC^MPIFQ0
"RTN","RGEX03",128,0)
 D PAUSE^VALM1
"RTN","RGEX03",129,0)
 K MPIFRES,MPIFINT
"RTN","RGEX03",130,0)
 S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX03",131,0)
 S $P(DATA,"^",6)=$G(ICN)
"RTN","RGEX03",132,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX03",133,0)
 ; If patient has a nation ICN, change status to processed
"RTN","RGEX03",134,0)
 I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX03",135,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",136,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",137,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",138,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",139,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",140,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",141,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",142,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",143,0)
 D INIT
"RTN","RGEX03",144,0)
 S VALMBCK="R"
"RTN","RGEX03",145,0)
 Q
"RTN","RGEX03",146,0)
LOAD ; Edit Patient Data, if patient's eligibility is verified
"RTN","RGEX03",147,0)
 ; check for DG ELIGIBILITY key for user
"RTN","RGEX03",148,0)
 S VALMBCK="",DATAOLD=""
"RTN","RGEX03",149,0)
 D FULL^VALM1
"RTN","RGEX03",150,0)
 D ELIG^VADPT
"RTN","RGEX03",151,0)
 I $P(VAEL(8),"^",1)="V" D
"RTN","RGEX03",152,0)
 . I '$D(^XUSEC("DG ELIGIBILITY",DUZ)) D
"RTN","RGEX03",153,0)
 .. W !!,"Eligibility has been verified for this patient."
"RTN","RGEX03",154,0)
 .. W !!,"You do not have access to edit the Name, Date of "
"RTN","RGEX03",155,0)
 .. W !,"Birth or Social Security Number for this patient."
"RTN","RGEX03",156,0)
 .. D PAUSE^VALM1
"RTN","RGEX03",157,0)
 .. S VALMBCK="R"
"RTN","RGEX03",158,0)
 . E  D SENS
"RTN","RGEX03",159,0)
 E  D SENS
"RTN","RGEX03",160,0)
 Q
"RTN","RGEX03",161,0)
SENS ; check for patient sensitivity and user security
"RTN","RGEX03",162,0)
 N RESULT
"RTN","RGEX03",163,0)
 D PTSEC^DGSEC4(.RESULT,DFN)
"RTN","RGEX03",164,0)
 I RESULT(1)>0 D
"RTN","RGEX03",165,0)
 . I '$D(^XUSEC("DG SENSITIVITY",DUZ)) D
"RTN","RGEX03",166,0)
 .. W !!,"PATIENT MARKED SENSITIVE."
"RTN","RGEX03",167,0)
 .. W !!,"You do not have the proper security to"
"RTN","RGEX03",168,0)
 .. W !,"edit this patient's data."
"RTN","RGEX03",169,0)
 .. D PAUSE^VALM1
"RTN","RGEX03",170,0)
 .. S VALMBCK="R"
"RTN","RGEX03",171,0)
 . E  D EDIT
"RTN","RGEX03",172,0)
 E  D EDIT
"RTN","RGEX03",173,0)
 Q
"RTN","RGEX03",174,0)
EDIT ; edit patient data
"RTN","RGEX03",175,0)
 S ACCESS=0
"RTN","RGEX03",176,0)
 D REC
"RTN","RGEX03",177,0)
 Q:ACCESS=0
"RTN","RGEX03",178,0)
 S DIE="^DPT(",DA=DFN
"RTN","RGEX03",179,0)
 S DR=".01//^S X=NAME;.03//^S X=DOB;.09//^S X=SSN"
"RTN","RGEX03",180,0)
 L +^DPT(DFN):10
"RTN","RGEX03",181,0)
 D ^DIE K DIE,DA,DR
"RTN","RGEX03",182,0)
 L -^DPT(DFN)
"RTN","RGEX03",183,0)
 S DATAOLD=DATA
"RTN","RGEX03",184,0)
 D DEATH
"RTN","RGEX03",185,0)
 D DEM^VADPT
"RTN","RGEX03",186,0)
 S DATA=VADM(1)_"^"_$P($G(VADM(2)),"^",1)_"^"_$P(DATAOLD,"^",3)_"^"_$P(DATAOLD,"^",4)_"^"_DFN_"^"_$P(DATAOLD,"^",6)_"^"
"RTN","RGEX03",187,0)
 S DATA=DATA_$G(VADM(3))_"^"_$P(DATAOLD,"^",9)_"^"_$P(DATAOLD,"^",10)_"^"_$P(DATAOLD,"^",11)_"^"_$P(DATAOLD,"^",12)_"^"_$P($G(VADM(6)),"^",2)
"RTN","RGEX03",188,0)
 D INIT
"RTN","RGEX03",189,0)
 S VALMBCK="R"
"RTN","RGEX03",190,0)
 K DGNEW,DATAOLD,VAEL,ACCESS,DGNPSSN
"RTN","RGEX03",191,0)
QUIT Q
"RTN","RGEX03",192,0)
REC ; Check if user is attempting to access own record
"RTN","RGEX03",193,0)
 ; check for security key
"RTN","RGEX03",194,0)
 I $D(^XUSEC("DG RECORD ACCESS",+DUZ)) S ACCESS=1 Q
"RTN","RGEX03",195,0)
 S DGNPSSN=$$GET1^DIQ(200,+DUZ_",",9,"I","","DGNPERR")
"RTN","RGEX03",196,0)
 I 'DGNPSSN D  Q
"RTN","RGEX03",197,0)
 . W !!,"Your SSN is missing from the NEW PERSON file."
"RTN","RGEX03",198,0)
 . W !,"Contact your ADP Coordinator."
"RTN","RGEX03",199,0)
 . D PAUSE^VALM1
"RTN","RGEX03",200,0)
 . S VALMBCK="R"
"RTN","RGEX03",201,0)
 I DGNPSSN=SSN D  Q
"RTN","RGEX03",202,0)
 . W !!,"Security regulations prohibit computer access to your"
"RTN","RGEX03",203,0)
 . W !,"own medical record."
"RTN","RGEX03",204,0)
 . D PAUSE^VALM1
"RTN","RGEX03",205,0)
 . S VALMBCK="R"
"RTN","RGEX03",206,0)
 E  S ACCESS=1
"RTN","RGEX03",207,0)
 Q
"RTN","RGEX03",208,0)
DEATH ; Check for access to edit date of death
"RTN","RGEX03",209,0)
 I $D(^XUSEC("DG DETAIL",+DUZ)) D
"RTN","RGEX03",210,0)
 . K VADM,DIE,DA,DR
"RTN","RGEX03",211,0)
 . S DOD=""
"RTN","RGEX03",212,0)
 . D DEM^VADPT S DOD=$P($G(VADM(6)),"^",2)
"RTN","RGEX03",213,0)
 . S DIE="^DPT(",DA=DFN,DR=".351//^S X=DOD"
"RTN","RGEX03",214,0)
 . L +^DPT(DFN):10
"RTN","RGEX03",215,0)
 . D ^DIE
"RTN","RGEX03",216,0)
 . L -^DPT(DFN)
"RTN","RGEX03",217,0)
 E  W !!,"You do not have the proper security to edit date of death." D PAUSE^VALM1 D INIT S VALMBCK="R"
"RTN","RGEX03",218,0)
 K VADM,DIE,DA,DR,DOD
"RTN","RGEX03",219,0)
 Q
"RTN","RGEX03",220,0)
INQ ; Patient Inquiry
"RTN","RGEX03",221,0)
 S VALMBCK=""
"RTN","RGEX03",222,0)
 D FULL^VALM1
"RTN","RGEX03",223,0)
 D EN^DGRPD
"RTN","RGEX03",224,0)
 D PAUSE^VALM1
"RTN","RGEX03",225,0)
 D CLEAN^VALM10
"RTN","RGEX03",226,0)
 D INIT
"RTN","RGEX03",227,0)
 S VALMBCK="R"
"RTN","RGEX03",228,0)
 Q
"RTN","RGEX03",229,0)
EDTNOT ; Edit Exception Notes
"RTN","RGEX03",230,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",231,0)
 L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",232,0)
 S DIE="^RGHL7(991.1,"_IEN_",1,",DA(1)=IEN,DA=IEN2,DR="11"
"RTN","RGEX03",233,0)
 D ^DIE
"RTN","RGEX03",234,0)
 L -^RGHL7(991.1,IEN)
"RTN","RGEX03",235,0)
 K DIE,DA,DR,IEN,IEN2
"RTN","RGEX03",236,0)
 D INIT
"RTN","RGEX03",237,0)
 S VALMBCK="R"
"RTN","RGEX03",238,0)
 Q
"RTN","RGEX03",239,0)
PDAT S VALMBCK="",PICN="",PSSN=""
"RTN","RGEX03",240,0)
 I $D(SSN) S PSSN=SSN
"RTN","RGEX03",241,0)
 S ARRAY="^TMP(""RGXHFS"","_$J_")",TYPE="I",REP=1
"RTN","RGEX03",242,0)
 S RGXDIR=$$GET^XPAR("SYS","RGX HFS SCRATCH")
"RTN","RGEX03",243,0)
 S RGXFILE="RGX"_DUZ_".DAT"
"RTN","RGEX03",244,0)
 S IOM=132,IOSL=99999,IOST="P-DUMMY",IOF=""""""
"RTN","RGEX03",245,0)
 D OPEN^%ZISH("RGX",RGXDIR,RGXFILE,"W") Q:POP
"RTN","RGEX03",246,0)
 U IO
"RTN","RGEX03",247,0)
 I ICN'="" S PICN=ICN D START^VAFCPDAT
"RTN","RGEX03",248,0)
 N RGXDEL
"RTN","RGEX03",249,0)
 D CLOSE^%ZISH("RGX")
"RTN","RGEX03",250,0)
 K ^TMP("RGPDAT",$J)
"RTN","RGEX03",251,0)
 S RGXDEL(RGXFILE)=""
"RTN","RGEX03",252,0)
 S X=$$FTG^%ZISH(RGXDIR,RGXFILE,$NAME(^TMP("RGPDAT",$J,1)),3)
"RTN","RGEX03",253,0)
 S X=$$DEL^%ZISH(RGXDIR,$NA(RGXDEL))
"RTN","RGEX03",254,0)
 I $D(^TMP("RGPDAT",$J)) D EN^RGEX04
"RTN","RGEX03",255,0)
 S ICN=PICN,SSN=PSSN
"RTN","RGEX03",256,0)
 D INIT
"RTN","RGEX03",257,0)
 S VALMBCK="R"
"RTN","RGEX03",258,0)
 K PICN,PSSN,ARRAY,REP,RGXDIR,RGXFILE,TYPE
"RTN","RGEX03",259,0)
 Q
"RTN","RGEX03",260,0)
GETEX(RETURN,DFN) ; Get array of pending exceptions for a patient
"RTN","RGEX03",261,0)
 K RETURN
"RTN","RGEX03",262,0)
 S CNT=0,RETURN(0)="0^No Pending Exceptions",TYP=""
"RTN","RGEX03",263,0)
 I 'DFN S RETURN(0)="-1^DFN not passed" G QGET
"RTN","RGEX03",264,0)
 F  S TYP=$O(^RGHL7(991.1,"ADFN",TYP)) Q:'TYP  D
"RTN","RGEX03",265,0)
 . I $D(^RGHL7(991.1,"ADFN",TYP,DFN)) D
"RTN","RGEX03",266,0)
 .. S IEN="" F  S IEN=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEX03",267,0)
 ... S IEN2="",ETYP="" F  S IEN2=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX03",268,0)
 .... I $P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5)<1 D
"RTN","RGEX03",269,0)
 ..... S CNT=CNT+1,ETYP=$P(^RGHL7(991.11,TYP,10),"^",1)
"RTN","RGEX03",270,0)
 ..... S RETURN(CNT)=ETYP_"^"_IEN_"^"_IEN2
"RTN","RGEX03",271,0)
 I CNT>0 S RETURN(0)=CNT_"^Pending Exception(s)"
"RTN","RGEX03",272,0)
QGET ;
"RTN","RGEX03",273,0)
 K TYP,ETYP,IEN,IEN2,CNT
"RTN","RGEX03",274,0)
 Q
"RTN","RGEX03",275,0)
HELP ; -- help code
"RTN","RGEX03",276,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX03",277,0)
 Q
"RTN","RGEX03",278,0)
 ;
"RTN","RGEX03",279,0)
EXIT ; -- exit code
"RTN","RGEX03",280,0)
 S VALMBCK=""
"RTN","RGEX03",281,0)
 K ^TMP("RGEXC2",$J),DFN,DIR,IEN,IEN2,NAME,DOB,SSN,LIN,STATUS,STR,VAFCDFN,X,Y
"RTN","RGEX03",282,0)
 S VALMBCK="R",RGBG=1
"RTN","RGEX03",283,0)
 Q
"RTN","RGEX03",284,0)
 ;
"RTN","RGEX03",285,0)
EXPND ; -- expand code
"RTN","RGEX03",286,0)
 Q
"RTN","RGEX03",287,0)
 ;
"RTN","RGEX04")
0^4^B5258578
"RTN","RGEX04",1,0)
RGEX04 ;BAY/ALS-LIST MANAGER ROUTINE FOR MPI/PD EXCEPTION PDAT QUERY ;10/31/01
"RTN","RGEX04",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**23**;30 Apr 99
"RTN","RGEX04",3,0)
EN ;main entry point for RG EXCPT PDAT
"RTN","RGEX04",4,0)
 D EN^VALM("RG EXCPT PDAT")
"RTN","RGEX04",5,0)
 Q
"RTN","RGEX04",6,0)
HDR ; header code
"RTN","RGEX04",7,0)
 S VALMHDR(1)="MPI/PD PATIENT DATA"
"RTN","RGEX04",8,0)
 S VALMHDR(2)=""
"RTN","RGEX04",9,0)
 Q
"RTN","RGEX04",10,0)
INIT ;
"RTN","RGEX04",11,0)
 K ^TMP("RGEXC4",$J)
"RTN","RGEX04",12,0)
 K @VALMAR
"RTN","RGEX04",13,0)
 ;I '$D(ICN) G EXIT
"RTN","RGEX04",14,0)
 I '$D(^TMP("RGPDAT",$J)) G EXIT
"RTN","RGEX04",15,0)
 S LIN=1,X=0,STR="",TXT=""
"RTN","RGEX04",16,0)
 F  S X=$O(^TMP("RGPDAT",$J,X)) Q:'X  D
"RTN","RGEX04",17,0)
 . S TXT=^TMP("RGPDAT",$J,X)
"RTN","RGEX04",18,0)
 . I $E(TXT,1,12)'="Enter RETURN" D
"RTN","RGEX04",19,0)
 .. S STR=$$SETSTR^VALM1(TXT,STR,2,78)
"RTN","RGEX04",20,0)
 .. D ADDTMP
"RTN","RGEX04",21,0)
 S VALMCNT=LIN-1
"RTN","RGEX04",22,0)
 Q
"RTN","RGEX04",23,0)
ADDTMP ;
"RTN","RGEX04",24,0)
 S ^TMP("RGEXC4",$J,LIN,0)=STR
"RTN","RGEX04",25,0)
 S ^TMP("RGEXC4",$J,"IDX",LIN,LIN)=""
"RTN","RGEX04",26,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX04",27,0)
 Q
"RTN","RGEX04",28,0)
RSEND ;Send remote PDAT Query
"RTN","RGEX04",29,0)
 S VALMBCK="",RICN=ICN
"RTN","RGEX04",30,0)
 D FULL^VALM1
"RTN","RGEX04",31,0)
 D SEND^RGRPDAT
"RTN","RGEX04",32,0)
 D PAUSE^VALM1
"RTN","RGEX04",33,0)
 S ICN=RICN
"RTN","RGEX04",34,0)
 D INIT
"RTN","RGEX04",35,0)
 S VALMBCK="R"
"RTN","RGEX04",36,0)
 Q
"RTN","RGEX04",37,0)
RCHK ;Check remote PDAT Query
"RTN","RGEX04",38,0)
 S VALMBCK="",RICN=ICN
"RTN","RGEX04",39,0)
 D FULL^VALM1
"RTN","RGEX04",40,0)
 D CHKSTAT^RGRPDAT
"RTN","RGEX04",41,0)
 D PAUSE^VALM1
"RTN","RGEX04",42,0)
 S ICN=RICN
"RTN","RGEX04",43,0)
 D INIT
"RTN","RGEX04",44,0)
 S VALMBCK="R"
"RTN","RGEX04",45,0)
 Q
"RTN","RGEX04",46,0)
RDISP ;Display remote PDAT Query
"RTN","RGEX04",47,0)
 S VALMBCK="",RICN=ICN
"RTN","RGEX04",48,0)
 D FULL^VALM1
"RTN","RGEX04",49,0)
 W !!,"Display data returned from remote patient data queries."
"RTN","RGEX04",50,0)
 S TFL="",L="",Y="",ICNARR="",STATUS=""
"RTN","RGEX04",51,0)
 I '$D(^XTMP("RGPDAT"_ICN)) W !!,"No remote query sent for this patient. " Q
"RTN","RGEX04",52,0)
 D GETTFL^RGRPDAT(ICN,.TFL)
"RTN","RGEX04",53,0)
 W !!,"-> For ICN ",$P(ICN,"V",1),!
"RTN","RGEX04",54,0)
 I $D(TFL(0)) D
"RTN","RGEX04",55,0)
 . S X=0 F  S X=$O(TFL(X)) Q:'X  I '$D(^XTMP("RGPDAT"_ICN,X)) K TFL(X)
"RTN","RGEX04",56,0)
 D SELTF^RGRPDAT
"RTN","RGEX04",57,0)
 I '$D(TFARR) W !,"No remote query sent for this patient." G QRD
"RTN","RGEX04",58,0)
 I ((Y="")!(Y="^")) G QRD
"RTN","RGEX04",59,0)
 D PAUSE^VALM1
"RTN","RGEX04",60,0)
 D EN^RGEX05(RICN)
"RTN","RGEX04",61,0)
QRD D PAUSE^VALM1
"RTN","RGEX04",62,0)
 S ICN=RICN
"RTN","RGEX04",63,0)
 D INIT
"RTN","RGEX04",64,0)
 S VALMBCK="R"
"RTN","RGEX04",65,0)
 Q
"RTN","RGEX04",66,0)
HELP ;
"RTN","RGEX04",67,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX04",68,0)
 Q
"RTN","RGEX04",69,0)
EXIT ;
"RTN","RGEX04",70,0)
 S VALMBCK=""
"RTN","RGEX04",71,0)
 K ^TMP("RGEXC4",$J),LIN,X,STR,TXT,RICN,Y,STATUS,TFL,TFARR,L,ICNARR
"RTN","RGEX04",72,0)
 S VALMBCK="R"
"RTN","RGEX04",73,0)
 Q
"RTN","RGEX05")
0^5^B5703462
"RTN","RGEX05",1,0)
RGEX05 ;BAY/ALS-LISTMANAGER ROUTINE FOR REMOTE PDAT IN EXCEPTION HANDLER ;10/04/01
"RTN","RGEX05",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**23**;30 Apr 99
"RTN","RGEX05",3,0)
 ;Reference to RPCCHK^XWB2HL7 supported by IA #3144
"RTN","RGEX05",4,0)
 ;Reference to RTNDATA^XWBDRPC supported by IA #3149
"RTN","RGEX05",5,0)
EN(ICN) ;main entry point for RG EXCPT REMOTE PDAT
"RTN","RGEX05",6,0)
 D EN^VALM("RG EXCPT RPDAT")
"RTN","RGEX05",7,0)
 Q
"RTN","RGEX05",8,0)
HDR ;header code
"RTN","RGEX05",9,0)
 S VALMHDR(1)="MPI/PD REMOTE PATIENT DATA"
"RTN","RGEX05",10,0)
 S VALMHDR(2)=""
"RTN","RGEX05",11,0)
 Q
"RTN","RGEX05",12,0)
INIT ;
"RTN","RGEX05",13,0)
 K ^TMP("RGEXC5",$J)
"RTN","RGEX05",14,0)
 K @VALMAR
"RTN","RGEX05",15,0)
 I '$D(ICN) G EXIT
"RTN","RGEX05",16,0)
 S LIN=1,X=0,STR="",TXT=""
"RTN","RGEX05",17,0)
 S TXT="-> For ICN "_$P(ICN,"V",1) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","RGEX05",18,0)
 S L=0 F  S L=$O(TFARR(L)) Q:'L  D
"RTN","RGEX05",19,0)
 . S SL=$P(TFARR(L),"^",1)
"RTN","RGEX05",20,0)
 . S STATUS=$P(TFL(SL),"^",3)
"RTN","RGEX05",21,0)
 . I STATUS["Handle" S STATUS="Error in Process"
"RTN","RGEX05",22,0)
 . E  I STATUS["New" S STATUS="Request Sent"
"RTN","RGEX05",23,0)
 . E  I STATUS["Running" S STATUS="Awaiting Response"
"RTN","RGEX05",24,0)
 . E  I STATUS["Done" S STATUS="Response Received"
"RTN","RGEX05",25,0)
 . S TXT="  "_$P(TFL(SL),"^")_"  status: ("_STATUS_")"
"RTN","RGEX05",26,0)
 . D ADDTMP
"RTN","RGEX05",27,0)
 . S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP D
"RTN","RGEX05",28,0)
 . S LOC=$P(TFL(SL),"^",2)
"RTN","RGEX05",29,0)
 . N STATUS,RETURN,RESULT,RET,RESULT
"RTN","RGEX05",30,0)
 . I '$D(^XTMP("RGPDAT"_ICN,0)) S TXT=" - No patient data query exists for this patient." S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","RGEX05",31,0)
 . I $D(^XTMP("RGPDAT"_ICN,LOC,0)) D
"RTN","RGEX05",32,0)
 .. S RETURN(0)=$P(^XTMP("RGPDAT"_ICN,LOC,0),"^")
"RTN","RGEX05",33,0)
 .. D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D
"RTN","RGEX05",34,0)
 ... D RTNDATA^XWBDRPC(.RET,RETURN(0)) D
"RTN","RGEX05",35,0)
 ... S R=0 F  S R=$O(RET(R)) Q:'R  S TXT=RET(R) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","RGEX05",36,0)
 .. I $D(RET(0)) I RET(0)<0 S TXT="No Data Returned Due To: "_$P(RET(0),"^",2) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","RGEX05",37,0)
 K ICNARR,R,L,SL,LOC
"RTN","RGEX05",38,0)
 S VALMCNT=LIN-1
"RTN","RGEX05",39,0)
 Q
"RTN","RGEX05",40,0)
ADDTMP ;
"RTN","RGEX05",41,0)
 S ^TMP("RGEXC5",$J,LIN,0)=STR
"RTN","RGEX05",42,0)
 S ^TMP("RGEXC5",$J,"IDX",LIN,LIN)=""
"RTN","RGEX05",43,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX05",44,0)
 Q
"RTN","RGEX05",45,0)
HELP ;
"RTN","RGEX05",46,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX05",47,0)
 Q
"RTN","RGEX05",48,0)
EXIT ;
"RTN","RGEX05",49,0)
 S VALMBCK=""
"RTN","RGEX05",50,0)
 K ^TMP("RGEXC4",$J),LIN,X,STR,TXT
"RTN","RGEX05",51,0)
 S VALMBCK="R"
"RTN","RGEX05",52,0)
 Q
"RTN","RGEXHND1")
0^8^B35335138
"RTN","RGEXHND1",1,0)
RGEXHND1 ;BAY/ALS-MPI/PD EXCEPTION HANDLING UTILITY ;10/08/99
"RTN","RGEXHND1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23**;30 Apr 99
"RTN","RGEXHND1",3,0)
DTLIST ;List exceptions by date
"RTN","RGEXHND1",4,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",5,0)
 S EXCDT="",EXCTYP="",CNT=0
"RTN","RGEXHND1",6,0)
 I '$D(RGBG) S VALMBG=1
"RTN","RGEXHND1",7,0)
 F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEXHND1",8,0)
 . S IEN=0
"RTN","RGEXHND1",9,0)
 . F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEXHND1",10,0)
 .. S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1  D
"RTN","RGEXHND1",11,0)
 ... S IEN2=0
"RTN","RGEXHND1",12,0)
 ... F  S IEN2=$O(^RGHL7(991.1,IEN,1,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",13,0)
 .... S EXCTYP=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",3)
"RTN","RGEXHND1",14,0)
 .... I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D ADDREC
"RTN","RGEXHND1",15,0)
 K I,NUM,EXCDT,EXCTYP,RGBG
"RTN","RGEXHND1",16,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",17,0)
 Q
"RTN","RGEXHND1",18,0)
NDATA ; There is no data matching the criteria
"RTN","RGEXHND1",19,0)
 S CNT=CNT+1,STRING=""
"RTN","RGEXHND1",20,0)
 S STRING=$$SETSTR^VALM1("There were no exceptions found.",STRING,5,35)
"RTN","RGEXHND1",21,0)
 S ^TMP("RGEXC",$J,CNT,0)=STRING
"RTN","RGEXHND1",22,0)
 S ^TMP("RGEXC",$J,"IDX",CNT,CNT)=""
"RTN","RGEXHND1",23,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",24,0)
 Q
"RTN","RGEXHND1",25,0)
EXCLST ;List exceptions by type
"RTN","RGEXHND1",26,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",27,0)
 S CNT=0,EXCDT="",EXCTYP=""
"RTN","RGEXHND1",28,0)
 I '$D(RGBG) S VALMBG=1
"RTN","RGEXHND1",29,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",30,0)
 . I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGEXHND1",31,0)
 .. S IEN=0
"RTN","RGEXHND1",32,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",33,0)
 ... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1  D
"RTN","RGEXHND1",34,0)
 .... S IEN2=0
"RTN","RGEXHND1",35,0)
 .... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",36,0)
 ..... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT
"RTN","RGEXHND1",37,0)
 ..... D ADDREC
"RTN","RGEXHND1",38,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",39,0)
 K RGBG
"RTN","RGEXHND1",40,0)
 Q
"RTN","RGEXHND1",41,0)
PATLST ;List exceptions by patient
"RTN","RGEXHND1",42,0)
 K ^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEXHND1",43,0)
 S CNT=0,EXCDT="",EXCTYP="",NDX=0,NAME=""
"RTN","RGEXHND1",44,0)
 I '$D(RGBG) S VALMBG=1
"RTN","RGEXHND1",45,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",46,0)
 . I EXCTYP=(209)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGEXHND1",47,0)
 .. S DFN=""
"RTN","RGEXHND1",48,0)
 .. F  S DFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN)) Q:'DFN  D
"RTN","RGEXHND1",49,0)
 ... S IEN=0
"RTN","RGEXHND1",50,0)
 ... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEXHND1",51,0)
 .... S IEN2=0
"RTN","RGEXHND1",52,0)
 .... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",53,0)
 ..... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT
"RTN","RGEXHND1",54,0)
 ..... D DEM^VADPT S NAME=VADM(1) Q:NAME=""
"RTN","RGEXHND1",55,0)
 ..... S NDX=NDX+1
"RTN","RGEXHND1",56,0)
 ..... S ^TMP("RGEX01",$J,NAME,NDX)=$G(VADM(1))_"^"_IEN_"^"_IEN2_"^"_EXCTYP_"^"_EXCDT
"RTN","RGEXHND1",57,0)
 D PATTMP
"RTN","RGEXHND1",58,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",59,0)
 K DFN,RGBG
"RTN","RGEXHND1",60,0)
 Q
"RTN","RGEXHND1",61,0)
PATTMP ;
"RTN","RGEXHND1",62,0)
 S NM=""
"RTN","RGEXHND1",63,0)
 F  S NM=$O(^TMP("RGEX01",$J,NM)) Q:NM=""  D
"RTN","RGEXHND1",64,0)
 . S NDX=0
"RTN","RGEXHND1",65,0)
 . F  S NDX=$O(^TMP("RGEX01",$J,NM,NDX)) Q:'NDX  D
"RTN","RGEXHND1",66,0)
 .. S IEN=$P(^TMP("RGEX01",$J,NM,NDX),"^",2)
"RTN","RGEXHND1",67,0)
 .. S IEN2=$P(^TMP("RGEX01",$J,NM,NDX),"^",3)
"RTN","RGEXHND1",68,0)
 .. S EXCTYP=$P(^TMP("RGEX01",$J,NM,NDX),"^",4)
"RTN","RGEXHND1",69,0)
 .. S EXCDT=$P(^TMP("RGEX01",$J,NM,NDX),"^",5)
"RTN","RGEXHND1",70,0)
 .. D ADDREC
"RTN","RGEXHND1",71,0)
 K NDX,NM,NAME
"RTN","RGEXHND1",72,0)
 Q
"RTN","RGEXHND1",73,0)
SELTYP ; List all exceptions of type selected by user
"RTN","RGEXHND1",74,0)
 S EXCTYPE="",FLAG=0,ETYPE=""
"RTN","RGEXHND1",75,0)
 I '$D(RGBG) S VALMBG=1
"RTN","RGEXHND1",76,0)
 K DIR,Y,DIC
"RTN","RGEXHND1",77,0)
 S DIR("A")="Enter an exception type to view: "
"RTN","RGEXHND1",78,0)
 ;S DIR(0)="PM^991.11:QAM"
"RTN","RGEXHND1",79,0)
 S DIR(0)="SAM^209:Required field(s) DOB or Name Missing;213:SSN Match Failed;214:Name Doesn't Match;215:Death Entry on MPI not VISTA;216:Death Entry on Vista not MPI;217:Death Entries on MPI and Vista DON'T MATCH;218:Potential Matches Returned"
"RTN","RGEXHND1",80,0)
 S DIR("?")="^D HLPSEL^RGEXHND1"
"RTN","RGEXHND1",81,0)
 D ^DIR
"RTN","RGEXHND1",82,0)
 I Y<1 S RGSORT="SD" D SORT^RGEX01  Q
"RTN","RGEXHND1",83,0)
 Q:$D(DUOUT)!$D(DTOUT)
"RTN","RGEXHND1",84,0)
 S EXCTYPE=+Y,ETYPE=$P(^RGHL7(991.11,EXCTYPE,10),"^",1)
"RTN","RGEXHND1",85,0)
 I EXCTYPE=(209)!((EXCTYPE>212)&(EXCTYPE<219)) S FLAG=1
"RTN","RGEXHND1",86,0)
 I FLAG=1 D ADDSEL
"RTN","RGEXHND1",87,0)
 E  I FLAG=0 D
"RTN","RGEXHND1",88,0)
 . W !,"Not a valid selection."
"RTN","RGEXHND1",89,0)
 . D SELTYP
"RTN","RGEXHND1",90,0)
 K FLAG,Y,DIR,DIC,DTOUT,DUOUT,RGBG
"RTN","RGEXHND1",91,0)
 Q
"RTN","RGEXHND1",92,0)
ADDSEL ;called by SELTYP
"RTN","RGEXHND1",93,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",94,0)
 S CNT=0,EXCDT="",EXCTYP=""
"RTN","RGEXHND1",95,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",96,0)
 . I EXCTYP=EXCTYPE D
"RTN","RGEXHND1",97,0)
 .. S IEN=0
"RTN","RGEXHND1",98,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",99,0)
 ... S IEN2=0
"RTN","RGEXHND1",100,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",101,0)
 .... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3)
"RTN","RGEXHND1",102,0)
 .... D ADDREC
"RTN","RGEXHND1",103,0)
 I CNT<1 D
"RTN","RGEXHND1",104,0)
 . W !,"There are no "_ETYPE
"RTN","RGEXHND1",105,0)
 . W !,"exceptions that need processing."
"RTN","RGEXHND1",106,0)
 . D SELTYP
"RTN","RGEXHND1",107,0)
 Q
"RTN","RGEXHND1",108,0)
HLPSEL ;
"RTN","RGEXHND1",109,0)
 D FULL^VALM1
"RTN","RGEXHND1",110,0)
 ;W !,"The following exception types are handled by this option:"
"RTN","RGEXHND1",111,0)
 ;W !!,"Required field(s) Date of Birth or Name missing",?50,"(209)"
"RTN","RGEXHND1",112,0)
 ;W !,"SSN Match Failed",?50,"(213)"
"RTN","RGEXHND1",113,0)
 ;W !,"Name Doesn't Match",?50,"(214)"
"RTN","RGEXHND1",114,0)
 ;W !,"Death Entry on MPI not in VISTA",?50,"(215)"
"RTN","RGEXHND1",115,0)
 ;W !,"Death Entry on Vista not in MPI",?50,"(216)"
"RTN","RGEXHND1",116,0)
 ;W !,"Death Entries on MPI and Vista DO NOT MATCH",?50,"(217)"
"RTN","RGEXHND1",117,0)
 ;W !,"Potential Matches Returned",?50,"(218)"
"RTN","RGEXHND1",118,0)
 S VALMBCK="R"
"RTN","RGEXHND1",119,0)
 Q
"RTN","RGEXHND1",120,0)
ADDREC ;
"RTN","RGEXHND1",121,0)
 S ETEXT="",RGDFN="",ICN="",RGNM="",STAT="",DOD=""
"RTN","RGEXHND1",122,0)
 S ETEXT=$P($G(^RGHL7(991.11,EXCTYP,10)),"^",1)
"RTN","RGEXHND1",123,0)
 S RGDFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'RGDFN
"RTN","RGEXHND1",124,0)
 S STAT=$P($G(^RGHL7(991.1,IEN,1,IEN2,0)),"^",5)
"RTN","RGEXHND1",125,0)
 S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEXHND1",126,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEXHND1",127,0)
 I (STAT<1)!(STAT="") DO
"RTN","RGEXHND1",128,0)
 .;Only list exceptions that are Not Processed
"RTN","RGEXHND1",129,0)
 .; only list patients with local ICN
"RTN","RGEXHND1",130,0)
 . I $E(ICN,1,3)=$E($P(HOME,"^",3),1,3)!(ICN<0)!((EXCTYP<218)&(EXCTYP>214)) D
"RTN","RGEXHND1",131,0)
 .. S DFN=RGDFN D DEM^VADPT
"RTN","RGEXHND1",132,0)
 .. S RGNM=VADM(1)
"RTN","RGEXHND1",133,0)
 .. S RGSSN=$P($G(VADM(2)),"^",1)
"RTN","RGEXHND1",134,0)
 .. S DOB=$G(VADM(3)) I DOB="" S DOB="^"
"RTN","RGEXHND1",135,0)
 .. S DOD=$P($P($G(VADM(6)),"^",2),"@",1)
"RTN","RGEXHND1",136,0)
 .. S EXDATE=$P($$FMTE^XLFDT(EXCDT,2),"@",1)
"RTN","RGEXHND1",137,0)
 .. S CNT=CNT+1
"RTN","RGEXHND1",138,0)
 .. S STRING=""
"RTN","RGEXHND1",139,0)
 .. I ICN<0 S ICN=""
"RTN","RGEXHND1",140,0)
 .. S STRING=$$SETSTR^VALM1(CNT,STRING,1,4)
"RTN","RGEXHND1",141,0)
 .. S STRING=$$SETSTR^VALM1($E(RGNM,1,22),STRING,6,21)
"RTN","RGEXHND1",142,0)
 .. S STRING=$$SETSTR^VALM1(RGSSN,STRING,28,10)
"RTN","RGEXHND1",143,0)
 .. S STRING=$$SETSTR^VALM1(EXDATE,STRING,39,8)
"RTN","RGEXHND1",144,0)
 .. S STRING=$$SETSTR^VALM1(ETEXT,STRING,49,32)
"RTN","RGEXHND1",145,0)
 .. S ^TMP("RGEXC",$J,CNT,0)=STRING
"RTN","RGEXHND1",146,0)
 .. S ^TMP("RGEXC",$J,"IDX",CNT,CNT)=""
"RTN","RGEXHND1",147,0)
 .. S ^TMP("RGEXC",$J,CNT,"DATA")=RGNM_"^"_RGSSN_"^"_$P($$FMTE^XLFDT(EXCDT),"@",1)_"^"_ETEXT_"^"_DFN_"^"_ICN_"^"_DOB_"^"_STAT_"^"_IEN_"^"_IEN2_"^"_CNT_"^"_DOD
"RTN","RGEXHND1",148,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",149,0)
 K RGDFN,RGNM,RGSSN,EXDATE,ETEXT,ICN,DOB,STAT,VADM,HOME,STRING,DOD
"RTN","RGEXHND1",150,0)
 Q
"RTN","RGEXHND1",151,0)
SELECT ;
"RTN","RGEXHND1",152,0)
 I $G(STRING)["no exceptions found" D SORT^RGEX01  Q
"RTN","RGEXHND1",153,0)
 N VALMY
"RTN","RGEXHND1",154,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","RGEXHND1",155,0)
 I '$D(VALMY) Q
"RTN","RGEXHND1",156,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",157,0)
 S DATA="",CNT=""
"RTN","RGEXHND1",158,0)
 S CNT=$O(VALMY(0))
"RTN","RGEXHND1",159,0)
 S DATA=$G(^TMP("RGEXC",$J,CNT,"DATA"))
"RTN","RGEXHND1",160,0)
 I '$D(DATA) S CNT=0 Q
"RTN","RGEXHND1",161,0)
 D CLEAN^VALM10
"RTN","RGEXHND1",162,0)
 D EN^RGEX03(DATA)
"RTN","RGEXHND1",163,0)
 I RGSORT="VT" D
"RTN","RGEXHND1",164,0)
 . K @VALMAR
"RTN","RGEXHND1",165,0)
 . D ADDSEL
"RTN","RGEXHND1",166,0)
 E  I RGSORT'="VT" D SORT^RGEX01
"RTN","RGEXHND1",167,0)
 ;
"RTN","RGEXHND1",168,0)
 Q
"RTN","RGEXHND1",169,0)
QUIT ;
"RTN","RGMTHL2")
0^9^B28076092
"RTN","RGMTHL2",1,0)
RGMTHL2 ;BIR/CML-COMPILE MPI/PD HL7 DATA FOR BI-DIRECTIONAL TCP ;11/15/01
"RTN","RGMTHL2",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**21,23**;30 Apr 99
"RTN","RGMTHL2",3,0)
 ;
"RTN","RGMTHL2",4,0)
 ;Reference to ^ORD(101 supported by IA #2596
"RTN","RGMTHL2",5,0)
 ;Reference to ^HL(772 supported by IA #3464
"RTN","RGMTHL2",6,0)
 ;Reference to ^HL(771.6 supported by IA #2507
"RTN","RGMTHL2",7,0)
 ;Reference to ^HLMA( supported by IA #3273
"RTN","RGMTHL2",8,0)
 ;
"RTN","RGMTHL2",9,0)
 ;Check to see if the ^XTMP global is present and/or complete
"RTN","RGMTHL2",10,0)
 W @IOF
"RTN","RGMTHL2",11,0)
 W !,"This utility searches the HL7 MESSAGE TEXT (#772) file for a selected"
"RTN","RGMTHL2",12,0)
 W !,"date range.  Each HL7 message in the date range is examined.  If the"
"RTN","RGMTHL2",13,0)
 W !,"RELATED EVENT PROTOCOL field contains the MPI/PD protocols (e.g., ""VAF"","
"RTN","RGMTHL2",14,0)
 W !,"""RG"", or ""MPI"") data is compiled into the ^XTMP(""RGMT"",""HL"" array."
"RTN","RGMTHL2",15,0)
 W !!,"A cross-reference is built on patient ICN and DFN for faster data retrieval"
"RTN","RGMTHL2",16,0)
 W !,"for the associated reports."
"RTN","RGMTHL2",17,0)
 ;
"RTN","RGMTHL2",18,0)
 G:'$D(^XTMP("RGMT","HL")) BEGIN
"RTN","RGMTHL2",19,0)
 I '$D(^XTMP("RGMT","HL","@@@@","STOPPED")) D
"RTN","RGMTHL2",20,0)
 .W !!,$C(7),"The Compile MPI/PD HL7 Data compilation is already running!" G QUIT
"RTN","RGMTHL2",21,0)
 S CDT=$$FMTE^XLFDT($E(+^XTMP("RGMT","HL","@@@@","STOPPED"),1,12))
"RTN","RGMTHL2",22,0)
 W !!,"=> ""Compile MPI/PD HL7 Data"" last ran to completion on "_CDT_".",!
"RTN","RGMTHL2",23,0)
 I $D(^XTMP("RGMT","HL","@@@@","RANGE")) D
"RTN","RGMTHL2",24,0)
 .W !,"=> Data has been compiled for ",^XTMP("RGMT","HL","@@@@","RANGE"),"."
"RTN","RGMTHL2",25,0)
 W ! K DIR S DIR(0)="SMB^D:DELETE;A:APPEND"
"RTN","RGMTHL2",26,0)
 S DIR("A",1)="Do you want to:"
"RTN","RGMTHL2",27,0)
 S DIR("A",2)="(D)elete existing data and recompile."
"RTN","RGMTHL2",28,0)
 S DIR("A")="(A)ppend new data after last date of existing data"
"RTN","RGMTHL2",29,0)
 S DIR("B")="A"
"RTN","RGMTHL2",30,0)
 S DIR("?",1)="Enter:",DIR("?",2)="D if you want to delete exiting data and recompile."
"RTN","RGMTHL2",31,0)
 S DIR("?",3)="A or <RET> to append new data after last date of existing data."
"RTN","RGMTHL2",32,0)
 S DIR("?")="""^"" to HALT."
"RTN","RGMTHL2",33,0)
 D ^DIR K DIR G:$D(DIRUT) QUIT S ACT=Y
"RTN","RGMTHL2",34,0)
 ;
"RTN","RGMTHL2",35,0)
BEGIN ;
"RTN","RGMTHL2",36,0)
 S RGNOW=$$NOW^XLFDT()
"RTN","RGMTHL2",37,0)
 S:'$D(ACT) ACT="D"
"RTN","RGMTHL2",38,0)
 W !!,"Enter date range for data to be compiled."
"RTN","RGMTHL2",39,0)
 I ACT="A" D
"RTN","RGMTHL2",40,0)
 .S X1=^XTMP("RGMT","HL","@@@@","COMPENDDATE"),X2=1 D C^%DTC
"RTN","RGMTHL2",41,0)
 .S RGBDT=X W !,"Beginning Date for Report: ",$$FMTE^XLFDT(X)
"RTN","RGMTHL2",42,0)
 I ACT="D" D  G:$D(DIRUT) QUIT
"RTN","RGMTHL2",43,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","RGMTHL2",44,0)
 .S DIR(0)="DAO^:"_RGNOW_":EPXT",DIR("A")="Beginning Date for Report:  "
"RTN","RGMTHL2",45,0)
 .D ^DIR K DIR Q:$D(DIRUT)  S RGBDT=Y
"RTN","RGMTHL2",46,0)
 K DIR,DIRUT,DTOUT,DUOUT
"RTN","RGMTHL2",47,0)
 S DIR(0)="DAO^"_RGBDT_":"_RGNOW_":EPXT",DIR("A")="Ending Date for Report:  "
"RTN","RGMTHL2",48,0)
 D ^DIR K DIR G:$D(DIRUT) QUIT S RGEDT=Y
"RTN","RGMTHL2",49,0)
 ;
"RTN","RGMTHL2",50,0)
QUE ;Queue the task.
"RTN","RGMTHL2",51,0)
 S ZTSAVE("RGBDT")="",ZTSAVE("RGEDT")="",ZTSAVE("ACT")=""
"RTN","RGMTHL2",52,0)
 S ZTIO="",ZTRTN="START^RGMTHL2",ZTDESC="Compile MPI/PD HL7 Data (bi-directional)" D ^%ZTLOAD
"RTN","RGMTHL2",53,0)
 G QUIT
"RTN","RGMTHL2",54,0)
START ;
"RTN","RGMTHL2",55,0)
 K ^XTMP("RGMT","HL","@@@@","STOPPED")
"RTN","RGMTHL2",56,0)
 I ACT="D" K ^XTMP("RGMT","HL"),^XTMP("RGMT","HLICN"),^XTMP("RGMT","HLDFN")
"RTN","RGMTHL2",57,0)
 S U="^" D NOW^%DTC
"RTN","RGMTHL2",58,0)
 S ^XTMP("RGMT","HL","@@@@","STARTED")=%
"RTN","RGMTHL2",59,0)
 S ^XTMP("RGMT",0)=$$FMADD^XLFDT(DT,30)_"^"_%_"^MPI/PD Maintenance Data"
"RTN","RGMTHL2",60,0)
 I ACT="D" S ^XTMP("RGMT","HL","@@@@","COMPBEGINDATE")=RGBDT
"RTN","RGMTHL2",61,0)
 S ^XTMP("RGMT","HL","@@@@","COMPENDDATE")=RGEDT
"RTN","RGMTHL2",62,0)
 S PRGBDT=$$FMTE^XLFDT(^XTMP("RGMT","HL","@@@@","COMPBEGINDATE"))
"RTN","RGMTHL2",63,0)
 S PRGEDT=$$FMTE^XLFDT(RGEDT)
"RTN","RGMTHL2",64,0)
 S ^XTMP("RGMT","HL","@@@@","RANGE")=PRGBDT_" to "_PRGEDT
"RTN","RGMTHL2",65,0)
 ;
"RTN","RGMTHL2",66,0)
LOOP ;Loop on ^HL(772 date xref
"RTN","RGMTHL2",67,0)
 S STOPDT=$S($L(RGEDT)=7:RGEDT+.2359,1:RGEDT+.0001)
"RTN","RGMTHL2",68,0)
 S RGDT=RGBDT-.0001 F  S RGDT=$O(^HL(772,"B",RGDT)) Q:'RGDT  Q:RGDT>STOPDT  D
"RTN","RGMTHL2",69,0)
 .S ^XTMP("RGMT","HL","@@@@","NOW PROCESSING DATE")=RGDT
"RTN","RGMTHL2",70,0)
 .S IEN=0
"RTN","RGMTHL2",71,0)
 .F  S IEN=$O(^HL(772,"B",RGDT,IEN)) Q:'IEN  S IEN0=$G(^HL(772,IEN,0)) Q:'IEN0  D
"RTN","RGMTHL2",72,0)
 ..S REP=$P(IEN0,U,10)
"RTN","RGMTHL2",73,0)
 ..I REP D
"RTN","RGMTHL2",74,0)
 ...I '$D(^ORD(101,REP,0)) Q
"RTN","RGMTHL2",75,0)
 ...S REPNM=$P(^ORD(101,REP,0),U),RPNM=$E(REPNM,1,4)
"RTN","RGMTHL2",76,0)
 ...I RPNM["VAF"!(RPNM["RG")!(RPNM["MPIF") D
"RTN","RGMTHL2",77,0)
 ....S TYPE=$P(IEN0,U,4),STAT=$P($G(^HL(772,IEN,"P")),U)
"RTN","RGMTHL2",78,0)
 ....I STAT="" D
"RTN","RGMTHL2",79,0)
 .....S HL773=$O(^HLMA("B",IEN,0))
"RTN","RGMTHL2",80,0)
 .....S STAT=$P($G(^HLMA(HL773,"P")),"^")
"RTN","RGMTHL2",81,0)
 ....I STAT S STATNM=$P(^HL(771.6,STAT,0),U)
"RTN","RGMTHL2",82,0)
 ....I STAT="" S STATNM="NO STATUS"
"RTN","RGMTHL2",83,0)
 ....S ^XTMP("RGMT","HL",REPNM,$P(RGDT,"."),TYPE,STATNM,IEN)=""
"RTN","RGMTHL2",84,0)
PAT ....S TXT=0 F  S TXT=$O(^HL(772,IEN,"IN",TXT)) Q:'TXT  D
"RTN","RGMTHL2",85,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="PID" S GOT=0 D  Q:GOT
"RTN","RGMTHL2",86,0)
 ......I +$P(^(0),U,3) S ICN=+$P(^(0),U,3) D SET Q
"RTN","RGMTHL2",87,0)
 ......I +$P(^(0),U,4) S DFN=+$P(^(0),U,4) S ^XTMP("RGMT","HLDFN",DFN,RGDT,REPNM,TYPE,STATNM,IEN)="",GOT=1
"RTN","RGMTHL2",88,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="QAK" S GOT=0 D  Q:GOT
"RTN","RGMTHL2",89,0)
 ......I +$P(^(0),U,2) S DFN=+$P(^(0),U,2) S ^XTMP("RGMT","HLDFN",DFN,RGDT,REPNM,TYPE,STATNM,IEN)="",GOT=1
"RTN","RGMTHL2",90,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="RDT" S ICN=+$P($P(^(0),U,6),"V") I ICN D  Q
"RTN","RGMTHL2",91,0)
 ......S ^XTMP("RGMT","HLICN",ICN,RGDT,REPNM,TYPE,STATNM,IEN)="(Look at ^HL(772,"_IEN_",""IN"","_TXT_",0)",GOT=1
"RTN","RGMTHL2",92,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="VTQ" S GOT=0 D  Q:GOT
"RTN","RGMTHL2",93,0)
 ......S SSN=$P($P(^HL(772,IEN,"IN",TXT,0),"@00122",2),"~",3) I SSN D
"RTN","RGMTHL2",94,0)
 .......S DFN=$O(^DPT("SSN",SSN,0)) I DFN D
"RTN","RGMTHL2",95,0)
 ........S ^XTMP("RGMT","HLDFN",DFN,RGDT,REPNM,TYPE,STATNM,IEN)="(Look at ^HL(772,"_IEN_",""IN"","_TXT_",0)",GOT=1
"RTN","RGMTHL2",96,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="MFE",$P(^(0),U,2)="MAD" S ICN=+$P($P(^(0),U,5),"~",4) D SET Q
"RTN","RGMTHL2",97,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="MFE",$P(^(0),U,2)="MUP" S ICN=+$P(^(0),U,5) D SET Q
"RTN","RGMTHL2",98,0)
 D NOW^%DTC S ^XTMP("RGMT","HL","@@@@","STOPPED")=%
"RTN","RGMTHL2",99,0)
 K ^XTMP("RGMT","HL","@@@@","NOW PROCESSING DATE")
"RTN","RGMTHL2",100,0)
QUIT ;
"RTN","RGMTHL2",101,0)
 K %,ACT,CDT,DFN,GOT,HL773,ICN,IEN,IEN0,PRGBDT,PRGEDT,REP,REPNM,RGBDT,RGDT
"RTN","RGMTHL2",102,0)
 K RGEDT,RGNOW,RPNM,SSN,STAT,STATNM,STOPDT,TYPE,TXT,X,X1,X2,Y,ZTSK
"RTN","RGMTHL2",103,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGMTHL2",104,0)
 Q
"RTN","RGMTHL2",105,0)
 ;
"RTN","RGMTHL2",106,0)
SET ;
"RTN","RGMTHL2",107,0)
 S ^XTMP("RGMT","HLICN",ICN,RGDT,REPNM,TYPE,STATNM,IEN)="" S GOT=1
"RTN","RGMTHL2",108,0)
 Q
"RTN","RGRPDAT")
0^1^B49477948
"RTN","RGRPDAT",1,0)
RGRPDAT ;BAY/ALS-ROUTINE TO CALL REMOTE PDAT ;09/14/01
"RTN","RGRPDAT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**23**;30 Apr 99
"RTN","RGRPDAT",3,0)
 ;Reference to ^DGCN(391.91 supported by IA #2911
"RTN","RGRPDAT",4,0)
 ;Reference to EN1^XWB2HL7 supported by IA #3144
"RTN","RGRPDAT",5,0)
 ;Reference to RPCCHK^XWB2HL7 supported by IA #3144
"RTN","RGRPDAT",6,0)
 ;Reference to RTNDATA^XWBDRPC supported by IA #3149
"RTN","RGRPDAT",7,0)
 ;Reference to VAFC REMOTE PDAT supported by IA #3496
"RTN","RGRPDAT",8,0)
ASK ;Ask For Patient
"RTN","RGRPDAT",9,0)
 K DIRUT
"RTN","RGRPDAT",10,0)
 W !!,"Patient lookup can be done by Patient Name, SSN or by ICN.",!
"RTN","RGRPDAT",11,0)
 S DFN="",ICN=""
"RTN","RGRPDAT",12,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: ",D="SSN^AICN^B^BS^BS5"
"RTN","RGRPDAT",13,0)
 D MIX^DIC1 K DIC,D
"RTN","RGRPDAT",14,0)
 I Y<0 S REXIT=1 G QUIT
"RTN","RGRPDAT",15,0)
 S DFN=+Y
"RTN","RGRPDAT",16,0)
 S ICN=+$$GETICN^MPIF001(DFN) I ICN<1 W !,"There is no Integration Control Number assigned to this patient,",!,"no treating facilities to query." G ASK
"RTN","RGRPDAT",17,0)
 Q
"RTN","RGRPDAT",18,0)
SEND ;
"RTN","RGRPDAT",19,0)
 N TFL,X,Y,SNTDT,MPIDIR
"RTN","RGRPDAT",20,0)
 D GETTFL(ICN,.TFL)
"RTN","RGRPDAT",21,0)
 I $D(^XTMP("RGPDAT"_ICN,0)) S SNTDT=$$FMTE^XLFDT($P(^XTMP("RGPDAT"_ICN,0),"^",2)) W !,"Query last sent for this ICN on "_SNTDT,!
"RTN","RGRPDAT",22,0)
 I $P($G(TFL(0)),"^",1)=1 D
"RTN","RGRPDAT",23,0)
 . D SELTF Q:((Y="")!(Y="^"))
"RTN","RGRPDAT",24,0)
 . W !,"Remote patient data queries will be sent to: "
"RTN","RGRPDAT",25,0)
 . S CNT=0,X=0 F  S X=$O(TFARR(X)) Q:'X  S CNT=CNT+1
"RTN","RGRPDAT",26,0)
 . I CNT>22 D D2
"RTN","RGRPDAT",27,0)
 . I CNT<23 D D1
"RTN","RGRPDAT",28,0)
 . W ! K DIR S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Do you want to continue" D ^DIR S MPIDIR=+Y K DIR
"RTN","RGRPDAT",29,0)
 . I MPIDIR=1 S X=0 F  S X=$O(TFL(X)) Q:'X  D
"RTN","RGRPDAT",30,0)
 .. W !?3,"Sending Remote Query to: ",X,"  ",$P(TFL(X),"^")
"RTN","RGRPDAT",31,0)
 .. I $D(^XTMP("RGPDAT"_ICN,X)) K ^XTMP("RGPDAT"_ICN,X)
"RTN","RGRPDAT",32,0)
 .. D REQ(ICN,.TFL,X)
"RTN","RGRPDAT",33,0)
 I '$D(TFL(0)) W !!?3,"There are no remote treating facilities listed for this patient.",!?3,"No remote query will be sent."
"RTN","RGRPDAT",34,0)
 K ICNARR,X,Y,CNT,TFARR,TFL
"RTN","RGRPDAT",35,0)
 Q
"RTN","RGRPDAT",36,0)
SEND2 ;
"RTN","RGRPDAT",37,0)
 N REXIT S REXIT=0
"RTN","RGRPDAT",38,0)
 W !!,"This option sends a remote query to selected treating"
"RTN","RGRPDAT",39,0)
 W !,"facility site(s) for MPI/PD data for a patient."
"RTN","RGRPDAT",40,0)
 F  D  Q:REXIT=1
"RTN","RGRPDAT",41,0)
 . D ASK
"RTN","RGRPDAT",42,0)
 . I $D(Y) D SEND
"RTN","RGRPDAT",43,0)
 K ICN,DFN
"RTN","RGRPDAT",44,0)
 Q
"RTN","RGRPDAT",45,0)
CHKSTAT ;check on the status for a given ICN or SSN
"RTN","RGRPDAT",46,0)
 N TFL,L,Y,ICNARR,STATUS,SL
"RTN","RGRPDAT",47,0)
 W !!,"Checking the status of remote patient data query.",!
"RTN","RGRPDAT",48,0)
 I '$D(^XTMP("RGPDAT"_ICN)) W !!,"No remote query sent for this patient." Q
"RTN","RGRPDAT",49,0)
 D GETTFL(ICN,.TFL)
"RTN","RGRPDAT",50,0)
 W !!,"-> For ICN ",$P(ICN,"V",1),!
"RTN","RGRPDAT",51,0)
 I $D(TFL(0)) D
"RTN","RGRPDAT",52,0)
 . S X=0 F  S X=$O(TFL(X)) Q:'X  I '$D(^XTMP("RGPDAT"_ICN,X)) K TFL(X)
"RTN","RGRPDAT",53,0)
 D SELTF
"RTN","RGRPDAT",54,0)
 I '$D(TFARR) W !,"No remote query sent for this patient." Q
"RTN","RGRPDAT",55,0)
 Q:((Y="")!(Y="^"))
"RTN","RGRPDAT",56,0)
 S L=0 F  S L=$O(TFARR(L)) Q:'L  D
"RTN","RGRPDAT",57,0)
 . S SL=$P(TFARR(L),"^",1)
"RTN","RGRPDAT",58,0)
 . S STATUS=$P(TFL(SL),"^",3)
"RTN","RGRPDAT",59,0)
 . I STATUS["Handle" S STATUS="Error in Process"
"RTN","RGRPDAT",60,0)
 . E  I STATUS["New" S STATUS="Request Sent"
"RTN","RGRPDAT",61,0)
 . E  I STATUS["Running" S STATUS="Awaiting Response"
"RTN","RGRPDAT",62,0)
 . E  I STATUS["Done" S STATUS="Response Received"
"RTN","RGRPDAT",63,0)
 . W !?3,"  ",$P(TFL(SL),"^"),"  status: (",STATUS,")"
"RTN","RGRPDAT",64,0)
 I '$D(TFL(0)) W !!?3,"There are no remote treating facilities listed for this patient.",!?3,"No remote query sent for this patient."
"RTN","RGRPDAT",65,0)
 K ICNARR,L,SL,TFARR,TFL
"RTN","RGRPDAT",66,0)
 Q
"RTN","RGRPDAT",67,0)
CHKSTAT2 ;
"RTN","RGRPDAT",68,0)
 N REXIT S REXIT=0
"RTN","RGRPDAT",69,0)
 W !!,"This option checks the status of an existing remote patient data query."
"RTN","RGRPDAT",70,0)
 F  D  Q:REXIT=1
"RTN","RGRPDAT",71,0)
 . D ASK
"RTN","RGRPDAT",72,0)
 . I $D(Y) D CHKSTAT
"RTN","RGRPDAT",73,0)
 K ICN,DFN
"RTN","RGRPDAT",74,0)
 Q
"RTN","RGRPDAT",75,0)
DISP    ;display returned PDAT queries
"RTN","RGRPDAT",76,0)
 W !!,"Display data returned from remote patient data queries."
"RTN","RGRPDAT",77,0)
 W !,"(Be sure HISTORY is enabled to capture data!)",!
"RTN","RGRPDAT",78,0)
 N TFL,L,Y,ICNARR,STATUS
"RTN","RGRPDAT",79,0)
 I '$D(^XTMP("RGPDAT"_ICN)) W !!,"No remote query sent for this patient." Q
"RTN","RGRPDAT",80,0)
 D GETTFL(ICN,.TFL)
"RTN","RGRPDAT",81,0)
 W !!,"-> For ICN ",$P(ICN,"V",1),!
"RTN","RGRPDAT",82,0)
 I $D(TFL(0)) D
"RTN","RGRPDAT",83,0)
 . S X=0 F  S X=$O(TFL(X)) Q:'X  I '$D(^XTMP("RGPDAT"_ICN,X)) K TFL(X)
"RTN","RGRPDAT",84,0)
 D SELTF
"RTN","RGRPDAT",85,0)
 I '$D(TFARR) W !,"No remote query sent for this patient." Q
"RTN","RGRPDAT",86,0)
 Q:((Y="")!(Y="^"))
"RTN","RGRPDAT",87,0)
 S L=0 F  S L=$O(TFARR(L)) Q:'L  D
"RTN","RGRPDAT",88,0)
 . S SL=$P(TFARR(L),"^",1)
"RTN","RGRPDAT",89,0)
 . S STATUS=$P(TFL(SL),"^",3)
"RTN","RGRPDAT",90,0)
 . I STATUS["Handle" S STATUS="Error in Process"
"RTN","RGRPDAT",91,0)
 . E  I STATUS["New" S STATUS="Request Sent"
"RTN","RGRPDAT",92,0)
 . E  I STATUS["Running" S STATUS="Awaiting Response"
"RTN","RGRPDAT",93,0)
 . E  I STATUS["Done" S STATUS="Response Received"
"RTN","RGRPDAT",94,0)
 . W !?3,"  ",$P(TFL(SL),"^"),"  status: (",STATUS,")"
"RTN","RGRPDAT",95,0)
 . D DISPLAY(ICN,$P(TFL(SL),"^",2))
"RTN","RGRPDAT",96,0)
 I '$D(TFL(0)) W !?3,"There are no remote treating facilities listed for this patient.",!?3,"No remote query exists for this patient."
"RTN","RGRPDAT",97,0)
 K ICNARR,L,SL,TFARR,TFL
"RTN","RGRPDAT",98,0)
 Q
"RTN","RGRPDAT",99,0)
DISP2 ;
"RTN","RGRPDAT",100,0)
 N REXIT S REXIT=0
"RTN","RGRPDAT",101,0)
 F  D  Q:REXIT=1
"RTN","RGRPDAT",102,0)
 . D ASK
"RTN","RGRPDAT",103,0)
 . I $D(Y) D DISP
"RTN","RGRPDAT",104,0)
 K ICN,DFN
"RTN","RGRPDAT",105,0)
 Q
"RTN","RGRPDAT",106,0)
DISPLAY(ICN,LOC) ;display a remote pdat report
"RTN","RGRPDAT",107,0)
 N STATUS,RETURN,RESULT,RET
"RTN","RGRPDAT",108,0)
 I '$D(^XTMP("RGPDAT"_ICN,0)) W !?15," - No patient data query exists for this record."
"RTN","RGRPDAT",109,0)
 I $D(^XTMP("RGPDAT"_ICN,LOC,0)) S RETURN(0)=$P(^XTMP("RGPDAT"_ICN,LOC,0),"^") D
"RTN","RGRPDAT",110,0)
 . D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D
"RTN","RGRPDAT",111,0)
 .. D RTNDATA^XWBDRPC(.RET,RETURN(0)) S R=0 F  S R=$O(RET(R)) Q:'R  W !,RET(R) I $Y>22 S DIR(0)="E" D ^DIR K DIR W @IOF S $Y=1
"RTN","RGRPDAT",112,0)
 . I $D(RET(0)) I RET(0)<0 W !!,"No data returned due to: "_$P(RET(0),"^",2)
"RTN","RGRPDAT",113,0)
 . K R
"RTN","RGRPDAT",114,0)
 Q
"RTN","RGRPDAT",115,0)
GETTFL(ICN,TFL) ;Check for existing Treating Facilities
"RTN","RGRPDAT",116,0)
 N LOC,HOME
"RTN","RGRPDAT",117,0)
 S HOME=$$SITE^VASITE()
"RTN","RGRPDAT",118,0)
 S TF=0 F  S TF=$O(^DGCN(391.91,"APAT",DFN,TF)) Q:'TF  D
"RTN","RGRPDAT",119,0)
 . S LOC=$$NNT^XUAF4(TF)
"RTN","RGRPDAT",120,0)
 . I $P(LOC,"^",2)'=$E($P(HOME,"^",3),1,3) D
"RTN","RGRPDAT",121,0)
 .. S TFL($P(LOC,"^",2))=LOC
"RTN","RGRPDAT",122,0)
 .. S LOC=$P(LOC,"^",2)
"RTN","RGRPDAT",123,0)
 .. D MONITOR(ICN,LOC,.RESULT)
"RTN","RGRPDAT",124,0)
 .. S $P(TFL(LOC),"^",3)=$P(RESULT(0),"^",2)
"RTN","RGRPDAT",125,0)
 I $O(TFL(0)) S TFL(0)=1
"RTN","RGRPDAT",126,0)
 K TF
"RTN","RGRPDAT",127,0)
 Q
"RTN","RGRPDAT",128,0)
SELTF ;Allow the user to select treating facilites from a list
"RTN","RGRPDAT",129,0)
 K TFARR,TFARR1
"RTN","RGRPDAT",130,0)
 S I=0 F  S I=$O(TFL(I)) Q:'I  D
"RTN","RGRPDAT",131,0)
 . S TFARR1($P(TFL(I),"^",1))=$P(TFL(I),"^",2)_"^"_$P(TFL(I),"^",1)
"RTN","RGRPDAT",132,0)
 S I="",CNT=0 F  S I=$O(TFARR1(I)) Q:I=""  D
"RTN","RGRPDAT",133,0)
 . S CNT=CNT+1 S TFARR(CNT)=TFARR1(I)
"RTN","RGRPDAT",134,0)
 I CNT=1 S Y=1 Q
"RTN","RGRPDAT",135,0)
 K DIR,Y
"RTN","RGRPDAT",136,0)
 S CNT=CNT+1,TFARR(CNT)="ALL"
"RTN","RGRPDAT",137,0)
 S DIR(0)="LA^1:"_CNT
"RTN","RGRPDAT",138,0)
 S DIR("A")="Select site(s) 1-"_(CNT-1)_" or "_CNT_" for all: "
"RTN","RGRPDAT",139,0)
 W !,"Select one or more of the following: "
"RTN","RGRPDAT",140,0)
 I CNT>22 D D2
"RTN","RGRPDAT",141,0)
 I CNT<23 D D1
"RTN","RGRPDAT",142,0)
 D ^DIR K DIR
"RTN","RGRPDAT",143,0)
 I Y<1 K TFARR,TFARR1,L,I,A,CNT Q
"RTN","RGRPDAT",144,0)
 S Y=","_Y
"RTN","RGRPDAT",145,0)
 I Y[(","_CNT_",") K TFARR(CNT),TFARR1,CNT,I Q
"RTN","RGRPDAT",146,0)
 S I=0,A="" F  S I=$O(TFARR(I)) Q:'I  I Y'[(","_I_",") S A=$P(TFARR(I),"^",1) K TFL(A) K TFARR(I)
"RTN","RGRPDAT",147,0)
 K L,I,A,TFARR(CNT),CNT,TFARR1
"RTN","RGRPDAT",148,0)
 Q
"RTN","RGRPDAT",149,0)
MONITOR(ICN,LOC,RESULT) ;
"RTN","RGRPDAT",150,0)
 N STATUS,RETURN
"RTN","RGRPDAT",151,0)
 I '$D(^XTMP("RGPDAT"_ICN,0)) S RESULT(0)="-1^Unknown" Q
"RTN","RGRPDAT",152,0)
 I '$D(^XTMP("RGPDAT"_ICN,LOC,0)) S RESULT(0)="-1^Unknown" Q
"RTN","RGRPDAT",153,0)
 I $D(^XTMP("RGPDAT"_ICN,LOC,0)) S RETURN(0)=$P(^XTMP("RGPDAT"_ICN,LOC,0),"^",1) D RPCCHK^XWB2HL7(.RESULT,RETURN(0))
"RTN","RGRPDAT",154,0)
 Q
"RTN","RGRPDAT",155,0)
REQ(ICN,TFL,LOC)        ;request a remote pdat report
"RTN","RGRPDAT",156,0)
 ;LOC - STATION# OF THE INSTITUTION file entry
"RTN","RGRPDAT",157,0)
 I +LOC>0 D EN1^XWB2HL7(.RETURN,LOC,"VAFC REMOTE PDAT",1,ICN,"")
"RTN","RGRPDAT",158,0)
 S ^XTMP("RGPDAT"_ICN,0)=$$FMADD^XLFDT(DT,2)_"^"_DT_"^"_"REMOTE PDAT QUERY"
"RTN","RGRPDAT",159,0)
 S ^XTMP("RGPDAT"_ICN,LOC,0)=RETURN(0)_"^"_$$NOW^XLFDT
"RTN","RGRPDAT",160,0)
 Q
"RTN","RGRPDAT",161,0)
SENS ;Check for patient sensitivity
"RTN","RGRPDAT",162,0)
 N RESULT
"RTN","RGRPDAT",163,0)
 D PTSEC^DGSEC4(.RESULT,DFN)
"RTN","RGRPDAT",164,0)
 I RESULT(1)>0 D
"RTN","RGRPDAT",165,0)
 . I '$D(^XUSEC("DG SENSITIVITY",DUZ)) D
"RTN","RGRPDAT",166,0)
 . W !!,"PATIENT MARKED SENSITIVE."
"RTN","RGRPDAT",167,0)
 . W !,"You do not have proper security to view this record."
"RTN","RGRPDAT",168,0)
 Q
"RTN","RGRPDAT",169,0)
D1 ;
"RTN","RGRPDAT",170,0)
 S C1=1,I=0 F  S I=$O(TFARR(I)) Q:'I  D
"RTN","RGRPDAT",171,0)
 . W !,C1_".",?4,"("_$P(TFARR(I),"^",1)_") "_$P(TFARR(I),"^",2) S C1=C1+1
"RTN","RGRPDAT",172,0)
 K C1,I
"RTN","RGRPDAT",173,0)
 Q
"RTN","RGRPDAT",174,0)
D2 ;
"RTN","RGRPDAT",175,0)
 S I2=23 F I=1:1:22 D
"RTN","RGRPDAT",176,0)
 . W !,I_".",?4,"("_$P(TFARR(I),"^",1)_") "_$P(TFARR(I),"^",2)
"RTN","RGRPDAT",177,0)
 . I $D(TFARR(I2)) W ?41,I2_". ",?44,"("_$P(TFARR(I2),"^",1)_") "_$P(TFARR(I2),"^",2) S I2=I2+1
"RTN","RGRPDAT",178,0)
 K I,I2
"RTN","RGRPDAT",179,0)
 Q
"RTN","RGRPDAT",180,0)
QUIT ;
"RTN","RGRPDAT",181,0)
 K Y
"RTN","RGRPDAT",182,0)
 Q
"RTN","RGRSDYN")
0^6^B5871265
"RTN","RGRSDYN",1,0)
RGRSDYN ;ALB/RJS-BUILD DYNAMIC LINK LIST FOR A PATIENT ;03/21/97
"RTN","RGRSDYN",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**4,8,17,23**;30 Apr 99
"RTN","RGRSDYN",3,0)
EN(CLIENT,CLASS) ;
"RTN","RGRSDYN",4,0)
 ;CLIENT=HL7 CLIENT PROTOCOL AT TARGET SYSTEM
"RTN","RGRSDYN",5,0)
 ;DATA CLASS (Opt.) = Pull from Subs. Registry ONLY
"RTN","RGRSDYN",6,0)
 ;For now, anything else is both DESCRIPTIVE AND CLINICAL
"RTN","RGRSDYN",7,0)
 ; IAs used in this application
"RTN","RGRSDYN",8,0)
 ; #2701-$$GETDFN^MPIF001
"RTN","RGRSDYN",9,0)
 ; #2779-$$SEND2^VAFCUTL1
"RTN","RGRSDYN",10,0)
 S CLASS=$G(CLASS),CLIENT=$G(CLIENT)
"RTN","RGRSDYN",11,0)
 Q:CLIENT=""  ;No receiver
"RTN","RGRSDYN",12,0)
 N PPF,DFN,HERE,ICN,RGRS,PPFIEN
"RTN","RGRSDYN",13,0)
PARS ;Parse local outbound message
"RTN","RGRSDYN",14,0)
 N RGDC
"RTN","RGRSDYN",15,0)
 D INITIZE^RGRSUTIL,EN^RGRSPARS("RGRS")
"RTN","RGRSDYN",16,0)
 ;Get patients owner site
"RTN","RGRSDYN",17,0)
 S PPF=$G(RGRS("SITENUM"))\1 Q:PPF'>0
"RTN","RGRSDYN",18,0)
 S PPFIEN=$$LKUP^XUAF4(PPF)
"RTN","RGRSDYN",19,0)
 ;get ICN
"RTN","RGRSDYN",20,0)
 S ICN=$G(RGRS(991.01)) Q:$G(ICN)']""
"RTN","RGRSDYN",21,0)
 ;Get DFN
"RTN","RGRSDYN",22,0)
 S DFN=$$GETDFN^MPIF001(ICN) Q:$G(DFN)'>0
"RTN","RGRSDYN",23,0)
 Q:+$$SEND2^VAFCUTL1(DFN,"T")  ;quit if test patient
"RTN","RGRSDYN",24,0)
 Q:$$IFLOCAL^MPIF001(DFN)
"RTN","RGRSDYN",25,0)
 ;Where we're at
"RTN","RGRSDYN",26,0)
 S HERE=$P($$SITE^VASITE,"^",3)\1
"RTN","RGRSDYN",27,0)
NOTPPF ; if not ppf send only to ppf
"RTN","RGRSDYN",28,0)
 I PPF'=HERE D  Q
"RTN","RGRSDYN",29,0)
 . N PPFLINK,INDEX
"RTN","RGRSDYN",30,0)
 . D LINK^HLUTIL3(PPFIEN,.PPFLINK)
"RTN","RGRSDYN",31,0)
 . S INDEX=$O(PPFLINK(0))
"RTN","RGRSDYN",32,0)
 . I INDEX]"" S HLL("LINKS",1)=CLIENT_"^"_PPFLINK(INDEX)
"RTN","RGRSDYN",33,0)
ISPPF ;
"RTN","RGRSDYN",34,0)
 I PPF=HERE D  Q
"RTN","RGRSDYN",35,0)
 . N PARENT,INDEX,SUBCONTL,CHILDREN,INDEX1,NODE
"RTN","RGRSDYN",36,0)
 . S NODE=$$MPINODE^MPIFAPI(DFN)
"RTN","RGRSDYN",37,0)
 . S SUBCONTL=$P($G(NODE),"^",5)
"RTN","RGRSDYN",38,0)
 . ;Get subscribers, return updated HLL array
"RTN","RGRSDYN",39,0)
 . I SUBCONTL]"" D GET^HLSUB(SUBCONTL,+CLASS,CLIENT,.HLL)
"RTN","RGRSDYN",40,0)
 . ;LAST MINUTE CHANGE MARILYN REQUESTED
"RTN","RGRSDYN",41,0)
 . ;Get MPI link from SITE PARAMETER (when non A01/A03 event, ADT
"RTN","RGRSDYN",42,0)
 . ;message) part of the DG*5.3*261/RG*1.0*4 bundle gjc@2/4/99
"RTN","RGRSDYN",43,0)
 . I '$$ADT0103() D
"RTN","RGRSDYN",44,0)
 . . N MPI S MPI=$$MPILINK^MPIFAPI() D
"RTN","RGRSDYN",45,0)
 . . . I $P($G(MPI),U)'=-1 S HLL("LINKS",9999999999)=CLIENT_"^"_MPI
"RTN","RGRSDYN",46,0)
 . . . I $P($G(MPI),U)=-1 D
"RTN","RGRSDYN",47,0)
 . . . . N RGLOG,RGMTXT
"RTN","RGRSDYN",48,0)
 . . . . D START^RGHLLOG(HLMTIEN,"","")
"RTN","RGRSDYN",49,0)
 . . . . S RGMTXT=""
"RTN","RGRSDYN",50,0)
 . . . . D EXC^RGHLLOG(224,"No MPI link identified in CIRN SITE PARAMETER file (#991.8)"_RGMTXT,$G(DFN))
"RTN","RGRSDYN",51,0)
 . . . . D STOP^RGHLLOG(0)
"RTN","RGRSDYN",52,0)
 ;
"RTN","RGRSDYN",53,0)
 ;the following was commented out because we're not updating all sites
"RTN","RGRSDYN",54,0)
 ;in the VISN anymore
"RTN","RGRSDYN",55,0)
 ;
"RTN","RGRSDYN",56,0)
 ;. ;Get owners PARENT
"RTN","RGRSDYN",57,0)
 ;. D PARENT^XUAF4("PARENT",PPF)
"RTN","RGRSDYN",58,0)
 ;. S INDEX=""
"RTN","RGRSDYN",59,0)
 ;. S INDEX=$O(PARENT("P",INDEX))
"RTN","RGRSDYN",60,0)
 ;. Q:INDEX']""
"RTN","RGRSDYN",61,0)
 ;. D LINK^HLUTIL3(INDEX,.CHILDREN)
"RTN","RGRSDYN",62,0)
 ;. S INDEX=$O(HLL("LINKS",9999999999999),-1)
"RTN","RGRSDYN",63,0)
 ;. Q:INDEX']""
"RTN","RGRSDYN",64,0)
 ;. S INDEX1=0
"RTN","RGRSDYN",65,0)
 ;. F  S INDEX1=$O(CHILDREN(INDEX1)) Q:INDEX1'>0  D
"RTN","RGRSDYN",66,0)
 ;. . S INDEX=INDEX+1
"RTN","RGRSDYN",67,0)
 ;. . S HLL("LINKS",INDEX)=CLIENT_"^"_CHILDREN(INDEX1)
"RTN","RGRSDYN",68,0)
 ;
"RTN","RGRSDYN",69,0)
ADT0103() ; check to see if this is an ADT message type with an
"RTN","RGRSDYN",70,0)
 ; event of A01 -or- A03.  If true, do not broadcast the message
"RTN","RGRSDYN",71,0)
 ; to the MPI.  Part of the DG*5.3*261/RG*1.0*4 bundle.  gjc@2/4/99
"RTN","RGRSDYN",72,0)
 S HL("MTN")=$G(HL("MTN")),HL("ETN")=$G(HL("ETN")) ; just in case
"RTN","RGRSDYN",73,0)
 Q $S(HL("MTN")="ADT"&(HL("ETN")="A01"!(HL("ETN")="A03")):1,1:0)
"RTN","RGRSDYN1")
0^7^B15400335
"RTN","RGRSDYN1",1,0)
RGRSDYN1 ;ALB/RJS-BUILD DYNAMIC LINK LIST FOR A TFU ;06/09/97
"RTN","RGRSDYN1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,8,23**;30 Apr 99
"RTN","RGRSDYN1",3,0)
 ;Reference to ^DGCN(391.91 supported by IA #2911
"RTN","RGRSDYN1",4,0)
 ;Reference to $$SEND2^VAFCUTL1 supported by IA #2779
"RTN","RGRSDYN1",5,0)
EN(CLIENT,CLASS) ;
"RTN","RGRSDYN1",6,0)
 ;CLIENT=HL7 CLIENT PROTOCOL AT TARGET SYSTEM
"RTN","RGRSDYN1",7,0)
 ;DATA CLASS (Opt.) = Pull from Subs. Registry ONLY
"RTN","RGRSDYN1",8,0)
 ;For now, anything else is both DESCRIPTIVE AND CLINICAL
"RTN","RGRSDYN1",9,0)
 S CLASS=$G(CLASS),CLIENT=$G(CLIENT)
"RTN","RGRSDYN1",10,0)
 Q:CLIENT=""  ;No receiver
"RTN","RGRSDYN1",11,0)
 N PPF,DFN,HERE,RGRS,PPFIEN,ICN,MPI
"RTN","RGRSDYN1",12,0)
PARS ;Parse local outbound message
"RTN","RGRSDYN1",13,0)
 N RGDC
"RTN","RGRSDYN1",14,0)
 D INITIZE^RGRSUTIL,EN^RGRSPAR1("RGRS")
"RTN","RGRSDYN1",15,0)
 ;Get DFN
"RTN","RGRSDYN1",16,0)
 S ICN=$G(RGRS("ICN")) Q:$G(ICN)']""
"RTN","RGRSDYN1",17,0)
 S DFN=$$GETDFN^MPIF001(ICN) Q:+DFN'>0
"RTN","RGRSDYN1",18,0)
 Q:+$$SEND2^VAFCUTL1(DFN,"T")  ;don't broadcast test patients
"RTN","RGRSDYN1",19,0)
 Q:$$IFLOCAL^MPIF001(DFN)
"RTN","RGRSDYN1",20,0)
 S PPF=$$GETVCCI^MPIF001(DFN)\1 Q:+PPF'>0
"RTN","RGRSDYN1",21,0)
 S PPFIEN=$$LKUP^XUAF4(PPF)
"RTN","RGRSDYN1",22,0)
 ;Where we're at            Changed to 3rd piece CMC 5/9/98
"RTN","RGRSDYN1",23,0)
 S HERE=$P($$SITE^VASITE,"^",3)\1
"RTN","RGRSDYN1",24,0)
NOTPPF ; if not ppf send only to ppf
"RTN","RGRSDYN1",25,0)
 I PPF'=HERE D  Q
"RTN","RGRSDYN1",26,0)
 . N PPFLINK,INDEX
"RTN","RGRSDYN1",27,0)
 . D LINK^HLUTIL3(PPFIEN,.PPFLINK)
"RTN","RGRSDYN1",28,0)
 . S INDEX=$O(PPFLINK(0))
"RTN","RGRSDYN1",29,0)
 . I INDEX]"" S HLL("LINKS",1)=CLIENT_"^"_PPFLINK(INDEX)
"RTN","RGRSDYN1",30,0)
ISPPF ;
"RTN","RGRSDYN1",31,0)
 I PPF=HERE D  Q
"RTN","RGRSDYN1",32,0)
 . N PARENT,INDEX,SUBCONTL,CHILDREN,INDEX1,NODE
"RTN","RGRSDYN1",33,0)
 . S NODE=$$MPINODE^MPIFAPI(DFN)
"RTN","RGRSDYN1",34,0)
 . S SUBCONTL=$P($G(NODE),"^",5)
"RTN","RGRSDYN1",35,0)
 . ;Get subscribers, return updated HLL array
"RTN","RGRSDYN1",36,0)
 . ;replaced with GET line tag: I SUBCONTL]"" D GET^HLSUB(SUBCONTL,+CLASS,CLIENT,.HLL)
"RTN","RGRSDYN1",37,0)
 . D GET(DFN,SUBCONTL,+CLASS,CLIENT,.HLL)
"RTN","RGRSDYN1",38,0)
 . ;Get MPI link from SITE PARAMETER
"RTN","RGRSDYN1",39,0)
 . S MPI=$$MPILINK^MPIFAPI() D
"RTN","RGRSDYN1",40,0)
 . . I $P($G(MPI),U)'=-1 S HLL("LINKS",9999999999)=CLIENT_"^"_MPI
"RTN","RGRSDYN1",41,0)
 . . I $P($G(MPI),U)=-1 D
"RTN","RGRSDYN1",42,0)
 . . . N RGLOG,RGMTXT
"RTN","RGRSDYN1",43,0)
 . . . S RGMTXT=""
"RTN","RGRSDYN1",44,0)
 . . . D START^RGHLLOG(HLMTIEN,"","") D EXC^RGHLLOG(224,"No MPI link identified in CIRN SITE PARAMETER file (#991.8)"_RGMTXT,DFN) D STOP^RGHLLOG(0)
"RTN","RGRSDYN1",45,0)
 ;
"RTN","RGRSDYN1",46,0)
GET(RGDFN,RGSCN,RGTP,RGCLP,RGLL) ;GET Subscribers
"RTN","RGRSDYN1",47,0)
 ;RGDFN - Patient IEN from FILE (#2)
"RTN","RGRSDYN1",48,0)
 ;RGSCN - Subcription Control Number
"RTN","RGRSDYN1",49,0)
 ;RGTP  - SUBSCRIBER TYPE (0,1,2)/Null=all
"RTN","RGRSDYN1",50,0)
 ;RGCLP - HL7 CLIENT PROTOCOL (required)
"RTN","RGRSDYN1",51,0)
 ;RGLL  - HLL("LINKS",x)=CLIENT PROTOCOL^LOGICAL LINK (passed by reference)
"RTN","RGRSDYN1",52,0)
 N RG,RGI,RGLLIEN,RGLLI,RGLLS,RGLLN,RGLLZ,RGTF,RGTFF,RGTFI,RGX,HLER
"RTN","RGRSDYN1",53,0)
 S U="^"
"RTN","RGRSDYN1",54,0)
 ;get subscribers
"RTN","RGRSDYN1",55,0)
 I RGSCN'="" D GET^HLSUB(RGSCN,RGTP,RGCLP,.RGLL)
"RTN","RGRSDYN1",56,0)
 ;check for a treating facility that is not a subscriber
"RTN","RGRSDYN1",57,0)
 S RGI=0 F  S RGI=$O(^DGCN(391.91,"B",RGDFN,RGI)) Q:'RGI  I $D(^DGCN(391.91,RGI,0)) S RGTF=$G(^DGCN(391.91,RGI,0)),RGTFI=$P(RGTF,U,2) D:RGTFI'=+$$SITE^VASITE
"RTN","RGRSDYN1",58,0)
 .;checking INSTITUTION of links to the TREATING FACILITY INSTITUTION
"RTN","RGRSDYN1",59,0)
 .;RGTFF=1 - Flag for adding Treating Facility to Subcription Control
"RTN","RGRSDYN1",60,0)
 .S RGTFF=1
"RTN","RGRSDYN1",61,0)
 .S RGX=0 F  S RGX=$O(RGLL("LINKS",RGX)) Q:'RGX!(RGTFF=0)  D
"RTN","RGRSDYN1",62,0)
 ..S RGLLIEN=$P(RGLL("LINKS",RGX),U,6)
"RTN","RGRSDYN1",63,0)
 ..I $G(RGLL)="" S RGLL("ERR",RGX)="No logical link defined for "_$P(RGLL("LINKS",RGX),U)_"." Q
"RTN","RGRSDYN1",64,0)
 ..S RGLLI=RGTFI,RGLLN=$P(RGLL("LINKS",RGX),U,2)
"RTN","RGRSDYN1",65,0)
 ..I '$L(RGLLI),'$D(RGLL("ERR",RGX)) S RGLL("ERR",RGX)="Link "_$P(RGLL("LINKS",RGX),U,2)_" does not contain a link to the INSTUTUTION (#4) file." Q
"RTN","RGRSDYN1",66,0)
 ..I $L(RGLLI) S:RGLLI'=RGTFI RGTFF=1 I RGLLI=RGTFI S RGTFF=0 Q
"RTN","RGRSDYN1",67,0)
 .;If TF not in Subscriber list, kill list, add to subscription control file then get new list 
"RTN","RGRSDYN1",68,0)
 .I RGTFF=1 D LINK^HLUTIL3("`"_RGTFI,.RG,"I") S RGLLI=$O(RG(0)) D
"RTN","RGRSDYN1",69,0)
 ..I +$G(RGLLI)>0 S RGLLN=$P(RG(RGLLI),U),RGLLI=RGTFI
"RTN","RGRSDYN1",70,0)
 ..I +$G(RGLLI)>0 S:RGSCN="" RGSCN=$$GETSCN^RGJCREC(RGDFN) D UPD^HLSUB(RGSCN,RGLLN,RGTP,$$NOW^XLFDT,,,.HLER) K RGLL("LINKS") D GET^HLSUB(RGSCN,RGTP,RGCLP,.RGLL)
"RTN","RGRSDYN1",71,0)
 ..I +$G(RGLLI)'>0 W !,"Unable to find Logical link for "_$$GET1^DIQ(4,+RGTFI_",",.01)
"RTN","RGRSDYN1",72,0)
 Q
"RTN","RGSYSTAT")
0^10^B37589419
"RTN","RGSYSTAT",1,0)
RGSYSTAT ;BAY/ALS-MPI/PD STATUS DISPLAY ;01/05/01
"RTN","RGSYSTAT",2,0)
 ;;1.0;CLINCAL INFO RESOURCE NETWORK;**16,19,23**;30 Apr 99
"RTN","RGSYSTAT",3,0)
 ;Reference to ^DGCN(391.98,"AST" supported by IA #3303
"RTN","RGSYSTAT",4,0)
 ;Reference to ^DGCN(391.984 supported by IA #3304
"RTN","RGSYSTAT",5,0)
 ;Reference to ^MPIF(984.9 supported by IA #3298
"RTN","RGSYSTAT",6,0)
 ;Reference to OPTSTAT^XUTMOPT supported by IA #1472
"RTN","RGSYSTAT",7,0)
 ;Reference to ^DPT("ACMORS", ^DPT("AICN", and ^DPT("AICNL" supported by IA #2070
"RTN","RGSYSTAT",8,0)
 ;Reference to ^VAT(391.71 supported by IA #3422
"RTN","RGSYSTAT",9,0)
EN ;
"RTN","RGSYSTAT",10,0)
 ; Count exceptions on hand
"RTN","RGSYSTAT",11,0)
EXC ;
"RTN","RGSYSTAT",12,0)
 W @IOF,"Exception Handler Entries:",!,"--------------------------"
"RTN","RGSYSTAT",13,0)
 S CNT=0,EXCTYP="",NTYP="",TOTL=0,PCNT=0
"RTN","RGSYSTAT",14,0)
 N STAT,DFN,ICN
"RTN","RGSYSTAT",15,0)
 S HOME=$$SITE^VASITE()
"RTN","RGSYSTAT",16,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGSYSTAT",17,0)
 . I (EXCTYP=209)!(EXCTYP=227)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGSYSTAT",18,0)
 .. I (EXCTYP'=NTYP)&(CNT>0) D
"RTN","RGSYSTAT",19,0)
 ... S ETEXT=$P($G(^RGHL7(991.11,NTYP,10)),"^",1)
"RTN","RGSYSTAT",20,0)
 ... W !,$E(ETEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",21,0)
 .. S IEN=0,NTYP=EXCTYP
"RTN","RGSYSTAT",22,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",23,0)
 ... S IEN2=0
"RTN","RGSYSTAT",24,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGSYSTAT",25,0)
 .... S STAT=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5) I STAT<1 D
"RTN","RGSYSTAT",26,0)
 ..... S DFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'DFN
"RTN","RGSYSTAT",27,0)
 ..... S ^XTMP("RGEXC",DFN)=DFN
"RTN","RGSYSTAT",28,0)
 ..... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGSYSTAT",29,0)
 ..... I $E(ICN,1,3)=$E($P(HOME,"^",3),1,3)!(ICN<0)!((EXCTYP<218)&(EXCTYP>214)) D
"RTN","RGSYSTAT",30,0)
 ...... S CNT=CNT+1
"RTN","RGSYSTAT",31,0)
 I CNT>0 D
"RTN","RGSYSTAT",32,0)
 .S ETEXT=$P($G(^RGHL7(991.11,NTYP,10)),"^",1)
"RTN","RGSYSTAT",33,0)
 .W !,$E(ETEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT
"RTN","RGSYSTAT",34,0)
 I TOTL=0 W !,"There are no entries in the Exception Handler."
"RTN","RGSYSTAT",35,0)
 I TOTL>0 D
"RTN","RGSYSTAT",36,0)
 . W !!,"Total number of exceptions: ",?55,$J(TOTL,6)
"RTN","RGSYSTAT",37,0)
 . S PDFN=""
"RTN","RGSYSTAT",38,0)
 . F  S PDFN=$O(^XTMP("RGEXC",PDFN)) Q:'PDFN  D
"RTN","RGSYSTAT",39,0)
 .. S PCNT=PCNT+1
"RTN","RGSYSTAT",40,0)
 . W !,"Total unique patient exceptions: ",?55,$J(PCNT,6)
"RTN","RGSYSTAT",41,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1)
"RTN","RGSYSTAT",42,0)
 I $D(^RGSITE(991.8,1,"EXCPRG")) D
"RTN","RGSYSTAT",43,0)
 . S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGSYSTAT",44,0)
 . W !!,"The MPI/PD Exception Purge process last ran "_STDT_"."
"RTN","RGSYSTAT",45,0)
 K CNT,EXCTYP,NTYP,ETEXT,TOTL,IEN,IEN2,HOME,PCNT,^XTMP("RGEXC"),PDFN,STDT
"RTN","RGSYSTAT",46,0)
 I $Y>21 D QUIT
"RTN","RGSYSTAT",47,0)
 ;Q
"RTN","RGSYSTAT",48,0)
PDR ;Count entries in Patient Data Review
"RTN","RGSYSTAT",49,0)
 W !!,"Patient Data Review Entries:",!,"----------------------------"
"RTN","RGSYSTAT",50,0)
 S CNT=0,PDRTYP="",NTYP="",TOTL=0
"RTN","RGSYSTAT",51,0)
 F  S PDRTYP=$O(^DGCN(391.98,"AST",PDRTYP)) Q:'PDRTYP  D
"RTN","RGSYSTAT",52,0)
 . I (PDRTYP'=NTYP)&(CNT>0) D
"RTN","RGSYSTAT",53,0)
 .. S DIC="^DGCN(391.984,",DR=".01",DA=NTYP,DIQ(0)="E",DIQ="RGPDR"
"RTN","RGSYSTAT",54,0)
 .. D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","RGSYSTAT",55,0)
 .. S PTEXT=$G(RGPDR(391.984,NTYP,.01,"E"))
"RTN","RGSYSTAT",56,0)
 .. W !,$E(PTEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",57,0)
 . I (PDRTYP=1)!(PDRTYP=2)!(PDRTYP=5) D
"RTN","RGSYSTAT",58,0)
 .. S IEN=0,NTYP=PDRTYP
"RTN","RGSYSTAT",59,0)
 .. F  S IEN=$O(^DGCN(391.98,"AST",PDRTYP,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",60,0)
 ... S CNT=CNT+1
"RTN","RGSYSTAT",61,0)
 I CNT>0 D
"RTN","RGSYSTAT",62,0)
 . S DIC="^DGCN(391.984,",DR=".01",DA=NTYP,DIQ(0)="E",DIQ="RGPDR"
"RTN","RGSYSTAT",63,0)
 . D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","RGSYSTAT",64,0)
 . S PTEXT=$G(RGPDR(391.984,NTYP,.01,"E"))
"RTN","RGSYSTAT",65,0)
 .W !,$E(PTEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT
"RTN","RGSYSTAT",66,0)
 I TOTL=0 W !,"There are no entries in Patient Data Review."
"RTN","RGSYSTAT",67,0)
 K CNT,PDRTYP,NTYP,TOTL,IEN,PTEXT,RGPDR
"RTN","RGSYSTAT",68,0)
 ;Q
"RTN","RGSYSTAT",69,0)
 I $Y>20 D QUIT
"RTN","RGSYSTAT",70,0)
 ;
"RTN","RGSYSTAT",71,0)
CMOR ;CMOR Requests Status
"RTN","RGSYSTAT",72,0)
 W !!,"CMOR Requests Status:",!,"---------------------"
"RTN","RGSYSTAT",73,0)
 S CNT=0,STAT="",NSTAT="",TOTL=0
"RTN","RGSYSTAT",74,0)
 F  S STAT=$O(^MPIF(984.9,"AC",STAT)) Q:'STAT  D
"RTN","RGSYSTAT",75,0)
 . I (STAT'=NSTAT)&(CNT>0) D
"RTN","RGSYSTAT",76,0)
 .. S TEXT=$$EXTERNAL^DILFD(984.9,.06,,NSTAT)
"RTN","RGSYSTAT",77,0)
 .. W !,$E(TEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",78,0)
 . S IEN=0,NSTAT=STAT
"RTN","RGSYSTAT",79,0)
 . F  S IEN=$O(^MPIF(984.9,"AC",STAT,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",80,0)
 .. S CNT=CNT+1 S TOTL=TOTL+CNT
"RTN","RGSYSTAT",81,0)
 I CNT>0 S TEXT=$$EXTERNAL^DILFD(984.9,.06,,NSTAT) W !,$E(TEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",82,0)
 I TOTL=0 W !,"There are no outstanding CMOR Requests."
"RTN","RGSYSTAT",83,0)
 K CNT,STAT,NSTAT,TEXT,TOTL,IEN
"RTN","RGSYSTAT",84,0)
 I $Y>20 D QUIT
"RTN","RGSYSTAT",85,0)
 ;
"RTN","RGSYSTAT",86,0)
VAFC ;VAFC BATCH UPDATE background job
"RTN","RGSYSTAT",87,0)
 D OPTSTAT^XUTMOPT("VAFC BATCH UPDATE",.OPTSCH)
"RTN","RGSYSTAT",88,0)
 S TIME=$P($G(OPTSCH(1)),"^",2)
"RTN","RGSYSTAT",89,0)
 I 'TIME W !!,"The VAFC BATCH UPDATE background job is NOT currently scheduled." G AXMIT
"RTN","RGSYSTAT",90,0)
 S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGSYSTAT",91,0)
 W !!,"The VAFC BATCH UPDATE background job is scheduled for "_TIME_"."
"RTN","RGSYSTAT",92,0)
 I $Y>20 D QUIT
"RTN","RGSYSTAT",93,0)
AXMIT K TIME,OPTSCH
"RTN","RGSYSTAT",94,0)
 S CNT=0,IEN=0 F  S IEN=$O(^VAT(391.71,"AXMIT",4,IEN)) Q:'IEN  S CNT=CNT+1
"RTN","RGSYSTAT",95,0)
 W !?3,"(Total DATA UPDATES waiting to be processed = "_CNT_")"
"RTN","RGSYSTAT",96,0)
 I $Y>20 D QUIT
"RTN","RGSYSTAT",97,0)
 S CNT=0,IEN=0 F  S IEN=$O(^VAT(391.71,"AXMIT",5,IEN)) Q:'IEN  S CNT=CNT+1
"RTN","RGSYSTAT",98,0)
 W !?3,"(Total TREATING FACILITY UPDATES waiting to be processed = "_CNT_")"
"RTN","RGSYSTAT",99,0)
 I $Y>20 D QUIT
"RTN","RGSYSTAT",100,0)
 ;
"RTN","RGSYSTAT",101,0)
 ;MPIF LOC/MIS ICN RES background job
"RTN","RGSYSTAT",102,0)
MPIF D OPTSTAT^XUTMOPT("MPIF LOC/MIS ICN RES",.OPTSCH)
"RTN","RGSYSTAT",103,0)
 S TIME=$P($G(OPTSCH(1)),"^",2)
"RTN","RGSYSTAT",104,0)
 I 'TIME W !,"The MPIF LOC/MIS ICN RES background job is NOT currently scheduled." G EQUE
"RTN","RGSYSTAT",105,0)
 S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGSYSTAT",106,0)
 W !,"The MPIF LOC/MIS ICN RES background job is scheduled for "_TIME_"."
"RTN","RGSYSTAT",107,0)
 I $Y>21 D QUIT
"RTN","RGSYSTAT",108,0)
 S TIME=$P($G(^RGSITE(991.8,1,0)),"^",4) I TIME'="" D
"RTN","RGSYSTAT",109,0)
 .S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGSYSTAT",110,0)
 .W !,"The MPIF LOC/MIS ICN RES background job last ran "_TIME_"."
"RTN","RGSYSTAT",111,0)
 I $Y>21 D QUIT
"RTN","RGSYSTAT",112,0)
 K TIME,OPTSCH
"RTN","RGSYSTAT",113,0)
 ;
"RTN","RGSYSTAT",114,0)
EQUE ;MPI/PD Event Queue currently running?
"RTN","RGSYSTAT",115,0)
 N SUB1,SUB2
"RTN","RGSYSTAT",116,0)
 L +^RGEQ("MAIN"):0 E  D  G CMSG
"RTN","RGSYSTAT",117,0)
 . W !,"MPI/PD Event Queue processor is currently RUNNING."
"RTN","RGSYSTAT",118,0)
 W !,"MPI/PD Event Queue processor is currently NOT RUNNING."
"RTN","RGSYSTAT",119,0)
 L -^RGEQ("MAIN")
"RTN","RGSYSTAT",120,0)
 ;Count number of entries in event queue
"RTN","RGSYSTAT",121,0)
 S SUB1="",CNT=0 F  S SUB1=$O(^RGEQ(SUB1)) Q:SUB1=""  D
"RTN","RGSYSTAT",122,0)
 .S SUB2="" F  S SUB2=$O(^RGEQ(SUB1,SUB2)) Q:SUB2=""  S CNT=CNT+1
"RTN","RGSYSTAT",123,0)
 W !?3,"(Total entries in Event Queue waiting to be processed = "_CNT_")"
"RTN","RGSYSTAT",124,0)
 I $Y>21 D QUIT
"RTN","RGSYSTAT",125,0)
 ;
"RTN","RGSYSTAT",126,0)
CMSG ;Stop MPI/PD Messaging field
"RTN","RGSYSTAT",127,0)
 S SEND=$P($G(^RGSITE(991.8,1,1)),"^",6)
"RTN","RGSYSTAT",128,0)
 S CUR=$S(SEND=1:"SEND MESSAGES",SEND=0:"STOP MESSAGES",SEND=2:"SUSPEND MESSAGES",1:"NULL")
"RTN","RGSYSTAT",129,0)
 W !,"STOP MPI/PD MESSAGING currently set to "_CUR_"."
"RTN","RGSYSTAT",130,0)
 K CUR,SEND
"RTN","RGSYSTAT",131,0)
 ;Q
"RTN","RGSYSTAT",132,0)
AUDIT ;Check to see if .01 field in patient file has auditing turned on
"RTN","RGSYSTAT",133,0)
 D FIELD^DID(2,.01,"","AUDIT","PATAUD")
"RTN","RGSYSTAT",134,0)
 S PATAUD=$G(PATAUD("AUDIT"))
"RTN","RGSYSTAT",135,0)
 W !,"Audit on NAME (#.01) field of PATIENT (#2) file set to "_PATAUD
"RTN","RGSYSTAT",136,0)
 K PATAUD
"RTN","RGSYSTAT",137,0)
 I $Y>21 D QUIT
"RTN","RGSYSTAT",138,0)
CNT ;Count number of patients with a score, counts Nat'l ICNs, counts local ICNs.
"RTN","RGSYSTAT",139,0)
 S SC=0,CNT=0
"RTN","RGSYSTAT",140,0)
 F  S SC=$O(^DPT("ACMORS",SC)) Q:'SC  D
"RTN","RGSYSTAT",141,0)
 .S DFN=0
"RTN","RGSYSTAT",142,0)
 .F  S DFN=$O(^DPT("ACMORS",SC,DFN)) Q:'DFN  D
"RTN","RGSYSTAT",143,0)
 ..S CNT=CNT+1
"RTN","RGSYSTAT",144,0)
 W !!,"Current total number of Patients with CMOR Scores = ",CNT
"RTN","RGSYSTAT",145,0)
 K %,SC,CNT
"RTN","RGSYSTAT",146,0)
 S HOME=$P($$SITE^VASITE(),"^",3)
"RTN","RGSYSTAT",147,0)
 S ICN=0,CNT=0
"RTN","RGSYSTAT",148,0)
 F  S ICN=$O(^DPT("AICN",ICN)) Q:'ICN  D
"RTN","RGSYSTAT",149,0)
 .Q:$E(ICN,1,3)=HOME
"RTN","RGSYSTAT",150,0)
 .S CNT=CNT+1
"RTN","RGSYSTAT",151,0)
 W !,"Current total number of National ICNs = ",CNT
"RTN","RGSYSTAT",152,0)
 S ICN=0,CNT=0
"RTN","RGSYSTAT",153,0)
 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S CNT=CNT+1
"RTN","RGSYSTAT",154,0)
 W !,"Current total number of Local ICNs = ",CNT
"RTN","RGSYSTAT",155,0)
 K CNT,DFN,ICN
"RTN","RGSYSTAT",156,0)
QUIT S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGSYSTAT",157,0)
 .S SS=21-$Y F JJ=1:1:SS W !
"RTN","RGSYSTAT",158,0)
 S $Y=0
"RTN","RGSYSTAT",159,0)
 K JJ,SS
"RTN","RGSYSTAT",160,0)
 Q
"UP",991.1,991.12,-1)
991.1^1
"UP",991.1,991.12,0)
991.12
"UP",991.1,991.1211,-2)
991.1^1
"UP",991.1,991.1211,-1)
991.12^11
"UP",991.1,991.1211,0)
991.1211
"VER")
8.0^22.0
"^DD",991.1,991.12,11,0)
NOTES^991.1211A^^11;0
"^DD",991.1,991.12,11,21,0)
^^2^2^3011129^
"^DD",991.1,991.12,11,21,1,0)
This field allows users to enter notes regarding an exception
"^DD",991.1,991.12,11,21,2,0)
to aid in resolving the exception.
"^DD",991.1,991.1211,0)
NOTES SUB-FIELD^^.01^1
"^DD",991.1,991.1211,0,"DT")
3011129
"^DD",991.1,991.1211,0,"NM","NOTES")

"^DD",991.1,991.1211,0,"UP")
991.12
"^DD",991.1,991.1211,.01,0)
NOTES^W^^0;1^Q
"^DD",991.1,991.1211,.01,3)
Enter notes to aid in resolving exception.
"^DD",991.1,991.1211,.01,21,0)
^^2^2^3011129^^^
"^DD",991.1,991.1211,.01,21,1,0)
This field allows users to enter notes regarding an exception
"^DD",991.1,991.1211,.01,21,2,0)
to aid in resolving the exception.
"^DD",991.1,991.1211,.01,"DT")
3011129
"^DD",991.8,991.8,.04,0)
LOCAL/MISSING DATE LAST RAN^D^^0;4^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,.04,3)
Enter the date/time the Local/Missing ICN Resolution Background Job completed.
"^DD",991.8,991.8,.04,21,0)
^^2^2^3011206^
"^DD",991.8,991.8,.04,21,1,0)
This field contains the date and time that the Local/Missing ICN 
"^DD",991.8,991.8,.04,21,2,0)
Resolution Background Job [MPIF LOC/MIS ICN RES] last ran to completion.
"^DD",991.8,991.8,.04,"DT")
3011206
**END**
**END**
