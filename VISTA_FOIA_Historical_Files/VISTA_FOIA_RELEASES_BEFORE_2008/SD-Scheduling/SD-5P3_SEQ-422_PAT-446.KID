Released SD*5.3*446 SEQ #422
Extracted from mail message
**KIDS**:SD*5.3*446^

**INSTALL NAME**
SD*5.3*446
"BLD",6241,0)
SD*5.3*446^SCHEDULING^0^3070828^y
"BLD",6241,4,0)
^9.64PA^409.35^3
"BLD",6241,4,409.3,0)
409.3
"BLD",6241,4,409.3,2,0)
^9.641^409.3^1
"BLD",6241,4,409.3,2,409.3,0)
SD WAIT LIST  (File-top level)
"BLD",6241,4,409.3,2,409.3,1,0)
^9.6411^21^8
"BLD",6241,4,409.3,2,409.3,1,21,0)
DISPOSITION
"BLD",6241,4,409.3,2,409.3,1,32,0)
REJECTION FLAG
"BLD",6241,4,409.3,2,409.3,1,33,0)
SCHEDULING REMINDER FLAG
"BLD",6241,4,409.3,2,409.3,1,34,0)
INTRA TRANSFER FLAG
"BLD",6241,4,409.3,2,409.3,1,36,0)
120 DAYS FIELD
"BLD",6241,4,409.3,2,409.3,1,37,0)
CHANGED CLINIC PARENT POINTER
"BLD",6241,4,409.3,2,409.3,1,38,0)
MULTI TEAM FLAG
"BLD",6241,4,409.3,2,409.3,1,39,0)
120 DAY APPT CREATED
"BLD",6241,4,409.3,222)
y^n^p^^^^n^^n
"BLD",6241,4,409.3,224)

"BLD",6241,4,409.35,0)
409.35
"BLD",6241,4,409.35,222)
y^y^f^^^^n
"BLD",6241,4,409.36,0)
409.36
"BLD",6241,4,409.36,2,0)
^9.641^409.36^1
"BLD",6241,4,409.36,2,409.36,0)
SDWL TRANSFER ACCEPT  (File-top level)
"BLD",6241,4,409.36,2,409.36,1,0)
^9.6411^409.3^3
"BLD",6241,4,409.36,2,409.36,1,1,0)
STATUS
"BLD",6241,4,409.36,2,409.36,1,2,0)
FACILITY TRANSFERRED TO
"BLD",6241,4,409.36,2,409.36,1,409.3,0)
SD WAIT LIST ENTRY
"BLD",6241,4,409.36,222)
y^y^p^^^^n^^n
"BLD",6241,4,409.36,224)

"BLD",6241,4,"APDD",409.3,409.3)

"BLD",6241,4,"APDD",409.3,409.3,21)

"BLD",6241,4,"APDD",409.3,409.3,32)

"BLD",6241,4,"APDD",409.3,409.3,33)

"BLD",6241,4,"APDD",409.3,409.3,34)

"BLD",6241,4,"APDD",409.3,409.3,36)

"BLD",6241,4,"APDD",409.3,409.3,37)

"BLD",6241,4,"APDD",409.3,409.3,38)

"BLD",6241,4,"APDD",409.3,409.3,39)

"BLD",6241,4,"APDD",409.36,409.36)

"BLD",6241,4,"APDD",409.36,409.36,1)

"BLD",6241,4,"APDD",409.36,409.36,2)

"BLD",6241,4,"APDD",409.36,409.36,409.3)

"BLD",6241,4,"B",409.3,409.3)

"BLD",6241,4,"B",409.35,409.35)

"BLD",6241,4,"B",409.36,409.36)

"BLD",6241,6.3)
77
"BLD",6241,"ABPKG")
n
"BLD",6241,"INI")
SDWLP446
"BLD",6241,"INID")
^^y
"BLD",6241,"KRN",0)
^9.67PA^8989.52^19
"BLD",6241,"KRN",.4,0)
.4
"BLD",6241,"KRN",.401,0)
.401
"BLD",6241,"KRN",.402,0)
.402
"BLD",6241,"KRN",.403,0)
.403
"BLD",6241,"KRN",.5,0)
.5
"BLD",6241,"KRN",.84,0)
.84
"BLD",6241,"KRN",3.6,0)
3.6
"BLD",6241,"KRN",3.8,0)
3.8
"BLD",6241,"KRN",9.2,0)
9.2
"BLD",6241,"KRN",9.8,0)
9.8
"BLD",6241,"KRN",9.8,"NM",0)
^9.68A^44^42
"BLD",6241,"KRN",9.8,"NM",1,0)
SDWLD^^0^B24813208
"BLD",6241,"KRN",9.8,"NM",2,0)
SDWLI^^0^B70108876
"BLD",6241,"KRN",9.8,"NM",3,0)
SDWLE^^0^B28082342
"BLD",6241,"KRN",9.8,"NM",4,0)
SDWLDISP^^0^B62805335
"BLD",6241,"KRN",9.8,"NM",5,0)
SDWLE3^^0^B43695074
"BLD",6241,"KRN",9.8,"NM",6,0)
SDWLE6^^0^B70616317
"BLD",6241,"KRN",9.8,"NM",7,0)
SDWLEC^^0^B20668345
"BLD",6241,"KRN",9.8,"NM",8,0)
SDWLEVAL^^0^B62921958
"BLD",6241,"KRN",9.8,"NM",9,0)
SDWLIFT^^0^B64522057
"BLD",6241,"KRN",9.8,"NM",10,0)
SDWLIFT0^^0^B26058750
"BLD",6241,"KRN",9.8,"NM",11,0)
SDWLIFT3^^0^B62360655
"BLD",6241,"KRN",9.8,"NM",12,0)
SDWLIFT6^^0^B60221443
"BLD",6241,"KRN",9.8,"NM",13,0)
SDWLPL^^0^B36034628
"BLD",6241,"KRN",9.8,"NM",14,0)
SDWLRP1^^0^B62974233
"BLD",6241,"KRN",9.8,"NM",15,0)
SDWLROI^^0^B37333127
"BLD",6241,"KRN",9.8,"NM",16,0)
SDWLROIS^^0^B30723054
"BLD",6241,"KRN",9.8,"NM",17,0)
SDWLRSR^^0^B37978690
"BLD",6241,"KRN",9.8,"NM",18,0)
SDWLRSRS^^0^B31103709
"BLD",6241,"KRN",9.8,"NM",19,0)
SDM1^^0^B49317350
"BLD",6241,"KRN",9.8,"NM",20,0)
SDM1A^^0^B58026958
"BLD",6241,"KRN",9.8,"NM",21,0)
SDWL120^^0^B7543417
"BLD",6241,"KRN",9.8,"NM",22,0)
SDWLE11^^0^B8484611
"BLD",6241,"KRN",9.8,"NM",23,0)
SDWLQSC^^0^B65234580
"BLD",6241,"KRN",9.8,"NM",24,0)
SDWLQSC1^^0^B18866005
"BLD",6241,"KRN",9.8,"NM",25,0)
SDWLMSG^^0^B50689156
"BLD",6241,"KRN",9.8,"NM",26,0)
SDRPA07^^0^B59962530
"BLD",6241,"KRN",9.8,"NM",28,0)
SDWLE4^^0^B7584798
"BLD",6241,"KRN",9.8,"NM",29,0)
SDWLE2^^0^B14498008
"BLD",6241,"KRN",9.8,"NM",30,0)
SDRPA20^^0^B2396276
"BLD",6241,"KRN",9.8,"NM",31,0)
SCMCWAIT^^0^B45006775
"BLD",6241,"KRN",9.8,"NM",33,0)
SDAM2^^0^B28969353
"BLD",6241,"KRN",9.8,"NM",34,0)
SDCO1^^0^B29753601
"BLD",6241,"KRN",9.8,"NM",35,0)
SDMM^^0^B45359086
"BLD",6241,"KRN",9.8,"NM",36,0)
SDWLE7^^0^B15146200
"BLD",6241,"KRN",9.8,"NM",37,0)
SDWLBACC^^0^B25884323
"BLD",6241,"KRN",9.8,"NM",38,0)
SDWLP446^^0^B903527
"BLD",6241,"KRN",9.8,"NM",39,0)
SCMCQK1^^0^B90423070
"BLD",6241,"KRN",9.8,"NM",40,0)
SDWLIFT5^^0^B17476233
"BLD",6241,"KRN",9.8,"NM",41,0)
SDWLIFT2^^0^B7137331
"BLD",6241,"KRN",9.8,"NM",42,0)
SDM2A^^0^B17556910
"BLD",6241,"KRN",9.8,"NM",43,0)
SDWLTR^^0^B79675127
"BLD",6241,"KRN",9.8,"NM",44,0)
SDWLTR1^^0^B1740359
"BLD",6241,"KRN",9.8,"NM","B","SCMCQK1",39)

"BLD",6241,"KRN",9.8,"NM","B","SCMCWAIT",31)

"BLD",6241,"KRN",9.8,"NM","B","SDAM2",33)

"BLD",6241,"KRN",9.8,"NM","B","SDCO1",34)

"BLD",6241,"KRN",9.8,"NM","B","SDM1",19)

"BLD",6241,"KRN",9.8,"NM","B","SDM1A",20)

"BLD",6241,"KRN",9.8,"NM","B","SDM2A",42)

"BLD",6241,"KRN",9.8,"NM","B","SDMM",35)

"BLD",6241,"KRN",9.8,"NM","B","SDRPA07",26)

"BLD",6241,"KRN",9.8,"NM","B","SDRPA20",30)

"BLD",6241,"KRN",9.8,"NM","B","SDWL120",21)

"BLD",6241,"KRN",9.8,"NM","B","SDWLBACC",37)

"BLD",6241,"KRN",9.8,"NM","B","SDWLD",1)

"BLD",6241,"KRN",9.8,"NM","B","SDWLDISP",4)

"BLD",6241,"KRN",9.8,"NM","B","SDWLE",3)

"BLD",6241,"KRN",9.8,"NM","B","SDWLE11",22)

"BLD",6241,"KRN",9.8,"NM","B","SDWLE2",29)

"BLD",6241,"KRN",9.8,"NM","B","SDWLE3",5)

"BLD",6241,"KRN",9.8,"NM","B","SDWLE4",28)

"BLD",6241,"KRN",9.8,"NM","B","SDWLE6",6)

"BLD",6241,"KRN",9.8,"NM","B","SDWLE7",36)

"BLD",6241,"KRN",9.8,"NM","B","SDWLEC",7)

"BLD",6241,"KRN",9.8,"NM","B","SDWLEVAL",8)

"BLD",6241,"KRN",9.8,"NM","B","SDWLI",2)

"BLD",6241,"KRN",9.8,"NM","B","SDWLIFT",9)

"BLD",6241,"KRN",9.8,"NM","B","SDWLIFT0",10)

"BLD",6241,"KRN",9.8,"NM","B","SDWLIFT2",41)

"BLD",6241,"KRN",9.8,"NM","B","SDWLIFT3",11)

"BLD",6241,"KRN",9.8,"NM","B","SDWLIFT5",40)

"BLD",6241,"KRN",9.8,"NM","B","SDWLIFT6",12)

"BLD",6241,"KRN",9.8,"NM","B","SDWLMSG",25)

"BLD",6241,"KRN",9.8,"NM","B","SDWLP446",38)

"BLD",6241,"KRN",9.8,"NM","B","SDWLPL",13)

"BLD",6241,"KRN",9.8,"NM","B","SDWLQSC",23)

"BLD",6241,"KRN",9.8,"NM","B","SDWLQSC1",24)

"BLD",6241,"KRN",9.8,"NM","B","SDWLROI",15)

"BLD",6241,"KRN",9.8,"NM","B","SDWLROIS",16)

"BLD",6241,"KRN",9.8,"NM","B","SDWLRP1",14)

"BLD",6241,"KRN",9.8,"NM","B","SDWLRSR",17)

"BLD",6241,"KRN",9.8,"NM","B","SDWLRSRS",18)

"BLD",6241,"KRN",9.8,"NM","B","SDWLTR",43)

"BLD",6241,"KRN",9.8,"NM","B","SDWLTR1",44)

"BLD",6241,"KRN",19,0)
19
"BLD",6241,"KRN",19,"NM",0)
^9.68A^9^7
"BLD",6241,"KRN",19,"NM",1,0)
SD WAIT LIST OPEN CLOSED ENTRY^^0
"BLD",6241,"KRN",19,"NM",3,0)
SD WAIT LIST UTILITIES^^3
"BLD",6241,"KRN",19,"NM",5,0)
SDWL ENTER/EDIT WITH ACA FLAG^^0
"BLD",6241,"KRN",19,"NM",6,0)
SD WAIT LIST STAT REPORT^^0
"BLD",6241,"KRN",19,"NM",7,0)
SD WAIT LIST ENROLL REPORT^^0
"BLD",6241,"KRN",19,"NM",8,0)
SD WAIT LIST REPORTS MENU^^3
"BLD",6241,"KRN",19,"NM",9,0)
SDWL BATCH CLINIC CHANGE^^0
"BLD",6241,"KRN",19,"NM","B","SD WAIT LIST ENROLL REPORT",7)

"BLD",6241,"KRN",19,"NM","B","SD WAIT LIST OPEN CLOSED ENTRY",1)

"BLD",6241,"KRN",19,"NM","B","SD WAIT LIST REPORTS MENU",8)

"BLD",6241,"KRN",19,"NM","B","SD WAIT LIST STAT REPORT",6)

"BLD",6241,"KRN",19,"NM","B","SD WAIT LIST UTILITIES",3)

"BLD",6241,"KRN",19,"NM","B","SDWL BATCH CLINIC CHANGE",9)

"BLD",6241,"KRN",19,"NM","B","SDWL ENTER/EDIT WITH ACA FLAG",5)

"BLD",6241,"KRN",19.1,0)
19.1
"BLD",6241,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6241,"KRN",101,0)
101
"BLD",6241,"KRN",101,"NM",0)
^9.68A^6^5
"BLD",6241,"KRN",101,"NM",1,0)
SDWL XFER ACC VIEW^^0
"BLD",6241,"KRN",101,"NM",2,0)
SDWL XFER ACC EWL^^0
"BLD",6241,"KRN",101,"NM",3,0)
SDWL XFER ACC MNU VIEW^^0
"BLD",6241,"KRN",101,"NM",5,0)
SDWL XFER ACC PCMM^^0
"BLD",6241,"KRN",101,"NM",6,0)
SDWL XFER ACC REJECT^^0
"BLD",6241,"KRN",101,"NM","B","SDWL XFER ACC EWL",2)

"BLD",6241,"KRN",101,"NM","B","SDWL XFER ACC MNU VIEW",3)

"BLD",6241,"KRN",101,"NM","B","SDWL XFER ACC PCMM",5)

"BLD",6241,"KRN",101,"NM","B","SDWL XFER ACC REJECT",6)

"BLD",6241,"KRN",101,"NM","B","SDWL XFER ACC VIEW",1)

"BLD",6241,"KRN",409.61,0)
409.61
"BLD",6241,"KRN",409.61,"NM",0)
^9.68A^4^4
"BLD",6241,"KRN",409.61,"NM",1,0)
SDWL TRANSFER ACC VIEW^^0
"BLD",6241,"KRN",409.61,"NM",2,0)
SDWL TRANSFER ACC MAIN^^0
"BLD",6241,"KRN",409.61,"NM",3,0)
SDWL TRANSFER REQ INAC^^0
"BLD",6241,"KRN",409.61,"NM",4,0)
SDWL TRANSFER REQ VIEW^^0
"BLD",6241,"KRN",409.61,"NM","B","SDWL TRANSFER ACC MAIN",2)

"BLD",6241,"KRN",409.61,"NM","B","SDWL TRANSFER ACC VIEW",1)

"BLD",6241,"KRN",409.61,"NM","B","SDWL TRANSFER REQ INAC",3)

"BLD",6241,"KRN",409.61,"NM","B","SDWL TRANSFER REQ VIEW",4)

"BLD",6241,"KRN",771,0)
771
"BLD",6241,"KRN",870,0)
870
"BLD",6241,"KRN",8989.51,0)
8989.51
"BLD",6241,"KRN",8989.52,0)
8989.52
"BLD",6241,"KRN",8994,0)
8994
"BLD",6241,"KRN","B",.4,.4)

"BLD",6241,"KRN","B",.401,.401)

"BLD",6241,"KRN","B",.402,.402)

"BLD",6241,"KRN","B",.403,.403)

"BLD",6241,"KRN","B",.5,.5)

"BLD",6241,"KRN","B",.84,.84)

"BLD",6241,"KRN","B",3.6,3.6)

"BLD",6241,"KRN","B",3.8,3.8)

"BLD",6241,"KRN","B",9.2,9.2)

"BLD",6241,"KRN","B",9.8,9.8)

"BLD",6241,"KRN","B",19,19)

"BLD",6241,"KRN","B",19.1,19.1)

"BLD",6241,"KRN","B",101,101)

"BLD",6241,"KRN","B",409.61,409.61)

"BLD",6241,"KRN","B",771,771)

"BLD",6241,"KRN","B",870,870)

"BLD",6241,"KRN","B",8989.51,8989.51)

"BLD",6241,"KRN","B",8989.52,8989.52)

"BLD",6241,"KRN","B",8994,8994)

"BLD",6241,"QUES",0)
^9.62^^
"BLD",6241,"REQB",0)
^9.611^2^2
"BLD",6241,"REQB",1,0)
SD*5.3*417^2
"BLD",6241,"REQB",2,0)
SD*5.3*497^2
"BLD",6241,"REQB","B","SD*5.3*417",1)

"BLD",6241,"REQB","B","SD*5.3*497",2)

"FIA",409.3)
SD WAIT LIST
"FIA",409.3,0)
^SDWL(409.3,
"FIA",409.3,0,0)
409.3IP
"FIA",409.3,0,1)
y^n^p^^^^n^^n
"FIA",409.3,0,10)

"FIA",409.3,0,11)

"FIA",409.3,0,"RLRO")

"FIA",409.3,0,"VR")
5.3^SD
"FIA",409.3,409.3)
1
"FIA",409.3,409.3,21)

"FIA",409.3,409.3,32)

"FIA",409.3,409.3,33)

"FIA",409.3,409.3,34)

"FIA",409.3,409.3,36)

"FIA",409.3,409.3,37)

"FIA",409.3,409.3,38)

"FIA",409.3,409.3,39)

"FIA",409.35)
SDWL TRANSFER REQUEST
"FIA",409.35,0)
^SDWL(409.35,
"FIA",409.35,0,0)
409.35P
"FIA",409.35,0,1)
y^y^f^^^^n
"FIA",409.35,0,10)

"FIA",409.35,0,11)

"FIA",409.35,0,"RLRO")

"FIA",409.35,0,"VR")
5.3^SD
"FIA",409.35,409.35)
0
"FIA",409.35,409.355)
0
"FIA",409.36)
SDWL TRANSFER ACCEPT
"FIA",409.36,0)
^SDWL(409.36,
"FIA",409.36,0,0)
409.36P
"FIA",409.36,0,1)
y^y^p^^^^n^^n
"FIA",409.36,0,10)

"FIA",409.36,0,11)

"FIA",409.36,0,"RLRO")

"FIA",409.36,0,"VR")
5.3^SD
"FIA",409.36,409.36)
1
"FIA",409.36,409.36,1)

"FIA",409.36,409.36,2)

"FIA",409.36,409.36,409.3)

"INI")
SDWLP446
"IX",409.35,409.35,"C",0)
409.35^C^ift^R^^F^IR^I^409.35^^^^^LS
"IX",409.35,409.35,"C",.1,0)
^^1^1^3050307^
"IX",409.35,409.35,"C",.1,1,0)
ift
"IX",409.35,409.35,"C",1)
Q
"IX",409.35,409.35,"C",2)
Q
"IX",409.35,409.35,"C",11.1,0)
^.114IA^^
"KRN",19,11367,-1)
3^8
"KRN",19,11367,0)
SD WAIT LIST REPORTS MENU^Wait List (Sch/PCMM) Reports^^M^^^^^^^^^^1^1
"KRN",19,11367,10,0)
^19.01IP^15^15
"KRN",19,11367,10,12,0)
11372^4^4
"KRN",19,11367,10,12,"^")
SD WAIT LIST STAT REPORT
"KRN",19,11367,10,13,0)
11374^5^5
"KRN",19,11367,10,13,"^")
SD WAIT LIST ENROLL REPORT
"KRN",19,11367,15)
D EN^SDWLKIL
"KRN",19,11367,20)
D EN^SDWLKIL
"KRN",19,11367,99)
60709,40937
"KRN",19,11367,"U")
WAIT LIST (SCH/PCMM) REPORTS
"KRN",19,11372,-1)
0^6
"KRN",19,11372,0)
SD WAIT LIST STAT REPORT^Wait List (Sch/PCMM) Statistic Report^^R^^^^^^^^^^^1
"KRN",19,11372,1,0)
^19.06^4^4^3061221^^^
"KRN",19,11372,1,1,0)
This report is a summary of the wait list activity for a user specified
"KRN",19,11372,1,2,0)
time frame. Prints the number of wait list entries that were added and
"KRN",19,11372,1,3,0)
dispositioned along with a detailed breakout.
"KRN",19,11372,1,4,0)
This report should be displayed in 132 column mode.
"KRN",19,11372,15)
D EN^SDWLKIL
"KRN",19,11372,25)
EN^SDWLQSR
"KRN",19,11372,"U")
WAIT LIST (SCH/PCMM) STATISTIC
"KRN",19,11374,-1)
0^7
"KRN",19,11374,0)
SD WAIT LIST ENROLL REPORT^Enrollment Wait List (Sch/PCMM) Statistic Report^^R^^^^^^^^^^^1
"KRN",19,11374,1,0)
^19.06^4^4^3061221^^^^
"KRN",19,11374,1,1,0)
Summary of wait list activity for a user specified time frame. Shows 
"KRN",19,11374,1,2,0)
number of wait list entries that were added and dispositioned along with 
"KRN",19,11374,1,3,0)
a detailed breakout, sorted in EWL Enrollment Priority order.
"KRN",19,11374,1,4,0)
This report should be displayed in 132 column mode.
"KRN",19,11374,15)
D EN^SDWLKIL
"KRN",19,11374,20)

"KRN",19,11374,25)
EN^SDWLQOI
"KRN",19,11374,99)
59079,56399
"KRN",19,11374,"U")
ENROLLMENT WAIT LIST (SCH/PCMM
"KRN",19,12520,-1)
3^3
"KRN",19,12520,0)
SD WAIT LIST UTILITIES^Wait List (Sch/PCMM) Utilities^^M^^SDWL MENU^^^^^^SCHEDULING^^1^1
"KRN",19,12520,10,0)
^19.01IP^5^5
"KRN",19,12520,10,3,0)
12609^3
"KRN",19,12520,10,3,"^")
SDWL BATCH CLINIC CHANGE
"KRN",19,12520,10,4,0)
12610^4
"KRN",19,12520,10,4,"^")
SDWL ENTER/EDIT WITH ACA FLAG
"KRN",19,12520,10,5,0)
12608^5
"KRN",19,12520,10,5,"^")
SD WAIT LIST OPEN CLOSED ENTRY
"KRN",19,12520,15)
D EXMNU^SDWLIFT
"KRN",19,12520,20)
D ENMNU^SDWLIFT
"KRN",19,12520,99)
60642,55062
"KRN",19,12520,"U")
WAIT LIST (SCH/PCMM) UTILITIES
"KRN",19,12608,-1)
0^1
"KRN",19,12608,0)
SD WAIT LIST OPEN CLOSED ENTRY^Open Closed EWL Entry^^R^^^^^^^^^^1^1
"KRN",19,12608,1,0)
^^4^4^3061026^
"KRN",19,12608,1,1,0)
This option will allow the user to manually open every type of closed
"KRN",19,12608,1,2,0)
entry. The system shall enter the code 'O' - Other in the Reopen Entry
"KRN",19,12608,1,3,0)
reason field, and the user must enter a required comment in the Reopen
"KRN",19,12608,1,4,0)
Comment field.
"KRN",19,12608,15)
D EN^SDWLKIL
"KRN",19,12608,20)
D EN^SDWLKIL
"KRN",19,12608,25)
EN^SDWLEC
"KRN",19,12608,"U")
OPEN CLOSED EWL ENTRY
"KRN",19,12609,-1)
0^9
"KRN",19,12609,0)
SDWL BATCH CLINIC CHANGE^Wait List Batch Clinic Change^^A^^SDWL MENU^^^^^^^^1
"KRN",19,12609,1,0)
^^4^4^3061026^
"KRN",19,12609,1,1,0)
This option allows the user to 'move' Open EWL entries from a specific
"KRN",19,12609,1,2,0)
clinic to a different clinic even if it involves a different Institution.
"KRN",19,12609,1,3,0)
New entries for the different clinic are created, and the original entries
"KRN",19,12609,1,4,0)
shall be closed with the new disposition code of 'CL' for Changed Clinic.
"KRN",19,12609,20)
D ^SDWLBACC
"KRN",19,12609,"U")
WAIT LIST BATCH CLINIC CHANGE
"KRN",19,12610,-1)
0^5
"KRN",19,12610,0)
SDWL ENTER/EDIT WITH ACA FLAG^Wait List Enter/Edit as a Scheduling Reminder^^A^^^^^^^^^^1
"KRN",19,12610,1,0)
^^2^2^3061026^
"KRN",19,12610,1,1,0)
This option allows the user to create an EWL entry that can be used as
"KRN",19,12610,1,2,0)
a Scheduling Reminder. 
"KRN",19,12610,20)
S SDWLACA=1 D ^SDWLE K SDWLACA
"KRN",19,12610,"U")
WAIT LIST ENTER/EDIT AS A SCHE
"KRN",101,4318,-1)
0^1
"KRN",101,4318,0)
SDWL XFER ACC VIEW^View Details^^A^^^^^^^^SCHEDULING
"KRN",101,4318,2,0)
^101.02A^2^2
"KRN",101,4318,2,1,0)
VE
"KRN",101,4318,2,2,0)
VI
"KRN",101,4318,2,"B","VE",1)

"KRN",101,4318,2,"B","VI",2)

"KRN",101,4318,15)
D EXIT^SDWLIFT6
"KRN",101,4318,20)
D EN^SDWLIFT6
"KRN",101,4318,99)
60642,55062
"KRN",101,4321,-1)
0^3
"KRN",101,4321,0)
SDWL XFER ACC MNU VIEW^SDWL Transfer Accept Details^^M^^^^^^^^SCHEDULING
"KRN",101,4321,4)
25
"KRN",101,4321,10,0)
^101.01PA^7^7
"KRN",101,4321,10,5,0)
4429^^^
"KRN",101,4321,10,5,"^")
SDWL XFER ACC EWL
"KRN",101,4321,10,6,0)
4430^^^
"KRN",101,4321,10,6,"^")
SDWL XFER ACC PCMM
"KRN",101,4321,10,7,0)
4323^^^
"KRN",101,4321,10,7,"^")
SDWL XFER ACC REJECT
"KRN",101,4321,26)
D SHOW^VALM
"KRN",101,4321,99)
60654,46599
"KRN",101,4323,-1)
0^6
"KRN",101,4323,0)
SDWL XFER ACC REJECT^Reject^OUT OF ORDER^A^^^^^^^^SCHEDULING
"KRN",101,4323,2,0)
^101.02A^1^1
"KRN",101,4323,2,1,0)
RJ
"KRN",101,4323,2,"B","RJ",1)

"KRN",101,4323,20)
D REJECT^SDWLIFT6
"KRN",101,4323,99)
60278,37548
"KRN",101,4429,-1)
0^2
"KRN",101,4429,0)
SDWL XFER ACC EWL^Add to EWL^^A^^^^^^^^
"KRN",101,4429,20)
D FULL^VALM1,EN2^SDWLE6(SDWLIFTN,SDWLDFN,SDWLTY)
"KRN",101,4429,99)
60642,55062
"KRN",101,4430,-1)
0^5
"KRN",101,4430,0)
SDWL XFER ACC PCMM^PCMM assign^^A^^^^^^^^
"KRN",101,4430,20)
D FULL^VALM1,PCMM^SDWLIFT6(SDWLIFTN,SDWLDFN)
"KRN",101,4430,99)
60642,55062
"KRN",409.61,754,-1)
0^2
"KRN",409.61,754,0)
SDWL TRANSFER ACC MAIN^1^^^3^21^1^1^Name^SDWL XFER ACC MNU MAIN^INTER-FACILITY TRANSFER ACCEPT^1
"KRN",409.61,754,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,754,"ARRAY")
 ^TMP("SDWLIFT",$J,"EP")
"KRN",409.61,754,"COL",0)
^409.621^5^4
"KRN",409.61,754,"COL",1,0)
NAME^4^26^Name
"KRN",409.61,754,"COL",2,0)
TRANSMISSION D/T^31^21^Transmission date
"KRN",409.61,754,"COL",4,0)
INSTITUTION^53^26^Sending Institution
"KRN",409.61,754,"COL",5,0)
STATUS^79^2^ST
"KRN",409.61,754,"COL","B","INSTITUTION",4)

"KRN",409.61,754,"COL","B","NAME",1)

"KRN",409.61,754,"COL","B","STATUS",5)

"KRN",409.61,754,"COL","B","TRANSMISSION D/T",2)

"KRN",409.61,754,"FNL")
D EXIT^SDWLIFT5
"KRN",409.61,754,"HDR")
D HD^SDWLIFT5
"KRN",409.61,754,"INIT")
D INIT^SDWLIFT5
"KRN",409.61,755,-1)
0^4
"KRN",409.61,755,0)
SDWL TRANSFER REQ VIEW^1^^^4^22^^1^^SDWL XFER REQ MNU VIEW^INTER-FACILITY XFER DETAILS^1
"KRN",409.61,755,"FNL")
D EXIT^SDWLIFT2
"KRN",409.61,755,"HDR")
D HD^SDWLIFT2
"KRN",409.61,755,"INIT")
D INIT^SDWLIFT2
"KRN",409.61,756,-1)
0^1
"KRN",409.61,756,0)
SDWL TRANSFER ACC VIEW^1^^^3^20^1^1^^SDWL XFER ACC MNU VIEW^INTER-FACILITY XFER DETAILS
"KRN",409.61,756,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,756,"FNL")
D EXIT^SDWLIFT6
"KRN",409.61,756,"HDR")
D HD^SDWLIFT6
"KRN",409.61,756,"INIT")
D INIT^SDWLIFT6
"KRN",409.61,758,-1)
0^3
"KRN",409.61,758,0)
SDWL TRANSFER REQ INAC^1^^^4^22^^1^^SDWL XFER REQ MNU INAC^INTER-FACILITY XFER INACTIVE^1
"KRN",409.61,758,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,758,"ARRAY")
 ^TMP("SDWLIFT",$J,"EP")
"KRN",409.61,758,"COL",0)
^409.621^4^4
"KRN",409.61,758,"COL",1,0)
NAME^4^27^Name
"KRN",409.61,758,"COL",2,0)
SSN^33^11^SSN
"KRN",409.61,758,"COL",3,0)
INSTITUTION^47^20^Transfer to
"KRN",409.61,758,"COL",4,0)
STATUS^69^12^Status
"KRN",409.61,758,"COL","B","INSTITUTION",3)

"KRN",409.61,758,"COL","B","NAME",1)

"KRN",409.61,758,"COL","B","SSN",2)

"KRN",409.61,758,"COL","B","STATUS",4)

"KRN",409.61,758,"FNL")
D EXIT^SDWLIFT1
"KRN",409.61,758,"HDR")
D HD^SDWLIFT1
"KRN",409.61,758,"INIT")
D INIT^SDWLIFT1(2)
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
446^3070828^123457083
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
42
"RTN","SCMCQK1")
0^39^B90423070^B91901955
"RTN","SCMCQK1",1,0)
SCMCQK1 ;ALB/REW - Single Pt Tm/Pt Tm Pos Assign and Discharge ; 07 Oct 2002  12:10 PM  ; Compiled April 12, 2007 10:03:59
"RTN","SCMCQK1",2,0)
 ;;5.3;Scheduling;**148,177,231,264,436,297,446**;AUG 13, 1993;Build 77
"RTN","SCMCQK1",3,0)
 ;
"RTN","SCMCQK1",4,0)
 ;04/25/2006 SD*5.3*446 INTER-FACILITY TRANSFER
"RTN","SCMCQK1",5,0)
UNTP ;unassign patient from pc prac position
"RTN","SCMCQK1",6,0)
 I '$G(SCTP) W !,"No position defined" Q
"RTN","SCMCQK1",7,0)
 N OK,SCER,SCCL,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK1",8,0)
 S OK=0
"RTN","SCMCQK1",9,0)
 W !,"About to Unassign "_$$NAME(DFN)_" from: ",!,?8,$$POSITION(SCTP)_" position   ["_$P($$GETPRTP^SCAPMCU2(SCTP,DT),U,2)_"]"
"RTN","SCMCQK1",10,0)
 S SCDISCH=$$DATE("D")
"RTN","SCMCQK1",11,0)
 G:SCDISCH<1 QTUNTP
"RTN","SCMCQK1",12,0)
 G:'$$CONFIRM() QTUNTP
"RTN","SCMCQK1",13,0)
 S OK=1 ;$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)
"RTN","SCMCQK1",14,0)
 G:OK'>0 QTUNTP
"RTN","SCMCQK1",15,0)
 S SCCL=$P($G(^SCTM(404.57,+$G(SCTP),0)),U,9)
"RTN","SCMCQK1",16,0)
 I SCCL D DISCL
"RTN","SCMCQK1",17,0)
QTUNTP W !,"Position Unassignment "_$S(OK:"made.",1:"NOT made.")
"RTN","SCMCQK1",18,0)
 Q
"RTN","SCMCQK1",19,0)
ENRCL ;
"RTN","SCMCQK1",20,0)
 N SCRESTA,SCREST,SCCLNM,SCTM
"RTN","SCMCQK1",21,0)
 N SCCL
"RTN","SCMCQK1",22,0)
 F SCCL=0:0 S SCCL=$O(^SCTM(404.57,+$G(SCTP),5,SCCL)) Q:'SCCL  D
"RTN","SCMCQK1",23,0)
 .Q:$$ACTCL(DFN,SCCL)
"RTN","SCMCQK1",24,0)
 .W !!!,"The "_$$POSITION(SCTP)_" is associated with the ",$$CLINIC(SCCL)_" clinic."
"RTN","SCMCQK1",25,0)
 .;SCRESTA = Array of pt's teams causing restricted consults
"RTN","SCMCQK1",26,0)
 .N SCRESTA
"RTN","SCMCQK1",27,0)
 .S SCREST=$$RESTPT^SCAPMCU4(DFN,DT,"SCRESTA")
"RTN","SCMCQK1",28,0)
 .I SCREST D
"RTN","SCMCQK1",29,0)
 ..N SCTM
"RTN","SCMCQK1",30,0)
 ..S SCCLNM=Y
"RTN","SCMCQK1",31,0)
 ..W !,?5,"Patient has restricted consults due to team assignment(s):"
"RTN","SCMCQK1",32,0)
 ..S SCTM=0
"RTN","SCMCQK1",33,0)
 ..F  S SCTM=$O(SCRESTA(SCTM)) Q:'SCTM  W !,?10,SCRESTA(SCTM)
"RTN","SCMCQK1",34,0)
 .I SCREST&'$G(SCOKCONS) D  G QTECL
"RTN","SCMCQK1",35,0)
 ..W !,?5,"This patient may only be enrolled in clinics via"
"RTN","SCMCQK1",36,0)
 ..W !,?15,"Edit Clinic Enrollment Data option"
"RTN","SCMCQK1",37,0)
 .W !,"Do you wish to enroll the patient from this clinic on "
"RTN","SCMCQK1",38,0)
 .S Y=SCASSDT X ^DD("DD") W Y,"?"
"RTN","SCMCQK1",39,0)
 .I $$YESNO() D
"RTN","SCMCQK1",40,0)
 ..W !,"Clinic Enrollment"
"RTN","SCMCQK1",41,0)
 ..I $$ACPTCL^SCAPMC18(DFN,SCCL,,SCASSDT,"SCENER") W " made"
"RTN","SCMCQK1",42,0)
 ..E  W "NOT made"
"RTN","SCMCQK1",43,0)
QTECL Q
"RTN","SCMCQK1",44,0)
DISCL ;
"RTN","SCMCQK1",45,0)
 N SCCL F SCCL=0:0 S SCCL=$O(^SCTM(404.57,+$G(SCTP),5,SCCL)) Q:'SCCL  D
"RTN","SCMCQK1",46,0)
 .Q:'$$ACTCL(DFN,SCCL)
"RTN","SCMCQK1",47,0)
 .W !,$$NAME(DFN)," is enrolled in the associated "_$$CLINIC(SCCL)_" clinic."
"RTN","SCMCQK1",48,0)
 .W !,"Do you wish to discharge the patient from this clinic on "
"RTN","SCMCQK1",49,0)
 .S Y=SCDISCH X ^DD("DD") W Y,"?"
"RTN","SCMCQK1",50,0)
 .Q:'$$YESNO()
"RTN","SCMCQK1",51,0)
 .N SDFN,SDCLN S SDFN=DFN,SDCLN=SCCL
"RTN","SCMCQK1",52,0)
 .N DFN D ^SDCD
"RTN","SCMCQK1",53,0)
QTDCL Q
"RTN","SCMCQK1",54,0)
UNTM ;
"RTN","SCMCQK1",55,0)
 ;assign patient from pc team (and pc position if possible)
"RTN","SCMCQK1",56,0)
 N OK,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS,OK2,OK3
"RTN","SCMCQK1",57,0)
 S OK=0
"RTN","SCMCQK1",58,0)
 W !!,"About to Unassign "_$$NAME(DFN)_" from "_$$TEAMNM(SCTM)_" team"
"RTN","SCMCQK1",59,0)
 W:'SCTPSTAT !,?5,"AND from "_$$POSITION(SCTP)_" position  ["_$$WRITETP^SCMCDD1(SCTP)_"]"
"RTN","SCMCQK1",60,0)
 S SCDISCH=$$DATE("D")
"RTN","SCMCQK1",61,0)
 G:SCDISCH<1 QTUNTM
"RTN","SCMCQK1",62,0)
 G:'$$CONFIRM() QTUNTM
"RTN","SCMCQK1",63,0)
 IF 'SCTPSTAT D  G:OK2'>0 QTUNTM
"RTN","SCMCQK1",64,0)
 .W !,"PC assignment unassigned."
"RTN","SCMCQK1",65,0)
 .S OK2=$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)
"RTN","SCMCQK1",66,0)
 .IF OK2>0 D
"RTN","SCMCQK1",67,0)
 ..W "made."
"RTN","SCMCQK1",68,0)
 ..S SCCL=$P(^SCTM(404.57,SCTP,0),U,9)
"RTN","SCMCQK1",69,0)
 ..D:SCCL DISCL
"RTN","SCMCQK1",70,0)
 S OK3=$$ALLPOS()
"RTN","SCMCQK1",71,0)
 IF $$OKINPTTM^SCMCTMU2(DFN,SCTM,SCDISCH) D
"RTN","SCMCQK1",72,0)
 .S OK=$$INPTSCTM^SCAPMC7(DFN,SCTM,SCDISCH,.SCER)
"RTN","SCMCQK1",73,0)
 ELSE  D
"RTN","SCMCQK1",74,0)
 .W !,"Future/Current Patient-Position Assignment exists"
"RTN","SCMCQK1",75,0)
QTUNTM W !,"Team Unassignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK1",76,0)
 Q
"RTN","SCMCQK1",77,0)
ALLPOS() ;unassign all patient-positions for team
"RTN","SCMCQK1",78,0)
 ;not stand-alone - needs dfn,sctm
"RTN","SCMCQK1",79,0)
 ;return 1=No positions left assigned|0=At least 1 position assigned
"RTN","SCMCQK1",80,0)
 N OK,SCDT1,SCPTTPX,SCERRR,SCTP,SCCNT,SCPTTPI,SCLOC,SCNODE,SCPTTP2
"RTN","SCMCQK1",81,0)
 S SCDT1("BEGIN")=SCDISCH+1
"RTN","SCMCQK1",82,0)
 S SCDT1("END")=3990101
"RTN","SCMCQK1",83,0)
 S SCDT1("INCL")=0  ;anytime from now to future
"RTN","SCMCQK1",84,0)
 S OK=$$TPPT^SCAPMC23(DFN,"SCDT1",,,,,,"SCPTTPX",.SCERRR)
"RTN","SCMCQK1",85,0)
 S (SCTP,SCCNT)=0
"RTN","SCMCQK1",86,0)
 W !,"Checking for other position assignments to team..."
"RTN","SCMCQK1",87,0)
 F  S SCTP=$O(SCPTTPX("SCTP",SCTM,SCTP)) Q:'SCTP  S SCCNT=SCCNT+1 D
"RTN","SCMCQK1",88,0)
 .S SCPTTPI=$O(SCPTTPX("SCTP",SCTM,SCTP,9999999),-1)
"RTN","SCMCQK1",89,0)
 .S SCLOC=$O(SCPTTPX("SCTP",SCTM,SCTP,SCPTTPI,0))
"RTN","SCMCQK1",90,0)
 .S SCNODE=SCPTTPX(SCLOC)
"RTN","SCMCQK1",91,0)
 .S SCPTTP2(SCTP)=""
"RTN","SCMCQK1",92,0)
 .W !,?3,$P(SCNODE,U,2),"   ",$P(SCNODE,U,8)
"RTN","SCMCQK1",93,0)
 .IF $P(SCNODE,U,6)!(SCDISCH'>$P(SCNODE,U,5)) D
"RTN","SCMCQK1",94,0)
 ..W !,?5,"Unassignment date already exists or unassignment after assignment date"
"RTN","SCMCQK1",95,0)
 ..W !,?15,"- Correct via PCMM GUI"
"RTN","SCMCQK1",96,0)
 ..S OK=0
"RTN","SCMCQK1",97,0)
 W !,?5,$S(SCCNT:SCCNT,1:"No")_" current/future position assignment(s)"
"RTN","SCMCQK1",98,0)
 G:'OK!('SCCNT) QTALL
"RTN","SCMCQK1",99,0)
 W !!,"About to unassign the above patient-position assignments"
"RTN","SCMCQK1",100,0)
 IF '$$CONFIRM S OK=0 G QTALL
"RTN","SCMCQK1",101,0)
 S SCTP=0
"RTN","SCMCQK1",102,0)
 F  S SCTP=$O(SCPTTP2(SCTP)) Q:'SCTP  D  Q:'OK
"RTN","SCMCQK1",103,0)
 .S OK=$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)
"RTN","SCMCQK1",104,0)
 .W:'OK !,?10,"Problem with unassignment, correct via PCMM GUI"
"RTN","SCMCQK1",105,0)
QTALL Q OK
"RTN","SCMCQK1",106,0)
ASTM ;assign patient to PC team
"RTN","SCMCQK1",107,0)
 N DIC,Y,OK,SCTM,SCTMFLDS,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK1",108,0)
 S OK=0
"RTN","SCMCQK1",109,0)
 W !!,"About to Assign "_$$NAME(DFN)_" to a primary care team"
"RTN","SCMCQK1",110,0)
 I $$SC(DFN) W !!,"********** This patient is 50 percent or greater service-connected ************"
"RTN","SCMCQK1",111,0)
 S DIC="^SCTM(404.51,"
"RTN","SCMCQK1",112,0)
 S DIC(0)="AEMQZ"
"RTN","SCMCQK1",113,0)
 S DIC("S")="IF $$ACTTM^SCMCTMU(Y,DT)&($P($G(^SCTM(404.51,Y,0)),U,5))"
"RTN","SCMCQK1",114,0)
 ;select from active teams that can be PC Teams
"RTN","SCMCQK1",115,0)
 D ^DIC
"RTN","SCMCQK1",116,0)
 G:Y<1 QTASTM
"RTN","SCMCQK1",117,0)
 S SCTM=+Y
"RTN","SCMCQK1",118,0)
 ;The following logic to present warning message added per SD*5.3*436
"RTN","SCMCQK1",119,0)
 I $P($G(^SCTM(404.51,SCTM,0)),U,10) D  G:'SCFLAG QTASTM
"RTN","SCMCQK1",120,0)
 .S SCFLAG=0
"RTN","SCMCQK1",121,0)
 .W !!,"This team is closed to further patient assignments.  While you are"
"RTN","SCMCQK1",122,0)
 .W !,"not currently prevented from assigning this patient, you may want to"
"RTN","SCMCQK1",123,0)
 .W !,"check before continuing."
"RTN","SCMCQK1",124,0)
 .Q:'$$YESNO1()  ; new function call per SD*5.3*436
"RTN","SCMCQK1",125,0)
 .Q:'$$CONFIRM()
"RTN","SCMCQK1",126,0)
 .S SCFLAG=1 W !
"RTN","SCMCQK1",127,0)
 S SCASSDT=$$DATE("A")
"RTN","SCMCQK1",128,0)
 G:SCASSDT<1 QTASTM
"RTN","SCMCQK1",129,0)
 S SCTMCT=$$TEAMCNT^SCAPMCU1(SCTM)
"RTN","SCMCQK1",130,0)
 S SCTMMAX=$P($$GETEAM^SCAPMCU3(SCTM),"^",8)
"RTN","SCMCQK1",131,0)
 I SCTMCT'<SCTMMAX  D  G QTASTM:$$WAITYN(),QTASTM:'$$YESNO2()
"RTN","SCMCQK1",132,0)
 .W !,"This assignment will reach or exceeded the maximum set for this team."
"RTN","SCMCQK1",133,0)
 .W !,"Currently assigned: "_SCTMCT
"RTN","SCMCQK1",134,0)
 .W !,"Maximum set for team: "_SCTMMAX
"RTN","SCMCQK1",135,0)
 I SCTMCT<SCTMMAX,'$$CONFIRM() G QTASTM
"RTN","SCMCQK1",136,0)
 S SCTM=+Y
"RTN","SCMCQK1",137,0)
 ;setup fields
"RTN","SCMCQK1",138,0)
 S SCTMFLDS(.08)=1 ;primary care assignment
"RTN","SCMCQK1",139,0)
 S SCTMFLDS(.11)=$G(DUZ,.5)
"RTN","SCMCQK1",140,0)
 D NOW^%DTC S SCTMFLDS(.12)=%
"RTN","SCMCQK1",141,0)
 IF $$ACPTTM^SCAPMC(DFN,SCTM,"SCTMFLDS",SCASSDT,"SCTPTME") D
"RTN","SCMCQK1",142,0)
 .S SCSELECT=$$SELPOS()
"RTN","SCMCQK1",143,0)
 .D:$L(SCSELECT) ASTP ;prompt for position prompt
"RTN","SCMCQK1",144,0)
 .S OK=1
"RTN","SCMCQK1",145,0)
QTASTM W !,"Team Assignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK1",146,0)
 S:$D(SDWLPCMM) SDWLPCMM=OK  ; 446
"RTN","SCMCQK1",147,0)
 Q
"RTN","SCMCQK1",148,0)
ASTP ;assign patient to PC practitioner
"RTN","SCMCQK1",149,0)
 N DIC,Y,OK,SCCL,X,SCTPFLDS,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK1",150,0)
 S OK=0
"RTN","SCMCQK1",151,0)
 W !!,"About to Assign "_$$NAME(DFN)_" to PC Position Assignment"
"RTN","SCMCQK1",152,0)
 I $$SC(DFN) W !!,"********** This patient is 50 percent or greater service-connected ************"
"RTN","SCMCQK1",153,0)
 ;lookup to display only position and [practitioner]
"RTN","SCMCQK1",154,0)
 IF SCSELECT="PRACT" D
"RTN","SCMCQK1",155,0)
 .S DIC("W")="N SCP1 S SCP1=$G(^SCTM(404.52,Y,0)) W ""    ["",$P($G(^VA(200,+$P(SCP1,U,3),0)),U,1),""]"""
"RTN","SCMCQK1",156,0)
 .S DIC("A")="POSITION's Current PRACTITIONER: "
"RTN","SCMCQK1",157,0)
 .S DIC="^SCTM(404.52,"
"RTN","SCMCQK1",158,0)
 .;Must be from team, must be activation,must not have future inactivation
"RTN","SCMCQK1",159,0)
 .S DIC("S")="I $$PRACSCR^SCMCQK1(Y)"
"RTN","SCMCQK1",160,0)
 .S D="C"
"RTN","SCMCQK1",161,0)
 ELSE  D
"RTN","SCMCQK1",162,0)
 .S DIC="^SCTM(404.57,"
"RTN","SCMCQK1",163,0)
 .S D="B"
"RTN","SCMCQK1",164,0)
 .S DIC("A")="POSITION's Name: "
"RTN","SCMCQK1",165,0)
 .S DIC("S")="I $$POSSCR^SCMCQK1(Y)"
"RTN","SCMCQK1",166,0)
 S DIC(0)="AEMQZ"
"RTN","SCMCQK1",167,0)
 D MIX^DIC1
"RTN","SCMCQK1",168,0)
 G:Y<1 QTASTP
"RTN","SCMCQK1",169,0)
 IF SCSELECT="PRACT" D
"RTN","SCMCQK1",170,0)
 .S SCTP=$P(Y,U,2)
"RTN","SCMCQK1",171,0)
 ELSE  D
"RTN","SCMCQK1",172,0)
 .S SCTP=$P(Y,U,1)
"RTN","SCMCQK1",173,0)
 S SCASSDT=$$DATE("A")
"RTN","SCMCQK1",174,0)
 G:SCASSDT<1 QTASTP
"RTN","SCMCQK1",175,0)
 S SCTMCT=$$PCPOSCNT^SCAPMCU1(SCTP),SCTMMAX=+$P($G(^SCTM(404.57,SCTP,0)),U,8)
"RTN","SCMCQK1",176,0)
 I SCTMCT'<SCTMMAX D  G QTASTP:$$WAITYN,QTASTP:'$$YESNO2
"RTN","SCMCQK1",177,0)
 .W !,"This assignment will reach or exceeded the maximum set for this position."
"RTN","SCMCQK1",178,0)
 .W !,"Currently assigned: "_SCTMCT
"RTN","SCMCQK1",179,0)
 .W !,"Maximum set for position: "_SCTMMAX
"RTN","SCMCQK1",180,0)
 G:'$$CONFIRM() QTASTP
"RTN","SCMCQK1",181,0)
 ;setup fields
"RTN","SCMCQK1",182,0)
 S SCTPFLDS(.03)=SCASSDT
"RTN","SCMCQK1",183,0)
 S SCTPFLDS(.05)=1 ;pc pract role
"RTN","SCMCQK1",184,0)
 S SCTPFLDS(.06)=$G(DUZ,.5)
"RTN","SCMCQK1",185,0)
 D NOW^%DTC S SCTPFLDS(.07)=%
"RTN","SCMCQK1",186,0)
 IF $$ACPTTP^SCAPMC21(DFN,SCTP,"SCTPFLDS",SCASSDT,"SCTPTME",0) D
"RTN","SCMCQK1",187,0)
 .S OK=1
"RTN","SCMCQK1",188,0)
 .S SCCL=$O(^SCTM(404.57,+$G(SCTP),5,0))
"RTN","SCMCQK1",189,0)
 .D:SCCL ENRCL
"RTN","SCMCQK1",190,0)
QTASTP W !,"Position Assignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK1",191,0)
 S:$D(SDWLPCMM) SDWLPCMM=OK ;446
"RTN","SCMCQK1",192,0)
 Q
"RTN","SCMCQK1",193,0)
NAME(DFN) ;return patient name
"RTN","SCMCQK1",194,0)
 Q $P($G(^DPT(DFN,0)),U,1)
"RTN","SCMCQK1",195,0)
POSITION(SCTP) ;return position name
"RTN","SCMCQK1",196,0)
 Q $P($G(^SCTM(404.57,SCTP,0)),U,1)
"RTN","SCMCQK1",197,0)
TEAMNM(SCTM) ;return team name
"RTN","SCMCQK1",198,0)
 Q $P($G(^SCTM(404.51,SCTM,0)),U,1)
"RTN","SCMCQK1",199,0)
CLINIC(SCCL) ;return clinic name
"RTN","SCMCQK1",200,0)
 Q $P($G(^SC(+SCCL,0)),U,1)
"RTN","SCMCQK1",201,0)
YESNO() ;
"RTN","SCMCQK1",202,0)
 N DIR,X,Y
"RTN","SCMCQK1",203,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","SCMCQK1",204,0)
 D ^DIR
"RTN","SCMCQK1",205,0)
 Q Y>0
"RTN","SCMCQK1",206,0)
YESNO1() ; added per SD*5.3*436
"RTN","SCMCQK1",207,0)
 N DIR,X,Y
"RTN","SCMCQK1",208,0)
 S DIR(0)="Y",DIR("A")="Do you wish to assign this patient now (Yes/No)?"
"RTN","SCMCQK1",209,0)
 S DIR("B")="NO"
"RTN","SCMCQK1",210,0)
 D ^DIR
"RTN","SCMCQK1",211,0)
 Q Y>0
"RTN","SCMCQK1",212,0)
YESNO2() ;
"RTN","SCMCQK1",213,0)
 N DIR,X,Y
"RTN","SCMCQK1",214,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","SCMCQK1",215,0)
 S DIR("A")="Do you wish to continue with the assignment (Yes/No)?"
"RTN","SCMCQK1",216,0)
 D ^DIR
"RTN","SCMCQK1",217,0)
 Q Y>0
"RTN","SCMCQK1",218,0)
CONFIRM() ;confirmation call
"RTN","SCMCQK1",219,0)
 N DIR,X,Y
"RTN","SCMCQK1",220,0)
 S DIR("A")="Are you sure (Yes/No)"
"RTN","SCMCQK1",221,0)
 S DIR(0)="Y"
"RTN","SCMCQK1",222,0)
 D ^DIR
"RTN","SCMCQK1",223,0)
 Q +Y=1
"RTN","SCMCQK1",224,0)
SELPOS() ;return way to select position: 1=PRACT,2=POSIT,3=NONE
"RTN","SCMCQK1",225,0)
 N DIR,X,Y
"RTN","SCMCQK1",226,0)
 W !,"Choose way to select PC POSITION Assignment: "
"RTN","SCMCQK1",227,0)
 S DIR(0)="SO^0:NONE;1:BY PRACTITIONER ASSIGNMENT;2:BY POSITION ASSIGNMENT"
"RTN","SCMCQK1",228,0)
 S DIR("B")=1
"RTN","SCMCQK1",229,0)
 D ^DIR
"RTN","SCMCQK1",230,0)
 Q $S(Y'>0:"",+Y=1:"PRACT",1:"POSIT")
"RTN","SCMCQK1",231,0)
DATE(TYPE) ;return date type=A or D
"RTN","SCMCQK1",232,0)
 N DIR,X,Y
"RTN","SCMCQK1",233,0)
 S DIR("A")=$S(TYPE="A":"Assignment",1:"Unassignment")_" date: "
"RTN","SCMCQK1",234,0)
 S DIR(0)="DA^::EXP"
"RTN","SCMCQK1",235,0)
 S Y=$S($D(SCDISCH):SCDISCH,$D(SCASSDT):SCASSDT,(TYPE="A"):"TODAY",1:"TODAY-1")
"RTN","SCMCQK1",236,0)
 X ^DD("DD")
"RTN","SCMCQK1",237,0)
 S DIR("B")=Y
"RTN","SCMCQK1",238,0)
 D ^DIR
"RTN","SCMCQK1",239,0)
 Q Y
"RTN","SCMCQK1",240,0)
ACTCL(DFN,SCCL) ;is patient enrolled in clinic?
"RTN","SCMCQK1",241,0)
 N SCXX
"RTN","SCMCQK1",242,0)
 S SCXX=$O(^DPT(DFN,"DE","B",SCCL,9999),-1)
"RTN","SCMCQK1",243,0)
 Q $S('SCXX:0,($P(^DPT(DFN,"DE",+SCXX,0),U,2)="I"):0,1:1)
"RTN","SCMCQK1",244,0)
PRACSCR(SC40452) ;screen for for file 404.52
"RTN","SCMCQK1",245,0)
 N SCP,SCNODE,OK
"RTN","SCMCQK1",246,0)
 S SCP=$G(^SCTM(404.52,SC40452,0))
"RTN","SCMCQK1",247,0)
 S OK=0
"RTN","SCMCQK1",248,0)
 G:'SCP QTPP
"RTN","SCMCQK1",249,0)
 S SCNODE=$G(^SCTM(404.57,+SCP,0))
"RTN","SCMCQK1",250,0)
 S OK=$S($P(SCNODE,U,2)'=SCTM:0,'$P(SCNODE,U,4):0,($O(^SCTM(404.52,"AIDT",+SCP,1,""))'=-$P(SCP,U,2)):0,($O(^SCTM(404.52,"AIDT",+SCP,0,-$P(SCP,U,2)),-1)):0,($$ACTTP^SCMCTPU(+SCP)>0):1,1:0)
"RTN","SCMCQK1",251,0)
QTPP Q OK
"RTN","SCMCQK1",252,0)
POSSCR(SCTP) ;screen for file 404.57
"RTN","SCMCQK1",253,0)
 N SCNODE
"RTN","SCMCQK1",254,0)
 S SCNODE=$G(^SCTM(404.57,SCTP,0))
"RTN","SCMCQK1",255,0)
 Q $S($P(SCNODE,U,2)'=SCTM:0,'$P(SCNODE,U,4):0,($$ACTTP^SCMCTPU(SCTP)>0):1,1:0)
"RTN","SCMCQK1",256,0)
 Q
"RTN","SCMCQK1",257,0)
WAITYN() ;
"RTN","SCMCQK1",258,0)
 N %,OK,Y
"RTN","SCMCQK1",259,0)
 I SCTMCT<SCTMMAX Q 0
"RTN","SCMCQK1",260,0)
 N A,SC S A=$$ONWAIT^SCMCWAIT(DFN) I A W:(+A=3) !,$P(A,";",2) I $S($G(SCTP):A>1,1:1) Q 0
"RTN","SCMCQK1",261,0)
 N DIR,X,Y
"RTN","SCMCQK1",262,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","SCMCQK1",263,0)
 S DIR("A")="Do you wish to place the patient on the wait list (Yes/No)?"
"RTN","SCMCQK1",264,0)
 D ^DIR
"RTN","SCMCQK1",265,0)
 I Y=1 S Y=$$WAITS^SCMCWAIT(DFN,SCTM,$G(SCTP),$G(SC)) I Y>0 W !,"Patient Placed on Wait List"
"RTN","SCMCQK1",266,0)
 Q Y>0
"RTN","SCMCQK1",267,0)
SC(DFN) ;Is patient 50 to 100%
"RTN","SCMCQK1",268,0)
 D ELIG^VADPT Q $P($G(VAEL(3)),U,2)>49
"RTN","SCMCWAIT")
0^31^B45006775^B13044802
"RTN","SCMCWAIT",1,0)
SCMCWAIT ;ALB/SCK - Broker Utilities for Placement on Wait List ; 30 Oct 2002  3:42 PM  ; Compiled May 25, 2007 09:07:17
"RTN","SCMCWAIT",2,0)
 ;;5.3;Scheduling;**264,297,446**;AUG 13, 1993;Build 77
"RTN","SCMCWAIT",3,0)
 ;
"RTN","SCMCWAIT",4,0)
 Q
"RTN","SCMCWAIT",5,0)
 ;
"RTN","SCMCWAIT",6,0)
WAIT(SCOK,SC) ; Place patient on wait list
"RTN","SCMCWAIT",7,0)
 ;  'SC BLD PAT CLN LIST'
"RTN","SCMCWAIT",8,0)
 ;
"RTN","SCMCWAIT",9,0)
 ;M ^JDS=SC
"RTN","SCMCWAIT",10,0)
 N COMMENT,SDTM,SDCNT,SDINS,SDINTR,SDMTM,SDREJ,SDWLIN
"RTN","SCMCWAIT",11,0)
 S TEAM=$G(SC("TEAM")),POS=$G(SC("POSITION")),DFN=$G(SC("DFN")),COMMENT=$G(SC("COMMENT")),SC=$G(SC("SC"))
"RTN","SCMCWAIT",12,0)
 S SDWLIN=+$P($G(^SCTM(404.51,+$G(TEAM),0)),U,7),SDINTR=$G(SC("SDINTR")),SDREJ=$G(SC("SDREJ")),SDMTM=$G(SC("SDMTM"))
"RTN","SCMCWAIT",13,0)
 ; check if transfer and if multiple teams in institution
"RTN","SCMCWAIT",14,0)
 S SDCNT=0,SDINTR="",SDREJ="",SDMTM="",SDCC=TEAM
"RTN","SCMCWAIT",15,0)
 ;identify INTRA-transfer
"RTN","SCMCWAIT",16,0)
 ;- is patient assigned to PC provider?
"RTN","SCMCWAIT",17,0)
 I 'POS&TEAM D PCPVER(DFN,.SDTM) D  ; return current PCP team or 0
"RTN","SCMCWAIT",18,0)
 .I SDTM I $P($G(^SCTM(404.51,SDTM,0)),U,7)'=SDWLIN S SDINTR=1 ; inter transfer ; different institution
"RTN","SCMCWAIT",19,0)
 .I 'SDTM S SDINS="" F  S SDINS=$O(^SCTM(404.51,"AINST",SDINS)) Q:SDINS=""  I SDINS'=SDWLIN D  Q:SDREJ
"RTN","SCMCWAIT",20,0)
 ..;check available PCMM teams in other institutions and if so set up rejection flag
"RTN","SCMCWAIT",21,0)
 ..N SDT S SDCNT=0,SDT=""
"RTN","SCMCWAIT",22,0)
 ..F  S SDT=$O(^SCTM(404.51,"AINST",SDINS,SDT)) Q:SDT=""  D  Q:SDREJ
"RTN","SCMCWAIT",23,0)
 ...I $$ACTTM^SCMCTMU(SDT)&($P($G(^SCTM(404.51,SDT,0)),U,5))&'$P($G(^SCTM(404.51,SDT,0)),U,10) D
"RTN","SCMCWAIT",24,0)
 ...N SCTMCT S SCTMCT=$$TEAMCNT^SCAPMCU1(SDT) ;currently assigned
"RTN","SCMCWAIT",25,0)
 ...N SCTMMAX S SCTMMAX=$P($$GETEAM^SCAPMCU3(SDT),"^",8) ;maximum set
"RTN","SCMCWAIT",26,0)
 ...I SCTMCT<SCTMMAX S SDREJ=1
"RTN","SCMCWAIT",27,0)
 ..;find all teams from institution SDWLIN
"RTN","SCMCWAIT",28,0)
 .I SDINTR S SDCNT=0,SDT="" D
"RTN","SCMCWAIT",29,0)
 ..F  S SDT=$O(^SCTM(404.51,"AINST",SDWLIN,SDT)) Q:SDT=""  I $P(^SCTM(404.51,SDT,0),U,5)=1 S TEAM(SDT)="",SDCNT=SDCNT+1
"RTN","SCMCWAIT",30,0)
 I SDCNT>1 S SDMTM=1 S SDCC="" F  S SDCC=$O(TEAM(SDCC)) Q:SDCC=""  N DR,Y D WT Q
"RTN","SCMCWAIT",31,0)
 I SDCNT'>1 D WT Q
"RTN","SCMCWAIT",32,0)
WT N RES D INPUT^SDWLRP1(.RES,DFN_U_$S(POS:2,1:1)_U_SDCC_U_$S(POS:POS_U_DUZ,1:U_DUZ)_U_COMMENT_U_SC_U_SDINTR_U_SDREJ_U_SDMTM)
"RTN","SCMCWAIT",33,0)
 I RES S SDWLRES=RES  ; 446
"RTN","SCMCWAIT",34,0)
 Q
"RTN","SCMCWAIT",35,0)
WAITS(DFN,TEAM,POS,SC) ; PLACE PATIENT ON WAIT LIST
"RTN","SCMCWAIT",36,0)
 N SDCC,SDTEAM,SDINTR,SDMTM,SDREJ,SDWLIN,SDWLRES
"RTN","SCMCWAIT",37,0)
 S SDTEAM=$G(TEAM)
"RTN","SCMCWAIT",38,0)
 ; check if transfer and if multiple teams in institution
"RTN","SCMCWAIT",39,0)
 S SDCNT=0,SDINTR="",SDREJ="",SDMTM="" I 'POS&TEAM D
"RTN","SCMCWAIT",40,0)
 .S SDWLIN=$P($G(^SCTM(404.51,TEAM,0)),U,7)
"RTN","SCMCWAIT",41,0)
 .;- is patient assigned to PC provider?
"RTN","SCMCWAIT",42,0)
 I 'POS&TEAM D PCPVER(DFN,.SDTM) D  ; return current PCP team or 0
"RTN","SCMCWAIT",43,0)
 .I SDTM I $P($G(^SCTM(404.51,SDTM,0)),U,7)'=SDWLIN S SDINTR=1 ; inter transfer ; different institution
"RTN","SCMCWAIT",44,0)
 .I 'SDTM S SDINS="" F  S SDINS=$O(^SCTM(404.51,"AINST",SDINS)) Q:SDINS=""  I SDINS'=SDWLIN D  Q:SDREJ
"RTN","SCMCWAIT",45,0)
 ..;check available PCMM teams in other institutions and if so set up rejection flag
"RTN","SCMCWAIT",46,0)
 ..N SDT S SDCNT=0,SDT=""
"RTN","SCMCWAIT",47,0)
 ..F  S SDT=$O(^SCTM(404.51,"AINST",SDINS,SDT)) Q:SDT=""  D  Q:SDREJ
"RTN","SCMCWAIT",48,0)
 ...I $$ACTTM^SCMCTMU(SDT)&($P($G(^SCTM(404.51,SDT,0)),U,5))&'$P($G(^SCTM(404.51,SDT,0)),U,10) D
"RTN","SCMCWAIT",49,0)
 ...N SCTMCT S SCTMCT=$$TEAMCNT^SCAPMCU1(SDT) ;currently assigned
"RTN","SCMCWAIT",50,0)
 ...N SCTMMAX S SCTMMAX=$P($$GETEAM^SCAPMCU3(SDT),"^",8) ;maximum set
"RTN","SCMCWAIT",51,0)
 ...I SCTMCT<SCTMMAX S SDREJ=1
"RTN","SCMCWAIT",52,0)
 ..;find all teams from institution SDWLIN
"RTN","SCMCWAIT",53,0)
 .I SDINTR S SDCNT=0,SDT="" D
"RTN","SCMCWAIT",54,0)
 ..F  S SDT=$O(^SCTM(404.51,"AINST",SDWLIN,SDT)) Q:SDT=""  I $P(^SCTM(404.51,SDT,0),U,5)=1 S TEAM(SDT)="",SDCNT=SDCNT+1
"RTN","SCMCWAIT",55,0)
 I SDCNT>1 S SDMTM=1 S SDCC="" F  S SDCC=$O(TEAM(SDCC)) Q:SDCC=""  S TEAM=SDCC N DR,Y S SDWLRES=$$WMT
"RTN","SCMCWAIT",56,0)
 I SDCNT'>1 N DR,Y S SDWLRES=$$WMT
"RTN","SCMCWAIT",57,0)
 S TEAM=$G(SDTEAM) Q $G(SDWLRES)
"RTN","SCMCWAIT",58,0)
WMT() N RES
"RTN","SCMCWAIT",59,0)
 D INPUT^SDWLRP1(.RES,DFN_U_$S(POS:2,1:1)_U_TEAM_U_$S(POS:POS_U_DUZ,1:U_DUZ)_"^^"_SC_U_SDINTR_U_SDREJ_U_SDMTM)
"RTN","SCMCWAIT",60,0)
 I $G(RES) D
"RTN","SCMCWAIT",61,0)
 .N DA,DIE,DIK,DR,OK
"RTN","SCMCWAIT",62,0)
 .S SDWLRES=RES  ; 446
"RTN","SCMCWAIT",63,0)
 .S OK=0,DA=+$P(RES,U,2),DIE="^SDWL(409.3,",DR="25;S OK=1"
"RTN","SCMCWAIT",64,0)
 .D ^DIE
"RTN","SCMCWAIT",65,0)
 .I 'OK S DIK=DIE D ^DIK W !,"Wait list entry deleted" S RES=0
"RTN","SCMCWAIT",66,0)
 Q $G(RES)
"RTN","SCMCWAIT",67,0)
TEAMRM(DFN,TEAM) ;
"RTN","SCMCWAIT",68,0)
 N SDTM D PCPVER(DFN,.SDTM) I 'SDTM D CLONE(DFN,TEAM) Q  ;not PC panel assignment
"RTN","SCMCWAIT",69,0)
 I SDTM'=TEAM D CLONE(DFN,TEAM) Q  ;TEAM IS NOT PCP
"RTN","SCMCWAIT",70,0)
 ;close EWL entries only if assignment to PC panel, not necessarily to a team                                   
"RTN","SCMCWAIT",71,0)
 N I
"RTN","SCMCWAIT",72,0)
 F I=0:0 S I=$O(^SDWL(409.3,"B",+$G(DFN),I)) Q:'I  S A=$G(^SDWL(409.3,I,0)) D
"RTN","SCMCWAIT",73,0)
 .I 12'[$P(A,U,5) Q
"RTN","SCMCWAIT",74,0)
 .;I $P(A,U,6)'=$G(TEAM) Q
"RTN","SCMCWAIT",75,0)
 .I $G(^SDWL(409.3,I,"DIS")) Q
"RTN","SCMCWAIT",76,0)
 .;INACTIVATE I
"RTN","SCMCWAIT",77,0)
 .N FDA S FDA(409.3,I_",",21)="SA"
"RTN","SCMCWAIT",78,0)
 .S FDA(409.3,I_",",19)=DT,FDA(409.3,I_",",23)="C"
"RTN","SCMCWAIT",79,0)
 .S FDA(409.3,I_",",20)=DUZ
"RTN","SCMCWAIT",80,0)
 .D UPDATE^DIE("","FDA")
"RTN","SCMCWAIT",81,0)
 Q
"RTN","SCMCWAIT",82,0)
POSRM(TEAMP,POS) ;
"RTN","SCMCWAIT",83,0)
 ; 
"RTN","SCMCWAIT",84,0)
 S DFN=+$G(^SCPT(404.42,+$G(TEAMP),0))
"RTN","SCMCWAIT",85,0)
 N SDTM D PCPVER(DFN,.SDTM) I 'SDTM D CLONE(DFN,TEAMP,POS) Q  ;not PC panel assignment
"RTN","SCMCWAIT",86,0)
 I SDTM'=TEAMP D CLONE(DFN,TEAMP,POS) Q
"RTN","SCMCWAIT",87,0)
 I $G(POS) I '$P($G(^SCPT(404.43,+POS,0)),U,5) Q   ;not pc
"RTN","SCMCWAIT",88,0)
 I '$P($G(^SCPT(404.42,+$G(TEAMP),0)),U,8) Q   ;not pc
"RTN","SCMCWAIT",89,0)
 ;S ^JDS("TEAMP")=TEAMP,^JDS("POS")=POS,^JDS("DFN")=DFN
"RTN","SCMCWAIT",90,0)
 N I
"RTN","SCMCWAIT",91,0)
 F I=0:0 S I=$O(^SDWL(409.3,"B",+$G(DFN),I)) Q:'I  S A=$G(^SDWL(409.3,I,0)) D
"RTN","SCMCWAIT",92,0)
 .I 12'[$P(A,U,5) Q
"RTN","SCMCWAIT",93,0)
 .;I $P(A,U,7)'=$G(POS) Q
"RTN","SCMCWAIT",94,0)
 .I $G(^SDWL(409.3,I,"DIS")) Q
"RTN","SCMCWAIT",95,0)
 .N FDA S FDA(409.3,I_",",21)="SA",FDA(409.3,I_",",23)="C"
"RTN","SCMCWAIT",96,0)
 .S FDA(409.3,I_",",19)=DT
"RTN","SCMCWAIT",97,0)
 .S FDA(409.3,I_",",20)=DUZ
"RTN","SCMCWAIT",98,0)
 .D FILE^DIE("","FDA")
"RTN","SCMCWAIT",99,0)
 .;INACTIVATE
"RTN","SCMCWAIT",100,0)
 Q
"RTN","SCMCWAIT",101,0)
CLONE(DFN,TEAM,POS) ;clean one entry only or two if position
"RTN","SCMCWAIT",102,0)
 N I,SDONE S SDONE=0
"RTN","SCMCWAIT",103,0)
 F I=0:0 S I=$O(^SDWL(409.3,"B",+$G(DFN),I)) Q:'I  S A=$G(^SDWL(409.3,I,0)) D  Q:SDONE
"RTN","SCMCWAIT",104,0)
 .I 12'[$P(A,U,5) Q
"RTN","SCMCWAIT",105,0)
 .I $P(A,U,5)=1 I $P(A,U,6)'=$G(TEAM) Q
"RTN","SCMCWAIT",106,0)
 .I $P(A,U,5)=2 I $P(A,U,6)'=$G(POS) Q
"RTN","SCMCWAIT",107,0)
 .I $G(^SDWL(409.3,I,"DIS")) Q
"RTN","SCMCWAIT",108,0)
 .;INACTIVATE I
"RTN","SCMCWAIT",109,0)
 .N FDA S FDA(409.3,I_",",21)="SA"
"RTN","SCMCWAIT",110,0)
 .S FDA(409.3,I_",",19)=DT,FDA(409.3,I_",",23)="C"
"RTN","SCMCWAIT",111,0)
 .S FDA(409.3,I_",",20)=DUZ
"RTN","SCMCWAIT",112,0)
 .D UPDATE^DIE("","FDA")
"RTN","SCMCWAIT",113,0)
 .S SDONE=1
"RTN","SCMCWAIT",114,0)
 Q
"RTN","SCMCWAIT",115,0)
PCPVER(DFN,SDTM) ;verify if PCP assignment
"RTN","SCMCWAIT",116,0)
 S SDTM=0 ; return 0 if no PCP assignment
"RTN","SCMCWAIT",117,0)
 K ^TMP("SDPCP",$J)
"RTN","SCMCWAIT",118,0)
 N SDATE,SDPCP
"RTN","SCMCWAIT",119,0)
 N SDI F SDI="BEGIN","END" S SDATE(SDI)=DT
"RTN","SCMCWAIT",120,0)
 S SDATE="SDATE",SDPCP="^TMP(""SDPCP"",$J)"
"RTN","SCMCWAIT",121,0)
 ;
"RTN","SCMCWAIT",122,0)
 N SDI S SDI=$$GETALL^SCAPMCA(DFN,.SDATE,SDPCP)
"RTN","SCMCWAIT",123,0)
 N SDII S SDII=0
"RTN","SCMCWAIT",124,0)
 F  S SDII=$O(^TMP("SDPCP",$J,DFN,"PCPOS",SDII)) Q:'SDII  D
"RTN","SCMCWAIT",125,0)
 .N SDX S SDX=^TMP("SDPCP",$J,DFN,"PCPOS",SDII)
"RTN","SCMCWAIT",126,0)
 .I +$P(SDX,U,7)'=2 Q  ;PCP role
"RTN","SCMCWAIT",127,0)
 .I +$P(SDX,U,6)>0&(+$P(SDX,U,6)<DT) Q
"RTN","SCMCWAIT",128,0)
 .S SDTM=$P(SDX,U,3)
"RTN","SCMCWAIT",129,0)
 Q
"RTN","SCMCWAIT",130,0)
ONWAIT(DFN) ;is patient on wait list
"RTN","SCMCWAIT",131,0)
 D DEM^VADPT I $G(VADM(6)) Q 9  ;Patient is dead
"RTN","SCMCWAIT",132,0)
 N I,X
"RTN","SCMCWAIT",133,0)
 S X=0
"RTN","SCMCWAIT",134,0)
 F I=0:0 S I=$O(^SDWL(409.3,"B",+$G(DFN),I)) Q:'I  S A=$G(^SDWL(409.3,I,0)) D  Q:X
"RTN","SCMCWAIT",135,0)
 .I 12'[$P(A,U,5) Q
"RTN","SCMCWAIT",136,0)
 .I $G(^SDWL(409.3,I,"DIS")) Q
"RTN","SCMCWAIT",137,0)
 .S X="3;ON WAITLIST TEAM: "_$P($G(^SCTM(404.51,+$P(A,U,6),0)),U)
"RTN","SCMCWAIT",138,0)
 .I $P(A,U,7) S X=X_" POSITION: "_$P($G(^SCTM(404.57,+$P(A,U,7),0)),U)
"RTN","SCMCWAIT",139,0)
 I X Q X
"RTN","SCMCWAIT",140,0)
 ;Q X
"RTN","SCMCWAIT",141,0)
 ;CHECK IF ON TEAM
"RTN","SCMCWAIT",142,0)
 N SCD,SCDT,SCOK S SCOK=$$TMPT^SCAPMC3(DFN,"SCDT","","SCD","SCER1") I $D(SCD(1)) S X=1
"RTN","SCMCWAIT",143,0)
 N SCPOS S SCOK=$$TPPT^SCAPMC(DFN,.SCDT,"","","","","","SCPOS","SCBKERR") I $D(SCPOS(1)) S X=2
"RTN","SCMCWAIT",144,0)
 Q X
"RTN","SCMCWAIT",145,0)
 ;CHECK IF ON POSITION
"RTN","SCMCWAIT",146,0)
SORT ;From sort template
"RTN","SCMCWAIT",147,0)
 S X=0
"RTN","SCMCWAIT",148,0)
 Q
"RTN","SCMCWAIT",149,0)
PC(RESULT,POS) ;rpc to see if provider can be pc
"RTN","SCMCWAIT",150,0)
 N POENT,RES
"RTN","SCMCWAIT",151,0)
 D ROLE(.RES,POS) I RES=1 S RESULT(0)=0 Q
"RTN","SCMCWAIT",152,0)
 S POENT=+$O(^SCTM(404.52,"AIDT",+$G(POS),1,-(DT+.1))),POENT=$O(^(POENT,0))
"RTN","SCMCWAIT",153,0)
 ;S PROV=+$P($G(^SCTM(404.52,+$G(POENT),0)),U,3)
"RTN","SCMCWAIT",154,0)
 I 'POENT S RESULT(0)=1 Q
"RTN","SCMCWAIT",155,0)
 N D0 S D0=+$G(POENT) D SORT S RESULT(0)=X
"RTN","SCMCWAIT",156,0)
 Q
"RTN","SCMCWAIT",157,0)
ROLE(RESULT,POS) ;rpc to see if role of position is resident
"RTN","SCMCWAIT",158,0)
 N ZERO S ZERO=$G(^SCTM(404.57,+$G(POS),0))
"RTN","SCMCWAIT",159,0)
 I $P(ZERO,U,4) S RESULT=0 Q  ;Already pc let them change it.
"RTN","SCMCWAIT",160,0)
 S RESULT=0
"RTN","SCMCWAIT",161,0)
 I $P($G(^SD(403.46,+$P(ZERO,U,3),0)),U)="RESIDENT (PHYSICIAN)" S RESULT=1
"RTN","SCMCWAIT",162,0)
 Q
"RTN","SCMCWAIT",163,0)
SC(DFN) ;Is patient 0-50 sc%
"RTN","SCMCWAIT",164,0)
 N TEAM,INST S TEAM=$P(DFN,U,2),INST=+$P($G(^SCTM(404.51,+TEAM,0)),U,7)
"RTN","SCMCWAIT",165,0)
 S X=0,DFN=+DFN
"RTN","SCMCWAIT",166,0)
 N A D ELIG^VADPT S A=$G(VAEL(3)) I $P(A,U)'="Y" Q 0
"RTN","SCMCWAIT",167,0)
 I $P(A,U,2)<50 Q $P(A,U,2)
"RTN","SCMCWAIT",168,0)
 Q 0
"RTN","SCMCWAIT",169,0)
SCLI(RESULT,SC) ;sc sc list
"RTN","SCMCWAIT",170,0)
 K RESULT N RES
"RTN","SCMCWAIT",171,0)
 S DFN=+$G(SC("DFN"))
"RTN","SCMCWAIT",172,0)
 D SDSC^SDWLRP3(.RES,DFN) I RES=-1 S RESULT(0)=-1 Q
"RTN","SCMCWAIT",173,0)
 S RESULT(0)="<RESULTS>" N CNT,I S CNT=1 F I=0:0 S I=$O(^TMP("SDWLRP3",$J,I)) Q:'I  S RESULT(CNT)=^(I),CNT=CNT+1
"RTN","SDAM2")
0^33^B28969353^B30409826
"RTN","SDAM2",1,0)
SDAM2 ;ALB/MJK - Appt Mgt (cont); 8/18/05 12:10pm  ; Compiled April 16, 2007 09:43:32
"RTN","SDAM2",2,0)
 ;;5.3;Scheduling;**250,296,327,478,446**;Aug 13, 1993;Build 77
"RTN","SDAM2",3,0)
 ;
"RTN","SDAM2",4,0)
CI ; -- protocol SDAM APPT CHECK IN entry pt
"RTN","SDAM2",5,0)
 ; input:  VALMY := array entries
"RTN","SDAM2",6,0)
 ;
"RTN","SDAM2",7,0)
 N %,SDI,SDAT,VALMY,SDAMCIDT,SDCIACT
"RTN","SDAM2",8,0)
 D SEL^VALM2 S SDI=0,SDCIACT=""
"RTN","SDAM2",9,0)
 D NOW^%DTC S SDAMCIDT=$P(%,".")_"."_$E($P(%,".",2)_"0000",1,4)
"RTN","SDAM2",10,0)
 F  S SDI=$O(VALMY(SDI)) Q:'SDI  I $D(^TMP("SDAMIDX",$J,SDI)) K SDAT D
"RTN","SDAM2",11,0)
 .S SDAT=^TMP("SDAMIDX",$J,SDI)
"RTN","SDAM2",12,0)
 .W !,^TMP("SDAM",$J,+SDAT,0)
"RTN","SDAM2",13,0)
 .D:VALMCC SELECT^VALM10(+SDAT,1)
"RTN","SDAM2",14,0)
 .D ONE($P(SDAT,U,2),$P(SDAT,U,4),$P(SDAT,U,3),$P(SDAT,U,5),0,SDAMCIDT)
"RTN","SDAM2",15,0)
 .D:VALMCC SELECT^VALM10(+SDAT,0)
"RTN","SDAM2",16,0)
 S VALMBCK=$S(VALMCC:"",1:"R")
"RTN","SDAM2",17,0)
 Q
"RTN","SDAM2",18,0)
 ;
"RTN","SDAM2",19,0)
ONE(DFN,SDCL,SDT,SDDA,SDASK,SDAMCIDT) ; -- check in one appt
"RTN","SDAM2",20,0)
 ; input:  DFN := ifn of patient
"RTN","SDAM2",21,0)
 ;        SDCL := clinic# 
"RTN","SDAM2",22,0)
 ;         SDT := appt d/t
"RTN","SDAM2",23,0)
 ;        SDDA := ifn in ^SC multiple or null
"RTN","SDAM2",24,0)
 ;       SDASK := ask d/t of ci always [1|yes or 0|no]
"RTN","SDAM2",25,0)
 ;    SDAMCIDT := ci date/time [optional]
"RTN","SDAM2",26,0)
 ;
"RTN","SDAM2",27,0)
 I $D(XRTL) D T0^%ZOSV
"RTN","SDAM2",28,0)
 S:'SDDA SDDA=$$FIND(DFN,SDT,SDCL)
"RTN","SDAM2",29,0)
 I 'SDDA W !!,*7,"You cannot check in this appointment." D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",30,0)
 N SDATA,SDCIHDL,X S SDATA=SDDA_U_DFN_U_SDT_U_SDCL,SDCIHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDAM2",31,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDCIHDL)
"RTN","SDAM2",32,0)
 I '$D(^SD(409.63,"ACI",1,+SDATA("BEFORE","STATUS"))) W !!,*7,"You cannot check in this appointment." D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",33,0)
 ; *** mt blocking removed
"RTN","SDAM2",34,0)
 ;S X="EASMTCHK" X ^%ZOSF("TEST") I $T,$G(EASACT)'="W",$$MT^EASMTCHK(DFN,"","C",SDT) D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",35,0)
 I $P(SDT,".")>DT W !!,*7,"It is too soon to check in this appointment." D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",36,0)
 S:'$D(^SC(SDCL,"S",0)) ^(0)="^44.001DA^^"
"RTN","SDAM2",37,0)
 S DR="",X=$G(^SC(SDCL,"S",SDT,1,SDDA,"C"))
"RTN","SDAM2",38,0)
 I +X S DR=309
"RTN","SDAM2",39,0)
 ; -- already co'ed
"RTN","SDAM2",40,0)
 I DR="",$P(X,U,3) D
"RTN","SDAM2",41,0)
 .S DR="309//"
"RTN","SDAM2",42,0)
 .I $P(^SC(SDCL,0),U,24)!(SDASK) S DR=DR_$$FTIME^VALM1($P(X,U,3)) Q
"RTN","SDAM2",43,0)
 .S DR=DR_"//^S X="_$P(X,U,3)
"RTN","SDAM2",44,0)
 ;
"RTN","SDAM2",45,0)
 I DR="",$P(^SC(SDCL,0),U,24)!(SDASK) S DR="309//"_$S(SDAMCIDT:$$FTIME^VALM1(SDAMCIDT),1:"NOW")
"RTN","SDAM2",46,0)
 I DR="" S DR="309///"_$S(SDAMCIDT:"/"_SDAMCIDT,1:"NOW")
"RTN","SDAM2",47,0)
 S DA(2)=SDCL,DA(1)=SDT,DA=SDDA,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1," D ^DIE
"RTN","SDAM2",48,0)
 D AFTER^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDCIHDL)
"RTN","SDAM2",49,0)
 I '$P(SDATA("AFTER","STATUS"),U,4),'$P(SDATA("BEFORE","STATUS"),U,4) W !?8,*7,"...appointment has not been checked in" D PAUSE^VALM1
"RTN","SDAM2",50,0)
 I SDATA("BEFORE","STATUS")'=SDATA("AFTER","STATUS") D
"RTN","SDAM2",51,0)
 .I $P(SDATA("AFTER","STATUS"),U,4),'$P(SDATA("BEFORE","STATUS"),U,4) W !?8,"...checked in ",$$FTIME^VALM1($P(SDATA("AFTER","STATUS"),U,4))
"RTN","SDAM2",52,0)
 .I $D(SDCIACT) D
"RTN","SDAM2",53,0)
 ..S Y=SDATA("AFTER","STATUS"),Y1=$P(Y,U,4),Y=$P(Y,U,3)
"RTN","SDAM2",54,0)
 ..I $P(SDATA("BEFORE","STATUS"),U,3)'=Y D UPD($$LOWER^VALM1(Y),"STAT",+SDAT,1),UPD("","TIME",+SDAT,1)
"RTN","SDAM2",55,0)
 ..I $P(SDATA("AFTER","STATUS"),U,3)["CHECKED IN" D UPD($S($P(Y1,".")=DT:$$TIME^SDAM1($P(Y1,".",2)),1:"     "),"TIME",+SDAT,1)
"RTN","SDAM2",56,0)
 .D EVT^SDAMEVT(.SDATA,4,0,SDCIHDL) ; 4 := ci evt , 0 := interactive mode
"RTN","SDAM2",57,0)
 I $D(XRT0) S XRTN="SDAM2" D T1^%ZOSV
"RTN","SDAM2",58,0)
ONEQ K DA,DIE,DR,DQ,DE,Y,Y1 Q
"RTN","SDAM2",59,0)
 ;
"RTN","SDAM2",60,0)
 ;
"RTN","SDAM2",61,0)
FIND(DFN,SDT,SDCL) ; -- return appt ifn for pat
"RTN","SDAM2",62,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM2",63,0)
 ;                 SDT := appt d/t
"RTN","SDAM2",64,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM2",65,0)
 ;  output: [returned] := ifn if pat has appt on date/time
"RTN","SDAM2",66,0)
 ;
"RTN","SDAM2",67,0)
 N Y
"RTN","SDAM2",68,0)
 S Y=0 F  S Y=$O(^SC(SDCL,"S",SDT,1,Y)) Q:'Y  I $D(^(Y,0)),DFN=+^(0),$D(^DPT(+DFN,"S",SDT,0)),$$VALID(DFN,SDCL,SDT,Y) S CNSTLNK=$P($G(^SC(SDCL,"S",SDT,1,Y,"CONS")),U) K:CNSTLNK="" CNSTLNK Q  ;SD/478
"RTN","SDAM2",69,0)
 Q Y
"RTN","SDAM2",70,0)
 ;
"RTN","SDAM2",71,0)
UPD(TEXT,FLD,LINE,SAVE) ; -- update data for screen
"RTN","SDAM2",72,0)
 D FLDTEXT^VALM10(LINE,FLD,TEXT)
"RTN","SDAM2",73,0)
 D:VALMCC CNTRL^VALM10(LINE,$P(VALMDDF(FLD),U,2),$P(VALMDDF(FLD),U,3),IOINHI,IOINORM,+$G(SAVE))
"RTN","SDAM2",74,0)
 Q
"RTN","SDAM2",75,0)
 ;
"RTN","SDAM2",76,0)
MAKE ; -- make appt action
"RTN","SDAM2",77,0)
 N ORACTION,ORVP,XQORQUIT,SDAMERR
"RTN","SDAM2",78,0)
 D FULL^VALM1
"RTN","SDAM2",79,0)
 W !!,VALMHDR(1)
"RTN","SDAM2",80,0)
 D ^SDM
"RTN","SDAM2",81,0)
 I '$D(SDAMERR) D BLD^SDAM
"RTN","SDAM2",82,0)
 I $D(SDAMERR) D PAUSE^VALM1
"RTN","SDAM2",83,0)
 D SDM^SDKILL S VALMBCK="R"
"RTN","SDAM2",84,0)
 Q
"RTN","SDAM2",85,0)
 ;
"RTN","SDAM2",86,0)
WI ; -- walk-in visit action
"RTN","SDAM2",87,0)
 S VALMBCK="R"
"RTN","SDAM2",88,0)
 D FULL^VALM1
"RTN","SDAM2",89,0)
 I SDAMTYP="P" I $$CL^SDAMWI(SDFN) D BLD^SDAM1
"RTN","SDAM2",90,0)
 I SDAMTYP="C" I $$PT^SDAMWI(SDCLN) D BLD^SDAM3
"RTN","SDAM2",91,0)
 ;evaluate wait list ;SD/327
"RTN","SDAM2",92,0)
EWLCHK ;check if patient has any open EWL entries (SD/372)
"RTN","SDAM2",93,0)
 ;CLN expected as clinic IEN
"RTN","SDAM2",94,0)
 I '$D(DFN) Q
"RTN","SDAM2",95,0)
 Q:'$D(SDT)
"RTN","SDAM2",96,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDAM2",97,0)
 N SD S SD=SDT
"RTN","SDAM2",98,0)
 I '$D(SC) S SC=+$G(CLN)
"RTN","SDAM2",99,0)
 ;
"RTN","SDAM2",100,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDAM2",101,0)
 W:$D(IOF) @IOF D APPT^SDWLEVAL(DFN,SD,SC)
"RTN","SDAM2",102,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDAM2",103,0)
 N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDAM2",104,0)
 .K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDAM2",105,0)
 .D INIT^SDWLPL(DFN,"M")
"RTN","SDAM2",106,0)
 .Q:'$D(^TMP($J,"SDWLPL"))
"RTN","SDAM2",107,0)
 .D LIST^SDWLPL("M",DFN)
"RTN","SDAM2",108,0)
 .F  Q:'$D(^TMP($J,"SDWLPL"))  N SDR D ANSW^SDWLEVAL(1,.SDR) I 'SDR D LIST^SDWLPL("M",DFN) D
"RTN","SDAM2",109,0)
 ..F  N SDR  D ANSW^SDWLEVAL(0,.SDR) Q:'$D(^TMP($J,"SDWLPL"))  I 'SDR W !,"MUST ENTER A REASON NOT TO DISPOSITION MATCHED EWL ENTRY",!
"RTN","SDAM2",110,0)
 I $D(^TMP($J,"APPT")) N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDAM2",111,0)
 .Q:'$D(^TMP($J,"SDWLPL"))  D ASKREM^SDWLEVAL S SDCTN=1 ;display and process selected open EWL entries
"RTN","SDAM2",112,0)
 .Q
"RTN","SDAM2",113,0)
 Q
"RTN","SDAM2",114,0)
 ;
"RTN","SDAM2",115,0)
DATE ; -- change date range
"RTN","SDAM2",116,0)
 S VALMB=SDBEG D RANGE^VALM11
"RTN","SDAM2",117,0)
 I $S('VALMBEG:1,SDBEG'=VALMBEG:0,1:SDEND=VALMEND) W !!,"Date range was not changed." D PAUSE^VALM1 S VALMBCK="" G DATEQ
"RTN","SDAM2",118,0)
 S SDBEG=VALMBEG,SDEND=VALMEND
"RTN","SDAM2",119,0)
 I SDAMTYP="P" D BLD^SDAM1
"RTN","SDAM2",120,0)
 I SDAMTYP="C" D BLD^SDAM3
"RTN","SDAM2",121,0)
 S VALMBCK="R"
"RTN","SDAM2",122,0)
DATEQ K VALMB,VALMBEG,VALMEND Q
"RTN","SDAM2",123,0)
 ;
"RTN","SDAM2",124,0)
INP(DFN,VDATE) ; -- determine inpat status ; dom is not an inpat appt
"RTN","SDAM2",125,0)
 N SDINP,VAINDT,VADMVT
"RTN","SDAM2",126,0)
 S SDINP="",VAINDT=VDATE D ADM^VADPT2 G INPQ:'VADMVT
"RTN","SDAM2",127,0)
 I $P(^DG(43,1,0),U,21),$P($G(^DIC(42,+$P($G(^DGPM(VADMVT,0)),U,6),0)),U,3)="D" G INPQ
"RTN","SDAM2",128,0)
 S SDINP="I"
"RTN","SDAM2",129,0)
INPQ Q SDINP
"RTN","SDAM2",130,0)
 ;
"RTN","SDAM2",131,0)
VALID(DFN,SDCL,SDT,SDDA) ; -- return valid appt.
"RTN","SDAM2",132,0)
 ; **NOTE:  For speed consideration the ^SC and ^DPT nodes must be
"RTN","SDAM2",133,0)
 ;          check to see they exist prior to calling this entry point.
"RTN","SDAM2",134,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM2",135,0)
 ;                 SDT := appt d/t
"RTN","SDAM2",136,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM2",137,0)
 ;                SDDA := ifn of appt
"RTN","SDAM2",138,0)
 ;  output: [returned] := 1 for valid appt., 0 for not valid
"RTN","SDAM2",139,0)
 Q $S($P(^SC(SDCL,"S",SDT,1,SDDA,0),U,9)'="C":1,$P(^DPT(DFN,"S",SDT,0),U,2)["C":1,1:0)
"RTN","SDCO1")
0^34^B29753601^B23369936
"RTN","SDCO1",1,0)
SDCO1 ;ALB/RMO - Appointment - Check Out;Apr 23 1999  ; Compiled November 16, 2006 15:24:29
"RTN","SDCO1",2,0)
 ;;5.3;Scheduling;**27,132,149,193,250,296,446**;08/13/93;Build 77
"RTN","SDCO1",3,0)
 ;
"RTN","SDCO1",4,0)
 ;check out if sd/369 is released before 446!!!
"RTN","SDCO1",5,0)
 ;
"RTN","SDCO1",6,0)
EN ;Entry point for SDCO APPT CHECK OUT protocol
"RTN","SDCO1",7,0)
 N SDCOALBF,SDCOAP,SDCOBG,SDCODT,VALMY
"RTN","SDCO1",8,0)
 S VALMBCK=""
"RTN","SDCO1",9,0)
 D EN^VALM2(XQORNOD(0))
"RTN","SDCO1",10,0)
 D FULL^VALM1
"RTN","SDCO1",11,0)
 S SDCOAP=0 D NOW^%DTC S SDCODT=$P(%,".")_"."_$E($P(%,".",2)_"0000",1,4)
"RTN","SDCO1",12,0)
 F  S SDCOAP=$O(VALMY(SDCOAP)) Q:'SDCOAP  D
"RTN","SDCO1",13,0)
 .I $D(^TMP("SDAMIDX",$J,SDCOAP)) K SDAT S SDAT=^(SDCOAP) D
"RTN","SDCO1",14,0)
 ..W !!,^TMP("SDAM",$J,+SDAT,0)
"RTN","SDCO1",15,0)
 ..I $$CHK^SDCOU(SDCOAP) D CO(+$P(SDAT,"^",2),+$P(SDAT,"^",3),+$P(SDAT,"^",4),+$P(SDAT,"^",5),0,SDCODT,"CO",+SDAT,.SDCOALBF)
"RTN","SDCO1",16,0)
 I $G(SDCOALBF) S SDCOBG=VALMBG W ! D BLD^SDAM S:$D(@VALMAR@(SDCOBG,0)) VALMBG=SDCOBG
"RTN","SDCO1",17,0)
 S VALMBCK="R"
"RTN","SDCO1",18,0)
 K SDAT
"RTN","SDCO1",19,0)
 Q
"RTN","SDCO1",20,0)
 ;
"RTN","SDCO1",21,0)
CO(DFN,SDT,SDCL,SDDA,SDASK,SDCODT,SDCOACT,SDLNE,SDCOALBF) ;Appt Check Out
"RTN","SDCO1",22,0)
 ; Input  -- DFN      Patient file IEN
"RTN","SDCO1",23,0)
 ;           SDT      Appointment Date/Time
"RTN","SDCO1",24,0)
 ;           SDCL     Hospital Location file IEN for Appt
"RTN","SDCO1",25,0)
 ;           SDDA     IEN in ^SC multiple or null [Optional]
"RTN","SDCO1",26,0)
 ;           SDASK    Ask Check Out Date/Time     [Optional]
"RTN","SDCO1",27,0)
 ;           SDCODT   Date/Time of Check Out      [Optional]
"RTN","SDCO1",28,0)
 ;           SDCOACT  Appt Mgmt Check Out Action  [Optional]
"RTN","SDCO1",29,0)
 ;           SDLNE    Appt Mgmt Line Number       [Optional]
"RTN","SDCO1",30,0)
 ; Output -- SDCOALBF Re-build Appt Mgmt List
"RTN","SDCO1",31,0)
 I $D(XRTL) D T0^%ZOSV
"RTN","SDCO1",32,0)
 N SDCOQUIT,SDOE,SDATA
"RTN","SDCO1",33,0)
 S:'SDDA SDDA=$$FIND^SDAM2(DFN,SDT,SDCL)
"RTN","SDCO1",34,0)
 I 'SDDA W !!,*7,">>> You cannot check out this appointment." D PAUSE^VALM1 G COQ
"RTN","SDCO1",35,0)
 S SDATA=$G(^DPT(DFN,"S",SDT,0))
"RTN","SDCO1",36,0)
 ; ** MT Blocking removed
"RTN","SDCO1",37,0)
 ;S X="EASMTCHK" X ^%ZOSF("TEST") I $T,$G(EASACT)'="W",$$MT^EASMTCHK(DFN,$P($G(SDATA),U,16),"C",$G(SDT)) D PAUSE^VALM1 G COQ
"RTN","SDCO1",38,0)
 ;
"RTN","SDCO1",39,0)
 ;-- if new encounter, pass to PCE
"RTN","SDCO1",40,0)
 I $$NEW^SDPCE(SDT) D  S VALMBCK="R",SDCOALBF=1 G COQ
"RTN","SDCO1",41,0)
 . N SDCOED
"RTN","SDCO1",42,0)
 . S SDOE=$$GETAPT^SDVSIT2(DFN,SDT,SDCL)
"RTN","SDCO1",43,0)
 . ;
"RTN","SDCO1",44,0)
 . ; -- has appt already been checked out
"RTN","SDCO1",45,0)
 . S SDCOED=$$CHK($TR($$STATUS^SDAM1(DFN,SDT,SDCL,SDATA,SDDA),";","^"))
"RTN","SDCO1",46,0)
 . ;
"RTN","SDCO1",47,0)
 . ; -- if not checked out then do interview process
"RTN","SDCO1",48,0)
 . IF '$$CODT^SDCOU(DFN,SDT,SDCL) D
"RTN","SDCO1",49,0)
 . . N SDCOMKF,SDTRES
"RTN","SDCO1",50,0)
 . . ;
"RTN","SDCO1",51,0)
 . . ; -- first, check if should make follow-up appt
"RTN","SDCO1",52,0)
 . . IF $G(SDCOACT)="CO",'SDCOED D
"RTN","SDCO1",53,0)
 . . . N SDCOMKF
"RTN","SDCO1",54,0)
 . . . D MC^SDCO5(SDOE,1,.SDCOMKF,.SDCOQUIT) Q:$D(SDCOQUIT)
"RTN","SDCO1",55,0)
 . . . ;
"RTN","SDCO1",56,0)
 . . . ; -- Set flag to re-build appointment list
"RTN","SDCO1",57,0)
 . . . IF $G(SDCOMKF) S SDCOALBF=1
"RTN","SDCO1",58,0)
 . . ;
"RTN","SDCO1",59,0)
 . . ; -- c/o interview if user didn't quit
"RTN","SDCO1",60,0)
 . . I '$D(SDCOQUIT),'SDCOED D
"RTN","SDCO1",61,0)
 . . . N SDAPTYP
"RTN","SDCO1",62,0)
 . . . S SDTRES=$$INTV^PXAPI("INTV","SD","PIMS",$P($G(^SCE(+SDOE,0)),U,5),$P($G(^SCE(+SDOE,0)),U,4),DFN)
"RTN","SDCO1",63,0)
 . . . Q:SDTRES<0
"RTN","SDCO1",64,0)
 . . . ;
"RTN","SDCO1",65,0)
 . . . ; -- ask user if they want to see c/o screen
"RTN","SDCO1",66,0)
 . . . S SDGAFC=$$ASK^SDCO6
"RTN","SDCO1",67,0)
 . . . I 'SDGAFC D
"RTN","SDCO1",68,0)
 . . . .N SDELIG
"RTN","SDCO1",69,0)
 . . . .S SDELIG=$$ELSTAT^SDUTL2(DFN)
"RTN","SDCO1",70,0)
 . . . .I $$MHCLIN^SDUTL2(SDCL),'($$COLLAT^SDUTL2(SDELIG)!$P(SDATA,U,11)) D
"RTN","SDCO1",71,0)
 . . . . .I $$NEWGAF^SDUTL2(DFN) D
"RTN","SDCO1",72,0)
 . . . . . .I '$$GAFCM^SDUTL2() S SDGAFC=1
"RTN","SDCO1",73,0)
 . . .I SDGAFC D EN^SDCO(SDOE,,1)
"RTN","SDCO1",74,0)
 . ;
"RTN","SDCO1",75,0)
 . ; -- if already checked out then show c/o screen
"RTN","SDCO1",76,0)
 . E  D EN^SDCO(SDOE,,1)
"RTN","SDCO1",77,0)
 ;
"RTN","SDCO1",78,0)
 ; -- view if old encounters
"RTN","SDCO1",79,0)
 S SDOE=$$GETAPT^SDVSIT2(DFN,SDT,SDCL)
"RTN","SDCO1",80,0)
 D EN^SDCO(SDOE,,1)
"RTN","SDCO1",81,0)
 ;
"RTN","SDCO1",82,0)
COQ K % D EWLCHK Q
"RTN","SDCO1",83,0)
 Q
"RTN","SDCO1",84,0)
EWLCHK ;check if patient has any open EWL entries (SD/372)
"RTN","SDCO1",85,0)
 ;get appointment
"RTN","SDCO1",86,0)
 ;
"RTN","SDCO1",87,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDCO1",88,0)
 W:$D(IOF) @IOF D APPT^SDWLEVAL(DFN,SDT,SDCL)
"RTN","SDCO1",89,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDCO1",90,0)
 N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDCO1",91,0)
 .K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDCO1",92,0)
 .D INIT^SDWLPL(DFN,"M")
"RTN","SDCO1",93,0)
 .Q:'$D(^TMP($J,"SDWLPL"))
"RTN","SDCO1",94,0)
 .D LIST^SDWLPL("M",DFN)
"RTN","SDCO1",95,0)
 .F  Q:'$D(^TMP($J,"SDWLPL"))  N SDR D ANSW^SDWLEVAL(1,.SDR) I 'SDR D LIST^SDWLPL("M",DFN) D
"RTN","SDCO1",96,0)
 ..F  N SDR  D ANSW^SDWLEVAL(0,.SDR) Q:'$D(^TMP($J,"SDWLPL"))  I 'SDR W !,"MUST ENTER A REASON NOT TO DISPOSITION MATCHED EWL ENTRY",!
"RTN","SDCO1",97,0)
 ..Q
"RTN","SDCO1",98,0)
 .Q
"RTN","SDCO1",99,0)
 Q
"RTN","SDCO1",100,0)
 ;
"RTN","SDCO1",101,0)
BEFORE(SDATA,DFN,SDT,SDCL,SDDA,SDHDL) ; -- event driver before ; not used
"RTN","SDCO1",102,0)
 S SDATA=SDDA_"^"_DFN_"^"_SDT_"^"_SDCL,SDHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDCO1",103,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDHDL)
"RTN","SDCO1",104,0)
 Q
"RTN","SDCO1",105,0)
 ;
"RTN","SDCO1",106,0)
AFTER(SDATA,DFN,SDT,SDCL,SDDA,SDHDL,SDLNE) ; -- event driver after ; not used
"RTN","SDCO1",107,0)
 D AFTER^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDHDL)
"RTN","SDCO1",108,0)
 D:$G(SDLNE) UPD(DFN,SDT,SDCL,SDLNE,SDATA("BEFORE","STATUS"),SDATA("AFTER","STATUS"))
"RTN","SDCO1",109,0)
 D EVT^SDAMEVT(.SDATA,5,0,SDHDL)
"RTN","SDCO1",110,0)
 Q
"RTN","SDCO1",111,0)
 ;
"RTN","SDCO1",112,0)
UPD(DFN,SDT,SDCL,SDLNE,SDSTB,SDSTA) ; -- update appt mgmt screen ; used by AFTER but AFTER is not used
"RTN","SDCO1",113,0)
 N SDAMBOLD
"RTN","SDCO1",114,0)
 I $P(SDSTB,"^",3)'=$P(SDSTA,"^",3) D UPD^SDAM2($$LOWER^VALM1($P(SDSTA,"^",3)),"STAT",SDLNE),UPD^SDAM2("","TIME",SDLNE) S SDAMBOLD(DFN,SDT,SDCL)=""
"RTN","SDCO1",115,0)
 I $P(SDSTA,"^",3)["CHECKED OUT",$P($P(SDSTA,"^",5),".")=DT D UPD^SDAM2($$TIME^SDAM1($P($P(SDSTA,"^",5),".",2)),"TIME",SDLNE)
"RTN","SDCO1",116,0)
 Q
"RTN","SDCO1",117,0)
 ;
"RTN","SDCO1",118,0)
ELIG(DFN,SDT,SDCL,SDDA) ; -- update elig if blank
"RTN","SDCO1",119,0)
 N X,DR
"RTN","SDCO1",120,0)
 I $P(^SC(SDCL,"S",SDT,1,SDDA,0),U,10)="" D
"RTN","SDCO1",121,0)
 .S X=+$G(^DPT(DFN,.36)),X=$S('$D(^DIC(8,X,0)):"",$P(^(0),U,4)=6:"",1:X)
"RTN","SDCO1",122,0)
 .I X]"" S DR="30////^S X="_X D DIE(SDCL,SDT,SDDA,DR)
"RTN","SDCO1",123,0)
 Q
"RTN","SDCO1",124,0)
 ;
"RTN","SDCO1",125,0)
CHK(SDSTB) ; -- is appointment checked out
"RTN","SDCO1",126,0)
 N Y
"RTN","SDCO1",127,0)
 I "^2^8^12^"[("^"_+SDSTB_"^"),$P(SDSTB,"^",3)["CHECKED OUT" S Y=1
"RTN","SDCO1",128,0)
 Q +$G(Y)
"RTN","SDCO1",129,0)
 ;
"RTN","SDCO1",130,0)
DT(DFN,SDT,SDCL,SDDA,SDASK,SDCODT,SDCOQUIT) ;Update Check Out Date
"RTN","SDCO1",131,0)
 N %DT,DR,SDCIDT,X
"RTN","SDCO1",132,0)
 S:'$D(^SC(SDCL,"S",0)) ^(0)="^44.001DA^^"
"RTN","SDCO1",133,0)
 S DR="",SDCIDT=$P($G(^SC(SDCL,"S",SDT,1,SDDA,"C")),"^"),X=$P($G(^("C")),"^",3)
"RTN","SDCO1",134,0)
 I X G DTQ:'SDASK  S DR="303R"
"RTN","SDCO1",135,0)
 I DR="",$P(^SC(SDCL,0),U,24),$$REQ^SDM1A(SDT)="CO" S DR="303R//"_$S($G(SDCODT):$$FTIME^VALM1($S(SDCODT<SDCIDT:SDCIDT,1:SDCODT)),1:"NOW")
"RTN","SDCO1",136,0)
 I DR="" S DR="303R///"_$S($G(SDCODT):"/"_$S(SDCODT<SDCIDT:SDCIDT,1:SDCODT),1:"NOW")
"RTN","SDCO1",137,0)
 S DR="S SDCOQUIT="""";"_DR_";K SDCOQUIT"
"RTN","SDCO1",138,0)
 D DIE(SDCL,SDT,SDDA,DR)
"RTN","SDCO1",139,0)
DTQ Q
"RTN","SDCO1",140,0)
 ;
"RTN","SDCO1",141,0)
DIE(SDCL,SDT,SDDA,DR) ; -- update appt data in ^SC
"RTN","SDCO1",142,0)
 N DA,DIE
"RTN","SDCO1",143,0)
 S DA(2)=SDCL,DA(1)=SDT,DA=SDDA,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1,"
"RTN","SDCO1",144,0)
 D ^DIE K DQ,DE
"RTN","SDCO1",145,0)
DIEQ Q
"RTN","SDM1")
0^19^B49317350^B40309214
"RTN","SDM1",1,0)
SDM1 ;SF/GFT - MAKE APPOINTMENT ; 3/29/05 12:35pm [5/5/05 9:41am]  ; Compiled March 8, 2007 14:55:24  ; Compiled May 9, 2007 13:19:18  ; Compiled August 28, 2007 12:19:08
"RTN","SDM1",2,0)
 ;;5.3;Scheduling;**32,167,168,80,223,263,273,408,327,478,490,446**;Aug 13, 1993;Build 77
"RTN","SDM1",3,0)
1 L  Q:$D(SDXXX)  S CCXN=0 K MXOK,COV,SDPROT Q:DFN<0  S SC=+SC
"RTN","SDM1",4,0)
 S X1=DT,SDEDT=365 S:$D(^SC(SC,"SDP")) SDEDT=$P(^SC(SC,"SDP"),"^",2)
"RTN","SDM1",5,0)
 S X2=SDEDT D C^%DTC S SDEDT=X D WRT
"RTN","SDM1",6,0)
 I $D(^SC(SC,"SI")),$O(^("SI",0))>0 W !,*7,?8,"**** SPECIAL INSTRUCTIONS ****",! S %I=0 F %=0:1 S %I=$O(^SC(SC,"SI",%I)) Q:%I'>0  W ^(%I,0) W:% ! I '%,$O(^SC(SC,"SI",%I))>0 S POP=0 D SPIN Q:POP
"RTN","SDM1",7,0)
 I $D(SDINA),SDINA>DT D IN W !,?8,@SDMSG K SDMSG
"RTN","SDM1",8,0)
 G:SDMM RDTY^SDMM
"RTN","SDM1",9,0)
 ;
"RTN","SDM1",10,0)
ADT S:'$D(SDW) SDW=""
"RTN","SDM1",11,0)
 S SDSOH=$S('$D(^SC(SC,"SL")):0,$P(^("SL"),"^",8)']"":0,1:1),CCX=""
"RTN","SDM1",12,0)
 S SDONCE=$G(SDONCE)+1  ;Prevent repetitive iteration
"RTN","SDM1",13,0)
 ; Section introduced in 446.
"RTN","SDM1",14,0)
 N SDDATE1,SDQT,Y  ; Do not allow progress if there is no availability > 120 days after the desired date.
"RTN","SDM1",15,0)
 S SDDATE1=$S($G(SDDATE)="":DT,1:SDDATE)
"RTN","SDM1",16,0)
 S Y="" D  Q:Y="^"
"RTN","SDM1",17,0)
 .F  Q:Y="^"!$$WLCL120^SDM2A(SC,SDDATE1)  D
"RTN","SDM1",18,0)
 ..S Y=$$WLCLASK^SDM2A() Q:Y="^"  ; Y=0: New date, Y=1: place on EWL, Y="^": quit
"RTN","SDM1",19,0)
 ..I Y=0 D  Q
"RTN","SDM1",20,0)
 ...N SDMAX,SDDMAX
"RTN","SDM1",21,0)
 ...S SDMAX(1)=$P($G(^SC(+SC,"SDP")),U,2) S:'SDMAX(1) SDMAX(1)=365
"RTN","SDM1",22,0)
 ...S (SDMAX,SDDMAX)=$$FMADD^XLFDT(DT,SDMAX(1))
"RTN","SDM1",23,0)
 ...S Y=$$DDATE^SDM0(.SDDATE,"0^0",.SDMAX) Q:'Y  ; Y=0: "^" entered, Y=1: date entered
"RTN","SDM1",24,0)
 ...D D^SDM0
"RTN","SDM1",25,0)
 ...S SDDATE1=SDDATE
"RTN","SDM1",26,0)
 ...Q
"RTN","SDM1",27,0)
 ..D WL^SDM2A(SC)
"RTN","SDM1",28,0)
 ..S Y="^"  ; quit
"RTN","SDM1",29,0)
 ..Q
"RTN","SDM1",30,0)
 .Q
"RTN","SDM1",31,0)
 ;
"RTN","SDM1",32,0)
 S X=$S(SDONCE<2:$G(SDSDATE),1:"")  ;Use default date/time if specified as 'desired date'  
"RTN","SDM1",33,0)
 I 'X R !,"DATE/TIME: ",X:DTIME Q:X="^"!'$$WLCL120A^SDM2A(X,SDDATE1,SC)  ;sd/327,446
"RTN","SDM1",34,0)
 I X="" D WL(SC) Q  ;sd/446
"RTN","SDM1",35,0)
 G:X="M"!(X="m") MORDIS^SDM0
"RTN","SDM1",36,0)
 I X="D"!(X="d") S X=$$REDDT() G:X>0 MORD2^SDM0 S X="" W "  ??",! G ADT
"RTN","SDM1",37,0)
 I X?1"?".E D  G ADT
"RTN","SDM1",38,0)
 .W !,"Enter a date/time for the appointment"
"RTN","SDM1",39,0)
 .W:$D(SD) " or a space to choose the same date/time as the patient you have just previously scheduled into this clinic"
"RTN","SDM1",40,0)
 .W ".",!,"You may also select 'M' to display the next month's availability or"
"RTN","SDM1",41,0)
 .W !,"'D' to specify an earlier or later date to begin the availability display."
"RTN","SDM1",42,0)
 I X=" ",$D(SD),SD S Y=SD D AT^SDUTL W Y S Y=SD G OVR
"RTN","SDM1",43,0)
 I $E($P(X,"@",2),1,4)?1.4"0" K %DT S X=$P(X,"@"),X=$S($L(X):X,1:"T"),%DT="XF" D ^%DT G ADT:Y'>0 S X1=Y,X2=-1 D C^%DTC S X=X_.24
"RTN","SDM1",44,0)
 K %DT S %DT="TXEF" D ^%DT
"RTN","SDM1",45,0)
 ;SD*5.3*408  verify that day hasn't been canceled via "SET UP A CLINIC"
"RTN","SDM1",46,0)
 I $G(^SC(+SC,"ST",$P(Y,"."),1))'="",^SC(+SC,"ST",$P(Y,"."),1)'["[" D  G ADT
"RTN","SDM1",47,0)
 .W !,"There is no availability for this date/time.",!
"RTN","SDM1",48,0)
 I $P(Y,".",2)=24 S X1=$P(Y,"."),X2=1 D C^%DTC S Y=X_".000001"
"RTN","SDM1",49,0)
OVR I $D(^HOLIDAY($P(Y,"."),0)),'SDSOH W *7,?50,$P(^(0),U,2),"??" K SDSDATE G ADT
"RTN","SDM1",50,0)
 I $D(SDINA),$P(Y,".")'<SDINA,$S('$D(SDRE):1,SDRE>$P(Y,".")!('SDRE):1,1:0) D IN W !,*7,@SDMSG K SDMSG K SDSDATE G ADT
"RTN","SDM1",51,0)
 I Y#1=0 K SDSDATE G 1
"RTN","SDM1",52,0)
 I $P(Y,".")'<SDEDT W !,*7,"EXCEEDS MAXIMUM DAYS FOR FUTURE APPOINTMENT!!",*7 K SDSDATE G ADT
"RTN","SDM1",53,0)
 ;
"RTN","SDM1",54,0)
EN1 S (TMPD,X,SD)=Y,SM=0 D DOW  ;SD/478
"RTN","SDM1",55,0)
 F S=$P(SD,"."):0 S S=+$O(^DPT(DFN,"S",S)) Q:$P(S,".")-($P(SD,"."))  S I=+^(S,0) G ^SDM2:$P(^(0),U,2)'["C"
"RTN","SDM1",56,0)
 ;
"RTN","SDM1",57,0)
PRECAN I $D(^DPT(DFN,"S",SD,0)),$P(^(0),U,2)["P" S %=1 W !,"THIS TIME WAS PREVIOUSLY CANCELLED BY THE PATIENT",!,"ARE YOU SURE THAT YOU WANT TO PROCEED" D YN^DICN W:'% !,"ANSWER WITH (Y)ES OR (N)O" I (%-1) K SDSDATE G ADT
"RTN","SDM1",58,0)
 W !
"RTN","SDM1",59,0)
 ;SD*5.3*490 - AVCHK/AVCHK1 to check against pat DOB and clinic avail dt
"RTN","SDM1",60,0)
S N POP S POP=0 D AVCHK G:POP 1
"RTN","SDM1",61,0)
 N POP S POP=0 D AVCHK1 G:POP 1
"RTN","SDM1",62,0)
 I '$D(^SC(SC,"ST",$P(SD,"."),1)) S SS=+$O(^SC(+SC,"T"_Y,SD)) G XW:SS'>0,XW:^(SS,1)="" S ^SC(+SC,"ST",$P(SD,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(SD,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(SD,".")
"RTN","SDM1",63,0)
 ;
"RTN","SDM1",64,0)
LEN I $P(SL,U,2)]"" W !,"LENGTH OF APPOINTMENT (IN MINUTES): ",+SL,"// " R S:DTIME I S]"" G:$L(S)>3 LEN Q:U[S  S POP=0 D L G LEN:POP,S:S\5*5'=S,S:S>360,S:S<5 S SL=S_U_$P(SL,U,2,99)
"RTN","SDM1",65,0)
 ;
"RTN","SDM1",66,0)
SC S SDLOCK=$S('$D(SDLOCK):1,1:SDLOCK+1) G:SDLOCK>9 LOCK
"RTN","SDM1",67,0)
 L ^SC(SC,"ST",$P(SD,"."),1):5 G:'$T SC
"RTN","SDM1",68,0)
 S SDLOCK=0,S=^SC(SC,"ST",$P(SD,"."),1)
"RTN","SDM1",69,0)
 S I=SD#1-SB*100,ST=I#1*SI\.6+($P(I,".")*SI),SS=SL*HSI/60*SDDIF+ST+ST
"RTN","SDM1",70,0)
 G X:(I<1!'$F(S,"["))&(S'["CAN")
"RTN","SDM1",71,0)
 I SM<7 S %=$F(S,"[",SS-1) S:'%!($P(SL,"^",6)<3) %=999 I $F(S,"]",SS)'<%!(SDDIF=2&$E(S,ST+ST+1,SS-1)["[") S SM=7
"RTN","SDM1",72,0)
 ;
"RTN","SDM1",73,0)
SP I ST+ST>$L(S),$L(S)<80 S S=S_" " G SP
"RTN","SDM1",74,0)
 S SDNOT=1   ;SD*5.3*490 naked Do added below
"RTN","SDM1",75,0)
 F I=ST+ST:SDDIF:SS-SDDIF S ST=$E(S,I+1) S:ST="" ST=" " S Y=$E(STR,$F(STR,ST)-2) G C:S["CAN"!(ST="X"&($D(^SC(+SC,"ST",$P(SD,"."),"CAN")))),X:Y="" S:Y'?1NL&(SM<6) SM=6 S ST=$E(S,I+2,999) D  S:ST="" ST=" " S S=$E(S,1,I)_Y_ST
"RTN","SDM1",76,0)
 .Q:ST'=""
"RTN","SDM1",77,0)
 .Q:+SL'>+^SC(SC,"SL")
"RTN","SDM1",78,0)
 .S ST="   "
"RTN","SDM1",79,0)
 .Q
"RTN","SDM1",80,0)
 Q:SDMM  G OK^SDM1A:SM#9=0,^SDM3:$P(SL,U,7)]""&('$D(MXOK))
"RTN","SDM1",81,0)
 ;
"RTN","SDM1",82,0)
E G:'$D(^XUSEC("SDOB",DUZ)) NOOB
"RTN","SDM1",83,0)
 S %=2 W *7,!,$E($T(@SM),5,99),"...OK" D YN^DICN
"RTN","SDM1",84,0)
 I '% W !,"RESPOND YES OR NO" G E
"RTN","SDM1",85,0)
 S SM=9 G SC:'(%-1) K SDSDATE G 1
"RTN","SDM1",86,0)
 ;
"RTN","SDM1",87,0)
LOCK Q:SDMM  W !,*7,"ANOTHER USER HAS LOCKED THIS DATE - TRY AGAIN LATER" Q
"RTN","SDM1",88,0)
 ;
"RTN","SDM1",89,0)
6 ;;OVERBOOK!
"RTN","SDM1",90,0)
7 ;;THAT TIME IS NOT WITHIN SCHEDULED PERIOD!
"RTN","SDM1",91,0)
C S POP=1 W !,*7,"CAN'T BOOK WITHIN A CANCELLED TIME PERIOD!",!
"RTN","SDM1",92,0)
 Q:SDMM  K SDSDATE G 1
"RTN","SDM1",93,0)
 ;
"RTN","SDM1",94,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDM1",95,0)
 ;
"RTN","SDM1",96,0)
DOW S %=$E(X,1,3),Y=$E(X,4,5),Y=Y>2&'(%#4)+$E("144025036146",Y)
"RTN","SDM1",97,0)
 F %=%:-1:281 S Y=%#4=1+1+Y
"RTN","SDM1",98,0)
 S Y=$E(X,6,7)+Y#7 Q
"RTN","SDM1",99,0)
 ;
"RTN","SDM1",100,0)
X I SDMM S POP=1 Q
"RTN","SDM1",101,0)
 G:I<1 XW
"RTN","SDM1",102,0)
 S:Y'?1NL&(SM<6) SM=6
"RTN","SDM1",103,0)
 G OK^SDM1A:SM#9=0,^SDM3:$P(SL,U,7)]""&('$D(MXOK))
"RTN","SDM1",104,0)
XW W *7,"  WHEN??" K SDSDATE G 1
"RTN","SDM1",105,0)
 ;
"RTN","SDM1",106,0)
AVCHK ;added SD*5.3*490
"RTN","SDM1",107,0)
 I '$D(VADM) Q:'DFN  S VADM(3)=$P(^DPT(DFN,0),U,3)
"RTN","SDM1",108,0)
 Q:$P(X,".",1)=$P(VADM(3),U,1)
"RTN","SDM1",109,0)
 I $P(X,".",1)<$P(VADM(3),U,1) W *7,!!,"That date is prior to the patient's date of birth.",!! S POP=1 K SDSDATE Q
"RTN","SDM1",110,0)
 Q
"RTN","SDM1",111,0)
 ;
"RTN","SDM1",112,0)
AVCHK1 ;added SD*5.3*490
"RTN","SDM1",113,0)
 S AVDT=0,AVDT=$O(^SC(+SC,"T",AVDT)) Q:'AVDT
"RTN","SDM1",114,0)
 I $P(X,".",1)<AVDT W *7,!!,"That date is prior to the clinic's availability date.",!! S POP=1 K SDSDATE,AVDT Q
"RTN","SDM1",115,0)
 Q
"RTN","SDM1",116,0)
 ;
"RTN","SDM1",117,0)
NOOB W !,"NO OPEN SLOTS THEN",*7 K SDSDATE G 1
"RTN","SDM1",118,0)
 ;
"RTN","SDM1",119,0)
WRT W !,+SL," MINUTE APPOINTMENTS "
"RTN","SDM1",120,0)
 W $S($P(SL,U,2)["V":"(VARIABLE LENGTH)",1:"") Q
"RTN","SDM1",121,0)
 ;
"RTN","SDM1",122,0)
L S SDSL=$S($P(SL,"^",6)]"":60/$P(SL,"^",6),1:"") Q:'SDSL
"RTN","SDM1",123,0)
 I S\(SDSL)*(SDSL)'=S W *7,!,"Appt. length must = or be a multiple of the increment minutes per hour (",SDSL,")",! S POP=1
"RTN","SDM1",124,0)
 Q
"RTN","SDM1",125,0)
 ;
"RTN","SDM1",126,0)
IN S SDHY=$S($D(Y):Y,1:""),Y=SDINA D DTS^SDUTL S Y1=Y,Y=SDRE
"RTN","SDM1",127,0)
 D:Y DTS^SDUTL
"RTN","SDM1",128,0)
 S SDMSG="""*** Note: Clinic is scheduled to be inactivated on "","_""""_Y1_""""_$S(SDRE:",!,?10,"_""" and reactivated on "","_""""_Y_"""",1:""),Y=SDHY K Y1,SDHY
"RTN","SDM1",129,0)
 Q
"RTN","SDM1",130,0)
 ;
"RTN","SDM1",131,0)
SPIN W !,"There are more special instructions. Do you want to display them"
"RTN","SDM1",132,0)
 S %=2 D YN^DICN
"RTN","SDM1",133,0)
 I '% W !,"Enter Y to see the remaining special instructions, or N if you don't wish to see them" G SPIN
"RTN","SDM1",134,0)
 I (%-1) S POP=1 Q
"RTN","SDM1",135,0)
 W !,^SC(SC,"SI",%I,0),! Q
"RTN","SDM1",136,0)
 ;
"RTN","SDM1",137,0)
REDDT() ;Prompt for availability redisplay date
"RTN","SDM1",138,0)
 N %DT,X,Y
"RTN","SDM1",139,0)
 S %DT="AEX"
"RTN","SDM1",140,0)
 S %DT("A")="DATE TO BEGIN THE RE-DISPLAY OF CLINIC AVAILABILITY: "
"RTN","SDM1",141,0)
 W ! D ^%DT
"RTN","SDM1",142,0)
 Q Y
"RTN","SDM1",143,0)
WL(SC) ;Wait List Hook/teh patch 263 ;SD/327 passed 'SC'
"RTN","SDM1",144,0)
 Q:$G(SC)'>0
"RTN","SDM1",145,0)
 I '$D(^SC(SC)) Q
"RTN","SDM1",146,0)
 I $D(SC) S SDWLFLG=0 D
"RTN","SDM1",147,0)
 .I $D(^SDWL(409.32,"B",+SC)) S SDWLFLG=1
"RTN","SDM1",148,0)
 .I 'SDWLFLG S SDWLDSS=$P($G(^SC(+SC,0)),U,7) I $D(^SDWL(409.31,"B",SDWLDSS)) S SDWLFLG=2 D
"RTN","SDM1",149,0)
 ..I SDWLFLG=1 S SDWLSC=$O(^SDWL(409.32,"B",+SC,0)) I $P(^SDWL(409.32,SDWLSC,0),U,4) S SDWLFLG=0
"RTN","SDM1",150,0)
 .I SDWLFLG=2 S SDWLDS=$O(^SDWL(409.31,"E",DUZ(2),0)) I $D(^SDWL(409.31,SDWLDSS,"I",+SDWLDS,0)),$P(^(0),U,4) S SDWLFLG=0
"RTN","SDM1",151,0)
 .I SDWLFLG D
"RTN","SDM1",152,0)
 ..K SDWLSC,SDWLDSS,SDWLDS,SDWLFLG
"RTN","SDM1",153,0)
 ..S SDWLOPT=1,SDWLERR=0 D OPT^SDWLE D EN^SDWLKIL
"RTN","SDM1",154,0)
 Q
"RTN","SDM1A")
0^20^B58026958^B42131509
"RTN","SDM1A",1,0)
SDM1A ;SF/GFT,ALB/TMP - MAKE APPOINTMENT ; 8/18/05 12:57pm  ; Compiled April 17, 2007 15:12:14
"RTN","SDM1A",2,0)
 ;;5.3;Scheduling;**26,94,155,206,168,223,241,263,327,478,446**;Aug 13, 1993;Build 77
"RTN","SDM1A",3,0)
OK I $D(SDMLT) D ^SDM4 Q:X="^"!(SDMADE=2)
"RTN","SDM1A",4,0)
 S ^SC(SC,"ST",$P(SD,"."),1)=S,^DPT(DFN,"S",SD,0)=SC,^SC(SC,"S",SD,0)=SD S:'$D(^DPT(DFN,"S",0)) ^(0)="^2.98P^^" S:'$D(^SC(SC,"S",0)) ^(0)="^44.001DA^^" L
"RTN","SDM1A",5,0)
S1 L ^SC(SC,"S",SD,1):5 G:'$T S1 F SDY=1:1 I '$D(^SC(SC,"S",SD,1,SDY)) S:'$D(^(0)) ^(0)="^44.003PA^^" S ^(SDY,0)=DFN_U_(+SL) L  Q
"RTN","SDM1A",6,0)
 I SM S ^("OB")="O" ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDY,"OB")
"RTN","SDM1A",7,0)
 I $D(^SC(SC,"RAD")),^("RAD")="Y"!(^("RAD")=1) S ^SC("ARAD",SC,SD,DFN)=""
"RTN","SDM1A",8,0)
 S SDINP=$$INP^SDAM2(DFN,SD)
"RTN","SDM1A",9,0)
 ;-- added sub-category
"RTN","SDM1A",10,0)
 S COV=3,SDYC="",COV=$S(COLLAT=1:1,1:3),SDYC=$S(COLLAT=7:1,1:"")
"RTN","SDM1A",11,0)
 S:SD<DT SDSRTY="W"
"RTN","SDM1A",12,0)
 S ^DPT(DFN,"S",SD,0)=SC_"^"_$$STATUS(SC,SDINP,SD)_"^^^^^"_COV_"^^^^"_SDYC_"^^^^^"_SDAPTYP_U_$G(SD17)_"^^"_DT_"^^^^^"_$G(SDXSCAT)_U_$P($G(SDSRTY),U,2)_U_$$NAVA^SDMANA(SC,SD,$P($G(SDSRTY),U,2))
"RTN","SDM1A",13,0)
 S ^DPT(DFN,"S",SD,1)=$G(SDDATE)_U_$G(SDSRFU)
"RTN","SDM1A",14,0)
 I $D(SDMULT) S SDCLNCND=^SC(SC,0),STPCOD=$P(SDCLNCND,U,7),TMPYCLNC=SC_U_$P(SDCLNCND,U) D A^SDCNSLT ;SD/478 MULTI CLINIC OPTION SELECTED
"RTN","SDM1A",15,0)
 ;xref DATE APPT. MADE field
"RTN","SDM1A",16,0)
 D
"RTN","SDM1A",17,0)
 .N DIV,DA,DIK
"RTN","SDM1A",18,0)
 .S DA=SD,DA(1)=DFN,DIK="^DPT(DA(1),""S"",",DIK(1)=20 D EN1^DIK
"RTN","SDM1A",19,0)
 .Q
"RTN","SDM1A",20,0)
 K:$D(^DPT(DFN,"S",SD,"R")) ^("R") K:$D(^DPT("ASDCN",SC,SD,DFN)) ^(DFN)
"RTN","SDM1A",21,0)
 S SDRT="A",SDTTM=SD,SDPL=SDY,SDSC=SC D RT^SDUTL
"RTN","SDM1A",22,0)
 W !,"   ",+SL,"-MINUTE APPOINTMENT MADE" K SDINP
"RTN","SDM1A",23,0)
 ;confirm request type & follow-up indicator
"RTN","SDM1A",24,0)
 I $D(SDSRTY(0)) D CONF(.SDSRTY,.SDSRFU,DFN,SD,SC) W !
"RTN","SDM1A",25,0)
 I $P(SD,".")'>DT,$D(^DPT(DFN,.321)) D EN1^SDM3
"RTN","SDM1A",26,0)
 ;Wait List SD*5.3*263
"RTN","SDM1A",27,0)
 ;I '$D(SDWLLIST) D ^SDWLR ;replaced with sd/372, see below
"RTN","SDM1A",28,0)
EWLCHK ;check if patient has any open EWL entries (SD/372)
"RTN","SDM1A",29,0)
 ;get appointment
"RTN","SDM1A",30,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDM1A",31,0)
 D APPT^SDWLEVAL(DFN,SD,SC)
"RTN","SDM1A",32,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDM1A",33,0)
 N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDM1A",34,0)
 .K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDM1A",35,0)
 .D INIT^SDWLPL(DFN,"M")
"RTN","SDM1A",36,0)
 .Q:'$D(^TMP($J,"SDWLPL"))
"RTN","SDM1A",37,0)
 .D LIST^SDWLPL("M",DFN)
"RTN","SDM1A",38,0)
 .F  Q:'$D(^TMP($J,"SDWLPL"))  N SDR D ANSW^SDWLEVAL(1,.SDR) I 'SDR D LIST^SDWLPL("M",DFN) D
"RTN","SDM1A",39,0)
 ..F  N SDR D ANSW^SDWLEVAL(0,.SDR) Q:'$D(^TMP($J,"SDWLPL"))  I 'SDR W !,"MUST ENTER A REASON NOT TO DISPOSITION MATCHED EWL ENTRY",!
"RTN","SDM1A",40,0)
 ;CREATE 120 FLAG IF APPLICABLE; appt created 
"RTN","SDM1A",41,0)
FLG N SDST S SDST=$G(^TMP($J,"APPT",1)) I +SDST>0 D
"RTN","SDM1A",42,0)
 .Q  ; sd/446
"RTN","SDM1A",43,0)
 .N SDT,SDDES,SDPAR,SDDES1,SDT1 S SDPAR=0 S SDT=+SDST,SDDES=$P(SDST,U,17) I SDDES="" S SDDES=DT ; today's date if no desired date
"RTN","SDM1A",44,0)
 .S X=SDT D H^%DTC S SDT1=%H
"RTN","SDM1A",45,0)
 .S X=SDDES D H^%DTC S SDDES1=%H
"RTN","SDM1A",46,0)
 .I SDT1-SDDES1>120 N SD120,SD120A S SD120=1,SD120A=1  D
"RTN","SDM1A",47,0)
 ..; CREATE ewl eN SDPR S SDPR=$S(SDDES=DT:"A",1:"F") entry with 120 flag
"RTN","SDM1A",48,0)
 ..N SDPR S SDPR=$S(SDDES=DT:"A",1:"F") ;10
"RTN","SDM1A",49,0)
 ..N SDWLIN S SDWLIN=+$P(SDST,U,15) ;2
"RTN","SDM1A",50,0)
 ..N SDWLSCPR S SDWLSCPR=0 I +$P(SDST,U,10)=11 S SDWLSCPR=1 ;15
"RTN","SDM1A",51,0)
 ..N SC,SDWLSCL S SC=+$P(SDST,U,2) D
"RTN","SDM1A",52,0)
 ...I $D(^SDWL(409.32,"B",SC)) S SDWLSCL=$O(^SDWL(409.32,"B",SC,"")) Q  ;8
"RTN","SDM1A",53,0)
 ...;create 409.32 entry
"RTN","SDM1A",54,0)
 ...N DA,DIC S DIC(0)="LX",X=SC,DIC="^SDWL(409.32," D FILE^DICN
"RTN","SDM1A",55,0)
 ...S SDWLSCL=DA
"RTN","SDM1A",56,0)
 ...S DIE="^SDWL(409.32,"
"RTN","SDM1A",57,0)
 ...S DR=".02////^S X=SDWLIN" D ^DIE
"RTN","SDM1A",58,0)
 ...S DR="1////^S X=DT"
"RTN","SDM1A",59,0)
 ...S DR=DR_";2////^S X=DUZ"
"RTN","SDM1A",60,0)
 ...D ^DIE S SDPAR=1
"RTN","SDM1A",61,0)
 ..N DA S DIC(0)="LX",(X,SDWLDFN)=+$P(SDST,U,4),X=SDWLDFN,DIC="^SDWL(409.3," D FILE^DICN
"RTN","SDM1A",62,0)
 ..F  L +^SDWL(409.3,DA):5 Q:$T  D
"RTN","SDM1A",63,0)
 ...I '$T W !,"Unable to acquire a lock on the Wait List file" Q
"RTN","SDM1A",64,0)
 ..; Update EWL variables.
"RTN","SDM1A",65,0)
 ..S SDWLDA=DA D EN^SDWLE11 ; get enrollee both SDWLDA and SDWLDFN have to be
"RTN","SDM1A",66,0)
 ..N SDWLCM S SDWLCM=" > 120 days; appt created"
"RTN","SDM1A",67,0)
 ..N SDWLSCPG S SDWLSCPG=$S($P($G(^DPT(SDWLDFN,.3)),U,1)="Y":$P(^(.3),U,2),1:"")
"RTN","SDM1A",68,0)
 ..S DR="1////^S X=DT"
"RTN","SDM1A",69,0)
 ..S DR=DR_";2////^S X=SDWLIN"
"RTN","SDM1A",70,0)
 ..S DR=DR_";4////^S X=4"
"RTN","SDM1A",71,0)
 ..S DR=DR_";8////^S X=SDWLSCL"
"RTN","SDM1A",72,0)
 ..S DR=DR_";9////^S X=DUZ"
"RTN","SDM1A",73,0)
 ..S DR=DR_";10////^S X=SDPR"
"RTN","SDM1A",74,0)
 ..S DR=DR_";11////^S X=2" ; by patient for this entry to avoid asking for provider
"RTN","SDM1A",75,0)
 ..S DR=DR_";14////^S X=SDWLSCPG"
"RTN","SDM1A",76,0)
 ..S DR=DR_";15////^S X=SDWLSCPR"
"RTN","SDM1A",77,0)
 ..S DR=DR_";22////^S X=SDDES"
"RTN","SDM1A",78,0)
 ..S DR=DR_";23////^S X=""O"""
"RTN","SDM1A",79,0)
 ..S DR=DR_";25////^S X=SDWLCM"
"RTN","SDM1A",80,0)
 ..S DR=DR_";36////^S X=SD120"
"RTN","SDM1A",81,0)
 ..S DR=DR_";39////^S X=SD120A"
"RTN","SDM1A",82,0)
 ..S DIE="^SDWL(409.3,"
"RTN","SDM1A",83,0)
 ..D ^DIE
"RTN","SDM1A",84,0)
 ..L -^SDWL(409.3,DA)
"RTN","SDM1A",85,0)
 ..D MESS^SDWL120(SDWLDFN,SC,SDT,SDPAR)
"RTN","SDM1A",86,0)
 ;continue appointment entry process
"RTN","SDM1A",87,0)
ORD S %=2 W !,"WANT PATIENT NOTIFIED OF LAB,X-RAY, OR EKG STOPS" D YN^DICN I '% W !,"  Enter YES to notify patient on appt. letter of LAB, X-RAY, or EKG stops" G ORD
"RTN","SDM1A",88,0)
 I '(%-1) D ORDY^SDM3
"RTN","SDM1A",89,0)
OTHER R !,"  OTHER INFO: ",D:DTIME I D["^" W !,*7,"'^' not allowed - hit return if no 'OTHER INFO' is to be entered" G OTHER
"RTN","SDM1A",90,0)
 S TMPD=D I $L(D)>150 D MSG^SDMM G OTHER ;SD/478
"RTN","SDM1A",91,0)
 I D]"",D?."?"!(D'?.ANP) W "  ENTER LAB, SCAN, ETC." G OTHER
"RTN","SDM1A",92,0)
 I $L($G(^SC(SC,"S",SD,1,SDY,0)))+$L(D)+$L(DT)+$S($D(DUZ):$L(DUZ),1:0)>250 D MSG^SDMM G OTHER  ; sd/446
"RTN","SDM1A",93,0)
 S $P(^(0),"^",4)=D,$P(^(0),U,6,7)=$S($D(DUZ):DUZ,1:"")_U_DT ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDY,0)
"RTN","SDM1A",94,0)
 D:$D(TMP) LINK^SDCNSLT(SC,SDY,SD,CNSLTLNK) ;SD/478
"RTN","SDM1A",95,0)
 D:$D(TMP) EDITCS^SDCNSLT(SD,TMPD,TMPYCLNC,CNSLTLNK) ;SD/478
"RTN","SDM1A",96,0)
 K TMP  ;SD/478
"RTN","SDM1A",97,0)
XR I $S('$D(^SC(SC,"RAD")):1,^("RAD")="Y":0,^("RAD")=1:0,1:1) S %=2 W !,"WANT PREVIOUS X-RAY RESULTS SENT TO CLINIC" D YN^DICN G:'% HXR I '(%-1) S ^SC("ARAD",SC,SD,DFN)=""
"RTN","SDM1A",98,0)
SDMM S SDEMP=0 I COLLAT=7 S:SDEC'=SDCOL SDEMP=SDCOL G OV
"RTN","SDM1A",99,0)
 D ELIG^VADPT I $O(VAEL(1,0))>0 D ELIG^SDM4:"369"[SDAPTYP S SDEMP=$S(SDDECOD:SDDECOD,1:SDEMP)
"RTN","SDM1A",100,0)
OV Q:$D(SDZM)  K SDQ1,SDEC,SDCOL I +SDEMP S $P(^SC(SC,"S",SD,1,SDY,0),"^",10)=+SDEMP
"RTN","SDM1A",101,0)
 S SDMADE=1 D EVT Q
"RTN","SDM1A",102,0)
HXR W !,"  Enter YES to have previous XRAY results sent to the clinic" G XR
"RTN","SDM1A",103,0)
 Q
"RTN","SDM1A",104,0)
CS S SDCS=+$P(^SC(+SC,0),"^",7) I $S('$D(^DIC(40.7,SDCS,0)):1,'$P(^(0),"^",3):0,1:$P(^(0),"^",3)'>DT) W !!,*7,"** WARNING - CLINIC HAS AN INVALID OR INACTIVE STOP CODE!!!",!!
"RTN","SDM1A",105,0)
 S SDCS=+$P(^SC(+SC,0),"^",18) I $S('SDCS:0,'$D(^DIC(40.7,SDCS,0)):1,'$P(^(0),"^",3):0,1:$P(^(0),"^",3)'>DT) W !!,*7,"** WARNING - CLINIC HAS AN INVALID OR INACTIVE CREDIT STOP CODE!!!",!!
"RTN","SDM1A",106,0)
 K SDCS Q
"RTN","SDM1A",107,0)
STATUS(SDCL,SDINP,SDT) ; -- determine status for NEW appts
"RTN","SDM1A",108,0)
 Q $S(SDINP]"":SDINP,$$CHK(.SDCL,.SDT):"NT",1:"")
"RTN","SDM1A",109,0)
CHK(SDCL,SDT) ; -- should appt be NT'ed
"RTN","SDM1A",110,0)
 ; -- non-count clinic check := don't NT appt
"RTN","SDM1A",111,0)
 ; -- appt update executed   := need to NT appt
"RTN","SDM1A",112,0)
 ; -- otherwise              := don't NT appt
"RTN","SDM1A",113,0)
 Q $S($P($G(^SC(SDCL,0)),U,17)="Y":0,$D(^SDD(409.65,"AUPD",$P(SDT,"."))):1,1:0)
"RTN","SDM1A",114,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDM1A",115,0)
 D MAKE^SDAMEVT(DFN,SD,SC,SDY,0)
"RTN","SDM1A",116,0)
 Q
"RTN","SDM1A",117,0)
REQ(SDT) ; -- which is required check in(CI) or out(CO)
"RTN","SDM1A",118,0)
 Q $S($$REQDT()>SDT:"CI",1:"CO")
"RTN","SDM1A",119,0)
REQDT() ; -- co required date
"RTN","SDM1A",120,0)
 Q $S($P(^DG(43,1,"SCLR"),U,23):$P(^("SCLR"),U,23),1:2931001)
"RTN","SDM1A",121,0)
COCMP(DFN,SDT) ; -- date CO completed
"RTN","SDM1A",122,0)
 Q $P($G(^SCE(+$P($G(^DPT(DFN,"S",SDT,0)),U,20),0)),U,7)
"RTN","SDM1A",123,0)
CI(SDCL,SDT,SDDA,SDACT) ; -- ok to update DPT
"RTN","SDM1A",124,0)
 N C
"RTN","SDM1A",125,0)
 I '$$CHK(.SDCL,.SDT) G CIQ
"RTN","SDM1A",126,0)
 I $$REQ(SDT)'="CI" G CIQ
"RTN","SDM1A",127,0)
 I SDACT="SET",$D(^DPT(+^SC(SDCL,"S",SDT,1,SDDA,0),"S",SDT,0)),$P(^(0),U,2)="NT" S $P(^(0),U,2)=""
"RTN","SDM1A",128,0)
 I SDACT="KILL" S C=$G(^SC(SDCL,"S",SDT,1,SDDA,"C")) I $D(^DPT(+$G(^(0)),"S",SDT,0)),$P(^(0),U,2)="",'$P(C,U,3) S $P(^(0),U,2)="NT"
"RTN","SDM1A",129,0)
CIQ Q
"RTN","SDM1A",130,0)
CO(SDCL,SDT,SDDA,SDACT) ; -- ok to update DPT
"RTN","SDM1A",131,0)
 N DFN,C
"RTN","SDM1A",132,0)
 I '$$CHK(.SDCL,.SDT) G COQ
"RTN","SDM1A",133,0)
 I $$REQ(.SDT)'="CO" D  G COQ
"RTN","SDM1A",134,0)
 .I SDACT="SET",$D(^DPT(+^SC(SDCL,"S",SDT,1,SDDA,0),"S",SDT,0)),$P(^(0),U,2)="NT" S $P(^(0),U,2)=""
"RTN","SDM1A",135,0)
 .I SDACT="KILL" S C=$G(^SC(SDCL,"S",SDT,1,SDDA,"C")) I $D(^DPT(+$G(^(0)),"S",SDT,0)),$P(^(0),U,2)="",'C S $P(^(0),U,2)="NT"
"RTN","SDM1A",136,0)
 S DFN=+^SC(SDCL,"S",SDT,1,SDDA,0)
"RTN","SDM1A",137,0)
 D UPD(.DFN,.SDT,$$COCMP(.DFN,.SDT),$S(SDACT="SET":X,1:""))
"RTN","SDM1A",138,0)
COQ Q
"RTN","SDM1A",139,0)
UPD(DFN,SDT,SDCOCMP,SDCODT) ; -- update status
"RTN","SDM1A",140,0)
 N Y
"RTN","SDM1A",141,0)
 I $D(^DPT(DFN,"S",SDT,0)) S Y=$P(^(0),U,2) D
"RTN","SDM1A",142,0)
 .I 'SDCOCMP!('SDCODT) S:Y="" $P(^DPT(DFN,"S",SDT,0),U,2)="NT" Q
"RTN","SDM1A",143,0)
 .S:Y="NT" $P(^DPT(DFN,"S",SDT,0),U,2)=""
"RTN","SDM1A",144,0)
 Q
"RTN","SDM1A",145,0)
OE(SDOE,SDACT) ; -- called by x-ref on co completed field(#.07) in ^SCE
"RTN","SDM1A",146,0)
 N Y S Y=^SCE(SDOE,0)
"RTN","SDM1A",147,0)
 I $P(Y,U,8)'=1 G OEQ
"RTN","SDM1A",148,0)
 I $$REQ(+Y)'="CO" G OEQ
"RTN","SDM1A",149,0)
 I '$$CANT(+$P(Y,U,2),+Y,SDOE),'$$CHK(+$P(Y,U,4),+Y) G OEQ
"RTN","SDM1A",150,0)
 D UPD(+$P(Y,U,2),+Y,$S(SDACT="SET":X,1:""),$P($G(^SC(+$P(Y,U,4),"S",+Y,1,+$P(Y,U,9),"C")),U,3))
"RTN","SDM1A",151,0)
OEQ Q
"RTN","SDM1A",152,0)
CONF(SDSRTY,SDSRFU,DFN,SDT,SC) ;Confirm scheduling request type
"RTN","SDM1A",153,0)
 ;Input: SDSRTY=request type
"RTN","SDM1A",154,0)
 ;Input: SDSRFU=follow-up indicator
"RTN","SDM1A",155,0)
 ;Input: DFN=patient ien
"RTN","SDM1A",156,0)
 ;Input: SDT=appointment date/time
"RTN","SDM1A",157,0)
 ;Input: SC=clinic ifn
"RTN","SDM1A",158,0)
 N DIR,DIE,DA,DR,SDX,SDY,X,Y
"RTN","SDM1A",159,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","SDM1A",160,0)
 S DIR("A")="THIS APPOINTMENT IS MARKED AS '"_SDSRTY(0)_"', IS THIS CORRECT"
"RTN","SDM1A",161,0)
 W ! D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDM1A",162,0)
 I 'Y S SDX='SDSRTY,SDX(0)=$$TXRT(.SDX) W !!,"THIS APPOINTMENT HAS NOW BEEN MARKED AS '"_$S('SDSRTY:"",1:"NOT ")_"NEXT AVAILABLE'."
"RTN","SDM1A",163,0)
 ;S DIR("A")="THIS APPOINTMENT IS DEFINED AS '"_$S(SDSRFU:"FOLLOW-UP",1:"OTHER THAN FOLLOW-UP")_"', OK"
"RTN","SDM1A",164,0)
 ;W ! D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDM1A",165,0)
 ;I 'Y S SDY='SDSRFU W "  (changed)"
"RTN","SDM1A",166,0)
 Q:'$D(SDX)  S DR=""
"RTN","SDM1A",167,0)
 I $D(SDX) S DR="25///^S X=$P(SDX,U,2);26///^S X=$$NAVA^SDMANA(SC,SDT,$P(SDX,U,2))"
"RTN","SDM1A",168,0)
 ;I $D(SDY) S:$L(DR) DR=DR_";" S DR=DR_"26///^S X=SDY"
"RTN","SDM1A",169,0)
 S DA=SDT,DA(1)=DFN
"RTN","SDM1A",170,0)
 S DIE="^DPT(DA(1),""S""," D ^DIE
"RTN","SDM1A",171,0)
 Q
"RTN","SDM1A",172,0)
TXRT(SDSRTY)    ;Transform request type
"RTN","SDM1A",173,0)
 ;Input: SDSRTY=variable to return request type (pass by reference)
"RTN","SDM1A",174,0)
 ;Output: external text for SDSRTY(0)
"RTN","SDM1A",175,0)
 I SDSRTY S SDSRTY=SDSRTY_U_"N" Q "NEXT AVAILABLE"
"RTN","SDM1A",176,0)
 S SDSRTY=SDSRTY_U_"O" Q "NOT NEXT AVAILABLE"
"RTN","SDM1A",177,0)
CANT(DFN,SDT,SDOE) ;Determine if clinic appt. has been marked "NT"
"RTN","SDM1A",178,0)
 ;Output: '1' if appt. points to encounter and is marked "NT", otherwise '0'
"RTN","SDM1A",179,0)
 N SDAPP S SDAPP=$G(^DPT(DFN,"S",SDT,0))
"RTN","SDM1A",180,0)
 Q:$P(SDAPP,U,20)'=SDOE 0
"RTN","SDM1A",181,0)
 Q $P(SDAPP,U,2)="NT"
"RTN","SDM1A",182,0)
 ; -- Variable doc for above tags
"RTN","SDM1A",183,0)
 ;     SDCL := file 44 ien
"RTN","SDM1A",184,0)
 ;      SDT := appt date/time
"RTN","SDM1A",185,0)
 ;      DFN := file 2 ien
"RTN","SDM1A",186,0)
 ;     SDDA := ^SC(SDCL,"S",SDT,1,SDDA,0)
"RTN","SDM1A",187,0)
 ;    SDACT := current x-ref action 'set' or 'kill' 
"RTN","SDM1A",188,0)
 ;  SDCOCMP := check out completed date
"RTN","SDM1A",189,0)
 ;   SDCODT := check out date/time
"RTN","SDM1A",190,0)
 ;     SDOE := Outpatient Encounter ien
"RTN","SDM1A",191,0)
 ;    SDINP := inpatient status ('I' or null)    
"RTN","SDM1A",192,0)
 ;    SDINP := inpatient status ('I' or null)    
"RTN","SDM2A")
0^42^B17556910^n/a
"RTN","SDM2A",1,0)
SDM2A ; OG - MAKE APPOINTMENT - overflow routine due to SACC 10K limit.  ; Compiled August 28, 2007 16:08:18
"RTN","SDM2A",2,0)
 ;;5.3;Scheduling;**446**;Aug 13 1993;Build 77
"RTN","SDM2A",3,0)
WL(SC) ;Wait List Hook/teh patch 263 ;SD/327 passed 'SC'
"RTN","SDM2A",4,0)
 N DA,DIE,DR,SBEG,SCSR,SDDIV,SDINST,SDPAR,SDWLDA,SDWLDFN,SDWLSCL
"RTN","SDM2A",5,0)
 Q:$G(SC)'>0
"RTN","SDM2A",6,0)
 I '$D(^SC(SC)) Q
"RTN","SDM2A",7,0)
 S SDINST=$$GET1^DIQ(44,SC_",",3,"I")  ; get Inst
"RTN","SDM2A",8,0)
 I SDINST="" S SDDIV=$$GET1^DIQ(44,SC_",",3.5,"I") S:SDDIV'="" SDINST=$$GET1^DIQ(40.8,SDDIV_",",.07,"I")
"RTN","SDM2A",9,0)
 I SDINST="" D  Q  ; sd/446
"RTN","SDM2A",10,0)
 .N DIR
"RTN","SDM2A",11,0)
 .D MESS2^SDWL120(SC)
"RTN","SDM2A",12,0)
 .W !,"No Institution or Division is associated with this Clinic."
"RTN","SDM2A",13,0)
 .W !,"Unable to create a Wait List Entry. Abandoning request."
"RTN","SDM2A",14,0)
 .W !!,"A message is being sent to the administrators mail group"
"RTN","SDM2A",15,0)
 .W !,"alerting them to the situation."
"RTN","SDM2A",16,0)
 .S DIR(0)="E" D ^DIR
"RTN","SDM2A",17,0)
 .Q
"RTN","SDM2A",18,0)
 S SDPAR=0
"RTN","SDM2A",19,0)
 ;create 409.32 entry
"RTN","SDM2A",20,0)
 I $D(^SDWL(409.32,"B",SC)) S SDWLSCL=$O(^SDWL(409.32,"B",SC,""))
"RTN","SDM2A",21,0)
 E  D
"RTN","SDM2A",22,0)
 .N DA,DIC,X,DIE,DR
"RTN","SDM2A",23,0)
 .S DIC(0)="LX",X=SC,DIC="^SDWL(409.32," D FILE^DICN
"RTN","SDM2A",24,0)
 .S SDWLSCL=DA
"RTN","SDM2A",25,0)
 .S DIE="^SDWL(409.32,"
"RTN","SDM2A",26,0)
 .S DR=".02////^S X=SDINST" D ^DIE
"RTN","SDM2A",27,0)
 .S DR="1////^S X=DT"
"RTN","SDM2A",28,0)
 .S DR=DR_";2////^S X=DUZ"
"RTN","SDM2A",29,0)
 .D ^DIE S SDPAR=1 ; flag indicating clinic parameter entry
"RTN","SDM2A",30,0)
 .; CREATE 409.3 with 120 flag
"RTN","SDM2A",31,0)
 S DIC(0)="LX",(X,SDWLDFN)=DFN,DIC="^SDWL(409.3," D FILE^DICN
"RTN","SDM2A",32,0)
 ; File just created so lock should never fail.
"RTN","SDM2A",33,0)
 F  L +^SDWL(409.3,DA):5 Q:$T  W !,"Unable to acquire a lock on the Wait List file" Q
"RTN","SDM2A",34,0)
 ; Update EWL variables.
"RTN","SDM2A",35,0)
 S SDWLDA=DA D EN^SDWLE11 ; get enrollee both SDWLDA and SDWLDFN have to be defined
"RTN","SDM2A",36,0)
 S DIE="^SDWL(409.3,"
"RTN","SDM2A",37,0)
 S DR="1////^S X=DT"
"RTN","SDM2A",38,0)
 S DR=DR_";2////^S X=SDINST"
"RTN","SDM2A",39,0)
 S DR=DR_";4////^S X=4"
"RTN","SDM2A",40,0)
 S DR=DR_";8////^S X=SDWLSCL"
"RTN","SDM2A",41,0)
 S DR=DR_";9////^S X=DUZ"
"RTN","SDM2A",42,0)
 S DR=DR_";10////^S X=""A"""
"RTN","SDM2A",43,0)
 S DR=DR_";11////^S X=2" ; by patient for this entry to avoid asking for provider
"RTN","SDM2A",44,0)
 S DR=DR_";14////^S X="""_$S($P($G(^DPT(SDWLDFN,.3)),U,1)="Y":$P(^DPT(SDWLDFN,.3),U,2),1:"")_""""
"RTN","SDM2A",45,0)
 S DR=DR_";15////^S X="_$S($P($G(^DPT(SDWLDFN,.3)),U,1)="Y":1,1:0)
"RTN","SDM2A",46,0)
 S DR=DR_";22////^S X=SDDATE"
"RTN","SDM2A",47,0)
 S DR=DR_";23////^S X=""O"""
"RTN","SDM2A",48,0)
 S DR=DR_";25////^S X="" > 120 days"""
"RTN","SDM2A",49,0)
 S DR=DR_";36////^S X=1"
"RTN","SDM2A",50,0)
 D ^DIE
"RTN","SDM2A",51,0)
 L -^SDWL(409.3,DA)
"RTN","SDM2A",52,0)
 S SDWLFLG=0 D MESS^SDWL120(SDWLDFN,SDWLDA,SDPAR)
"RTN","SDM2A",53,0)
 Q
"RTN","SDM2A",54,0)
 ;
"RTN","SDM2A",55,0)
WLCL120(SC,DESDT) ; Is there clinic availability within 120 days of desired date ; sd/446
"RTN","SDM2A",56,0)
 N SBEG,SD120
"RTN","SDM2A",57,0)
 Q:$$GET1^DIQ(44,SC,2502,"I")="Y" 1  ; Non-count clinic. Allow > 120 days.
"RTN","SDM2A",58,0)
 S SD120=0,SBEG=DESDT-1
"RTN","SDM2A",59,0)
 F  S SBEG=$O(^SC(SC,"ST",SBEG)) Q:SBEG=""  I $$HASAVSL(^SC(SC,"ST",SBEG,1)) D  Q
"RTN","SDM2A",60,0)
 .N X,DESDTH
"RTN","SDM2A",61,0)
 .S X=SBEG D H^%DTC S SBEG=%H
"RTN","SDM2A",62,0)
 .S X=DESDT D H^%DTC S DESDTH=%H
"RTN","SDM2A",63,0)
 .S SD120=(SBEG-DESDTH>120)
"RTN","SDM2A",64,0)
 .Q
"RTN","SDM2A",65,0)
 Q 'SD120
"RTN","SDM2A",66,0)
 ;
"RTN","SDM2A",67,0)
WLCL120A(SDWLAPDT,SDDATE1,SC) ;
"RTN","SDM2A",68,0)
 N %DT,DIR,X,X1,X2,Y
"RTN","SDM2A",69,0)
 Q:$$GET1^DIQ(44,SC,2502,"I")="Y" 1  ; Non-count clinic. Allow > 120 days.
"RTN","SDM2A",70,0)
 S X=SDWLAPDT,%DT="TXF" D ^%DT
"RTN","SDM2A",71,0)
 Q:Y=-1 1
"RTN","SDM2A",72,0)
 S X1=Y,X2=SDDATE1 D ^%DTC
"RTN","SDM2A",73,0)
 I X'>120 Q 1
"RTN","SDM2A",74,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","SDM2A",75,0)
 S DIR("A")="Add to EWL",DIR("A",1)="The date is more than 120 days beyond the Desired Date"
"RTN","SDM2A",76,0)
 W ! D ^DIR
"RTN","SDM2A",77,0)
 I Y=1 D WL(SC)
"RTN","SDM2A",78,0)
 Q 0
"RTN","SDM2A",79,0)
 ;
"RTN","SDM2A",80,0)
WLCLASK() ; No appointment availability warning. ; sd/446
"RTN","SDM2A",81,0)
 N DIR
"RTN","SDM2A",82,0)
 S DIR(0)="Y"
"RTN","SDM2A",83,0)
 S DIR("A",1)="No appointments are available within 120 days of the Desired Date."
"RTN","SDM2A",84,0)
 S DIR("A",2)="Do you want to place this patient on the Electronic Wait List"
"RTN","SDM2A",85,0)
 S DIR("A",3)="or change the desired date?"
"RTN","SDM2A",86,0)
 S DIR("A",4)=""
"RTN","SDM2A",87,0)
 S DIR("A",5)="Enter ""Y"" to place on EWL, ""N"" to go back"
"RTN","SDM2A",88,0)
 S DIR("A")="or ""^"" to return to the CLINIC: prompt. "
"RTN","SDM2A",89,0)
 W ! D ^DIR
"RTN","SDM2A",90,0)
 Q Y
"RTN","SDM2A",91,0)
 ;
"RTN","SDM2A",92,0)
HASAVSL(SCSR) ; Has available slots ; sd/446
"RTN","SDM2A",93,0)
 ; Look at CLINIC PATTERN CURRENT AVAILABILITY string (44.005/1)
"RTN","SDM2A",94,0)
 ; If there is 1-9,j-z within the [ ... ], there is availability for that day.
"RTN","SDM2A",95,0)
 N DIC,F,SDOK,X,Y
"RTN","SDM2A",96,0)
 ; Allow whatever if user has a key to overbook.
"RTN","SDM2A",97,0)
 S DIC="^VA(200,"_DUZ_",51,",X="SDOB" D ^DIC Q:Y'=-1 1
"RTN","SDM2A",98,0)
 S X="SDMOB" D ^DIC Q:Y'=-1 1
"RTN","SDM2A",99,0)
 Q:SCSR'["[" 0  ; No slots.
"RTN","SDM2A",100,0)
 S SCSR=$TR($E(SCSR,$F(SCSR,"[")-1,$L(SCSR))," |"),(SDOK,F)=0
"RTN","SDM2A",101,0)
 F  S F=$F(SCSR,"[",F) Q:'F  D  Q:SDOK
"RTN","SDM2A",102,0)
 .N I,SCSR0,SL
"RTN","SDM2A",103,0)
 .S SCSR0=$E(SCSR,F,$F(SCSR,"]",F)-2)
"RTN","SDM2A",104,0)
 .F I=1:1:$L(SCSR0) S SL=$E(SCSR0,I) I $A(SL)>105&($A(SL)<123)!SL S SDOK=1 Q  ; If SL=1-9,j-z slots are available
"RTN","SDM2A",105,0)
 .Q
"RTN","SDM2A",106,0)
 Q SDOK
"RTN","SDMM")
0^35^B45359086^B40995043
"RTN","SDMM",1,0)
SDMM ;SF/GFT,MAN/GRR - MULTIPLE APPOINTMENTS ; 2/7/05 12:51pm  ; Compiled September 25, 2006 13:33:14
"RTN","SDMM",2,0)
 ;;5.3;Scheduling;**26,32,167,241,327,446**;Aug 13, 1993;Build 77
"RTN","SDMM",3,0)
 N SDHX,SDAPDT S SDMM=1 D ^SDM K SDMM Q
"RTN","SDMM",4,0)
RDTY K ^TMP($J,"APPT"),^TMP($J,"SDAMA301") ;SD/327
"RTN","SDMM",5,0)
 R !,"WANT TO MAKE DAILY OR WEEKLY APPOINTMENTS?: WEEKLY// ",SDTYP:DTIME Q:SDTYP["^"!('$T)  S:SDTYP="" SDTYP="W" S SDTYP=$$UP^XLFSTR($E(SDTYP)) I "WD"'[SDTYP W !,"ENTER 'D' FOR DAILY OR PRESS RETURN" G RDTY
"RTN","SDMM",6,0)
RD22 I SDTYP["D" S %=2 W !,"WANT APPOINTMENTS MADE ON SATURDAYS AND SUNDAYS" D YN^DICN S SDWE=$S(%<0:"^",%=2:"N",%=1:"Y",1:"?") Q:SDWE["^"  G:SDWE["?" HLP22
"RTN","SDMM",7,0)
ADT K SDERRFT S CCX=""
"RTN","SDMM",8,0)
 S X=$G(SDSDATE) S:X SDHX=X\1 K SDSDATE
"RTN","SDMM",9,0)
 W:X#1 !,"APPOINTMENT DATE/TIME REQUESTED: "
"RTN","SDMM",10,0)
 I '(X#1) R !,"DATE/TIME: ",X:DTIME I "^"[X K X,SD Q
"RTN","SDMM",11,0)
 I X="M"!(X="m") D MORDIS G ADT
"RTN","SDMM",12,0)
 I X="D"!(X="d") S X=$$REDDT^SDM1() D:X>0 MORD2 W:X="" $C(7),"  ??",! G ADT
"RTN","SDMM",13,0)
 I X?1"?".E D HLP1 G ADT
"RTN","SDMM",14,0)
 I X=" ",$G(SDAPDT) S Y=SDAPDT D AT^SDUTL W Y S Y=SDAPDT G OVR
"RTN","SDMM",15,0)
 I $E($P(X,"@",2),1,4)?1.4"0" K %DT S X=$P(X,"@"),X=$S($L(X):X,1:"T"),%DT="XF" D ^%DT G ADT:Y'>0 S X1=Y,X2=-1 D C^%DTC S X=X_.24
"RTN","SDMM",16,0)
 K %DT S %DT="TXEF" D ^%DT
"RTN","SDMM",17,0)
 I $P(Y,".",2)=24 S X1=$P(Y,"."),X2=1 D C^%DTC S Y=X_".000001"
"RTN","SDMM",18,0)
 S SDSOH=$S('$D(^SC(+SC,"SL")):0,$P(^("SL"),"^",8)']"":0,1:1)
"RTN","SDMM",19,0)
OVR S SDY1=$P(Y,".") I $D(^HOLIDAY(SDY1,0)),'SDSOH W *7,?50,$P(^(0),U,2),"??" G ADT
"RTN","SDMM",20,0)
 I $D(SDINA),SDY1'<SDINA,$S('$D(SDRE):1,SDRE>SDY1!('SDRE):1,1:0) S SDY=Y,Y=SDINA D DTS^SDUTL W !,*7,"Clinic is scheduled to be inactivated on ",Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" and reactivated on "_Y,1:"") S Y=SDY K SDY G ADT
"RTN","SDMM",21,0)
 I Y#1=0 G ADT
"RTN","SDMM",22,0)
 D SDFT I $P(Y,".")'<SDEDT W !,*7,"EXCEEDS MAXIMUM DAYS FOR FUTURE APPOINTMENT!!",*7 G ADT
"RTN","SDMM",23,0)
LEN I $P(SL,U,2)]"" W !,"LENGTH OF APPOINTMENTS (IN MINUTES): ",+SL,"// " R S:DTIME I S]"" G:$L(S)>3 LEN Q:U[S  S POP=0 D L^SDM1 G LEN:POP I S\5*5=S,S'>360,S'<5 S SL=S_U_$P(SL,U,2,99)
"RTN","SDMM",24,0)
 S SDOT=Y#1,SDDAT=$P(Y,"."),X=Y D DOW^SDM0
"RTN","SDMM",25,0)
RDC W !,"FOR HOW MANY CONSECUTIVE ",$S(SDTYP["W":$P($T(DAY),"^",Y+2)_"DAY'S",1:"DAYS")," DO YOU WANT APPOINTMENTS SCHEDULED",!,"   AT " S X=SDOT D TM W X,"?: "
"RTN","SDMM",26,0)
 R SDCN:DTIME G:SDCN=""!(SDCN="^") ADT G HLP:SDCN'?.N,HLP:SDCN<1,HLP:SDCN>60
"RTN","SDMM",27,0)
 S Y=SDDAT_SDOT,SDMCNT=0,SDMADE=0
"RTN","SDMM",28,0)
OTHER R !,"  OTHER INFO: ",D:DTIME I D["^" W !,*7,"'^' not allowed - hit return if no 'OTHER INFO' is to be entered" G OTHER
"RTN","SDMM",29,0)
 I $L(D)>150 D MSG G OTHER
"RTN","SDMM",30,0)
 I D]"",D?."?"!(D'?.ANP) W "  ENTER LAB, SCAN, ETC." G OTHER
"RTN","SDMM",31,0)
 I $L(D)+$L(SDW)>250 D MSG G OTHER
"RTN","SDMM",32,0)
BEGIN S SDZM=1,SDZY=Y,SDX9=X,SDM9=D D SDMM^SDM1A K SDZM S Y=SDZY,X=SDX9,D=SDM9
"RTN","SDMM",33,0)
 F SDZ=1:1:SDCN D MAKE^SDMM1 Q:$D(SDERRFT)  D  Q:POP
"RTN","SDMM",34,0)
 .S:SDMADE SDMCNT=SDMCNT+1 I SDMADE,SDZ=1 S SDAPDT=SD
"RTN","SDMM",35,0)
 .S SDMADE=0,POP=0 D GETNEX:SDTYP["W",GETNXD:SDTYP["D"
"RTN","SDMM",36,0)
 .Q
"RTN","SDMM",37,0)
 G:$D(SDERRFT) ADT
"RTN","SDMM",38,0)
END W !,SDMCNT," APPOINTMENTS MADE",!
"RTN","SDMM",39,0)
 ;display all created appointments
"RTN","SDMM",40,0)
 I $D(^TMP($J,"APPT")) N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDMM",41,0)
 .K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDMM",42,0)
 .D INIT^SDWLPL(DFN,"M")
"RTN","SDMM",43,0)
 .Q:'$D(^TMP($J,"SDWLPL"))  ;
"RTN","SDMM",44,0)
 .;D LIST^SDWLPL("M",DFN) ;display EWL entries
"RTN","SDMM",45,0)
 .F  Q:'$D(^TMP($J,"SDWLPL"))  D LIST^SDWLPL("M",DFN) N SDR D ANSW^SDWLEVAL(1,.SDR) I 'SDR D  ;D LIST^SDWLPL("M",DFN) D
"RTN","SDMM",46,0)
 ..F  N SDR  D ANSW^SDWLEVAL(0,.SDR) Q:'$D(^TMP($J,"SDWLPL"))  I 'SDR W !,"MUST ENTER A REASON NOT TO DISPOSITION MATCHED EWL ENTRY",!
"RTN","SDMM",47,0)
 I $D(^TMP($J,"APPT")) N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDMM",48,0)
 .;N SDTC D EWLANS^SDWLEVAL(.SDTC) ;user may reject EWL; 446/;
"RTN","SDMM",49,0)
 .;ask for selection of EWL to display
"RTN","SDMM",50,0)
 .;ASKS - returned answer (A/C/S/^)
"RTN","SDMM",51,0)
 .;    ^TMP("SDWLPL",$J) and ^TMP($J,"SDWLPL") are used
"RTN","SDMM",52,0)
 .;      to generate EWL open entries
"RTN","SDMM",53,0)
 .;I SDTC N SDCTN S SDCTN=0 F  N ASKS K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL") D ANS2^SDWLPL(DFN,.ASKS) Q:ASKS="^"  D  Q:SDCTN  ;446/;
"RTN","SDMM",54,0)
 .Q:'$D(^TMP($J,"SDWLPL"))  D ASKREM^SDWLEVAL S SDCTN=1 ;display and process selected open EWL entries  ;446/;
"RTN","SDMM",55,0)
 .;I 'SDTC Q  ;no EWL evaluation per user's decision
"RTN","SDMM",56,0)
 .Q
"RTN","SDMM",57,0)
 ;
"RTN","SDMM",58,0)
 K CCX,COLLAT,COV,D,I,POP,S,SC,SD,SDAPTYP,SDEDT,SDEMP,SDINA,SDLOCK,SDM9,SDMES,SDNOT,SDRE,SDSOH,SDW,SDWEE,SDX3,SDX7,SDX9,SDY1,SDYC,SDZ,SDZY,SDMES,SDCN,SDDAT,SDMADE,SDMCNT,SDOT,SDPL,SDRT,SDSC,SDTTM,SDTYP
"RTN","SDMM",59,0)
 K SDALLE,SDATD,SDAV,SDDECOD,SDEC,SDHX,SDIN,SDINP,SDOEL,SDT,SDY,%H,%T,C,DISYS,SDW,SDWE,SDX3,SDX7,SDX9,SDY1,SDYC,SDZY,SI,SL,SM,SS,X1,X2,Y,SDXF,% Q
"RTN","SDMM",60,0)
GETNEX I SDDAT#100<22 S SDDAT=SDDAT+7 S POP=0 D INACT Q:POP  G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNEX S Y=SDDAT_SDOT Q
"RTN","SDMM",61,0)
 S X1=SDDAT,X2=7 D C^%DTC S POP=0 D INACT Q:POP  S SDDAT=X G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNEX S Y=SDDAT_SDOT
"RTN","SDMM",62,0)
 Q
"RTN","SDMM",63,0)
GETNXD I SDDAT#100<28 S SDDAT=SDDAT+1 S POP=0 D INACT Q:POP  G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNXD S X=SDDAT D DOW^SDM0 S:SDWE["Y" Y=SDDAT_SDOT Q:SDWE["Y"  G:Y=0!(Y=6) GETNXD S Y=SDDAT_SDOT Q
"RTN","SDMM",64,0)
 S X1=SDDAT,X2=1 D C^%DTC S POP=0 D INACT Q:POP  S SDDAT=X G:$D(^HOLIDAY(SDDAT,0))&('SDSOH) GETNXD S X=SDDAT D DOW^SDM0 S:SDWE["Y" Y=SDDAT_SDOT Q:SDWE["Y"  G:Y=0!(Y=6) GETNXD S Y=SDDAT_SDOT
"RTN","SDMM",65,0)
 Q
"RTN","SDMM",66,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDMM",67,0)
 ;
"RTN","SDMM",68,0)
TM S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M" Q
"RTN","SDMM",69,0)
HLP W !,"Enter the number of appointments you want made (between 1 and 60)." G RDC
"RTN","SDMM",70,0)
HLP22 W !,"ENTER 'YES' IF YOU WANT THE SYSTEM TO TRY TO MAKE APPOINTMENTS ON SATURDAYS AND SUNDAYS" G RD22
"RTN","SDMM",71,0)
INACT I $D(SDINA),SDINA'>SDDAT,SDRE>SDDAT!('SDRE) W !,*7,"Appointments can't be made while clinic is inactivated" S POP=1
"RTN","SDMM",72,0)
 Q
"RTN","SDMM",73,0)
HLP1 W !,"Enter a date/time for the appointment"
"RTN","SDMM",74,0)
 W:$D(SD) " or a space to choose the same date/time",!,"as the patient you have just previously scheduled into this clinic"
"RTN","SDMM",75,0)
 W ".",!,"You may also select 'M' to display the next month's availability or"
"RTN","SDMM",76,0)
 W !,"'D' to specify an earlier or later date to begin the availability display."
"RTN","SDMM",77,0)
 Q
"RTN","SDMM",78,0)
SDFT S X1=DT,SDEDT=$S($D(^SC(SC,"SDP")):$P(^("SDP"),U,2),1:365) S:'SDEDT SDEDT=365 S X2=SDEDT D C^%DTC S SDEDT=X Q
"RTN","SDMM",79,0)
MSG W !!?5,"Text entered at OTHER INFO prompt was too long.  Please re-enter.",! Q
"RTN","SDMM",80,0)
 ;
"RTN","SDMM",81,0)
MORDIS I '$D(SDHX) W *7," ??" G ADT
"RTN","SDMM",82,0)
 S SDXF=0,X1=SDHX,X2=1 D C^%DTC
"RTN","SDMM",83,0)
MORD2 I $D(SDINA),SDINA'>X,SDRE>X!('SDRE) S SDHY=$S($D(Y):Y,1:""),Y=SDINA D DTS^SDUTL W *7,!,"Clinic is inactivated as of ",Y S Y=SDHY K SDHY G ADT
"RTN","SDMM",84,0)
EN S:$L(X)=1 X=$TR(X,"tnN","TTT") S:X="NOW" X="T" I X?.A!(+X=X),X<13,X'?1"T".E S X=X_" 1"
"RTN","SDMM",85,0)
 D  Q:Y<1
"RTN","SDMM",86,0)
 .N %DT
"RTN","SDMM",87,0)
 .S %DT="T" D ^%DT
"RTN","SDMM",88,0)
 .I Y<1 W !!,"Unable to evaluate date value """_X_""".",!
"RTN","SDMM",89,0)
 .Q
"RTN","SDMM",90,0)
 S:$S($D(DUZ)'[0:1,1:0) ^DISV(DUZ_U_+SC)=Y
"RTN","SDMM",91,0)
DISP S IOF=$S('$D(IOF):"!#",IOF']"":"!#",1:IOF) W @IOF S SDSOH=$S('$D(^SC(+SC,"SL")):0,$P(^("SL"),"^",8)']"":0,1:1),SDAV=0
"RTN","SDMM",92,0)
 I $D(SDINA),Y'<SDINA,SDRE>Y!('SDRE) S SDHY=Y,Y=SDINA D DTS^SDUTL W !,*7,"Clinic is inactive ",$S(SDRE:"from ",1:"as of "),Y S Y=SDRE D:Y DTS^SDUTL W $S(SDRE:" to "_Y,1:"") S Y=SDHY K SDHY Q:'SDRE
"RTN","SDMM",93,0)
 S:Y#100=0 Y=Y+1 S X=Y D D^SDM0:$E(X,4,5) S (SDX,X1)=X,X2=1 D C^%DTC S X=SDX K SDX Q
"RTN","SDRPA07")
0^26^B59962530^B52873373
"RTN","SDRPA07",1,0)
SDRPA07 ;BP-OIFO/ESW - APPOINTMENT BATCH TRANSMISSION BUILDER; ; 9/14/04 9:20am  ; Compiled April 24, 2006 17:00:51
"RTN","SDRPA07",2,0)
 ;;5.3;Scheduling;**290,333,349,376,446**;AUG 13 1993;Build 77
"RTN","SDRPA07",3,0)
 ;
"RTN","SDRPA07",4,0)
 ;
"RTN","SDRPA07",5,0)
SNDS19(ZTSK,SDBCID,SDMCID) ;Main entry point for the sending of SIU-S19 batch messages to
"RTN","SDRPA07",6,0)
 ; the National Patient Care Database
"RTN","SDRPA07",7,0)
 ;
"RTN","SDRPA07",8,0)
 ;Input  : ZTSK
"RTN","SDRPA07",9,0)
 ;Output : SDBCID - Batch Control ID
"RTN","SDRPA07",10,0)
 ;         SDMCID - Message Control ID
"RTN","SDRPA07",11,0)
 ;
"RTN","SDRPA07",12,0)
 ;
"RTN","SDRPA07",13,0)
 ;Declare variables
"RTN","SDRPA07",14,0)
 N X,X1,X2,%H
"RTN","SDRPA07",15,0)
 N BATCHC,MSGN,CURLINE
"RTN","SDRPA07",16,0)
 N LINEN,MSHLINE,XMITERR,HL7XMIT,ERROR,ORIGENT,ORIGMNT
"RTN","SDRPA07",17,0)
 N HLEID,HL,HLECH,HLFS,HLQ,HLMID,HLMTIEN,HLDT,HLDT1,MSGID,HLRESLT,HLP
"RTN","SDRPA07",18,0)
 ;Set message count limit for batch message
"RTN","SDRPA07",19,0)
 ;Initialize global locations
"RTN","SDRPA07",20,0)
 S XMITERR="^TMP(""SD-PAIT-BLD"","_$J_",""ERRORS"")"
"RTN","SDRPA07",21,0)
 S HL7XMIT="^TMP(""HLS"","_$J_")"
"RTN","SDRPA07",22,0)
 K @XMITERR,@HL7XMIT
"RTN","SDRPA07",23,0)
 ;Initiate
"RTN","SDRPA07",24,0)
 D INIT^HLFNC2("SD-PAIT-EVENT",.HL)
"RTN","SDRPA07",25,0)
 ;Unable to initiate HL7 variable - send error bulletin - done
"RTN","SDRPA07",26,0)
 ;I ($O(HL(""))="") D ERRBUL($P(HL,U,2)) Q  ; create ERRBUL later
"RTN","SDRPA07",27,0)
 ;Create batch message
"RTN","SDRPA07",28,0)
 D CREATE^HLTF(.HLMID,.HLMTIEN,.HLDT,.HLDT1)
"RTN","SDRPA07",29,0)
 ;HLMID - value of batch ID
"RTN","SDRPA07",30,0)
 ;HLMTIEN - IEN of Message Text file entry
"RTN","SDRPA07",31,0)
 ;HLDT - current date/time in FM internal format
"RTN","SDRPA07",32,0)
 ;HLDT1 - current date/time in HL7 format
"RTN","SDRPA07",33,0)
 N SDA,SDDT S SDA=HLMID,SDDT=HLDT ; to be used to file later
"RTN","SDRPA07",34,0)
 ;Unable to create batch message - send error bulletin - done
"RTN","SDRPA07",35,0)
 ;I ('HLMTIEN) D ERRBUL("Unable to create batch HL7 message") Q
"RTN","SDRPA07",36,0)
 ;Initialize message count
"RTN","SDRPA07",37,0)
 S BATCHC=0
"RTN","SDRPA07",38,0)
 ;Initialize message number
"RTN","SDRPA07",39,0)
 S MSGN=0
"RTN","SDRPA07",40,0)
 ;Initialize line count
"RTN","SDRPA07",41,0)
 S LINEN=1
"RTN","SDRPA07",42,0)
 S CURLINE=LINEN
"RTN","SDRPA07",43,0)
 ;Loop through list of appointments requiring transmission
"RTN","SDRPA07",44,0)
 N RUNID S RUNID=$O(^SDWL(409.6,"AD",ZTSK,""))
"RTN","SDRPA07",45,0)
 N DFN,SD25,SD6,SD8,SD7,SDPATCL S DFN="" F  S DFN=$O(^TMP("SDDPT",$J,DFN)) Q:DFN=""  D
"RTN","SDRPA07",46,0)
 .N SDP,ICN,SSN,SNM,FNM,MNM,DOB,SDSC,SDSCP,SDENRO,SDAPPT S SDP=^TMP("SDDPT",$J,DFN)
"RTN","SDRPA07",47,0)
 .S ICN=$P(SDP,U),SSN=$P(SDP,U,2),SNM=$P(SDP,U,3),FNM=$P(SDP,U,4)
"RTN","SDRPA07",48,0)
 .S MNM=$P(SDP,U,5),DOB=$P(SDP,U,6),SDSC=$P(SDP,U,7),SDSCP=$P(SDP,U,8),SDENRO=$P(SDP,U,9)
"RTN","SDRPA07",49,0)
 .N SDADT S SDADT="" F  S SDADT=$O(^TMP("SDDPT",$J,DFN,SDADT)) Q:SDADT=""  D
"RTN","SDRPA07",50,0)
 ..N SDPT,SDCDATE,SDADID,SDSDDT,SDSTAT,SDNAVA,SDCHKOUT,SDCDT,SDARF,SDARDT,SDNEW,SDCL,SDCLNUM,SDSTOP,SDCSTOP,SDFAC,SDDAM,SDCLNM,SDSTOPD,SDCSTOPD
"RTN","SDRPA07",51,0)
 ..N SDSTOPDD,SD8RD
"RTN","SDRPA07",52,0)
 ..S SDPT=^TMP("SDDPT",$J,DFN,SDADT),SDADID=$P(SDPT,U),SDDAM=$P(SDPT,U,2),SDSDDT=$P(SDPT,U,3),SDNAVA=$P(SDPT,U,5)
"RTN","SDRPA07",53,0)
 ..S SDCHKOUT=$P(SDPT,U,6),SDCDT=$P(SDPT,U,7),SDARDT=$P(SDPT,U,9),SDNEW=$P(SDPT,U,10),SDCL=$P(SDPT,U,12),SDCLNM=$P(SDPT,U,13)
"RTN","SDRPA07",54,0)
 ..S SDSTOP=$P(SDPT,U,14),SDCSTOP=$P(SDPT,U,15),SDFAC=$P(SDPT,U,16),SDPATCL=$P(SDPT,U,4)
"RTN","SDRPA07",55,0)
 ..S SDAPPT=^TMP("SDDPT",$J,DFN,SDADT,"SCH"),SD25=$P(SDAPPT,"^",2),SD6=$P(SDAPPT,"^",3),SD8=$P(SDAPPT,"^",4),SD8RD=$P(SDAPPT,"^",7)
"RTN","SDRPA07",56,0)
 ..S SDSTOPDD=^TMP("SDDPT",$J,DFN,SDADT,"STDC"),SDSTOPD=$P(SDSTOPDD,"^"),SDCSTOPD=$P(SDSTOPDD,"^",2)
"RTN","SDRPA07",57,0)
 ..;calculate consult date if applicable; 446
"RTN","SDRPA07",58,0)
 ..N SEQ S SEQ=0,SDCDATE="" F  S SEQ=$O(^SC(SDCL,"S",SDADT,1,SEQ)) Q:+SEQ'=SEQ  I $P(^SC(SDCL,"S",SDADT,1,SEQ,0),"^")=DFN D  Q
"RTN","SDRPA07",59,0)
 ...S SDCSLT=$$GET1^DIQ(44.003,SEQ_","_SDADT_","_SDCL_",",688,"I")  ; consult
"RTN","SDRPA07",60,0)
 ...Q:SDCSLT=""
"RTN","SDRPA07",61,0)
 ...I $D(^GMR(123,SDCSLT)) S SDCDATE=$$DTCONV^SDRPA08($$GET1^DIQ(123,SDCSLT_",",3,"I")) ;date converted to HL7
"RTN","SDRPA07",62,0)
 ..;Calculate message control ID
"RTN","SDRPA07",63,0)
 ..S MSGN=MSGN+1
"RTN","SDRPA07",64,0)
 ..S MSGID=HLMID_"-"_MSGN
"RTN","SDRPA07",65,0)
 ..;Build MSG segment
"RTN","SDRPA07",66,0)
 ..I (MSGID'="") D
"RTN","SDRPA07",67,0)
 ...;remember orig message and event type
"RTN","SDRPA07",68,0)
 ...S ORIGMNT="SIU"
"RTN","SDRPA07",69,0)
 ...S ORIGENT="S12"
"RTN","SDRPA07",70,0)
 ...S HL("MNT")="SIU",HL("ETN")=$P(SDAPPT,"^")
"RTN","SDRPA07",71,0)
 ...;build MSH segment
"RTN","SDRPA07",72,0)
 ...K RESULT D MSH^HLFNC2(.HL,MSGID,.RESULT)
"RTN","SDRPA07",73,0)
 ...;reset message & event type to its orig values
"RTN","SDRPA07",74,0)
 ...S HL("MNT")=ORIGMNT
"RTN","SDRPA07",75,0)
 ...S HL("ETN")=ORIGENT
"RTN","SDRPA07",76,0)
 ...;copy MSH segment into HL7 message
"RTN","SDRPA07",77,0)
 ...S @HL7XMIT@(CURLINE)=RESULT
"RTN","SDRPA07",78,0)
 ...N SDFACL S SDFACL=$P($$SITE^VASITE(),"^",3)
"RTN","SDRPA07",79,0)
 ...S $P(@HL7XMIT@(CURLINE),U,4)=SDFACL ;sending facility station #
"RTN","SDRPA07",80,0)
 ...S $P(@HL7XMIT@(CURLINE),U,5)="SD-AAC-PAIT" ;Receiving Application
"RTN","SDRPA07",81,0)
 ...S $P(@HL7XMIT@(CURLINE),U,6)=200 ; Receiving Facility
"RTN","SDRPA07",82,0)
 ...I ($D(RESULT(1))) D
"RTN","SDRPA07",83,0)
 ....S @HL7XMIT@(CURLINE,1)=RESULT(1)
"RTN","SDRPA07",84,0)
 ....S CURLINE=CURLINE+1
"RTN","SDRPA07",85,0)
 ...E  S CURLINE=CURLINE+1
"RTN","SDRPA07",86,0)
 ..;get list of segments
"RTN","SDRPA07",87,0)
 ..N SDSCH S SDSCH="SCH"_HLFS_1_"^^^^^"
"RTN","SDRPA07",88,0)
 ..S SD7=SDNAVA
"RTN","SDRPA07",89,0)
 ..;S ^TMP("HLS",$J,CURLINE)
"RTN","SDRPA07",90,0)
 ..S @HL7XMIT@(CURLINE)=SDSCH_SD6_"^"_SD7_"^"_SD8_"^^^"
"RTN","SDRPA07",91,0)
 ..N SDDAT S SDDAT="~~~"_SDDAM_"~~~"_"Date Appt Created|~~~"_SDSDDT_"~~~"_"Desired Date|~~~"_SDADID_"~~~"_"Appt Date"
"RTN","SDRPA07",92,0)
 ..S SDDAT=SDDAT_"|~~~"_SDCHKOUT_"~~~"_"Checkout Date"
"RTN","SDRPA07",93,0)
 ..S SDDAT=SDDAT_"|~~~"_SDCDT_"~~~"_"Cancellation Date"
"RTN","SDRPA07",94,0)
 ..S SDDAT=SDDAT_"|~~~"_SDARDT_"~~~"_"Auto-rebook Date"
"RTN","SDRPA07",95,0)
 ..S SDDAT=SDDAT_"|~~~"_SD8RD_"~~~"_"Resched Date"
"RTN","SDRPA07",96,0)
 ..S SDDAT=SDDAT_"|~~~"_SDCDATE_"~~~"_"Consult Date"
"RTN","SDRPA07",97,0)
 ..;S $P(SDSCH,U,12)=SDDAT,$P(SDSCH,U,26)=SDSTAT
"RTN","SDRPA07",98,0)
 ..S @HL7XMIT@(CURLINE,1)=SDDAT_"^^^^^^^^^^^^^^"_SD25
"RTN","SDRPA07",99,0)
 ..S CURLINE=CURLINE+1
"RTN","SDRPA07",100,0)
 ..S @HL7XMIT@(CURLINE)=$$EN^VAFHLPID(DFN,"1,3,5,7,11,19",1,1)
"RTN","SDRPA07",101,0)
 ..N SDCDFN S SDCDFN=$P(@HL7XMIT@(CURLINE),"^",4),SDCDFN=SDCDFN_"|"_DFN_"~~~USVHA&&L~PI" I $P(SDCDFN,"~")["V" S $P(SDCDFN,"~",2)=""
"RTN","SDRPA07",102,0)
 ..S $P(@HL7XMIT@(CURLINE),"^",4)=SDCDFN
"RTN","SDRPA07",103,0)
 ..N SDZIP S SDZIP=$P(@HL7XMIT@(CURLINE),U,12),SDZIP=$P(SDZIP,"~",5) S $P(@HL7XMIT@(CURLINE),U,12)="~~~~"_SDZIP
"RTN","SDRPA07",104,0)
 ..S CURLINE=CURLINE+1
"RTN","SDRPA07",105,0)
 ..;get Admission Type
"RTN","SDRPA07",106,0)
 ..N SDCR1,SDAT,SDCR S SDCR1=$E(SDDAM,5,8)_$E(SDDAM,1,4) D DT^DILF(,SDCR1,.SDCR) S SDAT=$$POV^SDRPA20(DFN,SDADT,SDCL,SDCR)
"RTN","SDRPA07",107,0)
 ..S @HL7XMIT@(CURLINE)="PV1^1^"_SDPATCL_"^^"_SDAT_"^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"_SDFAC
"RTN","SDRPA07",108,0)
 ..S CURLINE=CURLINE+1
"RTN","SDRPA07",109,0)
 ..S SDNEW=$S(SDNEW=1:"NSF",SDNEW=2:"OPN",SDNEW=3:"SHB")
"RTN","SDRPA07",110,0)
 ..S @HL7XMIT@(CURLINE)="PV2^^^^^^^^^^^^^^^^^^^^^^^^"_SDNEW
"RTN","SDRPA07",111,0)
 ..S CURLINE=CURLINE+1
"RTN","SDRPA07",112,0)
 ..I $D(^TMP("SDDPT",$J,DFN,SDADT,"ROL")) D
"RTN","SDRPA07",113,0)
 ...N SDCNT,SDAIP S SDAIP="AIP^" S SDCNT="" F  S SDCNT=$O(^TMP("SDDPT",$J,DFN,SDADT,"ROL",SDCNT)) Q:SDCNT=""  D
"RTN","SDRPA07",114,0)
 ....N SDPOVID,SDPROVNM,SDROLS
"RTN","SDRPA07",115,0)
 ....S SDROLS=^TMP("SDDPT",$J,DFN,SDADT,"ROL",SDCNT)
"RTN","SDRPA07",116,0)
 ....S SDPOVID=$P(SDROLS,U,3),SDPROVNM=$P(SDROLS,U,4),SDPROVNM=$TR(SDPROVNM,",","~")
"RTN","SDRPA07",117,0)
 ....S SDPROVNM=$TR(SDPROVNM," ","~")
"RTN","SDRPA07",118,0)
 ....I $L(SDPROVNM,"~")=2 S SDPROVNM=SDPROVNM_"~~"
"RTN","SDRPA07",119,0)
 ....E  I $L(SDPROVNM,"~")=3 S SDPROVNM=SDPROVNM_"~"
"RTN","SDRPA07",120,0)
 ....S @HL7XMIT@(CURLINE)=SDAIP_SDCNT_"^^"_SDPOVID_"~"_SDPROVNM_"^"_"Provider"
"RTN","SDRPA07",121,0)
 ....S CURLINE=CURLINE+1
"RTN","SDRPA07",122,0)
 ..S @HL7XMIT@(CURLINE)="AIL^1^^"_SDCL_"~~~~~~~~"_SDCLNM_"^"_SDSTOP_"~"_SDSTOPD_"~DSS Clinic ID^"_SDCSTOP_"~"_SDCSTOPD_"~DSS Credit Stop"
"RTN","SDRPA07",123,0)
 ..S CURLINE=CURLINE+1
"RTN","SDRPA07",124,0)
 ..N SDCNT S SDCNT="" F  S SDCNT=$O(^TMP("SDDPT",$J,DFN,SDADT,"ZCL",SDCNT)) Q:SDCNT=""  D
"RTN","SDRPA07",125,0)
 ...S @HL7XMIT@(CURLINE)=^TMP("SDDPT",$J,DFN,SDADT,"ZCL",SDCNT,0)
"RTN","SDRPA07",126,0)
 ...S CURLINE=CURLINE+1
"RTN","SDRPA07",127,0)
 ..;create ZEN only if enrollment was retrieved
"RTN","SDRPA07",128,0)
 ..I SDENRO>0 S @HL7XMIT@(CURLINE)="ZEN^1^^^^^^^^"_SDENRO,CURLINE=CURLINE+1
"RTN","SDRPA07",129,0)
 ..S @HL7XMIT@(CURLINE)="ZSP^1^"_SDSC_"^"_SDSCP
"RTN","SDRPA07",130,0)
 ..S CURLINE=CURLINE+1
"RTN","SDRPA07",131,0)
 ..;ZEL
"RTN","SDRPA07",132,0)
 ..N SDZEL D EN1^VAFHLZEL(DFN,"1,37,38",1,.SDZEL) D
"RTN","SDRPA07",133,0)
 ...;need to modify 37 WITH THE CREATION DATE
"RTN","SDRPA07",134,0)
 ...N SDDAMV S SDDAMV=$$HL7TFM^XLFDT(SDDAM)
"RTN","SDRPA07",135,0)
 ...N SDVC S SDVC=$$CVEDT^DGCV(DFN,SDDAMV),SDVC=$P(SDVC,"^",3) D
"RTN","SDRPA07",136,0)
 ....S $P(SDZEL(1),"^",38)=$S(SDVC=1:1,SDVC=0:0,1:"U")
"RTN","SDRPA07",137,0)
 ....I $P(SDZEL(1),"^",39)'?8N S $P(SDZEL(1),"^",39)=""
"RTN","SDRPA07",138,0)
 ...S @HL7XMIT@(CURLINE)=SDZEL(1)
"RTN","SDRPA07",139,0)
 ..S CURLINE=CURLINE+1
"RTN","SDRPA07",140,0)
 ..;ZMH
"RTN","SDRPA07",141,0)
 ..N SAR D ENTER^VAFHLZMH(DFN,"SAR","1,5,10","3,4",HL("FS"),HL("ECH"),"")
"RTN","SDRPA07",142,0)
 ..S $P(SAR(1,0),"^",4)="" ;
"RTN","SDRPA07",143,0)
 ..;service separation date
"RTN","SDRPA07",144,0)
 ..;combat indication and location;gulf war indication
"RTN","SDRPA07",145,0)
 ..S $P(SAR(1,0),"^",5)="~"_$P($P(SAR(1,0),"^",5),"~",2)
"RTN","SDRPA07",146,0)
 ..N SS F SS=2,3 D
"RTN","SDRPA07",147,0)
 ...S $P(SAR(SS,0),"^",5)=""
"RTN","SDRPA07",148,0)
 ..I $E($P(SAR(2,0),"^",4))'="Y" S $P(SAR(2,0),"^",4)="N~"
"RTN","SDRPA07",149,0)
 ..I $E($P(SAR(3,0),"^",4))'="Y" S $P(SAR(3,0),"^",4)="N"
"RTN","SDRPA07",150,0)
 ..N SDD F SDD=1,2,3 S @HL7XMIT@(CURLINE)=SAR(SDD,0) S CURLINE=CURLINE+1
"RTN","SDRPA07",151,0)
 ..;file MSGID into 409.69 separately as batch # and ID #
"RTN","SDRPA07",152,0)
 ..N DIE,DA D
"RTN","SDRPA07",153,0)
 ...S DIE="^SDWL(409.6,"_RUNID_",1,",DA(1)=RUNID
"RTN","SDRPA07",154,0)
 ...S DA=$O(^SDWL(409.6,"AC",DFN,SDADT,RUNID,"")) D
"RTN","SDRPA07",155,0)
 ....I $P(^SDWL(409.6,RUNID,1,DA,0),"^",3)'="" S DA=$O(^SDWL(409.6,"AC",DFN,SDADT,RUNID,DA))
"RTN","SDRPA07",156,0)
 ...S DR="2///"_+MSGID_";3///"_$P(MSGID,"-",2) D ^DIE
"RTN","SDRPA07",157,0)
 D GENERATE^HLMA("SD-PAIT-EVENT","GB",1,.HLRESLT,HLMTIEN,.HLP) K @HL7XMIT
"RTN","SDRPA07",158,0)
 N DA,DIE,DR S DA=RUNID,DIE=409.6,DR="1.1///"_+$G(MSGID) D ^DIE
"RTN","SDRPA07",159,0)
 S SDMCID=+$G(SDMCID)
"RTN","SDRPA07",160,0)
 ;file message control ID # and batch control ID number
"RTN","SDRPA07",161,0)
 N DIC,DA,X,Y D
"RTN","SDRPA07",162,0)
 .S DIC="^SDWL(409.6,"_RUNID_",2,",DA(1)=RUNID,DIC("P")=409.7,DIC(0)="X"
"RTN","SDRPA07",163,0)
 .S SDBCID=+$G(HLRESLT)
"RTN","SDRPA07",164,0)
 .K DO S X=+$G(SDBCID) D FILE^DICN
"RTN","SDRPA07",165,0)
 .S DA=+Y,DIE=DIC,DR=".02///"_+$G(SDDT)_";.03///"_+$G(SDA) D ^DIE
"RTN","SDRPA07",166,0)
 Q
"RTN","SDRPA20")
0^30^B2396276^n/a
"RTN","SDRPA20",1,0)
SDRPA20 ;BPOI/ESW - Determine Admission Type for PAIT ;
"RTN","SDRPA20",2,0)
 ;;5.3;Scheduling;**446**;Aug 13, 1993;Build 77
"RTN","SDRPA20",3,0)
 ;
"RTN","SDRPA20",4,0)
 ; This routine returns element Admission Type for appointment sent
"RTN","SDRPA20",5,0)
 ; with PAIT - see TABLE SD009 - Purpose of Visit & Appointment Type
"RTN","SDRPA20",6,0)
 ; SEQUENCE PV1.4. The same table is used with ACRP HL7 transmission.
"RTN","SDRPA20",7,0)
 ; 
"RTN","SDRPA20",8,0)
 ;
"RTN","SDRPA20",9,0)
POV(DFN,SDATE,CLINIC,CRDATE) ; - Determine Purpose of Visit for encounter
"RTN","SDRPA20",10,0)
 ;
"RTN","SDRPA20",11,0)
 ;   Input:  DFN = Patient IEN
"RTN","SDRPA20",12,0)
 ;          SDATE = Appointment Date/Time
"RTN","SDRPA20",13,0)
 ;        CLINIC = Clinic
"RTN","SDRPA20",14,0)
 ;        CRDATE = Creation date
"RTN","SDRPA20",15,0)
 ;        
"RTN","SDRPA20",16,0)
 ;  Identified from the Outpatient Encounter of the Appointment
"RTN","SDRPA20",17,0)
 ;  subfile (# 2.98)
"RTN","SDRPA20",18,0)
 ;  
"RTN","SDRPA20",19,0)
 ;         APTYP = Appointment Type
"RTN","SDRPA20",20,0)
 ;
"RTN","SDRPA20",21,0)
 ;  Output:  Purpose of Visit value (combination of Purpose of Visit
"RTN","SDRPA20",22,0)
 ;           and Appointment Type)
"RTN","SDRPA20",23,0)
 ;
"RTN","SDRPA20",24,0)
 ;
"RTN","SDRPA20",25,0)
 N SDARRAY,SCDXPOV,SDAPPT,POV,APTYP,SDENC
"RTN","SDRPA20",26,0)
 S SDARRAY(1)=SDATE_";"_SDATE
"RTN","SDRPA20",27,0)
 S SDARRAY(4)=DFN
"RTN","SDRPA20",28,0)
 S SDARRAY("FLDS")="2;10;12;16;18"
"RTN","SDRPA20",29,0)
 ; fields: 2- clinic
"RTN","SDRPA20",30,0)
 ;        10- appointment type
"RTN","SDRPA20",31,0)
 ;        12- outpatient encounter
"RTN","SDRPA20",32,0)
 ;        16 - date appt made        
"RTN","SDRPA20",33,0)
 N SDCOUNT S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SDRPA20",34,0)
 I '$D(^TMP($J,"SDAMA301",DFN,CLINIC,SDATE)) Q $G(SCDXPOV)
"RTN","SDRPA20",35,0)
 S SDAPPT=^TMP($J,"SDAMA301",DFN,CLINIC,SDATE)
"RTN","SDRPA20",36,0)
 N SDCRC S SDCRC=+$P(SDAPPT,U,16) I SDCRC'=CRDATE Q $G(SCDXPOV)
"RTN","SDRPA20",37,0)
 N POV,SCDXPOV
"RTN","SDRPA20",38,0)
 S POV=+$P(SDAPPT,U,18),POV=$S($L(POV)=1:"0"_POV,1:POV)
"RTN","SDRPA20",39,0)
 S APTYP=+$P(SDAPPT,U,10) S SDENC=+$P(SDAPPT,U,12) I +SDENC>0 D  I 'APTYP Q $G(SCDXPOV)
"RTN","SDRPA20",40,0)
 .S APTYP=$P($G(^SCE(SDENC,0)),U,10)
"RTN","SDRPA20",41,0)
 S APTYP=$S($L(APTYP)=1:"0"_APTYP,1:APTYP)
"RTN","SDRPA20",42,0)
 S SCDXPOV=POV_APTYP
"RTN","SDRPA20",43,0)
POVQ Q $G(SCDXPOV)
"RTN","SDRPA20",44,0)
 ;
"RTN","SDWL120")
0^21^B7543417^n/a
"RTN","SDWL120",1,0)
SDWL120 ;IOFO BAY PINES/esw- EWL- 120 delay appt message;05/28/2006  ; Compiled April 9, 2007 14:19:00
"RTN","SDWL120",2,0)
 ;;5.3;scheduling;**446**;AUG 13, 1993;Build 77
"RTN","SDWL120",3,0)
 ;
"RTN","SDWL120",4,0)
MESS(DFN,SDWLDA,SDPR) ;
"RTN","SDWL120",5,0)
 ; SDWLDA - EWL IEN to 409.3
"RTN","SDWL120",6,0)
 ; SDPR - flag indicating creation of 409.32 clinic entry
"RTN","SDWL120",7,0)
 ;        0 - no entry
"RTN","SDWL120",8,0)
 ;        1 - entry created
"RTN","SDWL120",9,0)
 S ^TMP("SDWL120",$J,.01)="An open Wait List entry was created with a 120 days flag, indicating that it"
"RTN","SDWL120",10,0)
 S ^TMP("SDWL120",$J,.02)="was not possible to schedule an appointment for the listed clinic within"
"RTN","SDWL120",11,0)
 S ^TMP("SDWL120",$J,.03)="120 days of the desired date."
"RTN","SDWL120",12,0)
 S ^TMP("SDWL120",$J,.04)=""
"RTN","SDWL120",13,0)
 N SDAPPT,Y
"RTN","SDWL120",14,0)
 S ^TMP("SDWL120",$J,.05)="An EWL Entry was created for the following patient,"
"RTN","SDWL120",15,0)
 S ^TMP("SDWL120",$J,.06)=""
"RTN","SDWL120",16,0)
 S ^TMP("SDWL120",$J,.07)=$$FORM^SDFORM("PATIENT NAME",23,"SSN",12,"EWL",35)
"RTN","SDWL120",17,0)
 S ^TMP("SDWL120",$J,.08)="--------------------------------------------------------------------------"
"RTN","SDWL120",18,0)
 S ^TMP("SDWL120",$J,.09)=$$FORM^SDFORM($E($$GET1^DIQ(2,DFN_",",.01,"I"),1,25),23,$$GET1^DIQ(2,DFN_",",.09,"I"),12,$$GET1^DIQ(409.3,SDWLDA_",",8),35)
"RTN","SDWL120",19,0)
 S ^TMP("SDWL120",$J,.1)=""
"RTN","SDWL120",20,0)
 I SDPR S ^TMP("SDWL120",$J,.11)="SD WL CLINIC LOCATION parameter entry created."
"RTN","SDWL120",21,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWL120",22,0)
 S XMSUB="EWL opened entry with a 120 days flag"
"RTN","SDWL120",23,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWL120",24,0)
 S XMTEXT="^TMP(""SDWL120"",$J,"
"RTN","SDWL120",25,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWL120",26,0)
 D ^XMD K ^TMP("SDWL120",$J)
"RTN","SDWL120",27,0)
 Q
"RTN","SDWL120",28,0)
 ;
"RTN","SDWL120",29,0)
MESS2(SC) ;
"RTN","SDWL120",30,0)
 ; SC - pointer to file 44
"RTN","SDWL120",31,0)
 S ^TMP("SDWL120",$J,.01)="An attempt has been made to create an EWL Entry after the lack of"
"RTN","SDWL120",32,0)
 S ^TMP("SDWL120",$J,.02)="any availability on the clinic,"
"RTN","SDWL120",33,0)
 S ^TMP("SDWL120",$J,.03)=$$GET1^DIQ(44,SC,.01)
"RTN","SDWL120",34,0)
 S ^TMP("SDWL120",$J,.04)="within 120 days of a patient's desired date."
"RTN","SDWL120",35,0)
 S ^TMP("SDWL120",$J,.05)=""
"RTN","SDWL120",36,0)
 S ^TMP("SDWL120",$J,.06)="The clinic has no linked Institution or Division which are required"
"RTN","SDWL120",37,0)
 S ^TMP("SDWL120",$J,.07)="to create the association with a Wait List."
"RTN","SDWL120",38,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWL120",39,0)
 S XMSUB="EWL Location entry could not be created"
"RTN","SDWL120",40,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWL120",41,0)
 S XMTEXT="^TMP(""SDWL120"",$J,"
"RTN","SDWL120",42,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWL120",43,0)
 D ^XMD
"RTN","SDWL120",44,0)
 K ^TMP("SDWL120",$J)
"RTN","SDWL120",45,0)
 Q
"RTN","SDWLBACC")
0^37^B25884323^n/a
"RTN","SDWLBACC",1,0)
SDWLBACC ;;IOFO BAY PINES/OG - BATCH CHANGE EWL CLINIC  ; Compiled August 14, 2007 11:20:57
"RTN","SDWLBACC",2,0)
 ;;5.3;scheduling;**446**;AUG 13 1993;Build 77
"RTN","SDWLBACC",3,0)
 ;
"RTN","SDWLBACC",4,0)
 ;  ******************************************************************
"RTN","SDWLBACC",5,0)
 ;  CHANGE LOG
"RTN","SDWLBACC",6,0)
 ;       
"RTN","SDWLBACC",7,0)
 ;   DATE         PATCH    DESCRIPTION
"RTN","SDWLBACC",8,0)
 ;   ----         -----    -----------
"RTN","SDWLBACC",9,0)
 ;   
"RTN","SDWLBACC",10,0)
 ;
"RTN","SDWLBACC",11,0)
 N SDWLERR,SDWLOPT,SDWLSCL,SDWLHD,SDWLIN1,SDWLIN2,SDWLCL0,SDWLCL1,SDWLCL2,SDWLCSC1,SDWLCSC2,SDWLCM
"RTN","SDWLBACC",12,0)
 S SDWLHD="Scheduling/PCMM Batch Change EWL Clinic"
"RTN","SDWLBACC",13,0)
 W:$D(IOF) @IOF W !?80-$L(SDWLHD)\2,SDWLHD,!
"RTN","SDWLBACC",14,0)
 S SDWLERR=0,SDWLOPT=1,(SDWLIN2,SDWLCL1,SDWLCL2,SDWLCM)="",SDWLIN1=+$$SITE^VASITE()
"RTN","SDWLBACC",15,0)
 F  D @("P"_SDWLOPT) Q:'SDWLOPT
"RTN","SDWLBACC",16,0)
 Q
"RTN","SDWLBACC",17,0)
P1 ; Source Institution
"RTN","SDWLBACC",18,0)
 S DIR(0)="PAO^DIC(4,:EMNZ"
"RTN","SDWLBACC",19,0)
 S DIR("A")="Select Source Institution: "
"RTN","SDWLBACC",20,0)
 I SDWLIN1'="" S DIR("B")=$$GET1^DIQ(4,SDWLIN1,.01)
"RTN","SDWLBACC",21,0)
 S DIR("S")="I $E($$GET1^DIQ(4,+Y,99),1,3)=$E(+$P($$SITE^VASITE(),U,3),1,3)"
"RTN","SDWLBACC",22,0)
 D ^DIR
"RTN","SDWLBACC",23,0)
 I Y<1 S SDWLOPT=0 Q
"RTN","SDWLBACC",24,0)
 S (SDWLIN1,SDWLIN2)=+Y,SDWLOPT=SDWLOPT+1
"RTN","SDWLBACC",25,0)
 Q
"RTN","SDWLBACC",26,0)
P2 ; Source Clinic
"RTN","SDWLBACC",27,0)
 N DIR,SDWLSC
"RTN","SDWLBACC",28,0)
 S DIR(0)="PAO^SDWL(409.32,:EMNZ"
"RTN","SDWLBACC",29,0)
 S DIR("A")="Select Source Clinic: "
"RTN","SDWLBACC",30,0)
 I SDWLCL1'="" S DIR("B")=$$GET1^DIQ(409.32,SDWLCL1,.01)
"RTN","SDWLBACC",31,0)
 S DIR("S")="S X=$$GET1^DIQ(409.32,+Y,.01,""I"") I $P($$CLIN^SDWLBACC(X),U)=SDWLIN1"
"RTN","SDWLBACC",32,0)
 D ^DIR
"RTN","SDWLBACC",33,0)
 I Y="^" S SDWLOPT=0 Q
"RTN","SDWLBACC",34,0)
 I Y<1 S SDWLOPT=SDWLOPT-1 Q
"RTN","SDWLBACC",35,0)
 S SDWLCL0=+Y  ; Wait list specific clinic
"RTN","SDWLBACC",36,0)
 S SDWLCL1=$P(Y,U,2)  ; pointer to HOSPITAL LOCATION file
"RTN","SDWLBACC",37,0)
 S SDWLCSC1=$$GET1^DIQ(44,SDWLCL1,8,"I")_U_$$GET1^DIQ(44,SDWLCL1,8) ; Clinic stop code
"RTN","SDWLBACC",38,0)
 S SDWLOPT=SDWLOPT+1
"RTN","SDWLBACC",39,0)
 Q
"RTN","SDWLBACC",40,0)
P3 ; Destination Institution
"RTN","SDWLBACC",41,0)
 S DIR(0)="PAO^DIC(4,:EMNZ"
"RTN","SDWLBACC",42,0)
 S DIR("A")="Select Destination Institution: "
"RTN","SDWLBACC",43,0)
 I SDWLIN1'="" S DIR("B")=$$GET1^DIQ(4,SDWLIN2,.01)
"RTN","SDWLBACC",44,0)
 S DIR("S")="I $E($$GET1^DIQ(4,+Y,99),1,3)=$E(+$P($$SITE^VASITE(),U,3),1,3)"
"RTN","SDWLBACC",45,0)
 D ^DIR
"RTN","SDWLBACC",46,0)
 I Y="^" S SDWLOPT=0 Q
"RTN","SDWLBACC",47,0)
 I Y<1 S SDWLOPT=SDWLOPT-1 Q
"RTN","SDWLBACC",48,0)
 S SDWLIN2=+Y,SDWLOPT=SDWLOPT+1
"RTN","SDWLBACC",49,0)
 Q
"RTN","SDWLBACC",50,0)
P4 ; Destination Clinic
"RTN","SDWLBACC",51,0)
 N DIR,SDWLSC,SDWLY
"RTN","SDWLBACC",52,0)
 S DIR(0)="PAO^SDWL(409.32,:EMNZ"
"RTN","SDWLBACC",53,0)
 S DIR("A")="Select Destination Clinic: "
"RTN","SDWLBACC",54,0)
 I SDWLCL2'="" S DIR("B")=$$GET1^DIQ(409.32,SDWLCL2,.01)
"RTN","SDWLBACC",55,0)
 S DIR("S")="S X=$$GET1^DIQ(409.32,+Y,.01,""I"") I $P($$CLIN^SDWLBACC(X),U)=SDWLIN2,+Y'=SDWLCL0"
"RTN","SDWLBACC",56,0)
 D ^DIR
"RTN","SDWLBACC",57,0)
 I Y="^" S SDWLOPT=0 Q
"RTN","SDWLBACC",58,0)
 I Y<1 S SDWLOPT=SDWLOPT-1 Q
"RTN","SDWLBACC",59,0)
 S SDWLY=+Y,SDWLSC=$P(Y,U,2)  ; pointer to HOSPITAL LOCATION file
"RTN","SDWLBACC",60,0)
 ; get clinic's stop code. warn if different.
"RTN","SDWLBACC",61,0)
 S SDWLCSC2=$$GET1^DIQ(44,SDWLSC,8,"I")_U_$$GET1^DIQ(44,SDWLSC,8)  ; Clinic's stop code
"RTN","SDWLBACC",62,0)
 I +SDWLCSC1'=+SDWLCSC2 D  Q:'Y
"RTN","SDWLBACC",63,0)
 .S DIR(0)="Y"
"RTN","SDWLBACC",64,0)
 .S DIR("A")="The clinics' stop codes are different, continue"
"RTN","SDWLBACC",65,0)
 .S DIR("A",1)=$$GET1^DIQ(409.32,SDWLCL1,.01)_": "_$P(SDWLCSC1,U,2)_" ("_+SDWLCSC1_")"
"RTN","SDWLBACC",66,0)
 .S DIR("A",2)=$$GET1^DIQ(409.32,+Y,.01)_": "_$P(SDWLCSC2,U,2)_" ("_+SDWLCSC2_")"
"RTN","SDWLBACC",67,0)
 .S DIR("B")="YES"
"RTN","SDWLBACC",68,0)
 .D ^DIR
"RTN","SDWLBACC",69,0)
 .S:Y="^" SDWLOPT=0
"RTN","SDWLBACC",70,0)
 .Q
"RTN","SDWLBACC",71,0)
 S SDWLSCL=SDWLY,SDWLOPT=SDWLOPT+1
"RTN","SDWLBACC",72,0)
 Q
"RTN","SDWLBACC",73,0)
P5 ; Comment
"RTN","SDWLBACC",74,0)
 D P4^SDWLE6
"RTN","SDWLBACC",75,0)
 Q
"RTN","SDWLBACC",76,0)
P6 ; Confirmation and processing
"RTN","SDWLBACC",77,0)
 N DIR,Y
"RTN","SDWLBACC",78,0)
 S DIR(0)="Y"
"RTN","SDWLBACC",79,0)
 S DIR("A")="Proceed with batch clinic change"
"RTN","SDWLBACC",80,0)
 S DIR("B")="YES"
"RTN","SDWLBACC",81,0)
 D ^DIR
"RTN","SDWLBACC",82,0)
 D:Y CHNGCL
"RTN","SDWLBACC",83,0)
 S SDWLOPT=0
"RTN","SDWLBACC",84,0)
 Q
"RTN","SDWLBACC",85,0)
CHNGCL ;
"RTN","SDWLBACC",86,0)
 N DIR,SDWLDA,SDWLCNT
"RTN","SDWLBACC",87,0)
 S SDWLDA="",SDWLCNT=0
"RTN","SDWLBACC",88,0)
 F  S SDWLDA=$O(^SDWL(409.3,"SC",SDWLCL1,SDWLDA)) Q:'SDWLDA  D
"RTN","SDWLBACC",89,0)
 .N DA,DIE,DIR,DR,SDWLDFN,SDWLIN,SDWLTMP,SDWLORDT,SDWLSCPG,SDWLSCPR,SDWLCL1,SDWLDDT,SDWLEEST,Y
"RTN","SDWLBACC",90,0)
 .D GETS^DIQ(409.3,SDWLDA_",","1;14;15;22;23;27","I","SDWLTMP")
"RTN","SDWLBACC",91,0)
 .Q:SDWLTMP(409.3,SDWLDA_",",23,"I")="C"  ; Only open entries.
"RTN","SDWLBACC",92,0)
 .S SDWLDFN=$$GET1^DIQ(409.3,SDWLDA,.01,"I")
"RTN","SDWLBACC",93,0)
 .S SDWLORDT=SDWLTMP(409.3,SDWLDA_",",1,"I")
"RTN","SDWLBACC",94,0)
 .S SDWLSCPG=SDWLTMP(409.3,SDWLDA_",",14,"I")
"RTN","SDWLBACC",95,0)
 .S SDWLSCPR=SDWLTMP(409.3,SDWLDA_",",15,"I")
"RTN","SDWLBACC",96,0)
 .S SDWLDDT=SDWLTMP(409.3,SDWLDA_",",22,"I")
"RTN","SDWLBACC",97,0)
 .S SDWLEEST=SDWLTMP(409.3,SDWLDA_",",27,"I")
"RTN","SDWLBACC",98,0)
 .Q:'$$UPDATE^SDWLE7(SDWLDFN,SDWLORDT,SDWLIN2,SDWLSCL,SDWLSCPG,SDWLSCPR,SDWLDDT,SDWLCM,SDWLEEST,SDWLDA)
"RTN","SDWLBACC",99,0)
 .; disposition old entry
"RTN","SDWLBACC",100,0)
 .S DIE="^SDWL(409.3,",DA=SDWLDA,DR="19////^S X=DT;20////^S X=DUZ;21////^S X=""CL"";23////^S X=""C"""
"RTN","SDWLBACC",101,0)
 .D ^DIE
"RTN","SDWLBACC",102,0)
 .S SDWLCNT=SDWLCNT+1
"RTN","SDWLBACC",103,0)
 .Q
"RTN","SDWLBACC",104,0)
 W ! W:SDWLCNT "Clinics changed. " W SDWLCNT," entries processed."
"RTN","SDWLBACC",105,0)
 S DIR(0)="E" D ^DIR
"RTN","SDWLBACC",106,0)
 Q
"RTN","SDWLBACC",107,0)
CLIN(CL) ;identify clinic institution through DIVISON ----> INSTITUTION path.
"RTN","SDWLBACC",108,0)
 ; function to return: 
"RTN","SDWLBACC",109,0)
 ;        - Institution pointer to ^DIC(4 _U_ STATION number (# 99) _U_ Inst Name _U_ Div Pointer to ^DG(40.8 _U_N/L_U_Message
"RTN","SDWLBACC",110,0)
 ;           ( INST^STA NUM^SNAM^DIV^N/L^MESS )
"RTN","SDWLBACC",111,0)
 ;           N/L - N -National/L -Local
"RTN","SDWLBACC",112,0)
 ;           with Message:
"RTN","SDWLBACC",113,0)
 ;           - if STA="" INST^^SNAM^DIV^^N/L^' - No Station Number on file'
"RTN","SDWLBACC",114,0)
 ;          or
"RTN","SDWLBACC",115,0)
 ;        -  0^^^DIV^^' - No Institution has been identified'
"RTN","SDWLBACC",116,0)
 ;        -  0^^^-1^^'  - no Division has been identified'
"RTN","SDWLBACC",117,0)
 ;        - -1 no clinic on file'
"RTN","SDWLBACC",118,0)
 I '$D(^SC(+CL)) Q -1_"^^^^^no clinic on file"
"RTN","SDWLBACC",119,0)
 N SDWMES,STN,DIV,INS,SNL,STR,SNAM S SDWMES="",STN=""
"RTN","SDWLBACC",120,0)
 S DIV=+$$GET1^DIQ(44,CL_",",3.5,"I")
"RTN","SDWLBACC",121,0)
 I DIV=0 S SDWMES="no Division has been identified" Q 0_"^^^"_-1_"^^"_SDWMES
"RTN","SDWLBACC",122,0)
 S INS=+$$GET1^DIQ(40.8,DIV_",",.07,"I")
"RTN","SDWLBACC",123,0)
 I INS=0 S SDWMES="No Institution has been identified" Q 0_"^^^"_DIV_"^"_SDWMES
"RTN","SDWLBACC",124,0)
 E  S STR=$$NS^XUAF4(INS),STN=$P(STR,U,2),SNAM=$P(STR,U) ;station number and name
"RTN","SDWLBACC",125,0)
 I STN="" S SDWMES="No Station Number on file"
"RTN","SDWLBACC",126,0)
 I '$$TF^XUAF4(INS) S SDWMES="Inactive treating medical facility"
"RTN","SDWLBACC",127,0)
 S SNL=$$GET1^DIQ(4,INS_",",11,"I")
"RTN","SDWLBACC",128,0)
 Q INS_U_STN_U_SNAM_U_DIV_U_SNL_U_SDWMES
"RTN","SDWLD")
0^1^B24813208^B17574395
"RTN","SDWLD",1,0)
SDWLD ;;IOFO BAY PINES/TEH - DISPLAY PENDING APPOINTMENTS;06/12/2002 ; 20 Aug 2002  2:10 PM  ; Compiled September 25, 2006 13:39:47
"RTN","SDWLD",2,0)
 ;;5.3;scheduling;**263,454,417,446**;AUG 13 1993;Build 77
"RTN","SDWLD",3,0)
 ;
"RTN","SDWLD",4,0)
 ;
"RTN","SDWLD",5,0)
 ;*********************************************************
"RTN","SDWLD",6,0)
 ;                                               CHANGE LOG
"RTN","SDWLD",7,0)
 ;                                               
"RTN","SDWLD",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLD",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLD",10,0)
 ;   
"RTN","SDWLD",11,0)
 ;   
"RTN","SDWLD",12,0)
 ;   ;ENTRY POINT FOR OPTION CALL
"RTN","SDWLD",13,0)
 ;
"RTN","SDWLD",14,0)
 ;       SDWLDFN = PATIENT IEN
"RTN","SDWLD",15,0)
 ;       SDWLSSN = PATIENT SSN
"RTN","SDWLD",16,0)
 ;       SDWLNAM = PATIENT NAME
"RTN","SDWLD",17,0)
 ;       
"RTN","SDWLD",18,0)
 ;    ;Patch SD*5.3*417 Display Team when displaying Position.   
"RTN","SDWLD",19,0)
 ;       
"RTN","SDWLD",20,0)
EN(SDWLDFN,SDWLSSN,SDWLNAM,SDTP) ;ENTRY POINT - INTIALIZE VARIABLES
"RTN","SDWLD",21,0)
 ;SDTP (optional) - EWL ENTRY STATUS
"RTN","SDWLD",22,0)
 I $G(SDTP)="" S SDTP="O"
"RTN","SDWLD",23,0)
 I SDTP'="O"&(SDTP'="C") Q  ;
"RTN","SDWLD",24,0)
 K ^TMP("SDWLD",$J) I $D(^SDWL(409.3,"B",SDWLDFN)) D
"RTN","SDWLD",25,0)
 .D GETDATA(SDTP)
"RTN","SDWLD",26,0)
 .Q:'SDWLCNT
"RTN","SDWLD",27,0)
 .D HD1
"RTN","SDWLD",28,0)
 .D DIS
"RTN","SDWLD",29,0)
 .D HD2
"RTN","SDWLD",30,0)
 .D DISPD
"RTN","SDWLD",31,0)
 Q
"RTN","SDWLD",32,0)
GETDATA(SDTP) ;GET PATIENT DATA FROM SD WAIT LIST FILE (^SDWL(409.3) 
"RTN","SDWLD",33,0)
 ;SDTP - EWL entry status
"RTN","SDWLD",34,0)
 ;       O - open
"RTN","SDWLD",35,0)
 ;       C - closed
"RTN","SDWLD",36,0)
 N SDWLWTE S SDWLCNT=0,SDWLWTE=0 D
"RTN","SDWLD",37,0)
 .I SDTP="C" N SDDENT,SDBEG,SDEND D SEL1(.SDDENT) D  I +SDDENT=0 Q  ;return 'begin^end' entry day 
"RTN","SDWLD",38,0)
 ..I +SDDENT=0 W !,"Entry Date range required for closed EWL selection" Q
"RTN","SDWLD",39,0)
 ..S SDBEG=$P(SDDENT,U),SDEND=$P(SDDENT,U,2)
"RTN","SDWLD",40,0)
 .S SDWLDA=0 F  S SDWLDA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA)) Q:SDWLDA=""  D
"RTN","SDWLD",41,0)
 ..S SDWLDATA=$G(^SDWL(409.3,SDWLDA,0))
"RTN","SDWLD",42,0)
 ..;
"RTN","SDWLD",43,0)
 ..I $P(SDWLDATA,U,17)'[SDTP Q
"RTN","SDWLD",44,0)
 ..I $D(^SDWL(409.3,"ST",SDWLDA)) S SDWLWTE=1
"RTN","SDWLD",45,0)
 ..I $D(^SDWL(409.3,"SP",SDWLDA)) S SDWLPOS=1
"RTN","SDWLD",46,0)
 ..S SDWLDT=$P(SDWLDATA,U,2) I SDTP="C" I SDWLDT<SDBEG!(SDWLDT>SDEND) Q
"RTN","SDWLD",47,0)
 ..S SDWLCL=$P(SDWLDATA,U,4) I SDWLDT="" Q
"RTN","SDWLD",48,0)
 ..S SDWLCLN="" I $D(^SC(+SDWLCL,0)) S SDWLCLN=$E($P($G(^SC(SDWLCL,0)),U,2),1,6) I SDWLCLN="" Q
"RTN","SDWLD",49,0)
 ..S SDWLCNT=SDWLCNT+1,^TMP("SDWLD",$J,SDWLDFN,SDWLCNT)=SDWLDATA_"~"_SDWLDA,^TMP("SDWLD",$J,"B",SDWLCNT,SDWLDFN,SDWLDT,SDWLDA)=""
"RTN","SDWLD",50,0)
 ..K SDWLDATA
"RTN","SDWLD",51,0)
 Q
"RTN","SDWLD",52,0)
SEL1(SDDENT) K DIR,%DT(0) S SDWLDISC="",%DT="AE",%DT("A")="Start with Date Entered: " D ^%DT N SDWLBDT S SDWLBDT=Y I Y<1 S SDDENT="^" Q
"RTN","SDWLD",53,0)
 S %DT(0)=SDWLBDT,%DT("A")="End with Date Entered: " D ^%DT D SEL1(.SDDENT):Y<1 S SDWLEDT=Y K %DT(0),%DT("A")
"RTN","SDWLD",54,0)
 S SDDENT=SDWLBDT_U_SDWLEDT
"RTN","SDWLD",55,0)
DIS ;DISPLAY PATIENT DATA
"RTN","SDWLD",56,0)
 W !,?5,SDWLNAM,?35,SDWLSSN,!
"RTN","SDWLD",57,0)
 I $G(SDTP)'="C" W !,"Patient Currently is on Waiting List for the Following",!
"RTN","SDWLD",58,0)
 E  W !,"Patient is on closed Waiting List for the Following",!
"RTN","SDWLD",59,0)
 Q
"RTN","SDWLD",60,0)
DISPD ;DISPLAY WAIT LIST DATA  
"RTN","SDWLD",61,0)
 S (SDWLDT,SDWLCNT,SDWLCN)=""
"RTN","SDWLD",62,0)
 F  S SDWLCNT=$O(^TMP("SDWLD",$J,SDWLDFN,SDWLCNT)) Q:SDWLCNT=""  D
"RTN","SDWLD",63,0)
 .S X=$G(^TMP("SDWLD",$J,SDWLDFN,SDWLCNT)),SDWLDA=$P(X,"~",2),SDWLIN=$P(X,U,3),SDWLCL=$P(X,U,4),SDWLTY=$P(X,U,5),SDWLPRI=$P(X,U,11)
"RTN","SDWLD",64,0)
 .N SDWLDSP,SDWLSCO,SDWLSPO,SDWLSSO,SDWLSTO S SDWLDSP=$P(X,U,17)
"RTN","SDWLD",65,0)
 .S SDWLDT=$P(X,U,2),SDWLTYN=$$EXTERNAL^DILFD(409.3,4,,SDWLTY),SDWLPRIN=$$EXTERNAL^DILFD(409.3,10,,SDWLPRI)
"RTN","SDWLD",66,0)
 .S SDWLSTO=$P(X,U,22),SDWLSPO=$P(X,U,23),SDWLSSO=$P(X,U,24),SDWLSCO=$P(X,U,25)
"RTN","SDWLD",67,0)
 .S SDWLST=$P(X,U,6),SDWLSP=$P(X,U,7),SDWLSS=$P(X,U,8),SDWLSC=$P(X,U,9),SDWLWR="" D
"RTN","SDWLD",68,0)
 ..I SDWLST'="" S SDWLWR=$$EXTERNAL^DILFD(409.3,5,,SDWLST)
"RTN","SDWLD",69,0)
 ..I SDWLSTO["Y" S SDWLWR="OPEN"
"RTN","SDWLD",70,0)
 ..;SD*5.3*417
"RTN","SDWLD",71,0)
 ..I SDWLSP'="" S SDWLWR=$$EXTERNAL^DILFD(409.3,6,,SDWLSP) D
"RTN","SDWLD",72,0)
 ...I $D(^SCTM(404.57,SDWLSP)) S SDWLX=$P($G(^SCTM(404.57,SDWLSP,0)),U,2),SDWLX=$E($P($G(^SCTM(404.51,SDWLX,0)),U,1),1,10),SDWLWR=SDWLWR_" ("_SDWLX_")"
"RTN","SDWLD",73,0)
 ..I SDWLSPO["Y" S SDWLWR="OPEN"
"RTN","SDWLD",74,0)
 ..I SDWLSS'="" S SDWLWR=$$EXTERNAL^DILFD(409.3,7,,SDWLSS)
"RTN","SDWLD",75,0)
 ..I SDWLSSO["Y" S SDWLWR="OPEN"
"RTN","SDWLD",76,0)
 ..I SDWLSC'="" S SDWLWR=$$EXTERNAL^DILFD(409.3,8,,SDWLSC)
"RTN","SDWLD",77,0)
 ..I SDWLSCO["^" S SDWLWR="OPEN"
"RTN","SDWLD",78,0)
 .N YY,MM,DD S YY=$E(SDWLDT,1,3)+1700,YY=$E(YY,3,4),MM=$E(SDWLDT,4,5),DD=$E(SDWLDT,6,7),SDWLDTP=MM_DD_YY
"RTN","SDWLD",79,0)
 .S SDWLCLN="" I $D(^SC(+SDWLCL,0)) S SDWLCLN=$$GET1^DIQ(44,SDWLCL_",",1,,)
"RTN","SDWLD",80,0)
 .S SDWLINN=$E($P($G(^DIC(4,+SDWLIN,0)),U,1),1,8)
"RTN","SDWLD",81,0)
 .N SDWLDIS S SDWLDIS=$P($G(^SDWL(409.3,SDWLDA,"DIS")),U,3),SDWLDISN=$$EXTERNAL^DILFD(409.3,21,,SDWLDIS)
"RTN","SDWLD",82,0)
 .S SDWLCN=SDWLCN+1
"RTN","SDWLD",83,0)
 .W !,$J(SDWLCN,2)_".",?5,$E(SDWLTYN,1,14),?22,SDWLPRI,?25,$E(SDWLWR,1,19),?51,$E(SDWLINN,1,14) W:$D(SDWLDISC) ?67,SDWLDSP
"RTN","SDWLD",84,0)
 .W ?73,SDWLDTP
"RTN","SDWLD",85,0)
 K SDWLDT,SDWLIN,SDWLCL,SDWLTY,SDWLPRI,SDWLPRIN,SDWLTYN,SDWLST,SDWLSP,SDWLSS,SDWLSC,SDWLCLN,SDWLDTP,SDWLINN,SDWLDA,SDWLDISN
"RTN","SDWLD",86,0)
 K SDWLPRI,SDWLWR
"RTN","SDWLD",87,0)
 Q
"RTN","SDWLD",88,0)
HD1 ;TOF HEADER INFORMATION
"RTN","SDWLD",89,0)
 I '$D(SDWLHDR) S SDWLHDR="Wait List Display"
"RTN","SDWLD",90,0)
 W !!,?80-$L(SDWLHDR_$S($D(SDWLOP):" - "_SDWLOP,1:""))\2,SDWLHDR W:$D(SDWLOP) " - ",SDWLOP  ;SD*5.3*454 removed page feed
"RTN","SDWLD",91,0)
 W !
"RTN","SDWLD",92,0)
 Q
"RTN","SDWLD",93,0)
HD2 ;DATA HEADER
"RTN","SDWLD",94,0)
 W !," #",?4,"Wait List Type",?22,"P",?26,"Waiting",?51,"Institution" W:$D(SDWLDISC) ?65,"Status"
"RTN","SDWLD",95,0)
 W ?74,"Date"
"RTN","SDWLD",96,0)
 W !,?28,"For",?73,"Entered"
"RTN","SDWLD",97,0)
 Q
"RTN","SDWLDISP")
0^4^B62805335^B34642315
"RTN","SDWLDISP",1,0)
SDWLDISP ;;IOFO BAY PINES/TEH - WAIT LIST - DISPOSITION WAIT LIST ENTRY;06/12/2002 ; 20 Aug 2002  2:10 PM  ; Compiled January 26, 2007 10:21:25
"RTN","SDWLDISP",2,0)
 ;;5.3;scheduling;**263,273,427,454,446**;AUG 13 1993;Build 77
"RTN","SDWLDISP",3,0)
 ;
"RTN","SDWLDISP",4,0)
 ;
"RTN","SDWLDISP",5,0)
 ;******************************************************************
"RTN","SDWLDISP",6,0)
 ;                             CHANGE LOG
"RTN","SDWLDISP",7,0)
 ;                                               
"RTN","SDWLDISP",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLDISP",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLDISP",10,0)
 ;  11/19/2002                 SD*5.3*273              EN1+4 CHECK FOR "^"
"RTN","SDWLDISP",11,0)
 ;  11/19/2002                 SD*5.3*273              REMOVED DIC("S") SCREEN FROM PAT
"RTN","SDWLDISP",12,0)
 ;  08/07/2008                 SD*5.3*446              check out EWL if DFN defined
"RTN","SDWLDISP",13,0)
 ;  04/12/2006                 SD*5.3*446              Inter-facility transfer/New Disposition type: CL
"RTN","SDWLDISP",14,0)
 ;
"RTN","SDWLDISP",15,0)
 ;
"RTN","SDWLDISP",16,0)
 ;
"RTN","SDWLDISP",17,0)
EN ;
"RTN","SDWLDISP",18,0)
 S SDWLERR=0
"RTN","SDWLDISP",19,0)
 I $D(SDWLLIST),SDWLLIST D
"RTN","SDWLDISP",20,0)
 .I $G(DFN)'>0 S SDWLERR=1 Q
"RTN","SDWLDISP",21,0)
 .I $D(DFN),'$D(^SDWL(409.3,"B",DFN)) D HD,1^VADPT,DEM^VADPT W !,VADM(1),?40,VA("PID"),*7,!,"This Patient has NO entries on the Electronic Wait List." S DIR(0)="E" D ^DIR S DUOUT=1 Q
"RTN","SDWLDISP",22,0)
 I $D(DUOUT) Q
"RTN","SDWLDISP",23,0)
 I 'SDWLERR,$D(SDWLLIST),SDWLLIST D HD S SDWLDFN=DFN K DIR,DIC,DR,DIE,VADM D 1^VADPT,DEM^VADPT W !,VADM(1),?40,VA("PID") S (SDWLBDT,SDWLEDT)="" D DIS G EN1
"RTN","SDWLDISP",24,0)
 K DIR,DIC,DR,DIE
"RTN","SDWLDISP",25,0)
 ;OPTION HEADER
"RTN","SDWLDISP",26,0)
 ;
"RTN","SDWLDISP",27,0)
 S SDWLOP=" - Disposition Patient" D HD
"RTN","SDWLDISP",28,0)
 ;
"RTN","SDWLDISP",29,0)
 ;PATIENT LOOK-UP FROM WAIT LIST PATIENT FILE (^SDWL(409.3,IEN,0).
"RTN","SDWLDISP",30,0)
 ;
"RTN","SDWLDISP",31,0)
 D PAT G END:'$D(SDWLDFN),END:SDWLDFN<0,END:SDWLDFN=""
"RTN","SDWLDISP",32,0)
 ;
"RTN","SDWLDISP",33,0)
 ;DISPLAY PATIENT DATA FROM ^SDWL(409.3,IEN,0).
"RTN","SDWLDISP",34,0)
 ;
"RTN","SDWLDISP",35,0)
 D DIS
"RTN","SDWLDISP",36,0)
 ;PROMPT USER FOR RECORD FOR DISPOSITIONING.
"RTN","SDWLDISP",37,0)
 ;
"RTN","SDWLDISP",38,0)
EN1 K DIR,DIC,DIE,DR,X,Y,SDWLERR S SDWLPS=$S(SDWLCN>1:1,SDWLCN=1:2,1:0),SDWLERR=0
"RTN","SDWLDISP",39,0)
 I SDWLPS=0 W !!,"Patient has no Wait List Entries to Disposition." S DIR(0)="E" D ^DIR G END
"RTN","SDWLDISP",40,0)
 I SDWLPS=1 S DIR(0)="FOA^^" S DIR("A")="Select Wait List (1-"_SDWLCN_") or '^' to Quit? "
"RTN","SDWLDISP",41,0)
 I SDWLPS=2 S DIR(0)="FOA^^" S DIR("A")="Disposition This 'ENTRY' or '^' to Quit? Yes // "
"RTN","SDWLDISP",42,0)
 W ! D ^DIR G END:X["^" S SDWLY=Y W !
"RTN","SDWLDISP",43,0)
 I SDWLPS=1 D
"RTN","SDWLDISP",44,0)
 .S SDWLERR=$S(X?1N.N:0,X?1"N".E:1,X?1"n".E:1,X="":1,X?1"Y".E:0,X?1"y".E:0,$D(DUOUT):1,X["^":1,1:2)
"RTN","SDWLDISP",45,0)
 I $D(SDWLERR),SDWLERR=2 W *7," Invalid Entry" G EN1
"RTN","SDWLDISP",46,0)
 I SDWLPS=2 D
"RTN","SDWLDISP",47,0)
 .S SDWLERR=$S(X="":0,X?1"Y".E:0,X?1"y":0,X?1"N".E:1,X?1"n".E:1,X["^":1,1:2)
"RTN","SDWLDISP",48,0)
 I SDWLERR=2 W *7," Invalid Entry" G EN1
"RTN","SDWLDISP",49,0)
 G END:SDWLERR
"RTN","SDWLDISP",50,0)
 I SDWLPS=2,'SDWLY S SDWLY=1
"RTN","SDWLDISP",51,0)
 S SDWLERR=0 I SDWLY?1N.N D  G EN1:SDWLERR
"RTN","SDWLDISP",52,0)
 .K DIR,DIC,DR
"RTN","SDWLDISP",53,0)
 .;
"RTN","SDWLDISP",54,0)
 .;CHECK FOR VALID ENTRY
"RTN","SDWLDISP",55,0)
 .;
"RTN","SDWLDISP",56,0)
 .I '$D(^TMP("SDWLD",$J,SDWLDFN,+SDWLY)) W " Invalid Entry " S SDWLERR=1 Q
"RTN","SDWLDISP",57,0)
 .S SDWLDA=$P($G(^TMP("SDWLD",$J,SDWLDFN,+SDWLY)),"~",2)
"RTN","SDWLDISP",58,0)
 .;
"RTN","SDWLDISP",59,0)
 .;LOCK DATA FILE
"RTN","SDWLDISP",60,0)
 .;
"RTN","SDWLDISP",61,0)
 .L ^SDWL(409.3,SDWLDA):5 I '$T W !,"Another User is Editing this Entry. Try Later." S DUOUT=1
"RTN","SDWLDISP",62,0)
 I $D(DUOUT) G END
"RTN","SDWLDISP",63,0)
 ;
"RTN","SDWLDISP",64,0)
 ;GET PATIENT DATA FROM ^SDWL(409.3,IEN,0).
"RTN","SDWLDISP",65,0)
 ;
"RTN","SDWLDISP",66,0)
 D GETDATA
"RTN","SDWLDISP",67,0)
 ;
"RTN","SDWLDISP",68,0)
 ;ENTER DISPOSITION
"RTN","SDWLDISP",69,0)
 ;  
"RTN","SDWLDISP",70,0)
 D EDIT G END:$D(DUOUT) I $D(SDWLERR) G END:SDWLERR
"RTN","SDWLDISP",71,0)
 W !,"*** Patient has been removed from Wait List. ***"
"RTN","SDWLDISP",72,0)
 K DIR,DIE,DR,DIC
"RTN","SDWLDISP",73,0)
 S DIR(0)="E" D ^DIR I $D(DUOUT) G END
"RTN","SDWLDISP",74,0)
 D END G EN
"RTN","SDWLDISP",75,0)
 ;
"RTN","SDWLDISP",76,0)
 Q
"RTN","SDWLDISP",77,0)
PAT ;PATIENT LOOK-UP
"RTN","SDWLDISP",78,0)
 ;
"RTN","SDWLDISP",79,0)
 S DIC(0)="EMNAQ",DIC=409.3 D ^DIC S (SDWLDFN,DFN)=$P(Y,U,2) G PAT1:DFN<0
"RTN","SDWLDISP",80,0)
 G PAT1:DFN=""
"RTN","SDWLDISP",81,0)
 S SDWLNAM=$$GET1^DIQ(2,DFN_",",.01)
"RTN","SDWLDISP",82,0)
 S X=$$GET1^DIQ(2,DFN_",",".351") I X'="" W !!,*7,"PATIENT'S DATE OF DEATH HAS BEEN RECORDED"  ;SD*5.3*454 allow user to disposition deceased patient
"RTN","SDWLDISP",83,0)
 D 1^VADPT
"RTN","SDWLDISP",84,0)
PAT1 Q
"RTN","SDWLDISP",85,0)
 ;
"RTN","SDWLDISP",86,0)
DIS ;DISPLAY DATA FOR PATIENT
"RTN","SDWLDISP",87,0)
 ;
"RTN","SDWLDISP",88,0)
 S SDWLDISC="",SDWLCN=0,SDWLHDR="Wait List Disposition"
"RTN","SDWLDISP",89,0)
 D EN^SDWLD(SDWLDFN,VA("PID"),VADM(1))
"RTN","SDWLDISP",90,0)
 K VADM,VAIN,VA,SDWLDISC
"RTN","SDWLDISP",91,0)
 Q
"RTN","SDWLDISP",92,0)
GETDATA ;PATIENT DATA RETRIEVAL
"RTN","SDWLDISP",93,0)
 ;
"RTN","SDWLDISP",94,0)
 S SDWLDATA=$G(^SDWL(409.3,SDWLDA,0))
"RTN","SDWLDISP",95,0)
 S SDWLIN=$P(SDWLDATA,U,3),SDWLCL=+$P(SDWLDATA,U,4),SDWLTY=$P(SDWLDATA,U,5),SDWLST=$P(SDWLDATA,U,6)
"RTN","SDWLDISP",96,0)
 S SDWLSP=$P(SDWLDATA,U,7),SDWLSS=$P(SDWLDATA,U,8),SDWLSC=$P(SDWLDATA,U,9),SDWLPRI=$P(SDWLDATA,U,10),SDWLRB=$P(SDWLDATA,U,11)
"RTN","SDWLDISP",97,0)
 S SDWLPROV=$P(SDWLDATA,U,12),SDWLDAPT=$P(SDWLDATA,U,16),SDWLST=$P(SDWLDATA,U,17),SDWLDUZ=DUZ,SDWLEDT=DT
"RTN","SDWLDISP",98,0)
 S SDWLSCL="" I SDWLSC S SDWLSCL=+$P(^SDWL(409.32,SDWLSC,0),U,1)
"RTN","SDWLDISP",99,0)
 I $D(^SDWL(409.3,SDWLDA,"DIS")) S SDWLDISP=$P(^SDWL(409.3,SDWLDA,"DIS"),U,3)
"RTN","SDWLDISP",100,0)
 Q
"RTN","SDWLDISP",101,0)
EDIT ;ENTER/EDIT DISPOSITION
"RTN","SDWLDISP",102,0)
 ;
"RTN","SDWLDISP",103,0)
 S SDWLDUZ=DUZ,SDWLERR=0 N DIR,DR,DIE,DIC,DA
"RTN","SDWLDISP",104,0)
 I $D(SDWLDISP) S DIR("B")=$$EXTERNAL^DILFD(409.3,21,,SDWLDISP)
"RTN","SDWLDISP",105,0)
 S DIR(0)="SO^D:DEATH;NC:REMOVED/NON-VA CARE;SA:REMOVED/SCHEDULED-ASSIGNED;CC:REMOVED/VA CONTRACT CARE;NN:REMOVED/NO LONGER NECESSARY;ER:ENTERED IN ERROR;CL:CLINIC CHANGE^"
"RTN","SDWLDISP",106,0)
 S DIR("L",1)="Disposition Reason:",DIR("L",2)="",DIR("L",3)="D DEATH",DIR("L",4)="NC REMOVED/NON-VA CARE",DIR("L",5)="SA REMOVED/SCHEDULED-ASSIGNED"
"RTN","SDWLDISP",107,0)
 S DIR("L",6)="CC REMOVED/VA CONTRACT CARE",DIR("L",7)="NN REMOVED/NO LONGER NECESSARY",DIR("L")="ER ENTERED IN ERROR"
"RTN","SDWLDISP",108,0)
 S:SDWLTY=4 DIR("L",8)="CL CLINIC CHANGE"
"RTN","SDWLDISP",109,0)
 D ^DIR
"RTN","SDWLDISP",110,0)
 I X="" S DUOUT=1 Q
"RTN","SDWLDISP",111,0)
 I X="^" S DUOUT=1 Q
"RTN","SDWLDISP",112,0)
 ;S SDWLDISP=$S(X["D":"D",X["d":"D",X["NC":"NC",X["nc":"NC",X["SA":"SA",X["sa":"SA",X["CC":"CC",X["cc":"CC",X["NN":"NN",X["nn":"NN",X["ER":"ER",X["er":"ER",1:0)
"RTN","SDWLDISP",113,0)
 ;I SDWLDISP=0 S SDWLERR=1
"RTN","SDWLDISP",114,0)
 S SDWLDISP=$TR(X,"acdelnrst","ACDELNRST") S:"^D^NC^SA^CC^NN^ER^TR^"_$S(SDWLTY=4:"CL^",1:"")'[("^"_SDWLDISP_"^") SDWLERR=1
"RTN","SDWLDISP",115,0)
 I SDWLERR W *7,"Invalid Entry" G EDIT
"RTN","SDWLDISP",116,0)
 I SDWLDISP="SA" I "3,4"[SDWLTY D PKAPP(SDWLDA,SDWLTY,.SDWLDATA) Q  ; QUIT OR NOT?
"RTN","SDWLDISP",117,0)
 I SDWLDISP="CL" S SDWLERR=$$EN^SDWLE7 Q:SDWLERR  ; OG ; 446
"RTN","SDWLDISP",118,0)
 S DIE("NO^")="NO EDITING"
"RTN","SDWLDISP",119,0)
 S DIE="^SDWL(409.3,",DA=SDWLDA,DR="21////^S X=SDWLDISP" D ^DIE
"RTN","SDWLDISP",120,0)
 S DR="19////^S X=DT" D ^DIE
"RTN","SDWLDISP",121,0)
 S DR="20////^S X=SDWLDUZ" D ^DIE
"RTN","SDWLDISP",122,0)
 S DR="23////^S X=""C""" D ^DIE
"RTN","SDWLDISP",123,0)
 I SDWLSCL K:$D(^SDWL(409.3,"SC",SDWLSCL,SDWLDA)) ^SDWL(409.3,"SC",SDWLSCL,SDWLDA)
"RTN","SDWLDISP",124,0)
 I SDWLSS K:$D(^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLDA)) ^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLDA)
"RTN","SDWLDISP",125,0)
 ; OG ; SD*5.3*446 Inter-facility transfer.
"RTN","SDWLDISP",126,0)
 D DIS^SDWLE6(SDWLDA)
"RTN","SDWLDISP",127,0)
 Q
"RTN","SDWLDISP",128,0)
PKAPP(SDWLDA,SDWLTY,SDWLDATA) ;identify appointemnt to close with
"RTN","SDWLDISP",129,0)
 ;SDWLDA -ien OF 409.3 to be closed
"RTN","SDWLDISP",130,0)
 ;SDWLTY - type of EWL entry
"RTN","SDWLDISP",131,0)
 ;SDWLDATA - 0 node of SDWLDA
"RTN","SDWLDISP",132,0)
 N SDCL,SDSP,SDORG,SDPCL,SDPSP S (SDCL,SDSP)="" N PROC S PROC=1
"RTN","SDWLDISP",133,0)
 S SDPCL=$$GET1^DIQ(409.3,SDWLDA_",",8,"I"),SDPSP=$$GET1^DIQ(409.3,SDWLDA_",",7,"I")
"RTN","SDWLDISP",134,0)
 I SDWLTY=4 S SDCL=$$GET1^DIQ(409.32,SDPCL_",",.01,"I")
"RTN","SDWLDISP",135,0)
 I SDWLTY=3 S SDSP=$$GET1^DIQ(409.31,SDPSP_",",.01,"I")
"RTN","SDWLDISP",136,0)
 S SDORG=$$GET1^DIQ(409.3,SDWLDA_",",1,"I")
"RTN","SDWLDISP",137,0)
 ;display app/encounters
"RTN","SDWLDISP",138,0)
 N SDDS,SDAP S SDDS=$$CHKENC^SDWLQSC1(DFN,SDORG,SDCL,SDSP,PROC)
"RTN","SDWLDISP",139,0)
 I SDWLDISP="SA" D
"RTN","SDWLDISP",140,0)
 .I $O(^TMP($J,"APPT",""))=$O(^TMP($J,"APPT",""),-1) S SDAP=$O(^TMP($J,"APPT","")) D  Q
"RTN","SDWLDISP",141,0)
 ..Q:SDAP=""
"RTN","SDWLDISP",142,0)
 ..D APPTD^SDWLEVAL D SING(SDWLDA,SDWLTY,SDWLDATA)
"RTN","SDWLDISP",143,0)
 .I $O(^TMP($J,"APPT",""))'=$O(^TMP($J,"APPT",""),-1) D APPTD^SDWLEVAL D  I SDAP="^" W !,"Disposition canceled by user",! Q
"RTN","SDWLDISP",144,0)
 ..W ! K DIR,X
"RTN","SDWLDISP",145,0)
 ..N STR,SS,SDA S SDA=$O(^TMP($J,"APPT",""),-1) I SDA=1 S DIR("B")=1
"RTN","SDWLDISP",146,0)
 ..S DIR(0)="N^1:"_SDA S DIR("A")="Select appt for Removal Reason or '^' to Quit>",DIR("?")="Select Appointment to close with the open EWL."
"RTN","SDWLDISP",147,0)
 ..D ^DIR
"RTN","SDWLDISP",148,0)
 ..S SDAP=X Q:X="^"!'X  D SING(SDWLDA,SDWLTY,SDWLDATA)
"RTN","SDWLDISP",149,0)
 Q:SDAP="^"  ;should we allow to quit or to proceed without filing an appointment?
"RTN","SDWLDISP",150,0)
 S DIE="^SDWL(409.3,",DA=SDWLDA,DR="21////^S X=SDWLDISP" D ^DIE
"RTN","SDWLDISP",151,0)
 S DR="19////^S X=DT" D ^DIE
"RTN","SDWLDISP",152,0)
 S DR="20////^S X=SDWLDUZ" D ^DIE
"RTN","SDWLDISP",153,0)
 S DR="23////^S X=""C""" D ^DIE
"RTN","SDWLDISP",154,0)
 Q
"RTN","SDWLDISP",155,0)
SING(SDWLDA,SDWLTY,SDWLDATA) ;called for filing with appointment if any
"RTN","SDWLDISP",156,0)
 S DIE="^SDWL(409.3,",DA=SDWLDA,DR="21////^S X=SDWLDISP" D ^DIE
"RTN","SDWLDISP",157,0)
 S DR="19////^S X=DT" D ^DIE
"RTN","SDWLDISP",158,0)
 S DR="20////^S X=SDWLDUZ" D ^DIE
"RTN","SDWLDISP",159,0)
 S DR="23////^S X=""C""" D ^DIE
"RTN","SDWLDISP",160,0)
 ;if "SA" update with appoint data
"RTN","SDWLDISP",161,0)
 ;get appt data to file (for a particular appt #)
"RTN","SDWLDISP",162,0)
 I SDWLDISP="SA" N SDA D DATP^SDWLEVAL(SDAP,.SDA) D
"RTN","SDWLDISP",163,0)
 .I $D(SDA) S DIE="^SDWL(409.3,",DA=SDWLDA D
"RTN","SDWLDISP",164,0)
 ..S DR="13////"_SDA(1)_";13.1////"_DT_";13.2////"_SDA(2)_";13.3////"_SDA(15)_";13.4////"_SDA(13)_";13.5////"_SDA(14)_";13.6////"_SDA(16)_";13.8////"_SDA(3)_";13.7////"_DUZ
"RTN","SDWLDISP",165,0)
 ..D ^DIE
"RTN","SDWLDISP",166,0)
 N SDWLSCL,SDWLSS,SDWLDFN
"RTN","SDWLDISP",167,0)
 S SDWLSCL=$P(SDWLDATA,U,9)
"RTN","SDWLDISP",168,0)
 ;S SDWLSCL=$P($G(^TMP($J,"SDWLPL",SDC)),U,9)
"RTN","SDWLDISP",169,0)
 S SDWLSS=$P(SDWLDATA,U,8)
"RTN","SDWLDISP",170,0)
 ;S SDWLSS=$P($G(^TMP($J,"SDWLPL",SDC)),U,10)
"RTN","SDWLDISP",171,0)
 I SDWLSCL K:$D(^SDWL(409.3,"SC",SDWLSCL,SDWLDA)) ^SDWL(409.3,"SC",SDWLSCL,SDWLDA)
"RTN","SDWLDISP",172,0)
 S SDWLDFN=$P($G(^TMP($J,"APPT",1)),U,4)
"RTN","SDWLDISP",173,0)
 I SDWLSS,SDWLDFN K:$D(^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLDA)) ^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLDA)
"RTN","SDWLDISP",174,0)
 Q
"RTN","SDWLDISP",175,0)
HD ;HEADER
"RTN","SDWLDISP",176,0)
 ;
"RTN","SDWLDISP",177,0)
 W:$D(IOF) @IOF W !!,?80-$L("Wait List - Disposition Patient")\2,"Wait List - Disposition Patient",!!
"RTN","SDWLDISP",178,0)
 ;
"RTN","SDWLDISP",179,0)
END ;QUIT OPTION
"RTN","SDWLDISP",180,0)
 K DIC,DIR,DR,DIE,SDWLDFN,DUOUT,SDWLSCL
"RTN","SDWLDISP",181,0)
 K SDWLCL,SDWSLCN,SDWLDA,SDWLDAPT,SDWLDATA,SDWLDFN,SDWLDISP,SDWLDUZ,SDWLEDT,SDWLERR,SDWLIN,SDWLNAM,SDWLOP,SDWLPRI
"RTN","SDWLDISP",182,0)
 K SDWLPROV,SDWLPS,SDWLRB,SDWLSC,SDWLSP,SDWLSS,SDWLST,SDWLTY,SDWLY,X,Y,SDWLHDR
"RTN","SDWLDISP",183,0)
 Q
"RTN","SDWLE")
0^3^B28082342^B27132811
"RTN","SDWLE",1,0)
SDWLE ;;IOFO BAY PINES/TEH - WAITING LIST-ENTER/EDIT;06/12/2002 ; 20 Aug 2002  2:10 PM
"RTN","SDWLE",2,0)
 ;;5.3;scheduling;**263,446**;AUG 13 1993;Build 77
"RTN","SDWLE",3,0)
 ;
"RTN","SDWLE",4,0)
 ;
"RTN","SDWLE",5,0)
 ;******************************************************************
"RTN","SDWLE",6,0)
 ;                             CHANGE LOG
"RTN","SDWLE",7,0)
 ;                                               
"RTN","SDWLE",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLE",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLE",10,0)
 ;   09JUN2005                   446                     Inter-Facility Transfer.
"RTN","SDWLE",11,0)
 ;   
"RTN","SDWLE",12,0)
 ;   
"RTN","SDWLE",13,0)
EN ;ENTRY POINT - INTIALIZE VARIABLES
"RTN","SDWLE",14,0)
 N DTOUT,%
"RTN","SDWLE",15,0)
 I $D(SDWLOPT),SDWLOPT G OPT
"RTN","SDWLE",16,0)
 I $D(SDWLLIST),SDWLLIST,$D(DFN),DFN<0 K SDWLLIST
"RTN","SDWLE",17,0)
 I $D(SDWLLIST),SDWLLIST,$D(DFN),DFN'="" S SDWLDFN=DFN D 1^VADPT S (SDWLTEM,SDWLPOS)=0 D HD,SB1 G EN1:'$D(DUOUT) W !,"PATIENT: ",VADM(1),?40,VA("PID") W !,*7,"PATIENT'S DATE OF DEATH HAS BEEN RECORDED" S DIR(0)="E" D ^DIR G END
"RTN","SDWLE",18,0)
 K ^TMP("SDWLD",$J) D HD
"RTN","SDWLE",19,0)
 D PAT G END:DFN<0
"RTN","SDWLE",20,0)
OPT S SDWLPCMM=0,SDWLERR=0 I $D(SDWLOPT),SDWLOPT D
"RTN","SDWLE",21,0)
 .S %=2 W !,"DO YOU WISH TO PLACE THIS PATIENT ON A WAITING LIST " D YN^DICN
"RTN","SDWLE",22,0)
 .I %=-1!(%=2) S SDWLERR=1 Q
"RTN","SDWLE",23,0)
 I $D(SDWLOPT),SDWLOPT,SDWLERR Q
"RTN","SDWLE",24,0)
 S SDWLDFN=DFN
"RTN","SDWLE",25,0)
 D 1^VADPT
"RTN","SDWLE",26,0)
 S (SDWLTEM,SDWLPOS)=0
"RTN","SDWLE",27,0)
EN1 N SDWLNEW,SDWLERR,SDWLCN,SDWLWTE S SDWLNEW=0,SDWLERR=0,SDWLCN=0,SDWLWTE=0
"RTN","SDWLE",28,0)
 G:$$EN^SDWLE6(SDWLDFN,.SDWLERR) EN2  ; OG ; SD*5.3*446 ; Inter-facility transfer
"RTN","SDWLE",29,0)
 D DIS
"RTN","SDWLE",30,0)
 I $D(^SDWL(409.3,"B",DFN)),'SDWLCN W !!,"PATIENT: ",VADM(1),?40,VA("PID")
"RTN","SDWLE",31,0)
 S SDWLPS=$S(SDWLCN>1:1,SDWLCN=1:2,1:3)
"RTN","SDWLE",32,0)
 I $D(SDWLOPT),SDWLOPT,SDWLPS=3 S X="Y" G ENO
"RTN","SDWLE",33,0)
 I SDWLPS=1 S DIR(0)="FOA^^" S DIR("A")="Select Wait List (1-"_SDWLCN_") or Enter 'N' for New or '^' to Quit ? ",DIR("?")="Enter a Valid Number or 'N' for New."
"RTN","SDWLE",34,0)
 I SDWLPS=2 S DIR(0)="FOA^^" S DIR("A")="Select Wait List (1) or Enter 'N' for New or '^' to Quit ? ",DIR("?")="Enter a '1' or 'N' for New."
"RTN","SDWLE",35,0)
 I SDWLPS=3 S DIR(0)="YAO^^S X=""Y""" S DIR("A")="Patient is not on Waiting List. Do you wish to Add Patient? Yes// "
"RTN","SDWLE",36,0)
 W ! D ^DIR W ! K DIR
"RTN","SDWLE",37,0)
 G END:$D(DUOUT),END:$D(DTOUT)
"RTN","SDWLE",38,0)
 I SDWLPS=1 D  G EN3:SDWLERR=1 I SDWLERR=2 W *7," ??" G EN1
"RTN","SDWLE",39,0)
 .S SDWLERR=$S(X?1"N".E:0,X?1"n".E:0,X="":2,$D(DUOUT):1,X["^":1,$D(^TMP("SDWLD",$J,DFN,+X)):0,1:2) Q
"RTN","SDWLE",40,0)
 I SDWLPS=2 D  G EN3:SDWLERR=1 I SDWLERR=2 W *7," ??" G EN1
"RTN","SDWLE",41,0)
 .S SDWLERR=$S(X?1"N".E:0,X?1"n".E:0,X="":2,$D(DUOUT):1,X["^":1,$D(^TMP("SDWLD",$J,DFN,+X)):0,1:2) Q
"RTN","SDWLE",42,0)
ENO I SDWLPS=3 D  G EN3:SDWLERR=1 I SDWLERR=2 W *7," ??" G EN1
"RTN","SDWLE",43,0)
 .S SDWLERR=$S(X?1"N".E:1,X?1"n".E:1,X="":0,X?1"Y".E:0,X?1"y".E:0,$D(DUOUT):1,X["^":1,1:2) Q
"RTN","SDWLE",44,0)
 I SDWLPS=1!(SDWLPS=2),X?1N.N D
"RTN","SDWLE",45,0)
 .N DA,SDWLDA S (DA,SDWLDA)=$P($G(^TMP("SDWLD",$J,DFN,+X)),"~",2),SDWLEDIT=""
"RTN","SDWLE",46,0)
 .;
"RTN","SDWLE",47,0)
 .;LOCK DATA FILE
"RTN","SDWLE",48,0)
 .;
"RTN","SDWLE",49,0)
 .L +^SDWL(409.3,DA):5 I '$T W !,"ANOTHER TERMINAL IS EDITING THIS ENTRY. TRY LATER." S DUOUT=1
"RTN","SDWLE",50,0)
 .I $D(DUOUT) Q
"RTN","SDWLE",51,0)
 .N SDWLINNM,SDWLSTN  ; OG ; This and the following six lines added for patch 415
"RTN","SDWLE",52,0)
 .I $$GETTRN^SDWLIFT1(SDWLDA,.SDWLINNM,.SDWLSTN) D  S DUOUT=1 Q
"RTN","SDWLE",53,0)
 ..N SDWLMSG,SDWLI
"RTN","SDWLE",54,0)
 ..S SDWLMSG(0)=1,SDWLMSG(SDWLMSG(0),0)="This entry is the subject of a transfer to "_SDWLINNM_" ("_SDWLSTN_"). Editing inhibited."
"RTN","SDWLE",55,0)
 ..I $L(SDWLMSG(SDWLMSG(0),0))>80 D COL80^SDWLIFT(.SDWLMSG)
"RTN","SDWLE",56,0)
 ..F SDWLI=1:1:SDWLMSG(0) W !,SDWLMSG(SDWLI,0)
"RTN","SDWLE",57,0)
 ..Q
"RTN","SDWLE",58,0)
 .D EN^SDWLE10
"RTN","SDWLE",59,0)
 .D EDIT W !!,"Editing is Completed" S SDWLERR=1 K SDWLEDIT
"RTN","SDWLE",60,0)
 G END:SDWLERR
"RTN","SDWLE",61,0)
 I SDWLPS=1!(SDWLPS=2),X?1"N".E!(X?1"n".E) D NEW,EDIT S SDWLNEW="" G EN2
"RTN","SDWLE",62,0)
 I SDWLPS=3 D NEW,EDIT S SDWLNEW=""
"RTN","SDWLE",63,0)
EN2 I $D(SDWLNEW),'$D(DUOUT),'SDWLERR W !!,?15,"*** Patient has been added to Wait List ***",!
"RTN","SDWLE",64,0)
 K SDWLNEW,DUOUT
"RTN","SDWLE",65,0)
 ;
"RTN","SDWLE",66,0)
 ;UNLOCK FILE AND KILL LOCAL VARIABLES
"RTN","SDWLE",67,0)
 ;
"RTN","SDWLE",68,0)
 I $D(SDWLDA) L -^SDWL(409.3,SDWLDA)
"RTN","SDWLE",69,0)
 ;-exit logic
"RTN","SDWLE",70,0)
EN3 D END^SDWLE113
"RTN","SDWLE",71,0)
 Q
"RTN","SDWLE",72,0)
END D END^SDWLE113
"RTN","SDWLE",73,0)
 D EN^SDWLKIL
"RTN","SDWLE",74,0)
 Q 
"RTN","SDWLE",75,0)
 ;
"RTN","SDWLE",76,0)
 ;
"RTN","SDWLE",77,0)
PAT ;SELECT PATIENT
"RTN","SDWLE",78,0)
 ;
"RTN","SDWLE",79,0)
 S DIC(0)="EMNZAQ",DIC=2 D ^DIC S (SDWLDFN,DFN)=$P(Y,U,1) G PAT1:DFN<0
"RTN","SDWLE",80,0)
 S X=$$GET1^DIQ(2,DFN_",",".351") I X'="" W !,*7,"PATIENT'S DATE OF DEATH HAS BEEN RECORDED" G PAT
"RTN","SDWLE",81,0)
 S SDWLSSN=$G(VA("PID")),SDWLNAM=$G(VA(1))
"RTN","SDWLE",82,0)
PAT1 K VADM,VAIN,VAERR,VA Q
"RTN","SDWLE",83,0)
 ;
"RTN","SDWLE",84,0)
DIS ;DISPLAY DATA FOR PATIENT
"RTN","SDWLE",85,0)
 ;
"RTN","SDWLE",86,0)
 S SDWLHDR="Wait List Enter/Edit"
"RTN","SDWLE",87,0)
 D EN^SDWLD(DFN,VA("PID"),VADM(1))
"RTN","SDWLE",88,0)
 D PCM^SDWLE1,PCMD^SDWLE1
"RTN","SDWLE",89,0)
 Q
"RTN","SDWLE",90,0)
 ;
"RTN","SDWLE",91,0)
NEW ;
"RTN","SDWLE",92,0)
 D NEW^SDWLE11
"RTN","SDWLE",93,0)
 Q
"RTN","SDWLE",94,0)
 ;
"RTN","SDWLE",95,0)
EDIT ;
"RTN","SDWLE",96,0)
 D EN^SDWLE111 I $D(DUOUT) D END^SDWLE113:'$D(SDWLEDIT) Q
"RTN","SDWLE",97,0)
 I SDWLTYE=4 D ED4 K DIR,DIE,DIC,DR Q
"RTN","SDWLE",98,0)
 I SDWLTYE=3 D ED3 K DIR,DIE,DIC,DR Q
"RTN","SDWLE",99,0)
 I SDWLTYE=2 D ED2 K DIR,DIE,DIC,DR Q
"RTN","SDWLE",100,0)
 I SDWLTYE=1 D ED1 K DIR,DIE,DIC,DR Q
"RTN","SDWLE",101,0)
 Q
"RTN","SDWLE",102,0)
ED1 ;-team       
"RTN","SDWLE",103,0)
 I $D(DUOUT) D END^SDWLE113:'$D(SDWLEDIT) Q
"RTN","SDWLE",104,0)
 D EN^SDWLE3 I '$D(DUOUT) D EN^SDWLE113 Q
"RTN","SDWLE",105,0)
 Q
"RTN","SDWLE",106,0)
ED2 ;-position
"RTN","SDWLE",107,0)
 I $D(DUOUT) D END^SDWLE113:'$D(SDWLEDIT) Q
"RTN","SDWLE",108,0)
 D EN^SDWLE5 I '$D(DUOUT) D EN^SDWLE113 Q
"RTN","SDWLE",109,0)
 Q
"RTN","SDWLE",110,0)
ED3 ;-specialty  
"RTN","SDWLE",111,0)
 D EN^SDWLE2 I $D(DUOUT) D END^SDWLE113:'$D(SDWLEDIT) Q
"RTN","SDWLE",112,0)
 D EN^SDWLE110 I $D(DUOUT) D END^SDWLE113:'$D(SDWLEDIT) Q
"RTN","SDWLE",113,0)
 I '$D(DUOUT) D EN^SDWLE113
"RTN","SDWLE",114,0)
 D END^SDWLE113
"RTN","SDWLE",115,0)
 Q
"RTN","SDWLE",116,0)
ED4 ;-clinic
"RTN","SDWLE",117,0)
 D EN^SDWLE4 I $D(DUOUT) D END^SDWLE113:'$D(SDWLEDIT) Q
"RTN","SDWLE",118,0)
 D EN^SDWLE110 I $D(DUOUT) D END^SDWLE113:'$D(SDWLEDIT) Q
"RTN","SDWLE",119,0)
 I '$D(DUOUT) D EN^SDWLE113
"RTN","SDWLE",120,0)
 D END^SDWLE113
"RTN","SDWLE",121,0)
 Q
"RTN","SDWLE",122,0)
 ;
"RTN","SDWLE",123,0)
ED5 D END^SDWLE113
"RTN","SDWLE",124,0)
 Q
"RTN","SDWLE",125,0)
SB1 S X=$$GET1^DIQ(2,DFN_",",".351") I X'="" S DUOUT=""
"RTN","SDWLE",126,0)
 Q
"RTN","SDWLE",127,0)
HD W:$D(IOF) @IOF W !,?80-$L("Scheduling/PCMM Enter/Edit Wait List")\2,"Scheduling/PCMM Enter/Edit Wait List",!!
"RTN","SDWLE",128,0)
 I $D(DFN),DFN'="",'$D(^SDWL(409.3,"B",DFN)),$D(SDWLLIST),SDWLLIST D
"RTN","SDWLE",129,0)
 .W !!,"PATIENT: ",VADM(1),?40,VA("PID")
"RTN","SDWLE",130,0)
 Q
"RTN","SDWLE11")
0^22^B8484611^B7209563
"RTN","SDWLE11",1,0)
SDWLE11 ;;IOFO BAY PINES/TEH - WAITING LIST-ENTER/EDIT - WAIT LIST TYPE/INSTUTITION;06/12/2002 ; 20 Aug 2002 2:10 PM  ; Compiled May 25, 2007 16:20:20
"RTN","SDWLE11",2,0)
 ;;5.3;scheduling;**263,485,497,446**;AUG 13 1993;Build 77
"RTN","SDWLE11",3,0)
 ;
"RTN","SDWLE11",4,0)
 ;
"RTN","SDWLE11",5,0)
 ;******************************************************************
"RTN","SDWLE11",6,0)
 ; CHANGE LOG
"RTN","SDWLE11",7,0)
 ; 
"RTN","SDWLE11",8,0)
 ; DATE PATCH DESCRIPTION
"RTN","SDWLE11",9,0)
 ; ---- ----- -----------
"RTN","SDWLE11",10,0)
 ; 05/09/2006 SD*5.3*485 CORRECT ENROLLMENT STATUS. 
"RTN","SDWLE11",11,0)
 ; 06/05/2006 SD*5.3*446 Scheduling reminder flag 
"RTN","SDWLE11",12,0)
 ; 
"RTN","SDWLE11",13,0)
 ; 
"RTN","SDWLE11",14,0)
NEW ;ADD NEW PATIENT
"RTN","SDWLE11",15,0)
 K DIC,DIR,DR,DIE N %H,SDWLDS,SDWLE,SDWLNEW,SDWLRNED,SDWLX,SDWLY
"RTN","SDWLE11",16,0)
 S DIC(0)="LX",X=SDWLDFN,DIC="^SDWL(409.3," D FILE^DICN S (SDWLDA,DA)=+Y
"RTN","SDWLE11",17,0)
 S SDWLNEW=1 K DIC
"RTN","SDWLE11",18,0)
 L ^SDWL(409.3,SDWLDA)
"RTN","SDWLE11",19,0)
 S DIE="^SDWL(409.3,",DR="1////^S X=DT"
"RTN","SDWLE11",20,0)
 D:$G(SDWLACA)  ; 446
"RTN","SDWLE11",21,0)
 .W !,"Note: you are about to create an EWL entry to be used as a Scheduling Reminder."
"RTN","SDWLE11",22,0)
 .S DR=DR_";33////^S X=""Y"""
"RTN","SDWLE11",23,0)
 .Q
"RTN","SDWLE11",24,0)
 D ^DIE
"RTN","SDWLE11",25,0)
 ;
"RTN","SDWLE11",26,0)
 ;DETERMINE ENROLLEE STATUS
"RTN","SDWLE11",27,0)
 ;
"RTN","SDWLE11",28,0)
 ;SDWLE=1 = NEW ENROLLEE
"RTN","SDWLE11",29,0)
 ;SDWLE=2 = ESTABLISHED
"RTN","SDWLE11",30,0)
 ;SDWLE=3 = PRIOR ENROLLEE
"RTN","SDWLE11",31,0)
 ;SDWLE=4 = UNDETERMINED
"RTN","SDWLE11",32,0)
TST ;
"RTN","SDWLE11",33,0)
EN S SDWLDE=+$H,SDWLE=1,(SDWLEE,SDWLRNED,SDWLDB)=0 D SB1
"RTN","SDWLE11",34,0)
 G SB0:SDWLE=2
"RTN","SDWLE11",35,0)
 S SDWLRNE=$$ENROLL^EASWTAPI(SDWLDFN) G SB0:$P(SDWLRNE,U,4)="A" S SDWLRNED=$P(SDWLRNE,U,3)
"RTN","SDWLE11",36,0)
 I SDWLRNED S X=SDWLRNED D H^%DTC S SDWLDS=%H S SDWLDE=+$H,SDWLDET=SDWLDE-SDWLDS,SDWLDB=2 I SDWLDET<366 S SDWLE=1
"RTN","SDWLE11",37,0)
 I $D(SDWLDET),SDWLDET>365 S SDWLE=3
"RTN","SDWLE11",38,0)
 I 'SDWLRNE S SDWLE=4
"RTN","SDWLE11",39,0)
SB0 I $D(SDWLRNE),$P(SDWLRNE,U,4)="A" D
"RTN","SDWLE11",40,0)
 .I $D(SDWLEE),SDWLEE>730!(SDWLEE=730) S SDWLE=4 Q
"RTN","SDWLE11",41,0)
 .I 'SDWLEE S SDWLE=4 Q
"RTN","SDWLE11",42,0)
 S SDWLRNE=$S(SDWLE=1:"N",SDWLE=2:"E",SDWLE=3:"P",SDWLE=4:"U",1:"U")
"RTN","SDWLE11",43,0)
 ;-Code here for filling in 409.3
"RTN","SDWLE11",44,0)
 S DR="27////^S X=SDWLRNE",DIE="^SDWL(409.3,",DA=SDWLDA D ^DIE
"RTN","SDWLE11",45,0)
 ;SAVE ENROLLEE CALCULATION DATE
"RTN","SDWLE11",46,0)
 S DR="27.1////^S X=$S($G(SDWLRNED):SDWLRNED,$G(SDWLD):SDWLD,1:"""")" D ^DIE
"RTN","SDWLE11",47,0)
 ;SAVE DATABASE FILE
"RTN","SDWLE11",48,0)
 S DR="27.2////^S X=SDWLDB" D ^DIE
"RTN","SDWLE11",49,0)
 S DR="9////^S X=DUZ" D ^DIE
"RTN","SDWLE11",50,0)
 K SDWLRNE,SDWLD,SDWLDE,SDWLEE,SDWLDET,DIC,DIR,DR,DIE,X
"RTN","SDWLE11",51,0)
 Q
"RTN","SDWLE11",52,0)
SB1 I '$D(^DGCN(391.91,"B",SDWLDFN)) N SDWLDB S SDWLE=3 Q
"RTN","SDWLE11",53,0)
 S SDWLX="" F  S SDWLX=$O(^DGCN(391.91,"B",SDWLDFN,SDWLX)) Q:SDWLX=""  D
"RTN","SDWLE11",54,0)
 .S SDWLY=$G(^DGCN(391.91,SDWLX,0)) D
"RTN","SDWLE11",55,0)
 ..;CHECK FOR VALID TF
"RTN","SDWLE11",56,0)
 ..I $$TF^XUAF4(+$P(SDWLY,U,2)) D
"RTN","SDWLE11",57,0)
 ...;GET LIST OF DATES FOR TF
"RTN","SDWLE11",58,0)
 ...S SDWLD=$P(SDWLY,U,3) I SDWLD S SDWLDTF(9999999-SDWLD)=SDWLX
"RTN","SDWLE11",59,0)
 ;FIND LAST TREATMENT DATE
"RTN","SDWLE11",60,0)
 I '$D(SDWLDTF) Q
"RTN","SDWLE11",61,0)
 S SDWLDTF=$O(SDWLDTF(0)) I SDWLDTF S (SDWLD,X)=9999999-SDWLDTF D H^%DTC S SDWLEE=SDWLDE-%H,SDWLDB=1 I SDWLEE<730 S SDWLE=2
"RTN","SDWLE11",62,0)
 I $D(SDWLEE),SDWLEE>730!(SDWLEE=730) S SDWLE=3
"RTN","SDWLE11",63,0)
 K SDWLDTF
"RTN","SDWLE11",64,0)
END Q
"RTN","SDWLE2")
0^29^B14498008^B2289830
"RTN","SDWLE2",1,0)
SDWLE2 ;;IOFO BAY PINES/TEH - WAITING LIST-ENTER/EDIT;06/12/2002 ; 20 Aug 2002  2:10 PM  ; Compiled May 25, 2007 16:37:21
"RTN","SDWLE2",2,0)
 ;;5.3;scheduling;**263,397,424,446**;AUG 13 1993;Build 77
"RTN","SDWLE2",3,0)
 ;
"RTN","SDWLE2",4,0)
 ;
"RTN","SDWLE2",5,0)
 ;******************************************************************
"RTN","SDWLE2",6,0)
 ;                             CHANGE LOG
"RTN","SDWLE2",7,0)
 ;                                               
"RTN","SDWLE2",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLE2",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLE2",10,0)
 ;   06/06/06                    SD*5.3*446              Allow selection of a clinic after specialty is entered
"RTN","SDWLE2",11,0)
 ;   
"RTN","SDWLE2",12,0)
 ;   
"RTN","SDWLE2",13,0)
 ;      
"RTN","SDWLE2",14,0)
 ;Service/Specialty sub-routine
"RTN","SDWLE2",15,0)
 ;
"RTN","SDWLE2",16,0)
EN ;
"RTN","SDWLE2",17,0)
 N SDWLSSX  ; sd/446
"RTN","SDWLE2",18,0)
 K DIR,DIC,DR I $D(SDWLSS) S X=$$EXTERNAL^DILFD(409.3,7,,SDWLSS)
"RTN","SDWLE2",19,0)
 S SDWLERR=0 I $D(SDWLSS) S DIC("B")=$S($D(SDWLSS):X,1:"") I DIC("B")="" K DIC("B")
"RTN","SDWLE2",20,0)
 S DIC(0)="AEQ",DIC=409.31,DIC("A")="Select Service/Specialty: "
"RTN","SDWLE2",21,0)
 S DIC("S")="I $D(^SDWL(409.31,""E"",SDWLINE,+Y)),$D(^SDWL(409.31,+Y,""I"")),$P(^SDWL(409.31,+Y,""I"",($O(^SDWL(409.31,+Y,""I"",""B"",SDWLINE,""""))),0),U,4)=""""" D ^DIC
"RTN","SDWLE2",22,0)
 I X["^" S DUOUT=1 G END
"RTN","SDWLE2",23,0)
 I Y<0 W *7," Required" G EN
"RTN","SDWLE2",24,0)
 S SDWLSSX=+Y  ; sd/446
"RTN","SDWLE2",25,0)
 N SDSP S SDSP=$$GET1^DIQ(409.31,SDWLSSX,.01,"I") ; get pointer to 40.7
"RTN","SDWLE2",26,0)
 N SDD,SDCL,SDORG S SDCL="",SDORG=DT S SDD=$$CHKENC^SDWLQSC1(DFN,SDORG,SDCL,SDSP,1)
"RTN","SDWLE2",27,0)
 I SDD D APPTDIS N DIR,Y D  I Y["^"!'Y S DUOUT=1 Q
"RTN","SDWLE2",28,0)
 .W !!,"This patient already has scheduled appointments which may match",!,"the Wait List Entry."
"RTN","SDWLE2",29,0)
 .S DIR(0)="Y^A0",DIR("B")="NO",DIR("A")="Are you sure you want to continue"
"RTN","SDWLE2",30,0)
 .D ^DIR
"RTN","SDWLE2",31,0)
 ;
"RTN","SDWLE2",32,0)
 I '$$CLIN() Q:$G(DUOUT)  S DIE="^SDWL(409.3,",DR="7////^S X=SDWLSSX" D ^DIE  ; sd/446
"RTN","SDWLE2",33,0)
 K DIR,DIC,DIE,DR,Y,DUOUT
"RTN","SDWLE2",34,0)
END Q
"RTN","SDWLE2",35,0)
APPTDIS ;display already created appt/encounters
"RTN","SDWLE2",36,0)
 ;from ^TMP($J,"APPT")
"RTN","SDWLE2",37,0)
 N STR,SCNT
"RTN","SDWLE2",38,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDWLE2",39,0)
 S SCNT="" F  S SCNT=$O(^TMP($J,"APPT",SCNT)) Q:SCNT=""  D
"RTN","SDWLE2",40,0)
 .S STR=^TMP($J,"APPT",SCNT)
"RTN","SDWLE2",41,0)
 .N ZZ F ZZ=2,3,4,10,15 S SDD(ZZ)=$P($P(STR,"^",ZZ),";",2)
"RTN","SDWLE2",42,0)
 .N SD S SD=$P(STR,U) D  S Y=SD D D^DIQ S SDD(1)=Y ; date conv
"RTN","SDWLE2",43,0)
 ..I SDD(3)="SCHEDULED/KEPT" S SDD(3)=$S(SD<DT:"KEPT",1:"SCHEDULED")
"RTN","SDWLE2",44,0)
 .;DISPLAY
"RTN","SDWLE2",45,0)
 .I SCNT=1 D DPH(SCNT,.SDD)
"RTN","SDWLE2",46,0)
 .D DPHD(SCNT,.SDD)
"RTN","SDWLE2",47,0)
 Q
"RTN","SDWLE2",48,0)
DPH(SCNT,SDD) ;display appt header
"RTN","SDWLE2",49,0)
 W !!,"Appointment(s) for: "_SDD(4)
"RTN","SDWLE2",50,0)
 W !?3,"Appt Date/Time",?23,"Clinic",?48,"Status",?60,"Institution",! N SDL S $P(SDL,"-",79)="" W SDL,!
"RTN","SDWLE2",51,0)
 Q
"RTN","SDWLE2",52,0)
DPHD(SCNT,SDD) ;
"RTN","SDWLE2",53,0)
 W !,SCNT,?3,SDD(1),?23,$E(SDD(2),1,23),?48,$E(SDD(10),1,10),?60,SDD(15)
"RTN","SDWLE2",54,0)
 Q
"RTN","SDWLE2",55,0)
 ;
"RTN","SDWLE2",56,0)
CLIN() ; sd/446
"RTN","SDWLE2",57,0)
 N DA,DIC,DIE,DIK,DR,SDWLCL,SDWLEST,X,Y
"RTN","SDWLE2",58,0)
 S DIC=409.32,DIC(0)="AEQ",DIC("A")="WL SPECIFIC CLINIC related to this SPECIALTY (optional): ",DIC("S")="I $$VAL^SDWLE2(+Y)"
"RTN","SDWLE2",59,0)
 D ^DIC
"RTN","SDWLE2",60,0)
 I X["^" S DUOUT=1 Q 0
"RTN","SDWLE2",61,0)
 Q:X="" 0
"RTN","SDWLE2",62,0)
 S SDWLCL=+Y
"RTN","SDWLE2",63,0)
 ; Need to delete the old entry and create anew to change the wait list type
"RTN","SDWLE2",64,0)
 S SDWLEST=$$GET1^DIQ(409.3,SDWLDA,27,"I")
"RTN","SDWLE2",65,0)
 S DIK="^SDWL(409.3,",DA=SDWLDA
"RTN","SDWLE2",66,0)
 D ^DIK
"RTN","SDWLE2",67,0)
 S DIC(0)="LX",X=SDWLDFN,DIC="^SDWL(409.3," D FILE^DICN
"RTN","SDWLE2",68,0)
 L:DA'=SDWLDA +^SDWL(409.3,DA),-^SDWL(409.3,SDWLDA)
"RTN","SDWLE2",69,0)
 S SDWLDA=DA
"RTN","SDWLE2",70,0)
 S DIE="^SDWL(409.3,",DR="1////^S X=DT;2////^S X=SDWLINE;4////^S X=4;8////^S X=SDWLCL;9////^S X=DUZ;27////^S X=SDWLEST"
"RTN","SDWLE2",71,0)
 S:$G(SDWLACA) DR=DR_";33////^S X=""Y"""  ; 446
"RTN","SDWLE2",72,0)
 D ^DIE
"RTN","SDWLE2",73,0)
 Q 1
"RTN","SDWLE2",74,0)
VAL(Y) ; sd/446
"RTN","SDWLE2",75,0)
 N TMP
"RTN","SDWLE2",76,0)
 D GETS^DIQ(409.32,Y,".01;.02;2;4","I","TMP")
"RTN","SDWLE2",77,0)
 Q:TMP(409.32,Y_",",.02,"I")'=SDWLINE 0  ; Wrong institution
"RTN","SDWLE2",78,0)
 Q:TMP(409.32,Y_",",2,"I")="" 0  ; No activation date entered
"RTN","SDWLE2",79,0)
 Q:TMP(409.32,Y_",",4,"I")'="" 0  ; Inactivation date entered
"RTN","SDWLE2",80,0)
 Q $$GET1^DIQ(44,TMP(409.32,Y_",",.01,"I"),8,"I")=$$GET1^DIQ(409.31,SDWLSSX,.01,"I")  ; Does the clinic have the right stop code?
"RTN","SDWLE3")
0^5^B43695074^B24964504
"RTN","SDWLE3",1,0)
SDWLE3 ;IOFO BAY PINES/TEH - WAITING LIST-ENTER/EDIT;06/12/2002 ; 12/14/05 1:28pm  ; Compiled April 25, 2006 10:42:02
"RTN","SDWLE3",2,0)
 ;;5.3;scheduling;**263,417,446**;AUG 13 1993;Build 77
"RTN","SDWLE3",3,0)
 ;
"RTN","SDWLE3",4,0)
 ;
"RTN","SDWLE3",5,0)
 ;******************************************************************
"RTN","SDWLE3",6,0)
 ;                             CHANGE LOG
"RTN","SDWLE3",7,0)
 ;                                               
"RTN","SDWLE3",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLE3",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLE3",10,0)
 ;   08/01/2005                SD*5.3*417              Permit multiple teams
"RTN","SDWLE3",11,0)
 ;   04/21/2006                SD*5.3*446              Inter-Facility Transfer
"RTN","SDWLE3",12,0)
 ;   
"RTN","SDWLE3",13,0)
 ;
"RTN","SDWLE3",14,0)
EN ;
"RTN","SDWLE3",15,0)
 ;ASK FOR SPECIFIC TEAM (404.51)
"RTN","SDWLE3",16,0)
 K DIR,DIC,DR,DIE,SDTMENT S (DA,SDTMENT)=SDWLDA K SDWLTH,SDWLMAX
"RTN","SDWLE3",17,0)
 S SDWLYN=5,SDWLTYE=1,SDWLVBR="SDWLST"
"RTN","SDWLE3",18,0)
 I $D(SDWLST),'SDWLST K SDWLST
"RTN","SDWLE3",19,0)
 I $G(SDWLCP3)'="" D
"RTN","SDWLE3",20,0)
 .W !,"This patient is already on the ",SDWLCP3,"." S DIR(0)="Y^A0",DIR("B")="NO",DIR("A")="Are you sure you want to continue" D ^DIR
"RTN","SDWLE3",21,0)
 .I 'Y!(Y["^") S DUOUT=1 Q
"RTN","SDWLE3",22,0)
 I $D(DUOUT),DUOUT G END
"RTN","SDWLE3",23,0)
 D GETLIST
"RTN","SDWLE3",24,0)
 S SDWLERR=0,SDWLY="Team",SDWLVAR=$S($D(SDWLST):SDWLST,1:0),SDWLSCR=""
"RTN","SDWLE3",25,0)
 S SDWLVBR="SDWLST"
"RTN","SDWLE3",26,0)
EN1 W ! S SDWLS=SDWLY,SDWLX=$S(SDWLTYE=1:"T",SDWLTYE=2:"P",1:""),SDWLSX="     "_SDWLS
"RTN","SDWLE3",27,0)
 S SDWLF="SCTM(404.51,"
"RTN","SDWLE3",28,0)
 S SDWLA=0 F  S SDWLA=$O(^SCTM(404.58,"B",SDWLA)) Q:SDWLA=""  D
"RTN","SDWLE3",29,0)
 .I $D(SDWLCT),SDWLCT=SDWLA Q
"RTN","SDWLE3",30,0)
 .I $P($G(^SCTM(404.51,SDWLA,0)),U,7)'=SDWLIN Q
"RTN","SDWLE3",31,0)
 .I +$$ACTTM^SCMCTMU(SDWLA)=0 S SDWLTH(SDWLA)=""
"RTN","SDWLE3",32,0)
 .S SDWLMAX=0,X=$$TEAMCNT^SCAPMCU1(SDWLA,DT),SDWLMAX(SDWLA)=""  D
"RTN","SDWLE3",33,0)
 ..I X<$P($G(^SCTM(404.51,SDWLA,0)),U,8) K SDWLMAX(SDWLA)
"RTN","SDWLE3",34,0)
 N SDWLT S SDWLT=0 F  S SDWLT=$O(SDWLPLST(1,SDWLT)) Q:SDWLT<1  K SDWLMAX(SDWLT)
"RTN","SDWLE3",35,0)
 S SDWLSCR="I $P(^(0),U,7)=SDWLIN,'$D(SDWLTH(+Y)),$D(SDWLMAX(+Y)),'$D(SDWLPLST(SDWLTYE,+Y,SDWLIN))"
"RTN","SDWLE3",36,0)
 D EN2 G END:$D(DUOUT)
"RTN","SDWLE3",37,0)
 ;DA=SDWLDA, see EN
"RTN","SDWLE3",38,0)
 S DR="5////^S X=SDWLVAR",DIE=409.3 D ^DIE
"RTN","SDWLE3",39,0)
 N FLG D FLAGS(.FLG,DFN,SDWLVAR)
"RTN","SDWLE3",40,0)
 I 'FLG S DA=SDTMENT,DIE=409.3 D
"RTN","SDWLE3",41,0)
 .S SDINTR=FLG(1),SDREJ=FLG(2),SDMTM=FLG(3)
"RTN","SDWLE3",42,0)
 .S DR="32////^S X=SDREJ;34////^S X=SDINTR;38////^S X=SDMTM" D ^DIE
"RTN","SDWLE3",43,0)
 ;
"RTN","SDWLE3",44,0)
 S @SDWLVBR=SDWLVAR
"RTN","SDWLE3",45,0)
 I $D(SDWLVARO),SDWLVARO,SDWLVAR'=SDWLVARO D DELPOS
"RTN","SDWLE3",46,0)
 G END
"RTN","SDWLE3",47,0)
EN2 ;-DIR READ
"RTN","SDWLE3",48,0)
 I '$D(SDWLDATA),$D(SDWLMAX)'=11 W !,"No TEAMS are available for this INSTITUTION.",! S DUOUT="" Q
"RTN","SDWLE3",49,0)
 K DIR,DR,DIE,DIC,DUOUT
"RTN","SDWLE3",50,0)
 S DIR("?")="^S X=""?"",DIC(""S"")=""I $P(^SCTM(404.51,+Y,0),U,7)=SDWLIN,'$D(SDWLTH(+Y)),$D(SDWLMAX(+Y)),'$D(SDWLPLST(1,+Y,SDWLINE))"" S DIC=404.51,DIC(0)=""EQMNZ"" D ^DIC"
"RTN","SDWLE3",51,0)
 I $D(SDWLVAR),SDWLVAR S X=SDWLVAR,SDWLMPX=$$EXTERNAL^DILFD(409.3,SDWLYN,,SDWLVAR),DIR("B")=SDWLMPX,SDWLVARO=SDWLVAR K X
"RTN","SDWLE3",52,0)
 S DIR(0)="FAO",DIR("A")="Select "_SDWLY_": "
"RTN","SDWLE3",53,0)
 D ^DIR
"RTN","SDWLE3",54,0)
 I X["^" S DUOUT=1 Q
"RTN","SDWLE3",55,0)
 S DUOUT=$S(X=0:1,X="@":1,$D(DTOUT):1,1:0) I 'DUOUT K DUOUT
"RTN","SDWLE3",56,0)
 I X="@" W *7," No deleting allowing." G EN2
"RTN","SDWLE3",57,0)
 S DIC("S")=SDWLSCR
"RTN","SDWLE3",58,0)
 S DIC(0)="EMNZ",DIC=404.51 D ^DIC I $D(DTOUT) S DUOUT=1
"RTN","SDWLE3",59,0)
 I $D(DUOUT) Q
"RTN","SDWLE3",60,0)
 I Y<0 W "??" G EN2
"RTN","SDWLE3",61,0)
 S SDWLVAR=+Y
"RTN","SDWLE3",62,0)
 Q
"RTN","SDWLE3",63,0)
 ;identify flags
"RTN","SDWLE3",64,0)
FLAGS(FLG,DFN,TEAM) ;
"RTN","SDWLE3",65,0)
 N SDTEAM S SDTEAM=$G(TEAM)
"RTN","SDWLE3",66,0)
 ; check if transfer and if multiple teams in institution
"RTN","SDWLE3",67,0)
 S SDCNT=0,SDINTR=0,SDREJ=0,SDMTM=0 D
"RTN","SDWLE3",68,0)
 .S SDWLIN=$P($G(^SCTM(404.51,TEAM,0)),U,7)
"RTN","SDWLE3",69,0)
 .I $P(^SCTM(404.51,TEAM,0),U,5)'=1 Q  ; cannot be primary care provider team   
"RTN","SDWLE3",70,0)
 .;identify INTRA-transfer
"RTN","SDWLE3",71,0)
 .;- is patient assigned to PC provider?
"RTN","SDWLE3",72,0)
 .I $$GETALL^SCAPMCA(DFN) D
"RTN","SDWLE3",73,0)
 ..I $G(^TMP("SC",$J,DFN,"PCPOS",0)) S SDTM=$P(^(1),U,3) I SDTM>0 D
"RTN","SDWLE3",74,0)
 ...I $P($G(^SCTM(404.51,SDTM,0)),U,7)'=SDWLIN S SDINTR=1 D  ; inter transfer ; different institution
"RTN","SDWLE3",75,0)
 ..I '$G(^TMP("SC",$J,DFN,"PCPOS",0)) D
"RTN","SDWLE3",76,0)
 ...;check available PCMM teams in other institutions and if so set up rejection flag
"RTN","SDWLE3",77,0)
 ...S SDINS=""
"RTN","SDWLE3",78,0)
 ...F  S SDINS=$O(^SCTM(404.51,"AINST",SDINS)) Q:SDINS=""  I SDINS'=SDWLIN D  Q:SDREJ
"RTN","SDWLE3",79,0)
 ....S SDCNT=0,SDT=""
"RTN","SDWLE3",80,0)
 ....F  S SDT=$O(^SCTM(404.51,"AINST",SDINS,SDT)) Q:SDT=""  D  Q:SDREJ
"RTN","SDWLE3",81,0)
 .....I $$ACTTM^SCMCTMU(SDT,DT)&($P($G(^SCTM(404.51,SDT,0)),U,5))&'$P($G(^SCTM(404.51,SDT,0)),U,10) D
"RTN","SDWLE3",82,0)
 ......S SCTMCT=$$TEAMCNT^SCAPMCU1(SDT) ;currently assigned
"RTN","SDWLE3",83,0)
 ......S SCTMMAX=$P($$GETEAM^SCAPMCU3(SDT),"^",8) ;maximum set
"RTN","SDWLE3",84,0)
 ......I SCTMCT<SCTMMAX S SDREJ=1
"RTN","SDWLE3",85,0)
 ..;find all teams from institution SDWLIN
"RTN","SDWLE3",86,0)
 ..I SDINTR S SDCNT=0,SDT="" D
"RTN","SDWLE3",87,0)
 ...F  S SDT=$O(^SCTM(404.51,"AINST",SDWLIN,SDT)) Q:SDT=""  I $P(^SCTM(404.51,SDT,0),U,5)=1 S TEAM(SDT)="",SDCNT=SDCNT+1
"RTN","SDWLE3",88,0)
 S FLG(1)=SDINTR,FLG(2)=SDREJ,FLG(3)=SDMTM
"RTN","SDWLE3",89,0)
 I SDCNT>1 S SDMTM=1,FLG(3)=SDMTM,FLG=1 S SDCC="" F  S SDCC=$O(TEAM(SDCC)) Q:SDCC=""  S TEAM=SDCC N DR,Y D WMT
"RTN","SDWLE3",90,0)
 I SDCNT>1 S TEAM=$G(SDTEAM) Q
"RTN","SDWLE3",91,0)
 I SDCNT'>1 N DR,Y S FLG=0 S TEAM=$G(SDTEAM) Q
"RTN","SDWLE3",92,0)
WMT D INPUT^SDWLRP1(.RES,DFN_U_1_U_TEAM_U_U_DUZ_"^^"_U_SDINTR_U_SDREJ_U_SDMTM)
"RTN","SDWLE3",93,0)
 ;I $G(RES) S OK=0,DA=+$P(RES,U,2),DIE="^SDWL(409.3,",DR="25;S OK=1" D ^DIE  I '$G(OK) S DIK=DIE D ^DIK W !,"Wait list entry deleted"
"RTN","SDWLE3",94,0)
 Q
"RTN","SDWLE3",95,0)
GETLIST ;GET LIST OF TEAM ASSIGNMENTS - SD*5.3*417
"RTN","SDWLE3",96,0)
 N SDWLDAX,X,Z,SDWLIN K SDWLPLST S SDWLPLST=""
"RTN","SDWLE3",97,0)
 S SDWLDAX=0 F  S SDWLDAX=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDAX)) Q:SDWLDAX=""  D
"RTN","SDWLE3",98,0)
 .S Z=$G(^SDWL(409.3,SDWLDAX,0)),X=$P(Z,U,5),SDWLINE=+$P(Z,U,3) Q:X'=1&(X'=2)  D
"RTN","SDWLE3",99,0)
 ..S Y=+$S(X=1:$P(Z,U,6),X=2:$P(Z,U,7),1:0) Q:'Y  D
"RTN","SDWLE3",100,0)
 ...I $P(Z,U,17)["O" S SDWLPLST(X,Y,SDWLINE)="" I $D(SDWLST),SDWLST=+Y K SDWLPLST(X,Y,SDWLINE)
"RTN","SDWLE3",101,0)
 S Y=0 F  S Y=$O(SDWLCPT(Y)) Q:Y=""  D
"RTN","SDWLE3",102,0)
 .S SDWLPLST(1,Y,SDWLINE)="" I $D(SDWLST),SDWLST=+Y K SDWLPLST(1,Y,SDWLINE)
"RTN","SDWLE3",103,0)
 Q
"RTN","SDWLE3",104,0)
DELPOS ;DELETE POSITIONS FOR OLD TEAM
"RTN","SDWLE3",105,0)
 S SDWLA=0,CNT=0 F  S SDWLA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLA)) Q:SDWLA<1  D
"RTN","SDWLE3",106,0)
 .S X=$G(^SDWL(409.3,SDWLA,0)) Q:$P(X,U,7)=""
"RTN","SDWLE3",107,0)
 .I $P(X,U,5)'=2 Q
"RTN","SDWLE3",108,0)
 .I $P(X,U,17)["C" Q
"RTN","SDWLE3",109,0)
 .S SDWLPX=+$P(X,U,7) I $P($G(^SCTM(404.57,SDWLPX,0)),U,2)'=SDWLVARO Q
"RTN","SDWLE3",110,0)
 .S CNT=CNT+1,^XTMP("SDWLE3",$J,CNT)=SDWLA_";"_X W !
"RTN","SDWLE3",111,0)
 I 'CNT Q
"RTN","SDWLE3",112,0)
 W !,"This patient has one or more Wait List entries for PCMM Positions",!
"RTN","SDWLE3",113,0)
 W !,"Wait List Type",?30,"Waiting For",?45,"Institution",?60,"Date Entered",!
"RTN","SDWLE3",114,0)
 S Y=0 F  S Y=$O(^XTMP("SDWLE3",$J,Y)) Q:Y<1  S X=$G(^XTMP("SDWLE3",$J,Y)),SDWLIEN=$P(X,";",1) D
"RTN","SDWLE3",115,0)
 .W !,$$GET1^DIQ(409.3,SDWLIEN,4),?30,$$GET1^DIQ(409.3,SDWLIEN,6),?45,$$GET1^DIQ(409.3,SDWLIEN,2),?60,$$GET1^DIQ(409.3,SDWLIEN,1)
"RTN","SDWLE3",116,0)
 W ! S SDWLET=$$EXTERNAL^DILFD(409.3,SDWLYN,,SDWLVARO)
"RTN","SDWLE3",117,0)
 K DIR S DIR("?",1)="This patient has one or more Wait List entries for PCMM positions."
"RTN","SDWLE3",118,0)
 S DIR("?",2)="By answering 'YES' you will close the Wait List entries which were listed."
"RTN","SDWLE3",119,0)
 S DIR("?")="Answer 'NO' to keep those Wait List entries open."
"RTN","SDWLE3",120,0)
 S DIR("A")="Do you wish to close these POSITION(S) entries? ",DIR(0)="Y",DIR("B")="YES" D ^DIR
"RTN","SDWLE3",121,0)
 I 'Y W *7," No POSITIONS closed." Q
"RTN","SDWLE3",122,0)
 N DA S SDWLA=0 F  S SDWLA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLA)) Q:SDWLA<1  D
"RTN","SDWLE3",123,0)
 .S X=$G(^SDWL(409.3,SDWLA,0)) Q:$P(X,U,7)=""  D
"RTN","SDWLE3",124,0)
 ..S SDWLP=$P(X,U,7) I $P(^SCTM(404.57,SDWLP,0),U,2)=SDWLVARO D
"RTN","SDWLE3",125,0)
 ...K DIE,DIC,DR,DICR,DIR S DA=SDWLA,SDWLDISP="NN"
"RTN","SDWLE3",126,0)
 ...S DIE="^SDWL(409.3,",DR="21////^S X=SDWLDISP" D ^DIE
"RTN","SDWLE3",127,0)
 ...S DR="19////^S X=DT" D ^DIE
"RTN","SDWLE3",128,0)
 ...S DR="20////^S X=SDWLDUZ" D ^DIE
"RTN","SDWLE3",129,0)
 ...S DR="23////""C""" D ^DIE
"RTN","SDWLE3",130,0)
 Q
"RTN","SDWLE3",131,0)
END K SDWLA,SDWLMAX,SDWLTH,SDWLSCR,DIR,DIC,DIE,DR,SDWLPLST,SDWLDAX,DTOUT,SDWLCP3,SDWLINE
"RTN","SDWLE3",132,0)
 K X,Y,Z,SDWLPLST,SDWLB,SDWLA,SDWLSX,SDWLS,SDWLVBR,SDWLVAR,SDWLSCR,SDWLF,SDWLYN,SDWLMPX
"RTN","SDWLE3",133,0)
 Q
"RTN","SDWLE4")
0^28^B7584798^B2478211
"RTN","SDWLE4",1,0)
SDWLE4 ;;IOFO BAY PINES/TEH - WAITING LIST-ENTER/EDIT;06/12/2002 ; 20 Aug 2002  2:10 PM  ; Compiled May 1, 2007 15:18:53
"RTN","SDWLE4",2,0)
 ;;5.3;scheduling;**263,446**;AUG 13 1993;Build 77
"RTN","SDWLE4",3,0)
 ;
"RTN","SDWLE4",4,0)
 ;
"RTN","SDWLE4",5,0)
 ;******************************************************************
"RTN","SDWLE4",6,0)
 ;                             CHANGE LOG
"RTN","SDWLE4",7,0)
 ;                                               
"RTN","SDWLE4",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLE4",9,0)
 ;   ----                        -----                   -----------  
"RTN","SDWLE4",10,0)
 ;   
"RTN","SDWLE4",11,0)
 ;CLINIC (409.32)
"RTN","SDWLE4",12,0)
 ;
"RTN","SDWLE4",13,0)
EN K DIR,DIC,DIE,DR
"RTN","SDWLE4",14,0)
 I $D(SDWLSC) S X=$$EXTERNAL^DILFD(409.3,8,,SDWLSC),DIC("B")=$S($D(SDWLSC):X,1:"") I DIC("B")="" K DIC("B")
"RTN","SDWLE4",15,0)
 I $D(^SDWL(409.3,SDWLDA,0)),$P(^(0),U,9) S DIC("B")=$$EXTERNAL^DILFD(409.3,8,,$P(^(0),U,9))
"RTN","SDWLE4",16,0)
 S SDWLERR=0
"RTN","SDWLE4",17,0)
 K X,Y
"RTN","SDWLE4",18,0)
 S DIC(0)="QEMNZA",DIC("A")="Select Clinic: ",DIC("S")="I $P(^SDWL(409.32,+Y,0),U,6)=SDWLINE,'$P(^(0),U,4),$P(^(0),U,2)'=""""",DIC=409.32 D ^DIC
"RTN","SDWLE4",19,0)
 I X="^" S DUOUT=1 G END
"RTN","SDWLE4",20,0)
 I X="" W *7," Required" G EN
"RTN","SDWLE4",21,0)
 I Y<0 S DUOUT=1 G END
"RTN","SDWLE4",22,0)
 I $D(DTOUT) S DUOUT=1
"RTN","SDWLE4",23,0)
 I $D(SDWLSC),Y<0 G END
"RTN","SDWLE4",24,0)
 I Y<0 W " Required or ""^"" to Quit" G EN
"RTN","SDWLE4",25,0)
EN1 S SDWLSC=+Y
"RTN","SDWLE4",26,0)
 ;disply already created appointments
"RTN","SDWLE4",27,0)
 N SDCL S SDCL=$$GET1^DIQ(409.32,SDWLSC,.01,"I") ; get pointer to 44
"RTN","SDWLE4",28,0)
 N SDD,SDSP,SDORG S SDSP="",SDORG=DT S SDD=$$CHKENC^SDWLQSC1(DFN,SDORG,SDCL,SDSP,1)
"RTN","SDWLE4",29,0)
 I SDD D APPTDIS N DIR,Y D  I Y["^"!'Y S DUOUT=1 Q
"RTN","SDWLE4",30,0)
 .W !!,"This patient already has scheduled appointments which may match",!,"the Wait List Entry."
"RTN","SDWLE4",31,0)
 .S DIR(0)="Y^A0",DIR("B")="NO",DIR("A")="Are you sure you want to continue"
"RTN","SDWLE4",32,0)
 .D ^DIR
"RTN","SDWLE4",33,0)
 Q:$G(DUOUT)  S DA=SDWLDA,DIE="^SDWL(409.3,",DR="8////^S X=SDWLSC" D ^DIE
"RTN","SDWLE4",34,0)
 K DIR,DIC,DIE,DR
"RTN","SDWLE4",35,0)
END Q
"RTN","SDWLE4",36,0)
APPTDIS ;display already created appt/encounters
"RTN","SDWLE4",37,0)
 ;from ^TMP($J,"APPT")
"RTN","SDWLE4",38,0)
 N STR,SCNT
"RTN","SDWLE4",39,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDWLE4",40,0)
 S SCNT="" F  S SCNT=$O(^TMP($J,"APPT",SCNT)) Q:SCNT=""  D
"RTN","SDWLE4",41,0)
 .S STR=^TMP($J,"APPT",SCNT)
"RTN","SDWLE4",42,0)
 .N ZZ F ZZ=2,3,4,15 S SDD(ZZ)=$P($P(STR,"^",ZZ),";",2)
"RTN","SDWLE4",43,0)
 .N SD S SD=$P(STR,U) D  S Y=SD D D^DIQ S SDD(1)=Y ; date conv
"RTN","SDWLE4",44,0)
 ..I SDD(3)="SCHEDULED/KEPT" S SDD(3)=$S(SD<DT:"KEPT",1:"SCHEDULED")
"RTN","SDWLE4",45,0)
 .;DISPLAY
"RTN","SDWLE4",46,0)
 .I SCNT=1 D DPH(SCNT,.SDD)
"RTN","SDWLE4",47,0)
 .D DPHD(SCNT,.SDD)
"RTN","SDWLE4",48,0)
 Q
"RTN","SDWLE4",49,0)
DPH(SCNT,SDD) ;display appt header
"RTN","SDWLE4",50,0)
 W !!,"Appointment(s) for: "_SDD(4)
"RTN","SDWLE4",51,0)
 W !?3,"Appt Date/Time",?23,"Clinic",?48,"Status",?60,"Institution",! N SDL S $P(SDL,"-",79)="" W SDL,!
"RTN","SDWLE4",52,0)
 Q
"RTN","SDWLE4",53,0)
DPHD(SCNT,SDD) ;
"RTN","SDWLE4",54,0)
 W !,SCNT,?3,SDD(1),?23,$E(SDD(2),1,23),?48,$E(SDD(3),1,10),?60,SDD(15)
"RTN","SDWLE4",55,0)
 Q 
"RTN","SDWLE6")
0^6^B70616317^n/a
"RTN","SDWLE6",1,0)
SDWLE6 ;;IOFO BAY PINES/OG - WAITING LIST-ENTER/EDIT - INTER-FACILITY TRANSFER  ; Compiled January 25, 2007 09:47:40
"RTN","SDWLE6",2,0)
 ;;5.3;scheduling;**446**;AUG 13 1993;Build 77
"RTN","SDWLE6",3,0)
 ;
"RTN","SDWLE6",4,0)
 ;  ******************************************************************
"RTN","SDWLE6",5,0)
 ;  CHANGE LOG
"RTN","SDWLE6",6,0)
 ;       
"RTN","SDWLE6",7,0)
 ;   DATE         PATCH    DESCRIPTION
"RTN","SDWLE6",8,0)
 ;   ----         -----    -----------
"RTN","SDWLE6",9,0)
 ;   
"RTN","SDWLE6",10,0)
 ;
"RTN","SDWLE6",11,0)
EN(SDWLDFN,SDWLERR) ; Entry Point
"RTN","SDWLE6",12,0)
 ; Extrinsic function. Quit back one of the following values
"RTN","SDWLE6",13,0)
 ;  0 : Inter-Facility Transfer not selected, continue with standard processing
"RTN","SDWLE6",14,0)
 ;  1 : Inter-Facility selected, all processing performed here, quit out on return.
"RTN","SDWLE6",15,0)
 ;  
"RTN","SDWLE6",16,0)
 ;  SDWLERR passed back by reference, indicates to the calling routine 
"RTN","SDWLE6",17,0)
 ;  whether to announce that the update to 409.3 was performed.
"RTN","SDWLE6",18,0)
 ;  
"RTN","SDWLE6",19,0)
 N ICN,SDWLIFTN,SDWLONSY,SDWLTY,SSN
"RTN","SDWLE6",20,0)
 S SDWLIFTN=0,SDWLERR=1,SDWLONSY=0
"RTN","SDWLE6",21,0)
 S ICN=$$GET1^DIQ(2,SDWLDFN,991.01),SSN=$$GET1^DIQ(2,SDWLDFN,.09)
"RTN","SDWLE6",22,0)
 I ICN'="",$D(^SDWL(409.36,"AICN",ICN)) S SDWLONSY=1
"RTN","SDWLE6",23,0)
 I SSN'="",$D(^SDWL(409.36,"SSN",SSN)) S SDWLONSY=1
"RTN","SDWLE6",24,0)
 D:SDWLONSY
"RTN","SDWLE6",25,0)
 .N DIR,SDWLARR,SDWLI,SDWLIFN0,SDWLILM,TMP
"RTN","SDWLE6",26,0)
 .S SDWLIFN0="",SDWLILM=23
"RTN","SDWLE6",27,0)
 .I ICN'="" F  S SDWLIFN0=$O(^SDWL(409.36,"AICN",ICN,SDWLIFN0)) Q:SDWLIFN0=""  S TMP(SDWLIFN0)=""
"RTN","SDWLE6",28,0)
 .I SSN'="" F  S SDWLIFN0=$O(^SDWL(409.36,"SSN",SSN,SDWLIFN0)) Q:SDWLIFN0=""  S TMP(SDWLIFN0)=""
"RTN","SDWLE6",29,0)
 .F  S SDWLIFN0=$O(TMP(SDWLIFN0)) Q:SDWLIFN0=""  D
"RTN","SDWLE6",30,0)
 ..N SDWLIL,SDWLINS,SDWLINSX,SDWLINX,TMP
"RTN","SDWLE6",31,0)
 ..D GETS^DIQ(409.36,SDWLIFN0_",",".1;1;4",,"TMP")
"RTN","SDWLE6",32,0)
 ..Q:"P"'[$E(TMP(409.36,SDWLIFN0_",",1))
"RTN","SDWLE6",33,0)
 ..S SDWLINS=TMP(409.36,SDWLIFN0_",",.1),SDWLINSX=$$GET1^DIQ(4,SDWLINS,.01)
"RTN","SDWLE6",34,0)
 ..S SDWLIL=$L(SDWLINSX) S:SDWLIL>SDWLILM SDWLILM=SDWLIL
"RTN","SDWLE6",35,0)
 ..S SDWLARR(0)=$G(SDWLARR(0))+1
"RTN","SDWLE6",36,0)
 ..S SDWLARR(SDWLARR(0),0)=SDWLINSX_U_TMP(409.36,SDWLIFN0_",",4)_U_SDWLIFN0_U_$$GET1^DIQ(4,SDWLINS,4,"I")
"RTN","SDWLE6",37,0)
 ..Q
"RTN","SDWLE6",38,0)
 .Q:'$D(SDWLARR)
"RTN","SDWLE6",39,0)
 .W !,"This patient has the following pending Inter-Facility Transfer entr"_$S(SDWLARR(0)=1:"y",1:"ies")_":"
"RTN","SDWLE6",40,0)
 .W !?5,"Requesting Facility",?SDWLILM+5,"Wait List Type"
"RTN","SDWLE6",41,0)
 .F SDWLI=1:1:SDWLARR(0) W !,SDWLI,?5,$P(SDWLARR(SDWLI,0),U),?SDWLILM+5,$P(SDWLARR(SDWLI,0),U,2)
"RTN","SDWLE6",42,0)
 .S DIR("A")="Enter a number"
"RTN","SDWLE6",43,0)
 .S DIR("A",1)="Select to associate this EWL entry with a transfer from the listed facility "
"RTN","SDWLE6",44,0)
 .S DIR("A",2)="or ^ to continue without selecting."
"RTN","SDWLE6",45,0)
 .S DIR(0)="N^1:"_SDWLARR(0) D ^DIR
"RTN","SDWLE6",46,0)
 .Q:Y="^"
"RTN","SDWLE6",47,0)
 .S SDWLIFTN=$P(SDWLARR(Y,0),U,3),SDWLTY=$P(SDWLARR(Y,0),U,2)
"RTN","SDWLE6",48,0)
 .Q
"RTN","SDWLE6",49,0)
 Q:'SDWLIFTN 0  ; Continue with normal EWL enter/edit.
"RTN","SDWLE6",50,0)
 D EN2(SDWLIFTN,SDWLDFN,SDWLTY)
"RTN","SDWLE6",51,0)
 Q 1  ; Return true: user chose to process transfer.
"RTN","SDWLE6",52,0)
 ;
"RTN","SDWLE6",53,0)
EN2(SDWLIFTN,SDWLDFN,SDWLTY) ; Entry point if transfer record is selected elsewhere.
"RTN","SDWLE6",54,0)
 N DFN,SDWLCM,SDWLCP1,SDWLCP2,SDWLCP3,SDWLCP4,SDWLCP5,SDWLCP6,SDWLDDA,SDWLIN,SDWLOPT,SDWLPCMM,SDWLPN,SDWLPOS,SDWLSCO,SDWLSPO,SDWLSSO,SDWLSTO,SDWLTEM,SDWLTM
"RTN","SDWLE6",55,0)
 I $G(SDWLDFN)="" W !,"Patient not entered on the system. Use Load/edit" S DIR(0)="E" D ^DIR Q
"RTN","SDWLE6",56,0)
 L +^SDWL(409.36,SDWLIFTN):1
"RTN","SDWLE6",57,0)
 I '$T W !,"Unable to acquire lock on transfer file" S DIR(0)="E" D ^DIR Q
"RTN","SDWLE6",58,0)
 S DFN=SDWLDFN D PCM^SDWLE1
"RTN","SDWLE6",59,0)
 ; Call each "P" subroutine for Wait List data items. Controlled by the value of SDWLOPT.
"RTN","SDWLE6",60,0)
 S SDWLOPT=1,(SDWLIN,SDWLTM,SDWLPN,SDWLDDA,SDWLCM)=""
"RTN","SDWLE6",61,0)
 F  D @("P"_SDWLOPT) Q:'SDWLOPT
"RTN","SDWLE6",62,0)
 L -^SDWL(409.36,SDWLIFTN)
"RTN","SDWLE6",63,0)
 Q
"RTN","SDWLE6",64,0)
 ;
"RTN","SDWLE6",65,0)
P1 ; Wait List Type
"RTN","SDWLE6",66,0)
 N DIR
"RTN","SDWLE6",67,0)
 S DIR(0)="SO^1:PCMM TEAM ASSIGNMENT;2:PCMM POSITION ASSIGNMENT"
"RTN","SDWLE6",68,0)
 S DIR("L",1)="     Select Wait List Type:"
"RTN","SDWLE6",69,0)
 S DIR("L",2)="     1. "_$P($P(DIR(0),U,2),":",2)
"RTN","SDWLE6",70,0)
 S DIR("L",3)="     2. "_$P($P(DIR(0),U,3),":",2)
"RTN","SDWLE6",71,0)
 I SDWLTY'="" S DIR("B")=SDWLTY
"RTN","SDWLE6",72,0)
 D ^DIR
"RTN","SDWLE6",73,0)
 I "^"[Y S SDWLOPT=0 Q
"RTN","SDWLE6",74,0)
 S SDWLTY=Y,SDWLOPT=SDWLOPT+1
"RTN","SDWLE6",75,0)
 Q
"RTN","SDWLE6",76,0)
 ;
"RTN","SDWLE6",77,0)
P2 ; Institution
"RTN","SDWLE6",78,0)
 N DIC,SDWLINL,SDWLTM
"RTN","SDWLE6",79,0)
 I SDWLTY=1 S DIC("S")="I $D(^SCTM(404.51,""AINST"",+Y))"
"RTN","SDWLE6",80,0)
 I SDWLTY=2 D
"RTN","SDWLE6",81,0)
 .N SDWLI
"RTN","SDWLE6",82,0)
 .I 'SDWLCP3 S SDWLI=0 F  S SDWLI=$O(^SCTM(404.57,SDWLI)) Q:'SDWLI  D
"RTN","SDWLE6",83,0)
 ..N SDWLL
"RTN","SDWLE6",84,0)
 ..S SDWLL=+$P($G(^SCTM(404.57,SDWLI,0)),U,2)
"RTN","SDWLE6",85,0)
 ..S SDWLINL=+$P($G(^SCTM(404.51,+SDWLL,0)),U,7)
"RTN","SDWLE6",86,0)
 ..S SDWLINL(SDWLINL)=""
"RTN","SDWLE6",87,0)
 ..Q
"RTN","SDWLE6",88,0)
 .S DIC("S")="I $D(SDWLINL(+Y))"
"RTN","SDWLE6",89,0)
 .Q
"RTN","SDWLE6",90,0)
 S DIC("S")=DIC("S")_",$$GET1^DIQ(4,+Y_"","",11,""I"")=""N"",$$TF^XUAF4(+Y)"
"RTN","SDWLE6",91,0)
 I SDWLIN'="" S DIC("B")=$$EXTERNAL^DILFD(4,.01,,SDWLIN)
"RTN","SDWLE6",92,0)
 S DIC(0)="AEQNM",DIC="4",DIC("A")="Select Institution: "
"RTN","SDWLE6",93,0)
 D ^DIC
"RTN","SDWLE6",94,0)
 I Y="^" S SDWLOPT=0 Q
"RTN","SDWLE6",95,0)
 I Y<1 S SDWLOPT=SDWLOPT-1 Q
"RTN","SDWLE6",96,0)
 I SDWLTY=1 D GETTEAMS(+Y,.SDWLTM) I '$D(SDWLTM) W !,"No TEAMS are available for this INSTITUTION." Q
"RTN","SDWLE6",97,0)
 S SDWLIN=+Y,SDWLOPT=SDWLOPT+1
"RTN","SDWLE6",98,0)
 Q
"RTN","SDWLE6",99,0)
 ;
"RTN","SDWLE6",100,0)
P3 ; Team or Team Position
"RTN","SDWLE6",101,0)
 N DIR,SDWLPNS
"RTN","SDWLE6",102,0)
 I $G(SDWLCP3)'="" D  I Y["^"!'Y S SDWLOPT=0 Q
"RTN","SDWLE6",103,0)
 .N DIR
"RTN","SDWLE6",104,0)
 .W !,"This patient is already on the ",SDWLCP3,"."
"RTN","SDWLE6",105,0)
 .S DIR(0)="Y^A0",DIR("B")="NO",DIR("A")="Are you sure you want to continue"
"RTN","SDWLE6",106,0)
 .D ^DIR
"RTN","SDWLE6",107,0)
 .Q
"RTN","SDWLE6",108,0)
 I SDWLTY=1 D  Q
"RTN","SDWLE6",109,0)
 .N DIR
"RTN","SDWLE6",110,0)
 .I $G(SDWLTM)'="" S DIR("B")=$$EXTERNAL^DILFD(404.58,.01,,SDWLTM)  ; Not sure this is ever true.
"RTN","SDWLE6",111,0)
 .D GETTEAMS(SDWLIN,.SDWLTM)
"RTN","SDWLE6",112,0)
 .S DIR(0)="PAO^SCTM(404.51,:EMNZ",DIR("A")="Select Team: "
"RTN","SDWLE6",113,0)
 .S DIR("S")="I $D(SDWLTM(+Y))"
"RTN","SDWLE6",114,0)
 .D ^DIR
"RTN","SDWLE6",115,0)
 .I Y="^" S SDWLOPT=0 Q
"RTN","SDWLE6",116,0)
 .I Y<1 S SDWLOPT=2 Q
"RTN","SDWLE6",117,0)
 .S SDWLTM=+Y,SDWLOPT=SDWLOPT+1
"RTN","SDWLE6",118,0)
 .Q
"RTN","SDWLE6",119,0)
 I $G(SDWLPN)'="" S DIR("B")=$$EXTERNAL^DILFD(404.57,.01,,SDWLPN)  ; Not sure this is ever true.
"RTN","SDWLE6",120,0)
 D GETPSNS(.SDWLPNS) I '$D(SDWLPNS) W !,"No Positions Meet Wait List Criteria" S SDWLOPT=1 Q
"RTN","SDWLE6",121,0)
 S DIR(0)="PAO^SCTM(404.57,:EMNZ",DIR("A")="Select Team Position: "
"RTN","SDWLE6",122,0)
 S DIR("S")="I $D(SDWLPNS(+Y))"
"RTN","SDWLE6",123,0)
 D ^DIR
"RTN","SDWLE6",124,0)
 I Y="^" S SDWLOPT=0 Q
"RTN","SDWLE6",125,0)
 I Y<1 S SDWLOPT=SDWLOPT-1 Q
"RTN","SDWLE6",126,0)
 S SDWLPN=+Y,SDWLOPT=SDWLOPT+1
"RTN","SDWLE6",127,0)
 Q
"RTN","SDWLE6",128,0)
 ;
"RTN","SDWLE6",129,0)
P4 ; Comment
"RTN","SDWLE6",130,0)
 N DIR
"RTN","SDWLE6",131,0)
 S DIR(0)="FAOU^^",DIR("A")="Comments: ",DIR("B")=SDWLCM
"RTN","SDWLE6",132,0)
 D ^DIR
"RTN","SDWLE6",133,0)
 I Y="^" S SDWLOPT=0 Q
"RTN","SDWLE6",134,0)
 I X="@" S SDWLOPT=SDWLOPT-1 Q
"RTN","SDWLE6",135,0)
 S SDWLCM=$E(Y,1,60),SDWLOPT=SDWLOPT+1
"RTN","SDWLE6",136,0)
 Q
"RTN","SDWLE6",137,0)
 ;
"RTN","SDWLE6",138,0)
P5 ; Update database
"RTN","SDWLE6",139,0)
 N DA,DIC,DIE,X,DR,SDWLDA,SDWLSCPE,SDWLSCPR,SDWLTMP
"RTN","SDWLE6",140,0)
 ; Create new EWL entry
"RTN","SDWLE6",141,0)
 S DIC(0)="LX",X=SDWLDFN,DIC="^SDWL(409.3," D FILE^DICN
"RTN","SDWLE6",142,0)
 L +^SDWL(409.3,DA):1  ; This file has just been created. Is it neurotic to code for the possibility of a lock from elsewhere?
"RTN","SDWLE6",143,0)
 I '$T W !,"Unable to acquire a lock on the Wait List file" S SDWLOPT=5 Q
"RTN","SDWLE6",144,0)
 ; Update EWL variables.
"RTN","SDWLE6",145,0)
 D GETS^DIQ(409.36,SDWLIFTN_",",".301;.302","I","SDWLTMP")
"RTN","SDWLE6",146,0)
 S SDWLSCPR=$G(SDWLTMP(409.36,SDWLIFTN_",",.301,"I"))="Y"
"RTN","SDWLE6",147,0)
 S SDWLSCPE=$G(SDWLTMP(409.36,SDWLIFTN_",",.302,"I"))
"RTN","SDWLE6",148,0)
 S SDWLDA=DA,DIE=DIC,DR="1////^S X=DT;2////^S X=SDWLIN;4////^S X=SDWLTY"
"RTN","SDWLE6",149,0)
 I SDWLTY=1 S DR=DR_";5////^S X=SDWLTM"
"RTN","SDWLE6",150,0)
 I SDWLTY=2 S DR=DR_";6////^S X=SDWLPN"
"RTN","SDWLE6",151,0)
 S DR=DR_";9////^S X=DUZ"
"RTN","SDWLE6",152,0)
 S DR=DR_";14////^S X=SDWLSCPE"
"RTN","SDWLE6",153,0)
 S DR=DR_";15////^S X=SDWLSCPR"
"RTN","SDWLE6",154,0)
 S DR=DR_";22////^S X=SDWLDDA"
"RTN","SDWLE6",155,0)
 S DR=DR_";23////O"
"RTN","SDWLE6",156,0)
 S DR=DR_";25////^S X=SDWLCM"
"RTN","SDWLE6",157,0)
 S DR=DR_";27////^S X="""_$$GETENRST^SDWLE6(SDWLDFN)_""""
"RTN","SDWLE6",158,0)
 D ^DIE
"RTN","SDWLE6",159,0)
 L -^SDWL(409.3,DA)
"RTN","SDWLE6",160,0)
 ; Update 409.36
"RTN","SDWLE6",161,0)
 S DIE="^SDWL(409.36,",DA=SDWLIFTN,DR="1////E;409.3////^S X=SDWLDA" D ^DIE
"RTN","SDWLE6",162,0)
 ; Pass message back to sending facility
"RTN","SDWLE6",163,0)
 D SENDST^SDWLIFT6(SDWLIFTN)
"RTN","SDWLE6",164,0)
 S SDWLOPT=0,SDWLERR=0
"RTN","SDWLE6",165,0)
 Q
"RTN","SDWLE6",166,0)
 ;
"RTN","SDWLE6",167,0)
GETTEAMS(SDWLIN,SDWLTM) ; Get teams for an institution ; NB this is reworking of code in SDWLE3.
"RTN","SDWLE6",168,0)
 N Y,SDWLST,SDWLINE,SDWLPLST,TMHSID K SDWLTM
"RTN","SDWLE6",169,0)
 S SDWLINE=SDWLIN
"RTN","SDWLE6",170,0)
 D GETLIST^SDWLE3
"RTN","SDWLE6",171,0)
 S TMHSID=""  ; Team history
"RTN","SDWLE6",172,0)
 F  S TMHSID=$O(^SCTM(404.58,"B",TMHSID)) Q:TMHSID=""  D:$P($G(^SCTM(404.51,TMHSID,0)),U,7)=SDWLIN
"RTN","SDWLE6",173,0)
 .N TMID  ; Team
"RTN","SDWLE6",174,0)
 .S TMID=$O(^SCTM(404.58,"B",TMHSID,":"),-1) Q:TMID=""
"RTN","SDWLE6",175,0)
 .Q:$D(SDWLPLST(1,TMID,SDWLIN))
"RTN","SDWLE6",176,0)
 .Q:$P($G(^SCTM(404.58,TMID,0)),U,3)=0
"RTN","SDWLE6",177,0)
 .Q:'$$ACTTM^SCMCTMU(TMID)
"RTN","SDWLE6",178,0)
 .I $$TEAMCNT^SCAPMCU1(TMHSID,DT)>$P($G(^SCTM(404.51,TMHSID,0)),U,8) S SDWLTM(TMHSID)=""
"RTN","SDWLE6",179,0)
 .Q
"RTN","SDWLE6",180,0)
 Q
"RTN","SDWLE6",181,0)
 ;
"RTN","SDWLE6",182,0)
GETPSNS(SDWLPN) ; Get positions ; NB this is reworking of code in SDWLE5.
"RTN","SDWLE6",183,0)
 N SDWLPSS,SDWLPDA,SDWLX,SDWLA,SDWLCPP,SDWLCPT K SDWLPN
"RTN","SDWLE6",184,0)
 D GETLIST^SDWLE5
"RTN","SDWLE6",185,0)
 Q:'$D(SDWLCPP)
"RTN","SDWLE6",186,0)
 S SDWLA=0
"RTN","SDWLE6",187,0)
 F  S SDWLA=$O(^SCTM(404.57,SDWLA)) Q:'SDWLA  D:$D(SDWLCPP(SDWLA))&'$D(SDWLPSS(SDWLA))
"RTN","SDWLE6",188,0)
 .N X
"RTN","SDWLE6",189,0)
 .S X=$G(^SCTM(404.57,SDWLA,0))
"RTN","SDWLE6",190,0)
 .Q:$P(X,U,2)'=SDWLCPT
"RTN","SDWLE6",191,0)
 .S:$P(X,U,8)'<$$PCPOSCNT^SCAPMCU1(SDWLA,DT,0)&$P(X,U,4) SDWLPN(SDWLA)=""
"RTN","SDWLE6",192,0)
 .Q
"RTN","SDWLE6",193,0)
 Q
"RTN","SDWLE6",194,0)
 ;
"RTN","SDWLE6",195,0)
GETENRST(SDWLDFN) ; Determine enrollee status ; NB this is reworking of code in SDWLE11.
"RTN","SDWLE6",196,0)
 N SDWLE
"RTN","SDWLE6",197,0)
 S SDWLE=1 D
"RTN","SDWLE6",198,0)
 .N SDWLX,SDWLY,%H
"RTN","SDWLE6",199,0)
 .I '$D(^DGCN(391.91,"B",SDWLDFN)) S SDWLE=3 Q
"RTN","SDWLE6",200,0)
 .; Loop backwards through the B cross reference of TREATING FACILITY LIST until there is a DATE LAST TREATED entry.
"RTN","SDWLE6",201,0)
 .; If that is less than 730 days ago, SDWLE=2; otherwise, SDWLE=3. Then quit from the loop.
"RTN","SDWLE6",202,0)
 .S SDWLX=""
"RTN","SDWLE6",203,0)
 .F  S SDWLX=$O(^DGCN(391.91,"B",SDWLDFN,SDWLX),-1) Q:SDWLX=""  S SDWLY=$G(^DGCN(391.91,SDWLX,0)) I $P(SDWLY,U,3) S X=$P(SDWLY,U,3) D H^%DTC S SDWLE=$H-%H'<730+2 Q
"RTN","SDWLE6",204,0)
 .Q
"RTN","SDWLE6",205,0)
 D:SDWLE'=2
"RTN","SDWLE6",206,0)
 .N SDWLRNE,%H
"RTN","SDWLE6",207,0)
 .S SDWLRNE=$$ENROLL^EASWTAPI(SDWLDFN)
"RTN","SDWLE6",208,0)
 .I $P(SDWLRNE,U,3) S X=$P(SDWLRNE,U,3) D H^%DTC S SDWLE=$H-%H>365*2+1  ; If number of days is greater than a year, SDWLE=3; otherwise, SDWLE=1.
"RTN","SDWLE6",209,0)
 .I 'SDWLRNE S SDWLE=4
"RTN","SDWLE6",210,0)
 .Q
"RTN","SDWLE6",211,0)
 Q $S(SDWLE=1:"N",SDWLE=2:"E",SDWLE=3:"P",SDWLE=4:"U")
"RTN","SDWLE6",212,0)
 ;
"RTN","SDWLE6",213,0)
DIS(SDWLDA) ; Action on disposition
"RTN","SDWLE6",214,0)
 N DIE,DR,SDWLDIS,SDWLIFTN,SDWLSTA,X
"RTN","SDWLE6",215,0)
 S SDWLIFTN=$O(^SDWL(409.36,"C",SDWLDA,"")) Q:'SDWLIFTN
"RTN","SDWLE6",216,0)
 S SDWLDIS=$$GET1^DIQ(409.3,SDWLDA,21,"I")
"RTN","SDWLE6",217,0)
 ; If disposition is because entered in error, reset to pending. Otherwise, set to closed.
"RTN","SDWLE6",218,0)
 S SDWLSTA=$S(SDWLDIS="ER":"P",1:"C")
"RTN","SDWLE6",219,0)
 S DIE="^SDWL(409.36,",DA=SDWLIFTN,DR="1///"_SDWLSTA D ^DIE
"RTN","SDWLE6",220,0)
 ; Pass message back to sending facility
"RTN","SDWLE6",221,0)
 D SENDST^SDWLIFT6(SDWLIFTN)
"RTN","SDWLE6",222,0)
 Q
"RTN","SDWLE7")
0^36^B15146200^n/a
"RTN","SDWLE7",1,0)
SDWLE7() ;;IOFO BAY PINES/OG - WAITING LIST-ENTER/EDIT - MOVE EWL ENTRY  ; Compiled August 14, 2007 11:18:43
"RTN","SDWLE7",2,0)
 ;;5.3;scheduling;**446**;AUG 13 1993;Build 77
"RTN","SDWLE7",3,0)
 ;
"RTN","SDWLE7",4,0)
 ;  ******************************************************************
"RTN","SDWLE7",5,0)
 ;  CHANGE LOG
"RTN","SDWLE7",6,0)
 ;       
"RTN","SDWLE7",7,0)
 ;   DATE         PATCH    DESCRIPTION
"RTN","SDWLE7",8,0)
 ;   ----         -----    -----------
"RTN","SDWLE7",9,0)
 ;   
"RTN","SDWLE7",10,0)
EN() ;
"RTN","SDWLE7",11,0)
 N SDWLERR,SDWLCM,SDWLIN1,SDWLOPT,SDWLSC1,SDWLSC1X
"RTN","SDWLE7",12,0)
 S (SDWLERR,SDWLOPT)=1,SDWLCM=""
"RTN","SDWLE7",13,0)
 F  D @("P"_SDWLOPT) Q:'SDWLOPT
"RTN","SDWLE7",14,0)
 Q SDWLERR
"RTN","SDWLE7",15,0)
 ;
"RTN","SDWLE7",16,0)
P1 ; Institution
"RTN","SDWLE7",17,0)
 S DIR(0)="PAO^DIC(4,:EMNZ"
"RTN","SDWLE7",18,0)
 S DIR("A")="Select Institution: "
"RTN","SDWLE7",19,0)
 S DIR("B")=$$GET1^DIQ(4,SDWLIN,.01)
"RTN","SDWLE7",20,0)
 S DIR("S")="I $E(+Y,1,3)=$E(SDWLIN,1,3)"
"RTN","SDWLE7",21,0)
 D ^DIR
"RTN","SDWLE7",22,0)
 I Y<1 S SDWLOPT=0 Q
"RTN","SDWLE7",23,0)
 S SDWLIN1=+Y,SDWLOPT=2
"RTN","SDWLE7",24,0)
 Q
"RTN","SDWLE7",25,0)
P2 ; Clinic
"RTN","SDWLE7",26,0)
 N DIR,Y,SDWLI,SDWLSTOP,SDWLSTP1,TMP
"RTN","SDWLE7",27,0)
 S DIR(0)="PAO^SDWL(409.32,:EMNZ",DIR("A")="Select Clinic: "
"RTN","SDWLE7",28,0)
 S DIR("S")="I +Y'=SDWLSC,$P(^SC($$GET1^DIQ(409.32,+Y,.01,""I""),0),U,4)=SDWLIN1"
"RTN","SDWLE7",29,0)
 D ^DIR
"RTN","SDWLE7",30,0)
 I Y="^" S SDWLOPT=0 Q
"RTN","SDWLE7",31,0)
 I Y<1 S SDWLOPT=1 Q
"RTN","SDWLE7",32,0)
 S SDWLSCL=+Y,SDWLSC1X=$$GET1^DIQ(409.32,SDWLSCL,.01)
"RTN","SDWLE7",33,0)
 S SDWLSTOP=$$GET1^DIQ(44,$$GET1^DIQ(409.32,SDWLSC,.01,"I"),8,"I")
"RTN","SDWLE7",34,0)
 S SDWLSTP1=$$GET1^DIQ(44,$$GET1^DIQ(409.32,SDWLSCL,.01,"I"),8,"I")
"RTN","SDWLE7",35,0)
 I SDWLSTOP=SDWLSTP1 S SDWLOPT=3 Q
"RTN","SDWLE7",36,0)
 K DIR
"RTN","SDWLE7",37,0)
 S DIR(0)="Y"
"RTN","SDWLE7",38,0)
 S TMP(0)=1,TMP(1,0)=$$GET1^DIQ(409.32,SDWLSC,.01)_" and "_SDWLSC1X_" have different stop codes."
"RTN","SDWLE7",39,0)
 D COL80^SDWLIFT(.TMP) F SDWLI=1:1:TMP(0) S DIR("A",SDWLI)=TMP(SDWLI,0)
"RTN","SDWLE7",40,0)
 S DIR("A")="Do you want to proceed?"
"RTN","SDWLE7",41,0)
 S DIR("B")="NO" D ^DIR
"RTN","SDWLE7",42,0)
 S SDWLOPT=Y*3  ; +Y=0: SDWLOPT=0; Y=1: SDWLOPT=3
"RTN","SDWLE7",43,0)
 Q
"RTN","SDWLE7",44,0)
 ;
"RTN","SDWLE7",45,0)
P3 ; Comment
"RTN","SDWLE7",46,0)
 D P4^SDWLE6
"RTN","SDWLE7",47,0)
 Q
"RTN","SDWLE7",48,0)
 ;
"RTN","SDWLE7",49,0)
P4 ; Display data and confirm.
"RTN","SDWLE7",50,0)
 N DIR,SDWLTMP,SDWLORDT,SDWLSCPG,SDWLSCPR,SDWLDDT,SDWLEEST,Y
"RTN","SDWLE7",51,0)
 D GETS^DIQ(409.3,SDWLDA_",","1;14;15;22;27","I","SDWLTMP")
"RTN","SDWLE7",52,0)
 S SDWLORDT=SDWLTMP(409.3,SDWLDA_",",1,"I")
"RTN","SDWLE7",53,0)
 S SDWLSCPG=SDWLTMP(409.3,SDWLDA_",",14,"I")
"RTN","SDWLE7",54,0)
 S SDWLSCPR=SDWLTMP(409.3,SDWLDA_",",15,"I")
"RTN","SDWLE7",55,0)
 S SDWLDDT=SDWLTMP(409.3,SDWLDA_",",22,"I")
"RTN","SDWLE7",56,0)
 S SDWLEEST=SDWLTMP(409.3,SDWLDA_",",27,"I")
"RTN","SDWLE7",57,0)
 S DIR(0)="Y"
"RTN","SDWLE7",58,0)
 S DIR("A",1)="The following EWL entry will be created"
"RTN","SDWLE7",59,0)
 S Y=SDWLORDT D DD^%DT
"RTN","SDWLE7",60,0)
 S DIR("A",2)="Originating Date: "_Y
"RTN","SDWLE7",61,0)
 S DIR("A",3)="Institution: "_$$GET1^DIQ(4,SDWLIN1,.01)
"RTN","SDWLE7",62,0)
 S DIR("A",4)="Wait List Type: SPECIFIC CLINIC"
"RTN","SDWLE7",63,0)
 S DIR("A",5)="Clinic: "_SDWLSC1X
"RTN","SDWLE7",64,0)
 S Y=SDWLDDT D DD^%DT
"RTN","SDWLE7",65,0)
 S DIR("A",6)="Desired Date of Appointment: "_Y
"RTN","SDWLE7",66,0)
 S DIR("A",7)="Comments: "_SDWLCM
"RTN","SDWLE7",67,0)
 S DIR("A")="Continue?"
"RTN","SDWLE7",68,0)
 S DIR("B")="YES"
"RTN","SDWLE7",69,0)
 D ^DIR
"RTN","SDWLE7",70,0)
 S SDWLOPT=0
"RTN","SDWLE7",71,0)
 Q:'Y
"RTN","SDWLE7",72,0)
 I '$$UPDATE(SDWLDFN,SDWLORDT,SDWLIN,SDWLSCL,SDWLSCPG,SDWLSCPR,SDWLDDT,SDWLCM,SDWLEEST,SDWLDA) S SDWLOPT=3
"RTN","SDWLE7",73,0)
 Q
"RTN","SDWLE7",74,0)
UPDATE(SDWLDFN,SDWLORDT,SDWLIN,SDWLSCL,SDWLSCPG,SDWLSCPR,SDWLDDT,SDWLCM,SDWLEEST,SDWLDA) ; Create new EWL entry
"RTN","SDWLE7",75,0)
 N DA,DIC,DIE,DR,X
"RTN","SDWLE7",76,0)
 S DIC(0)="LX",X=SDWLDFN,DIC="^SDWL(409.3," D FILE^DICN
"RTN","SDWLE7",77,0)
 L +^SDWL(409.3,DA):1  ; This file has just been created. Is it neurotic to code for the possibility of a lock from elsewhere?
"RTN","SDWLE7",78,0)
 I '$T W !,"Unable to acquire a lock on the Wait List file" Q 0
"RTN","SDWLE7",79,0)
 S DIE=DIC
"RTN","SDWLE7",80,0)
 S DR="1////^S X=SDWLORDT"
"RTN","SDWLE7",81,0)
 S DR=DR_";2////^S X=SDWLIN"
"RTN","SDWLE7",82,0)
 S DR=DR_";4////^S X=4"
"RTN","SDWLE7",83,0)
 S DR=DR_";8////^S X=SDWLSCL"
"RTN","SDWLE7",84,0)
 S DR=DR_";9////^S X=DUZ"
"RTN","SDWLE7",85,0)
 S DR=DR_";14////^S X=SDWLSCPG"
"RTN","SDWLE7",86,0)
 S DR=DR_";15////^S X=SDWLSCPR"
"RTN","SDWLE7",87,0)
 S DR=DR_";22////^S X=SDWLDDT"
"RTN","SDWLE7",88,0)
 S DR=DR_";23////^S X=""O"""
"RTN","SDWLE7",89,0)
 S DR=DR_";25////^S X=SDWLCM"
"RTN","SDWLE7",90,0)
 S DR=DR_";27////^S X=SDWLEEST"
"RTN","SDWLE7",91,0)
 S DR=DR_";37////^S X=SDWLDA"
"RTN","SDWLE7",92,0)
 D ^DIE
"RTN","SDWLE7",93,0)
 L -^SDWL(409.3,DA)
"RTN","SDWLE7",94,0)
 S SDWLERR=0
"RTN","SDWLE7",95,0)
 Q 1
"RTN","SDWLEC")
0^7^B20668345^n/a
"RTN","SDWLEC",1,0)
SDWLEC ;;IOFO BAY PINES/ESW - CLOSED WAITING LIST-EDIT;06/12/2002 ; 20 Aug 2002  2:10 PM  ; Compiled April 16, 2007 10:48:37
"RTN","SDWLEC",2,0)
 ;;5.3;scheduling;**446**;AUG 13 1993;Build 77
"RTN","SDWLEC",3,0)
 ;
"RTN","SDWLEC",4,0)
 ;modified SDWLE
"RTN","SDWLEC",5,0)
 ;******************************************************************
"RTN","SDWLEC",6,0)
 ;                             CHANGE LOG
"RTN","SDWLEC",7,0)
 ;                                               
"RTN","SDWLEC",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLEC",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLEC",10,0)
 ;   09JUN2005                   446                     Inter-Facility Transfer.
"RTN","SDWLEC",11,0)
 ;                                                       
"RTN","SDWLEC",12,0)
 ;   
"RTN","SDWLEC",13,0)
EN ;ENTRY POINT - INTIALIZE VARIABLES
"RTN","SDWLEC",14,0)
 N DTOUT,%,SDWLHDR,SDWLNAM,SDWLSSN,SDWLTEM,SDWLPOS,VADM,VA,X
"RTN","SDWLEC",15,0)
 I $D(SDWLOPT),SDWLOPT G OPT
"RTN","SDWLEC",16,0)
 I $D(SDWLLIST),SDWLLIST,$D(DFN),DFN<0 K SDWLLIST
"RTN","SDWLEC",17,0)
 I $D(SDWLLIST),SDWLLIST,$D(DFN),DFN'="" S SDWLDFN=DFN D 1^VADPT S (SDWLTEM,SDWLPOS)=0 D HD,SB1 G EN1:'$D(DUOUT) W !,"PATIENT: ",VADM(1),?40,VA("PID") W !,*7,"PATIENT'S DATE OF DEATH HAS BEEN RECORDED" S DIR(0)="E" D ^DIR G END
"RTN","SDWLEC",18,0)
 K ^TMP("SDWLD",$J) D HD
"RTN","SDWLEC",19,0)
 D PAT G END:DFN<0
"RTN","SDWLEC",20,0)
OPT ;
"RTN","SDWLEC",21,0)
 N SDWLDFN,SDWLNEW,SDWLERR,SDWLCN,SDWLWTE,SDWLPS
"RTN","SDWLEC",22,0)
 S SDWLDFN=DFN
"RTN","SDWLEC",23,0)
 D 1^VADPT
"RTN","SDWLEC",24,0)
 S (SDWLTEM,SDWLPOS)=0
"RTN","SDWLEC",25,0)
EN1 S SDWLNEW=0,SDWLERR=0,SDWLCN=0,SDWLWTE=0
"RTN","SDWLEC",26,0)
 D DIS
"RTN","SDWLEC",27,0)
 I $D(^SDWL(409.3,"B",DFN)),'SDWLCN W !!,"PATIENT: ",VADM(1),?40,VA("PID")
"RTN","SDWLEC",28,0)
 S SDWLPS=$S(SDWLCN>1:1,SDWLCN=1:2,1:3)
"RTN","SDWLEC",29,0)
 I $D(SDWLOPT),SDWLOPT,SDWLPS=3 S X="Y" G ENO
"RTN","SDWLEC",30,0)
 I SDWLPS=1 S DIR(0)="FOA^^" S DIR("A")="Select Wait List (1-"_SDWLCN_") or '^' to Quit ? ",DIR("?")="Enter a Valid Number or '^' to Quit."
"RTN","SDWLEC",31,0)
 I SDWLPS=2 S DIR(0)="FOA^^" S DIR("A")="Select Wait List (1) or '^' to Quit ? ",DIR("?")="Enter a '1' or '^' to Quit."
"RTN","SDWLEC",32,0)
 I SDWLPS=3 S DIR(0)="YAO^^S X=""Y""" S DIR("A")="No closed EWL entries for this range of dates. Do you wish to continue with this patient? Yes// "
"RTN","SDWLEC",33,0)
 W ! D ^DIR W ! K DIR
"RTN","SDWLEC",34,0)
 G END:$D(DUOUT),END:$D(DTOUT)
"RTN","SDWLEC",35,0)
 I SDWLPS=1 D  G END:SDWLERR=1 I SDWLERR=2 W *7," ??" G EN1
"RTN","SDWLEC",36,0)
 .S SDWLERR=$S(X="":2,X["^":1,$D(^TMP("SDWLD",$J,DFN,+X)):0,1:2) Q
"RTN","SDWLEC",37,0)
 I SDWLPS=2 D  G END:SDWLERR=1 I SDWLERR=2 W *7," ??" G EN1
"RTN","SDWLEC",38,0)
 .S SDWLERR=$S(X="":2,$D(DUOUT):1,X["^":1,$D(^TMP("SDWLD",$J,DFN,+X)):0,1:2) Q
"RTN","SDWLEC",39,0)
ENO I SDWLPS=3 D  G EN:SDWLERR=1 I SDWLERR=2 G EN1
"RTN","SDWLEC",40,0)
 .S SDWLERR=$S(X="":2,X?1"Y".E:2,X?1"y".E:2,$D(DUOUT):1,X["^":1,1:1)
"RTN","SDWLEC",41,0)
 .I SDWLERR=1 K DFN Q
"RTN","SDWLEC",42,0)
 N SDCAN I SDWLPS=1!(SDWLPS=2),X?1N.N D
"RTN","SDWLEC",43,0)
 .N DA
"RTN","SDWLEC",44,0)
 .S (DA,SDWLDA)=$P($G(^TMP("SDWLD",$J,DFN,+X)),"~",2),SDWLEDIT=""
"RTN","SDWLEC",45,0)
 .;
"RTN","SDWLEC",46,0)
 .;LOCK DATA FILE
"RTN","SDWLEC",47,0)
 .;
"RTN","SDWLEC",48,0)
 .L +^SDWL(409.3,SDWLDA):5 I '$T W !,"ANOTHER TERMINAL IS EDITING THIS ENTRY. TRY LATER." S DUOUT=1
"RTN","SDWLEC",49,0)
 .I $D(DUOUT) Q
"RTN","SDWLEC",50,0)
 .D EN^SDWLE10
"RTN","SDWLEC",51,0)
 .D EDITC(SDWLDA,.SDCAN) L -^SDWL(409.3,SDWLDA) S SDWLERR=1 K SDWLEDIT
"RTN","SDWLEC",52,0)
 .I SDCAN W !,"This process has been canceled."
"RTN","SDWLEC",53,0)
 .E  W !,"The requested entry has been opened."
"RTN","SDWLEC",54,0)
 D END
"RTN","SDWLEC",55,0)
 Q
"RTN","SDWLEC",56,0)
END ;
"RTN","SDWLEC",57,0)
 D EN^SDWLKIL
"RTN","SDWLEC",58,0)
 Q 
"RTN","SDWLEC",59,0)
 ;
"RTN","SDWLEC",60,0)
 ;
"RTN","SDWLEC",61,0)
PAT ;SELECT PATIENT
"RTN","SDWLEC",62,0)
 N DIC
"RTN","SDWLEC",63,0)
 S DIC(0)="EMNZAQ",DIC=2 D ^DIC S (SDWLDFN,DFN)=$P(Y,U,1) G PAT1:DFN<0
"RTN","SDWLEC",64,0)
 S X=$$GET1^DIQ(2,DFN_",",".351") I X'="" W !,*7,"PATIENT'S DATE OF DEATH HAS BEEN RECORDED" G PAT
"RTN","SDWLEC",65,0)
 S SDWLSSN=$G(VA("PID")),SDWLNAM=$G(VA(1))
"RTN","SDWLEC",66,0)
PAT1 K VADM,VAIN,VAERR,VA Q
"RTN","SDWLEC",67,0)
 ;
"RTN","SDWLEC",68,0)
DIS ;DISPLAY DATA FOR PATIENT
"RTN","SDWLEC",69,0)
 ;
"RTN","SDWLEC",70,0)
 S SDWLHDR="Wait List OPEN CLOSED ENTRY"
"RTN","SDWLEC",71,0)
 D EN^SDWLD(DFN,VA("PID"),VADM(1),"C")
"RTN","SDWLEC",72,0)
 D PCM^SDWLE1,PCMD^SDWLE1
"RTN","SDWLEC",73,0)
 Q
"RTN","SDWLEC",74,0)
 ;
"RTN","SDWLEC",75,0)
EDITC(SDWLDA,SDCAN) ;edit closed entry
"RTN","SDWLEC",76,0)
 N DA,DIE,DIR,DR,SDWLCM,Y
"RTN","SDWLEC",77,0)
 W !,"Reopen comment required to open this entry. Reopen reason: O - Other.",!
"RTN","SDWLEC",78,0)
 ; Reopen Comment
"RTN","SDWLEC",79,0)
 S Y=0,SDCAN=0
"RTN","SDWLEC",80,0)
 F  Q:$L(Y)>10!(Y="^")  S DIR(0)="FAOU^^",DIR("A")="Comments or '^' to cancel this process: ",DIR("B")="" D ^DIR D
"RTN","SDWLEC",81,0)
 .I $L(Y)<11 W !,"At least 10 char comment required" Q
"RTN","SDWLEC",82,0)
 .I X="^" Q
"RTN","SDWLEC",83,0)
 I Y="^" S SDCAN=1 Q
"RTN","SDWLEC",84,0)
 S SDWLCM=$E(Y,1,70)
"RTN","SDWLEC",85,0)
 S DIE="^SDWL(409.3,",DA=SDWLDA,DR="23////^S X=""O""" D ^DIE
"RTN","SDWLEC",86,0)
 S DR="28///^S X=$G(DUZ);29////^S X=""O""" D ^DIE ; REOPEN REASON - OTHER
"RTN","SDWLEC",87,0)
 S DR="19///@;20///@;21///@;30///^S X=SDWLCM" D ^DIE
"RTN","SDWLEC",88,0)
 S DR="13///@;13.1////@;13.2///@;13.3///@;13.4///@;13.5///@;13.6///@;13.8///@;13.7///@" D ^DIE ;SD/467
"RTN","SDWLEC",89,0)
 Q
"RTN","SDWLEC",90,0)
SB1 S X=$$GET1^DIQ(2,DFN_",",".351") I X'="" S DUOUT=""
"RTN","SDWLEC",91,0)
 Q
"RTN","SDWLEC",92,0)
HD W:$D(IOF) @IOF W !,?80-$L("Scheduling/PCMM Open Closed Wait Entry")\2,"Scheduling/PCMM Open Closed Wait List Entry",!!
"RTN","SDWLEC",93,0)
 I $D(DFN),DFN'="",'$D(^SDWL(409.3,"B",DFN)),$D(SDWLLIST),SDWLLIST D
"RTN","SDWLEC",94,0)
 .W !!,"PATIENT: ",VADM(1),?40,VA("PID")
"RTN","SDWLEC",95,0)
 Q
"RTN","SDWLEVAL")
0^8^B62921958^B83399202
"RTN","SDWLEVAL",1,0)
SDWLEVAL ;;IOFO BAY PINES/ESW - WAIT LIST - DISPOSITION AFTER APPOINTMENT(S) ENTRY;06/12/2002 ; 5/23/05 4:47pm  ; Compiled April 20, 2006 17:36:31  ; Compiled May 2, 2006 10:03:55  ; Compiled May 1, 2007 15:18:38
"RTN","SDWLEVAL",2,0)
 ;;5.3;Scheduling;**327,471,446**;AUG 13 1993;Build 77
"RTN","SDWLEVAL",3,0)
 ;Evaluate appt for optional disposition
"RTN","SDWLEVAL",4,0)
 ;called from SDMM, SDMM1, SDM1A, SDAM2 ; replaced SDWLR
"RTN","SDWLEVAL",5,0)
 ;
"RTN","SDWLEVAL",6,0)
EN(DFN,SDYN) ;evaluation if patient is on EWL
"RTN","SDWLEVAL",7,0)
 ; SDYN passed by reference
"RTN","SDWLEVAL",8,0)
 ;output: SDYN=0 -  no open entries in EWL
"RTN","SDWLEVAL",9,0)
 ;        SDYN=1 -  at least one open entry in EWL
"RTN","SDWLEVAL",10,0)
 S SDYN=0,SDYN(1)=""
"RTN","SDWLEVAL",11,0)
 I '$D(DFN)!(DFN'?1.N) S SDYN(1)="Patient's DFN not passed." Q
"RTN","SDWLEVAL",12,0)
 I $D(DFN),'$D(^SDWL(409.3,"B",DFN)) S SDYN(1)="This patient is not on EWL." Q
"RTN","SDWLEVAL",13,0)
 S SDWLDA="" F  S SDWLDA=$O(^SDWL(409.3,"B",DFN,SDWLDA)) Q:SDWLDA=""  D  Q:SDYN=1
"RTN","SDWLEVAL",14,0)
 .I $P($G(^SDWL(409.3,SDWLDA,0)),"^",17)="O" S SDYN=1,SDYN(1)="Patient has open Wait List entries."
"RTN","SDWLEVAL",15,0)
 I SDYN=0 S SDYN(1)="Patient has no open Wait List entries."
"RTN","SDWLEVAL",16,0)
 Q
"RTN","SDWLEVAL",17,0)
EWLANS(SDCONT) ;display EWL OPEN entries
"RTN","SDWLEVAL",18,0)
 ;check if to continue with EWL open entries
"RTN","SDWLEVAL",19,0)
 S SDCONT=0
"RTN","SDWLEVAL",20,0)
 N X,DIR,Y
"RTN","SDWLEVAL",21,0)
 S DIR("B")="NO"
"RTN","SDWLEVAL",22,0)
 S DIR("A")="Do you want to display open Wait list entries (Yes/No)?",DIR(0)="Y"
"RTN","SDWLEVAL",23,0)
 S DIR("?")="Do you want to review open EWL entries for Dispositioning?"
"RTN","SDWLEVAL",24,0)
 D ^DIR
"RTN","SDWLEVAL",25,0)
 I Y S SDCONT=1
"RTN","SDWLEVAL",26,0)
 Q
"RTN","SDWLEVAL",27,0)
ASKREM ;prompt user for record for dispositioning
"RTN","SDWLEVAL",28,0)
 S SDDIS=0 ; flag indicating disposition
"RTN","SDWLEVAL",29,0)
 W ! N X,DIR,Y
"RTN","SDWLEVAL",30,0)
 S DIR("B")="NO"
"RTN","SDWLEVAL",31,0)
 S DIR("A")="DO YOU WISH TO REMOVE ANY ENTRY FROM LIST (Yes/No)? ",DIR(0)="Y"
"RTN","SDWLEVAL",32,0)
 S DIR("?")="To disposition any entry based on scheduled appointments."
"RTN","SDWLEVAL",33,0)
 D ^DIR
"RTN","SDWLEVAL",34,0)
 I Y S SDDIS=1
"RTN","SDWLEVAL",35,0)
 D ANSW(SDDIS)
"RTN","SDWLEVAL",36,0)
 Q
"RTN","SDWLEVAL",37,0)
ANSW(SDDIS,SDR) ;
"RTN","SDWLEVAL",38,0)
 ;SDDIS=0 - select entries not to disposition
"RTN","SDWLEVAL",39,0)
 ;SDDIS=1 - select entries to disposition
"RTN","SDWLEVAL",40,0)
 N DIR,X I '$D(SDR) S SDR=0
"RTN","SDWLEVAL",41,0)
 W !
"RTN","SDWLEVAL",42,0)
 N STR,SS,SDCB S SDC=$O(^TMP($J,"SDWLPL",""),-1),SDCB=$O(^TMP($J,"SDWLPL",""))
"RTN","SDWLEVAL",43,0)
 ;I SDC=SDCB S DIR("B")=SDC
"RTN","SDWLEVAL",44,0)
 ;E  S DIR("B")=SDCB_"-"_SDC
"RTN","SDWLEVAL",45,0)
 S DIR(0)="L^"_SDCB_":"_SDC S DIR("A")="You must select one of the above EWL entries and then enter a non-removal reason: ",DIR("?")="Enter number(s) or range of displayed Wait List entries."
"RTN","SDWLEVAL",46,0)
 I SDDIS S DIR("A")="Select one of the above open EWL entries to close with an appointment or enter '^' to continue>"
"RTN","SDWLEVAL",47,0)
 D ^DIR
"RTN","SDWLEVAL",48,0)
 N SDAN S SDAN=X I SDAN="^" Q
"RTN","SDWLEVAL",49,0)
 I SDAN["-" D
"RTN","SDWLEVAL",50,0)
 .N SXB,SXE
"RTN","SDWLEVAL",51,0)
 .S SXB=$P(SDAN,"-"),SXE=$P(SDAN,"-",2) N SDC F SDC=SXB:1:SXE I $D(^TMP($J,"SDWLPL",SDC)) S SDWLDA=+^TMP($J,"SDWLPL",SDC) D
"RTN","SDWLEVAL",52,0)
 ..;LOCK
"RTN","SDWLEVAL",53,0)
 ..L +^SDWL(409.3,SDWLDA):5 I '$T W !,"Another User is Editing this Entry. Try Later." Q
"RTN","SDWLEVAL",54,0)
 ..I 'SDDIS N SDR F  D DISPO(SDWLDA,SDC,.SDR) Q:SDR
"RTN","SDWLEVAL",55,0)
 ..I SDDIS D GETDATA(SDWLDA) D DISEND(SDWLDA,SDC) S SDR=1
"RTN","SDWLEVAL",56,0)
 ..L
"RTN","SDWLEVAL",57,0)
 I SDAN[","!(SDAN?1N) D
"RTN","SDWLEVAL",58,0)
 .N FF S FF=SDAN N GG,SDC F GG=1:1 S SDC=$P(FF,",",GG) Q:SDC=""  I $D(^TMP($J,"SDWLPL",SDC)) S SDWLDA=+^TMP($J,"SDWLPL",SDC) D
"RTN","SDWLEVAL",59,0)
 ..;LOCK
"RTN","SDWLEVAL",60,0)
 ..L +^SDWL(409.3,SDWLDA):5 I '$T W !,"Another User is Editing this Entry. Try Later." Q
"RTN","SDWLEVAL",61,0)
 ..I 'SDDIS N SDR F  D DISPO(SDWLDA,SDC,.SDR) Q:SDR
"RTN","SDWLEVAL",62,0)
 ..I SDDIS D GETDATA(SDWLDA) D DISEND(SDWLDA,SDC) S SDR=1
"RTN","SDWLEVAL",63,0)
 ..L
"RTN","SDWLEVAL",64,0)
 Q
"RTN","SDWLEVAL",65,0)
DISEND(SDWLDA,SDC) ;display and disposition
"RTN","SDWLEVAL",66,0)
 ;SDWLDA - IEN of 409.3  
"RTN","SDWLEVAL",67,0)
 N DUOUT D EDIT(SDWLDA,SDC,.SDWLERR) Q:$G(DUOUT)  I SDWLERR Q
"RTN","SDWLEVAL",68,0)
 W !!,"*** Patient has been removed from Wait List ***",!
"RTN","SDWLEVAL",69,0)
 K ^TMP($J,"SDWLPL",SDC)
"RTN","SDWLEVAL",70,0)
 K DIR,DIE,DR,DIC
"RTN","SDWLEVAL",71,0)
 Q
"RTN","SDWLEVAL",72,0)
GETDATA(SDWLDA) ;retrieval data
"RTN","SDWLEVAL",73,0)
 N SDWLCL,SDWLDAPT,SDWLDATA,SDWLDISP,SDWLDUZ,SDWLEDT,SDWLIN,SDWLPRI,SDWLPROV,SDWLRB,SDWLSC,SDWLSP,SDWLST,SDWLTY
"RTN","SDWLEVAL",74,0)
 S SDWLDATA=$G(^SDWL(409.3,SDWLDA,0))
"RTN","SDWLEVAL",75,0)
 S SDWLIN=$P(SDWLDATA,U,3),SDWLCL=+$P(SDWLDATA,U,4),SDWLTY=$P(SDWLDATA,U,5),SDWLST=$P(SDWLDATA,U,6)
"RTN","SDWLEVAL",76,0)
 S SDWLSP=$P(SDWLDATA,U,7),SDWLSS=$P(SDWLDATA,U,8),SDWLSC=$P(SDWLDATA,U,9),SDWLPRI=$P(SDWLDATA,U,10),SDWLRB=$P(SDWLDATA,U,11)
"RTN","SDWLEVAL",77,0)
 S SDWLPROV=$P(SDWLDATA,U,12),SDWLDAPT=$P(SDWLDATA,U,16),SDWLST=$P(SDWLDATA,U,17),SDWLDUZ=DUZ,SDWLEDT=DT
"RTN","SDWLEVAL",78,0)
 S SDWLSCL="" I SDWLSC S SDWLSCL=+$P(^SDWL(409.32,SDWLSC,0),U,1)
"RTN","SDWLEVAL",79,0)
 I $D(^SDWL(409.3,SDWLDA,"DIS")) S SDWLDISP=$P(^SDWL(409.3,SDWLDA,"DIS"),U,3)
"RTN","SDWLEVAL",80,0)
 Q
"RTN","SDWLEVAL",81,0)
EDIT(SDWLDA,SDC,SDWLERR) ;ENTER/EDIT DISPOSITION
"RTN","SDWLEVAL",82,0)
 ;SDWLDA -IEN of selected 409.3 entry
"RTN","SDWLEVAL",83,0)
 ;SDWLERR - called by a reference
"RTN","SDWLEVAL",84,0)
 ;SDC - sequential number in ^TMP($J,"SDWLPL",SDC
"RTN","SDWLEVAL",85,0)
 S SDWLDUZ=DUZ,SDWLERR=0 S SDWLDISP="SA" D EDITSA Q  ;N DIR,DR,DIE,DIC
"RTN","SDWLEVAL",86,0)
EDITSA I SDWLDISP="SA" D
"RTN","SDWLEVAL",87,0)
 .I $O(^TMP($J,"APPT",""))=$O(^TMP($J,"APPT",""),-1) S SDAP=$O(^TMP($J,"APPT","")) Q
"RTN","SDWLEVAL",88,0)
 .I $O(^TMP($J,"APPT",""))'=$O(^TMP($J,"APPT",""),-1) D APPTD D  I SDAP="^" W !,"Disposition canceled by user",! Q
"RTN","SDWLEVAL",89,0)
 ..W ! K DIR,X
"RTN","SDWLEVAL",90,0)
 ..N STR,SS,SDA S SDA=$O(^TMP($J,"APPT",""),-1) I SDA=1 S DIR("B")=1
"RTN","SDWLEVAL",91,0)
 ..S DIR(0)="N^1:"_SDA S DIR("A")="Select appt for Removal Reason or '^' to Quit>",DIR("?")="Select Appointment to close with the open EWL."
"RTN","SDWLEVAL",92,0)
 ..D ^DIR
"RTN","SDWLEVAL",93,0)
 ..S SDAP=X
"RTN","SDWLEVAL",94,0)
 S DIE="^SDWL(409.3,",DA=SDWLDA,DR="21////^S X=SDWLDISP" D ^DIE
"RTN","SDWLEVAL",95,0)
 S DR="19////^S X=DT" D ^DIE
"RTN","SDWLEVAL",96,0)
 S DR="20////^S X=SDWLDUZ" D ^DIE
"RTN","SDWLEVAL",97,0)
 S DR="23////^S X=""C""" D ^DIE
"RTN","SDWLEVAL",98,0)
 ;if "SA" update with appoint data
"RTN","SDWLEVAL",99,0)
 ;get appt data to file (for a particular appt #)
"RTN","SDWLEVAL",100,0)
 I SDWLDISP="SA" N SDA D DATP(SDAP,.SDA) D
"RTN","SDWLEVAL",101,0)
 .I $D(SDA) S DIE="^SDWL(409.3,",DA=SDWLDA D
"RTN","SDWLEVAL",102,0)
 ..S DR="13////"_SDA(1)_";13.1////"_DT_";13.2////"_SDA(2)_";13.3////"_SDA(15)_";13.4////"_SDA(13)_";13.5////"_SDA(14)_";13.6////"_SDA(16)_";13.8////"_SDA(3)_";13.7////"_DUZ
"RTN","SDWLEVAL",103,0)
 ..D ^DIE
"RTN","SDWLEVAL",104,0)
 N SDWLSCL,SDWLSS,SDWLDFN
"RTN","SDWLEVAL",105,0)
 S SDWLSCL=$P($G(^TMP($J,"SDWLPL",SDC)),U,9)
"RTN","SDWLEVAL",106,0)
 S SDWLSS=$P($G(^TMP($J,"SDWLPL",SDC)),U,10)
"RTN","SDWLEVAL",107,0)
 I SDWLSCL K:$D(^SDWL(409.3,"SC",SDWLSCL,SDWLDA)) ^SDWL(409.3,"SC",SDWLSCL,SDWLDA)
"RTN","SDWLEVAL",108,0)
 S SDWLDFN=$P($G(^TMP($J,"APPT",1)),U,4)
"RTN","SDWLEVAL",109,0)
 I SDWLSS,SDWLDFN K:$D(^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLDA)) ^SDWL(409.3,"SS",SDWLDFN,SDWLSS,SDWLDA)
"RTN","SDWLEVAL",110,0)
 Q
"RTN","SDWLEVAL",111,0)
DISPO(SDWLDA,SDC,SDR) ;
"RTN","SDWLEVAL",112,0)
 ;SDWLDA - IEN of 409.3
"RTN","SDWLEVAL",113,0)
 ;SDC - seq in ^TMP($J,"SDWLPL",SDC
"RTN","SDWLEVAL",114,0)
 ;out SDR - NON REMOVAL:
"RTN","SDWLEVAL",115,0)
 ; 1 entered
"RTN","SDWLEVAL",116,0)
 ; 0 not entered
"RTN","SDWLEVAL",117,0)
 K DIR,X S SDR=0
"RTN","SDWLEVAL",118,0)
 S DIR(0)="SM^1:APPOINTMENT CRITERIA NOT MET;2:PATIENT WANTS ANOTHER APPOINTMENT;3:PROVIDER WANTS ANOTHER APPOINTMENT;4:OTHER"
"RTN","SDWLEVAL",119,0)
 S DIR("L",1)="SELECT ONE OF THE FOLLOWING REASONS FOR # "_SDC_":",DIR("L",2)=""
"RTN","SDWLEVAL",120,0)
 S DIR("L",3)="1. APPOINTMENT CRITERIA NOT MET",DIR("L",4)="2. PATIENT WANTS ANOTHER APPOINTMENT"
"RTN","SDWLEVAL",121,0)
 S DIR("L",5)="3. PROVIDER WANTS ANOTHER APPOINTMENT",DIR("L,6")="4. OTHER"
"RTN","SDWLEVAL",122,0)
 S DIR("A")="Select one of the following reasons for #: "_SDC
"RTN","SDWLEVAL",123,0)
 D ^DIR
"RTN","SDWLEVAL",124,0)
 S X=$E(X,1,2) S:$E(X,2)'="R" X=$E(X)
"RTN","SDWLEVAL",125,0)
 S SDWLX=$S(X="a":"A",X="p":"P",X="pr":"PR",X="o":"O",X="A":"A",X="P":"P",X="PR":"PR",X="O":"O",X=1:"A",X=2:"P",X=3:"PR",X=4:"O",1:"^")
"RTN","SDWLEVAL",126,0)
 I SDWLX="^" Q
"RTN","SDWLEVAL",127,0)
 S SDR=1
"RTN","SDWLEVAL",128,0)
 I SDWLX="O" D
"RTN","SDWLEVAL",129,0)
 .S DIR(0)="FAO^^",DIR("A")="Comments: " D ^DIR Q:X["^"
"RTN","SDWLEVAL",130,0)
 .S SDWLCOM=X,DA=SDWLDA,DIE="^SDWL(409.3,",DR="18.1////^S X=SDWLCOM" D ^DIE
"RTN","SDWLEVAL",131,0)
 N DA S DA=SDWLDA
"RTN","SDWLEVAL",132,0)
 S DIE="^SDWL(409.3,",DR="18////^S X=SDWLX" D ^DIE
"RTN","SDWLEVAL",133,0)
 S DR="17////^S X=DUZ" D ^DIE
"RTN","SDWLEVAL",134,0)
 S DR="16////^S X=DT" D ^DIE
"RTN","SDWLEVAL",135,0)
 K SDWLERR,DIR,DR,DIE,X,SDWLX,SDWLDSS,SDWLASK,SDWLDA,SDWLCOM
"RTN","SDWLEVAL",136,0)
 K ^TMP($J,"SDWLPL",SDC)
"RTN","SDWLEVAL",137,0)
 Q
"RTN","SDWLEVAL",138,0)
HD ;HEADER
"RTN","SDWLEVAL",139,0)
 W:$D(IOF) @IOF W !!,?80-$L("Wait List - Disposition Patient")\2,"Wait List - Disposition Patient",!!
"RTN","SDWLEVAL",140,0)
 Q
"RTN","SDWLEVAL",141,0)
APPT(DFN,SD,SC) ;create appt TMP
"RTN","SDWLEVAL",142,0)
 ;SD - appt date/time
"RTN","SDWLEVAL",143,0)
 ;SC - clinic IEN
"RTN","SDWLEVAL",144,0)
 N SDARR,SCNT
"RTN","SDWLEVAL",145,0)
 S SDDIV=""
"RTN","SDWLEVAL",146,0)
 S SDARR(1)=SD_";"_SD
"RTN","SDWLEVAL",147,0)
 S SDARR(2)=SC
"RTN","SDWLEVAL",148,0)
 S SDARR(4)=DFN
"RTN","SDWLEVAL",149,0)
 S SDARR("FLDS")="1;2;3;4;10;13;14;17"
"RTN","SDWLEVAL",150,0)
 N SAPP S SAPP=$$SDAPI^SDAMA301(.SDARR) D
"RTN","SDWLEVAL",151,0)
 .N SDINST,SDFAC,SDINSTE
"RTN","SDWLEVAL",152,0)
 .Q:'$D(^TMP($J,"SDAMA301",DFN))
"RTN","SDWLEVAL",153,0)
 .S SCNT=$O(^TMP($J,"APPT",""),-1)+1
"RTN","SDWLEVAL",154,0)
 .S ^TMP($J,"APPT",SCNT)=^TMP($J,"SDAMA301",DFN,SC,SD)
"RTN","SDWLEVAL",155,0)
 .N SDCLIN S SDCLIN=$$CLIN^SDWLBACC(SC),SDINST=$P(SDCLIN,U),SDFAC=$P(SDCLIN,U,2),SDINSTE=$P(SDCLIN,U,3)
"RTN","SDWLEVAL",156,0)
 .S $P(^TMP($J,"APPT",SCNT),"^",15)=SDINST_";"_SDINSTE
"RTN","SDWLEVAL",157,0)
 .S $P(^TMP($J,"APPT",SCNT),"^",16)=SDFAC
"RTN","SDWLEVAL",158,0)
 .K ^TMP($J,"SDAMA301",DFN,SC,SD)
"RTN","SDWLEVAL",159,0)
 Q
"RTN","SDWLEVAL",160,0)
APPTD ;display appt
"RTN","SDWLEVAL",161,0)
 ;from ^TMP($J,"APPT")
"RTN","SDWLEVAL",162,0)
 N STR,SCNT
"RTN","SDWLEVAL",163,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDWLEVAL",164,0)
 S SCNT="" F  S SCNT=$O(^TMP($J,"APPT",SCNT)) Q:SCNT=""  D
"RTN","SDWLEVAL",165,0)
 .S STR=^TMP($J,"APPT",SCNT)
"RTN","SDWLEVAL",166,0)
 .N ZZ F ZZ=2,3,4,10,15 S SDD(ZZ)=$P($P(STR,"^",ZZ),";",2)
"RTN","SDWLEVAL",167,0)
 .N SD S SD=$P(STR,U) D  S Y=SD D D^DIQ S SDD(1)=Y ; date conv
"RTN","SDWLEVAL",168,0)
 ..I SDD(3)="SCHEDULED/KEPT" S SDD(3)=";"_$S(SD<DT:"KEPT",1:"SCHEDULED")
"RTN","SDWLEVAL",169,0)
 .S SDD(16)=$P(STR,U,16)
"RTN","SDWLEVAL",170,0)
 .N CP,ZZ F ZZ=13,14 S CP(ZZ)=$P($P(STR,U,ZZ),";") D
"RTN","SDWLEVAL",171,0)
 ..S SDD(ZZ)=""
"RTN","SDWLEVAL",172,0)
 ..I CP(ZZ)>0 S SDD(ZZ)=$$GET1^DIQ(40.7,CP(ZZ)_",",.01,"I") ; stop code desc
"RTN","SDWLEVAL",173,0)
 .;DISPLAY
"RTN","SDWLEVAL",174,0)
 .I SCNT=1 D DPH(SCNT,.SDD)
"RTN","SDWLEVAL",175,0)
 .D DPHD(SCNT,.SDD)
"RTN","SDWLEVAL",176,0)
 W !
"RTN","SDWLEVAL",177,0)
 Q
"RTN","SDWLEVAL",178,0)
DATP(SCNT,SDA) ;
"RTN","SDWLEVAL",179,0)
 ;SDA - to return APPT array
"RTN","SDWLEVAL",180,0)
 S STR=^TMP($J,"APPT",SCNT)
"RTN","SDWLEVAL",181,0)
 S SDA(1)=$P(STR,U)
"RTN","SDWLEVAL",182,0)
 N ZZ F ZZ=2,3,10,13,14,15 S SDA(ZZ)=$P($P(STR,"^",ZZ),";",1)
"RTN","SDWLEVAL",183,0)
 S SDA(16)=$P(STR,"^",16) ;station
"RTN","SDWLEVAL",184,0)
 Q
"RTN","SDWLEVAL",185,0)
DPH(SCNT,SDD) ;display appt header
"RTN","SDWLEVAL",186,0)
 W !!,"Appointment(s) for: "_SDD(4) W !!?4,"Specialty: "_SDD(13),?60,"Station: ",SDD(16),!
"RTN","SDWLEVAL",187,0)
 W !?3,"Appt Date/Time",?23,"Clinic",?48,"Status",?60,"Institution",! N SDL S $P(SDL,"-",79)="" W SDL,!
"RTN","SDWLEVAL",188,0)
 Q
"RTN","SDWLEVAL",189,0)
DPHD(SCNT,SDD) ;
"RTN","SDWLEVAL",190,0)
 W !,SCNT,?3,SDD(1),?23,$E(SDD(2),1,23),?48,$E(SDD(10),1,10),?60,SDD(15)
"RTN","SDWLEVAL",191,0)
 Q
"RTN","SDWLI")
0^2^B70108876^B52231226
"RTN","SDWLI",1,0)
SDWLI ;IOFO BAY PINES/TEH - DISPLAY PENDING APPOINTMENTS ; 6/1/05 12:56pm  ; Compiled April 16, 2007 10:00:47
"RTN","SDWLI",2,0)
 ;;5.3;scheduling;**263,327,394,446**;AUG 13 1993;Build 77
"RTN","SDWLI",3,0)
 ;
"RTN","SDWLI",4,0)
 ;
"RTN","SDWLI",5,0)
 ;******************************************************************
"RTN","SDWLI",6,0)
 ;                             CHANGE LOG
"RTN","SDWLI",7,0)
 ;                                               
"RTN","SDWLI",8,0)
 ;   DATE               PATCH          DESCRIPTION
"RTN","SDWLI",9,0)
 ;   ----             -----             -----------
"RTN","SDWLI",10,0)
 ;   04/22/2005      SD*5.3*327  DISPLAY APPOINTMENT INFORMATION
"RTN","SDWLI",11,0)
 ;   04/22/2005      SD*5.3*327  UNDEFINED ERROR HD+1
"RTN","SDWLI",12,0)
 ;   08/07/2006      SD*5.3*446  proceed only when DFN defined
"RTN","SDWLI",13,0)
 ;   04/14/2006      SD*5.3*446  INTER-FACILITY TRANSFER
"RTN","SDWLI",14,0)
 ;
"RTN","SDWLI",15,0)
 ;
"RTN","SDWLI",16,0)
EN ;NEW AND INITIALIZE VARIABLES
"RTN","SDWLI",17,0)
 S SDWLERR=0
"RTN","SDWLI",18,0)
 I $D(SDWLLIST),SDWLLIST D  Q:SDWLERR
"RTN","SDWLI",19,0)
 .I '$G(DFN) S SDWLERR=1 Q
"RTN","SDWLI",20,0)
 .I $D(DFN),DFN'="",'$D(^SDWL(409.3,"B",DFN)) D HD W *7,!,"This Patient has NO entries on the Electronic Wait List." S DIR(0)="E" D ^DIR S DUOUT=1 Q
"RTN","SDWLI",21,0)
 I $D(DUOUT) G END
"RTN","SDWLI",22,0)
 I 'SDWLERR,$D(SDWLLIST),SDWLLIST D 1^VADPT,DEM^VADPT S SDWLDFN=DFN D HD K DIR,DIC,DR,DIE,VADM S (SDWLBDT,SDWLEDT)="" K ^TMP("SDWLI",$J) G EN1
"RTN","SDWLI",23,0)
 K DIR,DIC,DR,DIE,VADM
"RTN","SDWLI",24,0)
 S (SDWLBDT,SDWLEDT)="" K ^TMP("SDWLI",$J)
"RTN","SDWLI",25,0)
 ;
"RTN","SDWLI",26,0)
 ;OPTION HEADER
"RTN","SDWLI",27,0)
 ;
"RTN","SDWLI",28,0)
 D HD
"RTN","SDWLI",29,0)
 ;
"RTN","SDWLI",30,0)
 ;PATIENT LOOK-UP FROM WAIT LIST PATIENT FILE (^SDWL(409.3,IEN,0).
"RTN","SDWLI",31,0)
 ;
"RTN","SDWLI",32,0)
 D PAT Q:'$D(SDWLDFN)
"RTN","SDWLI",33,0)
 G END:SDWLDFN<0,END:SDWLDFN=""
"RTN","SDWLI",34,0)
 Q:$D(DUOUT)
"RTN","SDWLI",35,0)
EN1 K DIR,DIC,DR,DIE,SDWLDRG
"RTN","SDWLI",36,0)
 D SEL G EN:$D(DUOUT)
"RTN","SDWLI",37,0)
 D GETFILE
"RTN","SDWLI",38,0)
 D DISP G EN:'$D(DUOUT)
"RTN","SDWLI",39,0)
 D END
"RTN","SDWLI",40,0)
 Q
"RTN","SDWLI",41,0)
PAT ;PATIENT LOOK-UP
"RTN","SDWLI",42,0)
 S DIC(0)="EMNQA",DIC=409.3 D ^DIC S (SDWLDFN,DFN)=$P(Y,U,2)
"RTN","SDWLI",43,0)
 G PATEND:SDWLDFN=""
"RTN","SDWLI",44,0)
 Q:Y<0
"RTN","SDWLI",45,0)
 Q:$D(DUOUT)
"RTN","SDWLI",46,0)
 D 1^VADPT
"RTN","SDWLI",47,0)
PATEND Q
"RTN","SDWLI",48,0)
 ;
"RTN","SDWLI",49,0)
 ;PROMPT FOR DISPLAY 'OPEN' WAITING LIST ONLY OR PROMPT FOR BEGINNING AND ENDING DATES
"RTN","SDWLI",50,0)
 ;
"RTN","SDWLI",51,0)
SEL K SDWLDRG S DIR(0)="YAO^^" S DIR("A")="Do You Want to View Only 'OPEN' Wait Lists? Yes// "
"RTN","SDWLI",52,0)
 S DIR("?")="'Yes' for 'Open' and these Patient Record have not been dispositioned and 'No' for all Records."
"RTN","SDWLI",53,0)
 W ! D ^DIR S SDWLY=Y W !
"RTN","SDWLI",54,0)
 I X["^" S DUOUT=1
"RTN","SDWLI",55,0)
 I SDWLY=0 D SEL1
"RTN","SDWLI",56,0)
 Q
"RTN","SDWLI",57,0)
SEL1 K DIR,%DT(0) S SDWLDISC="",%DT="AE",%DT("A")="Start with Date Entered: " D ^%DT G SEL:Y<1 S SDWLBDT=Y
"RTN","SDWLI",58,0)
 S %DT(0)=SDWLBDT,%DT("A")="End with Date Entered: " D ^%DT G SEL1:Y<1 S SDWLEDT=Y,SDWLDRG="" K %DT(0),%DT("A")
"RTN","SDWLI",59,0)
 Q
"RTN","SDWLI",60,0)
 ;
"RTN","SDWLI",61,0)
GETFILE ;GET DATA - OPTIONAL DATE RANGE IF SDWLDBT AND SDWLEDT VALID DATE RANGE
"RTN","SDWLI",62,0)
 ;
"RTN","SDWLI",63,0)
 K ^TMP("SDWLI",$J),SDWLDISX S SDWLDA=0,SDWLCNT=0 F  S SDWLDA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA)) Q:SDWLDA=""  D
"RTN","SDWLI",64,0)
 .S SDWLDATA=$G(^SDWL(409.3,SDWLDA,0)) I '$D(SDWLDRG),$P(SDWLDATA,U,17)["C" Q
"RTN","SDWLI",65,0)
 .I '$P(SDWLDATA,U,3) Q
"RTN","SDWLI",66,0)
 .N SDWLAPP S SDWLAPP="" I $D(^SDWL(409.3,SDWLDA,"SDAPT")) S SDWLAPP=^("SDAPT") D  ;app data
"RTN","SDWLI",67,0)
 ..S SDWLAPP=SDWLAPP_"~"_$P(SDWLDATA,U,23)
"RTN","SDWLI",68,0)
 .N SDOP,SDOP1 S SDOP="" I $D(^SDWL(409.3,SDWLDA,1)) S SDOP=^(1),SDOP1=$$GET1^DIQ(409.3,SDWLDA_",",29),$P(SDOP,U)=SDOP1
"RTN","SDWLI",69,0)
 .I $D(^SDWL(409.3,SDWLDA,"DIS")) D
"RTN","SDWLI",70,0)
 ..S SDWLDISX=$G(^SDWL(409.3,SDWLDA,"DIS")),SDWLDIS=$P(SDWLDISX,U,3),SDWLDDUZ=$P(SDWLDISX,U,2)
"RTN","SDWLI",71,0)
 ..S SDWLDDT=$P(^SDWL(409.3,SDWLDA,"DIS"),U,1)
"RTN","SDWLI",72,0)
 ..S SDWLDIDT="" I SDWLDDT'="" S SDWLDIDT=$E(SDWLDDT,4,5)_"/"_$E(SDWLDDT,6,7)_"/"_$E(SDWLDDT,2,3)
"RTN","SDWLI",73,0)
 .I $D(^SDWL(409.3,SDWLDA,"DNR")) D
"RTN","SDWLI",74,0)
 ..S SDREM=$G(^SDWL(409.3,SDWLDA,"DNR")) S SDREMD=$P(SDWLDATA,U,14),SDREMU=$P(SDWLDATA,U,15)
"RTN","SDWLI",75,0)
 ..S SDREMDD="" I SDREMD'="" S SDREMDD=$E(SDREMD,4,5)_"/"_$E(SDREMD,6,7)_"/"_$E(SDREMD,2,3)
"RTN","SDWLI",76,0)
 ..S SDREMR=$$GET1^DIQ(409.3,SDWLDA_",",18),SDREMRC=$$GET1^DIQ(409.3,SDWLDA_",",18.1,"I")
"RTN","SDWLI",77,0)
 .S SDWLST=$P(SDWLDATA,U,6),SDWLSP=$P(SDWLDATA,U,7),SDWLSS=$P(SDWLDATA,U,8),SDWLSC=$P(SDWLDATA,U,9),SDWLDT=$P(SDWLDATA,U,2)
"RTN","SDWLI",78,0)
 .S SDWLPROV=$P(SDWLDATA,U,13) I $D(SDWLDRG) D  I SDNOK Q
"RTN","SDWLI",79,0)
 ..S SDNOK=0
"RTN","SDWLI",80,0)
 ..I SDWLDT<SDWLBDT!(SDWLDT>SDWLEDT) S SDNOK=1 Q
"RTN","SDWLI",81,0)
 .;
"RTN","SDWLI",82,0)
 .;IF STATUS IS CLOSED DO NOT DISPLAY RECORD
"RTN","SDWLI",83,0)
 .;
"RTN","SDWLI",84,0)
 .S SDWLCNT=SDWLCNT+1,^TMP("SDWLI",$J,SDWLCNT)=SDWLDATA_"~"_SDWLDA
"RTN","SDWLI",85,0)
 .I $D(SDWLDISX) D 
"RTN","SDWLI",86,0)
 ..S ^TMP("SDWLI",$J,SDWLCNT,"DIS")=SDWLDIS_"^"_SDWLDDUZ_"^"_SDWLDIDT
"RTN","SDWLI",87,0)
 ..I SDWLAPP>0 S ^TMP("SDWLI",$J,SDWLCNT,"SDAPT")=SDWLAPP
"RTN","SDWLI",88,0)
 ..I SDOP'="" S ^TMP("SDWLI",$J,SDWLCNT,"SDOP")=SDOP
"RTN","SDWLI",89,0)
 .I $D(SDREM) D
"RTN","SDWLI",90,0)
 ..S ^TMP("SDWLI",$J,SDWLCNT,"REM")=SDREMR_U_SDREMRC_U_SDREMU_U_SDREMDD
"RTN","SDWLI",91,0)
 .S ^TMP("SDWLI",$J)=SDWLCNT
"RTN","SDWLI",92,0)
 .K SDWLDISX,SDREM
"RTN","SDWLI",93,0)
 Q
"RTN","SDWLI",94,0)
 ;
"RTN","SDWLI",95,0)
DISP ;Display Wait List Data
"RTN","SDWLI",96,0)
 S (SDWLDT,SDWLCNT,SDWLCN)="",SDWLCT=$G(^TMP("SDWLI",$J)) I 'SDWLCT W !!,"No 'OPEN' Wait List Records to Display.",!! K DIR S DIR(0)="E" D ^DIR S DUOUT="" Q
"RTN","SDWLI",97,0)
 F  S SDWLCNT=$O(^TMP("SDWLI",$J,SDWLCNT)) Q:SDWLCNT=""  D  I $D(DUOUT) Q
"RTN","SDWLI",98,0)
 .N SDWLDISX,SDWLR,SDWLCLPT
"RTN","SDWLI",99,0)
 .I $D(^TMP("SDWLI",$J,SDWLCNT,"DIS")) S SDWLDISX=$G(^TMP("SDWLI",$J,SDWLCNT,"DIS"))
"RTN","SDWLI",100,0)
 .I $D(^TMP("SDWLI",$J,SDWLCNT,"REM")) S SDWLR=$G(^TMP("SDWLI",$J,SDWLCNT,"REM")) D
"RTN","SDWLI",101,0)
 ..S SDREMR=$P(SDWLR,U),SDREMRC=$P(SDWLR,U,2),SDREMU=$P(SDWLR,U,3),SDREMDD=$P(SDWLR,U,4)
"RTN","SDWLI",102,0)
 .S X=$G(^TMP("SDWLI",$J,SDWLCNT)),SDWLDA=$P(X,"~",2),SDWLIN=$P(X,U,3),SDWLCL=$P(X,U,4),SDWLTY=$P(X,U,5),SDWLPRI=$P(X,U,11)
"RTN","SDWLI",103,0)
 .S SDWLTYP=$S(SDWLTY=1:$P(X,U,6),SDWLTY=2:$P(X,U,7),SDWLTY=3:$P(X,U,8),SDWLTY=4:$P(X,U,9),1:"")
"RTN","SDWLI",104,0)
 .S SDWLTYN=$S(SDWLTY=1:5,SDWLTY=2:6,SDWLTY=3:7,SDWLTY=4:8,1:0),SDWLCOM=$P($P(X,U,18),"~",1)
"RTN","SDWLI",105,0)
 .S SDWLDUZ=$P(X,U,10),SDWLPRV=$P(X,U,12),SDWLPROV=$P(X,U,13),SDWLX=$P(X,"~",3) D
"RTN","SDWLI",106,0)
 ..I $D(SDWLDISX) S SDWLDIS=$P(SDWLDISX,U,1),SDWLDDUZ=$P(SDWLDISX,U,2),SDWLDIDT=$P(SDWLDISX,U,3)
"RTN","SDWLI",107,0)
 .S SDWLDT=$P(X,U,2),YY=$E(SDWLDT,1,3)+1700,YY=$E(YY,3,4),MM=$E(SDWLDT,4,5),DD=$E(SDWLDT,6,7),SDWLDTP=MM_"/"_DD_"/"_YY
"RTN","SDWLI",108,0)
 .S SDWLDTD=$P(X,U,16),YY=$E(SDWLDTD,1,3)+1700,YY=$E(YY,3,4),MM=$E(SDWLDTD,4,5),DD=$E(SDWLDTD,6,7),SDWLDTD=MM_"/"_DD_"/"_YY
"RTN","SDWLI",109,0)
 .;PATCH SD*5.3*394 See Note.
"RTN","SDWLI",110,0)
 .N SDWLSCP
"RTN","SDWLI",111,0)
 .S SDWLSCP=+$P($G(^SDWL(409.3,SDWLDA,"SC")),U,2)
"RTN","SDWLI",112,0)
 .W !,"# ",$J(SDWLCNT,3),!
"RTN","SDWLI",113,0)
 .W !,"Wait List - ",$$EXTERNAL^DILFD(409.3,4,,SDWLTY),?55,"Date Entered - ",SDWLDTP
"RTN","SDWLI",114,0)
 .W !,?15 S X=$$EXTERNAL^DILFD(409.3,SDWLTYN,,SDWLTYP) W X
"RTN","SDWLI",115,0)
 .S SDWLP=0 I SDWLPRI W !,"Priority - ",$$EXTERNAL^DILFD(409.3,10,,SDWLPRI) S SDWLP=1
"RTN","SDWLI",116,0)
 .I $D(SDWLSCP) W !,"Service Connected Priority - ",$$EXTERNAL^DILFD(409.3,15,,SDWLSCP)
"RTN","SDWLI",117,0)
 .W:SDWLP ?15 W:'SDWLP ! W "Institution - ",$$EXTERNAL^DILFD(409.3,2,,SDWLIN)
"RTN","SDWLI",118,0)
 .W !,"Entered by - " S X=$$EXTERNAL^DILFD(409.3,9,,SDWLDUZ) W X
"RTN","SDWLI",119,0)
 .S SDWRB=0 I SDWLPRV W !,"Requested By - ",$$EXTERNAL^DILFD(409.3,11,,SDWLPRV),?55,"Date Desired - ",SDWLDTD
"RTN","SDWLI",120,0)
 .I SDWLPRV=1 W !,"Provider - ",$$EXTERNAL^DILFD(409.3,12,,SDWLPROV)
"RTN","SDWLI",121,0)
 .I $D(SDWLCOM),SDWLCOM'="" W !,"Comments - ",SDWLCOM
"RTN","SDWLI",122,0)
 .I $D(^TMP("SDWLI",$J,SDWLCNT,"SDOP")) N SDOP S SDOP=^("SDOP") W !,"Reopen Reason: ",$P(SDOP,U) D
"RTN","SDWLI",123,0)
 ..I $P(SDOP,U,2)'="" W !,"Reopen comment: ",$P(SDOP,U,2)
"RTN","SDWLI",124,0)
 .I $D(^TMP("SDWLI",$J,SDWLCNT,"REM")) W !,"Non Removal Reason - ",SDREMR,!,"Non Remove Reason entered by - ",$$GET1^DIQ(200,SDREMU_",",.01,"I") D
"RTN","SDWLI",125,0)
 ..I $L(SDREMRC)>0 W !,"Non Removal Comment - ",SDREMRC
"RTN","SDWLI",126,0)
 ..W !,"Non Removal entry date - ",SDREMDD
"RTN","SDWLI",127,0)
 .I $D(^TMP("SDWLI",$J,SDWLCNT,"DIS")) W !,"Disposition - ",$$EXTERNAL^DILFD(409.3,21,,SDWLDIS),?51,"Disposition Date - ",SDWLDIDT D 
"RTN","SDWLI",128,0)
 ..W !,"Dispositioned by - ",$$EXTERNAL^DILFD(409.3,20,,SDWLDDUZ)
"RTN","SDWLI",129,0)
 .I $D(^TMP("SDWLI",$J,SDWLCNT,"SDAPT")) N SDAP S SDAP=^("SDAPT") D
"RTN","SDWLI",130,0)
 ..W !,"Appointment scheduled for " S Y=$P(SDAP,"~",2) D DD^%DT W Y
"RTN","SDWLI",131,0)
 ..W !?3,"Made on: " S Y=+SDAP D DD^%DT W Y,?30,"For clinic: " N SDC S SDC=$P(SDAP,U,2) S SDC=$$GET1^DIQ(44,SDC_",",.01) W SDC
"RTN","SDWLI",132,0)
 ..N SDAIN S SDAIN=$P(SDAP,U,3),SDAIN=$$GET1^DIQ(4,SDAIN_",",.01)
"RTN","SDWLI",133,0)
 ..W !?3,"Appt Institution: ",SDAIN
"RTN","SDWLI",134,0)
 ..N SDCR S SDCR=$P(SDAP,U,4),SDCR=$$GET1^DIQ(40.7,SDCR_",",.01)
"RTN","SDWLI",135,0)
 ..W ?40,"Appt Specialty: ",SDCR
"RTN","SDWLI",136,0)
 ..N SAPS S SAPS=$P(SDAP,U,8),SAPS=$P(SAPS,"~") I SAPS="CC" W !,"Appointment Status: Canceled by Clinic"
"RTN","SDWLI",137,0)
 .S SDWLCLPT=$$GET1^DIQ(409.3,SDWLDA,37,"I")  ; SD*5.3*446
"RTN","SDWLI",138,0)
 .D:SDWLCLPT  ; SD*5.3*446
"RTN","SDWLI",139,0)
 ..W !,"Clinic changed from: ",$$GET1^DIQ(409.3,SDWLCLPT,8)
"RTN","SDWLI",140,0)
 ..W:SDWLIN'=$$GET1^DIQ(409.3,SDWLCLPT,2,"I") " (",$$GET1^DIQ(409.3,SDWLCLPT,2),")"
"RTN","SDWLI",141,0)
 ..Q
"RTN","SDWLI",142,0)
 .; Inter-facility Transfer. SD*5.3*446
"RTN","SDWLI",143,0)
 .I $$GETTRN^SDWLIFT1(SDWLDA,.SDWLINNM,.SDWLSTN) D ENS^%ZISS W !,IOINHI,"In transfer to ",SDWLINNM," (",SDWLSTN,")",IOINORM D KILL^%ZISS
"RTN","SDWLI",144,0)
 .D GETS^DIQ(409.3,SDWLDA,"32;33;34;36;38;39","TMP")
"RTN","SDWLI",145,0)
 .K SDWLIN,SDWLCL,SDWLTY,SDWLPRI,SDWLDUZ,SDWLPRV,SDWLDT,SDWLDTD,SDWLDIS,SDWLDIDT,SDWLTYN,SDWLCOM,SDWLPROV,SDWLDISX,DIR,DIE,DR,SDWLINNM,SDWLSTN
"RTN","SDWLI",146,0)
 .W !,"*****",! K DIR S DIR(0)="E" D ^DIR  D
"RTN","SDWLI",147,0)
 ..I X["^" S DUOUT=1 Q
"RTN","SDWLI",148,0)
 ..I 'Y S DUOUT=1 Q
"RTN","SDWLI",149,0)
 ..D HD
"RTN","SDWLI",150,0)
 Q
"RTN","SDWLI",151,0)
HD ;Header
"RTN","SDWLI",152,0)
 W:$D(IOF) @IOF W !!,?80-$L("Wait List - Inquiry")\2,"Wait List - Inquiry ",!
"RTN","SDWLI",153,0)
 ;SD*5.3*327 - Correct undefined.
"RTN","SDWLI",154,0)
 I '$D(SDWLDFN) W !! Q 
"RTN","SDWLI",155,0)
 N DFN S DFN=SDWLDFN D DEM^VADPT
"RTN","SDWLI",156,0)
 W:$D(VADM) !,VADM(1),?40 I $D(VA("PID")) W VA("PID")
"RTN","SDWLI",157,0)
 W !!
"RTN","SDWLI",158,0)
 K DUOUT
"RTN","SDWLI",159,0)
 Q
"RTN","SDWLI",160,0)
END ;
"RTN","SDWLI",161,0)
 K DIR,DIC,DR,DIE,SDWLDFN,DUOUT
"RTN","SDWLI",162,0)
 K SDNOK,SDWLBDT,SDWLCL,SDWLCN,SDWLCNT,SDWLCOM,SDWLCT,SDWLDA,SDWLDATA,SDWLDDT,SDWLDDUZ,SDWLDFN,SDWLDIDT,SDWLDIS,SDWLDISX
"RTN","SDWLI",163,0)
 K SDWLDRG,SDWLDT,SDWLDTD,SDWLDTP,SDWLDUZ,SDLWEDT,SDWLIN,SDLWP,SDWLPRI,SDWLPROV,SDLWPRV,SDWLSC,SDWLSP,SDWLSS,SDLWST,SDWLTY
"RTN","SDWLI",164,0)
 K SDWLTYN,SDSWLTYP,SDLWX,SDWLY,SDWRB,SDWLBDT,SDWLDISC,SDWLERR,SDWLPRON,SDXSCAT,SDWLP,SDWLTYP
"RTN","SDWLI",165,0)
 Q
"RTN","SDWLIFT")
0^9^B64522057^B39472292
"RTN","SDWLIFT",1,0)
SDWLIFT ;IOFO BAY PINES/OG - INTER-FACILITY TRANSFER: CONTROL RESPONSES;Compiled March 29, 2005 15:36:25  ; Compiled January 25, 2007 09:47:44  ; Compiled April 16, 2007 10:12:05
"RTN","SDWLIFT",2,0)
 ;;5.3;Scheduling;**415,446**;AUG 13 1993;Build 77
"RTN","SDWLIFT",3,0)
 ;
"RTN","SDWLIFT",4,0)
 ;******************************************************************
"RTN","SDWLIFT",5,0)
 ;                             CHANGE LOG
"RTN","SDWLIFT",6,0)
 ;
"RTN","SDWLIFT",7,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLIFT",8,0)
 ;   ----                        -----                   -----------
"RTN","SDWLIFT",9,0)
 ;   12/12/05                    SD*5.3*446              Enhancements
"RTN","SDWLIFT",10,0)
 ;
"RTN","SDWLIFT",11,0)
MSGSVR ;xfer message server
"RTN","SDWLIFT",12,0)
 ;variables provided by server XQ*
"RTN","SDWLIFT",13,0)
 ;XQSOP : server option name
"RTN","SDWLIFT",14,0)
 ;XQMSG : server request message number
"RTN","SDWLIFT",15,0)
 ;XQSND : DUZ of sender
"RTN","SDWLIFT",16,0)
 ;XQSUB : subject
"RTN","SDWLIFT",17,0)
 ;SDMSG : local array of message lines
"RTN","SDWLIFT",18,0)
 N SDWLMSG
"RTN","SDWLIFT",19,0)
 D
"RTN","SDWLIFT",20,0)
 .I $E(XQSUB,1,3)="RE:" Q  ;quit for messages that are replies to original
"RTN","SDWLIFT",21,0)
 .I XQSUB="SDWL TRANSFER REQUEST" D MSGSVRRQ^SDWLIFT0 Q  ;transfer request
"RTN","SDWLIFT",22,0)
 .I XQSUB="SDWL TRANSFER ACKNOWLEDGEMENT" D MSGSVRAR Q  ;acknowledge request from receiving facility
"RTN","SDWLIFT",23,0)
 .I XQSUB="SDWL TRANSFER REMOVAL REQUEST" D MSGSVRRM^SDWLIFT0 Q  ;remove request
"RTN","SDWLIFT",24,0)
 .I XQSUB="SDWL TRANSFER REMOVAL REQUEST ACKNOWLEDGEMENT" D MSGSVRRA Q  ;remove request acknowledgement
"RTN","SDWLIFT",25,0)
 .I XQSUB="SDWL TRANSFER ACCEPTANCE" D MSGSVRAC Q  ;transaction accepted.
"RTN","SDWLIFT",26,0)
 .I XQSUB="SDWL TRANSFER REJECTION" D MSGSVRRJ Q  ;transaction rejected.
"RTN","SDWLIFT",27,0)
 .I XQSUB="SDWL TRANSFER STATUS CHANGE" D MSGSVRSC Q  ;status changed
"RTN","SDWLIFT",28,0)
 .S SDWLMSG(1,0)="Message received by S.SDWL-XFER-SERVER option has an unrecognized message subject"
"RTN","SDWLIFT",29,0)
 .D ERR(.SDWLMSG)
"RTN","SDWLIFT",30,0)
 .Q
"RTN","SDWLIFT",31,0)
 K XQMSG,XQSND,XQSUB
"RTN","SDWLIFT",32,0)
 Q
"RTN","SDWLIFT",33,0)
MSGSVRAR ;Acknowledge request
"RTN","SDWLIFT",34,0)
 N DIE,DA,DR,DIC,D,X,SDWLX,SDWLI,SDWLMSG,TMP,SDWLDA,SDWLIST
"RTN","SDWLIFT",35,0)
 D RMSG
"RTN","SDWLIFT",36,0)
 S SDWLI=$O(SDWLMSG(1),-1)  ;There's stuff between 0 and 1
"RTN","SDWLIFT",37,0)
 F  S SDWLI=$O(SDWLMSG(SDWLI)) Q:'SDWLI  S SDWLX($P(SDWLMSG(SDWLI,0),U))=$P(SDWLMSG(SDWLI,0),U,3)
"RTN","SDWLIFT",38,0)
 S DIC(0)="",DIC="^SDWL(409.35,",X="`"_SDWLX(.5) D ^DIC
"RTN","SDWLIFT",39,0)
 ;If the transfer entry does not exist or does not belong to this request, send a removal request back
"RTN","SDWLIFT",40,0)
 I Y=-1!(SDWLX(2)'=$$GET1^DIQ(409.35,SDWLX(.5),2,"I")) D SEND^SDWLIFT4(SDWLX(6),$$GET1^DIQ(4,$$FIND1^DIC(4,"","X",SDWLX(1),"D"),60)) Q
"RTN","SDWLIFT",41,0)
 ; if this EWL entry is the subject of a transfer, close it and send message back to requesting facility
"RTN","SDWLIFT",42,0)
 S SDWLIST="R",SDWLDA=$P(Y,U,2)
"RTN","SDWLIFT",43,0)
 I $D(^SDWL(409.36,"C",SDWLDA)) S SDWLIST="C" D
"RTN","SDWLIFT",44,0)
 .N DA,SDWLDUZ
"RTN","SDWLIFT",45,0)
 .S DIE="^SDWL(409.3,"
"RTN","SDWLIFT",46,0)
 .S DA=SDWLDA,SDWLDUZ=$$GET1^DIQ(409.35,SDWLIFTN,4,"I")
"RTN","SDWLIFT",47,0)
 .S DR="21////^S X=""TR"";19////^S X=DT;20////^S X=SDWLDUZ;23////^S X=""C"""
"RTN","SDWLIFT",48,0)
 .D ^DIE
"RTN","SDWLIFT",49,0)
 .S DIE="^SDWL(409.36,",DA=$O(^SDWL(409.36,"C",SDWLDA,""))
"RTN","SDWLIFT",50,0)
 .S DR="1///""R"";2///"_$$GET1^DIQ(409.35,SDWLIFTN,1,"I") D ^DIE
"RTN","SDWLIFT",51,0)
 .D SENDST^SDWLIFT6(DA)
"RTN","SDWLIFT",52,0)
 .Q
"RTN","SDWLIFT",53,0)
 ;finally, set the transfer request file.
"RTN","SDWLIFT",54,0)
 S DIE="^SDWL(409.35,",DA=SDWLX(.5),DR="3///"_SDWLIST_";6///"_SDWLX(6) D ^DIE Q
"RTN","SDWLIFT",55,0)
 Q
"RTN","SDWLIFT",56,0)
MSGSVRRA ;Removal acknowledgement
"RTN","SDWLIFT",57,0)
 N SDWLX,SDWLNM,SDWLIFTN,SDWLSTN,SDWLINST,DIE,DA,DR,XMY,XMSUB,XMTEXT,XMDUZ,XMMG
"RTN","SDWLIFT",58,0)
 D RMSG
"RTN","SDWLIFT",59,0)
 S DIE=409.35,DA=$P(SDWLMSG(1,0),U,3)
"RTN","SDWLIFT",60,0)
 D GETS^DIQ(DIE,DA_",",".01;6",,"TMP")
"RTN","SDWLIFT",61,0)
 Q:'$D(TMP(DIE,DA_",",.01))  ;Already removed
"RTN","SDWLIFT",62,0)
 S SDWLNM=TMP(DIE,DA_",",.01)  ;Patient name
"RTN","SDWLIFT",63,0)
 S SDWLIFTN=TMP(DIE,DA_",",6)  ;Receiving facility's request id
"RTN","SDWLIFT",64,0)
 S SDWLSTN=$$GET1^DIQ(DIE,DA,1)
"RTN","SDWLIFT",65,0)
 S SDWLINST=$$FIND1^DIC(4,"","X",SDWLSTN,"D")
"RTN","SDWLIFT",66,0)
 S DA=$P(SDWLMSG(1,0),U,3),DIK="^SDWL(409.35," D ^DIK
"RTN","SDWLIFT",67,0)
 S XMY("G.SDWL-TRANSFER-ADMIN")="",XMSUB="INTER-FACILITY XFER: Removal of cancelled request",XMTEXT="SDWLX(",XMDUZ="POSTMASTER"
"RTN","SDWLIFT",68,0)
 S SDWLX(0)=1,SDWLX(SDWLX(0),0)="The request to transfer "_SDWLNM_" to "_$$GET1^DIQ(4,SDWLINST,.01)_" ("_SDWLSTN_") has been recalled."
"RTN","SDWLIFT",69,0)
 D COL80(.SDWLX)
"RTN","SDWLIFT",70,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="",SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="The details have been removed from the system."
"RTN","SDWLIFT",71,0)
 D ^XMD
"RTN","SDWLIFT",72,0)
 I $G(XMMG)["Error" S SDWLMSG(0)=1,SDWLMSG(1,0)="Message aborted with the following error: "_XMMG D ERR(.SDWLMSG)
"RTN","SDWLIFT",73,0)
 Q
"RTN","SDWLIFT",74,0)
MSGSVRAC ;Acceptance notification.
"RTN","SDWLIFT",75,0)
 N TMP,DIE,DA,DR,XMY,XMSUB,XMTEXT,XMDUZ,XMMG,SDWLDUZ,SDWLINST,SDWLNM,SDWLX,SDWLTXT,SDWLMSG
"RTN","SDWLIFT",76,0)
 D RMSG
"RTN","SDWLIFT",77,0)
 S DIE=409.35,DA=$P(SDWLMSG(1,0),U,3),DR="3///A;7///"_$P(SDWLMSG(2,0),U,3) D ^DIE
"RTN","SDWLIFT",78,0)
 S SDWLSTN=$$GET1^DIQ(409.35,DA,1),SDWLINST=$$FIND1^DIC(4,"","X",SDWLSTN,"D"),SDWLNM=$$GET1^DIQ(409.35,DA,.01)
"RTN","SDWLIFT",79,0)
 D GETS^DIQ(409.35,DA,".01;4","I","TMP")
"RTN","SDWLIFT",80,0)
 S SDWLDUZ=TMP(409.35,DA_",",4,"I"),DIE("NO^")="NO EDITING"  ;Disposition the EWL entry.
"RTN","SDWLIFT",81,0)
 S DIE="^SDWL(409.3,",DA=TMP(409.35,DA_",",.01,"I"),DR="19////^S X=DT;20////^S X=SDWLDUZ;21////^S X=""TR"";23////^S X=""C""" D ^DIE
"RTN","SDWLIFT",82,0)
 S XMY("G.SDWL-TRANSFER-ADMIN")="",XMSUB="INTER-FACILITY XFER: Request accepted",XMTEXT="SDWLX(",XMDUZ="POSTMASTER"
"RTN","SDWLIFT",83,0)
 S SDWLX(0)=1,SDWLX(SDWLX(0),0)="The request to transfer "_SDWLNM_" to "_$$GET1^DIQ(4,SDWLINST,.01)_" ("_SDWLSTN_") has been accepted by the receiving facility."
"RTN","SDWLIFT",84,0)
 D COL80(.SDWLX)
"RTN","SDWLIFT",85,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="",SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="The status has been updated and can be viewed in SDWL TRANSFER REQUEST"
"RTN","SDWLIFT",86,0)
 D ^XMD
"RTN","SDWLIFT",87,0)
 I $G(XMMG)["Error" S SDWLMSG(0)=1,SDWLMSG(1,0)="Message aborted with the following error: "_XMMG D ERR(.SDWLMSG)
"RTN","SDWLIFT",88,0)
 Q
"RTN","SDWLIFT",89,0)
MSGSVRRJ ;Rejection notification.
"RTN","SDWLIFT",90,0)
 N DIE,DA,DR,SDWLX,SDWLINST,SDWLNM,SDWLTXT,SDWLMSG,XMY,XMSUB,XMTEXT,XMDUZ,XMMG
"RTN","SDWLIFT",91,0)
 D RMSG
"RTN","SDWLIFT",92,0)
 S DIE=409.35,DA=$P(SDWLMSG(1,0),U,3),SDWLSTN=$$GET1^DIQ(DIE,DA,1),SDWLINST=$$FIND1^DIC(4,"","X",SDWLSTN,"D"),SDWLNM=$$GET1^DIQ(DIE,DA,.01)
"RTN","SDWLIFT",93,0)
 S DR="3///X" D ^DIE
"RTN","SDWLIFT",94,0)
 S XMY("G.SDWL-TRANSFER-ADMIN")=""
"RTN","SDWLIFT",95,0)
 S XMSUB="INTER-FACILITY XFER: Request declined",XMTEXT="SDWLX(",XMDUZ="POSTMASTER"
"RTN","SDWLIFT",96,0)
 S SDWLX(0)=1,SDWLX(SDWLX(0),0)="The request to transfer "_SDWLNM_" to "_$$GET1^DIQ(4,SDWLINST,.01)_" ("_SDWLSTN_") has been rejected by the receiving facility."
"RTN","SDWLIFT",97,0)
 D COL80(.SDWLX)
"RTN","SDWLIFT",98,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="",SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="The status has been updated and can be viewed in, SDWL TRANSFER REQUEST"
"RTN","SDWLIFT",99,0)
 D ^XMD
"RTN","SDWLIFT",100,0)
 I $G(XMMG)["Error" S SDWLMSG(0)=1,SDWLMSG(1,0)="Message aborted with the following error: "_XMMG D ERR(.SDWLMSG)
"RTN","SDWLIFT",101,0)
 Q
"RTN","SDWLIFT",102,0)
MSGSVRSC ;Status changed
"RTN","SDWLIFT",103,0)
 N SDWLDIS,SDWLDUZ,SDWLIFTN,SDWLINST,SDWLMSG,SDWLST35,SDWLST36,SDWLSTN,SDWLX
"RTN","SDWLIFT",104,0)
 D RMSG
"RTN","SDWLIFT",105,0)
 S SDWLST36=$P(SDWLMSG(2,0),U,3),SDWLST35=$S(SDWLST36="P":"R",SDWLST36="C":"A",SDWLST36="R":"X",1:SDWLST36)
"RTN","SDWLIFT",106,0)
 I SDWLST36="T"  ;?
"RTN","SDWLIFT",107,0)
 S DIE=409.35,(SDWLIFTN,DA)=$P(SDWLMSG(1,0),U,3),DR="3///"_SDWLST35_";7///"_$P(SDWLMSG(3,0),U,3) D ^DIE
"RTN","SDWLIFT",108,0)
 S SDWLSTN=$$GET1^DIQ(409.35,SDWLIFTN,1),SDWLINST=$$FIND1^DIC(4,"","X",SDWLSTN,"D"),SDWLNM=$$GET1^DIQ(409.35,SDWLIFTN,.01)
"RTN","SDWLIFT",109,0)
 S SDWLDIS=$P(SDWLMSG(5,0),U,3)
"RTN","SDWLIFT",110,0)
 S XMY("G.SDWL-TRANSFER-ADMIN")=""
"RTN","SDWLIFT",111,0)
 S XMSUB="INTER-FACILITY XFER: Transfer status change",XMTEXT="SDWLX(",XMDUZ="POSTMASTER"
"RTN","SDWLIFT",112,0)
 S SDWLX(0)=1,SDWLX(SDWLX(0),0)="The the status of the transfer of "_SDWLNM_" to "_$$GET1^DIQ(4,SDWLINST,.01)_" ("_SDWLSTN_") has changed."
"RTN","SDWLIFT",113,0)
 S SDWLX(0)=2,SDWLX(SDWLX(0),0)="It is now "_$$GET1^DIQ(409.35,SDWLIFTN,3)_"."
"RTN","SDWLIFT",114,0)
 D COL80(.SDWLX)
"RTN","SDWLIFT",115,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="",SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="The status has been updated and can be viewed in, SDWL TRANSFER REQUEST"
"RTN","SDWLIFT",116,0)
 D ^XMD
"RTN","SDWLIFT",117,0)
 I $G(XMMG)["Error" S SDWLMSG(0)=1,SDWLMSG(1,0)="Message aborted with the following error: "_XMMG D ERR(.SDWLMSG)
"RTN","SDWLIFT",118,0)
 Q:SDWLST35'="A"
"RTN","SDWLIFT",119,0)
 ; Close EWL entry
"RTN","SDWLIFT",120,0)
 S DIE="^SDWL(409.3,"
"RTN","SDWLIFT",121,0)
 S DA=$$GET1^DIQ(409.35,SDWLIFTN,.01,"I"),SDWLDUZ=$$GET1^DIQ(409.35,SDWLIFTN,4,"I")
"RTN","SDWLIFT",122,0)
 S DR="21////^S X=SDWLDIS;19////^S X=DT;20////^S X=SDWLDUZ;23////^S X=""C"""
"RTN","SDWLIFT",123,0)
 D ^DIE
"RTN","SDWLIFT",124,0)
 Q
"RTN","SDWLIFT",125,0)
COL80(SDWLX) ;Stop lines going over 80 columns.
"RTN","SDWLIFT",126,0)
 N SDWLI,COLS
"RTN","SDWLIFT",127,0)
 S COLS=79
"RTN","SDWLIFT",128,0)
 F SDWLI=1:1 Q:'$D(SDWLX(SDWLI))  D:$L(SDWLX(SDWLI,0))>COLS
"RTN","SDWLIFT",129,0)
 .N SDWLF,SDWLF0,SDWLX0
"RTN","SDWLIFT",130,0)
 .S SDWLF=0
"RTN","SDWLIFT",131,0)
 .F  S SDWLF=$F(SDWLX(SDWLI,0)," ",SDWLF) Q:SDWLF>COLS!'SDWLF  S SDWLF0=SDWLF
"RTN","SDWLIFT",132,0)
 .S:'$D(SDWLX(SDWLI+1)) SDWLX(0)=SDWLI+1
"RTN","SDWLIFT",133,0)
 .S SDWLX0=$G(SDWLX(SDWLI+1,0))
"RTN","SDWLIFT",134,0)
 .S SDWLX(SDWLI+1,0)=$E(SDWLX(SDWLI,0),SDWLF0,$L(SDWLX(SDWLI,0)))
"RTN","SDWLIFT",135,0)
 .S:SDWLX0'="" SDWLX(SDWLI+1,0)=SDWLX(SDWLI+1,0)_" "_SDWLX0
"RTN","SDWLIFT",136,0)
 .S SDWLX(SDWLI,0)=$E(SDWLX(SDWLI,0),1,SDWLF0-2)
"RTN","SDWLIFT",137,0)
 .Q
"RTN","SDWLIFT",138,0)
 Q
"RTN","SDWLIFT",139,0)
RMSG ;load message into local array
"RTN","SDWLIFT",140,0)
 M SDWLMSG=^XMB(3.9,XQMSG,2)
"RTN","SDWLIFT",141,0)
 Q
"RTN","SDWLIFT",142,0)
ERR(SDWLX) ;send error message to developer
"RTN","SDWLIFT",143,0)
 N XMSUB,XMY,XMTEXT,XMDUZ,SDWLMSG,SDWLI
"RTN","SDWLIFT",144,0)
 S XMY("G.SDWL-TRANSFER-ADMIN")="",XMSUB="Error from S.SDWL-XFER Server",XMTEXT="SDWLMSG(",XMDUZ="POSTMASTER"
"RTN","SDWLIFT",145,0)
 S SDWLMSG(1,0)="      Forum Message #: "_XQMSG
"RTN","SDWLIFT",146,0)
 S SDWLMSG(2,0)="Sender's Mail Address: "_XQSND
"RTN","SDWLIFT",147,0)
 S SDWLMSG(3,0)="              Subject: "_XQSUB
"RTN","SDWLIFT",148,0)
 S SDWLMSG(4,0)="",SDWLMSG(0)=4
"RTN","SDWLIFT",149,0)
 F SDWLI=1:1:SDWLX(0) S SDWLMSG(0)=SDWLMSG(0)+1,SDWLMSG(SDWLMSG(0),0)=SDWLX(SDWLI,0)
"RTN","SDWLIFT",150,0)
 D ^XMD
"RTN","SDWLIFT",151,0)
 Q
"RTN","SDWLIFT",152,0)
GETTN(SDWLINFO) ;Get transfer id.
"RTN","SDWLIFT",153,0)
 N LAST,DIR,Y
"RTN","SDWLIFT",154,0)
 S LAST=$O(SDWLINFO(":"),-1)
"RTN","SDWLIFT",155,0)
 I 'LAST S DIR(0)="Y",DIR("A")="No entries. OK",DIR("B")="YES" D ^DIR Q 0
"RTN","SDWLIFT",156,0)
 I LAST=1 S Y=1  ;If there is only one, don't ask.
"RTN","SDWLIFT",157,0)
 E  S DIR(0)="L^1:"_LAST,DIR("A")="Which entry?" D ^DIR
"RTN","SDWLIFT",158,0)
 Q $G(SDWLINFO(+Y,1),0)
"RTN","SDWLIFT",159,0)
EXMNU Q
"RTN","SDWLIFT",160,0)
ENMNU Q
"RTN","SDWLIFT0")
0^10^B26058750^B23628296
"RTN","SDWLIFT0",1,0)
SDWLIFT0 ;IOFO BAY PINES/OG - INTER-FACILITY TRANSFER: CONTROL REQUESTS;  ; Compiled September 28, 2006 16:56:45
"RTN","SDWLIFT0",2,0)
 ;;5.3;Scheduling;**415,446**;AUG 13 1993;Build 77
"RTN","SDWLIFT0",3,0)
 ;
"RTN","SDWLIFT0",4,0)
 ;******************************************************************
"RTN","SDWLIFT0",5,0)
 ;                             CHANGE LOG
"RTN","SDWLIFT0",6,0)
 ;
"RTN","SDWLIFT0",7,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLIFT0",8,0)
 ;   ----                        -----                   -----------
"RTN","SDWLIFT0",9,0)
 ;   04/17/2006                  SD*5.3*446              Add status on receipt
"RTN","SDWLIFT0",10,0)
 ;
"RTN","SDWLIFT0",11,0)
MSGSVRRQ ;handle transfer request
"RTN","SDWLIFT0",12,0)
 N DIC,DIE,DA,DR,DO,X,Y,%,XMY,XMSUB,XMTEXT,XMDUZ,XMMG,SDWLI,SDWLCI,SDWLI0,SDWLCOMM,SDWLMSG,SDWLRIN,SDWLIFTN,SDWLNM,SDWLDTM
"RTN","SDWLIFT0",13,0)
 D RMSG^SDWLIFT
"RTN","SDWLIFT0",14,0)
 S SDWLI=1,DIC="^SDWL(409.36,",DIC(0)="",(SDWLNM,X)=$P(SDWLMSG(SDWLI,0),U,3)
"RTN","SDWLIFT0",15,0)
 D FILE^DICN
"RTN","SDWLIFT0",16,0)
 I Y<0 S SDWLMSG(1,0)="Error creating new request: "_SDWLMSG(1,0) D ERR^SDWLIFT(.SDWLMSG) Q
"RTN","SDWLIFT0",17,0)
 S DA=+Y,DR="",(SDWLCI,SDWLI0)=0
"RTN","SDWLIFT0",18,0)
 F  S SDWLI=$O(SDWLMSG(SDWLI)) Q:'SDWLI  D
"RTN","SDWLIFT0",19,0)
 .;I $P(SDWLMSG(SDWLI,0),U)=.361 S X=$P(SDWLMSG(SDWLI,0),U,3),DIC=8 D ^DIC S SDWLI0=SDWLI0+1,$P(DR,";",SDWLI0)=".361///"_$S(Y=-1:"",1:+Y) Q  ; Primary eligibility code. Expansion transmitted, get IEN.
"RTN","SDWLIFT0",20,0)
 .I $P(SDWLMSG(SDWLI,0),U)=.4 S SDWLCI=SDWLCI+1,SDWLCOMM(SDWLCI)=$P(SDWLMSG(SDWLI,0),U,3) Q
"RTN","SDWLIFT0",21,0)
 .I $P(SDWLMSG(SDWLI,0),U)=2 S SDWLDTM=$P(SDWLMSG(SDWLI,0),U,3) Q  ;Transmission Date/Time: not written to #409.36, just returned for verification
"RTN","SDWLIFT0",22,0)
 .S SDWLI0=SDWLI0+1,$P(DR,";",SDWLI0)=$P(SDWLMSG(SDWLI,0),U)_"///"_$P(SDWLMSG(SDWLI,0),U,3)
"RTN","SDWLIFT0",23,0)
 .I $P(SDWLMSG(SDWLI,0),U)=.1 S SDWLSTN=$P(SDWLMSG(SDWLI,0),U,3),SDWLRIN=$$FIND1^DIC(4,"","X",SDWLSTN,"D")  ;Requesting facility
"RTN","SDWLIFT0",24,0)
 .I $P(SDWLMSG(SDWLI,0),U)=.5 S SDWLIFTN=$P(SDWLMSG(SDWLI,0),U,3)  ;Requesting facility's transfer ID
"RTN","SDWLIFT0",25,0)
 .Q
"RTN","SDWLIFT0",26,0)
 D NOW^%DTC
"RTN","SDWLIFT0",27,0)
 S DR=DR_";.2///"_%_";1///P",DIE=DIC D ^DIE  ; 446 ; OG ; added status.
"RTN","SDWLIFT0",28,0)
 S DA(1)=DA,DIC=DIC_DA(1)_",""COMM"",",SDWLI=0
"RTN","SDWLIFT0",29,0)
 F  S SDWLI=$O(SDWLCOMM(SDWLI)) Q:'SDWLI  S X=SDWLCOMM(SDWLI) K DO D FILE^DICN
"RTN","SDWLIFT0",30,0)
 ;send acknowledgement message back reporting success or failure
"RTN","SDWLIFT0",31,0)
 S XMY("S.SDWL-XFER-SERVER@"_$$GET1^DIQ(4,SDWLRIN,60))="",XMSUB="SDWL TRANSFER ACKNOWLEDGEMENT",XMTEXT="SDWLX(",XMDUZ="POSTMASTER"
"RTN","SDWLIFT0",32,0)
 S SDWLI=1,SDWLX(SDWLI)=".5"_U_"SENDING FACILITY TRANSFER ID"_U_SDWLIFTN
"RTN","SDWLIFT0",33,0)
 S SDWLI=SDWLI+1,SDWLX(SDWLI)=".01"_U_"NAME"_U_SDWLNM
"RTN","SDWLIFT0",34,0)
 S SDWLI=SDWLI+1,SDWLX(SDWLI)=1_U_"STATION NUMBER"_U_$P($$SITE^VASITE(),U,3)
"RTN","SDWLIFT0",35,0)
 S SDWLI=SDWLI+1,SDWLX(SDWLI)=2_U_"TRANSMISSION DATE/TIME"_U_SDWLDTM
"RTN","SDWLIFT0",36,0)
 S SDWLI=SDWLI+1,SDWLX(SDWLI)=6_U_"RECEIVING FACILITY TRANSFER ID"_U_DA
"RTN","SDWLIFT0",37,0)
 D ^XMD
"RTN","SDWLIFT0",38,0)
 K XMY,SDWLX,SDWLMSG
"RTN","SDWLIFT0",39,0)
 I $G(XMMG)["Error" S SDWLMSG(0)=1,SDWLMSG(1,0)="Message aborted with the following error: "_XMMG D ERR^SDWLIFT(.SDWLMSG) Q
"RTN","SDWLIFT0",40,0)
 S XMY("G.SDWL-TRANSFER-ADMIN")="",XMSUB="INTER-FACILITY XFER: New request",XMTEXT="SDWLX(",XMDUZ="POSTMASTER"
"RTN","SDWLIFT0",41,0)
 S SDWLX(0)=1,SDWLX(SDWLX(0),0)="A request has arrived to transfer "_SDWLNM_" from "_$$GET1^DIQ(4,SDWLRIN,.01)_" ("_SDWLSTN_")."
"RTN","SDWLIFT0",42,0)
 D:$L(SDWLX(SDWLX(0),0))>80 COL80^SDWLIFT(.SDWLX)
"RTN","SDWLIFT0",43,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="",SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="Details available at menu option, SDWL TRANSFER ACCEPT"
"RTN","SDWLIFT0",44,0)
 D ^XMD
"RTN","SDWLIFT0",45,0)
 I $G(XMMG)["Error" S SDWLMSG(0)=1,SDWLMSG(1,0)="Message aborted with the following error: "_XMMG D ERR^SDWLIFT(.SDWLMSG)
"RTN","SDWLIFT0",46,0)
 Q
"RTN","SDWLIFT0",47,0)
MSGSVRRM ;remove request
"RTN","SDWLIFT0",48,0)
 N DIE,DA,DR,DIK,DIC,D,X,XMY,XMSUB,XMTEXT,XMDUZ,XMMG,TMP,SDWLNM,SDWLIFTN,SDWLINST,SDWLSTN,SDWLDMN,SDWLX,SDWLMSG
"RTN","SDWLIFT0",49,0)
 D RMSG^SDWLIFT
"RTN","SDWLIFT0",50,0)
 S DIE=409.36,DA=$P(SDWLMSG(1,0),U,3)
"RTN","SDWLIFT0",51,0)
 D GETS^DIQ(DIE,DA_",",".01;.5",,"TMP")
"RTN","SDWLIFT0",52,0)
 S SDWLNM=TMP(DIE,DA_",",.01)  ;Patient name
"RTN","SDWLIFT0",53,0)
 S SDWLIFTN=TMP(DIE,DA_",",.5)  ;Sending facility's request id
"RTN","SDWLIFT0",54,0)
 S SDWLSTN=$$GET1^DIQ(DIE,DA,.1)  ;Requesting station number
"RTN","SDWLIFT0",55,0)
 S SDWLINST=$$FIND1^DIC(4,"","X",SDWLSTN,"D"),SDWLDMN=$$GET1^DIQ(4,SDWLINST,60)
"RTN","SDWLIFT0",56,0)
 S DIK="^SDWL(409.36," D ^DIK
"RTN","SDWLIFT0",57,0)
 S XMY("S.SDWL-XFER-SERVER@"_SDWLDMN)="",XMSUB="SDWL TRANSFER REMOVAL REQUEST ACKNOWLEDGEMENT",XMTEXT="SDWLX(",XMDUZ="POSTMASTER"
"RTN","SDWLIFT0",58,0)
 S SDWLX(1,0)=".5"_U_"SENDING FACILITY TRANSFER ID"_U_SDWLIFTN
"RTN","SDWLIFT0",59,0)
 S SDWLX(0)=1
"RTN","SDWLIFT0",60,0)
 D ^XMD
"RTN","SDWLIFT0",61,0)
 I $G(XMMG)["Error" S SDWLMSG(0)=1,SDWLMSG(1,0)="Message aborted with the following error: "_XMMG D ERR^SDWLIFT(.SDWLMSG)
"RTN","SDWLIFT0",62,0)
 K XMY,SDWLMSG,SDWLX
"RTN","SDWLIFT0",63,0)
 S XMY("G.SDWL-TRANSFER-ADMIN")="",XMSUB="INTER-FACILITY XFER: Removal of request",XMTEXT="SDWLX(",XMDUZ="POSTMASTER"
"RTN","SDWLIFT0",64,0)
 S SDWLX(0)=1,SDWLX(SDWLX(0),0)="The request to transfer "_SDWLNM_" from "_$$GET1^DIQ(4,SDWLINST,.01)_" ("_SDWLSTN_") has been recalled."
"RTN","SDWLIFT0",65,0)
 D:$L(SDWLX(SDWLX(0),0))>80 COL80^SDWLIFT(.SDWLX)
"RTN","SDWLIFT0",66,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="",SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0),0)="The details have been removed from the system."
"RTN","SDWLIFT0",67,0)
 D ^XMD
"RTN","SDWLIFT0",68,0)
 I $G(XMMG)["Error" S SDWLMSG(0)=1,SDWLMSG(1,0)="Message aborted with the following error: "_XMMG D ERR^SDWLIFT(.SDWLMSG)
"RTN","SDWLIFT0",69,0)
 Q
"RTN","SDWLIFT2")
0^41^B7137331^B7114075
"RTN","SDWLIFT2",1,0)
SDWLIFT2 ;IOFO BAY PINES/OG - INTER-FACILITY TRANSFER: DISPLAY TRANSFER DETAILS  ; Compiled March 23, 2005 12:38:06  ; Compiled January 25, 2007 12:35:43
"RTN","SDWLIFT2",2,0)
 ;;5.3;Scheduling;**415,446**;AUG 13 1993;Build 77
"RTN","SDWLIFT2",3,0)
 ;
"RTN","SDWLIFT2",4,0)
 ;
"RTN","SDWLIFT2",5,0)
 ;******************************************************************
"RTN","SDWLIFT2",6,0)
 ;                             CHANGE LOG
"RTN","SDWLIFT2",7,0)
 ;                                               
"RTN","SDWLIFT2",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLIFT2",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLIFT2",10,0)
 ;
"RTN","SDWLIFT2",11,0)
 ;
"RTN","SDWLIFT2",12,0)
 Q
"RTN","SDWLIFT2",13,0)
EN ; INITIALIZE VARIABLES FOR DISPLAY
"RTN","SDWLIFT2",14,0)
 ; SDWLFMT: which set of data?
"RTN","SDWLIFT2",15,0)
 ; 0 - Active
"RTN","SDWLIFT2",16,0)
 ; 2 - Inactive
"RTN","SDWLIFT2",17,0)
 N SDWLOK,SDWLI
"RTN","SDWLIFT2",18,0)
 K SDWLINFO
"RTN","SDWLIFT2",19,0)
 D GETDATA^SDWLIFT5(.SDWLINFO,SDWLFMT)
"RTN","SDWLIFT2",20,0)
 S SDWLIFTN=$$GETTN^SDWLIFT(.SDWLINFO)
"RTN","SDWLIFT2",21,0)
 I 'SDWLIFTN S VALMBCK="R" Q
"RTN","SDWLIFT2",22,0)
 K SDWLINFO D GETDATA^SDWLIFT5(.SDWLINFO,SDWLFMT)
"RTN","SDWLIFT2",23,0)
 S (SDWLOK,SDWLI)=0 F  S SDWLI=$O(SDWLINFO(SDWLI)) Q:'SDWLI  I SDWLINFO(SDWLI,1)=SDWLIFTN S SDWLOK=1 Q
"RTN","SDWLIFT2",24,0)
 D:SDWLOK EN^VALM("SDWL TRANSFER REQ VIEW")
"RTN","SDWLIFT2",25,0)
 D INIT^SDWLIFT1(SDWLFMT)
"RTN","SDWLIFT2",26,0)
 S VALMBCK="R"
"RTN","SDWLIFT2",27,0)
 Q
"RTN","SDWLIFT2",28,0)
 ;
"RTN","SDWLIFT2",29,0)
INIT ; Default initialization options.
"RTN","SDWLIFT2",30,0)
 N DIC,D,X,WP,SDWLI,DFN,TMP,SDWLTY,SDWLDA,VADM
"RTN","SDWLIFT2",31,0)
 S SDWLDA=$$GET1^DIQ(409.35,SDWLIFTN,.01,"I")
"RTN","SDWLIFT2",32,0)
 D GETS^DIQ(409.35,SDWLIFTN,"1;3;7",,"TMP")
"RTN","SDWLIFT2",33,0)
 S DFN=$$GET1^DIQ(409.3,SDWLDA,.01,"I")
"RTN","SDWLIFT2",34,0)
 D DEM^VADPT
"RTN","SDWLIFT2",35,0)
 S VALMCNT=1
"RTN","SDWLIFT2",36,0)
 D SET^VALM10(VALMCNT,"Name: "_$E(VADM(1)_SDWLSPS,1,31)_"Status:        "_TMP(409.35,SDWLIFTN_",",3))
"RTN","SDWLIFT2",37,0)
 I TMP(409.35,SDWLIFTN_",",7)'="" S VALMCNT=VALMCNT+1 D SET^VALM10(VALMCNT,"Transfer accepted by: "_TMP(409.35,SDWLIFTN_",",7))
"RTN","SDWLIFT2",38,0)
 S VALMCNT=VALMCNT+1
"RTN","SDWLIFT2",39,0)
 D SET^VALM10(VALMCNT,"SSN:  "_$E($P(VADM(2),U,2)_SDWLSPS,1,31)_"Date of birth: "_$P(VADM(3),U,2))
"RTN","SDWLIFT2",40,0)
 S VALMCNT=VALMCNT+1
"RTN","SDWLIFT2",41,0)
 D SET^VALM10(VALMCNT,"Wait List Type:  "_$$GET1^DIQ(409.3,SDWLDA,4)_" : "_$$GET1^DIQ(409.3,SDWLDA,4+$$GET1^DIQ(409.3,SDWLDA,4,"I")))
"RTN","SDWLIFT2",42,0)
 S VALMCNT=VALMCNT+1
"RTN","SDWLIFT2",43,0)
 D SET^VALM10(VALMCNT,"Transfer to: "_$$GET1^DIQ(4,$$FIND1^DIC(4,"","X",TMP(409.35,SDWLIFTN_",",1),"D"),.01))
"RTN","SDWLIFT2",44,0)
 S VALMCNT=VALMCNT+1
"RTN","SDWLIFT2",45,0)
 D SET^VALM10(VALMCNT,"Comments: ")
"RTN","SDWLIFT2",46,0)
 S X=$$GET1^DIQ(409.35,SDWLIFTN_",",5,"Z","WP")
"RTN","SDWLIFT2",47,0)
 S SDWLI=0 F  S SDWLI=$O(WP(SDWLI)) Q:'SDWLI  S VALMCNT=VALMCNT+1 D SET^VALM10(VALMCNT,WP(SDWLI,0))
"RTN","SDWLIFT2",48,0)
 Q
"RTN","SDWLIFT2",49,0)
 ;
"RTN","SDWLIFT2",50,0)
HD ; -- Make header line for list processor
"RTN","SDWLIFT2",51,0)
 S X=$$SETSTR^VALM1("User: "_SDWLDZN,"",1,79)
"RTN","SDWLIFT2",52,0)
 S VALMHDR(1)=X,VALMHDR(2)=""
"RTN","SDWLIFT2",53,0)
 Q
"RTN","SDWLIFT2",54,0)
EXIT ; Tidy up
"RTN","SDWLIFT2",55,0)
 K SDWLIFTN
"RTN","SDWLIFT2",56,0)
 K VALMHDR
"RTN","SDWLIFT2",57,0)
 Q
"RTN","SDWLIFT3")
0^11^B62360655^B36385612
"RTN","SDWLIFT3",1,0)
SDWLIFT3 ;IOFO BAY PINES/OG - INTER-FACILITY TRANSFER: NEW TRANSFER  ; Compiled March 23, 2005 11:15:27  ; Compiled April 16, 2007 10:52:44
"RTN","SDWLIFT3",2,0)
 ;;5.3;Scheduling;**415,446**;AUG 13 1993;Build 77
"RTN","SDWLIFT3",3,0)
 ;
"RTN","SDWLIFT3",4,0)
 ;
"RTN","SDWLIFT3",5,0)
 ;******************************************************************
"RTN","SDWLIFT3",6,0)
 ;                             CHANGE LOG
"RTN","SDWLIFT3",7,0)
 ;                                               
"RTN","SDWLIFT3",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLIFT3",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLIFT3",10,0)
 ;   12/12/05                    SD*5.3*446              Enhancements
"RTN","SDWLIFT3",11,0)
 ;
"RTN","SDWLIFT3",12,0)
 Q
"RTN","SDWLIFT3",13,0)
EN ; INITIALIZE VARIABLES
"RTN","SDWLIFT3",14,0)
 N DIR,DIC,DR,DIE,VADM,X,Y
"RTN","SDWLIFT3",15,0)
 D FULL^VALM1
"RTN","SDWLIFT3",16,0)
 D EN2()
"RTN","SDWLIFT3",17,0)
 D INIT^SDWLIFT1(0)
"RTN","SDWLIFT3",18,0)
 ; VALMBCK required by List Manager
"RTN","SDWLIFT3",19,0)
 S VALMBCK="R"
"RTN","SDWLIFT3",20,0)
 Q
"RTN","SDWLIFT3",21,0)
EN2(SDWLDA) ; Entry point if Wait List has been selected elsewhere.
"RTN","SDWLIFT3",22,0)
 ; SDWLOPT is the option to be queried.
"RTN","SDWLIFT3",23,0)
 ; 1: Patient & Wait List Entry
"RTN","SDWLIFT3",24,0)
 ; 2: Institution
"RTN","SDWLIFT3",25,0)
 ; 3: Comments
"RTN","SDWLIFT3",26,0)
 ; 4: Processing
"RTN","SDWLIFT3",27,0)
 ; 5: Confirmation
"RTN","SDWLIFT3",28,0)
 N SDWLOPT,SDWLOPT0
"RTN","SDWLIFT3",29,0)
 S SDWLOPT=2
"RTN","SDWLIFT3",30,0)
 I '$D(SDWLDA) S SDWLDA="",SDWLOPT=1
"RTN","SDWLIFT3",31,0)
 S SDWLOPT0=SDWLOPT
"RTN","SDWLIFT3",32,0)
 F  D  Q:'SDWLOPT
"RTN","SDWLIFT3",33,0)
 .N SDWLDFN,SDWLDMN,SDWLIFTN,SDWLINST,DIC,DIE,DIR,DA,DO,I,Y,%,DIWETXT
"RTN","SDWLIFT3",34,0)
 .I SDWLOPT=1 D
"RTN","SDWLIFT3",35,0)
 ..N DFN,SDWLOK,SDWLOUT,SDWLC,SDWLI,SDWLNM,SDWLTMP
"RTN","SDWLIFT3",36,0)
 ..K Y,X
"RTN","SDWLIFT3",37,0)
 ..S DIC=2,DIC(0)="AEMZ",DIC("S")="I $$ISEWL^SDWLIFT3(+Y)"
"RTN","SDWLIFT3",38,0)
 ..D ^DIC
"RTN","SDWLIFT3",39,0)
 ..I Y=-1 S SDWLOPT=0 Q
"RTN","SDWLIFT3",40,0)
 ..S DFN=+Y  ; DFN used to uniquely identify the patient in the following look-up.
"RTN","SDWLIFT3",41,0)
 ..D LIST^DIC(409.3,,".01;2;4;5;6;7;8",,,,$P(Y,U,2),,"I $$ISEWL2^SDWLIFT3(Y,DFN)",,"SDWLTMP")
"RTN","SDWLIFT3",42,0)
 ..F I=1:1:+SDWLTMP("DILIST",0) D
"RTN","SDWLIFT3",43,0)
 ...N TMP,SDWLSTA
"RTN","SDWLIFT3",44,0)
 ...S TMP=""
"RTN","SDWLIFT3",45,0)
 ...I SDWLTMP("DILIST","ID",I,2)'="" S TMP=TMP_SDWLTMP("DILIST","ID",I,2)_"  "
"RTN","SDWLIFT3",46,0)
 ...D:SDWLTMP("DILIST","ID",I,4)'=""
"RTN","SDWLIFT3",47,0)
 ....S SDWLTMP("WLTY",I,0)=SDWLTMP("DILIST","ID",I,4),SDWLSTA=$$GET1^DIQ(409.3,SDWLTMP("DILIST",2,I),4,"I")
"RTN","SDWLIFT3",48,0)
 ....I SDWLTMP("DILIST","ID",I,SDWLSTA+4)'="" S SDWLTMP("WLTY",I,0)=SDWLTMP("WLTY",I,0)_" ("_SDWLTMP("DILIST","ID",I,SDWLSTA+4)_")"
"RTN","SDWLIFT3",49,0)
 ....S TMP=TMP_SDWLTMP("WLTY",I,0)
"RTN","SDWLIFT3",50,0)
 ....Q
"RTN","SDWLIFT3",51,0)
 ...S $P(DIR(0),";",I)=I_":"_TMP
"RTN","SDWLIFT3",52,0)
 ...Q
"RTN","SDWLIFT3",53,0)
 ..; If there is only one EWL entry, use that. The previous look-up will have ensured there is at least one.
"RTN","SDWLIFT3",54,0)
 ..; If there are more than one, call ^DIR to select.
"RTN","SDWLIFT3",55,0)
 ..S Y=1
"RTN","SDWLIFT3",56,0)
 ..I +SDWLTMP("DILIST",0)>1 S DIR(0)="S^"_DIR(0),DIR("A")="Enter 1 - "_+SDWLTMP("DILIST",0) D ^DIR  Q:Y="^"
"RTN","SDWLIFT3",57,0)
 ..W !?4,"Institution:",?20,SDWLTMP("DILIST","ID",Y,2)
"RTN","SDWLIFT3",58,0)
 ..W !?4,"Wait List Type:",?20,$G(SDWLTMP("WLTY",Y,0))
"RTN","SDWLIFT3",59,0)
 ..S SDWLDA=SDWLTMP("DILIST",2,Y)
"RTN","SDWLIFT3",60,0)
 ..I $D(^SDWL(409.36,"C",SDWLDA)) S SDWLOK=0 D  I SDWLOK S SDWLOPT=0 Q
"RTN","SDWLIFT3",61,0)
 ...N SDWLIFTN,SDWLSTN
"RTN","SDWLIFT3",62,0)
 ...S SDWLIFTN=$O(^SDWL(409.36,"C",SDWLDA,"")),SDWLSTN=$$GET1^DIQ(409.36,SDWLIFTN,".1")
"RTN","SDWLIFT3",63,0)
 ...S DIR(0)="E",DIR("A")="Press return to continue"
"RTN","SDWLIFT3",64,0)
 ...S DIR("A",1)="This EWL Entry is the result of a transfer request from "_$$GET1^DIQ(4,SDWLSTN,".01")_" ("_SDWLSTN_")"
"RTN","SDWLIFT3",65,0)
 ...;S DIR("A",2)="On acceptance at the destination facility, this EWL Entry will be removed."
"RTN","SDWLIFT3",66,0)
 ...S DIR("A",2)="To transfer care, close the EWL Entry as ER - ENTERED IN ERROR and reject the"
"RTN","SDWLIFT3",67,0)
 ...S DIR("A",3)="request. "_$$GET1^DIQ(4,SDWLSTN,".01")_" can then request the transfer."
"RTN","SDWLIFT3",68,0)
 ...D ^DIR
"RTN","SDWLIFT3",69,0)
 ...S SDWLOK=1
"RTN","SDWLIFT3",70,0)
 ...Q
"RTN","SDWLIFT3",71,0)
 ..S SDWLOPT=2
"RTN","SDWLIFT3",72,0)
 ..Q
"RTN","SDWLIFT3",73,0)
 .D:SDWLOPT=2
"RTN","SDWLIFT3",74,0)
 ..N SDWLY
"RTN","SDWLIFT3",75,0)
 ..S SDWLDFN=$$GET1^DIQ(409.3,SDWLDA,.01,"I")
"RTN","SDWLIFT3",76,0)
 ..S DIC=4
"RTN","SDWLIFT3",77,0)
 ..S DIC(0)="EMNQA"
"RTN","SDWLIFT3",78,0)
 ..S DIC("A")="Select Institution to transfer to: "
"RTN","SDWLIFT3",79,0)
 ..S DIC("S")="I $P(^DIC(4,+Y,0),U,11)=""N"",'+$P($G(^DIC(4,+Y,99)),U,4),$L($P($G(^DIC(4,+Y,99)),U))=3,$$GET1^DIQ(4,Y,13)=""VAMC"""
"RTN","SDWLIFT3",80,0)
 ..D ^DIC
"RTN","SDWLIFT3",81,0)
 ..I Y=-1 S SDWLOPT=$S(SDWLOPT0=2:0,1:1) Q  ; If the call was made to go straight to Institution, quit out if no institution is selected.
"RTN","SDWLIFT3",82,0)
 ..S SDWLY=+Y,SDWLDMN=$$GET1^DIQ(4,SDWLY,60)
"RTN","SDWLIFT3",83,0)
 ..I SDWLDMN=""  W !,"This Institution does not have a Domain to which the request can be sent." Q
"RTN","SDWLIFT3",84,0)
 ..S SDWLINST=SDWLY,SDWLOPT=3
"RTN","SDWLIFT3",85,0)
 ..Q
"RTN","SDWLIFT3",86,0)
 .D:SDWLOPT=3
"RTN","SDWLIFT3",87,0)
 ..S DIC="^TMP(""SDWLIFT"",$J,""COMMENT""",DIWETXT="Transfer comments"
"RTN","SDWLIFT3",88,0)
 ..W !,DIWETXT
"RTN","SDWLIFT3",89,0)
 ..K @(DIC_")") S DIC=DIC_","
"RTN","SDWLIFT3",90,0)
 ..D EN^DIWE
"RTN","SDWLIFT3",91,0)
 ..S SDWLOPT=4
"RTN","SDWLIFT3",92,0)
 ..Q
"RTN","SDWLIFT3",93,0)
 .D:SDWLOPT=4
"RTN","SDWLIFT3",94,0)
 ..N SDWLDTM
"RTN","SDWLIFT3",95,0)
 ..K DIC
"RTN","SDWLIFT3",96,0)
 ..S DIR(0)="Y",DIR("A")="OK to send",DIR("B")="YES" D ^DIR
"RTN","SDWLIFT3",97,0)
 ..I 'Y S SDWLOPT=0 Q
"RTN","SDWLIFT3",98,0)
 ..S DIC=409.35,DIC(0)="Z",X=SDWLDA
"RTN","SDWLIFT3",99,0)
 ..D FILE^DICN
"RTN","SDWLIFT3",100,0)
 ..S SDWLIFTN=+Y
"RTN","SDWLIFT3",101,0)
 ..S DA(1)=+Y,DIC=DIC_DA(1)_",1,",SDWLI=0
"RTN","SDWLIFT3",102,0)
 ..F  S SDWLI=$O(^TMP("SDWLIFT",$J,"COMMENT",SDWLI)) Q:'SDWLI  S X=^TMP("SDWLIFT",$J,"COMMENT",SDWLI,0) K DO D FILE^DICN
"RTN","SDWLIFT3",103,0)
 ..D NOW^%DTC S SDWLDTM=%
"RTN","SDWLIFT3",104,0)
 ..S DIE=409.35,DR="1///"_$$GET1^DIQ(4,SDWLINST,99)_";2///"_SDWLDTM_";3///P;4///`"_DUZ
"RTN","SDWLIFT3",105,0)
 ..D ^DIE
"RTN","SDWLIFT3",106,0)
 ..D MSG
"RTN","SDWLIFT3",107,0)
 ..S SDWLOPT=0 K DIR
"RTN","SDWLIFT3",108,0)
 ..;S DIR(0)="E" D ^DIR
"RTN","SDWLIFT3",109,0)
 ..Q
"RTN","SDWLIFT3",110,0)
 .Q
"RTN","SDWLIFT3",111,0)
 Q
"RTN","SDWLIFT3",112,0)
 ;
"RTN","SDWLIFT3",113,0)
ISEWL(DFN) ; Filter for seach of PATIENT file ; OG ; SD*5.3*446
"RTN","SDWLIFT3",114,0)
 N SDWLOK,SDWLDA
"RTN","SDWLIFT3",115,0)
 S SDWLOK=0
"RTN","SDWLIFT3",116,0)
 Q:'$D(^SDWL(409.3,"B",DFN)) SDWLOK
"RTN","SDWLIFT3",117,0)
 S SDWLDA=0
"RTN","SDWLIFT3",118,0)
 F  S SDWLDA=$O(^SDWL(409.3,"B",DFN,SDWLDA)) Q:'SDWLDA  I $$ISEWL2(SDWLDA,DFN) S SDWLOK=1 Q
"RTN","SDWLIFT3",119,0)
 Q SDWLOK
"RTN","SDWLIFT3",120,0)
 ;
"RTN","SDWLIFT3",121,0)
ISEWL2(SDWLDA,DFN) ; If the EWL entry exists, is not closed, is a team or team position assignment and not already in transit.
"RTN","SDWLIFT3",122,0)
 N TMP
"RTN","SDWLIFT3",123,0)
 ;Q $$GET1^DIQ(409.3,SDWLDA,23,"I")'="C"&'$$GETTRN^SDWLIFT1(SDWLDA)&($$GET1^DIQ(409.3,SDWLDA,.01,"I")=DFN) old way of doing it.
"RTN","SDWLIFT3",124,0)
 D GETS^DIQ(409.3,SDWLDA_",",".01;4;23","I","TMP")
"RTN","SDWLIFT3",125,0)
 Q:$G(TMP(409.3,SDWLDA_",",.01,"I"))'=DFN 0
"RTN","SDWLIFT3",126,0)
 Q TMP(409.3,SDWLDA_",",23,"I")'="C"&("^1^2^"[("^"_TMP(409.3,SDWLDA_",",4,"I")_"^"))&'$$GETTRN^SDWLIFT1(SDWLDA)
"RTN","SDWLIFT3",127,0)
 ;
"RTN","SDWLIFT3",128,0)
MSG ;acknowledgement notification to destination
"RTN","SDWLIFT3",129,0)
 N SDWLDA,SDWLDTM,DFN,TMP,SDWLTY,SDWLX,SDWLI,DIE,DA,DR,VAPA,WP
"RTN","SDWLIFT3",130,0)
 N XMSUB,XMY,XMTEXT,XMDUZ,SDWLX,SDWLI
"RTN","SDWLIFT3",131,0)
 S XMSUB="SDWL TRANSFER REQUEST"
"RTN","SDWLIFT3",132,0)
 S XMY("S.SDWL-XFER-SERVER@"_SDWLDMN)=""
"RTN","SDWLIFT3",133,0)
 S XMTEXT="SDWLX("
"RTN","SDWLIFT3",134,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLIFT3",135,0)
 D NOW^%DTC S SDWLDTM=%
"RTN","SDWLIFT3",136,0)
 S SDWLDA=$$GET1^DIQ(409.35,SDWLIFTN,.01,"I")
"RTN","SDWLIFT3",137,0)
 D GETS^DIQ(409.3,SDWLDA,".01;4;22","I","TMP")
"RTN","SDWLIFT3",138,0)
 S DFN=TMP(409.3,SDWLDA_",",.01,"I")
"RTN","SDWLIFT3",139,0)
 S SDWLTY=TMP(409.3,SDWLDA_",",4,"I")
"RTN","SDWLIFT3",140,0)
 D DEM^VADPT,ADD^VADPT
"RTN","SDWLIFT3",141,0)
 D GETS^DIQ(2,DFN,".301;.302;991.01","I","TMP")
"RTN","SDWLIFT3",142,0)
 S SDWLX(0)=0
"RTN","SDWLIFT3",143,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".01"_U_"NAME"_U_VADM(1)
"RTN","SDWLIFT3",144,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".02"_U_"SEX"_U_$P(VADM(5),U)
"RTN","SDWLIFT3",145,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".03"_U_"DATE OF BIRTH"_U_$P(VADM(3),U)
"RTN","SDWLIFT3",146,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".09"_U_"SOCIAL SECURITY NUMBER"_U_$P(VADM(2),U)
"RTN","SDWLIFT3",147,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".1"_U_"REQUESTING STATION NUMBER"_U_$P($$SITE^VASITE(),U,3)
"RTN","SDWLIFT3",148,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".111"_U_"STREET ADDRESS [LINE 1]"_U_VAPA(1)
"RTN","SDWLIFT3",149,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".112"_U_"STREET ADDRESS [LINE 2]"_U_VAPA(2)
"RTN","SDWLIFT3",150,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".113"_U_"STREET ADDRESS [LINE 3]"_U_VAPA(3)
"RTN","SDWLIFT3",151,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".114"_U_"CITY"_U_VAPA(4)
"RTN","SDWLIFT3",152,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".115"_U_"STATE"_U_VAPA(5)
"RTN","SDWLIFT3",153,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".116"_U_"ZIP CODE"_U_VAPA(6)
"RTN","SDWLIFT3",154,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".117"_U_"COUNTY"_U_$P(VAPA(7),U)
"RTN","SDWLIFT3",155,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".1217"_U_"TEMPORARY ADDRESS START DATE"_U_$P(VAPA(9),U)
"RTN","SDWLIFT3",156,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".1218"_U_"TEMPORARY ADDRESS END DATE"_U_$P(VAPA(10),U)
"RTN","SDWLIFT3",157,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".131"_U_"PHONE NUMBER [RESIDENCE]"_U_VAPA(8)
"RTN","SDWLIFT3",158,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".301"_U_"SERVICE CONNECTED?"_U_TMP(2,DFN_",",.301,"I")
"RTN","SDWLIFT3",159,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".302"_U_"SERVICE CONNECTED PERCENTAGE"_U_TMP(2,DFN_",",.302,"I")
"RTN","SDWLIFT3",160,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".361"_U_"PRIMARY ELIGIBILITY CODE"_U_$$GET1^DIQ(2,DFN,.361)
"RTN","SDWLIFT3",161,0)
 S X=$$GET1^DIQ(409.35,SDWLIFTN_",",5,"Z","WP")
"RTN","SDWLIFT3",162,0)
 S SDWLI=0 F  S SDWLI=$O(WP(SDWLI)) Q:'SDWLI  S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".4"_U_"COMMENTS"_U_WP(SDWLI,0)
"RTN","SDWLIFT3",163,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=".5"_U_"SENDING FACILITY TRANSFER ID"_U_SDWLIFTN
"RTN","SDWLIFT3",164,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=2_U_"TRANSMISSION DATE/TIME"_U_SDWLDTM
"RTN","SDWLIFT3",165,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=4_U_"WAIT LIST TYPE"_U_SDWLTY
"RTN","SDWLIFT3",166,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=5_U_"WAIT LIST TYPE EXTENSION"_U_$$GET1^DIQ(409.3,SDWLDA,4+SDWLTY)
"RTN","SDWLIFT3",167,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))=22_U_"DESIRED DATE OF APPOINTMENT"_U_TMP(409.3,SDWLDA_",",22,"I")
"RTN","SDWLIFT3",168,0)
 S SDWLX(0)=SDWLX(0)+1,SDWLX(SDWLX(0))="991.01"_U_"INTEGRATION CONTROL NUMBER"_U_TMP(2,DFN_",",991.01,"I")
"RTN","SDWLIFT3",169,0)
 D ^XMD
"RTN","SDWLIFT3",170,0)
 ; Change status of transfer file to TRANSMITTED
"RTN","SDWLIFT3",171,0)
 S DIE=409.35,DA=SDWLIFTN,DR="3///T" D ^DIE
"RTN","SDWLIFT3",172,0)
 ; Update the EWL Disposition code
"RTN","SDWLIFT3",173,0)
 S DIE=409.3,DA=SDWLDA,DR="21///TR" D ^DIE
"RTN","SDWLIFT3",174,0)
 Q
"RTN","SDWLIFT5")
0^40^B17476233^B15806000
"RTN","SDWLIFT5",1,0)
SDWLIFT5 ;IOFO BAY PINES/OG - INTER-FACILITY TRANSFER: ACCEPT DATA - MAIN SCREEN  ; Compiled March 29, 2005 15:26:24  ; Compiled January 26, 2007 10:05:24
"RTN","SDWLIFT5",2,0)
 ;;5.3;Scheduling;**415,446**;AUG 13 1993;Build 77
"RTN","SDWLIFT5",3,0)
 ;
"RTN","SDWLIFT5",4,0)
 ;
"RTN","SDWLIFT5",5,0)
 ;******************************************************************
"RTN","SDWLIFT5",6,0)
 ;                             CHANGE LOG
"RTN","SDWLIFT5",7,0)
 ;                                               
"RTN","SDWLIFT5",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLIFT5",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLIFT5",10,0)
 ;   10/03/06                    SD*5.3*446              Enhancements
"RTN","SDWLIFT5",11,0)
 ;
"RTN","SDWLIFT5",12,0)
 Q
"RTN","SDWLIFT5",13,0)
EN ; INITIALIZE VARIABLES
"RTN","SDWLIFT5",14,0)
 K DIR,DIC,DR,DIE,VADM,SDWLLIST,VALMHDR,VALMCNT,VALMBCK
"RTN","SDWLIFT5",15,0)
 D EN^VALM("SDWL TRANSFER ACC MAIN")
"RTN","SDWLIFT5",16,0)
 Q
"RTN","SDWLIFT5",17,0)
INIT ; Default initialization options.
"RTN","SDWLIFT5",18,0)
 K ^TMP("DILIST",$J),^TMP("SDWLIFT",$J,"EP")
"RTN","SDWLIFT5",19,0)
 N SDWLI,DIC
"RTN","SDWLIFT5",20,0)
 S SDWLSPS=$J("",80)
"RTN","SDWLIFT5",21,0)
 S VALMCNT=0
"RTN","SDWLIFT5",22,0)
 D GETLIST F SDWLI=1:1:SDWLLIST(0) D
"RTN","SDWLIFT5",23,0)
 .N SDWLOUT
"RTN","SDWLIFT5",24,0)
 .S VALMCNT=VALMCNT+1
"RTN","SDWLIFT5",25,0)
 .S SDWLOUT=$E(VALMCNT_SDWLSPS,1,3)
"RTN","SDWLIFT5",26,0)
 .S SDWLOUT=SDWLOUT_$E($P(SDWLLIST(SDWLI,0),U)_SDWLSPS,1,26)_" "
"RTN","SDWLIFT5",27,0)
 .S SDWLOUT=SDWLOUT_$E($P(SDWLLIST(SDWLI,0),U,2)_SDWLSPS,1,21)_" "
"RTN","SDWLIFT5",28,0)
 .S SDWLOUT=SDWLOUT_$E($P(SDWLLIST(SDWLI,0),U,3)_SDWLSPS,1,25)_" "
"RTN","SDWLIFT5",29,0)
 .S SDWLOUT=SDWLOUT_$P(SDWLLIST(SDWLI,0),U,4)
"RTN","SDWLIFT5",30,0)
 .D SET^VALM10(VALMCNT,SDWLOUT)
"RTN","SDWLIFT5",31,0)
 .Q
"RTN","SDWLIFT5",32,0)
 I 'VALMCNT S VALMCNT=1 D SET^VALM10(VALMCNT," ** No transfer details... ")
"RTN","SDWLIFT5",33,0)
 Q
"RTN","SDWLIFT5",34,0)
HD ; -- Make header line for list processor
"RTN","SDWLIFT5",35,0)
 S (VALMHDR(1),VALMHDR(2))=""
"RTN","SDWLIFT5",36,0)
 Q
"RTN","SDWLIFT5",37,0)
EXIT ; Tidy up
"RTN","SDWLIFT5",38,0)
 K ^TMP("DILIST",$J),^TMP("SDWLIFT",$J,"EP")
"RTN","SDWLIFT5",39,0)
 K SDWLLIST,SDWLSPS,SDWLIFTN
"RTN","SDWLIFT5",40,0)
 Q
"RTN","SDWLIFT5",41,0)
GETLIST ;
"RTN","SDWLIFT5",42,0)
 N SDWLI
"RTN","SDWLIFT5",43,0)
 S DIC=409.36
"RTN","SDWLIFT5",44,0)
 D LIST^DIC(DIC)
"RTN","SDWLIFT5",45,0)
 S (SDWLI,SDWLLIST(0))=0,DIC(0)="Z"
"RTN","SDWLIFT5",46,0)
 F  S SDWLI=$O(^TMP("DILIST",$J,2,SDWLI)) Q:'SDWLI  D
"RTN","SDWLIFT5",47,0)
 .N TMP,SDWLIFTN,SDWLST,DIC,D,X
"RTN","SDWLIFT5",48,0)
 .S SDWLIFTN=^TMP("DILIST",$J,2,SDWLI)
"RTN","SDWLIFT5",49,0)
 .D GETS^DIQ(409.36,SDWLIFTN,".01;.02;.03;.09;.1;.2;1",,"TMP")
"RTN","SDWLIFT5",50,0)
 .S SDWLST=$$GET1^DIQ(409.36,SDWLIFTN,1,"I")
"RTN","SDWLIFT5",51,0)
 .Q:SDWLST="C"!(SDWLST="R")!(SDWLST="T")
"RTN","SDWLIFT5",52,0)
 .S SDWLLIST(0)=SDWLLIST(0)+1
"RTN","SDWLIFT5",53,0)
 .S SDWLLIST(SDWLLIST(0),0)=TMP(409.36,SDWLIFTN_",",.01)
"RTN","SDWLIFT5",54,0)
 .S $P(SDWLLIST(SDWLLIST(0),0),U,2)=TMP(409.36,SDWLIFTN_",",.2)  ; date/time
"RTN","SDWLIFT5",55,0)
 .S $P(SDWLLIST(SDWLLIST(0),0),U,3)=$$GET1^DIQ(4,$$FIND1^DIC(4,"","X",TMP(409.36,SDWLIFTN_",",.1),"D"),.01)
"RTN","SDWLIFT5",56,0)
 .S $P(SDWLLIST(SDWLLIST(0),0),U,4)=SDWLST
"RTN","SDWLIFT5",57,0)
 .S SDWLLIST(SDWLLIST(0),1)=SDWLIFTN
"RTN","SDWLIFT5",58,0)
 .Q
"RTN","SDWLIFT5",59,0)
 Q
"RTN","SDWLIFT5",60,0)
GETDATA(SDWLOUT,SDWLFMT) ; Get request data for display.
"RTN","SDWLIFT5",61,0)
 ; SDWLFMT - output format: 0: filtered, only active transmissions
"RTN","SDWLIFT5",62,0)
 ;                          1: all transmissions
"RTN","SDWLIFT5",63,0)
 ;                          2: filtered, only inactive transmissions
"RTN","SDWLIFT5",64,0)
 N SDWLI,DIC,X,Y
"RTN","SDWLIFT5",65,0)
 S DIC=409.35
"RTN","SDWLIFT5",66,0)
 D LIST^DIC(DIC)
"RTN","SDWLIFT5",67,0)
 S (SDWLI,SDWLOUT(0))=0,DIC(0)="Z"
"RTN","SDWLIFT5",68,0)
 F  S SDWLI=$O(^TMP("DILIST",$J,2,SDWLI)) Q:'SDWLI  S X="`"_^TMP("DILIST",$J,2,SDWLI) D ^DIC I $D(Y(0)) D
"RTN","SDWLIFT5",69,0)
 .N REC,SDWLNAM,DFN,SDWLDA,SDWLSTA,TMP,SDWLIFTN,SDWLTY,SDWLTV,VADM,DIC,D,X
"RTN","SDWLIFT5",70,0)
 .S REC=Y(0),SDWLNAM=Y(0,0),SDWLDA=$P(Y(0),U),SDWLIFTN=+Y,DFN=$$GET1^DIQ(409.3,SDWLDA,.01,"I")
"RTN","SDWLIFT5",71,0)
 .D GETS^DIQ(409.35,SDWLIFTN,"1;2;3;4",,"TMP")
"RTN","SDWLIFT5",72,0)
 .S SDWLSTA=TMP(409.35,SDWLIFTN_",",3),SDWLTV=SDWLSTA="RESOLVED"!(SDWLSTA="REFUSED")
"RTN","SDWLIFT5",73,0)
 .I 'SDWLFMT Q:SDWLTV  ; Only show 'active' transmissions.
"RTN","SDWLIFT5",74,0)
 .I SDWLFMT=2 Q:'SDWLTV  ; Only show 'inactive' transmissions.
"RTN","SDWLIFT5",75,0)
 .D DEM^VADPT
"RTN","SDWLIFT5",76,0)
 .D GETS^DIQ(409.3,SDWLDA,"2;4",,"TMP")
"RTN","SDWLIFT5",77,0)
 .S SDWLOUT(0)=SDWLOUT(0)+1
"RTN","SDWLIFT5",78,0)
 .S SDWLOUT(SDWLOUT(0),1)=SDWLIFTN
"RTN","SDWLIFT5",79,0)
 .; Name
"RTN","SDWLIFT5",80,0)
 .S SDWLOUT(SDWLOUT(0),0)=SDWLNAM
"RTN","SDWLIFT5",81,0)
 .; SSN
"RTN","SDWLIFT5",82,0)
 .S $P(SDWLOUT(SDWLOUT(0),0),U,2)=$P(VADM(2),U,2)
"RTN","SDWLIFT5",83,0)
 .; Destination Institution
"RTN","SDWLIFT5",84,0)
 .S $P(SDWLOUT(SDWLOUT(0),0),U,3)=$$GET1^DIQ(4,$$FIND1^DIC(4,"","X",TMP(409.35,SDWLIFTN_",",1),"D"),.01)
"RTN","SDWLIFT5",85,0)
 .; Transfer Status
"RTN","SDWLIFT5",86,0)
 .S $P(SDWLOUT(SDWLOUT(0),0),U,4)=SDWLSTA
"RTN","SDWLIFT5",87,0)
 .; Current Wait List Institution
"RTN","SDWLIFT5",88,0)
 .S $P(SDWLOUT(SDWLOUT(0),0),U,5)=TMP(409.3,SDWLDA_",",2)
"RTN","SDWLIFT5",89,0)
 .; Current Wait List Type
"RTN","SDWLIFT5",90,0)
 .S $P(SDWLOUT(SDWLOUT(0),0),U,6)=TMP(409.3,SDWLDA_",",4)
"RTN","SDWLIFT5",91,0)
 .; Current Wait List Type Extension
"RTN","SDWLIFT5",92,0)
 .S SDWLTY=$$GET1^DIQ(409.3,SDWLDA,4,"I")
"RTN","SDWLIFT5",93,0)
 .S $P(SDWLOUT(SDWLOUT(0),0),U,7)=$$GET1^DIQ(409.3,SDWLDA,SDWLTY+4)
"RTN","SDWLIFT5",94,0)
 .; Sex
"RTN","SDWLIFT5",95,0)
 .S $P(SDWLOUT(SDWLOUT(0),0),U,8)=$P(VADM(5),U,2)
"RTN","SDWLIFT5",96,0)
 .; Transmission date/time
"RTN","SDWLIFT5",97,0)
 .S $P(SDWLOUT(SDWLOUT(0),0),U,9)=TMP(409.35,SDWLIFTN_",",2)
"RTN","SDWLIFT5",98,0)
 .; Requestor
"RTN","SDWLIFT5",99,0)
 .S $P(SDWLOUT(SDWLOUT(0),0),U,10)=TMP(409.35,SDWLIFTN_",",4)
"RTN","SDWLIFT5",100,0)
 .Q
"RTN","SDWLIFT5",101,0)
 Q
"RTN","SDWLIFT6")
0^12^B60221443^B38500505
"RTN","SDWLIFT6",1,0)
SDWLIFT6 ;IOFO BAY PINES/OG - INTER-FACILITY TRANSFER: DISPLAY ACCEPT DETAILS  ; Compiled March 23, 2005 12:38:06  ; Compiled January 25, 2007 16:34:01
"RTN","SDWLIFT6",2,0)
 ;;5.3;Scheduling;**415,446**;AUG 13 1993;Build 77
"RTN","SDWLIFT6",3,0)
 ;
"RTN","SDWLIFT6",4,0)
 ;
"RTN","SDWLIFT6",5,0)
 ;******************************************************************
"RTN","SDWLIFT6",6,0)
 ;                             CHANGE LOG
"RTN","SDWLIFT6",7,0)
 ;                                               
"RTN","SDWLIFT6",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLIFT6",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLIFT6",10,0)
 ;   04/14/2006                  SD*5.3*446              INTER-FACILITY TRANSFER
"RTN","SDWLIFT6",11,0)
 ;
"RTN","SDWLIFT6",12,0)
 Q
"RTN","SDWLIFT6",13,0)
EN ; INITIALIZE VARIABLES FOR DISPLAY
"RTN","SDWLIFT6",14,0)
 N DFN,SDWLI,SDWLOK,SDWLIFN0
"RTN","SDWLIFT6",15,0)
 K SDWLLIST
"RTN","SDWLIFT6",16,0)
 D GETLIST^SDWLIFT5
"RTN","SDWLIFT6",17,0)
 S (SDWLIFTN,SDWLIFN0)=$$GETTN^SDWLIFT(.SDWLLIST)
"RTN","SDWLIFT6",18,0)
 I 'SDWLIFTN S VALMBCK="R" Q
"RTN","SDWLIFT6",19,0)
 L +^SDWL(409.36,SDWLIFTN):10 I '$T S VALMBCK="R" Q
"RTN","SDWLIFT6",20,0)
 ; Refresh list and loop to ensure that the selection hasn't been removed while the choice was being made.
"RTN","SDWLIFT6",21,0)
 K SDWLLIST D GETLIST^SDWLIFT5
"RTN","SDWLIFT6",22,0)
 S (SDWLOK,SDWLI)=0 F  S SDWLI=$O(SDWLLIST(SDWLI)) Q:'SDWLI  I SDWLLIST(SDWLI,1)=SDWLIFTN S SDWLOK=1 Q
"RTN","SDWLIFT6",23,0)
 D:SDWLOK
"RTN","SDWLIFT6",24,0)
 .N DIC,DFN,SDWLDFN,SDWLICN,SDWLSSN,SDWLTY,X,Y
"RTN","SDWLIFT6",25,0)
 .S SDWLICN=$$GET1^DIQ(409.36,SDWLIFTN,991.01)
"RTN","SDWLIFT6",26,0)
 .S SDWLSSN=$$GET1^DIQ(409.36,SDWLIFTN,.09)
"RTN","SDWLIFT6",27,0)
 .S (DFN,SDWLDFN)=$S(+SDWLICN:$O(^DPT("AICN",SDWLICN,"")),1:"")
"RTN","SDWLIFT6",28,0)
 .I DFN="" S (DFN,SDWLDFN)=$S(+SDWLSSN:$O(^DPT("SSN",SDWLSSN,"")),1:"")
"RTN","SDWLIFT6",29,0)
 .S SDWLTY=$$GET1^DIQ(409.36,SDWLIFTN,4,"I")
"RTN","SDWLIFT6",30,0)
 .D EN^VALM("SDWL TRANSFER ACC VIEW")
"RTN","SDWLIFT6",31,0)
 .Q
"RTN","SDWLIFT6",32,0)
 L -^SDWL(409.36,SDWLIFN0)
"RTN","SDWLIFT6",33,0)
 D INIT^SDWLIFT5
"RTN","SDWLIFT6",34,0)
 S VALMBCK="R"
"RTN","SDWLIFT6",35,0)
 Q
"RTN","SDWLIFT6",36,0)
INIT ; Default initialization options.
"RTN","SDWLIFT6",37,0)
 N SDWLINFO
"RTN","SDWLIFT6",38,0)
 D GETINFO(.SDWLINFO)
"RTN","SDWLIFT6",39,0)
 F VALMCNT=1:1:SDWLINFO(0) D SET^VALM10(VALMCNT,SDWLINFO(VALMCNT,0))
"RTN","SDWLIFT6",40,0)
 Q
"RTN","SDWLIFT6",41,0)
GETINFO(SDWLOUT) ; The Coversheet function calls here too.
"RTN","SDWLIFT6",42,0)
 N DIC,D,X,WP,TMP,SDWLADD,SDWLFID,SDWLI
"RTN","SDWLIFT6",43,0)
 D GETS^DIQ(409.36,SDWLIFTN,"*",,"TMP")
"RTN","SDWLIFT6",44,0)
 S SDWLOUT(0)=1
"RTN","SDWLIFT6",45,0)
 D:SDWLDFN=""
"RTN","SDWLIFT6",46,0)
 .S SDWLOUT(SDWLOUT(0),0)="Patient not registered"
"RTN","SDWLIFT6",47,0)
 .S SDWLOUT(0)=SDWLOUT(0)+1
"RTN","SDWLIFT6",48,0)
 .D CNTRL^VALM10(1,1,22,IOINHI,IOINORM)
"RTN","SDWLIFT6",49,0)
 .Q
"RTN","SDWLIFT6",50,0)
 S SDWLOUT(SDWLOUT(0),0)="Transmg. Inst: "_$E($$GET1^DIQ(4,$$FIND1^DIC(4,"","X",TMP(409.36,SDWLIFTN_",",.1),"D"),.01)_SDWLSPS,1,28)_" "
"RTN","SDWLIFT6",51,0)
 S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_"Transmn. Date: "_TMP(409.36,SDWLIFTN_",",.2)
"RTN","SDWLIFT6",52,0)
 S SDWLOUT(0)=SDWLOUT(0)+1
"RTN","SDWLIFT6",53,0)
 S SDWLOUT(SDWLOUT(0),0)="Name: "_$E(TMP(409.36,SDWLIFTN_",",.01)_SDWLSPS,1,27)_" "
"RTN","SDWLIFT6",54,0)
 S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_"Sex: "_$E(TMP(409.36,SDWLIFTN_",",.02)_SDWLSPS,1,7)
"RTN","SDWLIFT6",55,0)
 S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_"DoB: "_$E(TMP(409.36,SDWLIFTN_",",.03)_SDWLSPS,1,13)
"RTN","SDWLIFT6",56,0)
 S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_"SSN: "_TMP(409.36,SDWLIFTN_",",.09)
"RTN","SDWLIFT6",57,0)
 ;
"RTN","SDWLIFT6",58,0)
 S SDWLOUT(0)=SDWLOUT(0)+1,SDWLADD=SDWLOUT(0)
"RTN","SDWLIFT6",59,0)
 S SDWLOUT(SDWLOUT(0),0)=$E("Address: "_TMP(409.36,SDWLIFTN_",",.111)_SDWLSPS,1,58)_" Status: "_TMP(409.36,SDWLIFTN_",",1)
"RTN","SDWLIFT6",60,0)
 F SDWLFID=.112:.001:.114,.117 I TMP(409.36,SDWLIFTN_",",SDWLFID)'=""  S SDWLOUT(0)=SDWLOUT(0)+1,SDWLOUT(SDWLOUT(0),0)=$E(SDWLSPS,1,9)_TMP(409.36,SDWLIFTN_",",SDWLFID)
"RTN","SDWLIFT6",61,0)
 I TMP(409.36,SDWLIFTN_",",.115)_TMP(409.36,SDWLIFTN_",",.116)'="" D
"RTN","SDWLIFT6",62,0)
 .S SDWLOUT(0)=SDWLOUT(0)+1
"RTN","SDWLIFT6",63,0)
 .S SDWLOUT(SDWLOUT(0),0)=$E(SDWLSPS,1,9)
"RTN","SDWLIFT6",64,0)
 .I TMP(409.36,SDWLIFTN_",",.115)'="" S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_TMP(409.36,SDWLIFTN_",",.115)
"RTN","SDWLIFT6",65,0)
 .S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_" "_TMP(409.36,SDWLIFTN_",",.116)
"RTN","SDWLIFT6",66,0)
 .Q
"RTN","SDWLIFT6",67,0)
 I TMP(409.36,SDWLIFTN_",",.131)'="" S SDWLOUT(0)=SDWLOUT(0)+1,SDWLOUT(SDWLOUT(0),0)="Phone no "_TMP(409.36,SDWLIFTN_",",.131)
"RTN","SDWLIFT6",68,0)
 D:TMP(409.36,SDWLIFTN_",",.1217)'=""  ; Temporary address details. Displayed to the right of the address in up to 3 lines starting column 62
"RTN","SDWLIFT6",69,0)
 .S SDWLOUT(SDWLADD,0)=$E(SDWLOUT(SDWLADD,0)_SDWLSPS,1,61)_"Temporary address"  ; There should be at least three lines if it is also indicated as temporary.
"RTN","SDWLIFT6",70,0)
 .S SDWLOUT(SDWLADD+1,0)=$E(SDWLOUT(SDWLADD+1,0)_SDWLSPS,1,61)_"From: "_TMP(409.36,SDWLIFTN_",",.1217)
"RTN","SDWLIFT6",71,0)
 .S SDWLOUT(SDWLADD+2,0)=$E(SDWLOUT(SDWLADD+2,0)_SDWLSPS,1,61)_"To  : "_TMP(409.36,SDWLIFTN_",",.1218)
"RTN","SDWLIFT6",72,0)
 .Q
"RTN","SDWLIFT6",73,0)
 S SDWLOUT(0)=SDWLOUT(0)+1,SDWLOUT(SDWLOUT(0),0)="Service connected: "_TMP(409.36,SDWLIFTN_",",.301)
"RTN","SDWLIFT6",74,0)
 I TMP(409.36,SDWLIFTN_",",.301)="YES" S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_"  Percentage: "_TMP(409.36,SDWLIFTN_",",.302)
"RTN","SDWLIFT6",75,0)
 S SDWLOUT(0)=SDWLOUT(0)+1,SDWLOUT(SDWLOUT(0),0)="Primary Eligibility: "_TMP(409.36,SDWLIFTN_",",.361)
"RTN","SDWLIFT6",76,0)
 S SDWLOUT(0)=SDWLOUT(0)+1,SDWLOUT(SDWLOUT(0),0)="Wait List Type: "
"RTN","SDWLIFT6",77,0)
 S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_TMP(409.36,SDWLIFTN_",",4)_" : "_TMP(409.36,SDWLIFTN_",",5)
"RTN","SDWLIFT6",78,0)
 S SDWLOUT(0)=SDWLOUT(0)+1,SDWLOUT(SDWLOUT(0),0)="Desired Date of Appt: "
"RTN","SDWLIFT6",79,0)
 S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_TMP(409.36,SDWLIFTN_",",22)
"RTN","SDWLIFT6",80,0)
 S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_"  Integration Control Number: "
"RTN","SDWLIFT6",81,0)
 S SDWLOUT(SDWLOUT(0),0)=SDWLOUT(SDWLOUT(0),0)_TMP(409.36,SDWLIFTN_",",991.01)
"RTN","SDWLIFT6",82,0)
 S SDWLOUT(0)=SDWLOUT(0)+1,SDWLOUT(SDWLOUT(0),0)="Comments: "
"RTN","SDWLIFT6",83,0)
 S X=$$GET1^DIQ(409.36,SDWLIFTN_",",.4,"Z","WP")
"RTN","SDWLIFT6",84,0)
 S SDWLI=0 F  S SDWLI=$O(WP(SDWLI)) Q:'SDWLI  S SDWLOUT(0)=SDWLOUT(0)+1,SDWLOUT(SDWLOUT(0),0)=WP(SDWLI,0)
"RTN","SDWLIFT6",85,0)
 Q
"RTN","SDWLIFT6",86,0)
GETTN(SDWLLIST) ; Get transfer id.
"RTN","SDWLIFT6",87,0)
 N DIR,Y
"RTN","SDWLIFT6",88,0)
 I 'SDWLLIST(0) S DIR(0)="Y",DIR("A")="No entries. OK",DIR("B")="YES" D ^DIR Q 0
"RTN","SDWLIFT6",89,0)
 I SDWLLIST(0)=1 S Y=1  ; If there is only one, don't ask.
"RTN","SDWLIFT6",90,0)
 E  S DIR(0)="L^1:"_SDWLLIST(0),DIR("A")="Which entry?" D ^DIR
"RTN","SDWLIFT6",91,0)
 Q $G(SDWLLIST(+Y,1),0)
"RTN","SDWLIFT6",92,0)
HD ; -- Make header line for list processor
"RTN","SDWLIFT6",93,0)
 S (VALMHDR(1),VALMHDR(2))=""
"RTN","SDWLIFT6",94,0)
 Q
"RTN","SDWLIFT6",95,0)
PCMM(SDWLIFTN,DFN) ;
"RTN","SDWLIFT6",96,0)
 N SDWLPCMM,SDWLRES,DIE,DA,DR
"RTN","SDWLIFT6",97,0)
 I $G(DFN)="" W !,"Patient not entered on the system. Use Load/edit" S DIR(0)="E",VALMBCK="R" D ^DIR Q
"RTN","SDWLIFT6",98,0)
 S (SDWLPCMM,SDWLRES)=0
"RTN","SDWLIFT6",99,0)
 D PAT^SCMCQK
"RTN","SDWLIFT6",100,0)
 ;If a PCMM assignment was made, close 409.36
"RTN","SDWLIFT6",101,0)
 ;if an EWL Entry was created instead, add pointer
"RTN","SDWLIFT6",102,0)
 ;then pass a message back.
"RTN","SDWLIFT6",103,0)
 Q:'SDWLPCMM&'SDWLRES
"RTN","SDWLIFT6",104,0)
 S DIE="^SDWL(409.36,",DA=SDWLIFTN
"RTN","SDWLIFT6",105,0)
 I SDWLPCMM S DR="1///C"
"RTN","SDWLIFT6",106,0)
 E  S DR="409.3///"_$P(SDWLRES,U,2)
"RTN","SDWLIFT6",107,0)
 D ^DIE,SENDST(SDWLIFTN)
"RTN","SDWLIFT6",108,0)
 Q
"RTN","SDWLIFT6",109,0)
 ;
"RTN","SDWLIFT6",110,0)
ACCEPT ; Sign the transaction off as accepted. Remove the temporary file and send a message to transmitting facility
"RTN","SDWLIFT6",111,0)
 N DIR
"RTN","SDWLIFT6",112,0)
 I $$GET1^DIQ(409.36,SDWLIFTN,.3)'="YES" D  Q
"RTN","SDWLIFT6",113,0)
 .S DIR("A")="A coversheet does not appear to have been requested."_$C(13,10)_"This is required before acceptance. Enter RETURN to continue or '^' to exit"
"RTN","SDWLIFT6",114,0)
 .S DIR(0)="E"
"RTN","SDWLIFT6",115,0)
 .D ^DIR
"RTN","SDWLIFT6",116,0)
 .S VALMBCK=$S(Y:"R",1:"Q")
"RTN","SDWLIFT6",117,0)
 .Q
"RTN","SDWLIFT6",118,0)
 D FULL^VALM1
"RTN","SDWLIFT6",119,0)
 S DIR(0)="Y"
"RTN","SDWLIFT6",120,0)
 S DIR("A")="Do you confirm that the appropriate action was taken to schedule this patient"_$C(13,10)_"for an appointment or she/he has EWL entry and the cover sheet has been printed"
"RTN","SDWLIFT6",121,0)
 S DIR("B")="N"
"RTN","SDWLIFT6",122,0)
 D ^DIR
"RTN","SDWLIFT6",123,0)
 D:Y
"RTN","SDWLIFT6",124,0)
 .N SDWLSTN,SDWLINST,XMY,XMSUB,XMTEXT,XMDUZ,SDWLX,DA,DIK
"RTN","SDWLIFT6",125,0)
 .S SDWLSTN=$$GET1^DIQ(409.36,SDWLIFTN,.1)
"RTN","SDWLIFT6",126,0)
 .S SDWLINST=$$FIND1^DIC(4,"","X",SDWLSTN,"D")
"RTN","SDWLIFT6",127,0)
 .S XMY("S.SDWL-XFER-SERVER@"_$$GET1^DIQ(4,SDWLINST,60))=""
"RTN","SDWLIFT6",128,0)
 .S XMSUB="SDWL TRANSFER ACCEPTANCE"
"RTN","SDWLIFT6",129,0)
 .S XMTEXT="SDWLX("
"RTN","SDWLIFT6",130,0)
 .S XMDUZ="POSTMASTER"
"RTN","SDWLIFT6",131,0)
 .S SDWLX(1,0)=".5"_U_"SENDING FACILITY TRANSFER ID"_U_$$GET1^DIQ(409.36,SDWLIFTN,.5)
"RTN","SDWLIFT6",132,0)
 .S SDWLX(2,0)="7"_U_"ACCEPTING PERSON"_U_$$GET1^DIQ(200,DUZ,.01)
"RTN","SDWLIFT6",133,0)
 .S SDWLX(0)=2
"RTN","SDWLIFT6",134,0)
 .D ^XMD
"RTN","SDWLIFT6",135,0)
 .S DA=SDWLIFTN,DIK="^SDWL(409.36," D ^DIK
"RTN","SDWLIFT6",136,0)
 .Q
"RTN","SDWLIFT6",137,0)
 S VALMBCK="Q"
"RTN","SDWLIFT6",138,0)
 Q
"RTN","SDWLIFT6",139,0)
REJECT ; Sign the transaction off as rejected. Remove the temporary file and send a message to transmitting facility
"RTN","SDWLIFT6",140,0)
 N SDWLSTN,SDWLINST,XMSUB,XMY,XMTEXT,XMDUZ,SDWLX
"RTN","SDWLIFT6",141,0)
 S SDWLSTN=$$GET1^DIQ(409.36,SDWLIFTN,.1)
"RTN","SDWLIFT6",142,0)
 S SDWLINST=$$FIND1^DIC(4,"","X",SDWLSTN,"D")
"RTN","SDWLIFT6",143,0)
 S XMY("S.SDWL-XFER-SERVER@"_$$GET1^DIQ(4,SDWLINST,60))=""
"RTN","SDWLIFT6",144,0)
 S XMSUB="SDWL TRANSFER REJECTION"
"RTN","SDWLIFT6",145,0)
 S XMTEXT="SDWLX("
"RTN","SDWLIFT6",146,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLIFT6",147,0)
 S SDWLX(1,0)=".5"_U_"SENDING FACILITY TRANSFER ID"_U_$$GET1^DIQ(409.36,SDWLIFTN,.5)
"RTN","SDWLIFT6",148,0)
 S SDWLX(0)=1
"RTN","SDWLIFT6",149,0)
 D ^XMD
"RTN","SDWLIFT6",150,0)
 S DA=SDWLIFTN,DIK="^SDWL(409.36," D ^DIK
"RTN","SDWLIFT6",151,0)
 ;teh/05/20/2005 cleans the SDWLLIST array and reset count.
"RTN","SDWLIFT6",152,0)
 K SDWLLIST(SDWLIFTN)
"RTN","SDWLIFT6",153,0)
 S SDWLLIST(0)=SDWLLIST(0)-1
"RTN","SDWLIFT6",154,0)
 S VALMBCK="Q"
"RTN","SDWLIFT6",155,0)
EXIT ; Tidy up
"RTN","SDWLIFT6",156,0)
 K SDWLIFTN
"RTN","SDWLIFT6",157,0)
 Q
"RTN","SDWLIFT6",158,0)
SENDST(SDWLIFTN) ; Send status change notification
"RTN","SDWLIFT6",159,0)
 N SDWLSTN,SDWLINST,TMP,XMSUB,XMY,XMTEXT,XMDUZ,SDWLX,SDWLDA,SDWLDIS
"RTN","SDWLIFT6",160,0)
 S SDWLDA=$$GET1^DIQ(409.36,SDWLIFTN,409.3,"I"),SDWLDIS=$$GET1^DIQ(409.3,SDWLDA,21,"I")
"RTN","SDWLIFT6",161,0)
 D GETS^DIQ(409.36,SDWLIFTN,".1;.5;1;2","I","TMP")
"RTN","SDWLIFT6",162,0)
 S SDWLSTN=TMP(409.36,SDWLIFTN_",",.1,"I")
"RTN","SDWLIFT6",163,0)
 S SDWLINST=$$FIND1^DIC(4,"","X",SDWLSTN,"D")
"RTN","SDWLIFT6",164,0)
 S XMY("S.SDWL-XFER-SERVER@"_$$GET1^DIQ(4,SDWLINST,60))=""
"RTN","SDWLIFT6",165,0)
 S XMSUB="SDWL TRANSFER STATUS CHANGE"
"RTN","SDWLIFT6",166,0)
 S XMTEXT="SDWLX("
"RTN","SDWLIFT6",167,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLIFT6",168,0)
 S SDWLX(1,0)=.5_U_"SENDING FACILITY TRANSFER ID"_U_TMP(409.36,SDWLIFTN_",",.5,"I")
"RTN","SDWLIFT6",169,0)
 S SDWLX(2,0)=1_U_"STATUS"_U_TMP(409.36,SDWLIFTN_",",1,"I")
"RTN","SDWLIFT6",170,0)
 S SDWLX(3,0)=7_U_"ACCEPTING PERSON"_U_$$GET1^DIQ(200,DUZ,.01)
"RTN","SDWLIFT6",171,0)
 S SDWLX(4,0)=2_U_"FACILITY TRANFERRED TO"_U_TMP(409.36,SDWLIFTN_",",2,"I")
"RTN","SDWLIFT6",172,0)
 S SDWLX(5,0)=21_U_"DISPOSITION"_U_SDWLDIS
"RTN","SDWLIFT6",173,0)
 S SDWLX(0)=5
"RTN","SDWLIFT6",174,0)
 D ^XMD
"RTN","SDWLIFT6",175,0)
 Q
"RTN","SDWLMSG")
0^25^B50689156^B36616948
"RTN","SDWLMSG",1,0)
SDWLMSG ;IOFO BAY PINES/DMR - EWL-SC PRIORITY BACKGROUND MESSAGES;09/02/2004 2:10 PM [5/12/05 2:58pm]  ; Compiled June 7, 2006 11:07:43  ; Compiled May 1, 2007 15:08:25
"RTN","SDWLMSG",2,0)
 ;;5.3;scheduling;**327,394,446**;AUG 13, 1993;Build 77
"RTN","SDWLMSG",3,0)
 ;
"RTN","SDWLMSG",4,0)
MESS ;Send message 1
"RTN","SDWLMSG",5,0)
 S ^TMP("SDWLQSC1",$J,.01)="Patient Name                    SSN   OLD-EWL/SC %  NEW-EWL/SC %  PRIORITY"
"RTN","SDWLMSG",6,0)
 S ^TMP("SDWLQSC1",$J,.02)="------------                    ---   ------------  ------------  --------"
"RTN","SDWLMSG",7,0)
 S ^TMP("SDWLQSC1",$J,.03)=""
"RTN","SDWLMSG",8,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",9,0)
 S XMSUB="EWL SC Patient Update with SC Priority"
"RTN","SDWLMSG",10,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",11,0)
 S XMTEXT="^TMP(""SDWLQSC1"",$J,"
"RTN","SDWLMSG",12,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",13,0)
 D ^XMD K ^TMP("SDWLQSC1",$J)
"RTN","SDWLMSG",14,0)
 Q
"RTN","SDWLMSG",15,0)
MESS1 ;Send message 2    
"RTN","SDWLMSG",16,0)
 S ^TMP("SDWLQSC2",$J,.01)="Patient Name                    SSN   OLD-EWL/SC %  NEW-EWL/SC % MULTI-ENTRIES"
"RTN","SDWLMSG",17,0)
 S ^TMP("SDWLQSC2",$J,.02)="------------                    ---   ------------  ------------ -------------"
"RTN","SDWLMSG",18,0)
 S ^TMP("SDWLQSC2",$J,.03)=""
"RTN","SDWLMSG",19,0)
 S ^TMP("SDWLQSC2",$J,.04)="** NOTE: EWL SC PRIORITY MAY REQUIRE MANUAL UPDATE. PLEASE REVIEW **"
"RTN","SDWLMSG",20,0)
 S ^TMP("SDWLQSC2",$J,.05)=""
"RTN","SDWLMSG",21,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",22,0)
 S XMSUB="EWL SC Patient Update with SC Percentage Change"
"RTN","SDWLMSG",23,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",24,0)
 S XMTEXT="^TMP(""SDWLQSC2"",$J,"
"RTN","SDWLMSG",25,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",26,0)
 D ^XMD K ^TMP("SDWLQSC2",$J)
"RTN","SDWLMSG",27,0)
 Q
"RTN","SDWLMSG",28,0)
MESS2 ;
"RTN","SDWLMSG",29,0)
 S ^TMP("SDWLQSC3",$J,.01)="This message displays any pending appointments in the EWL file which have"
"RTN","SDWLMSG",30,0)
 S ^TMP("SDWLQSC3",$J,.02)="a status of 'CANCELED BY CLINIC', there may be further action required if"
"RTN","SDWLMSG",31,0)
 S ^TMP("SDWLQSC3",$J,.03)="the patient still needs an appointment."
"RTN","SDWLMSG",32,0)
 S ^TMP("SDWLQSC3",$J,.04)=""
"RTN","SDWLMSG",33,0)
 N SDFORM S SDFORM=$$FORM^SDFORM("PATIENT NAME",32,"CLINIC",27,"DATE/TIME of APPT",21) D  ;added
"RTN","SDWLMSG",34,0)
 .S ^TMP("SDWLQSC3",$J,.05)=SDFORM
"RTN","SDWLMSG",35,0)
 S ^TMP("SDWLQSC3",$J,.06)="-------------------------------------------------------------------------------"
"RTN","SDWLMSG",36,0)
 S ^TMP("SDWLQSC3",$J,.07)=""
"RTN","SDWLMSG",37,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",38,0)
 S XMSUB="EWL appointment entries with a status of 'CANCELED BY CLINIC'."
"RTN","SDWLMSG",39,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",40,0)
 S XMTEXT="^TMP(""SDWLQSC3"",$J,"
"RTN","SDWLMSG",41,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",42,0)
 D ^XMD K ^TMP("SDWLQSC3",$J)
"RTN","SDWLMSG",43,0)
 Q
"RTN","SDWLMSG",44,0)
MESS3 ;
"RTN","SDWLMSG",45,0)
 S ^TMP("SDWLQSC4",$J,.01)="This message displays the number of open Wait List entries that are tied to"
"RTN","SDWLMSG",46,0)
 S ^TMP("SDWLQSC4",$J,.02)="an Inactive Clinic. These Wait List entries may require further action,"
"RTN","SDWLMSG",47,0)
 S ^TMP("SDWLQSC4",$J,.03)="please review."
"RTN","SDWLMSG",48,0)
 S ^TMP("SDWLQSC4",$J,.04)=""
"RTN","SDWLMSG",49,0)
 S ^TMP("SDWLQSC4",$J,.05)="CLINIC and NUMBER of WAIT LIST entries"
"RTN","SDWLMSG",50,0)
 S ^TMP("SDWLQSC4",$J,.06)=""
"RTN","SDWLMSG",51,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",52,0)
 S XMSUB="INACTIVE CLINICS with OPEN WAIT LIST entries."
"RTN","SDWLMSG",53,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",54,0)
 S XMTEXT="^TMP(""SDWLQSC4"",$J,"
"RTN","SDWLMSG",55,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",56,0)
 D ^XMD K ^TMP("SDWLQSC4",$J)
"RTN","SDWLMSG",57,0)
 Q
"RTN","SDWLMSG",58,0)
MESS4 ;PCMM Inactivative Team Report
"RTN","SDWLMSG",59,0)
 S ^TMP("SDWLQSC5",$J,.01)="This message displays any PCMM Teams that have been inactivated"
"RTN","SDWLMSG",60,0)
 S ^TMP("SDWLQSC5",$J,.02)="and have patients waiting on the Wait List.  The PCMM Teams"
"RTN","SDWLMSG",61,0)
 S ^TMP("SDWLQSC5",$J,.03)="are displayed along with the number of open Wait List entries."
"RTN","SDWLMSG",62,0)
 S ^TMP("SDWLQSC5",$J,.04)=""
"RTN","SDWLMSG",63,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",64,0)
 S XMSUB="Wait List PCMM Inactive Team Report"
"RTN","SDWLMSG",65,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",66,0)
 S XMTEXT="^TMP(""SDWLQSC5"",$J,"
"RTN","SDWLMSG",67,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",68,0)
 D ^XMD K ^TMP("SDWLQSC5",$J)
"RTN","SDWLMSG",69,0)
 Q
"RTN","SDWLMSG",70,0)
MESS5 ;PCMM Position Inactivation Report
"RTN","SDWLMSG",71,0)
 S ^TMP("SDWLQSC6",$J,.01)="This message displays any PCMM Positions that have been inactivated"
"RTN","SDWLMSG",72,0)
 S ^TMP("SDWLQSC6",$J,.02)="and have patients waiting on the Wait List.  The PCMM Positions"
"RTN","SDWLMSG",73,0)
 S ^TMP("SDWLQSC6",$J,.03)="are displayed along with the number of open Wait List entries."
"RTN","SDWLMSG",74,0)
 S ^TMP("SDWLQSC6",$J,.04)=""
"RTN","SDWLMSG",75,0)
 S ^TMP("SDWLQSC6",$J,.05)="Team Position                  Team                      Open EWL Entries"
"RTN","SDWLMSG",76,0)
 S ^TMP("SDWLQSC6",$J,.06)=""
"RTN","SDWLMSG",77,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",78,0)
 S XMSUB="Wait List PCMM Inactive Position Report"
"RTN","SDWLMSG",79,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",80,0)
 S XMTEXT="^TMP(""SDWLQSC6"",$J,"
"RTN","SDWLMSG",81,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",82,0)
 D ^XMD K ^TMP("SDWLQSC6",$J)
"RTN","SDWLMSG",83,0)
 Q
"RTN","SDWLMSG",84,0)
MESS6 ;Date of Death error message
"RTN","SDWLMSG",85,0)
 S ^TMP("SDWLQSC7",$J,.01)="This message displays any patient on the Wait List who had "
"RTN","SDWLMSG",86,0)
 S ^TMP("SDWLQSC7",$J,.02)="a Date of Death entered in error.  The Wait List entry is"
"RTN","SDWLMSG",87,0)
 S ^TMP("SDWLQSC7",$J,.03)="reopened and may require additional follow-up."
"RTN","SDWLMSG",88,0)
 S ^TMP("SDWLQSC7",$J,.04)=""
"RTN","SDWLMSG",89,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",90,0)
 S XMSUB="Wait List Date of Death Error Report"
"RTN","SDWLMSG",91,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",92,0)
 S XMTEXT="^TMP(""SDWLQSC7"",$J,"
"RTN","SDWLMSG",93,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",94,0)
 D ^XMD K ^TMP("SDWLQSC7",$J)
"RTN","SDWLMSG",95,0)
 Q
"RTN","SDWLMSG",96,0)
MESS7 ;PCMM Team available slots
"RTN","SDWLMSG",97,0)
 S ^TMP("SDWLQSC8",$J,.01)="This message displays any PCMM Teams that have open EWL entries"
"RTN","SDWLMSG",98,0)
 S ^TMP("SDWLQSC8",$J,.02)="waiting - and now have open slots available.  Message displays"
"RTN","SDWLMSG",99,0)
 S ^TMP("SDWLQSC8",$J,.03)="PCMM Team and number of open slots and number of EWL entries waiting"
"RTN","SDWLMSG",100,0)
 S ^TMP("SDWLQSC8",$J,.04)="for that PCMM Team."
"RTN","SDWLMSG",101,0)
 S ^TMP("SDWLQSC8",$J,.05)=""
"RTN","SDWLMSG",102,0)
 S ^TMP("SDWLQSC8",$J,.07)=""
"RTN","SDWLMSG",103,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",104,0)
 S XMSUB="PCMM Team Report of Available Slots"
"RTN","SDWLMSG",105,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",106,0)
 S XMTEXT="^TMP(""SDWLQSC8"",$J,"
"RTN","SDWLMSG",107,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",108,0)
 D ^XMD K ^TMP("SDWLQSC8",$J)
"RTN","SDWLMSG",109,0)
 Q
"RTN","SDWLMSG",110,0)
MESS8 ;PCMM Position available open slots
"RTN","SDWLMSG",111,0)
 S ^TMP("SDWLQSC9",$J,.01)="This message displays any PCMM Positions that have open EWL entries"
"RTN","SDWLMSG",112,0)
 S ^TMP("SDWLQSC9",$J,.02)="waiting - and now have open slots available.  Message displays"
"RTN","SDWLMSG",113,0)
 S ^TMP("SDWLQSC9",$J,.03)="PCMM Position and number of open slots and number of EWL entries waiting"
"RTN","SDWLMSG",114,0)
 S ^TMP("SDWLQSC9",$J,.04)="for that PCMM Position."
"RTN","SDWLMSG",115,0)
 S ^TMP("SDWLQSC9",$J,.05)=""
"RTN","SDWLMSG",116,0)
 S ^TMP("SDWLQSC9",$J,.07)=""
"RTN","SDWLMSG",117,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",118,0)
 S XMSUB="PCMM Positions Report of Available Slots"
"RTN","SDWLMSG",119,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",120,0)
 S XMTEXT="^TMP(""SDWLQSC9"",$J,"
"RTN","SDWLMSG",121,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",122,0)
 D ^XMD K ^TMP("SDWLQSC9",$J)
"RTN","SDWLMSG",123,0)
 Q
"RTN","SDWLMSG",124,0)
MESS9(DFN) ;
"RTN","SDWLMSG",125,0)
 S ^TMP("ENC",$J,.01)="This message displays any open EWL Clinic (C) or Specialty (S) type entries"
"RTN","SDWLMSG",126,0)
 S ^TMP("ENC",$J,.02)="along with the date/time of the first identified encounter or appointment for"
"RTN","SDWLMSG",127,0)
 S ^TMP("ENC",$J,.03)="that patient (in the same Clinic or Specialty) entered after the origination"
"RTN","SDWLMSG",128,0)
 S ^TMP("ENC",$J,.04)="date of the EWL entry."
"RTN","SDWLMSG",129,0)
 S ^TMP("ENC",$J,.05)=""
"RTN","SDWLMSG",130,0)
 S ^TMP("ENC",$J,.06)="Please review, and Disposition the EWL entry if the encounter/appointment has"
"RTN","SDWLMSG",131,0)
 S ^TMP("ENC",$J,.07)="satisfied the need for the EWL entry."
"RTN","SDWLMSG",132,0)
 N SDFORM S SDFORM=$$FORM^SDFORM("PATIENT NAME",22,"CLINIC",18,"EWL Type-Org. Date",25,"Date/Time of Appt",21) D  ;added
"RTN","SDWLMSG",133,0)
 .S ^TMP("ENC",$J,.08)=SDFORM
"RTN","SDWLMSG",134,0)
 S ^TMP("ENC",$J,.09)="-------------------------------------------------------------------------------"
"RTN","SDWLMSG",135,0)
 N SSN S SSN=$$GET1^DIQ(2,DFN_",",.09,"I"),SSN=$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,10)
"RTN","SDWLMSG",136,0)
 S ^TMP("ENC",$J,.1)=SSN
"RTN","SDWLMSG",137,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLMSG",138,0)
 S XMSUB="EWL entries with existing, related appointment/encounter."
"RTN","SDWLMSG",139,0)
 S XMY("G.SD EWL BACKGROUND UPDATE")=""
"RTN","SDWLMSG",140,0)
 S XMTEXT="^TMP(""ENC"",$J,"
"RTN","SDWLMSG",141,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLMSG",142,0)
 D ^XMD K ^TMP("ENC",$J)
"RTN","SDWLMSG",143,0)
 Q
"RTN","SDWLP446")
0^38^B903527^n/a
"RTN","SDWLP446",1,0)
SDWLP446 ;;IOFO BAY PINES/TEH - WAITING LIST-ENTER/EDIT - WAIT LISTTYPE/INSTUTITION;06/12/2002 ; 20 Aug 2002 2:10 PM  ; Compiled November 9, 2006 15:39:42
"RTN","SDWLP446",2,0)
 ;;5.3;scheduling;**446**;AUG 13 1993;Build 77
"RTN","SDWLP446",3,0)
 ;
"RTN","SDWLP446",4,0)
 ;
"RTN","SDWLP446",5,0)
 ;
"RTN","SDWLP446",6,0)
 ;
"RTN","SDWLP446",7,0)
EN I $D(^DD(409.3,.01,"DEL",1,0)) K ^DD(409.3,.01,"DEL",1,0)
"RTN","SDWLP446",8,0)
 Q
"RTN","SDWLPL")
0^13^B36034628^B31104284
"RTN","SDWLPL",1,0)
SDWLPL ;IOFO BAY PINES/DMR,esw - WAIT LIST PICK LIST ; 6/1/05 1:05pm  ; Compiled May 1, 2007 14:32:52
"RTN","SDWLPL",2,0)
 ;;5.3;scheduling;**327,394,417,446**;AUG 13, 1993;Build 77
"RTN","SDWLPL",3,0)
 ;
"RTN","SDWLPL",4,0)
 ;
"RTN","SDWLPL",5,0)
 ;09/23/2006 Patch SD*5.3*417 Upper/Lower case usage.
"RTN","SDWLPL",6,0)
 ;SD*5.3*446 - Included M - matched appointments
"RTN","SDWLPL",7,0)
 ;
"RTN","SDWLPL",8,0)
 I '$D(^SDWL(409.3,"B",DFN)) Q
"RTN","SDWLPL",9,0)
 S NN=""
"RTN","SDWLPL",10,0)
 W !,"This patient is currently on the Wait List."
"RTN","SDWLPL",11,0)
 ;
"RTN","SDWLPL",12,0)
ANS1 ;
"RTN","SDWLPL",13,0)
 S DIR("B")="NO",DIR("A")="Do you want to display open Wait list entries? (Y or N): ",DIR(0)="Y^AO" D ^DIR
"RTN","SDWLPL",14,0)
 K DIR
"RTN","SDWLPL",15,0)
 Q:'Y
"RTN","SDWLPL",16,0)
 ;
"RTN","SDWLPL",17,0)
ANS2(DFN,ANS2) ;
"RTN","SDWLPL",18,0)
 N STR S ANS2=" ",STR=",A,S,C,"
"RTN","SDWLPL",19,0)
 F  Q:STR[ANS2!(ANS2="^")  D
"RTN","SDWLPL",20,0)
TST .W !!,"Display Open Wait List entries selection:",!
"RTN","SDWLPL",21,0)
 .S DIR(0)="S^A:ALL;C:Matching Appt CLINIC;S:matching Appt SPECIALTY",DIR("B")="A",DIR("A")="Select Entry or ""^"" to QUIT " D ^DIR S ANS2=Y
"RTN","SDWLPL",22,0)
 .IF ANS2'="A"&(ANS2'="S")&(ANS2'="C")&(ANS2'="^") W !!,"PLEASE ENTER 'A' for All entries, 'C' for clinic or 'S' for current specialty/stop code or '^' to quit."
"RTN","SDWLPL",23,0)
 K DIR
"RTN","SDWLPL",24,0)
 Q:ANS2="^"
"RTN","SDWLPL",25,0)
 D INIT(DFN,ANS2) I '$D(^TMP($J,"SDWLPL")) W !!,"No selected open EWL entry has been found!" Q
"RTN","SDWLPL",26,0)
DISPLAY ;
"RTN","SDWLPL",27,0)
 D LIST(ANS2,DFN)
"RTN","SDWLPL",28,0)
 Q
"RTN","SDWLPL",29,0)
 ;
"RTN","SDWLPL",30,0)
INIT(DFN,ANS2) ;
"RTN","SDWLPL",31,0)
 ; ANS2: A - ALL
"RTN","SDWLPL",32,0)
 ;       S - All Specialties
"RTN","SDWLPL",33,0)
 ;       C - All Clinics
"RTN","SDWLPL",34,0)
 ;       M - Matches stop codes only
"RTN","SDWLPL",35,0)
 S (INST,SCODE,CLINIC,DENTER,REQBY,DESIRD,SCPRI,IEN,SSN)="" K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDWLPL",36,0)
 F  S IEN=$O(^SDWL(409.3,"B",DFN,IEN)) Q:IEN=""  D
"RTN","SDWLPL",37,0)
 .Q:$$GET1^DIQ(409.3,IEN_",",23,"I")="C"
"RTN","SDWLPL",38,0)
 .Q:$$GET1^DIQ(409.3,IEN_",",18,"I")'=""
"RTN","SDWLPL",39,0)
 .S ^TMP("SDWLPL",$J,IEN)=$G(^SDWL(409.3,IEN,0)) S DENTER="",DENTER=$P($G(^TMP("SDWLPL",$J,IEN)),"^",2)
"RTN","SDWLPL",40,0)
 .S (WLTYPE,TYPE,WLTN,NUM)="",TYPE=$P($G(^TMP("SDWLPL",$J,IEN)),"^",5)
"RTN","SDWLPL",41,0)
 .IF DENTER'=""&(TYPE'="") D
"RTN","SDWLPL",42,0)
 ..IF ANS2="A" D ARAY1
"RTN","SDWLPL",43,0)
 ..IF ANS2="S" D ARAY2
"RTN","SDWLPL",44,0)
 ..IF ANS2="C" D ARAY3
"RTN","SDWLPL",45,0)
 ..IF ANS2="M" D ARAY4
"RTN","SDWLPL",46,0)
 ;
"RTN","SDWLPL",47,0)
 K ANS1,NN,INST,SCODE,CLINIC,DENTER,REQBY,DESIRD,SCPRI
"RTN","SDWLPL",48,0)
 K CLINIC,WLTYPE,TYPE,WLTN,NUM,REC
"RTN","SDWLPL",49,0)
 Q
"RTN","SDWLPL",50,0)
 ;
"RTN","SDWLPL",51,0)
ARAY1 ;
"RTN","SDWLPL",52,0)
 IF TYPE=1 S WLTYPE="PCMM TEAM",NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",6),WLTNI=$$GET1^DIQ(404.51,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(404.51,NUM_",",.01)
"RTN","SDWLPL",53,0)
 IF TYPE=2 S WLTYPE="PCMM POSITION",NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",7),WLTNI=$$GET1^DIQ(404.57,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(404.57,NUM_",",.01)
"RTN","SDWLPL",54,0)
 IF TYPE=3 S WLTYPE="SERV/SPECIALTY",NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",8),WLTNI=$$GET1^DIQ(409.31,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(409.31,NUM_",",.01)
"RTN","SDWLPL",55,0)
 IF TYPE=4 S WLTYPE="CLINIC",NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",9),WLTNI=$$GET1^DIQ(409.32,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(409.32,NUM_",",.01)
"RTN","SDWLPL",56,0)
 D SAVE(TYPE,WLTNI,IEN)
"RTN","SDWLPL",57,0)
 Q
"RTN","SDWLPL",58,0)
 ;
"RTN","SDWLPL",59,0)
ARAY2 ;
"RTN","SDWLPL",60,0)
 IF TYPE=3 D
"RTN","SDWLPL",61,0)
 .S SCODE=+$P($G(^TMP($J,"APPT",1)),U,13),NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",8),WLTNI=$$GET1^DIQ(409.31,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(409.31,NUM_",",.01)
"RTN","SDWLPL",62,0)
 .;Q:SCODE'=WLTNI
"RTN","SDWLPL",63,0)
 .S WLTYPE="SERV/SPECIAL"
"RTN","SDWLPL",64,0)
 .D SAVE(TYPE,WLTNI,IEN)
"RTN","SDWLPL",65,0)
 Q
"RTN","SDWLPL",66,0)
 ;
"RTN","SDWLPL",67,0)
ARAY3 ;
"RTN","SDWLPL",68,0)
 IF TYPE=4 D
"RTN","SDWLPL",69,0)
 .S CLINIC=+$P($G(^TMP($J,"APPT",1)),U,2),NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",9),WLTNI=$$GET1^DIQ(409.32,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(409.32,NUM_",",.01)
"RTN","SDWLPL",70,0)
 .;Q:CLINIC'=WLTNI
"RTN","SDWLPL",71,0)
 .S WLTYPE="CLINIC"
"RTN","SDWLPL",72,0)
 .D SAVE(TYPE,WLTNI,IEN)
"RTN","SDWLPL",73,0)
 Q
"RTN","SDWLPL",74,0)
ARAY4 ;identify both clinic and specialties EWL matching by stop code with entered appointment
"RTN","SDWLPL",75,0)
 S SCODE=+$P($G(^TMP($J,"APPT",1)),U,13)
"RTN","SDWLPL",76,0)
 IF TYPE=3 D  Q
"RTN","SDWLPL",77,0)
 .S NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",8),WLTNI=$$GET1^DIQ(409.31,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(409.31,NUM_",",.01)
"RTN","SDWLPL",78,0)
 .Q:SCODE'=WLTNI
"RTN","SDWLPL",79,0)
 .S WLTYPE="SERV/SPECIAL"
"RTN","SDWLPL",80,0)
 .D SAVE(TYPE,WLTNI,IEN)
"RTN","SDWLPL",81,0)
 IF TYPE=4 D
"RTN","SDWLPL",82,0)
 .N SDCLSC
"RTN","SDWLPL",83,0)
 .S NUM=$P($G(^TMP("SDWLPL",$J,IEN)),"^",9),WLTNI=$$GET1^DIQ(409.32,NUM_",",.01,"I"),WLTN=$$GET1^DIQ(409.32,NUM_",",.01)
"RTN","SDWLPL",84,0)
 .S SDCLSC=$$GET1^DIQ(44,WLTNI_",",8,"I") ; STOP CODE
"RTN","SDWLPL",85,0)
 .Q:SCODE'=SDCLSC
"RTN","SDWLPL",86,0)
 .S WLTYPE="CLINIC"
"RTN","SDWLPL",87,0)
 .D SAVE(TYPE,WLTNI,IEN)
"RTN","SDWLPL",88,0)
 Q
"RTN","SDWLPL",89,0)
 ;
"RTN","SDWLPL",90,0)
SAVE(TYPE,WLTNI,IEN) ;
"RTN","SDWLPL",91,0)
 S REQBY=$P($G(^TMP("SDWLPL",$J,IEN)),"^",12)
"RTN","SDWLPL",92,0)
 S INST=$P($G(^TMP("SDWLPL",$J,IEN)),"^",3)
"RTN","SDWLPL",93,0)
 N DESIRED S DESIRED=$P($G(^TMP("SDWLPL",$J,IEN)),"^",16)
"RTN","SDWLPL",94,0)
 S SCPRI=$E($$GET1^DIQ(409.3,IEN_",",15)) ;SC priority
"RTN","SDWLPL",95,0)
 N NAME,SSN S NAME=$$GET1^DIQ(2,DFN_",",.01),SSN=$$GET1^DIQ(2,DFN_",",.09)
"RTN","SDWLPL",96,0)
 N SDBY S SDBY=$$GET1^DIQ(409.3,IEN_",",11),SDBY=$E(SDBY,1,3)
"RTN","SDWLPL",97,0)
 S NN=$O(^TMP($J,"SDWLPL",""),-1)+1
"RTN","SDWLPL",98,0)
 S ^TMP($J,"SDWLPL",NN)=IEN_U_WLTYPE_U_SCPRI_U_WLTN_U_INST_U_DENTER_U_SDBY_U_DESIRED
"RTN","SDWLPL",99,0)
 ;
"RTN","SDWLPL",100,0)
 N SPIEC S SPIEC=$S(TYPE=4:9,TYPE=3:10,TYPE=2:11,TYPE=1:12)
"RTN","SDWLPL",101,0)
 S $P(^TMP($J,"SDWLPL",NN),U,SPIEC)=WLTNI
"RTN","SDWLPL",102,0)
 K ^TMP("SDWLPL",$J,IEN)
"RTN","SDWLPL",103,0)
 Q
"RTN","SDWLPL",104,0)
 ;
"RTN","SDWLPL",105,0)
LIST(ANS2,DFN) ;
"RTN","SDWLPL",106,0)
 W:$D(IOF) @IOF
"RTN","SDWLPL",107,0)
 ;D APPTD^SDWLEVAL ;display appointment(s) again
"RTN","SDWLPL",108,0)
 W !,"=========================================================================="
"RTN","SDWLPL",109,0)
 N NAME,SSN S NAME=$$GET1^DIQ(2,DFN_",",.01),SSN=$$GET1^DIQ(2,DFN_",",.09)
"RTN","SDWLPL",110,0)
 ;W !!,$S(ANS2="A":" All",ANS2="C":" All Clinics",ANS2="M":" Matched Entries:",ANS2="S":" All Specialties",1:" All")
"RTN","SDWLPL",111,0)
 W !," Open EWL entries matching appointment specialty"
"RTN","SDWLPL",112,0)
 W !,"------------------------------" I ANS2'="A" W "-----------"
"RTN","SDWLPL",113,0)
 W !,"EW List Type   SC/P  Waiting for Institution  Orig Date   By  Des. Date Reopen"
"RTN","SDWLPL",114,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","SDWLPL",115,0)
 S (REC,NUM)=""
"RTN","SDWLPL",116,0)
 F  S NUM=$O(^TMP($J,"SDWLPL",NUM)) Q:NUM=""  S REC=^TMP($J,"SDWLPL",NUM) D
"RTN","SDWLPL",117,0)
 .S IEN=+REC N SDP,SDR D
"RTN","SDWLPL",118,0)
 ..S SDP=$E($$GET1^DIQ(409.3,IEN_",",10)) ;priority
"RTN","SDWLPL",119,0)
 ..S SDR=$$GET1^DIQ(409.3,IEN_",",29,"I") ;reopen reason
"RTN","SDWLPL",120,0)
 .N SDINS,SDIN S SDINS=$P(REC,"^",5) S SDIN=$$GET1^DIQ(4,SDINS_",",.01,"I")
"RTN","SDWLPL",121,0)
 .W !,NUM_". ",$E($P(REC,"^",2),1,12),?16,$P(REC,"^",3)_"/"_SDP,?21,$E($P(REC,U,4),1,13),?35,SDIN,?47,$$FMTE^XLFDT($P(REC,"^",6),8),?59,$P(REC,"^",7),?63,$$FMTE^XLFDT($P(REC,"^",8),8),?77,SDR
"RTN","SDWLPL",122,0)
 .N SDUP,SDLO
"RTN","SDWLPL",123,0)
 .S SDUP="ABCDEFGHIJKLMNOPRSTUWQXYzv",SDLO="abcdefghijklmnoprstuwqxyzv"
"RTN","SDWLPL",124,0)
 .N SMT S SMT=$$GET1^DIQ(409.3,IEN_",",25) I SMT'="" S SMT=$TR(SMT,SDUP,SDLO) W !?2,"Comment: ",SMT
"RTN","SDWLPL",125,0)
 .N SMO S SMO=$$GET1^DIQ(409.3,IEN_",",30) I SMO'="" S SMO=$TR(SMO,SDUP,SDLO) W !?2,"Reopen: ",SMO
"RTN","SDWLPL",126,0)
 Q
"RTN","SDWLQSC")
0^23^B65234580^B72135252
"RTN","SDWLQSC",1,0)
SDWLQSC        ;IOFO BAY PINES/TEH,DMR - WAITING LIST-SC PRIORITY BACKGROUND ;09/02/2004 2:10 PM [4/21/05 8:04pm]
"RTN","SDWLQSC",2,0)
 ;;5.3;scheduling;**327,394,467,446**;AUG 13, 1993;Build 77
"RTN","SDWLQSC",3,0)
 ;
"RTN","SDWLQSC",4,0)
 ;SD*5.3*327       EWL Updates Phase II - Addition of EWL notification messages.
"RTN","SDWLQSC",5,0)
 ;SD*5.3*394       New Routine for background update of SDWL(409.3) SC priorities.
"RTN","SDWLQSC",6,0)
 ;SD*5.3*467       Match canceled appts in 409.3            
"RTN","SDWLQSC",7,0)
 ;This routine will run as a background job to determine changes in SC disabilities and update
"RTN","SDWLQSC",8,0)
 ;the priority of the wait list visit. A mailman message will then be sent to the EWL mail group.
"RTN","SDWLQSC",9,0)
 ;Vars: SDWLDFN=EWL IEN
"RTN","SDWLQSC",10,0)
 ;      SDWLSC1=EWL RECORDED SC %
"RTN","SDWLQSC",11,0)
 ;      SDWLSC2=PATIENT FILE (2) CURRENT SC %          
"RTN","SDWLQSC",12,0)
 ;DBIAs: 1476 reference to PRIMARY ELIG. ^DPT(IEN,.372)
"RTN","SDWLQSC",13,0)
 ;        427 reference to ^DIC(8)                               
"RTN","SDWLQSC",14,0)
 Q
"RTN","SDWLQSC",15,0)
EN ;Use SDWL(409.3) to determine SC changes and priority.
"RTN","SDWLQSC",16,0)
 S SDWLDFN=0 F  S SDWLDFN=$O(^SDWL(409.3,"B",SDWLDFN)) Q:SDWLDFN<1  D
"RTN","SDWLQSC",17,0)
 .S SDWLDA=0,SDWLME=0 F  S SDWLDA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA)) Q:SDWLDA=""  D
"RTN","SDWLQSC",18,0)
 ..L ^SDWL(409.3,SDWLDA):5 I '$T Q
"RTN","SDWLQSC",19,0)
 ..I $P($G(^SDWL(409.3,SDWLDA,0)),U,17)["C" Q  ;I EWL entry has been 'CLOSED' don't process.
"RTN","SDWLQSC",20,0)
 ..S SDWLME=SDWLME+1
"RTN","SDWLQSC",21,0)
 ..S SDWLSC1=+$P($G(^SDWL(409.3,SDWLDA,"SC")),U,1)
"RTN","SDWLQSC",22,0)
 ..S SDWLSC2=+$$GET1^DIQ(2,SDWLDFN_",",.302,,"SDWLX","")
"RTN","SDWLQSC",23,0)
 ..I SDWLSC1=SDWLSC2 S SDWLSC4=1 Q
"RTN","SDWLQSC",24,0)
 ..S SDWLSCX=0,SDWLSC3=0,SDWLSC4=0
"RTN","SDWLQSC",25,0)
 ..I SDWLSC2<50,SDWLSC1>49 D
"RTN","SDWLQSC",26,0)
 ...S SDWLSC3=1,SDWLSC4=1,DA=SDWLDA,DR="14////^S X=SDWLSC2",DIE=409.3 D ^DIE,SET1
"RTN","SDWLQSC",27,0)
 ..I SDWLSC2>49,SDWLSC1>49 S SDWLSCX=SDWLSC2 D SET0 Q
"RTN","SDWLQSC",28,0)
 ..I SDWLSC2>49,SDWLSC1<50 S SDWLSCX=SDWLSC2 D SET0,SET1 Q
"RTN","SDWLQSC",29,0)
 ..I SDWLSC2<50,SDWLSC1<50 S SDWLSC3=1,SDWLSC4=1,SDWLSCX=SDWLSC2 D SET0,SET1 Q
"RTN","SDWLQSC",30,0)
 ..I '$D(^SDWL(409.3,SDWLDA,"SC")) D
"RTN","SDWLQSC",31,0)
 ...I SDWLSC2>49 S SDWLSCX=SDWLSC2 D SET0,SET1 Q  ;Set "SC" node if not defined.
"RTN","SDWLQSC",32,0)
 ...I SDWLSC2<50 S SDWLSC3=1,SDWLSC4=1,DA=SDWLDA,DR="14////^S X=SDWLSC2",DIE=409.3 D ^DIE,SET1
"RTN","SDWLQSC",33,0)
 ..K SDWLSSN,SDWLSC2,SDWLSC1,SDWLSC3,SDWLSCP,SDWLX,SDWLI,SDWLSCX
"RTN","SDWLQSC",34,0)
 ..L  Q
"RTN","SDWLQSC",35,0)
 I $D(SDWLSC4),SDWLSC4 D
"RTN","SDWLQSC",36,0)
 .I $D(^TMP("SDWLQSC2",$J)) D MESS1^SDWLMSG
"RTN","SDWLQSC",37,0)
 I $D(^TMP("SDWLQSC1",$J)) D MESS^SDWLMSG
"RTN","SDWLQSC",38,0)
 K SDWLDA,SDWLDFN,SDWLSC1,SDWLSC2,SDWLSC3,SDWLSC4,DA,DR,DIC,DIE,X,SDWLX,SDWLNAM,SDWLSSN,SDWLSCX,SDWLWRT,SDWLME
"RTN","SDWLQSC",39,0)
 D EN2^SDWLQSC1 D EN3
"RTN","SDWLQSC",40,0)
 K IEN,DFN,APPT,WLAPPT,STOP,WLSTAT,STATUS,NN,SDREC,SDARRAY,SDAPPT,CL,CLINIC,SDC,SDDFN,SDNAME,SDAPPST,CIEN,SDWL
"RTN","SDWLQSC",41,0)
 K SDCL,SDIEN,CC,SDREACT,SDINACT,CLINICS,TEAM,TEAMN,WLOPEN,PIEN,POS,POSN,SDWLPOS,EDATE,DOD,DIS,NAME,MAX,AVAL,SDFORM
"RTN","SDWLQSC",42,0)
 Q
"RTN","SDWLQSC",43,0)
SET0 ;Set EWL file with current SC percentage.
"RTN","SDWLQSC",44,0)
 S DA=SDWLDA,DR="14////^S X=SDWLSCX",DIE=409.3 D ^DIE
"RTN","SDWLQSC",45,0)
 I SDWLSC2=50!(SDWLSC2>50) S DR="15////^S X=1" D ^DIE
"RTN","SDWLQSC",46,0)
 K DA,DR,X,DIE
"RTN","SDWLQSC",47,0)
 Q
"RTN","SDWLQSC",48,0)
SET1 ;Set temporary file for message.
"RTN","SDWLQSC",49,0)
 F SDWLI=.01,.09 S SDWLX(SDWLI)=$$GET1^DIQ(2,SDWLDFN_",",SDWLI,,"SDWLX","")
"RTN","SDWLQSC",50,0)
 S SDWLNAM=$E($G(SDWLX(.01)),1,27),SDWLSSN=$E($G(SDWLX(.09)),6,99)
"RTN","SDWLQSC",51,0)
 S SDWLSCP=$$GET1^DIQ(409.3,SDWLDA_",",15,,"SDWLSCP","")
"RTN","SDWLQSC",52,0)
 S SDWLWRT=SDWLNAM,SDWLWRT=SDWLWRT_$J(SDWLSSN,(35-$L(SDWLNAM)))
"RTN","SDWLQSC",53,0)
 S SDWLWRT=SDWLWRT_$J(SDWLSC1,8),SDWLWRT=SDWLWRT_$J(SDWLSC2,16-$L(SDWLSC1))
"RTN","SDWLQSC",54,0)
 I 'SDWLSC3 S SDWLWRT=SDWLWRT_$J(SDWLSCP,15)
"RTN","SDWLQSC",55,0)
 I SDWLSC3 S SDWLWRT=SDWLWRT_$J($S(SDWLME>1:"YES",1:"NO"),15)
"RTN","SDWLQSC",56,0)
 I SDWLSC3 S ^TMP("SDWLQSC2",$J,SDWLDFN)=SDWLWRT Q
"RTN","SDWLQSC",57,0)
 S ^TMP("SDWLQSC1",$J,SDWLDFN)=SDWLWRT
"RTN","SDWLQSC",58,0)
 Q
"RTN","SDWLQSC",59,0)
APPT(CLINIC,IEN) ;
"RTN","SDWLQSC",60,0)
 S (SDREC,SDARRAY)=""
"RTN","SDWLQSC",61,0)
 S SDARRAY(1)=WLAPPT_";"_WLAPPT
"RTN","SDWLQSC",62,0)
 S SDARRAY(4)=DFN
"RTN","SDWLQSC",63,0)
 S SDARRAY("FLDS")="3;2;4;1"
"RTN","SDWLQSC",64,0)
 S SDREC=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SDWLQSC",65,0)
 IF SDREC>0 D
"RTN","SDWLQSC",66,0)
 .S (CL,SDC,SDDFN,SDNAM,SDAPPT,SDAPPST,NN)=""
"RTN","SDWLQSC",67,0)
 .S CL=$O(^TMP($J,"SDAMA301",DFN,"")) Q:CL=""  ;Current Clinic
"RTN","SDWLQSC",68,0)
 .S SDAPPST=$P($G(^TMP($J,"SDAMA301",DFN,CL,WLAPPT)),"^",3),SDAPPST=$P(SDAPPST,";")  ;Appt Status
"RTN","SDWLQSC",69,0)
 .I CL'=CLINIC!(SDAPPST="CC") D
"RTN","SDWLQSC",70,0)
 ..S SDDFN=$P($G(^TMP($J,"SDAMA301",DFN,CL,WLAPPT)),"^",4) IF SDDFN'="" S SDNAM=$P($G(SDDFN),";",2),SDNAM=$E(SDNAM,1,30)
"RTN","SDWLQSC",71,0)
 ..S SDC=$P($G(^TMP($J,"SDAMA301",DFN,CL,WLAPPT)),"^",2)
"RTN","SDWLQSC",72,0)
 ..S SDC=$$GET1^DIQ(44,CL_",",.01),SDC=$E(SDC,1,25)
"RTN","SDWLQSC",73,0)
 ..S Y=WLAPPT D DD^%DT S SDAPPT=Y
"RTN","SDWLQSC",74,0)
 ..IF CL'=CLINIC S SDC=SDC_"(new)"  ;to distinguish another clinic"
"RTN","SDWLQSC",75,0)
 ..S SDFORM=$$FORM^SDFORM(SDNAM,32,SDC,27,SDAPPT,21)
"RTN","SDWLQSC",76,0)
 ..S NN=NN+1,^TMP("SDWLQSC3",$J,NN)=SDFORM
"RTN","SDWLQSC",77,0)
 ..S DIE="^SDWL(409.3,",DA=IEN,DR="23////^S X=""O""" D ^DIE
"RTN","SDWLQSC",78,0)
 ..S DR="13.8////^S X=""CC""" D ^DIE
"RTN","SDWLQSC",79,0)
 ..S DR="29////^S X=""CA""" D ^DIE
"RTN","SDWLQSC",80,0)
 ..S DR="19///@;20///@;21///@" D ^DIE
"RTN","SDWLQSC",81,0)
 ..S DR="13///@;13.1////@;13.2///@;13.3///@;13.4///@;13.5///@;13.6///@;13.8///@;13.7///@" D ^DIE ;SD/467
"RTN","SDWLQSC",82,0)
 Q
"RTN","SDWLQSC",83,0)
EN3 ;Inactive clinics
"RTN","SDWLQSC",84,0)
 S (CIEN,IEN,APPT,DFN,WLSTAT,SDCL,SDIEN,CC,SDREACT,SDINACT,CLINICS,SDFORM)=""
"RTN","SDWLQSC",85,0)
 F  S CIEN=$O(^SDWL(409.3,"SC",CIEN)) Q:CIEN<1  S CC=0 D
"RTN","SDWLQSC",86,0)
 .S SDINACT=$$GET1^DIQ(44,CIEN_",",2505,"I"),SDREACT=$$GET1^DIQ(44,CIEN_",",2506,"I")
"RTN","SDWLQSC",87,0)
 .Q:SDINACT=""&(SDREACT="")  D 
"RTN","SDWLQSC",88,0)
 ..S IEN="" F  S IEN=$O(^SDWL(409.3,"SC",CIEN,IEN)) Q:IEN<1  S WLSTAT=$$GET1^DIQ(409.3,IEN_",",23,"I") D
"RTN","SDWLQSC",89,0)
 ...Q:WLSTAT'="O"
"RTN","SDWLQSC",90,0)
 ...Q:SDINACT<SDREACT&((SDREACT+.01)>DT)
"RTN","SDWLQSC",91,0)
 ...Q:SDINACT<DT&(SDREACT>SDINACT)
"RTN","SDWLQSC",92,0)
 ...Q:SDINACT>(DT+.01)
"RTN","SDWLQSC",93,0)
 ...S CC=CC+1
"RTN","SDWLQSC",94,0)
 .IF CC>0 D
"RTN","SDWLQSC",95,0)
 ..S CLINIC=$$GET1^DIQ(44,CIEN_",",.01),CLINIC=$E(CLINIC,1,30)
"RTN","SDWLQSC",96,0)
 ..S SDFORM=$$FORM^SDFORM(CLINIC,40,CC,20),^TMP("SDWLQSC4",$J,CIEN)=SDFORM
"RTN","SDWLQSC",97,0)
 ..S REC="",REC=$O(^SDWL(409.32,"B",CIEN,REC),-1)
"RTN","SDWLQSC",98,0)
 ..IF REC'="" D
"RTN","SDWLQSC",99,0)
 ...S SDINACT=$$GET1^DIQ(44,CIEN_",",2505,"I")
"RTN","SDWLQSC",100,0)
 ...S DIE="^SDWL(409.32,",DA=REC,DR="3////^S X=SDINACT" D ^DIE
"RTN","SDWLQSC",101,0)
 ...S DR="4////^S X=.5" D ^DIE
"RTN","SDWLQSC",102,0)
 IF $D(^TMP("SDWLQSC4",$J)) D MESS3^SDWLMSG
"RTN","SDWLQSC",103,0)
 D EN4
"RTN","SDWLQSC",104,0)
 Q
"RTN","SDWLQSC",105,0)
EN4 ;PCMM Team inactivated
"RTN","SDWLQSC",106,0)
 S (IEN,TIEN,TEAM,TEAMN,DFN,CC,STATUS,WLOPEN,SDFORM)="" S CC="0"
"RTN","SDWLQSC",107,0)
 F  S TEAM=$O(^SDWL(409.3,"D",TEAM)) Q:TEAM<1  S CC=0 D
"RTN","SDWLQSC",108,0)
 .S IEN="" F  S IEN=$O(^SDWL(409.3,"D",TEAM,IEN)) Q:IEN<1  S WLOPEN=$$GET1^DIQ(409.3,IEN_",",23,"I") D
"RTN","SDWLQSC",109,0)
 ..Q:WLOPEN="C"  S TIEN="",TIEN=$O(^SCTM(404.58,"B",TEAM,TIEN),-1) IF TIEN'="" D
"RTN","SDWLQSC",110,0)
 ...S STATUS=$$GET1^DIQ(404.58,TIEN_",",.03,"I")
"RTN","SDWLQSC",111,0)
 ...Q:STATUS="1"
"RTN","SDWLQSC",112,0)
 ...IF STATUS="0" S CC=CC+1
"RTN","SDWLQSC",113,0)
 .IF CC>0 D 
"RTN","SDWLQSC",114,0)
 ..S TEAMN=$$GET1^DIQ(404.51,TEAM_",",.01) S TEAMN=$E(TEAMN,1,30)
"RTN","SDWLQSC",115,0)
 ..S SDFORM=$$FORM^SDFORM(TEAMN,40,CC,20),^TMP("SDWLQSC5",$J,TEAM)=SDFORM
"RTN","SDWLQSC",116,0)
 IF $D(^TMP("SDWLQSC5",$J)) D MESS4^SDWLMSG
"RTN","SDWLQSC",117,0)
 D EN5
"RTN","SDWLQSC",118,0)
 Q
"RTN","SDWLQSC",119,0)
EN5 ;PCMM Position inactivated
"RTN","SDWLQSC",120,0)
 S (IEN,PIEN,POS,POSN,STATUS,WLOPEN,SDWLPOS,SDFORM,TEAM)=""
"RTN","SDWLQSC",121,0)
 S SDWLPOS="" F  S IEN=$O(^SDWL(409.3,"SP",IEN)) Q:IEN<1  D
"RTN","SDWLQSC",122,0)
 .S POS="" F  S POS=$O(^SDWL(409.3,"SP",IEN,POS)) Q:POS<1  D
"RTN","SDWLQSC",123,0)
 ..S WLOPEN=$$GET1^DIQ(409.3,IEN_",",23,"I")
"RTN","SDWLQSC",124,0)
 ..Q:WLOPEN="C"
"RTN","SDWLQSC",125,0)
 ..S PIEN="",PIEN=$O(^SCTM(404.59,"B",POS,PIEN),-1) IF PIEN'="" D
"RTN","SDWLQSC",126,0)
 ... S POSN=$$GET1^DIQ(404.57,POS_",",.01)
"RTN","SDWLQSC",127,0)
 ...IF PIEN'="" S STATUS=$$GET1^DIQ(404.59,PIEN_",",.03,"I")
"RTN","SDWLQSC",128,0)
 ...Q:STATUS="1"
"RTN","SDWLQSC",129,0)
 ...IF STATUS="0" D
"RTN","SDWLQSC",130,0)
 ....S:'$D(SDWLPOS(POS)) SDWLPOS(POS)=0 S SDWLPOS(POS)=SDWLPOS(POS)+1,POSN=$E(POSN,1,30)
"RTN","SDWLQSC",131,0)
 ....S TEAM=$$GET1^DIQ(404.57,POS_",",.02),TEAM=$E(TEAM,1,25)
"RTN","SDWLQSC",132,0)
 ....S SDFORM=$$FORM^SDFORM(POSN,32,TEAM,27,SDWLPOS(POS),21)
"RTN","SDWLQSC",133,0)
 ....S ^TMP("SDWLQSC6",$J,POS)=SDFORM
"RTN","SDWLQSC",134,0)
 IF $D(^TMP("SDWLQSC6",$J)) D MESS5^SDWLMSG
"RTN","SDWLQSC",135,0)
 D EN6
"RTN","SDWLQSC",136,0)
 Q
"RTN","SDWLQSC",137,0)
EN6 ;Date of Death
"RTN","SDWLQSC",138,0)
 S (IEN,SDDFN,DIS,DOD,NAME)=""
"RTN","SDWLQSC",139,0)
 F  S SDDFN=$O(^SDWL(409.3,"B",SDDFN)) Q:SDDFN<1  D
"RTN","SDWLQSC",140,0)
 .S IEN="" F  S IEN=$O(^SDWL(409.3,"B",SDDFN,IEN)) Q:IEN<1  D
"RTN","SDWLQSC",141,0)
 ..S DIS=$$GET1^DIQ(409.3,IEN_",",21,"I") IF DIS="D" D
"RTN","SDWLQSC",142,0)
 ...S DOD=$$GET1^DIQ(2,SDDFN_",",.351) Q:DOD'=""  D
"RTN","SDWLQSC",143,0)
 ....S DIE="^SDWL(409.3,",DA=IEN,DR="23////^S X=""O""" D ^DIE
"RTN","SDWLQSC",144,0)
 ....S DR="19///@" D ^DIE
"RTN","SDWLQSC",145,0)
 ....S DR="20///@" D ^DIE
"RTN","SDWLQSC",146,0)
 ....S DR="21///@" D ^DIE
"RTN","SDWLQSC",147,0)
 ....S DR="29////^S X=""DE""" D ^DIE
"RTN","SDWLQSC",148,0)
 ....S NAME=$$GET1^DIQ(2,SDDFN_",",.01) S ^TMP("SDWLQSC7",$J,SDDFN)=NAME
"RTN","SDWLQSC",149,0)
 IF $D(^TMP("SDWLQSC7",$J)) D MESS6^SDWLMSG
"RTN","SDWLQSC",150,0)
 D EN7
"RTN","SDWLQSC",151,0)
 Q
"RTN","SDWLQSC",152,0)
EN7 ;PCMM Team open slots
"RTN","SDWLQSC",153,0)
 S (IEN,TIEN,TEAMN,CC,WLOPEN,MAX,AVAL,SDFORM,TEAM,STATUS)=""
"RTN","SDWLQSC",154,0)
 F  S TEAM=$O(^SDWL(409.3,"D",TEAM)) Q:TEAM<1  S CC=0 D
"RTN","SDWLQSC",155,0)
 .S IEN="" F  S IEN=$O(^SDWL(409.3,"D",TEAM,IEN)) Q:IEN<1  S WLOPEN=$$GET1^DIQ(409.3,IEN_",",23,"I") D
"RTN","SDWLQSC",156,0)
 ..Q:WLOPEN="C"  S CC=CC+1
"RTN","SDWLQSC",157,0)
 .IF CC>0 D
"RTN","SDWLQSC",158,0)
 ..S TIEN="",TIEN=$O(^SCTM(404.58,"B",TEAM,TIEN),-1) IF TIEN'="" D
"RTN","SDWLQSC",159,0)
 ...S STATUS=$$GET1^DIQ(404.58,TIEN_",",.03,"I")
"RTN","SDWLQSC",160,0)
 ...Q:STATUS="0"
"RTN","SDWLQSC",161,0)
 ...S MAX=$$GET1^DIQ(404.51,TEAM_",",.08)
"RTN","SDWLQSC",162,0)
 ...S TEAMC=$$TEAMCNT^SCAPMCU1(TEAM,DT)
"RTN","SDWLQSC",163,0)
 ...Q:(TEAMC+.01)>MAX  S AVAL=MAX-TEAMC,TEAMN=$$GET1^DIQ(404.51,TEAM_",",.01)
"RTN","SDWLQSC",164,0)
 ...S TEAMN=$E(TEAMN,1,30),SDFORM=$$FORM^SDFORM(TEAMN,35,AVAL,22,CC,12)
"RTN","SDWLQSC",165,0)
 ...S ^TMP("SDWLQSC8",$J,TIEN)=SDFORM
"RTN","SDWLQSC",166,0)
 IF $D(^TMP("SDWLQSC8",$J)) D
"RTN","SDWLQSC",167,0)
 .S SDFORM=$$FORM^SDFORM("TEAM",35,"SLOTS AVAILIABLE",22,"EWL ENTRIES",12)
"RTN","SDWLQSC",168,0)
 .S ^TMP("SDWLQSC8",$J,.06)=SDFORM
"RTN","SDWLQSC",169,0)
 .D MESS7^SDWLMSG
"RTN","SDWLQSC",170,0)
 D EN8
"RTN","SDWLQSC",171,0)
 Q
"RTN","SDWLQSC",172,0)
EN8 ;PCMM Position open slots
"RTN","SDWLQSC",173,0)
 S (IEN,PIEN,POS,POSN,STATUS,WLOPEN,EDATE,SDWLPOS,SDWL,SDFORM)="" K SDWLPOS
"RTN","SDWLQSC",174,0)
 S SDWLPOS="" F  S IEN=$O(^SDWL(409.3,"SP",IEN)) Q:IEN<1  D
"RTN","SDWLQSC",175,0)
 .S POS="" F  S POS=$O(^SDWL(409.3,"SP",IEN,POS)) Q:POS<1  D
"RTN","SDWLQSC",176,0)
 ..S PIEN="",PIEN=$O(^SCTM(404.59,"B",POS,PIEN),-1) IF PIEN'="" D
"RTN","SDWLQSC",177,0)
 ...S STATUS=$$GET1^DIQ(404.59,PIEN_",",.03,"I")
"RTN","SDWLQSC",178,0)
 ...S WLOPEN=$$GET1^DIQ(409.3,IEN_",",23,"I"),EDATE=$$GET1^DIQ(404.59,PIEN_",",.02,"I")
"RTN","SDWLQSC",179,0)
 ...Q:WLOPEN="C"
"RTN","SDWLQSC",180,0)
 ...Q:((EDATE+.01)<DT&(STATUS="0"))
"RTN","SDWLQSC",181,0)
 ...S:'$D(SDWLPOS(POS)) SDWLPOS(POS)=0 S SDWLPOS(POS)=SDWLPOS(POS)+1
"RTN","SDWLQSC",182,0)
 S (IEN,POS,POSN,MAX,AVAL,CC,TEAM)=""
"RTN","SDWLQSC",183,0)
 F  S POS=$O(SDWLPOS(POS)) Q:POS<1  D
"RTN","SDWLQSC",184,0)
 .S MAX=$$GET1^DIQ(404.57,POS_",",.08),SDWL=$$PCPOSCNT^SCAPMCU1(POS,DT)
"RTN","SDWLQSC",185,0)
 .Q:(SDWL+.01)>MAX
"RTN","SDWLQSC",186,0)
 .S TEAM=$$GET1^DIQ(404.57,POS_",",.02),TEAM=$E(TEAM,1,23)
"RTN","SDWLQSC",187,0)
 .S AVAL=MAX-SDWL,POSN=$$GET1^DIQ(404.57,POS_",",.01)
"RTN","SDWLQSC",188,0)
 .S POSN=$E(POSN,1,23),SDFORM=$$FORM^SDFORM(POSN,25,TEAM,25,AVAL,14,SDWLPOS(POS),11)
"RTN","SDWLQSC",189,0)
 .S ^TMP("SDWLQSC9",$J,POS)=SDFORM
"RTN","SDWLQSC",190,0)
 IF $D(^TMP("SDWLQSC9",$J)) D
"RTN","SDWLQSC",191,0)
 .S SDFORM=$$FORM^SDFORM("POSITION",25,"TEAM",25,"SLOTS AVAIL",14,"EWL ENTRIES",11)
"RTN","SDWLQSC",192,0)
 .S ^TMP("SDWLQSC9",$J,.06)=SDFORM
"RTN","SDWLQSC",193,0)
 .D MESS8^SDWLMSG
"RTN","SDWLQSC",194,0)
 Q
"RTN","SDWLQSC1")
0^24^B18866005^n/a
"RTN","SDWLQSC1",1,0)
SDWLQSC1 ;IOFO BAY PINES/ESW - WAITING LIST-SC PRIORITY BACKGROUND ;09/02/2004 2:10 PM [4/21/05 8:04pm]  ; Compiled December 20, 2006 09:00:39
"RTN","SDWLQSC1",2,0)
 ;;5.3;scheduling;**446**;AUG 13, 1993;Build 77
"RTN","SDWLQSC1",3,0)
 ;
"RTN","SDWLQSC1",4,0)
 ;          
"RTN","SDWLQSC1",5,0)
 ;This routine will be called by SDWLQSC that run as a background job. It is created because SDWLQSC exceeded 10000.                               
"RTN","SDWLQSC1",6,0)
 Q
"RTN","SDWLQSC1",7,0)
EN2 ;Part 2 - checks status of appts linked to closed EWL entries.
"RTN","SDWLQSC1",8,0)
 N IEN,APPT,WLAPPT,CLINIC,SDAPPT,WLSTAT,STATUS,NN,SDFORM,EE
"RTN","SDWLQSC1",9,0)
 S (IEN,APPT,WLAPPT,CLINIC,SDAPPT,WLSTAT,STATUS,NN,SDFORM,EE)=""
"RTN","SDWLQSC1",10,0)
 S EE=0,DFN=0
"RTN","SDWLQSC1",11,0)
 F  S DFN=$O(^SDWL(409.3,"B",DFN)) Q:DFN<1  D
"RTN","SDWLQSC1",12,0)
 .K ^TMP("ENC",$J)
"RTN","SDWLQSC1",13,0)
 .S IEN="" F  S IEN=$O(^SDWL(409.3,"B",DFN,IEN)) Q:IEN<1  D
"RTN","SDWLQSC1",14,0)
 ..S STATUS="" S STATUS=$$GET1^DIQ(409.3,IEN_",",23,"I")
"RTN","SDWLQSC1",15,0)
 ..IF STATUS="C" D
"RTN","SDWLQSC1",16,0)
 ...IF $G(^SDWL(409.3,IEN,"SDAPT")) D
"RTN","SDWLQSC1",17,0)
 ....S CLINIC=$$GET1^DIQ(409.3,IEN_",",13.2,"I") IF CLINIC>0 D
"RTN","SDWLQSC1",18,0)
 .....S WLAPPT=$$GET1^DIQ(409.3,IEN_",",13,"I"),WLSTAT=$$GET1^DIQ(409.3,IEN_",",21,"I")
"RTN","SDWLQSC1",19,0)
 .....IF WLSTAT="SA" D APPT^SDWLQSC(CLINIC,IEN) ; call creates ^TMP("SDWLQSC3",$J)
"RTN","SDWLQSC1",20,0)
 ..I STATUS="O" S SDPCL=$$GET1^DIQ(409.3,IEN_",",8,"I"),SDPSP=$$GET1^DIQ(409.3,IEN_",",7,"I") I SDPCL>0!(SDPSP>0) D
"RTN","SDWLQSC1",21,0)
 ...S (SDCL,SDSP)=""
"RTN","SDWLQSC1",22,0)
 ...I SDPCL>0 S SDCL=$$GET1^DIQ(409.32,SDPCL_",",.01,"I")
"RTN","SDWLQSC1",23,0)
 ...I SDPSP>0 S SDSP=$$GET1^DIQ(409.31,SDPSP_",",.01,"I")
"RTN","SDWLQSC1",24,0)
 ...S SDORG=$$GET1^DIQ(409.3,IEN_",",1,"I")
"RTN","SDWLQSC1",25,0)
 ...N SDD S SDD=$$CHKENC(DFN,SDORG,SDCL,SDSP,0)  ; 0 - the first appt/enc only 
"RTN","SDWLQSC1",26,0)
 .IF $D(^TMP("ENC",$J)) D MESS9^SDWLMSG(DFN) K ^TMP("ENC",$J)
"RTN","SDWLQSC1",27,0)
 IF $D(^TMP("SDWLQSC3",$J)) D MESS2^SDWLMSG
"RTN","SDWLQSC1",28,0)
 Q
"RTN","SDWLQSC1",29,0)
CHKENC(DFN,SDORG,SDCL,SDSP,PROC) ;check if any encounters are present
"RTN","SDWLQSC1",30,0)
 ;SDORG - orig DATE of EWL entry
"RTN","SDWLQSC1",31,0)
 ;SDCL - pointer to file 44
"RTN","SDWLQSC1",32,0)
 ;SDSP - pointer to fiel # 40.7
"RTN","SDWLQSC1",33,0)
 ;PROC - 0 -create the first appt/enc only
"RTN","SDWLQSC1",34,0)
 ;       1 - multiple appt/enc ; called from outside for a list of appointment(s)/encounter(s)
"RTN","SDWLQSC1",35,0)
 S CNT=0,EE=0
"RTN","SDWLQSC1",36,0)
 N SDEND S X1=SDORG,X2=119 D C^%DTC S SDEND=X
"RTN","SDWLQSC1",37,0)
 K ^TMP("SD ENCOUNTER LIST",$J) K ^TMP($J,"SDAMA301") K ^TMP($J,"APPT") K ^TMP("ENC",$J)
"RTN","SDWLQSC1",38,0)
 N SDARR S SDARR(1)=SDORG_";"_SDEND
"RTN","SDWLQSC1",39,0)
 S SDARR(3)="R" ;only kept/scheduled 
"RTN","SDWLQSC1",40,0)
 S SDARR(4)=DFN
"RTN","SDWLQSC1",41,0)
 I SDCL S SDARR(2)=SDCL
"RTN","SDWLQSC1",42,0)
 I SDSP S SDARR(13)=$$GET1^DIQ(40.7,SDSP_",",1) ; STOP CODE
"RTN","SDWLQSC1",43,0)
 S SDARR("FLDS")="1;2;3;4;10;13;14;17"
"RTN","SDWLQSC1",44,0)
 S SDAPPT=$$SDAPI^SDAMA301(.SDARR)
"RTN","SDWLQSC1",45,0)
 I SDAPPT D
"RTN","SDWLQSC1",46,0)
 .I 'PROC N SS,SDP S SS="^TMP("_$J_",""SDAMA301"")" S SDP=@$Q(@SS) D  ; string containg app data
"RTN","SDWLQSC1",47,0)
 ..; see example: SDP=3060615.09^359;11CP SURG^^7171882;WOLF,ED^^^^^^^^
"RTN","SDWLQSC1",48,0)
 ..N CL,SDC S CL=+$P(SDP,U,2) S SDC=$$GET1^DIQ(44,CL_",",.01),SDC=$E(SDC,1,17)
"RTN","SDWLQSC1",49,0)
 ..S SDNAM=$$GET1^DIQ(2,DFN_",",.01),SDNAM=$E(SDNAM,1,19)
"RTN","SDWLQSC1",50,0)
 ..N Y,SDAPPT S Y=+SDP D DD^%DT S SDAPPT=Y
"RTN","SDWLQSC1",51,0)
 ..N Y S Y=SDORG D DD^%DT S SDORGD=Y S SDORGD=$S(SDCL>0:"C-",1:"S-")_SDORGD
"RTN","SDWLQSC1",52,0)
 ..S SDFORM=$$FORM^SDFORM(SDNAM,22,SDC,20,SDORGD,20,SDAPPT,21)
"RTN","SDWLQSC1",53,0)
 ..S EE="" S EE=+$O(^TMP("ENC",$J,EE),-1)+1 S ^TMP("ENC",$J,EE)=SDFORM
"RTN","SDWLQSC1",54,0)
 .I PROC N SS S SS="^TMP("_$J_",""SDAMA301"")" F  S SS=$Q(@SS) Q:SS'["SDAMA301"  D
"RTN","SDWLQSC1",55,0)
 ..N CL,SDP S SDP=@SS S SD=+SDP,CL=+$P(SDP,U,2)
"RTN","SDWLQSC1",56,0)
 ..S SCNT=$O(^TMP($J,"APPT",""),-1)+1
"RTN","SDWLQSC1",57,0)
 ..S ^TMP($J,"APPT",SCNT)=^TMP($J,"SDAMA301",DFN,CL,SD)
"RTN","SDWLQSC1",58,0)
 ..N SDCLIN S SDCLIN=$$CLIN^SDWLBACC(CL),SDINST=$P(SDCLIN,U),SDFAC=$P(SDCLIN,U,2),SDINSTE=$P(SDCLIN,U,3)
"RTN","SDWLQSC1",59,0)
 ..S $P(^TMP($J,"APPT",SCNT),"^",15)=SDINST_";"_SDINSTE
"RTN","SDWLQSC1",60,0)
 ..S $P(^TMP($J,"APPT",SCNT),"^",16)=SDFAC
"RTN","SDWLQSC1",61,0)
 ..N SDD3 S SDD3=$S(SD<DT:"KEPT",1:"SCHEDULED") S $P(^TMP($J,"APPT",SCNT),U,3)=";"_SDD3
"RTN","SDWLQSC1",62,0)
 I 'PROC I EE Q EE
"RTN","SDWLQSC1",63,0)
 N ARR,SQ K ^TMP("SD ENCOUNTER LIST",$J) D LISTPAT^SDOERPC(.ARR,DFN,SDORG,SDEND)
"RTN","SDWLQSC1",64,0)
 I $D(@ARR) S CNT=0,SQ="" F  S SQ=$O(^TMP("SD ENCOUNTER LIST",$J,SQ)) Q:SQ=""  D   I 'PROC,EE=1 Q
"RTN","SDWLQSC1",65,0)
 .I SDCL Q:$P(^TMP("SD ENCOUNTER LIST",$J,SQ),U,4)'=SDCL  S STR=$P(^TMP("SD ENCOUNTER LIST",$J,SQ),";;",2)
"RTN","SDWLQSC1",66,0)
 .I SDSP Q:$P(^TMP("SD ENCOUNTER LIST",$J,SQ),U,3)'=SDSP  S STR=$P(^TMP("SD ENCOUNTER LIST",$J,SQ),";;",2)
"RTN","SDWLQSC1",67,0)
 .S CL=$P(STR,U,4)
"RTN","SDWLQSC1",68,0)
 .S SDC=$$GET1^DIQ(44,CL_",",.01),SDC=$E(SDC,1,17)
"RTN","SDWLQSC1",69,0)
 .S SDNAM=$$GET1^DIQ(2,DFN_",",.01),SDNAM=$E(SDNAM,1,19)
"RTN","SDWLQSC1",70,0)
 .N Y S Y=$P(STR,U) D DD^%DT S SDAPPT=Y,SDAPPT=SDAPPT_"-E"
"RTN","SDWLQSC1",71,0)
 .N Y S Y=SDORG D DD^%DT S SDORGD=Y S SDORGD=$S(SDCL>0:"C-",1:"S-")_SDORGD ; C - clinic EWL entry ; S - specialty EWL entry
"RTN","SDWLQSC1",72,0)
 .I 'PROC S SDFORM=$$FORM^SDFORM(SDNAM,22,SDC,20,SDORGD,20,SDAPPT,21) D  Q
"RTN","SDWLQSC1",73,0)
 ..S EE="" S EE=+$O(^TMP("ENC",$J,EE),-1)+1 S ^TMP("ENC",$J,EE)=SDFORM
"RTN","SDWLQSC1",74,0)
 .I PROC S SCNT=$O(^TMP($J,"APPT",""),-1)+1 D
"RTN","SDWLQSC1",75,0)
 ..I +$P(STR,U,7) S ^TMP($J,"APPT",SCNT)=$P(STR,U)_U_CL_";"_SDC_"^^"_DFN_";"_SDNAM D
"RTN","SDWLQSC1",76,0)
 ...S $P(^TMP($J,"APPT",SCNT),U,18)=$P(STR,U,7)
"RTN","SDWLQSC1",77,0)
 ...S $P(^TMP($J,"APPT",SCNT),U,3)=";CHECKED OUT"
"RTN","SDWLQSC1",78,0)
 I PROC I $D(^TMP($J,"APPT")) S EE=1
"RTN","SDWLQSC1",79,0)
 Q EE
"RTN","SDWLROI")
0^15^B37333127^B34011534
"RTN","SDWLROI",1,0)
SDWLROI ;;IOFO BAY PINES/TEH/WAIT LIST STAT REPORT - ENROLLEE ; 01 Oct 2002  4:42 PM  ; Compiled December 21, 2006 15:21:55
"RTN","SDWLROI",2,0)
 ;;5.3;scheduling;**263,412,415,446**;AUG 13 1993;Build 77
"RTN","SDWLROI",3,0)
 ;
"RTN","SDWLROI",4,0)
 ; Removed Sort logic as routine exceeded SACC maximum size of 10000
"RTN","SDWLROI",5,0)
 ; New routine SDWLROIS was created to perform the Sort functionality
"RTN","SDWLROI",6,0)
 ;
"RTN","SDWLROI",7,0)
 ;
"RTN","SDWLROI",8,0)
EN ;
"RTN","SDWLROI",9,0)
 N ZCODE,ZTDESC,ZTDTH,ZTIO,ZTQUEDED,ZTREQ,ZTRTN,ZTSK
"RTN","SDWLROI",10,0)
 D INIT G END:$D(DUOUT)
"RTN","SDWLROI",11,0)
 D SORT^SDWLROIS(SDWLBD,SDWLED,SDWLINS,.SDWL)  ; SD*5.3*412 new routine to perform sort
"RTN","SDWLROI",12,0)
 I $$S^ZTLOAD G END
"RTN","SDWLROI",13,0)
 D PRT
"RTN","SDWLROI",14,0)
 G END
"RTN","SDWLROI",15,0)
INIT ;
"RTN","SDWLROI",16,0)
 I $D(CT) S SDWLCT=CT
"RTN","SDWLROI",17,0)
 I $D(DATE) S SDWLDATE=DATE
"RTN","SDWLROI",18,0)
 I $D(INS) S SDWLINS=INS
"RTN","SDWLROI",19,0)
 I $D(ZTSAVE) D
"RTN","SDWLROI",20,0)
 .S SDWLCT=$G(ZTSAVE("CT")),SDWLDATE=$G(ZTSAVE("DATE")),SDWLINS=$G(ZTSAVE("INS"))
"RTN","SDWLROI",21,0)
 I SDWLINS'="ALL" F I=1:1 S SDWL=$P(SDWLINS,";",I) Q:SDWL=""  S SDWL("INS",+SDWL)=""
"RTN","SDWLROI",22,0)
 S SDWLBD=$P(SDWLDATE,U,1),SDWLED=$P(SDWLDATE,U,2),SDWLPG=0
"RTN","SDWLROI",23,0)
 D NOW^%DTC S Y=% D DD^%DT S SDWLDTP=$P(Y,":",1,2)
"RTN","SDWLROI",24,0)
 K ZTSAVE
"RTN","SDWLROI",25,0)
 N POP S POP=0  ;SD*5.3*412
"RTN","SDWLROI",26,0)
 Q
"RTN","SDWLROI",27,0)
 ;
"RTN","SDWLROI",28,0)
PRT ;PRINT REPORT  SD*5.3*412 Q:POP added where needed to allow early exit
"RTN","SDWLROI",29,0)
 G END:$$S^ZTLOAD
"RTN","SDWLROI",30,0)
 S (T1,T2,T3,T4,T5,T6,T7,T8,T9,T10,T11,T12,T13)=0  ;SD*5.3*446
"RTN","SDWLROI",31,0)
 S (TT1,TT2,TT3,TT4,TT5,TT6,TT7,TT8,TT9,TT10,TT11,TT12,TT13,SDWLPG)=0 D HD,HD1  ;SD*5.3*446
"RTN","SDWLROI",32,0)
 I '$D(^TMP("SDWLROI1",$J)) W !!,"No Wait List Data to Report" Q
"RTN","SDWLROI",33,0)
 S SDWLINS="" F  S SDWLINS=$O(^TMP("SDWLROI1",$J,SDWLINS)) Q:SDWLINS=""  D  Q:POP  D T2 Q:POP  W !,"________________"  I $Y>(IOSL-8) D:$D(SDWLIOSR) SCR Q:POP  D HD,HD1  ;SD*5.3*412 added Quit for early exit; 446
"RTN","SDWLROI",34,0)
 .W !!,"INSTITUTION: ",SDWLINS
"RTN","SDWLROI",35,0)
 .S W1="" F  S W1=$O(^TMP("SDWLROI1",$J,SDWLINS,W1)) Q:W1=""  D  Q:POP  D T1 Q:POP  I $Y>(IOSL-8) D:$D(SDWLIOSR) SCR Q:POP  D HD,HD1  ; SD*5.3*446
"RTN","SDWLROI",36,0)
 ..W !,"ENROLLMENT PRIORITY: ",$S(W1="P":"PRIOR",W1="N":"NEW",W1="E":"ESTABLISHED",1:"UNDETERMINED")
"RTN","SDWLROI",37,0)
 ..S SDWLTY="" F  S SDWLTY=$O(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY)) Q:SDWLTY=""  D  Q:POP
"RTN","SDWLROI",38,0)
 ...S SDWLTNM=$$EXTERNAL^DILFD(409.3,4,,SDWLTY) W !,$E(SDWLTNM,1,15) I $Y>(IOSL-8) D:$D(SDWLIOSR) SCR Q:POP  D HD,HD1  ; SD*5.3*446
"RTN","SDWLROI",39,0)
 ...S SDWLSCN="" F  S SDWLSCN=$O(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN)) Q:SDWLSCN=""  D  Q:POP
"RTN","SDWLROI",40,0)
 ....S SDWLSCNM="" F  S SDWLSCNM=$O(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM)) Q:SDWLSCNM=""  D  Q:POP
"RTN","SDWLROI",41,0)
 .....S SDWLPRI="" F  S SDWLPRI=$O(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI)) Q:SDWLPRI=""  D  Q:POP
"RTN","SDWLROI",42,0)
 ......N SDWLCLO  ;SD*5.3*446
"RTN","SDWLROI",43,0)
 ......W !,?2,$E(SDWLSCNM,1,10)," ",$S(SDWLPRI="A":"ASAP",SDWLPRI="F":"FUTURE",1:"")
"RTN","SDWLROI",44,0)
 ......S SDWLPR=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"PR")) W ?20,SDWLPR
"RTN","SDWLROI",45,0)
 ......S SDWLCLO=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"CL")) W ?27,SDWLCLO  ;SD*5.3*415,446
"RTN","SDWLROI",46,0)
 ......S SDWLD=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLD")) W ?34,SDWLD  ;SD*5.3*415,446
"RTN","SDWLROI",47,0)
 ......S SDWLNC=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLNC")) W ?41,SDWLNC  ;SD*5.3*446
"RTN","SDWLROI",48,0)
 ......S SDWLSA=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLSA")) W ?48,SDWLSA  ;SD*5.3*446
"RTN","SDWLROI",49,0)
 ......S SDWLCC=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLCC")) W ?55,SDWLCC  ;SD*5.3*446
"RTN","SDWLROI",50,0)
 ......S SDWLNN=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLNN")) W ?62,SDWLNN  ;SD*5.3*446
"RTN","SDWLROI",51,0)
 ......S SDWLER=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLER")) W ?69,SDWLER  ;SD*5.3*446
"RTN","SDWLROI",52,0)
 ......S SDWLCL=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLCL")) W ?76,SDWLCL  ;SD*5.3*446
"RTN","SDWLROI",53,0)
 ......S SDWLTR=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLTR")) W ?83,SDWLTR  ;SD*5.3*446
"RTN","SDWLROI",54,0)
 ......S SDWLAD=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"AD")) W ?90,SDWLAD  ;SD*5.3*415,446
"RTN","SDWLROI",55,0)
 ......S SDWLRR=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"RR")) W ?97,SDWLRR  ;SD*5.3*415,446
"RTN","SDWLROI",56,0)
 ......S SDWLNR=+$G(^TMP("SDWLROI1",$J,SDWLINS,W1,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"NR")) W ?104,SDWLNR  ; SD*5.3*446
"RTN","SDWLROI",57,0)
 ......S T1=T1+SDWLPR,TT1=TT1+SDWLPR
"RTN","SDWLROI",58,0)
 ......S T2=T2+SDWLCLO,TT2=TT2+SDWLCLO
"RTN","SDWLROI",59,0)
 ......S T3=T3+SDWLD,TT3=TT3+SDWLD
"RTN","SDWLROI",60,0)
 ......S T4=T4+SDWLNC,TT4=TT4+SDWLNC
"RTN","SDWLROI",61,0)
 ......S T5=T5+SDWLSA,TT4=TT4+SDWLSA
"RTN","SDWLROI",62,0)
 ......S T6=T6+SDWLCC,TT6=TT6+SDWLCC
"RTN","SDWLROI",63,0)
 ......S T7=T7+SDWLNN,TT7=TT7+SDWLNN
"RTN","SDWLROI",64,0)
 ......S T8=T8+SDWLER,TT8=TT8+SDWLER
"RTN","SDWLROI",65,0)
 ......S T9=T9+SDWLCL,TT9=TT9+SDWLCL  ;SD*5.3*446
"RTN","SDWLROI",66,0)
 ......S T10=T10+SDWLTR,TT10=TT10+SDWLTR  ;SD*5.3*446
"RTN","SDWLROI",67,0)
 ......S T11=T11+SDWLAD,TT11=TT11+SDWLAD  ;SD*5.3*446
"RTN","SDWLROI",68,0)
 ......S T12=T12+SDWLRR,TT12=TT12+SDWLRR  ;SD*5.3*446
"RTN","SDWLROI",69,0)
 ......S T13=T13+SDWLNR,TT13=TT13+SDWLNR  ;SD*5.3*446
"RTN","SDWLROI",70,0)
 ......I $Y>(IOSL-8) D:$D(SDWLIOSR) SCR Q:POP  D HD,HD1  ;SD*5.3*446
"RTN","SDWLROI",71,0)
 Q
"RTN","SDWLROI",72,0)
T1 ;
"RTN","SDWLROI",73,0)
 ;write sub-totals
"RTN","SDWLROI",74,0)
 W !?20,"------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------"  ;SD*5.3*446
"RTN","SDWLROI",75,0)
 W !,"Sub-Totals:",?20,T1,?27,T2,?34,T3,?41,T4,?48,T5,?55,T6,?62,T7,?69,T8,?76,T9,?83,T10,?90,T11,?97,T12,?104,T13  ;SD*5.3*446
"RTN","SDWLROI",76,0)
 S (T1,T2,T3,T4,T5,T6,T7,T8,T9,T10,T11,T12,T13)=0  ;SD*5.3*446
"RTN","SDWLROI",77,0)
 I $Y>(IOSL-8) D:$D(SDWLIOSR) SCR Q:POP  D HD,HD1  ;SD*5.3*446
"RTN","SDWLROI",78,0)
 Q
"RTN","SDWLROI",79,0)
T2 W !,"Institution Totals:"
"RTN","SDWLROI",80,0)
 W ?20,TT1,?27,TT2,?34,TT3,?41,TT4,?48,TT5,?55,TT6,?62,TT7,?69,TT8,?76,TT9,?83,TT10,?90,TT11,?97,TT12,?104,TT13,!  ;SD*5.3*446
"RTN","SDWLROI",81,0)
 S (TT1,TT2,TT3,TT4,TT5,TT6,TT7,TT8,TT9,TT10,TT11,TT12,TT13)=0  ;SD*5.3*415,446
"RTN","SDWLROI",82,0)
 I $Y>(IOSL-8) D:$D(SDWLIOSR) SCR Q:POP  D HD,HD1  ;SD*5.3*446
"RTN","SDWLROI",83,0)
 Q
"RTN","SDWLROI",84,0)
HD W:$D(IOF) @IOF S SDWLPG=SDWLPG+1 W !!,SDWLDTP,?80-$L("Wait List (Sch/PCMM) Enroll Status Report")\2,"Wait List (Sch/PCMM) Enroll Status Report",?65,"Page: ",SDWLPG
"RTN","SDWLROI",85,0)
 W !,?80-$L("STARTED Date: ")\2,"STARTED Date: " S Y=$P(SDWLDATE,U,1) D DD^%DT W Y
"RTN","SDWLROI",86,0)
 W !,?80-$L("FINISHED Date: ")\2,"FINISHED Date: " S Y=$P(SDWLDATE,U,2) D DD^%DT W Y
"RTN","SDWLROI",87,0)
 Q
"RTN","SDWLROI",88,0)
HD1 ;
"RTN","SDWLROI",89,0)
 W !,?20,"PREV",?90,"#",?97,"#",?104,"# NOT"  ;SD*5.3*415,446
"RTN","SDWLROI",90,0)
 W !,"WAIT LIST TYPE",?20,"REMN",?27,"CLSD",?34,"DTH",?41,"NC",?48,"SA",?55,"CC",?62,"NN",?69,"ER",?76,"CL",?83,"TR",?90,"ADD",?97,"REMN",?104,"REMVD"  ;SD*5.3*446
"RTN","SDWLROI",91,0)
 Q
"RTN","SDWLROI",92,0)
SCR S DIR(0)="E" D ^DIR S:X="^" POP=1
"RTN","SDWLROI",93,0)
 Q
"RTN","SDWLROI",94,0)
END D EN^SDWLKIL
"RTN","SDWLROI",95,0)
 K ^TMP("SDWLROI1",$J),^TMP("SDWLROI2",$J),CT,DATE,I,INS
"RTN","SDWLROI",96,0)
 K T1,T2,T3,T4,T5,T6,T7,T8,T9,T10,T11,T12,T13,X1,X2,X3,X0,Y1,W1,X4,X1,X2  ;SD*5.3*446
"RTN","SDWLROI",97,0)
 K TT1,TT2,TT3,TT4,TT5,TT6,TT7,TT8,TT9,TT10,TT11,TT12,TT13,SDWLXEN,SDWLRDT,SDWLIOSR  ;SD*5.3*446
"RTN","SDWLROI",98,0)
 Q
"RTN","SDWLROIS")
0^16^B30723054^B30608896
"RTN","SDWLROIS",1,0)
SDWLROIS ;;IOFO BAY PINES/RLC/WAIT LIST STAT REPORT - ENROLLEE - SORT ; 011 Jan 2005  9:15 AM
"RTN","SDWLROIS",2,0)
 ;;5.3;scheduling;**412,415,446**;AUG 13 1993;Build 77
"RTN","SDWLROIS",3,0)
 ;
"RTN","SDWLROIS",4,0)
 ; Original routine SDWLROI was exceeding SACC maximum size of 10000.
"RTN","SDWLROIS",5,0)
 ; This new routine added to do the Sort portion of the report.
"RTN","SDWLROIS",6,0)
 ;
"RTN","SDWLROIS",7,0)
 ;
"RTN","SDWLROIS",8,0)
SORT(SDWLBD,SDWLED,SDWLINS,SDWL) ;SORT AND CALCULATE STAT REPORT ;SD*5.3*415
"RTN","SDWLROIS",9,0)
 K ^TMP("SDWLROI1",$J),^TMP("SDWLROI2",$J) S (SDWLERR,SDWLPR,SDWLC,SDWLD,SDWLNC,SDWLSA,SDWLCC,SDWLNN,SDWLER,SDWLTR,SDWLAD,SDWLRE,SDWLNR,SDWLCL)=0  ;SD*5.3*415,446
"RTN","SDWLROIS",10,0)
 S SDWLDA=0 F  S SDWLDA=$O(^SDWL(409.3,SDWLDA)) Q:SDWLDA=""  D
"RTN","SDWLROIS",11,0)
 .S SDWLX=$G(^SDWL(409.3,SDWLDA,0)) Q:SDWLX=""  S SDWLINSN=+$P(SDWLX,U,3) I 'SDWLINSN Q
"RTN","SDWLROIS",12,0)
 .S SDWLPRI=$P(SDWLX,U,11) I SDWLPRI="" S SDWLPRI="U"
"RTN","SDWLROIS",13,0)
 .S SDWLDFN=+SDWLX I 'SDWLDFN Q
"RTN","SDWLROIS",14,0)
 .S SDWLTYP=$P(SDWLX,U,5) D:'SDWLTYP S1A S SDWLTYPN=$S(SDWLTYP=1:$P(SDWLX,U,6),SDWLTYP=2:$P(SDWLX,U,7),SDWLTYP=3:$P(SDWLX,U,8),SDWLTYP=4:$P(SDWLX,U,9),1:"")
"RTN","SDWLROIS",15,0)
 .I SDWLTYPN="" Q
"RTN","SDWLROIS",16,0)
 .S SDWLFLD=$S(SDWLTYP=1:5,SDWLTYP=2:6,SDWLTYP=3:7,SDWLTYP=4:8)
"RTN","SDWLROIS",17,0)
 .S SDWLTYNM=$$EXTERNAL^DILFD(409.3,SDWLFLD,,SDWLTYPN) I SDWLTYNM="" S SDWLTYNM="UNKNOWN"
"RTN","SDWLROIS",18,0)
 .I 'SDWLINSN Q
"RTN","SDWLROIS",19,0)
 .I $D(SDWL("INS")) D
"RTN","SDWLROIS",20,0)
 ..;CHECK FOR SPECIFIC INSTITUTIONAL SORT
"RTN","SDWLROIS",21,0)
 ..S SDWLINS=$P(SDWLX,U,3),SDWLERR=0 I SDWLINS'="ALL",'$D(SDWL("INS",SDWLINS)) S SDWLERR=1 Q
"RTN","SDWLROIS",22,0)
 ..S SDWLPRI=$P(SDWLX,U,11) I SDWLPRI="" S SDWLPRI="N"
"RTN","SDWLROIS",23,0)
 .I SDWLERR Q
"RTN","SDWLROIS",24,0)
 .;CHECK DATE RANGE
"RTN","SDWLROIS",25,0)
 .S SDWLOFDT=$P(SDWLX,U,2),SDWLOK1=1 I SDWLOFDT>SDWLBD!(SDWLOFDT=SDWLBD) D
"RTN","SDWLROIS",26,0)
 ..I SDWLOFDT<SDWLED!(SDWLOFDT=SDWLED) S SDWLOK1=0
"RTN","SDWLROIS",27,0)
 .S X1=$P(^DIC(4,+$P(SDWLX,U,3),0),U,1),Y1=SDWLTYP
"RTN","SDWLROIS",28,0)
 .S SDWLXEN=$P(SDWLX,U,20) I SDWLXEN="" S SDWLXEN="U"
"RTN","SDWLROIS",29,0)
 .S:'$D(^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"AD")) ^("AD")=0
"RTN","SDWLROIS",30,0)
 .S:'$D(^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"AD")) ^("AD")=0
"RTN","SDWLROIS",31,0)
 .I 'SDWLOK1 D S1
"RTN","SDWLROIS",32,0)
 .S:'$D(^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"NR")) ^("NR")=0
"RTN","SDWLROIS",33,0)
 .S:'$D(^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")) ^("NR")=0
"RTN","SDWLROIS",34,0)
 .S SDWLDFDT=0,SDWLOK3=1 I $D(^SDWL(409.3,SDWLDA,"DIS")) S SDWLDFDT=$P(^("DIS"),U,1),SDWLOK3=0 I SDWLDFDT<SDWLBD!(SDWLDFDT>SDWLED) S SDWLOK3=1
"RTN","SDWLROIS",35,0)
 .S:'$D(^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"CL")) ^("CL")=0
"RTN","SDWLROIS",36,0)
 .S:'$D(^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"CL")) ^("CL")=0
"RTN","SDWLROIS",37,0)
 .I 'SDWLOK3 D S3
"RTN","SDWLROIS",38,0)
 .S SDWLTYP=$P(SDWLX,U,5)
"RTN","SDWLROIS",39,0)
 .S:'$D(^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"PR")) ^("PR")=0
"RTN","SDWLROIS",40,0)
 .S:'$D(^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"PR")) ^("PR")=0
"RTN","SDWLROIS",41,0)
 .S SDWLFLG=0
"RTN","SDWLROIS",42,0)
 .I SDWLOFDT'>SDWLBD D
"RTN","SDWLROIS",43,0)
 ..I SDWLOFDT=SDWLBD Q
"RTN","SDWLROIS",44,0)
 ..I $P(SDWLX,U,17)["O" S SDWLFLG=1
"RTN","SDWLROIS",45,0)
 ..I $D(^SDWL(409.3,SDWLDA,"DIS")) D
"RTN","SDWLROIS",46,0)
 ...I 'SDWLFLG,($P($G(^SDWL(409.3,SDWLDA,"DIS")),U,1)>SDWLBD)!($P($G(^SDWL(409.3,SDWLDA,"DIS")),U,1)=SDWLBD) S SDWLFLG=1
"RTN","SDWLROIS",47,0)
 ..I SDWLFLG D
"RTN","SDWLROIS",48,0)
 ...S ^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"PR")=^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"PR")+1
"RTN","SDWLROIS",49,0)
 ...S ^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"PR")=^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"PR")+1
"RTN","SDWLROIS",50,0)
 .I $P(SDWLX,U,14) D
"RTN","SDWLROIS",51,0)
 ..S SDWLRDT=$P(SDWLX,U,14)
"RTN","SDWLROIS",52,0)
 ..I SDWLRDT>SDWLBD!(SDWLRDT=SDWLBD)!(SDWLRDT<SDWLED)!(SDWLRDT=SDWLED) D
"RTN","SDWLROIS",53,0)
 ...S:'$D(^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"NR")) ^("NR")=0
"RTN","SDWLROIS",54,0)
 ...S ^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"NR")=^("NR")+1
"RTN","SDWLROIS",55,0)
 ...S:'$D(^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")) ^("NR")=0
"RTN","SDWLROIS",56,0)
 ...S ^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")=^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")+1
"RTN","SDWLROIS",57,0)
 .D S2
"RTN","SDWLROIS",58,0)
 Q
"RTN","SDWLROIS",59,0)
S1A ; SET WAIL LIST TYPE IF NOT IN FILE - SD*5.3*412
"RTN","SDWLROIS",60,0)
 S N=0
"RTN","SDWLROIS",61,0)
 F I=6:1:9 S N=N+1 I $P(SDWLX,U,I) S SDWLTYP=N D SET Q
"RTN","SDWLROIS",62,0)
 Q
"RTN","SDWLROIS",63,0)
 ;
"RTN","SDWLROIS",64,0)
SET ;SD*5.3*412
"RTN","SDWLROIS",65,0)
 S DA=SDWLDA
"RTN","SDWLROIS",66,0)
 S DIE="^SDWL(409.3,",DR="4////^S X=SDWLTYP" D ^DIE
"RTN","SDWLROIS",67,0)
 K DA,DIE,DR,I,N
"RTN","SDWLROIS",68,0)
 Q
"RTN","SDWLROIS",69,0)
 ;
"RTN","SDWLROIS",70,0)
S1 ;ORIGINATING DATE MEETS CRITERIA
"RTN","SDWLROIS",71,0)
 ;
"RTN","SDWLROIS",72,0)
 S ^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"AD")=^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"AD")+1
"RTN","SDWLROIS",73,0)
 S ^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"AD")=^("AD")+1
"RTN","SDWLROIS",74,0)
 Q
"RTN","SDWLROIS",75,0)
S2 ;DO NOT REMOVE DATE MEETS CRITERIA
"RTN","SDWLROIS",76,0)
 ;
"RTN","SDWLROIS",77,0)
 S X0=^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"PR"),X2=$G(^("AD")),X3=$G(^("CL")) S X4=X0+X2-X3
"RTN","SDWLROIS",78,0)
 S ^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"RR")=($G(^("PR"))+($G(^("AD"))))-$G(^("CL"))
"RTN","SDWLROIS",79,0)
 S ^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")=^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")+1
"RTN","SDWLROIS",80,0)
 Q
"RTN","SDWLROIS",81,0)
S3 S SDWLDIS=^SDWL(409.3,SDWLDA,"DIS")  D
"RTN","SDWLROIS",82,0)
 .S ^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"CL")=^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,"CL")+1
"RTN","SDWLROIS",83,0)
 .S ^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"CL")=^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"CL")+1
"RTN","SDWLROIS",84,0)
 .S SDWLDP=$P(SDWLDIS,U,3),X="SDWL"_SDWLDP,@X=@X+1 S:'$D(^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,X)) ^(X)=0
"RTN","SDWLROIS",85,0)
 .S ^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,X)=^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,X)+1
"RTN","SDWLROIS",86,0)
 .S:'$D(^TMP("SDWLROI2",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,X)) ^(X)=0
"RTN","SDWLROIS",87,0)
 .S ^TMP("SDWLROI1",$J,X1,SDWLXEN,Y1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,X)=^(X)+1
"RTN","SDWLROIS",88,0)
 Q
"RTN","SDWLRP1")
0^14^B62974233^B62357583
"RTN","SDWLRP1",1,0)
SDWLRP1 ;;IOFO BAY PINES/TEH - WAITING LIST - RPC;06/28/2002 ; 26 Aug 2002  1:25 PM  ; Compiled April 16, 2007 10:15:05
"RTN","SDWLRP1",2,0)
 ;;5.3;scheduling;**263,273,485,497,446**;AUG 13 1993;Build 77
"RTN","SDWLRP1",3,0)
 ;
"RTN","SDWLRP1",4,0)
 ;
"RTN","SDWLRP1",5,0)
 ;******************************************************************
"RTN","SDWLRP1",6,0)
 ;                             CHANGE LOG
"RTN","SDWLRP1",7,0)
 ;                                               
"RTN","SDWLRP1",8,0)
 ;   DATE                        PATCH                   DESCRIPTION
"RTN","SDWLRP1",9,0)
 ;   ----                        -----                   -----------
"RTN","SDWLRP1",10,0)
 ;   2/21/03                     SD*5.3*273              Line new+12 added "/"
"RTN","SDWLRP1",11,0)
 ;   5/10/06                     SD*5.3*446              New field: INTRA-transfer
"RTN","SDWLRP1",12,0)
OUTPUT(SDWLOUT,SDWLDFN) ;-FULL
"RTN","SDWLRP1",13,0)
 ; input:
"RTN","SDWLRP1",14,0)
 ;   DFN = Patient
"RTN","SDWLRP1",15,0)
 ;     Lookup uses Wait List data file (409.3) and returns the following data.
"RTN","SDWLRP1",16,0)
 ;     
"RTN","SDWLRP1",17,0)
 ; output:
"RTN","SDWLRP1",18,0)
 ;   SCOUT = location of data = ^TMP("SDWLG",$J,i,0)
"RTN","SDWLRP1",19,0)
 ;   for i=1:number of records returned: 
"RTN","SDWLRP1",20,0)
 ;
"RTN","SDWLRP1",21,0)
 ;         Field  Location               Description
"RTN","SDWLRP1",22,0)
 ;               1               2                       ORIGINATION DATE
"RTN","SDWLRP1",23,0)
 ;               2               3                       INSTITUTION
"RTN","SDWLRP1",24,0)
 ;               3               4                       CLINIC
"RTN","SDWLRP1",25,0)
 ;               4               5                       WAIT LIST TYPE
"RTN","SDWLRP1",26,0)
 ;               5               6                       SPECIFIC TEAM
"RTN","SDWLRP1",27,0)
 ;               5.1             22                      MARKED OPEN (SPECIFIC TEAM)
"RTN","SDWLRP1",28,0)
 ;               6               7                       SPECIFIC POSITION
"RTN","SDWLRP1",29,0)
 ;               6.1             23                      MARKED OPEN (SPEICIFIC POSITION)
"RTN","SDWLRP1",30,0)
 ;               7               8                       SERVICE /SPECIALTY
"RTN","SDWLRP1",31,0)
 ;               8               9                       SPECIFIC CLINIC
"RTN","SDWLRP1",32,0)
 ;               9               10                      ORIGINATING USER
"RTN","SDWLRP1",33,0)
 ;               10              11                      PRIORITY
"RTN","SDWLRP1",34,0)
 ;               11              12                      REQUESTED BY
"RTN","SDWLRP1",35,0)
 ;               12              13                      PROVIDER
"RTN","SDWLRP1",36,0)
 ;               22              16                      DESIRED DATE OF APPT
"RTN","SDWLRP1",37,0)
 ;               23              17                      CURRENT STATUS
"RTN","SDWLRP1",38,0)
 ;               25              18                      COMMENTS
"RTN","SDWLRP1",39,0)
 ;               27              20                      NEW ENROLLE
"RTN","SDWLRP1",40,0)
 ;
"RTN","SDWLRP1",41,0)
 N DIERR,SDWLDAX
"RTN","SDWLRP1",42,0)
 I '$D(^SDWL(409.3,"B",SDWLDFN)) S SDWLRES=-1 Q  ;- No Entry in Wait List file.
"RTN","SDWLRP1",43,0)
 S SDWLDA="" F  S SDWLDA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA)) Q:SDWLDA<1  D
"RTN","SDWLRP1",44,0)
 .S SDWLDAX="`"_SDWLDA
"RTN","SDWLRP1",45,0)
 .D FIND^DIC(409.3,,".01;1;2;3;4;5;5.1;6;6.1;7;8;9;10;11;12;15;22;23;25","PS",.SDWLDAX)
"RTN","SDWLRP1",46,0)
 I $G(DIERR) D CLEAN^DILF S SDWLRES=-1 Q
"RTN","SDWLRP1",47,0)
 K SDWLOUT S SDWLOUT=$NA(^TMP("DILIST",$J))
"RTN","SDWLRP1",48,0)
 Q
"RTN","SDWLRP1",49,0)
OUTPUT1(SDWLOUT,SDWLDFN) ;
"RTN","SDWLRP1",50,0)
 ;Brief Output - for Wait List.
"RTN","SDWLRP1",51,0)
 ; input:
"RTN","SDWLRP1",52,0)
 ;   DFN = Patient
"RTN","SDWLRP1",53,0)
 ;     Lookup uses Wait List data file (409.3) and returns the following data.
"RTN","SDWLRP1",54,0)
 ;
"RTN","SDWLRP1",55,0)
 ; output:
"RTN","SDWLRP1",56,0)
 ;   SWDLRES = On/Not on Wait list^Number of IENs^IEN;IEN;IEN;IEN.....
"RTN","SDWLRP1",57,0)
 ;            1     0            ^      2       ^1;2
"RTN","SDWLRP1",58,0)
 ;
"RTN","SDWLRP1",59,0)
 S SDWLCNT=0,SDWLIEN=""
"RTN","SDWLRP1",60,0)
 I '$D(^SDWL(409.3,"B",SDWLDFN)) S SDWLRES=$NA(^TMP("SDWLRP1",$J)),^TMP("SDWLRP1",$J,1)=-1
"RTN","SDWLRP1",61,0)
 S SDWLDA=""  F  S SDWLDA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA)) Q:SDWLDA<1  D
"RTN","SDWLRP1",62,0)
 .I $P(^SDWL(409.3,SDWLDA,0),U,17)["C" Q
"RTN","SDWLRP1",63,0)
 .S SDWLCNT=SDWLCNT+1
"RTN","SDWLRP1",64,0)
 .S ^TMP("SDWLRP1",$J,SDWLCNT)=SDWLDA_"^"_$G(^SDWL(409.3,SDWLDA,0))
"RTN","SDWLRP1",65,0)
 S SDWLOUT=$NA(^TMP("SDWLRP1",$J))
"RTN","SDWLRP1",66,0)
 K SDWLDFN,SDWLDA,SDWLCNT,SDWLIEN
"RTN","SDWLRP1",67,0)
 Q
"RTN","SDWLRP1",68,0)
OUTPUT3(SDWLOUT,SDWLDFN) ;Disposition Data
"RTN","SDWLRP1",69,0)
 ;  input:
"RTN","SDWLRP1",70,0)
 ;    DFN = Patient Internal ID
"RTN","SDWLRP1",71,0)
 ;    
"RTN","SDWLRP1",72,0)
 ;  output: Subscript 'DIS'
"RTN","SDWLRP1",73,0)
 ;    Date Dsipositioned^Disposition by^Disposition  
"RTN","SDWLRP1",74,0)
 ;
"RTN","SDWLRP1",75,0)
 N SDWLRES,SDWLDFN,SDWLDA,DIERR
"RTN","SDWLRP1",76,0)
 I '$D(^SDWL(409.3,"B",SDWLDFN)) S SDWLRES=-1 Q  ;- No Entry in Wait List file.
"RTN","SDWLRP1",77,0)
 S SDWLDA="" F  S SDWLDA=$O(^SDWL(409.3,"B",SDWLDFN,SDWLDA)) Q:SDWLDA<1  D
"RTN","SDWLRP1",78,0)
 .S SDWLDAX="`"_SDWLDA
"RTN","SDWLRP1",79,0)
 .D FIND^DIC(409.3,,"19;20;21","PS",.SDWLDAX)
"RTN","SDWLRP1",80,0)
 I $G(DIERR) D CLEAN^DILF S SDWLRES=-1 Q
"RTN","SDWLRP1",81,0)
 K SDWLOUT S SDWLOUT="^TMP(""DILIST"","_$J_")",SDWLRES=1
"RTN","SDWLRP1",82,0)
 Q
"RTN","SDWLRP1",83,0)
INPUT(SDWLRES,SDWLSTR) ;
"RTN","SDWLRP1",84,0)
 ; Input:
"RTN","SDWLRP1",85,0)
 ;   SDWLSTR = location of data = ^TMP("SDWLG",$J,i,0)
"RTN","SDWLRP1",86,0)
 ;   (R) = Required Field
"RTN","SDWLRP1",87,0)
 ;   (O) = Optional
"RTN","SDWLRP1",88,0)
 ;   
"RTN","SDWLRP1",89,0)
 ;    .01    2           3                     5                  6                    
"RTN","SDWLRP1",90,0)
 ;  DFN (R)^TYPE (R)^SPECIFIC TEAM (O)^SPECIFIC POSITION (O)^ORGINATING USER (R)^COMMENT (O)^CLINIC (O)^INTRA FLAG (O)^REJ FLAG (O)^MULTI TEAM FLAG (O)
"RTN","SDWLRP1",91,0)
 ;     1     2           3                     4                  5                6            7           8               9             10
"RTN","SDWLRP1",92,0)
 ;
"RTN","SDWLRP1",93,0)
 ;  Output:
"RTN","SDWLRP1",94,0)
 ;               SDWLRES  =  0      Failed
"RTN","SDWLRP1",95,0)
 ;               SDWLRES  =  1^IEN  Saved to ^SDWL(409.3,IEN,0)            
"RTN","SDWLRP1",96,0)
 ;
"RTN","SDWLRP1",97,0)
 N DIERR,%H,SDWLF,SDWLFLD,SDWLFLG,SDWLI,SDWLIN,SDWLMSG,SDWLRNED,SDWLTP,SDWLVAL,SDWLX,SDWLY,X,Y
"RTN","SDWLRP1",98,0)
 K ^TMP("SDWLIN",$J),^TMP("SDWLOUT",$J),^TMP("DIERR",$J)
"RTN","SDWLRP1",99,0)
 I '$G(SDWLSTR) S SDWLRES="-1^Data String Missing" Q
"RTN","SDWLRP1",100,0)
 D NEW
"RTN","SDWLRP1",101,0)
 D FDA I SDWLRES<0 D DEL Q
"RTN","SDWLRP1",102,0)
 ;D VAL I SDWLRES<0 D DEL Q
"RTN","SDWLRP1",103,0)
 D SET I SDWLRES<0 D DEL Q
"RTN","SDWLRP1",104,0)
 D CLEAN^DILF K ^TMP("SDWLIN",$J),^TMP("SDWLOUT",$J)
"RTN","SDWLRP1",105,0)
 K SDWLDUZ,SDWLDFN,SDWLDA,Y
"RTN","SDWLRP1",106,0)
 Q
"RTN","SDWLRP1",107,0)
NEW ;Get IEN from ^SDWL(409.3,IEN,0).
"RTN","SDWLRP1",108,0)
 N DA,DIC,DIE,DIK,DR,SDREJ,SDINTRA,SDMULTI
"RTN","SDWLRP1",109,0)
 I $P(SDWLSTR,U,4) D
"RTN","SDWLRP1",110,0)
 .S SDWLTP=+$P(SDWLSTR,U,4)
"RTN","SDWLRP1",111,0)
 .S SDWLIN=$P($G(^SCTM(404.51,+$P(^SCTM(404.57,SDWLTP,0),U,2),0)),U,7)
"RTN","SDWLRP1",112,0)
 I $P(SDWLSTR,U,3) D
"RTN","SDWLRP1",113,0)
 .S SDWLIN=$P($G(^SCTM(404.51,+$P(SDWLSTR,U,3),0)),U,7)
"RTN","SDWLRP1",114,0)
 S SDWLDFN=+$P(SDWLSTR,U,1)
"RTN","SDWLRP1",115,0)
 S SDREJ=$P(SDWLSTR,U,9),SDINTRA=$P(SDWLSTR,U,8),SDMULTI=$P(SDWLSTR,U,10)
"RTN","SDWLRP1",116,0)
 ;identify INTRA-transfer
"RTN","SDWLRP1",117,0)
 ;- last team assignment
"RTN","SDWLRP1",118,0)
 S DIC(0)="LX",X=$P(SDWLSTR,U,1),DIC="^SDWL(409.3," D FILE^DICN I Y<0 S SDWLRES="-1^IEN failed" Q
"RTN","SDWLRP1",119,0)
 S SDWLDFN=$P(Y,U,2),SDWLDA=+Y,SDWLDUZ=$P(SDWLSTR,U,9)
"RTN","SDWLRP1",120,0)
 S DIE="^SDWL(409.3,",DA=SDWLDA
"RTN","SDWLRP1",121,0)
 S DR="1///^S X=DT" D ^DIE
"RTN","SDWLRP1",122,0)
 S DR="2////^S X=SDWLIN;32////^S X=SDREJ;34////^S X=SDINTRA;38////^S X=SDMULTI" D ^DIE
"RTN","SDWLRP1",123,0)
 S DR="23///^S X=""O""",DIE="^SDWL(409.3," D ^DIE
"RTN","SDWLRP1",124,0)
 ;
"RTN","SDWLRP1",125,0)
 ;DETERMINE ENROLLEE STATUS
"RTN","SDWLRP1",126,0)
 ;
"RTN","SDWLRP1",127,0)
 ;SDWLE=1 = NEW ENROLLEE
"RTN","SDWLRP1",128,0)
 ;SDWLE=2 = ESTABLISHED
"RTN","SDWLRP1",129,0)
 ;SDWLE=3 = PRIOR ENROLLEE
"RTN","SDWLRP1",130,0)
 ;SDWLE=4 = UNDETERMINED
"RTN","SDWLRP1",131,0)
 ;
"RTN","SDWLRP1",132,0)
 S SDWLDE=+$H,SDWLE=0,(SDWLEE,SDWLRNED,SDWLDB)=0 D SB1
"RTN","SDWLRP1",133,0)
 G SB0:SDWLE=2
"RTN","SDWLRP1",134,0)
 S SDWLRNE=$$ENROLL^EASWTAPI(SDWLDFN) G SB0:$P(SDWLRNE,U,4)="A" S SDWLRNED=$P(SDWLRNE,U,3)
"RTN","SDWLRP1",135,0)
 I SDWLRNED S X=SDWLRNED D H^%DTC S SDWLDS=%H S SDWLDE=+$H,SDWLDET=SDWLDE-SDWLDS,SDWLDB=2 I SDWLDET<366 S SDWLE=1
"RTN","SDWLRP1",136,0)
 I $D(SDWLDET),SDWLDET>365 S SDWLE=3
"RTN","SDWLRP1",137,0)
 I 'SDWLRNE S SDWLE=4
"RTN","SDWLRP1",138,0)
SB0 I $D(SDWLRNE),$P(SDWLRNE,U,4)="A" D
"RTN","SDWLRP1",139,0)
 .I 'SDWLRNE,SDWLEE>730!(SDWLEE=730) S SDWLE=4 Q
"RTN","SDWLRP1",140,0)
 .I 'SDWLEE S SDWLE=4 Q
"RTN","SDWLRP1",141,0)
 S SDWLRNE=$S(SDWLE=1:"N",SDWLE=2:"E",SDWLE=3:"P",SDWLE=4:"U",1:"U")
"RTN","SDWLRP1",142,0)
 ;-Code here for filling in 409.3
"RTN","SDWLRP1",143,0)
 S DR="27////^S X=SDWLRNE",DIE="^SDWL(409.3,",DA=SDWLDA D ^DIE
"RTN","SDWLRP1",144,0)
 S DR="9////^S X=DUZ" D ^DIE
"RTN","SDWLRP1",145,0)
 S DR="27.1////^S X=$S($G(SDWLRNED):SDWLRNED,$G(SDWLD):SDWLD,1:"""")" D ^DIE
"RTN","SDWLRP1",146,0)
 S DR="27.2////^S X=SDWLDB" D ^DIE
"RTN","SDWLRP1",147,0)
 K SDWLRNE,SDWLD,SDWLDE,SDWLEE,SDWLDET,DIC,DIR,DR,DIE,SDWLDS,SDWLE
"RTN","SDWLRP1",148,0)
 Q
"RTN","SDWLRP1",149,0)
SB1 I '$D(^DGCN(391.91,"B",SDWLDFN)) N SDWLDB S SDWLE=3 Q
"RTN","SDWLRP1",150,0)
 S SDWLX="" F  S SDWLX=$O(^DGCN(391.91,"B",SDWLDFN,SDWLX)) Q:SDWLX=""  D
"RTN","SDWLRP1",151,0)
 .S SDWLY=$G(^DGCN(391.91,SDWLX,0)) D
"RTN","SDWLRP1",152,0)
 ..;CHECK FOR TREATING FACILITY
"RTN","SDWLRP1",153,0)
 ..I $$TF^XUAF4(+$P(SDWLY,U,2)) D
"RTN","SDWLRP1",154,0)
 ...;SORT FOR LAST TREATMENT DATE
"RTN","SDWLRP1",155,0)
 ...S SDWLD=$P(SDWLY,U,3) I SDWLD S SDWLDTF(9999999-SDWLD)=SDWLX
"RTN","SDWLRP1",156,0)
 I '$D(SDWLDTF) Q
"RTN","SDWLRP1",157,0)
 S SDWLDTF=$O(SDWLDTF(0)) I SDWLDTF S (SDWLD,X)=9999999-SDWLDTF D H^%DTC S SDWLEE=SDWLDE-%H,SDWLDB=1 I SDWLEE<730 S SDWLE=2
"RTN","SDWLRP1",158,0)
 I $D(SDWLEE),SDWLEE>730!(SDWLEE=730) S SDWLE=3
"RTN","SDWLRP1",159,0)
 K SDWLDTF
"RTN","SDWLRP1",160,0)
 Q
"RTN","SDWLRP1",161,0)
FDA ;Get data from SDWLSTR string and set FDA.
"RTN","SDWLRP1",162,0)
 S SDWLF=409.3
"RTN","SDWLRP1",163,0)
 S SDWLVAL="" F SDWLI=2:1:7 S SDWLVAL=$P(SDWLSTR,"^",SDWLI) D
"RTN","SDWLRP1",164,0)
 .S SDWLFLD=SDWLI D
"RTN","SDWLRP1",165,0)
 ..S SDWLFLD=$S(SDWLFLD=2:4,SDWLFLD=3:5,SDWLFLD=4:6,SDWLFLD=5:9,SDWLFLD=7:15,1:25)
"RTN","SDWLRP1",166,0)
 .S SDWLFLG="F",SDWLIEN=$$IENS^DILF(SDWLDA) ;,SDWLVAL=$$EXTERNAL^DILFD(SDWLF,SDWLFLD,,SDWLVAL,"SDWLMSG")
"RTN","SDWLRP1",167,0)
 .I $D(SDWLMSG) M SDWLRES=SDWLMSG S SDWLRES=-1 Q
"RTN","SDWLRP1",168,0)
 .D FDA^DILF(SDWLF,SDWLIEN,SDWLFLD,"",SDWLVAL,"^TMP(""SDWLIN"",$J)")
"RTN","SDWLRP1",169,0)
 .S SDWLRES=1 M SDWLRES("SDWLIN")=^TMP("SDWLIN",$J)
"RTN","SDWLRP1",170,0)
 Q
"RTN","SDWLRP1",171,0)
VAL ;Validate fields
"RTN","SDWLRP1",172,0)
 N DIERR
"RTN","SDWLRP1",173,0)
 D VALS^DIE(,"^TMP(""SDWLIN"",$J)","^TMP(""SDWLOUT"",$J)","SDWLMSG")
"RTN","SDWLRP1",174,0)
 I $G(SDWLMSG("DIERR")) S SDWLRES=-1 Q
"RTN","SDWLRP1",175,0)
 M SDWLRES("SDWLOUT")=^TMP("SDWLOUT",$J)
"RTN","SDWLRP1",176,0)
 Q
"RTN","SDWLRP1",177,0)
SET ;Input data to file ^SDWL(409.3,IEN,0).
"RTN","SDWLRP1",178,0)
 D UPDATE^DIE(,"^TMP(""SDWLIN"",$J)","SDWLMSG")
"RTN","SDWLRP1",179,0)
 I $G(SDWLMSG("DIERR")) S SDWLRES=-1 Q
"RTN","SDWLRP1",180,0)
 S SDWLRES=1_"^"_$G(SDWLDA)
"RTN","SDWLRP1",181,0)
 Q
"RTN","SDWLRP1",182,0)
DEL S DA=SDWLDA,DIK="^SDWL(409.3," D ^DIK
"RTN","SDWLRP1",183,0)
 S SDWLRES="-1^Entry "_SDWLDA_" Deleted"
"RTN","SDWLRP1",184,0)
 Q
"RTN","SDWLRP1",185,0)
INPUTDP(SDWLRES,SDWLSTR) ;Set disposition in Wait List Patient file
"RTN","SDWLRP1",186,0)
 ;
"RTN","SDWLRP1",187,0)
 ;       Input:
"RTN","SDWLRP1",188,0)
 ;       
"RTN","SDWLRP1",189,0)
 ;               SDWLSTR=Patient DFN^Disposition^User DUZ^Wait List IEN
"RTN","SDWLRP1",190,0)
 ;               
"RTN","SDWLRP1",191,0)
 ;       Ouput:
"RTN","SDWLRP1",192,0)
 ;       
"RTN","SDWLRP1",193,0)
 ;           SDWLRES=-1 Failed
"RTN","SDWLRP1",194,0)
 ;           SDWKRES=1^IEN for Wait List File (409.3)
"RTN","SDWLRP1",195,0)
 ;
"RTN","SDWLRP1",196,0)
 N SDWLDFN,SDWLDISP,SDWLDUZ,SDWLDA,SDWLDDT
"RTN","SDWLRP1",197,0)
 I '$G(SDWLSTR) S SDWLRES="-1^Data String Missing" Q
"RTN","SDWLRP1",198,0)
 I '$G(^SDWL(409.3,SDWLDA,0)) S SDWLRES="-1^Missing Patient IEN" Q
"RTN","SDWLRP1",199,0)
 I '$D(^SDWL(409.3,"B",SDWLDFN)) S SDWLRES="-1^Missing Wait List data file" Q
"RTN","SDWLRP1",200,0)
 D FDA1 I SDWLRES<0 D DEL1 Q
"RTN","SDWLRP1",201,0)
 D VAL1 I SDWLRES<0 D DEL1 Q
"RTN","SDWLRP1",202,0)
 D SET1 I SDWLRES<0 D DEL1 Q
"RTN","SDWLRP1",203,0)
 D CLEAN^DILF K ^TMP("SDWLIN",$J),^TMP("SDWLOUT",$J)
"RTN","SDWLRP1",204,0)
 Q
"RTN","SDWLRP1",205,0)
FDA1 ;
"RTN","SDWLRP1",206,0)
 S SDWLDFN=$P(SDWLSTR,U,1),SDWLDISP=$P(SDWLSTR,U,2),SDWLDUZ=$P(SDWLSTR,U,3),SDWLDA=$P(SDWLSTR,U,4),SDWLDDT=DT
"RTN","SDWLRP1",207,0)
 S SDWLIEN=$$IENS^DILF(SDWLDA)
"RTN","SDWLRP1",208,0)
 F SDWLI=1:1:4 S SDWLVAL=$S(SDWLI=1:SDWLDISP,SDWLI=2:SDWLDUZ,SDWLI=3:SDWLDDT,SDWLI=4:"C"),SDWLFLD=$S(SDWLI=1:21,SDWLI=2:20,SDWLI=3:19,SDWLI=4:23) D
"RTN","SDWLRP1",209,0)
 .S SDWLVAL=$$EXTERNAL^DILFD(SDWLF,SDWLFLD,,SDWLVAL,"SDWLMSG")
"RTN","SDWLRP1",210,0)
 .I $D(SDWLMSG) M SDWLRES=SDWLMSG S SDWLRES=-1 Q
"RTN","SDWLRP1",211,0)
 .D FDA^DILF(SDWLF,SDWLIEN,SDWLFLD,"",SDWLVAL,"^TMP(""SDWLIN"",$J)")
"RTN","SDWLRP1",212,0)
 .S SDWLRES=1 M SDWLRES("SDWLIN")=^TMP("SDWLIN",$J)
"RTN","SDWLRP1",213,0)
 Q
"RTN","SDWLRP1",214,0)
VAL1 ;
"RTN","SDWLRP1",215,0)
 N DIERR
"RTN","SDWLRP1",216,0)
 D VALS^DIE(,"^TMP(""SDWLIN"",$J)","^TMP(""SDWLOUT"",$J)","SDWLMSG")
"RTN","SDWLRP1",217,0)
 I $G(SDWLMSG("DIERR")) S SDWLRES=-1 Q
"RTN","SDWLRP1",218,0)
 M SDWLRES("SDWLOUT")=^TMP("SDWLOUT",$J)
"RTN","SDWLRP1",219,0)
 Q
"RTN","SDWLRP1",220,0)
SET1 ;
"RTN","SDWLRP1",221,0)
 D UPDATE^DIE(,"^TMP(""SDWLOUT"",$J)","SDWLMSG")
"RTN","SDWLRP1",222,0)
 I $G(SDWLMSG("DIERR")) S SDWLRES=-1 Q
"RTN","SDWLRP1",223,0)
 S SDWLRES=1
"RTN","SDWLRP1",224,0)
 Q
"RTN","SDWLRP1",225,0)
DEL1 ;
"RTN","SDWLRP1",226,0)
 S DA(1)=SDWLDA,DIK="^SDWL("_DA(1)_",""DIS""," F DA=19,20,21,23 D ^DIK
"RTN","SDWLRP1",227,0)
 S SDWLRES="-1^"_"Disposition Nodes Deleted."
"RTN","SDWLRP1",228,0)
 Q
"RTN","SDWLRSR")
0^17^B37978690^B34050609
"RTN","SDWLRSR",1,0)
SDWLRSR ;;IOFO BAY PINES/TEH/WAIT LIST STAT REPORT ; 01 Oct 2002  4:42 PM  ; Compiled December 21, 2006 15:32:50
"RTN","SDWLRSR",2,0)
 ;;5.3;scheduling;**263,273,399,412,425,415,446**;AUG 13 1993;Build 77
"RTN","SDWLRSR",3,0)
 ;
"RTN","SDWLRSR",4,0)
 ; Removed Sort logic as routine exceeded SACC maximum size of 10000
"RTN","SDWLRSR",5,0)
 ; New routine SDWLRSRS was created to perform the Sort functionality
"RTN","SDWLRSR",6,0)
 ;
"RTN","SDWLRSR",7,0)
 ;
"RTN","SDWLRSR",8,0)
EN ;
"RTN","SDWLRSR",9,0)
 D INIT G END:$D(DUOUT)  ;SD*5.3*415
"RTN","SDWLRSR",10,0)
 D SORT^SDWLRSRS(SDWLBD,SDWLED,SDWLINS,.SDWL)  ; SD*5.3*415 new routine to perform sort
"RTN","SDWLRSR",11,0)
 D:'$$S^%ZTLOAD PRT  ;SD*5.3*415
"RTN","SDWLRSR",12,0)
 G END
"RTN","SDWLRSR",13,0)
INIT ;
"RTN","SDWLRSR",14,0)
 I $D(CT) S SDWLCT2=CT
"RTN","SDWLRSR",15,0)
 I $D(DATE) S SDWLDATE=DATE
"RTN","SDWLRSR",16,0)
 I $D(INS) S SDWLINS=INS
"RTN","SDWLRSR",17,0)
 I $D(ZTSAVE) D
"RTN","SDWLRSR",18,0)
 .S SDWLCT=$G(ZTSAVE("CT")),SDWLDATE=$G(ZTSAVE("DATE")),SDWLINS=$G(ZTSAVE("INS"))
"RTN","SDWLRSR",19,0)
 I SDWLINS'="ALL" F I=1:1 S SDWL=$P(SDWLINS,";",I) Q:SDWL=""  S SDWL("INS",+SDWL)=""
"RTN","SDWLRSR",20,0)
 S SDWLBD=$P(SDWLDATE,U,1),SDWLED=$P(SDWLDATE,U,2),SDWLPG=0
"RTN","SDWLRSR",21,0)
 D NOW^%DTC S Y=% D DD^%DT S SDWLDTP=Y
"RTN","SDWLRSR",22,0)
 N POP S POP=0  ;SD*5.3*412
"RTN","SDWLRSR",23,0)
 Q
"RTN","SDWLRSR",24,0)
PRT ;PRINT REPORT
"RTN","SDWLRSR",25,0)
 S (T1,T2,T3,T4,T5,T6,T7,T8,T9,T10,T11,T12,T13)=0  ;SD*5.3*446
"RTN","SDWLRSR",26,0)
 S (TT1,TT2,TT3,TT4,TT5,TT6,TT7,TT8,TT9,TT10,TT11,TT12,TT13,SDWLPG)=0 D HD,HD1  ;SD*5.3*415,446
"RTN","SDWLRSR",27,0)
 I '$D(^TMP("SDWLRSR1")) W !!,"No Wait List Data to Report" Q
"RTN","SDWLRSR",28,0)
 S SDWLINS="" F  S SDWLINS=$O(^TMP("SDWLRSR1",$J,SDWLINS)) Q:SDWLINS=""  D  Q:POP  D T2  Q:POP  W !,"________________" I $Y>(IOSL-8) D:$D(SDWLSPT) SCR Q:POP  D HD,HD1  ;SD*5.3*412 added Quit for early exit; 446
"RTN","SDWLRSR",29,0)
 .I $$S^%ZTLOAD S DUOUT="" Q 
"RTN","SDWLRSR",30,0)
 .W !!,"INSTITUTION: ",SDWLINS,!
"RTN","SDWLRSR",31,0)
 .S SDWLTY="" F  S SDWLTY=$O(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY)) Q:SDWLTY=""  D  Q:POP  ;SD*5.3*412 added Quit for early exit
"RTN","SDWLRSR",32,0)
 ..S SDWLTNM=$$EXTERNAL^DILFD(409.3,4,,SDWLTY) W !,$E(SDWLTNM,1,15)
"RTN","SDWLRSR",33,0)
 ..S SDWLSCN="" F  S SDWLSCN=$O(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN)) Q:SDWLSCN=""  D  Q:POP  ;SD*5.3*412 added Quit for early exit
"RTN","SDWLRSR",34,0)
 ...S SDWLSCNM="" F  S SDWLSCNM=$O(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM)) Q:SDWLSCNM=""  D  Q:POP  D T1  Q:POP  ;SD*5.3*412 added Quit
"RTN","SDWLRSR",35,0)
 ....S SDWLPRI="" F  S SDWLPRI=$O(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI)) Q:SDWLPRI=""  D  Q:POP  ;SD*5.3*412 added Quit
"RTN","SDWLRSR",36,0)
 .....N SDWLCLO  ; SD*5.3*446
"RTN","SDWLRSR",37,0)
 .....W !,?2,$E(SDWLSCNM,1,10)," ",$S(SDWLPRI="A":"ASAP",SDWLPRI="F":"FUTURE",1:"")
"RTN","SDWLRSR",38,0)
 .....S SDWLPR=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"PR")) W ?20,SDWLPR
"RTN","SDWLRSR",39,0)
 .....S SDWLCLO=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"CL")) W ?27,SDWLCLO  ;SD*5.3*446
"RTN","SDWLRSR",40,0)
 .....S SDWLD=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLD")) W ?34,SDWLD  ;SD*5.3*415,446
"RTN","SDWLRSR",41,0)
 .....S SDWLNC=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLNC")) W ?41,SDWLNC  ;SD*5.3*415,446
"RTN","SDWLRSR",42,0)
 .....S SDWLSA=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLSA")) W ?48,SDWLSA  ;SD*5.3*415,446
"RTN","SDWLRSR",43,0)
 .....S SDWLCC=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLCC")) W ?55,SDWLCC  ;SD*5.3*415,446
"RTN","SDWLRSR",44,0)
 .....S SDWLNN=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLNN")) W ?62,SDWLNN  ;SD*5.3*415,446
"RTN","SDWLRSR",45,0)
 .....S SDWLER=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLER")) W ?69,SDWLER  ;SD*5.3*415,446
"RTN","SDWLRSR",46,0)
 .....S SDWLCL=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLCL")) W ?76,SDWLCL  ;SD*5.3*415,446
"RTN","SDWLRSR",47,0)
 .....S SDWLTR=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"SDWLTR")) W ?83,SDWLTR  ;SD*5.3*415,446
"RTN","SDWLRSR",48,0)
 .....S SDWLAD=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"AD")) W ?90,SDWLAD  ;SD*5.3*415,446
"RTN","SDWLRSR",49,0)
 .....S SDWLRR=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"RR")) W ?97,SDWLRR  ;SD*5.3*415,446
"RTN","SDWLRSR",50,0)
 .....S SDWLNR=+$G(^TMP("SDWLRSR1",$J,SDWLINS,SDWLTY,SDWLSCN,SDWLSCNM,SDWLPRI,"NR")) W ?104,SDWLNR  ;SD*5.3*446
"RTN","SDWLRSR",51,0)
 .....S T1=T1+SDWLPR,TT1=TT1+SDWLPR
"RTN","SDWLRSR",52,0)
 .....S T2=T2+SDWLCLO,TT2=TT2+SDWLCLO  ;SD*5.3*446
"RTN","SDWLRSR",53,0)
 .....S T3=T3+SDWLD,TT3=TT3+SDWLD
"RTN","SDWLRSR",54,0)
 .....S T4=T4+SDWLNC,TT4=TT4+SDWLNC
"RTN","SDWLRSR",55,0)
 .....S T5=T5+SDWLSA,TT5=TT5+SDWLSA
"RTN","SDWLRSR",56,0)
 .....S T6=T6+SDWLCC,TT6=TT6+SDWLCC
"RTN","SDWLRSR",57,0)
 .....S T7=T7+SDWLNN,TT7=TT7+SDWLNN
"RTN","SDWLRSR",58,0)
 .....S T8=T8+SDWLER,TT8=TT8+SDWLER
"RTN","SDWLRSR",59,0)
 .....S T9=T9+SDWLCL,TT9=TT9+SDWLCL  ;SD*5.3*446
"RTN","SDWLRSR",60,0)
 .....S T10=T10+SDWLTR,TT10=TT10+SDWLTR  ;SD*5.3*446
"RTN","SDWLRSR",61,0)
 .....S T11=T11+SDWLAD,TT11=TT11+SDWLAD  ;SD*5.3*446
"RTN","SDWLRSR",62,0)
 .....S T12=T12+SDWLRR,TT12=TT12+SDWLRR  ;SD*5.3*446
"RTN","SDWLRSR",63,0)
 .....S T13=T13+SDWLNR,TT13=TT13+SDWLNR  ;SD*5.3*446
"RTN","SDWLRSR",64,0)
 .....I $Y>(IOSL-8) D:$D(SDWLSPT) SCR Q:POP  D HD,HD1  ;SD*5.3*412,446
"RTN","SDWLRSR",65,0)
 Q
"RTN","SDWLRSR",66,0)
SCR S DIR(0)="E" D ^DIR S:X="^" POP=1  ;SD*5.3*412
"RTN","SDWLRSR",67,0)
 Q
"RTN","SDWLRSR",68,0)
T1 ;
"RTN","SDWLRSR",69,0)
 ;write sub-totals
"RTN","SDWLRSR",70,0)
 W !?20,"------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------"  ;SD*5.3*446
"RTN","SDWLRSR",71,0)
 W !,"Sub-Totals:",?20,T1,?27,T2,?34,T3,?41,T4,?48,T5,?55,T6,?62,T7,?69,T8,?76,T9,?83,T10,?90,T11,?97,T12,?104,T13  ;SD*5.3*446
"RTN","SDWLRSR",72,0)
 S (T1,T2,T3,T4,T5,T6,T7,T8,T9,T10,T11,T12,T13)=0  ;SD*5.3*415,446
"RTN","SDWLRSR",73,0)
 I $Y>(IOSL-8) D:$D(SDWLSPT) SCR Q:POP  D HD,HD1  ;SD*5.3*412,446
"RTN","SDWLRSR",74,0)
 Q
"RTN","SDWLRSR",75,0)
T2 W !,"Institution Totals:"
"RTN","SDWLRSR",76,0)
 W ?20,TT1,?27,TT2,?34,TT3,?41,TT4,?48,TT5,?55,TT6,?62,TT7,?69,TT8,?76,TT9,?83,TT10,?90,TT11,?97,TT12,?104,TT13,!  ;SD*5.3*446
"RTN","SDWLRSR",77,0)
 S (TT1,TT2,TT3,TT4,TT5,TT6,TT7,TT8,TT9,TT10,TT11,TT12,TT13)=0  ;SD*5.3*415,446
"RTN","SDWLRSR",78,0)
 I $Y>(IOSL-8) D:$D(SDWLSPT) SCR Q:POP  D HD,HD1  ;SD*5.3*412,446
"RTN","SDWLRSR",79,0)
 Q
"RTN","SDWLRSR",80,0)
HD W:$D(IOF) @IOF S SDWLPG=SDWLPG+1 W !!,SDWLDTP,?80-$L("Wait List (Sch/PCMM) Stat Report")\2,"Wait List (Sch/PCMM) Stat Report",?65,"Page: ",SDWLPG
"RTN","SDWLRSR",81,0)
 W !,?80-$L("STARTED Date: ")\2,"STARTED Date: " S Y=$P(SDWLDATE,U,1) D DD^%DT W Y
"RTN","SDWLRSR",82,0)
 W !,?80-$L("FINISHED Date: ")\2,"FINISHED Date: " S Y=$P(SDWLDATE,U,2) D DD^%DT W Y
"RTN","SDWLRSR",83,0)
 Q
"RTN","SDWLRSR",84,0)
HD1 ;
"RTN","SDWLRSR",85,0)
 W !,?20,"PREV",?90,"#",?97,"#",?104,"# NOT"  ;SD*5.3*415,446
"RTN","SDWLRSR",86,0)
 W !,"WAIT LIST TYPE",?20,"REMN",?27,"CLSD",?34,"DTH",?41,"NC",?48,"SA",?55,"CC",?62,"NN",?69,"ER",?76,"CL",?83,"TR",?90,"ADD",?97,"REMN",?104,"REMVD"  ;SD*5.3*446
"RTN","SDWLRSR",87,0)
 Q
"RTN","SDWLRSR",88,0)
END D EN^SDWLKIL
"RTN","SDWLRSR",89,0)
 K ^TMP("SDWLRSR1",$J),^TMP("SDWLRSR2",$J),SDWLY1,SDWLX1,SDWLRDT,CT,I
"RTN","SDWLRSR",90,0)
 K T1,T2,T3,T4,T5,T6,T7,T8,T9,T10,T11,T12,T13,SDWLAD,SDWLBD,SDWLCC,SDWLCT,SDWLDFDT,SDWLDP,SDWLED,SDWLER,SDWLERR,SDWLFLD,X1,X2,DATE  ;SD*5.3*415,446
"RTN","SDWLRSR",91,0)
 K TT1,TT2,TT3,TT4,TT5,TT6,TT7,TT8,TT9,TT10,TT11,TT12,TT13,SDWLINSN,SDWLINST,SDWLNC,SDWLNN,SDWLNR,SDWLOFDT,SDWLOK1,SDWLOK2,SDWLTYPN  ;SD*5.3*415,446
"RTN","SDWLRSR",92,0)
 K SDWLOK3,SDWLPR,SDWLPR,SDWLPROM,SDWLRE,SDWLRFDT,SDWLRR,SDWLSA,SDWLSCN,SDWLSCNM,SDWLTASK,SDWLTK,SDWLTNM,SDWLTYNM,SDWLTYP,X4,SDWLTR,SDWLCL  ;SD*5.3*415,446
"RTN","SDWLRSR",93,0)
 Q
"RTN","SDWLRSRS")
0^18^B31103709^B30769566
"RTN","SDWLRSRS",1,0)
SDWLRSRS ;;IOFO BAY PINES/OG/WAIT LIST STAT REPORT - SORT  ; Compiled September 22, 2005 10:32:25
"RTN","SDWLRSRS",2,0)
 ;;5.3;scheduling;**415,469,446**;AUG 13 1993;Build 77
"RTN","SDWLRSRS",3,0)
 ;
"RTN","SDWLRSRS",4,0)
 ; Original routine SDWLRSR exceeded SACC maximum size of 10000.
"RTN","SDWLRSRS",5,0)
 ; This new routine added to do the Sort portion of the report.
"RTN","SDWLRSRS",6,0)
 ;
"RTN","SDWLRSRS",7,0)
 ;
"RTN","SDWLRSRS",8,0)
SORT(SDWLBD,SDWLED,SDWLINS,SDWL) ;SORT AND CALCULATE STAT REPORT ;SD*5.3*415
"RTN","SDWLRSRS",9,0)
 N SDWLAD,SDWLC,SDWLCC,SDWLD,SDWLDA,SDWLDFDT,SDWLDFN,SDWLDIS,SDWLDP,SDWLER,SDWLERR,SDWLFLD,SDWLFLG,SDWLINSN,SDWLNC,SDWLNN,SDWLNR,SDWLOFDT
"RTN","SDWLRSRS",10,0)
 N SDWLOK1,SDWLOK3,SDWLPR,SDWLPRI,SDWLRDT,SDWLRE,SDWLSA,SDWLTR,SDWLTYNM,SDWLTYP,SDWLTYPN,SDWLX,SDWLX1,SDWLY1,SDWLCL  ;SD*5.3*446
"RTN","SDWLRSRS",11,0)
 K ^TMP("SDWLRSR1",$J),^TMP("SDWLRSR2",$J) S (SDWLERR,SDWLPR,SDWLC,SDWLD,SDWLNC,SDWLSA,SDWLCC,SDWLNN,SDWLER,SDWLTR,SDWLCL,SDWLAD,SDWLRE,SDWLNR)=0  ;SD*5.3*446
"RTN","SDWLRSRS",12,0)
 S SDWLDA=0 F  S SDWLDA=$O(^SDWL(409.3,SDWLDA)) Q:SDWLDA=""  D
"RTN","SDWLRSRS",13,0)
 .I $D(DUOUT) Q
"RTN","SDWLRSRS",14,0)
 .S SDWLX=$G(^SDWL(409.3,SDWLDA,0)) Q:SDWLX=""  S SDWLINSN=+$P(SDWLX,U,3) I 'SDWLINSN Q
"RTN","SDWLRSRS",15,0)
 .S SDWLPRI=$P(SDWLX,U,11) I SDWLPRI="" S SDWLPRI="U"
"RTN","SDWLRSRS",16,0)
 .S SDWLDFN=+SDWLX I 'SDWLDFN Q
"RTN","SDWLRSRS",17,0)
 .S SDWLTYP=$P(SDWLX,U,5),SDWLTYPN=$S(SDWLTYP=1:$P(SDWLX,U,6),SDWLTYP=2:$P(SDWLX,U,7),SDWLTYP=3:$P(SDWLX,U,8),SDWLTYP=4:$P(SDWLX,U,9),1:"")
"RTN","SDWLRSRS",18,0)
 .I SDWLTYPN="" Q
"RTN","SDWLRSRS",19,0)
 .S SDWLFLD=$S(SDWLTYP=1:5,SDWLTYP=2:6,SDWLTYP=3:7,SDWLTYP=4:8)
"RTN","SDWLRSRS",20,0)
 .S SDWLTYNM=$$EXTERNAL^DILFD(409.3,SDWLFLD,,SDWLTYPN) I SDWLTYNM="" S SDWLTYNM="UNKNOWN"
"RTN","SDWLRSRS",21,0)
 .I 'SDWLINSN Q
"RTN","SDWLRSRS",22,0)
 .I $D(SDWL("INS")) D
"RTN","SDWLRSRS",23,0)
 ..;CHECK FOR SPECIFIC INSTITUTIONAL SORT
"RTN","SDWLRSRS",24,0)
 ..S SDWLINS=$P(SDWLX,U,3),SDWLERR=0 I SDWLINS'="ALL",'$D(SDWL("INS",SDWLINS)) S SDWLERR=1 Q
"RTN","SDWLRSRS",25,0)
 ..S SDWLPRI=$P(SDWLX,U,11) I SDWLPRI="" S SDWLPRI="N"
"RTN","SDWLRSRS",26,0)
 .I SDWLERR Q
"RTN","SDWLRSRS",27,0)
 .;CHECK DATE RANGE
"RTN","SDWLRSRS",28,0)
 .S SDWLOFDT=$P(SDWLX,U,2),SDWLOK1=1 I SDWLOFDT>SDWLBD!(SDWLOFDT=SDWLBD) D
"RTN","SDWLRSRS",29,0)
 ..I SDWLOFDT<SDWLED!(SDWLOFDT=SDWLED) S SDWLOK1=0
"RTN","SDWLRSRS",30,0)
 .S SDWLX1=$P(^DIC(4,+$P(SDWLX,U,3),0),U,1),SDWLY1=SDWLTYP
"RTN","SDWLRSRS",31,0)
 .S:'$D(^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"AD")) ^("AD")=0
"RTN","SDWLRSRS",32,0)
 .S:'$D(^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"AD")) ^("AD")=0
"RTN","SDWLRSRS",33,0)
 .I 'SDWLOK1 D S1
"RTN","SDWLRSRS",34,0)
 .S:'$D(^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"NR")) ^("NR")=0
"RTN","SDWLRSRS",35,0)
 .S:'$D(^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")) ^("NR")=0
"RTN","SDWLRSRS",36,0)
 .S SDWLDFDT=0,SDWLOK3=1 I $D(^SDWL(409.3,SDWLDA,"DIS")) S SDWLDFDT=$P(^("DIS"),U,1),SDWLOK3=0 I SDWLDFDT<SDWLBD!(SDWLDFDT>SDWLED) S SDWLOK3=1
"RTN","SDWLRSRS",37,0)
 .S:'$D(^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"CL")) ^("CL")=0
"RTN","SDWLRSRS",38,0)
 .S:'$D(^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"CL")) ^("CL")=0
"RTN","SDWLRSRS",39,0)
 .I 'SDWLOK3 D S3
"RTN","SDWLRSRS",40,0)
 .S SDWLTYP=$P(SDWLX,U,5)
"RTN","SDWLRSRS",41,0)
 .S:'$D(^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"PR")) ^("PR")=0
"RTN","SDWLRSRS",42,0)
 .S:'$D(^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"PR")) ^("PR")=0
"RTN","SDWLRSRS",43,0)
 .S SDWLFLG=0
"RTN","SDWLRSRS",44,0)
 .I SDWLOFDT'>SDWLBD D
"RTN","SDWLRSRS",45,0)
 ..I SDWLOFDT=SDWLBD Q
"RTN","SDWLRSRS",46,0)
 ..I $P(SDWLX,U,17)["O" S SDWLFLG=1
"RTN","SDWLRSRS",47,0)
 ..I $D(^SDWL(409.3,SDWLDA,"DIS")) D
"RTN","SDWLRSRS",48,0)
 ...I 'SDWLFLG,($P($G(^SDWL(409.3,SDWLDA,"DIS")),U,1)>SDWLBD)!($P($G(^SDWL(409.3,SDWLDA,"DIS")),U,1)=SDWLBD) S SDWLFLG=1
"RTN","SDWLRSRS",49,0)
 ..I SDWLFLG D
"RTN","SDWLRSRS",50,0)
 ...S ^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"PR")=^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"PR")+1
"RTN","SDWLRSRS",51,0)
 ...S ^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"PR")=^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"PR")+1
"RTN","SDWLRSRS",52,0)
 .I $P(SDWLX,U,14) D
"RTN","SDWLRSRS",53,0)
 ..S SDWLRDT=$P(SDWLX,U,14)
"RTN","SDWLRSRS",54,0)
 ..Q:SDWLRDT<SDWLBD  Q:SDWLRDT>SDWLED  D
"RTN","SDWLRSRS",55,0)
 ...S:'$D(^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"NR")) ^("NR")=0
"RTN","SDWLRSRS",56,0)
 ...S ^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"NR")=^("NR")+1
"RTN","SDWLRSRS",57,0)
 ...S:'$D(^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")) ^("NR")=0
"RTN","SDWLRSRS",58,0)
 ...S ^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")=^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")+1
"RTN","SDWLRSRS",59,0)
 .D S2
"RTN","SDWLRSRS",60,0)
 .I $$S^%ZTLOAD S DUOUT=""
"RTN","SDWLRSRS",61,0)
 Q
"RTN","SDWLRSRS",62,0)
S1 ;ORIGINATING DATE MEETS CRITERIA
"RTN","SDWLRSRS",63,0)
 ;
"RTN","SDWLRSRS",64,0)
 S ^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"AD")=^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"AD")+1
"RTN","SDWLRSRS",65,0)
 S ^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"AD")=^("AD")+1
"RTN","SDWLRSRS",66,0)
 Q
"RTN","SDWLRSRS",67,0)
S2 ;DO NOT REMOVE DATE MEETS CRITERIA
"RTN","SDWLRSRS",68,0)
 ;
"RTN","SDWLRSRS",69,0)
 N X1,X2,X3,X4
"RTN","SDWLRSRS",70,0)
 S X1=^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"PR"),X2=$G(^("AD")),X3=$G(^("CL")) S X4=X1+X2-X3
"RTN","SDWLRSRS",71,0)
 S ^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"RR")=($G(^("PR"))+($G(^("AD"))))-$G(^("CL"))
"RTN","SDWLRSRS",72,0)
 S ^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")=^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"NR")+1
"RTN","SDWLRSRS",73,0)
 Q
"RTN","SDWLRSRS",74,0)
S3 S SDWLDIS=^SDWL(409.3,SDWLDA,"DIS")  D
"RTN","SDWLRSRS",75,0)
 .N X
"RTN","SDWLRSRS",76,0)
 .S ^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"CL")=^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,"CL")+1
"RTN","SDWLRSRS",77,0)
 .S ^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"CL")=^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,"CL")+1
"RTN","SDWLRSRS",78,0)
 .S SDWLDP=$P(SDWLDIS,U,3),X="SDWL"_SDWLDP,@X=@X+1 S:'$D(^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,X)) ^(X)=0
"RTN","SDWLRSRS",79,0)
 .S ^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,X)=^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,X)+1
"RTN","SDWLRSRS",80,0)
 .S:'$D(^TMP("SDWLRSR2",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,X)) ^(X)=0
"RTN","SDWLRSRS",81,0)
 .S ^TMP("SDWLRSR1",$J,SDWLX1,SDWLY1,SDWLTYPN,SDWLTYNM,SDWLPRI,SDWLDFN,X)=^(X)+1
"RTN","SDWLRSRS",82,0)
 Q
"RTN","SDWLTR")
0^43^B79675127^B79131220
"RTN","SDWLTR",1,0)
SDWLTR ;IOFO BAY PINES/DMR - WAIT LIST TRANSMISSION TO ACC;06/12/2002 ; 29 Aug 2002  2:54 PM  ; Compiled April 12, 2007 09:51:10
"RTN","SDWLTR",2,0)
 ;;5.3;scheduling;**270,420,446**;AUG 13 1993;Build 77
"RTN","SDWLTR",3,0)
 Q
"RTN","SDWLTR",4,0)
INIT ;
"RTN","SDWLTR",5,0)
 S (DFN,REC,WLNAMEF,WLNAMEL,WLNAMEM,WLNAME,WLNAMES,NAME,DOB,SEX,RACE,MT,MTT,SSN,SSNP,STATE,STA,ZCODE,COUNTY,CTY,PHONE,SERCON,HINS,POS,PEC,PECN,PECNN,MCAID,POW,PH,ENROLLN,ENROLL,PREFACN,PREFAC,J,JJ,INST,INSTN,CSTOP,STOP,CLINIC,INST,N,MN)=""
"RTN","SDWLTR",6,0)
 S (SWIEN,ICNUM,WLREC,WLORDT,WLTYPE,WLTEAMN,WLTEAM,WLPOSN,WLPOS,WLSPECN,WLSPEC,WLCLN,WLCL,WL,WLC,WLS,WLPRI,WLREQ,WLREMOV,WLDNMOV,WLDOD,WLRDFD,WLESTA,WLDDOA,WLCSTA,HOLD,PCMNUM,PCMMT,PCMMP,VER,WL,VETS,NUM,CLN)=""
"RTN","SDWLTR",7,0)
 S (WLD2,WLC2,WLI2,WLSC2,WLCS2,WLS2,WLAS2,WLSCP2,WLPRI2,WLA2)=""
"RTN","SDWLTR",8,0)
 S VER="1.0",N=0,MN=0,INST=+DUZ(2)
"RTN","SDWLTR",9,0)
DATA ;Check for data and setup arrays.
"RTN","SDWLTR",10,0)
 I +$P($G(^SDWL(409.31,0)),"^",4)>.5 D
"RTN","SDWLTR",11,0)
 .S J=0 F  S J=$O(^SDWL(409.31,"E",J)) Q:J=""  D
"RTN","SDWLTR",12,0)
 ..S JJ=0 F  S JJ=$O(^SDWL(409.31,"E",J,JJ)) Q:JJ=""  D
"RTN","SDWLTR",13,0)
 ...S CSTOP="",CSTOP=^SDWL(409.31,+JJ,0)
"RTN","SDWLTR",14,0)
 ...S ^TMP("409.31",$J,+J,+CSTOP)=""
"RTN","SDWLTR",15,0)
 ...Q
"RTN","SDWLTR",16,0)
 I +$P($G(^SDWL(409.32,0)),"^",4)>.5 D
"RTN","SDWLTR",17,0)
 .S J=0 F  S J=$O(^SDWL(409.32,"C",J)) Q:J=""  D
"RTN","SDWLTR",18,0)
 ..S JJ=0 F  S JJ=$O(^SDWL(409.32,"C",J,JJ)) Q:JJ=""  D
"RTN","SDWLTR",19,0)
 ...S CLINIC="",CLINIC=$P($G(^SDWL(409.32,+JJ,0)),"^",1)
"RTN","SDWLTR",20,0)
 ...S ^TMP("409.32",$J,+J,+CLINIC)=""
"RTN","SDWLTR",21,0)
 ...Q
"RTN","SDWLTR",22,0)
 I +$P($G(^SDWL(409.3,0)),"^",4)<1 D NODATA,KILL Q
"RTN","SDWLTR",23,0)
 D START,MESS^SDWLTR1(.MN),NODATA,KILL
"RTN","SDWLTR",24,0)
 Q
"RTN","SDWLTR",25,0)
START ;Loop 409.3, get DFN file 2 info.
"RTN","SDWLTR",26,0)
 N SDWLREJN,SDWLSREM,SDWLINTR,SDWL120F,SDWLMULT,SDWLINTE,SDWLIDES  ; sd/446
"RTN","SDWLTR",27,0)
 F  S DFN=$O(^SDWL(409.3,"B",DFN)) Q:DFN=""  D
"RTN","SDWLTR",28,0)
 .D DEM^VADPT
"RTN","SDWLTR",29,0)
 .S (WLNAMEL,WLNAMEF,WLNAMEM,WLNAMES,WLNAME,NAME(1))="" S WLNAME("FILE")=2,WLNAME("IENS")=DFN,WLNAME("FIELD")=.01
"RTN","SDWLTR",30,0)
 .S NAME(1)=$$HLNAME^XLFNAME(.WLNAME,"","^") S WLNAMEL=$P($G(NAME(1)),"^",1),WLNAMEF=$P($G(NAME(1)),"^",2),WLNAMEM=$P($G(NAME(1)),"^",3),WLNAMES=$P($G(NAME(1)),"^",4)
"RTN","SDWLTR",31,0)
 .S NAME=WLNAMEL_"^"_WLNAMEF_"^"_WLNAMEM_" "_WLNAMES
"RTN","SDWLTR",32,0)
 .S DOB="" S DOB=$P($G(VADM(3)),"^",1)
"RTN","SDWLTR",33,0)
 .S SEX="" S SEX=$P($G(VADM(5)),"^",1)
"RTN","SDWLTR",34,0)
 .S RACE="" S RACE=$P($G(VADM(8)),"^",1)
"RTN","SDWLTR",35,0)
 .S (SSN,SSNP)="" S SSN=$P($G(VADM(2)),"^",1) I SSN["P" S SSNP="P",SSN=$E(SSN,1,9)
"RTN","SDWLTR",36,0)
 .S (MT,MTT)="" S MT=$$LST^DGMTU(DFN,DT,1) I MT'="" S MTT=1,MT=$P($G(MT),"^",4)
"RTN","SDWLTR",37,0)
 .I MT="" S MT=$$LST^DGMTU(DFN,DT,2) I MT'="" S MTT=2,MT=$P($G(MT),"^",4)
"RTN","SDWLTR",38,0)
 .D ADD^VADPT
"RTN","SDWLTR",39,0)
 .S (STATE,STA)="" S STA=$P($G(VAPA(5)),"^",1) D
"RTN","SDWLTR",40,0)
 ..I STA'="" S STATE=$E("00",$L(STA)+1,2)_STA
"RTN","SDWLTR",41,0)
 .S ZCODE="" S ZCODE=$G(VAPA(6))
"RTN","SDWLTR",42,0)
 .S (COUNTY,CTY)="" S COUNTY=$P($G(VAPA(7)),"^",1) D
"RTN","SDWLTR",43,0)
 ..I COUNTY'=""&(STATE'="") S CTY=$$GET1^DIQ(5.01,COUNTY_","_STATE,"VA COUNTY CODE") D
"RTN","SDWLTR",44,0)
 ...S COUNTY="" I CTY'="" S COUNTY=STATE_CTY
"RTN","SDWLTR",45,0)
 .S PHONE="" S PHONE=$G(VAPA(8))
"RTN","SDWLTR",46,0)
 .S SERCON="" S SERCON=$$GET1^DIQ(2,DFN_",",.302)
"RTN","SDWLTR",47,0)
 .S HINS="" S HINS=$$GET1^DIQ(2,DFN_",",.3192,"I")
"RTN","SDWLTR",48,0)
 .S (POSN,POS)="" S POSN=$$GET1^DIQ(2,DFN_",",.323,"I") I POSN'="" S POS=$$GET1^DIQ(21,POSN_",",.03)
"RTN","SDWLTR",49,0)
 .S (PEC,PECN,PECNN)="" S PECN=$$GET1^DIQ(2,DFN_",",.361,"I") I PECN'="" S PECNN=$$GET1^DIQ(8,PECN_",",8,"I") I PECNN'="" S PEC=$$GET1^DIQ(8.1,PECNN_",",3)
"RTN","SDWLTR",50,0)
 .S VETS="" S VETS=$$GET1^DIQ(2,DFN_",",1901,"I")
"RTN","SDWLTR",51,0)
 .S MCAID="" S MCAID=$$GET1^DIQ(2,DFN_",",.381,"I"),MCAID=$S(MCAID=1:"Y",MCAID=0:"N",1:"")
"RTN","SDWLTR",52,0)
 .S POW="" S POW=$$GET1^DIQ(2,DFN_",",.525,"I")
"RTN","SDWLTR",53,0)
 .S PH="" S PH=$$GET1^DIQ(2,DFN_",",.531,"I")
"RTN","SDWLTR",54,0)
 .S (ENROLLN,ENROLL,ENROLSUB)="" S ENROLLN=$$GET1^DIQ(2,DFN_",",27.01,"I") I ENROLLN'="" S ENROLL=$$GET1^DIQ(27.11,ENROLLN_",",.01,"I")
"RTN","SDWLTR",55,0)
 .S ENROLLP="" I ENROLLN'="" S ENROLLP=$$GET1^DIQ(27.11,ENROLLN_",",.07,"I") I ENROLLP D
"RTN","SDWLTR",56,0)
 ..S ENROLSUB=$$GET1^DIQ(27.11,ENROLLN_",",.12) I ENROLSUB'="" S ENROLLP=ENROLLP_ENROLSUB
"RTN","SDWLTR",57,0)
 .S (PREFACN,PREFAC)="" S PREFACN=$$GET1^DIQ(2,DFN_",",27.02,"I") I PREFACN'="" S PREFAC=$$GET1^DIQ(4,PREFACN_",",99)
"RTN","SDWLTR",58,0)
 .S ICNUM="" S ICNUM=$$GET1^DIQ(2,DFN_",",991.01)
"RTN","SDWLTR",59,0)
 .S PCMNUM="" S PCMNUM=$P($$NMPCPR^SCAPMCU2(DFN,DT,1),"^",1) D
"RTN","SDWLTR",60,0)
 ..I PCMNUM<0!(PCMNUM="") S PCMNUM="",PCMMP="^^"
"RTN","SDWLTR",61,0)
 ..I PCMNUM>0 D
"RTN","SDWLTR",62,0)
 ...S (PCMML,PCMMF,PCMMM,NAME(1),PCMMP)="" S PCMM("FILE")=200,PCMM("IENS")=PCMNUM,PCMM("FIELD")=.01
"RTN","SDWLTR",63,0)
 ...S NAME(1)=$$HLNAME^XLFNAME(.PCMM,"","^") S PCMML=$P(NAME(1),"^",1),PCMMF=$P(NAME(1),"^",2),PCMMM=$P(NAME(1),"^",3)
"RTN","SDWLTR",64,0)
 ...S PCMMP=PCMML_"^"_PCMMF_"^"_PCMMM
"RTN","SDWLTR",65,0)
 .S PCMMT="" S PCMMT=$P($$NMPCTM^SCAPMCU2(DFN,DT,1),"^",2)
"RTN","SDWLTR",66,0)
 .S SWIEN="" F  S SWIEN=$O(^SDWL(409.3,"B",DFN,SWIEN)) Q:SWIEN=""  D
"RTN","SDWLTR",67,0)
 ..S (WLREC,WLORDT,WLTYPE,WLINSTN,WLTEAMN,WLTEAM,WLPOSN,WLPOS,WLSPECN,WLSPEC,WLCLN,WLCL,WLPRI,WLREQ)=""
"RTN","SDWLTR",68,0)
 ..S (WLREMOV,WLDNMOV,WLDOD,WLRDFD,WLDDOA,WLESTA,WLCSTA,WLPHY,WLPCMT,WLINST,INSTN,WL,WLC,WLS,NUM)=""
"RTN","SDWLTR",69,0)
 ..S (WLA2,WLD2,WLC2,WLI2,WLSC2,WLCS2,WLS2,WLCL2,WLAS2,WLSCP2,WLPRI2,WLROR2,WLROC2)=""
"RTN","SDWLTR",70,0)
 ..S WLREC=^SDWL(409.3,SWIEN,0)
"RTN","SDWLTR",71,0)
 ..S WLORDT=$P(WLREC,"^",2)
"RTN","SDWLTR",72,0)
 ..S WLTYPE=$P(WLREC,"^",5)
"RTN","SDWLTR",73,0)
 ..S WLINSTN=$P(WLREC,"^",3) I WLINSTN'="" S X=$$GET1^DIQ(4,+WLINSTN_",",99),WLINST=$P(X,U,1),INSTN=$$GET1^DIQ(4,+WLINSTN_",",.01)
"RTN","SDWLTR",74,0)
 ..S WLTEAMN=$P(WLREC,"^",6) I WLTEAMN'="" S WLTEAM=$P($G(^SCTM(404.51,WLTEAMN,0)),"^",1)
"RTN","SDWLTR",75,0)
 ..S WLPOSN=$P(WLREC,"^",7) I WLPOSN'="" S WLPOS=$P($G(^SCTM(404.57,WLPOSN,0)),"^",1)
"RTN","SDWLTR",76,0)
 ..S WLSPECN=$P(WLREC,"^",8) I WLSPECN'="" S WLS=$G(^SDWL(409.31,WLSPECN,0)),WLSPEC=$$GET1^DIQ(40.7,WLS_",",1)
"RTN","SDWLTR",77,0)
 ..S WLCLN=$P(WLREC,"^",9) I WLCLN'="" S WLC=$P(^SDWL(409.32,WLCLN,0),"^",1),WLCL=$P($G(^SC(WLC,0)),"^",1) D
"RTN","SDWLTR",78,0)
 ...I WLC'="" S NUM=$E("000000",$L(WLC)+1,6)_WLC
"RTN","SDWLTR",79,0)
 ..I WLSPECN=""&(WLCLN'="") S WL=$P(^SDWL(409.32,WLCLN,0),"^",1),WLSPECN=$P($G(^SC(WL,0)),"^",7),WLSPEC=$$GET1^DIQ(40.7,WLSPECN_",",1)
"RTN","SDWLTR",80,0)
 ..S WLPRI=$P(WLREC,"^",11)
"RTN","SDWLTR",81,0)
 ..S WLREQ=$P(WLREC,"^",12)
"RTN","SDWLTR",82,0)
 ..S WLREMOV=$P(WLREC,"^",14)
"RTN","SDWLTR",83,0)
 ..S WLDNMOV=$P($G(^SDWL(409.3,SWIEN,"DNR")),"^",1),WLDOD=$P($G(^SDWL(409.3,SWIEN,"DIS")),"^",1),WLRDFD=$P($G(^SDWL(409.3,SWIEN,"DIS")),"^",3)
"RTN","SDWLTR",84,0)
 ..S WLDDOA=$P(WLREC,"^",16),WLCSTA=$P(WLREC,"^",17),WLESTA=$P(WLREC,"^",20)
"RTN","SDWLTR",85,0)
 ..I $P($G(WLREC),"^",23)'=""&($D(^SDWL(409.3,SWIEN,"SDAPT"))) S WLA2=$P(WLREC,"^",23),WLREC2=^SDWL(409.3,SWIEN,"SDAPT") D
"RTN","SDWLTR",86,0)
 ...S WLD2=$P($G(WLREC2),"^",1),WLC2=$$GET1^DIQ(409.3,SWIEN_",",13.2),WLI2=$$GET1^DIQ(409.3,SWIEN_",",13.3),WLSC2=$P($G(WLREC2),"^",4),WLCS2=$$GET1^DIQ(409.3,SWIEN_",",13.5)
"RTN","SDWLTR",87,0)
 ...S WLS2=$P($G(WLREC2),"^",6),WLAS2=$P($G(WLREC2),"^",8),WLCL2=$$GET1^DIQ(409.3,SWIEN_",",13.7),WLROC2=$$GET1^DIQ(409.3,SWIEN_",",30)
"RTN","SDWLTR",88,0)
 ...S WLSCP2=$P($G(^SDWL(409.3,SWIEN,"SC")),"^",1),WLPRI2=$P($G(^SDWL(409.3,SWIEN,"SC")),"^",2),WLROR2=$$GET1^DIQ(409.3,SWIEN_",",29,"I")
"RTN","SDWLTR",89,0)
 ...S WLROC2=$$GET1^DIQ(409.3,SWIEN_",",30)
"RTN","SDWLTR",90,0)
 ..D FLAGS^SDWLTR1(SWIEN,.SDWLREJN,.SDWLSREM,.SDWLINTR,.SDWL120F,.SDWLMULT,.SDWLINTE,.SDWLIDES)  ; sd/446
"RTN","SDWLTR",91,0)
 ..Q:SWIEN=HOLD  D
"RTN","SDWLTR",92,0)
 ...D CHECK
"RTN","SDWLTR",93,0)
 ...I N>39 D MESS^SDWLTR1(.MN) K ^TMP("EWL",$J) S N=0
"RTN","SDWLTR",94,0)
 ...S N=N+1
"RTN","SDWLTR",95,0)
 ...S ^TMP("EWL",$J,SWIEN_N,0)="#"_WLINST_"^"_VER_"^"_INSTN_"^"_WLCL_"^"_NUM_"^"_WLSPEC_"^"_WLTYPE_"^"_NAME_"^"_DFN_"^"_DOB_"^"_SEX_"^"_RACE_"^"_SSN_"^"_SSNP_"^"_STATE_"^"_COUNTY_"^"_ZCODE_"^"_PHONE
"RTN","SDWLTR",96,0)
 ...S ^TMP("EWL",$J,SWIEN_N,0)=^TMP("EWL",$J,SWIEN_N,0)_"^"_MT_"^"_MTT_"^"_SERCON_"^"_HINS_"^"_POS_"^"_PEC_"^"_VETS_"^"_MCAID_"^"_POW_"^"_PH_"^"_ENROLL_"^"_ENROLLP_"^"_PREFAC
"RTN","SDWLTR",97,0)
 ...S ^TMP("EWL",$J,SWIEN_N,0)=^TMP("EWL",$J,SWIEN_N,0)_"^"_ICNUM_"^"_PCMNUM_"^"_PCMMP_"^"_PCMMT_"^"_WLORDT_"^"_WLTEAM_"^"_WLPOS_"^"_WLPRI_"^"_WLREQ_"^"_WLDOD_"^"_WLRDFD_"^"_WLDDOA_"^"_WLCSTA_"^"_WLESTA_"^"_WLREMOV_"^"_WLDNMOV
"RTN","SDWLTR",98,0)
 ...S ^TMP("EWL",$J,SWIEN_N,0)=^TMP("EWL",$J,SWIEN_N,0)_"^"_WLA2_"^"_WLD2_"^"_WLC2_"^"_WLI2_"^"_WLSC2_"^"_WLCS2_"^"_WLS2_"^"_WLCL2_"^"_WLAS2_"^"_WLSCP2_"^"_WLPRI2_"^"_WLROR2
"RTN","SDWLTR",99,0)
 ...S ^TMP("EWL",$J,SWIEN_N,0)=^TMP("EWL",$J,SWIEN_N,0)_"^"_WLROC2_"^"_SDWLREJN_"^"_SDWLSREM_"^"_SDWLINTR_"^"_SDWL120F_"^"_SDWLMULT_"^"_SDWLINTE_"^"_SDWLIDES_"^$"  ; sd/446
"RTN","SDWLTR",100,0)
 ...S HOLD=SWIEN
"RTN","SDWLTR",101,0)
 ...Q
"RTN","SDWLTR",102,0)
 Q
"RTN","SDWLTR",103,0)
NODATA ;No data in ^SDWL(409.3)
"RTN","SDWLTR",104,0)
 S N=0,MN=MN+1
"RTN","SDWLTR",105,0)
 I +$P($G(^SDWL(409.31,0)),"^",4)<1 D SET
"RTN","SDWLTR",106,0)
 I +$P($G(^SDWL(409.32,0)),"^",4)<1 D SET
"RTN","SDWLTR",107,0)
 I +$P($G(^SDWL(409.31,0)),"^",4)>.5 D SET2
"RTN","SDWLTR",108,0)
 I +$P($G(^SDWL(409.32,0)),"^",4)>.5 D SET3
"RTN","SDWLTR",109,0)
MESS2 ;
"RTN","SDWLTR",110,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLTR",111,0)
 S XMSUB="EWL FILE TRANSMISSION"_" MESSAGE # "_MN
"RTN","SDWLTR",112,0)
 S XMY("G.SD WAIT LIST TRANS TO AAC")=""
"RTN","SDWLTR",113,0)
 S XMTEXT="^TMP(""EWL"",$J,"
"RTN","SDWLTR",114,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLTR",115,0)
 D ^XMD
"RTN","SDWLTR",116,0)
 Q
"RTN","SDWLTR",117,0)
SET ;Save data if no pat. on wait list.
"RTN","SDWLTR",118,0)
 S ^TMP("EWL",$J,INST,0)="#"_INST_"^"_1.1_"$"
"RTN","SDWLTR",119,0)
 Q
"RTN","SDWLTR",120,0)
SET2 ;Set nodata global for ser/spec file 409.31
"RTN","SDWLTR",121,0)
 S J=0 F  S J=$O(^TMP("409.31",$J,J)) Q:J=""  D
"RTN","SDWLTR",122,0)
 .S JJ=0 F  S JJ=$O(^TMP("409.31",$J,J,JJ)) Q:JJ=""  D
"RTN","SDWLTR",123,0)
 ..S (INSTN,NAME,CSTOP,CLN)="",CLINIC=0,CSTOP=$$GET1^DIQ(40.7,JJ_",",1),NAME=$$GET1^DIQ(4,J_",",.01),INSTN=$$GET1^DIQ(4,J_",",99) D SAVE
"RTN","SDWLTR",124,0)
 ..Q
"RTN","SDWLTR",125,0)
 Q
"RTN","SDWLTR",126,0)
SET3 ;Set nodata global for clinic file 409.32
"RTN","SDWLTR",127,0)
 S J=0 F  S J=$O(^TMP("409.32",$J,J)) Q:J=""  D
"RTN","SDWLTR",128,0)
 .S JJ=0 F  S JJ=$O(^TMP("409.32",$J,J,JJ)) Q:JJ=""  D
"RTN","SDWLTR",129,0)
 ..S (INSTN,NAME,CSTOP,STOP,CLINIC,CLN)="",CLINIC=$P($G(^SC(JJ,0)),"^",1),CLN=JJ,NAME=$$GET1^DIQ(4,J_",",.01),INSTN=$$GET1^DIQ(4,J_",",99),STOP=$P($G(^SC(JJ,0)),"^",7),CSTOP=$$GET1^DIQ(40.7,STOP_",",1) D SAVE
"RTN","SDWLTR",130,0)
 ..Q
"RTN","SDWLTR",131,0)
 Q
"RTN","SDWLTR",132,0)
SAVE ;Save nodata info.
"RTN","SDWLTR",133,0)
 S U="^",N=N+1,NUM=0 I CLN'="" S NUM=$E("000000",$L(CLN)+1,6)_CLN
"RTN","SDWLTR",134,0)
 S ^TMP("EWL",$J,INST_N,0)="#"_INSTN_U_1.2_"^"_NAME_U_CLINIC_U_NUM_U_CSTOP_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U
"RTN","SDWLTR",135,0)
 S ^TMP("EWL",$J,INST_N,0)=^TMP("EWL",$J,INST_N,0)_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_0_U_"$"
"RTN","SDWLTR",136,0)
 Q
"RTN","SDWLTR",137,0)
CHECK ;Deletes array entry if data for spec/cln/inst.
"RTN","SDWLTR",138,0)
 I WLTYPE=3 D
"RTN","SDWLTR",139,0)
 .I $D(^TMP("409.31",$J,+WLINSTN,+WLS)) K ^TMP("409.31",$J,+WLINSTN,+WLS)
"RTN","SDWLTR",140,0)
 I WLTYPE=4 D
"RTN","SDWLTR",141,0)
 .I $D(^TMP("409.32",$J,+WLINSTN,+WLC)) K ^TMP("409.32",$J,+WLINSTN,+WLC)
"RTN","SDWLTR",142,0)
 Q
"RTN","SDWLTR",143,0)
KILL ;
"RTN","SDWLTR",144,0)
 K ^TMP("EWL",$J),^TMP("409.31",$J),^TMP("409.32",$J)
"RTN","SDWLTR",145,0)
 K DFN,REC,WLNAMEF,WLNAMEL,WLNAMEM,WLNAME,NAME,DOB,SEX,RACE,MT,MTT,SSN,SSNP,STATE,STA,ZCODE,COUNTY,CTY,PHONE,SERCON,HINS,POS,PEC,PECN,PECNN,MCAID,POW,PH,ENROLLN,ENROLL,PREFACN,PREFAC,J,JJ,INST,INSTN,CSTOP,STOP,CLINIC,INST,N,MN
"RTN","SDWLTR",146,0)
 K SWIEN,ICNUM,WLREC,WLORDT,WLTYPE,WLTEAMN,WLTEAM,WLPOSN,WLPOS,WLSPECN,WLSPEC,WLCLN,WLCL,WL,WLC,WLS,WLPRI,WLREQ,WLREMOV,WLDNMOV,WLDOD,WLRDFD,WLESTA,WLDDOA,WLCSTA,HOLD,PCMNUM,PCMMT,PCMMP,VER,WL,VETS,NUM,CLN
"RTN","SDWLTR",147,0)
 K ENROLL,ENROLLP,ENROLSUB,WLNAMES,WLD2,WLC2,WLI2,WLSC2,WLCS2,WLS2,WLCL2,WLAS2,WLSCP2,WLPRI2,WLA2,WLROR2,WLROC2,WLREC2,PCMM,PCMMF,PCMML,PCMMM,POSN,WLINST,WLINSTN,WLPCMT,WLPHY,X,VADM,VAPA
"RTN","SDWLTR",148,0)
 Q
"RTN","SDWLTR1")
0^44^B1740359^n/a
"RTN","SDWLTR1",1,0)
SDWLTR1 ;IOFO BAY PINES/DMR - WAIT LIST TRANSMISSION TO ACC - overflow for sacc 10k ; 29 Aug 2002  2:54 PM  ; Compiled April 13, 2007 10:44:43
"RTN","SDWLTR1",2,0)
 ;;5.3;scheduling;**446**;AUG 13 1993;Build 77
"RTN","SDWLTR1",3,0)
 Q
"RTN","SDWLTR1",4,0)
FLAGS(SWIEN,SDWLREJN,SDWLSREM,SDWLINTR,SDWL120F,SDWLMULT,SDWLINTE,SDWLIDES) ;
"RTN","SDWLTR1",5,0)
 N SDWLARR
"RTN","SDWLTR1",6,0)
 D GETS^DIQ(409.3,SWIEN,"32;33;34;36;38","I","SDWLARR")
"RTN","SDWLTR1",7,0)
 S SDWLREJN=SDWLARR(409.3,SWIEN_",",32,"I")
"RTN","SDWLTR1",8,0)
 S SDWLSREM=SDWLARR(409.3,SWIEN_",",33,"I") S:SDWLSREM="Y" SDWLSREM=1
"RTN","SDWLTR1",9,0)
 S SDWLINTR=SDWLARR(409.3,SWIEN_",",34,"I")
"RTN","SDWLTR1",10,0)
 S SDWL120F=SDWLARR(409.3,SWIEN_",",36,"I")
"RTN","SDWLTR1",11,0)
 S SDWLMULT=SDWLARR(409.3,SWIEN_",",38,"I") S:SDWLMULT=0 SDWLMULT=""
"RTN","SDWLTR1",12,0)
 S (SDWLINTE,SDWLIDES)=""
"RTN","SDWLTR1",13,0)
 S SDWLINTE=$$GETTRN^SDWLIFT1(SWIEN,,.SDWLIDES) S:SDWLINTE=0 SDWLINTE=""
"RTN","SDWLTR1",14,0)
 Q
"RTN","SDWLTR1",15,0)
 ;
"RTN","SDWLTR1",16,0)
MESS(MN) ;Send msg
"RTN","SDWLTR1",17,0)
 S MN=MN+1
"RTN","SDWLTR1",18,0)
 N XMSUB,XMY,XMTEXT,XMDUZ
"RTN","SDWLTR1",19,0)
 S XMSUB="EWL FILE TRANSMISSION"_" MESSAGE # "_MN
"RTN","SDWLTR1",20,0)
 S XMY("G.SD WAIT LIST TRANS TO AAC")=""
"RTN","SDWLTR1",21,0)
 S XMTEXT="^TMP(""EWL"",$J,"
"RTN","SDWLTR1",22,0)
 S XMDUZ="POSTMASTER"
"RTN","SDWLTR1",23,0)
 D ^XMD K ^TMP("EWL",$J)
"RTN","SDWLTR1",24,0)
 Q
"SEC","^DIC",409.35,409.35,0,"AUDIT")
@
"SEC","^DIC",409.35,409.35,0,"DD")
@
"SEC","^DIC",409.35,409.35,0,"DEL")
@
"SEC","^DIC",409.35,409.35,0,"LAYGO")
@
"SEC","^DIC",409.35,409.35,0,"RD")
@
"SEC","^DIC",409.35,409.35,0,"WR")
@
"VER")
8.0^22.0
"^DD",409.3,409.3,21,0)
DISPOSITION^S^D:DEATH;NC:REMOVED/NON-VA CARE;SA:REMOVED/SCHEDULED-ASSIGNED;CC:REMOVED/VA CONTRACT CARE;NN:REMOVED/NO LONGER NECESSARY;ER:ENTERED IN ERROR;TR:TRANSFERRED;CL:CHANGED CLINIC;^DIS;3^Q
"^DD",409.3,409.3,21,3)
Select a reason for removing the patient the wait list.
"^DD",409.3,409.3,21,21,0)
^.001^1^1^3060905^^^^
"^DD",409.3,409.3,21,21,1,0)
Reason patient has been dispositioned from Wait List(Sch/PCMM)
"^DD",409.3,409.3,21,"DT")
3060511
"^DD",409.3,409.3,32,0)
REJECTION FLAG^S^1:REJECTED;^FLAGS;2^Q
"^DD",409.3,409.3,32,"DT")
3060513
"^DD",409.3,409.3,33,0)
SCHEDULING REMINDER FLAG^S^Y:TICKLER FLAG;^FLAGS;3^Q
"^DD",409.3,409.3,33,"DT")
3060605
"^DD",409.3,409.3,34,0)
INTRA TRANSFER FLAG^S^1:INTRA TRANSFER FLAG;^FLAGS;4^Q
"^DD",409.3,409.3,34,"DT")
3060427
"^DD",409.3,409.3,36,0)
120 DAYS FIELD^S^1:NO APPOINTMENT;2:WITH APPOINTMENT;^FLAGS;6^Q
"^DD",409.3,409.3,36,"DT")
3060427
"^DD",409.3,409.3,37,0)
CHANGED CLINIC PARENT POINTER^P409.3'^SDWL(409.3,^0;22^Q
"^DD",409.3,409.3,37,21,0)
^.001^3^3^3070103^^
"^DD",409.3,409.3,37,21,1,0)
When an EWL entry is closed with a disposition code of CL: CLINIC CHANGE,
"^DD",409.3,409.3,37,21,2,0)
the process involves the creation of a new EWL entry with details copied
"^DD",409.3,409.3,37,21,3,0)
from the parent. This is a pointer back to that parent entry.
"^DD",409.3,409.3,37,"DT")
3060525
"^DD",409.3,409.3,38,0)
MULTI TEAM FLAG^S^1:MULTI TEAM LOCATION;0:SINGL TEAM LOCATION;^FLAGS;5^Q
"^DD",409.3,409.3,38,"DT")
3060524
"^DD",409.3,409.3,39,0)
120 DAY APPT CREATED^S^1:APPT CREATED;^FLAGS;1^Q
"^DD",409.3,409.3,39,"DT")
3060529
"^DD",409.35,409.35,0)
FIELD^^7^8
"^DD",409.35,409.35,0,"DT")
3070123
"^DD",409.35,409.35,0,"IX","B",409.35,.01)

"^DD",409.35,409.35,0,"NM","SDWL TRANSFER REQUEST")

"^DD",409.35,409.35,0,"VRPK")
SD
"^DD",409.35,409.35,.01,0)
WAIT LIST ENTRY^RP409.3^SDWL(409.3,^0;1^Q
"^DD",409.35,409.35,.01,1,0)
^.1
"^DD",409.35,409.35,.01,1,1,0)
409.35^B
"^DD",409.35,409.35,.01,1,1,1)
S ^SDWL(409.35,"B",$E(X,1,30),DA)=""
"^DD",409.35,409.35,.01,1,1,2)
K ^SDWL(409.35,"B",$E(X,1,30),DA)
"^DD",409.35,409.35,.01,3)

"^DD",409.35,409.35,.01,21,0)
^.001^1^1^3070103^^
"^DD",409.35,409.35,.01,21,1,0)
The patient that is to be on the Sch/PCMM Wait List.
"^DD",409.35,409.35,.01,"DT")
3050506
"^DD",409.35,409.35,1,0)
STATION NUMBER^RNJ5,0^^0;2^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.35,409.35,1,3)
Type a Number between 0 and 99999, 0 Decimal Digits
"^DD",409.35,409.35,1,21,0)
^^2^2^3050614^
"^DD",409.35,409.35,1,21,1,0)
The Station Number of the Institution the request for transfer is to be
"^DD",409.35,409.35,1,21,2,0)
made to.
"^DD",409.35,409.35,1,"DT")
3050614
"^DD",409.35,409.35,2,0)
TRANSMISSION DATE/TIME^RD^^0;3^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",409.35,409.35,2,21,0)
^^1^1^3050506^
"^DD",409.35,409.35,2,21,1,0)
Exact date and time (including seconds) of the moment of transmission.
"^DD",409.35,409.35,2,"DT")
3050506
"^DD",409.35,409.35,3,0)
STATUS^RS^P:PENDING XMIT;T:TRANSMITTED;R:RECEIVED;X:REFUSED;A:RESOLVED;C:CANCELLED;E:ON EWL;^0;4^Q
"^DD",409.35,409.35,3,21,0)
^.001^12^12^3070206^^^
"^DD",409.35,409.35,3,21,1,0)
PENDING XMIT : The details have been entered and are about to be  
"^DD",409.35,409.35,3,21,2,0)
               transmitted to their destination
"^DD",409.35,409.35,3,21,3,0)
TRANSMITTED  : The details have been transmitted to their destination
"^DD",409.35,409.35,3,21,4,0)
RECEIVED     : The details have arrived at the destination facility and 
"^DD",409.35,409.35,3,21,5,0)
               are held on a pending file (#409.36)
"^DD",409.35,409.35,3,21,6,0)
REFUSED      : The details were not accepted by the users at the 
"^DD",409.35,409.35,3,21,7,0)
               desination facility
"^DD",409.35,409.35,3,21,8,0)
RESOLVED     : The details were accepted by the users at the desination 
"^DD",409.35,409.35,3,21,9,0)
               facility
"^DD",409.35,409.35,3,21,10,0)
CANCELLED    : A cancellation request has been made. Awaiting 
"^DD",409.35,409.35,3,21,11,0)
               acknowlegement from the receiving facility.
"^DD",409.35,409.35,3,21,12,0)
ON EWL         Patient has been placed on the EWL at the destination
"^DD",409.35,409.35,3,"DT")
3070123
"^DD",409.35,409.35,4,0)
REQUESTOR^RP200'^VA(200,^0;5^Q
"^DD",409.35,409.35,4,21,0)
^.001^1^1^3050506^^
"^DD",409.35,409.35,4,21,1,0)
The person making the request for transfer.
"^DD",409.35,409.35,4,"DT")
3050506
"^DD",409.35,409.35,5,0)
COMMENT^409.355^^1;0
"^DD",409.35,409.35,6,0)
RECEIVING FACILITY TRANSFER ID^F^^0;6^K:$L(X)>10!($L(X)<1) X
"^DD",409.35,409.35,6,3)
Answer must be 1-10 characters in length.
"^DD",409.35,409.35,6,"DT")
3050506
"^DD",409.35,409.35,7,0)
ACCEPTING PERSON^F^^0;7^K:$L(X)>35!($L(X)<3) X
"^DD",409.35,409.35,7,3)
Answer must be 3-35 characters in length.
"^DD",409.35,409.35,7,21,0)
^^3^3^3050613^
"^DD",409.35,409.35,7,21,1,0)
This is the name of the person who accepted the transfer at the 
"^DD",409.35,409.35,7,21,2,0)
destination facility. It is a free text name from the NEW PERSON file 
"^DD",409.35,409.35,7,21,3,0)
(#200).
"^DD",409.35,409.35,7,"DT")
3050613
"^DD",409.35,409.355,0)
COMMENT SUB-FIELD^^.01^1
"^DD",409.35,409.355,0,"DT")
3050506
"^DD",409.35,409.355,0,"NM","COMMENT")

"^DD",409.35,409.355,0,"UP")
409.35
"^DD",409.35,409.355,.01,0)
COMMENT^W^^0;1^Q
"^DD",409.35,409.355,.01,21,0)
^.001^2^2^3050506^^
"^DD",409.35,409.355,.01,21,1,0)
This is a word processing field to allow free text comments to accompany
"^DD",409.35,409.355,.01,21,2,0)
the transmission to better describe the treatment that was being awaited.
"^DD",409.35,409.355,.01,"DT")
3050506
"^DD",409.36,409.36,1,0)
STATUS^S^P:PENDING;E:EWL;C:CLOSED;R:REMOVED;T:TRANSFERRED;^2;4^Q
"^DD",409.36,409.36,1,21,0)
^.001^9^9^3070123^^^^
"^DD",409.36,409.36,1,21,1,0)
The current stage in the transfer process. Possible values are
"^DD",409.36,409.36,1,21,2,0)
P - PENDING: where a transfer request has been received but no action has 
"^DD",409.36,409.36,1,21,3,0)
yet been taken
"^DD",409.36,409.36,1,21,4,0)
E - EWL: the transfer patient has been place on the Electronic Wait List 
"^DD",409.36,409.36,1,21,5,0)
C - CLOSED: the transfer has been completed 
"^DD",409.36,409.36,1,21,6,0)
T - TRANSFERRED: the transfer patient has been the subject of request to another facility
"^DD",409.36,409.36,1,21,7,0)
R - REMOVED: the transfer request has been cancelled
"^DD",409.36,409.36,1,21,8,0)
T - TRANSFERRED: the transfer patient has been the subject of request to
"^DD",409.36,409.36,1,21,9,0)
another facility
"^DD",409.36,409.36,1,"DT")
3060404
"^DD",409.36,409.36,2,0)
FACILITY TRANSFERRED TO^NJ5,0^^2;6^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.36,409.36,2,3)
Type a Number between 0 and 99999, 0 Decimal Digits
"^DD",409.36,409.36,2,21,0)
^^2^2^3060905^
"^DD",409.36,409.36,2,21,1,0)
The stop code of the facility if the patient for this transfer has become
"^DD",409.36,409.36,2,21,2,0)
the subject of a further tranfer elsewhere
"^DD",409.36,409.36,2,"DT")
3060404
"^DD",409.36,409.36,409.3,0)
SD WAIT LIST ENTRY^P409.3'^SDWL(409.3,^2;5^Q
"^DD",409.36,409.36,409.3,1,0)
^.1
"^DD",409.36,409.36,409.3,1,1,0)
409.36^C
"^DD",409.36,409.36,409.3,1,1,1)
S ^SDWL(409.36,"C",$E(X,1,30),DA)=""
"^DD",409.36,409.36,409.3,1,1,2)
K ^SDWL(409.36,"C",$E(X,1,30),DA)
"^DD",409.36,409.36,409.3,1,1,"DT")
3060315
"^DD",409.36,409.36,409.3,21,0)
^.001^1^1^3070103^^^^
"^DD",409.36,409.36,409.3,21,1,0)
Pointer to the associated EWL entry
"^DD",409.36,409.36,409.3,"DT")
3060315
"^DIC",409.35,409.35,0)
SDWL TRANSFER REQUEST^409.35
"^DIC",409.35,409.35,0,"GL")
^SDWL(409.35,
"^DIC",409.35,"B","SDWL TRANSFER REQUEST",409.35)

**END**
**END**
