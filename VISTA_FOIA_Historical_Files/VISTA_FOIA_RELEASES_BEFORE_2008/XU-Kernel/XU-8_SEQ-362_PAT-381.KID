Released XU*8*381 SEQ #362
Extracted from mail message
**KIDS**:XU*8.0*381^

**INSTALL NAME**
XU*8.0*381
"BLD",937,0)
XU*8.0*381^KERNEL^0^3060726^y
"BLD",937,1,0)
^^2^2^3060726^
"BLD",937,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"BLD",937,1,2,0)
XU*8*381     Update Task Display with message data.
"BLD",937,4,0)
^9.64PA^^
"BLD",937,6.3)
2
"BLD",937,"INID")
^y
"BLD",937,"INIT")
POST^XU8P381
"BLD",937,"KRN",0)
^9.67PA^8989.52^19
"BLD",937,"KRN",.4,0)
.4
"BLD",937,"KRN",.401,0)
.401
"BLD",937,"KRN",.402,0)
.402
"BLD",937,"KRN",.403,0)
.403
"BLD",937,"KRN",.5,0)
.5
"BLD",937,"KRN",.84,0)
.84
"BLD",937,"KRN",3.6,0)
3.6
"BLD",937,"KRN",3.8,0)
3.8
"BLD",937,"KRN",9.2,0)
9.2
"BLD",937,"KRN",9.8,0)
9.8
"BLD",937,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",937,"KRN",9.8,"NM",1,0)
XUTMTP^^0^B21069855
"BLD",937,"KRN",9.8,"NM",2,0)
XUTMTP1^^0^B7220944
"BLD",937,"KRN",9.8,"NM",3,0)
ZTLOAD^^0^B3834146
"BLD",937,"KRN",9.8,"NM","B","XUTMTP",1)

"BLD",937,"KRN",9.8,"NM","B","XUTMTP1",2)

"BLD",937,"KRN",9.8,"NM","B","ZTLOAD",3)

"BLD",937,"KRN",19,0)
19
"BLD",937,"KRN",19.1,0)
19.1
"BLD",937,"KRN",101,0)
101
"BLD",937,"KRN",409.61,0)
409.61
"BLD",937,"KRN",771,0)
771
"BLD",937,"KRN",870,0)
870
"BLD",937,"KRN",8989.51,0)
8989.51
"BLD",937,"KRN",8989.52,0)
8989.52
"BLD",937,"KRN",8994,0)
8994
"BLD",937,"KRN","B",.4,.4)

"BLD",937,"KRN","B",.401,.401)

"BLD",937,"KRN","B",.402,.402)

"BLD",937,"KRN","B",.403,.403)

"BLD",937,"KRN","B",.5,.5)

"BLD",937,"KRN","B",.84,.84)

"BLD",937,"KRN","B",3.6,3.6)

"BLD",937,"KRN","B",3.8,3.8)

"BLD",937,"KRN","B",9.2,9.2)

"BLD",937,"KRN","B",9.8,9.8)

"BLD",937,"KRN","B",19,19)

"BLD",937,"KRN","B",19.1,19.1)

"BLD",937,"KRN","B",101,101)

"BLD",937,"KRN","B",409.61,409.61)

"BLD",937,"KRN","B",771,771)

"BLD",937,"KRN","B",870,870)

"BLD",937,"KRN","B",8989.51,8989.51)

"BLD",937,"KRN","B",8989.52,8989.52)

"BLD",937,"KRN","B",8994,8994)

"BLD",937,"QUES",0)
^9.62^^
"BLD",937,"REQB",0)
^9.611^2^2
"BLD",937,"REQB",1,0)
XU*8.0*225^2
"BLD",937,"REQB",2,0)
XU*8.0*242^2
"BLD",937,"REQB","B","XU*8.0*225",1)

"BLD",937,"REQB","B","XU*8.0*242",2)

"INIT")
POST^XU8P381
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3051215^2970507^.5
"PKG",3,22,1,"PAH",1,0)
381^3060726
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3060726
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"PKG",3,22,1,"PAH",1,1,2,0)
XU*8*381     Update Task Display with message data.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","XU8P381")
0^^B127549^n/a
"RTN","XU8P381",1,0)
XU8P381 ;ISF/RWF - Clean up DD 9.8
"RTN","XU8P381",2,0)
 ;;8.0;KERNEL;**381**;Jul 10, 1995;Build 2
"RTN","XU8P381",3,0)
 Q
"RTN","XU8P381",4,0)
 ;
"RTN","XU8P381",5,0)
POST ;
"RTN","XU8P381",6,0)
 N DIU
"RTN","XU8P381",7,0)
 I $G(^DD(9.8,3,0))'["SUBROUTINE^9.82" Q
"RTN","XU8P381",8,0)
 S DIU=9.82,DIU(0)="SD" D EN^DIU2
"RTN","XU8P381",9,0)
 Q
"RTN","XUTMTP")
0^1^B21069855^B20619160
"RTN","XUTMTP",1,0)
XUTMTP ;SEA/RDS - TaskMan: ToolKit, Print, Part 1 ;04/18/2006  16:19
"RTN","XUTMTP",2,0)
 ;;8.0;KERNEL;**20,86,169,242,381**;Jul 10, 1995;Build 2
"RTN","XUTMTP",3,0)
 ;
"RTN","XUTMTP",4,0)
EN(XUTSK,XUINX,FLAG) ;Print one task
"RTN","XUTMTP",5,0)
 I $D(XUTMUCI)_$D(ZTNAME)_$D(ZTFLAG)'="111" D ENV^XUTMUTL
"RTN","XUTMTP",6,0)
TASK ;Lookup Task File Data
"RTN","XUTMTP",7,0)
 N %,%D,%H,%M,%Y,%ZTT,X,Y,ZT,ZT1,ZT2,ZT3,ZTC,ZTD,ZTF,ZTI,ZTO
"RTN","XUTMTP",8,0)
 S FLAG=+$G(FLAG),ZTC=0
"RTN","XUTMTP",9,0)
 L +^%ZTSK(XUTSK):2 I '$T W !,"Task: ",XUTSK," entry locked." Q
"RTN","XUTMTP",10,0)
 ;Get current data
"RTN","XUTMTP",11,0)
 S XUTSK(0)=$G(^%ZTSK(XUTSK,0)),XUTSK(.03)=$G(^(.03)),XUTSK(.1)=$G(^(.1)),XUTSK(.2)=$G(^(.2)),XUTSK(.11)=$G(^(.11)),XUTSK(.26)=$G(^(.26))
"RTN","XUTMTP",12,0)
 I '$D(^%ZTSK(XUTSK)) D  I 'XUTSK L -^%ZTSK(XUTSK) K XUTMT Q
"RTN","XUTMTP",13,0)
 . S X=$G(^%ZTSCH("TASK",XUTSK))
"RTN","XUTMTP",14,0)
 . I X="" W !,XUTSK,":  No information available." S XUTSK=0 Q
"RTN","XUTMTP",15,0)
 . S XUTSK(0)=$P(X,U,1,2)_"^^"_$P(X,U,7,8)_U_$P(X,U,5)_"^^"_$P(X,U,3,4)_U_$P(X,U,9),XUTSK(.1)="5^"_$P(X,U,12),XUTSK(.2)=$P(X,U,6),XUTSK("TASK")=X
"RTN","XUTMTP",16,0)
 . S XUTSK(.03)="Task in running list, full information missing."
"RTN","XUTMTP",17,0)
 . Q
"RTN","XUTMTP",18,0)
 ;
"RTN","XUTMTP",19,0)
SCHED ;Lookup Task In Schedule File
"RTN","XUTMTP",20,0)
 S ZT1=0 F ZT=0:0 S ZT1=$O(^%ZTSCH(ZT1)) Q:'ZT1  I $D(^%ZTSCH(ZT1,XUTSK))#2 S XUTSK("A",ZT1,XUTSK)="",ZT2=^(XUTSK) I ZT2]"" S $P(XUTSK(.2),U)=ZT2
"RTN","XUTMTP",21,0)
 I XUTSK(.26)="" S ZT1="" F  S ZT1=$O(^%ZTSCH("IO",ZT1)),ZT2="" Q:ZT1=""  F  S ZT2=$O(^%ZTSCH("IO",ZT1,ZT2)) Q:ZT2=""  S:$D(^(ZT2,XUTSK))#2 XUTSK("IO",ZT1,ZT2,XUTSK)=""
"RTN","XUTMTP",22,0)
 S ZT1="" F  S ZT1=$O(^%ZTSCH("JOB",ZT1)) Q:ZT1=""  S:$D(^(ZT1,XUTSK))#2 XUTSK("JOB",ZT1,XUTSK)=""
"RTN","XUTMTP",23,0)
 S ZT1="" F  S ZT1=$O(^%ZTSCH("LINK",ZT1)),ZT2="" Q:ZT1=""  F  S ZT2=$O(^%ZTSCH("LINK",ZT1,ZT2)) Q:ZT2=""  S:$D(^(ZT2,XUTSK))#2 XUTSK("LINK",ZT1,ZT2,XUTSK)=""
"RTN","XUTMTP",24,0)
 S:$D(^%ZTSCH("TASK",XUTSK))#2 XUTSK("TASK")=^(XUTSK) S:$D(^%ZTSCH("TASK",XUTSK,1)) XUTSK("TASK1")=^(1)
"RTN","XUTMTP",25,0)
 L -^%ZTSK(XUTSK)
"RTN","XUTMTP",26,0)
 ;
"RTN","XUTMTP",27,0)
SCREEN ;Apply Screen, If Supplied
"RTN","XUTMTP",28,0)
 I $D(XUTMT("S"))#2 X XUTMT("S") E  K XUTMT Q
"RTN","XUTMTP",29,0)
 ;
"RTN","XUTMTP",30,0)
 S ZT1=$G(^%ZTSK(XUTSK,.3,"XQSCH")) I ZT1 D  ;Is it a scheduled task
"RTN","XUTMTP",31,0)
 . S ZT2=+$G(^DIC(19.2,ZT1,1.1)) Q:'ZT2
"RTN","XUTMTP",32,0)
 . S ZT2=$P($G(^VA(200,ZT2,0),"Unk"),"^") D ADD("Run under user: "_ZT2)
"RTN","XUTMTP",33,0)
 . Q
"RTN","XUTMTP",34,0)
STATUS ;Determine Status According To Lookup Data
"RTN","XUTMTP",35,0)
 S XUTSK("CS")="",XUTSK("UPDATE")=$$TIME($P(XUTSK(.1),U,2))
"RTN","XUTMTP",36,0)
 I $D(XUTSK("A")) S ZT1="" F ZT=0:0 S ZT1=$O(XUTSK("A",ZT1)) Q:ZT1=""  D ADD("Scheduled for "_$$TIME(ZT1),1)
"RTN","XUTMTP",37,0)
 I XUTSK(.26)]"" D ADD("Waiting for hunt group"_$S(XUTSK(.26)[",":"s ",1:" ")_XUTSK(.26),"A")
"RTN","XUTMTP",38,0)
 I XUTSK(.26)="",$D(XUTSK("IO")) S ZT1="" F ZT=0:0 S ZT1=$O(XUTSK("IO",ZT1)) Q:ZT1=""  D ADD("Waiting for device "_ZT1,"A"),IOQ:FLAG
"RTN","XUTMTP",39,0)
 I $D(XUTSK("JOB")) D ADD("Waiting for a partition.",3),JL:FLAG
"RTN","XUTMTP",40,0)
 I $D(XUTSK("LINK")) S ZT1="" F ZT=0:0 S ZT1=$O(XUTSK("LINK",ZT1)) Q:ZT1=""  D ADD("Waiting for the link to "_ZT1_" to be restored.","G"),LL:FLAG
"RTN","XUTMTP",41,0)
 I $D(XUTSK("TASK")) D ADD("Started running "_XUTSK("UPDATE")_".",5)
"RTN","XUTMTP",42,0)
 I $E(XUTSK(.1),1)]"",$E(XUTSK(.1),1)'=XUTSK("CS") D STATUS^XUTMTP0 S ZTC=ZTC+1
"RTN","XUTMTP",43,0)
 ;
"RTN","XUTMTP",44,0)
PRINT ;Go To XUTMTP1 To Print Task And Quit
"RTN","XUTMTP",45,0)
 G ^XUTMTP1
"RTN","XUTMTP",46,0)
 ;
"RTN","XUTMTP",47,0)
TIME(%ZTT) ;Convert $H Time To A Readable Time
"RTN","XUTMTP",48,0)
 Q:%ZTT="" "??"
"RTN","XUTMTP",49,0)
 N %,%XT,%XD,%H,Y I %ZTT>99999 S %XD=(%ZTT\86400),%XT=%ZTT#86400
"RTN","XUTMTP",50,0)
 E  S %XD=+%ZTT,%XT=$P(%ZTT,",",2)
"RTN","XUTMTP",51,0)
 S %H=$H,%=%XD-%H I %*%<2 S Y=$S(%<0:"Yesterday",'%:"Today",%>0:"Tomorrow",1:"")
"RTN","XUTMTP",52,0)
 I %*%>1 S Y=$$HTE^XLFDT(%XD_","_%XT,"5D") ;D 7^%DTC S Y=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","XUTMTP",53,0)
 S Y=Y_" at "_(%XT\3600)_":"_$E(%XT#3600\60+100,2,3)
"RTN","XUTMTP",54,0)
 Q Y
"RTN","XUTMTP",55,0)
 ;
"RTN","XUTMTP",56,0)
ADD(MSG,FLG) ;Add msg to list
"RTN","XUTMTP",57,0)
 S XUTSK(.15,ZTC)=MSG,ZTC=ZTC+1 S:$D(FLG) XUTSK("CS")=FLG
"RTN","XUTMTP",58,0)
 Q
"RTN","XUTMTP",59,0)
A ;STATUS--determine position of late task in Schedule List
"RTN","XUTMTP",60,0)
 N ZTP
"RTN","XUTMTP",61,0)
 Q
"RTN","XUTMTP",62,0)
 ;
"RTN","XUTMTP",63,0)
IOQ ;STATUS--determine position in Device Waiting List
"RTN","XUTMTP",64,0)
 N ZTP
"RTN","XUTMTP",65,0)
 S ZTP=0,ZT2="" F ZT=0:0 S ZT2=$O(^%ZTSCH("IO",ZT1,ZT2)),ZT3="" Q:ZT2=""  F ZT=0:0 S ZT3=$O(^%ZTSCH("IO",ZT1,ZT2,ZT3)) Q:ZT3=""  S ZTP=ZTP+1 I ZT3=ZTSK G I1
"RTN","XUTMTP",66,0)
I1 D ADD("     "_(ZTP-1)_" task"_$S(ZTP=2:"",1:"s")_" ahead of this one.")
"RTN","XUTMTP",67,0)
 Q
"RTN","XUTMTP",68,0)
 ;
"RTN","XUTMTP",69,0)
JL ;STATUS--determine position in Job List
"RTN","XUTMTP",70,0)
 N ZTP
"RTN","XUTMTP",71,0)
 S ZTP=0,ZT1=""
"RTN","XUTMTP",72,0)
 F  S ZT1=$O(^%ZTSCH("JOB",ZT1)),ZT2="" Q:ZT1=""  F  S ZT2=$O(^%ZTSCH("JOB",ZT1,ZT2)) Q:ZT2=""  S ZTP=ZTP+1 I ZT2=ZTSK G J1
"RTN","XUTMTP",73,0)
J1 D ADD("     "_(ZTP-1)_" task"_$S(ZTP=2:"",1:"s")_" ahead of this one.")
"RTN","XUTMTP",74,0)
 Q
"RTN","XUTMTP",75,0)
 ;
"RTN","XUTMTP",76,0)
LL ;STATUS--determine position in Link Waiting List
"RTN","XUTMTP",77,0)
 N ZTP
"RTN","XUTMTP",78,0)
 S ZTP=0,ZT2=""
"RTN","XUTMTP",79,0)
 F  S ZT2=$O(^%ZTSCH("LINK",ZT1,ZT2)),ZT3="" Q:ZT2=""  F  S ZT3=$O(^%ZTSCH("LINK",ZT1,ZT2,ZT3)) Q:ZT3=""  S ZTP=ZTP+1 I ZT3=ZTSK G L1
"RTN","XUTMTP",80,0)
L1 D ADD("    "_(ZTP-1)_" task"_$S(ZTP=2:"",1:"s")_" ahead of this one.")
"RTN","XUTMTP",81,0)
 Q
"RTN","XUTMTP",82,0)
 ;
"RTN","XUTMTP",83,0)
TASKUSER(TSK) ;Return the user name for a task
"RTN","XUTMTP",84,0)
 N S1,S2,S3
"RTN","XUTMTP",85,0)
 S S1=$G(^%ZTSK(+TSK,0)) I '$L(S1) Q "Unknown"
"RTN","XUTMTP",86,0)
 S S1=+$P(S1,U,3)
"RTN","XUTMTP",87,0)
 S S2=$G(^VA(200,S1,0)) I '$L(S2) Q "Unknown"
"RTN","XUTMTP",88,0)
 S S3=$$ACTIVE^XUSER(S1)
"RTN","XUTMTP",89,0)
 Q $S(S3:$P(S2,U),1:$E($P(S2,U),1,25)_" (T)")
"RTN","XUTMTP1")
0^2^B7220944^B6799802
"RTN","XUTMTP1",1,0)
XUTMTP1 ;SEA/RDS - TaskMan: ToolKit, Print, Part 3 ;07/26/2006
"RTN","XUTMTP1",2,0)
 ;;8.0;KERNEL;**20,225,381**;Jul 10, 1995;Build 2
"RTN","XUTMTP1",3,0)
 ;
"RTN","XUTMTP1",4,0)
PRINT ;Print Task
"RTN","XUTMTP1",5,0)
 N %ZTT,ZTC,ZTD,ZTI,ZTO,ZTTAB S XUINX=+$G(XUINX)
"RTN","XUTMTP1",6,0)
 S ZTTAB=$S(XUINX:$L(XUINX),1:$L(XUTSK))
"RTN","XUTMTP1",7,0)
 I XUINX W !,XUINX,": (Task #",XUTSK,") "
"RTN","XUTMTP1",8,0)
 E  W !,XUTSK,": "
"RTN","XUTMTP1",9,0)
 S ZTD=$P(XUTSK(0),U,1,2)
"RTN","XUTMTP1",10,0)
 I ZTD="ZTSK^XQ1",$P(XUTSK(0),U,11)_","_$P(XUTSK(0),U,12)=XUTMUCI S ZTO=$S($D(^%ZTSK(XUTSK,.3,"XQY"))#2:+^("XQY"),1:+$P(XUTSK(0),U,8)) I ZTO,$D(^DIC(19,ZTO,0))#2 S ZTD=$P(^(0),U)_" - "_$P(^(0),U,2)
"RTN","XUTMTP1",11,0)
 S:'$T ZTD=$S(ZTD]"":ZTD_", ",1:"")_$E(XUTSK(.03),1,75) D W($S(ZTD]"":ZTD,1:"Task data missing")_$E(".",($E(ZTD,$L(ZTD))'=".")))
"RTN","XUTMTP1",12,0)
 S ZTD=$S($P($P(XUTSK(.2),U),";")]"":"  Device "_$P($P(XUTSK(.2),U),";")_".",XUTSK(0)]"":"  No device.",1:"  Device unknown.") D W(ZTD)
"RTN","XUTMTP1",13,0)
 S ZTD=$P(XUTSK(0),U,4) I ZTD="" S ZTD=$P(XUTSK(0),U,11) I ZTD]"" S ZTD=ZTD_","_$P(XUTSK(0),U,12)
"RTN","XUTMTP1",14,0)
 I ZTD]"",$P(XUTSK(0),U,14)]"" S $P(ZTD,",",2)=$P(XUTSK(0),U,14)
"RTN","XUTMTP1",15,0)
 S ZTD="  "_$S(ZTD]"":ZTD,1:"Account unknown")_"." D W(ZTD)
"RTN","XUTMTP1",16,0)
 S ZTD=$P(XUTSK(0),U,5) I ZTD]"" D W("  From "_$$TIME^XUTMTP(ZTD)_",") ; D W(ZTD)
"RTN","XUTMTP1",17,0)
 I ZTD]"" S ZTD=$S($P(XUTSK(0),U,10)=ZTNAME:"  By you.",$P(XUTSK(0),U,10)]"":"  By "_$P(XUTSK(0),U,10)_".",$P(XUTSK(0),U,3)]"":"  By user # "_$P(XUTSK(0),U,3)_".",1:"  By an unspecified user.") D W(ZTD)
"RTN","XUTMTP1",18,0)
 S ZTC="" F ZTI=0:0 S ZTC=$O(XUTSK(.15,ZTC)) Q:ZTC=""  S ZTD="  "_XUTSK(.15,ZTC) D W(ZTD)
"RTN","XUTMTP1",19,0)
 ; The information about the running task is stored in
"RTN","XUTMTP1",20,0)
 ; ^%ZTSCH("TASK",task number) and the 10th piece is equal to the
"RTN","XUTMTP1",21,0)
 ; job number.
"RTN","XUTMTP1",22,0)
 ; XUTSK("TASK") is equal ^%ZTSCH("TASK",task number)
"RTN","XUTMTP1",23,0)
 I $D(XUTSK("TASK")),$P(XUTSK("TASK"),U,10)]"" S ZTD=$P(XUTSK("TASK"),U,10),ZTD="  Job #: "_ZTD_$S(ZTD>4096:" ["_$$CNV^XLFUTL(ZTD,16)_"]",1:"") D W(ZTD)
"RTN","XUTMTP1",24,0)
 I $L(XUTSK(.11)) D W("  Job Msg: "_XUTSK(.11))
"RTN","XUTMTP1",25,0)
 I $D(XUTSK("TASK1")) D W("  Updated: "_$$TIME^XUTMTP(XUTSK("TASK1")))
"RTN","XUTMTP1",26,0)
 K XUTMT Q
"RTN","XUTMTP1",27,0)
 ;
"RTN","XUTMTP1",28,0)
W(A) ;Write value
"RTN","XUTMTP1",29,0)
 W:$X+$L(A)>80 !,?ZTTAB W A
"RTN","XUTMTP1",30,0)
 Q
"RTN","ZTLOAD")
0^3^B3834146^B3991879
"RTN","ZTLOAD",1,0)
%ZTLOAD ;ISF/RDS,RWF - TaskMan: Programmer Interface: Entry Points ;07/26/2006
"RTN","ZTLOAD",2,0)
 ;;8.0;KERNEL;**67,118,127,339,381**;JUL 10, 1995;Build 2
"RTN","ZTLOAD",3,0)
 ;
"RTN","ZTLOAD",4,0)
QUEUE ;queue a task (create, schedule) (Entry Point = ^%ZTLOAD)
"RTN","ZTLOAD",5,0)
 G ^%ZTLOAD1
"RTN","ZTLOAD",6,0)
 ;
"RTN","ZTLOAD",7,0)
S(MSG) ;Entry Point: extrinsic variable returns boolean: should task stop?
"RTN","ZTLOAD",8,0)
 I $G(ZTQUEUED)>.5,$D(^%ZTSCH("TASK",ZTQUEUED)) S ^%ZTSCH("TASK",ZTQUEUED,1)=$H
"RTN","ZTLOAD",9,0)
 I $D(MSG),$G(ZTQUEUED)>.5 S ^%ZTSK(ZTQUEUED,.11)=MSG
"RTN","ZTLOAD",10,0)
 N ZTSTOP S ZTSTOP=0
"RTN","ZTLOAD",11,0)
 I $G(ZTQUEUED)>.5,$L($P($G(^%ZTSK(ZTQUEUED,.1)),"^",10)) S ZTSTOP=1
"RTN","ZTLOAD",12,0)
 Q ZTSTOP
"RTN","ZTLOAD",13,0)
 ;
"RTN","ZTLOAD",14,0)
TM() ;Entry Point: extrinsic variable returns boolean: is TM running?
"RTN","ZTLOAD",15,0)
 N ZTH,ZTR S ZTH=$H,ZTR=$G(^%ZTSCH("RUN"))
"RTN","ZTLOAD",16,0)
 Q ZTH-ZTR*86400+$P(ZTH,",",2)-$P(ZTR,",",2)<500
"RTN","ZTLOAD",17,0)
 ;
"RTN","ZTLOAD",18,0)
REQ ;Entry Point: requeue a task (edit, reschedule)
"RTN","ZTLOAD",19,0)
 G ^%ZTLOAD3
"RTN","ZTLOAD",20,0)
 ;
"RTN","ZTLOAD",21,0)
KILL ;Entry Point: delete a task
"RTN","ZTLOAD",22,0)
 S ZTSK=$G(ZTSK)
"RTN","ZTLOAD",23,0)
 K ZTSK(0) S ZTSK(0)=0
"RTN","ZTLOAD",24,0)
 I ZTSK>1,$D(^%ZTSK(ZTSK)) D  L -^%ZTSK(ZTSK) ;could be done!
"RTN","ZTLOAD",25,0)
 . L +^%ZTSK(ZTSK):20 Q:'$T
"RTN","ZTLOAD",26,0)
 . ;Don't kill running persistent tasks.
"RTN","ZTLOAD",27,0)
 . I $D(^%ZTSCH("ZTSK",ZTSK,"P")) Q
"RTN","ZTLOAD",28,0)
 . K ^%ZTSK(ZTSK) S ZTSK(0)=1
"RTN","ZTLOAD",29,0)
 Q
"RTN","ZTLOAD",30,0)
 ;
"RTN","ZTLOAD",31,0)
ISQED ;Entry Point: return whether task is pending (scheduled or waiting)
"RTN","ZTLOAD",32,0)
 G ^%ZTLOAD4
"RTN","ZTLOAD",33,0)
 ;
"RTN","ZTLOAD",34,0)
STAT ;Entry Point: return status of a task
"RTN","ZTLOAD",35,0)
 G ^%ZTLOAD5
"RTN","ZTLOAD",36,0)
 ;
"RTN","ZTLOAD",37,0)
DQ ;Entry Point: dequeue a task (unschedule)
"RTN","ZTLOAD",38,0)
 G ^%ZTLOAD6
"RTN","ZTLOAD",39,0)
 ;
"RTN","ZTLOAD",40,0)
DESC(DESC,LST) ;Find tasks with description
"RTN","ZTLOAD",41,0)
 G DESC^%ZTLOAD5
"RTN","ZTLOAD",42,0)
 ;
"RTN","ZTLOAD",43,0)
RTN(RTN,LST) ;Find tasks that call this routine
"RTN","ZTLOAD",44,0)
 G RTN^%ZTLOAD5
"RTN","ZTLOAD",45,0)
 ;
"RTN","ZTLOAD",46,0)
OPTION(OPNM,LST) ;Find tasks for this OPTION.
"RTN","ZTLOAD",47,0)
 G OPTION^%ZTLOAD5
"RTN","ZTLOAD",48,0)
 ;
"RTN","ZTLOAD",49,0)
JOB(ZTM) ;Return the job # for a running task
"RTN","ZTLOAD",50,0)
 G JOB^%ZTLOAD5
"RTN","ZTLOAD",51,0)
 ;
"RTN","ZTLOAD",52,0)
ZTSAVE(%,%1) ;input variables in string delimited by ; to build ZTSAVE array
"RTN","ZTLOAD",53,0)
 N %2 K:$G(%1) ZTSAVE
"RTN","ZTLOAD",54,0)
 F %1=1:1 S %2=$P(%,";",%1) Q:%2=""  S ZTSAVE(%2)=""
"RTN","ZTLOAD",55,0)
 Q
"RTN","ZTLOAD",56,0)
 ;
"RTN","ZTLOAD",57,0)
PSET(ZTM) ;e.f. Set the persistents node
"RTN","ZTLOAD",58,0)
 D TN Q:'$D(^%ZTSCH("TASK",ZTM)) 0
"RTN","ZTLOAD",59,0)
 S ^%ZTSCH("TASK",ZTM,"P")=""
"RTN","ZTLOAD",60,0)
 Q 1
"RTN","ZTLOAD",61,0)
 ;
"RTN","ZTLOAD",62,0)
PCLEAR(ZTM) ;Clear the persistents node
"RTN","ZTLOAD",63,0)
 D TN Q:'$D(^%ZTSCH("TASK",ZTM))
"RTN","ZTLOAD",64,0)
 K ^%ZTSCH("TASK",ZTM,"P")
"RTN","ZTLOAD",65,0)
 Q
"RTN","ZTLOAD",66,0)
 ;
"RTN","ZTLOAD",67,0)
ASKSTOP(ZTSK) ;E.F. Ask a task to stop.
"RTN","ZTLOAD",68,0)
 G ASKSTOP^%ZTLOAD2
"RTN","ZTLOAD",69,0)
 Q
"RTN","ZTLOAD",70,0)
 ;
"RTN","ZTLOAD",71,0)
TN S ZTM=$S($G(ZTM)>0:ZTM,$G(ZTQUEUED)>.9:ZTQUEUED,$G(ZTSK)>0:ZTSK,1:0)
"RTN","ZTLOAD",72,0)
 Q
"VER")
8.0^22.0
"BLD",937,6)
^362
**END**
**END**
