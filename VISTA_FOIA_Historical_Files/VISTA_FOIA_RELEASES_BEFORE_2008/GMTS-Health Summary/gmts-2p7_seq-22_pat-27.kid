Released GMTS*2.7*27 SEQ #22
Extracted from mail message
**KIDS**:GMTS*2.7*27^

**INSTALL NAME**
GMTS*2.7*27
"BLD",664,0)
GMTS*2.7*27^HEALTH SUMMARY^0^2980318^y
"BLD",664,1,0)
^^2^2^2980318^
"BLD",664,1,1,0)
Patch 27 GMTS*2.7*27, Y2K patch. See the National Patch Module for a
"BLD",664,1,2,0)
complete description of this patch.
"BLD",664,4,0)
^9.64PA^^
"BLD",664,"ABPKG")
n
"BLD",664,"KRN",0)
^9.67PA^19^18
"BLD",664,"KRN",.4,0)
.4
"BLD",664,"KRN",.401,0)
.401
"BLD",664,"KRN",.402,0)
.402
"BLD",664,"KRN",.403,0)
.403
"BLD",664,"KRN",.5,0)
.5
"BLD",664,"KRN",.84,0)
.84
"BLD",664,"KRN",3.6,0)
3.6
"BLD",664,"KRN",3.8,0)
3.8
"BLD",664,"KRN",9.2,0)
9.2
"BLD",664,"KRN",9.8,0)
9.8
"BLD",664,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",664,"KRN",9.8,"NM",1,0)
GMTSU^^0^B11756108
"BLD",664,"KRN",9.8,"NM",2,0)
GMTSDVR^^0^B31050865
"BLD",664,"KRN",9.8,"NM",3,0)
GMTSADHC^^0^B17000180
"BLD",664,"KRN",9.8,"NM",4,0)
GMTSPL^^0^B18685629
"BLD",664,"KRN",9.8,"NM",5,0)
GMTSUP^^0^B16824412
"BLD",664,"KRN",9.8,"NM","B","GMTSADHC",3)

"BLD",664,"KRN",9.8,"NM","B","GMTSDVR",2)

"BLD",664,"KRN",9.8,"NM","B","GMTSPL",4)

"BLD",664,"KRN",9.8,"NM","B","GMTSU",1)

"BLD",664,"KRN",9.8,"NM","B","GMTSUP",5)

"BLD",664,"KRN",19,0)
19
"BLD",664,"KRN",19.1,0)
19.1
"BLD",664,"KRN",101,0)
101
"BLD",664,"KRN",409.61,0)
409.61
"BLD",664,"KRN",771,0)
771
"BLD",664,"KRN",869.2,0)
869.2
"BLD",664,"KRN",870,0)
870
"BLD",664,"KRN",8994,0)
8994
"BLD",664,"KRN","B",.4,.4)

"BLD",664,"KRN","B",.401,.401)

"BLD",664,"KRN","B",.402,.402)

"BLD",664,"KRN","B",.403,.403)

"BLD",664,"KRN","B",.5,.5)

"BLD",664,"KRN","B",.84,.84)

"BLD",664,"KRN","B",3.6,3.6)

"BLD",664,"KRN","B",3.8,3.8)

"BLD",664,"KRN","B",9.2,9.2)

"BLD",664,"KRN","B",9.8,9.8)

"BLD",664,"KRN","B",19,19)

"BLD",664,"KRN","B",19.1,19.1)

"BLD",664,"KRN","B",101,101)

"BLD",664,"KRN","B",409.61,409.61)

"BLD",664,"KRN","B",771,771)

"BLD",664,"KRN","B",869.2,869.2)

"BLD",664,"KRN","B",870,870)

"BLD",664,"KRN","B",8994,8994)

"BLD",664,"QUES",0)
^9.62^^
"BLD",664,"REQB",0)
^9.611^1^1
"BLD",664,"REQB",1,0)
GMTS*2.7*21^1
"BLD",664,"REQB","B","GMTS*2.7*21",1)

"OER",187,0)
187^GMTS^0^^
"OER",187,1,0)
^100.9951PA^1^1
"OER",187,1,1,0)
2025
"OER",187,1,1,1,0)
^100.99511PA^3^3
"OER",187,1,1,1,1,0)
231
"OER",187,1,1,1,2,0)
229
"OER",187,1,1,1,3,0)
230
"PKG",187,-1)
1^1
"PKG",187,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",187,22,0)
^9.49I^1^1
"PKG",187,22,1,0)
2.7^2951020^2960316
"PKG",187,22,1,"PAH",1,0)
27^2980318
"PKG",187,22,1,"PAH",1,1,0)
^^2^2^2980318
"PKG",187,22,1,"PAH",1,1,1,0)
Patch 27 GMTS*2.7*27, Y2K patch. See the National Patch Module for a
"PKG",187,22,1,"PAH",1,1,2,0)
complete description of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","GMTSADHC")
0^3^B17000180
"RTN","GMTSADHC",1,0)
GMTSADHC ;SLC/JER - Ad Hoc Summary Driver ;3/18/98
"RTN","GMTSADHC",2,0)
 ;;2.7;Health Summary;**6,27**;Oct 20, 1995
"RTN","GMTSADHC",3,0)
MAIN N I,XQORSPEW
"RTN","GMTSADHC",4,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION" D ^DIC K DIC S GMTSTYP=+Y,GMTSTITL="AD HOC"
"RTN","GMTSADHC",5,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!'$D(GMTSEG)
"RTN","GMTSADHC",6,0)
 . K GMTSEG,GMTSEGI,GMTSEGC
"RTN","GMTSADHC",7,0)
 . D BUILD
"RTN","GMTSADHC",8,0)
 . Q:$D(DUOUT)!$D(DIROUT)!'$D(GMTSEG)
"RTN","GMTSADHC",9,0)
 . N GMPAT,GMP
"RTN","GMTSADHC",10,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSADHC",11,0)
 . . K GMP,GMPAT
"RTN","GMTSADHC",12,0)
 . . F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PATIENT^ORU1(.GMP),PATCOPY^GMTSDVR(.GMP,.GMPAT) Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,$P($G(^VA(200,DUZ,100.1)),U,6)]"":1,1:0)  D
"RTN","GMTSADHC",13,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSADHC",14,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSADHC",15,0)
 . . D RESUB^GMTSDVR(.GMPAT)
"RTN","GMTSADHC",16,0)
 . . S ZTRTN="PQ^GMTSADHC"
"RTN","GMTSADHC",17,0)
 . . W !
"RTN","GMTSADHC",18,0)
 . . D HSOUT^GMTSDVR
"RTN","GMTSADHC",19,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSADHC",20,0)
 Q
"RTN","GMTSADHC",21,0)
PQ ; Queued subroutine to print Ad Hoc HS for each patient
"RTN","GMTSADHC",22,0)
 N GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG
"RTN","GMTSADHC",23,0)
 N GMTSPHDR,GMTSPNM,GMTSRB,GMTSSN,GMTSTOF,GMTSWARD,VADM,VAERR,VAIN,VAROOT
"RTN","GMTSADHC",24,0)
 S GMPAT=0 F  S GMPAT=$O(GMPAT(GMPAT)) Q:GMPAT'>0  D  Q:$D(GMTSQIT)!$D(DIROUT)
"RTN","GMTSADHC",25,0)
 . S DFN=+$G(GMPAT(GMPAT)) D EN^GMTS1
"RTN","GMTSADHC",26,0)
 Q
"RTN","GMTSADHC",27,0)
BUILD ; Conducts Dialogue to build ad hoc summary
"RTN","GMTSADHC",28,0)
 N GMI,GMJ,X,XQORM,Y
"RTN","GMTSADHC",29,0)
 Q:$D(GMTSQIT)!($D(DIROUT))
"RTN","GMTSADHC",30,0)
 W @IOF
"RTN","GMTSADHC",31,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")",XQORM("M")=6
"RTN","GMTSADHC",32,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="AD",XQORM("A")="Select NEW set of COMPONENT(S): ",XQORM("??")="D HELP^GMTSADH" D ^XQORM I Y'>0 S GMTSQIT="" Q
"RTN","GMTSADHC",33,0)
 I +Y,(X?1"^^".E) D RJUMP^GMTSUP1 G BUILD
"RTN","GMTSADHC",34,0)
 S GMTSEGC=Y
"RTN","GMTSADHC",35,0)
 S (X,GMI,GMJ)=0 F  S GMI=$O(Y(GMI)) Q:'GMI  D LOAD
"RTN","GMTSADHC",36,0)
 D GETLIM^GMTSADH1
"RTN","GMTSADHC",37,0)
 Q
"RTN","GMTSADHC",38,0)
LOAD ; Load enabled components into GMTSEG
"RTN","GMTSADHC",39,0)
 N SREC,STRN
"RTN","GMTSADHC",40,0)
 S STRN=+Y(GMI),SREC=^GMT(142,GMTSTYP,1,STRN,0)
"RTN","GMTSADHC",41,0)
LOAD1 S GMJ=GMJ+1,GMTSEG(GMJ)=SREC,GMTSEGI($P(SREC,U,2))=GMJ D LOADSEL
"RTN","GMTSADHC",42,0)
 Q
"RTN","GMTSADHC",43,0)
LOADSEL ; Loads GMTSEG(J,FN,IFN), when Selection items are present
"RTN","GMTSADHC",44,0)
 N S2,SJ,SEL
"RTN","GMTSADHC",45,0)
 S S2=0,SJ=GMJ
"RTN","GMTSADHC",46,0)
 F  S S2=$O(^GMT(142,GMTSTYP,1,STRN,1,S2)) Q:'S2  S SEL=^(S2,0),GMTSEG(GMJ,+$P(@(U_$P(SEL,";",2)_"0)"),U,2),S2)=$P(SEL,";") I S2=1 S GMTSEG(SJ,+$P(@(U_$P(SEL,";",2)_"0)"),U,2),0)=U_$P(SEL,";",2)
"RTN","GMTSADHC",47,0)
 Q
"RTN","GMTSADHC",48,0)
HELP ; 
"RTN","GMTSADHC",49,0)
 N GMJ,GMTSTXT,HLP
"RTN","GMTSADHC",50,0)
 S HLP=$S(X="??":"HTX2",X="?":"HTX1",1:"") I $L(HLP) W ! F GMJ=1:1 S GMTSTXT=$T(@HLP+GMJ) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSADHC",51,0)
 I X="???" W !! D HELP2^GMTSUP1
"RTN","GMTSADHC",52,0)
 D REDISP
"RTN","GMTSADHC",53,0)
 Q
"RTN","GMTSADHC",54,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSADHC",55,0)
 N I,DIR,X,Y
"RTN","GMTSADHC",56,0)
 S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y
"RTN","GMTSADHC",57,0)
 W @IOF
"RTN","GMTSADHC",58,0)
 D DISP^XQORM1 W !
"RTN","GMTSADHC",59,0)
 Q
"RTN","GMTSADHC",60,0)
HTX1 ;;Help Text for "?" and "??"
"RTN","GMTSADHC",61,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADHC",62,0)
 ;;
"RTN","GMTSADHC",63,0)
 ;;Enter: ??  to see HELP for MULTIPLE SELECTION
"RTN","GMTSADHC",64,0)
 ;;       ??? to see HELP for "^^"-jump
"RTN","GMTSADHC",65,0)
 ;;
"RTN","GMTSADHC",66,0)
 ;;ZZZZ
"RTN","GMTSADHC",67,0)
HTX2 ; HELP for ??
"RTN","GMTSADHC",68,0)
 ;;
"RTN","GMTSADHC",69,0)
 ;;The Health Summary components you select at this prompt create
"RTN","GMTSADHC",70,0)
 ;;an ADHOC Health Summary.
"RTN","GMTSADHC",71,0)
 ;;
"RTN","GMTSADHC",72,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADHC",73,0)
 ;;
"RTN","GMTSADHC",74,0)
 ;;ALL items may be selected by typing "ALL".
"RTN","GMTSADHC",75,0)
 ;;
"RTN","GMTSADHC",76,0)
 ;;EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSADHC",77,0)
 ;;  For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSADHC",78,0)
 ;;
"RTN","GMTSADHC",79,0)
 ;;NOTE: Menu items are ordered alphabetically by the Component NAME.
"RTN","GMTSADHC",80,0)
 ;;      However, the displayed text is the Header Name which generally 
"RTN","GMTSADHC",81,0)
 ;;      is different from the Component Name. Component may be picked
"RTN","GMTSADHC",82,0)
 ;;      by their abbreviation, Header Name or Component Name.
"RTN","GMTSADHC",83,0)
 ;;
"RTN","GMTSADHC",84,0)
 ;;ZZZZ
"RTN","GMTSDVR")
0^2^B31050865
"RTN","GMTSDVR",1,0)
GMTSDVR ;SLC/JER - Health Summary Driver ;3/18/98
"RTN","GMTSDVR",2,0)
 ;;2.7;Health Summary;**6,16,27**;Oct 20, 1995
"RTN","GMTSDVR",3,0)
MAIN ; Control branching
"RTN","GMTSDVR",4,0)
 N C,I,GMTYP,VADM,VAROOT,ZTRTN,GMPSAP
"RTN","GMTSDVR",5,0)
 K DIROUT,DUOUT
"RTN","GMTSDVR",6,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",7,0)
 . D SELTYP Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",8,0)
 . N GMPAT,GMP
"RTN","GMTSDVR",9,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSDVR",10,0)
 . . K GMP,GMPAT
"RTN","GMTSDVR",11,0)
 . . F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PATIENT^ORU1(.GMP),PATCOPY(.GMP,.GMPAT) Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,$P($G(^VA(200,DUZ,100.1)),U,6)]"":1,1:0)  D
"RTN","GMTSDVR",12,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSDVR",13,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSDVR",14,0)
 . . N GMTSPX1,GMTSPX2
"RTN","GMTSDVR",15,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX2,.GMTSPX1) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTSDVR",16,0)
 . . Q:$D(DUOUT)!$D(DIROUT)
"RTN","GMTSDVR",17,0)
 . . D RESUB(.GMPAT)
"RTN","GMTSDVR",18,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSDVR",19,0)
 . . S ZTRTN="PQ^GMTSDVR"
"RTN","GMTSDVR",20,0)
 . . D HSOUT
"RTN","GMTSDVR",21,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSDVR",22,0)
 Q
"RTN","GMTSDVR",23,0)
PATCOPY(GMP,GMPAT) ;Copies patients retrieved from ^ORU1 in GMP array
"RTN","GMTSDVR",24,0)
 ;                to GMPAT array
"RTN","GMTSDVR",25,0)
 N IFN,GMDFN
"RTN","GMTSDVR",26,0)
 S IFN=0
"RTN","GMTSDVR",27,0)
 ; GMPAT(NAME,GMDFN) - want array in alphabetic order by patient
"RTN","GMTSDVR",28,0)
 F  S IFN=$O(GMP(IFN)) Q:IFN'>0  D
"RTN","GMTSDVR",29,0)
 . S GMDFN=+$G(GMP(IFN))
"RTN","GMTSDVR",30,0)
 . ; Getting name from ^DPT because name returned from ^ORUS sometimes
"RTN","GMTSDVR",31,0)
 . ; has trailing spaces which could allow duplicate recs for a patient
"RTN","GMTSDVR",32,0)
 . S GMPAT($P($G(^DPT(GMDFN,0)),U),+GMDFN)=+GMDFN
"RTN","GMTSDVR",33,0)
 Q
"RTN","GMTSDVR",34,0)
RESUB(GMP) ;Subscripts in GMP array are convert to one numeric subscript.
"RTN","GMTSDVR",35,0)
 ;        Done inorder to have GMP array in alphabetic order by patient.
"RTN","GMTSDVR",36,0)
 N NAME,GMDFN,CNT
"RTN","GMTSDVR",37,0)
 S CNT=0,NAME=""
"RTN","GMTSDVR",38,0)
 F  S NAME=$O(GMP(NAME)) Q:NAME']""  D
"RTN","GMTSDVR",39,0)
 . S GMDFN=0
"RTN","GMTSDVR",40,0)
 . F  S GMDFN=$O(GMP(NAME,GMDFN)) Q:GMDFN'>0  D
"RTN","GMTSDVR",41,0)
 . . S CNT=CNT+1
"RTN","GMTSDVR",42,0)
 . . S GMP(CNT)=GMP(NAME,GMDFN)
"RTN","GMTSDVR",43,0)
 . . K GMP(NAME,GMDFN)
"RTN","GMTSDVR",44,0)
 Q
"RTN","GMTSDVR",45,0)
ENXQ ; External call for tasked HS print
"RTN","GMTSDVR",46,0)
 ; Input: GMTSTYP=Record # of HS type in file 142
"RTN","GMTSDVR",47,0)
 ;            DFN=Record # of patient in file 2
"RTN","GMTSDVR",48,0)
 ;        GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTSDVR",49,0)
 ;        GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTSDVR",50,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTSDVR",51,0)
 ;        is desired.
"RTN","GMTSDVR",52,0)
 ; To call from TaskMan:
"RTN","GMTSDVR",53,0)
 ;        S ZTRTN="ENXQ^GMTSDVR",ZTSAVE("GMTSTYP")="",ZTSAVE("DFN")=""
"RTN","GMTSDVR",54,0)
 ;        D ^%ZTLOAD
"RTN","GMTSDVR",55,0)
 D ENX(DFN,GMTSTYP,$G(GMTSPX2),$G(GMTSPX1))
"RTN","GMTSDVR",56,0)
 Q
"RTN","GMTSDVR",57,0)
ENX(DFN,GMTSTYP,GMTSPX2,GMTSPX1) ; External call to print a Health Summary
"RTN","GMTSDVR",58,0)
 ; call with: GMTSTYP=HEALTH SUMMARY TYPE file record number
"RTN","GMTSDVR",59,0)
 ;                DFN=PATIENT file record number
"RTN","GMTSDVR",60,0)
 ;
"RTN","GMTSDVR",61,0)
 ;            GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTSDVR",62,0)
 ;            GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTSDVR",63,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTSDVR",64,0)
 ;        is desired.
"RTN","GMTSDVR",65,0)
 N DI,DX,DY,GMQUIT,GMTYP,GMPAT,VADM,VAIN,VAROOT
"RTN","GMTSDVR",66,0)
 F  Q:($D(^GMT(142,+GMTSTYP,1))>9)&$D(^DPT(DFN))!+$G(GMQUIT)  D
"RTN","GMTSDVR",67,0)
 . I $D(^GMT(142,+GMTSTYP,1))'>9 D
"RTN","GMTSDVR",68,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",69,0)
 . . W !?3,"Invalid HEALTH SUMMARY TYPE." D SELTYP S GMTSTYP=+$G(GMTYP(1))
"RTN","GMTSDVR",70,0)
 . I '$D(^DPT(DFN)) D
"RTN","GMTSDVR",71,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",72,0)
 . . W !?3,"Invalid PATIENT ID." D PATIENT^ORU1(.GMPAT) S DFN=+$G(GMPAT(1))
"RTN","GMTSDVR",73,0)
 Q:+$G(GMQUIT)
"RTN","GMTSDVR",74,0)
 S:$D(GMTYP)'>9 GMTYP(0)=1,GMTYP(1)=+$G(GMTSTYP)_U_$P($G(^GMT(142,+GMTSTYP,0)),U)
"RTN","GMTSDVR",75,0)
 S:$D(GMPAT)'>9 GMPAT=1,GMPAT(0)=1,GMPAT(1)=DFN_U_$P($G(^DPT(DFN,0)),U)
"RTN","GMTSDVR",76,0)
 D PQ
"RTN","GMTSDVR",77,0)
 Q
"RTN","GMTSDVR",78,0)
SELTYP ; Select Health Summary Type(s)
"RTN","GMTSDVR",79,0)
 N DIC,X,Y
"RTN","GMTSDVR",80,0)
 S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEMQZ"
"RTN","GMTSDVR",81,0)
 S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSDVR",82,0)
 I $D(GMTYP)<10 S DIC("B")=$S($D(^DISV(DUZ,"^GMT(142,"))=10:$G(^DISV(DUZ,"^GMT(142,",$O(^("^GMT(142,",0)))),1:$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U))
"RTN","GMTSDVR",83,0)
 K GMTYP D ^DIC Q:+Y'>0
"RTN","GMTSDVR",84,0)
 I $S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"The Summary Type "_$P(Y,U,2)_" includes no components...Please choose another",! Q
"RTN","GMTSDVR",85,0)
 S GMTYP(0)=1,GMTYP(1)=Y_U_$P(Y,U,2)_U_$P(Y,U,2)_U_$P(Y,U,2)
"RTN","GMTSDVR",86,0)
 Q
"RTN","GMTSDVR",87,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTSDVR",88,0)
 N DFN,GMTI,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTSDVR",89,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSTYP,GMTSTITL,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTSDVR",90,0)
 N GMTSPHDR,TRFAC,VAERR,VAIN
"RTN","GMTSDVR",91,0)
 S GMTI=0 F  S GMTI=$O(GMTYP(GMTI)) Q:GMTI'>0!$D(DIROUT)  D
"RTN","GMTSDVR",92,0)
 .N GMTSEG,GMTSEGC,GMTSEGI
"RTN","GMTSDVR",93,0)
 .S GMTSTYP=+$G(GMTYP(GMTI)),GMTSTITL=$G(^GMT(142,+GMTSTYP,"T"))
"RTN","GMTSDVR",94,0)
 .S:'$L(GMTSTITL) GMTSTITL=$P(GMTYP(GMTI),U,2)
"RTN","GMTSDVR",95,0)
 .D LOADSEG
"RTN","GMTSDVR",96,0)
 .S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTSDVR",97,0)
 . . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTSDVR",98,0)
 . . N GMDUOUT
"RTN","GMTSDVR",99,0)
 . . D EN^GMTS1
"RTN","GMTSDVR",100,0)
 . . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSDVR",101,0)
 . . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTSDVR",102,0)
 Q
"RTN","GMTSDVR",103,0)
LOADSEG ;LOAD ENABLED COMPONENTS INTO GMTSEG ARRAY
"RTN","GMTSDVR",104,0)
 N GMTI,GMTJ,GMX
"RTN","GMTSDVR",105,0)
 S (GMTI,GMTJ)=0 F  S GMTJ=$O(^GMT(142,GMTSTYP,1,GMTJ)) Q:GMTJ'>0  S GMX=^(GMTJ,0) D
"RTN","GMTSDVR",106,0)
 .S GMTI=GMTI+1,GMTSEG(GMTI)=GMX,GMTSEGI($P(GMX,U,2))=GMTI D SELFILE
"RTN","GMTSDVR",107,0)
 S GMTSEGC=GMTI
"RTN","GMTSDVR",108,0)
 Q
"RTN","GMTSDVR",109,0)
SELFILE ; Get Selection item information for GMTSEG(
"RTN","GMTSDVR",110,0)
 N GMTK,ITEM,FST
"RTN","GMTSDVR",111,0)
 S GMTK=0,FST=1
"RTN","GMTSDVR",112,0)
 F  S GMTK=$O(^GMT(142,GMTSTYP,1,GMTJ,1,GMTK)) Q:GMTK'>0  S ITEM=^(GMTK,0),GMTSEG(GMTI,+$P(@(U_$P(ITEM,";",2)_"0)"),U,2),GMTK)=$P(ITEM,";") I $G(FST) S GMTSEG(GMTI,+$P(@(U_$P(ITEM,";",2)_"0)"),U,2),0)=U_$P(ITEM,";",2) K FST
"RTN","GMTSDVR",113,0)
 Q
"RTN","GMTSDVR",114,0)
HSOUT ; Output summary, with device control
"RTN","GMTSDVR",115,0)
 ; Call with: ZTRTN
"RTN","GMTSDVR",116,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D @ZTRTN Q
"RTN","GMTSDVR",117,0)
 N %ZIS,IOP
"RTN","GMTSDVR",118,0)
 S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTSDVR",119,0)
 G:$D(IO("Q")) QUE
"RTN","GMTSDVR",120,0)
NOQUE D @ZTRTN
"RTN","GMTSDVR",121,0)
 D ^%ZISC
"RTN","GMTSDVR",122,0)
 Q
"RTN","GMTSDVR",123,0)
QUE ; Queue output
"RTN","GMTSDVR",124,0)
 N %,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTSK
"RTN","GMTSDVR",125,0)
 Q:'$D(ZTRTN)  K IO("Q"),ZTSAVE F %="DFN","GM*","ENTRY","O*" S ZTSAVE(%)=""
"RTN","GMTSDVR",126,0)
 S ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTSDVR",127,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTSDVR",128,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTSDVR",129,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTSDVR",130,0)
 Q
"RTN","GMTSDVR",131,0)
ACTPROF(GMDFN) ; Check & print Action Profile for patient if +$G(GMPSAP)
"RTN","GMTSDVR",132,0)
 N DFN,PSTYPE,PSONOPG,PSOPAR,PSOINST
"RTN","GMTSDVR",133,0)
 I +$G(GMPSAP) D
"RTN","GMTSDVR",134,0)
 . S (PSTYPE,PSONOPG)=1,DFN=GMDFN
"RTN","GMTSDVR",135,0)
 . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSDVR",136,0)
 . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSDVR",137,0)
 . D DFN^PSOSD1
"RTN","GMTSDVR",138,0)
 . S DFN=GMDFN ;Have to reset DFN because ^PSOSD1 call kills it and it is
"RTN","GMTSDVR",139,0)
 . ; needed for the ^GMTSPL call.
"RTN","GMTSDVR",140,0)
 . D PAGE^GMTSPL
"RTN","GMTSPL")
0^4^B18685629
"RTN","GMTSPL",1,0)
GMTSPL ;SLC/JER - Print/Queue HS for Patient Lists ;3/18/98
"RTN","GMTSPL",2,0)
 ;;2.7;Health Summary;**7,27**;Oct 20, 1995
"RTN","GMTSPL",3,0)
 ; Call with:  GMTSTYP=Ptr to file 142, and
"RTN","GMTSPL",4,0)
 ; GMTSSC=Ptr to file 44^Hosp Loc Name^Hosp Loc Type^
"RTN","GMTSPL",5,0)
 ;     Optional begin Visit/Surgery Date^Optional end Visit/Surgery Date
"RTN","GMTSPL",6,0)
 ; GMTSSC()=GMTSSC - An array for multiple locations (GMTSPD)
"RTN","GMTSPL",7,0)
 ; [GMPSAP]=Optional flag set to 1 if OP Rx Action Profile is to print
"RTN","GMTSPL",8,0)
MAIN ; Controls for processing multiple locations
"RTN","GMTSPL",9,0)
 N MULTLOC
"RTN","GMTSPL",10,0)
 I +$O(GMTSSC(0))'>0 D MAINCTRL
"RTN","GMTSPL",11,0)
 I +$O(GMTSSC(0)) D
"RTN","GMTSPL",12,0)
 . S MULTLOC=0
"RTN","GMTSPL",13,0)
 . F  S MULTLOC=$O(GMTSSC(MULTLOC)) Q:+MULTLOC'>0!$D(DIROUT)  D
"RTN","GMTSPL",14,0)
 . . S GMTSSC=GMTSSC(+MULTLOC)
"RTN","GMTSPL",15,0)
 . . D MAINCTRL
"RTN","GMTSPL",16,0)
 Q
"RTN","GMTSPL",17,0)
MAINCTRL ; Controls Branching
"RTN","GMTSPL",18,0)
 N DFN,GMTDFN,GMLTYPE,GMTSLTR,GMPNM,PSOPAR,PSONOPG,PSOINST,PSTYPE
"RTN","GMTSPL",19,0)
 K ^TMP("GMTSPL",$J)
"RTN","GMTSPL",20,0)
 U IO
"RTN","GMTSPL",21,0)
 S GMLTYPE=$P(GMTSSC,U,3)
"RTN","GMTSPL",22,0)
 I GMLTYPE="C" D CLINIC(GMTSSC)
"RTN","GMTSPL",23,0)
 I GMLTYPE="W" D WARD(GMTSSC)
"RTN","GMTSPL",24,0)
 I GMLTYPE="OR" D OR(GMTSSC)
"RTN","GMTSPL",25,0)
 I $L($P(GMTSSC,U,2)),($E(IOST,1)'="C") S GMTSLTR=$E($P(GMTSSC,U,2),1,10) D ^GMTSLTR
"RTN","GMTSPL",26,0)
 I $O(^TMP("GMTSPL",$J,0))="" D NOPAT($P(GMTSSC,U,2)) Q
"RTN","GMTSPL",27,0)
 S GMPNM="" F  S GMPNM=$O(^TMP("GMTSPL",$J,GMPNM)) Q:(GMPNM="")!($D(DIROUT))  D
"RTN","GMTSPL",28,0)
 . S GMTDFN=0 F  S GMTDFN=$O(^TMP("GMTSPL",$J,GMPNM,GMTDFN)) Q:(GMTDFN'>0)!($D(DIROUT))  D
"RTN","GMTSPL",29,0)
 . . N GMDUOUT
"RTN","GMTSPL",30,0)
 . . S DFN=GMTDFN D DRIVER Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSPL",31,0)
 . . I +$G(GMPSAP) D
"RTN","GMTSPL",32,0)
 . . . S (PSTYPE,PSONOPG)=1
"RTN","GMTSPL",33,0)
 . . . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSPL",34,0)
 . . . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSPL",35,0)
 . . . D DFN^PSOSD1,PAGE
"RTN","GMTSPL",36,0)
 K ^TMP("GMTSPL",$J)
"RTN","GMTSPL",37,0)
 Q
"RTN","GMTSPL",38,0)
PAGE ; Pause at BOP for interactive users
"RTN","GMTSPL",39,0)
 N DIR,X,Y
"RTN","GMTSPL",40,0)
 Q:$E(IOST)'="C"!(IOT="HFS")!((IOSL>998)&($G(GMPAT(+$O(GMPAT(""),-1)))'=$G(DFN)))
"RTN","GMTSPL",41,0)
 I IOSL>($Y+5) F  W ! Q:IOSL<($Y+6)!($Y'<22)
"RTN","GMTSPL",42,0)
 S DIR(0)="FO^1:1",DIR("A")="Press RETURN to continue or '^' to exit"
"RTN","GMTSPL",43,0)
 S DIR("?")="Enter '^' to quit present report or '^^' to quit to menu"
"RTN","GMTSPL",44,0)
 D ^DIR
"RTN","GMTSPL",45,0)
 Q
"RTN","GMTSPL",46,0)
NOPAT(LOC) ; Handles selection of unpopulated Hospital location
"RTN","GMTSPL",47,0)
 N %,%H,%I,%T,%Y,GMTS,GMTSDTM,GMTSHDR,GMTSPG,GMTSTITL,GMTSDTM,GMTSLFG,X,Y
"RTN","GMTSPL",48,0)
 D NOW^%DTC S X=% D REGDTM^GMTSU S GMTSDTM=X
"RTN","GMTSPL",49,0)
 S DIC=142,DIC(0)="NXF",X=+GMTSTYP D ^DIC K DIC
"RTN","GMTSPL",50,0)
 S GMTSTITL=$S($D(^GMT(142,+Y,"T")):^("T"),1:$P(Y,U,2)),GMTSLFG=1
"RTN","GMTSPL",51,0)
 W @IOF D HEADER^GMTSUP W !!,"No Patients found at ",LOC," location.",!
"RTN","GMTSPL",52,0)
 Q
"RTN","GMTSPL",53,0)
CLINIC(LOC) ; Gets list of next-day appointments for selected clinic
"RTN","GMTSPL",54,0)
 N %,%H,%I,%T,%Y,DFN,GMI,GMJ,X,X1,X2,VDT,Y,GMPNM,GMDT,GMBDT,GMEDT
"RTN","GMTSPL",55,0)
 S VDT=+$P(LOC,U,4)
"RTN","GMTSPL",56,0)
 I 'VDT D NOW^%DTC S VDT=X
"RTN","GMTSPL",57,0)
 S X=+VDT D REGDT^GMTSU S GMBDT=X
"RTN","GMTSPL",58,0)
 S X=+$P(LOC,U,5) D REGDT^GMTSU S GMEDT=X
"RTN","GMTSPL",59,0)
 S X1=$S(+$P(LOC,U,5)>0:$P(LOC,U,5),1:VDT),X2=1 D C^%DTC
"RTN","GMTSPL",60,0)
 S GMI=VDT F  S GMI=$O(^SC(+LOC,"S",GMI)) Q:+GMI'>0!(GMI>X)  D
"RTN","GMTSPL",61,0)
 . S GMJ=0 F  S GMJ=$O(^SC(+LOC,"S",GMI,1,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSPL",62,0)
 . . I '$L($P($G(^SC(+LOC,"S",GMI,1,GMJ,0)),U,9)) D
"RTN","GMTSPL",63,0)
 . . . S DFN=+$G(^SC(+LOC,"S",GMI,1,GMJ,0)) Q:DFN'>0
"RTN","GMTSPL",64,0)
 . . . S GMPNM=$P($G(^DPT(+DFN,0)),U)
"RTN","GMTSPL",65,0)
 . . . N X
"RTN","GMTSPL",66,0)
 . . . S X=+GMI D REGDT^GMTSU S GMDT=X
"RTN","GMTSPL",67,0)
 . . . S ^TMP("GMTSPL",$J,GMPNM,+DFN)=$S($D(^TMP("GMTSPL",$J,GMPNM,+DFN)):GMBDT_" TO "_GMEDT,1:GMDT)
"RTN","GMTSPL",68,0)
 Q
"RTN","GMTSPL",69,0)
WARD(LOC) ; Gets list of patients for a specified ward
"RTN","GMTSPL",70,0)
 N DFN,GMLOC,X,Y,GMDT
"RTN","GMTSPL",71,0)
 S GMLOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U)
"RTN","GMTSPL",72,0)
 I $S('$L(GMLOC):1,'$O(^DPT("CN",GMLOC,0)):1,1:0) Q
"RTN","GMTSPL",73,0)
 S DFN=0 F  S DFN=$O(^DPT("CN",GMLOC,DFN)) Q:+DFN'>0  D
"RTN","GMTSPL",74,0)
 . N X
"RTN","GMTSPL",75,0)
 . S X=+$G(DT) D REGDT^GMTSU S GMDT=X
"RTN","GMTSPL",76,0)
 . S ^TMP("GMTSPL",$J,$P($G(^DPT(+DFN,0)),U),+DFN)=GMDT
"RTN","GMTSPL",77,0)
 Q
"RTN","GMTSPL",78,0)
OR(LOC) ; Gets list of patients scheduled for surgery on specified date
"RTN","GMTSPL",79,0)
 N DFN,GMI,GMJ,GMPNM,GMDT,%,%H,%I,%T,%Y,X,X1,X2,Y
"RTN","GMTSPL",80,0)
 S GMI=+$O(^SRS("B",+LOC,0)) I +GMI'>0 G ORX
"RTN","GMTSPL",81,0)
 S GMBEG=$P(LOC,U,4)-.0001,GMEND=$S(+$P(LOC,U,5)>0:$P(LOC,U,5),1:$P(LOC,U,4))
"RTN","GMTSPL",82,0)
 F  S GMBEG=$O(^SRF("AOR",+GMI,+GMBEG)) Q:+GMBEG'>0!(+GMBEG>+GMEND)  D
"RTN","GMTSPL",83,0)
 . S GMJ=0 F  S GMJ=$O(^SRF("AOR",+GMI,+GMBEG,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSPL",84,0)
 . . S DFN=+$G(^SRF(+GMJ,0)) Q:DFN'>0
"RTN","GMTSPL",85,0)
 . . S GMPNM=$P($G(^DPT(+DFN,0)),U)
"RTN","GMTSPL",86,0)
 . . N X
"RTN","GMTSPL",87,0)
 . . S X=+GMBEG D REGDT^GMTSU S GMDT=X
"RTN","GMTSPL",88,0)
 . . S ^TMP("GMTSPL",$J,GMPNM,+DFN)=$S($D(^TMP("GMTSPL",$J,GMPNM,+DFN)):^(+DFN)_", "_GMDT,1:GMDT)
"RTN","GMTSPL",89,0)
ORX Q
"RTN","GMTSPL",90,0)
DRIVER ; Sets variables necessary for GMTS1 and calls ^%ZTLOAD
"RTN","GMTSPL",91,0)
 N %T,C,D0,GMTS,GMTS0,GMTS1,GMTS2,GMTSDOB,GMTSDTM,GMTSLO,GMTSLOCK,GMTSLPG
"RTN","GMTSPL",92,0)
 N GMTSEG,GMTSEGC,GMTSEGI,GMTSPNM,GMTSRB,GMTSSN,GMTSTITL,GMTSWARD,GMTSX
"RTN","GMTSPL",93,0)
 N GMTSPHDR,GMTSAGE,GMTSTOF,GMW,I,SEX,VA,VADM,VAIN,VAINDT,VAROOT,X,Y
"RTN","GMTSPL",94,0)
 S GMTSCDT(0)=^TMP("GMTSPL",$J,GMPNM,+DFN)
"RTN","GMTSPL",95,0)
 S DIC=142,DIC(0)="NXF",X=GMTSTYP D ^DIC K DIC
"RTN","GMTSPL",96,0)
 S GMTSTITL=$S($G(^GMT(142,+Y,"T"))]"":^("T"),1:$P(Y,U,2))
"RTN","GMTSPL",97,0)
 D:$D(GMTSEG)'>9 SELTYP1^GMTS D EN^GMTS1
"RTN","GMTSPL",98,0)
 Q
"RTN","GMTSU")
0^1^B11756108
"RTN","GMTSU",1,0)
GMTSU ;SLC/JER,DLT - Health Summary Utilities ;3/17/98
"RTN","GMTSU",2,0)
 ;;2.7;Health Summary;**27**;Oct 20, 1995
"RTN","GMTSU",3,0)
MTIM ;CONVERT TIME from X=2890313.1304 INTO X=13:04
"RTN","GMTSU",4,0)
 S X=$P(X,".",2) Q:'$L(X)
"RTN","GMTSU",5,0)
 S X=$S(X:$E(X,1,2)_$E("00",0,2-$L($E(X,1,2)))_":"_$E(X,3,4)_$E("00",0,2-$L($E(X,3,4))),1:"")
"RTN","GMTSU",6,0)
 Q
"RTN","GMTSU",7,0)
REGDT ; Receives X in internal date.time, and returns X in MM/DD/YY format
"RTN","GMTSU",8,0)
 S X=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")
"RTN","GMTSU",9,0)
 Q
"RTN","GMTSU",10,0)
REGDT4 ; Receives X in internal date.time, and returns X in MM/DD/YYYY format
"RTN","GMTSU",11,0)
 S X=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_($E(X,1,3)+1700),1:"")
"RTN","GMTSU",12,0)
 Q
"RTN","GMTSU",13,0)
REGDTM ;Receives X in internal date.time, and returns X in MM/DD/YY TT:TT
"RTN","GMTSU",14,0)
 N T
"RTN","GMTSU",15,0)
 S T=$P(X,".",2),X=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")_" "_$S(T:$E(T,1,2)_$E("00",0,2-$L($E(T,1,2)))_":"_$E(T,3,4)_$E("00",0,2-$L($E(T,3,4))),1:"")
"RTN","GMTSU",16,0)
 Q
"RTN","GMTSU",17,0)
SIDT ; Receives X as internal date/time and returns X in DD MMM YY
"RTN","GMTSU",18,0)
 N MON,MM
"RTN","GMTSU",19,0)
 S X=$P(X,".") I 'X S X="" Q
"RTN","GMTSU",20,0)
 S MON="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"
"RTN","GMTSU",21,0)
 S MM=$E(X,4,5),MM=$S(MM:$P(MON,U,MM),1:"")
"RTN","GMTSU",22,0)
 S X=$E(X,6,7)_" "_MM_" "_$E(X,2,3)
"RTN","GMTSU",23,0)
 Q
"RTN","GMTSU",24,0)
FMHL7DTM ; Recieves X as internal date/time and returns X in CCYYMMDDHHMM
"RTN","GMTSU",25,0)
 N T
"RTN","GMTSU",26,0)
 S T=$P(X,".",2)
"RTN","GMTSU",27,0)
 S T=$S(T:$E(T,1,2)_$E("00",0,2-$L($E(T,1,2)))_$E(T,3,4)_$E("00",0,2-$L($E(T,3,4))),1:"0000")
"RTN","GMTSU",28,0)
 S X=($E($P(X,"."),1,3)+1700)_$E($P(X,"."),4,7)_T
"RTN","GMTSU",29,0)
 Q
"RTN","GMTSU",30,0)
HL7FMDTM ; Recieves X as CCYYMMDDHHMM and returns X as internal date/time
"RTN","GMTSU",31,0)
 N DATE,TIME
"RTN","GMTSU",32,0)
 S DATE=$E(X,1,8),TIME=$E(X,9,12)
"RTN","GMTSU",33,0)
 S DATE=DATE-17000000,X=DATE_"."_TIME
"RTN","GMTSU",34,0)
 Q
"RTN","GMTSU",35,0)
DEM ; Gets Demographic Data from VADPT
"RTN","GMTSU",36,0)
 ; Receives: DFN
"RTN","GMTSU",37,0)
 ; Returns: GMTSPNM,GMTSSN,GMTSDOB,SEX,GMTSWARD,GMTSRB,GMTSAGE
"RTN","GMTSU",38,0)
 K VAHOW D OERR^VADPT
"RTN","GMTSU",39,0)
 S GMTSPNM=VADM(1)
"RTN","GMTSU",40,0)
 S GMTSSN=$S($D(VA("PID")):VA("PID"),1:$P(VADM(2),"^",2))
"RTN","GMTSU",41,0)
 S GMTSAGE=$S(+VADM(4)>0:+VADM(4),1:99),SEX=$P(VADM(5),"^")
"RTN","GMTSU",42,0)
 S GMTSWARD=$P(VAIN(4),"^",2),GMTSRB=VAIN(5)
"RTN","GMTSU",43,0)
 S X=$P(VADM(3),"^") D REGDT4 S GMTSDOB=X
"RTN","GMTSU",44,0)
 K VA
"RTN","GMTSU",45,0)
 ;Establish the information for the patient header.
"RTN","GMTSU",46,0)
 K GMTSPHDR
"RTN","GMTSU",47,0)
 N DOB,LWARDRB,NMSSN,NMSSNE,WARDRB,WARDRBE,WARDRBS
"RTN","GMTSU",48,0)
 S NMSSN=GMTSPNM_"    "_GMTSSN
"RTN","GMTSU",49,0)
 S NMSSNE=$L(NMSSN)+2
"RTN","GMTSU",50,0)
 S WARDRB=GMTSWARD_" "_GMTSRB
"RTN","GMTSU",51,0)
 S LWARDRB=$L(WARDRB)
"RTN","GMTSU",52,0)
 S WARDRBS=40-(LWARDRB/2),WARDRBE=WARDRBS+LWARDRB
"RTN","GMTSU",53,0)
 S DOB="DOB: "_GMTSDOB
"RTN","GMTSU",54,0)
 S GMTSPHDR("NMSSN")=NMSSN
"RTN","GMTSU",55,0)
 S GMTSPHDR("WARDRB")=WARDRB
"RTN","GMTSU",56,0)
 S GMTSPHDR("WARDRBS")=WARDRBS
"RTN","GMTSU",57,0)
 S GMTSPHDR("DOB")=DOB
"RTN","GMTSU",58,0)
 S GMTSPHDR("DOBS")=64
"RTN","GMTSU",59,0)
 I (NMSSNE'<WARDRBS)!(WARDRBE'<64) S GMTSPHDR("TWO")=1
"RTN","GMTSU",60,0)
 Q
"RTN","GMTSU",61,0)
NAME ; Format names ;6/30/89  11:20 ;
"RTN","GMTSU",62,0)
 ; Recieves: FILE (3 for User, 16 for Person, 6 for Provider)
"RTN","GMTSU",63,0)
 ;           IFN (Internal file # for above file),
"RTN","GMTSU",64,0)
 ;           NML (Desired length for name to be returned)
"RTN","GMTSU",65,0)
 ;           FNF (Flag to specify first name format: 0 for FI, 1 for FN)
"RTN","GMTSU",66,0)
 ; Returns: Lastname,First(name/initial) to specified length as NM
"RTN","GMTSU",67,0)
 ;
"RTN","GMTSU",68,0)
 N DIC,RAWNM,LN,FN,FA,NI,CH,X,Y
"RTN","GMTSU",69,0)
 S DIC=FILE,DIC(0)="NXZ",X=IFN D ^DIC S RAWNM=$S($D(Y(0,0)):Y(0,0),1:"UNKNOWN")
"RTN","GMTSU",70,0)
 S LN=$P(RAWNM,","),FN=$P(RAWNM,",",2)
"RTN","GMTSU",71,0)
 S FA=0 I $L(FN) F NI=1:1 S CH=$E(FN,NI) Q:CH?1A  S FA=NI
"RTN","GMTSU",72,0)
 I FA S FN=$E(FN,FA+1,$L(FN))
"RTN","GMTSU",73,0)
 I 'FNF S FN=$E(FN,1)
"RTN","GMTSU",74,0)
 S NM=$S($L(FN):LN_","_FN,1:LN),NM=$E(NM,1,NML)
"RTN","GMTSU",75,0)
 K FILE,IFN,NML,FNF
"RTN","GMTSU",76,0)
 Q
"RTN","GMTSU",77,0)
GETRANGE(FROMDATE,TODATE) ; Selection by Date Range (from and to dates)
"RTN","GMTSU",78,0)
 ;      VARIABLES LIST (OUTPUT)
"RTN","GMTSU",79,0)
 ; FROMDATE = FROM DATE
"RTN","GMTSU",80,0)
 ; TODATE = TO DATE
"RTN","GMTSU",81,0)
 N DIR,X,Y,DTOUT,DIRUT
"RTN","GMTSU",82,0)
 S DIR(0)="DO^:DT",DIR("A")="Enter Beginning Date (MM/DD/YY)"
"RTN","GMTSU",83,0)
 W !
"RTN","GMTSU",84,0)
 D ^DIR
"RTN","GMTSU",85,0)
 I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) W ! Q
"RTN","GMTSU",86,0)
 S FROMDATE=Y
"RTN","GMTSU",87,0)
 I +FROMDATE>0 D
"RTN","GMTSU",88,0)
 . N DIR,X,Y
"RTN","GMTSU",89,0)
 . S DIR(0)="DO^::EX",DIR("A")="Enter Ending Date (MM/DD/YY)"
"RTN","GMTSU",90,0)
 . S DIR("B")="TODAY"
"RTN","GMTSU",91,0)
 . D ^DIR
"RTN","GMTSU",92,0)
 . I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) K FROMDATE Q
"RTN","GMTSU",93,0)
 . I Y'>0 K FROMDATE Q
"RTN","GMTSU",94,0)
 . S TODATE=Y
"RTN","GMTSU",95,0)
 . Q:TODATE>FROMDATE!(TODATE=FROMDATE) 
"RTN","GMTSU",96,0)
 . ; If 2nd date older than 1st date entered (Dates entered in reverse order)
"RTN","GMTSU",97,0)
 . N FRDT
"RTN","GMTSU",98,0)
 . S FRDT=FROMDATE
"RTN","GMTSU",99,0)
 . S FROMDATE=TODATE
"RTN","GMTSU",100,0)
 . S TODATE=FRDT
"RTN","GMTSU",101,0)
 W !
"RTN","GMTSU",102,0)
 Q
"RTN","GMTSUP")
0^5^B16824412
"RTN","GMTSUP",1,0)
GMTSUP ;SLC/DLT,JER - Utilities for Paging Health Summary ;3/18/98
"RTN","GMTSUP",2,0)
 ;;2.7;Health Summary;**2,7,21,27**;Oct 20, 1995
"RTN","GMTSUP",3,0)
 ;
"RTN","GMTSUP",4,0)
CKP ; Check page position, pause and prompt
"RTN","GMTSUP",5,0)
 Q:$D(GMTSQIT)
"RTN","GMTSUP",6,0)
 S GMTSNPG=0
"RTN","GMTSUP",7,0)
 I $G(GMTSWRIT)=1 D
"RTN","GMTSUP",8,0)
 . D BREAK
"RTN","GMTSUP",9,0)
 . S GMTSWRIT=0
"RTN","GMTSUP",10,0)
 I IOT="HFS" D BREAK:(GMTSEGN'=$G(GMTSLCMP)) Q
"RTN","GMTSUP",11,0)
 Q:+$G(GMTSLPG)'>0&($Y'>(IOSL-GMTSLO))
"RTN","GMTSUP",12,0)
 I $E(IOST,1)="C" S:'$D(GMTSTOF) GMTSTOF=1 D CKP1
"RTN","GMTSUP",13,0)
 I '$D(GMTSQIT) W @IOF D HEADER,BREAK S GMTSNPG=1,GMTSTOF=GMTSEGN
"RTN","GMTSUP",14,0)
 I $D(GMTSQIT),(GMTSQIT]""),($D(GMTSTYP)) W @IOF D HEADER S GMTSTOF=GMTSEGN
"RTN","GMTSUP",15,0)
 Q
"RTN","GMTSUP",16,0)
CKP1 ;Help Display of Optional Components for Navigation
"RTN","GMTSUP",17,0)
 N DA,I,J,K,L,X,XQORM,Y,GMTSY,TYP
"RTN","GMTSUP",18,0)
 I $S('$D(GMTSTYP):1,$D(GMTOPT):1,1:0) N DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!(GMTSLPG) GMTSQIT="" Q
"RTN","GMTSUP",19,0)
 S TYP=GMTSTYP
"RTN","GMTSUP",20,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION" D ^DIC S GMTSTYP=+Y K DIC,X,Y
"RTN","GMTSUP",21,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="1AF\+",XQORM("A")="Press <RET> to continue, ^ to exit, or select component: "
"RTN","GMTSUP",22,0)
 S XQORM("??")="D HELP^GMTSUP1" I GMTSLPG W "* END * "
"RTN","GMTSUP",23,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")"
"RTN","GMTSUP",24,0)
 D ^XQORM W ! D @$S(Y=1:"BRNCH",1:"EVAL")
"RTN","GMTSUP",25,0)
 I $D(GMTSY),(GMTSY=0) K GMTSY G CKP1
"RTN","GMTSUP",26,0)
 S GMTSTYP=TYP
"RTN","GMTSUP",27,0)
 Q
"RTN","GMTSUP",28,0)
BREAK ; Writes the component header
"RTN","GMTSUP",29,0)
 S:'$D(GMTSLCMP) GMTSLCMP=0
"RTN","GMTSUP",30,0)
 S GMTS="",GMTSNPG=1,$P(GMTS,"-",79-$L(GMTSEGH_GMTSEGL)/2)="",GMTS=GMTS_" "_GMTSEGH_GMTSEGL_" "_GMTS I $Y'>(IOSL-GMTSLO)!(IOT="HFS") W !,GMTS,! W:$Y'>(IOSL-GMTSLO) ?34,$S(GMTSEGN=GMTSLCMP:"(continued)",1:""),! S GMTSLCMP=GMTSEGN
"RTN","GMTSUP",31,0)
 Q
"RTN","GMTSUP",32,0)
HEADER ; Print Running Header
"RTN","GMTSUP",33,0)
 N GMTSVDT,DATA
"RTN","GMTSUP",34,0)
 ; GMTSCDT(0) may contain multiple dates that could cause a line to
"RTN","GMTSUP",35,0)
 ; wrap inappropriately. If this creates a problem, a change will be
"RTN","GMTSUP",36,0)
 ; required to accommodate it.
"RTN","GMTSUP",37,0)
 S DATA=""
"RTN","GMTSUP",38,0)
 I +$G(GMTSPXD1)&+$G(GMTSPXD2) D
"RTN","GMTSUP",39,0)
 . S DATA="Printed for data "
"RTN","GMTSUP",40,0)
 . I GMTSPXD1=GMTSPXD2 S DATA=DATA_"on "_GMTSPXD1 Q
"RTN","GMTSUP",41,0)
 . S DATA=DATA_"from "_GMTSPXD2_" to "_GMTSPXD1
"RTN","GMTSUP",42,0)
 I $D(GMTSCDT(0)) S GMTSVDT=GMTSCDT(0) S:GMTSDTM'["Printed:" GMTSDTM="Printed: "_GMTSDTM
"RTN","GMTSUP",43,0)
 W !,$S($L($P($G(GMTSSC),U,2)):"Location: "_$P(GMTSSC,U,2)_" ",1:""),$S($D(GMTSVDT):GMTSVDT,1:""),DATA,?(79-$L(GMTSDTM)),GMTSDTM
"RTN","GMTSUP",44,0)
 S:'$D(GMTSPG) GMTSPG=0 S GMTSPG=GMTSPG+1,GMTSHDR=" CONFIDENTIAL "_GMTSTITL_" SUMMARY "_$S($E(IOST,1)="C":"",1:"  pg. "_GMTSPG) S GMTS="",$P(GMTS,"*",(77-$L(GMTSHDR))\2)="*" S GMTSHDR=GMTS_" "_GMTSHDR_" "_GMTS
"RTN","GMTSUP",45,0)
 W !,GMTSHDR,"*"
"RTN","GMTSUP",46,0)
 I '$D(GMTSLFG) D
"RTN","GMTSUP",47,0)
 . ;GMTSPHDR (patient header) is setup in DEM^GMTSU.
"RTN","GMTSUP",48,0)
 . I $G(GMTSPHDR("TWO")) D
"RTN","GMTSUP",49,0)
 .. W !,GMTSPHDR("NMSSN"),?GMTSPHDR("DOBS"),GMTSPHDR("DOB"),!?GMTSPHDR("WARDRBS"),GMTSPHDR("WARDRB"),!
"RTN","GMTSUP",50,0)
 . E  W !,GMTSPHDR("NMSSN"),?GMTSPHDR("WARDRBS"),GMTSPHDR("WARDRB"),?GMTSPHDR("DOBS"),GMTSPHDR("DOB"),!
"RTN","GMTSUP",51,0)
 W:+$G(VADM(6)) ?26,"** DECEASED   "_$P(VADM(6),U,2)_" **"
"RTN","GMTSUP",52,0)
 Q
"RTN","GMTSUP",53,0)
BRNCH ;Checks for appropriate abbreviation to branch to a different component
"RTN","GMTSUP",54,0)
 N GMTINX,LIM,CREC,SBS
"RTN","GMTSUP",55,0)
 I Y,("+-"[X) S:X="-" GMTSEGN=GMTSTOF-1 S (GMTSY,GMTSQIT)=1,GMTSLPG=0 Q
"RTN","GMTSUP",56,0)
 I X="^^" S DIROUT=1,GMTSQIT="" Q
"RTN","GMTSUP",57,0)
 I Y,(X?1"^^".E) D  Q
"RTN","GMTSUP",58,0)
 .N GMTSAV
"RTN","GMTSUP",59,0)
 .S GMTSAV=X D RJUMP^GMTSUP1
"RTN","GMTSUP",60,0)
 .I GMTSAV'["?" S (GMTSQIT,GMTSY)=1,GMTSEGN=GMTSTOF-1,GMTSLPG=0
"RTN","GMTSUP",61,0)
 .E  S GMTSY=0
"RTN","GMTSUP",62,0)
 S GMTINX=$S($D(^GMT(142,GMTSTYP,1,+Y(1),0)):$P(^(0),U,2),1:"")
"RTN","GMTSUP",63,0)
 I 'GMTINX S GMTSY=0 Q
"RTN","GMTSUP",64,0)
 I '$D(GMTSEGI(GMTINX)) N GMI,GMJ,GMTSDFLT S GMI=1,GMJ=GMTSEGC,GMTSDFLT=1 D LOAD^GMTSADH S GMTSEGC=GMTSEGC+1
"RTN","GMTSUP",65,0)
 I '$D(GMTSEGI(GMTINX)) S GMTINX="",GMTSY=0 Q
"RTN","GMTSUP",66,0)
 S LIM=$P(Y(1),U,4) I LIM'["=" G NOLIM
"RTN","GMTSUP",67,0)
 S CREC=^GMT(142.1,GMTINX,0),SBS=GMTSEGI(GMTINX) D CMPLIM^GMTSADH2
"RTN","GMTSUP",68,0)
 I $D(DIROUT) S GMTSQIT="" Q
"RTN","GMTSUP",69,0)
NOLIM S GMTSEGN=GMTSEGI(GMTINX)-1,(GMTSY,GMTSQIT)=1,GMTSLPG=0
"RTN","GMTSUP",70,0)
 Q
"RTN","GMTSUP",71,0)
 ;
"RTN","GMTSUP",72,0)
EVAL ; Evaluate input to determine quit or continue
"RTN","GMTSUP",73,0)
 Q:'$D(X)
"RTN","GMTSUP",74,0)
 S:$D(DTOUT) DIROUT=1 I $S(X="^^":1,GMTSLPG:1,$D(DIROUT):1,X="^":1,1:0) S GMTSQIT=""
"RTN","GMTSUP",75,0)
 I +$G(GMPSAP),(X="^") S GMDUOUT=1
"RTN","GMTSUP",76,0)
 Q
"VER")
8.0^21.0
**END**
**END**
