Released EC*2*55 SEQ #50
Extracted from mail message
**KIDS**:EC*2.0*55^

**INSTALL NAME**
EC*2.0*55
"BLD",5171,0)
EC*2.0*55^EVENT CAPTURE^0^3031114^y
"BLD",5171,4,0)
^9.64PA^^
"BLD",5171,"ABPKG")
n
"BLD",5171,"KRN",0)
^9.67PA^8989.52^19
"BLD",5171,"KRN",.4,0)
.4
"BLD",5171,"KRN",.401,0)
.401
"BLD",5171,"KRN",.402,0)
.402
"BLD",5171,"KRN",.403,0)
.403
"BLD",5171,"KRN",.5,0)
.5
"BLD",5171,"KRN",.84,0)
.84
"BLD",5171,"KRN",3.6,0)
3.6
"BLD",5171,"KRN",3.8,0)
3.8
"BLD",5171,"KRN",9.2,0)
9.2
"BLD",5171,"KRN",9.8,0)
9.8
"BLD",5171,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5171,"KRN",9.8,"NM",1,0)
ECMFECS^^0^B21110690
"BLD",5171,"KRN",9.8,"NM",2,0)
ECHECK1^^0^B9798448
"BLD",5171,"KRN",9.8,"NM","B","ECHECK1",2)

"BLD",5171,"KRN",9.8,"NM","B","ECMFECS",1)

"BLD",5171,"KRN",19,0)
19
"BLD",5171,"KRN",19.1,0)
19.1
"BLD",5171,"KRN",101,0)
101
"BLD",5171,"KRN",409.61,0)
409.61
"BLD",5171,"KRN",771,0)
771
"BLD",5171,"KRN",870,0)
870
"BLD",5171,"KRN",870,"NM",0)
^9.68A^^
"BLD",5171,"KRN",8989.51,0)
8989.51
"BLD",5171,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",5171,"KRN",8989.52,0)
8989.52
"BLD",5171,"KRN",8994,0)
8994
"BLD",5171,"KRN","B",.4,.4)

"BLD",5171,"KRN","B",.401,.401)

"BLD",5171,"KRN","B",.402,.402)

"BLD",5171,"KRN","B",.403,.403)

"BLD",5171,"KRN","B",.5,.5)

"BLD",5171,"KRN","B",.84,.84)

"BLD",5171,"KRN","B",3.6,3.6)

"BLD",5171,"KRN","B",3.8,3.8)

"BLD",5171,"KRN","B",9.2,9.2)

"BLD",5171,"KRN","B",9.8,9.8)

"BLD",5171,"KRN","B",19,19)

"BLD",5171,"KRN","B",19.1,19.1)

"BLD",5171,"KRN","B",101,101)

"BLD",5171,"KRN","B",409.61,409.61)

"BLD",5171,"KRN","B",771,771)

"BLD",5171,"KRN","B",870,870)

"BLD",5171,"KRN","B",8989.51,8989.51)

"BLD",5171,"KRN","B",8989.52,8989.52)

"BLD",5171,"KRN","B",8994,8994)

"BLD",5171,"QUES",0)
^9.62^^
"BLD",5171,"REQB",0)
^9.611^1^1
"BLD",5171,"REQB",1,0)
EC*2.0*49^2
"BLD",5171,"REQB","B","EC*2.0*49",1)

"MBREQ")
0
"PKG",486,-1)
1^1
"PKG",486,0)
EVENT CAPTURE^EC^Event Capture Workload Capture System^
"PKG",486,20,0)
^9.402P^^
"PKG",486,22,0)
^9.49I^1^1
"PKG",486,22,1,0)
2.0^2960508^2981027^66481
"PKG",486,22,1,"PAH",1,0)
55^3031114
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ECHECK1")
0^2^B9798448
"RTN","ECHECK1",1,0)
ECHECK1 ;BIR/MAM,JPW-Categories and Procedures Check ;7 May 96
"RTN","ECHECK1",2,0)
 ;;2.0; EVENT CAPTURE ;**4,33,47,55**;8 May 96
"RTN","ECHECK1",3,0)
CATS ; check number of categories
"RTN","ECHECK1",4,0)
 K ECBUD,EC1,EC23 S CNT=0,ECAT=""
"RTN","ECHECK1",5,0)
 F  S ECAT=$O(^ECJ("AP",ECL,ECD,ECAT)) Q:ECAT=""  D
"RTN","ECHECK1",6,0)
 .S EC2="" F  S EC2=$O(^ECJ("AP",ECL,ECD,ECAT,EC2)) Q:EC2=""  D
"RTN","ECHECK1",7,0)
 ..S EC23=+$O(^ECJ("AP",ECL,ECD,ECAT,EC2,0))
"RTN","ECHECK1",8,0)
 ..I $G(ECCSTA)="",$P($G(^ECJ(+EC23,0)),"^",2) Q
"RTN","ECHECK1",9,0)
 ..S ECBUD(ECAT)=+ECAT_"^"_$S($P($G(^EC(726,+ECAT,0)),"^")]"":$P(^(0),"^"),1:"UNKNOWN")
"RTN","ECHECK1",10,0)
 S ECAT=0 F  S ECAT=$O(ECBUD(ECAT)) Q:'ECAT  S CNT=CNT+1,ECC(CNT)=ECBUD(ECAT)
"RTN","ECHECK1",11,0)
 I '$D(ECC) S ECC(CNT)="0^No Categories"
"RTN","ECHECK1",12,0)
 K EC2,EC23,ECBUD
"RTN","ECHECK1",13,0)
 Q
"RTN","ECHECK1",14,0)
PROS ; check number of procedures
"RTN","ECHECK1",15,0)
 K ^TMP("ECPRO",$J) S CNT=0,ECPROS=""
"RTN","ECHECK1",16,0)
 I ECC F  S ECPROS=$O(^ECJ("AP",ECL,ECD,ECC,ECPROS)) Q:ECPROS=""  D SET
"RTN","ECHECK1",17,0)
 I 'ECC S ECC="" F  S ECC=$O(^ECJ("AP",ECL,ECD,ECC)) Q:ECC=""  F  S ECPROS=$O(^ECJ("AP",ECL,ECD,ECC,ECPROS)) Q:ECPROS=""  D SET
"RTN","ECHECK1",18,0)
ALL ;set info for all proc
"RTN","ECHECK1",19,0)
 S CNT=0 F CNT=0:0 S CNT=$O(^TMP("ECPRO",$J,CNT)) Q:'CNT  D
"RTN","ECHECK1",20,0)
 .S ECPROF=$P(^TMP("ECPRO",$J,CNT),"^"),ECPIEN=$P(^(CNT),"^",2),ECPROPP=+ECPROF,ECPROF=$S(ECPROF["EC":725,ECPROF["ICPT":81,1:"UNKNOWN"),OK=0
"RTN","ECHECK1",21,0)
 .I ECPROF=725 S NODE1=$G(^EC(725,ECPROPP,0)),ECPRONAM=$S($P($G(NODE1),"^")]"":$P(NODE1,"^"),1:"UNKNOWN"),NATN=$P(NODE1,"^",2),OK=1
"RTN","ECHECK1",22,0)
 .I ECPROF=81 S NODE1=$$CPT^ICPTCOD(ECPROPP),ECPRONAM=$S($P($G(NODE1),"^",3)]"":$P(NODE1,"^",3),1:"UNKNOWN"),NATN=$S($P(NODE1,"^",2)]"":$P(NODE1,"^",2),1:"NOT DEFINED"),OK=1
"RTN","ECHECK1",23,0)
 .S:'OK ECPRONAM="UNKNOWN"
"RTN","ECHECK1",24,0)
 .S NODE1=$G(^ECJ(ECPIEN,0)),ECTEMP=$P(NODE1,"^",2)
"RTN","ECHECK1",25,0)
 .;The ECACTIV variable allows users to select inactivate
"RTN","ECHECK1",26,0)
 .;procedures from the Inactivate Event Code Screen option.
"RTN","ECHECK1",27,0)
 .I '$G(ECACTIV)  I ECTEMP,ECTEMP'>DT K ECPIEN,ECPROF,ECPROPP,ECPRONAM,ECTEMP,NODE1,NOD2,SYN,NATN,VOL Q
"RTN","ECHECK1",28,0)
 .S NODE2=$G(^ECJ(ECPIEN,"PRO")),SYN=$S($P(NODE2,"^",2)]"":$P(NODE2,"^",2),1:"NOT DEFINED"),VOL=$P(NODE2,"^",3)
"RTN","ECHECK1",29,0)
 .S ^TMP("ECPRO",$J,CNT)=^TMP("ECPRO",$J,CNT)_"^"_SYN_"^"_ECPRONAM_"^"_NATN_"^"_VOL_"^"_ECPROF_"^"_ECPROPP_"^"_ECTEMP
"RTN","ECHECK1",30,0)
 .S ^TMP("ECPRO",$J,"B",ECPRONAM,CNT)="",^TMP("ECPRO",$J,"SYN",SYN,CNT)="",^TMP("ECPRO",$J,"N",NATN,CNT)=""
"RTN","ECHECK1",31,0)
 K ECPIEN,ECPROF,ECPROPP,ECPRONAM,ECTEMP,NODE1,NODE2,SYN,NATN,VOL
"RTN","ECHECK1",32,0)
 Q
"RTN","ECHECK1",33,0)
SET ;set proc in ^tmp
"RTN","ECHECK1",34,0)
 S ECPIEN=$O(^ECJ("AP",ECL,ECD,ECC,ECPROS,0))
"RTN","ECHECK1",35,0)
 ;The ECACTIV variable allows users to select inactive.
"RTN","ECHECK1",36,0)
 ;procedures from the Inactivate Event Code Screen option.
"RTN","ECHECK1",37,0)
 I '$G(ECACTIV)  I $P($G(^ECJ(ECPIEN,0)),"^",2),$P($G(^ECJ(ECPIEN,0)),"^",2)'>DT Q
"RTN","ECHECK1",38,0)
 ;remove inactive procedures
"RTN","ECHECK1",39,0)
 S NODE1=$S(ECPROS[";ICPT(":+ECPROS,1:$P($G(^EC(725,+ECPROS,0)),U,5))
"RTN","ECHECK1",40,0)
 ; ATG-1003-32110 : By VMP
"RTN","ECHECK1",41,0)
 I NODE1'="" S NODE1=$$CPT^ICPTCOD(NODE1,$G(ECDT)) Q:+NODE1<0  I '$P(NODE1,U,7),'$G(ECACTIV) Q
"RTN","ECHECK1",42,0)
 S CNT=CNT+1
"RTN","ECHECK1",43,0)
 S ^TMP("ECPRO",$J,CNT)=ECPROS_"^"_ECPIEN
"RTN","ECHECK1",44,0)
 Q
"RTN","ECMFECS")
0^1^B21110690
"RTN","ECMFECS",1,0)
ECMFECS ;ALB/JAM-Event Capture Management - Event Code Screen Filer;27 Nov 00
"RTN","ECMFECS",2,0)
 ;;2.0; EVENT CAPTURE ;**25,33,47,55**;8 May 96
"RTN","ECMFECS",3,0)
 ;
"RTN","ECMFECS",4,0)
FILE ;Used by the RPC broker to file EC Code Screens in file #720.3
"RTN","ECMFECS",5,0)
 ;     Variables passed in
"RTN","ECMFECS",6,0)
 ;       ECIEN     - IEN of #720.3, if editing
"RTN","ECMFECS",7,0)
 ;       ECL       - Location
"RTN","ECMFECS",8,0)
 ;       ECD       - DSS Unit
"RTN","ECMFECS",9,0)
 ;       ECC       - Category
"RTN","ECMFECS",10,0)
 ;       ECP       - Procedure
"RTN","ECMFECS",11,0)
 ;       ECST      - Event code screen status
"RTN","ECMFECS",12,0)
 ;       ECSYN     - Synonym
"RTN","ECMFECS",13,0)
 ;       ECVOL     - Volume
"RTN","ECMFECS",14,0)
 ;       ECAC      - Associated Clinic
"RTN","ECMFECS",15,0)
 ;       ECREAS    - Reason indicator
"RTN","ECMFECS",16,0)
 ;       ECRES0..n - array of reasons
"RTN","ECMFECS",17,0)
 ;
"RTN","ECMFECS",18,0)
 ;     Variable return
"RTN","ECMFECS",19,0)
 ;       ^TMP($J,"ECMSG",n)=Success or failure to file in #720.3^Message
"RTN","ECMFECS",20,0)
 ;
"RTN","ECMFECS",21,0)
 N ECCH,ECERR,ECX,ECY,ECFLG,ECR,ECI,X,Y,DIK,DIE
"RTN","ECMFECS",22,0)
 S ECERR=0 D CHKDT I ECERR Q
"RTN","ECMFECS",23,0)
 D VALDATA I ECERR Q
"RTN","ECMFECS",24,0)
 I ECIEN'="" S ECFLG=0,ECX=$G(^ECJ(ECIEN,0)),ECY=$P(ECX,U) D  I ECERR Q
"RTN","ECMFECS",25,0)
 .I ECX="" D  Q
"RTN","ECMFECS",26,0)
 ..S ECERR=1,^TMP($J,"ECMSG",1)="0^Event Code Screen Not on File" Q
"RTN","ECMFECS",27,0)
 .S ECL=$P(ECY,"-"),ECD=$P(ECY,"-",2),ECC=$P(ECY,"-",3),ECP=$P(ECY,"-",4)
"RTN","ECMFECS",28,0)
 .I ECST="A",$P(ECX,U,2)'="" S DA=ECIEN,DIE="^ECJ(",DR="1///@" D ^DIE Q
"RTN","ECMFECS",29,0)
 .I ECST="I",$P(ECX,U,2)="" S $P(^ECJ(ECIEN,0),U,2)=DT
"RTN","ECMFECS",30,0)
 S ECC=$G(ECC,0),ECCH=ECL_"-"_ECD_"-"_ECC_"-"_ECP
"RTN","ECMFECS",31,0)
 I '$P($G(^ECD(ECD,0)),U,11),ECC D  Q
"RTN","ECMFECS",32,0)
 .S ECERR=1,^TMP($J,"ECMSG",1)="0^DSS Unit/Category inconsistency" Q
"RTN","ECMFECS",33,0)
 I ECIEN="" D  I ECERR Q
"RTN","ECMFECS",34,0)
 .I $D(^ECJ("B",ECCH)) D  Q
"RTN","ECMFECS",35,0)
 ..S ECERR=1,^TMP($J,"ECMSG",1)="0^EC Screen Exist" Q
"RTN","ECMFECS",36,0)
 .D NEWIEN
"RTN","ECMFECS",37,0)
 S DA=ECIEN,DIK="^ECJ(",ECREAS=$S(ECREAS="Y":1,1:0) D IX^DIK
"RTN","ECMFECS",38,0)
 S ^ECJ("AP",ECL,ECD,ECC,ECP,ECIEN)="",^ECJ("APP",ECL,ECD,ECP,ECIEN)=""
"RTN","ECMFECS",39,0)
 S $P(^ECJ(ECIEN,"PRO"),U)=ECP,ECAC=$S($G(ECAC)'="":ECAC,1:"@")
"RTN","ECMFECS",40,0)
 S DR="53////"_$S($G(ECSYN)'="":ECSYN,1:"@")_";54////"_$G(ECVOL,1)
"RTN","ECMFECS",41,0)
 S DR=DR_";55////"_$G(ECAC)_";56////"_ECREAS,DIE="^ECJ(",DA=ECIEN
"RTN","ECMFECS",42,0)
 D ^DIE K DA,DR,DIE
"RTN","ECMFECS",43,0)
 I $D(DTOUT) D RECDEL S ^TMP($J,"ECMSG",1)="0^Record not Filed" Q
"RTN","ECMFECS",44,0)
 I ECREAS D
"RTN","ECMFECS",45,0)
 .K DIC,DA,DR,ECX S DIC="^ECL(",DIC(0)="L",DLAYGO=720.5,ECR=0
"RTN","ECMFECS",46,0)
 .F ECI=0:1 S ECX="ECRES"_ECI Q:'$D(@ECX)  S ECR=(@ECX) D
"RTN","ECMFECS",47,0)
 ..Q:ECR=""  I '$D(^ECR(ECR,0)) Q
"RTN","ECMFECS",48,0)
 ..I '$D(^ECL("AD",ECIEN,ECR)) S X=ECR,DIC("DR")=".02////"_ECIEN
"RTN","ECMFECS",49,0)
 ..K DD,DO,DLAYGO D FILE^DICN
"RTN","ECMFECS",50,0)
 S ^TMP($J,"ECMSG",1)="1^Record Filed"_U_ECIEN
"RTN","ECMFECS",51,0)
 Q
"RTN","ECMFECS",52,0)
 ;
"RTN","ECMFECS",53,0)
VALDATA ;validate data
"RTN","ECMFECS",54,0)
 N ECRRX
"RTN","ECMFECS",55,0)
 S DIC="^DIC(4,",DIC(0)="NX",X=ECL D ^DIC I Y=-1 D  Q
"RTN","ECMFECS",56,0)
 .S ECERR=1,^TMP($J,"ECMSG",1)="0^Invalid Location"
"RTN","ECMFECS",57,0)
 S DIC="^ECD(",DIC(0)="NX",X=ECD D ^DIC I Y=-1 D  Q
"RTN","ECMFECS",58,0)
 .S ECERR=1,^TMP($J,"ECMSG",1)="0^Invalid DSS Unit"
"RTN","ECMFECS",59,0)
 I ECC S DIC="^EC(726,",DIC(0)="NX",X=ECC D ^DIC I Y=-1 D  Q
"RTN","ECMFECS",60,0)
 .S ECERR=1,^TMP($J,"ECMSG",1)="0^Invalid Category"
"RTN","ECMFECS",61,0)
 I ECP'="" D  I ECERR Q
"RTN","ECMFECS",62,0)
 .; ATG-1003-32110 : by VMP
"RTN","ECMFECS",63,0)
 .I ECP["ICPT" S ECRRX=$$CPT^ICPTCOD(+ECP) I +ECRRX>0 Q:$G(ECIEN)  I $P(ECRRX,U,7) Q
"RTN","ECMFECS",64,0)
 .I ECP["EC",$D(^EC(725,+ECP,0)) Q
"RTN","ECMFECS",65,0)
 .S ECERR=1,^TMP($J,"ECMSG",1)="0^Invalid Procedure"
"RTN","ECMFECS",66,0)
 I $G(ECAC)'="" D CHK^DIE(720.3,55,"E","`"_ECAC,.ECRRX) I ECRRX'=ECAC D  Q
"RTN","ECMFECS",67,0)
 .S ECERR=1,^TMP($J,"ECMSG",1)="0^Invalid Associated Clinic"
"RTN","ECMFECS",68,0)
 I $G(ECSYN)'="" D CHK^DIE(720.3,53,"E",ECSYN,.ECRRX) I ECRRX'=ECSYN D  Q
"RTN","ECMFECS",69,0)
 .S ECERR=1,^TMP($J,"ECMSG",1)="0^Invalid Synonym"
"RTN","ECMFECS",70,0)
 I "^N^Y^"'[U_ECREAS_U D  Q
"RTN","ECMFECS",71,0)
 .S ECERR=1,^TMP($J,"ECMSG",1)="0^Invalid Reason Response"
"RTN","ECMFECS",72,0)
 Q
"RTN","ECMFECS",73,0)
RECDEL ; Delete record
"RTN","ECMFECS",74,0)
 I ECFLG S DA=ECIEN,DIK="^ECJ(" D ^DIK K DA,DIK
"RTN","ECMFECS",75,0)
 Q
"RTN","ECMFECS",76,0)
 ;
"RTN","ECMFECS",77,0)
NEWIEN ;Create new IEN in file #720.3
"RTN","ECMFECS",78,0)
 N DIC,DA,DD,DO
"RTN","ECMFECS",79,0)
 L +^ECJ(0)
"RTN","ECMFECS",80,0)
 S X=ECCH,DIC="^ECJ(",DIC(0)="L",DLAYGO=720.3 D FILE^DICN
"RTN","ECMFECS",81,0)
 L -^ECJ(0)
"RTN","ECMFECS",82,0)
 S ECIEN=+Y,$P(^ECJ(ECIEN,0),U,3)=DT,$P(^ECJ(ECIEN,"PRO"),U)=ECP
"RTN","ECMFECS",83,0)
 I ECST="I" S $P(^ECJ(ECIEN,0),U,2)=DT
"RTN","ECMFECS",84,0)
 Q
"RTN","ECMFECS",85,0)
CHKDT ;Required Data Check
"RTN","ECMFECS",86,0)
 N I,C
"RTN","ECMFECS",87,0)
 S C=1
"RTN","ECMFECS",88,0)
 F I="ECL","ECD","ECC","ECP","ECREAS" D
"RTN","ECMFECS",89,0)
 .I $G(@I)="" S ^TMP($J,"ECMSG",C)="0^Key data missing "_I,C=C+1,ECERR=1
"RTN","ECMFECS",90,0)
 Q
"RTN","ECMFECS",91,0)
REASON ;Used by the RPC broker to file EC Reasons in file #720.4
"RTN","ECMFECS",92,0)
 ;     Variables passed in
"RTN","ECMFECS",93,0)
 ;       ECIEN     - IEN of #720.4, if editing
"RTN","ECMFECS",94,0)
 ;       ECRES     - Reason
"RTN","ECMFECS",95,0)
 ;       ECST      - Reason status
"RTN","ECMFECS",96,0)
 ;
"RTN","ECMFECS",97,0)
 ;     Variable return
"RTN","ECMFECS",98,0)
 ;       ^TMP($J,"ECMSG",n)=Success or failure to file in #720.4^Message
"RTN","ECMFECS",99,0)
 ;
"RTN","ECMFECS",100,0)
 N ECOST,ECERR,ECFLG,X,Y,DIC,DIE
"RTN","ECMFECS",101,0)
 S ECERR=0 I $G(ECRES)="" D  I ECERR Q
"RTN","ECMFECS",102,0)
 .S ^TMP($J,"ECMSG",1)="0^Key data missing - Reason",ECERR=1
"RTN","ECMFECS",103,0)
 D CHK^DIE(720.4,.01,,ECRES,.ECRRX) I ECRRX="^" D  Q
"RTN","ECMFECS",104,0)
 .S ^TMP($J,"ECMSG",1)="0^Invalid Reason",ECERR=1
"RTN","ECMFECS",105,0)
 S ECST=$G(ECST,"A")
"RTN","ECMFECS",106,0)
 I "^I^A^"'[U_ECST_U S ^TMP($J,"ECMSG",1)="0^Invalid Reason Status" Q
"RTN","ECMFECS",107,0)
 S ECST=$S(ECST="I":0,1:1),ECIEN=$G(ECIEN),ECFLG=1
"RTN","ECMFECS",108,0)
 I ECIEN'="" S ECFLG=0 I $G(^ECR(ECIEN,0))="" D  I ECERR K ECST Q
"RTN","ECMFECS",109,0)
 .S ECERR=1,^TMP($J,"ECMSG",1)="0^Reason Not on File" Q
"RTN","ECMFECS",110,0)
 I ECIEN="" D  I ECERR K ECST Q
"RTN","ECMFECS",111,0)
 .I $D(^ECR("B",ECRES)) S ECERR=1,^TMP($J,"ECMSG",1)="0^Reason Exist" Q
"RTN","ECMFECS",112,0)
 .K DIE,DR,DA
"RTN","ECMFECS",113,0)
 .L +^ECR(0)
"RTN","ECMFECS",114,0)
 .S X=ECRES,DIC="^ECR(",DIC(0)="L",DLAYGO=720.4 D FILE^DICN
"RTN","ECMFECS",115,0)
 .L -^ECR(0)
"RTN","ECMFECS",116,0)
 .S ECIEN=+Y
"RTN","ECMFECS",117,0)
 S ECOST=$P($G(^ECR(ECIEN,0)),U,2)
"RTN","ECMFECS",118,0)
 I ECST'=ECOST D
"RTN","ECMFECS",119,0)
 .S DIE=DIC,DA=ECIEN,DR=".02////"_ECST D ^DIE
"RTN","ECMFECS",120,0)
 S ^TMP($J,"ECMSG",1)="1^Reason Filed"_U_ECIEN K ECST
"RTN","ECMFECS",121,0)
 Q
"VER")
8.0^22
**END**
**END**
