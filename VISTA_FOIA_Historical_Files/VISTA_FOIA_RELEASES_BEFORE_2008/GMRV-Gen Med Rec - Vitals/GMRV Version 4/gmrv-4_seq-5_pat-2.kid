Released GMRV*4*2 SEQ #5
Extracted from mail message
**KIDS**:GMRV*4.0*2^

**INSTALL NAME**
GMRV*4.0*2
"BLD",1170,0)
GMRV*4.0*2^GEN. MED. REC. - VITALS^0^2980828^y
"BLD",1170,1,0)
^^2^2^2970714^
"BLD",1170,1,1,0)
Please check the patch description on FORUM for GMRV*4*2 for an
"BLD",1170,1,2,0)
explanation of this patch.
"BLD",1170,4,0)
^9.64PA^^
"BLD",1170,"INIT")
GMRV2POS
"BLD",1170,"KRN",0)
^9.67PA^19^16
"BLD",1170,"KRN",.4,0)
.4
"BLD",1170,"KRN",.401,0)
.401
"BLD",1170,"KRN",.402,0)
.402
"BLD",1170,"KRN",.403,0)
.403
"BLD",1170,"KRN",.5,0)
.5
"BLD",1170,"KRN",.84,0)
.84
"BLD",1170,"KRN",3.6,0)
3.6
"BLD",1170,"KRN",3.8,0)
3.8
"BLD",1170,"KRN",9.2,0)
9.2
"BLD",1170,"KRN",9.8,0)
9.8
"BLD",1170,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",1170,"KRN",9.8,"NM",1,0)
GMRVOREQ^^0^B42536143
"BLD",1170,"KRN",9.8,"NM",2,0)
GMRVORDG^^0^B8388414
"BLD",1170,"KRN",9.8,"NM",3,0)
GMRV2POS^^0^B2258959
"BLD",1170,"KRN",9.8,"NM",4,0)
GMRVENV2^^0^B946806
"BLD",1170,"KRN",9.8,"NM","B","GMRV2POS",3)

"BLD",1170,"KRN",9.8,"NM","B","GMRVENV2",4)

"BLD",1170,"KRN",9.8,"NM","B","GMRVORDG",2)

"BLD",1170,"KRN",9.8,"NM","B","GMRVOREQ",1)

"BLD",1170,"KRN",19,0)
19
"BLD",1170,"KRN",19.1,0)
19.1
"BLD",1170,"KRN",101,0)
101
"BLD",1170,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",1170,"KRN",101,"NM",1,0)
GMRVORPR B/P^^0
"BLD",1170,"KRN",101,"NM",2,0)
GMRVORPB/P^^0
"BLD",1170,"KRN",101,"NM","B","GMRVORPB/P",2)

"BLD",1170,"KRN",101,"NM","B","GMRVORPR B/P",1)

"BLD",1170,"KRN",409.61,0)
409.61
"BLD",1170,"KRN",771,0)
771
"BLD",1170,"KRN",8994,0)
8994
"BLD",1170,"KRN","B",.4,.4)

"BLD",1170,"KRN","B",.401,.401)

"BLD",1170,"KRN","B",.402,.402)

"BLD",1170,"KRN","B",.403,.403)

"BLD",1170,"KRN","B",.5,.5)

"BLD",1170,"KRN","B",.84,.84)

"BLD",1170,"KRN","B",3.6,3.6)

"BLD",1170,"KRN","B",3.8,3.8)

"BLD",1170,"KRN","B",9.2,9.2)

"BLD",1170,"KRN","B",9.8,9.8)

"BLD",1170,"KRN","B",19,19)

"BLD",1170,"KRN","B",19.1,19.1)

"BLD",1170,"KRN","B",101,101)

"BLD",1170,"KRN","B",409.61,409.61)

"BLD",1170,"KRN","B",771,771)

"BLD",1170,"KRN","B",8994,8994)

"BLD",1170,"PRE")
GMRVENV2
"BLD",1170,"QUES",0)
^9.62^^
"BLD",1170,"REQB",0)
^9.611^^
"INIT")
GMRV2POS
"KRN",101,4363,-1)
0^1
"KRN",101,4363,0)
GMRVORPR B/P^Pulse/Resp/BP^^O^^^^^^^^GEN. MED. REC. - VITALS
"KRN",101,4363,10,0)
^101.01PA^3^3
"KRN",101,4363,20)
Q:$S('$D(^ORD(100.99)):1,'$D(^PS(59.7,1,20)):1,1:^(20)<2.8)  D EN1^GMRVORE0
"KRN",101,4363,99)
57566,33734
"KRN",101,4364,-1)
0^2
"KRN",101,4364,0)
GMRVORPB/P^Pulse-Blood Pressure^^O^^^^^^^^GEN. MED. REC. - VITALS
"KRN",101,4364,10,0)
^101.01PA^2^2
"KRN",101,4364,20)
Q:$S('$D(^ORD(100.99)):1,'$D(^PS(59.7,1,20)):1,1:^(20)<2.8)  D EN1^GMRVORE0
"KRN",101,4364,99)
57566,33734
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",44,-1)
1^1
"PKG",44,0)
GEN. MED. REC. - VITALS^GMRV^Vitals/Measurements Module of General Medical Record.
"PKG",44,22,0)
^9.49I^1^1
"PKG",44,22,1,0)
4.0^2970425^2970702^64
"PKG",44,22,1,"PAH",1,0)
2^2980828^4558
"PKG",44,22,1,"PAH",1,1,0)
^^2^2^2980828
"PKG",44,22,1,"PAH",1,1,1,0)
Please check the patch description on FORUM for GMRV*4*2 for an
"PKG",44,22,1,"PAH",1,1,2,0)
explanation of this patch.
"PRE")
GMRVENV2
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","GMRV2POS")
0^3^B2258959
"RTN","GMRV2POS",1,0)
GMRV2POS ;HIRMFO/FT-Clean up old DD and data nodes in 120.5
"RTN","GMRV2POS",2,0)
 ;;4.0;Vitals/Measurements;**2**;Apr 25, 1997
"RTN","GMRV2POS",3,0)
EN1 ; delete old data dictionary nodes in DD(120.505
"RTN","GMRV2POS",4,0)
 ; and delete any data in those fields
"RTN","GMRV2POS",5,0)
 S X="ALERT^GMRV2POS",@^%ZOSF("TRAP")
"RTN","GMRV2POS",6,0)
 S DA=.01,DIK="^DD(120.505,",GMRVFLAG=0,DA(1)=120.505
"RTN","GMRV2POS",7,0)
 F  S DA=$O(^DD(120.505,DA)) Q:'DA  D
"RTN","GMRV2POS",8,0)
 .W:'$D(ZTQUEUED) !,"Deleting ^DD(120.505,",DA
"RTN","GMRV2POS",9,0)
 .D ^DIK S GMRVFLAG=1
"RTN","GMRV2POS",10,0)
 .Q
"RTN","GMRV2POS",11,0)
 I GMRVFLAG=1 S DA(1)=0 F  S DA(1)=$O(^GMR(120.5,DA(1))) Q:'DA(1)  S DA=0 F  S DA=$O(^GMR(120.5,DA(1),5,DA)) Q:'DA  D
"RTN","GMRV2POS",12,0)
 .S GMRVNODE=$G(^GMR(120.5,DA(1),5,DA,0))
"RTN","GMRV2POS",13,0)
 .Q:$G(GMRVNODE)=""
"RTN","GMRV2POS",14,0)
 .Q:($P(GMRVNODE,U,2)=""&($P(GMRVNODE,U,3)="")&($P(GMRVNODE,U,4)=""))
"RTN","GMRV2POS",15,0)
 .W:'$D(ZTQUEUED) !,"Fixing ^DD(120.5,"_DA(1)_",5,"_DA_",0)"
"RTN","GMRV2POS",16,0)
 .S GMRVPCE1=$P(GMRVNODE,U,1)
"RTN","GMRV2POS",17,0)
 .S ^GMR(120.5,DA(1),5,DA,0)=GMRVPCE1
"RTN","GMRV2POS",18,0)
 .Q
"RTN","GMRV2POS",19,0)
 K DA,DIK,GMRVFLAG,GMRVNODE,GMRVPCE1,X,Y
"RTN","GMRV2POS",20,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","GMRV2POS",21,0)
 Q
"RTN","GMRV2POS",22,0)
QUEUE ; queue clean up to run in the background
"RTN","GMRV2POS",23,0)
 S ZTDTH=$$HADD^XLFDT($H,"","","",60),ZTDESC="GMRV*4*2 DD/DATA CLEAN UP"
"RTN","GMRV2POS",24,0)
 S ZTRTN="EN1^GMRV2POS",(ZTIO,ZTSAVE("DUZ"))=""
"RTN","GMRV2POS",25,0)
 D ^%ZTLOAD
"RTN","GMRV2POS",26,0)
 Q
"RTN","GMRV2POS",27,0)
ALERT ; Set up ALERT variables if clean up bombs out
"RTN","GMRV2POS",28,0)
 S XQA(DUZ)="",XQAMSG="GMRV*4*2 DD/DATA CLEANUP HAS ABORTED"
"RTN","GMRV2POS",29,0)
 D SETUP^XQALERT
"RTN","GMRV2POS",30,0)
 Q
"RTN","GMRVENV2")
0^4^B946806
"RTN","GMRVENV2",1,0)
GMRVENV2 ;CIOFO/NCA - Environment Check Routine For Patch 2
"RTN","GMRVENV2",2,0)
 ;;4.0;Vitals/Measurements;**2**;Apr 25, 1997
"RTN","GMRVENV2",3,0)
 I +$$VERSION^XPDUTL("OR")=2.5 Q
"RTN","GMRVENV2",4,0)
 I +$$PATCH^XPDUTL("OR*3.0*14") Q
"RTN","GMRVENV2",5,0)
 D MES^XPDUTL("You Do Not Have Patch OR*3*14 installed.  You can still install this patch")
"RTN","GMRVENV2",6,0)
 D MES^XPDUTL("BUT you can not convert the two Vital protocols with the")
"RTN","GMRVENV2",7,0)
 D MES^XPDUTL("option Convert Protocols, [ORCM PROTOCOLS].")
"RTN","GMRVENV2",8,0)
 Q
"RTN","GMRVORDG")
0^2^B8388414
"RTN","GMRVORDG",1,0)
GMRVORDG ;HIRMFO/RM-DGOERR EVENT DRIVER INTERFACE. ;4/2/96
"RTN","GMRVORDG",2,0)
 ;;4.0;Vitals/Measurements;**2**;Apr 25, 1997
"RTN","GMRVORDG",3,0)
EN4 ; ENTRY FROM DGPM MOVEMENT EVENTS PROTOCOL
"RTN","GMRVORDG",4,0)
 G Q4:$G(DGPMA)=""!("^1^2^3^22^23^24^25^"[("^"_$P($G(DGPMA),"^",18)_"^")) S GMRVDGZN=$P($G(DGPMA),"^")_"^"_$P($G(DGPMA),"^",6),GMRVDGZN(0)=$P($G(DGPMP),"^")_"^"_$P($G(DGPMP),"^",6) G Q4:GMRVDGZN=GMRVDGZN(0)
"RTN","GMRVORDG",5,0)
 S GMRVDGDT=$P($G(DGPMA),"^"),GMRVOE=$S("^1^3^4^5^"[("^"_$P($G(DGPMA),"^",2)_"^")&($P($G(DGPMA),"^",18)'=41):1,$P($G(DGPMA),"^",2)=2!($P($G(DGPMA),"^",18)=41):0,1:"") G:GMRVOE="" Q4
"RTN","GMRVORDG",6,0)
 D DCALL:GMRVOE,DCHK:'GMRVOE
"RTN","GMRVORDG",7,0)
Q4 K GMRVDGZN,GMRVDGDT,GMRVOE D KVAR^VADPT
"RTN","GMRVORDG",8,0)
 Q
"RTN","GMRVORDG",9,0)
DCALL ; DC ALL NON-DC'D ORDERS
"RTN","GMRVORDG",10,0)
 S ORUPKG=$O(^ORD(100.98,"B","VITALS/MEASUREMENTS",0)) G Q4:'ORUPKG
"RTN","GMRVORDG",11,0)
 S GMRVP=DFN_";DPT("
"RTN","GMRVORDG",12,0)
 F GMRX=0:0 S GMRX=$O(^OR(100,"AO",GMRVP,GMRX)) Q:GMRX'>0  F GMRVORDA=0:0 S GMRVORDA=$O(^OR(100,"AO",GMRVP,GMRX,ORUPKG,GMRVORDA)) Q:GMRVORDA'>0  D DC
"RTN","GMRVORDG",13,0)
 K GMRVORDA,GMRVP,GMRVSTAT,GMRVX,GMRVSTDT,ORIFN,ORUPKG
"RTN","GMRVORDG",14,0)
 Q
"RTN","GMRVORDG",15,0)
DC ; CHANGE ORDER STATUS IF NECESSARY
"RTN","GMRVORDG",16,0)
 K ORUPCHUK
"RTN","GMRVORDG",17,0)
 D EN^ORX8(GMRVORDA)
"RTN","GMRVORDG",18,0)
 S GMRVSTDT=+ORUPCHUK("ORSTRT"),GMRVSTAT=+ORUPCHUK("ORSTS")
"RTN","GMRVORDG",19,0)
 K ORUPCHUK
"RTN","GMRVORDG",20,0)
 Q:GMRVSTAT=1!(GMRVSTAT=2)!(GMRVSTDT>GMRVDGDT&(GMRVSTAT'=8))  S ORIFN=GMRVORDA
"RTN","GMRVORDG",21,0)
 I GMRVSTAT'=8 D NOW^%DTC S ORETURN("ORSTS")=1,ORETURN("ORSTOP")=%,ORETURN("OREVENT")="" D:GMRVSTAT'=11 RETURN^ORX K %,%H,ORETURN
"RTN","GMRVORDG",22,0)
 I GMRVSTAT=8 S ORSTS="K" D ST^ORX K ORSTS
"RTN","GMRVORDG",23,0)
 Q
"RTN","GMRVORDG",24,0)
DCHK ; CHECK TO SEE IF ORDERS NEED TO BE DC'D
"RTN","GMRVORDG",25,0)
 S GMRVSITE=$O(^GMRD(120.57,"B","HOSPITAL",0)),GMRVSITE(0)=$S($D(^GMRD(120.57,+GMRVSITE,0)):^(0),1:"") G QCHK:'$P(GMRVSITE(0),"^",3)&'$P(GMRVSITE(0),"^",4)
"RTN","GMRVORDG",26,0)
 S X=GMRVDGDT D H^%DTC S %H=%H_","_(%T-1) D YMD^%DTC S VAINDT=X_$S(%:%,1:"")
"RTN","GMRVORDG",27,0)
 D INP^VADPT S GMRVWRD(0)=VAIN(4) S VAINDT=GMRVDGDT D INP^VADPT S GMRVWRD(1)=VAIN(4)
"RTN","GMRVORDG",28,0)
 I $P(GMRVSITE(0),"^",3),+GMRVWRD(0)'=+GMRVWRD(1) D DCALL G QCHK
"RTN","GMRVORDG",29,0)
 I $P(GMRVSITE(0),"^",4) S GMRVSRV(0)=$S($D(^DIC(42,+GMRVWRD(0),0)):$P(^(0),"^",3),1:""),GMRVSRV(1)=$S($D(^DIC(42,+GMRVWRD(1),0)):$P(^(0),"^",3),1:"") I GMRVSRV(0)'=GMRVSRV(1) D DCALL
"RTN","GMRVORDG",30,0)
QCHK K GMRVSITE,GMRVWRD,GMRVSRV
"RTN","GMRVORDG",31,0)
 Q
"RTN","GMRVOREQ")
0^1^B42536143
"RTN","GMRVOREQ",1,0)
GMRVOREQ ;HIRMFO/MD,FT-QUICK ORDER PROTOCOL CREATION ;11/11/96  11:02
"RTN","GMRVOREQ",2,0)
 ;;4.0;Vitals/Measurements;**2**;Apr 25, 1997
"RTN","GMRVOREQ",3,0)
EN1 ; ENTRY TO CREATE QUICK ORDER PROTOCOL
"RTN","GMRVOREQ",4,0)
 S GMRVDEF="",GMRVOLD=0,DIC=101,DIC(0)="AEQS",D="C"
"RTN","GMRVOREQ",5,0)
 S DIC("S")="S GMRV=$P(^(0),U) I ""^GMRVORCG^GMRVORPO^GMRVORCVP^GMRVORTPR^GMRVORTPR B/P^GMRVORADMIT V/M^GMRVORPULSE^GMRVORB/P^GMRVORWT^GMRVORTEMP^GMRVORRESP^GMRVORHT^GMRVORPR B/P^GMRVORPB/P^""[(""^""_GMRV_""^"")!(GMRV[""GMRVORQ"")"
"RTN","GMRVOREQ",6,0)
 S DIC("A")="Select PROTOCOL to be added as a QUICK PROTOCOL: " D IX^DIC G QUIT:+Y'>0 S GMRVDA=+Y K GMRVPROT
"RTN","GMRVOREQ",7,0)
 I $S($D(^ORD(101,+Y,0))&($P(^(0),U)["GMRVORQ"):1,1:0) S GMRVOLD=1,GMRVDEF=$P(^(20),"""",2) G DEF
"RTN","GMRVOREQ",8,0)
ASK S X=$P($G(^ORD(101,+Y,0)),"^",2) W !!,$C(7),"DO YOU WANT TO ADD "_X_" AS A QUICK ORDER PROTOCOL" S %=1 D YN^DICN W:'% !?4,"ANSWER YES OR NO." G ASK:'%,EN1:%=2,QUIT:%=-1
"RTN","GMRVOREQ",9,0)
 S %X="^ORD(101,"_+GMRVDA_",",%Y="GMRVPROT(" D %XY^%RCR
"RTN","GMRVOREQ",10,0)
LOCK L +^GMRD(120.57,1,"Q0"):1
"RTN","GMRVOREQ",11,0)
YNWAIT I '$T W !,$C(7),"SOMEONE ELSE IS ADDING QUICK ORDER PROTOCOLS,","WOULD YOU LIKE TO WAIT UNTIL THEY FINISH" S %=1 D YN^DICN W:'% !?4,"ANSWER YES OR NO." G YNWAIT:'%,LOCK:%=1,QUIT
"RTN","GMRVOREQ",12,0)
 S GMRVPNUM=+$P($G(^GMRD(120.57,1,"Q0")),"^") F GMRVPNUM=GMRVPNUM:1 S GMRVPNAM="GMRVORQ"_GMRVPNUM Q:'$O(^ORD(101,"B",GMRVPNAM))
"RTN","GMRVOREQ",13,0)
DEF D SETUP I GMROUT L -^GMRD(120.57,1,"Q0") G QUIT
"RTN","GMRVOREQ",14,0)
 D:GMRVOLD=0 ADDNEW ;add a new entry to file 101
"RTN","GMRVOREQ",15,0)
 D:GMRVOLD=1 UPDATE ;update an existing entry in file 101
"RTN","GMRVOREQ",16,0)
 L -^GMRD(120.57,1,"Q0")
"RTN","GMRVOREQ",17,0)
QUIT ;
"RTN","GMRVOREQ",18,0)
 K %,%DT,%X,%Y,D,DA,DIC,DIE,DIK,DIR,DLAYGO,DR,DUOUT,GMROUT,GMRV,GMRVANSR,GMRVAS,GMRVDA,GMRVDEF,GMRVDEL,GMRVDF,GMRVOAS,GMRVOLD,GMRVORD,GMRVPNAM,GMRVPNUM,GMRVPROT,GMRVQUES,GMRVSTRT,GMRVX,GMRVY,OREA,ORTX,TEXT,X,Y,Z,ZX,ZY
"RTN","GMRVOREQ",19,0)
 D ^%ZISC
"RTN","GMRVOREQ",20,0)
 Q
"RTN","GMRVOREQ",21,0)
SETUP ; ASK USERS WHETHER TO ASK QUESTION OR STUFF ANSWER
"RTN","GMRVOREQ",22,0)
 ;
"RTN","GMRVOREQ",23,0)
 ;    GMRVANSR=START^STOP^SCHEDULE^SPECIAL INSTRUCTIONS
"RTN","GMRVOREQ",24,0)
 ;          WHERE "" MEANS ASK NO DEFAULT
"RTN","GMRVOREQ",25,0)
 ;                VALUE MEANS ASK WITH DEFAULT OF VALUE
"RTN","GMRVOREQ",26,0)
 ;                ~VALUE MEANS NO ASK STUFF VALUE
"RTN","GMRVOREQ",27,0)
 ;
"RTN","GMRVOREQ",28,0)
 W !!,"These are the Vital Measurement Quick Order Questions:",! F Y=1:1:4 W !,?3,Y_". ",$P($T(TEXT+Y),";",3)
"RTN","GMRVOREQ",29,0)
 I GMRVOLD=1 S GMRVANSR=GMRVDEF
"RTN","GMRVOREQ",30,0)
 S (GMRVDEL,GMROUT)=0,DIR("A")="Select the question(s) that require special action",DIR(0)="L^1:4",DIR("?")="Enter question selection(s)" D ^DIR I $D(DIRUT) S GMROUT=1 Q
"RTN","GMRVOREQ",31,0)
 I GMRVOLD=0,Y'[3 W !!,$C(7),"An Admin. Schedule is required for Vital Measurement Quick Order Protocols!" G SETUP
"RTN","GMRVOREQ",32,0)
 S GMRVX=0,(GMRVSTRT,GMRVY)="" K GMRVLIST
"RTN","GMRVOREQ",33,0)
 F Z=1:1 Q:$P(Y,",",Z)=""  S GMRVLIST($P(Y,",",Z))=""
"RTN","GMRVOREQ",34,0)
 S (GMRVCNT,Z)=0
"RTN","GMRVOREQ",35,0)
 F  S Z=$O(GMRVLIST(Z)) Q:Z'>0  S GMRVCNT=GMRVCNT+1,$P(GMRVY,",",GMRVCNT)=Z
"RTN","GMRVOREQ",36,0)
 K GMRVCNT,GMRVLIST
"RTN","GMRVOREQ",37,0)
 F Z(0)=1:1 S Z=$P(GMRVY,",",Z(0)) Q:Z'>0  D ASKDEF Q:GMROUT  X $P($T(TEXT+Z),";",4) I $D(X),'+GMRVDEL S $P(GMRVANSR,"^",Z)=$S(+GMRVDEL:"",GMRVX=1:X,GMRVX=2:"~"_X,1:"") S:Z=1 GMRVSTRT=Y K GMRVX
"RTN","GMRVOREQ",38,0)
 I 'GMROUT S OREA="S GMRVANSR="""_GMRVANSR_""",GMRVKWIK=1 D DATE^GMRVOREQ Q:$S('$D(^ORD(100.99)):1,'$D(^PS(59.7,1,20)):1,1:^(20)<2.8)  D EN1^GMRVORE0"
"RTN","GMRVOREQ",39,0)
 Q
"RTN","GMRVOREQ",40,0)
DATE ; MAKE SURE THE DEFAULT ANSWERS ARE FM DATES
"RTN","GMRVOREQ",41,0)
 ;
"RTN","GMRVOREQ",42,0)
 I $P(GMRVANSR,U)'="" S Z=$P(GMRVANSR,U),X=$S(Z?1"~".E:$P(Z,"~",2,999),1:Z),%DT="T" D ^%DT S $P(GMRVANSR,U)=$E("~",Z["~")_Y
"RTN","GMRVOREQ",43,0)
 I $P(GMRVANSR,U,2)'="" S Z=$P(GMRVANSR,U,2),X=$S(Z?1"~".E:$P(Z,"~",2,999),1:Z),%DT="T" D ^%DT S $P(GMRVANSR,U,2)=$E("~",Z["~")_Y
"RTN","GMRVOREQ",44,0)
 Q
"RTN","GMRVOREQ",45,0)
SCH ;ADD SCHEDULE
"RTN","GMRVOREQ",46,0)
 S GMRVANSR=$S($D(GMRVANSR):GMRVANSR,1:""),ZY=$P(GMRVDEF,U,3),GMRVAS=$S(ZY'="":$P(ZY,"~",ZY["~"+1),1:$P(GMRVANSR,U,3)) D ADS^GMRVORC0
"RTN","GMRVOREQ",47,0)
 Q
"RTN","GMRVOREQ",48,0)
ASKDEF ;
"RTN","GMRVOREQ",49,0)
 S GMRVQUES=$P($T(TEXT+Z),";",3) W !,"Choose one of the following:",!?5,"1. Ask "_GMRVQUES_"with a DEFAULT value",!,?5,"2. Automatically Enter "_GMRVQUES
"RTN","GMRVOREQ",50,0)
 W !,"Select 1 or 2: " R GMRVX:DTIME I "^"[GMRVX S GMROUT=1 Q
"RTN","GMRVOREQ",51,0)
ASK1 I GMRVX'=1&(GMRVX'=2) W !!?5,$C(7),"Enter '1' to ask question with default value.",!?11,"'2' to not ask the question and automatically enter the default.",! G ASKDEF
"RTN","GMRVOREQ",52,0)
 I '(Z=3) S ZX=$P(GMRVDEF,U,Z) W !,"Enter default value: "_$S(ZX'="":$P(ZX,"~",ZX["~"+1)_"// ",1:"") R X:DTIME I '(Z>2),X["?" S %DT="ET",%DT(0)=$S(Z=1:"N",1:$P(GMRVSTRT,"~",GMRVSTRT["~"+1)) D HELP^%DTC
"RTN","GMRVOREQ",53,0)
 G:X["?" ASK1 I X="^"!(X=""&($G(ZX)="")) S GMROUT=1
"RTN","GMRVOREQ",54,0)
 I X="" S X=$P(ZX,"~",ZX["~"+1)
"RTN","GMRVOREQ",55,0)
 I X="@" S GMRVDEL=1
"RTN","GMRVOREQ",56,0)
 Q
"RTN","GMRVOREQ",57,0)
TEXT ;
"RTN","GMRVOREQ",58,0)
 ;;START/Date ;Q:X="@"  S %DT="ET",%DT(0)=DT D ^%DT I Y<1 K X D HELP^%DTC S Z(0)=Z(0)-1
"RTN","GMRVOREQ",59,0)
 ;;STOP/Date ;Q:X="@"  S %DT="ET",%DT(0)=$P(GMRVSTRT,"~",GMRVSTRT["~"+1) K:'$L(%DT(0)) %DT(0) D ^%DT I Y<1 K X D HELP^%DTC S Z(0)=Z(0)-1
"RTN","GMRVOREQ",60,0)
 ;;Administrative Schedule ;D SCH
"RTN","GMRVOREQ",61,0)
 ;;Special Instructions ;Q:X="@"  I $L(X)<3!($L(X)>100) K X W *7,!,"Answer must be 3-100 characters in length" S Z(0)=Z(0)-1
"RTN","GMRVOREQ",62,0)
 Q
"RTN","GMRVOREQ",63,0)
 ;
"RTN","GMRVOREQ",64,0)
UPDATE ; update existing entry
"RTN","GMRVOREQ",65,0)
 S GMRVOAS=$P(^ORD(101,+GMRVDA,20),""",GMRVKWIK") ;get old Admin Schedule
"RTN","GMRVOREQ",66,0)
 S GMRVOAS=$P(GMRVOAS,"^",3) S:GMRVOAS["~" GMRVOAS=$P(GMRVOAS,"~",2)
"RTN","GMRVOREQ",67,0)
 S GMRVAS=$S($E($P(GMRVANSR,"^",3))="~":$E($P(GMRVANSR,"^",3),2,99),1:$P(GMRVANSR,"^",3)) ;get new Admin Schedule
"RTN","GMRVOREQ",68,0)
 I GMRVAS]"",GMRVOAS'=GMRVAS W !!,"You changed the Administration Schedule to ",GMRVAS,!,"You should edit the ITEM TEXT.",!
"RTN","GMRVOREQ",69,0)
IT0 ; item text
"RTN","GMRVOREQ",70,0)
 K DIR S DIR(0)="101,1",(GMRVDIRB,DIR("B"))=$P(^ORD(101,+GMRVDA,0),U,2)
"RTN","GMRVOREQ",71,0)
 D ^DIR
"RTN","GMRVOREQ",72,0)
 Q:$D(DIRUT)
"RTN","GMRVOREQ",73,0)
 I GMRVDIRB'=Y,$D(^ORD(101,"C",Y)) W !!,$C(7),"A Quick Order Protocol with an ITEM TEXT of ",!,Y," already exists.",!,"Please edit the ITEM TEXT value to make it unique.",!! G IT0
"RTN","GMRVOREQ",74,0)
 S GMRVPROT("QUICK TEXT")=Y
"RTN","GMRVOREQ",75,0)
 S DIE="^ORD(101,",DA=+GMRVDA,DR="1///"_GMRVPROT("QUICK TEXT")_";20////^S X=OREA" D ^DIE ;stuff item text and entry action
"RTN","GMRVOREQ",76,0)
 Q
"RTN","GMRVOREQ",77,0)
ADDNEW ; add new entry
"RTN","GMRVOREQ",78,0)
 S GMRVPROT("QUICK TEXT")="QUICK "_$S($E($P(GMRVANSR,"^",3))="~":$E($P(GMRVANSR,"^",3),2,99),1:$P(GMRVANSR,"^",3))_" "_$S($P($G(GMRVPROT(0)),"^",2)'="":$P(GMRVPROT(0),"^",2),1:"")
"RTN","GMRVOREQ",79,0)
 K DIR S DIR(0)="101,1",DIR("B")=GMRVPROT("QUICK TEXT") D ^DIR
"RTN","GMRVOREQ",80,0)
 Q:$D(DIRUT)
"RTN","GMRVOREQ",81,0)
 S GMRVPROT("QUICK TEXT")=Y
"RTN","GMRVOREQ",82,0)
 I $D(^ORD(101,"C",GMRVPROT("QUICK TEXT"))) W !!,$C(7),"A Quick Order Protocol with an ITEM TEXT of ",!,GMRVPROT("QUICK TEXT")," already exists.",!,"Please edit the ITEM TEXT value to make it unique.",!! G ADDNEW
"RTN","GMRVOREQ",83,0)
 S $P(GMRVPROT(0),"^",1,2)=GMRVPNAM_"^"_GMRVPROT("QUICK TEXT"),$P(GMRVPROT(0),"^",5)=DUZ,GMRVPROT(20)=OREA,$P(GMRVPROT(99),"^")=$H
"RTN","GMRVOREQ",84,0)
 S DLAYGO=101,X=GMRVPNAM,DIC="^ORD(101,",DIC(0)="LQ" K DD D FILE^DICN G QUIT:+Y'>0 S %Y="^ORD(101,"_+Y_",",%X="GMRVPROT(" D %XY^%RCR S DA=+Y,DIK="^ORD(101," D IX1^DIK
"RTN","GMRVOREQ",85,0)
 S $P(^GMRD(120.57,1,"Q0"),"^")=GMRVPNUM+1
"RTN","GMRVOREQ",86,0)
 Q
"VER")
8.0^21.0
**END**
**END**
