Released PSO*7*264 SEQ #241
Extracted from mail message
**KIDS**:PSO*7.0*264^

**INSTALL NAME**
PSO*7.0*264
"BLD",6280,0)
PSO*7.0*264^OUTPATIENT PHARMACY^0^3071001^y
"BLD",6280,1,0)
^^157^157^3071001^
"BLD",6280,1,1,0)
The FY07 Q4 Enhancement Release includes the following PSO enhancements:
"BLD",6280,1,2,0)
 
"BLD",6280,1,3,0)
1. Internet Refill Automation and Reporting
"BLD",6280,1,4,0)
   a. Internet Refill Automation Job
"BLD",6280,1,5,0)
      Added a new Automate Internet Refill [PSO AUTO REFILL INITIALIZE]
"BLD",6280,1,6,0)
      option to the Maintenance (Outpatient Pharmacy) [PSO MAINTENANCE]
"BLD",6280,1,7,0)
      menu that allows the sites to schedule/un-schedule a background job
"BLD",6280,1,8,0)
      to automatically process refill requests placed via the Internet. It
"BLD",6280,1,9,0)
      requires the PSOAUTRF key and generates MailMan messages by division
"BLD",6280,1,10,0)
      to holders of the PSOAUTRF key with details of Not-Filled refills,
"BLD",6280,1,11,0)
      unsuccessful runs, count of refills processed successfully, etc.
"BLD",6280,1,12,0)
 
"BLD",6280,1,13,0)
      Note: The new PSOAUTRF security key is transported in this patch and
"BLD",6280,1,14,0)
            should be assigned to the appropriate personnel to setup the
"BLD",6280,1,15,0)
            above job.
"BLD",6280,1,16,0)
 
"BLD",6280,1,17,0)
 
"BLD",6280,1,18,0)
      Example: If the patient is marked as dead, the following message is
"BLD",6280,1,19,0)
               generated:
"BLD",6280,1,20,0)
 
"BLD",6280,1,21,0)
      Subj: ALBANY Internet Refills Not Processed List,  [#104161]
"BLD",6280,1,22,0)
      08/10/07@09:12 11 lines
"BLD",6280,1,23,0)
      From: POSTMASTER  In 'IN' basket.   Page 1  *New*
"BLD",6280,1,24,0)
      ------------------------------------------------------------------
"BLD",6280,1,25,0)
      Internet Refills Not Processed Report for the ALBANY Division.
"BLD",6280,1,26,0)
 
"BLD",6280,1,27,0)
      The following refill requests were not processed:
"BLD",6280,1,28,0)
 
"BLD",6280,1,29,0)
      Patient: OPPATIENT,SEVEN   SSN: 0000
"BLD",6280,1,30,0)
 
"BLD",6280,1,31,0)
      Rx #: 100002461  (REF #1)  Qty: 2
"BLD",6280,1,32,0)
      Drug: ASPIRIN 650MG SUPPOSITORIES
"BLD",6280,1,33,0)
      Reason: Patient Died on AUG 10, 2007
"BLD",6280,1,34,0)
 
"BLD",6280,1,35,0)
 
"BLD",6280,1,36,0)
   b. Added two new fields, PROCESS AUTO REFILLS FOR INPAT field (#2030)
"BLD",6280,1,37,0)
      and PROCESS AUTO REFILLS FOR CNH field (#2035), to the OUTPATIENT
"BLD",6280,1,38,0)
      SITE file (#59) to allow the sites to process/not to process refills
"BLD",6280,1,39,0)
      for inpatients and CNH patients for the scheduled job defined in
"BLD",6280,1,40,0)
      item 1.a above. It will process these refills only if the site has
"BLD",6280,1,41,0)
      flagged these fields as YES.
"BLD",6280,1,42,0)
 
"BLD",6280,1,43,0)
      The Site Parameter Enter/Edit [PSO SITE PARAMETERS] option is also
"BLD",6280,1,44,0)
      modified to include these two new fields.
"BLD",6280,1,45,0)
 
"BLD",6280,1,46,0)
   c. Added a new LOGIN DATE field (#11) to the PRESCRIPTION REFILL
"BLD",6280,1,47,0)
      REQUEST file (#52.43) to capture the date and time the refill
"BLD",6280,1,48,0)
      request was made.
"BLD",6280,1,49,0)
 
"BLD",6280,1,50,0)
   d. Added a new Internet Refill Report [PSO INTERNET REFILL REPORT]
"BLD",6280,1,51,0)
      option, to the Output Reports [PSO OUTPUTS] menu that generates
"BLD",6280,1,52,0)
      reports by division, detail, or summary of internet refills sorted
"BLD",6280,1,53,0)
      by Patient, Date, or Result.
"BLD",6280,1,54,0)
 
"BLD",6280,1,55,0)
2. Modified the Barcode Batch Prescription Entry [PSO BATCH BARCODE] and
"BLD",6280,1,56,0)
   Process Internet Refills [PSO INTERNET REFILLS] options to provide
"BLD",6280,1,57,0)
   separate prompts to Allow refills for inpatient and Allow refills for
"BLD",6280,1,58,0)
   Contract Nursing Home (CNH) instead of a single prompt that applies to
"BLD",6280,1,59,0)
   both.
"BLD",6280,1,60,0)
 
"BLD",6280,1,61,0)
3. If the REGISTRATION package V. 5.3 patch DG*5.3*688 that introduces the
"BLD",6280,1,62,0)
   COUNTRY field to the PATIENT file (#2) is installed, then:
"BLD",6280,1,63,0)
  a. for Local Mail-outs with foreign addresses, the address information
"BLD",6280,1,64,0)
     on the laser label mailing label is replaced with
"BLD",6280,1,65,0)
     *** FOREIGN ADDRESS ***.
"BLD",6280,1,66,0)
 
"BLD",6280,1,67,0)
  b. In print from suspense, if the address is foreign and the routing is
"BLD",6280,1,68,0)
     not "window", the label will not print nor will the prescription be
"BLD",6280,1,69,0)
     sent to automated filling equipment. The fill will remain on suspense
"BLD",6280,1,70,0)
     until it is pulled early, or the routing is changed to window, or the
"BLD",6280,1,71,0)
     address is changed.
"BLD",6280,1,72,0)
 
"BLD",6280,1,73,0)
4. Added a new Queue CMOP Prescription [PSO RX QUEUE CMOP] option to the
"BLD",6280,1,74,0)
   Suspense Functions [PSO PND] menu, Pharmacist Menu [PSO USER1] and
"BLD",6280,1,75,0)
   Pharmacy Technician's Menu [PSO USER2] menu, to manually queue
"BLD",6280,1,76,0)
   prescription to Consolidated Mail Outpatient Pharmacy (CMOP).
"BLD",6280,1,77,0)
 
"BLD",6280,1,78,0)
5. The software is modified to check if the Provider has a DEA number in
"BLD",6280,1,79,0)
   the DEA# field (#53.2) or a VA number in the VA# field (#53.3) of the
"BLD",6280,1,80,0)
   NEW PERSON file (#200) and the YSCL AUTHORIZED key to order clozapine
"BLD",6280,1,81,0)
   drug. Previously, the check was only for the DEA#. If the ordering
"BLD",6280,1,82,0)
   provider does not have the DEA# or the VA#, the order cannot be placed
"BLD",6280,1,83,0)
   and user will see the message 'Provider must have a DEA# or VA# to
"BLD",6280,1,84,0)
   write prescriptions for clozapine'. Also, if the provider does not hold
"BLD",6280,1,85,0)
   the YSCL AUTHORIZED key, the message 'Provider must hold YSCL
"BLD",6280,1,86,0)
   AUTHORIZED key to write prescriptions for clozapine' is displayed.
"BLD",6280,1,87,0)
 
"BLD",6280,1,88,0)
   Note: The YSCL AUTHORIZED key was transported in the MENTAL HEALTH V.
"BLD",6280,1,89,0)
         5.01 patch YS*5.01*90 and should be assigned to the appropriate
"BLD",6280,1,90,0)
         provider to write prescriptions for clozapine.
"BLD",6280,1,91,0)
 
"BLD",6280,1,92,0)
6. The View Provider [PSO PROVIDER INQUIRE] option is modified to display
"BLD",6280,1,93,0)
   the NPI field (#41.99) of the NEW PERSON file (#200).
"BLD",6280,1,94,0)
 
"BLD",6280,1,95,0)
7. Changes to the Patient Information (Profile) Screen
"BLD",6280,1,96,0)
 a. The PATIENT STATUS field (#3) of the PHARMACY PATIENT file (#55) is
"BLD",6280,1,97,0)
    added to the Patient Information screen. It will be displayed after
"BLD",6280,1,98,0)
    the patient's eligibility.
"BLD",6280,1,99,0)
 
"BLD",6280,1,100,0)
    Example:
"BLD",6280,1,101,0)
 
"BLD",6280,1,102,0)
    Patient Information        Aug 10, 2007@10:04:09       Page: 1 of 2
"BLD",6280,1,103,0)
    OPPATIENT,SEVEN
"BLD",6280,1,104,0)
                                                            <A>
"BLD",6280,1,105,0)
    PID: 000-12-3456                        Ht(cm): _______ (______)
"BLD",6280,1,106,0)
    DOB: DEC 1,1950 (56)                    Wt(kg): _______ (______)
"BLD",6280,1,107,0)
    SEX: MALE
"BLD",6280,1,108,0)
 
"BLD",6280,1,109,0)
    Eligibility: NSC, VA PENSION
"BLD",6280,1,110,0)
    RX PATIENT STATUS: OPT NSC
"BLD",6280,1,111,0)
 
"BLD",6280,1,112,0)
    Disabilities: POST-TRAUMATIC STRESS DISORDER-100% (SC),
"BLD",6280,1,113,0)
 
"BLD",6280,1,114,0)
    2222 CENTRAL AVE
"BLD",6280,1,115,0)
                                                  HOME PHONE:
"BLD",6280,1,116,0)
    ALBANY                                        CELL PHONE:
"BLD",6280,1,117,0)
                                                  WORK PHONE:
"BLD",6280,1,118,0)
    Prescription Mail Delivery: Regular Mail
"BLD",6280,1,119,0)
    Cannot use safety caps.
"BLD",6280,1,120,0)
 
"BLD",6280,1,121,0)
    Allergies
"BLD",6280,1,122,0)
        Verified: PENICILLIN,
"BLD",6280,1,123,0)
    +         Enter ?? for more actions
"BLD",6280,1,124,0)
    EA  Enter/Edit Allergy/ADR Data         PU  Patient Record Update
"BLD",6280,1,125,0)
    DD  Detailed Allergy/ADR List           EX  Exit Patient List
"BLD",6280,1,126,0)
    Select Action: Next Screen//
"BLD",6280,1,127,0)
 
"BLD",6280,1,128,0)
 b. Change the existing 'PHONE:' label to 'HOME PHONE:', and also display
"BLD",6280,1,129,0)
    the PHONE NUMBER [CELLULAR] field (#.134) and the PHONE NUMBER [WORK]
"BLD",6280,1,130,0)
    field (#.132) of the PATIENT file (#2). The work and cell phone
"BLD",6280,1,131,0)
    fields can be maintained via the PATIENT UPDATE (PU) action and the
"BLD",6280,1,132,0)
    Update Patient Record [PSO PAT] option.
"BLD",6280,1,133,0)
 
"BLD",6280,1,134,0)
8. Added a new hidden ListMan 'CM' action to the Medication Profile called
"BLD",6280,1,135,0)
   Manual Queue to CMOP [PSO LM QUEUE TO CMOP] to the PSO HIDDEN ACTIONS
"BLD",6280,1,136,0)
   #2 PROTOCOL, to manually queue selected prescriptions to CMOP.
"BLD",6280,1,137,0)
 
"BLD",6280,1,138,0)
9. Added a new column showing the B/D/F (Bad Address Indicator/ Do Not
"BLD",6280,1,139,0)
   Mail/ Foreign Address) to the Log of Suspended Rx's by Day (this
"BLD",6280,1,140,0)
   Division) [PSO PNDLOG] option.
"BLD",6280,1,141,0)
 
"BLD",6280,1,142,0)
10. Modified Bad Address Suspended List [PSO BAI SUSPENDED] option to
"BLD",6280,1,143,0)
    include the prompt either B/D/F or 'ALL' in the unprinted suspended
"BLD",6280,1,144,0)
    prescriptions report.
"BLD",6280,1,145,0)
 
"BLD",6280,1,146,0)
 
"BLD",6280,1,147,0)
MISCELLANEOUS FIXES:
"BLD",6280,1,148,0)
-------------------
"BLD",6280,1,149,0)
 
"BLD",6280,1,150,0)
1. With the release of PSO*7*260, a line of code was missing from the
"BLD",6280,1,151,0)
   View Prescription [PSO VIEW] option that displays Dosage, Verb,
"BLD",6280,1,152,0)
   Dispense Unit, Noun, Route, and Schedule. This patch restores this
"BLD",6280,1,153,0)
   functionality.
"BLD",6280,1,154,0)
 
"BLD",6280,1,155,0)
2. The field description of the REFILL INACTIVE DRUG RXS field (#.111) of
"BLD",6280,1,156,0)
   the OUTPATIENT SITE file (#59) has a typo. It is corrected to
"BLD",6280,1,157,0)
   'prescription'.
"BLD",6280,4,0)
^9.64PA^52.43^2
"BLD",6280,4,52.43,0)
52.43
"BLD",6280,4,52.43,2,0)
^9.641^52.43^1
"BLD",6280,4,52.43,2,52.43,0)
PRESCRIPTION REFILL REQUEST  (File-top level)
"BLD",6280,4,52.43,2,52.43,1,0)
^9.6411^5^3
"BLD",6280,4,52.43,2,52.43,1,5,0)
DATE PROCESSED
"BLD",6280,4,52.43,2,52.43,1,10,0)
REMARKS
"BLD",6280,4,52.43,2,52.43,1,11,0)
LOGIN DATE
"BLD",6280,4,52.43,222)
y^y^p^^^^n^^n
"BLD",6280,4,52.43,224)

"BLD",6280,4,59,0)
59
"BLD",6280,4,59,2,0)
^9.641^59^1
"BLD",6280,4,59,2,59,0)
OUTPATIENT SITE  (File-top level)
"BLD",6280,4,59,2,59,1,0)
^9.6411^2035^3
"BLD",6280,4,59,2,59,1,.111,0)
REFILL INACTIVE DRUG RXS
"BLD",6280,4,59,2,59,1,2030,0)
PROCESS AUTO REFILLS FOR INPAT
"BLD",6280,4,59,2,59,1,2035,0)
PROCESS AUTO REFILLS FOR CNH
"BLD",6280,4,59,222)
y^y^p^^^^n^^n
"BLD",6280,4,59,224)

"BLD",6280,4,"APDD",52.43,52.43)

"BLD",6280,4,"APDD",52.43,52.43,5)

"BLD",6280,4,"APDD",52.43,52.43,10)

"BLD",6280,4,"APDD",52.43,52.43,11)

"BLD",6280,4,"APDD",59,59)

"BLD",6280,4,"APDD",59,59,.111)

"BLD",6280,4,"APDD",59,59,2030)

"BLD",6280,4,"APDD",59,59,2035)

"BLD",6280,4,"B",52.43,52.43)

"BLD",6280,4,"B",59,59)

"BLD",6280,6.3)
19
"BLD",6280,"KRN",0)
^9.67PA^8989.52^19
"BLD",6280,"KRN",.4,0)
.4
"BLD",6280,"KRN",.401,0)
.401
"BLD",6280,"KRN",.402,0)
.402
"BLD",6280,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",6280,"KRN",.402,"NM",1,0)
PSO SITE    FILE #59^59^0
"BLD",6280,"KRN",.402,"NM","B","PSO SITE    FILE #59",1)

"BLD",6280,"KRN",.403,0)
.403
"BLD",6280,"KRN",.5,0)
.5
"BLD",6280,"KRN",.84,0)
.84
"BLD",6280,"KRN",3.6,0)
3.6
"BLD",6280,"KRN",3.8,0)
3.8
"BLD",6280,"KRN",9.2,0)
9.2
"BLD",6280,"KRN",9.8,0)
9.8
"BLD",6280,"KRN",9.8,"NM",0)
^9.68A^24^22
"BLD",6280,"KRN",9.8,"NM",1,0)
PSOBBC^^0^B92251311
"BLD",6280,"KRN",9.8,"NM",2,0)
PSOATRF^^0^B73020434
"BLD",6280,"KRN",9.8,"NM",3,0)
PSOATRP^^0^B9028143
"BLD",6280,"KRN",9.8,"NM",4,0)
PSOATRD^^0^B25504709
"BLD",6280,"KRN",9.8,"NM",5,0)
PSOATRPP^^0^B26688767
"BLD",6280,"KRN",9.8,"NM",6,0)
PSOATRR^^0^B23568453
"BLD",6280,"KRN",9.8,"NM",7,0)
PSOORUT2^^0^B65711274
"BLD",6280,"KRN",9.8,"NM",8,0)
PSOPRVW^^0^B36660908
"BLD",6280,"KRN",9.8,"NM",9,0)
PSOPRI^^0^B24224309
"BLD",6280,"KRN",9.8,"NM",12,0)
PSODIR^^0^B29087879
"BLD",6280,"KRN",9.8,"NM",13,0)
PSOLLL1^^0^B70201021
"BLD",6280,"KRN",9.8,"NM",14,0)
PSOSULB1^^0^B25792932
"BLD",6280,"KRN",9.8,"NM",15,0)
PSOSULBL^^0^B68549461
"BLD",6280,"KRN",9.8,"NM",16,0)
PSOATRF1^^0^B4764238
"BLD",6280,"KRN",9.8,"NM",17,0)
PSORESUS^^0^B14351152
"BLD",6280,"KRN",9.8,"NM",18,0)
PSOPRA^^0^B12269576
"BLD",6280,"KRN",9.8,"NM",19,0)
PSOSULOG^^0^B61735277
"BLD",6280,"KRN",9.8,"NM",20,0)
PSOBAI^^0^B9978641
"BLD",6280,"KRN",9.8,"NM",21,0)
PSOBAIR2^^0^B39307918
"BLD",6280,"KRN",9.8,"NM",22,0)
PSORENW4^^0^B57297144
"BLD",6280,"KRN",9.8,"NM",23,0)
PSOORNE2^^0^B67732669
"BLD",6280,"KRN",9.8,"NM",24,0)
PSORXVW^^0^B67278533
"BLD",6280,"KRN",9.8,"NM","B","PSOATRD",4)

"BLD",6280,"KRN",9.8,"NM","B","PSOATRF",2)

"BLD",6280,"KRN",9.8,"NM","B","PSOATRF1",16)

"BLD",6280,"KRN",9.8,"NM","B","PSOATRP",3)

"BLD",6280,"KRN",9.8,"NM","B","PSOATRPP",5)

"BLD",6280,"KRN",9.8,"NM","B","PSOATRR",6)

"BLD",6280,"KRN",9.8,"NM","B","PSOBAI",20)

"BLD",6280,"KRN",9.8,"NM","B","PSOBAIR2",21)

"BLD",6280,"KRN",9.8,"NM","B","PSOBBC",1)

"BLD",6280,"KRN",9.8,"NM","B","PSODIR",12)

"BLD",6280,"KRN",9.8,"NM","B","PSOLLL1",13)

"BLD",6280,"KRN",9.8,"NM","B","PSOORNE2",23)

"BLD",6280,"KRN",9.8,"NM","B","PSOORUT2",7)

"BLD",6280,"KRN",9.8,"NM","B","PSOPRA",18)

"BLD",6280,"KRN",9.8,"NM","B","PSOPRI",9)

"BLD",6280,"KRN",9.8,"NM","B","PSOPRVW",8)

"BLD",6280,"KRN",9.8,"NM","B","PSORENW4",22)

"BLD",6280,"KRN",9.8,"NM","B","PSORESUS",17)

"BLD",6280,"KRN",9.8,"NM","B","PSORXVW",24)

"BLD",6280,"KRN",9.8,"NM","B","PSOSULB1",14)

"BLD",6280,"KRN",9.8,"NM","B","PSOSULBL",15)

"BLD",6280,"KRN",9.8,"NM","B","PSOSULOG",19)

"BLD",6280,"KRN",19,0)
19
"BLD",6280,"KRN",19,"NM",0)
^9.68A^11^9
"BLD",6280,"KRN",19,"NM",2,0)
PSO MAINTENANCE^^2
"BLD",6280,"KRN",19,"NM",3,0)
PSO AUTO REFILL^^0
"BLD",6280,"KRN",19,"NM",4,0)
PSO AUTO REFILL INITIALIZE^^0
"BLD",6280,"KRN",19,"NM",5,0)
PSO INTERNET REFILL REPORT^^0
"BLD",6280,"KRN",19,"NM",6,0)
PSO OUTPUTS^^2
"BLD",6280,"KRN",19,"NM",8,0)
PSO PND^^2
"BLD",6280,"KRN",19,"NM",9,0)
PSO RX QUEUE CMOP^^0
"BLD",6280,"KRN",19,"NM",10,0)
PSO USER1^^2
"BLD",6280,"KRN",19,"NM",11,0)
PSO USER2^^2
"BLD",6280,"KRN",19,"NM","B","PSO AUTO REFILL",3)

"BLD",6280,"KRN",19,"NM","B","PSO AUTO REFILL INITIALIZE",4)

"BLD",6280,"KRN",19,"NM","B","PSO INTERNET REFILL REPORT",5)

"BLD",6280,"KRN",19,"NM","B","PSO MAINTENANCE",2)

"BLD",6280,"KRN",19,"NM","B","PSO OUTPUTS",6)

"BLD",6280,"KRN",19,"NM","B","PSO PND",8)

"BLD",6280,"KRN",19,"NM","B","PSO RX QUEUE CMOP",9)

"BLD",6280,"KRN",19,"NM","B","PSO USER1",10)

"BLD",6280,"KRN",19,"NM","B","PSO USER2",11)

"BLD",6280,"KRN",19.1,0)
19.1
"BLD",6280,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",6280,"KRN",19.1,"NM",1,0)
PSOAUTRF^^0
"BLD",6280,"KRN",19.1,"NM","B","PSOAUTRF",1)

"BLD",6280,"KRN",101,0)
101
"BLD",6280,"KRN",101,"NM",0)
^9.68A^31^31
"BLD",6280,"KRN",101,"NM",1,0)
PSO HIDDEN ACTIONS #2^^0
"BLD",6280,"KRN",101,"NM",2,0)
PSO LM ACTION PROFILE^^0
"BLD",6280,"KRN",101,"NM",3,0)
PSO LM DISPLAY ORDER STATUS^^0
"BLD",6280,"KRN",101,"NM",4,0)
PSO LM HIDDEN OTHER^^0
"BLD",6280,"KRN",101,"NM",5,0)
PSO LM INPATIENT MEDICATION PROFILE^^0
"BLD",6280,"KRN",101,"NM",6,0)
PSO LM MULTI-RX PRINT^^0
"BLD",6280,"KRN",101,"NM",7,0)
PSO LM NON-VA MEDS RPT^^0
"BLD",6280,"KRN",101,"NM",8,0)
PSO LM PRINT MED INFO^^0
"BLD",6280,"KRN",101,"NM",9,0)
PSO LM QUEUE TO CMOP^^0
"BLD",6280,"KRN",101,"NM",10,0)
PSO SPEED CANCEL^^0
"BLD",6280,"KRN",101,"NM",11,0)
PSO SPEED PULL SUSPENSE^^0
"BLD",6280,"KRN",101,"NM",12,0)
PSO SPEED REFILL^^0
"BLD",6280,"KRN",101,"NM",13,0)
PSO SPEED RELEASE^^0
"BLD",6280,"KRN",101,"NM",14,0)
PSO SPEED RENEW^^0
"BLD",6280,"KRN",101,"NM",15,0)
PSO SPEED REPRINT^^0
"BLD",6280,"KRN",101,"NM",16,0)
PSO SPEED SIG LOG REPRINT^^0
"BLD",6280,"KRN",101,"NM",17,0)
VALM DOWN A LINE^^0
"BLD",6280,"KRN",101,"NM",18,0)
VALM FIRST SCREEN^^0
"BLD",6280,"KRN",101,"NM",19,0)
VALM GOTO PAGE^^0
"BLD",6280,"KRN",101,"NM",20,0)
VALM LAST SCREEN^^0
"BLD",6280,"KRN",101,"NM",21,0)
VALM LEFT^^0
"BLD",6280,"KRN",101,"NM",22,0)
VALM NEXT SCREEN^^0
"BLD",6280,"KRN",101,"NM",23,0)
VALM PREVIOUS SCREEN^^0
"BLD",6280,"KRN",101,"NM",24,0)
VALM PRINT LIST^^0
"BLD",6280,"KRN",101,"NM",25,0)
VALM PRINT SCREEN^^0
"BLD",6280,"KRN",101,"NM",26,0)
VALM QUIT^^0
"BLD",6280,"KRN",101,"NM",27,0)
VALM REFRESH^^0
"BLD",6280,"KRN",101,"NM",28,0)
VALM RIGHT^^0
"BLD",6280,"KRN",101,"NM",29,0)
VALM SEARCH LIST^^0
"BLD",6280,"KRN",101,"NM",30,0)
VALM TURN ON/OFF MENUS^^0
"BLD",6280,"KRN",101,"NM",31,0)
VALM UP ONE LINE^^0
"BLD",6280,"KRN",101,"NM","B","PSO HIDDEN ACTIONS #2",1)

"BLD",6280,"KRN",101,"NM","B","PSO LM ACTION PROFILE",2)

"BLD",6280,"KRN",101,"NM","B","PSO LM DISPLAY ORDER STATUS",3)

"BLD",6280,"KRN",101,"NM","B","PSO LM HIDDEN OTHER",4)

"BLD",6280,"KRN",101,"NM","B","PSO LM INPATIENT MEDICATION PROFILE",5)

"BLD",6280,"KRN",101,"NM","B","PSO LM MULTI-RX PRINT",6)

"BLD",6280,"KRN",101,"NM","B","PSO LM NON-VA MEDS RPT",7)

"BLD",6280,"KRN",101,"NM","B","PSO LM PRINT MED INFO",8)

"BLD",6280,"KRN",101,"NM","B","PSO LM QUEUE TO CMOP",9)

"BLD",6280,"KRN",101,"NM","B","PSO SPEED CANCEL",10)

"BLD",6280,"KRN",101,"NM","B","PSO SPEED PULL SUSPENSE",11)

"BLD",6280,"KRN",101,"NM","B","PSO SPEED REFILL",12)

"BLD",6280,"KRN",101,"NM","B","PSO SPEED RELEASE",13)

"BLD",6280,"KRN",101,"NM","B","PSO SPEED RENEW",14)

"BLD",6280,"KRN",101,"NM","B","PSO SPEED REPRINT",15)

"BLD",6280,"KRN",101,"NM","B","PSO SPEED SIG LOG REPRINT",16)

"BLD",6280,"KRN",101,"NM","B","VALM DOWN A LINE",17)

"BLD",6280,"KRN",101,"NM","B","VALM FIRST SCREEN",18)

"BLD",6280,"KRN",101,"NM","B","VALM GOTO PAGE",19)

"BLD",6280,"KRN",101,"NM","B","VALM LAST SCREEN",20)

"BLD",6280,"KRN",101,"NM","B","VALM LEFT",21)

"BLD",6280,"KRN",101,"NM","B","VALM NEXT SCREEN",22)

"BLD",6280,"KRN",101,"NM","B","VALM PREVIOUS SCREEN",23)

"BLD",6280,"KRN",101,"NM","B","VALM PRINT LIST",24)

"BLD",6280,"KRN",101,"NM","B","VALM PRINT SCREEN",25)

"BLD",6280,"KRN",101,"NM","B","VALM QUIT",26)

"BLD",6280,"KRN",101,"NM","B","VALM REFRESH",27)

"BLD",6280,"KRN",101,"NM","B","VALM RIGHT",28)

"BLD",6280,"KRN",101,"NM","B","VALM SEARCH LIST",29)

"BLD",6280,"KRN",101,"NM","B","VALM TURN ON/OFF MENUS",30)

"BLD",6280,"KRN",101,"NM","B","VALM UP ONE LINE",31)

"BLD",6280,"KRN",409.61,0)
409.61
"BLD",6280,"KRN",771,0)
771
"BLD",6280,"KRN",870,0)
870
"BLD",6280,"KRN",8989.51,0)
8989.51
"BLD",6280,"KRN",8989.52,0)
8989.52
"BLD",6280,"KRN",8994,0)
8994
"BLD",6280,"KRN","B",.4,.4)

"BLD",6280,"KRN","B",.401,.401)

"BLD",6280,"KRN","B",.402,.402)

"BLD",6280,"KRN","B",.403,.403)

"BLD",6280,"KRN","B",.5,.5)

"BLD",6280,"KRN","B",.84,.84)

"BLD",6280,"KRN","B",3.6,3.6)

"BLD",6280,"KRN","B",3.8,3.8)

"BLD",6280,"KRN","B",9.2,9.2)

"BLD",6280,"KRN","B",9.8,9.8)

"BLD",6280,"KRN","B",19,19)

"BLD",6280,"KRN","B",19.1,19.1)

"BLD",6280,"KRN","B",101,101)

"BLD",6280,"KRN","B",409.61,409.61)

"BLD",6280,"KRN","B",771,771)

"BLD",6280,"KRN","B",870,870)

"BLD",6280,"KRN","B",8989.51,8989.51)

"BLD",6280,"KRN","B",8989.52,8989.52)

"BLD",6280,"KRN","B",8994,8994)

"BLD",6280,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",6280,"QUES",0)
^9.62^^
"BLD",6280,"REQB",0)
^9.611^4^3
"BLD",6280,"REQB",2,0)
PSO*7.0*242^2
"BLD",6280,"REQB",3,0)
PSO*7.0*260^2
"BLD",6280,"REQB",4,0)
PSO*7.0*238^2
"BLD",6280,"REQB","B","PSO*7.0*238",4)

"BLD",6280,"REQB","B","PSO*7.0*242",2)

"BLD",6280,"REQB","B","PSO*7.0*260",3)

"FIA",52.43)
PRESCRIPTION REFILL REQUEST
"FIA",52.43,0)
^PS(52.43,
"FIA",52.43,0,0)
52.43
"FIA",52.43,0,1)
y^y^p^^^^n^^n
"FIA",52.43,0,10)

"FIA",52.43,0,11)

"FIA",52.43,0,"RLRO")

"FIA",52.43,0,"VR")
7.0^PSO
"FIA",52.43,52.43)
1
"FIA",52.43,52.43,5)

"FIA",52.43,52.43,10)

"FIA",52.43,52.43,11)

"FIA",59)
OUTPATIENT SITE
"FIA",59,0)
^PS(59,
"FIA",59,0,0)
59I
"FIA",59,0,1)
y^y^p^^^^n^^n
"FIA",59,0,10)

"FIA",59,0,11)

"FIA",59,0,"RLRO")

"FIA",59,0,"VR")
7.0^PSO
"FIA",59,59)
1
"FIA",59,59,.111)

"FIA",59,59,2030)

"FIA",59,59,2035)

"KRN",.402,1379,-1)
0^1
"KRN",.402,1379,0)
PSO SITE^3070629.131^^59^^^3070920
"KRN",.402,1379,"DIAB",1,1,59.02008,0)
ALL
"KRN",.402,1379,"DR",1,59)
.01:.06;1008;.07:.081;2004;.09:.091;.1:.18;.2:.52;3:5;2008;6:7;105;105.1;105.2;2006;2007;8;100;101;109;1000;1001;1002;2001;2002;1003;1004;1005;1006;2005;2030;2035;
"KRN",.402,1379,"DR",2,59.02008)
.01
"KRN",.402,1379,"DR",2,59.08)
.01;1;
"KRN",19,226,-1)
2^8
"KRN",19,226,0)
PSO PND^Suspense Functions^^M^11712^^^^^^^141^^1
"KRN",19,226,10,0)
^19.01IP^10^9
"KRN",19,226,10,10,0)
13197
"KRN",19,226,10,10,"^")
PSO RX QUEUE CMOP
"KRN",19,226,10,"A6359",1)
Print From Suspense File^455^^
"KRN",19,226,10,"A6359",2)
Change Suspense Date^454^^
"KRN",19,226,10,"A6359",3)
Pull Specific Prescription Number^451^^
"KRN",19,226,10,"A6359",4)
One Patient's Suspended Labels^452^^
"KRN",19,226,10,"A6359",5)
Count of Suspended Rx's by Day^457^^
"KRN",19,226,10,"A6359",6)
Log of Suspended Rx's by Day^458^^
"KRN",19,226,10,"A6359",7)
Delete From Suspense File^456^^
"KRN",19,226,10,"A6359",8)
Reset and Print Again^453^^
"KRN",19,226,"U")
SUSPENSE FUNCTIONS
"KRN",19,254,-1)
2^6
"KRN",19,254,0)
PSO OUTPUTS^Output Reports^^M^5^^^^^^^141
"KRN",19,254,10,0)
^19.01IP^25^25
"KRN",19,254,10,25,0)
13188
"KRN",19,254,10,25,"^")
PSO INTERNET REFILL REPORT
"KRN",19,254,10,"A6359",1)
Formulary Listing^461^^
"KRN",19,254,10,"A6359",2)
Alpha Drug List and Synonyms^462^^
"KRN",19,254,10,"A6359",3)
Drug List By Synonym^463^^
"KRN",19,254,10,"A6359",4)
Commonly Dispensed Drugs^464^^
"KRN",19,254,10,"A6359",5)
Inactive Drug List^465^^
"KRN",19,254,10,"A6359",6)
Non-Formulary List^466^^
"KRN",19,254,10,"A6359",7)
Narcotic Prescription List^467^^
"KRN",19,254,10,"A6359",8)
Cost Analysis Reports^1135^^
"KRN",19,254,10,"A6359",9)
Amis Report^481^^
"KRN",19,254,10,"A6359",10)
Prescriptions on Hold^487^^
"KRN",19,254,10,"A6359",11)
Action Profile^509^^
"KRN",19,254,"U")
OUTPUT REPORTS
"KRN",19,256,-1)
2^10
"KRN",19,256,0)
PSO USER1^Pharmacist Menu^^M^11712^^^^^^^141^^1^1
"KRN",19,256,10,0)
^19.01IP^19^17
"KRN",19,256,10,19,0)
13197
"KRN",19,256,10,19,"^")
PSO RX QUEUE CMOP
"KRN",19,256,10,"A6359",1)
RX (Prescriptions)^474^^
"KRN",19,256,10,"A6359",2)
Update patient record^472^^
"KRN",19,256,10,"A6359",3)
Print From Suspense File^455^^
"KRN",19,256,10,"A6359",4)
Pull Specific Prescription Number^451^^
"KRN",19,256,10,"A6359",5)
One Patient's Suspended Labels^452^^
"KRN",19,256,10,"A6359",6)
Medication Profile^447^^
"KRN",19,256,10,"A6359",7)
Change Suspense Date^454^^
"KRN",19,256,"U")
PHARMACIST MENU
"KRN",19,257,-1)
2^11
"KRN",19,257,0)
PSO USER2^Pharmacy Technician's Menu^^M^11712^^^^^^^141^^1^1
"KRN",19,257,10,0)
^19.01IP^17^9
"KRN",19,257,10,17,0)
13197
"KRN",19,257,10,17,"^")
PSO RX QUEUE CMOP
"KRN",19,257,10,"A6359",1)
New Prescription Entry^449^^
"KRN",19,257,10,"A6359",2)
Refill Prescriptions^459^^
"KRN",19,257,10,"A6359",3)
View Prescriptions^475^^
"KRN",19,257,10,"A6359",4)
Partial Prescription^478^^
"KRN",19,257,10,"A6359",5)
Medication Profile^447^^
"KRN",19,257,10,"A6359",6)
Reprint An Outpatient Label^470^^
"KRN",19,257,10,"A6359",7)
Hold/Remove from Hold^479^^
"KRN",19,257,10,"A6359",8)
Pull Specific Prescription Number^451^^
"KRN",19,257,10,"A6359",9)
One Patient's Suspended Labels^452^^
"KRN",19,257,10,"A6359",10)
Update patient record^472^^
"KRN",19,257,"U")
PHARMACY TECHNICIAN'S MENU
"KRN",19,7135,-1)
2^2
"KRN",19,7135,0)
PSO MAINTENANCE^Maintenance (Outpatient Pharmacy)^^M^11712^^^^^^^141^^1^1
"KRN",19,7135,10,0)
^19.01IP^29^29
"KRN",19,7135,10,29,0)
13186
"KRN",19,7135,10,29,"^")
PSO AUTO REFILL INITIALIZE
"KRN",19,7135,"U")
MAINTENANCE (OUTPATIENT PHARMA
"KRN",19,13186,-1)
0^4
"KRN",19,13186,0)
PSO AUTO REFILL INITIALIZE^Automate Internet Refill^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,13186,1,0)
^^3^3^3070730^
"KRN",19,13186,1,1,0)
This option initializes a job that will automatically process the 
"KRN",19,13186,1,2,0)
refill requests placed via the Internet. You require PSOAUTRF key to use 
"KRN",19,13186,1,3,0)
this option.
"KRN",19,13186,25)
SETUP^PSOATRF
"KRN",19,13186,"U")
AUTOMATE INTERNET REFILL
"KRN",19,13187,-1)
0^3
"KRN",19,13187,0)
PSO AUTO REFILL^Automate Internet Refill^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,13187,1,0)
^19.06^3^3^3070803^^
"KRN",19,13187,1,1,0)
Refill request entries in the PRESCRIPTION REFILL REQUEST file (#52.43)
"KRN",19,13187,1,2,0)
(Internet Refill requests) will be processed and placed on suspense for
"KRN",19,13187,1,3,0)
the appropriate calculated fill date and a routing of Mail.
"KRN",19,13187,25)
PSOATRF
"KRN",19,13187,"U")
AUTOMATE INTERNET REFILL
"KRN",19,13188,-1)
0^5
"KRN",19,13188,0)
PSO INTERNET REFILL REPORT^Internet Refill Report^^R^^^^^^^^OUTPATIENT PHARMACY^^
"KRN",19,13188,1,0)
^19.06^3^3^3070816^^
"KRN",19,13188,1,1,0)
Generate a list of all Internet Refill prescriptions sorted by Patient, 
"KRN",19,13188,1,2,0)
Date, or Result for one division or for all. This report can be printed 
"KRN",19,13188,1,3,0)
in detail or summary format.
"KRN",19,13188,20)

"KRN",19,13188,25)
PSOATRP
"KRN",19,13188,"U")
INTERNET REFILL REPORT
"KRN",19,13197,-1)
0^9
"KRN",19,13197,0)
PSO RX QUEUE CMOP^Queue CMOP Prescription^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,13197,1,0)
^19.06^3^3^3070726^^
"KRN",19,13197,1,1,0)
This is the Queue Prescription to CMOP Suspense option. It will allow
"KRN",19,13197,1,2,0)
the users (including pharmacy technicians) to put mail-routed
"KRN",19,13197,1,3,0)
prescription(s) for CMOP drugs on suspense for CMOP.
"KRN",19,13197,25)
PSORESUS
"KRN",19,13197,"U")
QUEUE CMOP PRESCRIPTION
"KRN",19.1,541,-1)
0^1
"KRN",19.1,541,0)
PSOAUTRF
"KRN",19.1,541,1,0)
^19.11^3^3^3070618^
"KRN",19.1,541,1,1,0)
This key is used by the Outpatient Patient package.  The Outpatient
"KRN",19.1,541,1,2,0)
Pharmacy package has an option to Auto Refill which gives this 
"KRN",19.1,541,1,3,0)
key to anyone designated as a pharmacist by this option.
"KRN",101,1803,-1)
0^22
"KRN",101,1803,0)
VALM NEXT SCREEN^Next Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1803,1,0)
^^2^2^2920519^^^
"KRN",101,1803,1,1,0)
This action will allow the user to view the next screen
"KRN",101,1803,1,2,0)
of entries, if any exist.
"KRN",101,1803,2,0)
^101.02A^1^1
"KRN",101,1803,2,1,0)
NX
"KRN",101,1803,2,"B","NX",1)

"KRN",101,1803,15)

"KRN",101,1803,20)
D NEXT^VALM4
"KRN",101,1803,99)
60899,45456
"KRN",101,1804,-1)
0^23
"KRN",101,1804,0)
VALM PREVIOUS SCREEN^Previous Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1804,1,0)
^^2^2^2920113^^
"KRN",101,1804,1,1,0)
This action will allow the user to view the previous screen
"KRN",101,1804,1,2,0)
of entries, if any exist.
"KRN",101,1804,2,0)
^101.02A^3^2
"KRN",101,1804,2,1,0)
PR
"KRN",101,1804,2,2,0)
BK
"KRN",101,1804,2,3,0)
PR
"KRN",101,1804,2,"B","BK",2)

"KRN",101,1804,2,"B","PR",1)

"KRN",101,1804,2,"B","PR",3)

"KRN",101,1804,20)
D PREV^VALM4
"KRN",101,1804,99)
60899,45456
"KRN",101,1805,-1)
0^27
"KRN",101,1805,0)
VALM REFRESH^Re-Display Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1805,1,0)
^^1^1^2911024^
"KRN",101,1805,1,1,0)
This actions allows the user to re-display the current screen.
"KRN",101,1805,2,0)
^101.02A^1^1
"KRN",101,1805,2,1,0)
RE
"KRN",101,1805,2,"B","RE",1)

"KRN",101,1805,10,0)
^101.01PA^0^0
"KRN",101,1805,20)
D RE^VALM4
"KRN",101,1805,99)
60899,45456
"KRN",101,1806,-1)
0^20
"KRN",101,1806,0)
VALM LAST SCREEN^Last Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1806,1,0)
^^1^1^2911026^
"KRN",101,1806,1,1,0)
The action will display the last items.
"KRN",101,1806,20)
D LAST^VALM4
"KRN",101,1806,99)
60899,45456
"KRN",101,1807,-1)
0^18
"KRN",101,1807,0)
VALM FIRST SCREEN^First Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1807,1,0)
^^1^1^2960619^^
"KRN",101,1807,1,1,0)
This action will display the first screen.
"KRN",101,1807,15)

"KRN",101,1807,20)
D FIRST^VALM4
"KRN",101,1807,99)
60899,45456
"KRN",101,1808,-1)
0^31
"KRN",101,1808,0)
VALM UP ONE LINE^Up a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,1808,1,0)
^^1^1^2911027^
"KRN",101,1808,1,1,0)
Move up a line
"KRN",101,1808,20)
D UP^VALM40
"KRN",101,1808,99)
60899,45456
"KRN",101,1809,-1)
0^17
"KRN",101,1809,0)
VALM DOWN A LINE^Down a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,1809,1,0)
^^2^2^2950628^^
"KRN",101,1809,1,1,0)
Move down a line.
"KRN",101,1809,1,2,0)

"KRN",101,1809,3,0)
^101.03P^0^0
"KRN",101,1809,20)
D DOWN^VALM40
"KRN",101,1809,99)
60899,45456
"KRN",101,1811,-1)
0^26
"KRN",101,1811,0)
VALM QUIT^Quit^^A^^^^^^^^
"KRN",101,1811,.1)
 
"KRN",101,1811,1,0)
^^1^1^2911105^
"KRN",101,1811,1,1,0)
This protocol can be used as a generic 'quit' action.
"KRN",101,1811,2,0)
^101.02A^2^2
"KRN",101,1811,2,1,0)
EXIT
"KRN",101,1811,2,2,0)
QUIT
"KRN",101,1811,2,"B","EXIT",1)

"KRN",101,1811,2,"B","QUIT",2)

"KRN",101,1811,15)

"KRN",101,1811,20)
Q
"KRN",101,1811,99)
60899,45457
"KRN",101,1812,-1)
0^25
"KRN",101,1812,0)
VALM PRINT SCREEN^Print Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1812,1,0)
^^3^3^2920113^^
"KRN",101,1812,1,1,0)
This action allows the user to print the current List Manager
"KRN",101,1812,1,2,0)
display screen.  The header and the current portion of the
"KRN",101,1812,1,3,0)
list are printed.
"KRN",101,1812,20)
D PRT^VALM1
"KRN",101,1812,99)
60899,45457
"KRN",101,1813,-1)
0^24
"KRN",101,1813,0)
VALM PRINT LIST^Print List^^A^^^^^^^^LIST MANAGER
"KRN",101,1813,1,0)
^^2^2^2920113^
"KRN",101,1813,1,1,0)
This action allws the user to print the entire list of
"KRN",101,1813,1,2,0)
entries currently being displayed.
"KRN",101,1813,20)
D PRTL^VALM1
"KRN",101,1813,99)
60899,45457
"KRN",101,1815,-1)
0^30
"KRN",101,1815,0)
VALM TURN ON/OFF MENUS^Auto-Display(On/Off)^^A^^^^^^^^LIST MANAGER
"KRN",101,1815,20)
D MENU^VALM2
"KRN",101,1815,99)
60899,45457
"KRN",101,1817,-1)
0^29
"KRN",101,1817,0)
VALM SEARCH LIST^Search List^^A^^^^^^^^LIST MANAGER
"KRN",101,1817,1,0)
^^1^1^2920303^^
"KRN",101,1817,1,1,0)
Finds text in list of entries.
"KRN",101,1817,20)
D FIND^VALM40
"KRN",101,1817,99)
60899,45457
"KRN",101,1824,-1)
0^28
"KRN",101,1824,0)
VALM RIGHT^Shift View to Right^^A^^^^^^^^LIST MANAGER
"KRN",101,1824,20)
D RIGHT^VALM40(XQORNOD(0))
"KRN",101,1824,99)
60837,32357
"KRN",101,1825,-1)
0^21
"KRN",101,1825,0)
VALM LEFT^Shift View to Left^^A^^^^^^^^LIST MANAGER
"KRN",101,1825,20)
D LEFT^VALM40(XQORNOD(0))
"KRN",101,1825,99)
60837,32357
"KRN",101,1827,-1)
0^19
"KRN",101,1827,0)
VALM GOTO PAGE^Go to Page^^A^^^^^^^^LIST MANAGER
"KRN",101,1827,1,0)
^^1^1^2930113^
"KRN",101,1827,1,1,0)

"KRN",101,1827,20)
D GOTO^VALM40
"KRN",101,1827,99)
60899,45457
"KRN",101,3823,-1)
0^14
"KRN",101,3823,0)
PSO SPEED RENEW^Renew (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3823,20)
D ^PSORENW4
"KRN",101,3823,99)
60837,32357
"KRN",101,3824,-1)
0^1
"KRN",101,3824,0)
PSO HIDDEN ACTIONS #2^Outpatient Pharmacy Hidden Actions #2^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3824,1,0)
^^1^1^2970818^
"KRN",101,3824,1,1,0)
This hidden menu is attached to the OP medication profile.
"KRN",101,3824,4)
26^2
"KRN",101,3824,10,0)
^101.01PA^26^26
"KRN",101,3824,10,1,0)
1803^+^35^
"KRN",101,3824,10,1,"^")
VALM NEXT SCREEN
"KRN",101,3824,10,2,0)
1804^-^^
"KRN",101,3824,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,3824,10,3,0)
1808^UP^^
"KRN",101,3824,10,3,"^")
VALM UP ONE LINE
"KRN",101,3824,10,4,0)
1809^DN^20^
"KRN",101,3824,10,4,"^")
VALM DOWN A LINE
"KRN",101,3824,10,5,0)
1805^RD^21^
"KRN",101,3824,10,5,"^")
VALM REFRESH
"KRN",101,3824,10,6,0)
1813^PT^22^
"KRN",101,3824,10,6,"^")
VALM PRINT LIST
"KRN",101,3824,10,7,0)
1812^PS^23^
"KRN",101,3824,10,7,"^")
VALM PRINT SCREEN
"KRN",101,3824,10,8,0)
1824^>^24^
"KRN",101,3824,10,8,"^")
VALM RIGHT
"KRN",101,3824,10,9,0)
1825^<^25^
"KRN",101,3824,10,9,"^")
VALM LEFT
"KRN",101,3824,10,10,0)
1817^SL^26^
"KRN",101,3824,10,10,"^")
VALM SEARCH LIST
"KRN",101,3824,10,11,0)
1811^QU^31^
"KRN",101,3824,10,11,"^")
VALM QUIT
"KRN",101,3824,10,12,0)
1806^LS^32^
"KRN",101,3824,10,12,"^")
VALM LAST SCREEN
"KRN",101,3824,10,13,0)
1807^FS^33^
"KRN",101,3824,10,13,"^")
VALM FIRST SCREEN
"KRN",101,3824,10,14,0)
1827^GO^34^
"KRN",101,3824,10,14,"^")
VALM GOTO PAGE
"KRN",101,3824,10,15,0)
3823^RN^11^
"KRN",101,3824,10,15,"^")
PSO SPEED RENEW
"KRN",101,3824,10,16,0)
3825^DC^12^
"KRN",101,3824,10,16,"^")
PSO SPEED CANCEL
"KRN",101,3824,10,17,0)
3826^RL^13^
"KRN",101,3824,10,17,"^")
PSO SPEED RELEASE
"KRN",101,3824,10,18,0)
3827^RP^10^
"KRN",101,3824,10,18,"^")
PSO SPEED REPRINT
"KRN",101,3824,10,19,0)
3830^RF^14^
"KRN",101,3824,10,19,"^")
PSO SPEED REFILL
"KRN",101,3824,10,20,0)
3833^PP^15^
"KRN",101,3824,10,20,"^")
PSO SPEED PULL SUSPENSE
"KRN",101,3824,10,21,0)
3838^IP^16^
"KRN",101,3824,10,21,"^")
PSO LM INPATIENT MEDICATION PROFILE
"KRN",101,3824,10,23,0)
1815^ADPL^^
"KRN",101,3824,10,23,"^")
VALM TURN ON/OFF MENUS
"KRN",101,3824,10,24,0)
3842^OTH^19^
"KRN",101,3824,10,24,"^")
PSO LM HIDDEN OTHER
"KRN",101,3824,10,25,0)
5614^RS^17^
"KRN",101,3824,10,25,"^")
PSO SPEED SIG LOG REPRINT
"KRN",101,3824,10,26,0)
5617^CM^18^
"KRN",101,3824,10,26,"^")
PSO LM QUEUE TO CMOP
"KRN",101,3824,99)
60899,45457
"KRN",101,3825,-1)
0^10
"KRN",101,3825,0)
PSO SPEED CANCEL^Discontinue (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3825,20)
D ^PSOCAN4
"KRN",101,3825,99)
60837,32357
"KRN",101,3826,-1)
0^13
"KRN",101,3826,0)
PSO SPEED RELEASE^Release (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3826,20)
D ^PSODISP3
"KRN",101,3826,99)
60837,32357
"KRN",101,3827,-1)
0^15
"KRN",101,3827,0)
PSO SPEED REPRINT^Reprint (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3827,20)
D ^PSORXRP1
"KRN",101,3827,99)
60837,32357
"KRN",101,3830,-1)
0^12
"KRN",101,3830,0)
PSO SPEED REFILL^Refill (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3830,20)
D SPEED^PSOREF
"KRN",101,3830,99)
60837,32357
"KRN",101,3833,-1)
0^11
"KRN",101,3833,0)
PSO SPEED PULL SUSPENSE^Pull Rx (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3833,20)
D ^PSOSUPOE
"KRN",101,3833,99)
60837,32357
"KRN",101,3838,-1)
0^5
"KRN",101,3838,0)
PSO LM INPATIENT MEDICATION PROFILE^Inpat. Profile (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3838,15)
S VALMBCK="R"
"KRN",101,3838,20)
I $T(ENOR^PSJPR)]"" D FULL^VALM1,ENOR^PSJPR(PSODFN):'$G(PSOBEDT)
"KRN",101,3838,99)
60837,32357
"KRN",101,3841,-1)
0^8
"KRN",101,3841,0)
PSO LM PRINT MED INFO^Print Medication Instructions^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3841,15)
Q
"KRN",101,3841,20)
D PRMI^PSOHELP
"KRN",101,3841,99)
60837,32357
"KRN",101,3842,-1)
0^4
"KRN",101,3842,0)
PSO LM HIDDEN OTHER^Other OP Actions^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3842,10,0)
^101.01PA^5^5
"KRN",101,3842,10,1,0)
3841^MI^10^
"KRN",101,3842,10,1,"^")
PSO LM PRINT MED INFO
"KRN",101,3842,10,2,0)
3845^DO^21^
"KRN",101,3842,10,2,"^")
PSO LM DISPLAY ORDER STATUS
"KRN",101,3842,10,3,0)
3846^AP^11^
"KRN",101,3842,10,3,"^")
PSO LM ACTION PROFILE
"KRN",101,3842,10,4,0)
5139^NV^^
"KRN",101,3842,10,4,"^")
PSO LM NON-VA MEDS RPT
"KRN",101,3842,10,5,0)
5326^MR^^
"KRN",101,3842,10,5,"^")
PSO LM MULTI-RX PRINT
"KRN",101,3842,15)
S VALMBCK="R"
"KRN",101,3842,99)
60837,32357
"KRN",101,3845,-1)
0^3
"KRN",101,3845,0)
PSO LM DISPLAY ORDER STATUS^Display Orders' Statuses^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3845,20)
D DPLYOR^PSOORUT3
"KRN",101,3845,99)
60837,32357
"KRN",101,3846,-1)
0^2
"KRN",101,3846,0)
PSO LM ACTION PROFILE^Action Profile (OP)^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3846,15)
S VALMBCK="R"
"KRN",101,3846,20)
D FULL^VALM1 S DFN=PSODFN D LM^PSOSD1
"KRN",101,3846,99)
60837,32357
"KRN",101,5139,-1)
0^7
"KRN",101,5139,0)
PSO LM NON-VA MEDS RPT^Non-VA Meds Report^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5139,15)
S VALMBCK="R"
"KRN",101,5139,20)
D FULL^VALM1 D HID^PSONVARP
"KRN",101,5139,99)
60837,32357
"KRN",101,5326,-1)
0^6
"KRN",101,5326,0)
PSO LM MULTI-RX PRINT^Multi-Rx Request Print^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5326,15)
Q
"KRN",101,5326,20)
D QUEUE^PSOLLL7
"KRN",101,5326,99)
60837,32357
"KRN",101,5614,-1)
0^16
"KRN",101,5614,0)
PSO SPEED SIG LOG REPRINT^Reprint Sig Log^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5614,2,0)
^101.02A^^0
"KRN",101,5614,20)
D ST^PSOLLLHN
"KRN",101,5614,99)
60837,32357
"KRN",101,5617,-1)
0^9
"KRN",101,5617,0)
PSO LM QUEUE TO CMOP^Manual Queue to CMOP^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,5617,20)
D CM^PSORESUS
"KRN",101,5617,99)
60837,32357
"MBREQ")
0
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
264^3071001
"PKG",141,22,1,"PAH",1,1,0)
^^157^157^3071001
"PKG",141,22,1,"PAH",1,1,1,0)
The FY07 Q4 Enhancement Release includes the following PSO enhancements:
"PKG",141,22,1,"PAH",1,1,2,0)
 
"PKG",141,22,1,"PAH",1,1,3,0)
1. Internet Refill Automation and Reporting
"PKG",141,22,1,"PAH",1,1,4,0)
   a. Internet Refill Automation Job
"PKG",141,22,1,"PAH",1,1,5,0)
      Added a new Automate Internet Refill [PSO AUTO REFILL INITIALIZE]
"PKG",141,22,1,"PAH",1,1,6,0)
      option to the Maintenance (Outpatient Pharmacy) [PSO MAINTENANCE]
"PKG",141,22,1,"PAH",1,1,7,0)
      menu that allows the sites to schedule/un-schedule a background job
"PKG",141,22,1,"PAH",1,1,8,0)
      to automatically process refill requests placed via the Internet. It
"PKG",141,22,1,"PAH",1,1,9,0)
      requires the PSOAUTRF key and generates MailMan messages by division
"PKG",141,22,1,"PAH",1,1,10,0)
      to holders of the PSOAUTRF key with details of Not-Filled refills,
"PKG",141,22,1,"PAH",1,1,11,0)
      unsuccessful runs, count of refills processed successfully, etc.
"PKG",141,22,1,"PAH",1,1,12,0)
 
"PKG",141,22,1,"PAH",1,1,13,0)
      Note: The new PSOAUTRF security key is transported in this patch and
"PKG",141,22,1,"PAH",1,1,14,0)
            should be assigned to the appropriate personnel to setup the
"PKG",141,22,1,"PAH",1,1,15,0)
            above job.
"PKG",141,22,1,"PAH",1,1,16,0)
 
"PKG",141,22,1,"PAH",1,1,17,0)
 
"PKG",141,22,1,"PAH",1,1,18,0)
      Example: If the patient is marked as dead, the following message is
"PKG",141,22,1,"PAH",1,1,19,0)
               generated:
"PKG",141,22,1,"PAH",1,1,20,0)
 
"PKG",141,22,1,"PAH",1,1,21,0)
      Subj: ALBANY Internet Refills Not Processed List,  [#104161]
"PKG",141,22,1,"PAH",1,1,22,0)
      08/10/07@09:12 11 lines
"PKG",141,22,1,"PAH",1,1,23,0)
      From: POSTMASTER  In 'IN' basket.   Page 1  *New*
"PKG",141,22,1,"PAH",1,1,24,0)
      ------------------------------------------------------------------
"PKG",141,22,1,"PAH",1,1,25,0)
      Internet Refills Not Processed Report for the ALBANY Division.
"PKG",141,22,1,"PAH",1,1,26,0)
 
"PKG",141,22,1,"PAH",1,1,27,0)
      The following refill requests were not processed:
"PKG",141,22,1,"PAH",1,1,28,0)
 
"PKG",141,22,1,"PAH",1,1,29,0)
      Patient: OPPATIENT,SEVEN   SSN: 0000
"PKG",141,22,1,"PAH",1,1,30,0)
 
"PKG",141,22,1,"PAH",1,1,31,0)
      Rx #: 100002461  (REF #1)  Qty: 2
"PKG",141,22,1,"PAH",1,1,32,0)
      Drug: ASPIRIN 650MG SUPPOSITORIES
"PKG",141,22,1,"PAH",1,1,33,0)
      Reason: Patient Died on AUG 10, 2007
"PKG",141,22,1,"PAH",1,1,34,0)
 
"PKG",141,22,1,"PAH",1,1,35,0)
 
"PKG",141,22,1,"PAH",1,1,36,0)
   b. Added two new fields, PROCESS AUTO REFILLS FOR INPAT field (#2030)
"PKG",141,22,1,"PAH",1,1,37,0)
      and PROCESS AUTO REFILLS FOR CNH field (#2035), to the OUTPATIENT
"PKG",141,22,1,"PAH",1,1,38,0)
      SITE file (#59) to allow the sites to process/not to process refills
"PKG",141,22,1,"PAH",1,1,39,0)
      for inpatients and CNH patients for the scheduled job defined in
"PKG",141,22,1,"PAH",1,1,40,0)
      item 1.a above. It will process these refills only if the site has
"PKG",141,22,1,"PAH",1,1,41,0)
      flagged these fields as YES.
"PKG",141,22,1,"PAH",1,1,42,0)
 
"PKG",141,22,1,"PAH",1,1,43,0)
      The Site Parameter Enter/Edit [PSO SITE PARAMETERS] option is also
"PKG",141,22,1,"PAH",1,1,44,0)
      modified to include these two new fields.
"PKG",141,22,1,"PAH",1,1,45,0)
 
"PKG",141,22,1,"PAH",1,1,46,0)
   c. Added a new LOGIN DATE field (#11) to the PRESCRIPTION REFILL
"PKG",141,22,1,"PAH",1,1,47,0)
      REQUEST file (#52.43) to capture the date and time the refill
"PKG",141,22,1,"PAH",1,1,48,0)
      request was made.
"PKG",141,22,1,"PAH",1,1,49,0)
 
"PKG",141,22,1,"PAH",1,1,50,0)
   d. Added a new Internet Refill Report [PSO INTERNET REFILL REPORT]
"PKG",141,22,1,"PAH",1,1,51,0)
      option, to the Output Reports [PSO OUTPUTS] menu that generates
"PKG",141,22,1,"PAH",1,1,52,0)
      reports by division, detail, or summary of internet refills sorted
"PKG",141,22,1,"PAH",1,1,53,0)
      by Patient, Date, or Result.
"PKG",141,22,1,"PAH",1,1,54,0)
 
"PKG",141,22,1,"PAH",1,1,55,0)
2. Modified the Barcode Batch Prescription Entry [PSO BATCH BARCODE] and
"PKG",141,22,1,"PAH",1,1,56,0)
   Process Internet Refills [PSO INTERNET REFILLS] options to provide
"PKG",141,22,1,"PAH",1,1,57,0)
   separate prompts to Allow refills for inpatient and Allow refills for
"PKG",141,22,1,"PAH",1,1,58,0)
   Contract Nursing Home (CNH) instead of a single prompt that applies to
"PKG",141,22,1,"PAH",1,1,59,0)
   both.
"PKG",141,22,1,"PAH",1,1,60,0)
 
"PKG",141,22,1,"PAH",1,1,61,0)
3. If the REGISTRATION package V. 5.3 patch DG*5.3*688 that introduces the
"PKG",141,22,1,"PAH",1,1,62,0)
   COUNTRY field to the PATIENT file (#2) is installed, then:
"PKG",141,22,1,"PAH",1,1,63,0)
  a. for Local Mail-outs with foreign addresses, the address information
"PKG",141,22,1,"PAH",1,1,64,0)
     on the laser label mailing label is replaced with
"PKG",141,22,1,"PAH",1,1,65,0)
     *** FOREIGN ADDRESS ***.
"PKG",141,22,1,"PAH",1,1,66,0)
 
"PKG",141,22,1,"PAH",1,1,67,0)
  b. In print from suspense, if the address is foreign and the routing is
"PKG",141,22,1,"PAH",1,1,68,0)
     not "window", the label will not print nor will the prescription be
"PKG",141,22,1,"PAH",1,1,69,0)
     sent to automated filling equipment. The fill will remain on suspense
"PKG",141,22,1,"PAH",1,1,70,0)
     until it is pulled early, or the routing is changed to window, or the
"PKG",141,22,1,"PAH",1,1,71,0)
     address is changed.
"PKG",141,22,1,"PAH",1,1,72,0)
 
"PKG",141,22,1,"PAH",1,1,73,0)
4. Added a new Queue CMOP Prescription [PSO RX QUEUE CMOP] option to the
"PKG",141,22,1,"PAH",1,1,74,0)
   Suspense Functions [PSO PND] menu, Pharmacist Menu [PSO USER1] and
"PKG",141,22,1,"PAH",1,1,75,0)
   Pharmacy Technician's Menu [PSO USER2] menu, to manually queue
"PKG",141,22,1,"PAH",1,1,76,0)
   prescription to Consolidated Mail Outpatient Pharmacy (CMOP).
"PKG",141,22,1,"PAH",1,1,77,0)
 
"PKG",141,22,1,"PAH",1,1,78,0)
5. The software is modified to check if the Provider has a DEA number in
"PKG",141,22,1,"PAH",1,1,79,0)
   the DEA# field (#53.2) or a VA number in the VA# field (#53.3) of the
"PKG",141,22,1,"PAH",1,1,80,0)
   NEW PERSON file (#200) and the YSCL AUTHORIZED key to order clozapine
"PKG",141,22,1,"PAH",1,1,81,0)
   drug. Previously, the check was only for the DEA#. If the ordering
"PKG",141,22,1,"PAH",1,1,82,0)
   provider does not have the DEA# or the VA#, the order cannot be placed
"PKG",141,22,1,"PAH",1,1,83,0)
   and user will see the message 'Provider must have a DEA# or VA# to
"PKG",141,22,1,"PAH",1,1,84,0)
   write prescriptions for clozapine'. Also, if the provider does not hold
"PKG",141,22,1,"PAH",1,1,85,0)
   the YSCL AUTHORIZED key, the message 'Provider must hold YSCL
"PKG",141,22,1,"PAH",1,1,86,0)
   AUTHORIZED key to write prescriptions for clozapine' is displayed.
"PKG",141,22,1,"PAH",1,1,87,0)
 
"PKG",141,22,1,"PAH",1,1,88,0)
   Note: The YSCL AUTHORIZED key was transported in the MENTAL HEALTH V.
"PKG",141,22,1,"PAH",1,1,89,0)
         5.01 patch YS*5.01*90 and should be assigned to the appropriate
"PKG",141,22,1,"PAH",1,1,90,0)
         provider to write prescriptions for clozapine.
"PKG",141,22,1,"PAH",1,1,91,0)
 
"PKG",141,22,1,"PAH",1,1,92,0)
6. The View Provider [PSO PROVIDER INQUIRE] option is modified to display
"PKG",141,22,1,"PAH",1,1,93,0)
   the NPI field (#41.99) of the NEW PERSON file (#200).
"PKG",141,22,1,"PAH",1,1,94,0)
 
"PKG",141,22,1,"PAH",1,1,95,0)
7. Changes to the Patient Information (Profile) Screen
"PKG",141,22,1,"PAH",1,1,96,0)
 a. The PATIENT STATUS field (#3) of the PHARMACY PATIENT file (#55) is
"PKG",141,22,1,"PAH",1,1,97,0)
    added to the Patient Information screen. It will be displayed after
"PKG",141,22,1,"PAH",1,1,98,0)
    the patient's eligibility.
"PKG",141,22,1,"PAH",1,1,99,0)
 
"PKG",141,22,1,"PAH",1,1,100,0)
    Example:
"PKG",141,22,1,"PAH",1,1,101,0)
 
"PKG",141,22,1,"PAH",1,1,102,0)
    Patient Information        Aug 10, 2007@10:04:09       Page: 1 of 2
"PKG",141,22,1,"PAH",1,1,103,0)
    OPPATIENT,SEVEN
"PKG",141,22,1,"PAH",1,1,104,0)
                                                            <A>
"PKG",141,22,1,"PAH",1,1,105,0)
    PID: 000-12-3456                        Ht(cm): _______ (______)
"PKG",141,22,1,"PAH",1,1,106,0)
    DOB: DEC 1,1950 (56)                    Wt(kg): _______ (______)
"PKG",141,22,1,"PAH",1,1,107,0)
    SEX: MALE
"PKG",141,22,1,"PAH",1,1,108,0)
 
"PKG",141,22,1,"PAH",1,1,109,0)
    Eligibility: NSC, VA PENSION
"PKG",141,22,1,"PAH",1,1,110,0)
    RX PATIENT STATUS: OPT NSC
"PKG",141,22,1,"PAH",1,1,111,0)
 
"PKG",141,22,1,"PAH",1,1,112,0)
    Disabilities: POST-TRAUMATIC STRESS DISORDER-100% (SC),
"PKG",141,22,1,"PAH",1,1,113,0)
 
"PKG",141,22,1,"PAH",1,1,114,0)
    2222 CENTRAL AVE
"PKG",141,22,1,"PAH",1,1,115,0)
                                                  HOME PHONE:
"PKG",141,22,1,"PAH",1,1,116,0)
    ALBANY                                        CELL PHONE:
"PKG",141,22,1,"PAH",1,1,117,0)
                                                  WORK PHONE:
"PKG",141,22,1,"PAH",1,1,118,0)
    Prescription Mail Delivery: Regular Mail
"PKG",141,22,1,"PAH",1,1,119,0)
    Cannot use safety caps.
"PKG",141,22,1,"PAH",1,1,120,0)
 
"PKG",141,22,1,"PAH",1,1,121,0)
    Allergies
"PKG",141,22,1,"PAH",1,1,122,0)
        Verified: PENICILLIN,
"PKG",141,22,1,"PAH",1,1,123,0)
    +         Enter ?? for more actions
"PKG",141,22,1,"PAH",1,1,124,0)
    EA  Enter/Edit Allergy/ADR Data         PU  Patient Record Update
"PKG",141,22,1,"PAH",1,1,125,0)
    DD  Detailed Allergy/ADR List           EX  Exit Patient List
"PKG",141,22,1,"PAH",1,1,126,0)
    Select Action: Next Screen//
"PKG",141,22,1,"PAH",1,1,127,0)
 
"PKG",141,22,1,"PAH",1,1,128,0)
 b. Change the existing 'PHONE:' label to 'HOME PHONE:', and also display
"PKG",141,22,1,"PAH",1,1,129,0)
    the PHONE NUMBER [CELLULAR] field (#.134) and the PHONE NUMBER [WORK]
"PKG",141,22,1,"PAH",1,1,130,0)
    field (#.132) of the PATIENT file (#2). The work and cell phone
"PKG",141,22,1,"PAH",1,1,131,0)
    fields can be maintained via the PATIENT UPDATE (PU) action and the
"PKG",141,22,1,"PAH",1,1,132,0)
    Update Patient Record [PSO PAT] option.
"PKG",141,22,1,"PAH",1,1,133,0)
 
"PKG",141,22,1,"PAH",1,1,134,0)
8. Added a new hidden ListMan 'CM' action to the Medication Profile called
"PKG",141,22,1,"PAH",1,1,135,0)
   Manual Queue to CMOP [PSO LM QUEUE TO CMOP] to the PSO HIDDEN ACTIONS
"PKG",141,22,1,"PAH",1,1,136,0)
   #2 PROTOCOL, to manually queue selected prescriptions to CMOP.
"PKG",141,22,1,"PAH",1,1,137,0)
 
"PKG",141,22,1,"PAH",1,1,138,0)
9. Added a new column showing the B/D/F (Bad Address Indicator/ Do Not
"PKG",141,22,1,"PAH",1,1,139,0)
   Mail/ Foreign Address) to the Log of Suspended Rx's by Day (this
"PKG",141,22,1,"PAH",1,1,140,0)
   Division) [PSO PNDLOG] option.
"PKG",141,22,1,"PAH",1,1,141,0)
 
"PKG",141,22,1,"PAH",1,1,142,0)
10. Modified Bad Address Suspended List [PSO BAI SUSPENDED] option to
"PKG",141,22,1,"PAH",1,1,143,0)
    include the prompt either B/D/F or 'ALL' in the unprinted suspended
"PKG",141,22,1,"PAH",1,1,144,0)
    prescriptions report.
"PKG",141,22,1,"PAH",1,1,145,0)
 
"PKG",141,22,1,"PAH",1,1,146,0)
 
"PKG",141,22,1,"PAH",1,1,147,0)
MISCELLANEOUS FIXES:
"PKG",141,22,1,"PAH",1,1,148,0)
-------------------
"PKG",141,22,1,"PAH",1,1,149,0)
 
"PKG",141,22,1,"PAH",1,1,150,0)
1. With the release of PSO*7*260, a line of code was missing from the
"PKG",141,22,1,"PAH",1,1,151,0)
   View Prescription [PSO VIEW] option that displays Dosage, Verb,
"PKG",141,22,1,"PAH",1,1,152,0)
   Dispense Unit, Noun, Route, and Schedule. This patch restores this
"PKG",141,22,1,"PAH",1,1,153,0)
   functionality.
"PKG",141,22,1,"PAH",1,1,154,0)
 
"PKG",141,22,1,"PAH",1,1,155,0)
2. The field description of the REFILL INACTIVE DRUG RXS field (#.111) of
"PKG",141,22,1,"PAH",1,1,156,0)
   the OUTPATIENT SITE file (#59) has a typo. It is corrected to
"PKG",141,22,1,"PAH",1,1,157,0)
   'prescription'.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
22
"RTN","PSOATRD")
0^4^B25504709^n/a
"RTN","PSOATRD",1,0)
PSOATRD ;BIR/SJA - INTERNET REFILL BY DATE ;05/29/07 12:36pm
"RTN","PSOATRD",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**264**;DEC 1997;Build 19
"RTN","PSOATRD",3,0)
 ;
"RTN","PSOATRD",4,0)
 K IOP,%ZIS,POP S PSOION=ION,%ZIS="MQ" D ^%ZIS I POP S IOP=PSOION D ^%ZIS K PSOION S PSOQUIT=1 G END
"RTN","PSOATRD",5,0)
 I $D(IO("Q")) D  K PSOION,ZTSK S PSOQUIT=1 G END
"RTN","PSOATRD",6,0)
 . N VAR K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSOATRD",ZTDESC="INTERNET REFILL REPORT BY DATE"
"RTN","PSOATRD",7,0)
 . F VAR="PSODS","PSOED","PSOEDX","PSOREP","PSORMZ","PSOSD","PSOSDX","RDATE" S:$D(@VAR) ZTSAVE(VAR)=""
"RTN","PSOATRD",8,0)
 . S ZTSAVE("PSODIV*")=""
"RTN","PSOATRD",9,0)
 . D ^%ZTLOAD W:$D(ZTSK) !,"Report is Queued to print !!"
"RTN","PSOATRD",10,0)
START U IO
"RTN","PSOATRD",11,0)
 N DFN,DIV,EOFLAG,LINE,PAGE,PNODE,PSA,PSAB,PSO,PSOAB,PSOAFLAG,PSOD,PSODFN,PSOERR
"RTN","PSOATRD",12,0)
 N PSON,PSOP6,PSOQUIT,PSORXDV,PSORXIN,PSOSD1,PSOT,X,Y
"RTN","PSOATRD",13,0)
 K ^TMP($J,"PSOINT") S PAGE=1,PSOQUIT=0,$P(LINE,"-",$S($G(PSORMZ):130,1:79))=""
"RTN","PSOATRD",14,0)
 S (PSOERR,PSOAFLAG)=0
"RTN","PSOATRD",15,0)
 S PSOD=0 F  S PSOD=$O(PSODIV(PSOD)) Q:'PSOD  S ^TMP($J,"PSOINT",PSOD)=""
"RTN","PSOATRD",16,0)
 S (PSA,PSOD)=0 F  S PSOD=$O(PSODIV(PSOD)) Q:'PSOD  D  Q:$G(PSODIV)="ALL"
"RTN","PSOATRD",17,0)
 .S ^TMP($J,"PSOINT",PSOD)=""
"RTN","PSOATRD",18,0)
 .S PSOSD1=PSOSD-1 F  S PSOSD1=$O(^PS(52.43,"AD",PSOSD1)) Q:'PSOSD1  I PSOSD1'<PSOSD,PSOSD1'>PSOED D
"RTN","PSOATRD",19,0)
 ..S PSA=0 F  S PSA=$O(^PS(52.43,"AD",PSOSD1,PSA)) Q:'PSA  S PSAB=$G(^PS(52.43,PSA,0)) D:$P(PSAB,"^",6)>0
"RTN","PSOATRD",20,0)
 ...S PSORXIN=$P(PSAB,"^",8),PSODFN=$P($G(^PSRX(PSORXIN,0)),"^",2),PSORXDV=$P($G(^PSRX(PSORXIN,2)),"^",9)
"RTN","PSOATRD",21,0)
 ...I $G(PSODIV)="ALL"!($$DIV^PSOATRP(PSORXIN,PSORXDV)) D SET
"RTN","PSOATRD",22,0)
 I PSODS="S" D SUMM G END ;print summary report only
"RTN","PSOATRD",23,0)
 S DIV=0 F  S DIV=$O(^TMP($J,"PSOINT",DIV)) Q:'DIV!(PSOQUIT)  D  D FO W:$E(IOST)="P" @IOF
"RTN","PSOATRD",24,0)
 .S (PSOT(1),PSOT(2),PSO(1),PSO(2),PSOT(10),PSOT(20))=0
"RTN","PSOATRD",25,0)
 .S PAGE=1 D HD I $D(^TMP($J,"PSOINT",DIV))'=11 W !!,"NO DATA FOUND TO PRINT FOR THIS RANGE.",! D:$E(IOST)="C"  S PSOERR=1 W:$E(IOST)="P" @IOF
"RTN","PSOATRD",26,0)
 ..K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR W @IOF
"RTN","PSOATRD",27,0)
 .S PSOSD=0 F  S PSOSD=$O(^TMP($J,"PSOINT",DIV,PSOSD)) Q:'PSOSD!(PSOQUIT)  D PRTD S (PSOT(1),PSOT(2),PSOT(10),PSOT(20),PSODFN)=0 D  D FO1
"RTN","PSOATRD",28,0)
 ..F  S PSODFN=$O(^TMP($J,"PSOINT",DIV,PSOSD,PSODFN)) Q:'PSODFN!(PSOQUIT)  S (PSON,PSORXIN)=0 D
"RTN","PSOATRD",29,0)
 ...F  S PSORXIN=$O(^TMP($J,"PSOINT",DIV,PSOSD,PSODFN,PSORXIN)) Q:'PSORXIN!(PSOQUIT)  D SET1 D PRT
"RTN","PSOATRD",30,0)
END D:$E(IOST)="C"&('$G(PSOQUIT))&('$G(PSOERR))  K ^TMP($J,"PSOINT") W:$E(IOST)="P" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOATRD",31,0)
 .W !!,"** END OF REPORT **"
"RTN","PSOATRD",32,0)
 .W !! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOATRD",33,0)
 ;
"RTN","PSOATRD",34,0)
HD ;PRINT PAGE HEADING
"RTN","PSOATRD",35,0)
 W:$G(PAGE)'=1!($E(IOST)="C") @IOF W !,"INTERNET REFILL BY DATE - "_$S(PSODS="D":" Detail",1:"Summary")
"RTN","PSOATRD",36,0)
 W ?41,$P(RDATE,":",1,2) W ?$S($G(PSORMZ):120,1:68),"PAGE: "_PAGE
"RTN","PSOATRD",37,0)
 W !,$S(PSODS="D":"Not Filled - ",1:"")_"For date range "_$G(PSOSDX)_" through "_$G(PSOEDX)_" for "_$P(^PS(59,DIV,0),"^")
"RTN","PSOATRD",38,0)
 I PSODS="S" W !!,"Date Processed",?35,"Filled",?48,"Not Filled",?63,"Total"
"RTN","PSOATRD",39,0)
 E  W !!,"Patient",?30,"Rx #" W:'$G(PSORMZ) ! W ?$S($G(PSORMZ):56,1:20),"Reason"
"RTN","PSOATRD",40,0)
 W !,LINE S PAGE=PAGE+1
"RTN","PSOATRD",41,0)
 Q
"RTN","PSOATRD",42,0)
PRT ;PRINT REPORT
"RTN","PSOATRD",43,0)
 S EOFLAG=0 I ($Y+5)>IOSL D  Q:PSOQUIT
"RTN","PSOATRD",44,0)
 .I $E(IOST)="C" W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR K DIR S:'Y PSOQUIT=1 I 'PSOQUIT S EOFLAG=1 D HD
"RTN","PSOATRD",45,0)
 .I $E(IOST)'="C" S EOFLAG=1 D HD
"RTN","PSOATRD",46,0)
 S PNODE=$G(^PS(52.43,$P(PSOAB,"^"),0)),PSOP6=$P(PNODE,"^",6)
"RTN","PSOATRD",47,0)
 I PSODS="S" W ?35,PSO(1),?48,PSO(2),?63,(PSO(1)+PSO(2))
"RTN","PSOATRD",48,0)
 E  W !,$S(PSON=1:$P(PSOAB,"^",2)_" ("_$P(PSOAB,"^",3)_")",1:""),?30,$P(PNODE,"^",3) W:'$G(PSORMZ) ! W ?$S($G(PSORMZ):56,1:20),$P(PNODE,"^",10)
"RTN","PSOATRD",49,0)
 Q
"RTN","PSOATRD",50,0)
PRTD S Y=PSOSD D DD^%DT W !,Y
"RTN","PSOATRD",51,0)
 Q
"RTN","PSOATRD",52,0)
FO I PSODS="S",$D(^TMP($J,"PSOINT",DIV))=11 W !!,"COUNT: ",?35,PSOT(1),?48,PSOT(2),?63,(PSOT(1)+PSOT(2)) G T1
"RTN","PSOATRD",53,0)
 Q:$D(^TMP($J,"PSOINT",DIV))'=11  D:PSODS="D"
"RTN","PSOATRD",54,0)
 .W !!,"Total transactions for date range "_$G(PSOSDX)_" through "_$G(PSOEDX)_" = "_(PSOT(10)+PSOT(20))
"RTN","PSOATRD",55,0)
T1 I $E(IOST)="C" W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOATRD",56,0)
 Q
"RTN","PSOATRD",57,0)
FO1 ;
"RTN","PSOATRD",58,0)
 S PSOT(10)=PSOT(10)+PSO(1),PSOT(20)=PSOT(20)+PSO(2)
"RTN","PSOATRD",59,0)
 I $D(^TMP($J,"PSOINT",DIV))=11 W !,"Count: ",PSOT(2),!
"RTN","PSOATRD",60,0)
 Q
"RTN","PSOATRD",61,0)
SET I PSODS="D",($P(PSAB,"^",6)=1) Q
"RTN","PSOATRD",62,0)
 S DFN=PSODFN D DEM^VADPT
"RTN","PSOATRD",63,0)
 S ^TMP($J,"PSOINT",PSORXDV,PSOSD1,PSODFN,PSORXIN)=PSA_"^"_VADM(1)_"^"_VA("BID")
"RTN","PSOATRD",64,0)
 Q
"RTN","PSOATRD",65,0)
SET1 K PSPC
"RTN","PSOATRD",66,0)
 S PSOAB=$G(^TMP($J,"PSOINT",DIV,PSOSD,PSODFN,PSORXIN)),PNODE=$G(^PS(52.43,$P(PSOAB,"^"),0))
"RTN","PSOATRD",67,0)
 S PSPC=$P(PNODE,"^",6),PSO(PSPC)=PSO(PSPC)+1,PSOT(PSPC)=PSOT(PSPC)+1,PSON=PSON+1
"RTN","PSOATRD",68,0)
 Q
"RTN","PSOATRD",69,0)
SUMM ;
"RTN","PSOATRD",70,0)
 S DIV=0 F  S DIV=$O(^TMP($J,"PSOINT",DIV)) Q:'DIV!(PSOQUIT)  D  D FO W:$E(IOST)="P" @IOF
"RTN","PSOATRD",71,0)
 .S (PSOT(1),PSOT(2),PSO(1),PSO(2),PSOT(10),PSOT(20))=0
"RTN","PSOATRD",72,0)
 .S PAGE=1 D HD I $D(^TMP($J,"PSOINT",DIV))'=11 W !!,"NO DATA FOUND TO PRINT FOR THIS RANGE.",! D:$E(IOST)="C"  S PSOERR=1
"RTN","PSOATRD",73,0)
 ..K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR W @IOF
"RTN","PSOATRD",74,0)
 .S PSOSD=0 F  S PSOSD=$O(^TMP($J,"PSOINT",DIV,PSOSD)) Q:'PSOSD!(PSOQUIT)  D PRTD S (PSO(1),PSO(2),PSOT(10),PSOT(20),PSODFN)=0 D  D PRT
"RTN","PSOATRD",75,0)
 ..F  S PSODFN=$O(^TMP($J,"PSOINT",DIV,PSOSD,PSODFN)) Q:'PSODFN!(PSOQUIT)  S (PSON,PSORXIN)=0 D
"RTN","PSOATRD",76,0)
 ...F  S PSORXIN=$O(^TMP($J,"PSOINT",DIV,PSOSD,PSODFN,PSORXIN)) Q:'PSORXIN!(PSOQUIT)  D SET1 S PSOT(10)=PSOT(1),PSOT(20)=PSOT(2)
"RTN","PSOATRD",77,0)
 Q
"RTN","PSOATRF")
0^2^B73020434^n/a
"RTN","PSOATRF",1,0)
PSOATRF ;BIR/MHA - Automate Internet Refill ;07/09/07
"RTN","PSOATRF",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**264**;DEC 1997;Build 19
"RTN","PSOATRF",3,0)
 ;Reference to ^PSSLOCK supported by DBIA 2789
"RTN","PSOATRF",4,0)
 ;Reference ^PSDRUG supported by DBIA 221
"RTN","PSOATRF",5,0)
 ;Reference ^PS(55 supported by DBIA 2228
"RTN","PSOATRF",6,0)
 ;
"RTN","PSOATRF",7,0)
START ;
"RTN","PSOATRF",8,0)
 S PSOITMG="",U="^",PSOITNS="PSOATRF"  S:'$G(DT) DT=$$DT^XLFDT
"RTN","PSOATRF",9,0)
 I '$D(^PS(52.43,"AINST")) S PSOITMG="There are no internet refills to process." G END
"RTN","PSOATRF",10,0)
 S (SITE,DA)=$P(^XMB(1,1,"XUS"),U,17),DIC="4",DIQ(0)="IE",DR=".01;99",DIQ="PSOUTIL" D EN^DIQ1
"RTN","PSOATRF",11,0)
 S PSOINST=$G(PSOUTIL(4,SITE,99,"I"))
"RTN","PSOATRF",12,0)
 I PSOINST']"" S PSOITMG="The Institution "_SITE_" is not defined in the INSTITUTION file (#4)." G END
"RTN","PSOATRF",13,0)
 S PSXSYS=+$O(^PSX(550,"C",""))_"^"_$G(PSOINST)_"^"_$G(PSOUTIL(4,SITE,.01,"E"))
"RTN","PSOATRF",14,0)
 K SITE,DA,PSOUTIL,DIQ
"RTN","PSOATRF",15,0)
 I $G(PSXSYS) D
"RTN","PSOATRF",16,0)
 . K:($P($G(^PSX(550,+PSXSYS,0)),"^",2)'="A") PSXSYS
"RTN","PSOATRF",17,0)
 . I $$VERSION^XPDUTL("PSO")<7.0 K PSXSYS
"RTN","PSOATRF",18,0)
 S DUZ=$O(^XUSEC("PSOAUTRF","")) I 'DUZ S PSOITMG="There are no users with PSOAUTRF key, at least one should have this key." G END
"RTN","PSOATRF",19,0)
 I '$D(^PS(52.43,"AINST",PSOINST)) S PSOITMG="There are no internet refills to process for Institution "_PSOINST G END
"RTN","PSOATRF",20,0)
 L +^XTMP(PSOITNS):3 E  S PSOITMG="Automate Internet Refill job is currently running - Try later." G END
"RTN","PSOATRF",21,0)
 K ^XTMP(PSOITNS,$J)
"RTN","PSOATRF",22,0)
 S PSOSYS=$G(^PS(59.7,1,40.1))
"RTN","PSOATRF",23,0)
 S (I,J,PSOITDD)=0 F  S I=$O(^PS(59,I)) Q:'I  I '$P($G(^PS(59,I,"I")),U)!(DT<$P($G(^("I")),U)) S J=J+1 D  G:PSOITMG]"" END
"RTN","PSOATRF",24,0)
 . S PSOSITE(I)=I,PSOSNM(I)=$P(^PS(59,I,0),U),PSORFN(I)=$G(^PS(59,I,"RF")),PSOPAR(I)=$G(^PS(59,I,1)),PSOPRPAS(I)=$P($G(PSOPAR),U,7)
"RTN","PSOATRF",25,0)
 . S PSOPAR7(I)=$G(^PS(59,I,"IB")),PSOPINST(I)=$P($G(^PS(59,I,"INI")),U)
"RTN","PSOATRF",26,0)
 . I J=1 D SDIV S PSOITDD=I
"RTN","PSOATRF",27,0)
 I 'J S PSOITMG="There are no active divisions in File #(59) - At least one division should be active - None processed." G END
"RTN","PSOATRF",28,0)
 D PRORF
"RTN","PSOATRF",29,0)
END ;
"RTN","PSOATRF",30,0)
 I $D(^XTMP(PSOITNS,$J)) D SMAIL^PSOATRF1 G:'$G(PSOITC) KV
"RTN","PSOATRF",31,0)
 S PSOITMG(1)=$S($G(PSOITC):"Total internet refills processed = "_PSOITC,PSOITMG="":"There are no internet refills to process.",1:PSOITMG)
"RTN","PSOATRF",32,0)
 D GRP
"RTN","PSOATRF",33,0)
 S:'$O(XMY(0)) XMY(DUZ)=""
"RTN","PSOATRF",34,0)
 S XMDUZ=.5,XMSUB="Outpatient Pharmacy - PSO AUTO REFILL"
"RTN","PSOATRF",35,0)
 S XMTEXT="PSOITMG(" N DIFROM D ^XMD K XMDUZ,XMTEXT,XMSUB
"RTN","PSOATRF",36,0)
KV ;
"RTN","PSOATRF",37,0)
 L -^XTMP(PSOITNS) K ^XTMP(PSOITNS)
"RTN","PSOATRF",38,0)
 K DFN,PSODFN,PSODTCUT,PSOITMG,PSOITNF,PSOITNS,PSOITC,PSOITDD,PSOITF,PSOITP,PSOITR
"RTN","PSOATRF",39,0)
 K PSOINST,PSOPAR,PSOPINST,PSOPRPAS,PSOPAR7,PSOPTPST,PSOSITE,PSOSNM,PSOSYS,PSORFN
"RTN","PSOATRF",40,0)
 K DRG,DIVN,PSXSYS,RX,RX0,RXN,VA,ZZ,LC,PSOS,XMY,PSOREA,PSOSTAT,PSOD
"RTN","PSOATRF",41,0)
 Q
"RTN","PSOATRF",42,0)
 ;
"RTN","PSOATRF",43,0)
PRORF ;
"RTN","PSOATRF",44,0)
 S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X
"RTN","PSOATRF",45,0)
 S PSOITR="",PSOITC=0
"RTN","PSOATRF",46,0)
 F  S PSOITR=$O(^PS(52.43,"AINST",PSOINST,PSOITR)) Q:'PSOITR  D  D:PSOITMG]"" FILE D ULK
"RTN","PSOATRF",47,0)
 . S (PSOITF,PSOITNF)=0,PSOITMG="",PSOITRX=+PSOITR,PSOITP=$O(^PS(52.43,"AINST",PSOINST,PSOITRX,""))
"RTN","PSOATRF",48,0)
 . Q:'PSOITP
"RTN","PSOATRF",49,0)
 . I '$D(^PS(52.43,PSOITP))!($P(^(PSOITP,0),U,5)'="") K ^PS(52.43,"AINST",PSOINST,PSOITRX,PSOITP) Q
"RTN","PSOATRF",50,0)
 . I '$D(^PSRX(PSOITRX,0))!($P(^(0),U)="")!('$D(^(2)))!($P(^("STA"),U)=13) S PSOITNF=1,PSOITMG="Rx IEN "_PSOITRX_" not in file (#52)/Incomplete/Deleted" Q
"RTN","PSOATRF",51,0)
 . D PSOL^PSSLOCK(PSOITRX) I '$G(PSOMSG) K PSOMSG Q
"RTN","PSOATRF",52,0)
 . K PSOMSG
"RTN","PSOATRF",53,0)
 . S PSOITRX0=^PSRX(PSOITRX,0),PSOITRX2=^(2),PSOITRX3=^(3),PSOITRXS=^("STA")
"RTN","PSOATRF",54,0)
 . S (DFN,PSODFN)=$P(PSOITRX0,U,2),RXN=$P(PSOITRX0,U),DRG=$P(PSOITRX0,U,6)
"RTN","PSOATRF",55,0)
 . I PSODFN'=$P(^PS(52.43,PSOITP,0),U,9) D  Q
"RTN","PSOATRF",56,0)
 . . S PSOITNF=1,PSOITMG="Can't refill Rx # "_RXN_", it is not for this patient. DFN in file #52="_DFN_", DFN in file #52.43="_$P(^PS(52.43,PSOITP,0),U,9)
"RTN","PSOATRF",57,0)
 . D GET^PSOPTPST
"RTN","PSOATRF",58,0)
 . I $G(PSOPTPST(2,PSODFN,.351))]"" S PSOITNF=1,PSOITMG="Patient Died on "_PSOPTPST(2,PSODFN,.351) Q
"RTN","PSOATRF",59,0)
 . D ICN^PSODPT(DFN)
"RTN","PSOATRF",60,0)
 . S PSOLOUD=1 D:$P($G(^PS(55,DFN,0)),U,6)'=2 EN^PSOHLUP(DFN) K PSOLOUD
"RTN","PSOATRF",61,0)
 . I '$P(PSOPAR,U,11),$G(^PSDRUG(DRG,"I"))]"",DT>$G(^("I")) D  Q
"RTN","PSOATRF",62,0)
 . . S PSOITNF=1,PSOITMG="Drug is inactive for Rx # "_RXN_" cannot be refilled"
"RTN","PSOATRF",63,0)
 . S I=$P(^PSRX(PSOITRX,2),U,9) S:'I I=PSOITDD D SDIV
"RTN","PSOATRF",64,0)
 . I $G(PSOPTPST(2,PSODFN,.1))]"",'PSORFN S PSOITNF=1,PSOITMG="Patient is an Inpatient on Ward "_PSOPTPST(2,PSODFN,.1) Q
"RTN","PSOATRF",65,0)
 . I $G(PSOPTPST(2,PSODFN,148))="YES",'$P(PSORFN,U,2) S PSOITNF=1,PSOITMG="Patient is in a Contract Nursing Home" Q
"RTN","PSOATRF",66,0)
 . D CHKRF Q:PSOITNF
"RTN","PSOATRF",67,0)
 . I $O(^PS(52.5,"B",PSOITRX,0)),'$G(^PS(52.5,+$O(^PS(52.5,"B",PSOITRX,0)),"P")) S PSOITNF=1,PSOITMG="Rx is in suspense and cannot be refilled" Q
"RTN","PSOATRF",68,0)
 . S PSOY=1+$$LSTRFL^PSOBPSU1(PSOITRX)
"RTN","PSOATRF",69,0)
 . I PSOY>$P(PSOITRX0,U,9) S PSOITNF=1,PSOITMG="Can't refill, no refills remaining" Q
"RTN","PSOATRF",70,0)
 . S (PSOITF,PSOX("NUMBER"))=PSOY
"RTN","PSOATRF",71,0)
 . S PSOX("RX0")=PSOITRX0,PSOX("RX2")=PSOITRX2,PSOX("RX3")=PSOITRX3,PSOX("STA")=PSOITRXS
"RTN","PSOATRF",72,0)
 . S DRG=$P(PSOITRX0,U,6)
"RTN","PSOATRF",73,0)
 . N PSODEA,PSODAY
"RTN","PSOATRF",74,0)
 . S PSODEA=$P($G(^PSDRUG(DRG,0)),U,3)
"RTN","PSOATRF",75,0)
 . S PSODAY=$P(PSOITRX0,U,8)
"RTN","PSOATRF",76,0)
 . I $$DEACHK^PSOUTLA1(PSOITRX,PSODEA,PSODAY) D  Q
"RTN","PSOATRF",77,0)
 . . S PSOITNF=1,PSOITMG="This drug has been changed, No refills allowed"
"RTN","PSOATRF",78,0)
 . D CHKDT Q:PSOITNF
"RTN","PSOATRF",79,0)
 . D EN^PSOR52(.PSOX) I PSOITF,$D(^PSRX(PSOITRX,1,PSOITF,0)) S PSOITC=PSOITC+1,PSOITMG=PSOITF_" Susp. until "_$$DSP($P(^(0),U))
"RTN","PSOATRF",80,0)
 Q
"RTN","PSOATRF",81,0)
 ;
"RTN","PSOATRF",82,0)
CHKRF ;
"RTN","PSOATRF",83,0)
 D ^PSOBUILD
"RTN","PSOATRF",84,0)
 I '$G(PSOSD) S PSOITNF=1,PSOITMG="This patient has no prescriptions" Q
"RTN","PSOATRF",85,0)
 S (PSOX,PSOY,PSOS)="",PSOX("STA")=PSOITRXS
"RTN","PSOATRF",86,0)
 F  S PSOS=$O(PSOSD(PSOS)) Q:PSOS=""  F  S PSOX=$O(PSOSD(PSOS,PSOX)) Q:PSOX']""  D
"RTN","PSOATRF",87,0)
 . I PSOITRX=+PSOSD(PSOS,PSOX) S PSOY=PSOSD(PSOS,PSOX) I $P(PSOY,U,4)]"" D
"RTN","PSOATRF",88,0)
 . . S PSOITNF=1,PSOITMG="Cannot refill Rx # "_RXN
"RTN","PSOATRF",89,0)
 . . S PSOREA=$P(PSOY,U,4),PSOSTAT=PSOX("STA")
"RTN","PSOATRF",90,0)
 . . I PSOREA["Z" S:PSOSTAT=4 PSOSTAT=1 D  Q
"RTN","PSOATRF",91,0)
 . . . S PSOA=";"_PSOSTAT,PSOB=$P(^DD(52,100,0),U,3),PSOA=$F(PSOB,PSOA),PSOA=$P($E(PSOB,PSOA,999),";",1)
"RTN","PSOATRF",92,0)
 . . . S PSOITMG=PSOITMG_" Rx is in "_$P(PSOA,":",2)_" status"
"RTN","PSOATRF",93,0)
 . . . K PSOA,PSOB
"RTN","PSOATRF",94,0)
 . . I PSOREA["M" S PSOITMG=PSOITMG_" Drug no longer used by Outpatient Pharmacy" Q
"RTN","PSOATRF",95,0)
 . . I PSOREA["B" S PSOITMG=PSOITMG_" Narcotic Drug" Q
"RTN","PSOATRF",96,0)
 . . I PSOREA["C" S PSOITMG=PSOITMG_" Non-Renewable Drug" Q
"RTN","PSOATRF",97,0)
 . . I PSOREA["D" S PSOITMG=PSOITMG_" Non-Renewable Patient Status" Q
"RTN","PSOATRF",98,0)
 . . I PSOREA["E" S PSOITMG=PSOITMG_" Non-Verified Rx" Q
"RTN","PSOATRF",99,0)
 . . I PSOREA["G",PSOREA'["B" S PSOITMG=PSOITMG_" No more refills left"
"RTN","PSOATRF",100,0)
 I PSOY="" S PSOITNF=1,PSOITMG="Cannot refill, Rx is DC/Exp. Later Rx may exist " D
"RTN","PSOATRF",101,0)
 . S (PSOS,PSOX)="",PSOD=$P(^PSDRUG($P(PSOITRX0,U,6),0),U)
"RTN","PSOATRF",102,0)
 . N ZRX S ZRX="" F  S PSOS=$O(PSOSD(PSOS)) Q:PSOS=""  F  S PSOX=$O(PSOSD(PSOS,PSOX)) Q:PSOX']""  I PSOD=PSOX,+PSOSD(PSOS,PSOX) S ZRX=$P($G(^PSRX(+PSOSD(PSOS,PSOX),0)),U)
"RTN","PSOATRF",103,0)
 . S PSOITMG=PSOITMG_ZRX
"RTN","PSOATRF",104,0)
 Q
"RTN","PSOATRF",105,0)
  ;
"RTN","PSOATRF",106,0)
FILE ;
"RTN","PSOATRF",107,0)
 K DIE S DA=PSOITP
"RTN","PSOATRF",108,0)
 S DIE="^PS(52.43,",DR="5////"_DT_";6///"_$S(PSOITNF:"NOT ",1:"")_"FILLED;10////"_PSOITMG D ^DIE
"RTN","PSOATRF",109,0)
 K ^PS(52.43,"AINST",PSOINST,PSOITRX,DA) I PSOITNF  S ^XTMP(PSOITNS,$J,PSOSITE,DFN,PSOITRX)=PSOITMG
"RTN","PSOATRF",110,0)
 Q
"RTN","PSOATRF",111,0)
 ;
"RTN","PSOATRF",112,0)
GRP ;
"RTN","PSOATRF",113,0)
 S MDUZ=0
"RTN","PSOATRF",114,0)
 I '$D(^XUSEC("PSOAUTRF")) D  Q
"RTN","PSOATRF",115,0)
 . F  S MDUZ=$O(^XUSEC("PSORPH",MDUZ)) Q:MDUZ'>0  S XMY(MDUZ)=""
"RTN","PSOATRF",116,0)
 F  S MDUZ=$O(^XUSEC("PSOAUTRF",MDUZ)) Q:MDUZ'>0  S XMY(MDUZ)=""
"RTN","PSOATRF",117,0)
 K MDUZ Q
"RTN","PSOATRF",118,0)
 ;
"RTN","PSOATRF",119,0)
ULK ;
"RTN","PSOATRF",120,0)
 I '$G(PSOITRX) Q
"RTN","PSOATRF",121,0)
 D PSOUL^PSSLOCK(PSOITRX)
"RTN","PSOATRF",122,0)
 K PSOITRX,PSOSD,PSOX,PSORX,PSOITRX0,PSOITRX2,PSOITRX3,PSOITRXS
"RTN","PSOATRF",123,0)
 Q
"RTN","PSOATRF",124,0)
SETUP ;
"RTN","PSOATRF",125,0)
 I '$D(^XUSEC("PSOAUTRF",DUZ)) W !,"You must hold the PSOAUTRF key to run this option!" Q
"RTN","PSOATRF",126,0)
 N PATCH,JOBN
"RTN","PSOATRF",127,0)
 S JOBN="PSO AUTO REFILL"
"RTN","PSOATRF",128,0)
 L +^XTMP("PSOATRF"):5 I '$T D  Q
"RTN","PSOATRF",129,0)
 .D BMES^XPDUTL("The Refill Automation job is currently running, try later.")
"RTN","PSOATRF",130,0)
 .D MES^XPDUTL("")
"RTN","PSOATRF",131,0)
 .S DIR(0)="E",DIR("A")=" Press ENTER to Continue" D ^DIR K DIR
"RTN","PSOATRF",132,0)
 K %DT,DIC,DTOUT S DIC(0)="XZM",DIC="^DIC(19.2,",X="PSO AUTO REFILL" D ^DIC
"RTN","PSOATRF",133,0)
 I +Y>0 D EDIT^XUTMOPT("PSO AUTO REFILL") G EX
"RTN","PSOATRF",134,0)
 D RESCH^XUTMOPT("PSO AUTO REFILL","","","24H","L"),EDIT^XUTMOPT("PSO AUTO REFILL") K DIC,Y,X
"RTN","PSOATRF",135,0)
EX ;
"RTN","PSOATRF",136,0)
 L -^XTMP("PSOATRF") K Y,C,D,D0,DI,DQ,DA,DIE,DR,DIC,X
"RTN","PSOATRF",137,0)
 Q
"RTN","PSOATRF",138,0)
 ;
"RTN","PSOATRF",139,0)
SDIV ;
"RTN","PSOATRF",140,0)
 S PSOSITE=PSOSITE(I),PSOPAR=PSOPAR(I),PSOPRPAS=PSOPRPAS(I),PSORFN=PSORFN(I)
"RTN","PSOATRF",141,0)
 S PSOPAR7=PSOPAR7(I),PSOPINST=PSOPINST(I)
"RTN","PSOATRF",142,0)
 Q
"RTN","PSOATRF",143,0)
 ;
"RTN","PSOATRF",144,0)
CHKDT ;
"RTN","PSOATRF",145,0)
 S PSOX("IRXN")=PSOITRX
"RTN","PSOATRF",146,0)
 S PSOX("MAIL/WINDOW")="M",PSOX("FLD")=2,PSOX("QS")="S"
"RTN","PSOATRF",147,0)
 S PSOX("FIELD")=0,(PSORX("FILL DATE"),PSOX("FILL DATE"))=DT,PSOX("FLD")=1,X1=DT,X2=-180
"RTN","PSOATRF",148,0)
 D C^%DTC S PSOX("ISSUE DATE")=X,PSOX("CLERK CODE")=DUZ
"RTN","PSOATRF",149,0)
 S PSOX("STOP DATE")=$P(PSOITRX2,U,6) D NEXT
"RTN","PSOATRF",150,0)
 I PSOX("FILL DATE")<$P(PSOITRX3,U,2) D SUSDATE^PSOUTIL(.PSOX)
"RTN","PSOATRF",151,0)
 I PSOX("FILL DATE")>PSOX("STOP DATE") S PSOITNF=1 D  Q
"RTN","PSOATRF",152,0)
 .S PSOITMG="Can't refill, Refill Date "_$$DSP(PSOX("FILL DATE"))
"RTN","PSOATRF",153,0)
 .S PSOITMG=PSOITMG_" is past Expiration Date "_$$DSP(PSOX("STOP DATE"))
"RTN","PSOATRF",154,0)
 S PSOX("LAST REFILL DATE")=$P(PSOITRX3,U,1)
"RTN","PSOATRF",155,0)
 I PSOX("LAST REFILL DATE"),PSOX("FILL DATE")=PSOX("LAST REFILL DATE") S PSOITNF=1 D  Q
"RTN","PSOATRF",156,0)
 .S PSOITMG="Can't refill, Fill Date already exists for "_$$DSP(PSOX("FILL DATE"))
"RTN","PSOATRF",157,0)
 I PSOX("LAST REFILL DATE"),PSOX("FILL DATE")<PSOX("LAST REFILL DATE") S PSOITNF=1 D  Q
"RTN","PSOATRF",158,0)
 .S PSOITMG="Can't refill, later Refill Date already exists for "_$$DSP(PSOX("LAST REFILL DATE"))
"RTN","PSOATRF",159,0)
 Q
"RTN","PSOATRF",160,0)
 ;
"RTN","PSOATRF",161,0)
NEXT ;
"RTN","PSOATRF",162,0)
 S PSOX1=$P(PSOITRX2,U,2)
"RTN","PSOATRF",163,0)
 I '$O(^PSRX(PSOITRX,1,0)) D  Q
"RTN","PSOATRF",164,0)
 . S $P(PSOITRX3,U)=PSOX1,X1=PSOX1
"RTN","PSOATRF",165,0)
 . S X2=$P(PSOITRX0,U,8)-10\1
"RTN","PSOATRF",166,0)
 . D C^%DTC
"RTN","PSOATRF",167,0)
 . S:'$P(PSOITRX3,U,8) $P(PSOITRX3,U,2)=X K X
"RTN","PSOATRF",168,0)
 S PSOY2=0
"RTN","PSOATRF",169,0)
 F PSOY=0:0 S PSOY=$O(^PSRX(PSOITRX,1,PSOY)) Q:'PSOY  S PSOY1=PSOY,PSOY2=PSOY2+1
"RTN","PSOATRF",170,0)
 S PSOY=^PSRX(PSOITRX,1,PSOY1,0)
"RTN","PSOATRF",171,0)
 S PSOX2=$P(PSOY,U)
"RTN","PSOATRF",172,0)
 S $P(PSOITRX3,U)=PSOX2,X1=PSOX2
"RTN","PSOATRF",173,0)
 S X2=$P(PSOITRX0,U,8)-10\1
"RTN","PSOATRF",174,0)
 D C^%DTC S PSOY3=X
"RTN","PSOATRF",175,0)
 S X1=PSOX1,X2=(PSOY2+1)*$P(PSOITRX0,U,8)-10\1
"RTN","PSOATRF",176,0)
 D C^%DTC S PSOY4=X
"RTN","PSOATRF",177,0)
 S $P(PSOITRX3,U,2)=$S(PSOY3<PSOY4:PSOY4,1:PSOY3)
"RTN","PSOATRF",178,0)
 K X,PSOX1,PSOX2,PSOY,PSOY1,PSOY2,PSOY3,PSOY4
"RTN","PSOATRF",179,0)
 Q
"RTN","PSOATRF",180,0)
 ;
"RTN","PSOATRF",181,0)
DSP(X) ;
"RTN","PSOATRF",182,0)
 Q:'X ""
"RTN","PSOATRF",183,0)
 Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","PSOATRF",184,0)
 ; 
"RTN","PSOATRF1")
0^16^B4764238^n/a
"RTN","PSOATRF1",1,0)
PSOATRF1 ;BIR/MHA - Automate Internet Refill Cont ;07/24/07
"RTN","PSOATRF1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**264**;DEC 1997;Build 19
"RTN","PSOATRF1",3,0)
 ;Reference ^PSDRUG supported by DBIA 221
"RTN","PSOATRF1",4,0)
 ;
"RTN","PSOATRF1",5,0)
SMAIL ;
"RTN","PSOATRF1",6,0)
 S ZZ="PSOATRF"
"RTN","PSOATRF1",7,0)
 S DV="" F  S DV=$O(^XTMP(ZZ,$J,DV)) Q:DV=""  S DIVN=$P(^PS(59,DV,0),U) D BMAIL
"RTN","PSOATRF1",8,0)
 K ^TMP(ZZ,$J)
"RTN","PSOATRF1",9,0)
 Q
"RTN","PSOATRF1",10,0)
 ;
"RTN","PSOATRF1",11,0)
BMAIL ;
"RTN","PSOATRF1",12,0)
 K ^TMP(ZZ,$J)
"RTN","PSOATRF1",13,0)
 S XMSUB=DIVN_" Internet Refills Not Processed List, ",XMDUZ=.5,XMDUN="Pharmacy Manager"
"RTN","PSOATRF1",14,0)
 S LC=1,^TMP(ZZ,$J,LC)="Internet Refills Not Processed Report for the "_DIVN_" Division.",LC=LC+1
"RTN","PSOATRF1",15,0)
 S ^TMP(ZZ,$J,LC)="",LC=LC+1
"RTN","PSOATRF1",16,0)
 S ^TMP(ZZ,$J,LC)="The following refill requests were not processed:  ",LC=LC+1
"RTN","PSOATRF1",17,0)
 S ^TMP(ZZ,$J,LC)="",LC=LC+1
"RTN","PSOATRF1",18,0)
 S DFN="" F  S DFN=$O(^XTMP(ZZ,$J,DV,DFN)) Q:DFN=""  D
"RTN","PSOATRF1",19,0)
 .D PID^VADPT
"RTN","PSOATRF1",20,0)
 .S ^TMP(ZZ,$J,LC)="Patient: "_$P(^DPT(DFN,0),U)_"   SSN: "_$G(VA("BID")),LC=LC+1
"RTN","PSOATRF1",21,0)
 .S ^TMP(ZZ,$J,LC)="",LC=LC+1
"RTN","PSOATRF1",22,0)
 .S RX="" F  S RX=$O(^XTMP(ZZ,$J,DV,DFN,RX)) Q:RX=""  D
"RTN","PSOATRF1",23,0)
 ..I '$D(^PSRX(RX,0)) S ^TMP(ZZ,$J,LC)="There is no data for IEN #: "_RX,LC=LC+1 Q
"RTN","PSOATRF1",24,0)
 ..S RX0=^PSRX(RX,0)
"RTN","PSOATRF1",25,0)
 ..S ^TMP(ZZ,$J,LC)="  Rx #: "_$P(RX0,U)_"  (REF #"_(1+$$LSTRFL^PSOBPSU1(RX))_")  Qty: "_$P(RX0,U,7),LC=LC+1
"RTN","PSOATRF1",26,0)
 ..S ^TMP(ZZ,$J,LC)="  Drug: "_$S($P(^PSDRUG($P(RX0,U,6),0),U)]"":$P(^PSDRUG($P(RX0,U,6),0),U),1:"UNKNOWN"),LC=LC+1
"RTN","PSOATRF1",27,0)
 ..S ^TMP(ZZ,$J,LC)="  Reason: "_^XTMP(ZZ,$J,DV,DFN,RX),LC=LC+1
"RTN","PSOATRF1",28,0)
 ..S ^TMP(ZZ,$J,LC)="  ",LC=LC+1 S ^TMP(ZZ,$J,LC)="  ",LC=LC+1
"RTN","PSOATRF1",29,0)
 D GRP^PSOATRF
"RTN","PSOATRF1",30,0)
 S:'$O(XMY(0)) XMY(DUZ)=""
"RTN","PSOATRF1",31,0)
 S XMTEXT="^TMP(""PSOATRF"",$J," N DIFROM D ^XMD K XMDUZ,XMTEXT,XMSUB
"RTN","PSOATRF1",32,0)
 Q
"RTN","PSOATRF1",33,0)
 ;
"RTN","PSOATRP")
0^3^B9028143^n/a
"RTN","PSOATRP",1,0)
PSOATRP ;BIR/SJA - INTERNET REFILL REPORT ;05/29/07 12:36pm
"RTN","PSOATRP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**264**;DEC 1997;Build 19
"RTN","PSOATRP",3,0)
 ;
"RTN","PSOATRP",4,0)
 N PSODS,PSOED,PSOEDX,PSODIV,PSOREP,PSORST,PSORMZ,PSOSD,PSOSDX,PSOSITE,RDATE,X,Y
"RTN","PSOATRP",5,0)
 S PSORMZ=0 D NOW^%DTC S Y=% X ^DD("DD") S RDATE=Y
"RTN","PSOATRP",6,0)
 ;
"RTN","PSOATRP",7,0)
 D SEL^PSOREJU1("DIVISION","^PS(59,",.PSODIV) I $G(PSODIV)="^" D MESS Q
"RTN","PSOATRP",8,0)
 I $G(PSODIV)="ALL" S PSOSITE=0 F  S PSOSITE=$O(^PS(59,PSOSITE)) Q:'PSOSITE  D
"RTN","PSOATRP",9,0)
 .I '$P($G(^PS(59,PSOSITE,"I")),"^")!(DT<$P($G(^("I")),"^")) S PSODIV(PSOSITE)=""
"RTN","PSOATRP",10,0)
 ;
"RTN","PSOATRP",11,0)
 K DIR W ! S DIR(0)="DAO^:DT:APEX",DIR("A")="Beginning Date: ",DIR("?")=" ",DIR("?",1)="Enter the date to begin searching.",DIR("?",2)="A future date cannot be entered." D ^DIR K DIR
"RTN","PSOATRP",12,0)
 I 'Y!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOATRP",13,0)
 S PSOSD=Y D DD^%DT S PSOSDX=Y
"RTN","PSOATRP",14,0)
 ;
"RTN","PSOATRP",15,0)
 W ! K DIR S DIR(0)="DAO^:DT:APEX",DIR("A")="Ending Date: ",DIR("?")=" ",DIR("?",1)="Enter the ending date of the search.",DIR("?",2)="This date cannot be a future date." D ^DIR K DIR
"RTN","PSOATRP",16,0)
 I 'Y!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOATRP",17,0)
 S PSOED=Y D DD^%DT S PSOEDX=Y
"RTN","PSOATRP",18,0)
 ;
"RTN","PSOATRP",19,0)
 W ! K DIR S DIR(0)="S^P:Patient;D:Date;R:Result;",DIR("B")="R"
"RTN","PSOATRP",20,0)
 S DIR("A")="Sort by Patient/Date/Result (P/D/R)",DIR("?")="Enter 'P' to sort by Patient, 'D' to sort by date, or 'R' to sort by result." D ^DIR K DIR
"RTN","PSOATRP",21,0)
 I $D(DTOUT)!$D(DUOUT) D MESS Q
"RTN","PSOATRP",22,0)
 S PSOREP=Y
"RTN","PSOATRP",23,0)
 ;
"RTN","PSOATRP",24,0)
 W ! K DIR S DIR(0)="S^D:Detail;S:Summary;",DIR("B")="S"
"RTN","PSOATRP",25,0)
 S DIR("A")="Print Detail/Summary report (D/S)",DIR("?")="Enter 'D' to print detail report or 'S' for summary report" D ^DIR K DIR
"RTN","PSOATRP",26,0)
 I $D(DTOUT)!$D(DUOUT) D MESS Q
"RTN","PSOATRP",27,0)
 S PSODS=Y
"RTN","PSOATRP",28,0)
 ;
"RTN","PSOATRP",29,0)
SKIPC ;
"RTN","PSOATRP",30,0)
 I PSODS="S" G SEL
"RTN","PSOATRP",31,0)
 W ! K DIR S DIR("A")="Do you want this report to print in 80 or 132 column format: "
"RTN","PSOATRP",32,0)
 S DIR("B")="80",DIR(0)="SAM^1:132;8:80" D ^DIR K DIR I Y["^"!($D(DIRUT)) D MESS Q
"RTN","PSOATRP",33,0)
 W ! S PSORMZ=$S(Y=1:1,1:0)
"RTN","PSOATRP",34,0)
 ;
"RTN","PSOATRP",35,0)
SEL D @$S(PSOREP="D":"^PSOATRD",PSOREP="R":"^PSOATRR",1:"^PSOATRPP")
"RTN","PSOATRP",36,0)
 ;
"RTN","PSOATRP",37,0)
END K X,Y,PSOSDX,PSOSD,PSOSITE,PSORST,PSOREP,PSODIV,PSOEDX,PSOED,PSODS,DIRUT,DTOUT,DUOUT
"RTN","PSOATRP",38,0)
 Q
"RTN","PSOATRP",39,0)
MESS W !!,"Nothing queued to print.",!
"RTN","PSOATRP",40,0)
 Q
"RTN","PSOATRP",41,0)
DIV(RX,DV) ; Check if the Division for the Prescription/Fill was selected by the user
"RTN","PSOATRP",42,0)
 I $G(PSODIV)="ALL" Q 1
"RTN","PSOATRP",43,0)
 I $D(PSODIV(DV)) Q 1
"RTN","PSOATRP",44,0)
 Q 0
"RTN","PSOATRPP")
0^5^B26688767^n/a
"RTN","PSOATRPP",1,0)
PSOATRPP ;BIR/SJA - INTERNET REFILL REPORT SORTED BY PATIENT ;05/29/07 12:36pm
"RTN","PSOATRPP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**264**;DEC 1997;Build 19
"RTN","PSOATRPP",3,0)
 ;
"RTN","PSOATRPP",4,0)
 K IOP,%ZIS,POP S PSOION=ION,%ZIS="MQ" D ^%ZIS I POP S IOP=PSOION D ^%ZIS K PSOION S PSOQUIT=1 G END
"RTN","PSOATRPP",5,0)
 I $D(IO("Q")) D  K PSOION,ZTSK S PSOQUIT=1 G END
"RTN","PSOATRPP",6,0)
 . N VAR K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSOATRPP",ZTDESC="INTERNET REFILL REPORT SORTED BY PATIENT"
"RTN","PSOATRPP",7,0)
 . F VAR="PSODS","PSOED","PSOEDX","PSOREP","PSORMZ","PSOSD","PSOSDX","RDATE" S:$D(@VAR) ZTSAVE(VAR)=""
"RTN","PSOATRPP",8,0)
 . S ZTSAVE("PSODIV*")=""
"RTN","PSOATRPP",9,0)
 . D ^%ZTLOAD W:$D(ZTSK) !,"Report is Queued to print !!"
"RTN","PSOATRPP",10,0)
START U IO
"RTN","PSOATRPP",11,0)
 N DFN,DIV,EOFLAG,LINE,PAGE,PNODE,PSA,PSAB,PSDD,PSO,PSOAB,PSOAFLAG,PSODFN,PSOERR,PSON,PSONAM
"RTN","PSOATRPP",12,0)
 N PSOP6,PSOPAT,PSOP5,PSORXDV,PSORXIN,PSOSD1,PSOT,PSOQUIT,X,Y
"RTN","PSOATRPP",13,0)
 K ^TMP($J,"PSOINT") S PAGE=1,PSOQUIT=0,$P(LINE,"-",$S($G(PSORMZ):130,1:79))=""
"RTN","PSOATRPP",14,0)
 S (PSOERR,PSOAFLAG)=0
"RTN","PSOATRPP",15,0)
 S PSOD=0 F  S PSOD=$O(PSODIV(PSOD)) Q:'PSOD  S ^TMP($J,"PSOINT",PSOD)=""
"RTN","PSOATRPP",16,0)
 S (PSA,PSOD)=0 F  S PSOD=$O(PSODIV(PSOD)) Q:'PSOD  D  Q:$G(PSODIV)="ALL"
"RTN","PSOATRPP",17,0)
 .S ^TMP($J,"PSOINT",PSOD)=""
"RTN","PSOATRPP",18,0)
 .S PSOSD1=PSOSD-1 F  S PSOSD1=$O(^PS(52.43,"AD",PSOSD1)) Q:'PSOSD1  I PSOSD1'<PSOSD,PSOSD1'>PSOED D
"RTN","PSOATRPP",19,0)
 ..S PSA=0 F  S PSA=$O(^PS(52.43,"AD",PSOSD1,PSA)) Q:'PSA  S PSAB=$G(^PS(52.43,PSA,0)) D:$P(PSAB,"^",6)>0
"RTN","PSOATRPP",20,0)
 ...S PSORXIN=$P(PSAB,"^",8),PSODFN=$P($G(^PSRX(PSORXIN,0)),"^",2),PSORXDV=$P($G(^PSRX(PSORXIN,2)),"^",9)
"RTN","PSOATRPP",21,0)
 ...I $G(PSODIV)="ALL"!($$DIV^PSOATRP(PSORXIN,PSORXDV)) D SET
"RTN","PSOATRPP",22,0)
 I PSODS="S" D SUMM G END ;print summary report only
"RTN","PSOATRPP",23,0)
 S DIV=0 F  S DIV=$O(^TMP($J,"PSOINT",DIV)) Q:'DIV!(PSOQUIT)  D  D FO W:$E(IOST)="P" @IOF
"RTN","PSOATRPP",24,0)
 .S (PSO("TOT"),PSO(1),PSO(2))=0
"RTN","PSOATRPP",25,0)
 .S PAGE=1 D HD I $D(^TMP($J,"PSOINT",DIV))'=11 W !!,"NO DATA FOUND TO PRINT FOR THIS RANGE.",! D:$E(IOST)="C"  S PSOERR=1
"RTN","PSOATRPP",26,0)
 ..K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOATRPP",27,0)
 .S PSONAM="" F  S PSONAM=$O(^TMP($J,"PSOINT",DIV,PSONAM)) Q:PSONAM=""!(PSOQUIT)  S PSOPAT=0 D  D FO1
"RTN","PSOATRPP",28,0)
 ..S (PSON,PSORXIN)=0 F  S PSORXIN=$O(^TMP($J,"PSOINT",DIV,PSONAM,PSORXIN)) Q:'PSORXIN!(PSOQUIT)  S PSDD=0 F  S PSDD=$O(^TMP($J,"PSOINT",DIV,PSONAM,PSORXIN,PSDD)) Q:'PSDD!(PSOQUIT)  D
"RTN","PSOATRPP",29,0)
 ...S PSOPAT=PSOPAT+1,PSO("TOT")=PSO("TOT")+1,PSON=PSON+1,PSOAB=$G(^TMP($J,"PSOINT",DIV,PSONAM,PSORXIN,PSDD)) D PRT
"RTN","PSOATRPP",30,0)
END D:$E(IOST)="C"&('$G(PSOQUIT))&('$G(PSOERR))  K ^TMP($J,"PSOINT") W:$E(IOST)="P" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOATRPP",31,0)
 .W !!,"** END OF REPORT **"
"RTN","PSOATRPP",32,0)
 .W !! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOATRPP",33,0)
 ;
"RTN","PSOATRPP",34,0)
HD ;PRINT PAGE HEADING
"RTN","PSOATRPP",35,0)
 W:$G(PAGE)'=1!($E(IOST)="C") @IOF W !,"INTERNET REFILL REPORT BY PATIENT - "_$S(PSODS="D":"Detail",1:"Summary")
"RTN","PSOATRPP",36,0)
 W ?45,$TR(RDATE,"@"," ") W ?$S($G(PSORMZ):120,1:68),"PAGE: "_PAGE
"RTN","PSOATRPP",37,0)
 W !,$S(PSODS="D":"Not Filled - ",1:"")_"For date range "_$G(PSOSDX)_" through "_$G(PSOEDX)_" for "_$P(^PS(59,DIV,0),"^")
"RTN","PSOATRPP",38,0)
 I PSODS="S" W !!,"Patient",?35,"Filled",?48,"Not Filled",?63,"Total"
"RTN","PSOATRPP",39,0)
 E  W !!,"Patient",?28,"Rx #",?42,"Date" W:'$G(PSORMZ) ! W ?$S($G(PSORMZ):56,1:20),"Reason"
"RTN","PSOATRPP",40,0)
 W !,LINE S PAGE=PAGE+1
"RTN","PSOATRPP",41,0)
 Q
"RTN","PSOATRPP",42,0)
PRT ;PRINT REPORT
"RTN","PSOATRPP",43,0)
 I PSODS="S" S PSOT(1)=PSOT(1)+PSO(1),PSOT(2)=PSOT(2)+PSO(2)
"RTN","PSOATRPP",44,0)
 S EOFLAG=0 I ($Y+5)>IOSL D  Q:PSOQUIT
"RTN","PSOATRPP",45,0)
 .I $E(IOST)="C" W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR K DIR S:'Y PSOQUIT=1 I 'PSOQUIT S EOFLAG=1 D HD
"RTN","PSOATRPP",46,0)
 .I $E(IOST)'="C" S EOFLAG=1 D HD
"RTN","PSOATRPP",47,0)
 I PSODS="S" W !,$P(PSOAB,"^",2)_" ("_$P(PSOAB,"^",3)_")",?35,PSO(1),?48,PSO(2),?63,(PSO(1)+PSO(2)) Q
"RTN","PSOATRPP",48,0)
 S PNODE=$G(^PS(52.43,$P(PSOAB,"^"),0))
"RTN","PSOATRPP",49,0)
 S Y=$P(PNODE,"^",5),PSOP5=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3),PSOP6=$P(PNODE,"^",6),PSO(PSOP6)=PSO(PSOP6)+1
"RTN","PSOATRPP",50,0)
 W !,$S(PSON=1:$E($P(PSOAB,"^",2),1,17)_" ("_$P(PSOAB,"^",3)_")",1:""),?28,$P(PNODE,"^",3),?42,PSOP5 W:'$G(PSORMZ) ! W ?$S($G(PSORMZ):56,1:20),$P(PNODE,"^",10)
"RTN","PSOATRPP",51,0)
 Q
"RTN","PSOATRPP",52,0)
FO I PSODS="S",$D(^TMP($J,"PSOINT",DIV))=11 W !!,"COUNT: ",?35,PSOT(1),?48,PSOT(2),?63,(PSOT(1)+PSOT(2)) G T1
"RTN","PSOATRPP",53,0)
 Q:$D(^TMP($J,"PSOINT",DIV))'=11  D:PSODS="D"
"RTN","PSOATRPP",54,0)
 .W !!,"Total transactions for date range "_$G(PSOSDX)_" through "_$G(PSOEDX)_" = "_PSO("TOT")
"RTN","PSOATRPP",55,0)
T1 I $E(IOST)="C" W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOATRPP",56,0)
 Q
"RTN","PSOATRPP",57,0)
FO1 I $D(^TMP($J,"PSOINT",DIV))=11 W !,"     Total transactions for patient = ",PSOPAT
"RTN","PSOATRPP",58,0)
 Q
"RTN","PSOATRPP",59,0)
SET I PSODS="D",($P(PSAB,"^",6)=1) Q
"RTN","PSOATRPP",60,0)
 S DFN=PSODFN D DEM^VADPT
"RTN","PSOATRPP",61,0)
 S ^TMP($J,"PSOINT",PSORXDV,VADM(1),PSORXIN,PSOSD1)=PSA_"^"_VADM(1)_"^"_VA("BID")
"RTN","PSOATRPP",62,0)
 Q
"RTN","PSOATRPP",63,0)
SUMM ;
"RTN","PSOATRPP",64,0)
 S DIV=0 F  S DIV=$O(^TMP($J,"PSOINT",DIV)) Q:'DIV!(PSOQUIT)  S (PSO(1),PSO(2),PSOT(1),PSOT(2))=0 D  D FO W:$E(IOST)="P" @IOF
"RTN","PSOATRPP",65,0)
 .S PAGE=1 D HD I $D(^TMP($J,"PSOINT",DIV))'=11 W !!,"NO DATA FOUND TO PRINT FOR THIS RANGE.",! D:$E(IOST)="C"  S PSOERR=1
"RTN","PSOATRPP",66,0)
 ..K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR W @IOF
"RTN","PSOATRPP",67,0)
 .S PSONAM="" F  S PSONAM=$O(^TMP($J,"PSOINT",DIV,PSONAM)) Q:PSONAM=""!(PSOQUIT)  S (PSO(1),PSO(2))=0 D  D PRT
"RTN","PSOATRPP",68,0)
 ..S PSORXIN=0 F  S PSORXIN=$O(^TMP($J,"PSOINT",DIV,PSONAM,PSORXIN)) Q:'PSORXIN!(PSOQUIT)  S PSDD=0 F  S PSDD=$O(^TMP($J,"PSOINT",DIV,PSONAM,PSORXIN,PSDD)) Q:'PSDD!(PSOQUIT)  D
"RTN","PSOATRPP",69,0)
 ...S PSOAB=$G(^TMP($J,"PSOINT",DIV,PSONAM,PSORXIN,PSDD))
"RTN","PSOATRPP",70,0)
 ...S PNODE=$G(^PS(52.43,$P(PSOAB,"^"),0)),PSOP6=$P(PNODE,"^",6),PSO(PSOP6)=PSO(PSOP6)+1
"RTN","PSOATRPP",71,0)
 Q
"RTN","PSOATRR")
0^6^B23568453^n/a
"RTN","PSOATRR",1,0)
PSOATRR ;BIR/SJA - INTERNET REFILL REPORT SORTED BY RESULT ;05/29/07 12:36pm
"RTN","PSOATRR",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**264**;DEC 1997;Build 19
"RTN","PSOATRR",3,0)
 ;
"RTN","PSOATRR",4,0)
 K IOP,%ZIS,POP S PSOION=ION,%ZIS="MQ" D ^%ZIS I POP S IOP=PSOION D ^%ZIS K PSOION S PSOQUIT=1 G END
"RTN","PSOATRR",5,0)
 I $D(IO("Q")) D  K PSOION,ZTSK S PSOQUIT=1 G END
"RTN","PSOATRR",6,0)
 . N VAR K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSOATRR",ZTDESC="INTERNET REFILL REPORT SORTED BY RESULT"
"RTN","PSOATRR",7,0)
 . F VAR="PSODS","PSOED","PSOEDX","PSOREP","PSORMZ","PSOSD","PSOSDX","RDATE" S:$D(@VAR) ZTSAVE(VAR)=""
"RTN","PSOATRR",8,0)
 . S ZTSAVE("PSODIV*")=""
"RTN","PSOATRR",9,0)
 . D ^%ZTLOAD W:$D(ZTSK) !,"Report is Queued to print !!"
"RTN","PSOATRR",10,0)
START U IO
"RTN","PSOATRR",11,0)
 N DFN,DIV,EOFLAG,LINE,PAGE,PNODE,PSA,PSAB,PSO,PSOAB,PSOAFLAG,PSODFN,PSOERR,PSON,PSOP5,PSOP6,PSOPAT
"RTN","PSOATRR",12,0)
 N PSOQUIT,PSORXDV,PSORXIN,PSOSD1,PSOT,X,Y
"RTN","PSOATRR",13,0)
 K ^TMP($J,"PSOINT") S PAGE=1,PSOQUIT=0,$P(LINE,"-",$S($G(PSORMZ):130,1:79))=""
"RTN","PSOATRR",14,0)
 S (PSOERR,PSOAFLAG)=0
"RTN","PSOATRR",15,0)
 S PSOD=0 F  S PSOD=$O(PSODIV(PSOD)) Q:'PSOD  S ^TMP($J,"PSOINT",PSOD)=""
"RTN","PSOATRR",16,0)
 S (PSA,PSOD)=0 F  S PSOD=$O(PSODIV(PSOD)) Q:'PSOD  D  Q:$G(PSODIV)="ALL"
"RTN","PSOATRR",17,0)
 .S ^TMP($J,"PSOINT",PSOD)=""
"RTN","PSOATRR",18,0)
 .S PSOSD1=PSOSD-1 F  S PSOSD1=$O(^PS(52.43,"AD",PSOSD1)) Q:'PSOSD1  I PSOSD1'<PSOSD,PSOSD1'>PSOED D
"RTN","PSOATRR",19,0)
 ..S PSA=0 F  S PSA=$O(^PS(52.43,"AD",PSOSD1,PSA)) Q:'PSA  S PSAB=$G(^PS(52.43,PSA,0)) D:$P(PSAB,"^",6)>0
"RTN","PSOATRR",20,0)
 ...S PSORXIN=$P(PSAB,"^",8),PSODFN=$P($G(^PSRX(PSORXIN,0)),"^",2),PSORXDV=$P($G(^PSRX(PSORXIN,2)),"^",9)
"RTN","PSOATRR",21,0)
 ...I $G(PSODIV)="ALL"!($$DIV^PSOATRP(PSORXIN,PSORXDV)) D SET
"RTN","PSOATRR",22,0)
 I PSODS="S" D SUMM G END ;print summary report only
"RTN","PSOATRR",23,0)
 S DIV=0 F  S DIV=$O(^TMP($J,"PSOINT",DIV)) Q:'DIV!(PSOQUIT)  D  D FO W:$E(IOST)="P" @IOF
"RTN","PSOATRR",24,0)
 .S (PSO("TOT"),PSO(1),PSO(2))=0
"RTN","PSOATRR",25,0)
 .S PAGE=1 D HD I $D(^TMP($J,"PSOINT",DIV))'=11 W !!,"NO DATA FOUND TO PRINT FOR THIS RANGE.",! D:$E(IOST)="C"  S PSOERR=1 W:$E(IOST)="P" @IOF
"RTN","PSOATRR",26,0)
 ..K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOATRR",27,0)
 .S PSODFN=0 F  S PSODFN=$O(^TMP($J,"PSOINT",DIV,PSODFN)) Q:'PSODFN!(PSOQUIT)  S PSOPAT=0 D
"RTN","PSOATRR",28,0)
 ..S (PSON,PSORXIN)=0 F  S PSORXIN=$O(^TMP($J,"PSOINT",DIV,PSODFN,PSORXIN)) Q:'PSORXIN!(PSOQUIT)  S PSOAB=$G(^TMP($J,"PSOINT",DIV,PSODFN,PSORXIN)) D
"RTN","PSOATRR",29,0)
 ...S PSOPAT=PSOPAT+1,PSO("TOT")=PSO("TOT")+1,PSON=PSON+1 D PRT
"RTN","PSOATRR",30,0)
END D:$E(IOST)="C"&('$G(PSOQUIT))&('$G(PSOERR))  K ^TMP($J,"PSOINT") W:$E(IOST)="P" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOATRR",31,0)
 .W !!,"** END OF REPORT **"
"RTN","PSOATRR",32,0)
 .W !! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOATRR",33,0)
 ;
"RTN","PSOATRR",34,0)
HD ;PRINT PAGE HEADING
"RTN","PSOATRR",35,0)
 W:$G(PAGE)'=1!($E(IOST)="C") @IOF W !,"INTERNET REFILL REPORT BY RESULT"_" - "_$S(PSODS="D":"Detail",1:"Summary")
"RTN","PSOATRR",36,0)
 W ?45,$P(RDATE,":",1,2) W ?$S($G(PSORMZ):120,1:68),"PAGE: "_PAGE
"RTN","PSOATRR",37,0)
 W !,$S(PSODS="D":"Not Filled - ",1:"")_"For date range "_$G(PSOSDX)_" through "_$G(PSOEDX)_" for "_$P(^PS(59,DIV,0),"^")
"RTN","PSOATRR",38,0)
 I PSODS="S" W !!,"Result",?30,"Count"
"RTN","PSOATRR",39,0)
 E  W !!,"Patient",?30,"Rx #",?44,"Date" W:'$G(PSORMZ) ! W ?$S($G(PSORMZ):58,1:20),"Reason"
"RTN","PSOATRR",40,0)
 W !,LINE S PAGE=PAGE+1
"RTN","PSOATRR",41,0)
 Q
"RTN","PSOATRR",42,0)
PRT ;PRINT REPORT
"RTN","PSOATRR",43,0)
 S EOFLAG=0 I ($Y+5)>IOSL D  Q:PSOQUIT
"RTN","PSOATRR",44,0)
 .I $E(IOST)="C" W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR K DIR S:'Y PSOQUIT=1 I 'PSOQUIT S EOFLAG=1 D HD
"RTN","PSOATRR",45,0)
 .I $E(IOST)'="C" S EOFLAG=1 D HD
"RTN","PSOATRR",46,0)
 S PNODE=$G(^PS(52.43,$P(PSOAB,"^"),0))
"RTN","PSOATRR",47,0)
 S Y=$P(PNODE,"^",5),PSOP5=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3),PSOP6=$P(PNODE,"^",6),PSO(PSOP6)=PSO(PSOP6)+1
"RTN","PSOATRR",48,0)
 W !,$S(PSON=1:$P(PSOAB,"^",2)_" ("_$P(PSOAB,"^",3)_")",1:""),?30,$P(PNODE,"^",3),?44,PSOP5 W:'$G(PSORMZ) ! W ?$S($G(PSORMZ):58,1:20),$P(PNODE,"^",10)
"RTN","PSOATRR",49,0)
 Q
"RTN","PSOATRR",50,0)
FO I PSODS="S",$D(^TMP($J,"PSOINT",DIV))=11 W !!!,"Total: ",?30,(PSOT(1)+PSOT(2)) G T1
"RTN","PSOATRR",51,0)
 Q:$D(^TMP($J,"PSOINT",DIV))'=11  D:PSODS="D"
"RTN","PSOATRR",52,0)
 .W !!,"Total transactions for date range "_$G(PSOSDX)_" through "_$G(PSOEDX)_" = "_PSO("TOT")
"RTN","PSOATRR",53,0)
 .I $G(PSORST)="B" W !,"Filled = "_PSO(1),"   Not Filled = ",PSO(2)
"RTN","PSOATRR",54,0)
T1 I $E(IOST)="C" W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOATRR",55,0)
 W:$E(IOST)="P" @IOF
"RTN","PSOATRR",56,0)
 Q
"RTN","PSOATRR",57,0)
SET I PSODS="D",($P(PSAB,"^",6)=1) Q
"RTN","PSOATRR",58,0)
 S DFN=PSODFN D DEM^VADPT
"RTN","PSOATRR",59,0)
 S ^TMP($J,"PSOINT",PSORXDV,PSODFN,PSORXIN)=PSA_"^"_VADM(1)_"^"_VA("BID")
"RTN","PSOATRR",60,0)
 Q
"RTN","PSOATRR",61,0)
SUMM ;
"RTN","PSOATRR",62,0)
 S DIV=0 F  S DIV=$O(^TMP($J,"PSOINT",DIV)) Q:'DIV!(PSOQUIT)  S (PSO(2),PSO(1),PSOT(1),PSOT(2))=0 D  D PRTS,FO W:$E(IOST)="P" @IOF
"RTN","PSOATRR",63,0)
 .S PAGE=1 D HD I $D(^TMP($J,"PSOINT",DIV))'=11 W !!,"NO DATA FOUND TO PRINT FOR THIS RANGE.",! D:$E(IOST)="C"  S PSOERR=1
"RTN","PSOATRR",64,0)
 ..K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOATRR",65,0)
 .S PSODFN=0 F  S PSODFN=$O(^TMP($J,"PSOINT",DIV,PSODFN)) Q:'PSODFN!(PSOQUIT)  D
"RTN","PSOATRR",66,0)
 ..S PSORXIN=0 F  S PSORXIN=$O(^TMP($J,"PSOINT",DIV,PSODFN,PSORXIN)) Q:'PSORXIN!(PSOQUIT)  D
"RTN","PSOATRR",67,0)
 ...S PSOAB=$G(^TMP($J,"PSOINT",DIV,PSODFN,PSORXIN)),PNODE=$G(^PS(52.43,$P(PSOAB,"^"),0))
"RTN","PSOATRR",68,0)
 ...S PSOP6=$P(PNODE,"^",6) S PSO(PSOP6)=PSO(PSOP6)+1,PSOT(PSOP6)=PSOT(PSOP6)+1
"RTN","PSOATRR",69,0)
 Q
"RTN","PSOATRR",70,0)
PRTS ;
"RTN","PSOATRR",71,0)
 W:$D(^TMP($J,"PSOINT",DIV))=11 !,"Filled",?30,PSO(1),!,"Not Filled",?30,PSO(2)
"RTN","PSOATRR",72,0)
 Q
"RTN","PSOBAI")
0^20^B9978641^B9583572
"RTN","PSOBAI",1,0)
PSOBAI ;BIR/EJW - BAD ADDRESS PROCESSING ;02/02/2006
"RTN","PSOBAI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**233,258,268,264**;DEC 1997;Build 19
"RTN","PSOBAI",3,0)
 ;
"RTN","PSOBAI",4,0)
 ;External reference EN^DGREGAED supported by DBIA 4198
"RTN","PSOBAI",5,0)
 ;External reference UPDATE^DGADDUTL supported by DBIA 4886
"RTN","PSOBAI",6,0)
 ;External reference ^DPT( supported by DBIA 5031
"RTN","PSOBAI",7,0)
 ;
"RTN","PSOBAI",8,0)
CHKADDR(PSODFN,WARN,UPDATE) ; CHECK ADDRESS BY PATIENT
"RTN","PSOBAI",9,0)
 ;Input: PSODFN - PATIENT file (#2) IEN
"RTN","PSOBAI",10,0)
 ;       WARN - Display warning (optional)
"RTN","PSOBAI",11,0)
 ;       UPDATE - If bad address flagged, prompt to update patient address (optional)
"RTN","PSOBAI",12,0)
 ;If calling from patient selection, if bad, even if there is an active temporary address, prompt to update the address
"RTN","PSOBAI",13,0)
 N PSOBADR,PSOTEMP
"RTN","PSOBAI",14,0)
 I PSODFN="" Q
"RTN","PSOBAI",15,0)
 S PSOBADR=$$BADADR^DGUTL3(PSODFN)
"RTN","PSOBAI",16,0)
 I PSOBADR D
"RTN","PSOBAI",17,0)
 .S PSOTEMP=$$CHKTEMP(PSODFN)
"RTN","PSOBAI",18,0)
 .I $G(WARN) D
"RTN","PSOBAI",19,0)
 ..D WARN1
"RTN","PSOBAI",20,0)
 ..I $G(UPDATE) D UPDATE Q
"RTN","PSOBAI",21,0)
 ..D PAUSE
"RTN","PSOBAI",22,0)
 Q
"RTN","PSOBAI",23,0)
 ;
"RTN","PSOBAI",24,0)
CHKRX(PSORX) ;CHECK ADDRESS BY RX
"RTN","PSOBAI",25,0)
 ;Input: PSORX - PRESCRIPTION file (#52) IEN
"RTN","PSOBAI",26,0)
 ;Output: PSOBADR - Bad Address Indicator_"^"_temporary address or not
"RTN","PSOBAI",27,0)
 N PSOBADR,PSODFN,PSOTEMP
"RTN","PSOBAI",28,0)
 S PSOBADR=""
"RTN","PSOBAI",29,0)
 I PSORX="" Q 0
"RTN","PSOBAI",30,0)
 S PSODFN=$P($G(^PSRX(PSORX,0)),"^",2) I PSODFN="" Q 0
"RTN","PSOBAI",31,0)
 S PSOBADR=$$BADADR^DGUTL3(PSODFN)
"RTN","PSOBAI",32,0)
 I PSOBADR S PSOTEMP=$$CHKTEMP(PSODFN)
"RTN","PSOBAI",33,0)
 S PSOBADR=PSOBADR_"^"_$G(PSOTEMP)
"RTN","PSOBAI",34,0)
 Q PSOBADR
"RTN","PSOBAI",35,0)
 ;
"RTN","PSOBAI",36,0)
WARN1 ;
"RTN","PSOBAI",37,0)
 W !!,?8,"WARNING: The patient address is indicated as a bad"
"RTN","PSOBAI",38,0)
 W !,?17,"address (",$S(PSOBADR=1:"UNDELIVERABLE",PSOBADR=2:"HOMELESS",1:"OTHER"),")."
"RTN","PSOBAI",39,0)
 I $G(PSOTEMP) W !,?17,"* Temporary address is active *" Q
"RTN","PSOBAI",40,0)
 W !,?17,"Medication will not be mailed to"
"RTN","PSOBAI",41,0)
 W !,?17,"the patient until the address has been"
"RTN","PSOBAI",42,0)
 W !,?17,"corrected.",!
"RTN","PSOBAI",43,0)
 Q
"RTN","PSOBAI",44,0)
CHKTEMP(PSODFN) ; see if active temporary address
"RTN","PSOBAI",45,0)
 ;Input: PSODFN - PATIENT file (#2) IEN
"RTN","PSOBAI",46,0)
 N DFN,VAPA
"RTN","PSOBAI",47,0)
 S DFN=PSODFN,PSOTEMP=0
"RTN","PSOBAI",48,0)
 D 6^VADPT I +VAPA(9) S PSOTEMP=1
"RTN","PSOBAI",49,0)
 Q PSOTEMP
"RTN","PSOBAI",50,0)
 ;
"RTN","PSOBAI",51,0)
UPDATE ;
"RTN","PSOBAI",52,0)
 N PSOSEL,DA
"RTN","PSOBAI",53,0)
 I '$D(PSOPAR) D ^PSOLSET
"RTN","PSOBAI",54,0)
 I '$P($G(PSOPAR),"^",22),'$D(^XUSEC("PSO ADDRESS UPDATE",+$G(DUZ))) D PAUSE Q
"RTN","PSOBAI",55,0)
 K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Do you want to update the address/phone"
"RTN","PSOBAI",56,0)
 D ^DIR K DIR
"RTN","PSOBAI",57,0)
 I Y'=1 Q
"RTN","PSOBAI",58,0)
 L +^DPT(PSODFN):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T D MSG,PAUSE Q
"RTN","PSOBAI",59,0)
 K DIR S DIR(0)="SAO^P:PERMANENT;T:TEMPORARY;B:BOTH"
"RTN","PSOBAI",60,0)
 S DIR("A")=" Update (P)ermanent address, (T)emporary, or (B)oth: "
"RTN","PSOBAI",61,0)
 S DIR("B")="BOTH" D ^DIR
"RTN","PSOBAI",62,0)
 I $D(DIRUT) G ULK
"RTN","PSOBAI",63,0)
 S PSOSEL=Y
"RTN","PSOBAI",64,0)
 I PSOSEL="P"!(PSOSEL="B") D
"RTN","PSOBAI",65,0)
 .;D UPDATE^DGADDUTL(PSODFN,"PERM") - THIS CALL CLEARS BAI FLAG INAPPROPRIATELY SO USE FOLLOWING TO UPDATE PERMANENT ADDRESS/PHONE INSTEAD 5/29/06
"RTN","PSOBAI",66,0)
 .N PSOFLG
"RTN","PSOBAI",67,0)
 .S PSOFLG(1)=1 D EN^DGREGAED(PSODFN,.PSOFLG) W !
"RTN","PSOBAI",68,0)
 S DA=PSODFN,DIE="^DPT(",DR=".134" D ^DIE W !
"RTN","PSOBAI",69,0)
 I PSOSEL="P" D ULK Q
"RTN","PSOBAI",70,0)
 I PSOSEL="B"!(PSOSEL="T") D UPDATE^DGADDUTL(PSODFN,"TEMP"),ULK,PAUSE
"RTN","PSOBAI",71,0)
 Q
"RTN","PSOBAI",72,0)
ULK ;
"RTN","PSOBAI",73,0)
 L -^DPT(PSODFN)
"RTN","PSOBAI",74,0)
 Q
"RTN","PSOBAI",75,0)
 ;
"RTN","PSOBAI",76,0)
PAUSE ;
"RTN","PSOBAI",77,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOBAI",78,0)
 Q
"RTN","PSOBAI",79,0)
 ;
"RTN","PSOBAI",80,0)
MSG ;
"RTN","PSOBAI",81,0)
 S VALMSG="Patient Data is being edited by another user!"
"RTN","PSOBAI",82,0)
 Q
"RTN","PSOBAI",83,0)
 ;
"RTN","PSOBAIR2")
0^21^B39307918^B25644262
"RTN","PSOBAIR2",1,0)
PSOBAIR2 ;BIR/RTR-Report of suspended prescriptions with bad address ;08/16/2006
"RTN","PSOBAIR2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**233,200,264**;DEC 1997;Build 19
"RTN","PSOBAIR2",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOBAIR2",4,0)
EN ;
"RTN","PSOBAIR2",5,0)
 N PSOAPAT,PSOSDT,PSOEDT,PSOSDTX,PSOEDTX,X,Y,X1,X2,PSUSDIV,PII,PSOCNT,PSOBDF
"RTN","PSOBAIR2",6,0)
 W !!,"This option shows unprinted suspended prescriptions for the following:",!
"RTN","PSOBAIR2",7,0)
 W !,"- BAD ADDRESS INDICATOR set in the PATIENT file (#2) and no active temporary",!,"  address"
"RTN","PSOBAIR2",8,0)
 W !,"- DO NOT MAIL set in the PHARMACY PATIENT file (#55)"
"RTN","PSOBAIR2",9,0)
 W !,"- FOREIGN ADDRESS set in the PATIENT file (#2) and no active US temporary",!,"  address",!
"RTN","PSOBAIR2",10,0)
 K DIR S DIR(0)="S^B:Bad Address Indicator;D:Do Not Mail;F:Foreign;A:All;",DIR("B")="A"
"RTN","PSOBAIR2",11,0)
 S DIR("A")="Print for Bad Address Indicator/Do Not Mail/Foreign/All (B/D/F/A)"
"RTN","PSOBAIR2",12,0)
 S DIR("?")="Print prescriptions with Bad Address Indicated/Do Not Mail/Foreign Address, or all"
"RTN","PSOBAIR2",13,0)
 D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) D MESS Q
"RTN","PSOBAIR2",14,0)
 S PSOBDF=Y
"RTN","PSOBAIR2",15,0)
DATE ;
"RTN","PSOBAIR2",16,0)
 W ! S %DT="AEX",%DT("A")="Ending suspense date: " D ^%DT K %DT I Y<0!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOBAIR2",17,0)
 S PSOEDT=Y D DD^%DT S PSOEDTX=Y
"RTN","PSOBAIR2",18,0)
 S X1=PSOEDT,X2=+1 D C^%DTC S PSOEDT=X
"RTN","PSOBAIR2",19,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) D MESS Q
"RTN","PSOBAIR2",20,0)
 S PSOCNT=0 F PII=0:0 S PII=$O(^PS(59,PII)) Q:'PII  S PSOCNT=PSOCNT+1
"RTN","PSOBAIR2",21,0)
 I PSOCNT=1 G SKIP
"RTN","PSOBAIR2",22,0)
 W !!?3,"You are logged in under the "_$P($G(^PS(59,+$G(PSOSITE),0)),"^")_" division.",!
"RTN","PSOBAIR2",23,0)
 K DIR S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Print only those Rx's suspended for this division",DIR("?")="Enter 'Yes' to print only those Rx's for this division, enter 'No' to print Rx's suspended for all divisions."
"RTN","PSOBAIR2",24,0)
 D ^DIR K DIR I Y["^"!($D(DIRUT)) D MESS Q
"RTN","PSOBAIR2",25,0)
 S PSUSDIV=Y
"RTN","PSOBAIR2",26,0)
SKIP ;
"RTN","PSOBAIR2",27,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP) D MESS Q
"RTN","PSOBAIR2",28,0)
 I $D(IO("Q")) D  Q
"RTN","PSOBAIR2",29,0)
 .N GG
"RTN","PSOBAIR2",30,0)
 .S ZTRTN="REP^PSOBAIR2",ZTDESC="Pharmacy bad address suspense report" D
"RTN","PSOBAIR2",31,0)
 ..F GG="PSOSITE","PSOAPAT","PSOSDT","PSOEDT","PSOEDTX","PSOSDTX","PSUSDIV" S:$D(@GG) ZTSAVE(GG)=""
"RTN","PSOBAIR2",32,0)
 ..S ZTSAVE("PSOBDF*")="" D ^%ZTLOAD K %ZIS
"RTN","PSOBAIR2",33,0)
 .W !!,"Report queued to print.",!
"RTN","PSOBAIR2",34,0)
REP ;
"RTN","PSOBAIR2",35,0)
 K ^TMP("PSOBADL",$J) S (PSOBDF("B"),PSOBDF("D"),PSOBDF("F"))=0
"RTN","PSOBAIR2",36,0)
 N PSODEV,PSOUT,PSOLINE,PSOPAGE,PSOADND,PSOADF,PSOADFF,PSOAOPT,PSOAOPTA,PSOAOPTZ,PSOAOPTB,PSOAOPTC,PSOADLP,PSOANODE,PSOADX,SFN,PSOADATE,PSOC,PSOAALL,PSODFN,PSOANAME,PSONI,PSONX,PSONB,PSOASN,VA,DFN,PSONSSN,PSOAFLAG
"RTN","PSOBAIR2",37,0)
 U IO
"RTN","PSOBAIR2",38,0)
 S (PSOUT,PSOAFLAG)=0,PSODEV=$S($E(IOST,1,2)'="C-":0,1:1),PSOPAGE=1
"RTN","PSOBAIR2",39,0)
 S $P(PSOLINE,"-",78)=""
"RTN","PSOBAIR2",40,0)
ALL ;
"RTN","PSOBAIR2",41,0)
 N PSORD,SFN,PSOLBL,PSOX,PSODFN,RXIEN,PRINTED,RXSITE,RXSTS,PARTIAL
"RTN","PSOBAIR2",42,0)
 S PSODFN=0 F  S PSODFN=$O(^PS(52.5,"AC",PSODFN)) Q:'PSODFN  D
"RTN","PSOBAIR2",43,0)
 .S (PSOBAI,PSOBDF("B"),PSOBDF("D"),PSOBDF("F"))=0 D CHKADDR,FOREIGN,CHKMAIL Q:(PSOBDF("B")+PSOBDF("D")+PSOBDF("F"))=0
"RTN","PSOBAIR2",44,0)
 .Q:(PSOBDF="A"&'(PSOBDF("B")!PSOBDF("F")!PSOBDF("D")))  I PSOBDF'="A" Q:('PSOBDF(PSOBDF))
"RTN","PSOBAIR2",45,0)
 .S PSORD=0 F  S PSORD=$O(^PS(52.5,"AC",PSODFN,PSORD)) Q:'PSORD!(PSORD>PSOEDT)  D
"RTN","PSOBAIR2",46,0)
 ..S SFN=0 F  S SFN=$O(^PS(52.5,"AC",PSODFN,PSORD,SFN)) Q:'SFN  D DETAIL
"RTN","PSOBAIR2",47,0)
 S PSODFN=0 F  S PSODFN=$O(^PS(52.5,"AG",PSODFN)) Q:'PSODFN  D
"RTN","PSOBAIR2",48,0)
 .S (PSOBAI,PSOBDF("B"),PSOBDF("D"),PSOBDF("F"))=0 D CHKADDR,FOREIGN,CHKMAIL Q:(PSOBDF("B")+PSOBDF("D")+PSOBDF("F"))=0
"RTN","PSOBAIR2",49,0)
 .Q:(PSOBDF="A"&'(PSOBDF("B")!PSOBDF("F")!PSOBDF("D")))  I PSOBDF'="A" Q:('PSOBDF(PSOBDF))
"RTN","PSOBAIR2",50,0)
 .S SFN=0 F  S SFN=$O(^PS(52.5,"AG",PSODFN,SFN)) Q:'SFN  D
"RTN","PSOBAIR2",51,0)
 ..S PSORD=$G(^PS(52.5,SFN,0)),PSORD=$P(PSORD,"^",2) I PSORD<PSOEDT D DETAIL
"RTN","PSOBAIR2",52,0)
 D HD
"RTN","PSOBAIR2",53,0)
 I '$D(^TMP("PSOBADL",$J)) W !!,"No data found to print for this date range.",! G END
"RTN","PSOBAIR2",54,0)
 S PSONI="" F  S PSONI=$O(^TMP("PSOBADL",$J,PSONI)) Q:PSONI=""!(PSOUT)  D
"RTN","PSOBAIR2",55,0)
 .S PSONX="" F  S PSONX=$O(^TMP("PSOBADL",$J,PSONI,PSONX)) Q:PSONX=""!(PSOUT)  D NAME,PRALL D
"RTN","PSOBAIR2",56,0)
 ..S PSONB="" F  S PSONB=$O(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB)) Q:PSONB=""!(PSOUT)  D
"RTN","PSOBAIR2",57,0)
 ...S SFN="" F  S SFN=$O(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB,SFN)) Q:SFN=""!(PSOUT)  D
"RTN","PSOBAIR2",58,0)
 ....I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIR2",59,0)
 ....S Y=PSONB D DD^%DT S PSOADATE=Y
"RTN","PSOBAIR2",60,0)
 ....S PNODE=$G(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB,SFN)) D PRONE
"RTN","PSOBAIR2",61,0)
END ;
"RTN","PSOBAIR2",62,0)
 I PSOBDF="A" W !!!,"NOTE: B=BAD ADDRESS INDICATOR  D=NO NOT MAIL  F=FOREIGN ADDRESS"
"RTN","PSOBAIR2",63,0)
 K ^TMP("PSOBADL",$J)
"RTN","PSOBAIR2",64,0)
 K DTOUT,DUOUT,PSOBAI
"RTN","PSOBAIR2",65,0)
 I '$G(PSOUT),PSODEV W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOBAIR2",66,0)
 I 'PSODEV W !!,"End of Report."
"RTN","PSOBAIR2",67,0)
 I PSODEV W !
"RTN","PSOBAIR2",68,0)
 E  W @IOF
"RTN","PSOBAIR2",69,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOBAIR2",70,0)
 Q
"RTN","PSOBAIR2",71,0)
HD ;
"RTN","PSOBAIR2",72,0)
 S PSOAFLAG=1
"RTN","PSOBAIR2",73,0)
 I PSODEV,PSOPAGE'=1 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSOBAIR2",74,0)
 I PSOPAGE=1,'PSODEV W ! I 1
"RTN","PSOBAIR2",75,0)
 E  W @IOF
"RTN","PSOBAIR2",76,0)
 D  W ?67,"PAGE: "_PSOPAGE S PSOPAGE=PSOPAGE+1
"RTN","PSOBAIR2",77,0)
 .W !,"Suspense "_$S(PSOBDF="A":"BAI/DO NOT MAIL/FOREIGN ADRESS",PSOBDF="B":"BAD ADDRESS INDICATOR",PSOBDF="D":"DO NOT MAIL",1:"FOREIGN ADDRESS")_" report - division = ",$S($G(PSUSDIV):$P($G(^PS(59,+$G(PSOSITE),0)),"^"),1:"ALL")
"RTN","PSOBAIR2",78,0)
 W !,"for suspense dates through "_$G(PSOEDTX) W:PSOBDF="A" ?70,"B/D/F"
"RTN","PSOBAIR2",79,0)
 W !,PSOLINE
"RTN","PSOBAIR2",80,0)
 Q
"RTN","PSOBAIR2",81,0)
MESS ;
"RTN","PSOBAIR2",82,0)
 W !!,"Nothing queued to print.",!
"RTN","PSOBAIR2",83,0)
 K DTOUT,DUOUT
"RTN","PSOBAIR2",84,0)
 Q
"RTN","PSOBAIR2",85,0)
NAME ;Set name(ssn)
"RTN","PSOBAIR2",86,0)
 K VA S DFN=PSONX D PID^VADPT6
"RTN","PSOBAIR2",87,0)
 S PSONSSN=$G(PSONI)_"   ("_$E(VA("PID"),5,12)_")"
"RTN","PSOBAIR2",88,0)
 K VA
"RTN","PSOBAIR2",89,0)
 Q
"RTN","PSOBAIR2",90,0)
PRALL ;Print data for all patients
"RTN","PSOBAIR2",91,0)
 N PSOADDR
"RTN","PSOBAIR2",92,0)
 S PSOADDR=""
"RTN","PSOBAIR2",93,0)
 S PSOAFLAG=0
"RTN","PSOBAIR2",94,0)
 W !!,$G(PSONSSN) D CHKADDR W ?30,"  ",PSOADDR I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIR2",95,0)
 Q
"RTN","PSOBAIR2",96,0)
PRONE ;Print data for one patient
"RTN","PSOBAIR2",97,0)
 N SFN0
"RTN","PSOBAIR2",98,0)
 S SFN0=$G(^PSRX(SFN,0)) I SFN0=""!($P(SFN0,"^",6)="") Q
"RTN","PSOBAIR2",99,0)
 D CON W !,$G(PSOADATE),?15," Rx#: ",$P(SFN0,"^"),?30,"  ",$P($G(^PSDRUG($P(SFN0,"^",6),0)),"^")
"RTN","PSOBAIR2",100,0)
 W:PSOBDF="A" ?70,PNODE
"RTN","PSOBAIR2",101,0)
 I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIR2",102,0)
 Q
"RTN","PSOBAIR2",103,0)
CON ;
"RTN","PSOBAIR2",104,0)
 I PSOAFLAG W !,$G(PSONSSN) S PSOAFLAG=0
"RTN","PSOBAIR2",105,0)
 Q
"RTN","PSOBAIR2",106,0)
 ;
"RTN","PSOBAIR2",107,0)
CHKADDR ;
"RTN","PSOBAIR2",108,0)
 N PSOBADR,PSOTEMP
"RTN","PSOBAIR2",109,0)
 S PSOBADR=$$BADADR^DGUTL3(PSODFN)
"RTN","PSOBAIR2",110,0)
 I PSOBADR D
"RTN","PSOBAIR2",111,0)
 .S PSOTEMP=$$CHKTEMP^PSOBAI(PSODFN)
"RTN","PSOBAIR2",112,0)
 I PSOBADR,'PSOTEMP S (PSOBAI,PSOBDF("B"))=1 Q
"RTN","PSOBAIR2",113,0)
 Q
"RTN","PSOBAIR2",114,0)
 ;
"RTN","PSOBAIR2",115,0)
FOREIGN ;
"RTN","PSOBAIR2",116,0)
 N PSOFORGN
"RTN","PSOBAIR2",117,0)
 S DFN=PSODFN D ADD^VADPT
"RTN","PSOBAIR2",118,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2) I PSOFORGN'="",PSOFORGN'["UNITED STATES" S PSOBDF("F")=1
"RTN","PSOBAIR2",119,0)
 Q
"RTN","PSOBAIR2",120,0)
 ;
"RTN","PSOBAIR2",121,0)
CHKMAIL ;
"RTN","PSOBAIR2",122,0)
 N PSOTEMP,MAILEXP
"RTN","PSOBAIR2",123,0)
 S PSOTEMP=$G(^PS(55,PSODFN,0)) Q:$P(PSOTEMP,"^",3)'=2
"RTN","PSOBAIR2",124,0)
 S MAILEXP=$P(PSOTEMP,"^",5) I MAILEXP=""!(MAILEXP>DT) S PSOBDF("D")=1
"RTN","PSOBAIR2",125,0)
 Q
"RTN","PSOBAIR2",126,0)
 ;
"RTN","PSOBAIR2",127,0)
DETAIL ;
"RTN","PSOBAIR2",128,0)
 I '$D(^PS(52.5,SFN,0))!'$D(^DPT(+PSODFN,0)) Q
"RTN","PSOBAIR2",129,0)
 S RXIEN=+$$GET1^DIQ(52.5,SFN,.01,"I")
"RTN","PSOBAIR2",130,0)
 S RXSITE=+$$GET1^DIQ(52.5,SFN,.06,"I")
"RTN","PSOBAIR2",131,0)
 I $G(PSUSDIV),RXSITE'=$G(PSOSITE) Q
"RTN","PSOBAIR2",132,0)
 S RXSTS=$$GET1^DIQ(52,RXIEN,100,"I") I RXSTS>8 Q
"RTN","PSOBAIR2",133,0)
 S PARTIAL=+$$GET1^DIQ(52.5,SFN,.05,"I")
"RTN","PSOBAIR2",134,0)
 I PARTIAL,'$D(^PSRX(RXIEN,"P",PARTIAL)) Q
"RTN","PSOBAIR2",135,0)
 S PSOANAME=$P($G(^DPT(PSODFN,0)),"^") Q:PSOANAME=""
"RTN","PSOBAIR2",136,0)
 S ^TMP("PSOBADL",$J,PSOANAME,PSODFN,PSORD,RXIEN)=$S(PSOBDF("B"):"B",PSOBDF("D"):"D",PSOBDF("F"):"F",1:"")
"RTN","PSOBAIR2",137,0)
 Q
"RTN","PSOBBC")
0^1^B92251311^B87363308
"RTN","PSOBBC",1,0)
PSOBBC ;IHS/DSD/JCM-BATCH BARCODE DRIVER ;3/30/06 10:10am
"RTN","PSOBBC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,22,27,34,46,130,146,185,242,264**;DEC 1997;Build 19
"RTN","PSOBBC",3,0)
 ;External reference to ^IBE(350.1,"ANEW" supported by DBIA 592
"RTN","PSOBBC",4,0)
 ;External references CHPUS^IBACUS and TRI^IBACUS supported by DBIA 2030
"RTN","PSOBBC",5,0)
 ;External reference PDA^PPPPDA1 supported by DBIA 1374
"RTN","PSOBBC",6,0)
 ;External references LK^ORX2 and ULK^ORX2 supported by DBIA 867
"RTN","PSOBBC",7,0)
 ;External references ^PS(55 supported by DBIA 2228
"RTN","PSOBBC",8,0)
 ;External references U, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOBBC",9,0)
 ;PSO*242 change default to from Q to S
"RTN","PSOBBC",10,0)
 ;-------------------------------------------------------------------
"RTN","PSOBBC",11,0)
START ;
"RTN","PSOBBC",12,0)
 N PSODFN,PSOBBCNO
"RTN","PSOBBC",13,0)
 D INIT I '$D(PSOPAR) D ^PSOLSET G:'$D(PSOPAR) EOJ
"RTN","PSOBBC",14,0)
 I $G(PSOSITE) S PSOBARID=$G(^PS(59,PSOSITE,"IB")) I '$D(^IBE(350.1,"ANEW",+PSOBARID,1,1)) D  S PSORX("QFLG")=1 K PSOBARID G END
"RTN","PSOBBC",15,0)
 .W $C(7),!!,"WARNING: Pharmacy Copay not working,",!,?10,"Check IB SERVICE/SECTION in Pharmacy Site File.",!!!,"You will not be able to enter any new prescriptions until this is corrected!"
"RTN","PSOBBC",16,0)
 S PSOBBC("QFLG")=0,PSORX("BAR CODE")=1
"RTN","PSOBBC",17,0)
 D FROM I PSOBBC("QFLG") S PSORX("QFLG")=1 G END
"RTN","PSOBBC",18,0)
 D ASK I PSOBBC("QFLG") S PSORX("QFLG")=1 G END
"RTN","PSOBBC",19,0)
 D PROCESS
"RTN","PSOBBC",20,0)
END D EOJ
"RTN","PSOBBC",21,0)
 Q
"RTN","PSOBBC",22,0)
 ;--------------------------------------------------------------------
"RTN","PSOBBC",23,0)
INIT ;
"RTN","PSOBBC",24,0)
 S PSOBBC("QFLG")=0,PSORX("BAR CODE")=1 K PPL
"RTN","PSOBBC",25,0)
 I '$G(PSOINST) D
"RTN","PSOBBC",26,0)
 .K DIC,DR,DIQ S DA=$P($$SITE^VASITE(),"^") I DA D
"RTN","PSOBBC",27,0)
 ..K PSOINST S DIC=4,DIQ(0)="I",DR=99,DIQ="PSOINST" D EN^DIQ1
"RTN","PSOBBC",28,0)
 ..S PSOINST=PSOINST(4,DA,99,"I") K DIC,DA,DIQ,PSOINST(4)
"RTN","PSOBBC",29,0)
 Q
"RTN","PSOBBC",30,0)
FROM ;
"RTN","PSOBBC",31,0)
 S DIR(0)="S^1:REFILLS;2:RENEWS;"
"RTN","PSOBBC",32,0)
 S DIR("A")="Batch Barcode for",DIR("B")="REFILLS"
"RTN","PSOBBC",33,0)
 D DIR G:'Y FROMX
"RTN","PSOBBC",34,0)
 S PSOBBC1("FROM")=$S(Y=1:"REFILL",1:"NEW")
"RTN","PSOBBC",35,0)
FROMX K X,Y,DIR
"RTN","PSOBBC",36,0)
 Q
"RTN","PSOBBC",37,0)
 ;
"RTN","PSOBBC",38,0)
ASK ;
"RTN","PSOBBC",39,0)
 K BINGCRT,BINGRTE,BBRX
"RTN","PSOBBC",40,0)
 W !,"Please answer the following for this session of prescriptions",!
"RTN","PSOBBC",41,0)
 D EN^PSOREF2(.PSOBBC) I PSOBBC("DFLG") S PSOBBC("QFLG")=1 G ASKX
"RTN","PSOBBC",42,0)
 D SUSP
"RTN","PSOBBC",43,0)
 D INPT,CNH
"RTN","PSOBBC",44,0)
 D:'$P($G(PSOPAR),"^",6) EARLY
"RTN","PSOBBC",45,0)
 D SET
"RTN","PSOBBC",46,0)
 D:PSOBBC1("FROM")="NEW" NOORE^PSONEW(.PSOBBC) S:$G(PSOBBC("NOO"))'="" PSOBBCNO=$G(PSOBBC("NOO")) S:$G(PSOBBC("DFLG")) PSOBBC("QFLG")=1
"RTN","PSOBBC",47,0)
ASKX Q
"RTN","PSOBBC",48,0)
 ;
"RTN","PSOBBC",49,0)
SUSP ;
"RTN","PSOBBC",50,0)
 S DIR(0)="SAB^Q:QUEUED;S:SUSPENDED"
"RTN","PSOBBC",51,0)
 S DIR("A")="Will these refills be Queued or Suspended ? "
"RTN","PSOBBC",52,0)
 S DIR("B")="S"   ;PSO*242
"RTN","PSOBBC",53,0)
 D DIR G:PSOBBC("QFLG") SUSPX
"RTN","PSOBBC",54,0)
 S (PSOBBC1("QS"),PSOBBC("QS"))=Y S:PSOBBC1("QS")="S" BINGCRT=0
"RTN","PSOBBC",55,0)
SUSPX K X,Y,DIR
"RTN","PSOBBC",56,0)
 Q
"RTN","PSOBBC",57,0)
 ;
"RTN","PSOBBC",58,0)
INPT ;
"RTN","PSOBBC",59,0)
 S DIR(0)="YA"
"RTN","PSOBBC",60,0)
 S DIR("A")="Allow refills for inpatient ? "
"RTN","PSOBBC",61,0)
 S DIR("B")="N"
"RTN","PSOBBC",62,0)
 D DIR G:PSOBBC("QFLG") INPTX
"RTN","PSOBBC",63,0)
 S (PSOBBC1("INOK"),PSOBBC("INOK"))=Y
"RTN","PSOBBC",64,0)
INPTX K X,Y,DIR
"RTN","PSOBBC",65,0)
 Q
"RTN","PSOBBC",66,0)
CNH ;
"RTN","PSOBBC",67,0)
 S DIR(0)="YA"
"RTN","PSOBBC",68,0)
 S DIR("A")="Allow refills for CNH ? "
"RTN","PSOBBC",69,0)
 S DIR("B")="N"
"RTN","PSOBBC",70,0)
 D DIR G:PSOBBC("QFLG") CNHX
"RTN","PSOBBC",71,0)
 S (PSOBBC1("CNHOK"),PSOBBC("CNHOK"))=Y
"RTN","PSOBBC",72,0)
CNHX K X,Y,DIR
"RTN","PSOBBC",73,0)
 Q
"RTN","PSOBBC",74,0)
 ;
"RTN","PSOBBC",75,0)
EARLY ;
"RTN","PSOBBC",76,0)
 S DIR(0)="YA"
"RTN","PSOBBC",77,0)
 S DIR("A")="Allow early refills ? "
"RTN","PSOBBC",78,0)
 S DIR("B")="N"
"RTN","PSOBBC",79,0)
 D DIR G:PSOBBC("QFLG") EARLYX
"RTN","PSOBBC",80,0)
 S (PSOBBC1("EAOK"),PSOBBC("EAOK"))=Y
"RTN","PSOBBC",81,0)
EARLYX K X,Y,DIR
"RTN","PSOBBC",82,0)
 Q
"RTN","PSOBBC",83,0)
 ;
"RTN","PSOBBC",84,0)
SET ;
"RTN","PSOBBC",85,0)
 S PSOBBC1("MAIL/WINDOW")=PSOBBC("MAIL/WINDOW") S:PSOBBC1("MAIL/WINDOW")="W" BINGRTE="W"
"RTN","PSOBBC",86,0)
 S PSOBBC1("FILL DATE")=PSOBBC("FILL DATE")
"RTN","PSOBBC",87,0)
 S:$G(PSOBBC("CLERK CODE")) PSOBBC1("CLERK CODE")=PSOBBC("CLERK CODE")
"RTN","PSOBBC",88,0)
 S:$G(PSOBBC("EXPIRATION DATE")) PSOBBC1("EXPIRATION DATE")=PSOBBC("EXPIRATION DATE")
"RTN","PSOBBC",89,0)
 Q
"RTN","PSOBBC",90,0)
DIR ;
"RTN","PSOBBC",91,0)
 D ^DIR
"RTN","PSOBBC",92,0)
 S:$D(DIRUT) PSOBBC("QFLG")=1,PSORX("QFLG")=1
"RTN","PSOBBC",93,0)
 K DIRUT,DUOUT,DTOUT,DIROUT
"RTN","PSOBBC",94,0)
 Q
"RTN","PSOBBC",95,0)
 ;
"RTN","PSOBBC",96,0)
PROCESS ;
"RTN","PSOBBC",97,0)
 S PSOBBC("DFLG")=0 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2)
"RTN","PSOBBC",98,0)
 S RXN=$O(^TMP("PSORXN",$J,0)) I RXN D
"RTN","PSOBBC",99,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSOBBC",100,0)
 .I $P(^PSRX(RXN,"STA"),"^")=5 D EN^PSOHLSN1(RXN,"SC","ZS","")
"RTN","PSOBBC",101,0)
 K RXN,RXN1,^TMP("PSORXN",$J) D CLEAN^PSOVER1 K ^TMP("PSORXDC",$J)
"RTN","PSOBBC",102,0)
 D GETRXM D:PSOBBC("QFLG") ULK,ULP,ULRX G:PSOBBC("QFLG") PROCESSX
"RTN","PSOBBC",103,0)
 I $G(PSODFN)'=$P(^PSRX(PSOBBC("IRXN"),0),"^",2) D  G:PSOBBC("DFLG") PROCESS
"RTN","PSOBBC",104,0)
 .I $G(PSODFN) D ULK,ULP
"RTN","PSOBBC",105,0)
 .D PT Q:PSOBBC("DFLG")
"RTN","PSOBBC",106,0)
 .D PROFILE^PSORX1 S X="PPPPDA1" X ^%ZOSF("TEST") I  S X=$$PDA^PPPPDA1(PSODFN) W !!
"RTN","PSOBBC",107,0)
 E  D PTC G:PSOBBC("DFLG") PROCESS
"RTN","PSOBBC",108,0)
 D:'$G(PSOSD) ^PSOBUILD
"RTN","PSOBBC",109,0)
 S PSOBBC("DONE")=PSOBBC("IRXN")_","
"RTN","PSOBBC",110,0)
 D @PSOBBC1("FROM") S:$G(PPL)&$D(BINGRTE) BBRX(1)=$S($D(PSOBBC("DONE")):PSOBBC("DONE"),1:BBRX) D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BBRX D ULRX G PROCESS
"RTN","PSOBBC",111,0)
PROCESSX I $G(PPL) D SETX,TRI,Q^PSORXL K PPL,RXFL
"RTN","PSOBBC",112,0)
 Q
"RTN","PSOBBC",113,0)
GETRXM ;
"RTN","PSOBBC",114,0)
 K DIR,PSOBBC("IRXN"),PSOREFXM
"RTN","PSOBBC",115,0)
 S DIR(0)="FO^5:245^K:X'?3N1""-""1.N X"
"RTN","PSOBBC",116,0)
 S DIR("A")="WAND BARCODE"
"RTN","PSOBBC",117,0)
 S DIR("?",1)="Wand the barcoded number of the prescription to be processed."
"RTN","PSOBBC",118,0)
 S DIR("?",2)="The number should be of the form NNN-NNNNNN"
"RTN","PSOBBC",119,0)
 S DIR("?",3)="where the number before the dash is your station number."
"RTN","PSOBBC",120,0)
 S DIR("?")="Enter ""^"", or a RETURN to quit."
"RTN","PSOBBC",121,0)
 D DIR G:PSOBBC("QFLG") GETRXMX
"RTN","PSOBBC",122,0)
 I $P(X,"-")'=PSOINST W !?7,$C(7),$C(7),$C(7),"Not From this Institution" G GETRXM
"RTN","PSOBBC",123,0)
 S (PSOBBC("IRXN"),PSOBBC("OIRXN"),BBRX)=$P(X,"-",2)
"RTN","PSOBBC",124,0)
 I $G(^PSRX(PSOBBC("IRXN"),0))']"" W !,$C(7),"Rx data is not on file !",! G GETRXM
"RTN","PSOBBC",125,0)
 S PSOXDFN=+$P($G(^PSRX(PSOBBC("IRXN"),0)),"^",2) I PSOXDFN S PSOLOUD=1 D:$P($G(^PS(55,PSOXDFN,0)),"^",6)'=2 EN^PSOHLUP(PSOXDFN) K PSOLOUD
"RTN","PSOBBC",126,0)
 K PSOXDFN I $P($G(^PSRX(PSOBBC("IRXN"),"STA")),"^")=13 W !,$C(7),"Rx has already been deleted." G GETRXM
"RTN","PSOBBC",127,0)
 I $G(PSOBBC("DONE"))[PSOBBC("IRXN")_"," W !,$C(7),"Rx has already been entered" G GETRXM
"RTN","PSOBBC",128,0)
 I $G(PSOBBC1("FROM"))="REFILL" S PSOREFXM=$G(PSOBBC("IRXN")) I PSOREFXM D PSOL^PSSLOCK(PSOREFXM) I '$G(PSOMSG) D  K PSOMSG G GETRXM
"RTN","PSOBBC",129,0)
 .I $P($G(PSOMSG),"^",2)'="" W $C(7),!!?5,$P(PSOMSG,"^",2),! Q
"RTN","PSOBBC",130,0)
 .W $C(7),!!?5,"Another person is editing Rx "_$P($G(^PSRX(+$G(PSOBBC("IRXN")),0)),"^"),!
"RTN","PSOBBC",131,0)
 I '$D(PSODFNX(+$P(^PSRX(PSOBBC("IRXN"),0),"^",2))),$G(PSOBBC1("FROM"))="NEW" K PSONOERR D  G:'$G(PSOPLCK)!($G(PSONOERR)) GETRXM
"RTN","PSOBBC",132,0)
 .S PSOPLCK=$$L^PSSLOCK(+$P(^PSRX(PSOBBC("IRXN"),0),"^",2),0) I '$G(PSOPLCK) D LOCK^PSOORCPY Q
"RTN","PSOBBC",133,0)
 .S X=+$P(^PSRX(PSOBBC("IRXN"),0),"^",2)_";DPT(" D LK^ORX2 I 'Y S PSONOERR=1 D UL^PSSLOCK(+$P(^PSRX(PSOBBC("IRXN"),0),"^",2)) Q
"RTN","PSOBBC",134,0)
 .S PSODFNX(+$P(^PSRX(PSOBBC("IRXN"),0),"^",2))=""
"RTN","PSOBBC",135,0)
GETRXMX K X,Y,DIR,PSOOPT
"RTN","PSOBBC",136,0)
 Q
"RTN","PSOBBC",137,0)
 ;
"RTN","PSOBBC",138,0)
PT ;
"RTN","PSOBBC",139,0)
 S PSOBBC("DFLG")=0
"RTN","PSOBBC",140,0)
 W !,$C(7),"New Patient, please pause"
"RTN","PSOBBC",141,0)
 I $G(PPL) D SETX,TRI,Q^PSORXL K PPL
"RTN","PSOBBC",142,0)
 K RXFL
"RTN","PSOBBC",143,0)
 S (DFN,PSODFN)=$P(^PSRX(PSOBBC("IRXN"),0),"^",2),PSORX("NAME")=$P(^DPT(PSODFN,0),"^")
"RTN","PSOBBC",144,0)
 D ICN^PSODPT(DFN)
"RTN","PSOBBC",145,0)
 ;CHECK FOR BAD ADDRESS/SAB
"RTN","PSOBBC",146,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSOBBC",147,0)
 D ^PSOBUILD
"RTN","PSOBBC",148,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSOBBC",149,0)
 K PSOX
"RTN","PSOBBC",150,0)
PTC S (DFN,PSODFN)=$P(^PSRX(PSOBBC("IRXN"),0),"^",2)
"RTN","PSOBBC",151,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSOBBC",152,0)
 S PSOBBC("DFLG")=0 D GET^PSOPTPST
"RTN","PSOBBC",153,0)
 I $G(PSOPTPST(2,PSODFN,.351))]"" S PSOBBC("DFLG")=1 D DEAD^PSOPTPST G PTX
"RTN","PSOBBC",154,0)
 N PSOTPEXT I $G(PSOBBC1("FROM"))="NEW",$D(^PS(52.91,PSODFN,0)) I '$P(^PS(52.91,PSODFN,0),"^",3)!($P(^(0),"^",3)>DT) D PDIR^PSOTPCAN(PSODFN) I $G(PSOTPEXT) K PSOTPEXT S PSOBBC("DFLG")=1 G PTX
"RTN","PSOBBC",155,0)
 K PSOTPEXT
"RTN","PSOBBC",156,0)
 I $G(PSOPTPST(2,PSODFN,.1))]"" D:'PSOBBC("INOK") PID W !,$C(7),?10,"PATIENT IS AN INPATIENT ON WARD ",PSOPTPST(2,PSODFN,.1)," !!" I 'PSOBBC("INOK") S PSOBBC("DFLG")=1 G PTX
"RTN","PSOBBC",157,0)
 K PSORX("CNH")
"RTN","PSOBBC",158,0)
 I $G(PSOPTPST(2,PSODFN,148))="YES" D:'PSOBBC("CNHOK") PID W !,$C(7),?10,"PATIENT IS IN A CONTRACT NURSING HOME !!" S:PSOBBC("CNHOK") PSORX("CNH")=1 I 'PSOBBC("CNHOK") S PSOBBC("DFLG")=1 G PTX
"RTN","PSOBBC",159,0)
 D:PSOBBC1("FROM")="NEW" COPAY^PSOPTPST
"RTN","PSOBBC",160,0)
PTX K PSOPTPST W:PSOBBC("DFLG") !!,$C(7),"Rx not filled"
"RTN","PSOBBC",161,0)
 Q
"RTN","PSOBBC",162,0)
 ;
"RTN","PSOBBC",163,0)
REFILL ;
"RTN","PSOBBC",164,0)
 N PSOFROM S PSOFROM="REFILL",XFROM="BATCH"
"RTN","PSOBBC",165,0)
 D EN^PSOREF0(.PSOBBC)
"RTN","PSOBBC",166,0)
 Q
"RTN","PSOBBC",167,0)
REFILLX ;
"RTN","PSOBBC",168,0)
 Q
"RTN","PSOBBC",169,0)
 ;
"RTN","PSOBBC",170,0)
NEW ;
"RTN","PSOBBC",171,0)
 N PSOFROM S (PSOFROM,XFROM)="BATCH"
"RTN","PSOBBC",172,0)
 S PSOBBC("OIRXN")=PSOBBC("IRXN")
"RTN","PSOBBC",173,0)
 S PSORNW("FILL DATE")=PSOBBC1("FILL DATE"),PSOOPT=3
"RTN","PSOBBC",174,0)
 S PSORX("DFLG")=0,PSOBBC("NOO")=$G(PSOBBCNO) D EN^PSORENW0(.PSOBBC)
"RTN","PSOBBC",175,0)
 S PSOBBC("MAIL/WINDOW")=PSOBBC1("MAIL/WINDOW")
"RTN","PSOBBC",176,0)
 S PSOBBC("EAOK")=$G(PSOBBC1("EAOK"))
"RTN","PSOBBC",177,0)
 S PSOBBC("QS")=PSOBBC1("QS")
"RTN","PSOBBC",178,0)
 S PSOBBC("INOK")=PSOBBC1("INOK")
"RTN","PSOBBC",179,0)
 S PSOBBC("CNHOK")=PSOBBC1("CNHOK")
"RTN","PSOBBC",180,0)
 S:$G(PSOBBC1("CLERK CODE")) PSOBBC("CLERK CODE")=PSOBBC1("CLERK CODE")
"RTN","PSOBBC",181,0)
 S:$G(PSOBBC1("EXPIRATION DATE")) PSOBBC("EXPIRATION DATE")=PSOBBC1("EXPIRATION DATE")
"RTN","PSOBBC",182,0)
 K PSORNW,PSOOPT
"RTN","PSOBBC",183,0)
 Q
"RTN","PSOBBC",184,0)
 ;
"RTN","PSOBBC",185,0)
EOJ ;
"RTN","PSOBBC",186,0)
 K PSOMSG,PSOREFXM,PSONOERR,PSOPLCK,PSOSD,PSOBBC,PSOBBC1,PSOBARID,Y,X,XFROM,PSOCOUU,PSOCOU,ACNT,ADFN,CLS,CMOP,CNT,FDR,HDR,PSCAN,JJ,POERR,PSOBCK,PSONEW3,PSORENW3,RXFL,PSOOPT
"RTN","PSOBBC",187,0)
 K PSORX,RFDT,RX1,RXS,SDA,PSONOOR,VALMBCK,VALMSG,SIG,SIGOK,STA,TM,TM1,VA,VADM,VAEL,VAPA
"RTN","PSOBBC",188,0)
 D CLEAN^PSOVER1 K ^TMP("PSORXDC",$J)
"RTN","PSOBBC",189,0)
 Q
"RTN","PSOBBC",190,0)
TRI ;Check for Tricare Rx's
"RTN","PSOBBC",191,0)
 S X="IBACUS" X ^%ZOSF("TEST") I '$T Q
"RTN","PSOBBC",192,0)
 I '$$TRI^IBACUS Q
"RTN","PSOBBC",193,0)
 Q:'$G(PPL)
"RTN","PSOBBC",194,0)
 ;PREV LINE, IN V 7 D ZOSF FIRST
"RTN","PSOBBC",195,0)
 N DA,NEWPPL,WWFLAG,PSOWRX,PSOWW,WWNEXT,WXRX,WPAT,WSITE,WDUZ,WFILL,WLOOP,WBILL,WPPLFLG,WWW
"RTN","PSOBBC",196,0)
 D DEV^PSOCPTRI
"RTN","PSOBBC",197,0)
 S NEWPPL=PPL S PPL=""
"RTN","PSOBBC",198,0)
 S (WWFLAG,WPPLFLG)=0 F PSOWW=1:1 S PSOWRX=$P(NEWPPL,",",PSOWW) D  Q:$G(WWFLAG)
"RTN","PSOBBC",199,0)
 .S WWNEXT=$P(NEWPPL,",",(PSOWW+1)) I WWNEXT=""!(WWNEXT=",") S WWFLAG=1
"RTN","PSOBBC",200,0)
 .I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOBBC",201,0)
 .S WPAT=$P($G(^PSRX(+PSOWRX,0)),"^",2),WSITE=+$G(PSOSITE),WDUZ=+$G(DUZ)
"RTN","PSOBBC",202,0)
 .S WFILL=0 F WLOOP=0:0 S WLOOP=$O(^PSRX(+PSOWRX,1,WLOOP)) Q:'WLOOP  S WFILL=WLOOP
"RTN","PSOBBC",203,0)
 .S WBILL=$$CHPUS^IBACUS(WPAT,DT,PSOWRX,WFILL,PSOLAP,WSITE,WDUZ)
"RTN","PSOBBC",204,0)
 .I '$G(WBILL) S WXRX(PSOWW,PSOWRX)="" Q
"RTN","PSOBBC",205,0)
 .S WPPLFLG=1
"RTN","PSOBBC",206,0)
 .S FLD(99)="99",FLD(99.1)="Awaiting CHAMPUS billing approval"
"RTN","PSOBBC",207,0)
 .N RSDT,ACT,PSUS,RXF,I,PSDA,NOW,IR,FDA,RFN S DA=PSOWRX D H^PSOCPTRH Q
"RTN","PSOBBC",208,0)
 I '$G(WPPLFLG) S PPL=NEWPPL Q
"RTN","PSOBBC",209,0)
 S WWW="" F  S WWW=$O(WXRX(WWW)) Q:WWW=""  D
"RTN","PSOBBC",210,0)
 .I $G(PPL)="" S PPL=$O(WXRX(WWW,0))_"," Q
"RTN","PSOBBC",211,0)
 .S PPL=PPL_$O(WXRX(WWW,0))_","
"RTN","PSOBBC",212,0)
 Q
"RTN","PSOBBC",213,0)
ULK ;
"RTN","PSOBBC",214,0)
 Q:$G(PSOBBC1("FROM"))'="NEW"
"RTN","PSOBBC",215,0)
 I '$G(PSODFN) Q
"RTN","PSOBBC",216,0)
 S X=PSODFN_";DPT(" D ULK^ORX2 K PSODFNX(PSODFN) Q
"RTN","PSOBBC",217,0)
ULP Q:$G(PSOBBC1("FROM"))'="NEW"
"RTN","PSOBBC",218,0)
 Q:'$G(PSODFN)
"RTN","PSOBBC",219,0)
 D UL^PSSLOCK(PSODFN)
"RTN","PSOBBC",220,0)
 Q
"RTN","PSOBBC",221,0)
ULRX ;
"RTN","PSOBBC",222,0)
 Q:$G(PSOBBC1("FROM"))'="REFILL"
"RTN","PSOBBC",223,0)
 Q:'$G(PSOREFXM)
"RTN","PSOBBC",224,0)
 D PSOUL^PSSLOCK(PSOREFXM)
"RTN","PSOBBC",225,0)
 K PSOREFXM
"RTN","PSOBBC",226,0)
 Q
"RTN","PSOBBC",227,0)
 ;
"RTN","PSOBBC",228,0)
SETX ;
"RTN","PSOBBC",229,0)
 S:$G(PSOBBC1("FROM"))="REFILL" XFROM="BATCH"
"RTN","PSOBBC",230,0)
 S:$G(PSOBBC1("FROM"))="NEW" XFROM="BATCH"
"RTN","PSOBBC",231,0)
 Q
"RTN","PSOBBC",232,0)
PID ;
"RTN","PSOBBC",233,0)
 I '$G(DFN) S DFN=+$G(PSODFN)
"RTN","PSOBBC",234,0)
 Q:'$G(DFN)
"RTN","PSOBBC",235,0)
 K VAPTYP D PID^VADPT
"RTN","PSOBBC",236,0)
 W !!,?9,$G(PSORX("NAME"))_"    ",$G(VA("BID"))
"RTN","PSOBBC",237,0)
 K VA("BID"),VA("PID")
"RTN","PSOBBC",238,0)
 Q
"RTN","PSODIR")
0^12^B29087879^B29145455
"RTN","PSODIR",1,0)
PSODIR ;BHAM ISC/SAB - asks data for rx order entry ;02/12/93 8:49
"RTN","PSODIR",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**37,46,111,117,146,164,211,264**;DEC 1997;Build 19
"RTN","PSODIR",3,0)
 ;External reference PSDRUG( supported by DBIA 221
"RTN","PSODIR",4,0)
 ;External reference PS(50.7 supported by DBIA 2223
"RTN","PSODIR",5,0)
 ;External reference to VA(200 is supported by DBIA 10060
"RTN","PSODIR",6,0)
 ;----------------------------------------------------------------
"RTN","PSODIR",7,0)
 ;
"RTN","PSODIR",8,0)
PROV(PSODIR) ;
"RTN","PSODIR",9,0)
PROVEN ; Entry point for failed lookup
"RTN","PSODIR",10,0)
 K DIC,X,Y S:$G(PSOFDR)&($G(OR0)) DIC("B")=$P(^VA(200,$P($G(OR0),"^",5),0),"^")
"RTN","PSODIR",11,0)
 I $G(PSODIR("PROVIDER"))]"" S PSODIR("OLD VAL")=PSODIR("PROVIDER")
"RTN","PSODIR",12,0)
 S DIC="^VA(200,",DIC(0)="QEAM",PSODIR("FIELD")=0
"RTN","PSODIR",13,0)
 S DIC("W")="W ""     "",$P(^(""PS""),""^"",9)"
"RTN","PSODIR",14,0)
 S DIC("A")="PROVIDER: ",DIC("S")="I $D(^(""PS"")),$P(^(""PS""),""^""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)'<DT)"
"RTN","PSODIR",15,0)
 I $G(PSOTPBFG),$G(PSOFROM)="NEW" S DIC("S")=DIC("S")_",$P($G(^(""TPB"")),""^""),$P($G(^(""TPB"")),""^"",5)=0"
"RTN","PSODIR",16,0)
 S:$G(PSORX("PROVIDER NAME"))]"" DIC("B")=PSORX("PROVIDER NAME")
"RTN","PSODIR",17,0)
 D ^DIC K DIC
"RTN","PSODIR",18,0)
 I X[U,$L(X)>1 D:'$G(PSOEDIT) JUMP G PROVX
"RTN","PSODIR",19,0)
 I $D(DTOUT)!$D(DUOUT) S PSODIR("DFLG")=1 G PROVX
"RTN","PSODIR",20,0)
 I '$G(SPEED),Y=-1 G PROVEN
"RTN","PSODIR",21,0)
 Q:$G(SPEED)&(Y=-1)
"RTN","PSODIR",22,0)
 ;PSO*7*211; ADD CHECK FOR DEA# AND VA#
"RTN","PSODIR",23,0)
 I $P($G(PSODIR("CS")),"^",1)!($D(CLOZPAT)) I '$L($P($G(^VA(200,+Y,"PS")),U,2)),'$L($P($G(^VA(200,+Y,"PS")),U,3)) D  G PROVEN
"RTN","PSODIR",24,0)
 .W $C(7),!!,"Provider must have a DEA# or VA#"_$S($D(CLOZPAT):" to write prescriptions for clozapine.",1:""),!
"RTN","PSODIR",25,0)
 I $D(CLOZPAT),'$D(^XUSEC("YSCL AUTHORIZED",+Y)) D  G PROVEN
"RTN","PSODIR",26,0)
 .W $C(7),!!,"Provider must hold YSCL AUTHORIZED key to write prescriptions for clozapine.",!
"RTN","PSODIR",27,0)
 I '$G(PSODRUG("IEN")),'$G(PSORENW("DRUG IEN")) G NODRUG
"RTN","PSODIR",28,0)
 ;I '$G(SPEED),$P($G(^PSDRUG($S($G(PSODRUG("IEN")):PSODRUG("IEN"),1:PSORENW("DRUG IEN")),"CLOZ1")),"^")="PSOCLO1",$P(^VA(200,+Y,"PS"),"^",2)'?2U7N D  K Y,PSORX("PROVIDER NAME"),DIC("B") G PROVEN
"RTN","PSODIR",29,0)
 ;.W $C(7),!!,"Only providers with DEA numbers can write prescriptions for clozapine.",!
"RTN","PSODIR",30,0)
NODRUG S PSODIR("PROVIDER")=+Y
"RTN","PSODIR",31,0)
 S (PSODIR("PROVIDER NAME"),PSORX("PROVIDER NAME"))=$P(Y,"^",2)
"RTN","PSODIR",32,0)
 I $G(PSODIR("OLD VAL"))'=+Y K PSODIR("GENERIC PROVIDER"),PSODIR("COSIGNING PROVIDER")
"RTN","PSODIR",33,0)
 I $G(PSODIR("OLD VAL"))'=$G(PSODIR("PROVIDER")),$P(Y,"^",2)="PROVIDER,OTHER"!($P(Y,"^",2)="PROVIDER,OUTSIDE") D GENERIC
"RTN","PSODIR",34,0)
 I $P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",7),$P(^("PS"),"^",8) D COSIGN
"RTN","PSODIR",35,0)
 I $G(PSODIR("COSIGNING PROVIDER")),'$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",7) K PSODIR("COSIGNING PROVIDER")
"RTN","PSODIR",36,0)
PROVX K X,Y
"RTN","PSODIR",37,0)
 Q
"RTN","PSODIR",38,0)
 ;
"RTN","PSODIR",39,0)
GENERIC ;
"RTN","PSODIR",40,0)
 K DIR,DIC,PSODIR("GENERIC PROVIDER")
"RTN","PSODIR",41,0)
 S DIR(0)="52,30"
"RTN","PSODIR",42,0)
 D DIR G:PSODIR("DFLG")!PSODIR("FIELD") GENERICX
"RTN","PSODIR",43,0)
 S PSODIR("GENERIC PROVIDER")=Y
"RTN","PSODIR",44,0)
GENERICX K X,Y
"RTN","PSODIR",45,0)
 Q
"RTN","PSODIR",46,0)
 ;
"RTN","PSODIR",47,0)
COSIGN ;
"RTN","PSODIR",48,0)
 K DIC
"RTN","PSODIR",49,0)
 I '$G(PSODIR("COSIGNING PROVIDER")),$P($G(RX3),"^",3) S PSODIR("COSIGNING PROVIDER")=$P(RX3,"^",3) G COSIGN1
"RTN","PSODIR",50,0)
 I $P($G(RX3),"^",3),$P($G(RX3),"^",3)'=$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",8) D
"RTN","PSODIR",51,0)
 .W !!,"Previous Co-Signing Provider: "_$P(^VA(200,$P(RX3,"^",3),0),"^")
"RTN","PSODIR",52,0)
 .S PSODIR("COSIGNING PROVIDER")=$S($P(RX3,"^",3)'=PSODIR("COSIGNING PROVIDER"):PSODIR("COSIGNING PROVIDER"),1:$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",8))
"RTN","PSODIR",53,0)
COSIGN1 S DIC(0)="QEAM",DIC="^VA(200,",DIC("B")=$S($G(PSODIR("COSIGNING PROVIDER")):$P(^VA(200,PSODIR("COSIGNING PROVIDER"),0),"^"),1:$P(^VA(200,PSODIR("PROVIDER"),"PS"),"^",8))
"RTN","PSODIR",54,0)
 S DIC("S")="I $D(^(""PS"")),$P(^(""PS""),""^""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)'<DT)"
"RTN","PSODIR",55,0)
 S DIC("W")="W ""     "",$P(^(""PS""),""^"",9)",DIC("S")=DIC("S")_",'$P(^(""PS""),""^"",7)"
"RTN","PSODIR",56,0)
 S DIC("A")="COSIGNING PROVIDER: " D ^DIC K DIC
"RTN","PSODIR",57,0)
 I $D(DTOUT)!$D(DUOUT) S PSODIR("DFLG")=1 G COSIGNX
"RTN","PSODIR",58,0)
 S:+Y>0 PSODIR("COSIGNING PROVIDER")=+Y G:Y<0 COSIGN
"RTN","PSODIR",59,0)
COSIGNX K X,Y
"RTN","PSODIR",60,0)
 Q
"RTN","PSODIR",61,0)
DOSE(PSODIR) ;add dosing info
"RTN","PSODIR",62,0)
 D DOSE1^PSOORED5(.PSODIR)
"RTN","PSODIR",63,0)
EX K PSODOSE,PSOSCH,DOSE,DOOR,SCH,VERB,NOUN,DOSEOR,ENT,PSORTE,DRUA,DIR,X,Y,DIRUT,RTE,ERTE,DD,INS1,SINS1
"RTN","PSODIR",64,0)
 Q
"RTN","PSODIR",65,0)
INS(PSODIR) ;patient instructions
"RTN","PSODIR",66,0)
 N DA K INS1,DD,DIR,DIRUT S D=0 F  S D=$O(PSODIR("SIG",D)) Q:'D  S DD=$G(DD)+1
"RTN","PSODIR",67,0)
 I $G(DD)=1 S PSODIR("INS")=$G(PSODIR("SIG",1)) G INSD
"RTN","PSODIR",68,0)
 I ($G(PSOINSFL)=1&($G(DD)>1))!($G(PSOFDR)&($G(ORD))&($P($G(^PS(52.41,+$G(ORD),"EXT")),"^")'="")&($G(DD)>1)) D  G EX
"RTN","PSODIR",69,0)
 .K ^TMP($J) S D=0 F  S D=$O(PSODIR("SIG",D)) Q:'D  S ^TMP($J,"SIG",D,0)=PSODIR("SIG",D)
"RTN","PSODIR",70,0)
 .S DWPK=2,DWLW=80,DIC="^TMP($J,""SIG""," D EN^DIWE K PSODIR("SIG")
"RTN","PSODIR",71,0)
 .S D=0 F  S D=$O(^TMP($J,"SIG",D)) Q:'D  S PSODIR("SIG",D)=^TMP($J,"SIG",D,0)
"RTN","PSODIR",72,0)
 .D EN^PSOFSIG(.PSODIR,1) K DWLW,D,DWPK,^TMP($J)
"RTN","PSODIR",73,0)
 I $G(PSOINSFL)=0 G INSD
"RTN","PSODIR",74,0)
 I $G(PSOFDR),$G(ORD),$P($G(^PS(52.41,+$G(ORD),"EXT")),"^")'="" G INSD
"RTN","PSODIR",75,0)
 I $G(PSODIR("INS"))']"",$G(^PS(50.7,PSODRUG("OI"),"INS"))]"" S DIR("B")=^PS(50.7,PSODRUG("OI"),"INS")
"RTN","PSODIR",76,0)
INSD S DIR(0)="52,114" S:$G(PSODIR("INS"))]"" DIR("B")=PSODIR("INS")
"RTN","PSODIR",77,0)
 D DIR G:$G(PSODIR("DFLG"))!(PSODIR("FIELD")) EX
"RTN","PSODIR",78,0)
 I X'="",X'="@" S PSODIR("INS")=Y D SIG^PSOHELP G INSD:'$D(X)
"RTN","PSODIR",79,0)
 I $G(INS1)]"" D EN^DDIOL($E(INS1,2,9999999)) S (PSODIR("SIG",1),PSODIR("SIG"))=$E(INS1,2,9999999)
"RTN","PSODIR",80,0)
 I X="@" K PSODIR("INS"),PSODIR("SIG")
"RTN","PSODIR",81,0)
 D EN^PSOFSIG(.PSODIR,1) I $O(SIG(0)) S SIGOK=1
"RTN","PSODIR",82,0)
 G EX
"RTN","PSODIR",83,0)
 Q
"RTN","PSODIR",84,0)
SINS(PSODIR) ;other lang. patient instructions
"RTN","PSODIR",85,0)
 K SINS1,DIR
"RTN","PSODIR",86,0)
 S DIR(0)="52,114.1" S:$G(PSODIR("SINS"))]"" DIR("B")=PSODIR("SINS")
"RTN","PSODIR",87,0)
 I $G(PSODIR("SINS"))']"",$G(^PS(50.7,PSODRUG("OI"),"INS1"))]"" S DIR("B")=^PS(50.7,PSODRUG("OI"),"INS1")
"RTN","PSODIR",88,0)
 D DIR G:$G(PSODIR("DFLG")) EX
"RTN","PSODIR",89,0)
 I X'="",X'="@" S PSODIR("SINS")=Y D SSIG^PSOHELP
"RTN","PSODIR",90,0)
 I $G(SINS1)]"" D EN^DDIOL($E(SINS1,2,9999999)) S PSODIR("SINS")=$E(SINS1,2,9999999)
"RTN","PSODIR",91,0)
 I X="@" K PSODIR("SINS")
"RTN","PSODIR",92,0)
 G EX
"RTN","PSODIR",93,0)
 Q
"RTN","PSODIR",94,0)
 ;
"RTN","PSODIR",95,0)
DIR ;
"RTN","PSODIR",96,0)
 S PSODIR("FIELD")=0
"RTN","PSODIR",97,0)
 G:$G(DIR(0))']"" DIRX
"RTN","PSODIR",98,0)
 D ^DIR K DIR,DIE,DIC,DA
"RTN","PSODIR",99,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)),$L($G(X))'>1 S PSODIR("DFLG")=1 G DIRX
"RTN","PSODIR",100,0)
 I X[U,$L(X)>1 D:'$G(PSOEDIT) JUMP
"RTN","PSODIR",101,0)
DIRX K DIRUT,DTOUT,DUOUT,DIROUT,PSOX
"RTN","PSODIR",102,0)
 Q
"RTN","PSODIR",103,0)
 ;
"RTN","PSODIR",104,0)
JUMP ;
"RTN","PSODIR",105,0)
 I $G(PSOEDIT)!($G(OR0)) S PSODIR("DFLG")=1 Q
"RTN","PSODIR",106,0)
 S X=$P(X,"^",2),DIC="^DD(52,",DIC(0)="QM" D ^DIC K DIC
"RTN","PSODIR",107,0)
 I Y=-1 S PSODIR("FIELD")=$G(PSODIR("FLD")) G JUMPX
"RTN","PSODIR",108,0)
 I $G(PSONEW1)=0 D JUMP^PSONEW1 G JUMPX
"RTN","PSODIR",109,0)
 I $G(PSOREF1)=0 D JUMP^PSOREF1 G JUMPX
"RTN","PSODIR",110,0)
 I $G(PSONEW3)=0 D JUMP^PSONEW3 G JUMPX
"RTN","PSODIR",111,0)
 I $G(PSORENW3)=0 D JUMP^PSORENW3 G JUMPX
"RTN","PSODIR",112,0)
JUMPX S X="^"_X
"RTN","PSODIR",113,0)
 Q
"RTN","PSOLLL1")
0^13^B70201021^B67443546
"RTN","PSOLLL1",1,0)
PSOLLL1 ;BIR/BHW - LASER LABELS ;10/24/2002
"RTN","PSOLLL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,141,135,162,161,233,200,264**;DEC 1997;Build 19
"RTN","PSOLLL1",3,0)
 ;
"RTN","PSOLLL1",4,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLLL1",5,0)
 ;Reference ^VA(200,D0,"PS" supported by DBIA 224
"RTN","PSOLLL1",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLLL1",7,0)
 ;
"RTN","PSOLLL1",8,0)
ST I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4),PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSOLLL1",9,0)
 . I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_+$P($G(^PSRX(RX,3)),"^",3)
"RTN","PSOLLL1",10,0)
 S $P(ULN,"_",34)="",PSOTRAIL=1
"RTN","PSOLLL1",11,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSOLLL1",12,0)
 S Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLL1",13,0)
 S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLLL1",14,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",15,0)
L1 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLL1",16,0)
 I 'SIGF,'SIGM,'PMIM K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 D  S PSOSTLK=1 ; PRINT ONE SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLLL1",17,0)
 .D 6^VADPT,PID^VADPT6 S SSNPN=$G(VA("BID"))
"RTN","PSOLLL1",18,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_" "_$G(PSOHZIP) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",19,0)
 S T=$P(PS2,"^",2)_"  "_TECH_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",20,0)
 S PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8)
"RTN","PSOLLL1",21,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLL1",22,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",23,0)
 S T="Rx# "_RXN_"  " S:SIGF!($G(FILLCONT)) T=" " D PRINT(T,1)
"RTN","PSOLLL1",24,0)
 D STRT^PSOLLU1("RX#",T,.L) S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX
"RTN","PSOLLL1",25,0)
 S DR=$G(SIGF("DR"))
"RTN","PSOLLL1",26,0)
 S T="  "_DATE_"  "_$S('SIGF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(label continued)") S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",27,0)
 S PSOX=OPSOX,T=PNM S:SIGF!($G(FILLCONT)) T=" " I T'=" " D PRINT(T,1)
"RTN","PSOLLL1",28,0)
 I DR>1 S PSOX=OPSOX,T="Rx# "_RXN_"  (label continued)" D PRINT(T)
"RTN","PSOLLL1",29,0)
 D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",30,0)
 S OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX,PSOY=PSOY-PSOYI,T="  "_$G(SSNPN) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",31,0)
 S PSOX=OPSOX,LENGTH=0,PTEXT="",SIGF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",32,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSOLLL1",33,0)
 I 'SIGM,'$G(FILLCONT) D COUNTSG^PSOLLLW
"RTN","PSOLLL1",34,0)
 S DR=SIGF("DR")
"RTN","PSOLLL1",35,0)
 I DR>1,'$D(NSGY(DR,4)) D
"RTN","PSOLLL1",36,0)
 .F I=4:-1:1 Q:$D(NSGY(DR,I))  S T=" " D PRINT(T) ; BOTTOM-JUSTIFY CONTINUED BOTTLE SIG JUST ABOVE 'DISCARD' LINE
"RTN","PSOLLL1",37,0)
 F I=1:1 Q:'$D(NSGY(DR,I))  S TEXT=NSGY(DR,I) D PRINT(TEXT)
"RTN","PSOLLL1",38,0)
 I I>4,$D(NSGY(DR,5)) S SIGF=1,SIGF("DR")=DR+1
"RTN","PSOLLL1",39,0)
 I $G(PSOIO("BLF"))]"" X PSOIO("BLF")
"RTN","PSOLLL1",40,0)
 S PSOY=PSODY-PSOYI,PSOFONT=PSODFONT
"RTN","PSOLLL1",41,0)
 I SIGF G WARN:'SIGM&('$G(FILLCONT)),CONT
"RTN","PSOLLL1",42,0)
 I '$D(NSGY) G CONT
"RTN","PSOLLL1",43,0)
 K NSGY,^TMP($J,"PSOSIG",RX)
"RTN","PSOLLL1",44,0)
 D NOW^%DTC S X1=X,X2=365 D C^%DTC S Y=X X ^DD("DD")
"RTN","PSOLLL1",45,0)
 S DEA=$P($G(^PSDRUG($P(RXY,"^",6),0)),"^",3),T=""
"RTN","PSOLLL1",46,0)
 I DEA'["S" S T="Discard after "_$S(DEA[0!(DEA["M"):"_________",1:Y)_"__________   "
"RTN","PSOLLL1",47,0)
 S T=T_"Mfr_________" D PRINT(T)
"RTN","PSOLLL1",48,0)
 S PSOY=PSOY-5
"RTN","PSOLLL1",49,0)
 D  S PSOFONT="F8"  D PRINT(T)
"RTN","PSOLLL1",50,0)
 . S NOR=$P(RXY,"^",9)-RXF
"RTN","PSOLLL1",51,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL" Q
"RTN","PSOLLL1",52,0)
 . I NOR=0 S T="NO REFILLS LEFT" Q
"RTN","PSOLLL1",53,0)
 . S T="May refill "_NOR_"X by "_EXPDT
"RTN","PSOLLL1",54,0)
 S PPHYS=$G(PHYS)
"RTN","PSOLLL1",55,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSOLLL1",56,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSOLLL1",57,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSOLLL1",58,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSOLLL1",59,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSOLLL1",60,0)
 I LENGTH>3 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.3 Q 
"RTN","PSOLLL1",61,0)
 S PSOFONT=PSOTFONT,OPSOX=PSOX,PSOX=PSOX+(Q(1)*300),PSOY=PSOQY-PSOYI,T=$G(QTY) D PRINT(T)
"RTN","PSOLLL1",62,0)
 S PSOX=OPSOX,PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSOLLL1",63,0)
 S PSOX=PSOX+(Q(1)+Q(4)*300),PSOY=PSOY-PSOYI,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSOLLL1",64,0)
 S PSOFONT=PSOTFONT,PSOX=OPSOX,PSOY=PSOTY-PSOYI,T=DRUG D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",65,0)
 I L($E(PSOFONT,2,99))>3 S PSOFONT=$S(PSOFONT="F12":"F10",PSOFONT="F10":"F9",PSOFONT="F9":F8,PSOFONT="F8":"F6")
"RTN","PSOLLL1",66,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLLL1",67,0)
 I $G(PSOSTLK) S T=$S($G(PSOSTALK):ZTKDRUG,1:DRUG)
"RTN","PSOLLL1",68,0)
 D PRINT(T,1)
"RTN","PSOLLL1",69,0)
 I SIGM G CONT
"RTN","PSOLLL1",70,0)
 S ^PSRX(RX,"TYPE")=0
"RTN","PSOLLL1",71,0)
WARN ;PRINT WARNING LABELS
"RTN","PSOLLL1",72,0)
 I $G(PSOIO("WLI"))]"" X PSOIO("WLI")
"RTN","PSOLLL1",73,0)
 ; IF <5 WARNINGS, PRINT LABELS BOTTOM-JUSTIFIED
"RTN","PSOLLL1",74,0)
 S PSOLAN=$P($G(^PS(55,DFN,"LAN")),"^",2)
"RTN","PSOLLL1",75,0)
 S WARN5=WARN F  Q:$L(WARN5,",")>4  S WARN5=" ,"_WARN5
"RTN","PSOLLL1",76,0)
 F WWW=1:1:5 S PSOWARN=$P(WARN5,",",WWW) I PSOWARN'="" D
"RTN","PSOLLL1",77,0)
 . I PSOWARN["N" D NEWWARN^PSOLLLW Q
"RTN","PSOLLL1",78,0)
 . D WARN54^PSOLLLW
"RTN","PSOLLL1",79,0)
 ;RETURN MAIL
"RTN","PSOLLL1",80,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"") I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLL1",81,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",82,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",83,0)
 I $G(PSOIO("RMI"))]"" X PSOIO("RMI")
"RTN","PSOLLL1",84,0)
 S PSOYI=$G(PSOHYI,40),OFONT=PSOFONT,PSOFONT=$G(PSOHFONT)
"RTN","PSOLLL1",85,0)
 S BLNKLIN="",$P(BLNKLIN," ",40)=" "
"RTN","PSOLLL1",86,0)
 S T="Attn: (119)"_BLNKLIN_$$FMTE^XLFDT(DT) D PRINT(T,0)
"RTN","PSOLLL1",87,0)
 S T=$G(VASTREET) D PRINT(T,0)
"RTN","PSOLLL1",88,0)
 S T=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(T,0)
"RTN","PSOLLL1",89,0)
 S PSOY=PSOY+PSOYI,T=$S(PS55=2:"***DO NOT MAIL***",1:"") I T'="" D PRINT(T,0)
"RTN","PSOLLL1",90,0)
 I T'="***DO NOT MAIL***" S T=$S(PS55[0!(PS55[3)!(PS55=""):"REGULAR MAIL",1:"CERTIFIED MAIL") S T=T_"-"_$G(MAILCOM) S:$L(T)>25 PSOFONT="F8" D PRINT(T,0)
"RTN","PSOLLL1",91,0)
 S PSOFONT=OFONT
"RTN","PSOLLL1",92,0)
 S T=PNM
"RTN","PSOLLL1",93,0)
 S PSOY=PSOY+PSOYI,PSOYI=PSORYI D PRINT(T,0)
"RTN","PSOLLL1",94,0)
 I $G(VAPA(1))=""!(PS55=2) G W
"RTN","PSOLLL1",95,0)
 ; ADD CHECK FOR BAD ADDRESS INDICATOR OR FOREIGN ADDRESS
"RTN","PSOLLL1",96,0)
 N PSOBADR,PSOTEMP,PSOFORGN,I
"RTN","PSOLLL1",97,0)
 S PSOBADR=0,PSOTEMP=0
"RTN","PSOLLL1",98,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2) I PSOFORGN'="",PSOFORGN'["UNITED STATES" S PSOFORGN=1
"RTN","PSOLLL1",99,0)
 I 'PSOFORGN S PSOBADR=$$BADADR^DGUTL3(DFN)
"RTN","PSOLLL1",100,0)
 I 'PSOFORGN,PSOBADR S PSOTEMP=$$CHKTEMP^PSOBAI(DFN)
"RTN","PSOLLL1",101,0)
 F I=1:1:3 I $G(VAPA(I))]"" D
"RTN","PSOLLL1",102,0)
 . S T="" I I=1,'PSOFORGN,PSOBADR,'$G(PSOTEMP) S T="** BAD ADDRESS INDICATED **"
"RTN","PSOLLL1",103,0)
 . I I=1,T="",PSOFORGN S T="*** FOREIGN ADDRESS ***"
"RTN","PSOLLL1",104,0)
 . I T="" I 'PSOFORGN I 'PSOBADR!$G(PSOTEMP) S T=$G(VAPA(I))
"RTN","PSOLLL1",105,0)
 . D STRT^PSOLLU1("ML",T,.L) I L($E(PSOFONT,2,99))<2.37 D PRINT(T,0) Q
"RTN","PSOLLL1",106,0)
 . F F=12,10,9,8,6 I L(F)<2.37 S OFONT=PSOFONT,PSOFONT="F"_F D PRINT(T,0) S PSOFONT=OFONT Q
"RTN","PSOLLL1",107,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",108,0)
 S T="" I 'PSOFORGN I 'PSOBADR!$G(PSOTEMP) S T=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL1",109,0)
 D PRINT(T,0)
"RTN","PSOLLL1",110,0)
W ;
"RTN","PSOLLL1",111,0)
 S T=$S(MW="WINDOW":"WINDOW -",1:"MAIL -")
"RTN","PSOLLL1",112,0)
 N XFONT
"RTN","PSOLLL1",113,0)
 S OFONT=PSOFONT,PSOYI=$G(PSOTYI,40),PSOFONT=PSOTFONT,XFONT=$E(PSOFONT,2,99),PSOY=PSOTY
"RTN","PSOLLL1",114,0)
 I T["WINDOW" D
"RTN","PSOLLL1",115,0)
 . I $G(^PSRX(RX,"MP"))'="" S PSOY=PSOY-PSOYI ; START 1 LINE HIGHER IF METHOD OF PICK-UP
"RTN","PSOLLL1",116,0)
 . S OPSOX=PSOX D PRINT(T,1) S PSOX=PSOX+200,PSOY=PSOY-PSOYI
"RTN","PSOLLL1",117,0)
 . S T=$G(^PSRX(RX,"MP")) I T="" S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSOLLL1",118,0)
 . N FIRST
"RTN","PSOLLL1",119,0)
 . S FIRST=1
"RTN","PSOLLL1",120,0)
 . D STRT^PSOLLU1("ML",T,.L)
"RTN","PSOLLL1",121,0)
 . I L(XFONT)<1.75 D PRINT(T,0) S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSOLLL1",122,0)
 . F F=10,9,8,6 I L(F)<4.5 Q
"RTN","PSOLLL1",123,0)
 . S XFONT=F,PSOFONT="F"_F,PSOYI=$S(PSOFONT="F12":40,PSOFONT="F10":35,PSOFONT="F9":30,PSOFONT="F8":25,1:20)
"RTN","PSOLLL1",124,0)
 . F J=$L(T," "):-1:1 S PTEXT=$P(T," ",1,J) D STRT^PSOLLU1("ML",PTEXT,.L) D  Q:T=""
"RTN","PSOLLL1",125,0)
 .. I FIRST I L(XFONT)<1.75 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT="",FIRST=0,PSOX=OPSOX,PSOY=PSOY+20 Q
"RTN","PSOLLL1",126,0)
 .. I 'FIRST I L(XFONT)<2.3 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT=""
"RTN","PSOLLL1",127,0)
 . D:PTEXT]"" PRINT(PTEXT,0)
"RTN","PSOLLL1",128,0)
 I T="MAIL -" D PRINT(T,1)
"RTN","PSOLLL1",129,0)
 S PSOFONT=OFONT
"RTN","PSOLLL1",130,0)
CONT I $G(SIDE) G BARC:'L5,CONT2
"RTN","PSOLLL1",131,0)
 I $G(COPIES)>1 G BARC
"RTN","PSOLLL1",132,0)
 I 'L2!PFM D ^PSOLLL2 S L2=1
"RTN","PSOLLL1",133,0)
 I 'L3 D ^PSOLLL3 S L3=1
"RTN","PSOLLL1",134,0)
 I 'L4!PMIM S PIMI=0 D ^PSOLLL4 S L4=1
"RTN","PSOLLL1",135,0)
 I L5 W @IOF G CONT2
"RTN","PSOLLL1",136,0)
BARC I $G(BOTTLBL) G BARCE ; ONLY PRINT BARCODE ON 1ST BOTTLE LABEL
"RTN","PSOLLL1",137,0)
 S BOTTLBL=1
"RTN","PSOLLL1",138,0)
 I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSOLLL1",139,0)
 S X2=PSOINST_"-"_RX W X2
"RTN","PSOLLL1",140,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSOLLL1",141,0)
BARCE W @IOF
"RTN","PSOLLL1",142,0)
COPY I SIGF S SIGM=1 G L1 ; NEED TO FINISH PRINTING CONTINUED BOTTLE LABEL
"RTN","PSOLLL1",143,0)
 S FILLCONT=0 I PFM!PMIM S FILLCONT=1 G L1
"RTN","PSOLLL1",144,0)
 I $G(COPIES)>1 D  G L1
"RTN","PSOLLL1",145,0)
 . S COPIES=COPIES-1
"RTN","PSOLLL1",146,0)
 . S (SIGM,PFM,PMIM,L2,L3,L4,L5,BOTTLBL)=0
"RTN","PSOLLL1",147,0)
 . K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLL1",148,0)
 . F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLL1",149,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLLL1",150,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",151,0)
 S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),$G(PCOMH(RX))]"":PCOMH(RX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLLL1",152,0)
 N PSOBADR,PSOTEMP
"RTN","PSOLLL1",153,0)
 S PSOBADR=$$CHKRX^PSOBAI(RX)
"RTN","PSOLLL1",154,0)
 I $G(PSOBADR) S PSOTEMP=$P(PSOBADR,"^",2),PSOBADR=$P(PSOBADR,"^")
"RTN","PSOLLL1",155,0)
 I $G(PSOBADR),'$G(PSOTEMP) D
"RTN","PSOLLL1",156,0)
 .S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",157,0)
 .S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_"ROUTING="_$G(MW)_" (BAD ADDRESS)"_"^"_PDUZ
"RTN","PSOLLL1",158,0)
 S L5=1
"RTN","PSOLLL1",159,0)
CONT2 I SIGF S SIGM=1 G L1 ; MORE BOTTLE LABEL SIG TO PRINT
"RTN","PSOLLL1",160,0)
 I PMIM G CONT ; MORE PMI INFO TO PRINT
"RTN","PSOLLL1",161,0)
 I $G(PSOBLALL)=1,$P(PPL,",",PI+1)="" D TRAIL
"RTN","PSOLLL1",162,0)
 Q
"RTN","PSOLLL1",163,0)
PRINT(T,B) ;
"RTN","PSOLLL1",164,0)
 S BOLD=$G(B)
"RTN","PSOLLL1",165,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",166,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL1",167,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",168,0)
 W T,!
"RTN","PSOLLL1",169,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",170,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL1",171,0)
 Q
"RTN","PSOLLL1",172,0)
TRAIL I $G(SIDE) G END
"RTN","PSOLLL1",173,0)
 D ^PSOLLL5
"RTN","PSOLLL1",174,0)
 D ^PSOLLLH
"RTN","PSOLLL1",175,0)
 D ^PSOLLL6
"RTN","PSOLLL1",176,0)
 I '$P($G(^PS(59,PSOSITE,1)),"^",18) Q
"RTN","PSOLLL1",177,0)
 I '$G(REPRINT) D ^PSOLLL7
"RTN","PSOLLL1",178,0)
END I '$P(PSOPAR,"^",31) Q
"RTN","PSOLLL1",179,0)
 W @IOF
"RTN","PSOLLL1",180,0)
 I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSOLLL1",181,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",182,0)
 S T="NEXT PATIENT"
"RTN","PSOLLL1",183,0)
 S PSOX=1100-(L($E(PSOFONT,2,99))*300/2)
"RTN","PSOLLL1",184,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",185,0)
 W T,!
"RTN","PSOLLL1",186,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",187,0)
 Q
"RTN","PSOLLL1",188,0)
 ;
"RTN","PSOORNE2")
0^23^B67732669^B67688031
"RTN","PSOORNE2",1,0)
PSOORNE2 ;BIR/SAB-display finished orders from backdoor ; 9/11/06 10:24am
"RTN","PSOORNE2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,21,23,27,32,37,46,84,103,117,131,146,156,210,148,222,238,264**;DEC 1997;Build 19
"RTN","PSOORNE2",3,0)
 ;^PSDRUG( -  221
"RTN","PSOORNE2",4,0)
 ;^YSCL(603.01 - 2697
"RTN","PSOORNE2",5,0)
 ;^PS(50.606 - 2174
"RTN","PSOORNE2",6,0)
 ;^PS(50.7 - 2223
"RTN","PSOORNE2",7,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORNE2",8,0)
 ;$$DAWEXT^PSSDAWUT - 4708
"RTN","PSOORNE2",9,0)
 ;
"RTN","PSOORNE2",10,0)
SEL N ORN,ORD I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOORNE2",11,0)
 D K1^PSOORNE6 S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR I $D(DIRUT) D KV^PSOVER1 S VALMBCK="" Q
"RTN","PSOORNE2",12,0)
NEWSEL N ORN,ORD D K2^PSOORNE6
"RTN","PSOORNE2",13,0)
 I +Y S PSOOELSE=1,PSLST=Y K PSOREEDT D
"RTN","PSOORNE2",14,0)
 .F ORD=1:1:$L(PSLST,",") Q:$P(PSLST,",",ORD)']""  S ORN=+$P(PSLST,",",ORD) D @$S(+PSOLST(ORN)=52:"ACT",1:"PEN^PSOORNE5") K PSOREEDT,PSOSIGFL,PSONACT,SIGOK,PSOFDR,DRET,SIG,INS1 D UL1 I $G(PSOQUIT) K PSOQUIT Q
"RTN","PSOORNE2",15,0)
 K PRC,PHI,RTE I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSOORNE2",16,0)
 K PSONACT,PSOOELSE,CLOZPAT D ^PSOBUILD,BLD^PSOORUT1,K3^PSOORNE6
"RTN","PSOORNE2",17,0)
 Q
"RTN","PSOORNE2",18,0)
 ;
"RTN","PSOORNE2",19,0)
ACT N REF K ^TMP("PSOAO",$J),PCOMX,PDA,PHI,PRC,ACOM,ANS,PSOFDR,CLOZPAT,ANQREM,DUR,DRET
"RTN","PSOORNE2",20,0)
 S RXN=$P(PSOLST(ORN),"^",2),RX0=^PSRX(RXN,0),RX2=$G(^(2)),RX3=$G(^(3)),ST=+$G(^("STA")),RXOR=$G(^("OR1")),POE=$G(^("POE")),EXDT=$S($P($G(^(2)),"^",6)>DT:1,1:0)
"RTN","PSOORNE2",21,0)
 I 'RX3 S RX3=$P(RX2,"^",2),$P(^PSRX(RXN,3),"^")=$P(RX2,"^",2)
"RTN","PSOORNE2",22,0)
 S PSODRG=+$P(RX0,"^",6),PSODRUG0=^PSDRUG(PSODRG,0),INDT=$G(^("I"))
"RTN","PSOORNE2",23,0)
 ;PSO*7*238;SET PSODRUG ARRAY ; PSOY KILLED AT END OF SET^PSODRG
"RTN","PSOORNE2",24,0)
 K PSODRUG
"RTN","PSOORNE2",25,0)
 S PSOY=PSODRG,PSOY(0)=PSODRUG0 D SET^PSODRG
"RTN","PSOORNE2",26,0)
 I 'RXOR,$P(^PSDRUG(PSODRG,2),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG(PSODRG,2),"^"),RXOR=$P(^PSDRUG(PSODRG,2),"^")
"RTN","PSOORNE2",27,0)
 I $P($G(^PSDRUG(PSODRG,"CLOZ1")),"^")="PSOCLO1" D
"RTN","PSOORNE2",28,0)
 .S CLOZPAT=$O(^YSCL(603.01,"C",PSODFN,0)) Q:'CLOZPAT
"RTN","PSOORNE2",29,0)
 .;S CLOZPAT=$S($P(^YSCL(603.01,CLOZPAT,0),"^",3)="B":1,1:0)
"RTN","PSOORNE2",30,0)
 .S CLOZPAT=$P(^YSCL(603.01,CLOZPAT,0),"^",3)
"RTN","PSOORNE2",31,0)
 .S CLOZPAT=$S(CLOZPAT="M":2,CLOZPAT="B":1,1:0)
"RTN","PSOORNE2",32,0)
 I $D(^XUSEC("PSORPH",DUZ)) S RPH=1 D
"RTN","PSOORNE2",33,0)
 .S PSOACT=$S('ST&($G(INDT)]"")&(DT>$G(INDT)):"DHPLATC",ST=1:"DVE",ST=4:"DV",ST=3:"DU",ST=5:"ELTD",ST=11:"TDPCL",ST=12&EXDT:"DCL",ST=12&'EXDT:"CL",ST>12&(ST'=16):"L",ST=16:"DL",1:"DHPEATCL")
"RTN","PSOORNE2",34,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",35,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" K SURX Q
"RTN","PSOORNE2",36,0)
 .S:ST'=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="DL",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",37,0)
 .S:ST=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="L",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",38,0)
 .I ST=14!(ST=15) S VALMSG="Rx Discontinued By "_$S(ST=14:"Provider",1:"Edit")_". Cannot be Reinstated."
"RTN","PSOORNE2",39,0)
 .S:ST=16 VALMSG="Rx Placed on HOLD by Provider."
"RTN","PSOORNE2",40,0)
 E  D
"RTN","PSOORNE2",41,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" Q
"RTN","PSOORNE2",42,0)
 .S PSOACT=$S(ST'<1&(ST'>4)!(ST>12):"",ST=12&EXDT&($P($G(PSOPAR),"^",2)):"CDPLT",1:"CPLT")
"RTN","PSOORNE2",43,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",44,0)
 .S:'$D(^PS(50.7,+$P(RXOR,"^"),0)) PSOACT="L",PSONACT=1,VALMSG="No Pharmacy Orderable Item !"
"RTN","PSOORNE2",45,0)
 ;K PSOLKFL D PSOL^PSSLOCK(RXN) I '$G(PSOMSG) K PSOMSG S PSOLKFL=1 S PSOACT="",VALMSG="This Order is being edited by another user."
"RTN","PSOORNE2",46,0)
 K PSOMSG S IEN=0,$P(RN," ",12)=" "
"RTN","PSOORNE2",47,0)
 I $G(RPH),ST=1,$P($G(^PSRX(RXN,"PKI")),"^") N PKI,PKI1,PKIR,PKIE,DA S DA=RXN D CER^PSOPKIV1 K DA D:$G(PKI1) L1^PSOPKIV1
"RTN","PSOORNE2",48,0)
 D DIN^PSONFI(+RXOR,$P(RX0,"^",6))
"RTN","PSOORNE2",49,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=$S($P($G(^PSRX(RXN,"TPB")),"^"):"            TPB Rx #: ",1:"                Rx #: ")
"RTN","PSOORNE2",50,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_$P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN)_$E(RN,$L($P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN))+1,12)
"RTN","PSOORNE2",51,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):1,1:"#")_")"_" *Orderable Item: "_$S($D(^PS(50.7,$P(+RXOR,"^"),0)):$P(^PS(50.7,$P(+RXOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"")_NFIO
"RTN","PSOORNE2",52,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",53,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):2,1:"#")_")"_$S($D(^PSDRUG("AQ",$P(RX0,"^",6))):"       CMOP ",1:"            ")_"Drug: "_$P(^PSDRUG($P(RX0,"^",6),0),"^")_NFID
"RTN","PSOORNE2",54,0)
 S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",55,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="",$$RXRLDT^PSOBPSUT(RXN,0) D
"RTN","PSOORNE2",56,0)
 . S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" "_$S('$P(PSOPAR,"^",3):"(2)",1:"   ")_"             NDC: "_$$GETNDC^PSONDCUT(RXN,0)
"RTN","PSOORNE2",57,0)
 S:$G(^PSRX(RXN,"TN"))]"" IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="          Trade Name: "_$G(^PSRX(RXN,"TN"))
"RTN","PSOORNE2",58,0)
 D DOSE^PSOORNE5
"RTN","PSOORNE2",59,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (4)Pat Instructions:" D INS^PSOORNE5
"RTN","PSOORNE2",60,0)
 D PC^PSOORNE5
"RTN","PSOORNE2",61,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="                 SIG:"
"RTN","PSOORNE2",62,0)
 I '$P($G(^PSRX(RXN,"SIG")),"^",2) S SIGOK=0 D  G PTST
"RTN","PSOORNE2",63,0)
 .S X=$P($G(^PSRX(RXN,"SIG")),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOORNE2",64,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOAO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAO",$J,IEN,0)," ",21)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOAO",$J,IEN,0)=$G(^TMP("PSOAO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNE2",65,0)
 S SIGOK=1
"RTN","PSOORNE2",66,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  D                  ;PSO*210
"RTN","PSOORNE2",67,0)
 . S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^")
"RTN","PSOORNE2",68,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAO",$J)),21)
"RTN","PSOORNE2",69,0)
 S SIGOK=1 K MIG,SG
"RTN","PSOORNE2",70,0)
PTST S $P(RN," ",25)=" ",PTST=$S($G(^PS(53,+$P(RX0,"^",3),0))]"":$P($G(^PS(53,+$P(RX0,"^",3),0)),"^"),1:""),IEN=IEN+1
"RTN","PSOORNE2",71,0)
 S ^TMP("PSOAO",$J,IEN,0)=" (5)  Patient Status: "_PTST_$E(RN,$L(PTST)+1,25)
"RTN","PSOORNE2",72,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (6)      Issue Date: "_$E($P(RX0,"^",13),4,5)_"/"_$E($P(RX0,"^",13),6,7)_"/"_$E($P(RX0,"^",13),2,3)
"RTN","PSOORNE2",73,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (7)  Fill Date: "_$E($P(RX2,"^",2),4,5)_"/"_$E($P(RX2,"^",2),6,7)_"/"_$E($P(RX2,"^",2),2,3)
"RTN","PSOORNE2",74,0)
 S ROU=$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSOORNE2",75,0)
 S REFL=$P(RX0,"^",9),I=0 F  S I=$O(^PSRX(RXN,1,I)) Q:'I  S REFL=REFL-1,ROU=$S($P(^PSRX(RXN,1,I,0),"^",2)="W":"Window",1:"Mail")
"RTN","PSOORNE2",76,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="      Last Fill Date: "_$E($P(RX3,"^"),4,5)_"/"_$E($P(RX3,"^"),6,7)_"/"_$E($P(RX3,"^"),2,3)
"RTN","PSOORNE2",77,0)
 D CMOP^PSOORNE3
"RTN","PSOORNE2",78,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_" ("_ROU_$S($G(PSOCMOP)]"":", "_PSOCMOP,1:"")_")" K ROU,PSOCMOP
"RTN","PSOORNE2",79,0)
 S IEN=IEN+1 I $P(RX2,"^",15) S ^TMP("PSOAO",$J,IEN,0)="   Returned to Stock: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3)_$S($P(RX2,"^",14):" (Reprinted)",1:"")
"RTN","PSOORNE2",80,0)
 E  S ^TMP("PSOAO",$J,IEN,0)="   Last Release Date: " D
"RTN","PSOORNE2",81,0)
 .S RLD=$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:"")
"RTN","PSOORNE2",82,0)
 .I $O(^PSRX(RXN,1,0)) F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  D
"RTN","PSOORNE2",83,0)
 ..I $P(^PSRX(RXN,1,I,0),"^",18) S RLD=$E($P(^(0),"^",18),4,5)_"/"_$E($P(^(0),"^",18),6,7)_"/"_$E($P(^(0),"^",18),2,3)
"RTN","PSOORNE2",84,0)
 .S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_$S($G(RLD)]"":RLD,1:"        ")
"RTN","PSOORNE2",85,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (8)      Lot #: "_$P($G(RX2),"^",4)
"RTN","PSOORNE2",86,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="             Expires: "_$E($P(RX2,"^",6),4,5)_"/"_$E($P(RX2,"^",6),6,7)_"/"_$E($P(RX2,"^",6),2,3)
"RTN","PSOORNE2",87,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                          MFG: "_$P($G(RX2),"^",8)
"RTN","PSOORNE2",88,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(9)      Days Supply: "_$P(RX0,"^",8)_$S($L($P(RX0,"^",8))=1:" ",1:"")
"RTN","PSOORNE2",89,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                    (10)  QTY"_$S($P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)]"":" ("_$P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)_")",1:" (  )")_": "_$P(RX0,"^",7)
"RTN","PSOORNE2",90,0)
 I $P($G(^PSDRUG($P(RX0,"^",6),5)),"^")]"" D
"RTN","PSOORNE2",91,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNE2",92,0)
 .S ^TMP("PSOAO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^") K RN
"RTN","PSOORNE2",93,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(11)    # of Refills: "_$P(RX0,"^",9)_$S($L($P(RX0,"^",9))=1:" ",1:"")_"                          Remaining: "_REFL
"RTN","PSOORNE2",94,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(12)        Provider: "_$S($D(^VA(200,$P(RX0,"^",4),0)):$P(^VA(200,$P(RX0,"^",4),0),"^"),1:"UNKNOWN")
"RTN","PSOORNE2",95,0)
 I $P(RX3,"^",3) S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,$S($G(PSORX("COSIGNING PROVIDER")):PSORX("COSIGNING PROVIDER"),1:$P(RX3,"^",3)),0),"^")
"RTN","PSOORNE2",96,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(13)         Routing: "_$S($P(RX0,"^",11)="M":"MAIL",1:"WINDOW")_"                  (14)     Copies: "_$S($P(RX0,"^",18):$P(RX0,"^",18),1:1)
"RTN","PSOORNE2",97,0)
 S:$P(RX0,"^",11)="W"&($P(PSOPAR,"^",12)) IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="    Method of Pickup: "_$G(^PSRX(RXN,"MP"))
"RTN","PSOORNE2",98,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(15)          Clinic: "_$S($D(^SC(+$P(RX0,"^",5),0)):$P(^SC($P(RX0,"^",5),0),"^"),1:"Not on File")
"RTN","PSOORNE2",99,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(16)        Division: "_$S($G(^PS(59,+$P(RX2,"^",9),0))]"":$P(^PS(59,$P(RX2,"^",9),0),"^")_" ("_$P(^(0),"^",6)_")",1:"UNKNOWN")
"RTN","PSOORNE2",100,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(17)      Pharmacist: "_$S($P(RX2,"^",3):$P(^VA(200,$P(RX2,"^",3),0),"^"),1:"")
"RTN","PSOORNE2",101,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(18)         Remarks:" D RMK^PSOORNE3
"RTN","PSOORNE2",102,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(19)      Counseling: "_$S($P($G(^PSRX(RXN,"PC")),"^"):"YES",1:"NO")_"                      "_$S($P($G(^PSRX(RXN,"PC")),"^"):"Was Counseling Understood: "_$S($P($G(^PSRX(RXN,"PC")),"^",2):"YES",1:"NO"),1:"")
"RTN","PSOORNE2",103,0)
 S:$O(^PSRX(RXN,1,0)) REF=1,IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(20)     Refill Data"
"RTN","PSOORNE2",104,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="" D
"RTN","PSOORNE2",105,0)
 . N DAW S IEN=IEN+1,DAW=$$GETDAW^PSODAWUT(RXN,0)
"RTN","PSOORNE2",106,0)
 . S ^TMP("PSOAO",$J,IEN,0)="(21)        DAW Code: "_DAW_" - "_$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSOORNE2",107,0)
 D DISP^PSOORNE6
"RTN","PSOORNE2",108,0)
 I $G(PSOBEDT),PSOACT["E" S PSOACT="E"
"RTN","PSOORNE2",109,0)
 I $G(PSOBEDT),PSOACT'["E" S PSOACT=""
"RTN","PSOORNE2",110,0)
 Q:$G(PSORXED)!($G(COPY))!($G(UPMI))  S:$G(PSOBEDT) (PSOEDIT,PSORXED)=1 D ^PSOLMLST ; I '$G(PSOLKFL) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOORNE2",111,0)
 K DRET,SIG
"RTN","PSOORNE2",112,0)
 Q
"RTN","PSOORNE2",113,0)
UL1 ;
"RTN","PSOORNE2",114,0)
 ;I +PSOLST(ORN)=52 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOORNE2",115,0)
 ;I $D(^PS(52.41,$P(PSOLST(ORN),"^",2),0)) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)_"S")
"RTN","PSOORNE2",116,0)
 Q
"RTN","PSOORUT2")
0^7^B65711274^B61773265
"RTN","PSOORUT2",1,0)
PSOORUT2 ;ISC BHAM/SAB - build listman screen ; 3/20/07 9:47am
"RTN","PSOORUT2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,146,132,182,233,243,261,268,264**;DEC 1997;Build 19
"RTN","PSOORUT2",3,0)
 ;External reference to SDPHARM1 supported by DBIA 4196
"RTN","PSOORUT2",4,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOORUT2",5,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSOORUT2",6,0)
 ;External reference ^DPT(D0,.372 supported by DBIA 1476
"RTN","PSOORUT2",7,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSOORUT2",8,0)
 ;External references to ^XTMP("ORRDI" supported by DBIA 4660
"RTN","PSOORUT2",9,0)
 ;
"RTN","PSOORUT2",10,0)
 K ^TMP("PSOHDR",$J),^TMP("PSOPI",$J) S DFN=PSODFN D ^VADPT,ADD^VADPT
"RTN","PSOORUT2",11,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1),^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSOORUT2",12,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSOORUT2",13,0)
 D NVA
"RTN","PSOORUT2",14,0)
 S POERR=1 D RE^PSODEM K POERR
"RTN","PSOORUT2",15,0)
 S ^TMP("PSOHDR",$J,6,0)=$S($P(WT,"^",8):$P(WT,"^",9)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSOORUT2",16,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$P(HT,"^",9)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSOORUT2",17,0)
 S GMRA="0^0^111" D ^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSOORUT2",18,0)
 S $P(^TMP("PSOHDR",$J,9,0)," ",62)="ISSUE  LAST REF DAY"
"RTN","PSOORUT2",19,0)
 S ^TMP("PSOHDR",$J,10,0)=" #  RX #         DRUG                                 QTY ST  DATE  FILL REM SUP"
"RTN","PSOORUT2",20,0)
 D ELIG^VADPT S IEN=1,^TMP("PSOPI",$J,IEN,0)="Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:""),IEN=IEN+1
"RTN","PSOORUT2",21,0)
 S N=0 F  S N=$O(VAEL(1,N)) Q:'N  S $P(^TMP("PSOPI",$J,IEN,0)," ",14)=$P(VAEL(1,N),"^",2),IEN=IEN+1
"RTN","PSOORUT2",22,0)
 S ^TMP("PSOPI",$J,IEN,0)="",^TMP("PSOPI",$J,IEN,0)="RX PATIENT STATUS: "_$$GET1^DIQ(55,PSODFN,3),IEN=IEN+1
"RTN","PSOORUT2",23,0)
 S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Disabilities: "
"RTN","PSOORUT2",24,0)
 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSOORUT2",25,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSOORUT2",26,0)
 .S:$L(^TMP("PSOPI",$J,IEN,0)_PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 IEN=IEN+1,$P(^TMP("PSOPI",$J,IEN,0)," ",14)=" "
"RTN","PSOORUT2",27,0)
 .S ^TMP("PSOPI",$J,IEN,0)=$G(^TMP("PSOPI",$J,IEN,0))_PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSOORUT2",28,0)
 S IEN=IEN+1 S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1
"RTN","PSOORUT2",29,0)
 I +VAPA(9) S ^TMP("PSOPI",$J,IEN,0)="      (Temp Address from "_$P(VAPA(9),"^",2)_" till "_$S($P(VAPA(10),"^",2)]"":$P(VAPA(10),"^",2),1:"(no end date)")_")",IEN=IEN+1
"RTN","PSOORUT2",30,0)
 S ^TMP("PSOPI",$J,IEN,0)=VAPA(1) S:VAPA(2)]"" IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(2) S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(3)
"RTN","PSOORUT2",31,0)
 S ^TMP("PSOPI",$J,IEN,0)=^TMP("PSOPI",$J,IEN,0)_$J("",50-$L(VAPA(3)))_"HOME PHONE: "_VAPA(8)
"RTN","PSOORUT2",32,0)
 S PSOTEL=$G(^DPT(DFN,.13))
"RTN","PSOORUT2",33,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=VAPA(4),^TMP("PSOPI",$J,IEN,0)=^TMP("PSOPI",$J,IEN,0)_$J("",50-$L(VAPA(4)))_"CELL PHONE: "_$P(PSOTEL,"^",4)
"RTN","PSOORUT2",34,0)
 S PSOTMP=$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=PSOTMP
"RTN","PSOORUT2",35,0)
 S ^TMP("PSOPI",$J,IEN,0)=^TMP("PSOPI",$J,IEN,0)_$J("",50-$L(PSOTMP))_"WORK PHONE: "_$P(PSOTEL,"^",2)
"RTN","PSOORUT2",36,0)
 S MAILD=+$P($G(^PS(55,DFN,0)),"^",3) D  K MAILD
"RTN","PSOORUT2",37,0)
 .S PSOTMP="Prescription Mail Delivery: "_$S(MAILD=1:"Certified Mail",MAILD=2:"DO NOT MAIL",MAILD=3:"Local - Regular Mail",MAILD=4:"Local - Certified Mail",1:"Regular Mail") S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=PSOTMP
"RTN","PSOORUT2",38,0)
 .I MAILD<2!(MAILD>4) Q  ;ONLY FOR MAIL DELIVERIES 2,3,4
"RTN","PSOORUT2",39,0)
 .N PSOMDEXP,Y
"RTN","PSOORUT2",40,0)
 .S Y=$P($G(^PS(55,DFN,0)),"^",5)
"RTN","PSOORUT2",41,0)
 .I Y,Y'>DT D
"RTN","PSOORUT2",42,0)
 ..D DD^%DT S PSOMDEXP=Y
"RTN","PSOORUT2",43,0)
 ..S ^TMP("PSOPI",$J,IEN,0)=^TMP("PSOPI",$J,IEN,0)_" Expire Date: "_PSOMDEXP
"RTN","PSOORUT2",44,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=$S($P($G(^PS(55,DFN,0)),"^",2):"Cannot use safety caps.",1:"") S $P(^TMP("PSOPI",$J,IEN,0)," ",40)=$S($P($G(^PS(55,DFN,0)),"^",4):"Dialysis Patient.",1:"")
"RTN","PSOORUT2",45,0)
 I $G(^PS(55,DFN,1))]"" S PSON=^(1),IEN=IEN+1 D
"RTN","PSOORUT2",46,0)
 .S ^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="     Outpatient Narrative: "
"RTN","PSOORUT2",47,0)
 .F I=1:1 Q:$P(PSON," ",I,99)=""  S:$L(^TMP("PSOPI",$J,IEN,0)_$P(PSON," ",I)_" ")>80 IEN=IEN+1 S ^TMP("PSOPI",$J,IEN,0)=$G(^TMP("PSOPI",$J,IEN,0))_$P(PSON," ",I)_" "
"RTN","PSOORUT2",48,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",49,0)
 I $D(^PS(52.91,DFN,0)) I '$P(^(0),"^",3)!($P(^(0),"^",3)>DT) D
"RTN","PSOORUT2",50,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Primary Care Appointment: "_$$PRIAPT^SDPHARM1(DFN)
"RTN","PSOORUT2",51,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",52,0)
 I 'GMRAL D
"RTN","PSOORUT2",53,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Allergies: "_$S(GMRAL=0:"NKA",1:"")
"RTN","PSOORUT2",54,0)
 .I GMRAL'=0 S PSONOAL="" D ALLERGY I PSONOAL'="" S ^TMP("PSOPI",$J,IEN,0)="Allergies: "_PSONOAL K PSONOAL
"RTN","PSOORUT2",55,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" "
"RTN","PSOORUT2",56,0)
 .D REMOTE
"RTN","PSOORUT2",57,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Adverse Reactions:"
"RTN","PSOORUT2",58,0)
 D:$G(GMRAL) ^PSOORUT3
"RTN","PSOORUT2",59,0)
 K ^UTILITY("VASD",$J),VASD S DFN=PSODFN,VASD("F")=DT,VASD("T")=9999999,VASD("W")="123456789" D SDA^VADPT K VASD I $D(^UTILITY("VASD",$J)) D
"RTN","PSOORUT2",60,0)
 .S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="Pending Clinic Appointments:"
"RTN","PSOORUT2",61,0)
 .F PSOAPP=0:0 S PSOAPP=$O(^UTILITY("VASD",$J,PSOAPP)) Q:'PSOAPP  S PSOAPPE=$G(^UTILITY("VASD",$J,PSOAPP,"E")),PSOAPPI=$G(^("I")) D
"RTN","PSOORUT2",62,0)
 ..K X S X2=DT,X1=$P($P($G(PSOAPPI),"^"),".") I $G(X1) D ^%DTC
"RTN","PSOORUT2",63,0)
 ..S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="    "_$P(PSOAPPE,"^")_"  "_$P(PSOAPPE,"^",2)_$S($P(PSOAPPI,"^",3)["C":"   *** Canceled ***",1:" ("_$G(X)_" days)")
"RTN","PSOORUT2",64,0)
 K ^UTILITY("VASD",$J),X,PSOAPPI,PSOAPPE,PSOAPP,N
"RTN","PSOORUT2",65,0)
 S PSOPI=IEN K IEN
"RTN","PSOORUT2",66,0)
 Q
"RTN","PSOORUT2",67,0)
NVA ;
"RTN","PSOORUT2",68,0)
 Q:'$O(^PS(55,PSODFN,"NVA",0))
"RTN","PSOORUT2",69,0)
 K LSTDT F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",I)) Q:'I  D
"RTN","PSOORUT2",70,0)
 .Q:$P(^PS(55,PSODFN,"NVA",I,0),"^",7)  Q:'$P(^PS(55,PSODFN,"NVA",I,0),"^")
"RTN","PSOORUT2",71,0)
 .I $P(^PS(55,PSODFN,"NVA",I,0),"^",10)>+$G(LSTDT) S LSTDT=$P(^(0),"^",10)
"RTN","PSOORUT2",72,0)
 I $G(LSTDT)]"" D
"RTN","PSOORUT2",73,0)
 .S LSTDT="Non-VA Meds on File - Last entry on "_$E(LSTDT,4,5)_"/"_$E(LSTDT,6,7)_"/"_$E(LSTDT,2,3)
"RTN","PSOORUT2",74,0)
 .I $G(^TMP("PSOHDR",$J,5,0))="MALE" S $P(^TMP("PSOHDR",$J,5,0)," ",22)=LSTDT K LSTDT Q
"RTN","PSOORUT2",75,0)
 .S $P(^TMP("PSOHDR",$J,5,0)," ",20)=LSTDT K LSTDT
"RTN","PSOORUT2",76,0)
 K I
"RTN","PSOORUT2",77,0)
 Q
"RTN","PSOORUT2",78,0)
REMOTE ;
"RTN","PSOORUT2",79,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSOORUT2",80,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSOORUT2",81,0)
 N PSORALG,REAC,S1,A,FILE,LEN,I
"RTN","PSOORUT2",82,0)
 K ^TMP($J,"PSOART")
"RTN","PSOORUT2",83,0)
 S PSORALG=1,PSORALG(1)="No remote data available"
"RTN","PSOORUT2",84,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) G REMOTE2
"RTN","PSOORUT2",85,0)
 I $T(GET^ORRDI1)]"" S PSOSIEN=$G(IEN) D GET^ORRDI1(DFN,"ART") S IEN=PSOSIEN K PSOSIEN D
"RTN","PSOORUT2",86,0)
 .I $P($G(^XTMP("ORRDI","ART",DFN,0)),"^",3)=0 S PSORALG(1)="No remote allergies"
"RTN","PSOORUT2",87,0)
 .S S1=0,LEN=65,PSORALG=1,PSORALG(1)="" F  S S1=$O(^XTMP("ORRDI","ART",DFN,S1)) Q:'S1  D
"RTN","PSOORUT2",88,0)
 ..S A=$G(^XTMP("ORRDI","ART",DFN,S1,"REACTANT",0)),REAC=$P(A,"^",2),FILE=$P($P(A,"^",3),"99VA",2)
"RTN","PSOORUT2",89,0)
 ..I FILE'=50.6,FILE'=120.82,FILE'=50.605,FILE'=50.416 Q
"RTN","PSOORUT2",90,0)
 ..S ^TMP($J,"PSOART",REAC)=""
"RTN","PSOORUT2",91,0)
 .S REAC="" F  S REAC=$O(^TMP($J,"PSOART",REAC)) Q:REAC=""  D
"RTN","PSOORUT2",92,0)
 ..I $L(PSORALG(PSORALG))+$L(REAC)<LEN S PSORALG(PSORALG)=PSORALG(PSORALG)_REAC_", " Q
"RTN","PSOORUT2",93,0)
 ..S PSORALG=PSORALG+1,PSORALG(PSORALG)="              "_REAC_", ",LEN=76
"RTN","PSOORUT2",94,0)
 .I PSORALG(PSORALG)]"",$E(PSORALG(PSORALG),$L(PSORALG(PSORALG)))="," S PSORALG(PSORALG)=$E(PSORALG(PSORALG),1,$L(PSORALG(PSORALG))-1)
"RTN","PSOORUT2",95,0)
REMOTE2 ;
"RTN","PSOORUT2",96,0)
 S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)="      Remote: "_$G(PSORALG(1)) D
"RTN","PSOORUT2",97,0)
 .F I=2:1:PSORALG S IEN=IEN+1,^TMP("PSOPI",$J,IEN,0)=PSORALG(I)
"RTN","PSOORUT2",98,0)
 K ^TMP($J,"PSOART")
"RTN","PSOORUT2",99,0)
 Q
"RTN","PSOORUT2",100,0)
  ;
"RTN","PSOORUT2",101,0)
ALLERGY ;ALLERGIES & REACTIONS
"RTN","PSOORUT2",102,0)
 N GMRA,GMRAL,PSORY,ALCNT,EEE,PSOLG,PSOLGA,TEXT,CCC,CCC2
"RTN","PSOORUT2",103,0)
 K ^TMP($J,"PSOALWA")
"RTN","PSOORUT2",104,0)
 I '$D(DFN) S DFN=PSODFN
"RTN","PSOORUT2",105,0)
 S GMRA="0^0^111" D ^GMRADPT
"RTN","PSOORUT2",106,0)
 I $G(GMRAL) S PSORY=0 F  S PSORY=$O(GMRAL(PSORY)) Q:'PSORY  S ^TMP($J,"PSOALWA",$S($P(GMRAL(PSORY),"^",4):1,1:2),$S('$P(GMRAL(PSORY),"^",5):1,1:2),$P(GMRAL(PSORY),"^",7),$P(GMRAL(PSORY),"^",2))=""
"RTN","PSOORUT2",107,0)
 S ^TMP($J,"PSOAPT",1)=$G(PNM)_"  "_$G(SSNP),^(2)="Verified Allergies"
"RTN","PSOORUT2",108,0)
 S ALCNT=0,EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)=PSOLGA
"RTN","PSOORUT2",109,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)="NKA"
"RTN","PSOORUT2",110,0)
 S ALCNT=0,^TMP($J,"PSOAPT",3)="Non-Verified Allergies"
"RTN","PSOORUT2",111,0)
 S EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=EEE+1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)=PSOLGA
"RTN","PSOORUT2",112,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)="NKA"
"RTN","PSOORUT2",113,0)
 S ALCNT=0,^TMP($J,"PSOAPT",4)="Verified Adverse Reactions"
"RTN","PSOORUT2",114,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",4,ALCNT)=PSOLGA
"RTN","PSOORUT2",115,0)
 S ALCNT=0,^TMP($J,"PSOAPT",5)="Non-Verified Adverse Reactions"
"RTN","PSOORUT2",116,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",5,ALCNT)=PSOLGA
"RTN","PSOORUT2",117,0)
 S TEXT=^TMP($J,"PSOAPT",1) D CHKNO(TEXT)
"RTN","PSOORUT2",118,0)
 F CCC=3,4,5 I '$O(^TMP($J,"PSOAPT",CCC,0)) K ^TMP($J,"PSOAPT",CCC)
"RTN","PSOORUT2",119,0)
 D PSONOAL
"RTN","PSOORUT2",120,0)
 I CCC="NKA" S ^TMP($J,"PSOAPT",2,1)="No Known Allergies" K ^TMP($J,"PSOAPT",3)
"RTN","PSOORUT2",121,0)
 S CCC=1,OUT=0
"RTN","PSOORUT2",122,0)
 F  S CCC=$O(^TMP($J,"PSOAPT",CCC)) Q:CCC=""  D  Q:OUT
"RTN","PSOORUT2",123,0)
 .S TEXT=$G(^TMP($J,"PSOAPT",CCC))
"RTN","PSOORUT2",124,0)
 .I TEXT="No Allergy Assessment" S PSONOAL=TEXT Q
"RTN","PSOORUT2",125,0)
 .S (TEXT,CCC2)="",LENGTH=0
"RTN","PSOORUT2",126,0)
 .F  S CCC2=$O(^TMP($J,"PSOAPT",CCC,CCC2)) Q:CCC2=""  S TEXT=^(CCC2) D CHKNO(TEXT)
"RTN","PSOORUT2",127,0)
 K ^TMP($J,"PSOALWA"),^TMP($J,"PSOAPT")
"RTN","PSOORUT2",128,0)
 Q
"RTN","PSOORUT2",129,0)
CHKNO(T) ;
"RTN","PSOORUT2",130,0)
 I T="No Allergy Assessment" S PSONOAL=T
"RTN","PSOORUT2",131,0)
 Q
"RTN","PSOORUT2",132,0)
PSONOAL   ;
"RTN","PSOORUT2",133,0)
 N FLG3,FLG4,FLG5
"RTN","PSOORUT2",134,0)
 S CCC=$G(^TMP($J,"PSOAPT",2,1))
"RTN","PSOORUT2",135,0)
 S FLG3=$G(^TMP($J,"PSOAPT",3,1))
"RTN","PSOORUT2",136,0)
 S FLG4=$G(^TMP($J,"PSOAPT",4,1))
"RTN","PSOORUT2",137,0)
 S FLG5=$G(^TMP($J,"PSOAPT",5,1))
"RTN","PSOORUT2",138,0)
 I CCC="",FLG3="",FLG4="",FLG5="" S ^TMP($J,"PSOAPT",2,1)="No Allergy Assessment" K ^TMP($J,"PSOAPT",3)
"RTN","PSOORUT2",139,0)
 Q
"RTN","PSOPRA")
0^18^B12269576^B11988419
"RTN","PSOPRA",1,0)
PSOPRA ;BIR/JLC/MHA - INTERNET PRESCRIPTION REFILL APIS ; 4/14/05 4:51pm
"RTN","PSOPRA",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**116,151,204,264**;DEC 1997;Build 19
"RTN","PSOPRA",3,0)
 ;
"RTN","PSOPRA",4,0)
 Q
"RTN","PSOPRA",5,0)
AP1(PSODFN,PSORX) ;ACCEPT REQUEST
"RTN","PSOPRA",6,0)
 ; Input:  PSODFN (required) - Patient IEN Number
"RTN","PSOPRA",7,0)
 ;         PSORX  (required) - Prescription Number
"RTN","PSOPRA",8,0)
 ; Output: PSORET - Return Value
"RTN","PSOPRA",9,0)
 ;         See IA# 3768 for description and values
"RTN","PSOPRA",10,0)
 ;
"RTN","PSOPRA",11,0)
 N PSORET,PSRX,PSRXD,IEN,PSORR,PSOICN,SITE,PSOSITE
"RTN","PSOPRA",12,0)
 I $G(PSODFN)="" S PSORET=-4 G QUITAP1
"RTN","PSOPRA",13,0)
 S PSOICN=+$$GETICN^MPIF001(PSODFN)
"RTN","PSOPRA",14,0)
 I +$G(PSOICN)=-1 S PSORET=-4 G QUITAP1
"RTN","PSOPRA",15,0)
 I $G(PSORX)="" S PSORET=-3 G QUITAP1
"RTN","PSOPRA",16,0)
 I $O(^PSRX("B",PSORX,""))="" S PSORET=-3 G QUITAP1
"RTN","PSOPRA",17,0)
 I '$D(^PSRX("B",PSORX)) S PSORET=-3 G QUITAP1
"RTN","PSOPRA",18,0)
 S PSRX=$O(^PSRX("B",PSORX,"")),PSRXD=$G(^PSRX(PSRX,0))
"RTN","PSOPRA",19,0)
 I PSRXD="" S PSORET=-3 G QUITAP1
"RTN","PSOPRA",20,0)
 I $P(PSRXD,"^",2)'=PSODFN S PSORET=-5 G QUITAP1
"RTN","PSOPRA",21,0)
 S (SITE,DA)=$P(^XMB(1,1,"XUS"),"^",17),DIC="4",DIQ(0)="IE",DR=".01;99",DIQ="PSXUTIL" D EN^DIQ1 S PSOSITE=$G(PSXUTIL(4,SITE,99,"I"))
"RTN","PSOPRA",22,0)
 I '$D(^PS(52.43,"AC",PSODFN,PSORX)) G FILEAP1
"RTN","PSOPRA",23,0)
 S IEN=$O(^PS(52.43,"AC",PSODFN,PSORX,""))
"RTN","PSOPRA",24,0)
 I '$D(^PS(52.43,IEN,0)) G FILEAP1
"RTN","PSOPRA",25,0)
 S PSORR=$G(^PS(52.43,IEN,0))
"RTN","PSOPRA",26,0)
 I $P(PSORR,"^",5)="" S PSORET=-2 G QUITAP1
"RTN","PSOPRA",27,0)
 S PSORET=-1 G QUITAP1
"RTN","PSOPRA",28,0)
FILEAP1 K DO,DIC,DD S DIC(0)="L",DIC=52.43,X=PSOICN D FILE^DICN I Y=-1 S PSORET=0 G QUITAP1
"RTN","PSOPRA",29,0)
 N % D NOW^%DTC
"RTN","PSOPRA",30,0)
 K DA,DR,DIE S DA=+Y,DIE=DIC,DR="3///"_PSORX_";7///0;8///"_PSRX_";4///"_PSOSITE_";9////"_PSODFN_";11///"_$E(%,1,12) D ^DIE
"RTN","PSOPRA",31,0)
 S PSORET=1
"RTN","PSOPRA",32,0)
QUITAP1 Q PSORET
"RTN","PSOPRA",33,0)
 ;
"RTN","PSOPRA",34,0)
AP2(PSODFN,PSORX) ;STATUS OF REQUEST
"RTN","PSOPRA",35,0)
 ; Input:  PSODFN (required) - Patient IEN Number
"RTN","PSOPRA",36,0)
 ;         PSORX  (required) - Prescription Number
"RTN","PSOPRA",37,0)
 ; Output: PSORET - Return Value
"RTN","PSOPRA",38,0)
 ;         See IA ... for description and values
"RTN","PSOPRA",39,0)
 ;
"RTN","PSOPRA",40,0)
 N PSORET,PSORR,IEN
"RTN","PSOPRA",41,0)
 I $G(PSODFN)="" S PSORET=-4 G QUITAP2
"RTN","PSOPRA",42,0)
 I $G(PSORX)="" S PSORET=-3 G QUITAP2
"RTN","PSOPRA",43,0)
 I '$D(^PS(52.43,"AC",PSODFN,PSORX)) S PSORET=-6 G QUITAP2
"RTN","PSOPRA",44,0)
 S IEN=$O(^PS(52.43,"AC",PSODFN,PSORX,""))
"RTN","PSOPRA",45,0)
 I '$D(^PS(52.43,IEN,0)) K ^PS(52.43,"AC",PSODFN,PSORX) S PSORET=-6 G QUITAP2
"RTN","PSOPRA",46,0)
 S PSORR=$G(^PS(52.43,IEN,0))
"RTN","PSOPRA",47,0)
 I $P(PSORR,"^",5)="" S PSORET=-2 G QUITAP2
"RTN","PSOPRA",48,0)
 S PSORET=$P(PSORR,"^",6)_"^"_$P(PSORR,"^",5)
"RTN","PSOPRA",49,0)
QUITAP2 Q PSORET
"RTN","PSOPRA",50,0)
 ;
"RTN","PSOPRA",51,0)
AP5(PSODFN,PSORX) ;PROCESS MHEV UPDATE
"RTN","PSOPRA",52,0)
 ; Input:  PSODFN (required) - Patient IEN Number
"RTN","PSOPRA",53,0)
 ;         PSORX  (required) - Prescription Number
"RTN","PSOPRA",54,0)
 ; Output: PSORET - Return Value
"RTN","PSOPRA",55,0)
 ;         See IA ... for description and values
"RTN","PSOPRA",56,0)
 ;
"RTN","PSOPRA",57,0)
 N PSORET,PSORR,IEN,PSOIN
"RTN","PSOPRA",58,0)
 I $G(PSODFN)="" S PSORET=-4 G ENDAP5
"RTN","PSOPRA",59,0)
 I $G(PSORX)="" S PSORET=-3 G ENDAP5
"RTN","PSOPRA",60,0)
 I '$D(^PS(52.43,"AC",PSODFN,PSORX)) S PSORET=-6 G ENDAP5
"RTN","PSOPRA",61,0)
 S IEN=$O(^PS(52.43,"AC",PSODFN,PSORX,""))
"RTN","PSOPRA",62,0)
 I '$D(^PS(52.43,IEN,0)) K ^PS(52.43,"AC",PSODFN,PSORX) S PSORET=-6 G ENDAP5
"RTN","PSOPRA",63,0)
 S PSORR=$G(^PS(52.43,IEN,0))
"RTN","PSOPRA",64,0)
 I $P(PSORR,"^",5)="" S PSORET=-2 G ENDAP5
"RTN","PSOPRA",65,0)
 S PSOIN=$P(PSORR,"^",4)
"RTN","PSOPRA",66,0)
 K DA,DR,DIE
"RTN","PSOPRA",67,0)
 S DA=IEN
"RTN","PSOPRA",68,0)
 S DIE="^PS(52.43,",DR="7///1" D ^DIE S PSORET=1
"RTN","PSOPRA",69,0)
 K ^PS(52.43,"AC",PSODFN,PSORX)
"RTN","PSOPRA",70,0)
ENDAP5 Q PSORET
"RTN","PSOPRA",71,0)
 ;
"RTN","PSOPRA",72,0)
AP6(PSODIEN,PSOAP6) ;OUTPATIENT PHARMACY DIVISION LOOKUP
"RTN","PSOPRA",73,0)
 ; Input:  PSODIEN  (required) - Outpatient Pharmacy Division IEN.
"RTN","PSOPRA",74,0)
 ;                  1. Single Division IEN.
"RTN","PSOPRA",75,0)
 ;                  2. Delimited list of Division IEN's (IEN1,IEN2,IEN3).
"RTN","PSOPRA",76,0)
 ;                  3. Text word "ALL".
"RTN","PSOPRA",77,0)
 ;         PSOAP6   (required) - Information return Array.
"RTN","PSOPRA",78,0)
 ; Output: PSOAP6 - Information return Array.
"RTN","PSOPRA",79,0)
 ;                  PSOAP6(DIV)=Active(0)/Inactive(1)
"RTN","PSOPRA",80,0)
 ;                  PSOAP6(DIV,1)=Division Name^Area Code^Phone Number
"RTN","PSOPRA",81,0)
 ;                  PSOAP6(DIV,2,1)=Narrative text 1st line.
"RTN","PSOPRA",82,0)
 ;                  PSOAP6(DIV,2,n)=Narrative text nth line.
"RTN","PSOPRA",83,0)
 ;         PSORET - 0 (Process failure).
"RTN","PSOPRA",84,0)
 ;                  1 (Process success).
"RTN","PSOPRA",85,0)
 ;
"RTN","PSOPRA",86,0)
 N DIEN,TEMP,NAME,AREACODE,PHONENUM,INACTIVE
"RTN","PSOPRA",87,0)
 Q:$G(PSODIEN)="" 0
"RTN","PSOPRA",88,0)
 I PSODIEN="ALL" S ZS2=$O(^PS(59,0)),PSODIEN=ZS2 Q:'+ZS2 0 F  S ZS2=$O(^PS(59,ZS2)) Q:'+ZS2  S PSODIEN=PSODIEN_","_ZS2
"RTN","PSOPRA",89,0)
 F XX=1:1:$L(PSODIEN,",") S DIEN=$P(PSODIEN,",",XX) D
"RTN","PSOPRA",90,0)
 .S NAME=$$GET1^DIQ(59,DIEN,".01")
"RTN","PSOPRA",91,0)
 .Q:NAME=""
"RTN","PSOPRA",92,0)
 .S AREACODE=$$GET1^DIQ(59,DIEN,".03")
"RTN","PSOPRA",93,0)
 .S PHONENUM=$$GET1^DIQ(59,DIEN,".04")
"RTN","PSOPRA",94,0)
 .S INACTIVE=$$GET1^DIQ(59,DIEN,2004,"I")
"RTN","PSOPRA",95,0)
 .S PSOAP6(DIEN)=0 I INACTIVE S PSOAP6(DIEN)=1
"RTN","PSOPRA",96,0)
 .S PSOAP6(DIEN,1)=NAME_"^"_AREACODE_"^"_PHONENUM
"RTN","PSOPRA",97,0)
 .S TEMP=$$GET1^DIQ(59,DIEN,1005,"","PSOAP6("_DIEN_",2)")
"RTN","PSOPRA",98,0)
 ;
"RTN","PSOPRA",99,0)
ENDAP6 Q 1
"RTN","PSOPRI")
0^9^B24224309^B22700966
"RTN","PSOPRI",1,0)
PSOPRI ;BIR/JLC - INTERNET PRESCRIPTION REFILL PROCESSOR ;3/27/06 2:23pm
"RTN","PSOPRI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**116,204,242,264**;DEC 1997;Build 19
"RTN","PSOPRI",3,0)
 ;
"RTN","PSOPRI",4,0)
 ;Reference to ^PPPPDA1 supported by DBIA 1374
"RTN","PSOPRI",5,0)
 ;Reference to ^PSSLOCK supported by DBIA 2789
"RTN","PSOPRI",6,0)
 ;Reference to DIC(19 supported by DBIA 2246
"RTN","PSOPRI",7,0)
 ;
"RTN","PSOPRI",8,0)
 ;PSO*242 do not init PSODFN, it should only be set by label print
"RTN","PSOPRI",9,0)
 ;
"RTN","PSOPRI",10,0)
START L +^XTMP("PSOATRF"):5 I '$T D  Q
"RTN","PSOPRI",11,0)
 .D BMES^XPDUTL("The scheduled job is currently running - Please try it later.")
"RTN","PSOPRI",12,0)
 .D MES^XPDUTL("")
"RTN","PSOPRI",13,0)
 L -^XTMP("PSOATRF") S PSOVEX=1
"RTN","PSOPRI",14,0)
 K PSOVEXI,PSOISITE,PSOVEXFL,PSONOF
"RTN","PSOPRI",15,0)
 S PSOVX=0 F  S PSOVX=$O(^PS(59,PSOVX)) Q:'PSOVX  I $P($G(^PS(59,PSOVX,"I")),"^"),DT>$P($G(^("I")),"^") S PSOVEXI(PSOVX)=""
"RTN","PSOPRI",16,0)
 I $O(PSOVEXI(0)) W !,"Looking for refill requests for inactive Outpatient divisions..." D
"RTN","PSOPRI",17,0)
 . S PSOVIN=0 F  S PSOVIN=$O(^PS(52.43,"AINST",PSOVIN)) Q:'PSOVIN  S PSOVXLP="" F  S PSOVXLP=$O(^PS(52.43,"AINST",PSOVIN,PSOVXLP)) Q:PSOVXLP=""  D
"RTN","PSOPRI",18,0)
 .. S PSOIEN=$O(^PS(52.43,"AINST",PSOVIN,PSOVXLP,""))
"RTN","PSOPRI",19,0)
 .. S PSOISITE=$P($G(^PSRX(PSOVXLP,2)),"^",9) Q:$G(PSOVEXI(+$G(PSOISITE)))
"RTN","PSOPRI",20,0)
 .. I PSOISITE,$D(PSOVEXI(PSOISITE)),$P($G(^PS(52.43,PSOIEN,0)),"^",5)="" S PSOVEXI(PSOISITE)=1,PSOVEXFL=1
"RTN","PSOPRI",21,0)
 . I '$G(PSOVEXFL) W ".none found.",!
"RTN","PSOPRI",22,0)
 I $G(PSOVEXFL) W !!,"The following Inactive Outpatient sites have refill requests:",! D  I Y'=1 G END
"RTN","PSOPRI",23,0)
 . S PSOVX=0 F  S PSOVX=$O(PSOVEXI(PSOVX)) Q:'PSOVX  I $G(PSOVEXI(PSOVX)) W !?5,$P($G(^PS(59,+$G(PSOVX),0)),"^")
"RTN","PSOPRI",24,0)
 . K DIR W ! S DIR(0)="E",DIR("A")="Press Return to Continue, '^' to exit" D ^DIR W ! I Y'=1 Q
"RTN","PSOPRI",25,0)
 D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) END
"RTN","PSOPRI",26,0)
 W !!!?20,"Division: "_$P(^PS(59,PSOSITE,0),"^"),!!
"RTN","PSOPRI",27,0)
 S PSOBBC1("FROM")="REFILL",PSOBBC("QFLG")=0,PSOBBC("DFLG")=0
"RTN","PSOPRI",28,0)
 I '$D(^PS(52.43,"AINST",PSOINST)) S PSOANS="N" W !!?7,$C(7),"There are no internet refills to process." G END
"RTN","PSOPRI",29,0)
 D ASK^PSOBBC W:PSOBBC("QFLG")=1 !?7,$C(7),"No internet refills were processed." G:PSOBBC("QFLG")=1 END
"RTN","PSOPRI",30,0)
IPR W ! S DIR("B")="YES",DIR("A")="Process internet refill requests at this time",DIR(0)="Y" D ^DIR K DIR S PSOANS="N" I $G(DIRUT) S PSOPTRX="" G END
"RTN","PSOPRI",31,0)
 G:Y=0 END S PSOPTRX="" I Y=1 S PSOANS="Y"
"RTN","PSOPRI",32,0)
 I PSOANS["Y" S DIR("B")="NO",DIR("A")="Process internet refills for all divisions",DIR(0)="Y" D ^DIR K DIR S PSOANS2="S" S:Y=1 PSOANS2="M" I $G(DIRUT) S PSOANS="N" G END
"RTN","PSOPRI",33,0)
IPR6 I PSOANS["Y",$G(PSOPTRX),'$G(PSOMHV) D IPR5 ;MARK PROCESSED NODES
"RTN","PSOPRI",34,0)
 D IPR3 I $G(PSOANS)="N" D ULK G END
"RTN","PSOPRI",35,0)
 ;I $P(X,"-")'=PSOINST W !?7,$C(7),$C(7),$C(7),"Not from this institution.",! D ULK G IPR6
"RTN","PSOPRI",36,0)
 S (PSOBBC("IRXN"),PSOBBC("OIRXN"))=$P(X,"-",2)
"RTN","PSOPRI",37,0)
 I $G(^PSRX(PSOBBC("IRXN"),0))']"" W !,$C(7),"Rx data is not on file!",! D ULK G IPR6
"RTN","PSOPRI",38,0)
 I $P($G(^PSRX(PSOBBC("IRXN"),"STA")),"^")=13 W !,$C(7),"Rx has already been deleted." D ULK G IPR6
"RTN","PSOPRI",39,0)
 I $G(PSOBBC("DONE"))[PSOBBC("IRXN")_"," W !,$C(7),"Rx has already been entered." D ULK G IPR6
"RTN","PSOPRI",40,0)
 K X,Y D:PSOBBC("QFLG") PROCESSX^PSOBBC
"RTN","PSOPRI",41,0)
 S PSOSELSE=0 I $G(PSODFN)'=$P(^PSRX(PSOBBC("IRXN"),0),"^",2) S PSOSELSE=1 D PT^PSOBBC I $G(PSOBBC("DFLG")) K PSOSELSE D ULK G IPR6
"RTN","PSOPRI",42,0)
 I '$G(PSOSELSE) D PTC^PSOBBC I $G(PSOBBC("DFLG")) K PSOSELSE D ULK G IPR6
"RTN","PSOPRI",43,0)
 K PSOSELSE D PROFILE^PSORX1 S X="PPPPDA1" X ^%ZOSF("TEST") I  S X=$$PDA^PPPPDA1(PSODFN) W !!
"RTN","PSOPRI",44,0)
 S PSOBBC("DONE")=PSOBBC("IRXN")_",",PSOMHV=0 D REFILL^PSOBBC D ULK G IPR6
"RTN","PSOPRI",45,0)
 Q
"RTN","PSOPRI",46,0)
IPR3 K PSOBBC("IRXN"),PSOXFLAG F  S PSOPTRX=$O(^PS(52.43,"AINST",PSOINST,PSOPTRX)) D  Q:PSOANS="N"!($G(PSOXFLAG))
"RTN","PSOPRI",47,0)
 .I PSOPTRX="" S PSOANS="N" Q
"RTN","PSOPRI",48,0)
 .S PSOIEN=$O(^PS(52.43,"AINST",PSOINST,PSOPTRX,""))
"RTN","PSOPRI",49,0)
 .I '$D(^PSRX(+PSOPTRX,0)),$P(^PS(52.43,PSOIEN,0),"^",5)="" S PSONOF=1 D IPR5 K PSONOF Q  ;SKIPS ERRONEOUS ENTRIES
"RTN","PSOPRI",50,0)
IPR4 .I PSOANS["Y" Q:$P(^PS(52.43,PSOIEN,0),"^",5)'=""  S X=PSOINST_"-"_PSOPTRX     ;SKIPS ENTRIES ALREADY PROCESSED AND FORMATS VARIABLE X
"RTN","PSOPRI",51,0)
IPR10 .I PSOANS2["S",$D(^PSRX(+PSOPTRX,0)),PSOSITE'=$P($G(^PSRX(+PSOPTRX,2)),"^",9) Q
"RTN","PSOPRI",52,0)
 .S PSOPSORX=+$G(PSOPTRX) I PSOPSORX D PSOL^PSSLOCK(PSOPSORX) I '$G(PSOMSG) K PSOPSORX,PSOMSG Q
"RTN","PSOPRI",53,0)
 .K PSOMSG S PSOXFLAG=1
"RTN","PSOPRI",54,0)
 Q
"RTN","PSOPRI",55,0)
 ;LINES CALLED TO MARK PROCESSED NODES
"RTN","PSOPRI",56,0)
IPR5 K DA,DR,DIE S DA=$O(^PS(52.43,"AINST",PSOINST,PSOPTRX,""))
"RTN","PSOPRI",57,0)
 S DIE="^PS(52.43,",DR="5////"_DT_";6///"_$S($G(PSOBBC("DFLG"))=1:"NOT FILLED",$G(PSONOF)=1:"NOT FILLED",1:"FILLED") D ^DIE ; MARKS NODE AS PROCESSED
"RTN","PSOPRI",58,0)
 K ^PS(52.43,"AINST",PSOINST,PSOPTRX,DA)
"RTN","PSOPRI",59,0)
 Q
"RTN","PSOPRI",60,0)
END D PROCESSX^PSOBBC
"RTN","PSOPRI",61,0)
 I $P($G(^PS(59,+$G(PSOSITE),"I")),"^"),DT>$P($G(^("I")),"^") D FINAL^PSOLSET W !!,"Your Outpatient Site parameters have been deleted because you selected an",!,"inactive Outpatient Site!",!
"RTN","PSOPRI",62,0)
 K DIR,PSOBBC,PSOBBC1,PSOVIN,PSOISITE,PSOVEXFL,PSOVXLP,PSOVEX,PSOVX,PSOVEXI,PSOANS,PSOANS2,PSOPTRX,PSOXFLAG,PSOPSORX,X,Y,PSODFN,PSOMHV
"RTN","PSOPRI",63,0)
 Q
"RTN","PSOPRI",64,0)
ULK ;
"RTN","PSOPRI",65,0)
 I '$G(PSOPSORX) Q
"RTN","PSOPRI",66,0)
 D PSOUL^PSSLOCK(PSOPSORX)
"RTN","PSOPRI",67,0)
 K PSOPSORX
"RTN","PSOPRI",68,0)
 Q
"RTN","PSOPRVW")
0^8^B36660908^B35375521
"RTN","PSOPRVW",1,0)
PSOPRVW ;BIR/SAB,MHA-enter/edit/view provider ; 2/9/07 10:39am
"RTN","PSOPRVW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,146,153,263,268,264**;DEC 1997;Build 19
"RTN","PSOPRVW",3,0)
 ;
"RTN","PSOPRVW",4,0)
 ;Ref. to ^VA(200 supp. by IA 224
"RTN","PSOPRVW",5,0)
 ;Ref. to ^DIC(7 supp. by IA 491
"RTN","PSOPRVW",6,0)
 ;Ref.  to $$NPI^XUSNPI supp. by IA 4532
"RTN","PSOPRVW",7,0)
 ;
"RTN","PSOPRVW",8,0)
START W ! S DIC("A")="Select Provider: ",DIC("S")="I $D(^VA(200,+Y,""PS""))",DIC="^VA(200,",DIC(0)="AEQMZ" D ^DIC G:"^"[X EX G:Y<0 START K DIC S PRNO=+Y
"RTN","PSOPRVW",9,0)
 W @IOF,"Name: "_$P(^VA(200,PRNO,0),"^")
"RTN","PSOPRVW",10,0)
 I +$P(^VA(200,PRNO,"PS"),"^",4),$P(^("PS"),"^",4)'>DT W ?40,$C(7),"* * * INACTIVE AS OF ",$E($P(^("PS"),"^",4),4,5),"/",$E($P(^("PS"),"^",4),6,7),"/",$E($P(^("PS"),"^",4),2,3)," * * *"
"RTN","PSOPRVW",11,0)
 ;W !,"SSN#: " S T=$S($P(^VA(200,PRNO,1),"^",9)]"":$P(^(1),"^",9),1:"") W:T $E(T,1,3),"-",$E(T,4,5),"-",$E(T,6,9)
"RTN","PSOPRVW",12,0)
 W !,"Initials: "_$P(^VA(200,PRNO,0),"^",2)
"RTN","PSOPRVW",13,0)
 W !,"NON-VA Prescriber: "
"RTN","PSOPRVW",14,0)
 I $P($G(^VA(200,PRNO,"TPB")),"^")]"" W $S($P(^("TPB"),"^"):"Yes",1:"No")
"RTN","PSOPRVW",15,0)
 W ?40,"Tax ID: "_$P($G(^VA(200,PRNO,"TPB")),"^",2)
"RTN","PSOPRVW",16,0)
 W !,"Exclusionary Check Performed: " I $P($G(^VA(200,PRNO,"TPB")),"^",3)]"" W $S($P(^("TPB"),"^",3):"Yes",1:"No")
"RTN","PSOPRVW",17,0)
 W ?40,"Date Exclusionary List Checked: "
"RTN","PSOPRVW",18,0)
 S Y=$P($G(^VA(200,PRNO,"TPB")),"^",4) I Y W $E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)
"RTN","PSOPRVW",19,0)
 W !,"On Exclusionary List: " I $P($G(^VA(200,PRNO,"TPB")),"^",5)]"" W $S($P(^("TPB"),"^",5):"Yes",1:"No")
"RTN","PSOPRVW",20,0)
 W !,"Exclusionary Checked By: "
"RTN","PSOPRVW",21,0)
 I $P($G(^VA(200,PRNO,"TPB")),"^",6) W $P($G(^VA(200,$P(^("TPB"),"^",6),0)),"^")
"RTN","PSOPRVW",22,0)
 W !,"Authorized to Write Orders: "_$S($P(^VA(200,PRNO,"PS"),"^"):"Yes",1:"No")
"RTN","PSOPRVW",23,0)
 W !,"Requires Cosigner: "_$S($P(^("PS"),"^",7):"Yes",1:"No"),?40,"DEA# "_$P(^VA(200,PRNO,"PS"),"^",2) I $P(^("PS"),"^",7),$D(^VA(200,+$P(^("PS"),"^",8),0)) W !,"Usual Cosigner: "_$P(^(0),"^")
"RTN","PSOPRVW",24,0)
 W !,"Class: " S PRCLS=+$P(^VA(200,PRNO,"PS"),"^",5),PRCLS=$S(PRCLS>0&$D(^DIC(7,PRCLS,0)):$P(^(0),"^"),1:"") W PRCLS,?40,"VA#  "_$P(^VA(200,PRNO,"PS"),"^",3)
"RTN","PSOPRVW",25,0)
 W !," Type: " S T=+$P(^("PS"),"^",6),L=$P(^DD(200,53.6,0),"^",3)_";"_T_":Unknown" F I=1:1 I $P($P(L,";",I),":",1)=T W $P($P(L,";",I),":",2) Q
"RTN","PSOPRVW",26,0)
 N NPI S NPI=$P($$NPI^XUSNPI("Individual_ID",PRNO),"^") W ?40,"NPI# "_$S(NPI>0:+NPI,1:"")
"RTN","PSOPRVW",27,0)
 W !,"Remarks: "_$P(^VA(200,PRNO,"PS"),"^",9),!,"Synonym(s):  "_$S($P($G(^VA(200,PRNO,.1)),"^",4)]"":$P(^(.1),"^",4)_",",1:"")_$S($P(^(0),"^",2)]"":" "_$P(^(0),"^",2),1:"")
"RTN","PSOPRVW",28,0)
 W !,"Service/Section: " S PSOSSDA=$G(DA) I $P($G(^VA(200,PRNO,5)),"^") K DIQ S DIC="^DIC(49,",DA=$P(^VA(200,PRNO,5),"^"),DR=.01,DIQ="PSOSECT",DIQ(0)="E" D EN^DIQ1 W $G(PSOSECT(49,DA,.01,"E")) S DA=$G(PSOSSDA) K DR,DIC,DIQ,PSOSSDA,PSOSECT
"RTN","PSOPRVW",29,0)
 I $TR($G(^VA(200,PRNO,.11)),"^","")="" G NUM
"RTN","PSOPRVW",30,0)
 W !!,"Address: ",?10,$P(^VA(200,PRNO,.11),"^") W:$P(^(.11),"^",2)'="" !?10,$P(^(.11),"^",2) W:$P(^(.11),"^",3)'="" !?10,$P(^(.11),"^",3)
"RTN","PSOPRVW",31,0)
 W !?10,$P(^VA(200,PRNO,.11),"^",4) W:$P(^(.11),"^",4)]"" ", " S STAT=+$P($G(^(.11)),"^",5) W $S($D(^DIC(5,STAT,0)):$P(^(0),"^"),1:"")_"  "_$P(^VA(200,PRNO,.11),"^",6)
"RTN","PSOPRVW",32,0)
NUM G:'$D(^VA(200,PRNO,.13)) START
"RTN","PSOPRVW",33,0)
 W !,"Phone:    "_$P(^VA(200,PRNO,.13),"^"),! W:$P(^(.13),"^",2)]"" "Office:   ",$P(^(.13),"^",2),!
"RTN","PSOPRVW",34,0)
 W:$P(^VA(200,PRNO,.13),"^",3)]"" "Phone #3: "_$P(^(.13),"^",3),?40 W:$P(^(.13),"^",7)]"" "Voice Pager  #: "_$P(^(.13),"^",7) W !
"RTN","PSOPRVW",35,0)
 W:$P(^VA(200,PRNO,.13),"^",4)]"" "Phone #4: "_$P(^(.13),"^",4),?40 W:$P(^(.13),"^",8)]"" "Digital Pager#: "_$P(^(.13),"^",8)
"RTN","PSOPRVW",36,0)
 W:$P(^VA(200,PRNO,.13),"^",6)]"" !,"Fax #:    "_$P(^(.13),"^",6)
"RTN","PSOPRVW",37,0)
 W:$P($G(^VA(200,PRNO,.14)),"^")]"" !,"Room Loc: "_$P(^(.14),"^")
"RTN","PSOPRVW",38,0)
 G START
"RTN","PSOPRVW",39,0)
EX K DIC,DIE,DA,DR,D0,PRNO,PRCLS,STAT,T,Y,X,L,LF,I,DIR,DIROUT,DUOUT,DTOUT,DIRUT,%,%Y,%W,%Z,C,DDH,DI,DIH,DLAYGO,DQ,X1,XMDT,XMN
"RTN","PSOPRVW",40,0)
 Q
"RTN","PSOPRVW",41,0)
ASK ;edit providers
"RTN","PSOPRVW",42,0)
 K DIR,DTOUT,DUOUT,DIROUT,DIRUT
"RTN","PSOPRVW",43,0)
 W !! S DIC("A")="Select Provider: ",(DIC,DIE)=200,DIC(0)="AEQMZ" D ^DIC G:"^"[X EX G:Y<0 ASK S (FADA,DA)=+Y
"RTN","PSOPRVW",44,0)
 I '$D(^VA(200,DA,"PS")) G NPRV
"RTN","PSOPRVW",45,0)
ASK1 W @IOF,?25,"Provider: "_$P(^VA(200,DA,0),"^"),! F DR="TPB","PS",".11",".13",".14" D EN^DIQ
"RTN","PSOPRVW",46,0)
 K DIC,Y
"RTN","PSOPRVW",47,0)
EDT W ! L +^VA(200,DA):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3)
"RTN","PSOPRVW",48,0)
 I '$T W $C(7),!!,"Provider Data is Being Edited by Another User!",! G QX
"RTN","PSOPRVW",49,0)
 N RTPB S RTPB=$G(^VA(200,DA,"TPB"))
"RTN","PSOPRVW",50,0)
 S DR="53.91" D ^DIE I $D(Y)!$D(DTOUT) G QX
"RTN","PSOPRVW",51,0)
 I 'X,$G(PSOTPBFG) G QX
"RTN","PSOPRVW",52,0)
 I X S DR="53.92R;53.93R;53.94R;53.95R"
"RTN","PSOPRVW",53,0)
 E  S DR="53.92;53.93;53.94;53.95"
"RTN","PSOPRVW",54,0)
 S DR=DR_";D:X MS^PSOPRVW",DIE("NO^")="OUTOK" D ^DIE K DIE("NO^")
"RTN","PSOPRVW",55,0)
 I '$D(^VA(200,DA,"TPB")),$G(PSOTPBFG) G QX
"RTN","PSOPRVW",56,0)
 I $D(Y)!$D(DTOUT) D:$P($G(^VA(200,DA,"TPB")),"^",3)  G QX
"RTN","PSOPRVW",57,0)
 .I RTPB=""!('$P(RTPB,"^",3)) S DR="53.96////"_DUZ D ^DIE
"RTN","PSOPRVW",58,0)
 I $P($G(^VA(200,DA,"TPB")),"^",3) D
"RTN","PSOPRVW",59,0)
 .I RTPB=""!('$P(RTPB,"^",3)) S DR="53.96////"_DUZ D ^DIE
"RTN","PSOPRVW",60,0)
 G:$G(PSOTPBFG) QX
"RTN","PSOPRVW",61,0)
ED1 S DR="53.1:53.6;I X'=4 S Y=""@1"";29;8932.1;@1;53.7;I 'X S Y=""@2"";53.8;@2;53.9;.111:.116;.131:.134;.136;.137;.138;.141",DR(2,200.05)=".01;2;3"
"RTN","PSOPRVW",62,0)
 D ^DIE S FADA=DA D:'$D(Y) KEY
"RTN","PSOPRVW",63,0)
QX K FADA,RTPB L -^VA(200,DA) Q:$G(PSOTPBFG)  G:+$G(VADA) ADD G ASK
"RTN","PSOPRVW",64,0)
 Q
"RTN","PSOPRVW",65,0)
 G:'$D(^VA(200,DA,"TPB")) ED1
"RTN","PSOPRVW",66,0)
ADD ;add new providers (kernel 7)
"RTN","PSOPRVW",67,0)
 W !
"RTN","PSOPRVW",68,0)
 S VADA=$$ADD^XUSERNEW("53.91;S:'X Y=""@2"";53.92R;53.93R;53.94R;53.95R;D:X MS^PSOPRVW;@2;53.1;53.2;53.3;53.4;53.5;53.6;53.7;S:'X Y=""@1"";53.8;@1;53.9;.111:.116;.131:.134;.136;.141")
"RTN","PSOPRVW",69,0)
 S (FADA,DA)=+VADA,(DIC,DIE)="^VA(200,"
"RTN","PSOPRVW",70,0)
 I VADA>0,$P(VADA,"^",3),$P($G(^VA(200,DA,"TPB")),"^") D
"RTN","PSOPRVW",71,0)
 .S DR="53.96////"_DUZ D ^DIE
"RTN","PSOPRVW",72,0)
 I VADA>0,'$P(VADA,"^",3) S DIC(0)="AEQMZ" G:'$D(^VA(200,+VADA,"PS")) NPRV G:$D(^VA(200,+VADA,"PS")) ASK1
"RTN","PSOPRVW",73,0)
 D:VADA>0 KEY K DIK,DIC,Y,X,VADA,VA,DEA Q:$G(PSOTPBFG)  K DA G EX
"RTN","PSOPRVW",74,0)
 Q
"RTN","PSOPRVW",75,0)
NPRV W ! S DIR("A",1)=$P(^VA(200,DA,0),"^")_" is NOT currently indicated as being a provider.",DIR("A")="Do you want to make "_$P(^VA(200,DA,0),"^")_" a provider? (Y/N): ",DIR(0)="SA^1:YES;0:NO",DIR("B")="NO"
"RTN","PSOPRVW",76,0)
 S DIR("?",1)="Answer with '1' or 'Yes' if "_$P(^VA(200,DA,0),"^")_" is to become a provider",DIR("?")="otherwise press return for 'No' and re-enter name." D ^DIR G:$D(DTOUT) EX
"RTN","PSOPRVW",77,0)
 G:'Y!($D(DIRUT))&('+$G(VADA)) ASK G:'$P(+$G(VADA),"^",3)&('Y) ADD
"RTN","PSOPRVW",78,0)
 G EDT
"RTN","PSOPRVW",79,0)
 Q
"RTN","PSOPRVW",80,0)
KEY I $D(^VA(200,DA,"PS")) D
"RTN","PSOPRVW",81,0)
 .I '$P(^VA(200,DA,"PS"),"^",4)!($P(^("PS"),"^",4)>DT) S PSOPDA=DA K DIC S DIC="^DIC(19.1,",DIC(0)="MZ",X="PROVIDER" D ^DIC K DIC S DA=PSOPDA K PSOPDA I +Y>0 S X=+Y D
"RTN","PSOPRVW",82,0)
 ..S:'$D(^VA(200,FADA,51,0)) ^VA(200,FADA,51,0)="^"_$P(^DD(200,51,0),"^",2)_"^^"
"RTN","PSOPRVW",83,0)
 ..S DIC="^VA(200,"_FADA_",51,",DIC(0)="LM",DIC("DR")="1////"_$S($G(DUZ):DUZ,1:"")_";2///"_DT,DLAYGO=200.051,DINUM=X,DA(1)=FADA
"RTN","PSOPRVW",84,0)
 ..L +^VA(200,FADA):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) K DD,DO D FILE^DICN L -^VA(200,FADA) K DIC,DR,X,Y
"RTN","PSOPRVW",85,0)
 Q
"RTN","PSOPRVW",86,0)
MS ;
"RTN","PSOPRVW",87,0)
 W !!,$C(7),"This provider will not be selectable during TPB medication order entry!!",!
"RTN","PSOPRVW",88,0)
 Q
"RTN","PSORENW4")
0^22^B57297144^B54619443
"RTN","PSORENW4",1,0)
PSORENW4 ;BIR/SAB - rx speed renew ;03/06/95
"RTN","PSORENW4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,37,64,46,75,71,100,130,117,152,148,264**;DEC 1997;Build 19
"RTN","PSORENW4",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORENW4",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORENW4",5,0)
 ;External references L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW4",6,0)
 ;External reference to LK^ORX2 and ULK^ORX2 supported by DBIA 867
"RTN","PSORENW4",7,0)
SEL I $P(PSOPAR,"^",4)=0 S VALMSG="Renewing is NOT Allowed. Check Site Parameters!",VALMBCK="" Q
"RTN","PSORENW4",8,0)
 N VALMCNT I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!",VALMBCK="" Q
"RTN","PSORENW4",9,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSORENW4",10,0)
 K PSOPLCK S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" D UL^PSSLOCK(PSODFN) Q
"RTN","PSORENW4",11,0)
 K PRC,PHI,PSORX("EDIT"),PSOFDR,DIR,DUOUT,DIRUT,PSORNSPD S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" G SELQ
"RTN","PSORENW4",12,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,DTOUT I +Y S (SPEED,PSOOELSE,PSORNSPD)=1 D FULL^VALM1 S LST=Y D
"RTN","PSORENW4",13,0)
 .S (PSODIR("DFLG"),PSODIR("FIELD"))=0,PSOOPT=3,(PSORENW("DFLG"),PSORENW("QFLG"),PSORX("DFLG"))=0 D INIT Q:PSORENW("DFLG")
"RTN","PSORENW4",14,0)
 .F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  S ORN=$P(LST,",",ORD) D:+PSOLST(ORN)=52 PROCESS S PSORENW("DFLG")=0
"RTN","PSORENW4",15,0)
 I '$G(PSOOELSE) S VALMBCK="" G SELQ
"RTN","PSORENW4",16,0)
 S VALMBCK="R"
"RTN","PSORENW4",17,0)
 D ^PSOBUILD,BLD^PSOORUT1 K DIR,DIRUT,DTOUT,DUOUT,LST,ORD,IEN,ORN,RPH,ST,REFL,REF,PSOACT,ORSV,PSORNW,PSORENW,PSONO,PSOCO,PSOCU,PSODIR,DSMSG,SPEED,PSORENW,PSOOELSE,PSOOPT,PSORX("FILL DATE"),PSORX("ISSUE DATE"),PSOID,PSOMSG,PSORX("DFLG"),PSOQTY
"RTN","PSORENW4",18,0)
SELQ K PSORNSPD,RTE,DRET,PRC,PHI S X=PSODFN_";DPT(" D ULK^ORX2,UL^PSSLOCK(PSODFN),CLEAN^PSOVER1
"RTN","PSORENW4",19,0)
 Q
"RTN","PSORENW4",20,0)
 ;
"RTN","PSORENW4",21,0)
PROCESS ; Process one order at a time
"RTN","PSORENW4",22,0)
 I $$LMREJ^PSOREJU1($P(PSOLST(ORN),"^",2)) W $C(7),!!,"Rx "_$$GET1^DIQ(52,$P(PSOLST(ORN),"^",2),.01)_" has OPEN/UNRESOLVED 3rd Party Payer Rejects!" K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",23,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) W $C(7),!!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^")),! K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",24,0)
 K RET,DRET,PRC,PHI S PSORENW("OIRXN")=$P(PSOLST(ORN),"^",2),PSOFROM="NEW"
"RTN","PSORENW4",25,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN")),SIGOK=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^",2)
"RTN","PSORENW4",26,0)
 I SIGOK F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORENW("OIRXN"),"SIG1",I,0)
"RTN","PSORENW4",27,0)
 S PSOIBOLD=$G(PSORENW("OIRXN")) D SETIB^PSORENW1
"RTN","PSORENW4",28,0)
 I '$G(PSORENW("PROVIDER")) D
"RTN","PSORENW4",29,0)
 .S PSORENW("PROVIDER")=$P(PSORENW("RX0"),"^",4)
"RTN","PSORENW4",30,0)
 .S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW4",31,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW4",32,0)
 I '$G(PSORENW("CLINIC")) S PSORENW("CLINIC")=$P(PSORENW("RX0"),"^",5)
"RTN","PSORENW4",33,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")
"RTN","PSORENW4",34,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^")
"RTN","PSORENW4",35,0)
 S PSORENW("PSODFN")=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW4",36,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW4",37,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6)
"RTN","PSORENW4",38,0)
 S PSORENW("QTY")=$P(PSORENW("RX0"),"^",7)
"RTN","PSORENW4",39,0)
 ;S PSORENW("DAYS SUPPLY")=$P(PSORENW("RX0"),"^",8)
"RTN","PSORENW4",40,0)
 ;S PSORENW("# OF REFILLS")=$P(PSORENW("RX0"),"^",9)
"RTN","PSORENW4",41,0)
 S PSORENW("INS")=$S($G(PSORENW("ENT"))]"":PSORENW("ENT"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW4",42,0)
 S:$G(PSORENW("ENT"))']"" PSORENW("ENT")=0
"RTN","PSORENW4",43,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW4",44,0)
 .S PSORENW("ENT")=PSORENW("ENT")+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW4",45,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW4",46,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW4",47,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW4",48,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW4",49,0)
 .K DOSE
"RTN","PSORENW4",50,0)
 I $P($G(^PSDRUG(PSORENW("DRUG IEN"),"CLOZ1")),"^")="PSOCLO1" N PSON S PSON=0 D  I PSON K PSON D POZ,KLIB^PSORENW1 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSORENW4",51,0)
 . I '$L($P(^VA(200,PSORENW("PROVIDER"),"PS"),"^",2)),'$L($P(^VA(200,PSORENW("PROVIDER"),"PS"),"^",3)) D  Q
"RTN","PSORENW4",52,0)
 . . S PSON=1 W $C(7),!!,"Only providers with DEA# or a VA# can write prescriptions for clozapine.",!
"RTN","PSORENW4",53,0)
 . I '$D(^XUSEC("YSCL AUTHORIZED",PSORENW("PROVIDER"))) D 
"RTN","PSORENW4",54,0)
 . . S PSON=1 W $C(7),!!,"Provider must hold YSCL AUTHORIZED key to write prescriptions for clozapine.",!
"RTN","PSORENW4",55,0)
 I $G(PSORNW("MAIL/WINDOW"))]"" S PSORENW("MAIL/WINDOW")=PSORNW("MAIL/WINDOW")
"RTN","PSORENW4",56,0)
 I $O(^PSRX(PSORENW("OIRXN"),"PI",0)) D  K T
"RTN","PSORENW4",57,0)
 .S PHI=^PSRX(PSORENW("OIRXN"),"PI",0),T=0
"RTN","PSORENW4",58,0)
 .F  S T=$O(^PSRX(PSORENW("OIRXN"),"PI",T)) Q:'T  S PHI(T)=^PSRX(PSORENW("OIRXN"),"PI",T,0)
"RTN","PSORENW4",59,0)
 I $O(^PSRX(PSORENW("OIRXN"),"PRC",0)) D  K T
"RTN","PSORENW4",60,0)
 .S PRC=^PSRX(PSORENW("OIRXN"),"PRC",0),T=0
"RTN","PSORENW4",61,0)
 .F  S T=$O(^PSRX(PSORENW("OIRXN"),"PRC",T)) Q:'T  S PRC(T)=^PSRX(PSORENW("OIRXN"),"PRC",T,0)
"RTN","PSORENW4",62,0)
 W !!,"Now Renewing Rx # "_PSORENW("ORX #")_"   Drug: "_$P($G(^PSDRUG(+$G(PSORENW("DRUG IEN")),0)),"^"),!
"RTN","PSORENW4",63,0)
 I '$P($G(^PSDRUG($P(PSORENW("RX0"),"^",6),2)),"^") D  G:$G(PSORENW("DFLG")) PROCESSX
"RTN","PSORENW4",64,0)
 .I $P($G(^PSRX(PSORENW("OIRXN"),"OR1")),"^") S PSODRUG("OI")=$P(^PSRX(PSORENW("OIRXN"),"OR1"),"^"),PSODRUG("OIN")=$P(^PS(50.7,+^("OR1"),0),"^") Q
"RTN","PSORENW4",65,0)
 .W !!,"Cannot Renew!!  No Pharmacy Orderable Item!" S VALMSG="Cannot Renew!!  No Pharmacy Orderable Item!",PSORX("DFLG")=1
"RTN","PSORENW4",66,0)
 D CHECK^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",67,0)
 D FILDATE^PSORENW0
"RTN","PSORENW4",68,0)
 D DRUG^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",69,0)
 D RXN^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",70,0)
 D STOP^PSORENW1
"RTN","PSORENW4",71,0)
DSPL K PSOEDT,PSOLM S PSDY=PSORENW("DAYS SUPPLY"),PSRF=PSORENW("# OF REFILLS")
"RTN","PSORENW4",72,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSODIR("CS")=1
"RTN","PSORENW4",73,0)
 I $G(PSODIR("CS")) D
"RTN","PSORENW4",74,0)
 .S PSORENW("# OF REFILLS")=$S(PSDY<60:5,PSDY'<60&(PSDY'>89):2,PSDY=90:1,1:0)
"RTN","PSORENW4",75,0)
 .I PSORENW("# OF REFILLS")>PSRF S PSORENW("# OF REFILLS")=PSRF
"RTN","PSORENW4",76,0)
 D DSPLY^PSORENW3 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",77,0)
 D:$D(^XUSEC("PSORPH",DUZ))!('$P(PSOPAR,"^",2)) VER1^PSOORNE4(.PSORENW) G:PSORENW("DFLG")=1 PROCESSX
"RTN","PSORENW4",78,0)
 I $G(PSOQTY) D QTY^PSODIR1(.PSORENW) G:PSORENW("DFLG")=1 PROCESSX
"RTN","PSORENW4",79,0)
 D EN^PSORN52(.PSORENW)
"RTN","PSORENW4",80,0)
 D RNPSOSD^PSOUTIL
"RTN","PSORENW4",81,0)
 D CAN^PSORENW0,DCORD^PSONEW2
"RTN","PSORENW4",82,0)
 S PSORENW("# OF REFILLS")=PSRF K PSDY,PSRF,PSODIR("CS"),DEA,PSORENW("ENT")
"RTN","PSORENW4",83,0)
 S BBRN="",BBRN1=$O(^PSRX("B",PSORENW("NRX #"),BBRN)) I $P($G(^PSRX(BBRN1,0)),"^",11)["W" S BINGCRT="Y",BINGRTE="W",BBFLG=1,BBRX(1)=$G(BBRX(1))_BBRN1_","
"RTN","PSORENW4",84,0)
PROCESSX I PSORENW("DFLG") D  W:'$G(POERR) !,$C(7),"Rx NOT RENEWED. RENEWED RX DELETED",! S POERR("DFLG")=1 D CLEAN^PSOVER1
"RTN","PSORENW4",85,0)
 .K PHI,PRC,PSODRUG,SIG,PSORXED,SIGOK
"RTN","PSORENW4",86,0)
 .K PSORENW("DOSE"),PSORENW("DURATION"),PSORENW("DRUG IEN"),PSORENW("ENT"),PSORENW("INS"),PSORENW("NOUN"),PSORENW("ROUTE"),PSORENW("SCHEDULE"),PSORENW("SIG"),PSORENW("VERB"),PSORENW("UNITS")
"RTN","PSORENW4",87,0)
 .D POZ
"RTN","PSORENW4",88,0)
 K PSORDLOK I PSORENW("DFLG") S PSORDLOK=1
"RTN","PSORENW4",89,0)
 D:$G(PSORENW("OLD FILL DATE"))]"" SUSDATEK^PSOUTIL(.PSORENW)
"RTN","PSORENW4",90,0)
 K BBRN,BBRN1,PSODRUG,PSORX("PROVIDER NAME"),PSORX("CLINIC")
"RTN","PSORENW4",91,0)
 K PSOEDT,PSOLM S:$G(PSORENW("FROM"))="" (PSORENW("DFLG"),PSORENW("QFLG"))=0
"RTN","PSORENW4",92,0)
 I $G(PSORDLOK) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSORENW4",93,0)
 D KLIB^PSORENW1
"RTN","PSORENW4",94,0)
 K PSORDLOK
"RTN","PSORENW4",95,0)
 S RXN=$O(^TMP("PSORXN",$J,0)) I RXN D
"RTN","PSORENW4",96,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSORENW4",97,0)
 .I $P(^PSRX(RXN,"STA"),"^")=5 D EN^PSOHLSN1(RXN,"SC","ZS",$P(RXN1,"^",4))
"RTN","PSORENW4",98,0)
 K RXN,RXN1,^TMP("PSORXN",$J)
"RTN","PSORENW4",99,0)
 Q
"RTN","PSORENW4",100,0)
INIT ;
"RTN","PSORENW4",101,0)
 D ASK Q:PSORENW("DFLG")
"RTN","PSORENW4",102,0)
 D NOORE^PSONEW(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",103,0)
 Q
"RTN","PSORENW4",104,0)
ASK ;upfront questions
"RTN","PSORENW4",105,0)
 W !! D ISSDT^PSODIR2(.PSORENW) Q:PSORENW("DFLG")  S PSORENW("ISSUE DATE")=PSOID
"RTN","PSORENW4",106,0)
 D FILLDT^PSODIR2(.PSORENW) K PSONEW("DAYS SUPPLY"),PSONEW("# OF REFILLS") Q:PSORENW("DFLG")
"RTN","PSORENW4",107,0)
 S PSORNW("FILL DATE")=PSORENW("FILL DATE")
"RTN","PSORENW4",108,0)
 D MW^PSODIR2(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",109,0)
 D PTSTAT^PSODIR1(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",110,0)
 D DAYS^PSODIR1(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",111,0)
 S PSODRUG("DEA")=0 D REFILL^PSODIR1(.PSORENW) K PSODRUG("DEA") Q:PSORENW("DFLG")
"RTN","PSORENW4",112,0)
 K DIR,DIRUT S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to edit Renewed Rx(s) QTY " D ^DIR I $D(DIRUT) S PSORENW("DFLG")=1 K DIR,DIRUT Q
"RTN","PSORENW4",113,0)
 S PSOQTY=Y K DIR,DIRUT
"RTN","PSORENW4",114,0)
 D CLINIC^PSODIR2(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",115,0)
 D PROV^PSODIR(.PSORENW) S:PSORENW("DFLG") PSORENW("DFLG")=0
"RTN","PSORENW4",116,0)
 Q
"RTN","PSORENW4",117,0)
 ;
"RTN","PSORENW4",118,0)
POZ ;
"RTN","PSORENW4",119,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DIRUT,DTOUT
"RTN","PSORENW4",120,0)
 Q
"RTN","PSORESUS")
0^17^B14351152^n/a
"RTN","PSORESUS",1,0)
PSORESUS ;BIR/EJW Queue/Requeue an Rx to CMOP ;07/25/07
"RTN","PSORESUS",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**264**;DEC 1997;Build 19
"RTN","PSORESUS",3,0)
 ;
"RTN","PSORESUS",4,0)
 ;This routine will allow the last unreleased fill of an Rx to be suspended or resuspended to CMOP.
"RTN","PSORESUS",5,0)
 ;Examples of when this may be used are if the patient was previously marked as "DO NOT MAIL",
"RTN","PSORESUS",6,0)
 ;a drug was recently marked as a CMOP drug, the patient's address was updated to a good address, etc.
"RTN","PSORESUS",7,0)
 ;
"RTN","PSORESUS",8,0)
TOP ;
"RTN","PSORESUS",9,0)
 S SAVEPPL=$G(PPL)
"RTN","PSORESUS",10,0)
 S DIR(0)="FO^1:15",DIR("A")="Enter the Rx # to queue to CMOP"
"RTN","PSORESUS",11,0)
 S DIR("?")="Enter the prescription number you want to suspend for CMOP dispense."
"RTN","PSORESUS",12,0)
 D ^DIR K DIR I $D(DIRUT) G END
"RTN","PSORESUS",13,0)
 S RX=Y K Y
"RTN","PSORESUS",14,0)
 S PSOIEN=$O(^PSRX("B",RX,"")) I $G(PSOIEN)']"" W !,"Rx # "_RX_" not found" D END G TOP
"RTN","PSORESUS",15,0)
 D SENDRX
"RTN","PSORESUS",16,0)
 I $G(PPL)]"" W !!,$P(^PSRX(PSOIEN,0),"^")," cannot be suspended for CMOP.  Make sure the last fill has a Mail routing, the drug is marked for CMOP, the last fill has not been released, etc...",!!
"RTN","PSORESUS",17,0)
 D END G TOP
"RTN","PSORESUS",18,0)
END K CHECK,CT,DIR,DIROUT,DIRUT,PSOIEN,LAST,NODE,PSX,PSXPPL,PPL,RF,RX,X,Y,ZD,%
"RTN","PSORESUS",19,0)
 K PSXSITEA
"RTN","PSORESUS",20,0)
 I $G(SAVEPPL) S PPL=SAVEPPL K SAVEPPL
"RTN","PSORESUS",21,0)
 Q
"RTN","PSORESUS",22,0)
CM ; ENTRY POINT FOR SPEED QUEUE/REQUEUE TO CMOP
"RTN","PSORESUS",23,0)
 S SAVEPPL=$G(PPL)
"RTN","PSORESUS",24,0)
 N PSOSTA,II
"RTN","PSORESUS",25,0)
 N PSOOELSE,PSOIEN,VALMCNT
"RTN","PSORESUS",26,0)
 I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSORESUS",27,0)
OS K DIR,DUOUT,DIRUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR S LST=Y I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" Q
"RTN","PSORESUS",28,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,PSOREPX I '+LST D KILL S VALMBCK="" Q
"RTN","PSORESUS",29,0)
 S PSOOELSE=1 D FULL^VALM1
"RTN","PSORESUS",30,0)
 S PPL="" F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  D
"RTN","PSORESUS",31,0)
 .S ORN=$P(LST,",",ORD),PSOIEN=$P(PSOLST(ORN),"^",2) I $P(PSOLST(ORN),"^",3)'="PENDING" D
"RTN","PSORESUS",32,0)
 ..S PSOSTA=$P($G(^PSRX(PSOIEN,"STA")),"^") I PSOSTA'=0,PSOSTA'=5 W !!,$P(^PSRX(PSOIEN,0),"^")," is not active or suspended" H 2 Q
"RTN","PSORESUS",33,0)
 ..I $P($G(^PSRX(PSOIEN,0)),"^",2) S PPL=$S(PPL:PPL_",",1:"")_PSOIEN
"RTN","PSORESUS",34,0)
 ..S VALMBCK="R"
"RTN","PSORESUS",35,0)
 I +PPL S SAVEPPL=PPL F II=1:1 S PSOIEN=$P(SAVEPPL,",",II) Q:PSOIEN=""  D
"RTN","PSORESUS",36,0)
 .D SENDRX
"RTN","PSORESUS",37,0)
 .I $G(PPL)]"" W !!,$P(^PSRX(PSOIEN,0),"^")_" cannot be suspended for CMOP.  Make sure the last fill has a Mail routing, the drug is marked for CMOP, the last fill has not been released, etc...",! H 2
"RTN","PSORESUS",38,0)
 I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSORESUS",39,0)
 D ^PSOBUILD
"RTN","PSORESUS",40,0)
 D KILL D KVA^VADPT
"RTN","PSORESUS",41,0)
 Q
"RTN","PSORESUS",42,0)
 ;
"RTN","PSORESUS",43,0)
KILL ; CLEAN UP VARIABLES
"RTN","PSORESUS",44,0)
 K DIC,LST,ORD,ORN,PSOIEN,PNM,PPL,PSZIP,RX,SSNP,VA,VADDR1,VADM,VAEL,VAPA,VASTREET
"RTN","PSORESUS",45,0)
 I $G(SAVEPPL) S PPL=SAVEPPL K SAVEPPL
"RTN","PSORESUS",46,0)
 Q
"RTN","PSORESUS",47,0)
 ;
"RTN","PSORESUS",48,0)
SENDRX ; SET RX INTO SUSPENSE FILE FOR CMOP
"RTN","PSORESUS",49,0)
 N LAST,I,TRX,PSOMC,PSOMDT
"RTN","PSORESUS",50,0)
 S LAST=0 I $D(^PSRX(PSOIEN,1)) S I=0 F  S I=$O(^PSRX(PSOIEN,1,I)) Q:'I  S LAST=I
"RTN","PSORESUS",51,0)
 I $D(PSOSITE) S PSXSITEA=PSOSITE
"RTN","PSORESUS",52,0)
 S PSOSITE=$S(LAST=0:$P(^PSRX(PSOIEN,2),"^",9),1:$P(^PSRX(PSOIEN,1,LAST,0),"^",9))
"RTN","PSORESUS",53,0)
 D NOW^%DTC
"RTN","PSORESUS",54,0)
 N ZD
"RTN","PSORESUS",55,0)
 S PPL=PSOIEN
"RTN","PSORESUS",56,0)
 S TRX=$P($G(PPL),",",1)
"RTN","PSORESUS",57,0)
 S DFN=$P(^PSRX(TRX,0),"^",2),PSOMDT=$P($G(^PS(55,DFN,0)),"^",5),PSOMC=$P($G(^PS(55,DFN,0)),"^",3) K DFN,TRX
"RTN","PSORESUS",58,0)
 I (PSOMC>1&(PSOMDT>DT))!(PSOMC>1&(PSOMDT<1)) W !,"Cannot suspend for CMOP. Patient's mail status not a CMOP mail status" H 2 K PPL Q
"RTN","PSORESUS",59,0)
 S ZD(PSOIEN)=% D TEST^PSOCMOP H 2
"RTN","PSORESUS",60,0)
 I $G(PSXSITEA)]"" S PSOSITE=PSXSITEA
"RTN","PSORESUS",61,0)
 Q
"RTN","PSORESUS",62,0)
 ;
"RTN","PSORXVW")
0^24^B67278533^B66871354
"RTN","PSORXVW",1,0)
PSORXVW ;BHAM ISC/SAB - listman view of a prescription ;5/25/05 2:10pm
"RTN","PSORXVW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**14,35,46,96,103,88,117,131,146,156,185,210,148,233,260,264**;DEC 1997;Build 19
"RTN","PSORXVW",3,0)
 ;External reference to File ^PS(55 supported by DBIA 2228
"RTN","PSORXVW",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORXVW",5,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSORXVW",6,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSORXVW",7,0)
 ;External reference to ^SC supported by DBIA 10040
"RTN","PSORXVW",8,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSORXVW",9,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSORXVW",10,0)
 ;External reference to GMRADPT supported by DBIA 10099
"RTN","PSORXVW",11,0)
 ;
"RTN","PSORXVW",12,0)
 S PS="VIEW"
"RTN","PSORXVW",13,0)
A1 ; - Prescription prompt
"RTN","PSORXVW",14,0)
 S DIR(0)="FAO^1:30",DIR("A")=PS_" PRESCRIPTION: ",(DIR("?"),DIR("??"))="^D HLP^PSORXVW1"
"RTN","PSORXVW",15,0)
 W ! D ^DIR I X=""!$D(DIRUT) G KILL
"RTN","PSORXVW",16,0)
 S X=$$UP^XLFSTR(X),QUIT=0
"RTN","PSORXVW",17,0)
 I $E(X,1,2)'="E." S (DA,PSOVDA)=+$$LKP^PSORXVW1(X) I DA<0 G A1
"RTN","PSORXVW",18,0)
 I $E(X,1,2)="E." D  I QUIT G A1
"RTN","PSORXVW",19,0)
 . I $L(X)'=9 W !?5,"The ECME# must be 7 digits long!",$C(7) S QUIT=1 Q
"RTN","PSORXVW",20,0)
 . S (DA,PSOVDA)=+$$RXNUM^PSOBPSU2($E(X,3,9)) I DA<0 W " ??" S QUIT=1
"RTN","PSORXVW",21,0)
 ;
"RTN","PSORXVW",22,0)
DP S (PSODFN,DFN)=+$P(^PSRX(DA,0),"^",2) S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORXVW",23,0)
 D ICN^PSODPT(PSODFN)
"RTN","PSORXVW",24,0)
 K ^TMP("PSOHDR",$J) D ^VADPT,ADD^VADPT
"RTN","PSORXVW",25,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1)
"RTN","PSORXVW",26,0)
 N PSOBADR,PSOTEMP
"RTN","PSORXVW",27,0)
 S PSOBADR=$$BADADR^DGUTL3(DFN) I PSOBADR S PSOTEMP=$$CHKTEMP^PSOBAI(DFN) D
"RTN","PSORXVW",28,0)
 .S ^TMP("PSOHDR",$J,1,0)=^TMP("PSOHDR",$J,1,0)_" ** BAD ADDRESS INDICATED-("_$S(PSOBADR=1:"UNDELIVERABLE",PSOBADR=2:"HOMELESS",1:"OTHER")_")"_$S(PSOTEMP:" Active Temporary Address",1:"")
"RTN","PSORXVW",29,0)
 S ^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSORXVW",30,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSORXVW",31,0)
 S POERR=1 D RE^PSODEM K PSOERR
"RTN","PSORXVW",32,0)
 S ^TMP("PSOHDR",$J,6,0)=$S(+$P(WT,"^",8):$P(WT,"^",9)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSORXVW",33,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$P(HT,"^",9)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSORXVW",34,0)
 S GMRA="0^0^111" D EN1^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSORXVW",35,0)
 D DEM^VADPT I +VADM(6) D
"RTN","PSORXVW",36,0)
 .S SSN=$P(^DPT(PSODFN,0),"^",9) W !,$C(7),?10,$P(^DPT(PSODFN,0),"^")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_") DIED "_$P(VADM(6),"^",2),!
"RTN","PSORXVW",37,0)
 .W "All Active Medications will be Autocanceled!",! H 2 S PSODEATH=1
"RTN","PSORXVW",38,0)
 .S ACOM="Date of Death "_$P(VADM(6),"^",2)_".",ZTRTN="CAN^PSOCAN3",ZTDESC="Outpatient Pharmacy Autocancel Due to Death of Patient",ZTSAVE("ACOM")="",ZTSAVE("PSODFN")="",ZTSAVE("PSODEATH")=""
"RTN","PSORXVW",39,0)
 .S ZTIO="",PSOCLC=DUZ,ZTSAVE("PSOCLC")="",ZTDTH=$H D ^%ZTLOAD K ACOM,ZTSK,PSODEATH
"RTN","PSORXVW",40,0)
 K ^TMP("PSOAL",$J),PCOMX,PDA,PHI,PRC,ACOM,ANS
"RTN","PSORXVW",41,0)
 S (DA,RXN)=PSOVDA K PSOVDA S RX0=^PSRX(RXN,0),RX2=$G(^(2)),RX3=$G(^(3)),ST=+$G(^("STA")),RXOR=$G(^("OR1"))
"RTN","PSORXVW",42,0)
 I 'RXOR,$P(^PSDRUG($P(RX0,"^",6),2),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG($P(RX0,"^",6),2),"^"),RXOR=$P(^PSDRUG($P(RX0,"^",6),2),"^")
"RTN","PSORXVW",43,0)
 S IEN=0,$P(RN," ",12)=" "
"RTN","PSORXVW",44,0)
 N APPND S APPND=$S($G(^PSRX(RXN,"IB")):"$",1:"")
"RTN","PSORXVW",45,0)
 I $$ECMENUM^PSOBPSU2(RXN)'="" S APPND=APPND_$$ECME^PSOBPSUT(RXN)_"  (ECME#: "_$$ECMENUM^PSOBPSU2(RXN)_")"
"RTN","PSORXVW",46,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$S($P($G(^PSRX(RXN,"TPB")),"^"):"            TPB Rx #: ",1:"                Rx #: ")_$P(RX0,"^")_APPND_$E(RN,$L($P(RX0,"^")_APPND)+1,12)
"RTN","PSORXVW",47,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="      Orderable Item: "_$S($D(^PS(50.7,$P(+RXOR,"^"),0)):$P(^PS(50.7,$P(+RXOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"No Pharmacy Orderable Item")
"RTN","PSORXVW",48,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$S($D(^PSDRUG("AQ",$P(RX0,"^",6))):"           CMOP ",1:"                ")_"Drug: "_$P(^PSDRUG($P(RX0,"^",6),0),"^")
"RTN","PSORXVW",49,0)
 S:$G(^PSRX(RXN,"TN"))]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Trade Name: "_$G(^PSRX(RXN,"TN"))
"RTN","PSORXVW",50,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="",$$RXRLDT^PSOBPSUT(RXN,0) D
"RTN","PSORXVW",51,0)
 . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                 NDC: "_$$GETNDC^PSONDCUT(RXN,0)
"RTN","PSORXVW",52,0)
 D DOSE^PSORXVW1
"RTN","PSORXVW",53,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Patient Instructions:" I $O(^PSRX(RXN,"INS1",0)) D
"RTN","PSORXVW",54,0)
 . F I=0:0 S I=$O(^PSRX(RXN,"INS1",I)) Q:'I  D
"RTN","PSORXVW",55,0)
 .. S MIG=^PSRX(RXN,"INS1",I,0)
"RTN","PSORXVW",56,0)
 .. D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",57,0)
 K MIG,SG
"RTN","PSORXVW",58,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  Other Pat. Instruc: "_$S($G(^PSRX(RXN,"INSS"))]"":^PSRX(RXN,"INSS"),1:"")
"RTN","PSORXVW",59,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                 SIG:"
"RTN","PSORXVW",60,0)
 I '$P($G(^PSRX(RXN,"SIG")),"^",2) D  G PTST
"RTN","PSORXVW",61,0)
 . S X=$P($G(^PSRX(RXN,"SIG")),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSORXVW",62,0)
 . D WORDWRAP^PSOUTLA2(SIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",63,0)
 S SIGOK=1
"RTN","PSORXVW",64,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  D
"RTN","PSORXVW",65,0)
 . S MIG=^PSRX(RXN,"SIG1",I,0)
"RTN","PSORXVW",66,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",67,0)
 S SIGOK=1 K MIG,SG
"RTN","PSORXVW",68,0)
PTST S $P(RN," ",25)=" ",PTST=$S($G(^PS(53,+$P(RX0,"^",3),0))]"":$P($G(^PS(53,+$P(RX0,"^",3),0)),"^"),1:""),IEN=IEN+1
"RTN","PSORXVW",69,0)
 S ^TMP("PSOAL",$J,IEN,0)="      Patient Status: "_PTST_$E(RN,$L(PTST)+1,25)
"RTN","PSORXVW",70,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Issue Date: "_$E($P(RX0,"^",13),4,5)_"/"_$E($P(RX0,"^",13),6,7)_"/"_$E($P(RX0,"^",13),2,3)
"RTN","PSORXVW",71,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                 Fill Date: "_$E($P(RX2,"^",2),4,5)_"/"_$E($P(RX2,"^",2),6,7)_"/"_$E($P(RX2,"^",2),2,3)
"RTN","PSORXVW",72,0)
 S ROU=$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW",73,0)
 S REFL=$P(RX0,"^",9),I=0 F  S I=$O(^PSRX(RXN,1,I)) Q:'I  S REFL=REFL-1,ROU=$S($P(^PSRX(RXN,1,I,0),"^",2)="W":"Window",1:"Mail")
"RTN","PSORXVW",74,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="      Last Fill Date: "_$E($P(RX3,"^"),4,5)_"/"_$E($P(RX3,"^"),6,7)_"/"_$E($P(RX3,"^"),2,3)
"RTN","PSORXVW",75,0)
  D CMOP^PSOORNE3 S DA=RXN
"RTN","PSORXVW",76,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_" ("_ROU_$S($G(PSOCMOP)]"":", "_PSOCMOP,1:"")_")" K ROU,PSOCMOP
"RTN","PSORXVW",77,0)
 S IEN=IEN+1 I $P(RX2,"^",15) S ^TMP("PSOAL",$J,IEN,0)="   Returned to Stock: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3)
"RTN","PSORXVW",78,0)
 E  S ^TMP("PSOAL",$J,IEN,0)="   Last Release Date: " D
"RTN","PSORXVW",79,0)
 .S RLD=$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:"")
"RTN","PSORXVW",80,0)
 .I $O(^PSRX(RXN,1,0)) F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  D
"RTN","PSORXVW",81,0)
 ..I $P(^PSRX(RXN,1,I,0),"^",18) S RLD=$E($P(^(0),"^",18),4,5)_"/"_$E($P(^(0),"^",18),6,7)_"/"_$E($P(^(0),"^",18),2,3)
"RTN","PSORXVW",82,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$S($G(RLD)]"":RLD,1:"        ")
"RTN","PSORXVW",83,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                     Lot #: "_$P(RX2,"^",4)
"RTN","PSORXVW",84,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Expires: "_$E($P(RX2,"^",6),4,5)_"/"_$E($P(RX2,"^",6),6,7)_"/"_$E($P(RX2,"^",6),2,3)
"RTN","PSORXVW",85,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                       MFG: "_$P($G(RX2),"^",8)
"RTN","PSORXVW",86,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Days Supply: "_$P(RX0,"^",8)_$S($L($P(RX0,"^",8))=1:" ",1:"")
"RTN","PSORXVW",87,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                        QTY"_$S($P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)]"":" ("_$P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)_")",1:" (  )")_": "_$P(RX0,"^",7)
"RTN","PSORXVW",88,0)
 I $P($G(^PSDRUG($P(RX0,"^",6),5)),"^")]"" D
"RTN","PSORXVW",89,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSORXVW",90,0)
 .S ^TMP("PSOAL",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^") K RN
"RTN","PSORXVW",91,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        # of Refills: "_$P(RX0,"^",9)_$S($L($P(RX0,"^",9))=1:" ",1:"")_"                       Remaining: "_REFL
"RTN","PSORXVW",92,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="            Provider: "_$S($D(^VA(200,$P(RX0,"^",4),0)):$P(^VA(200,$P(RX0,"^",4),0),"^"),1:"UNKNOWN")
"RTN","PSORXVW",93,0)
 I $P(RX3,"^",3) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,$P(RX3,"^",3),0),"^")
"RTN","PSORXVW",94,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Routing: "_$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW",95,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              Copies: "_$S($P(RX0,"^",18):$P(RX0,"^",18),1:1)
"RTN","PSORXVW",96,0)
 S:$P(RX0,"^",11)="W" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="    Method of Pickup: "_$G(^PSRX(RXN,"MP"))
"RTN","PSORXVW",97,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              Clinic: "_$S($D(^SC(+$P(RX0,"^",5),0)):$P(^SC($P(RX0,"^",5),0),"^"),1:"Not on File")
"RTN","PSORXVW",98,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="            Division: "_$P(^PS(59,$P(RX2,"^",9),0),"^")_" ("_$P(^(0),"^",6)_")"
"RTN","PSORXVW",99,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Pharmacist: "_$S($P(RX2,"^",3):$P(^VA(200,$P(RX2,"^",3),0),"^"),1:"")
"RTN","PSORXVW",100,0)
 S:$P(RX2,"^",10)&('$G(PSOCOPY)) IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Verified By: "_$P(^VA(200,$P(RX2,"^",10),0),"^")
"RTN","PSORXVW",101,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  Patient Counseling: "_$S($P($G(^PSRX(RXN,"PC")),"^"):"YES",1:"NO")_"                      "_$S($P($G(^PSRX(RXN,"PC")),"^"):"Was Counseling Understood: "_$S($P($G(^PSRX(RXN,"PC")),"^",2):"YES",1:"NO"),1:"")
"RTN","PSORXVW",102,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Remarks: "_$P(RX3,"^",7)
"RTN","PSORXVW",103,0)
 D PC^PSORXVW1
"RTN","PSORXVW",104,0)
 I $P($G(^PSRX(DA,"OR1")),"^",5) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Finished By: "_$P(^VA(200,$P(^PSRX(DA,"OR1"),"^",5),0),"^")
"RTN","PSORXVW",105,0)
 D ^PSORXVW1 S PSOAL=IEN K IEN,ACT,LBL,LOG
"RTN","PSORXVW",106,0)
 I ST<12,$P(RX2,"^",6)<DT S ST=11
"RTN","PSORXVW",107,0)
 S VALM("TITLE")="Rx View "_"("_$P("Error^Active^Non-Verified^Refill^Hold^Non-Verified^Suspended^^^^^Done^Expired^Discontinued^Deleted^Discontinued^Discontinued (Edit)^Provider Hold^","^",ST+2)_")"
"RTN","PSORXVW",108,0)
 S:$P($G(^PSRX(DA,"PKI")),"^") VALMSG="Digitally Signed Order"
"RTN","PSORXVW",109,0)
 D EN^PSOORAL,KILL G:PS="VIEW" PSORXVW
"RTN","PSORXVW",110,0)
 Q
"RTN","PSORXVW",111,0)
 ;
"RTN","PSORXVW",112,0)
KILL K ^TMP("PSOAL",$J),PSOAL,IEN,^TMP("PSOHDR",$J) K:PS="VIEW" DA
"RTN","PSORXVW",113,0)
 K ST,RFL,RFLL,RFL1,ST,II,J,N,PHYS,L1,DIRUT,PSDIV,PSEXDT,MED,M1,FFX,DTT,DAT,RX0,RX2,R3,RTN,SIG,STA,P1,PL,P0,Z0,Z1,EXDT,IFN,DIR,DUOUT,DTOUT,PSOELSE
"RTN","PSORXVW",114,0)
 K LBL,I,RFDATE,%H,%I,RN,RFT,%,%I,DFN,GMRA,GMRAL,HDR,POERR,PTST,REFL,RF,RLD,RX3
"RTN","PSORXVW",115,0)
 K RXN,RXOR,SG,VA,VADM,VAERR,VALMBCK,VAPA,X,DIC,REA,ZD,PSOHD,PSOBCK,PSODFN
"RTN","PSORXVW",116,0)
 Q
"RTN","PSOSULB1")
0^14^B25792932^B25215096
"RTN","PSOSULB1",1,0)
PSOSULB1 ;BHAM ISC/RTR,SAB-Print suspended labels  cont. ; 10/10/96
"RTN","PSOSULB1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,200,264**;DEC 1997;Build 19
"RTN","PSOSULB1",3,0)
DEV D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) DEV S PSOION=ION
"RTN","PSOSULB1",4,0)
 N X S X="PSXRSUS" X ^%ZOSF("TEST") G:($T)&($G(PSXSYS))&($D(^XUSEC("PSXCMOPMGR",DUZ)))&($D(^XUSEC("PSX XMIT",DUZ))) ^PSXRSUS
"RTN","PSOSULB1",5,0)
DEV1 I '$P(PSOPAR,"^",8) G START
"RTN","PSOSULB1",6,0)
 N PSOPROP,PFIO W $C(7),!!,"PROFILES MUST BE SENT TO PRINTER !!",! K IOP,%ZIS,IO("Q"),POP S %ZIS="MNQ",%ZIS("A")="Select PROFILE Device: " D ^%ZIS K %ZIS("A") G:POP EXIT^PSOSULBL G:$E(IOST)["C"!(PSOION=ION) DEV S PSOPROP=ION D ^%ZISC
"RTN","PSOSULB1",7,0)
START I $G(PSOCUTDT)']"" S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X,PSOPRPAS=$P(PSOPAR,"^",7)
"RTN","PSOSULB1",8,0)
ASK K ^TMP($J),PSOSU,PSOSUSPR S PFIOQ=0,PDUZ=DUZ W !
"RTN","PSOSULB1",9,0)
 S %DT="AEX",%DT("A")="Print labels through date: ",%DT("B")="TODAY" D ^%DT K %DT D:Y<0 MESS G:Y<0 EXIT^PSOSULBL S PRTDT=Y
"RTN","PSOSULB1",10,0)
 I '$O(^PS(52.5,"C",0))!($O(^(0))>PRTDT) W $C(7),!!,"NOTHING THRU DATE TO PRINT" G ASK
"RTN","PSOSULB1",11,0)
 W ! K DIR S DIR("A")="Sort by Patient Name, ID#, or DEA Special Handling",DIR(0)="SB^P:PATIENT NAME;I:IDENTIFICATION NUMBER;D:DEA SPECIAL HANDLING"
"RTN","PSOSULB1",12,0)
 S DIR("?")="Enter 'P' to sort the labels alphabetically by name, enter 'I' to sort by identification number, enter 'D' to sort by DEA Special Handling."
"RTN","PSOSULB1",13,0)
 S DIR("?",1)="Sorting by DEA Special Handling will print the labels in three groups. The",DIR("?",2)="first will contain labels with drugs marked with an A or C in the DEA Special"
"RTN","PSOSULB1",14,0)
 S DIR("?",3)="Handling field, indicating NARCOTICS AND ALCOHOLICS, and CONTROLLED SUBSTANCES-",DIR("?",4)="NON NARCOTIC. The second group will contain ones marked with an S, indicating"
"RTN","PSOSULB1",15,0)
 S DIR("?",5)="SUPPLY, and all others will print in the third group.",DIR("?",6)=""
"RTN","PSOSULB1",16,0)
 D ^DIR K DIR D:$D(DIRUT) MESS G:$D(DIRUT) EXIT^PSOSULBL S PSRT=$S(Y="D":"D",Y="P":1,1:0)
"RTN","PSOSULB1",17,0)
 I Y="D" W ! K DIR S DIR(0)="SB^P:PATIENT NAME;I:IDENTIFICATION NUMBER",DIR("A")="Within DEA Special Handling, sort by Patient Name or ID#" D ^DIR K DIR D:$D(DIRUT) MESS G:$D(DIRUT) EXIT^PSOSULBL S PSRTONE=Y
"RTN","PSOSULB1",18,0)
 S X1=PRTDT,X2=$P(PSOPAR,"^",27) D C^%DTC S XDATE=X K IOP,POP,IO("Q"),ZTSK
"RTN","PSOSULB1",19,0)
PRLBL W ! S %ZIS("A")="Printer 'LABEL' Device: ",%ZIS("B")="",%ZIS="MQN" D ^%ZIS S PSLION=ION I POP S IOP=PSOION D ^%ZIS D MESS G EXIT^PSOSULBL
"RTN","PSOSULB1",20,0)
 I $E(IOST)'["P" D MESSL G PRLBL
"RTN","PSOSULB1",21,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOSULB1",22,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",19)
"RTN","PSOSULB1",23,0)
 K PSOION D ^%ZISC I $D(IO("Q")) K IO("Q")
"RTN","PSOSULB1",24,0)
QUE K %DT,PSOTIME,PSOOUT D NOW^%DTC S %DT="REAX",%DT(0)=%,%DT("B")="NOW",%DT("A")="Queue to run at what time: " D ^%DT K %DT I $D(DTOUT)!(Y<0) D MESS G EXIT^PSOSULBL
"RTN","PSOSULB1",25,0)
 S (PSOSUSPR,PSODBQ)=1,PSOTIME=Y
"RTN","PSOSULB1",26,0)
 S ZTRTN="BEG^PSOSULBL",ZTDESC="PRINT LABELS FROM SUSPENSE",ZTIO=PSLION,ZTDTH=PSOTIME
"RTN","PSOSULB1",27,0)
 F G="PSOPAR","PSOSYS","PSOSUSPR","PSODBQ","PSRT","PSRTONE","PSOPROP","PSLION","PFIO","PSOBARS","PSODTCUT","PSOPRPAS","PRTDT","PDUZ","PSOBAR0","PSOBAR1","PSOSITE","XDATE","PSOTIME" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOSULB1",28,0)
 D ^%ZTLOAD W !!,"PRINT FROM SUSPENSE JOB QUEUED!",! D ^%ZISC G EXIT^PSOSULBL
"RTN","PSOSULB1",29,0)
 ;G:PSRT'="D" BEG^PSOSULBL
"RTN","PSOSULB1",30,0)
MESS W $C(7),!!?3,"NOTHING QUEUED TO PRINT!",! Q
"RTN","PSOSULB1",31,0)
MESSL W $C(7),!?3,"LABELS MUST BE SENT TO A PRINTER!",! Q
"RTN","PSOSULB1",32,0)
BAIMAIL     ;Send mail message
"RTN","PSOSULB1",33,0)
 S:'$G(PDUZ) PDUZ=+$G(DUZ)
"RTN","PSOSULB1",34,0)
 K ^TMP("PSOM",$J)
"RTN","PSOSULB1",35,0)
 N SEQ,XMY,XMDUZ,XMSUB,XMTEXT,SEQ,NAME,PSSN,RX,FILL,FIRST
"RTN","PSOSULB1",36,0)
 S SEQ=1
"RTN","PSOSULB1",37,0)
 S XMY(PDUZ)=""
"RTN","PSOSULB1",38,0)
 S XMY("G.PSO EXTERNAL DISPENSE ALERTS")=""
"RTN","PSOSULB1",39,0)
 S XMDUZ="OUTPATIENT PHARMACY PACKAGE"
"RTN","PSOSULB1",40,0)
 S XMSUB="BAD ADDRESS SUSPENSE NOT PRINTED"
"RTN","PSOSULB1",41,0)
 I $G(PSOSITE) S XMSUB=$$GET1^DIQ(59,PSOSITE,.06)_" "_XMSUB
"RTN","PSOSULB1",42,0)
 S ^TMP("PSOM",$J,SEQ)="The following prescriptions with a routing of mail were not printed/sent to",SEQ=SEQ+1
"RTN","PSOSULB1",43,0)
 S ^TMP("PSOM",$J,SEQ)="external interface due to the BAD ADDRESS INDICATOR being set and no active",SEQ=SEQ+1
"RTN","PSOSULB1",44,0)
 S ^TMP("PSOM",$J,SEQ)="temporary address, or the patient has an active MAIL status of DO NOT MAIL, or",SEQ=SEQ+1
"RTN","PSOSULB1",45,0)
 S ^TMP("PSOM",$J,SEQ)="the patient has a foreign address:",SEQ=SEQ+1
"RTN","PSOSULB1",46,0)
 S NAME="" F  S NAME=$O(^TMP("PSOSM",$J,NAME)) Q:NAME=""  D
"RTN","PSOSULB1",47,0)
 .S PSSN="" F  S PSSN=$O(^TMP("PSOSM",$J,NAME,PSSN)) Q:PSSN=""  D
"RTN","PSOSULB1",48,0)
 ..S ^TMP("PSOM",$J,SEQ)="",SEQ=SEQ+1
"RTN","PSOSULB1",49,0)
 ..S ^TMP("PSOM",$J,SEQ)=NAME_"   "_PSSN,FIRST=1
"RTN","PSOSULB1",50,0)
 ..S RX=0 F  S RX=$O(^TMP("PSOSM",$J,NAME,PSSN,RX)) Q:'RX  S FILL="" F  S FILL=$O(^TMP("PSOSM",$J,NAME,PSSN,RX,FILL)) Q:FILL=""  D
"RTN","PSOSULB1",51,0)
 ...I FIRST D  S FIRST=0
"RTN","PSOSULB1",52,0)
 ....S ^TMP("PSOM",$J,SEQ)=^TMP("PSOM",$J,SEQ)_"   ("_$G(^TMP("PSOSM",$J,NAME,PSSN,RX,FILL))_")"
"RTN","PSOSULB1",53,0)
 ....S SEQ=SEQ+1
"RTN","PSOSULB1",54,0)
 ...S ^TMP("PSOM",$J,SEQ)="  "_$P(^PSRX(RX,0),"^")_" ("_FILL_")  "_$P($G(^PSDRUG($P(^PSRX(RX,0),"^",6),0)),"^"),SEQ=SEQ+1
"RTN","PSOSULB1",55,0)
 S ^TMP("PSOM",$J,SEQ+1)=""
"RTN","PSOSULB1",56,0)
 S XMTEXT="^TMP(""PSOM"",$J," N DIFROM D ^XMD K XMSUB,XMTEXT,XMY,XMDUZ
"RTN","PSOSULB1",57,0)
 Q
"RTN","PSOSULB1",58,0)
 ;
"RTN","PSOSULBL")
0^15^B68549461^B64818200
"RTN","PSOSULBL",1,0)
PSOSULBL ;BHAM ISC/RTR,SAB-Print Suspended labels ;4/8/93
"RTN","PSOSULBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**139,173,174,148,200,260,264**;DEC 1997;Build 19
"RTN","PSOSULBL",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOSULBL",4,0)
 ;Reference to SAVNDC^PSSNDCUT supported by IA 4707
"RTN","PSOSULBL",5,0)
 ;Reference ^PSDRUG( supported by DBIA 221
"RTN","PSOSULBL",6,0)
 K PDUZ,REPRINT G ^PSOSULB1
"RTN","PSOSULBL",7,0)
BEG ;
"RTN","PSOSULBL",8,0)
 K PSORUNIN,PSORETRY N BPSCNT
"RTN","PSOSULBL",9,0)
 S PSORUNIN="PSOSUSP"_($G(PSOSITE))
"RTN","PSOSULBL",10,0)
 L +@PSORUNIN:10 I '$T D
"RTN","PSOSULBL",11,0)
 . F PSORETRY=1:1:120 L +@PSORUNIN:60 I $T Q  ;wait Max of 2 hrs before continue
"RTN","PSOSULBL",12,0)
 . Q
"RTN","PSOSULBL",13,0)
 K ^UTILITY($J,"PSOPRO"),^TMP("PSOSBAI",$J) S PSOSEQ=1 F DFN=0:0 S DFN=$O(^PS(52.5,"AC",DFN)) Q:'DFN  D  D:'PSRT PID^VADPT6 D CHKDEAD D:'DEAD&($G(PSOSFLAG)) PRT
"RTN","PSOSULBL",14,0)
 .S PSOSFLAG=0 F ZZ=0:0 S ZZ=$O(^PS(52.5,"AC",DFN,ZZ)) Q:'ZZ!$G(PSOSFLAG)  I ZZ'>PRTDT S PSOSFLAG=1
"RTN","PSOSULBL",15,0)
 D PPL
"RTN","PSOSULBL",16,0)
 D:$D(^UTILITY($J,"PSOPRO"))&($P(PSOPAR,"^",8)) PROF
"RTN","PSOSULBL",17,0)
 G EXIT
"RTN","PSOSULBL",18,0)
PRT F SDT=0:0 S SDT=$O(^PS(52.5,"AC",DFN,SDT)) D:SDT CHK Q:'SDT
"RTN","PSOSULBL",19,0)
 Q
"RTN","PSOSULBL",20,0)
EXIT ;
"RTN","PSOSULBL",21,0)
 I $D(^TMP("PSOSBAI",$J)) D CHKMAIL
"RTN","PSOSULBL",22,0)
 K ^TMP($J),^TMP("PSOSBAI",$J)
"RTN","PSOSULBL",23,0)
 I $D(PSORUNIN) L -@PSORUNIN
"RTN","PSOSULBL",24,0)
 D ^%ZISC
"RTN","PSOSULBL",25,0)
 K %,%ZIS,CNT,COM,DA,DEAD,DFN,DIRUT,DTTM,G,HDPPL,JJ,JJJ,JJJJ,PDUZ,IOP,ORD,PFIOQ,PSLION,PSRT,POP,PRF,PRTDT,PSLIO,PSNP,PSODBQ,PSOSEQ,PSOSFLAG,PSOSU,PSOTIME,PSOOUT,PSOPRFLG,PSOSEQ,PSOSUSPR,PSSPND,PST,PTL,PPLHLD,PSFNIEN,ZTSK
"RTN","PSOSULBL",26,0)
 K PSOBADDR,PSORUNIN,PSORETRY,PSRTONE,PSSRT,PSUSDEA,RF,RFCNT,RX,RXDFN,SDT,SFN,SREC,STOP,SUSPT,VADM,VAPA,X,X1,X2,XAK,XDATE,Y,Z,ZZ,WWW,PSDDDATE,SINRX,RXPR,RXPR1,GGGG,XXX,ZII,ZTDESC,ZTRTN,ZTSAVE,RRRR,RXRP,RXRP1,RXFL,SPR S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOSULBL",27,0)
CHK I SDT'>XDATE D TMP Q
"RTN","PSOSULBL",28,0)
 Q
"RTN","PSOSULBL",29,0)
TMP F SFN=0:0 S SFN=$O(^PS(52.5,"AC",DFN,SDT,SFN)) Q:'SFN  D
"RTN","PSOSULBL",30,0)
 . I '$D(^PS(52.5,SFN,0))!'$D(^DPT(+DFN,0)) Q
"RTN","PSOSULBL",31,0)
 . N RXSITE,PRINTED,PSDFN,RXSTS,RXIEN,RXFILL,PARTIAL,RXEXPDT,RESP
"RTN","PSOSULBL",32,0)
 . S RXIEN=+$$GET1^DIQ(52.5,SFN,.01,"I"),RXDFN=$$GET1^DIQ(52,RXIEN,2,"I")
"RTN","PSOSULBL",33,0)
 . S RXSTS=$$GET1^DIQ(52,RXIEN,100,"I"),RXSITE=+$$GET1^DIQ(52.5,SFN,.06,"I"),PRINTED=+$$GET1^DIQ(52.5,SFN,2,"I")
"RTN","PSOSULBL",34,0)
 . S PARTIAL=+$$GET1^DIQ(52.5,SFN,.05,"I"),RXEXPDT=$$GET1^DIQ(52,RXIEN,26,"I")
"RTN","PSOSULBL",35,0)
 . S RXFILL=$$GET1^DIQ(52.5,SFN,9,"I") I RXFILL="" S RXFILL=$$LSTRFL^PSOBPSU1(RXIEN)
"RTN","PSOSULBL",36,0)
 . I RXSITE=$G(PSOSITE),'PRINTED,RXDFN=DFN,RXSTS<9 D
"RTN","PSOSULBL",37,0)
 . . I PARTIAL,'$D(^PSRX(RXIEN,"P",PARTIAL)) Q
"RTN","PSOSULBL",38,0)
 . . I RXEXPDT<DT,RXSTS<11 D  Q
"RTN","PSOSULBL",39,0)
 . . . N RXREC S RXREC=RXIEN D EX^PSOSUTL
"RTN","PSOSULBL",40,0)
 . . . K DIE,DA S DIE=52,DA=RXIEN,DR="100///11" D ^DIE K DIE,DA
"RTN","PSOSULBL",41,0)
 . . . K DIK,DA S DA=SFN,DIK="^PS(52.5," D ^DIK K DIK,DA
"RTN","PSOSULBL",42,0)
 . . S PSOBADDR=0 D CHKBAI I PSOBADDR Q
"RTN","PSOSULBL",43,0)
 . . I PSRT="D" D
"RTN","PSOSULBL",44,0)
 . . . S PSSRT=$S($G(PSRTONE)="I":VA("PID"),1:$P(^DPT(DFN,0),"^")_$P(^(0),"^",9))
"RTN","PSOSULBL",45,0)
 . . . S PSUSDEA=$P($G(^PS(52.5,SFN,0)),"^",10)
"RTN","PSOSULBL",46,0)
 . . . S SRT=$S(PSUSDEA["A"!(PSUSDEA["C"):"A-"_PSSRT,PSUSDEA["S":"S-"_PSSRT,1:"Z-"_PSSRT)
"RTN","PSOSULBL",47,0)
 . . I PSRT'="D" D
"RTN","PSOSULBL",48,0)
 . . . S SRT=$S(PSRT:$P(^DPT(DFN,0),"^")_$P(^(0),"^",9),1:VA("PID"))
"RTN","PSOSULBL",49,0)
 . . ; - If not partial fill, sending Rx to ECME for 3rd Party billing
"RTN","PSOSULBL",50,0)
 . . I 'PARTIAL,$$RETRX^PSOBPSUT(RXIEN,RXFILL),SDT>DT Q
"RTN","PSOSULBL",51,0)
 . . I 'PARTIAL D  I $$FIND^PSOREJUT(RXIEN,RXFILL) Q
"RTN","PSOSULBL",52,0)
 . . . I $$FIND^PSOREJUT(RXIEN,RXFILL) Q
"RTN","PSOSULBL",53,0)
 . . . I '$$RETRX^PSOBPSUT(RXIEN,RXFILL),$$STATUS^PSOBPSUT(RXIEN,RXFILL)'="" Q
"RTN","PSOSULBL",54,0)
 . . . D ECMESND^PSOBPSU1(RXIEN,RXFILL,,"PL",,,,,,.RESP) I $D(RESP),'RESP S BPSCNT=$G(BPSCNT)+1
"RTN","PSOSULBL",55,0)
 . . S ^TMP($J,SRT,SFN)=RXIEN
"RTN","PSOSULBL",56,0)
 Q
"RTN","PSOSULBL",57,0)
PPL ; Wait some time before printing so response from 3rd party payers can be received
"RTN","PSOSULBL",58,0)
 I $G(BPSCNT)>0 H 60+$S((BPSCNT*15)>7200:7200,1:(BPSCNT*15))
"RTN","PSOSULBL",59,0)
 K PPL,PPL1 S ORD="" F  S ORD=$O(^TMP($J,ORD)) Q:ORD=""  D PPL1
"RTN","PSOSULBL",60,0)
 Q
"RTN","PSOSULBL",61,0)
PPL1 ; Printing Labels
"RTN","PSOSULBL",62,0)
 N PARTIAL,REPRINT,REFILL,Z,QUIT
"RTN","PSOSULBL",63,0)
 S (PSOPRFLG,SUSPT)=1 S:$D(PSOPROP) PFIO=PSOPROP
"RTN","PSOSULBL",64,0)
 S:'$D(PDUZ) PDUZ=DUZ K RXPR,RXPR1,PPL
"RTN","PSOSULBL",65,0)
 F SFN=0:0 S SFN=$O(^TMP($J,ORD,SFN)) Q:'SFN  D
"RTN","PSOSULBL",66,0)
 .I '$D(^PS(52.5,SFN,0)) Q
"RTN","PSOSULBL",67,0)
 .S Z=$G(^PS(52.5,SFN,0)),SINRX=+$P(Z,"^"),REFILL=+$P(Z,"^",13)
"RTN","PSOSULBL",68,0)
 .S PARTIAL=$P(Z,"^",5),REPRINT=$P(Z,"^",12)
"RTN","PSOSULBL",69,0)
 .; - Screening out OPEN/UNRESOLVED Rejects (3rd Party Payer) 
"RTN","PSOSULBL",70,0)
 .S QUIT=0
"RTN","PSOSULBL",71,0)
 .I 'PARTIAL,'REPRINT D  I QUIT Q
"RTN","PSOSULBL",72,0)
 ..I $$FIND^PSOREJUT(SINRX,REFILL) S QUIT=1 Q
"RTN","PSOSULBL",73,0)
 ..I $$STATUS^PSOBPSUT(SINRX,REFILL)="IN PROGRESS" S QUIT=1 Q
"RTN","PSOSULBL",74,0)
 ..I $$STATUS^PSOBPSUT(SINRX,REFILL)="E PAYABLE" D
"RTN","PSOSULBL",75,0)
 ...D SAVNDC^PSSNDCUT(+$$GET1^DIQ(52,SINRX,6,"I"),$$RXSITE^PSOBPSUT(SINRX,REFILL),$$GETNDC^PSONDCUT(SINRX,REFILL))
"RTN","PSOSULBL",76,0)
 .; 
"RTN","PSOSULBL",77,0)
 .I $L($G(PPL))<240 D
"RTN","PSOSULBL",78,0)
 ..S PPL=$P(^TMP($J,ORD,SFN),"^")_","_$G(PPL),RXPR(SINRX)=$P(^PS(52.5,SFN,0),"^",5)
"RTN","PSOSULBL",79,0)
 ..S:$P(^PS(52.5,SFN,0),"^",12) RXRP(SINRX)=1
"RTN","PSOSULBL",80,0)
 .E  D
"RTN","PSOSULBL",81,0)
 ..S PPL1=$P(^TMP($J,ORD,SFN),"^")_","_$G(PPL1),RXPR1(SINRX)=$P(^PS(52.5,SFN,0),"^",5)
"RTN","PSOSULBL",82,0)
 ..S:$P(^PS(52.5,SFN,0),"^",12) RXRP1(SINRX)=1
"RTN","PSOSULBL",83,0)
 .S DFN=$P(^PS(52.5,SFN,0),"^",3)
"RTN","PSOSULBL",84,0)
 .I $P(PSOPAR,"^",8),'$D(^PSRX($P(^PS(52.5,SFN,0),"^"),1)),'$G(RXPR(SINRX)),'$G(RXPR1(SINRX)) S PSOPRFLG=0
"RTN","PSOSULBL",85,0)
 S PSNP=$S($P(PSOPAR,"^",8):1,1:0)
"RTN","PSOSULBL",86,0)
 I $G(PPL) D
"RTN","PSOSULBL",87,0)
 .S PPLHLD=$G(PPL1),HDPPL=PPL K PPL1 S (PSODBQ,PSOSUSPR)=1
"RTN","PSOSULBL",88,0)
 .F GGGG=0:0 S GGGG=$O(RXPR(GGGG)) Q:'GGGG  K:'$G(RXPR(GGGG)) RXPR(GGGG)
"RTN","PSOSULBL",89,0)
 I $G(PPL) D DQ^PSOLBL,SEQ D:'$G(PSOPRFLG)
"RTN","PSOSULBL",90,0)
 .I $G(PSOPROP)'=$G(PSLION) S ^UTILITY($J,"PSOPRO",DFN)="" Q
"RTN","PSOSULBL",91,0)
 .D DQ^PSOPRFSS
"RTN","PSOSULBL",92,0)
 I $G(PPLHLD) K RXPR S (PPL,HDPPL)=PPLHLD,(PSODBQ,PSOSUSPR)=1,PSNP=0 S:'$D(PDUZ) PDUZ=DUZ F XXX=0:0 S XXX=$O(RXPR1(XXX)) Q:'XXX  S:$G(RXPR1(XXX)) RXPR(XXX)=RXPR1(XXX)
"RTN","PSOSULBL",93,0)
 I $G(PPLHLD) F RRRR=0:0 S RRRR=$O(RXRP1(RRRR)) Q:'RRRR  S:$D(RXRP1(RRRR)) RXRP(RRRR)=1
"RTN","PSOSULBL",94,0)
 I $G(PPLHLD) D DQ^PSOLBL,SEQ D:'$G(PSOPRFLG)
"RTN","PSOSULBL",95,0)
 .I $G(PSOPROP)'=$G(PSLION) S ^UTILITY($J,"PSOPRO",DFN)="" Q
"RTN","PSOSULBL",96,0)
 .D DQ^PSOPRFSS
"RTN","PSOSULBL",97,0)
 K PPL,PPL1,PPLHLD,RXPR,RXPR1,RXFL Q
"RTN","PSOSULBL",98,0)
SEQ ;
"RTN","PSOSULBL",99,0)
 S SQCOUNT=0 F JJJ=1:1:$L(HDPPL) S:$E(HDPPL,JJJ)="," SQCOUNT=SQCOUNT+1
"RTN","PSOSULBL",100,0)
 F JJJJ=1:1:SQCOUNT S PSFNIEN=$P(HDPPL,",",JJJJ) D:PSFNIEN
"RTN","PSOSULBL",101,0)
 .S PSFNIEN=$O(^PS(52.5,"B",PSFNIEN,0)) I PSFNIEN D
"RTN","PSOSULBL",102,0)
 ..S $P(^PS(52.5,PSFNIEN,0),"^",11)=PSOSEQ,PSOSEQ=PSOSEQ+1 S:$P(^PS(52.5,PSFNIEN,0),"^",8)&($P(^(0),"^",9))&($P(^(0),"^",6)) ^PS(52.5,"AS",$P(^PS(52.5,PSFNIEN,0),"^",8),$P(^(0),"^",9),$P(^(0),"^",6),$P(^(0),"^",11),PSFNIEN)=""
"RTN","PSOSULBL",103,0)
 Q
"RTN","PSOSULBL",104,0)
CHKDEAD D DEM^VADPT I VADM(1)="" S DEAD=0 Q
"RTN","PSOSULBL",105,0)
 I VADM(6)="" S DEAD=0 Q
"RTN","PSOSULBL",106,0)
 S PSDDDATE=$P(VADM(6),"^",2) F WWW=0:0 S WWW=$O(^PS(55,DFN,"P",WWW)) Q:'WWW  I $D(^PS(55,DFN,"P",WWW,0)),$P($G(^(0)),"^") S (DA,RXREC)=$P(^(0),"^") S SFN=$O(^PS(52.5,"B",RXREC,0)) I SFN,$D(^PS(52.5,SFN,0)) S RX=$P(^(0),"^") D DEAD
"RTN","PSOSULBL",107,0)
 Q
"RTN","PSOSULBL",108,0)
DEAD S $P(^PSRX(RX,"STA"),"^")=12,COM="Died ("_$G(PSDDDATE)_")",DA(1)=RX
"RTN","PSOSULBL",109,0)
 S DEAD=1 D ARECD^PSOSUTL S DIK="^PS(52.5,",DA=SFN D ^DIK K DIK
"RTN","PSOSULBL",110,0)
 Q
"RTN","PSOSULBL",111,0)
PROF ;
"RTN","PSOSULBL",112,0)
 S ZTRTN="PRPROF^PSOSULBL",ZTDESC="PRINT PROFILES FROM SUSPENSE",ZTDTH=$H,ZTIO=PSOPROP
"RTN","PSOSULBL",113,0)
 S ZTSAVE("^UTILITY($J,""PSOPRO"",")="",ZTSAVE("PSOPAR")="",ZTSAVE("PSODTCUT")="",ZTSAVE("PSOSITE")="",ZTSAVE("PSOPRPAS")="" D ^%ZTLOAD Q
"RTN","PSOSULBL",114,0)
PRPROF ;
"RTN","PSOSULBL",115,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"PSOPRO",LLL)) Q:'LLL  I $D(^DPT(LLL,0)) S DFN=LLL D DQ^PSOPRFSS
"RTN","PSOSULBL",116,0)
 K PSOPAR,PSODTCUT,PSOSITE,PSOPRPAS,LLL,DFN,^UTILITY($J,"PSOPRO") D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOSULBL",117,0)
 Q
"RTN","PSOSULBL",118,0)
 ;
"RTN","PSOSULBL",119,0)
CHKBAI ; IF BAD ADDRESS INDICATOR, NO ACTIVE TEMPORARY ADDRESS AND ROUTING OF MAIL, DO NOT SEND TO OPAI AND/OR DO NOT PRINT LABEL
"RTN","PSOSULBL",120,0)
 N PSOBADR,ACTSEQ,XX,PSOFIRST,ACTTYPE
"RTN","PSOSULBL",121,0)
 I '$G(RXFILL),$P(^PSRX(RXIEN,0),"^",11)="W" Q
"RTN","PSOSULBL",122,0)
 I $P($G(^PSRX(RXIEN,1,RXFILL,0)),"^",2)="W" Q
"RTN","PSOSULBL",123,0)
 S ACTTYPE="BAD ADDRESS INDICATOR"
"RTN","PSOSULBL",124,0)
 S PSOBADR=$$CHKRX^PSOBAI(RXIEN)
"RTN","PSOSULBL",125,0)
 ; GOOD PERMANENT OR TEMPORARY ADDRESS - CHECK FOR DO NOT MAIL
"RTN","PSOSULBL",126,0)
 I PSOBADR,'$P(PSOBADR,"^",2) D SETTMP(ACTTYPE) Q
"RTN","PSOSULBL",127,0)
 S NOMAIL=0 D NOMAIL I NOMAIL Q
"RTN","PSOSULBL",128,0)
 D FOREIGN
"RTN","PSOSULBL",129,0)
 Q
"RTN","PSOSULBL",130,0)
 ;
"RTN","PSOSULBL",131,0)
SETTMP(ACTTYPE) ;
"RTN","PSOSULBL",132,0)
 N ACTSEQ,XX,PSOFIRST,ZZ
"RTN","PSOSULBL",133,0)
 S PSOFIRST=1
"RTN","PSOSULBL",134,0)
 S PSOBADDR=1
"RTN","PSOSULBL",135,0)
 S ACTSEQ=0 F  S ACTSEQ=$O(^PSRX(RXIEN,"A",ACTSEQ)) Q:ACTSEQ=""  D
"RTN","PSOSULBL",136,0)
 .S XX=$G(^PSRX(RXIEN,"A",ACTSEQ,0)) I $P(XX,"^",2)="S" S ZZ=$P(XX,"^",4),ZZ=$S(ZZ<6:ZZ,1:ZZ-1) I ZZ=RXFILL,$P(XX,"^",5)["due to "_ACTTYPE S PSOFIRST=0 Q
"RTN","PSOSULBL",137,0)
 I PSOFIRST D
"RTN","PSOSULBL",138,0)
 .S ^TMP("PSOSBAI",$J,RXIEN,+RXFILL)=ACTTYPE
"RTN","PSOSULBL",139,0)
 .D ACT(ACTTYPE)
"RTN","PSOSULBL",140,0)
 Q
"RTN","PSOSULBL",141,0)
 ;
"RTN","PSOSULBL",142,0)
NOMAIL ; SEE IF FILE 55 STATUS IS DO NOT MAIL
"RTN","PSOSULBL",143,0)
 N ACTTYPE,DFN,MAILST,MAILEXP
"RTN","PSOSULBL",144,0)
 S ACTTYPE="DO NOT MAIL"
"RTN","PSOSULBL",145,0)
 S DFN=+$P($G(^PSRX(RXIEN,0)),"^",2),MAILST=$P($G(^PS(55,DFN,0)),"^",3) I MAILST'=2 Q
"RTN","PSOSULBL",146,0)
 S MAILEXP=$P(^PS(55,DFN,0),"^",5)
"RTN","PSOSULBL",147,0)
 I MAILEXP=""!(MAILEXP>DT) D SETTMP(ACTTYPE)
"RTN","PSOSULBL",148,0)
 Q
"RTN","PSOSULBL",149,0)
 ;
"RTN","PSOSULBL",150,0)
FOREIGN ;
"RTN","PSOSULBL",151,0)
 N ACTTYPE,DFN,PSOFORGN
"RTN","PSOSULBL",152,0)
 D ADD^VADPT
"RTN","PSOSULBL",153,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2) I PSOFORGN'="",PSOFORGN'["UNITED STATES" S PSOFORGN=1
"RTN","PSOSULBL",154,0)
 S ACTTYPE="FOREIGN ADDRESS"
"RTN","PSOSULBL",155,0)
 S DFN=+$P($G(^PSRX(RXIEN,0)),"^",2)
"RTN","PSOSULBL",156,0)
 I PSOFORGN D SETTMP(ACTYPE)
"RTN","PSOSULBL",157,0)
 Q
"RTN","PSOSULBL",158,0)
 ;
"RTN","PSOSULBL",159,0)
CHKMAIL ; SEE IF MAILMAN MESSAGE SHOULD BE SENT FOR BAI/MAIL ROUTING
"RTN","PSOSULBL",160,0)
 N RXIEN,RXFILL,ACTSEQ,XX,DFN,SSN,NAME,ACTTYPE,ZZ
"RTN","PSOSULBL",161,0)
 K ^TMP("PSOSM",$J)
"RTN","PSOSULBL",162,0)
 S RXIEN=0 F  S RXIEN=$O(^TMP("PSOSBAI",$J,RXIEN)) Q:'RXIEN  D
"RTN","PSOSULBL",163,0)
 .S RXFILL="" F  S RXFILL=$O(^TMP("PSOSBAI",$J,RXIEN,RXFILL)) Q:RXFILL=""  D
"RTN","PSOSULBL",164,0)
 ..S ACTTYPE=^TMP("PSOSBAI",$J,RXIEN,RXFILL)
"RTN","PSOSULBL",165,0)
 ..S ACTSEQ=0 F  S ACTSEQ=$O(^PSRX(RXIEN,"A",ACTSEQ)) Q:ACTSEQ=""  D
"RTN","PSOSULBL",166,0)
 ...S XX=$G(^PSRX(RXIEN,"A",ACTSEQ,0)) I $P(XX,"^",2)="S" S ZZ=$P(XX,"^",4),ZZ=$S(ZZ<6:ZZ,1:ZZ-1) I ZZ=RXFILL,$P(XX,"^",5)["due to "_ACTTYPE Q
"RTN","PSOSULBL",167,0)
 ...S DFN=$P(^PSRX(RXIEN,0),"^",2),NAME=$P(^DPT(DFN,0),"^"),SSN=$P(^(0),"^",9) I SSN="" S SSN=0
"RTN","PSOSULBL",168,0)
 ...S ^TMP("PSOSM",$J,NAME,SSN,RXIEN,RXFILL)=ACTTYPE
"RTN","PSOSULBL",169,0)
 I $D(^TMP("PSOSM",$J)) D BAIMAIL^PSOSULB1
"RTN","PSOSULBL",170,0)
 K ^TMP("PSOSM",$J)
"RTN","PSOSULBL",171,0)
 Q
"RTN","PSOSULBL",172,0)
 ;
"RTN","PSOSULBL",173,0)
ACT(ACTTYPE) ;adds activity info for rx not printed from suspense/not sent to OPAI
"RTN","PSOSULBL",174,0)
 N NOW,IR,FDA
"RTN","PSOSULBL",175,0)
 D NOW^%DTC S NOW=%
"RTN","PSOSULBL",176,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RXIEN,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOSULBL",177,0)
 S IR=IR+1,^PSRX(RXIEN,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOSULBL",178,0)
 S ^PSRX(RXIEN,"A",IR,0)=NOW_"^"_"S"_"^"_DUZ_"^"_$S(+RXFILL>5:RXFILL+1,1:+RXFILL)_"^"_"RX not printed from suspense due to "_ACTTYPE
"RTN","PSOSULBL",179,0)
 K PSUS,RXF,I,FDA,DIC,DIE,DR,Y,X,%,%I,%H,RSDT
"RTN","PSOSULBL",180,0)
 Q
"RTN","PSOSULBL",181,0)
 ;
"RTN","PSOSULOG")
0^19^B61735277^B47059064
"RTN","PSOSULOG",1,0)
PSOSULOG ;BHAM ISC/RTR-Log of prescriptions on suspense by day ; 11/18/92
"RTN","PSOSULOG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**18,264**;DEC 1997;Build 19
"RTN","PSOSULOG",3,0)
 I '$G(PSOSITE) D ^PSOLSET I '$G(PSOSITE) D WARN^PSOSUDCN Q
"RTN","PSOSULOG",4,0)
 K ^TMP($J,"PSOSPLOG") N BDATE,EDATE,GG,HDAT,HPAT,PII,LINE,NODE,PAGE,PAT,PATNAME,PATPTR,PDAT,PP,PSOSCMOP,PSOCNT,PSODATE,PSODATEX,PSOINRX,PSORT,PSPRINT,PSUSDIV,QFLAG,SIN,SINRX,X,Y,ZZ
"RTN","PSOSULOG",5,0)
LOG W ! K DIR S DIR("A")="Sort by Patient Name or SSN",DIR(0)="SB^P:PATIENT NAME;S:SOCIAL SECURITY NUMBER",DIR("B")="PATIENT NAME"
"RTN","PSOSULOG",6,0)
 S DIR("?")="Enter 'P' to sort by patient name, 'S' to sort by SSN, enter '^' to exit."
"RTN","PSOSULOG",7,0)
 D ^DIR K DIR D:$D(DIRUT) MESS G:$D(DIRUT) EXIT S PSORT=Y
"RTN","PSOSULOG",8,0)
DATE W ! K %DT S %DT="AEX",%DT("A")="Start Date: " D ^%DT K %DT G:Y=-1&(X'["^") DATE I X["^"!($D(DTOUT)) D MESS G EXIT
"RTN","PSOSULOG",9,0)
EDATE W ! S BDATE=$E(Y,1,7) S %DT(0)=BDATE,%DT="AEX",%DT("A")="End Date: " D ^%DT K %DT G:Y=-1&(X'["^") EDATE I X["^"!($D(DTOUT)) D MESS G EXIT
"RTN","PSOSULOG",10,0)
 S EDATE=$E(Y,1,7) W !
"RTN","PSOSULOG",11,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to see only those Rx's that have NOT yet been printed" D ^DIR K DIR D:$D(DIRUT) MESS G:Y["^"!($D(DIRUT)) EXIT S PSPRINT=$S(Y:1,1:0)
"RTN","PSOSULOG",12,0)
 S PSOCNT=0 F PII=0:0 S PII=$O(^PS(59,PII)) Q:'PII  S PSOCNT=PSOCNT+1
"RTN","PSOSULOG",13,0)
 I PSOCNT=1 G SKIP
"RTN","PSOSULOG",14,0)
 W !!?3,"You are logged in under the "_$P($G(^PS(59,+$G(PSOSITE),0)),"^")_" division.",!
"RTN","PSOSULOG",15,0)
 K DIR S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Print only those Rx's suspended for this division",DIR("?")="Enter 'Yes' to print only those Rx's for this division, enter 'No' to print Rx's suspended for all divisions."
"RTN","PSOSULOG",16,0)
 D ^DIR K DIR I Y["^"!($D(DIRUT)) D MESS G EXIT
"RTN","PSOSULOG",17,0)
 S PSUSDIV=Y
"RTN","PSOSULOG",18,0)
SKIP ;
"RTN","PSOSULOG",19,0)
 I '$G(PSXSYS) G SKIPC
"RTN","PSOSULOG",20,0)
 K DIR W ! S DIR(0)="Y",DIR("B")="N",DIR("A")="Do you want suspended CMOP Rx's included in this report" D ^DIR K DIR I Y["^"!($D(DIRUT)) D MESS G EXIT
"RTN","PSOSULOG",21,0)
 I $G(Y) S PSOSCMOP=1
"RTN","PSOSULOG",22,0)
SKIPC ;
"RTN","PSOSULOG",23,0)
 W ! K DIR S DIR("A")="Do you want this report to print in 80 or 132 column format: ",DIR("B")="132",DIR(0)="SAM^1:132;8:80" D ^DIR K DIR I Y["^"!($D(DIRUT)) D MESS G EXIT
"RTN","PSOSULOG",24,0)
 W ! S PSORMZ=$S(Y=1:1,1:0)
"RTN","PSOSULOG",25,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I POP D MESS G EXIT
"RTN","PSOSULOG",26,0)
 I $D(IO("Q")) S ZTRTN="REP^PSOSULOG",ZTDESC="Report is suspended Rx's" D  G EXIT
"RTN","PSOSULOG",27,0)
 .F GG="PSORMZ","PSOSITE","PSOPAR","PSORT","BDATE","EDATE","PSPRINT","PSUSDIV","PSOSCMOP" S:$D(@GG) ZTSAVE(GG)=""
"RTN","PSOSULOG",28,0)
 .D ^%ZTLOAD W !,"Task queued to print"
"RTN","PSOSULOG",29,0)
 G REP
"RTN","PSOSULOG",30,0)
EXIT ;
"RTN","PSOSULOG",31,0)
 K ^TMP($J,"PSOSPLOG") S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOSULOG",32,0)
 K BDATE,EDATE,GG,HDAT,HPAT,PII,LINE,NODE,PAGE,PAT,PATNAME,PATPTR,PDAT,PP,PSOBAD,PSOSCMOP,PSOCNT,PSODATE,PSODATEX,PSOINRX,PSORMZ,PSORT,PSPRINT,PSUSDIV,QFLAG,SIN,SINRX,X,Y,ZZ
"RTN","PSOSULOG",33,0)
 Q
"RTN","PSOSULOG",34,0)
MESS W !!,"No report printed!",!! Q
"RTN","PSOSULOG",35,0)
REP ;
"RTN","PSOSULOG",36,0)
 K ^TMP($J,"PSOSPLOG")
"RTN","PSOSULOG",37,0)
 U IO S $P(LINE,"-",$S($G(PSORMZ):130,1:79))=""
"RTN","PSOSULOG",38,0)
 S BDATE=BDATE-.0001,QFLAG=0,PAGE=1
"RTN","PSOSULOG",39,0)
 F ZZ=BDATE:0 S ZZ=$O(^PS(52.5,"C",ZZ)) Q:'ZZ!(ZZ>EDATE)  F SIN=0:0 S SIN=$O(^PS(52.5,"C",ZZ,SIN)) Q:'SIN  D
"RTN","PSOSULOG",40,0)
 .Q:'$P($G(^PS(52.5,SIN,0)),"^",3)
"RTN","PSOSULOG",41,0)
 .I $G(PSPRINT),$G(^PS(52.5,SIN,"P")) Q
"RTN","PSOSULOG",42,0)
 .I '$G(PSOSCMOP),$P($G(^PS(52.5,SIN,0)),"^",7)'="" Q
"RTN","PSOSULOG",43,0)
 .I $G(PSUSDIV),$G(PSOSITE)'=$P($G(^PS(52.5,SIN,0)),"^",6) Q
"RTN","PSOSULOG",44,0)
 .S PAT=+$P($G(^PS(52.5,SIN,0)),"^",3) I $P($G(^DPT(PAT,0)),"^")="" Q
"RTN","PSOSULOG",45,0)
 .I $P($G(^DPT(PAT,0)),"^",9)="",PSORT="S" Q
"RTN","PSOSULOG",46,0)
 .S ^TMP($J,"PSOSPLOG",ZZ,$S(PSORT="P":$P(^DPT(PAT,0),"^"),1:$P(^DPT(PAT,0),"^",9)),SIN)=SIN
"RTN","PSOSULOG",47,0)
 I $G(PSORMZ) G BIG
"RTN","PSOSULOG",48,0)
 I '$D(^TMP($J,"PSOSPLOG")) D HEAD W !!,"NO RECORDS TO PRINT",! D:$E(IOST)="C"  D ^%ZISC G EXIT
"RTN","PSOSULOG",49,0)
 .K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSOSULOG",50,0)
 S HPAT="",HDAT=""
"RTN","PSOSULOG",51,0)
 F PSODATE=0:0 S PSODATE=$O(^TMP($J,"PSOSPLOG",PSODATE)) Q:'PSODATE!($G(QFLAG))  S (Y,PDAT)=PSODATE D DD^%DT S PSODATEX=Y D HEAD S PAT="" F  S PAT=$O(^TMP($J,"PSOSPLOG",PSODATE,PAT)) Q:PAT=""!($G(QFLAG))  D
"RTN","PSOSULOG",52,0)
 .F SINRX=0:0 S SINRX=$O(^TMP($J,"PSOSPLOG",PSODATE,PAT,SINRX)) Q:'SINRX!($G(QFLAG))  D
"RTN","PSOSULOG",53,0)
 ..S NODE=$G(^PS(52.5,SINRX,0)),PATPTR=+$P(NODE,"^",3)
"RTN","PSOSULOG",54,0)
 ..I 'PATPTR Q
"RTN","PSOSULOG",55,0)
 ..S PATNAME=$P($G(^DPT(PATPTR,0)),"^") Q:PATNAME=""
"RTN","PSOSULOG",56,0)
 ..I $G(PSPRINT),$G(^PS(52.5,SINRX,"P")) Q
"RTN","PSOSULOG",57,0)
 ..I $G(PSUSDIV),$G(PSOSITE)'=$P(NODE,"^",6) Q
"RTN","PSOSULOG",58,0)
 ..I PAT'=HPAT!(HDAT'=PDAT) W !!?9,"Patient Name: "_$G(PATNAME) S HPAT=PAT,PDAT=HDAT
"RTN","PSOSULOG",59,0)
 ..D:($Y+4)>IOSL HEAD Q:$G(QFLAG)
"RTN","PSOSULOG",60,0)
 ..S PSOINRX=+$P($G(NODE),"^")
"RTN","PSOSULOG",61,0)
 ..W !,$P($G(^PSRX(+$G(NODE),0)),"^")
"RTN","PSOSULOG",62,0)
 ..W ?13,$P($G(^PSDRUG(+$P($G(^PSRX(PSOINRX,0)),"^",6),0)),"^")
"RTN","PSOSULOG",63,0)
 ..K PSOMW D
"RTN","PSOSULOG",64,0)
 ...I $P(NODE,"^",5) S PSOMW=$P($G(^PSRX(+$G(NODE),"P",$P(NODE,"^",5),0)),"^",2) Q
"RTN","PSOSULOG",65,0)
 ...I $P(NODE,"^",13)!($O(^PSRX(+$G(NODE),1,0))) D  Q
"RTN","PSOSULOG",66,0)
 ....I $P(NODE,"^",13) S PSOMW=$P($G(^PSRX(+$G(NODE),1,$P(NODE,"^",13),0)),"^",2) Q
"RTN","PSOSULOG",67,0)
 ....F PP=0:0 S PP=$O(^PSRX(+$G(NODE),1,PP)) Q:'PP  S PSOMW=$P($G(^PSRX(+$G(NODE),1,PP,0)),"^",2)
"RTN","PSOSULOG",68,0)
 ...S PSOMW=$P($G(^PSRX(+$G(NODE),0)),"^",11)
"RTN","PSOSULOG",69,0)
 ..W ?54,$G(PSOMW)
"RTN","PSOSULOG",70,0)
 ..S PSOPRINT=$S($G(^PS(52.5,SINRX,"P")):"YES",1:"NO")
"RTN","PSOSULOG",71,0)
 ..W ?56,PSOPRINT
"RTN","PSOSULOG",72,0)
 ..I PSOPRINT="NO" S PSOBAD="" D CHKBAD I PSOBAD'="" W ?62,PSOBAD
"RTN","PSOSULOG",73,0)
 ..I $G(PSOSCMOP),$P(NODE,"^",7)'="" D
"RTN","PSOSULOG",74,0)
 ...W ?64,$S($P(NODE,"^",7)="Q":"QUEUED/TRANS",$P(NODE,"^",7)="X":"TRANS/COMPLETE",$P(NODE,"^",7)="L":"LOADING/TRANS",$P(NODE,"^",7)="P":"PRINTED/LOCAL",1:"")
"RTN","PSOSULOG",75,0)
 I $E(IOST)'="P",'$G(QFLAG) W ! K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSOSULOG",76,0)
 W !,"NOTE: B=BAD ADDRESS INDICATOR  D=NO NOT MAIL  F=FOREIGN ADDRESS"
"RTN","PSOSULOG",77,0)
 W !,"** END OF REPORT **"
"RTN","PSOSULOG",78,0)
 D ^%ZISC G EXIT
"RTN","PSOSULOG",79,0)
HEAD ;
"RTN","PSOSULOG",80,0)
 I $E(IOST)'="P",PAGE K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S QFLAG=1 Q
"RTN","PSOSULOG",81,0)
 W @IOF W !?22,"RX SUSPENSE LIST "_$S($G(PSODATEX)'="":"FOR ",1:"")_$G(PSODATEX) W ?68,"PAGE: ",$G(PAGE) W !,"RX #",?13,"DRUG",?53,"MW",?56,"PRNT B/D/F",?66,$S($G(PSOSCMOP):"CMOP STATUS",1:"") W !,LINE S PAGE=PAGE+1
"RTN","PSOSULOG",82,0)
 Q
"RTN","PSOSULOG",83,0)
BIG ;
"RTN","PSOSULOG",84,0)
 N PSOPRINT
"RTN","PSOSULOG",85,0)
 I '$D(^TMP($J,"PSOSPLOG")) D HEADB W !!,"NO RECORDS TO PRINT",! D:$E(IOST)="C"  D ^%ZISC G EXIT
"RTN","PSOSULOG",86,0)
 .K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSOSULOG",87,0)
 F PSODATE=0:0 S PSODATE=$O(^TMP($J,"PSOSPLOG",PSODATE)) Q:'PSODATE!($G(QFLAG))  S Y=PSODATE D DD^%DT S PSODATEX=Y D:PAGE=1 HEADB D HEADND S PAT="" F  S PAT=$O(^TMP($J,"PSOSPLOG",PSODATE,PAT)) Q:PAT=""!($G(QFLAG))  D
"RTN","PSOSULOG",88,0)
 .F SINRX=0:0 S SINRX=$O(^TMP($J,"PSOSPLOG",PSODATE,PAT,SINRX)) Q:'SINRX!($G(QFLAG))  D
"RTN","PSOSULOG",89,0)
 ..S NODE=$G(^PS(52.5,SINRX,0)),PATPTR=+$P(NODE,"^",3)
"RTN","PSOSULOG",90,0)
 ..I 'PATPTR Q
"RTN","PSOSULOG",91,0)
 ..S PATNAME=$P($G(^DPT(PATPTR,0)),"^") Q:PATNAME=""
"RTN","PSOSULOG",92,0)
 ..I $G(PSPRINT),$G(^PS(52.5,SINRX,"P")) Q
"RTN","PSOSULOG",93,0)
 ..I $G(PSUSDIV),$G(PSOSITE)'=$P(NODE,"^",6) Q
"RTN","PSOSULOG",94,0)
 ..D:($Y+4)>IOSL HEADB Q:$G(QFLAG)
"RTN","PSOSULOG",95,0)
 ..S PSOINRX=+$P($G(NODE),"^")
"RTN","PSOSULOG",96,0)
 ..W !,$P($G(^PSRX(+$G(NODE),0)),"^")
"RTN","PSOSULOG",97,0)
 ..W ?13,$G(PATNAME)
"RTN","PSOSULOG",98,0)
 ..W ?45,$P($G(^PSDRUG(+$P($G(^PSRX(PSOINRX,0)),"^",6),0)),"^")
"RTN","PSOSULOG",99,0)
 ..K PSOMW D
"RTN","PSOSULOG",100,0)
 ...I $P(NODE,"^",5) S PSOMW=$P($G(^PSRX(+$G(NODE),"P",$P(NODE,"^",5),0)),"^",2) Q
"RTN","PSOSULOG",101,0)
 ...I $P(NODE,"^",13)!($O(^PSRX(+$G(NODE),1,0))) D  Q
"RTN","PSOSULOG",102,0)
 ....I $P(NODE,"^",13) S PSOMW=$P($G(^PSRX(+$G(NODE),1,$P(NODE,"^",13),0)),"^",2) Q
"RTN","PSOSULOG",103,0)
 ....F PP=0:0 S PP=$O(^PSRX(+$G(NODE),1,PP)) Q:'PP  S PSOMW=$P($G(^PSRX(+$G(NODE),1,PP,0)),"^",2)
"RTN","PSOSULOG",104,0)
 ...S PSOMW=$P($G(^PSRX(+$G(NODE),0)),"^",11)
"RTN","PSOSULOG",105,0)
 ..W ?88,$S($G(PSOMW)="W":"WINDOW",1:"MAIL")
"RTN","PSOSULOG",106,0)
 ..S PSOPRINT=$S($G(^PS(52.5,SINRX,"P")):"YES",1:"NO")
"RTN","PSOSULOG",107,0)
 ..W ?95,PSOPRINT
"RTN","PSOSULOG",108,0)
 ..I PSOPRINT="NO" S PSOBAD="" D CHKBAD I PSOBAD'="" W ?103,PSOBAD
"RTN","PSOSULOG",109,0)
 ..I $G(PSOSCMOP),$P(NODE,"^",7)'="" D
"RTN","PSOSULOG",110,0)
 ...W ?104,$S($P(NODE,"^",7)="Q":"QUEUED FOR TRANSMISSION",$P(NODE,"^",7)="X":"TRANSMISSION COMPLETED",$P(NODE,"^",7)="L":"LOADING FOR TRANSMISSION",$P(NODE,"^",7)="P":"PRINTED LOCALLY",1:"")
"RTN","PSOSULOG",111,0)
 I $E(IOST)'="P",'$G(QFLAG) W ! K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSOSULOG",112,0)
 W !,"NOTE: B=BAD ADDRESS INDICATOR  D=NO NOT MAIL  F=FOREIGN ADDRESS"
"RTN","PSOSULOG",113,0)
 W !,"** END OF REPORT **"
"RTN","PSOSULOG",114,0)
 D ^%ZISC G EXIT
"RTN","PSOSULOG",115,0)
HEADB ;
"RTN","PSOSULOG",116,0)
 I $E(IOST)'="P",PAGE K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S QFLAG=1 Q
"RTN","PSOSULOG",117,0)
 W @IOF
"RTN","PSOSULOG",118,0)
 W !,"RX #",?13,"PATIENT",?45,"DRUG",?88,"TYPE",?93,"PRINTED B/D/F",?108,$S($G(PSOSCMOP):"CMOP STATUS",1:""),?122,"PAGE ",$G(PAGE) W !,LINE S PAGE=PAGE+1
"RTN","PSOSULOG",119,0)
 Q
"RTN","PSOSULOG",120,0)
HEADND W !!?40,"RX SUSPENSE LIST "_$S($G(PSODATEX)'="":"FOR ",1:"")_$G(PSODATEX)
"RTN","PSOSULOG",121,0)
 Q
"RTN","PSOSULOG",122,0)
 ;
"RTN","PSOSULOG",123,0)
CHKADDR  ;
"RTN","PSOSULOG",124,0)
 N PSOBADR,PSOTEMP
"RTN","PSOSULOG",125,0)
 S PSOBADR=$$BADADR^DGUTL3(PSODFN)
"RTN","PSOSULOG",126,0)
 I PSOBADR D
"RTN","PSOSULOG",127,0)
 .S PSOTEMP=$$CHKTEMP^PSOBAI(PSODFN)
"RTN","PSOSULOG",128,0)
 I PSOBADR,'PSOTEMP S (PSOBAI,PSOBDF("B"))=1 Q
"RTN","PSOSULOG",129,0)
 Q
"RTN","PSOSULOG",130,0)
 ;
"RTN","PSOSULOG",131,0)
FOREIGN  ;
"RTN","PSOSULOG",132,0)
 N PSOFORGN,DFN
"RTN","PSOSULOG",133,0)
 S DFN=PSODFN D ADD^VADPT
"RTN","PSOSULOG",134,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2) I PSOFORGN'="",PSOFORGN'["UNITED STATES" S PSOBDF("F")=1
"RTN","PSOSULOG",135,0)
 Q
"RTN","PSOSULOG",136,0)
 ;
"RTN","PSOSULOG",137,0)
CHKMAIL  ;
"RTN","PSOSULOG",138,0)
 N PSOTEMP,MAILEXP
"RTN","PSOSULOG",139,0)
 S PSOTEMP=$G(^PS(55,PSODFN,0)) Q:$P(PSOTEMP,"^",3)'=2
"RTN","PSOSULOG",140,0)
 S MAILEXP=$P(PSOTEMP,"^",5) I MAILEXP=""!(MAILEXP>DT) S PSOBDF("D")=1
"RTN","PSOSULOG",141,0)
 Q
"RTN","PSOSULOG",142,0)
 ;
"RTN","PSOSULOG",143,0)
CHKBAD ;
"RTN","PSOSULOG",144,0)
 K PSOBDF
"RTN","PSOSULOG",145,0)
 S PSODFN=PATPTR
"RTN","PSOSULOG",146,0)
 D CHKADDR I $D(PSOBDF) S PSOBAD=$O(PSOBDF("")) K PSOBDF Q
"RTN","PSOSULOG",147,0)
 D CHKMAIL I $D(PSOBDF) S PSOBAD=$O(PSOBDF("")) K PSOBDF Q
"RTN","PSOSULOG",148,0)
 D FOREIGN I $D(PSOBDF) S PSOBAD=$O(PSOBDF("")) K PSOBDF Q
"RTN","PSOSULOG",149,0)
 Q
"RTN","PSOSULOG",150,0)
 ; CHANGE TO USE FOLLOWING IF WANT TO SEE WHY RX'S DID NOT PRINT PREVIOUSLY (INSTEAD OF CURRENT BAD STATUS)
"RTN","PSOSULOG",151,0)
 N RX,SEQ,FILL,ZZ
"RTN","PSOSULOG",152,0)
 S RX=+$G(NODE),FILL=$P(NODE,"^",13)
"RTN","PSOSULOG",153,0)
 S SEQ=0 F  S SEQ=$O(^PSRX(RX,"A",SEQ)) Q:'SEQ  S X=$G(^PSRX(RX,"A",SEQ,0)) D
"RTN","PSOSULOG",154,0)
 .I $P(X,"^",2)="S" S ZZ=$P(X,"^",4),ZZ=$S(ZZ<6:ZZ,1:ZZ-1) I ZZ=FILL,X["due to" D
"RTN","PSOSULOG",155,0)
 ..I X["DO NOT MAIL" S PSOBAD="D" Q
"RTN","PSOSULOG",156,0)
 ..I X["BAD ADDRESS" S PSOBAD="B" Q
"RTN","PSOSULOG",157,0)
 ..I X["FOREIGN ADDRESS" S PSOBAD="F" Q
"RTN","PSOSULOG",158,0)
 Q
"RTN","PSOSULOG",159,0)
 ;
"VER")
8.0^22.0
"^DD",52.43,52.43,5,0)
DATE PROCESSED^D^^0;5^S %DT="E" D ^%DT S X=Y K:3020101>X X
"^DD",52.43,52.43,5,1,0)
^.1
"^DD",52.43,52.43,5,1,1,0)
52.43^AD^MUMPS
"^DD",52.43,52.43,5,1,1,1)
S ^PS(52.43,"AD",X,DA)=""
"^DD",52.43,52.43,5,1,1,2)
K ^PS(52.43,"AD",X,DA)
"^DD",52.43,52.43,5,1,1,"DT")
3070615
"^DD",52.43,52.43,5,3)
TYPE A DATE NOT EARLIER THAN JAN 01, 2002
"^DD",52.43,52.43,5,21,0)
^^1^1^3030207^
"^DD",52.43,52.43,5,21,1,0)
This is the date the pharmacy processed the refill request.
"^DD",52.43,52.43,5,"DT")
3070615
"^DD",52.43,52.43,10,0)
REMARKS^F^^0;10^K:$L(X)>60!($L(X)<1) X
"^DD",52.43,52.43,10,3)
Answer must be 1-60 characters in length
"^DD",52.43,52.43,10,21,0)
^^2^2^3070828^
"^DD",52.43,52.43,10,21,1,0)
Refill # and suspended date if processed or the reason why it was not
"^DD",52.43,52.43,10,21,2,0)
processed.
"^DD",52.43,52.43,10,"DT")
3070828
"^DD",52.43,52.43,11,0)
LOGIN DATE^DX^^0;11^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",52.43,52.43,11,3)
(No range limit on date)
"^DD",52.43,52.43,11,21,0)
^^1^1^3070615^
"^DD",52.43,52.43,11,21,1,0)
This is the date MyHealtheVet placed the refill request.
"^DD",52.43,52.43,11,"DT")
3070615
"^DD",59,59,.111,0)
REFILL INACTIVE DRUG RXS^S^1:YES;0:NO;^1;11^Q
"^DD",59,59,.111,3)
Enter yes to allow refilling a prescription for a drug which is inactive.
"^DD",59,59,.111,21,0)
^^2^2^3070710^
"^DD",59,59,.111,21,1,0)
This will be used to determine if inactive drugs will be used to refill
"^DD",59,59,.111,21,2,0)
active prescriptions.
"^DD",59,59,.111,23,0)
^^1^1^3070710^^
"^DD",59,59,.111,23,1,0)
set of codes
"^DD",59,59,.111,"DT")
3070710
"^DD",59,59,2030,0)
PROCESS AUTO REFILLS FOR INPAT^S^1:YES;0:NO;^RF;1^Q
"^DD",59,59,2030,3)
Respond YES to have Rx refills, for an inpatient, processed by the scheduled Refill Automation job.
"^DD",59,59,2030,21,0)
^^4^4^3070625^
"^DD",59,59,2030,21,1,0)
This flag should be set to Yes, only if the site wants the scheduled 
"^DD",59,59,2030,21,2,0)
AUTO REFILL [PSO AUTO REFILL] option to process refills for patients
"^DD",59,59,2030,21,3,0)
who are currently an inpatient. The AUTO REFILL job defaults to NO unless
"^DD",59,59,2030,21,4,0)
the site has this flagged as YES.
"^DD",59,59,2030,"DT")
3070625
"^DD",59,59,2035,0)
PROCESS AUTO REFILLS FOR CNH^S^1:YES;0:NO;^RF;2^Q
"^DD",59,59,2035,3)
Respond YES to have Rx refills, for Contract Nursing Home (CNH) patient, processed by the scheduled Refill Automation job.
"^DD",59,59,2035,21,0)
^^4^4^3070625^
"^DD",59,59,2035,21,1,0)
This flag should be set to Yes, only if the site wants the scheduled
"^DD",59,59,2035,21,2,0)
AUTO REFILL [PSO AUTO REFILL] option to process refills for CNH patients.
"^DD",59,59,2035,21,3,0)
The AUTO REFILL job defaults to NO unless the site has this flagged as
"^DD",59,59,2035,21,4,0)
YES.
"^DD",59,59,2035,"DT")
3070625
"BLD",6280,6)
^241
**END**
**END**
