Released GMTS*2.7*24 SEQ #21
Extracted from mail message
**KIDS**:GMTS*2.7*24^

**INSTALL NAME**
GMTS*2.7*24
"BLD",636,0)
GMTS*2.7*24^HEALTH SUMMARY^0^^y
"BLD",636,1,0)
^^3^3^2971114^
"BLD",636,1,1,0)
This is Health Summary (GMTS) patch 24.  Please see the national patch
"BLD",636,1,2,0)
module for a complete description of the modifications included in this
"BLD",636,1,3,0)
patch.
"BLD",636,4,0)
^9.64PA^^
"BLD",636,"ABPKG")
n
"BLD",636,"KRN",0)
^9.67PA^19^18
"BLD",636,"KRN",.4,0)
.4
"BLD",636,"KRN",.401,0)
.401
"BLD",636,"KRN",.402,0)
.402
"BLD",636,"KRN",.403,0)
.403
"BLD",636,"KRN",.5,0)
.5
"BLD",636,"KRN",.84,0)
.84
"BLD",636,"KRN",3.6,0)
3.6
"BLD",636,"KRN",3.8,0)
3.8
"BLD",636,"KRN",9.2,0)
9.2
"BLD",636,"KRN",9.8,0)
9.8
"BLD",636,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",636,"KRN",9.8,"NM",1,0)
GMTS^^0^B22729825
"BLD",636,"KRN",9.8,"NM",2,0)
GMTS1^^0^B20215076
"BLD",636,"KRN",9.8,"NM","B","GMTS",1)

"BLD",636,"KRN",9.8,"NM","B","GMTS1",2)

"BLD",636,"KRN",19,0)
19
"BLD",636,"KRN",19.1,0)
19.1
"BLD",636,"KRN",101,0)
101
"BLD",636,"KRN",409.61,0)
409.61
"BLD",636,"KRN",771,0)
771
"BLD",636,"KRN",869.2,0)
869.2
"BLD",636,"KRN",870,0)
870
"BLD",636,"KRN",8994,0)
8994
"BLD",636,"KRN","B",.4,.4)

"BLD",636,"KRN","B",.401,.401)

"BLD",636,"KRN","B",.402,.402)

"BLD",636,"KRN","B",.403,.403)

"BLD",636,"KRN","B",.5,.5)

"BLD",636,"KRN","B",.84,.84)

"BLD",636,"KRN","B",3.6,3.6)

"BLD",636,"KRN","B",3.8,3.8)

"BLD",636,"KRN","B",9.2,9.2)

"BLD",636,"KRN","B",9.8,9.8)

"BLD",636,"KRN","B",19,19)

"BLD",636,"KRN","B",19.1,19.1)

"BLD",636,"KRN","B",101,101)

"BLD",636,"KRN","B",409.61,409.61)

"BLD",636,"KRN","B",771,771)

"BLD",636,"KRN","B",869.2,869.2)

"BLD",636,"KRN","B",870,870)

"BLD",636,"KRN","B",8994,8994)

"BLD",636,"QUES",0)
^9.62^^
"BLD",636,"REQB",0)
^9.611^1^1
"BLD",636,"REQB",1,0)
GMTS*2.7*16^1
"BLD",636,"REQB","B","GMTS*2.7*16",1)

"OER",187,0)
187^GMTS^0^^
"OER",187,1,0)
^100.9951PA^1^1
"OER",187,1,1,0)
2025
"OER",187,1,1,1,0)
^100.99511PA^3^3
"OER",187,1,1,1,1,0)
231
"OER",187,1,1,1,2,0)
229
"OER",187,1,1,1,3,0)
230
"PKG",187,-1)
1^1
"PKG",187,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",187,22,0)
^9.49I^1^1
"PKG",187,22,1,0)
2.7^2951020^2960308
"PKG",187,22,1,"PAH",1,0)
24^2980223^125
"PKG",187,22,1,"PAH",1,1,0)
^^3^3^2980325
"PKG",187,22,1,"PAH",1,1,1,0)
This is Health Summary (GMTS) patch 24.  Please see the national patch
"PKG",187,22,1,"PAH",1,1,2,0)
module for a complete description of the modifications included in this
"PKG",187,22,1,"PAH",1,1,3,0)
patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMTS")
0^1^B22729825
"RTN","GMTS",1,0)
GMTS ;SLC/DLT - Health Summary Main Routine ;2/18/98  13:23
"RTN","GMTS",2,0)
 ;;2.7;Health Summary;**16,24**;Oct 20, 1995
"RTN","GMTS",3,0)
 ; ACC/IHS/TPA 05/13/87
"RTN","GMTS",4,0)
MAIN ; Controls branching
"RTN","GMTS",5,0)
 ; GMTSPXGO & GMRANGE are set in 2 calling options, They aren't meant
"RTN","GMTS",6,0)
 ; to be used together.
"RTN","GMTS",7,0)
 I +$G(GMTSPXGO)'>0,$L($T(PATIENT^ORU1)),($$VERSION^XPDUTL("OR")>2.19) D MAIN^GMTSDVR Q
"RTN","GMTS",8,0)
 N DIROUT,DUOUT,ZTRTN,GMTSPX1,GMTSPX2,GMNAME,GMPSAP
"RTN","GMTS",9,0)
 S GMTSTYP=0 K DIC,DIROUT,DUOUT
"RTN","GMTS",10,0)
 S DIC("B")=$P($G(^GMT(142,+$G(^DISV(+$G(DUZ),"^GMT(142,")),0)),U)
"RTN","GMTS",11,0)
 F  Q:$D(DIROUT)!$D(DUOUT)  D SELTYP Q:GMTSTYP'>0!$D(DIROUT)!$D(DUOUT)  D
"RTN","GMTS",12,0)
 . N GMPAT,DFN,GMTSMULT
"RTN","GMTS",13,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DIROUT)!$D(DUOUT)!(+$D(GMPAT)'>0)
"RTN","GMTS",14,0)
 . . K GMPAT,DFN
"RTN","GMTS",15,0)
 . . F  Q:$D(DIROUT)  K GMPATT D SELPT Q:$D(DIROUT)!('$D(GMPATT))  S GMNAME="" F  S GMNAME=$O(GMPATT(GMNAME)) Q:GMNAME=""!$D(DIROUT)  F DFN=0:0 S DFN=$O(GMPATT(GMNAME,DFN)) Q:DFN=""  D  Q:$D(DIROUT)
"RTN","GMTS",16,0)
 . . . S (GMTSPX1,GMTSPX2)=""
"RTN","GMTS",17,0)
 . . . W !!,"For patient ",GMNAME," please answer the following."
"RTN","GMTS",18,0)
 . . . I +$G(GMTSPXGO)>0 D MENU^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1) I $G(GMTSPX1)']""!($G(GMTSPX2)']"") Q
"RTN","GMTS",19,0)
 . . . Q:$D(DIROUT)
"RTN","GMTS",20,0)
 . . . S GMPAT(GMNAME_(9999999-GMTSPX1),+DFN)=+DFN_U_$G(GMTSPX1)_U_$G(GMTSPX2)
"RTN","GMTS",21,0)
 . . Q:$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTS",22,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX1,.GMTSPX2) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTS",23,0)
 . . Q:$D(DIROUT)
"RTN","GMTS",24,0)
 . . D RESUB^GMTSDVR(.GMPAT)
"RTN","GMTS",25,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DTOUT)
"RTN","GMTS",26,0)
 . . S ZTRTN="PQ^GMTS"
"RTN","GMTS",27,0)
 . . D HSOUT^GMTSDVR,END W !
"RTN","GMTS",28,0)
 K GMTSTYP,GMTSTITL,GMTSEG,GMTSEGI,GMTSEGC,GMX,DFN,X,Y,I,GMP,GMPATT
"RTN","GMTS",29,0)
 Q
"RTN","GMTS",30,0)
SELTYP ; Select a Health Summary Type for printing
"RTN","GMTS",31,0)
 Q:GMTSTYP=-1  S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTS",32,0)
 D ^DIC K DIC S GMTSTYP=+Y,GMTSTITL=$S($D(^GMT(142,+Y,"T")):^("T"),1:"") S:GMTSTITL="" GMTSTITL=$P(Y,"^",2)
"RTN","GMTS",33,0)
 I GMTSTYP>0,$S($D(^GMT(142,GMTSTYP,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"This Summary Type includes no components...Please choose another." G SELTYP
"RTN","GMTS",34,0)
SELTYP1 ; Loop through HS Type and call LOADSEG to get each component record
"RTN","GMTS",35,0)
 K GMTSEG,GMTSEGI S (GMI,S1)=0 F  S S1=$O(^GMT(142,GMTSTYP,1,S1)) Q:'S1  S GMX=^(S1,0) D LOADSEG
"RTN","GMTS",36,0)
 S GMTSEGC=GMI K S1,S2,GMI
"RTN","GMTS",37,0)
 Q
"RTN","GMTS",38,0)
LOADSEG ; Load ENABLED COMPONENTS into GMTSEG array
"RTN","GMTS",39,0)
 S GMTS0=^GMT(142.1,$P(GMX,"^",2),0)
"RTN","GMTS",40,0)
 S GMI=GMI+1,GMTSEG(GMI)=GMX,GMTSEGI($P(GMX,U,2))=GMI D SELFILE
"RTN","GMTS",41,0)
 Q
"RTN","GMTS",42,0)
SELPT ; Select a patient for printing of Health Summary
"RTN","GMTS",43,0)
 N DUOUT K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PATIENT^ORU1(.GMP),PATCOPY^GMTSDVR(.GMP,.GMPATT)
"RTN","GMTS",44,0)
 Q
"RTN","GMTS",45,0)
SELFILE ; Loop through SELECTION ITEM multiple and load GMTSEG( with ITEMS
"RTN","GMTS",46,0)
 S S2=0 F  S S2=$O(^GMT(142,GMTSTYP,1,S1,1,S2)) Q:'S2  S ENTRY=^(S2,0),GMTSEG(GMI,+$P(@(U_$P(ENTRY,";",2)_"0)"),U,2),S2)=$P(ENTRY,";") I S2=1 S GMTSEG(GMI,+$P(@(U_$P(ENTRY,";",2)_"0)"),U,2),0)=U_$P(ENTRY,";",2)
"RTN","GMTS",47,0)
 Q
"RTN","GMTS",48,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTS",49,0)
 N DFN,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTS",50,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTS",51,0)
 N TRFAC,VAERR,VAIN
"RTN","GMTS",52,0)
 S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTS",53,0)
 . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTS",54,0)
 . I +$G(GMTSPXGO)>0 S GMTSPX1=$P($G(GMPAT(GMTJ)),U,2) D
"RTN","GMTS",55,0)
 . . S GMTSPX2=$P($G(GMPAT(GMTJ)),U,3)
"RTN","GMTS",56,0)
 . . I +GMTSPX1'>0!+GMTSPX2'>0 K GMTSPX1,GMTSPX2
"RTN","GMTS",57,0)
 . N GMDUOUT
"RTN","GMTS",58,0)
 . D EN^GMTS1
"RTN","GMTS",59,0)
 . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTS",60,0)
 . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTS",61,0)
 Q
"RTN","GMTS",62,0)
HSOUT ; Output Summary, with DEVICE handling
"RTN","GMTS",63,0)
 K ZTSK
"RTN","GMTS",64,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D EN^GMTS1 Q
"RTN","GMTS",65,0)
 K IOP S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTS",66,0)
 G:$D(IO("Q")) QUE
"RTN","GMTS",67,0)
NOQUE ; Print non-queued output to selected device
"RTN","GMTS",68,0)
 D EN^GMTS1
"RTN","GMTS",69,0)
 D ^%ZISC
"RTN","GMTS",70,0)
 Q
"RTN","GMTS",71,0)
QUE ; Call TaskMan to Queue output
"RTN","GMTS",72,0)
 K IO("Q"),ZTSAVE F %="DFN","GMTS*","ENTRY" S ZTSAVE(%)=""
"RTN","GMTS",73,0)
 S ZTRTN="EN^GMTS1",ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTS",74,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTS",75,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTS",76,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTS",77,0)
 Q
"RTN","GMTS",78,0)
END ; Clean up environmental variables and EXIT Health Summary
"RTN","GMTS",79,0)
 K %T,DIC,GMTS,GMTSLO,GMTSPNM,GMTSRB,GMTSWARD,GMTSDOB,DIC,X,Y,VA,VAIN,VAINDT,VADM,VAEL,VAPA,VAERR,GMTSSN,GMTS0,GMTS1,GMTS2
"RTN","GMTS",80,0)
 K GMTSAGE,GMTSTIM,GMTSEGN,GMTSEGH,GMTSEGL,GMTSHDR,GMTSNPG,GMTSPG,GMTSQIT,GMTSX,ENTRY,Z1,GMTSDTM,GMTSLOCK,GMTSLPG,SEX,POP,C,GMTSTOF
"RTN","GMTS",81,0)
 Q
"RTN","GMTS",82,0)
ENCWA ;Entry point printing components
"RTN","GMTS",83,0)
 ;GMTSPRM can be set to any component abbreviations except ones that 
"RTN","GMTS",84,0)
 ;require selection items. Needs to be valid component abbreviation 
"RTN","GMTS",85,0)
 ;from the "C" x-ref of File 142.1.
"RTN","GMTS",86,0)
 ;
"RTN","GMTS",87,0)
 ;call with DFN,GMTSPRM="CD,CN,CW,ADR",GMTSTITL="TITLE"
"RTN","GMTS",88,0)
 ;          GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTS",89,0)
 ;          GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTS",90,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTS",91,0)
 ;        is desired.
"RTN","GMTS",92,0)
 N GMI,GMJ,GMTSEG,GMTSEGI,GMTSEGC
"RTN","GMTS",93,0)
 S GMTS1="9999999",GMTS2="6666666",GMI=0,GMTSPNF=1
"RTN","GMTS",94,0)
 I '$D(GMTSPRM) W !,"The parameter GMTSPRM is undefined.",! Q
"RTN","GMTS",95,0)
 I '$D(GMTSTITL) W !,"The parameter GMTSTITL is undefined.",! Q
"RTN","GMTS",96,0)
 I '+$G(DFN) W !,"The parameter DFN is undefined.",! Q
"RTN","GMTS",97,0)
 F GMJ=1:1:$L(GMTSPRM,",") S ABB=$P(GMTSPRM,",",GMJ) D LOAD Q:GMJ=-1
"RTN","GMTS",98,0)
 S GMTSEGC=GMI K ABB,IFN
"RTN","GMTS",99,0)
 D EN^GMTS1
"RTN","GMTS",100,0)
 D END K GMTSEG,GMTSEGI,GMTSEGC,GMTSTITL,GMTSPRM,GMTSPNF
"RTN","GMTS",101,0)
 Q
"RTN","GMTS",102,0)
LOAD ; Load GMTSEG() using GMTSPRM abbreviations
"RTN","GMTS",103,0)
 S IFN=$O(^GMT(142.1,"C",ABB,"")) Q:IFN=""
"RTN","GMTS",104,0)
 S GMI=GMI+1,GMTSEG(GMI)=GMI_"^"_IFN,GMTSEGI(IFN)=GMI
"RTN","GMTS",105,0)
 Q
"RTN","GMTS1")
0^2^B20215076
"RTN","GMTS1",1,0)
GMTS1 ;SLC/DLT,JER - Health Summary Driver ;3/25/98  10:35
"RTN","GMTS1",2,0)
 ;;2.7;Health Summary;**7,16,24**;Oct 20, 1995
"RTN","GMTS1",3,0)
EN ; ***** ENTRY TO GENERATE A SUMMARY
"RTN","GMTS1",4,0)
 ; ***** REQUIRES DFN,GMTSTITL,GMTSEG(),GMTSEGI(),GMTSEGC,DUZ(2)
"RTN","GMTS1",5,0)
 ; ***** $I & IO MUST BE VALID, CALLER MUST CLOSE OUTPUT DEVICE
"RTN","GMTS1",6,0)
 ;
"RTN","GMTS1",7,0)
START ;
"RTN","GMTS1",8,0)
 N GMSUPRES,GMTSICF,GMTSPXD1,GMTSPXD2,GMTSBEG,GMTSEND
"RTN","GMTS1",9,0)
 S GMSUPRES=$P($G(^GMT(142,+$G(GMTSTYP),0)),U,5)
"RTN","GMTS1",10,0)
 U IO S GMTSLO=3,GMTSLPG=0
"RTN","GMTS1",11,0)
 D DEM^GMTSU
"RTN","GMTS1",12,0)
 W:$E(IOST)="C" @IOF D OUTPUT
"RTN","GMTS1",13,0)
 K GMTSCVD,GMTSCKP,GMTSNPG,GMTSPG,GMTSQIT,GMTSHDR,GMTSHD2,GMTSBRK,GMTSLCMP,GMTSDTC
"RTN","GMTS1",14,0)
 K GMTSEGN,GMTSE,GMTSEGR,GMTSEQ,GMTSEGH,GMTSEGL,GMTSDLM,GMTSDLS,GMTSNDM,GMTSN,GMTSQ
"RTN","GMTS1",15,0)
 Q
"RTN","GMTS1",16,0)
 ;
"RTN","GMTS1",17,0)
OUTPUT ; Loop through GMTSEG()
"RTN","GMTS1",18,0)
 D NOW^%DTC S X=% D REGDTM^GMTSU S GMTSDTM=X
"RTN","GMTS1",19,0)
 I +$G(GMTSPX1)&+$G(GMTSPX2) D  ;Allows date range for data
"RTN","GMTS1",20,0)
 . S GMTS2=9999999-$P(GMTSPX2,"."),GMTS1=9999999-$P(GMTSPX1,".")-.24
"RTN","GMTS1",21,0)
 . ;For GMTS1 want to get everything till Midnight
"RTN","GMTS1",22,0)
 . S X=GMTSPX1 D REGDT^GMTSU S GMTSPXD1=X
"RTN","GMTS1",23,0)
 . S X=GMTSPX2 D REGDT^GMTSU S GMTSPXD2=X
"RTN","GMTS1",24,0)
 D HEADER^GMTSUP
"RTN","GMTS1",25,0)
 K GMTSQIT S GMTSEGN=""
"RTN","GMTS1",26,0)
 F  S GMTSEGN=$O(GMTSEG(GMTSEGN)) Q:GMTSEGN=""  K GMTSQIT S GMTSEQ=$P(GMTSEG(GMTSEGN),U,1),GMTSE=$P(GMTSEG(GMTSEGN),U,2) D SEGMNT D:GMTSEGN=GMTSEGC LASTPG I $D(GMTSQIT),(GMTSQIT="") Q
"RTN","GMTS1",27,0)
 S GMTSHDR=$E(GMTSHDR,1,3)_" END "_$E(GMTSHDR,9,79)
"RTN","GMTS1",28,0)
 W:$E(IOST)'="C" !,GMTSHDR,!
"RTN","GMTS1",29,0)
 H:$E(IOST)="C" 1
"RTN","GMTS1",30,0)
 W:'+$G(GMPSAP) @IOF
"RTN","GMTS1",31,0)
 I $D(GMTSQIT) D EXIT
"RTN","GMTS1",32,0)
 Q
"RTN","GMTS1",33,0)
 ;
"RTN","GMTS1",34,0)
LASTPG ;ALLOWS USER TO BRANCH TO AN EARLIER COMPONENT ON THE LAST PAGE
"RTN","GMTS1",35,0)
 Q:$E(IOST)'="C"!(IOT="HFS")!$D(GMTSQIT)
"RTN","GMTS1",36,0)
 I +$G(GMPSAP),IOSL>998,$G(GMPAT(+$O(GMPAT(0),-1)))'=DFN Q
"RTN","GMTS1",37,0)
 ; Don't do footer when IOSL > 998 and action profile is printed.
"RTN","GMTS1",38,0)
 I IOSL>998,+$G(GMPSAP) Q
"RTN","GMTS1",39,0)
 ; Don't do footer when IOSL > 998 and this isn't the last patient.
"RTN","GMTS1",40,0)
 I IOSL>998,$G(GMPAT(+$O(GMPAT(""),-1)))'=$G(DFN) Q
"RTN","GMTS1",41,0)
 F I=$Y:1:$S((IOSL-GMTSLO)'>64:(IOSL-GMTSLO),1:(24-GMTSLO)) W !
"RTN","GMTS1",42,0)
 I $D(GMTSQIT),(GMTSQIT>0) K GMTSQIT
"RTN","GMTS1",43,0)
 S GMTSLPG=1 D CKP^GMTSUP
"RTN","GMTS1",44,0)
 Q
"RTN","GMTS1",45,0)
 ;
"RTN","GMTS1",46,0)
EXIT K ZTSK
"RTN","GMTS1",47,0)
 Q
"RTN","GMTS1",48,0)
 ;
"RTN","GMTS1",49,0)
SEGMNT ; OUTPUT A COMPONENT TYPE
"RTN","GMTS1",50,0)
 N GMTSLOCK,GMTSDBL,GMOOTXT,GMPXICDF,GMPXHLOC,GMPXNARR,GMTSWRIT,GMSEL
"RTN","GMTS1",51,0)
 I $D(GMTSQIT),(GMTSQIT]"") K GMTSQIT
"RTN","GMTS1",52,0)
 S X=^GMT(142.1,GMTSE,0),GMTSEGH=$S($P(X,U,4)]"":$P(X,U,4)_" - ",1:"")_$S($P(GMTSEG(GMTSEGN),U,5)]"":$P(GMTSEG(GMTSEGN),U,5),$P(X,U,9)]"":$P(X,U,9),1:" "_$P(X,U,1)),GMTSEGR=$P(X,"^",2) Q:GMTSEGR=""
"RTN","GMTS1",53,0)
 S GMTSLOCK=$P(X,U,7)
"RTN","GMTS1",54,0)
 S GMTSDBL=$P(X,U,6),GMOOTXT=$P(X,U,8)
"RTN","GMTS1",55,0)
 S GMPXHLOC=$P(GMTSEG(GMTSEGN),U,6),GMPXNARR=$P(GMTSEG(GMTSEGN),U,8)
"RTN","GMTS1",56,0)
 S GMPXICDF=$P(GMTSEG(GMTSEGN),U,7)
"RTN","GMTS1",57,0)
 S GMTSNDM=$P(GMTSEG(GMTSEGN),U,3),GMTSDLM=$P(GMTSEG(GMTSEGN),U,4) S:GMTSNDM="" GMTSNDM=-1
"RTN","GMTS1",58,0)
 S:+$G(GMTSPX1)&+$G(GMTSPX2) GMTSDLM="" ;Allows date range for data
"RTN","GMTS1",59,0)
 S GMTSDLS=""
"RTN","GMTS1",60,0)
 I GMTSDLM?1N.N!(GMTSDLM?1N.N1"D") S GMTSDLS=+GMTSDLM_" day"
"RTN","GMTS1",61,0)
 S:GMTSDLM?1N.N1"W" GMTSDLS=+GMTSDLM_" week",GMTSDLM=+GMTSDLM*7
"RTN","GMTS1",62,0)
 S:GMTSDLM?1N.N1"M" GMTSDLS=+GMTSDLM_" month",GMTSDLM=+GMTSDLM*30.4
"RTN","GMTS1",63,0)
 S:GMTSDLM?1N.N1"Y" GMTSDLS=+GMTSDLM_" year",GMTSDLM=+GMTSDLM*365.25
"RTN","GMTS1",64,0)
 S GMTSDLM=+GMTSDLM
"RTN","GMTS1",65,0)
 S:+GMTSDLS>1 GMTSDLS=GMTSDLS_"s"
"RTN","GMTS1",66,0)
 S GMTSEGL="" I GMTSNDM>0!(GMTSDLM>0) S GMTSEGL=" (max "_$S(GMTSNDM>0:GMTSNDM_$S(GMTSNDM=1:" occurrence",1:" occurrences")_$S(GMTSDLM>0:" or ",1:""),1:"")_$S(GMTSDLM>0:GMTSDLS,1:"")_")"
"RTN","GMTS1",67,0)
 K GMTSDLS,GMTSN
"RTN","GMTS1",68,0)
 D NOW^%DTC S GMTSDTC=%,DT=$P(%,".") K %,%H,%I
"RTN","GMTS1",69,0)
 I +$G(GMTSPX1)'>0!(+$G(GMTSPX2)'>0) D  ;Use date range unless variables empty
"RTN","GMTS1",70,0)
 . I GMTSDLM'>0 S (GMTS2,GMTSDLM)=9999999,GMTS1=6666666 ;GMTS1=MOST RECENT INVERTED DATE,GMTS2=TO DATE IN PAST IN INVERTED FORMAT
"RTN","GMTS1",71,0)
 . E  S X1=GMTSDTC,X2=-GMTSDLM D C^%DTC S GMTSDLM=9999999-X,GMTS2=GMTSDLM,GMTS1=9999999-(GMTSDTC+.0001) K X1,X2
"RTN","GMTS1",72,0)
 ;Set GMTSBEG to be GMTS2 uninverted
"RTN","GMTS1",73,0)
 S GMTSBEG=$S(GMTS2=9999999:1,1:9999999-GMTS2)
"RTN","GMTS1",74,0)
 ;Set GMTSEND to be GMTS1 uninverted
"RTN","GMTS1",75,0)
 S GMTSEND=$S(GMTS1=6666666:9999999,1:$P(9999999-GMTS1,".")_".235959")
"RTN","GMTS1",76,0)
 S GMTSWRIT=1 ;Variable is used to print component heading on 1st write
"RTN","GMTS1",77,0)
 I GMTSDBL]"",("PT"[GMTSDBL) D  Q
"RTN","GMTS1",78,0)
 . D:GMTSDBL="T" TDISBLD^GMTS2
"RTN","GMTS1",79,0)
 . D:GMTSDBL="P"&$D(GMTSPRM) PDISBLD^GMTS2
"RTN","GMTS1",80,0)
 I GMTSLOCK]"",('$D(^XUSEC(GMTSLOCK,DUZ))) D NOMATCH^GMTS2 Q
"RTN","GMTS1",81,0)
 S GMSEL=$P($G(^GMT(142.1,GMTSE,1,1,0)),U)
"RTN","GMTS1",82,0)
 I GMSEL]"",$O(GMTSEG(GMTSEGN,GMSEL,0))'>0 D NOSELECT^GMTS2 Q
"RTN","GMTS1",83,0)
 S GMTSNPG=0
"RTN","GMTS1",84,0)
 D @($P(GMTSEGR,";",1)_U_$P(GMTSEGR,";",2))
"RTN","GMTS1",85,0)
 D NODATA^GMTS2
"RTN","GMTS1",86,0)
 K GMTSDLM
"RTN","GMTS1",87,0)
 Q
"VER")
8.0^21.0
**END**
**END**
