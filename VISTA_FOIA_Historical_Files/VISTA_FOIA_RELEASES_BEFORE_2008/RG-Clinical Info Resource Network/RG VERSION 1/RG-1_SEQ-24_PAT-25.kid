Released RG*1*25 SEQ #24
Extracted from mail message
**KIDS**:RG*1.0*25^

**INSTALL NAME**
RG*1.0*25
"BLD",1495,0)
RG*1.0*25^CLINICAL INFO RESOURCE NETWORK^0^3020607^y
"BLD",1495,1,0)
^^3^3^3020607^
"BLD",1495,1,1,0)
REMOTE PROCEDURE CALLS AND MISC. FIXES
"BLD",1495,1,2,0)
Refer to patch RG*1*25 in the FORUM Patch Module for a complete
"BLD",1495,1,3,0)
description.
"BLD",1495,4,0)
^9.64PA^^
"BLD",1495,"ABNS",0)
^9.66A^^
"BLD",1495,"ABPKG")
^^
"BLD",1495,"KRN",0)
^9.67PA^8989.52^19
"BLD",1495,"KRN",.4,0)
.4
"BLD",1495,"KRN",.401,0)
.401
"BLD",1495,"KRN",.402,0)
.402
"BLD",1495,"KRN",.403,0)
.403
"BLD",1495,"KRN",.5,0)
.5
"BLD",1495,"KRN",.84,0)
.84
"BLD",1495,"KRN",3.6,0)
3.6
"BLD",1495,"KRN",3.8,0)
3.8
"BLD",1495,"KRN",9.2,0)
9.2
"BLD",1495,"KRN",9.8,0)
9.8
"BLD",1495,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",1495,"KRN",9.8,"NM",1,0)
RGMTRUN^^0^B3744868
"BLD",1495,"KRN",9.8,"NM",2,0)
RGMTHFS^^0^B11483785
"BLD",1495,"KRN",9.8,"NM",3,0)
RGACTIV^^0^B1923961
"BLD",1495,"KRN",9.8,"NM",4,0)
RGEX04^^0^B5291421
"BLD",1495,"KRN",9.8,"NM",5,0)
RGFIU^^0^B35548191
"BLD",1495,"KRN",9.8,"NM",6,0)
RGSYSTAT^^0^B38593850
"BLD",1495,"KRN",9.8,"NM",7,0)
RGHLLOG^^0^B22489044
"BLD",1495,"KRN",9.8,"NM","B","RGACTIV",3)

"BLD",1495,"KRN",9.8,"NM","B","RGEX04",4)

"BLD",1495,"KRN",9.8,"NM","B","RGFIU",5)

"BLD",1495,"KRN",9.8,"NM","B","RGHLLOG",7)

"BLD",1495,"KRN",9.8,"NM","B","RGMTHFS",2)

"BLD",1495,"KRN",9.8,"NM","B","RGMTRUN",1)

"BLD",1495,"KRN",9.8,"NM","B","RGSYSTAT",6)

"BLD",1495,"KRN",19,0)
19
"BLD",1495,"KRN",19.1,0)
19.1
"BLD",1495,"KRN",101,0)
101
"BLD",1495,"KRN",409.61,0)
409.61
"BLD",1495,"KRN",771,0)
771
"BLD",1495,"KRN",870,0)
870
"BLD",1495,"KRN",8989.51,0)
8989.51
"BLD",1495,"KRN",8989.52,0)
8989.52
"BLD",1495,"KRN",8994,0)
8994
"BLD",1495,"KRN",8994,"NM",0)
^9.68A^2^2
"BLD",1495,"KRN",8994,"NM",1,0)
RG REMOTE HL7 TASK^^0
"BLD",1495,"KRN",8994,"NM",2,0)
RG REM ACTIVITY^^0
"BLD",1495,"KRN",8994,"NM","B","RG REM ACTIVITY",2)

"BLD",1495,"KRN",8994,"NM","B","RG REMOTE HL7 TASK",1)

"BLD",1495,"KRN","B",.4,.4)

"BLD",1495,"KRN","B",.401,.401)

"BLD",1495,"KRN","B",.402,.402)

"BLD",1495,"KRN","B",.403,.403)

"BLD",1495,"KRN","B",.5,.5)

"BLD",1495,"KRN","B",.84,.84)

"BLD",1495,"KRN","B",3.6,3.6)

"BLD",1495,"KRN","B",3.8,3.8)

"BLD",1495,"KRN","B",9.2,9.2)

"BLD",1495,"KRN","B",9.8,9.8)

"BLD",1495,"KRN","B",19,19)

"BLD",1495,"KRN","B",19.1,19.1)

"BLD",1495,"KRN","B",101,101)

"BLD",1495,"KRN","B",409.61,409.61)

"BLD",1495,"KRN","B",771,771)

"BLD",1495,"KRN","B",870,870)

"BLD",1495,"KRN","B",8989.51,8989.51)

"BLD",1495,"KRN","B",8989.52,8989.52)

"BLD",1495,"KRN","B",8994,8994)

"BLD",1495,"QUES",0)
^9.62^^
"BLD",1495,"REQB",0)
^9.611^2^2
"BLD",1495,"REQB",1,0)
RG*1.0*13^2
"BLD",1495,"REQB",2,0)
RG*1.0*23^2
"BLD",1495,"REQB","B","RG*1.0*13",1)

"BLD",1495,"REQB","B","RG*1.0*23",2)

"KRN",8994,148,-1)
0^1
"KRN",8994,148,0)
RG REMOTE HL7 TASK^TASK^RGMTRUN^2^P^0^^^1
"KRN",8994,148,1,0)
^8994.01^3^3^3020321^^^^
"KRN",8994,148,1,1,0)
This remote procedure call will return the currently running
"KRN",8994,148,1,2,0)
Health Level Seven (HL7) tasks from a remote site to the
"KRN",8994,148,1,3,0)
Master Patient Index (MPI).
"KRN",8994,148,3,0)
^8994.03^3^3^3020321^^^^
"KRN",8994,148,3,1,0)
This remote procedure call will return the currently running
"KRN",8994,148,3,2,0)
Health Level Seven (HL7) tasks from a remote site to the
"KRN",8994,148,3,3,0)
Master Patient Index (MPI).
"KRN",8994,152,-1)
0^2
"KRN",8994,152,0)
RG REM ACTIVITY^EN^RGACTIV^2^P^^^^1
"KRN",8994,152,1,0)
^8994.01^4^4^3020416^^
"KRN",8994,152,1,1,0)
This remote procedure call (RPC) returns Health Level Seven (HL7) message 
"KRN",8994,152,1,2,0)
information and exception information for a patient.  The HL7 data is from
"KRN",8994,152,1,3,0)
the ADT/HL7 PIVOT (#391.71) file and exception date is from the CIRN HL7 
"KRN",8994,152,1,4,0)
EXCEPTION LOG (#991.1) file.
"KRN",8994,152,2,0)
^8994.02A^2^2
"KRN",8994,152,2,1,0)
ICN^1^16^0^2
"KRN",8994,152,2,1,1,0)
^^1^1^3020416^
"KRN",8994,152,2,1,1,1,0)
Integration Control Number (ICN) for patient on whom data is requested.
"KRN",8994,152,2,2,0)
SSN^1^9^0^3
"KRN",8994,152,2,2,1,0)
^^1^1^3020416^
"KRN",8994,152,2,2,1,1,0)
Social Security Number (SSN) for patient on whom data is requested.
"KRN",8994,152,2,"B","ICN",1)

"KRN",8994,152,2,"B","SSN",2)

"KRN",8994,152,2,"PARAMSEQ",2,1)

"KRN",8994,152,2,"PARAMSEQ",3,2)

"KRN",8994,152,3,0)
^8994.03^1^1^3020416^^^
"KRN",8994,152,3,1,0)
ARRAY
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
25^3020607
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3020607
"PKG",272,22,1,"PAH",1,1,1,0)
REMOTE PROCEDURE CALLS AND MISC. FIXES
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*25 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","RGACTIV")
0^3^B1923961
"RTN","RGACTIV",1,0)
RGACTIV ;BAY/ALS-MPI/PD PATIENT ACTIVITY INFORMATION ;03/08/02
"RTN","RGACTIV",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**25**;30 Apr 99
"RTN","RGACTIV",3,0)
 ; Reference to ^VAT(391.71 supported by IA# 3422
"RTN","RGACTIV",4,0)
EN(ARRAY,ICN,SSN) ;
"RTN","RGACTIV",5,0)
 I '$D(ICN) S ARRAY(0)="-1^ICN NOT PASSED" G QUIT
"RTN","RGACTIV",6,0)
 S DFN=$$GETDFN^MPIF001(ICN)
"RTN","RGACTIV",7,0)
 I DFN<1 S ARRAY(ICN,0)=DFN G QUIT
"RTN","RGACTIV",8,0)
 S SITE=+$$SITE^VASITE()
"RTN","RGACTIV",9,0)
PIVOT ; Get message information from ADT/HL7 PIVOT file
"RTN","RGACTIV",10,0)
 S RGMSG="",MSGDATA=""
"RTN","RGACTIV",11,0)
 I $D(^VAT(391.71,"C",DFN)) D
"RTN","RGACTIV",12,0)
 . S MSG=0 S MSG=$O(^VAT(391.71,"C",DFN,MSG)) Q:'MSG  D
"RTN","RGACTIV",13,0)
 .. S DIC="391.71",DR=".01;.04;2.1",DA=MSG,DIQ="RGMSG",DIQ(0)="E"
"RTN","RGACTIV",14,0)
 .. D EN^DIQ1 K DIC,DR,DA,DIQ
"RTN","RGACTIV",15,0)
 .. S MSGDATA=RGMSG(391.71,MSG,.04,"E")_"^"_RGMSG(391.71,MSG,.01,"E")_"^"_MSG_"^"_RGMSG(391.71,MSG,2.1,"E")
"RTN","RGACTIV",16,0)
 .. S ARRAY(ICN,SITE,"PIVOT",MSG)=ICN_"^"_SITE_"^"_"PIVOT^"_MSGDATA
"RTN","RGACTIV",17,0)
EXC ;Get exception information 
"RTN","RGACTIV",18,0)
 D GETEX^RGEX03(.RETURN,DFN)
"RTN","RGACTIV",19,0)
 S X=0 F  S X=$O(RETURN(X)) Q:'X  S ARRAY(ICN,SITE,"EXC",X)=ICN_"^"_SITE_"^"_"EXC^"_RETURN(X)
"RTN","RGACTIV",20,0)
QUIT ;
"RTN","RGACTIV",21,0)
 K DFN,RGMSG,MSG,MSGDATA,RETURN,SITE,X
"RTN","RGACTIV",22,0)
 Q
"RTN","RGEX04")
0^4^B5291421
"RTN","RGEX04",1,0)
RGEX04 ;BAY/ALS-LIST MANAGER ROUTINE FOR MPI/PD EXCEPTION PDAT QUERY ;10/31/01
"RTN","RGEX04",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**23,25**;30 Apr 99
"RTN","RGEX04",3,0)
EN ;main entry point for RG EXCPT PDAT
"RTN","RGEX04",4,0)
 D EN^VALM("RG EXCPT PDAT")
"RTN","RGEX04",5,0)
 Q
"RTN","RGEX04",6,0)
HDR ; header code
"RTN","RGEX04",7,0)
 S VALMHDR(1)="MPI/PD PATIENT DATA"
"RTN","RGEX04",8,0)
 S VALMHDR(2)=""
"RTN","RGEX04",9,0)
 Q
"RTN","RGEX04",10,0)
INIT ;
"RTN","RGEX04",11,0)
 K ^TMP("RGEXC4",$J)
"RTN","RGEX04",12,0)
 K @VALMAR
"RTN","RGEX04",13,0)
 ;I '$D(ICN) G EXIT
"RTN","RGEX04",14,0)
 I '$D(^TMP("RGPDAT",$J)) G EXIT
"RTN","RGEX04",15,0)
 S LIN=1,X=0,STR="",TXT=""
"RTN","RGEX04",16,0)
 F  S X=$O(^TMP("RGPDAT",$J,X)) Q:'X  D
"RTN","RGEX04",17,0)
 . S TXT=^TMP("RGPDAT",$J,X)
"RTN","RGEX04",18,0)
 . I $E(TXT,1,12)'="Enter RETURN" D
"RTN","RGEX04",19,0)
 .. S STR=$$SETSTR^VALM1(TXT,STR,2,78)
"RTN","RGEX04",20,0)
 .. D ADDTMP
"RTN","RGEX04",21,0)
 S VALMCNT=LIN-1
"RTN","RGEX04",22,0)
 Q
"RTN","RGEX04",23,0)
ADDTMP ;
"RTN","RGEX04",24,0)
 S ^TMP("RGEXC4",$J,LIN,0)=STR
"RTN","RGEX04",25,0)
 S ^TMP("RGEXC4",$J,"IDX",LIN,LIN)=""
"RTN","RGEX04",26,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX04",27,0)
 Q
"RTN","RGEX04",28,0)
RSEND ;Send remote PDAT Query
"RTN","RGEX04",29,0)
 S VALMBCK="",RICN=ICN
"RTN","RGEX04",30,0)
 D FULL^VALM1
"RTN","RGEX04",31,0)
 D SEND^RGRPDAT
"RTN","RGEX04",32,0)
 D PAUSE^VALM1
"RTN","RGEX04",33,0)
 S ICN=RICN
"RTN","RGEX04",34,0)
 D INIT
"RTN","RGEX04",35,0)
 S VALMBCK="R"
"RTN","RGEX04",36,0)
 Q
"RTN","RGEX04",37,0)
RCHK ;Check remote PDAT Query
"RTN","RGEX04",38,0)
 S VALMBCK="",RICN=ICN
"RTN","RGEX04",39,0)
 D FULL^VALM1
"RTN","RGEX04",40,0)
 D CHKSTAT^RGRPDAT
"RTN","RGEX04",41,0)
 D PAUSE^VALM1
"RTN","RGEX04",42,0)
 S ICN=RICN
"RTN","RGEX04",43,0)
 D INIT
"RTN","RGEX04",44,0)
 S VALMBCK="R"
"RTN","RGEX04",45,0)
 Q
"RTN","RGEX04",46,0)
RDISP ;Display remote PDAT Query
"RTN","RGEX04",47,0)
 S VALMBCK="",RICN=ICN
"RTN","RGEX04",48,0)
 D FULL^VALM1
"RTN","RGEX04",49,0)
 W !!,"Display data returned from remote patient data queries."
"RTN","RGEX04",50,0)
 S TFL="",L="",Y="",ICNARR="",STATUS=""
"RTN","RGEX04",51,0)
 I '$D(^XTMP("RGPDAT"_ICN)) W !!,"No remote query sent for this patient. " G QRD
"RTN","RGEX04",52,0)
 D GETTFL^RGRPDAT(ICN,.TFL)
"RTN","RGEX04",53,0)
 W !!,"-> For ICN ",$P(ICN,"V",1),!
"RTN","RGEX04",54,0)
 I $D(TFL(0)) D
"RTN","RGEX04",55,0)
 . S X=0 F  S X=$O(TFL(X)) Q:'X  I '$D(^XTMP("RGPDAT"_ICN,X)) K TFL(X)
"RTN","RGEX04",56,0)
 D SELTF^RGRPDAT
"RTN","RGEX04",57,0)
 I '$D(TFARR) W !,"No remote query sent for this patient." G QRD
"RTN","RGEX04",58,0)
 I ((Y="")!(Y="^")) G QRD
"RTN","RGEX04",59,0)
 D PAUSE^VALM1
"RTN","RGEX04",60,0)
 D EN^RGEX05(RICN)
"RTN","RGEX04",61,0)
QRD D PAUSE^VALM1
"RTN","RGEX04",62,0)
 S ICN=RICN
"RTN","RGEX04",63,0)
 D INIT
"RTN","RGEX04",64,0)
 S VALMBCK="R"
"RTN","RGEX04",65,0)
 Q
"RTN","RGEX04",66,0)
HELP ;
"RTN","RGEX04",67,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX04",68,0)
 Q
"RTN","RGEX04",69,0)
EXIT ;
"RTN","RGEX04",70,0)
 S VALMBCK=""
"RTN","RGEX04",71,0)
 K ^TMP("RGEXC4",$J),LIN,X,STR,TXT,RICN,Y,STATUS,TFL,TFARR,L,ICNARR
"RTN","RGEX04",72,0)
 S VALMBCK="R"
"RTN","RGEX04",73,0)
 Q
"RTN","RGFIU")
0^5^B35548191
"RTN","RGFIU",1,0)
RGFIU ;ALB/CJM-MPI/PD NDBI MERGE UTILITY (CONTINUED) ;08/27/99
"RTN","RGFIU",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**5,13,25**;30 Apr 99
"RTN","RGFIU",3,0)
 ;
"RTN","RGFIU",4,0)
STATNUM(IEN) ;
"RTN","RGFIU",5,0)
 ;Description:  Given an ien to the Institution file, returns as the function value the station number.  Returns "" on failure.
"RTN","RGFIU",6,0)
 ;
"RTN","RGFIU",7,0)
 N STATION
"RTN","RGFIU",8,0)
 Q:'$G(IEN) ""
"RTN","RGFIU",9,0)
 Q:'$D(^DIC(4,IEN,0)) ""
"RTN","RGFIU",10,0)
 S STATION=$P($$NNT^XUAF4(IEN),"^",2)
"RTN","RGFIU",11,0)
 Q $S(+STATION:STATION,1:"")
"RTN","RGFIU",12,0)
 ;
"RTN","RGFIU",13,0)
UPD(FILE,RGDA,DATA,ERROR) ;File data into an existing record.
"RTN","RGFIU",14,0)
 ; Input:
"RTN","RGFIU",15,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",16,0)
 ;   RGDA - New name for traditional DA array, with same meaning.
"RTN","RGFIU",17,0)
 ;            Pass by reference.
"RTN","RGFIU",18,0)
 ;   DATA - Data array to file (pass by reference)
"RTN","RGFIU",19,0)
 ;          Format: DATA(<field #>)=<value>
"RTN","RGFIU",20,0)
 ;
"RTN","RGFIU",21,0)
 ; Output:
"RTN","RGFIU",22,0)
 ;  Function Value -     0=error and 1=no error
"RTN","RGFIU",23,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",24,0)
 ;
"RTN","RGFIU",25,0)
 ; Example: To update a record in subfile 2.0361 in record with ien=353,
"RTN","RGFIU",26,0)
 ;          subrecord ien=68, with the field .01 value = 21:
"RTN","RGFIU",27,0)
 ;    S DATA(.01)=21,RGDA=68,RGDA(1)=353 I $$UPD^RGFIU(2.0361,.RGDA,.DATA,.ERROR) W !,"DONE"
"RTN","RGFIU",28,0)
 ;
"RTN","RGFIU",29,0)
 N FDA,FIELD,IENS,ERRORS
"RTN","RGFIU",30,0)
 ;
"RTN","RGFIU",31,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","RGFIU",32,0)
 ;FDA - the FDA array as defined by FM
"RTN","RGFIU",33,0)
 ;
"RTN","RGFIU",34,0)
 I '$G(RGDA) S ERROR="IEN OF RECORD TO BE UPDATED NOT SPECIFIED" Q 0
"RTN","RGFIU",35,0)
 S IENS=$$IENS^DILF(.RGDA)
"RTN","RGFIU",36,0)
 S FIELD=0
"RTN","RGFIU",37,0)
 F  S FIELD=$O(DATA(FIELD)) Q:'FIELD  D
"RTN","RGFIU",38,0)
 .S FDA(FILE,IENS,FIELD)=$G(DATA(FIELD))
"RTN","RGFIU",39,0)
 D FILE^DIE("K","FDA","ERRORS(1)")
"RTN","RGFIU",40,0)
 I +$G(DIERR) D
"RTN","RGFIU",41,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","RGFIU",42,0)
 E  D
"RTN","RGFIU",43,0)
 .S ERROR=""
"RTN","RGFIU",44,0)
 ;
"RTN","RGFIU",45,0)
 I $S(+$G(DIERR):0,1:1) D CLEAN^DILF Q 1
"RTN","RGFIU",46,0)
 E  D CLEAN^DILF Q 0
"RTN","RGFIU",47,0)
 ;
"RTN","RGFIU",48,0)
GETFIELD(FILE,FIELD,RGDA,ERROR,EXT) ;Get field value from an existing record.
"RTN","RGFIU",49,0)
 ; Input:
"RTN","RGFIU",50,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",51,0)
 ;   RGDA - New name for traditional DA array, with same meaning.
"RTN","RGFIU",52,0)
 ;            Pass by reference.
"RTN","RGFIU",53,0)
 ;   FIELD - Field for which value is needed
"RTN","RGFIU",54,0)
 ;   EXT - (optional) If $G(EXT) then returns the external display form of the value
"RTN","RGFIU",55,0)
 ; Output:
"RTN","RGFIU",56,0)
 ;  Function Value -  field value in internal format,"" if an error was encountered
"RTN","RGFIU",57,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",58,0)
 ;
"RTN","RGFIU",59,0)
 N FDA,IENS,ERRORS,VALUE
"RTN","RGFIU",60,0)
 ;
"RTN","RGFIU",61,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","RGFIU",62,0)
 ;FDA - the FDA array as defined by FM
"RTN","RGFIU",63,0)
 ;
"RTN","RGFIU",64,0)
 I '$G(RGDA) S ERROR="IEN OF RECORD TO BE UPDATED NOT SPECIFIED" Q ""
"RTN","RGFIU",65,0)
 S IENS=$$IENS^DILF(.RGDA)
"RTN","RGFIU",66,0)
 S VALUE=$$GET1^DIQ(FILE,IENS,FIELD,$S($G(EXT):"",1:"I"),,"ERRORS(1)")
"RTN","RGFIU",67,0)
 I +$G(DIERR) D
"RTN","RGFIU",68,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","RGFIU",69,0)
 E  D
"RTN","RGFIU",70,0)
 .S ERROR=""
"RTN","RGFIU",71,0)
 ;
"RTN","RGFIU",72,0)
 I $S(+$G(DIERR):0,1:1) D CLEAN^DILF Q VALUE
"RTN","RGFIU",73,0)
 E  D CLEAN^DILF Q ""
"RTN","RGFIU",74,0)
 ;
"RTN","RGFIU",75,0)
DELETE(FILE,RGDA,ERROR) ;Delete an existing record.
"RTN","RGFIU",76,0)
 ; Input:
"RTN","RGFIU",77,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",78,0)
 ;   RGDA - New name for traditional DA array, with same meaning.
"RTN","RGFIU",79,0)
 ;            Pass by reference.
"RTN","RGFIU",80,0)
 ;
"RTN","RGFIU",81,0)
 ; Output:
"RTN","RGFIU",82,0)
 ;  Function Value -     0=error and 1=no error
"RTN","RGFIU",83,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",84,0)
 ;
"RTN","RGFIU",85,0)
 ; Example: To delete a record in subfile 2.0361 in record with ien=353,
"RTN","RGFIU",86,0)
 ;          subrecord ien=68:
"RTN","RGFIU",87,0)
 ;    S RGDA=68,RGDA(1)=353 I $$DELETE^RGFIU(2.0361,.RGDA,.DATA,.ERROR) W !,"DONE"
"RTN","RGFIU",88,0)
 ;
"RTN","RGFIU",89,0)
 N DATA
"RTN","RGFIU",90,0)
 S DATA(.01)="@"
"RTN","RGFIU",91,0)
 Q $$UPD^RGFIU(FILE,.RGDA,.DATA,.ERROR)
"RTN","RGFIU",92,0)
 Q
"RTN","RGFIU",93,0)
 ;
"RTN","RGFIU",94,0)
ADD(FILE,RGDA,DATA,ERROR,IEN) ;
"RTN","RGFIU",95,0)
 ;Description: Creates a new record and files the data.
"RTN","RGFIU",96,0)
 ; Input:
"RTN","RGFIU",97,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",98,0)
 ;   RGDA - New name for traditional FileMan DA array with same
"RTN","RGFIU",99,0)
 ;            meaning. Pass by reference.  Only needed if adding to a
"RTN","RGFIU",100,0)
 ;            subfile.
"RTN","RGFIU",101,0)
 ;   DATA - Data array to file, pass by reference
"RTN","RGFIU",102,0)
 ;          Format: DATA(<field #>)=<value>
"RTN","RGFIU",103,0)
 ;   IEN - internal entry number to use (optional)
"RTN","RGFIU",104,0)
 ;
"RTN","RGFIU",105,0)
 ; Output:
"RTN","RGFIU",106,0)
 ;   Function Value - If no error then it returns the ien of the created record, else returns NULL.
"RTN","RGFIU",107,0)
 ;  RGDA - returns the ien of the new record, NULL if none created.  If needed, pass by reference.
"RTN","RGFIU",108,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",109,0)
 ;
"RTN","RGFIU",110,0)
 ; Example: To add a record in subfile 2.0361 in the record with ien=353
"RTN","RGFIU",111,0)
 ;          with the field .01 value = 21:
"RTN","RGFIU",112,0)
 ;  S DATA(.01)=21,RGDA(1)=353 I $$ADD^RGFIU(2.0361,.RGDA,.DATA) W !,"DONE"
"RTN","RGFIU",113,0)
 ;
"RTN","RGFIU",114,0)
 ; Example: If creating a record not in a subfile, would look like this:
"RTN","RGFIU",115,0)
 ;          S DATA(.01)=21 I $$ADD^RGFIU(867,,.DATA) W !,"DONE"
"RTN","RGFIU",116,0)
 ;
"RTN","RGFIU",117,0)
 N FDA,FIELD,IENA,IENS,ERRORS
"RTN","RGFIU",118,0)
 ;
"RTN","RGFIU",119,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","RGFIU",120,0)
 ;IENA - the Internal Entry Numebr Array defined by FM
"RTN","RGFIU",121,0)
 ;FDA - the FDA array defined by FM
"RTN","RGFIU",122,0)
 ;IEN - the ien of the new record
"RTN","RGFIU",123,0)
 ;
"RTN","RGFIU",124,0)
 S RGDA="+1"
"RTN","RGFIU",125,0)
 S IENS=$$IENS^DILF(.RGDA)
"RTN","RGFIU",126,0)
 S FIELD=0
"RTN","RGFIU",127,0)
 F  S FIELD=$O(DATA(FIELD)) Q:'FIELD  D
"RTN","RGFIU",128,0)
 .S FDA(FILE,IENS,FIELD)=$G(DATA(FIELD))
"RTN","RGFIU",129,0)
 I $G(IEN) S IENA(1)=IEN
"RTN","RGFIU",130,0)
 D UPDATE^DIE("","FDA","IENA","ERRORS(1)")
"RTN","RGFIU",131,0)
 I +$G(DIERR) D
"RTN","RGFIU",132,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","RGFIU",133,0)
 .S IEN=""
"RTN","RGFIU",134,0)
 E  D
"RTN","RGFIU",135,0)
 .S IEN=IENA(1)
"RTN","RGFIU",136,0)
 .S ERROR=""
"RTN","RGFIU",137,0)
 D CLEAN^DILF
"RTN","RGFIU",138,0)
 S RGDA=IEN
"RTN","RGFIU",139,0)
 Q IEN
"RTN","RGFIU",140,0)
 ;
"RTN","RGFIU",141,0)
TESTVAL(FILE,FIELD,VALUE) ;
"RTN","RGFIU",142,0)
 ;Description: returns 1 if VALUE is a valid value for FIELD in FILE
"RTN","RGFIU",143,0)
 ;
"RTN","RGFIU",144,0)
 Q:(('$G(FILE))!('$G(FIELD))) 0
"RTN","RGFIU",145,0)
 ;
"RTN","RGFIU",146,0)
 N DISPLAY,VALID,RESULT
"RTN","RGFIU",147,0)
 S VALID=1
"RTN","RGFIU",148,0)
 ;
"RTN","RGFIU",149,0)
 ;if there is no external value then it is not valid
"RTN","RGFIU",150,0)
 S DISPLAY=$$EXTERNAL^DILFD(FILE,FIELD,"F",VALUE)
"RTN","RGFIU",151,0)
 I (DISPLAY="") S VALID=0
"RTN","RGFIU",152,0)
 ; 
"RTN","RGFIU",153,0)
 I VALID,$$GET1^DID(FILE,FIELD,"","TYPE")'["POINTER" D
"RTN","RGFIU",154,0)
 .D CHK^DIE(FILE,FIELD,,VALUE,.RESULT) I RESULT="^" S VALID=0 Q
"RTN","RGFIU",155,0)
 Q VALID
"RTN","RGFIU",156,0)
 ;
"RTN","RGFIU",157,0)
GETLINK(INSTIEN) ;
"RTN","RGFIU",158,0)
 ;Description:  Returns name of logical link for institition, given the institution ien.  Returns "" if a logical link name not found.
"RTN","RGFIU",159,0)
 ;
"RTN","RGFIU",160,0)
 Q:'$G(INSTIEN) ""
"RTN","RGFIU",161,0)
 ;
"RTN","RGFIU",162,0)
 N LINK,I,LINKNAME
"RTN","RGFIU",163,0)
 S LINKNAME=""
"RTN","RGFIU",164,0)
 D
"RTN","RGFIU",165,0)
 .;don't check if enabled - if shut down, message will be queued
"RTN","RGFIU",166,0)
 .;Q:'$$CHKLL^HLUTIL(INSTIEN)
"RTN","RGFIU",167,0)
 .;
"RTN","RGFIU",168,0)
 .D LINK^HLUTIL3(INSTIEN,.LINK)
"RTN","RGFIU",169,0)
 .S I=$O(LINK(0))
"RTN","RGFIU",170,0)
 .I I,$L(LINK(I)) S LINKNAME=LINK(I)
"RTN","RGFIU",171,0)
 Q LINKNAME
"RTN","RGFIU",172,0)
 ;
"RTN","RGFIU",173,0)
ASKYESNO(PROMPT,DEFAULT) ;
"RTN","RGFIU",174,0)
 ;Description: Displays PROMPT, appending '?'.  Expects a YES NO response.
"RTN","RGFIU",175,0)
 ;Input:
"RTN","RGFIU",176,0)
 ;   PROMPT - text to display as prompt.  Appends '?'
"RTN","RGFIU",177,0)
 ;   DEFAULT - (optional) YES or NO.  If not passed, defaults to YES
"RTN","RGFIU",178,0)
 ;Output:
"RTN","RGFIU",179,0)
 ;  Function value: 1 if yes, 0 if no, "" if '^' entered or timeout
"RTN","RGFIU",180,0)
 ;
"RTN","RGFIU",181,0)
 N DIR,Y
"RTN","RGFIU",182,0)
 S DIR(0)="Y"
"RTN","RGFIU",183,0)
 S DIR("A")=PROMPT
"RTN","RGFIU",184,0)
 S DIR("B")=$S($G(DEFAULT)="NO":"NO",1:"YES")
"RTN","RGFIU",185,0)
 D ^DIR
"RTN","RGFIU",186,0)
 Q:$D(DIRUT) ""
"RTN","RGFIU",187,0)
 Q Y
"RTN","RGFIU",188,0)
 ;
"RTN","RGFIU",189,0)
EXC(RGEXC,RGERR,RGDFN,RGMSGID,RGSITE) ;
"RTN","RGFIU",190,0)
 ;Description: Calls the MPI/PD Exception Handler
"RTN","RGFIU",191,0)
 ;Inputs:
"RTN","RGFIU",192,0)
 ;  RGEXC - the exception type
"RTN","RGFIU",193,0)
 ;  RGERR - (optional) text
"RTN","RGFIU",194,0)
 ;  RGDFN - (optional) patient DFN
"RTN","RGFIU",195,0)
 ;  RGMSGID - (optional) HL7 message id
"RTN","RGFIU",196,0)
 ;  RGSITE - (optional) station # of site where the exception occurred
"RTN","RGFIU",197,0)
 N ICN
"RTN","RGFIU",198,0)
 I +$G(RGDFN) D
"RTN","RGFIU",199,0)
 .S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGFIU",200,0)
 .I ICN'>0 S ICN=""
"RTN","RGFIU",201,0)
 .S RGERR=$G(RGERR)_"  Patient Name: "_$E($$NAME(RGDFN),1,25)_" SSN: "_$$SSN(RGDFN)_"  ICN: "_ICN
"RTN","RGFIU",202,0)
 D EXC^RGHLLOG($G(RGEXC),$E($G(RGERR),1,235),$G(RGDFN),$G(RGMSGID),$G(RGSITE))
"RTN","RGFIU",203,0)
 Q
"RTN","RGFIU",204,0)
 ;
"RTN","RGFIU",205,0)
SSN(DFN) ;
"RTN","RGFIU",206,0)
 ;Description: Function returns the patient's SSN, or "" on failure.
"RTN","RGFIU",207,0)
 Q $$GETFIELD(2,.09,.DFN)
"RTN","RGFIU",208,0)
 ;
"RTN","RGFIU",209,0)
NAME(DFN) ;
"RTN","RGFIU",210,0)
 ;Description: Function returns the patient's NAME, or "" on failure.
"RTN","RGFIU",211,0)
 Q $$GETFIELD(2,.01,.DFN)
"RTN","RGFIU",212,0)
 ;
"RTN","RGFIU",213,0)
ICN(DFN) ;Return patient ICN
"RTN","RGFIU",214,0)
 NEW RESULT
"RTN","RGFIU",215,0)
 S RESULT=+$$GETICN^MPIF001($G(DFN))
"RTN","RGFIU",216,0)
 I RESULT<0 Q ""
"RTN","RGFIU",217,0)
 Q +RESULT
"RTN","RGFIU",218,0)
 ;
"RTN","RGFIU",219,0)
DFN(ICN) ;Return patient IEN
"RTN","RGFIU",220,0)
 NEW RESULT
"RTN","RGFIU",221,0)
 I ICN'="" S ICN=+ICN
"RTN","RGFIU",222,0)
 S RESULT=$$GETDFN^MPIF001($G(ICN))
"RTN","RGFIU",223,0)
 I RESULT<0 Q ""
"RTN","RGFIU",224,0)
 Q RESULT
"RTN","RGFIU",225,0)
 ;
"RTN","RGFIU",226,0)
MPINODE(DFN) ;
"RTN","RGFIU",227,0)
 N NODE
"RTN","RGFIU",228,0)
 S NODE=$$MPINODE^MPIFAPI($G(DFN))
"RTN","RGFIU",229,0)
 I +NODE=-1 S NODE=""
"RTN","RGFIU",230,0)
 Q NODE
"RTN","RGFIU",231,0)
 ;
"RTN","RGFIU",232,0)
GETALL(DFN,MPIDATA) ;
"RTN","RGFIU",233,0)
 ;Descripition: Gets the MPI data and treating facility list
"RTN","RGFIU",234,0)
 ;
"RTN","RGFIU",235,0)
 ;Input:
"RTN","RGFIU",236,0)
 ;   DFN - patient ien
"RTN","RGFIU",237,0)
 ;Output:
"RTN","RGFIU",238,0)
 ;   MPIDATA       - output array (pass by reference)
"RTN","RGFIU",239,0)
 ;       "ICN") = <ICN>
"RTN","RGFIU",240,0)
 ;       "CHKSUM") = <ICN checksum>
"RTN","RGFIU",241,0)
 ;       "LOC") = <1 if ICN is local, 0 if national>
"RTN","RGFIU",242,0)
 ;       "CMOR") = <station number of CMOR>
"RTN","RGFIU",243,0)
 ;       "TF",<station number of TF>,"INSTIEN")=<ien of treating facility in Institution file>
"RTN","RGFIU",244,0)
 ;       "TF",<station number of TF>,"LASTDATE")=<date last treated>
"RTN","RGFIU",245,0)
 ;       "TF",<station number of TF>,"EVENT")=<ADT event reason (a pointer)>
"RTN","RGFIU",246,0)
 ;       "SUB") = <ien of subscriber list>
"RTN","RGFIU",247,0)
 ;
"RTN","RGFIU",248,0)
 N NODE,IEN,STAT,INST,LINK,I,HLL
"RTN","RGFIU",249,0)
 ;
"RTN","RGFIU",250,0)
 K MPIDATA
"RTN","RGFIU",251,0)
 ;
"RTN","RGFIU",252,0)
 ;get MPI data
"RTN","RGFIU",253,0)
 S NODE=$$MPINODE^RGFIU(DFN)
"RTN","RGFIU",254,0)
 S MPIDATA("ICN")=$P(NODE,"^"),MPIDATA("CHKSUM")=$P(NODE,"^",2),MPIDATA("LOC")=$P(NODE,"^",4),MPIDATA("CMOR")=$$STATNUM^RGFIU($P(NODE,"^",3)),MPIDATA("SUB")=$P(NODE,"^",5)
"RTN","RGFIU",255,0)
 ;
"RTN","RGFIU",256,0)
 ;get TF list
"RTN","RGFIU",257,0)
 I MPIDATA("ICN") D
"RTN","RGFIU",258,0)
 .N ARRAY,ITEM,NODE,STAT
"RTN","RGFIU",259,0)
 .Q:$$QUERYTF^VAFCTFU1(MPIDATA("ICN"),"ARRAY")
"RTN","RGFIU",260,0)
 .S ITEM=0
"RTN","RGFIU",261,0)
 .F  S ITEM=$O(ARRAY(ITEM)) Q:'ITEM  D
"RTN","RGFIU",262,0)
 ..S NODE=ARRAY(ITEM)
"RTN","RGFIU",263,0)
 ..S STAT=$$STATNUM^RGFIU($P(NODE,"^"))
"RTN","RGFIU",264,0)
 ..Q:'STAT
"RTN","RGFIU",265,0)
 ..S MPIDATA("TF",STAT,"INSTIEN")=$P(NODE,"^",1)
"RTN","RGFIU",266,0)
 ..S MPIDATA("TF",STAT,"LASTDATE")=$P(NODE,"^",2)
"RTN","RGFIU",267,0)
 ..S MPIDATA("TF",STAT,"EVENT")=$P(NODE,"^",3)
"RTN","RGFIU",268,0)
 Q
"RTN","RGHLLOG")
0^7^B22489044
"RTN","RGHLLOG",1,0)
RGHLLOG ;CAIRO/DKM-LOG MESSAGE PROCESSING INFO ;09/04/98
"RTN","RGHLLOG",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,11,13,18,19,25**;30 Apr 99
"RTN","RGHLLOG",3,0)
 ;Reference to ^HLMA("C" supported by IA #3244
"RTN","RGHLLOG",4,0)
 ;=================================================================
"RTN","RGHLLOG",5,0)
 ; Log information about message processing and exceptions
"RTN","RGHLLOG",6,0)
 ; in CIRN HL7 Exception Log file.
"RTN","RGHLLOG",7,0)
 ;=================================================================
"RTN","RGHLLOG",8,0)
 ; Start time for run log
"RTN","RGHLLOG",9,0)
START(RGMSG,RGDC,RGPARAM) ;
"RTN","RGHLLOG",10,0)
 ;This entry point starts the log process in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",11,0)
 ;file (#991.1), if the (#6) MINIMAL EXCEPTION LOGGING? field in
"RTN","RGHLLOG",12,0)
 ;File #990.8 is set to 0.
"RTN","RGHLLOG",13,0)
 ; Input: Required
"RTN","RGHLLOG",14,0)
 ;   RGMSG - IEN of message entry in File #773, usually HLMTIEN
"RTN","RGHLLOG",15,0)
 ;        Optional
"RTN","RGHLLOG",16,0)
 ;   RGDC - Event Class, associated with an entry in File #
"RTN","RGHLLOG",17,0)
 ;   RGPARAM - reprocessing routine
"RTN","RGHLLOG",18,0)
 S U="^"
"RTN","RGHLLOG",19,0)
 K RGLOG
"RTN","RGHLLOG",20,0)
 S RGLOG(3)=$G(RGMSG),RGLOG(5)=$G(RGDC),RGLOG(4)=$G(RGPARAM),RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",21,0)
 I '$P(^RGSITE("COR",1,0),U,8) S RGLOG=$$CREATE
"RTN","RGHLLOG",22,0)
 Q
"RTN","RGHLLOG",23,0)
 ; Create a log entry
"RTN","RGHLLOG",24,0)
CREATE() Q:$G(RGLOG) RGLOG
"RTN","RGHLLOG",25,0)
 L +^RGHL7(991.1,0):10
"RTN","RGHLLOG",26,0)
 S RGLOG=$O(^RGHL7(991.1,$C(32)),-1)+1
"RTN","RGHLLOG",27,0)
 S:$G(RGLOG(1))="" RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",28,0)
 S RGLOG(3)=$S($G(RGLOG(3))=0:0,$G(HL("MID"))="":"",1:$$IEN773($G(HL("MID"))))
"RTN","RGHLLOG",29,0)
 S (DA,X)=RGLOG,DIC="^RGHL7(991.1,",DIC(0)="L",DLAYGO=991.1,DIC("DR")="1///"_$G(RGLOG(1))_";3////"_$G(RGLOG(3))_";5///"_$G(RGLOG(5))_";4////"_$G(RGLOG(4)) K DD,DO D FILE^DICN K DIC,DA,X,DLAYGO
"RTN","RGHLLOG",30,0)
 L -^RGHL7(991.1,0)
"RTN","RGHLLOG",31,0)
 Q RGLOG
"RTN","RGHLLOG",32,0)
 ; Log time run completed
"RTN","RGHLLOG",33,0)
STOP(RGQUIT) ;
"RTN","RGHLLOG",34,0)
 ;This entry point completes the logging process
"RTN","RGHLLOG",35,0)
 ; Input: required
"RTN","RGHLLOG",36,0)
 ;    RGQUIT - 0 for success and 1 for failure
"RTN","RGHLLOG",37,0)
 ;
"RTN","RGHLLOG",38,0)
 Q:'$G(RGLOG)
"RTN","RGHLLOG",39,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",40,0)
 S DIE="^RGHL7(991.1,",DR="1.5///NOW;1.6///^S X=$G(RGQUIT)",DA=RGLOG D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",41,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",42,0)
 K RGLOG,RGQUIT,X,Y,DIC,DIE
"RTN","RGHLLOG",43,0)
 Q
"RTN","RGHLLOG",44,0)
 ; Log unclassified exception (old entry point)
"RTN","RGHLLOG",45,0)
ERR(RGERR,RGSEV) ;
"RTN","RGHLLOG",46,0)
 D EXC(18,RGERR)
"RTN","RGHLLOG",47,0)
 S RGQUIT=$G(RGQUIT)!$G(RGSEV)
"RTN","RGHLLOG",48,0)
 Q
"RTN","RGHLLOG",49,0)
 ; Log an exception
"RTN","RGHLLOG",50,0)
EXC(RGEXC,RGERR,RGDFN,MSGID,STATNUM) ;
"RTN","RGHLLOG",51,0)
 ;This entry point logs exceptions in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",52,0)
 ;file (#991.1)
"RTN","RGHLLOG",53,0)
 ; Input: Required
"RTN","RGHLLOG",54,0)
 ;   RGEXC - Exception type in File #991.11
"RTN","RGHLLOG",55,0)
 ;   RGERR - Supplemental text
"RTN","RGHLLOG",56,0)
 ;        Optional
"RTN","RGHLLOG",57,0)
 ;   RGDFN - IEN in the PATIENT file (#2)
"RTN","RGHLLOG",58,0)
 ;   MSGID - message id of the HL7 message where the exception was encountered (optional)
"RTN","RGHLLOG",59,0)
 ;   STATNUM - station # of site that encountered the error (optional) - if not defined then the local site is assumed, using $$SITE^VASITE
"RTN","RGHLLOG",60,0)
 ;
"RTN","RGHLLOG",61,0)
 I $L($G(HL("MID"))) Q:$$INVEXC(HL("MID"))  ; is the exception valid?
"RTN","RGHLLOG",62,0)
 N RGI,RGZ
"RTN","RGHLLOG",63,0)
 S U="^"
"RTN","RGHLLOG",64,0)
 S:RGEXC[U RGERR=$P(RGEXC,U,2,999),RGEXC=+RGEXC
"RTN","RGHLLOG",65,0)
 S:RGEXC'=+RGEXC RGERR=RGEXC,RGEXC=18
"RTN","RGHLLOG",66,0)
 S:'$D(^RGHL7(991.11,RGEXC)) RGEXC=18
"RTN","RGHLLOG",67,0)
 L +^RGHL7(991.11,RGEXC):10
"RTN","RGHLLOG",68,0)
 S RGZ=$G(^RGHL7(991.11,RGEXC,0))
"RTN","RGHLLOG",69,0)
 S:$L(RGZ) $P(^RGHL7(991.11,RGEXC,0),U,5)=$P(RGZ,U,5)+1
"RTN","RGHLLOG",70,0)
 S:$P(RGZ,U,2)>1 RGQUIT=1
"RTN","RGHLLOG",71,0)
 L -^RGHL7(991.11,RGEXC)
"RTN","RGHLLOG",72,0)
 S RGLOG=$$CREATE
"RTN","RGHLLOG",73,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",74,0)
 S RGI=$O(^RGHL7(991.1,RGLOG,1,$C(32)),-1)+1
"RTN","RGHLLOG",75,0)
 S RGERR=$E($G(RGERR),1,250)
"RTN","RGHLLOG",76,0)
 S DIC="^RGHL7(991.1,"_RGLOG_",1,"
"RTN","RGHLLOG",77,0)
 S X=RGI,DA(1)=RGLOG,DIC(0)="FL",DLAYGO=991.12,DIC("P")=$P(^DD(991.1,2,0),"^",2)
"RTN","RGHLLOG",78,0)
 D ^DIC
"RTN","RGHLLOG",79,0)
 S DIE=DIC
"RTN","RGHLLOG",80,0)
 K DIC,DA,DR,DLAYGO
"RTN","RGHLLOG",81,0)
 S STAT=0
"RTN","RGHLLOG",82,0)
 S DIC="3.8",DIC(0)="Z",X="MPIF EXCEPTIONS" D ^DIC K DIC
"RTN","RGHLLOG",83,0)
 S RGMG=$P($G(Y),"^",1)
"RTN","RGHLLOG",84,0)
 I $P(^RGHL7(991.11,RGEXC,0),U,4)=RGMG S STAT=1
"RTN","RGHLLOG",85,0)
 S DA(1)=RGLOG,DA=RGI,DR="2///"_$G(RGEXC)_";3///"_$S($G(RGDFN):"`"_RGDFN,1:"")_";6///"_$G(STAT)_";10///"_$G(RGERR)
"RTN","RGHLLOG",86,0)
 D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",87,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",88,0)
 S RGI=$P(RGZ,U,3),RGZ=$P(RGZ,U,4)
"RTN","RGHLLOG",89,0)
 ;
"RTN","RGHLLOG",90,0)
 ;If the action type is for the MPI Exception Handler, send exception to the handler and quit
"RTN","RGHLLOG",91,0)
 I (RGI=3) D SENDMPI^RGHLLOG1($G(RGEXC),$G(RGERR),$G(RGDFN),$G(MSGID),$G(STATNUM)) Q
"RTN","RGHLLOG",92,0)
 ;
"RTN","RGHLLOG",93,0)
 Q:'RGI!'RGZ
"RTN","RGHLLOG",94,0)
 ;quit and don't send messages for exception types that are now being
"RTN","RGHLLOG",95,0)
 ;handled through the MPI/PD Exception Handling option.
"RTN","RGHLLOG",96,0)
 Q:RGEXC=209!((RGEXC>212)&(RGEXC<219))
"RTN","RGHLLOG",97,0)
 S DIC="^XMB(3.8,",DIC(0)="NZ",X="`"_RGZ D ^DIC K DIC Q:+Y<1  S RGZ=$P(Y,U,2) K Y
"RTN","RGHLLOG",98,0)
 Q:RGZ=""!$P($G(^RGSITE("COR",1,0)),U,7)
"RTN","RGHLLOG",99,0)
 S RGERR=$$SHORT(RGEXC,RGERR),RGZ="G."_RGZ
"RTN","RGHLLOG",100,0)
 I RGI=2 D ALERT^RGRSUTL2(RGERR,RGZ) Q
"RTN","RGHLLOG",101,0)
 D MAIL^RGRSUTL2(RGERR,RGZ,"MPI/PD Exception: "_$$SHORT(RGEXC),"MPI/PD exception notification")
"RTN","RGHLLOG",102,0)
 Q
"RTN","RGHLLOG",103,0)
 ;
"RTN","RGHLLOG",104,0)
INVEXC(RGMID) ; determine if this exception needs to be sent to MPI/PD
"RTN","RGHLLOG",105,0)
 ; personnel via FORUM. Return 1 to avoid messaging to FORUM, else 0.
"RTN","RGHLLOG",106,0)
 ; IA#:3244 is applied in this functionality
"RTN","RGHLLOG",107,0)
 N RGFLG,RGIEN S RGFLG=1
"RTN","RGHLLOG",108,0)
 S RGIEN=$$IEN773(RGMID) Q:'RGIEN RGFLG
"RTN","RGHLLOG",109,0)
 S RGIEN("SND")=$$GET1^DIQ(773,RGIEN_",",13)
"RTN","RGHLLOG",110,0)
 S RGIEN("REC")=$$GET1^DIQ(773,RGIEN_",",14)
"RTN","RGHLLOG",111,0)
 ; check the sending application (fld:13, 0;11) & the receiving
"RTN","RGHLLOG",112,0)
 ; application (fld:14, 0;12) to see if they are related to the MPI/PD
"RTN","RGHLLOG",113,0)
 ; project.
"RTN","RGHLLOG",114,0)
 I RGIEN("SND")]""!(RGIEN("REC")]"") D  Q RGFLG
"RTN","RGHLLOG",115,0)
 .S RGFLG=$$APP(RGIEN("SND")) Q:'RGFLG
"RTN","RGHLLOG",116,0)
 .S RGFLG=$$APP(RGIEN("REC"))
"RTN","RGHLLOG",117,0)
 .Q
"RTN","RGHLLOG",118,0)
 ; Only if the sending/receiving applications cannot be determined from
"RTN","RGHLLOG",119,0)
 ; the data in their respective fields, do I check the MSH multiple for
"RTN","RGHLLOG",120,0)
 ; the MSH segment. I identify the sending/receiving application from
"RTN","RGHLLOG",121,0)
 ; this segment. 
"RTN","RGHLLOG",122,0)
 E  D
"RTN","RGHLLOG",123,0)
 .N RG,RG1,RGMSH,RGFS
"RTN","RGHLLOG",124,0)
 .D GETS^DIQ(773,RGIEN_",",200,,"RGMSH") ;check MSH mult for snd/rec app
"RTN","RGHLLOG",125,0)
 .Q:'($D(RGMSH)\10)  ; no data in "MSH" multiple for file 773
"RTN","RGHLLOG",126,0)
 .S RGIEN=RGIEN_",",RG="RGMSH(773,"""_RGIEN_""","_200_")"
"RTN","RGHLLOG",127,0)
 .S RG1=0 F  S RG1=$O(@RG@(RG1)) Q:RG1'>0  D  Q:$E($G(@RG@(RG1)),1,3)="MSH"
"RTN","RGHLLOG",128,0)
 ..I $E($G(@RG@(RG1)),1,3)="MSH" D
"RTN","RGHLLOG",129,0)
 ...S RG(0)=$G(@RG@(RG1)),RGFS=$E(RG(0),4)
"RTN","RGHLLOG",130,0)
 ...S:$P(RG(0),RGFS,3)]"" RGFLG=$$APP($P(RG(0),RGFS,3)) Q:'RGFLG
"RTN","RGHLLOG",131,0)
 ...S:$P(RG(0),RGFS,5)]"" RGFLG=$$APP($P(RG(0),RGFS,5))
"RTN","RGHLLOG",132,0)
 ...Q
"RTN","RGHLLOG",133,0)
 ..Q
"RTN","RGHLLOG",134,0)
 .Q
"RTN","RGHLLOG",135,0)
 Q RGFLG
"RTN","RGHLLOG",136,0)
APP(X) ; check if the sending/receiving application is relevant to the
"RTN","RGHLLOG",137,0)
 ; MPI/PD team.  Returns 1 if a non-relevant namespace, else 0
"RTN","RGHLLOG",138,0)
 I $E(X,1,2)="RG"!($E(X,1,2)="VA")!($E(X,1,3)="MPI") Q 0
"RTN","RGHLLOG",139,0)
 Q 1
"RTN","RGHLLOG",140,0)
 ;
"RTN","RGHLLOG",141,0)
IEN773(RGMID) ; find the ien of the record in the HL7 MESSAGE ADMINISTRATION
"RTN","RGHLLOG",142,0)
 ; (#773) file based on the Message ID.  Input: Message ID
"RTN","RGHLLOG",143,0)
 ; Output: null, no record in 773, else 773 record ien.  IA#: 3244
"RTN","RGHLLOG",144,0)
 Q:$G(RGMID)="" ""
"RTN","RGHLLOG",145,0)
 Q $O(^HLMA("C",RGMID,0))
"RTN","RGHLLOG",146,0)
 ;
"RTN","RGHLLOG",147,0)
SHORT(RGEXC,RGTXT) ;
"RTN","RGHLLOG",148,0)
 ; Retrieve short text description of exception
"RTN","RGHLLOG",149,0)
 Q $G(^RGHL7(991.11,+RGEXC,10))_$S($G(RGTXT)="":"",1:": "_RGTXT)
"RTN","RGHLLOG",150,0)
 ;
"RTN","RGMTHFS")
0^2^B11483785
"RTN","RGMTHFS",1,0)
RGMTHFS ;BIR/DLR-BUILD HFS FILE FOR CAPTURING REPORT DATA ;08/20/01
"RTN","RGMTHFS",2,0)
 ;;1.0;CLINCAL INFO RESOURCE NETWORK;**25**;30 Apr 99
"RTN","RGMTHFS",3,0)
 ;
"RTN","RGMTHFS",4,0)
 ;Reference to XPAR based on supported IA #2263
"RTN","RGMTHFS",5,0)
 ;Reference to %ZISH based on supported IA #2320
"RTN","RGMTHFS",6,0)
 ;Reference to "VAFC HFS SCRATCH" supported by IA #3549
"RTN","RGMTHFS",7,0)
 ;
"RTN","RGMTHFS",8,0)
 Q
"RTN","RGMTHFS",9,0)
 ;
"RTN","RGMTHFS",10,0)
HFS(LINETAG) ;
"RTN","RGMTHFS",11,0)
 D HFSOPEN("RPC") I POP D  Q
"RTN","RGMTHFS",12,0)
 .S ^TMP("RGMTHFS",$J,1)="ERROR: UNABLE TO ACCESS HFS DIRECTORY "_$$GET^XPAR("SYS","VAFC HFS SCRATCH")
"RTN","RGMTHFS",13,0)
 .S ^TMP("RGMTHFS",$J,2)="PLEASE CHECK DIRECTORY WRITE PRIVILEDGES."
"RTN","RGMTHFS",14,0)
 U IO
"RTN","RGMTHFS",15,0)
 D @LINETAG
"RTN","RGMTHFS",16,0)
 D HFSCLOSE("RPC")
"RTN","RGMTHFS",17,0)
 Q
"RTN","RGMTHFS",18,0)
 ;
"RTN","RGMTHFS",19,0)
HFSOPEN(HANDLE) ; 
"RTN","RGMTHFS",20,0)
 N RGMTDIR,RGMTFILE
"RTN","RGMTHFS",21,0)
 S RGMTDIR=$$GET^XPAR("SYS","VAFC HFS SCRATCH")
"RTN","RGMTHFS",22,0)
 S RGMTFILE="RGMT"_DUZ_".DAT"
"RTN","RGMTHFS",23,0)
 D OPEN^%ZISH(HANDLE,RGMTDIR,RGMTFILE,"W") Q:POP
"RTN","RGMTHFS",24,0)
 S IOM=132,IOSL=99999,IOST="P-DUMMY",IOF=""""""
"RTN","RGMTHFS",25,0)
 Q
"RTN","RGMTHFS",26,0)
 ;
"RTN","RGMTHFS",27,0)
HFSCLOSE(HANDLE) ; 
"RTN","RGMTHFS",28,0)
 N RGMTDIR,RGMTFILE,RGMTDEL
"RTN","RGMTHFS",29,0)
 D CLOSE^%ZISH(HANDLE)
"RTN","RGMTHFS",30,0)
 K ^TMP("RGMTHFS",$J)
"RTN","RGMTHFS",31,0)
 S RGMTDIR=$$GET^XPAR("SYS","VAFC HFS SCRATCH")
"RTN","RGMTHFS",32,0)
 S RGMTFILE="RGMT"_DUZ_".DAT",RGMTDEL(RGMTFILE)=""
"RTN","RGMTHFS",33,0)
 S X=$$FTG^%ZISH(RGMTDIR,RGMTFILE,$NAME(^TMP("RGMTHFS",$J,1)),3)
"RTN","RGMTHFS",34,0)
 S X=$$DEL^%ZISH(RGMTDIR,$NA(RGMTDEL))
"RTN","RGMTHFS",35,0)
 Q
"RTN","RGMTHFS",36,0)
 ; ------------------
"RTN","RGMTHFS",37,0)
HFSGET(RM,GOTO) ;
"RTN","RGMTHFS",38,0)
 ;RM=Right margin
"RTN","RGMTHFS",39,0)
 S:'$G(RM) RM=80
"RTN","RGMTHFS",40,0)
 N ZTQUEUED,RGMTHFS,RGMTSUB,RGMTIO
"RTN","RGMTHFS",41,0)
 S RGMTHFS="RGMT_"_$J_".DAT",RGMTSUB="RGMTDATA"
"RTN","RGMTHFS",42,0)
 D OPEN(.RM,.RGMTHFS,"W",.RGMTIO)
"RTN","RGMTHFS",43,0)
 D @GOTO
"RTN","RGMTHFS",44,0)
 D CLOSE(.RGMTRM,.RGMTHFS,.RGMTSUB,.RGMTIO)
"RTN","RGMTHFS",45,0)
 Q
"RTN","RGMTHFS",46,0)
 ;
"RTN","RGMTHFS",47,0)
OPEN(RGMTRM,RGMTHFS,RGMTMODE,RGMTIO) ; -- open WORKSTATION device
"RTN","RGMTHFS",48,0)
 ;   RGMTRM: right margin
"RTN","RGMTHFS",49,0)
 ;  RGMTHFS: host file name
"RTN","RGMTHFS",50,0)
 ; RGMTMODE: open file in 'R'ead or 'W'rite mode
"RTN","RGMTHFS",51,0)
 S ZTQUEUED="" K IOPAR
"RTN","RGMTHFS",52,0)
 S IOP="OR WORKSTATION;"_$G(RGMTRM,80)
"RTN","RGMTHFS",53,0)
 S %ZIS("HFSMODE")=RGMTMODE,%ZIS("HFSNAME")=RGMTHFS
"RTN","RGMTHFS",54,0)
 D ^%ZIS K IOP,%ZIS
"RTN","RGMTHFS",55,0)
 U IO S RGMTIO=IO
"RTN","RGMTHFS",56,0)
 Q
"RTN","RGMTHFS",57,0)
 ;
"RTN","RGMTHFS",58,0)
CLOSE(RGMTRM,RGMTHFS,RGMTSUB,RGMTIO) ; -- close WORKSTATION device
"RTN","RGMTHFS",59,0)
 ; RGMTSUB: unique subscript name for output 
"RTN","RGMTHFS",60,0)
 I IO=RGMTIO D ^%ZISC
"RTN","RGMTHFS",61,0)
 U IO
"RTN","RGMTHFS",62,0)
 D USEHFS
"RTN","RGMTHFS",63,0)
 U IO
"RTN","RGMTHFS",64,0)
 Q
"RTN","RGMTHFS",65,0)
USEHFS ; -- use host file to build global array
"RTN","RGMTHFS",66,0)
 N IO,RGMTK,SECTION
"RTN","RGMTHFS",67,0)
 S SECTION=0
"RTN","RGMTHFS",68,0)
 S RGMTK=$$FTG^%ZISH(,RGMTHFS,$NA(^TMP($J,1)),2) I 'RGMTK Q
"RTN","RGMTHFS",69,0)
 N RGMTRR S RGMTRR(RGMTHFS)=""
"RTN","RGMTHFS",70,0)
 S RGMTK=$$DEL^%ZISH("",$NA(RGMTRR))
"RTN","RGMTHFS",71,0)
 Q
"RTN","RGMTHFS",72,0)
DSPPDAT(RGMT) ;
"RTN","RGMTHFS",73,0)
 ; Output
"RTN","RGMTHFS",74,0)
 ;   RGMT - array passed back with the display formatted PDAT call
"RTN","RGMTHFS",75,0)
 N CNT,X,TXT
"RTN","RGMTHFS",76,0)
 S CNT=0,X=0 F  S X=$O(^TMP("RGMTHFS",$J,X)) Q:'X  S TXT=^TMP("RGMTHFS",$J,X) D
"RTN","RGMTHFS",77,0)
 . I $E(TXT,1,20)="Treating Facilities:" S RGMT(CNT)="" S CNT=CNT+1
"RTN","RGMTHFS",78,0)
 . I $E(TXT,1,12)="Subscribers:" S RGMT(CNT)="" S CNT=CNT+1
"RTN","RGMTHFS",79,0)
 . I $E(TXT,1,12)="ICN History:" S RGMT(CNT)="" S CNT=CNT+1
"RTN","RGMTHFS",80,0)
 . I $E(TXT,1,13)="CMOR History:" S RGMT(CNT)="" S CNT=CNT+1
"RTN","RGMTHFS",81,0)
 . I $E(TXT,1,28)="CMOR Change Request History:" S RGMT(CNT)="" S CNT=CNT+1
"RTN","RGMTHFS",82,0)
 . I TXT'="" I $E(TXT,1,12)'="Enter RETURN" S RGMT(CNT)=^TMP("RGMTHFS",$J,X),CNT=CNT+1
"RTN","RGMTHFS",83,0)
 Q
"RTN","RGMTHFS",84,0)
ETOT ;
"RTN","RGMTHFS",85,0)
 ;remove specific lines from ETOT global
"RTN","RGMTHFS",86,0)
 M ^TMP("RGMTHFS1",$J)=^TMP("RGMTHFS",$J) K ^TMP("RGMTHFS",$J)
"RTN","RGMTHFS",87,0)
 S CNT=1,X=0 F  S X=$O(^TMP("RGMTHFS1",$J,X)) Q:'X  S TXT=^TMP("RGMTHFS1",$J,X) D
"RTN","RGMTHFS",88,0)
 . I $E(TXT,1,10)="...purging" Q
"RTN","RGMTHFS",89,0)
 . I $E(TXT,1,11)="and deleted" Q
"RTN","RGMTHFS",90,0)
 . I $E(TXT,1,12)="Data string:" Q
"RTN","RGMTHFS",91,0)
 . I $E(TXT,1,10)="Site;Sta#;" Q
"RTN","RGMTHFS",92,0)
 .S ^TMP("RGMTHFS",$J,CNT)=^TMP("RGMTHFS1",$J,X)
"RTN","RGMTHFS",93,0)
 Q
"RTN","RGMTRUN")
0^1^B3744868
"RTN","RGMTRUN",1,0)
RGMTRUN ;BIR/CML,PTD-SCAN TASKMAN RUNNING HL7 TASKS ;07/12/00
"RTN","RGMTRUN",2,0)
 ;;1.0;CLINCAL INFO RESOURCE NETWORK;**25**;30 Apr 99
"RTN","RGMTRUN",3,0)
 ;
"RTN","RGMTRUN",4,0)
 ;Reference to ^%ZTSCH("TASK" supported by IA #3520
"RTN","RGMTRUN",5,0)
 ;Reference to EN^XUTMTP supported by IA #3521
"RTN","RGMTRUN",6,0)
 ;Setting ZT* and XU* variables supported by IA #3521
"RTN","RGMTRUN",7,0)
 ;
"RTN","RGMTRUN",8,0)
MAIN ;Entry point for device call
"RTN","RGMTRUN",9,0)
 W !!,"This option prints the currently running HL7 tasks."
"RTN","RGMTRUN",10,0)
 W !,"The right margin for this report is 80.",!
"RTN","RGMTRUN",11,0)
 S NOTRPC=1
"RTN","RGMTRUN",12,0)
 K ZTSAVE S ZTSAVE("NOTRPC")=""
"RTN","RGMTRUN",13,0)
 D EN^XUTMDEVQ("START^RGMTRUN","Print Running HL7 Task Data") I 'POP K NOTRPC Q
"RTN","RGMTRUN",14,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGMTRUN",15,0)
 K NOTRPC
"RTN","RGMTRUN",16,0)
 Q
"RTN","RGMTRUN",17,0)
 ;
"RTN","RGMTRUN",18,0)
START ;Entry point for RPC call
"RTN","RGMTRUN",19,0)
 S $P(LN,"-",80)="",CNT=0,QFLG=0
"RTN","RGMTRUN",20,0)
 I $D(NOTRPC) W @IOF,!
"RTN","RGMTRUN",21,0)
 I '$D(NOTRPC) W "Running HL7 Tasks at "_$P($$SITE^VASITE(),"^",2)_":"
"RTN","RGMTRUN",22,0)
 I '$D(NOTRPC) D NOW^%DTC W !,"Date compiled: ",$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTRUN",23,0)
 ;
"RTN","RGMTRUN",24,0)
 S TASK=0 F  S TASK=$O(^%ZTSCH("TASK",TASK)) Q:'TASK  Q:QFLG  D
"RTN","RGMTRUN",25,0)
 .S ROU=$P(^%ZTSCH("TASK",TASK),"^",2)
"RTN","RGMTRUN",26,0)
 .I ROU["HL" D
"RTN","RGMTRUN",27,0)
 ..S CNT=CNT+1
"RTN","RGMTRUN",28,0)
 ..N ZTENV,ZTKEY,ZTFLAG,ZTNAME,XUTMUCI
"RTN","RGMTRUN",29,0)
 ..S ZTENV=1,ZTKEY=0,ZTFLAG=1,ZTNAME=$$GET1^DIQ(200,+DUZ_",",.01)
"RTN","RGMTRUN",30,0)
 ..X ^%ZOSF("UCI") S XUTMUCI=Y
"RTN","RGMTRUN",31,0)
 ..D EN^XUTMTP(TASK) W !,LN
"RTN","RGMTRUN",32,0)
 ..I $D(NOTRPC),CNT=5 W ! S DIR(0)="E" D ^DIR K DIR S CNT=0 S:'Y QFLG=1 I Y W @IOF
"RTN","RGMTRUN",33,0)
 ;
"RTN","RGMTRUN",34,0)
QUIT ;Kill variables and quit.
"RTN","RGMTRUN",35,0)
 I $D(NOTRPC) W:$E(IOST)'="C" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGMTRUN",36,0)
 K %,CNT,LN,NOTRPC,QFLG,ROU,TASK,Y,ZTSK
"RTN","RGMTRUN",37,0)
 Q
"RTN","RGMTRUN",38,0)
 ;
"RTN","RGMTRUN",39,0)
 ;
"RTN","RGMTRUN",40,0)
TASK(RETURN) ;Remote HL7 task display
"RTN","RGMTRUN",41,0)
 N ARRAY
"RTN","RGMTRUN",42,0)
 S ARRAY="^TMP(""RGMTHFS"","_$J_")"
"RTN","RGMTRUN",43,0)
 D HFS^RGMTHFS("START^RGMTRUN")
"RTN","RGMTRUN",44,0)
 M RETURN=^TMP("RGMTHFS",$J)
"RTN","RGMTRUN",45,0)
 K ^TMP("RGMTHFS",$J)
"RTN","RGMTRUN",46,0)
 Q
"RTN","RGMTRUN",47,0)
 ;
"RTN","RGSYSTAT")
0^6^B38593850
"RTN","RGSYSTAT",1,0)
RGSYSTAT ;BAY/ALS-MPI/PD STATUS DISPLAY ;01/05/01
"RTN","RGSYSTAT",2,0)
 ;;1.0;CLINCAL INFO RESOURCE NETWORK;**16,19,23,25**;30 Apr 99
"RTN","RGSYSTAT",3,0)
 ;Reference to ^DGCN(391.98,"AST" supported by IA #3303
"RTN","RGSYSTAT",4,0)
 ;Reference to ^DGCN(391.984 supported by IA #3304
"RTN","RGSYSTAT",5,0)
 ;Reference to ^MPIF(984.9 supported by IA #3298
"RTN","RGSYSTAT",6,0)
 ;Reference to OPTSTAT^XUTMOPT supported by IA #1472
"RTN","RGSYSTAT",7,0)
 ;Reference to ^DPT("ACMORS", ^DPT("AICN", and ^DPT("AICNL" supported by IA #2070
"RTN","RGSYSTAT",8,0)
 ;Reference to ^VAT(391.71 supported by IA #3422
"RTN","RGSYSTAT",9,0)
EN ;
"RTN","RGSYSTAT",10,0)
 ; Count exceptions on hand
"RTN","RGSYSTAT",11,0)
EXC ;
"RTN","RGSYSTAT",12,0)
 W @IOF,"Exception Handler Entries:",!,"--------------------------"
"RTN","RGSYSTAT",13,0)
 S CNT=0,EXCTYP="",NTYP="",TOTL=0,PCNT=0
"RTN","RGSYSTAT",14,0)
 N STAT,DFN,ICN
"RTN","RGSYSTAT",15,0)
 S HOME=$$SITE^VASITE()
"RTN","RGSYSTAT",16,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGSYSTAT",17,0)
 . I (EXCTYP=209)!(EXCTYP=227)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGSYSTAT",18,0)
 .. I (EXCTYP'=NTYP)&(CNT>0) D
"RTN","RGSYSTAT",19,0)
 ... S ETEXT=$P($G(^RGHL7(991.11,NTYP,10)),"^",1)
"RTN","RGSYSTAT",20,0)
 ... W !,$E(ETEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",21,0)
 .. S IEN=0,NTYP=EXCTYP
"RTN","RGSYSTAT",22,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",23,0)
 ... S IEN2=0
"RTN","RGSYSTAT",24,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGSYSTAT",25,0)
 .... S STAT=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5) I STAT<1 D
"RTN","RGSYSTAT",26,0)
 ..... S DFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'DFN
"RTN","RGSYSTAT",27,0)
 ..... S ^XTMP("RGEXC",0)=$$FMADD^XLFDT(DT,2)_"^"_DT_"^"_"MPI/PD Status Display"
"RTN","RGSYSTAT",28,0)
 ..... S ^XTMP("RGEXC",DFN)=DFN
"RTN","RGSYSTAT",29,0)
 ..... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGSYSTAT",30,0)
 ..... I $E(ICN,1,3)=$E($P(HOME,"^",3),1,3)!(ICN<0)!((EXCTYP<218)&(EXCTYP>214)) D
"RTN","RGSYSTAT",31,0)
 ...... S CNT=CNT+1
"RTN","RGSYSTAT",32,0)
 I CNT>0 D
"RTN","RGSYSTAT",33,0)
 .S ETEXT=$P($G(^RGHL7(991.11,NTYP,10)),"^",1)
"RTN","RGSYSTAT",34,0)
 .W !,$E(ETEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT
"RTN","RGSYSTAT",35,0)
 I TOTL=0 W !,"There are no entries in the Exception Handler."
"RTN","RGSYSTAT",36,0)
 I TOTL>0 D
"RTN","RGSYSTAT",37,0)
 . W !!,"Total number of exceptions: ",?55,$J(TOTL,6)
"RTN","RGSYSTAT",38,0)
 . S PDFN=""
"RTN","RGSYSTAT",39,0)
 . F  S PDFN=$O(^XTMP("RGEXC",PDFN)) Q:'PDFN  D
"RTN","RGSYSTAT",40,0)
 .. S PCNT=PCNT+1
"RTN","RGSYSTAT",41,0)
 . W !,"Total unique patient exceptions: ",?55,$J(PCNT,6)
"RTN","RGSYSTAT",42,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1)
"RTN","RGSYSTAT",43,0)
 I $D(^RGSITE(991.8,1,"EXCPRG")) D
"RTN","RGSYSTAT",44,0)
 . S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGSYSTAT",45,0)
 . W !!,"The MPI/PD Exception Purge process last ran "_STDT_"."
"RTN","RGSYSTAT",46,0)
 K CNT,EXCTYP,NTYP,ETEXT,TOTL,IEN,IEN2,HOME,PCNT,^XTMP("RGEXC"),PDFN,STDT
"RTN","RGSYSTAT",47,0)
 I $Y>21 D QUIT Q:X="^"
"RTN","RGSYSTAT",48,0)
PDR ;Count entries in Patient Data Review
"RTN","RGSYSTAT",49,0)
 W !!,"Patient Data Review Entries:",!,"----------------------------"
"RTN","RGSYSTAT",50,0)
 S CNT=0,PDRTYP="",NTYP="",TOTL=0
"RTN","RGSYSTAT",51,0)
 F  S PDRTYP=$O(^DGCN(391.98,"AST",PDRTYP)) Q:'PDRTYP  D
"RTN","RGSYSTAT",52,0)
 . I (PDRTYP'=NTYP)&(CNT>0) D
"RTN","RGSYSTAT",53,0)
 .. S DIC="^DGCN(391.984,",DR=".01",DA=NTYP,DIQ(0)="E",DIQ="RGPDR"
"RTN","RGSYSTAT",54,0)
 .. D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","RGSYSTAT",55,0)
 .. S PTEXT=$G(RGPDR(391.984,NTYP,.01,"E"))
"RTN","RGSYSTAT",56,0)
 .. W !,$E(PTEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",57,0)
 . I (PDRTYP=1)!(PDRTYP=2)!(PDRTYP=5) D
"RTN","RGSYSTAT",58,0)
 .. S IEN=0,NTYP=PDRTYP
"RTN","RGSYSTAT",59,0)
 .. F  S IEN=$O(^DGCN(391.98,"AST",PDRTYP,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",60,0)
 ... S CNT=CNT+1
"RTN","RGSYSTAT",61,0)
 I CNT>0 D
"RTN","RGSYSTAT",62,0)
 . S DIC="^DGCN(391.984,",DR=".01",DA=NTYP,DIQ(0)="E",DIQ="RGPDR"
"RTN","RGSYSTAT",63,0)
 . D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","RGSYSTAT",64,0)
 . S PTEXT=$G(RGPDR(391.984,NTYP,.01,"E"))
"RTN","RGSYSTAT",65,0)
 .W !,$E(PTEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT
"RTN","RGSYSTAT",66,0)
 I TOTL=0 W !,"There are no entries in Patient Data Review."
"RTN","RGSYSTAT",67,0)
 K CNT,PDRTYP,NTYP,TOTL,IEN,PTEXT,RGPDR
"RTN","RGSYSTAT",68,0)
 ;Q
"RTN","RGSYSTAT",69,0)
 I $Y>20 D QUIT Q:X="^"
"RTN","RGSYSTAT",70,0)
 ;
"RTN","RGSYSTAT",71,0)
CMOR ;CMOR Requests Status
"RTN","RGSYSTAT",72,0)
 W !!,"CMOR Requests Status:",!,"---------------------"
"RTN","RGSYSTAT",73,0)
 S CNT=0,STAT="",NSTAT="",TOTL=0
"RTN","RGSYSTAT",74,0)
 F  S STAT=$O(^MPIF(984.9,"AC",STAT)) Q:'STAT  D
"RTN","RGSYSTAT",75,0)
 . I (STAT'=NSTAT)&(CNT>0) D
"RTN","RGSYSTAT",76,0)
 .. S TEXT=$$EXTERNAL^DILFD(984.9,.06,,NSTAT)
"RTN","RGSYSTAT",77,0)
 .. W !,$E(TEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",78,0)
 . S IEN=0,NSTAT=STAT
"RTN","RGSYSTAT",79,0)
 . F  S IEN=$O(^MPIF(984.9,"AC",STAT,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",80,0)
 .. S CNT=CNT+1 S TOTL=TOTL+CNT
"RTN","RGSYSTAT",81,0)
 I CNT>0 S TEXT=$$EXTERNAL^DILFD(984.9,.06,,NSTAT) W !,$E(TEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",82,0)
 I TOTL=0 W !,"There are no outstanding CMOR Requests."
"RTN","RGSYSTAT",83,0)
 K CNT,STAT,NSTAT,TEXT,TOTL,IEN
"RTN","RGSYSTAT",84,0)
 I $Y>20 D QUIT Q:X="^"
"RTN","RGSYSTAT",85,0)
 ;
"RTN","RGSYSTAT",86,0)
VAFC ;VAFC BATCH UPDATE background job
"RTN","RGSYSTAT",87,0)
 D OPTSTAT^XUTMOPT("VAFC BATCH UPDATE",.OPTSCH)
"RTN","RGSYSTAT",88,0)
 S TIME=$P($G(OPTSCH(1)),"^",2)
"RTN","RGSYSTAT",89,0)
 I 'TIME W !!,"The VAFC BATCH UPDATE background job is NOT currently scheduled." G AXMIT
"RTN","RGSYSTAT",90,0)
 S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGSYSTAT",91,0)
 W !!,"The VAFC BATCH UPDATE background job is scheduled for "_TIME_"."
"RTN","RGSYSTAT",92,0)
 I $Y>20 D QUIT Q:X="^"
"RTN","RGSYSTAT",93,0)
AXMIT K TIME,OPTSCH
"RTN","RGSYSTAT",94,0)
 S CNT=0,IEN=0 F  S IEN=$O(^VAT(391.71,"AXMIT",4,IEN)) Q:'IEN  S CNT=CNT+1
"RTN","RGSYSTAT",95,0)
 W !?3,"(Total DATA UPDATES waiting to be processed = "_CNT_")"
"RTN","RGSYSTAT",96,0)
 I $Y>20 D QUIT Q:X="^"
"RTN","RGSYSTAT",97,0)
 S CNT=0,IEN=0 F  S IEN=$O(^VAT(391.71,"AXMIT",5,IEN)) Q:'IEN  S CNT=CNT+1
"RTN","RGSYSTAT",98,0)
 W !?3,"(Total TREATING FACILITY UPDATES waiting to be processed = "_CNT_")"
"RTN","RGSYSTAT",99,0)
 I $Y>20 D QUIT Q:X="^"
"RTN","RGSYSTAT",100,0)
 ;
"RTN","RGSYSTAT",101,0)
 ;MPIF LOC/MIS ICN RES background job
"RTN","RGSYSTAT",102,0)
MPIF D OPTSTAT^XUTMOPT("MPIF LOC/MIS ICN RES",.OPTSCH)
"RTN","RGSYSTAT",103,0)
 S TIME=$P($G(OPTSCH(1)),"^",2)
"RTN","RGSYSTAT",104,0)
 I 'TIME W !,"The MPIF LOC/MIS ICN RES background job is NOT currently scheduled." G EQUE
"RTN","RGSYSTAT",105,0)
 S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGSYSTAT",106,0)
 W !,"The MPIF LOC/MIS ICN RES background job is scheduled for "_TIME_"."
"RTN","RGSYSTAT",107,0)
 I $Y>21 D QUIT Q:X="^"
"RTN","RGSYSTAT",108,0)
 S TIME=$P($G(^RGSITE(991.8,1,0)),"^",4) I TIME'="" D
"RTN","RGSYSTAT",109,0)
 .S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGSYSTAT",110,0)
 .W !,"The MPIF LOC/MIS ICN RES background job last ran "_TIME_"."
"RTN","RGSYSTAT",111,0)
 I $Y>21 D QUIT Q:X="^"
"RTN","RGSYSTAT",112,0)
 K TIME,OPTSCH
"RTN","RGSYSTAT",113,0)
 ;
"RTN","RGSYSTAT",114,0)
EQUE ;MPI/PD Event Queue currently running?
"RTN","RGSYSTAT",115,0)
 N SUB1,SUB2
"RTN","RGSYSTAT",116,0)
 L +^RGEQ("MAIN"):0 E  D  G CMSG
"RTN","RGSYSTAT",117,0)
 . W !,"MPI/PD Event Queue processor is currently RUNNING."
"RTN","RGSYSTAT",118,0)
 W !,"MPI/PD Event Queue processor is currently NOT RUNNING."
"RTN","RGSYSTAT",119,0)
 L -^RGEQ("MAIN")
"RTN","RGSYSTAT",120,0)
 ;Count number of entries in event queue
"RTN","RGSYSTAT",121,0)
 S SUB1="",CNT=0 F  S SUB1=$O(^RGEQ(SUB1)) Q:SUB1=""  D
"RTN","RGSYSTAT",122,0)
 .S SUB2="" F  S SUB2=$O(^RGEQ(SUB1,SUB2)) Q:SUB2=""  S CNT=CNT+1
"RTN","RGSYSTAT",123,0)
 W !?3,"(Total entries in Event Queue waiting to be processed = "_CNT_")"
"RTN","RGSYSTAT",124,0)
 I $Y>21 D QUIT Q:X="^"
"RTN","RGSYSTAT",125,0)
 ;
"RTN","RGSYSTAT",126,0)
CMSG ;Stop MPI/PD Messaging field
"RTN","RGSYSTAT",127,0)
 S SEND=$P($G(^RGSITE(991.8,1,1)),"^",6)
"RTN","RGSYSTAT",128,0)
 S CUR=$S(SEND=1:"SEND MESSAGES",SEND=0:"STOP MESSAGES",SEND=2:"SUSPEND MESSAGES",1:"NULL")
"RTN","RGSYSTAT",129,0)
 W !,"STOP MPI/PD MESSAGING currently set to "_CUR_"."
"RTN","RGSYSTAT",130,0)
 K CUR,SEND
"RTN","RGSYSTAT",131,0)
 ;Q
"RTN","RGSYSTAT",132,0)
AUDIT ;Check to see if .01 field in patient file has auditing turned on
"RTN","RGSYSTAT",133,0)
 D FIELD^DID(2,.01,"","AUDIT","PATAUD")
"RTN","RGSYSTAT",134,0)
 S PATAUD=$G(PATAUD("AUDIT"))
"RTN","RGSYSTAT",135,0)
 W !,"Audit on NAME (#.01) field of PATIENT (#2) file set to "_PATAUD
"RTN","RGSYSTAT",136,0)
 K PATAUD
"RTN","RGSYSTAT",137,0)
 I $Y>21 D QUIT Q:X="^"
"RTN","RGSYSTAT",138,0)
CNT ;Count number of patients with a score, counts Nat'l ICNs, counts local ICNs.
"RTN","RGSYSTAT",139,0)
 S SC=0,CNT=0
"RTN","RGSYSTAT",140,0)
 F  S SC=$O(^DPT("ACMORS",SC)) Q:'SC  D
"RTN","RGSYSTAT",141,0)
 .S DFN=0
"RTN","RGSYSTAT",142,0)
 .F  S DFN=$O(^DPT("ACMORS",SC,DFN)) Q:'DFN  D
"RTN","RGSYSTAT",143,0)
 ..S CNT=CNT+1
"RTN","RGSYSTAT",144,0)
 W !!,"Current total number of Patients with CMOR Scores = ",CNT
"RTN","RGSYSTAT",145,0)
 K %,SC,CNT
"RTN","RGSYSTAT",146,0)
 S HOME=$P($$SITE^VASITE(),"^",3)
"RTN","RGSYSTAT",147,0)
 S ICN=0,CNT=0
"RTN","RGSYSTAT",148,0)
 F  S ICN=$O(^DPT("AICN",ICN)) Q:'ICN  D
"RTN","RGSYSTAT",149,0)
 .Q:$E(ICN,1,3)=HOME
"RTN","RGSYSTAT",150,0)
 .S CNT=CNT+1
"RTN","RGSYSTAT",151,0)
 W !,"Current total number of National ICNs = ",CNT
"RTN","RGSYSTAT",152,0)
 S ICN=0,CNT=0
"RTN","RGSYSTAT",153,0)
 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S CNT=CNT+1
"RTN","RGSYSTAT",154,0)
 W !,"Current total number of Local ICNs = ",CNT
"RTN","RGSYSTAT",155,0)
 K CNT,DFN,ICN
"RTN","RGSYSTAT",156,0)
QUIT S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGSYSTAT",157,0)
 .S SS=21-$Y F JJ=1:1:SS W !
"RTN","RGSYSTAT",158,0)
 S $Y=0
"RTN","RGSYSTAT",159,0)
 K JJ,SS
"RTN","RGSYSTAT",160,0)
 Q
"VER")
8.0^22.0
**END**
**END**
