Released KMPD*1*2 SEQ #2
Extracted from mail message
**KIDS**:KMPD*1.0*2^

**INSTALL NAME**
KMPD*1.0*2
"BLD",4945,0)
KMPD*1.0*2^CM TOOLS^0^3031104^y
"BLD",4945,1,0)
^^1^1^3030718^
"BLD",4945,1,1,0)
Patch for CM Tools v1.0
"BLD",4945,4,0)
^9.64PA^8973.2^1
"BLD",4945,4,8973.2,0)
8973.2
"BLD",4945,4,8973.2,222)
y^y^f^^^^n
"BLD",4945,4,"B",8973.2,8973.2)

"BLD",4945,"KRN",0)
^9.67PA^8989.52^19
"BLD",4945,"KRN",.4,0)
.4
"BLD",4945,"KRN",.401,0)
.401
"BLD",4945,"KRN",.402,0)
.402
"BLD",4945,"KRN",.403,0)
.403
"BLD",4945,"KRN",.5,0)
.5
"BLD",4945,"KRN",.84,0)
.84
"BLD",4945,"KRN",3.6,0)
3.6
"BLD",4945,"KRN",3.8,0)
3.8
"BLD",4945,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",4945,"KRN",3.8,"NM",1,0)
KMP-CAPMAN^^0
"BLD",4945,"KRN",3.8,"NM","B","KMP-CAPMAN",1)

"BLD",4945,"KRN",9.2,0)
9.2
"BLD",4945,"KRN",9.8,0)
9.8
"BLD",4945,"KRN",9.8,"NM",0)
^9.68A^21^21
"BLD",4945,"KRN",9.8,"NM",1,0)
KMPDBD01^^0^B1588515
"BLD",4945,"KRN",9.8,"NM",2,0)
KMPDHU01^^0^B36352853
"BLD",4945,"KRN",9.8,"NM",3,0)
KMPDHU02^^0^B58746526
"BLD",4945,"KRN",9.8,"NM",4,0)
KMPDSS^^0^B29930299
"BLD",4945,"KRN",9.8,"NM",5,0)
KMPDTU02^^0^B8647823
"BLD",4945,"KRN",9.8,"NM",6,0)
KMPDUTL^^0^B5892376
"BLD",4945,"KRN",9.8,"NM",7,0)
KMPDUTL2^^0^B9676981
"BLD",4945,"KRN",9.8,"NM",8,0)
KMPDUTL4^^0^B6815055
"BLD",4945,"KRN",9.8,"NM",9,0)
KMPDTP1^^0^B15666050
"BLD",4945,"KRN",9.8,"NM",10,0)
KMPDTP2^^0^B21206441
"BLD",4945,"KRN",9.8,"NM",11,0)
KMPDTP3^^0^B19734798
"BLD",4945,"KRN",9.8,"NM",12,0)
KMPDTU10^^0^B33878359
"BLD",4945,"KRN",9.8,"NM",13,0)
KMPDUT2^^0^B29018158
"BLD",4945,"KRN",9.8,"NM",14,0)
KMPDUTL1^^0^B21710774
"BLD",4945,"KRN",9.8,"NM",15,0)
KMPDUTL5^^0^B32139053
"BLD",4945,"KRN",9.8,"NM",16,0)
KMPDTP4^^0^B26904696
"BLD",4945,"KRN",9.8,"NM",17,0)
KMPDTP5^^0^B26931833
"BLD",4945,"KRN",9.8,"NM",18,0)
KMPDUTL3^^0^B2441051
"BLD",4945,"KRN",9.8,"NM",19,0)
KMPDTU11^^0^B1921419
"BLD",4945,"KRN",9.8,"NM",20,0)
KMPDTP6^^0^B26628636
"BLD",4945,"KRN",9.8,"NM",21,0)
KMPDTP7^^0^B22931421
"BLD",4945,"KRN",9.8,"NM","B","KMPDBD01",1)

"BLD",4945,"KRN",9.8,"NM","B","KMPDHU01",2)

"BLD",4945,"KRN",9.8,"NM","B","KMPDHU02",3)

"BLD",4945,"KRN",9.8,"NM","B","KMPDSS",4)

"BLD",4945,"KRN",9.8,"NM","B","KMPDTP1",9)

"BLD",4945,"KRN",9.8,"NM","B","KMPDTP2",10)

"BLD",4945,"KRN",9.8,"NM","B","KMPDTP3",11)

"BLD",4945,"KRN",9.8,"NM","B","KMPDTP4",16)

"BLD",4945,"KRN",9.8,"NM","B","KMPDTP5",17)

"BLD",4945,"KRN",9.8,"NM","B","KMPDTP6",20)

"BLD",4945,"KRN",9.8,"NM","B","KMPDTP7",21)

"BLD",4945,"KRN",9.8,"NM","B","KMPDTU02",5)

"BLD",4945,"KRN",9.8,"NM","B","KMPDTU10",12)

"BLD",4945,"KRN",9.8,"NM","B","KMPDTU11",19)

"BLD",4945,"KRN",9.8,"NM","B","KMPDUT2",13)

"BLD",4945,"KRN",9.8,"NM","B","KMPDUTL",6)

"BLD",4945,"KRN",9.8,"NM","B","KMPDUTL1",14)

"BLD",4945,"KRN",9.8,"NM","B","KMPDUTL2",7)

"BLD",4945,"KRN",9.8,"NM","B","KMPDUTL3",18)

"BLD",4945,"KRN",9.8,"NM","B","KMPDUTL4",8)

"BLD",4945,"KRN",9.8,"NM","B","KMPDUTL5",15)

"BLD",4945,"KRN",19,0)
19
"BLD",4945,"KRN",19,"NM",0)
^9.68A^18^17
"BLD",4945,"KRN",19,"NM",1,0)
KMPD BACKGROUND DRIVER^^0
"BLD",4945,"KRN",19,"NM",2,0)
KMPD CM TOOLS MANAGER MENU^^0
"BLD",4945,"KRN",19,"NM",3,0)
KMPD CM TOOLS REPORTS^^0
"BLD",4945,"KRN",19,"NM",4,0)
KMPD STATUS^^0
"BLD",4945,"KRN",19,"NM",5,0)
KMPD TMG AVG TTL^^0
"BLD",4945,"KRN",19,"NM",6,0)
KMPD TMG DLY TTL DETAIL^^0
"BLD",4945,"KRN",19,"NM",7,0)
KMPD TMG HRLY TTL^^0
"BLD",4945,"KRN",19,"NM",8,0)
KMPD TMG HRLY TTL DETAIL^^0
"BLD",4945,"KRN",19,"NM",9,0)
KMPD TMG TTL ALERT^^0
"BLD",4945,"KRN",19,"NM",10,0)
XTCM MAIN^^3
"BLD",4945,"KRN",19,"NM",11,0)
KMP MAIL GROUP EDIT^^0
"BLD",4945,"KRN",19,"NM",12,0)
KMPD TMG CPRS REPORTS^^1^
"BLD",4945,"KRN",19,"NM",14,0)
KMPD TMG START/STOP^^0
"BLD",4945,"KRN",19,"NM",15,0)
KMPD TMG COVERSHEET REPORTS^^1^
"BLD",4945,"KRN",19,"NM",16,0)
KMPD TMG TTL ALERT RT^^0
"BLD",4945,"KRN",19,"NM",17,0)
KMPD TMG HRLY TTL RT^^0
"BLD",4945,"KRN",19,"NM",18,0)
KMPD TMG REPORTS^^0
"BLD",4945,"KRN",19,"NM","B","KMP MAIL GROUP EDIT",11)

"BLD",4945,"KRN",19,"NM","B","KMPD BACKGROUND DRIVER",1)

"BLD",4945,"KRN",19,"NM","B","KMPD CM TOOLS MANAGER MENU",2)

"BLD",4945,"KRN",19,"NM","B","KMPD CM TOOLS REPORTS",3)

"BLD",4945,"KRN",19,"NM","B","KMPD STATUS",4)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG AVG TTL",5)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG COVERSHEET REPORTS",15)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG CPRS REPORTS",12)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG DLY TTL DETAIL",6)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG HRLY TTL",7)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG HRLY TTL DETAIL",8)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG HRLY TTL RT",17)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG REPORTS",18)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG START/STOP",14)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG TTL ALERT",9)

"BLD",4945,"KRN",19,"NM","B","KMPD TMG TTL ALERT RT",16)

"BLD",4945,"KRN",19,"NM","B","XTCM MAIN",10)

"BLD",4945,"KRN",19.1,0)
19.1
"BLD",4945,"KRN",101,0)
101
"BLD",4945,"KRN",409.61,0)
409.61
"BLD",4945,"KRN",771,0)
771
"BLD",4945,"KRN",870,0)
870
"BLD",4945,"KRN",8989.51,0)
8989.51
"BLD",4945,"KRN",8989.52,0)
8989.52
"BLD",4945,"KRN",8994,0)
8994
"BLD",4945,"KRN","B",.4,.4)

"BLD",4945,"KRN","B",.401,.401)

"BLD",4945,"KRN","B",.402,.402)

"BLD",4945,"KRN","B",.403,.403)

"BLD",4945,"KRN","B",.5,.5)

"BLD",4945,"KRN","B",.84,.84)

"BLD",4945,"KRN","B",3.6,3.6)

"BLD",4945,"KRN","B",3.8,3.8)

"BLD",4945,"KRN","B",9.2,9.2)

"BLD",4945,"KRN","B",9.8,9.8)

"BLD",4945,"KRN","B",19,19)

"BLD",4945,"KRN","B",19.1,19.1)

"BLD",4945,"KRN","B",101,101)

"BLD",4945,"KRN","B",409.61,409.61)

"BLD",4945,"KRN","B",771,771)

"BLD",4945,"KRN","B",870,870)

"BLD",4945,"KRN","B",8989.51,8989.51)

"BLD",4945,"KRN","B",8989.52,8989.52)

"BLD",4945,"KRN","B",8994,8994)

"BLD",4945,"QUES",0)
^9.62^^
"BLD",4945,"REQB",0)
^9.611^1^1
"BLD",4945,"REQB",1,0)
KMPD*1.0*1^1
"BLD",4945,"REQB","B","KMPD*1.0*1",1)

"FIA",8973.2)
CP TIMING
"FIA",8973.2,0)
^KMPD(8973.2,
"FIA",8973.2,0,0)
8973.2I
"FIA",8973.2,0,1)
y^y^f^^^^n
"FIA",8973.2,0,10)

"FIA",8973.2,0,11)

"FIA",8973.2,0,"RLRO")

"FIA",8973.2,0,"VR")
1.0^KMPD
"FIA",8973.2,8973.2)
0
"KRN",3.8,2076,-1)
0^1
"KRN",3.8,2076,0)
KMP-CAPMAN^PU^n^^^^
"KRN",3.8,2076,2,0)
^3.801^2^2^3030519^^^^
"KRN",3.8,2076,2,1,0)
This mail group will receive messages for all Capacity Management packages
"KRN",3.8,2076,2,2,0)
(SAGG, RUM).
"KRN",3.8,2076,3)

"KRN",3.8,2076,6,0)
^3.812^1^1
"KRN",3.8,2076,6,1,0)
G.A1B5@ISC-BIR
"KRN",3.8,2076,6,"B","G.A1B5@ISC-BIR",1)

"KRN",19,10393,-1)
3^10
"KRN",19,10393,0)
XTCM MAIN^Capacity Planning^^M^^^^^^^^TOOLKIT
"KRN",19,10393,1,0)
^19.06^2^2^3030829^^^^
"KRN",19,10393,1,1,0)
This menu holds all the currently available capacity management
"KRN",19,10393,1,2,0)
functions.
"KRN",19,10393,10,0)
^19.01IP^12^12
"KRN",19,10393,10,10,0)
16512^CPG
"KRN",19,10393,10,10,"^")
KMP MAIL GROUP EDIT
"KRN",19,10393,10,12,0)
18205^TLS
"KRN",19,10393,10,12,"^")
KMPD CM TOOLS MANAGER MENU
"KRN",19,10393,99)
59477,54579
"KRN",19,10393,99.1)
55707,82829
"KRN",19,10393,"U")
CAPACITY PLANNING
"KRN",19,16512,-1)
0^11
"KRN",19,16512,0)
KMP MAIL GROUP EDIT^Capacity Planning Mail Group Edit^^A^^^^^^^^^^1^^^
"KRN",19,16512,1,0)
^19.06^1^1^3030829^^^^
"KRN",19,16512,1,1,0)
This option is used to edit mail group KMP-CAPMAN.
"KRN",19,16512,20)
W !!?21," Edit Capacity Planning Mail Group " N DA,DIE,DR,X,Y S DIE=3.8,DR="1:7.9;10.1:99",DA=$O(^XMB(3.8,"B","KMP-CAPMAN",0)) W:'DA *7,!?3,"Mail group 'KMP-CAPMAN' is not defined!" Q:'DA  W !!,"NAME: ",$P($G(^XMB(3.8,DA,0)),U) D ^DIE
"KRN",19,16512,26)

"KRN",19,16512,99)
55595,47667
"KRN",19,16512,99.1)
57661,35273
"KRN",19,16512,"U")
CAPACITY PLANNING MAIL GROUP E
"KRN",19,18104,-1)
0^1
"KRN",19,18104,0)
KMPD BACKGROUND DRIVER^CM Tools Background Driver^^R^^^^^^^^CM TOOLS
"KRN",19,18104,1,0)
^19.06^6^6^3020220^^^^
"KRN",19,18104,1,1,0)
This option should be queued to run each night (1:30am recommended).  Each
"KRN",19,18104,1,2,0)
night it will compress HL7 data into daily statistics and store this data
"KRN",19,18104,1,3,0)
in file #8973.1 (CM HL7 DATA).  Each Sunday this daily data will be
"KRN",19,18104,1,4,0)
compiled into weekly stats and shipped (via MailMan) to the CM National
"KRN",19,18104,1,5,0)
Database.  After the weekly transmission, file #8973.1 will be purged,
"KRN",19,18104,1,6,0)
leaving only two weeks of data.
"KRN",19,18104,25)
KMPDBD01
"KRN",19,18104,200.9)
y^y
"KRN",19,18104,"U")
CM TOOLS BACKGROUND DRIVER
"KRN",19,18204,-1)
0^4
"KRN",19,18204,0)
KMPD STATUS^Check CM Tools Environment^^R^^^^^^^^CM TOOLS
"KRN",19,18204,1,0)
^^2^2^3020220^
"KRN",19,18204,1,1,0)
This option displays the status of the [KMPD BACKGROUND DRIVER] option, 
"KRN",19,18204,1,2,0)
and information on the CM HL7 DATA file (#8973.1).
"KRN",19,18204,25)
EN^KMPDSS
"KRN",19,18204,"U")
CHECK CM TOOLS ENVIRONMENT
"KRN",19,18205,-1)
0^2
"KRN",19,18205,0)
KMPD CM TOOLS MANAGER MENU^CP Tools Manager Menu^^M^^^^^^^^CM TOOLS
"KRN",19,18205,10,0)
^19.01IP^3^3
"KRN",19,18205,10,1,0)
18204^STA^1
"KRN",19,18205,10,1,"^")
KMPD STATUS
"KRN",19,18205,10,2,0)
18921^RPT^3
"KRN",19,18205,10,2,"^")
KMPD CM TOOLS REPORTS
"KRN",19,18205,10,3,0)
19005^SST^2
"KRN",19,18205,10,3,"^")
KMPD TMG START/STOP
"KRN",19,18205,99)
59477,54580
"KRN",19,18205,"U")
CP TOOLS MANAGER MENU
"KRN",19,18921,-1)
0^3
"KRN",19,18921,0)
KMPD CM TOOLS REPORTS^CP Tools Reports^^M^^^^^^^^CM TOOLS
"KRN",19,18921,10,0)
^19.01IP^1^1
"KRN",19,18921,10,1,0)
19095^TMG^1
"KRN",19,18921,10,1,"^")
KMPD TMG REPORTS
"KRN",19,18921,99)
59477,54581
"KRN",19,18921,"U")
CP TOOLS REPORTS
"KRN",19,18922,-1)
0^5
"KRN",19,18922,0)
KMPD TMG AVG TTL^Average Daily Coversheet Load^^R^^^^^^^^CM TOOLS
"KRN",19,18922,1,0)
^^3^3^3030903^
"KRN",19,18922,1,1,0)
This report displays the daily average time-to-load value for the
"KRN",19,18922,1,2,0)
coversheet at this site.  Average time-to-load values are given for either
"KRN",19,18922,1,3,0)
daily prime time or non-prime time periods.
"KRN",19,18922,25)
EN^KMPDTP1
"KRN",19,18922,"U")
AVERAGE DAILY COVERSHEET LOAD
"KRN",19,18927,-1)
0^6
"KRN",19,18927,0)
KMPD TMG DLY TTL DETAIL^Detailed Daily Coversheet Load^^R^^^^^^^^CM TOOLS
"KRN",19,18927,1,0)
^^3^3^3030903^
"KRN",19,18927,1,1,0)
This detailed report displays daily time-to-load values for the coversheet
"KRN",19,18927,1,2,0)
at this site.  The report breaks the time-to-load metrics into ten second
"KRN",19,18927,1,3,0)
groupings.
"KRN",19,18927,25)
EN^KMPDTP2
"KRN",19,18927,"U")
DETAILED DAILY COVERSHEET LOAD
"KRN",19,18928,-1)
0^7
"KRN",19,18928,0)
KMPD TMG HRLY TTL^Average Hourly Coversheet Load^^R^^^^^^^^CM TOOLS
"KRN",19,18928,1,0)
^^2^2^3030903^
"KRN",19,18928,1,1,0)
This report displays the hourly average time-to-load value the coversheet
"KRN",19,18928,1,2,0)
at this site over 24 hours.
"KRN",19,18928,25)
EN^KMPDTP3
"KRN",19,18928,"U")
AVERAGE HOURLY COVERSHEET LOAD
"KRN",19,18990,-1)
0^8
"KRN",19,18990,0)
KMPD TMG HRLY TTL DETAIL^Detailed Hourly Coversheet Load^^R^^^^^^^^CM TOOLS
"KRN",19,18990,1,0)
^^3^3^3030903^
"KRN",19,18990,1,1,0)
This detail report displays the hourly time-to-load values for the
"KRN",19,18990,1,2,0)
coversheet at this site.  The report breaks the time-to-load metrics into
"KRN",19,18990,1,3,0)
ten second groupings.
"KRN",19,18990,25)
EN^KMPDTP4
"KRN",19,18990,"U")
DETAILED HOURLY COVERSHEET LOA
"KRN",19,18991,-1)
0^9
"KRN",19,18991,0)
KMPD TMG TTL ALERT^Threshold Alert^^R^^^^^^^^CM TOOLS
"KRN",19,18991,1,0)
^^3^3^3030903^
"KRN",19,18991,1,1,0)
This alerting report shows the particular coversheet loads which had
"KRN",19,18991,1,2,0)
excessive time-to-load values. This report will search for a particular
"KRN",19,18991,1,3,0)
person, a particular client name or IP address.
"KRN",19,18991,25)
EN^KMPDTP5
"KRN",19,18991,"U")
THRESHOLD ALERT
"KRN",19,19005,-1)
0^14
"KRN",19,19005,0)
KMPD TMG START/STOP^Start/Stop Timing Collection^^R^^^^^^^^CM TOOLS
"KRN",19,19005,25)
SST^KMPDSS
"KRN",19,19005,"U")
START/STOP TIMING COLLECTION
"KRN",19,19056,-1)
0^16
"KRN",19,19056,0)
KMPD TMG TTL ALERT RT^Real-Time Threshold Alert^^R^^^^^^^^CM TOOLS
"KRN",19,19056,1,0)
^^3^3^3030924^
"KRN",19,19056,1,1,0)
This alerting report shows the particular coversheet loads which have
"KRN",19,19056,1,2,0)
excessive time-to-load values for TODAY (Real-Time). This report will
"KRN",19,19056,1,3,0)
search for a particular person, a particular client name or IP address.
"KRN",19,19056,25)
EN^KMPDTP6
"KRN",19,19056,"U")
REAL-TIME THRESHOLD ALERT
"KRN",19,19067,-1)
0^17
"KRN",19,19067,0)
KMPD TMG HRLY TTL RT^Real-Time Average Hourly Coversheet Load^^R^^^^^^^^CM TOOLS
"KRN",19,19067,1,0)
^^2^2^3030925^
"KRN",19,19067,1,1,0)
This report displays the hourly average time-to-load value the coversheet
"KRN",19,19067,1,2,0)
at this site over 24 hours.
"KRN",19,19067,25)
EN^KMPDTP7
"KRN",19,19067,"U")
REAL-TIME AVERAGE HOURLY COVER
"KRN",19,19095,-1)
0^18
"KRN",19,19095,0)
KMPD TMG REPORTS^Timing Reports^^M^^^^^^^^CM TOOLS
"KRN",19,19095,10,0)
^19.01IP^7^7
"KRN",19,19095,10,1,0)
18922^AVD^1
"KRN",19,19095,10,1,"^")
KMPD TMG AVG TTL
"KRN",19,19095,10,2,0)
18928^AVH^2
"KRN",19,19095,10,2,"^")
KMPD TMG HRLY TTL
"KRN",19,19095,10,3,0)
18927^DTD^3
"KRN",19,19095,10,3,"^")
KMPD TMG DLY TTL DETAIL
"KRN",19,19095,10,4,0)
18990^DTH^4
"KRN",19,19095,10,4,"^")
KMPD TMG HRLY TTL DETAIL
"KRN",19,19095,10,5,0)
18991^TAL^5
"KRN",19,19095,10,5,"^")
KMPD TMG TTL ALERT
"KRN",19,19095,10,6,0)
19056^RTA^6
"KRN",19,19095,10,6,"^")
KMPD TMG TTL ALERT RT
"KRN",19,19095,10,7,0)
19067^RAV^7
"KRN",19,19095,10,7,"^")
KMPD TMG HRLY TTL RT
"KRN",19,19095,99)
59477,54581
"KRN",19,19095,"U")
TIMING REPORTS
"KRN",19,19193,-1)
1^12
"KRN",19,19193,0)
KMPD TMG CPRS REPORTS
"KRN",19,19194,-1)
1^15
"KRN",19,19194,0)
KMPD TMG COVERSHEET REPORTS
"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",556,-1)
1^1
"PKG",556,0)
CM TOOLS^KMPD^Capacity Management Tools
"PKG",556,22,0)
^9.49I^1^1
"PKG",556,22,1,0)
1.0^3020311^3020311^10292
"PKG",556,22,1,"PAH",1,0)
2^3031104^10292
"PKG",556,22,1,"PAH",1,1,0)
^^1^1^3031104
"PKG",556,22,1,"PAH",1,1,1,0)
Patch for CM Tools v1.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
21
"RTN","KMPDBD01")
0^1^B1588515
"RTN","KMPDBD01",1,0)
KMPDBD01 ;OAK/RAK - CM Tools Background Driver ;11/4/03  14:27
"RTN","KMPDBD01",2,0)
 ;;1.0;CM TOOLS;**1,2**;Mar 22, 2002
"RTN","KMPDBD01",3,0)
 ;
"RTN","KMPDBD01",4,0)
EN ;-entry point for background driver
"RTN","KMPDBD01",5,0)
 ;
"RTN","KMPDBD01",6,0)
 S:'$G(DT) DT=$$DT^XLFDT
"RTN","KMPDBD01",7,0)
 ;
"RTN","KMPDBD01",8,0)
 N DAILY,STR
"RTN","KMPDBD01",9,0)
 ;
"RTN","KMPDBD01",10,0)
 ; hl7
"RTN","KMPDBD01",11,0)
 ; compile and store daily stats in file 8973.1 (CM HL7 DATA)
"RTN","KMPDBD01",12,0)
 S STR=$$NOW^XLFDT,DAILY=$$FMADD^XLFDT(DT,-1)
"RTN","KMPDBD01",13,0)
 D DAILY^KMPDHU02(DAILY,DAILY)
"RTN","KMPDBD01",14,0)
 ; store start, stop and delta times for daily background job
"RTN","KMPDBD01",15,0)
 D STRSTP^KMPDUTL2("HL7","DLY","TOTAL",STR)
"RTN","KMPDBD01",16,0)
 ;
"RTN","KMPDBD01",17,0)
 ; timing
"RTN","KMPDBD01",18,0)
 ; compile and store timing stats in file 8973.2 (CP TIMING)
"RTN","KMPDBD01",19,0)
 S STR=$$NOW^XLFDT
"RTN","KMPDBD01",20,0)
 D DAILY^KMPDTU02
"RTN","KMPDBD01",21,0)
 ; store start, stop and delta times for daily background job
"RTN","KMPDBD01",22,0)
 D STRSTP^KMPDUTL2("TMG","DLY","TOTAL",STR)
"RTN","KMPDBD01",23,0)
 ; purge entries from file 8973.2 (CP TIMING)
"RTN","KMPDBD01",24,0)
 S STR=$$NOW^XLFDT
"RTN","KMPDBD01",25,0)
 D PURGE1^KMPDUTL3(30)
"RTN","KMPDBD01",26,0)
 ; store start, stop and delta times for daily background job
"RTN","KMPDBD01",27,0)
 D STRSTP^KMPDUTL2("TMG","DLY","PURGE",STR)
"RTN","KMPDBD01",28,0)
 ;
"RTN","KMPDBD01",29,0)
 ; if sunday do weekly compression, transmit data to cm national
"RTN","KMPDBD01",30,0)
 ; database, and purge file #8973.1 (cm hl7 data) of old data
"RTN","KMPDBD01",31,0)
 I '$$DOW^XLFDT(DT,1) D 
"RTN","KMPDBD01",32,0)
 .; weekly compression
"RTN","KMPDBD01",33,0)
 .S STR=$$NOW^XLFDT
"RTN","KMPDBD01",34,0)
 .D WEEKLY^KMPDHU01(DT,1)
"RTN","KMPDBD01",35,0)
 .; store start, stop and delta times for weekly background job
"RTN","KMPDBD01",36,0)
 .D STRSTP^KMPDUTL2("HL7","WKY","TOTAL",STR)
"RTN","KMPDBD01",37,0)
 ;
"RTN","KMPDBD01",38,0)
 Q
"RTN","KMPDHU01")
0^2^B36352853
"RTN","KMPDHU01",1,0)
KMPDHU01 ;OAK/RAK - CM Tools HL7 Utility ;11/4/03  14:27
"RTN","KMPDHU01",2,0)
 ;;1.0;CM TOOLS;**1,2**;Mar 22, 2002
"RTN","KMPDHU01",3,0)
 ;
"RTN","KMPDHU01",4,0)
WEEKLY(KMPDT,KMPDPRGE) ;-- compress daily stats to weekly
"RTN","KMPDHU01",5,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU01",6,0)
 ; KMPDT.... Compression date in internal fileman formt.  This date
"RTN","KMPDHU01",7,0)
 ;           must be a Sunday.  It represents the date from which the
"RTN","KMPDHU01",8,0)
 ;           previous weeks data should be compressed. 
"RTN","KMPDHU01",9,0)
 ;           Example: if KMPDT = 2981011  then compression will begin
"RTN","KMPDHU01",10,0)
 ;                    on 2981010 (KMPDT-1)
"RTN","KMPDHU01",11,0)
 ; KMPDPRGE. 0 - do not purge data from file #8973.1
"RTN","KMPDHU01",12,0)
 ;           1 - purge data from file #8973.1
"RTN","KMPDHU01",13,0)
 ;
"RTN","KMPDHU01",14,0)
 ; Every Sunday compress the daily stats in file #8973.1 into weekly
"RTN","KMPDHU01",15,0)
 ; and upload the data to the CM RUM National Database
"RTN","KMPDHU01",16,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU01",17,0)
 ;
"RTN","KMPDHU01",18,0)
 Q:'$G(KMPDT)
"RTN","KMPDHU01",19,0)
 S KMPDPRGE=+$G(KMPDPRGE)
"RTN","KMPDHU01",20,0)
 ;
"RTN","KMPDHU01",21,0)
 N DATA,DATE,DELDATE,EN,END,HOURS,I,IEN,J,NM,PT,SITE,STR,START,SYNC
"RTN","KMPDHU01",22,0)
 ;
"RTN","KMPDHU01",23,0)
 ; quit if not sunday.
"RTN","KMPDHU01",24,0)
 Q:$$DOW^XLFDT(KMPDT,1)
"RTN","KMPDHU01",25,0)
 ; storage  processed
"RTN","KMPDHU01",26,0)
 K ^TMP($J),^TMP("KMPDHU01",$J)
"RTN","KMPDHU01",27,0)
 ; site info.
"RTN","KMPDHU01",28,0)
 S SITE=$$SITE^VASITE Q:SITE=""
"RTN","KMPDHU01",29,0)
 S DATE=KMPDT
"RTN","KMPDHU01",30,0)
 S (START,END)="",STR=$$NOW^XLFDT
"RTN","KMPDHU01",31,0)
 ; Date to begin deletion.
"RTN","KMPDHU01",32,0)
 S DELDATE=$$FMADD^XLFDT(KMPDT,-14)
"RTN","KMPDHU01",33,0)
 ;
"RTN","KMPDHU01",34,0)
 W:'$D(ZTQUEUED) !,"Compressing data into weekly format..."
"RTN","KMPDHU01",35,0)
 ; Reverse $order to get previous dates.
"RTN","KMPDHU01",36,0)
 F  S DATE=$O(^KMPD(8973.1,"B",DATE),-1) Q:'DATE  D 
"RTN","KMPDHU01",37,0)
 .; If DATE is saturday set START and END dates and kill TMPARRY.
"RTN","KMPDHU01",38,0)
 .I $$DOW^XLFDT(DATE,1)=6 D 
"RTN","KMPDHU01",39,0)
 ..S END=DATE,START=$$FMADD^XLFDT(DATE,-6)
"RTN","KMPDHU01",40,0)
 ..K ^TMP($J)
"RTN","KMPDHU01",41,0)
 .Q:'START
"RTN","KMPDHU01",42,0)
 .S SYNC=0
"RTN","KMPDHU01",43,0)
 .F  S SYNC=$O(^KMPD(8973.1,"ASYNC",DATE,SYNC)) Q:'SYNC  S IEN=0 D 
"RTN","KMPDHU01",44,0)
 ..F  S IEN=$O(^KMPD(8973.1,"ASYNC",DATE,SYNC,IEN)) Q:'IEN  D 
"RTN","KMPDHU01",45,0)
 ...Q:'$D(^KMPD(8973.1,IEN,0))
"RTN","KMPDHU01",46,0)
 ...; data nodes into DATA() array.
"RTN","KMPDHU01",47,0)
 ...S DATA(0)=^KMPD(8973.1,IEN,0) F I=1,1.1,1.2,2,2.1,2.2,5.1:.1:5.5,5.7,5.8,5.9,99,99.2,99.3,99.5 S DATA(I)=$G(^(I))
"RTN","KMPDHU01",48,0)
 ...; quit if data has already been sent to national database
"RTN","KMPDHU01",49,0)
 ...Q:$P(DATA(0),U,2)
"RTN","KMPDHU01",50,0)
 ...; quit if no namespace or protocol
"RTN","KMPDHU01",51,0)
 ...S NM=$P(DATA(0),U,3),PT=$P(DATA(0),U,5) Q:NM=""!(PT="")
"RTN","KMPDHU01",52,0)
 ...; change first piece to start date (this is for national database)
"RTN","KMPDHU01",53,0)
 ...S $P(DATA(0),U)=START
"RTN","KMPDHU01",54,0)
 ...; second piece not applicable to national database
"RTN","KMPDHU01",55,0)
 ...S $P(DATA(0),U,2)=""
"RTN","KMPDHU01",56,0)
 ...D @$S(SYNC=2:"ASYNC(IEN,NM,PT,.DATA)",1:"SYNC(IEN,NM,PT,.DATA)")
"RTN","KMPDHU01",57,0)
 ...; add to processed array.
"RTN","KMPDHU01",58,0)
 ...S ^TMP("KMPDHU01",$J,IEN)=""
"RTN","KMPDHU01",59,0)
 .;
"RTN","KMPDHU01",60,0)
 .; Back to DATE level.
"RTN","KMPDHU01",61,0)
 .; If START then transmit data.
"RTN","KMPDHU01",62,0)
 .I DATE=START I $D(^TMP($J)) D TRANSMIT K ^TMP($J)
"RTN","KMPDHU01",63,0)
 ;
"RTN","KMPDHU01",64,0)
 D:$D(^TMP($J)) TRANSMIT
"RTN","KMPDHU01",65,0)
 K ^TMP($J)
"RTN","KMPDHU01",66,0)
 ;
"RTN","KMPDHU01",67,0)
 S STR=$$NOW^XLFDT
"RTN","KMPDHU01",68,0)
 ; update field .02 (SENT TO CM NATIONAL DATABASE) to 'YES' for all
"RTN","KMPDHU01",69,0)
 ; processed entries.
"RTN","KMPDHU01",70,0)
 W:'$D(ZTQUEUED) !!,"Updating records to reflect transmission..."
"RTN","KMPDHU01",71,0)
 S IEN=0
"RTN","KMPDHU01",72,0)
 F  S IEN=$O(^TMP("KMPDHU01",$J,IEN)) Q:'IEN  D 
"RTN","KMPDHU01",73,0)
 .K FDA,ERROR W:'$D(ZTQUEUED) "."
"RTN","KMPDHU01",74,0)
 .S FDA($J,8973.1,IEN_",",.02)=1
"RTN","KMPDHU01",75,0)
 .D FILE^DIE("","FDA($J)","ERROR")
"RTN","KMPDHU01",76,0)
 ;
"RTN","KMPDHU01",77,0)
 K ^TMP("KMPDHU01",$J)
"RTN","KMPDHU01",78,0)
 ;
"RTN","KMPDHU01",79,0)
 D STRSTP^KMPDUTL2("HL7","WKY","UPDT",STR)
"RTN","KMPDHU01",80,0)
 ;
"RTN","KMPDHU01",81,0)
 S STR=$$NOW^XLFDT
"RTN","KMPDHU01",82,0)
 ; leave two complete weeks of data in file #8973.1
"RTN","KMPDHU01",83,0)
 D:KMPDPRGE PURGE^KMPDUTL3(DELDATE)
"RTN","KMPDHU01",84,0)
 D STRSTP^KMPDUTL2("HL7","WKY","PURGE",STR)
"RTN","KMPDHU01",85,0)
 ;
"RTN","KMPDHU01",86,0)
 W:'$D(ZTQUEUED) !!,"Finished!"
"RTN","KMPDHU01",87,0)
 ;
"RTN","KMPDHU01",88,0)
 Q
"RTN","KMPDHU01",89,0)
 ;
"RTN","KMPDHU01",90,0)
ASYNC(IEN,NM,PR,DATA) ; compile asynchronous stats
"RTN","KMPDHU01",91,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU01",92,0)
 ; IEN..... Ien for file #8973.1 (CM HL7 DATA)
"RTN","KMPDHU01",93,0)
 ; NM...... Namespace (free text)
"RTN","KMPDHU01",94,0)
 ; PR...... Protocol (free text)
"RTN","KMPDHU01",95,0)
 ; DATA().. Array containing node data for file #8973.1 (CM HL7 DATA)
"RTN","KMPDHU01",96,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU01",97,0)
 Q:'$G(IEN)
"RTN","KMPDHU01",98,0)
 Q:$G(NM)=""
"RTN","KMPDHU01",99,0)
 Q:$G(PR)=""
"RTN","KMPDHU01",100,0)
 Q:'$D(DATA)
"RTN","KMPDHU01",101,0)
 N CS,I,J
"RTN","KMPDHU01",102,0)
 ; quit if no contact site
"RTN","KMPDHU01",103,0)
 S CS=$P(DATA(99.2),U,12) Q:CS=""
"RTN","KMPDHU01",104,0)
 S ^TMP($J,START,NM,PR,CS,0)=DATA(0)
"RTN","KMPDHU01",105,0)
 ; node 99.1 is for national database (end date^facility name)
"RTN","KMPDHU01",106,0)
 S DATA(99.1)=END_"^"_$P(SITE,U,2)_"^"_$P(SITE,U,3)
"RTN","KMPDHU01",107,0)
 ; pieces 6 through 13 of node 99.2 contain text
"RTN","KMPDHU01",108,0)
 F I=6:1:13 S $P(^TMP($J,START,NM,PR,CS,99.2),U,I)=$P(DATA(99.2),U,I)
"RTN","KMPDHU01",109,0)
 W:'$D(ZTQUEUED) "."
"RTN","KMPDHU01",110,0)
 F I=0:0 S I=$O(DATA(I)) Q:'I  D 
"RTN","KMPDHU01",111,0)
 .; 99.1 data not to be totalled
"RTN","KMPDHU01",112,0)
 .I I=99.1 F J=1:1:3 S $P(^TMP($J,START,NM,PR,CS,I),U,J)=$P(DATA(I),U,J)
"RTN","KMPDHU01",113,0)
 .; Add data to get weekly totals.
"RTN","KMPDHU01",114,0)
 .E  F J=1:1:$S($E(I)=5:24,I=99:6,I=99.2:3,I=99.3:9,99.5:3,1:9) D 
"RTN","KMPDHU01",115,0)
 ..S $P(^TMP($J,START,NM,PR,CS,I),U,J)=$P($G(^TMP($J,START,NM,PR,CS,I)),U,J)+$P(DATA(I),U,J)
"RTN","KMPDHU01",116,0)
 ;
"RTN","KMPDHU01",117,0)
 Q
"RTN","KMPDHU01",118,0)
 ;
"RTN","KMPDHU01",119,0)
SYNC(IEN,NM,PR,DATA) ; compile asynchronous stats
"RTN","KMPDHU01",120,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU01",121,0)
 ; IEN..... Ien for file #8973.1 (CM HL7 DATA)
"RTN","KMPDHU01",122,0)
 ; NM...... Namespace (free text)
"RTN","KMPDHU01",123,0)
 ; PR...... Protocol (free text)
"RTN","KMPDHU01",124,0)
 ; DATA().. Array containing node data for file #8973.1 (CM HL7 DATA)
"RTN","KMPDHU01",125,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU01",126,0)
 Q:'$G(IEN)
"RTN","KMPDHU01",127,0)
 Q:$G(NM)=""
"RTN","KMPDHU01",128,0)
 Q:$G(PR)=""
"RTN","KMPDHU01",129,0)
 Q:'$D(DATA)
"RTN","KMPDHU01",130,0)
 N I,J
"RTN","KMPDHU01",131,0)
 S ^TMP($J,START,NM,PR,0)=DATA(0)
"RTN","KMPDHU01",132,0)
 ; node 99.1 is for national database (end date^facility name)
"RTN","KMPDHU01",133,0)
 S DATA(99.1)=END_"^"_$P(SITE,U,2)_"^"_$P(SITE,U,3)
"RTN","KMPDHU01",134,0)
 ; pieces 6 through 13 of node 99.2 contain text
"RTN","KMPDHU01",135,0)
 F I=6:1:13 S $P(^TMP($J,START,NM,PR,99.2),U,I)=$P(DATA(99.2),U,I)
"RTN","KMPDHU01",136,0)
 W:'$D(ZTQUEUED) "."
"RTN","KMPDHU01",137,0)
 F I=0:0 S I=$O(DATA(I)) Q:'I  D 
"RTN","KMPDHU01",138,0)
 .; 99.1 data not to be totalled
"RTN","KMPDHU01",139,0)
 .I I=99.1 F J=1:1:3 S $P(^TMP($J,START,NM,PR,I),U,J)=$P(DATA(I),U,J)
"RTN","KMPDHU01",140,0)
 .; Add data to get weekly totals.
"RTN","KMPDHU01",141,0)
 .E  F J=1:1:$S(I=99:6,1:9) D 
"RTN","KMPDHU01",142,0)
 ..S $P(^TMP($J,START,NM,PR,I),U,J)=$P($G(^TMP($J,START,NM,PR,I)),U,J)+$P(DATA(I),U,J)
"RTN","KMPDHU01",143,0)
 Q
"RTN","KMPDHU01",144,0)
 ;
"RTN","KMPDHU01",145,0)
TRANSMIT ;-- format TMPARRY data, put into e-mail and send to cm.
"RTN","KMPDHU01",146,0)
 ;
"RTN","KMPDHU01",147,0)
 Q:'$D(^TMP($J))
"RTN","KMPDHU01",148,0)
 ;
"RTN","KMPDHU01",149,0)
 N C,CPU,HRSDAYS,I,IEN,LN,N,P,S,XMSUB,X,XMTEXT,XMY,XMZ,Y,Z
"RTN","KMPDHU01",150,0)
 ;
"RTN","KMPDHU01",151,0)
 K ^TMP("KMPDHU01-2",$J)
"RTN","KMPDHU01",152,0)
 ;
"RTN","KMPDHU01",153,0)
 S LN=0
"RTN","KMPDHU01",154,0)
 ; version and patch info
"RTN","KMPDHU01",155,0)
 S LN=LN+1,^TMP("KMPDHU01-2",$J,LN)="VERSION="_$$VERSION^KMPDUTL
"RTN","KMPDHU01",156,0)
 ; system information
"RTN","KMPDHU01",157,0)
 S LN=LN+1,^TMP("KMPDHU01-2",$J,LN)="SYSINFO="_$$SYSINFO^KMPDUTL1()
"RTN","KMPDHU01",158,0)
 ; cpu data
"RTN","KMPDHU01",159,0)
 D CPU^KMPDUTL5(.CPU) I $D(CPU) S I="" F  S I=$O(CPU(I)) Q:I=""  D 
"RTN","KMPDHU01",160,0)
 .S LN=LN+1,^TMP("KMPDHU01-2",$J,LN)="CPU="_I_U_CPU(I)
"RTN","KMPDHU01",161,0)
 ;
"RTN","KMPDHU01",162,0)
 W:'$D(ZTQUEUED) !!,"Formatting ",$$FMTE^XLFDT($G(START))," data for mail delivery..."
"RTN","KMPDHU01",163,0)
 ; reformat so that data is in ^TMP("KMPR UPLOAD",$J,LN)= format.
"RTN","KMPDHU01",164,0)
 S IEN=0,S=""
"RTN","KMPDHU01",165,0)
 F  S S=$O(^TMP($J,S)) Q:S=""  S N="" W "." D 
"RTN","KMPDHU01",166,0)
 .F  S N=$O(^TMP($J,S,N)) Q:N=""  S P="" D 
"RTN","KMPDHU01",167,0)
 ..F  S P=$O(^TMP($J,S,N,P)) Q:P=""  S I="",IEN=IEN+1 D 
"RTN","KMPDHU01",168,0)
 ...; synchronous data
"RTN","KMPDHU01",169,0)
 ...F  S I=$O(^TMP($J,S,N,P,I)) Q:(+I)'=I  S LN=LN+1 D 
"RTN","KMPDHU01",170,0)
 ....S ^TMP("KMPDHU01-2",$J,LN)=IEN_","_I_")="_^TMP($J,S,N,P,I)
"RTN","KMPDHU01",171,0)
 ...; asynchronous data
"RTN","KMPDHU01",172,0)
 ...S C="-"
"RTN","KMPDHU01",173,0)
 ...F  S C=$O(^TMP($J,S,N,P,C)) Q:C=""  S I="",IEN=IEN+1 D 
"RTN","KMPDHU01",174,0)
 ....F  S I=$O(^TMP($J,S,N,P,C,I)) Q:(+I)'=I  S LN=LN+1 D
"RTN","KMPDHU01",175,0)
 .....S ^TMP("KMPDHU01-2",$J,LN)=IEN_","_I_")="_^TMP($J,S,N,P,C,I)
"RTN","KMPDHU01",176,0)
 ;
"RTN","KMPDHU01",177,0)
 ; quit if no data to transmit.
"RTN","KMPDHU01",178,0)
 Q:'$D(^TMP("KMPDHU01-2",$J))
"RTN","KMPDHU01",179,0)
 ; send packman message.
"RTN","KMPDHU01",180,0)
 S XMTEXT="^TMP(""KMPDHU01-2"","_$J_","
"RTN","KMPDHU01",181,0)
 S XMSUB="CM HL7 DATA~"_$P(SITE,U,2)_" ("_$P(SITE,U,3)_")~"_$$FMTE^XLFDT(START)
"RTN","KMPDHU01",182,0)
 S XMY("S.KMP4-CM-SERVER@FO-ALBANY.MED.VA.GOV")=""
"RTN","KMPDHU01",183,0)
 S XMY("CAPACITY,MANAGEMENT@FO-ALBANY.MED.VA.GOV")=""
"RTN","KMPDHU01",184,0)
 D ^XMD
"RTN","KMPDHU01",185,0)
 W:'$D(ZTQUEUED) !,"Message #",$G(XMZ)," sent..."
"RTN","KMPDHU01",186,0)
 K ^TMP("KMPDHU01-2",$J)
"RTN","KMPDHU01",187,0)
 ;
"RTN","KMPDHU01",188,0)
 Q
"RTN","KMPDHU02")
0^3^B58746526
"RTN","KMPDHU02",1,0)
KMPDHU02 ;OAK/RAK - CM Tools Compile & File HL7 Daily Stats ;11/4/03  14:28
"RTN","KMPDHU02",2,0)
 ;;1.0;CM TOOLS;**1,2**;Mar 22, 2002
"RTN","KMPDHU02",3,0)
 ;
"RTN","KMPDHU02",4,0)
DAILY(KMPDST,KMPDEN) ;-entry point
"RTN","KMPDHU02",5,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU02",6,0)
 ; KMPDST... Start date in internal fileman format.
"RTN","KMPDHU02",7,0)
 ; KMPDEN... End date in internal fileman format.
"RTN","KMPDHU02",8,0)
 ;
"RTN","KMPDHU02",9,0)
 ; This API gathers HL7 data and stores it in file 8973.1 (CM HL7 DATA)
"RTN","KMPDHU02",10,0)
 ;
"RTN","KMPDHU02",11,0)
 ; Variables used:
"RTN","KMPDHU02",12,0)
 ; GBL...... Global where data is stored - for use with indirection
"RTN","KMPDHU02",13,0)
 ; GBL1..... globas where compiled data is stored before filing - 
"RTN","KMPDHU02",14,0)
 ;           used with indirection
"RTN","KMPDHU02",15,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU02",16,0)
 ;
"RTN","KMPDHU02",17,0)
 Q:'$G(KMPDST)
"RTN","KMPDHU02",18,0)
 Q:'$G(KMPDEN)
"RTN","KMPDHU02",19,0)
 ; make sure end date has hours
"RTN","KMPDHU02",20,0)
 S:'$P(KMPDEN,".",2) $P(KMPDEN,".",2)="99"
"RTN","KMPDHU02",21,0)
 S:'$G(DT) DT=$$DT^XLFDT
"RTN","KMPDHU02",22,0)
 ;
"RTN","KMPDHU02",23,0)
 N ERROR,GBL,GBL1,STR,X
"RTN","KMPDHU02",24,0)
 ;
"RTN","KMPDHU02",25,0)
 ; get data from hl7 api
"RTN","KMPDHU02",26,0)
 W:'$D(ZTQUEUED) !,"Gathering HL7 data..."
"RTN","KMPDHU02",27,0)
 ; start time for hl7 api
"RTN","KMPDHU02",28,0)
 S STR=$$NOW^XLFDT
"RTN","KMPDHU02",29,0)
 ; global with 'raw' hl7 api data
"RTN","KMPDHU02",30,0)
 S GBL=$NA(^TMP("KMPDH",$J)) K @GBL
"RTN","KMPDHU02",31,0)
 ; set up global to get asynchronous data
"RTN","KMPDHU02",32,0)
 K ^TMP($J)
"RTN","KMPDHU02",33,0)
 S ^TMP($J,"HLUCM")="DEBUG GLOBAL"
"RTN","KMPDHU02",34,0)
 S X=$$CM2^HLUCM(KMPDST,KMPDEN,1,1,"KMPDH","EITHER",.ERROR)
"RTN","KMPDHU02",35,0)
 ; record time for hl7 api
"RTN","KMPDHU02",36,0)
 D STRSTP^KMPDUTL2("HL7","DLY","API",STR)
"RTN","KMPDHU02",37,0)
 I 'X!($D(ERROR))!('$D(^TMP("KMPDH",$J))) D  Q
"RTN","KMPDHU02",38,0)
 .W:'$D(ZTQUEUED) " no data to report"
"RTN","KMPDHU02",39,0)
 ;
"RTN","KMPDHU02",40,0)
 ; global for storing compiled data before filing
"RTN","KMPDHU02",41,0)
 S GBL1=$NA(^TMP("KMPDH-1",$J)) K @GBL1
"RTN","KMPDHU02",42,0)
 ;
"RTN","KMPDHU02",43,0)
 W:'$D(ZTQUEUED) !,"Compiling synchronous HL7 data..."
"RTN","KMPDHU02",44,0)
 S STR=$$NOW^XLFDT
"RTN","KMPDHU02",45,0)
 D SYNC
"RTN","KMPDHU02",46,0)
 D STRSTP^KMPDUTL2("HL7","DLY","S-SYNC",STR)
"RTN","KMPDHU02",47,0)
 ;
"RTN","KMPDHU02",48,0)
 W:'$D(ZTQUEUED) !,"Compiling asynchronous HL7 data..."
"RTN","KMPDHU02",49,0)
 S STR=$$NOW^XLFDT
"RTN","KMPDHU02",50,0)
 D ASYNC
"RTN","KMPDHU02",51,0)
 D STRSTP^KMPDUTL2("HL7","DLY","S-ASYNC",STR)
"RTN","KMPDHU02",52,0)
 ;
"RTN","KMPDHU02",53,0)
 K @GBL,@GBL1,^TMP($J),^TMP("KMPDHERRTIME",$J)
"RTN","KMPDHU02",54,0)
 W:'$D(ZTQUEUED) !,"Finished!"
"RTN","KMPDHU02",55,0)
 ;
"RTN","KMPDHU02",56,0)
 Q
"RTN","KMPDHU02",57,0)
 ;
"RTN","KMPDHU02",58,0)
 ;
"RTN","KMPDHU02",59,0)
ASYNC ;- asynchronous data
"RTN","KMPDHU02",60,0)
 Q:$G(GBL)=""
"RTN","KMPDHU02",61,0)
 Q:$G(GBL1)=""
"RTN","KMPDHU02",62,0)
 ;
"RTN","KMPDHU02",63,0)
 N COUNT,DATA,DATA1,DATA2,HOUR,I,IEN,IEN1,IEN2,J,LOCAL,MSG,NM,NODE
"RTN","KMPDHU02",64,0)
 N OF,PIECE,PR,PTNP,SD,STDT,TIME1,TIME2,UNIT
"RTN","KMPDHU02",65,0)
 ;
"RTN","KMPDHU02",66,0)
 ; local site name
"RTN","KMPDHU02",67,0)
 S LOCAL=$P($$SITE^VASITE,U,2) Q:LOCAL=""
"RTN","KMPDHU02",68,0)
 S IEN=0
"RTN","KMPDHU02",69,0)
 F  S IEN=$O(^TMP($J,"HLUCMSTORE","U",IEN)) Q:'IEN  S DATA=^(IEN) D 
"RTN","KMPDHU02",70,0)
 .; data = Protocol~Ien^Namespace
"RTN","KMPDHU02",71,0)
 .; message type
"RTN","KMPDHU02",72,0)
 .S MSG=$P(DATA,U,6)
"RTN","KMPDHU02",73,0)
 .; quit if not 'complete' message
"RTN","KMPDHU02",74,0)
 .Q:'$$ASYNCHK(MSG)
"RTN","KMPDHU02",75,0)
 .; protocol - check protocol fist, then inferred protocol
"RTN","KMPDHU02",76,0)
 .S PR=$S($P(DATA,U,7)]"":$P(DATA,U,7),$P(DATA,U,8)]"":$P(DATA,U,8),1:"") Q:PR=""
"RTN","KMPDHU02",77,0)
 .; namespace - check namespace first, then inferred namespace
"RTN","KMPDHU02",78,0)
 .S NM=$S($P(DATA,U,9)]"":$P(DATA,U,9),$P(DATA,U,10)]"":$P(DATA,U,10),1:"") Q:NM=""
"RTN","KMPDHU02",79,0)
 .; other facility
"RTN","KMPDHU02",80,0)
 .S OF=$P(DATA,U,11) S:OF["~" OF=$P(OF,"~",2) Q:OF=""
"RTN","KMPDHU02",81,0)
 .; quit if other facility is LOCAL
"RTN","KMPDHU02",82,0)
 .Q:OF[LOCAL
"RTN","KMPDHU02",83,0)
 .; start date/time
"RTN","KMPDHU02",84,0)
 .S STDT=$P(DATA,U,4) Q:'STDT
"RTN","KMPDHU02",85,0)
 .; date without time
"RTN","KMPDHU02",86,0)
 .S SD=$P(STDT,".") Q:'SD
"RTN","KMPDHU02",87,0)
 .S $P(@GBL1@(SD,PR,NM,OF,99.2),U,11)=$P($P(DATA,U,11),"~")
"RTN","KMPDHU02",88,0)
 .S $P(@GBL1@(SD,PR,NM,OF,99.2),U,12)=$P($P(DATA,U,11),"~",2)
"RTN","KMPDHU02",89,0)
 .S $P(@GBL1@(SD,PR,NM,OF,99.2),U,13)=$P($P(DATA,U,11),"~",3)
"RTN","KMPDHU02",90,0)
 .;
"RTN","KMPDHU02",91,0)
 .S (COUNT,HOUR,IEN1)=0 K UNIT
"RTN","KMPDHU02",92,0)
 .F  S IEN1=$O(^TMP($J,"HLUCMSTORE","U",IEN,IEN1)) Q:'IEN1  D 
"RTN","KMPDHU02",93,0)
 ..; data1 = piece 1 - Characters
"RTN","KMPDHU02",94,0)
 ..;         piece 2 - Messages
"RTN","KMPDHU02",95,0)
 ..;         piece 3 - Seconds
"RTN","KMPDHU02",96,0)
 ..;         piece 4 - Begining Time
"RTN","KMPDHU02",97,0)
 ..;         piece 5 - End Time
"RTN","KMPDHU02",98,0)
 ..;         piece 6 - Type: msg, ca, aa or ca
"RTN","KMPDHU02",99,0)
 ..;         piece 7 - Protocol~Ien
"RTN","KMPDHU02",100,0)
 ..;         piece 8 - Namespace
"RTN","KMPDHU02",101,0)
 ..S DATA1=$G(^TMP($J,"HLUCMSTORE","U",IEN,IEN1,"CCC")) Q:DATA1=""
"RTN","KMPDHU02",102,0)
 ..S COUNT=COUNT+1,UNIT(COUNT)=DATA1
"RTN","KMPDHU02",103,0)
 .;
"RTN","KMPDHU02",104,0)
 .; back to IEN level
"RTN","KMPDHU02",105,0)
 .; quit if unit() array is not complete
"RTN","KMPDHU02",106,0)
 .Q:'$$UNITS(MSG)
"RTN","KMPDHU02",107,0)
 .; hour of transaction
"RTN","KMPDHU02",108,0)
 .S HOUR=+$E($P(STDT,".",2),1,2),HOUR=HOUR+1
"RTN","KMPDHU02",109,0)
 .; prime time or non-prime time
"RTN","KMPDHU02",110,0)
 .S PTNP=$$PTNP^KMPDHU03(STDT) Q:'PTNP
"RTN","KMPDHU02",111,0)
 .; node: 5 - prime time
"RTN","KMPDHU02",112,0)
 .;       6 - non-prime time
"RTN","KMPDHU02",113,0)
 .S NODE=$S(PTNP=2:6,1:5)
"RTN","KMPDHU02",114,0)
 .;
"RTN","KMPDHU02",115,0)
 .; update msg unit count - prime time or non-prime time
"RTN","KMPDHU02",116,0)
 .S $P(@GBL1@(SD,PR,NM,OF,99.5),U,PTNP)=$P($G(@GBL1@(SD,PR,NM,OF,99.5)),U,PTNP)+1
"RTN","KMPDHU02",117,0)
 .;update msg unit count - both prime time & non-prime time
"RTN","KMPDHU02",118,0)
 .S $P(@GBL1@(SD,PR,NM,OF,99.5),U,3)=$P($G(@GBL1@(SD,PR,NM,OF,99.5)),U,3)+1
"RTN","KMPDHU02",119,0)
 .; totals
"RTN","KMPDHU02",120,0)
 .F J=0:0 S J=$O(UNIT(J)) Q:'J  F I=1:1:3 D 
"RTN","KMPDHU02",121,0)
 ..; total
"RTN","KMPDHU02",122,0)
 ..S $P(@GBL1@(SD,PR,NM,OF,99.2),U,I)=$P($G(@GBL1@(SD,PR,NM,OF,99.2)),U,I)+$P(UNIT(J),U,I)
"RTN","KMPDHU02",123,0)
 ..S $P(@GBL1@(SD,PR,NM,OF,99.3),U,(I+6))=$P($G(@GBL1@(SD,PR,NM,OF,99.3)),U,(I+6))+$P(UNIT(J),U,I)
"RTN","KMPDHU02",124,0)
 ..; prime time or non-prime time
"RTN","KMPDHU02",125,0)
 ..; ^ piece to set
"RTN","KMPDHU02",126,0)
 ..S PIECE=I+$S(PTNP=2:3,1:0)
"RTN","KMPDHU02",127,0)
 ..S $P(@GBL1@(SD,PR,NM,OF,99.3),U,PIECE)=$P($G(@GBL1@(SD,PR,NM,OF,99.3)),U,PIECE)+$P(UNIT(J),U,I)
"RTN","KMPDHU02",128,0)
 .;
"RTN","KMPDHU02",129,0)
 .; msg to ca - originating message to commit ack
"RTN","KMPDHU02",130,0)
 .; ^ piece: 1 - characters
"RTN","KMPDHU02",131,0)
 .;          2 - count
"RTN","KMPDHU02",132,0)
 .;          3 - seconds
"RTN","KMPDHU02",133,0)
 .F I=1:1:3 S $P(@GBL1@(SD,PR,NM,OF,NODE+(I*.1)),U,HOUR)=$P($G(@GBL1@(SD,PR,NM,OF,NODE+(I*.1))),U,HOUR)+($P(UNIT(1),U,I)+$P(UNIT(2),U,I))
"RTN","KMPDHU02",134,0)
 .;
"RTN","KMPDHU02",135,0)
 .; processing time (ca to aa) - commit ack ending time to application
"RTN","KMPDHU02",136,0)
 .;                              ack starting time
"RTN","KMPDHU02",137,0)
 .S TIME1=+$P(UNIT(3),U,4),TIME2=+$P(UNIT(2),U,5)
"RTN","KMPDHU02",138,0)
 .S $P(@GBL1@(SD,PR,NM,OF,(NODE+(.4))),U,HOUR)=$$TIMEADD^KMPDU($P($G(@GBL1@(SD,PR,NM,OF,(NODE+(.4)))),U,HOUR)+$$FMDIFF^XLFDT(TIME2,(+TIME1),3))
"RTN","KMPDHU02",139,0)
 .; processing time (ca to aa) - count
"RTN","KMPDHU02",140,0)
 .S $P(@GBL1@(SD,PR,NM,OF,(NODE+(.5))),U,HOUR)=$P($G(@GBL1@(SD,PR,NM,OF,(NODE+(.5)))),U,HOUR)+1
"RTN","KMPDHU02",141,0)
 .;
"RTN","KMPDHU02",142,0)
 .; aa to ca - application ack to commit ack
"RTN","KMPDHU02",143,0)
 .; ^ piece: 1 - characters
"RTN","KMPDHU02",144,0)
 .;          2 - count
"RTN","KMPDHU02",145,0)
 .;          3 - seconds
"RTN","KMPDHU02",146,0)
 .F I=1:1:3 S $P(@GBL1@(SD,PR,NM,OF,NODE+(I+6*.1)),U,HOUR)=$P($G(@GBL1@(SD,PR,NM,OF,NODE+(I+6*.1))),U,HOUR)+($P(UNIT(3),U,I)+$P(UNIT(4),U,I))
"RTN","KMPDHU02",147,0)
 ;
"RTN","KMPDHU02",148,0)
 D:$D(@GBL1) FILE^KMPDHU03(2)
"RTN","KMPDHU02",149,0)
 ;
"RTN","KMPDHU02",150,0)
 Q
"RTN","KMPDHU02",151,0)
 ;
"RTN","KMPDHU02",152,0)
ASYNCHK(KMPDMSG) ;-- extrinsic function - check for 'complete' message
"RTN","KMPDHU02",153,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU02",154,0)
 ; KMPDMGS... message ack designations
"RTN","KMPDHU02",155,0)
 ;
"RTN","KMPDHU02",156,0)
 ; Return: 0 - not a complete message
"RTN","KMPDHU02",157,0)
 ;         1 - complete message
"RTN","KMPDHU02",158,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU02",159,0)
 Q:$G(KMPDMSG)="" 0
"RTN","KMPDHU02",160,0)
 Q:MSG="MSG~CA~AA~CA" 1
"RTN","KMPDHU02",161,0)
 Q:MSG="MSG~CA~AR~CA" 1
"RTN","KMPDHU02",162,0)
 Q:MSG="MSG~AA" 1
"RTN","KMPDHU02",163,0)
 Q 0
"RTN","KMPDHU02",164,0)
 ;
"RTN","KMPDHU02",165,0)
UNITS(MSG) ;-- extrinsic function
"RTN","KMPDHU02",166,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU02",167,0)
 ; MSG.... type of message: 'msg~aa', 'msg~ca~aa~ca', etc.
"RTN","KMPDHU02",168,0)
 ;
"RTN","KMPDHU02",169,0)
 ; Return: 0 - unit() array not complete
"RTN","KMPDHU02",170,0)
 ;         1 - unit() array is complete
"RTN","KMPDHU02",171,0)
 ;
"RTN","KMPDHU02",172,0)
 ; unit() array must be segmented into the following format:
"RTN","KMPDHU02",173,0)
 ;   unit(1) = msg
"RTN","KMPDHU02",174,0)
 ;   unit(2) = ca
"RTN","KMPDHU02",175,0)
 ;   unit(3) = aa
"RTN","KMPDHU02",176,0)
 ;   unit(4) = ca
"RTN","KMPDHU02",177,0)
 ; this data is then used to calculate characters, messages and seconds
"RTN","KMPDHU02",178,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU02",179,0)
 Q:$G(MSG)="" 0
"RTN","KMPDHU02",180,0)
 ; all messages must have unit(2)
"RTN","KMPDHU02",181,0)
 Q:'$D(UNIT(2)) 0
"RTN","KMPDHU02",182,0)
 ; "msg~ca~aa~ca" & "msg~ca~ar~ca" messages must have unit(3) & unit(4)
"RTN","KMPDHU02",183,0)
 I MSG="MSG~CA~AA~CA"!(MSG="MSG~CA~AR~CA") Q:'$D(UNIT(3)) 0
"RTN","KMPDHU02",184,0)
 I MSG="MSG~CA~AA~CA"!(MSG="MSG~CA~AR~CA") Q:'$D(UNIT(4)) 0
"RTN","KMPDHU02",185,0)
 ; 'msg~aaa' messages contain only 2 unit() entries
"RTN","KMPDHU02",186,0)
 ; create 4 unit() entries for processing
"RTN","KMPDHU02",187,0)
 I MSG="MSG~AA" D 
"RTN","KMPDHU02",188,0)
 .S (UNIT(3),UNIT(4))=UNIT(2),UNIT(2)=UNIT(1)
"RTN","KMPDHU02",189,0)
 .S $P(UNIT(1),U,1,3)="0^0^0"
"RTN","KMPDHU02",190,0)
 .S $P(UNIT(4),U,1,3)="0^0^0"
"RTN","KMPDHU02",191,0)
 ; calculate seconds
"RTN","KMPDHU02",192,0)
 ; msg to ca
"RTN","KMPDHU02",193,0)
 S $P(UNIT(2),U,3)=$$FMDIFF^XLFDT($P(UNIT(2),U,5),$P(UNIT(1),U,4),2)
"RTN","KMPDHU02",194,0)
 S:$P(UNIT(2),U,3)<0 $P(UNIT(2),U,3)=0
"RTN","KMPDHU02",195,0)
 ; ca to aa
"RTN","KMPDHU02",196,0)
 S $P(UNIT(3),U,3)=$$FMDIFF^XLFDT($P(UNIT(3),U,5),$P(UNIT(2),U,5),2)
"RTN","KMPDHU02",197,0)
 S:$P(UNIT(3),U,3)<0 $P(UNIT(3),U,3)=0
"RTN","KMPDHU02",198,0)
 ; aa to ca
"RTN","KMPDHU02",199,0)
 S $P(UNIT(4),U,3)=$$FMDIFF^XLFDT($P(UNIT(4),U,5),$P(UNIT(3),U,5),2)
"RTN","KMPDHU02",200,0)
 S:$P(UNIT(4),U,3)<0 $P(UNIT(4),U,3)=0
"RTN","KMPDHU02",201,0)
 ;
"RTN","KMPDHU02",202,0)
 Q 1
"RTN","KMPDHU02",203,0)
 ;
"RTN","KMPDHU02",204,0)
SYNC ;- synchronous data
"RTN","KMPDHU02",205,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU02",206,0)
 ; SS1...... subscript 1 - identifies data
"RTN","KMPDHU02",207,0)
 ;            HR   - hourly
"RTN","KMPDHU02",208,0)
 ;            NMSP - namespace
"RTN","KMPDHU02",209,0)
 ;            PROT - protocol
"RTN","KMPDHU02",210,0)
 ; SS2...... subscript 2 - identifies data sorted within SS1
"RTN","KMPDHU02",211,0)
 ;            IO   - incoming/outgoing messages
"RTN","KMPDHU02",212,0)
 ;            LR   - local/remote messages
"RTN","KMPDHU02",213,0)
 ;            PR   - protocol
"RTN","KMPDHU02",214,0)
 ;            TM   - type of transmission
"RTN","KMPDHU02",215,0)
 ;            
"RTN","KMPDHU02",216,0)
 ; SS3...... subcript 3 - which identifier for SS2 is being sorted
"RTN","KMPDHU02",217,0)
 ;            IO   - I - incoming
"RTN","KMPDHU02",218,0)
 ;                   O - outgoing
"RTN","KMPDHU02",219,0)
 ;                   U - unknown
"RTN","KMPDHU02",220,0)
 ;            LR   - L - local
"RTN","KMPDHU02",221,0)
 ;                   R - remote
"RTN","KMPDHU02",222,0)
 ;                   U - unknown
"RTN","KMPDHU02",223,0)
 ;            PR   - P - placeholder for consistent subscripting
"RTN","KMPDHU02",224,0)
 ;            TM   - M - mailman
"RTN","KMPDHU02",225,0)
 ;                   T - tcp
"RTN","KMPDHU02",226,0)
 ;                   U -unknown
"RTN","KMPDHU02",227,0)
 ; SS4...... subscript 4 - according to SS1
"RTN","KMPDHU02",228,0)
 ;            HR   - date.time
"RTN","KMPDHU02",229,0)
 ;            NMSP - namespace
"RTN","KMPDHU02",230,0)
 ;            PROT - protocal
"RTN","KMPDHU02",231,0)
 ; SS5...... subcript 5 - according to SS1
"RTN","KMPDHU02",232,0)
 ;            HR   - namespace
"RTN","KMPDHU02",233,0)
 ;            NMSP - date.tim
"RTN","KMPDHU02",234,0)
 ;            PROT - namespace
"RTN","KMPDHU02",235,0)
 ; SS6...... subscript 6 - according to SS1
"RTN","KMPDHU02",236,0)
 ;            HR   - protocol
"RTN","KMPDHU02",237,0)
 ;            NMSP - protocol
"RTN","KMPDHU02",238,0)
 ;            PROT - date.time
"RTN","KMPDHU02",239,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDHU02",240,0)
 Q:$G(GBL)=""
"RTN","KMPDHU02",241,0)
 Q:$G(GBL1)=""
"RTN","KMPDHU02",242,0)
 N SS1,SS2,SS3,SS4,SS5,SS6
"RTN","KMPDHU02",243,0)
 S SS1=""
"RTN","KMPDHU02",244,0)
 F  S SS1=$O(@GBL@(SS1)) Q:SS1=""  I SS1'="RFAC" S SS2="" D 
"RTN","KMPDHU02",245,0)
 .F  S SS2=$O(@GBL@(SS1,SS2)) Q:SS2=""  S SS3="" D 
"RTN","KMPDHU02",246,0)
 ..F  S SS3=$O(@GBL@(SS1,SS2,SS3)) Q:SS3=""  S SS4="" D 
"RTN","KMPDHU02",247,0)
 ...F  S SS4=$O(@GBL@(SS1,SS2,SS3,SS4)) Q:SS4=""  S SS5="" D 
"RTN","KMPDHU02",248,0)
 ....Q:SS1="PROT"&(SS4="ZZZ")
"RTN","KMPDHU02",249,0)
 ....F  S SS5=$O(@GBL@(SS1,SS2,SS3,SS4,SS5)) Q:SS5=""  S SS6="" D 
"RTN","KMPDHU02",250,0)
 .....; if SS1="NMSP" or SS1="PROT" quit if SS4 and SS5 (protocol/
"RTN","KMPDHU02",251,0)
 .....;                             namespace pair) = ZZZ
"RTN","KMPDHU02",252,0)
 .....I SS1="NMSP"!(SS1="PROT") Q:SS4="ZZZ"&(SS5="ZZZ")
"RTN","KMPDHU02",253,0)
 .....F  S SS6=$O(@GBL@(SS1,SS2,SS3,SS4,SS5,SS6)) Q:SS6=""  D 
"RTN","KMPDHU02",254,0)
 ......Q:SS1="HR"&(SS6="ZZZ")
"RTN","KMPDHU02",255,0)
 ......Q:SS1="NMSP"&(SS6="ZZZ")
"RTN","KMPDHU02",256,0)
 ......; compile data into daily stats for file #8973.1 (CM HL7 DATA)
"RTN","KMPDHU02",257,0)
 ......D COMPILE^KMPDHU03
"RTN","KMPDHU02",258,0)
 ;
"RTN","KMPDHU02",259,0)
 D:$D(@GBL1) FILE^KMPDHU03(1)
"RTN","KMPDHU02",260,0)
 ;
"RTN","KMPDHU02",261,0)
 K @GBL1
"RTN","KMPDHU02",262,0)
 ;
"RTN","KMPDHU02",263,0)
 Q
"RTN","KMPDSS")
0^4^B29930299
"RTN","KMPDSS",1,0)
KMPDSS ;OAK/RAK - CM Tools Status ;11/4/03  14:29
"RTN","KMPDSS",2,0)
 ;;1.0;CM TOOLS;**1,2**;Mar 22, 2002
"RTN","KMPDSS",3,0)
 ;
"RTN","KMPDSS",4,0)
EN ;-entry point
"RTN","KMPDSS",5,0)
 ;
"RTN","KMPDSS",6,0)
 N DELTA,DIR,ENDT,I,KMPDX,KMPDX1,STDT,VERS,VERSION,X,Y
"RTN","KMPDSS",7,0)
 ;
"RTN","KMPDSS",8,0)
 S X="KMPDUTL" X ^%ZOSF("TEST") I '$T W !,"The CM Tools Package is not installed!" Q
"RTN","KMPDSS",9,0)
 S VERSION=$$VERSION^KMPDUTL
"RTN","KMPDSS",10,0)
 S VERS="CM Tools v"_$P(VERSION,U)
"RTN","KMPDSS",11,0)
 D HDR W !
"RTN","KMPDSS",12,0)
 I '$O(^DIC(19,"B","KMPD BACKGROUND DRIVER",0)) D 
"RTN","KMPDSS",13,0)
 .W !," The 'CM Tools Background Driver' option [KMPD BACKGROUND DRIVER] is missing!"
"RTN","KMPDSS",14,0)
 E  D 
"RTN","KMPDSS",15,0)
 .S KMPDX=+$O(^DIC(19,"B","KMPD BACKGROUND DRIVER",0))
"RTN","KMPDSS",16,0)
 .S KMPDX=+$O(^DIC(19.2,"B",KMPDX,0))
"RTN","KMPDSS",17,0)
 .; if not scheduled or no task id
"RTN","KMPDSS",18,0)
 .I 'KMPDX!('$G(^DIC(19.2,+KMPDX,1))) D  Q:'Y
"RTN","KMPDSS",19,0)
 ..W !?5,"The 'CM Tools Background Driver' [KMPD BACKGROUND DRIVER] is not scheduled",!?5,"to run!",!
"RTN","KMPDSS",20,0)
 ..K DIR S DIR(0)="YO",DIR("B")="YES"
"RTN","KMPDSS",21,0)
 ..S DIR("A")="Do you want to queue this option to run each night at 1:30am"
"RTN","KMPDSS",22,0)
 ..W ! D ^DIR Q:'Y
"RTN","KMPDSS",23,0)
 ..D QUEBKG^KMPDUTL("KMPD BACKGROUND DRIVER","T+1@0130","1D",0)
"RTN","KMPDSS",24,0)
 .S KMPDX=+$O(^DIC(19,"B","KMPD BACKGROUND DRIVER",0))
"RTN","KMPDSS",25,0)
 .S KMPDX=+$O(^DIC(19.2,"B",KMPDX,0))
"RTN","KMPDSS",26,0)
 .S KMPDX=$G(^DIC(19.2,KMPDX,0)),KMPDX1=$G(^(1))
"RTN","KMPDSS",27,0)
 .S $P(KMPDX,U,2)=$$FMTE^XLFDT($P(KMPDX,U,2))
"RTN","KMPDSS",28,0)
 .W !?5,"CM Tools Background Driver..: KMPD BACKGROUND DRIVER"
"RTN","KMPDSS",29,0)
 .W !?5,"QUEUED TO RUN AT............: ",$P(KMPDX,U,2)
"RTN","KMPDSS",30,0)
 .W !?5,"RESCHEDULING FREQUENCY......: ",$P(KMPDX,U,6)
"RTN","KMPDSS",31,0)
 .W !?5,"TASK ID.....................: ",+KMPDX1
"RTN","KMPDSS",32,0)
 .; user info.
"RTN","KMPDSS",33,0)
 .S KMPDX1=$G(^%ZTSK(+KMPDX1,0))
"RTN","KMPDSS",34,0)
 .W !?5,"QUEUED BY...................: ",$P($G(^VA(200,+$P(KMPDX1,U,3),0)),U)
"RTN","KMPDSS",35,0)
 .; if user
"RTN","KMPDSS",36,0)
 .I (+$P(KMPDX1,U,3)) D 
"RTN","KMPDSS",37,0)
 ..; user 'active' or 'terminated'
"RTN","KMPDSS",38,0)
 ..S KMPDX1=$$ACTIVE^XUSER(+$P(KMPDX1,U,3))
"RTN","KMPDSS",39,0)
 ..W "  (",$S($P(KMPDX1,U,2)["TERMINATED":"Terminated - "_$$FMTE^XLFDT($P(KMPDX1,U,3),2),1:"Active"),")"
"RTN","KMPDSS",40,0)
 ; background stats
"RTN","KMPDSS",41,0)
 D BKGRND
"RTN","KMPDSS",42,0)
 ; pause
"RTN","KMPDSS",43,0)
 Q:'$$CONT^KMPDUTL1(1)
"RTN","KMPDSS",44,0)
 D HDR W !
"RTN","KMPDSS",45,0)
 ; file data
"RTN","KMPDSS",46,0)
 D FILES
"RTN","KMPDSS",47,0)
 ; pause
"RTN","KMPDSS",48,0)
 Q:'$$CONT^KMPDUTL1(1)
"RTN","KMPDSS",49,0)
 D HDR W !
"RTN","KMPDSS",50,0)
 ; routine version check
"RTN","KMPDSS",51,0)
 D VERDSPL("D")
"RTN","KMPDSS",52,0)
 ; pause
"RTN","KMPDSS",53,0)
 Q:$$CONT^KMPDUTL1
"RTN","KMPDSS",54,0)
 ;
"RTN","KMPDSS",55,0)
 Q
"RTN","KMPDSS",56,0)
 ;
"RTN","KMPDSS",57,0)
BKGRND ; hl7 background info
"RTN","KMPDSS",58,0)
 N DELTA,ENDT,STAT,STDT
"RTN","KMPDSS",59,0)
 S STDT=$G(^KMPTMP("KMPD","BACKGROUND","HL7","DLY","TOTAL","START")),ENDT=$G(^("END")),DELTA=$G(^("DELTA"))
"RTN","KMPDSS",60,0)
 S:$E(DELTA)=" " $E(DELTA)="0"
"RTN","KMPDSS",61,0)
 W !
"RTN","KMPDSS",62,0)
 W !?5,"Hl7 Dly Bckgrnd last start..: ",$$FMTE^XLFDT(STDT)
"RTN","KMPDSS",63,0)
 W !?5,"HL7 Dly Bckgrnd last stop...: ",$$FMTE^XLFDT(ENDT)
"RTN","KMPDSS",64,0)
 W !?5,"HL7 Dly Bkgrnd total time...: ",DELTA
"RTN","KMPDSS",65,0)
 S STDT=$G(^KMPTMP("KMPD","BACKGROUND","HL7","WKY","TOTAL","START")),ENDT=$G(^("END")),DELTA=$G(^("DELTA"))
"RTN","KMPDSS",66,0)
 S:$E(DELTA)=" " $E(DELTA)="0"
"RTN","KMPDSS",67,0)
 W !?5,"HL7 Wkly Backgrnd last start: ",$$FMTE^XLFDT(STDT)
"RTN","KMPDSS",68,0)
 W !?5,"HL7 Wkly Bckgrnd last stop..: ",$$FMTE^XLFDT(ENDT)
"RTN","KMPDSS",69,0)
 W !?5,"HL7 Wkly Bckgrnd total time.: ",DELTA
"RTN","KMPDSS",70,0)
 W !
"RTN","KMPDSS",71,0)
 ; timing background info - if available
"RTN","KMPDSS",72,0)
 I $O(^KMPTMP("KMPD","BACKGROUND","TMG",""))]"" D 
"RTN","KMPDSS",73,0)
 .S STDT=$G(^KMPTMP("KMPD","BACKGROUND","TMG","DLY","TOTAL","START")),ENDT=$G(^("END")),DELTA=$G(^("DELTA"))
"RTN","KMPDSS",74,0)
 .S:$E(DELTA)=" " $E(DELTA)="0"
"RTN","KMPDSS",75,0)
 .S STAT=$G(^KMPTMP("KMPD-CPRS"))
"RTN","KMPDSS",76,0)
 .W !
"RTN","KMPDSS",77,0)
 .W !?5,"TMG Collection Status.......: ",$S(STAT:"Running",1:"STOPPED!")
"RTN","KMPDSS",78,0)
 .W !?5,"TMG Dly Bckgrnd last start..: ",$$FMTE^XLFDT(STDT)
"RTN","KMPDSS",79,0)
 .W !?5,"TMG Dly Bckgrnd last stop...: ",$$FMTE^XLFDT(ENDT)
"RTN","KMPDSS",80,0)
 .W !?5,"TMG Dly Bkgrnd total time...: ",DELTA
"RTN","KMPDSS",81,0)
 ;
"RTN","KMPDSS",82,0)
 Q
"RTN","KMPDSS",83,0)
 ;
"RTN","KMPDSS",84,0)
FILES ;-- file data
"RTN","KMPDSS",85,0)
 ;
"RTN","KMPDSS",86,0)
 W !?35,"  # of",?45,"Oldest",?55,"Recent"
"RTN","KMPDSS",87,0)
 W !?5,"File",?35,"Entries",?45," Date",?55," Date"
"RTN","KMPDSS",88,0)
 W !?5,"-------------------------",?35,"-------",?45,"------",?54,"-------"
"RTN","KMPDSS",89,0)
 ; cm hl7 data
"RTN","KMPDSS",90,0)
 ; file name
"RTN","KMPDSS",91,0)
 W !?5,"8973.1 - CM HL7 DATA"
"RTN","KMPDSS",92,0)
 ; number of entries
"RTN","KMPDSS",93,0)
 W ?35,$J($FN($P($G(^KMPD(8973.1,0)),U,4),",",0),7)
"RTN","KMPDSS",94,0)
 ; oldest date
"RTN","KMPDSS",95,0)
 W ?45,$$FMTE^XLFDT(+$O(^KMPD(8973.1,"B",0)),2)
"RTN","KMPDSS",96,0)
 ; most recent date
"RTN","KMPDSS",97,0)
 W ?55,$$FMTE^XLFDT(+$O(^KMPD(8973.1,"B","A"),-1),2)
"RTN","KMPDSS",98,0)
 ;
"RTN","KMPDSS",99,0)
 ; cm timing data - if available
"RTN","KMPDSS",100,0)
 I $O(^KMPD(8973.2,0)) D 
"RTN","KMPDSS",101,0)
 .; file name
"RTN","KMPDSS",102,0)
 .W !?5,"8973.2 - CM TIMING"
"RTN","KMPDSS",103,0)
 .; number of entries
"RTN","KMPDSS",104,0)
 .W ?35,$J($FN($P($G(^KMPD(8973.2,0)),U,4),",",0),7)
"RTN","KMPDSS",105,0)
 .; oldest date
"RTN","KMPDSS",106,0)
 .W ?45,$$FMTE^XLFDT($P(+$O(^KMPD(8973.2,"ASTDTTM",0)),"."),2)
"RTN","KMPDSS",107,0)
 .; most recent date
"RTN","KMPDSS",108,0)
 .W ?55,$$FMTE^XLFDT($P(+$O(^KMPD(8973.2,"ASTDTTM","A"),-1),"."),2)
"RTN","KMPDSS",109,0)
 ;
"RTN","KMPDSS",110,0)
 Q
"RTN","KMPDSS",111,0)
 ;
"RTN","KMPDSS",112,0)
HDR ;
"RTN","KMPDSS",113,0)
 N X
"RTN","KMPDSS",114,0)
 S X=$G(VERS)
"RTN","KMPDSS",115,0)
 W @IOF,!?(IOM-$L(X)\2),X
"RTN","KMPDSS",116,0)
 ; if patches
"RTN","KMPDSS",117,0)
 I $P(VERSION,U,2)]"" S X=$P(VERSION,U,2) W !?(IOM-$L(X)\2),X
"RTN","KMPDSS",118,0)
 Q
"RTN","KMPDSS",119,0)
VERDSPL(KMPDPKG) ;--display routine version info
"RTN","KMPDSS",120,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDSS",121,0)
 ; KMPDPKG... CM Package:
"RTN","KMPDSS",122,0)
 ;            "D" - CM Tools
"RTN","KMPDSS",123,0)
 ;            "R" - RUM
"RTN","KMPDSS",124,0)
 ;            "S" - SAGG
"RTN","KMPDSS",125,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDSS",126,0)
 Q:$G(KMPDPKG)=""
"RTN","KMPDSS",127,0)
 Q:KMPDPKG'="D"&(KMPDPKG'="R")&(KMPDPKG'="S")
"RTN","KMPDSS",128,0)
 N X
"RTN","KMPDSS",129,0)
 ; routine check
"RTN","KMPDSS",130,0)
 D VERPTCH^KMPDUTL1(KMPDPKG,.X)
"RTN","KMPDSS",131,0)
 W !?5,$S(KMPDPKG="D":"CM TOOLS",KMPDPKG="R":"RUM",1:"SAGG")
"RTN","KMPDSS",132,0)
 W " routines",$$REPEAT^XLFSTR(".",28-$X),": "
"RTN","KMPDSS",133,0)
 I '$P($G(X(0)),U,3) W "No Problems"
"RTN","KMPDSS",134,0)
 E  D 
"RTN","KMPDSS",135,0)
 .W !?20,"Current Version",?55,"Should be"
"RTN","KMPDSS",136,0)
 .S I=0 F  S I=$O(X(I)) Q:I=""  I $P(X(I),U) D 
"RTN","KMPDSS",137,0)
 ..W !?3,I,?20,$P(X(I),U,4)
"RTN","KMPDSS",138,0)
 ..W:$P(X(I),U,5)]"" " - ",$P(X(I),U,5)
"RTN","KMPDSS",139,0)
 ..W ?55,$P(X(I),U,2)
"RTN","KMPDSS",140,0)
 ..W:$P(X(I),U,3)]"" " - ",$P(X(I),U,3)
"RTN","KMPDSS",141,0)
 Q
"RTN","KMPDSS",142,0)
 ;
"RTN","KMPDSS",143,0)
SST ;-- start/stop coversheet collection
"RTN","KMPDSS",144,0)
 ; check for cprs patch
"RTN","KMPDSS",145,0)
 I '$$PATCH^XPDUTL("OR*3.0*209") D  Q
"RTN","KMPDSS",146,0)
 .W !! D EN^DDIOL($C(7)_"*** Patch OR*3.0*209 must be installed for CPRS Timing data to be collected ***")
"RTN","KMPDSS",147,0)
 ;
"RTN","KMPDSS",148,0)
 N DIR,STAT,X,Y
"RTN","KMPDSS",149,0)
 S STAT=$G(^KMPTMP("KMPD-CPRS"))
"RTN","KMPDSS",150,0)
 W !!!,"Timing Collection is currently [ ",$S(STAT:"Running",1:"STOPPED")," ]",!
"RTN","KMPDSS",151,0)
 S DIR(0)="YO",DIR("B")="N"
"RTN","KMPDSS",152,0)
 S DIR("A")="Do you want to '"_$S(STAT:"Stop",1:"Start")_"' the collection"
"RTN","KMPDSS",153,0)
 D ^DIR Q:'Y
"RTN","KMPDSS",154,0)
 S ^KMPTMP("KMPD-CPRS")=$S(STAT:"",1:1)
"RTN","KMPDSS",155,0)
 W !!,"Timing Collection has been [ ",$S(STAT:"STOPPED",1:"Started")," ]"
"RTN","KMPDSS",156,0)
 Q
"RTN","KMPDTP1")
0^9^B15666050
"RTN","KMPDTP1",1,0)
KMPDTP1 ;OAK/RAK - CP Timing Time to Load Summary ;11/4/03  14:21
"RTN","KMPDTP1",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDTP1",3,0)
 ;
"RTN","KMPDTP1",4,0)
EN ;-- entry point
"RTN","KMPDTP1",5,0)
 N KMPDATE,KMPDPTNP,KMPDTTL,POP,X,Y,ZTDESC,ZTRTN,ZTRSAVE,%ZIS
"RTN","KMPDTP1",6,0)
 S KMPDTTL=" Average Coversheet Time-to-Load (TTL) Report "
"RTN","KMPDTP1",7,0)
 D HDR^KMPDUTL4(KMPDTTL)
"RTN","KMPDTP1",8,0)
 W !
"RTN","KMPDTP1",9,0)
 W !?7,"This report displays the daily average time-to-load value for"
"RTN","KMPDTP1",10,0)
 W !?7,"the coversheet at this site.  Average time-to-load values are"
"RTN","KMPDTP1",11,0)
 W !?7,"given for either daily prime time or non-prime time periods."
"RTN","KMPDTP1",12,0)
 W !
"RTN","KMPDTP1",13,0)
 ;
"RTN","KMPDTP1",14,0)
 I '$O(^KMPD(8973.2,0)) D  Q
"RTN","KMPDTP1",15,0)
 .W !!?7,"*** There is currently no data in file #8973.2 (CP TIMING) ***"
"RTN","KMPDTP1",16,0)
 ;
"RTN","KMPDTP1",17,0)
 D DATERNG^KMPDTU10("ORWCV",7,.KMPDATE)
"RTN","KMPDTP1",18,0)
 Q:$G(KMPDATE(0))=""
"RTN","KMPDTP1",19,0)
 S KMPDPTNP=$$PTNPSEL^KMPDUTL4
"RTN","KMPDTP1",20,0)
 Q:'KMPDPTNP
"RTN","KMPDTP1",21,0)
 ; select output device.
"RTN","KMPDTP1",22,0)
 S %ZIS="Q",%ZIS("A")="Device: ",%ZIS("B")="HOME"
"RTN","KMPDTP1",23,0)
 W ! D ^%ZIS I POP W !,"No action taken." Q
"RTN","KMPDTP1",24,0)
 ; if queued.
"RTN","KMPDTP1",25,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","KMPDTP1",26,0)
 .S ZTDESC=KMPDTTL
"RTN","KMPDTP1",27,0)
 .S ZTRTN="EN1^KMPDTP1"
"RTN","KMPDTP1",28,0)
 .S ZTSAVE("KMPDATE()")="",ZTSAVE("KMPDPTNP")="",ZTSAVE("KMPDTTL")=""
"RTN","KMPDTP1",29,0)
 .D ^%ZTLOAD W:$G(ZTSK) !,"Task #",ZTSK
"RTN","KMPDTP1",30,0)
 .D EXIT
"RTN","KMPDTP1",31,0)
 ;
"RTN","KMPDTP1",32,0)
 ; if output to terminal display message.
"RTN","KMPDTP1",33,0)
 W:$E(IOST,1,2)="C-" !,"Compiling timing stats..."
"RTN","KMPDTP1",34,0)
 D EN1
"RTN","KMPDTP1",35,0)
 ;
"RTN","KMPDTP1",36,0)
 Q
"RTN","KMPDTP1",37,0)
 ;
"RTN","KMPDTP1",38,0)
EN1 ;-- entry point from taskman
"RTN","KMPDTP1",39,0)
 Q:'$D(KMPDATE)
"RTN","KMPDTP1",40,0)
 Q:'$G(KMPDPTNP)
"RTN","KMPDTP1",41,0)
 K ^TMP($J)
"RTN","KMPDTP1",42,0)
 D DATA,PRINT,EXIT
"RTN","KMPDTP1",43,0)
 K ^TMP($J)
"RTN","KMPDTP1",44,0)
 Q
"RTN","KMPDTP1",45,0)
 ;
"RTN","KMPDTP1",46,0)
DATA ;-- compile data
"RTN","KMPDTP1",47,0)
 Q:'$D(KMPDATE)
"RTN","KMPDTP1",48,0)
 Q:'$G(KMPDPTNP)
"RTN","KMPDTP1",49,0)
 N DATA,DATE,DOT,END,IEN,PTNP,QUEUED
"RTN","KMPDTP1",50,0)
 S DATE=$P(KMPDATE(0),U)-.1,END=$P(KMPDATE(0),U,2),PTNP=(+KMPDPTNP)
"RTN","KMPDTP1",51,0)
 Q:'DATE!('END)!('PTNP)
"RTN","KMPDTP1",52,0)
 S DOT=1,QUEUED=$D(ZTQUEUED)
"RTN","KMPDTP1",53,0)
 F  S DATE=$O(^KMPD(8973.2,"ASSDTPT","ORWCV",DATE)) Q:'DATE!(DATE>END)  D 
"RTN","KMPDTP1",54,0)
 .S IEN=0,^TMP($J,DATE)=""
"RTN","KMPDTP1",55,0)
 .F  S IEN=$O(^KMPD(8973.2,"ASSDTPT","ORWCV",DATE,PTNP,IEN)) Q:'IEN  D 
"RTN","KMPDTP1",56,0)
 ..Q:'$D(^KMPD(8973.2,IEN,0))  S DATA=^(0) Q:DATA=""
"RTN","KMPDTP1",57,0)
 ..I 'QUEUED S DOT=DOT+1 W:'(DOT#1000) "."
"RTN","KMPDTP1",58,0)
 ..; if delta
"RTN","KMPDTP1",59,0)
 ..I $P(DATA,U,4)'="" D 
"RTN","KMPDTP1",60,0)
 ...; minimum delta
"RTN","KMPDTP1",61,0)
 ...I $P(^TMP($J,DATE),U,2)=""!($P(DATA,U,4)<$P(^TMP($J,DATE),U,2)) D 
"RTN","KMPDTP1",62,0)
 ....S $P(^TMP($J,DATE),U,2)=$P(DATA,U,4)
"RTN","KMPDTP1",63,0)
 ...; maximum delta
"RTN","KMPDTP1",64,0)
 ...I $P(DATA,U,4)>$P(^TMP($J,DATE),U,3) S $P(^TMP($J,DATE),U,3)=$P(DATA,U,4)
"RTN","KMPDTP1",65,0)
 ...; total delta
"RTN","KMPDTP1",66,0)
 ...S $P(^TMP($J,DATE),U,4)=$P(^TMP($J,DATE),U,4)+$P(DATA,U,4)
"RTN","KMPDTP1",67,0)
 ...; count
"RTN","KMPDTP1",68,0)
 ...S $P(^TMP($J,DATE),U,5)=$P(^TMP($J,DATE),U,5)+1
"RTN","KMPDTP1",69,0)
 ..; if no delta
"RTN","KMPDTP1",70,0)
 ..E  S $P(^TMP($J,DATE),U,6)=$P(^TMP($J,DATE),U,6)+1
"RTN","KMPDTP1",71,0)
 .;
"RTN","KMPDTP1",72,0)
 .; back to DATE level
"RTN","KMPDTP1",73,0)
 .; average
"RTN","KMPDTP1",74,0)
 .S:$P(^TMP($J,DATE),U,5) $P(^TMP($J,DATE),U)=$P(^TMP($J,DATE),U,4)/$P(^TMP($J,DATE),U,5)
"RTN","KMPDTP1",75,0)
 ;
"RTN","KMPDTP1",76,0)
 Q
"RTN","KMPDTP1",77,0)
 ;
"RTN","KMPDTP1",78,0)
PRINT ;-- print data
"RTN","KMPDTP1",79,0)
 D HDR
"RTN","KMPDTP1",80,0)
 Q:'$D(^TMP($J))
"RTN","KMPDTP1",81,0)
 N DATE,TOTAL S (DATE,TOTAL)=""
"RTN","KMPDTP1",82,0)
 F  S DATE=$O(^TMP($J,DATE)) Q:'DATE  S DATA=^TMP($J,DATE) D 
"RTN","KMPDTP1",83,0)
 .W !,$$FMTE^XLFDT(DATE,2)
"RTN","KMPDTP1",84,0)
 .W ?12,$J($FN($P(DATA,U),",",0),10)
"RTN","KMPDTP1",85,0)
 .W ?26,$J($FN($P(DATA,U,2),",",0),10)
"RTN","KMPDTP1",86,0)
 .W ?40,$J($FN($P(DATA,U,3),",",0),10)
"RTN","KMPDTP1",87,0)
 .W ?54,$J($FN($P(DATA,U,5),",",0),10)
"RTN","KMPDTP1",88,0)
 .; total incompletes
"RTN","KMPDTP1",89,0)
 .S TOTAL=TOTAL+$P(DATA,U,6)
"RTN","KMPDTP1",90,0)
 ;
"RTN","KMPDTP1",91,0)
 W !!?12,"Incomplete: ",$J($FN(TOTAL,",",0),$L(TOTAL)+2)
"RTN","KMPDTP1",92,0)
 ; legend
"RTN","KMPDTP1",93,0)
 W !!?2,"CV  = Coversheet",!?2,"TTL = Time-to-Load"
"RTN","KMPDTP1",94,0)
 ; pause if output to terminal
"RTN","KMPDTP1",95,0)
 D CONTINUE^KMPDUTL4("Press RETURN to continue",4)
"RTN","KMPDTP1",96,0)
 Q
"RTN","KMPDTP1",97,0)
 ;
"RTN","KMPDTP1",98,0)
HDR ;-- print header
"RTN","KMPDTP1",99,0)
 W @IOF
"RTN","KMPDTP1",100,0)
 S X=$G(KMPDTTL)
"RTN","KMPDTP1",101,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP1",102,0)
 S X=$P($G(KMPDPTNP),U,2)
"RTN","KMPDTP1",103,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP1",104,0)
 S X=$G(KMPDATE(0)),X=$P(X,U,3)_" - "_$P(X,U,4)
"RTN","KMPDTP1",105,0)
 W !?(80-$L(X)\2),X,?61,"Printed: ",$$FMTE^XLFDT(DT,2)
"RTN","KMPDTP1",106,0)
 W !
"RTN","KMPDTP1",107,0)
 W !?12,"|---------------Seconds---------------|"
"RTN","KMPDTP1",108,0)
 W !,"Date",?12,"Average TTL",?26,"Minimum TTL",?40,"Maximum TTL",?54,"# of CV Loads"
"RTN","KMPDTP1",109,0)
 W !,$$REPEAT^XLFSTR("-",IOM)
"RTN","KMPDTP1",110,0)
 ;
"RTN","KMPDTP1",111,0)
 Q
"RTN","KMPDTP1",112,0)
 ;
"RTN","KMPDTP1",113,0)
EXIT ;-- cleanup on exit
"RTN","KMPDTP1",114,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","KMPDTP1",115,0)
 D ^%ZISC
"RTN","KMPDTP1",116,0)
 K KMPDATE,KMPDPTNP,KMPDTTL
"RTN","KMPDTP1",117,0)
 Q
"RTN","KMPDTP2")
0^10^B21206441
"RTN","KMPDTP2",1,0)
KMPDTP2 ;OAK/RAK - CP Timing Daily Time-to-Load Detail ;11/4/03  14:21
"RTN","KMPDTP2",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDTP2",3,0)
 ;
"RTN","KMPDTP2",4,0)
EN ;-- entry point
"RTN","KMPDTP2",5,0)
 N KMPDATE,KMPDPTNP,KMPDTTL,POP,X,Y,ZTDESC,ZTRTN,ZTSAVE,ZTSK,%ZIS
"RTN","KMPDTP2",6,0)
 S KMPDTTL=" Daily Coversheet Time-to-Load (TTL) Detailed Report "
"RTN","KMPDTP2",7,0)
 D HDR^KMPDUTL4(KMPDTTL)
"RTN","KMPDTP2",8,0)
 W !
"RTN","KMPDTP2",9,0)
 W !?7,"This detailed report displays daily time-to-load values for the"
"RTN","KMPDTP2",10,0)
 W !?7,"coversheet at this site.  The report breaks the time-to-load"
"RTN","KMPDTP2",11,0)
 W !?7,"metrics into ten second groupings."
"RTN","KMPDTP2",12,0)
 W !
"RTN","KMPDTP2",13,0)
 ;
"RTN","KMPDTP2",14,0)
 ; if no data
"RTN","KMPDTP2",15,0)
 I '$O(^KMPD(8973.2,0)) D  Q
"RTN","KMPDTP2",16,0)
 .W !!?7,"*** There is currently no data in file #8973.2 (CP TIMING) ***"
"RTN","KMPDTP2",17,0)
 ;
"RTN","KMPDTP2",18,0)
 ; select date range
"RTN","KMPDTP2",19,0)
 D DATERNG^KMPDTU10("ORWCV",1,.KMPDATE)
"RTN","KMPDTP2",20,0)
 Q:$G(KMPDATE(0))=""
"RTN","KMPDTP2",21,0)
 ;
"RTN","KMPDTP2",22,0)
 ; select time frame
"RTN","KMPDTP2",23,0)
 S KMPDPTNP=$$PTNPSEL^KMPDUTL4
"RTN","KMPDTP2",24,0)
 Q:'KMPDPTNP
"RTN","KMPDTP2",25,0)
 ;
"RTN","KMPDTP2",26,0)
 ; select output device.
"RTN","KMPDTP2",27,0)
 S %ZIS="Q",%ZIS("A")="Device: ",%ZIS("B")="HOME"
"RTN","KMPDTP2",28,0)
 W ! D ^%ZIS I POP W !,"No action taken." Q
"RTN","KMPDTP2",29,0)
 ; if queued.
"RTN","KMPDTP2",30,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","KMPDTP2",31,0)
 .S ZTDESC=KMPDTTL
"RTN","KMPDTP2",32,0)
 .S ZTRTN="EN1^KMPDTP2"
"RTN","KMPDTP2",33,0)
 .S ZTSAVE("KMPDATE()")="",ZTSAVE("KMPDPTNP")="",ZTSAVE("KMPDTTL")=""
"RTN","KMPDTP2",34,0)
 .D ^%ZTLOAD W:$G(ZTSK) !,"Task #",ZTSK
"RTN","KMPDTP2",35,0)
 .D EXIT
"RTN","KMPDTP2",36,0)
 ;
"RTN","KMPDTP2",37,0)
 ; if output to terminal display message.
"RTN","KMPDTP2",38,0)
 W:$E(IOST,1,2)="C-" !,"Compiling timing stats..."
"RTN","KMPDTP2",39,0)
 D EN1
"RTN","KMPDTP2",40,0)
 ;
"RTN","KMPDTP2",41,0)
 Q
"RTN","KMPDTP2",42,0)
 ;
"RTN","KMPDTP2",43,0)
EN1 ;-- entry point from taskman
"RTN","KMPDTP2",44,0)
 Q:'$D(KMPDATE)
"RTN","KMPDTP2",45,0)
 Q:'$G(KMPDPTNP)
"RTN","KMPDTP2",46,0)
 ;
"RTN","KMPDTP2",47,0)
 K ^TMP($J)
"RTN","KMPDTP2",48,0)
 D DATA,PRINT,EXIT
"RTN","KMPDTP2",49,0)
 K ^TMP($J)
"RTN","KMPDTP2",50,0)
 ;
"RTN","KMPDTP2",51,0)
 Q
"RTN","KMPDTP2",52,0)
 ;
"RTN","KMPDTP2",53,0)
DATA ;-- compile data
"RTN","KMPDTP2",54,0)
 Q:'$D(KMPDATE)
"RTN","KMPDTP2",55,0)
 Q:'$G(KMPDPTNP)
"RTN","KMPDTP2",56,0)
 ;
"RTN","KMPDTP2",57,0)
 N DATA,DATE,DELTA,DOT,END,I,IEN,PTNP,QUEUED,TOTAL
"RTN","KMPDTP2",58,0)
 ;
"RTN","KMPDTP2",59,0)
 S QUEUED=$D(ZTQUEUED),DOT=1
"RTN","KMPDTP2",60,0)
 S DATE=$P(KMPDATE(0),U)-.1,END=$P(KMPDATE(0),U,2),PTNP=(+KMPDPTNP)
"RTN","KMPDTP2",61,0)
 Q:'DATE!('END)!('PTNP)
"RTN","KMPDTP2",62,0)
 ;
"RTN","KMPDTP2",63,0)
 F  S DATE=$O(^KMPD(8973.2,"ASSDTPT","ORWCV",DATE)) Q:'DATE!(DATE>END)  D
"RTN","KMPDTP2",64,0)
 .S (IEN,TOTAL)=0,^TMP($J,DATE)=""
"RTN","KMPDTP2",65,0)
 .F  S IEN=$O(^KMPD(8973.2,"ASSDTPT","ORWCV",DATE,PTNP,IEN)) Q:'IEN  D
"RTN","KMPDTP2",66,0)
 ..Q:'$D(^KMPD(8973.2,IEN,0))  S DATA=^(0) Q:DATA=""
"RTN","KMPDTP2",67,0)
 ..S DOT=DOT+1 W:'QUEUED&('(DOT#1000)) "."
"RTN","KMPDTP2",68,0)
 ..S DELTA=$P(DATA,U,4)
"RTN","KMPDTP2",69,0)
 ..;
"RTN","KMPDTP2",70,0)
 ..; if delta is null increment by 1 and quit
"RTN","KMPDTP2",71,0)
 ..I DELTA="" S $P(^TMP($J,DATE),U,50)=$P(^TMP($J,DATE),U,50)+1 Q
"RTN","KMPDTP2",72,0)
 ..; total
"RTN","KMPDTP2",73,0)
 ..S TOTAL=TOTAL+1
"RTN","KMPDTP2",74,0)
 ..;
"RTN","KMPDTP2",75,0)
 ..; loop - less than I*10 seconds
"RTN","KMPDTP2",76,0)
 ..F I=1:1:9 I DELTA<(I*10) S $P(^TMP($J,DATE),U,I)=$P(^TMP($J,DATE),U,I)+1 Q
"RTN","KMPDTP2",77,0)
 ..; 90 or greater seconds
"RTN","KMPDTP2",78,0)
 ..I DELTA>89 S $P(^TMP($J,DATE),U,10)=$P(^TMP($J,DATE),U,10)+1
"RTN","KMPDTP2",79,0)
 .;
"RTN","KMPDTP2",80,0)
 .; back to DATE level
"RTN","KMPDTP2",81,0)
 .; determine percentage
"RTN","KMPDTP2",82,0)
 .I TOTAL F I=1:1:10 D 
"RTN","KMPDTP2",83,0)
 ..S $P(^TMP($J,DATE,1),U,I)=$FN($P(^TMP($J,DATE),U,I)/TOTAL*100,"",1)
"RTN","KMPDTP2",84,0)
 ;
"RTN","KMPDTP2",85,0)
 Q
"RTN","KMPDTP2",86,0)
 ;
"RTN","KMPDTP2",87,0)
PRINT ;-- print data
"RTN","KMPDTP2",88,0)
 D HDR
"RTN","KMPDTP2",89,0)
 Q:'$D(^TMP($J))
"RTN","KMPDTP2",90,0)
 ;
"RTN","KMPDTP2",91,0)
 N CONT,DATE,I,TOTAL
"RTN","KMPDTP2",92,0)
 ;
"RTN","KMPDTP2",93,0)
 S DATE="",CONT=1
"RTN","KMPDTP2",94,0)
 F  S DATE=$O(^TMP($J,DATE)) Q:'DATE  D  Q:'CONT
"RTN","KMPDTP2",95,0)
 .S TOTAL=""
"RTN","KMPDTP2",96,0)
 .S DATA=^TMP($J,DATE),DATA(1)=$G(^TMP($J,DATE,1))
"RTN","KMPDTP2",97,0)
 .W !,$$FMTE^XLFDT(DATE,2)
"RTN","KMPDTP2",98,0)
 .; if no data
"RTN","KMPDTP2",99,0)
 .I DATA="" W ?12,"<No Data for ",$P(KMPDPTNP,U,2),">",! Q
"RTN","KMPDTP2",100,0)
 .; display data
"RTN","KMPDTP2",101,0)
 .F I=1:1:10 D
"RTN","KMPDTP2",102,0)
 ..W ?12
"RTN","KMPDTP2",103,0)
 ..I I<10 W $J(I-1*10,2)," to <",I*10
"RTN","KMPDTP2",104,0)
 ..E  W "90 or greater"
"RTN","KMPDTP2",105,0)
 ..W ?28,$J($FN($P(DATA,U,I),",",0),10)
"RTN","KMPDTP2",106,0)
 ..; percentages
"RTN","KMPDTP2",107,0)
 ..W ?44,$J($FN($P(DATA(1),U,I),"",1),10),"%",!
"RTN","KMPDTP2",108,0)
 ..; totals
"RTN","KMPDTP2",109,0)
 ..S $P(TOTAL,U)=$P(TOTAL,U)+$P(DATA,U,I)
"RTN","KMPDTP2",110,0)
 ..S $P(TOTAL,U,2)=$P(TOTAL,U,2)+$P(DATA(1),U,I)
"RTN","KMPDTP2",111,0)
 .;
"RTN","KMPDTP2",112,0)
 .; back to DATE level
"RTN","KMPDTP2",113,0)
 .; totals
"RTN","KMPDTP2",114,0)
 .W ?28,"----------",?44,"----------"
"RTN","KMPDTP2",115,0)
 .W !?28,$J($FN($P(TOTAL,U),",",0),10)
"RTN","KMPDTP2",116,0)
 .W ?44,$J($FN($P(TOTAL,U,2),"",0),10),"%"
"RTN","KMPDTP2",117,0)
 .W !!?12,"Incomplete",?28,$J($FN($P(DATA,U,50),",",0),10)
"RTN","KMPDTP2",118,0)
 .; page feed if another date
"RTN","KMPDTP2",119,0)
 .I $O(^TMP($J,DATE)) D 
"RTN","KMPDTP2",120,0)
 ..D CONTINUE^KMPDUTL4("",1,.CONT) Q:'CONT
"RTN","KMPDTP2",121,0)
 ..D HDR
"RTN","KMPDTP2",122,0)
 ;
"RTN","KMPDTP2",123,0)
 I CONT D 
"RTN","KMPDTP2",124,0)
 .; legend
"RTN","KMPDTP2",125,0)
 .W !!?2,"CV  = Coversheet",!?2,"TTL = Time-to-Load"
"RTN","KMPDTP2",126,0)
 .; pause if output to terminal
"RTN","KMPDTP2",127,0)
 .D CONTINUE^KMPDUTL4("Press RETURN to continue",1)
"RTN","KMPDTP2",128,0)
 ;
"RTN","KMPDTP2",129,0)
 Q
"RTN","KMPDTP2",130,0)
 ;
"RTN","KMPDTP2",131,0)
HDR ;-- print header
"RTN","KMPDTP2",132,0)
 W @IOF
"RTN","KMPDTP2",133,0)
 S X=$G(KMPDTTL)
"RTN","KMPDTP2",134,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP2",135,0)
 S X=$P($G(KMPDPTNP),U,2)
"RTN","KMPDTP2",136,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP2",137,0)
 S X=$G(KMPDATE(0)),X=$P(X,U,3)_" - "_$P(X,U,4)
"RTN","KMPDTP2",138,0)
 W !?(80-$L(X)\2),X,?61,"Printed: ",$$FMTE^XLFDT(DT,2)
"RTN","KMPDTP2",139,0)
 W !
"RTN","KMPDTP2",140,0)
 W !,"Date",?12,"TTL Seconds",?28,"# of CV Loads",?44,"CV Percent"
"RTN","KMPDTP2",141,0)
 W !,$$REPEAT^XLFSTR("-",IOM)
"RTN","KMPDTP2",142,0)
 ;
"RTN","KMPDTP2",143,0)
 Q
"RTN","KMPDTP2",144,0)
 ;
"RTN","KMPDTP2",145,0)
EXIT ;-- cleanup on exit
"RTN","KMPDTP2",146,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","KMPDTP2",147,0)
 D ^%ZISC
"RTN","KMPDTP2",148,0)
 K KMPDATE,KMPDPTNP,KMPDTTL
"RTN","KMPDTP2",149,0)
 Q
"RTN","KMPDTP3")
0^11^B19734798
"RTN","KMPDTP3",1,0)
KMPDTP3 ;OAK/RAK - CP Timing Hourly Time-to-Load ;11/4/03  14:21
"RTN","KMPDTP3",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDTP3",3,0)
 ;
"RTN","KMPDTP3",4,0)
EN ;-- entry point
"RTN","KMPDTP3",5,0)
 N KMPDATE,KMPDTTL,POP,X,Y,ZTDESC,ZTRTN,ZTRSAVE,%ZIS
"RTN","KMPDTP3",6,0)
 S KMPDTTL=" Hourly Coversheet Time-to-Load (TTL) Report "
"RTN","KMPDTP3",7,0)
 D HDR^KMPDUTL4(KMPDTTL)
"RTN","KMPDTP3",8,0)
 W !
"RTN","KMPDTP3",9,0)
 W !?7,"This report displays the hourly average time-to-load value"
"RTN","KMPDTP3",10,0)
 W !?7,"the coversheet at this site over 24 hours."
"RTN","KMPDTP3",11,0)
 W !
"RTN","KMPDTP3",12,0)
 ;
"RTN","KMPDTP3",13,0)
 ; if no data
"RTN","KMPDTP3",14,0)
 I '$O(^KMPD(8973.2,0)) D  Q
"RTN","KMPDTP3",15,0)
 .W !!?7,"*** There is currently no data in file #8973.2 (CP TIMING) ***"
"RTN","KMPDTP3",16,0)
 ;
"RTN","KMPDTP3",17,0)
 D DATERNG^KMPDTU10("ORWCV",1,.KMPDATE)
"RTN","KMPDTP3",18,0)
 Q:$G(KMPDATE(0))=""
"RTN","KMPDTP3",19,0)
 ; select output device.
"RTN","KMPDTP3",20,0)
 S %ZIS="Q",%ZIS("A")="Device: ",%ZIS("B")="HOME"
"RTN","KMPDTP3",21,0)
 W ! D ^%ZIS I POP W !,"No action taken." Q
"RTN","KMPDTP3",22,0)
 ; if queued.
"RTN","KMPDTP3",23,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","KMPDTP3",24,0)
 .S ZTDESC=KMPDTTL
"RTN","KMPDTP3",25,0)
 .S ZTRTN="EN1^KMPDTP3"
"RTN","KMPDTP3",26,0)
 .S ZTSAVE("KMPDATE()")="",ZTSAVE("KMPDTTL")=""
"RTN","KMPDTP3",27,0)
 .D ^%ZTLOAD W:$G(ZTSK) !,"Task #",ZTSK
"RTN","KMPDTP3",28,0)
 .D EXIT
"RTN","KMPDTP3",29,0)
 ;
"RTN","KMPDTP3",30,0)
 ; if output to terminal display message.
"RTN","KMPDTP3",31,0)
 W:$E(IOST,1,2)="C-" !,"Compiling timing stats..."
"RTN","KMPDTP3",32,0)
 D EN1
"RTN","KMPDTP3",33,0)
 ;
"RTN","KMPDTP3",34,0)
 Q
"RTN","KMPDTP3",35,0)
 ;
"RTN","KMPDTP3",36,0)
EN1 ;-- entry point from taskman
"RTN","KMPDTP3",37,0)
 Q:'$D(KMPDATE)
"RTN","KMPDTP3",38,0)
 K ^TMP($J)
"RTN","KMPDTP3",39,0)
 D DATA,PRINT,EXIT
"RTN","KMPDTP3",40,0)
 K ^TMP($J)
"RTN","KMPDTP3",41,0)
 Q
"RTN","KMPDTP3",42,0)
 ;
"RTN","KMPDTP3",43,0)
DATA ;-- compile data
"RTN","KMPDTP3",44,0)
 Q:'$D(KMPDATE)
"RTN","KMPDTP3",45,0)
 N DATA,DATE,DELTA,DOT,END,HR,I,IEN,PTNP,QUEUED,TOTAL
"RTN","KMPDTP3",46,0)
 S DATE=$P(KMPDATE(0),U)-.1,END=$P(KMPDATE(0),U,2)
"RTN","KMPDTP3",47,0)
 Q:'DATE!('END)
"RTN","KMPDTP3",48,0)
 S DOT=1,QUEUED=$D(ZTQUEUED)
"RTN","KMPDTP3",49,0)
 F  S DATE=$O(^KMPD(8973.2,"ASVDTSS","ORWCV",DATE)) Q:'DATE!(DATE>END)  D 
"RTN","KMPDTP3",50,0)
 .S (IEN,TOTAL)=0
"RTN","KMPDTP3",51,0)
 .; array with hours
"RTN","KMPDTP3",52,0)
 .F I=0:1:23 S ^TMP($J,DATE,I)=""
"RTN","KMPDTP3",53,0)
 .F  S IEN=$O(^KMPD(8973.2,"ASVDTSS","ORWCV",DATE,IEN)) Q:'IEN  D 
"RTN","KMPDTP3",54,0)
 ..Q:'$D(^KMPD(8973.2,IEN,0))  S DATA=^(0) Q:DATA=""
"RTN","KMPDTP3",55,0)
 ..S DOT=DOT+1 W:'QUEUED&('(DOT#1000)) "."
"RTN","KMPDTP3",56,0)
 ..; get delta and hour
"RTN","KMPDTP3",57,0)
 ..S DELTA=$P(DATA,U,4),HR=+$E($P($P(DATA,U,3),".",2),1,2)
"RTN","KMPDTP3",58,0)
 ..; if delta
"RTN","KMPDTP3",59,0)
 ..I $P(DATA,U,4)'="" D 
"RTN","KMPDTP3",60,0)
 ...; minimum delta
"RTN","KMPDTP3",61,0)
 ...I $P(^TMP($J,DATE,HR),U,2)=""!($P(DATA,U,4)<$P(^TMP($J,DATE,HR),U,2)) D 
"RTN","KMPDTP3",62,0)
 ....S $P(^TMP($J,DATE,HR),U,2)=$P(DATA,U,4)
"RTN","KMPDTP3",63,0)
 ...; maximum delta
"RTN","KMPDTP3",64,0)
 ...I $P(DATA,U,4)>$P(^TMP($J,DATE,HR),U,3) S $P(^TMP($J,DATE,HR),U,3)=$P(DATA,U,4)
"RTN","KMPDTP3",65,0)
 ...; total delta
"RTN","KMPDTP3",66,0)
 ...S $P(^TMP($J,DATE,HR),U,4)=$P(^TMP($J,DATE,HR),U,4)+$P(DATA,U,4)
"RTN","KMPDTP3",67,0)
 ...; count
"RTN","KMPDTP3",68,0)
 ...S $P(^TMP($J,DATE,HR),U,5)=$P(^TMP($J,DATE,HR),U,5)+1
"RTN","KMPDTP3",69,0)
 ..; if no delta
"RTN","KMPDTP3",70,0)
 ..E  S $P(^TMP($J,DATE,HR),U,6)=$P(^TMP($J,DATE,HR),U,6)+1
"RTN","KMPDTP3",71,0)
 .;
"RTN","KMPDTP3",72,0)
 .; back to DATE level
"RTN","KMPDTP3",73,0)
 .; average
"RTN","KMPDTP3",74,0)
 .F I=0:1:23 I $P(^TMP($J,DATE,I),U,5) D 
"RTN","KMPDTP3",75,0)
 ..S $P(^TMP($J,DATE,I),U)=$P(^TMP($J,DATE,I),U,4)/$P(^TMP($J,DATE,I),U,5)
"RTN","KMPDTP3",76,0)
 ;
"RTN","KMPDTP3",77,0)
 Q
"RTN","KMPDTP3",78,0)
 ;
"RTN","KMPDTP3",79,0)
PRINT ;-- print data
"RTN","KMPDTP3",80,0)
 D HDR
"RTN","KMPDTP3",81,0)
 Q:'$D(^TMP($J))
"RTN","KMPDTP3",82,0)
 N CONT,DATE,HR,I,TOTAL
"RTN","KMPDTP3",83,0)
 S DATE="",CONT=1
"RTN","KMPDTP3",84,0)
 F  S DATE=$O(^TMP($J,DATE)) Q:'DATE  S HR="" D  Q:'CONT
"RTN","KMPDTP3",85,0)
 .S TOTAL=""
"RTN","KMPDTP3",86,0)
 .W !,$$FMTE^XLFDT(DATE,2)
"RTN","KMPDTP3",87,0)
 .F  S HR=$O(^TMP($J,DATE,HR)) Q:HR=""  D  Q:'CONT
"RTN","KMPDTP3",88,0)
 ..; page feed
"RTN","KMPDTP3",89,0)
 ..I $Y>(IOSL-3) D CONTINUE^KMPDUTL4("",1,.CONT) Q:'CONT  D HDR W !
"RTN","KMPDTP3",90,0)
 ..W ?12," ",$S($L(HR)=1:"0",1:""),HR
"RTN","KMPDTP3",91,0)
 ..S DATA=^TMP($J,DATE,HR)
"RTN","KMPDTP3",92,0)
 ..W ?20,$J($FN($P(DATA,U),",",0),10)
"RTN","KMPDTP3",93,0)
 ..W ?34,$J($FN($P(DATA,U,2),",",0),10)
"RTN","KMPDTP3",94,0)
 ..W ?48,$J($FN($P(DATA,U,3),",",0),10)
"RTN","KMPDTP3",95,0)
 ..W ?62,$J($FN($P(DATA,U,5),",",0),10)
"RTN","KMPDTP3",96,0)
 ..W !
"RTN","KMPDTP3",97,0)
 ..S $P(TOTAL,U)=$P(TOTAL,U)+$P(DATA,U,5)
"RTN","KMPDTP3",98,0)
 ..S $P(TOTAL,U,2)=$P(TOTAL,U,2)+$P(DATA,U,6)
"RTN","KMPDTP3",99,0)
 .;
"RTN","KMPDTP3",100,0)
 .; back to DATE level
"RTN","KMPDTP3",101,0)
 .; totals
"RTN","KMPDTP3",102,0)
 .W ?62,"----------",!?62,$J($FN(TOTAL,",",0),10),!
"RTN","KMPDTP3",103,0)
 .W !?12,"Incomplete: ",$J($FN($P(TOTAL,U,2),",",0),$L($P(TOTAL,U,2))+2),!
"RTN","KMPDTP3",104,0)
 .; if another date
"RTN","KMPDTP3",105,0)
 .I $O(^TMP($J,DATE)) D CONTINUE^KMPDUTL4("",1,.CONT) Q:'CONT  D HDR W !
"RTN","KMPDTP3",106,0)
 ;
"RTN","KMPDTP3",107,0)
 I CONT D 
"RTN","KMPDTP3",108,0)
 .; legend
"RTN","KMPDTP3",109,0)
 .W !!?2,"CV  = Coversheet",!?2,"TTL = Time-to-Load"
"RTN","KMPDTP3",110,0)
 .; pause if output to terminal
"RTN","KMPDTP3",111,0)
 .D CONTINUE^KMPDUTL4("Press RETURN to continue",1)
"RTN","KMPDTP3",112,0)
 ;
"RTN","KMPDTP3",113,0)
 Q
"RTN","KMPDTP3",114,0)
 ;
"RTN","KMPDTP3",115,0)
HDR ;-- print header
"RTN","KMPDTP3",116,0)
 W @IOF
"RTN","KMPDTP3",117,0)
 S X=$G(KMPDTTL)
"RTN","KMPDTP3",118,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP3",119,0)
 S X=$G(KMPDATE(0)),X=$P(X,U,3)_" - "_$P(X,U,4)
"RTN","KMPDTP3",120,0)
 W !?(80-$L(X)\2),X,?61,"Printed: ",$$FMTE^XLFDT(DT,2)
"RTN","KMPDTP3",121,0)
 W !
"RTN","KMPDTP3",122,0)
 W !?20,"|---------------Seconds---------------|"
"RTN","KMPDTP3",123,0)
 W !,"Date",?12,"Hour",?20,"TTL Average",?34,"TTL Minimum",?48,"TTL Maximum",?62,"# of CV Loads"
"RTN","KMPDTP3",124,0)
 W !,$$REPEAT^XLFSTR("-",IOM)
"RTN","KMPDTP3",125,0)
 ;
"RTN","KMPDTP3",126,0)
 Q
"RTN","KMPDTP3",127,0)
 ;
"RTN","KMPDTP3",128,0)
EXIT ;-- cleanup on exit
"RTN","KMPDTP3",129,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","KMPDTP3",130,0)
 D ^%ZISC
"RTN","KMPDTP3",131,0)
 K KMPDATE,KMPDTTL
"RTN","KMPDTP3",132,0)
 Q
"RTN","KMPDTP4")
0^16^B26904696
"RTN","KMPDTP4",1,0)
KMPDTP4 ;OAK/RAK - CP Timing Hourly Time-to-Load ;11/4/03  14:21
"RTN","KMPDTP4",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDTP4",3,0)
 ;
"RTN","KMPDTP4",4,0)
EN ;-- entry point
"RTN","KMPDTP4",5,0)
 ;
"RTN","KMPDTP4",6,0)
 N KMPDATE,KMPDTTL,POP,X,Y,ZTDESC,ZTRTN,ZTRSAVE,ZTSK,%ZIS
"RTN","KMPDTP4",7,0)
 ;
"RTN","KMPDTP4",8,0)
 S KMPDTTL=" Hourly Coversheet Time-to-Load (TTL) Detail Report "
"RTN","KMPDTP4",9,0)
 D HDR^KMPDUTL4(KMPDTTL)
"RTN","KMPDTP4",10,0)
 W !
"RTN","KMPDTP4",11,0)
 W !?7,"This detail report displays the hourly time-to-load values"
"RTN","KMPDTP4",12,0)
 W !?7,"for the coversheet at this site.  The report breaks the"
"RTN","KMPDTP4",13,0)
 W !?7,"time-to-load metrics into ten second groupings."
"RTN","KMPDTP4",14,0)
 W !
"RTN","KMPDTP4",15,0)
 ;
"RTN","KMPDTP4",16,0)
 ; if no data
"RTN","KMPDTP4",17,0)
 I '$O(^KMPD(8973.2,0)) D  Q
"RTN","KMPDTP4",18,0)
 .W !!?7,"*** There is currently no data in file #8973.2 (CP TIMING) ***"
"RTN","KMPDTP4",19,0)
 ;
"RTN","KMPDTP4",20,0)
 ; date & hour(s)
"RTN","KMPDTP4",21,0)
 D DTTMRNG^KMPDTU10("ORWCV",1,.KMPDATE,8)
"RTN","KMPDTP4",22,0)
 Q:$G(KMPDATE(0))=""
"RTN","KMPDTP4",23,0)
 Q:$G(KMPDATE(1))=""
"RTN","KMPDTP4",24,0)
 ;
"RTN","KMPDTP4",25,0)
 ; select output device.
"RTN","KMPDTP4",26,0)
 S %ZIS="Q",%ZIS("A")="Device: ",%ZIS("B")="HOME"
"RTN","KMPDTP4",27,0)
 W ! D ^%ZIS I POP W !,"No action taken." Q
"RTN","KMPDTP4",28,0)
 ; if queued.
"RTN","KMPDTP4",29,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","KMPDTP4",30,0)
 .S ZTDESC=KMPDTTL
"RTN","KMPDTP4",31,0)
 .S ZTRTN="EN1^KMPDTP4"
"RTN","KMPDTP4",32,0)
 .S ZTSAVE("KMPDATE()")="",ZTSAVE("KMPDTTL")=""
"RTN","KMPDTP4",33,0)
 .D ^%ZTLOAD W:$G(ZTSK) !,"Task #",ZTSK
"RTN","KMPDTP4",34,0)
 .D EXIT
"RTN","KMPDTP4",35,0)
 ;
"RTN","KMPDTP4",36,0)
 ; if output to terminal display message.
"RTN","KMPDTP4",37,0)
 W:$E(IOST,1,2)="C-" !,"Compiling timing stats..."
"RTN","KMPDTP4",38,0)
 D EN1
"RTN","KMPDTP4",39,0)
 ;
"RTN","KMPDTP4",40,0)
 Q
"RTN","KMPDTP4",41,0)
 ;
"RTN","KMPDTP4",42,0)
EN1 ;-- entry point from taskman
"RTN","KMPDTP4",43,0)
 Q:'$D(KMPDATE)
"RTN","KMPDTP4",44,0)
 K ^TMP($J)
"RTN","KMPDTP4",45,0)
 D DATA,PRINT,EXIT
"RTN","KMPDTP4",46,0)
 K ^TMP($J)
"RTN","KMPDTP4",47,0)
 Q
"RTN","KMPDTP4",48,0)
 ;
"RTN","KMPDTP4",49,0)
DATA ;-- compile data
"RTN","KMPDTP4",50,0)
 ;
"RTN","KMPDTP4",51,0)
 Q:'$D(KMPDATE)
"RTN","KMPDTP4",52,0)
 ;
"RTN","KMPDTP4",53,0)
 N DATA,DATE,DATE1,DELTA,DOT,END,HOUR,HR,I,IEN,PTNP,QUEUED,TOTAL
"RTN","KMPDTP4",54,0)
 ;
"RTN","KMPDTP4",55,0)
 S DOT=1,QUEUED=$D(ZTQUEUED)
"RTN","KMPDTP4",56,0)
 ; set up HOUR() array
"RTN","KMPDTP4",57,0)
 F I=1:1:24 S:$P(KMPDATE(1),",",I)'="" HOUR(+$P(KMPDATE(1),",",I))=""
"RTN","KMPDTP4",58,0)
 Q:'$D(HOUR)
"RTN","KMPDTP4",59,0)
 S DATE=$P(KMPDATE(0),U)-.1,END=$P(KMPDATE(0),U,2)+.9
"RTN","KMPDTP4",60,0)
 Q:'DATE!('END)
"RTN","KMPDTP4",61,0)
 F  S DATE=$O(^KMPD(8973.2,"ASSDTTM","ORWCV",DATE)) Q:'DATE!(DATE>END)  D 
"RTN","KMPDTP4",62,0)
 .; date without time
"RTN","KMPDTP4",63,0)
 .S DATE1=$P(DATE,".")
"RTN","KMPDTP4",64,0)
 .; set up HOUR() array
"RTN","KMPDTP4",65,0)
 .M:'$D(^TMP($J,DATE1)) ^TMP($J,DATE1)=HOUR
"RTN","KMPDTP4",66,0)
 .; set up TOTAL() array
"RTN","KMPDTP4",67,0)
 .M:'$D(TOTAL(DATE1)) TOTAL(DATE1)=HOUR
"RTN","KMPDTP4",68,0)
 .S IEN=0
"RTN","KMPDTP4",69,0)
 .F  S IEN=$O(^KMPD(8973.2,"ASSDTTM","ORWCV",DATE,IEN)) Q:'IEN  D 
"RTN","KMPDTP4",70,0)
 ..S HR=+$E($P(DATE,".",2),1,2) S:HR="" HR="0"
"RTN","KMPDTP4",71,0)
 ..Q:'$D(HOUR(HR))
"RTN","KMPDTP4",72,0)
 ..Q:'$D(^KMPD(8973.2,IEN,0))  S DATA=^(0) Q:DATA=""
"RTN","KMPDTP4",73,0)
 ..S DOT=DOT+1 W:'QUEUED&('(DOT#1000)) "."
"RTN","KMPDTP4",74,0)
 ..S DELTA=$P(DATA,U,4)
"RTN","KMPDTP4",75,0)
 ..; if delta is null increment by 1 and quit
"RTN","KMPDTP4",76,0)
 ..I DELTA="" S $P(^TMP($J,DATE1,HR),U,50)=$P(^TMP($J,DATE1,HR),U,50)+1 Q
"RTN","KMPDTP4",77,0)
 ..; total
"RTN","KMPDTP4",78,0)
 ..S TOTAL(DATE1,HR)=TOTAL(DATE1,HR)+1
"RTN","KMPDTP4",79,0)
 ..;
"RTN","KMPDTP4",80,0)
 ..;
"RTN","KMPDTP4",81,0)
 ..; loop - less than I*10 seconds
"RTN","KMPDTP4",82,0)
 ..F I=1:1:9 I DELTA<(I*10) S $P(^TMP($J,DATE1,HR),U,I)=$P(^TMP($J,DATE1,HR),U,I)+1 Q
"RTN","KMPDTP4",83,0)
 ..; 90 or greater seconds
"RTN","KMPDTP4",84,0)
 ..I DELTA>89 S $P(^TMP($J,DATE1,HR),U,10)=$P(^TMP($J,DATE1,HR),U,10)+1
"RTN","KMPDTP4",85,0)
 ;
"RTN","KMPDTP4",86,0)
 ; determine percentage
"RTN","KMPDTP4",87,0)
 S DATE1=0
"RTN","KMPDTP4",88,0)
 F  S DATE1=$O(TOTAL(DATE1)) Q:'DATE1  S HR="" D 
"RTN","KMPDTP4",89,0)
 .F  S HR=$O(TOTAL(DATE1,HR)) Q:HR=""  I TOTAL(DATE1,HR) F I=1:1:10 D 
"RTN","KMPDTP4",90,0)
 ..S $P(^TMP($J,DATE1,HR,1),U,I)=$FN($P(^TMP($J,DATE1,HR),U,I)/TOTAL(DATE1,HR)*100,"",1)
"RTN","KMPDTP4",91,0)
 ;
"RTN","KMPDTP4",92,0)
 Q
"RTN","KMPDTP4",93,0)
 ;
"RTN","KMPDTP4",94,0)
PRINT ;-- print data
"RTN","KMPDTP4",95,0)
 ;
"RTN","KMPDTP4",96,0)
 D HDR
"RTN","KMPDTP4",97,0)
 Q:'$D(^TMP($J))
"RTN","KMPDTP4",98,0)
 N CONT,DATE,I,TOTAL
"RTN","KMPDTP4",99,0)
 S DATE="",CONT=1
"RTN","KMPDTP4",100,0)
 F  S DATE=$O(^TMP($J,DATE)) Q:'DATE  D  Q:'CONT
"RTN","KMPDTP4",101,0)
 .W !,$$FMTE^XLFDT(DATE,2) S HR=""
"RTN","KMPDTP4",102,0)
 .F  S HR=$O(^TMP($J,DATE,HR)) Q:HR=""  D  Q:'CONT
"RTN","KMPDTP4",103,0)
 ..I $Y>(IOSL-9) D  Q:'CONT
"RTN","KMPDTP4",104,0)
 ...D CONTINUE^KMPDUTL4("",1,.CONT) Q:'CONT
"RTN","KMPDTP4",105,0)
 ...D HDR W !,$$FMTE^XLFDT(DATE,2)
"RTN","KMPDTP4",106,0)
 ..W ?12,HR
"RTN","KMPDTP4",107,0)
 ..S TOTAL="",DATA=^TMP($J,DATE,HR),DATA(1)=$G(^TMP($J,DATE,HR,1))
"RTN","KMPDTP4",108,0)
 ..; if no data
"RTN","KMPDTP4",109,0)
 ..I DATA="" W ?12,"<No Data>",! Q
"RTN","KMPDTP4",110,0)
 ..; display data
"RTN","KMPDTP4",111,0)
 ..F I=1:1:9 D 
"RTN","KMPDTP4",112,0)
 ...W ?16,I-1*10," to <",I*10
"RTN","KMPDTP4",113,0)
 ...W ?32,$J($FN($P(DATA,U,I),",",0),10)
"RTN","KMPDTP4",114,0)
 ...; percentages
"RTN","KMPDTP4",115,0)
 ...W ?48,$J($FN($P(DATA(1),U,I),"",1),10),"%"
"RTN","KMPDTP4",116,0)
 ...W !
"RTN","KMPDTP4",117,0)
 ...; totals
"RTN","KMPDTP4",118,0)
 ...S $P(TOTAL,U)=$P(TOTAL,U)+$P(DATA,U,I)
"RTN","KMPDTP4",119,0)
 ...S $P(TOTAL,U,2)=$P(TOTAL,U,2)+$P(DATA(1),U,I)
"RTN","KMPDTP4",120,0)
 ..;
"RTN","KMPDTP4",121,0)
 ..; back to DATE level
"RTN","KMPDTP4",122,0)
 ..; greater than 90
"RTN","KMPDTP4",123,0)
 ..W ?16,"90 or greater",?32,$J($FN($P(DATA,U,10),",",0),10)
"RTN","KMPDTP4",124,0)
 ..W ?48,$J($FN($P(DATA(1),U,10),"",1),10),"%"
"RTN","KMPDTP4",125,0)
 ..S $P(TOTAL,U)=$P(TOTAL,U)+$P(DATA,U,10)
"RTN","KMPDTP4",126,0)
 ..S $P(TOTAL,U,2)=$P(TOTAL,U,2)+$P(DATA(1),U,10)
"RTN","KMPDTP4",127,0)
 ..; totals
"RTN","KMPDTP4",128,0)
 ..W !?32,"----------",?48,"----------"
"RTN","KMPDTP4",129,0)
 ..W !?32,$J($FN($P(TOTAL,U),",",0),10)
"RTN","KMPDTP4",130,0)
 ..W ?48,$J($FN($P(TOTAL,U,2),"",0),10),"%"
"RTN","KMPDTP4",131,0)
 ..W !?16,"Incomplete",?32,$J($FN($P(DATA,U,50),",",0),10),!
"RTN","KMPDTP4",132,0)
 ..; page feed if another date
"RTN","KMPDTP4",133,0)
 ..I $O(^TMP($J,DATE)) D 
"RTN","KMPDTP4",134,0)
 ...D CONTINUE^KMPDUTL4("",1,.CONT) Q:'CONT
"RTN","KMPDTP4",135,0)
 ...D HDR
"RTN","KMPDTP4",136,0)
 ..W !
"RTN","KMPDTP4",137,0)
 ;
"RTN","KMPDTP4",138,0)
 I CONT D 
"RTN","KMPDTP4",139,0)
 .; legend
"RTN","KMPDTP4",140,0)
 .W !!?2,"CV  = Coversheet",!?2,"TTL = Time-to-Load"
"RTN","KMPDTP4",141,0)
 .; pause if output to terminal
"RTN","KMPDTP4",142,0)
 .D CONTINUE^KMPDUTL4("Press RETURN to continue",1)
"RTN","KMPDTP4",143,0)
 ;
"RTN","KMPDTP4",144,0)
 Q
"RTN","KMPDTP4",145,0)
 ;
"RTN","KMPDTP4",146,0)
HDR ;-- print header
"RTN","KMPDTP4",147,0)
 W @IOF
"RTN","KMPDTP4",148,0)
 S X=$G(KMPDTTL)
"RTN","KMPDTP4",149,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP4",150,0)
 S X=$G(KMPDATE(0)),X=$P(X,U,3)_" - "_$P(X,U,4)
"RTN","KMPDTP4",151,0)
 W !?(80-$L(X)\2),X,?61,"Printed: ",$$FMTE^XLFDT(DT,2)
"RTN","KMPDTP4",152,0)
 W !
"RTN","KMPDTP4",153,0)
 W !,"Date",?12,"Hr",?16,"TTL Seconds",?32,"# CV Loads",?48,"CV Percent"
"RTN","KMPDTP4",154,0)
 W !,$$REPEAT^XLFSTR("-",IOM)
"RTN","KMPDTP4",155,0)
 ;
"RTN","KMPDTP4",156,0)
 Q
"RTN","KMPDTP4",157,0)
 ;
"RTN","KMPDTP4",158,0)
EXIT ;-- cleanup on exit
"RTN","KMPDTP4",159,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","KMPDTP4",160,0)
 D ^%ZISC
"RTN","KMPDTP4",161,0)
 K KMPDATE,KMPDTTL
"RTN","KMPDTP4",162,0)
 Q
"RTN","KMPDTP5")
0^17^B26931833
"RTN","KMPDTP5",1,0)
KMPDTP5 ;OAK/RAK - CP Timing Threshold Alert ;11/4/03  14:22
"RTN","KMPDTP5",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDTP5",3,0)
 ;
"RTN","KMPDTP5",4,0)
EN ;-- entry point
"RTN","KMPDTP5",5,0)
 ;
"RTN","KMPDTP5",6,0)
 N I,KMPDATE,KMPDSRCH,KMPDTSEC,KMPDTTL,POP,X,Y
"RTN","KMPDTP5",7,0)
 N ZTDESC,ZTRTN,ZTRSAVE,ZTSK,%ZIS
"RTN","KMPDTP5",8,0)
 ;
"RTN","KMPDTP5",9,0)
 S KMPDTTL=" Coversheet Time-to-Load (TTL) Alert Report "
"RTN","KMPDTP5",10,0)
 D HDR^KMPDUTL4(KMPDTTL)
"RTN","KMPDTP5",11,0)
 W !
"RTN","KMPDTP5",12,0)
 W !?7,"This alerting report shows the particular coversheet loads"
"RTN","KMPDTP5",13,0)
 W !?7,"which had excessive time-to-load values. This report will"
"RTN","KMPDTP5",14,0)
 W !?7,"search for a particular person, a particular client name or"
"RTN","KMPDTP5",15,0)
 W !?7,"IP address."
"RTN","KMPDTP5",16,0)
 W !
"RTN","KMPDTP5",17,0)
 ;
"RTN","KMPDTP5",18,0)
 ; if no data
"RTN","KMPDTP5",19,0)
 I '$O(^KMPD(8973.2,0)) D  Q
"RTN","KMPDTP5",20,0)
 .W !!?7,"*** There is currently no data in file #8973.2 (CP TIMING) ***"
"RTN","KMPDTP5",21,0)
 ;
"RTN","KMPDTP5",22,0)
 ; date & hour(s)
"RTN","KMPDTP5",23,0)
 D DTTMRNG^KMPDTU10("ORWCV",1,.KMPDATE,8)
"RTN","KMPDTP5",24,0)
 Q:$G(KMPDATE(0))=""
"RTN","KMPDTP5",25,0)
 Q:$G(KMPDATE(1))=""
"RTN","KMPDTP5",26,0)
 ;
"RTN","KMPDTP5",27,0)
 ; time-to-load threshold seconds
"RTN","KMPDTP5",28,0)
 S KMPDTSEC=$$TTLSEC^KMPDTU10
"RTN","KMPDTP5",29,0)
 Q:'KMPDTSEC
"RTN","KMPDTP5",30,0)
 ;
"RTN","KMPDTP5",31,0)
 ; search by
"RTN","KMPDTP5",32,0)
 D SRCHBY^KMPDTU10(.KMPDSRCH,"ORWCV")
"RTN","KMPDTP5",33,0)
 Q:'KMPDSRCH
"RTN","KMPDTP5",34,0)
 ;
"RTN","KMPDTP5",35,0)
 ; select output device.
"RTN","KMPDTP5",36,0)
 S %ZIS="Q",%ZIS("A")="Device: ",%ZIS("B")="HOME"
"RTN","KMPDTP5",37,0)
 W ! D ^%ZIS I POP W !,"No action taken." Q
"RTN","KMPDTP5",38,0)
 ; if queued.
"RTN","KMPDTP5",39,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","KMPDTP5",40,0)
 .S ZTDESC=KMPDTTL
"RTN","KMPDTP5",41,0)
 .S ZTRTN="EN1^KMPDTP5"
"RTN","KMPDTP5",42,0)
 .F I="KMPDATE()","KMPDSRCH()","KMPDTSEC","KMPDTTL" S ZTSAVE(I)=""
"RTN","KMPDTP5",43,0)
 .D ^%ZTLOAD W:$G(ZTSK) !,"Task #",ZTSK
"RTN","KMPDTP5",44,0)
 .D EXIT
"RTN","KMPDTP5",45,0)
 ;
"RTN","KMPDTP5",46,0)
 ; if output to terminal display message.
"RTN","KMPDTP5",47,0)
 W:$E(IOST,1,2)="C-" !,"Compiling timing stats..."
"RTN","KMPDTP5",48,0)
 D EN1
"RTN","KMPDTP5",49,0)
 ;
"RTN","KMPDTP5",50,0)
 Q
"RTN","KMPDTP5",51,0)
 ;
"RTN","KMPDTP5",52,0)
EN1 ;-- entry point from taskman
"RTN","KMPDTP5",53,0)
 Q:'$D(KMPDATE)
"RTN","KMPDTP5",54,0)
 Q:'$D(KMPDSRCH)
"RTN","KMPDTP5",55,0)
 Q:'$G(KMPDTSEC)
"RTN","KMPDTP5",56,0)
 Q:$G(KMPDTTL)=""
"RTN","KMPDTP5",57,0)
 ;
"RTN","KMPDTP5",58,0)
 K ^TMP($J)
"RTN","KMPDTP5",59,0)
 D DATA,PRINT,EXIT
"RTN","KMPDTP5",60,0)
 K ^TMP($J)
"RTN","KMPDTP5",61,0)
 Q
"RTN","KMPDTP5",62,0)
 ;
"RTN","KMPDTP5",63,0)
DATA ;-- compile data
"RTN","KMPDTP5",64,0)
 ;
"RTN","KMPDTP5",65,0)
 Q:'$D(KMPDATE)
"RTN","KMPDTP5",66,0)
 Q:'$G(KMPDSRCH)
"RTN","KMPDTP5",67,0)
 Q:'$G(KMPDTSEC)
"RTN","KMPDTP5",68,0)
 ;
"RTN","KMPDTP5",69,0)
 N DATA,DATE,DATE1,DELTA,DOT,END,GBL,HOUR,HR,I,IEN,QUEUED,TIME,XREF
"RTN","KMPDTP5",70,0)
 ;
"RTN","KMPDTP5",71,0)
 S DOT=1,QUEUED=$D(ZTQUEUED)
"RTN","KMPDTP5",72,0)
 ; set up HOUR() array
"RTN","KMPDTP5",73,0)
 F I=1:1:24 S:$P(KMPDATE(1),",",I)'="" HOUR(+$P(KMPDATE(1),",",I))=""
"RTN","KMPDTP5",74,0)
 Q:'$D(HOUR)
"RTN","KMPDTP5",75,0)
 S DATE=$P(KMPDATE(0),U)-.1,END=$P(KMPDATE(0),U,2)+.9
"RTN","KMPDTP5",76,0)
 Q:'DATE!('END)
"RTN","KMPDTP5",77,0)
 S GBL=$$GLOBAL(.KMPDSRCH) Q:GBL=""
"RTN","KMPDTP5",78,0)
 F  S DATE=$O(@GBL@(DATE)) Q:'DATE!(DATE>END)  D 
"RTN","KMPDTP5",79,0)
 .; determine hour
"RTN","KMPDTP5",80,0)
 .S HR=+$E($P(DATE,".",2),1,2) S:HR="" HR="0"
"RTN","KMPDTP5",81,0)
 .; quit if not in HOUR() array
"RTN","KMPDTP5",82,0)
 .Q:'$D(HOUR(HR))
"RTN","KMPDTP5",83,0)
 .; hour & second
"RTN","KMPDTP5",84,0)
 .S TIME=$E($P(DATE,".",2),1,4) Q:'TIME
"RTN","KMPDTP5",85,0)
 .; insert colon (:) between hour & second
"RTN","KMPDTP5",86,0)
 .S TIME=$E(TIME,1,2)_":"_$E(TIME,3,4)
"RTN","KMPDTP5",87,0)
 .; date without time
"RTN","KMPDTP5",88,0)
 .S DATE1=$P(DATE,".")
"RTN","KMPDTP5",89,0)
 .S IEN=0
"RTN","KMPDTP5",90,0)
 .F  S IEN=$O(@GBL@(DATE,IEN)) Q:'IEN  D 
"RTN","KMPDTP5",91,0)
 ..Q:'$D(^KMPD(8973.2,IEN,0))  S DATA=^(0) Q:DATA=""
"RTN","KMPDTP5",92,0)
 ..S DOT=DOT+1 W:'QUEUED&('(DOT#1000)) "."
"RTN","KMPDTP5",93,0)
 ..S DELTA=$P(DATA,U,4)
"RTN","KMPDTP5",94,0)
 ..; quit if delta is less than threshold
"RTN","KMPDTP5",95,0)
 ..Q:DELTA<KMPDTSEC
"RTN","KMPDTP5",96,0)
 ..S ^TMP($J,DATE1,TIME)=DATA
"RTN","KMPDTP5",97,0)
 ..; new person - external format
"RTN","KMPDTP5",98,0)
 ..S $P(^TMP($J,DATE1,TIME),U,5)=$P($G(^VA(200,+$P(DATA,U,5),0)),U)
"RTN","KMPDTP5",99,0)
 ;
"RTN","KMPDTP5",100,0)
 Q
"RTN","KMPDTP5",101,0)
 ;
"RTN","KMPDTP5",102,0)
PRINT ;-- print data
"RTN","KMPDTP5",103,0)
 ;
"RTN","KMPDTP5",104,0)
 D HDR
"RTN","KMPDTP5",105,0)
 Q:'$D(^TMP($J))
"RTN","KMPDTP5",106,0)
 N CONT,DATE,I,TOTAL
"RTN","KMPDTP5",107,0)
 S DATE="",CONT=1,TOTAL=0
"RTN","KMPDTP5",108,0)
 F  S DATE=$O(^TMP($J,DATE)) Q:'DATE  D  Q:'CONT
"RTN","KMPDTP5",109,0)
 .W !,$$FMTE^XLFDT(DATE,2) S HR=""
"RTN","KMPDTP5",110,0)
 .F  S HR=$O(^TMP($J,DATE,HR)) Q:HR=""  D  Q:'CONT
"RTN","KMPDTP5",111,0)
 ..I $Y>(IOSL-4) D  Q:'CONT
"RTN","KMPDTP5",112,0)
 ...D CONTINUE^KMPDUTL4("",1,.CONT) Q:'CONT
"RTN","KMPDTP5",113,0)
 ...D HDR W !,$$FMTE^XLFDT(DATE,2)
"RTN","KMPDTP5",114,0)
 ..W ?10,HR
"RTN","KMPDTP5",115,0)
 ..S DATA=^TMP($J,DATE,HR),TOTAL=TOTAL+1
"RTN","KMPDTP5",116,0)
 ..; user name
"RTN","KMPDTP5",117,0)
 ..W ?16,$S($P(DATA,U,5)]"":$E($P(DATA,U,5),1,15),1:"N/A")
"RTN","KMPDTP5",118,0)
 ..; client name
"RTN","KMPDTP5",119,0)
 ..W ?33,$S($P(DATA,U,6)]"":$E($P(DATA,U,6),1,15),1:"N/A")
"RTN","KMPDTP5",120,0)
 ..; ip address
"RTN","KMPDTP5",121,0)
 ..W ?50,$S($P(DATA,U,9)]"":$P(DATA,U,9),1:"N/A")
"RTN","KMPDTP5",122,0)
 ..; server delta
"RTN","KMPDTP5",123,0)
 ..W ?67,$J($P(DATA,U,4),8)
"RTN","KMPDTP5",124,0)
 ..W ! W:$E($O(^TMP($J,DATE,HR)),1,2)'=$E(HR,1,2) !
"RTN","KMPDTP5",125,0)
 ;
"RTN","KMPDTP5",126,0)
 ;I TOTAL W !!?3,"Total Count: ",$J($FN(TOTAL,",",0),$L(TOTAL)+1)
"RTN","KMPDTP5",127,0)
 ;
"RTN","KMPDTP5",128,0)
 ; pause if output to terminal
"RTN","KMPDTP5",129,0)
 I CONT D CONTINUE^KMPDUTL4("Press RETURN to continue",1)
"RTN","KMPDTP5",130,0)
 ;
"RTN","KMPDTP5",131,0)
 Q
"RTN","KMPDTP5",132,0)
 ;
"RTN","KMPDTP5",133,0)
HDR ;-- print header
"RTN","KMPDTP5",134,0)
 W @IOF
"RTN","KMPDTP5",135,0)
 S X=$G(KMPDTTL)
"RTN","KMPDTP5",136,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP5",137,0)
 S X=$G(KMPDATE(0)),X=$P(X,U,3)_" - "_$P(X,U,4)
"RTN","KMPDTP5",138,0)
 W !?(80-$L(X)\2),X,?61,"Printed: ",$$FMTE^XLFDT(DT,2)
"RTN","KMPDTP5",139,0)
 S X=$P($G(KMPDSRCH),U,2)_": "
"RTN","KMPDTP5",140,0)
 S X=X_$P($G(KMPDSRCH(1)),U,$S((+$G(KMPDSRCH))=1:2,1:1))
"RTN","KMPDTP5",141,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP5",142,0)
 S X="Threshold: "_$G(KMPDTSEC)_" seconds"
"RTN","KMPDTP5",143,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP5",144,0)
 W !
"RTN","KMPDTP5",145,0)
 W !,"Date",?10,"Time",?16,"User Name",?33,"Client Name",?50,"IP Address",?67,"Time-to-Load"
"RTN","KMPDTP5",146,0)
 W !,$$REPEAT^XLFSTR("-",IOM)
"RTN","KMPDTP5",147,0)
 ;
"RTN","KMPDTP5",148,0)
 Q
"RTN","KMPDTP5",149,0)
 ;
"RTN","KMPDTP5",150,0)
EXIT ;-- cleanup on exit
"RTN","KMPDTP5",151,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","KMPDTP5",152,0)
 D ^%ZISC
"RTN","KMPDTP5",153,0)
 K KMPDATE,KMPDSRCH,KMPDTSEC,KMPDTTL
"RTN","KMPDTP5",154,0)
 Q
"RTN","KMPDTP5",155,0)
 ;
"RTN","KMPDTP5",156,0)
GLOBAL(KMPDSRCH) ;-- extrinsic function
"RTN","KMPDTP5",157,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTP5",158,0)
 ; KMPDSRCH... see above
"RTN","KMPDTP5",159,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTP5",160,0)
 Q:'$G(KMPDSRCH) ""
"RTN","KMPDTP5",161,0)
 N GLOBAL,TYPE
"RTN","KMPDTP5",162,0)
 S GLOBAL=""
"RTN","KMPDTP5",163,0)
 S TYPE=+$G(KMPDSRCH)
"RTN","KMPDTP5",164,0)
 Q:'TYPE ""
"RTN","KMPDTP5",165,0)
 ; username
"RTN","KMPDTP5",166,0)
 I TYPE=1 S GLOBAL=$NA(^KMPD(8973.2,"ASSNPDTTM","ORWCV",$P(KMPDSRCH(1),U)))
"RTN","KMPDTP5",167,0)
 ; client name
"RTN","KMPDTP5",168,0)
 I TYPE=2 S GLOBAL=$NA(^KMPD(8973.2,"ASSCLDTTM","ORWCV",KMPDSRCH(1)))
"RTN","KMPDTP5",169,0)
 ; ip address
"RTN","KMPDTP5",170,0)
 I TYPE=3 S GLOBAL=$NA(^KMPD(8973.2,"ASSIPDTTM","ORWCV",KMPDSRCH(1)))
"RTN","KMPDTP5",171,0)
 ; any occurrence
"RTN","KMPDTP5",172,0)
 I TYPE=4 S GLOBAL=$NA(^KMPD(8973.2,"ASSDTTM","ORWCV"))
"RTN","KMPDTP5",173,0)
 Q GLOBAL
"RTN","KMPDTP6")
0^20^B26628636
"RTN","KMPDTP6",1,0)
KMPDTP6 ;OAK/RAK - CP Timing Real-Time Threshold Alert ;11/4/03  14:22
"RTN","KMPDTP6",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDTP6",3,0)
 ;
"RTN","KMPDTP6",4,0)
EN ;-- entry point
"RTN","KMPDTP6",5,0)
 ;
"RTN","KMPDTP6",6,0)
 N I,KMPDHOUR,KMPDSRCH,KMPDTSEC,KMPDTTL,POP,X,Y
"RTN","KMPDTP6",7,0)
 N ZTDESC,ZTRTN,ZTRSAVE,ZTSK,%ZIS
"RTN","KMPDTP6",8,0)
 ;
"RTN","KMPDTP6",9,0)
 S KMPDTTL=" Coversheet Time-to-Load Alert Report > Real-Time "
"RTN","KMPDTP6",10,0)
 D HDR^KMPDUTL4(KMPDTTL)
"RTN","KMPDTP6",11,0)
 W !
"RTN","KMPDTP6",12,0)
 W !?7,"This alerting report shows the particular coversheet loads"
"RTN","KMPDTP6",13,0)
 W !?7,"which have excessive time-to-load values for TODAY (Real-Time)."
"RTN","KMPDTP6",14,0)
 W !?7,"This report will search for a particular person, a particular"
"RTN","KMPDTP6",15,0)
 W !?7,"client name or IP address."
"RTN","KMPDTP6",16,0)
 W !
"RTN","KMPDTP6",17,0)
 ;
"RTN","KMPDTP6",18,0)
 ; if no data
"RTN","KMPDTP6",19,0)
 I $O(^KMPTMP("KMPDT","ORWCV",""))="" D  Q
"RTN","KMPDTP6",20,0)
 .W !!?7,"*** There is currently no data in global ^KMPTMP(""KMPDT"",""ORWCV"") ***"
"RTN","KMPDTP6",21,0)
 ;
"RTN","KMPDTP6",22,0)
 ; hours
"RTN","KMPDTP6",23,0)
 S KMPDHOUR=$$RLTMHR^KMPDTU11(0,1)
"RTN","KMPDTP6",24,0)
 Q:KMPDHOUR=""
"RTN","KMPDTP6",25,0)
 ;
"RTN","KMPDTP6",26,0)
 ; time-to-load threshold seconds
"RTN","KMPDTP6",27,0)
 S KMPDTSEC=$$TTLSEC^KMPDTU10
"RTN","KMPDTP6",28,0)
 Q:'KMPDTSEC
"RTN","KMPDTP6",29,0)
 ;
"RTN","KMPDTP6",30,0)
 ; search by
"RTN","KMPDTP6",31,0)
 D SRCHBY^KMPDTU10(.KMPDSRCH,"ORWCV",1)
"RTN","KMPDTP6",32,0)
 Q:'KMPDSRCH
"RTN","KMPDTP6",33,0)
 ;
"RTN","KMPDTP6",34,0)
 ; select output device.
"RTN","KMPDTP6",35,0)
 S %ZIS="Q",%ZIS("A")="Device: ",%ZIS("B")="HOME"
"RTN","KMPDTP6",36,0)
 W ! D ^%ZIS I POP W !,"No action taken." Q
"RTN","KMPDTP6",37,0)
 ; if queued.
"RTN","KMPDTP6",38,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","KMPDTP6",39,0)
 .S ZTDESC=KMPDTTL
"RTN","KMPDTP6",40,0)
 .S ZTRTN="EN1^KMPDTP6"
"RTN","KMPDTP6",41,0)
 .F I="KMPDHOUR","KMPDSRCH()","KMPDTSEC","KMPDTTL" S ZTSAVE(I)=""
"RTN","KMPDTP6",42,0)
 .D ^%ZTLOAD W:$G(ZTSK) !,"Task #",ZTSK
"RTN","KMPDTP6",43,0)
 .D EXIT
"RTN","KMPDTP6",44,0)
 ;
"RTN","KMPDTP6",45,0)
 ; if output to terminal display message.
"RTN","KMPDTP6",46,0)
 W:$E(IOST,1,2)="C-" !,"Compiling timing stats..."
"RTN","KMPDTP6",47,0)
 D EN1
"RTN","KMPDTP6",48,0)
 ;
"RTN","KMPDTP6",49,0)
 Q
"RTN","KMPDTP6",50,0)
 ;
"RTN","KMPDTP6",51,0)
EN1 ;-- entry point from taskman
"RTN","KMPDTP6",52,0)
 Q:'$D(KMPDHOUR)
"RTN","KMPDTP6",53,0)
 Q:'$D(KMPDSRCH)
"RTN","KMPDTP6",54,0)
 Q:'$G(KMPDTSEC)
"RTN","KMPDTP6",55,0)
 Q:$G(KMPDTTL)=""
"RTN","KMPDTP6",56,0)
 ;
"RTN","KMPDTP6",57,0)
 K ^TMP($J)
"RTN","KMPDTP6",58,0)
 D DATA,PRINT,EXIT
"RTN","KMPDTP6",59,0)
 K ^TMP($J)
"RTN","KMPDTP6",60,0)
 Q
"RTN","KMPDTP6",61,0)
 ;
"RTN","KMPDTP6",62,0)
DATA ;-- compile data
"RTN","KMPDTP6",63,0)
 ;
"RTN","KMPDTP6",64,0)
 Q:'$D(KMPDHOUR)
"RTN","KMPDTP6",65,0)
 Q:'$G(KMPDSRCH)
"RTN","KMPDTP6",66,0)
 Q:'$G(KMPDTSEC)
"RTN","KMPDTP6",67,0)
 ;
"RTN","KMPDTP6",68,0)
 N DATA,DATA1,DATE,DATE1,DELTA,DOT,HOUR,HR,I,QUEUED,TIME
"RTN","KMPDTP6",69,0)
 ;
"RTN","KMPDTP6",70,0)
 S DOT=1,QUEUED=$D(ZTQUEUED)
"RTN","KMPDTP6",71,0)
 ; set up HOUR() array
"RTN","KMPDTP6",72,0)
 F I=1:1:24 S:$P(KMPDHOUR,",",I)'="" HOUR(+$P(KMPDHOUR,",",I))=""
"RTN","KMPDTP6",73,0)
 Q:'$D(HOUR)
"RTN","KMPDTP6",74,0)
 S I=""
"RTN","KMPDTP6",75,0)
 F  S I=$O(^KMPTMP("KMPDT","ORWCV",I)) Q:I=""  S DATA=^(I) I DATA]"" D 
"RTN","KMPDTP6",76,0)
 .S DOT=DOT+1 W:'QUEUED&('(DOT#1000)) "."
"RTN","KMPDTP6",77,0)
 .; start/end date/time in fileman format
"RTN","KMPDTP6",78,0)
 .S DATE(1)=$$HTFM^XLFDT($P(DATA,U)),DATE(2)=$$HTFM^XLFDT($P(DATA,U,2))
"RTN","KMPDTP6",79,0)
 .S DELTA=$$HDIFF^XLFDT($P(DATA,U,2),$P(DATA,U),2)
"RTN","KMPDTP6",80,0)
 .Q:DELTA<KMPDTSEC
"RTN","KMPDTP6",81,0)
 .Q:'DATE(1)!('DATE(2))
"RTN","KMPDTP6",82,0)
 .; determine hour
"RTN","KMPDTP6",83,0)
 .S HR=+$E($P(DATE(1),".",2),1,2) S:HR="" HR="0"
"RTN","KMPDTP6",84,0)
 .; quit if not in HOUR() array
"RTN","KMPDTP6",85,0)
 .Q:'$D(HOUR(HR))
"RTN","KMPDTP6",86,0)
 .; hour & second
"RTN","KMPDTP6",87,0)
 .S TIME=$E($P(DATE(1),".",2),1,4) Q:'TIME
"RTN","KMPDTP6",88,0)
 .; insert colon (:) between hour & second
"RTN","KMPDTP6",89,0)
 .S TIME=$E(TIME,1,2)_":"_$E(TIME,3,4)
"RTN","KMPDTP6",90,0)
 .S:$P(TIME,":",2)="" $P(TIME,":",2)="00"
"RTN","KMPDTP6",91,0)
 .; date without time
"RTN","KMPDTP6",92,0)
 .S DATE1=$P(DATE(1),".") Q:'DATE1
"RTN","KMPDTP6",93,0)
 .S DATA1="^^^"_DELTA_"^"_$P(DATA,U,3)_"^"_$P(DATA,U,4)_"^^^"_$P($P(I," ",2),"-")
"RTN","KMPDTP6",94,0)
 .; quit if no match
"RTN","KMPDTP6",95,0)
 .Q:'$$MATCH
"RTN","KMPDTP6",96,0)
 .S ^TMP($J,DATE1,TIME)=DATA1
"RTN","KMPDTP6",97,0)
 .; new person - external format
"RTN","KMPDTP6",98,0)
 .S $P(^TMP($J,DATE1,TIME),U,5)=$P($G(^VA(200,+$P(DATA,U,3),0)),U)
"RTN","KMPDTP6",99,0)
 ;
"RTN","KMPDTP6",100,0)
 Q
"RTN","KMPDTP6",101,0)
 ;
"RTN","KMPDTP6",102,0)
PRINT ;-- print data
"RTN","KMPDTP6",103,0)
 ;
"RTN","KMPDTP6",104,0)
 D HDR
"RTN","KMPDTP6",105,0)
 Q:'$D(^TMP($J))
"RTN","KMPDTP6",106,0)
 N CONT,DATE,I,TOTAL
"RTN","KMPDTP6",107,0)
 S DATE="",CONT=1,TOTAL=0
"RTN","KMPDTP6",108,0)
 F  S DATE=$O(^TMP($J,DATE)) Q:'DATE  D  Q:'CONT
"RTN","KMPDTP6",109,0)
 .W !,$$FMTE^XLFDT(DATE,2) S HR=""
"RTN","KMPDTP6",110,0)
 .F  S HR=$O(^TMP($J,DATE,HR)) Q:HR=""  D  Q:'CONT
"RTN","KMPDTP6",111,0)
 ..I $Y>(IOSL-4) D  Q:'CONT
"RTN","KMPDTP6",112,0)
 ...D CONTINUE^KMPDUTL4("",1,.CONT) Q:'CONT
"RTN","KMPDTP6",113,0)
 ...D HDR W !,$$FMTE^XLFDT(DATE,2)
"RTN","KMPDTP6",114,0)
 ..W ?10,HR
"RTN","KMPDTP6",115,0)
 ..S DATA=^TMP($J,DATE,HR),TOTAL=TOTAL+1
"RTN","KMPDTP6",116,0)
 ..; user name
"RTN","KMPDTP6",117,0)
 ..W ?16,$S($P(DATA,U,5)]"":$E($P(DATA,U,5),1,15),1:"N/A")
"RTN","KMPDTP6",118,0)
 ..; client name
"RTN","KMPDTP6",119,0)
 ..W ?33,$S($P(DATA,U,6)]"":$E($P(DATA,U,6),1,15),1:"N/A")
"RTN","KMPDTP6",120,0)
 ..; ip address
"RTN","KMPDTP6",121,0)
 ..W ?50,$S($P(DATA,U,9)]"":$P(DATA,U,9),1:"N/A")
"RTN","KMPDTP6",122,0)
 ..; server delta
"RTN","KMPDTP6",123,0)
 ..W ?67,$J($P(DATA,U,4),8)
"RTN","KMPDTP6",124,0)
 ..W ! W:$E($O(^TMP($J,DATE,HR)),1,2)'=$E(HR,1,2) !
"RTN","KMPDTP6",125,0)
 ;
"RTN","KMPDTP6",126,0)
 I CONT&(TOTAL) W !!?3,"Total Count: ",$J($FN(TOTAL,",",0),$L(TOTAL)+1)
"RTN","KMPDTP6",127,0)
 ;
"RTN","KMPDTP6",128,0)
 ; pause if output to terminal
"RTN","KMPDTP6",129,0)
 I CONT D CONTINUE^KMPDUTL4("Press RETURN to continue",1)
"RTN","KMPDTP6",130,0)
 ;
"RTN","KMPDTP6",131,0)
 Q
"RTN","KMPDTP6",132,0)
 ;
"RTN","KMPDTP6",133,0)
HDR ;-- print header
"RTN","KMPDTP6",134,0)
 W @IOF
"RTN","KMPDTP6",135,0)
 S X=$G(KMPDTTL)
"RTN","KMPDTP6",136,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP6",137,0)
 S X="Hour(s): "_$G(KMPDHOUR)
"RTN","KMPDTP6",138,0)
 W !?(80-$L(X)\2),X,?61,"Printed: ",$$FMTE^XLFDT(DT,2)
"RTN","KMPDTP6",139,0)
 S X=$P($G(KMPDSRCH),U,2)_": "
"RTN","KMPDTP6",140,0)
 S X=X_$P($G(KMPDSRCH(1)),U,$S((+$G(KMPDSRCH))=1:2,1:1))
"RTN","KMPDTP6",141,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP6",142,0)
 S X="Threshold: "_$G(KMPDTSEC)_" seconds"
"RTN","KMPDTP6",143,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP6",144,0)
 W !
"RTN","KMPDTP6",145,0)
 W !,"Date",?10,"Time",?16,"User Name",?33,"Client Name",?50,"IP Address",?67,"Time-to-Load"
"RTN","KMPDTP6",146,0)
 W !,$$REPEAT^XLFSTR("-",IOM)
"RTN","KMPDTP6",147,0)
 ;
"RTN","KMPDTP6",148,0)
 Q
"RTN","KMPDTP6",149,0)
 ;
"RTN","KMPDTP6",150,0)
EXIT ;-- cleanup on exit
"RTN","KMPDTP6",151,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","KMPDTP6",152,0)
 D ^%ZISC
"RTN","KMPDTP6",153,0)
 K KMPDHOUR,KMPDSRCH,KMPDTSEC,KMPDTTL
"RTN","KMPDTP6",154,0)
 Q
"RTN","KMPDTP6",155,0)
 ;
"RTN","KMPDTP6",156,0)
MATCH() ;-- extrinsic function - check for matches
"RTN","KMPDTP6",157,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTP6",158,0)
 ; Return: 1 - match found
"RTN","KMPDTP6",159,0)
 ;         0 - no match found
"RTN","KMPDTP6",160,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTP6",161,0)
 Q:'$G(KMPDSRCH) 0
"RTN","KMPDTP6",162,0)
 ; any occurrence
"RTN","KMPDTP6",163,0)
 Q:(+KMPDSRCH)=4 1
"RTN","KMPDTP6",164,0)
 ; if not 'any occurrence' then must have kmpdsrch(1) node
"RTN","KMPDTP6",165,0)
 Q:'$D(KMPDSRCH(1)) 0
"RTN","KMPDTP6",166,0)
 ; if not 'any occurrence' must have DATA1 to determine match
"RTN","KMPDTP6",167,0)
 Q:$G(DATA1)=""
"RTN","KMPDTP6",168,0)
 ; user name
"RTN","KMPDTP6",169,0)
 Q:(+KMPDSRCH)=1&($P(DATA1,U,5)'=$P(KMPDSRCH(1),U)) 0
"RTN","KMPDTP6",170,0)
 ; client name
"RTN","KMPDTP6",171,0)
 Q:(+KMPDSRCH)=2&($P(DATA1,U,6)'=$P(KMPDSRCH(1),U)) 0
"RTN","KMPDTP6",172,0)
 ; ip address
"RTN","KMPDTP6",173,0)
 Q:(+KMPDSRCH)=3&($P(DATA1,U,9)'=$P(KMPDSRCH(1),U)) 0
"RTN","KMPDTP6",174,0)
 Q 1
"RTN","KMPDTP7")
0^21^B22931421
"RTN","KMPDTP7",1,0)
KMPDTP7 ;OAK/RAK - Real-Time CP Timing Hourly Time-to-Load ;11/4/03  14:22
"RTN","KMPDTP7",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDTP7",3,0)
 ;
"RTN","KMPDTP7",4,0)
EN ;-- entry point
"RTN","KMPDTP7",5,0)
 N KMPDTTL,POP,X,Y,ZTDESC,ZTRTN,ZTRSAVE,ZTSK,%ZIS
"RTN","KMPDTP7",6,0)
 S KMPDTTL=" Real-Time Hourly Coversheet Time-to-Load (TTL) Report "
"RTN","KMPDTP7",7,0)
 D HDR^KMPDUTL4(KMPDTTL)
"RTN","KMPDTP7",8,0)
 W !
"RTN","KMPDTP7",9,0)
 W !?7,"This report displays the hourly average time-to-load value"
"RTN","KMPDTP7",10,0)
 W !?7,"the coversheet at this site over 24 hours."
"RTN","KMPDTP7",11,0)
 W !
"RTN","KMPDTP7",12,0)
 ;
"RTN","KMPDTP7",13,0)
 ; if no data
"RTN","KMPDTP7",14,0)
 I $O(^KMPTMP("KMPDT","ORWCV",""))="" D  Q
"RTN","KMPDTP7",15,0)
 .W !!?7,"*** There is currently no data in global ^KMPTMP(""KMPDT"",""ORWCV"") ***"
"RTN","KMPDTP7",16,0)
 ;
"RTN","KMPDTP7",17,0)
 ; select output device.
"RTN","KMPDTP7",18,0)
 S %ZIS="Q",%ZIS("A")="Device: ",%ZIS("B")="HOME"
"RTN","KMPDTP7",19,0)
 W ! D ^%ZIS I POP W !,"No action taken." Q
"RTN","KMPDTP7",20,0)
 ; if queued.
"RTN","KMPDTP7",21,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","KMPDTP7",22,0)
 .S ZTDESC=KMPDTTL
"RTN","KMPDTP7",23,0)
 .S ZTRTN="EN1^KMPDTP7"
"RTN","KMPDTP7",24,0)
 .S ZTSAVE("KMPDTTL")=""
"RTN","KMPDTP7",25,0)
 .D ^%ZTLOAD W:$G(ZTSK) !,"Task #",ZTSK
"RTN","KMPDTP7",26,0)
 .D EXIT
"RTN","KMPDTP7",27,0)
 ;
"RTN","KMPDTP7",28,0)
 ; if output to terminal display message.
"RTN","KMPDTP7",29,0)
 W:$E(IOST,1,2)="C-" !,"Compiling timing stats..."
"RTN","KMPDTP7",30,0)
 D EN1
"RTN","KMPDTP7",31,0)
 ;
"RTN","KMPDTP7",32,0)
 Q
"RTN","KMPDTP7",33,0)
 ;
"RTN","KMPDTP7",34,0)
EN1 ;-- entry point from taskman
"RTN","KMPDTP7",35,0)
 K ^TMP($J)
"RTN","KMPDTP7",36,0)
 D DATA,PRINT,EXIT
"RTN","KMPDTP7",37,0)
 K ^TMP($J)
"RTN","KMPDTP7",38,0)
 Q
"RTN","KMPDTP7",39,0)
 ;
"RTN","KMPDTP7",40,0)
DATA ;-- compile data
"RTN","KMPDTP7",41,0)
 ;
"RTN","KMPDTP7",42,0)
 N DATA,DATA1,DATE,DATE1,DELTA,DOT,HOURS,HR,I,QUEUED,TIME
"RTN","KMPDTP7",43,0)
 ;
"RTN","KMPDTP7",44,0)
 S DOT=1,QUEUED=$D(ZTQUEUED),DATE=$$DT^XLFDT
"RTN","KMPDTP7",45,0)
 ; array with hours
"RTN","KMPDTP7",46,0)
 S HOURS=$$RLTMHR^KMPDTU11(1,0) Q:HOURS=""
"RTN","KMPDTP7",47,0)
 F I=1:1 Q:$P(HOURS,",",I)=""  S ^TMP($J,DATE,$P(HOURS,",",I))=""
"RTN","KMPDTP7",48,0)
 S I="",TOTAL=0
"RTN","KMPDTP7",49,0)
 F  S I=$O(^KMPTMP("KMPDT","ORWCV",I)) Q:I=""  S DATA=^(I) I DATA]"" D 
"RTN","KMPDTP7",50,0)
 .S DOT=DOT+1 W:'QUEUED&('(DOT#1000)) "."
"RTN","KMPDTP7",51,0)
 .; start/end date/time in fileman format
"RTN","KMPDTP7",52,0)
 .S DATE(1)=$$HTFM^XLFDT($P(DATA,U)),DATE(2)=$$HTFM^XLFDT($P(DATA,U,2))
"RTN","KMPDTP7",53,0)
 .Q:'DATE(1)!('DATE(2))
"RTN","KMPDTP7",54,0)
 .S DELTA=$$FMDIFF^XLFDT(DATE(2),DATE(1),2)
"RTN","KMPDTP7",55,0)
 .S:DELTA<0 DELTA=""
"RTN","KMPDTP7",56,0)
 .; determine hour
"RTN","KMPDTP7",57,0)
 .S HR=+$E($P(DATE(1),".",2),1,2) S:HR="" HR="0"
"RTN","KMPDTP7",58,0)
 .; quit if not in HOUR() array
"RTN","KMPDTP7",59,0)
 .;Q:'$D(HOUR(HR))
"RTN","KMPDTP7",60,0)
 .; hour & second
"RTN","KMPDTP7",61,0)
 .S TIME=$E($P(DATE(1),".",2),1,4) Q:'TIME
"RTN","KMPDTP7",62,0)
 .; insert colon (:) between hour & second
"RTN","KMPDTP7",63,0)
 .S TIME=$E(TIME,1,2)_":"_$E(TIME,3,4)
"RTN","KMPDTP7",64,0)
 .S:$P(TIME,":",2)="" $P(TIME,":",2)="00"
"RTN","KMPDTP7",65,0)
 .; date without time
"RTN","KMPDTP7",66,0)
 .S DATE1=$P(DATE(1),".") Q:'DATE1
"RTN","KMPDTP7",67,0)
 .S DATA1="^^^"_DELTA_"^"_$P(DATA,U,3)_"^"_$P(DATA,U,4)_"^^^"_$P($P(I," ",2),"-")
"RTN","KMPDTP7",68,0)
 .;
"RTN","KMPDTP7",69,0)
 .; if delta
"RTN","KMPDTP7",70,0)
 .I $P(DATA1,U,4)'="" D 
"RTN","KMPDTP7",71,0)
 ..; minimum delta
"RTN","KMPDTP7",72,0)
 ..I $P(^TMP($J,DATE,HR),U,2)=""!($P(DATA1,U,4)<$P(^TMP($J,DATE,HR),U,2)) D 
"RTN","KMPDTP7",73,0)
 ...S $P(^TMP($J,DATE,HR),U,2)=$P(DATA1,U,4)
"RTN","KMPDTP7",74,0)
 ..; maximum delta
"RTN","KMPDTP7",75,0)
 ..I $P(DATA1,U,4)>$P(^TMP($J,DATE,HR),U,3) S $P(^TMP($J,DATE,HR),U,3)=$P(DATA1,U,4)
"RTN","KMPDTP7",76,0)
 ..; total delta
"RTN","KMPDTP7",77,0)
 ..S $P(^TMP($J,DATE,HR),U,4)=$P(^TMP($J,DATE,HR),U,4)+$P(DATA1,U,4)
"RTN","KMPDTP7",78,0)
 ..; count
"RTN","KMPDTP7",79,0)
 ..S $P(^TMP($J,DATE,HR),U,5)=$P(^TMP($J,DATE,HR),U,5)+1
"RTN","KMPDTP7",80,0)
 .; if no delta
"RTN","KMPDTP7",81,0)
 .E  S $P(^TMP($J,DATE,HR),U,6)=$P(^TMP($J,DATE,HR),U,6)+1
"RTN","KMPDTP7",82,0)
 ;
"RTN","KMPDTP7",83,0)
 ; average
"RTN","KMPDTP7",84,0)
 F HR=1:1 S I=$P(HOURS,",",HR) Q:I=""  I $P(^TMP($J,DATE,I),U,5) D 
"RTN","KMPDTP7",85,0)
 .S $P(^TMP($J,DATE,I),U)=$P(^TMP($J,DATE,I),U,4)/$P(^TMP($J,DATE,I),U,5)
"RTN","KMPDTP7",86,0)
 ;
"RTN","KMPDTP7",87,0)
 Q
"RTN","KMPDTP7",88,0)
 ;
"RTN","KMPDTP7",89,0)
PRINT ;-- print data
"RTN","KMPDTP7",90,0)
 D HDR
"RTN","KMPDTP7",91,0)
 Q:'$D(^TMP($J))
"RTN","KMPDTP7",92,0)
 N CONT,DATE,HR,I,TOTAL
"RTN","KMPDTP7",93,0)
 S DATE="",CONT=1
"RTN","KMPDTP7",94,0)
 F  S DATE=$O(^TMP($J,DATE)) Q:'DATE  S HR="" D  Q:'CONT
"RTN","KMPDTP7",95,0)
 .S TOTAL=""
"RTN","KMPDTP7",96,0)
 .W !,$$FMTE^XLFDT(DATE,2)
"RTN","KMPDTP7",97,0)
 .F  S HR=$O(^TMP($J,DATE,HR)) Q:HR=""  D  Q:'CONT
"RTN","KMPDTP7",98,0)
 ..; page feed
"RTN","KMPDTP7",99,0)
 ..I $Y>(IOSL-3) D CONTINUE^KMPDUTL4("",1,.CONT) Q:'CONT  D HDR W !
"RTN","KMPDTP7",100,0)
 ..W ?12," ",$S($L(HR)=1:"0",1:""),HR
"RTN","KMPDTP7",101,0)
 ..S DATA=^TMP($J,DATE,HR)
"RTN","KMPDTP7",102,0)
 ..W ?20,$J($FN($P(DATA,U),",",0),10)
"RTN","KMPDTP7",103,0)
 ..W ?34,$J($FN($P(DATA,U,2),",",0),10)
"RTN","KMPDTP7",104,0)
 ..W ?48,$J($FN($P(DATA,U,3),",",0),10)
"RTN","KMPDTP7",105,0)
 ..W ?62,$J($FN($P(DATA,U,5),",",0),10)
"RTN","KMPDTP7",106,0)
 ..W !
"RTN","KMPDTP7",107,0)
 ..S $P(TOTAL,U)=$P(TOTAL,U)+$P(DATA,U,5)
"RTN","KMPDTP7",108,0)
 ..S $P(TOTAL,U,2)=$P(TOTAL,U,2)+$P(DATA,U,6)
"RTN","KMPDTP7",109,0)
 .;
"RTN","KMPDTP7",110,0)
 .; back to DATE level
"RTN","KMPDTP7",111,0)
 .; totals
"RTN","KMPDTP7",112,0)
 .W ?62,"----------",!?62,$J($FN(TOTAL,",",0),10),!
"RTN","KMPDTP7",113,0)
 .W !?12,"Incomplete: ",$J($FN($P(TOTAL,U,2),",",0),$L($P(TOTAL,U,2))+2),!
"RTN","KMPDTP7",114,0)
 .; if another date
"RTN","KMPDTP7",115,0)
 .I $O(^TMP($J,DATE)) D CONTINUE^KMPDUTL4("",1,.CONT) Q:'CONT  D HDR W !
"RTN","KMPDTP7",116,0)
 ;
"RTN","KMPDTP7",117,0)
 I CONT D 
"RTN","KMPDTP7",118,0)
 .; legend
"RTN","KMPDTP7",119,0)
 .W !!?2,"CV  = Coversheet",!?2,"TTL = Time-to-Load"
"RTN","KMPDTP7",120,0)
 .; pause if output to terminal
"RTN","KMPDTP7",121,0)
 .D CONTINUE^KMPDUTL4("Press RETURN to continue",1)
"RTN","KMPDTP7",122,0)
 ;
"RTN","KMPDTP7",123,0)
 Q
"RTN","KMPDTP7",124,0)
 ;
"RTN","KMPDTP7",125,0)
HDR ;-- print header
"RTN","KMPDTP7",126,0)
 W @IOF
"RTN","KMPDTP7",127,0)
 S X=$G(KMPDTTL)
"RTN","KMPDTP7",128,0)
 W !?(80-$L(X)\2),X
"RTN","KMPDTP7",129,0)
 S X=$$FMTE^XLFDT($$DT^XLFDT)
"RTN","KMPDTP7",130,0)
 W !?(80-$L(X)\2),X,?61,"Printed: ",$$FMTE^XLFDT(DT,2)
"RTN","KMPDTP7",131,0)
 W !
"RTN","KMPDTP7",132,0)
 W !?20,"|---------------Seconds---------------|"
"RTN","KMPDTP7",133,0)
 W !,"Date",?12,"Hour",?20,"TTL Average",?34,"TTL Minimum",?48,"TTL Maximum",?62,"# of CV Loads"
"RTN","KMPDTP7",134,0)
 W !,$$REPEAT^XLFSTR("-",IOM)
"RTN","KMPDTP7",135,0)
 ;
"RTN","KMPDTP7",136,0)
 Q
"RTN","KMPDTP7",137,0)
 ;
"RTN","KMPDTP7",138,0)
EXIT ;-- cleanup on exit
"RTN","KMPDTP7",139,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","KMPDTP7",140,0)
 D ^%ZISC
"RTN","KMPDTP7",141,0)
 K KMPDTTL
"RTN","KMPDTP7",142,0)
 Q
"RTN","KMPDTU02")
0^5^B8647823
"RTN","KMPDTU02",1,0)
KMPDTU02 ;OAK/RAK - CP Tools Compile & File Daily Timing Stats ;11/4/03  14:22
"RTN","KMPDTU02",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDTU02",3,0)
 ;
"RTN","KMPDTU02",4,0)
DAILY ;(KMPDST,KMPDEN);-entry point
"RTN","KMPDTU02",5,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU02",6,0)
 ; KMPDST... Start date in internal fileman format.
"RTN","KMPDTU02",7,0)
 ; KMPDEN... End date in internal fileman format.
"RTN","KMPDTU02",8,0)
 ;
"RTN","KMPDTU02",9,0)
 ; This API gathers Timing data from ^KMPTMP("KMPDT") and stores it in
"RTN","KMPDTU02",10,0)
 ; file 8973.2 (CP TIMING)
"RTN","KMPDTU02",11,0)
 ;
"RTN","KMPDTU02",12,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU02",13,0)
 ;
"RTN","KMPDTU02",14,0)
 ;Q:'$G(KMPDST)
"RTN","KMPDTU02",15,0)
 ;Q:'$G(KMPDEN)
"RTN","KMPDTU02",16,0)
 ; make sure end date has hours
"RTN","KMPDTU02",17,0)
 ;S:'$P(KMPDEN,".",2) $P(KMPDEN,".",2)="99"
"RTN","KMPDTU02",18,0)
 ;S:'$G(DT) DT=$$DT^XLFDT
"RTN","KMPDTU02",19,0)
 ;
"RTN","KMPDTU02",20,0)
 N STR
"RTN","KMPDTU02",21,0)
 ; start time for timing data
"RTN","KMPDTU02",22,0)
 S STR=$$NOW^XLFDT
"RTN","KMPDTU02",23,0)
 ;
"RTN","KMPDTU02",24,0)
 W:'$D(ZTQUEUED) !,"Compiling Timing data..."
"RTN","KMPDTU02",25,0)
 S STR=$$NOW^XLFDT
"RTN","KMPDTU02",26,0)
 D COMPILE
"RTN","KMPDTU02",27,0)
 D STRSTP^KMPDUTL2("TMG","DLY","TOTAL",STR)
"RTN","KMPDTU02",28,0)
 ;
"RTN","KMPDTU02",29,0)
 Q
"RTN","KMPDTU02",30,0)
 ;
"RTN","KMPDTU02",31,0)
COMPILE ;-- compile & file timing data
"RTN","KMPDTU02",32,0)
 ;
"RTN","KMPDTU02",33,0)
 Q:$O(^KMPTMP("KMPDT",""))=""
"RTN","KMPDTU02",34,0)
 N COUNT,DATA,DATA1,ID,OK,SBSCR,TODAY
"RTN","KMPDTU02",35,0)
 S TODAY=$P($H,",") Q:'TODAY
"RTN","KMPDTU02",36,0)
 S SBSCR="",COUNT=0
"RTN","KMPDTU02",37,0)
 F  S SBSCR=$O(^KMPTMP("KMPDT",SBSCR)) Q:SBSCR=""  S ID="" D 
"RTN","KMPDTU02",38,0)
 .F  S ID=$O(^KMPTMP("KMPDT",SBSCR,ID)) Q:ID=""  S DATA=^(ID) D 
"RTN","KMPDTU02",39,0)
 ..; quit if not 'previous' to DT
"RTN","KMPDTU02",40,0)
 ..Q:$P($P(DATA,U),".")'<TODAY
"RTN","KMPDTU02",41,0)
 ..; set up DATA1 for filing
"RTN","KMPDTU02",42,0)
 ..; identifier
"RTN","KMPDTU02",43,0)
 ..S $P(DATA1,U)=ID
"RTN","KMPDTU02",44,0)
 ..; server start date/time in internal fileman format
"RTN","KMPDTU02",45,0)
 ..S $P(DATA1,U,3)=$$HTFM^XLFDT($P(DATA,U))
"RTN","KMPDTU02",46,0)
 ..; server delta
"RTN","KMPDTU02",47,0)
 ..S:$P(DATA,U,2) $P(DATA1,U,4)=$$HDIFF^XLFDT($P(DATA,U,2),$P(DATA,U),2)
"RTN","KMPDTU02",48,0)
 ..; person
"RTN","KMPDTU02",49,0)
 ..S $P(DATA1,U,5)=$P(DATA,U,3)
"RTN","KMPDTU02",50,0)
 ..; client name
"RTN","KMPDTU02",51,0)
 ..S $P(DATA1,U,6)=$P(DATA,U,4)
"RTN","KMPDTU02",52,0)
 ..; kmptmp subscript
"RTN","KMPDTU02",53,0)
 ..S $P(DATA1,U,7)=SBSCR
"RTN","KMPDTU02",54,0)
 ..; title
"RTN","KMPDTU02",55,0)
 ..S $P(DATA1,U,8)=$$TITLEG(SBSCR)
"RTN","KMPDTU02",56,0)
 ..; ip address
"RTN","KMPDTU02",57,0)
 ..S $P(DATA1,U,9)=$P($P(ID,"-")," ",2)
"RTN","KMPDTU02",58,0)
 ..; file data
"RTN","KMPDTU02",59,0)
 ..D FILE(DATA1,.OK)
"RTN","KMPDTU02",60,0)
 ..; update counter if successfully filed
"RTN","KMPDTU02",61,0)
 ..S:OK COUNT=COUNT+1
"RTN","KMPDTU02",62,0)
 ..; kill of old node if successfully filed
"RTN","KMPDTU02",63,0)
 ..K:OK ^KMPTMP("KMPDT",SBSCR,ID)
"RTN","KMPDTU02",64,0)
 ..I '$D(ZTQUEUED) W:'(COUNT#100) "."
"RTN","KMPDTU02",65,0)
 ;
"RTN","KMPDTU02",66,0)
 W:'$D(ZTQUEUED) !,COUNT," records filed!"
"RTN","KMPDTU02",67,0)
 ;
"RTN","KMPDTU02",68,0)
 Q
"RTN","KMPDTU02",69,0)
 ;
"RTN","KMPDTU02",70,0)
FILE(DATA,KMPDOK) ;-- file timing data into file #8973.2
"RTN","KMPDTU02",71,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU02",72,0)
 ; DATA.... Data to file in format:
"RTN","KMPDTU02",73,0)
 ;          piece "^" 1 - id
"RTN","KMPDTU02",74,0)
 ;                    3 - start date/time in internal fileman format
"RTN","KMPDTU02",75,0)
 ;                    4 - delta
"RTN","KMPDTU02",76,0)
 ;                    5 - new person
"RTN","KMPDTU02",77,0)
 ;                    6 - client name
"RTN","KMPDTU02",78,0)
 ;                    7 - kmptmp subscript
"RTN","KMPDTU02",79,0)
 ;                    8 - title
"RTN","KMPDTU02",80,0)
 ;                    9 - ip address
"RTN","KMPDTU02",81,0)
 ;
"RTN","KMPDTU02",82,0)
 ; KMPDOK.. Returned
"RTN","KMPDTU02",83,0)
 ;            0 - not filed successfully
"RTN","KMPDTU02",84,0)
 ;            1 - filed successfully
"RTN","KMPDTU02",85,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU02",86,0)
 ;
"RTN","KMPDTU02",87,0)
 S KMPDOK=0
"RTN","KMPDTU02",88,0)
 Q:$G(DATA)=""
"RTN","KMPDTU02",89,0)
 ; id
"RTN","KMPDTU02",90,0)
 Q:$P(DATA,U)=""
"RTN","KMPDTU02",91,0)
 ; start date/time
"RTN","KMPDTU02",92,0)
 Q:$P(DATA,U,3)=""
"RTN","KMPDTU02",93,0)
 ;
"RTN","KMPDTU02",94,0)
 N ERROR,FDA,I,IEN,ZIEN
"RTN","KMPDTU02",95,0)
 ; build fda() array for filing
"RTN","KMPDTU02",96,0)
 F I=1:1:9 I $P(DATA,U,I)'="" D 
"RTN","KMPDTU02",97,0)
 .S FDA($J,8973.2,"+1,",(I*.01))=$P(DATA,U,I)
"RTN","KMPDTU02",98,0)
 ; quit if no fda() array
"RTN","KMPDTU02",99,0)
 Q:'$D(FDA($J))
"RTN","KMPDTU02",100,0)
 ; file data
"RTN","KMPDTU02",101,0)
 D UPDATE^DIE("","FDA($J)","ZIEN","ERROR")
"RTN","KMPDTU02",102,0)
 ; if error
"RTN","KMPDTU02",103,0)
 I $D(ERROR) D MSG^DIALOG("HA",.ERROR,60,5,"ERROR") Q
"RTN","KMPDTU02",104,0)
 S KMPDOK=1
"RTN","KMPDTU02",105,0)
 ;
"RTN","KMPDTU02",106,0)
 Q
"RTN","KMPDTU02",107,0)
 ;
"RTN","KMPDTU02",108,0)
TITLEG(SBSCR) ;-- extrinsic function - return title name
"RTN","KMPDTU02",109,0)
 Q:$G(SBSCR)="" ""
"RTN","KMPDTU02",110,0)
 N I,TITLE,X S TITLE=""
"RTN","KMPDTU02",111,0)
 F I=1:1 S X=$T(TITLE+I) Q:X=""  I $P(X,";",3)=SBSCR S TITLE=$P(X,";",4) Q
"RTN","KMPDTU02",112,0)
 Q TITLE
"RTN","KMPDTU02",113,0)
 ;
"RTN","KMPDTU02",114,0)
TITLE ;-- convert subscript to title
"RTN","KMPDTU02",115,0)
 ;;ORWCV;CPRS Cover Sheet
"RTN","KMPDTU10")
0^12^B33878359
"RTN","KMPDTU10",1,0)
KMPDTU10 ;OAK/RAK - CP Tools Timing Utility ;11/4/03  14:23
"RTN","KMPDTU10",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDTU10",3,0)
 ;
"RTN","KMPDTU10",4,0)
DATERNG(KMPDSS,KMPDEF,KMPDRES,KMPDDT) ; timing date range for a subscript
"RTN","KMPDTU10",5,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",6,0)
 ; KMPDSS.... KMPTMP SUBSCRIPT
"RTN","KMPDTU10",7,0)
 ; KMPDEF.... (optional) default number of days to track - if not defined
"RTN","KMPDTU10",8,0)
 ;            will default to seven (7)
"RTN","KMPDTU10",9,0)
 ; KMPDRES(). Results of api in format:
"RTN","KMPDTU10",10,0)
 ;             KMPDRES(0)=piece 1 - Start Date Internal
"RTN","KMPDTU10",11,0)
 ;                        piece 2 - End Date Internal
"RTN","KMPDTU10",12,0)
 ;                        piece 3 - Start Date External
"RTN","KMPDTU10",13,0)
 ;                        piece 4 - End Date External
"RTN","KMPDTU10",14,0)
 ;                 Null ("") is returned if no results are found
"RTN","KMPDTU10",15,0)
 ;             KMPDRES(1)=NumberOfDays
"RTN","KMPDTU10",16,0)
 ; KMPDDT.... Date only (do not ask for days)
"RTN","KMPDTU10",17,0)
 ;             0 - both date & days
"RTN","KMPDTU10",18,0)
 ;             1 - date only - do not ask for days
"RTN","KMPDTU10",19,0)
 ;
"RTN","KMPDTU10",20,0)
 ; This api determines the date range for KMPDSS (ex: ORWCV for CPRS 
"RTN","KMPDTU10",21,0)
 ; cover sheets).  It asks the user the ending date.  After the ending
"RTN","KMPDTU10",22,0)
 ; date is entered, the user is prompted for the number of days to track.
"RTN","KMPDTU10",23,0)
 ; Results are returned in the KMPDRES() array as described above.
"RTN","KMPDTU10",24,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",25,0)
 K KMPDRES S KMPDRES(0)="",KMPDRES(1)=""
"RTN","KMPDTU10",26,0)
 Q:$G(KMPDSS)=""
"RTN","KMPDTU10",27,0)
 S:'$G(KMPDEF) KMPDEF=7
"RTN","KMPDTU10",28,0)
 S KMPDDT=+$G(KMPDDT)
"RTN","KMPDTU10",29,0)
 N COUNT,DATE,DAYS,END,SESS,START
"RTN","KMPDTU10",30,0)
 ; start & end dates
"RTN","KMPDTU10",31,0)
 S DATE=$$DATERNG1(KMPDSS,.SESS)
"RTN","KMPDTU10",32,0)
 Q:'$D(SESS)
"RTN","KMPDTU10",33,0)
 S START=$P(DATE,U),END=$P(DATE,U,2)
"RTN","KMPDTU10",34,0)
 Q:'START!('END)
"RTN","KMPDTU10",35,0)
 ; get end date
"RTN","KMPDTU10",36,0)
 K DIR S DIR(0)="DO^"_START_":"_END_":E"
"RTN","KMPDTU10",37,0)
 S DIR("A")="Select End Date",DIR("B")=$$FMTE^XLFDT(END)
"RTN","KMPDTU10",38,0)
 W ! D ^DIR Q:'Y  S END=Y
"RTN","KMPDTU10",39,0)
 ; if date only
"RTN","KMPDTU10",40,0)
 I KMPDDT D  Q
"RTN","KMPDTU10",41,0)
 .S KMPDRES(0)=END_U_END_U_$$FMTE^XLFDT(END)_U_$$FMTE^XLFDT(END)
"RTN","KMPDTU10",42,0)
 ; determine number of days
"RTN","KMPDTU10",43,0)
 S DATE=END+.1,START=END,DAYS=0
"RTN","KMPDTU10",44,0)
 F  S DATE=$O(SESS(DATE),-1) Q:'DATE   S START=DATE,DAYS=DAYS+1
"RTN","KMPDTU10",45,0)
 Q:'DAYS
"RTN","KMPDTU10",46,0)
 ; days to go back
"RTN","KMPDTU10",47,0)
 K DIR S DIR(0)="NO^1:"_DAYS_":O"
"RTN","KMPDTU10",48,0)
 S DIR("A")="Select # of Days Review"
"RTN","KMPDTU10",49,0)
 S DIR("B")=$S(DAYS'<KMPDEF:KMPDEF,1:DAYS)
"RTN","KMPDTU10",50,0)
 D ^DIR Q:Y=""!(Y="^")
"RTN","KMPDTU10",51,0)
 ; determine start date
"RTN","KMPDTU10",52,0)
 S START=END
"RTN","KMPDTU10",53,0)
 I Y'=1 S COUNT=1 D 
"RTN","KMPDTU10",54,0)
 .F  S START=$O(SESS(START),-1) Q:'START  S COUNT=COUNT+1 Q:COUNT'<Y
"RTN","KMPDTU10",55,0)
 S KMPDRES(0)=START_U_END_U_$$FMTE^XLFDT(START)_U_$$FMTE^XLFDT(END)
"RTN","KMPDTU10",56,0)
 S KMPDRES(1)=Y
"RTN","KMPDTU10",57,0)
 ;
"RTN","KMPDTU10",58,0)
 Q
"RTN","KMPDTU10",59,0)
 ;
"RTN","KMPDTU10",60,0)
DATERNG1(KMPDSS,KMPDSESS) ;-- extrinsic function
"RTN","KMPDTU10",61,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",62,0)
 ; KMPDSS.... KMPTMP SUBSCRIPT
"RTN","KMPDTU10",63,0)
 ; KMPDSESS() Array of dates: 
"RTN","KMPDTU10",64,0)
 ;             KMPDSESS(3030801)=""
"RTN","KMPDTU10",65,0)
 ;             KMPDSESS(3030802)=""
"RTN","KMPDTU10",66,0)
 ;             ...
"RTN","KMPDTU10",67,0)
 ;
"RTN","KMPDTU10",68,0)
 ; Return: StartDate^EndDate - in internal fileman format
"RTN","KMPDTU10",69,0)
 ;         "" - no results
"RTN","KMPDTU10",70,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",71,0)
 Q:$G(KMPDSS)="" ""
"RTN","KMPDTU10",72,0)
 N DATE,END,START
"RTN","KMPDTU10",73,0)
 ; determine most recent date
"RTN","KMPDTU10",74,0)
 F DATE=0:0 S DATE=$O(^KMPD(8973.2,"ASVDTSS",KMPDSS,DATE)) Q:'DATE  D 
"RTN","KMPDTU10",75,0)
 .; set array of session dates
"RTN","KMPDTU10",76,0)
 .S KMPDSESS(DATE)=""
"RTN","KMPDTU10",77,0)
 Q:'$D(KMPDSESS) ""
"RTN","KMPDTU10",78,0)
 ; set start and end dates according to SESS() array
"RTN","KMPDTU10",79,0)
 S END=$O(KMPDSESS("A"),-1),START=$O(KMPDSESS(""))
"RTN","KMPDTU10",80,0)
 Q START_"^"_END
"RTN","KMPDTU10",81,0)
 ;
"RTN","KMPDTU10",82,0)
DTTMRNG(KMPDSS,KMPDEF,KMPDRES,KMPDEFH) ; timing date/time range for a subscript
"RTN","KMPDTU10",83,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",84,0)
 ; KMPDSS.... KMPTMP SUBSCRIPT
"RTN","KMPDTU10",85,0)
 ; KMPDEF.... (optional) default number of days to track - if not defined
"RTN","KMPDTU10",86,0)
 ;            will default to seven (7)
"RTN","KMPDTU10",87,0)
 ; KMPDRES(). Results of api in format:
"RTN","KMPDTU10",88,0)
 ;             KMPDRES(0)=piece 1 - Start Date Internal
"RTN","KMPDTU10",89,0)
 ;                        piece 2 - End Date Internal
"RTN","KMPDTU10",90,0)
 ;                        piece 3 - Start Date External
"RTN","KMPDTU10",91,0)
 ;                        piece 4 - End Date External
"RTN","KMPDTU10",92,0)
 ;                 Null ("") is returned if no results are found
"RTN","KMPDTU10",93,0)
 ;             KMPDRES(1)=NumberOfDays
"RTN","KMPDTU10",94,0)
 ; KMPDEFH.. (optional) Default hour.
"RTN","KMPDTU10",95,0)
 ;
"RTN","KMPDTU10",96,0)
 ; This api determines the date range for KMPDSS (ex: ORWCV for CPRS 
"RTN","KMPDTU10",97,0)
 ; cover sheets).  It asks the user the ending date.  After the ending
"RTN","KMPDTU10",98,0)
 ; date is entered, the user is prompted for the number of hours to
"RTN","KMPDTU10",99,0)
 ; review. Results are returned in the KMPDRES() array as described 
"RTN","KMPDTU10",100,0)
 ; above.
"RTN","KMPDTU10",101,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",102,0)
 K KMPDRES S KMPDRES(0)="",KMPDRES(1)=""
"RTN","KMPDTU10",103,0)
 Q:$G(KMPDSS)=""
"RTN","KMPDTU10",104,0)
 S:'$G(KMPDEF) KMPDEF=7
"RTN","KMPDTU10",105,0)
 S KMPDEFH=$G(KMPDEFH)
"RTN","KMPDTU10",106,0)
 N COUNT,DATE,DAYS,END,SESS,START
"RTN","KMPDTU10",107,0)
 ; get date
"RTN","KMPDTU10",108,0)
 D DATERNG(KMPDSS,1,.KMPDRES,1)
"RTN","KMPDTU10",109,0)
 Q:'$D(KMPDRES)
"RTN","KMPDTU10",110,0)
 Q:$G(KMPDRES(0))=""
"RTN","KMPDTU10",111,0)
 S KMPDRES(1)=""
"RTN","KMPDTU10",112,0)
 ; determine number of hours
"RTN","KMPDTU10",113,0)
 K DIR S DIR(0)="LO^0:23:O"
"RTN","KMPDTU10",114,0)
 S DIR("A")="Select Hour(s) to Review"
"RTN","KMPDTU10",115,0)
 S:KMPDEFH'="" DIR("B")=KMPDEFH
"RTN","KMPDTU10",116,0)
 D ^DIR Q:Y=""!(Y="^")
"RTN","KMPDTU10",117,0)
 S KMPDRES(1)=Y
"RTN","KMPDTU10",118,0)
 Q
"RTN","KMPDTU10",119,0)
 ;
"RTN","KMPDTU10",120,0)
LISTSEL(KMPDLIST,KMPDSS,KMPDRLTM) ;-- extrinsic function - build list and select entry
"RTN","KMPDTU10",121,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",122,0)
 ; KMPDLIST... 2 - Client Name
"RTN","KMPDTU10",123,0)
 ;             3 - IP Address
"RTN","KMPDTU10",124,0)
 ; KMPDSS..... Field #.07 (KMPTMP SUBSCRIPT)
"RTN","KMPDTU10",125,0)
 ; KMPDRLTM... Real-Time data
"RTN","KMPDTU10",126,0)
 ;              0 - not real-time
"RTN","KMPDTU10",127,0)
 ;              1 - real-time
"RTN","KMPDTU10",128,0)
 ;
"RTN","KMPDTU10",129,0)
 ; Return: "" - no selection 
"RTN","KMPDTU10",130,0)
 ;         Name - free text
"RTN","KMPDTU10",131,0)
 ;
"RTN","KMPDTU10",132,0)
 ; This function will build a list of entries from file #8973.2 
"RTN","KMPDTU10",133,0)
 ;(CP TIMING) and ask the user to select an entry.
"RTN","KMPDTU10",134,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",135,0)
 S KMPDLIST=+$G(KMPDLIST)
"RTN","KMPDTU10",136,0)
 Q:KMPDLIST<2!(KMPDLIST>3) ""
"RTN","KMPDTU10",137,0)
 Q:$G(KMPDSS)="" ""
"RTN","KMPDTU10",138,0)
 S KMPDRLTM=+$G(KMPDRLTM)
"RTN","KMPDTU10",139,0)
 ;
"RTN","KMPDTU10",140,0)
 N DIC,I,X,XREF,Y
"RTN","KMPDTU10",141,0)
 ;
"RTN","KMPDTU10",142,0)
 W " ==> building list..."
"RTN","KMPDTU10",143,0)
 K ^TMP("KMPDTU10-LIST",$J)
"RTN","KMPDTU10",144,0)
 D @$S('KMPDRLTM:"LISTSELH",1:"LISTSELR")
"RTN","KMPDTU10",145,0)
 ; quit if no data
"RTN","KMPDTU10",146,0)
 Q:'$D(^TMP("KMPDTU10-LIST",$J))
"RTN","KMPDTU10",147,0)
 S DIC="^TMP(""KMPDTU10-LIST"",$J,"
"RTN","KMPDTU10",148,0)
 S DIC(0)="AEQZ"
"RTN","KMPDTU10",149,0)
 S DIC("A")=$S(KMPDLIST=2:"Select Client",1:"IP Address")_": "
"RTN","KMPDTU10",150,0)
 D ^DIC
"RTN","KMPDTU10",151,0)
 K ^TMP("KMPDTU10-LIST",$J)
"RTN","KMPDTU10",152,0)
 Q $S(Y<1:"",1:$P(Y,"^",2))
"RTN","KMPDTU10",153,0)
 ;
"RTN","KMPDTU10",154,0)
LISTSELH ;-- historical data list
"RTN","KMPDTU10",155,0)
 N I,CNT,DOT,XREF
"RTN","KMPDTU10",156,0)
 ; determine xref to build list
"RTN","KMPDTU10",157,0)
 S XREF=$S(KMPDLIST=2:"ASSCLDTTM",KMPDLIST=3:"ASSIPDTTM",1:"")
"RTN","KMPDTU10",158,0)
 Q:XREF="" ""
"RTN","KMPDTU10",159,0)
 S I="",(CNT,DOT)=0
"RTN","KMPDTU10",160,0)
 F  S I=$O(^KMPD(8973.2,XREF,KMPDSS,I)) Q:I=""  D 
"RTN","KMPDTU10",161,0)
 .S CNT=CNT+1,DOT=DOT+1 W:'(DOT#100) "."
"RTN","KMPDTU10",162,0)
 .S ^TMP("KMPDTU10-LIST",$J,CNT,0)=I
"RTN","KMPDTU10",163,0)
 .S ^TMP("KMPDTU10-LIST",$J,"B",I,CNT)=""
"RTN","KMPDTU10",164,0)
 Q:'CNT ""
"RTN","KMPDTU10",165,0)
 S ^TMP("KMPDTU10-LIST",$J,0)=$S(KMPDLIST=2:"Client Name",1:"IP Address")_"^1.01^"_CNT_"^"_CNT
"RTN","KMPDTU10",166,0)
 Q
"RTN","KMPDTU10",167,0)
 ;
"RTN","KMPDTU10",168,0)
LISTSELR ;-- real-time data list
"RTN","KMPDTU10",169,0)
 N I,CNT,DATA,DOT,X
"RTN","KMPDTU10",170,0)
 S I="",(CNT,DOT)=0
"RTN","KMPDTU10",171,0)
 F  S I=$O(^KMPTMP("KMPDT",KMPDSS,I)) Q:I=""  S DATA=^(I) I DATA]"" D 
"RTN","KMPDTU10",172,0)
 .S X=$S(KMPDLIST=2:$P(DATA,U,4),1:$P($P(I," ",2),"-"))
"RTN","KMPDTU10",173,0)
 .Q:X=""
"RTN","KMPDTU10",174,0)
 .Q:$O(^TMP("KMPDTU10-LIST",$J,"B",X,0))
"RTN","KMPDTU10",175,0)
 .S CNT=CNT+1,DOT=DOT+1 W:'(DOT#100) "."
"RTN","KMPDTU10",176,0)
 .S ^TMP("KMPDTU10-LIST",$J,CNT,0)=X
"RTN","KMPDTU10",177,0)
 .S ^TMP("KMPDTU10-LIST",$J,"B",X,CNT)=""
"RTN","KMPDTU10",178,0)
 Q:'CNT ""
"RTN","KMPDTU10",179,0)
 S ^TMP("KMPDTU10-LIST",$J,0)=$S(KMPDLIST=2:"Client Name",1:"IP Address")_"^1.01^"_CNT_"^"_CNT
"RTN","KMPDTU10",180,0)
 Q
"RTN","KMPDTU10",181,0)
 ;
"RTN","KMPDTU10",182,0)
SRCHBY(KMPDRES,KMPDSS,KMPDRLTM) ;-- api - search by criteria
"RTN","KMPDTU10",183,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",184,0)
 ; KMPDRES().. Array (passed by reference) containing results in format:
"RTN","KMPDTU10",185,0)
 ;             KMPDRES    = "" - no valid selection
"RTN","KMPDTU10",186,0)
 ;             KMPDRES    = 1^User Name
"RTN","KMPDTU10",187,0)
 ;             KMPDRES(1) = DUZ^NewPersonName
"RTN","KMPDTU10",188,0)
 ;             KMPDRES    = 2^Client Name
"RTN","KMPDTU10",189,0)
 ;             KMPDRES(1) = ClientName (free text)
"RTN","KMPDTU10",190,0)
 ;             KMPDRES    = 3^IP Address
"RTN","KMPDTU10",191,0)
 ;             KMPDRES(1) = IPAddress
"RTN","KMPDTU10",192,0)
 ;             KMPDRES    = 4^Any Occurrence
"RTN","KMPDTU10",193,0)
 ; KMPDSS..... KMPTMP SUBSCIPT - field #.07 from file #8973.2 (CP TIMING)
"RTN","KMPDTU10",194,0)
 ; KMPDRLTM... Real-Time data
"RTN","KMPDTU10",195,0)
 ;              0 - not real-time
"RTN","KMPDTU10",196,0)
 ;              1 - real-time
"RTN","KMPDTU10",197,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",198,0)
 K KMPDRES S KMPDRES=""
"RTN","KMPDTU10",199,0)
 Q:$G(KMPDSS)=""
"RTN","KMPDTU10",200,0)
 S KMPDRLTM=+$G(KMPDRLTM)
"RTN","KMPDTU10",201,0)
 N DIC,DIR,X,Y
"RTN","KMPDTU10",202,0)
 S DIR(0)="SO^1:User Name;2:Client Name;3:IP Address;4:Any Occurrence"
"RTN","KMPDTU10",203,0)
 S DIR("A")="Search By"
"RTN","KMPDTU10",204,0)
 S DIR("B")=4
"RTN","KMPDTU10",205,0)
 D ^DIR
"RTN","KMPDTU10",206,0)
 Q:'Y
"RTN","KMPDTU10",207,0)
 S KMPDRES=Y_"^"_Y(0)
"RTN","KMPDTU10",208,0)
 ; quit if 'any occurrence'
"RTN","KMPDTU10",209,0)
 Q:(+KMPDRES)=4
"RTN","KMPDTU10",210,0)
 ;
"RTN","KMPDTU10",211,0)
 ; user name
"RTN","KMPDTU10",212,0)
 I (+KMPDRES)=1 D  Q
"RTN","KMPDTU10",213,0)
 .S DIC=200,DIC(0)="AEMQZ",DIC("A")="Select User: "
"RTN","KMPDTU10",214,0)
 .D ^DIC
"RTN","KMPDTU10",215,0)
 .I Y<1 S KMPDRES="" Q
"RTN","KMPDTU10",216,0)
 .S KMPDRES(1)=Y
"RTN","KMPDTU10",217,0)
 ;
"RTN","KMPDTU10",218,0)
 ; client name
"RTN","KMPDTU10",219,0)
 I (+KMPDRES)=2 D  Q
"RTN","KMPDTU10",220,0)
 .S KMPDRES(1)=$$LISTSEL(+KMPDRES,KMPDSS,KMPDRLTM)
"RTN","KMPDTU10",221,0)
 .S:KMPDRES(1)="" KMPDRES=""
"RTN","KMPDTU10",222,0)
 ;
"RTN","KMPDTU10",223,0)
 ; ip address
"RTN","KMPDTU10",224,0)
 I (+KMPDRES)=3 D  Q
"RTN","KMPDTU10",225,0)
 .S KMPDRES(1)=$$LISTSEL(+KMPDRES,KMPDSS,KMPDRLTM)
"RTN","KMPDTU10",226,0)
 .S:KMPDRES(1)="" KMPDRES=""
"RTN","KMPDTU10",227,0)
 ;
"RTN","KMPDTU10",228,0)
 Q
"RTN","KMPDTU10",229,0)
 ;
"RTN","KMPDTU10",230,0)
TTLSEC() ;-- extrinsic function - time-to-load threshold seconds
"RTN","KMPDTU10",231,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",232,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU10",233,0)
 N DIR,X,Y
"RTN","KMPDTU10",234,0)
 S DIR(0)="NAO^1"
"RTN","KMPDTU10",235,0)
 S DIR("A")="Select Time-To-Load Threshold (Seconds): "
"RTN","KMPDTU10",236,0)
 S DIR("B")=60
"RTN","KMPDTU10",237,0)
 D ^DIR
"RTN","KMPDTU10",238,0)
 Q $S(Y:Y,1:"")
"RTN","KMPDTU11")
0^19^B1921419
"RTN","KMPDTU11",1,0)
KMPDTU11 ;OAK/RAK - CP Tools Timing Utility ;11/4/03  14:23
"RTN","KMPDTU11",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDTU11",3,0)
 ;
"RTN","KMPDTU11",4,0)
RLTMHR(KMPDQIET,KMPDASK) ;-- extrinsic function - real time hours
"RTN","KMPDTU11",5,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU11",6,0)
 ; KMPDQIET... Display output
"RTN","KMPDTU11",7,0)
 ;              0 - display output (not quiet)
"RTN","KMPDTU11",8,0)
 ;              1 - do not display output (quiet)
"RTN","KMPDTU11",9,0)
 ; KMPDASK.... Ask user to select hours
"RTN","KMPDTU11",10,0)
 ;              0 - do not ask user to select
"RTN","KMPDTU11",11,0)
 ;              1 - ask user to select
"RTN","KMPDTU11",12,0)
 ;
"RTN","KMPDTU11",13,0)
 ; Return: List of hours (ie, 1,2,5,6,7...)
"RTN","KMPDTU11",14,0)
 ;         "" - no selection made
"RTN","KMPDTU11",15,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDTU11",16,0)
 ;
"RTN","KMPDTU11",17,0)
 S KMPDQIET=+$G(KMPDQIET),KMPDASK=+$G(KMPDASK)
"RTN","KMPDTU11",18,0)
 N DATA,DIR,DOT,HOURS,HR,I,QUEUED,X,Y
"RTN","KMPDTU11",19,0)
 W:'KMPDQIET !," ==> building Hours list..."
"RTN","KMPDTU11",20,0)
 S I="",DOT=0
"RTN","KMPDTU11",21,0)
 F  S I=$O(^KMPTMP("KMPDT","ORWCV",I)) Q:I=""  S DATA=^(I) I DATA]"" D 
"RTN","KMPDTU11",22,0)
 .S DOT=DOT+1 W:'(DOT#1000)&('KMPDQIET) "."
"RTN","KMPDTU11",23,0)
 .; change $h to fileman format and get hour
"RTN","KMPDTU11",24,0)
 .S HR=$E($P($$HTFM^XLFDT($P(DATA,U)),".",2),1,2) S:HR>23 HR="0"
"RTN","KMPDTU11",25,0)
 .; create HOURS() array
"RTN","KMPDTU11",26,0)
 .S:HR'="" HOURS(+HR)=""
"RTN","KMPDTU11",27,0)
 ;
"RTN","KMPDTU11",28,0)
 ; if no HOURS() array
"RTN","KMPDTU11",29,0)
 Q:'$D(HOURS) ""
"RTN","KMPDTU11",30,0)
 ;
"RTN","KMPDTU11",31,0)
 ; do not ask user to select hours
"RTN","KMPDTU11",32,0)
 I 'KMPDASK D  Q X
"RTN","KMPDTU11",33,0)
 .S (I,X)="" F  S I=$O(HOURS(I)) Q:I=""  S X=X_I_","
"RTN","KMPDTU11",34,0)
 ;
"RTN","KMPDTU11",35,0)
 ; ask user to select hour(s)
"RTN","KMPDTU11",36,0)
 S DIR(0)="LO^"_$O(HOURS(""))_":"_$O(HOURS("A"),-1)
"RTN","KMPDTU11",37,0)
 S DIR("A")="Select Hour(s)"
"RTN","KMPDTU11",38,0)
 W ! D ^DIR
"RTN","KMPDTU11",39,0)
 Q $S(Y=""!(Y="^"):"",1:$G(Y(0)))
"RTN","KMPDUT2")
0^13^B29018158
"RTN","KMPDUT2",1,0)
KMPDUT2 ;OAK/RAK - CM Tools Utility ;11/4/03  14:23
"RTN","KMPDUT2",2,0)
 ;;1.0;CM TOOLS;**1,2**;Mar 22, 2002
"RTN","KMPDUT2",3,0)
 ;
"RTN","KMPDUT2",4,0)
ID(KMPDIEN) ;--called from ^DD(8973.1,0,"ID","W")
"RTN","KMPDUT2",5,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",6,0)
 ; KMPDIEN... Ien for file #8973.1 (CM HL7 DATA)
"RTN","KMPDUT2",7,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",8,0)
 Q:'$G(KMPDIEN)
"RTN","KMPDUT2",9,0)
 Q:'$D(^KMPD(8973.1,+KMPDIEN,0))
"RTN","KMPDUT2",10,0)
 N DATA,TXT
"RTN","KMPDUT2",11,0)
 S DATA=$G(^KMPD(8973.1,+KMPDIEN,0)),DATA(99.2)=$G(^(99.2)) Q:DATA=""
"RTN","KMPDUT2",12,0)
 ; sent to national database
"RTN","KMPDUT2",13,0)
 S TXT(1)=$S($P(DATA,U,2):"sent",1:"not sent")
"RTN","KMPDUT2",14,0)
 S TXT(1)=TXT(1)_$J(" ",11-$L(TXT(1)))
"RTN","KMPDUT2",15,0)
 ; namespace
"RTN","KMPDUT2",16,0)
 S TXT(1)=TXT(1)_$P(DATA,U,3)
"RTN","KMPDUT2",17,0)
 S TXT(1)=TXT(1)_$J(" ",18-$L(TXT(1)))
"RTN","KMPDUT2",18,0)
 ; protocol
"RTN","KMPDUT2",19,0)
 S TXT(1)=TXT(1)_$P(DATA,U,5)
"RTN","KMPDUT2",20,0)
 S TXT(1)=TXT(1)_$J(" ",52-$L(TXT(1)))
"RTN","KMPDUT2",21,0)
 ; synch/asynch
"RTN","KMPDUT2",22,0)
 S TXT(1)=TXT(1)_$S($P(DATA,U,6)=1:"sync",1:"async")
"RTN","KMPDUT2",23,0)
 ; other site number
"RTN","KMPDUT2",24,0)
 I $P(DATA(99.2),U,12)'="" D 
"RTN","KMPDUT2",25,0)
 .S TXT(2)=$P(DATA(99.2),U,12)
"RTN","KMPDUT2",26,0)
 .S TXT(2,"F")="!?41"
"RTN","KMPDUT2",27,0)
 S TXT(1,"F")="?15"
"RTN","KMPDUT2",28,0)
 D EN^DDIOL(.TXT)
"RTN","KMPDUT2",29,0)
 Q
"RTN","KMPDUT2",30,0)
 ;
"RTN","KMPDUT2",31,0)
ID1(KMPDIEN) ;--called from ^DD(8973.2,0,"ID","W")
"RTN","KMPDUT2",32,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",33,0)
 ; KMPDIEN... Ien for file #8973.2 (CM TIMING)
"RTN","KMPDUT2",34,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",35,0)
 Q:'$G(KMPDIEN)
"RTN","KMPDUT2",36,0)
 Q:'$D(^KMPD(8973.2,+KMPDIEN,0))
"RTN","KMPDUT2",37,0)
 N DATA,TXT
"RTN","KMPDUT2",38,0)
 S DATA=$G(^KMPD(8973.2,+KMPDIEN,0)) Q:DATA=""
"RTN","KMPDUT2",39,0)
 S TXT(1)=""
"RTN","KMPDUT2",40,0)
 ; sent to national database
"RTN","KMPDUT2",41,0)
 ;S TXT(1)=$S($P(DATA,U,2):"sent",1:"not sent")
"RTN","KMPDUT2",42,0)
 ;S TXT(1)=TXT(1)_$J(" ",11-$L(TXT(1)))
"RTN","KMPDUT2",43,0)
 ; date/time
"RTN","KMPDUT2",44,0)
 S TXT(1)=TXT(1)_$$FMTE^XLFDT($P(DATA,U,3),2)
"RTN","KMPDUT2",45,0)
 S TXT(1)=TXT(1)_$J(" ",18-$L(TXT(1)))
"RTN","KMPDUT2",46,0)
 ; title
"RTN","KMPDUT2",47,0)
 S TXT(1)=TXT(1)_$E($P(DATA,U,8),1,16)
"RTN","KMPDUT2",48,0)
 ; client name
"RTN","KMPDUT2",49,0)
 S TXT(2)=$E($P(DATA,U,6),1,30)
"RTN","KMPDUT2",50,0)
 ; person
"RTN","KMPDUT2",51,0)
 S TXT(3)=$P($G(^VA(200,+$P(DATA,U,5),0)),U)
"RTN","KMPDUT2",52,0)
 S TXT(1,"F")="?45"
"RTN","KMPDUT2",53,0)
 S TXT(2,"F")="!?48"
"RTN","KMPDUT2",54,0)
 S TXT(3,"F")="!?48"
"RTN","KMPDUT2",55,0)
 D EN^DDIOL(.TXT)
"RTN","KMPDUT2",56,0)
 Q
"RTN","KMPDUT2",57,0)
 ;
"RTN","KMPDUT2",58,0)
XREF(DA,X,KMPDTYPE) ;-set/kill 'APTDTNM' xref in file #8973.1
"RTN","KMPDUT2",59,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",60,0)
 ; DA....... Ien for file #8973.1 (CM HL7 DATA)
"RTN","KMPDUT2",61,0)
 ; X........ Value of field #.05 (PROTOCOL)
"RTN","KMPDUT2",62,0)
 ; KMPDTYPE. 1 - set xref
"RTN","KMPDUT2",63,0)
 ;           2 - kill xref
"RTN","KMPDUT2",64,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",65,0)
 Q:'$G(DA)
"RTN","KMPDUT2",66,0)
 Q:$G(X)=""
"RTN","KMPDUT2",67,0)
 Q:'$G(KMPDTYPE)
"RTN","KMPDUT2",68,0)
 N DATA,DATE,NM
"RTN","KMPDUT2",69,0)
 S DATA=$G(^KMPD(8973.1,DA,0)) Q:DATA=""
"RTN","KMPDUT2",70,0)
 S DATE=$P(DATA,U) Q:'DATE
"RTN","KMPDUT2",71,0)
 S NM=$P(DATA,U,3) Q:NM=""
"RTN","KMPDUT2",72,0)
 I KMPDTYPE=1 S ^KMPD(8973.1,"APTDTNM",X,DATE,NM,DA)=""
"RTN","KMPDUT2",73,0)
 I KMPDTYPE=2 K ^KMPD(8973.1,"APTDTNM",X,DATE,NM,DA)
"RTN","KMPDUT2",74,0)
 Q
"RTN","KMPDUT2",75,0)
 ;
"RTN","KMPDUT2",76,0)
XREF1(DA,X,KMPDTYPE) ;-set/kill 'ACSDTPRNM' xref in file #8973.1
"RTN","KMPDUT2",77,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",78,0)
 ; DA....... Ien for file #8973.1 (CM HL7 DATA)
"RTN","KMPDUT2",79,0)
 ; X........ Value of field #99.212 (CONTACTED SITE NAME)
"RTN","KMPDUT2",80,0)
 ; KMPDTYPE. 1 - set xref
"RTN","KMPDUT2",81,0)
 ;           2 - kill xref
"RTN","KMPDUT2",82,0)
 ;
"RTN","KMPDUT2",83,0)
 ; variables used:
"RTN","KMPDUT2",84,0)
 ; DATE.. Internal value of field #.01 (DATE)
"RTN","KMPDUT2",85,0)
 ; NM.... Internal value of field #.03 (NAMESPACE)
"RTN","KMPDUT2",86,0)
 ; PR.... Internal value of field #.05 (PROTOCOL)
"RTN","KMPDUT2",87,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",88,0)
 Q:'$G(DA)
"RTN","KMPDUT2",89,0)
 Q:$G(X)=""
"RTN","KMPDUT2",90,0)
 Q:'$G(KMPDTYPE)
"RTN","KMPDUT2",91,0)
 N DATA,DATE,NM,PR
"RTN","KMPDUT2",92,0)
 S DATA=$G(^KMPD(8973.1,DA,0)) Q:DATA=""
"RTN","KMPDUT2",93,0)
 S DATE=$P(DATA,U) Q:'DATE
"RTN","KMPDUT2",94,0)
 S NM=$P(DATA,U,3) Q:NM=""
"RTN","KMPDUT2",95,0)
 S PR=$P(DATA,U,5) Q:PR=""
"RTN","KMPDUT2",96,0)
 I KMPDTYPE=1 S ^KMPD(8973.1,"ACSDTPRNM",X,DATE,PR,NM,DA)=""
"RTN","KMPDUT2",97,0)
 I KMPDTYPE=2 K ^KMPD(8973.1,"ACSDTPRNM",X,DATE,PR,NM,DA)
"RTN","KMPDUT2",98,0)
 Q
"RTN","KMPDUT2",99,0)
 ;
"RTN","KMPDUT2",100,0)
XREF2(DA,X,KMPDTYPE) ;-set/kill 'ASYNC' xref in file #8973.1
"RTN","KMPDUT2",101,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",102,0)
 ; DA....... Ien for file #8973.1 (CM HL7 DATA)
"RTN","KMPDUT2",103,0)
 ; X........ Value of field #.06 (SYNC/ASYNC)
"RTN","KMPDUT2",104,0)
 ; KMPDTYPE. 1 - set xref
"RTN","KMPDUT2",105,0)
 ;           2 - kill xref
"RTN","KMPDUT2",106,0)
 ;
"RTN","KMPDUT2",107,0)
 ; variables used:
"RTN","KMPDUT2",108,0)
 ; DATE.. Internal value of field #.01 (DATE)
"RTN","KMPDUT2",109,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",110,0)
 Q:'$G(DA)
"RTN","KMPDUT2",111,0)
 Q:$G(X)=""
"RTN","KMPDUT2",112,0)
 Q:'$G(KMPDTYPE)
"RTN","KMPDUT2",113,0)
 N DATA,DATE
"RTN","KMPDUT2",114,0)
 S DATA=$G(^KMPD(8973.1,DA,0)) Q:DATA=""
"RTN","KMPDUT2",115,0)
 S DATE=$P(DATA,U) Q:'DATE
"RTN","KMPDUT2",116,0)
 I KMPDTYPE=1 S ^KMPD(8973.1,"ASYNC",DATE,X,DA)=""
"RTN","KMPDUT2",117,0)
 I KMPDTYPE=2 K ^KMPD(8973.1,"ASYNC",DATE,X,DA)
"RTN","KMPDUT2",118,0)
 Q
"RTN","KMPDUT2",119,0)
 ;
"RTN","KMPDUT2",120,0)
XREFT1(DA,X,KMPDTYPE) ;-set/kill 'ASVDTSS' xref in file #8973.2
"RTN","KMPDUT2",121,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",122,0)
 ; DA....... Ien for file #8973.2 (CM TIMING)
"RTN","KMPDUT2",123,0)
 ; X........ Value of field #.07 (SERVER SUBSCRIPT)
"RTN","KMPDUT2",124,0)
 ; KMPDTYPE. 1 - set xref
"RTN","KMPDUT2",125,0)
 ;           2 - kill xref
"RTN","KMPDUT2",126,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",127,0)
 Q:'$G(DA)
"RTN","KMPDUT2",128,0)
 Q:$G(X)=""
"RTN","KMPDUT2",129,0)
 Q:'$G(KMPDTYPE)
"RTN","KMPDUT2",130,0)
 N DATA,DATE
"RTN","KMPDUT2",131,0)
 S DATA=$G(^KMPD(8973.2,DA,0)) Q:DATA=""
"RTN","KMPDUT2",132,0)
 ; strip off time
"RTN","KMPDUT2",133,0)
 S DATE=$P($P(DATA,U,3),".") Q:'DATE
"RTN","KMPDUT2",134,0)
 I KMPDTYPE=1 S ^KMPD(8973.2,"ASVDTSS",X,DATE,DA)=""
"RTN","KMPDUT2",135,0)
 I KMPDTYPE=2 K ^KMPD(8973.2,"ASVDTSS",X,DATE,DA)
"RTN","KMPDUT2",136,0)
 Q
"RTN","KMPDUT2",137,0)
 ;
"RTN","KMPDUT2",138,0)
XREFT2(DA,X,KMPDTYPE) ;-set/kill 'ASSDTPT' xref in file #8973.2
"RTN","KMPDUT2",139,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",140,0)
 ; DA....... Ien for file #8973.2 (CM TIMING)
"RTN","KMPDUT2",141,0)
 ; X........ Value of field #.07 (SERVER SUBSCRIPT)
"RTN","KMPDUT2",142,0)
 ; KMPDTYPE. 1 - set xref
"RTN","KMPDUT2",143,0)
 ;           2 - kill xref
"RTN","KMPDUT2",144,0)
 ;
"RTN","KMPDUT2",145,0)
 ; ^KMPD(8973.2,"ASSDTPT",ServerSubscript,ServerStartDate,PrimeTime,DA)
"RTN","KMPDUT2",146,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",147,0)
 Q:'$G(DA)
"RTN","KMPDUT2",148,0)
 Q:$G(X)=""
"RTN","KMPDUT2",149,0)
 Q:'$G(KMPDTYPE)
"RTN","KMPDUT2",150,0)
 N DATA,DATE,PTNP
"RTN","KMPDUT2",151,0)
 S DATA=$G(^KMPD(8973.2,DA,0)) Q:DATA=""
"RTN","KMPDUT2",152,0)
 ; server start date/time
"RTN","KMPDUT2",153,0)
 S DATE=$P(DATA,U,3) Q:'DATE
"RTN","KMPDUT2",154,0)
 ; prime time / non-prime time
"RTN","KMPDUT2",155,0)
 S PTNP=$$PTNP^KMPDHU03(DATE) Q:'PTNP
"RTN","KMPDUT2",156,0)
 ; strip off time
"RTN","KMPDUT2",157,0)
 S DATE=$P(DATE,".") Q:'DATE
"RTN","KMPDUT2",158,0)
 I KMPDTYPE=1 S ^KMPD(8973.2,"ASSDTPT",X,DATE,PTNP,DA)=""
"RTN","KMPDUT2",159,0)
 I KMPDTYPE=2 K ^KMPD(8973.2,"ASSDTPT",X,DATE,PTNP,DA)
"RTN","KMPDUT2",160,0)
 Q
"RTN","KMPDUT2",161,0)
 ;
"RTN","KMPDUT2",162,0)
XREFT3(DA,X,KMPDTYPE) ;-set/kill 'ASSDTTM' xref in file #8973.2
"RTN","KMPDUT2",163,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",164,0)
 ; DA....... Ien for file #8973.2 (CM TIMING)
"RTN","KMPDUT2",165,0)
 ; X........ Value of field #.07 (SERVER SUBSCRIPT)
"RTN","KMPDUT2",166,0)
 ; KMPDTYPE. 1 - set xref
"RTN","KMPDUT2",167,0)
 ;           2 - kill xref
"RTN","KMPDUT2",168,0)
 ;
"RTN","KMPDUT2",169,0)
 ; ^KMPD(8973.2,"ASSDTTM",ServerSubscript,ServerStartDate,PrimeTime,DA)
"RTN","KMPDUT2",170,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",171,0)
 Q:'$G(DA)
"RTN","KMPDUT2",172,0)
 Q:$G(X)=""
"RTN","KMPDUT2",173,0)
 Q:'$G(KMPDTYPE)
"RTN","KMPDUT2",174,0)
 N DATA,DATE
"RTN","KMPDUT2",175,0)
 S DATA=$G(^KMPD(8973.2,DA,0)) Q:DATA=""
"RTN","KMPDUT2",176,0)
 ; server start date/time
"RTN","KMPDUT2",177,0)
 S DATE=$P(DATA,U,3) Q:'DATE
"RTN","KMPDUT2",178,0)
 I KMPDTYPE=1 S ^KMPD(8973.2,"ASSDTTM",X,DATE,DA)=""
"RTN","KMPDUT2",179,0)
 I KMPDTYPE=2 K ^KMPD(8973.2,"ASSDTTM",X,DATE,DA)
"RTN","KMPDUT2",180,0)
 Q
"RTN","KMPDUT2",181,0)
 ;
"RTN","KMPDUT2",182,0)
XREFT4(DA,X,KMPDTYPE) ;-set/kill 'ASSCLDTTM' xref in file #8973.2
"RTN","KMPDUT2",183,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",184,0)
 ; DA....... Ien for file #8973.2 (CM TIMING)
"RTN","KMPDUT2",185,0)
 ; X........ Value of field #.07 (KMPTMP SUBSCRIPT)
"RTN","KMPDUT2",186,0)
 ; KMPDTYPE. 1 - set xref
"RTN","KMPDUT2",187,0)
 ;           2 - kill xref
"RTN","KMPDUT2",188,0)
 ;
"RTN","KMPDUT2",189,0)
 ; ^KMPD(8973.2,"ASSCLDTTM",KmptmpSubscript,ClientName,ServerDateTime,DA)
"RTN","KMPDUT2",190,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",191,0)
 Q:'$G(DA)
"RTN","KMPDUT2",192,0)
 Q:$G(X)=""
"RTN","KMPDUT2",193,0)
 Q:'$G(KMPDTYPE)
"RTN","KMPDUT2",194,0)
 N CLNM,DATA,DATE
"RTN","KMPDUT2",195,0)
 S DATA=$G(^KMPD(8973.2,DA,0)) Q:DATA=""
"RTN","KMPDUT2",196,0)
 ; server start date/time
"RTN","KMPDUT2",197,0)
 S DATE=$P(DATA,U,3) Q:'DATE
"RTN","KMPDUT2",198,0)
 ; client name
"RTN","KMPDUT2",199,0)
 S CLNM=$P(DATA,U,6) Q:CLNM=""
"RTN","KMPDUT2",200,0)
 I KMPDTYPE=1 S ^KMPD(8973.2,"ASSCLDTTM",X,CLNM,DATE,DA)=""
"RTN","KMPDUT2",201,0)
 I KMPDTYPE=2 K ^KMPD(8973.2,"ASSCLDTTM",X,CLNM,DATE,DA)
"RTN","KMPDUT2",202,0)
 Q
"RTN","KMPDUT2",203,0)
XREFT5(DA,X,KMPDTYPE) ;-set/kill 'ASSNPDTTM' xref in file #8973.2
"RTN","KMPDUT2",204,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",205,0)
 ; DA....... Ien for file #8973.2 (CM TIMING)
"RTN","KMPDUT2",206,0)
 ; X........ Value of field #.07 (KMPTMP SUBSCRIPT)
"RTN","KMPDUT2",207,0)
 ; KMPDTYPE. 1 - set xref
"RTN","KMPDUT2",208,0)
 ;           2 - kill xref
"RTN","KMPDUT2",209,0)
 ;
"RTN","KMPDUT2",210,0)
 ; ^KMPD(8973.2,"ASSNPDTTM",KmptmpSubscript,NewPerson,ServerDateTime,DA)
"RTN","KMPDUT2",211,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",212,0)
 Q:'$G(DA)
"RTN","KMPDUT2",213,0)
 Q:$G(X)=""
"RTN","KMPDUT2",214,0)
 Q:'$G(KMPDTYPE)
"RTN","KMPDUT2",215,0)
 N NP,DATA,DATE
"RTN","KMPDUT2",216,0)
 S DATA=$G(^KMPD(8973.2,DA,0)) Q:DATA=""
"RTN","KMPDUT2",217,0)
 ; server start date/time
"RTN","KMPDUT2",218,0)
 S DATE=$P(DATA,U,3) Q:'DATE
"RTN","KMPDUT2",219,0)
 ; new person
"RTN","KMPDUT2",220,0)
 S NP=$P(DATA,U,5) Q:NP=""
"RTN","KMPDUT2",221,0)
 I KMPDTYPE=1 S ^KMPD(8973.2,"ASSNPDTTM",X,NP,DATE,DA)=""
"RTN","KMPDUT2",222,0)
 I KMPDTYPE=2 K ^KMPD(8973.2,"ASSNPDTTM",X,NP,DATE,DA)
"RTN","KMPDUT2",223,0)
 Q
"RTN","KMPDUT2",224,0)
 ;
"RTN","KMPDUT2",225,0)
XREFT6(DA,X,KMPDTYPE) ;-set/kill 'ASSIPDTTM' xref in file #8973.2
"RTN","KMPDUT2",226,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",227,0)
 ; DA....... Ien for file #8973.2 (CM TIMING)
"RTN","KMPDUT2",228,0)
 ; X........ Value of field #.07 (KMPTMP SUBSCRIPT)
"RTN","KMPDUT2",229,0)
 ; KMPDTYPE. 1 - set xref
"RTN","KMPDUT2",230,0)
 ;           2 - kill xref
"RTN","KMPDUT2",231,0)
 ;
"RTN","KMPDUT2",232,0)
 ; ^KMPD(8973.2,"ASSIPDTTM",KmptmpSubscript,IpAddress,ServerDateTime,DA)
"RTN","KMPDUT2",233,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUT2",234,0)
 Q:'$G(DA)
"RTN","KMPDUT2",235,0)
 Q:$G(X)=""
"RTN","KMPDUT2",236,0)
 Q:'$G(KMPDTYPE)
"RTN","KMPDUT2",237,0)
 N IP,DATA,DATE
"RTN","KMPDUT2",238,0)
 S DATA=$G(^KMPD(8973.2,DA,0)) Q:DATA=""
"RTN","KMPDUT2",239,0)
 ; server start date/time
"RTN","KMPDUT2",240,0)
 S DATE=$P(DATA,U,3) Q:'DATE
"RTN","KMPDUT2",241,0)
 ; ip address
"RTN","KMPDUT2",242,0)
 S IP=$P(DATA,U,9) Q:IP=""
"RTN","KMPDUT2",243,0)
 I KMPDTYPE=1 S ^KMPD(8973.2,"ASSIPDTTM",X,IP,DATE,DA)=""
"RTN","KMPDUT2",244,0)
 I KMPDTYPE=2 K ^KMPD(8973.2,"ASSIPDTTM",X,IP,DATE,DA)
"RTN","KMPDUT2",245,0)
 Q
"RTN","KMPDUTL")
0^6^B5892376
"RTN","KMPDUTL",1,0)
KMPDUTL ;OAK/RAK - CM Tools Utility ;11/4/03  14:25
"RTN","KMPDUTL",2,0)
 ;;1.0;CM TOOLS;**1,2**;Mar 22, 2002
"RTN","KMPDUTL",3,0)
 ;
"RTN","KMPDUTL",4,0)
QUEBKG(KMPDOPT,KMPDTIME,KMPDFREQ,KMPDDEL) ;-- queue background job
"RTN","KMPDUTL",5,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL",6,0)
 ; KMPDOPT.... Option name to queue (free text name in .01 field of 
"RTN","KMPDUTL",7,0)
 ;                                   OPTION file)
"RTN","KMPDUTL",8,0)
 ; KMPDTIME... Date/time to queue option (T@1400, etc)
"RTN","KMPDUTL",9,0)
 ; KMPDFREQ... Scheduling frequency (1D, etc)
"RTN","KMPDUTL",10,0)
 ; KMPDDEL.... Delete option if it already exists in file 19.2
"RTN","KMPDUTL",11,0)
 ;              0 - do not delete (quit if already scheduled)
"RTN","KMPDUTL",12,0)
 ;              1 - delete if already in file 19.2
"RTN","KMPDUTL",13,0)
 ;
"RTN","KMPDUTL",14,0)
 ; This API will queue an option from file #19 (OPTION) to run in file
"RTN","KMPDUTL",15,0)
 ; 19.2 (OPTION SCHEDULE).
"RTN","KMPDUTL",16,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL",17,0)
 Q:$G(KMPDOPT)=""
"RTN","KMPDUTL",18,0)
 Q:$G(KMPDTIME)=""
"RTN","KMPDUTL",19,0)
 Q:$G(KMPDFREQ)=""
"RTN","KMPDUTL",20,0)
 S KMPDDEL=+$G(KMPDDEL)
"RTN","KMPDUTL",21,0)
 N DA,DIFROM,DIK,FDA,ERROR,IEN,IEN1,IENZ,TEXT,X,Y,Z
"RTN","KMPDUTL",22,0)
 ; Newing DIFROM will force reschedule when installing from KIDS
"RTN","KMPDUTL",23,0)
 S:'$G(DT) DT=$$DT^XLFDT
"RTN","KMPDUTL",24,0)
 ; change to internal format
"RTN","KMPDUTL",25,0)
 D FMDTI^KMPDU(.Z,KMPDTIME)
"RTN","KMPDUTL",26,0)
 Q:Z(0)="^"!(Z(0)="")
"RTN","KMPDUTL",27,0)
 S KMPDTIME=Z(0) K Z
"RTN","KMPDUTL",28,0)
 S TEXT=KMPDOPT
"RTN","KMPDUTL",29,0)
 ; quit if not in file 19
"RTN","KMPDUTL",30,0)
 S IEN=$O(^DIC(19,"B",TEXT,0)) Q:'IEN
"RTN","KMPDUTL",31,0)
 S IEN1=$O(^DIC(19.2,"B",IEN,0))
"RTN","KMPDUTL",32,0)
 ; quit if already in file 19.2 and not KMPDDEL
"RTN","KMPDUTL",33,0)
 Q:IEN1&('KMPDDEL)
"RTN","KMPDUTL",34,0)
 ; delete if in file 19.2
"RTN","KMPDUTL",35,0)
 I IEN1 S DIK="^DIC(19.2,",DA=IEN1 D ^DIK
"RTN","KMPDUTL",36,0)
 ; add entry
"RTN","KMPDUTL",37,0)
 S FDA($J,19.2,"+1,",.01)=IEN
"RTN","KMPDUTL",38,0)
 ; queued to run at what time
"RTN","KMPDUTL",39,0)
 S FDA($J,19.2,"+1,",2)=KMPDTIME
"RTN","KMPDUTL",40,0)
 ; rescheduling frequency.
"RTN","KMPDUTL",41,0)
 S FDA($J,19.2,"+1,",6)=KMPDFREQ
"RTN","KMPDUTL",42,0)
 D UPDATE^DIE("","FDA($J)",.IENZ,"ERROR")
"RTN","KMPDUTL",43,0)
 I $D(ERROR) D MSG^DIALOG("W","",60,10,"ERROR")
"RTN","KMPDUTL",44,0)
 S IEN1=$O(^DIC(19.2,"B",IEN,0))
"RTN","KMPDUTL",45,0)
 I '$G(^DIC(19.2,+IEN1,1)) D 
"RTN","KMPDUTL",46,0)
 .D MES^XPDUTL("     ERROR - Not able to reschedule "_KMPDOPT)
"RTN","KMPDUTL",47,0)
 .D MES^XPDUTL("     Use 'Schedule/Unschedule Options' [XUTM SCHEDULE] to reschedule.")
"RTN","KMPDUTL",48,0)
 ;
"RTN","KMPDUTL",49,0)
 Q
"RTN","KMPDUTL",50,0)
 ;
"RTN","KMPDUTL",51,0)
VERSION() ;-- extrinsic - return current version.
"RTN","KMPDUTL",52,0)
 Q $P($T(+2^KMPDUTL),";",3)_"^"_$P($T(+2^KMPDUTL),";",5)
"RTN","KMPDUTL",53,0)
 ;
"RTN","KMPDUTL",54,0)
PTCHINFO ; -- patch information: routine name ^ current version ^ current patch(es)
"RTN","KMPDUTL",55,0)
 ;;KMPDBD01^1.0^**1,2**
"RTN","KMPDUTL",56,0)
 ;;KMPDHU01^1.0^**1,2**
"RTN","KMPDUTL",57,0)
 ;;KMPDHU02^1.0^**1,2**
"RTN","KMPDUTL",58,0)
 ;;KMPDHU03^1.0^**1**
"RTN","KMPDUTL",59,0)
 ;;KMPDHUA^1.0^**1**
"RTN","KMPDUTL",60,0)
 ;;KMPDSS^1.0^**1,2**
"RTN","KMPDUTL",61,0)
 ;;KMPDTP1^1.0^**2**
"RTN","KMPDUTL",62,0)
 ;;KMPDTP2^1.0^**2**
"RTN","KMPDUTL",63,0)
 ;;KMPDTP3^1.0^**2**
"RTN","KMPDUTL",64,0)
 ;;KMPDTP4^1.0^**2**
"RTN","KMPDUTL",65,0)
 ;;KMPDTP5^1.0^**2**
"RTN","KMPDUTL",66,0)
 ;;KMPDTP6^1.0^**2**
"RTN","KMPDUTL",67,0)
 ;;KMPDTP7^1.0^**2**
"RTN","KMPDUTL",68,0)
 ;;KMPDTU02^1.0^**2**
"RTN","KMPDUTL",69,0)
 ;;KMPDTU10^1.0^**2**
"RTN","KMPDUTL",70,0)
 ;;KMPDU^1.0^**1**
"RTN","KMPDUTL",71,0)
 ;;KMPDUT2^1.0^**1,2**
"RTN","KMPDUTL",72,0)
 ;;KMPDUT4^1.0^**1**
"RTN","KMPDUTL",73,0)
 ;;KMPDUT4A^1.0^**1**
"RTN","KMPDUTL",74,0)
 ;;KMPDUT4B^1.0^**1**
"RTN","KMPDUTL",75,0)
 ;;KMPDUT4C^1.0^**1**
"RTN","KMPDUTL",76,0)
 ;;KMPDUTL^1.0^**1,2**
"RTN","KMPDUTL",77,0)
 ;;KMPDUTL1^1.0^**1,2**
"RTN","KMPDUTL",78,0)
 ;;KMPDUTL2^1.0^**1,2**
"RTN","KMPDUTL",79,0)
 ;;KMPDUTL3^1.0^**1,2**
"RTN","KMPDUTL",80,0)
 ;;KMPDUTL4^1.0^**1,2**
"RTN","KMPDUTL",81,0)
 ;;KMPDUTL5^1.0^**2**
"RTN","KMPDUTL",82,0)
 ;;
"RTN","KMPDUTL1")
0^14^B21710774
"RTN","KMPDUTL1",1,0)
KMPDUTL1 ;OAK/RAK,KAK - CM TOOLS Utilities ;11/4/03  14:26
"RTN","KMPDUTL1",2,0)
 ;;1.0;CM TOOLS;**1,2**;Mar 22, 2002
"RTN","KMPDUTL1",3,0)
 ;
"RTN","KMPDUTL1",4,0)
CONT(KMPDEXT)  ;-- function displays 'return to continue' message at bottom of page
"RTN","KMPDUTL1",5,0)
 ;--------------------------------------------------------------------
"RTN","KMPDUTL1",6,0)
 ; KMPDEXT 0 = do not show 'to exit' text
"RTN","KMPDUTL1",7,0)
 ;         1 = show 'to exit' text
"RTN","KMPDUTL1",8,0)
 ;
"RTN","KMPDUTL1",9,0)
 ; Return: 0 = continue
"RTN","KMPDUTL1",10,0)
 ;         1 = quit
"RTN","KMPDUTL1",11,0)
 ;--------------------------------------------------------------------
"RTN","KMPDUTL1",12,0)
 ;
"RTN","KMPDUTL1",13,0)
 N DIR,X,Y
"RTN","KMPDUTL1",14,0)
 ;
"RTN","KMPDUTL1",15,0)
 S KMPDEXT=+$G(KMPDEXT)
"RTN","KMPDUTL1",16,0)
 F  Q:$Y>(IOSL-3)  W !
"RTN","KMPDUTL1",17,0)
 S DIR(0)="EA"
"RTN","KMPDUTL1",18,0)
 S DIR("A")="Press RETURN to continue"_$S(KMPDEXT:" or '^' to exit: ",1:": ")
"RTN","KMPDUTL1",19,0)
 D ^DIR
"RTN","KMPDUTL1",20,0)
 Q +$G(Y)
"RTN","KMPDUTL1",21,0)
 ;
"RTN","KMPDUTL1",22,0)
SYSINFO() ;-- returns system information
"RTN","KMPDUTL1",23,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL1",24,0)
 ; Returns:
"RTN","KMPDUTL1",25,0)
 ;         "^" piece 1 - type of M platform
"RTN","KMPDUTL1",26,0)
 ;         "^" piece 2 - $ZV => name and version of M system
"RTN","KMPDUTL1",27,0)
 ;         "^" piece 3 - operating system version
"RTN","KMPDUTL1",28,0)
 ;
"RTN","KMPDUTL1",29,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL1",30,0)
 ;
"RTN","KMPDUTL1",31,0)
 N MPLTF,OSVER,SYSINFO
"RTN","KMPDUTL1",32,0)
 ;
"RTN","KMPDUTL1",33,0)
 S MPLTF=$$MPLTF(),OSVER=$$OSVER(MPLTF)
"RTN","KMPDUTL1",34,0)
 S SYSINFO=MPLTF_U_$ZV_U_OSVER
"RTN","KMPDUTL1",35,0)
 Q SYSINFO
"RTN","KMPDUTL1",36,0)
 ;
"RTN","KMPDUTL1",37,0)
MPLTF() ;-- returns the type of M platform
"RTN","KMPDUTL1",38,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL1",39,0)
 ; Returns:  DSM    for DSM platform
"RTN","KMPDUTL1",40,0)
 ;           CVMS   for Cache for OpenVMS platform
"RTN","KMPDUTL1",41,0)
 ;           CWINNT for Cache for Windows NT platform
"RTN","KMPDUTL1",42,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL1",43,0)
 ;
"RTN","KMPDUTL1",44,0)
 N MPLTF,ZV
"RTN","KMPDUTL1",45,0)
 ;
"RTN","KMPDUTL1",46,0)
 S ZV=$ZV
"RTN","KMPDUTL1",47,0)
 S MPLTF=$S(ZV["DSM":"DSM",ZV["VMS":"CVMS",ZV["Windows":"CWINNT",1:"UNK")
"RTN","KMPDUTL1",48,0)
 Q MPLTF
"RTN","KMPDUTL1",49,0)
 ;
"RTN","KMPDUTL1",50,0)
OSVER(MPLTF) ;-- returns the operating system version
"RTN","KMPDUTL1",51,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL1",52,0)
 ; input: MPLTF = type of M platform
"RTN","KMPDUTL1",53,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL1",54,0)
 ;
"RTN","KMPDUTL1",55,0)
 I $G(MPLTF)="" Q ""
"RTN","KMPDUTL1",56,0)
 ;
"RTN","KMPDUTL1",57,0)
 I MPLTF["DSM" Q $ZC(%GETSYI,"VERSION")
"RTN","KMPDUTL1",58,0)
 I MPLTF["CVMS" Q $$CVMSVER^KMPDUTL5()
"RTN","KMPDUTL1",59,0)
 I MPLTF["CWINNT" Q ""
"RTN","KMPDUTL1",60,0)
 Q ""
"RTN","KMPDUTL1",61,0)
 ;
"RTN","KMPDUTL1",62,0)
TSKSTAT(OPT) ;-- status of scheduled task option
"RTN","KMPDUTL1",63,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL1",64,0)
 ; input  OPT = option name
"RTN","KMPDUTL1",65,0)
 ; output RTN = status code^literal condition
"RTN","KMPDUTL1",66,0)
 ;              ...^scheduled date@time (day)^numeric day-of-week
"RTN","KMPDUTL1",67,0)
 ;              ...^expanded scheduled frequency^short form frequency
"RTN","KMPDUTL1",68,0)
 ;              ...^task id^queued by^user status
"RTN","KMPDUTL1",69,0)
 ;
"RTN","KMPDUTL1",70,0)
 ; where status code^condition:
"RTN","KMPDUTL1",71,0)
 ;            = 0^SCHEDULED
"RTN","KMPDUTL1",72,0)
 ;            = 1^NOT SCHEDULED and 'scheduled date@time' will
"RTN","KMPDUTL1",73,0)
 ;                   be UNKNOWN and 'numeric day of week' will be -1
"RTN","KMPDUTL1",74,0)
 ;            = 2^NOT RESCHEDULED
"RTN","KMPDUTL1",75,0)
 ;            = 3^MISSING when OPT does not exist
"RTN","KMPDUTL1",76,0)
 ;            = 9^UNKNOWN
"RTN","KMPDUTL1",77,0)
 ;
"RTN","KMPDUTL1",78,0)
 ; where user status = ACTIVE or NOT ACTIVE
"RTN","KMPDUTL1",79,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL1",80,0)
 ;
"RTN","KMPDUTL1",81,0)
 N ACTV,DA,DAY,DOW,FREQ,RTN,TSK,TSKINFO,USER,Y
"RTN","KMPDUTL1",82,0)
 ;
"RTN","KMPDUTL1",83,0)
 S (DOW,FREQ)=-1
"RTN","KMPDUTL1",84,0)
 S RTN="9^UNKNOWN^NO DATE^-1^UNKNOWN^^^UNKNOWN^NOT ACTIVE"
"RTN","KMPDUTL1",85,0)
 ;
"RTN","KMPDUTL1",86,0)
 I '$D(^DIC(19,"B",OPT)) S $P(RTN,U,1,2)="3^MISSING" Q RTN
"RTN","KMPDUTL1",87,0)
 S DA=$O(^DIC(19,"B",OPT,0)),DA=+$O(^DIC(19.2,"B",DA,0))
"RTN","KMPDUTL1",88,0)
 S TSKINFO=$G(^DIC(19.2,DA,0)),(DOW,Y)=$P(TSKINFO,U,2),FREQ=$P(TSKINFO,U,6)
"RTN","KMPDUTL1",89,0)
 D:+Y DD^%DT S $P(TSKINFO,U,2)=Y
"RTN","KMPDUTL1",90,0)
 I DOW'="" S DAY=$$DOW^XLFDT(DOW),DOW=$$DOW^XLFDT(DOW,1)
"RTN","KMPDUTL1",91,0)
 S TSK=+$G(^DIC(19.2,+DA,1))
"RTN","KMPDUTL1",92,0)
 I (DOW="")!(TSK="") S $P(RTN,U,1,2)="1^NOT SCHEDULED"
"RTN","KMPDUTL1",93,0)
 E  D
"RTN","KMPDUTL1",94,0)
 .S $P(RTN,U,1,2)="0^SCHEDULED"
"RTN","KMPDUTL1",95,0)
 .I FREQ="" S $P(RTN,U,1,2)="2^NOT RESCHEDULED"
"RTN","KMPDUTL1",96,0)
 .; queued to run at
"RTN","KMPDUTL1",97,0)
 .S $P(RTN,U,3,4)=$S($P(TSKINFO,U,2)="":"NO DATE",1:$P(TSKINFO,U,2))_$S($D(DAY):" ("_DAY_")",1:"")_U_DOW
"RTN","KMPDUTL1",98,0)
 ; rescheduling frequency
"RTN","KMPDUTL1",99,0)
 I FREQ?1.3N1A D
"RTN","KMPDUTL1",100,0)
 .S $P(RTN,U,5,6)=+FREQ_" "_$S(FREQ["D":"day",FREQ["M":"month",1:FREQ)_$S(+FREQ>1:"s",1:"")_U_FREQ
"RTN","KMPDUTL1",101,0)
 E  S $P(RTN,U,5,6)=$S(FREQ="":"UNKNOWN",1:FREQ)_U_FREQ
"RTN","KMPDUTL1",102,0)
 ; task id
"RTN","KMPDUTL1",103,0)
 S $P(RTN,U,7)=TSK
"RTN","KMPDUTL1",104,0)
 ; find if the user is active
"RTN","KMPDUTL1",105,0)
 I TSK D
"RTN","KMPDUTL1",106,0)
 .S TSKINFO=$G(^%ZTSK(TSK,0))
"RTN","KMPDUTL1",107,0)
 .S USER=+$P(TSKINFO,U,3)
"RTN","KMPDUTL1",108,0)
 .S ACTV=+$$ACTIVE^XUSER(USER)
"RTN","KMPDUTL1",109,0)
 .; queued by
"RTN","KMPDUTL1",110,0)
 .S $P(RTN,U,8)=$P($G(^VA(200,USER,0)),U)
"RTN","KMPDUTL1",111,0)
 I $G(ACTV) S $P(RTN,U,9)="ACTIVE"
"RTN","KMPDUTL1",112,0)
 Q RTN
"RTN","KMPDUTL1",113,0)
 ;
"RTN","KMPDUTL1",114,0)
VERPTCH(PKG,RTNARRY)    ;-- returns current version and patch status of specified CM package
"RTN","KMPDUTL1",115,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL1",116,0)
 ; input PKG = 'D' for CM TOOLS
"RTN","KMPDUTL1",117,0)
 ;             'R' for RUM
"RTN","KMPDUTL1",118,0)
 ;             'S' for SAGG
"RTN","KMPDUTL1",119,0)
 ; Return array (passed by reference) in format:
"RTN","KMPDUTL1",120,0)
 ; output RTNARRY = -1 for error
"RTN","KMPDUTL1",121,0)
 ;        RTNARRY(0) = number of routines^total rtns ok^total rtns bad^total rtns missing
"RTN","KMPDUTL1",122,0)
 ;        RTNARRY(rtn name) = {0=good 1=bad 2=missing routine}^released version^released patch(es)^site version^site patch(es)
"RTN","KMPDUTL1",123,0)
 ;
"RTN","KMPDUTL1",124,0)
 ; This code will reference line tag PTCHINFO^KMP_pkg_UTL for the
"RTN","KMPDUTL1",125,0)
 ; following patch information text starting at PTCHINFO+1:
"RTN","KMPDUTL1",126,0)
 ;
"RTN","KMPDUTL1",127,0)
 ;        ;;routine name ^ current version ^ current patch(es)
"RTN","KMPDUTL1",128,0)
 ;
"RTN","KMPDUTL1",129,0)
 ; Example:    
"RTN","KMPDUTL1",130,0)
 ;           PATCHINFO  ;-- patch information
"RTN","KMPDUTL1",131,0)
 ;                      ;;KMPSGE^1.8^**1,2**
"RTN","KMPDUTL1",132,0)
 ;                      ;;KMPSUTL^1.8^**1,2**
"RTN","KMPDUTL1",133,0)
 ;  last line >         ;;
"RTN","KMPDUTL1",134,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL1",135,0)
 ;
"RTN","KMPDUTL1",136,0)
 K RTNARRY
"RTN","KMPDUTL1",137,0)
 ;
"RTN","KMPDUTL1",138,0)
 N BAD,I,INFO,INFOSITE,OK,OUT,PTCH,PTCHSITE,RTN
"RTN","KMPDUTL1",139,0)
 N TAG,TOTBAD,TOTMISS,TOTOK,TOTRTN,X,VER,VERSITE
"RTN","KMPDUTL1",140,0)
 ;
"RTN","KMPDUTL1",141,0)
 I $G(PKG)=""!("DRS"'[$G(PKG))!($L(PKG)'=1) S RTNARRY=-1 Q
"RTN","KMPDUTL1",142,0)
 S X="KMP"_PKG_"UTL"
"RTN","KMPDUTL1",143,0)
 X ^%ZOSF("TEST") I '$T S RTNARRY=-1 Q
"RTN","KMPDUTL1",144,0)
 ;
"RTN","KMPDUTL1",145,0)
 S (OUT,TOTBAD,TOTMISS,TOTOK,TOTRTN)=0
"RTN","KMPDUTL1",146,0)
 F I=1:1 D  Q:OUT
"RTN","KMPDUTL1",147,0)
 .S TAG="PTCHINFO+"_I_"^KMP"_PKG_"UTL"
"RTN","KMPDUTL1",148,0)
 .S INFO=$P($T(@TAG),";;",2)
"RTN","KMPDUTL1",149,0)
 .I INFO="" S OUT=1 Q
"RTN","KMPDUTL1",150,0)
 .S RTN=$P(INFO,U),VER=$P(INFO,U,2),PTCH=$P(INFO,U,3)
"RTN","KMPDUTL1",151,0)
 .; if routine is missing
"RTN","KMPDUTL1",152,0)
 .I $T(@(RTN_"^"_RTN))="" D  Q
"RTN","KMPDUTL1",153,0)
 ..S TOTMISS=TOTMISS+1,TOTRTN=TOTRTN+1
"RTN","KMPDUTL1",154,0)
 ..S RTNARRY(RTN)="2^"_VER_U_PTCH_"^^"
"RTN","KMPDUTL1",155,0)
 .X "ZL @RTN S INFOSITE=$T(+2)"
"RTN","KMPDUTL1",156,0)
 .S VERSITE=$P(INFOSITE,";",3),PTCHSITE=$P(INFOSITE,";",5)
"RTN","KMPDUTL1",157,0)
 .I VERSITE'=VER!(PTCHSITE'=PTCH) S BAD=1,OK=0
"RTN","KMPDUTL1",158,0)
 .E  S BAD=0,OK=1
"RTN","KMPDUTL1",159,0)
 .S TOTBAD=TOTBAD+BAD,TOTOK=TOTOK+OK,TOTRTN=TOTRTN+1
"RTN","KMPDUTL1",160,0)
 .S RTNARRY(RTN)=BAD_U_VER_U_PTCH_U_VERSITE_U_PTCHSITE
"RTN","KMPDUTL1",161,0)
 S RTNARRY(0)=TOTRTN_U_TOTOK_U_TOTBAD_U_TOTMISS
"RTN","KMPDUTL1",162,0)
 Q
"RTN","KMPDUTL2")
0^7^B9676981
"RTN","KMPDUTL2",1,0)
KMPDUTL2 ;OAK/RAK - CM Tools Error Message ;11/4/03  14:26
"RTN","KMPDUTL2",2,0)
 ;;1.0;CM TOOLS;**1,2**;Mar 22, 2002
"RTN","KMPDUTL2",3,0)
 ;
"RTN","KMPDUTL2",4,0)
DATERNG(KMPUY,KMPUSTR,KMPUEND) ;-- date range
"RTN","KMPDUTL2",5,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL2",6,0)
 ; KMPUY..... Value returned in four pieces:
"RTN","KMPDUTL2",7,0)
 ;            fmstartdate^fmenddate^ouputstartdate^outputenddate
"RTN","KMPDUTL2",8,0)
 ;
"RTN","KMPDUTL2",9,0)
 ;            Piece one and two are the date ranges in fileman format.
"RTN","KMPDUTL2",10,0)
 ;            Piece three and four are the same dates in output format:
"RTN","KMPDUTL2",11,0)
 ;                             dy-Mon-yr
"RTN","KMPDUTL2",12,0)
 ;
"RTN","KMPDUTL2",13,0)
 ;                               ********
"RTN","KMPDUTL2",14,0)
 ;                               * NOTE *
"RTN","KMPDUTL2",15,0)
 ;                               ********
"RTN","KMPDUTL2",16,0)
 ;          - The first piece will always be the earliest date entered.
"RTN","KMPDUTL2",17,0)
 ;
"RTN","KMPDUTL2",18,0)
 ;  Optional Parameters:
"RTN","KMPDUTL2",19,0)
 ;
"RTN","KMPDUTL2",20,0)
 ; KMPUSTR... If defined, the earliest date that may be selected.
"RTN","KMPDUTL2",21,0)
 ;            (must be in fileman format)
"RTN","KMPDUTL2",22,0)
 ;
"RTN","KMPDUTL2",23,0)
 ; KMPUEND... If defined, the latest date that may be selected.
"RTN","KMPDUTL2",24,0)
 ;            (must be in fileman format)
"RTN","KMPDUTL2",25,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL2",26,0)
 ;
"RTN","KMPDUTL2",27,0)
 N DATE1,DATE2,DIR,DIRUT,LINE,X,Y
"RTN","KMPDUTL2",28,0)
 ;
"RTN","KMPDUTL2",29,0)
 S KMPUY="",KMPUSTR=$G(KMPUSTR),KMPUEND=$G(KMPUEND)
"RTN","KMPDUTL2",30,0)
 ;
"RTN","KMPDUTL2",31,0)
RANGE ;-- Ask date ranges
"RTN","KMPDUTL2",32,0)
 S DIR(0)="DOA^"_$S(KMPUSTR:KMPUSTR,1:"")_":"_$S(KMPUEND:KMPUEND,1:"")_":ET)"
"RTN","KMPDUTL2",33,0)
 S DIR("A")="Start with Date: "
"RTN","KMPDUTL2",34,0)
 S:KMPUSTR DIR("B")=$$FMTE^XLFDT(KMPUSTR,2)
"RTN","KMPDUTL2",35,0)
 S DIR("?")=" "
"RTN","KMPDUTL2",36,0)
 S DIR("?",1)="Enter the starting date.",LINE=2
"RTN","KMPDUTL2",37,0)
 ; if starting date.
"RTN","KMPDUTL2",38,0)
 I KMPUSTR D 
"RTN","KMPDUTL2",39,0)
 .S DIR("?",LINE)="Date must not precede "_$$FMTE^XLFDT(KMPUSTR)
"RTN","KMPDUTL2",40,0)
 .S LINE=LINE+1
"RTN","KMPDUTL2",41,0)
 ; if ending date.
"RTN","KMPDUTL2",42,0)
 I KMPUEND S DIR("?",LINE)="Date must not follow "_$$FMTE^XLFDT(KMPUEND)
"RTN","KMPDUTL2",43,0)
 W ! D ^DIR I $D(DIRUT) S KMPUY="" Q
"RTN","KMPDUTL2",44,0)
 S DATE1=Y
"RTN","KMPDUTL2",45,0)
 S DIR("A")="  End with Date: "
"RTN","KMPDUTL2",46,0)
 S:KMPUEND DIR("B")=$$FMTE^XLFDT(KMPUEND,2)
"RTN","KMPDUTL2",47,0)
 S DIR("?",1)="Enter the ending date."
"RTN","KMPDUTL2",48,0)
 D ^DIR G:Y="" RANGE I Y="^" S KMPUY="" Q
"RTN","KMPDUTL2",49,0)
 S DATE2=Y
"RTN","KMPDUTL2",50,0)
 ; Set earliest date into first piece.
"RTN","KMPDUTL2",51,0)
 S KMPUY=$S(DATE2<DATE1:DATE2,1:DATE1)_U_$S(DATE2>DATE1:DATE2,1:DATE1)
"RTN","KMPDUTL2",52,0)
 S $P(KMPUY,U,3)=$$FMTE^XLFDT($P(KMPUY,U))
"RTN","KMPDUTL2",53,0)
 S $P(KMPUY,U,4)=$$FMTE^XLFDT($P(KMPUY,U,2))
"RTN","KMPDUTL2",54,0)
 Q
"RTN","KMPDUTL2",55,0)
 ;
"RTN","KMPDUTL2",56,0)
EMAIL(KMPDSUBJ,KMPDTEXT,KMPDTO) ; check and process errors.
"RTN","KMPDUTL2",57,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL2",58,0)
 ; KMPDSUBJ... Free text - to be included in subject
"RTN","KMPDUTL2",59,0)
 ; KMPDTEXT(). Array containing message text.  This must be in a format
"RTN","KMPDUTL2",60,0)
 ;             accepted by XMTEXT - TEXT(
"RTN","KMPDUTL2",61,0)
 ;                                  ^TMP($J,"TEXT",
"RTN","KMPDUTL2",62,0)
 ; KMPDTO..... Address for email recipient:
"RTN","KMPDUTL2",63,0)
 ;              G.KMP2-RUM@FO-ALBANY.MED.VA.GOV
"RTN","KMPDUTL2",64,0)
 ;              G.KMP4-CMTOOLS@FO-ALBANY.MED.VA.GOV
"RTN","KMPDUTL2",65,0)
 ;              G.CAPACITY,MANAGEMENT@FO-ALBANY.MED.GOV
"RTN","KMPDUTL2",66,0)
 ;             If no value is passed the default will be 
"RTN","KMPDUTL2",67,0)
 ;              G.KMP4-CMTOOLS@FO-ALBANY.MED.VA.GOV
"RTN","KMPDUTL2",68,0)
 ;              
"RTN","KMPDUTL2",69,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL2",70,0)
 ;
"RTN","KMPDUTL2",71,0)
 Q:$G(KMPDTEXT)=""
"RTN","KMPDUTL2",72,0)
 S KMPDSUBJ=$S($G(KMPDSUBJ)="":"CM Error",1:KMPDSUBJ)
"RTN","KMPDUTL2",73,0)
 S KMPDTO=$S($G(KMPDTO)="":"G.KMP4-CMTOOLS@FO-ALBANY.MED.VA.GOV",1:KMPDTO)
"RTN","KMPDUTL2",74,0)
 ;
"RTN","KMPDUTL2",75,0)
 N H,I,LN,N,O,SITE,TEXT,XMSUB,X,XMTEXT,XMY,XMZ,Y,Z
"RTN","KMPDUTL2",76,0)
 ;
"RTN","KMPDUTL2",77,0)
 S SITE=$$SITE^VASITE
"RTN","KMPDUTL2",78,0)
 S XMSUB=KMPDSUBJ_" at site "_$P(SITE,U,3)_" on "_$$FMTE^XLFDT($$DT^XLFDT)
"RTN","KMPDUTL2",79,0)
 S XMTEXT=KMPDTEXT
"RTN","KMPDUTL2",80,0)
 S XMY(KMPDTO)=""
"RTN","KMPDUTL2",81,0)
 D ^XMD
"RTN","KMPDUTL2",82,0)
 W:'$D(ZTQUEUED) !,"Message #"_$G(XMZ)_" sent..."
"RTN","KMPDUTL2",83,0)
 ;
"RTN","KMPDUTL2",84,0)
 Q
"RTN","KMPDUTL2",85,0)
 ;
"RTN","KMPDUTL2",86,0)
STRSTP(KMPDSS1,KMPDSS2,KMPDSS3,KMPDSTM) ;-- record start/stop times
"RTN","KMPDUTL2",87,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL2",88,0)
 ; KMPDSS1.... Subscript 1 (free text)
"RTN","KMPDUTL2",89,0)
 ; KMPDSS2.... Subscript 2 (free text)
"RTN","KMPDUTL2",90,0)
 ; KMPDSS3.... Subscript 3 (free text)
"RTN","KMPDUTL2",91,0)
 ; KMPDSTM.... Start Time in internal fileman format
"RTN","KMPDUTL2",92,0)
 ;
"RTN","KMPDUTL2",93,0)
 ; This api will calculate END time and DELTA time (END-KMPDSTM) and
"RTN","KMPDUTL2",94,0)
 ; store the results in:
"RTN","KMPDUTL2",95,0)
 ;    ^XTMP("KMPD","BACKGROUND",KMPDSS1,KMPDSS2,KMPDSS3,...)
"RTN","KMPDUTL2",96,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL2",97,0)
 Q:$G(KMPDSS1)=""
"RTN","KMPDUTL2",98,0)
 Q:$G(KMPDSS2)=""
"RTN","KMPDUTL2",99,0)
 Q:$G(KMPDSS3)=""
"RTN","KMPDUTL2",100,0)
 Q:'$G(KMPDSTM)
"RTN","KMPDUTL2",101,0)
 N END S END=$$NOW^XLFDT
"RTN","KMPDUTL2",102,0)
 ; store start time, end time, and delta
"RTN","KMPDUTL2",103,0)
 S ^KMPTMP("KMPD","BACKGROUND",KMPDSS1,KMPDSS2,KMPDSS3,"START")=KMPDSTM
"RTN","KMPDUTL2",104,0)
 S ^KMPTMP("KMPD","BACKGROUND",KMPDSS1,KMPDSS2,KMPDSS3,"END")=END
"RTN","KMPDUTL2",105,0)
 S ^KMPTMP("KMPD","BACKGROUND",KMPDSS1,KMPDSS2,KMPDSS3,"DELTA")=$$FMDIFF^XLFDT(END,KMPDSTM,3)
"RTN","KMPDUTL2",106,0)
 Q
"RTN","KMPDUTL3")
0^18^B2441051
"RTN","KMPDUTL3",1,0)
KMPDUTL3 ;OAK/RAK - CM Tools Utility ;11/4/03  14:26
"RTN","KMPDUTL3",2,0)
 ;;1.0;CM TOOLS;**1,2**;Mar 22, 2002
"RTN","KMPDUTL3",3,0)
 ;
"RTN","KMPDUTL3",4,0)
PURGE(KMPDT) ;-- purge data in file #8973.1
"RTN","KMPDUTL3",5,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL3",6,0)
 ; KMPDT.. Date to begin purge in internal fileman format. Purge will
"RTN","KMPDUTL3",7,0)
 ;           reverse $order and delete entries 'EARLIER' than KMPDT.
"RTN","KMPDUTL3",8,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL3",9,0)
 ;
"RTN","KMPDUTL3",10,0)
 Q:'$G(KMPDT)
"RTN","KMPDUTL3",11,0)
 ;
"RTN","KMPDUTL3",12,0)
 N DA,DATE,DIK,IEN
"RTN","KMPDUTL3",13,0)
 W:'$D(ZTQUEUED) !!,"Purging old records..."
"RTN","KMPDUTL3",14,0)
 S DATE=KMPDT
"RTN","KMPDUTL3",15,0)
 F  S DATE=$O(^KMPD(8973.1,"B",DATE),-1) Q:'DATE!(DATE>KMPDT)  D 
"RTN","KMPDUTL3",16,0)
 .F IEN=0:0 S IEN=$O(^KMPD(8973.1,"B",DATE,IEN)) Q:'IEN  D 
"RTN","KMPDUTL3",17,0)
 ..; quit if not 'sent to cm database'.
"RTN","KMPDUTL3",18,0)
 ..Q:'$P($G(^KMPD(8973.1,IEN,0)),U,2)
"RTN","KMPDUTL3",19,0)
 ..I '$D(ZTQUEUED) W:$X>78 !?16 W "."
"RTN","KMPDUTL3",20,0)
 ..; Delete entry.
"RTN","KMPDUTL3",21,0)
 ..S DA=IEN,DIK="^KMPD(8973.1," D ^DIK
"RTN","KMPDUTL3",22,0)
 ;
"RTN","KMPDUTL3",23,0)
 Q
"RTN","KMPDUTL3",24,0)
 ;
"RTN","KMPDUTL3",25,0)
PURGE1(KMPDAYS) ;-- purge data in file #8973.2
"RTN","KMPDUTL3",26,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL3",27,0)
 ; KMPDAYS.. Number of days to keep in file #8973.2 (CP TIMING).  All
"RTN","KMPDUTL3",28,0)
 ;           entries older than KMPDAYS will be deleted.
"RTN","KMPDUTL3",29,0)
 ;-----------------------------------------------------------------------
"RTN","KMPDUTL3",30,0)
 ;
"RTN","KMPDUTL3",31,0)
 Q:'$G(KMPDAYS)
"RTN","KMPDUTL3",32,0)
 ;
"RTN","KMPDUTL3",33,0)
 N DA,DATE,DIK,IEN,PURGE
"RTN","KMPDUTL3",34,0)
 ;
"RTN","KMPDUTL3",35,0)
 ; determine date to start purge
"RTN","KMPDUTL3",36,0)
 S PURGE=$$FMADD^XLFDT(DT,-KMPDAYS) Q:'PURGE
"RTN","KMPDUTL3",37,0)
 W:'$D(ZTQUEUED) !!,"Purging old records..."
"RTN","KMPDUTL3",38,0)
 S DATE=PURGE-.1
"RTN","KMPDUTL3",39,0)
 F  S DATE=$O(^KMPD(8973.2,"C",DATE),-1) Q:'DATE!(DATE>PURGE)  D 
"RTN","KMPDUTL3",40,0)
 .F IEN=0:0 S IEN=$O(^KMPD(8973.2,"C",DATE,IEN)) Q:'IEN  D 
"RTN","KMPDUTL3",41,0)
 ..Q:'$D(^KMPD(8973.2,IEN,0))
"RTN","KMPDUTL3",42,0)
 ..W:'$D(ZTQUEUED)&('(IEN#10)) "."
"RTN","KMPDUTL3",43,0)
 ..; delete entry.
"RTN","KMPDUTL3",44,0)
 ..S DA=IEN,DIK="^KMPD(8973.2," D ^DIK
"RTN","KMPDUTL3",45,0)
 ;
"RTN","KMPDUTL3",46,0)
 Q
"RTN","KMPDUTL4")
0^8^B6815055
"RTN","KMPDUTL4",1,0)
KMPDUTL4 ;OAK/RAK; Reverse Video Header/Footer ;11/4/03  14:26
"RTN","KMPDUTL4",2,0)
 ;;1.0;CM TOOLS;**1,2**;Mar 22, 2002
"RTN","KMPDUTL4",3,0)
 ;
"RTN","KMPDUTL4",4,0)
CONTINUE(KMPDMSSG,KMPDLN,KMPDY) ;-- press return to continue
"RTN","KMPDUTL4",5,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL4",6,0)
 ; KMPDMSSG. (optional) Message to display to user (if not defined then
"RTN","KMPDUTL4",7,0)
 ;           default message by ^DIR is used).
"RTN","KMPDUTL4",8,0)
 ; KMPDLN... Lines to go down before printing
"RTN","KMPDUTL4",9,0)
 ; KMPDY.... Return value: 0 - do not continue.
"RTN","KMPDUTL4",10,0)
 ;                         1 - continue.
"RTN","KMPDUTL4",11,0)
 ;           Access by reference.
"RTN","KMPDUTL4",12,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL4",13,0)
 ;
"RTN","KMPDUTL4",14,0)
 S KMPDMSSG=$G(KMPDMSSG),KMPDLN=+$G(KMPDLN),KMPDY=0
"RTN","KMPDUTL4",15,0)
 ;
"RTN","KMPDUTL4",16,0)
 ; if not terminal continue without displaying message.
"RTN","KMPDUTL4",17,0)
 I $E(IOST,1,2)'="C-" S KMPDY=1 Q
"RTN","KMPDUTL4",18,0)
 ;
"RTN","KMPDUTL4",19,0)
 N DIR,I,X,Y
"RTN","KMPDUTL4",20,0)
 S DIR(0)="EO"
"RTN","KMPDUTL4",21,0)
 S:KMPDMSSG]"" DIR("A")=KMPDMSSG
"RTN","KMPDUTL4",22,0)
 I KMPDLN F I=1:1:KMPDLN W !
"RTN","KMPDUTL4",23,0)
 D ^DIR
"RTN","KMPDUTL4",24,0)
 S KMPDY=+$G(Y)
"RTN","KMPDUTL4",25,0)
 ;
"RTN","KMPDUTL4",26,0)
 Q
"RTN","KMPDUTL4",27,0)
 ;
"RTN","KMPDUTL4",28,0)
HDR(TITLE1,TITLE2) ;header
"RTN","KMPDUTL4",29,0)
 ;--------------------------------------------------------------------
"RTN","KMPDUTL4",30,0)
 ;  clear screen and print header in reverse video
"RTN","KMPDUTL4",31,0)
 ;
"RTN","KMPDUTL4",32,0)
 ;  if TITLE1 is not defined routine will quit
"RTN","KMPDUTL4",33,0)
 ;--------------------------------------------------------------------
"RTN","KMPDUTL4",34,0)
 S TITLE1=$G(TITLE1),TITLE2=$G(TITLE2) Q:TITLE1']""
"RTN","KMPDUTL4",35,0)
 I $G(IORVON)']""!($G(IORVOFF)']"") N IORVON,IORVOFF,X D 
"RTN","KMPDUTL4",36,0)
 .S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","KMPDUTL4",37,0)
 S TITLE1=IORVON_" "_TITLE1_" "_IORVOFF
"RTN","KMPDUTL4",38,0)
 I TITLE2]"" S TITLE2=IORVON_" "_TITLE2_" "_IORVOFF
"RTN","KMPDUTL4",39,0)
 W @IOF
"RTN","KMPDUTL4",40,0)
 W !?(IOM-$L(TITLE1)/2),TITLE1
"RTN","KMPDUTL4",41,0)
 I TITLE2]"" W !?(IOM-$L(TITLE2)/2),TITLE2
"RTN","KMPDUTL4",42,0)
 Q
"RTN","KMPDUTL4",43,0)
FTR(FOOTER,VALUE) ;print footer
"RTN","KMPDUTL4",44,0)
 ;--------------------------------------------------------------------
"RTN","KMPDUTL4",45,0)
 ;  line feed to IOSL-3 and place message on screen
"RTN","KMPDUTL4",46,0)
 ;  if IOSL or IOM are not defined routine will quit
"RTN","KMPDUTL4",47,0)
 ;
"RTN","KMPDUTL4",48,0)
 ;  FOOTER - text to appear at the bottom of the screen
"RTN","KMPDUTL4",49,0)
 ;           if footer is not defined then the message
"RTN","KMPDUTL4",50,0)
 ;           'Press RETURN to continue, '^' to exit'   will appear
"RTN","KMPDUTL4",51,0)
 ;
"RTN","KMPDUTL4",52,0)
 ;  footer appears in the middle of the screen
"RTN","KMPDUTL4",53,0)
 ;
"RTN","KMPDUTL4",54,0)
 ;  VALUE - value returned:
"RTN","KMPDUTL4",55,0)
 ;          "" - if IOSL or IOM are not defined
"RTN","KMPDUTL4",56,0)
 ;           0 - if an uparrow '^' is entered
"RTN","KMPDUTL4",57,0)
 ;           1 - if return is entered
"RTN","KMPDUTL4",58,0)
 ;
"RTN","KMPDUTL4",59,0)
 S VALUE="" I '$G(IOSL)!('$G(IOM)) Q
"RTN","KMPDUTL4",60,0)
 N DIR,I,X,Y
"RTN","KMPDUTL4",61,0)
 I $G(FOOTER)']""  S FOOTER="Press RETURN to continue, '^' to exit"
"RTN","KMPDUTL4",62,0)
 I $G(IORVON)']""!($G(IORVOFF)']"") N IORVON,IORVOFF,X D 
"RTN","KMPDUTL4",63,0)
 .S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","KMPDUTL4",64,0)
 S FOOTER=IORVON_" "_FOOTER_" "_IORVOFF
"RTN","KMPDUTL4",65,0)
 S DIR(0)="EA",DIR("A")=$J(" ",(IOM-$L(FOOTER)/2))_FOOTER
"RTN","KMPDUTL4",66,0)
 F I=$Y:1:(IOSL-3) W !
"RTN","KMPDUTL4",67,0)
 D ^DIR S VALUE=Y
"RTN","KMPDUTL4",68,0)
 Q
"RTN","KMPDUTL4",69,0)
 ;
"RTN","KMPDUTL4",70,0)
PTNPSEL() ;-- extrinsic function - select prime time, non-prime time or both
"RTN","KMPDUTL4",71,0)
 ;----------------------------------------------------------------------
"RTN","KMPDUTL4",72,0)
 ; Return: 1^Prime Time
"RTN","KMPDUTL4",73,0)
 ;         2^Non-Prime Time
"RTN","KMPDUTL4",74,0)
 ;         3^Both Prime Time & Non-Prime Time
"RTN","KMPDUTL4",75,0)
 ;         "" - no selection made
"RTN","KMPDUTL4",76,0)
 ;----------------------------------------------------------------------
"RTN","KMPDUTL4",77,0)
 N DIR,X,Y
"RTN","KMPDUTL4",78,0)
 S DIR(0)="SO^1:Prime Time;2:Non-Prime Time"
"RTN","KMPDUTL4",79,0)
 S DIR("A")="Select Time Frame",DIR("B")=1
"RTN","KMPDUTL4",80,0)
 S DIR("?",1)="Select one of the following:"
"RTN","KMPDUTL4",81,0)
 S DIR("?",2)=""
"RTN","KMPDUTL4",82,0)
 S DIR("?",3)="      PRIME TIME => Weekdays 8 am till 5 pm"
"RTN","KMPDUTL4",83,0)
 S DIR("?",4)="        - or -"
"RTN","KMPDUTL4",84,0)
 S DIR("?",5)="  NON-PRIME TIME => Weekdays after 5 pm and before 8 am"
"RTN","KMPDUTL4",85,0)
 S DIR("?")="                    and Weekends all day"
"RTN","KMPDUTL4",86,0)
 D ^DIR
"RTN","KMPDUTL4",87,0)
 Q:$G(Y)=""!($G(Y)="^") ""
"RTN","KMPDUTL4",88,0)
 Q $S(Y:Y_"^"_$G(Y(0)),1:Y)
"RTN","KMPDUTL5")
0^15^B32139053
"RTN","KMPDUTL5",1,0)
KMPDUTL5 ;OIFO/KAK - Obtain CPU Configuration;28 Feb 2002 ;11/4/03  14:27
"RTN","KMPDUTL5",2,0)
 ;;1.0;CM TOOLS;**2**;Mar 22, 2002
"RTN","KMPDUTL5",3,0)
 ;;
"RTN","KMPDUTL5",4,0)
CPU(ARRAY) ;-- get cpu configuration information
"RTN","KMPDUTL5",5,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",6,0)
 ; ARRAY = passed back by reference
"RTN","KMPDUTL5",7,0)
 ; returns array with CPU information:
"RTN","KMPDUTL5",8,0)
 ;                          piece : information
"RTN","KMPDUTL5",9,0)
 ;       ARRAY(nodename) =    1   : type of cpu
"RTN","KMPDUTL5",10,0)
 ;                            2   : number of processors
"RTN","KMPDUTL5",11,0)
 ;                            3   : processor speed
"RTN","KMPDUTL5",12,0)
 ;                            4   : amount of memory
"RTN","KMPDUTL5",13,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",14,0)
 ;
"RTN","KMPDUTL5",15,0)
 N ZV
"RTN","KMPDUTL5",16,0)
 ;
"RTN","KMPDUTL5",17,0)
 S ZV=$$MPLTF^KMPDUTL1
"RTN","KMPDUTL5",18,0)
 ;
"RTN","KMPDUTL5",19,0)
 S U="^"
"RTN","KMPDUTL5",20,0)
 I (ZV["DSM") D DSM(.ARRAY)
"RTN","KMPDUTL5",21,0)
 I (ZV["CVMS") D CVMS(.ARRAY,1)
"RTN","KMPDUTL5",22,0)
 I (ZV["CWINNT") D CWINNT(.ARRAY)
"RTN","KMPDUTL5",23,0)
 Q
"RTN","KMPDUTL5",24,0)
 ;
"RTN","KMPDUTL5",25,0)
DSM(CPUINFO) ;-- for DSM Platform
"RTN","KMPDUTL5",26,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",27,0)
 ; CPUINFO = array passed back by reference - see CPU(ARRAY) above
"RTN","KMPDUTL5",28,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",29,0)
 ;
"RTN","KMPDUTL5",30,0)
 N CLSTRMEM,CSID,CSIDARRY,NODE,NODEARRY,X
"RTN","KMPDUTL5",31,0)
 ;
"RTN","KMPDUTL5",32,0)
 S CLSTRMEM=$ZC(%GETSYI,"CLUSTER_MEMBER")
"RTN","KMPDUTL5",33,0)
 ;
"RTN","KMPDUTL5",34,0)
 ; not in cluster environment
"RTN","KMPDUTL5",35,0)
 I 'CLSTRMEM D  Q
"RTN","KMPDUTL5",36,0)
 .S NODE=$ZC(%GETSYI,"NODENAME")
"RTN","KMPDUTL5",37,0)
 .S CPUINFO(NODE)=$ZC(%GETSYI,"HW_NAME")_U_$ZC(%GETSYI,"ACTIVECPU_CNT")
"RTN","KMPDUTL5",38,0)
 ;
"RTN","KMPDUTL5",39,0)
 ; in cluster environment
"RTN","KMPDUTL5",40,0)
 D CLSTR
"RTN","KMPDUTL5",41,0)
 S X="ERR^ZU",@^%ZOSF("TRAP")
"RTN","KMPDUTL5",42,0)
 S NODE=""
"RTN","KMPDUTL5",43,0)
 F  S NODE=$O(NODEARRY(NODE)) Q:NODE=""  D
"RTN","KMPDUTL5",44,0)
 .S CSID=NODEARRY(NODE)
"RTN","KMPDUTL5",45,0)
 .S CPUINFO(NODE)=$ZC(%GETSYI,"HW_NAME",CSID)_U_$ZC(%GETSYI,"ACTIVECPU_CNT",CSID)
"RTN","KMPDUTL5",46,0)
 Q
"RTN","KMPDUTL5",47,0)
CLSTR ; get %GETSYI using wild card to get CSID and NODENAME for all nodes
"RTN","KMPDUTL5",48,0)
 ;
"RTN","KMPDUTL5",49,0)
 N X
"RTN","KMPDUTL5",50,0)
 S X="ERRCLU^KMPDUTL5",@^%ZOSF("TRAP"),$ZE=""
"RTN","KMPDUTL5",51,0)
 S CSIDARRY($ZC(%GETSYI,"NODE_CSID",-1))=""
"RTN","KMPDUTL5",52,0)
 F  S CSIDARRY($ZC(%GETSYI,"NODE_CSID",""))=""
"RTN","KMPDUTL5",53,0)
ERRCLU I $ZE'["NOMORENODE" ZQ
"RTN","KMPDUTL5",54,0)
 N CSID
"RTN","KMPDUTL5",55,0)
 S CSID=""
"RTN","KMPDUTL5",56,0)
 F  S CSID=$O(CSIDARRY(CSID)) Q:CSID=""  S NODEARRY($ZC(%GETSYI,"NODENAME",CSID))=CSID
"RTN","KMPDUTL5",57,0)
 Q
"RTN","KMPDUTL5",58,0)
 ;
"RTN","KMPDUTL5",59,0)
CVMS(CPUINFO,TYP) ;-- for Cache for OpenVMS Platform
"RTN","KMPDUTL5",60,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",61,0)
 ; input: TYP = type of system information requested
"RTN","KMPDUTL5",62,0)
 ;                1 : cpu system information
"RTN","KMPDUTL5",63,0)
 ;                2 : operating system version information
"RTN","KMPDUTL5",64,0)
 ;
"RTN","KMPDUTL5",65,0)
 ; CPUINFO = array passed back by reference
"RTN","KMPDUTL5",66,0)
 ;           : for TYP=1 see CPU(ARRAY) line tag above
"RTN","KMPDUTL5",67,0)
 ;           : for TYP=2 CPUINFO(1)=os version
"RTN","KMPDUTL5",68,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",69,0)
 ;
"RTN","KMPDUTL5",70,0)
 N DIR,FILE,LOG,TYPNM
"RTN","KMPDUTL5",71,0)
 ;
"RTN","KMPDUTL5",72,0)
 S TYPNM=$S(TYP=1:"CPU",TYP=2:"VER",1:"")
"RTN","KMPDUTL5",73,0)
 ;
"RTN","KMPDUTL5",74,0)
 S DIR=$ZU(12)
"RTN","KMPDUTL5",75,0)
 ;
"RTN","KMPDUTL5",76,0)
 ; cleanup log file
"RTN","KMPDUTL5",77,0)
 S LOG=DIR_"KMPDU"_TYPNM_".LOG"
"RTN","KMPDUTL5",78,0)
 O LOG:("R"):0 C LOG:("D")
"RTN","KMPDUTL5",79,0)
 ;
"RTN","KMPDUTL5",80,0)
 ; cleanup com file
"RTN","KMPDUTL5",81,0)
 S FILE=DIR_"KMPDU"_TYPNM_".COM"
"RTN","KMPDUTL5",82,0)
 O FILE:("R"):0 C FILE:("D")
"RTN","KMPDUTL5",83,0)
 ;
"RTN","KMPDUTL5",84,0)
 ; create com file   quit on file creation error
"RTN","KMPDUTL5",85,0)
 Q:$$CREATE(FILE,TYP)<0
"RTN","KMPDUTL5",86,0)
 ;
"RTN","KMPDUTL5",87,0)
 ; run com file and create log file
"RTN","KMPDUTL5",88,0)
 I $ZF(-1,"",LOG,FILE)
"RTN","KMPDUTL5",89,0)
 C LOG
"RTN","KMPDUTL5",90,0)
 ;
"RTN","KMPDUTL5",91,0)
 ; parse log file
"RTN","KMPDUTL5",92,0)
 D PARSE(LOG,.CPUINFO,TYP)
"RTN","KMPDUTL5",93,0)
 ;
"RTN","KMPDUTL5",94,0)
 ; cleanup com file
"RTN","KMPDUTL5",95,0)
 O FILE:("R"):0 C FILE:("D")
"RTN","KMPDUTL5",96,0)
 ; cleanup log file
"RTN","KMPDUTL5",97,0)
 O LOG:("R"):0 C LOG:("D")
"RTN","KMPDUTL5",98,0)
 ;
"RTN","KMPDUTL5",99,0)
 Q
"RTN","KMPDUTL5",100,0)
 ;
"RTN","KMPDUTL5",101,0)
CWINNT(CPUINFO) ;-- for Cache for Windows NT Platform
"RTN","KMPDUTL5",102,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",103,0)
 ; CPUINFO = array passed back by reference
"RTN","KMPDUTL5",104,0)
 ;           : see CPU(ARRAY) line tag above
"RTN","KMPDUTL5",105,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",106,0)
 ;
"RTN","KMPDUTL5",107,0)
 N NODE
"RTN","KMPDUTL5",108,0)
 ;
"RTN","KMPDUTL5",109,0)
 S NODE=""
"RTN","KMPDUTL5",110,0)
 F  S NODE=$ZU(63,2,NODE) Q:NODE=""  S CPUINFO(NODE)=""
"RTN","KMPDUTL5",111,0)
 Q
"RTN","KMPDUTL5",112,0)
 ;
"RTN","KMPDUTL5",113,0)
CREATE(FILE,TYP) ;-- function to create new com file
"RTN","KMPDUTL5",114,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",115,0)
 ; input: FILE = name of file to create
"RTN","KMPDUTL5",116,0)
 ;        TYP  = type of system information requested
"RTN","KMPDUTL5",117,0)
 ;                 1 : cpu system information
"RTN","KMPDUTL5",118,0)
 ;                 2 : operating system version information
"RTN","KMPDUTL5",119,0)
 ;
"RTN","KMPDUTL5",120,0)
 ; returns:  1 successful file creation
"RTN","KMPDUTL5",121,0)
 ;          -1 failure of file creation
"RTN","KMPDUTL5",122,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",123,0)
 ;
"RTN","KMPDUTL5",124,0)
 N DIR,TYPNM
"RTN","KMPDUTL5",125,0)
 ;
"RTN","KMPDUTL5",126,0)
 S TYPNM=$S(TYP=1:"CPU",TYP=2:"VER",1:"")
"RTN","KMPDUTL5",127,0)
 ;
"RTN","KMPDUTL5",128,0)
 O FILE:("NWC"):0 Q:'$T -1
"RTN","KMPDUTL5",129,0)
 ;
"RTN","KMPDUTL5",130,0)
 U FILE
"RTN","KMPDUTL5",131,0)
 W "$! KMPDU"_TYPNM_".COM - Obtain System Configuration Information"
"RTN","KMPDUTL5",132,0)
 W "$!--------------------------------------------------------"
"RTN","KMPDUTL5",133,0)
 W "$! OIFO - CAPACITY PLANNING/KAK"
"RTN","KMPDUTL5",134,0)
 W "$! "_$P($T(+2)_";;",2,999)
"RTN","KMPDUTL5",135,0)
 W "$!--------------------------------------------------------"
"RTN","KMPDUTL5",136,0)
 W "$!"
"RTN","KMPDUTL5",137,0)
 ;
"RTN","KMPDUTL5",138,0)
 I TYP=2 D  G TAGXIT
"RTN","KMPDUTL5",139,0)
 .W "$   write sys$output ""VERSION=""   , f$getsyi(""VERSION"")"
"RTN","KMPDUTL5",140,0)
 ;
"RTN","KMPDUTL5",141,0)
 W "$ if f$getsyi(""CLUSTER_MEMBER"") .eqs. ""FALSE"" then goto NOT_CLUSTER"
"RTN","KMPDUTL5",142,0)
 W "$ CONTEXT = """""
"RTN","KMPDUTL5",143,0)
 W "$START:"
"RTN","KMPDUTL5",144,0)
 W "$   ID = f$csid(CONTEXT)"
"RTN","KMPDUTL5",145,0)
 W "$   if ID .eqs. """" then goto EXIT"
"RTN","KMPDUTL5",146,0)
 W "$   write sys$output ""NODE=""    , f$getsyi(""NODENAME"",,ID)"
"RTN","KMPDUTL5",147,0)
 W "$   write sys$output ""TYPE=""    , f$getsyi(""HW_NAME"",,ID)"
"RTN","KMPDUTL5",148,0)
 W "$   write sys$output ""CPU_CNT="" , f$getsyi(""ACTIVECPU_CNT"",,ID)" 
"RTN","KMPDUTL5",149,0)
 W "$   write sys$output ""SPEED=n/a"""
"RTN","KMPDUTL5",150,0)
 W "$   write sys$output ""MEMSIZE="" , f$getsyi(""MEMSIZE"",,ID)"
"RTN","KMPDUTL5",151,0)
 W "$   goto START"
"RTN","KMPDUTL5",152,0)
 W "$NOT_CLUSTER:"
"RTN","KMPDUTL5",153,0)
 W "$   write sys$output ""NODE=""    , f$getsyi(""NODENAME"")"
"RTN","KMPDUTL5",154,0)
 W "$   write sys$output ""TYPE=""    , f$getsyi(""HW_NAME"")"
"RTN","KMPDUTL5",155,0)
 W "$   write sys$output ""CPU_CNT="" , f$getsyi(""ACTIVECPU_CNT"")"
"RTN","KMPDUTL5",156,0)
 W "$   write sys$output ""SPEED=n/a"""
"RTN","KMPDUTL5",157,0)
 W "$   write sys$output ""MEMSIZE="" , f$getsyi(""MEMSIZE"")"
"RTN","KMPDUTL5",158,0)
TAGXIT ;
"RTN","KMPDUTL5",159,0)
 W "$EXIT:"
"RTN","KMPDUTL5",160,0)
 W "$   write sys$output ""*EOF*"""
"RTN","KMPDUTL5",161,0)
 W "$ exit"
"RTN","KMPDUTL5",162,0)
 W "$!"
"RTN","KMPDUTL5",163,0)
 ;
"RTN","KMPDUTL5",164,0)
 C FILE
"RTN","KMPDUTL5",165,0)
 Q 1
"RTN","KMPDUTL5",166,0)
 ;
"RTN","KMPDUTL5",167,0)
PARSE(LOG,CPUARRY,TYP) ;-- parse log file data
"RTN","KMPDUTL5",168,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",169,0)
 ; input: LOG = name of log file to parse
"RTN","KMPDUTL5",170,0)
 ;        TYP = type of system information requested
"RTN","KMPDUTL5",171,0)
 ;                1 : cpu system information
"RTN","KMPDUTL5",172,0)
 ;                2 : operating system version information
"RTN","KMPDUTL5",173,0)
 ;
"RTN","KMPDUTL5",174,0)
 ; CPUARRY = passed back by reference
"RTN","KMPDUTL5",175,0)
 ;           : for TYP=1 see CPU(ARRAY) line tag above
"RTN","KMPDUTL5",176,0)
 ;           : for TYP=2 CPUINFO(1)=os version
"RTN","KMPDUTL5",177,0)
 ;---------------------------------------------------------------------
"RTN","KMPDUTL5",178,0)
 ;
"RTN","KMPDUTL5",179,0)
 N NODE,X
"RTN","KMPDUTL5",180,0)
 ;
"RTN","KMPDUTL5",181,0)
 S X="EOF",@^%ZOSF("TRAP"),NODE=""
"RTN","KMPDUTL5",182,0)
 K X S U="^"
"RTN","KMPDUTL5",183,0)
 ;
"RTN","KMPDUTL5",184,0)
 O LOG:("R")
"RTN","KMPDUTL5",185,0)
 U LOG
"RTN","KMPDUTL5",186,0)
 ;
"RTN","KMPDUTL5",187,0)
 I TYP=1 D
"RTN","KMPDUTL5",188,0)
 .F  R X Q:X["*EOF*"  I $E(X)'="$" I X["NODE=" D
"RTN","KMPDUTL5",189,0)
 ..I X["NODE=" S NODE=$P(X,"=",2)
"RTN","KMPDUTL5",190,0)
 ..F  R X  I $E(X)'="$" D  Q:X["MEMSIZE="
"RTN","KMPDUTL5",191,0)
 ...; type of cpu
"RTN","KMPDUTL5",192,0)
 ...I X["TYPE=" S $P(CPUARRY(NODE),U)=$P(X,"=",2) Q
"RTN","KMPDUTL5",193,0)
 ...; number of processors
"RTN","KMPDUTL5",194,0)
 ...I X["CPU_CNT=" S $P(CPUARRY(NODE),U,2)=$P(X,"=",2) Q
"RTN","KMPDUTL5",195,0)
 ...; processor speed - no information available
"RTN","KMPDUTL5",196,0)
 ...I X["SPEED=" Q
"RTN","KMPDUTL5",197,0)
 ...; amount of memory in MB
"RTN","KMPDUTL5",198,0)
 ...I X["MEMSIZE=" S $P(CPUARRY(NODE),U,4)=$P(X,"=",2)/128 Q
"RTN","KMPDUTL5",199,0)
 ;
"RTN","KMPDUTL5",200,0)
 I TYP=2 D
"RTN","KMPDUTL5",201,0)
 .F  R X Q:X["*EOF*"  I $E(X)'="$" D
"RTN","KMPDUTL5",202,0)
 ..; version of operating system
"RTN","KMPDUTL5",203,0)
 ..I X["VERSION=" S CPUARRY(1)=$P(X,"=",2) Q
"RTN","KMPDUTL5",204,0)
 ;
"RTN","KMPDUTL5",205,0)
 C LOG
"RTN","KMPDUTL5",206,0)
 ;
"RTN","KMPDUTL5",207,0)
 S X="ERR^ZU",@^%ZOSF("TRAP")
"RTN","KMPDUTL5",208,0)
 Q
"RTN","KMPDUTL5",209,0)
 ;
"RTN","KMPDUTL5",210,0)
EOF ;-- end of file condition
"RTN","KMPDUTL5",211,0)
 S X="ERR^ZU",@^%ZOSF("TRAP")
"RTN","KMPDUTL5",212,0)
 C LOG
"RTN","KMPDUTL5",213,0)
 Q
"RTN","KMPDUTL5",214,0)
 ;
"RTN","KMPDUTL5",215,0)
CVMSVER() ;-- returns version of Cache for OpenVMS operating system
"RTN","KMPDUTL5",216,0)
 ;
"RTN","KMPDUTL5",217,0)
 N VER
"RTN","KMPDUTL5",218,0)
 ;
"RTN","KMPDUTL5",219,0)
 D CVMS(.VER,2)
"RTN","KMPDUTL5",220,0)
 Q VER(1)
"RTN","KMPDUTL5",221,0)
 ;
"SEC","^DIC",8973.2,8973.2,0,"AUDIT")
@
"SEC","^DIC",8973.2,8973.2,0,"DD")
@
"SEC","^DIC",8973.2,8973.2,0,"DEL")
@
"SEC","^DIC",8973.2,8973.2,0,"LAYGO")
@
"SEC","^DIC",8973.2,8973.2,0,"RD")
@
"SEC","^DIC",8973.2,8973.2,0,"WR")
@
"VER")
8.0^22.0
"^DD",8973.2,8973.2,0)
FIELD^^.09^9
"^DD",8973.2,8973.2,0,"DT")
3030718
"^DD",8973.2,8973.2,0,"ID","W")
D:$G(Y) ID1^KMPDUT2(Y)
"^DD",8973.2,8973.2,0,"IX","ANEWPER",8973.2,.05)

"^DD",8973.2,8973.2,0,"IX","ASSCLDTTM",8973.2,.07)

"^DD",8973.2,8973.2,0,"IX","ASSDTPT",8973.2,.07)

"^DD",8973.2,8973.2,0,"IX","ASSDTTM",8973.2,.07)

"^DD",8973.2,8973.2,0,"IX","ASSIPDTTM",8973.2,.07)

"^DD",8973.2,8973.2,0,"IX","ASSNPDTTM",8973.2,.07)

"^DD",8973.2,8973.2,0,"IX","ASTDTTM",8973.2,.03)

"^DD",8973.2,8973.2,0,"IX","ASVDTSS",8973.2,.07)

"^DD",8973.2,8973.2,0,"IX","ATITLE",8973.2,.08)

"^DD",8973.2,8973.2,0,"IX","ATMPSS",8973.2,.07)

"^DD",8973.2,8973.2,0,"IX","B",8973.2,.01)

"^DD",8973.2,8973.2,0,"IX","C",8973.2,.03)

"^DD",8973.2,8973.2,0,"NM","CP TIMING")

"^DD",8973.2,8973.2,0,"VRPK")
KMPD
"^DD",8973.2,8973.2,.01,0)
IDENTIFIER^RF^^0;1^K:$L(X)>40!($L(X)<3)!'(X'?1P.E) X
"^DD",8973.2,8973.2,.01,1,0)
^.1
"^DD",8973.2,8973.2,.01,1,1,0)
8973.2^B
"^DD",8973.2,8973.2,.01,1,1,1)
S ^KMPD(8973.2,"B",$E(X,1,40),DA)=""
"^DD",8973.2,8973.2,.01,1,1,2)
K ^KMPD(8973.2,"B",$E(X,1,40),DA)
"^DD",8973.2,8973.2,.01,3)
Answer must be 3-40 characters in length
"^DD",8973.2,8973.2,.01,"DT")
3030715
"^DD",8973.2,8973.2,.02,0)
SENT TO NATIONAL DATABASE^S^0:NO;1:YES;^0;2^Q
"^DD",8973.2,8973.2,.02,"DT")
3030715
"^DD",8973.2,8973.2,.03,0)
SERVER START DATE/TIME^D^^0;3^S %DT="EST" D ^%DT S X=Y K:X<1 X
"^DD",8973.2,8973.2,.03,1,0)
^.1
"^DD",8973.2,8973.2,.03,1,1,0)
8973.2^ASTDTTM
"^DD",8973.2,8973.2,.03,1,1,1)
S ^KMPD(8973.2,"ASTDTTM",$E(X,1,30),DA)=""
"^DD",8973.2,8973.2,.03,1,1,2)
K ^KMPD(8973.2,"ASTDTTM",$E(X,1,30),DA)
"^DD",8973.2,8973.2,.03,1,1,"%D",0)
^^1^1^3030715^
"^DD",8973.2,8973.2,.03,1,1,"%D",1,0)
^KMPD(8973.2,"ASTDTTM",StartDateTime,X)=""
"^DD",8973.2,8973.2,.03,1,1,"DT")
3030715
"^DD",8973.2,8973.2,.03,1,2,0)
8973.2^C
"^DD",8973.2,8973.2,.03,1,2,1)
S ^KMPD(8973.2,"C",$E(X,1,30),DA)=""
"^DD",8973.2,8973.2,.03,1,2,2)
K ^KMPD(8973.2,"C",$E(X,1,30),DA)
"^DD",8973.2,8973.2,.03,1,2,"DT")
3030805
"^DD",8973.2,8973.2,.03,3)
(No range limit on date)
"^DD",8973.2,8973.2,.03,"DT")
3030805
"^DD",8973.2,8973.2,.04,0)
SERVER DELTA^F^^0;4^K:$L(X)>15!($L(X)<1) X
"^DD",8973.2,8973.2,.04,3)
Answer must be 1-15 characters in length
"^DD",8973.2,8973.2,.04,"DT")
3030718
"^DD",8973.2,8973.2,.05,0)
NEW PERSON^P200'^VA(200,^0;5^Q
"^DD",8973.2,8973.2,.05,1,0)
^.1
"^DD",8973.2,8973.2,.05,1,1,0)
8973.2^ANEWPER
"^DD",8973.2,8973.2,.05,1,1,1)
S ^KMPD(8973.2,"ANEWPER",$E(X,1,30),DA)=""
"^DD",8973.2,8973.2,.05,1,1,2)
K ^KMPD(8973.2,"ANEWPER",$E(X,1,30),DA)
"^DD",8973.2,8973.2,.05,1,1,"%D",0)
^^1^1^3030715^
"^DD",8973.2,8973.2,.05,1,1,"%D",1,0)
^KMPD(8973.2,"ANEWPER",NewPerson,X)=""
"^DD",8973.2,8973.2,.05,1,1,"DT")
3030715
"^DD",8973.2,8973.2,.05,"DT")
3030715
"^DD",8973.2,8973.2,.06,0)
CLIENT NAME^F^^0;6^K:$L(X)>40!($L(X)<1) X
"^DD",8973.2,8973.2,.06,1,0)
^.1^^0
"^DD",8973.2,8973.2,.06,3)
Answer must be 1-40 characters in length
"^DD",8973.2,8973.2,.06,"DT")
3030826
"^DD",8973.2,8973.2,.07,0)
KMPTMP SUBSCRIPT^F^^0;7^K:$L(X)>12!($L(X)<1) X
"^DD",8973.2,8973.2,.07,1,0)
^.1
"^DD",8973.2,8973.2,.07,1,1,0)
8973.2^ATMPSS
"^DD",8973.2,8973.2,.07,1,1,1)
S ^KMPD(8973.2,"ATMPSS",$E(X,1,30),DA)=""
"^DD",8973.2,8973.2,.07,1,1,2)
K ^KMPD(8973.2,"ATMPSS",$E(X,1,30),DA)
"^DD",8973.2,8973.2,.07,1,1,"%D",0)
^^1^1^3030715^
"^DD",8973.2,8973.2,.07,1,1,"%D",1,0)
^KMPD(8973.2,"ATMPSS",KmptmpSubscript,X)=""
"^DD",8973.2,8973.2,.07,1,1,"DT")
3030715
"^DD",8973.2,8973.2,.07,1,2,0)
8973.2^ASVDTSS^MUMPS
"^DD",8973.2,8973.2,.07,1,2,1)
D XREFT1^KMPDUT2($G(DA),$G(X),1)
"^DD",8973.2,8973.2,.07,1,2,2)
D XREFT1^KMPDUT2($G(DA),$G(X),2)
"^DD",8973.2,8973.2,.07,1,2,"%D",0)
^^1^1^3030722^
"^DD",8973.2,8973.2,.07,1,2,"%D",1,0)
^KMPD(8973.2,"ASVDTSS",KmptmpSubscript,ServerDate,Ien)=""
"^DD",8973.2,8973.2,.07,1,2,"DT")
3030722
"^DD",8973.2,8973.2,.07,1,3,0)
8973.2^ASSDTPT^MUMPS
"^DD",8973.2,8973.2,.07,1,3,1)
D XREFT2^KMPDUT2($G(DA),$G(X),1)
"^DD",8973.2,8973.2,.07,1,3,2)
D XREFT2^KMPDUT2($G(DA),$G(X),2)
"^DD",8973.2,8973.2,.07,1,3,"%D",0)
^^1^1^3030723^
"^DD",8973.2,8973.2,.07,1,3,"%D",1,0)
^KMPD(8973.2,"ASSDTPT",KmptmpSubscript,ServerDateTime,PrimeTime,DA)=""
"^DD",8973.2,8973.2,.07,1,3,"DT")
3030723
"^DD",8973.2,8973.2,.07,1,4,0)
8973.2^ASSDTTM^MUMPS
"^DD",8973.2,8973.2,.07,1,4,1)
D XREFT3^KMPDUT2($G(DA),$G(X),1)
"^DD",8973.2,8973.2,.07,1,4,2)
D XREFT3^KMPDUT2($G(DA),$G(X),2)
"^DD",8973.2,8973.2,.07,1,4,"%D",0)
^^1^1^3030813^
"^DD",8973.2,8973.2,.07,1,4,"%D",1,0)
^KMPD(8973.2,"ASSDTTM",KmptmpSusbscript,ServerDateTime,Ien)=""
"^DD",8973.2,8973.2,.07,1,4,"DT")
3030813
"^DD",8973.2,8973.2,.07,1,5,0)
8973.2^ASSCLDTTM^MUMPS
"^DD",8973.2,8973.2,.07,1,5,1)
D XREFT4^KMPDUT2($G(DA),$G(X),1)
"^DD",8973.2,8973.2,.07,1,5,2)
D XREFT4^KMPDUT2($G(DA),$G(X),2)
"^DD",8973.2,8973.2,.07,1,5,"%D",0)
^^1^1^3030826^
"^DD",8973.2,8973.2,.07,1,5,"%D",1,0)
S ^KMPD(8973.2,"ASSCLDTTM",KmptmpSubscript,ClientName,ServerDateTime,DA)
"^DD",8973.2,8973.2,.07,1,5,"DT")
3030826
"^DD",8973.2,8973.2,.07,1,6,0)
8973.2^ASSNPDTTM^MUMPS
"^DD",8973.2,8973.2,.07,1,6,1)
D XREFT5^KMPDUT2($G(DA),$G(X),1)
"^DD",8973.2,8973.2,.07,1,6,2)
D XREFT5^KMPDUT2($G(DA),$G(X),2)
"^DD",8973.2,8973.2,.07,1,6,"%D",0)
^^1^1^3030828^
"^DD",8973.2,8973.2,.07,1,6,"%D",1,0)
^KMPD(8973.2,"ASSNPDTTM",KmptmpSubscript,NewPerson,ServerDateTime,DA)=""
"^DD",8973.2,8973.2,.07,1,6,"DT")
3030828
"^DD",8973.2,8973.2,.07,1,7,0)
8973.2^ASSIPDTTM^MUMPS
"^DD",8973.2,8973.2,.07,1,7,1)
D XREFT6^KMPDUT2($G(DA),$G(X),1)
"^DD",8973.2,8973.2,.07,1,7,2)
D XREFT6^KMPDUT2($G(DA),$G(X),2)
"^DD",8973.2,8973.2,.07,1,7,"%D",0)
^^1^1^3030828^
"^DD",8973.2,8973.2,.07,1,7,"%D",1,0)
^KMPD(8973.2,"ASSIPDTTM",KmptmpSubscript,IpAddress,ServerDateTime,DA)=""
"^DD",8973.2,8973.2,.07,1,7,"DT")
3030828
"^DD",8973.2,8973.2,.07,3)
Answer must be 1-12 characters in length
"^DD",8973.2,8973.2,.07,"DT")
3030828
"^DD",8973.2,8973.2,.08,0)
TITLE^F^^0;8^K:$L(X)>30!($L(X)<1) X
"^DD",8973.2,8973.2,.08,1,0)
^.1
"^DD",8973.2,8973.2,.08,1,1,0)
8973.2^ATITLE
"^DD",8973.2,8973.2,.08,1,1,1)
S ^KMPD(8973.2,"ATITLE",$E(X,1,30),DA)=""
"^DD",8973.2,8973.2,.08,1,1,2)
K ^KMPD(8973.2,"ATITLE",$E(X,1,30),DA)
"^DD",8973.2,8973.2,.08,1,1,"%D",0)
^^1^1^3030715^
"^DD",8973.2,8973.2,.08,1,1,"%D",1,0)
^KMPD(8973.2,"ATITLE",Title,X)=""
"^DD",8973.2,8973.2,.08,1,1,"DT")
3030715
"^DD",8973.2,8973.2,.08,3)
Answer must be 1-30 characters in length
"^DD",8973.2,8973.2,.08,"DT")
3030715
"^DD",8973.2,8973.2,.09,0)
IP ADDRESS^F^^0;9^K:$L(X)>15!($L(X)<1) X
"^DD",8973.2,8973.2,.09,3)
Answer must be 1-15 characters in length
"^DD",8973.2,8973.2,.09,"DT")
3030716
"^DIC",8973.2,8973.2,0)
CP TIMING^8973.2
"^DIC",8973.2,8973.2,0,"GL")
^KMPD(8973.2,
"^DIC",8973.2,8973.2,"%",0)
^1.005^^0
"^DIC",8973.2,"B","CP TIMING",8973.2)

**END**
**END**
