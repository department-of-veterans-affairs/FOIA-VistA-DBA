Released SD*5.3*367 SEQ #388
Extracted from mail message
**KIDS**:SD*5.3*367^

**INSTALL NAME**
SD*5.3*367
"BLD",5538,0)
SD*5.3*367^SCHEDULING^0^3060615^y
"BLD",5538,1,0)
^^2^2^3040503^
"BLD",5538,1,1,0)
This patch will prevent multiple instances of the PCMM HL7 TRANSMISSION 
"BLD",5538,1,2,0)
from occurring.
"BLD",5538,4,0)
^9.64PA^^
"BLD",5538,"ABPKG")
n
"BLD",5538,"KRN",0)
^9.67PA^8989.52^19
"BLD",5538,"KRN",.4,0)
.4
"BLD",5538,"KRN",.401,0)
.401
"BLD",5538,"KRN",.402,0)
.402
"BLD",5538,"KRN",.403,0)
.403
"BLD",5538,"KRN",.5,0)
.5
"BLD",5538,"KRN",.84,0)
.84
"BLD",5538,"KRN",3.6,0)
3.6
"BLD",5538,"KRN",3.8,0)
3.8
"BLD",5538,"KRN",9.2,0)
9.2
"BLD",5538,"KRN",9.8,0)
9.8
"BLD",5538,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5538,"KRN",9.8,"NM",1,0)
SCMCHL^^0^B25525801
"BLD",5538,"KRN",9.8,"NM","B","SCMCHL",1)

"BLD",5538,"KRN",19,0)
19
"BLD",5538,"KRN",19.1,0)
19.1
"BLD",5538,"KRN",101,0)
101
"BLD",5538,"KRN",409.61,0)
409.61
"BLD",5538,"KRN",771,0)
771
"BLD",5538,"KRN",870,0)
870
"BLD",5538,"KRN",8989.51,0)
8989.51
"BLD",5538,"KRN",8989.52,0)
8989.52
"BLD",5538,"KRN",8994,0)
8994
"BLD",5538,"KRN","B",.4,.4)

"BLD",5538,"KRN","B",.401,.401)

"BLD",5538,"KRN","B",.402,.402)

"BLD",5538,"KRN","B",.403,.403)

"BLD",5538,"KRN","B",.5,.5)

"BLD",5538,"KRN","B",.84,.84)

"BLD",5538,"KRN","B",3.6,3.6)

"BLD",5538,"KRN","B",3.8,3.8)

"BLD",5538,"KRN","B",9.2,9.2)

"BLD",5538,"KRN","B",9.8,9.8)

"BLD",5538,"KRN","B",19,19)

"BLD",5538,"KRN","B",19.1,19.1)

"BLD",5538,"KRN","B",101,101)

"BLD",5538,"KRN","B",409.61,409.61)

"BLD",5538,"KRN","B",771,771)

"BLD",5538,"KRN","B",870,870)

"BLD",5538,"KRN","B",8989.51,8989.51)

"BLD",5538,"KRN","B",8989.52,8989.52)

"BLD",5538,"KRN","B",8994,8994)

"BLD",5538,"QUES",0)
^9.62^^
"BLD",5538,"REQB",0)
^9.611^1^1
"BLD",5538,"REQB",1,0)
SD*5.3*272^1
"BLD",5538,"REQB","B","SD*5.3*272",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
367^3060615
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^3060615
"PKG",16,22,1,"PAH",1,1,1,0)
This patch will prevent multiple instances of the PCMM HL7 TRANSMISSION 
"PKG",16,22,1,"PAH",1,1,2,0)
from occurring.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SCMCHL")
0^1^B25525801^B22773542
"RTN","SCMCHL",1,0)
SCMCHL ;BP/DJB - PCMM HL7 Main Calling Point ; 16 Dec 2002  11:14 AM
"RTN","SCMCHL",2,0)
 ;;5.3;Scheduling;**177,204,224,272,367**;AUG 13, 1993
"RTN","SCMCHL",3,0)
 ;
"RTN","SCMCHL",4,0)
 ;Reference routine: SCDXMSG
"RTN","SCMCHL",5,0)
MAIN(MODE,XMITARRY,VARPTR,WORK) ;Main entry point to generate Primary Care HL7
"RTN","SCMCHL",6,0)
 ;messages to NPCD in Austin. Loop thru PCMM HL7 EVENT file (#404.48)
"RTN","SCMCHL",7,0)
 ;and generate HL7 message for each appropriate event.
"RTN","SCMCHL",8,0)
 ;
"RTN","SCMCHL",9,0)
 ;Input:
"RTN","SCMCHL",10,0)
 ;  MODE     - Mode of operation.
"RTN","SCMCHL",11,0)
 ;              1: Generate mode - Generate HL7 messages. (Default).
"RTN","SCMCHL",12,0)
 ;              2: Review mode   - HL7 segments will be built in array
"RTN","SCMCHL",13,0)
 ;                                 XMITARRY and may be reviewed. HL7
"RTN","SCMCHL",14,0)
 ;                                 messages WILL NOT be generated, and
"RTN","SCMCHL",15,0)
 ;                                 processed events will not be
"RTN","SCMCHL",16,0)
 ;                                 removed from the transmit xref in
"RTN","SCMCHL",17,0)
 ;                                 PCMM HL7 EVENT file.
"RTN","SCMCHL",18,0)
 ;  XMITARRY - Array to store HL7 segments (full global ref).
"RTN","SCMCHL",19,0)
 ;             Default=^TMP("PCMM","HL7",$J)
"RTN","SCMCHL",20,0)
 ;   VARPTR  - For testing purposes, you may pass in an EVENT POINTER
"RTN","SCMCHL",21,0)
 ;             value. This value will be used rather than $ORDERing
"RTN","SCMCHL",22,0)
 ;             thru "AACXMIT" xref in PCMM HL7 EVENT file.
"RTN","SCMCHL",23,0)
 ;             Examples:
"RTN","SCMCHL",24,0)
 ;                "2290;SCPT(404.43," (Patient Team Position Assign)
"RTN","SCMCHL",25,0)
 ;                "725;SCTM(404.52,"  (Position Assign History)
"RTN","SCMCHL",26,0)
 ;                "1;SCTM(404.53,"    (Preceptor Assign History)
"RTN","SCMCHL",27,0)
 ;   Work Optional if present
"RTN","SCMCHL",28,0)
 ;Output: None
"RTN","SCMCHL",29,0)
 ;
"RTN","SCMCHL",30,0)
 ;Prevent multiple runs processing at the same time.
"RTN","SCMCHL",31,0)
 I $G(VARPTR)'="",$D(^XTMP("SCMCHL")) D  Q
"RTN","SCMCHL",32,0)
 .W !,"HL7 Transmission in progress, no testing allowed!",!
"RTN","SCMCHL",33,0)
 I $D(^XTMP("SCMCHL")) D  Q
"RTN","SCMCHL",34,0)
 .W !,"HL7 Transmission in progress, please try again later.",!
"RTN","SCMCHL",35,0)
 S ^XTMP("SCMCHL",0)=DT_"^"_DT
"RTN","SCMCHL",36,0)
 ;
"RTN","SCMCHL",37,0)
 NEW ERRCNT,IEN,MSG,MSGCNT,RESULT
"RTN","SCMCHL",38,0)
 NEW SCEVIEN,SCFAC
"RTN","SCMCHL",39,0)
 NEW HL,HLECH,HLEID,HLFS,HLQ,HLP,XMITERR
"RTN","SCMCHL",40,0)
 ;
"RTN","SCMCHL",41,0)
 ;Initialize variables - set global locations
"RTN","SCMCHL",42,0)
 S:$G(MODE)'=2 MODE=1 ;Default mode = "Generate"
"RTN","SCMCHL",43,0)
 S:$G(XMITARRY)="" XMITARRY="^TMP(""PCMM"",""HL7"","_$J_")" ;Segments
"RTN","SCMCHL",44,0)
 S XMITERR="^TMP(""PCMM"",""ERR"","_$J_")" ;Errors
"RTN","SCMCHL",45,0)
 S MSGCNT=0
"RTN","SCMCHL",46,0)
 ;
"RTN","SCMCHL",47,0)
 ;Get pointer to sending event
"RTN","SCMCHL",48,0)
 S HLEID=$$HLEID()
"RTN","SCMCHL",49,0)
 I 'HLEID D  Q
"RTN","SCMCHL",50,0)
 . S MSG="Unable to initialize HL7 variables - protocol not found"
"RTN","SCMCHL",51,0)
 . D ERRBULL^SCMCHLM(MSG)
"RTN","SCMCHL",52,0)
 ;
"RTN","SCMCHL",53,0)
 ;Initialize HL7 variables
"RTN","SCMCHL",54,0)
 D INIT^HLFNC2(HLEID,.HL)
"RTN","SCMCHL",55,0)
 I $O(HL(""))="" D  Q
"RTN","SCMCHL",56,0)
 . D ERRBULL^SCMCHLM($P(HL,"^",2))
"RTN","SCMCHL",57,0)
 ;
"RTN","SCMCHL",58,0)
 ;Get faciltiy number
"RTN","SCMCHL",59,0)
 S SCFAC=+$P($$SITE^VASITE(),"^",3)
"RTN","SCMCHL",60,0)
 ;
"RTN","SCMCHL",61,0)
 ;User passed in an EVENT POINTER value
"RTN","SCMCHL",62,0)
 I $G(VARPTR)]"" D MANUAL Q
"RTN","SCMCHL",63,0)
 ;
"RTN","SCMCHL",64,0)
LOOP ;Loop thru EVENT POINTER xref and send message for each unique one.
"RTN","SCMCHL",65,0)
 ;alb/rpm Patch 224
"RTN","SCMCHL",66,0)
 ;The SCLIMIT counter allows sites to limit the number of HL7 messages
"RTN","SCMCHL",67,0)
 ;processed at any one time.  The next EVENT POINTER in the queue will
"RTN","SCMCHL",68,0)
 ;not be processed if SCLIMIT is exceeded.  SCLIMIT is not an absolute
"RTN","SCMCHL",69,0)
 ;limit, since a single EVENT POINTER can generate multiple HL7
"RTN","SCMCHL",70,0)
 ;messages.
"RTN","SCMCHL",71,0)
 ;Sites can modify SCLIMIT by editing the HL7 TRANSMIT LIMIT field of
"RTN","SCMCHL",72,0)
 ;the PCMM PARAMETER file.
"RTN","SCMCHL",73,0)
 ;
"RTN","SCMCHL",74,0)
 NEW SCLIMIT,WORK,VARPTR
"RTN","SCMCHL",75,0)
 S SCLIMIT=$P($G(^SCTM(404.44,1,1)),U,5) ;Limit # of msgs processed
"RTN","SCMCHL",76,0)
 S:'SCLIMIT SCLIMIT=2500 ;Default to 2500 msgs
"RTN","SCMCHL",77,0)
 S VARPTR=""
"RTN","SCMCHL",78,0)
 F  S VARPTR=$O(^SCPT(404.48,"AACXMIT",VARPTR)) Q:VARPTR=""!(SCLIMIT<1)  D
"RTN","SCMCHL",79,0)
 . KILL @XMITARRY ;Initialize array
"RTN","SCMCHL",80,0)
 . ;
"RTN","SCMCHL",81,0)
 . ;Preserve the Event IEN. Used to process a deletion.
"RTN","SCMCHL",82,0)
 . F SCEVIEN=0:0 S SCEVIEN=$O(^SCPT(404.48,"AACXMIT",VARPTR,SCEVIEN)) Q:'SCEVIEN  D
"RTN","SCMCHL",83,0)
 .. ;
"RTN","SCMCHL",84,0)
 .. ;Build segment array
"RTN","SCMCHL",85,0)
 .. K SCFUT
"RTN","SCMCHL",86,0)
 .. S WORK=+$P($G(^SCPT(404.48,SCEVIEN,0)),U,8)
"RTN","SCMCHL",87,0)
 .. I WORK N HLEID S HLEID=$$HLEIDW() S RESULT=$$BUILD^SCMCHLP(VARPTR,.HL,.XMITARRY,SCEVIEN)
"RTN","SCMCHL",88,0)
 .. I 'WORK S RESULT=$$BUILD^SCMCHLB(VARPTR,.HL,.XMITARRY)
"RTN","SCMCHL",89,0)
 .. I +RESULT<0 D  Q  ;Error occurred when building segment array
"RTN","SCMCHL",90,0)
 .. . S @XMITERR@(VARPTR)=$P(RESULT,"^",2)
"RTN","SCMCHL",91,0)
 .. ;
"RTN","SCMCHL",92,0)
 .. ;If in Review mode, display info and Quit.
"RTN","SCMCHL",93,0)
 .. I MODE=2 D  Q  ;
"RTN","SCMCHL",94,0)
 .. . W !,VARPTR_"  "_$S('$D(@XMITARRY):"No ",1:"")_"Data Found"
"RTN","SCMCHL",95,0)
 .. ;
"RTN","SCMCHL",96,0)
 .. ;If no segments built, turn off transmission flag and Quit.
"RTN","SCMCHL",97,0)
 .. I '$D(@XMITARRY) D:'$G(SCFUT) FLAG(VARPTR,SCEVIEN) Q
"RTN","SCMCHL",98,0)
 .. ;
"RTN","SCMCHL",99,0)
 .. ;Generate message.
"RTN","SCMCHL",100,0)
 .. ;
"RTN","SCMCHL",101,0)
 .. Q:'$$GENERATE^SCMCHLG()  ;^SCMCHLG Increments MSGCNT
"RTN","SCMCHL",102,0)
 .. D:'$G(SCFUT) FLAG(VARPTR,SCEVIEN) ;Turn off transmission flag
"RTN","SCMCHL",103,0)
 .. K @XMITARRY  ;clean up variables
"RTN","SCMCHL",104,0)
 . ;
"RTN","SCMCHL",105,0)
 . Q
"RTN","SCMCHL",106,0)
 ;
"RTN","SCMCHL",107,0)
 I '$D(ZTQUEUED) W !,MSGCNT," messages sent."
"RTN","SCMCHL",108,0)
 ;
"RTN","SCMCHL",109,0)
 ;Send completion bulletin and clean up arrays.
"RTN","SCMCHL",110,0)
 I MODE=1 D  ;Don't do this if in DISPLAY mode.
"RTN","SCMCHL",111,0)
 . S ERRCNT=$$COUNT^SCMCHLS(XMITERR)
"RTN","SCMCHL",112,0)
 . D CMPLBULL^SCMCHLM(MSGCNT,ERRCNT,XMITERR)
"RTN","SCMCHL",113,0)
 . KILL @XMITARRY,@XMITERR
"RTN","SCMCHL",114,0)
 . K ^XTMP("SCMCHL")
"RTN","SCMCHL",115,0)
 ;
"RTN","SCMCHL",116,0)
 Q:SCLIMIT<1
"RTN","SCMCHL",117,0)
 ;
"RTN","SCMCHL",118,0)
 ;alb/rpm;Patch 224;Transmit "M"arked messages from Transmission Log
"RTN","SCMCHL",119,0)
 D EN^SCMCHLRR(.SCLIMIT)
"RTN","SCMCHL",120,0)
 Q:SCLIMIT<1
"RTN","SCMCHL",121,0)
 ;
"RTN","SCMCHL",122,0)
 ;alb/rpm;Patch224;Transmit messages with overdue ACKnowledgment
"RTN","SCMCHL",123,0)
 D AUTO^SCMCHLRR(.SCLIMIT)
"RTN","SCMCHL",124,0)
 Q
"RTN","SCMCHL",125,0)
 ;
"RTN","SCMCHL",126,0)
MANUAL ;User passed in a specific variable pointer value. This value will
"RTN","SCMCHL",127,0)
 ;be used rather than $ORDERing thru "AACXMIT" xref.
"RTN","SCMCHL",128,0)
 ;
"RTN","SCMCHL",129,0)
 NEW SCMANUAL
"RTN","SCMCHL",130,0)
 S SCMANUAL=1 ;Indicates variable pointer was manually entered.
"RTN","SCMCHL",131,0)
 ;             A delete cannot be processed.
"RTN","SCMCHL",132,0)
 ;
"RTN","SCMCHL",133,0)
 ;Initialize array
"RTN","SCMCHL",134,0)
 KILL @XMITARRY
"RTN","SCMCHL",135,0)
 ;
"RTN","SCMCHL",136,0)
 ;Build segment array
"RTN","SCMCHL",137,0)
 I $G(WORK) N HLEID S HLEID=$$HLEIDW() S RESULT=$$BUILD^SCMCHLP(VARPTR,.HL,.XMITARRY)
"RTN","SCMCHL",138,0)
 I '$G(WORK) S RESULT=$$BUILD^SCMCHLB(VARPTR,.HL,.XMITARRY)
"RTN","SCMCHL",139,0)
 I +RESULT<0 D  Q  ;Error occurred when building segment array
"RTN","SCMCHL",140,0)
 . S @XMITERR@(VARPTR)=$P(RESULT,"^",2)
"RTN","SCMCHL",141,0)
 W !,VARPTR_"  "_$S('$D(@XMITARRY):"No ",1:"")_"Data Found",!
"RTN","SCMCHL",142,0)
 ;
"RTN","SCMCHL",143,0)
 ;Generate message - FOR TESTING PURPOSES ONLY!
"RTN","SCMCHL",144,0)
 S RESULT=$$GENERATE^SCMCHLG()
"RTN","SCMCHL",145,0)
 K ^XTMP("SCMCHL")
"RTN","SCMCHL",146,0)
 Q
"RTN","SCMCHL",147,0)
 ;
"RTN","SCMCHL",148,0)
FLAG(VARPTR,SCEVIEN) ;Turn off transmission flag. This removes event from "AACXMIT"
"RTN","SCMCHL",149,0)
 ;xref in PCMM HL7 EVENT file.
"RTN","SCMCHL",150,0)
 ;Input:
"RTN","SCMCHL",151,0)
 ;   VARPTR - Internal value of EVENT POINTER field
"RTN","SCMCHL",152,0)
 ;
"RTN","SCMCHL",153,0)
 Q:$G(VARPTR)']""
"RTN","SCMCHL",154,0)
 I $G(SCEVIEN) D TRANSMIT^SCMCHLE(SCEVIEN,0) Q
"RTN","SCMCHL",155,0)
 NEW IEN
"RTN","SCMCHL",156,0)
 S IEN=0
"RTN","SCMCHL",157,0)
 F  S IEN=$O(^SCPT(404.48,"AACXMIT",VARPTR,IEN)) Q:'IEN  D  ;
"RTN","SCMCHL",158,0)
 . D TRANSMIT^SCMCHLE(IEN,0)
"RTN","SCMCHL",159,0)
 Q
"RTN","SCMCHL",160,0)
 ;
"RTN","SCMCHL",161,0)
HLEIDW() ;Return workload sending event
"RTN","SCMCHL",162,0)
 Q +$O(^ORD(101,"B","SCMC SEND SERVER WORKLOAD",0))
"RTN","SCMCHL",163,0)
HLEID() ;Return pointer to sending event
"RTN","SCMCHL",164,0)
 I $G(WORK) Q $$HLEIDW()
"RTN","SCMCHL",165,0)
 Q +$O(^ORD(101,"B","PCMM SEND SERVER FOR ADT-A08",0))
"RTN","SCMCHL",166,0)
 Q
"VER")
8.0^22.0
"BLD",5538,6)
^388
**END**
**END**
