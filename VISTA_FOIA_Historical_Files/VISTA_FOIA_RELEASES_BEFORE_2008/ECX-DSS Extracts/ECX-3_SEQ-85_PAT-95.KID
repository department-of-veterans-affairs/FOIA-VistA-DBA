Released ECX*3*95 SEQ #85
Extracted from mail message
**KIDS**:ECX*3.0*95^

**INSTALL NAME**
ECX*3.0*95
"BLD",6810,0)
ECX*3.0*95^DSS EXTRACTS^0^3060726^y
"BLD",6810,1,0)
^^1^1^3060615^
"BLD",6810,1,1,0)
This patch provide a fix to ECX EXTRACT LOG SUMMARY routine and option.
"BLD",6810,4,0)
^9.64PA^^
"BLD",6810,6)
1^
"BLD",6810,"KRN",0)
^9.67PA^8989.52^19
"BLD",6810,"KRN",.4,0)
.4
"BLD",6810,"KRN",.401,0)
.401
"BLD",6810,"KRN",.402,0)
.402
"BLD",6810,"KRN",.403,0)
.403
"BLD",6810,"KRN",.5,0)
.5
"BLD",6810,"KRN",.84,0)
.84
"BLD",6810,"KRN",3.6,0)
3.6
"BLD",6810,"KRN",3.8,0)
3.8
"BLD",6810,"KRN",9.2,0)
9.2
"BLD",6810,"KRN",9.8,0)
9.8
"BLD",6810,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6810,"KRN",9.8,"NM",1,0)
ECXLOG^^0^B20803539
"BLD",6810,"KRN",9.8,"NM","B","ECXLOG",1)

"BLD",6810,"KRN",19,0)
19
"BLD",6810,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",6810,"KRN",19,"NM",1,0)
ECX EXTRACT LOG SUMMARY^^0
"BLD",6810,"KRN",19,"NM","B","ECX EXTRACT LOG SUMMARY",1)

"BLD",6810,"KRN",19.1,0)
19.1
"BLD",6810,"KRN",101,0)
101
"BLD",6810,"KRN",409.61,0)
409.61
"BLD",6810,"KRN",771,0)
771
"BLD",6810,"KRN",870,0)
870
"BLD",6810,"KRN",8989.51,0)
8989.51
"BLD",6810,"KRN",8989.52,0)
8989.52
"BLD",6810,"KRN",8994,0)
8994
"BLD",6810,"KRN","B",.4,.4)

"BLD",6810,"KRN","B",.401,.401)

"BLD",6810,"KRN","B",.402,.402)

"BLD",6810,"KRN","B",.403,.403)

"BLD",6810,"KRN","B",.5,.5)

"BLD",6810,"KRN","B",.84,.84)

"BLD",6810,"KRN","B",3.6,3.6)

"BLD",6810,"KRN","B",3.8,3.8)

"BLD",6810,"KRN","B",9.2,9.2)

"BLD",6810,"KRN","B",9.8,9.8)

"BLD",6810,"KRN","B",19,19)

"BLD",6810,"KRN","B",19.1,19.1)

"BLD",6810,"KRN","B",101,101)

"BLD",6810,"KRN","B",409.61,409.61)

"BLD",6810,"KRN","B",771,771)

"BLD",6810,"KRN","B",870,870)

"BLD",6810,"KRN","B",8989.51,8989.51)

"BLD",6810,"KRN","B",8989.52,8989.52)

"BLD",6810,"KRN","B",8994,8994)

"BLD",6810,"QUES",0)
^9.62^^
"BLD",6810,"REQB",0)
^9.611^1^1
"BLD",6810,"REQB",1,0)
ECX*3.0*84^2
"BLD",6810,"REQB","B","ECX*3.0*84",1)

"KRN",19,10184,-1)
0^1
"KRN",19,10184,0)
ECX EXTRACT LOG SUMMARY^Summary Report of Extract Logs^^R^^^^^^^^DSS EXTRACTS^^
"KRN",19,10184,1,0)
^19.06^3^3^3060615^^^^
"KRN",19,10184,1,1,0)
Using this option a summary report may be printed from the EXTRACT
"KRN",19,10184,1,2,0)
LOG file (#727) displaying extract number, feeder system, data set
"KRN",19,10184,1,3,0)
dates (date range), record count, date transmitted, and date purged.
"KRN",19,10184,20)

"KRN",19,10184,25)
EN^ECXLOG
"KRN",19,10184,60)

"KRN",19,10184,62)
0
"KRN",19,10184,63)

"KRN",19,10184,64)

"KRN",19,10184,"U")
SUMMARY REPORT OF EXTRACT LOGS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",535,-1)
1^1
"PKG",535,0)
DSS EXTRACTS^ECX
"PKG",535,20,0)
^9.402P^^
"PKG",535,22,0)
^9.49I^1^1
"PKG",535,22,1,0)
3.0^2971222^3000224^66481
"PKG",535,22,1,"PAH",1,0)
95^3060726^123456804
"PKG",535,22,1,"PAH",1,1,0)
^^1^1^3060726
"PKG",535,22,1,"PAH",1,1,1,0)
This patch provide a fix to ECX EXTRACT LOG SUMMARY routine and option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ECXLOG")
0^1^B20803539^B20540020
"RTN","ECXLOG",1,0)
ECXLOG ;ALB/GTS - Extract Log Report for DSS ; 10/26/05 3:01pm
"RTN","ECXLOG",2,0)
 ;;3.0;DSS EXTRACTS;**84,95**;Dec 22, 1997
"RTN","ECXLOG",3,0)
 ;
"RTN","ECXLOG",4,0)
EN ;entry point from option
"RTN","ECXLOG",5,0)
 ;Initialize varables
"RTN","ECXLOG",6,0)
 N DIR,ECSD1,ECED,X,Y
"RTN","ECXLOG",7,0)
 ;Prompt for start date
"RTN","ECXLOG",8,0)
 S DIR(0)="D^::EX"
"RTN","ECXLOG",9,0)
 S DIR("A")="Enter Report Start Date"
"RTN","ECXLOG",10,0)
 D ^DIR
"RTN","ECXLOG",11,0)
 I $D(DIRUT) Q
"RTN","ECXLOG",12,0)
 S ECSD1=Y
"RTN","ECXLOG",13,0)
 ;Prompt for end date
"RTN","ECXLOG",14,0)
 K DIR,X,Y
"RTN","ECXLOG",15,0)
 S DIR(0)="D^"_ECSD1_":"_DT_":EX"
"RTN","ECXLOG",16,0)
 S DIR("A")="Enter Report Ending Date"
"RTN","ECXLOG",17,0)
 D ^DIR
"RTN","ECXLOG",18,0)
 I $D(DIRUT) Q
"RTN","ECXLOG",19,0)
 S ECED=Y
"RTN","ECXLOG",20,0)
 ;Queue Report
"RTN","ECXLOG",21,0)
 W !!,"** REPORT REQUIRES 132 COLUMNS TO PRINT CORRECTLY **",!!
"RTN","ECXLOG",22,0)
 N ZTDESC,ZTIO,ZTSAVE,I
"RTN","ECXLOG",23,0)
 S ZTIO=""
"RTN","ECXLOG",24,0)
 S ZTDESC="DSS EXTRACT LOG STATISTICS"
"RTN","ECXLOG",25,0)
 F I="ECSD1","ECED","ECXNUM","ECXPKG","ECXSET","ECXCNT","ECXTXDT","ECXPURGE","ECXTRACT","ECXMONTH","ECXUCONF" D
"RTN","ECXLOG",26,0)
 .S ZTSAVE(I)=""
"RTN","ECXLOG",27,0)
 D EN^XUTMDEVQ("EN1^ECXLOG",ZTDESC,.ZTSAVE)
"RTN","ECXLOG",28,0)
 Q
"RTN","ECXLOG",29,0)
 ;
"RTN","ECXLOG",30,0)
EN1 ;Tasked entry point
"RTN","ECXLOG",31,0)
 ;Input : ECSD1  -  FM format report start date
"RTN","ECXLOG",32,0)
 ;        ECED   -  FM format report end date
"RTN","ECXLOG",33,0)
 ;
"RTN","ECXLOG",34,0)
 ;Output : None
"RTN","ECXLOG",35,0)
 ;
"RTN","ECXLOG",36,0)
 ;Declare variables
"RTN","ECXLOG",37,0)
 N LN,PAGENUM,STOP,ECXCT,ECXDACT,ECXNUM,ECXPKG,ECXSET,ECXCOUNT,ECXTXDT
"RTN","ECXLOG",38,0)
 N ECXPURGE,ECXTRACT,ECXUMSG,ECXUSER,ECXMONTH,MSGNUM,COUNT,DIC,ECX0,X
"RTN","ECXLOG",39,0)
 N ECX1,ECXED1,QFLG,CNT
"RTN","ECXLOG",40,0)
 S ECXED1=ECED+.9999,ECXCT=ECSD1-.0001,(CNT,QFLG,PAGENUM,STOP)=0
"RTN","ECXLOG",41,0)
 D HEADER I STOP D EXIT Q
"RTN","ECXLOG",42,0)
 D GETDATA
"RTN","ECXLOG",43,0)
 I '$D(^TMP("ECXDSS",$J)) D  Q
"RTN","ECXLOG",44,0)
 .W !
"RTN","ECXLOG",45,0)
 .W !,"***********************************************"
"RTN","ECXLOG",46,0)
 .W !,"*  NOTHING TO REPORT FOR SELECTED TIME FRAME  *"
"RTN","ECXLOG",47,0)
 .W !,"***********************************************"
"RTN","ECXLOG",48,0)
 .D WAIT
"RTN","ECXLOG",49,0)
 D DETAIL I STOP D EXIT Q
"RTN","ECXLOG",50,0)
 K ^TMP("ECXDSS",$J)
"RTN","ECXLOG",51,0)
 Q
"RTN","ECXLOG",52,0)
 ;
"RTN","ECXLOG",53,0)
GETDATA ;Get data
"RTN","ECXLOG",54,0)
 F  S ECXCT=$O(^ECX(727,"AE",ECXCT)) Q:(ECXCT>ECXED1)!('ECXCT)!(QFLG=1)  D
"RTN","ECXLOG",55,0)
 .S ECXDACT=0
"RTN","ECXLOG",56,0)
 .F  S ECXDACT=$O(^ECX(727,"AE",ECXCT,ECXDACT)) Q:('ECXDACT)!(QFLG=1)  D
"RTN","ECXLOG",57,0)
 ..S CNT=CNT+1
"RTN","ECXLOG",58,0)
 ..;Get data nodes
"RTN","ECXLOG",59,0)
 ..S ECX0=$G(^ECX(727,ECXDACT,0)),ECX1=$G(^(1))
"RTN","ECXLOG",60,0)
 ..Q:ECX0=""
"RTN","ECXLOG",61,0)
 ..S ECXNUM=$P(ECX0,U,1),ECXPKG=$E($P(ECX0,U,3),1,13),ECXSET=$E($P(ECX0,U,4),2,7)_"-"_$E($P(ECX0,U,5),2,7),ECXCOUNT=$P(ECX0,U,6),ECXTXDT=$G(^ECX(727,ECXDACT,"TR")),ECXPURGE=$G(^ECX(727,ECXDACT,"PURG")),ECXTRACT=$P(ECX0,U,2),ECXUSER=$P(ECX0,U,7)
"RTN","ECXLOG",62,0)
 ..S ECXMONTH=$P($$FMTE^XLFDT($P(ECX0,U,4),"D")," ",1)_" "_$P($$FMTE^XLFDT($P(ECX0,U,4),"D")," ",3)
"RTN","ECXLOG",63,0)
 ..;Resolve external values for ECXUSER
"RTN","ECXLOG",64,0)
 ..K DIC S DIC="^VA(200,",DIC(0)="NZ",X=ECXUSER D ^DIC
"RTN","ECXLOG",65,0)
 ..S ECXUSER=$P($G(Y(0)),U,1)
"RTN","ECXLOG",66,0)
 ..;Count number of UNCONF messages in Message number multiple
"RTN","ECXLOG",67,0)
 ..S (MSGNUM,COUNT)=0 F  S MSGNUM=$O(^ECX(727,ECXDACT,1,MSGNUM)) Q:MSGNUM'>0  D
"RTN","ECXLOG",68,0)
 ...S COUNT=COUNT+1
"RTN","ECXLOG",69,0)
 ..S ECXUMSG=$G(COUNT)
"RTN","ECXLOG",70,0)
 ..;Save for later
"RTN","ECXLOG",71,0)
 ..S ^TMP("ECXDSS",$J,CNT)=ECXNUM_U_ECXPKG_U_ECXSET_U_ECXCOUNT_U_ECXTXDT_U_ECXPURGE_U_ECXTRACT_U_ECXMONTH_U_ECXUMSG_U_ECXUSER
"RTN","ECXLOG",72,0)
 ..Q
"RTN","ECXLOG",73,0)
 .Q
"RTN","ECXLOG",74,0)
 Q
"RTN","ECXLOG",75,0)
 ;
"RTN","ECXLOG",76,0)
HEADER ;print header
"RTN","ECXLOG",77,0)
 S PAGENUM=$G(PAGENUM)+1
"RTN","ECXLOG",78,0)
 S $P(LN,"-",132)=""
"RTN","ECXLOG",79,0)
 W @IOF
"RTN","ECXLOG",80,0)
 W !,?1,"DSS EXTRACT LOG STATISTICS",?120,"Page: ",PAGENUM
"RTN","ECXLOG",81,0)
 W !!,?1,"EXTRACT NUMBER",?20,"VISTA PACKAGE",?39,"DATA SET DATES",?59,"RECORD COUNT",?75,"DATE TRANSMITTED",?98,"DATE PURGED"
"RTN","ECXLOG",82,0)
 W !,?3,"DATE EXTRACTED",?25,"DATA MONTH",?40,"MSG UNCONF"
"RTN","ECXLOG",83,0)
 W ?60,"REQUESTOR"
"RTN","ECXLOG",84,0)
 W !?1,LN
"RTN","ECXLOG",85,0)
 Q
"RTN","ECXLOG",86,0)
 ;
"RTN","ECXLOG",87,0)
DETAIL ;Print detailed line
"RTN","ECXLOG",88,0)
 ;Input  :  ^TMP("ECXDSS",$J) full global reference
"RTN","ECXLOG",89,0)
 ;          ECXNUM    -   Extract Number
"RTN","ECXLOG",90,0)
 ;          ECXPKG    -   VistA Package
"RTN","ECXLOG",91,0)
 ;          ECXDATA   -   Data Set
"RTN","ECXLOG",92,0)
 ;          ECXCOUNT  -   Record Count
"RTN","ECXLOG",93,0)
 ;          ECXTXDT   -   Transmission Date
"RTN","ECXLOG",94,0)
 ;          ECXPURGE  -   Extract Purge Date
"RTN","ECXLOG",95,0)
 ;          ECXTRACT  -   Extract Date
"RTN","ECXLOG",96,0)
 ;          ECXMONTH  -   Data Month and Year
"RTN","ECXLOG",97,0)
 ;          ECXUCONF  -   Unconfirmed Messages
"RTN","ECXLOG",98,0)
 ;          ECXUSER   -   Requestor
"RTN","ECXLOG",99,0)
 ;Output  : None
"RTN","ECXLOG",100,0)
 ;
"RTN","ECXLOG",101,0)
 N NODE,RECORD
"RTN","ECXLOG",102,0)
 S RECORD=0 F  S RECORD=$O(^TMP("ECXDSS",$J,RECORD)) Q:'RECORD!(STOP)  D
"RTN","ECXLOG",103,0)
 .S NODE=^TMP("ECXDSS",$J,RECORD)
"RTN","ECXLOG",104,0)
 .W !!,?1,$P(NODE,U,1),?20,$P(NODE,U,2),?39,$P(NODE,U,3),?59,$P(NODE,U,4),?75,$$FMTE^XLFDT($P(NODE,U,5),"D"),?98,$$FMTE^XLFDT($P(NODE,U,6),"D")
"RTN","ECXLOG",105,0)
 .W !,?3,$$FMTE^XLFDT($P(NODE,U,7),"D"),?25,$P(NODE,U,8),?40,$P(NODE,U,9),?60,$P(NODE,U,10)
"RTN","ECXLOG",106,0)
 .I $Y>(IOSL-5) D WAIT Q:STOP  D HEADER
"RTN","ECXLOG",107,0)
 .Q
"RTN","ECXLOG",108,0)
 Q
"RTN","ECXLOG",109,0)
 ;
"RTN","ECXLOG",110,0)
WAIT ;End of page logic
"RTN","ECXLOG",111,0)
 ;Input   ; None
"RTN","ECXLOG",112,0)
 ;Output  ; STOP - Flag inidcating if printing should continue
"RTN","ECXLOG",113,0)
 ;                 1 = Stop     0 = Continue
"RTN","ECXLOG",114,0)
 ;
"RTN","ECXLOG",115,0)
 S STOP=0
"RTN","ECXLOG",116,0)
 ;CRT - Prompt for continue
"RTN","ECXLOG",117,0)
 I $E(IOST,1,2)="C-"&(IOSL'>24) D  Q
"RTN","ECXLOG",118,0)
 .F  Q:$Y>(IOSL-3)  W !
"RTN","ECXLOG",119,0)
 .N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ECXLOG",120,0)
 .S DIR(0)="E"
"RTN","ECXLOG",121,0)
 .D ^DIR
"RTN","ECXLOG",122,0)
 .S STOP=$S(Y'=1:1,1:0)
"RTN","ECXLOG",123,0)
 ;Background task - check taskman
"RTN","ECXLOG",124,0)
 S STOP=$$S^%ZTLOAD()
"RTN","ECXLOG",125,0)
 I STOP D
"RTN","ECXLOG",126,0)
 .W !,"*********************************************"
"RTN","ECXLOG",127,0)
 .W !,"*  PRINTING OF REPORT STOPPED AS REQUESTED  *"
"RTN","ECXLOG",128,0)
 .W !,"*********************************************"
"RTN","ECXLOG",129,0)
 Q
"RTN","ECXLOG",130,0)
EXIT ;Kill temp global
"RTN","ECXLOG",131,0)
 K ^TMP("ECXDSS",$J)
"RTN","ECXLOG",132,0)
 Q
"VER")
8.0^22.0
"BLD",6810,6)
^85
**END**
**END**
