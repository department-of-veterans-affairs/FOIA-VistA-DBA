EMERGENCY Released IVM*2*86 SEQ #70
Extracted from mail message
**KIDS**:IVM*2.0*86^

**INSTALL NAME**
IVM*2.0*86
"BLD",5002,0)
IVM*2.0*86^INCOME VERIFICATION MATCH^0^3030821^y
"BLD",5002,4,0)
^9.64PA^^
"BLD",5002,"KRN",0)
^9.67PA^8989.52^19
"BLD",5002,"KRN",.4,0)
.4
"BLD",5002,"KRN",.401,0)
.401
"BLD",5002,"KRN",.402,0)
.402
"BLD",5002,"KRN",.403,0)
.403
"BLD",5002,"KRN",.5,0)
.5
"BLD",5002,"KRN",.84,0)
.84
"BLD",5002,"KRN",3.6,0)
3.6
"BLD",5002,"KRN",3.8,0)
3.8
"BLD",5002,"KRN",9.2,0)
9.2
"BLD",5002,"KRN",9.8,0)
9.8
"BLD",5002,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5002,"KRN",9.8,"NM",1,0)
IVMPTRN4^^0^B15592892
"BLD",5002,"KRN",9.8,"NM","B","IVMPTRN4",1)

"BLD",5002,"KRN",19,0)
19
"BLD",5002,"KRN",19.1,0)
19.1
"BLD",5002,"KRN",101,0)
101
"BLD",5002,"KRN",409.61,0)
409.61
"BLD",5002,"KRN",771,0)
771
"BLD",5002,"KRN",870,0)
870
"BLD",5002,"KRN",8989.51,0)
8989.51
"BLD",5002,"KRN",8989.52,0)
8989.52
"BLD",5002,"KRN",8994,0)
8994
"BLD",5002,"KRN","B",.4,.4)

"BLD",5002,"KRN","B",.401,.401)

"BLD",5002,"KRN","B",.402,.402)

"BLD",5002,"KRN","B",.403,.403)

"BLD",5002,"KRN","B",.5,.5)

"BLD",5002,"KRN","B",.84,.84)

"BLD",5002,"KRN","B",3.6,3.6)

"BLD",5002,"KRN","B",3.8,3.8)

"BLD",5002,"KRN","B",9.2,9.2)

"BLD",5002,"KRN","B",9.8,9.8)

"BLD",5002,"KRN","B",19,19)

"BLD",5002,"KRN","B",19.1,19.1)

"BLD",5002,"KRN","B",101,101)

"BLD",5002,"KRN","B",409.61,409.61)

"BLD",5002,"KRN","B",771,771)

"BLD",5002,"KRN","B",870,870)

"BLD",5002,"KRN","B",8989.51,8989.51)

"BLD",5002,"KRN","B",8989.52,8989.52)

"BLD",5002,"KRN","B",8994,8994)

"BLD",5002,"QUES",0)
^9.62^^
"BLD",5002,"REQB",0)
^9.611^1^1
"BLD",5002,"REQB",1,0)
IVM*2.0*81^2
"BLD",5002,"REQB","B","IVM*2.0*81",1)

"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
86^3030821
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IVMPTRN4")
0^1^B15592892
"RTN","IVMPTRN4",1,0)
IVMPTRN4 ;ALB/SEK - SEND RE-TRANSMISSIONS TO THE IVM CENTER ; 08/20/2003
"RTN","IVMPTRN4",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**9,11,17,34,66,81,86**; 21-OCT-94
"RTN","IVMPTRN4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMPTRN4",4,0)
 ;
"RTN","IVMPTRN4",5,0)
 ; This routine checks STATUS field of IVM TRANSMISSION LOG file (301.6)
"RTN","IVMPTRN4",6,0)
 ; to see if acknowledgment of the transmission has been received from
"RTN","IVMPTRN4",7,0)
 ; the IVM Center.  If transmission is waiting at the site, a message is
"RTN","IVMPTRN4",8,0)
 ; sent to the recipients of the IVM MESSAGES mail group.  Else the
"RTN","IVMPTRN4",9,0)
 ; message is re-transmitted to the IVM Center.
"RTN","IVMPTRN4",10,0)
 ;
"RTN","IVMPTRN4",11,0)
 ;
"RTN","IVMPTRN4",12,0)
ENTRY ; Check if message transmission has not been acknowledged for the 
"RTN","IVMPTRN4",13,0)
 ; following date range (IVMDMT3 through  IVM14) where:
"RTN","IVMPTRN4",14,0)
 ;     IVMDMT3 - First Date Checked
"RTN","IVMPTRN4",15,0)
 ;     IVM14   - Last Date Checked
"RTN","IVMPTRN4",16,0)
 ;
"RTN","IVMPTRN4",17,0)
 S IVMDTM3=$$FMADD^XLFDT(DT,-14),IVM14=$$FMADD^XLFDT(DT,-14)
"RTN","IVMPTRN4",18,0)
 S IVMDTMST=+$P($G(^IVM(301.9,1,0)),"^",6)
"RTN","IVMPTRN4",19,0)
 S:IVMDTMST<IVM14 IVMDTMST=IVM14
"RTN","IVMPTRN4",20,0)
 ;
"RTN","IVMPTRN4",21,0)
 ; INITIALIZE HL7 VARIABLES
"RTN","IVMPTRN4",22,0)
 N HL,HLEID
"RTN","IVMPTRN4",23,0)
 S HLEID="VAMC "_$P($$SITE^VASITE,"^",3)_" ORU-Z07 SERVER"
"RTN","IVMPTRN4",24,0)
 S HLEID=$O(^ORD(101,"B",HLEID,0))
"RTN","IVMPTRN4",25,0)
 D INIT^IVMUFNC(HLEID,.HL) S HLMTN="ORU" ; Initialize variables for HL7/IVM
"RTN","IVMPTRN4",26,0)
 ;
"RTN","IVMPTRN4",27,0)
 ; check Transmission Date/Time in AB x-ref
"RTN","IVMPTRN4",28,0)
 ; Note 2 oddities about this loop:
"RTN","IVMPTRN4",29,0)
 ;   1) Only checks back 2 weeks, if somehow retransmission not done within this window then it won't be done.
"RTN","IVMPTRN4",30,0)
 ;   2) Assumes IVMDAT will map to exactly one msgid for HL7 message - assumption made in $$MSGN^IVMPTRN4.
"RTN","IVMPTRN4",31,0)
 ;
"RTN","IVMPTRN4",32,0)
 S IVMDAT=IVMDTMST F  S IVMDAT=$O(^IVM(301.6,"AB",IVMDAT)) Q:'IVMDAT!($P(IVMDAT,".")>IVMDTM3)  D MAILMSGN
"RTN","IVMPTRN4",33,0)
 ;
"RTN","IVMPTRN4",34,0)
 ;
"RTN","IVMPTRN4",35,0)
 ;transmit remaining records
"RTN","IVMPTRN4",36,0)
 D
"RTN","IVMPTRN4",37,0)
 .N IVMEVENT
"RTN","IVMPTRN4",38,0)
 .; event code for Full Data Transmission
"RTN","IVMPTRN4",39,0)
 .S IVMEVENT="Z07"
"RTN","IVMPTRN4",40,0)
 .D FILE^IVMPTRN3
"RTN","IVMPTRN4",41,0)
 ;
"RTN","IVMPTRN4",42,0)
 ;clean-up
"RTN","IVMPTRN4",43,0)
 D END^IVMPTRN
"RTN","IVMPTRN4",44,0)
 ;
"RTN","IVMPTRN4",45,0)
ENTRYQ K IVMDAT,IVMMAILF,IVMDTM3,IVMDTMST,IVM14
"RTN","IVMPTRN4",46,0)
 Q
"RTN","IVMPTRN4",47,0)
 ;
"RTN","IVMPTRN4",48,0)
 ;
"RTN","IVMPTRN4",49,0)
MAILMSGN ; Get Mailman message number related to this transmission
"RTN","IVMPTRN4",50,0)
 S IVMMAILN=$$MSGN(IVMDAT)  ;returns #773 IEN for v1.6
"RTN","IVMPTRN4",51,0)
 ;
"RTN","IVMPTRN4",52,0)
 Q:'IVMMAILN                                   ; if no #773 IEN found
"RTN","IVMPTRN4",53,0)
 ;
"RTN","IVMPTRN4",54,0)
 ; find if awaiting initial transmission
"RTN","IVMPTRN4",55,0)
 N SLLN
"RTN","IVMPTRN4",56,0)
 S SLLN=+$P($G(^HLMA(IVMMAILN,0)),"^",7)       ; sending logical link
"RTN","IVMPTRN4",57,0)
 I SLLN,$D(^HLMA("AC","O",SLLN,IVMMAILN)) D  Q
"RTN","IVMPTRN4",58,0)
 .Q:$G(IVMMAILF)  ; already sent message once
"RTN","IVMPTRN4",59,0)
 .S XMSUB="MESSAGES 'AWAITING TRANSMISSION'"
"RTN","IVMPTRN4",60,0)
 .S IVMTEXT(1)="HL7 message number "_IVMMAILN_" is awaiting transmission."
"RTN","IVMPTRN4",61,0)
 .S IVMTEXT(2)="Please call the IVM Center (Atlanta, GA) to ensure the HL7 logical links and filers are running "
"RTN","IVMPTRN4",62,0)
 .S IVMTEXT(3)="if the HL7 logical link and filers are running at your station."
"RTN","IVMPTRN4",63,0)
 .S IVMTEXT(4)=" "
"RTN","IVMPTRN4",64,0)
 .S IVMTEXT(5)="Please note that you may have other messages that are awaiting transmission"
"RTN","IVMPTRN4",65,0)
 .S IVMTEXT(6)="to the IVM Center."
"RTN","IVMPTRN4",66,0)
 .D MAIL^IVMUFNC()
"RTN","IVMPTRN4",67,0)
 .S IVMMAILF=1
"RTN","IVMPTRN4",68,0)
 ;
"RTN","IVMPTRN4",69,0)
 ; Transmission has left site - get individual patient and re-transmit
"RTN","IVMPTRN4",70,0)
 K IVMQUERY("LTD"),IVMQUERY("OVIS") ;Variables needed to open/close last visit date and outpt visit QUERIES
"RTN","IVMPTRN4",71,0)
 F IVMDA=0:0 S IVMDA=$O(^IVM(301.6,"AB",IVMDAT,IVMDA)) Q:'IVMDA  D
"RTN","IVMPTRN4",72,0)
 .;
"RTN","IVMPTRN4",73,0)
 .N IVMTLOG,EVENTS
"RTN","IVMPTRN4",74,0)
 .;
"RTN","IVMPTRN4",75,0)
 .Q:'$$GET^IVMTLOG(IVMDA,.IVMTLOG)
"RTN","IVMPTRN4",76,0)
 .S IVM3015P=IVMTLOG("PAT") Q:'IVM3015P
"RTN","IVMPTRN4",77,0)
 .S IVMNODE=$G(^IVM(301.5,+IVM3015P,0)),IVMDT=+$P(IVMNODE,"^",2),DFN=+IVMNODE
"RTN","IVMPTRN4",78,0)
 .I 'DFN!'IVMDT Q
"RTN","IVMPTRN4",79,0)
 .S IVMMTDT=($E(IVMDT,1,3)+1)_"1231.9999"
"RTN","IVMPTRN4",80,0)
 .I $E(IVMMTDT,1,3)'=($E(IVMDT,1,3)+1) S IVMMTDT=$E(IVMDT,1,3)+1_"0101"
"RTN","IVMPTRN4",81,0)
 .;
"RTN","IVMPTRN4",82,0)
 .M EVENTS=IVMTLOG("EVENTS")
"RTN","IVMPTRN4",83,0)
 .;
"RTN","IVMPTRN4",84,0)
 .; Prepare FULL transmission
"RTN","IVMPTRN4",85,0)
 .D FULL^IVMPTRN7(DFN,IVMMTDT,.EVENTS,.IVMCT,.IVMGTOT,,,,.IVMQUERY)
"RTN","IVMPTRN4",86,0)
 .;
"RTN","IVMPTRN4",87,0)
 .;change status to retransmitted
"RTN","IVMPTRN4",88,0)
 .I $$SETSTAT^IVMTLOG(IVMDA,2)
"RTN","IVMPTRN4",89,0)
 F Z="LTD","OVIS" I $G(IVMQUERY(Z)) D CLOSE^SDQ(IVMQUERY(Z)) K IVMQUERY(Z)
"RTN","IVMPTRN4",90,0)
 Q
"RTN","IVMPTRN4",91,0)
 ;
"RTN","IVMPTRN4",92,0)
MSGN(IVMDT) ; Find the mailman message number for an HL7 message
"RTN","IVMPTRN4",93,0)
 ; Input:   IVMDT  --  The date/time (301.6;.02) the msg was sent
"RTN","IVMPTRN4",94,0)
 ; Output:  Pointer to the message in file #773, or zero if not found
"RTN","IVMPTRN4",95,0)
 N IVMMSG,X S IVMMSG=0
"RTN","IVMPTRN4",96,0)
 S X=+$O(^IVM(301.6,"AB",IVMDT,0)),X=$G(^IVM(301.6,X,0))
"RTN","IVMPTRN4",97,0)
 I X S IVMMSG=$$MMN(+$P($P(X,"^",5),"-"))
"RTN","IVMPTRN4",98,0)
MSGNQ Q IVMMSG
"RTN","IVMPTRN4",99,0)
 ;
"RTN","IVMPTRN4",100,0)
MMN(Y) ; Do look-up on file #772 and find mail message number.
"RTN","IVMPTRN4",101,0)
 ;  Input:   Y  --  Message Control ID
"RTN","IVMPTRN4",102,0)
 ;  Output:  Mail Message Number
"RTN","IVMPTRN4",103,0)
 N Z S Z=0
"RTN","IVMPTRN4",104,0)
 S Y=$O(^HL(772,"C",Y,0))
"RTN","IVMPTRN4",105,0)
 I Y S Z=+$O(^HLMA("B",Y,0))  ;Y=#772 IEN, Z=#773 IEN
"RTN","IVMPTRN4",106,0)
MMNQ Q Z
"VER")
8.0^22
**END**
**END**
