Released TIU*1*186 SEQ #185
Extracted from mail message
**KIDS**:TIU*1.0*186^

**INSTALL NAME**
TIU*1.0*186
"BLD",16541,0)
TIU*1.0*186^TEXT INTEGRATION UTILITIES^0^3050610^y
"BLD",16541,1,0)
^^2^2^3040331^^^^
"BLD",16541,1,1,0)
The description of this patch may be found in the National Patch Module 
"BLD",16541,1,2,0)
under TIU*1*186.
"BLD",16541,4,0)
^9.64PA^^
"BLD",16541,"ABPKG")
n
"BLD",16541,"KRN",0)
^9.67PA^8989.52^19
"BLD",16541,"KRN",.4,0)
.4
"BLD",16541,"KRN",.401,0)
.401
"BLD",16541,"KRN",.402,0)
.402
"BLD",16541,"KRN",.403,0)
.403
"BLD",16541,"KRN",.5,0)
.5
"BLD",16541,"KRN",.84,0)
.84
"BLD",16541,"KRN",3.6,0)
3.6
"BLD",16541,"KRN",3.8,0)
3.8
"BLD",16541,"KRN",9.2,0)
9.2
"BLD",16541,"KRN",9.8,0)
9.8
"BLD",16541,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",16541,"KRN",9.8,"NM",1,0)
TIUSRVPT^^0^B10584847
"BLD",16541,"KRN",9.8,"NM",2,0)
TIUSRVR1^^0^B34949493
"BLD",16541,"KRN",9.8,"NM",3,0)
TIUSRVR^^0^B17978855
"BLD",16541,"KRN",9.8,"NM",4,0)
TIUSRVD^^0^B40690502
"BLD",16541,"KRN",9.8,"NM","B","TIUSRVD",4)

"BLD",16541,"KRN",9.8,"NM","B","TIUSRVPT",1)

"BLD",16541,"KRN",9.8,"NM","B","TIUSRVR",3)

"BLD",16541,"KRN",9.8,"NM","B","TIUSRVR1",2)

"BLD",16541,"KRN",19,0)
19
"BLD",16541,"KRN",19.1,0)
19.1
"BLD",16541,"KRN",101,0)
101
"BLD",16541,"KRN",409.61,0)
409.61
"BLD",16541,"KRN",771,0)
771
"BLD",16541,"KRN",870,0)
870
"BLD",16541,"KRN",8989.51,0)
8989.51
"BLD",16541,"KRN",8989.52,0)
8989.52
"BLD",16541,"KRN",8994,0)
8994
"BLD",16541,"KRN","B",.4,.4)

"BLD",16541,"KRN","B",.401,.401)

"BLD",16541,"KRN","B",.402,.402)

"BLD",16541,"KRN","B",.403,.403)

"BLD",16541,"KRN","B",.5,.5)

"BLD",16541,"KRN","B",.84,.84)

"BLD",16541,"KRN","B",3.6,3.6)

"BLD",16541,"KRN","B",3.8,3.8)

"BLD",16541,"KRN","B",9.2,9.2)

"BLD",16541,"KRN","B",9.8,9.8)

"BLD",16541,"KRN","B",19,19)

"BLD",16541,"KRN","B",19.1,19.1)

"BLD",16541,"KRN","B",101,101)

"BLD",16541,"KRN","B",409.61,409.61)

"BLD",16541,"KRN","B",771,771)

"BLD",16541,"KRN","B",870,870)

"BLD",16541,"KRN","B",8989.51,8989.51)

"BLD",16541,"KRN","B",8989.52,8989.52)

"BLD",16541,"KRN","B",8994,8994)

"BLD",16541,"QUES",0)
^9.62^^
"BLD",16541,"REQB",0)
^9.611^8^4
"BLD",16541,"REQB",4,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",16541,"REQB",6,0)
TIU*1.0*112^2
"BLD",16541,"REQB",7,0)
TIU*1.0*175^2
"BLD",16541,"REQB",8,0)
TIU*1.0*173^2
"BLD",16541,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",4)

"BLD",16541,"REQB","B","TIU*1.0*112",6)

"BLD",16541,"REQB","B","TIU*1.0*173",8)

"BLD",16541,"REQB","B","TIU*1.0*175",7)

"MBREQ")
0
"PKG",362,-1)
1^1
"PKG",362,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",362,20,0)
^9.402P^^
"PKG",362,22,0)
^9.49I^1^1
"PKG",362,22,1,0)
1.0^2970620^2970819^64
"PKG",362,22,1,"PAH",1,0)
186^3050610^1380
"PKG",362,22,1,"PAH",1,1,0)
^^2^2^3050610
"PKG",362,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module 
"PKG",362,22,1,"PAH",1,1,2,0)
under TIU*1*186.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","TIUSRVD")
0^4^B40690502
"RTN","TIUSRVD",1,0)
TIUSRVD ; SLC/JER - RPC's for document definition ; 09/12/2003 [6/8/05 8:07am]
"RTN","TIUSRVD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,7,22,47,103,100,115,164,112,186**;Jun 20, 1997
"RTN","TIUSRVD",3,0)
NOTES(TIUY) ; Get list of PN Titles
"RTN","TIUSRVD",4,0)
 D LIST(.TIUY,3)
"RTN","TIUSRVD",5,0)
 Q
"RTN","TIUSRVD",6,0)
SUMMARY(TIUY) ; Get list of DS Titles
"RTN","TIUSRVD",7,0)
 D LIST(.TIUY,244)
"RTN","TIUSRVD",8,0)
 Q
"RTN","TIUSRVD",9,0)
LIST(TIUY,CLASS,TYPE,TIUK) ; Get list of document titles
"RTN","TIUSRVD",10,0)
 N TIUDFLT
"RTN","TIUSRVD",11,0)
 ; TIUK is STATIC
"RTN","TIUSRVD",12,0)
 S TIUK=+$G(TIUK)
"RTN","TIUSRVD",13,0)
 I $G(TYPE)']"" S TYPE="DOC"
"RTN","TIUSRVD",14,0)
 ; If the user has a preferred list of titles for the CLASS, get it
"RTN","TIUSRVD",15,0)
 I +$O(^TIU(8925.98,"AC",DUZ,CLASS,0)) D PERSLIST(.TIUY,DUZ,CLASS,.TIUK,1)
"RTN","TIUSRVD",16,0)
 S TIUK=+$G(TIUK)+1 S TIUY(TIUK)="~LONG LIST"
"RTN","TIUSRVD",17,0)
 D TRAVERSE(.TIUY,CLASS,$G(TYPE),.TIUK)
"RTN","TIUSRVD",18,0)
 S TIUDFLT=$$PERSDOC^TIULE(DUZ,+CLASS)
"RTN","TIUSRVD",19,0)
 I +TIUDFLT S TIUK=+$G(TIUK)+1,TIUY(TIUK)="d"_$P(TIUDFLT,U,2)
"RTN","TIUSRVD",20,0)
 Q
"RTN","TIUSRVD",21,0)
TRAVERSE(TIUY,CLASS,TYPE,TIUK) ; Get all selectable titles for the CLASS
"RTN","TIUSRVD",22,0)
 N I,J,X,CURTYP,Y,TIUI,TIUC,TYPMATCH S (TIUC,TIUI)=0
"RTN","TIUSRVD",23,0)
 S TIUK=+$G(TIUK)
"RTN","TIUSRVD",24,0)
 I $S(+$$CANENTR^TIULP(CLASS)'>0:1,+$$CANPICK^TIULP(CLASS)'>0:1,1:0) Q
"RTN","TIUSRVD",25,0)
 S CURTYP=$P(^TIU(8925.1,+CLASS,0),U,4)
"RTN","TIUSRVD",26,0)
 S TYPMATCH=$$TYPMATCH^TIULA1(TYPE,CURTYP)
"RTN","TIUSRVD",27,0)
 I +TYPMATCH S TIUK=+$G(TIUK)+1
"RTN","TIUSRVD",28,0)
 I  S TIUY(TIUK)="i"_+CLASS_U_$$PNAME^TIULC1(+CLASS)
"RTN","TIUSRVD",29,0)
 S I=0 F  S I=$O(^TIU(8925.1,+CLASS,10,I)) Q:+I'>0  D
"RTN","TIUSRVD",30,0)
 . N J
"RTN","TIUSRVD",31,0)
 . S J=+$G(^TIU(8925.1,+CLASS,10,+I,0)) Q:+J'>0
"RTN","TIUSRVD",32,0)
 . D TRAVERSE(.TIUY,+J,TYPE,.TIUK)
"RTN","TIUSRVD",33,0)
 Q
"RTN","TIUSRVD",34,0)
PERSLIST(TIUY,DUZ,CLASS,TIUC,TIUFLG) ; Get personal list for a user
"RTN","TIUSRVD",35,0)
 N TIUI,TIUDA,TIUDFLT,INLST
"RTN","TIUSRVD",36,0)
 S TIUDA=+$O(^TIU(8925.98,"AC",DUZ,CLASS,0))
"RTN","TIUSRVD",37,0)
 Q:+TIUDA'>0
"RTN","TIUSRVD",38,0)
 I +$G(TIUFLG) S TIUC=1,TIUY(TIUC)="~SHORT LIST"
"RTN","TIUSRVD",39,0)
 S TIUI=0,TIUC=+$G(TIUC)
"RTN","TIUSRVD",40,0)
 F  S TIUI=$O(^TIU(8925.98,TIUDA,10,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",41,0)
 . N TIUPL,TIUTNM,TIUDTYP,TIUSEQ
"RTN","TIUSRVD",42,0)
 . S TIUPL=$G(^TIU(8925.98,TIUDA,10,TIUI,0))
"RTN","TIUSRVD",43,0)
 . S TIUDTYP=$P(TIUPL,U)
"RTN","TIUSRVD",44,0)
 . I $S(+$$CANENTR^TIULP(TIUDTYP)'>0:1,+$$CANPICK^TIULP(TIUDTYP)'>0:1,1:0) Q
"RTN","TIUSRVD",45,0)
 . S TIUTNM=$S($P(TIUPL,U,3)]"":$P(TIUPL,U,3),1:$$PNAME^TIULC1(+TIUDTYP))
"RTN","TIUSRVD",46,0)
 . S TIUSEQ=+$P(TIUPL,U,2),TIUC=+$G(TIUC)+1
"RTN","TIUSRVD",47,0)
 . S TIUSEQ=$S(+TIUSEQ:$S('$D(TIUY(TIUSEQ)):TIUSEQ,1:(TIUSEQ+1)),1:TIUC)
"RTN","TIUSRVD",48,0)
 . S TIUY(TIUSEQ)="i"_TIUDTYP_U_TIUTNM,TIUC=+TIUSEQ
"RTN","TIUSRVD",49,0)
 I +$G(TIUFLG) Q
"RTN","TIUSRVD",50,0)
 S TIUDFLT=$$PERSDOC^TIULE(DUZ,+CLASS)
"RTN","TIUSRVD",51,0)
 S (TIUI,TIUC)=0
"RTN","TIUSRVD",52,0)
 F  S TIUI=$O(TIUY(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",53,0)
 . S TIUC=TIUI
"RTN","TIUSRVD",54,0)
 . I +TIUDFLT,($P($G(TIUY(TIUI)),U)=("i"_+TIUDFLT)) S $P(TIUDFLT,U,2)=$P(TIUY(TIUI),U,2),INLST=TIUI
"RTN","TIUSRVD",55,0)
 I +TIUDFLT D
"RTN","TIUSRVD",56,0)
 . ;if default isn't in list, append it as an item
"RTN","TIUSRVD",57,0)
 . I '$G(INLST) S TIUC=+$G(TIUC)+1,TIUY(TIUC)="i"_TIUDFLT
"RTN","TIUSRVD",58,0)
 . ;otherwise, just append as default
"RTN","TIUSRVD",59,0)
 . S TIUC=+$G(TIUC)+1,TIUY(TIUC)="d"_TIUDFLT
"RTN","TIUSRVD",60,0)
 Q
"RTN","TIUSRVD",61,0)
BLRSHELL(TIUY,TITLE,DFN,VSTR) ; Shell for boilerplate RPC
"RTN","TIUSRVD",62,0)
 K ^TMP("TIUBOIL",$J)
"RTN","TIUSRVD",63,0)
 D BLRPLT(.TIUY,TITLE,DFN,$G(VSTR))
"RTN","TIUSRVD",64,0)
 K ^TMP("TIUBOIL",$J,0)
"RTN","TIUSRVD",65,0)
 Q
"RTN","TIUSRVD",66,0)
BLRPLT(TIUY,TITLE,DFN,VSTR,ROOT) ; Load/Execute the Boilerplate for TITLE
"RTN","TIUSRVD",67,0)
 ;                                 or ROOT
"RTN","TIUSRVD",68,0)
 N TIU,TIUI,TIUJ,TIUK,TIUL,VADM,VAIN,VA,VAERR S TIUI=0
"RTN","TIUSRVD",69,0)
 S:'$D(TIUY) TIUY=$NA(^TMP("TIUBOIL",$J))
"RTN","TIUSRVD",70,0)
 S:'$D(ROOT) ROOT=$NA(^TIU(8925.1,+TITLE,"DFLT")) ; **47**
"RTN","TIUSRVD",71,0)
 I $L($G(VSTR)) D PATVADPT^TIULV(.TIU,DFN,"",$G(VSTR)) ; **47**
"RTN","TIUSRVD",72,0)
 S TIUJ=+$P($G(^TMP("TIUBOIL",$J,0)),U,3)+1
"RTN","TIUSRVD",73,0)
 ; --- Set component header ---
"RTN","TIUSRVD",74,0)
 I ROOT["^TIU(8925.1," D
"RTN","TIUSRVD",75,0)
 . S ^TMP("TIUBOIL",$J,TIUJ,0)=$S($P($G(^TIU(8925.1,+TITLE,0)),U,4)="CO":$P(^TIU(8925.1,+TITLE,0),U)_":   ",1:"")
"RTN","TIUSRVD",76,0)
 I +TIUJ=1,($G(^TMP("TIUBOIL",$J,TIUJ,0))']"") K ^TMP("TIUBOIL",$J,TIUJ,0) S TIUJ=0
"RTN","TIUSRVD",77,0)
 S ^TMP("TIUBOIL",$J,0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIUSRVD",78,0)
 F  S TIUI=$O(@ROOT@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",79,0)
 . S TIUJ=TIUJ+1,X=$G(@ROOT@(TIUI,0))
"RTN","TIUSRVD",80,0)
 . I $L($T(DOLMLINE^TIUSRVF1)),'$D(XWBOS),(X["{FLD:") S X=$$DOLMLINE^TIUSRVF1(X)
"RTN","TIUSRVD",81,0)
 . I X["|" S X=$$BOIL(X,TIUJ)
"RTN","TIUSRVD",82,0)
 . I X["~@" D INSMULT(X,"^TMP(""TIUBOIL"",$J)",.TIUJ) I 1
"RTN","TIUSRVD",83,0)
 . E  S ^TMP("TIUBOIL",$J,TIUJ,0)=X
"RTN","TIUSRVD",84,0)
 . S ^TMP("TIUBOIL",$J,0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIUSRVD",85,0)
 I ROOT["^TIU(8925.1,",+$O(^TIU(8925.1,+TITLE,10,0)) D
"RTN","TIUSRVD",86,0)
 . N TIUFITEM,TIUI D ITEMS^TIUFLT(+TITLE)
"RTN","TIUSRVD",87,0)
 . S TIUI=0 F  S TIUI=$O(TIUFITEM(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",88,0)
 . . S TIUL=+$G(TIUFITEM(+TIUI)) D BLRPLT(.TIUY,TIUL,DFN,$G(VSTR))
"RTN","TIUSRVD",89,0)
 Q
"RTN","TIUSRVD",90,0)
BOIL(LINE,COUNT) ; Execute Boilerplates
"RTN","TIUSRVD",91,0)
 N TIUI,DIC,X,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUSRVD",92,0)
 S DIC=8925.1,DIC(0)="FMXZ"
"RTN","TIUSRVD",93,0)
 S DIC("S")="I $P($G(^TIU(8925.1,+Y,0)),U,4)=""O"""
"RTN","TIUSRVD",94,0)
 F TIUI=2:2:$L(LINE,"|") S X=$P(LINE,"|",TIUI) D
"RTN","TIUSRVD",95,0)
 . D ^DIC
"RTN","TIUSRVD",96,0)
 . I +Y'>0 S X="The OBJECT "_X_" was NOT found...Contact IRM."
"RTN","TIUSRVD",97,0)
 . I +Y>0 D
"RTN","TIUSRVD",98,0)
 . . I $D(^TIU(8925.1,+Y,9)),+$$CANXEC(+Y) X ^(9) S:$E(X,1,2)="~@" X=X_"~@" I 1
"RTN","TIUSRVD",99,0)
 . . E  S X="The OBJECT "_X_" is INACTIVE...Contact IRM."
"RTN","TIUSRVD",100,0)
 . S LINE=$$REPLACE(LINE,X,TIUI)
"RTN","TIUSRVD",101,0)
 Q $TR(LINE,"|","")
"RTN","TIUSRVD",102,0)
CANXEC(TIUODA) ; Evaluate Object Status
"RTN","TIUSRVD",103,0)
 N TIUOST,TIUY S TIUOST=+$P($G(^TIU(8925.1,+TIUODA,0)),U,7)
"RTN","TIUSRVD",104,0)
 S TIUY=$S(TIUOST=11:1,+$G(NOSAVE):1,1:0)
"RTN","TIUSRVD",105,0)
 Q +$G(TIUY)
"RTN","TIUSRVD",106,0)
REPLACE(LINE,X,TIUI) ; Replace the TIUIth object in LINE w/X
"RTN","TIUSRVD",107,0)
 S $P(LINE,"|",TIUI)=X
"RTN","TIUSRVD",108,0)
 Q LINE
"RTN","TIUSRVD",109,0)
INSMULT(LINE,TARGET,TIULCNT) ; Mult-valued results
"RTN","TIUSRVD",110,0)
 N TIUPC,TIULGTH
"RTN","TIUSRVD",111,0)
 ; TIU*1*164 ;
"RTN","TIUSRVD",112,0)
 S TIULGTH=73 ; 2 replacements of 73 below for TIULGTH
"RTN","TIUSRVD",113,0)
 S:$$BROKER^XWBLIB TIULGTH=80
"RTN","TIUSRVD",114,0)
 F TIUPC=2:2:$L(LINE,"~@") D
"RTN","TIUSRVD",115,0)
 . N TIUI,TIULINE,TIUX,TIUSRC,TIUSCNT,TIUTAIL
"RTN","TIUSRVD",116,0)
 . S TIUSRC=$P(LINE,"~@",TIUPC)
"RTN","TIUSRVD",117,0)
 . S TIUTAIL=$P(LINE,"~@",TIUPC+1)
"RTN","TIUSRVD",118,0)
 . S TIULINE=$P(LINE,"~@",(TIUPC-1)),(TIUI,TIUSCNT)=0
"RTN","TIUSRVD",119,0)
 . I $E(TIULINE)=" ",(TIUPC>2) S $E(TIULINE)=""
"RTN","TIUSRVD",120,0)
 . F  S TIUI=$O(@TIUSRC@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVD",121,0)
 . . N TIUSLINE
"RTN","TIUSRVD",122,0)
 . . S TIUSCNT=TIUSCNT+1
"RTN","TIUSRVD",123,0)
 . . S TIUSLINE=$G(@TIUSRC@(TIUI,0))
"RTN","TIUSRVD",124,0)
 . . S:'+$O(@TIUSRC@(TIUI))&(TIUPC+2>$L(LINE,"~@")) TIUSLINE=TIUSLINE_TIUTAIL
"RTN","TIUSRVD",125,0)
 . . I TIUSCNT=1,($L(TIULINE_TIUSLINE)>TIULGTH) D  Q
"RTN","TIUSRVD",126,0)
 . . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUSRVD",127,0)
 . . . S @TARGET@(TIULCNT,0)=TIULINE
"RTN","TIUSRVD",128,0)
 . . . S TIULCNT=TIULCNT+1
"RTN","TIUSRVD",129,0)
 . . . S @TARGET@(TIULCNT,0)=TIUSLINE
"RTN","TIUSRVD",130,0)
 . . I TIUSCNT=1,($L(TIULINE_TIUSLINE)'>TIULGTH) D  Q
"RTN","TIUSRVD",131,0)
 . . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUSRVD",132,0)
 . . . S @TARGET@(TIULCNT,0)=TIULINE_TIUSLINE
"RTN","TIUSRVD",133,0)
 . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUSRVD",134,0)
 . . S @TARGET@(TIULCNT,0)=$G(TIUSLINE)
"RTN","TIUSRVD",135,0)
 . K @TIUSRC
"RTN","TIUSRVD",136,0)
 Q
"RTN","TIUSRVD",137,0)
LNGCNSLT(Y,FROM,DIR) ; Handle long list of titles for CONSULTS
"RTN","TIUSRVD",138,0)
 N CLASS S CLASS=+$$CLASS^TIUCNSLT Q:+CLASS'>0
"RTN","TIUSRVD",139,0)
 D LONGLIST(.Y,CLASS,$G(FROM),$G(DIR,1))
"RTN","TIUSRVD",140,0)
 Q
"RTN","TIUSRVD",141,0)
LNGSURG(Y,FROM,DIR,CLNAME)      ; long list SURGICAL REPORT titles
"RTN","TIUSRVD",142,0)
 ; CLNAME = "SURGICAL REPORTS" or "PROCEDURE REPORTS (NON-O.R.)"
"RTN","TIUSRVD",143,0)
 ;           depending on context
"RTN","TIUSRVD",144,0)
 N CLASS S CLNAME=$S($G(CLNAME)]"":CLNAME,1:"OPERATION REPORTS")
"RTN","TIUSRVD",145,0)
 S CLASS=$$CLASS^TIUSROI(CLNAME) Q:+CLASS'>0
"RTN","TIUSRVD",146,0)
 D LONGLIST(.Y,CLASS,$G(FROM),$G(DIR,1))
"RTN","TIUSRVD",147,0)
 Q
"RTN","TIUSRVD",148,0)
LONGLIST(Y,CLASS,FROM,DIR,IDNOTE) ; long list of titles for a class
"RTN","TIUSRVD",149,0)
 ; .Y=returned list, CLASS=ptr to class in 8925.1, FROM=text to $O from,
"RTN","TIUSRVD",150,0)
 ; DIR=$O direction, IDNOTE=flag to indicate selection for ID Entry
"RTN","TIUSRVD",151,0)
 N I,DA,CNT S I=0,CNT=44,DIR=$G(DIR,1)
"RTN","TIUSRVD",152,0)
 F  Q:I'<CNT  S FROM=$O(^TIU(8925.1,"ACL",CLASS,FROM),DIR) Q:FROM=""  D
"RTN","TIUSRVD",153,0)
 . S DA=0
"RTN","TIUSRVD",154,0)
 . F  Q:I'<CNT  S DA=$O(^TIU(8925.1,"ACL",CLASS,FROM,DA)) Q:+DA'>0  D
"RTN","TIUSRVD",155,0)
 . . I $S(+$$CANENTR^TIULP(DA)'>0:1,+$$CANPICK^TIULP(DA)'>0:1,1:0) Q
"RTN","TIUSRVD",156,0)
 . . I +$L($T(CANLINK^TIULP)),+$G(IDNOTE),(+$$CANLINK^TIULP(DA)'>0) Q
"RTN","TIUSRVD",157,0)
 . . S I=I+1,Y(I)=DA_"^"_FROM
"RTN","TIUSRVD",158,0)
 Q
"RTN","TIUSRVD",159,0)
CNSLCLAS(Y) ; RPC to identify class CONSULTS
"RTN","TIUSRVD",160,0)
 S Y=$$CLASS^TIUCNSLT
"RTN","TIUSRVD",161,0)
 Q
"RTN","TIUSRVD",162,0)
SURGCLAS(Y,CLNAME) ; RPC to identify class 
"RTN","TIUSRVD",163,0)
 ; CLNAME = "SURGICAL REPORTS" or "PROCEDURE REPORTS (NON-O.R.)"
"RTN","TIUSRVD",164,0)
 S CLNAME=$G(CLNAME,"SURGICAL REPORTS")
"RTN","TIUSRVD",165,0)
 S Y=$$CLASS^TIUSROI(CLNAME)
"RTN","TIUSRVD",166,0)
 Q
"RTN","TIUSRVD",167,0)
CANLINK(Y,TIUTTL)       ; Wrap call to $$CANLINK^TIULP
"RTN","TIUSRVD",168,0)
 S Y=$$CANLINK^TIULP(TIUTTL)
"RTN","TIUSRVD",169,0)
 Q
"RTN","TIUSRVPT")
0^1^B10584847
"RTN","TIUSRVPT",1,0)
TIUSRVPT ; SLC/JER - Set Methods for Documents ; 03/31/04
"RTN","TIUSRVPT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**122,175,186**;Jun 20, 1997
"RTN","TIUSRVPT",3,0)
SETTEXT(TIUY,TIUDA,TIUX,SUPPRESS) ; Save Text - use Buffered I/O
"RTN","TIUSRVPT",4,0)
 N PAGES,PAGE S TIUY=0,SUPPRESS=$G(SUPPRESS,0)
"RTN","TIUSRVPT",5,0)
 I $S(+$G(TIUDA)'>0:1,'$D(^TIU(8925,+TIUDA,0)):1,1:0) D  Q
"RTN","TIUSRVPT",6,0)
 . S TIUY="0^0^0^Attempt to file data in a Nonexistent Entry."
"RTN","TIUSRVPT",7,0)
 . D ERROR(TIUY)
"RTN","TIUSRVPT",8,0)
 S PAGE=$P($G(TIUX("HDR")),U),PAGES=$P($G(TIUX("HDR")),U,2)
"RTN","TIUSRVPT",9,0)
 I $S('PAGE:1,'PAGES:1,1:0) D  Q
"RTN","TIUSRVPT",10,0)
 . S TIUY="0^0^0^Invalid text block header"
"RTN","TIUSRVPT",11,0)
 . D ERROR(TIUY)
"RTN","TIUSRVPT",12,0)
 ; I PAGE=1 D MERGTEMP^TIUEDI1(TIUDA) K ^TIU(8925,+TIUDA,"TEMP"),^("TEXT")
"RTN","TIUSRVPT",13,0)
 I PAGE=1 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVPT",14,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT")
"RTN","TIUSRVPT",15,0)
 ;if done, commit changes
"RTN","TIUSRVPT",16,0)
 I 'SUPPRESS,(PAGE=PAGES),$D(^TIU(8925,TIUDA,"TEMP")) D
"RTN","TIUSRVPT",17,0)
 . N TIUC,TIUI,TIU S (TIUC,TIUI)=0
"RTN","TIUSRVPT",18,0)
 . F  S TIUI=$O(^TIU(8925,TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVPT",19,0)
 . . S TIUC=TIUC+1
"RTN","TIUSRVPT",20,0)
 . I TIUC>0 S ^TIU(8925,TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVPT",21,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVPT",22,0)
 . K ^TIU(8925,TIUDA,"TEXT")
"RTN","TIUSRVPT",23,0)
 . D
"RTN","TIUSRVPT",24,0)
 . . N TIUC
"RTN","TIUSRVPT",25,0)
 . . S TIUC=0 F  S TIUC=$O(^TIU(8925,"DAD",TIUDA,TIUC)) Q:+TIUC'>0  D
"RTN","TIUSRVPT",26,0)
 . . . I +$$ISADDNDM^TIULC1(+TIUC) Q
"RTN","TIUSRVPT",27,0)
 . . . K ^TIU(8925,+TIUC,"TEXT")
"RTN","TIUSRVPT",28,0)
 . D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVPT",29,0)
 . K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUSRVPT",30,0)
 ; Acknowledge success / ask for next page
"RTN","TIUSRVPT",31,0)
 S TIUY=TIUDA_U_PAGE_U_PAGES
"RTN","TIUSRVPT",32,0)
 Q
"RTN","TIUSRVPT",33,0)
ADMNCLOS(TIUY,TIUDA,MODE,PERSON) ; Post Administrative Closure Information
"RTN","TIUSRVPT",34,0)
 N TIUX,TIUI,TIUCLBY,TIUCLTTL
"RTN","TIUSRVPT",35,0)
 I '$D(^TIU(8925,TIUDA)) S TIUY="0^Attempt to file data in a Nonexistent Entry." Q
"RTN","TIUSRVPT",36,0)
 S MODE=$G(MODE,"S")
"RTN","TIUSRVPT",37,0)
 S PERSON=$G(PERSON,DUZ)
"RTN","TIUSRVPT",38,0)
 S TIUCLBY=$$SIGNAME^TIULS(PERSON)
"RTN","TIUSRVPT",39,0)
 S TIUCLTTL=$$SIGTITL^TIULS(PERSON)
"RTN","TIUSRVPT",40,0)
 S TIUX(.05)=7
"RTN","TIUSRVPT",41,0)
 S TIUX(1606)=$G(DT)
"RTN","TIUSRVPT",42,0)
 S TIUX(1607)=TIUCLBY
"RTN","TIUSRVPT",43,0)
 S TIUX(1608)=TIUCLTTL
"RTN","TIUSRVPT",44,0)
 S TIUX(1613)=MODE
"RTN","TIUSRVPT",45,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX)
"RTN","TIUSRVPT",46,0)
 S TIUI=$P($G(^TIU(8925,TIUDA,"TEXT",0)),U,3)+1
"RTN","TIUSRVPT",47,0)
 ;If scanned document set document body to informational text
"RTN","TIUSRVPT",48,0)
 I MODE="S" D
"RTN","TIUSRVPT",49,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)=" ",TIUI=TIUI+1
"RTN","TIUSRVPT",50,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)="                           *** SCANNED DOCUMENT ***",TIUI=TIUI+1
"RTN","TIUSRVPT",51,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)="                            SIGNATURE NOT REQUIRED",TIUI=TIUI+1
"RTN","TIUSRVPT",52,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)=" ",TIUI=TIUI+1
"RTN","TIUSRVPT",53,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)=" ",TIUI=TIUI+1
"RTN","TIUSRVPT",54,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)="Administrative Closure: "_$$DATE^TIULS(DT,"MM/DD/CCYY"),TIUI=TIUI+1
"RTN","TIUSRVPT",55,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)="                    by: "_TIUCLBY,TIUI=TIUI+1
"RTN","TIUSRVPT",56,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)="                        "_TIUCLTTL
"RTN","TIUSRVPT",57,0)
 S ^TIU(8925,+TIUDA,"TEXT",0)="^^"_TIUI_U_TIUI_U_DT_"^^"
"RTN","TIUSRVPT",58,0)
 D ALERTDEL^TIUALRT(TIUDA)
"RTN","TIUSRVPT",59,0)
 Q
"RTN","TIUSRVPT",60,0)
ERROR(ECODE) ; Register AUTOSAVE Error
"RTN","TIUSRVPT",61,0)
 N ERRDT S ERRDT=+$$NOW^XLFDT
"RTN","TIUSRVPT",62,0)
 Q:+$G(^XTMP("TIUERR","COUNT"))'<100
"RTN","TIUSRVPT",63,0)
 I '$D(^XTMP("TIUERR",0)) D
"RTN","TIUSRVPT",64,0)
 . S ^XTMP("TIUERR",0)=$$FMADD^XLFDT(DT,90)_U_DT
"RTN","TIUSRVPT",65,0)
 S ^XTMP("TIUERR",ERRDT,"ECODE")=ECODE
"RTN","TIUSRVPT",66,0)
 S ^XTMP("TIUERR",ERRDT,"USER")=DUZ
"RTN","TIUSRVPT",67,0)
 S ^XTMP("TIUERR",ERRDT,"TIUDA")=TIUDA
"RTN","TIUSRVPT",68,0)
 S ^XTMP("TIUERR",ERRDT,"TIUHDR")=$G(TIUX("HDR"))
"RTN","TIUSRVPT",69,0)
 S ^XTMP("TIUERR",ERRDT,"XWBHDR")=$G(XWBS1("HDR"))
"RTN","TIUSRVPT",70,0)
 S ^XTMP("TIUERR","COUNT")=$G(^XTMP("TIUERR","COUNT"))+1
"RTN","TIUSRVPT",71,0)
 Q
"RTN","TIUSRVR")
0^3^B17978855
"RTN","TIUSRVR",1,0)
TIUSRVR ; SLC/JER - Server fns for record manipulation ; 01/22/2002 16:18
"RTN","TIUSRVR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,28,69,89,122,109,112,186**;Jun 20, 1997
"RTN","TIUSRVR",3,0)
SGET(TIUY,DA) ; Get fixed fields for record TIUDA
"RTN","TIUSRVR",4,0)
 N DOC,LOC,PT,AUT,EDT,DTFMT,TIUPT,TIULST4,TIUREC,TIUR0,TIUR12,TIUR13
"RTN","TIUSRVR",5,0)
 N SUBJ,TIUCNT
"RTN","TIUSRVR",6,0)
 S TIUR0=$G(^TIU(8925,+DA,0)),TIUR12=$G(^TIU(8925,+DA,12))
"RTN","TIUSRVR",7,0)
 S TIUR13=$G(^TIU(8925,+DA,13)),TIUPT=$G(^DPT(+$P(TIUR0,U,2),0))
"RTN","TIUSRVR",8,0)
 S SUBJ=$G(^TIU(8925,+DA,17))
"RTN","TIUSRVR",9,0)
 S DOC=$$PNAME^TIULC1(+TIUR0)
"RTN","TIUSRVR",10,0)
 S LOC=$P($G(^SC(+$P(TIUR12,U,5),0)),U)
"RTN","TIUSRVR",11,0)
 S PT=$$NAME^TIULS($P(TIUPT,U),"LAST, FIRST MI")
"RTN","TIUSRVR",12,0)
 S TIULST4=$E($P(TIUPT,U,9),6,9)
"RTN","TIUSRVR",13,0)
 S TIULST4="("_$E(PT)_TIULST4_")"
"RTN","TIUSRVR",14,0)
 S AUT=$$SIGNAME^TIULS(+$P(TIUR12,U,2))
"RTN","TIUSRVR",15,0)
 S DTFMT=$S($L(+TIUR13,".")=2:"MM/DD/YY HR:MIN",1:"MM/DD/YY")
"RTN","TIUSRVR",16,0)
 S EDT=$$DATE^TIULS(+TIUR13,DTFMT)
"RTN","TIUSRVR",17,0)
 S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSRVR",18,0)
 S TIUY=DOC_U_EDT_U_PT_" "_TIULST4_U_AUT_U_LOC_U_SUBJ
"RTN","TIUSRVR",19,0)
 Q
"RTN","TIUSRVR",20,0)
TGET(TIUY,TIUDA,TIUJ,TIUDAD) ; Get each component
"RTN","TIUSRVR",21,0)
 N TIUKID,TIUDADT,TIUI,TIUSEE S TIUI=0
"RTN","TIUSRVR",22,0)
 S TIUSEE=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUSRVR",23,0)
 I '+TIUSEE D  Q
"RTN","TIUSRVR",24,0)
 . S TIUY(1)="  "
"RTN","TIUSRVR",25,0)
 . S TIUY(2)=$P(TIUSEE,"^ ",2),(TIUI,TIUJ)=2
"RTN","TIUSRVR",26,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR",27,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRVR",28,0)
 . S TIUY(TIUJ)=$G(^TIU(8925,+TIUDA,"TEXT",TIUI,0))
"RTN","TIUSRVR",29,0)
 . ;S ^TMP("TIUTEXT",$J,TIUJ,0)=$G(^TIU(8925,+TIUDA,"TEXT",TIUI,0))
"RTN","TIUSRVR",30,0)
 ; Iterate through children, and get their text fields
"RTN","TIUSRVR",31,0)
 S TIUKID=0
"RTN","TIUSRVR",32,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRVR",33,0)
 . D TGET(.TIUY,TIUKID,.TIUJ,$G(TIUDAD,TIUDA))
"RTN","TIUSRVR",34,0)
 ;I $D(^TMP("TIUTEXT",$J)) S TIUY="^TMP(""TIUTEXT"",$J)"
"RTN","TIUSRVR",35,0)
 Q
"RTN","TIUSRVR",36,0)
GET4EDIT(TIUY,TIUDA,DR) ; Get data in preparation for editing a record
"RTN","TIUSRVR",37,0)
 N CANEDIT,ERR,D0,DIQ2,TIUARR,TIUF,TIUI
"RTN","TIUSRVR",38,0)
 I +$D(^TIU(8925,TIUDA,"TEMP")),'+$$IFTEXT() D MERGTEXT(TIUDA)
"RTN","TIUSRVR",39,0)
 K ^TMP("TIUEDIT",$J),^TMP("TIULQ",$J)
"RTN","TIUSRVR",40,0)
 S TIUY=$NA(^TMP("TIUEDIT",$J)),TIUARR=$NA(^TMP("TIULQ",$J))
"RTN","TIUSRVR",41,0)
 S CANEDIT=$$CANDO^TIULP(TIUDA,"EDIT RECORD")
"RTN","TIUSRVR",42,0)
 I +CANEDIT'>0 S ^TMP("TIUEDIT",$J,0)="~"_$P(CANEDIT,U,2) Q
"RTN","TIUSRVR",43,0)
 D EXTRACT^TIULQ(TIUDA,TIUARR,.ERR,$G(DR),"",1,"IE",1)
"RTN","TIUSRVR",44,0)
 I $D(ERR) M TIUY=ERR Q
"RTN","TIUSRVR",45,0)
 S TIUF=0
"RTN","TIUSRVR",46,0)
 F  S TIUF=$O(@TIUARR@(TIUDA,TIUF)) Q:+TIUF'>0  D
"RTN","TIUSRVR",47,0)
 . S ^TMP("TIUEDIT",$J,TIUF)=TIUF_U_@TIUARR@(TIUDA,TIUF,"I")_U_@TIUARR@(TIUDA,TIUF,"E")
"RTN","TIUSRVR",48,0)
 S TIUI=0
"RTN","TIUSRVR",49,0)
 F  S TIUI=$O(@TIUARR@(TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR",50,0)
 . S ^TMP("TIUEDIT",$J,"TEXT",TIUI)=$G(@TIUARR@(TIUDA,"TEXT",TIUI,0))
"RTN","TIUSRVR",51,0)
 S ^TMP("TIUEDIT",$J,"TEXT",0)="$TXT",^TIU(8925,"ASAVE",DUZ,TIUDA)=""
"RTN","TIUSRVR",52,0)
 K @TIUARR
"RTN","TIUSRVR",53,0)
 Q
"RTN","TIUSRVR",54,0)
IFTEXT() ;
"RTN","TIUSRVR",55,0)
 N TIUCHK
"RTN","TIUSRVR",56,0)
 S TIUCHK=0 F  S TIUCHK=$O(^TIU(8925,TIUDA,"TEXT",TIUCHK)) Q:TIUCHK=""!TIUCHK>0
"RTN","TIUSRVR",57,0)
 Q TIUCHK
"RTN","TIUSRVR",58,0)
GETPREF(TIUY,USER) ; Get user's personal preferences
"RTN","TIUSRVR",59,0)
 ; Call with TIUY (by ref)
"RTN","TIUSRVR",60,0)
 ;           USER is pointer to file 200
"RTN","TIUSRVR",61,0)
 ; Returns   TIUY = USER ^ DEFAULT LOCATION ^ REVIEW SCREEN SORT FIELD ^
"RTN","TIUSRVR",62,0)
 ;               ==>REVIEW SCREEN SORT ORDER ^ DISPLAY MENUS ^ PATIENT
"RTN","TIUSRVR",63,0)
 ;               ==>SELECTION PREFERENCE ^ ASK 'Save changes?' AFTER
"RTN","TIUSRVR",64,0)
 ;               ==>EDIT ^ ASK SUBJECT FOR PROGRESS NOTES ^
"RTN","TIUSRVR",65,0)
 S TIUY=$$PERSPRF^TIULE(USER)
"RTN","TIUSRVR",66,0)
 Q
"RTN","TIUSRVR",67,0)
GETALRT(TIUY,XQAID) ;  Retrieve DFN and document type for a TIU alert
"RTN","TIUSRVR",68,0)
 N X,TIUDA,TIUDFN,ORTAB,TIUDAD,GMRCO
"RTN","TIUSRVR",69,0)
 S TIUDA=$TR($P(XQAID,";",1),"ABCDEFGHIJKLMNOPQRSTUVWXYZ") ; Strip Text
"RTN","TIUSRVR",70,0)
 I '+TIUDA!('$D(^TIU(8925,+TIUDA,0))) S TIUY="-1" Q
"RTN","TIUSRVR",71,0)
 S X=$P($G(^TIU(8925,TIUDA,0)),U)
"RTN","TIUSRVR",72,0)
 S TIUDFN=$P(^TIU(8925,TIUDA,0),U,2)
"RTN","TIUSRVR",73,0)
 I $P(^TIU(8925,TIUDA,0),U,6)'="" D
"RTN","TIUSRVR",74,0)
 . S TIUDAD=$P(^TIU(8925,TIUDA,0),U,6)
"RTN","TIUSRVR",75,0)
 . S X=$P($G(^TIU(8925,TIUDAD,0)),U)
"RTN","TIUSRVR",76,0)
 I ('+X)!('+TIUDFN) S TIUY="-1" Q
"RTN","TIUSRVR",77,0)
 S ORTAB=903    ;DEFAULT TO PN
"RTN","TIUSRVR",78,0)
 I +$$ISDS^TIULX(X) S ORTAB=901
"RTN","TIUSRVR",79,0)
 I +$$ISA^TIULX(X,$$CLASS^TIUSROI("SURGICAL REPORTS")) S ORTAB=904
"RTN","TIUSRVR",80,0)
 I +$$ISA^TIULX(X,$$CLASS^TIUCNSLT)!(+$$ISA^TIULX(X,+$$CLASS^TIUCP)) D
"RTN","TIUSRVR",81,0)
 . S GMRCO=$P(^TIU(8925,$S(+$G(TIUDAD):TIUDAD,1:TIUDA),14),U,5)
"RTN","TIUSRVR",82,0)
 . S ORTAB=902_";"_GMRCO
"RTN","TIUSRVR",83,0)
 S TIUY=TIUDA_U_TIUDFN_U_ORTAB
"RTN","TIUSRVR",84,0)
 Q
"RTN","TIUSRVR",85,0)
GET1405(TIUY,TIUDA) ; Get the Request (field #1405) for a document
"RTN","TIUSRVR",86,0)
 N TIUDAD,TIUTYP,TIU1405
"RTN","TIUSRVR",87,0)
 I '+TIUDA!('$D(^TIU(8925,+TIUDA,0))) S TIUY="-1^TIU Document does not exist" Q
"RTN","TIUSRVR",88,0)
 S TIUTYP=$P($G(^TIU(8925,TIUDA,0)),U)
"RTN","TIUSRVR",89,0)
 I $P(^TIU(8925,TIUDA,0),U,6)'="" D
"RTN","TIUSRVR",90,0)
 . S TIUDAD=$P(^TIU(8925,TIUDA,0),U,6)
"RTN","TIUSRVR",91,0)
 . S TIUTYP=$P($G(^TIU(8925,TIUDAD,0)),U)
"RTN","TIUSRVR",92,0)
 I '+TIUTYP S TIUY="-1^TIU parent document does not exist" Q
"RTN","TIUSRVR",93,0)
 S TIU1405=$P($G(^TIU(8925,$S(+$G(TIUDAD):TIUDAD,1:TIUDA),14)),U,5)
"RTN","TIUSRVR",94,0)
 I '+TIU1405 S TIUY="-1^No Request found for this document" Q
"RTN","TIUSRVR",95,0)
 S TIUY=TIU1405
"RTN","TIUSRVR",96,0)
 Q
"RTN","TIUSRVR",97,0)
MERGTEXT(TIUDA) ; Merge text from "TEMP"-node to "TEXT"-node
"RTN","TIUSRVR",98,0)
 N TIU
"RTN","TIUSRVR",99,0)
 D CLEANTXT(TIUDA)
"RTN","TIUSRVR",100,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVR",101,0)
 D MERGTEXT^TIUEDI1(TIUDA,.TIU)
"RTN","TIUSRVR",102,0)
 K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUSRVR",103,0)
 Q
"RTN","TIUSRVR",104,0)
CLEANTXT(TIUDA) ; Remove "TEXT"-nodes of document and components
"RTN","TIUSRVR",105,0)
 N TIUI S TIUI=0
"RTN","TIUSRVR",106,0)
 K ^TIU(8925,TIUDA,"TEXT")
"RTN","TIUSRVR",107,0)
 F  S TIUI=$O(^TIU(8925,"DAD",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR",108,0)
 . I +$$ISADDNDM^TIULC1(TIUI) Q
"RTN","TIUSRVR",109,0)
 . K ^TIU(8925,TIUI,"TEXT")
"RTN","TIUSRVR",110,0)
 Q
"RTN","TIUSRVR1")
0^2^B34949493
"RTN","TIUSRVR1",1,0)
TIUSRVR1 ; SLC/JER - RPC for record-wise GET ; 01/22/2002 16:48
"RTN","TIUSRVR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,32,87,89,100,109,112,173,186**;Jun 20, 1997
"RTN","TIUSRVR1",3,0)
TGET(TIUY,TIUDA,ACTION) ; Build ^TMP("TIUVIEW",$J,
"RTN","TIUSRVR1",4,0)
 N TIUL,TIUREC,TIUARR,TIUGDATA,TIUNAME,TIUPRM0,TIUPRM1,X,Y,TIUCPF,ONBROWSE
"RTN","TIUSRVR1",5,0)
 K ^TMP("TIUVIEW",$J),^TMP("TIU FOCUS",$J)
"RTN","TIUSRVR1",6,0)
 S ACTION=$G(ACTION,"VIEW"),TIUL=0
"RTN","TIUSRVR1",7,0)
 D SETPARM^TIULE
"RTN","TIUSRVR1",8,0)
 S TIUGDATA=$$SETGDATA(TIUDA)
"RTN","TIUSRVR1",9,0)
 S TIUY=$NA(^TMP("TIUVIEW",$J))
"RTN","TIUSRVR1",10,0)
 S TIUARR="^TMP(""TIUVIEW"",$J)"
"RTN","TIUSRVR1",11,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUSRVR1",12,0)
 ; Initialize ^TMP("TIU FOCUS",$J) to the entry that has focus
"RTN","TIUSRVR1",13,0)
 S ^TMP("TIU FOCUS",$J)=TIUDA
"RTN","TIUSRVR1",14,0)
 ; if the document has a browse action, execute it
"RTN","TIUSRVR1",15,0)
 S ONBROWSE=$$ONBROWSE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUSRVR1",16,0)
 I $L(ONBROWSE) D LOADSUPP(ONBROWSE,TIUDA,.TIUL)
"RTN","TIUSRVR1",17,0)
 ; Call INQUIRE to get record
"RTN","TIUSRVR1",18,0)
 ;Set a flag to indicate whether or not a Title is a memer of the
"RTN","TIUSRVR1",19,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRVR1",20,0)
 S TIUCPF=+$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),+$$CLASS^TIUCP)
"RTN","TIUSRVR1",21,0)
 ; Call INQUIRE to get record
"RTN","TIUSRVR1",22,0)
 D INQUIRE^TIUSRVR2(TIUDA,.TIUREC,TIUCPF)
"RTN","TIUSRVR1",23,0)
 ; First, load dictation, transcription data, etc.
"RTN","TIUSRVR1",24,0)
 D LOADTOP(.TIUREC,TIUDA,.TIUL,TIUGDATA,TIUCPF)
"RTN","TIUSRVR1",25,0)
 ; Next, load the remainder of the record
"RTN","TIUSRVR1",26,0)
 D LOADREC^TIUSRVR2(TIUDA,.TIUL,TIUGDATA,0,ACTION)
"RTN","TIUSRVR1",27,0)
 K ^TMP("TIU FOCUS",$J)
"RTN","TIUSRVR1",28,0)
 S VALMCNT=+$G(TIUL)
"RTN","TIUSRVR1",29,0)
 Q
"RTN","TIUSRVR1",30,0)
SETGDATA(TIUDA) ; Set TIUGDATA
"RTN","TIUSRVR1",31,0)
 N TIUDPRM,TIUY,SORT S TIUY=""
"RTN","TIUSRVR1",32,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,TIUDA,0)),.TIUDPRM,TIUDA)
"RTN","TIUSRVR1",33,0)
 S SORT=$S(+$P(TIUDPRM(0),U,18):"TITLE",1:"REFDT")
"RTN","TIUSRVR1",34,0)
 I +$G(^TIU(8925,TIUDA,21)) S TIUY=TIUDA_U_0_U_+$G(^(21))_U_SORT G SETGX
"RTN","TIUSRVR1",35,0)
 I +$O(^TIU(8925,"GDAD",TIUDA,0)) S TIUY=TIUDA_U_1_U_0_U_SORT
"RTN","TIUSRVR1",36,0)
SETGX Q TIUY
"RTN","TIUSRVR1",37,0)
LOADSUPP(METHOD,TIUDA,TIUL) ; Execute OnBrowse/Load Supplementary data
"RTN","TIUSRVR1",38,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIUSRVR1",39,0)
 X METHOD I '$D(@TIUY) Q
"RTN","TIUSRVR1",40,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR1",41,0)
 . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL,0)=$G(@TIUY@(TIUI))
"RTN","TIUSRVR1",42,0)
 S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL,0)=" "
"RTN","TIUSRVR1",43,0)
 K @TIUY
"RTN","TIUSRVR1",44,0)
 Q
"RTN","TIUSRVR1",45,0)
LOADTOP(TIUREC,TIUDA,TIUL,TIUGDATA,TIUCPF) ; Load top information
"RTN","TIUSRVR1",46,0)
 N TIUY,SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT
"RTN","TIUSRVR1",47,0)
 ; ---- For ID note, include Title, [Location, & Visit] with each
"RTN","TIUSRVR1",48,0)
 ;      entry, since they vary by entry.
"RTN","TIUSRVR1",49,0)
 ; ---- Follow with Date, Author, etc.
"RTN","TIUSRVR1",50,0)
 ; ---- For ID children in whole note display, shorten top info:
"RTN","TIUSRVR1",51,0)
 ;      Instead of Title, Location, Visit, Date, Author, etc.,
"RTN","TIUSRVR1",52,0)
 ;      use just Title, followed by just Date and Status:
"RTN","TIUSRVR1",53,0)
 S (SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT)=0
"RTN","TIUSRVR1",54,0)
 I $P(TIUGDATA,U,3) S SELCHLD=1 ; Selected record was IDchild
"RTN","TIUSRVR1",55,0)
 I $P(TIUGDATA,U,2) S SELPRNT=1
"RTN","TIUSRVR1",56,0)
 I SELCHLD,TIUDA'=$P(TIUGDATA,U,3) S CURCHLD=1 ; Current rec is IDchild
"RTN","TIUSRVR1",57,0)
 I SELCHLD,TIUDA=$P(TIUGDATA,U,3) S CURPRNT=1
"RTN","TIUSRVR1",58,0)
 I SELPRNT,TIUDA=+TIUGDATA S CURPRNT=1
"RTN","TIUSRVR1",59,0)
 I SELPRNT,TIUDA'=+TIUGDATA S CURCHLD=1
"RTN","TIUSRVR1",60,0)
 I SELPRNT,CURCHLD S SHORT=1 ;Child in whole note: shorten top info
"RTN","TIUSRVR1",61,0)
 I SELCHLD,CURCHLD,$G(TIUGWHOL) S SHORT=1
"RTN","TIUSRVR1",62,0)
 I SELCHLD!SELPRNT D IDTOP(TIUDA,.TIUL,SHORT,CURPRNT) I 1
"RTN","TIUSRVR1",63,0)
 S TIUY=""
"RTN","TIUSRVR1",64,0)
 E  I $L(TIUREC(8925,+TIUDA,.01)) D
"RTN","TIUSRVR1",65,0)
 . S TIUY=$$SETSTR^VALM1("TITLE: "_TIUREC(8925,+TIUDA,.01),TIUY,8,64)
"RTN","TIUSRVR1",66,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",67,0)
 S TIUY=""
"RTN","TIUSRVR1",68,0)
 I SHORT D
"RTN","TIUSRVR1",69,0)
 . S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),TIUY,1,39)
"RTN","TIUSRVR1",70,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),TIUY,42,38)
"RTN","TIUSRVR1",71,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",72,0)
 S TIUY=""
"RTN","TIUSRVR1",73,0)
 I 'SHORT D
"RTN","TIUSRVR1",74,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUSRVR1",75,0)
 . . S TIUY=$$SETSTR^VALM1("DICT DATE: "_TIUREC(8925,+TIUDA,1307),TIUY,4,39)
"RTN","TIUSRVR1",76,0)
 . E  S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),TIUY,1,39)
"RTN","TIUSRVR1",77,0)
 . S TIUY=$$SETSTR^VALM1("ENTRY DATE: "_TIUREC(8925,+TIUDA,1201),$G(TIUY),38,39)
"RTN","TIUSRVR1",78,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",79,0)
 . S TIUY=""
"RTN","TIUSRVR1",80,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUSRVR1",81,0)
 . . S TIUY=$$SETSTR^VALM1("DICTATED BY: "_TIUREC(8925,+TIUDA,1202),TIUY,2,32)
"RTN","TIUSRVR1",82,0)
 . E  S TIUY=$$SETSTR^VALM1("AUTHOR: "_TIUREC(8925,+TIUDA,1202),TIUY,7,32)
"RTN","TIUSRVR1",83,0)
 . I +$G(^TIU(8925,+TIUDA,0))=$$CHKFILE^TIUADCL(8925.1,"OPERATION REPORT","I $P(^(0),U,4)=""DOC""") S TIUY=$$SETSTR^VALM1("    SURGEON: "_TIUREC(8925,+TIUDA,1202),TIUY,2,32)
"RTN","TIUSRVR1",84,0)
 . I $L(TIUREC(8925,+TIUDA,1209)) D  I 1
"RTN","TIUSRVR1",85,0)
 . . S TIUY=$$SETSTR^VALM1("ATTENDING: "_TIUREC(8925,+TIUDA,1209),TIUY,39,40)
"RTN","TIUSRVR1",86,0)
 . E  S TIUY=$$SETSTR^VALM1("EXP COSIGNER: "_TIUREC(8925,+TIUDA,1208),TIUY,36,40)
"RTN","TIUSRVR1",87,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",88,0)
 . S TIUY=""
"RTN","TIUSRVR1",89,0)
 . S TIUY=$$SETSTR^VALM1("URGENCY: "_TIUREC(8925,+TIUDA,.09),TIUY,6,36)
"RTN","TIUSRVR1",90,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),TIUY,42,38)
"RTN","TIUSRVR1",91,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",92,0)
 ; * 173 
"RTN","TIUSRVR1",93,0)
 I TIUREC(8925,+TIUDA,.05)="UNCOSIGNED" D
"RTN","TIUSRVR1",94,0)
 . S TIUY="",TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",95,0)
 . S TIUY="",TIUL=TIUL+1,TIUY=$$SETSTR^VALM1("*** NOT YET COSIGNED ***",TIUY,20,51),@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",96,0)
 S TIUY=""
"RTN","TIUSRVR1",97,0)
 I '$L($G(^TIU(8925,+TIUDA,17))) D  I 1
"RTN","TIUSRVR1",98,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",99,0)
 E  D
"RTN","TIUSRVR1",100,0)
 . S TIUY=$$SETSTR^VALM1("SUBJECT: "_$G(^TIU(8925,+TIUDA,17)),TIUY,6,74)
"RTN","TIUSRVR1",101,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",102,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR1",103,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRVR1",104,0)
 ; Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRVR1",105,0)
 I $G(TIUCPF) D
"RTN","TIUSRVR1",106,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUSRVR1",107,0)
 . S TIUY=$$SETSTR^VALM1("PROCEDURE SUMMARY CODE: "_TIUREC(8925,+TIUDA,70201),$G(TIUY),1,54)
"RTN","TIUSRVR1",108,0)
 . S @TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",109,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUSRVR1",110,0)
 . S TIUY=$$SETSTR^VALM1("DATE/TIME PERFORMED: "_TIUREC(8925,+TIUDA,70202),$G(TIUY),1,41)
"RTN","TIUSRVR1",111,0)
 . S @TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",112,0)
 . S TIUL=TIUL+1,TIUY="",@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",113,0)
 I +$$HASADDEN^TIULC1(TIUDA) D
"RTN","TIUSRVR1",114,0)
 . S TIUY="   *** "_$$PNAME^TIULC1(+$G(^TIU(8925,TIUDA,0)))
"RTN","TIUSRVR1",115,0)
 . S TIUY=TIUY_" Has ADDENDA ***"
"RTN","TIUSRVR1",116,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",117,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR1",118,0)
 Q
"RTN","TIUSRVR1",119,0)
 ;
"RTN","TIUSRVR1",120,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUSRVR1",121,0)
 N TIUY,TIUTYP
"RTN","TIUSRVR1",122,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUSRVR1",123,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUSRVR1",124,0)
 Q TIUY
"RTN","TIUSRVR1",125,0)
IDTOP(TIUDA,TIUL,SHORT,CURPRNT) ; Load entry-specific info:
"RTN","TIUSRVR1",126,0)
 ;Title, [Location, Visit] for ID entry.
"RTN","TIUSRVR1",127,0)
 ; Called by LOADTOP
"RTN","TIUSRVR1",128,0)
 N TIUY,TIUX,TIU
"RTN","TIUSRVR1",129,0)
 I CURPRNT S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="                         << Interdisciplinary Note >>"
"RTN","TIUSRVR1",130,0)
 I SHORT S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="                      << Interdisciplinary Note - Cont. >>"
"RTN","TIUSRVR1",131,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUSRVR1",132,0)
 S TIUY="",TIUX="TITLE: "_$P($G(TIU("DOCTYP")),U,2)
"RTN","TIUSRVR1",133,0)
 S TIUY=$$SETSTR^VALM1(TIUX,TIUY,1,67)
"RTN","TIUSRVR1",134,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",135,0)
 Q:SHORT
"RTN","TIUSRVR1",136,0)
 S TIUY="",TIUX="LOCATION: "_$P($G(TIU("LOC")),U,2)
"RTN","TIUSRVR1",137,0)
 S TIUY=$$SETSTR^VALM1(TIUX,TIUY,5,31)
"RTN","TIUSRVR1",138,0)
 I $L($G(TIU("WARD"))) D  I 1
"RTN","TIUSRVR1",139,0)
 . S TIUX="ADMISSION DATE: "_$P($G(TIU("EDT")),U,2)
"RTN","TIUSRVR1",140,0)
 . S TIUY=$$SETSTR^VALM1(TIUX,TIUY,34,37)
"RTN","TIUSRVR1",141,0)
 E  D
"RTN","TIUSRVR1",142,0)
 . S TIUX="VISIT DATE: "_$P($G(TIU("EDT")),U,2)
"RTN","TIUSRVR1",143,0)
 . S TIUY=$$SETSTR^VALM1(TIUX,TIUY,38,33)
"RTN","TIUSRVR1",144,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR1",145,0)
 Q
"VER")
8.0^22.0
"BLD",16541,6)
^SEQ #185
**END**
**END**
