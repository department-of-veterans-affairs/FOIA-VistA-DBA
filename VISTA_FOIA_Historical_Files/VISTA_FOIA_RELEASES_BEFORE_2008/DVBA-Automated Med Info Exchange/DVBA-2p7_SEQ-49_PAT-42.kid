Released DVBA*2.7*42 SEQ #49
Extracted from mail message
**KIDS**:DVBA*2.7*42^

**INSTALL NAME**
DVBA*2.7*42
"BLD",3303,0)
DVBA*2.7*42^AUTOMATED MED INFO EXCHANGE^0^3030714^y
"BLD",3303,1,0)
^^1^1^3030521^
"BLD",3303,1,1,0)
Vista changes for CAPRI GUI DVBA*2.7*45.
"BLD",3303,4,0)
^9.64PA^396.15^1
"BLD",3303,4,396.15,0)
396.15
"BLD",3303,4,396.15,222)
y^y^f^^^^n
"BLD",3303,4,"B",396.15,396.15)

"BLD",3303,"ABPKG")
n
"BLD",3303,"INID")
n^n^n
"BLD",3303,"KRN",0)
^9.67PA^8989.52^19
"BLD",3303,"KRN",.4,0)
.4
"BLD",3303,"KRN",.4,"NM",0)
^9.68A^^
"BLD",3303,"KRN",.401,0)
.401
"BLD",3303,"KRN",.402,0)
.402
"BLD",3303,"KRN",.403,0)
.403
"BLD",3303,"KRN",.5,0)
.5
"BLD",3303,"KRN",.84,0)
.84
"BLD",3303,"KRN",3.6,0)
3.6
"BLD",3303,"KRN",3.8,0)
3.8
"BLD",3303,"KRN",9.2,0)
9.2
"BLD",3303,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",3303,"KRN",9.8,0)
9.8
"BLD",3303,"KRN",9.8,"NM",0)
^9.68A^80^17
"BLD",3303,"KRN",9.8,"NM",4,0)
DVBAB82^^0^B74796139
"BLD",3303,"KRN",9.8,"NM",61,0)
DVBAB89^^0^B3353747
"BLD",3303,"KRN",9.8,"NM",62,0)
DVBCLABR^^0^B7416408
"BLD",3303,"KRN",9.8,"NM",63,0)
DVBACRRR^^0^B17987233
"BLD",3303,"KRN",9.8,"NM",65,0)
DVBAB1^^0^B74103874
"BLD",3303,"KRN",9.8,"NM",66,0)
DVBAB2^^0^B16723785
"BLD",3303,"KRN",9.8,"NM",69,0)
DVBAB3^^0^B4966234
"BLD",3303,"KRN",9.8,"NM",71,0)
DVBASRP1^^0^B4301115
"BLD",3303,"KRN",9.8,"NM",72,0)
DVBCRPRT^^0^B14221604
"BLD",3303,"KRN",9.8,"NM",73,0)
DVBCBULL^^0^B15506228
"BLD",3303,"KRN",9.8,"NM",74,0)
DVBCROPN^^0^B27642320
"BLD",3303,"KRN",9.8,"NM",75,0)
DVBCBUL1^^0^B7938885
"BLD",3303,"KRN",9.8,"NM",76,0)
DVBAB57^^0^B14003695
"BLD",3303,"KRN",9.8,"NM",77,0)
DVBCPATA^^0^B9845601
"BLD",3303,"KRN",9.8,"NM",78,0)
DVBAADRP^^0^B27834282
"BLD",3303,"KRN",9.8,"NM",79,0)
DVBADSNT^^0^B23841246
"BLD",3303,"KRN",9.8,"NM",80,0)
DVBAB70^^0^B38801935
"BLD",3303,"KRN",9.8,"NM","B","DVBAADRP",78)

"BLD",3303,"KRN",9.8,"NM","B","DVBAB1",65)

"BLD",3303,"KRN",9.8,"NM","B","DVBAB2",66)

"BLD",3303,"KRN",9.8,"NM","B","DVBAB3",69)

"BLD",3303,"KRN",9.8,"NM","B","DVBAB57",76)

"BLD",3303,"KRN",9.8,"NM","B","DVBAB70",80)

"BLD",3303,"KRN",9.8,"NM","B","DVBAB82",4)

"BLD",3303,"KRN",9.8,"NM","B","DVBAB89",61)

"BLD",3303,"KRN",9.8,"NM","B","DVBACRRR",63)

"BLD",3303,"KRN",9.8,"NM","B","DVBADSNT",79)

"BLD",3303,"KRN",9.8,"NM","B","DVBASRP1",71)

"BLD",3303,"KRN",9.8,"NM","B","DVBCBUL1",75)

"BLD",3303,"KRN",9.8,"NM","B","DVBCBULL",73)

"BLD",3303,"KRN",9.8,"NM","B","DVBCLABR",62)

"BLD",3303,"KRN",9.8,"NM","B","DVBCPATA",77)

"BLD",3303,"KRN",9.8,"NM","B","DVBCROPN",74)

"BLD",3303,"KRN",9.8,"NM","B","DVBCRPRT",72)

"BLD",3303,"KRN",19,0)
19
"BLD",3303,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",3303,"KRN",19,"NM",1,0)
DVBA CAPRI GUI^^0
"BLD",3303,"KRN",19,"NM","B","DVBA CAPRI GUI",1)

"BLD",3303,"KRN",19.1,0)
19.1
"BLD",3303,"KRN",19.1,"NM",0)
^9.68A^2^2
"BLD",3303,"KRN",19.1,"NM",1,0)
DVBA CAPRI EXAM LIST EDIT^^0
"BLD",3303,"KRN",19.1,"NM",2,0)
DVBA CAPRI READ ONLY^^0
"BLD",3303,"KRN",19.1,"NM","B","DVBA CAPRI EXAM LIST EDIT",1)

"BLD",3303,"KRN",19.1,"NM","B","DVBA CAPRI READ ONLY",2)

"BLD",3303,"KRN",101,0)
101
"BLD",3303,"KRN",101,"NM",0)
^9.68A^^
"BLD",3303,"KRN",409.61,0)
409.61
"BLD",3303,"KRN",771,0)
771
"BLD",3303,"KRN",771,"NM",0)
^9.68A^^
"BLD",3303,"KRN",870,0)
870
"BLD",3303,"KRN",8989.51,0)
8989.51
"BLD",3303,"KRN",8989.52,0)
8989.52
"BLD",3303,"KRN",8994,0)
8994
"BLD",3303,"KRN",8994,"NM",0)
^9.68A^22^10
"BLD",3303,"KRN",8994,"NM",11,0)
DVBAB REPORTS^^0
"BLD",3303,"KRN",8994,"NM",14,0)
DVBAB TEAM PATIENTS^^0
"BLD",3303,"KRN",8994,"NM",15,0)
DVBAB SURGERY CASE^^0
"BLD",3303,"KRN",8994,"NM",16,0)
DVBAB ORIGINAL PROCESSING DATE^^0
"BLD",3303,"KRN",8994,"NM",17,0)
DVBAB MAIL INIT^^0
"BLD",3303,"KRN",8994,"NM",18,0)
DVBAB VERSION^^0
"BLD",3303,"KRN",8994,"NM",19,0)
DVBAB MPI ASSIGN ICN^^0
"BLD",3303,"KRN",8994,"NM",20,0)
DVBAB REPORT ADMISSION INQUIRY^^0
"BLD",3303,"KRN",8994,"NM",21,0)
DVBAB REPORT ADMINQ^^0
"BLD",3303,"KRN",8994,"NM",22,0)
DVBAB REPORT NEW NOTICES DC^^0
"BLD",3303,"KRN",8994,"NM","B","DVBAB MAIL INIT",17)

"BLD",3303,"KRN",8994,"NM","B","DVBAB MPI ASSIGN ICN",19)

"BLD",3303,"KRN",8994,"NM","B","DVBAB ORIGINAL PROCESSING DATE",16)

"BLD",3303,"KRN",8994,"NM","B","DVBAB REPORT ADMINQ",21)

"BLD",3303,"KRN",8994,"NM","B","DVBAB REPORT ADMISSION INQUIRY",20)

"BLD",3303,"KRN",8994,"NM","B","DVBAB REPORT NEW NOTICES DC",22)

"BLD",3303,"KRN",8994,"NM","B","DVBAB REPORTS",11)

"BLD",3303,"KRN",8994,"NM","B","DVBAB SURGERY CASE",15)

"BLD",3303,"KRN",8994,"NM","B","DVBAB TEAM PATIENTS",14)

"BLD",3303,"KRN",8994,"NM","B","DVBAB VERSION",18)

"BLD",3303,"KRN","B",.4,.4)

"BLD",3303,"KRN","B",.401,.401)

"BLD",3303,"KRN","B",.402,.402)

"BLD",3303,"KRN","B",.403,.403)

"BLD",3303,"KRN","B",.5,.5)

"BLD",3303,"KRN","B",.84,.84)

"BLD",3303,"KRN","B",3.6,3.6)

"BLD",3303,"KRN","B",3.8,3.8)

"BLD",3303,"KRN","B",9.2,9.2)

"BLD",3303,"KRN","B",9.8,9.8)

"BLD",3303,"KRN","B",19,19)

"BLD",3303,"KRN","B",19.1,19.1)

"BLD",3303,"KRN","B",101,101)

"BLD",3303,"KRN","B",409.61,409.61)

"BLD",3303,"KRN","B",771,771)

"BLD",3303,"KRN","B",870,870)

"BLD",3303,"KRN","B",8989.51,8989.51)

"BLD",3303,"KRN","B",8989.52,8989.52)

"BLD",3303,"KRN","B",8994,8994)

"BLD",3303,"QUES",0)
^9.62^^
"BLD",3303,"REQB",0)
^9.611^2^2
"BLD",3303,"REQB",1,0)
DG*5.3*487^2
"BLD",3303,"REQB",2,0)
DVBA*2.7*50^2
"BLD",3303,"REQB","B","DG*5.3*487",1)

"BLD",3303,"REQB","B","DVBA*2.7*50",2)

"FIA",396.15)
CAPRI DIVISION EXAM LIST
"FIA",396.15,0)
^DVB(396.15,
"FIA",396.15,0,0)
396.15P
"FIA",396.15,0,1)
y^y^f^^^^n
"FIA",396.15,0,10)

"FIA",396.15,0,11)

"FIA",396.15,0,"RLRO")

"FIA",396.15,0,"VR")
2.7^DVBA
"FIA",396.15,396.15)
0
"FIA",396.15,396.151)
0
"FIA",396.15,396.1511)
0
"FIA",396.15,396.1514)
0
"FIA",396.15,396.15141)
0
"FIA",396.15,396.153)
0
"KRN",19,9510,-1)
0^1
"KRN",19,9510,0)
DVBA CAPRI GUI^Capri GUI (Broker)^^B^^^^^^^^AUTOMATED MED INFO EXCHANGE^^
"KRN",19,9510,1,0)
^19.06^2^2^3030106^^^^
"KRN",19,9510,1,1,0)
This is the 'B' type option used by CAPRI GUI client application. It
"KRN",19,9510,1,2,0)
contains all the RPCs used by the CAPRI GUI application.
"KRN",19,9510,20)

"KRN",19,9510,25)

"KRN",19,9510,99.1)
59337,55353
"KRN",19,9510,"RPC",0)
^19.05P^89^89
"KRN",19,9510,"RPC",1,0)
DVBAB REPORT LISTS
"KRN",19,9510,"RPC",2,0)
DVBAB APPOINTMENT LIST
"KRN",19,9510,"RPC",3,0)
DVBAB CHECK CREDENTIALS
"KRN",19,9510,"RPC",4,0)
DVBAB FIND EXAMS
"KRN",19,9510,"RPC",5,0)
DVBAB PTINQ
"KRN",19,9510,"RPC",6,0)
DVBAB INCREASE EXAM COUNT
"KRN",19,9510,"RPC",7,0)
DVBAB SEND MSG
"KRN",19,9510,"RPC",8,0)
DVBAB REPORT CHECKLIST
"KRN",19,9510,"RPC",9,0)
DDR FILER
"KRN",19,9510,"RPC",10,0)
DDR LISTER
"KRN",19,9510,"RPC",11,0)
DDR VALIDATOR
"KRN",19,9510,"RPC",12,0)
DDR GETS ENTRY DATA
"KRN",19,9510,"RPC",14,0)
XWB GET VARIABLE VALUE
"KRN",19,9510,"RPC",15,0)
DVBAB HEALTH SUMMARY TEXT
"KRN",19,9510,"RPC",16,0)
TIU DOCUMENTS BY CONTEXT
"KRN",19,9510,"RPC",17,0)
TIU GET RECORD TEXT
"KRN",19,9510,"RPC",18,0)
ORQQCN LIST
"KRN",19,9510,"RPC",19,0)
ORQQCN DETAIL
"KRN",19,9510,"RPC",20,0)
DVBAB INST LIST
"KRN",19,9510,"RPC",22,0)
ORWRP REPORT TEXT
"KRN",19,9510,"RPC",23,0)
ORWORR AGET
"KRN",19,9510,"RPC",24,0)
ORWRA IMAGING EXAMS
"KRN",19,9510,"RPC",25,0)
ORWRP1 LISTNUTR
"KRN",19,9510,"RPC",26,0)
ORWMC PATIENT PROCEDURES
"KRN",19,9510,"RPC",27,0)
ORQQPL PROBLEM LIST
"KRN",19,9510,"RPC",28,0)
ORWORR GET4LST
"KRN",19,9510,"RPC",29,0)
ORWLR CUMULATIVE REPORT
"KRN",19,9510,"RPC",32,0)
DVBAB DATETIME
"KRN",19,9510,"RPC",34,0)
ORWPT ADMITLST
"KRN",19,9510,"RPC",35,0)
DVBAB SC VETERAN REPORT
"KRN",19,9510,"RPC",36,0)
ORQQVS VISITS/APPTS
"KRN",19,9510,"RPC",37,0)
ORWU DT
"KRN",19,9510,"RPC",38,0)
ORWLRR CHART
"KRN",19,9510,"RPC",39,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,9510,"RPC",40,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,9510,"RPC",41,0)
DVBAB REPORT EXAM CHKLIST
"KRN",19,9510,"RPC",42,0)
DVBAB REPORT ADMINQ
"KRN",19,9510,"RPC",43,0)
DVBAB REPORT INCOMPVET
"KRN",19,9510,"RPC",44,0)
DVBAB REPORT DISCHARGE
"KRN",19,9510,"RPC",45,0)
DVBAB REPORT READMIT
"KRN",19,9510,"RPC",46,0)
DVBAB REPORT ADMISSIONS
"KRN",19,9510,"RPC",47,0)
DVBAB REPORT 7131INQ
"KRN",19,9510,"RPC",48,0)
DVBAB PENDING C&P REPORT
"KRN",19,9510,"RPC",49,0)
DVBAB REPORT CPDETAILS
"KRN",19,9510,"RPC",50,0)
DVBAB AMIS REPORT
"KRN",19,9510,"RPC",51,0)
DVBAB REPORT PENDING7131
"KRN",19,9510,"RPC",52,0)
DVBAB LABLIST
"KRN",19,9510,"RPC",53,0)
DVBAB VERSION
"KRN",19,9510,"RPC",54,0)
DDR DELETE ENTRY
"KRN",19,9510,"RPC",55,0)
ORWRP REPORT LISTS
"KRN",19,9510,"RPC",57,0)
DVBAB DIVISION
"KRN",19,9510,"RPC",58,0)
DVBAB TEAM PATIENTS
"KRN",19,9510,"RPC",59,0)
ORWCIRN FACLIST
"KRN",19,9510,"RPC",60,0)
XWB REMOTE STATUS CHECK
"KRN",19,9510,"RPC",61,0)
XWB REMOTE GETDATA
"KRN",19,9510,"RPC",63,0)
ORWPT DIEDON
"KRN",19,9510,"RPC",66,0)
XWB REMOTE RPC
"KRN",19,9510,"RPC",67,0)
DDR FINDER
"KRN",19,9510,"RPC",68,0)
DDR FIND1
"KRN",19,9510,"RPC",69,0)
DVBAB REPORTS
"KRN",19,9510,"RPC",70,0)
ORWRP2 COMPABV
"KRN",19,9510,"RPC",71,0)
DVBAB SURGERY CASE
"KRN",19,9510,"RPC",72,0)
ORWRP2 COMPDISP
"KRN",19,9510,"RPC",73,0)
ORWRP2 HS COMPONENTS
"KRN",19,9510,"RPC",74,0)
ORWRP2 HS COMPONENT SUBS
"KRN",19,9510,"RPC",75,0)
ORWRP2 HS COMP FILES
"KRN",19,9510,"RPC",76,0)
ORWRP2 SAVLKUP
"KRN",19,9510,"RPC",77,0)
ORWRP2 HS REPORT TEXT
"KRN",19,9510,"RPC",78,0)
ORWRP2 GETLKUP
"KRN",19,9510,"RPC",79,0)
ORWRP2 HS FILE LOOKUP
"KRN",19,9510,"RPC",80,0)
ORWRP2 HS SUBITEMS
"KRN",19,9510,"RPC",81,0)
DVBAB MAIL INIT
"KRN",19,9510,"RPC",82,0)
ORWLRR MICRO
"KRN",19,9510,"RPC",83,0)
TIU CREATE RECORD
"KRN",19,9510,"RPC",84,0)
DVBAB MPI ASSIGN ICN
"KRN",19,9510,"RPC",85,0)
TIU SIGN RECORD
"KRN",19,9510,"RPC",86,0)
TIU DELETE RECORD
"KRN",19,9510,"RPC",87,0)
TIU REQUIRES COSIGNATURE
"KRN",19,9510,"RPC",88,0)
DVBAB REPORT ADMISSION INQUIRY
"KRN",19,9510,"RPC",89,0)
DVBAB REPORT NEW NOTICES DC
"KRN",19,9510,"U")
CAPRI GUI (BROKER)
"KRN",19.1,379,-1)
0^1
"KRN",19.1,379,0)
DVBA CAPRI EXAM LIST EDIT^^l^n
"KRN",19.1,379,1,0)
^^4^4^3020610^
"KRN",19.1,379,1,1,0)
This key allows a user to edit the exams and comments associated with a 
"KRN",19.1,379,1,2,0)
specific medical center division through the use of the CAPRI GUI.  If a 
"KRN",19.1,379,1,3,0)
user does not have this key, then the option will not be visible on their 
"KRN",19.1,379,1,4,0)
CAPRI GUI Tools menu.
"KRN",19.1,406,-1)
0^2
"KRN",19.1,406,0)
DVBA CAPRI READ ONLY^^
"KRN",19.1,406,1,0)
^^2^2^3030516^
"KRN",19.1,406,1,1,0)
Holders of this key will be forced into read-only mode when they use the 
"KRN",19.1,406,1,2,0)
CAPRI GUI.
"KRN",8994,751,-1)
0^21
"KRN",8994,751,0)
DVBAB REPORT ADMINQ^ENBROKE2^DVBAADRP^4^R
"KRN",8994,751,1,0)
^8994.01^1^1^3030516^^^^
"KRN",8994,751,1,1,0)
Returns an admission inquiry report for the specified date range.
"KRN",8994,751,2,0)
^8994.02A^4^4
"KRN",8994,751,2,1,0)
BDATE^1^^1^1
"KRN",8994,751,2,2,0)
EDATE^1^^1^2
"KRN",8994,751,2,3,0)
ROYESNO^1
"KRN",8994,751,2,4,0)
RONUM^1
"KRN",8994,751,2,"B","BDATE",1)

"KRN",8994,751,2,"B","EDATE",2)

"KRN",8994,751,2,"B","RONUM",4)

"KRN",8994,751,2,"B","ROYESNO",3)

"KRN",8994,751,2,"PARAMSEQ",1,1)

"KRN",8994,751,2,"PARAMSEQ",2,2)

"KRN",8994,760,-1)
0^18
"KRN",8994,760,0)
DVBAB VERSION^VERSION^DVBAB1^1^R
"KRN",8994,760,1,0)
^8994.01^1^1^3030506^^^^
"KRN",8994,760,1,1,0)
Used to ensure GUI and VISTA are on the same version of CAPRI.
"KRN",8994,760,2,0)
^8994.02A^1^1
"KRN",8994,760,2,1,0)
DVBGUIV^1
"KRN",8994,760,2,1,1,0)
^8994.021^2^2^3030418^^
"KRN",8994,760,2,1,1,1,0)
Version # of CAPRI GUI.  Sets a variable DVBABVx so that the error trap 
"KRN",8994,760,2,1,1,2,0)
will display what version of the client software the user was utilizing.
"KRN",8994,760,2,"B","DVBGUIV",1)

"KRN",8994,1434,-1)
0^14
"KRN",8994,1434,0)
DVBAB TEAM PATIENTS^TEAMPTS^DVBAB1^4^S
"KRN",8994,1434,1,0)
^8994.01^1^1^3011116^^
"KRN",8994,1434,1,1,0)
Function returns an array of patients on a team.
"KRN",8994,1434,2,0)
^8994.02A^1^1
"KRN",8994,1434,2,1,0)
TEAM ID^1^16^1
"KRN",8994,1434,2,1,1,0)
^8994.021^1^1^3011116^^
"KRN",8994,1434,2,1,1,1,0)
The record number from the OE/RR Team File (#100.21).
"KRN",8994,1434,2,"B","TEAM ID",1)

"KRN",8994,1434,3,0)
^^1^1^2950608^
"KRN",8994,1434,3,1,0)
Array of patients on a team in the format: patient id (DFN)^patient name.
"KRN",8994,1496,-1)
0^11
"KRN",8994,1496,0)
DVBAB REPORTS^START^DVBAB82^4^R^0
"KRN",8994,1496,1,0)
^8994.01^1^1^3021209^^^^
"KRN",8994,1496,1,1,0)
CAPRI REGIONAL OFFICE 21 DAY CERTIFICATE PRINTING
"KRN",8994,1496,2,0)
^8994.02A^2^2
"KRN",8994,1496,2,1,0)
REPORT TYPE^1^^1
"KRN",8994,1496,2,2,0)
REPORT STRING^1
"KRN",8994,1496,2,"B","REPORT STRING",2)

"KRN",8994,1496,2,"B","REPORT TYPE",1)

"KRN",8994,1528,-1)
0^17
"KRN",8994,1528,0)
DVBAB MAIL INIT^INIT^DVBAB3^1^R
"KRN",8994,1528,1,0)
^8994.01^3^3^3030116^^^^
"KRN",8994,1528,1,1,0)
Init Mailman variables.
"KRN",8994,1528,1,2,0)
Return string:
"KRN",8994,1528,1,3,0)
e-mail address^
"KRN",8994,1529,-1)
0^15
"KRN",8994,1529,0)
DVBAB SURGERY CASE^START^DVBAB89^4^P
"KRN",8994,1529,2,0)
^8994.02A^1^1
"KRN",8994,1529,2,1,0)
DFN^1^^1^1
"KRN",8994,1529,2,"B","DFN",1)

"KRN",8994,1529,2,"PARAMSEQ",1,1)

"KRN",8994,1657,-1)
0^16
"KRN",8994,1657,0)
DVBAB ORIGINAL PROCESSING DATE^XDA^DVBAB89^4^P^0
"KRN",8994,1657,2,0)
^8994.02A^1^1
"KRN",8994,1657,2,1,0)
DFN^1^^1^1
"KRN",8994,1657,2,"B","DFN",1)

"KRN",8994,1657,2,"PARAMSEQ",1,1)

"KRN",8994,1829,-1)
0^19
"KRN",8994,1829,0)
DVBAB MPI ASSIGN ICN^MPI^DVBCPATA^1
"KRN",8994,1829,1,0)
^8994.01^3^3^3030509^
"KRN",8994,1829,1,1,0)
This call should be made after a new patient is added into the patient 
"KRN",8994,1829,1,2,0)
file.  It will call the MPI to assign an ICN.  If no ICN can be obtained 
"KRN",8994,1829,1,3,0)
after 30 seconds, a local ICN will be assigned and the local ICN flag set.
"KRN",8994,1829,2,0)
^8994.02A^1^1
"KRN",8994,1829,2,1,0)
DFN^1^^1
"KRN",8994,1829,2,"B","DFN",1)

"KRN",8994,1830,-1)
0^20
"KRN",8994,1830,0)
DVBAB REPORT ADMISSION INQUIRY^ENBROKER^DVBAADRP^2^S
"KRN",8994,1830,1,0)
^8994.01^1^1^3030516^^
"KRN",8994,1830,1,1,0)
Returns display text indicating when the report was last run
"KRN",8994,1831,-1)
0^22
"KRN",8994,1831,0)
DVBAB REPORT NEW NOTICES DC^ENBROKER^DVBADSNT^4^R^^^0
"KRN",8994,1831,1,0)
^^2^2^3030520^
"KRN",8994,1831,1,1,0)
Broker-enabled version of option DVBA NOTICE/DISCHARGE PRINT, Print New
"KRN",8994,1831,1,2,0)
Notices of Discharge.
"MBREQ")
0
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^3010328
"PKG",223,22,1,"PAH",1,0)
42^3030714^123456872
"PKG",223,22,1,"PAH",1,1,0)
^^1^1^3030714
"PKG",223,22,1,"PAH",1,1,1,0)
Vista changes for CAPRI GUI DVBA*2.7*45.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
17
"RTN","DVBAADRP")
0^78^B27834282
"RTN","DVBAADRP",1,0)
DVBAADRP ;ALB/GTS-557/THM-AMIE COMPLETE ADMISSION RPT ; 1/22/91  1:19 PM
"RTN","DVBAADRP",2,0)
 ;;2.7;AMIE;**17,42**;Apr 10, 1995
"RTN","DVBAADRP",3,0)
 N DVBGUI
"RTN","DVBAADRP",4,0)
 S DVBGUI=0
"RTN","DVBAADRP",5,0)
 K ^TMP($J) G TERM
"RTN","DVBAADRP",6,0)
 Q
"RTN","DVBAADRP",7,0)
ENBROKER(Y) ;
"RTN","DVBAADRP",8,0)
 ; Returns some info for the CAPRI GUI to display prior
"RTN","DVBAADRP",9,0)
 ; to the user running this report
"RTN","DVBAADRP",10,0)
 N DVBGUI
"RTN","DVBAADRP",11,0)
 S DVBGUI=1
"RTN","DVBAADRP",12,0)
 K ^TMP($J)
"RTN","DVBAADRP",13,0)
 D HOME^%ZIS K NOASK,QUIT1
"RTN","DVBAADRP",14,0)
 D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBAADRP",15,0)
 ;
"RTN","DVBAADRP",16,0)
 S Y(1)="VARO COMPLETE ADMISSION REPORT" S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAADRP",17,0)
 S HEAD="TOTAL ADMISSION REPORT",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAADRP",18,0)
 S Y(2)=HEAD1,Y(3)=""
"RTN","DVBAADRP",19,0)
 S Y(4)="Please enter dates for search, oldest date first, most recent date last."
"RTN","DVBAADRP",20,0)
 S Y=$P(DTAR,U,3) X ^DD("DD")
"RTN","DVBAADRP",21,0)
 S Y(5)=""
"RTN","DVBAADRP",22,0)
 S Y(6)="Last report was run on "_Y
"RTN","DVBAADRP",23,0)
 Q
"RTN","DVBAADRP",24,0)
ENBROKE2(MSG,BDATE,EDATE,RO,RONUM) ;
"RTN","DVBAADRP",25,0)
 ; This is the entry point to run the actual report from
"RTN","DVBAADRP",26,0)
 ; the CAPRI GUI.
"RTN","DVBAADRP",27,0)
 N DVBHFS,DVBERR,DVBGUI,I
"RTN","DVBAADRP",28,0)
 K ^TMP("DVBA",$J)
"RTN","DVBAADRP",29,0)
 S DVBGUI=1,DVBERR=0,DVBHFS=$$HFS^DVBAB82()
"RTN","DVBAADRP",30,0)
 S X=BDATE,Y=EDATE
"RTN","DVBAADRP",31,0)
 S BDATE=BDATE+".5",EDATE=EDATE+".5"
"RTN","DVBAADRP",32,0)
 K ^TMP($J)
"RTN","DVBAADRP",33,0)
 D HOME^%ZIS K NOASK,QUIT1
"RTN","DVBAADRP",34,0)
 D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBAADRP",35,0)
 ;
"RTN","DVBAADRP",36,0)
 S HEAD="TOTAL ADMISSION REPORT",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAADRP",37,0)
 I $D(X) D
"RTN","DVBAADRP",38,0)
 . G:X=""!(Y<0) KILL S %ZIS="AEQ" D ^%ZIS K %ZIS
"RTN","DVBAADRP",39,0)
 D HFSOPEN^DVBAB82("DVBRP",DVBHFS,"W") I DVBERR D END^DVBAB82 Q
"RTN","DVBAADRP",40,0)
 I POP K DVBAON2,DCHPTR,M,Y,J G KILL^DVBAUTIL
"RTN","DVBAADRP",41,0)
 U IO
"RTN","DVBAADRP",42,0)
 D DEQUE
"RTN","DVBAADRP",43,0)
 D END^DVBAB82
"RTN","DVBAADRP",44,0)
 Q
"RTN","DVBAADRP",45,0)
SET Q:'$D(^DPT(DA,0))  S DFN=DA D RCV^DVBAVDPT Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)
"RTN","DVBAADRP",46,0)
 S ^TMP($J,XCN,CFLOC,MB,DA)=MA_U_RCVAA_U_RCVPEN_U_CNUM
"RTN","DVBAADRP",47,0)
 Q
"RTN","DVBAADRP",48,0)
 ;
"RTN","DVBAADRP",49,0)
PRINTB S MA=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),DFN=DA,QUIT1=1 D ADM^DVBAVDPT
"RTN","DVBAADRP",50,0)
 S:ADMDT]"" ADMDT=$$FMTE^XLFDT(ADMDT,"5DZ")
"RTN","DVBAADRP",51,0)
 S:DCHGDT]"" DCHGDT=$$FMTE^XLFDT(DCHGDT,"5DZ")
"RTN","DVBAADRP",52,0)
 W:(IOST?1"C-".E!($D(DVBAON2))) @IOF
"RTN","DVBAADRP",53,0)
 I DVBGUI=0 W !!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBAADRP",54,0)
 I DVBGUI=1 W !!
"RTN","DVBAADRP",55,0)
 W ?10,"Patient Name:",?26,PNAM,!!,?14,"Claim No:",?26,CNUM,!,?6,"Claim Folder Loc:",?26,CFLOC,!,?9,"Social Sec No:",?26,SSN,!,?8,"Admission Date:",?26,ADMDT,!,?3,"Admitting Diagnosis:",?26,DIAG,!
"RTN","DVBAADRP",56,0)
 W ?8,"Discharge Date:",?26,DCHGDT,!,?11,"Bed Service:",?26,BEDSEC,!,?13,"Recv A&A?:",?26,$S(RCVAA=0:"NO",RCVAA=1:"YES",1:"Not specified"),!
"RTN","DVBAADRP",57,0)
 W ?14,"Pension?:",?26,$S(RCVPEN=0:"NO",RCVPEN=1:"YES",1:"Not specified"),! D ELIG^DVBAVDPT I IOST'?1"C-".E S DVBAON2=""
"RTN","DVBAADRP",58,0)
 I IOST?1"C-".E DO
"RTN","DVBAADRP",59,0)
 .I ($O(^TMP($J,XCN))'=""!($O(^TMP($J,XCN,CFLOC))'=""!($O(^TMP($J,XCN,CFLOC,ADM))'=""!($O(^TMP($J,XCN,CFLOC,ADM,DA))'="")))) DO
"RTN","DVBAADRP",60,0)
 ..I DVBGUI=0 D
"RTN","DVBAADRP",61,0)
 ...W *7,!,"Press RETURN to continue or ""^"" to stop    "
"RTN","DVBAADRP",62,0)
 ...R ANS:DTIME
"RTN","DVBAADRP",63,0)
 ...S:ANS=U!('$T) QUIT=1
"RTN","DVBAADRP",64,0)
 ...I '$T S DVBAQUIT=1
"RTN","DVBAADRP",65,0)
 .I ($O(^TMP($J,XCN))=""&($O(^TMP($J,XCN,CFLOC))=""&($O(^TMP($J,XCN,CFLOC,ADM))=""&($O(^TMP($J,XCN,CFLOC,ADM,DA))="")))) DO
"RTN","DVBAADRP",66,0)
 ..I DVBGUI=0 D
"RTN","DVBAADRP",67,0)
 ...W *7,!,"Press RETURN to continue  "
"RTN","DVBAADRP",68,0)
 ...R ANS:DTIME
"RTN","DVBAADRP",69,0)
 Q
"RTN","DVBAADRP",70,0)
 ;
"RTN","DVBAADRP",71,0)
PRINT U IO S QUIT="" K MA,MB
"RTN","DVBAADRP",72,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBAADRP",73,0)
 Q
"RTN","DVBAADRP",74,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DATA=^(DA) D PRINTB
"RTN","DVBAADRP",75,0)
 Q
"RTN","DVBAADRP",76,0)
 ;
"RTN","DVBAADRP",77,0)
TERM D HOME^%ZIS K NOASK,QUIT1
"RTN","DVBAADRP",78,0)
 D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBAADRP",79,0)
 ;
"RTN","DVBAADRP",80,0)
SETUP W @IOF,!,"VARO COMPLETE ADMISSION REPORT" S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAADRP",81,0)
 S HEAD="TOTAL ADMISSION REPORT",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAADRP",82,0)
 W !,HEAD1
"RTN","DVBAADRP",83,0)
EN1 W !!,"Please enter dates for search, oldest date first, most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,3) X ^DD("DD") W Y,!!
"RTN","DVBAADRP",84,0)
 D DATE^DVBAUTIL
"RTN","DVBAADRP",85,0)
 G:X=""!(Y<0) KILL S %ZIS="AEQ" D ^%ZIS K %ZIS
"RTN","DVBAADRP",86,0)
 I POP K DVBAON2,DCHPTR,M,Y,J G KILL^DVBAUTIL
"RTN","DVBAADRP",87,0)
 ;
"RTN","DVBAADRP",88,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBAADRP",ZTIO=ION,NOASK=1,ZTDESC="AMIE ADMISSION REPORT" F I="BDATE","EDATE","HEAD","HEAD1","RO","RONUM","FDT(0)","NOASK" S ZTSAVE(I)=""
"RTN","DVBAADRP",89,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",!! G KILL
"RTN","DVBAADRP",90,0)
 ;
"RTN","DVBAADRP",91,0)
GO S MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV1",MA)) Q:$P(MA,".")>EDATE!(MA="")  W:'$D(NOASK) "." F DA=0:0 S DA=$O(^DGPM("AMV1",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV1",MA,DA,MB)) Q:MB=""  I MA'>EDATE D SET
"RTN","DVBAADRP",92,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found for parameters entered",!! H 2 G KILL
"RTN","DVBAADRP",93,0)
 I DVBGUI=1 W !,HEAD,!,HEAD1,!
"RTN","DVBAADRP",94,0)
 I $D(^TMP($J)) D PRINT I $D(DVBAQUIT) K DVBAON2,DCHPTR,M,Y,J G KILL^DVBAUTIL
"RTN","DVBAADRP",95,0)
 ;
"RTN","DVBAADRP",96,0)
KILL ;
"RTN","DVBAADRP",97,0)
 D ^%ZISC S X=3 K DVBAON2,DCHPTR,M,Y,J D:$D(ZTQUEUED) KILL^%ZTLOAD G FINAL^DVBAUTIL
"RTN","DVBAADRP",98,0)
 ;
"RTN","DVBAADRP",99,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBAB1")
0^65^B74103874
"RTN","DVBAB1",1,0)
DVBAB1 ;ALB/SPH - CAPRI UTILITIES ;01/01/00
"RTN","DVBAB1",2,0)
 ;;2.7;AMIE;**35,37,50,42**;Apr 10, 1995
"RTN","DVBAB1",3,0)
 ;
"RTN","DVBAB1",4,0)
VERSION(ZMSG,DVBGUIV) ;
"RTN","DVBAB1",5,0)
 ; Must have a letter at the end of the Version for Delphi
"RTN","DVBAB1",6,0)
 ; compatability
"RTN","DVBAB1",7,0)
 ; 1st piece is version description
"RTN","DVBAB1",8,0)
 ; 2nd piece can be YESOLD or NOOLD
"RTN","DVBAB1",9,0)
 ; YESOLD = Allow old GUI to run with new KID
"RTN","DVBAB1",10,0)
 ; NOOLD = Do not allow old GUI to run with newer version
"RTN","DVBAB1",11,0)
 S ZMSG="CAPRI GUI V2.7*41*1*A^NOOLD"
"RTN","DVBAB1",12,0)
 S DVBABVR1="CAPRI Server Version: "+ZMSG
"RTN","DVBAB1",13,0)
 I '$D(DVBGUIV) S DVBGUIV="CAPRI GUI Version: UNKNOWN - Version is prior to DVBA*2.7*45"
"RTN","DVBAB1",14,0)
 S DVBABVR2="CAPRI GUI Version: "+DVBGUIV
"RTN","DVBAB1",15,0)
 S DVBABVR3=$P(^VA(200,DUZ,0),"^",1)
"RTN","DVBAB1",16,0)
 Q 
"RTN","DVBAB1",17,0)
 ;
"RTN","DVBAB1",18,0)
REQUESTS(Y,TYPE) ;
"RTN","DVBAB1",19,0)
 ; TYPE is the internal value of field 17 in file 396.3
"RTN","DVBAB1",20,0)
 ; This relates to which status of request should be returned
"RTN","DVBAB1",21,0)
 N DVBABCNT,DVBABIEN
"RTN","DVBAB1",22,0)
 S DVBABCNT=0,DVBABIEN=0
"RTN","DVBAB1",23,0)
 F  S DVBABIEN=$O(^DVB(396.3,DVBABIEN)) Q:'DVBABIEN  D
"RTN","DVBAB1",24,0)
 .S DVBABST=$P($G(^DVB(396.3,DVBABIEN,0)),"^",18)
"RTN","DVBAB1",25,0)
 .I DVBABST=TYPE D
"RTN","DVBAB1",26,0)
 ..S DVBABNM=$P($G(^DVB(396.3,DVBABIEN,0)),"^",1)
"RTN","DVBAB1",27,0)
 ..S DVBABPT=DVBABNM
"RTN","DVBAB1",28,0)
 ..I DVBABNM'="" S DVBABNM=$P($G(^DPT(DVBABNM,0)),"^",1)
"RTN","DVBAB1",29,0)
 ..S DVBABDT=$$FMTE^XLFDT($P($G(^DVB(396.3,DVBABIEN,0)),"^",2),"2D")
"RTN","DVBAB1",30,0)
 ..S DVBABWHO=$P($G(^DVB(396.3,DVBABIEN,0)),"^",4)
"RTN","DVBAB1",31,0)
 ..I DVBABWHO'="" S DVBABWHO=$P($G(^VA(200,DVBABWHO,0)),"^",1)
"RTN","DVBAB1",32,0)
 ..I DVBABWHO="" S DVBABWHO="UNKNOWN"
"RTN","DVBAB1",33,0)
 ..S DVBABRO=$P($G(^DVB(396.3,DVBABIEN,0)),"^",3)
"RTN","DVBAB1",34,0)
 ..I DVBABRO'="" S DVBABRO=$P($G(^DIC(4,DVBABRO,0)),"^",1)
"RTN","DVBAB1",35,0)
 ..I DVBABRO="" S DVBABRO="UNKNOWN"
"RTN","DVBAB1",36,0)
 ..S ^TMP("DVBAREQ",DUZ,DVBABCNT)=DVBABST_"^"_DVBABPT_"^"_DVBABNM_"^"_DVBABDT_"^"_DVBABWHO_"^"_DVBABRO_"^"_DVBABIEN_$C(13),DVBABCNT=DVBABCNT+1
"RTN","DVBAB1",37,0)
 S Y=$NA(^TMP("DVBAREQ",DUZ))
"RTN","DVBAB1",38,0)
 K DVBABCNT,DVBABIEN,TYPE,DVBABNM,DVBABDT,DVBABST,DVBABWHO,DVBABPT
"RTN","DVBAB1",39,0)
 Q
"RTN","DVBAB1",40,0)
TEAMPTS(DVBORY,TEAM,TMPFLAG) ; RETURN LIST OF PATIENTS IN A TEAM
"RTN","DVBAB1",41,0)
 ; If TMPFLAG passed and = TRUE, code expects a "^TMP(xxx"
"RTN","DVBAB1",42,0)
 ;    global root string passed in ORY, and builds the returned 
"RTN","DVBAB1",43,0)
 ;    list in that global instead of to a memory array.
"RTN","DVBAB1",44,0)
 N DOTMP,NEWTMP,DVBSSN
"RTN","DVBAB1",45,0)
 K ^TMP("DVBATMPT",DUZ)
"RTN","DVBAB1",46,0)
 S DOTMP=0
"RTN","DVBAB1",47,0)
 I $G(TMPFLAG) D             ; Was value passed?
"RTN","DVBAB1",48,0)
 .I TMPFLAG S DOTMP=1        ; Is value TRUE?
"RTN","DVBAB1",49,0)
 I +$G(TEAM)<1 D
"RTN","DVBAB1",50,0)
 .I DOTMP S NEWTMP=DVBORY_1_")",@NEWTMP="^No team identified" Q
"RTN","DVBAB1",51,0)
 .I 'DOTMP S DVBORY(1)="^No team identified" Q
"RTN","DVBAB1",52,0)
 N DVBORI,DVBORPT,I
"RTN","DVBAB1",53,0)
 S I=0
"RTN","DVBAB1",54,0)
 S DVBORI=0 F  S DVBORI=$O(^OR(100.21,+TEAM,10,DVBORI)) Q:DVBORI<1  D
"RTN","DVBAB1",55,0)
 .S DVBORPT=^OR(100.21,+TEAM,10,DVBORI,0)
"RTN","DVBAB1",56,0)
 .I DOTMP D
"RTN","DVBAB1",57,0)
 ..S I=I+1,NEWTMP=DVBORY_+I_")"
"RTN","DVBAB1",58,0)
 ..S @NEWTMP=+DVBORPT_U_$P(^DPT(+DVBORPT,0),U)
"RTN","DVBAB1",59,0)
 .S DVBSSN=$P($G(^DPT($P(DVBORPT,";",1),0)),U,9)
"RTN","DVBAB1",60,0)
 .I 'DOTMP S I=I+1,^TMP("DVBATMPT",DUZ,I)=+DVBORPT_U_$P(^DPT(+DVBORPT,0),U)_U_DVBSSN_$C(13)
"RTN","DVBAB1",61,0)
 I DOTMP S:I<1 NEWTMP=DVBORY_1_")",@NEWTMP="^No patients found."
"RTN","DVBAB1",62,0)
 I 'DOTMP S:I<1 ^TMP("DVBATMPT",DUZ,1)="^No patients found."
"RTN","DVBAB1",63,0)
 S DVBORY=$NA(^TMP("DVBATMPT",DUZ))
"RTN","DVBAB1",64,0)
 Q
"RTN","DVBAB1",65,0)
DIVISION(Y) ; Returns Name for an Institution
"RTN","DVBAB1",66,0)
 N DVBARR,DVBERR,DVBATP
"RTN","DVBAB1",67,0)
 S Y=""
"RTN","DVBAB1",68,0)
 Q:$G(DUZ(2))=""
"RTN","DVBAB1",69,0)
 D GETS^DIQ(4,DUZ(2)_",0",".01","I","DVBARR","DVBERR")
"RTN","DVBAB1",70,0)
 Q:$D(DVBERR)
"RTN","DVBAB1",71,0)
 S Y=$G(DVBARR(4,DUZ(2)_",0,",.01,"I"))
"RTN","DVBAB1",72,0)
 D GETS^DIQ(4,DUZ(2)_",0",13,"I","DVBARR","DVBERR")
"RTN","DVBAB1",73,0)
 S DVBATP=$G(DVBARR(4,DUZ(2)_",0,",13,"I"))
"RTN","DVBAB1",74,0)
 I DVBATP'="" D
"RTN","DVBAB1",75,0)
 . S DVBATP=$P($G(^DIC(4.1,DVBATP,0)),"^",1)
"RTN","DVBAB1",76,0)
 S Y=Y_"-"_DVBATP
"RTN","DVBAB1",77,0)
 Q
"RTN","DVBAB1",78,0)
 ;
"RTN","DVBAB1",79,0)
DT(Y,X1,X2)  ; Returns date X1 minus X2 days
"RTN","DVBAB1",80,0)
 ; change the '00:00' that could be passed so Fileman doesn't reject
"RTN","DVBAB1",81,0)
 ;C^%DTC(X1,X2)
"RTN","DVBAB1",82,0)
 ;S %DT=$G(%DT,"TS") D ^%DT K %DT
"RTN","DVBAB1",83,0)
 ;K %DT,X1,X2
"RTN","DVBAB1",84,0)
 ;Q
"RTN","DVBAB1",85,0)
DPA(LIST,DFN,CHOICE)       ;Display Patient Appointments
"RTN","DVBAB1",86,0)
 N DVBABCNT,CKCHOICE
"RTN","DVBAB1",87,0)
 S LIST="",DVBABCNT=1,CKCHOICE="A,F,P",DFN=$G(DFN),CHOICE=$G(CHOICE) K ^TMP("DVBAAPPT",$J)
"RTN","DVBAB1",88,0)
 I DFN="" S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="MISSING PATIENT NAME",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ)) Q
"RTN","DVBAB1",89,0)
 I CHOICE="" S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="MISSING ALL, PAST, OR FUTURE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ)) Q
"RTN","DVBAB1",90,0)
 I CKCHOICE'[CHOICE S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="INVALID SELECTION",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ)) Q
"RTN","DVBAB1",91,0)
 I CHOICE["A" D
"RTN","DVBAB1",92,0)
 .S SDT=0
"RTN","DVBAB1",93,0)
 .S X="T+730" D ^%DT
"RTN","DVBAB1",94,0)
 .I Y<0 S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="ERROR IN CALCULATING ENDING DATE RANGE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ))
"RTN","DVBAB1",95,0)
 .S EDT=Y+.9
"RTN","DVBAB1",96,0)
 I CHOICE["F" D
"RTN","DVBAB1",97,0)
 .S X="T+1" D ^%DT
"RTN","DVBAB1",98,0)
 .I Y<0 S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="ERROR IN CALCULATING START DATE RANGE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ))
"RTN","DVBAB1",99,0)
 .S SDT=Y
"RTN","DVBAB1",100,0)
 .K X,Y
"RTN","DVBAB1",101,0)
 .S X="T+730" D ^%DT
"RTN","DVBAB1",102,0)
 .I Y<0 S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="ERROR IN CALCULATING ENDING DATE RANGE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ))
"RTN","DVBAB1",103,0)
 .S EDT=Y+.9
"RTN","DVBAB1",104,0)
 I CHOICE["P" D
"RTN","DVBAB1",105,0)
 .S X="T" D ^%DT
"RTN","DVBAB1",106,0)
 .I Y<0 S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="ERROR IN CALCULATING ENDING DATE RANGE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ))
"RTN","DVBAB1",107,0)
 .S EDT=Y+.9
"RTN","DVBAB1",108,0)
 .K X,Y
"RTN","DVBAB1",109,0)
 .S SDT=0
"RTN","DVBAB1",110,0)
 Q:LIST["ERROR"
"RTN","DVBAB1",111,0)
 I $O(^DPT(DFN,"S",SDT))'>0 S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="NO APPOINTMENTS FOUND FOR YOUR DATE RANGE",LIST=$NA(^TMP("DVBAAPPT",$J,DUZ)) Q
"RTN","DVBAB1",112,0)
 F  S SDT=$O(^DPT(DFN,"S",SDT)) Q:'SDT!(SDT>EDT)  D
"RTN","DVBAB1",113,0)
 .S CLN=$P(^DPT(DFN,"S",SDT,0),"^")
"RTN","DVBAB1",114,0)
 .Q:'$D(^SC(CLN,0))
"RTN","DVBAB1",115,0)
 .S CLN=$P(^SC(CLN,0),"^")
"RTN","DVBAB1",116,0)
 .S ZZ=$L(CLN)
"RTN","DVBAB1",117,0)
 .I ZZ<31 D
"RTN","DVBAB1",118,0)
 ..F ZZZ=ZZ:1:30 S CLN=CLN_" "
"RTN","DVBAB1",119,0)
 .S Y=SDT X ^DD("DD")
"RTN","DVBAB1",120,0)
 .S ZZ2=$L(Y)
"RTN","DVBAB1",121,0)
 .I ZZ2<21 D
"RTN","DVBAB1",122,0)
 ..F ZZZ2=ZZ2:1:20 S Y=Y_" "
"RTN","DVBAB1",123,0)
 .S STATUS=$P(^DPT(DFN,"S",SDT,0),"^",2)
"RTN","DVBAB1",124,0)
 .I STATUS'="" D
"RTN","DVBAB1",125,0)
 ..I STATUS="N" S STATUS="NO-SHOW"
"RTN","DVBAB1",126,0)
 ..I STATUS="C" S STATUS="CANCELLED BY CLINIC"
"RTN","DVBAB1",127,0)
 ..I STATUS="CA" S STATUS="CANCELLED BY CLINIC & AUTO RE-BOOK"
"RTN","DVBAB1",128,0)
 ..I STATUS="NA" S STATUS="NO-SHOW & AUTO-REBOOK"
"RTN","DVBAB1",129,0)
 ..I STATUS="I" S STATUS="INPATIENT APPOINTMENT"
"RTN","DVBAB1",130,0)
 ..I STATUS="PC" S STATUS="CANCELLED BY PATIENT"
"RTN","DVBAB1",131,0)
 ..I STATUS="PCA" S STATUS="CANCELLED BY PATIENT & AUTO RE-BOOK"
"RTN","DVBAB1",132,0)
 ..I STATUS="NT" S STATUS="NO ACTION TAKEN"
"RTN","DVBAB1",133,0)
 . I $D(^DPT(DFN,"S",SDT,"R")) S REMARK=$P(^DPT(DFN,"S",SDT,"R"),"^",1) ;ADDED
"RTN","DVBAB1",134,0)
 .S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)=CLN_"  "_Y_" "_STATUS,DVBABCNT=DVBABCNT+1
"RTN","DVBAB1",135,0)
 . I $D(REMARK) S ^TMP("DVBAAPPT",$J,DUZ,DVBABCNT)="   Cancellation Remarks: "_REMARK,DVBABCNT=DVBABCNT+1
"RTN","DVBAB1",136,0)
 .S LIST=$NA(^TMP("DVBAAPPT",$J,DUZ))
"RTN","DVBAB1",137,0)
 K DFN,X,%DT,CLN,CHOICE,Y,SDT,EDT
"RTN","DVBAB1",138,0)
 Q
"RTN","DVBAB1",139,0)
DTTM(Y) ;
"RTN","DVBAB1",140,0)
 S Y=$$HTE^XLFDT($H,"P")
"RTN","DVBAB1",141,0)
 Q
"RTN","DVBAB1",142,0)
CHKCRED(Y) ;KLB
"RTN","DVBAB1",143,0)
 S Y="[OK]"
"RTN","DVBAB1",144,0)
 I '$D(DUZ(2)) S Y="Your division number is missing." Q
"RTN","DVBAB1",145,0)
 I $D(DUZ)#2=0 S Y="Your user number is invalid." Q
"RTN","DVBAB1",146,0)
 I +DUZ(2)<1 S Y="Invalid division." Q
"RTN","DVBAB1",147,0)
 Q
"RTN","DVBAB1",148,0)
PTINQ(REF,DFN) ; Return formatted pt inquiry report
"RTN","DVBAB1",149,0)
 K ^TMP("ORDATA",$J,1)
"RTN","DVBAB1",150,0)
 D START^ORWRP(80,"DGINQB^ORCXPND1(DFN)")
"RTN","DVBAB1",151,0)
 S REF=$NA(^TMP("ORDATA",$J,1))
"RTN","DVBAB1",152,0)
 K DFN
"RTN","DVBAB1",153,0)
 Q
"RTN","DVBAB1",154,0)
LABLIST(Y) ; Returns list of LAB TEST NAMES
"RTN","DVBAB1",155,0)
 N DVBABCNT,DVBABIEN,DVBABLNM
"RTN","DVBAB1",156,0)
 K Y,^TMP("DVBALAB1",DUZ)
"RTN","DVBAB1",157,0)
 S DVBABCNT=0,DVBABIEN=0
"RTN","DVBAB1",158,0)
 F  S DVBABIEN=$O(^LAB(60,DVBABIEN)) Q:'DVBABIEN  D
"RTN","DVBAB1",159,0)
 .S DVBABLNM=$P($G(^LAB(60,DVBABIEN,0)),"^",1)
"RTN","DVBAB1",160,0)
 .S ^TMP("DVBALAB1",DUZ,DVBABCNT)=DVBABLNM_"^"_DVBABIEN_$C(13),DVBABCNT=DVBABCNT+1
"RTN","DVBAB1",161,0)
 S Y=$NA(^TMP("DVBALAB1",DUZ))
"RTN","DVBAB1",162,0)
 ;;K DVBABCNT,DVBABLNM,DVBABIEN
"RTN","DVBAB1",163,0)
 Q
"RTN","DVBAB1",164,0)
 ;
"RTN","DVBAB1",165,0)
INSTLIST(Y) ; Returns full list of Institutions
"RTN","DVBAB1",166,0)
 N DVBABCNT,DVBABIEN,DVBABNM,DVBABSTN,DVBABST,DVBABDS,DVBARR,DVBERR,DVBATP
"RTN","DVBAB1",167,0)
 K Y,^TMP("DVBAINST",$J,DUZ)
"RTN","DVBAB1",168,0)
 S (DVBABCNT,DVBABIEN)=0
"RTN","DVBAB1",169,0)
 F  S DVBABIEN=$O(^DIC(4,DVBABIEN)) Q:'DVBABIEN  D 
"RTN","DVBAB1",170,0)
 . K DVBARR,DVBERR
"RTN","DVBAB1",171,0)
 . D GETS^DIQ(4,DVBABIEN_",0",".01:.02:.03:","I","DVBARR","DVBERR")
"RTN","DVBAB1",172,0)
 . Q:$D(DVBERR)
"RTN","DVBAB1",173,0)
 . S DVBABNM=$G(DVBARR(4,DVBABIEN_",0,",.01,"I"))
"RTN","DVBAB1",174,0)
 . Q:DVBABNM=""
"RTN","DVBAB1",175,0)
 . S DVBABSTN=$G(DVBARR(4,DVBABIEN_",0,",.02,"I"))
"RTN","DVBAB1",176,0)
 . Q:DVBABSTN=""
"RTN","DVBAB1",177,0)
 . S DVBABDS=$G(DVBARR(4,DVBABIEN_",0,",.03,"I"))
"RTN","DVBAB1",178,0)
 . K DVBARR,DVBERR
"RTN","DVBAB1",179,0)
 . D GETS^DIQ(5,DVBABSTN_",0",.01,"I","DVBARR","DVBERR")
"RTN","DVBAB1",180,0)
 . Q:$D(DVBERR)
"RTN","DVBAB1",181,0)
 . S DVBABST=$G(DVBARR(5,DVBABSTN_",0,",.01,"I"))
"RTN","DVBAB1",182,0)
 . K DVBARR,DVBERR
"RTN","DVBAB1",183,0)
 . D GETS^DIQ(4,DVBABIEN_",0",13,"I","DVBARR","DVBERR")
"RTN","DVBAB1",184,0)
 . S DVBATP=$G(DVBARR(4,DVBABIEN_",0,",13,"I"))
"RTN","DVBAB1",185,0)
 . I DVBATP'="" D
"RTN","DVBAB1",186,0)
 .. S DVBATP=$P($G(^DIC(4.1,DVBATP,0)),"^",1)
"RTN","DVBAB1",187,0)
 . S ^TMP("DVBAINST",$J,DUZ,DVBABCNT)=DVBABNM_"-"_DVBATP_"^"_DVBABST_"^"_DVBABDS_"^"_DVBABIEN_$C(13)
"RTN","DVBAB1",188,0)
 . S DVBABCNT=DVBABCNT+1
"RTN","DVBAB1",189,0)
 S Y=$NA(^TMP("DVBAINST",$J,DUZ))
"RTN","DVBAB1",190,0)
 Q
"RTN","DVBAB1",191,0)
 ;
"RTN","DVBAB1",192,0)
INCEXAM(ZMSG) ;Increased exam # in file  and passes back the # to user
"RTN","DVBAB1",193,0)
 S ZMSG=+$G(^DVB(396.1,1,5))
"RTN","DVBAB1",194,0)
 S ZMSG=ZMSG+1
"RTN","DVBAB1",195,0)
 S ^DVB(396.1,1,5)=ZMSG
"RTN","DVBAB1",196,0)
 Q
"RTN","DVBAB1",197,0)
 ;
"RTN","DVBAB1",198,0)
MSG(ERR,DUZ,XMSUB,XMTEXT,MGN) ;Generate mail message;KLB
"RTN","DVBAB1",199,0)
 S ERR=""
"RTN","DVBAB1",200,0)
 K ^TMP($J,"AMIE")
"RTN","DVBAB1",201,0)
 I '$D(DUZ) S ERR="MISSING DUZ" Q
"RTN","DVBAB1",202,0)
 I '$D(XMSUB) S ERR="MISSING SUBJECT" Q
"RTN","DVBAB1",203,0)
 I '$D(XMTEXT) S ERR="MISSING TEXT" Q
"RTN","DVBAB1",204,0)
 I '$D(MGN) S ERR="MISSING MAIL GROUP NAME" Q
"RTN","DVBAB1",205,0)
 S XMDUZ=DUZ
"RTN","DVBAB1",206,0)
 S J=0
"RTN","DVBAB1",207,0)
 F  S J=$O(XWBS1(J)) Q:'J  S ^TMP($J,"AMIE",J)=$G(XWBS1(J))
"RTN","DVBAB1",208,0)
 S XMTEXT="^TMP($J,""AMIE"","
"RTN","DVBAB1",209,0)
 S DIC="^XMB(3.8,",DIC(0)="QM",X=MGN D ^DIC
"RTN","DVBAB1",210,0)
 S MG=+Y
"RTN","DVBAB1",211,0)
 I +Y<0 S ERR="INVALID MAIL GROUP NAME" Q
"RTN","DVBAB1",212,0)
 S ZZ=0,ZZ1=0
"RTN","DVBAB1",213,0)
 F  S ZZ=$O(^XMB(3.8,MG,1,"B",ZZ)) Q:'ZZ  D
"RTN","DVBAB1",214,0)
 .F  S ZZ1=$O(^XMB(3.8,MG,1,"B",ZZ,ZZ1)) Q:'ZZ1  S XMY(ZZ)=""
"RTN","DVBAB1",215,0)
 D ^XMD
"RTN","DVBAB1",216,0)
 I $D(XMMG) S ERR=XMMG
"RTN","DVBAB1",217,0)
 I '$D(XMMG) S ERR="MESSAGE SENT"
"RTN","DVBAB1",218,0)
 K XMSUB,XMTEXT,MGN,DIC,DIC(0),ZZ,XMY,XWBS1,J,ZZ1,MG,^TMP($J,"AMIE"),XMMG,Y,XMDUZ
"RTN","DVBAB1",219,0)
 Q
"RTN","DVBAB1",220,0)
FINDEXAM(ZMSG,ZIEN) ;Returns list of exams in 396.4 that are linked to ZIEN in 396.3
"RTN","DVBAB1",221,0)
 N DVBABCNT,DVBABIEN
"RTN","DVBAB1",222,0)
 S DVBABCNT=0,DVBABIEN=0
"RTN","DVBAB1",223,0)
 F  S DVBABIEN=$O(^DVB(396.4,"C",ZIEN,DVBABIEN)) Q:'DVBABIEN  D
"RTN","DVBAB1",224,0)
 .S DVBABD1=$P($G(^DVB(396.4,DVBABIEN,0)),"^",2)
"RTN","DVBAB1",225,0)
 .S DVBABD2=$P($G(^DVB(396.6,+$P($G(^DVB(396.4,DVBABIEN,0)),"^",3),0)),"^",1)  ;Name of Exam
"RTN","DVBAB1",226,0)
 .S DVBABD3=$P($G(^DVB(396.4,DVBABIEN,0)),"^",4)
"RTN","DVBAB1",227,0)
 .I DVBABD3="O" S DVBABD3="[OPEN]"
"RTN","DVBAB1",228,0)
 .I DVBABD3="C" S DVBABD3="[COMPLETE]"
"RTN","DVBAB1",229,0)
 .I DVBABD3="X" S DVBABD3="[CANCELED BY MAS]"
"RTN","DVBAB1",230,0)
 .I DVBABD3="RX" S DVBABD3="[CANCELED BY RO]"
"RTN","DVBAB1",231,0)
 .I DVBABD3="T" S DVBABD3="[TRANSFERRED OUT]"
"RTN","DVBAB1",232,0)
 .I ZIEN=DVBABD1 D
"RTN","DVBAB1",233,0)
 ..S ZMSG(DVBABCNT)=DVBABIEN_"^"_DVBABD2_" "_DVBABD3
"RTN","DVBAB1",234,0)
 ..S DVBABCNT=DVBABCNT+1
"RTN","DVBAB1",235,0)
 K DVBABCNT,DVBABIEN,ZIEN,DVBABD1,DVBABD2,DVBABD3
"RTN","DVBAB1",236,0)
 Q
"RTN","DVBAB2")
0^66^B16723785
"RTN","DVBAB2",1,0)
DVBAB2 ;ALB/KLB - CAPRI RO AMIS REPORT CONT. ;05/01/00
"RTN","DVBAB2",2,0)
 ;;2.7;AMIE;**35,42**;Apr 10, 1995
"RTN","DVBAB2",3,0)
 ;
"RTN","DVBAB2",4,0)
DAY30 K ^TMP("DVBC",$J)
"RTN","DVBAB2",5,0)
 F FA=DTRPT-.1:0 S FA=$O(^DPT(PNAM,"S",FA)) Q:FA=""!(FA>EDATE)  I $D(^(FA,0)) S L=^(0),C=+L S YY=$P(L,U,2) I YY'="N"&(YY'="C")&(YY'="NA")&(YY'="CA")&(YY'="PC")&(YY'="PCA") I FA'>EDATE S ^TMP("DVBC",$J,9999999-FA,FA)=""
"RTN","DVBAB2",6,0)
 Q:'$D(^TMP("DVBC",$J))  S FB=$O(^TMP("DVBC",$J,0)),FA=$O(^TMP("DVBC",$J,FB,0)) I FA]"" S X2=FA,X1=$S(DTSCHEDC]"":DTSCHEDC,1:DVBCNOW) D ^%DTC I X>30 S TOT("30DAYEX")=TOT("30DAYEX")+1
"RTN","DVBAB2",7,0)
 Q
"RTN","DVBAB2",8,0)
 ;
"RTN","DVBAB2",9,0)
PENDCNT I X'<0&(X'>90) S TOT("P90")=TOT("P90")+1
"RTN","DVBAB2",10,0)
 I X>90&(X'>120) S TOT("P121")=TOT("P121")+1
"RTN","DVBAB2",11,0)
 I X>120&(X'>150) S TOT("P151")=TOT("P151")+1
"RTN","DVBAB2",12,0)
 I X>150&(X'>180) S TOT("P181")=TOT("P181")+1
"RTN","DVBAB2",13,0)
 I X>180&(X'>365) S TOT("P365")=TOT("P365")+1
"RTN","DVBAB2",14,0)
 I X>365 S TOT("P366")=TOT("P366")+1
"RTN","DVBAB2",15,0)
 Q
"RTN","DVBAB2",16,0)
 ;
"RTN","DVBAB2",17,0)
SET S DTA=^DVB(396.3,REQDA,0),DTREQ=$P(DTA,U,2),XRONUM=$P(DTA,U,3),XRONUM=$S($D(^DIC(4,+XRONUM,99)):$P(^(99),U,1),1:0) Q:XRONUM'=RONUM&(RONUM'="ALL")
"RTN","DVBAB2",18,0)
 ; Next 2 lines check for specific division  SPH/ALB - 9/3/02
"RTN","DVBAB2",19,0)
 I DVBDIV'="" I '$D(^DVB(396.3,REQDA,1)) Q
"RTN","DVBAB2",20,0)
 I DVBDIV'="" I $P(^DVB(396.3,REQDA,1),"^",4)'=DVBDIV Q
"RTN","DVBAB2",21,0)
 K XRONUM S DTRPT=$P(DTA,U,5),DTSCHEDC=$P(DTA,U,6),DTRQCMP=$P(DTA,U,7),DTTRANS=$P(DTA,U,12),DTREL=$P(DTA,U,14),RQSTAT=$P(DTA,U,18),DTCAN=$P(DTA,U,19),PRIO=$P(DTA,U,10) K DTA
"RTN","DVBAB2",22,0)
 I DTRPT="",DTCAN]"" S DTRPT=DTCAN
"RTN","DVBAB2",23,0)
 Q:DTRPT=""  ;requests never printed
"RTN","DVBAB2",24,0)
 I DTREL'<BDATE,DTREL'>EDATE D DAY30
"RTN","DVBAB2",25,0)
 I DTRPT'<BDATE,DTRPT'>EDATE S TOT("SENT")=TOT("SENT")+1
"RTN","DVBAB2",26,0)
 I DTRPT'<BDATE,DTRPT'>EDATE,RQSTAT'["X" S X1=$S(DTSCHEDC]"":DTSCHEDC,1:DVBCNOW),X2=DTRPT D ^%DTC I X>3 S TOT("3DAYSCH")=TOT("3DAYSCH")+1
"RTN","DVBAB2",27,0)
 I DTREL'<BDATE&(DTREL'>EDATE),RQSTAT="C"!(RQSTAT="R") S:PRIO'="E" DVBCPCTM=$$PROCDAY^DVBCUTL2(REQDA) S:PRIO="E" DVBCPCTM=$$INSFTME^DVBCUTA1(REQDA) S TOT("DAYS")=TOT("DAYS")+DVBCPCTM K DVBCPCTM
"RTN","DVBAB2",28,0)
 I DTRPT'>EDATE,"^P^S^T"[RQSTAT S TOT("PENDADJ")=TOT("PENDADJ")+1,X1=EDATE,X2=DTRPT D ^%DTC,PENDCNT
"RTN","DVBAB2",29,0)
 I DTRPT'>EDATE,"^C^CT^R^RX^X^"[RQSTAT,(+DTREL>EDATE)!(+DTCAN>EDATE) S TOT("PENDADJ")=TOT("PENDADJ")+1,X1=EDATE,X2=DTRPT D ^%DTC,PENDCNT
"RTN","DVBAB2",30,0)
 I DTREL'<BDATE&(DTREL'>EDATE),RQSTAT["C"!(RQSTAT="R") S TOT("COMPLETED")=TOT("COMPLETED")+1
"RTN","DVBAB2",31,0)
 I DTRPT'<BDATE,DTRPT'>EDATE,PRIO="E" S TOT("INSUFF")=TOT("INSUFF")+1
"RTN","DVBAB2",32,0)
 I DTCAN'<BDATE&(DTCAN'>EDATE),RQSTAT="X"!(RQSTAT="RX") S TOT("INCOMPLETE")=TOT("INCOMPLETE")+1
"RTN","DVBAB2",33,0)
 K DTRPT Q
"RTN","DVBAB2",34,0)
 ;
"RTN","DVBAB2",35,0)
GO S DVBABCNT=0
"RTN","DVBAB2",36,0)
 S %DT="TS",X="NOW" D ^%DT S DVBCNOW=Y
"RTN","DVBAB2",37,0)
 S PNAM="" F JJ=0:0 S PNAM=$O(^DVB(396.3,"B",PNAM)) Q:PNAM=""  F REQDA=0:0 S REQDA=$O(^DVB(396.3,"B",PNAM,REQDA)) Q:REQDA=""  D SET
"RTN","DVBAB2",38,0)
 S TOT("AVGDAYS")=0 I TOT("COMPLETED")>0 S TOT("AVGDAYS")=TOT("DAYS")/TOT("COMPLETED"),TOT("AVGDAYS")=$J(TOT("AVGDAYS"),5,1)
"RTN","DVBAB2",39,0)
 D BULLTXT^DVBCAMR1
"RTN","DVBAB2",40,0)
 F JI=0:0 S JI=$O(^TMP($J,JI)) Q:JI=""  S DVBABCNT=DVBABCNT+1,MSG(DVBABCNT)=^TMP($J,JI,0)
"RTN","DVBAB2",41,0)
 S:'$D(XMY) SBULL="N" I SBULL="Y" D SEND
"RTN","DVBAB2",42,0)
 ;
"RTN","DVBAB2",43,0)
EXIT K BDATE,%DT,DVBABCNT,C,DTCAN,DTREL,DTREQ,DTRQCMP,DTSCHEDC,DTTRANS,DVBCNOW,DVBCPCTM,EDATE,FA,FB,JI,JJ,L,PNAM,PRIO,REQDA,RONUM,RQSTAT,SBULL,TOT,X,X1,X2,XMDUZ,XMMG,Y,YY
"RTN","DVBAB2",44,0)
 Q
"RTN","DVBAB2",45,0)
 ;
"RTN","DVBAB2",46,0)
BULL S XMDUZ=$P(^VA(200,DUZ,0),U),XMMG=$S($D(^VA(200,DUZ,0)):$P(^(0),U,1),1:""),XMY(DUZ)=""
"RTN","DVBAB2",47,0)
 S XMSUB="RO AMIS 290 Report -  " S Y=BDATE X ^DD("DD") S XMSUB=XMSUB_Y S Y=EDATE X ^DD("DD") S XMSUB=XMSUB_" to "_Y,XMTEXT="^TMP($J,"
"RTN","DVBAB2",48,0)
 Q
"RTN","DVBAB2",49,0)
 ;
"RTN","DVBAB2",50,0)
SEND D ^XMD K XMY,XMTEXT,XMSUB
"RTN","DVBAB2",51,0)
 S MSG(1)=">>> Mail message transmitted. <<<"
"RTN","DVBAB2",52,0)
 Q
"RTN","DVBAB2",53,0)
 ;
"RTN","DVBAB3")
0^69^B4966234
"RTN","DVBAB3",1,0)
DVBAB3 ;ALB/KLB - CAPRI Amis Report ;05/01/00
"RTN","DVBAB3",2,0)
 ;;2.7;AMIE;**35,42**;Apr 10, 1995
"RTN","DVBAB3",3,0)
 ;
"RTN","DVBAB3",4,0)
STRT(MSG,BDATE,EDATE,RONUMB,SBULL,DUZ) ;
"RTN","DVBAB3",5,0)
 S BDATE=BDATE+".0000"
"RTN","DVBAB3",6,0)
 S EDATE=EDATE+".2359"
"RTN","DVBAB3",7,0)
 S DVBDIV=$P(RONUMB,"^",2)
"RTN","DVBAB3",8,0)
 S RONUMB=$P(RONUMB,"^",1)
"RTN","DVBAB3",9,0)
 S CNT=0
"RTN","DVBAB3",10,0)
 K ^TMP($J)
"RTN","DVBAB3",11,0)
 S RONUM=0
"RTN","DVBAB3",12,0)
SETUP S UPDATE="N",PREVMO=$P(^DVB(396.1,1,0),U,11)
"RTN","DVBAB3",13,0)
 I '$D(DT) S DT=$$DT^XLFDT
"RTN","DVBAB3",14,0)
 S DVBCDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB3",15,0)
 F JI="3DAYSCH","30DAYEX","PENDADJ" S TOT(JI)=0
"RTN","DVBAB3",16,0)
 F JI="INSUFF","SENT","INCOMPLETE","DAYS","COMPLETED" S TOT(JI)=0
"RTN","DVBAB3",17,0)
 F JI="P90","P121","P151","P181","P365","P366" S TOT(JI)=0
"RTN","DVBAB3",18,0)
 S ^TMP($J,CNT)="REGIONAL OFFICE 2507 AMIS REPORT",CNT=CNT+1
"RTN","DVBAB3",19,0)
 ;
"RTN","DVBAB3",20,0)
EN S ^TMP($J,CNT)="",CNT=CNT+1,^TMP($J,CNT)="",CNT=CNT+1,^TMP($J,CNT)="",CNT=CNT+1
"RTN","DVBAB3",21,0)
 S:'$D(EDATE) MSG(1)="Please enter a ending date"
"RTN","DVBAB3",22,0)
 Q:'$D(EDATE)
"RTN","DVBAB3",23,0)
 S:'$D(BDATE) MSG(1)="Please enter a starting date"
"RTN","DVBAB3",24,0)
 Q:'$D(BDATE)
"RTN","DVBAB3",25,0)
 S BDATE1=BDATE-.1,EDATE1=EDATE+.5
"RTN","DVBAB3",26,0)
 S:EDATE<BDATE MSG(1)="Beginning date must be before ending date"
"RTN","DVBAB3",27,0)
 Q:EDATE<BDATE
"RTN","DVBAB3",28,0)
 S:'$D(RONUMB) MSG(1)="Please select a Regional Office number"
"RTN","DVBAB3",29,0)
 Q:'$D(RONUMB)
"RTN","DVBAB3",30,0)
 S RONUM=$O(^DIC(4,"B",RONUMB,RONUM))
"RTN","DVBAB3",31,0)
 I RONUM="" S MSG(1)="Invalid Regional Office number" Q
"RTN","DVBAB3",32,0)
 S:'$D(^DIC(4,RONUM,99)) MSG(1)="Invalid Regional Office number"
"RTN","DVBAB3",33,0)
 Q:'$D(^DIC(4,RONUM,99))
"RTN","DVBAB3",34,0)
 S RONUM=$S($D(^DIC(4,RONUM,99)):$P(^(99),U,1),1:"000")
"RTN","DVBAB3",35,0)
 S RONAME=RONUMB
"RTN","DVBAB3",36,0)
 S:'$D(SBULL) MSG(1)="You need to say if you want a Bulletin or not"
"RTN","DVBAB3",37,0)
 Q:'$D(SBULL)
"RTN","DVBAB3",38,0)
 I SBULL="Y" D BULL^DVBAB2
"RTN","DVBAB3",39,0)
 ;
"RTN","DVBAB3",40,0)
 D GO^DVBAB2
"RTN","DVBAB3",41,0)
 K BDATE,BDATE1,DVBCDT,EDATE,CNT,EDATE1,JI,PREVMO,RONAME,RONUM,RONUMB,SBULL,TOT,UPDATE,X,Y,^TMP($J)
"RTN","DVBAB3",42,0)
 Q
"RTN","DVBAB3",43,0)
INIT(Y) ;
"RTN","DVBAB3",44,0)
 ; INITS MAILMAN VARIABLES
"RTN","DVBAB3",45,0)
 D INIT^XMVVITAE
"RTN","DVBAB3",46,0)
 S Y=XMV("NETNAME")_"^"
"RTN","DVBAB3",47,0)
 Q
"RTN","DVBAB57")
0^76^B14003695
"RTN","DVBAB57",1,0)
DVBAB57 ;ALB/KLB - AMIE GUI PENDING 7131 REPORT ;09/7/00
"RTN","DVBAB57",2,0)
 ;;2.7;AMIE;**35,42**;Apr 10, 1995
"RTN","DVBAB57",3,0)
 ;
"RTN","DVBAB57",4,0)
STRT(MSG,SELDIV,DIV) ;
"RTN","DVBAB57",5,0)
 S RO="N"
"RTN","DVBAB57",6,0)
 S RONUM=0
"RTN","DVBAB57",7,0)
 S DIVNUM="",MSGCNT=1
"RTN","DVBAB57",8,0)
 K ^TMP($J)
"RTN","DVBAB57",9,0)
 I RO="Y",RONUM="" S MSG(1)="To sort by RO Number, please enter the RO Number."
"RTN","DVBAB57",10,0)
 I RO="Y",RONUM="" Q
"RTN","DVBAB57",11,0)
 I SELDIV="Y",DIV="" S MSG(1)="To sort by Division, please enter the Division."
"RTN","DVBAB57",12,0)
 I SELDIV="Y",DIV="" Q
"RTN","DVBAB57",13,0)
 I DIV'="" S DIVNUM=$O(^DG(40.8,"C",DIV,DIVNUM)),DIVNAM=$S($D(^DG(40.8,+DIVNUM,0)):$P(^(0),"^",1),1:"Unknown Division")
"RTN","DVBAB57",14,0)
SETUP D STM^DVBCUTL4
"RTN","DVBAB57",15,0)
 S FDT(0)=$$FMTE^XLFDT(DT,"5DZ"),(PG,DVBAQUIT)=0
"RTN","DVBAB57",16,0)
 S HEAD="PENDING REQUEST REPORT FOR "_$P(^DVB(396.1,1,0),U,1)
"RTN","DVBAB57",17,0)
 S HEAD2=$S(RO="Y":"FOR REGIONAL OFFICE "_RONUM,1:"ALL REGIONAL OFFICES")
"RTN","DVBAB57",18,0)
 S HEAD2=HEAD2_$S(SELDIV="Y":", FOR DIVISION "_DIVNAM,1:", ALL DIVISIONS")
"RTN","DVBAB57",19,0)
 S PROCDT="Processed on: "_FDT(0)
"RTN","DVBAB57",20,0)
 S QQ=1,NODTA=0
"RTN","DVBAB57",21,0)
 S ^TMP("CAPRI",MSGCNT)="Pending 7131 Report"_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",22,0)
 S ^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",23,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",24,0)
 S ^TMP("CAPRI",MSGCNT)=HEAD2_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",25,0)
 S ^TMP("CAPRI",MSGCNT)=PROCDT_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",26,0)
 S ^TMP("CAPRI",MSGCNT)=""_"^",MSGCNT=MSGCNT+1
"RTN","DVBAB57",27,0)
DATA N REQDTE S REQDTE="",CNT=0
"RTN","DVBAB57",28,0)
 S:SELDIV="Y" ADIV=DIVNAM
"RTN","DVBAB57",29,0)
 F J=0:0 S REQDTE=$O(^DVB(396,"E",REQDTE)) Q:REQDTE=""  F DA=0:0 S DA=$O(^DVB(396,"E",REQDTE,DA)) Q:DA=""  I $D(^DVB(396,DA,1)),($P(^DVB(396,DA,1),U,12)="")  D:SELDIV="N" ADIV  D MAKUTL
"RTN","DVBAB57",30,0)
 S (ADIV,REQDTE)=""
"RTN","DVBAB57",31,0)
 F L=0:0 S REQDTE=$O(^TMP($J,REQDTE)) Q:REQDTE=""  D LVL2LP
"RTN","DVBAB57",32,0)
 ;
"RTN","DVBAB57",33,0)
EXIT I NODTA=0 S MSG(1)="No pending requests found for parameters entered."
"RTN","DVBAB57",34,0)
 I NODTA>0 S MSG=$NA(^TMP("CAPRI"))
"RTN","DVBAB57",35,0)
 ;
"RTN","DVBAB57",36,0)
KILL S XRTN=$T(+0)
"RTN","DVBAB57",37,0)
 D SPM^DVBCUTL4
"RTN","DVBAB57",38,0)
 K ^TMP("DVBA","ADMIT",$J),^TMP($J),DVBAQUIT,SELDIV,DIVNUM,REQDTE,PROCDT,QQ,RO,RONUM,XRTN
"RTN","DVBAB57",39,0)
 K LPCNT1,PATDA,DIVNAM,XJ,XI,GDIVPTR,GDIVNUM,GINSTPT,GDIVNAM,GDIV,ADIV,CFLOC,DA,DIV,FDT,HEAD,HEAD2,J,L,MSGCNT,NODTA,PG
"RTN","DVBAB57",40,0)
 Q
"RTN","DVBAB57",41,0)
 ;
"RTN","DVBAB57",42,0)
LVL2LP  ;  ** 2nd level of the 2nd loop in the DATA tag - search ADIV **
"RTN","DVBAB57",43,0)
 F J=0:0 S ADIV=$O(^TMP($J,REQDTE,ADIV)) Q:ADIV=""  D LPLVL3
"RTN","DVBAB57",44,0)
 Q
"RTN","DVBAB57",45,0)
 ;
"RTN","DVBAB57",46,0)
LPLVL3 ;  **  2nd level of the loop in the LVL2LP tag - search DA **
"RTN","DVBAB57",47,0)
 F DA=0:0 S DA=$O(^TMP($J,REQDTE,ADIV,DA)) Q:DA=""  D PRINT^DVBAB67 S:DVBAQUIT=1 ADIV="ZZZZ",DA=999999999,REQDTE=9999999 S QQ=1
"RTN","DVBAB57",48,0)
 Q
"RTN","DVBAB57",49,0)
 ;
"RTN","DVBAB57",50,0)
MAKUTL ;  **  Sort on Request Date to set up a temporary utility global  **
"RTN","DVBAB57",51,0)
 S PATDA=$P(^DVB(396,DA,0),"^",1)
"RTN","DVBAB57",52,0)
 ;S REQDTE=$P(^DVB(396,DA,1),"^",1),PATDA=$P(^DVB(396,DA,0),"^",1)
"RTN","DVBAB57",53,0)
 S CFLOC=$$STATION^DVBAUTL1(PATDA)
"RTN","DVBAB57",54,0)
 S:CFLOC=-1 CFLOC=0
"RTN","DVBAB57",55,0)
 I SELDIV="Y"&(RO="Y") I CFLOC=RONUM D CHKDIV D:$D(DVBAFND) SETARY
"RTN","DVBAB57",56,0)
 I SELDIV="Y"&(RO="N") D CHKDIV D:$D(DVBAFND) SETARY
"RTN","DVBAB57",57,0)
 I SELDIV="N"&(RO="Y") I CFLOC=RONUM D SETARY
"RTN","DVBAB57",58,0)
 I SELDIV="N"&(RO="N") D SETARY
"RTN","DVBAB57",59,0)
 K DVBAFND
"RTN","DVBAB57",60,0)
 QUIT
"RTN","DVBAB57",61,0)
 ;
"RTN","DVBAB57",62,0)
SETARY ;  ** Set temporary utility global **
"RTN","DVBAB57",63,0)
 S ^TMP($J,REQDTE,ADIV,DA)=""
"RTN","DVBAB57",64,0)
 QUIT
"RTN","DVBAB57",65,0)
 ;
"RTN","DVBAB57",66,0)
ADIV S ADIV=$S($D(^DVB(396,DA,2)):$P(^(2),U,9),1:"") S ADIV=$S($D(^DG(40.8,+ADIV,0)):$P(^(0),U,1),1:"Unknown Division")
"RTN","DVBAB57",67,0)
 Q
"RTN","DVBAB57",68,0)
 ;
"RTN","DVBAB57",69,0)
CHKDIV ;**Check for selected Div
"RTN","DVBAB57",70,0)
 N FLDVAR
"RTN","DVBAB57",71,0)
 I $D(^DVB(396,DA,6)) DO
"RTN","DVBAB57",72,0)
 .F FLDVAR=7,9,11,13,15,17,19,21,23,26,28 Q:$D(DVBAFND)  DO
"RTN","DVBAB57",73,0)
 ..I ($P(^DVB(396,DA,6),U,FLDVAR)=DIVNUM) DO
"RTN","DVBAB57",74,0)
 ...I FLDVAR=7 S:$P(^DVB(396,DA,1),U,FLDVAR)="P" DVBAFND=""
"RTN","DVBAB57",75,0)
 ...I FLDVAR'=7 S:$P(^DVB(396,DA,0),U,FLDVAR)="P" DVBAFND=""
"RTN","DVBAB57",76,0)
 I $D(^DVB(396,DA,2)),('$D(DVBAFND)) DO  ;**Check Routing Loc Division
"RTN","DVBAB57",77,0)
 .I $D(^DVB(396,DA,1)) DO
"RTN","DVBAB57",78,0)
 ..I $P(^DVB(396,DA,2),U,9)=DIVNUM,($P(^DVB(396,DA,1),U,12)="") DO
"RTN","DVBAB57",79,0)
 ...S DVBAFND=""
"RTN","DVBAB57",80,0)
 Q
"RTN","DVBAB70")
0^80^B38801935
"RTN","DVBAB70",1,0)
DVBAB70 ;ALB/SPH - CAPRI C&P EXAM INQUIRY ;09/08/00
"RTN","DVBAB70",2,0)
 ;;2.7;AMIE;**35,42**;Apr 10, 1995
"RTN","DVBAB70",3,0)
 ;
"RTN","DVBAB70",4,0)
STRT(ZMSG,DFN,ZREQDA) ;
"RTN","DVBAB70",5,0)
 S DVBABCNT=0
"RTN","DVBAB70",6,0)
 K ^TMP($J) S Y=DT X ^DD("DD") S FDT(0)=Y D HOME^%ZIS S FF=IOF
"RTN","DVBAB70",7,0)
 S DIC="^DVB(396.3,"
"RTN","DVBAB70",8,0)
 S DIC(0)="M"
"RTN","DVBAB70",9,0)
 S DIC(1)=ZREQDA
"RTN","DVBAB70",10,0)
 S Y=ZREQDA
"RTN","DVBAB70",11,0)
 S JI=$P(Y,U,2),(DA,DA(1),REQDA)=+Y
"RTN","DVBAB70",12,0)
 S (NAME,SSN,CNUM,ADR1,ADR2,ADR3,CITY,STATE,ZIP,HOMPHON,BUSPHON,OTHDIS)=""
"RTN","DVBAB70",13,0)
 D VARS^DVBCUTIL
"RTN","DVBAB70",14,0)
 G START
"RTN","DVBAB70",15,0)
CON ;
"RTN","DVBAB70",16,0)
 I IOST?1"P-".E,$Y>45 W @IOF D HDR
"RTN","DVBAB70",17,0)
 Q
"RTN","DVBAB70",18,0)
START S PGHD="",PG=0
"RTN","DVBAB70",19,0)
 S ZMSG(DVBABCNT)="                     COMPENSATION AND PENSION EXAM INQUIRY",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",20,0)
 S ZMSG(DVBABCNT)="                     -------------------------------------",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",21,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",22,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",23,0)
 S ZMSG(DVBABCNT)="            Name: "_PNAM,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",24,0)
 S ZMSG(DVBABCNT)="             SSN: "_SSN,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",25,0)
 S ZMSG(DVBABCNT)="        C-Number: "_CNUM,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",26,0)
 S Y=DOB X ^DD("DD")
"RTN","DVBAB70",27,0)
 S ZMSG(DVBABCNT)="             DOB: "_Y,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",28,0)
 S ZMSG(DVBABCNT)="         Address: "_ADR1,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",29,0)
 I ADR2'="" S ZMSG(DVBABCNT)="                  "_ADR2,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",30,0)
 I ADR3'="" S ZMSG(DVBABCNT)="                  "_ADR3,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",31,0)
 S ZMSG(DVBABCNT)="City,State,Zip+4: "_CITY_", "_STATE_" "_ZIP,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",32,0)
 S ZMSG(DVBABCNT)="       Res Phone: "_HOMPHON,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",33,0)
 S ZMSG(DVBABCNT)="       Bus Phone: "_BUSPHON,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",34,0)
 S EDTA=$S($D(^DPT(DFN,.32)):^(.32),1:""),EOD=$P(EDTA,U,6),RAD=$P(EDTA,U,7)
"RTN","DVBAB70",35,0)
 S Y=EOD X ^DD("DD") S:Y="" Y="Not specified"
"RTN","DVBAB70",36,0)
 S ZMSG(DVBABCNT)="Entered active service: "_Y,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",37,0)
 S Y=RAD X ^DD("DD") S:Y="" Y="Not specified"
"RTN","DVBAB70",38,0)
 S ZMSG(DVBABCNT)="Released active service: "_Y,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",39,0)
 S ZMSG(DVBABCNT)="================================================================================",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",40,0)
 W !! D CON Q:$D(OUT)  D ^DVBAB97,CON Q:$D(OUT)  D ^DVBAB68,CON Q:$D(OUT)  S REQDT=$P(^DVB(396.3,REQDA,0),U,2)
"RTN","DVBAB70",41,0)
 S Y=REQDT X ^DD("DD")
"RTN","DVBAB70",42,0)
 S ZMSG(DVBABCNT)="This request was initiated on "_$P(Y,"@",1)_" at "_$P(Y,"@",2),DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",43,0)
 S ZMSG(DVBABCNT)="Requester: "_REQN,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",44,0)
 S ZMSG(DVBABCNT)="Requesting Regional Office: "_RONAME,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",45,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",46,0)
 I $D(^DVB(396.4,"C",REQDA)) S ZMSG(DVBABCNT)="Exams on this request: ",DVBABCNT=DVBABCNT+1 D TST^DVBAB96 ;DVBCUTL2 
"RTN","DVBAB70",47,0)
 I '$D(^DVB(396.4,"C",REQDA)) S ZMSG(DVBABCNT)="(No exams have yet been entered)",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",48,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",49,0)
 S ZMSG(DVBABCNT)="** Status of request: ",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",50,0)
 S (XSTAT,STAT)=$P(^DVB(396.3,REQDA,0),U,18)
"RTN","DVBAB70",51,0)
 S STAT=$S(XSTAT="N":"New",XSTAT="P":"Pending, reported to MAS",XSTAT="T":"Transcribed",XSTAT="S":"Scheduled",XSTAT="R":"Released, not printed",XSTAT="C":"Completed",XSTAT="CT":"Completed, transferred out",XSTAT="NT":"New, transferred in",1:"")
"RTN","DVBAB70",52,0)
 I STAT]"" S ZMSG(DVBABCNT)=STAT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",53,0)
 I XSTAT="R"!(XSTAT="C") S Y=$P(^DVB(396.3,REQDA,0),U,14) X ^DD("DD") S RELBY=$P(^DVB(396.3,REQDA,0),U,15),RELBY=$S($D(^VA(200,+RELBY,0)):$P(^(0),U,1),1:"Unknown user") S ZMSG(DVBABCNT)="Released on "_Y_" by "_RELBY,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",54,0)
 I XSTAT="C" S Y=$P(^DVB(396.3,REQDA,0),U,16) X ^DD("DD") S PRBY=$P(^DVB(396.3,REQDA,0),U,17),PRBY=$S($D(^VA(200,+PRBY,0)):$P(^(0),U,1),1:"Unknown user") S ZMSG(DVBABCNT)="Printed by the RO on "_Y_" by "_PRBY,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",55,0)
 I STAT="" S STAT=$S(XSTAT="X":"Cancelled by MAS",XSTAT="RX":"Cancelled by RO",1:"Unknown") S ZMSG(DVBABCNT)=STAT,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",56,0)
 I STAT["Cancelled" S CANDT=$P(^DVB(396.3,REQDA,0),U,19) S ZMSG(DVBABCNT)="  (Cancelled on "_$$FMTE^XLFDT(CANDT,"5DZ")_")",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",57,0)
 I $D(^DVB(396.3,REQDA,1)),$P(^(1),U,3)="Y" S ZMSG(DVBABCNT)="This request was faxed to the regional office.",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",58,0)
 S FEXAM=$P(^DVB(396.3,REQDA,0),U,9) I FEXAM="Y" S ZMSG(DVBABCNT)="*** Exams done on a FEE BASIS ***  ",DVBABCNT=DVBABCNT+1 K FEXAM
"RTN","DVBAB70",59,0)
 S ZMSG(DVBABCNT)="--------------------------------------------------------------------------------",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",60,0)
 D DDIS Q:$D(OUT)  D CON Q:$D(OUT)
"RTN","DVBAB70",61,0)
 I IOST?1"P-".E,$Y>45 W @IOF D HDR
"RTN","DVBAB70",62,0)
 S ZMSG(DVBABCNT)="Other Disabilities: "_OTHDIS,DVBABCNT=DVBABCNT+1 I $D(^DVB(396.3,REQDA,1)) S ZMSG(DVBABCNT)="                    "_OTHDIS1,DVBABCNT=DVBABCNT+1 S ZMSG(DVBABCNT)="                    "_OTHDIS2,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",63,0)
 S ZMSG(DVBABCNT)="General Remarks:",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",64,0)
 K ^UTILITY($J,"W")
"RTN","DVBAB70",65,0)
 F LINE=0:0 S LINE=$O(^DVB(396.3,REQDA,2,LINE)) Q:LINE=""  S X=^(LINE,0),DIWL=5,DIWR=75,DIWF="NW" D ^DIWP S ZMSG(DVBABCNT)=X,DVBABCNT=DVBABCNT+1 ;I IOST?1"C-".E,$Y>19 D CON ;W !!,"General Remarks, continued",!!!
"RTN","DVBAB70",66,0)
END    K ^TMP($J),TSTA1,TSTAT,XCNP
"RTN","DVBAB70",67,0)
 Q
"RTN","DVBAB70",68,0)
DDIS1 S ZMSG(DVBABCNT)=DX_"  "_$J(PCT,3,0)_" %",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",69,0)
 S ZMSG(DVBABCNT)="    Service-Connected? "_$S(SC=1:"Yes",1:"No")_"  DX Code: "_DXCOD,DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",70,0)
 I $Y>19 D CON
"RTN","DVBAB70",71,0)
 Q
"RTN","DVBAB70",72,0)
DDIS I $Y>12 D CON Q:$D(OUT)
"RTN","DVBAB70",73,0)
 I '$D(^DPT(DFN,.372)) S ZMSG(DVBABCNT)="No rated disabilities on file",DVBABCNT=DVBABCNT+1 Q
"RTN","DVBAB70",74,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",75,0)
 S ZMSG(DVBABCNT)="RATED DISABILITIES:",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",76,0)
 F JII=0:0 S JII=$O(^DPT(DFN,.372,JII)) Q:JII=""  S DXNUM=$P(^DPT(DFN,.372,JII,0),U,1),PCT=$P(^(0),U,2),SC=$P(^(0),U,3),DX=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,1),1:"Unknown"),DXCOD=$S($D(^DIC(31,DXNUM)):$P(^(DXNUM,0),U,3),1:"Unknown") D DDIS1
"RTN","DVBAB70",77,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",78,0)
 Q
"RTN","DVBAB70",79,0)
HDR S PG=PG+1 W:(IOST?1"C-".E) @IOF
"RTN","DVBAB70",80,0)
 S ZMSG(DVBABCNT)="================================================================================",DVBABCNT=DVBABCNT+1
"RTN","DVBAB70",81,0)
 Q
"RTN","DVBAB82")
0^4^B74796139
"RTN","DVBAB82",1,0)
DVBAB82 ;ALB - CAPRI DVBA REPORTS;03/08/02
"RTN","DVBAB82",2,0)
 ;;2.7;AMIE;**42**;Apr 10, 1995
"RTN","DVBAB82",3,0)
 ;
"RTN","DVBAB82",4,0)
START(MSG,RPID,PARM) ; CALLED BY REMOTE PROCEDURE DVBAB REPORTS
"RTN","DVBAB82",5,0)
 ;Parameters
"RTN","DVBAB82",6,0)
 ;=============
"RTN","DVBAB82",7,0)
 ;      MSG  : Output - ^TMP("DVBA",$J)
"RTN","DVBAB82",8,0)
 ;      RPID : Report Identification Number
"RTN","DVBAB82",9,0)
 ;      PARM : Input parameters separated by "^"
"RTN","DVBAB82",10,0)
 ;
"RTN","DVBAB82",11,0)
 N DVBHFS,DVBERR,DVBGUI,I
"RTN","DVBAB82",12,0)
 K ^TMP("DVBA",$J)
"RTN","DVBAB82",13,0)
 S DVBGUI=1,DVBERR=0,DVBHFS=$$HFS()
"RTN","DVBAB82",14,0)
 I '$D(RPID) S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Report ID" D END Q
"RTN","DVBAB82",15,0)
 D HFSOPEN("DVBRP",DVBHFS,"W") I DVBERR D END Q
"RTN","DVBAB82",16,0)
 I RPID=1 D CRMS() I DVBERR D END Q
"RTN","DVBAB82",17,0)
 I RPID=2 D CHECK,CRRR(PARM) I DVBERR D END Q
"RTN","DVBAB82",18,0)
 I RPID=3 D CPRNT() I DVBERR D END Q
"RTN","DVBAB82",19,0)
 I RPID=4 D CHECK,CRPON(PARM) I DVBERR D END Q
"RTN","DVBAB82",20,0)
 I RPID=5 D CHECK,CIRPT(PARM) I DVBERR D END Q
"RTN","DVBAB82",21,0)
 I RPID=6 D CHECK,DSRP(PARM) I DVBERR D END Q
"RTN","DVBAB82",22,0)
 I RPID=7 D CHECK,SDPP(PARM) I DVBERR D END Q
"RTN","DVBAB82",23,0)
 I RPID=8 D CHECK,SPRPT(PARM) I DVBERR D END Q
"RTN","DVBAB82",24,0)
 I RPID=9 D CHECK,VIEW(PARM) I DVBERR D END Q
"RTN","DVBAB82",25,0)
 ;
"RTN","DVBAB82",26,0)
END D HFSCLOSE("DVBRP",DVBHFS)
"RTN","DVBAB82",27,0)
 S I=0 F  S I=$O(^TMP("DVBA",$J,1,I)) Q:'I  S ^TMP("DVBA",$J,1,I)=^TMP("DVBA",$J,1,I)_$C(13)
"RTN","DVBAB82",28,0)
 S MSG=$NA(^TMP("DVBA",$J))
"RTN","DVBAB82",29,0)
 Q
"RTN","DVBAB82",30,0)
CHECK ; VALIDATE INPUT PARAMETERS
"RTN","DVBAB82",31,0)
 I '$D(PARM) S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Input Parameters"
"RTN","DVBAB82",32,0)
 I DVBERR G END
"RTN","DVBAB82",33,0)
 Q
"RTN","DVBAB82",34,0)
 ;
"RTN","DVBAB82",35,0)
SDPP(PARM) ; Report # 7 - Full (Patient Profile MAS) Report
"RTN","DVBAB82",36,0)
 ;Parameters
"RTN","DVBAB82",37,0)
 ;=============
"RTN","DVBAB82",38,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",39,0)
 ; SDR : R/Range or A/All
"RTN","DVBAB82",40,0)
 ; SDBD : Begining date
"RTN","DVBAB82",41,0)
 ; SDED : Ending date
"RTN","DVBAB82",42,0)
 ; SDP : Do you want to print the profile? 1 OR 0
"RTN","DVBAB82",43,0)
 ; SDTYP(2) : Do you want to print appointments? 1 OR 0
"RTN","DVBAB82",44,0)
 ; SDTYP(1) : Do you want to print add/edits? 1 or 0
"RTN","DVBAB82",45,0)
 ; SDTYP(4) : Do you want to print enrollments? 1 or 0
"RTN","DVBAB82",46,0)
 ; SDTYP(3) : Do you want to print dispositions? 1 OR 0
"RTN","DVBAB82",47,0)
 ; SDTYP(7) : Do you want to print team information? 1 OR 0
"RTN","DVBAB82",48,0)
 ; SDTYP(5) : Do you want to print mean test? 1 OR 0
"RTN","DVBAB82",49,0)
 ;
"RTN","DVBAB82",50,0)
 K ^TMP("SDPP",$J) N SDBD,SDED,SDACT,SDPRINT,SDYES,SDRANGE,SDBEG,SDEN
"RTN","DVBAB82",51,0)
 S SDACT=""
"RTN","DVBAB82",52,0)
 S SDPRINT=0
"RTN","DVBAB82",53,0)
 S DFN=$P(PARM,"^",1),SDR=$P(PARM,"^",2),SDBD=$P(PARM,"^",3),SDED=$P(PARM,"^",4)
"RTN","DVBAB82",54,0)
 S SDP=$P(PARM,"^",5),SDTYP(2)=$P(PARM,"^",6),SDTYP(1)=$P(PARM,"^",7)
"RTN","DVBAB82",55,0)
 S SDTYP(4)=$P(PARM,"^",8),SDTYP(3)=$P(PARM,"^",9),SDTYP(7)=$P(PARM,"^",10),SDTYP(5)=$P(PARM,"^",11)
"RTN","DVBAB82",56,0)
 S (SDYES,SDRANGE)=0
"RTN","DVBAB82",57,0)
 D VAL
"RTN","DVBAB82",58,0)
 I SDR="R" S SDRANGE=1
"RTN","DVBAB82",59,0)
 I SDP=1 S SDYES=1
"RTN","DVBAB82",60,0)
 I SDYES S SDPRINT=1
"RTN","DVBAB82",61,0)
 I 'SDRANGE S (SDBD,SDBEG)=2800101,(SDED,SDEND)=$$ENDDT() S SDHDR=1
"RTN","DVBAB82",62,0)
 D ENS^%ZISS
"RTN","DVBAB82",63,0)
 N SDYN S SDPRINT=1
"RTN","DVBAB82",64,0)
 I $O(^DPT(DFN,"S",SDBD)) D
"RTN","DVBAB82",65,0)
 . I SDTYP(2)=1 S SDTYP(2)="" Q
"RTN","DVBAB82",66,0)
 . K SDTYP(2)
"RTN","DVBAB82",67,0)
 IF $$EXOE^SDOE(DFN,SDBD,SDED) D
"RTN","DVBAB82",68,0)
 . I SDTYP(1)=1 S SDTYP(1)="" Q
"RTN","DVBAB82",69,0)
 . K SDTYP(1)
"RTN","DVBAB82",70,0)
 I $D(^DPT(DFN,"DE")) D
"RTN","DVBAB82",71,0)
 . I SDTYP(4)=1 S SDTYP(4)="",SDACT=0 Q
"RTN","DVBAB82",72,0)
 . K SDTYP(4)
"RTN","DVBAB82",73,0)
 I $D(^DPT(DFN,"DIS")),$S('SDRANGE:1,+$O(^("DIS",9999999-(SDED+.9)))&($O(^(9999999-(SDED+.9)))<(9999999-(SDBD-.1))):1,1:0) D
"RTN","DVBAB82",74,0)
 . I SDTYP(3)=1 S SDTYP(3)="" Q
"RTN","DVBAB82",75,0)
 . K SDTYP(3)
"RTN","DVBAB82",76,0)
 S SDYN=$$LST^DGMTU(DFN) I SDYN D
"RTN","DVBAB82",77,0)
 . I SDTYP(5)=1 S SDTYP(5)="" Q
"RTN","DVBAB82",78,0)
 . K SDTYP(5)
"RTN","DVBAB82",79,0)
 I SDTYP(7)=1 D
"RTN","DVBAB82",80,0)
 . S SDTYP(7)="",GBL="^TMP(""SDPP"","_$J_")" Q
"RTN","DVBAB82",81,0)
 . K SDTYP(7)
"RTN","DVBAB82",82,0)
 D PRINT^SDPPRT
"RTN","DVBAB82",83,0)
 K SDTYP S VALMBCK="R" Q
"RTN","DVBAB82",84,0)
 Q
"RTN","DVBAB82",85,0)
ENDDT() ;Calculate end date for "all" date
"RTN","DVBAB82",86,0)
 N X S X=$O(^DPT(DFN,"S",""),-1) S:X<DT X=DT_.24 Q X
"RTN","DVBAB82",87,0)
 ;
"RTN","DVBAB82",88,0)
VIEW(PARM) ; Report # 9 - View Registration Data Report
"RTN","DVBAB82",89,0)
 ; Parameters
"RTN","DVBAB82",90,0)
 ; ==========
"RTN","DVBAB82",91,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",92,0)
 ;
"RTN","DVBAB82",93,0)
 U IO
"RTN","DVBAB82",94,0)
 S DFN=$P(PARM,"^",1)
"RTN","DVBAB82",95,0)
 D VAL
"RTN","DVBAB82",96,0)
 D EN1^DGRP
"RTN","DVBAB82",97,0)
 Q
"RTN","DVBAB82",98,0)
DSRP(PARM) ; Report # 6 - Reprint a Notice of Discharge Report
"RTN","DVBAB82",99,0)
 ; Paraments
"RTN","DVBAB82",100,0)
 ; % : 1=Report on all veterans for a given day (BDATE required)
"RTN","DVBAB82",101,0)
 ;   : 0=Report on a single Veteran (DFN required)
"RTN","DVBAB82",102,0)
 ; BDATE : Original Prcessing Date - $H/FileMan
"RTN","DVBAB82",103,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",104,0)
 ;
"RTN","DVBAB82",105,0)
 N %,BDATE,DFN,DFNIEN
"RTN","DVBAB82",106,0)
 S %=$P(PARM,"^",1),BDATE=$P(PARM,"^",2),DFN=$P(PARM,"^",3)
"RTN","DVBAB82",107,0)
 S DFNIEN=""
"RTN","DVBAB82",108,0)
 D DUZ2^DVBAUTIL
"RTN","DVBAB82",109,0)
 U IO
"RTN","DVBAB82",110,0)
 D VAL
"RTN","DVBAB82",111,0)
 I %=1 D  Q
"RTN","DVBAB82",112,0)
 . S HD="SINGLE NOTICE OF DISCHARGE REPRINTING"
"RTN","DVBAB82",113,0)
 . D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB82",114,0)
 . S HEAD="NOTICE OF DISCHARGE",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBAB82",115,0)
 . I $D(^DVB(396.2,"B",DFN)) D
"RTN","DVBAB82",116,0)
 . . S DFNIEN=$O(^DVB(396.2,"B",DFN,DFNIEN))
"RTN","DVBAB82",117,0)
 . . S ADM=$P(^DVB(396.2,DFNIEN,0),U,3)
"RTN","DVBAB82",118,0)
 . . I $D(^DGPM(+ADM,0)),$P(^(0),U,17)]"" S DCHPTR=$P(^DGPM(+ADM,0),U,17),DISCH=$S($P(^DGPM(DCHPTR,0),U,1)]"":$P(^(0),U,1),1:"") W ?($X+5),"Discharge date: ",$$FMTE^XLFDT(DISCH,"5DZ")
"RTN","DVBAB82",119,0)
 . . I $P(^DVB(396.2,DFNIEN,0),U,7)'=DVBAD2 W *7,!!,"This does not belong to your RO.",!! H 3 Q
"RTN","DVBAB82",120,0)
 . . I DFNIEN>0 S XDA=DFNIEN,DA=$P(^DVB(396.2,DFNIEN,0),U,1),ADMDT=$P(^DVB(396.2,DFNIEN,0),U,2),MB=$P(^(0),U,3)
"RTN","DVBAB82",121,0)
 . . D REPRINT^DVBADSNT Q
"RTN","DVBAB82",122,0)
 I '$D(BDATE) S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Date"  Q
"RTN","DVBAB82",123,0)
 D DEQUE^DVBADSRP
"RTN","DVBAB82",124,0)
 Q
"RTN","DVBAB82",125,0)
 ;
"RTN","DVBAB82",126,0)
SPRPT(PARM) ; Report # 8 - OP(Operation Report)
"RTN","DVBAB82",127,0)
 ;Parameters
"RTN","DVBAB82",128,0)
 ;=============
"RTN","DVBAB82",129,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB82",130,0)
 ; SRTN : Select Operation
"RTN","DVBAB82",131,0)
 ;
"RTN","DVBAB82",132,0)
 N DFN,SRTN,MAGTMPR2,SRSITE
"RTN","DVBAB82",133,0)
 I $O(^SRO(133,1))'="B" S SRSITE=1
"RTN","DVBAB82",134,0)
 S DFN=$P(PARM,"^",1),SRTN=$P(PARM,"^",2),MAGTMPR2=1
"RTN","DVBAB82",135,0)
 D VAL
"RTN","DVBAB82",136,0)
 D ^SROPRPT
"RTN","DVBAB82",137,0)
 Q
"RTN","DVBAB82",138,0)
 ;
"RTN","DVBAB82",139,0)
CRPON(PARM) ; Report # - 4 Reprint C&P Final Report
"RTN","DVBAB82",140,0)
 ;Parameters
"RTN","DVBAB82",141,0)
 ;=============
"RTN","DVBAB82",142,0)
 ; RTYPE : Select Reprint Option (D)ate or (V)eteran
"RTN","DVBAB82",143,0)
 ; RUNDATE : ORIGINAL PROCESSING date
"RTN","DVBAB82",144,0)
 ; ANS : Reprinted by the RO or MAS
"RTN","DVBAB82",145,0)
 ; % : LAB 1 OR 0
"RTN","DVBAB82",146,0)
 ; DA(1) : Patient IEN for lab results
"RTN","DVBAB82",147,0)
 ; DFN  : Patient Identification Number
"RTN","DVBAB82",148,0)
 ;
"RTN","DVBAB82",149,0)
 U IO
"RTN","DVBAB82",150,0)
 N ONE
"RTN","DVBAB82",151,0)
 S RTYPE=$P(PARM,"^",1),RUNDATE=$P(PARM,"^",2),ANS=$P(PARM,"^",3),%=$P(PARM,"^",4),DA(1)=$P(PARM,"^",5),DFN=$P(PARM,"^",6),DA=DA(1)
"RTN","DVBAB82",152,0)
 D VAL
"RTN","DVBAB82",153,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_"
"RTN","DVBAB82",154,0)
 S ONE="N",Y=DT X XDD S HD="Reprint C & P Exams"
"RTN","DVBAB82",155,0)
 S SUPER=0 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) S SUPER=1
"RTN","DVBAB82",156,0)
 S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",LOC=DUZ(2),PG=0,DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBAB82",157,0)
 I "^D^V^"'[RTYPE S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",158,0)
 I ANS="R" K AUTO
"RTN","DVBAB82",159,0)
 I ANS="M" S AUTO=1
"RTN","DVBAB82",160,0)
 I "^M^R^"'[ANS S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",161,0)
 I RTYPE="D" D  Q
"RTN","DVBAB82",162,0)
 . D GO^DVBCRPRT
"RTN","DVBAB82",163,0)
 I RTYPE="V" D  Q
"RTN","DVBAB82",164,0)
 . S ONE="Y",RO=$P(^DVB(396.3,DA,0),U,3)
"RTN","DVBAB82",165,0)
 . I RO'=DUZ(2)&('$D(AUTO))&(SUPER=0) W !!,*7,"Those results do not belong to your office.",!! Q
"RTN","DVBAB82",166,0)
 . I RO=DUZ(2)&('$D(AUTO))&("RC"'[($P(^DVB(396.3,DA,0),U,18))) W *7,!!,"This request has not been released to the Regional Office yet.",!! Q
"RTN","DVBAB82",167,0)
 . S PRTDATE=$P(^DVB(396.3,DA,0),U,16) I PRTDATE="" W *7,!!,"This has never been printed.",!! I SUPER=0 S OUT=1 Q
"RTN","DVBAB82",168,0)
 . I %=1 D REN2^DVBCLABR Q
"RTN","DVBAB82",169,0)
 . ;D OV^DVBCRPON
"RTN","DVBAB82",170,0)
 . K DVBAON2 D SETLAB^DVBCPRNT,VARS^DVBCUTIL,STEP2^DVBCRPRT
"RTN","DVBAB82",171,0)
 Q
"RTN","DVBAB82",172,0)
 ;
"RTN","DVBAB82",173,0)
CIRPT(PARM) ; Report # 5 - Insufficient Exam Report
"RTN","DVBAB82",174,0)
 ;Parameters
"RTN","DVBAB82",175,0)
 ;=============
"RTN","DVBAB82",176,0)
 ; RPTTYPE : D/Detailed or S/Summary
"RTN","DVBAB82",177,0)
 ; BEGDT : Beginning date $H/FileMan
"RTN","DVBAB82",178,0)
 ; ENDDT : Ending date $H/FileMan
"RTN","DVBAB82",179,0)
 ; RESANS : Insufficient Reason
"RTN","DVBAB82",180,0)
 ;
"RTN","DVBAB82",181,0)
 U IO
"RTN","DVBAB82",182,0)
 S RPTTYPE=$P(PARM,"^",1),BEGDT=$P(PARM,"^",2),ENDDT=$P(PARM,"^",3),RESANS=$P(PARM,"^",4)
"RTN","DVBAB82",183,0)
 I RPTTYPE="S" D  Q
"RTN","DVBAB82",184,0)
 . D SUM^DVBCIRPT
"RTN","DVBAB82",185,0)
 I RPTTYPE="D" D  Q
"RTN","DVBAB82",186,0)
 . I RESANS="" D
"RTN","DVBAB82",187,0)
 . . S Y=-1 D INREAS
"RTN","DVBAB82",188,0)
 . I '$D(DVBAARY("REASON")) S DVBAQTSL=""
"RTN","DVBAB82",189,0)
 . S DVBCYQ=""
"RTN","DVBAB82",190,0)
 . I RESANS'="" S Y=RESANS D INREAS
"RTN","DVBAB82",191,0)
 . K Y,DTOUT,DUOUT
"RTN","DVBAB82",192,0)
 . S Y=-1 D EXMTPE
"RTN","DVBAB82",193,0)
 . D DETAIL^DVBCIRP1
"RTN","DVBAB82",194,0)
 Q
"RTN","DVBAB82",195,0)
 ;
"RTN","DVBAB82",196,0)
EXMTPE ;
"RTN","DVBAB82",197,0)
 N YSAVE
"RTN","DVBAB82",198,0)
 S YSAVE=Y
"RTN","DVBAB82",199,0)
 N DVBAXIFN
"RTN","DVBAB82",200,0)
 F DVBAXIFN=0:0 S DVBAXIFN=$O(^DVB(396.6,DVBAXIFN)) Q:+DVBAXIFN=0  DO
"RTN","DVBAB82",201,0)
 . S ^TMP($J,"XMTYPE",DVBAXIFN)=""
"RTN","DVBAB82",202,0)
 S Y=-1
"RTN","DVBAB82",203,0)
 I +YSAVE>0 S ^TMP($J,"XMTYPE",+YSAVE)=""
"RTN","DVBAB82",204,0)
 S Y=YSAVE
"RTN","DVBAB82",205,0)
 K DTOUT,DUOUT,DIR
"RTN","DVBAB82",206,0)
 Q
"RTN","DVBAB82",207,0)
INREAS ;
"RTN","DVBAB82",208,0)
 N YSAVE
"RTN","DVBAB82",209,0)
 S YSAVE=Y
"RTN","DVBAB82",210,0)
 N DVBXIFN
"RTN","DVBAB82",211,0)
 F DVBAXIFN=0:0 S DVBAXIFN=$O(^DVB(396.94,DVBAXIFN)) Q:+DVBAXIFN=0  DO
"RTN","DVBAB82",212,0)
 . S DVBAARY("REASON",DVBAXIFN)=""
"RTN","DVBAB82",213,0)
 S Y=-1
"RTN","DVBAB82",214,0)
 I +YSAVE>0 S DVBAARY("REASON",+YSAVE)=""
"RTN","DVBAB82",215,0)
 S Y=YSAVE
"RTN","DVBAB82",216,0)
 K DTOUT,DUOUT,DIR
"RTN","DVBAB82",217,0)
 Q
"RTN","DVBAB82",218,0)
 ;
"RTN","DVBAB82",219,0)
CRMS() ; Report # 1 - Regional Office 21- day Certificate Printing Report.
"RTN","DVBAB82",220,0)
 ; No Parameters
"RTN","DVBAB82",221,0)
 ;
"RTN","DVBAB82",222,0)
 U IO
"RTN","DVBAB82",223,0)
 D ^DVBACRMS
"RTN","DVBAB82",224,0)
 Q
"RTN","DVBAB82",225,0)
 ;
"RTN","DVBAB82",226,0)
CRRR(PARM) ; Report # 2 - Reprint a 21 - day Certificate for the RO
"RTN","DVBAB82",227,0)
 ;Parameters
"RTN","DVBAB82",228,0)
 ;=============
"RTN","DVBAB82",229,0)
 ; DVBSEL : Select one of the following:
"RTN","DVBAB82",230,0)
 ;       N         Patient Name
"RTN","DVBAB82",231,0)
 ;       D         ORIGINAL PROCESSING DATE
"RTN","DVBAB82",232,0)
 ; SDATE : ORIGINAL PROCESSING date - $H/FileMan
"RTN","DVBAB82",233,0)
 ; XDA : Patient IEN
"RTN","DVBAB82",234,0)
 ;
"RTN","DVBAB82",235,0)
 U IO
"RTN","DVBAB82",236,0)
 S DVBSEL=$P(PARM,"^",1),SDATE=$P(PARM,"^",2),XDA=$P(PARM,"^",3)
"RTN","DVBAB82",237,0)
 I "^D^N^"'[DVBSEL S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Data Type" Q
"RTN","DVBAB82",238,0)
 I DVBSEL="D" D  I DVBERR Q
"RTN","DVBAB82",239,0)
 . I '$D(SDATE) S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Date" Q
"RTN","DVBAB82",240,0)
 . S %DT="X" S X=SDATE D ^%DT I Y<0 D  Q
"RTN","DVBAB82",241,0)
 . . S DVBERR=1,^TMP("DVBA",$J,1)="0^Incorrect Date Format"
"RTN","DVBAB82",242,0)
 I DVBSEL="N" D  I DVBERR Q
"RTN","DVBAB82",243,0)
 . I '$D(XDA) S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Patient IEN" Q
"RTN","DVBAB82",244,0)
 . S DIC=2,DIC(0)="NZX",X=XDA D ^DIC I Y<0 D  I DVBERR Q
"RTN","DVBAB82",245,0)
 . . S ^TMP("DVBA",$J,1)="0^Invalid Patient Name."
"RTN","DVBAB82",246,0)
 . S DFN=XDA
"RTN","DVBAB82",247,0)
 D INIT^DVBACRRR I 'CONT Q
"RTN","DVBAB82",248,0)
 D HDR^DVBACRRR
"RTN","DVBAB82",249,0)
 D DATA^DVBACRRR
"RTN","DVBAB82",250,0)
 Q
"RTN","DVBAB82",251,0)
 ;
"RTN","DVBAB82",252,0)
CPRNT() ; Report # 3 - Print C&P Final Report (manual) Report
"RTN","DVBAB82",253,0)
 ; No Parameters
"RTN","DVBAB82",254,0)
 ;
"RTN","DVBAB82",255,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_"
"RTN","DVBAB82",256,0)
 S Y=DT X XDD S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not Specified")
"RTN","DVBAB82",257,0)
 D GO^DVBCPRNT
"RTN","DVBAB82",258,0)
 Q
"RTN","DVBAB82",259,0)
VAL ; VALIDATE PATIENT
"RTN","DVBAB82",260,0)
 I '$D(DFN) S DVBERR=1,^TMP("DVBA",$J,1)="0^Undefined Patient IEN" Q
"RTN","DVBAB82",261,0)
 S DIC=2,DIC(0)="NZX",X=DFN D ^DIC I Y<0 D  I DVBERR Q
"RTN","DVBAB82",262,0)
 . S ^TMP("DVBA",$J,1)="0^Invalid Patient Name."
"RTN","DVBAB82",263,0)
 Q
"RTN","DVBAB82",264,0)
 ;
"RTN","DVBAB82",265,0)
HFS() ; -- get hfs file name
"RTN","DVBAB82",266,0)
 N H
"RTN","DVBAB82",267,0)
 S H=$H
"RTN","DVBAB82",268,0)
 Q "DVBA_"_$J_"_"_$P(H,",")_"_"_$P(H,",",2)_".DAT"
"RTN","DVBAB82",269,0)
 ;
"RTN","DVBAB82",270,0)
HFSOPEN(HANDLE,DVBHFS,DVBMODE)    ; Open File
"RTN","DVBAB82",271,0)
 S DVBDIRY=$$GET^XPAR("DIV","DVB HFS SCRATCH")
"RTN","DVBAB82",272,0)
 ;I DVBDIRY="" S ECERR=1 D  Q
"RTN","DVBAB82",273,0)
 ;. S ^TMP("DVBA",$J,1)="0^A scratch directory for reports doesn't exist"
"RTN","DVBAB82",274,0)
 D OPEN^%ZISH(HANDLE,,DVBHFS,$G(DVBMODE,"W")) D:POP  Q:POP
"RTN","DVBAB82",275,0)
 .S DVBERR=1,^TMP("DVBA",$J,1)="0^Unable to open file "
"RTN","DVBAB82",276,0)
 Q
"RTN","DVBAB82",277,0)
 ;
"RTN","DVBAB82",278,0)
HFSCLOSE(HANDLE,DVBHFS) ;Close HFS and unload data
"RTN","DVBAB82",279,0)
 N DVBDEL,X,%ZIS
"RTN","DVBAB82",280,0)
 D CLOSE^%ZISH(HANDLE)
"RTN","DVBAB82",281,0)
 S ROOT=$NA(^TMP("DVBA",$J,1)),DVBDEL(DVBHFS)=""
"RTN","DVBAB82",282,0)
 K @ROOT
"RTN","DVBAB82",283,0)
 S X=$$FTG^%ZISH(,DVBHFS,$NA(@ROOT@(1)),4)
"RTN","DVBAB82",284,0)
 S X=$$DEL^%ZISH(,$NA(DVBDEL))
"RTN","DVBAB82",285,0)
 Q
"RTN","DVBAB89")
0^61^B3353747
"RTN","DVBAB89",1,0)
DVBAB89 ;GT-CAPRI FULL ;05/10/02
"RTN","DVBAB89",2,0)
 ;;2.7;AMIE;**42**;Apr 10, 1995
"RTN","DVBAB89",3,0)
 ;
"RTN","DVBAB89",4,0)
 ;
"RTN","DVBAB89",5,0)
START(MSG,DFN) ;CALLED BY REMOTE PROCEDURE DVBAB SURGERY CASE
"RTN","DVBAB89",6,0)
 ;Parameters
"RTN","DVBAB89",7,0)
 ;=============
"RTN","DVBAB89",8,0)
 ; MSG : Output - data global ^TMP("SURGERY")
"RTN","DVBAB89",9,0)
 ; DFN : Patient Identification Number
"RTN","DVBAB89",10,0)
 ;
"RTN","DVBAB89",11,0)
 K ^TMP("DVBSURGERY",$J)
"RTN","DVBAB89",12,0)
 N COUNT,VAR S VAR="",COUNT=0
"RTN","DVBAB89",13,0)
 I '$D(^DPT(DFN,0)) S ^TMP("DVBSURGERY",$J,COUNT)="Not a valid patient" Q
"RTN","DVBAB89",14,0)
 I $D(^SRF("B",DFN)) D
"RTN","DVBAB89",15,0)
 . F  S VAR=$O(^SRF("B",DFN,VAR)) Q:VAR=""  D
"RTN","DVBAB89",16,0)
 . . S DVBSROP=$P(^SRF(VAR,"OP"),"^",1)
"RTN","DVBAB89",17,0)
 . . D ^DVBASRP1
"RTN","DVBAB89",18,0)
 . . S ^TMP("DVBSURGERY",$J,COUNT)=VAR_"^"_$P(^SRF(VAR,0),"^",9)_"^"_DVBSROP_$C(13)
"RTN","DVBAB89",19,0)
 . . S COUNT=COUNT+1
"RTN","DVBAB89",20,0)
 S MSG=$NA(^TMP("DVBSURGERY",$J))
"RTN","DVBAB89",21,0)
 Q
"RTN","DVBAB89",22,0)
 ;
"RTN","DVBAB89",23,0)
XDA(MSG,DFN) ;CALLED BY REMOTE PROCEDURE DVBAB ORIGINAL PROCESSING DATE
"RTN","DVBAB89",24,0)
 K ^TMP("REPRINT",$J)
"RTN","DVBAB89",25,0)
 N VAR,COUNT
"RTN","DVBAB89",26,0)
 I '$D(DFN) S ^TMP("REPRINT",$J,COUNT)="0^Undefined Patient IEN" Q
"RTN","DVBAB89",27,0)
 S DIC=2,DIC(0)="NZX",X=DFN D ^DIC I Y<0 D
"RTN","DVBAB89",28,0)
 . S ^TMP("REPRINT",$J,COUNT)="0^Invalid Patient Name." Q
"RTN","DVBAB89",29,0)
 S VAR="",COUNT=0
"RTN","DVBAB89",30,0)
 I $D(^DVB(396,"B",DFN)) D
"RTN","DVBAB89",31,0)
 . F  S VAR=$O(^DVB(396,"B",DFN,VAR)) Q:VAR=""  D
"RTN","DVBAB89",32,0)
 . . I $D(^DVB(396,VAR,4)),$P(^DVB(396,VAR,4),U,4)]"",$D(^DVB(396,VAR,2)),$P(^DVB(396,VAR,2),U,10)'="L",$D(^DPT($P(^DVB(396,VAR,0),U,1),0)) D
"RTN","DVBAB89",33,0)
 . . . S ^TMP("REPRINT",$J,COUNT)=VAR_"^"_$P(^DVB(396,VAR,4),"^",2)_$C(13)
"RTN","DVBAB89",34,0)
 . . . S COUNT=COUNT+1
"RTN","DVBAB89",35,0)
 S MSG=$NA(^TMP("REPRINT",$J))
"RTN","DVBAB89",36,0)
 Q
"RTN","DVBACRRR")
0^63^B17987233
"RTN","DVBACRRR",1,0)
DVBACRRR ;ALB/GTS-557/THM-REPRINT 21-DAY CERT FOR THE RO ;21 JUL 89 
"RTN","DVBACRRR",2,0)
 ;;2.7;AMIE;**42**;Apr 10, 1995
"RTN","DVBACRRR",3,0)
 ;
"RTN","DVBACRRR",4,0)
 D INIT
"RTN","DVBACRRR",5,0)
 I CONT=0 G KIL
"RTN","DVBACRRR",6,0)
 D HDR
"RTN","DVBACRRR",7,0)
 S DVBSEL=$$SELECT^DVBAUTL5("ORIGINAL PROCESSING DATE","21 Day Certificate")
"RTN","DVBACRRR",8,0)
 I DVBSEL="D" S SDATE=$$DATE^DVBACRRP G:SDATE<0 KIL
"RTN","DVBACRRR",9,0)
 I DVBSEL="N" S XDA=$$PAT^DVBAUTL5("RO") G:XDA<1 KIL
"RTN","DVBACRRR",10,0)
 I DVBSEL=0 G KIL
"RTN","DVBACRRR",11,0)
 I 'CONT G KIL
"RTN","DVBACRRR",12,0)
 D DEVICE
"RTN","DVBACRRR",13,0)
 I 'CONT G KIL
"RTN","DVBACRRR",14,0)
 D DATA
"RTN","DVBACRRR",15,0)
KIL D KILL
"RTN","DVBACRRR",16,0)
 Q
"RTN","DVBACRRR",17,0)
 ;
"RTN","DVBACRRR",18,0)
DEVICE ;
"RTN","DVBACRRR",19,0)
 S VAR(1,0)="0,0,0,2:0,0^"
"RTN","DVBACRRR",20,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBACRRR",21,0)
 K VAR
"RTN","DVBACRRR",22,0)
 S %ZIS="AEQ"
"RTN","DVBACRRR",23,0)
 D ^%ZIS
"RTN","DVBACRRR",24,0)
 K %ZIS
"RTN","DVBACRRR",25,0)
 I POP S CONT=0 Q
"RTN","DVBACRRR",26,0)
 I $D(IO("Q")) DO
"RTN","DVBACRRR",27,0)
 .S CONT=0
"RTN","DVBACRRR",28,0)
 .S ZTIO=ION,ZTDESC="21-day Cert reprint",ZTRTN="DATA^DVBACRRR"
"RTN","DVBACRRR",29,0)
 .F I="DVBSEL","XDA","DVBAD2","FDT(0)","HD","HD1","SDATE","NODTA" S ZTSAVE(I)=""
"RTN","DVBACRRR",30,0)
 .D ^%ZTLOAD
"RTN","DVBACRRR",31,0)
 .D ^%ZISC
"RTN","DVBACRRR",32,0)
 .I $D(ZTSK) DO
"RTN","DVBACRRR",33,0)
 ..S VAR(1,0)="0,0,0,2:2,0^Request queued."
"RTN","DVBACRRR",34,0)
 ..D WR^DVBAUTL4("VAR")
"RTN","DVBACRRR",35,0)
 ..K VAR
"RTN","DVBACRRR",36,0)
 ..Q
"RTN","DVBACRRR",37,0)
 .Q
"RTN","DVBACRRR",38,0)
 Q
"RTN","DVBACRRR",39,0)
 ;
"RTN","DVBACRRR",40,0)
DATA ;
"RTN","DVBACRRR",41,0)
 I DVBSEL="D" DO  ;by date range
"RTN","DVBACRRR",42,0)
 .U IO
"RTN","DVBACRRR",43,0)
 .F XDA=0:0 S XDA=$O(^DVB(396,"AC",DVBAD2,"P",XDA)) Q:XDA=""  S DFN=$P(^DVB(396,XDA,0),U,1) I $P(^(4),U,4)=SDATE D CREATE
"RTN","DVBACRRR",44,0)
 .Q
"RTN","DVBACRRR",45,0)
 I DVBSEL="N" DO  ;by name/ssn
"RTN","DVBACRRR",46,0)
 .S DFN=$P(^DVB(396,XDA,0),U,1)
"RTN","DVBACRRR",47,0)
 .D CREATE
"RTN","DVBACRRR",48,0)
 .Q
"RTN","DVBACRRR",49,0)
 I NODTA=0 DO  ;no data found
"RTN","DVBACRRR",50,0)
 .S VAR(1,0)="0,0,0,2:2,0^No data found to reprint"
"RTN","DVBACRRR",51,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBACRRR",52,0)
 .K VAR
"RTN","DVBACRRR",53,0)
 .Q
"RTN","DVBACRRR",54,0)
 ;
"RTN","DVBACRRR",55,0)
KILL K DVBAON2,DVBSEL,VAR,DVBAD2,CONT
"RTN","DVBACRRR",56,0)
 Q:$G(DVBGUI)  D:$D(ZTQUEUED) KILL^%ZTLOAD
"RTN","DVBACRRR",57,0)
 D KILL^DVBAUTIL
"RTN","DVBACRRR",58,0)
 Q
"RTN","DVBACRRR",59,0)
 ;
"RTN","DVBACRRR",60,0)
CREATE ;CERTIFICATE CREATE
"RTN","DVBACRRR",61,0)
 I $D(^DVB(396,XDA,2)) Q:$P(^(2),U,10)="L"
"RTN","DVBACRRR",62,0)
 I '$D(^DPT(DFN,0)) W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBACRRR",63,0)
 I '$D(^DPT(DFN,0)) W !!,"Patient record missing for DFN ",DFN,!!
"RTN","DVBACRRR",64,0)
 I '$D(^DPT(DFN,0)) S DVBAON2="" Q
"RTN","DVBACRRR",65,0)
 S PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9),CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown")
"RTN","DVBACRRR",66,0)
 S WARD=$P(^DVB(396,XDA,4),U,6),BED=$P(^(4),U,7),DCHGDT=$P(^(4),U,5),ADMDT=$P(^(0),U,4)
"RTN","DVBACRRR",67,0)
 U IO W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBACRRR",68,0)
 W !,FDT(0),?32,"REPORT OF CONTACT",!,?31,"21-DAY CERTIFICATE",?(80-11),"PAGE: 1",!,?(80-$L(HD1)\2),HD1,!!!!!!!,"Patient name: ",?16,PNAM,!,?9,"SSN: ",?16,SSN,?33,"Claim #: ",?43,CNUM,!!,?9,"Ward: ",?16,WARD,?30,"Bed: ",?36,BED,!!!
"RTN","DVBACRRR",69,0)
 W "     The patient above has been hospitalized for 21 consecutive days ",!,"from " S Y=ADMDT X ^DD("DD") W Y," to " S Y=DCHGDT X ^DD("DD") W Y,", and the major diagnosis for",!,"this period is:",!!!
"RTN","DVBACRRR",70,0)
 K ^UTILITY($J,"W")
"RTN","DVBACRRR",71,0)
 F LINE=0:0 S LINE=$O(^DVB(396,XDA,3,LINE)) Q:LINE=""  S X=^(LINE,0),DIWL=5,DIWR=75,DIWF="NW" D ^DIWP
"RTN","DVBACRRR",72,0)
 D ^DIWW W !!!,"A signed copy of this document is on file at "_HD1,!
"RTN","DVBACRRR",73,0)
 W !!?5,"R0C  119",!
"RTN","DVBACRRR",74,0)
 S NODTA=1,DVBAON2=""
"RTN","DVBACRRR",75,0)
 Q
"RTN","DVBACRRR",76,0)
 ;
"RTN","DVBACRRR",77,0)
HDR ;Displays the header to this option.
"RTN","DVBACRRR",78,0)
 S VAR(1,0)="0,0,(IOM-$L(HD)\2),1:3,1:0^"_HD
"RTN","DVBACRRR",79,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBACRRR",80,0)
 K VAR
"RTN","DVBACRRR",81,0)
 S VAR(1,0)="0,0,0,0:2,0^This program REPRINTS 21-day certificates for the RO."
"RTN","DVBACRRR",82,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBACRRR",83,0)
 K VAR
"RTN","DVBACRRR",84,0)
 Q
"RTN","DVBACRRR",85,0)
 ;
"RTN","DVBACRRR",86,0)
INIT ;sets up and checks various variables
"RTN","DVBACRRR",87,0)
 S CONT=1
"RTN","DVBACRRR",88,0)
 D DUZ2^DVBAUTIL
"RTN","DVBACRRR",89,0)
 I $D(DVBAQUIT) S CONT=0
"RTN","DVBACRRR",90,0)
 I $D(DUZ)#2=0 DO
"RTN","DVBACRRR",91,0)
 .S VAR(1,0)="1,0,0,2:2,0^Your USER NUMBER is missing.  Call the site manager."
"RTN","DVBACRRR",92,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBACRRR",93,0)
 .K VAR
"RTN","DVBACRRR",94,0)
 .I '$D(DVBGUI) D PAUSE^DVBCUTL4
"RTN","DVBACRRR",95,0)
 .S CONT=0
"RTN","DVBACRRR",96,0)
 .Q
"RTN","DVBACRRR",97,0)
 I CONT=0 Q
"RTN","DVBACRRR",98,0)
 S NODTA=0,HD="REGIONAL OFFICE 21-DAY CERTIFICATE REPRINTING"
"RTN","DVBACRRR",99,0)
 I '$D(DVBGUI) D HOME^%ZIS
"RTN","DVBACRRR",100,0)
 D NOPARM^DVBAUTL2
"RTN","DVBACRRR",101,0)
 I $D(DVBAQUIT) S CONT=0
"RTN","DVBACRRR",102,0)
 S HD1=$$SITE^DVBCUTL4
"RTN","DVBACRRR",103,0)
 I '$D(DT) S X="T" D ^%DT S DT=Y
"RTN","DVBACRRR",104,0)
 S Y=DT X ^DD("DD") S FDT(0)=Y
"RTN","DVBACRRR",105,0)
 Q
"RTN","DVBADSNT")
0^79^B23841246
"RTN","DVBADSNT",1,0)
DVBADSNT ;ALB/GTS-557/THM-GENERATE AMIE NOTICE OF DISCHARGE ; 1/16/91  7:37 AM
"RTN","DVBADSNT",2,0)
 ;;2.7;AMIE;**1,14,17,42**;Apr 10, 1995
"RTN","DVBADSNT",3,0)
 N DVBGUI
"RTN","DVBADSNT",4,0)
 S DVBGUI=0
"RTN","DVBADSNT",5,0)
 K ^TMP($J) G TERM
"RTN","DVBADSNT",6,0)
 ;
"RTN","DVBADSNT",7,0)
SET Q:'$D(^DPT(DFN,0))  D RCV^DVBAVDPT S ^TMP($J,XCN,CFLOC,MB,DFN)=XDA_U_XDA2_U_ADMDT_U_RCVAA_U_RCVPEN_U_CNUM
"RTN","DVBADSNT",8,0)
 Q
"RTN","DVBADSNT",9,0)
 ;
"RTN","DVBADSNT",10,0)
ENBROKER(Y) ;
"RTN","DVBADSNT",11,0)
 N DVBGUI,DVBHFS,DVBERR
"RTN","DVBADSNT",12,0)
 S DVBGUI=1,DVBERR=0,DVBHFS=$$HFS^DVBAB82()
"RTN","DVBADSNT",13,0)
 K ^TMP($J) G TERM
"RTN","DVBADSNT",14,0)
 Q
"RTN","DVBADSNT",15,0)
PRINTB S XDA=$P(DATA,U),XDA2=$P(DATA,U,2),ADMDT=$P(DATA,U,3),RCVAA=$P(DATA,U,4),RCVPEN=$P(DATA,U,5),CNUM=$P(DATA,U,6),QUIT1=1 D ADM^DVBAVDPT
"RTN","DVBADSNT",16,0)
 S LADM=ADM
"RTN","DVBADSNT",17,0)
 I '$D(^DGPM(LADM,0)) S FND=1
"RTN","DVBADSNT",18,0)
 I $D(^DGPM(LADM,0)) N HPAT S HPAT=$P(^DGPM(LADM,0),"^",3) I $D(^DPT(HPAT,0)) S HPAT=$P(^DPT(HPAT,0),"^") I (HPAT'=PNAM)!(ADMDT'=$P(^DGPM(LADM,0),"^")) S FND=1
"RTN","DVBADSNT",19,0)
 I $D(FND) N Y S Y=ADMDT D DD^%DT W !!,"Admission entry in Patient Movement File has been deleted for: ",!,?5,PNAM,?25,SSN,?35," at ",Y,!,"Contact VAMC for further information.",! K Y,FND D FUPD Q
"RTN","DVBADSNT",20,0)
 S DCHPTR=$P(^DGPM(LADM,0),U,17),TDIS=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U,18),1:"") I TDIS="" S TDIS="Unknown discharge type"
"RTN","DVBADSNT",21,0)
 S:'$D(^DG(405.2,+TDIS,0)) TDIS="Unknown discharge type" I $D(^(0)) S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBADSNT",22,0)
 I DCHGDT="" S DCHGDT=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U),1:"")
"RTN","DVBADSNT",23,0)
 W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBADSNT",24,0)
 W !!!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBADSNT",25,0)
 W ?10,"Patient Name:",?26,PNAM,!!,?14,"Claim No:",?26,CNUM,!,?6,"Claim Folder Loc:",?26,CFLOC,!,?9,"Social Sec No:",?26,SSN,!,?8,"Discharge Date:",?26,$$FMTE^XLFDT(DCHGDT,"5DZ"),!
"RTN","DVBADSNT",26,0)
 W ?5,"Type of Discharge:",?26,TDIS,!
"RTN","DVBADSNT",27,0)
 D LOS^DVBAUTIL W ?8,"Length of Stay:",?26,LOS_$S(LOS="":"Discharged same day",LOS=1:" day",1:" days"),!
"RTN","DVBADSNT",28,0)
 W ?11,"Bed Service:",?26,BEDSEC,! S DA=DFN D ELIG^DVBAVDPT
"RTN","DVBADSNT",29,0)
FUPD K DA I XDA2]"",$P(^DVB(396,XDA2,0),U,9)="P" S DA=XDA2,DIE="^DVB(396,",DR="4.5////C;4.8////"_DT_";4.9////"_"Notice of Discharge" D ^DIE K DA
"RTN","DVBADSNT",30,0)
 I $D(DVBAD2) I DVBAD2=CFLOC!(CFLOC=376) S DIE="^DVB(396.2,",DA=XDA,DR="3///P;4///"_DT_";5////"_DUZ D ^DIE
"RTN","DVBADSNT",31,0)
 I DVBGUI=0 D
"RTN","DVBADSNT",32,0)
 . I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) QUIT=1 I '$T S DVBAQUIT=1
"RTN","DVBADSNT",33,0)
 S DVBAON2=""
"RTN","DVBADSNT",34,0)
 Q
"RTN","DVBADSNT",35,0)
 ;
"RTN","DVBADSNT",36,0)
PRINT U IO S QUIT=""
"RTN","DVBADSNT",37,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBADSNT",38,0)
 I DVBGUI=1 D END^DVBAB82
"RTN","DVBADSNT",39,0)
 Q
"RTN","DVBADSNT",40,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""  S DFN="" F L=0:0 S DFN=$O(^TMP($J,XCN,CFLOC,ADM,DFN)) Q:DFN=""!(QUIT=1)  S DATA=^(DFN) D PRINTB
"RTN","DVBADSNT",41,0)
 Q
"RTN","DVBADSNT",42,0)
 ;
"RTN","DVBADSNT",43,0)
TERM D HOME^%ZIS K NOASK
"RTN","DVBADSNT",44,0)
 D DUZ2^DVBAUTIL I $D(DVBAQUIT) K DVBAQUIT G KILL
"RTN","DVBADSNT",45,0)
 ;
"RTN","DVBADSNT",46,0)
SETUP W @IOF,!,"NOTICE OF DISCHARGE REPORT" D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBADSNT",47,0)
 S HEAD="NOTICE OF DISCHARGE",HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0)
"RTN","DVBADSNT",48,0)
 W !,HEAD1
"RTN","DVBADSNT",49,0)
EN1 I DVBGUI=0 D 
"RTN","DVBADSNT",50,0)
 . W !!,"This program will print out any new NOTICES OF DISCHARGE,",!,"based on the hospital's discharges.",!!,"Do you want to continue" S %=2 D YN^DICN
"RTN","DVBADSNT",51,0)
 . I $D(%Y) I %Y["?" W !!,"Enter Y to print out the notice, N if you want to exit the program.",! G EN1
"RTN","DVBADSNT",52,0)
 . G:%'=1 KILL S %ZIS="Q" D ^%ZIS K %ZIS I POP G KILL
"RTN","DVBADSNT",53,0)
 I DVBGUI=1 D HFSOPEN^DVBAB82("DVBRP",DVBHFS,"W") I DVBERR D END^DVBAB82 Q
"RTN","DVBADSNT",54,0)
 ;
"RTN","DVBADSNT",55,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBADSNT",ZTIO=ION,NOASK=1,ZTDESC="AMIE NOTICE OF DISCHARGE REPORT" F I="FDT(0)","HEAD","HEAD1","NOASK","DVBAD2" S ZTSAVE(I)=""
"RTN","DVBADSNT",56,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",!! K ZTSK G KILL
"RTN","DVBADSNT",57,0)
 ;
"RTN","DVBADSNT",58,0)
GO F XDA=0:0 S XDA=$O(^DVB(396.2,"C",DVBAD2,"R",XDA)) Q:XDA=""  I $D(^DVB(396.2,XDA,0)) S MB=^(0),DFN=$P(MB,U),ADMDT=$P(MB,U,2),MB=$P(MB,U,3) D CHK,SET I '$D(NOASK) W "."
"RTN","DVBADSNT",59,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found.",!! H 2 G KILL
"RTN","DVBADSNT",60,0)
 D PRINT
"RTN","DVBADSNT",61,0)
KILL D:$D(ZTQUEUED) KILL^%ZTLOAD K DVBAON2 G KILL^DVBAUTIL
"RTN","DVBADSNT",62,0)
 ;
"RTN","DVBADSNT",63,0)
DEQUE K ^TMP($J) G GO
"RTN","DVBADSNT",64,0)
 ;
"RTN","DVBADSNT",65,0)
CHK ;pull 7131 pointer
"RTN","DVBADSNT",66,0)
 F XDA2=0:0 S XDA2=$O(^DVB(396,"G",ADMDT,XDA2)) Q:XDA2=""  I $D(^DVB(396,XDA2,2))&($D(^DVB(396,XDA2,0))) Q:($P(^DVB(396,XDA2,0),U,1)=DFN&($P(^DVB(396,XDA2,2),"^",10)="A"))
"RTN","DVBADSNT",67,0)
 Q
"RTN","DVBADSNT",68,0)
 ;
"RTN","DVBADSNT",69,0)
REPRINT D CHK,SET,PRINT G KILL
"RTN","DVBASRP1")
0^71^B4301115
"RTN","DVBASRP1",1,0)
DVBASRP1 ;GT- CAPRI SURGERY CASE LOOKUP ; 5/13/2002
"RTN","DVBASRP1",2,0)
 ;;2.7;AMIE;**42**;Apr 10, 1995
"RTN","DVBASRP1",3,0)
STATUS ; print case status
"RTN","DVBASRP1",4,0)
 I $P($G(^SRF(VAR,30)),"^")'="" D CAN Q
"RTN","DVBASRP1",5,0)
 I $P($G(^SRF(VAR,31)),"^",8)'="" D CAN Q
"RTN","DVBASRP1",6,0)
 I $P($G(^SRF(VAR,.2)),"^",12) S DVBSROP=DVBSROP_"^"_"(COMPLETED)" Q
"RTN","DVBASRP1",7,0)
 I $D(^SRF(VAR,.2)),$P(^(.2),"^",12)="" S DVBSTAT=0 D SCH I DVBSTATS=0 D REQ Q:DVBSTATS  G NO
"RTN","DVBASRP1",8,0)
 I '$D(^SRF(VAR,.2)) S DVBSTAT=0 D SCH I DVBSTATS=0 D REQ Q:DVBSTATS=1  G NO
"RTN","DVBASRP1",9,0)
 Q
"RTN","DVBASRP1",10,0)
NO ; not requested or scheduled
"RTN","DVBASRP1",11,0)
 S DVBSROP=DVBSROP_"^"_"(NOT COMPLETE)"
"RTN","DVBASRP1",12,0)
 Q
"RTN","DVBASRP1",13,0)
CAN ; cancelled or aborted
"RTN","DVBASRP1",14,0)
 S SR(.2)=$G(^SRF(VAR,.2)) I $P(SR(.2),"^")!($P(SR(.2),"^",10)) S DVBSROP=DVBSROP_"^"_"(ABORTED)" Q
"RTN","DVBASRP1",15,0)
 S DVBSROP=DVBSROP_"^"_"(CANCELLED)"
"RTN","DVBASRP1",16,0)
 Q
"RTN","DVBASRP1",17,0)
SCH ; check to see if case is scheduled
"RTN","DVBASRP1",18,0)
 I '$D(^SRF(VAR,31)) S DVBSTATS=0 Q
"RTN","DVBASRP1",19,0)
 I $P($G(^SRF(VAR,31)),"^",4)="" S DVBSTATS=0 Q
"RTN","DVBASRP1",20,0)
 I $P($G(^SRF(VAR,31)),"^",4) D:DVBSTAT=0 TIM0 D:DVBSTAT=1 TIM1 S DVBSTATS=1 Q
"RTN","DVBASRP1",21,0)
 Q
"RTN","DVBASRP1",22,0)
TIM0 I '$D(^SRF(VAR,.2)) S DVBSROP=DVBSROP_"^"_"(SCHEDULED)" Q
"RTN","DVBASRP1",23,0)
 I $P(^SRF(VAR,.2),"^",2) S DVBSROP=DVBSROP_"^"_"(NOT COMPLETE)" Q
"RTN","DVBASRP1",24,0)
 I $P(^SRF(VAR,.2),"^",2)="" S DVBSROP=DVBSROP_"^"_"(SCHEDULED)"
"RTN","DVBASRP1",25,0)
 Q
"RTN","DVBASRP1",26,0)
TIM1 S DVBSROP=DVBSROP_"^"_"(SCHEDULED)" Q
"RTN","DVBASRP1",27,0)
REQ ; check to see if case has been requested
"RTN","DVBASRP1",28,0)
 I $D(^SRF(VAR,"REQ")),$P(^("REQ"),"^")=1,'$D(^SRF(VAR,.2)) S DVBSROP=DVBSROP_"^"_" (REQUESTED)" S DVBSTATS=1 Q
"RTN","DVBASRP1",29,0)
 I $D(^SRF(VAR,"REQ")),$P(^("REQ"),"^")=1,$D(^SRF(VAR,.2)),$P(^(.2),"^",2)="" S DVBSROP=DVBSROP_"^"_"(REQUESTED)" S DVBSTATS=1
"RTN","DVBASRP1",30,0)
 Q
"RTN","DVBASRP1",31,0)
ABORT ; aborted case
"RTN","DVBASRP1",32,0)
 S DVBABORT=0 I $D(^SRF(VAR,.2)),$P(^(.2),"^",10)'="" S DVBABORT=1
"RTN","DVBASRP1",33,0)
 Q
"RTN","DVBCBUL1")
0^75^B7938885
"RTN","DVBCBUL1",1,0)
DVBCBUL1 ;ALB/GTS-557/THM-SEND EXAM ADD MESSAGE ; 2/7/91  6:56 AM
"RTN","DVBCBUL1",2,0)
 ;;2.7;AMIE;**42**;Apr 10, 1995
"RTN","DVBCBUL1",3,0)
 K ^TMP("DVBC","BUL1",$J),^TMP("DVBC","CMNT",$J) S DIC="^TMP(""DVBC"",""CMNT"",$J,99,",DWPK=1 W @IOF,!!,"Comments:",!! D EN^DIWE
"RTN","DVBCBUL1",4,0)
 K DWPK I $O(^TMP("DVBC","CMNT",$J,99,0))]"" S ^TMP("DVBC","BUL1",$J,98,0)=" ",^TMP("DVBC","BUL1",$J,97,0)="==========================<  Additional comments  >=========================="
"RTN","DVBCBUL1",5,0)
 F I=0:0 S I=$O(^TMP("DVBC","CMNT",$J,99,I)) Q:I=""  S ^TMP("DVBC","BUL1",$J,(I+99),0)=^TMP("DVBC","CMNT",$J,99,I,0)
"RTN","DVBCBUL1",6,0)
 K ^TMP("DVBC","CMNT",$J) S $P(DOTS,".",45)="."
"RTN","DVBCBUL1",7,0)
 ;
"RTN","DVBCBUL1",8,0)
GO S L=1,^TMP("DVBC","BUL1",$J,L,0)="The following veteran had one or more 2507 exams added:",L=L+1
"RTN","DVBCBUL1",9,0)
 S ^TMP("DVBC","BUL1",$J,L,0)="   ",L=L+1
"RTN","DVBCBUL1",10,0)
 S ^TMP("DVBC","BUL1",$J,L,0)="   Name: "_PNAM_"   SSN: "_"XXXXX"_$E(SSN,6,9)_"   "_"C-Number: "_CNUM,L=L+1
"RTN","DVBCBUL1",11,0)
 S ^TMP("DVBC","BUL1",$J,L,0)=" "
"RTN","DVBCBUL1",12,0)
 S Y=$P(^DVB(396.3,REQDA,0),U,2) X ^DD("DD") S ^TMP("DVBC","BUL1",$J,L,0)="     Request date: "_Y,L=L+1
"RTN","DVBCBUL1",13,0)
 S ^TMP("DVBC","BUL1",$J,L,0)="  ",L=L+1
"RTN","DVBCBUL1",14,0)
 S ^TMP("DVBC","BUL1",$J,L,0)="Note:  Scheduling for this request must now be recompleted.",L=L+1,^TMP("DVBC","BUL1",$J,L,0)="       A new request copy will be printed tomorrow morning.",L=L+1
"RTN","DVBCBUL1",15,0)
 S ^TMP("DVBC","BUL1",$J,L,0)=" ",L=L+1
"RTN","DVBCBUL1",16,0)
 ;
"RTN","DVBCBUL1",17,0)
SEND S $P(^DVB(396.3,REQDA,0),U,6)="" ;reset date sched completed
"RTN","DVBCBUL1",18,0)
 S MG=$O(^XMB(3.8,"B","DVBA C EXAM ADDED",0)) I MG="" W !!,*7,"Bulletin not sent.",!,"DVBA C EXAM ADDED mail group not found.",!! H 3 Q
"RTN","DVBCBUL1",19,0)
 F JI=0:0 S JI=$O(^XMB(3.8,MG,1,"B",JI)) Q:JI=""  S XMY(JI)=""
"RTN","DVBCBUL1",20,0)
 S XMY(DUZ)="",XMSUB="Addition of 2507 Exams",XMTEXT="^TMP(""DVBC"",""BUL1"",$J,",XMDUZ=DUZ
"RTN","DVBCBUL1",21,0)
 I '$D(^VA(200,DUZ,.15)) S XMY(XMDUZ)="" G XMD
"RTN","DVBCBUL1",22,0)
 I $D(^VA(200,DUZ,.15))&($P(^VA(200,DUZ,.15),"^",1)="") S XMY(XMDUZ)="" G XMD
"RTN","DVBCBUL1",23,0)
 I $D(^VA(200,DUZ,.15)) S XMY($P(^VA(200,DUZ,.15),"^",1))=""
"RTN","DVBCBUL1",24,0)
XMD D ^XMD K ^TMP("DVBC","BUL1",$J),XMDUZ,DOTS,L,JI,JY,XMY,XMSUB,XMTEXT
"RTN","DVBCBUL1",25,0)
 Q
"RTN","DVBCBULL")
0^73^B15506228
"RTN","DVBCBULL",1,0)
DVBCBULL ;ALB/GTS-557/THM-SEND CANCELLATION BULLETIN ; 6/25/91  11:01 AM
"RTN","DVBCBULL",2,0)
 ;;2.7;AMIE;**42**;Apr 10, 1995
"RTN","DVBCBULL",3,0)
 ;
"RTN","DVBCBULL",4,0)
 K ^TMP("DVBC","BULL",$J),^TMP("DVBC","CMNT",$J) S DIC="^TMP(""DVBC"",""CMNT"",$J,99,",DWPK=1 W @IOF,!!,"Cancellation comments:",!! D EN^DIWE
"RTN","DVBCBULL",5,0)
 K DWPK I $O(^TMP("DVBC","CMNT",$J,99,0))]"" S ^TMP("DVBC","BULL",$J,98,0)=" ",^TMP("DVBC","BULL",$J,97,0)="==========================<  Additional comments  >=========================="
"RTN","DVBCBULL",6,0)
 F I=0:0 S I=$O(^TMP("DVBC","CMNT",$J,99,I)) Q:I=""  S ^TMP("DVBC","BULL",$J,(I+99),0)=^TMP("DVBC","CMNT",$J,99,I,0)
"RTN","DVBCBULL",7,0)
 K ^TMP("DVBC","CMNT",$J) S $P(DOTS,".",45)="." W !!,"A bulletin will now be sent to the 2507 Cancellation mail group.",!
"RTN","DVBCBULL",8,0)
 ;
"RTN","DVBCBULL",9,0)
GO S L=1,^TMP("DVBC","BULL",$J,L,0)="The following veteran had one or more 2507 exams cancelled:",L=L+1
"RTN","DVBCBULL",10,0)
 S ^TMP("DVBC","BULL",$J,L,0)="   ",L=L+1
"RTN","DVBCBULL",11,0)
 S ^TMP("DVBC","BULL",$J,L,0)="   Name: "_PNAM_"   SSN: "_"XXXXX"_$E(SSN,6,9)_"   "_"C-Number: "_CNUM,L=L+1
"RTN","DVBCBULL",12,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCBULL",13,0)
 S ^TMP("DVBC","BULL",$J,L,0)="Exams cancelled                               Reason",L=L+1
"RTN","DVBCBULL",14,0)
 S ^TMP("DVBC","BULL",$J,L,0)="  ",L=L+1
"RTN","DVBCBULL",15,0)
 S EXAM="",RSTAT=$P(^DVB(396.3,REQDA,0),U,18)
"RTN","DVBCBULL",16,0)
 F JI=0:0 S EXAM=$O(CANC(EXAM)) Q:EXAM=""  I $P(CANC(EXAM),U,1)="X"!($P(CANC(EXAM),U,1)="RX") S REAS=+$P(CANC(EXAM),U,2) D EXAMS
"RTN","DVBCBULL",17,0)
 S ^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1,COMP=1,CMPC=0
"RTN","DVBCBULL",18,0)
 S ^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1 K ^TMP("DVBC","CMNT",$J)
"RTN","DVBCBULL",19,0)
 I RSTAT["X" S ^TMP("DVBC","BULL",$J,L,0)=" *** All exams on this request are now CANCELLED. ***",L=L+1,^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1 G SEND
"RTN","DVBCBULL",20,0)
 S ECNT=0
"RTN","DVBCBULL",21,0)
 F JZ=0:0 S JZ=$O(^DVB(396.4,"C",REQDA,JZ)) Q:JZ=""  S STAT=$P(^DVB(396.4,JZ,0),U,4) S:STAT="C" CMPC=1 I STAT'="C"&(STAT'["X") S COMP=0,ECNT=ECNT+1
"RTN","DVBCBULL",22,0)
 ;CMPC=completed exam COMP=open exam
"RTN","DVBCBULL",23,0)
 ;both are toggled, depending on exam status.  Both must be 1 to put release banner on message
"RTN","DVBCBULL",24,0)
 I RSTAT'["X",COMP=0 S ^TMP("DVBC","BULL",$J,L,0)=" *** There "_$S(ECNT=1:"is",1:"are")_" still "_ECNT_" exam"_$S(ECNT=1:"",1:"s")_" open on this request. ***",L=L+1,^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1 G SEND
"RTN","DVBCBULL",25,0)
 I COMP=1&(CMPC=1),RSTAT'["X" S ^TMP("DVBC","BULL",$J,L,0)=" *** This request is now COMPLETE and should be released by MAS ***",L=L+1
"RTN","DVBCBULL",26,0)
 I COMP=1&(CMPC=1),RSTAT'["X" S ^TMP("DVBC","BULL",$J,L,0)=" ",L=L+1 ;spacer
"RTN","DVBCBULL",27,0)
 ;
"RTN","DVBCBULL",28,0)
SEND ;remote sites get bulletins only on total cancellations
"RTN","DVBCBULL",29,0)
 S DIC="^XMB(3.8,",DIC(0)="QM",X="DVBA C 2507 CANCELLATION" D ^DIC S MG=+Y I +Y<0 W !!,*7,"2507 mail group NOT found!  Bulletin not sent.",!! H 3 Q
"RTN","DVBCBULL",30,0)
 F JI=0:0 S JI=$O(^XMB(3.8,MG,1,"B",JI)) Q:JI=""  S XMY(JI)=""
"RTN","DVBCBULL",31,0)
 F JI=0:0 S JI=$O(XMY(JI)) Q:JI=""!(+JI=0)  I '$D(^VA(200,JI,2,+REQRO))&'$D(^VA(200,JI,2,+REQRO))&('$D(^XUSEC("DVBA C SUPERVISOR",JI))) K XMY(JI)
"RTN","DVBCBULL",32,0)
 S:REQSTR="" REQSTR=.5 S XMY(REQSTR)="",XMY(DUZ)="",XMSUB="Cancellation of 2507 Exams",XMTEXT="^TMP(""DVBC"",""BULL"",$J,",XMDUZ=DUZ
"RTN","DVBCBULL",33,0)
 I '$D(^VA(200,DUZ,.15)) S XMY(XMDUZ)="" G XMD
"RTN","DVBCBULL",34,0)
 I $D(^VA(200,DUZ,.15))&($P(^VA(200,DUZ,.15),"^",1)="") S XMY(XMDUZ)="" G XMD
"RTN","DVBCBULL",35,0)
 I $D(^VA(200,DUZ,.15)) S XMY($P(^VA(200,DUZ,.15),"^",1))=""
"RTN","DVBCBULL",36,0)
XMD D ^XMD
"RTN","DVBCBULL",37,0)
 K ^TMP("DVBC","BULL",$J),XMDUZ,DOTS,COMP,CMPC,XEXAM,REASON,L,JI,JY,XMY,XMSUB,XMTEXT,XMDUZ,ECNT
"RTN","DVBCBULL",38,0)
 Q
"RTN","DVBCBULL",39,0)
 ;
"RTN","DVBCBULL",40,0)
EXAMS S REASON=$S($D(^DVB(396.5,+REAS,0)):$P(^(0),U,1),1:"Undetermined")
"RTN","DVBCBULL",41,0)
 S XEXAM=$E(EXAM,1,25),^TMP("DVBC","BULL",$J,L,0)="     "_XEXAM_" "_$E(DOTS,1,35-$L(XEXAM))_" "_REASON S L=L+1
"RTN","DVBCBULL",42,0)
 Q
"RTN","DVBCLABR")
0^62^B7416408
"RTN","DVBCLABR",1,0)
DVBCLABR ;ALB/GTS-557/THM-PRINT C&P LAB TEST RESULTS ; 9/6/91  1:40 PM
"RTN","DVBCLABR",2,0)
 ;;2.7;AMIE;**11,42**;Apr 10, 1995
"RTN","DVBCLABR",3,0)
 ;
"RTN","DVBCLABR",4,0)
LAB N XX S XX=1
"RTN","DVBCLABR",5,0)
 F  Q:'$D(DVBCRALC(XX))  D
"RTN","DVBCLABR",6,0)
 .S DVBCRALC=DVBCRALC(XX)
"RTN","DVBCLABR",7,0)
 .S XX=XX+1 D LAB1
"RTN","DVBCLABR",8,0)
 Q
"RTN","DVBCLABR",9,0)
LAB1 ;print lab
"RTN","DVBCLABR",10,0)
 S STAT=$P(^DVB(396.3,DA(1),0),U,18) Q:STAT["X"  I '$D(DVBCRALC) D SETLAB^DVBCPRNT ; ** Set variable DVBCRALC
"RTN","DVBCLABR",11,0)
 S LRDFN=$S($D(^DPT(DFN,"LR")):+^("LR"),1:0),DTREL=$P(^DVB(396.3,DA(1),0),U,14) Q:DTREL=""
"RTN","DVBCLABR",12,0)
 ; ** 'CH' X-ref is for Chemistry tests, 'MI' X-ref is for Micro tests.
"RTN","DVBCLABR",13,0)
 D RSET S DVBCW=1 F DVBCI=0:0 S LRIDT=$O(^LR(LRDFN,"CH",LRIDT)) Q:LRIDT=""!(LRIDT>LREDT)  D LK
"RTN","DVBCLABR",14,0)
 D RSET S DVBCW=2 F DVBCI=0:0 S LRIDT=$O(^LR(LRDFN,"MI",LRIDT)) Q:LRIDT=""!(LRIDT>LREDT)  D LK
"RTN","DVBCLABR",15,0)
 ;
"RTN","DVBCLABR",16,0)
RAD ;print radiology
"RTN","DVBCLABR",17,0)
 Q:'$D(^RADPT(0))  ;quit if not running radiology package
"RTN","DVBCLABR",18,0)
 S RABDT=DVBCBDT,RAEDT=DTREL,RAHLOC=DVBCRALC D ^RAUTL3
"RTN","DVBCLABR",19,0)
 K DVBCW,RABDT,RAEDT,RAHLOC
"RTN","DVBCLABR",20,0)
 Q
"RTN","DVBCLABR",21,0)
 ;
"RTN","DVBCLABR",22,0)
REN I '$D(FF) D HOME^%ZIS S FF=IOF
"RTN","DVBCLABR",23,0)
 ;
"RTN","DVBCLABR",24,0)
REN1 W @FF,!,"Reprint Lab/X-Ray Results for C&P Exams",!!!
"RTN","DVBCLABR",25,0)
 S DIC="^DVB(396.3,",DIC(0)="AEQM" D ^DIC I X=""!(X=U) G KILL^DVBCUTIL
"RTN","DVBCLABR",26,0)
 I +Y>0 S DA(1)=+Y,DFN=$P(Y,U,2)
"RTN","DVBCLABR",27,0)
 W !! S %ZIS="AEQ",%ZIS("A")="Output device: " D ^%ZIS K %ZIS G:POP KILL^DVBCUTIL
"RTN","DVBCLABR",28,0)
 I $D(IO("Q")) S ZTRTN="REN2^DVBCLABR",ZTIO=ION,ZTDESC="C&P lab/radiology print" F I="DIC*","DA*","DFN" S ZTSAVE(I)=""
"RTN","DVBCLABR",29,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! H 2 G KILL^DVBCUTIL
"RTN","DVBCLABR",30,0)
REN2 U IO D SETLAB^DVBCPRNT,LAB S LKILL=1
"RTN","DVBCLABR",31,0)
 Q:$G(DVBGUI)  D:$D(ZTQUEUED) KILL^%ZTLOAD
"RTN","DVBCLABR",32,0)
 G KILL^DVBCUTIL
"RTN","DVBCLABR",33,0)
 ;
"RTN","DVBCLABR",34,0)
RSET D:'$D(LRPARAM) DT^LRX,EN^LRPARAM S (LREND,LRSTOP)=0,LRCW=8,LRHF=1,LRFOOT=0,(LRONESPC,LRONETST)=""
"RTN","DVBCLABR",35,0)
 S LRLAB=1,X1=DTREL,X2=-120 D C^%DTC S (DVBCBDT,LREDT)=X,LRSDT=DTREL,LRIDT=9999999-LRSDT,LREDT=9999999-LREDT D PT^LRX
"RTN","DVBCLABR",36,0)
 Q
"RTN","DVBCLABR",37,0)
 ;
"RTN","DVBCLABR",38,0)
LK I DVBCW=1 S DVBCRLOC=$P(^LR(LRDFN,"CH",LRIDT,0),U,11)
"RTN","DVBCLABR",39,0)
 I DVBCW=2 S DVBCRLOC=$P(^LR(LRDFN,"MI",LRIDT,0),U,8)
"RTN","DVBCLABR",40,0)
 Q:DVBCRLOC=""  ; * Quit if DVBCRLOC is NULL.
"RTN","DVBCLABR",41,0)
 ;
"RTN","DVBCLABR",42,0)
 ; ** NOTE: DVBCRALC=^Pointer to file 44^Pointer to file 44^
"RTN","DVBCLABR",43,0)
 ; ** NOTE: DVBCRALC pointers come from file 396.1 C&P ROUTING LOCATION
"RTN","DVBCLABR",44,0)
 ; ** DVBCRLOC is the REQUESTING LOCATION in the Lab Data File multiple
"RTN","DVBCLABR",45,0)
 F ZJ=0:0 S ZJ=$O(^SC("C",DVBCRLOC,ZJ)) Q:ZJ=""  S DVBCXLOC=U_ZJ_U I DVBCRALC[DVBCXLOC D:DVBCW=1 CH^LRRP2 D:DVBCW=2 MI^LRRP2 Q
"RTN","DVBCLABR",46,0)
 K DVBCXLOC
"RTN","DVBCPATA")
0^77^B9845601
"RTN","DVBCPATA",1,0)
DVBCPATA ;ALB/JLU,557/THM-ADD NEW VET TO FILE #2 ; 10/4/91  9:22 AM
"RTN","DVBCPATA",2,0)
 ;;2.7;AMIE;**1,23,40,42**;Apr 10, 1995
"RTN","DVBCPATA",3,0)
 ;
"RTN","DVBCPATA",4,0)
EN ;determine if new patient
"RTN","DVBCPATA",5,0)
 S OLDHD1=HD1,HD1="Additional Veteran Information"
"RTN","DVBCPATA",6,0)
 K DVBCNEW,OUT,EDIT
"RTN","DVBCPATA",7,0)
 S DIC="^DPT(",DIC(0)="AELMQ",DLAYGO=2
"RTN","DVBCPATA",8,0)
 D ^DIC
"RTN","DVBCPATA",9,0)
 K DLAYGO
"RTN","DVBCPATA",10,0)
 I Y<0 S OUT=1 D EXIT1 Q
"RTN","DVBCPATA",11,0)
 S DVBADA=+Y
"RTN","DVBCPATA",12,0)
 I $P(Y,U,3) S DVBCNEW=1 D MPI(,DVBADA)
"RTN","DVBCPATA",13,0)
 S DA=DVBADA
"RTN","DVBCPATA",14,0)
 ;
"RTN","DVBCPATA",15,0)
ADDR I '$D(DVBCNEW) S DTA=^DPT(DA,0),PNAM=$P(DTA,U,1),SSN=$P(DTA,U,9),DFN=DA,CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown") S:CNUM="" CNUM="Unknown"
"RTN","DVBCPATA",16,0)
 ;
"RTN","DVBCPATA",17,0)
ASK K %Y I '$D(DVBCNEW) D ADDR^DVBCUTIL W !,"Is this the correct Veteran" S %=2 D YN^DICN I $D(DTOUT)!(%<0) S OUT=1 G EXIT
"RTN","DVBCPATA",18,0)
 I $D(%Y) I %Y["?" W !!,"Enter Y if it is the correct Veteran, N to reselect",! G ASK
"RTN","DVBCPATA",19,0)
 K %Y I '$D(DVBCNEW),$D(%),%'=1 D CLR G EN
"RTN","DVBCPATA",20,0)
 ;
"RTN","DVBCPATA",21,0)
ASKED1 I $D(EDIT) S DIE="^DPT(",DR="W @IOF,!,""Edit Veteran Data"",!!!;.02;.09;.313;.314;.361;.525;.323;1901;.111;.112:.115;.1112;.117;.131;.132;.326;.327" D ^DIE S EDIT=1
"RTN","DVBCPATA",22,0)
 ;
"RTN","DVBCPATA",23,0)
ASKED2 I $D(EDIT) W !!,"Want to edit it again" S %=1 D YN^DICN G:%=1 ASKED1 S:$D(DTOUT)!(%<0) OUT=1 I $D(OUT) G EXIT
"RTN","DVBCPATA",24,0)
 I $D(%Y),%Y["?" W !!,"Enter Y to edit the information again or N to skip.",!! H 3 G ASKED2
"RTN","DVBCPATA",25,0)
 W !! G EXIT1:'$D(DVBCNEW)
"RTN","DVBCPATA",26,0)
 S DIE("NO^")="BACKOUTOK",DIE="^DPT(",DR="[DVBA C ADD 2507 PAT]" D ^DIE K DIE("NO^") S EDIT=1
"RTN","DVBCPATA",27,0)
 I $D(DVBACPLT),DVBACPLT=0 DO
"RTN","DVBCPATA",28,0)
 .;Aborting C&P request due to incomplete Patient required information.
"RTN","DVBCPATA",29,0)
 .N VAR
"RTN","DVBCPATA",30,0)
 .S VAR(1,0)="1,5,0,2,0^...Error, required information missing!...."
"RTN","DVBCPATA",31,0)
 .S VAR(2,0)="0,7,0,1:2,0^...Unable to complete, Request aborted!....."
"RTN","DVBCPATA",32,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBCPATA",33,0)
 .D CONTMES^DVBCUTL4
"RTN","DVBCPATA",34,0)
 .S OUT=""
"RTN","DVBCPATA",35,0)
 .K VAR
"RTN","DVBCPATA",36,0)
 I $D(DVBACPLT),DVBACPLT=0 D EXIT1 QUIT  ;**QUIT w/out D EXIT
"RTN","DVBCPATA",37,0)
 ;
"RTN","DVBCPATA",38,0)
EXIT S DTA=^DPT(DA,0),PNAM=$P(DTA,U,1),SSN=$P(DTA,U,9),DFN=DA,CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown") S:CNUM="" CNUM="Unknown"
"RTN","DVBCPATA",39,0)
 I $D(DVBCNEW) S XMB="DVBA C NEW C&P VETERAN",XMB(1)=PNAM,XMB(2)=SSN,XMB(3)=$S($D(^VA(200,+DUZ,0)):$P(^(0),U),1:"Unknown user"),Y=DT X ^DD("DD") S XMB(4)=Y D ^XMB
"RTN","DVBCPATA",40,0)
EXIT1 S HD1=OLDHD1 K OLDHD1,DIC,DIE,DR,%,%Y,DTA,X,Y,DVBCNEW,DVBADA,DVBACPLT Q
"RTN","DVBCPATA",41,0)
 ;
"RTN","DVBCPATA",42,0)
CLR W @IOF,!?(IOM-$L(HD1)\2),HD1,!!
"RTN","DVBCPATA",43,0)
 Q
"RTN","DVBCPATA",44,0)
MPI(DVBBKMSG,DFN) ;MPI call to set ICN
"RTN","DVBCPATA",45,0)
 ;check to see if CIRN PD/MPI is installed
"RTN","DVBCPATA",46,0)
 N X S X="MPIFAPI" X ^%ZOSF("TEST") Q:'$T
"RTN","DVBCPATA",47,0)
 K MPIFRTN
"RTN","DVBCPATA",48,0)
 D MPIQ^MPIFAPI(DFN)
"RTN","DVBCPATA",49,0)
 K MPIFRTN
"RTN","DVBCPATA",50,0)
 Q
"RTN","DVBCROPN")
0^74^B27642320
"RTN","DVBCROPN",1,0)
DVBCROPN ;ALB/GTS-557/THM-REOPEN REQUEST/SELECTED EXAMS ; 9/22/91  4:54 PM
"RTN","DVBCROPN",2,0)
 ;;2.7;AMIE;**42**;Apr 10, 1995
"RTN","DVBCROPN",3,0)
 I $D(DUZ)#2=0 W *7,!!,"Your user number (DUZ) is invalid !",!! H 3 G EXIT
"RTN","DVBCROPN",4,0)
 S SUPER=$S($D(^XUSEC("DVBA C SUPERVISOR",DUZ)):1,1:0)
"RTN","DVBCROPN",5,0)
 G EN
"RTN","DVBCROPN",6,0)
 ;
"RTN","DVBCROPN",7,0)
LOOK1 S EXAM=$P(^DVB(396.4,DA,0),U,3)
"RTN","DVBCROPN",8,0)
 S EXAM=$S($D(^DVB(396.6,+EXAM,0)):$P(^(0),U,1),1:"Unknown")
"RTN","DVBCROPN",9,0)
 S STAT=$P(^DVB(396.4,DA,0),U,4),^TMP($J,EXAM)=STAT_U_DA
"RTN","DVBCROPN",10,0)
 Q
"RTN","DVBCROPN",11,0)
 ;
"RTN","DVBCROPN",12,0)
EN D HOME^%ZIS S FF=IOF,HD="2507 Exam Veteran Selection",HD2="Re-open Exams/Requests"
"RTN","DVBCROPN",13,0)
 ;
"RTN","DVBCROPN",14,0)
LOOK D KILL W @FF,!?(IOM-$L(HD)\2),HD,!?(IOM-$L(HD2)\2),HD2,!!
"RTN","DVBCROPN",15,0)
 S DIC("W")="D DICW^DVBCUTIL" S DIC="^DVB(396.3,",DIC(0)="AEQM",DIC("A")="Select VETERAN: " D ^DIC G:X=""!(X=U) EXIT I +Y<0 W *7,"  ???" G LOOK
"RTN","DVBCROPN",16,0)
 S (REQDA,DA(1))=+Y,STAT=$P(^DVB(396.3,DA(1),0),U,18),DFN=$P(Y,U,2)
"RTN","DVBCROPN",17,0)
 I STAT="C"!(STAT["X")!(STAT="R")&(SUPER=0) W !!,*7,"Status prohibits activity except by supervisors.",!! H 3 G EN
"RTN","DVBCROPN",18,0)
 S REQDT=$P(^DVB(396.3,DA(1),0),U,2),DATA=$S($D(^DPT(DFN,0)):^(0),1:"")
"RTN","DVBCROPN",19,0)
 S PNAM=$S($P(DATA,U,1)]"":$P(DATA,U,1),1:"Unknown"),SSN=$P(DATA,U,9),CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Unknown") K DICW
"RTN","DVBCROPN",20,0)
 S RELDAT=$P(^DVB(396.3,DA(1),0),U,13)
"RTN","DVBCROPN",21,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  D LOOK1
"RTN","DVBCROPN",22,0)
 I $P(^DVB(396.3,DA(1),0),U,5)="" DO
"RTN","DVBCROPN",23,0)
 .S TVAR(1,0)="1,0,0,2,0^This 2507 was never reported to MAS, it can NOT be reopened."
"RTN","DVBCROPN",24,0)
 .D WR^DVBAUTL4("TVAR")
"RTN","DVBCROPN",25,0)
 .D CONTMES^DVBCUTL4
"RTN","DVBCROPN",26,0)
 .S NOTRPT=""
"RTN","DVBCROPN",27,0)
 .K TVAR
"RTN","DVBCROPN",28,0)
 G:$D(NOTRPT) LOOK
"RTN","DVBCROPN",29,0)
 S STAT=$P(^DVB(396.3,DA(1),0),U,18) D STATCHK G:$D(NCN) LOOK
"RTN","DVBCROPN",30,0)
 ;
"RTN","DVBCROPN",31,0)
ROPN W !!,"Do you want to reopen the ENTIRE request" S %=2 D YN^DICN G:$D(DTOUT)!(%<0) EXIT G:%=1 ALL
"RTN","DVBCROPN",32,0)
 I $D(%Y),%Y["?" W !,"Enter Y to reopen the ENTIRE request or N to reopen only selected exams.",!! H 1 G ROPN
"RTN","DVBCROPN",33,0)
DATA D HDR^DVBCUTIL K NOFND
"RTN","DVBCROPN",34,0)
 W !!
"RTN","DVBCROPN",35,0)
 S Y=$$EXSRH^DVBCUTL4("Select EXAM TO REOPEN: ","I $D(^DVB(396.4,""ARQ""_REQDA,+Y))") ;*Exam lookup function call
"RTN","DVBCROPN",36,0)
 G:$D(DTOUT) EXIT G:X=""!(X=U) UPDATE I +Y<0 W *7,"  ???" G DATA
"RTN","DVBCROPN",37,0)
 S EXY=+Y,EXMNM=$S($D(^DVB(396.6,+$P(^DVB(396.4,EXY,0),U,3),0)):$P(^(0),U,1),1:"")
"RTN","DVBCROPN",38,0)
 I EXMNM="" W *7,!!,"Exam name not found in file 396.6 !",!! H 2 G EXIT
"RTN","DVBCROPN",39,0)
 S STAT=$P(^TMP($J,EXMNM),U,1) I STAT="O" W *7,!!,"Already open!",!! H 2 G DATA
"RTN","DVBCROPN",40,0)
 D STATCHK G:$D(NCN) DATA
"RTN","DVBCROPN",41,0)
 S DA=EXY,DIE="^DVB(396.4,"
"RTN","DVBCROPN",42,0)
 S DR=".04////O;52///@;51///@;50///@"
"RTN","DVBCROPN",43,0)
 D ^DIE I '$D(Y) W " .. reopened" H 1
"RTN","DVBCROPN",44,0)
 I $D(Y) W *7,"   reopen error !" H 2 G EXIT
"RTN","DVBCROPN",45,0)
 S STAT=$P(^DVB(396.4,EXY,0),U,4),$P(^TMP($J,EXMNM),U,1)=STAT S EDIT=1
"RTN","DVBCROPN",46,0)
 G DATA
"RTN","DVBCROPN",47,0)
UPDATE I $D(EDIT) W @FF D STATUS1^DVBCROP1,BULL
"RTN","DVBCROPN",48,0)
 G LOOK
"RTN","DVBCROPN",49,0)
 ;
"RTN","DVBCROPN",50,0)
EXIT G KILL^DVBCUTIL
"RTN","DVBCROPN",51,0)
 ;
"RTN","DVBCROPN",52,0)
KILL K DIC,DA,ALLROPN,EXAM,REQDA,D0,D1,DFN,X,Y,EXY,OLDEXAM,DR,REQDT,DR,EXMNM,NCN,STAT,%,NOFND,^TMP($J),EDIT,NOTRPT,RELDAT,DATA
"RTN","DVBCROPN",53,0)
 Q
"RTN","DVBCROPN",54,0)
HDR D HDR^DVBCUTIL
"RTN","DVBCROPN",55,0)
 Q
"RTN","DVBCROPN",56,0)
STATCHK S I="",NCN=1 F J=0:0 S I=$O(^TMP($J,I)) Q:I=""  I $P(^TMP($J,I),U,1)["X"!($P(^(I),U,1)="C") K NCN Q
"RTN","DVBCROPN",57,0)
 I $D(NCN) W !!,*7,"There are no cancelled or completed exams remaining on this request.",!! H 3
"RTN","DVBCROPN",58,0)
 Q
"RTN","DVBCROPN",59,0)
ALL W !! D STATCHK G:$D(NCN) LOOK W ! S ALLROPN=1,EXMNM="" F JJY=0:0 S EXMNM=$O(^TMP($J,EXMNM)) Q:EXMNM=""  S STAT=$P(^TMP($J,EXMNM),U,1) I STAT["X"!(STAT="C") S X=EXMNM D ALL1
"RTN","DVBCROPN",60,0)
 H 2 W @FF D STATUS1^DVBCROP1,NOTIFY G EN
"RTN","DVBCROPN",61,0)
ALL1 K DR S DIC(0)="QM",DR=".04////O;52///@;51///@;50///@"
"RTN","DVBCROPN",62,0)
 S (DIC,DIE)="^DVB(396.4,",DA=$P(^TMP($J,EXMNM),U,2)
"RTN","DVBCROPN",63,0)
 D ^DIE I '$D(Y) W:$X>50 ! W:$L(EXMNM)>25&($X>45) ! W EXMNM," reopened, "
"RTN","DVBCROPN",64,0)
 I $D(Y) W *7,!,"Reopen error on ",EXMNM," exam !",! H 2
"RTN","DVBCROPN",65,0)
 Q
"RTN","DVBCROPN",66,0)
NOTIFY S X=$P(^DVB(396.3,DA(1),0),U,18) I X'["X"&(X'="")&(X'="C") W !!,"Entire exam is now REOPENED.",!! H 1
"RTN","DVBCROPN",67,0)
 I X["X"!(X="")!(X="C") W *7,!!,"Reopen error !",!! H 3 S OUT=1 K X Q
"RTN","DVBCROPN",68,0)
 D BULL K X Q
"RTN","DVBCROPN",69,0)
BULL W !!,"Sending a bulletin to the 2507 REOPENED mail group ...",!!
"RTN","DVBCROPN",70,0)
 H 1 S Y=REQDT X ^DD("DD") S XREQDT=Y,XMDUZ=DUZ
"RTN","DVBCROPN",71,0)
 I RELDAT'="" S Y=RELDAT X ^DD("DD") S XRELDAT=Y
"RTN","DVBCROPN",72,0)
 S XMB="DVBA C 2507 EXAM REOPENED",XMB(1)=PNAM,XMB(2)="XXXXX"_$E(SSN,6,9),XMB(3)=XREQDT,XMB(4)=$P(^VA(200,DUZ,0),U,1),XMB(5)=$S(RELDAT'="":XRELDAT,1:"This request has not been released.")
"RTN","DVBCROPN",73,0)
 S XMB(6)=$S(RELDAT="":"     This reopen will not affect the AMIE AMIS 290.",1:"     **THIS REOPEN WILL AFFECT THE AMIE AMIS 290**")
"RTN","DVBCROPN",74,0)
 S XMB(7)=$S(RELDAT'="":"/Affects AMIE AMIS 290",1:"")
"RTN","DVBCROPN",75,0)
 I $D(ALLROPN) S OWNDOM=$P(^DVB(396.3,DA(1),0),U,22) I OWNDOM]"" S XDOM=$S($D(^DIC(4.2,OWNDOM,0)):^(0),1:"") S DOMAIN=$P(XDOM,U,1),DOMNUM=+$P(XDOM,U,3)
"RTN","DVBCROPN",76,0)
 I $D(ALLROPN),OWNDOM]"" I +DOMNUM>0 S XMY("G.DVBA C 2507 EXAM REOPENED@"_DOMAIN)=DOMNUM W !!,*7,"I am sending updated information to "_DOMAIN,!,"since this was transferred in.",!! H 2
"RTN","DVBCROPN",77,0)
 I '$D(^VA(200,DUZ,.15)) S XMY(XMDUZ)="" G XMB
"RTN","DVBCROPN",78,0)
 I $D(^VA(200,DUZ,.15))&($P(^VA(200,DUZ,.15),"^",1)="") S XMY(XMDUZ)="" G XMB
"RTN","DVBCROPN",79,0)
 I $D(^VA(200,DUZ,.15)) S XMY($P(^VA(200,DUZ,.15),"^",1))=""
"RTN","DVBCROPN",80,0)
XMB D ^XMB K XMDUZ
"RTN","DVBCROPN",81,0)
 I $D(ALLROPN),OWNDOM]"",+DOMNUM>0 S REQDA=DA(1) D EN1^DVBCXFRE
"RTN","DVBCROPN",82,0)
 K ALLROPN,CANC,SEND,OWNDOM,DOMNUM,XMB,XREQDT,XDOM,DOMAIN,RELDAT,XRELDAT
"RTN","DVBCROPN",83,0)
 Q
"RTN","DVBCRPRT")
0^72^B14221604
"RTN","DVBCRPRT",1,0)
DVBCRPRT ;ALB/GTS-557/THM-REPRINT C&P REPORT ; 5/17/91  10:28 AM
"RTN","DVBCRPRT",2,0)
 ;;2.7;AMIE;**31,42**;Apr 10, 1995
"RTN","DVBCRPRT",3,0)
 ;
"RTN","DVBCRPRT",4,0)
 ; ** DVBCRPRT is called from DVBCRPON only **
"RTN","DVBCRPRT",5,0)
PHYS S PHYS=$S($D(^DVB(396.4,DA,0)):$P(^(0),U,7),1:"")
"RTN","DVBCRPRT",6,0)
 Q
"RTN","DVBCRPRT",7,0)
STEP2A ;  ** Called from STEP2 only **
"RTN","DVBCRPRT",8,0)
 S EXMNM=$S($D(^DVB(396.6,$P(^DVB(396.4,DA,0),U,3),0)):$P(^(0),U,1),1:"Unknown exam"),EXHD="For "_EXMNM_" Exam" D HDR^DVBCRPR1
"RTN","DVBCRPRT",9,0)
 W "Examining provider: ",PHYS,!,"Examined on: " S Y=$P(^DVB(396.4,DA,0),U,6) X XDD W Y,! F LINE=1:1:80 W "="
"RTN","DVBCRPRT",10,0)
 W !!?2,"Examination results:",!! S EXSTAT=$P(^DVB(396.4,DA,0),U,4) I EXSTAT="X"!(EXSTAT="RX") W !!!!!?25,"This exam was CANCELLED by ",$S(EXSTAT="RX":"the RO.",1:"MAS."),!! Q
"RTN","DVBCRPRT",11,0)
 D STEP3
"RTN","DVBCRPRT",12,0)
 Q
"RTN","DVBCRPRT",13,0)
STEP2 ; ** An external entry point and called from GO2 **
"RTN","DVBCRPRT",14,0)
 F DA=0:0 S DA=$O(^DVB(396.4,"C",DA(1),DA)) Q:DA=""  D GETRO Q:RO'=DUZ(2)&('$D(^XUSEC("DVBA C SUPERVISOR",DUZ)))  S PG=0 D PHYS,STEP2A I $D(PRINT) D BOT^DVBCRPR1 K PRINT
"RTN","DVBCRPRT",15,0)
 D ^DVBCLABR Q
"RTN","DVBCRPRT",16,0)
 K DVBAON2
"RTN","DVBCRPRT",17,0)
 Q
"RTN","DVBCRPRT",18,0)
STEP3 ;  ** Called from STEP2A only **
"RTN","DVBCRPRT",19,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=80,DIWF="NW" S OLDA=DA,OLDA1=DA(1)
"RTN","DVBCRPRT",20,0)
 F LINE=0:0 S LINE=$O(^DVB(396.4,OLDA,"RES",LINE)) Q:LINE=""  S X=^DVB(396.4,OLDA,"RES",LINE,0) D ^DIWP,STEP3A
"RTN","DVBCRPRT",21,0)
 D ^DIWW S PRINT=1 S DA=OLDA,DA(1)=OLDA1
"RTN","DVBCRPRT",22,0)
 Q
"RTN","DVBCRPRT",23,0)
STEP3A ;  ** Called from STEP3 only **
"RTN","DVBCRPRT",24,0)
 I $Y>(IOSL-9) D UP^DVBCRPR1,NEXT,HDR^DVBCRPR1 W:$O(^DVB(396.4,OLDA,"RES",LINE))]"" !!,"Exam Results Continued",!!
"RTN","DVBCRPRT",25,0)
 Q
"RTN","DVBCRPRT",26,0)
GO ;  ** An external entry point called from DVBCRPON **
"RTN","DVBCRPRT",27,0)
 U IO K ^TMP($J),DVBAON2 D HDA^DVBCRPR1 S (XCNT,XPRINT)=0
"RTN","DVBCRPRT",28,0)
 I '$D(^XUSEC("DVBA C SUPERVISOR",DUZ)) D
"RTN","DVBCRPRT",29,0)
 .F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF","C",DUZ(2),DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",30,0)
 ..I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",31,0)
 ..I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",32,0)
 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) D
"RTN","DVBCRPRT",33,0)
 .F LOC=0:0 S LOC=$O(^DVB(396.3,"AF","C",LOC)) Q:LOC=""  D
"RTN","DVBCRPRT",34,0)
 ..F DA(1)=0:0 S DA(1)=$O(^DVB(396.3,"AF","C",LOC,DA(1))) Q:DA(1)=""  DO
"RTN","DVBCRPRT",35,0)
 ...I $D(^DVB(396.3,DA(1),0)) D GO1
"RTN","DVBCRPRT",36,0)
 ...I '$D(^DVB(396.3,DA(1),0)) D BADXRF^DVBCPRNT
"RTN","DVBCRPRT",37,0)
 I XPRINT=0 K XPRINT,XPG,XXLN W !!!!!?25,"Nothing to print",!! H 2 G KILL^DVBCUTIL
"RTN","DVBCRPRT",38,0)
 I XCNT>0,XPRINT=1 W !!,"Total requests to be printed: ",XCNT,!
"RTN","DVBCRPRT",39,0)
 K XCNT,XXLN,XPG,XPRINT D SETLAB^DVBCPRNT S (XCN,PNAM)=""
"RTN","DVBCRPRT",40,0)
 F DVBCN=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""  F JJ=0:0 S PNAM=$O(^TMP($J,XCN,PNAM)) Q:PNAM=""  D GO2
"RTN","DVBCRPRT",41,0)
 G EXIT
"RTN","DVBCRPRT",42,0)
GO2 F DA(1)=0:0 K PRINT S DA(1)=$O(^TMP($J,XCN,PNAM,DA(1))) Q:DA(1)=""  S PRTDATE=$P(^DVB(396.3,DA(1),0),U,16) I PRTDATE[RUNDATE S DA=DA(1) D VARS^DVBCUTIL Q:(LOC'=RO)&('$D(^XUSEC("DVBA C SUPERVISOR",DUZ)))&('$D(AUTO))  D STEP2
"RTN","DVBCRPRT",43,0)
 Q
"RTN","DVBCRPRT",44,0)
GO1 S DFN=$P(^DVB(396.3,DA(1),0),U,1),PRTDATE=$P(^(0),U,16),PNAM=$P(^DPT(DFN,0),U,1),SSN=$P(^(0),U,9),CNUM=$S($D(^DPT(DFN,.31)):$P(^(.31),U,3),1:"Missing")
"RTN","DVBCRPRT",45,0)
 I RTYPE="D" Q:PRTDATE'[RUNDATE!(RUNDATE']"")
"RTN","DVBCRPRT",46,0)
 S XCN=$E(CNUM,$L(CNUM)-1,$L(CNUM)),XCN=+XCN
"RTN","DVBCRPRT",47,0)
 I PNAM]"" S ^TMP($J,XCN,PNAM,DA(1))="",XPRINT=1,XCNT=XCNT+1
"RTN","DVBCRPRT",48,0)
 D SSNSHRT^DVBCUTIL
"RTN","DVBCRPRT",49,0)
 W $E(PNAM,1,25),?28,DVBCSSNO,?43,CNUM,?55 S Y=$P(^DVB(396.3,DA(1),0),U,2) X XDD W Y,! D:$Y>(IOSL-16) HDA^DVBCRPR1
"RTN","DVBCRPRT",50,0)
 K PNAM,XCN,CNUM,DVBCSSNO
"RTN","DVBCRPRT",51,0)
 Q
"RTN","DVBCRPRT",52,0)
 ;
"RTN","DVBCRPRT",53,0)
EXIT K XDD,AUTO S LKILL=1 G KILL^DVBCUTIL ; ** GOTO will quit from this RTN
"RTN","DVBCRPRT",54,0)
 ;
"RTN","DVBCRPRT",55,0)
NEXT I '$D(DVBGUI) W !,"Continued on next page",!,"VA Form 2507"
"RTN","DVBCRPRT",56,0)
 Q
"RTN","DVBCRPRT",57,0)
 ;
"RTN","DVBCRPRT",58,0)
GETRO S RO=$P(^DVB(396.3,DA(1),0),U,3)
"RTN","DVBCRPRT",59,0)
 Q
"SEC","^DIC",396.15,396.15,0,"AUDIT")
@
"SEC","^DIC",396.15,396.15,0,"DD")
@
"SEC","^DIC",396.15,396.15,0,"DEL")
@
"SEC","^DIC",396.15,396.15,0,"LAYGO")
@
"SEC","^DIC",396.15,396.15,0,"RD")
@
"SEC","^DIC",396.15,396.15,0,"WR")
@
"VER")
8.0^22.0
"^DD",396.15,396.15,0)
FIELD^^4^4
"^DD",396.15,396.15,0,"DT")
3020904
"^DD",396.15,396.15,0,"IX","B",396.15,.01)

"^DD",396.15,396.15,0,"NM","CAPRI DIVISION EXAM LIST")

"^DD",396.15,396.15,0,"VRPK")
DVBA
"^DD",396.15,396.15,.01,0)
DIVISION^RP40.8'^DG(40.8,^0;1^Q
"^DD",396.15,396.15,.01,1,0)
^.1
"^DD",396.15,396.15,.01,1,1,0)
396.15^B
"^DD",396.15,396.15,.01,1,1,1)
S ^DVB(396.15,"B",$E(X,1,30),DA)=""
"^DD",396.15,396.15,.01,1,1,2)
K ^DVB(396.15,"B",$E(X,1,30),DA)
"^DD",396.15,396.15,.01,3)

"^DD",396.15,396.15,.01,21,0)
^^2^2^3020904^
"^DD",396.15,396.15,.01,21,1,0)
Medical center divisions will automatically be added to this field when 
"^DD",396.15,396.15,.01,21,2,0)
the setup utility is accessed in the CAPRI GUI.
"^DD",396.15,396.15,.01,"DT")
3020904
"^DD",396.15,396.15,1,0)
CUSTOM EXAM LISTS^396.151^^1;0
"^DD",396.15,396.15,3,0)
COMMENT FOR GUI^396.153^^2;0
"^DD",396.15,396.15,3,21,0)
^^2^2^3020904^
"^DD",396.15,396.15,3,21,1,0)
This field holds a comment to be displayed in the CAPRI GUI when this 
"^DD",396.15,396.15,3,21,2,0)
division is selected.
"^DD",396.15,396.15,4,0)
DISABLE ALL EXAMS?^S^Y:YES;N:NO;^3;1^Q
"^DD",396.15,396.15,4,21,0)
^^2^2^3020904^
"^DD",396.15,396.15,4,21,1,0)
Used to determine if a division should show in the list of routing 
"^DD",396.15,396.15,4,21,2,0)
locations in the CAPRI GUI.
"^DD",396.15,396.15,4,23,0)
^^2^2^3020904^
"^DD",396.15,396.15,4,23,1,0)
Set to "YES" to hide the division.  If "NO" or blank, then the division 
"^DD",396.15,396.15,4,23,2,0)
will show.
"^DD",396.15,396.15,4,"DT")
3020904
"^DD",396.15,396.151,0)
CUSTOM EXAM LISTS SUB-FIELD^^4^5
"^DD",396.15,396.151,0,"DT")
3020904
"^DD",396.15,396.151,0,"IX","B",396.151,.01)

"^DD",396.15,396.151,0,"NM","CUSTOM EXAM LISTS")

"^DD",396.15,396.151,0,"UP")
396.15
"^DD",396.15,396.151,.01,0)
NAME OF LIST^MRF^^0;1^K:$L(X)>80!($L(X)<1) X
"^DD",396.15,396.151,.01,1,0)
^.1
"^DD",396.15,396.151,.01,1,1,0)
396.151^B
"^DD",396.15,396.151,.01,1,1,1)
S ^DVB(396.15,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",396.15,396.151,.01,1,1,2)
K ^DVB(396.15,DA(1),1,"B",$E(X,1,30),DA)
"^DD",396.15,396.151,.01,3)
Answer must be 1-80 characters in length.
"^DD",396.15,396.151,.01,21,0)
^^3^3^3020904^
"^DD",396.15,396.151,.01,21,1,0)
Free-text name of the list.  The user will never see this name.  The only 
"^DD",396.15,396.151,.01,21,2,0)
place it will be visible is in the configuration menu for exam lists in 
"^DD",396.15,396.151,.01,21,3,0)
the CAPRI GUI.
"^DD",396.15,396.151,.01,"DT")
3020904
"^DD",396.15,396.151,1,0)
COMMENT FOR GUI^396.1511^^1;0
"^DD",396.15,396.151,1,21,0)
^^3^3^3020904^
"^DD",396.15,396.151,1,21,1,0)
This comment will be displayed if this list becomes the active list in 
"^DD",396.15,396.151,1,21,2,0)
the CAPRI GUI.  This is not the comment for the division, but only 
"^DD",396.15,396.151,1,21,3,0)
pertains to the specific list being accessed.
"^DD",396.15,396.151,2,0)
DEFAULT LIST FOR DISPLAY?^S^Y:YES;N:NO;^2;1^Q
"^DD",396.15,396.151,2,21,0)
^^2^2^3020904^
"^DD",396.15,396.151,2,21,1,0)
If this is the default list for the division, set this to YES.  
"^DD",396.15,396.151,2,21,2,0)
Otherwise, leave it blank or set to NO.
"^DD",396.15,396.151,2,"DT")
3020904
"^DD",396.15,396.151,3,0)
INSTITUTION LIST APPLIES TO^P4'^DIC(4,^2;2^Q
"^DD",396.15,396.151,3,21,0)
^^9^9^3020904^
"^DD",396.15,396.151,3,21,1,0)
If there is a specific institution that this list applies to 
"^DD",396.15,396.151,3,21,2,0)
(e.g. ST.PETERSBURG-RO), then enter the name.  The list will be displayed 
"^DD",396.15,396.151,3,21,3,0)
to the user if their assigned division matches this entry and they've 
"^DD",396.15,396.151,3,21,4,0)
selected the division under which this list is being created.
"^DD",396.15,396.151,3,21,5,0)
 
"^DD",396.15,396.151,3,21,6,0)
This will allow the site, for example, to create a separate list for 
"^DD",396.15,396.151,3,21,7,0)
Veterans Benefits, Board of Veterans Appeals, Tiger Team, etc.  In some 
"^DD",396.15,396.151,3,21,8,0)
cases, an exam of one type may be done at a division for BVA but not 
"^DD",396.15,396.151,3,21,9,0)
VBA.
"^DD",396.15,396.151,3,"DT")
3020904
"^DD",396.15,396.151,4,0)
EXAM LIST^396.1514P^^3;0
"^DD",396.15,396.1511,0)
COMMENT FOR GUI SUB-FIELD^^.01^1
"^DD",396.15,396.1511,0,"DT")
3020904
"^DD",396.15,396.1511,0,"NM","COMMENT FOR GUI")

"^DD",396.15,396.1511,0,"UP")
396.151
"^DD",396.15,396.1511,.01,0)
COMMENT FOR GUI^W^^0;1^Q
"^DD",396.15,396.1511,.01,"DT")
3020904
"^DD",396.15,396.1514,0)
EXAM LIST SUB-FIELD^^2^3
"^DD",396.15,396.1514,0,"DT")
3020904
"^DD",396.15,396.1514,0,"IX","B",396.1514,.01)

"^DD",396.15,396.1514,0,"NM","EXAM LIST")

"^DD",396.15,396.1514,0,"UP")
396.151
"^DD",396.15,396.1514,.01,0)
EXAM NAME^MP396.6'^DVB(396.6,^0;1^Q
"^DD",396.15,396.1514,.01,1,0)
^.1
"^DD",396.15,396.1514,.01,1,1,0)
396.1514^B
"^DD",396.15,396.1514,.01,1,1,1)
S ^DVB(396.15,DA(2),1,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",396.15,396.1514,.01,1,1,2)
K ^DVB(396.15,DA(2),1,DA(1),3,"B",$E(X,1,30),DA)
"^DD",396.15,396.1514,.01,21,0)
^^3^3^3020904^
"^DD",396.15,396.1514,.01,21,1,0)
The CAPRI GUI will automatically keep information in this field updated.  
"^DD",396.15,396.1514,.01,21,2,0)
If a new exam type is released nationally, CAPRI will add it to this 
"^DD",396.15,396.1514,.01,21,3,0)
multiple.
"^DD",396.15,396.1514,.01,"DT")
3020904
"^DD",396.15,396.1514,1,0)
COMMENT^396.15141^^1;0
"^DD",396.15,396.1514,1,21,0)
^^4^4^3020904^
"^DD",396.15,396.1514,1,21,1,0)
This field can hold a comment that applies to the examination being 
"^DD",396.15,396.1514,1,21,2,0)
selected in case there is information the site would like displayed to 
"^DD",396.15,396.1514,1,21,3,0)
the user (i.e.  "This examination can be performed faster if ordered at 
"^DD",396.15,396.1514,1,21,4,0)
the main facility division.")
"^DD",396.15,396.1514,2,0)
ACTIVE?^S^Y:YES;N:NO;^2;1^Q
"^DD",396.15,396.1514,2,21,0)
^^3^3^3020904^
"^DD",396.15,396.1514,2,21,1,0)
This field controls whether the exam appears as active (black) or 
"^DD",396.15,396.1514,2,21,2,0)
inactive (red) in the CAPRI GUI.  If set to "NO," it will appear 
"^DD",396.15,396.1514,2,21,3,0)
inactive.  If set to "YES" or left blank, it will appear as active.
"^DD",396.15,396.1514,2,"DT")
3020904
"^DD",396.15,396.15141,0)
COMMENT SUB-FIELD^^.01^1
"^DD",396.15,396.15141,0,"DT")
3020904
"^DD",396.15,396.15141,0,"NM","COMMENT")

"^DD",396.15,396.15141,0,"UP")
396.1514
"^DD",396.15,396.15141,.01,0)
COMMENT^W^^0;1^Q
"^DD",396.15,396.15141,.01,"DT")
3020904
"^DD",396.15,396.153,0)
COMMENT FOR GUI SUB-FIELD^^.01^1
"^DD",396.15,396.153,0,"DT")
3020904
"^DD",396.15,396.153,0,"NM","COMMENT FOR GUI")

"^DD",396.15,396.153,0,"UP")
396.15
"^DD",396.15,396.153,.01,0)
COMMENT FOR GUI^W^^0;1^Q
"^DD",396.15,396.153,.01,"DT")
3020904
"^DIC",396.15,396.15,0)
CAPRI DIVISION EXAM LIST^396.15
"^DIC",396.15,396.15,0,"GL")
^DVB(396.15,
"^DIC",396.15,396.15,"%",0)
^1.005^^0
"^DIC",396.15,396.15,"%D",0)
^^4^4^3020904^
"^DIC",396.15,396.15,"%D",1,0)
This file is used by the CAPRI GUI to maintain a list of AMIE C&P 
"^DIC",396.15,396.15,"%D",2,0)
examinations that are assigned to a specific medical center division.  It 
"^DIC",396.15,396.15,"%D",3,0)
is also possible to set a flag in this file to disable the division from 
"^DIC",396.15,396.15,"%D",4,0)
appearing in the listing of selectable divisions in the GUI.
"^DIC",396.15,"B","CAPRI DIVISION EXAM LIST",396.15)

**END**
**END**
