Released XU*8*29 SEQ #32
Extracted from mail message
**KIDS**:XU*8.0*29^

**INSTALL NAME**
XU*8.0*29
"BLD",95,0)
XU*8.0*29^KERNEL^0^^n
"BLD",95,1,0)
^^52^52^2960710^^
"BLD",95,1,1,0)
This patch contains 7 routines, 1 option, and 1 input template.  It
"BLD",95,1,2,0)
replaces XU*8*4 which has been canceled.  It fixes 3 problems in the Menu
"BLD",95,1,3,0)
System:
"BLD",95,1,4,0)
  
"BLD",95,1,5,0)
1.  Routines XQ72, XQ75, XQ83R, XQCHK, and XQT: If a parent option on the
"BLD",95,1,6,0)
top of a menu tree was placed out-of-order or locked a user might be able
"BLD",95,1,7,0)
to jump through it because of the way the compiled menus in ^XUTL were
"BLD",95,1,8,0)
being built.  [NOIS WBP-0895-22132]
"BLD",95,1,9,0)
  
"BLD",95,1,10,0)
2.  Routines XQSMD1 and XQOO: Confusion resulted when a user encountered
"BLD",95,1,11,0)
an option that contained a hyphen in the option name.  The software could
"BLD",95,1,12,0)
not easily distinguish between this type of option and two different
"BLD",95,1,13,0)
options presented with a hyphen between them as a range of options to
"BLD",95,1,14,0)
select.  The software now looks first to see if a single option meets the
"BLD",95,1,15,0)
selection criterion, and if so it ignores the possibility of a range of
"BLD",95,1,16,0)
options.
"BLD",95,1,17,0)
 
"BLD",95,1,18,0)
3.  The option XUEDITOPT and the input template [XUEDITOPT]:  A piece of
"BLD",95,1,19,0)
code was added to the template in Kernel 8 to start micro surgery to
"BLD",95,1,20,0)
rebuild the compiled menus after an option was created or changed.  This
"BLD",95,1,21,0)
resulted in errors because the code called FileMan from within a template.
"BLD",95,1,22,0)
The call was therefore moved to the Exit Action of the option to avoid
"BLD",95,1,23,0)
that conflict.  [NOIS ERI-1095-21763, FTM-1095-43520]
"BLD",95,1,24,0)
 
"BLD",95,1,25,0)
=========================================================================
"BLD",95,1,26,0)
INSTALLATION: 
"BLD",95,1,27,0)
  1.  Many of these routines may be mapped on systems that allow
"BLD",95,1,28,0)
      mapping, so you may need to disable mapping.
"BLD",95,1,29,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This 
"BLD",95,1,30,0)
      option will load the KIDS package onto your system.  
"BLD",95,1,31,0)
  3.  Answer NO to the question: 
"BLD",95,1,32,0)
      'Shall I preserve what is on disk in a separate back-up message ?' 
"BLD",95,1,33,0)
  4.  The patch has now been loaded into a Transport global on your 
"BLD",95,1,34,0)
      system. You now need to use KIDS to install the Transport global.  
"BLD",95,1,35,0)
  5.  On the KIDS menu, under the 'Installation' menu, use the option 
"BLD",95,1,36,0)
      'Verify Checksum in Transport Global' and verify that all routines 
"BLD",95,1,37,0)
      have the correct checksums.  
"BLD",95,1,38,0)
  6.  On the KIDS menu, under the 'Installation' menu, use the option 
"BLD",95,1,39,0)
      'Install Package(s)'. Select the package 'XU*8.0*29' and proceed 
"BLD",95,1,40,0)
      with the install.  
"BLD",95,1,41,0)
  7.  Rebuild your mapped set if necessary.
"BLD",95,1,42,0)
========================================================================
"BLD",95,1,43,0)
 
"BLD",95,1,44,0)
ROUTINE                CHECKSUM                PATCHES IN 2ND LINE
"BLD",95,1,45,0)
 
"BLD",95,1,46,0)
XQ72                   10277570                **29**
"BLD",95,1,47,0)
XQ75                   14473337                **29**
"BLD",95,1,48,0)
XQ83R                  15234319                **29**
"BLD",95,1,49,0)
XQCHK                   7318302                **29**
"BLD",95,1,50,0)
XQOO                   20509324                **10,21,29**
"BLD",95,1,51,0)
XQSMD1                 14983624                **29**
"BLD",95,1,52,0)
XQT                    14370309                **20,29**
"BLD",95,4,0)
^9.64PA^^
"BLD",95,"ABPKG")
n
"BLD",95,"KRN",0)
^9.67PA^8994^15
"BLD",95,"KRN",.4,0)
.4
"BLD",95,"KRN",.401,0)
.401
"BLD",95,"KRN",.402,0)
.402
"BLD",95,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",95,"KRN",.402,"NM",1,0)
XUEDITOPT    FILE #19^19^0
"BLD",95,"KRN",.402,"NM","B","XUEDITOPT    FILE #19",1)

"BLD",95,"KRN",.403,0)
.403
"BLD",95,"KRN",.5,0)
.5
"BLD",95,"KRN",.84,0)
.84
"BLD",95,"KRN",3.6,0)
3.6
"BLD",95,"KRN",9.2,0)
9.2
"BLD",95,"KRN",9.8,0)
9.8
"BLD",95,"KRN",9.8,"NM",0)
^9.68A^8^7
"BLD",95,"KRN",9.8,"NM",1,0)
XQ72^^0^B17214351
"BLD",95,"KRN",9.8,"NM",2,0)
XQ75^^0^B27424359
"BLD",95,"KRN",9.8,"NM",3,0)
XQ83R^^0^B27880643
"BLD",95,"KRN",9.8,"NM",4,0)
XQCHK^^0^B11152666
"BLD",95,"KRN",9.8,"NM",5,0)
XQT^^0^B26090607
"BLD",95,"KRN",9.8,"NM",7,0)
XQOO^^0^B47252063
"BLD",95,"KRN",9.8,"NM",8,0)
XQSMD1^^0^B23178412
"BLD",95,"KRN",9.8,"NM","B","XQ72",1)

"BLD",95,"KRN",9.8,"NM","B","XQ75",2)

"BLD",95,"KRN",9.8,"NM","B","XQ83R",3)

"BLD",95,"KRN",9.8,"NM","B","XQCHK",4)

"BLD",95,"KRN",9.8,"NM","B","XQOO",7)

"BLD",95,"KRN",9.8,"NM","B","XQSMD1",8)

"BLD",95,"KRN",9.8,"NM","B","XQT",5)

"BLD",95,"KRN",19,0)
19
"BLD",95,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",95,"KRN",19,"NM",1,0)
XUEDITOPT^^0
"BLD",95,"KRN",19,"NM","B","XUEDITOPT",1)

"BLD",95,"KRN",19.1,0)
19.1
"BLD",95,"KRN",101,0)
101
"BLD",95,"KRN",409.61,0)
409.61
"BLD",95,"KRN",8994,0)
8994
"BLD",95,"KRN",8995,0)
8995
"BLD",95,"KRN","B",.4,.4)

"BLD",95,"KRN","B",.401,.401)

"BLD",95,"KRN","B",.402,.402)

"BLD",95,"KRN","B",.403,.403)

"BLD",95,"KRN","B",.5,.5)

"BLD",95,"KRN","B",.84,.84)

"BLD",95,"KRN","B",3.6,3.6)

"BLD",95,"KRN","B",9.2,9.2)

"BLD",95,"KRN","B",9.8,9.8)

"BLD",95,"KRN","B",19,19)

"BLD",95,"KRN","B",19.1,19.1)

"BLD",95,"KRN","B",101,101)

"BLD",95,"KRN","B",409.61,409.61)

"BLD",95,"KRN","B",8994,8994)

"BLD",95,"KRN","B",8995,8995)

"BLD",95,"QUES",0)
^9.62^^
"KRN",.402,90,-1)
0^1
"KRN",.402,90,0)
XUEDITOPT^2951122.11^#^19^^#^2960619
"KRN",.402,90,"DIAB",1,1,19.01,0)
ALL
"KRN",.402,90,"DIAB",1,1,19.391,0)
ALL
"KRN",.402,90,"DR",1,19)
.01;Q;1;12//^S X=$S($D(XQPK):XQPK,1:"");K XQPK;2:3.5;4;S XQTYP=X;D CLEAR^XQ5;S:DUZ(0)'="@"&('$D(^XUSEC("XUMGR",DUZ))) Y="@5";26;20;15;@5;S Y=$S($D(XQTYP):"@"_$A(XQTYP),1:"@3");@77;10;S Y="@3";@69;D DIE^XQ5;
"KRN",.402,90,"DR",1,19,1)
S:DUZ(0)'="@"&('$D(^XUSEC("XUMGR",DUZ))) Y="@3";30;36;31;50;51;53;32;33;34;35;S Y="@3";@80;D DIP^XQ5;S:DUZ(0)'="@"&('$D(^XUSEC("XUMGR",DUZ))) Y="@3";60;62;63;64;65;66;69;71;67;61;68;72;73;77;78;S Y="@3";@73;D DIQ^XQ5;
"KRN",.402,90,"DR",1,19,2)
S:DUZ(0)'="@"&('$D(^XUSEC("XUMGR",DUZ))) Y="@3";30;36;31;80;63;82;32;33;34;35;S Y="@3";@76;@79;@81;@88;10;S Y="@3";@82;25;S Y="@3";@83;R !,"Do you want help with servers? [Y/N] N// ",XQUR S:XQUR="" XQUR="N";
"KRN",.402,90,"DR",1,19,3)
I "Yy"[XQUR S XQH="XUDOC SERVERS" D EN^XQH K Y;25;220:225;3.6:3.8;3.91;S Y="@999";@67;30;36;31;40:44;32;33;34;35;S Y="@3";@87;24;25;300;301;S Y="@3";@90;24;25;300;301;10;@65;@3;3.6;3.7;3.8;3.91;3.92;3.95;3.96;@999;
"KRN",.402,90,"DR",1,19,4)
K XQH,XQPK,XQTYP,XQUR;
"KRN",.402,90,"DR",2,19.01)
.01:3
"KRN",.402,90,"DR",2,19.06)
.01
"KRN",.402,90,"DR",2,19.391)
.01:.02
"KRN",.402,90,"DR",2,19.392)
.01:.02;
"KRN",.402,90,"DR",2,19.396)
.01;
"KRN",19,5,-1)
0^1
"KRN",19,5,0)
XUEDITOPT^Edit options^^E^^^XQEDIT^^^^^OLD KERNEL^n^1^1
"KRN",19,5,1,0)
^^3^3^2920127^^
"KRN",19,5,1,1,0)
This option is used to create the building blocks of the menu system:
"KRN",19,5,1,2,0)
the options. Each option should have an internal name, menu text, a
"KRN",19,5,1,3,0)
description and a type.  Depending on its type, other fields are filled in.
"KRN",19,5,15)
K DLAYGO D KICK^XQ7
"KRN",19,5,20)
S DLAYGO=19
"KRN",19,5,30)
DIC(19,
"KRN",19,5,31)
AELMQ
"KRN",19,5,32)
Select OPTION to edit:
"KRN",19,5,50)
DIC(19,
"KRN",19,5,51)
[XUEDITOPT]
"KRN",19,5,99)
53922,30780
"KRN",19,5,"U")
EDIT OPTIONS
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",283,-1)
1^1
"PKG",283,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",283,22,0)
^9.49I^1^1
"PKG",283,22,1,0)
8.0^2950729^2950729^6
"PKG",283,22,1,"PAH",1,0)
29
"PKG",283,22,1,"PAH",1,1,0)
^^52^52^2960726
"PKG",283,22,1,"PAH",1,1,1,0)
This patch contains 7 routines, 1 option, and 1 input template.  It
"PKG",283,22,1,"PAH",1,1,2,0)
replaces XU*8*4 which has been canceled.  It fixes 3 problems in the Menu
"PKG",283,22,1,"PAH",1,1,3,0)
System:
"PKG",283,22,1,"PAH",1,1,4,0)
  
"PKG",283,22,1,"PAH",1,1,5,0)
1.  Routines XQ72, XQ75, XQ83R, XQCHK, and XQT: If a parent option on the
"PKG",283,22,1,"PAH",1,1,6,0)
top of a menu tree was placed out-of-order or locked a user might be able
"PKG",283,22,1,"PAH",1,1,7,0)
to jump through it because of the way the compiled menus in ^XUTL were
"PKG",283,22,1,"PAH",1,1,8,0)
being built.  [NOIS WBP-0895-22132]
"PKG",283,22,1,"PAH",1,1,9,0)
  
"PKG",283,22,1,"PAH",1,1,10,0)
2.  Routines XQSMD1 and XQOO: Confusion resulted when a user encountered
"PKG",283,22,1,"PAH",1,1,11,0)
an option that contained a hyphen in the option name.  The software could
"PKG",283,22,1,"PAH",1,1,12,0)
not easily distinguish between this type of option and two different
"PKG",283,22,1,"PAH",1,1,13,0)
options presented with a hyphen between them as a range of options to
"PKG",283,22,1,"PAH",1,1,14,0)
select.  The software now looks first to see if a single option meets the
"PKG",283,22,1,"PAH",1,1,15,0)
selection criterion, and if so it ignores the possibility of a range of
"PKG",283,22,1,"PAH",1,1,16,0)
options.
"PKG",283,22,1,"PAH",1,1,17,0)
 
"PKG",283,22,1,"PAH",1,1,18,0)
3.  The option XUEDITOPT and the input template [XUEDITOPT]:  A piece of
"PKG",283,22,1,"PAH",1,1,19,0)
code was added to the template in Kernel 8 to start micro surgery to
"PKG",283,22,1,"PAH",1,1,20,0)
rebuild the compiled menus after an option was created or changed.  This
"PKG",283,22,1,"PAH",1,1,21,0)
resulted in errors because the code called FileMan from within a template.
"PKG",283,22,1,"PAH",1,1,22,0)
The call was therefore moved to the Exit Action of the option to avoid
"PKG",283,22,1,"PAH",1,1,23,0)
that conflict.  [NOIS ERI-1095-21763, FTM-1095-43520]
"PKG",283,22,1,"PAH",1,1,24,0)
 
"PKG",283,22,1,"PAH",1,1,25,0)
=========================================================================
"PKG",283,22,1,"PAH",1,1,26,0)
INSTALLATION: 
"PKG",283,22,1,"PAH",1,1,27,0)
  1.  Many of these routines may be mapped on systems that allow
"PKG",283,22,1,"PAH",1,1,28,0)
      mapping, so you may need to disable mapping.
"PKG",283,22,1,"PAH",1,1,29,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This 
"PKG",283,22,1,"PAH",1,1,30,0)
      option will load the KIDS package onto your system.  
"PKG",283,22,1,"PAH",1,1,31,0)
  3.  Answer NO to the question: 
"PKG",283,22,1,"PAH",1,1,32,0)
      'Shall I preserve what is on disk in a separate back-up message ?' 
"PKG",283,22,1,"PAH",1,1,33,0)
  4.  The patch has now been loaded into a Transport global on your 
"PKG",283,22,1,"PAH",1,1,34,0)
      system. You now need to use KIDS to install the Transport global.  
"PKG",283,22,1,"PAH",1,1,35,0)
  5.  On the KIDS menu, under the 'Installation' menu, use the option 
"PKG",283,22,1,"PAH",1,1,36,0)
      'Verify Checksum in Transport Global' and verify that all routines 
"PKG",283,22,1,"PAH",1,1,37,0)
      have the correct checksums.  
"PKG",283,22,1,"PAH",1,1,38,0)
  6.  On the KIDS menu, under the 'Installation' menu, use the option 
"PKG",283,22,1,"PAH",1,1,39,0)
      'Install Package(s)'. Select the package 'XU*8.0*29' and proceed 
"PKG",283,22,1,"PAH",1,1,40,0)
      with the install.  
"PKG",283,22,1,"PAH",1,1,41,0)
  7.  Rebuild your mapped set if necessary.
"PKG",283,22,1,"PAH",1,1,42,0)
========================================================================
"PKG",283,22,1,"PAH",1,1,43,0)
 
"PKG",283,22,1,"PAH",1,1,44,0)
ROUTINE                CHECKSUM                PATCHES IN 2ND LINE
"PKG",283,22,1,"PAH",1,1,45,0)
 
"PKG",283,22,1,"PAH",1,1,46,0)
XQ72                   10277570                **29**
"PKG",283,22,1,"PAH",1,1,47,0)
XQ75                   14473337                **29**
"PKG",283,22,1,"PAH",1,1,48,0)
XQ83R                  15234319                **29**
"PKG",283,22,1,"PAH",1,1,49,0)
XQCHK                   7318302                **29**
"PKG",283,22,1,"PAH",1,1,50,0)
XQOO                   20509324                **10,21,29**
"PKG",283,22,1,"PAH",1,1,51,0)
XQSMD1                 14983624                **29**
"PKG",283,22,1,"PAH",1,1,52,0)
XQT                    14370309                **20,29**
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","XQ72")
0^1^B17214351
"RTN","XQ72",1,0)
XQ72 ;SEA/MJM - ^Jump Utilities ;04/15/96  14:35
"RTN","XQ72",2,0)
 ;;8.0;KERNEL;**29**;Jul 03, 1995
"RTN","XQ72",3,0)
 ;
"RTN","XQ72",4,0)
JUMP ;Entry point for D+1^XQ and  LEGAL^XQ74.
"RTN","XQ72",5,0)
 ;With +XQY: target opt, XQY0: 0th node with pathway, XQY1: parent's
"RTN","XQ72",6,0)
 ;0th node; XQ(XQ) array of alternate pathways, if any; XQDIC:
"RTN","XQ72",7,0)
 ;P-tree of target option; XQPSM: XQDIC or mutiple trees (U66,P258)
"RTN","XQ72",8,0)
 ;XQSV: XQY^XQDIC^XQY0 of origin (previous) option.
"RTN","XQ72",9,0)
 S XQMA=$P(XQSV,U,2)
"RTN","XQ72",10,0)
 I $D(^XUTL("XQ",$J,"RBX")) S XQFLG=1,XQSAV=XQY_U_XQPSM_U_XQY0,XQY=+^("RBX"),XQY0=$P(^("RBX"),U,2,99) D RBX^XQ73 S XQY=+XQSAV,XQPSM=$P(XQSAV,U,2),XQY0=$P(XQSAV,U,3,99) K XQFLG,XQSAV
"RTN","XQ72",11,0)
 I $D(^XUTL("XQO",XQMA,"^",+XQY)),($P(^(+XQY),U,6)=+XQY!($P(^(+XQY),U,6)="")) S XQY0=$P(^(+XQY),U,2,99),^DISV(DUZ,"XQ",XQMA)=XQY G OUT
"RTN","XQ72",12,0)
 S XQTT=^XUTL("XQ",$J,"T"),XQST=1,XQSTK="",XQSM=$S($P(^(XQTT),U)["U":1,1:0) F XQI=XQTT:-1:1 S %=+^XUTL("XQ",$J,XQI),XQSTK=XQSTK_%_","
"RTN","XQ72",13,0)
 I (","_XQSTK)[(","_XQY_","),'$D(XQRB) D NOJ^XQ72A G OUT
"RTN","XQ72",14,0)
 S XQPXU=0 I XQPSM["U" S XQPXU=1,XQST=XQTT I XQPSM["," S XQDIC=$P(XQPSM,",",2)
"RTN","XQ72",15,0)
 ;I '$D(XQ)!($D(XQ)&XQ<1) S %XQJP=$P(XQY0,U,5) D JMP^XQCHK I %XQJP="" W " ??",*7 S XQY=+XQSV,XQDIC=$P(XQSV,U,2),XQYO=$P(XQSV,U,3,99) G OUT
"RTN","XQ72",16,0)
 I $D(XQ),XQ>0 D MPW G:XQ<0 OUT
"RTN","XQ72",17,0)
 S XQJP=$P(XQY0,U,5) S XQI=XQTT
"RTN","XQ72",18,0)
 I XQSM F XQI=XQTT:-1:1 Q:$P(^XUTL("XQ",$J,XQI),U,1)'["U"  I $P(^(XQI),U,16)!($P(^(XQI),U,18)) S XQEX=+^(XQI) D XACT
"RTN","XQ72",19,0)
 S XQTT=XQI I XQPXU,XQSM S (^XUTL("XQ",$J,"T"),XQST)=XQI,XQNP=XQI_U_XQJP G B1
"RTN","XQ72",20,0)
 ;
"RTN","XQ72",21,0)
FND ;Pop to next Menu-type option, if in path remove options below it
"RTN","XQ72",22,0)
 S XQJP=$P(XQY0,U,5),XQNP=0,XQI=$S(XQPXU:XQTT,1:XQTT+1)
"RTN","XQ72",23,0)
 I 'XQPXU F XQII=0:0 Q:XQNP>0  S XQI=XQI-1 S XQY1=^XUTL("XQ",$J,XQI),XQT=$P(XQY1,U,5) Q:XQI=1  I "M"[XQT F XQJ=1:1:$L(XQJP,",")-1 I $P(XQJP,",",XQJ)=+XQY1 S XQNP=XQI_U_$P($E(XQJP,$F(XQJP,+XQY1),99),",",2,99) Q
"RTN","XQ72",24,0)
 S XQMA=$S(XQI>1:+^XUTL("XQ",$J,XQI),1:+^XUTL("XQ",$J,"XQM"))
"RTN","XQ72",25,0)
 S XQST=XQI
"RTN","XQ72",26,0)
 I 'XQNP S XQNP=$S(XQPXU:XQTT_U_XQJP,1:"1^"_XQJP)
"RTN","XQ72",27,0)
 I XQPSM[("U"_DUZ) S XQNP=$P(XQNP,U)_U_$P(XQPSM,"P",2)_","_$P(XQNP,U,2)
"RTN","XQ72",28,0)
 I $L($P(XQNP,U,2),",")<3 D LAT^XQ72A G OUT
"RTN","XQ72",29,0)
 ;I XQPSM[("U",DUZ),$L($P(XQNP,U,2),",")<2 D LAT^XQ72A G OUT
"RTN","XQ72",30,0)
 S XQK=0
"RTN","XQ72",31,0)
 ;
"RTN","XQ72",32,0)
BACK S (XQNO,XQZ)="",XQNO1="Jump cannot be completed."
"RTN","XQ72",33,0)
 F XQSTPT=XQTT:-1:XQST+1 S %=^XUTL("XQ",$J,XQSTPT),^("T")=^("T")-1 I $P(%,U,15)!($P(%,U,18)) S XQEX=+% D XACT
"RTN","XQ72",34,0)
 I (XQTT'>XQST+1) S XQST=$P(XQNP,U)
"RTN","XQ72",35,0)
B1 S XQZ=$P(XQNP,U,2) I '$L(XQZ) S ^XUTL("XQ",$J,"T")=1 G OUT
"RTN","XQ72",36,0)
 ;I XQPSM[("U"_DUZ) S XQD=$E(XQDIC,2,99) I (+XQD'=+XQY)&$L(XQD) S XQSTPT=1 D JUMP1 D:$D(XQUIT) XQUIT^XQ72A S XQST=XQST+1
"RTN","XQ72",37,0)
 I '$D(XQUIT) F XQSTPT=1:1 S XQD=$P(XQZ,",",XQSTPT) Q:(+XQD=+XQY)!('$L(XQD))  D JUMP1 Q:$D(XQUIT)
"RTN","XQ72",38,0)
 D:$D(XQUIT) XQUIT^XQ72A
"RTN","XQ72",39,0)
 S:'$D(XQUIT) ^DISV(DUZ,"XQ",XQMA)=XQY,XQY0=$P(^XUTL("XQO",XQDIC,U,+XQY),U,2,5)_"^^"_$P(^(+XQY),U,7,11)_"^^"_$P(^(+XQY),U,13)_"^^"_$P(^(+XQY),U,15,99)
"RTN","XQ72",40,0)
OUT K %,%XQJP,X,XQ,XQCH,XQD,XQEX,XQI,XQII,XQJ,XQJP,XQJS,XQK,XQMA,XQN,XQNO,XQNO1,XQNP,XQPXU,XQSM,XQST,XQSTK,XQSTPT,XQT,XQTT,XQV,XQW,XQY1,XQZ,Y,Z
"RTN","XQ72",41,0)
 I $D(XQUIT) K XQUIT G NOFIND^XQ
"RTN","XQ72",42,0)
 G M^XQ
"RTN","XQ72",43,0)
 ;
"RTN","XQ72",44,0)
XACT ;Execute Exit Actions and Headers: input X=option number, no output.
"RTN","XQ72",45,0)
 Q:'$D(^DIC(19,+XQEX,0))
"RTN","XQ72",46,0)
 I $D(^DIC(19,+XQEX,15)),$L(^(15)) X ^(15)
"RTN","XQ72",47,0)
 I $D(^DIC(19,+XQEX,26)),$L(^(26)) X ^(26)
"RTN","XQ72",48,0)
 Q
"RTN","XQ72",49,0)
 ;
"RTN","XQ72",50,0)
JUMP1 ;Check pathway for prohibitions, set up ^XUTL, and do entry ACTIONs
"RTN","XQ72",51,0)
 S XQY0=$S($D(^XUTL("XQO",XQMA,U,+XQD))#2:$P(^(+XQD),U,2,99),1:^DIC(19,+XQD,0)),XQMA=XQD
"RTN","XQ72",52,0)
 S ^XUTL("XQ",$J,XQST+XQSTPT)=XQD_XQPSM_U_XQY0,^("T")=XQST+XQSTPT
"RTN","XQ72",53,0)
 I $P(XQY0,U,14) Q:'$D(^DIC(19,XQD,20))  Q:'$L(^(20))  X ^(20)
"RTN","XQ72",54,0)
 I $D(XQUIT) S XQNO=$P(^DIC(19,XQD,0),U)_": '"_$P(^(0),U,2)_"'" Q
"RTN","XQ72",55,0)
 I $P(XQY0,U,17),$D(^DIC(19,XQD,26)),$L(^(26)) X ^(26)
"RTN","XQ72",56,0)
 Q
"RTN","XQ72",57,0)
 ;
"RTN","XQ72",58,0)
MPW ;Multiple paths, choose shortest or best
"RTN","XQ72",59,0)
 S XQ(XQ+1)=$P(XQY0,U,5),XQJ=1,%="" F XQI=0:0 S %=$O(XQ(%)) Q:%=""!(%'=+%)  S XQ(XQJ)=XQ(%),XQJ=XQJ+1
"RTN","XQ72",60,0)
 S XQ=XQJ-1 F XQJ=1:1:$L(XQSTK,",")-2 S X=","_$P(XQSTK,",",XQJ)_"," F XQI=1:1:XQ S %=","_XQ(XQI) I %[X,'$D(Y(XQI)) S XQ(XQI)=$E(X,2,99)_$P(XQ(XQI),X,2,99),Y(XQI)=""
"RTN","XQ72",61,0)
 F XQI=1:1:XQ S %($L(XQ(XQI),","),XQI)=XQ(XQI)
"RTN","XQ72",62,0)
 S X="",Z=1 F XQI=1:1:XQ S X=$O(%(X)) Q:X=""  S Y="" F XQJ=0:0 S Y=$O(%(X,Y)) Q:Y=""  S XQ(Z)=%(X,Y),Z=Z+1
"RTN","XQ72",63,0)
 F XQI=1:1:XQ S %XQJP=XQ(XQI) Q:%XQJP=""  D JMP^XQCHK Q:$L(%XQJP)
"RTN","XQ72",64,0)
 I %XQJP="" W " ??",*7 S XQY=+XQSV,XQDIC=$P(XQSV,U,2),XQY0=$P(XQSV,U,3,99),XQ=-1 Q
"RTN","XQ72",65,0)
 S XQY0=$P(XQY0,U,1,4)_U_XQ(XQI)_U_$P(XQY0,U,6,99)
"RTN","XQ72",66,0)
 Q
"RTN","XQ75")
0^2^B27424359
"RTN","XQ75",1,0)
XQ75 ;SEA/AMF,MJM,JLI - Lookup response for jumps ;04/30/96  14:41
"RTN","XQ75",2,0)
 ;;8.0;KERNEL;**29**;Jul 10, 1995
"RTN","XQ75",3,0)
 ;Enter at S with XQUR. Exit with XQY set to the chosen option #,
"RTN","XQ75",4,0)
 ;with array of possibilities in XQ(XQ):XQY^menu txt [name]^XQPSM
"RTN","XQ75",5,0)
 ;XQXT(XQXT) similarly built, holds exact matches
"RTN","XQ75",6,0)
 ;XQY=-1 (no option found), or XQY=-2 (jumps shut down).
"RTN","XQ75",7,0)
 ;
"RTN","XQ75",8,0)
X ;Unless exact match is found, find all possibilities in any XQDIC
"RTN","XQ75",9,0)
 S XQO=$O(^XUTL("XQO",XQDIC,XQO)) Q:'$S(XQO="":0,XQUR="?":XQO'="^",XQUR=0_$C(1):'$L($P(XQO,"0",1)),1:'$L($P(XQO,XQUR,1)))
"RTN","XQ75",10,0)
 S XQYY=^XUTL("XQO",XQDIC,XQO) S XQY=+XQYY G:$D(XQ("X",+XQY)) X S %=$G(^XUTL("XQO",XQDIC,"^",+XQY)) G:%="" X S XQY0=$P(%,U,2,99)
"RTN","XQ75",11,0)
 S XQCY=XQY,XQCY0=XQY0 D ^XQCHK I XQCY<0 S XQY=0 G X
"RTN","XQ75",12,0)
 S:'$P(XQYY,U,2) XQ("S",+XQY)=$P(XQO,U)
"RTN","XQ75",13,0)
 I XQUR=$P(XQO,U),'XQS S XQXT=XQXT+1,XQXT(XQXT)=+XQY_U_$P(XQY0,U,2)_"  ["_$P(XQY0,U)_"] "_U_$S($D(XQUD):XQUD_",",1:"")_XQDIC,XQXT("X",XQY)="" S:'$P(XQYY,U,2) XQXT("S",+XQY)=$P(XQO,U)
"RTN","XQ75",14,0)
 S XQ=XQ+1,XQ1=XQ1+1,XQ(XQ)=+XQY_U_$P(XQY0,U,2)_"  ["_$P(XQY0,U)_"] "_U_$S($D(XQUD):XQUD_",",1:"")_XQDIC,XQ("X",XQY)=""
"RTN","XQ75",15,0)
 I XQ1>19,'XQXT D C
"RTN","XQ75",16,0)
 Q:XQY<0!(XQUR="")  G X
"RTN","XQ75",17,0)
 Q
"RTN","XQ75",18,0)
 ;
"RTN","XQ75",19,0)
C ;Display a screen-load of 19 possibilities and ask for a choice
"RTN","XQ75",20,0)
 ;I $G(XQXFLG("GUI")) D  Q
"RTN","XQ75",21,0)
 ;.D LIST^XQGS1(XQ)
"RTN","XQ75",22,0)
 ;.S XQUR=""
"RTN","XQ75",23,0)
 ;.Q:XQY<0
"RTN","XQ75",24,0)
 ;.S %="" F  S %=$O(XQ(%)) Q:%=""!(%'=+%)  I XQY=+XQ(%) S XQPSM=$P(XQ(%),U,3)
"RTN","XQ75",25,0)
 ;.Q
"RTN","XQ75",26,0)
 S:XQ1<1 XQ1=XQ W ! F XQI=1:1:XQ1 S XQJ=XQS*20+XQI W !?4,XQJ,?9,$P(XQ(XQJ),U,2) I $D(XQ("S",+XQ(XQJ))) W ?43,"  (",XQ("S",+XQ(XQJ)),")"
"RTN","XQ75",27,0)
ASK W !!,"Type '^' to stop, or choose a number from 1 to ",XQ," :"
"RTN","XQ75",28,0)
 R XQJ:DTIME S:'$T XQJ=U W:XQJ["?" !!,"**> Choose an item from this list by selecting its corresponding number,",!?5,"or type a '^' to return to your menu.",! G:XQJ["?" ASK
"RTN","XQ75",29,0)
 I XQJ=U S XQY=-1,XQ=0 Q
"RTN","XQ75",30,0)
 I XQJ'?1N.N,$L(XQJ),XQJ'=U W *7,"  ??",! G ASK
"RTN","XQ75",31,0)
 I XQJ?1N.N G C:'$D(XQ(XQJ)) D  Q:$D(XQ(XQJ))
"RTN","XQ75",32,0)
 .N %,XQD,XQP,Y
"RTN","XQ75",33,0)
 .S %=XQ(XQJ),Y=+% I Y>0 D
"RTN","XQ75",34,0)
 ..S XQP=$P(%,U,3),XQD=$S($L(XQP,",")>1:$P(XQP,",",$L(XQP,",")),1:XQP)
"RTN","XQ75",35,0)
 ..S XQY0=$G(^XUTL("XQO",XQD,"^",Y)),XQY0=$P(XQY0,U,2,99)
"RTN","XQ75",36,0)
 ..I XQY0="" K XQ(XQJ) S XQ=XQ-1,XQJ="" Q
"RTN","XQ75",37,0)
 .I $D(XQ(XQJ)) S XQY=Y,XQDIC=XQD,XQPSM=XQP,XQUR="" W "  " Q
"RTN","XQ75",38,0)
 .Q
"RTN","XQ75",39,0)
 I XQJ?1N.N W *7,$P(XQ(XQJ-1#20+1),U,4),! G C
"RTN","XQ75",40,0)
 I '$L(XQJ),XQ1=20 S XQS=XQS+1,XQ1=0 Q
"RTN","XQ75",41,0)
 I '$L(XQJ),XQ1<20 S XQY=-1,XQ=0 Q
"RTN","XQ75",42,0)
 I '$D(XQ(XQJ)) G C
"RTN","XQ75",43,0)
 K XQ S XQY=$S(XQJ=U:-3,XQJ="":-3,1:-1),XQUR=$C(95) S:XQJ=U XQJ="",XQY=-1 S:$L(XQJ) XQUR=$S($E(XQDIC,1)="P":U_XQJ,1:XQJ),XQY=0 Q
"RTN","XQ75",44,0)
 Q
"RTN","XQ75",45,0)
 ;
"RTN","XQ75",46,0)
S ;Entry from XQ: Search primary, common, and secondary menus for XQUR
"RTN","XQ75",47,0)
 I XQUR'?.ANP W *7 S XQY=-1 Q
"RTN","XQ75",48,0)
 S:'$D(XQDIC) XQDIC=XQY S XQSV=XQY_U_XQDIC_U_XQY0
"RTN","XQ75",49,0)
 S XQJ="",XQJMP=1,(XQ,XQ1,XQS,XQXT,XQY)=0
"RTN","XQ75",50,0)
 S XQO=$E(XQUR,1,30) I XQUR'?.PUN F XQI=1:1 Q:XQO?.NUP  S XQO1=$A(XQO,XQI) I XQO1<123,XQO1>96 S XQO=$E(XQO,1,XQI-1)_$C(XQO1-32)_$E(XQO,XQI+1,255)
"RTN","XQ75",51,0)
 S XQUR=XQO,(XQO,XQO1)=$E(XQUR,1,$L(XQUR)-1)_$C($A($E(XQUR,$L(XQUR)))-1)_"z"
"RTN","XQ75",52,0)
 I '$D(^XUTL("XQ",$J,"XQM")) S ^("XQM")=+^VA(200,DUZ,201)
"RTN","XQ75",53,0)
 I '$D(^XUTL("XQ",$J,"XQW")) S ^("XQW")=$P(^VA(200,DUZ,201),U,2)
"RTN","XQ75",54,0)
 I $D(XQJS),XQJS G OUT
"RTN","XQ75",55,0)
 S XQDIC="P"_^XUTL("XQ",$J,"XQM") D X G:XQY<0 OUT G:XQUR="" W
"RTN","XQ75",56,0)
 S XQDIC="PXU",XQO=XQO1 D X G:XQY<0 OUT G:XQUR="" W
"RTN","XQ75",57,0)
 S XQDIC="U"_DUZ,XQO=XQO1 D:$S('$D(^XUTL("XQO",XQDIC,0)):1,'$D(^VA(200,DUZ,203.1)):1,1:^VA(200,DUZ,203.1)'=$P(^XUTL("XQO",XQDIC,0),U,2)) ^XQSET I '$D(^XUTL("XQO",XQDIC,0)),'XQXT D C G:XQY<0 OUT G:XQUR="" W
"RTN","XQ75",58,0)
 D X G:XQY<0 OUT G:XQUR="" W
"RTN","XQ75",59,0)
 F XQK=0:0 S XQUD="U"_DUZ,XQK=$O(^XUTL("XQO",XQUD,U,XQK)) Q:XQK=""  S XQCY=XQK D ^XQCHK I XQCY>0,$P(^XUTL("XQO",XQUD,U,XQK),U,5)="M" S XQST=XQK,XQDIC="P"_XQK,XQO=XQO1 D X G:XQY<0 OUT G:XQUR="" W
"RTN","XQ75",60,0)
 I XQXT K XQ S (XQ,XQ1)=XQXT F XQI=1:1:XQ S XQ(XQI)=XQXT(XQI),%=+XQ(XQI),XQ("X",%)="" I $D(XQXT("S",%)) S XQ("S",%)=XQXT("S",%)
"RTN","XQ75",61,0)
 I XQ=1,XQS=0 S %=XQ(1),XQY=+%,XQPSM=$P(%,U,3),XQDIC=$S($L(XQPSM,",")>1:$P(XQPSM,",",$L(XQPSM,",")),1:XQPSM),XQY0=$P(^XUTL("XQO",XQDIC,U,XQY),U,2,99) G W
"RTN","XQ75",62,0)
 I XQ>0,'$D(XQ(XQS*20+1)) S XQY=-1 G OUT
"RTN","XQ75",63,0)
 D:XQ>0 C G:XQY<0 OUT I XQ=0 S XQY=-1 G OUT
"RTN","XQ75",64,0)
 ;
"RTN","XQ75",65,0)
W ;Write out remaining text and return to XQ
"RTN","XQ75",66,0)
 ;G:$D(XQXFLG("GUI")) OUT
"RTN","XQ75",67,0)
 I $D(XQ("S",+XQY)),XQUR=$E(XQ("S",+XQY),1,$L(XQUR)) W $E(XQ("S",+XQY),$L(XQUR)+1,99),"   ",$P(XQY0,U,2)
"RTN","XQ75",68,0)
 E  W $E($P(XQY0,U,2),$L(XQUR)+1,99) W:$D(XQ("S",+XQY)) "   (",XQ("S",+XQY),")"
"RTN","XQ75",69,0)
 ;
"RTN","XQ75",70,0)
OUT ;Exit here
"RTN","XQ75",71,0)
 K XQ I XQY>0,$D(^XUTL("XQO",XQDIC,"^",+XQY,0)) S XQ=+^(0) F XQI=1:1:XQ S XQ(XQI)=$P(^XUTL("XQO",XQDIC,"^",XQY,0,XQI),U)
"RTN","XQ75",72,0)
 E  S XQ=0
"RTN","XQ75",73,0)
 ;I XQY=-1,'$D(XQHLP) W *7,"  ??" S XQY=+XQSV,XQDIC=$P(XQSV,U,2),XQY0=$P(XQSV,U,3,99),XQUR=""
"RTN","XQ75",74,0)
 ;
"RTN","XQ75",75,0)
 K %,I,J,X,XQ1,XQAP,XQCY,XQCY0,XQI,XQJ,XQJMP,XQK,XQO,XQO1,XQS,XQST,XQUD,XQXT,XQYY,Y
"RTN","XQ75",76,0)
 Q
"RTN","XQ75",77,0)
 ;
"RTN","XQ75",78,0)
P ;Entry point for '"' jump to XUCOMMAND options
"RTN","XQ75",79,0)
 I XQUR'?.ANP!(XQUR[U) W *7," ??" S XQY=-1 Q
"RTN","XQ75",80,0)
 S XQO=XQUR I XQUR'?.PUN F XQI=1:1 Q:XQO?.NUP  S XQO1=$A(XQO,XQI) I XQO1<123,XQO1>96 S XQO=$E(XQO,1,XQI-1)_$C(XQO1-32)_$E(XQO,XQI+1,255)
"RTN","XQ75",81,0)
 S XQUR=XQO,XQSV=XQY_U_XQDIC_U_XQY0
"RTN","XQ75",82,0)
 S XQJ="",XQJMP=1,(XQ,XQ1,XQS,XQXT,XQY)=0
"RTN","XQ75",83,0)
 S (XQO,XQO1)=$E(XQUR,1,$L(XQUR)-1)_$C($A($E(XQUR,$L(XQUR)))-1)_"z"
"RTN","XQ75",84,0)
 S XQDIC="PXU" D X G:XQY<0 OUT G:XQUR="" W
"RTN","XQ75",85,0)
 I XQXT K XQ S XQ=XQXT F XQI=1:1:XQ S XQ(XQI)=XQXT(XQI),%=+XQ(XQI),XQ("X",%)="" I $D(XQXT("S",%)) S XQ("S",%)=XQXT("S",%)
"RTN","XQ75",86,0)
 I XQ=1,XQS=0 S %=XQ(1),XQY=+%,XQPSM=$P(%,U,3),XQDIC=$S($L(XQPSM,",")>1:$P(XQPSM,",",$L(XQPSM,",")),1:XQPSM),XQY0=$P(^XUTL("XQO",XQDIC,U,XQY),U,2,99) G OUT
"RTN","XQ75",87,0)
 D:XQ>0 C G:XQY<0 OUT I XQ=0&('XQXT) S XQY=-1 G OUT
"RTN","XQ75",88,0)
 G OUT
"RTN","XQ83R")
0^3^B27880643
"RTN","XQ83R",1,0)
XQ83R ; SF-ISC.SEA/JLI - SURGERY ON ^XUTL("XQO", NODES FOR REGULAR MODIFICATIONS TO OPTIONS ;04/15/96  14:37
"RTN","XQ83R",2,0)
 ;;8.0;KERNEL;**29**;Jul 03, 1995
"RTN","XQ83R",3,0)
 Q
"RTN","XQ83R",4,0)
REG S XQOPI=+XQOP,XQC1=XQOPI_",",XQC2=","_XQC1
"RTN","XQ83R",5,0)
 D TABLE^XQ83A
"RTN","XQ83R",6,0)
 S XQ83R="" F I=0:0 S I=$O(^DIC(19,"AD",XQOPI,I)) Q:I'>0  S XQ83R=XQ83R_I_","
"RTN","XQ83R",7,0)
 S A="P" F %I=0:0 S XQ83RL=0 S A=$O(^XUTL("XQO",A)) Q:$E(A)'="P"  D
"RTN","XQ83R",8,0)
 . I $D(^XUTL("XQO",A,U,XQOPI)) D  Q
"RTN","XQ83R",9,0)
 . . L +^XUTL("XQO",A) K ^(A,0)
"RTN","XQ83R",10,0)
 . . F XQ83RI=1:1 S XQOPM=$P(XQ83R,",",XQ83RI) S:XQOPM="" ^XUTL("XQO",A,0)=%XQT1 L:XQOPM="" -^XUTL("XQO",A) Q:XQOPM=""  D ADD^XQ83A
"RTN","XQ83R",11,0)
 . F XQ83RI=1:1 S XQOPM=$P(XQ83R,",",XQ83RI) Q:XQOPM=""  D
"RTN","XQ83R",12,0)
 . . I $D(^XUTL("XQO",A,"^",XQOPM)) D
"RTN","XQ83R",13,0)
 . . . I '$D(XQ83LOCK) L +^XUTL("XQO",A) S XQ83LOCK=1 K ^XUTL("XQO",A,0)
"RTN","XQ83R",14,0)
 . . . D ADD^XQ83A
"RTN","XQ83R",15,0)
 . I $D(XQ83LOCK) L -^XUTL("XQO",A) K XQ83LOCK S ^XUTL("XQO",A,0)=%XQT1
"RTN","XQ83R",16,0)
 Q
"RTN","XQ83R",17,0)
 ;
"RTN","XQ83R",18,0)
A ;
"RTN","XQ83R",19,0)
 S B=0 F J=0:0 S B=$O(^XUTL("XQO",A,B)) Q:B=""!(B=U)  I +^(B)=XQOPI K ^(B)
"RTN","XQ83R",20,0)
 D A1
"RTN","XQ83R",21,0)
 F I=0:0 S I=$O(^XUTL("XQO",A,U,I)) Q:I'>0  D A2
"RTN","XQ83R",22,0)
 Q
"RTN","XQ83R",23,0)
A2 ;
"RTN","XQ83R",24,0)
 S L=0,%XQX=$P(^XUTL("XQO",A,U,I),U,9) I $E(%XQX,1,$L(XQC1))=XQC1!(%XQX[XQC2) S L=1
"RTN","XQ83R",25,0)
 I 'L F J=0:0 S J=$O(^XUTL("XQO",A,U,I,0,J)) Q:J'>0  S %XQX=$P(^(J),U,2) I $E(%XQX,1,$L(XQC1))=XQC1!(%XQX[XQC2) S L=1 Q
"RTN","XQ83R",26,0)
 I L S K=0 D D F J=0:0 S J=$O(^XUTL("XQO",A,U,I,0,J)) Q:J'>0  D D1
"RTN","XQ83R",27,0)
 I L I K=0 K ^XUTL("XQO",A,U,I)
"RTN","XQ83R",28,0)
 K L,K
"RTN","XQ83R",29,0)
 Q
"RTN","XQ83R",30,0)
 ;
"RTN","XQ83R",31,0)
A1 ;
"RTN","XQ83R",32,0)
 Q:$P(^DIC(19,XQOPI,0),U,3)'=""  D:'($D(^("U"))#2) UP S %XQX=^DIC(19,XQOPI,"U"),%XQX2=1 D A11
"RTN","XQ83R",33,0)
 S %XQX2=0 F M=0:0 S M=$O(^DIC(19,"AD",XQOPI,M)) Q:M'>0  S N=$O(^(M,0)) Q:N'>0  S %XQX=$S('($D(^DIC(19,M,10,N,0))#2):"",1:$P(^(0),U,2)) I %XQX'="" D A11
"RTN","XQ83R",34,0)
 Q
"RTN","XQ83R",35,0)
A11 ;
"RTN","XQ83R",36,0)
 S %XQY=%XQX F P=1:1 S %XQY=$O(^XUTL("XQO",A,%XQY)) Q:$P(%XQY,U,1)'=%XQX  Q:+$P(%XQY,U,2)'=(P-1)  I +^(%XQY)=XQOPI S P=0 Q
"RTN","XQ83R",37,0)
 I $P(%XQY,U,1)=%XQX S %XQY=$O(^XUTL("XQO",A,%XQY)) Q:$P(%XQY,U,1)'=%XQX  I +^(%XQY)=XQOPI S P=0 Q
"RTN","XQ83R",38,0)
 I P S ^XUTL("XQO",A,(%XQX_U_$S(P=1:"",1:P-1)))=XQOPI_U_%XQX2
"RTN","XQ83R",39,0)
 Q
"RTN","XQ83R",40,0)
 ;
"RTN","XQ83R",41,0)
D ;
"RTN","XQ83R",42,0)
 S XQA=$P(^XUTL("XQO",A,U,I),U,9) D GET Q:XQA=""  S ^XUTL("XQO",A,U,I)=U_$P(^DIC(19,I,0),U,1,2)_U_$S($P(^(0),U,3)]"":1,1:"")_U_$P(^(0),U,4)_U_XQA_U_XQK_U_$P(^(0),U,7,8)_U_XQP_U_XQE_U_$P(^(0),U,11,15)_U_XQF_U_$P(^(0),U,17,99),K=K+1
"RTN","XQ83R",43,0)
 Q
"RTN","XQ83R",44,0)
D1 ;
"RTN","XQ83R",45,0)
 S XQA=$P(^XUTL("XQO",A,U,I,0,J),U,2) D GET K ^XUTL("XQO",A,U,I,0,J) Q:XQA=""  I K>0 S ^(K)=XQA_U_XQK_U_XQP_U_XQE_U_XQF,K=K+1 Q
"RTN","XQ83R",46,0)
 S ^XUTL("XQO",A,U,I)=U_$P(^DIC(19,I,0),U,1,2)_U_$S($P(^(0),U,3)]"":1,1:"")_U_$P(^(0),U,4)_U_XQA_U_XQK_U_$P(^(0),U,7,8)_U_XQP_U_XQE_U_$P(^(0),U,11,15)_U_XQF_U_$P(^(0),U,17,99),K=K+1
"RTN","XQ83R",47,0)
 Q
"RTN","XQ83R",48,0)
 ;
"RTN","XQ83R",49,0)
GET ;
"RTN","XQ83R",50,0)
 S XQOOO="",(XQK,XQP,XQE,XQF)="" F M=1:1 S %XQA=$P(XQA,",",M) Q:%XQA'>0  D SUM
"RTN","XQ83R",51,0)
 S:XQOOO XQA="" K XQOOO
"RTN","XQ83R",52,0)
 Q
"RTN","XQ83R",53,0)
 ;
"RTN","XQ83R",54,0)
SUM ;
"RTN","XQ83R",55,0)
 S XQK1=$P(^DIC(19,%XQA,0),U,6),XQE1=$P(^(0),U,10),XQF1="" I $D(^(3)) S XQF1=$P(^(3),U)
"RTN","XQ83R",56,0)
 S XQK=$S(XQK'=""&(XQK1'=""):XQK_","_XQK1,1:XQK_XQK1),XQE=$S(XQE'=""&(XQE1'=""):XQE_","_XQE1,1:XQE_XQE1),XQF=$S(XQF'=""&(XQF1'=""):XQF_","_XQF1,1:XQF_XQF1)
"RTN","XQ83R",57,0)
 S XQOOO=$S($P(^DIC(19,%XQA,0),U,3)'="":1,1:XQOOO)
"RTN","XQ83R",58,0)
 S XQP1="" F I=0:0 S I=$O(^DIC(19,%XQA,3.91,I)) Q:I'>0  S XQP1=$S(XQP1'="":XQP1_";",1:"")_$P(^(I,0),U)_$P(^(0),U,2)
"RTN","XQ83R",59,0)
 S:XQP1="" XQP1=$P(^DIC(19,%XQA,0),U,9) S XQP=$S(XQP1'=""&(XQP'=""):XQP_";"_XQP1,1:XQP_XQP1)
"RTN","XQ83R",60,0)
 Q
"RTN","XQ83R",61,0)
 ;
"RTN","XQ83R",62,0)
UP S X=$P(^DIC(19,XQOPI,0),U,2) F Z=1:1 Q:X?.NUP  S W=$A(X,Z) I W<123,W>96 S X=$E(X,1,Z-1)_$C(W-32)_$E(X,Z+1,255)
"RTN","XQ83R",63,0)
 S X=$E(X,1,30),^DIC(19,XQOPI,"U")=X,^DIC(19,"C",X,XQOPI)=""
"RTN","XQ83R",64,0)
 Q
"RTN","XQ83R",65,0)
 ;
"RTN","XQ83R",66,0)
SYN ;
"RTN","XQ83R",67,0)
 S A="P" F S=0:0 S A=$O(^XUTL("XQO",A)) Q:$E(A)'="P"  D SYN1
"RTN","XQ83R",68,0)
 K A,S,T,XQSYN,XQNAM
"RTN","XQ83R",69,0)
 Q
"RTN","XQ83R",70,0)
SYN1 ;
"RTN","XQ83R",71,0)
 S XQNAM="",V=XQOPI_U_"0" F T=0:0 S XQNAM=$O(^XUTL("XQO",A,XQNAM)) Q:XQNAM=""!(XQNAM=U)  I ^(XQNAM)=V K ^(XQNAM)
"RTN","XQ83R",72,0)
 I $S('$D(^DIC(19,XQOPI,0)):1,$P(^(0),U,3)'="":1,1:0) S XQNAM="",V=XQOPI_U_"1" F T=0:0 S XQNAM=$O(^XUTL("XQO",A,XQNAM)) Q:XQNAM=""!(XQNAM=U)  I ^(XQNAM)=V K ^(XQNAM)
"RTN","XQ83R",73,0)
 Q:'$D(^DIC(19,XQOPI,0))  Q:$P(^DIC(19,XQOPI,0),U,3)'=""  F XQOPM=0:0 S XQOPM=$O(^DIC(19,"AD",XQOPI,XQOPM)) Q:XQOPM'>0  S XQ1=$O(^(XQOPM,0)) I $D(^DIC(19,XQOPM,10,XQ1,0)) S XQSYN=$P(^(0),U,2) I XQSYN'="" D SYN2
"RTN","XQ83R",74,0)
 Q
"RTN","XQ83R",75,0)
SYN2 ;
"RTN","XQ83R",76,0)
 Q:'$D(^XUTL("XQO",A,U,XQOPI))  S XQSYN2A=","_XQOPM_","_XQOPI_","
"RTN","XQ83R",77,0)
 S XQSYN2=$S($P(A,"P",2)=XQOPM:1,(","_$P(^XUTL("XQO",A,U,XQOPI),U,9))[XQSYN2A:1,1:0) F T=0:0 Q:XQSYN2  S T=$O(^XUTL("XQO",A,U,XQOPI,0,T)) Q:T'>0  I (","_$P(^(T),U,2))[XQSYN2A S XQSYN2=1
"RTN","XQ83R",78,0)
 K XQSYN2A I 'XQSYN2 K T,XQSYN2 Q
"RTN","XQ83R",79,0)
 S XQLAST=XQOPI,V=XQLAST_U_"0",XQSYNY=XQSYN D SYN3 K XQLAST,V,XQSYNY,XQSYN2
"RTN","XQ83R",80,0)
 Q
"RTN","XQ83R",81,0)
SYN3 S XQNAM=XQSYNY_"]]]]]]]]]]]" F XQ83RT=1:1 S XQNAM=$O(^XUTL("XQO",A,XQNAM)) Q:$P(XQNAM,U,1)'=XQSYNY  I +^(XQNAM)=+V S XQ83RT=0 Q
"RTN","XQ83R",82,0)
 Q:'XQ83RT  I XQ83RT=1 S ^XUTL("XQO",A,(XQSYNY_U))=V Q
"RTN","XQ83R",83,0)
 I XQ83RT>1,$D(^XUTL("XQO",A,XQSYNY_U)) S ^(XQSYNY_U_"1")=^(XQSYNY_U) K ^(XQSYNY_U)
"RTN","XQ83R",84,0)
 F XQ83RT=1:1 I '$D(^XUTL("XQO",A,(XQSYNY_U_XQ83RT))) S ^(XQSYNY_U_XQ83RT)=V Q
"RTN","XQ83R",85,0)
 K XQ83RT
"RTN","XQ83R",86,0)
 Q
"RTN","XQCHK")
0^4^B11152666
"RTN","XQCHK",1,0)
XQCHK ; SEA/MJM - Check security on option # XQCY ;04/15/96  16:00
"RTN","XQCHK",2,0)
 ;;8.0;KERNEL;**29**;Jul 10, 1995
"RTN","XQCHK",3,0)
 Q:'$D(XQCY)!(XQCY<1)  S:'$D(XQJMP) XQJMP=0
"RTN","XQCHK",4,0)
 I '$D(XQYO) S XQY0=^DIC(19,+XQCY,0)
"RTN","XQCHK",5,0)
 I '$D(XQCY0) S XQSAV=XQY0,XQY=XQCY D SET Q:XQCY<0  S XQCY0=XQY0,XQY0=XQSAV
"RTN","XQCHK",6,0)
CHK I XQCY0="" S XQCY=-1 G OUT
"RTN","XQCHK",7,0)
 I $P(XQCY0,U,3)'="" S XQCY=-1 G OUT
"RTN","XQCHK",8,0)
 I $L($P(XQCY0,U,6)) S %="" F %XQI=1:1 S %=$P($P(XQCY0,U,6),",",%XQI) Q:%=""  I '$D(^XUSEC(%,DUZ)) S XQCY=-2 G OUT
"RTN","XQCHK",9,0)
 I $L($P(XQCY0,U,16)) S %="" F %XQI=1:1 S %=$P($P(XQCY0,U,16),",",%XQI) Q:%=""  I $D(^XUSEC(%,DUZ)) S XQCY=-3 G OUT
"RTN","XQCHK",10,0)
 I $L($P(XQCY0,U,9)) S XQZ=$P(XQCY0,U,9) D ^XQDATE S X=% D XQO^XQ92 I X="" S XQCY=-4 G OUT
"RTN","XQCHK",11,0)
 G:$P(XQCY0,U,10)'["y" OUT
"RTN","XQCHK",12,0)
 S %=0 F %XQI=1:1 S %=$O(^DIC(19,XQCY,3.96,%,0)) Q:%=""  I IOS=% G OUT
"RTN","XQCHK",13,0)
 S XQCY=-5 G OUT
"RTN","XQCHK",14,0)
 Q
"RTN","XQCHK",15,0)
 ;
"RTN","XQCHK",16,0)
OUT K %,%XQI,XQCY0,%Y,XQZ
"RTN","XQCHK",17,0)
 Q
"RTN","XQCHK",18,0)
 ;
"RTN","XQCHK",19,0)
JMP ;Check all options in jump path in %XQJP returned as "" if not OK
"RTN","XQCHK",20,0)
 S XQJMP=1
"RTN","XQCHK",21,0)
 F %XQCI=1:1 S XQCY=$P(%XQJP,",",%XQCI) Q:XQCY=""  S XQCY0=$G(^XUTL("XQO",XQDIC,"^",XQCY)),XQCY0=$P(XQCY0,U,2,99) D CHK S:XQCY<0 %XQJP=""
"RTN","XQCHK",22,0)
 K %XQCI,XQCY,XQCY0
"RTN","XQCHK",23,0)
 Q
"RTN","XQCHK",24,0)
 ;
"RTN","XQCHK",25,0)
SET ;Produce the same XQY0 as SET1^XQ7 without the synonym
"RTN","XQCHK",26,0)
 I '$D(^DIC(19,+XQY,0)) S XQY=-1 Q
"RTN","XQCHK",27,0)
S1 Q:XQY'>0  S XQY0=^DIC(19,+XQY,0),XQY0=$P(XQY0,U,1,2)_U_$S($P(XQY0,U,3)]"":1,1:"")_U_$P(XQY0,U,4)_U_U_$P(XQY0,U,6,99)
"RTN","XQCHK",28,0)
 S %="" I $D(^DIC(19,+XQY,3.91)) F %XQI=0:0 S %XQI=$O(^DIC(19,+XQY,3.91,%XQI)) Q:%XQI=""!(%XQI'=+%XQI)  I ^(%XQI,0)]"" S %=$S(%'="":%_";",1:"")_$P(^(0),U,1)_$P(^(0),U,2)
"RTN","XQCHK",29,0)
 I %]"" S XQY0=$P(XQY0,U,1,8)_U_%_U_$P(XQY0,U,10,99)
"RTN","XQCHK",30,0)
 I $P(XQY0,U,16),$D(^DIC(19,XQY,3)) S %=$P(^(3),U) I %'="" S XQY0=$P(XQY0,U,1,15)_U_%_U_$P(XQY0,U,17,99)
"RTN","XQCHK",31,0)
 K %,%XQI
"RTN","XQCHK",32,0)
 Q
"RTN","XQCHK",33,0)
 ;
"RTN","XQCHK",34,0)
MES ;Messages for rejected options from a call to XQCHK
"RTN","XQCHK",35,0)
 W *7
"RTN","XQCHK",36,0)
 I XQCY=-1 W !!?5,"==> Sorry, ",$S($D(XQPRMN):"your Primary Menu",1:"this option")," is out of order with the message:",!?10,$P(^DIC(19,XQY,0),U,3)
"RTN","XQCHK",37,0)
 I XQCY=-2 W !!?5,"==> Sorry, ",$S($D(XQPRMN):"your Primary Menu",1:"this option")," is locked."
"RTN","XQCHK",38,0)
 I XQCY=-3 W !!?5,"==> Sorry, ",$S($D(XQPRMN):"your Primary Menu",1:"this option")," has a reverse lock on it."
"RTN","XQCHK",39,0)
 I XQCY=-4 W !!?5,"==> Sorry, ",$S($D(XQPRMN):"your Primary Menu",1:"this option")," not allowed right now."
"RTN","XQCHK",40,0)
 I XQCY=-5 W !!?5,"==> Sorry, ",$S($D(XQPRMN):"your Primary Menu",1:"this option")," not allowed on this device."
"RTN","XQCHK",41,0)
 Q
"RTN","XQCHK",42,0)
 ;
"RTN","XQCHK",43,0)
OP ;Find out what option or protocol is in charge right now
"RTN","XQCHK",44,0)
 ;Returns option or protocol name and text in XQOPT
"RTN","XQCHK",45,0)
 S U="^",%XQ=0
"RTN","XQCHK",46,0)
 I $D(XQORNOD) S %XQ=+XQORNOD,%XQ1=U_$P(XQORNOD,";",2),%XQ=@(%XQ1_%XQ_",0)"),XQOPT=$P(%XQ,U)_U_$P(%XQ,U,2)
"RTN","XQCHK",47,0)
 I '$D(XQORNOD) S %XQ=$S($D(XQY)#2:XQY,1:0) I %XQ S %XQ1=^DIC(19,+%XQ,0),XQOPT=$P(%XQ1,U)_U_$P(%XQ1,U,2)
"RTN","XQCHK",48,0)
 I '$D(XQOPT) S XQOPT="-1^Unknown"
"RTN","XQCHK",49,0)
 K %XQ,%XQ1
"RTN","XQCHK",50,0)
 Q
"RTN","XQOO")
0^7^B47252063
"RTN","XQOO",1,0)
XQOO ;SEATTLE/LUKE - Out Of Order, Man ;05/28/96  10:50
"RTN","XQOO",2,0)
 ;;8.0;KERNEL;**10,21,29**;Jul 03, 1995
"RTN","XQOO",3,0)
INIT(XQSET) ;Call for Out-of-order set creation, called by KIDS
"RTN","XQOO",4,0)
 ;
"RTN","XQOO",5,0)
 ;The variable XQSET should be null if this is the first pass
"RTN","XQOO",6,0)
 ;or if KIDS thinks the user wants a new set of options
"RTN","XQOO",7,0)
 ;
"RTN","XQOO",8,0)
 S XQINI="",XQK=0 ;XQINI used as a flag to see if it's KIDS calling
"RTN","XQOO",9,0)
 I XQSET]"" S:'$D(^XTMP("XQOO",XQSET,0)) XQSET="^"
"RTN","XQOO",10,0)
 I XQSET="^" G OUT
"RTN","XQOO",11,0)
 I XQSET]"" S XQMESS=$P(^XTMP("XQOO",XQSET,0),U) G ASK1
"RTN","XQOO",12,0)
 ;
"RTN","XQOO",13,0)
EN ;Entry point for Define Out Of Order Options Set option
"RTN","XQOO",14,0)
 S XQK=0,U="^",XQSET=U
"RTN","XQOO",15,0)
 ;
"RTN","XQOO",16,0)
NAME ;Get name for this option set
"RTN","XQOO",17,0)
 W !!,"Enter a short name for this set of options and or protocols: " R XQSET:DTIME S:'$T XQSET=U G:XQSET=U OUT
"RTN","XQOO",18,0)
 I XQSET="?" W !!,"Enter a name of 20 characters or less for this set, '^' to quit, or '??' for help" G NAME
"RTN","XQOO",19,0)
 I XQSET["??" S XQH="XQOO-NAME" D EN^XQH G NAME
"RTN","XQOO",20,0)
 I XQSET=""!($L(XQSET)>20) W !!,"Out-of-order sets must be named with 20 or less characters.  Enter '^' to quit." G NAME
"RTN","XQOO",21,0)
 I $D(^XTMP("XQOO",XQSET,0)) D  G:$D(DIRUT) OUT G:Y=0 NAME G ASK1
"RTN","XQOO",22,0)
 .S XQMESS=$P(^XTMP("XQOO",XQSET,0),U)
"RTN","XQOO",23,0)
 .W !!,"WARNING: The Out-of-order set '",XQSET,"' already exists.",!
"RTN","XQOO",24,0)
 .S DIR("A")="Do you want to modify it? (Y/N) " S DIR(0)="Y",DIR("B")="YES" D ^DIR K DIR
"RTN","XQOO",25,0)
 .Q
"RTN","XQOO",26,0)
 ;
"RTN","XQOO",27,0)
MESS ;Get the Out Of Order Message
"RTN","XQOO",28,0)
 R !!,"What should the Out Of Order message text be? :",XQMESS:DTIME S:'$T XQMESS=U G:XQMESS=U OUT
"RTN","XQOO",29,0)
 I XQMESS="?" W !!,"This is the message that will be shown with the options/protocols",!,"that are made out of order. For instance, ""Laboratory install in progress""" G MESS
"RTN","XQOO",30,0)
 I XQMESS["??" S XQH="XQOO-MESS" D EN^XQH G MESS
"RTN","XQOO",31,0)
 ;
"RTN","XQOO",32,0)
ASK1 S XQFIL=19
"RTN","XQOO",33,0)
ASK ;Get options to mark
"RTN","XQOO",34,0)
 S (XQ,XQN)=""
"RTN","XQOO",35,0)
 W !!,"Enter "_$S(XQFIL=19:"options",1:"protocols")_" you wish to mark as 'Out Of Order': "
"RTN","XQOO",36,0)
 R XQ:DTIME S:'$T XQ=U G:XQ=U OUT G:XQ="" SET
"RTN","XQOO",37,0)
 I XQ="?" D  G ASK
"RTN","XQOO",38,0)
 .W !!?5,"Enter "_$S(XQFIL=19:"an option",1:"a protocol")_" name,"
"RTN","XQOO",39,0)
 .W !?5,"a name preceded by a minus sign to remove "_$S(XQFIL=19:"an option,",1:"a protocol,")
"RTN","XQOO",40,0)
 .W !?5,$S(XQFIL=19:"'^PR'",1:"'^OP'")_" to switch to "_$S(XQFIL=19:"protocols,",1:"options,")
"RTN","XQOO",41,0)
 .W !?5,"an uparrow (that is '^') to quit,"
"RTN","XQOO",42,0)
 .W !?5,"or '??' for more help."
"RTN","XQOO",43,0)
 .Q
"RTN","XQOO",44,0)
 I XQ["??" S XQH="XQOO" D:XQ="??" EN^XQH D:XQ="???" LIST D:XQ="????" LSTFIL S XQH="XQOO-MAIN" D:XQ="?????" EN^XQH G ASK
"RTN","XQOO",45,0)
 I $E(XQ,1,3)="^OP"!($E(XQ,1,3)="^op") S XQFIL=19,XQSWTCH="" G ASK
"RTN","XQOO",46,0)
 I $E(XQ,1,3)="^PR"!($E(XQ,1,3)="^pr") S XQFIL=101,XQSWTCH="" G ASK
"RTN","XQOO",47,0)
 S XQDEL=0 I $E(XQ,1)="-" S XQDEL=1,XQ=$E(XQ,2,99)
"RTN","XQOO",48,0)
 I XQ="*",XQDEL K ^XTMP("XQOO",XQSET,XQFIL) W !," All "_$S(XQFIL=19:"options",1:"protocols")_" removed.  Start again or '^' to quit. " G ASK
"RTN","XQOO",49,0)
 I XQ="*" S XQSTART=1,XQEND="ZZZZZ" D FIND G ASK
"RTN","XQOO",50,0)
 I XQ?.E1"*" S XQSTART=$E(XQ,1,$L(XQ)-1),XQEND=XQSTART_$C(127) D FIND G ASK
"RTN","XQOO",51,0)
 ;Get a range of options allowing for name with hyphens in them
"RTN","XQOO",52,0)
 I XQ?1E.E1"-"1E.E S XQRNG=0 D  G:'XQRNG ASK
"RTN","XQOO",53,0)
 .S X=XQ,DIC=XQFIL,DIC(0)="Z" D ^DIC S:Y'<0 XQ=$P(Y,U,2) I Y>0 S XQRNG=1 Q
"RTN","XQOO",54,0)
 .W ! K DIR S DIR("A")="Do mean the "_$S(XQFIL=19:"options",1:"protocols")_" from "_$P(XQ,"-")_" to "_$P(XQ,"-",2)_"? (Y/N)",DIR(0)="YA" D ^DIR K DIR I Y S (XQN,XQSTART)=$P(XQ,"-",1),XQEND=$P(XQ,"-",2) D FIND
"RTN","XQOO",55,0)
 .Q
"RTN","XQOO",56,0)
 ;
"RTN","XQOO",57,0)
 I XQ'?1E.E1"-"1E.E S X=XQ,DIC=XQFIL,DIC(0)="MEZ" D ^DIC S:Y'<0 XQ=$P(Y,U,2) I Y<0 W !," ??",*7 G ASK
"RTN","XQOO",58,0)
 I XQDEL K ^XTMP("XQOO",XQSET,XQFIL,+Y) G ASK
"RTN","XQOO",59,0)
 S:$E(Y(0),1,4)'="XQOO" ^XTMP("XQOO",XQSET,XQFIL,+Y)=$P(Y(0),U)_U_$P(Y(0),U,2) G ASK
"RTN","XQOO",60,0)
 ;
"RTN","XQOO",61,0)
FIND ;Find first option in wildcard list
"RTN","XQOO",62,0)
 S XQN="" S:$L(XQSTART)>2 XQN=$E(XQSTART,1,$L(XQSTART)-1)
"RTN","XQOO",63,0)
 I XQFIL=19 F XQI=0:0 S XQN=$O(^DIC(XQFIL,"B",XQN)) Q:XQN=""!($E(XQN,1,$L(XQSTART))=XQSTART)
"RTN","XQOO",64,0)
 E  F XQI=0:0 S XQN=$O(^ORD(101,"B",XQN)) Q:XQN=""!($E(XQN,1,$L(XQSTART))=XQSTART)
"RTN","XQOO",65,0)
 I XQN="" W !," No such ",$S(XQFIL=19:"option(s).",1:"protocol(s).") Q
"RTN","XQOO",66,0)
 S XQSTART=XQN
"RTN","XQOO",67,0)
 ;
"RTN","XQOO",68,0)
FINDR I XQFIL=19 S XQON=$O(^DIC(XQFIL,"B",XQN,0)),XQON0=^DIC(XQFIL,+XQON,0)
"RTN","XQOO",69,0)
 E  S XQON=$O(^ORD(XQFIL,"B",XQN,0)),XQON0=^ORD(XQFIL,+XQON,0)
"RTN","XQOO",70,0)
 I XQDEL D DELET Q
"RTN","XQOO",71,0)
 ;
"RTN","XQOO",72,0)
GET ;Get the first option selected and put it in ^XTMP
"RTN","XQOO",73,0)
 S XQN=XQSTART I $E(XQON,1,4)'="XQOO" S ^XTMP("XQOO",XQSET,XQFIL,+XQON)=$P(XQON0,U)_U_$P(XQON0,U,2),XQK=XQK+1
"RTN","XQOO",74,0)
 S DIC=XQFIL,DIC(0)="MZ"
"RTN","XQOO",75,0)
 ;
"RTN","XQOO",76,0)
NEXT ;Find the rest of the options in this range and do likewise
"RTN","XQOO",77,0)
 I XQFIL=19 F  Q:XQN=XQEND  S XQN=$O(^DIC(XQFIL,"B",XQN)) Q:XQN=""!(XQN]XQEND)  S XQON=$O(^DIC(XQFIL,"B",XQN,0)),XQON0=^DIC(XQFIL,+XQON,0) I $E(XQON,1,4)'="XQOO" S ^XTMP("XQOO",XQSET,XQFIL,+XQON)=$P(XQON0,U)_U_$P(XQON0,U,2),XQK=XQK+1
"RTN","XQOO",78,0)
 E  F  Q:XQN=XQEND  S XQN=$O(^ORD(XQFIL,"B",XQN)) Q:XQN=""!(XQN]XQEND)  S XQON=$O(^ORD(XQFIL,"B",XQN,0)),XQON0=^ORD(XQFIL,+XQON,0) I $E(XQON,1,4)'="XQOO" S ^XTMP("XQOO",XQSET,XQFIL,+XQON)=$P(XQON0,U)_U_$P(XQON0,U,2),XQK=XQK+1
"RTN","XQOO",79,0)
 Q
"RTN","XQOO",80,0)
 ;
"RTN","XQOO",81,0)
DELET ;Delete option(s) from the list in ^XTMP
"RTN","XQOO",82,0)
 ;W !,XQON,"  ",XQSTART,"  ",XQDEL
"RTN","XQOO",83,0)
 S XQN=XQSTART,XQDEL=0
"RTN","XQOO",84,0)
 I XQFIL=19 F  K ^XTMP("XQOO",XQSET,XQFIL,+XQON) S XQN=$O(^DIC(XQFIL,"B",XQN)),XQX=XQK-1 Q:XQN=""!(XQN]XQEND)  S XQON=$O(^DIC(XQFIL,"B",XQN,0))
"RTN","XQOO",85,0)
 E  F  K ^XTMP("XQOO",XQSET,XQFIL,+XQON) S XQN=$O(^ORD(XQFIL,"B",XQN)),XQX=XQK-1 Q:XQN=""!(XQN]XQEND)  S XQON=$O(^ORD(XQFIL,"B",XQN,0))
"RTN","XQOO",86,0)
 Q
"RTN","XQOO",87,0)
 ;
"RTN","XQOO",88,0)
REMOV R !!,"Remove all options previously selected? ",XQ:DTIME S:'$T XQ=U G:XQ[U OUT I XQ["N"!(XQ["n") W !!,"OK, you may continue." G ASK
"RTN","XQOO",89,0)
 K ^XTMP("XQOO",XQSET)
"RTN","XQOO",90,0)
 Q
"RTN","XQOO",91,0)
LSTFIL ;Show Option File
"RTN","XQOO",92,0)
 N XQE,XQR,XQS
"RTN","XQOO",93,0)
 D RANGE^XQOO2(.XQS,.XQE,.XQR) I XQR D BXREF^XQOO2(XQS,XQE)
"RTN","XQOO",94,0)
 Q
"RTN","XQOO",95,0)
 ;
"RTN","XQOO",96,0)
LIST ;List users and options selected so far.
"RTN","XQOO",97,0)
 W @IOF S (XQT,XQM)=0
"RTN","XQOO",98,0)
 F XQFIL0=19,101 D
"RTN","XQOO",99,0)
 .S XQT=0,XQN=0,XQN=$O(^XTMP("XQOO",XQSET,XQFIL0,XQN)) I XQN="" W !!,"No "_$S(XQFIL0=19:"menu options",1:"protocols")_" selected yet" Q
"RTN","XQOO",100,0)
 .W !!,"You will place Out Of Order the following "_$S(XQFIL0=19:"options:",1:"protocols:"),! F XQI=0:0 D:$Y+3>IOSL WAIT Q:XQ=U  W !,$P(^XTMP("XQOO",XQSET,XQFIL0,XQN),U,2)_"   ["_$P(^(XQN),U)_"]   (IEN = "_XQN_")" S XQN=$O(^(XQN)) Q:XQN=""
"RTN","XQOO",101,0)
 .Q
"RTN","XQOO",102,0)
 Q
"RTN","XQOO",103,0)
 ;
"RTN","XQOO",104,0)
WAIT ;Skip to the head of the next page
"RTN","XQOO",105,0)
 I 1 S XQ="" R:IOST["C-" !!,"Press RETURN to continue, or '^' to quit.",XQ:DTIME S:'$T XQ=U W @IOF
"RTN","XQOO",106,0)
 Q
"RTN","XQOO",107,0)
 ;
"RTN","XQOO",108,0)
SET ;Set 0th node in ^XTMP global
"RTN","XQOO",109,0)
 I XQFIL=19,'$D(XQSWTCH) S XQFIL=101 G ASK
"RTN","XQOO",110,0)
 D ^XQDATE
"RTN","XQOO",111,0)
 I $D(^XTMP("XQOO",XQSET,0)) S XQMESS=$P(^(0),U)
"RTN","XQOO",112,0)
 S ^XTMP("XQOO",XQSET,0)=XQMESS_U_%Y_U_$P(^VA(200,DUZ,0),",")
"RTN","XQOO",113,0)
 S ^XTMP("XQOO",0)=DT_U_DT+7
"RTN","XQOO",114,0)
 ;
"RTN","XQOO",115,0)
OUT ;Clean up
"RTN","XQOO",116,0)
 ;
"RTN","XQOO",117,0)
 I '$D(XPDNM),'$D(^XTMP("XQOO",XQSET,0)),$D(^XTMP("XQOO",XQSET)) D
"RTN","XQOO",118,0)
 .;Temporary Fix: ^ at protocol prompt leaves partial set (no 0th node)
"RTN","XQOO",119,0)
 .S DIR(0)="Y",DIR("B")="Y"
"RTN","XQOO",120,0)
 .S DIR("A")="Delete this set of options? (Y/N) "
"RTN","XQOO",121,0)
 .D ^DIR
"RTN","XQOO",122,0)
 .I Y K ^XTMP("XQOO",XQSET)
"RTN","XQOO",123,0)
 .E  D ^XQDATE S ^XTMP("XQOO",XQSET,0)=XQMESS_U_%Y_U_$P(^VA(200,DUZ,0),","),^XTMP("XQOO",0)=DT_U_DT+7
"RTN","XQOO",124,0)
 .Q
"RTN","XQOO",125,0)
 ;
"RTN","XQOO",126,0)
 I '$D(XPDNM),$D(^XTMP("XQOO",XQSET,0)) D
"RTN","XQOO",127,0)
 .S DIR(0)="Y",DIR("B")="N"
"RTN","XQOO",128,0)
 .S DIR("A")="Should I mark these options/protocols out-of-order now? (Y/N) "
"RTN","XQOO",129,0)
 .D ^DIR I Y D OFF^XQOO1(XQSET)
"RTN","XQOO",130,0)
 .Q
"RTN","XQOO",131,0)
 ;
"RTN","XQOO",132,0)
 K %,%Y,XQ,XQDEL,XQEND,XQFIL,XQFIL0,XQI,XQINI,XQK,XQMESS,XQN,XQON,XQON0,XQRNG,XQSTART,XQSWTCH,Y
"RTN","XQOO",133,0)
 Q
"RTN","XQSMD1")
0^8^B23178412
"RTN","XQSMD1",1,0)
XQSMD1 ; SEA/MJM - Secure MenuMan Delegation (cont.); 5/18/88  2:16 PM ;05/08/96  10:45
"RTN","XQSMD1",2,0)
 ;;8.0;KERNEL;**29**;Jul 10, 1995
"RTN","XQSMD1",3,0)
 ;
"RTN","XQSMD1",4,0)
 S XQK=0
"RTN","XQSMD1",5,0)
GETOP ;Get options to add to (or remove from XQDOP) users.
"RTN","XQSMD1",6,0)
 W !!,"Enter options you wish to ",$S(XQDOP:"REMOVE FROM",1:"DELEGATE TO")," these users"
"RTN","XQSMD1",7,0)
ASK W !!,$S(XQDOP:"Remove",1:"Add")," option(s): " R XQ:DTIME S:'$T XQ=U G:XQ=U OUT G:XQ="" ^XQSMD2 I XQ="?" W !!,"Enter an option name, an option preceded by a minus, '^' to quit, or '??' for help." G ASK
"RTN","XQSMD1",8,0)
 I XQ["??" S XQH="XQSMD-OPTION" D:XQ="??" EN^XQH D:XQ="???" LIST D:XQ="????" LSTFIL S XQH="XQSMD-MAIN" D:XQ="?????" EN^XQH G ASK
"RTN","XQSMD1",9,0)
 S XQDEL=0 I $E(XQ,1)="-" S XQDEL=1,XQ=$E(XQ,2,99)
"RTN","XQSMD1",10,0)
 I XQ="*",XQDOP G REMOV
"RTN","XQSMD1",11,0)
 I XQ="*",'XQDEL S XQSTART=1,XQEND="ZZZZZ" D FIND G ASK
"RTN","XQSMD1",12,0)
 I XQ="*",XQDEL K ^TMP($J,"OP"),^TMP($J,"ZN") W !," All options removed.  Start again or '^' to quit. " G ASK
"RTN","XQSMD1",13,0)
 I XQ?.E1"*" S XQSTART=$E(XQ,1,$L(XQ)-1),XQEND=XQSTART_$C(127) D FIND G ASK
"RTN","XQSMD1",14,0)
 ;
"RTN","XQSMD1",15,0)
 ;Get a range of options allowing for name with hyphens in them
"RTN","XQSMD1",16,0)
 I XQ?1E.E1"-"1E.E S XQRNG=0 D  G:'XQRNG ASK
"RTN","XQSMD1",17,0)
 .S X=XQ,DIC=19,DIC(0)="MEZ" D ^DIC S:Y'<0 XQ=$P(Y,U,2) I Y>0 S XQRNG=1 Q
"RTN","XQSMD1",18,0)
 .W ! S DIR("A")="Do mean the options from "_$P(XQ,"-")_" to "_$P(XQ,"-",2)_"?	(Y/N)",DIR("B")="YES",DIR(0)="Y" D ^DIR I Y S (XQN,XQSTART)=$P(XQ,"-",1),XQEND=$P(XQ,"-",2) D FIND
"RTN","XQSMD1",19,0)
  .Q
"RTN","XQSMD1",20,0)
  ;
"RTN","XQSMD1",21,0)
  I XQ'?1E.E1"-"1E.E S X=XQ,DIC=19,DIC(0)="MEZ" D ^DIC S:Y'<0 XQ=$P(Y,U,2) I Y<0 W !," ??",*7 G ASK
"RTN","XQSMD1",22,0)
 ;I XQ?1E.E1"-"1E.E W !?10,"Do mean the options from ",$P(XQ,"-")," to ",$P(XQ,"-",2) S DIR(0)="Y" D ^DIR I Y S XQSTART=$P(XQ,"-",1),XQEND=$P(XQ,"-",2) D FIND G ASK
"RTN","XQSMD1",23,0)
 S X=XQ,DIC=19,DIC(0)="MEZ" D ^DIC S:Y'<0 XQ=$P(Y,U,2) I Y<0 W !," ??",*7 G ASK
"RTN","XQSMD1",24,0)
 I 'XQDEL,$P(Y(0),U,13)["n" W !,*7,"This option is not delegable." G ASK
"RTN","XQSMD1",25,0)
 I XQDEL K ^TMP($J,"OP",+Y),^TMP($J,"ZN",XQ) G ASK
"RTN","XQSMD1",26,0)
 S ^TMP($J,"OP",+Y)="",^TMP($J,"ZN",XQ)=$P(Y(0),U,2,99) G ASK
"RTN","XQSMD1",27,0)
 ;
"RTN","XQSMD1",28,0)
FIND ;Find first routine in wildcard list
"RTN","XQSMD1",29,0)
 S XQN="" S:$L(XQSTART)>2 XQN=$E(XQSTART,1,$L(XQSTART)-1) F XQI=0:0 S XQN=$O(^DIC(19,"B",XQN)) Q:XQN=""!($E(XQN,1,$L(XQSTART))=XQSTART)
"RTN","XQSMD1",30,0)
 I XQN="" W !," No such options." G ASK
"RTN","XQSMD1",31,0)
FINDR S XQSTART=XQN,XQON=$O(^DIC(19,"B",XQN,0)),XQON0=^DIC(19,+XQON,0)
"RTN","XQSMD1",32,0)
 I XQDEL D DELET Q
"RTN","XQSMD1",33,0)
 ;
"RTN","XQSMD1",34,0)
GET ;Get the options selected and put them in ^UTILITY.
"RTN","XQSMD1",35,0)
 S XQN=XQSTART S:$P(XQON0,U,13)'["n" ^TMP($J,"OP",+XQON)="",^TMP($J,"ZN",XQN)=$P(XQON0,U,2,99),XQK=XQK+1 S DIC=19,DIC(0)="MZ"
"RTN","XQSMD1",36,0)
NEXT F XQI=0:0 Q:XQN=XQEND  S XQN=$O(^DIC(19,"B",XQN)) Q:XQN=""!(XQN]XQEND)  S XQON=$O(^DIC(19,"B",XQN,0)),XQON0=^DIC(19,+XQON,0) I $P(XQON0,U,13)'["n" S ^TMP($J,"OP",+XQON)="",^TMP($J,"ZN",XQN)=$P(XQON0,U,2,99),XQK=XQK+1
"RTN","XQSMD1",37,0)
 Q
"RTN","XQSMD1",38,0)
 ;
"RTN","XQSMD1",39,0)
DELET S XQN=XQSTART,XQDEL=0 F XQI=0:0 K ^TMP($J,"OP",+XQON),^TMP($J,"ZN",XQN) S XQN=$O(^DIC(19,"B",XQN)),XQX=XQK-1 Q:XQN=""!(XQN]XQEND)  S XQON=$O(^DIC(19,"B",XQN,0))
"RTN","XQSMD1",40,0)
 Q
"RTN","XQSMD1",41,0)
 ;
"RTN","XQSMD1",42,0)
REMOV R !!,"Remove all options previously delegated to all users in your list? ",XQ:DTIME S:'$T XQ=U G:XQ[U OUT I XQ["N"!(XQ["n") W !!,"OK, you may continue building a list of options to remove." G ASK
"RTN","XQSMD1",43,0)
 I XQ'["Y"&(XQ'["y") W !!,"Please answer 'Y' or 'N'" G REMOV
"RTN","XQSMD1",44,0)
 S ZTRTN="DELM^XQSMD31",ZTDTH=$H,ZTIO="",ZTDESC="Remove previously delegated options.",ZTSAVE("XQHOLD(")="" D ^%ZTLOAD
"RTN","XQSMD1",45,0)
 W !!,"Your request has been queued, task # ",ZTSK G OUT
"RTN","XQSMD1",46,0)
 Q
"RTN","XQSMD1",47,0)
LSTFIL ;Show USER, OPTION, or user's delegated options in ^VA(200,DUZ,19.5)
"RTN","XQSMD1",48,0)
 D LIST S X="?",DIC=$S(XQUF:3,XQPRO:19,1:"^VA(200,DUZ,19.5,"),DIC(0)="Q" D ^DIC K DIC
"RTN","XQSMD1",49,0)
 Q
"RTN","XQSMD1",50,0)
 ;
"RTN","XQSMD1",51,0)
LIST ;List users and options selected so far.
"RTN","XQSMD1",52,0)
 W @IOF S (XQT,XQM)=0,XQM=$O(XQHOLD(XQM)) I XQM="" W !!," No users selected yet." Q
"RTN","XQSMD1",53,0)
 W !!,"For the following user(s):",!
"RTN","XQSMD1",54,0)
 F XQI=1:1 W:'(XQT#2) ! W ?(XQT#2*35),XQI,". ",XQHOLD(XQM) S XQT=XQT+1,XQM=$O(XQHOLD(XQM)) Q:XQM=""
"RTN","XQSMD1",55,0)
 W !!,"You will ",$S(XQDOP:"remove ",1:"delegate "),"the following options: ",!
"RTN","XQSMD1",56,0)
 S XQT=0,XQN="",XQN=$O(^TMP($J,"ZN",XQN)) I XQN="" W !!,"No menu options selected yet" Q
"RTN","XQSMD1",57,0)
 F XQI=0:0 D:$Y+3>IOSL WAIT Q:XQ=U  W !,XQN,"   ",$P(^TMP($J,"ZN",XQN),U,1) S XQN=$O(^(XQN)) Q:XQN=""
"RTN","XQSMD1",58,0)
 W !!,$S(XQDOP:" Removed ",1:" Delegated "),"by ",XQMGR," on ",XQDATE,".",!
"RTN","XQSMD1",59,0)
 Q
"RTN","XQSMD1",60,0)
 ;
"RTN","XQSMD1",61,0)
WAIT ;Skip to the head of the next page
"RTN","XQSMD1",62,0)
 I 1 S XQ="" R:IOST["C-" !!,"Press RETURN to continue, or '^' to quit.",XQ:DTIME S:'$T XQ=U W @IOF
"RTN","XQSMD1",63,0)
 Q
"RTN","XQSMD1",64,0)
 ;
"RTN","XQSMD1",65,0)
OUT K DIC,DIC(0),POP,XQ,XQAL,XQH,XQI,XQJ,XQK,XQL,XQM,XQN,XQT,XQD,XQDATE,XQDEL,XQDUZ,XQDT,XQLEV,XQLK,XQMG,XQMGR,XQNM,XQNAM,XQUF,XQPRO,XQRNG,XQSTART,XQEND,XQHOLD,XQKEY,XQON,XQON0,X,Y,XY,%,^TMP($J),ZTSK
"RTN","XQSMD1",66,0)
 Q
"RTN","XQT")
0^5^B26090607
"RTN","XQT",1,0)
XQT ;SEA/MJM - Menu template loader ;04/30/96  14:45
"RTN","XQT",2,0)
 ;;8.0;KERNEL;**20,29**;Jul 10, 1995
"RTN","XQT",3,0)
 ;
"RTN","XQT",4,0)
 ;Entry from XQ
"RTN","XQT",5,0)
 S XQSV=XQY_U_XQDIC_U_XQY0,(XQU,XQUR)=$P(XQUR,"[",2)
"RTN","XQT",6,0)
 I XQUR["?" D:XQUR["??" SHO^XQT4 W !!?5,"See 'Menu Templates' options for more information." G OUT
"RTN","XQT",7,0)
 I XQUR=" ",$D(^DISV(DUZ,"XQT")) S XQUR=^("XQT"),XQU=""
"RTN","XQT",8,0)
 D FIND G:XQK OUT D LOD I XQY<0 G OUT
"RTN","XQT",9,0)
 S ^XUTL("XQ",$J,"S")=XQSV,^DISV(DUZ,"XQT")=XQUR W:XQU'=-1 $E(XQUR,$L(XQU)+1,99)
"RTN","XQT",10,0)
 K %,XQ,XQBLD,XQFL,XQI,XQJ,XQK,XQL,XQM,XQMA,XQMN,XQN,XQNO1,XQSIB,XQSV,XQTL,XQTU,XQU
"RTN","XQT",11,0)
 G ^XQT1 ; Template is loaded and checked
"RTN","XQT",12,0)
 ;
"RTN","XQT",13,0)
FIND ;Find the template requested
"RTN","XQT",14,0)
 S XQK=0,XQN="",XQJ=1,(XQM,XQMA)=^XUTL("XQ",$J,"XQM")
"RTN","XQT",15,0)
 I XQUR'?.ANP W *7,"  ??" S XQK=1 Q
"RTN","XQT",16,0)
 S XQX=XQUR I XQUR'?.PUN F XQI=1:1 Q:XQX?.NUP  S XQN=$A(XQX,XQI) I XQN<123,XQN>96 S XQX=$E(XQX,1,XQI-1)_$C(XQN-32)_$E(XQX,XQI+1,255)
"RTN","XQT",17,0)
 S XQUR=XQX
"RTN","XQT",18,0)
 F XQI=0:0 S XQN=$O(^VA(200,DUZ,19.8,"B",XQN)) Q:XQN=""  S:XQUR=$E(XQN,1,$L(XQUR)) XQ(XQJ)=XQN,XQJ=XQJ+1
"RTN","XQT",19,0)
 I XQJ=1 W " ??",*7 S XQK=1 Q
"RTN","XQT",20,0)
 I XQJ=2 S XQUR=XQ(1) Q
"RTN","XQT",21,0)
 I XQJ>2 S XQK=0 D CHS
"RTN","XQT",22,0)
 Q
"RTN","XQT",23,0)
 ;
"RTN","XQT",24,0)
LOD ;Load the template into the ^XUTL("XQT").
"RTN","XQT",25,0)
 ;I $D(^XUTL("XQT",$J,XQUR,0))#2 S ^("T")=1 Q
"RTN","XQT",26,0)
 S XQN=$O(^VA(200,DUZ,19.8,"B",XQUR,0)) I XQN="" W " ??",*7 G OUT
"RTN","XQT",27,0)
 W:'$D(ZTQUEUED) !!,"Loading ",XQUR,"..."
"RTN","XQT",28,0)
 S ^XUTL("XQT",$J,XQUR,0)=DT,(XQEA,XQFL,XQTU)=0
"RTN","XQT",29,0)
 S XQJ=$P(^VA(200,DUZ,19.8,XQN,1,0),U,3),XQY=XQM,XQL=1
"RTN","XQT",30,0)
 D NO1^XQT5 Q:XQY'>0
"RTN","XQT",31,0)
 F XQI=1:1:XQJ Q:XQY=-1  S XQTL=^VA(200,DUZ,19.8,XQN,1,XQI,0) F XQK=1:1 D:'XQFL RPT S XQ=$P(XQTL,U,XQK) Q:XQ=""  S XQY=+XQ,XQDIC=$P(XQ,",",2),XQEA=$P(XQ,",",3) D CHK S XQMA=XQY Q:XQY=-1  D OK Q:XQY=-1
"RTN","XQT",32,0)
 I XQY=-1 K ^XUTL("XQT",$J,XQUR)
"RTN","XQT",33,0)
 Q
"RTN","XQT",34,0)
 ;
"RTN","XQT",35,0)
SET ;Build the ^XUTL("XQO",+XQDIC [ or "U"_DUZ]) nodes if need be
"RTN","XQT",36,0)
 L +^XUTL("XQO",XQDIC):5 D:$S('$D(^XUTL("XQO",XQDIC,0)):1,'$D(^DIC(19,XQDIC,99)):1,1:^DIC(19,XQDIC,99)'=$P(^XUTL("XQO",XQDIC,0),U,2)) ^XQSET L -^XUTL("XQO",XQDIC)
"RTN","XQT",37,0)
 Q
"RTN","XQT",38,0)
 ;
"RTN","XQT",39,0)
SETU ;Build the ^XUTL("XQO","U"_DUZ) nodes if need be
"RTN","XQT",40,0)
 D:$S('$D(^XUTL("XQO","U"_DUZ)):1,'$D(^VA(200,DUZ,203.1)):1,1:^VA(200,DUZ,203.1)'=$P(^XUTL("XQO","U"_DUZ,0),U,2)) ^XQSET
"RTN","XQT",41,0)
 Q
"RTN","XQT",42,0)
 ;
"RTN","XQT",43,0)
CHK ;Make sure it's OK to use this option
"RTN","XQT",44,0)
 I $D(^XUTL("XQO","P"_XQM,U,XQY))!(XQM=XQY) Q
"RTN","XQT",45,0)
 I $D(^XUTL("XQO","PXU",U,XQY)) Q
"RTN","XQT",46,0)
 I '$D(XQBLD) N XQDIC S XQDIC="U"_DUZ D SETU S XQBLD=""
"RTN","XQT",47,0)
 I $D(^XUTL("XQO","U"_DUZ,U,+XQY)) Q
"RTN","XQT",48,0)
 S (%,XQTU)=0 F XQII=1:1 Q:XQTU  S %=$O(^VA(200,DUZ,203,%,0)) Q:%'>0  S:$D(^XUTL("XQO","P"_%,U,XQY)) XQTU=1
"RTN","XQT",49,0)
 Q:XQTU=1
"RTN","XQT",50,0)
 D SET Q:$D(^XUTL("XQO",XQDIC,U,XQY))
"RTN","XQT",51,0)
 I '$D(^DIC(19,XQY,0))#2 W !!,"The Option File has been changed. This template will no longer work.",!?5,"'",XQUR,"' should be deleated and/or rebuilt." S XQY=-1 Q
"RTN","XQT",52,0)
 W !!,"Sorry, the option '",$P(^DIC(19,XQY,0),U,2),"'",!,?5,"is no longer available to you." S XQY=-1
"RTN","XQT",53,0)
 Q
"RTN","XQT",54,0)
 ;
"RTN","XQT",55,0)
OK ;See if it's locked, etc.
"RTN","XQT",56,0)
 I XQY=XQDIC D S1^XQCHK I 1
"RTN","XQT",57,0)
 E  L +^XUTL("XQO",XQDIC):5 D:$S('$D(^XUTL("XQO",XQDIC,0)):1,'$D(^DIC(19,XQDIC,99)):1,1:^DIC(19,XQDIC,99)'=$P(^XUTL("XQO",XQDIC,0),U,2)) ^XQSET L -^XUTL("XQO",XQDIC)
"RTN","XQT",58,0)
 S %=$G(^XUTL("XQO",XQDIC,U,+XQY)) I %="",XQY'=XQDIC W !!,"Because of changes to the Option File an option is no longer available." S XQY=-1 Q
"RTN","XQT",59,0)
 S XQY0=$S(XQY=XQDIC:XQY0,1:$P(%,U,2,99))
"RTN","XQT",60,0)
 I $L($P(XQY0,U,3)) W !!,"Option '",$P(XQY0,U,2),"'",!,?5,"is out of order.  The message is: ",$P(XQY0,U,3) S XQY=-1 Q
"RTN","XQT",61,0)
 I $L($P(XQY0,U,6)),'$D(^XUSEC($P(XQY0,U,6),DUZ)) W !!,"Option '",$P(XQY0,U,2),!,?5,"is locked.  You don't own the key." S XQY=-1 Q
"RTN","XQT",62,0)
 I $L($P(XQY0,U,9)) D ^XQDATE S X=% D ^XQ92 I X="" W !!,"Option '",$P(XQY0,U,2),"'",!,?5,"is not permitted to run right now.  Sorry." S XQY=-1 Q
"RTN","XQT",63,0)
 I $P(XQY0,U,10)["y",'$D(^DIC(19,XQY,3.96,"B",ION)) W !!,"Option '",$P(XQY0,U,2),!,?5,"is restricted to run only only certain terminals.  You're not on one.  Sorry." S XQY=-1 Q
"RTN","XQT",64,0)
 S ^XUTL("XQT",$J,XQUR,XQL)=XQY_U_XQDIC_U_XQY0
"RTN","XQT",65,0)
 I $P(XQY0,U,17),$D(^DIC(19,XQY,26)),$L(^(26)) S ^XUTL("XQT",$J,XQUR,XQL,"H")=^DIC(19,XQY,26)
"RTN","XQT",66,0)
 I $P(XQY0,U,14),XQEA["E",$D(^DIC(19,XQY,20)),$L(^(20)) S ^XUTL("XQT",$J,XQUR,XQL,"E")=^DIC(19,XQY,20)
"RTN","XQT",67,0)
 I $P(XQY0,U,15),XQEA["X",$D(^DIC(19,XQY,15)),$L(^(15)) S ^XUTL("XQT",$J,XQUR,XQL,"X")=^DIC(19,XQY,15)
"RTN","XQT",68,0)
 S XQL=XQL+1
"RTN","XQT",69,0)
 Q
"RTN","XQT",70,0)
 ;
"RTN","XQT",71,0)
CHS ;Choose the template from those that match
"RTN","XQT",72,0)
 S XQK=1,XQU=-1 W !!,"Chose by number from: ",! F XQI=1:1:XQJ-1 W !,?5,XQI,".  ",XQ(XQI)
"RTN","XQT",73,0)
 W !!,"Enter a number between 1 and ",XQJ-1," or '^' to quit: " R %:DTIME S:'$T %=U S:%="" %=U Q:%=U  G:(%'?.N)!(%>XQJ)!(%="") CHS S XQUR=XQ(%),XQK=0
"RTN","XQT",74,0)
 Q
"RTN","XQT",75,0)
 ;
"RTN","XQT",76,0)
RPT ;Set the 'repeat' flag in ^XUTL and strip it off list of options
"RTN","XQT",77,0)
 S XQFL=1,^XUTL("XQT",$J,XQUR,"RPT")=$P(XQTL,U,1),XQTL=$P(XQTL,U,2,99)
"RTN","XQT",78,0)
 Q
"RTN","XQT",79,0)
OUT ;
"RTN","XQT",80,0)
 S XQY=+XQSV,XQDIC=$P(XQSV,U,2),XQY0=$P(XQSV,U,3,99)
"RTN","XQT",81,0)
 K %,XQ,XQBLD,XQEX,XQI,XQJ,XQK,XQL,XQM,XQN,XQN1,XQSV,XQTU
"RTN","XQT",82,0)
 G NOFIND^XQ
"RTN","XQT",83,0)
 Q
"VER")
8.0^21.0
**END**
**END**
