Released PRCN*1*15 SEQ #14
Extracted from mail message
**KIDS**:PRCN*1.0*15^

**INSTALL NAME**
PRCN*1.0*15
"BLD",5229,0)
PRCN*1.0*15^EQUIPMENT/TURN-IN REQUIEST^0^3040401^y
"BLD",5229,1,0)
^^1^1^3040217^
"BLD",5229,1,1,0)
There are several menu options that are not working as advertised.
"BLD",5229,4,0)
^9.64PA^^
"BLD",5229,"INID")
n
"BLD",5229,"KRN",0)
^9.67PA^8989.52^19
"BLD",5229,"KRN",.4,0)
.4
"BLD",5229,"KRN",.401,0)
.401
"BLD",5229,"KRN",.402,0)
.402
"BLD",5229,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",5229,"KRN",.402,"NM",1,0)
PRCNTIPPM    FILE #413.1^413.1^0
"BLD",5229,"KRN",.402,"NM",2,0)
PRCNTICMR    FILE #413.1^413.1^0
"BLD",5229,"KRN",.402,"NM","B","PRCNTICMR    FILE #413.1",2)

"BLD",5229,"KRN",.402,"NM","B","PRCNTIPPM    FILE #413.1",1)

"BLD",5229,"KRN",.403,0)
.403
"BLD",5229,"KRN",.5,0)
.5
"BLD",5229,"KRN",.84,0)
.84
"BLD",5229,"KRN",3.6,0)
3.6
"BLD",5229,"KRN",3.8,0)
3.8
"BLD",5229,"KRN",9.2,0)
9.2
"BLD",5229,"KRN",9.8,0)
9.8
"BLD",5229,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5229,"KRN",9.8,"NM",1,0)
PRCNTICM^^0^B3153364
"BLD",5229,"KRN",9.8,"NM",2,0)
PRCNTIPP^^0^B10071720
"BLD",5229,"KRN",9.8,"NM",3,0)
PRCNFAP^^0^B2357788
"BLD",5229,"KRN",9.8,"NM",4,0)
PRCNUTL^^0^B12930600
"BLD",5229,"KRN",9.8,"NM","B","PRCNFAP",3)

"BLD",5229,"KRN",9.8,"NM","B","PRCNTICM",1)

"BLD",5229,"KRN",9.8,"NM","B","PRCNTIPP",2)

"BLD",5229,"KRN",9.8,"NM","B","PRCNUTL",4)

"BLD",5229,"KRN",19,0)
19
"BLD",5229,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",5229,"KRN",19,"NM",1,0)
PRCN TURN CMR APP^^0
"BLD",5229,"KRN",19,"NM",2,0)
PRCN TURN DISP^^0
"BLD",5229,"KRN",19,"NM","B","PRCN TURN CMR APP",1)

"BLD",5229,"KRN",19,"NM","B","PRCN TURN DISP",2)

"BLD",5229,"KRN",19.1,0)
19.1
"BLD",5229,"KRN",101,0)
101
"BLD",5229,"KRN",409.61,0)
409.61
"BLD",5229,"KRN",771,0)
771
"BLD",5229,"KRN",870,0)
870
"BLD",5229,"KRN",8989.51,0)
8989.51
"BLD",5229,"KRN",8989.52,0)
8989.52
"BLD",5229,"KRN",8994,0)
8994
"BLD",5229,"KRN","B",.4,.4)

"BLD",5229,"KRN","B",.401,.401)

"BLD",5229,"KRN","B",.402,.402)

"BLD",5229,"KRN","B",.403,.403)

"BLD",5229,"KRN","B",.5,.5)

"BLD",5229,"KRN","B",.84,.84)

"BLD",5229,"KRN","B",3.6,3.6)

"BLD",5229,"KRN","B",3.8,3.8)

"BLD",5229,"KRN","B",9.2,9.2)

"BLD",5229,"KRN","B",9.8,9.8)

"BLD",5229,"KRN","B",19,19)

"BLD",5229,"KRN","B",19.1,19.1)

"BLD",5229,"KRN","B",101,101)

"BLD",5229,"KRN","B",409.61,409.61)

"BLD",5229,"KRN","B",771,771)

"BLD",5229,"KRN","B",870,870)

"BLD",5229,"KRN","B",8989.51,8989.51)

"BLD",5229,"KRN","B",8989.52,8989.52)

"BLD",5229,"KRN","B",8994,8994)

"BLD",5229,"PRE")
PRCNP14E
"BLD",5229,"QUES",0)
^9.62^^
"BLD",5229,"REQB",0)
^9.611^1^1
"BLD",5229,"REQB",1,0)
PRCN*1.0*14^2
"BLD",5229,"REQB","B","PRCN*1.0*14",1)

"KRN",.402,2053,-1)
0^2
"KRN",.402,2053,0)
PRCNTICMR^3040219.0954^^413.1^^^3040219
"KRN",.402,2053,"DR",1,413.1)
9;I $E(X,1)="Y" S Y="@2";D ES^PRCNUTL;I $G(FAIL)<1 K FAIL S Y="";@1;11;I '$D(^PRCN(413.1,DA,2)) W $C(7)," ?? An explanation of why this request was not approved is required" W !! S Y="@1";6////^S X=4;7////^S X=DT;S Y="";@2;
"KRN",.402,2053,"DR",1,413.1,1)
D ES^PRCNUTL;I $G(FAIL)<1 K FAIL S Y="";6////^S X=6;7////^S X=DT;
"KRN",.402,2692,-1)
0^1
"KRN",.402,2692,0)
PRCNTIPPM^3031229.12^@^413.1^^@^3040401
"KRN",.402,2692,"DIAB",2,1,413.11,0)
.01:
"KRN",.402,2692,"DR",1,413.1)
@3;20;S:'POP Y="@2";D CHECK^PRCNUTL;S:'POP Y="@3";D ES^PRCNUTL;I $G(FAIL)<1 K FAIL S Y="",POP=0;6////^S X=24;7////^S X=DT;@2;
"KRN",.402,2692,"DR",2,413.11)
D PRT^PRCNTIPP;^6914^ENG(6914,^^S I(1,0)=D1 S I(0,0)=D0 S Y(1)=$S($D(^PRCN(413.1,D0,"1",D1,0)):^(0),1:"") S X=$P(Y(1),U,1),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,2692,"DR",3,6914)
S:X="" Y="@1";20////^S X=4;22////^S X=DT;31;S:X="" Y="@1",POP=0 S:X'="" POP=1;32;19///^S X="@";38///^S X="@";@1;
"KRN",19,6996,-1)
0^1
"KRN",19,6996,0)
PRCN TURN CMR APP^Approve Equipment Turn-In Request (CMR)^^R^^PRCNCMR^^^^^^EQUIPMENT/TURN-IN REQUIEST
"KRN",19,6996,1,0)
^19.06^2^2^3040219^^^^
"KRN",19,6996,1,1,0)
This option is for the CMR Responsible Official to approve the 
"KRN",19,6996,1,2,0)
equipment turn-in request.
"KRN",19,6996,15)

"KRN",19,6996,20)

"KRN",19,6996,25)
PRCNTICM
"KRN",19,6996,99.1)
55830,59618
"KRN",19,6996,"U")
APPROVE EQUIPMENT TURN-IN REQU
"KRN",19,6997,-1)
0^2
"KRN",19,6997,0)
PRCN TURN DISP^Final Turn-In Request Disposition (PPM)^^R^^^^^^^^EQUIPMENT/TURN-IN REQUIEST^^1
"KRN",19,6997,1,0)
^19.06^2^2^3040108^^^^
"KRN",19,6997,1,1,0)
This option is for the PPM to finalize and complete equipment turn-
"KRN",19,6997,1,2,0)
in requests.
"KRN",19,6997,15)

"KRN",19,6997,20)
S PRCNUSR=2
"KRN",19,6997,25)
SELECT^PRCNTIPP
"KRN",19,6997,"U")
FINAL TURN-IN REQUEST DISPOSIT
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",461,-1)
1^1
"PKG",461,0)
EQUIPMENT/TURN-IN REQUIEST^PRCN^EQUIPMENT/TURN-IN REQUEST
"PKG",461,20,0)
^9.402P^^
"PKG",461,22,0)
^9.49I^1^1
"PKG",461,22,1,0)
1.0^^2970528^68
"PKG",461,22,1,"PAH",1,0)
15^3040401
"PKG",461,22,1,"PAH",1,1,0)
^^1^1^3040401
"PKG",461,22,1,"PAH",1,1,1,0)
There are several menu options that are not working as advertised.
"PRE")
PRCNP14E
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PRCNFAP")
0^3^B2357788
"RTN","PRCNFAP",1,0)
PRCNFAP ;SSI/ALA-Check for NX Capitalization (FAP) ;[ 02/19/97  11:33 AM ]
"RTN","PRCNFAP",2,0)
 ;;1.0;PRCN;**2,3,15**;Sep 13, 1996
"RTN","PRCNFAP",3,0)
FAC ;  Check for FA completion
"RTN","PRCNFAP",4,0)
 S TDA=0,STAT=23,CKA=1
"RTN","PRCNFAP",5,0)
 F  S TDA=$O(^PRCN(413.1,"AC",43,TDA)) Q:TDA=""  D CK
"RTN","PRCNFAP",6,0)
 G EXIT
"RTN","PRCNFAP",7,0)
CK S STDT=$P(^PRCN(413.1,TDA,0),U,8)
"RTN","PRCNFAP",8,0)
 K OLDVALUE  ; PRCN*1.0*15
"RTN","PRCNFAP",9,0)
 S (N,SFL)=0 F  S N=$O(^PRCN(413.1,TDA,1,N)) Q:'N  D
"RTN","PRCNFAP",10,0)
 . S PRCNTI=$P(^PRCN(413.1,TDA,1,N,0),U)
"RTN","PRCNFAP",11,0)
 . D:PRCNFLAG OVAL  ; PRCN*1.0*15 get original CMR and SGL values
"RTN","PRCNFAP",12,0)
 . S PRCNFDA=$$CHKFA^ENFAUTL(PRCNTI)
"RTN","PRCNFAP",13,0)
 . I $G(CKA)=1 D CKA Q
"RTN","PRCNFAP",14,0)
 . I $G(CKD)=1 D CKD
"RTN","PRCNFAP",15,0)
 I SFL S DR="6////^S X=STAT;7////^S X=DT",(DIC,DIE)=413.1,DA=TDA D ^DIE
"RTN","PRCNFAP",16,0)
 Q
"RTN","PRCNFAP",17,0)
EXIT K STAT,STDT,N,PRCNTI,PRCNFDA,CKA,CKD,DIC,DIE,DA,DR
"RTN","PRCNFAP",18,0)
 Q
"RTN","PRCNFAP",19,0)
FDC ;  Check for FD completion
"RTN","PRCNFAP",20,0)
 S TDA=0,STAT=24,CKD=1
"RTN","PRCNFAP",21,0)
 F  S TDA=$O(^PRCN(413.1,"AC",44,TDA)) Q:TDA=""  D CK
"RTN","PRCNFAP",22,0)
 G EXIT
"RTN","PRCNFAP",23,0)
CKA I ($P(PRCNFDA,U,2)>$P(PRCNFDA,U,3))&($P(PRCNFDA,U,2)'<STDT) S SFL=1
"RTN","PRCNFAP",24,0)
 Q
"RTN","PRCNFAP",25,0)
CKD I $P(PRCNFDA,U,3)'<STDT S SFL=1
"RTN","PRCNFAP",26,0)
 Q
"RTN","PRCNFAP",27,0)
 ;
"RTN","PRCNFAP",28,0)
OVAL ; PRCN*1.0*15 get original CMR, Use Status and SGL values
"RTN","PRCNFAP",29,0)
 N OLDCMR,OLDSGL,OLDUST
"RTN","PRCNFAP",30,0)
 S OLDCMR=$P($G(^ENG(6914,PRCNTI,2)),U,9)
"RTN","PRCNFAP",31,0)
 S OLDUST=$P($G(^ENG(6914,PRCNTI,3)),U,1)
"RTN","PRCNFAP",32,0)
 S OLDSGL=$P($G(^ENG(6914,PRCNTI,8)),U,6)
"RTN","PRCNFAP",33,0)
 S OLDVALUE(N)=PRCNTI_U_OLDCMR_U_OLDUST_U_OLDSGL
"RTN","PRCNFAP",34,0)
 Q
"RTN","PRCNP14E")
0^^B806409
"RTN","PRCNP14E",1,0)
PRCNP14E ;ALB/RLC - PATCH PRCN*1.0*14 ENVIRONMENTAL CHECK ;[2/10/2004 11:50]
"RTN","PRCNP14E",2,0)
 ;;1.0;Equipment/Turn-In Request;**14,15**;Sep 13, 1996
"RTN","PRCNP14E",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCNP14E",4,0)
 ;
"RTN","PRCNP14E",5,0)
CHECK ; Check for Equipment/Turn-In Request Shutdown
"RTN","PRCNP14E",6,0)
 N X S X="PRCLOP4" X ^%ZOSF("TEST") I $T,$$SYS^PRCLOP4>0 D  S XPDQUIT=1 Q
"RTN","PRCNP14E",7,0)
 . N PRCT S PRCT(1)="Equipment/Turn-In Request (PRCN) has been shut down, so no"
"RTN","PRCNP14E",8,0)
 . S PRCT(2)="further PRCN patches should be installed." D MES^XPDUTL(.PRCT)
"RTN","PRCNP14E",9,0)
 Q
"RTN","PRCNTICM")
0^1^B3153364
"RTN","PRCNTICM",1,0)
PRCNTICM ;SSI/SEB-CMR Official Review/Approval for Turnin ;[ 03/13/97  10:28 AM ]
"RTN","PRCNTICM",2,0)
 ;;1.0;PRCN;**2,3,14,15**;Sep 13, 1996
"RTN","PRCNTICM",3,0)
EN S PRCNC=DUZ D CMR^PRCNCMR K PRCNC
"RTN","PRCNTICM",4,0)
 S DIC("S")="S ST=$P(^(0),U,7),CMRZ=$P(^(0),U,16) I ST=3&($D(PRCNCMR(CMRZ)))"
"RTN","PRCNTICM",5,0)
 S DIC="^PRCN(413.1,",DIC(0)="AEQZ" D ^DIC G EXIT:+Y<0 K DIC("S")
"RTN","PRCNTICM",6,0)
 S (DA,PRCNTDA,IN)=+Y,PRCNUSR=0 D SETUP^PRCNTIPR
"RTN","PRCNTICM",7,0)
 S DIE=413.1,DR="[PRCNTICMR]" D ^DIE
"RTN","PRCNTICM",8,0)
 I $D(^PRCN(413.1,DA,2)) S GLO=413.1 D MES  ; PRCN*1.0*15
"RTN","PRCNTICM",9,0)
 ;  Set the turn-in date in 6914
"RTN","PRCNTICM",10,0)
 S PRCNN=0 F  S PRCNN=$O(^PRCN(413.1,PRCNTDA,1,PRCNN)) Q:'PRCNN  D
"RTN","PRCNTICM",11,0)
 . S DA=$P(^PRCN(413.1,PRCNTDA,1,PRCNN,0),U)
"RTN","PRCNTICM",12,0)
 . S PRCNFAP=$$CHKFA^ENFAUTL(DA) Q:$P(PRCNFAP,U)=1
"RTN","PRCNTICM",13,0)
 . S (DIE,DIC)=6914,DR="20.5////^S X=DT" D ^DIE
"RTN","PRCNTICM",14,0)
EXT K DIC,DIE,DA,DR,IN,PRCNUSR,Y,PRCNCMR,PRCN,PRCNTDA,PRCNC,PRCNN,PRCNFAP
"RTN","PRCNTICM",15,0)
 G EN
"RTN","PRCNTICM",16,0)
MES ;  Send mail message when CMR Official has not approved request
"RTN","PRCNTICM",17,0)
 N GLO
"RTN","PRCNTICM",18,0)
 S GLO=413.1
"RTN","PRCNTICM",19,0)
 S XMB(1)=$P(^PRCN(413.1,DA,0),U),XMDUZ=DUZ
"RTN","PRCNTICM",20,0)
 S XMB="PRCNCMR2",XMY($P(^PRCN(413.1,DA,0),U,2))="",XMY(XMDUZ)=""
"RTN","PRCNTICM",21,0)
 S CMRDA=$P(^PRCN(413.1,DA,0),U,16)
"RTN","PRCNTICM",22,0)
 I CMRDA'="",$D(^ENG(6914.1,CMRDA,0)),($P(^ENG(6914.1,CMRDA,0),U,2)'="") S XMY($P(^ENG(6914.1,CMRDA,0),U,2))=""
"RTN","PRCNTICM",23,0)
 ;  Append the explanation text
"RTN","PRCNTICM",24,0)
 S NL=$P($G(^PRCN(413.1,DA,2,0)),U,3),XMTEXT="MSG("
"RTN","PRCNTICM",25,0)
 I NL'="" F I=1:1:NL S MSG(I)=$G(^PRCN(413.1,DA,2,I,0))
"RTN","PRCNTICM",26,0)
 D ^XMB
"RTN","PRCNTICM",27,0)
 K MSG,NL,XMB,XMTEXT,I,XMY,XMDUZ
"RTN","PRCNTICM",28,0)
 Q
"RTN","PRCNTICM",29,0)
EXIT K DIC,DIE,DA,DR,IN,PRCNUSR,Y,PRCNCMR,PRCN,PRCNTDA,PRCNC,PRCNN,PRCNFAP
"RTN","PRCNTICM",30,0)
 K CMRZ,PRCNCM
"RTN","PRCNTICM",31,0)
 Q
"RTN","PRCNTIPP")
0^2^B10071720
"RTN","PRCNTIPP",1,0)
PRCNTIPP ;SSI/SEB,ALA-PPM Turn-in review ;[ 05/31/96  10:34 AM ]
"RTN","PRCNTIPP",2,0)
 ;;1.0;Equipment/Turn-In Request;**15**;Sep 13, 1996
"RTN","PRCNTIPP",3,0)
SELECT ; Select a Turn-in request
"RTN","PRCNTIPP",4,0)
 N PRCNFLAG S PRCNFLAG=0  ; PRCN*1.0*15
"RTN","PRCNTIPP",5,0)
 D WOC,FAC^PRCNFAP,FDC^PRCNFAP S PRCNFLAG=PRCNFLAG+1
"RTN","PRCNTIPP",6,0)
 S DIC(0)="AEQZ",DIC="^PRCN(413.1,"
"RTN","PRCNTIPP",7,0)
 I PRCNUSR=2 S DIC("S")="I $P(^(0),U,7)=23"
"RTN","PRCNTIPP",8,0)
 I PRCNUSR=1 S DIC("S")="I $P(^(0),U,7)=6!($P(^(0),U,7)=25)"
"RTN","PRCNTIPP",9,0)
 D ^DIC K DIC("S") G EXIT:+Y<0
"RTN","PRCNTIPP",10,0)
PR S (IN,PRCNTDA,DA)=+Y,TIF=1 D SETUP^PRCNTIPR
"RTN","PRCNTIPP",11,0)
 K F,FF,FN,ID,PRCNDD,PRCNDEEP,PV,TIF
"RTN","PRCNTIPP",12,0)
 I PRCNUSR=2 D  G SELECT
"RTN","PRCNTIPP",13,0)
 . S TDA=PRCNTDA,STAT=44,CKA=1 D CK^PRCNFAP I SFL D SQ Q
"RTN","PRCNTIPP",14,0)
 . S DR="[PRCNTIPPM]",DIE=413.1 W ! D ^DIE
"RTN","PRCNTIPP",15,0)
 . D:'POP RESET^PRCNUTL  ; PRCN*1.0*15
"RTN","PRCNTIPP",16,0)
 . D SQ
"RTN","PRCNTIPP",17,0)
 . K POP  ; PRCN*1.0*15
"RTN","PRCNTIPP",18,0)
 S TDA=DA,TI=0,STAT=$P(^PRCN(413.1,TDA,0),U,7),WOFL=0
"RTN","PRCNTIPP",19,0)
 I STAT=25 D WH,SQ G SELECT
"RTN","PRCNTIPP",20,0)
 F  S TI=$O(^PRCN(413.1,TDA,1,TI)) Q:TI'>0  D  Q:$D(DUOUT)
"RTN","PRCNTIPP",21,0)
 . S WOFL=0 D ITEM Q:$D(DUOUT)
"RTN","PRCNTIPP",22,0)
 . I 'WOFL D WH Q
"RTN","PRCNTIPP",23,0)
 . I WOFL S DA=TDA,(DIC,DIE)=413.1,DR="6////^S X=21;7////^S X=DT" D ^DIE,SQ Q
"RTN","PRCNTIPP",24,0)
 D SQ
"RTN","PRCNTIPP",25,0)
 G SELECT
"RTN","PRCNTIPP",26,0)
WH W !,"Is this request ready to go to Warehouse for pickup"
"RTN","PRCNTIPP",27,0)
QH S %=1 D YN^DICN
"RTN","PRCNTIPP",28,0)
 I %=0 D  G QH
"RTN","PRCNTIPP",29,0)
 . W !!,"Enter 'Yes' to send the turn-in request to Warehouse user."
"RTN","PRCNTIPP",30,0)
 I %=1 S DA=TDA,DIE=413.1,DR="6////^S X=22;7////^S X=DT" D ^DIE
"RTN","PRCNTIPP",31,0)
SQ K DIC,DIE,DR,DA,DUOUT,IN,Y,C,%,WOFL,SFL
"RTN","PRCNTIPP",32,0)
 Q
"RTN","PRCNTIPP",33,0)
ITEM ; Display and process line items
"RTN","PRCNTIPP",34,0)
 S NL=0 D TURNIN^PRCNPRNT
"RTN","PRCNTIPP",35,0)
 S WODATA=IN_U_$P($G(^ENG(6914,IN,3)),U,5)
"RTN","PRCNTIPP",36,0)
COND ;  Get the condition code
"RTN","PRCNTIPP",37,0)
 S DA(1)=TDA,DA=TI,DIC="^PRCN(413.1,"_DA(1)_",1,"
"RTN","PRCNTIPP",38,0)
 S DIE=DIC,DR=1 D ^DIE
"RTN","PRCNTIPP",39,0)
WO K % I $G(^DIC(6910,1,0))="" S %=2
"RTN","PRCNTIPP",40,0)
 W !!,"Should a work order be generated for this line item" D YN^DICN
"RTN","PRCNTIPP",41,0)
 I %=-1,%Y="^" S DUOUT="^" Q
"RTN","PRCNTIPP",42,0)
 I %=0 D  G WO
"RTN","PRCNTIPP",43,0)
 . W !!,"Please enter 'Y'es if Engineering must disconnect or otherwise support the turn-in of this equipment."
"RTN","PRCNTIPP",44,0)
 S C=$S(%=1:"Y",1:"N"),$P(^PRCN(413.1,TDA,1,TI,0),U,4)=C
"RTN","PRCNTIPP",45,0)
 I C'="Y" Q
"RTN","PRCNTIPP",46,0)
 S PRCNSRV=$P(^PRCN(413.1,TDA,0),U,3)
"RTN","PRCNTIPP",47,0)
 D TRNIN^ENWONEW2
"RTN","PRCNTIPP",48,0)
 I $G(ENDA)="" W !,"Not able to create work order at this time!" G WO
"RTN","PRCNTIPP",49,0)
 S DA(1)=TDA,DA=TI,DIC="^PRCN(413.1,"_DA(1)_",1,",DIE=DIC,WOFL=1
"RTN","PRCNTIPP",50,0)
 S DR="11////^S X=ENDA" D ^DIE
"RTN","PRCNTIPP",51,0)
IQ K NL,WODATA,C,CODES,II,S,PRCNFL,ENDR,ENLO,ENHI,PRCNSRV,ENDA,ENWO
"RTN","PRCNTIPP",52,0)
 Q
"RTN","PRCNTIPP",53,0)
WOC ;  Work order completion
"RTN","PRCNTIPP",54,0)
 S TDA="" F  S TDA=$O(^PRCN(413.1,"AC",21,TDA)) Q:TDA=""  D CS
"RTN","PRCNTIPP",55,0)
 K TDA Q
"RTN","PRCNTIPP",56,0)
CS ; Check if all work orders have been completed
"RTN","PRCNTIPP",57,0)
 S N=0 F  S N=$O(^PRCN(413.1,TDA,1,N)) Q:N'>0  D
"RTN","PRCNTIPP",58,0)
 . S WODA=$P(^PRCN(413.1,TDA,1,N,0),U,14) Q:WODA=""
"RTN","PRCNTIPP",59,0)
 . I $P($G(^ENG(6920,WODA,5)),U,2)'="" S DA=TDA,DIE=413.1,DR="6////^S X=25;7////^S X=DT" D ^DIE
"RTN","PRCNTIPP",60,0)
 K DA,DIE,DR,N,WODA
"RTN","PRCNTIPP",61,0)
 Q
"RTN","PRCNTIPP",62,0)
PRT ;  Print turnin item
"RTN","PRCNTIPP",63,0)
 NEW X,Y,N,F,I
"RTN","PRCNTIPP",64,0)
 S TDA=D0,TI=D1,NL=0 D TURNIN^PRCNPRNT
"RTN","PRCNTIPP",65,0)
 K F,FF,FN,GLO,I,IN,J,N,N2,NEWL,NL,OGLO,OID,OIN,OPC,PC,PGLO,PRCNDD
"RTN","PRCNTIPP",66,0)
 K PRCNDEEP,PGL,PV,TDA,TI,VAL,CODES
"RTN","PRCNTIPP",67,0)
 Q
"RTN","PRCNTIPP",68,0)
EXIT K PRCNTDA,DIC,DIE,DR,DA,DUOUT,IN,Y,C,%,WOFL,SFL,D0,D1,D,TDA,CODE,CODES
"RTN","PRCNTIPP",69,0)
 K CP,DIR,PGL,OIN,PC,PRCNCT,L,OGLO,OID,OPC
"RTN","PRCNTIPP",70,0)
 Q
"RTN","PRCNUTL")
0^4^B12930600
"RTN","PRCNUTL",1,0)
PRCNUTL ;SSI/ALA-UTILITY PROGRAM ;[ 09/11/96  2:08 PM ]
"RTN","PRCNUTL",2,0)
 ;;1.0;Equipment/Turn-In Request;**15**;Sep 13, 1996
"RTN","PRCNUTL",3,0)
SEQ ;  Get the next sequential number, returns PRCNDA and TST
"RTN","PRCNUTL",4,0)
 ;   TST is the beginning part of the transaction number
"RTN","PRCNUTL",5,0)
 S NDA=$O(^PRCN(413.7,"B",TST,"")) I NDA="" D
"RTN","PRCNUTL",6,0)
 . NEW DIC,DIE,DA,DR,DLAYGO
"RTN","PRCNUTL",7,0)
 . S X=TST,DIC="^PRCN(413.7,",DIC(0)="L",DLAYGO=413.7 D FILE^DICN
"RTN","PRCNUTL",8,0)
 . S NDA=+Y,$P(^PRCN(413.7,NDA,0),U,2)=0
"RTN","PRCNUTL",9,0)
 S PRCNDA=$P(^PRCN(413.7,NDA,0),U,2)+1,$P(^PRCN(413.7,NDA,0),U,2)=PRCNDA
"RTN","PRCNUTL",10,0)
EXIT K NDA,X,Y Q
"RTN","PRCNUTL",11,0)
EMSG ;  Loop for message for requests
"RTN","PRCNUTL",12,0)
 S (X,CT)=0 F  S X=$O(^PRCN(413,"AC",STA,X)) Q:X=""  D
"RTN","PRCNUTL",13,0)
 . I STA=1,$P(^PRCN(413,X,0),U,2)'=DUZ Q
"RTN","PRCNUTL",14,0)
 . I STA=3,$P(^PRCN(413,X,0),U,6)'=DUZ Q
"RTN","PRCNUTL",15,0)
 . I STA=9,$G(^PRCN(413,X,5,"B",DUZ))="" Q
"RTN","PRCNUTL",16,0)
 . I STA=45,$P(^PRCN(413,X,0),U,6)'=DUZ Q
"RTN","PRCNUTL",17,0)
 . S CT=CT+1
"RTN","PRCNUTL",18,0)
 I CT>0 W $C(7),!!! D
"RTN","PRCNUTL",19,0)
 . S TEX3=$P(^PRCN(413.5,STA,0),U),TEX1=$S(CT=1:"is",1:"are")
"RTN","PRCNUTL",20,0)
 . S TEX2=$S(CT=1:"request",1:"requests")
"RTN","PRCNUTL",21,0)
 . W !,?3,"There "_TEX1_" "_CT_" equipment "_TEX2_" "_TEX3_"."
"RTN","PRCNUTL",22,0)
 K X,CT,TEX1,TEX2,TEX3
"RTN","PRCNUTL",23,0)
 Q
"RTN","PRCNUTL",24,0)
TMSG ;  Loop for turn-in messages
"RTN","PRCNUTL",25,0)
 S (X,CT)=0 F  S X=$O(^PRCN(413.1,"AC",STA,X)) Q:X=""  D
"RTN","PRCNUTL",26,0)
 . I STA=1,$P(^PRCN(413.1,X,0),U,2)'=DUZ Q
"RTN","PRCNUTL",27,0)
 . I STA=3,$P(^PRCN(413.1,X,0),U,6)'=DUZ Q
"RTN","PRCNUTL",28,0)
 . S CT=CT+1
"RTN","PRCNUTL",29,0)
 I CT>0 W $C(7),!!! D
"RTN","PRCNUTL",30,0)
 . S TEX1=$S(CT=1:"is",1:"are"),TEX2=$S(CT=1:"request",1:"requests")
"RTN","PRCNUTL",31,0)
 . S TEX3=$P(^PRCN(413.5,STA,0),U)
"RTN","PRCNUTL",32,0)
 . W ?3,"There "_TEX1_" "_CT_" Turn-In "_TEX2_" "_TEX3
"RTN","PRCNUTL",33,0)
 K X,CT Q
"RTN","PRCNUTL",34,0)
 ; Electronic Signature Code check. FAIL is defined if check fails.
"RTN","PRCNUTL",35,0)
ES S FAIL="" D ESIG^PRCUESIG(DUZ,.FAIL)
"RTN","PRCNUTL",36,0)
ES1 I FAIL<1 W $C(7),"  SIGNATURE CODE FAILURE " R X:3 G EQ
"RTN","PRCNUTL",37,0)
EQ K X,I Q
"RTN","PRCNUTL",38,0)
FYQ ;RETURNS FY AND QTR GIVEN IN FILEMANAGER DATE IN 'X'
"RTN","PRCNUTL",39,0)
 G:'$D(X) QQ G:X=""!($E(X,1,7)'?7N)!(+$E(X,1,7)'=$E(X,1,7)) QQ
"RTN","PRCNUTL",40,0)
 S Y=$E(X,2,3),Y(1)=$E(X,4,5),PRC("FY")=$S(Y(1)<10:Y,1:Y+1)
"RTN","PRCNUTL",41,0)
 S PRC("QTR")=$S(Y(1)<4:2,Y(1)<7:3,Y(1)<10:4,1:1) K Y S %=1 Q
"RTN","PRCNUTL",42,0)
QQ K PRC,PRCF("X"),PRCB,%DT,DIC,%F,A,B,X,Y S %=0 Q
"RTN","PRCNUTL",43,0)
EN1 ;  Check for utilities=13 to ask for free text OTHER
"RTN","PRCNUTL",44,0)
 S FL=0 S:$D(^PRCN(413,DA,3,"B",13)) FL=1
"RTN","PRCNUTL",45,0)
 Q
"RTN","PRCNUTL",46,0)
VEN ; Translate potential vendor field into pointer and store it
"RTN","PRCNUTL",47,0)
 S VEN=X
"RTN","PRCNUTL",48,0)
 N DIEL,DM,DC,DH,DI,DK,DP,DL,DIFLD,DQ,DR,DIC,DIE,DA,X,Y
"RTN","PRCNUTL",49,0)
 S X=VEN,DIC(0)="EZ",DIC="^PRC(440," D ^DIC S PRCNVEN=+Y
"RTN","PRCNUTL",50,0)
 I PRCNVEN<0 S $P(^PRCN(413,D0,1,D1,0),U,13)=VEN,$P(^(0),U,2)="" G EX
"RTN","PRCNUTL",51,0)
 I PRCNVEN'<0 S $P(^PRCN(413,D0,1,D1,0),U,2)=PRCNVEN,$P(^(0),U,13)=""
"RTN","PRCNUTL",52,0)
EX K VEN,PRCNVEN
"RTN","PRCNUTL",53,0)
 Q
"RTN","PRCNUTL",54,0)
VENHLP ; Executable help for potential vendor field
"RTN","PRCNUTL",55,0)
 S DUOUT=0,PRCNCT=0,HL0=0
"RTN","PRCNUTL",56,0)
 F  S HL0=$O(^DD(413.015,2,21,HL0)) Q:HL0'>0  W !,^DD(413.015,2,21,HL0,0)
"RTN","PRCNUTL",57,0)
 W !!,"Current Vendors: "
"RTN","PRCNUTL",58,0)
 S L="" F  S L=$O(^PRC(440,"B",L)) Q:L=""  D T I $G(DUOUT)=1 S DUOUT=0 Q
"RTN","PRCNUTL",59,0)
 K L,PRCNDI,PRCND,PRCNA,X
"RTN","PRCNUTL",60,0)
 Q
"RTN","PRCNUTL",61,0)
T S PRCNCT=PRCNCT+1
"RTN","PRCNUTL",62,0)
 I PRCNCT<10 W !,L Q
"RTN","PRCNUTL",63,0)
 R !,"'^' TO STOP: ",PRCNA:DTIME S:'$T PRCNA=U
"RTN","PRCNUTL",64,0)
 I $G(PRCNA)[U S DUOUT=1 Q
"RTN","PRCNUTL",65,0)
 S PRCNCT=0 Q
"RTN","PRCNUTL",66,0)
 ;
"RTN","PRCNUTL",67,0)
CHECK ; PRCN*1.0*15 new subroutine to check if all line items for a
"RTN","PRCNUTL",68,0)
 ; transaction have been dispositioned - CMR equals null if dispo'd
"RTN","PRCNUTL",69,0)
 N N1,PRCNT0
"RTN","PRCNUTL",70,0)
 S POP=1
"RTN","PRCNUTL",71,0)
 S N1=999 F  S N1=$O(^PRCN(413.1,PRCNTDA,1,N1),-1) Q:'N1  D
"RTN","PRCNUTL",72,0)
 . S PRCNT0=$P($G(^PRCN(413.1,PRCNTDA,1,N1,0)),U)
"RTN","PRCNUTL",73,0)
 . I +$P($G(^ENG(6914,PRCNT0,2)),U,9) S POP=0 Q
"RTN","PRCNUTL",74,0)
 D:'POP DMSG
"RTN","PRCNUTL",75,0)
 Q
"RTN","PRCNUTL",76,0)
 ;
"RTN","PRCNUTL",77,0)
DMSG ; PRCN*1.0*15 new subroutine to display message to user
"RTN","PRCNUTL",78,0)
 W !! F X=1:1:79 W "*"
"RTN","PRCNUTL",79,0)
 W !,"* SORRY.  THERE ARE ADDITIONAL LINE ITEMS FOR TRANSACTION:",?78,"*"
"RTN","PRCNUTL",80,0)
 W !,"*",?78,"*"
"RTN","PRCNUTL",81,0)
 W !,"*",?80-$L($G(Y(0,0)))/2,$G(Y(0,0)),?78,"*"
"RTN","PRCNUTL",82,0)
 W !,"*",?78,"*"
"RTN","PRCNUTL",83,0)
 W !,"* THAT MUST BE DISPOSITIONED BEFORE THIS TRANSACTION CAN BE FINALIZED.",?78,"*"
"RTN","PRCNUTL",84,0)
 W ! F X=1:1:79 W "*"
"RTN","PRCNUTL",85,0)
 W !!
"RTN","PRCNUTL",86,0)
 Q
"RTN","PRCNUTL",87,0)
 ;
"RTN","PRCNUTL",88,0)
RESET ; PRCN*1.0*15 reset status, plus original CMR and SGL values
"RTN","PRCNUTL",89,0)
 ; and set disposition date, method and value each to null
"RTN","PRCNUTL",90,0)
 N DATA,OLDCMR,OLDSGL,OLDUST,NULL,N
"RTN","PRCNUTL",91,0)
 S DIE="^PRCN(413.1,",DR="6////"_23 D ^DIE
"RTN","PRCNUTL",92,0)
 N DA
"RTN","PRCNUTL",93,0)
 S N=0 F  S N=$O(OLDVALUE(N)) Q:'N  D
"RTN","PRCNUTL",94,0)
 . S DATA=OLDVALUE(N),NULL=""
"RTN","PRCNUTL",95,0)
 . S DA=$P(DATA,U,1),OLDCMR=$P(DATA,U,2),OLDUST=$P(DATA,U,3),OLDSGL=$P(DATA,U,4)
"RTN","PRCNUTL",96,0)
 . S DIE="^ENG(6914,"
"RTN","PRCNUTL",97,0)
 . S DR="19////^S X=OLDCMR;20////^S X=OLDUST;38////^S X=OLDSGL;22///@;31///@;32///@" D ^DIE
"RTN","PRCNUTL",98,0)
 . K DA,DIE,DR
"RTN","PRCNUTL",99,0)
 Q
"VER")
8.0^22
**END**
**END**
