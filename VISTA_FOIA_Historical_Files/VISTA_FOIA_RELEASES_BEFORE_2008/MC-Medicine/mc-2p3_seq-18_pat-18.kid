Released MC*2.3*18 SEQ #18
Extracted from mail message
**KIDS**:MC*2.3*18^

**INSTALL NAME**
MC*2.3*18
"BLD",239,0)
MC*2.3*18^MEDICINE^0^2970518^y
"BLD",239,1,0)
^^1^1^2980515^^
"BLD",239,1,1,0)
Refer to patch Descripton.
"BLD",239,4,0)
^9.64PA^^
"BLD",239,"KRN",0)
^9.67PA^19^18
"BLD",239,"KRN",.4,0)
.4
"BLD",239,"KRN",.4,"NM",0)
^9.68A^2^2
"BLD",239,"KRN",.4,"NM",1,0)
MCARHOLT1    FILE #691.6^691.6^0
"BLD",239,"KRN",.4,"NM",2,0)
MCPFTBRPR1    FILE #700^700^0
"BLD",239,"KRN",.4,"NM","B","MCARHOLT1    FILE #691.6",1)

"BLD",239,"KRN",.4,"NM","B","MCPFTBRPR1    FILE #700",2)

"BLD",239,"KRN",.401,0)
.401
"BLD",239,"KRN",.402,0)
.402
"BLD",239,"KRN",.403,0)
.403
"BLD",239,"KRN",.5,0)
.5
"BLD",239,"KRN",.84,0)
.84
"BLD",239,"KRN",3.6,0)
3.6
"BLD",239,"KRN",3.8,0)
3.8
"BLD",239,"KRN",9.2,0)
9.2
"BLD",239,"KRN",9.8,0)
9.8
"BLD",239,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",239,"KRN",9.8,"NM",1,0)
MCOR1^^0^B9904645
"BLD",239,"KRN",9.8,"NM",2,0)
MCESEDT^^0^B30128477
"BLD",239,"KRN",9.8,"NM",3,0)
MCARP^^0^B28762216
"BLD",239,"KRN",9.8,"NM",4,0)
MCPFTP^^0^B3751871
"BLD",239,"KRN",9.8,"NM",5,0)
MCPFTP5^^0^B22328319
"BLD",239,"KRN",9.8,"NM","B","MCARP",3)

"BLD",239,"KRN",9.8,"NM","B","MCESEDT",2)

"BLD",239,"KRN",9.8,"NM","B","MCOR1",1)

"BLD",239,"KRN",9.8,"NM","B","MCPFTP",4)

"BLD",239,"KRN",9.8,"NM","B","MCPFTP5",5)

"BLD",239,"KRN",19,0)
19
"BLD",239,"KRN",19.1,0)
19.1
"BLD",239,"KRN",101,0)
101
"BLD",239,"KRN",409.61,0)
409.61
"BLD",239,"KRN",771,0)
771
"BLD",239,"KRN",869.2,0)
869.2
"BLD",239,"KRN",870,0)
870
"BLD",239,"KRN",8994,0)
8994
"BLD",239,"KRN","B",.4,.4)

"BLD",239,"KRN","B",.401,.401)

"BLD",239,"KRN","B",.402,.402)

"BLD",239,"KRN","B",.403,.403)

"BLD",239,"KRN","B",.5,.5)

"BLD",239,"KRN","B",.84,.84)

"BLD",239,"KRN","B",3.6,3.6)

"BLD",239,"KRN","B",3.8,3.8)

"BLD",239,"KRN","B",9.2,9.2)

"BLD",239,"KRN","B",9.8,9.8)

"BLD",239,"KRN","B",19,19)

"BLD",239,"KRN","B",19.1,19.1)

"BLD",239,"KRN","B",101,101)

"BLD",239,"KRN","B",409.61,409.61)

"BLD",239,"KRN","B",771,771)

"BLD",239,"KRN","B",869.2,869.2)

"BLD",239,"KRN","B",870,870)

"BLD",239,"KRN","B",8994,8994)

"BLD",239,"QUES",0)
^9.62^^
"BLD",239,"REQB",0)
^9.611^^
"KRN",.4,981,-1)
0^1
"KRN",.4,981,0)
MCARHOLT1^2980506.0829^^691.6^^^2980506
"KRN",.4,981,"DXS",1,9)
S DIP(2)=$C(59)_$S($D(^DD(691.6,24,0)):$P(^(0),U,3),1:""),DIP(1)=$S($D(^MCAR(691.6,D0,4)):^(4),1:"") S X="TAPE QUALITY: "_$P($P(DIP(2),$C(59)_$P(DIP(1),U,1)_":",2),$C(59),1)
"KRN",.4,981,"DXS",2,9.2)
S DIP(1)=$S($D(^MCAR(691.6,D0,4)):^(4),1:"") S X='$P(DIP(1),U,10),DIP(2)=X S X="",DIP(3)=X S X='$P(DIP(1),U,3),DIP(4)=X S X="",DIP(5)=X S X=1,DIP(6)=X
"KRN",.4,981,"DXS",3,9.2)
S DIP(1)=$S($D(^MCAR(691.6,D0,4)):^(4),1:"") S X='$P(DIP(1),U,22),DIP(2)=X S X="",DIP(3)=X S X='$P(DIP(1),U,3),DIP(4)=X S X="",DIP(5)=X S X=1,DIP(6)=X
"KRN",.4,981,"DXS",4,9)
S DIP(2)=$C(59)_$S($D(^DD(691.6,65,0)):$P(^(0),U,3),1:""),DIP(1)=$S($D(^MCAR(691.6,D0,9)):^(9),1:"") S X="ST LEVEL: "_$P(DIP(1),U,2)_" MM "_$P($P(DIP(2),$C(59)_$P(DIP(1),U,3)_":",2),$C(59),1)
"KRN",.4,981,"DXS",5,1)
SYNCOPE
"KRN",.4,981,"DXS",5,2)
HX SUDDEN DEATH OR SUSTAINED V-T
"KRN",.4,981,"DXS",5,3)
DOCUMENTED V ECTOPY
"KRN",.4,981,"DXS",5,4)
DOCUMENTED SVT
"KRN",.4,981,"DXS",5,5)
WPW
"KRN",.4,981,"DXS",5,6)
PACEMAKER
"KRN",.4,981,"DXS",5,7)
EFFICACY OF THERAPY
"KRN",.4,981,"DXS",5,8)
LIGHTHEADEDNESS
"KRN",.4,981,"DXS",5,9)
RECENT INFARCT
"KRN",.4,981,"F",1)

"KRN",.4,981,"F",2)
S DIP(1)=$S($D(^MCAR(691.6,D0,0)):^(0),1:"") S X="WARD/CLINIC: "_$S('$D(^SC(+$P(DIP(1),U,18),0)):"",1:$P(^(0),U,1)) W X K DIP;C5;Z;""WARD/CLINIC: "_#17"~
"KRN",.4,981,"F",3)
"REQUESTED BY: ";C5;S~4;X~"REASON FOR STUDY:";C5;S~5.5,.01;C25~"REVIEWED BY: ";C5;S~14;X~X DXS(1,9) W X K DIP;C5;S;Z;""TAPE QUALITY: "_TAPE QUALITY"~
"KRN",.4,981,"F",4)
S DIP(1)=$S($D(^MCAR(691.6,D0,4)):^(4),1:"") S X="HOURS: "_$P(DIP(1),U,2)_" TOTAL,  "_$P(DIP(1),U,3)_" READABLE" W X K DIP;C45;Z;""HOURS: "_#25_" TOTAL,  "_#26_" READABLE""~
"KRN",.4,981,"F",5)
"MALFUNCTIONS:";C5;S~23,.01;W60~"----------------------------  RESULTS  ----------------------------";S2;C5~"HEART RATE";C30;S~"TIME";C58~
"KRN",.4,981,"F",6)
"----------";C30~"------";C57~"AVERAGE";C10~27;C33~"MAXIMUM";C10~28;C33~29;C58~"MINIMUM";C10~30;C33~31;C58~"VENTRICULAR";C14;S~"ATRIAL";C54~
"KRN",.4,981,"F",7)
"-------------------------";C8~"-------------------------";C45~32;R8;C4;X~"TOTAL BEATS";L25;C13~45;R8;C40~"TOTAL BEATS";L25;C49~33;R8;C4~
"KRN",.4,981,"F",8)
"TOTAL VPBS,";L11;C13~34;R2;C25~"% OF BTS"~46;R8;C40~"TOTAL ECTOPICS,";L15;C49~47;R2;C65~"% OF BTS"~
"KRN",.4,981,"F",9)
X DXS(2,9.2) S X=$P(DIP(1),U,10),X=$S($P(DIP(1),U,3):X\$P(DIP(1),U,3),1:"*******"),X=$S(DIP(2):DIP(3),DIP(4):DIP(5),DIP(6):X) W X K DIP;R8;C4;Z;"$S('#33:"",'#26:"",1:#33\#26)"~
"KRN",.4,981,"F",10)
"AVE/HOUR";L25;C13~
"KRN",.4,981,"F",11)
X DXS(3,9.2) S X=$P(DIP(1),U,22),X=$S($P(DIP(1),U,3):X\$P(DIP(1),U,3),1:"*******"),X=$S(DIP(2):DIP(3),DIP(4):DIP(5),DIP(6):X) W X K DIP;R8;C40;Z;"$S('#46:"",'#26:"",1:#46\#26)"~
"KRN",.4,981,"F",12)
"AVE/HOUR";L25;C49~36;R8;C4~"MAX/HOUR";L25;C13~49;R8;C40~"MAX/HOUR";L25;C49~37;R8;C4~"ISOLATED";L25;C13~50;R8;C40~"ISOLATED";L25;C49~38;R8;C4~
"KRN",.4,981,"F",13)
"BIGEMINY";L25;C13~51;R8;C40~"BLOCKED APCS";L25;C49~39;R8;C4~"COUPLETS";L25;C13~50.5;R8;C40~"COUPLETS";L25;C49~41;R8;C4~"BEATS IN RUNS";L25;C13~
"KRN",.4,981,"F",14)
52;R8;C40~"RUNS SV-T";L25;C49~42;R8;C4~"BEATS IN LONGEST RUN";L25;C13~53;R8;C40~"BEATS IN RUNS";L25;C49~43;R8;C4~"BEATS FASTEST RUN AT";L20;C13~
"KRN",.4,981,"F",15)
44;R3;C34~"BPM";L3;C38~54;R7;C41~"BEATS IN LONGEST RUN";L25;C49~55;R8;C40~"BTS FASTEST RUN AT";L18;C49~56;R3;C68~"BPM";L3;C72~
"KRN",.4,981,"F",16)
X DXS(4,9) W X K DIP;C8;S1;Z;""ST LEVEL: "_#64_" MM "_#65"~
"KRN",.4,981,"H")
@
"KRN",.4,981,"IOM")
80
"KRN",.4,981,"LAST")
1
"KRN",.4,981,"ROU")
^MCAROH1
"KRN",.4,981,"ROUOLD")
MCAROH1
"KRN",.4,981,"SUB")
1
"KRN",.4,1040,-1)
0^2
"KRN",.4,1040,0)
MCPFTBRPR1^2980521.1443^^700^^^2980521
"KRN",.4,1040,"DXS",1,"A")
ABNORMAL
"KRN",.4,1040,"DXS",1,"B")
BORDERLINE
"KRN",.4,1040,"DXS",1,"N")
NORMAL
"KRN",.4,1040,"DXS",1,"T")
TECHNICALLY UNSATISFACTORY
"KRN",.4,1040,"F",1)
"SUMMARY: ";S~.03;X~"PROCEDURE SUMMARY:  ";S~600;X~"INTERPRETATION:";S~D COMP^MCPFTP5;Z;"D COMP^MCPFTP5"~33.5,.01;C18;W70;X~"INTERPRETED BY:  ";S~
"KRN",.4,1040,"F",2)
21,.01;C17;X;X~
"KRN",.4,1040,"H")
@
"KRN",.4,1040,"IOM")
80
"KRN",.4,1040,"LAST")

"KRN",.4,1040,"ROU")
^MCOBPF
"KRN",.4,1040,"ROUOLD")
MCOBPF
"KRN",.4,1040,"SUB")
1
"OER",113,0)
113^^1^^
"OER",113,4)
K MCGLO,MCNAM
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",113,-1)
1^1
"PKG",113,0)
MEDICINE^MC^MEDICINE PACKAGE INCLUDES ALL AREAS OF MEDICINE
"PKG",113,20,0)
^9.402P^^
"PKG",113,22,0)
^9.49I^1^1
"PKG",113,22,1,0)
2.3^2960913^2961015^363
"PKG",113,22,1,"PAH",1,0)
18^2970518
"PKG",113,22,1,"PAH",1,1,0)
^^1^1^2980706
"PKG",113,22,1,"PAH",1,1,1,0)
Refer to patch Descripton.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","MCARP")
0^3^B28762216
"RTN","MCARP",1,0)
MCARP ;WISC/TJK-PRINT ROUTINES ;12/15/97  14:54
"RTN","MCARP",2,0)
 ;;2.3;Medicine;**6,14,15,18**;09/13/1996
"RTN","MCARP",3,0)
 ;
"RTN","MCARP",4,0)
 ;
"RTN","MCARP",5,0)
CATH ;
"RTN","MCARP",6,0)
 S DIC="^MCAR(691.1,",MCARZ="CATHETERIZATION REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"CATHB",1:"CATH1") G LOOK
"RTN","MCARP",7,0)
ECHO S DIC="^MCAR(691,",MCARZ="ECHO REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"ECHOB",1:"ECHO1") G LOOK
"RTN","MCARP",8,0)
ECG S DIC="^MCAR(691.5,",MCARZ="ECG REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"ECGB",1:"ECG1") G LOOK
"RTN","MCARP",9,0)
EP S DIC="^MCAR(691.8,",MCARZ="EP REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"EPB",1:"EP1") G LOOK
"RTN","MCARP",10,0)
HOLTER S DIC="^MCAR(691.6,",MCARZ="HOLTER REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"HOLTERB",1:"HOLTER1") G LOOK
"RTN","MCARP",11,0)
RHFULL S DIC="^MCAR(701,",MCARZ="RHEUMATOLOGY REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"RHB",1:"RHFULL1") G LOOK
"RTN","MCARP",12,0)
ETT S DIC="^MCAR(691.7,",MCARZ="ETT REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"ETTB",1:"ETT1")
"RTN","MCARP",13,0)
LOOK ;
"RTN","MCARP",14,0)
 D MCPPROC
"RTN","MCARP",15,0)
 I '$D(MCARPPS) D LOOK2,^DIC G:Y<0 EXIT S (MCARGDA,DA)=+Y
"RTN","MCARP",16,0)
 I $G(MCESON),$D(^MCAR(MCFILE,MCARGDA,"ES")) D STATUS^MCESPRT(MCFILE,MCARGDA)
"RTN","MCARP",17,0)
 I $D(ORHFS) U IO G PRINT ;dcm/slc added for CPRS
"RTN","MCARP",18,0)
DEVQUE ; Device Control and Queuing Control
"RTN","MCARP",19,0)
 K IO("Q") S %ZIS="MQ" D ^%ZIS I POP S MCOUT="" G EXIT
"RTN","MCARP",20,0)
 I $D(IO("Q")) S (ZTSAVE("DIC"),ZTSAVE("MC*"))="",ZTRTN="PRINT^MCARP",ZTDESC=MCARZ D ^%ZTLOAD K ZTSK G EXIT
"RTN","MCARP",21,0)
 U IO
"RTN","MCARP",22,0)
PRINT ; Print Report
"RTN","MCARP",23,0)
 K DXS,DIOT(2),^UTILITY($J),MCOUT S (D0,DA)=MCARGDA,PG=0
"RTN","MCARP",24,0)
 S DFN=$P(^MCAR(+$P(DIC,"(",2),MCARGDA,0),U,2),MCARGDT=$P(^(0),U,1) S:DIC[699 MCARGNUM=$P(^(0),U,$S(DIC[699.5:6,1:12))
"RTN","MCARP",25,0)
RHPRT ;
"RTN","MCARP",26,0)
 D INIT^MCARP1(MCARZ,MCARGDT,MCFILE)
"RTN","MCARP",27,0)
 S ^UTILITY($J,1)="S MCY="""" I $Y>IOSL-3 R:$E(IOST,1,2)=""C-"" !!,""Press return to continue, '^' to escape: "",MCY:DTIME S:'$T MCY=U S:MCY=U DN=0,MCOUT=1 D:DN HEAD^MCARP K MCY"
"RTN","MCARP",28,0)
 D HEAD,CALLTEM
"RTN","MCARP",29,0)
 I '$D(MCOUT) D:$G(MCESON) FOOTER^MCESPRT(MCFILE,MCARGDA)
"RTN","MCARP",30,0)
 S:$D(ZTQUEUED) ZTREQ="@" K ZTSK
"RTN","MCARP",31,0)
 G EXIT
"RTN","MCARP",32,0)
CALLTEM ;
"RTN","MCARP",33,0)
 N MCFILE D @MCARGRTN Q
"RTN","MCARP",34,0)
EXIT ;
"RTN","MCARP",35,0)
 D EXIT^MCARP1 Q
"RTN","MCARP",36,0)
LOOK2 ;
"RTN","MCARP",37,0)
 S DIC(0)="AEMQ",DIC("A")="Enter patient name or the date & time: "
"RTN","MCARP",38,0)
 I MCESON S DIC("S")=$$PREVIEW^MCESSCR(MCFILE)
"RTN","MCARP",39,0)
 Q
"RTN","MCARP",40,0)
CATH1 D ^MCAROC1 K DXS Q:$D(MCOUT)  D ^MCAROC2 K DXS Q:$D(MCOUT)  D ^MCAROC3 K DXS Q:$D(MCOUT)  D ^MCAROC4 Q
"RTN","MCARP",41,0)
CATHB D ^MCOBC1 Q
"RTN","MCARP",42,0)
ECHO1 D ^MCRPEC K DXS Q:$D(MCOUT)  Q
"RTN","MCARP",43,0)
ECHOB D ^MCOBK Q
"RTN","MCARP",44,0)
ECG1 D ^MCAROK Q
"RTN","MCARP",45,0)
ECGB D ^MCOBE1 Q
"RTN","MCARP",46,0)
EPB D ^MCOBEP Q
"RTN","MCARP",47,0)
EP1 D ^MCAROEP G EPEND:$D(MCOUT)
"RTN","MCARP",48,0)
 G VT:'$D(^MCAR(691.9,"C",MCARGDA))
"RTN","MCARP",49,0)
 S MCY=""
"RTN","MCARP",50,0)
 I $Y>IOSL-3 R:$E(IOST,1,2)="C-" !!,"Press return to continue, '^' to escape: ",MCY:DTIME S:'$T MCY=U S:$E(MCY)=U MCOUT=1 G:$G(MCOUT)=1 EPEND
"RTN","MCARP",51,0)
 F D0=0:0 S D0=$O(^MCAR(691.9,"C",MCARGDA,D0)) Q:D0=""  K DXS D HEAD,^MCAROAT G EPEND:$D(MCOUT)
"RTN","MCARP",52,0)
VT Q:'$D(^MCAR(692,"C",MCARGDA))
"RTN","MCARP",53,0)
 I $Y>IOSL-3 R:$E(IOST,1,2)="C-" !!,"Press return to continue, '^' to escape: ",MCY:DTIME S:'$T MCY=U S:$E(MCY)=U MCOUT=1 G:$G(MCOUT)=1 EPEND
"RTN","MCARP",54,0)
 F D0=0:0 S D0=$O(^MCAR(692,"C",MCARGDA,D0)) Q:D0=""  K DXS D HEAD,^MCAROV Q:$D(MCOUT)
"RTN","MCARP",55,0)
EPEND Q
"RTN","MCARP",56,0)
ETT1 D ^MCAROT Q
"RTN","MCARP",57,0)
ETTB D ^MCOBT Q
"RTN","MCARP",58,0)
HOLTER1 D ^MCAROH1 K DXS Q:$D(MCOUT)  D ^MCAROH2 Q
"RTN","MCARP",59,0)
HOLTERB D ^MCOBH1 Q
"RTN","MCARP",60,0)
GENERIC D ^MCAROGE Q
"RTN","MCARP",61,0)
GENERICB D ^MCOBGEN Q
"RTN","MCARP",62,0)
GI I $D(^DIC(120.8)) D ^MCAROGM I 1 ;    new allergy info
"RTN","MCARP",63,0)
 E  D ^MCAROG
"RTN","MCARP",64,0)
 K DXS
"RTN","MCARP",65,0)
 D:'$D(MCOUT) ^MCAROGA
"RTN","MCARP",66,0)
 Q
"RTN","MCARP",67,0)
GIB D ^MCOBGA Q
"RTN","MCARP",68,0)
PULM D ^MCAROP K DXS Q:$D(MCOUT)  D ^MCAROPE Q
"RTN","MCARP",69,0)
PULMB D ^MCOBPE Q
"RTN","MCARP",70,0)
NONENDO D ^MCAROGN Q
"RTN","MCARP",71,0)
NONENDOB D ^MCOBGN Q
"RTN","MCARP",72,0)
CONSULT D ^MCAROGC Q
"RTN","MCARP",73,0)
CONSULTB D ^MCOBGC Q
"RTN","MCARP",74,0)
GENIMP D ^MCAROPG Q
"RTN","MCARP",75,0)
GENIMPB D ^MCOBPG Q
"RTN","MCARP",76,0)
ALEAD D ^MCAROPA Q
"RTN","MCARP",77,0)
ALEADB D ^MCOBPA Q
"RTN","MCARP",78,0)
VLEAD D ^MCAROPV Q
"RTN","MCARP",79,0)
VLEADB D ^MCOBPV Q
"RTN","MCARP",80,0)
SURV D ^MCAROPS Q
"RTN","MCARP",81,0)
SURVB D ^MCOBPS Q
"RTN","MCARP",82,0)
RHFULL1 ;
"RTN","MCARP",83,0)
 I +$G(MCRH)=0 D RHFULL2 Q
"RTN","MCARP",84,0)
 S MCFILE=701,V=MCRH,MCRHR="^MCAROR"_$S(V=1:"A",V=2:"B",V=3:"N",V=4:"L",V=6:"Q",V=7:"H",V=8:"P",V=9:"D",1:"RHFULL2^MCARP") D @MCRHR K DXS Q:$D(MCOUT)  D:V=8 ^MCARORE K DXS Q:$D(MCOUT)  D:MCRH=1 DISP^MCMAG Q
"RTN","MCARP",85,0)
RHFULL2 ;
"RTN","MCARP",86,0)
 F RH="A","B","N","L","Q","H","P","E","D" Q:$D(MCOUT)  D
"RTN","MCARP",87,0)
 .S MCFILE=701,MCRHR="^MCAROR"_RH D @MCRHR K DXS Q:$D(MCOUT)
"RTN","MCARP",88,0)
 .I RH="A" D DISP^MCMAG K DXS
"RTN","MCARP",89,0)
 Q
"RTN","MCARP",90,0)
RHB D ^MCOBRH K DXS Q:$D(MCOUT)  D ^MCOBRHA Q
"RTN","MCARP",91,0)
DTIME S MCT=$P(X,".",2),X=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")_" "_$S(MCT:$E(MCT,1,2)_$E("00",0,2-$L($E(MCT,1,2)))_":"_$E(MCT,3,4)_$E("00",0,2-$L($E(MCT,3,4))),1:"")
"RTN","MCARP",92,0)
 K MCT Q
"RTN","MCARP",93,0)
HEAD ;
"RTN","MCARP",94,0)
 S HOSP=$P($G(^DPT(DFN,.1)),U) S:HOSP'="" HOSP=$O(^SC("B",HOSP,"")) S:HOSP'="" HOSP=$P(^SC(HOSP,0),U,15) S:HOSP'="" HOSP=$P($G(^DG(40.8,HOSP,0)),U)
"RTN","MCARP",95,0)
 S PG=PG+1 W:PG>1 @IOF W !!,"Pg. "_PG,?30,HOSP,?79-$L(MCARDTM),MCARDTM
"RTN","MCARP",96,0)
 I (PG>1),($E(IOST,1,2)="C-") W ! Q
"RTN","MCARP",97,0)
 W !,$$HEDSTAR("CONFIDENTIAL "_MCARZ,77)
"RTN","MCARP",98,0)
 W !,MCARGNM_"    "_SSN_"   " W ?39-($L(MCARWARD_" "_MCARRB)\2),MCARWARD_" "_MCARRB,?79-$L(" DOB: "_MCARDOB)," DOB: "_MCARDOB
"RTN","MCARP",99,0)
 W !,?39-($L("PROCEDURE DATE/TIME: "_MCARGDT2)\2),"PROCEDURE DATE/TIME: ",MCARGDT2
"RTN","MCARP",100,0)
 N FFF S $P(FFF,"- ",40)="- " W !,FFF,!
"RTN","MCARP",101,0)
 Q
"RTN","MCARP",102,0)
HEDSTAR(X,X1) ;    surround text string X with asterisks to length X1
"RTN","MCARP",103,0)
 N Y1
"RTN","MCARP",104,0)
 S (TY,Y1)="",$P(Y1," ",X1-$L(X)\2-1)=" ",TY=Y1_" "_X_" "
"RTN","MCARP",105,0)
 F I=$L(TY):1:X1 S TY=TY_" "
"RTN","MCARP",106,0)
 Q TY
"RTN","MCARP",107,0)
MCPPROC ; Get require variables
"RTN","MCARP",108,0)
 D MCPPROC^MCARP1 Q
"RTN","MCARP",109,0)
XTRCT(FULL) ;Extrinsic Function use to determine Full reporting or brief
"RTN","MCARP",110,0)
 Q $S($E($P(FULL,U),3)="B":0,1:1)
"RTN","MCARP",111,0)
MCPROP(MCPROP) ; Medicine Procedure file entry validator
"RTN","MCARP",112,0)
 N TEMP,PREFIX,CNT
"RTN","MCARP",113,0)
 S PREFIX=$S($E(MCPROP,3,4)="ES":7,1:4),TEMP=""
"RTN","MCARP",114,0)
 F CNT=PREFIX+2:1:$L(MCPROP) I $D(^MCAR(697.2,"B",$E(MCPROP,PREFIX+1,CNT))) S TEMP=$E(MCPROP,PREFIX+1,CNT) Q
"RTN","MCARP",115,0)
 Q TEMP
"RTN","MCESEDT")
0^2^B30128477
"RTN","MCESEDT",1,0)
MCESEDT ;WISC/DCB-ELECTRONIC SIGNATURE PART 1 ;4/29/98  15:21
"RTN","MCESEDT",2,0)
 ;;2.3;Medicine;**18**;09/13/1996
"RTN","MCESEDT",3,0)
 ;
"RTN","MCESEDT",4,0)
 ;
"RTN","MCESEDT",5,0)
POST(MCFILE,MCREC) ;Get the info about screen and set-up for edit.
"RTN","MCESEDT",6,0)
 Q:'MCESON
"RTN","MCESEDT",7,0)
 D ENS^%ZISS
"RTN","MCESEDT",8,0)
 N ERROR,HDUZ,HOLD,LOOP,MDAT1,MDAT2,NAME,REC,NEWREC,NEWST,ORG,PROV,RNV,SCRAMBLE,SREC,STATUS,TDATE,TEMP,TEMP1,TY,X1,XDUZ,NCHANGE,LINE,XDATE,DIE,DA,DR,CREAT,SUP,DJDN,CODE,CDUZ,EE,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","MCESEDT",9,0)
 S RNV=+$P($G(^MCAR(697.2,MCARGNUM,0)),U,17),RNV=1
"RTN","MCESEDT",10,0)
 S ERROR=0,REC=MCREC,NCHANGE=0,(ORG,TEMP)=$G(^MCAR(MCFILE,REC,"ES")),EXIT=0,CODE=$P(TEMP,U,7),PROV=$$ESTONUM1^MCESSCR(CODE),$P(LINE,"_",80)="",MCESPED=TEMP,SUP="" K NEWST
"RTN","MCESEDT",11,0)
 S LOOP=PROV
"RTN","MCESEDT",12,0)
 I $P(TEMP,U,5)="" S XDUZ=1
"RTN","MCESEDT",13,0)
 ;I CODE<3,($P(ORG,U,1)="") S $P(TEMP,U,1)=DUZ,$P(ORG,U,1)=DUZ
"RTN","MCESEDT",14,0)
 I PROV<3,($P(ORG,U,1)="") S $P(TEMP,U,1)=DUZ,$P(ORG,U,1)=DUZ
"RTN","MCESEDT",15,0)
 E  S XDUZ=4
"RTN","MCESEDT",16,0)
 S XDUZ=+$P(TEMP,U,XDUZ)
"RTN","MCESEDT",17,0)
 I 'MCESSEC D EDD^MCESEDT2 S ^MCAR(MCFILE,MCARGDA,"ES")=TEMP Q
"RTN","MCESEDT",18,0)
 S CREAT=$$GETDATE(15)
"RTN","MCESEDT",19,0)
 I PROV<1!(PROV>7) S PROV=1
"RTN","MCESEDT",20,0)
 I PROV=8 Q
"RTN","MCESEDT",21,0)
 S Y=$P(^MCAR(MCFILE,REC,0),U,1) D DD^%DT
"RTN","MCESEDT",22,0)
 S MDAT1=Y,MDAT2=$P($G(^MCAR(MCFILE,REC,0)),U,2),MDAT2=$P($G(^MCAR(690,+MDAT2,0)),U,1),MDAT2=$P($G(^DPT(+MDAT2,0)),U,1)
"RTN","MCESEDT",23,0)
 S STATUS=$$STATUS(MCFILE,CODE)
"RTN","MCESEDT",24,0)
 I PROV<3 S TDATE=$$GETDATE(3)
"RTN","MCESEDT",25,0)
 E  I PROV=3!(PROV=4)!(PROV=6)!(PROV=7) S TDATE=$$GETDATE(9)
"RTN","MCESEDT",26,0)
 E  I PROV=5 S TDATE=$$GETDATE(8)
"RTN","MCESEDT",27,0)
 D HEADER
"RTN","MCESEDT",28,0)
 I $P($G(^MCAR(MCFILE,REC,"ES")),U,7)="" D EDITD S ERROR=0 G SKIP
"RTN","MCESEDT",29,0)
 I $D(MCBACK) D EDITSS K MCBACK G SKIP
"RTN","MCESEDT",30,0)
 W !!!
"RTN","MCESEDT",31,0)
 S DIR(0)="Y",DIR("A")=IOINHI_"Do you want to change the release status"_IOINORM,DIR("B")="N" D ^DIR K DIR I $D(DIRUT)!(Y=0) W @IOF N DIE,DA,DR S DIE="^MCAR("_MCFILE_",",DA=REC,DR="1502///NOW" D ^DIE D EXIT Q
"RTN","MCESEDT",32,0)
SK ;
"RTN","MCESEDT",33,0)
 D HEADER,@("EDIT"_$$NUMTOES^MCESSCR(PROV))
"RTN","MCESEDT",34,0)
SKIP ;
"RTN","MCESEDT",35,0)
 I EXIT=0 S $P(TEMP,U,7)=SUP_$$NUMTOES^MCESSCR(LOOP) D:LOOP>2 HEADER
"RTN","MCESEDT",36,0)
 D:EXIT=0 @("ED"_$$NUMTOES^MCESSCR(LOOP)_"^MCESEDT2")
"RTN","MCESEDT",37,0)
 D UPDATE:EXIT=0,NOUPDATE:EXIT=1
"RTN","MCESEDT",38,0)
 I '$D(DTOUT) S DIR(0)="E" D ^DIR K DIR
"RTN","MCESEDT",39,0)
EXIT ;
"RTN","MCESEDT",40,0)
 D KILL^%ZISS W @IOF Q
"RTN","MCESEDT",41,0)
UPDATE ;
"RTN","MCESEDT",42,0)
 W !!,"Record has been updated with new release information",!!
"RTN","MCESEDT",43,0)
 S ORG=$P(ORG,U,7) K:ORG'="" ^MCAR(MCFILE,"ES",ORG,REC)
"RTN","MCESEDT",44,0)
 S ^MCAR(MCFILE,REC,"ES")=TEMP,^MCAR(MCFILE,"ES",$P(TEMP,U,7),REC)=""
"RTN","MCESEDT",45,0)
 Q
"RTN","MCESEDT",46,0)
NOUPDATE ;
"RTN","MCESEDT",47,0)
 W !!,"Record has not been updated with new release information",!!
"RTN","MCESEDT",48,0)
 ;; ***ORIGINAL*** ;; S ^MCAR(MCFILE,REC,"ES")=ORG
"RTN","MCESEDT",49,0)
 ;  The 'IF $GET' was added to the set line to prevent dangling
"RTN","MCESEDT",50,0)
 ;  'ES' nodes when the user supersedes a record, but up-arrows
"RTN","MCESEDT",51,0)
 ;  out of the edit and sign-off of the new record.
"RTN","MCESEDT",52,0)
 I $G(^MCAR(MCFILE,REC,0))]"" S ^MCAR(MCFILE,REC,"ES")=ORG
"RTN","MCESEDT",53,0)
 D DELSS ; NEW LINE
"RTN","MCESEDT",54,0)
 Q
"RTN","MCESEDT",55,0)
EDITD ;Draft
"RTN","MCESEDT",56,0)
EDITPD ;Problem Draft
"RTN","MCESEDT",57,0)
 S DIR("B")=PROV,DIR(0)="S^1:Draft;2:Problem Draft;3:Released On-Line Verified;4:Released Off-line Verified"
"RTN","MCESEDT",58,0)
 S:RNV'=0 DIR(0)=DIR(0)_";5:Released not Verified"
"RTN","MCESEDT",59,0)
 D ASK I EXIT=1,($P($G(^MCAR(MCFILE,REC,"ES")),U,7)="") S TY=1,EXIT=0
"RTN","MCESEDT",60,0)
 Q:EXIT=1
"RTN","MCESEDT",61,0)
 S LOOP=TY
"RTN","MCESEDT",62,0)
 Q
"RTN","MCESEDT",63,0)
EDITSRV ;
"RTN","MCESEDT",64,0)
 S SUP="S"
"RTN","MCESEDT",65,0)
EDITRV ;Released On-Line Verified
"RTN","MCESEDT",66,0)
 S DIR("B")=1,DIR(0)="S^1:Released On-Line Verified;2:Supersede" D ASK Q:EXIT=1
"RTN","MCESEDT",67,0)
 S:TY=2 SUP="" S LOOP=$S(TY=1:3,TY=2:8) Q
"RTN","MCESEDT",68,0)
EDITSROV ;
"RTN","MCESEDT",69,0)
 S SUP="S"
"RTN","MCESEDT",70,0)
EDITROV ;Released Off-Line Verified
"RTN","MCESEDT",71,0)
 S DIR("B")=2,DIR(0)="S^1:Released On-Line Verified;2:Released Off-Line Verified;3:Supersede" D ASK Q:EXIT=1
"RTN","MCESEDT",72,0)
 S:TY=3 SUP="" S LOOP=$S(TY=1:3,TY=2:4,TY=3:8) Q
"RTN","MCESEDT",73,0)
EDITRNV ;Released Not Verified
"RTN","MCESEDT",74,0)
 S DIR("B")=3,DIR(0)="S^1:Released On-Line Verified;2:Released Off-line Verified;3:Released not Verified;4:Supersede" D ASK Q:EXIT=1
"RTN","MCESEDT",75,0)
 S LOOP=$S(TY=1:3,TY=2:4,TY=3:5,TY=4:8) Q
"RTN","MCESEDT",76,0)
EDITSS ;Superseded Change
"RTN","MCESEDT",77,0)
EDITS S SUP="S",DIR("B")=PROV,DIR(0)="S^1:Released On-Line Verified;2:Released Off-line Verified" D ASK
"RTN","MCESEDT",78,0)
 I EXIT=1 D DELSS Q
"RTN","MCESEDT",79,0)
 S LOOP=$S(TY=1:3,TY=2:4) Q
"RTN","MCESEDT",80,0)
DELSS ;
"RTN","MCESEDT",81,0)
 Q:'$D(MCESPREV)
"RTN","MCESEDT",82,0)
 W !!,"Since you did not sign the procedure results this report will be"
"RTN","MCESEDT",83,0)
 W !,"deleted and the superseded report will be convert back the way it was."
"RTN","MCESEDT",84,0)
BACKSS ;
"RTN","MCESEDT",85,0)
 S ^MCAR(MCFILE,MCESPREV,"ES")=MCESTEMP K ^MCAR(MCFILE,"ES","S",MCESPREV)
"RTN","MCESEDT",86,0)
 S ^MCAR(MCFILE,"ES",$P(MCESTEMP,U,7),MCESPREV)="" S DIK="^MCAR("_MCFILE_",",DA=MCARGDA D ^DIK
"RTN","MCESEDT",87,0)
 Q
"RTN","MCESEDT",88,0)
ASK ;Ask for a status code
"RTN","MCESEDT",89,0)
 S DIR("A")=IOINHI_"Please Select a New Status"_IOINORM,DIR("?")="^D HELP^MCESHLP" D ^DIR S TY=Y I $D(DIRUT)!$D(DUOUT)!$D(DTOUT) S EXIT=1
"RTN","MCESEDT",90,0)
 I Y=DIR("B"),(PROV>2) S EXIT=1,NCHANGE=1
"RTN","MCESEDT",91,0)
 K DIR Q:EXIT=1
"RTN","MCESEDT",92,0)
 S NEWST=Y(0) Q
"RTN","MCESEDT",93,0)
HEADER ;
"RTN","MCESEDT",94,0)
 W @IOF,IODHLT,"       * * * Release Control * * *",!,IODHLB,"       * * * Release Control * * *"
"RTN","MCESEDT",95,0)
 W !,LINE
"RTN","MCESEDT",96,0)
 W:CREAT'[1700 !!,?4,IOINHI,"Created on: ",IOINORM,CREAT
"RTN","MCESEDT",97,0)
 W !!,IOINHI,?14,"DATE: ",IOINORM,MDAT1,!,?16,MDAT2,!!,IOINHI,"Current Status: ",IOINORM,IOBON,STATUS,IOBOFF
"RTN","MCESEDT",98,0)
 W:TDATE'="" IOINHI," as of ",IOINORM,TDATE
"RTN","MCESEDT",99,0)
 S NAME=$$DECODE^MCESPRT(ORG,CODE,MCFILE,MCARGDA)
"RTN","MCESEDT",100,0)
 W !,IOINHI,?16,"by: ",IOINORM,NAME
"RTN","MCESEDT",101,0)
 I PROV=4 D PROVID
"RTN","MCESEDT",102,0)
 I PROV=7!(PROV=8) S Y=$P(TEMP,U,14) D DD^%DT W !!,"This record supersedes record created on ",IOUON,Y,IOUOFF,"."
"RTN","MCESEDT",103,0)
 W:$D(NEWST) !!,IOINHI,?8,"New status: ",IOINORM,NEWST
"RTN","MCESEDT",104,0)
 W !,LINE Q
"RTN","MCESEDT",105,0)
PROVID ;
"RTN","MCESEDT",106,0)
 W !,IOINHI,?15,"for: ",IOINORM
"RTN","MCESEDT",107,0)
 S HDUZ=+$P(TEMP,U,4)
"RTN","MCESEDT",108,0)
 I '$D(^VA(200,HDUZ,0)) W "unknown"
"RTN","MCESEDT",109,0)
 E  W $P(^VA(200,HDUZ,0),U,1)
"RTN","MCESEDT",110,0)
 K HDUZ Q
"RTN","MCESEDT",111,0)
GETDATE(EE) ;
"RTN","MCESEDT",112,0)
 N Y S Y=$P(TEMP,U,EE) D DD^%DT Q Y
"RTN","MCESEDT",113,0)
STATUS(FILE,PROV) ;
"RTN","MCESEDT",114,0)
 N Y,C S Y=PROV,C=$P(^DD(FILE,1506,0),U,2) D Y^DIQ
"RTN","MCESEDT",115,0)
 S:Y="" Y="DRAFT"
"RTN","MCESEDT",116,0)
 Q Y
"RTN","MCOR1")
0^1^B9904645
"RTN","MCOR1",1,0)
MCOR1 ;WISC/TJK-OERR/MEDICINE PACKAGE LINKS (PART 2) ;4/27/98  15:20
"RTN","MCOR1",2,0)
 ;;2.3;Medicine;**17,18**;09/13/1996
"RTN","MCOR1",3,0)
 S MCBRANCH=$S(MCFILE=698.3:"SURV",MCFILE=699.5:"GEN",1:"PACE") D @MCBRANCH
"RTN","MCOR1",4,0)
EXIT Q
"RTN","MCOR1",5,0)
SET S MCK=MCK+1,^TMP("MC",$J,MCC,MCK)=MCM_U_MCHEAD Q
"RTN","MCOR1",6,0)
GEN ;
"RTN","MCOR1",7,0)
 W !!,"Full Generalized Procedure report not available through Consults."
"RTN","MCOR1",8,0)
 W !,"See the 'Generalized Procedure Report' option."
"RTN","MCOR1",9,0)
 S MCK=0
"RTN","MCOR1",10,0)
 S MCC="D",MCNODE=0,MCPIECE=8,MCFILE1=697.2,MCHEAD="PROCEDURE" D POINT^MCOREX
"RTN","MCOR1",11,0)
 S MCC="D",MCNODE=0,MCPIECE=6,MCFILE1=697.2,MCHEAD="SUBSPECIALTY" D POINT^MCOREX
"RTN","MCOR1",12,0)
 S MCC="D",MCM=699.534,MCHEAD="ASSESSMENT/FINDINGS;W" D WP^MCOREX
"RTN","MCOR1",13,0)
 Q
"RTN","MCOR1",14,0)
PACE ;
"RTN","MCOR1",15,0)
 S MCC="D",MCNODE=0,MCPIECE=3,MCFILE1=698.4
"RTN","MCOR1",16,0)
 S MCARCODE=$S(MCFILE=698:"PACEMAKER",MCFILE=698.1:"V LEAD",MCFILE=698.2:"A LEAD",1:"")
"RTN","MCOR1",17,0)
 I MCARCODE="" W !!,"Full Procedure report not available through Consults." Q
"RTN","MCOR1",18,0)
 S MCHEAD=MCARCODE_" MODEL" D POINT^MCOREX
"RTN","MCOR1",19,0)
 S MCPIECE=4,MCFILE1=698.6,MCHEAD=MCARCODE_" MANUFACTURER" D POINT^MCOREX
"RTN","MCOR1",20,0)
 S MCPIECE=5,MCHEAD=MCARCODE_" SERIAL NUMBER" D FREE^MCOREX
"RTN","MCOR1",21,0)
 Q
"RTN","MCOR1",22,0)
SURV S MCC="D",MCNODE=4,MCPIECE=4,MCHEAD="FOLLOWUP COMMENT" D FREE^MCOREX
"RTN","MCOR1",23,0)
 S MCM=698.31,MCHEAD="COMMENTS;W" D SET
"RTN","MCOR1",24,0)
 Q
"RTN","MCOR1",25,0)
ENDO S MCC="I",MCNODE=2,MCFILE1=699.6,MCPIECE=1,MCHEAD="INDICATED THERAPY" D MPOINT^MCOREX
"RTN","MCOR1",26,0)
 S MCNODE=3,MCFILE1=695.5,MCHEAD="SIGNS AND SYMPTOMS" D MPOINT^MCOREX
"RTN","MCOR1",27,0)
 S MCNODE=5,MCFILE1=699.84,MCHEAD="DISEASE "_$S(MCARCODE="G":"FOLLOWUP",1:"EVALUATION") D MPOINT^MCOREX
"RTN","MCOR1",28,0)
 S MCNODE=6,MCFILE1=699.85,MCHEAD="FOLLOWUP DEVICE OR THERAPY" D MPOINT^MCOREX
"RTN","MCOR1",29,0)
 I MCARCODE="P" S MCNODE=12,MCPIECE=1,MCHEAD="OTHER FOLLOWUP DEVICE/THERAPY" D FREE^MCOREX
"RTN","MCOR1",30,0)
 S MCNODE=7,MCFILE1=699.86,MCHEAD="SURVEILLANCE" D MPOINT^MCOREX
"RTN","MCOR1",31,0)
 I MCARCODE="G" S MCNODE=31 F MCPIECE=1,2,3 S MCHEAD=$S(MCPIECE=1:"PROTOCOL",MCPIECE=2:"EGD SIMPLE PRIMARY EXAM",1:"LAB OR XRAY") D FREE^MCOREX
"RTN","MCOR1",32,0)
 I MCARCODE="G" S MCNODE=32 F MCPIECE=1,2 S MCHEAD=$S(MCPIECE=1:"OCCULT BLOOD",1:"SPECIMEN COLLECTION") D FREE^MCOREX
"RTN","MCOR1",33,0)
 S MCNODE=0,MCPIECE=6,MCHEAD="INDICATION COMMENT" D FREE^MCOREX
"RTN","MCOR1",34,0)
 S MCC="D",MCNODE=204,MCPIECE=1,MCFILE1=697.5,MCHEAD="PRIMARY DIAGNOSIS" D POINT^MCOREX
"RTN","MCOR1",35,0)
 S MCNODE=205,MCPIECE=1,MCHEAD="PRIMARY DIAGNOSIS IMPRESSION" D FREE^MCOREX
"RTN","MCOR1",36,0)
 S MCNODE=27,MCFILE1=697.5,MCPIECE=1,MCHEAD="SECONDARY DIAGNOSIS" D MPOINT^MCOREX
"RTN","MCOR1",37,0)
 S MCPIECE=2,MCHEAD="SECONDARY DIAGNOSIS IMPRESSION" D MFREE^MCOREX
"RTN","MCOR1",38,0)
 S MCNODE=19 F MCPIECE=1,2,MCHEAD=$S(MCPIECE=1:"DIAGNOSIS/DIAGNOSIS SUPPLEMENT",1:"REVISED DIAGNOSIS") D FREE^MCOREX
"RTN","MCOR1",39,0)
 Q
"RTN","MCPFTP")
0^4^B3751871
"RTN","MCPFTP",1,0)
MCPFTP ;WISC/TJK-PULMONARY FUNCTION TEST PRINT ;3/6/98  16:29
"RTN","MCPFTP",2,0)
 ;;2.3;Medicine;**17,18**;09/13/1996
"RTN","MCPFTP",3,0)
DIC ;
"RTN","MCPFTP",4,0)
 D MCPPROC^MCARP
"RTN","MCPFTP",5,0)
 S MCBP=$S($E(XQY0,3,3)="B":1,1:0)
"RTN","MCPFTP",6,0)
 S DIC="^MCAR(700,",DIC(0)="AEQMZ"
"RTN","MCPFTP",7,0)
 G:$G(MCARGDA)>0 SUM
"RTN","MCPFTP",8,0)
 S:MCESON DIC("S")=$$PREVIEW^MCESSCR(MCFILE)
"RTN","MCPFTP",9,0)
 D ^DIC K DIC G EXIT:Y<0
"RTN","MCPFTP",10,0)
 S MCARGDA=+Y
"RTN","MCPFTP",11,0)
 ;
"RTN","MCPFTP",12,0)
SUM ;    Entry point when procedure # (MCARGDA) is already defined.
"RTN","MCPFTP",13,0)
 ;    Called by Summary of Patient Procedures, Interpretation Enter/
"RTN","MCPFTP",14,0)
 ;    Edit.
"RTN","MCPFTP",15,0)
 S MCARZ="PULMONARY FUNCTION TEST REPORT"
"RTN","MCPFTP",16,0)
 D:$G(MCESON) STATUS^MCESPRT(MCFILE,MCARGDA)
"RTN","MCPFTP",17,0)
 S MCPFT0=^MCAR(700,MCARGDA,0),MCFILE=700,DFN=$P(^(0),U,2)
"RTN","MCPFTP",18,0)
 I $D(ORHFS) U IO G PRINT ;dcm/slc added for CPRS
"RTN","MCPFTP",19,0)
DEVQUE ; Device Control and Queuing Control
"RTN","MCPFTP",20,0)
 K IO("Q") S %ZIS="MQ" D ^%ZIS I POP G EXIT
"RTN","MCPFTP",21,0)
 I $D(IO("Q")) K IO("Q") S (ZTSAVE("MC*"),ZTSAVE("DFN"),ZTSAVE("DIC"))="",ZTRTN=$S($G(MCBP)=1:"^MCBPFTP1",1:"^MCPFTP1"),ZTDESC="PFT REPORT" D ^%ZTLOAD K ZTSK G EXIT
"RTN","MCPFTP",22,0)
 U IO
"RTN","MCPFTP",23,0)
PRINT S HOSP=$P($G(^DPT(DFN,.1)),U) S:HOSP'="" HOSP=$O(^SC("B",HOSP,"")) S:HOSP'="" HOSP=$P(^SC(HOSP,0),U,15) S:HOSP'="" HOSP=$P($G(^DG(40.8,HOSP,0)),U) S PG=0
"RTN","MCPFTP",24,0)
 G:$G(MCBP)=1 ^MCBPFTP1 G ^MCPFTP1
"RTN","MCPFTP",25,0)
EXIT K DFN,MCARGDA,MCPFT0,Y,POP
"RTN","MCPFTP",26,0)
 K MCAR,MCARDOB,MCARDTM,MCARHDR,MCARRB,MCARWARD,MCRHR,VADM,VAIN
"RTN","MCPFTP",27,0)
 K MCARP,MCFILE,MCESON,MCESKEY,MCROUT,MCTYPE,MCARGDA
"RTN","MCPFTP",28,0)
 K MCPBRIEF,MCPFULL,MCPRTRTN,MCBS
"RTN","MCPFTP",29,0)
 D ^%ZISC Q
"RTN","MCPFTP5")
0^5^B22328319
"RTN","MCPFTP5",1,0)
MCPFTP5 ;WISC/TJK-PFT REPORT-SPECIAL STUDIES (PT 2) ;7/6/98  10:32
"RTN","MCPFTP5",2,0)
 ;;2.3;Medicine;**18**;09/13/1996
"RTN","MCPFTP5",3,0)
EX S ND=MCREC1,MCP1=MCP1S1,MCP2=MCP2S1,VE=$P(MCREC1,U,1),MCEX=$P(MCREC2,U,9)
"RTN","MCPFTP5",4,0)
 S MEAS="VEmax(BTPS)",UNITS="L",PC=1 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",5,0)
 S MEAS="BR",PC=2 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",6,0)
 S MEAS="VD/VT REST",PC=14 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",7,0)
 S MEAS="VD/VT MAX",PC=15 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",8,0)
 S MEAS="VE/VCO2, AT",PC=16 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",9,0)
 S MEAS="VErest(BTPS)",UNITS="ml/beat",PC=5 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",10,0)
 K VE S MEAS="VO2rest",UNITS="L/min",PC=6 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",11,0)
 S MEAS="VO2max",UNITS="L/min",PC=7 I MCEX=1 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2
"RTN","MCPFTP5",12,0)
 D:(MCEX=3)!(MCEX=2) VO2MAX Q:$D(MCOUT)
"RTN","MCPFTP5",13,0)
 S MEAS="AT",UNITS="L",PC=3 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",14,0)
 S MEAS="HRrest",UNITS="BPM",PC=8 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",15,0)
 S MEAS="HRmax",PC=9 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",16,0)
 S MEAS="VO2/HR",PC=11,UNITS="ML" S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",17,0)
 S MEAS="BP MAX",PC=12,UNITS="" S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",18,0)
 S MEAS="EKG",PC=13 S ACT=$P(ND,U,PC) W !,?5,MEAS,?35,$S(ACT="N":"NORMAL",ACT="A":"ABNORMAL",1:"") X MCFF Q:$D(MCOUT)
"RTN","MCPFTP5",19,0)
 S MEAS="RRrest",UNITS="brths/m",PC=10 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",20,0)
 S ND=MCREC2,MCP1=MCP1S2,MCP2=MCP2S2,MEAS="RRmax",PC=1 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",21,0)
 S MEAS="Wmax",UNITS="wrpm/min",PC=2 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",22,0)
 S MEAS="WRI/WRT",UNITS="watts/min",PC=6 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",23,0)
 S MEAS="Max Speed",UNITS="mph",PC=4 S ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",24,0)
 S MEAS="Max Grade",UNITS="%",PC=5 S ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",25,0)
 S PRED="",MEAS="TOTAL TIME",UNITS="min",PC=3 S ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",26,0)
 S MEAS="HCO3 Change",UNITS="mg/dl",PC=10 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",27,0)
 W !,?5,"Exercise Testing Mode: ",$S(MCEX=1:"TREADMILL",MCEX=2:"BIKE ERGOMETER",MCEX=3:"HAND ERGOMETER",1:"") X MCFF Q:$D(MCOUT)  K MCEX
"RTN","MCPFTP5",28,0)
 W !,?5,"REASON(S) FOR STOPPING:"
"RTN","MCPFTP5",29,0)
 S MCX(1)=0 F  S MCX(1)=$O(^MCAR(700,MCARGDA,"S",MCX,3,MCX(1))) Q:MCX(1)'?1N.N  S MCX(2)=$G(^(MCX(1),0)) I MCX(2) W ?32,$P($G(^MCAR(695.8,MCX(2),0)),U),! K MCX(2) X MCFF Q:$D(MCOUT)
"RTN","MCPFTP5",30,0)
 Q:$D(MCOUT)  K ^UTILITY($J,"W") S MCX(1)=0 F  S MCX(1)=$O(^MCAR(700,MCARGDA,"S",MCX,4,MCX(1))) Q:MCX(1)'?1N.N  S X=$G(^(MCX(1),0)),DIWL=33,DIWR=75,DIWF="W" D ^DIWP
"RTN","MCPFTP5",31,0)
 D ^DIWW
"RTN","MCPFTP5",32,0)
EXEND G SPEC1^MCPFTP4
"RTN","MCPFTP5",33,0)
INT K HEAD1 Q:$E(MCDOT,1)=" "
"RTN","MCPFTP5",34,0)
 W !! X MCFF Q:$D(MCOUT)  W "INTERPRETATION",$E(MCDOT,1,66) X MCFF Q:$D(MCOUT)
"RTN","MCPFTP5",35,0)
 K DXS,DIOT(2),^UTILITY($J) S ^UTILITY($J,1)=MCFF,D0=MCARGDA D ^MCAROPF K ^UTILITY($J,1)
"RTN","MCPFTP5",36,0)
EXIT Q:$E(MCDOT)=" "  D CONT Q:$D(MCOUT)  D PV Q
"RTN","MCPFTP5",37,0)
PV ;
"RTN","MCPFTP5",38,0)
 I $G(MCPV)<1 S MCPV=$$MCPV^MCPFTP1(MCARGDA)
"RTN","MCPFTP5",39,0)
 Q:'$D(MCPV)  Q:'$D(^MCAR(700.1,MCPV))
"RTN","MCPFTP5",40,0)
 D HEAD^MCARP
"RTN","MCPFTP5",41,0)
PV1 ;
"RTN","MCPFTP5",42,0)
 I $G(MCPV)<1 S MCPV=$$MCPV^MCPFTP1(MCARGDA)
"RTN","MCPFTP5",43,0)
 Q:'$D(MCPV)
"RTN","MCPFTP5",44,0)
 W !!?25,"PREDICTED VALUE FORMULAS USED",!
"RTN","MCPFTP5",45,0)
 F J="TLC","VC","FRC","RV","FVC","FEV1","PF","FEF2575","MVV","DLCOSB","COHB","HB" D
"RTN","MCPFTP5",46,0)
   .S I=$G(^MCAR(700.1,MCPV,J)) Q:'I
"RTN","MCPFTP5",47,0)
   .Q:'$D(^MCAR(700.2,I,0))  S I=$G(^(0))
"RTN","MCPFTP5",48,0)
   .W !,?5,$S(J="DLCOSB":"DLCO-SB",J="FEF2575":"FEF25-75",J="COHB":"COHB CORR.",J="HB":"HB CORR.",1:J)
"RTN","MCPFTP5",49,0)
   .D PVW
"RTN","MCPFTP5",50,0)
   .K J Q
"RTN","MCPFTP5",51,0)
 G PVEXIT:'$D(MCRC1)
"RTN","MCPFTP5",52,0)
 W !!?25,"RACE CORRECTION FORMULAS USED",!
"RTN","MCPFTP5",53,0)
 I $D(MCRC2) S I=$P($G(^MCAR(700.1,MCPV,"RC")),U,2) I I,$D(^MCAR(700.2,I,0)) S I=$G(^(0)) W !,?5,"TLC,VC,FVC,FEV1" D PVW G PVEXIT
"RTN","MCPFTP5",54,0)
 F J=1,3,4 S I=$P($G(^MCAR(700.1,MCPV,"RC")),U,J) I I,$D(^MCAR(700.2,I,0)) S I=$G(^(0)) W !,?5,$S(J=1:"TLC,VC,FVC,FEV1",J=3:"FRC,RV",1:"FEF25-75") D PVW
"RTN","MCPFTP5",55,0)
PVEXIT W !,"NOTE:  HT=height,WT=weight,ACT=actual measurement value" D CONT Q
"RTN","MCPFTP5",56,0)
PVW W ?21,$P(I,U),?50,$P(I,U,3) Q
"RTN","MCPFTP5",57,0)
CONT Q:($E(IOST,1,2)'="C-")!($D(MCOUT))  R !!,"Press Return to Continue, '^' to escape: ",MCY:DTIME S:'$T MCY=U S:MCY=U MCOUT=1 Q
"RTN","MCPFTP5",58,0)
COMP S I=0 F  S I=$O(^MCAR(700,MCARGDA,24,I)) Q:I'?1N.N  I $D(^(I,0)),$P(^(0),U,2)="Y" S J=$P(^(0),U,1) W:$D(^MCAR(693.2,J,0)) ?17,$P(^(0),U,1),!
"RTN","MCPFTP5",59,0)
 Q
"RTN","MCPFTP5",60,0)
VO2ER1(MCSEX) ;
"RTN","MCPFTP5",61,0)
 Q $S(MCSEX="F":(42.8+WT)*(22.78-(.17*AGE)),1:(.79*HT-60.7))
"RTN","MCPFTP5",62,0)
VO2ER2(MCSEX) ;
"RTN","MCPFTP5",63,0)
 Q $S(MCSEX="F":HT*(14.81-(.11*AGE)),1:50.72-(0.372*AGE))
"RTN","MCPFTP5",64,0)
VO2MAX ;
"RTN","MCPFTP5",65,0)
 S ER1=$$VO2ER1(MCSEX),ER2=$$VO2ER2(MCSEX),PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q
"VER")
8.0^21.0
**END**
**END**
