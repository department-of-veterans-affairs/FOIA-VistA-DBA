EMERGENCY Released PSN*4*107 SEQ #102
Extracted from mail message
**KIDS**:PSN*4.0*107^

**INSTALL NAME**
PSN*4.0*107
"BLD",859,0)
PSN*4.0*107^NATIONAL DRUG FILE^0^3060403^y
"BLD",859,1,0)
^^57^57^3060403^^^^
"BLD",859,1,1,0)
 
"BLD",859,1,2,0)
 
"BLD",859,1,3,0)
It has been noted that several sites have made local entries in the DRUG
"BLD",859,1,4,0)
INGREDIENTS file (#50.416).  This should not have been done.  Patch
"BLD",859,1,5,0)
PSN*4*89 changed the data dictionary of that file to prevent further
"BLD",859,1,6,0)
additions.  Some of these local entries may have already been overwritten
"BLD",859,1,7,0)
by national entries.
"BLD",859,1,8,0)
 
"BLD",859,1,9,0)
It has also been noted that some sites have added local entries in the
"BLD",859,1,10,0)
DRUG INTERACTION file (#56) involving these locally added ingredients.
"BLD",859,1,11,0)
If the locally added ingredients have been overwritten, these interactions
"BLD",859,1,12,0)
will check for ingredients other than those indicated by the name of the
"BLD",859,1,13,0)
interaction.
"BLD",859,1,14,0)
 
"BLD",859,1,15,0)
This patch performs six functions.
"BLD",859,1,16,0)
 
"BLD",859,1,17,0)
1.  It creates a new style cross-reference on the NAME field (#.01) and the
"BLD",859,1,18,0)
    PRIMARY INGREDIENT field (#2) of the DRUG INGREDIENTS file (#50.416). 
"BLD",859,1,19,0)
    This new cross-reference replaces the old "P" cross-reference on the
"BLD",859,1,20,0)
    NAME field (#.01). The "P" cross reference was not working properly
"BLD",859,1,21,0)
    and included entries that should not have been referenced. This
"BLD",859,1,22,0)
    corrects the Patient Safety Issue PSI-05-008.
"BLD",859,1,23,0)
 
"BLD",859,1,24,0)
2.  Any entries in the DRUG INGREDIENTS file (#50.416) with an internal
"BLD",859,1,25,0)
    entry number (IEN) greater than that of the last nationally entered
"BLD",859,1,26,0)
    ingredient will be deleted. These would be locally entered ingredients
"BLD",859,1,27,0)
    that would eventually be overwritten with national ingredients released
"BLD",859,1,28,0)
    with NDF Data Updates.
"BLD",859,1,29,0)
 
"BLD",859,1,30,0)
3.  Any entries in the DRUG INTERACTIONS file (#56) which have ingredients
"BLD",859,1,31,0)
    pointing to these deleted locally entered ingredients will be deleted.
"BLD",859,1,32,0)
 
"BLD",859,1,33,0)
4.  Any entries in the DRUG INTERACTIONS file (#56) which point to ingredients
"BLD",859,1,34,0)
    other than those indicated by the name will be deleted. These would 
"BLD",859,1,35,0)
    be interactions created with a locally entered ingredient that was
"BLD",859,1,36,0)
    subsequently overwritten by a national ingredient.
"BLD",859,1,37,0)
 
"BLD",859,1,38,0)
5.  A mail message with the subject INGREDIENTS AND INTERACTIONS DELETED
"BLD",859,1,39,0)
    will be sent from NDF MANAGER to members of the mail group NDF DATA,
"BLD",859,1,40,0)
    holders of the PSNMGR security key, and the person installing the
"BLD",859,1,41,0)
    patch.  This message lists deleted ingredients, interactions deleted
"BLD",859,1,42,0)
    because they pointed to deleted ingredients, and interactions which
"BLD",859,1,43,0)
    pointed to ingredients other than those indicated in the name.  In
"BLD",859,1,44,0)
    the last case, both the name (containing the original ingredients)
"BLD",859,1,45,0)
    and the current ingredients are displayed.
"BLD",859,1,46,0)
 
"BLD",859,1,47,0)
6.  The GMR ALLERGY field (#1) and the DRUG INGREDIENT field (#.01)
"BLD",859,1,48,0)
    of the DRUG INGREDIENTS multiple field (#2) in the PATIENT ALLERGIES file
"BLD",859,1,49,0)
    (#120.8) and the DRUG INGREDIENT field (#.01) of the DRUG INGREDIENTS
"BLD",859,1,50,0)
    multiple field (#2) in the GMR ALLERGIES file (#120.82) point to the
"BLD",859,1,51,0)
    DRUG INGREDIENTS file (#50.416).  Any entries in these fields that
"BLD",859,1,52,0)
    point to ingredients that were deleted as described in item 2 above
"BLD",859,1,53,0)
    will be deleted.  In addition, the selection of drug ingredients in the
"BLD",859,1,54,0)
    PATIENT ALLERGIES file (#120.8) should allow the selection of only
"BLD",859,1,55,0)
    primary ingredients.  Any entries that point to ingredients that are
"BLD",859,1,56,0)
    not primary ingredients will be repointed to the proper primary
"BLD",859,1,57,0)
    ingredient.
"BLD",859,4,0)
^9.64PA^50.416^1
"BLD",859,4,50.416,0)
50.416
"BLD",859,4,50.416,2,0)
^9.641^50.416^1
"BLD",859,4,50.416,2,50.416,0)
DRUG INGREDIENTS  (File-top level)
"BLD",859,4,50.416,2,50.416,1,0)
^9.6411^2^2
"BLD",859,4,50.416,2,50.416,1,.01,0)
NAME
"BLD",859,4,50.416,2,50.416,1,2,0)
PRIMARY INGREDIENT
"BLD",859,4,50.416,222)
y^y^p^^^^n^^n
"BLD",859,4,50.416,224)

"BLD",859,4,"APDD",50.416,50.416)

"BLD",859,4,"APDD",50.416,50.416,.01)

"BLD",859,4,"APDD",50.416,50.416,2)

"BLD",859,4,"B",50.416,50.416)

"BLD",859,"ABPKG")
n
"BLD",859,"INI")

"BLD",859,"INID")
y^y
"BLD",859,"INIT")
PSNCLING
"BLD",859,"KRN",0)
^9.67PA^8989.52^19
"BLD",859,"KRN",.4,0)
.4
"BLD",859,"KRN",.401,0)
.401
"BLD",859,"KRN",.402,0)
.402
"BLD",859,"KRN",.403,0)
.403
"BLD",859,"KRN",.5,0)
.5
"BLD",859,"KRN",.84,0)
.84
"BLD",859,"KRN",3.6,0)
3.6
"BLD",859,"KRN",3.8,0)
3.8
"BLD",859,"KRN",9.2,0)
9.2
"BLD",859,"KRN",9.8,0)
9.8
"BLD",859,"KRN",19,0)
19
"BLD",859,"KRN",19.1,0)
19.1
"BLD",859,"KRN",101,0)
101
"BLD",859,"KRN",409.61,0)
409.61
"BLD",859,"KRN",771,0)
771
"BLD",859,"KRN",870,0)
870
"BLD",859,"KRN",8989.51,0)
8989.51
"BLD",859,"KRN",8989.52,0)
8989.52
"BLD",859,"KRN",8994,0)
8994
"BLD",859,"KRN","B",.4,.4)

"BLD",859,"KRN","B",.401,.401)

"BLD",859,"KRN","B",.402,.402)

"BLD",859,"KRN","B",.403,.403)

"BLD",859,"KRN","B",.5,.5)

"BLD",859,"KRN","B",.84,.84)

"BLD",859,"KRN","B",3.6,3.6)

"BLD",859,"KRN","B",3.8,3.8)

"BLD",859,"KRN","B",9.2,9.2)

"BLD",859,"KRN","B",9.8,9.8)

"BLD",859,"KRN","B",19,19)

"BLD",859,"KRN","B",19.1,19.1)

"BLD",859,"KRN","B",101,101)

"BLD",859,"KRN","B",409.61,409.61)

"BLD",859,"KRN","B",771,771)

"BLD",859,"KRN","B",870,870)

"BLD",859,"KRN","B",8989.51,8989.51)

"BLD",859,"KRN","B",8989.52,8989.52)

"BLD",859,"KRN","B",8994,8994)

"BLD",859,"PRE")
PSN107E
"BLD",859,"QUES",0)
^9.62^^
"BLD",859,"REQB",0)
^9.611^1^1
"BLD",859,"REQB",1,0)
PSN*4.0*105^1
"BLD",859,"REQB","B","PSN*4.0*105",1)

"FIA",50.416)
DRUG INGREDIENTS
"FIA",50.416,0)
^PS(50.416,
"FIA",50.416,0,0)
50.416O
"FIA",50.416,0,1)
y^y^p^^^^n^^n
"FIA",50.416,0,10)

"FIA",50.416,0,11)

"FIA",50.416,0,"RLRO")

"FIA",50.416,0,"VR")
4.0^PSN
"FIA",50.416,50.416)
1
"FIA",50.416,50.416,.01)

"FIA",50.416,50.416,2)

"INIT")
PSNCLING
"IX",50.416,50.416,"P1",0)
50.416^P1^CROSS REFERENCE ON PRIMARY INGREDIENT^MU^^R^IR^I^50.416^^^^^LS
"IX",50.416,50.416,"P1",.1,0)
^^1^1^3050707
"IX",50.416,50.416,"P1",.1,1,0)
 
"IX",50.416,50.416,"P1",1)
I X2(1)'="",X2(2)="" S ^PS(50.416,"P",X2(1),DA)=""
"IX",50.416,50.416,"P1",2)
I X2(1)=""!(X2(2)'="")!(X1(1)'=X2(1)) K ^PS(50.416,"P",X1(1),DA)
"IX",50.416,50.416,"P1",2.5)
K ^PS(50.416,"P")
"IX",50.416,50.416,"P1",11.1,0)
^.114IA^2^2
"IX",50.416,50.416,"P1",11.1,1,0)
1^F^50.416^.01^^^F
"IX",50.416,50.416,"P1",11.1,2,0)
2^F^50.416^2^^^F
"MBREQ")
0
"PKG",114,-1)
1^1
"PKG",114,0)
NATIONAL DRUG FILE^PSN^This is the National Drug File Package V 4
"PKG",114,20,0)
^9.402P^^
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
4.0^3041105
"PKG",114,22,1,"PAH",1,0)
107^3060403
"PKG",114,22,1,"PAH",1,1,0)
^^57^57^3060403
"PKG",114,22,1,"PAH",1,1,1,0)
 
"PKG",114,22,1,"PAH",1,1,2,0)
 
"PKG",114,22,1,"PAH",1,1,3,0)
It has been noted that several sites have made local entries in the DRUG
"PKG",114,22,1,"PAH",1,1,4,0)
INGREDIENTS file (#50.416).  This should not have been done.  Patch
"PKG",114,22,1,"PAH",1,1,5,0)
PSN*4*89 changed the data dictionary of that file to prevent further
"PKG",114,22,1,"PAH",1,1,6,0)
additions.  Some of these local entries may have already been overwritten
"PKG",114,22,1,"PAH",1,1,7,0)
by national entries.
"PKG",114,22,1,"PAH",1,1,8,0)
 
"PKG",114,22,1,"PAH",1,1,9,0)
It has also been noted that some sites have added local entries in the
"PKG",114,22,1,"PAH",1,1,10,0)
DRUG INTERACTION file (#56) involving these locally added ingredients.
"PKG",114,22,1,"PAH",1,1,11,0)
If the locally added ingredients have been overwritten, these interactions
"PKG",114,22,1,"PAH",1,1,12,0)
will check for ingredients other than those indicated by the name of the
"PKG",114,22,1,"PAH",1,1,13,0)
interaction.
"PKG",114,22,1,"PAH",1,1,14,0)
 
"PKG",114,22,1,"PAH",1,1,15,0)
This patch performs six functions.
"PKG",114,22,1,"PAH",1,1,16,0)
 
"PKG",114,22,1,"PAH",1,1,17,0)
1.  It creates a new style cross-reference on the NAME field (#.01) and the
"PKG",114,22,1,"PAH",1,1,18,0)
    PRIMARY INGREDIENT field (#2) of the DRUG INGREDIENTS file (#50.416). 
"PKG",114,22,1,"PAH",1,1,19,0)
    This new cross-reference replaces the old "P" cross-reference on the
"PKG",114,22,1,"PAH",1,1,20,0)
    NAME field (#.01). The "P" cross reference was not working properly
"PKG",114,22,1,"PAH",1,1,21,0)
    and included entries that should not have been referenced. This
"PKG",114,22,1,"PAH",1,1,22,0)
    corrects the Patient Safety Issue PSI-05-008.
"PKG",114,22,1,"PAH",1,1,23,0)
 
"PKG",114,22,1,"PAH",1,1,24,0)
2.  Any entries in the DRUG INGREDIENTS file (#50.416) with an internal
"PKG",114,22,1,"PAH",1,1,25,0)
    entry number (IEN) greater than that of the last nationally entered
"PKG",114,22,1,"PAH",1,1,26,0)
    ingredient will be deleted. These would be locally entered ingredients
"PKG",114,22,1,"PAH",1,1,27,0)
    that would eventually be overwritten with national ingredients released
"PKG",114,22,1,"PAH",1,1,28,0)
    with NDF Data Updates.
"PKG",114,22,1,"PAH",1,1,29,0)
 
"PKG",114,22,1,"PAH",1,1,30,0)
3.  Any entries in the DRUG INTERACTIONS file (#56) which have ingredients
"PKG",114,22,1,"PAH",1,1,31,0)
    pointing to these deleted locally entered ingredients will be deleted.
"PKG",114,22,1,"PAH",1,1,32,0)
 
"PKG",114,22,1,"PAH",1,1,33,0)
4.  Any entries in the DRUG INTERACTIONS file (#56) which point to ingredients
"PKG",114,22,1,"PAH",1,1,34,0)
    other than those indicated by the name will be deleted. These would 
"PKG",114,22,1,"PAH",1,1,35,0)
    be interactions created with a locally entered ingredient that was
"PKG",114,22,1,"PAH",1,1,36,0)
    subsequently overwritten by a national ingredient.
"PKG",114,22,1,"PAH",1,1,37,0)
 
"PKG",114,22,1,"PAH",1,1,38,0)
5.  A mail message with the subject INGREDIENTS AND INTERACTIONS DELETED
"PKG",114,22,1,"PAH",1,1,39,0)
    will be sent from NDF MANAGER to members of the mail group NDF DATA,
"PKG",114,22,1,"PAH",1,1,40,0)
    holders of the PSNMGR security key, and the person installing the
"PKG",114,22,1,"PAH",1,1,41,0)
    patch.  This message lists deleted ingredients, interactions deleted
"PKG",114,22,1,"PAH",1,1,42,0)
    because they pointed to deleted ingredients, and interactions which
"PKG",114,22,1,"PAH",1,1,43,0)
    pointed to ingredients other than those indicated in the name.  In
"PKG",114,22,1,"PAH",1,1,44,0)
    the last case, both the name (containing the original ingredients)
"PKG",114,22,1,"PAH",1,1,45,0)
    and the current ingredients are displayed.
"PKG",114,22,1,"PAH",1,1,46,0)
 
"PKG",114,22,1,"PAH",1,1,47,0)
6.  The GMR ALLERGY field (#1) and the DRUG INGREDIENT field (#.01)
"PKG",114,22,1,"PAH",1,1,48,0)
    of the DRUG INGREDIENTS multiple field (#2) in the PATIENT ALLERGIES file
"PKG",114,22,1,"PAH",1,1,49,0)
    (#120.8) and the DRUG INGREDIENT field (#.01) of the DRUG INGREDIENTS
"PKG",114,22,1,"PAH",1,1,50,0)
    multiple field (#2) in the GMR ALLERGIES file (#120.82) point to the
"PKG",114,22,1,"PAH",1,1,51,0)
    DRUG INGREDIENTS file (#50.416).  Any entries in these fields that
"PKG",114,22,1,"PAH",1,1,52,0)
    point to ingredients that were deleted as described in item 2 above
"PKG",114,22,1,"PAH",1,1,53,0)
    will be deleted.  In addition, the selection of drug ingredients in the
"PKG",114,22,1,"PAH",1,1,54,0)
    PATIENT ALLERGIES file (#120.8) should allow the selection of only
"PKG",114,22,1,"PAH",1,1,55,0)
    primary ingredients.  Any entries that point to ingredients that are
"PKG",114,22,1,"PAH",1,1,56,0)
    not primary ingredients will be repointed to the proper primary
"PKG",114,22,1,"PAH",1,1,57,0)
    ingredient.
"PRE")
PSN107E
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSN107E")
0^^B664156
"RTN","PSN107E",1,0)
PSN107E ;BIR/DMA-environment check for cleanup ; 18 Jan 2006  8:46 AM
"RTN","PSN107E",2,0)
 ;;4.0; NATIONAL DRUG FILE;**107**; 30 Oct 98
"RTN","PSN107E",3,0)
 I $O(^PSNDF(50.68,17466)) W !,"A subsequent data patch has been installed.  This patch will not be installed" S XPDQUIT=1
"RTN","PSN107E",4,0)
 Q
"RTN","PSNCLING")
0^^B84044539
"RTN","PSNCLING",1,0)
PSNCLING ;BIR/DMA-clean up ingredients and interactions ; 19 Jan 2006  9:45 AM
"RTN","PSNCLING",2,0)
 ;;4.0; NATIONAL DRUG FILE;**107**; 3O Oct 98
"RTN","PSNCLING",3,0)
 ;
"RTN","PSNCLING",4,0)
 ;Reference to ^GMRD(120.8 supported by DBIA# 2545
"RTN","PSNCLING",5,0)
 ;Reference to ADCOM^GMRAFX supported by DBIA# 4783 
"RTN","PSNCLING",6,0)
 ;
"RTN","PSNCLING",7,0)
 ;delete existing cross reference
"RTN","PSNCLING",8,0)
 K ^PS(50.416,"P")
"RTN","PSNCLING",9,0)
 ;and the entries
"RTN","PSNCLING",10,0)
 ;
"RTN","PSNCLING",11,0)
 ;following code generated by DIKCBLD
"RTN","PSNCLING",12,0)
 N PSNXR,PSNRES,PSNOUT
"RTN","PSNCLING",13,0)
 S PSNXR("FILE")=50.416
"RTN","PSNCLING",14,0)
 S PSNXR("NAME")="P1"
"RTN","PSNCLING",15,0)
 S PSNXR("TYPE")="MU"
"RTN","PSNCLING",16,0)
 S PSNXR("USE")="LS"
"RTN","PSNCLING",17,0)
 S PSNXR("EXECUTION")="R"
"RTN","PSNCLING",18,0)
 S PSNXR("ACTIVITY")="IR"
"RTN","PSNCLING",19,0)
 S PSNXR("SHORT DESCR")="CROSS REFERENCE ON PRIMARY INGREDIENT"
"RTN","PSNCLING",20,0)
 S PSNXR("DESCR",1)=" "
"RTN","PSNCLING",21,0)
 S PSNXR("SET")="I X2(1)'="""",X2(2)="""" S ^PS(50.416,""P"",X2(1),DA)="""""
"RTN","PSNCLING",22,0)
 S PSNXR("KILL")="I X2(1)=""""!(X2(2)'="""")!(X1(1)'=X2(1)) K ^PS(50.416,""P"",X1(1),DA)"
"RTN","PSNCLING",23,0)
 S PSNXR("WHOLE KILL")="K ^PS(50.416,""P"")"
"RTN","PSNCLING",24,0)
 S PSNXR("VAL",1)=.01
"RTN","PSNCLING",25,0)
 S PSNXR("VAL",1,"COLLATION")="F"
"RTN","PSNCLING",26,0)
 S PSNXR("VAL",2)=2
"RTN","PSNCLING",27,0)
 S PSNXR("VAL",2,"COLLATION")="F"
"RTN","PSNCLING",28,0)
 D CREIXN^DDMOD(.PSNXR,"SW",.PSNRES,"PSNOUT")
"RTN","PSNCLING",29,0)
 ;end of generated code
"RTN","PSNCLING",30,0)
 ;
"RTN","PSNCLING",31,0)
 N DA,DIE,DIK,DR,J,LINE,NA,OLD,PSN,PSN1,PSN11,PSN2,PSN21,PSNA1,PSNA2,PSNDA,PSNFREE,PSNI,PSNI1,PSNI2,PSNPAT,PSNPSNI1,PSNK,PSNN,PSNN1,PSNQ,PSNX,X,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","PSNCLING",32,0)
 K ^TMP($J),^TMP("PSN",$J)
"RTN","PSNCLING",33,0)
 S DA=4254
"RTN","PSNCLING",34,0)
 F  S DA=$O(^PS(50.416,DA)) Q:'DA  S X=$P(^(DA,0),"^"),^TMP($J,X)="",DIK="^PS(50.416," D ^DIK
"RTN","PSNCLING",35,0)
 ;
"RTN","PSNCLING",36,0)
MESSAGE ;
"RTN","PSNCLING",37,0)
 F LINE=1:1 S X=$P($T(TEXT+LINE),";",3,300) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X
"RTN","PSNCLING",38,0)
 I '$D(^TMP($J)) S ^TMP("PSN",$J,LINE,0)="none found",LINE=LINE+1
"RTN","PSNCLING",39,0)
 S NA="" F LINE=LINE:1 S NA=$O(^TMP($J,NA)) Q:NA=""  S ^TMP("PSN",$J,LINE,0)=NA
"RTN","PSNCLING",40,0)
 ;
"RTN","PSNCLING",41,0)
 ;
"RTN","PSNCLING",42,0)
 ;now the interactions
"RTN","PSNCLING",43,0)
 K ^TMP($J)
"RTN","PSNCLING",44,0)
 ;
"RTN","PSNCLING",45,0)
 S DA=14999 F  S DA=$O(^PS(56,DA)) Q:'DA  S X=^(DA,0),OLD=$P(X,"^") K PSN,PSNN D
"RTN","PSNCLING",46,0)
 .S PSNI1=$P(X,"^",2),PSNI2=$P(X,"^",3) I '$D(^PS(50.416,PSNI1,0))!'$D(^PS(50.416,PSNI2,0)) S ^TMP($J,1,OLD)="",DIK="^PS(56," D ^DIK Q
"RTN","PSNCLING",47,0)
 .S PSN($P(^PS(50.416,PSNI1,0),"^"))="",PSN($P(^PS(50.416,PSNI2,0),"^"))="",PSNN=$O(PSN(""))_"/"_$O(PSN($O(PSN("")))),PSNQ=0 I PSNN'=OLD D  Q:PSNQ
"RTN","PSNCLING",48,0)
 ..S PSNN1=$P(PSNN,"/",2)_"/"_$P(PSNN,"/") I PSNN1=OLD S DIE="^PS(56,",DR=".01////"_PSNN D ^DIE Q
"RTN","PSNCLING",49,0)
 ..S ^TMP($J,2,OLD)=PSNN,DIK="^PS(56," D ^DIK S PSNQ=1 Q
"RTN","PSNCLING",50,0)
 .S X=$P(^PS(50.416,PSNI1,0),"^",2) I X S $P(^PS(56,DA,0),"^",2)=X,PSNI1=X
"RTN","PSNCLING",51,0)
 .S X=$P(^PS(50.416,PSNI2,0),"^",2) I X S $P(^PS(56,DA,0),"^",3)=X,PSNI2=X
"RTN","PSNCLING",52,0)
 .K PSN,PSNN S PSN($P(^PS(50.416,PSNI1,0),"^"))="",PSN($P(^PS(50.416,PSNI2,0),"^"))="",PSNN=$O(PSN(""))_"/"_$O(PSN($O(PSN("")))) I PSNN'=OLD S DIE="^PS(56,",DR=".01////"_PSNN_";" D
"RTN","PSNCLING",53,0)
 ..I $O(^PS(56,"B",PSNN,0)),$O(^(0))'=DA S DIK="^PS(56," D ^DIK Q
"RTN","PSNCLING",54,0)
 ..D ^DIE S ^TMP($J,3,OLD)=PSNN
"RTN","PSNCLING",55,0)
 ;
"RTN","PSNCLING",56,0)
 ;now the APD
"RTN","PSNCLING",57,0)
 K ^PS(50.416,"APD") S DA=0 F  S DA=$O(^PS(50.416,DA)),K=0 Q:'DA  F  S K=$O(^PS(50.416,DA,1,K)) Q:'K  S X=^(K,0),^PS(50.416,"APD",X,DA)=""
"RTN","PSNCLING",58,0)
 ;now the interactions
"RTN","PSNCLING",59,0)
 K ^PS(56,"APD") S DA=0 F  S DA=$O(^PS(56,DA)) Q:'DA  K PSN1,PSN2 S PSN1=$P(^(DA,0),"^",2),PSN2=$P(^(0),"^",3) D
"RTN","PSNCLING",60,0)
 .S NA="" F  S NA=$O(^PS(50.416,PSN1,1,"B",NA)) Q:NA=""  S PSN1(NA)=""
"RTN","PSNCLING",61,0)
 .S PSN11=0 F  S PSN11=$O(^PS(50.416,"APS",PSN1,PSN11)),NA="" Q:'PSN11  F  S NA=$O(^PS(50.416,PSN11,1,"B",NA)) Q:NA=""  S PSN1(NA)=""
"RTN","PSNCLING",62,0)
 .S NA="" F  S NA=$O(^PS(50.416,PSN2,1,"B",NA)) Q:NA=""  S PSN2(NA)=""
"RTN","PSNCLING",63,0)
 .S PSN21=0 F  S PSN21=$O(^PS(50.416,"APS",PSN2,PSN21)),NA="" Q:'PSN21  F  S NA=$O(^PS(50.416,PSN21,1,"B",NA)) Q:NA=""  S PSN2(NA)=""
"RTN","PSNCLING",64,0)
 .S PSN1="" F  S PSN1=$O(PSN1(PSN1)),PSN2="" Q:PSN1=""  F  S PSN2=$O(PSN2(PSN2)) Q:PSN2=""  S ^PS(56,"APD",PSN1,PSN2,DA)="",^PS(56,"APD",PSN2,PSN1,DA)=""
"RTN","PSNCLING",65,0)
 ;
"RTN","PSNCLING",66,0)
MORE ;MESSAGE CONTINUED
"RTN","PSNCLING",67,0)
 F J=1:1 S X=$P($T(TEXT1+J),";",3) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X,LINE=LINE+1
"RTN","PSNCLING",68,0)
 I '$D(^TMP($J,2)) S ^TMP("PSN",$J,LINE,0)="none found" S LINE=LINE+1
"RTN","PSNCLING",69,0)
 S NA="" F  S NA=$O(^TMP($J,2,NA)) Q:NA=""  Q:NA="^"  S X=^(NA),^TMP("PSN",$J,LINE,0)="Name: "_NA,LINE=LINE+1,^TMP("PSN",$J,LINE,0)="Actual Ingredients: "_X,LINE=LINE+1,^TMP("PSN",$J,LINE,0)=" ",LINE=LINE+1
"RTN","PSNCLING",70,0)
 ;
"RTN","PSNCLING",71,0)
 ;
"RTN","PSNCLING",72,0)
 F J=1:1 S X=$P($T(TEXT2+J),";",3) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X,LINE=LINE+1
"RTN","PSNCLING",73,0)
 I $O(^TMP($J,1,""))="" S ^TMP("PSN",$J,LINE,0)="none found",LINE=LINE+1
"RTN","PSNCLING",74,0)
 S NA="" F  S NA=$O(^TMP($J,1,NA)) Q:NA=""  S ^TMP("PSN",$J,LINE,0)=NA,LINE=LINE+1
"RTN","PSNCLING",75,0)
 F J=1:1 S X=$P($T(TEXT2A+J),";",3) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X,LINE=LINE+1
"RTN","PSNCLING",76,0)
 I $O(^TMP($J,3,""))="" S ^TMP("PSN",$J,LINE,0)="none found",LINE=LINE+1
"RTN","PSNCLING",77,0)
 S NA="" F  S NA=$O(^TMP($J,3,NA)) Q:NA=""  S X=^(NA),^TMP("PSN",$J,LINE,0)="Interaction "_NA,LINE=LINE+1,^TMP("PSN",$J,LINE,0)="was changed to "_X,LINE=LINE+1,^TMP("PSN",$J,LINE,0)=" ",LINE=LINE+1
"RTN","PSNCLING",78,0)
 ;
"RTN","PSNCLING",79,0)
ALLER ;now the allergies
"RTN","PSNCLING",80,0)
 I ^XMB("NETNAME")["CMOP" G INTER
"RTN","PSNCLING",81,0)
 ;skip allergies for CMOPs
"RTN","PSNCLING",82,0)
 K ^TMP($J)
"RTN","PSNCLING",83,0)
 S PSNFREE=$O(^GMRD(120.82,"B","OTHER ALLERGY/ADVERSE REACTION",0))_";GMRD(120,82,"
"RTN","PSNCLING",84,0)
 S PSNDA=0 F  S PSNDA=$O(^GMR(120.8,PSNDA)) Q:'PSNDA  S PSNPAT=+^(PSNDA,0),PSNPAT=$P(^DPT(PSNPAT,0),"^") D
"RTN","PSNCLING",85,0)
 .S PSNI=$P(^GMR(120.8,PSNDA,0),"^",3) I PSNI["PS(50.416",'$D(^PS(50.416,+PSNI,0)) S $P(^GMR(120.8,PSNDA,0),"^",3)=PSNFREE S DIE="^GMR(120.8,",DA=PSNDA,DR="22////1;23////"_$$NOW^XLFDT_";24////"_DUZ_";" D ^DIE S ^TMP($J,2,PSNPAT)="" D
"RTN","PSNCLING",86,0)
 ..D ADCOM^GMRAFX(PSNDA,"E","Marked entered in error by patch PSN*4*107")
"RTN","PSNCLING",87,0)
 .I PSNI["PS(50.416",$D(^PS(50.416,+PSNI,0)),$P(^(0),"^",2) S PSNI=$P(^(0),"^",2)_";PS(50.416,",$P(^GMR(120.8,PSNDA,0),"^",3)=PSNI
"RTN","PSNCLING",88,0)
 .S PSNK=0 F  S PSNK=$O(^GMR(120.8,PSNDA,2,PSNK)) Q:'PSNK  S PSNI=^(PSNK,0) D
"RTN","PSNCLING",89,0)
 ..I '$D(^PS(50.416,PSNI,0)) S DA(1)=PSNDA,DA=PSNK,DIE="^GMR(120.8,DA(1),2,",DR=".01///@" D ^DIE S ^TMP($J,2,PSNPAT)="" Q
"RTN","PSNCLING",90,0)
 ..S PSNX=$P(^PS(50.416,PSNI,0),"^",2) I PSNX S DA(1)=PSNDA,DA=PSNK,DIE="^GMR(120.8,DA(1),2,",DR=".01////"_$S($D(^GMR(120.8,DA(1),2,"B",PSNX)):"@",1:PSNX) D ^DIE S ^TMP($J,1,PSNPAT,$P(^PS(50.416,PSNI,0),"^")_"^"_$P(^PS(50.416,PSNX,0),"^"))=""
"RTN","PSNCLING",91,0)
 ;
"RTN","PSNCLING",92,0)
 F J=1:1 S X=$P($T(TEXT3+J),";",3,300) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X,LINE=LINE+1
"RTN","PSNCLING",93,0)
 I '$D(^TMP($J,1)) S ^TMP("PSN",J,LINE,0)="none found",LINE=LINE+1
"RTN","PSNCLING",94,0)
 S NA="" F  S NA=$O(^TMP($J,1,NA)) Q:NA=""  S X="" F  S X=$O(^TMP($J,1,NA,X)) Q:X=""  S ^TMP("PSN",$J,LINE,0)="Patient: "_NA,LINE=LINE+1,^TMP("PSN",$J,LINE,0)="Non-primary ingredient "_$P(X,"^"),LINE=LINE+1 D
"RTN","PSNCLING",95,0)
 .S ^TMP("PSN",$J,LINE,0)="was replaced with primary ingredient "_$P(X,"^",2),LINE=LINE+1,^TMP("PSN",$J,LINE,0)=" ",LINE=LINE+1
"RTN","PSNCLING",96,0)
 F J=1:1 S X=$P($T(TEXT5+J),";",3,300) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X,LINE=LINE+1
"RTN","PSNCLING",97,0)
 I '$D(^TMP($J,2)) S ^TMP("PSN",$J,LINE,0)="none found",LINE=LINE+1
"RTN","PSNCLING",98,0)
 S NA="" F  S NA=$O(^TMP($J,2,NA)) Q:NA=""  S ^TMP("PSN",$J,LINE,0)=NA,LINE=LINE+1
"RTN","PSNCLING",99,0)
 ;
"RTN","PSNCLING",100,0)
INTER K PSN1 S PSN2=$P($T(LIST),";",3) F J=1:1:$L(PSN2,"^")-1 S PSN1($P(PSN2,"^",J))=""
"RTN","PSNCLING",101,0)
 K ^TMP($J) S DA=0 F  S DA=$O(^PS(56,DA)) Q:'DA  Q:DA>14999  I '$D(PSN1(DA)) S X=^(DA,0),OLD=$P(X,"^"),PSNI1=$P(X,"^",2),PSNI2=$P(X,"^",3) K PSN,PSNN D
"RTN","PSNCLING",102,0)
 .S PSN($P(^PS(50.416,PSNI1,0),"^"))="",PSN($P(^PS(50.416,PSNI2,0),"^"))="",PSNN=$O(PSN(""))_"/"_$O(PSN($O(PSN("")))) I PSNN'=OLD S ^TMP($J,OLD_"^"_DA)=""
"RTN","PSNCLING",103,0)
 F J=1:1 S X=$P($T(TEXT6+J),";",3,300) Q:X=""  S ^TMP("PSN",$J,LINE,0)=X,LINE=LINE+1
"RTN","PSNCLING",104,0)
 I '$D(^TMP($J)) S ^TMP("PSN",$J,LINE,0)="none found",LINE=LINE+1
"RTN","PSNCLING",105,0)
 S NA="" F  S NA=$O(^TMP($J,NA)) Q:NA=""  S ^TMP("PSN",$J,LINE,0)=$P(NA,"^",2) S $E(^(0),12)=$P(NA,"^"),LINE=LINE+1
"RTN","PSNCLING",106,0)
SENDIT ;
"RTN","PSNCLING",107,0)
 S XMSUB="INGREDIENTS AND INTERACTIONS DELETED",XMDUZ="NDF MANAGER",XMTEXT="^TMP(""PSN"",$J," K XMY S XMY(DUZ)="",XMY("G.NDF DATA@"_^XMB("NETNAME"))="",DA=0 F  S DA=$O(^XUSEC("PSNMGR",DA)) Q:'DA  S XMY(DA)=""
"RTN","PSNCLING",108,0)
 N DIFROM D ^XMD
"RTN","PSNCLING",109,0)
 K DA,DIE,DIK,DR,J,K,LINE,NA,OLD,PSN,PSN1,PSN11,PSN2,PSN21,PSNA1,PSNA2,PSNDA,PSNFREE,PSNI,PSNI1,PSNI2,PSNAPT,PSNPSNI1,PSNK,PSNX,PSNN,PSNN1,PSNQ,X,XMDUZ,XMSUB,XMTEXT,XMY,^TMP($J),^TMP("PSN",$J)
"RTN","PSNCLING",110,0)
 Q
"RTN","PSNCLING",111,0)
TEXT ;
"RTN","PSNCLING",112,0)
 ;;The following locally added ingredients have been deleted from the
"RTN","PSNCLING",113,0)
 ;;INGREDIENTS file (#50.416).
"RTN","PSNCLING",114,0)
 ;; 
"RTN","PSNCLING",115,0)
 ;
"RTN","PSNCLING",116,0)
TEXT1 ;
"RTN","PSNCLING",117,0)
 ;;============================================================================
"RTN","PSNCLING",118,0)
 ;; 
"RTN","PSNCLING",119,0)
 ;;The following locally added interactions have been deleted from the
"RTN","PSNCLING",120,0)
 ;;DRUG INTERACTIONS file (#56) because they check for ingredients other
"RTN","PSNCLING",121,0)
 ;;than those indicated by the name.
"RTN","PSNCLING",122,0)
 ;; 
"RTN","PSNCLING",123,0)
 ;; 
"RTN","PSNCLING",124,0)
 ;  
"RTN","PSNCLING",125,0)
 ;; 
"RTN","PSNCLING",126,0)
TEXT2 ;
"RTN","PSNCLING",127,0)
 ;;============================================================================
"RTN","PSNCLING",128,0)
 ;; 
"RTN","PSNCLING",129,0)
 ;;The following locally added interactions have been deleted from the
"RTN","PSNCLING",130,0)
 ;;DRUG INTERACTIONS file (#56) because they involve locally entered
"RTN","PSNCLING",131,0)
 ;;ingredients which have been deleted.
"RTN","PSNCLING",132,0)
 ;; 
"RTN","PSNCLING",133,0)
 ;; 
"RTN","PSNCLING",134,0)
 ;
"RTN","PSNCLING",135,0)
TEXT2A ;
"RTN","PSNCLING",136,0)
 ;;========================================================================
"RTN","PSNCLING",137,0)
 ;; 
"RTN","PSNCLING",138,0)
 ;;The following locally added interactions have been edited because they
"RTN","PSNCLING",139,0)
 ;;involved ingredients that are not primary ingredients.
"RTN","PSNCLING",140,0)
 ;; 
"RTN","PSNCLING",141,0)
 ;; 
"RTN","PSNCLING",142,0)
 ;; 
"RTN","PSNCLING",143,0)
 ;
"RTN","PSNCLING",144,0)
TEXT3 ; 
"RTN","PSNCLING",145,0)
 ;; 
"RTN","PSNCLING",146,0)
 ;;============================================================================
"RTN","PSNCLING",147,0)
 ;;Allergy information for the following patients has been changed.
"RTN","PSNCLING",148,0)
 ;; 
"RTN","PSNCLING",149,0)
 ;;The allergy for the listed patients was created with a non-primary
"RTN","PSNCLING",150,0)
 ;;ingredient.  These have been updated to replace the non-primary
"RTN","PSNCLING",151,0)
 ;;ingredient with the proper primary ingredient.
"RTN","PSNCLING",152,0)
 ;;  
"RTN","PSNCLING",153,0)
TEXT5 ;
"RTN","PSNCLING",154,0)
 ;; 
"RTN","PSNCLING",155,0)
 ;;========================================================================
"RTN","PSNCLING",156,0)
 ;;The patient allergy entries for the listed patients were created with
"RTN","PSNCLING",157,0)
 ;;locally added ingredients.  Locally added ingredients are not supported
"RTN","PSNCLING",158,0)
 ;;by the software and the allergies have been updated to 'entered in error'.
"RTN","PSNCLING",159,0)
 ;;The patient allergy entry should be reviewed.
"RTN","PSNCLING",160,0)
 ;; 
"RTN","PSNCLING",161,0)
 ;
"RTN","PSNCLING",162,0)
TEXT6 ;
"RTN","PSNCLING",163,0)
 ;; 
"RTN","PSNCLING",164,0)
 ;;========================================================================
"RTN","PSNCLING",165,0)
 ;;  
"RTN","PSNCLING",166,0)
 ;;The following nationally entered interactions have a discrepancy
"RTN","PSNCLING",167,0)
 ;;between the name and the ingredients.  Please submit a remedy ticket
"RTN","PSNCLING",168,0)
 ;;and attach the information in this section so that the proper cleanup
"RTN","PSNCLING",169,0)
 ;;can be done.
"RTN","PSNCLING",170,0)
 ;; 
"RTN","PSNCLING",171,0)
 ;;IEN          Interaction
"RTN","PSNCLING",172,0)
 ;; 
"RTN","PSNCLING",173,0)
 ;
"RTN","PSNCLING",174,0)
LIST ;;2084^2085^2086^2087^2088^2089^2090^2091^2092^2093^2094^2095^2096^2136^2237^2238^2239^2244^2289^
"VER")
8.0^22.0
"^DD",50.416,50.416,.01,0)
NAME^RFaX^^0;1^K:$L(X)>64!($L(X)<3)!'(X'?1P.E)!($E(X,$L(X))=" ") X K:$G(^("VUID")) X
"^DD",50.416,50.416,.01,1,0)
^.1
"^DD",50.416,50.416,.01,1,1,0)
50.416^B
"^DD",50.416,50.416,.01,1,1,1)
S ^PS(50.416,"B",$E(X,1,64),DA)=""
"^DD",50.416,50.416,.01,1,1,2)
K ^PS(50.416,"B",$E(X,1,64),DA)
"^DD",50.416,50.416,.01,1,2,0)
50.416^P
"^DD",50.416,50.416,.01,1,2,1)
Q
"^DD",50.416,50.416,.01,1,2,2)
Q
"^DD",50.416,50.416,.01,1,2,"%D",0)
^^1^1^3050720^
"^DD",50.416,50.416,.01,1,2,"%D",1,0)
 
"^DD",50.416,50.416,.01,1,2,"DT")
3050720
"^DD",50.416,50.416,.01,1,3,0)
50.416^APS^MUMPS
"^DD",50.416,50.416,.01,1,3,1)
I $P(^PS(50.416,DA,0),"^",2)]"" S ^PS(50.416,"APS",$P(^PS(50.416,DA,0),"^",2),DA)=""
"^DD",50.416,50.416,.01,1,3,2)
I $P(^PS(50.416,DA,0),"^",2)]"" K ^PS(50.416,"APS",$P(^PS(50.416,DA,0),"^",2),DA)
"^DD",50.416,50.416,.01,1,3,3)
DO NOT DELETE-used for drug interactions
"^DD",50.416,50.416,.01,1,3,"%D",0)
^^3^3^2920430^^^^
"^DD",50.416,50.416,.01,1,3,"%D",1,0)
This cross-reference is used in Outpatient Pharmacy for drug-drug
"^DD",50.416,50.416,.01,1,3,"%D",2,0)
interactions. It stores the secondary ingredients with their Primary
"^DD",50.416,50.416,.01,1,3,"%D",3,0)
Ingredient.
"^DD",50.416,50.416,.01,1,3,"DT")
2920430
"^DD",50.416,50.416,.01,3)
Answer must be 3-64 characters in length.
"^DD",50.416,50.416,.01,8.5)
^
"^DD",50.416,50.416,.01,9)
^
"^DD",50.416,50.416,.01,21,0)
^.001^1^1^3050927^^^^
"^DD",50.416,50.416,.01,21,1,0)
This is the drug ingredient name.
"^DD",50.416,50.416,.01,23,0)
^^1^1^3050927^
"^DD",50.416,50.416,.01,23,1,0)
 
"^DD",50.416,50.416,.01,"AUDIT")
y
"^DD",50.416,50.416,.01,"DEL",1,0)
I $G(^PS(50.416,DA,"VUID"))
"^DD",50.416,50.416,.01,"DT")
3051020
"^DD",50.416,50.416,2,0)
PRIMARY INGREDIENT^P50.416a^PS(50.416,^0;2^Q
"^DD",50.416,50.416,2,1,0)
^.1
"^DD",50.416,50.416,2,1,1,0)
50.416^APS
"^DD",50.416,50.416,2,1,1,1)
S ^PS(50.416,"APS",$E(X,1,30),DA)=""
"^DD",50.416,50.416,2,1,1,2)
K ^PS(50.416,"APS",$E(X,1,30),DA)
"^DD",50.416,50.416,2,1,1,"%D",0)
^^1^1^3010808^
"^DD",50.416,50.416,2,1,1,"%D",1,0)
This cross reference is used to screen on primary ingredients.
"^DD",50.416,50.416,2,1,1,"DT")
3010808
"^DD",50.416,50.416,2,1,2,0)
50.416^P
"^DD",50.416,50.416,2,1,2,1)
Q
"^DD",50.416,50.416,2,1,2,2)
Q
"^DD",50.416,50.416,2,1,2,"DT")
3050720
"^DD",50.416,50.416,2,8.5)
^
"^DD",50.416,50.416,2,9)
^
"^DD",50.416,50.416,2,21,0)
^.001^1^1^3000225^^^^
"^DD",50.416,50.416,2,21,1,0)
This is the primary ingredient.
"^DD",50.416,50.416,2,"AUDIT")
y
"^DD",50.416,50.416,2,"DT")
3050720
"BLD",859,6)
^102
**END**
**END**
