Released LR*5.2*344 SEQ #263
Extracted from mail message
**KIDS**:LR*5.2*344^

**INSTALL NAME**
LR*5.2*344
"BLD",6415,0)
LR*5.2*344^LAB SERVICE^0^3051130^y
"BLD",6415,1,0)
^^6^6^3050829^^^^
"BLD",6415,1,1,0)
This patch corrects problems with the way reference ranges are
"BLD",6415,1,2,0)
displayed in search options and in CPRS and also fixes a bug 
"BLD",6415,1,3,0)
which generates a SYNTAX error in option LRSORA (Search for HI/Lo
"BLD",6415,1,4,0)
Values). The patch also fixes a problem with the Microbiology
"BLD",6415,1,5,0)
Trend Report where no data is printed when specific locations are
"BLD",6415,1,6,0)
selected.
"BLD",6415,4,0)
^9.64PA^^
"BLD",6415,6)
3^
"BLD",6415,"ABPKG")
n
"BLD",6415,"KRN",0)
^9.67PA^8989.52^19
"BLD",6415,"KRN",.4,0)
.4
"BLD",6415,"KRN",.401,0)
.401
"BLD",6415,"KRN",.402,0)
.402
"BLD",6415,"KRN",.403,0)
.403
"BLD",6415,"KRN",.5,0)
.5
"BLD",6415,"KRN",.84,0)
.84
"BLD",6415,"KRN",3.6,0)
3.6
"BLD",6415,"KRN",3.8,0)
3.8
"BLD",6415,"KRN",9.2,0)
9.2
"BLD",6415,"KRN",9.8,0)
9.8
"BLD",6415,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",6415,"KRN",9.8,"NM",1,0)
LRSORD1^^0^7833211
"BLD",6415,"KRN",9.8,"NM",2,0)
LRSORD1A^^0^21795919
"BLD",6415,"KRN",9.8,"NM",3,0)
LRSORC1^^0^8026768
"BLD",6415,"KRN",9.8,"NM",4,0)
LRSORC1A^^0^22165850
"BLD",6415,"KRN",9.8,"NM",5,0)
LRSORA^^0^27010859
"BLD",6415,"KRN",9.8,"NM",6,0)
LRSORA3^^0^16971117
"BLD",6415,"KRN",9.8,"NM",7,0)
LR7OGMP^^0^12690240
"BLD",6415,"KRN",9.8,"NM",8,0)
LRMITSPE^^0^14161100
"BLD",6415,"KRN",9.8,"NM","B","LR7OGMP",7)

"BLD",6415,"KRN",9.8,"NM","B","LRMITSPE",8)

"BLD",6415,"KRN",9.8,"NM","B","LRSORA",5)

"BLD",6415,"KRN",9.8,"NM","B","LRSORA3",6)

"BLD",6415,"KRN",9.8,"NM","B","LRSORC1",3)

"BLD",6415,"KRN",9.8,"NM","B","LRSORC1A",4)

"BLD",6415,"KRN",9.8,"NM","B","LRSORD1",1)

"BLD",6415,"KRN",9.8,"NM","B","LRSORD1A",2)

"BLD",6415,"KRN",19,0)
19
"BLD",6415,"KRN",19.1,0)
19.1
"BLD",6415,"KRN",101,0)
101
"BLD",6415,"KRN",409.61,0)
409.61
"BLD",6415,"KRN",771,0)
771
"BLD",6415,"KRN",870,0)
870
"BLD",6415,"KRN",8989.51,0)
8989.51
"BLD",6415,"KRN",8989.52,0)
8989.52
"BLD",6415,"KRN",8994,0)
8994
"BLD",6415,"KRN","B",.4,.4)

"BLD",6415,"KRN","B",.401,.401)

"BLD",6415,"KRN","B",.402,.402)

"BLD",6415,"KRN","B",.403,.403)

"BLD",6415,"KRN","B",.5,.5)

"BLD",6415,"KRN","B",.84,.84)

"BLD",6415,"KRN","B",3.6,3.6)

"BLD",6415,"KRN","B",3.8,3.8)

"BLD",6415,"KRN","B",9.2,9.2)

"BLD",6415,"KRN","B",9.8,9.8)

"BLD",6415,"KRN","B",19,19)

"BLD",6415,"KRN","B",19.1,19.1)

"BLD",6415,"KRN","B",101,101)

"BLD",6415,"KRN","B",409.61,409.61)

"BLD",6415,"KRN","B",771,771)

"BLD",6415,"KRN","B",870,870)

"BLD",6415,"KRN","B",8989.51,8989.51)

"BLD",6415,"KRN","B",8989.52,8989.52)

"BLD",6415,"KRN","B",8994,8994)

"BLD",6415,"QUES",0)
^9.62^^
"BLD",6415,"REQB",0)
^9.611^4^4
"BLD",6415,"REQB",1,0)
LR*5.2*153^2
"BLD",6415,"REQB",2,0)
LR*5.2*201^2
"BLD",6415,"REQB",3,0)
LR*5.2*257^2
"BLD",6415,"REQB",4,0)
LR*5.2*286^2
"BLD",6415,"REQB","B","LR*5.2*153",1)

"BLD",6415,"REQB","B","LR*5.2*201",2)

"BLD",6415,"REQB","B","LR*5.2*257",3)

"BLD",6415,"REQB","B","LR*5.2*286",4)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
344^3051130^33274
"PKG",26,22,1,"PAH",1,1,0)
^^6^6^3051130
"PKG",26,22,1,"PAH",1,1,1,0)
This patch corrects problems with the way reference ranges are
"PKG",26,22,1,"PAH",1,1,2,0)
displayed in search options and in CPRS and also fixes a bug 
"PKG",26,22,1,"PAH",1,1,3,0)
which generates a SYNTAX error in option LRSORA (Search for HI/Lo
"PKG",26,22,1,"PAH",1,1,4,0)
Values). The patch also fixes a problem with the Microbiology
"PKG",26,22,1,"PAH",1,1,5,0)
Trend Report where no data is printed when specific locations are
"PKG",26,22,1,"PAH",1,1,6,0)
selected.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","LR7OGMP")
0^7^B12690240
"RTN","LR7OGMP",1,0)
LR7OGMP ;DALOI/STAFF- Interim report rpc memo print ; Mar 10, 2003
"RTN","LR7OGMP",2,0)
 ;;5.2;LAB SERVICE;**187,246,282,286,344**;Sep 27, 1994
"RTN","LR7OGMP",3,0)
 ;
"RTN","LR7OGMP",4,0)
PRINT(OUTCNT) ; from LR7OGMC
"RTN","LR7OGMP",5,0)
 N ACC,AGE,CDT,CMNT,DATA,DOC,FLAG,HIGH,IDT,INTP,LINE,LOW,LRCW,LRX,PORDER,PRNTCODE,RANGE,REFHIGH,REFLOW,SEX,SITE,SPEC,SUB,TESTNUM
"RTN","LR7OGMP",6,0)
 N TESTSPEC,THER,THERHIGH,THERLOW,UNITS,VALUE,X,ZERO
"RTN","LR7OGMP",7,0)
 ; the variables AGE, SEX, LRCW, and X are used withing the lab's print codes and ref ranges
"RTN","LR7OGMP",8,0)
 S AGE=$P(^TMP("LR7OG",$J,"G"),U,4),SEX=$P(^("G"),U,5),LRCW=$P(^("G"),U,6)
"RTN","LR7OGMP",9,0)
 S CDT=0
"RTN","LR7OGMP",10,0)
 F  S CDT=$O(^TMP("LR7OG",$J,"TP",CDT)) Q:CDT=""  D
"RTN","LR7OGMP",11,0)
 . S IDT=9999999-CDT
"RTN","LR7OGMP",12,0)
 . S ZERO=$S($D(^TMP("LR7OG",$J,"TP",CDT))#2:^(CDT),1:"")
"RTN","LR7OGMP",13,0)
 . I '$P(ZERO,U,3) Q
"RTN","LR7OGMP",14,0)
 . S SPEC=+$P(ZERO,U,5)
"RTN","LR7OGMP",15,0)
 . S DOC=$$NAME(+$P(ZERO,U,10))
"RTN","LR7OGMP",16,0)
 . D SETLINE("",.OUTCNT)
"RTN","LR7OGMP",17,0)
 . D SETLINE("Provider : "_DOC,.OUTCNT)
"RTN","LR7OGMP",18,0)
 . S LINE="  Specimen: "_$P(^LAB(61,SPEC,0),U)_"."
"RTN","LR7OGMP",19,0)
 . S ACC=$P(ZERO,U,6)
"RTN","LR7OGMP",20,0)
 . S LINE=$$SETSTR^VALM1(" "_ACC,LINE,30,1+$L(ACC))
"RTN","LR7OGMP",21,0)
 . D SETLINE(LINE,.OUTCNT)
"RTN","LR7OGMP",22,0)
 . D SETLINE("                              "_$$DD(CDT),.OUTCNT)
"RTN","LR7OGMP",23,0)
 . D SETLINE("     Test name                Result    units      Ref.   range   Site Code",.OUTCNT)
"RTN","LR7OGMP",24,0)
 . S PORDER=0
"RTN","LR7OGMP",25,0)
 . F  S PORDER=$O(^TMP("LR7OG",$J,"TP",CDT,PORDER)) Q:PORDER'>0  S DATA=^(PORDER) D
"RTN","LR7OGMP",26,0)
 .. I $P(DATA,U,7)="" Q
"RTN","LR7OGMP",27,0)
 .. S TESTNUM=+DATA,PRNTCODE=$P(DATA,U,5),SUB=$P(DATA,U,6),FLAG=$P(DATA,U,8),X=$P(DATA,U,7),UNITS=$P(DATA,U,9),RANGE=$P(DATA,U,10),SITE=$P(DATA,U,11)
"RTN","LR7OGMP",28,0)
 .. S LOW=$P(RANGE,"-"),HIGH=$P(RANGE,"-",2),THER=$P(DATA,U,12)
"RTN","LR7OGMP",29,0)
 .. S LINE="     "_$S($L($P(DATA,U,2))>20:$P(DATA,U,3),1:$P(DATA,U,2))
"RTN","LR7OGMP",30,0)
 .. S LINE=$$SETSTR^VALM1("",LINE,28,0)
"RTN","LR7OGMP",31,0)
 .. I PRNTCODE="" S LINE=LINE_$J(X,8)
"RTN","LR7OGMP",32,0)
 .. E  S @("VALUE="_PRNTCODE),LINE=LINE_VALUE
"RTN","LR7OGMP",33,0)
 .. S LINE=LINE_" "_FLAG
"RTN","LR7OGMP",34,0)
 .. I $L(LINE)>38 D SETLINE(LINE,.OUTCNT) S LINE=""
"RTN","LR7OGMP",35,0)
 .. I UNITS'="" S LINE=$$SETSTR^VALM1("  "_UNITS,LINE,39,2+$L(UNITS))
"RTN","LR7OGMP",36,0)
 .. S LRX=RANGE
"RTN","LR7OGMP",37,0)
 .. I LRX'="" S LINE=$$SETSTR^VALM1(LRX,LINE,52,$L(LRX))
"RTN","LR7OGMP",38,0)
 .. I $L(LINE)>67,SITE D SETLINE(LINE,.OUTCNT) S LINE=""
"RTN","LR7OGMP",39,0)
 .. I SITE S LINE=$$SETSTR^VALM1(" ["_SITE_"]",LINE,68,3+$L(SITE))
"RTN","LR7OGMP",40,0)
 .. I LINE'="" D SETLINE(LINE,.OUTCNT)
"RTN","LR7OGMP",41,0)
 .. I $O(^TMP("LR7OG",$J,"TP",CDT,PORDER,0))>0 D
"RTN","LR7OGMP",42,0)
 ... S INTP=0
"RTN","LR7OGMP",43,0)
 ... F  S INTP=+$O(^TMP("LR7OG",$J,"TP",CDT,PORDER,INTP)) Q:INTP<1  D SETLINE("      Eval: "_^(INTP),.OUTCNT)
"RTN","LR7OGMP",44,0)
 . I $D(^TMP("LR7OG",$J,"TP",CDT,"C")) D
"RTN","LR7OGMP",45,0)
 .. S LINE="Comment: "
"RTN","LR7OGMP",46,0)
 .. S CMNT=0
"RTN","LR7OGMP",47,0)
 .. F  S CMNT=+$O(^TMP("LR7OG",$J,"TP",CDT,"C",CMNT)) Q:CMNT<1  S LINE=LINE_^(CMNT) D
"RTN","LR7OGMP",48,0)
 ... D SETLINE(LINE,.OUTCNT)
"RTN","LR7OGMP",49,0)
 ... I $O(^TMP("LR7OG",$J,"TP",CDT,"C",CMNT)) S LINE="        "
"RTN","LR7OGMP",50,0)
 . D SETLINE("===============================================================================",.OUTCNT)
"RTN","LR7OGMP",51,0)
 Q
"RTN","LR7OGMP",52,0)
 ;
"RTN","LR7OGMP",53,0)
 ;
"RTN","LR7OGMP",54,0)
SETLINE(LINE,CNT) ;
"RTN","LR7OGMP",55,0)
 S ^TMP("LR7OGX",$J,"OUTPUT",CNT)=LINE
"RTN","LR7OGMP",56,0)
 S CNT=CNT+1
"RTN","LR7OGMP",57,0)
 Q
"RTN","LR7OGMP",58,0)
 ;
"RTN","LR7OGMP",59,0)
 ;
"RTN","LR7OGMP",60,0)
NAME(X) ; $$(#) -> name
"RTN","LR7OGMP",61,0)
 N LRDOC
"RTN","LR7OGMP",62,0)
 D DOC^LRX
"RTN","LR7OGMP",63,0)
 Q LRDOC
"RTN","LR7OGMP",64,0)
 ;
"RTN","LR7OGMP",65,0)
 ;
"RTN","LR7OGMP",66,0)
DD(Y) ; $$(date/time) -> date/time format
"RTN","LR7OGMP",67,0)
 D DD^LRX
"RTN","LR7OGMP",68,0)
 Q Y
"RTN","LR7OGMP",69,0)
 ;
"RTN","LR7OGMP",70,0)
 ;
"RTN","LR7OGMP",71,0)
PLS ; List performing laboratories
"RTN","LR7OGMP",72,0)
 ;
"RTN","LR7OGMP",73,0)
 N LINE,LRPLS,X
"RTN","LR7OGMP",74,0)
 D SETLINE("Performing Lab Sites",.OUTCNT)
"RTN","LR7OGMP",75,0)
 S LRPLS=0
"RTN","LR7OGMP",76,0)
 F  S LRPLS=$O(^TMP("LRPLS",$J,LRPLS)) Q:LRPLS<1  D
"RTN","LR7OGMP",77,0)
 . S LINE=$$LJ^XLFSTR("["_LRPLS_"] ",8)_$$NAME^XUAF4(LRPLS)
"RTN","LR7OGMP",78,0)
 . D SETLINE(LINE,.OUTCNT)
"RTN","LR7OGMP",79,0)
 . S X=$$PADD^XUAF4(LRPLS)
"RTN","LR7OGMP",80,0)
 . S LINE=$$REPEAT^XLFSTR(" ",8)_$P(X,U)_"  "_$P(X,U,2)_", "_$P(X,U,3)_" "_$P(X,U,4)
"RTN","LR7OGMP",81,0)
 . D SETLINE(LINE,.OUTCNT)
"RTN","LR7OGMP",82,0)
 ;
"RTN","LR7OGMP",83,0)
 D SETLINE("===============================================================================",.OUTCNT)
"RTN","LR7OGMP",84,0)
 ;
"RTN","LR7OGMP",85,0)
 K ^TMP("LRPLS",$J)
"RTN","LR7OGMP",86,0)
 Q
"RTN","LRMITSPE")
0^8^B14161100
"RTN","LRMITSPE",1,0)
LRMITSPE ;SLC/STAFF - MICRO TREND PROCESS EXTRACT ;10/28/93  15:17
"RTN","LRMITSPE",2,0)
 ;;5.2;LAB SERVICE;**96,257,344**;Sep 27, 1994
"RTN","LRMITSPE",3,0)
 ; from LRMITSP
"RTN","LRMITSPE",4,0)
 ;Reference to ^SC supported by IA# 10040
"RTN","LRMITSPE",5,0)
 ;Reference to ^SC C xref supported by IA# 908
"RTN","LRMITSPE",6,0)
 ;Reference to ^DD supported by IA# 10154
"RTN","LRMITSPE",7,0)
 ;Reference to ^DPT supported by IA# 10035
"RTN","LRMITSPE",8,0)
 ;Reference to Y^DIQ supported by IA# 10004
"RTN","LRMITSPE",9,0)
 ;Reference to $$NS^XUAF4 supported by IA# 2171
"RTN","LRMITSPE",10,0)
 ;
"RTN","LRMITSPE",11,0)
 S LRSEQN=0
"RTN","LRMITSPE",12,0)
 ; if report type is only for specific patients, collect only that data
"RTN","LRMITSPE",13,0)
 I '$D(LRM("O")),'$D(LRM("S")),'$D(LRM("L")),'$D(LRM("D")),'$D(LRM("C")),'$D(LRM("DIV")),$D(LRM("P","S")) D  Q
"RTN","LRMITSPE",14,0)
 .S DFN=0 F  S DFN=$O(LRM("P","S",DFN)) Q:DFN<1  S LRDFN=+$P(LRM("P","S",DFN),U,2) I LRDFN D DATA Q:LREND
"RTN","LRMITSPE",15,0)
 .D CLEANUP
"RTN","LRMITSPE",16,0)
 ; otherwise, go thru all patients
"RTN","LRMITSPE",17,0)
 S LRDFN=0 F  S LRDFN=$O(^LR(LRDFN)) Q:LRDFN<1  D DATA Q:LREND
"RTN","LRMITSPE",18,0)
CLEANUP K DFN,LRACC,LRADMD,LRANTIM,LRANTIN,LRANTINM,LRATS,LRCDATE,LRCOLN,LRCOLNM,LRDCHD,LRDFN,LRDN,LRDOCN,LRDOCNM,LRGPN,LRGPNM,LRIDT,LRINTERP,LRLOCN,LRLOCNM
"RTN","LRMITSPE",19,0)
 K LRMERGEV,LRN1,LRN2,LRN3,LROK,LRORGN,LRORGNM,LRPATN,LRPATNM,LRPLOS,LRR,LRRTYPE,LRSEQN,LRSPECN,LRSPECNM,LRSUBN,LRSUSR,LRSUSS,LRTSAL,LRTB,LRTYPE,LRX,Y
"RTN","LRMITSPE",20,0)
 K LRX13,LRXN,LRDIV,LRDIVNM,LRSDIV,LRASK
"RTN","LRMITSPE",21,0)
 K LRAPRT,LRBLIK,LRPX
"RTN","LRMITSPE",22,0)
 Q
"RTN","LRMITSPE",23,0)
DATA ; quit if not a valid patient or task is stopped
"RTN","LRMITSPE",24,0)
 Q:'$D(^LR(LRDFN,0))  Q:$P(^(0),U,2)'=2  S LRPATN=+$P(^(0),U,3) I $$S^%ZTLOAD S (LREND,ZTSTOP)=1 Q
"RTN","LRMITSPE",25,0)
 ; go thru valid collection dates with available data
"RTN","LRMITSPE",26,0)
 S LRIDT=LRTSAL F  S LRIDT=$O(^LR(LRDFN,"MI",LRIDT)) Q:LRIDT<1!((LRIDT\1)>LRATS)  S LRX=$G(^(LRIDT,0)) I LRX,$$CHECK(LRDFN,LRIDT,.LROTYPE) D
"RTN","LRMITSPE",27,0)
 .; get date, los, acc, patient, provider, site/specimen, location, col samp #s and names
"RTN","LRMITSPE",28,0)
 .S LRCDATE=+LRX
"RTN","LRMITSPE",29,0)
 .S LRPLOS=$S(LRLOS!LRDETAIL:$$LOS(LRPATN,LRCDATE),1:"") I LRLOS Q:'$L(LRPLOS)  Q:LRPLOS<LRLOS
"RTN","LRMITSPE",30,0)
 .S LRACC=$P(LRX,U,6)
"RTN","LRMITSPE",31,0)
 .S LRPATNM=$P($G(^DPT(LRPATN,0)),U) I '$L(LRPATNM) S LRPATNM=LRUNK
"RTN","LRMITSPE",32,0)
 .S LRDOCN=+$P(LRX,U,7),LRDOCNM=$$VALUE(LRDOCN,63.05,.07) I '$L(LRDOCNM) S LRDOCNM=LRUNK
"RTN","LRMITSPE",33,0)
 .S LRSPECN=+$P(LRX,U,5),LRSPECNM=$P($G(^LAB(61,LRSPECN,0)),U) I '$L(LRSPECNM) S LRSPECNM=LRUNK
"RTN","LRMITSPE",34,0)
 .S LRLOCNM=$P(LRX,U,8) S:'$L(LRLOCNM) LRLOCNM=LRUNK
"RTN","LRMITSPE",35,0)
 .S X=LRLOCNM,DIC="^SC(",DIC(0)="",D="C" D IX^DIC
"RTN","LRMITSPE",36,0)
 .I Y=-1 S LRLOCN=0
"RTN","LRMITSPE",37,0)
 .E  S LRLOCN=+Y ;S LRLOCN=+$O(^SC("C",LRLOCNM,0))
"RTN","LRMITSPE",38,0)
 .K DIC,Y
"RTN","LRMITSPE",39,0)
 .;MULTIDIVISIONAL PATCH LR*5.2*257 - 08/04
"RTN","LRMITSPE",40,0)
 .S LRX13=$P(LRX,U,13),LRXN=$P(LRX13,";")
"RTN","LRMITSPE",41,0)
 .I LRX13>0,$P(LRX13,";",2)="SC(" S LRLOCNM=$P(^SC(LRXN,0),U),LRDIV=$P(^SC(LRXN,0),U,4)
"RTN","LRMITSPE",42,0)
 .I LRX13>0,$P(LRX13,";",2)="DIC(4," S LRDIV=LRXN
"RTN","LRMITSPE",43,0)
 .I '$G(LRDIV) S LRDIV=$P($G(^SC(+LRLOCN,0)),U,4)
"RTN","LRMITSPE",44,0)
 .I LRDIV S LRDIVNM=$P($$NS^XUAF4(LRDIV),U)
"RTN","LRMITSPE",45,0)
 .E  S LRDIV=0,LRDIVNM="UNKNOWN"
"RTN","LRMITSPE",46,0)
 .S:LRDIV="" LRDIV=0
"RTN","LRMITSPE",47,0)
 .S LRCOLN=+$P(LRX,U,11),LRCOLNM=$P($G(^LAB(62,LRCOLN,0)),U) I '$L(LRCOLNM) S LRCOLNM=LRUNK
"RTN","LRMITSPE",48,0)
 .;MULTIDIVISIONAL PATCH LR*5.2*257 -3/01
"RTN","LRMITSPE",49,0)
 .;if report is for specific division, collect only that data
"RTN","LRMITSPE",50,0)
 .I $D(LRM("DIV","S")) D  Q
"RTN","LRMITSPE",51,0)
 ..S LRSDIV=0
"RTN","LRMITSPE",52,0)
 ..F  S LRSDIV=$O(LRM("DIV","S",LRSDIV)) Q:LRSDIV=""  D
"RTN","LRMITSPE",53,0)
 ...I LRSDIV=LRDIV,LRDIV'=0 D ^LRMITSPO
"RTN","LRMITSPE",54,0)
 ..Q 
"RTN","LRMITSPE",55,0)
 .; get data on organisms
"RTN","LRMITSPE",56,0)
 .D ^LRMITSPO
"RTN","LRMITSPE",57,0)
 Q
"RTN","LRMITSPE",58,0)
CHECK(LRDFN,LRIDT,LROTYPE) ; lab patient, time, organism types -> 1 or 0 if data available
"RTN","LRMITSPE",59,0)
 I $D(LROTYPE("B")),$D(^LR(LRDFN,"MI",LRIDT,3)) Q 1
"RTN","LRMITSPE",60,0)
 I $D(LROTYPE("F")),$D(^LR(LRDFN,"MI",LRIDT,8)) Q 1
"RTN","LRMITSPE",61,0)
 I $D(LROTYPE("M")),$D(^LR(LRDFN,"MI",LRIDT,11)) Q 1
"RTN","LRMITSPE",62,0)
 I $D(LROTYPE("P")),$D(^LR(LRDFN,"MI",LRIDT,5)) Q 1
"RTN","LRMITSPE",63,0)
 I $D(LROTYPE("V")),$D(^LR(LRDFN,"MI",LRIDT,16)) Q 1
"RTN","LRMITSPE",64,0)
 I '$D(LROTYPE("B")),$D(^LR(LRDFN,"MI",LRIDT,3)) Q 1
"RTN","LRMITSPE",65,0)
 Q 0
"RTN","LRMITSPE",66,0)
VALUE(Y,FILE,FIELD) ; $$(internal value,file,field) -> external value or ""
"RTN","LRMITSPE",67,0)
 I 'Y Q ""
"RTN","LRMITSPE",68,0)
 N C S C=$P(^DD(FILE,FIELD,0),U,2) D Y^DIQ Q Y
"RTN","LRMITSPE",69,0)
LOS(DFN,CDATE) ; $$(patient,collection date) -> length of stay or ""
"RTN","LRMITSPE",70,0)
 N ADATE S VAINDT=CDATE D INP^VADPT S ADATE=$P(VAIN(7),U) D KVAR^VADPT I '$L(ADATE) Q ""
"RTN","LRMITSPE",71,0)
 Q $$FMDIFF^XLFDT(CDATE,ADATE)
"RTN","LRSORA")
0^5^B27010859
"RTN","LRSORA",1,0)
LRSORA ;DRH/DALISC - HIGH/LOW VALUE REPORT ;2/19/91  11:42 ;
"RTN","LRSORA",2,0)
 ;;5.2;LAB SERVICE;**344**;Sep 27, 1994
"RTN","LRSORA",3,0)
MAIN D INIT,GDT,GAA:'LREND,GLRT:'LREND,GLOG:'LREND,SORTBY^LRSORA1:'LREND
"RTN","LRSORA",4,0)
 D PATS^LRSORA1:'LREND,LOCS^LRSORA1:'LREND,GDV:'LREND,RUN:'LREND
"RTN","LRSORA",5,0)
 D STOP
"RTN","LRSORA",6,0)
 Q
"RTN","LRSORA",7,0)
RUN ;
"RTN","LRSORA",8,0)
 K ^TMP("LR",$J)
"RTN","LRSORA",9,0)
 S:$D(ZTQUEUED) ZTREQ="@" U IO
"RTN","LRSORA",10,0)
 S (LRPAG,LREND)=0,$P(LRDASH,"-",IOM)="-"
"RTN","LRSORA",11,0)
 K %DT S X=$P(LRSDT,"."),%DT="X" D ^%DT,DD^LRX S LRSDAT=Y
"RTN","LRSORA",12,0)
 K %DT S X=LREDT,%DT="X" D ^%DT,DD^LRX S LREDAT=Y
"RTN","LRSORA",13,0)
 S LRHDR2="For date range: "_LREDAT_" to "_LRSDAT
"RTN","LRSORA",14,0)
 D:'LREND START^LRSORA2
"RTN","LRSORA",15,0)
 D:$D(ZTQUEUED) STOP
"RTN","LRSORA",16,0)
 Q
"RTN","LRSORA",17,0)
STOP ;
"RTN","LRSORA",18,0)
 D STOP^LRSORA0
"RTN","LRSORA",19,0)
 Q
"RTN","LRSORA",20,0)
GAA ;
"RTN","LRSORA",21,0)
 D GAA^LRSORA0
"RTN","LRSORA",22,0)
 Q
"RTN","LRSORA",23,0)
GLRT ;
"RTN","LRSORA",24,0)
 W ! K LRTST S LRTST=1
"RTN","LRSORA",25,0)
 F I=0:0 D GTSC Q:'$D(LRTST(LRTST,1))  W ! S LRTST=LRTST+1
"RTN","LRSORA",26,0)
 K LRTST(LRTST) S LRTST=LRTST-1 Q
"RTN","LRSORA",27,0)
GTSC ;
"RTN","LRSORA",28,0)
 S LRA=1
"RTN","LRSORA",29,0)
 F I=0:0 D @$S(LRA=2:"SPEC",LRA=3:"CND",LRA=4:"GV",1:"TST") Q:LRA=0
"RTN","LRSORA",30,0)
 Q
"RTN","LRSORA",31,0)
TST ;
"RTN","LRSORA",32,0)
 K DIC S DIC="^LAB(60,",DIC(0)="AEMOQ"
"RTN","LRSORA",33,0)
 S DIC("S")="I $P(^(0),U,5)[""CH"",""BO""[$P(^(0),U,3)" D ^DIC
"RTN","LRSORA",34,0)
 S LRA=$S(Y>0:2,1:0)
"RTN","LRSORA",35,0)
 S:X["^" LREND=1
"RTN","LRSORA",36,0)
 I Y>0 S $P(LRTST(LRTST,3),"^",1)=$P($P(^LAB(60,+Y,0),U,5),";",2)
"RTN","LRSORA",37,0)
 I  S $P(LRTST(LRTST,2),"^",1)=$P(Y,"^",2)
"RTN","LRSORA",38,0)
 Q
"RTN","LRSORA",39,0)
SPEC ;
"RTN","LRSORA",40,0)
 S LRCNT=LRCNT+1
"RTN","LRSORA",41,0)
 K DIC S DIC="^LAB(61,",DIC(0)="AEMOQ"
"RTN","LRSORA",42,0)
 S DIC("A")="Select SPECIMEN/SITE: ANY// " D ^DIC
"RTN","LRSORA",43,0)
 S:Y<1 $P(LRTST(LRTST,3),"^",2)="",$P(LRTST(LRTST,2),"^",2)=""
"RTN","LRSORA",44,0)
 S LRA=$S(X["^":1,1:3)
"RTN","LRSORA",45,0)
 I Y>0 S $P(LRTST(LRTST,3),"^",2)=+Y,$P(LRTST(LRTST,2),"^",2)=$P(Y,"^",2)
"RTN","LRSORA",46,0)
 Q
"RTN","LRSORA",47,0)
CND ;
"RTN","LRSORA",48,0)
 W !,"Select CONDITION: " R X:DTIME S:'$T X="^"
"RTN","LRSORA",49,0)
 D @$S(X?1.N1":"1.N:"RNG",1:"GC") Q
"RTN","LRSORA",50,0)
RNG ;
"RTN","LRSORA",51,0)
 N Y
"RTN","LRSORA",52,0)
 S LRV=+$P(X,":",1),LRV2=+$P(X,":",2),LRA=0
"RTN","LRSORA",53,0)
 S:LRV>LRV2 X=LRV,LRV=LRV2,LRV2=X
"RTN","LRSORA",54,0)
 S $P(LRTST(LRTST,2),U,3)="BETWEEN "_LRV_" AND "_LRV2
"RTN","LRSORA",55,0)
 S X=$P(LRTST(LRTST,3),U,1)
"RTN","LRSORA",56,0)
 S Y="I $D(^("_X
"RTN","LRSORA",57,0)
 S Y=Y_")) S LRVX=$P(^("_X
"RTN","LRSORA",58,0)
 S Y=Y_"),U),LRVX=$S(LRVX?1A.E:LRVX,"
"RTN","LRSORA",59,0)
 S Y=Y_"""<>""[$E(LRVX):$E(LRVX,2,$L(LRVX)),1:LRVX)"
"RTN","LRSORA",60,0)
 S LRTST(LRTST,1)=Y_" I LRVX>"_LRV_",LRVX<"_LRV2
"RTN","LRSORA",61,0)
 D ASPC Q
"RTN","LRSORA",62,0)
GC ;
"RTN","LRSORA",63,0)
 S DIC="^DOPT(""DIS"",",DIC(0)="EMQZ",DIC("S")="I $L($P(^(0),U,2))"
"RTN","LRSORA",64,0)
 D ^DIC K DIC
"RTN","LRSORA",65,0)
 S LRA=$S(X["^":2,Y<0:3,1:4) D:X["?" HLP1 W:'$L(X) " ??" Q:Y<0
"RTN","LRSORA",66,0)
GV ;
"RTN","LRSORA",67,0)
 N LY,ALPHA,DEC,II,TT
"RTN","LRSORA",68,0)
 W !,"Enter VALUE: "
"RTN","LRSORA",69,0)
 R X:DTIME S:'$T X="^"
"RTN","LRSORA",70,0)
 S LRA=$S(X["^":3,"?"[X:4,1:0)
"RTN","LRSORA",71,0)
 W:X="" " ??" D:X["?" HLP2 Q:LRA
"RTN","LRSORA",72,0)
 S:"<>"[$P(Y(0),U,2) X=+X
"RTN","LRSORA",73,0)
 S $P(LRTST(LRTST,2),"^",3)=$P(Y(0),"^",1)_" "_X
"RTN","LRSORA",74,0)
 ;
"RTN","LRSORA",75,0)
 ; determine if entered value is alphanumeric
"RTN","LRSORA",76,0)
 S (ALPHA,DEC)=0
"RTN","LRSORA",77,0)
 F II=1:1 S TT=$E(X,II) Q:TT=""  D  Q:ALPHA
"RTN","LRSORA",78,0)
 . I TT?1N Q
"RTN","LRSORA",79,0)
 . I TT?1"." S DEC=DEC+1 S:DEC>1 ALPHA=1 Q
"RTN","LRSORA",80,0)
 . S ALPHA=1
"RTN","LRSORA",81,0)
 ;
"RTN","LRSORA",82,0)
 S LY="I $D(^("_$P(LRTST(LRTST,3),U)
"RTN","LRSORA",83,0)
 S LY=LY_")) S LRVX=$P(^("
"RTN","LRSORA",84,0)
 S LY=LY_$P(LRTST(LRTST,3),U)
"RTN","LRSORA",85,0)
 S LY=LY_"),U),LRVX=$S(LRVX?1A.E:LRVX,"
"RTN","LRSORA",86,0)
 S LY=LY_"""<>""[$E(LRVX):$E(LRVX,2,$L(LRVX)),1:LRVX) I LRVX"
"RTN","LRSORA",87,0)
 S LRTST(LRTST,1)=LY_$P(Y(0),U,2)_$S(ALPHA:""""_X_"""",1:X) D ASPC Q
"RTN","LRSORA",88,0)
ASPC ;
"RTN","LRSORA",89,0)
 S:$L($P(LRTST(LRTST,3),U,2)) LRTST(LRTST,1)=LRTST(LRTST,1)_",$P(^(0),U,5)="_$P(LRTST(LRTST,3),U,2) Q
"RTN","LRSORA",90,0)
INIT ;
"RTN","LRSORA",91,0)
 S LRCNT=0
"RTN","LRSORA",92,0)
 S U="^"
"RTN","LRSORA",93,0)
 S LREND=0
"RTN","LRSORA",94,0)
 S LRLONG=0
"RTN","LRSORA",95,0)
 S LRSDT="TODAY"
"RTN","LRSORA",96,0)
 S LREDT="T-1"
"RTN","LRSORA",97,0)
 S LRTW=.00001
"RTN","LRSORA",98,0)
 S:'$D(DTIME) DTIME=300
"RTN","LRSORA",99,0)
 W !,"SPECIAL REPORT - Search for high/low values" Q
"RTN","LRSORA",100,0)
GDT ;
"RTN","LRSORA",101,0)
 F W=0:0 D SDF,GSD Q:LREND  S LRSDT=Y D GED I Y>0 S LREDT=Y S:LREDT>LRSDT X=LREDT,LREDT=LRSDT,LRSDT=X D CXR Q:Y>0
"RTN","LRSORA",102,0)
 K %DT S X=$P(LRSDT,"."),%DT="X" D ^%DT,DD^LRX S LRSDAT=Y
"RTN","LRSORA",103,0)
 K %DT S X=$P(LREDT,"."),%DT="X" D ^%DT,DD^LRX S LREDAT=Y
"RTN","LRSORA",104,0)
 S LRHDR2="For date range: "_LREDAT_" to "_LRSDAT
"RTN","LRSORA",105,0)
 K LRSDAT,LREDAT,%DT Q
"RTN","LRSORA",106,0)
GSD ;
"RTN","LRSORA",107,0)
 S %DT("A")="Enter START date: ",%DT("B")=LRSDT,%DT="AET"
"RTN","LRSORA",108,0)
 D ^%DT S LREND=Y<1 Q
"RTN","LRSORA",109,0)
GED ;
"RTN","LRSORA",110,0)
 S %DT("A")="Enter END date: ",%DT("B")=LREDT D ^%DT Q
"RTN","LRSORA",111,0)
CXR ;
"RTN","LRSORA",112,0)
 S Y=$E(LREDT,1,3)_"0000" F I=0:0 S Y=$O(^LRO(69,Y)) Q:Y=""!($D(^LRO(69,+Y,1,"AN")))
"RTN","LRSORA",113,0)
 I Y>LREDT D DD^LRX W !,"The earliest date in the X-ref is ",Y,".  Long search required.",! D CXR1
"RTN","LRSORA",114,0)
 Q
"RTN","LRSORA",115,0)
CXR1 ;
"RTN","LRSORA",116,0)
 F I=0:0 S %=2 W "  OK to continue" D YN^DICN S:%=2!(%<0) LREND=1 S:%=1 LRLONG=1 Q:%  W !,"Enter 'YES' for the long search, 'NO' to exit.",!
"RTN","LRSORA",117,0)
 Q
"RTN","LRSORA",118,0)
SDF ;
"RTN","LRSORA",119,0)
 I LRSDT?1.7N S Y=LRSDT D DD^LRX S LRSDT=Y
"RTN","LRSORA",120,0)
 I LREDT?1.7N S Y=LREDT D DD^LRX S LREDT=Y
"RTN","LRSORA",121,0)
 Q
"RTN","LRSORA",122,0)
GLOG ;
"RTN","LRSORA",123,0)
 S:LRTST=1 LRTST(0)="A" D:LRTST>1 EN^LRSORA1 S:LRTST<1 LREND=1 Q
"RTN","LRSORA",124,0)
GDV ;
"RTN","LRSORA",125,0)
 S %ZIS="Q" D ^%ZIS K %ZIS I POP S LREND=1 Q
"RTN","LRSORA",126,0)
 I $D(IO("Q")) K IO("Q") S (LRQUE,LREND)=1,ZTRTN="RUN^LRSORA",ZTDESC="Lab Special Report",ZTSAVE("LR*")="" D ^%ZTLOAD
"RTN","LRSORA",127,0)
 Q
"RTN","LRSORA",128,0)
HLP1 ;
"RTN","LRSORA",129,0)
 W !,"A VALUE RANGE may also be entered (value:value).",!,"  For Example, 100:200 will search for values between 100 and 200.",!
"RTN","LRSORA",130,0)
 Q
"RTN","LRSORA",131,0)
HLP2 ;
"RTN","LRSORA",132,0)
 W !,"Enter a value for the comparison:  "
"RTN","LRSORA",133,0)
 W $P(LRTST(LRTST,2),U,1)," ",$P(Y(0),U,1)_" _____."
"RTN","LRSORA",134,0)
 Q
"RTN","LRSORA",135,0)
XX ;
"RTN","LRSORA",136,0)
WAIT K DIR S DIR(0)="E" D ^DIR S:($D(DUOUT))!($D(DTOUT)) LREND=1
"RTN","LRSORA",137,0)
 Q
"RTN","LRSORA3")
0^6^B16971117
"RTN","LRSORA3",1,0)
LRSORA3 ;SLC/KCM - SEARCH LAB DATA AND PRINT REPORT ;8/28/89  12:07 ;
"RTN","LRSORA3",2,0)
 ;;5.2;LAB SERVICE;**1,344**;Sep 27, 1994
"RTN","LRSORA3",3,0)
BUILD ;
"RTN","LRSORA3",4,0)
 S LRLOG="I "
"RTN","LRSORA3",5,0)
 F %=1:1:$L(LRTST(0)) D
"RTN","LRSORA3",6,0)
 . S LRLOG=LRLOG_$S($E(LRTST(0),%)?1A:"T("_($A(LRTST(0),%)-64)_")",1:$E(LRTST(0),%))
"RTN","LRSORA3",7,0)
 S LRDFN=0,LRLDFN=0,LREND=0
"RTN","LRSORA3",8,0)
 D SHORT:'LRLONG,LONG:LRLONG
"RTN","LRSORA3",9,0)
 Q
"RTN","LRSORA3",10,0)
SHORT ;
"RTN","LRSORA3",11,0)
 S LRVDT=$P(LREDT,".",1)-.01
"RTN","LRSORA3",12,0)
 F  S LRVDT=$O(^LRO(69,LRVDT)) Q:LRVDT=""!(LRVDT>LRSDT)  D
"RTN","LRSORA3",13,0)
 . S LRLLOC=""
"RTN","LRSORA3",14,0)
 . F  S LRLLOC=$O(^LRO(69,LRVDT,1,"AN",LRLLOC)) Q:LRLLOC=""  D
"RTN","LRSORA3",15,0)
 .. S LRDFN=0
"RTN","LRSORA3",16,0)
 .. F  S LRDFN=$O(^LRO(69,LRVDT,1,"AN",LRLLOC,LRDFN)) Q:LRDFN<1  D GIDT
"RTN","LRSORA3",17,0)
 Q
"RTN","LRSORA3",18,0)
GIDT ;
"RTN","LRSORA3",19,0)
 S LRIDT=0
"RTN","LRSORA3",20,0)
 F  S LRIDT=$O(^LRO(69,LRVDT,1,"AN",LRLLOC,LRDFN,LRIDT)) Q:LRIDT<1  D EVTW
"RTN","LRSORA3",21,0)
 Q
"RTN","LRSORA3",22,0)
LONG ;
"RTN","LRSORA3",23,0)
 S LRSDT=9999998-LRSDT,LREDT=9999999-LREDT
"RTN","LRSORA3",24,0)
 S LRDFN=0 F  S LRDFN=$O(^LR(LRDFN)) Q:LRDFN<1  D GDATA
"RTN","LRSORA3",25,0)
 Q
"RTN","LRSORA3",26,0)
GDATA ;
"RTN","LRSORA3",27,0)
 S LRIDT=LRSDT
"RTN","LRSORA3",28,0)
 F  S LRIDT=$O(^LR(LRDFN,"CH",LRIDT)) Q:LRIDT=""!(LRIDT>LREDT)  D
"RTN","LRSORA3",29,0)
 . D:$L($P(^LR(LRDFN,"CH",LRIDT,0),U,3)) EVTW
"RTN","LRSORA3",30,0)
 Q
"RTN","LRSORA3",31,0)
EVTW ;
"RTN","LRSORA3",32,0)
 S %=$G(^LR(LRDFN,"CH",LRIDT,0)) Q:'$L(%)
"RTN","LRSORA3",33,0)
 I LRAA S LRAAA=$P($P(%,U,6)," ") Q:'$D(LRAA(LRAAA))#2
"RTN","LRSORA3",34,0)
 K V F J=1:1:LRTST S T(J)=0
"RTN","LRSORA3",35,0)
 D EVAL Q:$G(LRNOP)  X LRLOG
"RTN","LRSORA3",36,0)
 I $T S LRIDT1=0 F  S LRIDT1=$O(V(LRIDT1)) Q:LRIDT1<1  D
"RTN","LRSORA3",37,0)
 . S LRSUB=0 F  S LRSUB=$O(V(LRIDT1,LRSUB)) Q:LRSUB<1  D SET
"RTN","LRSORA3",38,0)
 Q
"RTN","LRSORA3",39,0)
EVAL ;
"RTN","LRSORA3",40,0)
 F J=1:1:LRTST X LRTST(J,1) D
"RTN","LRSORA3",41,0)
 . I $T S T(J)=1
"RTN","LRSORA3",42,0)
 . I  S X=$P(LRTST(J,3),U,1)
"RTN","LRSORA3",43,0)
 . I  S $P(V(LRIDT,X),U,1)=$P(^LR(LRDFN,"CH",LRIDT,X),U,1)
"RTN","LRSORA3",44,0)
 . I  S $P(V(LRIDT,X),U,2)=$P(^LR(LRDFN,"CH",LRIDT,X),U,2)
"RTN","LRSORA3",45,0)
 . I  S $P(V(LRIDT,X),U,3)=$P(LRTST(J,2),U,1)
"RTN","LRSORA3",46,0)
 Q
"RTN","LRSORA3",47,0)
SET ;
"RTN","LRSORA3",48,0)
 K LRWRD
"RTN","LRSORA3",49,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) Q:LRDPF<1!(LRDPF=62.3)  D PT^LRX
"RTN","LRSORA3",50,0)
 I LRPTS Q:'$D(LRPTS(DFN))
"RTN","LRSORA3",51,0)
 S %=^LR(LRDFN,"CH",LRIDT1,0),LRAN=$P(^(0),U,6),LRLOC=$P(^(0),U,11)
"RTN","LRSORA3",52,0)
 Q:LRLOC=""  I LRLCS Q:'$D(LRLCS(LRLOC))
"RTN","LRSORA3",53,0)
 ;S LRWRD="" S:LRDPF=2 LRWRD=$S($D(^DPT(DFN,.1)):^(.1),1:"")
"RTN","LRSORA3",54,0)
 S LRWRD=$G(^DPT(DFN,.1))
"RTN","LRSORA3",55,0)
 S (Y1,LRDAT)=$P(^LR(LRDFN,"CH",LRIDT1,0),U,1),Y2=1
"RTN","LRSORA3",56,0)
 S LRCDT=$$DDDATE^LRAFUNC1(Y1,Y2) K Y1,Y2
"RTN","LRSORA3",57,0)
 S LRSUB1=$S(LRSRT="P":PNM_SSN,1:LRLOC)
"RTN","LRSORA3",58,0)
 S LRSUB2=$S(LRSRT="P":LRDAT,1:PNM_SSN)
"RTN","LRSORA3",59,0)
 S LRSUB3=$S(LRSRT="P":LRLOC,1:LRDAT)
"RTN","LRSORA3",60,0)
 S LRSPEC=$P(^LR(LRDFN,"CH",LRIDT1,0),U,5) D RRNG
"RTN","LRSORA3",61,0)
 S LRSPEC=$P($G(^LAB(61,LRSPEC,0)),U)
"RTN","LRSORA3",62,0)
 S LRTEST=LRTSTX
"RTN","LRSORA3",63,0)
 S LRVAL=$P(V(LRIDT1,LRSUB),U)
"RTN","LRSORA3",64,0)
 S LRMRK=$P(V(LRIDT1,LRSUB),U,2)
"RTN","LRSORA3",65,0)
 I LRSRT="P" S ^TMP("LR",$J,LRSUB1,LRSPEC,LRTEST,LRIDT)=PNM_U_SSN_U_LRLOC_U_U_LRSPEC_U_U_LRLO_U_LRHI_U_LRVAL_U_LRMRK_U_LRTHER_U_LRWRD_U_LRAN_U_LRDAT_U_LRTEST_U_LRUNITS
"RTN","LRSORA3",66,0)
 I LRSRT'="P" S ^TMP("LR",$J,LRLOC,LRSUB2,LRSPEC,LRTEST,LRIDT)=PNM_U_SSN_U_LRLOC_U_U_LRSPEC_U_U_LRLO_U_LRHI_U_LRVAL_U_LRMRK_U_LRTHER_U_LRWRD_U_LRAN_U_LRDAT_U_LRTEST_U_LRUNITS
"RTN","LRSORA3",67,0)
 S C=0
"RTN","LRSORA3",68,0)
 F  S C=$O(^LR(LRDFN,"CH",LRIDT,1,C)) Q:'C  D
"RTN","LRSORA3",69,0)
 . I LRSRT="P" S ^TMP("LR",$J,LRSUB1,LRSPEC,LRTEST,LRIDT,"COM",C)=^LR(LRDFN,"CH",LRIDT,1,C,0)
"RTN","LRSORA3",70,0)
 . I LRSRT'="P" S ^TMP("LR",$J,LRLOC,LRSUB2,LRSPEC,LRTEST,LRIDT,"COM",C)=^LR(LRDFN,"CH",LRIDT,1,C,0)
"RTN","LRSORA3",71,0)
 Q
"RTN","LRSORA3",72,0)
RRNG ;
"RTN","LRSORA3",73,0)
 N LRFLAG
"RTN","LRSORA3",74,0)
 S (LRHI,LRLO,LRTHER,LRFLAG)="",X="CH;"_LRSUB_";1",X=$O(^LAB(60,"C",X,0))
"RTN","LRSORA3",75,0)
 S LRTSTX=$P(^LAB(60,X,.1),U)
"RTN","LRSORA3",76,0)
 S LRUNITS=$P($G(^LAB(60,X,1,LRSPEC,0)),"^",7)
"RTN","LRSORA3",77,0)
 S:$L(X)&$L(LRSPEC) X=$S($D(^LAB(60,X,1,LRSPEC,0)):^(0),1:"") Q:X=""
"RTN","LRSORA3",78,0)
 ;
"RTN","LRSORA3",79,0)
 ; check for ranges in file 63
"RTN","LRSORA3",80,0)
 D CHK63
"RTN","LRSORA3",81,0)
 ;
"RTN","LRSORA3",82,0)
 S LRTHER=$P(X,U,11)'=""&($P(X,U,12)'="")
"RTN","LRSORA3",83,0)
 S LRLO=$S('LRTHER:$P(X,U,2),1:$P(X,U,11))
"RTN","LRSORA3",84,0)
 S LRHI=$S('LRTHER:$P(X,U,3),1:$P(X,U,12))
"RTN","LRSORA3",85,0)
 I 'LRFLAG D
"RTN","LRSORA3",86,0)
 . S @("LRLO="_$S($L(LRLO):LRLO,1:""""""))
"RTN","LRSORA3",87,0)
 . S @("LRHI="_$S($L(LRHI):LRHI,1:""""""))
"RTN","LRSORA3",88,0)
 Q
"RTN","LRSORA3",89,0)
 ;
"RTN","LRSORA3",90,0)
CHK63 ;
"RTN","LRSORA3",91,0)
 N LR63DAT,PC5
"RTN","LRSORA3",92,0)
 S LR63DAT=$G(^LR(LRDFN,"CH",LRIDT,LRSUB))
"RTN","LRSORA3",93,0)
 I $G(^LR(LRDFN,"CH",LRIDT,"NPC"))>1,$P(LR63DAT,U,5,12)'="" S LRFLAG=1
"RTN","LRSORA3",94,0)
 I LRFLAG D
"RTN","LRSORA3",95,0)
 .S PC5=$P(LR63DAT,U,5)
"RTN","LRSORA3",96,0)
 .S PC5=$TR(PC5,"!","^")
"RTN","LRSORA3",97,0)
 .S X=PC5
"RTN","LRSORA3",98,0)
 Q
"RTN","LRSORC1")
0^3^B8026768
"RTN","LRSORC1",1,0)
LRSORC1 ;SLC/RWF/DALISC/JBM - CRITICAL VALUE REPORT ; 8/30/87  17:25 ;
"RTN","LRSORC1",2,0)
 ;;5.2;LAB SERVICE;**153,344**;Sep 27, 1994
"RTN","LRSORC1",3,0)
EN ;
"RTN","LRSORC1",4,0)
BUILD ;
"RTN","LRSORC1",5,0)
 S LRPDT=LREDT-.000001
"RTN","LRSORC1",6,0)
 F  S LRPDT=$O(^LRO(69,LRPDT)) Q:('LRPDT)!(LRPDT>LRSDT)!(LREND=1)  D
"RTN","LRSORC1",7,0)
 .S LRLLOC=""
"RTN","LRSORC1",8,0)
 .F  S LRLLOC=$O(^LRO(69,LRPDT,1,"AN",LRLLOC)) Q:LRLLOC=""  D
"RTN","LRSORC1",9,0)
 ..S LRDFN=0
"RTN","LRSORC1",10,0)
 ..F  S LRDFN=$O(^LRO(69,LRPDT,1,"AN",LRLLOC,LRDFN)) Q:'LRDFN  D LRIDT
"RTN","LRSORC1",11,0)
 Q
"RTN","LRSORC1",12,0)
LRIDT ;
"RTN","LRSORC1",13,0)
 S LRIDT=0,LRSPEC=0
"RTN","LRSORC1",14,0)
 F  S LRIDT=$O(^LRO(69,LRPDT,1,"AN",LRLLOC,LRDFN,LRIDT)) Q:'LRIDT  D LOOK
"RTN","LRSORC1",15,0)
 Q
"RTN","LRSORC1",16,0)
LOOK ;
"RTN","LRSORC1",17,0)
 N LR63RLO,LR63RHI,LR63CLO,LR63CHI,LR63TLO,LR63THI,LR63DAT,PC5,LRFLAG
"RTN","LRSORC1",18,0)
 K T S L0=$G(^LR(LRDFN,"CH",LRIDT,0)) Q:'$L(L0)
"RTN","LRSORC1",19,0)
 S LRSPEC=$P(L0,"^",5)
"RTN","LRSORC1",20,0)
 I LRAA S LRAAA=$P($P(L0,U,6)," ") Q:'$L(LRAAA)  Q:'$D(LRAA(LRAAA))#2
"RTN","LRSORC1",21,0)
 S T=0,I=1
"RTN","LRSORC1",22,0)
 F  S I=$O(^LR(LRDFN,"CH",LRIDT,I)) Q:LREND!(I<1)  D
"RTN","LRSORC1",23,0)
 .I $P(^LR(LRDFN,"CH",LRIDT,I),U,2)["*" D
"RTN","LRSORC1",24,0)
 ..S T=T+1,T(I)=^LR(LRDFN,"CH",LRIDT,I)
"RTN","LRSORC1",25,0)
 ..I $G(LRFLAG)="" D
"RTN","LRSORC1",26,0)
 ...I $G(^LR(LRDFN,"CH",LRIDT,"NPC"))>1,$P(T(I),U,5,12)'="" S LRFLAG=1 Q
"RTN","LRSORC1",27,0)
 ...S LRFLAG=0
"RTN","LRSORC1",28,0)
 I T D
"RTN","LRSORC1",29,0)
 .S X=^LR(LRDFN,0)
"RTN","LRSORC1",30,0)
 .S LRDPF=$P(X,U,2),DFN=$P(X,U,3)
"RTN","LRSORC1",31,0)
 .I LRPTS Q:'$D(LRPTS(DFN))
"RTN","LRSORC1",32,0)
 .D PT^LRX
"RTN","LRSORC1",33,0)
 .S LRLOC=LRLLOC
"RTN","LRSORC1",34,0)
 .;S LRLOC=$S($D(^DPT(DFN,.1)):^(.1),1:LRLLOC)
"RTN","LRSORC1",35,0)
 .I LRLCS Q:'$D(LRLCS(LRLLOC))
"RTN","LRSORC1",36,0)
 .S LRDAT=$P(^LR(LRDFN,"CH",LRIDT,0),U),LRSPEC=$P(^(0),U,5)
"RTN","LRSORC1",37,0)
 .S LRSUB1=$S(LRSRT="P":PNM_SSN,1:LRLOC)
"RTN","LRSORC1",38,0)
 .S LRSUB2=$S(LRSRT="P":LRDAT,1:PNM_SSN)
"RTN","LRSORC1",39,0)
 .S LRSUB3=$S(LRSRT="P":LRLOC,1:LRDAT)
"RTN","LRSORC1",40,0)
 .S LRAN=$P(L0,U,6)
"RTN","LRSORC1",41,0)
 .K %DT S X=$P(L0,U),%DT="XT" D ^%DT,DD^LRX S LRSPDAT=Y
"RTN","LRSORC1",42,0)
 .S ^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN)=PNM_U_SSN_U_LRLOC_U_LRDPF_U_LRSPDAT_U_LRSPEC
"RTN","LRSORC1",43,0)
 .S I=0
"RTN","LRSORC1",44,0)
 .F  S I=$O(T(I)) Q:LREND!(I<1)  D
"RTN","LRSORC1",45,0)
 ..S LRTX=$O(^LAB(60,"C","CH;"_I_";1",0))
"RTN","LRSORC1",46,0)
 ..I LRTX>0 D
"RTN","LRSORC1",47,0)
 ...S LRTST=$P(^LAB(60,LRTX,0),U),LRTVAL=$P(T(I),U)
"RTN","LRSORC1",48,0)
 ...S LRCRTFLG=$P(T(I),U,2)
"RTN","LRSORC1",49,0)
 ...I $G(LRFLAG) D GET63
"RTN","LRSORC1",50,0)
 ...S ^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"TST",I)=LRTST_U_LRTVAL_U_LRCRTFLG_U_LRSPEC_U_LRTX_U_$G(LRFLAG)_$S($G(LRFLAG):LR63DAT,1:"")
"RTN","LRSORC1",51,0)
 .S C=0
"RTN","LRSORC1",52,0)
 .F  S C=$O(^LR(LRDFN,"CH",LRIDT,1,C)) Q:'C  D
"RTN","LRSORC1",53,0)
 ..S ^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"COM",C)=^LR(LRDFN,"CH",LRIDT,1,C,0)
"RTN","LRSORC1",54,0)
 Q
"RTN","LRSORC1",55,0)
 ;
"RTN","LRSORC1",56,0)
GET63 ; get ranges from file 63 (T(I)) if they are stored there
"RTN","LRSORC1",57,0)
 S PC5=$P(T(I),U,5)
"RTN","LRSORC1",58,0)
 S LR63RLO=$P(PC5,"!",2)
"RTN","LRSORC1",59,0)
 S LR63RHI=$P(PC5,"!",3)
"RTN","LRSORC1",60,0)
 S LR63CLO=$P(PC5,"!",4)
"RTN","LRSORC1",61,0)
 S LR63CHI=$P(PC5,"!",5)
"RTN","LRSORC1",62,0)
 S LR63TLO=$P(PC5,"!",11)
"RTN","LRSORC1",63,0)
 S LR63THI=$P(PC5,"!",12)
"RTN","LRSORC1",64,0)
 S LR63DAT=U_LR63RLO_U_LR63RHI_U_LR63CLO_U_LR63CHI_U_LR63TLO_U_LR63THI
"RTN","LRSORC1",65,0)
 Q
"RTN","LRSORC1A")
0^4^B22165850
"RTN","LRSORC1A",1,0)
LRSORC1A ;DALISC/DRH - LRSORC Continued ;07-22-93
"RTN","LRSORC1A",2,0)
 ;;5.2;LAB SERVICE;**201,344**;Sep 27, 1994
"RTN","LRSORC1A",3,0)
INIT ;
"RTN","LRSORC1A",4,0)
 S U="^"
"RTN","LRSORC1A",5,0)
 D CONTROL
"RTN","LRSORC1A",6,0)
 Q
"RTN","LRSORC1A",7,0)
CONTROL ;
"RTN","LRSORC1A",8,0)
 D SORT
"RTN","LRSORC1A",9,0)
 Q
"RTN","LRSORC1A",10,0)
SORT ;
"RTN","LRSORC1A",11,0)
 W:$E(IOST,1,2)="C-" @IOF
"RTN","LRSORC1A",12,0)
 W:$E(IOST,1,2)="P-" !
"RTN","LRSORC1A",13,0)
 D HDR
"RTN","LRSORC1A",14,0)
 D PRINT
"RTN","LRSORC1A",15,0)
 D:'LREND SUMMARY
"RTN","LRSORC1A",16,0)
 D END
"RTN","LRSORC1A",17,0)
 Q
"RTN","LRSORC1A",18,0)
SUMMARY ;
"RTN","LRSORC1A",19,0)
 I ($Y>(IOSL-7)) D:$E(IOST,1,2)="C-" WAIT Q:LREND  W @IOF D HDR
"RTN","LRSORC1A",20,0)
 F I=$Y:1:(IOSL-6) W !
"RTN","LRSORC1A",21,0)
 W ?20,"END OF SPECIAL REPORT"
"RTN","LRSORC1A",22,0)
 Q
"RTN","LRSORC1A",23,0)
END ;
"RTN","LRSORC1A",24,0)
 D:($E(IOST,1,2)="C-")&('LREND) WAIT
"RTN","LRSORC1A",25,0)
 W @IOF D:'$D(ZTQUEUED) ^%ZISC
"RTN","LRSORC1A",26,0)
 K ^TMP("LR",$J)
"RTN","LRSORC1A",27,0)
 K ZTRTN,ZTIO,ZTDESC,ZTSAVE,ZTSK,ZTQUEUED,%ZIS,POP,%H,%DT,DTOUT,DUOUT
"RTN","LRSORC1A",28,0)
 K DIR,DIC,I,T,C,X,Y,L0,SEX,AGE,DFN,DOB,PNM,SSN,VA("BID"),VA("PID"),VAERR
"RTN","LRSORC1A",29,0)
 K LRAA,LRAD,LRDFN,LRDPF,LREND,LRFAN,LRIDT,LRLAN,LRLCS,LRSUB1,LRSUB2
"RTN","LRSORC1A",30,0)
 K LRLLOC,LRTX,LRTST,LRTVAL,LRCRTFLG,LRAN,LRSRT,LRPAG,LRDATE,LRDASH,LRDAT
"RTN","LRSORC1A",31,0)
 K LRLOC,LRPTS,LREDT,LRPDT,LRSDT,LRTREC,LRPREC,LREDAT,LRSDAT,LRSPDAT
"RTN","LRSORC1A",32,0)
 K LRWRD,LRHDR2,LRSUB3,LRAAA
"RTN","LRSORC1A",33,0)
 Q
"RTN","LRSORC1A",34,0)
PRINT ;
"RTN","LRSORC1A",35,0)
 S LRSUB1=""
"RTN","LRSORC1A",36,0)
 I $O(^TMP("LR",$J,LRSUB1))="" W !!?30,"NO MATCHING DATA FOUND",!! Q
"RTN","LRSORC1A",37,0)
 F  S LRSUB1=$O(^TMP("LR",$J,LRSUB1)) Q:(LRSUB1="")!(LREND)  D
"RTN","LRSORC1A",38,0)
 .S LRSUB2=""
"RTN","LRSORC1A",39,0)
 .F  S LRSUB2=$O(^TMP("LR",$J,LRSUB1,LRSUB2)) Q:(LRSUB2="")!(LREND)  D
"RTN","LRSORC1A",40,0)
 ..S LRSUB3=""
"RTN","LRSORC1A",41,0)
 ..F  S LRSUB3=$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3)) Q:(LRSUB3="")!(LREND)  D
"RTN","LRSORC1A",42,0)
 ...S LRAN=""
"RTN","LRSORC1A",43,0)
 ...F  S LRAN=$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN)) Q:(LRAN="")!(LREND)  D
"RTN","LRSORC1A",44,0)
 ....S LRPREC=^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN)
"RTN","LRSORC1A",45,0)
 ....S LRDPF=$P(LRPREC,U,4)
"RTN","LRSORC1A",46,0)
 ....S PNM=$P(LRPREC,U),SSN=$P(LRPREC,U,2),LRLOC=$P(LRPREC,U,3)
"RTN","LRSORC1A",47,0)
 ....S LRSPEC=$P(^LAB(61,$P(LRPREC,U,6),0),U)
"RTN","LRSORC1A",48,0)
 ....S LRSPNUM=$P(LRPREC,U,6)
"RTN","LRSORC1A",49,0)
 ....S LRSPDAT=$P(LRPREC,U,5)
"RTN","LRSORC1A",50,0)
 ....I ($Y>(IOSL-8)) D:$E(IOST,1,2)="C-" WAIT Q:LREND  W @IOF D HDR
"RTN","LRSORC1A",51,0)
 ....;S PNM1=$P(PNM,","),PNM2=$P(PNM,",",2)
"RTN","LRSORC1A",52,0)
 ....;S LRCHNG=PNM1 D CHNCASE^LRSORA2 S PNM1=LRCHNG
"RTN","LRSORC1A",53,0)
 ....;S LRCHNG=PNM2 D CHNCASE^LRSORA2 S PNM2=LRCHNG
"RTN","LRSORC1A",54,0)
 ....;S PNM=PNM1_","_PNM2
"RTN","LRSORC1A",55,0)
 ....;S LRCHNG=LRSPEC D CHNCASE^LRSORA2 S LRSPEC=LRCHNG
"RTN","LRSORC1A",56,0)
 ....W !,$E(PNM,1,23),?25,SSN W:LRDPF=2 " ",LRLOC,?50,$E(LRAN,1,14)
"RTN","LRSORC1A",57,0)
 ....W ?62,LRSPDAT
"RTN","LRSORC1A",58,0)
 ....W !," ",LRSPEC
"RTN","LRSORC1A",59,0)
 ....D PRNTST
"RTN","LRSORC1A",60,0)
 Q
"RTN","LRSORC1A",61,0)
PRNTST ;
"RTN","LRSORC1A",62,0)
 N LRRLO,LRRHI,LRCLO,LRCHI,LRTLO,LRTHI,LRFLAG,VAR
"RTN","LRSORC1A",63,0)
 S I=""
"RTN","LRSORC1A",64,0)
 F  S I=$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"TST",I)) Q:(I="")!(LREND)  D
"RTN","LRSORC1A",65,0)
 .S LRTREC=^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"TST",I)
"RTN","LRSORC1A",66,0)
 .S LRTST=$P(LRTREC,U),LRTVAL=$P(LRTREC,U,2),LRCRTFLG=$P(LRTREC,U,3)
"RTN","LRSORC1A",67,0)
 .I ($Y>(IOSL-7)) D
"RTN","LRSORC1A",68,0)
 ..D CONT D:$E(IOST,1,2)="C-" WAIT Q:LREND
"RTN","LRSORC1A",69,0)
 ..W @IOF D HDR
"RTN","LRSORC1A",70,0)
 ..W !,$E(PNM,1,23),?25,SSN W:LRDPF=2 " ",LRLOC,?50,$E(LRAN,1,14)
"RTN","LRSORC1A",71,0)
 ..W ?62,LRSPDAT
"RTN","LRSORC1A",72,0)
 .Q:LREND
"RTN","LRSORC1A",73,0)
 .S LRTX=$P(LRTREC,U,5)
"RTN","LRSORC1A",74,0)
 .S LRFLAG=$P(LRTREC,U,6)
"RTN","LRSORC1A",75,0)
 .S LRREF=$G(^LAB(60,LRTX,1,LRSPNUM,0))
"RTN","LRSORC1A",76,0)
 .; set ranges  LRFLAG on - from file 63     LRFLAG off - from file 60
"RTN","LRSORC1A",77,0)
 .S LRRLO=$S(LRFLAG:$P(LRTREC,U,7),1:$P(LRREF,U,2))
"RTN","LRSORC1A",78,0)
 .S LRRHI=$S(LRFLAG:$P(LRTREC,U,8),1:$P(LRREF,U,3))
"RTN","LRSORC1A",79,0)
 .S LRCLO=$S(LRFLAG:$P(LRTREC,U,9),1:$P(LRREF,U,4))
"RTN","LRSORC1A",80,0)
 .S LRCHI=$S(LRFLAG:$P(LRTREC,U,10),1:$P(LRREF,U,5))
"RTN","LRSORC1A",81,0)
 .S LRTLO=$S(LRFLAG:$P(LRTREC,U,11),1:$P(LRREF,U,11))
"RTN","LRSORC1A",82,0)
 .S LRTHI=$S(LRFLAG:$P(LRTREC,U,12),1:$P(LRREF,U,12))
"RTN","LRSORC1A",83,0)
 .F VAR="LRRLO","LRRHI","LRCLO","LRCHI" I @VAR="" S @VAR="none"
"RTN","LRSORC1A",84,0)
 .;
"RTN","LRSORC1A",85,0)
 .S LRTST=$P($G(^LAB(60,LRTX,.1)),U)
"RTN","LRSORC1A",86,0)
 .I 'LRTST S LRTST=$E($P(^LAB(60,LRTX,0),U),1,10)
"RTN","LRSORC1A",87,0)
 .;I 'LRTST S LRTST=$E($P(^LAB(60,LRTX,0),U),1,10)
"RTN","LRSORC1A",88,0)
 .;S LRCHNG=LRTST D CHNCASE^LRSORA2 S LRTST=LRCHNG
"RTN","LRSORC1A",89,0)
 .W !,?2,$E(LRTST,1,7),?12,$J(LRTVAL,6)
"RTN","LRSORC1A",90,0)
 .W ?19,$E($P(LRREF,U,7),1,10),?28,LRCRTFLG
"RTN","LRSORC1A",91,0)
 . I 'LRTLO,('LRTHI) D RANGE
"RTN","LRSORC1A",92,0)
 . I LRTLO W ?32,"Ther: ",LRTLO,"-"
"RTN","LRSORC1A",93,0)
 . I LRTHI W LRTHI D CRITICL
"RTN","LRSORC1A",94,0)
 I '$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"COM",0)) W !
"RTN","LRSORC1A",95,0)
 E  D COM
"RTN","LRSORC1A",96,0)
 Q
"RTN","LRSORC1A",97,0)
COM ;Print comments on specimen
"RTN","LRSORC1A",98,0)
 W !,"COMMENT(S): "
"RTN","LRSORC1A",99,0)
 S C=""
"RTN","LRSORC1A",100,0)
 F  S C=$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"COM",C)) Q:(C="")!(LREND)  D
"RTN","LRSORC1A",101,0)
 .I ($Y>(IOSL-7)) D
"RTN","LRSORC1A",102,0)
 ..D CONT D:$E(IOST,1,2)="C-" WAIT Q:LREND
"RTN","LRSORC1A",103,0)
 ..W @IOF D HDR
"RTN","LRSORC1A",104,0)
 ..W !,$E(PNM,1,23),?25,SSN W:LRDPF=2 " ",LRLOC,?50,$E(LRAN,1,14)
"RTN","LRSORC1A",105,0)
 ..W ?62,LRSPDAT
"RTN","LRSORC1A",106,0)
 ..;W !,PNM,?35,SSN W:LRDPF=2 " ",LRLOC,?60,LRAN
"RTN","LRSORC1A",107,0)
 ..;D HDR
"RTN","LRSORC1A",108,0)
 ..W !,"COMMENT(S): "
"RTN","LRSORC1A",109,0)
 .Q:LREND
"RTN","LRSORC1A",110,0)
 .W ?12,^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"COM",C),!
"RTN","LRSORC1A",111,0)
 Q
"RTN","LRSORC1A",112,0)
HDR ;
"RTN","LRSORC1A",113,0)
 S LRPAG=LRPAG+1
"RTN","LRSORC1A",114,0)
 W "SPECIAL REPORT: SEARCHING FOR CRITICAL FLAGS  "
"RTN","LRSORC1A",115,0)
 W LRDATE,?65,"Pg ",LRPAG,!,LRHDR2,!
"RTN","LRSORC1A",116,0)
 D LRGLIN^LRX
"RTN","LRSORC1A",117,0)
 Q
"RTN","LRSORC1A",118,0)
RANGE ;
"RTN","LRSORC1A",119,0)
 W ?31,"Ref. Range: ",LRRLO,"-",LRRHI
"RTN","LRSORC1A",120,0)
 D CRITICL
"RTN","LRSORC1A",121,0)
 Q
"RTN","LRSORC1A",122,0)
CRITICL ;
"RTN","LRSORC1A",123,0)
 W ?57,"Critical: ",LRCLO,"-",LRCHI
"RTN","LRSORC1A",124,0)
 Q
"RTN","LRSORC1A",125,0)
WAIT ;
"RTN","LRSORC1A",126,0)
 K DIR S DIR(0)="E" D ^DIR
"RTN","LRSORC1A",127,0)
 S:($D(DTOUT))!($D(DUOUT)) LREND=1
"RTN","LRSORC1A",128,0)
 Q
"RTN","LRSORC1A",129,0)
CONT W !?10,"CONTINUED NEXT PAGE",! Q
"RTN","LRSORD1")
0^1^B7833211
"RTN","LRSORD1",1,0)
LRSORD1 ;SLC/RWF/DALISC/JBM- CRITICAL VALUE REPORT ; 8/30/87  17:25 ;
"RTN","LRSORD1",2,0)
 ;;5.2;LAB SERVICE;**344**;Sep 27, 1994
"RTN","LRSORD1",3,0)
EN ;
"RTN","LRSORD1",4,0)
BUILD ;
"RTN","LRSORD1",5,0)
 S LRPDT=LREDT-.000001
"RTN","LRSORD1",6,0)
 F  S LRPDT=$O(^LRO(69,LRPDT)) Q:('LRPDT)!(LRPDT>LRSDT)!(LREND=1)  D
"RTN","LRSORD1",7,0)
 .S LRLLOC=""
"RTN","LRSORD1",8,0)
 .F  S LRLLOC=$O(^LRO(69,LRPDT,1,"AN",LRLLOC)) Q:LRLLOC=""  D
"RTN","LRSORD1",9,0)
 ..S LRDFN=0
"RTN","LRSORD1",10,0)
 ..F  S LRDFN=$O(^LRO(69,LRPDT,1,"AN",LRLLOC,LRDFN)) Q:'LRDFN  D LRIDT
"RTN","LRSORD1",11,0)
 Q
"RTN","LRSORD1",12,0)
LRIDT ;
"RTN","LRSORD1",13,0)
 S LRIDT=0,LRSPEC=0
"RTN","LRSORD1",14,0)
 F  S LRIDT=$O(^LRO(69,LRPDT,1,"AN",LRLLOC,LRDFN,LRIDT)) Q:'LRIDT  D LOOK
"RTN","LRSORD1",15,0)
 Q
"RTN","LRSORD1",16,0)
LOOK ;
"RTN","LRSORD1",17,0)
 N LR63RLO,LR63RHI,LR63CLO,LR63CHI,LR63TLO,LR63THI,LR63DAT,PC5,LRFLAG
"RTN","LRSORD1",18,0)
 K T S L0=$G(^LR(LRDFN,"CH",LRIDT,0)) Q:'$L(L0)
"RTN","LRSORD1",19,0)
 S LRSPEC=$P(L0,"^",5)
"RTN","LRSORD1",20,0)
 I LRAA S LRAAA=$P($P(L0,U,6)," ") Q:'$D(LRAA(LRAAA))#2
"RTN","LRSORD1",21,0)
 S T=0,I=1
"RTN","LRSORD1",22,0)
 F  S I=$O(^LR(LRDFN,"CH",LRIDT,I)) Q:LREND!(I<1)  D
"RTN","LRSORD1",23,0)
 .I $P(^LR(LRDFN,"CH",LRIDT,I),U,2)'="" D
"RTN","LRSORD1",24,0)
 ..S T=T+1,T(I)=^LR(LRDFN,"CH",LRIDT,I)
"RTN","LRSORD1",25,0)
 ..I $G(LRFLAG)="" D
"RTN","LRSORD1",26,0)
 ...I $G(^LR(LRDFN,"CH",LRIDT,"NPC"))>1,$P(T(I),U,5,12)'="" S LRFLAG=1 Q
"RTN","LRSORD1",27,0)
 ...S LRFLAG=0
"RTN","LRSORD1",28,0)
 I T D
"RTN","LRSORD1",29,0)
 .S X=^LR(LRDFN,0)
"RTN","LRSORD1",30,0)
 .S LRDPF=$P(X,U,2),DFN=$P(X,U,3)
"RTN","LRSORD1",31,0)
 .I LRPTS Q:'$D(LRPTS(DFN))
"RTN","LRSORD1",32,0)
 .D PT^LRX
"RTN","LRSORD1",33,0)
 .S LRLOC=$S($D(^DPT(DFN,.1)):^(.1),1:LRLLOC)
"RTN","LRSORD1",34,0)
 .I LRLCS Q:'$D(LRLCS(LRLOC))
"RTN","LRSORD1",35,0)
 .S LRDAT=$P(^LR(LRDFN,"CH",LRIDT,0),U),LRSPEC=$P(^(0),U,5)
"RTN","LRSORD1",36,0)
 .S LRSUB1=$S(LRSRT="P":PNM_SSN,1:LRLOC)
"RTN","LRSORD1",37,0)
 .S LRSUB2=$S(LRSRT="P":LRDAT,1:PNM_SSN)
"RTN","LRSORD1",38,0)
 .S LRSUB3=$S(LRSRT="P":LRLOC,1:LRDAT)
"RTN","LRSORD1",39,0)
 .S LRAN=$P(L0,U,6)
"RTN","LRSORD1",40,0)
 .K %DT S X=$P(L0,U),%DT="XT" D ^%DT,DD^LRX S LRSPDAT=Y
"RTN","LRSORD1",41,0)
 .S ^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN)=PNM_U_SSN_U_LRLOC_U_LRDPF_U_LRSPDAT_U_LRSPEC
"RTN","LRSORD1",42,0)
 .S I=0
"RTN","LRSORD1",43,0)
 .F  S I=$O(T(I)) Q:LREND!(I<1)  D
"RTN","LRSORD1",44,0)
 ..S LRTX=$O(^LAB(60,"C","CH;"_I_";1",0))
"RTN","LRSORD1",45,0)
 ..I LRTX>0 D
"RTN","LRSORD1",46,0)
 ...S LRTST=$P(^LAB(60,LRTX,0),U),LRTVAL=$P(T(I),U)
"RTN","LRSORD1",47,0)
 ...S LRCRTFLG=$P(T(I),U,2)
"RTN","LRSORD1",48,0)
 ...I $G(LRFLAG) D GET63
"RTN","LRSORD1",49,0)
 ...S ^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"TST",I)=LRTST_U_LRTVAL_U_LRCRTFLG_U_LRSPEC_U_LRTX_U_$G(LRFLAG)_$S($G(LRFLAG):LR63DAT,1:"")
"RTN","LRSORD1",50,0)
 .S C=0
"RTN","LRSORD1",51,0)
 .F  S C=$O(^LR(LRDFN,"CH",LRIDT,1,C)) Q:'C  D
"RTN","LRSORD1",52,0)
 ..S ^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"COM",C)=^LR(LRDFN,"CH",LRIDT,1,C,0)
"RTN","LRSORD1",53,0)
 Q
"RTN","LRSORD1",54,0)
 ;
"RTN","LRSORD1",55,0)
GET63 ; get ranges from file 63 (T(I)) if they are stored there
"RTN","LRSORD1",56,0)
 S PC5=$P(T(I),U,5)
"RTN","LRSORD1",57,0)
 S LR63RLO=$P(PC5,"!",2)
"RTN","LRSORD1",58,0)
 S LR63RHI=$P(PC5,"!",3)
"RTN","LRSORD1",59,0)
 S LR63CLO=$P(PC5,"!",4)
"RTN","LRSORD1",60,0)
 S LR63CHI=$P(PC5,"!",5)
"RTN","LRSORD1",61,0)
 S LR63TLO=$P(PC5,"!",11)
"RTN","LRSORD1",62,0)
 S LR63THI=$P(PC5,"!",12)
"RTN","LRSORD1",63,0)
 S LR63DAT=U_LR63RLO_U_LR63RHI_U_LR63CLO_U_LR63CHI_U_LR63TLO_U_LR63THI
"RTN","LRSORD1",64,0)
 Q
"RTN","LRSORD1A")
0^2^B21795919
"RTN","LRSORD1A",1,0)
LRSORD1A ;DALISC/DRH - LRSORC Continued ;07-22-93
"RTN","LRSORD1A",2,0)
 ;;5.2;LAB SERVICE;**201,344**;Sep 27, 1994
"RTN","LRSORD1A",3,0)
INIT ;
"RTN","LRSORD1A",4,0)
 S U="^"
"RTN","LRSORD1A",5,0)
 D CONTROL
"RTN","LRSORD1A",6,0)
 Q
"RTN","LRSORD1A",7,0)
CONTROL ;
"RTN","LRSORD1A",8,0)
 D SORT
"RTN","LRSORD1A",9,0)
 Q
"RTN","LRSORD1A",10,0)
SORT ;
"RTN","LRSORD1A",11,0)
 W:$E(IOST,1,2)="C-" @IOF
"RTN","LRSORD1A",12,0)
 W:$E(IOST,1,2)="P-" !
"RTN","LRSORD1A",13,0)
 D HDR
"RTN","LRSORD1A",14,0)
 D PRINT
"RTN","LRSORD1A",15,0)
 D:'LREND SUMMARY
"RTN","LRSORD1A",16,0)
 D END
"RTN","LRSORD1A",17,0)
 Q
"RTN","LRSORD1A",18,0)
SUMMARY ;
"RTN","LRSORD1A",19,0)
 I ($Y>(IOSL-7)) D:$E(IOST,1,2)="C-" WAIT Q:LREND  W @IOF D HDR
"RTN","LRSORD1A",20,0)
 F I=$Y:1:(IOSL-6) W !
"RTN","LRSORD1A",21,0)
 W ?20,"END OF SPECIAL REPORT"
"RTN","LRSORD1A",22,0)
 Q
"RTN","LRSORD1A",23,0)
END ;
"RTN","LRSORD1A",24,0)
 D:($E(IOST,1,2)="C-")&('LREND) WAIT
"RTN","LRSORD1A",25,0)
 W @IOF D:'$D(ZTQUEUED) ^%ZISC
"RTN","LRSORD1A",26,0)
 K ^TMP("LR",$J)
"RTN","LRSORD1A",27,0)
 K ZTRTN,ZTIO,ZTDESC,ZTSAVE,ZTSK,ZTQUEUED,%ZIS,POP,%H,%DT,DTOUT,DUOUT
"RTN","LRSORD1A",28,0)
 K DIR,DIC,I,T,C,X,Y,L0,SEX,AGE,DFN,DOB,PNM,SSN,VA("BID"),VA("PID"),VAERR
"RTN","LRSORD1A",29,0)
 K LRAA,LRAD,LRDFN,LRDPF,LREND,LRFAN,LRIDT,LRLAN,LRLCS,LRSUB1,LRSUB2
"RTN","LRSORD1A",30,0)
 K LRLLOC,LRTX,LRTST,LRTVAL,LRCRTFLG,LRAN,LRSRT,LRPAG,LRDATE,LRDASH,LRDAT
"RTN","LRSORD1A",31,0)
 K LRLOC,LRPTS,LREDT,LRPDT,LRSDT,LRTREC,LRPREC,LREDAT,LRSDAT,LRSPDAT
"RTN","LRSORD1A",32,0)
 K LRWRD,LRHDR2,LRSUB3,LRAAA
"RTN","LRSORD1A",33,0)
 Q
"RTN","LRSORD1A",34,0)
PRINT ;
"RTN","LRSORD1A",35,0)
 S LRSUB1=""
"RTN","LRSORD1A",36,0)
 I $O(^TMP("LR",$J,LRSUB1))="" W !!?30,"NO MATCHING DATA FOUND",!! Q
"RTN","LRSORD1A",37,0)
 F  S LRSUB1=$O(^TMP("LR",$J,LRSUB1)) Q:(LRSUB1="")!(LREND)  D
"RTN","LRSORD1A",38,0)
 .S LRSUB2=""
"RTN","LRSORD1A",39,0)
 .F  S LRSUB2=$O(^TMP("LR",$J,LRSUB1,LRSUB2)) Q:(LRSUB2="")!(LREND)  D
"RTN","LRSORD1A",40,0)
 ..S LRSUB3=""
"RTN","LRSORD1A",41,0)
 ..F  S LRSUB3=$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3)) Q:(LRSUB3="")!(LREND)  D
"RTN","LRSORD1A",42,0)
 ...S LRAN=""
"RTN","LRSORD1A",43,0)
 ...F  S LRAN=$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN)) Q:(LRAN="")!(LREND)  D
"RTN","LRSORD1A",44,0)
 ....S LRPREC=^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN)
"RTN","LRSORD1A",45,0)
 ....S LRDPF=$P(LRPREC,U,4)
"RTN","LRSORD1A",46,0)
 ....S PNM=$P(LRPREC,U),SSN=$P(LRPREC,U,2),LRLOC=$P(LRPREC,U,3)
"RTN","LRSORD1A",47,0)
 ....S LRSPEC=$P(^LAB(61,$P(LRPREC,U,6),0),U)
"RTN","LRSORD1A",48,0)
 ....S LRSPNUM=$P(LRPREC,U,6)
"RTN","LRSORD1A",49,0)
 ....S LRSPDAT=$P(LRPREC,U,5)
"RTN","LRSORD1A",50,0)
 ....I ($Y>(IOSL-8)) D:$E(IOST,1,2)="C-" WAIT Q:LREND  W @IOF D HDR
"RTN","LRSORD1A",51,0)
 ....;S PNM1=$P(PNM,","),PNM2=$P(PNM,",",2)
"RTN","LRSORD1A",52,0)
 ....;S LRCHNG=PNM1 D CHNCASE^LRSORA2 S PNM1=LRCHNG
"RTN","LRSORD1A",53,0)
 ....;S LRCHNG=PNM2 D CHNCASE^LRSORA2 S PNM2=LRCHNG
"RTN","LRSORD1A",54,0)
 ....;S PNM=PNM1_","_PNM2
"RTN","LRSORD1A",55,0)
 ....;S LRCHNG=LRSPEC D CHNCASE^LRSORA2 S LRSPEC=LRCHNG
"RTN","LRSORD1A",56,0)
 ....W !,$E(PNM,1,23),?25,SSN W:LRDPF=2 " ",LRLOC,?50,$E(LRAN,1,14)
"RTN","LRSORD1A",57,0)
 ....W ?63,LRSPDAT
"RTN","LRSORD1A",58,0)
 ....W !," ",LRSPEC
"RTN","LRSORD1A",59,0)
 ....D PRNTST
"RTN","LRSORD1A",60,0)
 Q
"RTN","LRSORD1A",61,0)
PRNTST ;
"RTN","LRSORD1A",62,0)
 N LRRLO,LRRHI,LRCLO,LRCHI,LRTLO,LRTHI,LRFLAG,VAR
"RTN","LRSORD1A",63,0)
 S I=""
"RTN","LRSORD1A",64,0)
 F  S I=$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"TST",I)) Q:(I="")!(LREND)  D
"RTN","LRSORD1A",65,0)
 .S LRTREC=^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"TST",I)
"RTN","LRSORD1A",66,0)
 .S LRTST=$P(LRTREC,U),LRTVAL=$P(LRTREC,U,2),LRCRTFLG=$P(LRTREC,U,3)
"RTN","LRSORD1A",67,0)
 .I ($Y>(IOSL-7)) D
"RTN","LRSORD1A",68,0)
 ..D CONT D:$E(IOST,1,2)="C-" WAIT Q:LREND
"RTN","LRSORD1A",69,0)
 ..W @IOF D HDR
"RTN","LRSORD1A",70,0)
 ..W !,$E(PNM,1,23),?25,SSN W:LRDPF=2 " ",LRLOC,?50,$E(LRAN,1,14)
"RTN","LRSORD1A",71,0)
 ..W ?63,LRSPDAT
"RTN","LRSORD1A",72,0)
 .Q:LREND
"RTN","LRSORD1A",73,0)
 .S LRTX=$P(LRTREC,U,5)
"RTN","LRSORD1A",74,0)
 .S LRFLAG=$P(LRTREC,U,6)
"RTN","LRSORD1A",75,0)
 .S LRREF=$G(^LAB(60,LRTX,1,LRSPNUM,0))
"RTN","LRSORD1A",76,0)
 .S LRRLO=$S(LRFLAG:$P(LRTREC,U,7),1:$P(LRREF,U,2))
"RTN","LRSORD1A",77,0)
 .S LRRHI=$S(LRFLAG:$P(LRTREC,U,8),1:$P(LRREF,U,3))
"RTN","LRSORD1A",78,0)
 .S LRCLO=$S(LRFLAG:$P(LRTREC,U,9),1:$P(LRREF,U,4))
"RTN","LRSORD1A",79,0)
 .S LRCHI=$S(LRFLAG:$P(LRTREC,U,10),1:$P(LRREF,U,5))
"RTN","LRSORD1A",80,0)
 .S LRTLO=$S(LRFLAG:$P(LRTREC,U,11),1:$P(LRREF,U,11))
"RTN","LRSORD1A",81,0)
 .S LRTHI=$S(LRFLAG:$P(LRTREC,U,12),1:$P(LRREF,U,12))
"RTN","LRSORD1A",82,0)
 .F VAR="LRRLO","LRRHI","LRCLO","LRCHI" I @VAR="" S @VAR="none"
"RTN","LRSORD1A",83,0)
 .;
"RTN","LRSORD1A",84,0)
 .S LRTST=$P($G(^LAB(60,LRTX,.1)),U)
"RTN","LRSORD1A",85,0)
 .I 'LRTST S LRTST=$E($P(^LAB(60,LRTX,0),U),1,10)
"RTN","LRSORD1A",86,0)
 .;I 'LRTST S LRTST=$E($P(^LAB(60,LRTX,0),U),1,10)
"RTN","LRSORD1A",87,0)
 .;S LRCHNG=LRTST D CHNCASE^LRSORA2 S LRTST=LRCHNG
"RTN","LRSORD1A",88,0)
 .W !,?2,$E(LRTST,1,7),?12,$J(LRTVAL,6)
"RTN","LRSORD1A",89,0)
 .W ?19,$E($P(LRREF,U,7),1,10),?28,LRCRTFLG
"RTN","LRSORD1A",90,0)
 . I 'LRTLO,('LRTHI) D RANGE
"RTN","LRSORD1A",91,0)
 . I LRTLO W ?32,"Ther: ",LRTLO,"-"
"RTN","LRSORD1A",92,0)
 . I LRTHI W LRTHI D CRITICL
"RTN","LRSORD1A",93,0)
 I '$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"COM",0)) W !
"RTN","LRSORD1A",94,0)
 E  D COM
"RTN","LRSORD1A",95,0)
 Q
"RTN","LRSORD1A",96,0)
COM ;Print comments on specimen
"RTN","LRSORD1A",97,0)
 W !,"COMMENT(S): "
"RTN","LRSORD1A",98,0)
 S C=""
"RTN","LRSORD1A",99,0)
 F  S C=$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"COM",C)) Q:(C="")!(LREND)  D
"RTN","LRSORD1A",100,0)
 .I ($Y>(IOSL-7)) D
"RTN","LRSORD1A",101,0)
 ..D CONT D:$E(IOST,1,2)="C-" WAIT Q:LREND
"RTN","LRSORD1A",102,0)
 ..W @IOF D HDR
"RTN","LRSORD1A",103,0)
 ..W !,$E(PNM,1,23),?25,SSN W:LRDPF=2 " ",LRLOC,?50,$E(LRAN,1,14)
"RTN","LRSORD1A",104,0)
 ..W ?63,LRSPDAT
"RTN","LRSORD1A",105,0)
 ..;W !,PNM,?35,SSN W:LRDPF=2 " ",LRLOC,?60,LRAN
"RTN","LRSORD1A",106,0)
 ..;D HDR
"RTN","LRSORD1A",107,0)
 ..W !,"COMMENT(S): "
"RTN","LRSORD1A",108,0)
 .Q:LREND
"RTN","LRSORD1A",109,0)
 .W ?12,^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"COM",C),!
"RTN","LRSORD1A",110,0)
 Q
"RTN","LRSORD1A",111,0)
HDR ;
"RTN","LRSORD1A",112,0)
 S LRPAG=LRPAG+1
"RTN","LRSORD1A",113,0)
 W "SPECIAL REPORT: Search for Abnormal and Critical Results  "
"RTN","LRSORD1A",114,0)
 W LRDATE,?65,"Pg ",LRPAG,!,LRHDR2,!
"RTN","LRSORD1A",115,0)
 D LRGLIN^LRX
"RTN","LRSORD1A",116,0)
 Q
"RTN","LRSORD1A",117,0)
RANGE ;
"RTN","LRSORD1A",118,0)
 W ?31,"Ref. Range: ",LRRLO,"-",LRRHI
"RTN","LRSORD1A",119,0)
 D CRITICL
"RTN","LRSORD1A",120,0)
 Q
"RTN","LRSORD1A",121,0)
CRITICL ;
"RTN","LRSORD1A",122,0)
 W ?57,"Critical: ",LRCLO,"-",LRCHI
"RTN","LRSORD1A",123,0)
 Q
"RTN","LRSORD1A",124,0)
WAIT ;
"RTN","LRSORD1A",125,0)
 K DIR S DIR(0)="E" D ^DIR
"RTN","LRSORD1A",126,0)
 S:($D(DTOUT))!($D(DUOUT)) LREND=1
"RTN","LRSORD1A",127,0)
 Q
"RTN","LRSORD1A",128,0)
CONT W !?10,"CONTINUED NEXT PAGE",! Q
"VER")
8.0^22.0
"BLD",6415,6)
^263
**END**
**END**
