Released ECX*3*2 SEQ #5
Extracted from mail message
**KIDS**:ECX*3.0*2^

**INSTALL NAME**
ECX*3.0*2
"BLD",1002,0)
ECX*3.0*2^DSS EXTRACTS^0^2980223^y
"BLD",1002,1,0)
^^2^2^2980210^
"BLD",1002,1,1,0)
DSS*3.0*2
"BLD",1002,1,2,0)
Revisions for Y2K.
"BLD",1002,4,0)
^9.64PA^^
"BLD",1002,"KRN",0)
^9.67PA^19^18
"BLD",1002,"KRN",.4,0)
.4
"BLD",1002,"KRN",.401,0)
.401
"BLD",1002,"KRN",.402,0)
.402
"BLD",1002,"KRN",.403,0)
.403
"BLD",1002,"KRN",.5,0)
.5
"BLD",1002,"KRN",.84,0)
.84
"BLD",1002,"KRN",3.6,0)
3.6
"BLD",1002,"KRN",3.8,0)
3.8
"BLD",1002,"KRN",9.2,0)
9.2
"BLD",1002,"KRN",9.8,0)
9.8
"BLD",1002,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",1002,"KRN",9.8,"NM",1,0)
ECXPURG1^^0^B24081457
"BLD",1002,"KRN",9.8,"NM",2,0)
ECXSCLD^^0^B37921444
"BLD",1002,"KRN",9.8,"NM",3,0)
ECXTRANS^^0^B18608665
"BLD",1002,"KRN",9.8,"NM",4,0)
ECXWRD^^0^B10258215
"BLD",1002,"KRN",9.8,"NM","B","ECXPURG1",1)

"BLD",1002,"KRN",9.8,"NM","B","ECXSCLD",2)

"BLD",1002,"KRN",9.8,"NM","B","ECXTRANS",3)

"BLD",1002,"KRN",9.8,"NM","B","ECXWRD",4)

"BLD",1002,"KRN",19,0)
19
"BLD",1002,"KRN",19.1,0)
19.1
"BLD",1002,"KRN",101,0)
101
"BLD",1002,"KRN",409.61,0)
409.61
"BLD",1002,"KRN",771,0)
771
"BLD",1002,"KRN",869.2,0)
869.2
"BLD",1002,"KRN",870,0)
870
"BLD",1002,"KRN",8994,0)
8994
"BLD",1002,"KRN","B",.4,.4)

"BLD",1002,"KRN","B",.401,.401)

"BLD",1002,"KRN","B",.402,.402)

"BLD",1002,"KRN","B",.403,.403)

"BLD",1002,"KRN","B",.5,.5)

"BLD",1002,"KRN","B",.84,.84)

"BLD",1002,"KRN","B",3.6,3.6)

"BLD",1002,"KRN","B",3.8,3.8)

"BLD",1002,"KRN","B",9.2,9.2)

"BLD",1002,"KRN","B",9.8,9.8)

"BLD",1002,"KRN","B",19,19)

"BLD",1002,"KRN","B",19.1,19.1)

"BLD",1002,"KRN","B",101,101)

"BLD",1002,"KRN","B",409.61,409.61)

"BLD",1002,"KRN","B",771,771)

"BLD",1002,"KRN","B",869.2,869.2)

"BLD",1002,"KRN","B",870,870)

"BLD",1002,"KRN","B",8994,8994)

"BLD",1002,"QUES",0)
^9.62^^
"BLD",1002,"REQB",0)
^9.611^2^2
"BLD",1002,"REQB",1,0)
DI*21.0*44^0
"BLD",1002,"REQB",2,0)
XU*8.0*71^2
"BLD",1002,"REQB","B","DI*21.0*44",1)

"BLD",1002,"REQB","B","XU*8.0*71",2)

"PKG",513,-1)
1^1
"PKG",513,0)
DSS EXTRACTS^ECX^Decision Support System. (DSS)
"PKG",513,22,0)
^9.49I^1^1
"PKG",513,22,1,0)
3.0^2971222^2980112^12665
"PKG",513,22,1,"PAH",1,0)
2^2980223
"PKG",513,22,1,"PAH",1,1,0)
^^2^2^2980223
"PKG",513,22,1,"PAH",1,1,1,0)
DSS*3.0*2
"PKG",513,22,1,"PAH",1,1,2,0)
Revisions for Y2K.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","ECXPURG1")
0^1^B24081457
"RTN","ECXPURG1",1,0)
ECXPURG1 ;BIR/CML-Purge of DSS Extract Files (CONTINUED) ; [ 12/05/96  11:58 AM ]
"RTN","ECXPURG1",2,0)
 ;;3.0;DSS EXTRACTS;**2**;Dec 22, 1997
"RTN","ECXPURG1",3,0)
GET ;compile list of purgable extracts
"RTN","ECXPURG1",4,0)
 K HI,LO,ECBDT,ECEDT,ECLOC,^TMP("ECXPURG",$J)
"RTN","ECXPURG1",5,0)
 S QFLG=1 W !!,"...one moment please"
"RTN","ECXPURG1",6,0)
 S ECEX=0 F  S ECEX=$O(^ECX(727,ECEX)) Q:'ECEX  I '$G(^ECX(727,ECEX,"PURG")),$D(^ECX(727,ECEX,0)) S EC=^(0) D
"RTN","ECXPURG1",7,0)
 .S ^TMP("ECXPURG",$J,$P(EC,"^",3),ECEX)="",ECLOC(ECEX)=$P(EC,"^",3)_"^"_$P(EC,"^",4,5)
"RTN","ECXPURG1",8,0)
 I '$D(^TMP("ECXPURG",$J)) W !!,"There are no extracts that can be purged at this time." G DONE
"RTN","ECXPURG1",9,0)
ASK1 ;ask for print
"RTN","ECXPURG1",10,0)
 W !
"RTN","ECXPURG1",11,0)
 K DIR S DIR(0)="Y",DIR("A")="Do you want to print a list of extracts that can be purged",DIR("B")="NO"
"RTN","ECXPURG1",12,0)
 D ^DIR K DIR I $D(DIRUT) K ECLOC G DONE
"RTN","ECXPURG1",13,0)
 G:'Y ASK2
"RTN","ECXPURG1",14,0)
 W !!,"The right margin for this report is 80.",!!
"RTN","ECXPURG1",15,0)
 K ZTSAVE S ZTSAVE("^TMP(""ECXPURG"",$J,")=""
"RTN","ECXPURG1",16,0)
 D EN^XUTMDEVQ("PRT^ECXPURG1","DSS - Print Purgable Extracts",.ZTSAVE) I 'POP G ASK2
"RTN","ECXPURG1",17,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","ECXPURG1",18,0)
ASK2 ;ask for extract range
"RTN","ECXPURG1",19,0)
 S LO=$O(ECLOC(0)),HI=$O(ECLOC(" "),-1)
"RTN","ECXPURG1",20,0)
 S DIR(0)="L^"_LO_":"_HI_"",DIR("A")="Select extracts to be purged"
"RTN","ECXPURG1",21,0)
 S DIR("?",1)="Choose the numbers (or numbers) of the extracts you wish to purge,",DIR("?")="(E.g., 1-3,17,20 to choose 1 thru 3 and 17 and 20)."
"RTN","ECXPURG1",22,0)
 W ! D ^DIR K DIR I $D(DIRUT) K ECLOC G DONE
"RTN","ECXPURG1",23,0)
 S JJ=0,Y=","_Y F  S JJ=$O(ECLOC(JJ)) Q:'JJ  S JZ=","_JJ_"," I Y'[JZ K ECLOC(JJ)
"RTN","ECXPURG1",24,0)
 I '$D(ECLOC) W !!,"You have not chosen a valid extract number.  Try again." G GET
"RTN","ECXPURG1",25,0)
ASK3 W !!,"I will purge the following extract(s):"
"RTN","ECXPURG1",26,0)
 S JJ=0 F  S JJ=$O(ECLOC(JJ)) Q:'JJ  D
"RTN","ECXPURG1",27,0)
 .W !?5,"#",JJ," - ",$P(ECLOC(JJ),"^")
"RTN","ECXPURG1",28,0)
 .W ?47,$TR($$FMTE^XLFDT($P(ECLOC(JJ),"^",2),"5DF")," ","0")," to ",$TR($$FMTE^XLFDT($P(ECLOC(JJ),"^",3),"5DF")," ","0")
"RTN","ECXPURG1",29,0)
 W !! K DIR S DIR(0)="Y",DIR("A")="Is this OK",DIR("B")="NO"
"RTN","ECXPURG1",30,0)
 S DIR("?",1)="    Enter:"
"RTN","ECXPURG1",31,0)
 S DIR("?",2)="      ""YES"" if you agree with this list and would like to proceed,"
"RTN","ECXPURG1",32,0)
 S DIR("?",3)="       ""NO"" if you would like to make a different selection, or"
"RTN","ECXPURG1",33,0)
 S DIR("?")="        ""^"" to exit option."
"RTN","ECXPURG1",34,0)
 D ^DIR K DIR I $D(DIRUT) K ECLOC G DONE
"RTN","ECXPURG1",35,0)
 I 'Y G GET
"RTN","ECXPURG1",36,0)
 ; at this point, the local array ECLOC( is passed back to ^ECXPURG
"RTN","ECXPURG1",37,0)
 G DONE
"RTN","ECXPURG1",38,0)
QUIT ;
"RTN","ECXPURG1",39,0)
 I $E(IOST)="C"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","ECXPURG1",40,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXPURG1",41,0)
 W:$E(IOST)'="C" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ECXPURG1",42,0)
DONE K ^TMP("ECXPURG",$J),ZTSK Q
"RTN","ECXPURG1",43,0)
PRT ;print list of extracts
"RTN","ECXPURG1",44,0)
 S (PG,QFLG)=0,$P(LN,"-",81)="" D NOW^%DTC S Y=$E(%,1,12) X ^DD("DD") S HDT=Y D HDR
"RTN","ECXPURG1",45,0)
 S ECTYP="" F  S ECTYP=$O(^TMP("ECXPURG",$J,ECTYP)) Q:ECTYP=""  Q:QFLG  D:$Y+4>IOSL HDR Q:QFLG  W !!,ECTYP D
"RTN","ECXPURG1",46,0)
 .S ECEX=0 F  S ECEX=$O(^TMP("ECXPURG",$J,ECTYP,ECEX)) Q:'ECEX  Q:QFLG  I $D(^ECX(727,ECEX,0)) S EC=^(0) D
"RTN","ECXPURG1",47,0)
 ..S ECDT=$$FMTE^XLFDT($P(EC,"^",2),"D")
"RTN","ECXPURG1",48,0)
 ..S ECFR=$TR($$FMTE^XLFDT($P(EC,"^",4),"5DF")," ","0")
"RTN","ECXPURG1",49,0)
 ..S ECTO=$TR($$FMTE^XLFDT($P(EC,"^",5),"5DF")," ","0")
"RTN","ECXPURG1",50,0)
 ..S ECRC=$P(EC,"^",6) S:ECRC="" ECRC="Incomplete"
"RTN","ECXPURG1",51,0)
 ..S ECTRN=$$FMTE^XLFDT($G(^ECX(727,ECEX,"TR")),"D")
"RTN","ECXPURG1",52,0)
 ..D:$Y+3>IOSL HDR Q:QFLG  W !?3,ECEX,?13,ECDT,?29,ECFR,"-",ECTO,?53,$J(ECRC,9),?65,ECTRN
"RTN","ECXPURG1",53,0)
 G QUIT
"RTN","ECXPURG1",54,0)
HDR ;HEADER
"RTN","ECXPURG1",55,0)
 I $E(IOST)="C" S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXPURG1",56,0)
 I $E(IOST)="C",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","ECXPURG1",57,0)
 S PG=PG+1 W:$Y!($E(IOST)="C") @IOF W !,"PURGABLE EXTRACTS",?72,"Page: ",PG,!,"Printed on ",HDT,!
"RTN","ECXPURG1",58,0)
 W !,"FEEDER SYSTEM",?13,"EXTRACT",!,"EXTRACT #",?13,"DATE",?35,"FROM-TO",?53,"RECORD CNT",?65,"TRANSMIT DATE",!,LN
"RTN","ECXPURG1",59,0)
 Q
"RTN","ECXPURG1",60,0)
DATES ;ask for date range for purge of holding files
"RTN","ECXPURG1",61,0)
 K HI,LO,ECBDT,ECEDT
"RTN","ECXPURG1",62,0)
 I ECY="I" D
"RTN","ECXPURG1",63,0)
 .I '$O(^ECX(728.113,0)) W !!,"You have no data in the IVP holding file (file #728.113) to purge." Q
"RTN","ECXPURG1",64,0)
 .S LO=$O(^ECX(728.113,"A",0)),HI=$O(^ECX(728.113,"A"," "),-1)
"RTN","ECXPURG1",65,0)
 I ECY="U" D
"RTN","ECXPURG1",66,0)
 .I '$O(^ECX(728.904,0)) W !!,"You have no data in the UDP holding file (file #728.904) to purge." Q
"RTN","ECXPURG1",67,0)
 .S LO=$O(^ECX(728.904,"A",0)),HI=$O(^ECX(728.904,"A"," "),-1)
"RTN","ECXPURG1",68,0)
 Q:$G(LO)=""
"RTN","ECXPURG1",69,0)
 W @IOF,!!,"This file currently holds ",$S(ECY="I":"IVP",1:"UDP")," data from <",$$FMTE^XLFDT(LO,"D"),"> to <",$$FMTE^XLFDT(HI,"D"),">."
"RTN","ECXPURG1",70,0)
 W ! K DIR S DIR(0)="DA^"_LO_":"_HI_":EPX",DIR("A")="Beginning date for purge: " D ^DIR K DIR I $D(DIRUT) K HI,LO Q
"RTN","ECXPURG1",71,0)
 S ECBDT=+Y
"RTN","ECXPURG1",72,0)
 K DIR S DIR(0)="DA^"_ECBDT_":"_HI_":EPX",DIR("A")="Ending date for purge: " D ^DIR K DIR I $D(DIRUT) K HI,LO,ECBDT Q
"RTN","ECXPURG1",73,0)
 S ECEDT=+Y
"RTN","ECXPURG1",74,0)
ASK4 ; ask to confirm date range
"RTN","ECXPURG1",75,0)
 W !!,"I will purge the ",$S(ECY="I":"IVP",1:"UDP")," holding file from <",$$FMTE^XLFDT(ECBDT,"D"),"> to <",$$FMTE^XLFDT(ECEDT,"D"),">."
"RTN","ECXPURG1",76,0)
 W $C(7),$C(7),!!?3,"** REMEMBER - Once this data is purged it CANNOT be recreated. **"
"RTN","ECXPURG1",77,0)
 W !! K DIR S DIR(0)="Y",DIR("A")="Is this OK",DIR("B")="NO"
"RTN","ECXPURG1",78,0)
 S DIR("?",1)="    Enter:"
"RTN","ECXPURG1",79,0)
 S DIR("?",2)="      ""YES"" if you agree with this date range and wish to proceed,"
"RTN","ECXPURG1",80,0)
 S DIR("?",3)="       ""NO"" if you would like to make a different selection, or"
"RTN","ECXPURG1",81,0)
 S DIR("?")="        ""^"" to exit option."
"RTN","ECXPURG1",82,0)
 D ^DIR K DIR I $D(DIRUT) K ECBDT,ECEDT Q 
"RTN","ECXPURG1",83,0)
 I 'Y G DATES
"RTN","ECXPURG1",84,0)
 ; at this point, ECBDT and ECEDT are passed back to ^ECXPURG
"RTN","ECXPURG1",85,0)
 Q
"RTN","ECXSCLD")
0^2^B37921444
"RTN","ECXSCLD",1,0)
ECXSCLD ;BIR/DMA,CML-Enter, Print and Edit Entries in 728.44 ; [ 12/12/96  4:14 PM ]
"RTN","ECXSCLD",2,0)
 ;;3.0;DSS EXTRACTS;**2**;Dec 22, 1997
"RTN","ECXSCLD",3,0)
EN ;entry point from option
"RTN","ECXSCLD",4,0)
 ;load entries
"RTN","ECXSCLD",5,0)
 W !!,"This option creates local entries in the DSS CLINIC AND STOP CODES file.",!
"RTN","ECXSCLD",6,0)
 I '$D(^ECX(728.44)) W !,"DSS Clinic stop code file does not exist",!! R X:5 K X Q
"RTN","ECXSCLD",7,0)
 K ZTSAVE S ZTDESC="Gather Clinic stop codes for DSS",ZTRTN="START^ECXSCLD",ZTIO="" D ^%ZTLOAD
"RTN","ECXSCLD",8,0)
 Q
"RTN","ECXSCLD",9,0)
START ; entry point
"RTN","ECXSCLD",10,0)
 S EC=0,ECNT=0 F  S EC=$O(^SC(EC)) Q:'EC  I $D(^(EC,0)) S ECD=^(0),DAT=$G(^("I")) I $P(ECD,"^",3)="C" D FIX
"RTN","ECXSCLD",11,0)
 K DIK S DIK="^ECX(728.44,",DIK(1)=".01^B" D ENALL^DIK
"RTN","ECXSCLD",12,0)
 ;S $P(^ECX(728.44,0),"^",3,4)=ECL_"^"_ECNT
"RTN","ECXSCLD",13,0)
 K ZTDESC,EC,J,ECD,ECD2,ECL,ECS,ECS2,ECP
"RTN","ECXSCLD",14,0)
 S ZTREQ="@" Q
"RTN","ECXSCLD",15,0)
 ;
"RTN","ECXSCLD",16,0)
FIX ; get stop codes and default style for feeder key
"RTN","ECXSCLD",17,0)
 ; 1 if no credit stop code - 5 if credit stop code exists
"RTN","ECXSCLD",18,0)
 K ECD2,ECS2 I $D(^ECX(728.44,EC,0)) S ECD2=^(0) F ECS=2,3 S ECS2(ECS)=$P(ECD2,"^",ECS)
"RTN","ECXSCLD",19,0)
 S ID=+DAT,RD=$P(DAT,"^",2)
"RTN","ECXSCLD",20,0)
 I $D(ECD2) D
"RTN","ECXSCLD",21,0)
 .I ID,ID'>DT I 'RD!(RD>DT) S:$P(ECD2,"^",10)'=ID $P(ECD2,"^",7)="" S $P(ECD2,"^",10)=ID
"RTN","ECXSCLD",22,0)
 .I ID,RD,RD'>DT S:$P(ECD2,"^",10) $P(ECD2,"^",7)="" S $P(ECD2,"^",10)=""
"RTN","ECXSCLD",23,0)
 .I ID,ID>DT S:$P(ECD2,"^",10) $P(ECD2,"^",7)="" S $P(ECD2,"^",10)=""
"RTN","ECXSCLD",24,0)
 .I 'ID,$P(ECD2,"^",10) S $P(ECD2,"^",7)="",$P(ECD2,"^",10)=""
"RTN","ECXSCLD",25,0)
 F ECS=7,18 S ECP=+$P(ECD,"^",ECS),ECS(ECS)=$P($G(^DIC(40.7,ECP,0)),"^",2)
"RTN","ECXSCLD",26,0)
 S ECDF=$S(ECS(18)]"":5,1:1) S:$P(ECD,"^",17)="Y" ECDF=6 S:$G(^SC(EC,"OOS")) ECDF=6
"RTN","ECXSCLD",27,0)
 S ECL=EC,ECD=EC_"^"_ECS(7)_"^"_ECS(18)
"RTN","ECXSCLD",28,0)
 I '$D(ECD2) D
"RTN","ECXSCLD",29,0)
 .S $P(^ECX(728.44,EC,0),"^",1,5)=ECD_"^"_ECS(7)_"^"_ECS(18),ECNT=ECNT+1,$P(^(0),"^",6)=ECDF
"RTN","ECXSCLD",30,0)
 I $D(ECD2) D
"RTN","ECXSCLD",31,0)
 .S $P(ECD2,"^",1,3)=ECD
"RTN","ECXSCLD",32,0)
 .I +ECS(7)'=+ECS2(2)!(+ECS(18)'=+ECS2(3)) S $P(ECD2,"^",7)=""
"RTN","ECXSCLD",33,0)
 .S ^ECX(728.44,EC,0)=ECD2
"RTN","ECXSCLD",34,0)
 Q
"RTN","ECXSCLD",35,0)
 ;
"RTN","ECXSCLD",36,0)
PRINT ; print worksheet for updates
"RTN","ECXSCLD",37,0)
 I '$O(^ECX(728.44,0)) W !,"DSS Clinic stop code file does not exist",!! R X:5 K X Q
"RTN","ECXSCLD",38,0)
 W !!,"This option produces a worksheet of (A)ll DSS Clinic Stops or only the",!,"(U)nreviewed Clinic Stops that are awaiting approval.  Clinics that were"
"RTN","ECXSCLD",39,0)
 W !,"defined as ""inactive"" by MAS the last time the option ""Create DSS Clinic",!,"Stop Code File"" was run will be indicated with an ""*"".",!
"RTN","ECXSCLD",40,0)
 S DIR(0)="S^A:ALL;U:UNREVIEWED",DIR("A")="Enter ""A"" or ""U""",DIR("?",1)="Enter: ""A"" to print a worksheet of all DSS Clinic Stops,",DIR("?")="       ""U"" to print only the Clinic Stops that have not been approved."
"RTN","ECXSCLD",41,0)
 D ^DIR K DIR G END:$D(DIRUT) S ECALL=$E(Y)
"RTN","ECXSCLD",42,0)
 S %ZIS="Q" D ^%ZIS Q:POP
"RTN","ECXSCLD",43,0)
 I $D(IO("Q")) K ZTSAVE S ZTDESC="DSS clinic stop code work sheet",ZTRTN="SPRINT^ECXSCLD",ZTSAVE("ECALL")="" D ^%ZTLOAD,HOME^%ZIS Q
"RTN","ECXSCLD",44,0)
 U IO
"RTN","ECXSCLD",45,0)
SPRINT ; queued entry to print work sheet
"RTN","ECXSCLD",46,0)
 S QFLG=0,$P(LN,"-",81)="",PG=0
"RTN","ECXSCLD",47,0)
 S ECDATE=$O(^ECX(728.44,"A1","")) I ECDATE S ECDATE=-ECDATE,ECDATE=$$FMTE^XLFDT(ECDATE,"5DF"),ECDATE=$TR(ECDATE," ","0")
"RTN","ECXSCLD",48,0)
 K ^TMP("EC",$J) F J=0:0 S J=$O(^ECX(728.44,J)) Q:'J  I $D(^ECX(728.44,J,0)),$S(ECALL="A":1,1:$P(^(0),"^",7)="") S ECSD=^(0) I $D(^SC(J,0)) S ECSC=$P(^(0),"^"),^TMP("EC",$J,ECSC)=$P(ECSD,"^",2,200)
"RTN","ECXSCLD",49,0)
 D HEAD S ECSC="" I $O(^TMP("EC",$J,ECSC))="" W !!,"NO DATA FOUND FOR WORKSHEET.",! G END
"RTN","ECXSCLD",50,0)
 F J=1:1 S ECSC=$O(^TMP("EC",$J,ECSC)) Q:ECSC=""  S ECD=^(ECSC) D SHOWEM Q:QFLG
"RTN","ECXSCLD",51,0)
 I $E(IOST)="C",'QFLG D SS
"RTN","ECXSCLD",52,0)
 K ^TMP("EC",$J),J,ECSC,ECSD,ECDATE,QFLG,PG,LN,SS
"RTN","ECXSCLD",53,0)
 W:$Y @IOF D ^%ZISC S ZTREQ="@"
"RTN","ECXSCLD",54,0)
 Q
"RTN","ECXSCLD",55,0)
 ;
"RTN","ECXSCLD",56,0)
HEAD ; header for worksheet
"RTN","ECXSCLD",57,0)
 D SS Q:QFLG
"RTN","ECXSCLD",58,0)
 S PG=PG+1 W:$Y!($E(IOST)="C") @IOF W !,"WORKSHEET FOR DSS CLINIC STOPS",?72,"Page: ",PG
"RTN","ECXSCLD",59,0)
 I ECDATE]"" W !,"(last reviewed on ",ECDATE,")"
"RTN","ECXSCLD",60,0)
 E  W !,"(NEVER REVIEWED)"
"RTN","ECXSCLD",61,0)
 W !
"RTN","ECXSCLD",62,0)
 W !!,?1,"CLINIC",?33,"STOP",?40,"CREDIT",?49,"DSS",?56,"DSS",?65,"ACTION",?73,"NAT'L"
"RTN","ECXSCLD",63,0)
 W !,?33,"CODE",?40,"STOP",?49,"STOP",?56,"CREDIT",?73,"CODE",!,?1,"(* - currently inactive)",?40,"CODE",?49,"CODE",?56,"CODE",!,LN Q
"RTN","ECXSCLD",64,0)
 ;
"RTN","ECXSCLD",65,0)
SHOWEM ; list clinics for worksheet
"RTN","ECXSCLD",66,0)
 I $Y+4>IOSL D HEAD Q:QFLG
"RTN","ECXSCLD",67,0)
 W !!,$E(ECSC,1,30) W:$P(ECD,"^",9)]"" "*" F J=1:1:5 W ?$P("33,40,49,56,68",",",J),$S($P(ECD,"^",J):$P(ECD,"^",J),J<3:"",1:"_____")
"RTN","ECXSCLD",68,0)
 S ECN=$P($G(^ECX(728.441,+$P(ECD,"^",7),0)),"^") W ?73,$S(ECN]"":ECN,1:"____")
"RTN","ECXSCLD",69,0)
 Q
"RTN","ECXSCLD",70,0)
SS ;SCROLL STOPS
"RTN","ECXSCLD",71,0)
 I $E(IOST)="C" S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXSCLD",72,0)
 I $E(IOST)="C",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","ECXSCLD",73,0)
 Q
"RTN","ECXSCLD",74,0)
 ;
"RTN","ECXSCLD",75,0)
EDIT ; put in DSS stopcodes and which one to send
"RTN","ECXSCLD",76,0)
 I '$O(^ECX(728.44,0)) W !,"DSS Clinic stop code file does not exist",!! R X:5 K X Q
"RTN","ECXSCLD",77,0)
 W ! S DIC=728.44,DIC(0)="QEAMZ" D ^DIC G END:Y<0 W !,"STOP CODE : ",$P(Y(0),"^",2),!,"CREDIT STOP CODE : ",$P(Y(0),"^",3)
"RTN","ECXSCLD",78,0)
 S DIE=DIC,DA=+Y,DR="3;4;5//1;S:X'=4 Y=6;7;6///"_DT_";8" D ^DIE S:$P(^ECX(728.44,DA,0),"^",6)'=4 $P(^(0),"^",8)="" S $P(^(0),"^",7)="" K DIC,DIE,DA G EDIT
"RTN","ECXSCLD",79,0)
 ;
"RTN","ECXSCLD",80,0)
APPROVE ; approve current DSS Stop and Credit Stop codes
"RTN","ECXSCLD",81,0)
 W !!,"This option allows you to mark the current clinic entries in the CLINICS AND",!,"STOP CODES file (#728.44) as ""reviewed"".  Those entries will then be omitted"
"RTN","ECXSCLD",82,0)
 W !,"from the list printed from the ""Clinic and DSS Stop Codes Print"" when you",!,"choose to print only ""unreviewed"" clinics.",!
"RTN","ECXSCLD",83,0)
 K DIR S DIR(0)="Y",DIR("A",1)="Are you ready to approve the reviewed information provided by the",DIR("A")="""Clinic and DSS Stop Codes Print""",DIR("B")="NO"
"RTN","ECXSCLD",84,0)
 S DIR("?",1)="   Enter:"
"RTN","ECXSCLD",85,0)
 S DIR("?",2)="     ""YES"" if you concur with the ""Clinic and DSS Stop Codes Print"","
"RTN","ECXSCLD",86,0)
 S DIR("?",3)="     ""NO"" or <RET> if you do not want to approve the current information,"
"RTN","ECXSCLD",87,0)
 S DIR("?")="     ""^"" to exit option."
"RTN","ECXSCLD",88,0)
 D ^DIR K DIR I 'Y!($D(DIRUT)) G END
"RTN","ECXSCLD",89,0)
 W ! S ZTRTN="APPLOOP^ECXSCLD",ZTIO="",ZTDESC="Approve DSS stop codes for clinic extract" D ^%ZTLOAD W !!,"...approval queued" G END
"RTN","ECXSCLD",90,0)
 ;
"RTN","ECXSCLD",91,0)
APPLOOP ; queued entry to approve action codes
"RTN","ECXSCLD",92,0)
 F EC=0:0 S EC=$O(^ECX(728.44,EC)) Q:'EC  I $D(^(EC,0)) S DA=EC,DIE="^ECX(728.44,",DR="6///"_DT D ^DIE
"RTN","ECXSCLD",93,0)
 S ZTREQ="@" G END
"RTN","ECXSCLD",94,0)
END K X,Y,DA,DR,DIC,DIE,QFLG,PG,LN
"RTN","ECXSCLD",95,0)
 Q
"RTN","ECXSCLD",96,0)
 ;
"RTN","ECXSCLD",97,0)
LOOK ;queued entry to check for new clinics
"RTN","ECXSCLD",98,0)
 S ECD=$E(DT,1,5)-1-($E(DT,4,5)="01"*8800),ECD0=ECD_"00",ECXMISS=10,ECGRP="SCX" K ^TMP("ECXS",$J)
"RTN","ECXSCLD",99,0)
 F EC=0:0 S EC=$O(^SC(EC)) Q:'EC  I $D(^(EC,0)),$P(^(0),"^",3)="C",'$D(^ECX(728.44,EC)) S DAT=$G(^SC(EC,"I")) D
"RTN","ECXSCLD",100,0)
 .S ID=+DAT,RD=$P(DAT,"^",2) I ID,ID<DT I 'RD!(RD>DT) Q
"RTN","ECXSCLD",101,0)
 .S ^TMP("ECXS",$J,ECXMISS,0)=$J(EC,6)_"    "_$$LJ^XLFSTR($P(^SC(EC,0),"^"),40),ECXMISS=ECXMISS+1
"RTN","ECXSCLD",102,0)
 D ^ECXSCX1
"RTN","ECXSCLD",103,0)
 Q
"RTN","ECXTRANS")
0^3^B18608665
"RTN","ECXTRANS",1,0)
ECXTRANS ;BIR/DMA-Extract from Local Editing Files and Transmit ; [ 11/26/96  2:13 PM ]
"RTN","ECXTRANS",2,0)
 ;;3.0;DSS EXTRACTS;**2**;Dec 22, 1997
"RTN","ECXTRANS",3,0)
EN ;entry point from option
"RTN","ECXTRANS",4,0)
 I $G(^ECX(728,1,"QUEUE"))'?1"DM"1U W !,"You have not defined a proper transmission queue",!,"for entry number 1 in file 728",!,"No transmissions allowed" Q
"RTN","ECXTRANS",5,0)
 S ECXQUEUE=$G(^ECX(728,1,"QUEUE"))
"RTN","ECXTRANS",6,0)
 W ! S ECRE="",DIC=727,DIC(0)="AEQM",DIC("A")="Transmit which extract: ",DIC("S")="I '$D(^(""L"")),'$D(^(""PURG""))" D ^DIC K DIC G END:Y<0
"RTN","ECXTRANS",7,0)
 I $G(^ECX(727,+Y,"PURG")) S ECX=^("PURG") W !,"Data for this extract was purged on ",$TR($$FMTE^XLFDT(ECX,"5DF")," ","0") K ECX G ECXTRANS
"RTN","ECXTRANS",8,0)
 S ECDA=+Y I $G(^ECX(727,ECDA,"TR")) S ECX=^("TR") W !,"This extract was transmitted on ",$TR($$FMTE^XLFDT(ECX,"5DF")," ","0") K ECX S DIR(0)="Y",DIR("A")="Do you want to retransmit " D ^DIR K DIR G ECXTRANS:'Y K ^ECX(727,ECDA,"TR") S ECRE="re"
"RTN","ECXTRANS",9,0)
 S ZTSK=$G(^ECX(727,ECDA,"Q")) I ZTSK D STAT^%ZTLOAD I ZTSK(0) I ZTSK(1)<3 W !!,"Task ",ZTSK," is already queued to transmit this extract",!! K ZTSK G ECXTRANS
"RTN","ECXTRANS",10,0)
 S ZTSAVE("ECDA")="",ZTSAVE("ECXQUEUE")="",ZTSAVE("ECRE")="",ZTRTN="START^ECXTRANS",ZTIO="",ZTDESC="Transmission of extract # "_ECDA D ^%ZTLOAD
"RTN","ECXTRANS",11,0)
 I $D(ZTSK) W !,"Request queued as Task #",ZTSK,".",! S ^ECX(727,ECDA,"Q")=ZTSK K ZTSK
"RTN","ECXTRANS",12,0)
END ;exit
"RTN","ECXTRANS",13,0)
 K ECDA,ECRE,X,Y Q
"RTN","ECXTRANS",14,0)
 Q
"RTN","ECXTRANS",15,0)
 ;
"RTN","ECXTRANS",16,0)
START ; entry point
"RTN","ECXTRANS",17,0)
 S ECINST=$P(^ECX(728,1,0),"^") K ECXDIC S DA=ECINST,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXTRANS",18,0)
 D EN^DIQ1 S ECINST=$G(ECXDIC(4,DA,99,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXTRANS",19,0)
 S ECF=^ECX(727,ECDA,"FILE"),ECHEAD=^("HEAD"),ECGRP=^("GRP"),ECED=$P(^(0),"^",5),ECPACK=$P(^(0),"^",3),ECVER=$G(^("VER")) S:'ECVER ECVER=1 S ECVER=$$RJ^XLFSTR(ECVER,3,0)
"RTN","ECXTRANS",20,0)
 I ECPACK["(setup)" S ECXQUEUE="DMU"
"RTN","ECXTRANS",21,0)
 ;all setup extracts for all sites to go to queue DMU - Judy Sine 2/16/95
"RTN","ECXTRANS",22,0)
 I ECHEAD="LAR",+ECED<2971001 S ECXQUEUE="DMW"
"RTN","ECXTRANS",23,0)
 ;all LAR extracts for fy96/fy97 for test sites go to queue DMW;BTSO/AAC 11/18/97
"RTN","ECXTRANS",24,0)
 K ^TMP($J) S ECHD(1)=ECINST_ECHEAD_$$ECXYM^ECXUTL(ECED)_ECVER,ECRN=0,ECMSN=1,ECMIN=2,ECMAX=200,ECLN=ECMIN
"RTN","ECXTRANS",25,0)
 F J=0:0 S J=$O(^ECX(ECF,"AC",ECDA,J)) Q:'J  I $D(^ECX(ECF,J,0)) S ^TMP($J,ECMSN,ECLN,0)=$P(^ECX(ECF,J,0),"^",4,100)_"^~",ECLN=ECLN+1,ECRN=ECRN+1 I ECLN>ECMAX,$O(^ECX(ECF,"AC",ECDA,J)) S ECLN=ECMIN,ECMSN=ECMSN+1 I $$S^%ZTLOAD Q
"RTN","ECXTRANS",26,0)
 I $$S^%ZTLOAD G CLEAN
"RTN","ECXTRANS",27,0)
 ;
"RTN","ECXTRANS",28,0)
 S TIME=$P($$HTE^XLFDT($H),":",1,2)
"RTN","ECXTRANS",29,0)
 ; send message to mail group 'DSS-ECGRP'
"RTN","ECXTRANS",30,0)
 S ECXLNCNT=7
"RTN","ECXTRANS",31,0)
 F ECMS=1:1:ECMSN D SEND
"RTN","ECXTRANS",32,0)
 S XMSUB=ECINST_" - "_ECPACK_" EXTRACT FOR DSS",XMDUZ="DSS SYSTEM"
"RTN","ECXTRANS",33,0)
 K XMY S XMY("G.DSS-"_ECGRP_"@"_^XMB("NETNAME"))=""
"RTN","ECXTRANS",34,0)
 S ^TMP($J,"LOC",1,0)="The DSS "_ECPACK_" extract (#"_ECDA_") was "_ECRE_"transmitted on "_$P(TIME,"@")_" at "_$P(TIME,"@",2)_". ",^TMP($J,"LOC",3,0)=" ",^TMP($J,"LOC",4,0)="A total of "_ECRN_" records were written."
"RTN","ECXTRANS",35,0)
 S ^TMP($J,"LOC",5,0)="A total of "_ECMSN_" messages were sent.",^TMP($J,"LOC",6,0)="    Message numbers :"
"RTN","ECXTRANS",36,0)
 S XMTEXT="^TMP($J,""LOC""," D ^XMD S ^ECX(727,ECDA,"TR")=DT
"RTN","ECXTRANS",37,0)
CLEAN ;
"RTN","ECXTRANS",38,0)
 S ZTREQ="@" K ^TMP($J),^ECX(727,ECDA,"Q") D ^ECXKILL
"RTN","ECXTRANS",39,0)
 I $$S^%ZTLOAD K ZTREQ S ZTSTOP=1
"RTN","ECXTRANS",40,0)
 Q
"RTN","ECXTRANS",41,0)
 ;
"RTN","ECXTRANS",42,0)
SEND ;send individual messages
"RTN","ECXTRANS",43,0)
 S XMSUB="("_ECGRP_") "_ECINST_" - "_ECPACK_" DSS EXTRACT, MESSAGE "_ECMS_" OF "_ECMSN,XMDUZ="DSS SYSTEM"
"RTN","ECXTRANS",44,0)
 F J=1:1:ECMIN-1 S ^TMP($J,ECMS,J,0)=ECHD(J)
"RTN","ECXTRANS",45,0)
 K XMY
"RTN","ECXTRANS",46,0)
 S XMY("XXX@Q-"_ECXQUEUE_".VA.GOV")=""
"RTN","ECXTRANS",47,0)
 S XMTEXT="^TMP($J,ECMS," D ^XMD S ^TMP($J,"LOC",ECXLNCNT,0)=XMZ,ECXLNCNT=ECXLNCNT+1
"RTN","ECXTRANS",48,0)
SETM S DA(1)=ECDA,DIC(0)="L" K ECXDD D FIELD^DID(727,301,,"SPECIFIER","ECXDD") S DIC("P")=ECXDD("SPECIFIER") K ECXDD S DIC="^ECX(727,"_DA(1)_",1,",X=XMZ,DINUM=X K DD,DO D FILE^DICN
"RTN","ECXTRANS",49,0)
 Q
"RTN","ECXTRANS",50,0)
 ;
"RTN","ECXWRD")
0^4^B10258215
"RTN","ECXWRD",1,0)
ECXWRD ;BIR/CML-Print Active Wards for Fiscal Year ; [ 11/25/96  11:55 AM ]
"RTN","ECXWRD",2,0)
 ;;3.0;DSS EXTRACTS;**2**;Dec 22, 1997
"RTN","ECXWRD",3,0)
EN ;entry point from option
"RTN","ECXWRD",4,0)
 S QFLG=1 D NOW^%DTC S ECX=$$FMTE^XLFDT(%,"5D"),YR=+$P(ECX,"/",3),MON=+$P(ECX,"/",1),FY=$S(MON<10:YR,1:YR+1)
"RTN","ECXWRD",5,0)
 W !!,"This option prints a list of all MAS wards that were active at any time",!,"during FY",FY,".  The list is sorted by Medical Center Division and displays",!,"the pointer to the Hospital Location file (#44)."
"RTN","ECXWRD",6,0)
DEV W !!,"The right margin for this report is 80.",!!
"RTN","ECXWRD",7,0)
 K ZTSAVE S ZTSAVE("FY")=""
"RTN","ECXWRD",8,0)
 D EN^XUTMDEVQ("START^ECXWRD","DSS - Print Active Wards for Fiscal Year",.ZTSAVE) I 'POP Q
"RTN","ECXWRD",9,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","ECXWRD",10,0)
 G QUIT
"RTN","ECXWRD",11,0)
START ;
"RTN","ECXWRD",12,0)
 K ^TMP("ECXWRD",$J)
"RTN","ECXWRD",13,0)
 S ECXFY=FY-1700
"RTN","ECXWRD",14,0)
 S ECFYB=ECXFY-1_"1000",ECFYE=ECXFY_"1001"
"RTN","ECXWRD",15,0)
 S ECWD=0 F  S ECWD=$O(^DIC(42,ECWD)) Q:'ECWD  I $D(^DIC(42,ECWD,0)) S EC=^(0) D CHK I X=0 S ECLOC=+$G(^DIC(42,ECWD,44)) I $D(^SC(ECLOC,0)) S ECLOCN=$P(^(0),"^") D
"RTN","ECXWRD",16,0)
 .S ECDIV=$P(EC,"^",11),ECDIVN=$S(ECDIV:$P(^DG(40.8,ECDIV,0),"^"),1:"UNSPECIFIED DIVISION") S ^TMP("ECXWRD",$J,ECDIVN,ECLOCN)=ECLOC
"RTN","ECXWRD",17,0)
PRT S (PG,QFLG)=0,$P(LN,"-",81)="" D NOW^%DTC S Y=$E(%,1,12) X ^DD("DD") S HDT=Y D HDR
"RTN","ECXWRD",18,0)
 I '$D(^TMP("ECXWRD",$J)) W !!,"NO DATA FOUND FOR THIS REPORT" G QUIT
"RTN","ECXWRD",19,0)
 S ECDIV="" F  S ECDIV=$O(^TMP("ECXWRD",$J,ECDIV)) Q:ECDIV=""  Q:QFLG  D:$Y+4>IOSL HDR Q:QFLG  W !!,"DIVISION: ",ECDIV S ECLOC="" F  S ECLOC=$O(^TMP("ECXWRD",$J,ECDIV,ECLOC)) Q:ECLOC=""  Q:QFLG  D
"RTN","ECXWRD",20,0)
 .D:$Y+4>IOSL HDR Q:QFLG  W !?5,ECLOC,?45,$J(^TMP("ECXWRD",$J,ECDIV,ECLOC),5)
"RTN","ECXWRD",21,0)
QUIT ;
"RTN","ECXWRD",22,0)
 I $E(IOST)="C"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","ECXWRD",23,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXWRD",24,0)
 K %,%H,%I,EC,ECDIV,ECDIVN,ECFYB,ECFYE,ECLOC,ECLOCN,ECWD,FY,HDT,JJ,LN,MON,PG,QFLG,SS,YR,X,Y,ZTSK
"RTN","ECXWRD",25,0)
 W:$E(IOST)'="C" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","ECXWRD",26,0)
CHK ;has this ward been active?  (1=inactive, 0=active)
"RTN","ECXWRD",27,0)
 ;input:    ECWD = IFN of WARD LOCATION file
"RTN","ECXWRD",28,0)
 ;         ECFYB = first day of fiscal year.
"RTN","ECXWRD",29,0)
 ;         ECFYE = last day of fiscal year
"RTN","ECXWRD",30,0)
 ;output:      X = 1 if inactive (out-of-service), 0 otherwise
"RTN","ECXWRD",31,0)
 ;
"RTN","ECXWRD",32,0)
 N ECX,ECY S X=1 Q:'$D(ECWD)  S ECY=ECFYB
"RTN","ECXWRD",33,0)
 I '$O(^DIC(42,ECWD,"OOS",0)) S X=0 Q
"RTN","ECXWRD",34,0)
 S ECX=+$O(^DIC(42,ECWD,"OOS","AINV",9999998.9-ECY)),ECX=$S($D(^DIC(42,ECWD,"OOS",+$O(^(+ECX,0)),0)):^(0),1:"")
"RTN","ECXWRD",35,0)
 I '$P(ECX,U,6) S X=0 Q
"RTN","ECXWRD",36,0)
 I $P(ECX,U,6),'$P(ECX,U,4) S X=1 Q
"RTN","ECXWRD",37,0)
 I $P(ECX,U,6),$P(ECX,U,4)<ECFYE S X=0 Q
"RTN","ECXWRD",38,0)
 S X=1
"RTN","ECXWRD",39,0)
 Q
"RTN","ECXWRD",40,0)
HDR ;HEADER
"RTN","ECXWRD",41,0)
 I $E(IOST)="C" S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXWRD",42,0)
 I $E(IOST)="C",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","ECXWRD",43,0)
 S PG=PG+1 W:$Y!($E(IOST)="C") @IOF W !,"Active Wards for FY",FY,!,"Printed on ",HDT,!
"RTN","ECXWRD",44,0)
 W !?40,"HOSPITAL LOCATION",!?5,"WARD",?43,"FILE POINTER",!,LN
"RTN","ECXWRD",45,0)
 Q
"VER")
8.0^21.0
**END**
**END**
