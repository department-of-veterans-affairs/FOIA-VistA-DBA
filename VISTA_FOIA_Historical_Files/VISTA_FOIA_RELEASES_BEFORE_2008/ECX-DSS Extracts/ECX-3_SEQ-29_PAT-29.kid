Released ECX*3*29 SEQ #29
Extracted from mail message
**KIDS**:ECX*3.0*29^

**INSTALL NAME**
ECX*3.0*29
"BLD",2183,0)
ECX*3.0*29^DSS EXTRACTS^0^2991130^y
"BLD",2183,4,0)
^9.64PA^^
"BLD",2183,"KRN",0)
^9.67PA^19^18
"BLD",2183,"KRN",.4,0)
.4
"BLD",2183,"KRN",.401,0)
.401
"BLD",2183,"KRN",.402,0)
.402
"BLD",2183,"KRN",.403,0)
.403
"BLD",2183,"KRN",.5,0)
.5
"BLD",2183,"KRN",.84,0)
.84
"BLD",2183,"KRN",3.6,0)
3.6
"BLD",2183,"KRN",3.8,0)
3.8
"BLD",2183,"KRN",9.2,0)
9.2
"BLD",2183,"KRN",9.8,0)
9.8
"BLD",2183,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",2183,"KRN",9.8,"NM",1,0)
ECXSCX1^^0^B68117337
"BLD",2183,"KRN",9.8,"NM",2,0)
ECXSCXN^^0^B59266353
"BLD",2183,"KRN",9.8,"NM","B","ECXSCX1",1)

"BLD",2183,"KRN",9.8,"NM","B","ECXSCXN",2)

"BLD",2183,"KRN",19,0)
19
"BLD",2183,"KRN",19.1,0)
19.1
"BLD",2183,"KRN",101,0)
101
"BLD",2183,"KRN",409.61,0)
409.61
"BLD",2183,"KRN",771,0)
771
"BLD",2183,"KRN",869.2,0)
869.2
"BLD",2183,"KRN",870,0)
870
"BLD",2183,"KRN",8994,0)
8994
"BLD",2183,"KRN","B",.4,.4)

"BLD",2183,"KRN","B",.401,.401)

"BLD",2183,"KRN","B",.402,.402)

"BLD",2183,"KRN","B",.403,.403)

"BLD",2183,"KRN","B",.5,.5)

"BLD",2183,"KRN","B",.84,.84)

"BLD",2183,"KRN","B",3.6,3.6)

"BLD",2183,"KRN","B",3.8,3.8)

"BLD",2183,"KRN","B",9.2,9.2)

"BLD",2183,"KRN","B",9.8,9.8)

"BLD",2183,"KRN","B",19,19)

"BLD",2183,"KRN","B",19.1,19.1)

"BLD",2183,"KRN","B",101,101)

"BLD",2183,"KRN","B",409.61,409.61)

"BLD",2183,"KRN","B",771,771)

"BLD",2183,"KRN","B",869.2,869.2)

"BLD",2183,"KRN","B",870,870)

"BLD",2183,"KRN","B",8994,8994)

"BLD",2183,"QUES",0)
^9.62^^
"BLD",2183,"REQB",0)
^9.611^2^2
"BLD",2183,"REQB",1,0)
ECX*3.0*24^2
"BLD",2183,"REQB",2,0)
ECX*3.0*27^2
"BLD",2183,"REQB","B","ECX*3.0*24",1)

"BLD",2183,"REQB","B","ECX*3.0*27",2)

"MBREQ")
0
"PKG",513,-1)
1^1
"PKG",513,0)
DSS EXTRACTS^ECX^Decision Support System. (DSS)
"PKG",513,20,0)
^9.402P^^
"PKG",513,22,0)
^9.49I^1^1
"PKG",513,22,1,0)
3.0^2971222^2980112^11714
"PKG",513,22,1,"PAH",1,0)
29^2991130
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ECXSCX1")
0^1^B68117337
"RTN","ECXSCX1",1,0)
ECXSCX1 ;ALB/JAP,BIR/DMA-Clinic Extract Message ; 20 Mar 95 / 11:10 AM [ 12/03/96  1:32 PM ]
"RTN","ECXSCX1",2,0)
 ;;3.0;DSS EXTRACTS;**8,28,24,27,29**;Dec 22, 1997
"RTN","ECXSCX1",3,0)
EN ;entry point from ecxscx
"RTN","ECXSCX1",4,0)
 N ECX
"RTN","ECXSCX1",5,0)
 ;send missing clinic message
"RTN","ECXSCX1",6,0)
 S ECX=$O(^TMP($J,"ECXS","MISS",0)) D
"RTN","ECXSCX1",7,0)
 .Q:ECX=""
"RTN","ECXSCX1",8,0)
 .S XMSUB="MISSING CLINICS in File #728.44",XMDUZ="DSS SYSTEM"
"RTN","ECXSCX1",9,0)
 .K XMY S XMY("G.DSS-"_ECGRP_"@"_^XMB("NETNAME"))=""
"RTN","ECXSCX1",10,0)
 .F ECX=1:1:5 S ^TMP($J,"ECXS","MISS",ECX,0)=$P($T(MSG+ECX),";;",2)
"RTN","ECXSCX1",11,0)
 .S XMTEXT="^TMP($J,""ECXS"",""MISS""," D ^XMD
"RTN","ECXSCX1",12,0)
 ;send no division message
"RTN","ECXSCX1",13,0)
 S ECX=$O(^TMP($J,"ECXS","DIV",0)) D
"RTN","ECXSCX1",14,0)
 .Q:ECX=""
"RTN","ECXSCX1",15,0)
 .S XMSUB="CLINICS w/o DIVISION Data",XMDUZ="DSS SYSTEM"
"RTN","ECXSCX1",16,0)
 .K XMY S XMY("G.DSS-"_ECGRP_"@"_^XMB("NETNAME"))=""
"RTN","ECXSCX1",17,0)
 .F ECX=1:1:5 S ^TMP($J,"ECXS","DIV",ECX,0)=$P($T(MSG2+ECX),";;",2)
"RTN","ECXSCX1",18,0)
 .S XMTEXT="^TMP($J,""ECXS"",""DIV""," D ^XMD
"RTN","ECXSCX1",19,0)
 ;cleanup
"RTN","ECXSCX1",20,0)
 K ^TMP($J,"ECXS")
"RTN","ECXSCX1",21,0)
 Q
"RTN","ECXSCX1",22,0)
MSG ;text for missing clinic
"RTN","ECXSCX1",23,0)
 ;;The following clinics have not been entered into the CLINIC AND
"RTN","ECXSCX1",24,0)
 ;;STOP CODES file (#728.44).  If any listed clinic is currently
"RTN","ECXSCX1",25,0)
 ;;active, please use the options 'Create DSS Clinic Stop Code File'
"RTN","ECXSCX1",26,0)
 ;;and 'Enter/Edit DSS Stop Codes for Clinics' to update this file.
"RTN","ECXSCX1",27,0)
 ;;  
"RTN","ECXSCX1",28,0)
 ;
"RTN","ECXSCX1",29,0)
MSG2 ;text for missing division
"RTN","ECXSCX1",30,0)
 ;;The following clinics in the HOSPITAL LOCATION file (#44) have not
"RTN","ECXSCX1",31,0)
 ;;been assigned to a division from the MEDICAL CENTER DIVISION file 
"RTN","ECXSCX1",32,0)
 ;;(#40.8).  CLI extract records associated with these clinics have
"RTN","ECXSCX1",33,0)
 ;;been given a default Division identifier of "1".
"RTN","ECXSCX1",34,0)
 ;;
"RTN","ECXSCX1",35,0)
 ;
"RTN","ECXSCX1",36,0)
MISS ;load ^tmp if clinic missing from #728.44
"RTN","ECXSCX1",37,0)
 N DAT,ID,RD
"RTN","ECXSCX1",38,0)
 S DAT=$G(^SC(SC,"I")) I DAT]"" S ID=+DAT,RD=$P(DAT,U,2)
"RTN","ECXSCX1",39,0)
 ;ignore inactive clinics
"RTN","ECXSCX1",40,0)
 I ID,ID<DT I 'RD!(RD>DT) Q
"RTN","ECXSCX1",41,0)
 I '$D(ECXMISS) S ECXMISS=10
"RTN","ECXSCX1",42,0)
 S ^TMP($J,"ECXS","MISS",ECXMISS,0)=$J(SC,6)_"    "_$$LJ^XLFSTR($P(^SC(SC,0),U),40)_ECSC_"/"_ECCSC,ECXMISS=ECXMISS+1
"RTN","ECXSCX1",43,0)
 Q
"RTN","ECXSCX1",44,0)
 ;
"RTN","ECXSCX1",45,0)
NODIV ;load ^tmp if clinic w/o division
"RTN","ECXSCX1",46,0)
 N DAT,ID,RD
"RTN","ECXSCX1",47,0)
 S DAT=$G(^SC(SC,"I")) I DAT]"" S ID=+DAT,RD=$P(DAT,U,2)
"RTN","ECXSCX1",48,0)
 ;ignore inactive clinics
"RTN","ECXSCX1",49,0)
 I ID,ID<DT I 'RD!(RD>DT) Q
"RTN","ECXSCX1",50,0)
 I '$D(ECXMISS) S ECXMISS=10
"RTN","ECXSCX1",51,0)
 S ^TMP($J,"ECXS","DIV",ECXMISS,0)=$J(SC,6)_"    "_$$LJ^XLFSTR($P(^SC(SC,0),U),40),ECXMISS=ECXMISS+1
"RTN","ECXSCX1",52,0)
 Q
"RTN","ECXSCX1",53,0)
 ;
"RTN","ECXSCX1",54,0)
FEEDER(ECXSC,ECXSD,ECXP1,ECXP2,ECXP3,ECXSEND,ECXDIV) ;get transmission style and feeder key variables
"RTN","ECXSCX1",55,0)
 ;feeder key = primary stop code_secondary stop code_length of appointment_national clinic code_noshow indicator
"RTN","ECXSCX1",56,0)
 ;   input
"RTN","ECXSCX1",57,0)
 ;   ECXSC = ien of clinic in file #44 (required)
"RTN","ECXSCX1",58,0)
 ;   ECXSD  = start date of extract date range (required)
"RTN","ECXSCX1",59,0)
 ;   ECXP1,ECXP2,ECXP3,ECXSEND passed by reference (required)
"RTN","ECXSCX1",60,0)
 ;   output (passed-by-reference variables)
"RTN","ECXSCX1",61,0)
 ;   ECXP1  = primary stop code
"RTN","ECXSCX1",62,0)
 ;   ECXP2  = secondary stop code
"RTN","ECXSCX1",63,0)
 ;   ECXP3  = field #7 of file #728.44
"RTN","ECXSCX1",64,0)
 ;   ECXSEND = field #5 of file #728.44
"RTN","ECXSCX1",65,0)
 ;   ECXDIV  = field #3.5 of file #44
"RTN","ECXSCX1",66,0)
 N ECSC,ECCSC,ECSD1,ECXNC,ECXMISS,CLIN,SC
"RTN","ECXSCX1",67,0)
 S (ECXP1,ECXP2)="000",ECXP3="0000"
"RTN","ECXSCX1",68,0)
 S ECXSEND=1,ECXDIV=0
"RTN","ECXSCX1",69,0)
 Q:+ECXSC=0
"RTN","ECXSCX1",70,0)
 ;set needed data in ^tmp
"RTN","ECXSCX1",71,0)
 I '$D(^TMP($J,"ECXS","SC",ECXSC)) D
"RTN","ECXSCX1",72,0)
 .;get division or send no division msg
"RTN","ECXSCX1",73,0)
 .S ECXDIV=+$P($G(^SC(ECXSC,0)),U,15) I ECXDIV=0 D
"RTN","ECXSCX1",74,0)
 ..D NODIV
"RTN","ECXSCX1",75,0)
 ..S ECXDIV=1
"RTN","ECXSCX1",76,0)
 .;get other data from file #44 if no #727.44 record; send missing clinic msg
"RTN","ECXSCX1",77,0)
 .I '$D(^ECX(728.44,ECXSC,0)) D
"RTN","ECXSCX1",78,0)
 ..S ECSC=+$P($G(^SC(ECXSC,0)),U,7),ECCSC=+$P(^(0),U,18)
"RTN","ECXSCX1",79,0)
 ..S SC=ECXSC,ECSD1=ECXSD D MISS
"RTN","ECXSCX1",80,0)
 ..I ECSC S ECXP1=$P($G(^DIC(40.7,ECSC,0)),U,2),ECXP1=$$RJ^XLFSTR(+ECXP1,3,0)
"RTN","ECXSCX1",81,0)
 .;otherwise get other data from file #728.44
"RTN","ECXSCX1",82,0)
 .S EC=$G(^ECX(728.44,ECXSC,0)) D
"RTN","ECXSCX1",83,0)
 ..Q:EC=""
"RTN","ECXSCX1",84,0)
 ..S ECXSEND=$P(EC,U,6)
"RTN","ECXSCX1",85,0)
 ..Q:ECXSEND=6
"RTN","ECXSCX1",86,0)
 ..S ECSC=+$P(EC,U,4),ECCSC=+$P(EC,U,5)
"RTN","ECXSCX1",87,0)
 ..I 'ECSC S ECSC=+$P(EC,U,2),ECCSC=+$P(EC,U,3)
"RTN","ECXSCX1",88,0)
 ..I ECSC S ECXP1=$$RJ^XLFSTR(ECSC,3,0),ECXP2=$$RJ^XLFSTR(ECCSC,3,0)
"RTN","ECXSCX1",89,0)
 ..;if primary stop not valid, use file #44 record
"RTN","ECXSCX1",90,0)
 ..I 'ECSC S ECSC=+$P($G(^SC(ECXSC,0)),U,7),ECCSC=+$P($G(^(0)),U,18) I ECSC D
"RTN","ECXSCX1",91,0)
 ...S ECXP1=+$P($G(^DIC(40.7,ECSC,0)),U,2) S:ECCSC ECXP2=+$P($G(^DIC(40.7,ECCSC,0)),U,2)
"RTN","ECXSCX1",92,0)
 ...S ECXP1=$$RJ^XLFSTR(ECXP1,3,0),ECXP2=$$RJ^XLFSTR(ECXP2,3,0)
"RTN","ECXSCX1",93,0)
 .;for action code=1, secondary stop code is always "000"
"RTN","ECXSCX1",94,0)
 .I ECXSEND=1 S ECXP2="000"
"RTN","ECXSCX1",95,0)
 .;action code of 2 or 3 should not be used, but continue to follow v2t11 logic
"RTN","ECXSCX1",96,0)
 .I ECXSEND=2 S ECXP1=ECXP2,ECXP2="000"
"RTN","ECXSCX1",97,0)
 .;for action code=4, need to get national clinic code
"RTN","ECXSCX1",98,0)
 .I ECXSEND=4 D
"RTN","ECXSCX1",99,0)
 ..S ECXNC=+$P($G(^ECX(728.44,ECXSC,0)),U,8)
"RTN","ECXSCX1",100,0)
 ..I ECXNC S ECXNC=$P($G(^ECX(728.441,ECXNC,0)),U),ECXP3=$$RJ^XLFSTR(ECXNC,4,0)
"RTN","ECXSCX1",101,0)
 .;set data in ^tmp
"RTN","ECXSCX1",102,0)
 .S ^TMP($J,"ECXS","SC",ECXSC)=ECXP1_U_ECXP2_U_ECXP3_U_ECXSEND_U_ECXDIV
"RTN","ECXSCX1",103,0)
 ;
"RTN","ECXSCX1",104,0)
 I ECXDIV=0 D
"RTN","ECXSCX1",105,0)
 .S CLIN=^TMP($J,"ECXS","SC",ECXSC)
"RTN","ECXSCX1",106,0)
 .S ECXP1=$P(CLIN,U),ECXP2=$P(CLIN,U,2),ECXP3=$P(CLIN,U,3),ECXSEND=$P(CLIN,U,4),ECXDIV=$P(CLIN,U,5)
"RTN","ECXSCX1",107,0)
 Q
"RTN","ECXSCX1",108,0)
 ;
"RTN","ECXSCX1",109,0)
CLINII(ECXRECS,ECXED) ;update file #727.818 0-node & file #728 for CLJ
"RTN","ECXSCX1",110,0)
 ;input ECXRECS = total # records created in file #727.818
"RTN","ECXSCX1",111,0)
 ;      ECXED   = end date for extract
"RTN","ECXSCX1",112,0)
 N HEAD,PACK,GROUP,FILE,ROUTINE,PIECE,VERSION,LAST,TOTAL
"RTN","ECXSCX1",113,0)
 S HEAD="CLJ"
"RTN","ECXSCX1",114,0)
 D ECXDEF^ECXUTL2(HEAD,.PACK,.GROUP,.FILE,.ROUTINE,.PIECE,.VERSION)
"RTN","ECXSCX1",115,0)
 S LAST=$O(^ECX(FILE,99999999),-1)
"RTN","ECXSCX1",116,0)
 S TOTAL=$P(^ECX(FILE,0),U,4)+ECXRECS
"RTN","ECXSCX1",117,0)
 S $P(^ECX(FILE,0),U,3,4)=LAST_U_TOTAL
"RTN","ECXSCX1",118,0)
 S $P(^ECX(728,1,7),U,PIECE)=ECXED
"RTN","ECXSCX1",119,0)
 S $P(^ECX(728,1,7.1),U,PIECE)=""
"RTN","ECXSCX1",120,0)
 Q
"RTN","ECXSCX1",121,0)
 ;
"RTN","ECXSCX1",122,0)
VISIT(ECXDFN,ECXVISIT,ECXVIST,ECXERR) ;get visit specific data
"RTN","ECXSCX1",123,0)
 ;input  ECXVISIT  = pointer to file #9000010
"RTN","ECXSCX1",124,0)
 ;       ECXSVC  = sc percentage
"RTN","ECXSCX1",125,0)
 ;output ECXVSIT = data array
"RTN","ECXSCX1",126,0)
 ;       ECXERR  = 1 indicates error; otherwise, 0 
"RTN","ECXSCX1",127,0)
 N DIC,DA,DIQ,X,Y,ARRAY,VISIT,REC,VAL,ICD9,DATE,PROV,CPT,MOD,AO,IR,MST
"RTN","ECXSCX1",128,0)
 S ECXERR=0,VISIT=ECXVISIT
"RTN","ECXSCX1",129,0)
 S ECXVIST("CPT")="",ECXVIST("ICD9")="",ECXVIST("AO")="",ECXVIST("IR")="",ECXVIST("MST")=""
"RTN","ECXSCX1",130,0)
 S ECXVIST("PROV")="",ECXVIST("PROV CLASS")="",ECXVIST("PROV NPI")="",ECXVIST("SOURCE")=""
"RTN","ECXSCX1",131,0)
 D ENCEVENT^PXAPI(VISIT)
"RTN","ECXSCX1",132,0)
 I $O(^TMP("PXKENC",$J,VISIT,""))']"" K ECXVIST S ECXERR=1
"RTN","ECXSCX1",133,0)
 Q:ECXERR
"RTN","ECXSCX1",134,0)
 S DATE=$P($P(^TMP("PXKENC",$J,VISIT,"VST",VISIT,0),U,1),".",1)
"RTN","ECXSCX1",135,0)
 S ECXVIST("SOURCE")=$P($G(^TMP("PXKENC",$J,VISIT,"VST",VISIT,812)),U,3)
"RTN","ECXSCX1",136,0)
 ;get icd9 codes upto 9; else use 799.9
"RTN","ECXSCX1",137,0)
 S ECXVIST("ICD9")=""
"RTN","ECXSCX1",138,0)
 I $O(^TMP("PXKENC",$J,VISIT,"POV",0)) D
"RTN","ECXSCX1",139,0)
 .S (REC,VAL)=0
"RTN","ECXSCX1",140,0)
 .F  S REC=$O(^TMP("PXKENC",$J,VISIT,"POV",REC)) Q:'REC  D
"RTN","ECXSCX1",141,0)
 ..S VAL=+^TMP("PXKENC",$J,VISIT,"POV",REC,0)
"RTN","ECXSCX1",142,0)
 ..Q:'VAL
"RTN","ECXSCX1",143,0)
 ..K ARRAY S DIC=80,DA=VAL,DR=".01",DIQ(0)="E",DIQ="ARRAY" D EN^DIQ1
"RTN","ECXSCX1",144,0)
 ..S ICD9=ARRAY(80,VAL,.01,"E"),LEN=$L(ICD9)
"RTN","ECXSCX1",145,0)
 ..F L=LEN+1:1:7 S ICD9=ICD9_" "
"RTN","ECXSCX1",146,0)
 ..I $P(^TMP("PXKENC",$J,VISIT,"POV",REC,0),U,12)="P" S ECXVIST("ICD9")=ICD9_ECXVIST("ICD9")
"RTN","ECXSCX1",147,0)
 ..E  S ECXVIST("ICD9")=ECXVIST("ICD9")_ICD9
"RTN","ECXSCX1",148,0)
 I ECXVIST("ICD9")="" S ECXVIST("ICD9")="799.9  "
"RTN","ECXSCX1",149,0)
 I $L(ECXVIST("ICD9"))<63 S LEN=$L(ECXVIST("ICD9")) F L=LEN+1:1:63 S ECXVIST("ICD9")=ECXVIST("ICD9")_" "
"RTN","ECXSCX1",150,0)
 S ECXVIST("ICD9")=$E(ECXVIST("ICD9"),1,63)
"RTN","ECXSCX1",151,0)
 ;get first provider designated as primary
"RTN","ECXSCX1",152,0)
 ;if no primary, then get first physician provider
"RTN","ECXSCX1",153,0)
 ;if no physician, then get first provider
"RTN","ECXSCX1",154,0)
 S (PROV,PROVPC)=""
"RTN","ECXSCX1",155,0)
 I $O(^TMP("PXKENC",$J,VISIT,"PRV",0)) D
"RTN","ECXSCX1",156,0)
 .S (REC,VAL)=0 D
"RTN","ECXSCX1",157,0)
 ..F  S REC=$O(^TMP("PXKENC",$J,VISIT,"PRV",REC)) Q:'REC  Q:VAL  S:($P(^(REC,0),U,4)="P") VAL=+^(0) D
"RTN","ECXSCX1",158,0)
 ..S PROV=VAL,PROVPC=$$PRVCLASS^ECXUTL(PROV,DATE)
"RTN","ECXSCX1",159,0)
 .I 'VAL S (REC,VAL)=0 D
"RTN","ECXSCX1",160,0)
 ..F  S REC=$O(^TMP("PXKENC",$J,VISIT,"PRV",REC)) Q:'REC  Q:VAL  S VAL=+^(REC,0) D
"RTN","ECXSCX1",161,0)
 ...S PROV=VAL,PROVPC=$$PRVCLASS^ECXUTL(PROV,DATE) Q:PROVPC=""
"RTN","ECXSCX1",162,0)
 ...S NUM=$E(PROVPC,2,7) S:(NUM<110000)!(NUM>119999) VAL=0,PROVPC=""
"RTN","ECXSCX1",163,0)
 .I 'VAL D
"RTN","ECXSCX1",164,0)
 ..S REC=$O(^TMP("PXKENC",$J,VISIT,"PRV",0)) Q:'REC  Q:VAL  S VAL=+^(REC,0) D
"RTN","ECXSCX1",165,0)
 ...S PROV=VAL,PROVPC=$$PRVCLASS^ECXUTL(PROV,DATE)
"RTN","ECXSCX1",166,0)
 .S:PROV]"" PROV="2"_PROV
"RTN","ECXSCX1",167,0)
 S ECXVIST("PROV")=PROV,ECXVIST("PROV CLASS")=PROVPC,ECXVIST("PROV NPI")=""
"RTN","ECXSCX1",168,0)
 ;get cpt codes upto 8 & modifiers upto 5
"RTN","ECXSCX1",169,0)
 I $O(^TMP("PXKENC",$J,VISIT,"CPT",0)) D
"RTN","ECXSCX1",170,0)
 .S REC="",ECXVIST("CPT")=""
"RTN","ECXSCX1",171,0)
 .;if there's a primary provider, get cpt codes associated with that provider
"RTN","ECXSCX1",172,0)
 .I ECXVIST("PROV")]"" D
"RTN","ECXSCX1",173,0)
 ..S PROV=$E(ECXVIST("PROV"),2,99)
"RTN","ECXSCX1",174,0)
 ..F  S REC=$O(^TMP("PXKENC",$J,VISIT,"CPT",REC)) Q:'REC  S (CPT,MOD)="" D
"RTN","ECXSCX1",175,0)
 ...Q:'$D(^TMP("PXKENC",$J,VISIT,"CPT",REC,12)) 
"RTN","ECXSCX1",176,0)
 ...I $P(^TMP("PXKENC",$J,VISIT,"CPT",REC,12),U,4)=PROV S CPT=+^TMP("PXKENC",$J,VISIT,"CPT",REC,0)
"RTN","ECXSCX1",177,0)
 ...Q:'CPT
"RTN","ECXSCX1",178,0)
 ...S MOD="" I $D(^TMP("PXKENC",$J,VISIT,"CPT",REC,1)) S M=0 D
"RTN","ECXSCX1",179,0)
 ....F  S M=$O(^TMP("PXKENC",$J,VISIT,"CPT",REC,1,M)) Q:'M  S CM=+^TMP("PXKENC",$J,VISIT,"CPT",REC,1,M,0) I CM S MOD=MOD_CM_";"
"RTN","ECXSCX1",180,0)
 ...I $L(ECXVIST("CPT"))<120 S CPT=$$CPT^ECXUTL3(CPT,MOD),ECXVIST("CPT")=ECXVIST("CPT")_CPT
"RTN","ECXSCX1",181,0)
 ...K ^TMP("PXKENC",$J,VISIT,"CPT",REC)
"RTN","ECXSCX1",182,0)
 .;get more cpt codes if needed
"RTN","ECXSCX1",183,0)
 .I $L(ECXVIST("CPT"))<120 S REC="" D
"RTN","ECXSCX1",184,0)
 ..F  S REC=$O(^TMP("PXKENC",$J,VISIT,"CPT",REC)) Q:'REC  S (CPT,MOD)="" D
"RTN","ECXSCX1",185,0)
 ...S CPT=+^TMP("PXKENC",$J,VISIT,"CPT",REC,0)
"RTN","ECXSCX1",186,0)
 ...Q:'CPT
"RTN","ECXSCX1",187,0)
 ...S MOD="" I $D(^TMP("PXKENC",$J,VISIT,"CPT",REC,1)) S M=0 D
"RTN","ECXSCX1",188,0)
 ....F  S M=$O(^TMP("PXKENC",$J,VISIT,"CPT",REC,1,M)) Q:'M  S CM=+^TMP("PXKENC",$J,VISIT,"CPT",REC,1,M,0) I CM S MOD=MOD_CM_";"
"RTN","ECXSCX1",189,0)
 ...I $L(ECXVIST("CPT"))<120 S CPT=$$CPT^ECXUTL3(CPT,MOD),ECXVIST("CPT")=ECXVIST("CPT")_CPT
"RTN","ECXSCX1",190,0)
 .I ECXVIST("CPT")="" S ECXVIST("CPT")="99199"
"RTN","ECXSCX1",191,0)
 .S ECXVIST("CPT")=$E(ECXVIST("CPT"),1,120)
"RTN","ECXSCX1",192,0)
 .I $L(ECXVIST("CPT"))<120 S LEN=$L(ECXVIST("CPT")) F L=LEN+1:1:120 S ECXVIST("CPT")=ECXVIST("CPT")_" "
"RTN","ECXSCX1",193,0)
 ;ao, ir, mst
"RTN","ECXSCX1",194,0)
 S (AO,IR,MST)=""
"RTN","ECXSCX1",195,0)
 I $D(^TMP("PXKENC",$J,VISIT,"VST",VISIT,800)) D
"RTN","ECXSCX1",196,0)
 .S AO=$P(^TMP("PXKENC",$J,VISIT,"VST",VISIT,800),U,2),IR=$P(^(800),U,3),MST=$P(^(800),U,5)
"RTN","ECXSCX1",197,0)
 .S ECXVIST("AO")=$S(AO=0:"N",AO=1:"Y",1:"")
"RTN","ECXSCX1",198,0)
 .S ECXVIST("IR")=$S(IR=0:"N",IR=1:"Y",1:"")
"RTN","ECXSCX1",199,0)
 .S ECXVIST("MST")=$S(MST=0:"N",MST=1:"Y",1:"")
"RTN","ECXSCX1",200,0)
 Q
"RTN","ECXSCXN")
0^2^B59266353
"RTN","ECXSCXN",1,0)
ECXSCXN ;ALB/JAP  Clinic Extract ; 05/14/99
"RTN","ECXSCXN",2,0)
 ;;3.0;DSS EXTRACTS;**24,27,29**;Dec 22, 1997
"RTN","ECXSCXN",3,0)
 ;
"RTN","ECXSCXN",4,0)
BEG ;entry point from option
"RTN","ECXSCXN",5,0)
 D SETUP I ECFILE="" Q
"RTN","ECXSCXN",6,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXSCXN",7,0)
 Q
"RTN","ECXSCXN",8,0)
 ;
"RTN","ECXSCXN",9,0)
START ;entry point from taskmgr
"RTN","ECXSCXN",10,0)
 N DIC,OUT,TIU,LOCARR,PROCESS,STOP,STATUS,P1,P2,P3,TOSEND,SOURCE,EXNUM,X,Y
"RTN","ECXSCXN",11,0)
 S OUT=0,QFLG=0,ECRN=0
"RTN","ECXSCXN",12,0)
 K ^TMP($J,"ECXS"),^TMP($J,"ECXP")
"RTN","ECXSCXN",13,0)
 ;get ien for tiu in file #839.7
"RTN","ECXSCXN",14,0)
 S DIC="^PX(839.7,",DIC(0)="X",X="TEXT INTEGRATION UTILITIES" D ^DIC S TIU=+Y K DIC,Y
"RTN","ECXSCXN",15,0)
 S ECD=ECSD1,ECED=ECED+.3
"RTN","ECXSCXN",16,0)
 ;search file #409.68 for encounter data
"RTN","ECXSCXN",17,0)
 F  S ECD=$O(^SCE("B",ECD)) Q:'ECD!(ECD>ECED)  Q:QFLG  S ECXIEN=0 F  S ECXIEN=$O(^SCE("B",ECD,ECXIEN)) Q:'ECXIEN  D  Q:QFLG
"RTN","ECXSCXN",18,0)
 .Q:'$D(^SCE(ECXIEN,0))
"RTN","ECXSCXN",19,0)
 .;initalize variables
"RTN","ECXSCXN",20,0)
 .D INIT
"RTN","ECXSCXN",21,0)
 .K LOCARR S DIC=409.68,DA=ECXIEN,DR=".01;.02;.03;.04;.05;.06;.07;.08;.12;.13",DIQ(0)="I",DIQ="LOCARR" D EN^DIQ1
"RTN","ECXSCXN",22,0)
 .S STOP=+$G(LOCARR(409.68,ECXIEN,.03,"I")),CHKOUT=+$G(LOCARR(409.68,ECXIEN,.07,"I")),PROCESS=+$G(LOCARR(409.68,ECXIEN,.08,"I")),STATUS=$G(LOCARR(409.68,ECXIEN,.12,"I"))
"RTN","ECXSCXN",23,0)
 .Q:'CHKOUT
"RTN","ECXSCXN",24,0)
 .S:STATUS="" STATUS="ZZ" S STATUS=";"_STATUS_";"
"RTN","ECXSCXN",25,0)
 .Q:";3;4;5;6;7;9;10;13;"[STATUS
"RTN","ECXSCXN",26,0)
 .Q:'STOP
"RTN","ECXSCXN",27,0)
 .Q:PROCESS=4
"RTN","ECXSCXN",28,0)
 .Q:+$G(LOCARR(409.68,ECXIEN,.06,"I"))
"RTN","ECXSCXN",29,0)
 .S ECXDATE=+$G(LOCARR(409.68,ECXIEN,.01,"I")),ECXDFN=+$G(LOCARR(409.68,ECXIEN,.02,"I")),ECXCLIN=+$G(LOCARR(409.68,ECXIEN,.04,"I"))
"RTN","ECXSCXN",30,0)
 .Q:$P($G(^SC(ECXCLIN,0)),U,3)'="C"
"RTN","ECXSCXN",31,0)
 .S ECXVISIT=+$G(LOCARR(409.68,ECXIEN,.05,"I")),ECXENEL=+$G(LOCARR(409.68,ECXIEN,.13,"I"))
"RTN","ECXSCXN",32,0)
 .D FEEDER^ECXSCX1(ECXCLIN,ECSD1,.P1,.P2,.P3,.TOSEND,.ECXDIV)
"RTN","ECXSCXN",33,0)
 .K LOCARR S DIC=40.7,DA=STOP,DR="1",DIQ(0)="I",DIQ="LOCARR" D EN^DIQ1
"RTN","ECXSCXN",34,0)
 .S ECXSTOP=$$RJ^XLFSTR($G(LOCARR(40.7,STOP,1,"I")),3,0)
"RTN","ECXSCXN",35,0)
 .;get patient demographics
"RTN","ECXSCXN",36,0)
 .D PAT(ECXDFN,ECXDATE,.ECXERR)
"RTN","ECXSCXN",37,0)
 .Q:ECXERR
"RTN","ECXSCXN",38,0)
 .;get visit specific data
"RTN","ECXSCXN",39,0)
 .Q:'ECXVISIT
"RTN","ECXSCXN",40,0)
 .D VISIT^ECXSCX1(ECXDFN,ECXVISIT,.ECXVIST,.ECXERR)
"RTN","ECXSCXN",41,0)
 .Q:ECXERR
"RTN","ECXSCXN",42,0)
 .S ECXCPT=ECXVIST("CPT"),ECXICD9=ECXVIST("ICD9"),SOURCE=ECXVIST("SOURCE")
"RTN","ECXSCXN",43,0)
 .S ECXAO=ECXVIST("AO"),ECXIR=ECXVIST("IR"),ECXMIL=ECXVIST("MST")
"RTN","ECXSCXN",44,0)
 .S ECXPROV=ECXVIST("PROV"),ECXPROVP=ECXVIST("PROV CLASS"),ECXPROVN=ECXVIST("PROV NPI")
"RTN","ECXSCXN",45,0)
 .K LOCARR S DIC=8,DA=ECXENEL,DR="8",DIQ(0)="I",DIQ="LOCARR" D EN^DIQ1
"RTN","ECXSCXN",46,0)
 .S ECXENEL=+$G(LOCARR(8,ECXENEL,8,"I")) I ECXENEL S ECXENEL=$$ELIG^ECXUTL3(ECXENEL,ECXSVC)
"RTN","ECXSCXN",47,0)
 .;setup feeder key and file in extract records
"RTN","ECXSCXN",48,0)
 .;xray (105) or lab (108)
"RTN","ECXSCXN",49,0)
 .I (ECXSTOP=105)!(ECXSTOP=108) D  Q
"RTN","ECXSCXN",50,0)
 ..S ECXKEY=ECXSTOP_"00003000000"
"RTN","ECXSCXN",51,0)
 ..D FILE
"RTN","ECXSCXN",52,0)
 .;appointments
"RTN","ECXSCXN",53,0)
 .I PROCESS=1 D  Q
"RTN","ECXSCXN",54,0)
 ..Q:TOSEND=6
"RTN","ECXSCXN",55,0)
 ..;get appt length
"RTN","ECXSCXN",56,0)
 ..S JJ=0,ALEN=0 F  S JJ=$O(^SC(ECXCLIN,"S",ECXDATE,1,JJ)) Q:'JJ  D  Q:ALEN
"RTN","ECXSCXN",57,0)
 ...S PP=$P(^SC(ECXCLIN,"S",ECXDATE,1,JJ,0),U,1) I PP=ECXDFN S ALEN=$P(^(0),U,2)
"RTN","ECXSCXN",58,0)
 ..S ALEN=$$RJ^XLFSTR(ALEN,3,0)
"RTN","ECXSCXN",59,0)
 ..S ECXSTOP=P1
"RTN","ECXSCXN",60,0)
 ..I TOSEND'=3 S ECXKEY=P1_P2_ALEN_P3_"0" D FILE
"RTN","ECXSCXN",61,0)
 ..I TOSEND=3 S ECXKEY=P1_"000"_ALEN_P3_"0" D FILE
"RTN","ECXSCXN",62,0)
 ..I TOSEND=3 S ECXKEY=P2_"000"_ALEN_P3_"0" D FILE
"RTN","ECXSCXN",63,0)
 ..;create a record for appended ekg
"RTN","ECXSCXN",64,0)
 ..S PNODE=$G(^DPT(ECXDFN,"S",ECXDATE,0)) I $P(PNODE,U,1)=ECXCLIN,$P(PNODE,U,5) D
"RTN","ECXSCXN",65,0)
 ...S ECXKEY="10700003000000",ECXSTOP="107" D FILE
"RTN","ECXSCXN",66,0)
 .;stop code additions
"RTN","ECXSCXN",67,0)
 .I PROCESS=2 D  Q
"RTN","ECXSCXN",68,0)
 ..Q:TOSEND=6
"RTN","ECXSCXN",69,0)
 ..S ALEN=0
"RTN","ECXSCXN",70,0)
 ..I SOURCE=TIU D
"RTN","ECXSCXN",71,0)
 ...K LOCARR S DIC=44,DA=ECXCLIN,DR="1912",DIQ(0)="I",DIQ="LOCARR" D EN^DIQ1
"RTN","ECXSCXN",72,0)
 ...S ALEN=$$RJ^XLFSTR($G(LOCARR(44,ECXCLIN,1912,"I")),3,0)
"RTN","ECXSCXN",73,0)
 ..S:ALEN=0 ALEN="030"
"RTN","ECXSCXN",74,0)
 ..S ECXKEY=P1_P2_ALEN_P3_"0",ECXSTOP=P1
"RTN","ECXSCXN",75,0)
 ..D FILE
"RTN","ECXSCXN",76,0)
 .;dispositions
"RTN","ECXSCXN",77,0)
 .I PROCESS=3 D  Q
"RTN","ECXSCXN",78,0)
 ..S ECXKEY=ECXSTOP_"47906000000"
"RTN","ECXSCXN",79,0)
 ..D FILE
"RTN","ECXSCXN",80,0)
 .;pass thru file #2 to pick-up any noshows for this patient
"RTN","ECXSCXN",81,0)
 .I '$D(^TMP($J,"ECXP",ECXDFN)) D NOSHOW(ECXDFN,ECSD1,ECED) S ^TMP($J,"ECXP",ECXDFN)=""
"RTN","ECXSCXN",82,0)
 ;pass thru file #2 to pick-up any no-shows unaccounted for
"RTN","ECXSCXN",83,0)
 S ECXDFN=0 F  S ECXDFN=$O(^DPT(ECXDFN)) Q:'ECXDFN  D
"RTN","ECXSCXN",84,0)
 .Q:$D(^TMP($J,"ECXP",ECXDFN))
"RTN","ECXSCXN",85,0)
 .D INIT S ECXDATE=ECSD1
"RTN","ECXSCXN",86,0)
 .D PAT(ECXDFN,ECXDATE,.ECXERR)
"RTN","ECXSCXN",87,0)
 .Q:ECXERR
"RTN","ECXSCXN",88,0)
 .D NOSHOW(ECXDFN,ECSD1,ECED)
"RTN","ECXSCXN",89,0)
 ;send missing clinic msg
"RTN","ECXSCXN",90,0)
 D:$D(^TMP($J,"ECXS")) EN^ECXSCX1
"RTN","ECXSCXN",91,0)
 ;update for CLJ extract
"RTN","ECXSCXN",92,0)
 D CLINII^ECXSCX1(ECRN,$P(ECED,"."))
"RTN","ECXSCXN",93,0)
 Q
"RTN","ECXSCXN",94,0)
 ;
"RTN","ECXSCXN",95,0)
PAT(ECXDFN,ECXDATE,ECXERR) ;get patient demographic data
"RTN","ECXSCXN",96,0)
 N OK,X
"RTN","ECXSCXN",97,0)
 K ECXPAT
"RTN","ECXSCXN",98,0)
 S OK=$$PAT^ECXUTL3(ECXDFN,$P(ECXDATE,"."),"1;2;3;4;5",.ECXPAT)
"RTN","ECXSCXN",99,0)
 I 'OK S ECXERR=1 K ECXPAT Q
"RTN","ECXSCXN",100,0)
 S ECXSSN=ECXPAT("SSN")
"RTN","ECXSCXN",101,0)
 S ECXPNM=ECXPAT("NAME")
"RTN","ECXSCXN",102,0)
 S ECXMPI=ECXPAT("MPI")
"RTN","ECXSCXN",103,0)
 S ECXSEX=ECXPAT("SEX")
"RTN","ECXSCXN",104,0)
 S ECXDOB=ECXPAT("DOB")
"RTN","ECXSCXN",105,0)
 S ECXELIG=ECXPAT("ELIG")
"RTN","ECXSCXN",106,0)
 S ECXVET=ECXPAT("VET")
"RTN","ECXSCXN",107,0)
 S ECXSVC=ECXPAT("SC%")
"RTN","ECXSCXN",108,0)
 S ECXRACE=ECXPAT("RACE")
"RTN","ECXSCXN",109,0)
 S ECXPST=ECXPAT("POW STAT")
"RTN","ECXSCXN",110,0)
 S ECXPLOC=ECXPAT("POW LOC")
"RTN","ECXSCXN",111,0)
 S ECXRST=ECXPAT("IR STAT")
"RTN","ECXSCXN",112,0)
 S ECXAST=ECXPAT("AO STAT")
"RTN","ECXSCXN",113,0)
 S ECXMST=ECXPAT("MST STAT")
"RTN","ECXSCXN",114,0)
 S ECXSTATE=ECXPAT("STATE")
"RTN","ECXSCXN",115,0)
 S ECXCNTY=ECXPAT("COUNTY")
"RTN","ECXSCXN",116,0)
 S ECXZIP=ECXPAT("ZIP")
"RTN","ECXSCXN",117,0)
 S ECXENRL=ECXPAT("ENROLL LOC")
"RTN","ECXSCXN",118,0)
 ;get inpatient data
"RTN","ECXSCXN",119,0)
 S X=$$INP^ECXUTL2(ECXDFN,ECXDATE)
"RTN","ECXSCXN",120,0)
 S ECXA=$P(X,U,1)
"RTN","ECXSCXN",121,0)
 S ECXTS=$P(X,U,3)
"RTN","ECXSCXN",122,0)
 ;get primary care data
"RTN","ECXSCXN",123,0)
 S X=$$PRIMARY^ECXUTL2(ECXDFN,$P(ECXDATE,"."))
"RTN","ECXSCXN",124,0)
 S ECPTTM=$P(X,U,1)
"RTN","ECXSCXN",125,0)
 S ECPTPR=$P(X,U,2)
"RTN","ECXSCXN",126,0)
 S ECCLAS=$P(X,U,3)
"RTN","ECXSCXN",127,0)
 S ECPTNPI=$P(X,U,4)
"RTN","ECXSCXN",128,0)
 S ECASPR=$P(X,U,5)
"RTN","ECXSCXN",129,0)
 S ECCLAS2=$P(X,U,6)
"RTN","ECXSCXN",130,0)
 S ECASNPI=$P(X,U,7)
"RTN","ECXSCXN",131,0)
 ;get sharing agreement data
"RTN","ECXSCXN",132,0)
 S (ECXPAYOR,ECXSAI)=""
"RTN","ECXSCXN",133,0)
 D VISN19^ECXUTL2(ECXDFN,.ECXPAYOR,.ECXSAI)
"RTN","ECXSCXN",134,0)
 Q
"RTN","ECXSCXN",135,0)
 ;
"RTN","ECXSCXN",136,0)
NOSHOW(ECXDFN,ECXSD,ECXED) ;file noshow data in file #2
"RTN","ECXSCXN",137,0)
 ;input ECXDFN = ien in file #2
"RTN","ECXSCXN",138,0)
 ;      ECXSD  = start date
"RTN","ECXSCXN",139,0)
 ;      ECXED  = end date
"RTN","ECXSCXN",140,0)
 N JJ,PP,JDATE,NODE,STATUS,CLIN,ALEN
"RTN","ECXSCXN",141,0)
 S JDATE=ECXSD
"RTN","ECXSCXN",142,0)
 F  S JDATE=$O(^DPT(ECXDFN,"S",JDATE)) Q:'JDATE  Q:JDATE>ECED  S NODE=^(JDATE,0) D
"RTN","ECXSCXN",143,0)
 .S CLIN=+$P(NODE,U,1),STATUS=$P(NODE,U,2),ECXDATE=JDATE
"RTN","ECXSCXN",144,0)
 .S NOSHOW=$S(STATUS="N":"N",STATUS="NA":"N",1:"")
"RTN","ECXSCXN",145,0)
 .Q:NOSHOW=""
"RTN","ECXSCXN",146,0)
 .Q:$P($G(^SC(CLIN,0)),U,3)'="C"
"RTN","ECXSCXN",147,0)
 .S (P1,P2,P3)="" D FEEDER^ECXSCX1(CLIN,ECXSD,.P1,.P2,.P3,.TOSEND,.ECXDIV)
"RTN","ECXSCXN",148,0)
 .Q:TOSEND=6
"RTN","ECXSCXN",149,0)
 .;get appt length
"RTN","ECXSCXN",150,0)
 .S JJ=0,ALEN=0 F  S JJ=$O(^SC(CLIN,"S",JDATE,1,JJ)) Q:'JJ  D  Q:ALEN
"RTN","ECXSCXN",151,0)
 ..S PP=$P(^SC(CLIN,"S",JDATE,1,JJ,0),U,1) I PP=ECXDFN S ALEN=$P(^(0),U,2)
"RTN","ECXSCXN",152,0)
 .S ALEN=$$RJ^XLFSTR(ALEN,3,0)
"RTN","ECXSCXN",153,0)
 .S ECXCLIN=CLIN,ECXSTOP=P1
"RTN","ECXSCXN",154,0)
 .S ECXCPT="99199" F L=6:1:120 S ECXCPT=ECXCPT_" "
"RTN","ECXSCXN",155,0)
 .S ECXICD9="799.9" F L=6:1:63 S ECXICD9=ECXICD9_" "
"RTN","ECXSCXN",156,0)
 .I TOSEND'=3 S ECXKEY=P1_P2_ALEN_P3_NOSHOW D FILE
"RTN","ECXSCXN",157,0)
 .I TOSEND=3 S ECXKEY=P1_"000"_ALEN_P3_NOSHOW D FILE
"RTN","ECXSCXN",158,0)
 .I TOSEND=3 S ECXKEY=P2_"000"_ALEN_P3_NOSHOW D FILE
"RTN","ECXSCXN",159,0)
 .;create a record for noshow appended ekg
"RTN","ECXSCXN",160,0)
 .I $P(NODE,U,5) S ECXKEY="1070000300000N",ECXSTOP="107" D FILE
"RTN","ECXSCXN",161,0)
 Q
"RTN","ECXSCXN",162,0)
 ;
"RTN","ECXSCXN",163,0)
INIT ;initialize variables
"RTN","ECXSCXN",164,0)
 S ECXERR=0
"RTN","ECXSCXN",165,0)
 S (ECXSSN,ECXPNM,ECXA,ECXKEY,ECXTS,ECXENEL,ECPTPR,ECCLAS,ECPTNPI,ECASPR,ECCLAS2,ECASNPI,ECXCPT,ECPTTM)=""
"RTN","ECXSCXN",166,0)
 S (ECXSTOP,ECXCLIN,ECXKEY,ECXMPI,ECXSEX,ECXDOB,ECXELIG,ECXVET,ECXRACE,ECXPST,ECXPLOC,ECXRST,ECXAST,ECXMST,ECXSTATE,ECXCNTY,ECXZIP)=""
"RTN","ECXSCXN",167,0)
 S (ECXENRL,ECXPROV,ECXPROVP,ECXPROVN,ECXPAYOR,ECXSAI,ECXIR,ECXAO,ECXMIL,ECXDSSD,ECXICD9)=""
"RTN","ECXSCXN",168,0)
 Q
"RTN","ECXSCXN",169,0)
 ;
"RTN","ECXSCXN",170,0)
FILE ;record setup for files #727.816 & #727.818
"RTN","ECXSCXN",171,0)
 ;file #727.816 record
"RTN","ECXSCXN",172,0)
 ;node0
"RTN","ECXSCXN",173,0)
 ;facility^dfn^ssn^name^in/out status^day^feeder key^treat spec^encounter elig^pc provider^pc provider person class^pc prov npi
"RTN","ECXSCXN",174,0)
 ;assoc pc provider^assoc pc prov person class^assoc pc prov npi^clinic
"RTN","ECXSCXN",175,0)
 ;node1
"RTN","ECXSCXN",176,0)
 ;cpt&modifiers^pc team
"RTN","ECXSCXN",177,0)
 S EC7=$O(^ECX(727.816,999999999),-1),EC7=EC7+1
"RTN","ECXSCXN",178,0)
 S ECODE=EC7_U_EC23
"RTN","ECXSCXN",179,0)
 S ECODE=ECODE_U_ECXDIV_U_ECXDFN_U_ECXSSN_U_ECXPNM_U_ECXA_U_$$ECXDATE^ECXUTL(ECXDATE,ECXYM)_U_ECXKEY
"RTN","ECXSCXN",180,0)
 S ECODE=ECODE_U_ECXTS_U_ECXENEL_U_ECPTPR_U_ECCLAS_U_ECPTNPI_U_ECASPR_U_ECCLAS2_U_ECASNPI_U_ECXCLIN
"RTN","ECXSCXN",181,0)
 S ECODE1=ECXCPT_U_ECPTTM
"RTN","ECXSCXN",182,0)
 D FILE2(727.816,EC7,ECODE,ECODE1)
"RTN","ECXSCXN",183,0)
 ;
"RTN","ECXSCXN",184,0)
 ;file #727.818 record
"RTN","ECXSCXN",185,0)
 ;node0
"RTN","ECXSCXN",186,0)
 ;facility^dfn^ssn^name^in/out status^day^primary stop^mpi^sex^dob^elig^vet^race^pow status^pow loc^ir status^ao status^mst status^
"RTN","ECXSCXN",187,0)
 ;state^county^zip^enroll loc^^provider^prov person class^prov npi^sa payor^sa insurance^ir encounter^ao encounter^mst encounter^dss dept
"RTN","ECXSCXN",188,0)
 ;node1
"RTN","ECXSCXN",189,0)
 ;icd9
"RTN","ECXSCXN",190,0)
 ;be sure that stop matches feeder key
"RTN","ECXSCXN",191,0)
 S ECXSTOP=$E(ECXKEY,1,3)
"RTN","ECXSCXN",192,0)
 S ECODE=EC7_U_EC23
"RTN","ECXSCXN",193,0)
 S ECODE=ECODE_U_ECXDIV_U_ECXDFN_U_ECXSSN_U_ECXPNM_U_ECXA_U_$$ECXDATE^ECXUTL(ECXDATE,ECXYM)_U_ECXSTOP_U_ECXMPI
"RTN","ECXSCXN",194,0)
 S ECODE=ECODE_U_ECXSEX_U_ECXDOB_U_ECXELIG_U_ECXVET_U_ECXRACE_U_ECXPST_U_ECXPLOC_U_ECXRST_U_ECXAST_U_ECXMST
"RTN","ECXSCXN",195,0)
 S ECODE=ECODE_U_ECXSTATE_U_ECXCNTY_U_ECXZIP_U_ECXENRL_U_U_ECXPROV_U_ECXPROVP_U_ECXPROVN_U_ECXPAYOR_U_ECXSAI_U_ECXIR_U_ECXAO_U_ECXMIL_U_ECXDSSD
"RTN","ECXSCXN",196,0)
 S ECODE1=ECXICD9
"RTN","ECXSCXN",197,0)
 D FILE2(727.818,EC7,ECODE,ECODE1)
"RTN","ECXSCXN",198,0)
 S ECRN=ECRN+1
"RTN","ECXSCXN",199,0)
 Q
"RTN","ECXSCXN",200,0)
 ;
"RTN","ECXSCXN",201,0)
FILE2(ECXFILE,EC7,ECODE,ECODE1) ;file record
"RTN","ECXSCXN",202,0)
 N DA,DIK,QFLG
"RTN","ECXSCXN",203,0)
 S ^ECX(ECXFILE,EC7,0)=ECODE,^ECX(ECXFILE,EC7,1)=ECODE1
"RTN","ECXSCXN",204,0)
 S DA=EC7,DIK="^ECX("_ECXFILE_"," D IX^DIK K DIK,DA
"RTN","ECXSCXN",205,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S QFLG=1
"RTN","ECXSCXN",206,0)
 Q
"RTN","ECXSCXN",207,0)
 ;
"RTN","ECXSCXN",208,0)
SETUP ;set required input for ECXTRAC
"RTN","ECXSCXN",209,0)
 S ECHEAD="CLI"
"RTN","ECXSCXN",210,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXSCXN",211,0)
 Q
"VER")
8.0^22.0
**END**
**END**
