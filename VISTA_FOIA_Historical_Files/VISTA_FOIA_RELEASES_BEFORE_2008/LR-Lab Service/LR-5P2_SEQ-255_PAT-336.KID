Released LR*5.2*336 SEQ #255
Extracted from mail message
**KIDS**:LR*5.2*336^

**INSTALL NAME**
LR*5.2*336
"BLD",6156,0)
LR*5.2*336^LAB SERVICE^0^3050512^y
"BLD",6156,1,0)
^^2^2^3050502^
"BLD",6156,1,1,0)
This patch will up date the LR reference to Person Class codes to conform 
"BLD",6156,1,2,0)
with the new codes released in XU*8*377.
"BLD",6156,4,0)
^9.64PA^^
"BLD",6156,"KRN",0)
^9.67PA^8989.52^19
"BLD",6156,"KRN",.4,0)
.4
"BLD",6156,"KRN",.401,0)
.401
"BLD",6156,"KRN",.402,0)
.402
"BLD",6156,"KRN",.403,0)
.403
"BLD",6156,"KRN",.5,0)
.5
"BLD",6156,"KRN",.84,0)
.84
"BLD",6156,"KRN",3.6,0)
3.6
"BLD",6156,"KRN",3.8,0)
3.8
"BLD",6156,"KRN",9.2,0)
9.2
"BLD",6156,"KRN",9.8,0)
9.8
"BLD",6156,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6156,"KRN",9.8,"NM",1,0)
LRAPRES1^^0^B41479483
"BLD",6156,"KRN",9.8,"NM","B","LRAPRES1",1)

"BLD",6156,"KRN",19,0)
19
"BLD",6156,"KRN",19.1,0)
19.1
"BLD",6156,"KRN",101,0)
101
"BLD",6156,"KRN",409.61,0)
409.61
"BLD",6156,"KRN",771,0)
771
"BLD",6156,"KRN",870,0)
870
"BLD",6156,"KRN",8989.51,0)
8989.51
"BLD",6156,"KRN",8989.52,0)
8989.52
"BLD",6156,"KRN",8994,0)
8994
"BLD",6156,"KRN","B",.4,.4)

"BLD",6156,"KRN","B",.401,.401)

"BLD",6156,"KRN","B",.402,.402)

"BLD",6156,"KRN","B",.403,.403)

"BLD",6156,"KRN","B",.5,.5)

"BLD",6156,"KRN","B",.84,.84)

"BLD",6156,"KRN","B",3.6,3.6)

"BLD",6156,"KRN","B",3.8,3.8)

"BLD",6156,"KRN","B",9.2,9.2)

"BLD",6156,"KRN","B",9.8,9.8)

"BLD",6156,"KRN","B",19,19)

"BLD",6156,"KRN","B",19.1,19.1)

"BLD",6156,"KRN","B",101,101)

"BLD",6156,"KRN","B",409.61,409.61)

"BLD",6156,"KRN","B",771,771)

"BLD",6156,"KRN","B",870,870)

"BLD",6156,"KRN","B",8989.51,8989.51)

"BLD",6156,"KRN","B",8989.52,8989.52)

"BLD",6156,"KRN","B",8994,8994)

"BLD",6156,"QUES",0)
^9.62^^
"BLD",6156,"REQB",0)
^9.611^1^1
"BLD",6156,"REQB",1,0)
LR*5.2*259^2
"BLD",6156,"REQB","B","LR*5.2*259",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2981028^66481
"PKG",26,22,1,"PAH",1,0)
336^3050512
"PKG",26,22,1,"PAH",1,1,0)
^^2^2^3050512
"PKG",26,22,1,"PAH",1,1,1,0)
This patch will up date the LR reference to Person Class codes to conform 
"PKG",26,22,1,"PAH",1,1,2,0)
with the new codes released in XU*8*377.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","LRAPRES1")
0^1^B41479483
"RTN","LRAPRES1",1,0)
LRAPRES1 ;DALOI/WTY/KLL - AP ESIG RELEASE REPORT/ALERT;11/13/01
"RTN","LRAPRES1",2,0)
 ;;5.2;LAB SERVICE;**259,336**;Sep 27, 1994
"RTN","LRAPRES1",3,0)
 ;
"RTN","LRAPRES1",4,0)
 ;Reference  to FILE^TIUSRVP supported by IA #3540
"RTN","LRAPRES1",5,0)
 ;Reference  to ^TIULQ supported by IA #2693 
"RTN","LRAPRES1",6,0)
 ;
"RTN","LRAPRES1",7,0)
MAIN(LRDFN,LRSS,LRI,LRSF,LRP,LRAC) ;Main subroutine
"RTN","LRAPRES1",8,0)
 Q:'$D(LRDFN)!('$D(LRSS))!('$D(LRP))!('$D(LRAC))
"RTN","LRAPRES1",9,0)
 N LRDOCS,LRMSG,XQA,LRC,LRDOCSN,LRNUM,LRADL,LRMORE,LRQUIT
"RTN","LRAPRES1",10,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y,DIC,XQA,XQAMSG
"RTN","LRAPRES1",11,0)
 S LRQUIT=0
"RTN","LRAPRES1",12,0)
 D ASK
"RTN","LRAPRES1",13,0)
 Q:LRQUIT
"RTN","LRAPRES1",14,0)
 D MORE
"RTN","LRAPRES1",15,0)
 Q:LRQUIT
"RTN","LRAPRES1",16,0)
 D:LRMORE LOOKUP
"RTN","LRAPRES1",17,0)
 D ALERT
"RTN","LRAPRES1",18,0)
 Q
"RTN","LRAPRES1",19,0)
ASK ;Ask if alert is to be sent
"RTN","LRAPRES1",20,0)
 W !
"RTN","LRAPRES1",21,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPRES1",22,0)
 S DIR("A")="Do you wish to send an alert"
"RTN","LRAPRES1",23,0)
 S DIR("??")="^D AHELP^LRAPRES1"
"RTN","LRAPRES1",24,0)
 D ^DIR
"RTN","LRAPRES1",25,0)
 I 'Y S LRQUIT=1 Q
"RTN","LRAPRES1",26,0)
 S:$G(LRSF)="" LRSF=63
"RTN","LRAPRES1",27,0)
 D GETDOCS^LRAPUTL(.LRDOCS,LRDFN,LRSS,$G(LRI),LRSF)
"RTN","LRAPRES1",28,0)
 S:LRDOCS(1)=LRDOCS(2) LRDOCS(2)=0
"RTN","LRAPRES1",29,0)
 S LRQUIT=1
"RTN","LRAPRES1",30,0)
 F LRC=1:1:2 D
"RTN","LRAPRES1",31,0)
 .I LRDOCS(LRC) D
"RTN","LRAPRES1",32,0)
 ..S LRQUIT=0
"RTN","LRAPRES1",33,0)
 ..S X=LRDOCS(LRC) D D^LRUA S LRDOCSN(LRC)=X
"RTN","LRAPRES1",34,0)
 ..I LRDOCSN(LRC)'="" S XQA(LRDOCS(LRC))=""
"RTN","LRAPRES1",35,0)
 ;Q:LRQUIT
"RTN","LRAPRES1",36,0)
 S LRNUM=1
"RTN","LRAPRES1",37,0)
 K LRMSG
"RTN","LRAPRES1",38,0)
 I 'LRQUIT D
"RTN","LRAPRES1",39,0)
 .S LRMSG(LRNUM)="Alert will be sent to:",LRMSG(LRNUM,"F")="!!"
"RTN","LRAPRES1",40,0)
 .I LRDOCS(1) D
"RTN","LRAPRES1",41,0)
 ..S LRNUM=LRNUM+1,LRMSG(LRNUM)=LRDOCSN(1),LRMSG(LRNUM,"F")="?24"
"RTN","LRAPRES1",42,0)
 .I LRDOCS(2) D
"RTN","LRAPRES1",43,0)
 ..S LRNUM=LRNUM+1,LRMSG(LRNUM)=LRDOCSN(2)
"RTN","LRAPRES1",44,0)
 ..S LRMSG(LRNUM,"F")=$S(LRDOCS(1):"!",1:"")_"?24"
"RTN","LRAPRES1",45,0)
 I LRQUIT D
"RTN","LRAPRES1",46,0)
 .S LRMSG(LRNUM)="No Physician or PCP selected for alert"
"RTN","LRAPRES1",47,0)
 .S LRMSG(LRNUM,"F")="!!"
"RTN","LRAPRES1",48,0)
 .S LRQUIT=0
"RTN","LRAPRES1",49,0)
 D EN^DDIOL(.LRMSG)
"RTN","LRAPRES1",50,0)
 Q
"RTN","LRAPRES1",51,0)
MORE ;Add names or mail groups to the lookup list?
"RTN","LRAPRES1",52,0)
 W !
"RTN","LRAPRES1",53,0)
 S LRMORE=1
"RTN","LRAPRES1",54,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPRES1",55,0)
 S DIR("A")="Send the alert to additional names or mail groups"
"RTN","LRAPRES1",56,0)
 D ^DIR
"RTN","LRAPRES1",57,0)
 I Y=0 S LRMORE=0 Q
"RTN","LRAPRES1",58,0)
 I $D(DUOUT)!($D(DTOUT)) S LRQUIT=1
"RTN","LRAPRES1",59,0)
 Q
"RTN","LRAPRES1",60,0)
LOOKUP ;Add additional names or mail groups to alert list.
"RTN","LRAPRES1",61,0)
 F  D  Q:LRQUIT
"RTN","LRAPRES1",62,0)
 .W !
"RTN","LRAPRES1",63,0)
 .K DIR
"RTN","LRAPRES1",64,0)
 .;S DIR(0)="F^3:30^I X'?1""U."".E&(X'?1""G."".E) K X"
"RTN","LRAPRES1",65,0)
 .S DIR(0)="F^3:30^I X["".""&(X'?1""G."".E) K X"
"RTN","LRAPRES1",66,0)
 .S DIR("A")="Enter name or mail group"
"RTN","LRAPRES1",67,0)
 .S DIR("?")="Enter lastname,firstname OR G.mailgroup OR ^ to exit"
"RTN","LRAPRES1",68,0)
 .D ^DIR
"RTN","LRAPRES1",69,0)
 .I $D(DUOUT)!($D(DTOUT)) S LRQUIT=1 Q
"RTN","LRAPRES1",70,0)
 .S X=Y,LRADL=""
"RTN","LRAPRES1",71,0)
 .I Y["." S LRADL=$P(Y,"."),X=$P(Y,".",2)
"RTN","LRAPRES1",72,0)
 .K DIC
"RTN","LRAPRES1",73,0)
 .S DIC(0)="QEZ"
"RTN","LRAPRES1",74,0)
 .S DIC=$S(LRADL="G":3.8,1:200)
"RTN","LRAPRES1",75,0)
 .D ^DIC
"RTN","LRAPRES1",76,0)
 .Q:Y=-1
"RTN","LRAPRES1",77,0)
 .S:LRADL="" XQA($P(Y,"^"))=""
"RTN","LRAPRES1",78,0)
 .S:LRADL="G" XQA("G."_$P(Y,"^",2))=""
"RTN","LRAPRES1",79,0)
 .K LRMSG
"RTN","LRAPRES1",80,0)
 .S LRMSG=$S(LRADL="G":"Mail group ",1:"User ")_$P(Y,"^",2)
"RTN","LRAPRES1",81,0)
 .S LRMSG=LRMSG_" added to alert list."
"RTN","LRAPRES1",82,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",83,0)
 Q
"RTN","LRAPRES1",84,0)
ALERT ;Send the alert
"RTN","LRAPRES1",85,0)
 S XQAMSG="Pathology report signed for "_LRAC_" - "_$E(LRP,1,30)
"RTN","LRAPRES1",86,0)
 D SETUP^XQALERT
"RTN","LRAPRES1",87,0)
 S LRMSG="Alerts have been sent."
"RTN","LRAPRES1",88,0)
 D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",89,0)
 K LRMSG
"RTN","LRAPRES1",90,0)
 Q
"RTN","LRAPRES1",91,0)
AHELP ;Help Frame
"RTN","LRAPRES1",92,0)
 K LRMSG
"RTN","LRAPRES1",93,0)
 S LRMSG(1)="If answered 'Yes', the alert will notify the primary care"
"RTN","LRAPRES1",94,0)
 S LRMSG(1,"F")="!"
"RTN","LRAPRES1",95,0)
 S LRMSG(2)="provider  and  the surgeon/physician that this report has"
"RTN","LRAPRES1",96,0)
 S LRMSG(3)="been  electronically  signed  and  is  now  available for"
"RTN","LRAPRES1",97,0)
 S LRMSG(4)="viewing.   You will also have the opportunity to send the"
"RTN","LRAPRES1",98,0)
 S LRMSG(5)="alert to additional names or mail groups."
"RTN","LRAPRES1",99,0)
 D EN^DDIOL(.LRMSG)
"RTN","LRAPRES1",100,0)
 Q
"RTN","LRAPRES1",101,0)
RETRACT(LRDFN,LRSS,LRI,LRTIUPTR) ;
"RTN","LRAPRES1",102,0)
 ;Change prior TIU versions of report to RETRACTED status
"RTN","LRAPRES1",103,0)
 N LRROOT,LRIENS,LRFILE,LRTIUP,LRTIUAR,LRERR,LRSTAT,LRTIUX,LREXRR
"RTN","LRAPRES1",104,0)
 I LRSS=""!("AUSPEMCY"'[LRSS) S LRPTR=0 Q
"RTN","LRAPRES1",105,0)
 I LRSS="AU" D
"RTN","LRAPRES1",106,0)
 .S LRROOT="^LR(LRDFN,101,""C""",LRIENS=LRDFN_","
"RTN","LRAPRES1",107,0)
 .S LRFILE=63.101
"RTN","LRAPRES1",108,0)
 I LRSS'="AU" D
"RTN","LRAPRES1",109,0)
 .S LRROOT="^LR(LRDFN,LRSS,LRI,.05,""C"""
"RTN","LRAPRES1",110,0)
 .S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPRES1",111,0)
 .S LRFILE=$S(LRSS="SP":63.19,LRSS="CY":63.47,LRSS="EM":63.49,1:"")
"RTN","LRAPRES1",112,0)
 Q:'$D(@(LRROOT_")"))
"RTN","LRAPRES1",113,0)
 S LRTIUP=0,LRTIUX(.05)=15
"RTN","LRAPRES1",114,0)
 F  S LRTIUP=$O(@(LRROOT_",LRTIUP)"))  Q:LRTIUP'>0!(LRTIUP=LRTIUPTR)  D
"RTN","LRAPRES1",115,0)
 .K LRTIUAR S (LRSTAT,LRERR)=0
"RTN","LRAPRES1",116,0)
 .D EXTRACT^TIULQ(LRTIUP,"LRTIUAR",.LRERR,".05",,,"I")
"RTN","LRAPRES1",117,0)
 .Q:+LRERR
"RTN","LRAPRES1",118,0)
 .M LRSTAT=LRTIUAR(LRTIUP,.05,"I")
"RTN","LRAPRES1",119,0)
 .Q:LRSTAT'=7  ;Quit if current status is not COMPLETED
"RTN","LRAPRES1",120,0)
 .D FILE^TIUSRVP(.LREXRR,LRTIUP,.LRTIUX)
"RTN","LRAPRES1",121,0)
 .;Update new TIU version of report with previous TIU pointer value
"RTN","LRAPRES1",122,0)
 .N LREXRR,LRTIUX
"RTN","LRAPRES1",123,0)
 .S LRTIUX(1406)=LRTIUP
"RTN","LRAPRES1",124,0)
 .D FILE^TIUSRVP(.LREXRR,LRTIUPTR,.LRTIUX)
"RTN","LRAPRES1",125,0)
 Q
"RTN","LRAPRES1",126,0)
CLSSCHK(DUZ,LREND) ;Determine if user has the proper class settings and
"RTN","LRAPRES1",127,0)
 ;PROVIDER key
"RTN","LRAPRES1",128,0)
 N LRMSG,LRPRCLSS,LRPCEXP,LRVCDE,LRPCSTR,LRMTCH
"RTN","LRAPRES1",129,0)
 ;First, check for PROVIDER key
"RTN","LRAPRES1",130,0)
 I '$D(^XUSEC("PROVIDER",DUZ)) D  Q
"RTN","LRAPRES1",131,0)
 .K LRMSG S LRMSG=$C(7)_"Electronic signature not authorized.  Missing "
"RTN","LRAPRES1",132,0)
 .S LRMSG=LRMSG_"PROVIDER key."
"RTN","LRAPRES1",133,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",134,0)
 .K LRMSG S LREND=1
"RTN","LRAPRES1",135,0)
 ;Next, check the provider class
"RTN","LRAPRES1",136,0)
 S LRPRCLSS=$$GET1^DIQ(200,DUZ_",",53.5)
"RTN","LRAPRES1",137,0)
 ;PROVIDER CL MUST CONTAIN PHYSICIAN, OR CYTOTECH ONLY FOR CY SECTION
"RTN","LRAPRES1",138,0)
 S LRMTCH=0
"RTN","LRAPRES1",139,0)
 I LRPRCLSS'["PHYSICIAN" D
"RTN","LRAPRES1",140,0)
 .I LRPRCLSS'["CYTOTECH" S LRMTCH=1
"RTN","LRAPRES1",141,0)
 .I LRSS'="CY" S LRMTCH=1
"RTN","LRAPRES1",142,0)
 I LRMTCH=1 D  Q
"RTN","LRAPRES1",143,0)
 .K LRMSG
"RTN","LRAPRES1",144,0)
 .S LRMSG(1)=$C(7)_"You are not authorized to electronically sign "
"RTN","LRAPRES1",145,0)
 .S LRMSG(1)=LRMSG(1)_"reports."
"RTN","LRAPRES1",146,0)
 .S LRMSG(1,"F")="!!"
"RTN","LRAPRES1",147,0)
 .S LRMSG(2)="PROVIDER CLASS must include PHYSICIAN,"
"RTN","LRAPRES1",148,0)
 .S LRMSG(2,"F")="!"
"RTN","LRAPRES1",149,0)
 .S LRMSG(3)="  OR CYTOTECHNOLOGIST FOR CY SECTIONS ONLY."
"RTN","LRAPRES1",150,0)
 .S LRMSG(3,"F")="!"
"RTN","LRAPRES1",151,0)
 .D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPRES1",152,0)
 .S LREND=1
"RTN","LRAPRES1",153,0)
 ;Finally, check the person class
"RTN","LRAPRES1",154,0)
 S LRPCSTR=$$GET^XUA4A72(DUZ)   ;Supported reference #1625
"RTN","LRAPRES1",155,0)
 I LRPCSTR<0 D  Q
"RTN","LRAPRES1",156,0)
 .K LRMSG
"RTN","LRAPRES1",157,0)
 .S LRMSG="PERSON CLASS is inactive or undefined.  Electronic signature"
"RTN","LRAPRES1",158,0)
 .S LRMSG=LRMSG_" is not authorized."
"RTN","LRAPRES1",159,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",160,0)
 .K LRMSG
"RTN","LRAPRES1",161,0)
 .S LREND=1
"RTN","LRAPRES1",162,0)
 S LRPCEXP=+$P(LRPCSTR,"^",6)
"RTN","LRAPRES1",163,0)
 I LRPCEXP D  Q
"RTN","LRAPRES1",164,0)
 .K LRMSG
"RTN","LRAPRES1",165,0)
 .S LRMSG="PERSON CLASS has expired.  Electronic signature"
"RTN","LRAPRES1",166,0)
 .S LRMSG=LRMSG_" is not authorized."
"RTN","LRAPRES1",167,0)
 .D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES1",168,0)
 .S LREND=1
"RTN","LRAPRES1",169,0)
 S LRVCDE=$P(LRPCSTR,"^",7),LRMTCH=0
"RTN","LRAPRES1",170,0)
 ;CORRECT PERSON CLASS SHOULD MATCH PROVIDER CLASS
"RTN","LRAPRES1",171,0)
 I LRPRCLSS["PHYSICIAN" D
"RTN","LRAPRES1",172,0)
 .I $E(LRVCDE,1,6)="V11370","123568"[+$E(LRVCDE,7) S LRMTCH=1
"RTN","LRAPRES1",173,0)
 .I $E(LRVCDE,1,6)="V11371","03"[+$E(LRVCDE,7) S LRMTCH=1
"RTN","LRAPRES1",174,0)
 .I $E(LRVCDE,1,6)="V18240","124579"[+$E(LRVCDE,7) S LRMTCH=1
"RTN","LRAPRES1",175,0)
 .I LRVCDE="V182413" S LRMTCH=1
"RTN","LRAPRES1",176,0)
 I LRPRCLSS["CYTOTECH" D
"RTN","LRAPRES1",177,0)
 .I LRVCDE="V150113" S LRMTCH=1
"RTN","LRAPRES1",178,0)
 I 'LRMTCH D
"RTN","LRAPRES1",179,0)
 .K LRMSG
"RTN","LRAPRES1",180,0)
 .S LRMSG="Invalid PERSON CLASS.  Electronic Signature is not "
"RTN","LRAPRES1",181,0)
 .S LRMSG=LRMSG_"authorized."
"RTN","LRAPRES1",182,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",183,0)
 .K LRMSG
"RTN","LRAPRES1",184,0)
 .S LREND=1
"RTN","LRAPRES1",185,0)
 Q
"VER")
8.0^22.0
"BLD",6156,6)
^SEQ #255
**END**
**END**
