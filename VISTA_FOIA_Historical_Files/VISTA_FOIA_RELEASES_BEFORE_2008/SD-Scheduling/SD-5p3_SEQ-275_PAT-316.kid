Released SD*5.3*316 SEQ #275
Extracted from mail message
**KIDS**:SD*5.3*316^

**INSTALL NAME**
SD*5.3*316
"BLD",4758,0)
SD*5.3*316^SCHEDULING^0^3030917^y
"BLD",4758,4,0)
^9.64PA^^
"BLD",4758,"KRN",0)
^9.67PA^8989.52^19
"BLD",4758,"KRN",.4,0)
.4
"BLD",4758,"KRN",.401,0)
.401
"BLD",4758,"KRN",.402,0)
.402
"BLD",4758,"KRN",.403,0)
.403
"BLD",4758,"KRN",.5,0)
.5
"BLD",4758,"KRN",.84,0)
.84
"BLD",4758,"KRN",3.6,0)
3.6
"BLD",4758,"KRN",3.8,0)
3.8
"BLD",4758,"KRN",9.2,0)
9.2
"BLD",4758,"KRN",9.8,0)
9.8
"BLD",4758,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4758,"KRN",9.8,"NM",1,0)
SDAMA201^^0^B34887433
"BLD",4758,"KRN",9.8,"NM",2,0)
SDAMA202^^0^B15446167
"BLD",4758,"KRN",9.8,"NM","B","SDAMA201",1)

"BLD",4758,"KRN",9.8,"NM","B","SDAMA202",2)

"BLD",4758,"KRN",19,0)
19
"BLD",4758,"KRN",19.1,0)
19.1
"BLD",4758,"KRN",101,0)
101
"BLD",4758,"KRN",409.61,0)
409.61
"BLD",4758,"KRN",771,0)
771
"BLD",4758,"KRN",870,0)
870
"BLD",4758,"KRN",8989.51,0)
8989.51
"BLD",4758,"KRN",8989.52,0)
8989.52
"BLD",4758,"KRN",8994,0)
8994
"BLD",4758,"KRN","B",.4,.4)

"BLD",4758,"KRN","B",.401,.401)

"BLD",4758,"KRN","B",.402,.402)

"BLD",4758,"KRN","B",.403,.403)

"BLD",4758,"KRN","B",.5,.5)

"BLD",4758,"KRN","B",.84,.84)

"BLD",4758,"KRN","B",3.6,3.6)

"BLD",4758,"KRN","B",3.8,3.8)

"BLD",4758,"KRN","B",9.2,9.2)

"BLD",4758,"KRN","B",9.8,9.8)

"BLD",4758,"KRN","B",19,19)

"BLD",4758,"KRN","B",19.1,19.1)

"BLD",4758,"KRN","B",101,101)

"BLD",4758,"KRN","B",409.61,409.61)

"BLD",4758,"KRN","B",771,771)

"BLD",4758,"KRN","B",870,870)

"BLD",4758,"KRN","B",8989.51,8989.51)

"BLD",4758,"KRN","B",8989.52,8989.52)

"BLD",4758,"KRN","B",8994,8994)

"BLD",4758,"QUES",0)
^9.62^^
"BLD",4758,"REQB",0)
^9.611^1^1
"BLD",4758,"REQB",1,0)
SD*5.3*283^2
"BLD",4758,"REQB","B","SD*5.3*283",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930930
"PKG",16,22,1,"PAH",1,0)
316^3030917
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","SDAMA201")
0^1^B34887433
"RTN","SDAMA201",1,0)
SDAMA201 ;BPOIFO/ACS-Scheduling Replacement APIs ;16 Sept 2003
"RTN","SDAMA201",2,0)
 ;;5.3;Scheduling;**253,275,283,316**;13 Aug 1993
"RTN","SDAMA201",3,0)
 ;
"RTN","SDAMA201",4,0)
 ;GETAPPT  - Returns appointment information for a patient
"RTN","SDAMA201",5,0)
 ;NEXTAPPT - Returns next appointment information for a patient
"RTN","SDAMA201",6,0)
 ;
"RTN","SDAMA201",7,0)
 ;**   BEFORE USING THE APIS IN THIS ROUTINE, PLEASE SUBSCRIBE   **
"RTN","SDAMA201",8,0)
 ;**   TO DBIA #3859                                             **
"RTN","SDAMA201",9,0)
 ;
"RTN","SDAMA201",10,0)
 ;*****************************************************************
"RTN","SDAMA201",11,0)
 ;              CHANGE LOG
"RTN","SDAMA201",12,0)
 ;
"RTN","SDAMA201",13,0)
 ;  DATE      PATCH       DESCRIPTION
"RTN","SDAMA201",14,0)
 ;--------  ----------    -----------------------------------------
"RTN","SDAMA201",15,0)
 ;09/20/02  SD*5.3*253    ROUTINE COMPLETED
"RTN","SDAMA201",16,0)
 ;12/10/02  SD*5.3*275    ADDED PATIENT STATUS FILTER
"RTN","SDAMA201",17,0)
 ;07/03/03  SD*5.3*283    REMOVED 'NO ACTION TAKEN' EDIT
"RTN","SDAMA201",18,0)
 ;09/16/03  SD*5.3*316    CHANGED 'NEXTAPPT' TO START LOOKING 'NOW'
"RTN","SDAMA201",19,0)
 ;
"RTN","SDAMA201",20,0)
 ;*****************************************************************
"RTN","SDAMA201",21,0)
GETAPPT(SDPATIEN,SDFIELDS,SDAPSTAT,SDSTART,SDEND,SDRESULT,SDIOSTAT) ;
"RTN","SDAMA201",22,0)
 ;*****************************************************************
"RTN","SDAMA201",23,0)
 ;
"RTN","SDAMA201",24,0)
 ;               GET APPOINTMENTS FOR PATIENT
"RTN","SDAMA201",25,0)
 ;
"RTN","SDAMA201",26,0)
 ;INPUT
"RTN","SDAMA201",27,0)
 ;  SDPATIEN     Patient IEN (required)
"RTN","SDAMA201",28,0)
 ;  SDFIELDS     Fields requested (optional)
"RTN","SDAMA201",29,0)
 ;  SDAPSTAT     Appointment Status Filter (optional)
"RTN","SDAMA201",30,0)
 ;  SDSTART      Start date/time (optional)
"RTN","SDAMA201",31,0)
 ;  SDEND        End date/time (optional)
"RTN","SDAMA201",32,0)
 ;  SDRESULT     Record count returned here (optional)
"RTN","SDAMA201",33,0)
 ;  SDIOSTAT     Patient Status filter (optional)
"RTN","SDAMA201",34,0)
 ;  
"RTN","SDAMA201",35,0)
 ;OUTPUT
"RTN","SDAMA201",36,0)
 ;  ^TMP($J,"SDAMA201","GETAPPT",X,Y)=FieldYdata
"RTN","SDAMA201",37,0)
 ;  where "X" is an incremental appointment counter and
"RTN","SDAMA201",38,0)
 ;  "Y" is the field number requested
"RTN","SDAMA201",39,0)
 ;  
"RTN","SDAMA201",40,0)
 ;*****************************************************************
"RTN","SDAMA201",41,0)
 N SDAPINAM,SDRTNNAM
"RTN","SDAMA201",42,0)
 S SDAPINAM="GETAPPT",SDRTNNAM="SDAMA201",SDRESULT=0
"RTN","SDAMA201",43,0)
 K ^TMP($J,SDRTNNAM,SDAPINAM)
"RTN","SDAMA201",44,0)
 S SDRESULT=$$VALIDATE^SDAMA200(.SDPATIEN,.SDFIELDS,.SDAPSTAT,.SDSTART,.SDEND,SDAPINAM,SDRTNNAM,.SDIOSTAT)
"RTN","SDAMA201",45,0)
 I SDRESULT=-1 Q
"RTN","SDAMA201",46,0)
 ;
"RTN","SDAMA201",47,0)
 ;if the patient has no appointments on ^DPT, quit and pass back 0
"RTN","SDAMA201",48,0)
 I '$$PATAPPT^SDAMA200(SDPATIEN) S SDRESULT=0
"RTN","SDAMA201",49,0)
 Q:SDRESULT=0
"RTN","SDAMA201",50,0)
 ;
"RTN","SDAMA201",51,0)
 ;Set up start and end date/times
"RTN","SDAMA201",52,0)
 S SDSTART=$S($G(SDSTART):(SDSTART-.0001),1:0)
"RTN","SDAMA201",53,0)
 S SDEND=$S($G(SDEND):SDEND,1:"9999999.9999")
"RTN","SDAMA201",54,0)
 I SDEND'["." S SDEND=SDEND_".9999"
"RTN","SDAMA201",55,0)
 ;
"RTN","SDAMA201",56,0)
 ;IF RSA DATABASE AVAILABLE, GET APPOINTMENT DATA FROM RSA DATABASE
"RTN","SDAMA201",57,0)
 ;I $$GOTS^SDAMA100(SDRTNNAM,SDAPINAM) D  Q SDRESULT
"RTN","SDAMA201",58,0)
 ;. ;Insert GOTS code here...
"RTN","SDAMA201",59,0)
 ;. Q
"RTN","SDAMA201",60,0)
 ;
"RTN","SDAMA201",61,0)
 ;GET PATIENT APPOINTMENT DATA ON VISTA
"RTN","SDAMA201",62,0)
 N SDAPPTDT,SDPIECE,SDRECNUM,SDFIELD,SDDATA,SDMCODE,SDMATCH,SDCLIEN,SDPATCNT,SDNEXT,SDI,SDASTAT,SDPSTAT
"RTN","SDAMA201",63,0)
 S (SDPIECE,SDRECNUM,SDAPPTDT,SDFIELD,SDI)=0,SDAPPTDT=SDSTART,SDDATA="",SDMCODE=""
"RTN","SDAMA201",64,0)
 ;Spin through each appointment on the PATIENT file
"RTN","SDAMA201",65,0)
 F SDI=1:1 S SDAPPTDT=$O(^DPT(SDPATIEN,"S",SDAPPTDT)) Q:$S(+$G(SDAPPTDT)=0:1,SDAPPTDT>SDEND:1,1:0)  D
"RTN","SDAMA201",66,0)
 . S SDNEXT=0
"RTN","SDAMA201",67,0)
 . ;Get appt status and patient status
"RTN","SDAMA201",68,0)
 . S SDASTAT=$$GETASTAT^SDAMA200(SDPATIEN,SDAPPTDT)
"RTN","SDAMA201",69,0)
 . S SDPSTAT=$$GETPSTAT^SDAMA200(SDPATIEN,SDAPPTDT)
"RTN","SDAMA201",70,0)
 . ;apply patient status filter
"RTN","SDAMA201",71,0)
 . I SDIOSTAT'[SDPSTAT S SDNEXT=1
"RTN","SDAMA201",72,0)
 . Q:SDNEXT=1
"RTN","SDAMA201",73,0)
 . ;apply appointment status filter
"RTN","SDAMA201",74,0)
 . I SDAPSTAT'[(";"_SDASTAT_";") S SDNEXT=1
"RTN","SDAMA201",75,0)
 . Q:SDNEXT=1
"RTN","SDAMA201",76,0)
 . ;set patient status to null if appointment status is No-Show, Cancelled, or NT
"RTN","SDAMA201",77,0)
 . I ";N;C;NT;"[(";"_SDASTAT_";") S SDPSTAT=""
"RTN","SDAMA201",78,0)
 . ;-- valid appointment has been found --
"RTN","SDAMA201",79,0)
 . ;get clinic IEN, SDDA node, and increment the appointment count
"RTN","SDAMA201",80,0)
 . S SDCLIEN=$$GETCLIEN^SDAMA200(SDPATIEN,SDAPPTDT)
"RTN","SDAMA201",81,0)
 . S SDPATCNT=$$GETSDDA^SDAMA200(SDCLIEN,SDAPPTDT,SDPATIEN)
"RTN","SDAMA201",82,0)
 . S SDRECNUM=SDRECNUM+1
"RTN","SDAMA201",83,0)
 . ;spin through the requested field numbers
"RTN","SDAMA201",84,0)
 . F SDPIECE=1:1 S SDFIELD=$P($G(SDFIELDS),";",SDPIECE) Q:SDFIELD=""  D
"RTN","SDAMA201",85,0)
 .. ;get MUMPS code for the requested field number. Execute. Put result in ^TMP
"RTN","SDAMA201",86,0)
 .. S SDMCODE=$G(^SDAM(44.3,SDFIELD,1)) X SDMCODE
"RTN","SDAMA201",87,0)
 .. ;put resulting data in ^TMP global
"RTN","SDAMA201",88,0)
 .. S ^TMP($J,SDRTNNAM,SDAPINAM,SDRECNUM,SDFIELD)=$G(SDDATA)
"RTN","SDAMA201",89,0)
 ;clean up data map variable
"RTN","SDAMA201",90,0)
 K SDDATA
"RTN","SDAMA201",91,0)
 ; set output record count and quit
"RTN","SDAMA201",92,0)
 S SDRESULT=SDRECNUM
"RTN","SDAMA201",93,0)
 Q
"RTN","SDAMA201",94,0)
 ;
"RTN","SDAMA201",95,0)
NEXTAPPT(SDPATIEN,SDFIELDS,SDAPSTAT,SDIOSTAT) ;
"RTN","SDAMA201",96,0)
 ;*****************************************************************
"RTN","SDAMA201",97,0)
 ;
"RTN","SDAMA201",98,0)
 ;               GET NEXT APPOINTMENT FOR PATIENT
"RTN","SDAMA201",99,0)
 ;
"RTN","SDAMA201",100,0)
 ; This API should be called with an EXTRINISIC call.  It will
"RTN","SDAMA201",101,0)
 ; return "-1" if an error occurs, "1" if a future appointment
"RTN","SDAMA201",102,0)
 ; exists, or "0" if no future appointment exists.  If the user
"RTN","SDAMA201",103,0)
 ; enters field numbers into the optional SDFIELDS parameter and a
"RTN","SDAMA201",104,0)
 ; next appointment is found, the requested fields for that next
"RTN","SDAMA201",105,0)
 ; appointment will be retrieved and put into: 
"RTN","SDAMA201",106,0)
 ; ^TMP($J,"SDAMA201","NEXTAPPT")
"RTN","SDAMA201",107,0)
 ;
"RTN","SDAMA201",108,0)
 ;INPUT
"RTN","SDAMA201",109,0)
 ;  SDPATIEN     Patient IEN (required)
"RTN","SDAMA201",110,0)
 ;  SDFIELDS     Fields requested (optional)
"RTN","SDAMA201",111,0)
 ;  SDAPSTAT     Appointment status filter (optional)
"RTN","SDAMA201",112,0)
 ;  SDIOSTAT     Patient status filter (optional)
"RTN","SDAMA201",113,0)
 ;
"RTN","SDAMA201",114,0)
 ;OUTPUT
"RTN","SDAMA201",115,0)
 ;  -1: error
"RTN","SDAMA201",116,0)
 ;   0: no future appointment
"RTN","SDAMA201",117,0)
 ;   1: future appointment exists
"RTN","SDAMA201",118,0)
 ;
"RTN","SDAMA201",119,0)
 ;  If "1" is returned and the user has requested fields in the 
"RTN","SDAMA201",120,0)
 ;  SDFIELDS  parameter, the following global is populated:
"RTN","SDAMA201",121,0)
 ;  ^TMP($J,"SDAMA201","NEXTAPPT",Y)=FieldYdata
"RTN","SDAMA201",122,0)
 ;  where "Y" is the field number requested
"RTN","SDAMA201",123,0)
 ;  
"RTN","SDAMA201",124,0)
 ;*****************************************************************
"RTN","SDAMA201",125,0)
 N SDAPINAM,SDRTNNAM,SDERRFLG,SDSTART,SDRESULT
"RTN","SDAMA201",126,0)
 S SDAPINAM="NEXTAPPT",SDRTNNAM="SDAMA201",SDRESULT=0,SDERRFLG=0
"RTN","SDAMA201",127,0)
 K ^TMP($J,SDRTNNAM,SDAPINAM)
"RTN","SDAMA201",128,0)
 ;
"RTN","SDAMA201",129,0)
 ;Validate input parameters
"RTN","SDAMA201",130,0)
 S SDRESULT=$$VALIDATE^SDAMA200(.SDPATIEN,.SDFIELDS,.SDAPSTAT,,,SDAPINAM,SDRTNNAM,.SDIOSTAT)
"RTN","SDAMA201",131,0)
 I SDRESULT=-1 Q -1
"RTN","SDAMA201",132,0)
 ;
"RTN","SDAMA201",133,0)
 ;if the patient has no appointments on ^DPT, quit and pass back 0
"RTN","SDAMA201",134,0)
 I '$$PATAPPT^SDAMA200(SDPATIEN) S SDRESULT=0 Q SDRESULT
"RTN","SDAMA201",135,0)
 ;
"RTN","SDAMA201",136,0)
 ;Get current date/time
"RTN","SDAMA201",137,0)
 D NOW^%DTC
"RTN","SDAMA201",138,0)
 S SDSTART=$E(%,1,12)
"RTN","SDAMA201",139,0)
 ;
"RTN","SDAMA201",140,0)
 ;IF RSA DATABASE AVAILABLE, GET APPOINTMENT DATA FROM RSA DATABASE
"RTN","SDAMA201",141,0)
 ;I $$GOTS^SDAMA100(SDRTNNAM,SDAPINAM) D  Q SDRESULT
"RTN","SDAMA201",142,0)
 ;. ;Insert GOTS code here...
"RTN","SDAMA201",143,0)
 ;. Q
"RTN","SDAMA201",144,0)
 ;
"RTN","SDAMA201",145,0)
 ;GET NEXT APPOINTMENT DATA ON VISTA
"RTN","SDAMA201",146,0)
 N SDAPPTDT,SDPIECE,SDFIELD,SDDATA,SDMCODE,SDFOUND,SDMATCH,SDASTAT,SDNEXT,SDPSTAT
"RTN","SDAMA201",147,0)
 S (SDPIECE,SDAPPTDT,SDFIELD,SDFOUND,SDNEXT)=0,SDAPPTDT=SDSTART,SDDATA="",SDMCODE=""
"RTN","SDAMA201",148,0)
 ;get next appointment
"RTN","SDAMA201",149,0)
 F  S SDAPPTDT=$O(^DPT(SDPATIEN,"S",SDAPPTDT)) D  Q:((+$G(SDAPPTDT)=0)!SDFOUND)
"RTN","SDAMA201",150,0)
 . Q:$G(SDAPPTDT)=""
"RTN","SDAMA201",151,0)
 . S SDNEXT=0
"RTN","SDAMA201",152,0)
 . ;Get appointment status and patient status
"RTN","SDAMA201",153,0)
 . S SDASTAT=$$GETASTAT^SDAMA200(SDPATIEN,SDAPPTDT)
"RTN","SDAMA201",154,0)
 . S SDPSTAT=$$GETPSTAT^SDAMA200(SDPATIEN,SDAPPTDT)
"RTN","SDAMA201",155,0)
 . ;apply patient status filter
"RTN","SDAMA201",156,0)
 . I SDIOSTAT'[SDPSTAT S SDNEXT=1
"RTN","SDAMA201",157,0)
 . Q:SDNEXT=1
"RTN","SDAMA201",158,0)
 . ;apply appointment status filter
"RTN","SDAMA201",159,0)
 . I SDAPSTAT'[(";"_SDASTAT_";") S SDFOUND=0,SDNEXT=1
"RTN","SDAMA201",160,0)
 . Q:SDNEXT=1
"RTN","SDAMA201",161,0)
 . S SDFOUND=1
"RTN","SDAMA201",162,0)
 ;
"RTN","SDAMA201",163,0)
 ;If an appt was found and the user wants data returned, get fields requested
"RTN","SDAMA201",164,0)
 I SDFOUND,$G(SDFIELDS) D
"RTN","SDAMA201",165,0)
 . ;set patient status to null if appointment status is No-Show, Cancelled, or NT
"RTN","SDAMA201",166,0)
 . I ";N;C;NT;"[(";"_SDASTAT_";") S SDPSTAT=""
"RTN","SDAMA201",167,0)
 . ;get clinic IEN and SDDA node; used when retrieving appt fields located on ^SC
"RTN","SDAMA201",168,0)
 . S SDCLIEN=$$GETCLIEN^SDAMA200(SDPATIEN,SDAPPTDT)
"RTN","SDAMA201",169,0)
 . S SDPATCNT=$$GETSDDA^SDAMA200($G(SDCLIEN),SDAPPTDT,SDPATIEN)
"RTN","SDAMA201",170,0)
 . ;spin through the requested field numbers
"RTN","SDAMA201",171,0)
 . F SDPIECE=1:1 S SDFIELD=$P($G(SDFIELDS),";",SDPIECE) Q:SDFIELD=""  D
"RTN","SDAMA201",172,0)
 .. ;get MUMPS code for the requested field number. Execute. Put result in ^TMP
"RTN","SDAMA201",173,0)
 .. S SDMCODE=$G(^SDAM(44.3,SDFIELD,1)) X SDMCODE
"RTN","SDAMA201",174,0)
 .. S ^TMP($J,SDRTNNAM,SDAPINAM,SDFIELD)=$G(SDDATA)
"RTN","SDAMA201",175,0)
 .. Q
"RTN","SDAMA201",176,0)
 . Q
"RTN","SDAMA201",177,0)
 ;clean up data map variable
"RTN","SDAMA201",178,0)
 K SDDATA
"RTN","SDAMA201",179,0)
 Q SDFOUND
"RTN","SDAMA202")
0^2^B15446167
"RTN","SDAMA202",1,0)
SDAMA202 ;BPOIFO/ACS-Scheduling Replacement APIs ;16 Sept 2003
"RTN","SDAMA202",2,0)
 ;;5.3;Scheduling;**253,275,283,316**;13 Aug 1993
"RTN","SDAMA202",3,0)
 ;
"RTN","SDAMA202",4,0)
 ;GETPLIST - Returns appointment information for a clinic
"RTN","SDAMA202",5,0)
 ;
"RTN","SDAMA202",6,0)
 ;**   BEFORE USING THE API IN THIS ROUTINE, PLEASE SUBSCRIBE      **
"RTN","SDAMA202",7,0)
 ;**   TO DBIA #3869                                               **
"RTN","SDAMA202",8,0)
 ;
"RTN","SDAMA202",9,0)
 ;*******************************************************************
"RTN","SDAMA202",10,0)
 ;              CHANGE LOG
"RTN","SDAMA202",11,0)
 ;
"RTN","SDAMA202",12,0)
 ;  DATE      PATCH       DESCRIPTION
"RTN","SDAMA202",13,0)
 ;--------  ----------    -----------------------------------------
"RTN","SDAMA202",14,0)
 ;09/20/02  SD*5.3*253    ROUTINE COMPLETED
"RTN","SDAMA202",15,0)
 ;12/10/02  SD*5.3*275    ADDED PATIENT STATUS FILTER
"RTN","SDAMA202",16,0)
 ;07/03/03  SD*5.3*283    REMOVED 'NO ACTION TAKEN' EDIT.  REMOVED
"RTN","SDAMA202",17,0)
 ;                        'GETALLCL' API
"RTN","SDAMA202",18,0)
 ;09/16/03  SD*5.3*316    EXCLUDE 'CANCELLED' APPTS.  CHECK FOR 
"RTN","SDAMA202",19,0)
 ;                        CLINIC MATCH ON ^DPT
"RTN","SDAMA202",20,0)
 ;
"RTN","SDAMA202",21,0)
 ;********************************************************************  
"RTN","SDAMA202",22,0)
 ;
"RTN","SDAMA202",23,0)
GETPLIST(SDCLIEN,SDFIELDS,SDAPSTAT,SDSTART,SDEND,SDRESULT,SDIOSTAT) ;
"RTN","SDAMA202",24,0)
 ;********************************************************************
"RTN","SDAMA202",25,0)
 ;
"RTN","SDAMA202",26,0)
 ;               GET APPOINTMENTS FOR A CLINIC
"RTN","SDAMA202",27,0)
 ;
"RTN","SDAMA202",28,0)
 ;INPUT
"RTN","SDAMA202",29,0)
 ;  SDCLIEN      Clinic IEN (required) 
"RTN","SDAMA202",30,0)
 ;  SDFIELDS     Fields requested (optional)
"RTN","SDAMA202",31,0)
 ;  SDAPSTAT     Appointment Status filter (optional)
"RTN","SDAMA202",32,0)
 ;  SDSTART      Start date/time (optional)
"RTN","SDAMA202",33,0)
 ;  SDEND        End date/time (optional)
"RTN","SDAMA202",34,0)
 ;  SDRESULT     Record count returned here (optional)
"RTN","SDAMA202",35,0)
 ;  SDIOSTAT     Patient Status filter (optional)
"RTN","SDAMA202",36,0)
 ;  
"RTN","SDAMA202",37,0)
 ;OUTPUT
"RTN","SDAMA202",38,0)
 ;  ^TMP($J,"SDAMA202","GETPLIST",X,Y)=FieldYdata
"RTN","SDAMA202",39,0)
 ;  where "X" is an incremental appointment counter and
"RTN","SDAMA202",40,0)
 ;  "Y" is the field number requested
"RTN","SDAMA202",41,0)
 ;  
"RTN","SDAMA202",42,0)
 ;
"RTN","SDAMA202",43,0)
 ;********************************************************************
"RTN","SDAMA202",44,0)
 N SDAPINAM,SDRTNNAM
"RTN","SDAMA202",45,0)
 S SDAPINAM="GETPLIST",SDRTNNAM="SDAMA202",SDRESULT=0
"RTN","SDAMA202",46,0)
 K ^TMP($J,SDRTNNAM,SDAPINAM)
"RTN","SDAMA202",47,0)
 S SDRESULT=$$VALIDATE^SDAMA200(.SDCLIEN,.SDFIELDS,.SDAPSTAT,.SDSTART,.SDEND,SDAPINAM,SDRTNNAM,.SDIOSTAT)
"RTN","SDAMA202",48,0)
 I SDRESULT=-1 Q
"RTN","SDAMA202",49,0)
 ;
"RTN","SDAMA202",50,0)
 ;if the clinic has no appointments on ^SC, quit
"RTN","SDAMA202",51,0)
 I '$$CLNAPPT^SDAMA200(SDCLIEN) S SDRESULT=0 Q
"RTN","SDAMA202",52,0)
 ;
"RTN","SDAMA202",53,0)
 ;Set up start and end date/times
"RTN","SDAMA202",54,0)
 S SDSTART=$S($G(SDSTART):(SDSTART-.0001),1:0)
"RTN","SDAMA202",55,0)
 S SDEND=$S($G(SDEND):SDEND,1:"9999999.9999")
"RTN","SDAMA202",56,0)
 I SDEND'["." S SDEND=SDEND_".9999"
"RTN","SDAMA202",57,0)
 ;
"RTN","SDAMA202",58,0)
 ;IF RSA DATABASE AVAILABLE, GET APPOINTMENT DATA FROM RSA DATABASE
"RTN","SDAMA202",59,0)
 ;I $$GOTS^SDAMA100(SDRTNNAM,SDAPINAM) D  Q SDRESULT
"RTN","SDAMA202",60,0)
 ;. ;Insert GOTS code here...
"RTN","SDAMA202",61,0)
 ;. Q
"RTN","SDAMA202",62,0)
 ;
"RTN","SDAMA202",63,0)
 N SDAPPTDT,SDPIECE,SDRECNUM,SDFIELD,SDDATA,SDPATCNT,SDMCODE,SDPATIEN,SDNEXT,SDASTAT,SDPSTAT
"RTN","SDAMA202",64,0)
 S (SDPIECE,SDRECNUM,SDAPPTDT,SDFIELD,SDPATCNT,SDNEXT)=0,SDDATA="",SDMCODE=""
"RTN","SDAMA202",65,0)
 S SDRECNUM=0
"RTN","SDAMA202",66,0)
 S SDAPPTDT=SDSTART
"RTN","SDAMA202",67,0)
 ; find each appointment date/time for this clinic
"RTN","SDAMA202",68,0)
 F  S SDAPPTDT=$O(^SC(SDCLIEN,"S",SDAPPTDT)) Q:$S(+$G(SDAPPTDT)=0:1,SDAPPTDT>SDEND:1,1:0)  D
"RTN","SDAMA202",69,0)
 . ;find all patients in this clinic for this appointment date/time
"RTN","SDAMA202",70,0)
 . S SDPATCNT=0
"RTN","SDAMA202",71,0)
 . F  S SDPATCNT=$O(^SC(SDCLIEN,"S",SDAPPTDT,1,SDPATCNT)) Q:SDPATCNT=""  D
"RTN","SDAMA202",72,0)
 .. ;exclude cancelled appointments on ^SC
"RTN","SDAMA202",73,0)
 .. I $P($G(^SC(SDCLIEN,"S",SDAPPTDT,1,SDPATCNT,0)),"^",9)="C" Q
"RTN","SDAMA202",74,0)
 .. S SDNEXT=0
"RTN","SDAMA202",75,0)
 .. S SDPATIEN=$$GETPTIEN^SDAMA200(SDCLIEN,SDAPPTDT,SDPATCNT)
"RTN","SDAMA202",76,0)
 .. ;compare clinic to DPT clinic; exclude appointment if not same
"RTN","SDAMA202",77,0)
 .. I +$G(^DPT(SDPATIEN,"S",SDAPPTDT,0))'=SDCLIEN Q
"RTN","SDAMA202",78,0)
 .. ;Get appt status and patient status
"RTN","SDAMA202",79,0)
 .. S SDASTAT=$$GETASTAT^SDAMA200(SDPATIEN,SDAPPTDT)
"RTN","SDAMA202",80,0)
 .. S SDPSTAT=$$GETPSTAT^SDAMA200(SDPATIEN,SDAPPTDT)
"RTN","SDAMA202",81,0)
 .. ;exclude cancelled appointments on ^DPT
"RTN","SDAMA202",82,0)
 .. I SDASTAT="C" Q
"RTN","SDAMA202",83,0)
 .. ;apply patient status filter
"RTN","SDAMA202",84,0)
 .. I SDIOSTAT'[SDPSTAT S SDNEXT=1
"RTN","SDAMA202",85,0)
 .. Q:SDNEXT=1
"RTN","SDAMA202",86,0)
 .. ;apply appointment status filter
"RTN","SDAMA202",87,0)
 .. I SDAPSTAT'[(";"_SDASTAT_";") S SDNEXT=1
"RTN","SDAMA202",88,0)
 .. Q:SDNEXT=1
"RTN","SDAMA202",89,0)
 .. ;set patient status to null if appointment status is No-Show, Cancelled, or NT
"RTN","SDAMA202",90,0)
 .. I ";N;C;NT;"[(";"_SDASTAT_";") S SDPSTAT=""
"RTN","SDAMA202",91,0)
 .. S SDRECNUM=SDRECNUM+1
"RTN","SDAMA202",92,0)
 .. ;spin through the requested field numbers
"RTN","SDAMA202",93,0)
 .. F SDPIECE=1:1 S SDFIELD=$P(SDFIELDS,";",SDPIECE) Q:SDFIELD=""  D
"RTN","SDAMA202",94,0)
 ... ;get MUMPS code for the requested field number. Execute. Put result in ^TMP
"RTN","SDAMA202",95,0)
 ... S SDMCODE=$G(^SDAM(44.3,SDFIELD,1)) X SDMCODE
"RTN","SDAMA202",96,0)
 ... S ^TMP($J,SDRTNNAM,SDAPINAM,SDRECNUM,SDFIELD)=$G(SDDATA)
"RTN","SDAMA202",97,0)
 ... Q
"RTN","SDAMA202",98,0)
 .. Q
"RTN","SDAMA202",99,0)
 . Q
"RTN","SDAMA202",100,0)
 ;clean up data map variable and pass back appointment count
"RTN","SDAMA202",101,0)
 K SDDATA
"RTN","SDAMA202",102,0)
 S SDRESULT=SDRECNUM
"RTN","SDAMA202",103,0)
 Q
"VER")
8.0^22.0
**END**
**END**
