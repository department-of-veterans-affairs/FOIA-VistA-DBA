Released PSB*2*22 SEQ #29
Extracted from mail message
**KIDS**:PSB*2.0*22^

**INSTALL NAME**
PSB*2.0*22
"BLD",4309,0)
PSB*2.0*22^BAR CODE MED ADMIN^0^3030916^y
"BLD",4309,1,0)
^^17^17^3030715^
"BLD",4309,1,1,0)
1. Problem: The Missed Medications [PSBO MM] option does not display a 
"BLD",4309,1,2,0)
   One-Time order for the new ward after a patient is transferred to
"BLD",4309,1,3,0)
   another ward.
"BLD",4309,1,4,0)
 
"BLD",4309,1,5,0)
   Corrective Action: The Missed Medications [PSBO MM] option displays a 
"BLD",4309,1,6,0)
   One-Time order after a patient is transferred to another ward.
"BLD",4309,1,7,0)
 
"BLD",4309,1,8,0)
2. Problem: The Missed Medications [PSBO MM] option displays "(Hold)"
"BLD",4309,1,9,0)
   next to a medication when a Provider places it on Hold. When the 
"BLD",4309,1,10,0)
   Provider takes if Off Hold, no verbiage is displayed next to the 
"BLD",4309,1,11,0)
   medication.
"BLD",4309,1,12,0)
 
"BLD",4309,1,13,0)
   Corrective Action: The Missed Medications [PSBO MM] option displays 
"BLD",4309,1,14,0)
   "(On Hold)" date and time below a medication when the Provider places
"BLD",4309,1,15,0)
   it on Hold. When the Provider takes if off Hold, it displays the
"BLD",4309,1,16,0)
   "(On Hold)" date and time as well as the "(Off Hold)": date and time
"BLD",4309,1,17,0)
   below the medication.
"BLD",4309,4,0)
^9.64PA^^
"BLD",4309,"ABPKG")
n
"BLD",4309,"KRN",0)
^9.67PA^8989.52^19
"BLD",4309,"KRN",.4,0)
.4
"BLD",4309,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4309,"KRN",.401,0)
.401
"BLD",4309,"KRN",.402,0)
.402
"BLD",4309,"KRN",.403,0)
.403
"BLD",4309,"KRN",.5,0)
.5
"BLD",4309,"KRN",.84,0)
.84
"BLD",4309,"KRN",3.6,0)
3.6
"BLD",4309,"KRN",3.8,0)
3.8
"BLD",4309,"KRN",9.2,0)
9.2
"BLD",4309,"KRN",9.8,0)
9.8
"BLD",4309,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4309,"KRN",9.8,"NM",1,0)
PSBOMM^^0^B86025235
"BLD",4309,"KRN",9.8,"NM","B","PSBOMM",1)

"BLD",4309,"KRN",19,0)
19
"BLD",4309,"KRN",19,"NM",0)
^9.68A^^
"BLD",4309,"KRN",19.1,0)
19.1
"BLD",4309,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4309,"KRN",101,0)
101
"BLD",4309,"KRN",409.61,0)
409.61
"BLD",4309,"KRN",771,0)
771
"BLD",4309,"KRN",870,0)
870
"BLD",4309,"KRN",8989.51,0)
8989.51
"BLD",4309,"KRN",8989.52,0)
8989.52
"BLD",4309,"KRN",8994,0)
8994
"BLD",4309,"KRN","B",.4,.4)

"BLD",4309,"KRN","B",.401,.401)

"BLD",4309,"KRN","B",.402,.402)

"BLD",4309,"KRN","B",.403,.403)

"BLD",4309,"KRN","B",.5,.5)

"BLD",4309,"KRN","B",.84,.84)

"BLD",4309,"KRN","B",3.6,3.6)

"BLD",4309,"KRN","B",3.8,3.8)

"BLD",4309,"KRN","B",9.2,9.2)

"BLD",4309,"KRN","B",9.8,9.8)

"BLD",4309,"KRN","B",19,19)

"BLD",4309,"KRN","B",19.1,19.1)

"BLD",4309,"KRN","B",101,101)

"BLD",4309,"KRN","B",409.61,409.61)

"BLD",4309,"KRN","B",771,771)

"BLD",4309,"KRN","B",870,870)

"BLD",4309,"KRN","B",8989.51,8989.51)

"BLD",4309,"KRN","B",8989.52,8989.52)

"BLD",4309,"KRN","B",8994,8994)

"BLD",4309,"QUES",0)
^9.62^^
"BLD",4309,"REQB",0)
^9.611^1^1
"BLD",4309,"REQB",1,0)
PSB*2.0*6^1
"BLD",4309,"REQB","B","PSB*2.0*6",1)

"MBREQ")
0
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
2.0^3020514^3020719^11874
"PKG",536,22,1,"PAH",1,0)
22^3030916^10000000007
"PKG",536,22,1,"PAH",1,1,0)
^^17^17^3030916
"PKG",536,22,1,"PAH",1,1,1,0)
1. Problem: The Missed Medications [PSBO MM] option does not display a 
"PKG",536,22,1,"PAH",1,1,2,0)
   One-Time order for the new ward after a patient is transferred to
"PKG",536,22,1,"PAH",1,1,3,0)
   another ward.
"PKG",536,22,1,"PAH",1,1,4,0)
 
"PKG",536,22,1,"PAH",1,1,5,0)
   Corrective Action: The Missed Medications [PSBO MM] option displays a 
"PKG",536,22,1,"PAH",1,1,6,0)
   One-Time order after a patient is transferred to another ward.
"PKG",536,22,1,"PAH",1,1,7,0)
 
"PKG",536,22,1,"PAH",1,1,8,0)
2. Problem: The Missed Medications [PSBO MM] option displays "(Hold)"
"PKG",536,22,1,"PAH",1,1,9,0)
   next to a medication when a Provider places it on Hold. When the 
"PKG",536,22,1,"PAH",1,1,10,0)
   Provider takes if Off Hold, no verbiage is displayed next to the 
"PKG",536,22,1,"PAH",1,1,11,0)
   medication.
"PKG",536,22,1,"PAH",1,1,12,0)
 
"PKG",536,22,1,"PAH",1,1,13,0)
   Corrective Action: The Missed Medications [PSBO MM] option displays 
"PKG",536,22,1,"PAH",1,1,14,0)
   "(On Hold)" date and time below a medication when the Provider places
"PKG",536,22,1,"PAH",1,1,15,0)
   it on Hold. When the Provider takes if off Hold, it displays the
"PKG",536,22,1,"PAH",1,1,16,0)
   "(On Hold)" date and time as well as the "(Off Hold)": date and time
"PKG",536,22,1,"PAH",1,1,17,0)
   below the medication.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSBOMM")
0^1^B86025235
"RTN","PSBOMM",1,0)
PSBOMM ;BIRMINGHAM/EFC-MISSED MEDS ;May 2002
"RTN","PSBOMM",2,0)
 ;;2.0;BAR CODE MED ADMIN;**1,6,22**;May 2002
"RTN","PSBOMM",3,0)
 ;
"RTN","PSBOMM",4,0)
 ; Reference/IA
"RTN","PSBOMM",5,0)
 ; ^DPT/10035
"RTN","PSBOMM",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMM",7,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBOMM",8,0)
 ;
"RTN","PSBOMM",9,0)
EN ; Called from DQ^PSBO
"RTN","PSBOMM",10,0)
 N PSBSTRT,PSBSTOP,DFN,PSBODATE,PSBFLAG,PSBCNT
"RTN","PSBOMM",11,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSB1",$J)
"RTN","PSBOMM",12,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)-.0000001
"RTN","PSBOMM",13,0)
 S PSBSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMM",14,0)
 S PSBODATE=$P(PSBRPT(.1),U,6)
"RTN","PSBOMM",15,0)
 F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,DFN)) Q:'DFN  D EN1
"RTN","PSBOMM",16,0)
 D PRINT
"RTN","PSBOMM",17,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J)
"RTN","PSBOMM",18,0)
 Q
"RTN","PSBOMM",19,0)
 ;
"RTN","PSBOMM",20,0)
EN1 ; Expects DFN,PSBSTRT,PSBSTOP from EN
"RTN","PSBOMM",21,0)
 N PSBGBL,PSBHDR,PSBX,PSBDFN,PSBDT,PSBEVDT,PSBHOUR
"RTN","PSBOMM",22,0)
 K ^TMP("PSJ",$J) S PSBEVDT=PSBSTRT
"RTN","PSBOMM",23,0)
 D EN^PSJBCMA(DFN,PSBSTRT)
"RTN","PSBOMM",24,0)
 Q:^TMP("PSJ",$J,1,0)=-1
"RTN","PSBOMM",25,0)
 S PSBX=""
"RTN","PSBOMM",26,0)
 F  S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:PSBX=""  D
"RTN","PSBOMM",27,0)
 .Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOMM",28,0)
 .D CLEAN^PSBVT
"RTN","PSBOMM",29,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBOMM",30,0)
 .Q:PSBIVT="A"  ; No Admix or Hyp.
"RTN","PSBOMM",31,0)
 .Q:PSBIVT="H"
"RTN","PSBOMM",32,0)
 .I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOMM",33,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOMM",34,0)
 .I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOMM",35,0)
 .Q:PSBONX["P"  ;no pending orders
"RTN","PSBOMM",36,0)
 .I PSBSCHT="C" D  Q  ; Only Continuous
"RTN","PSBOMM",37,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBOMM",38,0)
 ..S PSBDOW="SU^MO^TU^WE^TH^FR^SA" F I=1:1:7 I $P(PSBDOW,"^",I)=$E(PSBSCH,1,2) S PSBYES=1
"RTN","PSBOMM",39,0)
 ..I PSBYES,PSBADST="" Q
"RTN","PSBOMM",40,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOMM",41,0)
 ..S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOMM",42,0)
 ..I PSBFREQ="O" S PSBYES=1
"RTN","PSBOMM",43,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBOMM",44,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOMM",45,0)
 ..I PSBODD,PSBADST'="" Q
"RTN","PSBOMM",46,0)
 ..Q:PSBOSTS["D"  ;Discontinued
"RTN","PSBOMM",47,0)
 ..Q:PSBNGF  ; Marked DO NOT GIVE
"RTN","PSBOMM",48,0)
 ..Q:PSBOSTS="N"
"RTN","PSBOMM",49,0)
 ..Q:PSBSM  ;Self med
"RTN","PSBOMM",50,0)
 ..S PSBCADM=0
"RTN","PSBOMM",51,0)
 ..I PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT) Q:PSBADST=""  S PSBCADM=1
"RTN","PSBOMM",52,0)
 ..E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOMM",53,0)
 ..;Invalid admin times
"RTN","PSBOMM",54,0)
 ..F Y=1:1:$L(PSBADST,"-") D
"RTN","PSBOMM",55,0)
 ...Q:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOMM",56,0)
 ..; Below is (Order Start Date, Report Date, Schedule)
"RTN","PSBOMM",57,0)
 ..Q:'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,$P(^TMP("PSJ",$J,PSBX,3),U,2),PSBFREQ,PSBOSTS)  ; Screens QOD type stuff
"RTN","PSBOMM",58,0)
 ..K PSBOACTL,TMP("PSB1",$J) D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 D
"RTN","PSBOMM",59,0)
 ...M PSBOACTL=^TMP("PSJ2",$J) K ^TMP("PSJ2",$J)
"RTN","PSBOMM",60,0)
 ..F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOMM",61,0)
 ...F Y=1:1:$L(PSBADST,"-") D
"RTN","PSBOMM",62,0)
 ....S PSBDT=+("."_$P(PSBADST,"-",Y))+(PSBSTRT\1)
"RTN","PSBOMM",63,0)
 ....Q:PSBDT<PSBOST  ; Order Start Date
"RTN","PSBOMM",64,0)
 ....Q:PSBDT'<PSBOSP  ; Order Stop Date
"RTN","PSBOMM",65,0)
 ....Q:PSBDT<PSBSTRT  ; Report Window
"RTN","PSBOMM",66,0)
 ....Q:PSBDT>PSBSTOP  ; Report Window
"RTN","PSBOMM",67,0)
 ....I $D(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT)) D  I PSBSTUS'="N",PSBSTUS'="M" Q  ; If it is on the log quit continue if status is "NOT GIVEN" or "MISSING"
"RTN","PSBOMM",68,0)
 .....S PSBINDX=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT,"")),PSBSTUS=$P(^PSB(53.79,PSBINDX,0),U,9)
"RTN","PSBOMM",69,0)
 ....S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)=""
"RTN","PSBOMM",70,0)
 ....D UDCONT
"RTN","PSBOMM",71,0)
 ....I PSBFLAG=1 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)
"RTN","PSBOMM",72,0)
 ....I PSBFLAG=2 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)_"  "_"(Off Hold) "_$$FMTE^XLFDT(PSBUNHD) Q
"RTN","PSBOMM",73,0)
 .K PSBHDDT,PSBUNHD,^TMP("PSB1",$J)
"RTN","PSBOMM",74,0)
 .I PSBSCHT="O" D  Q
"RTN","PSBOMM",75,0)
 ..Q:PSBOSTS["D"!(PSBOSTS="N")  ; Discontinued
"RTN","PSBOMM",76,0)
 ..Q:PSBNGF  ; Marked DO NOT GIVE
"RTN","PSBOMM",77,0)
 ..Q:PSBSM  ;Self med
"RTN","PSBOMM",78,0)
 ..; Is the One Time Given?
"RTN","PSBOMM",79,0)
 ..Q:PSBOSP=PSBOST   ;Expired one-time
"RTN","PSBOMM",80,0)
 ..Q:PSBOST'<PSBSTOP
"RTN","PSBOMM",81,0)
 ..Q:PSBOSP<PSBSTRT
"RTN","PSBOMM",82,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBOMM",83,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBOMM",84,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBOMM",85,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)'="N",$P(^PSB(53.79,Y,0),U,9)'="M" S PSBGVN=1,(X,Y)=0
"RTN","PSBOMM",86,0)
 ..; How long does One Time remain on the this report ??
"RTN","PSBOMM",87,0)
 ..D NOW^%DTC
"RTN","PSBOMM",88,0)
 ..S PSBRMN=1
"RTN","PSBOMM",89,0)
 ..I PSBSCHT="O",PSBOSP'=PSBOST&(%>PSBOSP) S PSBRMN=0
"RTN","PSBOMM",90,0)
 ..D:('PSBGVN)&(PSBRMN)
"RTN","PSBOMM",91,0)
 ...S VAR=""
"RTN","PSBOMM",92,0)
 ...K ^TMP("PSJ2",$J),^TMP("PSB1",$J),PSBOACTL D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 D
"RTN","PSBOMM",93,0)
 ....M PSBOACTL=^TMP("PSJ2",$J)
"RTN","PSBOMM",94,0)
 ....D UDONE
"RTN","PSBOMM",95,0)
 ....I PSBFLAG=1 S VAR="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)
"RTN","PSBOMM",96,0)
 ....I PSBFLAG=2 S VAR="(On Hold) "_$$FMTE^XLFDT(PSBHDDT)_"  (Off Hold) "_$$FMTE^XLFDT(PSBUNHD)
"RTN","PSBOMM",97,0)
 ...S VAR=VAR_U_$TR($$FMTE^XLFDT(PSBOST,2),"@"," ")
"RTN","PSBOMM",98,0)
 ...S VAR=VAR_U_$TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")
"RTN","PSBOMM",99,0)
 ...S $P(^TMP("PSB",$J,DFN,"*** ONE-TIME ***",PSBOITX,PSBONX),U,1,4)=VAR
"RTN","PSBOMM",100,0)
 ...K PSBHDDT,PSBUNHD,^TMP("PSB1",$J),PSBCNT
"RTN","PSBOMM",101,0)
 K PSBOACTL
"RTN","PSBOMM",102,0)
 Q
"RTN","PSBOMM",103,0)
 ;
"RTN","PSBOMM",104,0)
PRINT ; Print meds stored in ^TMP("PSB",$J,DFN,....
"RTN","PSBOMM",105,0)
 N PSBHDR,PSBDT,PSBOITX,PSBONX,DFN
"RTN","PSBOMM",106,0)
 ;
"RTN","PSBOMM",107,0)
 ; Print by Patient
"RTN","PSBOMM",108,0)
 ;
"RTN","PSBOMM",109,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOMM",110,0)
 .S PSBHDR(1)="MISSED MEDICATIONS  from "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" thru "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9))
"RTN","PSBOMM",111,0)
 .S DFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOMM",112,0)
 .W $$PTHDR()
"RTN","PSBOMM",113,0)
 .I $O(^TMP("PSB",$J,DFN,""))="" D  Q
"RTN","PSBOMM",114,0)
 ..W !,"No Missed Medications Found"
"RTN","PSBOMM",115,0)
 ..W $$PTFTR^PSBOHDR()
"RTN","PSBOMM",116,0)
 .S PSBDT=""
"RTN","PSBOMM",117,0)
 .F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",118,0)
 ..W !  ; Line Break Between Admin Times
"RTN","PSBOMM",119,0)
 ..S PSBOITX=""
"RTN","PSBOMM",120,0)
 ..F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",121,0)
 ...S PSBONX=""
"RTN","PSBOMM",122,0)
 ...F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",123,0)
 ....I $Y>(IOSL-5) W $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOMM",124,0)
 ....W !,+PSBONX,$S(PSBONX["U":"UD",PSBONX["V":"IV",1:"")
"RTN","PSBOMM",125,0)
 ....I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",126,0)
 .....W ?12,PSBDT,?38,PSBOITX
"RTN","PSBOMM",127,0)
 .....W !,?38,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,1)
"RTN","PSBOMM",128,0)
 .....W !,"Start Date/Time: ",?16,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,2)
"RTN","PSBOMM",129,0)
 .....W !,"Stop Date/Time:  ",?16,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,3)
"RTN","PSBOMM",130,0)
 .....W !
"RTN","PSBOMM",131,0)
 ....W ?12,$S(PSBDT:$$FMTE^XLFDT(PSBDT),1:PSBDT),?38,PSBOITX
"RTN","PSBOMM",132,0)
 ....W !,?38,^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)
"RTN","PSBOMM",133,0)
 .W $$PTFTR^PSBOHDR()
"RTN","PSBOMM",134,0)
 .Q
"RTN","PSBOMM",135,0)
 ;
"RTN","PSBOMM",136,0)
 ; Print by Ward
"RTN","PSBOMM",137,0)
 ;
"RTN","PSBOMM",138,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBOMM",139,0)
 .S PSBHDR(1)="MISSED MEDICATIONS  from "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" thru "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9))
"RTN","PSBOMM",140,0)
 .S PSBWARD=$P(PSBRPT(.1),U,3)
"RTN","PSBOMM",141,0)
 .W $$WRDHDR()
"RTN","PSBOMM",142,0)
 .I '$O(^TMP("PSB",$J,0)) D  Q
"RTN","PSBOMM",143,0)
 ..W !,"No Missed Medications Found"
"RTN","PSBOMM",144,0)
 .S PSBSORT=$P(PSBRPT(.1),U,5)
"RTN","PSBOMM",145,0)
 .F DFN=0:0 S DFN=$O(^TMP("PSB",$J,DFN)) Q:'DFN  D
"RTN","PSBOMM",146,0)
 ..S PSBINDX=$S(PSBSORT="P":$P(^DPT(DFN,0),U),1:$G(^DPT(DFN,.1))_" "_$G(^(.101)))
"RTN","PSBOMM",147,0)
 ..S:PSBINDX="" PSBINDX=$P(^DPT(DFN,0),U)
"RTN","PSBOMM",148,0)
 ..S ^TMP("PSB",$J,"B",PSBINDX,DFN)=""
"RTN","PSBOMM",149,0)
 .S PSBINDX=""
"RTN","PSBOMM",150,0)
 .F  S PSBINDX=$O(^TMP("PSB",$J,"B",PSBINDX)) Q:PSBINDX=""  D
"RTN","PSBOMM",151,0)
 ..F DFN=0:0 S DFN=$O(^TMP("PSB",$J,"B",PSBINDX,DFN)) Q:'DFN  D
"RTN","PSBOMM",152,0)
 ...W ! ; Line Break Between Pt's
"RTN","PSBOMM",153,0)
 ...S PSBDT=""
"RTN","PSBOMM",154,0)
 ...F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",155,0)
 ....W !  ; Line Break Between Admin Times
"RTN","PSBOMM",156,0)
 ....S PSBOITX=""
"RTN","PSBOMM",157,0)
 ....F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",158,0)
 .....S PSBONX=""
"RTN","PSBOMM",159,0)
 .....F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",160,0)
 ......I $Y>(IOSL-5) W $$WRDHDR()
"RTN","PSBOMM",161,0)
 ......W !,+PSBONX,$S(PSBONX["U":"UD",PSBONX["V":"IV",1:"")
"RTN","PSBOMM",162,0)
 ......W ?10,$G(^DPT(DFN,.101),"**")
"RTN","PSBOMM",163,0)
 ......W ?30,$P(^DPT(DFN,0),U)," (",$E($P(^(0),U,9),6,9),")"
"RTN","PSBOMM",164,0)
 ......I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",165,0)
 .......W !,PSBDT,?30,PSBOITX," ",$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,1)
"RTN","PSBOMM",166,0)
 .......W !,"Start Date/Time:  ",?30,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,2)
"RTN","PSBOMM",167,0)
 .......W !,"Stop Date/Time:  ",?30,$P(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX),U,3)
"RTN","PSBOMM",168,0)
 .......W !
"RTN","PSBOMM",169,0)
 ......W ?64,$S(PSBDT:$$FMTE^XLFDT(PSBDT,2),1:PSBDT),?80,PSBOITX
"RTN","PSBOMM",170,0)
 ......W " ",^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)
"RTN","PSBOMM",171,0)
 Q
"RTN","PSBOMM",172,0)
 ;
"RTN","PSBOMM",173,0)
WRDHDR() ; Ward Header
"RTN","PSBOMM",174,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR)
"RTN","PSBOMM",175,0)
 W !,"Ord Num",?10,"Room-Bed",?30,"Patient",?64,"Admin Date/Time",?80,"Medication"
"RTN","PSBOMM",176,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMM",177,0)
 Q ""
"RTN","PSBOMM",178,0)
 ;
"RTN","PSBOMM",179,0)
PTHDR() ; Patient Header
"RTN","PSBOMM",180,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBOMM",181,0)
 W !,"Order Num",?12,"Administration Date/Time",?38,"Medication"
"RTN","PSBOMM",182,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMM",183,0)
 Q ""
"RTN","PSBOMM",184,0)
 ;
"RTN","PSBOMM",185,0)
UDCONT ;
"RTN","PSBOMM",186,0)
 S PSBFLAG=0,J=1
"RTN","PSBOMM",187,0)
 K ^TMP("PSB1",$J)
"RTN","PSBOMM",188,0)
 F I=1:1:$P(PSBOACTL(0),U,4) D
"RTN","PSBOMM",189,0)
 . I $P($G(PSBOACTL(I,1)),U,4)["ON HOLD"!($P($G(PSBOACTL(I,1)),U,4)="HOLD") S ^TMP("PSB1",$J,DFN,J)="HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12)
"RTN","PSBOMM",190,0)
 . I $P($G(PSBOACTL(I,1)),U,4)["TAKEN OFF HOLD"!($P($G(PSBOACTL(I,1)),U,4)["UNHOLD") S $P(^TMP("PSB1",$J,DFN,J),U,3)="OFF HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12),J=J+1
"RTN","PSBOMM",191,0)
 D:$D(^TMP("PSB1",$J,DFN))&($P(PSBOACTL(0),U,4)'=1)
"RTN","PSBOMM",192,0)
 .S J=0 F  S J=$O(^TMP("PSB1",$J,DFN,J)) Q:'J  Q:PSBFLAG  D
"RTN","PSBOMM",193,0)
 ..S PSBHDDT=$P(^TMP("PSB1",$J,DFN,J),U,2)
"RTN","PSBOMM",194,0)
 ..S PSBHDST=$P(^TMP("PSB1",$J,DFN,J),U)
"RTN","PSBOMM",195,0)
 ..S PSBOFDT=$P(^TMP("PSB1",$J,DFN,J),U,4)
"RTN","PSBOMM",196,0)
 ..S PSBOFST=$P(^TMP("PSB1",$J,DFN,J),U,3)
"RTN","PSBOMM",197,0)
 ..I PSBDT>PSBHDDT,PSBHDST="HOLD",PSBOFST'="" D
"RTN","PSBOMM",198,0)
 ...I PSBDT<PSBOFDT,PSBOFST="OFF HOLD" S PSBFLAG=2,PSBUNHD=PSBOFDT
"RTN","PSBOMM",199,0)
 ..I PSBDT>PSBHDDT,PSBHDST="HOLD",PSBOFST="" S PSBFLAG=1
"RTN","PSBOMM",200,0)
 K PSBCNT,TMP("PSB1",$J)
"RTN","PSBOMM",201,0)
 Q
"RTN","PSBOMM",202,0)
 ;
"RTN","PSBOMM",203,0)
UDONE ;
"RTN","PSBOMM",204,0)
 S PSBFLAG=0,J=1
"RTN","PSBOMM",205,0)
 F I=1:1:$P(PSBOACTL(0),U,4) D
"RTN","PSBOMM",206,0)
 .I $P($G(PSBOACTL(I,1)),U,4)["ON HOLD"!($P($G(PSBOACTL(I,1)),U,4)="HOLD") S ^TMP("PSB1",$J,DFN,J)="HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12)
"RTN","PSBOMM",207,0)
 .I $P($G(PSBOACTL(I,1)),U,4)["TAKEN OFF HOLD"!($P($G(PSBOACTL(I,1)),U,4)["UNHOLD") S $P(^TMP("PSB1",$J,DFN,J),U,3)="OFF HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12),J=J+1
"RTN","PSBOMM",208,0)
 D:$D(^TMP("PSB1",$J,DFN))&($P(PSBOACTL(0),U,4)'=1)
"RTN","PSBOMM",209,0)
 .S J="" F  S J=$O(^TMP("PSB1",$J,DFN,J)) Q:'J  Q:PSBFLAG  D
"RTN","PSBOMM",210,0)
 ..S PSBHDDT=$P(^TMP("PSB1",$J,DFN,J),U,2)
"RTN","PSBOMM",211,0)
 ..S PSBHDST=$P(^TMP("PSB1",$J,DFN,J),U)
"RTN","PSBOMM",212,0)
 ..S PSBOFDT=$P(^TMP("PSB1",$J,DFN,J),U,4)
"RTN","PSBOMM",213,0)
 ..S PSBOFST=$P(^TMP("PSB1",$J,DFN,J),U,3)
"RTN","PSBOMM",214,0)
 ..I PSBOSTS="A",PSBHDST="HOLD",PSBOFST'="",'$D(^TMP("PSB1",$J,DFN,J+1)) D
"RTN","PSBOMM",215,0)
 ...I PSBSTOP>PSBOFDT,PSBOFST="OFF HOLD" S PSBFLAG=2,PSBUNHD=PSBOFDT
"RTN","PSBOMM",216,0)
 ..I PSBOSTS="A",PSBHDST="HOLD",PSBOFST'="",PSBOFDT'<PSBSTOP S PSBFLAG=1
"RTN","PSBOMM",217,0)
 ..I PSBOSTS="H",PSBHDST="HOLD",'$D(^TMP("PSB1",$J,DFN,J+1)) S PSBFLAG=1
"RTN","PSBOMM",218,0)
 K PSBCNT,^TMP("PSB1",$J)
"RTN","PSBOMM",219,0)
 Q
"RTN","PSBOMM",220,0)
 ;
"VER")
8.0^22.0
**END**
**END**
