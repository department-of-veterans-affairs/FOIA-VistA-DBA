Released PSJ*5*164 SEQ #146
Extracted from mail message
**KIDS**:PSJ*5.0*164^

**INSTALL NAME**
PSJ*5.0*164
"BLD",6512,0)
PSJ*5.0*164^INPATIENT MEDICATIONS^0^3060228^y
"BLD",6512,1,0)
^^15^15^3051114^
"BLD",6512,1,1,0)
This patch addresses two issues contained in two Remedy tickets, 
"BLD",6512,1,2,0)
HD118307 and HD108011.
"BLD",6512,1,3,0)
 
"BLD",6512,1,4,0)
The first issue addressed by this patch is an undefined variable error 
"BLD",6512,1,5,0)
when the user attempts to run the menu option [PSJU EUD].  If the user 
"BLD",6512,1,6,0)
selects a patient who has never been admitted, then presses the carriage 
"BLD",6512,1,7,0)
return again at the Select Patient prompt, an undefined variable error 
"BLD",6512,1,8,0)
occurs.
"BLD",6512,1,9,0)
 
"BLD",6512,1,10,0)
The second issue addressed involves an incorrect display of the dispense 
"BLD",6512,1,11,0)
drug units in backdoor pharmacy.  If the dispense drug units per dose are 
"BLD",6512,1,12,0)
changed (editing field 12 backdoor), and one of the drugs' units 
"BLD",6512,1,13,0)
dispensed becomes 0, backdoor pharmacy will still display a value of 1 
"BLD",6512,1,14,0)
for that drug.  BCMA and CPRS show the correct dispense drug units, and 
"BLD",6512,1,15,0)
the correct units are stored in the ^PS(55) file.
"BLD",6512,4,0)
^9.64PA^^
"BLD",6512,6)
1^
"BLD",6512,"KRN",0)
^9.67PA^8989.52^19
"BLD",6512,"KRN",.4,0)
.4
"BLD",6512,"KRN",.401,0)
.401
"BLD",6512,"KRN",.402,0)
.402
"BLD",6512,"KRN",.403,0)
.403
"BLD",6512,"KRN",.5,0)
.5
"BLD",6512,"KRN",.84,0)
.84
"BLD",6512,"KRN",3.6,0)
3.6
"BLD",6512,"KRN",3.8,0)
3.8
"BLD",6512,"KRN",9.2,0)
9.2
"BLD",6512,"KRN",9.8,0)
9.8
"BLD",6512,"KRN",9.8,"NM",0)
^9.68A^3^2
"BLD",6512,"KRN",9.8,"NM",2,0)
PSJLMUDE^^0^59012480
"BLD",6512,"KRN",9.8,"NM",3,0)
PSGEUD^^0^27762235
"BLD",6512,"KRN",9.8,"NM","B","PSGEUD",3)

"BLD",6512,"KRN",9.8,"NM","B","PSJLMUDE",2)

"BLD",6512,"KRN",19,0)
19
"BLD",6512,"KRN",19.1,0)
19.1
"BLD",6512,"KRN",101,0)
101
"BLD",6512,"KRN",409.61,0)
409.61
"BLD",6512,"KRN",771,0)
771
"BLD",6512,"KRN",870,0)
870
"BLD",6512,"KRN",8989.51,0)
8989.51
"BLD",6512,"KRN",8989.52,0)
8989.52
"BLD",6512,"KRN",8994,0)
8994
"BLD",6512,"KRN","B",.4,.4)

"BLD",6512,"KRN","B",.401,.401)

"BLD",6512,"KRN","B",.402,.402)

"BLD",6512,"KRN","B",.403,.403)

"BLD",6512,"KRN","B",.5,.5)

"BLD",6512,"KRN","B",.84,.84)

"BLD",6512,"KRN","B",3.6,3.6)

"BLD",6512,"KRN","B",3.8,3.8)

"BLD",6512,"KRN","B",9.2,9.2)

"BLD",6512,"KRN","B",9.8,9.8)

"BLD",6512,"KRN","B",19,19)

"BLD",6512,"KRN","B",19.1,19.1)

"BLD",6512,"KRN","B",101,101)

"BLD",6512,"KRN","B",409.61,409.61)

"BLD",6512,"KRN","B",771,771)

"BLD",6512,"KRN","B",870,870)

"BLD",6512,"KRN","B",8989.51,8989.51)

"BLD",6512,"KRN","B",8989.52,8989.52)

"BLD",6512,"KRN","B",8994,8994)

"BLD",6512,"QUES",0)
^9.62^^
"BLD",6512,"REQB",0)
^9.611^1^1
"BLD",6512,"REQB",1,0)
PSJ*5.0*150^1
"BLD",6512,"REQB","B","PSJ*5.0*150",1)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,20,0)
^9.402P^^
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
164^3060228^33234
"PKG",203,22,1,"PAH",1,1,0)
^^15^15^3060228
"PKG",203,22,1,"PAH",1,1,1,0)
This patch addresses two issues contained in two Remedy tickets, 
"PKG",203,22,1,"PAH",1,1,2,0)
HD118307 and HD108011.
"PKG",203,22,1,"PAH",1,1,3,0)
 
"PKG",203,22,1,"PAH",1,1,4,0)
The first issue addressed by this patch is an undefined variable error 
"PKG",203,22,1,"PAH",1,1,5,0)
when the user attempts to run the menu option [PSJU EUD].  If the user 
"PKG",203,22,1,"PAH",1,1,6,0)
selects a patient who has never been admitted, then presses the carriage 
"PKG",203,22,1,"PAH",1,1,7,0)
return again at the Select Patient prompt, an undefined variable error 
"PKG",203,22,1,"PAH",1,1,8,0)
occurs.
"PKG",203,22,1,"PAH",1,1,9,0)
 
"PKG",203,22,1,"PAH",1,1,10,0)
The second issue addressed involves an incorrect display of the dispense 
"PKG",203,22,1,"PAH",1,1,11,0)
drug units in backdoor pharmacy.  If the dispense drug units per dose are 
"PKG",203,22,1,"PAH",1,1,12,0)
changed (editing field 12 backdoor), and one of the drugs' units 
"PKG",203,22,1,"PAH",1,1,13,0)
dispensed becomes 0, backdoor pharmacy will still display a value of 1 
"PKG",203,22,1,"PAH",1,1,14,0)
for that drug.  BCMA and CPRS show the correct dispense drug units, and 
"PKG",203,22,1,"PAH",1,1,15,0)
the correct units are stored in the ^PS(55) file.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSGEUD")
0^3^B27762235
"RTN","PSGEUD",1,0)
PSGEUD ;BIR/CML3-EXTRA UNITS DISPENSED ;17 SEP 97 /  1:41 PM
"RTN","PSGEUD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**31,41,50,111,150,164**;16 DEC 97
"RTN","PSGEUD",3,0)
 ;
"RTN","PSGEUD",4,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGEUD",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSGEUD",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGEUD",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGEUD",8,0)
 ;
"RTN","PSGEUD",9,0)
 N PSJNEW,PSGPTMP,PPAGE,PSGEFN S PSJNEW=1
"RTN","PSGEUD",10,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  S (PSGONNV,PSGRETF)=1 K PSGPRP
"RTN","PSGEUD",11,0)
 ;
"RTN","PSGEUD",12,0)
GP ;
"RTN","PSGEUD",13,0)
 S PSGP="",DFN=""
"RTN","PSGEUD",14,0)
 D ENDPT^PSGP G:(PSGP'>0)&(DFN'>0)!('$D(PSJPAD)) DONE S:PSGP<1 PSGP=DFN I '$O(^PS(55,PSGP,5,"AUS",+PSJPAD)) W $C(7),!,"(Patient has NO active or old orders.)" G GP
"RTN","PSGEUD",15,0)
 D ENL^PSGOU G:"^N"[PSGOL GP S PSGPTMP=0,PPAGE=1 D ^PSGO G:'PSGON GP S PSGLMT=PSGON,(PSGONC,PSGONR)=0
"RTN","PSGEUD",16,0)
 F  W !!,"Select ORDER",$E("S",PSGON>1)," 1-",PSGON,": " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" H I X'?1."?" D ENCHK^PSGON W:'$D(X) $C(7),"  ??" Q:$D(X)
"RTN","PSGEUD",17,0)
 G:"^"[X GP F PSGRET=1:1:PSGODDD F PSGRET1=1:1 S PSGRET2=$P(PSGODDD(PSGRET),",",PSGRET1) Q:'PSGRET2  S PSGORD=^TMP("PSJON",$J,PSGRET2) D R G:$D(DTOUT) GP
"RTN","PSGEUD",18,0)
 G GP
"RTN","PSGEUD",19,0)
 ;
"RTN","PSGEUD",20,0)
DONE ;
"RTN","PSGEUD",21,0)
 D ENKV^PSGSETU K ^TMP("PSJON",$J),DO,DRGN,MR,OD,PSGLMT,PSGODDD,PSGEUD,PSGEUDA,PSGOL,PSGON,PSGONC,PSGONR,PSGONV,PSGONNV,PSGORD,PSGQ,PSGRET,PSGRET1,PSGRET2,PSGRETF,PSGSPD,SCH,WG,Z,CST Q
"RTN","PSGEUD",22,0)
 ;
"RTN","PSGEUD",23,0)
R ;
"RTN","PSGEUD",24,0)
 S MR=$P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",3),Y=$G(^(.2)),SCH=$P($G(^(2)),"^"),DO=$P(Y,"^",2),DRG=$P(Y,"^"),DRG=$S(DRG'=+DRG:"NOT FOUND",'$D(^PS(50.7,DRG,0)):DRG,$P(^(0),"^")]"":$P(^(0),"^"),1:DRG_";PS(50.7,")
"RTN","PSGEUD",25,0)
 S:MR]"" MR=$S(MR'=MR:MR,'$D(^PS(51.2,MR,0)):MR,$P(^(0),"^",3)]"":$P(^(0),"^",3),$P(^(0),"^")]"":$P(^(0),"^"),1:MR_";PS(51.2,") W !!,"----------------------------------------",!,DRG,!,"Give: " D
"RTN","PSGEUD",26,0)
 .N LN,MARX D TXT^PSGMUTL(DO_" "_MR_" "_SCH,65)
"RTN","PSGEUD",27,0)
 .S LN="" F  S LN=$O(MARX(LN)) Q:LN=""  W:LN>1 ! W ?6,MARX(LN)
"RTN","PSGEUD",28,0)
 I '$O(^PS(55,PSGP,5,+PSGORD,1,0)) D  Q
"RTN","PSGEUD",29,0)
 .W !!,"No Dispense drugs have been entered for this order. At least one Dispense drugs",!,"must be associated with an order before dispensing information may be entered.",!!
"RTN","PSGEUD",30,0)
 .N DIR S DIR(0)="E" D ^DIR S Y=$S(Y:0,1:1)
"RTN","PSGEUD",31,0)
 S PSGEUD=0,WG=$O(^PS(57.5,"AB",+PSJPWD,0)) F DRG=0:0 S DRG=$O(^PS(55,PSGP,5,+PSGORD,1,DRG)) Q:'DRG  S X=$G(^(DRG,0)) I X D  Q:$D(DTOUT)
"RTN","PSGEUD",32,0)
 .S UD=$P(X,"^",2),DRGN=$$ENDDN^PSGMI(+X) Q:DRGN=""  S:'$D(^PSDRUG(+X,212,"AC",+WG)) WG=""
"RTN","PSGEUD",33,0)
 .I ($P(X,"^",3)?7N)&($P(PSGDT,".")'<$P(X,"^",3)) W !!,"Dispense drug: ",DRGN," **ORDER INACTIVE**" Q
"RTN","PSGEUD",34,0)
 .I ($G(^PSDRUG(+X,"I"))?7N)&($P(PSGDT,".")'<$G(^PSDRUG(+X,"I"))) W !!,"Dispense drug: ",DRGN," **DRUG INACTIVE**" Q
"RTN","PSGEUD",35,0)
 .W !!,"Dispense drug: ",DRGN,"  (U/D: ",$S('UD:1,1:UD),")"
"RTN","PSGEUD",36,0)
 .K DA,DR S DA=+DRG,DA(2)=PSGP,DA(1)=+PSGORD,DIE="^PS(55,"_PSGP_",5,"_+PSGORD_",1,",DR=.11 S:$P($G(^PS(55,PSGP,5,+PSGORD,1,DA,0)),"^",11) $P(^(0),"^",11)=""
"RTN","PSGEUD",37,0)
 .D ^DIE S PSGEUD=PSGEUD+$P($G(^PS(55,PSGP,5,+PSGORD,1,DA,0)),U,11)
"RTN","PSGEUD",38,0)
 I PSGEUD,WG D QS
"RTN","PSGEUD",39,0)
 Q
"RTN","PSGEUD",40,0)
 ;
"RTN","PSGEUD",41,0)
QS ;
"RTN","PSGEUD",42,0)
 W !!,"THIS DRUG IS AN ATC ITEM." S Y=$G(^PS(57.5,WG,3)) I $P(Y,"^",3)="" W $C(7),"  BUT THE ATC DEVICE CANNOT BE FOUND!" S Y=0 Q
"RTN","PSGEUD",43,0)
 S IOP="`"_$P(Y,"^",3),PSGSPD=$P(Y,"^",2) F  W !,"Do you want to dispense ",$S(PSGEUD>1:"these",1:"this")," extra unit",$E("s",PSGEUD>1)," through the ATC" S %=2 D YN^DICN Q:%  D QSH
"RTN","PSGEUD",44,0)
 S Y=0 Q:%'=1  K %ZIS,IO("Q") S %ZIS="NQ",PSGION=ION,IOP=IOP_";255" D ^%ZIS I POP S IOP=PSGION D ^%ZIS W $C(7),!!?10,"** THE ATC MACHINE CANNOT BE FOUND! **" S Y=0 Q
"RTN","PSGEUD",45,0)
 K ZTSAVE S PSGTIR="ENQ^PSGEUD",PSGTID=$H,ZTDESC="EXTRA UNITS TO ATC" F X="PSGP","PSGORD","PSGP(0)","PSGSPD" S ZTSAVE(X)=""
"RTN","PSGEUD",46,0)
 D ENTSK^PSGTI W "...DONE" S Y=0 Q
"RTN","PSGEUD",47,0)
 ;
"RTN","PSGEUD",48,0)
ENQ ;
"RTN","PSGEUD",49,0)
 D NOW^%DTC S DFN=PSGP D PID^VADPT
"RTN","PSGEUD",50,0)
 S %=%_"0000000000000",BLKS="                    ",PN=$E($P(PSGP(0),"^")_BLKS,1,20),PID=$E(VA("PID")_BLKS,1,12),PL=$E($S($D(^DPT(PSGP,.1)):^(.1),1:"*N/F*")_BLKS,1,12)
"RTN","PSGEUD",51,0)
 X ^%ZOSF("LABOFF") F PSGDRG=0:0 S PSGDRG=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDRG)) Q:'PSGDRG  S X=$G(^(PSGDRG,0)) I X D
"RTN","PSGEUD",52,0)
 .S C=$P(X,U,11),PSGEUDA=$P($G(^PSDRUG(+X,8.5)),U,2) Q:(PSGEUDA="")!('C)
"RTN","PSGEUD",53,0)
 .S PSGEUDA=$E(PSGEUDA_BLKS,1,15) S:$L(C)<3 C=$E("000",1,3-$L(C))_C S C=C_$E(%,4,5)_$E(%,6,7)_$E(%,2,3)_$E(%,9,10)_$E(%,11,12) D @$S(PSGSPD:"S2",1:"S1")
"RTN","PSGEUD",54,0)
 Q
"RTN","PSGEUD",55,0)
 ;
"RTN","PSGEUD",56,0)
S1 ;
"RTN","PSGEUD",57,0)
 W $C(48) F Q=1:1:75 R *X:$S(Q<15:1,1:5) G:X=49 S1 I X=48 Q
"RTN","PSGEUD",58,0)
 E  Q
"RTN","PSGEUD",59,0)
 W $C(50),$C(52),PN_PID_PL_"IMD"_PSGEUDA_"1 ",$C(53),$C(54),C,$C(55),$C(13) F Q=1:1:75 R *X:$S(Q<15:1,1:5) G:X=49 S1 I X=48 Q
"RTN","PSGEUD",60,0)
 Q
"RTN","PSGEUD",61,0)
 ;
"RTN","PSGEUD",62,0)
S2 ;
"RTN","PSGEUD",63,0)
 W $C(48) F Q=1:1:75 R X:$S(Q<15:1,1:5) G:$A(X)=49 S2 I $A(X)=48 Q
"RTN","PSGEUD",64,0)
 E  Q
"RTN","PSGEUD",65,0)
 W $C(50),$C(52),PN_PID_PL_"IMD"_PSGEUDA_"1 ",$C(53),$C(54),C,$C(55),$C(13) F Q=1:1:75 R X:$S(Q<15:1,1:5) G:$A(X)=49 S2 I $A(X)=48 Q
"RTN","PSGEUD",66,0)
 Q
"RTN","PSGEUD",67,0)
 ;
"RTN","PSGEUD",68,0)
QSH ;
"RTN","PSGEUD",69,0)
 W !!?2,"This drug can be dispensed through the ATC machine.  Enter 'Y' to do so now.  Enter 'N' if you do not want to do so.",! Q
"RTN","PSGEUD",70,0)
 ;
"RTN","PSGEUD",71,0)
H ;
"RTN","PSGEUD",72,0)
 W !!?2,"Select the orders (by number) for which you want to enter extra units",!,"dispensed." D:X'="?" H2^PSGON
"RTN","PSGEUD",73,0)
 Q
"RTN","PSJLMUDE")
0^2^B59012480
"RTN","PSJLMUDE",1,0)
PSJLMUDE ;BIR/MLM-SHOW FIELDS FOR EDIT (LISTMAN STYLE) ;01 JUNE 00 / 2:40 PM
"RTN","PSJLMUDE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,47,50,63,64,58,80,116,110,111,164**;16 DEC 97
"RTN","PSJLMUDE",3,0)
  ;NFI-UD Fr#:2 chgs@init+4 to display non-formulary (N/F)
"RTN","PSJLMUDE",4,0)
  ;also chgs @init+23
"RTN","PSJLMUDE",5,0)
 ;
"RTN","PSJLMUDE",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJLMUDE",7,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192
"RTN","PSJLMUDE",8,0)
 ;
"RTN","PSJLMUDE",9,0)
INIT(PSGP,PSGORD) ;
"RTN","PSJLMUDE",10,0)
 N D,ND,PSJBCMA,PSJL,PSJLM,PSJLN,Q,QQ,PSJDUR K ^TMP("PSJUDE",$J)
"RTN","PSJLMUDE",11,0)
 K:$G(PSJNORD) PSGOEEF S PSJLN=1
"RTN","PSJLMUDE",12,0)
 D CLEAN^VALM10
"RTN","PSJLMUDE",13,0)
 S PSJL=$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"   "),PSJL=$$SETSTR^VALM1("Orderable Item: "_PSGPDN_$$OINF^PSJDIN(PSGPD),PSJL,5,74) D  D SETTMP D:$G(PSGOEEF(108))!($G(PSGOEEF(101))) HILITE(1)
"RTN","PSJLMUDE",14,0)
 . NEW Q,PSJDDA,PSJVD F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S PSJDDA(+$G(^(Q,0)))=""
"RTN","PSJLMUDE",15,0)
 . S PSJVD=$$DINFLUD^PSJDIN(PSGPD,.PSJDDA)
"RTN","PSJLMUDE",16,0)
 . S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,80)
"RTN","PSJLMUDE",17,0)
 . D:PSJVD]"" CNTRL^VALM10(1,75,5,IORVON,IORVOFF,0)
"RTN","PSJLMUDE",18,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJLMUDE",19,0)
 S PSJL="Instructions: "_PSGOINST D PTXT^PSJLMPRU(PSJL,"PSJUDE",6,80)
"RTN","PSJLMUDE",20,0)
 S PSJL=$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),PSJL=$$SETSTR^VALM1("Dosage Ordered: "_PSGDO,PSJL,5,76) D SETTMP D:$G(PSGOEEF(109)) HILITE(2)
"RTN","PSJLMUDE",21,0)
 I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSJLMUDE",22,0)
 I $G(PSJORD),($G(PSJDUR)="") S P=$S(PSJORD["U":5,PSJORD["V":"IV",PSJORD["P":"P",1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,P)
"RTN","PSJLMUDE",23,0)
 S PSJL=$$SETSTR^VALM1("Duration: "_$G(PSJDUR),PSJL,11,25)
"RTN","PSJLMUDE",24,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_$P(PSGSDN,U,2),PSJL,54,26) D:$G(PSGOEEF(10)) HILITE(3)
"RTN","PSJLMUDE",25,0)
 I $G(PSGORD)["P" N ND0,OLDO S ND0=@(PSGOEEWF_"0)") I $P(ND0,"^",24)="R" S OLDO=$P(ND0,"^",25) I OLDO,(OLDO["U") D
"RTN","PSJLMUDE",26,0)
 . N OSTRT,OSTRTN S OSTRT=$G(@("^PS(55,"_PSGP_",5,"_+OLDO_",2)")),OSTRT=$P(OSTRT,"^",2) Q:'OSTRT  S OSTRTN=$$ENDTC^PSGMI(+OSTRT)
"RTN","PSJLMUDE",27,0)
 . S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_OSTRTN,PSJL,54,26)
"RTN","PSJLMUDE",28,0)
 D SETTMP
"RTN","PSJLMUDE",29,0)
 S PSJL=$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),PSJL=$$SETSTR^VALM1("Med Route: "_PSGMRN,PSJL,10,35) D:$G(PSGOEEF(3)) HILITE(4)
"RTN","PSJLMUDE",30,0)
 I $G(PSJORD)["P" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,PSGORD) S:PSGRNDT PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",31,0)
 I '$G(PSGRNDT),$G(PSGRDTX) D
"RTN","PSJLMUDE",32,0)
 . I $D(PSGRDTX)<10 S PSGRSDN=$$ENDTC^PSGMI(+PSGRDTX),PSJL=$$SETSTR^VALM1("REQUESTED START: "_PSGRSDN,PSJL,48,32) Q
"RTN","PSJLMUDE",33,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$P($G(PSGSDN),U,2) S PSGRSDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRSD")),PSJL=$$SETSTR^VALM1("Calc Start: "_PSGRSDN,PSJL,53,32) D
"RTN","PSJLMUDE",34,0)
 .. I PSGSD'=PSGRDTX(+PSJORD,"PSGRSD") D CNTRL^VALM10(5,53,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",35,0)
 ; Indirect reference in PSGOEEWF below refers to either ^PS(53.1 or ^PS(55,DFN,5,. Naked reference refers to full indirect reference
"RTN","PSJLMUDE",36,0)
 I $G(PSJORD)["U" N ND14 S ND14=$G(@(PSGOEEWF_"14,0)")) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^") I RNDT D
"RTN","PSJLMUDE",37,0)
 . N PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+RNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",38,0)
 D SETTMP
"RTN","PSJLMUDE",39,0)
 I PSGORD]"" S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSJLMUDE",40,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLMUDE",41,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"     ")_" Stop: "_$P(PSGFDN,U,2),PSJL,54,26) D SETTMP D:$G(PSGOEEF(25))!($G(PSGOEEF(34))) HILITE(5)
"RTN","PSJLMUDE",42,0)
 S PSJL=$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule Type: "_PSGSTN,PSJL,6,45) D:$G(PSGOEEF(7)) HILITE(6)
"RTN","PSJLMUDE",43,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$P($G(PSGFDN),U,2) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")),PSJL=$$SETSTR^VALM1("Calc Stop: "_PSGRFDN,PSJL,54,26) D
"RTN","PSJLMUDE",44,0)
 . I PSGFD'=PSGRDTX(+PSJORD,"PSGRFD") D CNTRL^VALM10(7,54,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",45,0)
 D SETTMP
"RTN","PSJLMUDE",46,0)
 S PSGSMN=$P("NO^YES",U,PSGSM+1)
"RTN","PSJLMUDE",47,0)
 S PSJL=$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule: "_PSGSCH_$G(SCHMSG),PSJL,11,68) D SETTMP D:$G(PSGOEEF(26)) HILITE(8)
"RTN","PSJLMUDE",48,0)
 S PSJL=$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"   "),PSJL=$$SETSTR^VALM1("Admin Times: "_PSGAT,PSJL,8,71) D SETTMP D:$G(PSGOEEF(39))!($G(PSGOEEF(41))) HILITE(9)
"RTN","PSJLMUDE",49,0)
 S PSJL=$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"   "),PSJL=$$SETSTR^VALM1("Provider: "_PSGPRN,PSJL,11,68) D:$G(PSGOEEF(1)) HILITE(10) D SETTMP
"RTN","PSJLMUDE",50,0)
 ;S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,56,24) S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,71,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",51,0)
 S PSJL=$S($D(PSGEFN(11)):$E(" *",PSGEFN(11))_"(11)",1:"   ")_" Special Instructions"_$S($P(PSGSI,"^",2)=1:"!: ",1:": ")_$P(PSGSI,"^") D PTXT^PSJLMPRU(PSJL,"PSJUDE",1,80)
"RTN","PSJLMUDE",52,0)
 S PSJL="" D SETTMP D:$G(PSGOEEF(8)) HILITE(11)
"RTN","PSJLMUDE",53,0)
 ; E3R 16130
"RTN","PSJLMUDE",54,0)
 I $O(^PS(53.45,PSJSYSP,2,1)) F  S PSJL="" D SETTMP Q:PSJLN>15
"RTN","PSJLMUDE",55,0)
 S PSJL=$S($D(PSGEFN(12)):$E(" *",PSGEFN(12))_" (12)",1:"   ")_" Dispense Drug",PSJL=$$SETSTR^VALM1("U/D",PSJL,54,60),PSJL=$$SETSTR^VALM1("Inactive Date",PSJL,65,16) D SETTMP,CNTRL^VALM10(13,1,80,IOUON,IOUOFF,0)
"RTN","PSJLMUDE",56,0)
 ;S $P(PSJL,"-",80)="" D SETTMP
"RTN","PSJLMUDE",57,0)
 NEW PSJX
"RTN","PSJLMUDE",58,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSJLMUDE",59,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSJLMUDE",60,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(")
"RTN","PSJLMUDE",61,0)
 .S PSJL="      "_D_$$DDNF^PSJDIN(+ND),PSJL=$$SETSTR^VALM1($S($P(ND,"^",2):$S($P(ND,"^",2)=.5:"1/2",$P(ND,"^",2)=.25:"1/4",1:$P(ND,"^",2)),$P(ND,"^",2)=0:0,1:1),PSJL,54,63) S:PSGID PSJL=$$SETSTR^VALM1(PSGID,PSJL,65,16) D  D SETTMP
"RTN","PSJLMUDE",62,0)
 ..S PSJX=$G(PSJX)+1
"RTN","PSJLMUDE",63,0)
 ..I $G(PSGOEEF(109)) D CNTRL^VALM10(13+PSJX,7,73,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",64,0)
 I $S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,0)),1:$O(^PS(55,PSGP,5,+PSGORD,12,0))) S PSJL="Provider Comments:" D SETTMP S PSJL="" D
"RTN","PSJLMUDE",65,0)
 .F Q=0:0 S Q=$S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,Q)),1:$O(^PS(55,PSGP,5,+PSGORD,12,Q))) Q:'Q  S PSJL=$G(^(Q,0)) D SETTMP
"RTN","PSJLMUDE",66,0)
 D SETTMP S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,1,24)
"RTN","PSJLMUDE",67,0)
 S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,16,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",68,0)
 D SETTMP S PSJL="Entry By: "_PSGEBN,PSJL=$$SETSTR^VALM1("Entry Date: "_$P(PSGLIN,U,2),PSJL,51,39) D SETTMP
"RTN","PSJLMUDE",69,0)
 I $G(PSGLRN) D SETTMP S PSJL="Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2)) D SETTMP
"RTN","PSJLMUDE",70,0)
 D SETTMP S PSJL="(13)"_" Comments:"
"RTN","PSJLMUDE",71,0)
 D:'$O(^PS(53.45,PSJSYSP,1,0)) SETTMP
"RTN","PSJLMUDE",72,0)
 D SETTMP F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S PSJWPL=PSJL_$S($E(PSJL)=" ":"",1:" ")_$G(^(Q,0)),PSJL="" D DISPLAY
"RTN","PSJLMUDE",73,0)
 D SETTMP
"RTN","PSJLMUDE",74,0)
 I PSGORD["P",($P($G(^PS(53.1,+PSGORD,0)),U,9)="P"),$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSJLMUDE",75,0)
 .D SETTMP S PSJL="Order Checks:" D SETTMP
"RTN","PSJLMUDE",76,0)
 .F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,10,Q)) Q:'Q  D
"RTN","PSJLMUDE",77,0)
 ..S PSJL="" D SETTMP S PSJL=$G(^PS(53.1,+PSGORD,10,Q,0)) D SETTMP
"RTN","PSJLMUDE",78,0)
 ..S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+PSGORD,10,Q,1)),U) D SETTMP
"RTN","PSJLMUDE",79,0)
 ..S PSJL="Overriding Reason: " F X=0:0 S X=$O(^PS(53.1,+PSGORD,10,Q,2,X)) Q:'X   D
"RTN","PSJLMUDE",80,0)
 ...S PSJL=PSJL_$G(^PS(53.1,+PSGORD,10,Q,2,X,0)) D SETTMP S PSJL="                   "
"RTN","PSJLMUDE",81,0)
ACTFLG ;
"RTN","PSJLMUDE",82,0)
 S ND4=$S(PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:$G(^PS(55,PSGP,5,+PSGORD,4)))
"RTN","PSJLMUDE",83,0)
 S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSJLMUDE",84,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSJLMUDE",85,0)
 I AT]"" D
"RTN","PSJLMUDE",86,0)
 .S PSJL="" D SETTMP
"RTN","PSJLMUDE",87,0)
 .S PSJL="ORDER "_$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSJLMUDE",88,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" S PSJL=PSJL_"  ("_$P(AT,"^",10)_")"
"RTN","PSJLMUDE",89,0)
 D SETTMP
"RTN","PSJLMUDE",90,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMUDE",91,0)
 K PSGSMN,Q,Y,Y1,Y2,PSGLRN
"RTN","PSJLMUDE",92,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S((PSGSTAT="PENDING")&($G(PSGPRIO)]""):"("_PSGPRIO_")",$G(PSGPRIO)="DONE":"("_PSGPRIO_")",1:"") I $D(PSJLMP2) S VALMBG=16 K PSJLMP2
"RTN","PSJLMUDE",93,0)
TEST ;
"RTN","PSJLMUDE",94,0)
 I $G(PSGPFLG) S VALMSG="INVALID ORDERABLE ITEM"
"RTN","PSJLMUDE",95,0)
 I $G(PSGDI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" DISPENSE DRUG"
"RTN","PSJLMUDE",96,0)
 I $G(PSGPI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" PROVIDER"
"RTN","PSJLMUDE",97,0)
 Q
"RTN","PSJLMUDE",98,0)
DISPLAY ;
"RTN","PSJLMUDE",99,0)
 S PSJL=PSJWPL D SETTMP
"RTN","PSJLMUDE",100,0)
 ;F X=1:1 S WRD=$P(PSJWPL," ",X) Q:WRD=""  D
"RTN","PSJLMUDE",101,0)
 ;.I $L(PSJL_" "_WRD)'<80 D SETTMP S PSJL=$P(PSJWPL,PSJL,2) S:$E(PSJL,1)=" " PSJL=$E(PSJL,2,999),PSJWPL="" Q
"RTN","PSJLMUDE",102,0)
 ;.S PSJL=PSJL_$S(PSJL="":"",1:" ")_WRD
"RTN","PSJLMUDE",103,0)
 Q
"RTN","PSJLMUDE",104,0)
 ;
"RTN","PSJLMUDE",105,0)
SETTMP ;
"RTN","PSJLMUDE",106,0)
 S ^TMP("PSJUDE",$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1,PSJL=""
"RTN","PSJLMUDE",107,0)
 Q
"RTN","PSJLMUDE",108,0)
 ;
"RTN","PSJLMUDE",109,0)
HILITE(FLD) ; 
"RTN","PSJLMUDE",110,0)
 N COL,LIN,WID,X
"RTN","PSJLMUDE",111,0)
 ;Q:'$G(PSGOEENO)
"RTN","PSJLMUDE",112,0)
 S X="$T("_FLD_"^PSJLMUDE)",@("X="_X),X=$P(X,";;",2),LIN=+X,COL=$P(X,",",2),LAB=$P(X,",",3),X=$P(X,",",4),WID=(LAB+$L(@X))
"RTN","PSJLMUDE",113,0)
 ;D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IOINORM,0)
"RTN","PSJLMUDE",114,0)
 I FLD=7 S LIN=+$G(PSJLN)-1 Q:LIN<13
"RTN","PSJLMUDE",115,0)
 D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",116,0)
 Q
"RTN","PSJLMUDE",117,0)
 ;
"RTN","PSJLMUDE",118,0)
1 ;;1,5,16,PSGPDN
"RTN","PSJLMUDE",119,0)
2 ;;3,5,16,PSGDO
"RTN","PSJLMUDE",120,0)
3 ;;4,58,7,PSGSDN
"RTN","PSJLMUDE",121,0)
4 ;;5,10,11,PSGMRN
"RTN","PSJLMUDE",122,0)
5 ;;6,59,6,PSGFDN
"RTN","PSJLMUDE",123,0)
6 ;;7,6,15,PSGSTN
"RTN","PSJLMUDE",124,0)
7 ;;18,5,14,PSGSMN
"RTN","PSJLMUDE",125,0)
8 ;;8,11,12,PSGSCH
"RTN","PSJLMUDE",126,0)
9 ;;9,8,13,PSGAT
"RTN","PSJLMUDE",127,0)
10 ;;10,11,10,PSGPRN
"RTN","PSJLMUDE",128,0)
11 ;;11,7,22,PSGSI
"RTN","PSJLMUDE",129,0)
ENKILL ;
"RTN","PSJLMUDE",130,0)
 K PSGAT,PSGEB,PSGEFN,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"VER")
8.0^22.0
"BLD",6512,6)
^146
**END**
**END**
