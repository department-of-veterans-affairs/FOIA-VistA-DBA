Released PSD*3*36 SEQ #42
Extracted from mail message
**KIDS**:PSD*3.0*36^

**INSTALL NAME**
PSD*3.0*36
"BLD",3331,0)
PSD*3.0*36^CONTROLLED SUBSTANCES^0^3031021^y
"BLD",3331,1,0)
^9.61A^4^4^3031021^^
"BLD",3331,1,1,0)
 When the Balance Adjustment Report [PSD BALANCE ADJUSTMENT REVIEW] is
"BLD",3331,1,2,0)
 sent to a printer and not queued, the report prints to the user's
"BLD",3331,1,3,0)
 screen instead.
"BLD",3331,1,4,0)
 
"BLD",3331,"KRN",0)
^9.67PA^^
"BLD",3331,"KRN",.4,0)
.4
"BLD",3331,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",3331,"KRN",.401,0)
.401
"BLD",3331,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",3331,"KRN",.402,0)
.402
"BLD",3331,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",3331,"KRN",.403,0)
.403
"BLD",3331,"KRN",.5,0)
.5
"BLD",3331,"KRN",.84,0)
.84
"BLD",3331,"KRN",3.6,0)
3.6
"BLD",3331,"KRN",3.8,0)
3.8
"BLD",3331,"KRN",9.2,0)
9.2
"BLD",3331,"KRN",9.8,0)
9.8
"BLD",3331,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",3331,"KRN",9.8,"NM",1,0)
PSDADJD^^0^B20548828
"BLD",3331,"KRN",9.8,"NM","B","PSDADJD",1)

"BLD",3331,"KRN",19,0)
19
"BLD",3331,"KRN",19.1,0)
19.1
"BLD",3331,"KRN",101,0)
101
"BLD",3331,"KRN",409.61,0)
409.61
"BLD",3331,"KRN",771,0)
771
"BLD",3331,"KRN",869.2,0)
869.2
"BLD",3331,"KRN",870,0)
870
"BLD",3331,"KRN",8994,0)
8994
"BLD",3331,"KRN","B",.4,.4)

"BLD",3331,"KRN","B",.401,.401)

"BLD",3331,"KRN","B",.402,.402)

"BLD",3331,"KRN","B",.403,.403)

"BLD",3331,"KRN","B",.5,.5)

"BLD",3331,"KRN","B",.84,.84)

"BLD",3331,"KRN","B",3.6,3.6)

"BLD",3331,"KRN","B",3.8,3.8)

"BLD",3331,"KRN","B",9.2,9.2)

"BLD",3331,"KRN","B",9.8,9.8)

"BLD",3331,"KRN","B",19,19)

"BLD",3331,"KRN","B",19.1,19.1)

"BLD",3331,"KRN","B",101,101)

"BLD",3331,"KRN","B",409.61,409.61)

"BLD",3331,"KRN","B",771,771)

"BLD",3331,"KRN","B",869.2,869.2)

"BLD",3331,"KRN","B",870,870)

"BLD",3331,"KRN","B",8994,8994)

"BLD",3331,"QUES",0)
^9.62^^
"BLD",3331,"REQB",0)
^9.611^1^1
"BLD",3331,"REQB",1,0)
PSD*3.0*18^1
"BLD",3331,"REQB","B","PSD*3.0*18",1)

"BLD",3331,"REQG",0)
^9.611^^
"MBREQ")
0
"PKG",276,-1)
1^1
"PKG",276,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",276,22,0)
^9.49I^1^1
"PKG",276,22,1,0)
3.0^2970213^2970430^11595
"PKG",276,22,1,"PAH",1,0)
36^3031021
"PKG",276,22,1,"PAH",1,1,0)
^^4^4^3031021
"PKG",276,22,1,"PAH",1,1,1,0)
 When the Balance Adjustment Report [PSD BALANCE ADJUSTMENT REVIEW] is
"PKG",276,22,1,"PAH",1,1,2,0)
 sent to a printer and not queued, the report prints to the user's
"PKG",276,22,1,"PAH",1,1,3,0)
 screen instead.
"PKG",276,22,1,"PAH",1,1,4,0)
 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSDADJD")
0^1^B20548828
"RTN","PSDADJD",1,0)
PSDADJD ;BIR/LTL-Review Adjustment Transactions for a Drug; 2 Nov 94 [ 11/02/94  3:53 PM ]
"RTN","PSDADJD",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;**18,36**;13 Feb 97
"RTN","PSDADJD",3,0)
 ;
"RTN","PSDADJD",4,0)
 ;References to ^PSD(58.8, covered by DBIA2711
"RTN","PSDADJD",5,0)
 ;References to PSD(58.81 are covered by DBIA2808
"RTN","PSDADJD",6,0)
 ;References to ^PSDRUG( are covered by DBIA221
"RTN","PSDADJD",7,0)
 N PSDOUT I '$D(PSDSITE) D ^PSDSET I '$D(PSDSITE) S PSDOUT=1 G END
"RTN","PSDADJD",8,0)
 N C,CNT,DIC,DIR,DTOUT,DUOUT,PSD,PSDA,PSDC,PSDEV,PSDR,PSDU,PSDLOC,PSDLOCN,PSDT,PSDTB,X,Y S PSDOUT=1,(CNT,PSDU)=0,PSDCHO=2
"RTN","PSDADJD",9,0)
 D DT^DICRW
"RTN","PSDADJD",10,0)
 S PSDLOC=$P(PSDSITE,U,3),PSDLOCN=$P(PSDSITE,U,4)
"RTN","PSDADJD",11,0)
 G:$P(PSDSITE,U,5) CHKD
"RTN","PSDADJD",12,0)
LOOK S DIC="^PSD(58.8,",DIC(0)="AEQ",DIC("A")="Select Dispensing Site: "
"RTN","PSDADJD",13,0)
 S DIC("S")="I $P($G(^(0)),U,3)=+PSDSITE,$S($P($G(^(0)),U,2)[""M"":1,$P($G(^(0)),U,2)[""S"":1,1:0),($S('$D(^(""I"")):1,+^(""I"")>DT:1,'^(""I""):1,1:0))"
"RTN","PSDADJD",14,0)
 S DIC("B")=$P(PSDSITE,U,4)
"RTN","PSDADJD",15,0)
 W ! D ^DIC K DIC G:Y<0 END S PSDLOC=+Y,PSDLOCN=$P(Y,U,2)
"RTN","PSDADJD",16,0)
 S $P(PSDSITE,U,3)=+Y,$P(PSDSITE,U,4)=$P(Y,U,2)
"RTN","PSDADJD",17,0)
 W !!,"You may select one, several, or ^ALL drugs."
"RTN","PSDADJD",18,0)
CHKD F  S DIC="^PSD(58.8,+PSDLOC,1,",DIC(0)="AEMQZ",DIC("A")="Please Select "_PSDLOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('CNT) END Q:Y<0  S PSD(Y(0,0))=+Y,PSDA(+Y)=Y(0,0),CNT=CNT+1
"RTN","PSDADJD",19,0)
 I CNT=1,'$O(^PSD(58.81,"F",+PSD($O(PSD(0))),"")) W !!,"There have been no adjustments for this drug.",!! G END
"RTN","PSDADJD",20,0)
 I X="^ALL" F  S PSDU=$O(^PSD(58.8,+PSDLOC,1,PSDU)) Q:'PSDU  S:$P($G(^PSDRUG(PSDU,0)),U)]"" PSD($P(^(0),U))=PSDU,PSDA(PSDU)=$P(^(0),U)
"RTN","PSDADJD",21,0)
 S DIR(0)="D^::AEPT",DIR("A")="Beginning date",DIR("?")="Adjustments will be listed for the selected drug(s) within the selected date range" W ! D ^DIR G:Y<1 END
"RTN","PSDADJD",22,0)
 S (PSDT,PSDTB)=Y,PSDTB(2)=Y(0),DIR(0)="DA^"_PSDT_":NOW:AEPT"
"RTN","PSDADJD",23,0)
 S DIR("A")="Ending date:  ",DIR("B")="Now"
"RTN","PSDADJD",24,0)
 W ! D ^DIR K DIR G:Y<1 END S PSDTB(1)=Y,PSDTB(3)=Y(0)
"RTN","PSDADJD",25,0)
 S:'$P(PSDTB(1),".",2) PSDTB(1)=PSDTB(1)+.999999
"RTN","PSDADJD",26,0)
 D  G:Y<1 END
"RTN","PSDADJD",27,0)
 .S DIR(0)="S^1:DATE/DRUG (132 column;2:DRUG/DATE (80 column, browser)"
"RTN","PSDADJD",28,0)
 .S DIR("B")=1,DIR("?")="^S XQH=""PSD BALANCE ADJUSTMENT REPORT"" D EN^XQH" D ^DIR K DIR S PSDCHO=Y
"RTN","PSDADJD",29,0)
 S Y=$P($G(^PSD(58.8,+PSDLOC,2)),"^",9),C=$P(^DD(58.8,24,0),"^",2) D Y^DIQ S PSDEV=Y
"RTN","PSDADJD",30,0)
DEV ;asks device and queueing info
"RTN","PSDADJD",31,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="Q",%ZIS("B")=PSDEV W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSDADJD",32,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN=$S(PSDCHO=2:"START^PSDADJD",1:"START^PSDADJW"),ZTDESC="Drug adjustment transaction review",ZTSAVE("PSD*")="" D ^%ZTLOAD,HOME^%ZIS S PSDOUT=1 G END
"RTN","PSDADJD",33,0)
 ;PSD*3*36 (11oct01 - USE SELECTED DEVICE Dave B.)
"RTN","PSDADJD",34,0)
 U IO
"RTN","PSDADJD",35,0)
 ;Eop36
"RTN","PSDADJD",36,0)
 G:PSDCHO=1 ^PSDADJW
"RTN","PSDADJD",37,0)
 ;(PSD*3*18 - Dave B changed next line to FM calls per SQA)
"RTN","PSDADJD",38,0)
 I $E(IOST)="C" D CHK I $G(GOOD)'<21,$$TEST^DDBRT W !!,"Getting ready to browse...",!! G ^PSDADJB
"RTN","PSDADJD",39,0)
START ;compiles and prints output
"RTN","PSDADJD",40,0)
 N LN,PSDR,PG S (PG,PSDOUT)=0 D HEADER S PSDU=0
"RTN","PSDADJD",41,0)
 F  S PSDU=$O(PSD(PSDU)) Q:PSDU']""  D  G:PSDOUT END S PSDT=PSDTB,PSDT(1)=0
"RTN","PSDADJD",42,0)
LOOP .F  S PSDT=$O(^PSD(58.81,"ACT",PSDT)) W:$E(IOST)="C" "." Q:'PSDT!(PSDT>PSDTB(1))  D:$O(^PSD(58.81,"ACT",PSDT,0))=PSDLOC&($O(^PSD(58.81,"ACT",PSDT,PSDLOC,0))=PSD(PSDU))&($O(^PSD(58.81,"ACT",PSDT,PSDLOC,PSD(PSDU),9,0)))  Q:PSDOUT
"RTN","PSDADJD",43,0)
 ..S PSDR(2)=$G(^PSD(58.81,+$O(^PSD(58.81,"ACT",PSDT,PSDLOC,PSD(PSDU),9,0)),0))
"RTN","PSDADJD",44,0)
 ..D:$Y+7>IOSL HEADER Q:PSDOUT
"RTN","PSDADJD",45,0)
 ..S PSDT(1)=$G(PSDT(1))+1 W:PSDT(1)=1 !,PSDU,!
"RTN","PSDADJD",46,0)
 ..S Y=$E($P(PSDR(2),U,4),1,12) X ^DD("DD") W !,Y,"  "," -> "
"RTN","PSDADJD",47,0)
 ..W $P(PSDR(2),U,6)," adjusted by ",$P($G(^VA(200,+$P(PSDR(2),U,7),0)),U),!!
"RTN","PSDADJD",48,0)
 ..W "Reason:  ",$P(PSDR(2),U,16),!
"RTN","PSDADJD",49,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSDADJD",50,0)
 I $E(IOST)="C",'PSDOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSDADJD",51,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSDADJD",52,0)
 Q
"RTN","PSDADJD",53,0)
HEADER ;prints header info
"RTN","PSDADJD",54,0)
 I $E(IOST,1,2)'="P-",PG S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDADJD",55,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSDOUT=1
"RTN","PSDADJD",56,0)
 W:$Y @IOF S $P(LN,"-",80)="",PG=PG+1 W !,"Adjustments from ",PSDTB(2)," to ",PSDTB(3),?70,"PAGE: ",PG,!,LN W:$G(PSDT(1)) !,PSDU," (continued)",!
"RTN","PSDADJD",57,0)
 ;
"RTN","PSDADJD",58,0)
CHK ;(DAVE B 26OCT99)
"RTN","PSDADJD",59,0)
 ;PSD*3*18 Had to change looking at 9.4 directly to FM calls (BS)
"RTN","PSDADJD",60,0)
 ;
"RTN","PSDADJD",61,0)
 S DIC="^DIC(9.4,",DIC(0)="QZ",X="VA FILEMAN" D ^DIC I +Y'>0 S GOOD=0 Q
"RTN","PSDADJD",62,0)
 S GOOD=$$GET1^DIQ(9.4,+Y,13,"I")
"RTN","PSDADJD",63,0)
 Q
"VER")
8.0^22.0
**END**
**END**
