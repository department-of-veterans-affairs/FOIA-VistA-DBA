Released FB*3.5*77 SEQ #74
Extracted from mail message
**KIDS**:FB*3.5*77^

**INSTALL NAME**
FB*3.5*77
"BLD",5021,0)
FB*3.5*77^FEE BASIS^0^3040714^y
"BLD",5021,1,0)
^^1^1^3040629^^
"BLD",5021,1,1,0)
CODE TEXT DESCRIPTORS
"BLD",5021,4,0)
^9.64PA^^
"BLD",5021,"KRN",0)
^9.67PA^8989.52^19
"BLD",5021,"KRN",.4,0)
.4
"BLD",5021,"KRN",.401,0)
.401
"BLD",5021,"KRN",.402,0)
.402
"BLD",5021,"KRN",.403,0)
.403
"BLD",5021,"KRN",.5,0)
.5
"BLD",5021,"KRN",.84,0)
.84
"BLD",5021,"KRN",3.6,0)
3.6
"BLD",5021,"KRN",3.8,0)
3.8
"BLD",5021,"KRN",9.2,0)
9.2
"BLD",5021,"KRN",9.8,0)
9.8
"BLD",5021,"KRN",9.8,"NM",0)
^9.68A^18^17
"BLD",5021,"KRN",9.8,"NM",1,0)
FBAAUTL4^^0^B19617855
"BLD",5021,"KRN",9.8,"NM",2,0)
FBAALU^^0^B32497405
"BLD",5021,"KRN",9.8,"NM",3,0)
FBAACR^^0^B16821556
"BLD",5021,"KRN",9.8,"NM",4,0)
FBPHON2^^0^B21396755
"BLD",5021,"KRN",9.8,"NM",5,0)
FBAACCB^^0^B28006172
"BLD",5021,"KRN",9.8,"NM",6,0)
FBXIP77E^^0^B3917072
"BLD",5021,"KRN",9.8,"NM",7,0)
FBAACO1^^0^B27913240
"BLD",5021,"KRN",9.8,"NM",8,0)
FBCHEP^^0^B31682040
"BLD",5021,"KRN",9.8,"NM",9,0)
FBAACP^^0^B33766747
"BLD",5021,"KRN",9.8,"NM",10,0)
FBCHPET^^0^B31972937
"BLD",5021,"KRN",9.8,"NM",11,0)
FBAAPET^^0^B34367757
"BLD",5021,"KRN",9.8,"NM",13,0)
FBPRICE1^^0^B8962799
"BLD",5021,"KRN",9.8,"NM",14,0)
FBAAPCS^^0^B69414377
"BLD",5021,"KRN",9.8,"NM",15,0)
FBAAMP1^^0^B7353018
"BLD",5021,"KRN",9.8,"NM",16,0)
FBCHEAP^^0^B16779482
"BLD",5021,"KRN",9.8,"NM",17,0)
FBAACO2^^0^B12950547
"BLD",5021,"KRN",9.8,"NM",18,0)
FBCSV1^^0^B18393988
"BLD",5021,"KRN",9.8,"NM","B","FBAACCB",5)

"BLD",5021,"KRN",9.8,"NM","B","FBAACO1",7)

"BLD",5021,"KRN",9.8,"NM","B","FBAACO2",17)

"BLD",5021,"KRN",9.8,"NM","B","FBAACP",9)

"BLD",5021,"KRN",9.8,"NM","B","FBAACR",3)

"BLD",5021,"KRN",9.8,"NM","B","FBAALU",2)

"BLD",5021,"KRN",9.8,"NM","B","FBAAMP1",15)

"BLD",5021,"KRN",9.8,"NM","B","FBAAPCS",14)

"BLD",5021,"KRN",9.8,"NM","B","FBAAPET",11)

"BLD",5021,"KRN",9.8,"NM","B","FBAAUTL4",1)

"BLD",5021,"KRN",9.8,"NM","B","FBCHEAP",16)

"BLD",5021,"KRN",9.8,"NM","B","FBCHEP",8)

"BLD",5021,"KRN",9.8,"NM","B","FBCHPET",10)

"BLD",5021,"KRN",9.8,"NM","B","FBCSV1",18)

"BLD",5021,"KRN",9.8,"NM","B","FBPHON2",4)

"BLD",5021,"KRN",9.8,"NM","B","FBPRICE1",13)

"BLD",5021,"KRN",9.8,"NM","B","FBXIP77E",6)

"BLD",5021,"KRN",19,0)
19
"BLD",5021,"KRN",19.1,0)
19.1
"BLD",5021,"KRN",101,0)
101
"BLD",5021,"KRN",409.61,0)
409.61
"BLD",5021,"KRN",771,0)
771
"BLD",5021,"KRN",870,0)
870
"BLD",5021,"KRN",8989.51,0)
8989.51
"BLD",5021,"KRN",8989.52,0)
8989.52
"BLD",5021,"KRN",8994,0)
8994
"BLD",5021,"KRN","B",.4,.4)

"BLD",5021,"KRN","B",.401,.401)

"BLD",5021,"KRN","B",.402,.402)

"BLD",5021,"KRN","B",.403,.403)

"BLD",5021,"KRN","B",.5,.5)

"BLD",5021,"KRN","B",.84,.84)

"BLD",5021,"KRN","B",3.6,3.6)

"BLD",5021,"KRN","B",3.8,3.8)

"BLD",5021,"KRN","B",9.2,9.2)

"BLD",5021,"KRN","B",9.8,9.8)

"BLD",5021,"KRN","B",19,19)

"BLD",5021,"KRN","B",19.1,19.1)

"BLD",5021,"KRN","B",101,101)

"BLD",5021,"KRN","B",409.61,409.61)

"BLD",5021,"KRN","B",771,771)

"BLD",5021,"KRN","B",870,870)

"BLD",5021,"KRN","B",8989.51,8989.51)

"BLD",5021,"KRN","B",8989.52,8989.52)

"BLD",5021,"KRN","B",8994,8994)

"BLD",5021,"PRE")
FBXIP77E
"BLD",5021,"QUES",0)
^9.62^^
"BLD",5021,"REQB",0)
^9.611^4^3
"BLD",5021,"REQB",2,0)
FB*3.5*69^2
"BLD",5021,"REQB",3,0)
ICPT*6.0*19^2
"BLD",5021,"REQB",4,0)
ICD*18.0*12^2
"BLD",5021,"REQB","B","FB*3.5*69",2)

"BLD",5021,"REQB","B","ICD*18.0*12",4)

"BLD",5021,"REQB","B","ICPT*6.0*19",3)

"MBREQ")
0
"PKG",344,-1)
1^1
"PKG",344,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",344,20,0)
^9.402P^1^1
"PKG",344,20,1,0)
2^^FBPMRG
"PKG",344,20,1,1)

"PKG",344,20,"B",2,1)

"PKG",344,22,0)
^9.49I^1^1
"PKG",344,22,1,0)
3.5^2950130^2950329
"PKG",344,22,1,"PAH",1,0)
77^3040714^100998
"PKG",344,22,1,"PAH",1,1,0)
^^1^1^3040714
"PKG",344,22,1,"PAH",1,1,1,0)
CODE TEXT DESCRIPTORS
"PRE")
FBXIP77E
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
17
"RTN","FBAACCB")
0^5^B28006172
"RTN","FBAACCB",1,0)
FBAACCB ;AISC/GRR-CLERK CLOSE BATCH ;8/7/2003
"RTN","FBAACCB",2,0)
 ;;3.5;FEE BASIS;**4,61,77**;JAN 30, 1995
"RTN","FBAACCB",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACCB",4,0)
 K QQ D DT^DICRW
"RTN","FBAACCB",5,0)
BT W !! S DIC="^FBAA(161.7,",DIC(0)="AEQ",DIC("S")=$S($D(^XUSEC("FBAASUPERVISOR",DUZ)):"I $G(^(""ST""))=""O""",1:"I $P(^(0),U,5)=DUZ&($G(^(""ST""))=""O"")") D ^DIC K DIC("S")
"RTN","FBAACCB",6,0)
 G Q^FBAACCB0:X="^"!(X=""),BT:Y<0 S B=+Y,FZ=^FBAA(161.7,B,0),FBTYPE=$P(FZ,"^",3)
"RTN","FBAACCB",7,0)
 I FBTYPE="B3",'$D(^FBAAC("AC",B)) W !!,*7,"No payments in Batch yet!",! G BT
"RTN","FBAACCB",8,0)
 I FBTYPE="B2",'$D(^FBAAC("AD",B)) W !!,*7,"No Payments in Batch yet!",! G BT
"RTN","FBAACCB",9,0)
 I FBTYPE="B5",'$D(^FBAA(162.1,"AE",B)) W !!,*7,"No Payments in Batch yet!",! G BT
"RTN","FBAACCB",10,0)
 I FBTYPE="B9",'$D(^FBAAI("AC",B)) W !!,*7,"No Payments in Batch yet!",! G BT
"RTN","FBAACCB",11,0)
RDD S DIR(0)="Y",DIR("A")="Want to review batch",DIR("B")="NO",DIR("?")="If you want a detail list of each payment line, answer ""Yes"" otherwise press Return key" D ^DIR K DIR
"RTN","FBAACCB",12,0)
 G BT:$D(DIRUT) W:Y @IOF D:Y LIST:FBTYPE="B3",LISTP:FBTYPE="B5",LISTT^FBAACCB0:FBTYPE="B2",LISTC^FBAACCB1:FBTYPE="B9"
"RTN","FBAACCB",13,0)
RDD1 S DIR(0)="Y",DIR("A")="Do you still want to close Batch",DIR("B")="YES" D ^DIR K DIR G BT:'Y!$D(DIRUT)
"RTN","FBAACCB",14,0)
 S C=0,T=0 G PHARM^FBAACCB1:FBTYPE="B5",TRAV^FBAACCB1:FBTYPE="B2",CHNH^FBAACCB1:FBTYPE="B9"
"RTN","FBAACCB",15,0)
 F J=0:0 S J=$O(^FBAAC("AC",B,J)) Q:J'>0  F K=0:0 S K=$O(^FBAAC("AC",B,J,K)) Q:K'>0  F L=0:0 S L=$O(^FBAAC("AC",B,J,K,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AC",B,J,K,L,M)) Q:M'>0  D GOT
"RTN","FBAACCB",16,0)
FIN S $P(FZ,"^",9)=T,$P(FZ,"^",11)=C
"RTN","FBAACCB",17,0)
 S $P(FZ,"^",13)=DT,^FBAA(161.7,B,0)=FZ,^FBAA(161.7,B,"ST")="C",^FBAA(161.7,"AC","C",B)="",DA=B,DR="0;ST" K ^FBAA(161.7,"AC","O",B),^FBAA(161.7,"AB","O",$P(^FBAA(161.7,B,0),"^",5),B) W !! D EN^DIQ W !!,"Batch Closed" G BT
"RTN","FBAACCB",18,0)
GOT S Y(0)=$G(^FBAAC(J,1,K,1,L,1,M,0)),FBIN=$P(Y(0),"^",16)
"RTN","FBAACCB",19,0)
 I $P(Y(0),"^",3)>0 S T=T+$P(Y(0),"^",3),C=C+1
"RTN","FBAACCB",20,0)
 Q
"RTN","FBAACCB",21,0)
LIST S Q="",$P(Q,"=",80)="="
"RTN","FBAACCB",22,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAACCB",23,0)
ENM D HED S (FBIN,FBINOLD)="",(FBAAOUT,FBINTOT)=0 F XY=0:0 S FBIN=$O(^FBAAC("AJ",B,FBIN)) Q:FBIN=""!($G(FBAAOUT))  D INTOT^FBAACCB0 F J=0:0 S J=$O(^FBAAC("AJ",B,FBIN,J)) Q:J'>0!($G(FBAAOUT))  D GMORE^FBAACCB0
"RTN","FBAACCB",24,0)
 I '$G(FBAAOUT) S FBIN=0 D INTOT^FBAACCB0
"RTN","FBAACCB",25,0)
 Q
"RTN","FBAACCB",26,0)
SET ;
"RTN","FBAACCB",27,0)
 N FBADJLA,FBADJLR,FBFPPSC,FBFPPSL,FBX,FBY3,TAMT
"RTN","FBAACCB",28,0)
 S N=$S($D(^DPT(J,0)):$P(^DPT(J,0),"^",1),1:""),S=$S(N]"":$P(^DPT(J,0),"^",9),1:""),V=$S($D(^FBAAV(K,0)):$P(^FBAAV(K,0),"^",1),1:""),VID=$S(V]"":$P(^(0),"^",2),1:"")
"RTN","FBAACCB",29,0)
 S D=+$G(^FBAAC(J,1,K,1,L,0)) Q:'D
"RTN","FBAACCB",30,0)
 S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) Q:Y']""
"RTN","FBAACCB",31,0)
 S FBY3=$G(^FBAAC(J,1,K,1,L,1,M,3))
"RTN","FBAACCB",32,0)
 S FBFPPSC=$P(FBY3,U)
"RTN","FBAACCB",33,0)
 S FBFPPSL=$P(FBY3,U,2)
"RTN","FBAACCB",34,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBAACCB",35,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAACCB",36,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAACCB",37,0)
 S T=$P(Y,"^",5),FBIN=$P(Y,"^",16),ZS=$P(Y,"^",20)
"RTN","FBAACCB",38,0)
 S TAMT=$FN($P(Y,"^",4),"",2)
"RTN","FBAACCB",39,0)
 S FBVP=$S($P(Y,"^",21)="VP":"#",1:"")
"RTN","FBAACCB",40,0)
 S FBAACPT=$$CPT^FBAAUTL4($P(Y,U))
"RTN","FBAACCB",41,0)
 S CPTDESC=$$CPT^FBAAUTL4($P(Y,U),1,D)
"RTN","FBAACCB",42,0)
 S FBVCHDT=$P(Y,"^",6),FBIN(1)=$P(Y,"^",15) D FBCKO^FBAACCB2(J,K,L,M)
"RTN","FBAACCB",43,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBAACCB",44,0)
GO S A1=$P(Y,"^",2)+.0001,A2=$P(Y,"^",3)+.0001,A1=$P(A1,".",1)_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".",1)_"."_$E($P(A2,".",2),1,2),FBINTOT=FBINTOT+A2
"RTN","FBAACCB",45,0)
 D WRT:FBTYPE'="B2",WRTT^FBAACCB0:FBTYPE="B2"
"RTN","FBAACCB",46,0)
 Q
"RTN","FBAACCB",47,0)
WRT I $Y+8>IOSL D ASKH^FBAACCB0:$E(IOST,1,2)["C-" Q:FBAAOUT  W @IOF D HED
"RTN","FBAACCB",48,0)
 S B(1617)=$S(B="":"",$D(^FBAA(161.7,B,0)):$P(^(0),"^"),1:"")
"RTN","FBAACCB",49,0)
 W !!,N,?35,$$SSN^FBAAUTL(J),?58,B(1617),?67,$$DATX^FBAAUTL($G(FBVCHDT)),!,?3,V,?42,VID,?55,FBIN,?67,$$DATX^FBAAUTL(FBIN(1))
"RTN","FBAACCB",50,0)
 W !,$S($D(QQ):QQ_")",1:""),$S(ZS="R":"*",1:""),$S(FBTYPE="B3":FBVP,1:""),$S(FBTYPE="B5":FBPV,1:""),$S($G(FBCAN)]"":"+",1:"")
"RTN","FBAACCB",51,0)
 I FBTYPE="B3" W ?4,$$DATX^FBAAUTL(D),?14,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:""),?24,CPTDESC,?54,FBFPPSC,?66,FBFPPSL
"RTN","FBAACCB",52,0)
 I FBTYPE="B5" W ?4,$$DATX^FBAAUTL(D),?14,FBAACPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:""),?24,CPTDESC,?56,FBFPPSC,?68,FBFPPSL
"RTN","FBAACCB",53,0)
 I $P($G(FBMODLE),",",2)]"" D  Q:FBAAOUT
"RTN","FBAACCB",54,0)
 . N FBI,FBMOD
"RTN","FBAACCB",55,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D  Q:FBAAOUT
"RTN","FBAACCB",56,0)
 . . I $Y+5>IOSL D  Q:FBAAOUT
"RTN","FBAACCB",57,0)
 . . . I $E(IOST,1,2)="C-" D ASKH^FBAACCB0 Q:FBAAOUT
"RTN","FBAACCB",58,0)
 . . . W @IOF D HED W !,"(continued)"
"RTN","FBAACCB",59,0)
 . . W !,?19,"-",FBMOD
"RTN","FBAACCB",60,0)
 W !?4,$J(A1,6),?17,$J(A2,6)
"RTN","FBAACCB",61,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBAACCB",62,0)
 W ?30,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBAACCB",63,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBAACCB",64,0)
 W ?41,$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBAACCB",65,0)
 D PMNT^FBAACCB2 S FBINOLD=FBIN
"RTN","FBAACCB",66,0)
 Q
"RTN","FBAACCB",67,0)
HED W "Patient Name",?20,"('*' Reimbursement to Patient   '+' Cancellation Activity)",!,?13,"('#' Voided Payment)",?58,"Batch #",?67,"Voucher Date"
"RTN","FBAACCB",68,0)
 W !,?3,"Vendor Name",?42,"Vendor ID",?53,"Invoice #",?67,"Date Rec'd."
"RTN","FBAACCB",69,0)
 I FBTYPE="B3" D
"RTN","FBAACCB",70,0)
 . W !,?4,"SVC DATE",?14,"CPT-MOD",?24,"SERVICE PROVIDED",?54,"FPPS CLAIM",?66,"FPPS LINE"
"RTN","FBAACCB",71,0)
 . W !,?4,"CLAIMED",?17,"PAID",?30,"ADJ CODE",?41,"ADJ AMOUNT"
"RTN","FBAACCB",72,0)
 I FBTYPE="B5" D
"RTN","FBAACCB",73,0)
 . W !,?4,"RX  DATE",?14,"RX #",?24,"DRUG NAME",?56,"FPPS CLAIM",?68,"FPPS LINE"
"RTN","FBAACCB",74,0)
 . W !,?4,"CLAIMED",?17,"PAID",?30,"ADJ CODE",?41,"ADJ AMOUNT"
"RTN","FBAACCB",75,0)
 W !,Q,!
"RTN","FBAACCB",76,0)
 Q
"RTN","FBAACCB",77,0)
LISTP S Q="",$P(Q,"=",80)="="
"RTN","FBAACCB",78,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","FBAACCB",79,0)
ENP D HED S (FBAAOUT,FBINTOT)=0,FBINOLD=""
"RTN","FBAACCB",80,0)
 F A=0:0 S A=$O(^FBAA(162.1,"AE",B,A)) Q:A'>0!($G(FBAAOUT))  S FBIN=A D SETV^FBAACCB0 F B2=0:0 S B2=$O(^FBAA(162.1,"AE",B,A,B2)) Q:B2'>0!($G(FBAAOUT))  D INTOT^FBAACCB0 I $D(^FBAA(162.1,A,"RX",B2,0)) S Z(0)=^(0) D MORE^FBAACCB1
"RTN","FBAACCB",81,0)
 I '$G(FBAAOUT) S FBIN=0 D INTOT^FBAACCB0
"RTN","FBAACCB",82,0)
 Q
"RTN","FBAACO1")
0^7^B27913240
"RTN","FBAACO1",1,0)
FBAACO1 ;AISC/GRR-ENTER PAYMENT CONTINUED ;7/17/2003
"RTN","FBAACO1",2,0)
 ;;3.5;FEE BASIS;**4,61,77**;JAN 30, 1995
"RTN","FBAACO1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACO1",4,0)
SVCPR ;set up service provided multiple
"RTN","FBAACO1",5,0)
 I '$D(^FBAAC(DFN,1,FBV,1,FBSDI,1,0)) S ^FBAAC(DFN,1,FBV,1,FBSDI,1,0)="^162.03A^0^0"
"RTN","FBAACO1",6,0)
 W ! S DLAYGO=162,DIC="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",DIC(0)=$S($G(FBCNP):"QL",1:"EQL"),X=""""_FBX_"""",DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI
"RTN","FBAACO1",7,0)
 D
"RTN","FBAACO1",8,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBAACO1",9,0)
 K DIC,DLAYGO,DA I Y<0 S FBAAOUT=1 Q
"RTN","FBAACO1",10,0)
 S (FBAACPI,DA)=+Y
"RTN","FBAACO1",11,0)
 ;
"RTN","FBAACO1",12,0)
 ; update zip code and anesthesia time
"RTN","FBAACO1",13,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO1",14,0)
 K DA S DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI,DA=FBAACPI
"RTN","FBAACO1",15,0)
 S DR="42////^S X=$G(FBZIP);43////^S X=$G(FBTIME)"
"RTN","FBAACO1",16,0)
 D ^DIE K DIE,DA,DR
"RTN","FBAACO1",17,0)
 ;
"RTN","FBAACO1",18,0)
 ; create CPT MODIFIER entries from data in array FBMODA
"RTN","FBAACO1",19,0)
 D REPMOD^FBAAUTL4(DFN,FBV,FBSDI,FBAACPI)
"RTN","FBAACO1",20,0)
 ;
"RTN","FBAACO1",21,0)
 Q
"RTN","FBAACO1",22,0)
 ;
"RTN","FBAACO1",23,0)
PPT(FBDEF) ;establishes prompt pay type for entry
"RTN","FBAACO1",24,0)
 ;fbaamm=ppt if 1 ask for each line item; if 0 don't ask
"RTN","FBAACO1",25,0)
 ;fbaamm1=the ppt for each line item
"RTN","FBAACO1",26,0)
 ;FBDEF=(optional) default for DIR prompt: =1 for yes, otherwise no
"RTN","FBAACO1",27,0)
 N Y I FBAAMM="" S FBAAMM1="" Q
"RTN","FBAACO1",28,0)
 I FBAAMM=1 F  D  Q:Y]""
"RTN","FBAACO1",29,0)
 . S DIR(0)="Y",DIR("A")="Is this line item for a contracted service"
"RTN","FBAACO1",30,0)
 . S DIR("B")=$S($G(FBDEF)=1:"Yes",1:"No")
"RTN","FBAACO1",31,0)
 . S DIR("?")="Answering no indicates that interest will not be paid for this line item."
"RTN","FBAACO1",32,0)
 . D ^DIR K DIR I $D(DIRUT) W !,$C(7),"Required Response!" S Y=""
"RTN","FBAACO1",33,0)
 S FBAAMM1=$S(Y=1:1,1:"")
"RTN","FBAACO1",34,0)
 Q
"RTN","FBAACO1",35,0)
Q K FBAADT,FBX,FBAACP W:FBINTOT>0 !!,"Invoice: "_FBAAIN_"  Totals $ "_$J(FBINTOT,1,2) G Q^FBAACO:$D(FB583),1^FBAACO:'$D(FBCHCO) Q
"RTN","FBAACO1",36,0)
 ;
"RTN","FBAACO1",37,0)
POS ; prompt for place of service
"RTN","FBAACO1",38,0)
 ; output
"RTN","FBAACO1",39,0)
 ;   FBHCFA(30) = place of service (internal)
"RTN","FBAACO1",40,0)
 N Y
"RTN","FBAACO1",41,0)
 S FBHCFA(30)=""
"RTN","FBAACO1",42,0)
 S DIR(0)="P^353.1:EMZ"
"RTN","FBAACO1",43,0)
 D ^DIR K DIR I $D(DIRUT) Q
"RTN","FBAACO1",44,0)
 S FBHCFA(30)=$P(Y,U)
"RTN","FBAACO1",45,0)
 Q
"RTN","FBAACO1",46,0)
 ;
"RTN","FBAACO1",47,0)
GETVEN ;select vendor from vendor file
"RTN","FBAACO1",48,0)
 W !! S DLAYGO=161.2,DIC="^FBAAV(",DIC(0)="AEQLM" D ^DIC K DLAYGO I X="^"!(X="") S FBAAOUT=1 Q
"RTN","FBAACO1",49,0)
 ;if new vendor, call in to new vendor setup routine
"RTN","FBAACO1",50,0)
 G GETVEN:Y<0 S DA=+Y,DIE=DIC D:$P(Y,"^",3)=1 NEW^FBAAVD K DIE,DIC,DR,X,DLAYGO
"RTN","FBAACO1",51,0)
GETVEN1 I $D(FB583) S DA=FBVEN
"RTN","FBAACO1",52,0)
 I $D(^FBAAV(DA,0)),$P($G(^("ADEL")),U)="Y" W !!,$C(7),"Vendor has been flagged for Austin deletion!" G GETVEN:'$D(FB583) S FBAAOUT=1 Q
"RTN","FBAACO1",53,0)
 D:$P(FBSITE(0),"^",11)="Y" EN1^FBAAVD
"RTN","FBAACO1",54,0)
GETVEN2 I $P(FBSITE(0),"^",11)="Y",$D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ)) S DIR(0)="Y",DIR("A")="Want to Edit data",DIR("B")="NO" D ^DIR K DIR S:$D(DIRUT) FBAAOUT=1 Q:$D(DIRUT)  D:Y EDITV^FBAAVD
"RTN","FBAACO1",55,0)
 I $P(FBSITE(0),"^",11)'="Y"!('$D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ))) S DIR(0)="E" D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACO1",56,0)
 S FBV=DA,FBAR(DA)="" D ^FBAACO4
"RTN","FBAACO1",57,0)
 Q
"RTN","FBAACO1",58,0)
 ;
"RTN","FBAACO1",59,0)
GETINV ;assign invoice number or select existing invoice number
"RTN","FBAACO1",60,0)
 K FBAAOUT S FBINTOT=0 S DIR(0)="Y",DIR("A")="Want a new Invoice number assigned",DIR("B")="YES" D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACO1",61,0)
 I Y D GETNXI^FBAAUTL W !!,"Invoice # ",FBAAIN," assigned to this Invoice" Q
"RTN","FBAACO1",62,0)
GETINV1 ;selects existing invoice if user does not choose to assign new number
"RTN","FBAACO1",63,0)
 S DIR(0)="N",DIR("A")="Select Invoice number",DIR("?")="Select one of the previously entered Invoice #'s" D ^DIR K DIR I $D(DIRUT)!(X="") G GETINV:'$G(FB583) S FBAAOUT=1 Q
"RTN","FBAACO1",64,0)
 D CHK1^FBAACO4 G GETINV1:'$G(FBAACK1) K FBAACK1
"RTN","FBAACO1",65,0)
 I '$D(^FBAAC("AJ",FBAABE,X)) D  G GETINV1
"RTN","FBAACO1",66,0)
 . W !,$C(7),"Only previously entered invoices in the same batch may be selected!"
"RTN","FBAACO1",67,0)
 S FBAAIN=X D CALC^FBAACO3 W:FBINTOT>0 ?33,"Current Total: $ "_$J(FBINTOT,1,2)
"RTN","FBAACO1",68,0)
 Q
"RTN","FBAACO1",69,0)
 ;
"RTN","FBAACO1",70,0)
GETINDT ;get invoice dates
"RTN","FBAACO1",71,0)
 ;input requires FBAABDT (authorization from date)
"RTN","FBAACO1",72,0)
 K FBAAOUT W !,"Enter Date Correct Invoice Received or Last Date of Service" S %DT("A")="(whichever is later): " S:$G(FBAAID) %DT("B")=$$DATX^FBAAUTL(FBAAID) I $G(FBCNH) S %DT(0)=$G(FBENDDT)
"RTN","FBAACO1",73,0)
 S %DT="AEXP" D ^%DT K %DT I X="^"!(X="") S FBAAOUT=1 Q
"RTN","FBAACO1",74,0)
 S FBAAID=Y I '$G(FBCNP) I FBAAID<FBAABDT W !!,$C(7),"Invoice date is earlier than Patient's Authorization date!!" K FBAAID G GETINDT
"RTN","FBAACO1",75,0)
GETIND1 W ! S %DT("A")="Enter Vendor Invoice Date: ",%DT="AEXP" S:$G(FBAAVID) %DT("B")=$$DATX^FBAAUTL(FBAAVID) D ^%DT K %DT G GETINDT:X="" I X="^" S FBAAOUT=1 Q
"RTN","FBAACO1",76,0)
 S FBAAVID=Y I FBAAVID>FBAAID W !!,$C(7),"Vendor's invoice date is later than the date you received it!!" K FBAAVID G GETIND1
"RTN","FBAACO1",77,0)
 Q
"RTN","FBAACO1",78,0)
 ;
"RTN","FBAACO1",79,0)
DISPINV ;display invoice totals
"RTN","FBAACO1",80,0)
 ;required inputs FBAADT (auth dt),DFN
"RTN","FBAACO1",81,0)
 S H=$E(FBAADT,1,5)_"00",R=9999999.9999-H,S=$E(FBAADT,1,5)_31,S=9999999.9999-S,G=+$E(FBAADT,4,5)_+$E(FBAADT,2,3) D CKMAX^FBAACO3
"RTN","FBAACO1",82,0)
 S FBTPD=0 I $D(^FBAAC(DFN,3,"AB",FBAADT)) S FBZX=$O(^FBAAC(DFN,3,"AB",FBAADT,0)) I $D(^FBAAC(DFN,3,FBZX,0)) W !!,"$ ",$P(^(0),"^",3)," for travel already entered for this date of service" S FBTPD=1
"RTN","FBAACO1",83,0)
 W:'$D(FBCHCO) !!,"Total already paid on ID Card for month:   $ ",A,"   Maximum allowed: $ ",$P(FBSITE(1),"^",9),!,"Total already paid on All/Other for month: $ ",FBAOT
"RTN","FBAACO1",84,0)
 Q
"RTN","FBAACO2")
0^17^B12950547
"RTN","FBAACO2",1,0)
FBAACO2 ;AISC/GRR-PAYMENT PROCESS FOR DUPLICATE ;7/13/2003
"RTN","FBAACO2",2,0)
 ;;3.5;FEE BASIS;**4,55,61,77**;JAN 30, 1995
"RTN","FBAACO2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACO2",4,0)
RD S DIR(0)="Y",DIR("A")="Want this payment stored as a Medical Denial",DIR("B")="YES",DIR("?")="Enter 'Yes' to store payment entry as a denial and send a Suspension letter.  Enter 'No' to have nothing happen." D ^DIR K DIR Q:$D(DIRUT)!('Y)
"RTN","FBAACO2",5,0)
 S FBDEN=1 Q
"RTN","FBAACO2",6,0)
FILE ;files sp multiple entry
"RTN","FBAACO2",7,0)
 K DR S TP="" I $G(FBDEN) S FBAMTPD=0
"RTN","FBAACO2",8,0)
 S DR="49///^S X=$G(FBCSID);50///^S X=$G(FBFPPSC);I $G(FBDEN) S Y=1;48;47//1;S FBUNITS=X;S:$G(FBFPPSC)="""" Y=""@11"";S FBX=$$FPPSL^FBUTL5();S:FBX=-1 Y=0;51///^S X=FBX;@11"
"RTN","FBAACO2",9,0)
 S DR(1,162.03,1)="D PPT^FBAACO1();34///^S X=$G(FBAAMM1);D POS^FBAACO1;S:'$G(FBHCFA(30)) Y=0;1;S J=X;I $G(FBDEN) S Y=2;D FEE^FBAACO0;44////^S X=FBFSAMT;45///^S X=FBFSUSD;2///^S X=FBAMTPD;S K=X"
"RTN","FBAACO2",10,0)
 ;S DR(1,162.03,2)="S:J-K=0 Y=6;3//^S X=$S(J-K:J-K,1:"""");S:'X Y=6;3.5///^S X=DT;@4;4;I X']"""" D SC^FBAACO3;S:X'=4 Y=6;22;6////^S X=DUZ"
"RTN","FBAACO2",11,0)
 S DR(1,162.03,2)="S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2);S:FBX=0 Y=0;6////^S X=DUZ"
"RTN","FBAACO2",12,0)
 S DR(1,162.03,3)="7////^S X=FBAABE;8////^S X=BO;13///^S X=FBAAID;14///^S X=FBAAIN;33///^S X=FBAAVID;I $G(FBDEN) S FBTST=1"
"RTN","FBAACO2",13,0)
 I '$G(FBDEN) D
"RTN","FBAACO2",14,0)
 .N FBCSVSTR S FBCSVSTR="I X]"""" S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@1"";"
"RTN","FBAACO2",15,0)
 .S DR(1,162.03,4)="S:$$EXTPV^FBAAUTL5(FBPOV)=""01"" Y=""@1"";S:FB7078]""""!($D(FB583)) Y=30;@5;28R;S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@5"";30////^S X=FBHCFA(30);31;32R;S Y=15;@1;28;"_FBCSVSTR_"30////^S X=FBHCFA(30);31"
"RTN","FBAACO2",16,0)
 .S DR(1,162.03,5)="15///^S X=FBPT;S FBX=$$RR^FBUTL4(.FBRRMK,2);S:FBX=0 Y=0"
"RTN","FBAACO2",17,0)
 .S DR(1,162.03,6)="16////^S X=FBPOV;17///^S X=FBTT;18///^S X=FBAAPTC;23////^S X=FBTYPE;26////^S X=FBPSA;S:$D(FBV583) Y=""@2"";27////^S X=FB7078;S Y=""@99"";@2;27////^S X=FBV583;@99;S FBTST=1"
"RTN","FBAACO2",18,0)
 S DIE="^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,"
"RTN","FBAACO2",19,0)
 S DA(3)=DFN,DA(2)=FBV,DA(1)=FBSDI,DA=FBAACPI
"RTN","FBAACO2",20,0)
 D LOCK^FBUCUTL("^FBAAC("_DFN_",1,"_FBV_",1,"_FBSDI_",1,",FBAACPI,1)
"RTN","FBAACO2",21,0)
 D
"RTN","FBAACO2",22,0)
 . N ICDVDT S ICDVDT=$G(FBAADT) D ^DIE
"RTN","FBAACO2",23,0)
 I '$D(DTOUT),$G(FBTST) D
"RTN","FBAACO2",24,0)
 . D FILEADJ^FBAAFA(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBADJ)
"RTN","FBAACO2",25,0)
 . D FILERR^FBAAFR(FBAACPI_","_FBSDI_","_FBV_","_DFN_",",.FBRRMK)
"RTN","FBAACO2",26,0)
 L -^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI)
"RTN","FBAACO2",27,0)
 I $D(DTOUT) D KILL Q
"RTN","FBAACO2",28,0)
 I '$G(FBTST),$G(DA) S DIR(0)="YA",DIR("A")="Entering an '^' will delete "_$S($G(FBDEN):"denial",1:"payment")_".  Are you sure you want to delete? ",DIR("B")="No" D ^DIR K DIR G FILE:'$D(DIRUT)&('Y) D KILL Q
"RTN","FBAACO2",29,0)
 K FBTST,FBDEN,FBAAMM1,DIE,DR,DA,FBX
"RTN","FBAACO2",30,0)
 I $D(FBDL) S FBAAOUT=1 Q
"RTN","FBAACO2",31,0)
 Q
"RTN","FBAACO2",32,0)
KILL S DIK=DIE D ^DIK K DIE,DIK I '$G(FBCNP) D Q^FBAACO S FBAAOUT=1
"RTN","FBAACO2",33,0)
 W !,"Deleted" Q
"RTN","FBAACP")
0^9^B33766747
"RTN","FBAACP",1,0)
FBAACP ;AISC/CMR-C&P PAYMENT DRIVER ;7/13/2003
"RTN","FBAACP",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,77**;JAN 30, 1995
"RTN","FBAACP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACP",4,0)
 K FBAAOUT,FBPOP S FBCNP=1 ;C&P flag
"RTN","FBAACP",5,0)
 D SITE^FBAACO G Q:$G(FBPOP) D BT^FBAACO G Q:$G(FBAAOUT)
"RTN","FBAACP",6,0)
1 K FBAR,FBAAOUT,FBDL,FBAAMM D GETVEN1^FBAACO1:$D(FB583),GETVEN^FBAACO1:'$D(FB583) G CLN:$G(FBAAOUT)
"RTN","FBAACP",7,0)
 D GETINV^FBAACO1 G CLN:$G(FBAAOUT)
"RTN","FBAACP",8,0)
 D GETINDT^FBAACO1 G CLN:$G(FBAAOUT)
"RTN","FBAACP",9,0)
 D MMPPT^FBAACP G CLN:$G(FBAAOUT)
"RTN","FBAACP",10,0)
SVDT W !! S %DT="AEXP",%DT("A")="Date of Service: " D ^%DT I X="^" G CLN
"RTN","FBAACP",11,0)
 I Y<0!(Y>FBAAID) W *7,!!,"Enter the date the Vendor provided the service to the Patient.",!,"The date must be prior to the date the invoice is received.",! G SVDT
"RTN","FBAACP",12,0)
 S FBAADT=Y D SETO^FBAACO3,CPTM^FBAALU(FBAADT) I 'FBGOT G CLN
"RTN","FBAACP",13,0)
 ; prompt revenue code
"RTN","FBAACP",14,0)
 S FBAARC=$$ASKREVC^FBUTL5() I FBAARC="^" S FBAAOUT=1 G CLN
"RTN","FBAACP",15,0)
 ; prompt units paid
"RTN","FBAACP",16,0)
 S FBUNITS=$$ASKUNITS^FBUTL5() I FBUNITS="^" S FBAAOUT=1 G CLN
"RTN","FBAACP",17,0)
 D ASKZIP^FBAAFS($G(FBV),$G(FBAADT)) I $G(FBAAOUT)!($G(FBZIP)']"") G CLN
"RTN","FBAACP",18,0)
 I $$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) D ASKTIME^FBAAFS I $G(FBAAOUT)!('$G(FBTIME)) G CLN
"RTN","FBAACP",19,0)
 D HCFA G CLN:$G(FBAAOUT)
"RTN","FBAACP",20,0)
 S FBAAAMT=0 D AMTPD I $G(FBAAOUT)!('$G(FBAAAMT)) G CLN
"RTN","FBAACP",21,0)
 ; prompt for remittance remarks
"RTN","FBAACP",22,0)
 I $$RR^FBUTL4(.FBRRMK,2)=0 S FBAAOUT=1 G CLN
"RTN","FBAACP",23,0)
MULT ;begin unique patient entry
"RTN","FBAACP",24,0)
 W:FBINTOT>0 !,"Invoice: "_FBAAIN_" Totals: $ "_FBINTOT
"RTN","FBAACP",25,0)
 K FBAAOUT,FBDL S (DFN,FTP)="" D SITE^FBAACO G Q:$G(FBPOP) W !!
"RTN","FBAACP",26,0)
 I '$D(FB583) K FBDL D GETVET^FBAAUTL1 G CLN:'DFN K FBDMRA D GETAUTH^FBAAUTL1 G MULT:FTP']""
"RTN","FBAACP",27,0)
 K FBAAOUT D  G Q:$G(FBAAOUT)
"RTN","FBAACP",28,0)
 . N ICDVDT S ICDVDT=$G(FBAADT)
"RTN","FBAACP",29,0)
 . F  D  Q:$G(FBAAOUT)  Q:($$INPICD9^FBCSV1(+$G(Y),"",$G(FBAADT))=0)
"RTN","FBAACP",30,0)
 . . S I=28,DIR(0)="PO^80:EMQZ",DIR("A")="PRIMARY DIAGNOSIS" D DIR
"RTN","FBAACP",31,0)
 D PAT^FBAACO W !! D FILEV^FBAACO5(DFN,FBV) I $G(FBAAOUT) G Q:$D(FB583),CLN
"RTN","FBAACP",32,0)
 ;check for payments against all linked vendors
"RTN","FBAACP",33,0)
 S DA=+Y D CHK^FBAACO4 K FBAACK1,FBAAOUT,DA,X,Y
"RTN","FBAACP",34,0)
 W !! D GETSVDT^FBAACO5(DFN,FBV,FBASSOC,0,FBAADT) I $G(FBAAOUT) D AUTHQ^FBAACO G MULT
"RTN","FBAACP",35,0)
 D SETO^FBAACO3,CHK2^FBAACO4 I FBJ']"" G SVPR
"RTN","FBAACP",36,0)
CHKE ;determines what action to take on duplicate services entered
"RTN","FBAACP",37,0)
 K FBAAOUT W !!,*7,"Service selected for that date already in system."
"RTN","FBAACP",38,0)
 S DIR(0)="Y",DIR("A")="Do you want to add another service for the SAME DATE",DIR("B")="No" D ^DIR K DIR G SVPR:Y I $D(DIRUT) D DEL^FBAACO3 G Q
"RTN","FBAACP",39,0)
 W !!,*7,"You must use the 'EDIT PAYMENT' option to edit the service previously",!,"entered for that date." D DEL^FBAACO3
"RTN","FBAACP",40,0)
 G MULT
"RTN","FBAACP",41,0)
SVPR K FBAAOUT D SVCPR^FBAACO1 G CHKE:$G(FBAAOUT)
"RTN","FBAACP",42,0)
 D FILE^FBAACP1 I Z1>(FBAAMPI-1) W !!,*7,"You have reached the maximum number of payments for a batch!",!,"You must select another Batch for entering Payments!" G CLN
"RTN","FBAACP",43,0)
 G MULT
"RTN","FBAACP",44,0)
Q ;kill variables and exit
"RTN","FBAACP",45,0)
 D Q^FBAACO
"RTN","FBAACP",46,0)
 Q
"RTN","FBAACP",47,0)
AMTPD ;get amount paid
"RTN","FBAACP",48,0)
 N FBX
"RTN","FBAACP",49,0)
 S FBFY=FY-1
"RTN","FBAACP",50,0)
 S (FBAMTPD,FBFSAMT,FBFSUSD)=""
"RTN","FBAACP",51,0)
 S FBX=$$GET^FBAAFS($$CPT^FBAAUTL4(FBAACP),$$MODL^FBAAUTL4("FBMODA","E"),FBAADT,$G(FBZIP),$$FAC^FBAAFS($G(FBHCFA(30))),$G(FBTIME))
"RTN","FBAACP",52,0)
 ;
"RTN","FBAACP",53,0)
 I '$G(FBAAMM1) D
"RTN","FBAACP",54,0)
 . S FBFSAMT=$P(FBX,U),FBFSUSD=$P(FBX,U,2)
"RTN","FBAACP",55,0)
 E  D
"RTN","FBAACP",56,0)
 . W !,?2,"Payment is for a contracted service so fee schedule does not apply."
"RTN","FBAACP",57,0)
 ;
"RTN","FBAACP",58,0)
 I $P($G(FBX),U)]"" D
"RTN","FBAACP",59,0)
 . W !?2,$S($G(FBAAMM1):"However, f",1:"F")
"RTN","FBAACP",60,0)
 . W "ee schedule amount is $",$P(FBX,U)," from the "
"RTN","FBAACP",61,0)
 . W:$P(FBX,U,3)]"" $P(FBX,U,3)," " ; year if returned
"RTN","FBAACP",62,0)
 . W:$P(FBX,U,2)]"" $$EXTERNAL^DILFD(162.03,45,"",$P(FBX,U,2))
"RTN","FBAACP",63,0)
 E  W !?2,"Unable to determine a FEE schedule amount."
"RTN","FBAACP",64,0)
 ;
"RTN","FBAACP",65,0)
 I $G(FBUNITS)>1 D
"RTN","FBAACP",66,0)
 . W !!?2,"Units Paid = ",FBUNITS
"RTN","FBAACP",67,0)
 . Q:FBFSAMT'>0
"RTN","FBAACP",68,0)
 . N FBFSUNIT
"RTN","FBAACP",69,0)
 . ; determine if fee schedule can be multipled by units
"RTN","FBAACP",70,0)
 . S FBFSUNIT=$S(FBFSUSD="R":1,FBFSUSD="F"&(FBAADT>3040930):1,1:0)
"RTN","FBAACP",71,0)
 . I FBFSUNIT D
"RTN","FBAACP",72,0)
 . . S FBFSAMT=$J(FBFSAMT*FBUNITS,0,2)
"RTN","FBAACP",73,0)
 . . W !?2,"  Therefore, fee schedule amount increased to $",FBFSAMT
"RTN","FBAACP",74,0)
 . E  D
"RTN","FBAACP",75,0)
 . . W !?2,"  Fee schedule not complied on per unit basis so amount not adjusted by units."
"RTN","FBAACP",76,0)
 ;
"RTN","FBAACP",77,0)
 I '$G(FBAAMM1) S FBAMTPD=FBFSAMT
"RTN","FBAACP",78,0)
 ;
"RTN","FBAACP",79,0)
 I FBAMTPD=0 D  Q:$G(FBAAOUT)
"RTN","FBAACP",80,0)
 . ;if fee schedule = 0 write message and quit
"RTN","FBAACP",81,0)
 . W !,"You must use the Enter Payment option for CPT codes that have a",!,"Fee Schedule set equal to zero."
"RTN","FBAACP",82,0)
 . S FBAAOUT=1
"RTN","FBAACP",83,0)
 W !
"RTN","FBAACP",84,0)
 S DIR(0)="162.03,1",DIR("A")="Enter Amount Paid:  $",DIR("?")="Enter a dollar amount that does not exceed the FEE Schedule" S:FBAMTPD'="" DIR("B")=FBAMTPD D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACP",85,0)
 I $G(FBAMTPD),+Y>FBAMTPD&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"You must be a holder of the 'FBAASUPERVISOR' security key to",!,"exceed the FEE Schedule.  Enter an '^' to quit or accept the default.",! G AMTPD
"RTN","FBAACP",86,0)
 S FBAAAMT=+Y
"RTN","FBAACP",87,0)
 Q
"RTN","FBAACP",88,0)
HCFA ;get HCFA fields
"RTN","FBAACP",89,0)
 F I=28,30,31 S FBHCFA(I)=""
"RTN","FBAACP",90,0)
 W ! F I=30,31 S DIR(0)="P"_$S(I=30:"^353.1",I=31:"O^353.2")_":EMQZ" D DIR Q:$G(FBAAOUT)
"RTN","FBAACP",91,0)
 K DIR Q
"RTN","FBAACP",92,0)
DIR ;generic DIR call for HCFA
"RTN","FBAACP",93,0)
 D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S FBAAOUT=1 Q
"RTN","FBAACP",94,0)
 S:Y'=-1 FBHCFA(I)=$P(Y,"^")
"RTN","FBAACP",95,0)
 Q
"RTN","FBAACP",96,0)
CLN G Q:$D(FB583)
"RTN","FBAACP",97,0)
 D Q G FBAACP
"RTN","FBAACP",98,0)
 Q
"RTN","FBAACP",99,0)
MMPPT ;money management/prompt pay type for multiple payment entry
"RTN","FBAACP",100,0)
 ; input
"RTN","FBAACP",101,0)
 ;   FBAAPTC
"RTN","FBAACP",102,0)
 ; output
"RTN","FBAACP",103,0)
 ;   FBAAMM
"RTN","FBAACP",104,0)
 ;   FBAAMM1
"RTN","FBAACP",105,0)
 ;   FBAAOUT
"RTN","FBAACP",106,0)
 ;
"RTN","FBAACP",107,0)
 S (FBAAMM,FBAAMM1)=""
"RTN","FBAACP",108,0)
 I $G(FBAAPTC)'="R" D
"RTN","FBAACP",109,0)
 . W !,"The answer to the following will apply to all payments entered via this option."
"RTN","FBAACP",110,0)
 . S DIR(0)="Y"
"RTN","FBAACP",111,0)
 . S DIR("A")="Are payments for contracted services"
"RTN","FBAACP",112,0)
 . S DIR("B")="No"
"RTN","FBAACP",113,0)
 . S DIR("?",1)="Answering no indicates interest will not be paid for any line items."
"RTN","FBAACP",114,0)
 . S DIR("?",2)="Answering yes indicates interest will be paid."
"RTN","FBAACP",115,0)
 . S DIR("?",3)="A fee schedule is not used for contracted services."
"RTN","FBAACP",116,0)
 . S DIR("?")="Enter either 'Y' or 'N'."
"RTN","FBAACP",117,0)
 . D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAACP",118,0)
 . S (FBAAMM,FBAAMM1)=$S(Y:1,1:"")
"RTN","FBAACP",119,0)
 Q
"RTN","FBAACR")
0^3^B16821556
"RTN","FBAACR",1,0)
FBAACR ;AISC/CMR-OPT MED Cost Report ;6/1/1999
"RTN","FBAACR",2,0)
 ;;3.5;FEE BASIS;**4,77**;JAN 30, 1995
"RTN","FBAACR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACR",4,0)
 D DATE^FBAAUTL Q:FBPOP
"RTN","FBAACR",5,0)
 S VAR="BEGDATE^ENDDATE",VAL=BEGDATE_"^"_ENDDATE,PGM="START^FBAACR" D ZIS^FBAAUTL G END:FBPOP
"RTN","FBAACR",6,0)
START K ^TMP($J,"FBAACR") S (FBAAOUT,DFN,FBA,FBB,FBC)=0,BEGDT=BEGDATE-1,Q="-",$P(Q,"-",25)="-",QQ="=",$P(QQ,"=",80)="=" U IO W:$E(IOST,1,2)["C-" @IOF D HED
"RTN","FBAACR",7,0)
 F FBDT=BEGDT:0 S FBDT=$O(^FBAAC("AK",FBDT)) Q:FBDT'>0!(FBDT>ENDDATE)  F  S DFN=$O(^FBAAC("AK",FBDT,DFN)) Q:DFN'>0  F  S FBA=$O(^FBAAC("AK",FBDT,DFN,FBA)) Q:FBA'>0  D
"RTN","FBAACR",8,0)
 .F  S FBB=$O(^FBAAC("AK",FBDT,DFN,FBA,FBB)) Q:FBB'>0  F  S FBC=$O(^FBAAC("AK",FBDT,DFN,FBA,FBB,FBC)) Q:FBC'>0  S FBPMT=^FBAAC(DFN,1,FBA,1,FBB,1,FBC,0),FBSRVDT=+$G(^FBAAC(DFN,1,FBA,1,FBB,0)) I $P(FBPMT,"^",13)="" D
"RTN","FBAACR",9,0)
 ..S FBPTC=$P(FBPMT,"^",17),FBAMT=$P(FBPMT,"^",3),FBNAME=$$NAME^FBCHREQ2(DFN),FBCPT=$P(FBPMT,"^"),^TMP($J,"FBAACR",FBNAME)=DFN,^TMP($J,"FBAACR",FBNAME,FBA,FBB,FBC)=FBPTC_"^"_FBAMT_"^"_FBCPT_"^"_FBSRVDT
"RTN","FBAACR",10,0)
 S (FBNAME,FBNM)="",(FBA,FBB,FBC,DFN,FBPTC,FBAMT,FBPAMT,FBTAMT,FBCPT,FBCTR,FBTPT)=0
"RTN","FBAACR",11,0)
 F  S FBNAME=$O(^TMP($J,"FBAACR",FBNAME)) Q:FBNAME=""!(FBAAOUT)  S DFN=+^TMP($J,"FBAACR",FBNAME) S FBTPT=FBTPT+1,FBPCTR=0 D  D PSUM
"RTN","FBAACR",12,0)
 .F  S FBA=$O(^TMP($J,"FBAACR",FBNAME,FBA)) Q:FBA'>0!(FBAAOUT)  F  S FBB=$O(^TMP($J,"FBAACR",FBNAME,FBA,FBB)) Q:FBB'>0!(FBAAOUT)  F  S FBC=$O(^TMP($J,"FBAACR",FBNAME,FBA,FBB,FBC)) Q:FBC'>0!(FBAAOUT)  S FBCTR=FBCTR+1,FBPCTR=FBPCTR+1 D
"RTN","FBAACR",13,0)
 ..S FBPMT=^TMP($J,"FBAACR",FBNAME,FBA,FBB,FBC),FBPTC=$P(FBPMT,"^"),FBAMT=$P(FBPMT,"^",2),FBCPT=$$CPT^FBAAUTL4(+$P(FBPMT,"^",3),1,+$P(FBPMT,"^",4)),FBPAMT=FBPAMT+FBAMT,FBTAMT=FBTAMT+FBAMT D PRINT
"RTN","FBAACR",14,0)
 G END:FBAAOUT
"RTN","FBAACR",15,0)
 W !!,QQ,!!,"TOTAL PAYMENTS:  ",?25,$J(FBCTR,7),?40,"TOTAL PATIENTS:  ",?65,$J(FBTPT,7),!,"AVE. PAID FOR A PAYMENT:",?25 W:FBCTR>0 $J($FN(FBTAMT/FBCTR,",",2),10) W ?40,"AVE. PAID FOR A PATIENT:",?65 W:FBTPT>0 $J($FN(FBTAMT/FBTPT,",",2),10)
"RTN","FBAACR",16,0)
END K FBSRVDT,FBPMT,FBNAME,DFN,FBAAOUT,FBA,FBB,FBC,FBAMT,FBPTC,FBPAMT,FBTAMT,FBCTR,FBDT,FBCPT,FBNM,FBPCTR,FBPTC1,FBTPT,BEGDT,BEGDATE,ENDDATE,J,Q,QQ,^TMP($J,"FBAACR") D CLOSE^FBAAUTL
"RTN","FBAACR",17,0)
 Q
"RTN","FBAACR",18,0)
PRINT D CHK Q:FBAAOUT  S FBPTC1=""
"RTN","FBAACR",19,0)
 S:FBPTC="" FBPTC="99" F I=1:1:8 S J=$T(TEXT+I) I $P(J,";;",2)=FBPTC S FBPTC1=$P(J,";;",3) Q
"RTN","FBAACR",20,0)
 I FBNAME=FBNM W !?30,$E(FBPTC1,1,16),?48,$E(FBCPT,1,20),?70,$J($FN(FBAMT,",",2),10)
"RTN","FBAACR",21,0)
 I FBNAME'=FBNM W !!,$E(FBNAME,1,20),?22,$$SSN^FBAAUTL(DFN,1),?30,$E(FBPTC1,1,16),?48,$E(FBCPT,1,20),?70,$J($FN(FBAMT,",",2),10) S FBNM=FBNAME
"RTN","FBAACR",22,0)
 Q
"RTN","FBAACR",23,0)
HED W !?25,"OUTPATIENT COST REPORT",!?24,$$DATX^FBAAUTL(BEGDATE)," THROUGH ",$$DATX^FBAAUTL(ENDDATE),!,?24,Q,!!!,?21,"PATIENT",?31,"TREATING",!,"PATIENT NAME",?21,"  ID",?31,"SPECIALTY",?52,"CPT CODE",?69,"AMOUNT PAID",!,QQ
"RTN","FBAACR",24,0)
 Q
"RTN","FBAACR",25,0)
CHK I $Y+5>IOSL,$E(IOST,1,2)["C-" S DIR(0)="E" D ^DIR K DIR I 'Y S FBAAOUT=1 Q
"RTN","FBAACR",26,0)
 I $Y+5>IOSL W @IOF D HED
"RTN","FBAACR",27,0)
 Q
"RTN","FBAACR",28,0)
PSUM W !?70,"----------",!?70,$J($FN(FBPAMT,",",2),10)
"RTN","FBAACR",29,0)
 S FBPAMT=0
"RTN","FBAACR",30,0)
 Q
"RTN","FBAACR",31,0)
TEXT ;
"RTN","FBAACR",32,0)
 ;;00;;SURGICAL
"RTN","FBAACR",33,0)
 ;;10;;MEDICAL
"RTN","FBAACR",34,0)
 ;;60;;HOME NURSING SERVICE
"RTN","FBAACR",35,0)
 ;;85;;PSYCHIATRIC-CONTRACT
"RTN","FBAACR",36,0)
 ;;86;;PSYCHIATRIC
"RTN","FBAACR",37,0)
 ;;95;;NEUROLOGICAL-CONTRACT
"RTN","FBAACR",38,0)
 ;;96;;NEUROLOGICAL
"RTN","FBAACR",39,0)
 ;;99;;UNKNOWN
"RTN","FBAALU")
0^2^B32497405
"RTN","FBAALU",1,0)
FBAALU ;AISC/GRR,WCIOFO/SAB-CPT CODE & MODIFIER LOOKUP ;7/15/1999
"RTN","FBAALU",2,0)
 ;;3.5;FEE BASIS;**4,77**;JAN 30, 1995
"RTN","FBAALU",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAALU",4,0)
 ;
"RTN","FBAALU",5,0)
CPTM(FBDOS,FBDFN,FBCPT,FBMODL) ; Ask CPT Code and optional CPT Modifiers
"RTN","FBAALU",6,0)
 ; input
"RTN","FBAALU",7,0)
 ;   FBDOS - (optional) date of service, fileman format
"RTN","FBAALU",8,0)
 ;   FBDFN - (optional) patient DFN, pointer to file #2 and file #161
"RTN","FBAALU",9,0)
 ;   FBCPT - (optional) default CPT value (internal)
"RTN","FBAALU",10,0)
 ;   FBMODL- (optional) list of default modifiers (internal)
"RTN","FBAALU",11,0)
 ;                      delimited by commas
"RTN","FBAALU",12,0)
 ;                      only used when FBCPT accepted by user
"RTN","FBAALU",13,0)
 ; output
"RTN","FBAALU",14,0)
 ;   FBAACP  - CPT code (internal)
"RTN","FBAALU",15,0)
 ;             OR null if not selected
"RTN","FBAALU",16,0)
 ;             OR @ if default value (FBCPT) was supplied and user
"RTN","FBAALU",17,0)
 ;               entered an @ at the service provided prompt.
"RTN","FBAALU",18,0)
 ;   FBX     - CPT code (external) OR null if not selected
"RTN","FBAALU",19,0)
 ;   FBMODA( - (optional) CPT modifier array
"RTN","FBAALU",20,0)
 ;             FBMODA(#) = CPT modifier (internal)
"RTN","FBAALU",21,0)
 ;               where # is a integer greater than 0
"RTN","FBAALU",22,0)
 ;   FBGOT   - flag (0 or 1) =1 if CPT code was specified and confirmed
"RTN","FBAALU",23,0)
 ;
"RTN","FBAALU",24,0)
INIT ; initialize optional input variables and FBGOT
"RTN","FBAALU",25,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBAALU",26,0)
 N FBCATX,FBCPTX,FBEDIT,FBI,FBLAST,FBMOD,FBMODLE,FBMODX,FBTX
"RTN","FBAALU",27,0)
 S:$G(FBDOS)="" FBDOS=DT
"RTN","FBAALU",28,0)
 S FBDFN=$G(FBDFN)
"RTN","FBAALU",29,0)
 S FBGOT=0
"RTN","FBAALU",30,0)
 ;
"RTN","FBAALU",31,0)
ASKCPT ; prompt for CPT code
"RTN","FBAALU",32,0)
 S DIR(0)="PO^81:EMZ"
"RTN","FBAALU",33,0)
 S DIR("A")=$S($G(FBCPT)>0:"",1:"Select ")_"Service Provided"
"RTN","FBAALU",34,0)
 I $G(FBCPT)>0 S DIR("B")=$$CPT^FBAAUTL4(FBCPT)
"RTN","FBAALU",35,0)
 S DIR("?",1)="The Current Procedural Terminology Code (CPT Code) as"
"RTN","FBAALU",36,0)
 S DIR("?",2)="specified on the vendors invoice identifying the service"
"RTN","FBAALU",37,0)
 S DIR("?")="the vendor provided to the veteran."
"RTN","FBAALU",38,0)
 S ICPTVDT=$G(FBDOS) D ^DIR K DIR,ICPTVDT I $D(DTOUT)!$D(DUOUT) G EXIT
"RTN","FBAALU",39,0)
 I $G(FBCPT)]"",X="@" D  G:FBGOT EXIT G ASKCPT
"RTN","FBAALU",40,0)
 . S DIR(0)="Y"
"RTN","FBAALU",41,0)
 . S DIR("A")="SURE YOU WANT TO DELETE THE ENTIRE SERVICE PROVIDED"
"RTN","FBAALU",42,0)
 . D ^DIR K DIR I Y S FBGOT=1,FBAACP="@",FBX="" K FBMODA
"RTN","FBAALU",43,0)
 I Y>0 S FBAACP=+Y,FBX=$P(Y,U,2)
"RTN","FBAALU",44,0)
 E  G EXIT
"RTN","FBAALU",45,0)
 ; *** PASS 3RD PARAMETER TO INCLUDE VA NATIONAL/LOCAL CODES
"RTN","FBAALU",46,0)
 S FBCPTX=$$CPT^ICPTCOD(FBAACP,FBDOS,1)
"RTN","FBAALU",47,0)
 I '$P(FBCPTX,U,7) D  G ASKCPT
"RTN","FBAALU",48,0)
 . W $C(7),!,"     CPT code inactive on date of service ("
"RTN","FBAALU",49,0)
 . W $$FMTE^XLFDT(FBDOS),")"
"RTN","FBAALU",50,0)
 ;
"RTN","FBAALU",51,0)
 K FBMODA
"RTN","FBAALU",52,0)
 I $G(FBCPT)>0,FBCPT=FBAACP,$G(FBMODL)]"" D
"RTN","FBAALU",53,0)
 . N FBI,FBMOD
"RTN","FBAALU",54,0)
 . F FBI=1:1 S FBMOD=$P(FBMODL,",",FBI) Q:FBMOD=""  S FBMODA(FBI)=FBMOD
"RTN","FBAALU",55,0)
 ;
"RTN","FBAALU",56,0)
ASKMOD ; multiply prompt for CPT modifiers
"RTN","FBAALU",57,0)
 ; determine highest number used in list
"RTN","FBAALU",58,0)
 S FBLAST=$O(FBMODA(" "),-1)
"RTN","FBAALU",59,0)
 ; prompt for CPT modifier
"RTN","FBAALU",60,0)
 S DIR(0)="PO^81.3:EMZ"
"RTN","FBAALU",61,0)
 S DIR("A")="Select CPT MODIFIER"
"RTN","FBAALU",62,0)
 S DIR("?")="^D MODHLP^FBAALU"
"RTN","FBAALU",63,0)
 ; *** COMMENT FOLLOWING LINE IF ACCURACY OF API IS NOT FIXED
"RTN","FBAALU",64,0)
 ;S DIR("S")="I $$MODP^ICPTMOD(FBAACP,Y,""I"",FBDOS,1)>0"
"RTN","FBAALU",65,0)
 S FBMODLE=$$MODL^FBAAUTL4("FBMODA","E")
"RTN","FBAALU",66,0)
 W !!,"Current list of modifiers: ",$S(FBMODLE]"":FBMODLE,1:"none")
"RTN","FBAALU",67,0)
 S ICPTVDT=$G(FBDOS) D ^DIR K DIR,ICPTVDT I $D(DTOUT)!$D(DUOUT) G EXIT
"RTN","FBAALU",68,0)
 ; if value was entered then process it and ask another
"RTN","FBAALU",69,0)
 I +Y>0 D  G ASKMOD
"RTN","FBAALU",70,0)
 . S FBMOD=+Y
"RTN","FBAALU",71,0)
 . ; if specified CPT modifier already in list set FBEDIT = it's number
"RTN","FBAALU",72,0)
 . S (FBI,FBEDIT)=0 F  S FBI=$O(FBMODA(FBI)) Q:'FBI  D  Q:FBEDIT
"RTN","FBAALU",73,0)
 . . I FBMODA(FBI)=FBMOD S FBEDIT=FBI
"RTN","FBAALU",74,0)
 . ; if in list then edit the existing modifier
"RTN","FBAALU",75,0)
 . I FBEDIT D  Q:$D(DIRUT)
"RTN","FBAALU",76,0)
 . . S DIR(0)="PO^81.3:EMZ"
"RTN","FBAALU",77,0)
 . . S DIR("A")="  CPT MODIFIER"
"RTN","FBAALU",78,0)
 . . S DIR("B")=$$MOD^FBAAUTL4(FBMODA(FBEDIT))
"RTN","FBAALU",79,0)
 . . ; *** COMMENT FOLLOWING LINE IF ACCURACY OF API IS NOT FIXED
"RTN","FBAALU",80,0)
 . . ;S DIR("S")="I $$MODP^ICPTMOD(FBAACP,Y,""I"",FBDOS,1)>0"
"RTN","FBAALU",81,0)
 . . S ICPTVDT=$G(FBDOS) D ^DIR K DIR,ICPTVDT
"RTN","FBAALU",82,0)
 . . I X="@" K FBMODA(FBEDIT) W "   (deleted)" ; "@" removes from list
"RTN","FBAALU",83,0)
 . . I +Y>0 S FBMOD=+Y
"RTN","FBAALU",84,0)
 . ; validate entered modifier
"RTN","FBAALU",85,0)
 . S FBMODX=$$MOD^ICPTMOD(FBMOD,"I",FBDOS,1)
"RTN","FBAALU",86,0)
 . I '$P(FBMODX,U,7) D  Q
"RTN","FBAALU",87,0)
 . . W $C(7),!,"     CPT Modifier inactive on date of service ("
"RTN","FBAALU",88,0)
 . . W $$FMTE^XLFDT(FBDOS),")"
"RTN","FBAALU",89,0)
 . ; ensure new value of edited modifier is not already on list
"RTN","FBAALU",90,0)
 . I FBEDIT D  Q:FBMOD=""
"RTN","FBAALU",91,0)
 . . S FBI=0 F  S FBI=$O(FBMODA(FBI)) Q:'FBI  D  Q:FBMOD=""
"RTN","FBAALU",92,0)
 . . . I FBMODA(FBI)=FBMOD,FBI'=FBEDIT S FBMOD="" W !,$C(7),"     Change was not accepted because the new value is already on the list."
"RTN","FBAALU",93,0)
 . ; update list
"RTN","FBAALU",94,0)
 . I FBEDIT S FBMODA(FBEDIT)=FBMOD ; updated existing modifier
"RTN","FBAALU",95,0)
 . E  S FBLAST=FBLAST+1,FBMODA(FBLAST)=FBMOD ; added new modifier
"RTN","FBAALU",96,0)
 ;
"RTN","FBAALU",97,0)
DIS ; display entered data
"RTN","FBAALU",98,0)
 ; if default CPT code exists and default code and modifiers were not
"RTN","FBAALU",99,0)
 ;   changed then skip display and confirm steps.
"RTN","FBAALU",100,0)
 I $G(FBCPT)>0,FBCPT=FBAACP,$G(FBMODL)=$$MODL^FBAAUTL4("FBMODA","I") S FBGOT=1 G EXIT
"RTN","FBAALU",101,0)
 S FBCATX=$$CAT^ICPTAPIU($P(FBCPTX,U,4))
"RTN","FBAALU",102,0)
 W !!,"Major Category: " W:$P(FBCATX,U)'=-1 $P(FBCATX,U,4)
"RTN","FBAALU",103,0)
 W !,?2,"Sub-Category: " W:$P(FBCATX,U)'=-1 $P(FBCATX,U)
"RTN","FBAALU",104,0)
 W !,?6,"Procedure: ",$P(FBCPTX,U,2),"   ",$P(FBCPTX,U,3)
"RTN","FBAALU",105,0)
 I $O(FBMODA(0)) D
"RTN","FBAALU",106,0)
 . W !,?6,"Modifiers: "
"RTN","FBAALU",107,0)
 . S FBI=0 F  S FBI=$O(FBMODA(FBI)) Q:'FBI  D
"RTN","FBAALU",108,0)
 . . S FBMODX=$$MOD^ICPTMOD(FBMODA(FBI),"I",FBDOS,1)
"RTN","FBAALU",109,0)
 . . W ?22,"-",$P(FBMODX,U,2),"  ",$P(FBMODX,U,3),!
"RTN","FBAALU",110,0)
 E  W !
"RTN","FBAALU",111,0)
 W !,?20,"Detail Description ",!,?20,"=================="
"RTN","FBAALU",112,0)
 S X=$$CPTD^ICPTCOD(FBAACP,"FBTX",$G(FBDFN),$G(FBDOS))
"RTN","FBAALU",113,0)
 S FBI=0 F  S FBI=$O(FBTX(FBI)) Q:'FBI  W !,FBTX(FBI)
"RTN","FBAALU",114,0)
 ;
"RTN","FBAALU",115,0)
CONF ; confirm entered data
"RTN","FBAALU",116,0)
 S DIR(0)="Y",DIR("A")="Is this correct",DIR("B")="YES"
"RTN","FBAALU",117,0)
 D ^DIR K DIR I $D(DIRUT) G EXIT
"RTN","FBAALU",118,0)
 I 'Y W ! G ASKCPT
"RTN","FBAALU",119,0)
 S FBGOT=1
"RTN","FBAALU",120,0)
 ;
"RTN","FBAALU",121,0)
EXIT ; exit point
"RTN","FBAALU",122,0)
 I 'FBGOT S FBAACP="",FBX="" K FBMODA
"RTN","FBAALU",123,0)
 Q
"RTN","FBAALU",124,0)
 ;
"RTN","FBAALU",125,0)
MODHLP ; CPT MODIFIER prompt help text
"RTN","FBAALU",126,0)
 ; input
"RTN","FBAALU",127,0)
 ;   FBMODA( - (optional) array of modifiers
"RTN","FBAALU",128,0)
 ;             FBMODA(#)=CPT MODIFIER (internal)
"RTN","FBAALU",129,0)
 ;
"RTN","FBAALU",130,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","FBAALU",131,0)
 N FBI,FBL,FBMODX,FBQUIT,FBTX
"RTN","FBAALU",132,0)
 ;
"RTN","FBAALU",133,0)
 ; compile help text for modifier prompt including a list of
"RTN","FBAALU",134,0)
 ;   previously entered modifiers.
"RTN","FBAALU",135,0)
 S FBTX(1)="Modifiers are used to better describe the service (CPT)"
"RTN","FBAALU",136,0)
 S FBTX(2)="rendered. Modifier(s) will be combined with the CPT code"
"RTN","FBAALU",137,0)
 S FBTX(3)="for Fee Schedule calculations and to check for duplicate"
"RTN","FBAALU",138,0)
 S FBTX(4)="payment entry."
"RTN","FBAALU",139,0)
 I $O(FBMODA(0)) D
"RTN","FBAALU",140,0)
 . N FBI,FBL,FBMODX
"RTN","FBAALU",141,0)
 . S FBTX(5)=" "
"RTN","FBAALU",142,0)
 . S FBL=5
"RTN","FBAALU",143,0)
 . S FBI=0 F  S FBI=$O(FBMODA(FBI)) Q:'FBI  D
"RTN","FBAALU",144,0)
 . . S FBMODX=$$MOD^ICPTMOD(FBMODA(FBI),"I",$G(FBDOS),1)
"RTN","FBAALU",145,0)
 . . S FBL=FBL+1,FBTX(FBL)="     "_$P(FBMODX,U,2)_"  "_$P(FBMODX,U,3)
"RTN","FBAALU",146,0)
 ;
"RTN","FBAALU",147,0)
 ; display the help text
"RTN","FBAALU",148,0)
 S FBL=0 F  S FBL=$O(FBTX(FBL)) Q:'FBL  D  Q:$D(DIRUT)
"RTN","FBAALU",149,0)
 . ; pause between screens of data (22 lines)
"RTN","FBAALU",150,0)
 . I $E(IOST,1,2)="C-",'(FBL#22) S DIR(0)="E" D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAALU",151,0)
 . ; write a line of text
"RTN","FBAALU",152,0)
 . W !,FBTX(FBL)
"RTN","FBAALU",153,0)
 ;
"RTN","FBAALU",154,0)
 Q
"RTN","FBAALU",155,0)
 ;
"RTN","FBAALU",156,0)
 ;FBAALU
"RTN","FBAAMP1")
0^15^B7353018
"RTN","FBAAMP1",1,0)
FBAAMP1 ;AISC/CMR-MULTIPLE PAYMENT ENTRY ;7/6/2003
"RTN","FBAAMP1",2,0)
 ;;3.5;FEE BASIS;**4,55,61,77**;JAN 30, 1995
"RTN","FBAAMP1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAMP1",4,0)
SUSP ;enter suspense data
"RTN","FBAAMP1",5,0)
 N FBX
"RTN","FBAAMP1",6,0)
 ;S DIR(0)="162.5,9",DIR("A")="Amount Suspended: $",DIR("B")=FBJ-FBK,DIR("?")="Press Return if $ "_(FBJ-FBK)_" is Amount Suspended, otherwise enter correct suspension amount" D ^DIR K DIR
"RTN","FBAAMP1",7,0)
 ;I $D(DIRUT) W !!,"Invalid entry, enter a number between .01 and 999999" G SUSP
"RTN","FBAAMP1",8,0)
 ;S FBAAAS=+Y
"RTN","FBAAMP1",9,0)
 ;I +Y'=(FBJ-FBK) S FBAAAS=+Y W ! S DIR("A")="Is $"_FBAAAS_" correct for Amount Suspended",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAAMP1",10,0)
 ;G SUSP:'Y
"RTN","FBAAMP1",11,0)
 ;W !! S DIC="^FBAA(161.27,",DIC(0)="AEQ" D ^DIC I X["^" S FBAAOUT=1 Q
"RTN","FBAAMP1",12,0)
 ;S FBAASC=+Y
"RTN","FBAAMP1",13,0)
 S FBX=$$ADJ^FBUTL2(FBJ-FBK,.FBADJ,2)
"RTN","FBAAMP1",14,0)
 I FBX=0 S FBAAOUT=1
"RTN","FBAAMP1",15,0)
 Q
"RTN","FBAAMP1",16,0)
SUSP1 I FBAASC=4 K ^TMP($J,"FBWP") W !!,"Suspension Description: " S DIC="^TMP($J,""FBWP"",",DWLW=80,DWPK=1 D EN^DIWE K DIC,DWLW,DWPK I '$O(^TMP($J,"FBWP",0)) W !!,*7,"Description of Suspense is required." G SUSP1
"RTN","FBAAMP1",17,0)
 Q
"RTN","FBAAMP1",18,0)
HCFA F FBSI=28,30,31,32 S FBHCFA(FBSI)=""
"RTN","FBAAMP1",19,0)
 W ! F FBSI=28,30,31 D  Q:$G(FBAAOUT)
"RTN","FBAAMP1",20,0)
 . N ICDVDT S ICDVDT=$G(FBMPDT)
"RTN","FBAAMP1",21,0)
 . F  S DIR(0)="P"_$S(FBSI=28&($$EXTPV^FBAAUTL5(FBPOV)="01"):"O^80",FBSI=28&($$EXTPV^FBAAUTL5(FBPOV)'="01"):"^80",FBSI=30:"^353.1",FBSI=31:"O^353.2")_":EMZ" D HCFA1 Q:$G(FBAAOUT)  Q:FBSI'=28  Q:$$CHKICD9^FBCSV1(+Y,$G(FBMPDT))]""
"RTN","FBAAMP1",22,0)
 Q:$G(FBAAOUT)
"RTN","FBAAMP1",23,0)
 W !
"RTN","FBAAMP1",24,0)
 I $$EXTPV^FBAAUTL5(FBPOV)'="01" D
"RTN","FBAAMP1",25,0)
 . S FBSI=32,DIR(0)="Y",DIR("A")="Service connected condition"
"RTN","FBAAMP1",26,0)
 . S DIR("?")="^W !!,""Respond by answering 'Yes' or 'No'."",! I $G(DFN) W !?1,*7,""Patient:  "",$$NAME^FBCHREQ2(DFN) D DIS^DGRPDB W !!"
"RTN","FBAAMP1",27,0)
 . D HCFA1 I $D(DIRUT) S FBAAOUT=1 Q
"RTN","FBAAMP1",28,0)
 Q
"RTN","FBAAMP1",29,0)
HCFA1 D ^DIR I $D(DTOUT)!($D(DUOUT)) S FBAAOUT=1 Q
"RTN","FBAAMP1",30,0)
 I Y'=-1 D
"RTN","FBAAMP1",31,0)
 .I DIR(0)["P" S FBHCFA(FBSI)=$P(Y,"^")
"RTN","FBAAMP1",32,0)
 .I DIR(0)="Y" S FBHCFA(FBSI)=$S(Y=1:"Y",1:"N")
"RTN","FBAAMP1",33,0)
 K DIR Q
"RTN","FBAAMP1",34,0)
DESC N FBJ
"RTN","FBAAMP1",35,0)
 I FBAASC=4,$D(^TMP($J,"FBWP",0)) S ^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,1,0)=^(0) F FBJ=1:1 Q:'$D(^TMP($J,"FBWP",FBJ,0))  S ^FBAAC(DFN,1,FBV,1,FBSDI,1,FBAACPI,1,FBJ,0)=^(0)
"RTN","FBAAMP1",36,0)
 Q
"RTN","FBAAPCS")
0^14^B69414377
"RTN","FBAAPCS",1,0)
FBAAPCS ;WCIOFO/SAB-REPORT COST/SAVINGS FROM RBRVS FEE SCHEDULE ;6/28/1999
"RTN","FBAAPCS",2,0)
 ;;3.5;FEE BASIS;**4,77**;JAN 30, 1995
"RTN","FBAAPCS",3,0)
 ;
"RTN","FBAAPCS",4,0)
 ; ask date range
"RTN","FBAAPCS",5,0)
 D DATE^FBAAUTL Q:FBPOP
"RTN","FBAAPCS",6,0)
 ;
"RTN","FBAAPCS",7,0)
 W !,"Note: code descriptors will be versioned for the Ending DATE"
"RTN","FBAAPCS",8,0)
 N ICPTVDT S ICPTVDT=$G(ENDDATE)
"RTN","FBAAPCS",9,0)
 ;
"RTN","FBAAPCS",10,0)
 ; ask CPT codes to include
"RTN","FBAAPCS",11,0)
 K FBRCPT
"RTN","FBAAPCS",12,0)
 S DIR(0)="Y",DIR("A")="Include all CPT codes",DIR("B")="YES"
"RTN","FBAAPCS",13,0)
 D ^DIR K DIR G:$D(DIRUT) EXIT
"RTN","FBAAPCS",14,0)
 S FBRCPT=$S(Y:"A",1:"")
"RTN","FBAAPCS",15,0)
 ; if not all CPT codes then ask selection method
"RTN","FBAAPCS",16,0)
 I FBRCPT="" D
"RTN","FBAAPCS",17,0)
 . S DIR(0)="S^1:RANGE OF CODES;2:INDIVIDUAL CODES"
"RTN","FBAAPCS",18,0)
 . S DIR("A")="Choose a method to specify CPT Codes"
"RTN","FBAAPCS",19,0)
 . S DIR("?",1)="You must choose one of the two methods that can be used"
"RTN","FBAAPCS",20,0)
 . S DIR("?",2)="to specify the CPT codes to be included on the report."
"RTN","FBAAPCS",21,0)
 . S DIR("?",3)="If the Range method is chosen, you will asked for one or more"
"RTN","FBAAPCS",22,0)
 . S DIR("?",4)="ranges of CPT codes. (e.g. from 11000 to 11999)"
"RTN","FBAAPCS",23,0)
 . S DIR("?",5)="If the Individual method is chosen, you will be asked to select"
"RTN","FBAAPCS",24,0)
 . S DIR("?",6)="one or more specific CPT codes."
"RTN","FBAAPCS",25,0)
 . S DIR("?")="Enter a code from the list."
"RTN","FBAAPCS",26,0)
 . D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAAPCS",27,0)
 . S FBRCPT=$S(Y=1:"R",1:"I")
"RTN","FBAAPCS",28,0)
 I FBRCPT="" G EXIT
"RTN","FBAAPCS",29,0)
 ; if individual selected then ask specific codes
"RTN","FBAAPCS",30,0)
 I FBRCPT="I" D  I $D(DTOUT)!$D(DUOUT)!'$O(FBRCPT(0)) G EXIT
"RTN","FBAAPCS",31,0)
 . W !,"Note: code descriptors will be versioned for the Ending DATE"
"RTN","FBAAPCS",32,0)
 . F  D  Q:Y'>0!$D(DIRUT)
"RTN","FBAAPCS",33,0)
 . . S DIR(0)="PO^81:EM"
"RTN","FBAAPCS",34,0)
 . . D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAAPCS",35,0)
 . . I Y>0 S FBRCPT($P(Y,U))=$P(Y,U,2)
"RTN","FBAAPCS",36,0)
 ; if range selected then ask ranges
"RTN","FBAAPCS",37,0)
 I FBRCPT="R" D  I $D(DTOUT)!$D(DUOUT)!'$O(FBRCPT(0)) G EXIT
"RTN","FBAAPCS",38,0)
 . N FBI,FBX
"RTN","FBAAPCS",39,0)
 . S FBI=0 F  D  Q:Y=""!$D(DIRUT)
"RTN","FBAAPCS",40,0)
 . . S DIR(0)="FO^5:5",DIR("A")="Start of CPT Range #"_(FBI+1)
"RTN","FBAAPCS",41,0)
 . . D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAAPCS",42,0)
 . . S FBX=Y
"RTN","FBAAPCS",43,0)
 . . S DIR(0)="F^5:5",DIR("A")="End of CPT Range #"_(FBI+1)
"RTN","FBAAPCS",44,0)
 . . D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAAPCS",45,0)
 . . S $P(FBX,U,2)=Y
"RTN","FBAAPCS",46,0)
 . . I $P(FBX,U)]$P(FBX,U,2) W $C(7),!,"Start can't be after the End" Q
"RTN","FBAAPCS",47,0)
 . . S FBI=FBI+1,FBRCPT(FBI)=FBX
"RTN","FBAAPCS",48,0)
 ;
"RTN","FBAAPCS",49,0)
 ; ask device
"RTN","FBAAPCS",50,0)
 W !!,"Note: Additional data printed if device supports 130+ characters"
"RTN","FBAAPCS",51,0)
 S VAR="BEGDATE^ENDDATE^FBRCPT*",PGM="START^FBAAPCS"
"RTN","FBAAPCS",52,0)
 D ZIS^FBAAUTL G EXIT:FBPOP
"RTN","FBAAPCS",53,0)
 ;
"RTN","FBAAPCS",54,0)
START ; queued entry
"RTN","FBAAPCS",55,0)
 ; input
"RTN","FBAAPCS",56,0)
 ;   BEGDATE - begin date (fileman)
"RTN","FBAAPCS",57,0)
 ;   ENDDATE - end date (fileman)
"RTN","FBAAPCS",58,0)
 ;   FBRCPT  - CPT codes to report ('A' All, 'I' Individual, 'R' Ranges)
"RTN","FBAAPCS",59,0)
 ;   FBRCPT( - array of specifc codes or ranges when not All CPT codes
"RTN","FBAAPCS",60,0)
 ;     format when FBRCPT="I"
"RTN","FBAAPCS",61,0)
 ;       FBRCPT(cpt code internal value)=cpt code external value
"RTN","FBAAPCS",62,0)
 ;     format when FBRCPT="R"
"RTN","FBAAPCS",63,0)
 ;       FBRCPT(sequential range #)=start value^end value
"RTN","FBAAPCS",64,0)
 U IO
"RTN","FBAAPCS",65,0)
 ;
"RTN","FBAAPCS",66,0)
GATHER ; collect and sort data
"RTN","FBAAPCS",67,0)
 K ^TMP($J)
"RTN","FBAAPCS",68,0)
 ; loop thru payments by date finalized
"RTN","FBAAPCS",69,0)
 S FBDT=BEGDATE-1
"RTN","FBAAPCS",70,0)
 F  S FBDT=$O(^FBAAC("AK",FBDT)) Q:FBDT'>0!(FBDT>ENDDATE)  D
"RTN","FBAAPCS",71,0)
 . ; loop thru veterans
"RTN","FBAAPCS",72,0)
 . S FBDFN=0
"RTN","FBAAPCS",73,0)
 . F  S FBDFN=$O(^FBAAC("AK",FBDT,FBDFN)) Q:FBDFN'>0  D
"RTN","FBAAPCS",74,0)
 . . ; loop thru vendors
"RTN","FBAAPCS",75,0)
 . . S FBV=0
"RTN","FBAAPCS",76,0)
 . . F  S FBV=$O(^FBAAC("AK",FBDT,FBDFN,FBV)) Q:FBV'>0  D
"RTN","FBAAPCS",77,0)
 . . . ; loop thru initial treatment dates
"RTN","FBAAPCS",78,0)
 . . . S FBK=0
"RTN","FBAAPCS",79,0)
 . . . F  S FBK=$O(^FBAAC("AK",FBDT,FBDFN,FBV,FBK)) Q:FBK'>0  D
"RTN","FBAAPCS",80,0)
 . . . . ; loop thru service provided (cpt)
"RTN","FBAAPCS",81,0)
 . . . . S FBL=0
"RTN","FBAAPCS",82,0)
 . . . . F  S FBL=$O(^FBAAC("AK",FBDT,FBDFN,FBV,FBK,FBL)) Q:FBL'>0  D
"RTN","FBAAPCS",83,0)
 . . . . . S FBY0=$G(^FBAAC(FBDFN,1,FBV,1,FBK,1,FBL,0))
"RTN","FBAAPCS",84,0)
 . . . . . S FBCPT=$$CPT^FBAAUTL4($P(FBY0,U))
"RTN","FBAAPCS",85,0)
 . . . . . ; quit if CPT code not included in report
"RTN","FBAAPCS",86,0)
 . . . . . I FBRCPT="I",'$D(FBRCPT($P(FBY0,U))) Q
"RTN","FBAAPCS",87,0)
 . . . . . I FBRCPT="R" S FBFND=0 D  Q:'FBFND
"RTN","FBAAPCS",88,0)
 . . . . . . S FBI=0 F  S FBI=$O(FBRCPT(FBI)) Q:'FBI  I $P(FBRCPT(FBI),U)']FBCPT,FBCPT']$P(FBRCPT(FBI),U,2) S FBFND=1 Q
"RTN","FBAAPCS",89,0)
 . . . . . ; passed CPT checks
"RTN","FBAAPCS",90,0)
 . . . . . S FBY2=$G(^FBAAC(FBDFN,1,FBV,1,FBK,1,FBL,2))
"RTN","FBAAPCS",91,0)
 . . . . . S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDFN_",1,"_FBV_",1,"_FBK_",1,"_FBL_",""M"")","E")
"RTN","FBAAPCS",92,0)
 . . . . . S FBCPTM=" "_FBCPT_$S(FBMODL]"":"-"_FBMODL,1:"")
"RTN","FBAAPCS",93,0)
 . . . . . ; retrieve counts and totals for the CPT-MODIFIERS combination
"RTN","FBAAPCS",94,0)
 . . . . . S FBX=$G(^TMP($J,FBCPTM))
"RTN","FBAAPCS",95,0)
 . . . . . ; update counts and totals for this payment
"RTN","FBAAPCS",96,0)
 . . . . . S $P(FBX,U)=$P(FBX,U)+1 ; total count
"RTN","FBAAPCS",97,0)
 . . . . . S $P(FBX,U,2)=$P(FBX,U,2)+$P(FBY0,U,3) ; total paid
"RTN","FBAAPCS",98,0)
 . . . . . ; if paid at the RBRVS amount
"RTN","FBAAPCS",99,0)
 . . . . . I +$P(FBY0,U,3)=+$P(FBY2,U,12),$P(FBY2,U,13)="R" D
"RTN","FBAAPCS",100,0)
 . . . . . . S $P(FBX,U,3)=$P(FBX,U,3)+1 ; RBRVS count
"RTN","FBAAPCS",101,0)
 . . . . . . S $P(FBX,U,4)=$P(FBX,U,4)+$P(FBY0,U,3) ; RBRVS payments
"RTN","FBAAPCS",102,0)
 . . . . . . ; calc 75th percentile
"RTN","FBAAPCS",103,0)
 . . . . . . S FBDOS=$P($G(^FBAAC(FBDFN,1,FBV,1,FBK,0)),U)
"RTN","FBAAPCS",104,0)
 . . . . . . S FBAMT=$$PRCTL^FBAAFSF($P(FBY0,U),FBMODL,FBDOS)
"RTN","FBAAPCS",105,0)
 . . . . . . I FBAMT>0 D
"RTN","FBAAPCS",106,0)
 . . . . . . . S $P(FBX,U,5)=$P(FBX,U,5)+1 ; covered by 75th count
"RTN","FBAAPCS",107,0)
 . . . . . . . S $P(FBX,U,6)=$P(FBX,U,6)+FBAMT ; 75th estimated payment
"RTN","FBAAPCS",108,0)
 . . . . . . E  D
"RTN","FBAAPCS",109,0)
 . . . . . . . S $P(FBX,U,7)=$P(FBX,U,7)+1 ; not covered by 75th count
"RTN","FBAAPCS",110,0)
 . . . . . . . S $P(FBX,U,8)=$P(FBX,U,8)+$P(FBY0,U,2) ; claimed amount
"RTN","FBAAPCS",111,0)
 . . . . . ; save counts and totals for the CPT-MODIFIERS combination
"RTN","FBAAPCS",112,0)
 . . . . . S ^TMP($J,FBCPTM)=FBX
"RTN","FBAAPCS",113,0)
 ;
"RTN","FBAAPCS",114,0)
PRINT ; report data
"RTN","FBAAPCS",115,0)
 S (FBQUIT,FBPG)=0 D NOW^%DTC S Y=% D DD^%DT S FBDTR=Y
"RTN","FBAAPCS",116,0)
 S FBO=$S(IOM>129:43,1:0) ; column offset if room to display more detail
"RTN","FBAAPCS",117,0)
 ;
"RTN","FBAAPCS",118,0)
 ; build page header text in FBHT( based on selection criteria
"RTN","FBAAPCS",119,0)
 K FBHT
"RTN","FBAAPCS",120,0)
 S FBHT(1)="  for Payments with Finalized Dates from "
"RTN","FBAAPCS",121,0)
 S FBHT(1)=FBHT(1)_$$FMTE^XLFDT(BEGDATE)_" to "_$$FMTE^XLFDT(ENDDATE)
"RTN","FBAAPCS",122,0)
 I FBRCPT="A" S FBHT(2)="  and all CPT Codes"
"RTN","FBAAPCS",123,0)
 E  D
"RTN","FBAAPCS",124,0)
 . S FBL=2,FBHT(FBL)="  and CPT Codes: "
"RTN","FBAAPCS",125,0)
 . S (FBC,FBI)=0 F  S FBI=$O(FBRCPT(FBI)) Q:'FBI  D
"RTN","FBAAPCS",126,0)
 . . I $L(FBHT(FBL))+$S(FBRCPT="I":2,1:10)+$L(FBRCPT(FBI))>75 D
"RTN","FBAAPCS",127,0)
 . . . I FBC S FBHT(FBL)=FBHT(FBL)_","
"RTN","FBAAPCS",128,0)
 . . . S FBL=FBL+1,FBC=0,FBHT(FBL)="                 "
"RTN","FBAAPCS",129,0)
 . . S FBHT(FBL)=FBHT(FBL)_$S(FBC:", ",1:"")
"RTN","FBAAPCS",130,0)
 . . I FBRCPT="I" S FBHT(FBL)=FBHT(FBL)_FBRCPT(FBI)
"RTN","FBAAPCS",131,0)
 . . I FBRCPT="R" S FBHT(FBL)=FBHT(FBL)_"from "_$P(FBRCPT(FBI),U)_" to "_$P(FBRCPT(FBI),U,2)
"RTN","FBAAPCS",132,0)
 . . S FBC=FBC+1 ; count of codes or ranges on current line (FBL)
"RTN","FBAAPCS",133,0)
 ;
"RTN","FBAAPCS",134,0)
 D HD
"RTN","FBAAPCS",135,0)
 I '$D(^TMP($J)) W !!,"  No payments found that match criteria. ",!
"RTN","FBAAPCS",136,0)
 ;
"RTN","FBAAPCS",137,0)
 S FBT="" ; initialize report totals 
"RTN","FBAAPCS",138,0)
 ; loop thru CPT-MODIFIER(S)
"RTN","FBAAPCS",139,0)
 S FBCPTM="" F  S FBCPTM=$O(^TMP($J,FBCPTM)) Q:FBCPTM=""  D  Q:FBQUIT
"RTN","FBAAPCS",140,0)
 . S FBX=$G(^TMP($J,FBCPTM))
"RTN","FBAAPCS",141,0)
 . I $Y+6>IOSL D HD Q:FBQUIT
"RTN","FBAAPCS",142,0)
 . ;
"RTN","FBAAPCS",143,0)
 . ; compute estimated savings
"RTN","FBAAPCS",144,0)
 . S FBSAV=$P(FBX,U,6)+$P(FBX,U,8)-$P(FBX,U,4)
"RTN","FBAAPCS",145,0)
 . ;
"RTN","FBAAPCS",146,0)
 . ; print detail line
"RTN","FBAAPCS",147,0)
 . W !,$E($P(FBCPTM,",",1,4),2,99) W:$P(FBCPTM,",",5)]"" "," W ?18,"|"
"RTN","FBAAPCS",148,0)
 . W ?20,$J($P(FBX,U,1),5),?26,$J($FN($P(FBX,U,2),",",2),13),?40,"|"
"RTN","FBAAPCS",149,0)
 . W ?42,$J($P(FBX,U,3),5),?48,$J($FN($P(FBX,U,4),",",2),13),?62,"|"
"RTN","FBAAPCS",150,0)
 . ; if room display additional detail
"RTN","FBAAPCS",151,0)
 . I FBO D
"RTN","FBAAPCS",152,0)
 . . W ?64,$J($P(FBX,U,5),5),?70,$J($FN($P(FBX,U,6),",",2),13)
"RTN","FBAAPCS",153,0)
 . . W ?85,$J($P(FBX,U,7),5),?91,$J($FN($P(FBX,U,8),",",2),13)
"RTN","FBAAPCS",154,0)
 . . W ?105,"|"
"RTN","FBAAPCS",155,0)
 . W ?63+FBO,$J($FN(FBSAV,",P",2),15),?78+FBO,"|"
"RTN","FBAAPCS",156,0)
 . ; if more than 4 modifiers then display them on subsequent lines
"RTN","FBAAPCS",157,0)
 . F FBI=1:1 Q:$P(FBCPTM,",",(FBI*4)+1)=""  D
"RTN","FBAAPCS",158,0)
 . . W !,?5,"-",$P(FBCPTM,",",(FBI*4)+1,(FBI*4)+4) ; next set of mods
"RTN","FBAAPCS",159,0)
 . . W:$P(FBCPTM,",",(FBI*4)+5)]"" "," ; additional line will be needed
"RTN","FBAAPCS",160,0)
 . . W ?18,"|",?40,"|",?62,"|" W:FBO ?105,"|" W ?78+FBO,"|"
"RTN","FBAAPCS",161,0)
 . ;
"RTN","FBAAPCS",162,0)
 . ; add to report totals
"RTN","FBAAPCS",163,0)
 . F FBI=1:1:8 S $P(FBT,U,FBI)=$P(FBT,U,FBI)+$P(FBX,U,FBI)
"RTN","FBAAPCS",164,0)
 . S $P(FBT,U,9)=$P(FBT,U,9)+FBSAV
"RTN","FBAAPCS",165,0)
 ;
"RTN","FBAAPCS",166,0)
 I FBQUIT W !!,"REPORT STOPPED AT USER REQUEST"
"RTN","FBAAPCS",167,0)
 E  D  ; report totals
"RTN","FBAAPCS",168,0)
 . D DL
"RTN","FBAAPCS",169,0)
 . W !,"REPORT TOTALS ",?18,"|"
"RTN","FBAAPCS",170,0)
 . W ?20,$J($P(FBT,U,1),5),?26,$J($FN($P(FBT,U,2),",",2),13),?40,"|"
"RTN","FBAAPCS",171,0)
 . W ?42,$J($P(FBT,U,3),5),?48,$J($FN($P(FBT,U,4),",",2),13),?62,"|"
"RTN","FBAAPCS",172,0)
 . I FBO D
"RTN","FBAAPCS",173,0)
 . . W ?64,$J($P(FBT,U,5),5),?70,$J($FN($P(FBT,U,6),",",2),13)
"RTN","FBAAPCS",174,0)
 . . W ?85,$J($P(FBT,U,7),5),?91,$J($FN($P(FBT,U,8),",",2),13)
"RTN","FBAAPCS",175,0)
 . . W ?105,"|"
"RTN","FBAAPCS",176,0)
 . W ?63+FBO,$J($FN($P(FBT,U,9),",P",2),15),?78+FBO,"|"
"RTN","FBAAPCS",177,0)
 I 'FBQUIT,$E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR
"RTN","FBAAPCS",178,0)
 D ^%ZISC
"RTN","FBAAPCS",179,0)
 ;
"RTN","FBAAPCS",180,0)
EXIT ;
"RTN","FBAAPCS",181,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","FBAAPCS",182,0)
 K ^TMP($J)
"RTN","FBAAPCS",183,0)
 K BEGDATE,ENDDATE,FBRCPT
"RTN","FBAAPCS",184,0)
 K FBAMT,FBC,FBCPT,FBCPTM,FBDFN,FBDT,FBDTR,FBFND,FBHT,FBI,FBK
"RTN","FBAAPCS",185,0)
 K FBL,FBMODL,FBO,FBPG,FBPOP,FBQUIT,FBRCPT,FBSAV,FBT,FBV,FBX,FBY0,FBY2
"RTN","FBAAPCS",186,0)
 K DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","FBAAPCS",187,0)
 Q
"RTN","FBAAPCS",188,0)
 ;
"RTN","FBAAPCS",189,0)
HD ; page header
"RTN","FBAAPCS",190,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1,FBQUIT=1 Q
"RTN","FBAAPCS",191,0)
 I $E(IOST,1,2)="C-",FBPG S DIR(0)="E" D ^DIR K DIR I 'Y S FBQUIT=1 Q
"RTN","FBAAPCS",192,0)
 I $E(IOST,1,2)="C-"!FBPG W @IOF
"RTN","FBAAPCS",193,0)
 S FBPG=FBPG+1
"RTN","FBAAPCS",194,0)
 W !,"COST/SAVINGS FROM RBRVS FEE SCHEDULE",?49,FBDTR,?72,"page ",FBPG
"RTN","FBAAPCS",195,0)
 S FBI=0 F  S FBI=$O(FBHT(FBI)) Q:'FBI  W !,FBHT(FBI)
"RTN","FBAAPCS",196,0)
 ;
"RTN","FBAAPCS",197,0)
 W !!,"CPT CODE-",?18,"|",?20,"Total Occurrences ",?40,"|"
"RTN","FBAAPCS",198,0)
 W ?42,"Payments at RBRVS",?62,"|"
"RTN","FBAAPCS",199,0)
 W:FBO ?64,"Estimated Payments if RBRVS was not used",?105,"|"
"RTN","FBAAPCS",200,0)
 W ?64+FBO,"Est. Savings",?78+FBO,"|"
"RTN","FBAAPCS",201,0)
 ;
"RTN","FBAAPCS",202,0)
 I FBO D
"RTN","FBAAPCS",203,0)
 . W !,?18,"|",?40,"|",?62,"|"
"RTN","FBAAPCS",204,0)
 . W ?64,"75th Percentile",?85,"Usual & Customary*"
"RTN","FBAAPCS",205,0)
 . W ?105,"|",?78+FBO,"|"
"RTN","FBAAPCS",206,0)
 ;
"RTN","FBAAPCS",207,0)
 W !,"  Modifier(s)",?18,"|",?20,"count   $ amount",?40,"|"
"RTN","FBAAPCS",208,0)
 W ?42,"count   $ amount",?62,"|"
"RTN","FBAAPCS",209,0)
 W:FBO ?64,"count   $ amount",?85,"count   $ amount",?105,"|"
"RTN","FBAAPCS",210,0)
 W ?64+FBO,"from RBRVS",?78+FBO,"|"
"RTN","FBAAPCS",211,0)
 ;
"RTN","FBAAPCS",212,0)
DL ; write dashed line
"RTN","FBAAPCS",213,0)
 W !,"------------------",?18,"|",?20,"----- -------------",?40,"|"
"RTN","FBAAPCS",214,0)
 W ?42,"----- -------------",?62,"|"
"RTN","FBAAPCS",215,0)
 W:FBO ?64,"----- -------------",?85,"----- -------------",?105,"|"
"RTN","FBAAPCS",216,0)
 W ?64+FBO,"-------------",?78+FBO,"|"
"RTN","FBAAPCS",217,0)
 Q
"RTN","FBAAPCS",218,0)
 ;
"RTN","FBAAPCS",219,0)
 ;FBAAPCS
"RTN","FBAAPET")
0^11^B34367757
"RTN","FBAAPET",1,0)
FBAAPET ;AISC/DMK-EDIT PAYMENT ;7/13/2003
"RTN","FBAAPET",2,0)
 ;;3.5;FEE BASIS;**4,38,55,61,77**;JAN 30, 1995
"RTN","FBAAPET",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAPET",4,0)
 S FBOT=1
"RTN","FBAAPET",5,0)
GETPT I $G(BAT) D
"RTN","FBAAPET",6,0)
 .I '$D(^FBAAC("AC",+BAT)) F I=9,10,11 S $P(^FBAA(161.7,+BAT,0),U,I)=""
"RTN","FBAAPET",7,0)
 .I $D(^FBAAC("AC",+BAT)) D  S $P(^FBAA(161.7,+BAT,0),U,11)=I,$P(^(0),U,9)=$G(FBTOT) K I,FBTOT
"RTN","FBAAPET",8,0)
 ..N J,K,L,M S (I,J,K,L,M,FBTOT)=0
"RTN","FBAAPET",9,0)
 ..F  S J=$O(^FBAAC("AC",+BAT,J)) Q:'J  F  S K=$O(^FBAAC("AC",+BAT,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",+BAT,J,K,L)) Q:'L  F  S M=$O(^FBAAC("AC",+BAT,J,K,L,M)) Q:'M  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S I=I+1,FBTOT=FBTOT+$P(^(0),U,3)
"RTN","FBAAPET",10,0)
 W !! S DIC="^FBAAC(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),GETPT:Y<0 S (DFN,FBDA(3))=+Y
"RTN","FBAAPET",11,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBAAPET",12,0)
 S DIC=DIC_DFN_",1,"
"RTN","FBAAPET",13,0)
GETVD W !! S DIC(0)="AEQM" D ^DIC G GETPT:X="^"!(X=""),GETVD:Y<0 S (FBV,FBVD,FBDA(2))=+Y
"RTN","FBAAPET",14,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,0)) ^FBAAC(DFN,1,FBDA(2),1,0)="^162.02DA^0^0"
"RTN","FBAAPET",15,0)
 S DIC=DIC_FBVD_",1,"
"RTN","FBAAPET",16,0)
GETDT S DIC(0)="AEQM",DIC("A")="Date of Service: " D ^DIC K DIC("A") G GETPT:X="^"!(X=""),GETDT:Y<0 S (FBSD,FBSDI,FBDA(1))=+Y,FBAADT=$P(Y,U,2)
"RTN","FBAAPET",17,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)) ^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)="^162.03A^0^0"
"RTN","FBAAPET",18,0)
 S FBZ=DIC_FBSD_",1,"
"RTN","FBAAPET",19,0)
SERV S DA(3)=FBDA(3),DA(2)=FBDA(2),DA(1)=FBDA(1)
"RTN","FBAAPET",20,0)
 S DIC("W")="N FBX S FBX=$$MODL^FBAAUTL4(""^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,+Y,""""M"""")"",""E"") W:FBX]"""" ""    CPT Modifier(s): "",FBX Q"
"RTN","FBAAPET",21,0)
 S DIC=FBZ,DIC(0)="AEQMZ"
"RTN","FBAAPET",22,0)
 D
"RTN","FBAAPET",23,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBAAPET",24,0)
 G GETPT:X="^"!(X=""),SERV:Y<0 S (FBSV,FBAACPI,FBDA)=+Y,BAT=$P(Y(0),U,8),FBDUZ=$P(Y(0),U,7),(FBAACP,FBAACP(0))=$P(Y,U,2),K=$P(Y(0),U,3),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBAAPET",25,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBAAPET",26,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBAAPET",27,0)
 I FBDUZ'=DUZ&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry,only the clerk who entered the payment ",!," or a supervisor can edit this payment." G GETPT
"RTN","FBAAPET",28,0)
 S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBAAPET",29,0)
 S FBFSAMT(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,12)
"RTN","FBAAPET",30,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBAAPET",31,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBAAPET",32,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"_FBDA_",""M"")")
"RTN","FBAAPET",33,0)
 ; load current adjustment data
"RTN","FBAAPET",34,0)
 D LOADADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",35,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBAAPET",36,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBAAPET",37,0)
 ; load current remittance remark data
"RTN","FBAAPET",38,0)
 D LOADRR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",39,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBAAPET",40,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBAAPET",41,0)
 ; save FPPS data prior to edit session
"RTN","FBAAPET",42,0)
 S FBFPPSC(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U)
"RTN","FBAAPET",43,0)
 S FBFPPSC=FBFPPSC(0)
"RTN","FBAAPET",44,0)
 S FBFPPSL(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,2)
"RTN","FBAAPET",45,0)
 S FBFPPSL=FBFPPSL(0)
"RTN","FBAAPET",46,0)
 G:BAT']"" EDIT
"RTN","FBAAPET",47,0)
 I $G(^FBAA(161.7,BAT,"ST"))]"",$P(^FBAA(161.7,BAT,"ST"),"^")="S"!($P(^FBAA(161.7,BAT,"ST"),"^")="T")&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry, only the Supervisor can edit a payment once the batch has been released." G GETPT
"RTN","FBAAPET",48,0)
 I $G(^FBAA(161.7,BAT,"ST"))]"",$P(^FBAA(161.7,BAT,"ST"),"^")="V" W !!,*7,"Sorry,you cannot edit a payment once the batch has been Finalized." G GETPT
"RTN","FBAAPET",49,0)
EDIT S DA=FBSV
"RTN","FBAAPET",50,0)
 ;
"RTN","FBAAPET",51,0)
 ; first edit CPT code and modifiers
"RTN","FBAAPET",52,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) G GETPT
"RTN","FBAAPET",53,0)
 ; if CPT was changed then update file
"RTN","FBAAPET",54,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" G GETPT
"RTN","FBAAPET",55,0)
 . N FBIENS,FBFDA
"RTN","FBAAPET",56,0)
 . S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBAAPET",57,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBAAPET",58,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAPET",59,0)
 ; if modifiers changed then update file
"RTN","FBAAPET",60,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(FBDA(3),FBDA(2),FBDA(1),FBDA)
"RTN","FBAAPET",61,0)
 ;
"RTN","FBAAPET",62,0)
 ; now edit remaining fields
"RTN","FBAAPET",63,0)
 S DIE("NO^")=""
"RTN","FBAAPET",64,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBAAPET",65,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1);34///@;34////^S X=FBAAMM1;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBAAPET",66,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;D CHKIT^FBAACO3;S K=X"
"RTN","FBAAPET",67,0)
 ;S DR(1,162.03,3)="3////^S X=$S(J-K:J-K,1:"""");I X S Y=""@11"";4////@;S Y=""@5"";@11;3R;4R;S:X'=4 Y=""@5"";22"
"RTN","FBAAPET",68,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBAAPET",69,0)
 S DR(1,162.03,4)="S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@5"";50///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;51///^S X=FBX;S FBFPPCL=X;S Y=""@55"";@5;50///@;S FBFPPSC="""";51///@;S FBFPPSL="""";@55"
"RTN","FBAAPET",70,0)
 S DR(1,162.03,5)="K DIE(""NO^"");W !,""Exit ('^') allowed now"";26;S PRC(""SITE"")=X;8;13;Q;33;49"
"RTN","FBAAPET",71,0)
 S DR(1,162.03,6)="15;17;16;S:X=1 Y=""@1"";@6;28R;S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@6"";31;32R;S Y=""@7"";@1;28;I X]"""" S:$$INPICD9^FBCSV1(X,"""",$G(FBAADT)) Y=""@1"";31"
"RTN","FBAAPET",72,0)
 S DR(1,162.03,7)="@7;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBAAPET",73,0)
 S DIE=FBZ
"RTN","FBAAPET",74,0)
 D
"RTN","FBAAPET",75,0)
 . N ICPTVDT,ICDVDT S (ICPTVDT,ICDVDT)=$G(FBAADT) D ^DIE
"RTN","FBAAPET",76,0)
 ; if adjustment data changed then file
"RTN","FBAAPET",77,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBAAPET",78,0)
 ; if remit remark data changed then file
"RTN","FBAAPET",79,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBAAPET",80,0)
 ; if FPPS CLAIM ID changed, update other line items on invoice
"RTN","FBAAPET",81,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBAAPET",82,0)
 . N FBAAIN
"RTN","FBAAPET",83,0)
 . S FBAAIN=$$GET1^DIQ(162.03,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",14)
"RTN","FBAAPET",84,0)
 . D CKINVEDI^FBAAPET1(FBFPPSC(0),FBFPPSC,FBAAIN,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",")
"RTN","FBAAPET",85,0)
 K FBSV W !! G SERV
"RTN","FBAAPET",86,0)
END K DR,DIC,DIE,X,DFN,FBOT,FBVD,FBSD,BAT,FBAADT,FBSV,DA,FBDA,FBZ,FBDUZ,FBAACP,FBFY,FY,FBAMTPD,J,K,Y,ZZ,PRC,FBHOLDX,FBV,FBSDI,FBAACPI
"RTN","FBAAPET",87,0)
 K FBFSAMT,FBFSUSD,FBMODA,FBZIP,FBTIME,FBHCFA(30),FBAAPTC,FB1725,FBADJ,FBADJD,FBADJL(0),FBRRMK,FBRRMKD,FBRRMKL(0),FBX,FBUNITS
"RTN","FBAAPET",88,0)
 Q
"RTN","FBAAUTL4")
0^1^B19617855
"RTN","FBAAUTL4",1,0)
FBAAUTL4 ;AISC/CMR,dmk,WCIOFO/SAB-UTILITY ROUTINE ;7/11/2001
"RTN","FBAAUTL4",2,0)
 ;;3.5;FEE BASIS;**4,32,77**;JAN 30, 1995
"RTN","FBAAUTL4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAUTL4",4,0)
 ;
"RTN","FBAAUTL4",5,0)
CPT(X,Y,FBSRVDT) ;return external format of CPT code
"RTN","FBAAUTL4",6,0)
 ;INPUT   X = ien of CPT
"RTN","FBAAUTL4",7,0)
 ;optional Y I Y return description, I 'Y return external format of CPT
"RTN","FBAAUTL4",8,0)
 ;optional FBSRVDT - date of service
"RTN","FBAAUTL4",9,0)
 ;OUTPUT  external format of CPT code or description of CPT code
"RTN","FBAAUTL4",10,0)
 I '$G(X) Q ""
"RTN","FBAAUTL4",11,0)
 N Z
"RTN","FBAAUTL4",12,0)
 S Z=$$CPT^ICPTCOD(X,$S($G(FBSRVDT)>0:+$G(FBSRVDT),1:""),1)
"RTN","FBAAUTL4",13,0)
 Q $S('$G(Y):$P(Z,U,2),1:$P(Z,U,3))
"RTN","FBAAUTL4",14,0)
 ;
"RTN","FBAAUTL4",15,0)
MOD(X,Y,FBSRVDT) ;return external format of modifier
"RTN","FBAAUTL4",16,0)
 ;INPUT   X = ien of modifier
"RTN","FBAAUTL4",17,0)
 ;optional Y I Y return description, I 'Y return external format of mod
"RTN","FBAAUTL4",18,0)
 ;optional FBSRVDT - date of service
"RTN","FBAAUTL4",19,0)
 ;OUTPUT  external format of modifier or description of CPT code
"RTN","FBAAUTL4",20,0)
 I '$G(X) Q ""
"RTN","FBAAUTL4",21,0)
 N Z
"RTN","FBAAUTL4",22,0)
 S Z=$$MOD^ICPTMOD(X,"I",$S($G(FBSRVDT)>0:+$G(FBSRVDT),1:""),1)
"RTN","FBAAUTL4",23,0)
 Q $S('$G(Y):$P(Z,U,2),1:$P(Z,U,3))
"RTN","FBAAUTL4",24,0)
 ;
"RTN","FBAAUTL4",25,0)
CPTDATA(W,X,Y,Z) ;get internal value of CPT
"RTN","FBAAUTL4",26,0)
 ; input
"RTN","FBAAUTL4",27,0)
 ;   W = IEN of PATIENT in file 162
"RTN","FBAAUTL4",28,0)
 ;   X = IEN of VENDOR multiple in file 162
"RTN","FBAAUTL4",29,0)
 ;   Y = IEN of INITIAL TREATMENT DATE multiple in file 162
"RTN","FBAAUTL4",30,0)
 ;   Z = IEN of SERVICE PROVIDED multiple in file 162
"RTN","FBAAUTL4",31,0)
 ; returns
"RTN","FBAAUTL4",32,0)
 ;   value of SERVICE PROVIDED (internal)
"RTN","FBAAUTL4",33,0)
 ;
"RTN","FBAAUTL4",34,0)
 I '$G(W)!('$G(X))!('$G(Y))!('$G(Z)) Q ""
"RTN","FBAAUTL4",35,0)
 Q $P($G(^FBAAC(W,1,X,1,Y,1,Z,0)),U)
"RTN","FBAAUTL4",36,0)
 ;
"RTN","FBAAUTL4",37,0)
MODDATA(W,X,Y,Z) ;get internal values of CPT Modifier
"RTN","FBAAUTL4",38,0)
 ; input
"RTN","FBAAUTL4",39,0)
 ;   W = IEN of PATIENT in file 162
"RTN","FBAAUTL4",40,0)
 ;   X = IEN of VENDOR multiple in file 162
"RTN","FBAAUTL4",41,0)
 ;   Y = IEN of INITIAL TREATMENT DATE multiple in file 162
"RTN","FBAAUTL4",42,0)
 ;   Z = IEN of SERVICE PROVIDED multiple in file 162
"RTN","FBAAUTL4",43,0)
 ; output
"RTN","FBAAUTL4",44,0)
 ;   FBMODA( array of CPT MODIFIERs
"RTN","FBAAUTL4",45,0)
 ;     FBMODA(#)=CPT MODIFIER (internal value)
"RTN","FBAAUTL4",46,0)
 ;     where # is the IEN for an entry in the CPT MODIFIER multiple
"RTN","FBAAUTL4",47,0)
 K FBMODA
"RTN","FBAAUTL4",48,0)
 I '$G(W)!('$G(X))!('$G(Y))!('$G(Z)) Q
"RTN","FBAAUTL4",49,0)
 N FBI,FBMOD
"RTN","FBAAUTL4",50,0)
 S FBI=0 F  S FBI=$O(^FBAAC(W,1,X,1,Y,1,Z,"M",FBI)) Q:'FBI  D
"RTN","FBAAUTL4",51,0)
 . S FBMOD=$P($G(^FBAAC(W,1,X,1,Y,1,Z,"M",FBI,0)),U)
"RTN","FBAAUTL4",52,0)
 . Q:FBMOD=""
"RTN","FBAAUTL4",53,0)
 . S FBMODA(FBI)=FBMOD
"RTN","FBAAUTL4",54,0)
 Q
"RTN","FBAAUTL4",55,0)
 ;
"RTN","FBAAUTL4",56,0)
APS(FBJ,FBK,FBL,FBM) ; amount paid symbol
"RTN","FBAAUTL4",57,0)
 ; input
"RTN","FBAAUTL4",58,0)
 ;   FBJ = IEN of PATIENT in file 162
"RTN","FBAAUTL4",59,0)
 ;   FBK = IEN of VENDOR multiple in file 162
"RTN","FBAAUTL4",60,0)
 ;   FBL = IEN of INITIAL TREATMENT DATE multiple in file 162
"RTN","FBAAUTL4",61,0)
 ;   FBM = IEN of SERVICE PROVIDED multiple in file 162
"RTN","FBAAUTL4",62,0)
 ; returns symbol
"RTN","FBAAUTL4",63,0)
 ;   where value is M (Mill Bill emergency care - 38 U.S.C. 1725)
"RTN","FBAAUTL4",64,0)
 ;                  R (RBRVS fee schedule amount)
"RTN","FBAAUTL4",65,0)
 ;                  F (VA fee schedule amount)
"RTN","FBAAUTL4",66,0)
 ;                  C (contracted service amount)
"RTN","FBAAUTL4",67,0)
 ;                  U (usual & customary - claimed)
"RTN","FBAAUTL4",68,0)
 ;                  null if no amount paid
"RTN","FBAAUTL4",69,0)
 N FBAP,FBRET,FBY0,FBY2
"RTN","FBAAUTL4",70,0)
 S FBRET=""
"RTN","FBAAUTL4",71,0)
 S FBY0=$G(^FBAAC(FBJ,1,FBK,1,FBL,1,FBM,0))
"RTN","FBAAUTL4",72,0)
 S FBY2=$G(^FBAAC(FBJ,1,FBK,1,FBL,1,FBM,2))
"RTN","FBAAUTL4",73,0)
 S FBAP=$P(FBY0,U,3)
"RTN","FBAAUTL4",74,0)
 I FBAP>0 D
"RTN","FBAAUTL4",75,0)
 . ; use fee schedule info for payment (if any)
"RTN","FBAAUTL4",76,0)
 . I +FBAP=+$P(FBY2,U,12) S FBRET=$P(FBY2,U,13) Q:FBRET]""
"RTN","FBAAUTL4",77,0)
 . ; if no fee schedule info then calc 75th percentile and check
"RTN","FBAAUTL4",78,0)
 . I $P(FBY2,U,12)="" D  Q:FBRET]""
"RTN","FBAAUTL4",79,0)
 . . S FBCPT=$$CPT($P(FBY0,U))
"RTN","FBAAUTL4",80,0)
 . . S FBMODL=$$MODL("^FBAAC("_FBJ_",1,"_FBK_",1,"_FBL_",1,"_FBM_",""M"")","E")
"RTN","FBAAUTL4",81,0)
 . . S FBDOS=$P($G(^FBAAC(FBJ,1,FBK,1,FBL,0)),U)
"RTN","FBAAUTL4",82,0)
 . . I +FBAP=+$$PRCTL^FBAAFSF(FBCPT,FBMODL,FBDOS) S FBRET="F"
"RTN","FBAAUTL4",83,0)
 . ; since not paid by a fee schedule, check prompt pay type
"RTN","FBAAUTL4",84,0)
 . I $P(FBY2,U,2) S FBRET="C" Q
"RTN","FBAAUTL4",85,0)
 . ; since not fee schedule or contract check POV code to identify
"RTN","FBAAUTL4",86,0)
 . ;   Mill Bill payments
"RTN","FBAAUTL4",87,0)
 . S:"^39^52^"[(U_$P($G(^FBAA(161.82,+$P(FBY0,U,18),0)),U,3)_U) FBRET="M"
"RTN","FBAAUTL4",88,0)
 . Q:FBRET]""
"RTN","FBAAUTL4",89,0)
 . ; all other payments considered u&c
"RTN","FBAAUTL4",90,0)
 . S FBRET="U"
"RTN","FBAAUTL4",91,0)
 Q FBRET
"RTN","FBAAUTL4",92,0)
 ;
"RTN","FBAAUTL4",93,0)
CHKBI(X,Y) ;called to determine if batch number or invoice number
"RTN","FBAAUTL4",94,0)
 ;already exists
"RTN","FBAAUTL4",95,0)
 ;X= next batch/invoice number
"RTN","FBAAUTL4",96,0)
 ;Y=1 if Batch
"RTN","FBAAUTL4",97,0)
 ;Y undefined if invoice number passed
"RTN","FBAAUTL4",98,0)
 ;returns a truth if X is ok for next batch/invoice #
"RTN","FBAAUTL4",99,0)
 ;
"RTN","FBAAUTL4",100,0)
 I 'X Q ""
"RTN","FBAAUTL4",101,0)
 I $G(Y),$D(^FBAA(161.7,"B",X)) Q ""
"RTN","FBAAUTL4",102,0)
 Q $S($D(^FBAA(162.1,"B",X)):"",$D(^FBAAI("B",X)):"",1:1)
"RTN","FBAAUTL4",103,0)
 ;
"RTN","FBAAUTL4",104,0)
MODL(FBAN,FBFLAG) ;return sorted list given array of modifiers
"RTN","FBAAUTL4",105,0)
 ; Input
"RTN","FBAAUTL4",106,0)
 ;   FBAN - closed root of array containing modifiers
"RTN","FBAAUTL4",107,0)
 ;          the data must be in nodes descendent from this root.
"RTN","FBAAUTL4",108,0)
 ;          The subscripts of the nodes below FBAN must be
"RTN","FBAAUTL4",109,0)
 ;          positive numbers. The CPT MODIFIER internal value
"RTN","FBAAUTL4",110,0)
 ;          must be the first piece in these nodes or in the
"RTN","FBAAUTL4",111,0)
 ;          0-node descendent from these nodes.
"RTN","FBAAUTL4",112,0)
 ;          i.e.
"RTN","FBAAUTL4",113,0)
 ;            ARRAY(number)=CPT MODIFIER (internal value)
"RTN","FBAAUTL4",114,0)
 ;                  OR
"RTN","FBAAUTL4",115,0)
 ;            ARRAY(number,0)=CPT MODIFIER (internal value)
"RTN","FBAAUTL4",116,0)
 ;   FBFLAG - (optional) flag, E or I, default I
"RTN","FBAAUTL4",117,0)
 ;          I to return internal values of modifiers
"RTN","FBAAUTL4",118,0)
 ;          E to return external values of modifiers
"RTN","FBAAUTL4",119,0)
 ; Returns string of sorted modifiers (e.g. "1,3,7") 
"RTN","FBAAUTL4",120,0)
 ;
"RTN","FBAAUTL4",121,0)
 N FBI,FBRET,FBSORT,FBX,FBZERO
"RTN","FBAAUTL4",122,0)
 S FBRET=""
"RTN","FBAAUTL4",123,0)
 S FBFLAG=$G(FBFLAG,"I")
"RTN","FBAAUTL4",124,0)
 ;
"RTN","FBAAUTL4",125,0)
 ; if any descendent data then determine if it is 0-node descendent
"RTN","FBAAUTL4",126,0)
 S FBZERO=0 I $O(@FBAN@(0)),$D(@FBAN@($O(@FBAN@(0)),0))#2 S FBZERO=1
"RTN","FBAAUTL4",127,0)
 ;
"RTN","FBAAUTL4",128,0)
 ; loop thru input array and place modifiers in a sort array
"RTN","FBAAUTL4",129,0)
 S FBI=0 F  S FBI=$O(@FBAN@(FBI)) Q:'FBI  D
"RTN","FBAAUTL4",130,0)
 . ; get the cpt modifier
"RTN","FBAAUTL4",131,0)
 . I FBZERO S FBX=$P(@FBAN@(FBI,0),U)
"RTN","FBAAUTL4",132,0)
 . E  S FBX=$P(@FBAN@(FBI),U)
"RTN","FBAAUTL4",133,0)
 . I FBFLAG="E" D
"RTN","FBAAUTL4",134,0)
 . . ; convert to external value
"RTN","FBAAUTL4",135,0)
 . . S FBX=$$MOD^ICPTMOD(FBX,"I")
"RTN","FBAAUTL4",136,0)
 . . I FBX>0 S FBX=$P(FBX,U,2)
"RTN","FBAAUTL4",137,0)
 . . E  S FBX=""
"RTN","FBAAUTL4",138,0)
 . I FBX]"" S FBSORT(FBX)=""
"RTN","FBAAUTL4",139,0)
 ;
"RTN","FBAAUTL4",140,0)
 ; loop thru sorted array and add the modifiers to return value
"RTN","FBAAUTL4",141,0)
 S FBX="" F  S FBX=$O(FBSORT(FBX)) Q:FBX=""  S FBRET=FBRET_","_FBX
"RTN","FBAAUTL4",142,0)
 ;
"RTN","FBAAUTL4",143,0)
 ; strip leading comma (if any)
"RTN","FBAAUTL4",144,0)
 I $E(FBRET)="," S FBRET=$E(FBRET,2,999)
"RTN","FBAAUTL4",145,0)
 ;
"RTN","FBAAUTL4",146,0)
 ; return value
"RTN","FBAAUTL4",147,0)
 Q FBRET
"RTN","FBAAUTL4",148,0)
 ;
"RTN","FBAAUTL4",149,0)
REPMOD(FBJ,FBK,FBL,FBM) ; Replace CPT Modifier(s) in payment
"RTN","FBAAUTL4",150,0)
 ; input
"RTN","FBAAUTL4",151,0)
 ;   FBJ = IEN of PATIENT in file 162
"RTN","FBAAUTL4",152,0)
 ;   FBK = IEN of VENDOR multiple in file 162
"RTN","FBAAUTL4",153,0)
 ;   FBL = IEN of INITIAL TREATMENT DATE multiple in file 162
"RTN","FBAAUTL4",154,0)
 ;   FBM = IEN of SERVICE PROVIDED multiple in file 162
"RTN","FBAAUTL4",155,0)
 ;   FBMODA( array of modifiers
"RTN","FBAAUTL4",156,0)
 ;      where FBMODA(number)=CPT Modifier (internal)
"RTN","FBAAUTL4",157,0)
 ;
"RTN","FBAAUTL4",158,0)
 N FBI,FBIENS,FBFDA
"RTN","FBAAUTL4",159,0)
 S FBIENS=FBM_","_FBL_","_FBK_","_FBJ_","
"RTN","FBAAUTL4",160,0)
 ;
"RTN","FBAAUTL4",161,0)
 ; delete any existing CPT MODIFIER entries from global
"RTN","FBAAUTL4",162,0)
 I $O(^FBAAC(FBJ,1,FBK,1,FBL,1,FBM,"M",0)) D
"RTN","FBAAUTL4",163,0)
 . K FBFDA S FBI=0
"RTN","FBAAUTL4",164,0)
 . F  S FBI=$O(^FBAAC(FBJ,1,FBK,1,FBL,1,FBM,"M",FBI)) Q:'FBI  D
"RTN","FBAAUTL4",165,0)
 . . S FBFDA(162.06,FBI_","_FBIENS,.01)="@"
"RTN","FBAAUTL4",166,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAUTL4",167,0)
 ;
"RTN","FBAAUTL4",168,0)
 ; create CPT MODIFIER entries from data in array FBMODA
"RTN","FBAAUTL4",169,0)
 I $O(FBMODA(0)) D
"RTN","FBAAUTL4",170,0)
 . K FBFDA S FBI=0 F  S FBI=$O(FBMODA(FBI)) Q:'FBI  D
"RTN","FBAAUTL4",171,0)
 . . S FBFDA(162.06,"+"_FBI_","_FBIENS,.01)=FBMODA(FBI)
"RTN","FBAAUTL4",172,0)
 . D UPDATE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBAAUTL4",173,0)
 ;
"RTN","FBAAUTL4",174,0)
 Q
"RTN","FBAAUTL4",175,0)
 ;
"RTN","FBAAUTL4",176,0)
 ;FBAAUTL4
"RTN","FBCHEAP")
0^16^B16779482
"RTN","FBCHEAP",1,0)
FBCHEAP ;AISC/DMK-ENTER AMOUNT PAID FROM PRICER ;7/8/2003
"RTN","FBCHEAP",2,0)
 ;;3.5;FEE BASIS;**38,55,61,77**;JAN 30, 1995
"RTN","FBCHEAP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHEAP",4,0)
DIC W ! S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,15)=""Y""&($G(^(""ST""))=""P"")"_$S($D(^XUSEC("FBAASUPERVISOR",DUZ)):"",1:"&($P(^(0),U,5)=DUZ)") D ^DIC
"RTN","FBCHEAP",5,0)
 G END:X="^"!(X=""),DIC:Y<0 S FBN=+Y,FBN(0)=Y(0)
"RTN","FBCHEAP",6,0)
ASK S DIR(0)="Y",DIR("A")="Would you like to reject any invoices from the pricer",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),REJECT:Y
"RTN","FBCHEAP",7,0)
DIC1 W !! S DIC="^FBAAI(",DIC(0)="AEQMZ",DIC("A")="Select Patient: ",D="D",DIC("S")="I $P(^(0),U,17)=FBN",DIC("W")="W ?25,$S($D(^DPT($P(^(0),U,4),0)):$P(^(0),U),1:"""")" D ^DIC S DIE=DIC K DIC,D G END:X="^",DIC:X=""!(Y<0)
"RTN","FBCHEAP",8,0)
 S (DA,FBI)=+Y,FBI(0)=Y(0) G END:'$D(^FBAAI(FBI,0))
"RTN","FBCHEAP",9,0)
DISP S FBLISTC="" D HOME^%ZIS,START^FBCHDI2
"RTN","FBCHEAP",10,0)
 W !! S FBJ=$P(FBI(0),"^",8)
"RTN","FBCHEAP",11,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBCHEAP",12,0)
 S FB1725=$S($P(FBI(0),U,5)["FB583":+$P($G(^FB583(+$P(FBI(0),U,5),0)),U,28),1:0)
"RTN","FBCHEAP",13,0)
 S DR="26;S FBPAMT=X;W:FB1725 !?2,""**Payment is for emergency treatment under 38 U.S.C. 1725."";W:FB1725&($G(FBPAMT)>0) !?2,""  70% of Pricer Amount = ""_$J(.7*FBPAMT,0,2);8;S FBK=X"
"RTN","FBCHEAP",14,0)
 ;S DR(1,162.5,1)="S:(FBJ-FBK)'>0 Y=24;9//^S X=$S(FBJ-FBK:FBJ-FBK,1:"""");S:'X Y=24;10;S:X'=4 Y=24;18"
"RTN","FBCHEAP",15,0)
 S DR(1,162.5,1)="S FBX=$$ADJ^FBUTL2(FBJ-FBK,.FBADJ,1,,,1)"
"RTN","FBCHEAP",16,0)
 S DR(1,162.5,2)="@20;24R;S:$$INPICD^FBCSV1(X,$G(DA),$P($G(FBIN),""^"",6)) Y=""@20"";24.5R"
"RTN","FBCHEAP",17,0)
 S DR(1,162.5,3)="S FBX=$$RR^FBUTL4(.FBRRMK,2)"
"RTN","FBCHEAP",18,0)
 S DIE("NO^")=""
"RTN","FBCHEAP",19,0)
 D
"RTN","FBCHEAP",20,0)
 . N ICDVDT S ICDVDT=$P($G(FBIN),"^",6) D ^DIE
"RTN","FBCHEAP",21,0)
 K DIE("NO^") G END:$D(DTOUT)
"RTN","FBCHEAP",22,0)
 ; file adjustment reasons
"RTN","FBCHEAP",23,0)
 D FILEADJ^FBCHFA(FBI_",",.FBADJ)
"RTN","FBCHEAP",24,0)
 ; file remittance remarks
"RTN","FBCHEAP",25,0)
 D FILERR^FBCHFR(FBI_",",.FBRRMK)
"RTN","FBCHEAP",26,0)
 D TOT S $P(FBN(0),"^",9)=FBK(1),^FBAA(161.7,FBN,0)=FBN(0)
"RTN","FBCHEAP",27,0)
 D CHK I $D(FBCHSW) K FBCHSW G DIC1
"RTN","FBCHEAP",28,0)
 I '$D(FBCHSW) S DA=FBN,(DIC,DIE)="^FBAA(161.7,",DIC(0)="LQ",DR="11////^S X=""A""",DLAYGO=161.7 D ^DIE G DIC
"RTN","FBCHEAP",29,0)
 G DIC1:$O(^FBAAI("AC",FBN,FBI))
"RTN","FBCHEAP",30,0)
END K DA,DFN,DIC,DIE,DR,FBAAOUT,FBDX,FBI,FBIN,FBJ,FBK,FBLISTC,FBN,FBPROC,FBVEN,FBVID,I,J,K,L,POP,Q,VA,VADM,X,POP,YS,VAL,ZZ,Y,FBRR,FBTYPE,FBCHSW,DIRUT,FB1725,FBPAMT
"RTN","FBCHEAP",31,0)
 K FBADJ,FBRRMK
"RTN","FBCHEAP",32,0)
 D END^FBCHDI
"RTN","FBCHEAP",33,0)
 Q
"RTN","FBCHEAP",34,0)
REJECT S FBTYPE="B9"
"RTN","FBCHEAP",35,0)
 W ! S DIC="^FBAAI(",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,17)=FBN&($P(^(0),U,9)="""")",DIC("W")="W ?25,$S($D(^DPT($P(^(0),U,4),0)):$P(^(0),U),1:"""")" D ^DIC G END:X=""!(X="^"),REJECT:Y<0 S FBI=+Y,FBI(0)=Y(0)
"RTN","FBCHEAP",36,0)
 S FBLISTC="" D HOME^%ZIS,START^FBCHDI2
"RTN","FBCHEAP",37,0)
RASK S DIR(0)="F^2:40",DIR("A")="Enter reason for rejecting (2-40 characters)",DIR("?")="Enter a reason for rejecting payment from Austin Pricer" D ^DIR K DIR G END:$D(DIRUT) S FBRR=X
"RTN","FBCHEAP",38,0)
ASKSU S DIR(0)="Y",DIR("A")="Are you sure you want to reject this item",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),DIC:'Y
"RTN","FBCHEAP",39,0)
 S (DLAYGO,DIDEL)=162.5,DIC(0)="AEQLM"
"RTN","FBCHEAP",40,0)
 S (DIC,DIE)="^FBAAI(",DA=FBI,DR="13////^S X=""P"";14////^S X=FBRR;15////^S X=FBN;20///^S X=""@""" D ^DIE
"RTN","FBCHEAP",41,0)
 S $P(FBN(0),"^",10)=$P(FBN(0),"^",10)-1,$P(FBN(0),"^",11)=$P(FBN(0),"^",11)-1,$P(FBN(0),"^",17)="Y",^FBAA(161.7,FBN,0)=FBN(0)
"RTN","FBCHEAP",42,0)
RASKSU I $O(^FBAAI("AC",FBN,FBI)) S DIR(0)="Y",DIR("A")="Reject another",DIR("B")="NO" D ^DIR K DIR G END:$D(DIRUT),REJECT:Y
"RTN","FBCHEAP",43,0)
 I $P(^FBAA(161.7,FBN,0),"^",11)=0 S (DIC,DIE)="^FBAA(161.7,",DIC(0)="AEQM",DA=FBN,DR="11////^S X=""V"";12////^S X=DT" D ^DIE G DIC
"RTN","FBCHEAP",44,0)
 G END
"RTN","FBCHEAP",45,0)
CHK F I=0:0 S I=$O(^FBAAI("AC",FBN,I)) Q:I'>0  I $D(^FBAAI(I,0)),$P(^(0),"^",9)="" S FBCHSW=1
"RTN","FBCHEAP",46,0)
 Q
"RTN","FBCHEAP",47,0)
TOT S FBK(1)=0 F I=0:0 S I=$O(^FBAAI("AC",FBN,I)) Q:'I  S FBK(1)=FBK(1)+$P($G(^FBAAI(I,0)),"^",9)
"RTN","FBCHEAP",48,0)
 Q
"RTN","FBCHEP")
0^8^B31682040
"RTN","FBCHEP",1,0)
FBCHEP ;AISC/DMK-ENTER PAYMENT FOR CONTRACT HOSPITAL ;7/7/2003
"RTN","FBCHEP",2,0)
 ;;3.5;FEE BASIS;**4,61,77**;JAN 30, 1995
"RTN","FBCHEP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHEP",4,0)
 S FBAAPTC="V",FBAAOUT=0
"RTN","FBCHEP",5,0)
RD K FBAAID,FBAAVID S FBRESUB="" D GETVET^FBAAUTL1 G:DFN']"" Q
"RTN","FBCHEP",6,0)
 S FBPROG="I $P(^(0),U,3)=6,($P(^(0),U,9)'[""FB583"")" D GETAUTH^FBAAUTL1 G RD:$D(DUOUT),RD:FTP']""
"RTN","FBCHEP",7,0)
 ;W !!,?25,"<  ASSOCIATED 7078  >",!!
"RTN","FBCHEP",8,0)
 ;S DIC="^FB7078(",DA=FB7078,DR="0;1" D EN^DIQ
"RTN","FBCHEP",9,0)
 I FB7078="" W !,*7,"No 7078 on file for this authorization." G RD
"RTN","FBCHEP",10,0)
 S FBI7078=FB7078_";FB7078("
"RTN","FBCHEP",11,0)
 I $D(^FBAAI("E",FBI7078)) S FBAAIN=$O(^FBAAI("E",FBI7078,0)) G OUT
"RTN","FBCHEP",12,0)
SETINV S FBZ(0)=^FB7078(FB7078,0),FBVET=$P(FBZ(0),"^",3),FBVEN=$P(FBZ(0),"^",2),FBVEN=$P(FBVEN,";",1)
"RTN","FBCHEP",13,0)
 ;
"RTN","FBCHEP",14,0)
EN583 ;Entry from 583 enter payment
"RTN","FBCHEP",15,0)
 I FBAAPTC="R" D ^FBAACO0
"RTN","FBCHEP",16,0)
 S DA=FBVEN D EN1^FBAAVD
"RTN","FBCHEP",17,0)
 I $P($G(^FBAAV(FBVEN,"ADEL")),U)="Y" W !!,*7,"Vendor is flagged for Austin deletion!" G Q
"RTN","FBCHEP",18,0)
 D SITEP^FBAAUTL G Q:FBPOP
"RTN","FBCHEP",19,0)
 ;
"RTN","FBCHEP",20,0)
RDV S FBVE="" S:$D(^FBAAV(DA,"AMS")) FBVE=$P(^("AMS"),"^",2) S:$G(FBVE)'="Y" FBVE="N"
"RTN","FBCHEP",21,0)
 I FBVE="Y" W *7,!!,"Vendor is listed as 'exempt from the pricer'." S DIR(0)="Y",DIR("A")="Do you wish to keep this invoice exempt from the pricer",DIR("B")="Yes" D ^DIR K DIR G Q:$D(DIRUT) S FBVE=$S(Y=1:"Y",1:"N")
"RTN","FBCHEP",22,0)
 I $G(FBVE)'="Y",($P($G(^FBAAV(FBVEN,0)),"^",17)']"") W !!,*7,"Medicare ID Number is needed for this Vendor!" S DIE="^FBAAV(",DR=22 D ^DIE K DIE G Q:$D(DTOUT)!('$L(X))
"RTN","FBCHEP",23,0)
 ;
"RTN","FBCHEP",24,0)
BAT S DIC="^FBAA(161.7,",DIC(0)="AEQMZ",DIC("S")="I $P(^(0),U,3)=""B9""&($P(^(0),U,5)=DUZ)&($P(^(0),U,15)=""Y"")&($G(^(""ST""))=""O"")" W ! D ^DIC K DIC
"RTN","FBCHEP",25,0)
 G Q:X="^"!(X=""),BAT:Y<0 S FBAABE=+Y,FBY(0)=Y(0),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2),FBEXMPT=$P(FBY(0),"^",18) S FBAAOUT=0 D CHK I FBAAOUT K Y,Y(0),FBAABE G BAT
"RTN","FBCHEP",26,0)
 I FBI7078["FB7078(",BO'=$P($P(FBZ(0),U),".") W !,*7,"Obligation number on batch does not match 1358.",!,"Obligation number on batch must be ",$P($P(FBZ(0),U),"."),".",! G BAT
"RTN","FBCHEP",27,0)
 S FBINC=$S($P(FBY(0),"^",10)="":0,1:$P(FBY(0),"^",10)),FBLN=$S($P(FBY(0),"^",11)="":0,1:$P(FBY(0),"^",11))
"RTN","FBCHEP",28,0)
GETNXI D GETNXI^FBAAUTL
"RTN","FBCHEP",29,0)
 W !!,"Invoice # ",FBAAIN," assigned to this Invoice"
"RTN","FBCHEP",30,0)
RIN D GETINDT^FBAACO1 G Q:$G(FBAAOUT)
"RTN","FBCHEP",31,0)
 ; ask patient control number
"RTN","FBCHEP",32,0)
 S FBCSID=$$ASKPCN^FBUTL5() I FBCSID="^" G Q
"RTN","FBCHEP",33,0)
 ; if U/C then get FPPS Claim ID else ask user
"RTN","FBCHEP",34,0)
 I $D(FB583) S FBFPPSC=$P($G(^FB583(FB583,5)),U) W !,"FPPS CLAIM ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBCHEP",35,0)
 E  S FBFPPSC=$$FPPSC^FBUTL5() I FBFPPSC=-1 G Q
"RTN","FBCHEP",36,0)
 ; if EDI claim then ask FPPS line item
"RTN","FBCHEP",37,0)
 I FBFPPSC]"" S FBFPPSL=$$FPPSL^FBUTL5(,1) I FBFPPSL=-1 G Q
"RTN","FBCHEP",38,0)
 ; compute default Covered Days
"RTN","FBCHEP",39,0)
 S FBCDAYS=$$FMDIFF^XLFDT(FBAAEDT,FBAABDT)
"RTN","FBCHEP",40,0)
 I FBCDAYS=0 S FBCDAYS=1
"RTN","FBCHEP",41,0)
 S FBAAMM=$S(FBAAPTC="R":"",1:1) D PPT^FBAACO1()
"RTN","FBCHEP",42,0)
DIC S DIC="^FBAAI(",DIC(0)="LQ",DLAYGO=162.5,X=FBAAIN D ^DIC G Q:Y<0
"RTN","FBCHEP",43,0)
 S DA=+Y,DIE=DIC,DR="[FBCH ENTER PAYMENT]",DIE("NO^")=""
"RTN","FBCHEP",44,0)
 D
"RTN","FBCHEP",45,0)
 . N ICDVDT S ICDVDT=$G(FBAABDT) D ^DIE
"RTN","FBCHEP",46,0)
 ; file adjustment reasons
"RTN","FBCHEP",47,0)
 D FILEADJ^FBCHFA(DA_",",.FBADJ)
"RTN","FBCHEP",48,0)
 ; file remittance remarks
"RTN","FBCHEP",49,0)
 D FILERR^FBCHFR(DA_",",.FBRRMK)
"RTN","FBCHEP",50,0)
 K DIE,DIC,D,DA,DR
"RTN","FBCHEP",51,0)
 S $P(FBY(0),"^",10)=FBINC+1,$P(FBY(0),"^",11)=FBLN+1,$P(FBY(0),"^",18)=FBEXMPT,^FBAA(161.7,FBAABE,0)=FBY(0) D:'$D(FBNOPTF) PTF G Q:$D(FB583),RD
"RTN","FBCHEP",52,0)
OUT W !!,*7,?3,"Invoice number ",FBAAIN," has already been entered for this authorization.",!,?3,"Use the Contract Hospital 'Invoice Edit' option if needed.",!
"RTN","FBCHEP",53,0)
 ;check if user wants to add a second invoice for this 7078
"RTN","FBCHEP",54,0)
 W ! S DIR("A")="Want to add another invoice for this episode of care",DIR("B")="No",DIR(0)="Y" D ^DIR K DIR I Y S (FBNOPTF,FBRESUB)=1 G SETINV
"RTN","FBCHEP",55,0)
Q K BO,CNT,D,DA,DAT,DIC,DIE,DLAYGO,DR,FB7078,FBAABDT,FBAABE,FBAAEDT,FBAAID,FBAAIN,FBAAOUT,FBAAPTC,FBDX,FBTT,FBTYPE,FBVEN,FBVET,FBXX,FTP,I,J,FBK,PI,FBPOP,PTYPE,S,FBZ,Z1,FBI,FBPROG,FBRR,FBSW,FBPOV,FBPT,FBY,T,Y,Z1,Z2,ZZ,FBPSA,A,FBI7078
"RTN","FBCHEP",56,0)
 K FBCHOB,FBAUT,FBSEQ,X,FBSITE,F,FBSTN,FBASSOC,FBLOC,DUOUT,PSA,FBCOUNTY,DFN,FBNOPTF,DIRUT,FBVE,FBAAOUT,FBEXMPT,FBAAPN,FBAMTC,FBDEL,FBINC,FBLN,FBRESUB
"RTN","FBCHEP",57,0)
 K FBD1,FBFDC,FBMST,FBTTYPE,FB583
"RTN","FBCHEP",58,0)
 K FBCSID,FBFPPSC,FBFPPSL,FBCDAYS,FBAMTP,FBADJ,FBRRMK
"RTN","FBCHEP",59,0)
 Q
"RTN","FBCHEP",60,0)
PTF I $G(FBVET),$G(FBI7078)["FB583" S:'$G(DFN) DFN=FBVET S Y=$P(FBZ(0),"^",4)_"^"_1 D WAIT^DICD,CREATE^DGPTFCR W !,*7,$S(Y>0:"Non-VA PTF Record Created.",1:"Unable to create Non VA PTF Record."),!
"RTN","FBCHEP",61,0)
 Q
"RTN","FBCHEP",62,0)
PRBT ;Entry point for patient reimbursement option
"RTN","FBCHEP",63,0)
 ;
"RTN","FBCHEP",64,0)
 S FBAAPTC="R"
"RTN","FBCHEP",65,0)
 G RD
"RTN","FBCHEP",66,0)
CHK ;Check for vendor and batch being exempt from pricer
"RTN","FBCHEP",67,0)
 I $G(FBVE)'="Y"&($G(FBVE)'="N") S FBVE="N"
"RTN","FBCHEP",68,0)
 I $G(FBEXMPT)="Y" Q:FBVE="Y"  G OPEN:FBVE="N"
"RTN","FBCHEP",69,0)
 I $G(FBEXMPT)="N" Q:FBVE="N"  G OPEN:FBVE="Y"
"RTN","FBCHEP",70,0)
 I '$G(FBEXMPT)&($G(Z2)'>0) S FBEXMPT=FBVE Q
"RTN","FBCHEP",71,0)
 I '$G(FBEXMPT)&($G(Z2)>0) S $P(^FBAA(161.7,FBAABE,0),"^",18)="N",FBEXMPT="N" G CHK
"RTN","FBCHEP",72,0)
 Q
"RTN","FBCHEP",73,0)
OPEN W *7,!!,"This Invoice may not be added to Batch # ",+FBY(0),".",!,"***You may not add a ",$S(FBVE="Y":"pricer exempt",1:"non-exempt")," invoice to a ",$S(FBVE="Y":"non-exempt",1:"pricer exempt")," batch.***"
"RTN","FBCHEP",74,0)
 S DIR(0)="Y",DIR("A")="Do you want to open a new batch at this time",DIR("B")="Y" D ^DIR K DIR S:$D(DIRUT)!('Y) FBAAOUT=1 Q:FBAAOUT  D RCHOP^FBAAOB S FBEXMPT=FBVE D
"RTN","FBCHEP",75,0)
 .S FBY(0)=$G(^FBAA(161.7,FBAABE,0)),Z1=$P(FBY(0),"^",11),BO=$P(FBY(0),"^",2),Z2=$P(FBY(0),"^",10),FBSTN=$P(FBY(0),"^",8),FBCHOB=FBSTN_"-"_$P(FBY(0),"^",2)
"RTN","FBCHEP",76,0)
 Q
"RTN","FBCHPET")
0^10^B31972937
"RTN","FBCHPET",1,0)
FBCHPET ;AISC/DMK-EDIT ANCILLARY PAYMENT ;7/13/2003
"RTN","FBCHPET",2,0)
 ;;3.5;FEE BASIS;**4,38,61,77**;JAN 30, 1995
"RTN","FBCHPET",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCHPET",4,0)
 S FY=$E(DT,1,3)+1700+$S($E(4,5)>9:1,1:0)
"RTN","FBCHPET",5,0)
GETPT I $G(BAT) D
"RTN","FBCHPET",6,0)
 .I '$D(^FBAAC("AC",+BAT)) F I=9,10,11 S $P(^FBAA(161.7,+BAT,0),U,I)=""
"RTN","FBCHPET",7,0)
 .I $D(^FBAAC("AC",+BAT)) D  S $P(^FBAA(161.7,+BAT,0),U,11)=I,$P(^(0),U,9)=$G(FBTOT) K I,FBTOT
"RTN","FBCHPET",8,0)
 ..N J,K,L,M S (I,J,K,L,M,FBTOT)=0
"RTN","FBCHPET",9,0)
 ..F  S J=$O(^FBAAC("AC",+BAT,J)) Q:'J  F  S K=$O(^FBAAC("AC",+BAT,J,K)) Q:'K  F  S L=$O(^FBAAC("AC",+BAT,J,K,L)) Q:'L  F  S M=$O(^FBAAC("AC",+BAT,J,K,L,M)) Q:'M  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S I=I+1,FBTOT=FBTOT+$P(^(0),U,3)
"RTN","FBCHPET",10,0)
 W !! S DIC="^FBAAC(",DIC(0)="AEQM" D ^DIC G END:X="^"!(X=""),GETPT:Y<0 S (DFN,FBDA(3))=+Y
"RTN","FBCHPET",11,0)
 S:'$D(^FBAAC(DFN,1,0)) ^FBAAC(DFN,1,0)="^162.01P^0^0"
"RTN","FBCHPET",12,0)
 S DIC=DIC_DFN_",1,"
"RTN","FBCHPET",13,0)
GETVD W !! S DIC(0)="AEQM" D ^DIC G GETPT:X="^"!(X=""),GETVD:Y<0 S (FBV,FBVD,FBDA(2))=+Y
"RTN","FBCHPET",14,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,0)) ^FBAAC(DFN,1,FBDA(2),1,0)="^162.02DA^0^0"
"RTN","FBCHPET",15,0)
 S DIC=DIC_FBVD_",1,"
"RTN","FBCHPET",16,0)
GETDT S DIC(0)="AEQM",DIC("A")="Date of Service: " D ^DIC K DIC("A") G GETPT:X="^"!(X=""),GETDT:Y<0 S (FBSD,FBSDI,FBDA(1))=+Y,FBAADT=$P(Y,U,2)
"RTN","FBCHPET",17,0)
 S:'$D(^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)) ^FBAAC(DFN,1,FBDA(2),1,FBDA(1),1,0)="^162.03A^0^0"
"RTN","FBCHPET",18,0)
 S FBZ=DIC_FBSD_",1,"
"RTN","FBCHPET",19,0)
SERV S DA(3)=FBDA(3),DA(2)=FBDA(2),DA(1)=FBDA(1)
"RTN","FBCHPET",20,0)
 S DIC("W")="N FBX S FBX=$$MODL^FBAAUTL4(""^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,+Y,""""M"""")"",""E"") W:FBX]"""" ""    CPT Modifier(s): "",FBX Q"
"RTN","FBCHPET",21,0)
 S DIC=FBZ,DIC(0)="AEQMZ"
"RTN","FBCHPET",22,0)
 D
"RTN","FBCHPET",23,0)
 . N ICPTVDT S ICPTVDT=$G(FBAADT) D ^DIC
"RTN","FBCHPET",24,0)
 G GETPT:X="^"!(X=""),SERV:Y<0 S (FBSV,FBAACPI,FBDA)=+Y,BAT=$P(Y(0),U,8),FBDUZ=$P(Y(0),U,7),(FBAACP,FBAACP(0))=$P(Y,U,2),K=$P(Y(0),U,3),FBAAPTC=$P(Y(0),U,20),J(0)=$P(Y(0),U,2)
"RTN","FBCHPET",25,0)
 ; set FB1725 true (1) if payment is for a Mill Bill claim
"RTN","FBCHPET",26,0)
 S FB1725=$S($P(Y(0),U,13)["FB583":+$P($G(^FB583(+$P(Y(0),U,13),0)),U,28),1:0)
"RTN","FBCHPET",27,0)
 I FBDUZ'=DUZ&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry,only the clerk who entered the payment ",!," or a supervisor can edit this payment." G GETPT
"RTN","FBCHPET",28,0)
 S FBAAMM1=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,2)
"RTN","FBCHPET",29,0)
 S FBFSAMT(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,2)),U,12)
"RTN","FBCHPET",30,0)
 ; determine lesser of original fee schedule amount and amount claimed
"RTN","FBCHPET",31,0)
 S FBAMTPD(0)=$S(FBFSAMT(0)="":J(0),FBFSAMT(0)>J(0):J(0),1:FBFSAMT(0))
"RTN","FBCHPET",32,0)
 S FBMODL=$$MODL^FBAAUTL4("^FBAAC("_FBDA(3)_",1,"_FBDA(2)_",1,"_FBDA(1)_",1,"_FBDA_",""M"")")
"RTN","FBCHPET",33,0)
 ; load current adjustment data
"RTN","FBCHPET",34,0)
 D LOADADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBCHPET",35,0)
 ; save adjustment data prior to edit session in sorted list
"RTN","FBCHPET",36,0)
 S FBADJL(0)=$$ADJL^FBUTL2(.FBADJ) ; sorted list of original adjustments
"RTN","FBCHPET",37,0)
 ; load current remittance remark data
"RTN","FBCHPET",38,0)
 D LOADRR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBCHPET",39,0)
 ; save remittance remarks prior to edit session in sorted list
"RTN","FBCHPET",40,0)
 S FBRRMKL(0)=$$RRL^FBUTL4(.FBRRMK)
"RTN","FBCHPET",41,0)
 S FBFPPSC(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U)
"RTN","FBCHPET",42,0)
 S FBFPPSC=FBFPPSC(0)
"RTN","FBCHPET",43,0)
 S FBFPPSL(0)=$P($G(^FBAAC(FBDA(3),1,FBDA(2),1,FBDA(1),1,FBDA,3)),U,2)
"RTN","FBCHPET",44,0)
 S FBFPPSL=FBFPPSL(0)
"RTN","FBCHPET",45,0)
 G:BAT']"" EDIT
"RTN","FBCHPET",46,0)
 I $P($G(^FBAA(161.7,BAT,"ST")),"^",1)="S"!($P($G(^FBAA(161.7,BAT,"ST")),"^",1)="T")&('$D(^XUSEC("FBAASUPERVISOR",DUZ))) W !!,*7,"Sorry, only the Supervisor can edit a payment once the batch has been released." G GETPT
"RTN","FBCHPET",47,0)
 I $P($G(^FBAA(161.7,BAT,"ST")),"^",1)="V" W !!,*7,"Sorry,you cannot edit a payment once the batch has been Finalized." G GETPT
"RTN","FBCHPET",48,0)
EDIT S DA=FBSV
"RTN","FBCHPET",49,0)
 ;
"RTN","FBCHPET",50,0)
 ; first edit CPT code and modifiers
"RTN","FBCHPET",51,0)
 D CPTM^FBAALU(FBAADT,DFN,FBAACP(0),FBMODL) I '$G(FBGOT) G GETPT
"RTN","FBCHPET",52,0)
 ; if CPT was changed then update file
"RTN","FBCHPET",53,0)
 I FBAACP'=FBAACP(0) D  I FBAACP="@" G GETPT
"RTN","FBCHPET",54,0)
 . N FBIENS,FBFDA
"RTN","FBCHPET",55,0)
 . S FBIENS=FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_","
"RTN","FBCHPET",56,0)
 . S FBFDA(162.03,FBIENS,.01)=FBAACP
"RTN","FBCHPET",57,0)
 . D FILE^DIE("","FBFDA") D MSG^DIALOG()
"RTN","FBCHPET",58,0)
 ; if modifiers changed then update file
"RTN","FBCHPET",59,0)
 I FBMODL'=$$MODL^FBAAUTL4("FBMODA") D REPMOD^FBAAUTL4(FBDA(3),FBDA(2),FBDA(1),FBDA)
"RTN","FBCHPET",60,0)
 ;
"RTN","FBCHPET",61,0)
 ; now edit remaining fields
"RTN","FBCHPET",62,0)
 S DIE("NO^")=""
"RTN","FBCHPET",63,0)
 S DR="48;47;S FBUNITS=X;42R;S FBZIP=X;S:$$ANES^FBAAFS($$CPT^FBAAUTL4(FBAACP)) Y=""@2"";43///@;S FBTIME=X;S Y=""@3"";@2;43R;S FBTIME=X;@3"
"RTN","FBCHPET",64,0)
 S DR(1,162.03,1)="S FBAAMM=$S(FBAAPTC=""R"":"""",1:1);D PPT^FBAACO1(FBAAMM1);34///@;34////^S X=FBAAMM1;30R;S FBHCFA(30)=X;1;S J=X;Q"
"RTN","FBCHPET",65,0)
 S DR(1,162.03,2)="D FEEDT^FBAACO3;44///@;44///^S X=FBFSAMT;45///@;45///^S X=FBFSUSD;S:FBAMTPD'>0!(FBAMTPD=FBAMTPD(0)) Y=""@4"";2///^S X=FBAMTPD;@4;2//^S X=FBAMTPD;D CHKIT^FBAACO3;S K=X"
"RTN","FBCHPET",66,0)
 ;S DR(1,162.03,3)="3////^S X=$S(J-K:J-K,1:"""");I X S Y=""@11"";4////@;S Y=""@5"";@11;3R;4R;S:X'=4 Y=""@5"";22"
"RTN","FBCHPET",67,0)
 S DR(1,162.03,3)="K FBADJD;M FBADJD=FBADJ;S FBX=$$ADJ^FBUTL2(J-K,.FBADJ,2,,.FBADJD,1)"
"RTN","FBCHPET",68,0)
 S DR(1,162.03,4)="S FBX=$$FPPSC^FBUTL5(1,FBFPPSC);S:FBX=-1 Y=0;S:FBX="""" Y=""@5"";50///^S X=FBX;S FBFPPSC=X;S FBX=$$FPPSL^FBUTL5(FBFPPSL);S:FBX=-1 Y=0;51///^S X=FBX;S FBFPPCL=X;S Y=""@55"";@5;50///@;S FBFPPSC="""";51///@;S FBFPPCL="""";@55"
"RTN","FBCHPET",69,0)
 S DR(1,162.03,5)="@5;K DIE(""NO^"");W !,""Exit ('^') allowed now"";26;S PRC(""SITE"")=X;8;13;Q;33;49"
"RTN","FBCHPET",70,0)
 S DR(1,162.03,6)="15;16;17////^S X=1"
"RTN","FBCHPET",71,0)
 S DR(1,162.03,7)="@7;K FBRRMKD;M FBRRMKD=FBRRMK;S FBX=$$RR^FBUTL4(.FBRRMK,2,,.FBRRMKD)"
"RTN","FBCHPET",72,0)
 S DIE=FBZ
"RTN","FBCHPET",73,0)
 D
"RTN","FBCHPET",74,0)
 . N ICPTVDT,ICDVDT S (ICPTVDT,ICDVDT)=$G(FBAADT) D ^DIE
"RTN","FBCHPET",75,0)
 ; if adjustment data changed then file
"RTN","FBCHPET",76,0)
 I $$ADJL^FBUTL2(.FBADJ)'=FBADJL(0) D FILEADJ^FBAAFA(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBADJ)
"RTN","FBCHPET",77,0)
 ; if remit remark data changed then file
"RTN","FBCHPET",78,0)
 I $$RRL^FBUTL4(.FBRRMK)'=FBRRMKL(0) D FILERR^FBAAFR(FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",.FBRRMK)
"RTN","FBCHPET",79,0)
 ; if FPPS CLAIM ID changed, update other line items on invoice
"RTN","FBCHPET",80,0)
 I FBFPPSC'=FBFPPSC(0) D
"RTN","FBCHPET",81,0)
 . N FBAAIN
"RTN","FBCHPET",82,0)
 . S FBAAIN=$$GET1^DIQ(162.03,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",",14)
"RTN","FBCHPET",83,0)
 . D CKINVEDI^FBAAPET1(FBFPPSC(0),FBFPPSC,FBAAIN,FBDA_","_FBDA(1)_","_FBDA(2)_","_FBDA(3)_",")
"RTN","FBCHPET",84,0)
 K FBSV W !! G SERV
"RTN","FBCHPET",85,0)
END K DR,DIC,DIE,X,DFN,FBVD,FBSD,BAT,FBSV,DA,FBDA,FBZ,FBDUZ,FBAACP,FBFY,FY,FBAMTPD,J,K,Y,PRC,FBHOLDX,ZZ,FBAADT,FBV,FBSDI,FBAACPI
"RTN","FBCHPET",86,0)
 K FBAAMM,FBAAMM1,FBFSAMT,FBFSUSD,FBMODA,FBZIP,FBTIME,FBHCFA(30)
"RTN","FBCHPET",87,0)
 K FBAAPTC,FB1725
"RTN","FBCHPET",88,0)
 K FBADJ,FBADJD,FBADJL,FBRRMK,FBRRMKD,FBRRMKL,FBX,FBUNITS
"RTN","FBCHPET",89,0)
 Q
"RTN","FBCSV1")
0^18^B18393988
"RTN","FBCSV1",1,0)
FBCSV1 ;WOIFO/SS-UTILITIES FOR CODE SET VERSIONING;4/7/2003
"RTN","FBCSV1",2,0)
 ;;3.5;FEE BASIS;**55,77**;JAN 30, 1995
"RTN","FBCSV1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBCSV1",4,0)
 ;
"RTN","FBCSV1",5,0)
 ;wrapper for DRG^ICDGTDRG
"RTN","FBCSV1",6,0)
 ;to use instead of direct read of ^ICD(
"RTN","FBCSV1",7,0)
 ;FBIEN - ien of #80.2
"RTN","FBCSV1",8,0)
 ;FBDATE - date of service (optional)
"RTN","FBCSV1",9,0)
 ;returns (#.01) NAME of #80.2 or "" if invalid/error
"RTN","FBCSV1",10,0)
ICD(FBIEN,FBDATE) ;
"RTN","FBCSV1",11,0)
 N FBRET
"RTN","FBCSV1",12,0)
 S FBRET=$$DRG^ICDGTDRG($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE))
"RTN","FBCSV1",13,0)
 Q:+FBRET<0 ""
"RTN","FBCSV1",14,0)
 Q $P(FBRET,"^",1)
"RTN","FBCSV1",15,0)
 ;
"RTN","FBCSV1",16,0)
 ;wrapper for ICDOP^ICDCODE
"RTN","FBCSV1",17,0)
 ;to use instead of direct read of ^ICD0(
"RTN","FBCSV1",18,0)
 ;FBIEN - ien of #80.1
"RTN","FBCSV1",19,0)
 ;FBDATE - date of service (optional)
"RTN","FBCSV1",20,0)
 ;returns (#.01) NAME of #80.1 or "" if invalid/error
"RTN","FBCSV1",21,0)
ICD0(FBIEN,FBDATE) ;
"RTN","FBCSV1",22,0)
 N FBRET
"RTN","FBCSV1",23,0)
 S FBRET=$$ICDOP^ICDCODE($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE),,1)
"RTN","FBCSV1",24,0)
 Q:+FBRET<0 ""
"RTN","FBCSV1",25,0)
 Q $P(FBRET,"^",2)
"RTN","FBCSV1",26,0)
 ;
"RTN","FBCSV1",27,0)
 ;wrapper for ICDDX^ICDCODE
"RTN","FBCSV1",28,0)
 ;to use instead of direct read of ^ICD9(
"RTN","FBCSV1",29,0)
 ;FBIEN - ien of #80
"RTN","FBCSV1",30,0)
 ;FBDATE - date of service (optional)
"RTN","FBCSV1",31,0)
 ;returns (#.01) NAME of #80 or "" if invalid/error
"RTN","FBCSV1",32,0)
ICD9(FBIEN,FBDATE) ;
"RTN","FBCSV1",33,0)
 N FBRET
"RTN","FBCSV1",34,0)
 S FBRET=$$ICDDX^ICDCODE($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE),,1)
"RTN","FBCSV1",35,0)
 Q:+FBRET<0 ""
"RTN","FBCSV1",36,0)
 Q $P(FBRET,"^",2)
"RTN","FBCSV1",37,0)
 ;
"RTN","FBCSV1",38,0)
 ;wrapper for ICDDX^ICDCODE with piece #
"RTN","FBCSV1",39,0)
 ;to use instead of direct read of ^ICD9(
"RTN","FBCSV1",40,0)
 ;FBIEN - ien of #80
"RTN","FBCSV1",41,0)
 ;FBPC - piece #
"RTN","FBCSV1",42,0)
 ;FBDATE (optional) - date of service
"RTN","FBCSV1",43,0)
 ;returns piece # FBPC of #80 or "" if invalid/error
"RTN","FBCSV1",44,0)
ICD9P(FBIEN,FBPC,FBDATE) ;
"RTN","FBCSV1",45,0)
 N FBRET
"RTN","FBCSV1",46,0)
 S FBRET=$$ICDDX^ICDCODE($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE),,1)
"RTN","FBCSV1",47,0)
 Q:+FBRET<0 ""
"RTN","FBCSV1",48,0)
 Q $P(FBRET,"^",FBPC+1)
"RTN","FBCSV1",49,0)
 ;
"RTN","FBCSV1",50,0)
 ;extended wrapper for ICDDX^ICDCODE
"RTN","FBCSV1",51,0)
 ;to use instead of direct read of ^ICD9(
"RTN","FBCSV1",52,0)
 ;FBIEN - ien of #80
"RTN","FBCSV1",53,0)
 ;FBPC - piece #
"RTN","FBCSV1",54,0)
 ;FBEXTR - $E parameter
"RTN","FBCSV1",55,0)
 ;FBDATE (optional) - date of service
"RTN","FBCSV1",56,0)
 ;returns piece #FBPC and (#.01) NAME of #80 and or "" if invalid/error
"RTN","FBCSV1",57,0)
ICD9EX(FBIEN,FBPC,FBEXTR,FBDATE) ;
"RTN","FBCSV1",58,0)
 N FBRET
"RTN","FBCSV1",59,0)
 S FBRET=$$ICDDX^ICDCODE($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE),,1)
"RTN","FBCSV1",60,0)
 Q:+FBRET<0 ""
"RTN","FBCSV1",61,0)
 Q $E($P(FBRET,"^",FBPC+1),1,FBEXTR)_" ("_$P(FBRET,"^",2)_")"
"RTN","FBCSV1",62,0)
 ;
"RTN","FBCSV1",63,0)
 ;get FROM date
"RTN","FBCSV1",64,0)
FRDTINV(FBDA) ;
"RTN","FBCSV1",65,0)
 Q $P($G(^FBAAI(FBDA,0)),"^",6)
"RTN","FBCSV1",66,0)
 ;
"RTN","FBCSV1",67,0)
 ;if FBCODE="" returns FBNUM spaces
"RTN","FBCSV1",68,0)
 ;otherwise returns FBCODE
"RTN","FBCSV1",69,0)
SPACES(FBCODE,FBNUM) ;
"RTN","FBCSV1",70,0)
 I $L(FBCODE)=0 S $P(FBCODE," ",FBNUM)=" "
"RTN","FBCSV1",71,0)
 Q FBCODE
"RTN","FBCSV1",72,0)
 ;
"RTN","FBCSV1",73,0)
 ;EVALUATE (sometimes can be used instead of "$S")
"RTN","FBCSV1",74,0)
 ;if FBCODE="" returns FBRETV
"RTN","FBCSV1",75,0)
 ;otherwise returns FBCODE
"RTN","FBCSV1",76,0)
EV(FBCODE,FBRETV) ;
"RTN","FBCSV1",77,0)
 Q:$L(FBCODE)=0 FBRETV
"RTN","FBCSV1",78,0)
 Q FBCODE
"RTN","FBCSV1",79,0)
 ;
"RTN","FBCSV1",80,0)
 ;converts a date to fileman format
"RTN","FBCSV1",81,0)
DT2FMDT(FBDAT) ;
"RTN","FBCSV1",82,0)
 N X,Y
"RTN","FBCSV1",83,0)
 S X=$$TRIM^XLFSTR(FBDAT)
"RTN","FBCSV1",84,0)
 D ^%DT
"RTN","FBCSV1",85,0)
 Q +Y
"RTN","FBCSV1",86,0)
 ;
"RTN","FBCSV1",87,0)
 ;wrapper for ICDDX^ICDCODE
"RTN","FBCSV1",88,0)
 ;to use in prompts (and input templates)of file #162.5 to screen out 
"RTN","FBCSV1",89,0)
 ;  inactive/invalid codes
"RTN","FBCSV1",90,0)
 ;FBICD9 - ien of #80
"RTN","FBCSV1",91,0)
 ;FBINV - ien of the current #162.5 record
"RTN","FBCSV1",92,0)
 ;FBDATE - (optional) date of service
"RTN","FBCSV1",93,0)
 ;returns 0 if code is active, otherwise - nonzero value
"RTN","FBCSV1",94,0)
INPICD9(FBICD9,FBINV,FBDATE) ;
"RTN","FBCSV1",95,0)
 N FBRET
"RTN","FBCSV1",96,0)
 I '$G(FBDATE) S FBDATE=$$FRDTINV(+$G(FBINV))
"RTN","FBCSV1",97,0)
 S FBRET=$$ICDDX^ICDCODE($G(FBICD9),$S(+$G(FBDATE)=0:"",1:FBDATE))
"RTN","FBCSV1",98,0)
 I +FBRET<0 W " Invalid Code " Q 2
"RTN","FBCSV1",99,0)
 I $P(FBRET,"^",10)=0 W !," Code is inactive" W:$G(FBDATE)>0 " on "_$$FMTE^XLFDT(FBDATE) Q 1
"RTN","FBCSV1",100,0)
 Q 0
"RTN","FBCSV1",101,0)
 ;
"RTN","FBCSV1",102,0)
 ;wrapper for ICDOP^ICDCODE
"RTN","FBCSV1",103,0)
 ;checks if code is active on the date of service and
"RTN","FBCSV1",104,0)
 ;if active returns CODE NUMBER
"RTN","FBCSV1",105,0)
 ;is inactive returns "" and prints message "ICD O/P Code inactive ..."
"RTN","FBCSV1",106,0)
 ;is invalid/local returns "" and prints message "Invalid ICD O/P Code"
"RTN","FBCSV1",107,0)
CHKICD0(FBIEN,FBDATE) ;
"RTN","FBCSV1",108,0)
 N FBRET
"RTN","FBCSV1",109,0)
 S FBRET=$$ICDOP^ICDCODE($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE))
"RTN","FBCSV1",110,0)
 I +FBRET<0 W " Invalid ICD O/P Code " Q ""
"RTN","FBCSV1",111,0)
 I $P(FBRET,"^",10)=0 D  Q ""
"RTN","FBCSV1",112,0)
 . W !," ICD O/P Code "_$P(FBRET,"^",2)_" inactive"
"RTN","FBCSV1",113,0)
 . W:$G(FBDATE) " on date of service (",$$FMTE^XLFDT(FBDATE),")"
"RTN","FBCSV1",114,0)
 Q $P(FBRET,"^",2)
"RTN","FBCSV1",115,0)
 ;
"RTN","FBCSV1",116,0)
 ;wrapper for ICDOP^ICDCODE
"RTN","FBCSV1",117,0)
 ;to use in prompts (and input templates)of file #162.5 to screen out 
"RTN","FBCSV1",118,0)
 ;  inactive/invalid codes
"RTN","FBCSV1",119,0)
 ;FBICD0 - ien of #80.1
"RTN","FBCSV1",120,0)
 ;FBINV - ien of the current #162.5 record
"RTN","FBCSV1",121,0)
 ;FBDATE - (optional) date of service
"RTN","FBCSV1",122,0)
 ;returns 0 if code is active, otherwise - nonzero value
"RTN","FBCSV1",123,0)
INPICD0(FBICD0,FBINV,FBDATE) ;
"RTN","FBCSV1",124,0)
 N FBRET
"RTN","FBCSV1",125,0)
 I '$G(FBDATE) S FBDATE=$$FRDTINV(+$G(FBINV))
"RTN","FBCSV1",126,0)
 S FBRET=$$ICDOP^ICDCODE($G(FBICD0),$S(+$G(FBDATE)=0:"",1:FBDATE))
"RTN","FBCSV1",127,0)
 I +FBRET<0 W " Invalid Code " Q 2
"RTN","FBCSV1",128,0)
 I $P(FBRET,"^",10)=0 W !," Code is inactive" W:$G(FBDATE)>0 " on "_$$FMTE^XLFDT(FBDATE) Q 1
"RTN","FBCSV1",129,0)
 Q 0
"RTN","FBCSV1",130,0)
 ;
"RTN","FBCSV1",131,0)
 ;wrapper for DRG^ICDGTDRG
"RTN","FBCSV1",132,0)
 ;to use in prompts (and input templates)of file #162.5 to screen out 
"RTN","FBCSV1",133,0)
 ;  inactive/invalid codes
"RTN","FBCSV1",134,0)
 ;FBICD - ien of #80.2
"RTN","FBCSV1",135,0)
 ;FBINV - ien of the current #162.5 record
"RTN","FBCSV1",136,0)
 ;FBDATE - (optional) date of service
"RTN","FBCSV1",137,0)
 ;returns 0 if code is active, otherwise - nonzero value
"RTN","FBCSV1",138,0)
INPICD(FBICD,FBINV,FBDATE) ;
"RTN","FBCSV1",139,0)
 N FBRET
"RTN","FBCSV1",140,0)
 I '$G(FBDATE) S FBDATE=$$FRDTINV(+$G(FBINV))
"RTN","FBCSV1",141,0)
 S FBRET=$$DRG^ICDGTDRG($G(FBICD),$S(+$G(FBDATE)=0:"",1:FBDATE))
"RTN","FBCSV1",142,0)
 I +FBRET<0 W " Invalid Code " Q 2
"RTN","FBCSV1",143,0)
 I $P(FBRET,"^",14)=0 W !," Code is inactive" W:$G(FBDATE)>0 " on "_$$FMTE^XLFDT(FBDATE) Q 1
"RTN","FBCSV1",144,0)
 Q 0
"RTN","FBCSV1",145,0)
 ;
"RTN","FBCSV1",146,0)
 ;wrapper for ICDDX^ICDCODE
"RTN","FBCSV1",147,0)
 ;checks if code is inactive on the date of service and 
"RTN","FBCSV1",148,0)
 ;if active returns CODE NUMBER
"RTN","FBCSV1",149,0)
 ;is inactive returns "" and prints message "ICD Dx Code inactive ..."
"RTN","FBCSV1",150,0)
 ;is invalid/local returns "" and prints message "Invalid ICD Dx Code"
"RTN","FBCSV1",151,0)
CHKICD9(FBIEN,FBDATE) ;
"RTN","FBCSV1",152,0)
 N FBRET
"RTN","FBCSV1",153,0)
 S FBRET=$$ICDDX^ICDCODE($G(FBIEN),$S(+$G(FBDATE)=0:"",1:FBDATE))
"RTN","FBCSV1",154,0)
 I +FBRET<0 W " Invalid ICD Dx Code " Q ""
"RTN","FBCSV1",155,0)
 I $P(FBRET,"^",10)=0 D  Q ""
"RTN","FBCSV1",156,0)
 . W !," ICD Dx Code "_$P(FBRET,"^",2)_" inactive"
"RTN","FBCSV1",157,0)
 . W:$G(FBDATE) " on date of service (",$$FMTE^XLFDT(FBDATE),")"
"RTN","FBCSV1",158,0)
 Q $P(FBRET,"^",2)
"RTN","FBCSV1",159,0)
 ;
"RTN","FBCSV1",160,0)
 ;
"RTN","FBCSV1",161,0)
 ;convert date as a string like "MMDDYYYY" into FM date like "YYYMMDD"
"RTN","FBCSV1",162,0)
STR2FBDT(FBDTSTR) ;
"RTN","FBCSV1",163,0)
 N X,Y S X=FBDTSTR D ^%DT
"RTN","FBCSV1",164,0)
 Q:Y=-1 ""
"RTN","FBCSV1",165,0)
 Q Y\1
"RTN","FBCSV1",166,0)
 ;
"RTN","FBCSV1",167,0)
 ;FBCSV1
"RTN","FBPHON2")
0^4^B21396755
"RTN","FBPHON2",1,0)
FBPHON2 ;AISC/CMR-LIST PAYMENTS CONT. ;4/17/2000
"RTN","FBPHON2",2,0)
 ;;3.5;FEE BASIS;**4,21,77**;JAN 30, 1995
"RTN","FBPHON2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPHON2",4,0)
 D FULL^VALM1
"RTN","FBPHON2",5,0)
EN N FBI,FBX,FBAAOUT,Q S Q="-",$P(Q,"-",80)="-",FBAAOUT=0,VALMBCK="R"
"RTN","FBPHON2",6,0)
 D SEL^VALM2 G END:'$O(VALMY(0))
"RTN","FBPHON2",7,0)
 S FBI=0 F  S FBI=$O(VALMY(FBI)) Q:'FBI  I $D(^TMP("FBPHIDX",$J,FBI)) S FBX=^(FBI) D @FBPR I '$G(FBAAOUT) S DIR(0)="E",DIR("A")="Press 'ENTER' to "_$S($O(VALMY(FBI)):"view next selection",1:"return to list") D ^DIR K DIR Q:'Y
"RTN","FBPHON2",8,0)
 Q
"RTN","FBPHON2",9,0)
END S VALMBCK="R" Q
"RTN","FBPHON2",10,0)
BT ;display batch for chosen line item
"RTN","FBPHON2",11,0)
 W @IOF N B
"RTN","FBPHON2",12,0)
 S B=$P(FBX,U,8) I B']"" D ERR Q
"RTN","FBPHON2",13,0)
 I $D(^FBAA(161.7,B,0)) S FBTYPE=$P(^FBAA(161.7,B,0),U,3)
"RTN","FBPHON2",14,0)
 D ENM^FBAACCB:FBTYPE="B3",ENP^FBAACCB:FBTYPE="B5",ENT^FBAACCB0:FBTYPE="B2",PRTC^FBAACCB1:FBTYPE="B9"
"RTN","FBPHON2",15,0)
 Q
"RTN","FBPHON2",16,0)
INV ;display invoice for chosen line item
"RTN","FBPHON2",17,0)
 W @IOF N FBAAIN,FBAAOUT,FBINTOT,J,DA,FBI
"RTN","FBPHON2",18,0)
 I $P(FBX,U,7)']"" D ERR Q
"RTN","FBPHON2",19,0)
 I $P(FBX,U)="PHAR" S DA=$P(FBX,U,7) D START^FBAAPII Q
"RTN","FBPHON2",20,0)
 I $P(FBX,U)="CH"!($P(FBX,U)="CNH") S FBI=$P(FBX,U,7) D START^FBCHDI2 Q
"RTN","FBPHON2",21,0)
 I $P(FBX,U)="OPT" D  D Q^FBAAPIN
"RTN","FBPHON2",22,0)
 .S FBAAIN=$P(FBX,U,7),(FBAAOUT,FBINTOT,J)=0 F  S J=$O(^FBAAC("C",FBAAIN,J)) Q:'J!(FBAAOUT)  D MMORE^FBAAPIN
"RTN","FBPHON2",23,0)
 D Q^FBAAPIN
"RTN","FBPHON2",24,0)
 Q
"RTN","FBPHON2",25,0)
BS ;display batch status for chosen line item
"RTN","FBPHON2",26,0)
 W @IOF N DA
"RTN","FBPHON2",27,0)
 I $P(FBX,U,8)']"" D ERR Q
"RTN","FBPHON2",28,0)
 S DA=$P(FBX,U,8) D START^FBAABS
"RTN","FBPHON2",29,0)
 Q
"RTN","FBPHON2",30,0)
DV ;display vendor demographics for chosen vendor
"RTN","FBPHON2",31,0)
 N DA S VALMBCK="R"
"RTN","FBPHON2",32,0)
 S DA=FBV D CLEAR^VALM1,EN1^FBAAVD
"RTN","FBPHON2",33,0)
 I $D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ)) S DIR(0)="Y",DIR("A")="Want to Edit data",DIR("B")="NO" D ^DIR K DIR Q:$D(DIRUT)  D:Y EDITV^FBAAVD
"RTN","FBPHON2",34,0)
 I '$D(^XUSEC("FBAA ESTABLISH VENDOR",DUZ)) S DIR(0)="E" D ^DIR K DIR
"RTN","FBPHON2",35,0)
 D Q^FBAAVD Q
"RTN","FBPHON2",36,0)
DA ;display patient auth for selected line item
"RTN","FBPHON2",37,0)
 W @IOF N FB1,FBDA,FBTYP
"RTN","FBPHON2",38,0)
 S FBDA=$P(FBX,U,9)
"RTN","FBPHON2",39,0)
 I $P(FBX,U)="OPT" S FB1=$P(^FBAAC(DFN,1,FBV,1,$P(FBDA,",",3),1,$P(FBDA,",",4),0),U,13) D  Q
"RTN","FBPHON2",40,0)
 .I FB1']"" S FBPROG=$P(^FBAAC(DFN,1,FBV,1,$P(FBDA,",",3),0),U,4),FBPROG=$S(FBPROG:"I FBI="_FBPROG,1:""),PI="" D ^FBAADEM K FBPROG,FBAUT,PI Q
"RTN","FBPHON2",41,0)
 .I FB1["583" D UNAUTH Q
"RTN","FBPHON2",42,0)
 .I FB1["7078" D INP Q
"RTN","FBPHON2",43,0)
 I $P(FBX,U)="PHAR" S FB1=$P(^FBAA(162.1,+FBDA,"RX",$P(FBDA,",",2),2),U,6) D  Q
"RTN","FBPHON2",44,0)
 .I FB1']"" S FBPROG=$P($G(^FBAA(162.1,+FBDA,"RX",$P(FBDA,",",2),2)),U,7),FBPROG=$S(FBPROG:"I FBI="_FBPROG,1:""),PI="" D ^FBAADEM K FBPROG,FBAUT,PI Q
"RTN","FBPHON2",45,0)
 .I FB1["583" D UNAUTH Q
"RTN","FBPHON2",46,0)
 .I FB1["7078" D INP Q
"RTN","FBPHON2",47,0)
 I $P(FBX,U)["C" S FB1=$P(^FBAAI(+FBDA,0),U,5) I FB1["583" D UNAUTH Q
"RTN","FBPHON2",48,0)
INP N DA,FBDA,DIC,DR S (FBDA,DA)=+FB1,DIC="^FB7078(",DR="0;1" W @IOF D EN^DIQ
"RTN","FBPHON2",49,0)
 I $$DISCH^FBCH780(FBDA)]"" W ?2,"DISCHARGE TYPE: ",$$DISCH^FBCH780(FBDA)
"RTN","FBPHON2",50,0)
 Q
"RTN","FBPHON2",51,0)
UNAUTH N DA,DIC,DR S DA=+FB1,DIC="^FB583(",DR="0;1" W @IOF D EN^DIQ
"RTN","FBPHON2",52,0)
 Q
"RTN","FBPHON2",53,0)
EV ;expand view
"RTN","FBPHON2",54,0)
 W @IOF N FBZ S FBZ=$P(FBX,U,9)
"RTN","FBPHON2",55,0)
 I $P(FBX,U)="OPT" S DIC="^FBAAC("_DFN_",1,"_FBV_",1,"_$P(FBZ,",",3)_",1,",DA(3)=DFN,DA(2)=FBV,DA(1)=$P(FBZ,",",3),DA=$P(FBZ,",",4),DR=""
"RTN","FBPHON2",56,0)
 I $P(FBX,U)="PHAR" S DIC="^FBAA(162.1,"_+FBZ_",""RX"",",DA(1)=+FBZ,DA=$P(FBZ,",",2),DR=""
"RTN","FBPHON2",57,0)
 I $P(FBX,U)["C" S DIC="^FBAAI(",DA=FBZ,DR=""
"RTN","FBPHON2",58,0)
 W @IOF D EN^DIQ
"RTN","FBPHON2",59,0)
 K DIC,DA,DR
"RTN","FBPHON2",60,0)
 Q
"RTN","FBPHON2",61,0)
CP ;change patient
"RTN","FBPHON2",62,0)
 D CLEAR^VALM1
"RTN","FBPHON2",63,0)
 N FBCP S VALMBCK="R"
"RTN","FBPHON2",64,0)
 S DIR(0)="P^161:EMZ",DIR("A")="Payments for veteran" D ^DIR K DIR I $D(DIRUT) Q
"RTN","FBPHON2",65,0)
 S DFN=+Y,FBCP=1 D HDR^FBPHON,START^FBPHON
"RTN","FBPHON2",66,0)
 Q
"RTN","FBPHON2",67,0)
CV ;change vendor
"RTN","FBPHON2",68,0)
 D CLEAR^VALM1
"RTN","FBPHON2",69,0)
 N FBCP S VALMBCK="R"
"RTN","FBPHON2",70,0)
 S DIR(0)="P^161.2:EMZ" D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBPHON2",71,0)
 S FBV=+Y,FBCP=1 D HDR^FBPHON,START^FBPHON
"RTN","FBPHON2",72,0)
 Q
"RTN","FBPHON2",73,0)
DC ;display check
"RTN","FBPHON2",74,0)
 W @IOF S FBCN=$P(FBX,U,11) I FBCN']"" W !,*7,"No check found for this line item." Q
"RTN","FBPHON2",75,0)
 D START^FBCKDIS
"RTN","FBPHON2",76,0)
 Q
"RTN","FBPHON2",77,0)
CD ;display CPT/MOD description
"RTN","FBPHON2",78,0)
 W @IOF
"RTN","FBPHON2",79,0)
 N FBCPT,FBJ,FBMOD,FBMODX
"RTN","FBPHON2",80,0)
 Q:$P(FBX,U)'="OPT"!($P(FBX,U,3)']"")
"RTN","FBPHON2",81,0)
 S FBCPT=$P(FBX,U,3) W !,"Line item #",FBI,!?5,"CPT: ",$P(FBCPT,"-"),?18,$P($$CPT^ICPTCOD($P(FBCPT,"-"),$S(+$P(FBX,U,2)>0:+$P(FBX,U,2),1:""),1),U,3)
"RTN","FBPHON2",82,0)
 I FBCPT["-" F FBJ=1:1 S FBMOD=$P($P(FBCPT,"-",2),",",FBJ) Q:FBMOD=""  D
"RTN","FBPHON2",83,0)
 . W !?5,"MOD: ",FBMOD
"RTN","FBPHON2",84,0)
 . S FBMODX=$$MOD^ICPTMOD(FBMOD,"E",$P(FBX,U,2))
"RTN","FBPHON2",85,0)
 . ; if modifier data not obtained then try another API to resolve it
"RTN","FBPHON2",86,0)
 . ; since there can be duplicate modifiers with same external value
"RTN","FBPHON2",87,0)
 . I $P(FBMODX,U)'>0 D
"RTN","FBPHON2",88,0)
 . . N FBY
"RTN","FBPHON2",89,0)
 . . S FBY=$$MODP^ICPTMOD($P(FBCPT,"-"),FBMOD,"E",$P(FBX,U,2))
"RTN","FBPHON2",90,0)
 . . I $P(FBY,U)>0 S FBMODX=$$MOD^ICPTMOD($P(FBY,U),"I",$P(FBX,U,2))
"RTN","FBPHON2",91,0)
 . W ?18,$S($P(FBMODX,U)>0:$P(FBMODX,U,3),1:"")
"RTN","FBPHON2",92,0)
 Q
"RTN","FBPHON2",93,0)
ERR ;
"RTN","FBPHON2",94,0)
 W !,"No ",$S(FBPR["B":"batch",1:"invoice")," number on file for this entry" Q
"RTN","FBPRICE1")
0^13^B8962799
"RTN","FBPRICE1",1,0)
FBPRICE1 ;AISC/DMK-GENERIC PRICER INTERFACE CON'T ;25JUN92
"RTN","FBPRICE1",2,0)
 ;;3.5;FEE BASIS;**56,55,77**;JAN 30, 1995
"RTN","FBPRICE1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPRICE1",4,0)
 ;
"RTN","FBPRICE1",5,0)
ICD ;ask Dx
"RTN","FBPRICE1",6,0)
 W ! F I=1:1:5 S FBDX(I)="       "
"RTN","FBPRICE1",7,0)
 S DIR(0)="PO^80:EQMZ"
"RTN","FBPRICE1",8,0)
 F I=1:1:5 D  Q:X=""!($D(DTOUT))!($D(DUOUT))
"RTN","FBPRICE1",9,0)
 . N ICDVDT S ICDVDT=$$STR2FBDT^FBCSV1($G(FBFDT)) ;see DD for file #80
"RTN","FBPRICE1",10,0)
 . N FBRT F  D ^DIR Q:X=""!($D(DTOUT))!($D(DUOUT))!(+Y'>0)  S FBRT=$$CHKICD9^FBCSV1(+Y,$$STR2FBDT^FBCSV1($G(FBFDT))) I FBRT]"" S FBDX(I)=$TR(FBRT,"."),FBDX(I)=FBDX(I)_$E(PAD,$L(FBDX(I))+1,7) Q
"RTN","FBPRICE1",11,0)
 I FBDX(1)="       ",$D(DTOUT)!($D(DUOUT)) G END^FBPRICE
"RTN","FBPRICE1",12,0)
 I FBDX(1)="       " W !,*7,"Must enter at least a primary diagnosis.",! G ICD
"RTN","FBPRICE1",13,0)
 K DIR,I
"RTN","FBPRICE1",14,0)
PROC ;ask procedure codes
"RTN","FBPRICE1",15,0)
 W ! F I=1:1:3 S FBPRC(I)="       "
"RTN","FBPRICE1",16,0)
 S DIR(0)="PO^80.1:EQM"
"RTN","FBPRICE1",17,0)
 F I=1:1:3 D  Q:X=""!($D(DUOUT))!($D(DTOUT))
"RTN","FBPRICE1",18,0)
 . N ICDVDT S ICDVDT=$$STR2FBDT^FBCSV1($G(FBFDT)) ;for ^DIR see DD for file #80.1
"RTN","FBPRICE1",19,0)
 . N FBRT F  D ^DIR Q:X=""!($D(DUOUT))!($D(DTOUT))!(+Y'>0)  S FBRT=$$CHKICD0^FBCSV1(+Y,$$STR2FBDT^FBCSV1($G(FBFDT))) I FBRT]"" S FBPRC(I)=$TR(FBRT,"."),FBPRC(I)=FBPRC(I)_$E(PAD,$L(FBPRC(I))+1,7) Q
"RTN","FBPRICE1",20,0)
 I 'FBPRC(1),$D(DTOUT)!($D(DUOUT)) G END^FBPRICE
"RTN","FBPRICE1",21,0)
 K DIR,I
"RTN","FBPRICE1",22,0)
 ;
"RTN","FBPRICE1",23,0)
 W ! S DIR(0)="162.5,6.6",DIR("A")="Billed Charges" D ^DIR K DIR G END^FBPRICE:$D(DIRUT) S FBBILL=$FN(Y,"",2),FBBILL=$TR(FBBILL,"."),FBBILL=$E("00000000",$L(FBBILL)+1,8)_FBBILL
"RTN","FBPRICE1",24,0)
 ;
"RTN","FBPRICE1",25,0)
 S DIR(0)="162.5,6.6",DIR("A")="Amount Claimed" D ^DIR K DIR G END^FBPRICE:$D(DIRUT) S FBCLAIM=$FN(Y,"",2),FBCLAIM=$TR(FBCLAIM,"."),FBCLAIM=$E("00000000",$L(FBCLAIM)+1,8)_FBCLAIM
"RTN","FBPRICE1",26,0)
 ;
"RTN","FBPRICE1",27,0)
 ;S DIR("A")="Obligation Number",DIR(0)="F^6:6^D CKOB^FBAAUTL1" D ^DIR K DIR G END^FBPRICE:$D(DIRUT) S FBOBL=Y
"RTN","FBPRICE1",28,0)
 S FBOBL="000000"
"RTN","FBPRICE1",29,0)
 ;
"RTN","FBPRICE1",30,0)
STRING ;set-up message text for pricer
"RTN","FBPRICE1",31,0)
 W ! D WAIT^DICD
"RTN","FBPRICE1",32,0)
 D ADDRESS^FBAAV01 Q:$G(VATERR)  K VAT
"RTN","FBPRICE1",33,0)
 S FBFLAG=1 D NEWMSG^FBAAV01
"RTN","FBPRICE1",34,0)
 S FBPART1=FBSSN_FBFDT_FBSTAN
"RTN","FBPRICE1",35,0)
 S FBSTR(1)=FBPART1_21_FBLNAM_FBFI_FBMI_FBSEX_FBDOB_FBLOS_FBDISP_FBBILL_FBCLAIM_FBAUTH_FBPAYT_FBOBL_"Y"
"RTN","FBPRICE1",36,0)
 S FBSTR(2)=FBPART1_22_FBVID_FBMED_$E(PAD,1,29)_FBTDT_FBSTABR_FBDX(1)
"RTN","FBPRICE1",37,0)
 S FBSTR(3)=FBPART1_23_FBDX(2)_FBDX(3)_FBDX(4)_FBDX(5)_FBPRC(1)_FBPRC(2)_FBPRC(3)_"    "
"RTN","FBPRICE1",38,0)
 F I=1:1:3 S FBSTR=FBSTR(I) D STORE^FBAAV01
"RTN","FBPRICE1",39,0)
 D XMIT^FBAAV01 K FBFLAG
"RTN","FBPRICE1",40,0)
 W !,"Case sent to pricer.",!
"RTN","FBPRICE1",41,0)
 Q
"RTN","FBXIP77E")
0^6^B3917072
"RTN","FBXIP77E",1,0)
FBXIP77E ;AISC/SS - PATCH FB*3.5*77 ENVIRONMENT CHECK ;03/29/04
"RTN","FBXIP77E",2,0)
 ;;3.5;Fee Basis;**77**;JAN 30, 1995
"RTN","FBXIP77E",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBXIP77E",4,0)
ENV ;
"RTN","FBXIP77E",5,0)
 ;this is the environment check pre-init routine
"RTN","FBXIP77E",6,0)
 I $$PATCH^XPDUTL("FB*3.5*42") D
"RTN","FBXIP77E",7,0)
 .N X,Y,DUOUT,DTOUT
"RTN","FBXIP77E",8,0)
 .W !,"You are a test site for a CoreFLS version (patch FB*3.5*42) of Fee Basis"
"RTN","FBXIP77E",9,0)
 .W !,"This patch has a conflict with the FB-CoreFLS test software."
"RTN","FBXIP77E",10,0)
 .W !,"It must NOT be installed unless an accompanying update is made to the"
"RTN","FBXIP77E",11,0)
 .W !,"FB-CoreFLS software immediately after installation of this patch."
"RTN","FBXIP77E",12,0)
 .W !
"RTN","FBXIP77E",13,0)
 .K DIR S DIR(0)="YA"
"RTN","FBXIP77E",14,0)
 .S DIR("A")="Do you have the corresponding update to the FB-CoreFLS software that is associated with this patch? (Note: Entering ""No"" here will stop the installation of this patch) Y/N//"
"RTN","FBXIP77E",15,0)
 .D ^DIR K DIR
"RTN","FBXIP77E",16,0)
 .I $D(DTOUT)!$D(DUOUT)!(Y'=1) W !,"Installation of this patch has been stopped!" S XPDQUIT=2 Q
"RTN","FBXIP77E",17,0)
 .W !,"OK to install!"
"RTN","FBXIP77E",18,0)
 Q
"VER")
8.0^22.0
**END**
**END**
