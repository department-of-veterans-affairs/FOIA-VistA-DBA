Released SD*5.3*313 SEQ #290
Extracted from mail message
**KIDS**:SD*5.3*313^

**INSTALL NAME**
SD*5.3*313
"BLD",4412,0)
SD*5.3*313^SCHEDULING^0^3040406^y
"BLD",4412,1,0)
^^1^1^3040406^
"BLD",4412,1,1,0)
Rollup of Additional Encounter Performance Measures to AAC.
"BLD",4412,4,0)
^9.64PA^^
"BLD",4412,"ABPKG")
n
"BLD",4412,"INI")
EN^SD313PRE
"BLD",4412,"INID")
^^y
"BLD",4412,"KRN",0)
^9.67PA^8989.52^19
"BLD",4412,"KRN",.4,0)
.4
"BLD",4412,"KRN",.401,0)
.401
"BLD",4412,"KRN",.402,0)
.402
"BLD",4412,"KRN",.403,0)
.403
"BLD",4412,"KRN",.5,0)
.5
"BLD",4412,"KRN",.84,0)
.84
"BLD",4412,"KRN",3.6,0)
3.6
"BLD",4412,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",4412,"KRN",3.8,0)
3.8
"BLD",4412,"KRN",3.8,"NM",0)
^9.68A^2^2
"BLD",4412,"KRN",3.8,"NM",1,0)
SD ENC PERF MON^^0
"BLD",4412,"KRN",3.8,"NM",2,0)
SD PM NOTIFICATION TIU^^0
"BLD",4412,"KRN",3.8,"NM","B","SD ENC PERF MON",1)

"BLD",4412,"KRN",3.8,"NM","B","SD PM NOTIFICATION TIU",2)

"BLD",4412,"KRN",9.2,0)
9.2
"BLD",4412,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",4412,"KRN",9.8,0)
9.8
"BLD",4412,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4412,"KRN",9.8,"NM",1,0)
SDPMHLA^^0^B9995571
"BLD",4412,"KRN",9.8,"NM",2,0)
SDPMHLS^^0^B32175984
"BLD",4412,"KRN",9.8,"NM",3,0)
SCRPW303^^0^B38067958
"BLD",4412,"KRN",9.8,"NM",4,0)
SD313PRE^^0^B481765
"BLD",4412,"KRN",9.8,"NM","B","SCRPW303",3)

"BLD",4412,"KRN",9.8,"NM","B","SD313PRE",4)

"BLD",4412,"KRN",9.8,"NM","B","SDPMHLA",1)

"BLD",4412,"KRN",9.8,"NM","B","SDPMHLS",2)

"BLD",4412,"KRN",19,0)
19
"BLD",4412,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",4412,"KRN",19,"NM",1,0)
SCRPW APM TASK JOB^^0
"BLD",4412,"KRN",19,"NM",2,0)
SCRPW PM RETRANSMIT REPORT^^0
"BLD",4412,"KRN",19,"NM",3,0)
SCRPW PERFORMANCE MONITOR MENU^^2
"BLD",4412,"KRN",19,"NM","B","SCRPW APM TASK JOB",1)

"BLD",4412,"KRN",19,"NM","B","SCRPW PERFORMANCE MONITOR MENU",3)

"BLD",4412,"KRN",19,"NM","B","SCRPW PM RETRANSMIT REPORT",2)

"BLD",4412,"KRN",19.1,0)
19.1
"BLD",4412,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4412,"KRN",101,0)
101
"BLD",4412,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",4412,"KRN",101,"NM",1,0)
SD ENC PERF MON ORU-R01 CLIENT^^0
"BLD",4412,"KRN",101,"NM",2,0)
SD ENC PERF MON ORU-R01 SERVER^^0
"BLD",4412,"KRN",101,"NM","B","SD ENC PERF MON ORU-R01 CLIENT",1)

"BLD",4412,"KRN",101,"NM","B","SD ENC PERF MON ORU-R01 SERVER",2)

"BLD",4412,"KRN",409.61,0)
409.61
"BLD",4412,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",4412,"KRN",771,0)
771
"BLD",4412,"KRN",771,"NM",0)
^9.68A^2^2
"BLD",4412,"KRN",771,"NM",1,0)
SD ENC PERF MON^^0
"BLD",4412,"KRN",771,"NM",2,0)
AAC^^0
"BLD",4412,"KRN",771,"NM","B","AAC",2)

"BLD",4412,"KRN",771,"NM","B","SD ENC PERF MON",1)

"BLD",4412,"KRN",870,0)
870
"BLD",4412,"KRN",870,"NM",0)
^9.68A^1^1
"BLD",4412,"KRN",870,"NM",1,0)
SDPM^^0
"BLD",4412,"KRN",870,"NM","B","SDPM",1)

"BLD",4412,"KRN",8989.51,0)
8989.51
"BLD",4412,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",4412,"KRN",8989.52,0)
8989.52
"BLD",4412,"KRN",8994,0)
8994
"BLD",4412,"KRN","B",.4,.4)

"BLD",4412,"KRN","B",.401,.401)

"BLD",4412,"KRN","B",.402,.402)

"BLD",4412,"KRN","B",.403,.403)

"BLD",4412,"KRN","B",.5,.5)

"BLD",4412,"KRN","B",.84,.84)

"BLD",4412,"KRN","B",3.6,3.6)

"BLD",4412,"KRN","B",3.8,3.8)

"BLD",4412,"KRN","B",9.2,9.2)

"BLD",4412,"KRN","B",9.8,9.8)

"BLD",4412,"KRN","B",19,19)

"BLD",4412,"KRN","B",19.1,19.1)

"BLD",4412,"KRN","B",101,101)

"BLD",4412,"KRN","B",409.61,409.61)

"BLD",4412,"KRN","B",771,771)

"BLD",4412,"KRN","B",870,870)

"BLD",4412,"KRN","B",8989.51,8989.51)

"BLD",4412,"KRN","B",8989.52,8989.52)

"BLD",4412,"KRN","B",8994,8994)

"BLD",4412,"QUES",0)
^9.62^^
"BLD",4412,"REQB",0)
^9.611^3^2
"BLD",4412,"REQB",1,0)
SD*5.3*292^1
"BLD",4412,"REQB",3,0)
TIU*1.0*168^1
"BLD",4412,"REQB","B","SD*5.3*292",1)

"BLD",4412,"REQB","B","TIU*1.0*168",3)

"INI")
EN^SD313PRE
"KRN",3.8,297,-1)
0^1
"KRN",3.8,297,0)
SD ENC PERF MON^PU^n^^^^
"KRN",3.8,297,2,0)
^3.801^3^3^3030803^^
"KRN",3.8,297,2,1,0)
Mail group used for transmission of Encounter Performance Monitor summary 
"KRN",3.8,297,2,2,0)
data to Austin Automation Center. DO NOT USE THIS MAIL GROUP FOR OTHER 
"KRN",3.8,297,2,3,0)
PURPOSES.
"KRN",3.8,297,3)

"KRN",3.8,297,6,0)
^3.812^1^1
"KRN",3.8,297,6,1,0)
XXX@Q-NPC.MED.VA.GOV
"KRN",3.8,297,6,"B","XXX@Q-NPC.MED.VA.GOV",1)

"KRN",3.8,322,-1)
0^2
"KRN",3.8,322,0)
SD PM NOTIFICATION TIU^PU^n^^^^
"KRN",3.8,322,2,0)
^3.801^8^8^3040325^^^^
"KRN",3.8,322,2,1,0)
This mail group is used to notify local DSS staff of completion for the
"KRN",3.8,322,2,2,0)
extraction and transmission of the Additional Performance Monitor (TIU)
"KRN",3.8,322,2,3,0)
National Rollup to Austin Automation Center (AAC) for National Reporting.
"KRN",3.8,322,2,4,0)
This process is queued to run on the 15th of each month and transmits data
"KRN",3.8,322,2,5,0)
for the previous month starting with the first day and ending with the
"KRN",3.8,322,2,6,0)
last day of the month. The menu option used to run this option is
"KRN",3.8,322,2,7,0)
'Schedule APM Performance Monitor TasK' [SCRPW APM TASK JOB] and it is
"KRN",3.8,322,2,8,0)
scheduled via TASKMAN.
"KRN",3.8,322,3)

"KRN",3.8,322,5,0)
^3.811P
"KRN",3.8,322,6,0)
^3.812^^0
"KRN",19,10898,-1)
2^3
"KRN",19,10898,0)
SCRPW PERFORMANCE MONITOR MENU^Performance Monitor Menu^^M^66476^^^^^^^16
"KRN",19,10898,10,0)
^19.01IP^3^3
"KRN",19,10898,10,3,0)
11207^PMR
"KRN",19,10898,10,3,"^")
SCRPW PM RETRANSMIT REPORT
"KRN",19,10898,"U")
PERFORMANCE MONITOR MENU
"KRN",19,10932,-1)
0^1
"KRN",19,10932,0)
SCRPW APM TASK JOB^Schedule APM Performance Monitor Task^^R^^^^^^^^SCHEDULING
"KRN",19,10932,1,0)
^19.06^4^4^3031022^^^^
"KRN",19,10932,1,1,0)
JOB FOR APM DATA EXTRACT [SCRPW APM TASK JOB], will be scheduled to run on
"KRN",19,10932,1,2,0)
the 15th of each month as a background job through the OPTIONSCHEDULING
"KRN",19,10932,1,3,0)
file. It will collect data for the previous month and it will transmit an
"KRN",19,10932,1,4,0)
HL7 message to AAC. 
"KRN",19,10932,25)
EN^SDPMHLS
"KRN",19,10932,200.9)
y
"KRN",19,10932,"U")
SCHEDULE APM PERFORMANCE MONIT
"KRN",19,11207,-1)
0^2
"KRN",19,11207,0)
SCRPW PM RETRANSMIT REPORT^Performance Monitor Retransmit Report (AAC)^^R^^^^^^^^SCHEDULING
"KRN",19,11207,1,0)
^19.06^4^4^3031216^^
"KRN",19,11207,1,1,0)
This menu option is used for transmitting Performance Monitor (TIU) data
"KRN",19,11207,1,2,0)
to Austin Automation Center in the event that a problem is encountered. In
"KRN",19,11207,1,3,0)
addittion, this option allows to retroactively transmit previous months
"KRN",19,11207,1,4,0)
extracts.
"KRN",19,11207,25)
QUE^SDPMHLS
"KRN",19,11207,"U")
PERFORMANCE MONITOR RETRANSMIT
"KRN",101,3752,-1)
0^2
"KRN",101,3752,0)
SD ENC PERF MON ORU-R01 SERVER^Event Driver for Performance Monitor^^E^^^^^^^^
"KRN",101,3752,1,0)
^^2^2^3040324^
"KRN",101,3752,1,1,0)
HL7 event driver (server) protocol for transmission of Enounter 
"KRN",101,3752,1,2,0)
Performance Monitor summary data to Austin Automation Center.
"KRN",101,3752,99)
59624,39769
"KRN",101,3752,770)
SD ENC PERF MON^^ORU^R01^53^^^NE^AL^2.4^
"KRN",101,3752,772)
D ACKR01^SDPMHLA
"KRN",101,3752,775,0)
^101.0775PA^1^1
"KRN",101,3752,775,1,0)
3753
"KRN",101,3752,775,1,"^")
SD ENC PERF MON ORU-R01 CLIENT
"KRN",101,3753,-1)
0^1
"KRN",101,3753,0)
SD ENC PERF MON ORU-R01 CLIENT^HL7 subscriber (client) protocol^^S^^^^^^^^
"KRN",101,3753,1,0)
^^2^2^3040324^
"KRN",101,3753,1,1,0)
HL7 subscriber (client) protocol for transmission of Encounter 
"KRN",101,3753,1,2,0)
Performance Monitor summary data to Austin Automation Center.
"KRN",101,3753,99)
59624,39769
"KRN",101,3753,770)
^AAC^^R01^^^SDPM^^^^ACK
"KRN",101,3753,771)

"KRN",101,3753,773)
1^1^0
"KRN",771,101,-1)
0^1
"KRN",771,101,0)
SD ENC PERF MON^a^^SD ENC PERF MON^^^US
"KRN",771,101,"EC")
~|\&
"KRN",771,102,-1)
0^2
"KRN",771,102,0)
AAC^a^^^^^US
"KRN",870,200,-1)
0^1
"KRN",870,200,0)
SDPM^^MAILMAN^^^^^^^^^^^^^^^^^^10
"KRN",870,200,100)
SD ENC PERF MON
"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2941102
"PKG",16,22,1,"PAH",1,0)
313^3040406^3507
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^3040406
"PKG",16,22,1,"PAH",1,1,1,0)
Rollup of Additional Encounter Performance Measures to AAC.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SCRPW303")
0^3^B38067958
"RTN","SCRPW303",1,0)
SCRPW303 ; BPFO/JRC - Performance Monitor Report Utils; 30 Jul 2003 ; 4/2/04 7:21am
"RTN","SCRPW303",2,0)
 ;;5.3;SCHEDULING;**292,313**; AUG 13, 1993
"RTN","SCRPW303",3,0)
 ;
"RTN","SCRPW303",4,0)
DSS(SCRNARR) ;Set Stop Codes into screen array (prompt is one/many/all)
"RTN","SCRPW303",5,0)
 ;Input  : SCRNARR - Screen array full global reference
"RTN","SCRPW303",6,0)
 ;Output : 1 = OK     0 = User abort/timeout
"RTN","SCRPW303",7,0)
 ;         @SCRNARR@("DSS") = User pick all stop codes ?
"RTN","SCRPW303",8,0)
 ;           1 = Yes (all)     0 = No
"RTN","SCRPW303",9,0)
 ;         @SCRNARR@("DSS-NTNL") = Only stop codes in national cohort ?
"RTN","SCRPW303",10,0)
 ;           1 = Yes           0 = No
"RTN","SCRPW303",11,0)
 ;         @SCRNARR@("DSS",PtrStopCode) = Stop Code Name
"RTN","SCRPW303",12,0)
 ;         @SCRNARR@("DSS-EXCLUDE",PtrStopCod) = SC Name
"RTN","SCRPW303",13,0)
 ;Note   : @SCRNARR@("DSS") is initialized (KILLed) on input
"RTN","SCRPW303",14,0)
 ;       : @SCRNARR@("DSS",PtrStopCode) is only set when the user
"RTN","SCRPW303",15,0)
 ;         picked individual stop codes (i.e. didn't pick all) OR
"RTN","SCRPW303",16,0)
 ;         when user selected stop codes by range (i.e. 100,102-300)
"RTN","SCRPW303",17,0)
 ;       : @SCRNARR@("DSS-EXCLUDE") is only set if the user picked ALL
"RTN","SCRPW303",18,0)
 ;         stop codes and choose to only use stop codes & credit pairs
"RTN","SCRPW303",19,0)
 ;         from the national cohort
"RTN","SCRPW303",20,0)
 ;       : @SCRNARR@("DSS-EXCLUDE") is set when
"RTN","SCRPW303",21,0)
 ;         @SCRNARR@("DSS-NTNL") equals 1
"RTN","SCRPW303",22,0)
 ;
"RTN","SCRPW303",23,0)
 ;Declare variables
"RTN","SCRPW303",24,0)
 N VAUTSTR,VAUTVB,VAUTNI,DSS,SCANARR,DIC,DIR,Y,X,CODE,ARRY,DIRUT,FLG
"RTN","SCRPW303",25,0)
 K @SCRNARR@("DSS")
"RTN","SCRPW303",26,0)
 ;Prompt user wether to use range for stop code selection or not
"RTN","SCRPW303",27,0)
 S DIR(0)="Y",DIR("B")="No",FLG=0
"RTN","SCRPW303",28,0)
 S DIR("A")="Would you like to select the Stop Codes by range "
"RTN","SCRPW303",29,0)
 D ^DIR
"RTN","SCRPW303",30,0)
 I $D(DIRUT)!$D(DTOUT) Q FLG
"RTN","SCRPW303",31,0)
 I Y D RANGE(SCRNARR) Q FLG
"RTN","SCRPW303",32,0)
 ;Get stop code selection using VAUTOMA
"RTN","SCRPW303",33,0)
 I '$D(@SCRNARR@("DSS"))
"RTN","SCRPW303",34,0)
 S DIC="^DIC(40.7,"
"RTN","SCRPW303",35,0)
 S VAUTSTR="Stop Code"
"RTN","SCRPW303",36,0)
 S VAUTVB="SCANARR"
"RTN","SCRPW303",37,0)
 S VAUTNI=2
"RTN","SCRPW303",38,0)
 D FIRST^VAUTOMA
"RTN","SCRPW303",39,0)
 I Y<0 Q 0
"RTN","SCRPW303",40,0)
 ;Does selection of ALL mean all stop codes in national cohort
"RTN","SCRPW303",41,0)
 I $G(SCANARR)=1 D
"RTN","SCRPW303",42,0)
 .N DIR,X,Y,DIRUT,DIROUT,DTOUT,DUOUT
"RTN","SCRPW303",43,0)
 .S DIR(0)="Y"
"RTN","SCRPW303",44,0)
 .S DIR("B")="YES"
"RTN","SCRPW303",45,0)
 .S DIR("A",1)="By ALL do you mean stop codes from the"
"RTN","SCRPW303",46,0)
 .S DIR("A")="Performance Monitor national cohort "
"RTN","SCRPW303",47,0)
 .D ^DIR
"RTN","SCRPW303",48,0)
 .I $D(DIRUT) K SCANARR Q
"RTN","SCRPW303",49,0)
 .I Y D NTNLESC(SCRNARR)
"RTN","SCRPW303",50,0)
 .Q
"RTN","SCRPW303",51,0)
 I '$D(SCANARR) Q 0
"RTN","SCRPW303",52,0)
 I $D(@SCRNARR@("DSS")) Q 1
"RTN","SCRPW303",53,0)
 S @SCRNARR@("DSS-NTNL")=0
"RTN","SCRPW303",54,0)
 M @SCRNARR@("DSS")=SCANARR
"RTN","SCRPW303",55,0)
 Q 1
"RTN","SCRPW303",56,0)
 ;
"RTN","SCRPW303",57,0)
SORT(SORTARR) ; Set sort order into sort array
"RTN","SCRPW303",58,0)
 ;Input  : SORTARR - Sort array full global reference
"RTN","SCRPW303",59,0)
 ;Output : 1 = OK     0 = User abort/timeout
"RTN","SCRPW303",60,0)
 ;         @SORTARR = Sort1Code^Sort2Code
"RTN","SCRPW303",61,0)
 ;           Codes: 1 = Division   2 = Clinic
"RTN","SCRPW303",62,0)
 ;                  3 = Provider   4 = Stop Code
"RTN","SCRPW303",63,0)
 ;                  5 = Date       6 = Patient
"RTN","SCRPW303",64,0)
 ;         @SORTARR@("TEXT") = Sort1Text^Sort2Text
"RTN","SCRPW303",65,0)
 ;Note   : @SORTARR is initialized (KILLed) on input
"RTN","SCRPW303",66,0)
 ;
"RTN","SCRPW303",67,0)
 ;Declare variables
"RTN","SCRPW303",68,0)
 N DIR,X,Y,DIRUT,DIROUT,DTOUT,DUOUT
"RTN","SCRPW303",69,0)
 K @SORTARR
"RTN","SCRPW303",70,0)
 ;Get sort level 1
"RTN","SCRPW303",71,0)
 S DIR(0)="SC^1:DIVISION;2:CLINIC;3:PROVIDER;4:STOP CODE;5:DATE;6:PATIENT"
"RTN","SCRPW303",72,0)
 S DIR("A")="Select primary sorting criteria"
"RTN","SCRPW303",73,0)
 D ^DIR
"RTN","SCRPW303",74,0)
 I $D(DIRUT) Q 0
"RTN","SCRPW303",75,0)
 S @SORTARR=Y
"RTN","SCRPW303",76,0)
 S @SORTARR@("TEXT")=$$SRT2TXT(Y)
"RTN","SCRPW303",77,0)
 ;Get sort level 2
"RTN","SCRPW303",78,0)
 K DIR,X,Y
"RTN","SCRPW303",79,0)
 S DIR(0)="SC^1:DIVISION;2:CLINIC;3:PROVIDER;4:STOP CODE;5:DATE;6:PATIENT"
"RTN","SCRPW303",80,0)
 S DIR("A")="Within "_@SORTARR@("TEXT")_" sort by"
"RTN","SCRPW303",81,0)
 S DIR("S")="I Y'="_@SORTARR
"RTN","SCRPW303",82,0)
 D ^DIR
"RTN","SCRPW303",83,0)
 I $D(DIRUT) K @SORTARR Q 0
"RTN","SCRPW303",84,0)
 S @SORTARR=@SORTARR_"^"_Y
"RTN","SCRPW303",85,0)
 S @SORTARR@("TEXT")=@SORTARR@("TEXT")_"^"_$$SRT2TXT(Y)
"RTN","SCRPW303",86,0)
 Q 1
"RTN","SCRPW303",87,0)
SRT2TXT(CODE)   ;Convert sort code to sort text
"RTN","SCRPW303",88,0)
 ;Input  : CODE - Sort code
"RTN","SCRPW303",89,0)
 ;Output : Text for sort code
"RTN","SCRPW303",90,0)
 ;
"RTN","SCRPW303",91,0)
 I CODE=1 Q "division"
"RTN","SCRPW303",92,0)
 I CODE=2 Q "clinic"
"RTN","SCRPW303",93,0)
 I CODE=3 Q "provider"
"RTN","SCRPW303",94,0)
 I CODE=4 Q "stop code"
"RTN","SCRPW303",95,0)
 I CODE=5 Q "date"
"RTN","SCRPW303",96,0)
 I CODE=6 Q "patient"
"RTN","SCRPW303",97,0)
 Q ""
"RTN","SCRPW303",98,0)
 ;
"RTN","SCRPW303",99,0)
ROLLUP(SCRNARR,SORTARR) ;Set screen and sort arrays for national rollup
"RTN","SCRPW303",100,0)
 ;Input  : SCRNARR - Screening array
"RTN","SCRPW303",101,0)
 ;         SORTARR - Sort array full global reference
"RTN","SCRPW303",102,0)
 ;Output : None
"RTN","SCRPW303",103,0)
 ;         Nodes in @SCRNARR are set to denote the following:
"RTN","SCRPW303",104,0)
 ;           Time limit of 10
"RTN","SCRPW303",105,0)
 ;           Include all divisions
"RTN","SCRPW303",106,0)
 ;           Use excluded stop codes from national cohort array
"RTN","SCRPW303",107,0)
 ;           Count encounters with scanned progress notes
"RTN","SCRPW303",108,0)
 ;         Nodes in @SORTARR are set to denote the following:
"RTN","SCRPW303",109,0)
 ;           Primary sort is division
"RTN","SCRPW303",110,0)
 ;           Secondary sort is date
"RTN","SCRPW303",111,0)
 ;Note   : @SCRNARR and @SORTARR are initialized (KILLed) on input
"RTN","SCRPW303",112,0)
 ;
"RTN","SCRPW303",113,0)
 K @SCRNARR,@SORTARR
"RTN","SCRPW303",114,0)
 S @SCRNARR@("TLMT")=10
"RTN","SCRPW303",115,0)
 S @SCRNARR@("DIVISION")=1
"RTN","SCRPW303",116,0)
 S @SCRNARR@("PROVIDERS")=1
"RTN","SCRPW303",117,0)
 D NTNLESC(SCRNARR)
"RTN","SCRPW303",118,0)
 S @SCRNARR@("SCANNED")=1
"RTN","SCRPW303",119,0)
 S @SORTARR="1^5"
"RTN","SCRPW303",120,0)
 S @SORTARR@("TEXT")="division^date"
"RTN","SCRPW303",121,0)
 Q
"RTN","SCRPW303",122,0)
 ;
"RTN","SCRPW303",123,0)
NTNLSC(SCRNARR) ;Set inclusion array of stop codes for national reporting
"RTN","SCRPW303",124,0)
 ;Input  : SCRNARR - Screening array
"RTN","SCRPW303",125,0)
 ;Output : National list of acceptable stop code & credit pairs
"RTN","SCRPW303",126,0)
 ;         @SCRNARR@("DSS") = 0
"RTN","SCRPW303",127,0)
 ;         @SCRNARR@("DSS-NTNL") = 1
"RTN","SCRPW303",128,0)
 ;         @SCRNARR@("DSS",PtrStopCode) = Stop Code Name
"RTN","SCRPW303",129,0)
 ;         @SCRNARR@("DSS-PAIR",PtrStopCode,PtrStopCode) = SC Name ^ SC Name
"RTN","SCRPW303",130,0)
 ;
"RTN","SCRPW303",131,0)
 N OFF,TEXT,J,CODE,PTR1,TMP,PTR2
"RTN","SCRPW303",132,0)
 S @SCRNARR@("DSS")=0
"RTN","SCRPW303",133,0)
 S @SCRNARR@("DSS-NTNL")=1
"RTN","SCRPW303",134,0)
 F OFF=1:1 S TEXT=$P($T(STOP+OFF),";;",2) Q:TEXT="END"  D
"RTN","SCRPW303",135,0)
 .F J=1:1:$L(TEXT,"^") S CODE=$P(TEXT,"^",J) D
"RTN","SCRPW303",136,0)
 ..S TMP=$L(CODE) Q:((TMP'=3)&(TMP'=6))
"RTN","SCRPW303",137,0)
 ..I TMP=3 D  Q
"RTN","SCRPW303",138,0)
 ...;Individual stop code
"RTN","SCRPW303",139,0)
 ...S PTR1=$$SC2PTR(CODE) Q:'PTR1
"RTN","SCRPW303",140,0)
 ...S @SCRNARR@("DSS",+PTR1)=$P(PTR1,"^",2)
"RTN","SCRPW303",141,0)
 ..;Credit pair
"RTN","SCRPW303",142,0)
 ..S PTR1=$$SC2PTR($E(CODE,1,3)) Q:'PTR1
"RTN","SCRPW303",143,0)
 ..S PTR2=$$SC2PTR($E(CODE,4,6)) Q:'PTR2
"RTN","SCRPW303",144,0)
 ..S @SCRNARR@("DSS-PAIR",+PTR1,+PTR2)=$P(PTR1,"^",2)_"^"_$P(PTR2,"^",2)
"RTN","SCRPW303",145,0)
 Q
"RTN","SCRPW303",146,0)
NTNLESC(SCRNARR) ;Set exclusion array of stop codes for national reporting
"RTN","SCRPW303",147,0)
 ;Input  : SCRNARR - Screening array
"RTN","SCRPW303",148,0)
 ;Output : National list of stop codes to be excluded
"RTN","SCRPW303",149,0)
 ;         @SCRNARR@("DSS") = 0
"RTN","SCRPW303",150,0)
 ;         @SCRNARR@("DSS-NTNL") = 1
"RTN","SCRPW303",151,0)
 ;         @SCRNARR@("DSS-EXCLUDE",PtrStopCode) = Stop Code Name
"RTN","SCRPW303",152,0)
 ;
"RTN","SCRPW303",153,0)
 N OFF,TEXT,J,CODE,PTR1,TMP,PTR2
"RTN","SCRPW303",154,0)
 S @SCRNARR@("DSS")=0
"RTN","SCRPW303",155,0)
 S @SCRNARR@("DSS-NTNL")=1
"RTN","SCRPW303",156,0)
 F OFF=1:1 S TEXT=$P($T(EXCSTOP+OFF),";;",2) Q:TEXT="END"  D
"RTN","SCRPW303",157,0)
 .F J=1:1:$L(TEXT,"^") S CODE=$P(TEXT,"^",J) D
"RTN","SCRPW303",158,0)
 ..S TMP=$L(CODE) Q:((TMP'=3)&(TMP'=6))
"RTN","SCRPW303",159,0)
 ..I TMP=3 D  Q
"RTN","SCRPW303",160,0)
 ...;Individual stop code for exclusion
"RTN","SCRPW303",161,0)
 ...S PTR1=$$SC2PTR(CODE) Q:'PTR1
"RTN","SCRPW303",162,0)
 ...S @SCRNARR@("DSS-EXCLUDE",+PTR1)=$P(PTR1,"^",2)
"RTN","SCRPW303",163,0)
 Q
"RTN","SCRPW303",164,0)
RANGE(SCRNARR) ;Screen array by range
"RTN","SCRPW303",165,0)
 N DIR,DIRUT,DTOUT,Y,SUB,NODE,CODE,PTR1,J
"RTN","SCRPW303",166,0)
 S @SCRNARR@("DSS")=0
"RTN","SCRPW303",167,0)
 S @SCRNARR@("DSS",1)=""
"RTN","SCRPW303",168,0)
 S @SCRNARR@("DSS-NTNL")=0
"RTN","SCRPW303",169,0)
 S DIR("A")="Select individual Stop Code or a range of Codes "
"RTN","SCRPW303",170,0)
 S DIR("?")="This response must be a list or range, e.g., 100,302 or 200-450,800 "
"RTN","SCRPW303",171,0)
 S DIR(0)="L"
"RTN","SCRPW303",172,0)
 D ^DIR
"RTN","SCRPW303",173,0)
 I $D(DIRUT)!$D(DTOUT) Q
"RTN","SCRPW303",174,0)
 I Y D
"RTN","SCRPW303",175,0)
 .S FLG=1
"RTN","SCRPW303",176,0)
 .S SUB="" F  S SUB=$O(Y(SUB)) Q:SUB=""  D
"RTN","SCRPW303",177,0)
 ..S NODE=(Y(SUB))
"RTN","SCRPW303",178,0)
 ..F J=1:1:$L(NODE,",") S CODE=$P(NODE,",",J) I CODE D
"RTN","SCRPW303",179,0)
 ...S PTR1=$$SC2PTR(CODE) Q:'PTR1
"RTN","SCRPW303",180,0)
 ...S @SCRNARR@("DSS",+PTR1)=$P(PTR1,"^",2)
"RTN","SCRPW303",181,0)
 Q
"RTN","SCRPW303",182,0)
SC2PTR(CODE)    ;Get pointer to stop code
"RTN","SCRPW303",183,0)
 ;Input  : CODE - Stop code
"RTN","SCRPW303",184,0)
 ;Output : Pointer #40.7 ^ Name (#.01)
"RTN","SCRPW303",185,0)
 ;
"RTN","SCRPW303",186,0)
 N NODE,PTR
"RTN","SCRPW303",187,0)
 S PTR=+$O(^DIC(40.7,"C",CODE,0)) I 'PTR Q "0^INVALID STOP CODE"
"RTN","SCRPW303",188,0)
 S NODE=$G(^DIC(40.7,PTR,0))
"RTN","SCRPW303",189,0)
 Q PTR_"^"_$P(NODE,"^",1)
"RTN","SCRPW303",190,0)
 ;
"RTN","SCRPW303",191,0)
STOP ;List of acceptable stop codes and credit pairs
"RTN","SCRPW303",192,0)
 ;;END
"RTN","SCRPW303",193,0)
 ;
"RTN","SCRPW303",194,0)
EXCSTOP ;Exclusion list of stop codes
"RTN","SCRPW303",195,0)
 ;;104^105^106^107^108^109^115^116^117^120^126^127^128^144^145
"RTN","SCRPW303",196,0)
 ;;146^149^150^151^152^153^154^155^165^166^167^168^169^174^190
"RTN","SCRPW303",197,0)
 ;;202^205^206^207^208^212^213^214^290^291^292^293^294^295^296
"RTN","SCRPW303",198,0)
 ;;321^327^328^329^333^334^370^417^421^422^423^429^430^431^435
"RTN","SCRPW303",199,0)
 ;;450^451^452^453^454^455^456^458^459^460^461^462^463^464^465
"RTN","SCRPW303",200,0)
 ;;466^467^468^469^470^471^472^473^474^475^476^477^478^479^481
"RTN","SCRPW303",201,0)
 ;;482^483^484^485^505^506^510^513^516^519^521^522^523^525^535
"RTN","SCRPW303",202,0)
 ;;538^545^547^550^553^554^557^558^559^560^561^563^564^565^566
"RTN","SCRPW303",203,0)
 ;;573^574^575^577^578^590^602^603^604^606^607^608^610^650^651
"RTN","SCRPW303",204,0)
 ;;652^653^654^655^656^657^660^670^680^681^682^691^701^702^703
"RTN","SCRPW303",205,0)
 ;;704^705^706^707^708^709^710^711^725^730^731^900^999
"RTN","SCRPW303",206,0)
 ;;END
"RTN","SCRPW303",207,0)
 ;
"RTN","SD313PRE")
0^4^B481765
"RTN","SD313PRE",1,0)
SD313PRE ; BPFO/JRC - Performance Monitor Pre Install ; 3/30/04 9:19am
"RTN","SD313PRE",2,0)
 ;;5.3;SCHEDULING;**313**;AUG 13, 1993
"RTN","SD313PRE",3,0)
EN ;Main entry point
"RTN","SD313PRE",4,0)
 ;Set variables
"RTN","SD313PRE",5,0)
 N DOM
"RTN","SD313PRE",6,0)
 ;Check domain file for entry
"RTN","SD313PRE",7,0)
 S DOM=$$FIND1^DIC(4.2,"","MX","Q-NPC.MED.VA.GOV","","","ERR")
"RTN","SD313PRE",8,0)
 I 'DOM D
"RTN","SD313PRE",9,0)
 .D BMES^XPDUTL("Domain 'Q-NPC.MED.VA.GOV' was not found ")
"RTN","SD313PRE",10,0)
 .D BMES^XPDUTL("You must install patch XM*999*157")
"RTN","SD313PRE",11,0)
 .S XPDABORT=1
"RTN","SD313PRE",12,0)
 Q
"RTN","SDPMHLA")
0^1^B9995571
"RTN","SDPMHLA",1,0)
SDPMHLA ; BPFO/JRC - HL 7 ACKNOWLEDGEMENT HANDLER ; 3/30/04 11:20am
"RTN","SDPMHLA",2,0)
 ;;5.3;SCHEDULING;**313**;AUG 13, 1993
"RTN","SDPMHLA",3,0)
 ;
"RTN","SDPMHLA",4,0)
 ;====================================================================
"RTN","SDPMHLA",5,0)
 ;Additional Performance Monitors process acknowledgement routine
"RTN","SDPMHLA",6,0)
 ;
"RTN","SDPMHLA",7,0)
 ;This routine takes and enhanced mode acknowledgement message
"RTN","SDPMHLA",8,0)
 ;from Austin passes it to HL7 and it matches it to the originating
"RTN","SDPMHLA",9,0)
 ;message from the information contained in the message ID.
"RTN","SDPMHLA",10,0)
 ;
"RTN","SDPMHLA",11,0)
 ;Input
"RTN","SDPMHLA",12,0)
 ;       Acknowledgment message from AAC
"RTN","SDPMHLA",13,0)
 ;Output
"RTN","SDPMHLA",14,0)
 ;       Bulletin to 'SD PM NOTIFICATION TIU' when a rejection message
"RTN","SDPMHLA",15,0)
 ;       is found
"RTN","SDPMHLA",16,0)
 ;====================================================================
"RTN","SDPMHLA",17,0)
ACKR01 ; Receives the ACK messages
"RTN","SDPMHLA",18,0)
 ; Input : All variables set by the HL7 package
"RTN","SDPMHLA",19,0)
 N SDACK,SDPARAM,HLNODE,I,X
"RTN","SDPMHLA",20,0)
 ;Get message text
"RTN","SDPMHLA",21,0)
 S ^TMP("SDPRUACK",$H)="START PROCESS"
"RTN","SDPMHLA",22,0)
 F I=1:1 X HLNEXT Q:(HLQUIT'>0)  D
"RTN","SDPMHLA",23,0)
 . S SDMSG(I,1)=HLNODE
"RTN","SDPMHLA",24,0)
 . ; Check for segment length greater than 245
"RTN","SDPMHLA",25,0)
 . S X=0 F  S X=+$O(HLNODE(X)) Q:('X)  S SDMSG(I,(X+1))=HLNODE(X)
"RTN","SDPMHLA",26,0)
 ;
"RTN","SDPMHLA",27,0)
 M ^TMP("SDPRUACK",$H,"HL")=SDMSG
"RTN","SDPMHLA",28,0)
 ; Analyze the message and take appropriate response
"RTN","SDPMHLA",29,0)
 ; Quit if there is no valid message header
"RTN","SDPMHLA",30,0)
 Q:$P(SDMSG(1,1),"^")'="MSH"
"RTN","SDPMHLA",31,0)
 ;
"RTN","SDPMHLA",32,0)
 S X=1,SDPARAM=""
"RTN","SDPMHLA",33,0)
 F  S X=+$O(SDMSG(X)) Q:('X)  D
"RTN","SDPMHLA",34,0)
 . I $P(SDMSG(X,1),"^")="MSA" D
"RTN","SDPMHLA",35,0)
 .. D PROCESS(SDMSG(X,1),.SDPARAM)
"RTN","SDPMHLA",36,0)
 Q
"RTN","SDPMHLA",37,0)
 ;
"RTN","SDPMHLA",38,0)
NOTIFY ; Task sending of response notification
"RTN","SDPMHLA",39,0)
 Q:$O(SDPARAM(""))=""
"RTN","SDPMHLA",40,0)
 D SENDIT
"RTN","SDPMHLA",41,0)
 Q
"RTN","SDPMHLA",42,0)
SENDIT ; Notify mail group that a error message was received
"RTN","SDPMHLA",43,0)
 ; Input : MSGARY() - Array containing HL7 Message received
"RTN","SDPMHLA",44,0)
 ; Ouput : None
"RTN","SDPMHLA",45,0)
 N MSGTXT,XMY,XMTEXT,XMDUZ,XMDT,XMZ,LINE,XMB,XMCHAN,XMSUB
"RTN","SDPMHLA",46,0)
 ;
"RTN","SDPMHLA",47,0)
 S MSGTEXT(1)=" "
"RTN","SDPMHLA",48,0)
 S MSGTEXT(2)="TIU's Performance Indicator National Rollup encountered an error while"
"RTN","SDPMHLA",49,0)
 S MSGTEXT(3)="processing HL7 message '"_MSGID_"'. If necessary, use option 'Performance"
"RTN","SDPMHLA",50,0)
 S MSGTEXT(4)="Monitor Retransmit Report (AAC)' to retransmit it."
"RTN","SDPMHLA",51,0)
 S MSGTEXT(5)=" "
"RTN","SDPMHLA",52,0)
 S MSGTEXT(6)="Encounter date range: "_$$FMTE^XLFDT(STADATE,1)_" to "_$$FMTE^XLFDT(ENDDATE,1)
"RTN","SDPMHLA",53,0)
 S MSGTEXT(7)=" "
"RTN","SDPMHLA",54,0)
 S MSGTEXT(8)="Please contact Austin Automation Center's help desk."
"RTN","SDPMHLA",55,0)
 S XMSUB="SD ENC PERF MON Error Message"
"RTN","SDPMHLA",56,0)
 S XMTEXT="MSGTEXT("
"RTN","SDPMHLA",57,0)
 S XMY("G.SD PM NOTIFICATION TIU")=""
"RTN","SDPMHLA",58,0)
 S XMCHAN=1
"RTN","SDPMHLA",59,0)
 S XMDUZ="Performance Indicator"
"RTN","SDPMHLA",60,0)
 ;S XMB="SDPM REJECT"
"RTN","SDPMHLA",61,0)
 S XMDT=DT
"RTN","SDPMHLA",62,0)
 D ^XMD
"RTN","SDPMHLA",63,0)
 Q
"RTN","SDPMHLA",64,0)
 ;
"RTN","SDPMHLA",65,0)
PROCESS(SDMSG,SDPARAM) ;Process incoming acknowledgment
"RTN","SDPMHLA",66,0)
 ;
"RTN","SDPMHLA",67,0)
 N ACK,MSGID,PMSG,MNODE,STADATE,ENDDATE
"RTN","SDPMHLA",68,0)
 ;
"RTN","SDPMHLA",69,0)
 Q:$G(SDMSG)']""
"RTN","SDPMHLA",70,0)
 ;
"RTN","SDPMHLA",71,0)
 S ACK=$P(SDMSG,HL("FS"),2)   ; Get acknowledgment code
"RTN","SDPMHLA",72,0)
 ; If the acknowledgementcode is AA, then do not send notification
"RTN","SDPMHLA",73,0)
 Q:ACK="AA"
"RTN","SDPMHLA",74,0)
 ; Get outgoing message ID
"RTN","SDPMHLA",75,0)
 S MSGID=$P(SDMSG,HL("FS"),3)
"RTN","SDPMHLA",76,0)
 S MSGID=$E(MSGID,4,$L(MSGID))
"RTN","SDPMHLA",77,0)
 ; Set rejection message for SDPM acknowledgement message
"RTN","SDPMHLA",78,0)
 S:'(ACK="AA") SDPARAM(4)=$S(ACK="AE":"Application Error",ACK="AR":"Application Reject",1:"Unknown Error")
"RTN","SDPMHLA",79,0)
 ; Retrieve HL7 parent message ID
"RTN","SDPMHLA",80,0)
 S PMSG=$P($G(^HL(772,MSGID,0)),HL("FS"),8) ;IA # 4069
"RTN","SDPMHLA",81,0)
 ; Retrieve HL7 message 'OBR' node
"RTN","SDPMHLA",82,0)
 S MNODE=^HL(772,MSGID,"IN",1,0) ;IA # 4069
"RTN","SDPMHLA",83,0)
 ; Retrieve date range
"RTN","SDPMHLA",84,0)
 S RANGE=$P($G(^HL(772,MSGID,"IN",1,0)),HL("FS"),28) ;IA # 4069
"RTN","SDPMHLA",85,0)
 S STADATE=$P($G(RANGE),"~",4),ENDDATE=$P($G(RANGE),"~",5)
"RTN","SDPMHLA",86,0)
 ; Convert date from HL7 to FM format
"RTN","SDPMHLA",87,0)
 S STADATE=$$HL7TFM^XLFDT(STADATE),ENDDATE=$$HL7TFM^XLFDT(ENDDATE)
"RTN","SDPMHLA",88,0)
 D NOTIFY
"RTN","SDPMHLA",89,0)
 Q
"RTN","SDPMHLS")
0^2^B32175984
"RTN","SDPMHLS",1,0)
SDPMHLS ;BPFO/JRC -Build ROU-R01 HL7 message for 'SD ENC PERF MON' application ; 4/2/04 7:12am
"RTN","SDPMHLS",2,0)
 ;;5.3;Scheduling;**313**;AUG 13, 1993
"RTN","SDPMHLS",3,0)
 ;
"RTN","SDPMHLS",4,0)
QUE ;Queue retroactive XMIT job
"RTN","SDPMHLS",5,0)
 ;Declare variables
"RTN","SDPMHLS",6,0)
 S (STDT,EDT,Y,X)=""
"RTN","SDPMHLS",7,0)
 ;Prompt user for month and year
"RTN","SDPMHLS",8,0)
 S %DT("A")="Please select MONTH and YEAR for TIU's National Rollup to transmit: "
"RTN","SDPMHLS",9,0)
 S %DT="AEM"
"RTN","SDPMHLS",10,0)
 ;Set %DT not to allow current and future months
"RTN","SDPMHLS",11,0)
 S %DT(0)=-($$FMADD^XLFDT($$NOW^XLFDT(),-32))
"RTN","SDPMHLS",12,0)
 D ^%DT
"RTN","SDPMHLS",13,0)
 ;Check date input if (-1) quit else continue
"RTN","SDPMHLS",14,0)
 I Y<0 Q
"RTN","SDPMHLS",15,0)
 ;Set STDT = user selected month and year and add 1 day
"RTN","SDPMHLS",16,0)
 S STDT=Y+01
"RTN","SDPMHLS",17,0)
 ;Add 32 days to STDT
"RTN","SDPMHLS",18,0)
 S X=$$FMADD^XLFDT(STDT,32)
"RTN","SDPMHLS",19,0)
 ;Subtract number of days that overlap into the following month
"RTN","SDPMHLS",20,0)
 S EDT=$$FMADD^XLFDT(X,-($E(X,6,7)))
"RTN","SDPMHLS",21,0)
 ;Set task variables
"RTN","SDPMHLS",22,0)
 S ZTIO=""
"RTN","SDPMHLS",23,0)
 S ZTDESC="Performance Indicator National Rollup"
"RTN","SDPMHLS",24,0)
 S ZTRTN="EN^SDPMHLS"
"RTN","SDPMHLS",25,0)
 S ZTSAVE("STDT")=""
"RTN","SDPMHLS",26,0)
 S ZTSAVE("EDT")=""
"RTN","SDPMHLS",27,0)
 D ^%ZTLOAD W:$D(ZTSK) "   (Task: ",ZTSK,")"
"RTN","SDPMHLS",28,0)
 K STDT,EDT,X,Y
"RTN","SDPMHLS",29,0)
 Q
"RTN","SDPMHLS",30,0)
EN ;Entry point
"RTN","SDPMHLS",31,0)
 ;Note: Retroactive reports use variables STDT and EDT to pass dates
"RTN","SDPMHLS",32,0)
 ;   STDT - start date, first day of the month for selected month
"RTN","SDPMHLS",33,0)
 ;   EDT - ending date, last day of the month for selected month
"RTN","SDPMHLS",34,0)
 ;Declare variables
"RTN","SDPMHLS",35,0)
 N STDATE,ENDDATE
"RTN","SDPMHLS",36,0)
 N XMTARRY,SCRNARR,SORTARR,OUTARR,X,RDATE
"RTN","SDPMHLS",37,0)
 S SCRNARR="^TMP(""SCRPW"",$J,""SCRNARR"")"
"RTN","SDPMHLS",38,0)
 S SORTARR="^TMP(""SCRPW"",$J,""SORTARR"")"
"RTN","SDPMHLS",39,0)
 S OUTARR="^TMP(""SCRPW"",$J,""OUTARR"")"
"RTN","SDPMHLS",40,0)
 S XMTARRY="^TMP(""HLS"","_$J_")"
"RTN","SDPMHLS",41,0)
 S (STDATE,ENDDATE)=""
"RTN","SDPMHLS",42,0)
 ;Set national screen/sort
"RTN","SDPMHLS",43,0)
 D ROLLUP^SCRPW303(SCRNARR,SORTARR)
"RTN","SDPMHLS",44,0)
 ;Call module to build scratch global
"RTN","SDPMHLS",45,0)
 D GETINFO
"RTN","SDPMHLS",46,0)
 ;Build HL7 Message
"RTN","SDPMHLS",47,0)
 D BLDMSG(OUTARR,XMTARRY)
"RTN","SDPMHLS",48,0)
 ;Send HL7 Message
"RTN","SDPMHLS",49,0)
 I +$O(@XMTARRY@(""))>0 D
"RTN","SDPMHLS",50,0)
 .S J=$$SENDMSG(.XMTARRY)
"RTN","SDPMHLS",51,0)
 ;Send XMIT notifications
"RTN","SDPMHLS",52,0)
 D MSG
"RTN","SDPMHLS",53,0)
 ;Cleanup an quit
"RTN","SDPMHLS",54,0)
 D EXIT
"RTN","SDPMHLS",55,0)
 Q
"RTN","SDPMHLS",56,0)
BLDMSG(OUTARR,XMTARRY) ;Build OBR segment
"RTN","SDPMHLS",57,0)
 ;Input : OUTARR - Ouptut array 
"RTN","SDPMHLS",58,0)
 ;Output: XMTARRY - HL7 temporary array
"RTN","SDPMHLS",59,0)
 ;Declare variables
"RTN","SDPMHLS",60,0)
 N HL,HLFS,HLECH,HLQ,SNODE,PNODE,DIVHL,TYPE,COUNT
"RTN","SDPMHLS",61,0)
 D INIT^HLFNC2("SD ENC PERF MON ORU-R01 SERVER",.HL)
"RTN","SDPMHLS",62,0)
 Q:$O(HL(""))=""
"RTN","SDPMHLS",63,0)
 N VAFEVN,VAFSTR,CNT,MAKE,VAFOBR,VAFOBX,I,XCNT,INFO,DIV,DIVHL
"RTN","SDPMHLS",64,0)
 S CNT=1,XCNT=0
"RTN","SDPMHLS",65,0)
 S MAKE(1)="1"
"RTN","SDPMHLS",66,0)
 S MAKE(4,1,1)="01"
"RTN","SDPMHLS",67,0)
 S MAKE(4,1,2)="VA ENC PERF MONITOR"
"RTN","SDPMHLS",68,0)
 S MAKE(7)=$$HLDATE^HLFNC(RDATE)
"RTN","SDPMHLS",69,0)
 S MAKE(25)="F"
"RTN","SDPMHLS",70,0)
 S MAKE(27,1,4)=$$HLDATE^HLFNC(STDATE,"DT")
"RTN","SDPMHLS",71,0)
 S MAKE(27,1,5)=$$HLDATE^HLFNC(ENDDATE,"DT")
"RTN","SDPMHLS",72,0)
 K VAFOBR
"RTN","SDPMHLS",73,0)
 D MAKEIT^VAFHLU("OBR",.MAKE,.VAFOBR,.VAFOBR)
"RTN","SDPMHLS",74,0)
 M @XMTARRY@(CNT)=VAFOBR
"RTN","SDPMHLS",75,0)
 S XCNT=XCNT+1,CNT=CNT+1
"RTN","SDPMHLS",76,0)
 ;Build OBX segment for facility
"RTN","SDPMHLS",77,0)
 S SNODE=$G(@OUTARR@("SUMMARY"))
"RTN","SDPMHLS",78,0)
 S PNODE=$G(@OUTARR@("SUMMARY","PI"))
"RTN","SDPMHLS",79,0)
 S DIVHL=$P($$SITE^VASITE,"^",3)
"RTN","SDPMHLS",80,0)
 D MAKEOBX
"RTN","SDPMHLS",81,0)
 ;Build OBX segment for division(s)
"RTN","SDPMHLS",82,0)
 S DIV="" F  S DIV=$O(@OUTARR@("SUBTOTAL",DIV)) Q:DIV=""  D
"RTN","SDPMHLS",83,0)
 .N SNODE,PNODE
"RTN","SDPMHLS",84,0)
 .S SNODE=$G(@OUTARR@("SUBTOTAL",DIV))
"RTN","SDPMHLS",85,0)
 .S PNODE=$G(@OUTARR@("SUBTOTAL",DIV,"PI"))
"RTN","SDPMHLS",86,0)
 .S DIVHL=$P(DIV,"^",2)
"RTN","SDPMHLS",87,0)
 .D MAKEOBX
"RTN","SDPMHLS",88,0)
 .Q
"RTN","SDPMHLS",89,0)
 Q
"RTN","SDPMHLS",90,0)
MAKEOBX ;Set type and count for total encounters to bld OBX
"RTN","SDPMHLS",91,0)
 ;Input : SNODE - Temporary counter node for summary
"RTN","SDPMHLS",92,0)
 ;        PNODE - Temporary counter node for PI
"RTN","SDPMHLS",93,0)
 ;        DIVHL - Division and Suffix
"RTN","SDPMHLS",94,0)
 ;        CNT - Temporary array subscript count
"RTN","SDPMHLS",95,0)
 ;        XCNT  - OBX segment counter
"RTN","SDPMHLS",96,0)
 ;        XMTARRY - Temporary HL array ^TMP("HLS",$J)
"RTN","SDPMHLS",97,0)
 S TYPE="CD",COUNT=$P($G(SNODE),U,1),OBID=1 D BLDOBX
"RTN","SDPMHLS",98,0)
 ;Set type and count for counters for ET in days F0 - F10 to bld OBX
"RTN","SDPMHLS",99,0)
 F M4=0:1:10 D
"RTN","SDPMHLS",100,0)
 .S OBID=2
"RTN","SDPMHLS",101,0)
 .S TYPE="F"_M4
"RTN","SDPMHLS",102,0)
 .S COUNT=$P($G(PNODE),U,(M4+1))
"RTN","SDPMHLS",103,0)
 .D BLDOBX
"RTN","SDPMHLS",104,0)
 ;Set type and count for scanned notes and Uniques to bld OBX
"RTN","SDPMHLS",105,0)
 S TYPE="FSPN",OBID=2,COUNT=$P($G(SNODE),U,7) D BLDOBX
"RTN","SDPMHLS",106,0)
 S TYPE="FEP",OBID=2,COUNT=$P($G(SNODE),U,4) D BLDOBX
"RTN","SDPMHLS",107,0)
 S TYPE="FDSS",OBID=2,COUNT=$P($G(SNODE),U,5) D BLDOBX
"RTN","SDPMHLS",108,0)
 Q
"RTN","SDPMHLS",109,0)
BLDOBX ;Build OBX
"RTN","SDPMHLS",110,0)
 ;Ouput : @XMTARRY = Temporary HL array
"RTN","SDPMHLS",111,0)
 ;Set variables
"RTN","SDPMHLS",112,0)
 N MAKE,VAFOBX
"RTN","SDPMHLS",113,0)
 S MAKE(1)=XCNT
"RTN","SDPMHLS",114,0)
 S MAKE(2)="NM"
"RTN","SDPMHLS",115,0)
 S MAKE(3,1,1)=OBID
"RTN","SDPMHLS",116,0)
 S MAKE(3,1,4)=TYPE
"RTN","SDPMHLS",117,0)
 S MAKE(5)=COUNT
"RTN","SDPMHLS",118,0)
 S MAKE(11)="F"
"RTN","SDPMHLS",119,0)
 S MAKE(15)=DIVHL
"RTN","SDPMHLS",120,0)
 K VAFOBX
"RTN","SDPMHLS",121,0)
 D MAKEIT^VAFHLU("OBX",.MAKE,.VAFOBX,.VAFOBX)
"RTN","SDPMHLS",122,0)
 M @XMTARRY@(CNT)=VAFOBX
"RTN","SDPMHLS",123,0)
 S XCNT=XCNT+1,CNT=CNT+1
"RTN","SDPMHLS",124,0)
 Q
"RTN","SDPMHLS",125,0)
SENDMSG(XMTARRY) ;Send HL7 message
"RTN","SDPMHLS",126,0)
 ;Input - @XMTARRY
"RTN","SDPMHLS",127,0)
 ;Output - ARRY4HL7
"RTN","SDPMHLS",128,0)
 N ARRY4HL7,KILLARRY,HL,HLRESLT,HLFS,HLECH,HLQ,HLP
"RTN","SDPMHLS",129,0)
 S XMTARRY=$G(XMTARRY)
"RTN","SDPMHLS",130,0)
 S:'(XMTARRY]"") XMTARRY="^TMP(""HLS"","_$J_")"
"RTN","SDPMHLS",131,0)
 Q:($O(@XMTARRY@(""))="") "-1^Can not send empty message"
"RTN","SDPMHLS",132,0)
 S ARRY4HL7="TMP(""HLS"","_$J_")"
"RTN","SDPMHLS",133,0)
 ;Initialize HL7 variables
"RTN","SDPMHLS",134,0)
 D INIT^HLFNC2("SD ENC PERF MON ORU-R01 SERVER",.HL)
"RTN","SDPMHLS",135,0)
 Q:($O(HL(""))="") "-1^Unable to initialize HL7 variables"
"RTN","SDPMHLS",136,0)
 ;Check if XMTARRY is ^TMP("HLS",$J)
"RTN","SDPMHLS",137,0)
 S KILLARRY=0
"RTN","SDPMHLS",138,0)
 I $NA(@XMTARRY)'=$NA(@ARRY4HL7) D
"RTN","SDPMHLS",139,0)
 .K @ARRY4HL7
"RTN","SDPMHLS",140,0)
 .M @ARRY4HL7=@XMTARRY
"RTN","SDPMHLS",141,0)
 .S KILLARRY=1
"RTN","SDPMHLS",142,0)
 ;Broadcast message
"RTN","SDPMHLS",143,0)
 D GENERATE^HLMA("SD ENC PERF MON ORU-R01 SERVER","GM",1,.HLRESLT,"",.HLP)
"RTN","SDPMHLS",144,0)
 S:('HLRESLT) HLRESLT=$P(HLRESLT,"^",2,3)
"RTN","SDPMHLS",145,0)
 ;Delete ^TMP("HLS",$J) if XMTARRY was different
"RTN","SDPMHLS",146,0)
 K:(KILLARRY) @ARRY4HL7
"RTN","SDPMHLS",147,0)
 Q $G(HLRESLT)
"RTN","SDPMHLS",148,0)
GETINFO ;Get performance monitor data
"RTN","SDPMHLS",149,0)
 ;Input:
"RTN","SDPMHLS",150,0)
 ;    @SCRNARR - Screen array full global reference
"RTN","SDPMHLS",151,0)
 ;    @SORTARR - Sort array full global reference
"RTN","SDPMHLS",152,0)
 ;Output:
"RTN","SDPMHLS",153,0)
 ;    @OUTARR - Ouput array full global reference 
"RTN","SDPMHLS",154,0)
 ;Remember starting time
"RTN","SDPMHLS",155,0)
 S RDATE=$$NOW^XLFDT()
"RTN","SDPMHLS",156,0)
 ;Check STDT and EDT, if 1 set STDATE and ENDDATE
"RTN","SDPMHLS",157,0)
 I $D(STDT)&$D(EDT) S STDATE=STDT,ENDDATE=EDT
"RTN","SDPMHLS",158,0)
 I STDATE="" D
"RTN","SDPMHLS",159,0)
 .;Set start date = 1st day of previous month
"RTN","SDPMHLS",160,0)
 .S STDATE=$E(RDATE,1,3)_$E(RDATE,4,5)-1_"01"
"RTN","SDPMHLS",161,0)
 .;Set end date = start date + 32 minus number of days into next month
"RTN","SDPMHLS",162,0)
 .S X=$$FMADD^XLFDT(STDATE,32)
"RTN","SDPMHLS",163,0)
 .S ENDDATE=$$FMADD^XLFDT(X,-($E(X,6,7)))
"RTN","SDPMHLS",164,0)
 .Q
"RTN","SDPMHLS",165,0)
 ;Set date range in screen array
"RTN","SDPMHLS",166,0)
 S @SCRNARR@("RANGE")=STDATE_"^"_ENDDATE
"RTN","SDPMHLS",167,0)
 ;Get data
"RTN","SDPMHLS",168,0)
 D GETDATA^SDPMUT1(SCRNARR,SORTARR,OUTARR)
"RTN","SDPMHLS",169,0)
 Q
"RTN","SDPMHLS",170,0)
MSG ;Build bulletin and send
"RTN","SDPMHLS",171,0)
 ;Input:
"RTN","SDPMHLS",172,0)
 ;     RDATE - report starting time
"RTN","SDPMHLS",173,0)
 ;Output: 
"RTN","SDPMHLS",174,0)
 ;   Notificaion bulletin to SD ENC PERF MON mail group
"RTN","SDPMHLS",175,0)
 N MSGTEXT,XMTEXT,XMSUB,XMY,XMCHAN,XMZ,XMDUZ
"RTN","SDPMHLS",176,0)
 S MSGTEXT(1)=" "
"RTN","SDPMHLS",177,0)
 S MSGTEXT(2)="Performance Indicator National Rollup was started on "_$$FMTE^XLFDT(RDATE,1)
"RTN","SDPMHLS",178,0)
 S MSGTEXT(3)="Encounter date range: "_$$FMTE^XLFDT(STDATE,1)_" to "_$$FMTE^XLFDT(ENDDATE,1)
"RTN","SDPMHLS",179,0)
 S MSGTEXT(3)="Extraction of data and sending of data completed "_$$FMTE^XLFDT($$NOW^XLFDT(),1)
"RTN","SDPMHLS",180,0)
 S MSGTEXT(4)=" "
"RTN","SDPMHLS",181,0)
 ;Send completion bulletin to current user
"RTN","SDPMHLS",182,0)
 S XMSUB="Performance Indicator National Rollup"
"RTN","SDPMHLS",183,0)
 S XMTEXT="MSGTEXT("
"RTN","SDPMHLS",184,0)
 S XMY("G.SD PM NOTIFICATION TIU")=""
"RTN","SDPMHLS",185,0)
 S XMCHAN=1
"RTN","SDPMHLS",186,0)
 S XMDUZ="Performance Indicator"
"RTN","SDPMHLS",187,0)
 D ^XMD
"RTN","SDPMHLS",188,0)
 Q
"RTN","SDPMHLS",189,0)
EXIT ;Done
"RTN","SDPMHLS",190,0)
 K @SCRNARR,@SORTARR,@OUTARR,@XMTARRY
"RTN","SDPMHLS",191,0)
 Q
"VER")
8.0^22.0
**END**
**END**
