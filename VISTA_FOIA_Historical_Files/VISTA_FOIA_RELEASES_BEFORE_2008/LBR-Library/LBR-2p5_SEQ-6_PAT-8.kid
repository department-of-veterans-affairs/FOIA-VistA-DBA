Released LBR*2.5*8 SEQ #6
Extracted from mail message
**KIDS**:LBR*2.5*8^

**INSTALL NAME**
LBR*2.5*8
"BLD",2596,0)
LBR*2.5*8^LIBRARY^0^3010416^y
"BLD",2596,1,0)
^^6^6^3010326^
"BLD",2596,1,1,0)
Patch LBR*2.5*8 will replace the need for the VA Integration Team to 
"BLD",2596,1,2,0)
RE-install patch LBR*2.5*3 to integrate Library databases.  After 
"BLD",2596,1,3,0)
LBR*2.5*8 installation, Integration Team will be able to run the 
"BLD",2596,1,4,0)
installation from the new assigned menu options.  Patch 8 is for use at 
"BLD",2596,1,5,0)
multi-divisional sites.  For stations not integrating data, Patch 8 
"BLD",2596,1,6,0)
installation should only take a short time. 
"BLD",2596,4,0)
^9.64PA^682.1^1
"BLD",2596,4,682.1,0)
682.1
"BLD",2596,4,682.1,2,0)
^9.641^682.1^1
"BLD",2596,4,682.1,2,682.1,0)
LIBRARY TRANSACTIONS  (File-top level)
"BLD",2596,4,682.1,2,682.1,1,0)
^9.6411^33^1
"BLD",2596,4,682.1,2,682.1,1,33,0)
DATE/TIME CREATED
"BLD",2596,4,682.1,222)
y^n^p^^^^n
"BLD",2596,4,"APDD",682.1,682.1)

"BLD",2596,4,"APDD",682.1,682.1,33)

"BLD",2596,4,"B",682.1,682.1)

"BLD",2596,"ABPKG")
n
"BLD",2596,"INI")

"BLD",2596,"INIT")
POST^LBR258P
"BLD",2596,"KRN",0)
^9.67PA^19^18
"BLD",2596,"KRN",.4,0)
.4
"BLD",2596,"KRN",.4,"NM",0)
^9.68A^^
"BLD",2596,"KRN",.401,0)
.401
"BLD",2596,"KRN",.402,0)
.402
"BLD",2596,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",2596,"KRN",.402,"NM",1,0)
LBRYLTF    FILE #682.1^682.1^0
"BLD",2596,"KRN",.402,"NM",2,0)
LBRYREC    FILE #682.1^682.1^0
"BLD",2596,"KRN",.402,"NM","B","LBRYLTF    FILE #682.1",1)

"BLD",2596,"KRN",.402,"NM","B","LBRYREC    FILE #682.1",2)

"BLD",2596,"KRN",.403,0)
.403
"BLD",2596,"KRN",.5,0)
.5
"BLD",2596,"KRN",.84,0)
.84
"BLD",2596,"KRN",3.6,0)
3.6
"BLD",2596,"KRN",3.8,0)
3.8
"BLD",2596,"KRN",9.2,0)
9.2
"BLD",2596,"KRN",9.8,0)
9.8
"BLD",2596,"KRN",9.8,"NM",0)
^9.68A^38^16
"BLD",2596,"KRN",9.8,"NM",4,0)
LBRVCON1^^0^B2611033
"BLD",2596,"KRN",9.8,"NM",5,0)
LBRVCON2^^0^B13414315
"BLD",2596,"KRN",9.8,"NM",6,0)
LBRVCON3^^0^B11017202
"BLD",2596,"KRN",9.8,"NM",7,0)
LBRVCON9^^0^B3237470
"BLD",2596,"KRN",9.8,"NM",8,0)
LBRVCOND^^0^B28481821
"BLD",2596,"KRN",9.8,"NM",10,0)
LBRVCONP^^0^B10811860
"BLD",2596,"KRN",9.8,"NM",11,0)
LBRVCONS^^0^B25695189
"BLD",2596,"KRN",9.8,"NM",12,0)
LBRVCONV^^0^B5732048
"BLD",2596,"KRN",9.8,"NM",20,0)
LBRVCONX^^0^B5860705
"BLD",2596,"KRN",9.8,"NM",21,0)
LBRPUTL^^0^B4409267
"BLD",2596,"KRN",9.8,"NM",28,0)
LBRYSEND^^0^B4548180
"BLD",2596,"KRN",9.8,"NM",29,0)
LBRYLTF^^0^B3635836
"BLD",2596,"KRN",9.8,"NM",31,0)
LBRYRTX^^0^B12359855
"BLD",2596,"KRN",9.8,"NM",32,0)
LBR258P^^0^B4476345
"BLD",2596,"KRN",9.8,"NM",37,0)
LBRYSRV1^^0^B3804827
"BLD",2596,"KRN",9.8,"NM",38,0)
LBRYPRCS^^0^B10586120
"BLD",2596,"KRN",9.8,"NM","B","LBR258P",32)

"BLD",2596,"KRN",9.8,"NM","B","LBRPUTL",21)

"BLD",2596,"KRN",9.8,"NM","B","LBRVCON1",4)

"BLD",2596,"KRN",9.8,"NM","B","LBRVCON2",5)

"BLD",2596,"KRN",9.8,"NM","B","LBRVCON3",6)

"BLD",2596,"KRN",9.8,"NM","B","LBRVCON9",7)

"BLD",2596,"KRN",9.8,"NM","B","LBRVCOND",8)

"BLD",2596,"KRN",9.8,"NM","B","LBRVCONP",10)

"BLD",2596,"KRN",9.8,"NM","B","LBRVCONS",11)

"BLD",2596,"KRN",9.8,"NM","B","LBRVCONV",12)

"BLD",2596,"KRN",9.8,"NM","B","LBRVCONX",20)

"BLD",2596,"KRN",9.8,"NM","B","LBRYLTF",29)

"BLD",2596,"KRN",9.8,"NM","B","LBRYPRCS",38)

"BLD",2596,"KRN",9.8,"NM","B","LBRYRTX",31)

"BLD",2596,"KRN",9.8,"NM","B","LBRYSEND",28)

"BLD",2596,"KRN",9.8,"NM","B","LBRYSRV1",37)

"BLD",2596,"KRN",19,0)
19
"BLD",2596,"KRN",19,"NM",0)
^9.68A^4^3
"BLD",2596,"KRN",19,"NM",1)
^^^
"BLD",2596,"KRN",19,"NM",1,0)
LBRY INT INTEGRATE DATA^^0
"BLD",2596,"KRN",19,"NM",2)
^^^
"BLD",2596,"KRN",19,"NM",2,0)
LBRY INT PREPARE DATA^^0
"BLD",2596,"KRN",19,"NM",4,0)
LBRY MANAGER^^3
"BLD",2596,"KRN",19,"NM","B","LBRY INT INTEGRATE DATA",1)

"BLD",2596,"KRN",19,"NM","B","LBRY INT PREPARE DATA",2)

"BLD",2596,"KRN",19,"NM","B","LBRY MANAGER",4)

"BLD",2596,"KRN",19.1,0)
19.1
"BLD",2596,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",2596,"KRN",19.1,"NM",1,0)
LBRYIRM^^0
"BLD",2596,"KRN",19.1,"NM","B","LBRYIRM",1)

"BLD",2596,"KRN",101,0)
101
"BLD",2596,"KRN",101,"NM",0)
^9.68A^^
"BLD",2596,"KRN",409.61,0)
409.61
"BLD",2596,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",2596,"KRN",771,0)
771
"BLD",2596,"KRN",771,"NM",0)
^9.68A^^
"BLD",2596,"KRN",869.2,0)
869.2
"BLD",2596,"KRN",870,0)
870
"BLD",2596,"KRN",8994,0)
8994
"BLD",2596,"KRN","B",.4,.4)

"BLD",2596,"KRN","B",.401,.401)

"BLD",2596,"KRN","B",.402,.402)

"BLD",2596,"KRN","B",.403,.403)

"BLD",2596,"KRN","B",.5,.5)

"BLD",2596,"KRN","B",.84,.84)

"BLD",2596,"KRN","B",3.6,3.6)

"BLD",2596,"KRN","B",3.8,3.8)

"BLD",2596,"KRN","B",9.2,9.2)

"BLD",2596,"KRN","B",9.8,9.8)

"BLD",2596,"KRN","B",19,19)

"BLD",2596,"KRN","B",19.1,19.1)

"BLD",2596,"KRN","B",101,101)

"BLD",2596,"KRN","B",409.61,409.61)

"BLD",2596,"KRN","B",771,771)

"BLD",2596,"KRN","B",869.2,869.2)

"BLD",2596,"KRN","B",870,870)

"BLD",2596,"KRN","B",8994,8994)

"BLD",2596,"PRE")
LBR258P
"BLD",2596,"QUES",0)
^9.62^^
"BLD",2596,"REQB",0)
^9.611^3^3
"BLD",2596,"REQB",1,0)
LBR*2.5*2^1
"BLD",2596,"REQB",2,0)
LBR*2.5*6^1
"BLD",2596,"REQB",3,0)
LBR*2.5*3^1
"BLD",2596,"REQB","B","LBR*2.5*2",1)

"BLD",2596,"REQB","B","LBR*2.5*3",3)

"BLD",2596,"REQB","B","LBR*2.5*6",2)

"FIA",682.1)
LIBRARY TRANSACTIONS
"FIA",682.1,0)
^LBRY(682.1,
"FIA",682.1,0,0)
682.1
"FIA",682.1,0,1)
y^n^p^^^^n
"FIA",682.1,0,10)

"FIA",682.1,0,11)

"FIA",682.1,0,"RLRO")

"FIA",682.1,0,"VR")
2.5^LBR
"FIA",682.1,682.1)
1
"FIA",682.1,682.1,33)

"INIT")
POST^LBR258P
"KRN",.402,2147,-1)
0^1
"KRN",.402,2147,0)
LBRYLTF^3000104.1321^^682.1^^^3010129
"KRN",.402,2147,"DR",1,682.1)
1///^S X=$G(LBRTYP);2///^S X="W";33///^S X=$$NOW^XLFDT();
"KRN",.402,2148,-1)
0^2
"KRN",.402,2148,0)
LBRYREC^3000104.1308^^682.1^^^3000104
"KRN",.402,2148,"DR",1,682.1)
1///^S X=TYP;2///^S X="R";33///^S X=$$NOW^XLFDT();
"KRN",19,7481,-1)
3^4
"KRN",19,7481,0)
LBRY MANAGER^Library Management^^M^^^^^^^^LIBRARY^^1^1
"KRN",19,7481,1,0)
^^1^1^3000314^^^^
"KRN",19,7481,1,1,0)
Assign to the Library Chief--access to all available Library options.
"KRN",19,7481,10,0)
^19.01PI^7^7
"KRN",19,7481,10,6,0)
10282
"KRN",19,7481,10,6,"^")
LBRY INT INTEGRATE DATA
"KRN",19,7481,10,7,0)
10283
"KRN",19,7481,10,7,"^")
LBRY INT PREPARE DATA
"KRN",19,7481,15)
K LBRYCLS,LBRYPTR
"KRN",19,7481,20)
W @IOF I '$D(LBRYPTR) D ^LBRYASK W @IOF
"KRN",19,7481,99)
58525,44987
"KRN",19,7481,99.1)
57798,54087
"KRN",19,7481,"U")
LIBRARY MANAGEMENT
"KRN",19,10282,-1)
0^1
"KRN",19,10282,0)
LBRY INT INTEGRATE DATA^Integrate Library Data^^R^^LBRYIRM^^^^^^LIBRARY
"KRN",19,10282,1,0)
^^1^1^3000508^
"KRN",19,10282,1,1,0)
This option will integrate a site's data from a legacy site to a primary site.
"KRN",19,10282,25)
LBRVCONS
"KRN",19,10282,"U")
INTEGRATE LIBRARY DATA
"KRN",19,10283,-1)
0^2
"KRN",19,10283,0)
LBRY INT PREPARE DATA^Prepare Library Data^^R^^LBRYIRM^^^^^^LIBRARY
"KRN",19,10283,1,0)
^^2^2^3000508^^
"KRN",19,10283,1,1,0)
This option will prepare a site's data for transportation to another
"KRN",19,10283,1,2,0)
Primary site for integration.
"KRN",19,10283,25)
LBRVCONV
"KRN",19,10283,"U")
PREPARE LIBRARY DATA
"KRN",19.1,374,-1)
0^1
"KRN",19.1,374,0)
LBRYIRM^SYSTEM MGMT AUTHORIZATION
"KRN",19.1,374,1,0)
^^2^2^3000508^^
"KRN",19.1,374,1,1,0)
This security key should be associated with options that are system
"KRN",19.1,374,1,2,0)
oriented and could affect Library databases as a whole.
"MBREQ")
0
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",476,-1)
1^1
"PKG",476,0)
LIBRARY^LBRY^LIBRARY SERIALS PACKAGE^LBRY MANAGEMENT
"PKG",476,20,0)
^9.402P^^
"PKG",476,22,0)
^9.49I^1^1
"PKG",476,22,1,0)
2.5
"PKG",476,22,1,"PAH",1,0)
8^3010416^100884
"PKG",476,22,1,"PAH",1,1,0)
^^6^6^3010416
"PKG",476,22,1,"PAH",1,1,1,0)
Patch LBR*2.5*8 will replace the need for the VA Integration Team to 
"PKG",476,22,1,"PAH",1,1,2,0)
RE-install patch LBR*2.5*3 to integrate Library databases.  After 
"PKG",476,22,1,"PAH",1,1,3,0)
LBR*2.5*8 installation, Integration Team will be able to run the 
"PKG",476,22,1,"PAH",1,1,4,0)
installation from the new assigned menu options.  Patch 8 is for use at 
"PKG",476,22,1,"PAH",1,1,5,0)
multi-divisional sites.  For stations not integrating data, Patch 8 
"PKG",476,22,1,"PAH",1,1,6,0)
installation should only take a short time. 
"PRE")
LBR258P
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
16
"RTN","LBR258P")
0^32^B4476345
"RTN","LBR258P",1,0)
LBR258P ;ALB/MRY - Env/Pre/Post-install of consolidation ;[ 02/08/01 08:21 AM]
"RTN","LBR258P",2,0)
 ;;2.5;Library;**8**;Mar 11, 1996
"RTN","LBR258P",3,0)
 ;
"RTN","LBR258P",4,0)
EN ; Environment check
"RTN","LBR258P",5,0)
 ;
"RTN","LBR258P",6,0)
 I '$G(DUZ)!($G(DUZ(0))'["@") W !,"USER 'DUZ' VARIABLES **NOT** CORRECTLY DEFINED.  CONFIRM THAT DUZ(0)='@'.  THEN D ^XUP." S XPDQUIT=1 Q
"RTN","LBR258P",7,0)
 ;
"RTN","LBR258P",8,0)
 I $$VERSION^XPDUTL("LBRY")<2.5 S QUIT=0 D  G ABRT:QUIT
"RTN","LBR258P",9,0)
 . I $$VERSION^XPDUTL("LBR")>2 Q
"RTN","LBR258P",10,0)
 . W !!,"VERSION 2.5 OF LIBRARY HAS NOT BEEN LOADED",! S QUIT=1
"RTN","LBR258P",11,0)
 D BMES^XPDUTL(">> Environment check complete and okay.")
"RTN","LBR258P",12,0)
 ;
"RTN","LBR258P",13,0)
 K QUIT Q
"RTN","LBR258P",14,0)
 ;
"RTN","LBR258P",15,0)
POST ; Post-install 
"RTN","LBR258P",16,0)
 ; Beta sites who installed a previous version of LBR*8. Otherwise, quit.
"RTN","LBR258P",17,0)
 ;
"RTN","LBR258P",18,0)
 D BMES^XPDUTL(">> Running Post-install...")
"RTN","LBR258P",19,0)
 D MES^XPDUTL("     ...Cleaning up version numbers.")
"RTN","LBR258P",20,0)
 ;
"RTN","LBR258P",21,0)
 ; Clean up version number
"RTN","LBR258P",22,0)
 S N=679.9999 F  S N=$O(^DD(N)) Q:N>689.4  I $$GET1^DID(N,"","","VERSION")?1"2.5"1A.N S ^DD(N,0,"VR")=2.5
"RTN","LBR258P",23,0)
 ;
"RTN","LBR258P",24,0)
 G POST2 ; After V7
"RTN","LBR258P",25,0)
 ;
"RTN","LBR258P",26,0)
 ; Delete fields (#40/#41 of File #682.1) previously install from
"RTN","LBR258P",27,0)
 ; patch *8 in beta sites.  These fields are not used.
"RTN","LBR258P",28,0)
 ;
"RTN","LBR258P",29,0)
 ; Quit if a field isn't found at site.
"RTN","LBR258P",30,0)
 I $$GET1^DID(682.1,41,"","LABEL")="" G POST2
"RTN","LBR258P",31,0)
 D MES^XPDUTL("     ...Removing from File (#682.1) fields #40, #41 and its data.")
"RTN","LBR258P",32,0)
 ;
"RTN","LBR258P",33,0)
 ; Delete data
"RTN","LBR258P",34,0)
 N LBRN
"RTN","LBR258P",35,0)
 S LBRN=0
"RTN","LBR258P",36,0)
 F  S LBRN=$O(^LBRY(682.1,LBRN)) Q:'LBRN  D
"RTN","LBR258P",37,0)
 . S DIE="^LBRY(682.1,",DA=LBRN,DR="40///@" D ^DIE
"RTN","LBR258P",38,0)
 . ; If data exists for field #41 (12th node), then delete.
"RTN","LBR258P",39,0)
 . I $D(^LBRY(682.1,DA,12,0)) D
"RTN","LBR258P",40,0)
 . . S DIE="^LBRY(682.1,",DA=LBRN,DR="41///@" D ^DIE
"RTN","LBR258P",41,0)
 K DIE,DA,DR
"RTN","LBR258P",42,0)
 ;
"RTN","LBR258P",43,0)
 ; Remove DD fields
"RTN","LBR258P",44,0)
 S DIK="^DD(682.1,",DA=40,DA(1)=682.1 D ^DIK
"RTN","LBR258P",45,0)
 S DIK="^DD(682.1,",DA=41,DA(1)=682.1 D ^DIK
"RTN","LBR258P",46,0)
 K DIK,DA
"RTN","LBR258P",47,0)
 ;
"RTN","LBR258P",48,0)
POST2 D BMES^XPDUTL(">> Post-install complete.")
"RTN","LBR258P",49,0)
 G EXIT
"RTN","LBR258P",50,0)
ABRT S XPDQUIT=1 Q
"RTN","LBR258P",51,0)
EXIT K QUIT,LBRN D CLEAN^DILF
"RTN","LBR258P",52,0)
 Q
"RTN","LBRPUTL")
0^21^B4409267
"RTN","LBRPUTL",1,0)
LBRPUTL ;SFISC/JSR- LBR UTIL2;04/08/99  15:12 [ 05/12/2000  4:31 PM ]
"RTN","LBRPUTL",2,0)
 ;;2.5;Library;**8**;Mar 11, 2000
"RTN","LBRPUTL",3,0)
 Q
"RTN","LBRPUTL",4,0)
NEWCP(XPD,XPDC,XPDP) ;create new check point, returns 0=error or ien
"RTN","LBRPUTL",5,0)
 ;XPD=name, XPDC=call back, XPDP=parameters
"RTN","LBRPUTL",6,0)
 Q:$G(XPD)="" 0
"RTN","LBRPUTL",7,0)
 N %,XPDI,XPDJ,XPDF,XPDY
"RTN","LBRPUTL",8,0)
 ;XPDCP="INI"=Pre-init, "INIT"=Post-init
"RTN","LBRPUTL",9,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713)
"RTN","LBRPUTL",10,0)
 S %=$$FIND1^DIC(XPDI,","_XPDA_",","X",XPD) Q:% %
"RTN","LBRPUTL",11,0)
 S XPDF="+1,"_XPDA_",",XPDJ(XPDI,XPDF,.01)=XPD
"RTN","LBRPUTL",12,0)
 S:$D(XPDC) XPDJ(XPDI,XPDF,2)=XPDC
"RTN","LBRPUTL",13,0)
 S:$D(XPDP) XPDJ(XPDI,XPDF,3)=XPDP
"RTN","LBRPUTL",14,0)
 D UPDATE^DIE("","XPDJ","XPDY")
"RTN","LBRPUTL",15,0)
 Q $G(XPDY(1))
"RTN","LBRPUTL",16,0)
 ;
"RTN","LBRPUTL",17,0)
UPCP(XPD,XPDP) ;update check point, returns 0=error or ien
"RTN","LBRPUTL",18,0)
 ;XPD=name, XPDP=parameters
"RTN","LBRPUTL",19,0)
 N XPDI,XPDJ,XPDF,XPDY
"RTN","LBRPUTL",20,0)
 ;XPDCP="INI"=Pre-init, "INIT"=Post-init
"RTN","LBRPUTL",21,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713),XPDY=$$DICCP($G(XPD))
"RTN","LBRPUTL",22,0)
 Q:'XPDY 0
"RTN","LBRPUTL",23,0)
 S XPDF=XPDY_","_XPDA_","
"RTN","LBRPUTL",24,0)
 S:$D(XPDP) XPDJ(XPDI,XPDF,3)=XPDP
"RTN","LBRPUTL",25,0)
 D FILE^DIE("","XPDJ")
"RTN","LBRPUTL",26,0)
 Q XPDY
"RTN","LBRPUTL",27,0)
 ;
"RTN","LBRPUTL",28,0)
COMCP(XPD) ;complete check point, returns 0=error or date/time
"RTN","LBRPUTL",29,0)
 ;XPD=name
"RTN","LBRPUTL",30,0)
 N XPDD,XPDI,XPDJ,XPDY
"RTN","LBRPUTL",31,0)
 S XPDD=$$NOW^XLFDT()
"RTN","LBRPUTL",32,0)
 S $P(^XTMP("LBRY",LBRVSTA,XPD),"^",2)=XPDD
"RTN","LBRPUTL",33,0)
 Q XPDD
"RTN","LBRPUTL",34,0)
 ;
"RTN","LBRPUTL",35,0)
VERCP(XPD) ;verify check point, returns 1=completed, 0=not
"RTN","LBRPUTL",36,0)
 ;-1=doesn't exist
"RTN","LBRPUTL",37,0)
 ;XPD=name
"RTN","LBRPUTL",38,0)
 N XPDI,XPDY
"RTN","LBRPUTL",39,0)
 S XPDI=$S(XPDCP="INIT":9.716,1:9.713),XPDY=$$DICCP($G(XPD))
"RTN","LBRPUTL",40,0)
 Q:'XPDY -1
"RTN","LBRPUTL",41,0)
 Q ''$$GET1^DIQ(XPDI,XPDY_","_XPDA_",",1,"I")
"RTN","LBRPUTL",42,0)
 ;
"RTN","LBRPUTL",43,0)
PARCP(XPD,XPDF) ;returns parameters of check point
"RTN","LBRPUTL",44,0)
 ;
"RTN","LBRPUTL",45,0)
 ;  Quit with the data value to set into the variable
"RTN","LBRPUTL",46,0)
 Q $P($G(^XTMP("LBRY",LBRVSTA,XPDF)),"^",1)
"RTN","LBRPUTL",47,0)
 ;
"RTN","LBRPUTL",48,0)
CURCP(XPDF) ;returns current check point
"RTN","LBRPUTL",49,0)
 ;XPDF flag - 0=externel, 1=internal
"RTN","LBRPUTL",50,0)
 Q $S($G(XPDF):XPDCHECK,1:XPDCHECK(0))
"RTN","LBRPUTL",51,0)
 ;
"RTN","LBRPUTL",52,0)
DICCP(X) ;lookup check point, returns ien or 0
"RTN","LBRPUTL",53,0)
 Q:$G(X)="" 0
"RTN","LBRPUTL",54,0)
 ;if they pass ien, fail if can't find
"RTN","LBRPUTL",55,0)
 I X=+X S Y=X Q:'$D(^JSR(9.7,XPDA,XPDCP,Y,0)) 0
"RTN","LBRPUTL",56,0)
 E  S Y=$$FIND1^DIC(XPDI,","_XPDA_",","X",X)
"RTN","LBRPUTL",57,0)
 Q Y
"RTN","LBRPUTL",58,0)
MES(X)  ;record message, X=message or an array passed by reference
"RTN","LBRPUTL",59,0)
        N %
"RTN","LBRPUTL",60,0)
        I $D(X)#2 S %=X K X S X(1)=%
"RTN","LBRPUTL",61,0)
        ;write message
"RTN","LBRPUTL",62,0)
        F %=1:1 Q:'$D(X(%))  W !,X(%)
"RTN","LBRPUTL",63,0)
        Q:'$G(XPDA)  D WP^DIE(9.7,XPDA_",",20,"A","X")
"RTN","LBRPUTL",64,0)
        Q
"RTN","LBRPUTL",65,0)
BMES(X) ;add blank line before message
"RTN","LBRPUTL",66,0)
        N %
"RTN","LBRPUTL",67,0)
        I $D(X)#2 S %=X K X S X(1)=" ",X(2)=%
"RTN","LBRPUTL",68,0)
        D MES(.X)
"RTN","LBRPUTL",69,0)
        Q
"RTN","LBRPUTL",70,0)
 ;
"RTN","LBRVCON1")
0^4^B2611033
"RTN","LBRVCON1",1,0)
LBRVCON1 ;SSI/ALA/JSR-Consolidate library files continued ;[ 04/20/2000  8:35 AM ]
"RTN","LBRVCON1",2,0)
 ;;2.5;Library;**3,8**;APR 19, 2000
"RTN","LBRVCON1",3,0)
INF ;  Inform FORUM when integration is completed for VA library sites
"RTN","LBRVCON1",4,0)
 S CODE="" F I=1:1 S CODE=$O(^LBRY(680.6,"C",CODE)) Q:CODE=""  D
"RTN","LBRVCON1",5,0)
 . S MES(I)="Library Station "_$G(CODE)_" has been integrated." Q
"RTN","LBRVCON1",6,0)
 S MES(I+1)="Please update associated DOMAINs."
"RTN","LBRVCON1",7,0)
 S TRNSM=$S($G(^XMB("NETNAME"))["SENTIENT":"BBB.SENTIENT.ISC-WASH.VA.GOV",1:"FORUM.VA.GOV")
"RTN","LBRVCON1",8,0)
 S XMDUZ=DUZ,XMSUB="LIBRARY PATCH 8 LOADED",XMY("G.LBRYRECV@"_TRNSM)=""
"RTN","LBRVCON1",9,0)
 S XMTEXT="MES("
"RTN","LBRVCON1",10,0)
 D ^XMD K XMSUB,XMY,XMTEXT,MSG,XMZ,XMDUZ,MES,TRNSM
"RTN","LBRVCON1",11,0)
EXIT D MES^LBRPUTL("I am now re-indexing all cross-references/Patch 8")
"RTN","LBRVCON1",12,0)
 D REINDX
"RTN","LBRVCON1",13,0)
 Q
"RTN","LBRVCON1",14,0)
REINDX ; reindex crossreferences
"RTN","LBRVCON1",15,0)
 W !
"RTN","LBRVCON1",16,0)
 F J=680,681,682,680.4,680.7,680.3,680.5 S LX="A" F  S LX=$O(^LBRY(J,LX)) Q:LX=""  K ^LBRY(J,LX)
"RTN","LBRVCON1",17,0)
 F DIK="^LBRY(680,","^LBRY(681,","^LBRY(682,","^LBRY(680.4,","^LBRY(680.7,","^LBRY(680.3,","^LBRY(680.5," D
"RTN","LBRVCON1",18,0)
 . W DIK,! D IXALL^DIK
"RTN","LBRVCON1",19,0)
 D MES^LBRPUTL("Patch 8 The integration has completed successfully.")
"RTN","LBRVCON1",20,0)
 Q
"RTN","LBRVCON2")
0^5^B13414315
"RTN","LBRVCON2",1,0)
LBRVCON2 ;SSI/ALA/JSR-Consolidate files continued ;[ 07/06/2000  3:41 PM ]
"RTN","LBRVCON2",2,0)
 ;;2.5;Library;**3,8**;APR 19, 1996
"RTN","LBRVCON2",3,0)
EN ;  Continue with update
"RTN","LBRVCON2",4,0)
 I $P(^LBRY(680.6,0),U,4)=1 Q
"RTN","LBRVCON2",5,0)
 I '$D(^XTMP("LBRY",LBRVSTA,"ODA4","DONE")) D STP4 S ^XTMP("LBRY",LBRVSTA,"ODA4","DONE")=""
"RTN","LBRVCON2",6,0)
 S DA=0 F  S DA=$O(^A7RLBRY(LBRVSTA,681,DA)) Q:'DA  D
"RTN","LBRVCON2",7,0)
 . S TDA=$P(^A7RLBRY(LBRVSTA,681,DA,0),U,2)
"RTN","LBRVCON2",8,0)
 . I TDA="" K ^A7RLBRY(LBRVSTA,681,DA) Q
"RTN","LBRVCON2",9,0)
 . S ^A7RLBRY(LBRVSTA,681,"C",TDA,DA)=""
"RTN","LBRVCON2",10,0)
 S DA=0 F  S DA=$O(^A7RLBRY(LBRVSTA,682,DA)) Q:'DA  D
"RTN","LBRVCON2",11,0)
 . S TDA=$P(^A7RLBRY(LBRVSTA,682,DA,0),U,2)
"RTN","LBRVCON2",12,0)
 . I TDA="" K ^A7RLBRY(LBRVSTA,682,DA) Q
"RTN","LBRVCON2",13,0)
 . S ^A7RLBRY(LBRVSTA,682,"C",TDA,DA)=""
"RTN","LBRVCON2",14,0)
 I '$D(^XTMP("LBRY",LBRVSTA,"ODA5","DONE")) D STP5 S ^XTMP("LBRY",LBRVSTA,"ODA5","DONE")=""
"RTN","LBRVCON2",15,0)
 I '$D(^XTMP("LBRY",LBRVSTA,"CON3","DONE")) D ^LBRVCON3 S ^XTMP("LBRY",LBRVSTA,"CON3","DONE")="",^XTMP("LBRY",LBRVSTA,"CON2","DONE")=""
"RTN","LBRVCON2",16,0)
 K NDA,ODA,USRN,LDA,TDA,Y,%X,%Y,DA,TDA1,VNDN,X,LBRYCLS,USR
"RTN","LBRVCON2",17,0)
 Q
"RTN","LBRVCON2",18,0)
STP4 D MES^LBRPUTL("I am beginning Step 4....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCON2",19,0)
 ;  For each local title moved from original site, set into new site
"RTN","LBRVCON2",20,0)
 S T1=99000 F  S T1=$O(^A7RLBRY(LBRVSTA,680.5,T1)) Q:'T1  S LT1=T1
"RTN","LBRVCON2",21,0)
 S T2=99000 F  S T2=$O(^LBRY(680.5,T2)) Q:'T2  S LT2=T2
"RTN","LBRVCON2",22,0)
 Q:'$D(LT1)
"RTN","LBRVCON2",23,0)
 S LT=$S(LT1>$G(LT2):LT1,1:$G(LT2))
"RTN","LBRVCON2",24,0)
 S $P(^LBRY(680.5,0),"^",3)=LT
"RTN","LBRVCON2",25,0)
 S ODA=$P(^XTMP("LBRY",LBRVSTA,"ODA4"),"^",1)
"RTN","LBRVCON2",26,0)
GDA4 S ODA=$O(^A7RLBRY(LBRVSTA,680.5,ODA)) Q:ODA'>0
"RTN","LBRVCON2",27,0)
 S DINUM=LT
"RTN","LBRVCON2",28,0)
GD4RET F  S DINUM=DINUM+1 Q:'$D(^LBRY(680.5,DINUM,0))
"RTN","LBRVCON2",29,0)
 S X=DINUM,DLAYGO=680.5,DIC(0)="L",DIC="^LBRY(680.5,"
"RTN","LBRVCON2",30,0)
 D FILE^DICN S (NDA,LBRYCLS)=+Y
"RTN","LBRVCON2",31,0)
 I NDA=-1 S DINUM=X G GD4RET
"RTN","LBRVCON2",32,0)
 ;  Set Local Serials
"RTN","LBRVCON2",33,0)
 S TDA="" F  S TDA=$O(^A7RLBRY(LBRVSTA,680,"B",ODA,TDA)) Q:TDA=""  D
"RTN","LBRVCON2",34,0)
 . K ^A7RLBRY(LBRVSTA,680,"B",ODA,TDA)
"RTN","LBRVCON2",35,0)
 . S $P(^A7RLBRY(LBRVSTA,680,TDA,0),U,1)=NDA
"RTN","LBRVCON2",36,0)
 S TDA="" F  S TDA=$O(^A7RLBRY(LBRVSTA,681,"C",ODA,TDA)) Q:TDA=""  D
"RTN","LBRVCON2",37,0)
 . K ^A7RLBRY(LBRVSTA,681,"C",ODA,TDA)
"RTN","LBRVCON2",38,0)
 . S $P(^A7RLBRY(LBRVSTA,681,TDA,0),U,2)=NDA
"RTN","LBRVCON2",39,0)
 S TDA="" F  S TDA=$O(^A7RLBRY(LBRVSTA,682,"C",ODA,TDA)) Q:TDA=""  D
"RTN","LBRVCON2",40,0)
 . K ^A7RLBRY(LBRVSTA,682,"C",ODA,TDA)
"RTN","LBRVCON2",41,0)
 . S $P(^A7RLBRY(LBRVSTA,682,TDA,0),U,2)=NDA
"RTN","LBRVCON2",42,0)
 ;  Move data over in TAF
"RTN","LBRVCON2",43,0)
 S %X="^A7RLBRY(LBRVSTA,680.5,"_ODA_",",%Y="^LBRY(680.5,"_NDA_"," D %XY^%RCR
"RTN","LBRVCON2",44,0)
 ;  Reset cross-references
"RTN","LBRVCON2",45,0)
 ;S DA=NDA D ^LBRYX53
"RTN","LBRVCON2",46,0)
 ;  Create transaction for FORUM
"RTN","LBRVCON2",47,0)
 ; I ODA>99000&(NDA>99000) D ^LBRYLTF ;ask per Nancy do not send titles to forum 4/6/2000 jsr
"RTN","LBRVCON2",48,0)
 S $P(^XTMP("LBRY",LBRVSTA,"ODA4"),"^",1)=ODA G GDA4
"RTN","LBRVCON2",49,0)
STP5 D MES^LBRPUTL("I am beginning Step 5....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCON2",50,0)
 S $P(^LBRY(680,0),"^",3)=1,ODA=$P(^XTMP("LBRY",LBRVSTA,"ODA5"),"^",1)
"RTN","LBRVCON2",51,0)
GDA5 S ODA=$O(^A7RLBRY(LBRVSTA,680,ODA)) Q:ODA'>0
"RTN","LBRVCON2",52,0)
 S VND=$P($G(^A7RLBRY(LBRVSTA,680,ODA,2)),U,5)
"RTN","LBRVCON2",53,0)
 I VND'="" D
"RTN","LBRVCON2",54,0)
 . S VND=$P(VND,"*",1)
"RTN","LBRVCON2",55,0)
 . S VNDN=$O(^PRC(440,"B",VND,""))
"RTN","LBRVCON2",56,0)
 . I VNDN'="" S $P(^A7RLBRY(LBRVSTA,680,ODA,2),U,5)=VND
"RTN","LBRVCON2",57,0)
NNDA ;  Get next available DA
"RTN","LBRVCON2",58,0)
 S DINUM=0
"RTN","LBRVCON2",59,0)
NNDRET F  S DINUM=DINUM+1 Q:'$D(^LBRY(680,DINUM,0))
"RTN","LBRVCON2",60,0)
 S X=DINUM,DLAYGO=680,DIC(0)="L",DIC="^LBRY(680,"
"RTN","LBRVCON2",61,0)
 D FILE^DICN S (DA,NDA)=+Y
"RTN","LBRVCON2",62,0)
 I NDA=-1 S DINUM=X G NNDRET
"RTN","LBRVCON2",63,0)
 S %X="^A7RLBRY(LBRVSTA,680,"_ODA_",",%Y="^LBRY(680,"_NDA_"," D %XY^%RCR
"RTN","LBRVCON2",64,0)
 S OTDA=$P(^A7RLBRY(LBRVSTA,680,ODA,0),U)
"RTN","LBRVCON2",65,0)
 S DIE=DIC,DR=".01////^S X=OTDA" D ^DIE
"RTN","LBRVCON2",66,0)
 F I=3,4,6,13 K ^LBRY(680,NDA,I,"B")
"RTN","LBRVCON2",67,0)
 I $G(^LBRY(680,NDA,3,0))'="" S $P(^(0),U,2)="680.03PA"
"RTN","LBRVCON2",68,0)
 I $G(^LBRY(680,NDA,4,0))'="" S $P(^(0),U,2)="680.01SA"
"RTN","LBRVCON2",69,0)
 I $G(^LBRY(680,NDA,6,0))'="" S $P(^(0),U,2)="680.02SA"
"RTN","LBRVCON2",70,0)
 S DA=ODA D ^LBRYX12 S DA=NDA D ^LBRYX14
"RTN","LBRVCON2",71,0)
 S PDA=$P(^LBRY(680,NDA,0),U)
"RTN","LBRVCON2",72,0)
 S TDA=""
"RTN","LBRVCON2",73,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,681,"C",PDA,TDA)) Q:TDA=""  D
"RTN","LBRVCON2",74,0)
 . S $P(^A7RLBRY(LBRVSTA,681,TDA,0),U,2)=NDA K ^A7RLBRY(LBRVSTA,681,"C",ODA,TDA)
"RTN","LBRVCON2",75,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,682,"C",PDA,TDA)) Q:TDA=""  D
"RTN","LBRVCON2",76,0)
 . S $P(^A7RLBRY(LBRVSTA,682,TDA,0),U,2)=NDA
"RTN","LBRVCON2",77,0)
 . K ^A7RLBRY(LBRVSTA,682,"C",ODA,TDA)
"RTN","LBRVCON2",78,0)
 ; W "STEP 5   "_ODA
"RTN","LBRVCON2",79,0)
 S $P(^XTMP("LBRY",LBRVSTA,"ODA5"),"^",1)=ODA G GDA5
"RTN","LBRVCON3")
0^6^B11017202
"RTN","LBRVCON3",1,0)
LBRVCON3 ;SSI/ALA/KMB/JSR - STEPS 6 AND 7 [ 07/06/2000  3:35 PM ]
"RTN","LBRVCON3",2,0)
 ;;2.5;Library;**3,8**;APR 19, 2000
"RTN","LBRVCON3",3,0)
EN I '$D(^XTMP("LBRY",LBRVSTA,"ODA6","DONE")) D STP6 S ^XTMP("LBRY",LBRVSTA,"ODA6","DONE")=""
"RTN","LBRVCON3",4,0)
 I '$D(^XTMP("LBRY",LBRVSTA,"ODA7","DONE")) D STP7 S ^XTMP("LBRY",LBRVSTA,"ODA7","DONE")=""
"RTN","LBRVCON3",5,0)
 S ^XTMP("LBRY",LBRVSTA,"DONE")=$H
"RTN","LBRVCON3",6,0)
 Q
"RTN","LBRVCON3",7,0)
STP6 S ODA=$P(^XTMP("LBRY",LBRVSTA,"ODA6"),"^",1)
"RTN","LBRVCON3",8,0)
 D MES^LBRPUTL("I am beginning Step 6....for "_LBRVSTA_" at "_$$HTE^XLFDT($H)_"  please wait ")
"RTN","LBRVCON3",9,0)
 F I="AC","B","C","D","E" K ^LBRY(681,I)
"RTN","LBRVCON3",10,0)
 S $P(^LBRY(681,0),"^",3)=1,$P(^LBRY(682,0),"^",3)=1
"RTN","LBRVCON3",11,0)
GDA6 S ODA=$O(^A7RLBRY(LBRVSTA,681,ODA)) Q:ODA'>0
"RTN","LBRVCON3",12,0)
 S USR=$P($G(^A7RLBRY(LBRVSTA,681,ODA,1)),U,3)
"RTN","LBRVCON3",13,0)
 I USR'="" D
"RTN","LBRVCON3",14,0)
 . S USR=$$STRIP^XLFSTR(USR,"*")
"RTN","LBRVCON3",15,0)
 . S USRN=$O(^VA(200,"B",USR,""))
"RTN","LBRVCON3",16,0)
 . I USRN'="" S $P(^A7RLBRY(LBRVSTA,681,ODA,1),U,3)=USRN
"RTN","LBRVCON3",17,0)
 S VND=$P($G(^A7RLBRY(LBRVSTA,681,ODA,1)),U,5)
"RTN","LBRVCON3",18,0)
 I VND'="" D
"RTN","LBRVCON3",19,0)
 . S VND=$$STRIP^XLFSTR(VND,"*") ; PER INTEGRATION TEAM REQUEST
"RTN","LBRVCON3",20,0)
 . S VNDN=$O(^PRC(440,"B",VND,""))
"RTN","LBRVCON3",21,0)
 . I VNDN'="" S $P(^A7RLBRY(LBRVSTA,681,ODA,1),U,5)=VND
"RTN","LBRVCON3",22,0)
MNDA ;  Get next available DA
"RTN","LBRVCON3",23,0)
 S DINUM=$P(^LBRY(681,0),"^",3)
"RTN","LBRVCON3",24,0)
MNDRET F  S DINUM=DINUM+1 Q:'$D(^LBRY(681,DINUM,0))
"RTN","LBRVCON3",25,0)
 S X=DINUM,DLAYGO=681,DIC(0)="L",DIC="^LBRY(681,"
"RTN","LBRVCON3",26,0)
 D FILE^DICN S (DA,NDA)=+Y
"RTN","LBRVCON3",27,0)
 I NDA=-1 S DINUM=X G MNDRET
"RTN","LBRVCON3",28,0)
 S %X="^A7RLBRY(LBRVSTA,681,"_ODA_",",%Y="^LBRY(681,"_NDA_"," D %XY^%RCR
"RTN","LBRVCON3",29,0)
 F I="AC","B" K ^LBRY(681,NDA,2,I)
"RTN","LBRVCON3",30,0)
 S $P(^LBRY(681,NDA,2,0),"^",2)="681.02IPA"
"RTN","LBRVCON3",31,0)
 S $P(^LBRY(681,NDA,0),U)=NDA
"RTN","LBRVCON3",32,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,682,"ZC",ODA,TDA)) Q:TDA=""  D
"RTN","LBRVCON3",33,0)
 . S TDA1="" F  S TDA1=$O(^A7RLBRY(LBRVSTA,682,"ZC",ODA,TDA,TDA1)) Q:TDA1=""  D
"RTN","LBRVCON3",34,0)
 .. S $P(^A7RLBRY(LBRVSTA,682,TDA,4,TDA1,0),U,3)=NDA
"RTN","LBRVCON3",35,0)
 .. K ^A7RLBRY(LBRVSTA,682,"ZC",ODA,TDA,TDA1)
"RTN","LBRVCON3",36,0)
 S $P(^XTMP("LBRY",LBRVSTA,"ODA6"),"^",1)=ODA G GDA6
"RTN","LBRVCON3",37,0)
STP7 S ODA=$P(^XTMP("LBRY",LBRVSTA,"ODA7"),"^",1)
"RTN","LBRVCON3",38,0)
 D MES^LBRPUTL("I am beginning Step 7....for "_LBRVSTA_" at "_$$HTE^XLFDT($H)_"  please wait ")
"RTN","LBRVCON3",39,0)
GDA7 S ODA=$O(^A7RLBRY(LBRVSTA,682,ODA)) Q:'ODA
"RTN","LBRVCON3",40,0)
 S FLAG=""
"RTN","LBRVCON3",41,0)
 S:ODA?.N FLAG="Y"
"RTN","LBRVCON3",42,0)
 Q:FLAG=""
"RTN","LBRVCON3",43,0)
 S USR=$P($G(^A7RLBRY(LBRVSTA,682,ODA,1)),U,6)
"RTN","LBRVCON3",44,0)
 I USR'="" D
"RTN","LBRVCON3",45,0)
 . S USR=$$STRIP^XLFSTR(USR,"*")
"RTN","LBRVCON3",46,0)
 . Q:USR=""
"RTN","LBRVCON3",47,0)
 . S USRN=$O(^VA(200,"B",USR,""))
"RTN","LBRVCON3",48,0)
 . I USRN'="" S $P(^A7RLBRY(LBRVSTA,682,ODA,1),U,6)=USRN
"RTN","LBRVCON3",49,0)
 S LDA=0 F  S LDA=$O(^A7RLBRY(LBRVSTA,682,ODA,4,LDA)) Q:LDA'>0  D
"RTN","LBRVCON3",50,0)
 . S USR=$P($G(^A7RLBRY(LBRVSTA,682,ODA,4,LDA,0)),U,4)
"RTN","LBRVCON3",51,0)
 . ;Q:USR=""
"RTN","LBRVCON3",52,0)
 . I USR'="" D
"RTN","LBRVCON3",53,0)
 . . S USR=$$STRIP^XLFSTR(USR,"*")
"RTN","LBRVCON3",54,0)
 . . Q:USR=""
"RTN","LBRVCON3",55,0)
 . . S USRN=$O(^VA(200,"B",USR,""))
"RTN","LBRVCON3",56,0)
 . . I USRN'="" S $P(^A7RLBRY(LBRVSTA,682,ODA,4,LDA,0),U,4)=USRN
"RTN","LBRVCON3",57,0)
 . S USR=$P($G(^A7RLBRY(LBRVSTA,682,ODA,4,LDA,0)),U,8)
"RTN","LBRVCON3",58,0)
 . I USR'="" D
"RTN","LBRVCON3",59,0)
 . .  S USR=$$STRIP^XLFSTR(USR,"*")
"RTN","LBRVCON3",60,0)
 . .  Q:USR=""
"RTN","LBRVCON3",61,0)
 . .  S USRN=$O(^VA(200,"B",USR,""))
"RTN","LBRVCON3",62,0)
 . .  I USRN'="" S $P(^A7RLBRY(LBRVSTA,682,ODA,4,LDA,0),U,8)=USRN
"RTN","LBRVCON3",63,0)
NNDA ;  Get next available DA
"RTN","LBRVCON3",64,0)
 S DINUM=$P(^LBRY(682,0),"^",3)
"RTN","LBRVCON3",65,0)
RET F  S DINUM=DINUM+1 Q:'$D(^LBRY(682,DINUM,0))
"RTN","LBRVCON3",66,0)
 S X=DINUM,DLAYGO=682,DIC(0)="L",DIC="^LBRY(682,"
"RTN","LBRVCON3",67,0)
 D FILE^DICN S (DA,NDA)=+Y
"RTN","LBRVCON3",68,0)
 I NDA=-1 S DINUM=X G RET
"RTN","LBRVCON3",69,0)
 Q:'ODA
"RTN","LBRVCON3",70,0)
 S %X="^A7RLBRY(LBRVSTA,682,"_ODA_",",%Y="^LBRY(682,"_NDA_"," D %XY^%RCR
"RTN","LBRVCON3",71,0)
 K ^LBRY(682,NDA,4,"B")
"RTN","LBRVCON3",72,0)
 S LBRYINT=1
"RTN","LBRVCON3",73,0)
 S $P(^LBRY(682,NDA,0),U)=NDA D ^LBRYX33
"RTN","LBRVCON3",74,0)
 S $P(^XTMP("LBRY",LBRVSTA,"ODA7"),"^",1)=ODA G GDA7
"RTN","LBRVCON9")
0^7^B3237470
"RTN","LBRVCON9",1,0)
LBRVCON9 ;SSI/JSR-START CHECKPOINTS ;[ 04/19/2000  10:29 AM ]
"RTN","LBRVCON9",2,0)
 ;;2.5;Library;**8**;APR 19, 2000
"RTN","LBRVCON9",3,0)
START  ;
"RTN","LBRVCON9",4,0)
  S NUM=0
"RTN","LBRVCON9",5,0)
  S ^XTMP("LBRY",LBRVSTA,0)=""
"RTN","LBRVCON9",6,0)
  S ^XTMP("LBRY",LBRVSTA,"STA")=$H
"RTN","LBRVCON9",7,0)
  S LBRTIM=$$NOW^XLFDT
"RTN","LBRVCON9",8,0)
  S:'$D(^XTMP("LBRY",LBRVSTA,"ODA1")) ^XTMP("LBRY",LBRVSTA,"ODA1")=NUM_"^"_LBRTIM
"RTN","LBRVCON9",9,0)
  S LBRTIM=$$NOW^XLFDT
"RTN","LBRVCON9",10,0)
  S:'$D(^XTMP("LBRY",LBRVSTA,"ODA2")) ^XTMP("LBRY",LBRVSTA,"ODA2")=NUM_"^"_LBRTIM
"RTN","LBRVCON9",11,0)
  S LBRTIM=$$NOW^XLFDT
"RTN","LBRVCON9",12,0)
  S:'$D(^XTMP("LBRY",LBRVSTA,"ODA3")) ^XTMP("LBRY",LBRVSTA,"ODA3")=NUM_"^"_LBRTIM
"RTN","LBRVCON9",13,0)
  S LBRTIM=$$NOW^XLFDT
"RTN","LBRVCON9",14,0)
  S:'$D(^XTMP("LBRY",LBRVSTA,"ODA4")) ^XTMP("LBRY",LBRVSTA,"ODA4")=NUM_"^"_LBRTIM
"RTN","LBRVCON9",15,0)
  S LBRTIM=$$NOW^XLFDT
"RTN","LBRVCON9",16,0)
  S:'$D(^XTMP("LBRY",LBRVSTA,"ODA5")) ^XTMP("LBRY",LBRVSTA,"ODA5")=NUM_"^"_LBRTIM
"RTN","LBRVCON9",17,0)
  S LBRTIM=$$NOW^XLFDT
"RTN","LBRVCON9",18,0)
  S:'$D(^XTMP("LBRY",LBRVSTA,"ODA6")) ^XTMP("LBRY",LBRVSTA,"ODA6")=NUM_"^"_LBRTIM
"RTN","LBRVCON9",19,0)
  S LBRTIM=$$NOW^XLFDT
"RTN","LBRVCON9",20,0)
  S:'$D(^XTMP("LBRY",LBRVSTA,"ODA7")) ^XTMP("LBRY",LBRVSTA,"ODA7")=NUM_"^"_LBRTIM
"RTN","LBRVCON9",21,0)
  S LBRTIM=$$NOW^XLFDT
"RTN","LBRVCON9",22,0)
  S:'$D(^XTMP("LBRY",LBRVSTA,"CON3")) ^XTMP("LBRY",LBRVSTA,"CON3")=NUM_"^"_LBRTIM
"RTN","LBRVCON9",23,0)
  S LBRTIM=$$NOW^XLFDT
"RTN","LBRVCON9",24,0)
  S:'$D(^XTMP("LBRY",LBRVSTA,"CON2")) ^XTMP("LBRY",LBRVSTA,"CON2")=NUM_"^"_LBRTIM
"RTN","LBRVCON9",25,0)
  
"RTN","LBRVCON9",26,0)
END ;
"RTN","LBRVCON9",27,0)
 Q
"RTN","LBRVCOND")
0^8^B28481821
"RTN","LBRVCOND",1,0)
LBRVCOND ;SSI/ALA/JSR-Consolidate library files env check ;[ 06/27/2000  7:29 PM ]
"RTN","LBRVCOND",2,0)
 ;;2.5;Library;**8**;Mar 11, 2000
"RTN","LBRVCOND",3,0)
 ;
"RTN","LBRVCOND",4,0)
EN ; Checking for patch load requirements
"RTN","LBRVCOND",5,0)
 N QUIT
"RTN","LBRVCOND",6,0)
 I '$G(DUZ)!($G(DUZ(0))'["@") W !,"USER 'DUZ' VARIABLES **NOT** CORRECTLY DEFINED.  CONFIRM THAT DUZ(0)='@'.  THEN D ^XUP." S XPDQUIT=1 Q
"RTN","LBRVCOND",7,0)
 ;
"RTN","LBRVCOND",8,0)
 ;
"RTN","LBRVCOND",9,0)
 S LBRPT2=$$PATCH^XPDUTL("LBR*2.5*2")
"RTN","LBRVCOND",10,0)
 I LBRPT2'=1 D  S XPDQUIT=1 Q
"RTN","LBRVCOND",11,0)
 . W !!,"*** Patch LBR*2.5*2 must be installed prior to loading"
"RTN","LBRVCOND",12,0)
 . W !,"this patch.  This install will now abort.",!
"RTN","LBRVCOND",13,0)
 ;
"RTN","LBRVCOND",14,0)
 S LBRPT3=$$PATCH^XPDUTL("LBR*2.5*3")
"RTN","LBRVCOND",15,0)
 I LBRPT3'=1 D  S XPDQUIT=1 Q
"RTN","LBRVCOND",16,0)
 . W !!,"*** Patch LBR*2.5*3 must be installed prior to loading"
"RTN","LBRVCOND",17,0)
 . W !,"this patch.  This install will now abort.",!
"RTN","LBRVCOND",18,0)
 ;;
"RTN","LBRVCOND",19,0)
RX ; re-index file 680.6 for checks
"RTN","LBRVCOND",20,0)
 F LBRXREF="B","C" K ^LBRY(680.6,LBRXREF)
"RTN","LBRVCOND",21,0)
 S DIK="^LBRY(680.6," D IXALL^DIK
"RTN","LBRVCOND",22,0)
LEG ;Check for Legacy Station
"RTN","LBRVCOND",23,0)
 S LBRPRT=$P($G(^A7RLBRY("LBRV",0)),"^",3),LBRSYS=$P(LBRPRT,";",2)
"RTN","LBRVCOND",24,0)
 I LBRSYS="LEG" K LBRSYS,LBRPRT,LBRPT2,LBRXREF Q
"RTN","LBRVCOND",25,0)
 ;
"RTN","LBRVCOND",26,0)
PL ;
"RTN","LBRVCOND",27,0)
 S QUIT=0,XPDQUIT=1,DIRUT=1
"RTN","LBRVCOND",28,0)
 D MES^XPDUTL("")
"RTN","LBRVCOND",29,0)
 D MES^XPDUTL(" ** PLEASE IDENTIFY YOUR STATION TYPE **  ")
"RTN","LBRVCOND",30,0)
 S DIR(0)="SX^1:Primary;2:Legacy"
"RTN","LBRVCOND",31,0)
 S DIR("A")="SELECT SITE TYPE"
"RTN","LBRVCOND",32,0)
 S DIR("B")=""
"RTN","LBRVCOND",33,0)
 D ^DIR
"RTN","LBRVCOND",34,0)
 I $D(DIRUT) K DIR,X S QUIT=1,FLAG="YES" Q
"RTN","LBRVCOND",35,0)
 I Y=2 S LBRLEGP="LEGACY"
"RTN","LBRVCOND",36,0)
 I Y=1 S LBRLEGP="PRIMARY"
"RTN","LBRVCOND",37,0)
QUEST1 K FLAG
"RTN","LBRVCOND",38,0)
 D MES^XPDUTL("*** WARNING PLEASE VERIFY THE FOLLOWING ***")
"RTN","LBRVCOND",39,0)
 D MES^XPDUTL("Have all the entries in the Legacy's National Library Files (680.1,680.2, 680.8 and 680.9) been confirmed in the Primary's National Library Files? ")
"RTN","LBRVCOND",40,0)
 D MES^XPDUTL(" Enter 'Y'es to continue or 'N'o to stop the install.")
"RTN","LBRVCOND",41,0)
 D MES^XPDUTL("  ")
"RTN","LBRVCOND",42,0)
 S DIR(0)="Y",DIR("A")="Enter 'N' to quit, or 'Y' to continue: "
"RTN","LBRVCOND",43,0)
 S DIR("B")="NO" D ^DIR
"RTN","LBRVCOND",44,0)
 I Y=0!$D(DIRUT) K DIR,X,Y S QUIT=1,FLAG="YES" Q
"RTN","LBRVCOND",45,0)
QUEST2 K FLAG
"RTN","LBRVCOND",46,0)
 D MES^XPDUTL("*** WARNING - PLEASE VERIFY THE FOLLOWING ***")
"RTN","LBRVCOND",47,0)
 D MES^XPDUTL("Have your Service File (#49) and New Person File (#200) been consolidated?")
"RTN","LBRVCOND",48,0)
 D MES^XPDUTL(" Enter 'Y'es to continue or 'N'o to stop the install.")
"RTN","LBRVCOND",49,0)
 D MES^XPDUTL("  ")
"RTN","LBRVCOND",50,0)
 S DIR(0)="Y",DIR("A")="Enter 'N' to quit, or 'Y' to continue: "
"RTN","LBRVCOND",51,0)
 S DIR("B")="NO" D ^DIR
"RTN","LBRVCOND",52,0)
 I Y=0!$D(DIRUT) K DIR,X,Y S QUIT=1,FLAG="YES" Q
"RTN","LBRVCOND",53,0)
WRN ;  Warning on existence of Translated global
"RTN","LBRVCOND",54,0)
 I $D(^A7RLBRY) S QUIT=0 D  I QUIT S XPDQUIT=1,DIRUT=1 Q
"RTN","LBRVCOND",55,0)
 . W !!
"RTN","LBRVCOND",56,0)
 . D MES^XPDUTL("*** WARNING - A7RLBRY global exists! ***")
"RTN","LBRVCOND",57,0)
 . D MES^XPDUTL("If you are a LEGACY STATION this data should not exist in prepare data")
"RTN","LBRVCOND",58,0)
 . D BMES^XPDUTL("If you are a PRIMARY STATION this file must EXIST to proceed")
"RTN","LBRVCOND",59,0)
 . D MES^XPDUTL(" Enter 'Y'es to continue or 'N'o to stop the install.")
"RTN","LBRVCOND",60,0)
 . D MES^XPDUTL("  ")
"RTN","LBRVCOND",61,0)
 . S DIR(0)="Y",DIR("A")="Enter 'N' to quit, or 'Y' to continue: "
"RTN","LBRVCOND",62,0)
 . S DIR("B")="NO" D ^DIR
"RTN","LBRVCOND",63,0)
 . I Y=0!$D(DIRUT) K DIR,X,Y S QUIT=1,FLAG="YES" Q
"RTN","LBRVCOND",64,0)
 . I LBRLEGP="LEGACY" K DIR,X,Y S QUIT=1,FLAG="YES" D MES^XPDUTL("*** Legacy Station cannot proceed  ***") Q
"RTN","LBRVCOND",65,0)
CNF ;  Warning on existence of Translated global
"RTN","LBRVCOND",66,0)
 I '$D(^A7RLBRY) S QUIT=0 D  I QUIT S XPDQUIT=1,DIRUT=1 Q
"RTN","LBRVCOND",67,0)
 . D MES^XPDUTL("*** WARNING - A7RLBRY global does not exist! ***")
"RTN","LBRVCOND",68,0)
 . D MES^XPDUTL("If you are a LEGACY SITE this global CANNOT exist to proceed!")
"RTN","LBRVCOND",69,0)
 . D MES^XPDUTL("  ")
"RTN","LBRVCOND",70,0)
 . S DIR(0)="Y",DIR("A")="Enter 'N' to quit, or 'Y' to continue: "
"RTN","LBRVCOND",71,0)
 . S DIR("B")="NO" D ^DIR
"RTN","LBRVCOND",72,0)
 . I Y=0!$D(DIRUT) K DIR,X S QUIT=1,FLAG="YES" Q
"RTN","LBRVCOND",73,0)
 . I Y=1 S FLAG="",QUIT=1 Q
"RTN","LBRVCOND",74,0)
 . I LBRLEGP="PRIMARY" S FLAG="YES" D MES^XPDUTL("**WARNING**") G EXIT
"RTN","LBRVCOND",75,0)
 I QUIT=1 G EXIT
"RTN","LBRVCOND",76,0)
STA ;
"RTN","LBRVCOND",77,0)
 S LBRVSTA=0,CT=0
"RTN","LBRVCOND",78,0)
 F  S LBRVSTA=$O(^A7RLBRY(LBRVSTA)) Q:LBRVSTA=""  S CT=CT+1
"RTN","LBRVCOND",79,0)
 I CT>0 S $P(^A7RLBRY(0),"^",3)=CT
"RTN","LBRVCOND",80,0)
 I CT>1 D
"RTN","LBRVCOND",81,0)
 . D MES^XPDUTL("**WARNING** Temporary global contains multiple stations.")
"RTN","LBRVCOND",82,0)
 . D MES^XPDUTL("The integration may take a couple of hours.")
"RTN","LBRVCOND",83,0)
 K CT,LBRPT2,LBRVSTA
"RTN","LBRVCOND",84,0)
QUEST3 ;
"RTN","LBRVCOND",85,0)
 W !!
"RTN","LBRVCOND",86,0)
 S FLAG=""
"RTN","LBRVCOND",87,0)
 D MES^XPDUTL("*** WARNING PLEASE VERIFY ***")
"RTN","LBRVCOND",88,0)
 D MES^XPDUTL("    Below is a list of Sites which exist in the Primary System:")
"RTN","LBRVCOND",89,0)
 S LBRX=0
"RTN","LBRVCOND",90,0)
 F  S LBRX=$O(^LBRY(680.6,LBRX)) Q:'LBRX  D
"RTN","LBRVCOND",91,0)
 . S LBRDATA=^LBRY(680.6,LBRX,0)
"RTN","LBRVCOND",92,0)
 . S LBRAB=$P(LBRDATA,"^",7)
"RTN","LBRVCOND",93,0)
 . S LBRSTA=$P(LBRDATA,"^",1)
"RTN","LBRVCOND",94,0)
 . S LBRLST(LBRAB)=""
"RTN","LBRVCOND",95,0)
 . D MES^XPDUTL("ID Code:"_LBRAB_"  Site:"_LBRSTA)
"RTN","LBRVCOND",96,0)
 W !!
"RTN","LBRVCOND",97,0)
 D MES^XPDUTL("    Below is a list of Sites ready for integration")
"RTN","LBRVCOND",98,0)
 S LBRA7=0
"RTN","LBRVCOND",99,0)
 F  S LBRA7=$O(^A7RLBRY(LBRA7)) Q:LBRA7=""  D
"RTN","LBRVCOND",100,0)
 . D MES^XPDUTL("ID Code:"_LBRA7)
"RTN","LBRVCOND",101,0)
 . S:'$D(LBRLST(LBRA7)) LBRHLT=1
"RTN","LBRVCOND",102,0)
 . W !!
"RTN","LBRVCOND",103,0)
 D MES^XPDUTL("If no Division Site Name defined in Library Parameters File for integrating")
"RTN","LBRVCOND",104,0)
 D MES^XPDUTL("site then enter the corresponding SITE NAME to match the above 5 letter code.")
"RTN","LBRVCOND",105,0)
 W !!
"RTN","LBRVCOND",106,0)
 D MES^XPDUTL("PRESS ANY KEY WHEN READY TO CONTINUE")
"RTN","LBRVCOND",107,0)
 R DUMB:400
"RTN","LBRVCOND",108,0)
 I $G(LBRHLT) D MES^XPDUTL("SITE MISMATCH -- You must Define Site[s] PRIOR TO INTEGRATION.  This install is  now aborted.") S QUIT=1,FLAG="YES" Q
"RTN","LBRVCOND",109,0)
EXIT ;Kill local variables
"RTN","LBRVCOND",110,0)
 K LBRVSTA,LBRVNM,DIR,DIC,DIE,D,DA,D0,DR,X,Y
"RTN","LBRVCOND",111,0)
 I QUIT S DIRUT=1
"RTN","LBRVCOND",112,0)
 Q
"RTN","LBRVCONP")
0^10^B10811860
"RTN","LBRVCONP",1,0)
LBRVCONP ;SSI/ALA/JSR-Preinstall of consolidation ;[ 06/28/2000  1:19 PM ]
"RTN","LBRVCONP",2,0)
 ;;2.5;Library;**3,8**;APR 19, 2000
"RTN","LBRVCONP",3,0)
CHKPT ; 
"RTN","LBRVCONP",4,0)
 ;  Clean up version number
"RTN","LBRVCONP",5,0)
 S N=679.9999 F  S N=$O(^DD(N)) Q:N>689.4  I $G(^DD(N,0,"VR"))?1"2.5"1A.N S ^DD(N,0,"VR")=2.5
"RTN","LBRVCONP",6,0)
 ;  If single primary site quit
"RTN","LBRVCONP",7,0)
 I $P(^LBRY(680.6,0),U,4)=1 Q
"RTN","LBRVCONP",8,0)
 S LBRVSTA=0
"RTN","LBRVCONP",9,0)
STA ;get 5-letter code and number reference
"RTN","LBRVCONP",10,0)
 S LBRVSTA=$O(^A7RLBRY(LBRVSTA))
"RTN","LBRVCONP",11,0)
 I LBRVSTA="" G EXIT
"RTN","LBRVCONP",12,0)
 S LBRVNM=$O(^LBRY(680.6,"C",LBRVSTA,""))
"RTN","LBRVCONP",13,0)
 G EXIT:$G(DUOUT)=1
"RTN","LBRVCONP",14,0)
 D L680
"RTN","LBRVCONP",15,0)
 S ^XTMP("LBRY","LBRVCONP",LBRVSTA,"DONE")=$H
"RTN","LBRVCONP",16,0)
 G STA
"RTN","LBRVCONP",17,0)
L680 ;  Set those pointers that don't have a cross-reference
"RTN","LBRVCONP",18,0)
 D MES^XPDUTL("Starting pre-consolidation steps...")
"RTN","LBRVCONP",19,0)
 S TDA=0 D MES^XPDUTL("File 680 for "_LBRVSTA)
"RTN","LBRVCONP",20,0)
 F I="B","E" K ^A7RLBRY(LBRVSTA,680,I)
"RTN","LBRVCONP",21,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,680,TDA)) Q:TDA'>0  D  W:TDA#50=0 "."
"RTN","LBRVCONP",22,0)
 . S $P(^A7RLBRY(LBRVSTA,680,TDA,0),U,4)=LBRVNM
"RTN","LBRVCONP",23,0)
 . S PDA=$P(^A7RLBRY(LBRVSTA,680,TDA,0),U)
"RTN","LBRVCONP",24,0)
 . I PDA'="" S ^A7RLBRY(LBRVSTA,680,"B",PDA,TDA)=""
"RTN","LBRVCONP",25,0)
 . S LD1=$P($G(^A7RLBRY(LBRVSTA,680,TDA,10)),U,7)
"RTN","LBRVCONP",26,0)
 . I LD1'="" S ^A7RLBRY(LBRVSTA,680,"ZN",LD1,TDA)=""
"RTN","LBRVCONP",27,0)
 . S LD2=$P($G(^A7RLBRY(LBRVSTA,680,TDA,1)),U,3)
"RTN","LBRVCONP",28,0)
 . I LD2'="" S ^A7RLBRY(LBRVSTA,680,"ZL",LD2,TDA)=""
"RTN","LBRVCONP",29,0)
L681 S TDA=0 D MES^XPDUTL("File 681 for "_LBRVSTA)
"RTN","LBRVCONP",30,0)
 F I="AC","B","C","D","E" K ^A7RLBRY(LBRVSTA,681,I)
"RTN","LBRVCONP",31,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,681,TDA)) Q:TDA'>0  D  W:TDA#50=0 "."
"RTN","LBRVCONP",32,0)
 . S $P(^A7RLBRY(LBRVSTA,681,TDA,0),U,4)=LBRVNM
"RTN","LBRVCONP",33,0)
 . S PDA=$P(^A7RLBRY(LBRVSTA,681,TDA,0),U,2)
"RTN","LBRVCONP",34,0)
 . I PDA'="" S ^A7RLBRY(LBRVSTA,681,"C",PDA,TDA)=""
"RTN","LBRVCONP",35,0)
 . S D1=0 F  S D1=$O(^A7RLBRY(LBRVSTA,681,TDA,2,D1)) Q:'D1  D
"RTN","LBRVCONP",36,0)
 . . S PTR=$P(^A7RLBRY(LBRVSTA,681,TDA,2,D1,0),U)
"RTN","LBRVCONP",37,0)
 . . S ^A7RLBRY(LBRVSTA,681,"D",PTR,TDA,D1)=""
"RTN","LBRVCONP",38,0)
 . S LD1=$P($G(^A7RLBRY(LBRVSTA,681,TDA,1)),U,8)
"RTN","LBRVCONP",39,0)
 . I LD1'="" S ^A7RLBRY(LBRVSTA,681,"ZN",LD1,TDA)=""
"RTN","LBRVCONP",40,0)
 . S LD2=$P($G(^A7RLBRY(LBRVSTA,681,TDA,1)),U,2)
"RTN","LBRVCONP",41,0)
 . I LD2'="" S ^A7RLBRY(LBRVSTA,681,"ZL",LD2,TDA)=""
"RTN","LBRVCONP",42,0)
L682 S TDA=0 D MES^LBRPUTL("File 682 for "_LBRVSTA)
"RTN","LBRVCONP",43,0)
 F I="A1","A3","A4","AC","B","C","D","E" K ^A7RLBRY(LBRVSTA,682,I)
"RTN","LBRVCONP",44,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,682,TDA)) Q:TDA'>0  D  W:TDA#50=0 "."
"RTN","LBRVCONP",45,0)
 . S $P(^A7RLBRY(LBRVSTA,682,TDA,0),U,4)=LBRVNM
"RTN","LBRVCONP",46,0)
 . S PDA=$P(^A7RLBRY(LBRVSTA,682,TDA,0),U,2)
"RTN","LBRVCONP",47,0)
 . I PDA'="" S ^A7RLBRY(LBRVSTA,682,"C",PDA,TDA)=""
"RTN","LBRVCONP",48,0)
 . S TDA1=0 F  S TDA1=$O(^A7RLBRY(LBRVSTA,682,TDA,4,TDA1)) Q:TDA1'>0  D
"RTN","LBRVCONP",49,0)
 .. S LD3=$P(^A7RLBRY(LBRVSTA,682,TDA,4,TDA1,0),U,3)
"RTN","LBRVCONP",50,0)
 .. I LD3'="" S ^A7RLBRY(LBRVSTA,682,"ZC",LD3,TDA,TDA1)=""
"RTN","LBRVCONP",51,0)
L685 S TDA=0 D MES^LBRPUTL("File 680.5 for "_LBRVSTA)
"RTN","LBRVCONP",52,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,680.5,TDA)) Q:TDA>99000!(TDA="")  D  W:TDA#50=0 "."
"RTN","LBRVCONP",53,0)
 . I $D(^LBRY(680.5,TDA)) K ^A7RLBRY(LBRVSTA,680.5,TDA) Q
"RTN","LBRVCONP",54,0)
 . F ND=0,3,4 S:$G(^A7RLBRY(LBRVSTA,680.5,TDA,ND))'="" ^LBRY(680.5,TDA,ND)=^A7RLBRY(LBRVSTA,680.5,TDA,ND)
"RTN","LBRVCONP",55,0)
 . F ND=1,2 I $G(^A7RLBRY(LBRVSTA,680.5,TDA,ND,0))'="" D
"RTN","LBRVCONP",56,0)
 .. S ^LBRY(680.5,TDA,ND,0)=^A7RLBRY(LBRVSTA,680.5,TDA,ND,0)
"RTN","LBRVCONP",57,0)
 .. S NN=0 F  S NN=$O(^A7RLBRY(LBRVSTA,680.5,TDA,ND,NN)) Q:'NN  D
"RTN","LBRVCONP",58,0)
 ... S ^LBRY(680.5,TDA,ND,NN,0)=^A7RLBRY(LBRVSTA,680.5,TDA,ND,NN,0)
"RTN","LBRVCONP",59,0)
 . K ^A7RLBRY(LBRVSTA,680.5,TDA)
"RTN","LBRVCONP",60,0)
 S DIK="^LBRY(680.5," D IXALL^DIK
"RTN","LBRVCONP",61,0)
 Q
"RTN","LBRVCONP",62,0)
EXIT ;
"RTN","LBRVCONP",63,0)
 K LBRVNM,TDA,LD1,PDA,TDA1,LD3,ND,NN,DIK,LD2,TDA1,DIC,DIE,D1,PTR
"RTN","LBRVCONP",64,0)
 Q
"RTN","LBRVCONS")
0^11^B25695189
"RTN","LBRVCONS",1,0)
LBRVCONS ;SSI/ALA/JSR-Consolidate library files ;[ 07/06/2000  3:56 PM ]
"RTN","LBRVCONS",2,0)
 ;;2.5;Library;**3,8**;Mar 11, 2000
"RTN","LBRVCONS",3,0)
EN ;
"RTN","LBRVCONS",4,0)
 D ^LBRVCOND
"RTN","LBRVCONS",5,0)
 I LBRLEGP="LEGACY" D MES^XPDUTL("*Sorry Legacy Sites can not use this option ***") Q
"RTN","LBRVCONS",6,0)
 Q:FLAG="YES"
"RTN","LBRVCONS",7,0)
 ;
"RTN","LBRVCONS",8,0)
STA D START^LBRYSITE
"RTN","LBRVCONS",9,0)
 S:X'="" LBRSTS($P(Y(0),"^",7))=""
"RTN","LBRVCONS",10,0)
 G:X'="" STA
"RTN","LBRVCONS",11,0)
 M ^XTMP("LBRY","PRE-CON")=LBRSTS
"RTN","LBRVCONS",12,0)
 S LBRVSTA=""
"RTN","LBRVCONS",13,0)
 F  S LBRVSTA=$O(^XTMP("LBRY","PRE-CON",LBRVSTA)) Q:LBRVSTA=""  D
"RTN","LBRVCONS",14,0)
 . I '$D(^XTMP("LBRY","LBRVCONP",LBRVSTA,"DONE")) D ^LBRVCONP
"RTN","LBRVCONS",15,0)
 S LBRVSTA=""
"RTN","LBRVCONS",16,0)
 F  S LBRVSTA=$O(^XTMP("LBRY","LBRVCONP",LBRVSTA)) Q:LBRVSTA=""  D
"RTN","LBRVCONS",17,0)
 . Q:'$D(^A7RLBRY(LBRVSTA))
"RTN","LBRVCONS",18,0)
 . Q:$D(^XTMP("LBRY",LBRVSTA,"DONE"))
"RTN","LBRVCONS",19,0)
 . I '$D(^XTMP("LBRY",LBRVSTA,"DONE")) D ^LBRVCON9
"RTN","LBRVCONS",20,0)
 . D STRT
"RTN","LBRVCONS",21,0)
 . S ^XTMP("LBRY",LBRVSTA,"COMPLETE")=$H
"RTN","LBRVCONS",22,0)
 G EXIT
"RTN","LBRVCONS",23,0)
STRT ;
"RTN","LBRVCONS",24,0)
MN G EXIT:LBRVSTA=""
"RTN","LBRVCONS",25,0)
 S LBRVNM=$O(^LBRY(680.6,"C",LBRVSTA,""))
"RTN","LBRVCONS",26,0)
 I '$D(^XTMP("LBRY",LBRVSTA,"ODA1","DONE")) D
"RTN","LBRVCONS",27,0)
 . D STP1
"RTN","LBRVCONS",28,0)
 . S ^XTMP("LBRY",LBRVSTA,"ODA1","DONE")=""
"RTN","LBRVCONS",29,0)
 I '$D(^XTMP("LBRY",LBRVSTA,"ODA2","DONE")) D STP2 S ^XTMP("LBRY",LBRVSTA,"ODA2","DONE")=""
"RTN","LBRVCONS",30,0)
 I '$D(^XTMP("LBRY",LBRVSTA,"ODA3","DONE")) D STP3 S ^XTMP("LBRY",LBRVSTA,"ODA3","DONE")=""
"RTN","LBRVCONS",31,0)
 I '$D(^XTMP("LBRY",LBRVSTA,"CON2","DONE")) D ^LBRVCON2 S ^XTMP("LBRY",LBRVSTA,"CON2","DONE")=""
"RTN","LBRVCONS",32,0)
 D MES^LBRPUTL("I am done with integrating "_LBRVSTA_"'s data at "_$$HTE^XLFDT($H))
"RTN","LBRVCONS",33,0)
 K ^A7RLBRY(LBRVSTA)
"RTN","LBRVCONS",34,0)
 Q
"RTN","LBRVCONS",35,0)
STP1 S ODA=$P(^XTMP("LBRY",LBRVSTA,"ODA1"),"^",1)
"RTN","LBRVCONS",36,0)
 D MES^LBRPUTL("I am beginning Step 1....for "_LBRVSTA_"'s data at "_$$HTE^XLFDT($H))
"RTN","LBRVCONS",37,0)
 K ^A7RLBRY(LBRVSTA,680.3,"B")
"RTN","LBRVCONS",38,0)
GDA1 S ODA=$O(^A7RLBRY(LBRVSTA,680.3,ODA)) Q:ODA'>0
"RTN","LBRVCONS",39,0)
 S SUB=$P(^A7RLBRY(LBRVSTA,680.3,ODA,0),U)
"RTN","LBRVCONS",40,0)
GD1 S NDA=$O(^LBRY(680.3,"B",SUB,""))
"RTN","LBRVCONS",41,0)
 I NDA'="" D  K ^A7RLBRY(LBRVSTA,680.3,ODA) S $P(^XTMP("LBRY",LBRVSTA,"ODA1"),"^",1)=ODA G GDA1
"RTN","LBRVCONS",42,0)
 . I $G(^A7RLBRY(LBRVSTA,680.3,NDA,0))'="" Q
"RTN","LBRVCONS",43,0)
 . S L1="" F  S L1=$O(^A7RLBRY(LBRVSTA,680,"C",ODA,L1)) Q:L1=""  D
"RTN","LBRVCONS",44,0)
 . . S L0=$O(^A7RLBRY(LBRVSTA,680,"C",ODA,L1,""))
"RTN","LBRVCONS",45,0)
 . . S $P(^A7RLBRY(LBRVSTA,680,L1,3,L0,0),U)=NDA
"RTN","LBRVCONS",46,0)
 S DINUM=$P(^LBRY(680.3,0),"^",3)
"RTN","LBRVCONS",47,0)
GD1RET F  S DINUM=DINUM+1 Q:'$D(^LBRY(680.3,DINUM,0))
"RTN","LBRVCONS",48,0)
 S X=DINUM,DLAYGO=680.3,DIC(0)="L",DIC="^LBRY(680.3,"
"RTN","LBRVCONS",49,0)
 D FILE^DICN S DA=+Y
"RTN","LBRVCONS",50,0)
 I DA=-1 S DINUM=X G GD1RET
"RTN","LBRVCONS",51,0)
 S DIE=DIC,DR=".01////^S X=SUB" D ^DIE
"RTN","LBRVCONS",52,0)
 G GDA1
"RTN","LBRVCONS",53,0)
STP2 S ODA=$P(^XTMP("LBRY",LBRVSTA,"ODA2"),"^",1)
"RTN","LBRVCONS",54,0)
 D MES^LBRPUTL("I am beginning Step 2....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCONS",55,0)
GDA2 S ODA=$O(^A7RLBRY(LBRVSTA,680.4,ODA)) Q:ODA'>0
"RTN","LBRVCONS",56,0)
 I '$D(^A7RLBRY(LBRVSTA,680,"ZN",ODA)),'$D(^A7RLBRY(LBRVSTA,681,"D",ODA)),'$D(^A7RLBRY(LBRVSTA,681,"ZN",ODA)) S $P(^XTMP("LBRY",LBRVSTA,"ODA2"),"^",1)=ODA G GDA2
"RTN","LBRVCONS",57,0)
 S $P(^A7RLBRY(LBRVSTA,680.4,ODA,0),U,9)=LBRVNM
"RTN","LBRVCONS",58,0)
 S SRV=$P($G(^A7RLBRY(LBRVSTA,680.4,ODA,0)),U,2)
"RTN","LBRVCONS",59,0)
 I SRV'="" D
"RTN","LBRVCONS",60,0)
 . S SRV=$P(SRV,"*",1),DIC(0)="X",DIC="^DIC(49,",X=SRV D ^DIC
"RTN","LBRVCONS",61,0)
 . S SRVN=+Y
"RTN","LBRVCONS",62,0)
 . I SRVN>0 S $P(^A7RLBRY(LBRVSTA,680.4,ODA,0),U,2)=SRVN
"RTN","LBRVCONS",63,0)
 S DINUM=$P(^LBRY(680.4,0),"^",3)
"RTN","LBRVCONS",64,0)
GDARET F  S DINUM=DINUM+1 Q:'$D(^LBRY(680.4,DINUM,0))
"RTN","LBRVCONS",65,0)
 S X=DINUM,DLAYGO=680.4,DIC(0)="L",DIC="^LBRY(680.4,"
"RTN","LBRVCONS",66,0)
 D FILE^DICN S DA=+Y
"RTN","LBRVCONS",67,0)
 I DA=-1 S DINUM=X G GDARET
"RTN","LBRVCONS",68,0)
 S %X="^A7RLBRY(LBRVSTA,680.4,"_ODA_",",%Y="^LBRY(680.4,"_DA_"," D %XY^%RCR
"RTN","LBRVCONS",69,0)
 S TDA=""
"RTN","LBRVCONS",70,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,680,"ZN",ODA,TDA)) Q:TDA=""  S $P(^A7RLBRY(LBRVSTA,680,TDA,10),U,7)=DA K ^A7RLBRY(LBRVSTA,680,"ZN",ODA,TDA)
"RTN","LBRVCONS",71,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,681,"ZN",ODA,TDA)) Q:TDA=""  S $P(^A7RLBRY(LBRVSTA,681,TDA,1),U,8)=DA K ^A7RLBRY(LBRVSTA,681,"ZN",ODA,TDA)
"RTN","LBRVCONS",72,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,681,"D",ODA,TDA)) Q:TDA=""   S NDA="" D
"RTN","LBRVCONS",73,0)
 . K ^A7RLBRY(LBRVSTA,681,TDA,2,"AC"),^A7RLBRY(LBRVSTA,681,TDA,2,"B")
"RTN","LBRVCONS",74,0)
 . F  S NDA=$O(^A7RLBRY(LBRVSTA,681,"D",ODA,TDA,NDA)) Q:NDA=""  S $P(^A7RLBRY(LBRVSTA,681,TDA,2,NDA,0),U)=DA K ^A7RLBRY(LBRVSTA,681,"D",ODA,TDA,NDA)
"RTN","LBRVCONS",75,0)
 S $P(^XTMP("LBRY",LBRVSTA,"ODA2"),"^",1)=ODA
"RTN","LBRVCONS",76,0)
 G GDA2
"RTN","LBRVCONS",77,0)
STP3 S ODA=$P(^XTMP("LBRY",LBRVSTA,"ODA3"),"^",1)
"RTN","LBRVCONS",78,0)
 D MES^LBRPUTL("I am beginning Step 3....for "_LBRVSTA_" at "_$$HTE^XLFDT($H))
"RTN","LBRVCONS",79,0)
GDA3 S ODA=$O(^A7RLBRY(LBRVSTA,680.7,ODA)) Q:ODA'>0
"RTN","LBRVCONS",80,0)
 I '$D(^A7RLBRY(LBRVSTA,680,"ZL",ODA))&('$D(^A7RLBRY(LBRVSTA,681,"ZL",ODA))) S $P(^XTMP("LBRY",LBRVSTA,"ODA3"),"^",1)=ODA G GDA3
"RTN","LBRVCONS",81,0)
 S $P(^A7RLBRY(LBRVSTA,680.7,ODA,0),U,2)=LBRVNM
"RTN","LBRVCONS",82,0)
 S DINUM=0
"RTN","LBRVCONS",83,0)
GD3RET F  S DINUM=DINUM+1 Q:'$D(^LBRY(680.7,DINUM,0))
"RTN","LBRVCONS",84,0)
 S X=DINUM,DLAYGO=680.7,DIC(0)="L",DIC="^LBRY(680.7,"
"RTN","LBRVCONS",85,0)
 D FILE^DICN S DA=+Y
"RTN","LBRVCONS",86,0)
 I DA=-1 S DINUM=X G GD3RET
"RTN","LBRVCONS",87,0)
 S %X="^A7RLBRY(LBRVSTA,680.7,"_ODA_",",%Y="^LBRY(680.7,"_DA_"," D %XY^%RCR
"RTN","LBRVCONS",88,0)
 S TDA=""
"RTN","LBRVCONS",89,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,680,"ZL",ODA,TDA)) Q:TDA=""  S $P(^A7RLBRY(LBRVSTA,680,TDA,1),U,3)=DA K ^A7RLBRY(LBRVSTA,680,"ZL",ODA,TDA)
"RTN","LBRVCONS",90,0)
 F  S TDA=$O(^A7RLBRY(LBRVSTA,681,"ZL",ODA,TDA)) Q:TDA=""  S $P(^A7RLBRY(LBRVSTA,681,TDA,1),U,2)=DA K ^A7RLBRY(LBRVSTA,681,"ZL",ODA,TDA)
"RTN","LBRVCONS",91,0)
 S $P(^XTMP("LBRY",LBRVSTA,"ODA3"),"^",1)=ODA
"RTN","LBRVCONS",92,0)
 G GDA3
"RTN","LBRVCONS",93,0)
EXIT S LBRYINT=1 D ^LBRVCON1
"RTN","LBRVCONS",94,0)
 K L0,L1,NDA,ODA,TDA,LBRVNM,DIC,DLAYGO,DA,LBRYINT
"RTN","LBRVCONS",95,0)
 K Y,J,LX,DIK,SUB,SRV,SRVN,NUM,I,CODE
"RTN","LBRVCONS",96,0)
 Q
"RTN","LBRVCONV")
0^12^B5732048
"RTN","LBRVCONV",1,0)
LBRVCONV ;SSI/ALA/JSR-Convert data for consolidating ;[ 06/14/2000  3:52 PM ]
"RTN","LBRVCONV",2,0)
 ;;2.5;Library;**2,8**;Mar 31, 2000
"RTN","LBRVCONV",3,0)
 ;
"RTN","LBRVCONV",4,0)
EN D ^LBRVCOND
"RTN","LBRVCONV",5,0)
 I LBRLEGP="PRIMARY" D MES^XPDUTL("*** Sorry Primary Sites can not use this option ***") Q
"RTN","LBRVCONV",6,0)
 Q:FLAG="YES"
"RTN","LBRVCONV",7,0)
COPY ;  Copy data into scratch global
"RTN","LBRVCONV",8,0)
 S DA=0
"RTN","LBRVCONV",9,0)
 F  S DA=$O(^LBRY(680,DA)) Q:'DA  D
"RTN","LBRVCONV",10,0)
 . S DATA=^LBRY(680,DA,0)
"RTN","LBRVCONV",11,0)
 . S LBRWSTN=$P((DATA),"^",4)
"RTN","LBRVCONV",12,0)
 . S LBRTIT=$P((DATA),"^",1)
"RTN","LBRVCONV",13,0)
 . Q:LBRWSTN=""
"RTN","LBRVCONV",14,0)
 . S LBRWSTA=$P(^LBRY(680.6,LBRWSTN,0),"^",7)
"RTN","LBRVCONV",15,0)
 . M ^A7RLBRY(LBRWSTA,680.5,LBRTIT)=^LBRY(680.5,LBRTIT)
"RTN","LBRVCONV",16,0)
 . M ^A7RLBRY(LBRWSTA,680,DA)=^LBRY(680,DA)
"RTN","LBRVCONV",17,0)
 .Q
"RTN","LBRVCONV",18,0)
 D MES^LBRPUTL("File 680 AND 680.5 copied")
"RTN","LBRVCONV",19,0)
 S DA=0
"RTN","LBRVCONV",20,0)
 F  S DA=$O(^LBRY(681,DA)) Q:'DA  D 
"RTN","LBRVCONV",21,0)
 . S LBRWSTN=$P(^LBRY(681,DA,0),"^",4)
"RTN","LBRVCONV",22,0)
 . Q:LBRWSTN=""
"RTN","LBRVCONV",23,0)
 . S LBRWSTA=$P(^LBRY(680.6,LBRWSTN,0),"^",7)
"RTN","LBRVCONV",24,0)
 . M ^A7RLBRY(LBRWSTA,681,DA)=^LBRY(681,DA)
"RTN","LBRVCONV",25,0)
 .Q
"RTN","LBRVCONV",26,0)
 D MES^LBRPUTL("File 681 copied")
"RTN","LBRVCONV",27,0)
 S DA=0
"RTN","LBRVCONV",28,0)
 F  S DA=$O(^LBRY(682,DA)) Q:'DA  D
"RTN","LBRVCONV",29,0)
 . S LBRWSTN=$P(^LBRY(682,DA,0),"^",4)
"RTN","LBRVCONV",30,0)
 . Q:LBRWSTN=""
"RTN","LBRVCONV",31,0)
 . S LBRWSTA=$P(^LBRY(680.6,LBRWSTN,0),"^",7)
"RTN","LBRVCONV",32,0)
 . M ^A7RLBRY(LBRWSTA,682,DA)=^LBRY(682,DA)
"RTN","LBRVCONV",33,0)
 .Q
"RTN","LBRVCONV",34,0)
 D MES^LBRPUTL("File 682 copied")
"RTN","LBRVCONV",35,0)
 S DA=0
"RTN","LBRVCONV",36,0)
 F  S DA=$O(^LBRY(680.4,DA)) Q:'DA  D
"RTN","LBRVCONV",37,0)
 . S LBRWSTN=$P(^LBRY(680.4,DA,0),"^",9)
"RTN","LBRVCONV",38,0)
 . Q:LBRWSTN=""
"RTN","LBRVCONV",39,0)
 . S LBRWSTA=$P(^LBRY(680.6,LBRWSTN,0),"^",7)
"RTN","LBRVCONV",40,0)
 . M ^A7RLBRY(LBRWSTA,680.4,DA)=^LBRY(680.4,DA)
"RTN","LBRVCONV",41,0)
 .Q
"RTN","LBRVCONV",42,0)
 D MES^LBRPUTL("File 680.4 copied")
"RTN","LBRVCONV",43,0)
 S DA=0 F  S DA=$O(^LBRY(680.7,DA)) Q:'DA  D
"RTN","LBRVCONV",44,0)
 . S LBRWSTN=$P(^LBRY(680.7,DA,0),"^",2)
"RTN","LBRVCONV",45,0)
 . Q:LBRWSTN=""
"RTN","LBRVCONV",46,0)
 . S LBRWSTA=$P(^LBRY(680.6,LBRWSTN,0),"^",7)
"RTN","LBRVCONV",47,0)
 . M ^A7RLBRY(LBRWSTA,680.7,DA)=^LBRY(680.7,DA)
"RTN","LBRVCONV",48,0)
 .Q
"RTN","LBRVCONV",49,0)
 D MES^LBRPUTL("File 680.7 copied")
"RTN","LBRVCONV",50,0)
 S LBRWSTA=0
"RTN","LBRVCONV",51,0)
 F  S LBRWSTA=$O(^LBRY(680.6,"C",LBRWSTA)) Q:LBRWSTA=""  D
"RTN","LBRVCONV",52,0)
 . M ^A7RLBRY(LBRWSTA,680.6)=^LBRY(680.6)
"RTN","LBRVCONV",53,0)
 . M ^A7RLBRY(LBRWSTA,680.3)=^LBRY(680.3)
"RTN","LBRVCONV",54,0)
 .Q
"RTN","LBRVCONV",55,0)
 D MES^LBRPUTL("File 680.6 AND 680.3 copied")
"RTN","LBRVCONV",56,0)
 K %X,%Y
"RTN","LBRVCONV",57,0)
PROC ;
"RTN","LBRVCONV",58,0)
 S LBRWSTA=""
"RTN","LBRVCONV",59,0)
 F  S LBRWSTA=$O(^A7RLBRY(LBRWSTA)) Q:LBRWSTA=""  D ^LBRVCONX
"RTN","LBRVCONV",60,0)
 ;
"RTN","LBRVCONV",61,0)
 ;
"RTN","LBRVCONV",62,0)
EXIT ;
"RTN","LBRVCONV",63,0)
 K LDA,VND,SRV,SERV,VEND,USR,USER,ODA,QUIT
"RTN","LBRVCONX")
0^20^B5860705
"RTN","LBRVCONX",1,0)
LBRVCONX ;SSI/ALA/JSR-Convert data for conso Part 2 ;[ 05/02/2000  5:28 PM ]
"RTN","LBRVCONX",2,0)
 ;;2.5;Library;**8**;Mar 11, 2000
"RTN","LBRVCONX",3,0)
 ;
"RTN","LBRVCONX",4,0)
 ;  Convert pointers of other pointed to files that are
"RTN","LBRVCONX",5,0)
 ;  not being moved and convert them to text with a '*'
"RTN","LBRVCONX",6,0)
 ;  includes Service and Vendor pointers.
"RTN","LBRVCONX",7,0)
TF S TDA=0 F I="B","C","D","E","F","H" K ^A7RLBRY(LBRWSTA,680.5,I)
"RTN","LBRVCONX",8,0)
 ;
"RTN","LBRVCONX",9,0)
EN S LDA=0 D MES^LBRPUTL("Converting pointers in File 680.4")
"RTN","LBRVCONX",10,0)
NME S LDA=$O(^A7RLBRY(LBRWSTA,680.4,LDA)) G VN:LDA'>0
"RTN","LBRVCONX",11,0)
 S SRV=$P(^A7RLBRY(LBRWSTA,680.4,LDA,0),U,2)
"RTN","LBRVCONX",12,0)
 I SRV'="",SRV>0 D
"RTN","LBRVCONX",13,0)
 . S DIC(0)="N",DIC="^DIC(49,",X=SRV D ^DIC
"RTN","LBRVCONX",14,0)
 . I +Y>0 S SERV=$P(Y,U,2),$P(^A7RLBRY(LBRWSTA,680.4,LDA,0),U,2)=SERV_"*"
"RTN","LBRVCONX",15,0)
 G NME
"RTN","LBRVCONX",16,0)
 ;
"RTN","LBRVCONX",17,0)
VN ;
"RTN","LBRVCONX",18,0)
 ;
"RTN","LBRVCONX",19,0)
NX S LDA=0 D MES^LBRPUTL("Converting pointers in File 681")
"RTN","LBRVCONX",20,0)
NVN S LDA=$O(^A7RLBRY(LBRWSTA,681,LDA)) G US:LDA'>0
"RTN","LBRVCONX",21,0)
 S USR=$P($G(^A7RLBRY(LBRWSTA,681,LDA,1)),U,3)
"RTN","LBRVCONX",22,0)
 I USR'="",USR>0,$G(^VA(200,USR,0))'="" S USER=$P(^VA(200,USR,0),U),$P(^A7RLBRY(LBRWSTA,681,LDA,1),U,3)=USER_"*"
"RTN","LBRVCONX",23,0)
 G NVN
"RTN","LBRVCONX",24,0)
 ;
"RTN","LBRVCONX",25,0)
US S LDA=0 D MES^LBRPUTL("Converting pointers in File 682")
"RTN","LBRVCONX",26,0)
USR S LDA=$O(^A7RLBRY(LBRWSTA,682,LDA)) G QUIT:LDA'>0
"RTN","LBRVCONX",27,0)
 S USR=$P($G(^A7RLBRY(LBRWSTA,682,LDA,1)),U,6)
"RTN","LBRVCONX",28,0)
 I USR'="",USR>0,$G(^VA(200,USR,0))'="" S USER=$P(^VA(200,USR,0),U)_"*",$P(^A7RLBRY(LBRWSTA,682,LDA,1),U,6)=USER
"RTN","LBRVCONX",29,0)
 ;
"RTN","LBRVCONX",30,0)
 S ODA=0 F  S ODA=$O(^A7RLBRY(LBRWSTA,682,LDA,4,ODA)) Q:ODA'>0  D
"RTN","LBRVCONX",31,0)
 . S USR=$P($G(^A7RLBRY(LBRWSTA,682,LDA,4,ODA,0)),U,4)
"RTN","LBRVCONX",32,0)
 . I USR'="",USR>0,$G(^VA(200,USR,0))'="" S $P(^A7RLBRY(LBRWSTA,682,LDA,4,ODA,0),U,4)=$$GET1^DIQ(200,USR,.01,"E")_"*"
"RTN","LBRVCONX",33,0)
 . S USR=$P($G(^A7RLBRY(LBRWSTA,682,LDA,4,ODA,0)),U,8)
"RTN","LBRVCONX",34,0)
 . I USR'="",USR>0,$G(^VA(200,USR,0))'="" S USER=$P(^VA(200,USR,0),U)_"*",$P(^A7RLBRY(LBRWSTA,682,LDA,4,ODA,0),U,8)=USER
"RTN","LBRVCONX",35,0)
 I USR'="",USR>0,$G(^VA(200,USR,0))'="" S USER=$P(^VA(200,USR,0),U),$P(^A7RLBRY(LBRWSTA,682,LDA,1),U,6)=USER
"RTN","LBRVCONX",36,0)
 G USR
"RTN","LBRVCONX",37,0)
QUIT ;
"RTN","LBRVCONX",38,0)
 M ^A7RLBRY(LBRWSTA,"LBRV",0)=^XTMP("LBRV",0)
"RTN","LBRVCONX",39,0)
 Q
"RTN","LBRVCONX",40,0)
 ;
"RTN","LBRYLTF")
0^29^B3635836
"RTN","LBRYLTF",1,0)
LBRYLTF ;SSI/ALA-CREATE LOCAL SERIAL TITLE TRANSACTION ;[ 04/19/2000  10:36 AM ]
"RTN","LBRYLTF",2,0)
 ;;2.5;Library;**8**;Mar 11, 1996
"RTN","LBRYLTF",3,0)
 ;
"RTN","LBRYLTF",4,0)
 ;  Set up a transaction in the Library Transaction file for upload
"RTN","LBRYLTF",5,0)
 ;  to FORUM
"RTN","LBRYLTF",6,0)
TR ;  Put local serial title into transaction file
"RTN","LBRYLTF",7,0)
 S SRVFLG=1,LBRTYP="LTF" D TRN^LBRYUTL K SRVFLG,LBRTYP
"RTN","LBRYLTF",8,0)
 S FX="0;1^0;5^0;6^3;5^3;8^3;1^3;3^3;4",TX="1;1^1;4^2;1^2;2^3;1^3;3^4;2^4;3"
"RTN","LBRYLTF",9,0)
 F I=1:1:8 S FR=$P(FX,U,I),TO=$P(TX,U,I) D
"RTN","LBRYLTF",10,0)
 . S ND1=$P(FR,";"),PC1=$P(FR,";",2),ND2=$P(TO,";"),PC2=$P(TO,";",2)
"RTN","LBRYLTF",11,0)
 . S $P(^LBRY(682.1,LBRYDA,ND2),U,PC2)=$P($G(^LBRY(680.5,LBRYCLS,ND1)),U,PC1)
"RTN","LBRYLTF",12,0)
 S PF="3;6-680.5^3;7-680.5^3;2-680.1^0;4-680.2^0;3-680.9",PT="2;3^3;2^4;1^4;4^4;5"
"RTN","LBRYLTF",13,0)
 F I=1:1:5 S FR=$P(PF,U,I),TO=$P(PT,U,I) D
"RTN","LBRYLTF",14,0)
 . S PO=$P(FR,"-"),GLB=$P(FR,"-",2)
"RTN","LBRYLTF",15,0)
 . S ND1=$P(PO,";"),PC1=$P(PO,";",2),ND2=$P(TO,";"),PC2=$P(TO,";",2)
"RTN","LBRYLTF",16,0)
 . S TDA=$P($G(^LBRY(680.5,LBRYCLS,ND1)),U,PC1)
"RTN","LBRYLTF",17,0)
 . I TDA'="" S $P(^LBRY(682.1,LBRYDA,ND2),U,PC2)=$S(TDA'["*":$P(^LBRY(GLB,$P($G(^LBRY(680.5,LBRYCLS,ND1)),U,PC1),0),U),1:TDA)
"RTN","LBRYLTF",18,0)
 I $D(^LBRY(680.5,LBRYCLS,1)) S IN=0 F  S IN=$O(^LBRY(680.5,LBRYCLS,1,IN)) Q:IN'>0  D
"RTN","LBRYLTF",19,0)
 . S INP=$P(^LBRY(680.8,^LBRY(680.5,LBRYCLS,1,IN,0),0),U)
"RTN","LBRYLTF",20,0)
 . S ^LBRY(682.1,LBRYDA,6,IN,0)=INP
"RTN","LBRYLTF",21,0)
 I $D(^LBRY(680.5,LBRYCLS,2)) S IN=0 F  S IN=$O(^LBRY(680.5,LBRYCLS,2,IN)) Q:IN'>0  S ^LBRY(682.1,LBRYDA,7,IN,0)=^LBRY(680.5,LBRYCLS,2,IN,0)
"RTN","LBRYLTF",22,0)
 Q
"RTN","LBRYLTF",23,0)
EXIT K FX,TX,FR,TO,ND1,PC1,ND2,PC2,PF,PT,PO,GLB,IN,INP
"RTN","LBRYLTF",24,0)
 Q
"RTN","LBRYPRCS")
0^38^B10586120
"RTN","LBRYPRCS",1,0)
LBRYPRCS ;SSI/ALA-PROCESS LIBRARY TRANSACTIONS ;[ 02/07/01  1:04 PM ]
"RTN","LBRYPRCS",2,0)
 ;;2.5;Library;**2**;Mar 11, 1996
"RTN","LBRYPRCS",3,0)
 ;  This is to automatically process the library transactions
"RTN","LBRYPRCS",4,0)
 ;  received from FORUM
"RTN","LBRYPRCS",5,0)
 S TRN=""
"RTN","LBRYPRCS",6,0)
TR S TRN=$O(^LBRY(682.1,"AC","R",TRN)) G EXIT:TRN=""
"RTN","LBRYPRCS",7,0)
 S TYP=$P(^LBRY(682.1,TRN,0),U,2)
"RTN","LBRYPRCS",8,0)
 F I=1:1:4 S LDATA(I)=$G(^LBRY(682.1,TRN,I))
"RTN","LBRYPRCS",9,0)
 S TAF=$P(LDATA(1),U,2),LDA=$P(LDATA(1),U,3)
"RTN","LBRYPRCS",10,0)
 I TYP="DLT" S:$D(^LBRY(680.5,TAF,0)) $P(^(0),U,2)=2 G TR1
"RTN","LBRYPRCS",11,0)
 I TYP="PPR"!(TYP="CPR") D PP^LBRYPRC1 G TR1
"RTN","LBRYPRCS",12,0)
 I TYP="FRR"!(TYP="CFR") D FR^LBRYPRC1 G TR1
"RTN","LBRYPRCS",13,0)
 I TYP="PUR" D PU^LBRYPRC1 G TR1
"RTN","LBRYPRCS",14,0)
 I TYP="ISR" D IN^LBRYPRC1 G TR1
"RTN","LBRYPRCS",15,0)
 S QFL=0 S:$G(BFL)="" BFL=0 D TI I QFL G TR
"RTN","LBRYPRCS",16,0)
TR1 S DIC="^LBRY(682.1,",DIE=DIC,DA=TRN,DR="2///^S X=""P""" D ^DIE
"RTN","LBRYPRCS",17,0)
 K CHD,FX,TX,ND1,PC1,ND2,PC2,FR,TO,PF,PT,PO,GLB,IN,INP,DR,DIE,DIC,DA
"RTN","LBRYPRCS",18,0)
 K D,D0,X,LBRYCLS,LDATA,LDA,TAF,TYP,QFL,FLG
"RTN","LBRYPRCS",19,0)
 G TR
"RTN","LBRYPRCS",20,0)
TI ;  Update a title from a transaction
"RTN","LBRYPRCS",21,0)
 Q:TAF=""  I LDA'="",$G(^LBRY(680.5,LDA,0))="" Q
"RTN","LBRYPRCS",22,0)
 S TIT=$P(LDATA(1),U)
"RTN","LBRYPRCS",23,0)
 I $D(^LBRY(680.5,TAF,0)),TIT'[$P(^LBRY(680.5,TAF,0),U) D  S QFL=1 Q
"RTN","LBRYPRCS",24,0)
 . S DIC="^LBRY(682.1,",DIE=DIC,DA=TRN,DR="2///^S X=""M""" D ^DIE
"RTN","LBRYPRCS",25,0)
 . I BFL=0 S XMB="LBRYMANL",XMY("G.LBRYUPDT")="",XMDUZ="FORUM LIBRARIANS" D ^XMB K XMY,XMDUZ,XMG S BFL=1
"RTN","LBRYPRCS",26,0)
 I LDA'="" S DA=LDA D ^LBRYX51
"RTN","LBRYPRCS",27,0)
 S LBRYCLS=TAF,$P(^LBRY(680.5,LBRYCLS,0),U)=$P(LDATA(1),U)
"RTN","LBRYPRCS",28,0)
 S FLG=$S(LDA'="":$P(^LBRY(680.5,LDA,0),U,2),TAF'="":$P(^LBRY(680.5,TAF,0),U,2),1:"")
"RTN","LBRYPRCS",29,0)
 ;  Move the data from the transaction into the Title Authority File
"RTN","LBRYPRCS",30,0)
 S TX="0;5^0;6^3;5^3;8^3;1^3;3^3;4",FX="1;4^2;1^2;2^3;1^3;3^4;2^4;3"
"RTN","LBRYPRCS",31,0)
 F I=1:1:7 S FR=$P(FX,U,I),TO=$P(TX,U,I) D
"RTN","LBRYPRCS",32,0)
 . S ND1=$P(FR,";"),PC1=$P(FR,";",2),ND2=$P(TO,";"),PC2=$P(TO,";",2)
"RTN","LBRYPRCS",33,0)
 . S $P(^LBRY(680.5,LBRYCLS,ND2),U,PC2)=$P($G(^LBRY(682.1,TRN,ND1)),U,PC1)
"RTN","LBRYPRCS",34,0)
 S PF="2;3-680.5^3;2-680.5^4;1-680.1^4;4-680.2^4;5-680.9",PT="3;6^3;7^3;2^0;4^0;3"
"RTN","LBRYPRCS",35,0)
 F I=1:1:5 S FR=$P(PF,U,I),TO=$P(PT,U,I) D
"RTN","LBRYPRCS",36,0)
 . S PO=$P(FR,"-"),GLB=$P(FR,"-",2)
"RTN","LBRYPRCS",37,0)
 . S ND1=$P(PO,";"),PC1=$P(PO,";",2),ND2=$P(TO,";"),PC2=$P(TO,";",2)
"RTN","LBRYPRCS",38,0)
 . S CH=$P($G(^LBRY(682.1,TRN,ND1)),U,PC1),CHD=CH
"RTN","LBRYPRCS",39,0)
 . I CH'="" S J="" F  S J=$O(^LBRY(GLB,"B",$E(CH,1,30),J)) Q:J'>0  S:$P($G(^LBRY(GLB,J,0)),U)=CH CHD=J
"RTN","LBRYPRCS",40,0)
 . S $P(^LBRY(680.5,LBRYCLS,ND2),U,PC2)=CHD
"RTN","LBRYPRCS",41,0)
 I $D(^LBRY(682.1,TRN,6)) S IN=0 F  S IN=$O(^LBRY(682.1,TRN,6,IN)) Q:IN'>0  D
"RTN","LBRYPRCS",42,0)
 . S INP=^LBRY(682.1,TRN,6,IN,0)
"RTN","LBRYPRCS",43,0)
 . S ^LBRY(680.5,LBRYCLS,1,IN,0)=$S($D(^LBRY(680.8,"B",INP)):$O(^LBRY(680.8,"B",INP,"")),1:INP)
"RTN","LBRYPRCS",44,0)
 . S ^LBRY(680.5,LBRYCLS,1,0)="^680.53PA^"_IN_U_IN
"RTN","LBRYPRCS",45,0)
CK I TYP="TIR",('$D(^LBRY(682.1,TRN,7))) D
"RTN","LBRYPRCS",46,0)
 . S DA=LBRYCLS,DIE="^LBRY(680.5,",DR="4///@"
"RTN","LBRYPRCS",47,0)
 . D ^DIE
"RTN","LBRYPRCS",48,0)
 I $D(^LBRY(682.1,TRN,7)) S IN=0 F  S IN=$O(^LBRY(682.1,TRN,7,IN)) Q:IN'>0  D
"RTN","LBRYPRCS",49,0)
 . S ^LBRY(680.5,LBRYCLS,2,IN,0)=^LBRY(682.1,TRN,7,IN,0)
"RTN","LBRYPRCS",50,0)
 . S ^LBRY(680.5,LBRYCLS,2,0)="^680.54^"_IN_U_IN_U_DT
"RTN","LBRYPRCS",51,0)
 S $P(^LBRY(680.5,LBRYCLS,0),U,5)="N",$P(^(0),U,2)=FLG
"RTN","LBRYPRCS",52,0)
 I $F("CTI,TIC,LTR",TYP) S DA=LDA,DIK="^LBRY(680.5," D ^DIK
"RTN","LBRYPRCS",53,0)
 S DA=LBRYCLS D ^LBRYX53
"RTN","LBRYPRCS",54,0)
 I LDA'="" S LBRTDA="" D
"RTN","LBRYPRCS",55,0)
 . F  S LBRTDA=$O(^LBRY(680,"B",LDA,LBRTDA)) Q:LBRTDA=""  D
"RTN","LBRYPRCS",56,0)
 . . S DR=".01///^S X=TAF",DIC="^LBRY(680,",DIE=DIC,DA=LBRTDA D ^DIE
"RTN","LBRYPRCS",57,0)
 Q
"RTN","LBRYPRCS",58,0)
EXIT K CHD,FX,TX,ND1,PC1,ND2,PC2,FR,TO,PF,PT,PO,GLB,IN,INP,DR,DIE,DIC,DA
"RTN","LBRYPRCS",59,0)
 K D,D0,X,LBRYCLS,LDATA,LDA,TAF,TRN,QFL,FLG,BFL
"RTN","LBRYPRCS",60,0)
 S $P(^LBRY(680.5,0),U,3)=99000
"RTN","LBRYPRCS",61,0)
 Q
"RTN","LBRYRTX")
0^31^B12359855
"RTN","LBRYRTX",1,0)
LBRYRTX ;ISC2/DJM-ROUTINES USED IN FILE 682 ;[ 07/06/00  2:18 PM ]
"RTN","LBRYRTX",2,0)
 ;;2.5;Library;**2,8**;Mar 11, 1996
"RTN","LBRYRTX",3,0)
 K LBRYPTR Q
"RTN","LBRYRTX",4,0)
I ;ENTERED FROM JOURNAL DATE SET STATEMENT OF X-REF AD
"RTN","LBRYRTX",5,0)
 Q:($G(DIC)'[682)
"RTN","LBRYRTX",6,0)
 I $D(^LBRY(682,DA,1))#2,$P(^(1),U,6)]"" Q
"RTN","LBRYRTX",7,0)
 S LDFX=$P(^LBRY(682,DA,0),U,2),LBRYX=X
"RTN","LBRYRTX",8,0)
COPY ;MOVE COPIES FROM FILE 681 INTO FILE 682 AT THE COPY OF ISSUE
"RTN","LBRYRTX",9,0)
 ;MULTIPLE AND SET ROUTING STATUS TO 4 OR 5.
"RTN","LBRYRTX",10,0)
 S (COPY,TOTAL,CO682)=0
"RTN","LBRYRTX",11,0)
 F  S COPY=$O(^LBRY(681,"AC",LDFX,COPY)) G:COPY="" EXIT S COPY1=0 D COPY1
"RTN","LBRYRTX",12,0)
COPY1 S COPY1=$O(^LBRY(681,"AC",LDFX,COPY,COPY1)) Q:COPY1=""
"RTN","LBRYRTX",13,0)
 S COPY2=^LBRY(681,COPY1,1),START=$P(COPY2,U,10),STOP=$P(COPY2,U,11)
"RTN","LBRYRTX",14,0)
 I START="",STOP="" D TRANS G COPY1
"RTN","LBRYRTX",15,0)
 I START]"",STOP="",START-X<1 D TRANS G COPY1
"RTN","LBRYRTX",16,0)
 I START="",STOP]"",STOP-X'<0 D TRANS G COPY1
"RTN","LBRYRTX",17,0)
 I START]"",STOP]"" I START-X<1&(STOP-X'<0) D TRANS G COPY1
"RTN","LBRYRTX",18,0)
 G COPY1
"RTN","LBRYRTX",19,0)
TRANS S TOTAL=TOTAL+1,CO682=CO682+1,COPYNO=$E($P(COPY2,U),1,30)
"RTN","LBRYRTX",20,0)
 S ^LBRY(682,DA,4,TOTAL,0)=COPYNO_"^4^"_COPY1,^LBRY(682,DA,4,"B",COPYNO,TOTAL)=""
"RTN","LBRYRTX",21,0)
 I COPYNO="ToC" S $P(^LBRY(682,DA,4,TOTAL,0),U,2)=5,CO682=CO682-1 S:CO682<0 CO682=0
"RTN","LBRYRTX",22,0)
 Q
"RTN","LBRYRTX",23,0)
EXIT I TOTAL>0 S ENTRY=$P(^DD(682,4,0),U,2),^LBRY(682,DA,4,0)="^"_ENTRY_"^"_TOTAL_"^"_TOTAL
"RTN","LBRYRTX",24,0)
 S $P(^LBRY(682,DA,1),U,6)=DUZ S:CO682=0 CO682="" S $P(^LBRY(682,DA,1),U,5)=CO682
"RTN","LBRYRTX",25,0)
EXIT1 K COPY,COPY1,COPY2,COPYNO,ENTRY,LBX,LDFX,START,STOP,TOC,TOC1,TOTAL,XX1,XXZ
"RTN","LBRYRTX",26,0)
 Q
"RTN","LBRYRTX",27,0)
NOCS ;ISSUE ROUTING STATUS SET OF X-REF AD IN MULTIPLE 682.04,1
"RTN","LBRYRTX",28,0)
 ;
"RTN","LBRYRTX",29,0)
 ;  Q:'$D(LBRYPTR) exists to prevent the setting of the field
"RTN","LBRYRTX",30,0)
 ;  when executing Reindex from FileMan.
"RTN","LBRYRTX",31,0)
 Q:'$D(LBRYPTR)
"RTN","LBRYRTX",32,0)
 ;
"RTN","LBRYRTX",33,0)
 ;  Q:$G(LBRYINT)=1 exists to prevent the setting of the field
"RTN","LBRYRTX",34,0)
 ;  when integrating sites.
"RTN","LBRYRTX",35,0)
 Q:$G(LBRYINT)=1
"RTN","LBRYRTX",36,0)
 ;
"RTN","LBRYRTX",37,0)
 I $P(^LBRY(682,DA(1),4,DA,0),U)'="ToC" S XXZ=^LBRY(682,DA(1),1),XX1=$P(XXZ,U,4) I X<4 S XX1=XX1+1,$P(^LBRY(682,DA(1),1),U,4)=XX1 G DAS
"RTN","LBRYRTX",38,0)
 I $P(^LBRY(682,DA(1),4,DA,0),U)'="ToC" I XX1="" S TOC=$O(^LBRY(682,DA(1),4,"B","ToC",0)) D:TOC'="" TOCRMV
"RTN","LBRYRTX",39,0)
 G DAS
"RTN","LBRYRTX",40,0)
NOCD ;ISSUE ROUTING STATUS KILL OF X-REF AD IN MULTIPLE 682.04,1
"RTN","LBRYRTX",41,0)
 ;
"RTN","LBRYRTX",42,0)
 ;  Q:'$D(LBRYPTR) exists to prevent the subtracting of the field
"RTN","LBRYRTX",43,0)
 ;  when executing Reindex from FileMan.
"RTN","LBRYRTX",44,0)
 Q:'$D(LBRYPTR)
"RTN","LBRYRTX",45,0)
 ;
"RTN","LBRYRTX",46,0)
 ;  Q:$G(LBRYINT)=1 exists to prevent the subtracting of the field
"RTN","LBRYRTX",47,0)
 ;  when integrating sites.
"RTN","LBRYRTX",48,0)
 Q:$G(LBRYINT)=1
"RTN","LBRYRTX",49,0)
 ;
"RTN","LBRYRTX",50,0)
 I $P(^LBRY(682,DA(1),4,DA,0),U)'="ToC" I X<4 S XXZ=^LBRY(682,DA(1),1),XX1=$P(XXZ,U,4),XX1=XX1-1 S:XX1<1 XX1="" S $P(XXZ,U,4)=XX1 S:XX1="" $P(XXZ,U,7)="" S ^LBRY(682,DA(1),1)=XXZ
"RTN","LBRYRTX",51,0)
 G DAK
"RTN","LBRYRTX",52,0)
TOCRMV S TOC1=^LBRY(682,DA(1),4,TOC,0),$P(TOC1,U,2)=5,TOC1=$P(TOC1,U,1,3)
"RTN","LBRYRTX",53,0)
 S ^LBRY(682,DA(1),4,TOC,0)=TOC1 K ^LBRY(682,"A2",DA(1),TOC)
"RTN","LBRYRTX",54,0)
 Q
"RTN","LBRYRTX",55,0)
DAS I X<4 S $P(^LBRY(682,DA(1),4,DA,0),U,8)=DUZ,LBX=X D
"RTN","LBRYRTX",56,0)
 . S LDATE=$P(^LBRY(682,DA(1),4,DA,0),U,7) S:LDATE="" LDATE=DT
"RTN","LBRYRTX",57,0)
 G EXIT1
"RTN","LBRYRTX",58,0)
DAK S XX=$P(^LBRY(682,DA(1),4,DA,0),U,7),$P(^(0),U,7)="",$P(^(0),U,8)="",$P(^(0),U,6)=""
"RTN","LBRYRTX",59,0)
 I XX]""&($P($G(^LBRY(682,DA(1),0)),U,2)'="") K ^LBRY(682,"A4",XX,$P(^LBRY(682,DA(1),0),U,2),DA(1),DA)
"RTN","LBRYRTX",60,0)
 G EXIT1
"RTN","LBRYRTX",61,0)
CNO ;INPUT TRANSFORM FROM 689.04 FIELD .02
"RTN","LBRYRTX",62,0)
 Q
"RTN","LBRYRTX",63,0)
 I $P(^LBRY(682,DA(1),0),U,2)=$P(^(0),U,2) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"RTN","LBRYRTX",64,0)
 Q
"RTN","LBRYRTX",65,0)
A4 ;SET/KILL FOR "A4" CROSS-REFERENCE FOR CHANGE IN .02 FIELD
"RTN","LBRYRTX",66,0)
 N LBRCOPN,LBRDA1
"RTN","LBRYRTX",67,0)
 S LBRCOPN=0
"RTN","LBRYRTX",68,0)
A4LP1 S LBRCOPN=$O(^LBRY(682,DA,4,"B",LBRCOPN)) Q:LBRCOPN=""
"RTN","LBRYRTX",69,0)
 S LBRDA1=0
"RTN","LBRYRTX",70,0)
A4LP2 S LBRDA1=$O(^LBRY(682,DA,4,"B",LBRCOPN,LBRDA1)) G A4LP1:LBRDA1=""
"RTN","LBRYRTX",71,0)
 I LBRTYPE="SET",$P($G(^LBRY(682,DA,4,LBRDA1,0)),U,7)'="" S ^LBRY(682,"A4",$P(^LBRY(682,DA,4,LBRDA1,0),U,7),$E(X,1,30),DA,LBRDA1)=""
"RTN","LBRYRTX",72,0)
 I LBRTYPE="KILL",$P($G(^LBRY(682,DA,4,LBRDA1,0)),U,7)'="" K ^LBRY(682,"A4",$P(^LBRY(682,DA,4,LBRDA1,0),U,7),$E(X,1,30),DA,LBRDA1)
"RTN","LBRYRTX",73,0)
 G A4LP2
"RTN","LBRYSEND")
0^28^B4548180
"RTN","LBRYSEND",1,0)
LBRYSEND ;SSI/ALA-SEND TRANSACTIONS TO FORUM ;[ 04/19/2000  10:44 AM ]
"RTN","LBRYSEND",2,0)
 ;;2.5;LIBRARY;**8**;Mar 11, 1996
"RTN","LBRYSEND",3,0)
 ;
"RTN","LBRYSEND",4,0)
 K ^TMP("LBRY")
"RTN","LBRYSEND",5,0)
 S STN=$P(^DIC(4,$P(^XMB(1,1,"XUS"),U,17),99),U),REF="           "
"RTN","LBRYSEND",6,0)
 ;
"RTN","LBRYSEND",7,0)
 S N=""
"RTN","LBRYSEND",8,0)
 F  S N=$O(^LBRY(682.1,"AC","W",N)) Q:N=""  D
"RTN","LBRYSEND",9,0)
 . S LBRYTYP=$$GET1^DIQ(682.1,N,1,"E")
"RTN","LBRYSEND",10,0)
 . D CR
"RTN","LBRYSEND",11,0)
 K N,IN,J,M,NUM,REF,STN,JDT,JTM
"RTN","LBRYSEND",12,0)
 Q
"RTN","LBRYSEND",13,0)
 ;
"RTN","LBRYSEND",14,0)
CR ; Create UTILITY global for transaction
"RTN","LBRYSEND",15,0)
 S JDTM=$$NOW^XLFDT(),NUM=10000
"RTN","LBRYSEND",16,0)
 S JDT=$$JDN^LBRYUTL($P(JDTM,".")),JTM=$P(JDTM,".",2) K JDTM
"RTN","LBRYSEND",17,0)
 S ^TMP("LBRY",NUM,0)="LIB^"_STN_"^^"_LBRYTYP_U_JDT_U_JTM_U_REF_"^001^001^001^|"
"RTN","LBRYSEND",18,0)
 ;
"RTN","LBRYSEND",19,0)
 ;  If LTF
"RTN","LBRYSEND",20,0)
 I LBRYTYP="LTF" D
"RTN","LBRYSEND",21,0)
 . S M=0 D NN
"RTN","LBRYSEND",22,0)
 ;
"RTN","LBRYSEND",23,0)
 Q
"RTN","LBRYSEND",24,0)
 ;
"RTN","LBRYSEND",25,0)
NN S M=$O(^LBRY(682.1,N,M))
"RTN","LBRYSEND",26,0)
 I M'>0 S NUM=NUM+1,^TMP("LBRY",NUM,0)="$",XMSUB="LOCAL SERIAL TITLE REQUEST" D XM Q
"RTN","LBRYSEND",27,0)
 I M<6,$G(^LBRY(682.1,N,M))'="" D
"RTN","LBRYSEND",28,0)
 . S IN=$S(M=1:"TI",1:"T"_M)
"RTN","LBRYSEND",29,0)
 . S NUM=NUM+1,^TMP("LBRY",NUM,0)=IN_U_^LBRY(682.1,N,M)
"RTN","LBRYSEND",30,0)
 . I M=1 S $P(^TMP("LBRY",NUM,0),U,6,7)=N
"RTN","LBRYSEND",31,0)
 I M=6,$D(^LBRY(682.1,N,M))'=0 D
"RTN","LBRYSEND",32,0)
 . S IN="T5",J=0 F  S J=$O(^LBRY(682.1,N,M,J)) Q:J'>0  S NUM=NUM+1,^TMP("LBRY",NUM,0)=IN_U_J_U_^LBRY(682.1,N,M,J,0)
"RTN","LBRYSEND",33,0)
 I M=7,$D(^LBRY(682.1,N,M))'=0 D
"RTN","LBRYSEND",34,0)
 . S IN="T6",J=0 F  S J=$O(^LBRY(682.1,N,M,J)) Q:J=""  S NUM=NUM+1,^TMP("LBRY",NUM,0)=IN_U_J_U_^LBRY(682.1,N,M,J,0)
"RTN","LBRYSEND",35,0)
 G NN
"RTN","LBRYSEND",36,0)
 ;
"RTN","LBRYSEND",37,0)
XM ; Take all transactions waiting for transmission and pass
"RTN","LBRYSEND",38,0)
 ; them to MailMan for transmission to FORUM
"RTN","LBRYSEND",39,0)
 S TRNSM=$S($G(^XMB("NETNAME"))["SENTIENT":"VISTA.SENTIENTCONSULT.COM",1:"FORUM.VA.GOV")
"RTN","LBRYSEND",40,0)
 S XMDUZ=^XMB("NETNAME"),XMY("S.LBRYFSRV@"_TRNSM)=""
"RTN","LBRYSEND",41,0)
 S XMTEXT="^TMP(""LBRY"","
"RTN","LBRYSEND",42,0)
 D ^XMD
"RTN","LBRYSEND",43,0)
 S DIC="^LBRY(682.1,",DIE=DIC,DA=N,DR="2///^S X=""T""" D ^DIE
"RTN","LBRYSEND",44,0)
 K ^TMP("LBRY"),TRNSM
"RTN","LBRYSEND",45,0)
 Q
"RTN","LBRYSRV1")
0^37^B3804827
"RTN","LBRYSRV1",1,0)
LBRYSRV1 ;SSI/ALA-LIBRARY SERVER PROGRAM ;[ 04/19/2000  10:46 AM ]
"RTN","LBRYSRV1",2,0)
 ;;2.5;LIBRARY;**8**;Mar 11, 1996
"RTN","LBRYSRV1",3,0)
 ;
"RTN","LBRYSRV1",4,0)
IN ;  Put index sources information into transaction file
"RTN","LBRYSRV1",5,0)
 X XMREC I $P(XMRG,U)="$" Q
"RTN","LBRYSRV1",6,0)
 Q:$P(XMRG,U)'="IS"
"RTN","LBRYSRV1",7,0)
 D TRN^LBRYUTL
"RTN","LBRYSRV1",8,0)
 S NL=$P(XMRG,U,2),^LBRY(682.1,LBRYDA,6,NL,0)=$P(XMRG,U,4,6)
"RTN","LBRYSRV1",9,0)
 S TAF=$P(XMRG,U,3),$P(^LBRY(682.1,LBRYDA,1),U,2)=TAF,TIT=$P(XMRG,U,4)
"RTN","LBRYSRV1",10,0)
 G IN
"RTN","LBRYSRV1",11,0)
 ;
"RTN","LBRYSRV1",12,0)
PU ;  Put publisher records into transaction file
"RTN","LBRYSRV1",13,0)
 X XMREC I $P(XMRG,U)="$" Q
"RTN","LBRYSRV1",14,0)
 Q:$P(XMRG,U)'="PU"
"RTN","LBRYSRV1",15,0)
 D TRN^LBRYUTL
"RTN","LBRYSRV1",16,0)
 S TAF=$P(XMRG,U,3),TIT=$P(XMRG,U,4),IDA=$P(XMRG,U,5)
"RTN","LBRYSRV1",17,0)
 S $P(^LBRY(682.1,LBRYDA,1),U,2)=TAF,$P(^(1),U,3)=IDA,$P(^LBRY(682.1,LBRYDA,4),U)=TIT
"RTN","LBRYSRV1",18,0)
 G PU
"RTN","LBRYSRV1",19,0)
 ;
"RTN","LBRYSRV1",20,0)
FR ;  Put frequencies into transaction file
"RTN","LBRYSRV1",21,0)
 X XMREC I $P(XMRG,U)="$" Q
"RTN","LBRYSRV1",22,0)
 Q:$P(XMRG,U)'="FR"
"RTN","LBRYSRV1",23,0)
 D TRN^LBRYUTL
"RTN","LBRYSRV1",24,0)
 S TAF=$P(XMRG,U,3),IDA=$P(XMRG,U,6)
"RTN","LBRYSRV1",25,0)
 S $P(^LBRY(682.1,LBRYDA,1),U,2)=TAF,$P(^(1),U,3)=IDA
"RTN","LBRYSRV1",26,0)
 S $P(^LBRY(682.1,LBRYDA,2),U)=$P(XMRG,U,4)
"RTN","LBRYSRV1",27,0)
 S $P(^LBRY(682.1,LBRYDA,4),U,4)=$P(XMRG,U,5),TIT=$P(XMRG,U,5)
"RTN","LBRYSRV1",28,0)
 G FR
"RTN","LBRYSRV1",29,0)
 ;
"RTN","LBRYSRV1",30,0)
PR ;  Put prediction patterns into transaction file
"RTN","LBRYSRV1",31,0)
 S LEV=""
"RTN","LBRYSRV1",32,0)
PR1 X XMREC I $P(XMRG,U)="$" Q
"RTN","LBRYSRV1",33,0)
 S SEQ=$P(XMRG,U,2)
"RTN","LBRYSRV1",34,0)
 I LEV'=SEQ D TRN^LBRYUTL S LEV=SEQ
"RTN","LBRYSRV1",35,0)
 I $P(XMRG,U)="PP" D
"RTN","LBRYSRV1",36,0)
 . S TAF=$P(XMRG,U,3),$P(^LBRY(682.1,LBRYDA,1),U,2)=TAF
"RTN","LBRYSRV1",37,0)
 . S ^LBRY(682.1,LBRYDA,5)=$P(XMRG,U,5,11)
"RTN","LBRYSRV1",38,0)
 . S TIT=$P(XMRG,U,4),$P(^LBRY(682.1,LBRYDA,4),U,5)=TIT
"RTN","LBRYSRV1",39,0)
 I $P(XMRG,U)="PP2" D
"RTN","LBRYSRV1",40,0)
 . S $P(^LBRY(682.1,LBRYDA,5),U,8)=$P(XMRG,U,3)
"RTN","LBRYSRV1",41,0)
 . S $P(^LBRY(682.1,LBRYDA,4),U,6)=$P(XMRG,U,4)
"RTN","LBRYSRV1",42,0)
 . S TIT=$P(XMRG,U,4)_"  "_TIT,$P(^LBRY(682.1,LBRYDA,1),U,3)=$P(XMRG,U,5)
"RTN","LBRYSRV1",43,0)
 I $P(XMRG,U)="PP3" D
"RTN","LBRYSRV1",44,0)
 . S NL=$P(XMRG,U,3),TEX=$P(XMRG,U,4),^LBRY(682.1,LBRYDA,8,NL,0)=TEX
"RTN","LBRYSRV1",45,0)
 G PR1
"VER")
8.0^22
"^DD",682.1,682.1,33,0)
DATE/TIME CREATED^D^^0;6^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",682.1,682.1,33,21,0)
^.001^2^2^3010119^^^
"^DD",682.1,682.1,33,21,1,0)
This field stores the date the transaction was created or received,
"^DD",682.1,682.1,33,21,2,0)
then transmitted or processed.
"^DD",682.1,682.1,33,"DT")
3000104
**END**
**END**
