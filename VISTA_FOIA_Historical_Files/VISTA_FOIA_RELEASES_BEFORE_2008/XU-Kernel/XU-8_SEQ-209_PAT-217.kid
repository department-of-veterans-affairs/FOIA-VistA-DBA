Released XU*8*217 SEQ #209
Extracted from mail message
**KIDS**:XU*8.0*217^

**INSTALL NAME**
XU*8.0*217
"BLD",2196,0)
XU*8.0*217^KERNEL^0^3020913^y
"BLD",2196,1,0)
^^4^4^3020820^^
"BLD",2196,1,1,0)
Institution file & Reasonable Charges project
"BLD",2196,1,2,0)
 
"BLD",2196,1,3,0)
Refer to patch XU*8*217 in the FORUM Patch Module for a complete
"BLD",2196,1,4,0)
description.
"BLD",2196,4,0)
^9.64PA^4^1
"BLD",2196,4,4,0)
4
"BLD",2196,4,4,222)
y^n^f^^^^n
"BLD",2196,4,"B",4,4)

"BLD",2196,"ABPKG")
n
"BLD",2196,"INIT")
MAIN^XUMF4L0
"BLD",2196,"KRN",0)
^9.67PA^19^17
"BLD",2196,"KRN",.4,0)
.4
"BLD",2196,"KRN",.401,0)
.401
"BLD",2196,"KRN",.402,0)
.402
"BLD",2196,"KRN",.403,0)
.403
"BLD",2196,"KRN",.5,0)
.5
"BLD",2196,"KRN",.84,0)
.84
"BLD",2196,"KRN",3.6,0)
3.6
"BLD",2196,"KRN",3.6,"NM",0)
^9.68A^1^1
"BLD",2196,"KRN",3.6,"NM",1,0)
XUMF INSTITUTION^^0
"BLD",2196,"KRN",3.6,"NM","B","XUMF INSTITUTION",1)

"BLD",2196,"KRN",3.8,0)
3.8
"BLD",2196,"KRN",9.2,0)
9.2
"BLD",2196,"KRN",9.8,0)
9.8
"BLD",2196,"KRN",9.8,"NM",0)
^9.68A^14^14
"BLD",2196,"KRN",9.8,"NM",1,0)
XUMFP4^^0^B31046710
"BLD",2196,"KRN",9.8,"NM",2,0)
XUMFP4C^^0^B30888694
"BLD",2196,"KRN",9.8,"NM",3,0)
XUMFI^^0^B82497778
"BLD",2196,"KRN",9.8,"NM",4,0)
XUMFH^^0^B61429660
"BLD",2196,"KRN",9.8,"NM",5,0)
XUMFH4^^0^B43861524
"BLD",2196,"KRN",9.8,"NM",6,0)
XUMFEIMF^^0^B8103470
"BLD",2196,"KRN",9.8,"NM",7,0)
XUMFP^^0^B15340290
"BLD",2196,"KRN",9.8,"NM",8,0)
XUAF4^^0^B29369621
"BLD",2196,"KRN",9.8,"NM",9,0)
XUMF4L0^^0^B30984085
"BLD",2196,"KRN",9.8,"NM",10,0)
XUMF4L1^^0^B34238171
"BLD",2196,"KRN",9.8,"NM",11,0)
XUMF4L2^^0^B21865279
"BLD",2196,"KRN",9.8,"NM",12,0)
XUMFMFI^^0^B2674492
"BLD",2196,"KRN",9.8,"NM",13,0)
XUMFMFE^^0^B2003306
"BLD",2196,"KRN",9.8,"NM",14,0)
XUMFPFT^^0^B18221668
"BLD",2196,"KRN",9.8,"NM","B","XUAF4",8)

"BLD",2196,"KRN",9.8,"NM","B","XUMF4L0",9)

"BLD",2196,"KRN",9.8,"NM","B","XUMF4L1",10)

"BLD",2196,"KRN",9.8,"NM","B","XUMF4L2",11)

"BLD",2196,"KRN",9.8,"NM","B","XUMFEIMF",6)

"BLD",2196,"KRN",9.8,"NM","B","XUMFH",4)

"BLD",2196,"KRN",9.8,"NM","B","XUMFH4",5)

"BLD",2196,"KRN",9.8,"NM","B","XUMFI",3)

"BLD",2196,"KRN",9.8,"NM","B","XUMFMFE",13)

"BLD",2196,"KRN",9.8,"NM","B","XUMFMFI",12)

"BLD",2196,"KRN",9.8,"NM","B","XUMFP",7)

"BLD",2196,"KRN",9.8,"NM","B","XUMFP4",1)

"BLD",2196,"KRN",9.8,"NM","B","XUMFP4C",2)

"BLD",2196,"KRN",9.8,"NM","B","XUMFPFT",14)

"BLD",2196,"KRN",19,0)
19
"BLD",2196,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",2196,"KRN",19,"NM",1,0)
XUMF IMF ADD EDIT^^0
"BLD",2196,"KRN",19,"NM",2,0)
XUKERNEL^^2
"BLD",2196,"KRN",19,"NM","B","XUKERNEL",2)

"BLD",2196,"KRN",19,"NM","B","XUMF IMF ADD EDIT",1)

"BLD",2196,"KRN",19.1,0)
19.1
"BLD",2196,"KRN",101,0)
101
"BLD",2196,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",2196,"KRN",101,"NM",1,0)
XUMF IMF MFK^^0
"BLD",2196,"KRN",101,"NM",2,0)
XUMF IMF MFN^^0
"BLD",2196,"KRN",101,"NM","B","XUMF IMF MFK",1)

"BLD",2196,"KRN",101,"NM","B","XUMF IMF MFN",2)

"BLD",2196,"KRN",409.61,0)
409.61
"BLD",2196,"KRN",771,0)
771
"BLD",2196,"KRN",771,"NM",0)
^9.68A^6^6
"BLD",2196,"KRN",771,"NM",1,0)
XUMF MFN^^0
"BLD",2196,"KRN",771,"NM",2,0)
XUMF MFK^^0
"BLD",2196,"KRN",771,"NM",3,0)
XUMF MFQ^^0
"BLD",2196,"KRN",771,"NM",4,0)
XUMF MFR^^0
"BLD",2196,"KRN",771,"NM",5,0)
XUMF IMF MFK^^0
"BLD",2196,"KRN",771,"NM",6,0)
XUMF IMF MFN^^0
"BLD",2196,"KRN",771,"NM","B","XUMF IMF MFK",5)

"BLD",2196,"KRN",771,"NM","B","XUMF IMF MFN",6)

"BLD",2196,"KRN",771,"NM","B","XUMF MFK",2)

"BLD",2196,"KRN",771,"NM","B","XUMF MFN",1)

"BLD",2196,"KRN",771,"NM","B","XUMF MFQ",3)

"BLD",2196,"KRN",771,"NM","B","XUMF MFR",4)

"BLD",2196,"KRN",870,0)
870
"BLD",2196,"KRN",8994,0)
8994
"BLD",2196,"KRN","B",.4,.4)

"BLD",2196,"KRN","B",.401,.401)

"BLD",2196,"KRN","B",.402,.402)

"BLD",2196,"KRN","B",.403,.403)

"BLD",2196,"KRN","B",.5,.5)

"BLD",2196,"KRN","B",.84,.84)

"BLD",2196,"KRN","B",3.6,3.6)

"BLD",2196,"KRN","B",3.8,3.8)

"BLD",2196,"KRN","B",9.2,9.2)

"BLD",2196,"KRN","B",9.8,9.8)

"BLD",2196,"KRN","B",19,19)

"BLD",2196,"KRN","B",19.1,19.1)

"BLD",2196,"KRN","B",101,101)

"BLD",2196,"KRN","B",409.61,409.61)

"BLD",2196,"KRN","B",771,771)

"BLD",2196,"KRN","B",870,870)

"BLD",2196,"KRN","B",8994,8994)

"BLD",2196,"QUES",0)
^9.62^^
"BLD",2196,"REQB",0)
^9.611^2^2
"BLD",2196,"REQB",1,0)
XU*8.0*206^2
"BLD",2196,"REQB",2,0)
XU*8.0*209^2
"BLD",2196,"REQB","B","XU*8.0*206",1)

"BLD",2196,"REQB","B","XU*8.0*209",2)

"FIA",4)
INSTITUTION
"FIA",4,0)
^DIC(4,
"FIA",4,0,0)
4I
"FIA",4,0,1)
y^n^f^^^^n
"FIA",4,0,10)

"FIA",4,0,11)

"FIA",4,0,"RLRO")

"FIA",4,0,"VR")
8.0^XU
"FIA",4,4)
0
"FIA",4,4.014)
0
"FIA",4,4.03)
0
"FIA",4,4.999)
0
"INIT")
MAIN^XUMF4L0
"KRN",3.6,177,-1)
0^1
"KRN",3.6,177,0)
XUMF INSTITUTION^Master File Server - update notification - INSTITUTION file
"KRN",3.6,177,1,0)
^3.61A^47^47^3020729^^
"KRN",3.6,177,1,1,0)
The following Master File Notification (MFN) message was
"KRN",3.6,177,1,2,0)
received and processed by the Master File Server:
"KRN",3.6,177,1,3,0)
 
"KRN",3.6,177,1,4,0)
  HL7 Message ID:  |1|
"KRN",3.6,177,1,5,0)
  
"KRN",3.6,177,1,6,0)
The following INSTITUTION (#4) file entry has been |2|:
"KRN",3.6,177,1,7,0)
 
"KRN",3.6,177,1,8,0)
  IEN: |3|   STATION NUMBER: |4|
"KRN",3.6,177,1,9,0)
 
"KRN",3.6,177,1,10,0)
  UPDATED ENTRY
"KRN",3.6,177,1,11,0)
  -------------
"KRN",3.6,177,1,12,0)
  NAME: |5|
"KRN",3.6,177,1,13,0)
  OFFICIAL VA NAME: |6|
"KRN",3.6,177,1,14,0)
  FACILITY TYPE: |7|
"KRN",3.6,177,1,15,0)
  INACTIVE FACILITY FLAG: |11|
"KRN",3.6,177,1,16,0)
  VISN: |13|
"KRN",3.6,177,1,17,0)
  PARENT FACILITY: |14|
"KRN",3.6,177,1,18,0)
  
"KRN",3.6,177,1,19,0)
  STREET ADDR. 1: |19|
"KRN",3.6,177,1,20,0)
  CITY: |20|
"KRN",3.6,177,1,21,0)
  STATE: |12|
"KRN",3.6,177,1,22,0)
  ZIP: |22|
"KRN",3.6,177,1,23,0)
 
"KRN",3.6,177,1,24,0)
  ST. ADDR. 1 (MAILING): |23|
"KRN",3.6,177,1,25,0)
  CITY (MAILING): |24|
"KRN",3.6,177,1,26,0)
  STATE (MAILING): |25|
"KRN",3.6,177,1,27,0)
  ZIP (MAILING): |26|
"KRN",3.6,177,1,28,0)
 
"KRN",3.6,177,1,29,0)
 
"KRN",3.6,177,1,30,0)
  OLD VALUES
"KRN",3.6,177,1,31,0)
  ----------
"KRN",3.6,177,1,32,0)
  NAME: |8|
"KRN",3.6,177,1,33,0)
  OFFICIAL VA NAME: |9|
"KRN",3.6,177,1,34,0)
  FACILITY TYPE: |10|
"KRN",3.6,177,1,35,0)
  INACTIVE FACILITY FLAG: |15|
"KRN",3.6,177,1,36,0)
  VISN: |17|
"KRN",3.6,177,1,37,0)
  PARENT FACILITY: |18|
"KRN",3.6,177,1,38,0)
 
"KRN",3.6,177,1,39,0)
  STREET ADDR. 1: |27|
"KRN",3.6,177,1,40,0)
  CITY: |28|
"KRN",3.6,177,1,41,0)
  STATE: |16|
"KRN",3.6,177,1,42,0)
  ZIP: |29|
"KRN",3.6,177,1,43,0)
 
"KRN",3.6,177,1,44,0)
  ST. ADDR. 1 (MAILING): |30|
"KRN",3.6,177,1,45,0)
  CITY (MAILING): |31|
"KRN",3.6,177,1,46,0)
  STATE (MAILING): |32|
"KRN",3.6,177,1,47,0)
  ZIP (MAILING): |33|
"KRN",3.6,177,3,0)
^3.63^5^5^3020729^^^^
"KRN",3.6,177,3,1,0)
This bulletin notifies the XUMF INSTITUTION
"KRN",3.6,177,3,2,0)
mail group that an unsolicited update message
"KRN",3.6,177,3,3,0)
has been received and processed by the Master
"KRN",3.6,177,3,4,0)
File Server mechanism.  An INSTITUTION (#4)
"KRN",3.6,177,3,5,0)
file entry has been added/updated.
"KRN",3.6,177,4,0)
^3.64A^33^32
"KRN",3.6,177,4,1,0)
1
"KRN",3.6,177,4,1,1,0)
^3.65^1^1^3000802^^^
"KRN",3.6,177,4,1,1,1,0)
Message ID
"KRN",3.6,177,4,2,0)
2
"KRN",3.6,177,4,2,1,0)
^3.65^1^1^3000802^^^
"KRN",3.6,177,4,2,1,1,0)
Added or Updated
"KRN",3.6,177,4,3,0)
3
"KRN",3.6,177,4,3,1,0)
^3.65^1^1^3000802^^^
"KRN",3.6,177,4,3,1,1,0)
Internal Entry Number
"KRN",3.6,177,4,4,0)
4
"KRN",3.6,177,4,4,1,0)
^3.65^1^1^3000804^^^^
"KRN",3.6,177,4,4,1,1,0)
STATION NUMBER
"KRN",3.6,177,4,5,0)
5
"KRN",3.6,177,4,5,1,0)
^3.65^1^1^3000804^^^
"KRN",3.6,177,4,5,1,1,0)
NAME
"KRN",3.6,177,4,6,0)
6
"KRN",3.6,177,4,6,1,0)
^3.65^1^1^3000804^^^^
"KRN",3.6,177,4,6,1,1,0)
OFFICIAL VA NAME
"KRN",3.6,177,4,7,0)
7
"KRN",3.6,177,4,7,1,0)
^3.65^1^1^3000804^^^
"KRN",3.6,177,4,7,1,1,0)
FACILITY TYPE
"KRN",3.6,177,4,8,0)
8
"KRN",3.6,177,4,8,1,0)
^3.65^1^1^3010717^^^
"KRN",3.6,177,4,8,1,1,0)
OLD NAME
"KRN",3.6,177,4,9,0)
9
"KRN",3.6,177,4,9,1,0)
^3.65^1^1^3020729^^^^
"KRN",3.6,177,4,9,1,1,0)
OLD OFFICAL VA NAME
"KRN",3.6,177,4,10,0)
10
"KRN",3.6,177,4,10,1,0)
^3.65^1^1^3010619^^^^
"KRN",3.6,177,4,10,1,1,0)
OLD FACILITY TYPE
"KRN",3.6,177,4,11,0)
11
"KRN",3.6,177,4,11,1,0)
^^1^1^3010717^
"KRN",3.6,177,4,11,1,1,0)
INACTIVE FACILITY FLAG
"KRN",3.6,177,4,12,0)
12
"KRN",3.6,177,4,12,1,0)
^^1^1^3010717^
"KRN",3.6,177,4,12,1,1,0)
STATE
"KRN",3.6,177,4,13,0)
13
"KRN",3.6,177,4,13,1,0)
^^1^1^3010717^
"KRN",3.6,177,4,13,1,1,0)
VISN
"KRN",3.6,177,4,14,0)
14
"KRN",3.6,177,4,14,1,0)
^^1^1^3010717^
"KRN",3.6,177,4,14,1,1,0)
PARENT FACILITY
"KRN",3.6,177,4,15,0)
15
"KRN",3.6,177,4,15,1,0)
^^1^1^3010717^
"KRN",3.6,177,4,15,1,1,0)
OLD INACTIVE FACILITY FLAG
"KRN",3.6,177,4,16,0)
16
"KRN",3.6,177,4,16,1,0)
^^1^1^3010717^
"KRN",3.6,177,4,16,1,1,0)
OLD STATE
"KRN",3.6,177,4,17,0)
17
"KRN",3.6,177,4,17,1,0)
^^1^1^3010717^
"KRN",3.6,177,4,17,1,1,0)
OLD VISN
"KRN",3.6,177,4,18,0)
18
"KRN",3.6,177,4,18,1,0)
^^1^1^3010717^
"KRN",3.6,177,4,18,1,1,0)
OLD PARENT FACILITY
"KRN",3.6,177,4,19,0)
19
"KRN",3.6,177,4,19,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,19,1,1,0)
STREET ADDR. 1
"KRN",3.6,177,4,20,0)
20
"KRN",3.6,177,4,20,1,0)
^3.65^1^1^3020729^^
"KRN",3.6,177,4,20,1,1,0)
CITY
"KRN",3.6,177,4,22,0)
22
"KRN",3.6,177,4,22,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,22,1,1,0)
ZIP
"KRN",3.6,177,4,23,0)
23
"KRN",3.6,177,4,23,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,23,1,1,0)
ST. ADDR. 1 (MAILING)
"KRN",3.6,177,4,24,0)
24
"KRN",3.6,177,4,24,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,24,1,1,0)
CITY (MAILING)
"KRN",3.6,177,4,25,0)
25
"KRN",3.6,177,4,25,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,25,1,1,0)
STATE (MAILING)
"KRN",3.6,177,4,26,0)
26
"KRN",3.6,177,4,26,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,26,1,1,0)
ZIP (MAILING)
"KRN",3.6,177,4,27,0)
27
"KRN",3.6,177,4,27,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,27,1,1,0)
OLD STREET ADDR. 1
"KRN",3.6,177,4,28,0)
28
"KRN",3.6,177,4,28,1,0)
^3.65^1^1^3020729^^
"KRN",3.6,177,4,28,1,1,0)
OLD CITY
"KRN",3.6,177,4,29,0)
29
"KRN",3.6,177,4,29,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,29,1,1,0)
OLD ZIP
"KRN",3.6,177,4,30,0)
30
"KRN",3.6,177,4,30,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,30,1,1,0)
OLD ST. ADDR. 1 (MAILING)
"KRN",3.6,177,4,31,0)
31
"KRN",3.6,177,4,31,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,31,1,1,0)
OLD CITY (MAILING)
"KRN",3.6,177,4,32,0)
32
"KRN",3.6,177,4,32,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,32,1,1,0)
OLD STATE (MAILING)
"KRN",3.6,177,4,33,0)
33
"KRN",3.6,177,4,33,1,0)
^^1^1^3020729^
"KRN",3.6,177,4,33,1,1,0)
OLD ZIP (MAILING)
"KRN",19,6151,-1)
2^2
"KRN",19,6151,0)
XUKERNEL^Kernel Management Menu^^M^648^^^^^^^
"KRN",19,6151,10,0)
^19.01IP^4^4
"KRN",19,6151,10,4,0)
10423
"KRN",19,6151,10,4,"^")
XUMF IMF ADD EDIT
"KRN",19,6151,"U")
KERNEL MANAGEMENT MENU
"KRN",19,10423,-1)
0^1
"KRN",19,10423,0)
XUMF IMF ADD EDIT^IMF address edit^^R^^XUMF INSTITUTION^^^^^^KERNEL
"KRN",19,10423,1,0)
^^6^6^3020729^
"KRN",19,10423,1,1,0)
This option is used to edit this facility's (or associated facility's) 
"KRN",19,10423,1,2,0)
address information.  The edits will update your local INSTITUTION (#4) 
"KRN",19,10423,1,3,0)
file AND the Institution Master File (IMF) on FORUM.
"KRN",19,10423,1,4,0)
 
"KRN",19,10423,1,5,0)
WARNING:  Use extreme care updating this information, because you will be 
"KRN",19,10423,1,6,0)
updating not just your own database but the national database as well.
"KRN",19,10423,25)
EN^XUMFEIMF
"KRN",19,10423,"U")
IMF ADDRESS EDIT
"KRN",101,2465,-1)
0^2
"KRN",101,2465,0)
XUMF IMF MFN^XUMF IMF handler^^E^^^^^^^^
"KRN",101,2465,1,0)
^^1^1^3001011^^^^
"KRN",101,2465,1,1,0)
This protocol is the Master File Notification event driver for the Institution file.
"KRN",101,2465,99)
59058,38145
"KRN",101,2465,770)
XUMF IMF MFN^^MFN^M05^^P^^^^2.3^MFN
"KRN",101,2465,772)
D MAIN^XUMFH4
"KRN",101,2465,775,0)
^101.0775PA^1^1
"KRN",101,2465,775,1,0)
2466
"KRN",101,2465,775,1,"^")
XUMF IMF MFK
"KRN",101,2466,-1)
0^1
"KRN",101,2466,0)
XUMF IMF MFK^XUMF IMF App ACK^^S^^^^^^^^
"KRN",101,2466,1,0)
^101.06^1^1^3000629^^^^
"KRN",101,2466,1,1,0)
This protocol handles Master File Notifications for the Institution file.
"KRN",101,2466,99)
59058,38145
"KRN",101,2466,770)
^XUMF IMF MFK^MFN^M05^^P^^^^2.3^MFK^^i
"KRN",101,2466,771)
D MAIN^XUMFH4
"KRN",101,2466,773)
1^^^1
"KRN",101,2466,774)
Q
"KRN",771,78,-1)
0^1
"KRN",771,78,0)
XUMF MFN^a^MFS^XUMF SERVER^^^USA
"KRN",771,78,"MSG",0)
^771.06P^1^1
"KRN",771,78,"MSG",1,0)
MSA
"KRN",771,78,"MSG",1,"R")
NONE
"KRN",771,78,"SEG",0)
^771.05P^1^1
"KRN",771,78,"SEG",1,0)
MSH
"KRN",771,78,"SEG",1,"F")
.01
"KRN",771,79,-1)
0^2
"KRN",771,79,0)
XUMF MFK^a^IMF^XUMF SERVER^^^USA
"KRN",771,79,"MSG",0)
^771.06P^1^1
"KRN",771,79,"MSG",1,0)
MSA
"KRN",771,79,"MSG",1,"R")
NONE
"KRN",771,79,"SEG",0)
^771.05P^1^1
"KRN",771,79,"SEG",1,0)
MSH
"KRN",771,79,"SEG",1,"F")
.01
"KRN",771,80,-1)
0^4
"KRN",771,80,0)
XUMF MFR^a^^XUMF SERVER^^^USA
"KRN",771,80,"MSG",0)
^771.06P^2^1
"KRN",771,80,"MSG",2,0)
ZTA
"KRN",771,80,"MSG",2,"R")
NONE
"KRN",771,80,"SEG",0)
^771.05P^1^1
"KRN",771,80,"SEG",1,0)
MSH
"KRN",771,80,"SEG",1,"F")
.01
"KRN",771,81,-1)
0^3
"KRN",771,81,0)
XUMF MFQ^a^^XUMF SERVER^^^USA
"KRN",771,81,"MSG",0)
^771.06P^1^1
"KRN",771,81,"MSG",1,0)
ZTA
"KRN",771,81,"MSG",1,"R")
NONE
"KRN",771,81,"SEG",0)
^771.05P^1^1
"KRN",771,81,"SEG",1,0)
MSH
"KRN",771,81,"SEG",1,"F")
.01
"KRN",771,89,-1)
0^6
"KRN",771,89,0)
XUMF IMF MFN^a^^XUMF SERVER^^^USA
"KRN",771,89,"MSG",0)
^771.06P^1^1
"KRN",771,89,"MSG",1,0)
MSA
"KRN",771,89,"MSG",1,"R")
NONE
"KRN",771,89,"SEG",0)
^771.05P^1^1
"KRN",771,89,"SEG",1,0)
MSH
"KRN",771,89,"SEG",1,"F")
.01
"KRN",771,90,-1)
0^5
"KRN",771,90,0)
XUMF IMF MFK^a^IMF^XUMF SERVER^^^USA
"KRN",771,90,"MSG",0)
^771.06P^1^1
"KRN",771,90,"MSG",1,0)
MSA
"KRN",771,90,"MSG",1,"R")
NONE
"KRN",771,90,"SEG",0)
^771.05P^1^1
"KRN",771,90,"SEG",1,0)
MSH
"KRN",771,90,"SEG",1,"F")
.01
"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",113,-1)
1^1
"PKG",113,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^XUDOCV7 NEW FEATURES
"PKG",113,20,0)
^9.402P^^
"PKG",113,22,0)
^9.49I^1^1
"PKG",113,22,1,0)
8.0^2950703^2960322^648
"PKG",113,22,1,"PAH",1,0)
217^3020913^9147
"PKG",113,22,1,"PAH",1,1,0)
^^4^4^3020913
"PKG",113,22,1,"PAH",1,1,1,0)
Institution file & Reasonable Charges project
"PKG",113,22,1,"PAH",1,1,2,0)
 
"PKG",113,22,1,"PAH",1,1,3,0)
Refer to patch XU*8*217 in the FORUM Patch Module for a complete
"PKG",113,22,1,"PAH",1,1,4,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","XUAF4")
0^8^B29369621
"RTN","XUAF4",1,0)
XUAF4 ;ISC-SF/RWF/RAM - Instutition file access. ;04/01/99  08:07
"RTN","XUAF4",2,0)
 ;;8.0;KERNEL;**43,112,206,209,232,217**;Jul 10, 1995
"RTN","XUAF4",3,0)
 Q  ;No access from the top.
"RTN","XUAF4",4,0)
 ;
"RTN","XUAF4",5,0)
PARENT(ROOT,CHILD,ASSO) ;sr. Return array of IEN's of parents
"RTN","XUAF4",6,0)
 N %,%0
"RTN","XUAF4",7,0)
 S CHILD=$$LKUP(CHILD),ASSO=$$ASSO($G(ASSO)),%=0
"RTN","XUAF4",8,0)
 F  S %=$O(^DIC(4,CHILD,7,%)) Q:%'>0  S %0=+$P(^(%,0),U,2) D
"RTN","XUAF4",9,0)
 . Q:+%'=ASSO
"RTN","XUAF4",10,0)
 . S @ROOT@("P",+%0)=$$NS(+%0)
"RTN","XUAF4",11,0)
 Q
"RTN","XUAF4",12,0)
CHILDREN(ROOT,PAR,ASSO,XUAC) ;sr. Return the children
"RTN","XUAF4",13,0)
 N %,%1 S %=0,PAR=$$LKUP(PAR),ASSO=$$ASSO($G(ASSO)),XUAC=$G(XUAC)
"RTN","XUAF4",14,0)
 Q:ASSO'>0
"RTN","XUAF4",15,0)
 F  S %=$O(^DIC(4,"AC",ASSO,PAR,%)) Q:%'>0  D
"RTN","XUAF4",16,0)
 . I XUAC,$$STATUS(%)="I" Q
"RTN","XUAF4",17,0)
 . S @ROOT@("C",%)=$$NS(%)
"RTN","XUAF4",18,0)
 Q
"RTN","XUAF4",19,0)
SIBLING(ROOT,CHILD,ASSO) ;sr. Return the siblings
"RTN","XUAF4",20,0)
 N % S %=0,ASSO=$$ASSO($G(ASSO))
"RTN","XUAF4",21,0)
 D PARENT(ROOT,CHILD,ASSO)
"RTN","XUAF4",22,0)
 F  S %=$O(@ROOT@("P",%)) Q:%'>0  D CHILDREN($NA(@ROOT@("P",%)),"`"_%,ASSO)
"RTN","XUAF4",23,0)
 Q
"RTN","XUAF4",24,0)
NNT(%) ;ef.sr. Return Name, Station Number, ASSO
"RTN","XUAF4",25,0)
 I %'>0 Q ""
"RTN","XUAF4",26,0)
 Q $$NS(%)_"^"_$$WHAT(%,13)
"RTN","XUAF4",27,0)
 ;
"RTN","XUAF4",28,0)
LKUP(%) ;ef.sr. Resolve a value into IEN
"RTN","XUAF4",29,0)
 I $E(%)="`" S %=+$E(%,2,99) Q:$D(^DIC(4,%,0))#2 % Q 0
"RTN","XUAF4",30,0)
 ;Q $$FIND1^DIC(4,,"MX",%)
"RTN","XUAF4",31,0)
 Q $$FIND1^DIC(4,,"MX",%,,"I $P(^(0),U,11)'=""I""") ;To screen Inactive
"RTN","XUAF4",32,0)
 ;
"RTN","XUAF4",33,0)
STATUS(%) ;Get the status of a IEN
"RTN","XUAF4",34,0)
 Q $P($G(^DIC(4,%,0)),U,11)
"RTN","XUAF4",35,0)
 ;
"RTN","XUAF4",36,0)
TYPE(%) ;Lookup a Faclity TYPE in file 4.1
"RTN","XUAF4",37,0)
 I %="" Q %
"RTN","XUAF4",38,0)
 I $D(^DIC(4.1,"B",%))>9 Q %
"RTN","XUAF4",39,0)
 S %=$$FIND1^DIC(4.1,,"MX",%)
"RTN","XUAF4",40,0)
 Q $P($G(^DIC(4.1,+%,0)),U)
"RTN","XUAF4",41,0)
 ;
"RTN","XUAF4",42,0)
ASSO(%) ;Lookup an Asso
"RTN","XUAF4",43,0)
 Q:+%=% % S:%="" %="VISN"
"RTN","XUAF4",44,0)
 S %=$$FIND1^DIC(4.05,,"MX",%)
"RTN","XUAF4",45,0)
 Q +%
"RTN","XUAF4",46,0)
 ;
"RTN","XUAF4",47,0)
NS(IEN) ;ef.sr. Return name and station #
"RTN","XUAF4",48,0)
 Q $P($G(^DIC(4,IEN,0)),U,1)_U_$P($G(^DIC(4,+IEN,99)),U,1)
"RTN","XUAF4",49,0)
 ;
"RTN","XUAF4",50,0)
WHAT(IEN,FLD) ;ef.sr. Field to return
"RTN","XUAF4",51,0)
 Q $$GET1^DIQ(4,IEN_",",FLD,"")
"RTN","XUAF4",52,0)
 ;
"RTN","XUAF4",53,0)
CIRN(%1,%2) ;ef.sr. Is this a CIRN Enables inst.
"RTN","XUAF4",54,0)
 N % S %1=+$G(%1)
"RTN","XUAF4",55,0)
 Q:'$D(^DIC(4,%1,0)) -1
"RTN","XUAF4",56,0)
 I $G(%2)]"" N DIE,DR,DA S DA=%1,DR="990.1///"_%2,DIE="^DIC(4," D ^DIE
"RTN","XUAF4",57,0)
 Q $$WHAT(%1,990.1)
"RTN","XUAF4",58,0)
 ;
"RTN","XUAF4",59,0)
IEN(STA) ;return IEN for a station number
"RTN","XUAF4",60,0)
 S STA=$G(STA) Q:STA="" STA
"RTN","XUAF4",61,0)
 Q $O(^DIC(4,"D",STA,0))
"RTN","XUAF4",62,0)
 ;
"RTN","XUAF4",63,0)
STA(IEN) ;return station number for an IEN
"RTN","XUAF4",64,0)
 Q $P($G(^DIC(4,+IEN,99)),U)
"RTN","XUAF4",65,0)
 ;
"RTN","XUAF4",66,0)
TF(IEN) ;active treating facility? (1=YES,0=NO)
"RTN","XUAF4",67,0)
 N ARRAY Q:'$G(IEN) 0
"RTN","XUAF4",68,0)
 D F4($$STA(IEN),.ARRAY,"AM")
"RTN","XUAF4",69,0)
 Q $S(ARRAY:1,1:0)
"RTN","XUAF4",70,0)
 ;
"RTN","XUAF4",71,0)
RT(IEN) ;realigned to
"RTN","XUAF4",72,0)
 N ARRAY Q:'$G(IEN) 0
"RTN","XUAF4",73,0)
 D F4($$STA(IEN),.ARRAY)
"RTN","XUAF4",74,0)
 Q $G(ARRAY("REALIGNED TO"))
"RTN","XUAF4",75,0)
 ;
"RTN","XUAF4",76,0)
RF(IEN) ;realigned from
"RTN","XUAF4",77,0)
 N ARRAY Q:'$G(IEN) 0
"RTN","XUAF4",78,0)
 D F4($$STA(IEN),.ARRAY)
"RTN","XUAF4",79,0)
 Q $G(ARRAY("REALIGNED FROM"))
"RTN","XUAF4",80,0)
 ;
"RTN","XUAF4",81,0)
O99(IEN) ;returns pointer to new station number IEN
"RTN","XUAF4",82,0)
 Q:$O(^DIC(4,"AOLD99",+$G(IEN),""))="" ""
"RTN","XUAF4",83,0)
 Q $O(^DIC(4,"D",$O(^DIC(4,"AOLD99",+$G(IEN),"")),0))
"RTN","XUAF4",84,0)
 ;
"RTN","XUAF4",85,0)
LEGACY(STA) ; -- legacy station number (1=yes; 0=no)
"RTN","XUAF4",86,0)
 Q $S($$RT^XUAF4(+$$IEN^XUAF4(STA)):1,1:0)
"RTN","XUAF4",87,0)
 ;
"RTN","XUAF4",88,0)
PRNT(STA) ; -- parent facility
"RTN","XUAF4",89,0)
 N X S STA=$G(STA) Q:STA="" "0^no station number passed"
"RTN","XUAF4",90,0)
 D PARENT("X",STA,"PARENT FACILITY") S X=$O(X("P",0))
"RTN","XUAF4",91,0)
 Q:'X "0^no parent associated with input station number"
"RTN","XUAF4",92,0)
 Q X_U_$P($G(X("P",+X)),U,2)_U_$P($G(X("P",+X)),U)
"RTN","XUAF4",93,0)
 ;
"RTN","XUAF4",94,0)
NAME(IEN) ; -- Official Name
"RTN","XUAF4",95,0)
 Q:$P($G(^DIC(4,+IEN,99)),U,3)'="" $P($G(^DIC(4,+IEN,99)),U,3)
"RTN","XUAF4",96,0)
 Q $P($G(^DIC(4,+IEN,0)),U)
"RTN","XUAF4",97,0)
 ;
"RTN","XUAF4",98,0)
ACTIVE(IEN) ; -- active facility (1=active, 0=inactive)
"RTN","XUAF4",99,0)
 ;
"RTN","XUAF4",100,0)
 Q '$P($G(^DIC(4,+IEN,99)),U,4)
"RTN","XUAF4",101,0)
 ;
"RTN","XUAF4",102,0)
PADD(IEN) ; -- physical address (street addr^city^state^zip)
"RTN","XUAF4",103,0)
 ;
"RTN","XUAF4",104,0)
 N X,STATE
"RTN","XUAF4",105,0)
 ;
"RTN","XUAF4",106,0)
 S X=$P($G(^DIC(4,+IEN,0)),U,2)
"RTN","XUAF4",107,0)
 S STATE=$P($G(^DIC(5,+X,0)),U,2)
"RTN","XUAF4",108,0)
 S X=$G(^DIC(4,+IEN,1)) Q:X="" X
"RTN","XUAF4",109,0)
 ;
"RTN","XUAF4",110,0)
 Q $P(X,U)_U_$P(X,U,3)_U_STATE_U_$P(X,U,4)
"RTN","XUAF4",111,0)
 ;
"RTN","XUAF4",112,0)
MADD(IEN) ; -- mailing address (street addr^city^state^zip)
"RTN","XUAF4",113,0)
 ;
"RTN","XUAF4",114,0)
 N X,STATE
"RTN","XUAF4",115,0)
 ;
"RTN","XUAF4",116,0)
 S X=$G(^DIC(4,+IEN,4)) Q:X="" X
"RTN","XUAF4",117,0)
 S STATE=$P($G(^DIC(5,+$P(X,U,4),0)),U,2)
"RTN","XUAF4",118,0)
 ;
"RTN","XUAF4",119,0)
 Q $P(X,U)_U_$P(X,U,3)_U_STATE_U_$P(X,U,5)
"RTN","XUAF4",120,0)
 ;
"RTN","XUAF4",121,0)
F4(STA,ARRAY,FLAG,ONDT) ;File #4 multipurpose API
"RTN","XUAF4",122,0)
 ;
"RTN","XUAF4",123,0)
 ;INPUT
"RTN","XUAF4",124,0)
 ;       STA     Station number (required)
"RTN","XUAF4",125,0)
 ;
"RTN","XUAF4",126,0)
 ;    [.]ARRAY   $NAME reference for return values.  (required)
"RTN","XUAF4",127,0)
 ;
"RTN","XUAF4",128,0)
 ;       FLAG    A = Active entries only.  (optional)
"RTN","XUAF4",129,0)
 ;               M = Medical treating facilities only.
"RTN","XUAF4",130,0)
 ;
"RTN","XUAF4",131,0)
 ;       ONDT    Return name on this FM internal date.  (optional);
"RTN","XUAF4",132,0)
 ;
"RTN","XUAF4",133,0)
 ;OUTPUT
"RTN","XUAF4",134,0)
 ;       ARRAY                     IEN or '0^error message'
"RTN","XUAF4",135,0)
 ;       ARRAY("NAME")             name
"RTN","XUAF4",136,0)
 ;       ARRAY("VA NAME")          offical va name
"RTN","XUAF4",137,0)
 ;       ARRAY("STATION NUMBER")   station number
"RTN","XUAF4",138,0)
 ;       ARRAY("TYPE")             facilty type name
"RTN","XUAF4",139,0)
 ;       ARRAY("INACTIVE")         inactive date (0=not inactive)
"RTN","XUAF4",140,0)
 ;       note: if inactive date not available but entry inactive then 1
"RTN","XUAF4",141,0)
 ;
"RTN","XUAF4",142,0)
 ;       ARRAY("REALIGNED TO")     IEN^station number^date
"RTN","XUAF4",143,0)
 ;       ARRAY("REALIGNED FROM")   IEN^station number^date
"RTN","XUAF4",144,0)
 ;
"RTN","XUAF4",145,0)
 K ARRAY
"RTN","XUAF4",146,0)
 S STA=$G(STA),FLAG=$G(FLAG),ONDT=$G(ONDT)
"RTN","XUAF4",147,0)
 I STA="" S ARRAY="0^invalid input STA - required" Q
"RTN","XUAF4",148,0)
 ;
"RTN","XUAF4",149,0)
 N IEN,N99,TO,FM,I,RDT,NAME,VANAME,HDT
"RTN","XUAF4",150,0)
 ;
"RTN","XUAF4",151,0)
 S IEN=$$IEN(STA)
"RTN","XUAF4",152,0)
 I 'IEN S ARRAY="0^station number does not exist" Q
"RTN","XUAF4",153,0)
 S N99=$G(^DIC(4,+IEN,99))
"RTN","XUAF4",154,0)
 S ARRAY=$$SCRN() Q:'ARRAY
"RTN","XUAF4",155,0)
 ;
"RTN","XUAF4",156,0)
 S ARRAY("NAME")=$P(^DIC(4,IEN,0),U)
"RTN","XUAF4",157,0)
 S ARRAY("VA NAME")=$P(N99,U,3)
"RTN","XUAF4",158,0)
 S ARRAY("STATION NUMBER")=STA
"RTN","XUAF4",159,0)
 S ARRAY("TYPE")=$P($G(^DIC(4.1,+$G(^DIC(4,IEN,3)),0)),U)
"RTN","XUAF4",160,0)
 ;
"RTN","XUAF4",161,0)
 ;realignments
"RTN","XUAF4",162,0)
 S TO=$O(^DIC(4,"ARTO",IEN,0)) D:TO
"RTN","XUAF4",163,0)
 .S RDT=$O(^DIC(4,"ART",TO,IEN,0))
"RTN","XUAF4",164,0)
 .S ARRAY("REALIGNED TO")=TO_U_$$STA(TO)_U_RDT
"RTN","XUAF4",165,0)
 S FM=$O(^DIC(4,"ARFM",IEN,0)) D:FM
"RTN","XUAF4",166,0)
 .S ARRAY("REALIGNED FROM")=FM_U_$$STA(FM)_U_$O(^DIC(4,"ARF",FM,IEN,0))
"RTN","XUAF4",167,0)
 ;
"RTN","XUAF4",168,0)
 S I=$O(^DIC(4,"AI",IEN,0)),I=$S(I:I,$G(RDT):RDT,1:+$P(N99,U,4))
"RTN","XUAF4",169,0)
 S ARRAY("INACTIVE")=I
"RTN","XUAF4",170,0)
 ;
"RTN","XUAF4",171,0)
 Q:'ONDT
"RTN","XUAF4",172,0)
 ;
"RTN","XUAF4",173,0)
 ;get name for date
"RTN","XUAF4",174,0)
 S NAME=ARRAY("NAME")
"RTN","XUAF4",175,0)
 S VANAME=ARRAY("VA NAME")
"RTN","XUAF4",176,0)
 S HDT=DT
"RTN","XUAF4",177,0)
 F  S HDT=$O(^DIC(4,IEN,999,HDT),-1) Q:('HDT!(HDT<ONDT))  D
"RTN","XUAF4",178,0)
 .N X S X=$G(^DIC(4,IEN,999,HDT,0)) Q:X=""
"RTN","XUAF4",179,0)
 .S:$P(X,U,2)'="" NAME=$P(X,U,2)
"RTN","XUAF4",180,0)
 .S:$P(X,U,3)'="" VANAME=$P(X,U,3)
"RTN","XUAF4",181,0)
 S ARRAY("NAME")=NAME
"RTN","XUAF4",182,0)
 S ARRAY("VA NAME")=VANAME
"RTN","XUAF4",183,0)
 ;
"RTN","XUAF4",184,0)
 Q
"RTN","XUAF4",185,0)
 ;
"RTN","XUAF4",186,0)
IDT(IEN) ; inactive date
"RTN","XUAF4",187,0)
 N IDT,ND,XDT
"RTN","XUAF4",188,0)
 S IEN=$G(IEN) Q:'IEN IEN
"RTN","XUAF4",189,0)
 S XDT=9999999,IDT=""
"RTN","XUAF4",190,0)
 F  S XDT=$O(^DIC(4,+IEN,999,XDT),-1) Q:'XDT  D  Q:IDT
"RTN","XUAF4",191,0)
 .S ND=$G(^DIC(4,+IEN,999,XDT,0)) Q:ND="" ND
"RTN","XUAF4",192,0)
 .S IDT=$S($P(ND,U,5):XDT,$P(ND,U,7):XDT,1:IDT)
"RTN","XUAF4",193,0)
 Q IDT
"RTN","XUAF4",194,0)
 ;
"RTN","XUAF4",195,0)
SCRN() ;sreen IEN
"RTN","XUAF4",196,0)
 N X S X=$E(N99,1,3)
"RTN","XUAF4",197,0)
 I FLAG["A",$P(N99,U,4) Q "0^inactive facility"
"RTN","XUAF4",198,0)
 I FLAG["M",$S(X<400:1,X>759:1,X<700:0,X<750:1,1:0) Q "0^not a treating facility"
"RTN","XUAF4",199,0)
 Q IEN
"RTN","XUAF4",200,0)
 ;
"RTN","XUAF4",201,0)
SCREEN(FLAGS,SCREEN) ; -- set up SCREEN for LKUP
"RTN","XUAF4",202,0)
 ;
"RTN","XUAF4",203,0)
 ;INPUT
"RTN","XUAF4",204,0)
 ;       FLAG            Flag type of entry to return:
"RTN","XUAF4",205,0)
 ;
"RTN","XUAF4",206,0)
 ;                         "V" facility type of VAMC
"RTN","XUAF4",207,0)
 ;                         "M" facility type of M&ROC or VAMC
"RTN","XUAF4",208,0)
 ;                         "C" facility type of CBOC
"RTN","XUAF4",209,0)
 ;                         "A" active (not INACTIVE)
"RTN","XUAF4",210,0)
 ;                         "I" inactive (not active)
"RTN","XUAF4",211,0)
 ;                         "N" national (not local)
"RTN","XUAF4",212,0)
 ;                         "L" local (not national)
"RTN","XUAF4",213,0)
 ;                         "T" treating facility
"RTN","XUAF4",214,0)
 ;                         "L" legacy facility
"RTN","XUAF4",215,0)
 ;                         "P" primary facility
"RTN","XUAF4",216,0)
 ;
"RTN","XUAF4",217,0)
 ;OUTPUT
"RTN","XUAF4",218,0)
 ;       $$              '1' call successful or '0^error message'
"RTN","XUAF4",219,0)
 ;       SCREEN          see $$FIND1^DIC() in
"RTN","XUAF4",220,0)
 ;       INDEXES         FileMan documentation
"RTN","XUAF4",221,0)
 ;       FLAGS           for output values
"RTN","XUAF4",222,0)
 ;
"RTN","XUAF4",223,0)
 Q "0^coming soon"
"RTN","XUAF4",224,0)
 ;
"RTN","XUAF4",225,0)
INDEXES(FLAGS,INDEXES) ; -- set up INDEXES for LKUP
"RTN","XUAF4",226,0)
 ;
"RTN","XUAF4",227,0)
 Q "0^coming soon"
"RTN","XUAF4",228,0)
 ;
"RTN","XUMF4L0")
0^9^B30984085
"RTN","XUMF4L0",1,0)
XUMF4L0 ;OIFO-OAK/RAM - Load IMF ;02/21/02
"RTN","XUMF4L0",2,0)
 ;;8.0;KERNEL;**217**;Jul 10, 1995
"RTN","XUMF4L0",3,0)
 ;
"RTN","XUMF4L0",4,0)
 ; $$PARAM^HLCS2 call supported by IA #3552
"RTN","XUMF4L0",5,0)
 ;
"RTN","XUMF4L0",6,0)
MAIN ; -- main
"RTN","XUMF4L0",7,0)
 ;
"RTN","XUMF4L0",8,0)
 Q:$$SERVER^XUMFI()
"RTN","XUMF4L0",9,0)
 ;
"RTN","XUMF4L0",10,0)
 D V23
"RTN","XUMF4L0",11,0)
 ;
"RTN","XUMF4L0",12,0)
 I $$CNT<1000 D NEVER Q
"RTN","XUMF4L0",13,0)
 ;
"RTN","XUMF4L0",14,0)
 D BG
"RTN","XUMF4L0",15,0)
 ;
"RTN","XUMF4L0",16,0)
 Q
"RTN","XUMF4L0",17,0)
 ;
"RTN","XUMF4L0",18,0)
BG ; -- background job
"RTN","XUMF4L0",19,0)
 ;
"RTN","XUMF4L0",20,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO
"RTN","XUMF4L0",21,0)
 ;
"RTN","XUMF4L0",22,0)
 S ZTRTN="EN^XUMF4L0"
"RTN","XUMF4L0",23,0)
 S ZTDESC="XUMF Institution file background cleanup"
"RTN","XUMF4L0",24,0)
 S ZTDTH=$$NOW^XLFDT
"RTN","XUMF4L0",25,0)
 S ZTIO=""
"RTN","XUMF4L0",26,0)
 ;
"RTN","XUMF4L0",27,0)
 D ^%ZTLOAD
"RTN","XUMF4L0",28,0)
 ;
"RTN","XUMF4L0",29,0)
 Q
"RTN","XUMF4L0",30,0)
 ;
"RTN","XUMF4L0",31,0)
EN ; -- entry point
"RTN","XUMF4L0",32,0)
 ;
"RTN","XUMF4L0",33,0)
 D UPDATE,LOCAL^XUMF4L2,NVS^XUMF4L2,EXIT Q
"RTN","XUMF4L0",34,0)
 ;
"RTN","XUMF4L0",35,0)
 Q
"RTN","XUMF4L0",36,0)
 ;
"RTN","XUMF4L0",37,0)
UPDATE ; -- get FACILITY TYPE, update, get INSTITUTION, update
"RTN","XUMF4L0",38,0)
 ;
"RTN","XUMF4L0",39,0)
 ; -- get FACILITY TYPE
"RTN","XUMF4L0",40,0)
 K ^TMP("XUMF ARRAY",$J)
"RTN","XUMF4L0",41,0)
 ;
"RTN","XUMF4L0",42,0)
 N PARAM,XUMFLAG,ERROR,TEST
"RTN","XUMF4L0",43,0)
 ;
"RTN","XUMF4L0",44,0)
 S (ERROR,XUMFLAG,TEST)=0
"RTN","XUMF4L0",45,0)
 ;
"RTN","XUMF4L0",46,0)
 I $P($$PARAM^HLCS2,U,3)="T" S TEST=1
"RTN","XUMF4L0",47,0)
 ;
"RTN","XUMF4L0",48,0)
 L +^TMP("XUMF ARRAY",$J):0 D:'$T
"RTN","XUMF4L0",49,0)
 .S ERROR="1^another process is using the Master File Server"
"RTN","XUMF4L0",50,0)
 ;
"RTN","XUMF4L0",51,0)
 I ERROR D EXIT Q
"RTN","XUMF4L0",52,0)
 ;
"RTN","XUMF4L0",53,0)
 D MFS0
"RTN","XUMF4L0",54,0)
 ;
"RTN","XUMF4L0",55,0)
 I ERROR D EXIT Q
"RTN","XUMF4L0",56,0)
 ;
"RTN","XUMF4L0",57,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D  D EXIT Q
"RTN","XUMF4L0",58,0)
 .S ERROR="1^Connection to master file server failed!"
"RTN","XUMF4L0",59,0)
 ;
"RTN","XUMF4L0",60,0)
 ; -- update
"RTN","XUMF4L0",61,0)
 D FTCLEAN^XUMF4A I ERROR D EXIT Q
"RTN","XUMF4L0",62,0)
 ;
"RTN","XUMF4L0",63,0)
 ; -- get INSTITUTION
"RTN","XUMF4L0",64,0)
 K ^TMP("XUMF ARRAY",$J),^TMP("XUMF MFS",$J)
"RTN","XUMF4L0",65,0)
 ;
"RTN","XUMF4L0",66,0)
 D MFS1
"RTN","XUMF4L0",67,0)
 ;
"RTN","XUMF4L0",68,0)
 I ERROR D EXIT Q
"RTN","XUMF4L0",69,0)
 ;
"RTN","XUMF4L0",70,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D  Q
"RTN","XUMF4L0",71,0)
 .S ERROR="1^Connection to master file server failed!"
"RTN","XUMF4L0",72,0)
 .D EXIT
"RTN","XUMF4L0",73,0)
 ;
"RTN","XUMF4L0",74,0)
 ; -- update
"RTN","XUMF4L0",75,0)
 D EN^XUMF4L1
"RTN","XUMF4L0",76,0)
 ;
"RTN","XUMF4L0",77,0)
 D EXIT
"RTN","XUMF4L0",78,0)
 ;
"RTN","XUMF4L0",79,0)
 Q
"RTN","XUMF4L0",80,0)
 ;
"RTN","XUMF4L0",81,0)
MFS0 ; -- get national facility type file from Master File Server
"RTN","XUMF4L0",82,0)
 ;
"RTN","XUMF4L0",83,0)
 S PARAM("LLNK")="XUMF MFR^XUMF "_$S('TEST:"FORUM",1:"TEST")
"RTN","XUMF4L0",84,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF4L0",85,0)
 ;
"RTN","XUMF4L0",86,0)
 D MAIN^XUMFP(4.1,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4L0",87,0)
 D MAIN^XUMFI(4.1,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4L0",88,0)
 D MAIN^XUMFH
"RTN","XUMF4L0",89,0)
 ;
"RTN","XUMF4L0",90,0)
 Q
"RTN","XUMF4L0",91,0)
 ;
"RTN","XUMF4L0",92,0)
MFS1 ; -- get national facility type file from Master File Server
"RTN","XUMF4L0",93,0)
 ;
"RTN","XUMF4L0",94,0)
 S PARAM("LLNK")="XUMF MFR^XUMF "_$S('TEST:"FORUM",1:"TEST")
"RTN","XUMF4L0",95,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF4L0",96,0)
 ;
"RTN","XUMF4L0",97,0)
 D MAIN^XUMFP(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4L0",98,0)
 D MAIN^XUMFI(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4L0",99,0)
 D MAIN^XUMFH
"RTN","XUMF4L0",100,0)
 ;
"RTN","XUMF4L0",101,0)
 Q
"RTN","XUMF4L0",102,0)
 ;
"RTN","XUMF4L0",103,0)
 ;
"RTN","XUMF4L0",104,0)
CNT() ; -- count station numbers in Institution file
"RTN","XUMF4L0",105,0)
 ;
"RTN","XUMF4L0",106,0)
 N STA,CNT
"RTN","XUMF4L0",107,0)
 ;
"RTN","XUMF4L0",108,0)
 S STA="" F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  S CNT=$G(CNT)+1
"RTN","XUMF4L0",109,0)
 ;
"RTN","XUMF4L0",110,0)
 Q CNT
"RTN","XUMF4L0",111,0)
 ;
"RTN","XUMF4L0",112,0)
EXIT ; -- cleanup and quit
"RTN","XUMF4L0",113,0)
 ;
"RTN","XUMF4L0",114,0)
 K ^TMP("XUMF ADD",$J),^TMP("XUMF MOD",$J),^TMP("XUMF DEL",$J)
"RTN","XUMF4L0",115,0)
 K ^TMP("XUMF ARRAY",$J),^TMP("XUMF MFS",$J),^TMP("DIERR",$J)
"RTN","XUMF4L0",116,0)
 ;
"RTN","XUMF4L0",117,0)
 L -^TMP("XUMF ARRAY",$J)
"RTN","XUMF4L0",118,0)
 ;
"RTN","XUMF4L0",119,0)
 S ZTREQ="@"
"RTN","XUMF4L0",120,0)
 ;
"RTN","XUMF4L0",121,0)
 Q
"RTN","XUMF4L0",122,0)
 ;
"RTN","XUMF4L0",123,0)
V23 ; -- stuff VISN 23
"RTN","XUMF4L0",124,0)
 ;
"RTN","XUMF4L0",125,0)
 N XUMF,IENS,IEN
"RTN","XUMF4L0",126,0)
 ;
"RTN","XUMF4L0",127,0)
 S XUMF=1
"RTN","XUMF4L0",128,0)
 ;
"RTN","XUMF4L0",129,0)
 S IEN=$O(^DIC(4.1,"B","VISN",0))
"RTN","XUMF4L0",130,0)
 S IENS=$S(IEN:IEN_",",1:"+1,")
"RTN","XUMF4L0",131,0)
 ;
"RTN","XUMF4L0",132,0)
 K FDA
"RTN","XUMF4L0",133,0)
 S FDA(4.1,IENS,.01)="VISN"
"RTN","XUMF4L0",134,0)
 S FDA(4.1,IENS,1)="VETERANS INTEGRATED SERVICE NETWORK"
"RTN","XUMF4L0",135,0)
 S FDA(4.1,IENS,3)="NATIONAL"
"RTN","XUMF4L0",136,0)
 D UPDATE^DIE("E","FDA")
"RTN","XUMF4L0",137,0)
 ;
"RTN","XUMF4L0",138,0)
 S IEN=$O(^DIC(4,"B","VISN 23",0))
"RTN","XUMF4L0",139,0)
 S IENS=$S(IEN:IEN_",",1:"+1,")
"RTN","XUMF4L0",140,0)
 ;
"RTN","XUMF4L0",141,0)
 K FDA
"RTN","XUMF4L0",142,0)
 S FDA(4,IENS,.01)="VISN 23"
"RTN","XUMF4L0",143,0)
 S FDA(4,IENS,11)="LOCAL"
"RTN","XUMF4L0",144,0)
 S FDA(4,IENS,13)="VISN"
"RTN","XUMF4L0",145,0)
 D UPDATE^DIE("E","FDA")
"RTN","XUMF4L0",146,0)
 ;
"RTN","XUMF4L0",147,0)
 Q
"RTN","XUMF4L0",148,0)
 ;
"RTN","XUMF4L0",149,0)
NEVER ; -- cleanup never performed - notify site and NVS
"RTN","XUMF4L0",150,0)
 ;
"RTN","XUMF4L0",151,0)
 N XMSUB,TEXT,XMY,XMDUZ,XMTEXT
"RTN","XUMF4L0",152,0)
 ;
"RTN","XUMF4L0",153,0)
 S TEXT(1)="A check of the INSTITUTION file (#4) indicates the IFR"
"RTN","XUMF4L0",154,0)
 S TEXT(2)="cleanup has NOT been performed."
"RTN","XUMF4L0",155,0)
 S TEXT(3)=""
"RTN","XUMF4L0",156,0)
 S TEXT(4)="The IFR cleanup is a required action.  Future initiatives"
"RTN","XUMF4L0",157,0)
 S TEXT(5)="are dependant on consistent and reliable Institution data"
"RTN","XUMF4L0",158,0)
 S TEXT(6)="at each site.  A copy of this message is being sent to NVS"
"RTN","XUMF4L0",159,0)
 S TEXT(7)="for tracking purposes."
"RTN","XUMF4L0",160,0)
 S TEXT(8)=""
"RTN","XUMF4L0",161,0)
 S TEXT(9)="If you require assistance performing the IFR cleanup,"
"RTN","XUMF4L0",162,0)
 S TEXT(10)="you may contact NVS and someone will contact you and"
"RTN","XUMF4L0",163,0)
 S TEXT(11)="help you with the IFR cleanup process.  To request"
"RTN","XUMF4L0",164,0)
 S TEXT(12)="assistance you may send a MailMan message to the"
"RTN","XUMF4L0",165,0)
 S TEXT(13)="G.XUMF INSTITUTION mail group on FORUM or log a NOIS."
"RTN","XUMF4L0",166,0)
 S TEXT(14)=""
"RTN","XUMF4L0",167,0)
 S TEXT(15)="Note: Running the IFR cleanup on LEGACY systems is"
"RTN","XUMF4L0",168,0)
 S TEXT(16)="OPTIONAL.  If this message refers to a legacy system"
"RTN","XUMF4L0",169,0)
 S TEXT(17)="please disregard this message."
"RTN","XUMF4L0",170,0)
 ;
"RTN","XUMF4L0",171,0)
 S XMSUB="IFR/cleanup/REQUIRED at "_$$SITE
"RTN","XUMF4L0",172,0)
 S XMDUZ=$S(DUZ:DUZ,1:.5),XMY(DUZ)=""
"RTN","XUMF4L0",173,0)
 S XMTEXT="TEXT("
"RTN","XUMF4L0",174,0)
 S XMY("G.XUMF INSTITUTION")=""
"RTN","XUMF4L0",175,0)
 S:$P($$PARAM^HLCS2,U,3)'="T" XMY("G.XUMF INSTITUTION@FORUM")=""
"RTN","XUMF4L0",176,0)
 D ^XMD
"RTN","XUMF4L0",177,0)
 ;
"RTN","XUMF4L0",178,0)
 Q
"RTN","XUMF4L0",179,0)
 ;
"RTN","XUMF4L0",180,0)
SITE() ; -- facility name and sta # string
"RTN","XUMF4L0",181,0)
 ;
"RTN","XUMF4L0",182,0)
 Q $P($G(^DIC(4,+DUZ(2),0)),U)_" Sta#: "_$P($G(^DIC(4,+DUZ(2),99)),U)
"RTN","XUMF4L0",183,0)
 ;
"RTN","XUMF4L1")
0^10^B34238171
"RTN","XUMF4L1",1,0)
XUMF4L1 ;OIFO-OAK/RAM - Load IMF ;02/21/02
"RTN","XUMF4L1",2,0)
 ;;8.0;KERNEL;**217**;Jul 10, 1995
"RTN","XUMF4L1",3,0)
 ;
"RTN","XUMF4L1",4,0)
 ;
"RTN","XUMF4L1",5,0)
EN ; -- entry point
"RTN","XUMF4L1",6,0)
 ;
"RTN","XUMF4L1",7,0)
 K ^TMP("XUMF ADD",$J),^TMP("XUMF MOD",$J),^TMP("XUMF DEL",$J)
"RTN","XUMF4L1",8,0)
 ;
"RTN","XUMF4L1",9,0)
 D DSN,GOLD,ASSC,HIST
"RTN","XUMF4L1",10,0)
 ;
"RTN","XUMF4L1",11,0)
 Q
"RTN","XUMF4L1",12,0)
 ;
"RTN","XUMF4L1",13,0)
DSN ; -- clean out local station numbers
"RTN","XUMF4L1",14,0)
 ;
"RTN","XUMF4L1",15,0)
 N IEN,DIE,DR,DA,XUMF,DIK
"RTN","XUMF4L1",16,0)
 ;
"RTN","XUMF4L1",17,0)
 S XUMF=1
"RTN","XUMF4L1",18,0)
 ;
"RTN","XUMF4L1",19,0)
 S IEN=0
"RTN","XUMF4L1",20,0)
 F  S IEN=$O(^DIC(4,IEN)) Q:'IEN  D
"RTN","XUMF4L1",21,0)
 .S STA=$P($G(^DIC(4,+IEN,99)),U) Q:STA=""
"RTN","XUMF4L1",22,0)
 .Q:$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4L1",23,0)
 .S ^TMP("XUMF DEL",$J,STA,IEN)=""
"RTN","XUMF4L1",24,0)
 .S DR="99///@",DIE=4,DA=IEN
"RTN","XUMF4L1",25,0)
 .D
"RTN","XUMF4L1",26,0)
 ..N IEN D ^DIE
"RTN","XUMF4L1",27,0)
 ;
"RTN","XUMF4L1",28,0)
 S STA="",IEN=0
"RTN","XUMF4L1",29,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4L1",30,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4L1",31,0)
 ..Q:$P($G(^DIC(4,+IEN,99)),U)=STA
"RTN","XUMF4L1",32,0)
 ..K ^DIC(4,"D",STA,IEN)
"RTN","XUMF4L1",33,0)
 ;
"RTN","XUMF4L1",34,0)
 S DIK="^DIC(4,",DIK(1)="99^D" D ENALL^DIK
"RTN","XUMF4L1",35,0)
 ;
"RTN","XUMF4L1",36,0)
 Q
"RTN","XUMF4L1",37,0)
 ;
"RTN","XUMF4L1",38,0)
GOLD ; -- add missing national data from standard table
"RTN","XUMF4L1",39,0)
 ;
"RTN","XUMF4L1",40,0)
 N STA,NAME,FDA,ERROR,IEN,IENS,X,FLAG,CNT
"RTN","XUMF4L1",41,0)
 N OLDNAME,OLDVANM,STATE,FACTYP,XUMF
"RTN","XUMF4L1",42,0)
 ;
"RTN","XUMF4L1",43,0)
 S XUMF=1
"RTN","XUMF4L1",44,0)
 ;
"RTN","XUMF4L1",45,0)
 S STA="",CNT=0
"RTN","XUMF4L1",46,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4L1",47,0)
 .S X=^TMP("XUMF ARRAY",$J,STA)
"RTN","XUMF4L1",48,0)
 .S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4L1",49,0)
 .S:'IEN ^TMP("XUMF ADD",$J,STA)=^TMP("XUMF ARRAY",$J,STA)
"RTN","XUMF4L1",50,0)
 .D:IEN MOD
"RTN","XUMF4L1",51,0)
 .S OLDNAME=$P($G(^DIC(4,+IEN,0)),U,1)
"RTN","XUMF4L1",52,0)
 .S OLDVANM=$P($G(^DIC(4,+IEN,99)),U,3)
"RTN","XUMF4L1",53,0)
 .S IENS=$S(IEN:IEN_",",1:"+1,")
"RTN","XUMF4L1",54,0)
 .S NAME=$P(X,U,2)
"RTN","XUMF4L1",55,0)
 .S FACTYP=$P(X,U,5)
"RTN","XUMF4L1",56,0)
 .S VANAME=$P(X,U,6)
"RTN","XUMF4L1",57,0)
 .S FLAG=$P(X,U,7)
"RTN","XUMF4L1",58,0)
 .S STATE=$P(X,U,8)
"RTN","XUMF4L1",59,0)
 .K FDA
"RTN","XUMF4L1",60,0)
 .S FDA(4,IENS,.01)=NAME
"RTN","XUMF4L1",61,0)
 .S FDA(4,IENS,.02)=STATE
"RTN","XUMF4L1",62,0)
 .S FDA(4,IENS,99)=STA
"RTN","XUMF4L1",63,0)
 .S FDA(4,IENS,11)="National"
"RTN","XUMF4L1",64,0)
 .S FDA(4,IENS,13)=$P(FACTYP,"~")
"RTN","XUMF4L1",65,0)
 .S FDA(4,IENS,100)=VANAME
"RTN","XUMF4L1",66,0)
 .S FDA(4,IENS,101)=FLAG
"RTN","XUMF4L1",67,0)
 .D
"RTN","XUMF4L1",68,0)
 ..N IEN,STA,NAME,VANAME,OLDNAME,OLDVANM
"RTN","XUMF4L1",69,0)
 ..D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF4L1",70,0)
 .I 'IEN S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4L1",71,0)
 .Q:'IEN
"RTN","XUMF4L1",72,0)
 .I OLDNAME="" Q
"RTN","XUMF4L1",73,0)
 .I OLDNAME=NAME,VANAME=OLDVANM Q
"RTN","XUMF4L1",74,0)
 .S IENS="?+"_DT_","_IEN_","
"RTN","XUMF4L1",75,0)
 .K FDA
"RTN","XUMF4L1",76,0)
 .S FDA(4.999,IENS,.01)=DT
"RTN","XUMF4L1",77,0)
 .S:NAME'=OLDNAME FDA(4.999,IENS,.02)=OLDNAME
"RTN","XUMF4L1",78,0)
 .S:VANAME'=OLDVANM FDA(4.999,IENS,.03)=OLDVANM
"RTN","XUMF4L1",79,0)
 .D
"RTN","XUMF4L1",80,0)
 ..N STA
"RTN","XUMF4L1",81,0)
 ..D UPDATE^DIE("E","FDA")
"RTN","XUMF4L1",82,0)
 ..S CNT=CNT+1
"RTN","XUMF4L1",83,0)
 ;
"RTN","XUMF4L1",84,0)
 Q
"RTN","XUMF4L1",85,0)
 ;
"RTN","XUMF4L1",86,0)
ASSC ; -- populate associations (parent facility and VISN)
"RTN","XUMF4L1",87,0)
 ;
"RTN","XUMF4L1",88,0)
 N IEN,STA,VISN,PARENT,FDA,XUMF,CNT
"RTN","XUMF4L1",89,0)
 ;
"RTN","XUMF4L1",90,0)
 S XUMF=1
"RTN","XUMF4L1",91,0)
 ;
"RTN","XUMF4L1",92,0)
 S STA="",CNT=0
"RTN","XUMF4L1",93,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4L1",94,0)
 .S IEN=$O(^DIC(4,"D",STA,0)) Q:'IEN
"RTN","XUMF4L1",95,0)
 .S VISN=$P(^TMP("XUMF ARRAY",$J,STA),U,9)
"RTN","XUMF4L1",96,0)
 .I VISN'="" D
"RTN","XUMF4L1",97,0)
 ..K FDA
"RTN","XUMF4L1",98,0)
 ..S IENS="?+1,"_IEN_","
"RTN","XUMF4L1",99,0)
 ..S FDA(4.014,IENS,.01)="VISN"
"RTN","XUMF4L1",100,0)
 ..S FDA(4.014,IENS,1)=$P(VISN,"~")
"RTN","XUMF4L1",101,0)
 ..D
"RTN","XUMF4L1",102,0)
 ...N IEN,STA
"RTN","XUMF4L1",103,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4L1",104,0)
 .S PARENT=$P(^TMP("XUMF ARRAY",$J,STA),U,10)
"RTN","XUMF4L1",105,0)
 .I PARENT'="" D
"RTN","XUMF4L1",106,0)
 ..K FDA
"RTN","XUMF4L1",107,0)
 ..S IENS="?+2,"_IEN_","
"RTN","XUMF4L1",108,0)
 ..S FDA(4.014,IENS,.01)="PARENT FACILITY"
"RTN","XUMF4L1",109,0)
 ..S FDA(4.014,IENS,1)=PARENT
"RTN","XUMF4L1",110,0)
 ..D
"RTN","XUMF4L1",111,0)
 ...N IEN,STA
"RTN","XUMF4L1",112,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4L1",113,0)
 ...S CNT=CNT+1
"RTN","XUMF4L1",114,0)
 ;
"RTN","XUMF4L1",115,0)
 Q
"RTN","XUMF4L1",116,0)
 ;
"RTN","XUMF4L1",117,0)
HIST ; -- history
"RTN","XUMF4L1",118,0)
 ;
"RTN","XUMF4L1",119,0)
 N IEN,STA,EFFDT,FDA,XUMF,CNT
"RTN","XUMF4L1",120,0)
 ;
"RTN","XUMF4L1",121,0)
 S XUMF=1
"RTN","XUMF4L1",122,0)
 ;
"RTN","XUMF4L1",123,0)
 S STA="",CNT=0
"RTN","XUMF4L1",124,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4L1",125,0)
 .S IEN=$O(^DIC(4,"D",STA,0)) Q:'IEN
"RTN","XUMF4L1",126,0)
 .S EFFDT=$P(^TMP("XUMF ARRAY",$J,STA),U,11)
"RTN","XUMF4L1",127,0)
 .S EFFDT=$$FMDATE^HLFNC(+EFFDT)
"RTN","XUMF4L1",128,0)
 .I EFFDT D
"RTN","XUMF4L1",129,0)
 ..S IENS="?+"_EFFDT_","_IEN_","
"RTN","XUMF4L1",130,0)
 ..K FDA
"RTN","XUMF4L1",131,0)
 ..S FDA(4.999,IENS,.01)=EFFDT
"RTN","XUMF4L1",132,0)
 ..S FDA(4.999,IENS,.06)=$P(^TMP("XUMF ARRAY",$J,STA),U,12)
"RTN","XUMF4L1",133,0)
 ..D
"RTN","XUMF4L1",134,0)
 ...N IEN,STA
"RTN","XUMF4L1",135,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4L1",136,0)
 .S EFFDT=$P(^TMP("XUMF ARRAY",$J,STA),U,13)
"RTN","XUMF4L1",137,0)
 .S EFFDT=$$FMDATE^HLFNC(+EFFDT)
"RTN","XUMF4L1",138,0)
 .I EFFDT D
"RTN","XUMF4L1",139,0)
 ..S IENS="?+"_EFFDT_","_IEN_","
"RTN","XUMF4L1",140,0)
 ..K FDA
"RTN","XUMF4L1",141,0)
 ..S FDA(4.999,IENS,.01)=EFFDT
"RTN","XUMF4L1",142,0)
 ..S FDA(4.999,IENS,.05)=$P(^TMP("XUMF ARRAY",$J,STA),U,14)
"RTN","XUMF4L1",143,0)
 ..D
"RTN","XUMF4L1",144,0)
 ...N IEN,STA
"RTN","XUMF4L1",145,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4L1",146,0)
 ...S CNT=CNT+1
"RTN","XUMF4L1",147,0)
 ;
"RTN","XUMF4L1",148,0)
 Q
"RTN","XUMF4L1",149,0)
 ;
"RTN","XUMF4L1",150,0)
CDSN() ; -- check for duplicate sta # (true=duplicates, false=none)
"RTN","XUMF4L1",151,0)
 ;
"RTN","XUMF4L1",152,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4L1",153,0)
 ;
"RTN","XUMF4L1",154,0)
 N IEN,STA,CNT
"RTN","XUMF4L1",155,0)
 ;
"RTN","XUMF4L1",156,0)
 S STA="",IEN=0
"RTN","XUMF4L1",157,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4L1",158,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4L1",159,0)
 ..S ^TMP("XUMF TMP",$J,STA,IEN)=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4L1",160,0)
 ;
"RTN","XUMF4L1",161,0)
 S STA="",(CNT,IEN)=0
"RTN","XUMF4L1",162,0)
 F  S STA=$O(^TMP("XUMF TMP",$J,STA)) Q:STA=""  D
"RTN","XUMF4L1",163,0)
 .Q:'$O(^TMP("XUMF TMP",$J,STA,+$O(^TMP("XUMF TMP",$J,STA,0))))
"RTN","XUMF4L1",164,0)
 .F  S IEN=$O(^TMP("XUMF TMP",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4L1",165,0)
 ..S CNT=CNT+1
"RTN","XUMF4L1",166,0)
 ;
"RTN","XUMF4L1",167,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4L1",168,0)
 ;
"RTN","XUMF4L1",169,0)
 Q CNT
"RTN","XUMF4L1",170,0)
 ;
"RTN","XUMF4L1",171,0)
MOD ; if entry modified set TMP
"RTN","XUMF4L1",172,0)
 ;
"RTN","XUMF4L1",173,0)
 N NAME,FACTYP,VANAME,STANUM,FLAG,PRNT,VISN,STATE,X,Y
"RTN","XUMF4L1",174,0)
 ;
"RTN","XUMF4L1",175,0)
 Q:'$D(^DIC(4,+IEN,0))
"RTN","XUMF4L1",176,0)
 ;
"RTN","XUMF4L1",177,0)
 S X=$P(^TMP("XUMF ARRAY",$J,STA),U,2,10)
"RTN","XUMF4L1",178,0)
 ;
"RTN","XUMF4L1",179,0)
 S NAME=$P($G(^DIC(4,+IEN,0)),U)
"RTN","XUMF4L1",180,0)
 S FACTYP=$P($G(^DIC(4.1,+$G(^DIC(4,+IEN,3)),0)),U)
"RTN","XUMF4L1",181,0)
 S:FACTYP'="" FACTYP=FACTYP_"~FACILITY TYPE~VA"
"RTN","XUMF4L1",182,0)
 S VANAME=$P($G(^DIC(4,+IEN,99)),U,3)
"RTN","XUMF4L1",183,0)
 S STANUM=$P($G(^DIC(4,+IEN,99)),U)
"RTN","XUMF4L1",184,0)
 S FLAG=$S(+$P($G(^DIC(4,+IEN,99)),U,4):"INACTIVE",1:"")
"RTN","XUMF4L1",185,0)
 S PRNT=$P($G(^DIC(4,+$P($G(^DIC(4,+IEN,7,2,0)),U,2),99)),U)
"RTN","XUMF4L1",186,0)
 S VISN=$P($G(^DIC(4,+$P($G(^DIC(4,+IEN,7,1,0)),U,2),0)),U)
"RTN","XUMF4L1",187,0)
 S:VISN'="" VISN=VISN_"~VISN~VA"
"RTN","XUMF4L1",188,0)
 S STATE=$P($G(^DIC(5,+$P($G(^DIC(4,+IEN,0)),U,2),0)),U)
"RTN","XUMF4L1",189,0)
 ;
"RTN","XUMF4L1",190,0)
 S Y=NAME_U_STANUM_U_"National"_U_FACTYP_U_VANAME_U_FLAG_U_STATE
"RTN","XUMF4L1",191,0)
 S Y=Y_U_VISN_U_PRNT
"RTN","XUMF4L1",192,0)
 ;
"RTN","XUMF4L1",193,0)
 Q:Y=X
"RTN","XUMF4L1",194,0)
 ;
"RTN","XUMF4L1",195,0)
 S ^TMP("XUMF MOD",$J,STA,"NEW")=X
"RTN","XUMF4L1",196,0)
 S ^TMP("XUMF MOD",$J,STA,"OLD")=Y
"RTN","XUMF4L1",197,0)
 ;
"RTN","XUMF4L1",198,0)
 Q
"RTN","XUMF4L1",199,0)
 ;
"RTN","XUMF4L1",200,0)
FTCLEAN ; -- add missing facility types
"RTN","XUMF4L1",201,0)
 ;
"RTN","XUMF4L1",202,0)
 N NAME,FULL,FDA
"RTN","XUMF4L1",203,0)
 ;
"RTN","XUMF4L1",204,0)
 S NAME=""
"RTN","XUMF4L1",205,0)
 F  S NAME=$O(^TMP("XUMF ARRAY",$J,NAME)) Q:NAME=""  D
"RTN","XUMF4L1",206,0)
 .S FULL=$P(^TMP("XUMF ARRAY",$J,NAME),U,3)
"RTN","XUMF4L1",207,0)
 .D
"RTN","XUMF4L1",208,0)
 ..K FDA
"RTN","XUMF4L1",209,0)
 ..S FDA(4.1,"?+1,",.01)=NAME
"RTN","XUMF4L1",210,0)
 ..S FDA(4.1,"?+1,",1)=FULL
"RTN","XUMF4L1",211,0)
 ..S FDA(4.1,"?+1,",3)="N"
"RTN","XUMF4L1",212,0)
 ..N NAME
"RTN","XUMF4L1",213,0)
 ..D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF4L1",214,0)
 ;
"RTN","XUMF4L1",215,0)
 Q
"RTN","XUMF4L1",216,0)
 ;
"RTN","XUMF4L2")
0^11^B21865279
"RTN","XUMF4L2",1,0)
XUMF4L2 ;OIFO-OAK/RAM - Load IMF ;02/21/02
"RTN","XUMF4L2",2,0)
 ;;8.0;KERNEL;**217**;Jul 10, 1995
"RTN","XUMF4L2",3,0)
 ;
"RTN","XUMF4L2",4,0)
 ; $$PARAM^HLCS2 call supported by IA #3552
"RTN","XUMF4L2",5,0)
 ;
"RTN","XUMF4L2",6,0)
LOCAL ; -- status message to site
"RTN","XUMF4L2",7,0)
 ;
"RTN","XUMF4L2",8,0)
 I '$$ADD,'$$DEL,'$$MOD Q
"RTN","XUMF4L2",9,0)
 ;
"RTN","XUMF4L2",10,0)
 N XMSUB,TEXT,XMDUZ,XMY,XMTEXT,I,ZIN
"RTN","XUMF4L2",11,0)
 ;
"RTN","XUMF4L2",12,0)
 S ZIN="NAME^STATION NUMBER^STATUS^FACILITY TYPE^OFFICIAL VA NAME"
"RTN","XUMF4L2",13,0)
 S ZIN=ZIN_"^INACTIVE FACILITY FLAG^STATE^VISN^PARENT FACILITY"
"RTN","XUMF4L2",14,0)
 ;
"RTN","XUMF4L2",15,0)
 S I=0
"RTN","XUMF4L2",16,0)
 ;
"RTN","XUMF4L2",17,0)
 S I=I+1,TEXT(I)="A backgroud job just updated your Institution file"
"RTN","XUMF4L2",18,0)
 S I=I+1,TEXT(I)="with data from the Institution Master File (IMF)"
"RTN","XUMF4L2",19,0)
 S I=I+1,TEXT(I)="on FORUM."
"RTN","XUMF4L2",20,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",21,0)
 S I=I+1,TEXT(I)="This job was a special task to insure sites that"
"RTN","XUMF4L2",22,0)
 S I=I+1,TEXT(I)="have already run the cleanup are up-to-date with"
"RTN","XUMF4L2",23,0)
 S I=I+1,TEXT(I)="all updates."
"RTN","XUMF4L2",24,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",25,0)
 S I=I+1,TEXT(I)="These updates were broadcast previously, but your"
"RTN","XUMF4L2",26,0)
 S I=I+1,TEXT(I)="site may not have received them due to enabling"
"RTN","XUMF4L2",27,0)
 S I=I+1,TEXT(I)="and/or disabling broadcasting to sites for various"
"RTN","XUMF4L2",28,0)
 S I=I+1,TEXT(I)="reasons."
"RTN","XUMF4L2",29,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",30,0)
 S I=I+1,TEXT(I)="This message has three sections (in addition to this"
"RTN","XUMF4L2",31,0)
 S I=I+1,TEXT(I)="initial text.)  The first section lists entries that"
"RTN","XUMF4L2",32,0)
 S I=I+1,TEXT(I)="have been added to your file.  The second section"
"RTN","XUMF4L2",33,0)
 S I=I+1,TEXT(I)="lists existing entries that have modified.  The third"
"RTN","XUMF4L2",34,0)
 S I=I+1,TEXT(I)="section lists entries that have had their STATUS (#11)"
"RTN","XUMF4L2",35,0)
 S I=I+1,TEXT(I)="changed from National to Local and their STATION"
"RTN","XUMF4L2",36,0)
 S I=I+1,TEXT(I)="NUMBER (#99) removed (was never a valid sta #.)"
"RTN","XUMF4L2",37,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",38,0)
 S I=I+1,TEXT(I)="The lists are in Station Number order and are up-arrow"
"RTN","XUMF4L2",39,0)
 S I=I+1,TEXT(I)="delimited strings in the HL7 Institution segment"
"RTN","XUMF4L2",40,0)
 S I=I+1,TEXT(I)="format.  The values correspond to the FileMan fields"
"RTN","XUMF4L2",41,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",42,0)
 S I=I+1,TEXT(I)=ZIN
"RTN","XUMF4L2",43,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",44,0)
 ;
"RTN","XUMF4L2",45,0)
 S I=I+1,TEXT(I)="SECTION ONE"
"RTN","XUMF4L2",46,0)
 S I=I+1,TEXT(I)="The following entries were ADDED:"
"RTN","XUMF4L2",47,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",48,0)
 I $$ADD=0 S I=I+1,TEXT(I)="None.",I=I+1,TEXT(I)=""
"RTN","XUMF4L2",49,0)
 I $$ADD D
"RTN","XUMF4L2",50,0)
 .N STA S STA=""
"RTN","XUMF4L2",51,0)
 .F  S STA=$O(^TMP("XUMF ADD",$J,STA)) Q:STA=""  D
"RTN","XUMF4L2",52,0)
 ..S I=I+1,TEXT(I)=$P(^TMP("XUMF ADD",$J,STA),U,2,10)
"RTN","XUMF4L2",53,0)
 ;
"RTN","XUMF4L2",54,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",55,0)
 S I=I+1,TEXT(I)="SECTION TWO"
"RTN","XUMF4L2",56,0)
 S I=I+1,TEXT(I)="The following entries were MODIFIED (old/new value):"
"RTN","XUMF4L2",57,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",58,0)
 I $$MOD=0 S I=I+1,TEXT(I)="None.",I=I+1,TEXT(I)=""
"RTN","XUMF4L2",59,0)
 I $$MOD D
"RTN","XUMF4L2",60,0)
 .N STA S STA=""
"RTN","XUMF4L2",61,0)
 .F  S STA=$O(^TMP("XUMF MOD",$J,STA)) Q:STA=""  D
"RTN","XUMF4L2",62,0)
 ..S I=I+1,TEXT(I)=^TMP("XUMF MOD",$J,STA,"OLD")
"RTN","XUMF4L2",63,0)
 ..S I=I+1,TEXT(I)=^TMP("XUMF MOD",$J,STA,"NEW")
"RTN","XUMF4L2",64,0)
 ..S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",65,0)
 ;
"RTN","XUMF4L2",66,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",67,0)
 S I=I+1,TEXT(I)="SECTION THREE"
"RTN","XUMF4L2",68,0)
 S I=I+1,TEXT(I)="The following STATION NUMBERS were removed:"
"RTN","XUMF4L2",69,0)
 S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",70,0)
 I $$DEL=0 S I=I+1,TEXT(I)="None.",I=I+1,TEXT(I)=""
"RTN","XUMF4L2",71,0)
 I $$DEL D
"RTN","XUMF4L2",72,0)
 .N STA S STA=""
"RTN","XUMF4L2",73,0)
 .F  S STA=$O(^TMP("XUMF DEL",$J,STA)) Q:STA=""  D
"RTN","XUMF4L2",74,0)
 ..S I=I+1,TEXT(I)=" STA: "_STA_" IEN: "_$O(^TMP("XUMF DEL",$J,STA,0))
"RTN","XUMF4L2",75,0)
 .S I=I+1,TEXT(I)=""
"RTN","XUMF4L2",76,0)
 .S I=I+1,TEXT(I)="Note: Just the STATION NUMBER (#99) was removed"
"RTN","XUMF4L2",77,0)
 .S I=I+1,TEXT(I)="and the STATUS (#11) changed to Local.  The entry"
"RTN","XUMF4L2",78,0)
 .S I=I+1,TEXT(I)="itself was NOT deleted."
"RTN","XUMF4L2",79,0)
 ;
"RTN","XUMF4L2",80,0)
 S XMSUB="IFR/cleanup/updates at "_$$SITE
"RTN","XUMF4L2",81,0)
 S XMDUZ=$S(DUZ:DUZ,1:.5)
"RTN","XUMF4L2",82,0)
 S XMTEXT="TEXT("
"RTN","XUMF4L2",83,0)
 S XMY("G.XUMF INSTITUTION")=""
"RTN","XUMF4L2",84,0)
 S:$P($$PARAM^HLCS2,U,3)'="T" XMY("G.XUMF INSTITUTION@FORUM")=""
"RTN","XUMF4L2",85,0)
 D ^XMD
"RTN","XUMF4L2",86,0)
 Q
"RTN","XUMF4L2",87,0)
 ;
"RTN","XUMF4L2",88,0)
NVS ; -- status message to NVS
"RTN","XUMF4L2",89,0)
 ;
"RTN","XUMF4L2",90,0)
 N XMSUB,TEXT,XMDUZ,XMY,XMTEXT
"RTN","XUMF4L2",91,0)
 ;
"RTN","XUMF4L2",92,0)
 S TEXT(1)=$$SITE
"RTN","XUMF4L2",93,0)
 S TEXT(2)=""
"RTN","XUMF4L2",94,0)
 S TEXT(3)="Station numbers added: "_$$ADD
"RTN","XUMF4L2",95,0)
 S TEXT(4)="              deleted: "_$$DEL
"RTN","XUMF4L2",96,0)
 S TEXT(5)="File entries modified: "_$$MOD
"RTN","XUMF4L2",97,0)
 ;
"RTN","XUMF4L2",98,0)
 S XMSUB="IFR/cleanup/status at "_$$SITE
"RTN","XUMF4L2",99,0)
 S XMDUZ=$S(DUZ:DUZ,1:.5)
"RTN","XUMF4L2",100,0)
 S XMTEXT="TEXT("
"RTN","XUMF4L2",101,0)
 S XMY("G.XUMF INSTITUTION")=""
"RTN","XUMF4L2",102,0)
 S:$P($$PARAM^HLCS2,U,3)'="T" XMY("G.XUMF INSTITUTION@FORUM")=""
"RTN","XUMF4L2",103,0)
 D ^XMD
"RTN","XUMF4L2",104,0)
 ;
"RTN","XUMF4L2",105,0)
 Q
"RTN","XUMF4L2",106,0)
 ;
"RTN","XUMF4L2",107,0)
SITE() ; -- facility name and sta # string
"RTN","XUMF4L2",108,0)
 ;
"RTN","XUMF4L2",109,0)
 Q $P($G(^DIC(4,+DUZ(2),0)),U)_" Sta#: "_$P($G(^DIC(4,+DUZ(2),99)),U)
"RTN","XUMF4L2",110,0)
 ;
"RTN","XUMF4L2",111,0)
ADD() ; -- added sta #
"RTN","XUMF4L2",112,0)
 ;
"RTN","XUMF4L2",113,0)
 N STA,CNT
"RTN","XUMF4L2",114,0)
 S STA="",CNT=0
"RTN","XUMF4L2",115,0)
 F  S STA=$O(^TMP("XUMF ADD",$J,STA)) Q:STA=""  S CNT=CNT+1
"RTN","XUMF4L2",116,0)
 Q CNT
"RTN","XUMF4L2",117,0)
 ;
"RTN","XUMF4L2",118,0)
MOD() ; -- modified entries
"RTN","XUMF4L2",119,0)
 ;
"RTN","XUMF4L2",120,0)
 N STA,CNT
"RTN","XUMF4L2",121,0)
 S STA="",CNT=0
"RTN","XUMF4L2",122,0)
 F  S STA=$O(^TMP("XUMF MOD",$J,STA)) Q:STA=""  S CNT=CNT+1
"RTN","XUMF4L2",123,0)
 Q CNT
"RTN","XUMF4L2",124,0)
 ;
"RTN","XUMF4L2",125,0)
DEL() ; -- removed sta #
"RTN","XUMF4L2",126,0)
 ;
"RTN","XUMF4L2",127,0)
 N STA,CNT
"RTN","XUMF4L2",128,0)
 S STA="",CNT=0
"RTN","XUMF4L2",129,0)
 F  S STA=$O(^TMP("XUMF DEL",$J,STA)) Q:STA=""  S CNT=CNT+1
"RTN","XUMF4L2",130,0)
 Q CNT
"RTN","XUMF4L2",131,0)
 ;
"RTN","XUMFEIMF")
0^6^B8103470
"RTN","XUMFEIMF",1,0)
XUMFEIMF ;CIOFO-SF/RAM - Edit IMF address locally ;06/28/00
"RTN","XUMFEIMF",2,0)
 ;;8.0;KERNEL;**217**;Jul 10, 1995
"RTN","XUMFEIMF",3,0)
 ;
"RTN","XUMFEIMF",4,0)
 ; $$PARAM^HLCS2 call supported by IA #3552
"RTN","XUMFEIMF",5,0)
 ;
"RTN","XUMFEIMF",6,0)
 Q
"RTN","XUMFEIMF",7,0)
 ;
"RTN","XUMFEIMF",8,0)
EN ; entry point
"RTN","XUMFEIMF",9,0)
 ;
"RTN","XUMFEIMF",10,0)
 K ^TMP("XUMF MFS",$J),^TMP("HLS",$J),^TMP("HLA",$J),PARAM
"RTN","XUMFEIMF",11,0)
 D CLEAN^DILF
"RTN","XUMFEIMF",12,0)
 ;
"RTN","XUMFEIMF",13,0)
 ;
"RTN","XUMFEIMF",14,0)
 S TEST=0
"RTN","XUMFEIMF",15,0)
 ;
"RTN","XUMFEIMF",16,0)
 I $P($$PARAM^HLCS2,U,3)="T" S TEST=1
"RTN","XUMFEIMF",17,0)
 ;
"RTN","XUMFEIMF",18,0)
 ;
"RTN","XUMFEIMF",19,0)
 S XUMF=1,FLAG=0
"RTN","XUMFEIMF",20,0)
 ;
"RTN","XUMFEIMF",21,0)
 K DIR
"RTN","XUMFEIMF",22,0)
 S DIR(0)="F^3:7^K:'(X?3N.AN) X"
"RTN","XUMFEIMF",23,0)
 S DIR("A")="Enter Station Number"
"RTN","XUMFEIMF",24,0)
 D ^DIR Q:$G(DIRUT)
"RTN","XUMFEIMF",25,0)
 ;
"RTN","XUMFEIMF",26,0)
 S STA=Y
"RTN","XUMFEIMF",27,0)
 ;
"RTN","XUMFEIMF",28,0)
 S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMFEIMF",29,0)
 ;
"RTN","XUMFEIMF",30,0)
 L +^DIC(4,IEN):0 I '$T D  G EN
"RTN","XUMFEIMF",31,0)
 .W !,"Another user is editing this entry.",!
"RTN","XUMFEIMF",32,0)
 .D EXIT
"RTN","XUMFEIMF",33,0)
 ;
"RTN","XUMFEIMF",34,0)
 I 'IEN W !,"...not an existing Station Number," G EN
"RTN","XUMFEIMF",35,0)
 I $E($$STA^XUAF4(+$G(DUZ(2))),1,3)'=$E(STA,1,3) D  Q
"RTN","XUMFEIMF",36,0)
 .W !,"...this option may only be used to edit your facility or"
"RTN","XUMFEIMF",37,0)
 .W !,"   associated facilities.",!
"RTN","XUMFEIMF",38,0)
 .D EXIT
"RTN","XUMFEIMF",39,0)
 ;
"RTN","XUMFEIMF",40,0)
 S N0=$G(^DIC(4,+IEN,0))
"RTN","XUMFEIMF",41,0)
 S N1=$G(^DIC(4,+IEN,1))
"RTN","XUMFEIMF",42,0)
 S N4=$G(^DIC(4,+IEN,4))
"RTN","XUMFEIMF",43,0)
 ;
"RTN","XUMFEIMF",44,0)
EDIT ; -- address edit
"RTN","XUMFEIMF",45,0)
 ;
"RTN","XUMFEIMF",46,0)
 W !!,"Physical address:",!
"RTN","XUMFEIMF",47,0)
 S DIE=4,DA=IEN
"RTN","XUMFEIMF",48,0)
 S DR="1.01;1.03;.02;1.04"
"RTN","XUMFEIMF",49,0)
 D ^DIE
"RTN","XUMFEIMF",50,0)
 ;
"RTN","XUMFEIMF",51,0)
 W !!,"Mailing address:",!
"RTN","XUMFEIMF",52,0)
 S DIE=4,DA=IEN
"RTN","XUMFEIMF",53,0)
 S DR="4.01;4.03:4.05"
"RTN","XUMFEIMF",54,0)
 D ^DIE
"RTN","XUMFEIMF",55,0)
 W !
"RTN","XUMFEIMF",56,0)
 ;
"RTN","XUMFEIMF",57,0)
 D
"RTN","XUMFEIMF",58,0)
 .I $P($G(^DIC(4,+IEN,0)),U,2)'=$P($G(N0),U,2) S FLAG=1 Q
"RTN","XUMFEIMF",59,0)
 .I $G(^DIC(4,+IEN,1))'=$G(N1) S FLAG=1 Q
"RTN","XUMFEIMF",60,0)
 .I $G(^DIC(4,+IEN,4))'=$G(N4) S FLAG=1 Q
"RTN","XUMFEIMF",61,0)
 ;
"RTN","XUMFEIMF",62,0)
 I 'FLAG D EXIT G EN
"RTN","XUMFEIMF",63,0)
 ;
"RTN","XUMFEIMF",64,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","XUMFEIMF",65,0)
 S DIR("A")="Are you ready to update the Institution Master File"
"RTN","XUMFEIMF",66,0)
 D ^DIR K DIR
"RTN","XUMFEIMF",67,0)
 I $G(DIRUT) D  G EN
"RTN","XUMFEIMF",68,0)
 .W !!,"WARNING: You modified your entry without updating the IMF!"
"RTN","XUMFEIMF",69,0)
 G:'Y EDIT
"RTN","XUMFEIMF",70,0)
 ;
"RTN","XUMFEIMF",71,0)
 W !,"...send HL7 message to Master File Server..."
"RTN","XUMFEIMF",72,0)
 S PARAM("LLNK")="XUMF IMF MFK^XUMF "_$S('TEST:"FORUM",1:"TEST")
"RTN","XUMFEIMF",73,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF IMF MFN",0))
"RTN","XUMFEIMF",74,0)
 D MAIN^XUMFP(4,IEN,0,.PARAM,.ERROR) Q:ERROR
"RTN","XUMFEIMF",75,0)
 D MAIN^XUMFI(4,IEN,0,.PARAM,.ERROR)
"RTN","XUMFEIMF",76,0)
 ;
"RTN","XUMFEIMF",77,0)
 I $G(ERROR) W !,$G(ERROR),!
"RTN","XUMFEIMF",78,0)
 I '$G(ERROR) W !,"Sent."
"RTN","XUMFEIMF",79,0)
 ;
"RTN","XUMFEIMF",80,0)
 H 1
"RTN","XUMFEIMF",81,0)
 ;
"RTN","XUMFEIMF",82,0)
EXIT ; -- clean up
"RTN","XUMFEIMF",83,0)
 ;
"RTN","XUMFEIMF",84,0)
 L -^DIC(4,IEN)
"RTN","XUMFEIMF",85,0)
 ;
"RTN","XUMFEIMF",86,0)
 D CLEAN^DILF,KILL^XUSCLEAN
"RTN","XUMFEIMF",87,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J),^TMP("XUMF MFS",$J)
"RTN","XUMFEIMF",88,0)
 ;
"RTN","XUMFEIMF",89,0)
 K N0,N1,N4,XUMF,DIRUT,PARAM,DA,DR,DIE
"RTN","XUMFEIMF",90,0)
 K DIC,DIR,X,Y,NAME,STA,FLAG,IEN,TEST,ERROR
"RTN","XUMFEIMF",91,0)
 ;
"RTN","XUMFEIMF",92,0)
 Q
"RTN","XUMFEIMF",93,0)
 ;
"RTN","XUMFH")
0^4^B61429660
"RTN","XUMFH",1,0)
XUMFH ;CIOFO-SF/RAM - Master File HL7 Msg Handler ;06/28/00
"RTN","XUMFH",2,0)
 ;;8.0;KERNEL;**206,209,217**;Jul 10, 1995
"RTN","XUMFH",3,0)
 ;
"RTN","XUMFH",4,0)
 ; This routine handles Master File HL7 messages.
"RTN","XUMFH",5,0)
 ;
"RTN","XUMFH",6,0)
MAIN ; -- entry point
"RTN","XUMFH",7,0)
 ;
"RTN","XUMFH",8,0)
 N CNT,ERR,I,X,HLFS,HLCS,ERROR,HLRESLTA,IFN,IEN,MTPE,TYPE,ARRAY
"RTN","XUMFH",9,0)
 N HDT,KEY,MID,REASON,VALUE,XREF,ALL,GROUP,PARAM,ROOT,SEG,QRD
"RTN","XUMFH",10,0)
 N QID,WHAT,WHO
"RTN","XUMFH",11,0)
 ;
"RTN","XUMFH",12,0)
 D INIT,PROCESS,REPLY,EXIT
"RTN","XUMFH",13,0)
 ;
"RTN","XUMFH",14,0)
 Q
"RTN","XUMFH",15,0)
 ;
"RTN","XUMFH",16,0)
INIT ; -- initialize
"RTN","XUMFH",17,0)
 ;
"RTN","XUMFH",18,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","XUMFH",19,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",20,0)
 ;
"RTN","XUMFH",21,0)
 S (ERROR,CNT,TYPE,ARRAY)=0
"RTN","XUMFH",22,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH"))
"RTN","XUMFH",23,0)
 ;
"RTN","XUMFH",24,0)
 Q
"RTN","XUMFH",25,0)
 ;
"RTN","XUMFH",26,0)
PROCESS ; -- pull message text
"RTN","XUMFH",27,0)
 ;
"RTN","XUMFH",28,0)
 F  X HLNEXT Q:HLQUIT'>0  D
"RTN","XUMFH",29,0)
 .Q:$P(HLNODE,HLFS)=""
"RTN","XUMFH",30,0)
 .D @($P(HLNODE,HLFS))
"RTN","XUMFH",31,0)
 ;
"RTN","XUMFH",32,0)
 Q
"RTN","XUMFH",33,0)
 ;
"RTN","XUMFH",34,0)
MSH ; -- MSH segment
"RTN","XUMFH",35,0)
 ;
"RTN","XUMFH",36,0)
 Q
"RTN","XUMFH",37,0)
 ;
"RTN","XUMFH",38,0)
MSA ; -- MSA segment
"RTN","XUMFH",39,0)
 ;
"RTN","XUMFH",40,0)
 N CODE
"RTN","XUMFH",41,0)
 ;
"RTN","XUMFH",42,0)
 S CODE=$P(HLNODE,HLFS,2)
"RTN","XUMFH",43,0)
 ;
"RTN","XUMFH",44,0)
 I CODE="AE"!(CODE="AR") D
"RTN","XUMFH",45,0)
 .S ERROR=ERROR_U_$P(HLNODE,HLFS,4)_U_$G(ERR)
"RTN","XUMFH",46,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",47,0)
 ;
"RTN","XUMFH",48,0)
 Q
"RTN","XUMFH",49,0)
 ;
"RTN","XUMFH",50,0)
QRD ; -- QRD segment
"RTN","XUMFH",51,0)
 ;
"RTN","XUMFH",52,0)
 Q:ERROR
"RTN","XUMFH",53,0)
 ;
"RTN","XUMFH",54,0)
 S QRD="QRD,QDT,QFC,QP,QID,DRT,DRDT,QLR,WHO,WHAT,WDDC,WDCVQ,QRL"
"RTN","XUMFH",55,0)
 ;
"RTN","XUMFH",56,0)
 F I=2:1:13 S PARAM($P(QRD,",",I))=$P(HLNODE,HLFS,I)
"RTN","XUMFH",57,0)
 S QID=$P(HLNODE,HLFS,5)
"RTN","XUMFH",58,0)
 S WHO=$P(HLNODE,HLFS,9)
"RTN","XUMFH",59,0)
 I WHO="" D  Q
"RTN","XUMFH",60,0)
 .S ERROR="1^QRD segment has null missing WHO parameter"
"RTN","XUMFH",61,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",62,0)
 S WHAT=$P(HLNODE,HLFS,10)
"RTN","XUMFH",63,0)
 I WHAT="" D  Q
"RTN","XUMFH",64,0)
 .S ERROR="1^QRD segment has null missing WHAT parameter"
"RTN","XUMFH",65,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",66,0)
 ;
"RTN","XUMFH",67,0)
 S ARRAY=$S(QID["ARRAY":1,1:0)
"RTN","XUMFH",68,0)
 S ALL=$S(WHO["ALL":1,1:0)
"RTN","XUMFH",69,0)
 S GROUP=$S(ALL:1,(WHO["IEN"):1,1:0)
"RTN","XUMFH",70,0)
 ;
"RTN","XUMFH",71,0)
 S:ARRAY TYPE=$S(GROUP:7,1:3)
"RTN","XUMFH",72,0)
 S:'ARRAY TYPE=$S(GROUP:5,1:1)
"RTN","XUMFH",73,0)
 S:HL("MTN")="MFR" TYPE=TYPE+10
"RTN","XUMFH",74,0)
 ;
"RTN","XUMFH",75,0)
 S IFN=+WHAT
"RTN","XUMFH",76,0)
 S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",77,0)
 S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",78,0)
 S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",79,0)
 ;
"RTN","XUMFH",80,0)
 K:ARRAY ^TMP("XUMF ARRAY",$J)
"RTN","XUMFH",81,0)
 ;
"RTN","XUMFH",82,0)
 Q
"RTN","XUMFH",83,0)
 ;
"RTN","XUMFH",84,0)
MFI ; -- MFI segment
"RTN","XUMFH",85,0)
 ;
"RTN","XUMFH",86,0)
 Q:ERROR
"RTN","XUMFH",87,0)
 Q:$G(IFN)
"RTN","XUMFH",88,0)
 ;
"RTN","XUMFH",89,0)
 I $P(HLNODE,HLFS,2)="" D  Q
"RTN","XUMFH",90,0)
 .S ERROR="1^MFI segment missing Master File Identifier"
"RTN","XUMFH",91,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",92,0)
 S IFN=$$MFI^XUMFP($P(HLNODE,HLFS,2))
"RTN","XUMFH",93,0)
 I 'IFN D  Q
"RTN","XUMFH",94,0)
 .S ERROR="1^IFN in MFI could not be resolved"
"RTN","XUMFH",95,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",96,0)
 ;
"RTN","XUMFH",97,0)
 Q
"RTN","XUMFH",98,0)
 ;
"RTN","XUMFH",99,0)
MFE ; -- MFE segment
"RTN","XUMFH",100,0)
 ;
"RTN","XUMFH",101,0)
 Q:ERROR
"RTN","XUMFH",102,0)
 Q:$G(IEN)
"RTN","XUMFH",103,0)
 ;
"RTN","XUMFH",104,0)
 S KEY=$P(HLNODE,HLFS,5) Q:ARRAY
"RTN","XUMFH",105,0)
 S XREF=$P(KEY,HLCS,3)
"RTN","XUMFH",106,0)
 S:KEY IEN=$$FIND1^DIC(IFN,,"BX",$P(KEY,HLCS),XREF,,"ERR")
"RTN","XUMFH",107,0)
 S IEN=$S(IEN:IEN,KEY["ALL":"ALL",$G(ERR)'="":"ERROR",1:"NEW")
"RTN","XUMFH",108,0)
 I IEN="ERROR" D  Q
"RTN","XUMFH",109,0)
 .D EM("MFE segment couldn't resolve IEN",.ERR)
"RTN","XUMFH",110,0)
 .K ERR
"RTN","XUMFH",111,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",112,0)
 ;
"RTN","XUMFH",113,0)
 Q
"RTN","XUMFH",114,0)
 ;
"RTN","XUMFH",115,0)
ZIN ; -- VHA Institution segment
"RTN","XUMFH",116,0)
ZFT ; -- VHA Facility Type segment
"RTN","XUMFH",117,0)
LOC ; -- Location Identification segment
"RTN","XUMFH",118,0)
ZZZ ; -- get [Z...] segment(s)
"RTN","XUMFH",119,0)
 ;
"RTN","XUMFH",120,0)
 Q:ERROR
"RTN","XUMFH",121,0)
 ;
"RTN","XUMFH",122,0)
 I $G(ARRAY) D ARRAY Q
"RTN","XUMFH",123,0)
 ;
"RTN","XUMFH",124,0)
 N FDA,IENS,FIELD,ERR,PRE,POST,XUMF,MULT,FDA1,SEQ,SEQ1,SEQ2
"RTN","XUMFH",125,0)
 ;
"RTN","XUMFH",126,0)
 S PRE=$G(^TMP("XUMF MFS",$J,"PARAM","PRE"))
"RTN","XUMFH",127,0)
 D:PRE'="" @(PRE)
"RTN","XUMFH",128,0)
 ;
"RTN","XUMFH",129,0)
 S XUMF=7
"RTN","XUMFH",130,0)
 ;
"RTN","XUMFH",131,0)
 S SEG=$P(HLNODE,HLFS)
"RTN","XUMFH",132,0)
 S IENS=$S(IEN:IEN,1:"+1")_","
"RTN","XUMFH",133,0)
 S SEQ=0
"RTN","XUMFH",134,0)
 F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFH",135,0)
 .S SEQ1=$P(SEQ,"."),SEQ2=$P(SEQ,".",2)
"RTN","XUMFH",136,0)
 .S FIELD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFH",137,0)
 .I FIELD=".01" D
"RTN","XUMFH",138,0)
 ..N FDA,IEN1
"RTN","XUMFH",139,0)
 ..S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",140,0)
 ..S VALUE=$$VALUE(.HLNODE,SEQ1)
"RTN","XUMFH",141,0)
 ..S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",142,0)
 ..S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",143,0)
 ..S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",144,0)
 ..D UPDATE^DIE("E","FDA","IEN1","ERR")
"RTN","XUMFH",145,0)
 ..I $D(ERR) D
"RTN","XUMFH",146,0)
 ...D EM("update DIE call error message in ZZZ",.ERR)
"RTN","XUMFH",147,0)
 ...K ERR
"RTN","XUMFH",148,0)
 ..I $D(IEN1) S IENS=IEN1(1)_","
"RTN","XUMFH",149,0)
 .I 'FIELD D SUBFILE Q
"RTN","XUMFH",150,0)
 .S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",151,0)
 .S VALUE=$$VALUE(.HLNODE,SEQ)
"RTN","XUMFH",152,0)
 .S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",153,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",154,0)
 .S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",155,0)
 ;
"RTN","XUMFH",156,0)
 M FDA=FDA1
"RTN","XUMFH",157,0)
 ;
"RTN","XUMFH",158,0)
 D FILE^DIE("E","FDA","ERR")
"RTN","XUMFH",159,0)
 I $D(ERR) D
"RTN","XUMFH",160,0)
 .D EM("file DIE call error message in ZZZ",.ERR)
"RTN","XUMFH",161,0)
 .K ERR
"RTN","XUMFH",162,0)
 ;
"RTN","XUMFH",163,0)
 S POST=$G(^TMP("XUMF MFS",$J,"PARAM","POST"))
"RTN","XUMFH",164,0)
 D:POST'="" @(POST)
"RTN","XUMFH",165,0)
 ;
"RTN","XUMFH",166,0)
 Q
"RTN","XUMFH",167,0)
 ;
"RTN","XUMFH",168,0)
SUBFILE ; -- process subfile record
"RTN","XUMFH",169,0)
 ;
"RTN","XUMFH",170,0)
 N IFN,IENS1,KEY1,FIELD,TYP,MKEY,ERR
"RTN","XUMFH",171,0)
 ;
"RTN","XUMFH",172,0)
 S IFN=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFH",173,0)
 S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFH",174,0)
 S TYP=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"DTYP")
"RTN","XUMFH",175,0)
 S VALUE=$$VALUE(.HLNODE,SEQ)
"RTN","XUMFH",176,0)
 S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",177,0)
 S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",178,0)
 ;
"RTN","XUMFH",179,0)
 S MULT=$G(^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",SEQ))
"RTN","XUMFH",180,0)
 S MKEY=$G(^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",SEQ))
"RTN","XUMFH",181,0)
 I MULT=SEQ Q:VALUE=""  D
"RTN","XUMFH",182,0)
 .N FDA,IEN
"RTN","XUMFH",183,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=VALUE
"RTN","XUMFH",184,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",185,0)
 .I $D(ERR) D
"RTN","XUMFH",186,0)
 ..D EM("update DIE call error message in SUBFILE",.ERR)
"RTN","XUMFH",187,0)
 ..K ERR
"RTN","XUMFH",188,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",189,0)
 I 'MULT D
"RTN","XUMFH",190,0)
 .N FDA,IEN
"RTN","XUMFH",191,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=MKEY
"RTN","XUMFH",192,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",193,0)
 .I $D(ERR) D
"RTN","XUMFH",194,0)
 ..D EM("update DIE call error message in SUBFILE",.ERR)
"RTN","XUMFH",195,0)
 ..K ERR
"RTN","XUMFH",196,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",197,0)
 .S FDA1(IFN,IENS1,.01)=MKEY
"RTN","XUMFH",198,0)
 I MULT,MULT'=SEQ S IENS1=$G(MULT(+MULT)) Q:IENS1=""
"RTN","XUMFH",199,0)
 S FDA1(IFN,IENS1,FIELD)=VALUE
"RTN","XUMFH",200,0)
 ;
"RTN","XUMFH",201,0)
 Q
"RTN","XUMFH",202,0)
 ;
"RTN","XUMFH",203,0)
VALUE(HLNODE,SEQ) ; -- handle HL7 continuation nodes
"RTN","XUMFH",204,0)
 ;
"RTN","XUMFH",205,0)
 N I,X,Y,N,T,Z,NODE
"RTN","XUMFH",206,0)
 ;
"RTN","XUMFH",207,0)
 S SEQ=$P($G(SEQ),".") Q:'SEQ ""
"RTN","XUMFH",208,0)
 ;
"RTN","XUMFH",209,0)
 M Z=HLNODE
"RTN","XUMFH",210,0)
 S Z(0)=HLNODE
"RTN","XUMFH",211,0)
 ;
"RTN","XUMFH",212,0)
 S I=0
"RTN","XUMFH",213,0)
 F  S I=$O(Z(I)) Q:'I  D
"RTN","XUMFH",214,0)
 .Q:$E(Z(I),1)=HLFS
"RTN","XUMFH",215,0)
 .S X=$P(Z(I),HLFS)
"RTN","XUMFH",216,0)
 .S Y=$O(Z(I),-1)
"RTN","XUMFH",217,0)
 .S Z(Y)=Z(Y)_X
"RTN","XUMFH",218,0)
 .S:$L(Z(I),HLFS)'="" Z(I)=HLFS_$P(Z(I),HLFS,2,999)
"RTN","XUMFH",219,0)
 .K:$L(Z(I),HLFS)="" Z(I)
"RTN","XUMFH",220,0)
 ;
"RTN","XUMFH",221,0)
 S X=0
"RTN","XUMFH",222,0)
 F  S X=$O(Z(X)) Q:'X  D
"RTN","XUMFH",223,0)
 .S X(X)=$L(Z(X),HLFS)-1
"RTN","XUMFH",224,0)
 S X(0)=$L(Z,HLFS)-1
"RTN","XUMFH",225,0)
 ;
"RTN","XUMFH",226,0)
 S (X,N,T)=""
"RTN","XUMFH",227,0)
 F  S X=$O(X(X)) Q:X=""  D
"RTN","XUMFH",228,0)
 .S T=T+$P(X(X),U),N(T+1)=X
"RTN","XUMFH",229,0)
 ;
"RTN","XUMFH",230,0)
 S (X,Y)=""
"RTN","XUMFH",231,0)
 F  S X=$O(X(X)) Q:X=""  D
"RTN","XUMFH",232,0)
 .S $P(X(X),U,2)=Y
"RTN","XUMFH",233,0)
 .S Y=+X(X)+Y
"RTN","XUMFH",234,0)
 ;
"RTN","XUMFH",235,0)
 S NODE=$G(N(+$O(N(SEQ)))) Q:NODE="" ""
"RTN","XUMFH",236,0)
 ;
"RTN","XUMFH",237,0)
 ;Q:'NODE $P(HLNODE,HLFS,SEQ+1)
"RTN","XUMFH",238,0)
 Q $P(Z(NODE),HLFS,(SEQ-($P(X(NODE),U,2))+1))
"RTN","XUMFH",239,0)
 ;
"RTN","XUMFH",240,0)
ARRAY ; -- query data stored in array (not filed)
"RTN","XUMFH",241,0)
 ;
"RTN","XUMFH",242,0)
 I $G(KEY)="" D  Q
"RTN","XUMFH",243,0)
 .D EM("Null KEY found in the following segment: "_$E(HLNODE,1,80),.ERR)
"RTN","XUMFH",244,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH",245,0)
 ;
"RTN","XUMFH",246,0)
 M ^TMP("XUMF ARRAY",$J,$P(KEY,HLCS))=HLNODE
"RTN","XUMFH",247,0)
 ;
"RTN","XUMFH",248,0)
 Q
"RTN","XUMFH",249,0)
 ;
"RTN","XUMFH",250,0)
REPLY ; -- master file response
"RTN","XUMFH",251,0)
 ;
"RTN","XUMFH",252,0)
 Q:HL("MTN")="MFR"
"RTN","XUMFH",253,0)
 Q:HL("MTN")="MFK"
"RTN","XUMFH",254,0)
 ;
"RTN","XUMFH",255,0)
 S:(TYPE<10) TYPE=(TYPE+10)
"RTN","XUMFH",256,0)
 ;
"RTN","XUMFH",257,0)
 I HL("MTN")="MFQ" D
"RTN","XUMFH",258,0)
 .S IFN=+$G(WHAT) I 'IFN D  Q
"RTN","XUMFH",259,0)
 ..S ERROR="1^REPLY MFQ couldn't resolve IFN"
"RTN","XUMFH",260,0)
 ..D EM(ERROR,.ERR)
"RTN","XUMFH",261,0)
 .S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",262,0)
 .S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",263,0)
 .S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",264,0)
 ;
"RTN","XUMFH",265,0)
 S IFN=$G(IFN),IEN=$G(IEN)
"RTN","XUMFH",266,0)
 ;
"RTN","XUMFH",267,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",268,0)
 D MAIN^XUMFI(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",269,0)
 ;
"RTN","XUMFH",270,0)
 Q
"RTN","XUMFH",271,0)
 ;
"RTN","XUMFH",272,0)
EXIT ; -- cleanup, and quit
"RTN","XUMFH",273,0)
 ;
"RTN","XUMFH",274,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J),^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",275,0)
 ;
"RTN","XUMFH",276,0)
 Q
"RTN","XUMFH",277,0)
 ;
"RTN","XUMFH",278,0)
EM(ERROR,ERR,XMSUB,XMY) ; -- error message
"RTN","XUMFH",279,0)
 ;
"RTN","XUMFH",280,0)
 N X,XMTEXT,FLG
"RTN","XUMFH",281,0)
 ;
"RTN","XUMFH",282,0)
 S FLG=0
"RTN","XUMFH",283,0)
 ;
"RTN","XUMFH",284,0)
 D MSG^DIALOG("AM",.X,80,,"ERR")
"RTN","XUMFH",285,0)
 ;
"RTN","XUMFH",286,0)
 S X(.1)="HL7 message ID: "_$G(HL("MID"))
"RTN","XUMFH",287,0)
 S X(.2)="",X(.3)=$G(ERROR),X(.4)=""
"RTN","XUMFH",288,0)
 S:$G(XMSUB)="" XMSUB="MFS ERROR"
"RTN","XUMFH",289,0)
 S XMY("G.XUMF ERROR")=""
"RTN","XUMFH",290,0)
 S XMTEXT="X("
"RTN","XUMFH",291,0)
 ;
"RTN","XUMFH",292,0)
 S X=.9 F  S X=$O(X(X)) Q:'X  D
"RTN","XUMFH",293,0)
 .I X(X)="" K X(X) Q
"RTN","XUMFH",294,0)
 .I X(X)["DINUMed field cannot" S FLG=1 K X(X) Q
"RTN","XUMFH",295,0)
 ;
"RTN","XUMFH",296,0)
 I FLG Q:'$O(X(.9))
"RTN","XUMFH",297,0)
 ;
"RTN","XUMFH",298,0)
 D ^XMD
"RTN","XUMFH",299,0)
 ;
"RTN","XUMFH",300,0)
 Q
"RTN","XUMFH",301,0)
 ;
"RTN","XUMFH4")
0^5^B43861524
"RTN","XUMFH4",1,0)
XUMFH4 ;CIOFO-SF/RAM - FORUM IMF handler ;06/28/00
"RTN","XUMFH4",2,0)
 ;;8.0;KERNEL;**217**;Jul 10, 1995
"RTN","XUMFH4",3,0)
 ;
"RTN","XUMFH4",4,0)
 ; This routine handles Master File HL7 messages.
"RTN","XUMFH4",5,0)
 ;
"RTN","XUMFH4",6,0)
MAIN ; -- entry point
"RTN","XUMFH4",7,0)
 ;
"RTN","XUMFH4",8,0)
 N CNT,ERR,I,X,HLFS,HLCS,ERROR,HLRESLTA,IFN,IEN,MTPE,TYPE
"RTN","XUMFH4",9,0)
 N HDT,KEY,MID,VALUE,XREF,PARAM,ROOT,SEG
"RTN","XUMFH4",10,0)
 N HLSCS,SFAC
"RTN","XUMFH4",11,0)
 ;
"RTN","XUMFH4",12,0)
 D INIT,PROCESS,BG,REPLY,EXIT
"RTN","XUMFH4",13,0)
 ;
"RTN","XUMFH4",14,0)
 Q
"RTN","XUMFH4",15,0)
 ;
"RTN","XUMFH4",16,0)
INIT ; -- initialize
"RTN","XUMFH4",17,0)
 ;
"RTN","XUMFH4",18,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","XUMFH4",19,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH4",20,0)
 ;
"RTN","XUMFH4",21,0)
 S (ERROR,CNT,TYPE)=0
"RTN","XUMFH4",22,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH")),HLSCS=$E(HL("ECH"),4)
"RTN","XUMFH4",23,0)
 ;
"RTN","XUMFH4",24,0)
 Q
"RTN","XUMFH4",25,0)
 ;
"RTN","XUMFH4",26,0)
PROCESS ; -- pull message text
"RTN","XUMFH4",27,0)
 ;
"RTN","XUMFH4",28,0)
 F  X HLNEXT Q:HLQUIT'>0  D
"RTN","XUMFH4",29,0)
 .Q:$P(HLNODE,HLFS)=""
"RTN","XUMFH4",30,0)
 .D @($P(HLNODE,HLFS))
"RTN","XUMFH4",31,0)
 ;
"RTN","XUMFH4",32,0)
 Q
"RTN","XUMFH4",33,0)
 ;
"RTN","XUMFH4",34,0)
MSH ; -- MSH segment
"RTN","XUMFH4",35,0)
 ;
"RTN","XUMFH4",36,0)
 S SFAC=$P(HLNODE,HLFS,4)
"RTN","XUMFH4",37,0)
 ;
"RTN","XUMFH4",38,0)
 Q
"RTN","XUMFH4",39,0)
 ;
"RTN","XUMFH4",40,0)
MSA ; -- MSA segment
"RTN","XUMFH4",41,0)
 ;
"RTN","XUMFH4",42,0)
 N CODE
"RTN","XUMFH4",43,0)
 ;
"RTN","XUMFH4",44,0)
 S CODE=$P(HLNODE,HLFS,2)
"RTN","XUMFH4",45,0)
 ;
"RTN","XUMFH4",46,0)
 I CODE="AE"!(CODE="AR") D
"RTN","XUMFH4",47,0)
 .S ERROR=ERROR_U_$P(HLNODE,HLFS,4)_U_$G(ERR)
"RTN","XUMFH4",48,0)
 .D EM("MSA segement error/reject message")
"RTN","XUMFH4",49,0)
 ;
"RTN","XUMFH4",50,0)
 Q
"RTN","XUMFH4",51,0)
 ;
"RTN","XUMFH4",52,0)
MFI ; -- MFI segment
"RTN","XUMFH4",53,0)
 ;
"RTN","XUMFH4",54,0)
 Q:ERROR
"RTN","XUMFH4",55,0)
 Q:$G(IFN)
"RTN","XUMFH4",56,0)
 ;
"RTN","XUMFH4",57,0)
 I $P(HLNODE,HLFS,2)="" D  Q
"RTN","XUMFH4",58,0)
 .S ERROR="1^MFI segment missing Master File Identifier"
"RTN","XUMFH4",59,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH4",60,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH4",61,0)
 S IFN=$$MFI^XUMFP($P(HLNODE,HLFS,2))
"RTN","XUMFH4",62,0)
 I 'IFN D  Q
"RTN","XUMFH4",63,0)
 .S ERROR="1^IFN in MFI could not be resolved"
"RTN","XUMFH4",64,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH4",65,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH4",66,0)
 ;
"RTN","XUMFH4",67,0)
 Q
"RTN","XUMFH4",68,0)
 ;
"RTN","XUMFH4",69,0)
MFE ; -- MFE segment
"RTN","XUMFH4",70,0)
 ;
"RTN","XUMFH4",71,0)
 Q:ERROR
"RTN","XUMFH4",72,0)
 Q:$G(IEN)
"RTN","XUMFH4",73,0)
 ;
"RTN","XUMFH4",74,0)
 S KEY=$P(HLNODE,HLFS,5)
"RTN","XUMFH4",75,0)
 ;
"RTN","XUMFH4",76,0)
 I $E(KEY,1,3)'=$E(SFAC,1,3) D  Q
"RTN","XUMFH4",77,0)
 .S ERROR="1^sending facility not authorized to edit this entry"
"RTN","XUMFH4",78,0)
 .D EM(ERROR)
"RTN","XUMFH4",79,0)
 ;
"RTN","XUMFH4",80,0)
 S XREF=$P(KEY,HLCS,3)
"RTN","XUMFH4",81,0)
 S:KEY'="" IEN=$$FIND1^DIC(IFN,,"BX",$P(KEY,HLCS),XREF,,"ERR")
"RTN","XUMFH4",82,0)
 S IEN=$S(IEN:IEN,$G(ERR)'="":"ERROR",1:"NEW")
"RTN","XUMFH4",83,0)
 I IEN="ERROR" D  Q
"RTN","XUMFH4",84,0)
 .S ERROR="1^MFE segment couldn't resolve IEN"
"RTN","XUMFH4",85,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH4",86,0)
 .K ERR
"RTN","XUMFH4",87,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH4",88,0)
 ;
"RTN","XUMFH4",89,0)
 Q
"RTN","XUMFH4",90,0)
 ;
"RTN","XUMFH4",91,0)
ZIN ; -- VHA Institution segment
"RTN","XUMFH4",92,0)
ZFT ; -- VHA Facility Type
"RTN","XUMFH4",93,0)
ZZZ ; -- get [Z...] segment(s)
"RTN","XUMFH4",94,0)
 ;
"RTN","XUMFH4",95,0)
 Q:ERROR
"RTN","XUMFH4",96,0)
 ;
"RTN","XUMFH4",97,0)
 N FDA,IENS,FIELD,ERR,PRE,POST,XUMF,MULT,FDA1,SEQ,SEQ1,SEQ2
"RTN","XUMFH4",98,0)
 ;
"RTN","XUMFH4",99,0)
 S PRE=$G(^TMP("XUMF MFS",$J,"PARAM","PRE"))
"RTN","XUMFH4",100,0)
 D:PRE'="" @(PRE)
"RTN","XUMFH4",101,0)
 ;
"RTN","XUMFH4",102,0)
 S XUMF=1
"RTN","XUMFH4",103,0)
 ;
"RTN","XUMFH4",104,0)
 S SEG=$P(HLNODE,HLFS)
"RTN","XUMFH4",105,0)
 S IENS=$S(IEN:IEN,1:"+1")_","
"RTN","XUMFH4",106,0)
 S SEQ=0
"RTN","XUMFH4",107,0)
 F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFH4",108,0)
 .S SEQ1=$P(SEQ,"."),SEQ2=$P(SEQ,".",2)
"RTN","XUMFH4",109,0)
 .S FIELD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFH4",110,0)
 .I FIELD=".01" D
"RTN","XUMFH4",111,0)
 ..N FDA,IEN1
"RTN","XUMFH4",112,0)
 ..S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH4",113,0)
 ..S VALUE=$$VALUE^XUMFH(.HLNODE,SEQ)
"RTN","XUMFH4",114,0)
 ..S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH4",115,0)
 ..S VALUE=$$DTYP^XUMFP(VALUE,TYP,$S(SEQ2:HLSCS,1:HLCS),0)
"RTN","XUMFH4",116,0)
 ..S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH4",117,0)
 ..D UPDATE^DIE("E","FDA","IEN1","ERR")
"RTN","XUMFH4",118,0)
 ..I $D(ERR) D
"RTN","XUMFH4",119,0)
 ...D EM("update DIE call error message in ZZZ",.ERR)
"RTN","XUMFH4",120,0)
 ...K ERR
"RTN","XUMFH4",121,0)
 ..I $D(IEN1) S IENS=IEN1(1)_","
"RTN","XUMFH4",122,0)
 .I 'FIELD D SUBFILE Q
"RTN","XUMFH4",123,0)
 .S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH4",124,0)
 .S VALUE=$$VALUE^XUMFH(.HLNODE,SEQ)
"RTN","XUMFH4",125,0)
 .S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH4",126,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,TYP,$S(SEQ2:HLSCS,1:HLCS),0)
"RTN","XUMFH4",127,0)
 .S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH4",128,0)
 ;
"RTN","XUMFH4",129,0)
 M FDA=FDA1
"RTN","XUMFH4",130,0)
 K FDA1
"RTN","XUMFH4",131,0)
 ;
"RTN","XUMFH4",132,0)
 D FILE^DIE("E","FDA","ERR")
"RTN","XUMFH4",133,0)
 I $D(ERR) D
"RTN","XUMFH4",134,0)
 .D EM("file DIE call error message in ZZZ",.ERR)
"RTN","XUMFH4",135,0)
 .K ERR
"RTN","XUMFH4",136,0)
 ;
"RTN","XUMFH4",137,0)
 S POST=$G(^TMP("XUMF MFS",$J,"PARAM","POST"))
"RTN","XUMFH4",138,0)
 D:POST'="" @(POST)
"RTN","XUMFH4",139,0)
 ;
"RTN","XUMFH4",140,0)
 Q
"RTN","XUMFH4",141,0)
 ;
"RTN","XUMFH4",142,0)
SUBFILE ; -- process subfile record
"RTN","XUMFH4",143,0)
 ;
"RTN","XUMFH4",144,0)
 N IFN,IENS1,KEY1,FIELD,TYP,MKEY,ERR
"RTN","XUMFH4",145,0)
 ;
"RTN","XUMFH4",146,0)
 S IFN=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFH4",147,0)
 S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFH4",148,0)
 S TYP=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"DTYP")
"RTN","XUMFH4",149,0)
 S VALUE=$$VALUE^XUMFH(.HLNODE,SEQ)
"RTN","XUMFH4",150,0)
 S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH4",151,0)
 S VALUE=$$DTYP^XUMFP(VALUE,TYP,$S(SEQ2:HLSCS,1:HLCS),0)
"RTN","XUMFH4",152,0)
 ;
"RTN","XUMFH4",153,0)
 S MULT=$G(^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",SEQ))
"RTN","XUMFH4",154,0)
 S MKEY=$G(^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",SEQ))
"RTN","XUMFH4",155,0)
 I MULT=SEQ Q:VALUE=""  D
"RTN","XUMFH4",156,0)
 .N FDA,IEN
"RTN","XUMFH4",157,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=VALUE
"RTN","XUMFH4",158,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH4",159,0)
 .I $D(ERR) D
"RTN","XUMFH4",160,0)
 ..D EM("update DIE call error message in SUBFILE",.ERR)
"RTN","XUMFH4",161,0)
 ..K ERR
"RTN","XUMFH4",162,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH4",163,0)
 I 'MULT D
"RTN","XUMFH4",164,0)
 .N FDA,IEN
"RTN","XUMFH4",165,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=MKEY
"RTN","XUMFH4",166,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH4",167,0)
 .I $D(ERR) D
"RTN","XUMFH4",168,0)
 ..D EM("update DIE call error message in SUBFILE",.ERR)
"RTN","XUMFH4",169,0)
 ..K ERR
"RTN","XUMFH4",170,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH4",171,0)
 .S FDA1(IFN,IENS1,.01)=MKEY
"RTN","XUMFH4",172,0)
 I MULT,MULT'=SEQ S IENS1=$G(MULT(+MULT)) Q:IENS1=""
"RTN","XUMFH4",173,0)
 S FDA1(IFN,IENS1,FIELD)=VALUE
"RTN","XUMFH4",174,0)
 ;
"RTN","XUMFH4",175,0)
 Q
"RTN","XUMFH4",176,0)
 ;
"RTN","XUMFH4",177,0)
BG ; -- background job
"RTN","XUMFH4",178,0)
 ;
"RTN","XUMFH4",179,0)
 Q:ERROR
"RTN","XUMFH4",180,0)
 Q:HL("MTN")'="MFN"
"RTN","XUMFH4",181,0)
 ;
"RTN","XUMFH4",182,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSAVE
"RTN","XUMFH4",183,0)
 ;
"RTN","XUMFH4",184,0)
 S ZTRTN="BRDCST^XUMFH4"
"RTN","XUMFH4",185,0)
 S ZTDESC="XUMF Broadcast IMF address changes"
"RTN","XUMFH4",186,0)
 S ZTDTH=$$NOW^XLFDT
"RTN","XUMFH4",187,0)
 S ZTSAVE("IEN")=""
"RTN","XUMFH4",188,0)
 S ZTIO=""
"RTN","XUMFH4",189,0)
 ;
"RTN","XUMFH4",190,0)
 D ^%ZTLOAD
"RTN","XUMFH4",191,0)
 ;
"RTN","XUMFH4",192,0)
 Q
"RTN","XUMFH4",193,0)
 ;
"RTN","XUMFH4",194,0)
BRDCST ; -- broadcast update
"RTN","XUMFH4",195,0)
 ;
"RTN","XUMFH4",196,0)
 N PARAM
"RTN","XUMFH4",197,0)
 ;
"RTN","XUMFH4",198,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J),^TMP("XUMF MFS",$J),PARAM
"RTN","XUMFH4",199,0)
 ;
"RTN","XUMFH4",200,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFN",0))
"RTN","XUMFH4",201,0)
 S PARAM("BROADCAST")=1
"RTN","XUMFH4",202,0)
 D MAIN^XUMFP(4,IEN,0,.PARAM,.ERROR) Q:ERROR
"RTN","XUMFH4",203,0)
 D MAIN^XUMFI(4,IEN,0,.PARAM,.ERROR)
"RTN","XUMFH4",204,0)
 ;
"RTN","XUMFH4",205,0)
 S ZTREQ="@"
"RTN","XUMFH4",206,0)
 ;
"RTN","XUMFH4",207,0)
 Q
"RTN","XUMFH4",208,0)
 ;
"RTN","XUMFH4",209,0)
REPLY ; -- master file response
"RTN","XUMFH4",210,0)
 ;
"RTN","XUMFH4",211,0)
 Q:HL("MTN")="MFK"
"RTN","XUMFH4",212,0)
 ;
"RTN","XUMFH4",213,0)
 S:(TYPE<10) TYPE=(TYPE+10)
"RTN","XUMFH4",214,0)
 ;
"RTN","XUMFH4",215,0)
 S IFN=$G(IFN),IEN=$G(IEN)
"RTN","XUMFH4",216,0)
 ;
"RTN","XUMFH4",217,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH4",218,0)
 D MAIN^XUMFI(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH4",219,0)
 ;
"RTN","XUMFH4",220,0)
 Q
"RTN","XUMFH4",221,0)
 ;
"RTN","XUMFH4",222,0)
EXIT ; -- cleanup, and quit
"RTN","XUMFH4",223,0)
 ;
"RTN","XUMFH4",224,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J),^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH4",225,0)
 ;
"RTN","XUMFH4",226,0)
 Q
"RTN","XUMFH4",227,0)
 ;
"RTN","XUMFH4",228,0)
EM(ERROR,ERR) ; -- error message
"RTN","XUMFH4",229,0)
 ;
"RTN","XUMFH4",230,0)
 N X,XMSUB,XMY,XMTEXT,FLG
"RTN","XUMFH4",231,0)
 ;
"RTN","XUMFH4",232,0)
 S FLG=0
"RTN","XUMFH4",233,0)
 ;
"RTN","XUMFH4",234,0)
 D MSG^DIALOG("AM",.X,80,,"ERR")
"RTN","XUMFH4",235,0)
 ;
"RTN","XUMFH4",236,0)
 S X(.1)="HL7 message ID: "_$G(HL("MID"))
"RTN","XUMFH4",237,0)
 S X(.2)="",X(.3)=$G(ERROR),X(.4)=""
"RTN","XUMFH4",238,0)
 S XMSUB="IMF HANDLER ERROR MESSAGE"
"RTN","XUMFH4",239,0)
 S XMY="G.XUMF INSTITUTION"
"RTN","XUMFH4",240,0)
 S XMTEXT="X("
"RTN","XUMFH4",241,0)
 ;
"RTN","XUMFH4",242,0)
 S X=.9 F  S X=$O(X(X)) Q:'X  D
"RTN","XUMFH4",243,0)
 .I X(X)="" K X(X) Q
"RTN","XUMFH4",244,0)
 .I X(X)["DINUMed field cannot" S FLG=1 K X(X) Q
"RTN","XUMFH4",245,0)
 ;
"RTN","XUMFH4",246,0)
 I FLG Q:'$O(X(.9))
"RTN","XUMFH4",247,0)
 ;
"RTN","XUMFH4",248,0)
 D ^XMD
"RTN","XUMFH4",249,0)
 ;
"RTN","XUMFH4",250,0)
 Q
"RTN","XUMFH4",251,0)
 ;
"RTN","XUMFI")
0^3^B82497778
"RTN","XUMFI",1,0)
XUMFI ;CIOFO-SF/RAM - Master File Interface ;06/28/00
"RTN","XUMFI",2,0)
 ;;8.0;KERNEL;**206,217**;Jul 10, 1995
"RTN","XUMFI",3,0)
 ;
"RTN","XUMFI",4,0)
 ; This routine is the Master File Server HL7 message builder API.
"RTN","XUMFI",5,0)
 ; The routine will generate messages for both trigger events and
"RTN","XUMFI",6,0)
 ; queries.
"RTN","XUMFI",7,0)
 ;
"RTN","XUMFI",8,0)
 ; Use the routine XUMFP to initialize the PARAM array.
"RTN","XUMFI",9,0)
 ; See XUMFP for a full description of the parameter.
"RTN","XUMFI",10,0)
 ;
"RTN","XUMFI",11,0)
 ; use of $O(^HLCS(870,"C",institution_ptr)) supported by IA# 3550
"RTN","XUMFI",12,0)
 ;
"RTN","XUMFI",13,0)
MAIN(IFN,IEN,TYPE,PARAM,ERROR) ;  -- entry point
"RTN","XUMFI",14,0)
 ;
"RTN","XUMFI",15,0)
 ;Input  IFN             A file number (required)
"RTN","XUMFI",16,0)
 ;
"RTN","XUMFI",17,0)
 ;       IEN             Internal Entry Number (required)      Example
"RTN","XUMFI",18,0)
 ;                                                             -------
"RTN","XUMFI",19,0)
 ;
"RTN","XUMFI",20,0)
 ;                       particular record (pass by value)     IEN=1
"RTN","XUMFI",21,0)
 ;
"RTN","XUMFI",22,0)
 ;                       group records array (by reference)    IEN(1)=""
"RTN","XUMFI",23,0)
 ;                       IEN(IEN)=""                           IEN(2)=""
"RTN","XUMFI",24,0)
 ;
"RTN","XUMFI",25,0)
 ;                       ALL 'gold' records (by value)         IEN="ALL"
"RTN","XUMFI",26,0)
 ;
"RTN","XUMFI",27,0)
 ;       TYPE            Message TYPE (required)
"RTN","XUMFI",28,0)
 ;
"RTN","XUMFI",29,0)
 ;                       0  = MFN - unsolicited update
"RTN","XUMFI",30,0)
 ;                       1  = MFQ - query particular record and file
"RTN","XUMFI",31,0)
 ;                       3  = MFQ - query particular record in array
"RTN","XUMFI",32,0)
 ;                       5  = MFQ - query group records file
"RTN","XUMFI",33,0)
 ;                       7  = MFQ - query group records array
"RTN","XUMFI",34,0)
 ;                       10 = MFK - application acknowledgement
"RTN","XUMFI",35,0)
 ;                       11 = MFR - query response particular rec file
"RTN","XUMFI",36,0)
 ;                       13 = MFR - query response particular rec array
"RTN","XUMFI",37,0)
 ;                       15 = MFR - query response group records file
"RTN","XUMFI",38,0)
 ;                       17 = MFR - query response group records array
"RTN","XUMFI",39,0)
 ;
"RTN","XUMFI",40,0)
 ;       PARAM           parameters array (required) (by reference)
"RTN","XUMFI",41,0)
 ;
"RTN","XUMFI",42,0)
 ;OUTPUT
"RTN","XUMFI",43,0)
 ;       ERROR          Error flag '0^HL7 message ID' '1^error text'  
"RTN","XUMFI",44,0)
 ;
"RTN","XUMFI",45,0)
 ;
"RTN","XUMFI",46,0)
 ;
"RTN","XUMFI",47,0)
 N HLFS,HLCS,HLRESLT,QUERY,UPDATE,ALL,CNT,ROOT,PROTOCOL,MFR,MFQ,MTYP,I
"RTN","XUMFI",48,0)
 N ARRAY,GROUP,MFK,CDSYS,J,HLSCS
"RTN","XUMFI",49,0)
 ;
"RTN","XUMFI",50,0)
 M ^TMP("XUMF MFS",$J,"PARAM")=PARAM K PARAM
"RTN","XUMFI",51,0)
 ;
"RTN","XUMFI",52,0)
 D INIT,BUILD,LLNK,SEND,EXIT
"RTN","XUMFI",53,0)
 ;
"RTN","XUMFI",54,0)
 Q
"RTN","XUMFI",55,0)
 ;
"RTN","XUMFI",56,0)
INIT ; -- initialize
"RTN","XUMFI",57,0)
 ;
"RTN","XUMFI",58,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","XUMFI",59,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFI",60,0)
 ;
"RTN","XUMFI",61,0)
 S IEN=$G(IEN),IFN=$G(IFN)
"RTN","XUMFI",62,0)
 S TYPE=$G(TYPE),ERROR=$G(ERROR),CNT=1
"RTN","XUMFI",63,0)
 S UPDATE=$S(TYPE#2:0,1:1)
"RTN","XUMFI",64,0)
 S QUERY='UPDATE
"RTN","XUMFI",65,0)
 S GROUP=$S(UPDATE:0,TYPE[5:1,TYPE[7:1,1:0)
"RTN","XUMFI",66,0)
 S ARRAY=$S(UPDATE:0,TYPE[3:1,TYPE[7:1,1:0)
"RTN","XUMFI",67,0)
 S ALL=$S(IEN["ALL":1,1:0)
"RTN","XUMFI",68,0)
 S PROTOCOL=$G(^TMP("XUMF MFS",$J,"PARAM","PROTOCOL"))
"RTN","XUMFI",69,0)
 S MFR=$S(UPDATE:0,TYPE>10:1,1:0)
"RTN","XUMFI",70,0)
 S MFQ=$S(UPDATE:0,'MFR:1,1:0)
"RTN","XUMFI",71,0)
 S MFK=$S(TYPE=10:1,1:0)
"RTN","XUMFI",72,0)
 S MTYP=$S(MFR:"HLA",MFK:"HLA",1:"HLS")
"RTN","XUMFI",73,0)
 ;
"RTN","XUMFI",74,0)
 ; -- get variables from HL7 package
"RTN","XUMFI",75,0)
 I $O(HL(""))="" D INIT^HLFNC2(PROTOCOL,.HL)
"RTN","XUMFI",76,0)
 I $O(HL(""))="" S ERROR="1^"_$P(HL,"^",2) Q
"RTN","XUMFI",77,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH")),HLSCS=$E(HL("ECH"),4)
"RTN","XUMFI",78,0)
 ;
"RTN","XUMFI",79,0)
 Q:ERROR
"RTN","XUMFI",80,0)
 ;
"RTN","XUMFI",81,0)
 ; -- check parameters
"RTN","XUMFI",82,0)
 I 'QUERY,'UPDATE S ERROR="1^invalid message type" Q
"RTN","XUMFI",83,0)
 I 'IFN S ERROR="1^invalid file number" Q
"RTN","XUMFI",84,0)
 I 'IEN,'ALL,'MFK S ERROR="1^invalid IEN" Q
"RTN","XUMFI",85,0)
 I '$$VFILE^DILFD(IFN) S ERROR="1^invalid file number" Q
"RTN","XUMFI",86,0)
 I UPDATE,'IEN S ERROR="1^update message requires an IEN" Q
"RTN","XUMFI",87,0)
 ;
"RTN","XUMFI",88,0)
 ; -- get root of file
"RTN","XUMFI",89,0)
 S ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFI",90,0)
 ;
"RTN","XUMFI",91,0)
 ; -- if IEN array input, merge with param
"RTN","XUMFI",92,0)
 I 'ALL,'IEN,$O(IEN(0)) M ^TMP("XUMF MFS",$J,"PARAM","IEN")=IEN
"RTN","XUMFI",93,0)
 ;
"RTN","XUMFI",94,0)
 ; -- if CDSYS and ALL get entries
"RTN","XUMFI",95,0)
 S CDSYS=$G(^TMP("XUMF MFS",$J,"PARAM","CDSYS"))
"RTN","XUMFI",96,0)
 I ALL,CDSYS'="" D
"RTN","XUMFI",97,0)
 .S I=0 F  S I=$O(@ROOT@("A XUMF ID",CDSYS,I)) Q:'I  D
"RTN","XUMFI",98,0)
 ..S J=$O(@ROOT@("A XUMF ID",CDSYS,I,0))
"RTN","XUMFI",99,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IEN",J)=""
"RTN","XUMFI",100,0)
 ;
"RTN","XUMFI",101,0)
 ; -- get ALL file 'national' entries
"RTN","XUMFI",102,0)
 I ALL,'$D(^TMP("XUMF MFS",$J,"PARAM","IEN")) D
"RTN","XUMFI",103,0)
 .S I=0 F  S I=$O(@ROOT@("XUMF","N",I)) Q:'I  D
"RTN","XUMFI",104,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IEN",I)=""
"RTN","XUMFI",105,0)
 ;
"RTN","XUMFI",106,0)
 Q
"RTN","XUMFI",107,0)
 ;
"RTN","XUMFI",108,0)
BUILD ; -- build message
"RTN","XUMFI",109,0)
 ;
"RTN","XUMFI",110,0)
 I MFK D MFK Q
"RTN","XUMFI",111,0)
 ;
"RTN","XUMFI",112,0)
 Q:ERROR
"RTN","XUMFI",113,0)
 ;
"RTN","XUMFI",114,0)
 N ID,APP,EVENT,ENDT,EFFDT,RESP,MFI,MFN,EDT,CODE,MFE
"RTN","XUMFI",115,0)
 ;
"RTN","XUMFI",116,0)
 I QUERY D QRD Q:MFQ
"RTN","XUMFI",117,0)
 ;
"RTN","XUMFI",118,0)
 D MFI
"RTN","XUMFI",119,0)
 ;
"RTN","XUMFI",120,0)
 I GROUP D GROUP Q
"RTN","XUMFI",121,0)
 ;
"RTN","XUMFI",122,0)
 D MFE,ZZZ
"RTN","XUMFI",123,0)
 ;
"RTN","XUMFI",124,0)
 Q
"RTN","XUMFI",125,0)
 ;
"RTN","XUMFI",126,0)
MFK ; -- master file acknowledgement
"RTN","XUMFI",127,0)
 ;
"RTN","XUMFI",128,0)
 N X
"RTN","XUMFI",129,0)
 S X="MSA"_HLFS_$S(ERROR:"AE",1:"AA")_HLFS_HL("MID")_HLFS_$P(ERROR,U,2)
"RTN","XUMFI",130,0)
 S ^TMP(MTYP,$J,CNT)=X
"RTN","XUMFI",131,0)
 S CNT=CNT+1
"RTN","XUMFI",132,0)
 ;
"RTN","XUMFI",133,0)
 Q
"RTN","XUMFI",134,0)
 ;
"RTN","XUMFI",135,0)
QRD ; -- query definition segment
"RTN","XUMFI",136,0)
 ;
"RTN","XUMFI",137,0)
 I TYPE>10 D
"RTN","XUMFI",138,0)
 .S ^TMP(MTYP,$J,CNT)="MSA"_HLFS_$S(ERROR:"AE",1:"AA")_HLFS_HL("MID")
"RTN","XUMFI",139,0)
 .S CNT=CNT+1
"RTN","XUMFI",140,0)
 ;
"RTN","XUMFI",141,0)
 Q:ERROR
"RTN","XUMFI",142,0)
 ;
"RTN","XUMFI",143,0)
 N QDT,QFC,QP,QID,ZDRT,ZDRDT,QLR,WHO,WHAT,WDDC,WDCVQ,QRL,QRD
"RTN","XUMFI",144,0)
 ;
"RTN","XUMFI",145,0)
 S QDT=$G(^TMP("XUMF MFS",$J,"PARAM","QDT"))
"RTN","XUMFI",146,0)
 S QFC=$G(^TMP("XUMF MFS",$J,"PARAM","QFC"))
"RTN","XUMFI",147,0)
 S QP=$G(^TMP("XUMF MFS",$J,"PARAM","QP"))
"RTN","XUMFI",148,0)
 S QID=$G(^TMP("XUMF MFS",$J,"PARAM","QID"))
"RTN","XUMFI",149,0)
 S ZDRT=$G(^TMP("XUMF MFS",$J,"PARAM","DRT"))
"RTN","XUMFI",150,0)
 S ZDRDT=$G(^TMP("XUMF MFS",$J,"PARAM","DRDT"))
"RTN","XUMFI",151,0)
 S QLR=$G(^TMP("XUMF MFS",$J,"PARAM","QLR"))
"RTN","XUMFI",152,0)
 S WHO=$G(^TMP("XUMF MFS",$J,"PARAM","WHO"))
"RTN","XUMFI",153,0)
 S WHAT=$G(^TMP("XUMF MFS",$J,"PARAM","WHAT"))
"RTN","XUMFI",154,0)
 S WDDC=$G(^TMP("XUMF MFS",$J,"PARAM","WDDC"))
"RTN","XUMFI",155,0)
 S WDCVQ=$G(^TMP("XUMF MFS",$J,"PARAM","WDCVQ"))
"RTN","XUMFI",156,0)
 S QRL=$G(^TMP("XUMF MFS",$J,"PARAM","QRL"))
"RTN","XUMFI",157,0)
 S QRD="QRD"_HLFS_QDT_HLFS_QFC_HLFS_QP_HLFS_QID_HLFS_ZDRT_HLFS_ZDRDT
"RTN","XUMFI",158,0)
 S QRD=QRD_HLFS_QLR_HLFS_WHO_HLFS_WHAT_HLFS_WDDC_HLFS_WDCVQ_HLFS_QRL
"RTN","XUMFI",159,0)
 S ^TMP(MTYP,$J,CNT)=QRD
"RTN","XUMFI",160,0)
 S CNT=CNT+1
"RTN","XUMFI",161,0)
 ;
"RTN","XUMFI",162,0)
 Q
"RTN","XUMFI",163,0)
 ;
"RTN","XUMFI",164,0)
MFI ; master file identifier segment
"RTN","XUMFI",165,0)
 ;
"RTN","XUMFI",166,0)
 Q:ERROR
"RTN","XUMFI",167,0)
 ;
"RTN","XUMFI",168,0)
 N ID,APP,EVENT,ENDT,EFFDT,RESP,MFI
"RTN","XUMFI",169,0)
 ;
"RTN","XUMFI",170,0)
 S ID=$G(^TMP("XUMF MFS",$J,"PARAM","MFI"))
"RTN","XUMFI",171,0)
 S APP=$G(^TMP("XUMF MFS",$J,"PARAM","MFAI"))
"RTN","XUMFI",172,0)
 S EVENT=$G(^TMP("XUMF MFS",$J,"PARAM","FLEV"))
"RTN","XUMFI",173,0)
 S ENDT=$G(^TMP("XUMF MFS",$J,"PARAM","ENDT"))
"RTN","XUMFI",174,0)
 S EFFDT=$G(^TMP("XUMF MFS",$J,"PARAM","MFIEDT"))
"RTN","XUMFI",175,0)
 S RESP=$G(^TMP("XUMF MFS",$J,"PARAM","RLC"))
"RTN","XUMFI",176,0)
 S:APP="" APP="MFS" S:EVENT="" EVENT="REP" S:RESP="" RESP="NE"
"RTN","XUMFI",177,0)
 S:ENDT="" ENDT=$$NOW^XLFDT S:EFFDT="" EFFDT=$$NOW^XLFDT
"RTN","XUMFI",178,0)
 S MFI=$$MFI^XUMFMFI(ID,APP,EVENT,ENDT,EFFDT,RESP)
"RTN","XUMFI",179,0)
 I $E(MFI)="-" S ERROR=MFI Q
"RTN","XUMFI",180,0)
 S ^TMP(MTYP,$J,CNT)=MFI
"RTN","XUMFI",181,0)
 S CNT=CNT+1
"RTN","XUMFI",182,0)
 ;
"RTN","XUMFI",183,0)
 Q
"RTN","XUMFI",184,0)
 ;
"RTN","XUMFI",185,0)
MFE ; master file entry segment
"RTN","XUMFI",186,0)
 ;
"RTN","XUMFI",187,0)
 Q:ERROR
"RTN","XUMFI",188,0)
 ;
"RTN","XUMFI",189,0)
 N EVENT,MFN,EDT,CODE,MFE
"RTN","XUMFI",190,0)
 ;
"RTN","XUMFI",191,0)
 S EVENT=$G(^TMP("XUMF MFS",$J,"PARAM","RLEC"))
"RTN","XUMFI",192,0)
 S MFN=$G(^TMP("XUMF MFS",$J,"PARAM","MFNCID"))
"RTN","XUMFI",193,0)
 S EDT=$G(^TMP("XUMF MFS",$J,"PARAM","MFEEDT"))
"RTN","XUMFI",194,0)
 S CODE=$G(^TMP("XUMF MFS",$J,"PARAM","PKV"))
"RTN","XUMFI",195,0)
 S:EDT="" EDT=$$NOW^XLFDT S:EVENT="" EVENT="MAD"
"RTN","XUMFI",196,0)
 S MFE=$$MFE^XUMFMFE(EVENT,MFN,EDT,CODE)
"RTN","XUMFI",197,0)
 I $E(MFE)="-" S ERROR=MFE Q
"RTN","XUMFI",198,0)
 S ^TMP(MTYP,$J,CNT)=MFE
"RTN","XUMFI",199,0)
 S CNT=CNT+1
"RTN","XUMFI",200,0)
 ;
"RTN","XUMFI",201,0)
 Q
"RTN","XUMFI",202,0)
 ;
"RTN","XUMFI",203,0)
ZZZ ; [Z...] segment
"RTN","XUMFI",204,0)
 ;
"RTN","XUMFI",205,0)
 Q:ERROR
"RTN","XUMFI",206,0)
 ;
"RTN","XUMFI",207,0)
 N SEG,SEQ,ZZZ,FLD,FILE,IENS,VALUE,ERR,ZDTYP,FIELD,SEQ1,SEQ2
"RTN","XUMFI",208,0)
 N SEQ0,SEQ9,CNT1,CNT2,NODE,XXX
"RTN","XUMFI",209,0)
 ;
"RTN","XUMFI",210,0)
 S SEG="",SEQ=0
"RTN","XUMFI",211,0)
 F  S SEG=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG)) Q:SEG=""  D
"RTN","XUMFI",212,0)
 .S ZZZ=SEG
"RTN","XUMFI",213,0)
 .F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFI",214,0)
 ..S SEQ1=$P(SEQ,"."),SEQ2=$P(SEQ,".",2)
"RTN","XUMFI",215,0)
 ..S FLD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFI",216,0)
 ..;
"RTN","XUMFI",217,0)
 ..I 'FLD D
"RTN","XUMFI",218,0)
 ...S FILE=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFI",219,0)
 ...S IENS=$G(^TMP("XUMF MFS",$J,"PARAM","IENS",SEG,SEQ))
"RTN","XUMFI",220,0)
 ...S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFI",221,0)
 ...S ZDTYP=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"DTYP")
"RTN","XUMFI",222,0)
 ...I $P(ZDTYP,U,3)[":" S FIELD=FIELD_$P(ZDTYP,U,3)
"RTN","XUMFI",223,0)
 ...S VALUE=$$GET1^DIQ(FILE,IENS,FIELD)
"RTN","XUMFI",224,0)
 ...S VALUE=$$DTYP^XUMFP(VALUE,ZDTYP,HLCS,1)
"RTN","XUMFI",225,0)
 ..I FLD D
"RTN","XUMFI",226,0)
 ...S ZDTYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FLD))
"RTN","XUMFI",227,0)
 ...I $P(ZDTYP,U,3)[":" S FLD=FLD_$P(ZDTYP,U,3)
"RTN","XUMFI",228,0)
 ...S VALUE=$$GET1^DIQ(IFN,IEN_",",FLD)
"RTN","XUMFI",229,0)
 ...S VALUE=$$DTYP^XUMFP(VALUE,ZDTYP,$S(SEQ2:HLSCS,1:HLCS),1)
"RTN","XUMFI",230,0)
 ..;
"RTN","XUMFI",231,0)
 ..S ZZZ(SEQ)=VALUE
"RTN","XUMFI",232,0)
 .;
"RTN","XUMFI",233,0)
 .S X=0
"RTN","XUMFI",234,0)
 .F  S X=$O(ZZZ(X)) Q:'X  D
"RTN","XUMFI",235,0)
 ..S SEQ1=$P(X,"."),SEQ2=+$P(X,".",2)
"RTN","XUMFI",236,0)
 ..S XXX(SEQ1,SEQ2)=ZZZ(X)
"RTN","XUMFI",237,0)
 .K ZZZ
"RTN","XUMFI",238,0)
 .M ZZZ=XXX
"RTN","XUMFI",239,0)
 .;
"RTN","XUMFI",240,0)
 .K NODE
"RTN","XUMFI",241,0)
 .S (SEQ,SEQ0,SEQ9,SEQ1,CNT1,CNT2)=0,NODE=""
"RTN","XUMFI",242,0)
 .F  S SEQ1=$O(ZZZ(SEQ1)) Q:'SEQ1  D
"RTN","XUMFI",243,0)
 ..S SEQ2=0,VALUE=$G(ZZZ(SEQ1,SEQ2))
"RTN","XUMFI",244,0)
 ..F  S SEQ2=$O(ZZZ(SEQ1,SEQ2)) Q:'SEQ2  D
"RTN","XUMFI",245,0)
 ...S $P(VALUE,HLCS,SEQ2)=ZZZ(SEQ1,SEQ2)
"RTN","XUMFI",246,0)
 ..S NODE(CNT1)=$G(NODE(CNT1))
"RTN","XUMFI",247,0)
 ..I NODE(CNT1)'="",$L(NODE(CNT1)_VALUE)>200 D
"RTN","XUMFI",248,0)
 ...S CNT1=CNT1+1,SEQ9=SEQ0+SEQ9
"RTN","XUMFI",249,0)
 ..S SEQ=$S('CNT1:SEQ1,1:SEQ1-SEQ9)
"RTN","XUMFI",250,0)
 ..S $P(NODE(CNT1),HLFS,SEQ)=VALUE
"RTN","XUMFI",251,0)
 ..S SEQ0=SEQ-1
"RTN","XUMFI",252,0)
 .;
"RTN","XUMFI",253,0)
 .S NODE=SEG_HLFS_$G(NODE(0)) K NODE(0)
"RTN","XUMFI",254,0)
 .;
"RTN","XUMFI",255,0)
 .M ^TMP(MTYP,$J,CNT)=NODE
"RTN","XUMFI",256,0)
 .S CNT=CNT+1
"RTN","XUMFI",257,0)
 ;
"RTN","XUMFI",258,0)
 Q
"RTN","XUMFI",259,0)
 ;
"RTN","XUMFI",260,0)
GROUP ; -- query group records
"RTN","XUMFI",261,0)
 ;
"RTN","XUMFI",262,0)
 Q:ERROR
"RTN","XUMFI",263,0)
 ;
"RTN","XUMFI",264,0)
 S IEN=0
"RTN","XUMFI",265,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)) Q:'IEN  D
"RTN","XUMFI",266,0)
 .K ^TMP("XUMF MFS",$J,"PARAM","PKV")
"RTN","XUMFI",267,0)
 .K ^TMP("XUMF MFS",$J,"PARAM","IENS")
"RTN","XUMFI",268,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")
"RTN","XUMFI",269,0)
 .M ^TMP("XUMF MFS",$J,"PARAM","IENS")=^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS")
"RTN","XUMFI",270,0)
 .D MFE,ZZZ
"RTN","XUMFI",271,0)
 ;
"RTN","XUMFI",272,0)
 Q
"RTN","XUMFI",273,0)
 ;
"RTN","XUMFI",274,0)
SEND ; -- send HL7 message
"RTN","XUMFI",275,0)
 ;
"RTN","XUMFI",276,0)
 I 'MFK,ERROR Q
"RTN","XUMFI",277,0)
 ;
"RTN","XUMFI",278,0)
 S HLP("PRIORITY")="I"
"RTN","XUMFI",279,0)
 ;
"RTN","XUMFI",280,0)
 I 'TYPE D GENERATE^HLMA(PROTOCOL,"GM",1,.HLRESLT,"",.HLP)
"RTN","XUMFI",281,0)
 I TYPE,(TYPE<10) D DIRECT^HLMA(PROTOCOL,"GM",1,.HLRESLT,"",.HLP)
"RTN","XUMFI",282,0)
 I (TYPE>9) D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.HLRESLT)
"RTN","XUMFI",283,0)
 ;
"RTN","XUMFI",284,0)
 ; check for error
"RTN","XUMFI",285,0)
 I ($P($G(HLRESLT),U,3)'="") D  Q
"RTN","XUMFI",286,0)
 .S ERROR=1_U_$P(HLRESLT,HLFS,3)_U_$P(HLRESLT,HLFS,2)_U_$P(HLRESLT,U)
"RTN","XUMFI",287,0)
 ;
"RTN","XUMFI",288,0)
 ; successful call, message ID returned
"RTN","XUMFI",289,0)
 S ERROR="0^"_$P($G(HLRESLT),U,1)
"RTN","XUMFI",290,0)
 ;
"RTN","XUMFI",291,0)
 Q
"RTN","XUMFI",292,0)
 ;
"RTN","XUMFI",293,0)
EXIT ; -- exit
"RTN","XUMFI",294,0)
 ;
"RTN","XUMFI",295,0)
 D CLEAN^DILF
"RTN","XUMFI",296,0)
 ;
"RTN","XUMFI",297,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFI",298,0)
 K ^TMP("XUMF MFS",$J)
"RTN","XUMFI",299,0)
 ;
"RTN","XUMFI",300,0)
 Q
"RTN","XUMFI",301,0)
 ;
"RTN","XUMFI",302,0)
LLNK ; -- dynamic addressing BROADCAST
"RTN","XUMFI",303,0)
 ;
"RTN","XUMFI",304,0)
 Q:TYPE>9
"RTN","XUMFI",305,0)
 ;
"RTN","XUMFI",306,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","LLNK"))'="" D  Q
"RTN","XUMFI",307,0)
 .S HLL("LINKS",1)=^TMP("XUMF MFS",$J,"PARAM","LLNK")
"RTN","XUMFI",308,0)
 ;
"RTN","XUMFI",309,0)
 Q:'$$SERVER()
"RTN","XUMFI",310,0)
 ;
"RTN","XUMFI",311,0)
 Q:TYPE
"RTN","XUMFI",312,0)
 Q:'$G(^TMP("XUMF MFS",$J,"PARAM","BROADCAST"))
"RTN","XUMFI",313,0)
 ;
"RTN","XUMFI",314,0)
 N I,J,LLNK
"RTN","XUMFI",315,0)
 ;
"RTN","XUMFI",316,0)
 S (I,J)=0
"RTN","XUMFI",317,0)
 F  S I=$O(^HLCS(870,"C",I)) Q:'I  D
"RTN","XUMFI",318,0)
 .S J=$O(^HLCS(870,"C",I,0)) Q:'J
"RTN","XUMFI",319,0)
 .S LLNK=$P($G(^HLCS(870,J,0)),U)
"RTN","XUMFI",320,0)
 .S HLL("LINKS",I)="XUMF MFK^"_LLNK
"RTN","XUMFI",321,0)
 ;
"RTN","XUMFI",322,0)
 Q
"RTN","XUMFI",323,0)
 ;
"RTN","XUMFI",324,0)
SERVER() ; -- servers
"RTN","XUMFI",325,0)
 ;
"RTN","XUMFI",326,0)
 N I
"RTN","XUMFI",327,0)
 ;
"RTN","XUMFI",328,0)
 S I=$$KSP^XUPARAM("INST") Q:'I 0
"RTN","XUMFI",329,0)
 ;
"RTN","XUMFI",330,0)
 Q:I=442 1  ;BP TEST
"RTN","XUMFI",331,0)
 Q:I=12000 1  ;FORUM
"RTN","XUMFI",332,0)
 Q:I=100002 1  ;HEC
"RTN","XUMFI",333,0)
 ;
"RTN","XUMFI",334,0)
 Q 0
"RTN","XUMFI",335,0)
 ;
"RTN","XUMFMFE")
0^13^B2003306
"RTN","XUMFMFE",1,0)
XUMFMFE ;OIFO-OAK/RAM - HL7 MFE SEGMENT ;8/23/95
"RTN","XUMFMFE",2,0)
 ;;8.0;KERNEL;**217**;Jul 10, 1995
"RTN","XUMFMFE",3,0)
 ;
"RTN","XUMFMFE",4,0)
 ;routine copied from VAFHLMFE, written by ALB/CM,JLU
"RTN","XUMFMFE",5,0)
 ;
"RTN","XUMFMFE",6,0)
MFE(EVENT,MFN,EDT,CODE) ;
"RTN","XUMFMFE",7,0)
 ;
"RTN","XUMFMFE",8,0)
 ;Input Parameters:
"RTN","XUMFMFE",9,0)
 ;EVENT - Record-level Event Code.  If not defined, the default is MAD (always add record to master file
"RTN","XUMFMFE",10,0)
 ;MFN - MFN Control ID.  If not defined, the default is null
"RTN","XUMFMFE",11,0)
 ;EDT - Effective date/time.  If not defined, the default is today. This should be in FM date/time format.
"RTN","XUMFMFE",12,0)
 ;CODE - REQUIRED!  Primary Key Value.  If not defined, segment will not be built and record will not be sent.
"RTN","XUMFMFE",13,0)
 ;
"RTN","XUMFMFE",14,0)
 ;Output:
"RTN","XUMFMFE",15,0)
 ;MFE - contains the segment if successful
"RTN","XUMFMFE",16,0)
 ;    - contains -1^error message if unsuccessful
"RTN","XUMFMFE",17,0)
 ;
"RTN","XUMFMFE",18,0)
 I '$D(EVENT) S EVENT="MAD"
"RTN","XUMFMFE",19,0)
 I '$D(MFN) S MFN=""
"RTN","XUMFMFE",20,0)
 I '$D(EDT) D NOW^%DTC S EDT=$P(%,".") K %
"RTN","XUMFMFE",21,0)
 I '$D(CODE) S MFE="-1^No Primary Key Value" G EXIT
"RTN","XUMFMFE",22,0)
 N MFE
"RTN","XUMFMFE",23,0)
 S MFE="MFE"_HLFS_EVENT_HLFS_MFN_HLFS_$$HLDATE^HLFNC(EDT)_HLFS_CODE
"RTN","XUMFMFE",24,0)
EXIT ;
"RTN","XUMFMFE",25,0)
 Q MFE
"RTN","XUMFMFE",26,0)
 ;
"RTN","XUMFMFE",27,0)
EN(ENC,FS,QUOTS,ARY) ;formats the MFE segment
"RTN","XUMFMFE",28,0)
 ;INPUTS  ENC   - the encoding characters for the segments
"RTN","XUMFMFE",29,0)
 ;        FS    - the field separators to be used
"RTN","XUMFMFE",30,0)
 ;        QUOTS - what to use as double quots
"RTN","XUMFMFE",31,0)
 ;        ARY   - this array contains the data to be place in the
"RTN","XUMFMFE",32,0)
 ;                MFE segment.  The subscripts of the array should
"RTN","XUMFMFE",33,0)
 ;                be the sequence number of the data element in the
"RTN","XUMFMFE",34,0)
 ;                array.
"RTN","XUMFMFE",35,0)
 ;         Ex.  X(1)=Record Level Event Code
"RTN","XUMFMFE",36,0)
 ;              X(2)=MFN Control ID
"RTN","XUMFMFE",37,0)
 ;              X(3)=Effective Date/time
"RTN","XUMFMFE",38,0)
 ;              etc.
"RTN","XUMFMFE",39,0)
 ;OUTPUT
"RTN","XUMFMFE",40,0)
 ;         0^description if there was an error.
"RTN","XUMFMFE",41,0)
 ;         the formatted segment if successful.
"RTN","XUMFMFE",42,0)
 N SEG,LP
"RTN","XUMFMFE",43,0)
 I '$D(ENC)!('$D(FS))!('$D(QUOTS))!('$D(ARY)) S SEG="0^Missing parameters." G MFIQ
"RTN","XUMFMFE",44,0)
 I $D(@ARY)<10 S SEG="0^Field array not populated." G MFIQ
"RTN","XUMFMFE",45,0)
 S SEG=""
"RTN","XUMFMFE",46,0)
 F LP=0:0 S LP=$O(@ARY@(LP)) Q:'LP  S $P(SEG,FS,LP+1)=@ARY@(LP)
"RTN","XUMFMFE",47,0)
 S $P(SEG,FS,1)="MFE"
"RTN","XUMFMFE",48,0)
MFIQ Q SEG
"RTN","XUMFMFI")
0^12^B2674492
"RTN","XUMFMFI",1,0)
XUMFMFI ;OIFO-OAK/RAM - HL7 MFI SEGMENT ;8/23/95
"RTN","XUMFMFI",2,0)
 ;;8.0;KERNEL;**217**;Jul 10, 1995
"RTN","XUMFMFI",3,0)
 ;
"RTN","XUMFMFI",4,0)
 ;routine copied from VAFHLMFI by ALB/CM,JLU
"RTN","XUMFMFI",5,0)
 ;
"RTN","XUMFMFI",6,0)
 ;Input Parameters:
"RTN","XUMFMFI",7,0)
 ;ID - Master File Identifier (required)
"RTN","XUMFMFI",8,0)
 ;APP - Master File Application Identifier.  (required)
"RTN","XUMFMFI",9,0)
 ;EVENT - File-Level Event Code.  If not defined, the default will be "REP" to replace current version of this master file with the version contained in the message.
"RTN","XUMFMFI",10,0)
 ;ENDT - Entered date/time.  If not defined, the default is today. This should be in FM date/time format.
"RTN","XUMFMFI",11,0)
 ;EFFDT - Effective date/time.  If not defined, the default is today. This should be in FM date/time format.
"RTN","XUMFMFI",12,0)
 ;RESP - Response Level Code.  If not defined, will be "NE" Never, No application level response needed.
"RTN","XUMFMFI",13,0)
 ;
"RTN","XUMFMFI",14,0)
 ;Output:
"RTN","XUMFMFI",15,0)
 ;MFI - contains the segment if successful
"RTN","XUMFMFI",16,0)
 ;    - contains -1^error message if unsuccessful
"RTN","XUMFMFI",17,0)
 ;
"RTN","XUMFMFI",18,0)
MFI(ID,APP,EVENT,ENDT,EFFDT,RESP) ;
"RTN","XUMFMFI",19,0)
 ;
"RTN","XUMFMFI",20,0)
 I '$D(ID)!('$D(APP)) Q "-1^Missing Required Parameter(s)"
"RTN","XUMFMFI",21,0)
 I '$D(EVENT) S EVENT="REP"
"RTN","XUMFMFI",22,0)
 I '$D(ENDT) D NOW^%DTC S ENDT=$P(%,".") K %
"RTN","XUMFMFI",23,0)
 I '$D(EFFDT) D NOW^%DTC S EFFDT=$P(%,".") K %
"RTN","XUMFMFI",24,0)
 I '$D(RESP) S RESP="NE"
"RTN","XUMFMFI",25,0)
 ;
"RTN","XUMFMFI",26,0)
 N MFI
"RTN","XUMFMFI",27,0)
 S MFI="MFI"_HLFS_ID_HLFS_APP_HLFS_EVENT_HLFS_$$HLDATE^HLFNC(ENDT)_HLFS_$$HLDATE^HLFNC(EFFDT)_HLFS_RESP
"RTN","XUMFMFI",28,0)
 Q MFI
"RTN","XUMFMFI",29,0)
 ;
"RTN","XUMFMFI",30,0)
 ;
"RTN","XUMFMFI",31,0)
EN(ENC,FS,QUOTS,ARY) ;generic call to create MFI segments.
"RTN","XUMFMFI",32,0)
 ;
"RTN","XUMFMFI",33,0)
 ;INPUTS  ENC   - the encoding characters for the segments
"RTN","XUMFMFI",34,0)
 ;        FS    - the field separators to be used
"RTN","XUMFMFI",35,0)
 ;        QUOTS - what to use as double quots
"RTN","XUMFMFI",36,0)
 ;        ARY   - this array contains the data to be place in the
"RTN","XUMFMFI",37,0)
 ;                MFI segment.  The subscripts of the array should
"RTN","XUMFMFI",38,0)
 ;                be the sequence number of the data element in the
"RTN","XUMFMFI",39,0)
 ;                array.
"RTN","XUMFMFI",40,0)
 ;         Ex.  X(1)=master fiel identifier
"RTN","XUMFMFI",41,0)
 ;              X(2)=Master File Application Identifier
"RTN","XUMFMFI",42,0)
 ;              X(3)=File Level Event Code
"RTN","XUMFMFI",43,0)
 ;              etc.
"RTN","XUMFMFI",44,0)
 ;OUTPUT
"RTN","XUMFMFI",45,0)
 ;         0^description if there was an error.
"RTN","XUMFMFI",46,0)
 ;         the formatted segment if successful.
"RTN","XUMFMFI",47,0)
 ;
"RTN","XUMFMFI",48,0)
 N SEG,LP
"RTN","XUMFMFI",49,0)
 I '$D(ENC)!('$D(FS))!('$D(QUOTS))!('$D(ARY)) S SEG="0^Missing parameters." G MFIQ
"RTN","XUMFMFI",50,0)
 I $D(@ARY)<10 S SEG="0^Field array not populated." G MFIQ
"RTN","XUMFMFI",51,0)
 S SEG=""
"RTN","XUMFMFI",52,0)
 F LP=0:0 S LP=$O(@ARY@(LP)) Q:'LP  S $P(SEG,FS,LP+1)=@ARY@(LP)
"RTN","XUMFMFI",53,0)
 S $P(SEG,FS,1)="MFI"
"RTN","XUMFMFI",54,0)
MFIQ Q SEG
"RTN","XUMFP")
0^7^B15340290
"RTN","XUMFP",1,0)
XUMFP ;CIOFO-SF/RAM - Master File C/S Parameters ;06/28/00
"RTN","XUMFP",2,0)
 ;;8.0;KERNEL;**206,217**;Jul 10, 1995
"RTN","XUMFP",3,0)
 ;
"RTN","XUMFP",4,0)
 ;
"RTN","XUMFP",5,0)
 ;
"RTN","XUMFP",6,0)
MAIN(IFN,IEN,TYPE,PARAM,ERROR) ; -- parameters for master file server
"RTN","XUMFP",7,0)
 ;
"RTN","XUMFP",8,0)
 ;INPUT
"RTN","XUMFP",9,0)
 ;       IFN             Internal File Number (required)
"RTN","XUMFP",10,0)
 ;
"RTN","XUMFP",11,0)
 ;       IEN             Internal Entry Number (required)
"RTN","XUMFP",12,0)
 ;
"RTN","XUMFP",13,0)
 ;                       single entry (pass by value) example: IEN=1
"RTN","XUMFP",14,0)
 ;
"RTN","XUMFP",15,0)
 ;                       multiple entries (pass by reference)  IEN(1)=""
"RTN","XUMFP",16,0)
 ;                                                             IEN(2)=""
"RTN","XUMFP",17,0)
 ;
"RTN","XUMFP",18,0)
 ;                       ALL national entries (pass by value)  IEN="ALL"
"RTN","XUMFP",19,0)
 ;
"RTN","XUMFP",20,0)
 ;                       NEW entry (pass by value)             IEN="NEW"
"RTN","XUMFP",21,0)
 ;
"RTN","XUMFP",22,0)
 ;       TYPE            Message TYPE (required)
"RTN","XUMFP",23,0)
 ;
"RTN","XUMFP",24,0)
 ;                       0  = MFN - unsolicited update
"RTN","XUMFP",25,0)
 ;                       1  = MFQ - query particular record and file
"RTN","XUMFP",26,0)
 ;                       3  = MFQ - query particular record in array
"RTN","XUMFP",27,0)
 ;                       5  = MFQ - query group records file
"RTN","XUMFP",28,0)
 ;                       7  = MFQ - query group records array
"RTN","XUMFP",29,0)
 ;                       11 = MFR - query response particular rec file
"RTN","XUMFP",30,0)
 ;                       13 = MFR - query response particular rec array
"RTN","XUMFP",31,0)
 ;                       15 = MFR - query response group records file
"RTN","XUMFP",32,0)
 ;                       17 = MFR - query response group records array
"RTN","XUMFP",33,0)
 ;
"RTN","XUMFP",34,0)
 ;
"RTN","XUMFP",35,0)
 ;INPUT/OUTPUT
"RTN","XUMFP",36,0)
 ;
"RTN","XUMFP",37,0)
 ;       PARAM("PROTOCOL")       IEN Protocol (#101) file
"RTN","XUMFP",38,0)
 ;       PARAM("LLNK")           HLL("LINKS",n) 'protocol^logical link'
"RTN","XUMFP",39,0)
 ;       PARAM("PRE")            Pre-update record routine
"RTN","XUMFP",40,0)
 ;       PARAM("POST")           Post-update record routine
"RTN","XUMFP",41,0)
 ;
"RTN","XUMFP",42,0)
 ;       QRD -- Query definition segment
"RTN","XUMFP",43,0)
 ;       -------------------------------
"RTN","XUMFP",44,0)
 ;       PARAM("QDT")            Query Date/Time
"RTN","XUMFP",45,0)
 ;       PARAM("QFC")            Query Format Code
"RTN","XUMFP",46,0)
 ;       PARAM("QP")             Query Priority
"RTN","XUMFP",47,0)
 ;       PARAM("QID")            Query ID
"RTN","XUMFP",48,0)
 ;       PARAM("DRT")            Deferred Response Type
"RTN","XUMFP",49,0)
 ;       PARAM("DRDT")           Deferred Response Date/Time
"RTN","XUMFP",50,0)
 ;       PARAM("QLR")            Quantity Limited Request
"RTN","XUMFP",51,0)
 ;       PARAM("WHO")            Who Subject Filter
"RTN","XUMFP",52,0)
 ;       PARAM("WHAT")           What Subject Filter
"RTN","XUMFP",53,0)
 ;       PARAM("WDDC")           What Department Data Code
"RTN","XUMFP",54,0)
 ;       PARAM("WDCVQ")          What Data Code Value Qual
"RTN","XUMFP",55,0)
 ;       PARAM("QRL")            Query Results Level
"RTN","XUMFP",56,0)
 ;
"RTN","XUMFP",57,0)
 ;       MFI -- Master File Identification
"RTN","XUMFP",58,0)
 ;       ---------------------------------
"RTN","XUMFP",59,0)
 ;       PARAM("MFI")            Master File Identifier
"RTN","XUMFP",60,0)
 ;       PARAM("MFAI")           Master File Application Identifier
"RTN","XUMFP",61,0)
 ;       PARAM("FLEC")           File-Level Event Code
"RTN","XUMFP",62,0)
 ;       PARAM("ENDT")           Entered Data/Time
"RTN","XUMFP",63,0)
 ;       PARAM("MFIEDT")         Effective Date/Time
"RTN","XUMFP",64,0)
 ;       PARAM("RLC")            Response Level Code
"RTN","XUMFP",65,0)
 ; 
"RTN","XUMFP",66,0)
 ;       MFE -- Master File Entry
"RTN","XUMFP",67,0)
 ;       ------------------------
"RTN","XUMFP",68,0)
 ;       PARAM("RLEC")           Record-Level Event Code
"RTN","XUMFP",69,0)
 ;       PARAM("MFNCID")         MFN Control ID
"RTN","XUMFP",70,0)
 ;       PARAM("MFEEDT")         Effective Date/Time
"RTN","XUMFP",71,0)
 ;       PARAM("PKV")            Primary Key Value
"RTN","XUMFP",72,0)
 ;
"RTN","XUMFP",73,0)
 ;       [Z...] segment(s) parameters
"RTN","XUMFP",74,0)
 ;       -------------------------
"RTN","XUMFP",75,0)
 ;       PARAM("SEG",SEG)=""             HL7 segment name
"RTN","XUMFP",76,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,FLD#) seg sequence number and field
"RTN","XUMFP",77,0)
 ;  Note: Add HL7 data type + sub components (leave value/code blank) 
"RTN","XUMFP",78,0)
 ;  Example: Institution Facility Type  = "CE^~FACILILITY TYPE~VA"
"RTN","XUMFP",79,0)
 ;    If the FIELD is a pointer and you want the lookup to be other
"RTN","XUMFP",80,0)
 ;    than the pointed to .01 set the 3rd piece = to the extended ref.
"RTN","XUMFP",81,0)
 ;    I.e., Parent Facility in the Association mult of Institution
"RTN","XUMFP",82,0)
 ;    points back to Institution, if we want to get facility using
"RTN","XUMFP",83,0)
 ;    station number (#99) instead of name (.01) set the 3rd piece
"RTN","XUMFP",84,0)
 ;    equal to ":99" giving us "CE^~FACILILITY TYPE~VA^:99".
"RTN","XUMFP",85,0)
 ;
"RTN","XUMFP",86,0)
 ;       Files involving sub-records and/or extended reference
"RTN","XUMFP",87,0)
 ;       -----------------------------------------------------
"RTN","XUMFP",88,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"FILE")       See FM documentation
"RTN","XUMFP",89,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"IENS")       $$GET1^DIQ() for value
"RTN","XUMFP",90,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"FIELD")      of FILE, IENS, & FIELD.
"RTN","XUMFP",91,0)
 ;
"RTN","XUMFP",92,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"DTYP")      HL7 data type (above)
"RTN","XUMFP",93,0)
 ;
"RTN","XUMFP",94,0)
 ;
"RTN","XUMFP",95,0)
 ; *** NOTE: OUTPUT in ^TMP("XUMF MFS",$J,"PARAM") ***
"RTN","XUMFP",96,0)
 ;
"RTN","XUMFP",97,0)
 ;       Example: MFE PKV is ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")
"RTN","XUMFP",98,0)
 ;                    SEG    ^TMP("XUMF MFS",$J,"PARAM","SEG")
"RTN","XUMFP",99,0)
 ;
"RTN","XUMFP",100,0)
 ;       and another node is required for sub-file IENS for group
"RTN","XUMFP",101,0)
 ;       ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS",SEG,SEQ)=IENS
"RTN","XUMFP",102,0)
 ;
"RTN","XUMFP",103,0)
 ;       Use XUMFP4 as a template/example routine
"RTN","XUMFP",104,0)
 ;
"RTN","XUMFP",105,0)
 N QUERY,UPDATE,ALL,MFR,MFQ,HLFS,HLCS,GROUP,ARRAY,ROOT,NEW,I,J,CDSYS
"RTN","XUMFP",106,0)
 N PROTOCOL
"RTN","XUMFP",107,0)
 ;
"RTN","XUMFP",108,0)
 K ^TMP("XUMF MFS",$J)
"RTN","XUMFP",109,0)
 M ^TMP("XUMF MFS",$J,"PARAM")=PARAM
"RTN","XUMFP",110,0)
 ;
"RTN","XUMFP",111,0)
 S IEN=$G(IEN),IFN=$G(IFN)
"RTN","XUMFP",112,0)
 S TYPE=+$G(TYPE),ERROR=$G(ERROR)
"RTN","XUMFP",113,0)
 S UPDATE=$S(TYPE#2:0,1:1)
"RTN","XUMFP",114,0)
 S QUERY='UPDATE
"RTN","XUMFP",115,0)
 S GROUP=$S(UPDATE:0,TYPE[5:1,TYPE[7:1,1:0)
"RTN","XUMFP",116,0)
 S ARRAY=$S(UPDATE:0,TYPE[3:1,TYPE[7:1,1:0)
"RTN","XUMFP",117,0)
 S ALL=$S(IEN="ALL":1,1:0)
"RTN","XUMFP",118,0)
 S NEW=$S(IEN="NEW":1,1:0)
"RTN","XUMFP",119,0)
 S MFR=$S(UPDATE:0,TYPE>10:1,1:0)
"RTN","XUMFP",120,0)
 S MFQ=$S(UPDATE:0,'MFR:1,1:0)
"RTN","XUMFP",121,0)
 ;
"RTN","XUMFP",122,0)
 S PROTOCOL=$G(PARAM("PROTOCOL"))
"RTN","XUMFP",123,0)
 ;
"RTN","XUMFP",124,0)
 I 'IFN S ERROR="1^invalid IFN" Q
"RTN","XUMFP",125,0)
 ;
"RTN","XUMFP",126,0)
 ; -- get root of file
"RTN","XUMFP",127,0)
 S ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFP",128,0)
 ;
"RTN","XUMFP",129,0)
 ; -- if IEN array input, merge with param
"RTN","XUMFP",130,0)
 I 'ALL,'IEN,$O(IEN(0)) M ^TMP("XUMF MFS",$J,"PARAM","IEN")=IEN
"RTN","XUMFP",131,0)
 ;
"RTN","XUMFP",132,0)
 ; -- if CDSYS and ALL get entries
"RTN","XUMFP",133,0)
 S CDSYS=$G(^TMP("XUMF MFS",$J,"PARAM","CDSYS"))
"RTN","XUMFP",134,0)
 I ALL,CDSYS'="" D
"RTN","XUMFP",135,0)
 .S I=0 F  S I=$O(@ROOT@("A XUMF ID",CDSYS,I)) Q:'I  D
"RTN","XUMFP",136,0)
 ..S J=$O(@ROOT@("A XUMF ID",CDSYS,I,0))
"RTN","XUMFP",137,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IEN",J)=I
"RTN","XUMFP",138,0)
 ;
"RTN","XUMFP",139,0)
 ; -- get ALL file 'national' entries
"RTN","XUMFP",140,0)
 I ALL,'$D(^TMP("XUMF MFS",$J,"PARAM","IEN")),CDSYS="" D
"RTN","XUMFP",141,0)
 .S I=0 F  S I=$O(@ROOT@("XUMF","N",I)) Q:'I  D
"RTN","XUMFP",142,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IEN",I)=""
"RTN","XUMFP",143,0)
 ;
"RTN","XUMFP",144,0)
 ;  *** insert code below ***
"RTN","XUMFP",145,0)
 ; insert file number in string below to add an additional file
"RTN","XUMFP",146,0)
 I "^4^4.1^200^"'[(U_IFN_U) S ERROR="1^file not supported" Q
"RTN","XUMFP",147,0)
 ;  *** end insert code ***
"RTN","XUMFP",148,0)
 ;
"RTN","XUMFP",149,0)
 ;    note: also create a subroutine for each supported file with
"RTN","XUMFP",150,0)
 ;             the file number as the line TAG (replace decimal point
"RTN","XUMFP",151,0)
 ;             of file number with the letter 'P').  This subroutine
"RTN","XUMFP",152,0)
 ;             calls an associated routine for the specific file.
"RTN","XUMFP",153,0)
 ;             This file should use the XUMFP namespace.
"RTN","XUMFP",154,0)
 ;
"RTN","XUMFP",155,0)
 D @("F"_$TR(IFN,".","P"))
"RTN","XUMFP",156,0)
 ;
"RTN","XUMFP",157,0)
 K PARAM
"RTN","XUMFP",158,0)
 ;
"RTN","XUMFP",159,0)
 Q
"RTN","XUMFP",160,0)
 ;
"RTN","XUMFP",161,0)
F4 ; -- institution file
"RTN","XUMFP",162,0)
 ;
"RTN","XUMFP",163,0)
 D ^XUMFP4
"RTN","XUMFP",164,0)
 ;
"RTN","XUMFP",165,0)
 Q
"RTN","XUMFP",166,0)
 ;
"RTN","XUMFP",167,0)
F4P1 ; -- facility type file
"RTN","XUMFP",168,0)
 ;
"RTN","XUMFP",169,0)
 D ^XUMFPFT
"RTN","XUMFP",170,0)
 ;
"RTN","XUMFP",171,0)
 Q
"RTN","XUMFP",172,0)
 ;
"RTN","XUMFP",173,0)
 ;  *** insert subroutine here for additional files ***
"RTN","XUMFP",174,0)
 ;
"RTN","XUMFP",175,0)
TAG ;D ^ROUTINE
"RTN","XUMFP",176,0)
 ;Q
"RTN","XUMFP",177,0)
 ;
"RTN","XUMFP",178,0)
 ;
"RTN","XUMFP",179,0)
MFI(X) ; -- master file identifier function
"RTN","XUMFP",180,0)
 ;
"RTN","XUMFP",181,0)
 ;INPUT          X       master file indentifier (seq 1 MFI segment)
"RTN","XUMFP",182,0)
 ;OUTPUT         $$      IFN - Internal File Number or '0' for error
"RTN","XUMFP",183,0)
 ;
"RTN","XUMFP",184,0)
 Q:X="Z04" 4
"RTN","XUMFP",185,0)
 Q:X="Z4T" 4.1
"RTN","XUMFP",186,0)
 ;
"RTN","XUMFP",187,0)
 ; *** add code here for new files ***
"RTN","XUMFP",188,0)
 ;
"RTN","XUMFP",189,0)
 Q 0
"RTN","XUMFP",190,0)
 ;
"RTN","XUMFP",191,0)
DTYP(VALUE,TYP,HLCS,TOHL7) ;data type conversion
"RTN","XUMFP",192,0)
 ;INPUT
"RTN","XUMFP",193,0)
 ;   VALUE    value
"RTN","XUMFP",194,0)
 ;   TYP    HL7 data type
"RTN","XUMFP",195,0)
 ;   TOHL7   1=to HL7, 0=to FileMan
"RTN","XUMFP",196,0)
 ;OUTPUT
"RTN","XUMFP",197,0)
 ;   $$      formatted data
"RTN","XUMFP",198,0)
 ;
"RTN","XUMFP",199,0)
 N TEXT,CS
"RTN","XUMFP",200,0)
 S TYP=$G(TYP),VALUE=$G(VALUE),TOHL7=$G(TOHL7)
"RTN","XUMFP",201,0)
 Q:TYP="" VALUE Q:VALUE="" VALUE
"RTN","XUMFP",202,0)
 S TEXT=$P(TYP,U,2),TYP=$P(TYP,U)
"RTN","XUMFP",203,0)
 I TYP="ST"!(TYP="ID") Q VALUE
"RTN","XUMFP",204,0)
 I TYP="DT",TOHL7 D  Q $$HLDATE^HLFNC(VALUE)
"RTN","XUMFP",205,0)
 .N X,Y S X=VALUE D ^%DT S VALUE=+Y
"RTN","XUMFP",206,0)
 I TYP="DT" Q $$FMDATE^HLFNC(+VALUE)
"RTN","XUMFP",207,0)
 I 'TOHL7 Q $P(VALUE,HLCS)
"RTN","XUMFP",208,0)
 Q VALUE_$TR(TEXT,"~",HLCS)
"RTN","XUMFP",209,0)
 ;
"RTN","XUMFP4")
0^1^B31046710
"RTN","XUMFP4",1,0)
XUMFP4 ;CIOFO-SF/RAM - Master File C/S Params INSTITUTION ;06/28/00
"RTN","XUMFP4",2,0)
 ;;8.0;KERNEL;**206,217**;Jul 10, 1995
"RTN","XUMFP4",3,0)
 ;
"RTN","XUMFP4",4,0)
 ;
"RTN","XUMFP4",5,0)
 ; This routine sets up the parameters required by the INSTITUTION (#4)
"RTN","XUMFP4",6,0)
 ; file for the Master File server mechanism.
"RTN","XUMFP4",7,0)
 ;
"RTN","XUMFP4",8,0)
 ;  ** This routine is not a supported interface -- use XUMFP **
"RTN","XUMFP4",9,0)
 ;
"RTN","XUMFP4",10,0)
 ;  See XUMFP for parameter list documentation
"RTN","XUMFP4",11,0)
 ;
"RTN","XUMFP4",12,0)
 N PKV,HLFS,HLCS,RT,RF
"RTN","XUMFP4",13,0)
 ;
"RTN","XUMFP4",14,0)
 S ^TMP("XUMF MFS",$J,"PARAM","PRE")="PRE^XUMFP4C"
"RTN","XUMFP4",15,0)
 S ^TMP("XUMF MFS",$J,"PARAM","POST")="POST^XUMFP4C"
"RTN","XUMFP4",16,0)
 ;
"RTN","XUMFP4",17,0)
 I $O(HL(""))="" D
"RTN","XUMFP4",18,0)
 .I 'PROTOCOL D
"RTN","XUMFP4",19,0)
 ..S:UPDATE PROTOCOL=$O(^ORD(101,"B","XUMF MFN",0))
"RTN","XUMFP4",20,0)
 ..S:QUERY PROTOCOL=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMFP4",21,0)
 .S:'PROTOCOL ERROR="1^invalid protocol" Q:ERROR
"RTN","XUMFP4",22,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PROTOCOL")=PROTOCOL
"RTN","XUMFP4",23,0)
 .D INIT^HLFNC2(PROTOCOL,.HL)
"RTN","XUMFP4",24,0)
 ;
"RTN","XUMFP4",25,0)
 I $O(HL(""))="" S ERROR="1^"_$P(HL,U,2) Q
"RTN","XUMFP4",26,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH"))
"RTN","XUMFP4",27,0)
 ;
"RTN","XUMFP4",28,0)
 I QUERY D QRD^XUMFP4C
"RTN","XUMFP4",29,0)
 ;
"RTN","XUMFP4",30,0)
 ; MFI -- Master File Identification Segment
"RTN","XUMFP4",31,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFI")="Z04"  ;Master File Identifier
"RTN","XUMFP4",32,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFAI")=""  ;Application Identifier
"RTN","XUMFP4",33,0)
 S ^TMP("XUMF MFS",$J,"PARAM","FLEC")="UPD"  ;File-Level Event Code
"RTN","XUMFP4",34,0)
 S ^TMP("XUMF MFS",$J,"PARAM","ENDT")=""  ;Entered Data/Time
"RTN","XUMFP4",35,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFIEDT")=""  ;Effective Date/Time
"RTN","XUMFP4",36,0)
 S ^TMP("XUMF MFS",$J,"PARAM","RLC")="NE"  ;Response Level Code
"RTN","XUMFP4",37,0)
 ;
"RTN","XUMFP4",38,0)
 ; MFE -- Master File Entry
"RTN","XUMFP4",39,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","RLEC"))="" D  ;Record-Level Event Code
"RTN","XUMFP4",40,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","RLEC")="MUP"
"RTN","XUMFP4",41,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFNCID")=""  ;MFN Control ID
"RTN","XUMFP4",42,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","MFEEDT"))="" D  ;Effective Date/Time
"RTN","XUMFP4",43,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","MFEEDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFP4",44,0)
 ;
"RTN","XUMFP4",45,0)
SEG ; -- ZIN segment
"RTN","XUMFP4",46,0)
 ;
"RTN","XUMFP4",47,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",8)=""
"RTN","XUMFP4",48,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",8)="VISN"
"RTN","XUMFP4",49,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",9)=""
"RTN","XUMFP4",50,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",9)="PARENT FACILITY"
"RTN","XUMFP4",51,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",10)=10
"RTN","XUMFP4",52,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",11)=10
"RTN","XUMFP4",53,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",12)=12
"RTN","XUMFP4",54,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",13)=12
"RTN","XUMFP4",55,0)
 ;
"RTN","XUMFP4",56,0)
 I IEN D
"RTN","XUMFP4",57,0)
 .S PKV=$P($G(^DIC(4,+IEN,99)),U)_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4",58,0)
 .I CDSYS'="" D
"RTN","XUMFP4",59,0)
 ..S $P(PKV,HLCS,2)=$P($G(^DIC(4,+IEN,0)),U),$P(PKV,HLCS,3)=CDSYS
"RTN","XUMFP4",60,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFP4",61,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",8)="1,"_IEN_","
"RTN","XUMFP4",62,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.014,"1,"_IEN_",")="VISN"
"RTN","XUMFP4",63,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",9)="2,"_IEN_","
"RTN","XUMFP4",64,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.014,"2,"_IEN_",")="PARENT FACILITY"
"RTN","XUMFP4",65,0)
 .S RF=$$RF^XUAF4(IEN) D:RF
"RTN","XUMFP4",66,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",10)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4",67,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",11)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4",68,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.999,$P(RF,U,3)_","_IEN_",")=$P(RF,U,3)
"RTN","XUMFP4",69,0)
 .S RT=$$RT^XUAF4(IEN) D:RT
"RTN","XUMFP4",70,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",12)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4",71,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",13)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4",72,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.999,$P(RT,U,3)_","_IEN_",")=$P(RT,U,3)
"RTN","XUMFP4",73,0)
 ;
"RTN","XUMFP4",74,0)
 I NEW D
"RTN","XUMFP4",75,0)
 .S PKV="NEW"_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4",76,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFP4",77,0)
 ;
"RTN","XUMFP4",78,0)
 ; ZIN -- VA Specific VHA Institution Segment sequence
"RTN","XUMFP4",79,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEGMENT")="ZIN"
"RTN","XUMFP4",80,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",1,.01)="ST"
"RTN","XUMFP4",81,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",2,99)="ST"
"RTN","XUMFP4",82,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",3,11)="ID"
"RTN","XUMFP4",83,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",4,13)="CE^~FACILITY TYPE~VA"
"RTN","XUMFP4",84,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",5,100)="ST"
"RTN","XUMFP4",85,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",6,101)="ST"
"RTN","XUMFP4",86,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",7,.02)="ST"
"RTN","XUMFP4",87,0)
 ; associations -- VISN
"RTN","XUMFP4",88,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",8,"FILE")=4.014
"RTN","XUMFP4",89,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",8,"FIELD")=1
"RTN","XUMFP4",90,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",8,"DTYP")="CE^~VISN~VA"
"RTN","XUMFP4",91,0)
 ; associations -- parent
"RTN","XUMFP4",92,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",9,"FILE")=4.014
"RTN","XUMFP4",93,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",9,"FIELD")="1"
"RTN","XUMFP4",94,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",9,"DTYP")="ST^^:99"
"RTN","XUMFP4",95,0)
 ; history -- old station number
"RTN","XUMFP4",96,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",10,"FILE")=4.999
"RTN","XUMFP4",97,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",10,"FIELD")=.01
"RTN","XUMFP4",98,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",10,"DTYP")="DT"
"RTN","XUMFP4",99,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",11,"FILE")=4.999
"RTN","XUMFP4",100,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",11,"FIELD")=".06"
"RTN","XUMFP4",101,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",11,"DTYP")="ST^^:99"
"RTN","XUMFP4",102,0)
 ; history -- new station number
"RTN","XUMFP4",103,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",12,"FILE")=4.999
"RTN","XUMFP4",104,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",12,"FIELD")=.01
"RTN","XUMFP4",105,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",12,"DTYP")="DT"
"RTN","XUMFP4",106,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",13,"FILE")=4.999
"RTN","XUMFP4",107,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",13,"FIELD")=".05"
"RTN","XUMFP4",108,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",13,"DTYP")="ST^^:99"
"RTN","XUMFP4",109,0)
 ;
"RTN","XUMFP4",110,0)
 ; physical address
"RTN","XUMFP4",111,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",14.1,.01)="SAD"
"RTN","XUMFP4",112,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",14.2,1.01)="ST"
"RTN","XUMFP4",113,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",14.3,1.03)="ST"
"RTN","XUMFP4",114,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",14.4,.02)="ST"
"RTN","XUMFP4",115,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",14.5,1.04)="ST"
"RTN","XUMFP4",116,0)
 ;
"RTN","XUMFP4",117,0)
 ; mailing address
"RTN","XUMFP4",118,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",15.1,.01)="SAD"
"RTN","XUMFP4",119,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",15.2,4.01)="ST"
"RTN","XUMFP4",120,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",15.3,4.03)="ST"
"RTN","XUMFP4",121,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",15.4,4.04)="ST"
"RTN","XUMFP4",122,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",15.5,4.05)="ST"
"RTN","XUMFP4",123,0)
 ;
"RTN","XUMFP4",124,0)
GROUP ; -- query group
"RTN","XUMFP4",125,0)
 ;
"RTN","XUMFP4",126,0)
 D GROUP^XUMFP4C
"RTN","XUMFP4",127,0)
 ;
"RTN","XUMFP4",128,0)
 Q
"RTN","XUMFP4",129,0)
 ;
"RTN","XUMFP4C")
0^2^B30888694
"RTN","XUMFP4C",1,0)
XUMFP4C ;CIOFO-SF/RAM - Master File C/S Params INSTITUTION ;06/28/00
"RTN","XUMFP4C",2,0)
 ;;8.0;KERNEL;**206,209,217**;Jul 10, 1995
"RTN","XUMFP4C",3,0)
 ;
"RTN","XUMFP4C",4,0)
 ; this routine is a called by XUMFP4 and is a continuation of that
"RTN","XUMFP4C",5,0)
 ; routine
"RTN","XUMFP4C",6,0)
 ;
"RTN","XUMFP4C",7,0)
QRD ; -- query definition segment
"RTN","XUMFP4C",8,0)
 ;
"RTN","XUMFP4C",9,0)
 ;Query Date/Time
"RTN","XUMFP4C",10,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QDT")) D
"RTN","XUMFP4C",11,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFP4C",12,0)
 ;
"RTN","XUMFP4C",13,0)
 ;Query Format Code
"RTN","XUMFP4C",14,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QFC")) D
"RTN","XUMFP4C",15,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QFC")="R"
"RTN","XUMFP4C",16,0)
 ;
"RTN","XUMFP4C",17,0)
 ;Query Priority
"RTN","XUMFP4C",18,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QP")) D
"RTN","XUMFP4C",19,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QP")="I"
"RTN","XUMFP4C",20,0)
 ;
"RTN","XUMFP4C",21,0)
 ;Query ID
"RTN","XUMFP4C",22,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QID")) D
"RTN","XUMFP4C",23,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QID")="Z04 "_$S(ARRAY:"ARRAY",1:"FILE")
"RTN","XUMFP4C",24,0)
 ;
"RTN","XUMFP4C",25,0)
 ;Deferred Response Type (optional)
"RTN","XUMFP4C",26,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRT")) D
"RTN","XUMFP4C",27,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRT")=""
"RTN","XUMFP4C",28,0)
 ;
"RTN","XUMFP4C",29,0)
 ;Deferred Response Date/Time (optional)
"RTN","XUMFP4C",30,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRDT")) D
"RTN","XUMFP4C",31,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRDT")=""
"RTN","XUMFP4C",32,0)
 ;
"RTN","XUMFP4C",33,0)
 ;Quantity Limited Request
"RTN","XUMFP4C",34,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QLR")) D
"RTN","XUMFP4C",35,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QLR")="RD"_HLCS_999
"RTN","XUMFP4C",36,0)
 ;
"RTN","XUMFP4C",37,0)
 ;Who Subject Filter - sta#, D x-ref, assigning facility
"RTN","XUMFP4C",38,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHO")) D
"RTN","XUMFP4C",39,0)
 .N X S X=$S(ALL:"ALL",IEN:$P($G(^DIC(4,+IEN,99)),U),1:"IEN ARRAY")
"RTN","XUMFP4C",40,0)
 .S $P(X,HLCS,9,10)="D"_HLCS_"045A4"
"RTN","XUMFP4C",41,0)
 .S:$G(CDSYS)'="" $P(X,HLCS,9,10)="DMIS"_HLCS_"DOD"
"RTN","XUMFP4C",42,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHO")=X
"RTN","XUMFP4C",43,0)
 ;
"RTN","XUMFP4C",44,0)
 ;What Subject Filter
"RTN","XUMFP4C",45,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHAT")) D
"RTN","XUMFP4C",46,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHAT")="4"_HLCS_"IFN"_HLCS_"VA FM"
"RTN","XUMFP4C",47,0)
 ;
"RTN","XUMFP4C",48,0)
 ;What Department Data Code
"RTN","XUMFP4C",49,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDDC")) D
"RTN","XUMFP4C",50,0)
 .N X S X="INFRASTRUCTURE"_HLCS_"INFORMATION INFRASTRUCTURE"
"RTN","XUMFP4C",51,0)
 .S X=X_HLCS_"VA TS"
"RTN","XUMFP4C",52,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDDC")=X
"RTN","XUMFP4C",53,0)
 ;
"RTN","XUMFP4C",54,0)
 ;What Data Code Value Qual (optional)
"RTN","XUMFP4C",55,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDCVQ")) D
"RTN","XUMFP4C",56,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDCVQ")=""
"RTN","XUMFP4C",57,0)
 ;
"RTN","XUMFP4C",58,0)
 ;Query Results Level (optional)
"RTN","XUMFP4C",59,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QRL")) D
"RTN","XUMFP4C",60,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QRL")=""
"RTN","XUMFP4C",61,0)
 ;
"RTN","XUMFP4C",62,0)
 Q
"RTN","XUMFP4C",63,0)
 ;
"RTN","XUMFP4C",64,0)
PRE ; -- pre-update record
"RTN","XUMFP4C",65,0)
 ;
"RTN","XUMFP4C",66,0)
 S XUMF0=$G(^DIC(4,+IEN,0))
"RTN","XUMFP4C",67,0)
 S XUMF1=$G(^DIC(4,+IEN,1))
"RTN","XUMFP4C",68,0)
 S XUMF3=$G(^DIC(4,+IEN,3))
"RTN","XUMFP4C",69,0)
 S XUMF4=$G(^DIC(4,+IEN,4))
"RTN","XUMFP4C",70,0)
 S XUMF99=$G(^DIC(4,+IEN,99))
"RTN","XUMFP4C",71,0)
 S XUMFPRNT=$P($G(^DIC(4,+$P($G(^DIC(4,IEN,7,2,0)),U,2),99)),U)
"RTN","XUMFP4C",72,0)
 S XUMFVISN=$P($G(^DIC(4,+$P($G(^DIC(4,IEN,7,1,0)),U,2),99)),U)
"RTN","XUMFP4C",73,0)
 S XUMFSTTE=$P($G(^DIC(5,+$P(XUMF0,U,2),0)),U,2)
"RTN","XUMFP4C",74,0)
 ;
"RTN","XUMFP4C",75,0)
 Q
"RTN","XUMFP4C",76,0)
 ;
"RTN","XUMFP4C",77,0)
POST ; -- post-update record
"RTN","XUMFP4C",78,0)
 ;
"RTN","XUMFP4C",79,0)
 N NAME,VANAME,FACTYP,ONAM,OVANAM,OFACTYP,XMB,IENS,FDA,STANUM
"RTN","XUMFP4C",80,0)
 N STATE,FLAG,OFLAG,ADD1,ADD2,PRNT,VISN
"RTN","XUMFP4C",81,0)
 ;
"RTN","XUMFP4C",82,0)
 S ONAM=$P(XUMF0,U)
"RTN","XUMFP4C",83,0)
 S OFACTYP=$P($G(^DIC(4.1,+XUMF3,0)),U)
"RTN","XUMFP4C",84,0)
 S OVANAM=$P(XUMF99,U,3)
"RTN","XUMFP4C",85,0)
 S OFLAG=$S(+$P(XUMF99,U,4):"INACTIVE",1:"")
"RTN","XUMFP4C",86,0)
 ;
"RTN","XUMFP4C",87,0)
 S NAME=$P($G(^DIC(4,+IEN,0)),U)
"RTN","XUMFP4C",88,0)
 S FACTYP=$P($G(^DIC(4.1,+$G(^DIC(4,+IEN,3)),0)),U)
"RTN","XUMFP4C",89,0)
 S VANAME=$P($G(^DIC(4,+IEN,99)),U,3)
"RTN","XUMFP4C",90,0)
 S STANUM=$P($G(^DIC(4,+IEN,99)),U)
"RTN","XUMFP4C",91,0)
 S FLAG=$S(+$P($G(^DIC(4,+IEN,99)),U,4):"INACTIVE",1:"")
"RTN","XUMFP4C",92,0)
 S PRNT=$P($G(^DIC(4,+$P($G(^DIC(4,+IEN,7,2,0)),U,2),99)),U)
"RTN","XUMFP4C",93,0)
 S VISN=$P($G(^DIC(4,+$P($G(^DIC(4,+IEN,7,1,0)),U,2),99)),U)
"RTN","XUMFP4C",94,0)
 S STATE=$P($G(^DIC(5,+$P($G(^DIC(4,+IEN,0)),U,2),0)),U,2)
"RTN","XUMFP4C",95,0)
 ;
"RTN","XUMFP4C",96,0)
 S ADD1=$G(^DIC(4,+IEN,1)),ADD2=$G(^DIC(4,+IEN,4))
"RTN","XUMFP4C",97,0)
 ;
"RTN","XUMFP4C",98,0)
 I ONAM'=NAME!(OVANAM'=VANAME) D
"RTN","XUMFP4C",99,0)
 .S IENS="?+"_DT_","_IEN_","
"RTN","XUMFP4C",100,0)
 .K FDA
"RTN","XUMFP4C",101,0)
 .S FDA(4.999,IENS,.01)=DT
"RTN","XUMFP4C",102,0)
 .S:NAME'=ONAM FDA(4.999,IENS,.02)=ONAM
"RTN","XUMFP4C",103,0)
 .S:VANAME'=OVANAM FDA(4.999,IENS,.03)=OVANAM
"RTN","XUMFP4C",104,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMFP4C",105,0)
 ;
"RTN","XUMFP4C",106,0)
 ; -- notification bulletin
"RTN","XUMFP4C",107,0)
 S XMB="XUMF INSTITUTION"
"RTN","XUMFP4C",108,0)
 S XMB(1)=HL("MID"),XMB(2)=$S(ONAM="":"Added",1:"Updated")
"RTN","XUMFP4C",109,0)
 S XMB(3)=IEN,XMB(4)=STANUM
"RTN","XUMFP4C",110,0)
 ;updated/current values
"RTN","XUMFP4C",111,0)
 S XMB(5)=NAME,XMB(6)=VANAME,XMB(7)=FACTYP
"RTN","XUMFP4C",112,0)
 S XMB(11)=FLAG,XMB(12)=STATE,XMB(13)=VISN,XMB(14)=PRNT
"RTN","XUMFP4C",113,0)
 S XMB(19)=$P(ADD1,U),XMB(20)=$P(ADD1,U,3),XMB(22)=$P(ADD1,U,4)
"RTN","XUMFP4C",114,0)
 S XMB(23)=$P(ADD2,U),XMB(24)=$P(ADD2,U,3),XMB(26)=$P(ADD2,U,5)
"RTN","XUMFP4C",115,0)
 S XMB(25)=$P($G(^DIC(5,+$P(ADD2,U,4),0)),U,2)
"RTN","XUMFP4C",116,0)
 ;old values
"RTN","XUMFP4C",117,0)
 S XMB(8)=ONAM,XMB(9)=OVANAM,XMB(10)=OFACTYP,XMB(15)=OFLAG
"RTN","XUMFP4C",118,0)
 S XMB(16)=XUMFSTTE,XMB(17)=XUMFVISN,XMB(18)=XUMFPRNT
"RTN","XUMFP4C",119,0)
 S XMB(27)=$P(XUMF1,U),XMB(28)=$P(XUMF1,U,3),XMB(29)=$P(XUMF1,U,4)
"RTN","XUMFP4C",120,0)
 S XMB(30)=$P(XUMF4,U),XMB(31)=$P(XUMF4,U,3),XMB(33)=$P(XUMF4,U,5)
"RTN","XUMFP4C",121,0)
 S XMB(32)=$P($G(^DIC(5,+$P(XUMF4,U,4),0)),U,2)
"RTN","XUMFP4C",122,0)
 D ^XMB
"RTN","XUMFP4C",123,0)
 ;
"RTN","XUMFP4C",124,0)
 K XUMF0,XUMF3,XUMF99,XUMFSTTE,XUMFVISN,XUMFPRNT,XUMF1,XUMF4
"RTN","XUMFP4C",125,0)
 ;
"RTN","XUMFP4C",126,0)
 Q
"RTN","XUMFP4C",127,0)
 ;
"RTN","XUMFP4C",128,0)
GROUP ; -- query group
"RTN","XUMFP4C",129,0)
 ;
"RTN","XUMFP4C",130,0)
 S IEN=0
"RTN","XUMFP4C",131,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)) Q:'IEN  D
"RTN","XUMFP4C",132,0)
 .S PKV=$P(^DIC(4,IEN,99),U)_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4C",133,0)
 .I CDSYS'="" D
"RTN","XUMFP4C",134,0)
 ..S $P(PKV,HLCS,1)=^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)
"RTN","XUMFP4C",135,0)
 ..S $P(PKV,HLCS,2)=$P($G(^DIC(4,+IEN,0)),U),$P(PKV,HLCS,3)=CDSYS
"RTN","XUMFP4C",136,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")=PKV
"RTN","XUMFP4C",137,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",8)="1,"_IEN_","
"RTN","XUMFP4C",138,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.014,"1,"_IEN_",")="VISN"
"RTN","XUMFP4C",139,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",9)="2,"_IEN_","
"RTN","XUMFP4C",140,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.014,"2,"_IEN_",")="PARENT FACILITY"
"RTN","XUMFP4C",141,0)
 .S RF=$$RF^XUAF4(IEN) D:RF
"RTN","XUMFP4C",142,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",10)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4C",143,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",11)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4C",144,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.999,$P(RF,U,3)_","_IEN_",")=$P(RF,U,3)
"RTN","XUMFP4C",145,0)
 .S RT=$$RT^XUAF4(IEN) D:RT
"RTN","XUMFP4C",146,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",12)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4C",147,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",13)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4C",148,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.999,$P(RT,U,3)_","_IEN_",")=$P(RT,U,3)
"RTN","XUMFP4C",149,0)
 ;
"RTN","XUMFP4C",150,0)
 Q
"RTN","XUMFP4C",151,0)
 ;
"RTN","XUMFPFT")
0^14^B18221668
"RTN","XUMFPFT",1,0)
XUMFPFT ;CIOFO-SF/RAM - Master File Param FACILITY TYPE ;06/28/00
"RTN","XUMFPFT",2,0)
 ;;8.0;KERNEL;**206,217**;Jul 10, 1995
"RTN","XUMFPFT",3,0)
 ;
"RTN","XUMFPFT",4,0)
 ; This routine sets up the parameters required by the FACILITY TYPE
"RTN","XUMFPFT",5,0)
 ; (#4) file for the Master File server mechanism.
"RTN","XUMFPFT",6,0)
 ;
"RTN","XUMFPFT",7,0)
 ;  ** This routine is not a supported interface -- use XUMFP **
"RTN","XUMFPFT",8,0)
 ;
"RTN","XUMFPFT",9,0)
 ;  See XUMFP for parameter list documentation
"RTN","XUMFPFT",10,0)
 ;
"RTN","XUMFPFT",11,0)
 N PKV,PROTOCOL,HLFS,HLCS,RT,RF
"RTN","XUMFPFT",12,0)
 ;
"RTN","XUMFPFT",13,0)
 S PARAM("PRE")="PRE^XUMFPFT"
"RTN","XUMFPFT",14,0)
 S PARAM("POST")="POST^XUMFPFT"
"RTN","XUMFPFT",15,0)
 ;
"RTN","XUMFPFT",16,0)
 I $O(HL(""))="" D
"RTN","XUMFPFT",17,0)
 .S:UPDATE PROTOCOL=$O(^ORD(101,"B","XUMF MFN",0))
"RTN","XUMFPFT",18,0)
 .S:QUERY PROTOCOL=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMFPFT",19,0)
 .S:'PROTOCOL ERROR="1^invalid protocol" Q:ERROR
"RTN","XUMFPFT",20,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PROTOCOL")=PROTOCOL
"RTN","XUMFPFT",21,0)
 .D INIT^HLFNC2(PROTOCOL,.HL)
"RTN","XUMFPFT",22,0)
 ;
"RTN","XUMFPFT",23,0)
 I $O(HL(""))="" S ERROR="1^"_$P(HL,U,2) Q
"RTN","XUMFPFT",24,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH"))
"RTN","XUMFPFT",25,0)
 ;
"RTN","XUMFPFT",26,0)
 I QUERY D QRD
"RTN","XUMFPFT",27,0)
 ;
"RTN","XUMFPFT",28,0)
 ; MFI -- Master File Identification Segment
"RTN","XUMFPFT",29,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFI")="Z4T"  ;Master File Identifier
"RTN","XUMFPFT",30,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFAI")=""  ;Application Identifier
"RTN","XUMFPFT",31,0)
 S ^TMP("XUMF MFS",$J,"PARAM","FLEC")="UPD"  ;File-Level Event Code
"RTN","XUMFPFT",32,0)
 S ^TMP("XUMF MFS",$J,"PARAM","ENDT")=""  ;Entered Data/Time
"RTN","XUMFPFT",33,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFIEDT")=""  ;Effective Date/Time
"RTN","XUMFPFT",34,0)
 S ^TMP("XUMF MFS",$J,"PARAM","RLC")="NE"  ;Response Level Code
"RTN","XUMFPFT",35,0)
 ;
"RTN","XUMFPFT",36,0)
 ; MFE -- Master File Entry
"RTN","XUMFPFT",37,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","RLEC"))="" D  ;Record-Level Event Code
"RTN","XUMFPFT",38,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","RLEC")="MUP"
"RTN","XUMFPFT",39,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFNCID")=""  ;MFN Control ID
"RTN","XUMFPFT",40,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","MFEEDT"))="" D  ;Effective Date/Time
"RTN","XUMFPFT",41,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","MFEEDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFPFT",42,0)
 ;
"RTN","XUMFPFT",43,0)
SEG ; -- ZFT segment
"RTN","XUMFPFT",44,0)
 ;
"RTN","XUMFPFT",45,0)
 I IEN D
"RTN","XUMFPFT",46,0)
 .S PKV=$P($G(^DIC(4.1,+IEN,0)),U)_HLCS_"FACILITY TYPE"_HLCS_"B"
"RTN","XUMFPFT",47,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFPFT",48,0)
 I NEW D
"RTN","XUMFPFT",49,0)
 .S PKV="NEW"_HLCS_"FACILITY TYPE"_HLCS_"B"
"RTN","XUMFPFT",50,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFPFT",51,0)
 ;
"RTN","XUMFPFT",52,0)
 ; ZFT -- VA Specific VHA Facility Type Segment sequence
"RTN","XUMFPFT",53,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEGMENT")="ZFT"
"RTN","XUMFPFT",54,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZFT","SEQ",1,.01)="ST"  ;name
"RTN","XUMFPFT",55,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZFT","SEQ",2,1)="ST"  ;full name
"RTN","XUMFPFT",56,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZFT","SEQ",3,2)="ST"  ;title
"RTN","XUMFPFT",57,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZFT","SEQ",4,3)="ST"  ;status
"RTN","XUMFPFT",58,0)
 ;
"RTN","XUMFPFT",59,0)
 Q:'GROUP
"RTN","XUMFPFT",60,0)
 Q:$G(HL("MTN"))="MFR"
"RTN","XUMFPFT",61,0)
 ;
"RTN","XUMFPFT",62,0)
GROUP ; -- query group
"RTN","XUMFPFT",63,0)
 ;
"RTN","XUMFPFT",64,0)
 S IEN=0
"RTN","XUMFPFT",65,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)) Q:'IEN  D
"RTN","XUMFPFT",66,0)
 .S PKV=$P(^DIC(4.1,IEN,0),U)_HLCS_"FACILITY TYPE"_HLCS_"B"
"RTN","XUMFPFT",67,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")=PKV
"RTN","XUMFPFT",68,0)
 ;
"RTN","XUMFPFT",69,0)
 Q
"RTN","XUMFPFT",70,0)
 ;
"RTN","XUMFPFT",71,0)
QRD ; -- query definition segment
"RTN","XUMFPFT",72,0)
 ;
"RTN","XUMFPFT",73,0)
 ;Query Date/Time
"RTN","XUMFPFT",74,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QDT")) D
"RTN","XUMFPFT",75,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFPFT",76,0)
 ;
"RTN","XUMFPFT",77,0)
 ;Query Format Code
"RTN","XUMFPFT",78,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QFC")) D
"RTN","XUMFPFT",79,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QFC")="R"
"RTN","XUMFPFT",80,0)
 ;
"RTN","XUMFPFT",81,0)
 ;Query Priority
"RTN","XUMFPFT",82,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QP")) D
"RTN","XUMFPFT",83,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QP")="I"
"RTN","XUMFPFT",84,0)
 ;
"RTN","XUMFPFT",85,0)
 ;Query ID
"RTN","XUMFPFT",86,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QID")) D
"RTN","XUMFPFT",87,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QID")="Z4T "_$S(ARRAY:"ARRAY",1:"FILE")
"RTN","XUMFPFT",88,0)
 ;
"RTN","XUMFPFT",89,0)
 ;Deferred Response Type (optional)
"RTN","XUMFPFT",90,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRT")) D
"RTN","XUMFPFT",91,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRT")=""
"RTN","XUMFPFT",92,0)
 ;
"RTN","XUMFPFT",93,0)
 ;Deferred Response Date/Time (optional)
"RTN","XUMFPFT",94,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRDT")) D
"RTN","XUMFPFT",95,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRDT")=""
"RTN","XUMFPFT",96,0)
 ;
"RTN","XUMFPFT",97,0)
 ;Quantity Limited Request
"RTN","XUMFPFT",98,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QLR")) D
"RTN","XUMFPFT",99,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QLR")="RD"_HLCS_999
"RTN","XUMFPFT",100,0)
 ;
"RTN","XUMFPFT",101,0)
 ;Who Subject Filter - sta#, D x-ref, assigning facility
"RTN","XUMFPFT",102,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHO")) D
"RTN","XUMFPFT",103,0)
 .N X S X=$S(ALL:"ALL",IEN:$P($G(^DIC(4.1,+IEN,0)),U),1:"IEN ARRAY")
"RTN","XUMFPFT",104,0)
 .S $P(X,HLCS,9,10)="B"_HLCS_"VA"
"RTN","XUMFPFT",105,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHO")=X
"RTN","XUMFPFT",106,0)
 ;
"RTN","XUMFPFT",107,0)
 ;What Subject Filter
"RTN","XUMFPFT",108,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHAT")) D
"RTN","XUMFPFT",109,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHAT")="4.1"_HLCS_"IFN"_HLCS_"VA FM"
"RTN","XUMFPFT",110,0)
 ;
"RTN","XUMFPFT",111,0)
 ;What Department Data Code
"RTN","XUMFPFT",112,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDDC")) D
"RTN","XUMFPFT",113,0)
 .N X S X="INFRASTRUCTURE"_HLCS_"INFORMATION INFRASTRUCTURE"
"RTN","XUMFPFT",114,0)
 .S X=X_HLCS_"VA TS"
"RTN","XUMFPFT",115,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDDC")=X
"RTN","XUMFPFT",116,0)
 ;
"RTN","XUMFPFT",117,0)
 ;What Data Code Value Qual (optional)
"RTN","XUMFPFT",118,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDCVQ")) D
"RTN","XUMFPFT",119,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDCVQ")=""
"RTN","XUMFPFT",120,0)
 ;
"RTN","XUMFPFT",121,0)
 ;Query Results Level (optional)
"RTN","XUMFPFT",122,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QRL")) D
"RTN","XUMFPFT",123,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QRL")=""
"RTN","XUMFPFT",124,0)
 ;
"RTN","XUMFPFT",125,0)
 Q
"RTN","XUMFPFT",126,0)
 ;
"RTN","XUMFPFT",127,0)
PRE ; -- pre-update record
"RTN","XUMFPFT",128,0)
 ;
"RTN","XUMFPFT",129,0)
 Q
"RTN","XUMFPFT",130,0)
 ;
"RTN","XUMFPFT",131,0)
POST ; -- post-update record
"RTN","XUMFPFT",132,0)
 ;
"RTN","XUMFPFT",133,0)
 Q
"RTN","XUMFPFT",134,0)
 ;
"VER")
8.0^22.0
"^DD",4,4,0)
FIELD^NL^999.1^30
"^DD",4,4,0,0)
^4I
"^DD",4,4,0,"DDA")
N
"^DD",4,4,0,"DT")
3020109
"^DD",4,4,0,"ID","W1")
D EN^DDIOL($P($G(^DIC(5,+$P($G(^(0)),U,2),0)),U,2),,"?31")
"^DD",4,4,0,"ID","W2")
D EN^DDIOL($P($G(^DIC(4.1,+$G(^DIC(4,+Y,3)),0)),U),,"?35")
"^DD",4,4,0,"ID","W3")
D EN^DDIOL($P($G(^DIC(4,+Y,99)),U),,"?45")
"^DD",4,4,0,"ID","W4")
D:$P($G(^DIC(4,+Y,99)),U,4) EN^DDIOL("INACTIVE "_$$FMTE^XLFDT($$IDT^XUAF4(+Y),"D"),,"?54")
"^DD",4,4,0,"IX","AC",4.014,.01)

"^DD",4,4,0,"IX","AC",4.014,1)

"^DD",4,4,0,"IX","AD",4,.01)

"^DD",4,4,0,"IX","AI",4.999,.07)

"^DD",4,4,0,"IX","AP1",4,.01)

"^DD",4,4,0,"IX","ARF",4.999,.06)

"^DD",4,4,0,"IX","ARFM",4.999,.06)

"^DD",4,4,0,"IX","ART",4.999,.05)

"^DD",4,4,0,"IX","ARTO",4.999,.05)

"^DD",4,4,0,"IX","B",4,.01)

"^DD",4,4,0,"IX","C",4,100)

"^DD",4,4,0,"IX","D",4,99)

"^DD",4,4,0,"IX","LOC1",4,720)

"^DD",4,4,0,"IX","OLDNAM",4.999,.02)

"^DD",4,4,0,"IX","XUMF",4,11)

"^DD",4,4,0,"NM","INSTITUTION")

"^DD",4,4,0,"PT",2,.2911)

"^DD",4,4,0,"PT",2,.314)

"^DD",4,4,0,"PT",2,.393)

"^DD",4,4,0,"PT",2,.535)

"^DD",4,4,0,"PT",2,21)

"^DD",4,4,0,"PT",2,27.02)

"^DD",4,4,0,"PT",2,33)

"^DD",4,4,0,"PT",2,991.03)

"^DD",4,4,0,"PT",2,1010.152)

"^DD",4,4,0,"PT",2,1010.154)

"^DD",4,4,0,"PT",2.07,9)

"^DD",4,4,0,"PT",2.0992,2)

"^DD",4,4,0,"PT",2.399,.393)

"^DD",4,4,0,"PT",3.02,.01)

"^DD",4,4,0,"PT",4,96)

"^DD",4,4,0,"PT",4.014,1)

"^DD",4,4,0,"PT",4.02,.03)

"^DD",4,4,0,"PT",4.3,217)

"^DD",4,4,0,"PT",4.999,.05)

"^DD",4,4,0,"PT",4.999,.06)

"^DD",4,4,0,"PT",9.4,11.5)

"^DD",4,4,0,"PT",9.4,11.6)

"^DD",4,4,0,"PT",9.409,.01)

"^DD",4,4,0,"PT",27.11,.06)

"^DD",4,4,0,"PT",28.11,1.04)

"^DD",4,4,0,"PT",28.11,2.04)

"^DD",4,4,0,"PT",40.8,.07)

"^DD",4,4,0,"PT",44,3)

"^DD",4,4,0,"PT",45.87,.1)

"^DD",4,4,0,"PT",59,100)

"^DD",4,4,0,"PT",59.4,1)

"^DD",4,4,0,"PT",60.11,.01)

"^DD",4,4,0,"PT",62.9,.02)

"^DD",4,4,0,"PT",62.9,.03)

"^DD",4,4,0,"PT",62.9,.031)

"^DD",4,4,0,"PT",62.9,.06)

"^DD",4,4,0,"PT",63.04,.111)

"^DD",4,4,0,"PT",63.04,.32)

"^DD",4,4,0,"PT",63.04,.33)

"^DD",4,4,0,"PT",64.03,4)

"^DD",4,4,0,"PT",64.06,.01)

"^DD",4,4,0,"PT",64.1,.01)

"^DD",4,4,0,"PT",65,.16)

"^DD",4,4,0,"PT",65.31,.03)

"^DD",4,4,0,"PT",66.1,.01)

"^DD",4,4,0,"PT",67.9,.01)

"^DD",4,4,0,"PT",67.901,.01)

"^DD",4,4,0,"PT",68.02,16.1)

"^DD",4,4,0,"PT",68.02,16.2)

"^DD",4,4,0,"PT",68.02,26)

"^DD",4,4,0,"PT",68.03,.01)

"^DD",4,4,0,"PT",68.14,3)

"^DD",4,4,0,"PT",69.01,25)

"^DD",4,4,0,"PT",69.03,14)

"^DD",4,4,0,"PT",69.03,15)

"^DD",4,4,0,"PT",69.6,1)

"^DD",4,4,0,"PT",69.6,2)

"^DD",4,4,0,"PT",69.9,3)

"^DD",4,4,0,"PT",69.9001,3)

"^DD",4,4,0,"PT",69.9006,.01)

"^DD",4,4,0,"PT",69.9007,.01)

"^DD",4,4,0,"PT",69.981,.01)

"^DD",4,4,0,"PT",79,.01)

"^DD",4,4,0,"PT",120.846,.01)

"^DD",4,4,0,"PT",130,50)

"^DD",4,4,0,"PT",133,.01)

"^DD",4,4,0,"PT",154,3.2)

"^DD",4,4,0,"PT",154,3.3)

"^DD",4,4,0,"PT",154,3.4)

"^DD",4,4,0,"PT",154,8.4)

"^DD",4,4,0,"PT",154.1,2.11)

"^DD",4,4,0,"PT",154.1,2.12)

"^DD",4,4,0,"PT",158,15.6)

"^DD",4,4,0,"PT",158.9,.01)

"^DD",4,4,0,"PT",160.05,1)

"^DD",4,4,0,"PT",161.01,101)

"^DD",4,4,0,"PT",161.4,27)

"^DD",4,4,0,"PT",162.03,26)

"^DD",4,4,0,"PT",162.11,25)

"^DD",4,4,0,"PT",162.5,23)

"^DD",4,4,0,"PT",162.7,6)

"^DD",4,4,0,"PT",165,99)

"^DD",4,4,0,"PT",190.1,12)

"^DD",4,4,0,"PT",194.2,12)

"^DD",4,4,0,"PT",195.12,.01)

"^DD",4,4,0,"PT",195.9,.01)

"^DD",4,4,0,"PT",200.02,.01)

"^DD",4,4,0,"PT",213.2,.01)

"^DD",4,4,0,"PT",340,.01)

"^DD",4,4,0,"PT",341,.09)

"^DD",4,4,0,"PT",342,.01)

"^DD",4,4,0,"PT",350,.13)

"^DD",4,4,0,"PT",350.9,.02)

"^DD",4,4,0,"PT",389.9,.07)

"^DD",4,4,0,"PT",391.91,.02)

"^DD",4,4,0,"PT",394.2,4)

"^DD",4,4,0,"PT",394.26,.01)

"^DD",4,4,0,"PT",394.81,.01)

"^DD",4,4,0,"PT",394.82,.01)

"^DD",4,4,0,"PT",394.831,.01)

"^DD",4,4,0,"PT",396.12,.01)

"^DD",4,4,0,"PT",396.3,2)

"^DD",4,4,0,"PT",399,111)

"^DD",4,4,0,"PT",404.51,.07)

"^DD",4,4,0,"PT",404.9503,.01)

"^DD",4,4,0,"PT",405,.05)

"^DD",4,4,0,"PT",408,3)

"^DD",4,4,0,"PT",411,.1)

"^DD",4,4,0,"PT",412,.01)

"^DD",4,4,0,"PT",430,12)

"^DD",4,4,0,"PT",604.8,.01)

"^DD",4,4,0,"PT",631.9,4)

"^DD",4,4,0,"PT",660,8)

"^DD",4,4,0,"PT",660,40)

"^DD",4,4,0,"PT",660,70)

"^DD",4,4,0,"PT",660.1,14)

"^DD",4,4,0,"PT",663.4,4)

"^DD",4,4,0,"PT",664,18)

"^DD",4,4,0,"PT",664.1,.03)

"^DD",4,4,0,"PT",664.1,.04)

"^DD",4,4,0,"PT",664.1,.11)

"^DD",4,4,0,"PT",664.2,1.5)

"^DD",4,4,0,"PT",664.2,6)

"^DD",4,4,0,"PT",664.3,2)

"^DD",4,4,0,"PT",664.4,2)

"^DD",4,4,0,"PT",664.4,14)

"^DD",4,4,0,"PT",665,2)

"^DD",4,4,0,"PT",665.1,1)

"^DD",4,4,0,"PT",665.1,6)

"^DD",4,4,0,"PT",665.4,6)

"^DD",4,4,0,"PT",667,11)

"^DD",4,4,0,"PT",667.3,12)

"^DD",4,4,0,"PT",668,2)

"^DD",4,4,0,"PT",669.9,1)

"^DD",4,4,0,"PT",680.6,.04)

"^DD",4,4,0,"PT",688,1)

"^DD",4,4,0,"PT",694.5,2)

"^DD",4,4,0,"PT",698,7)

"^DD",4,4,0,"PT",721,3)

"^DD",4,4,0,"PT",740,.01)

"^DD",4,4,0,"PT",742.6,.01)

"^DD",4,4,0,"PT",747.13,.01)

"^DD",4,4,0,"PT",748.09,.01)

"^DD",4,4,0,"PT",748.3,.02)

"^DD",4,4,0,"PT",785,2)

"^DD",4,4,0,"PT",785.5,2)

"^DD",4,4,0,"PT",810.13,.01)

"^DD",4,4,0,"PT",839.7,.04)

"^DD",4,4,0,"PT",850,3)

"^DD",4,4,0,"PT",850,16)

"^DD",4,4,0,"PT",869.3,.04)

"^DD",4,4,0,"PT",870,.02)

"^DD",4,4,0,"PT",912,5.01)

"^DD",4,4,0,"PT",914,5.01)

"^DD",4,4,0,"PT",984.9,.07)

"^DD",4,4,0,"PT",984.9,.09)

"^DD",4,4,0,"PT",1020.1,8)

"^DD",4,4,0,"PT",1020.2,1)

"^DD",4,4,0,"PT",1020.5,.01)

"^DD",4,4,0,"PT",1020.8,.01)

"^DD",4,4,0,"PT",2101.7,.01)

"^DD",4,4,0,"PT",6925,3)

"^DD",4,4,0,"PT",6925,15.3)

"^DD",4,4,0,"PT",7105.07,1)

"^DD",4,4,0,"PT",8925.99,.01)

"^DD",4,4,0,"PT",8986.095,.01)

"^DD",4,4,0,"PT",8989.3,217)

"^DD",4,4,0,"PT",8989.5,.01)

"^DD",4,4,0,"PT",503338,.01)

"^DD",4,4,0,"PT",509850.8,.01)

"^DD",4,4,0,"PT",662002.01,1)

"^DD",4,4,0,"PT",662003,3)

"^DD",4,4,0,"PT",662003.04,2)

"^DD",4,4,0,"PT",791813,.01)

"^DD",4,4,0,"PT",791813,2.01)

"^DD",4,4,0,"PT",9999999.06,.01)

"^DD",4,4,0,"VRPK")
XU
"^DD",4,4,.01,0)
NAME^RRFX^^0;1^K:$L(X)>30!(+X=X)!($L(X)<3)!'(X'?1P.E) X K:($P($G(^DIC(4,+$G(DA),0)),U,11)="N")&'$G(XUMF) X
"^DD",4,4,.01,.1)
INSTITUTION NAME
"^DD",4,4,.01,1,0)
^.1
"^DD",4,4,.01,1,1,0)
4^B
"^DD",4,4,.01,1,1,1)
S ^DIC(4,"B",$E(X,1,30),DA)=""
"^DD",4,4,.01,1,1,2)
K ^DIC(4,"B",$E(X,1,30),DA)
"^DD",4,4,.01,1,2,0)
4^AP1^MUMPS
"^DD",4,4,.01,1,2,1)
F I=0:0 S I=$O(^DIC(4,DA,4,I)) Q:I'>0  S Y(1)=+^(I,0),Y(2)=$S($D(^DIC(9.4,Y(1),0)):^(0),1:"") S:Y(2)]"" ^DIC(4,"AP"_$P(Y(2),U,2),$E(X,1,30),DA)=""
"^DD",4,4,.01,1,2,2)
S Y="AP" F I=0:0 S Y=$O(^DIC(4,Y)) Q:$E(Y,1,2)'="AP"  K ^DIC(4,Y,$E(X,1,30),DA)
"^DD",4,4,.01,1,2,3)
Special Package X-ref
"^DD",4,4,.01,1,2,"DT")
2900103
"^DD",4,4,.01,1,3,0)
4^AD^MUMPS
"^DD",4,4,.01,1,3,1)
I $D(^AUTTLOC(0))#2 N DIC,DD,DO,DINUM,DS S DIC="^AUTTLOC(",DIC(0)="",(X,DINUM)=DA D FILE^DICN
"^DD",4,4,.01,1,3,2)
I $D(^AUTTLOC(0))#2 N DIK S DIK="^AUTTLOC(" D ^DIK
"^DD",4,4,.01,1,3,3)
Needed to keep PCE location file in sync.
"^DD",4,4,.01,1,3,"%D",0)
^^2^2^2980827^
"^DD",4,4,.01,1,3,"%D",1,0)
This MUMPS cross reference is used to keep the PCE location file
"^DD",4,4,.01,1,3,"%D",2,0)
(#9999999.06) synchronized with the Institution file.
"^DD",4,4,.01,1,3,"DT")
2980827
"^DD",4,4,.01,3)
Name must be 3-30 characters -- if national entry, do not edit!
"^DD",4,4,.01,21,0)
^^2^2^2920528^^^^
"^DD",4,4,.01,21,1,0)
This is the name of the institution with out modifiers like state
"^DD",4,4,.01,21,2,0)
or type.
"^DD",4,4,.01,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,.01,"DT")
3010518
"^DD",4,4,.02,0)
STATE^P5'X^DIC(5,^0;2^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N" X
"^DD",4,4,.02,3)
Enter the state -- if national entry, do not edit!
"^DD",4,4,.02,21,0)
^^1^1^3011218^
"^DD",4,4,.02,21,1,0)
State that the institution is physically located.
"^DD",4,4,.02,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,.02,"DT")
3011218
"^DD",4,4,.03,0)
DISTRICT^NJ2,0X^^0;3^K:+X'=X!(X>27)!(X<1)!(X?.E1"."1N.N) X
"^DD",4,4,.03,1,0)
^.1^^0
"^DD",4,4,.03,3)
TYPE A WHOLE NUMBER BETWEEN 1 AND 27
"^DD",4,4,.03,21,0)
^^2^2^2920702^
"^DD",4,4,.03,21,1,0)
This is the Medical District of the Institution file.  Therefore it is not
"^DD",4,4,.03,21,2,0)
to be changed except by appropriately knowledgeable individuals.
"^DD",4,4,.03,"DT")
2900409
"^DD",4,4,.05,0)
SHORT NAME^F^^0;5^K:$L(X)>80!($L(X)<4) X
"^DD",4,4,.05,1,0)
^.1^^0
"^DD",4,4,.05,3)
ANSWER MUST BE 4-80 CHARACTERS IN LENGTH
"^DD",4,4,.05,21,0)
^^1^1^2930330^
"^DD",4,4,.05,21,1,0)
Short version of name.
"^DD",4,4,.05,"DT")
2840410
"^DD",4,4,.06,0)
VA TYPE CODE^S^MC:HOSP;DM:DOM;NH:NH;RO:RO;DP:DPC;OI:OC-IND;OM:OC-UNDER MMT;OS:OC-SUB;PC:PROTH;PD:PDC;RP:RPC;CO:VACO;CR:VACO-RO;MCDM:MC&DOM;MCDMNH:MC,DOM,NH;MCNH:MC&NH;MCRO:MC&RO;RODP:RO&DPC;^0;6^Q
"^DD",4,4,.06,21,0)
^^1^1^2920528^^^
"^DD",4,4,.06,21,1,0)
This field is being replaced by the Facitily type field.
"^DD",4,4,.07,0)
REGION^NJ1,0^^0;7^K:+X'=X!(X>7)!(X<1)!(X?.E1"."1N.N) X
"^DD",4,4,.07,1,0)
^.1^^0
"^DD",4,4,.07,3)
TYPE A WHOLE NUMBER BETWEEN 1 AND 7
"^DD",4,4,.07,21,0)
^^1^1^2920528^^^^
"^DD",4,4,.07,21,1,0)
VA region number.
"^DD",4,4,.07,"DT")
2900409
"^DD",4,4,1.01,0)
STREET ADDR. 1^F^^1;1^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,1.01,3)
ANSWER MUST BE 2-40 CHARACTERS IN LENGTH
"^DD",4,4,1.01,21,0)
^^1^1^3011218^
"^DD",4,4,1.01,21,1,0)
First line of the street address (physical) of the facility.
"^DD",4,4,1.01,"DT")
3011218
"^DD",4,4,1.02,0)
STREET ADDR. 2^F^^1;2^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,1.02,3)
ANSWER MUST BE 2-40 CHARACTERS IN LENGTH
"^DD",4,4,1.02,21,0)
^^1^1^3020805^^
"^DD",4,4,1.02,21,1,0)
Second line of street address (physical) of the facility.
"^DD",4,4,1.02,"DT")
3020805
"^DD",4,4,1.03,0)
CITY^F^^1;3^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,1.03,3)
ANSWER MUST BE 2-40 CHARACTERS IN LENGTH
"^DD",4,4,1.03,21,0)
^.001^1^1^3011231^^
"^DD",4,4,1.03,21,1,0)
The city the facility is physically located.
"^DD",4,4,1.03,"DT")
3011218
"^DD",4,4,1.04,0)
ZIP^FX^^1;4^K:$L(X)>10!($L(X)<5)!'((X?5N)!(X?5N1"-"4N)) X
"^DD",4,4,1.04,3)
Enter ZIP code or ZIP + 4
"^DD",4,4,1.04,21,0)
^.001^1^1^3011231^^^
"^DD",4,4,1.04,21,1,0)
Postal ZIP code for the physical address of the facility.
"^DD",4,4,1.04,"DT")
3011218
"^DD",4,4,4,0)
CONTACT^4.03^^2;0
"^DD",4,4,4,21,0)
^^1^1^2920528^^^^
"^DD",4,4,4,21,1,0)
List of contacts.
"^DD",4,4,4.01,0)
ST. ADDR. 1 (MAILING)^F^^4;1^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,4.01,3)
Answer must be 2-40 characters in length.
"^DD",4,4,4.01,21,0)
^^1^1^3011231^
"^DD",4,4,4.01,21,1,0)
First line of the street address (mailing) of the facility.
"^DD",4,4,4.01,"DT")
3011231
"^DD",4,4,4.02,0)
ST. ADDR. 2 (MAILING)^F^^4;2^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,4.02,3)
Answer must be 2-40 characters in length.
"^DD",4,4,4.02,21,0)
^^1^1^3011231^
"^DD",4,4,4.02,21,1,0)
Second line of the street address (mailing) of the facility.
"^DD",4,4,4.02,"DT")
3011231
"^DD",4,4,4.03,0)
CITY (MAILING)^F^^4;3^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,4.03,3)
Answer must be 2-40 characters in length.
"^DD",4,4,4.03,21,0)
^^1^1^3011231^
"^DD",4,4,4.03,21,1,0)
The City of the facility's mailing address.
"^DD",4,4,4.03,"DT")
3011231
"^DD",4,4,4.04,0)
STATE (MAILING)^P5'^DIC(5,^4;4^Q
"^DD",4,4,4.04,21,0)
^^1^1^3011231^
"^DD",4,4,4.04,21,1,0)
The State of the facility's mailing address.
"^DD",4,4,4.04,"DT")
3011231
"^DD",4,4,4.05,0)
ZIP (MAILING)^FX^^4;5^K:$L(X)>10!($L(X)<5)!'((X?5N)!(X?5N1"-"4N)) X
"^DD",4,4,4.05,3)
Enter ZIP code or ZIP + 4
"^DD",4,4,4.05,21,0)
^^1^1^3011231^
"^DD",4,4,4.05,21,1,0)
Postal ZIP code for the mailing address of the facility.
"^DD",4,4,4.05,"DT")
3020122
"^DD",4,4,5,0)
MULTI-DIVISION FACILITY^S^Y:YES;N:NO;^DIV;1^Q
"^DD",4,4,5,21,0)
^^1^1^2930330^
"^DD",4,4,5,21,1,0)
Flag to indicate this is a multi-division facility.
"^DD",4,4,5,"DT")
3010104
"^DD",4,4,11,0)
STATUS^RSX^N:National;L:Local;^0;11^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N"!(X["N") X
"^DD",4,4,11,1,0)
^.1
"^DD",4,4,11,1,1,0)
4^XUMF
"^DD",4,4,11,1,1,1)
S ^DIC(4,"XUMF",$E(X,1,30),DA)=""
"^DD",4,4,11,1,1,2)
K ^DIC(4,"XUMF",$E(X,1,30),DA)
"^DD",4,4,11,1,1,"%D",0)
^^2^2^3010524^
"^DD",4,4,11,1,1,"%D",1,0)
This x-ref. is used by the master file server query.  It loops this x-ref to
"^DD",4,4,11,1,1,"%D",2,0)
find all national entries.
"^DD",4,4,11,1,1,"DT")
3000302
"^DD",4,4,11,3)
Local or National -- if national, do not edit!
"^DD",4,4,11,21,0)
^^17^17^3010104^^
"^DD",4,4,11,21,1,0)
An Institution has a STATUS (#11) of either LOCAL or NATIONAL.
"^DD",4,4,11,21,2,0)

"^DD",4,4,11,21,3,0)
Inactive facilities are flagged as such by the field INACTIVE
"^DD",4,4,11,21,4,0)
FACILITY FLAG (#101).
"^DD",4,4,11,21,5,0)

"^DD",4,4,11,21,6,0)
National entries are facilities that have a STATION NUMBER (#99)
"^DD",4,4,11,21,7,0)
approved by Information Management Service (045A4).  National
"^DD",4,4,11,21,8,0)
entries are maintained by the Master File Server located on FORUM.
"^DD",4,4,11,21,9,0)

"^DD",4,4,11,21,10,0)
Local entries are facilities that are entered locally.  Local
"^DD",4,4,11,21,11,0)
entries no not have a STATION NUMBER (#99).  (Only offically
"^DD",4,4,11,21,12,0)
approved station numbers are allowed in the STATION NUMBER (#99)
"^DD",4,4,11,21,13,0)
field.)
"^DD",4,4,11,21,14,0)

"^DD",4,4,11,21,15,0)
All national entries will have a STATUS (#11) of NATIONAL.  Do
"^DD",4,4,11,21,16,0)
not edit the STATUS (#11) of a national entry.  Do not set a LOCAL
"^DD",4,4,11,21,17,0)
entry to a STATUS (#11) of NATIONAL.
"^DD",4,4,11,23,0)
^^17^17^3010104^
"^DD",4,4,11,23,1,0)
An Institution has a STATUS (#11) of either LOCAL or NATIONAL.
"^DD",4,4,11,23,2,0)

"^DD",4,4,11,23,3,0)
Inactive facilities are flagged as such by the field INACTIVE
"^DD",4,4,11,23,4,0)
FACILITY FLAG (#101).
"^DD",4,4,11,23,5,0)

"^DD",4,4,11,23,6,0)
National entries are facilities that have a STATION NUMBER (#99)
"^DD",4,4,11,23,7,0)
approved by Information Management Service (045A4).  National
"^DD",4,4,11,23,8,0)
entries are maintained by the Master File Server located on FORUM.
"^DD",4,4,11,23,9,0)

"^DD",4,4,11,23,10,0)
Local entries are facilities that are entered locally.  Local
"^DD",4,4,11,23,11,0)
entries no not have a STATION NUMBER (#99).  (Only offically
"^DD",4,4,11,23,12,0)
approved station numbers are allowed in the STATION NUMBER (#99)
"^DD",4,4,11,23,13,0)
field.)
"^DD",4,4,11,23,14,0)

"^DD",4,4,11,23,15,0)
All national entries will have a STATUS (#11) of NATIONAL.  Do
"^DD",4,4,11,23,16,0)
not edit the STATUS (#11) of a national entry.  Do not set a LOCAL
"^DD",4,4,11,23,17,0)
entry to a STATUS (#11) of NATIONAL.
"^DD",4,4,11,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,11,"DT")
3010108
"^DD",4,4,13,0)
FACILITY TYPE^P4.1X^DIC(4.1,^3;1^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N" X
"^DD",4,4,13,3)
Enter Facility Type -- If national entry, do not edit!
"^DD",4,4,13,21,0)
^^1^1^2920706^^
"^DD",4,4,13,21,1,0)
The type of facility. A replacement for the type field.
"^DD",4,4,13,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,13,"DT")
3010104
"^DD",4,4,14,0)
ASSOCIATIONS^4.014P^^7;0
"^DD",4,4,51,0)
ACOS HOSPITAL ID^F^^5;1^K:$L(X)>6!($L(X)<6)!'(X?6N) X
"^DD",4,4,51,.1)
American College of Surgeons Hospital ID
"^DD",4,4,51,3)
Please enter American College of Surgeons 6 digit ID number.
"^DD",4,4,51,21,0)
^^6^6^2920513^^
"^DD",4,4,51,21,1,0)
This field holds the six-digit code assigned to this facility by
"^DD",4,4,51,21,2,0)
the American College of Surgeons (ACOS) Commission on Cancer, the
"^DD",4,4,51,21,3,0)
organization that accredits a hospital's Cancer Program and Tumor
"^DD",4,4,51,21,4,0)
Registry.  A facility will only have an ACOS number if they have
"^DD",4,4,51,21,5,0)
requested a Cancer Program survey from the ACOS (not all facilities
"^DD",4,4,51,21,6,0)
will have a number).
"^DD",4,4,51,"DT")
2900306
"^DD",4,4,60,0)
DOMAIN^P4.2'^DIC(4.2,^6;1^Q
"^DD",4,4,60,3)
This allows a link from the institution file to the domain file.
"^DD",4,4,60,21,0)
^^1^1^2920513^^^
"^DD",4,4,60,21,1,0)
A pointer to the domain so the institution can be linked to a E-mail domain.
"^DD",4,4,60,"DT")
2900516
"^DD",4,4,95,0)
AGENCY CODE^S^V:VA;AF:AIR FORCE;I:IHS;ARMY:ARMY;N:NAVY;O:OTHER;^99;5^Q
"^DD",4,4,95,1,0)
^.1
"^DD",4,4,95,1,1,0)
^^TRIGGER^4^97
"^DD",4,4,95,1,1,1)
K DIV,Y S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DIC(4,D0,99)):^(99),1:""),Y(2)=$P(Y(1),U,5),Y(3)=$P(Y(1),U,7) X ^DD(4,95,1,1,1.1) I X]"" S X=$O(^DIC(4.11,"B",X,0)) X ^DD(4,95,1,1,1.4)
"^DD",4,4,95,1,1,1.1)
S X=DIV S Y(5)=$C(59)_$S($D(^DD(4,95,0)):$P(^(0),U,3),1:""),X=$P($P(Y(5),$C(59)_DIV_":",2),$C(59),1),Y(4)=$S($D(^DIC(4.11,+Y(3),0)):^(0),1:"")
"^DD",4,4,95,1,1,1.4)
I Y(2)'=$P(Y(4),U,2) S DIU=Y(3),DIV=X,$P(^DIC(4,D0,99),U,7)=DIV,DIH=4,DIG=97 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",4,4,95,1,1,2)
Q  K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DIC(4,D0,99)):^(99),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X="" S DIH=$S($D(^DIC(4,DIV(0),99)):^(99),1:""),DIV=X S $P(^(99),U,7)=DIV,DIH=4,DIG=97 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",4,4,95,1,1,3)
Link to keep fields 95 and 97 in sync. (Edited)
"^DD",4,4,95,1,1,"CREATE VALUE")
AGENCY CODE
"^DD",4,4,95,1,1,"DELETE VALUE")
NO EFFECT
"^DD",4,4,95,1,1,"FIELD")
POINTER TO AGENCY
"^DD",4,4,95,3)
What type of instution is this. Other for non-goverment.
"^DD",4,4,95,5,1,0)
4^97^1
"^DD",4,4,95,21,0)
^^2^2^2920513^^^
"^DD",4,4,95,21,1,0)
A code to identify the Government agency that this site belongs to.
"^DD",4,4,95,21,2,0)
This is a duplicate of the POINTER TO AGENCY field.
"^DD",4,4,95,"DT")
2900103
"^DD",4,4,96,0)
REPORTING STATION^*P4'^DIC(4,^99;6^S DIC("S")="I $S($D(^(99)):$P(^(99),U,1)?3N,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",4,4,96,3)
Enter the consolidating reporting station.  (must have a 3 digit station number)
"^DD",4,4,96,12)
Can only select instutions with a 3 numeric station number.
"^DD",4,4,96,12.1)
S DIC("S")="I $S($D(^(99)):$P(^(99),U,1)?3N,1:0)"
"^DD",4,4,96,21,0)
^^2^2^2920513^^^
"^DD",4,4,96,21,1,0)
This is a pointer back to the Institution file that indicates the
"^DD",4,4,96,21,2,0)
site that does the reporting to VACO.
"^DD",4,4,96,"DT")
2890726
"^DD",4,4,97,0)
POINTER TO AGENCY^RP4.11'^DIC(4.11,^99;7^Q
"^DD",4,4,97,1,0)
^.1
"^DD",4,4,97,1,1,0)
^^TRIGGER^4^95
"^DD",4,4,97,1,1,1)
X ^DD(4,97,1,1,1.3) I X,Y(3)]"" S X=Y(3) X ^DD(4,97,1,1,1.4)
"^DD",4,4,97,1,1,1.3)
K DIV,Y S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(4,97,1,1,69.2) S Y(3)=$P(Y(101),U,2),X=(Y(2)'=Y(3)) S D0=I(0,0)
"^DD",4,4,97,1,1,1.4)
S DIH=$S($D(^DIC(4,DIV(0),99)):^(99),1:""),DIV=X,DIU=$P(DIH,U,5) S $P(^(99),U,5)=DIV,DIH=4,DIG=95 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",4,4,97,1,1,2)
Q
"^DD",4,4,97,1,1,3)
Link to keep fields 95 and 97 in sync. (Edited)
"^DD",4,4,97,1,1,69.2)
S I(0,0)=$S($D(D0):D0,1:""),Y(1)=$S($D(^DIC(4,D0,99)):^(99),1:"") S X=$P(Y(1),U,5),X=X S X=X,Y(2)=X,D0=Y(0) S:'$D(^DIC(4.11,+D0,0)) D0=-1 S Y(101)=$S($D(^DIC(4.11,D0,0)):^(0),1:"")
"^DD",4,4,97,1,1,"CREATE CONDITION")
INTERNAL(AGENCY CODE)'=INTERNAL(POINTER TO AGENCY:AGENCY CODE)
"^DD",4,4,97,1,1,"CREATE VALUE")
INTERNAL(POINTER TO AGENCY:AGENCY CODE)
"^DD",4,4,97,1,1,"DELETE VALUE")
NO EFFECT
"^DD",4,4,97,1,1,"DT")
2900103
"^DD",4,4,97,1,1,"FIELD")
AGENCY CODE
"^DD",4,4,97,5,1,0)
4^95^1
"^DD",4,4,97,21,0)
^^2^2^2920513^^^
"^DD",4,4,97,21,1,0)
A pointer to a file that identifies the government agency that
"^DD",4,4,97,21,2,0)
this site belongs to.  Keep in sync with the Agency code field.
"^DD",4,4,97,"DT")
2900103
"^DD",4,4,99,0)
STATION NUMBER^FX^^99;1^K:$L(X)>7!($L(X)<3)!'(X?3N.AN) X Q:$G(XUMF)  K X
"^DD",4,4,99,1,0)
^.1
"^DD",4,4,99,1,1,0)
4^D^MUMPS
"^DD",4,4,99,1,1,1)
S ^DIC(4,"D",$E(X,1,30),DA)=""
"^DD",4,4,99,1,1,2)
K ^DIC(4,"D",$E(X,1,30),DA) S ^DIC(4,"AOLD99",DA,$E(X,1,30))=""
"^DD",4,4,99,1,1,"%D",0)
^^3^3^3010524^
"^DD",4,4,99,1,1,"%D",1,0)
The "AOLD99" x-ref (kill statement 0f "D" x-ref) is used by $$O99^XUAF4 to get
"^DD",4,4,99,1,1,"%D",2,0)
the pointer to the valid entry with station number for duplicate station
"^DD",4,4,99,1,1,"%D",3,0)
numbers resolved by the clean up (patch xu*8.0*126).
"^DD",4,4,99,1,1,"DT")
3000703
"^DD",4,4,99,3)
No local station numbers allowed!
"^DD",4,4,99,20,0)
^.3LA^1^1
"^DD",4,4,99,20,1,0)
RUPP
"^DD",4,4,99,21,0)
^^1^1^2920513^^
"^DD",4,4,99,21,1,0)
This is the 3 digit station number plus any modifiers.
"^DD",4,4,99,"DT")
3010518
"^DD",4,4,100,0)
OFFICIAL VA NAME^FX^^99;3^K:$L(X)>80!($L(X)<2) X K:($P($G(^DIC(4,+$G(DA),0)),U,11)="N")&'$G(XUMF) X
"^DD",4,4,100,1,0)
^.1
"^DD",4,4,100,1,1,0)
4^C
"^DD",4,4,100,1,1,1)
S ^DIC(4,"C",$E(X,1,30),DA)=""
"^DD",4,4,100,1,1,2)
K ^DIC(4,"C",$E(X,1,30),DA)
"^DD",4,4,100,1,1,"DT")
2960828
"^DD",4,4,100,3)
Only national entries should have an official VA name.  If national entry, do not edit!
"^DD",4,4,100,21,0)
^^2^2^2960816^
"^DD",4,4,100,21,1,0)
This field holds the Offical VA name for this VA facility.
"^DD",4,4,100,21,2,0)
The value in this field should not be changed by the site.
"^DD",4,4,100,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,100,"DT")
3010518
"^DD",4,4,101,0)
INACTIVE FACILITY FLAG^SX^1:INACTIVE;^99;4^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N" X
"^DD",4,4,101,3)
1 flags inactive entry.  If national entry, do not edit!
"^DD",4,4,101,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,101,"DT")
3010104
"^DD",4,4,720,0)
CURRENT LOCATION^S^1:YES;0:NO;^EC;1^Q
"^DD",4,4,720,1,0)
^.1
"^DD",4,4,720,1,1,0)
4^LOC1^MUMPS
"^DD",4,4,720,1,1,1)
I X S ^DIC(4,"LOC",$P(^DIC(4,DA,0),"^"),DA)=""
"^DD",4,4,720,1,1,2)
K ^DIC(4,"LOC",$P(^DIC(4,DA,0),"^"),DA)
"^DD",4,4,720,1,1,"%D",0)
^^1^1^2960507^
"^DD",4,4,720,1,1,"%D",1,0)
Sets and kills the "LOC" nodes.
"^DD",4,4,720,1,1,"DT")
2960507
"^DD",4,4,720,3)
Entering a 1 for YES means ACTIVE, a 0 for NO means INACTIVE.
"^DD",4,4,720,21,0)
^^5^5^2960507^^^
"^DD",4,4,720,21,1,0)
This field flags entries for use in the Event Capture software.
"^DD",4,4,720,21,2,0)
  
"^DD",4,4,720,21,3,0)
       '1'  for   'YES'   (ACTIVE)
"^DD",4,4,720,21,4,0)
  
"^DD",4,4,720,21,5,0)
       '0'  for   'NO'    (INACTIVE)
"^DD",4,4,720,"DT")
2960507
"^DD",4,4,999.1,0)
HISTORY^4.999DA^^999;0
"^DD",4,4.014,0)
ASSOCIATIONS SUB-FIELD^^1^2
"^DD",4,4.014,0,"DT")
2971021
"^DD",4,4.014,0,"IX","B",4.014,.01)

"^DD",4,4.014,0,"NM","ASSOCIATIONS")

"^DD",4,4.014,0,"UP")
4
"^DD",4,4.014,.01,0)
ASSOCIATIONS^P4.05'X^DIC(4.05,^0;1^S DINUM=X
"^DD",4,4.014,.01,1,0)
^.1^^-1
"^DD",4,4.014,.01,1,1,0)
4.014^B
"^DD",4,4.014,.01,1,1,1)
S ^DIC(4,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",4,4.014,.01,1,1,2)
K ^DIC(4,DA(1),7,"B",$E(X,1,30),DA)
"^DD",4,4.014,.01,21,0)
^^2^2^2971021^
"^DD",4,4.014,.01,21,1,0)
This multiple field is used to link groups if Institutions into
"^DD",4,4.014,.01,21,2,0)
associations.
"^DD",4,4.014,.01,"DT")
2971203
"^DD",4,4.014,1,0)
PARENT OF ASSOCIATION^RP4'^DIC(4,^0;2^Q
"^DD",4,4.014,1,1,0)
^.1
"^DD",4,4.014,1,1,1,0)
4^AC^MUMPS
"^DD",4,4.014,1,1,1,1)
S ^DIC(4,"AC",DA,X,DA(1))=""
"^DD",4,4.014,1,1,1,2)
K ^DIC(4,"AC",DA,X,DA(1))
"^DD",4,4.014,1,1,1,3)
This is needed by CIRN
"^DD",4,4.014,1,1,1,"%D",0)
^^2^2^2971021^
"^DD",4,4.014,1,1,1,"%D",1,0)
This X-ref is used to find the children of a patent for an Association
"^DD",4,4.014,1,1,1,"%D",2,0)
type.
"^DD",4,4.014,1,1,1,"DT")
2971021
"^DD",4,4.014,1,21,0)
^^2^2^2971021^^
"^DD",4,4.014,1,21,1,0)
This field points back to the Institution file to indicate the
"^DD",4,4.014,1,21,2,0)
parent of the association.
"^DD",4,4.014,1,"DT")
2971021
"^DD",4,4.03,0)
CONTACT SUB-FIELD^NL^.03^3
"^DD",4,4.03,0,"NM","CONTACT")

"^DD",4,4.03,0,"UP")
4
"^DD",4,4.03,.01,0)
CONTACT^MF^^0;1^K:$L(X)>30!($L(X)<2) X
"^DD",4,4.03,.01,3)
ANSWER MUST BE 2-30 CHARACTERS IN LENGTH
"^DD",4,4.03,.01,21,0)
^^1^1^2920528^^^^
"^DD",4,4.03,.01,21,1,0)
The name of a contact at the site.
"^DD",4,4.03,.02,0)
AREA^P44'^SC(^0;2^Q
"^DD",4,4.03,.02,21,0)
^^1^1^2920528^^^^
"^DD",4,4.03,.02,21,1,0)
Pointer to the part of the site the contact works in.
"^DD",4,4.03,.03,0)
PHONE #^F^^0;3^K:$L(X)>30!($L(X)<2) X
"^DD",4,4.03,.03,3)
ANSWER MUST BE 2-30 CHARACTERS IN LENGTH
"^DD",4,4.03,.03,21,0)
^^1^1^2920528^^^^
"^DD",4,4.03,.03,21,1,0)
Telephone number.
"^DD",4,4.999,0)
HISTORY SUB-FIELD^^.08^7
"^DD",4,4.999,0,"DT")
3000606
"^DD",4,4.999,0,"IX","B",4.999,.01)

"^DD",4,4.999,0,"NM","HISTORY")

"^DD",4,4.999,0,"UP")
4
"^DD",4,4.999,.01,0)
EFFECTIVE DATE^DX^^0;1^S %DT="EX" D ^%DT S X=Y K:X<1 X S DINUM=X
"^DD",4,4.999,.01,1,0)
^.1
"^DD",4,4.999,.01,1,1,0)
4.999^B
"^DD",4,4.999,.01,1,1,1)
S ^DIC(4,DA(1),999,"B",$E(X,1,30),DA)=""
"^DD",4,4.999,.01,1,1,2)
K ^DIC(4,DA(1),999,"B",$E(X,1,30),DA)
"^DD",4,4.999,.01,3)
The effective date of the change.
"^DD",4,4.999,.01,"DT")
3000605
"^DD",4,4.999,.02,0)
NAME (CHANGED FROM)^F^^0;2^K:$L(X)>30!($L(X)<3) X
"^DD",4,4.999,.02,1,0)
^.1
"^DD",4,4.999,.02,1,1,0)
4^OLDNAM
"^DD",4,4.999,.02,1,1,1)
S ^DIC(4,"OLDNAM",$E(X,1,30),DA(1),DA)=""
"^DD",4,4.999,.02,1,1,2)
K ^DIC(4,"OLDNAM",$E(X,1,30),DA(1),DA)
"^DD",4,4.999,.02,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.02,1,1,"%D",1,0)
This x-ref stores the old name.
"^DD",4,4.999,.02,1,1,"DT")
3000721
"^DD",4,4.999,.02,3)
If NAME changed, this field holds old value.
"^DD",4,4.999,.02,"DT")
3000721
"^DD",4,4.999,.03,0)
OFFICAL VA NAME (CHANGED FROM)^F^^0;3^K:$L(X)>80!($L(X)<3) X
"^DD",4,4.999,.03,3)
If OFFICAL VA NAME changed, this field holds old value.
"^DD",4,4.999,.03,"DT")
3000606
"^DD",4,4.999,.05,0)
REALIGNED TO^P4'^DIC(4,^0;5^Q
"^DD",4,4.999,.05,1,0)
^.1
"^DD",4,4.999,.05,1,1,0)
4^ART
"^DD",4,4.999,.05,1,1,1)
S ^DIC(4,"ART",$E(X,1,30),DA(1),DA)=""
"^DD",4,4.999,.05,1,1,2)
K ^DIC(4,"ART",$E(X,1,30),DA(1),DA)
"^DD",4,4.999,.05,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.05,1,1,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.05,1,1,"DT")
3000612
"^DD",4,4.999,.05,1,2,0)
4^ARTO^MUMPS
"^DD",4,4.999,.05,1,2,1)
S ^DIC(4,"ARTO",DA(1),X)=""
"^DD",4,4.999,.05,1,2,2)
K ^DIC(4,"ARTO",DA(1),X)
"^DD",4,4.999,.05,1,2,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.05,1,2,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.05,1,2,"DT")
3000612
"^DD",4,4.999,.05,3)
This field points to the new entry with valid station number.\]
"^DD",4,4.999,.05,"DT")
3000612
"^DD",4,4.999,.06,0)
REALIGNED FROM^P4'^DIC(4,^0;6^Q
"^DD",4,4.999,.06,1,0)
^.1
"^DD",4,4.999,.06,1,1,0)
4^ARF
"^DD",4,4.999,.06,1,1,1)
S ^DIC(4,"ARF",$E(X,1,30),DA(1),DA)=""
"^DD",4,4.999,.06,1,1,2)
K ^DIC(4,"ARF",$E(X,1,30),DA(1),DA)
"^DD",4,4.999,.06,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.06,1,1,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.06,1,1,"DT")
3000612
"^DD",4,4.999,.06,1,2,0)
4^ARFM^MUMPS
"^DD",4,4.999,.06,1,2,1)
S ^DIC(4,"ARFM",DA(1),X)=""
"^DD",4,4.999,.06,1,2,2)
K ^DIC(4,"ARFM",DA(1),X)
"^DD",4,4.999,.06,1,2,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.06,1,2,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.06,1,2,"DT")
3000612
"^DD",4,4.999,.06,3)
This field points to the old entry/sta# for this facility.
"^DD",4,4.999,.06,"DT")
3000612
"^DD",4,4.999,.07,0)
DEACTIVATED FACILITY / STA #^S^1:DEACTIVATED;^0;7^Q
"^DD",4,4.999,.07,1,0)
^.1
"^DD",4,4.999,.07,1,1,0)
4^AI^MUMPS
"^DD",4,4.999,.07,1,1,1)
S ^DIC(4,"AI",DA(1),DA)=""
"^DD",4,4.999,.07,1,1,2)
K ^DIC(4,"AI",DA(1),DA)
"^DD",4,4.999,.07,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.07,1,1,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.07,1,1,"DT")
3000613
"^DD",4,4.999,.07,3)
Flags deactivated facilities and/or station numbers.
"^DD",4,4.999,.07,"DT")
3000613
"^DD",4,4.999,.08,0)
ACTIVATED FACILITY^S^1:ACTIVATED;^0;8^Q
"^DD",4,4.999,.08,3)
Flags activated facilities for EFFECTIVE DATE.
"^DD",4,4.999,.08,"DT")
3000606
"^DIC",4,4,0)
INSTITUTION^4I
"^DIC",4,4,0,"GL")
^DIC(4,
"^DIC",4,4,"%",0)
^1.005^2^2
"^DIC",4,4,"%",1,0)
XU
"^DIC",4,4,"%",2,0)
QAP
"^DIC",4,4,"%","B","QAP",2)

"^DIC",4,4,"%","B","XU",1)

"^DIC",4,4,"%D",0)
^^3^3^2950306^^^^
"^DIC",4,4,"%D",1,0)
This file contains a listing of VA institutions.  It is cross-referenced
"^DIC",4,4,"%D",2,0)
by name and station number.  The Number field is no longer meaningful (it
"^DIC",4,4,"%D",3,0)
had previously referenced the station number).
"^DIC",4,"B","INSTITUTION",4)

**END**
**END**
