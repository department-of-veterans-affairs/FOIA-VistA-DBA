Released IVM*2*101 SEQ #101
Extracted from mail message
**KIDS**:IVM*2.0*101^

**INSTALL NAME**
IVM*2.0*101
"BLD",6506,0)
IVM*2.0*101^INCOME VERIFICATION MATCH^0^3070110^y
"BLD",6506,1,0)
^^1^1^3061205^^^
"BLD",6506,1,1,0)
See the patch description for IVM*2*101 in the FORUM patch module.
"BLD",6506,4,0)
^9.64PA^^
"BLD",6506,6)
3^
"BLD",6506,6.3)
5
"BLD",6506,"INID")
^n
"BLD",6506,"INIT")
EP^IVM2101C
"BLD",6506,"KRN",0)
^9.67PA^8989.52^19
"BLD",6506,"KRN",.4,0)
.4
"BLD",6506,"KRN",.401,0)
.401
"BLD",6506,"KRN",.402,0)
.402
"BLD",6506,"KRN",.403,0)
.403
"BLD",6506,"KRN",.5,0)
.5
"BLD",6506,"KRN",.84,0)
.84
"BLD",6506,"KRN",3.6,0)
3.6
"BLD",6506,"KRN",3.8,0)
3.8
"BLD",6506,"KRN",9.2,0)
9.2
"BLD",6506,"KRN",9.8,0)
9.8
"BLD",6506,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6506,"KRN",9.8,"NM",1,0)
IVMUM3^^0^B8050850
"BLD",6506,"KRN",9.8,"NM",2,0)
IVMCM3^^0^B18372205
"BLD",6506,"KRN",9.8,"NM","B","IVMCM3",2)

"BLD",6506,"KRN",9.8,"NM","B","IVMUM3",1)

"BLD",6506,"KRN",19,0)
19
"BLD",6506,"KRN",19,"NM",0)
^9.68A^^
"BLD",6506,"KRN",19.1,0)
19.1
"BLD",6506,"KRN",101,0)
101
"BLD",6506,"KRN",409.61,0)
409.61
"BLD",6506,"KRN",771,0)
771
"BLD",6506,"KRN",870,0)
870
"BLD",6506,"KRN",8989.51,0)
8989.51
"BLD",6506,"KRN",8989.52,0)
8989.52
"BLD",6506,"KRN",8994,0)
8994
"BLD",6506,"KRN","B",.4,.4)

"BLD",6506,"KRN","B",.401,.401)

"BLD",6506,"KRN","B",.402,.402)

"BLD",6506,"KRN","B",.403,.403)

"BLD",6506,"KRN","B",.5,.5)

"BLD",6506,"KRN","B",.84,.84)

"BLD",6506,"KRN","B",3.6,3.6)

"BLD",6506,"KRN","B",3.8,3.8)

"BLD",6506,"KRN","B",9.2,9.2)

"BLD",6506,"KRN","B",9.8,9.8)

"BLD",6506,"KRN","B",19,19)

"BLD",6506,"KRN","B",19.1,19.1)

"BLD",6506,"KRN","B",101,101)

"BLD",6506,"KRN","B",409.61,409.61)

"BLD",6506,"KRN","B",771,771)

"BLD",6506,"KRN","B",870,870)

"BLD",6506,"KRN","B",8989.51,8989.51)

"BLD",6506,"KRN","B",8989.52,8989.52)

"BLD",6506,"KRN","B",8994,8994)

"BLD",6506,"QUES",0)
^9.62^^
"BLD",6506,"REQB",0)
^9.611^1^1
"BLD",6506,"REQB",1,0)
IVM*2.0*17^2
"BLD",6506,"REQB","B","IVM*2.0*17",1)

"INIT")
EP^IVM2101C
"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
101^3070110^1255
"PKG",220,22,1,"PAH",1,1,0)
^^1^1^3070110
"PKG",220,22,1,"PAH",1,1,1,0)
See the patch description for IVM*2*101 in the FORUM patch module.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","IVM2101C")
0^^B40905797^n/a
"RTN","IVM2101C",1,0)
IVM2101C ;ALB/CKN,GTS - FILED BY IVM FLAG CLEANUP ; 2/17/05 4:52pm
"RTN","IVM2101C",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**101**; 21-OCT-94;Build 5
"RTN","IVM2101C",3,0)
 Q
"RTN","IVM2101C",4,0)
TEST ; Test Mode
"RTN","IVM2101C",5,0)
 S MODE=0
"RTN","IVM2101C",6,0)
 ;
"RTN","IVM2101C",7,0)
EP ;
"RTN","IVM2101C",8,0)
 N TXT
"RTN","IVM2101C",9,0)
 ;Create bulletin message in install file.
"RTN","IVM2101C",10,0)
 ;Quit if initial check fails.
"RTN","IVM2101C",11,0)
 Q:$$CHECK()
"RTN","IVM2101C",12,0)
 ;Queue task
"RTN","IVM2101C",13,0)
 D QUETASK
"RTN","IVM2101C",14,0)
 Q
"RTN","IVM2101C",15,0)
NMSPC() ;
"RTN","IVM2101C",16,0)
 Q "IVM*2*101"
"RTN","IVM2101C",17,0)
 ;
"RTN","IVM2101C",18,0)
CHECK() ;Initial Checking
"RTN","IVM2101C",19,0)
 ; Output : 0 - Conversion not running or completed
"RTN","IVM2101C",20,0)
 ;          1 - Task is running or completed
"RTN","IVM2101C",21,0)
 ;
"RTN","IVM2101C",22,0)
 N DONE,STAT,TASKNUM,NAMESPC
"RTN","IVM2101C",23,0)
 S DONE=0
"RTN","IVM2101C",24,0)
 S NAMESPC=$$NMSPC()
"RTN","IVM2101C",25,0)
 I '$D(^XTMP(NAMESPC)) Q DONE
"RTN","IVM2101C",26,0)
 I $G(^XTMP(NAMESPC,"CONFIG","COMPLETED"))=1 D  Q DONE
"RTN","IVM2101C",27,0)
 . D DONEMSG
"RTN","IVM2101C",28,0)
 . S DONE=1
"RTN","IVM2101C",29,0)
 S TASKNUM=$G(^XTMP(NAMESPC,"CONFIG","TASK"))
"RTN","IVM2101C",30,0)
 I TASKNUM'="" D
"RTN","IVM2101C",31,0)
 . S STAT=$$ACTIVE(TASKNUM)
"RTN","IVM2101C",32,0)
 . I STAT>0 D RUNMSG S DONE=1
"RTN","IVM2101C",33,0)
 Q DONE
"RTN","IVM2101C",34,0)
ACTIVE(TASK) ;Checks if task is running or not
"RTN","IVM2101C",35,0)
 ;  input   --   The taskman ID
"RTN","IVM2101C",36,0)
 ;  output  --   1=The task is running
"RTN","IVM2101C",37,0)
 ;               0=The task is not running
"RTN","IVM2101C",38,0)
 ;
"RTN","IVM2101C",39,0)
 N ZTSK,STAT,Y
"RTN","IVM2101C",40,0)
 S STAT=0,ZTSK=+TASK
"RTN","IVM2101C",41,0)
 D STAT^%ZTLOAD
"RTN","IVM2101C",42,0)
 S Y=ZTSK(1)
"RTN","IVM2101C",43,0)
 I Y=0 S STAT=-1
"RTN","IVM2101C",44,0)
 I ",1,2,"[(","_Y_",") S STAT=1
"RTN","IVM2101C",45,0)
 I ",3,5,"[(","_Y_",") S STAT=0
"RTN","IVM2101C",46,0)
 Q STAT
"RTN","IVM2101C",47,0)
 ;
"RTN","IVM2101C",48,0)
QUETASK ;Queue the Task
"RTN","IVM2101C",49,0)
 N TXT,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTDTH,NAMESPC
"RTN","IVM2101C",50,0)
 S NAMESPC=$$NMSPC()
"RTN","IVM2101C",51,0)
 S ZTRTN="EP1^IVM2101C",ZTIO="",ZTDTH=$$NOW^XLFDT()
"RTN","IVM2101C",52,0)
 S ZTDESC=NAMESPC_" - FILED BY IVM FLAG CLEANUP"
"RTN","IVM2101C",53,0)
 ; Create XTMP array
"RTN","IVM2101C",54,0)
 S X1=DT,X2=120 D C^%DTC
"RTN","IVM2101C",55,0)
 S ^XTMP(NAMESPC,0)=X_"^"_$$DT^XLFDT_"^"_NAMESPC_" FIX FILED BY IVM ERROR"
"RTN","IVM2101C",56,0)
 D ^%ZTLOAD S ^XTMP(NAMESPC,"CONFIG","TASK")=ZTSK
"RTN","IVM2101C",57,0)
 S TXT(1)="Task: "_ZTSK_" Queued."
"RTN","IVM2101C",58,0)
 D BMES^XPDUTL(.TXT)
"RTN","IVM2101C",59,0)
 Q
"RTN","IVM2101C",60,0)
EP1 ;Entry Point
"RTN","IVM2101C",61,0)
 N XIEN,XIYR,EIEN,XRELIEN,XDGMT,AMTIEN,SOURCE,FIVM,NAMESPC
"RTN","IVM2101C",62,0)
 N X,X1,X2,TOT,CNT,ZTSTOP
"RTN","IVM2101C",63,0)
 S ZTSTOP=0
"RTN","IVM2101C",64,0)
 S NAMESPC=$$NMSPC()
"RTN","IVM2101C",65,0)
 S XIEN=+$G(^XTMP(NAMESPC,"CONFIG","CURRENT IEN"))
"RTN","IVM2101C",66,0)
 ; Update XTMP array 0 node purge date.
"RTN","IVM2101C",67,0)
 S X1=DT,X2=120 D C^%DTC
"RTN","IVM2101C",68,0)
 S ^XTMP(NAMESPC,0)=X_"^"_$$DT^XLFDT_"^"_NAMESPC_" FIX FILED BY IVM ERROR"
"RTN","IVM2101C",69,0)
 ;Store start date
"RTN","IVM2101C",70,0)
 I '$D(^XTMP(NAMESPC,"CONFIG","START DATE")) S ^XTMP(NAMESPC,"CONFIG","START DATE")=$$FMTE^XLFDT($$NOW^XLFDT(),"5P")
"RTN","IVM2101C",71,0)
 S TOT=+$G(^XTMP(NAMESPC,"CONFIG","TOTAL PROCESSED"))
"RTN","IVM2101C",72,0)
 S CNT=+$G(^XTMP(NAMESPC,"CONFIG","TOTAL FOUND"))
"RTN","IVM2101C",73,0)
 ;Loop through 408.12 file - get Veteran IEN
"RTN","IVM2101C",74,0)
 F  S XIEN=$O(^DGPR(408.12,"B",XIEN)) Q:+XIEN=0!(ZTSTOP)  D
"RTN","IVM2101C",75,0)
 . S TOT=TOT+1  ;Processed records counter
"RTN","IVM2101C",76,0)
 . S ^XTMP(NAMESPC,"CONFIG","TOTAL PROCESSED")=TOT
"RTN","IVM2101C",77,0)
 . S ^XTMP(NAMESPC,"CONFIG","CURRENT IEN")=XIEN
"RTN","IVM2101C",78,0)
 . I (TOT#1000=0),$$S^%ZTLOAD S ZTSTOP=1  ;Check for stop request
"RTN","IVM2101C",79,0)
 . S XRELIEN=0
"RTN","IVM2101C",80,0)
 . ;Get 408.12 iens for each Veteran
"RTN","IVM2101C",81,0)
 . F  S XRELIEN=$O(^DGPR(408.12,"B",XIEN,XRELIEN)) Q:XRELIEN=""  D
"RTN","IVM2101C",82,0)
 . . S EIEN=0
"RTN","IVM2101C",83,0)
 . . F  S EIEN=$O(^DGPR(408.12,XRELIEN,"E",EIEN)) Q:EIEN=""  D
"RTN","IVM2101C",84,0)
 . . . ;Get Filed By IVM flag
"RTN","IVM2101C",85,0)
 . . . S FIVM=$P($G(^DGPR(408.12,XRELIEN,"E",EIEN,0)),"^",3)
"RTN","IVM2101C",86,0)
 . . . I FIVM="" Q  ;Quit if flag is not set
"RTN","IVM2101C",87,0)
 . . . ; Get Annual Means test ien for FILED BY IVM flag
"RTN","IVM2101C",88,0)
 . . . S AMTIEN=$P($G(^DGPR(408.12,XRELIEN,"E",EIEN,0)),"^",4)
"RTN","IVM2101C",89,0)
 . . . Q:AMTIEN=""  ;Quit if Annual MT IEN is not set.
"RTN","IVM2101C",90,0)
 . . . S XIYR=$P($G(^DGMT(408.31,AMTIEN,0)),"^")  ;Income Year
"RTN","IVM2101C",91,0)
 . . . I XIYR<3040000 Q  ;Quit if income year is less than 2004
"RTN","IVM2101C",92,0)
 . . . ;Get source of MT
"RTN","IVM2101C",93,0)
 . . . S SOURCE=$P($G(^DGMT(408.31,AMTIEN,0)),"^",23)
"RTN","IVM2101C",94,0)
 . . . ;If SOURCE OF INCOME TEST is VAMC or OTHER FACILITY
"RTN","IVM2101C",95,0)
 . . . I (FIVM=1),((SOURCE=1)!(SOURCE=4)) D
"RTN","IVM2101C",96,0)
 . . . . S SOURCE=SOURCE_"^"_$P($G(^DG(408.34,SOURCE,0)),"^",1)
"RTN","IVM2101C",97,0)
 . . . . S CNT=CNT+1,^XTMP(NAMESPC,"CONFIG","TOTAL FOUND")=CNT
"RTN","IVM2101C",98,0)
 . . . . S ^XTMP(NAMESPC,CNT,"PATIENT IEN")=XIEN
"RTN","IVM2101C",99,0)
 . . . . S ^XTMP(NAMESPC,CNT,"ANNUAL MT IEN")=AMTIEN
"RTN","IVM2101C",100,0)
 . . . . S ^XTMP(NAMESPC,CNT,"PATIENT RELATION IEN")=XRELIEN
"RTN","IVM2101C",101,0)
 . . . . S ^XTMP(NAMESPC,CNT,"SOURCE OF INCOME TEST")=SOURCE
"RTN","IVM2101C",102,0)
 . . . . S ^XTMP(NAMESPC,CNT,"PREVIOUS FILED BY IVM")=FIVM_"^YES"
"RTN","IVM2101C",103,0)
 . . . . ;Reset FILED BY IVM field to NULL
"RTN","IVM2101C",104,0)
 . . . . S $P(^DGPR(408.12,XRELIEN,"E",EIEN,0),"^",3)=""
"RTN","IVM2101C",105,0)
 S ^XTMP(NAMESPC,"CONFIG","STOP DATE")=$$FMTE^XLFDT($$NOW^XLFDT(),"5P")
"RTN","IVM2101C",106,0)
 I ZTSTOP D  Q
"RTN","IVM2101C",107,0)
 . D ABORTMSG
"RTN","IVM2101C",108,0)
 S ^XTMP(NAMESPC,"CONFIG","COMPLETED")=1
"RTN","IVM2101C",109,0)
 D COMPMSG
"RTN","IVM2101C",110,0)
 Q
"RTN","IVM2101C",111,0)
 ;
"RTN","IVM2101C",112,0)
DONEMSG ;Send message that process is already Completed.
"RTN","IVM2101C",113,0)
 N MSG,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","IVM2101C",114,0)
 S XMSUB=NAMESPC_" - FILED BY IVM FLAG CLEANUP already completed"
"RTN","IVM2101C",115,0)
 S XMDUZ=NAMESPC_" INSTALLATION PROCESS"
"RTN","IVM2101C",116,0)
 S (XMY(.5),XMY(DUZ))="",XMTEXT="MSG("
"RTN","IVM2101C",117,0)
 S MSG(1)="FILED BY IVM FLAG CLEANUP process was completed in previous run."
"RTN","IVM2101C",118,0)
 D ^XMD
"RTN","IVM2101C",119,0)
 D BMES^XPDUTL(.MSG)
"RTN","IVM2101C",120,0)
 Q
"RTN","IVM2101C",121,0)
RUNMSG ;Send message that process is currently running.
"RTN","IVM2101C",122,0)
 N NAMESPC,MSG,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","IVM2101C",123,0)
 S NAMESPC=$$NMSPC()
"RTN","IVM2101C",124,0)
 S XMSUB=NAMESPC_" - FILED BY IVM FLAG CLEANUP running"
"RTN","IVM2101C",125,0)
 S XMDUZ=NAMESPC_" INSTALLATION PROCESS"
"RTN","IVM2101C",126,0)
 S (XMY(.5),XMY(DUZ))="",XMTEXT="MSG("
"RTN","IVM2101C",127,0)
 S MSG(1)="TASK: "_TASKNUM_" is currently running FILED BY IVM FLAG CLEANUP"
"RTN","IVM2101C",128,0)
 S MSG(2)="process. Duplicate process cannot be started."
"RTN","IVM2101C",129,0)
 D ^XMD
"RTN","IVM2101C",130,0)
 D BMES^XPDUTL(.MSG)
"RTN","IVM2101C",131,0)
 Q
"RTN","IVM2101C",132,0)
ABORTMSG ;Send message for stop request.
"RTN","IVM2101C",133,0)
 N MSG,XMDUX,XMSUB,XMTEXT,XMY
"RTN","IVM2101C",134,0)
 S XMSUB=NAMESPC_" - FILED BY IVM FLAG CLEANUP stopped"
"RTN","IVM2101C",135,0)
 S XMDUZ=NAMESPC_" INSTALLATION PROCESS"
"RTN","IVM2101C",136,0)
 S (XMY(.5),XMY(DUZ))="",XMTEXT="MSG("
"RTN","IVM2101C",137,0)
 S MSG(1)="TASK: "_$G(^XTMP(NAMESPC,"CONFIG","TASK"))_" FILED BY IVM FLAG CLEANUP"
"RTN","IVM2101C",138,0)
 S MSG(2)=""
"RTN","IVM2101C",139,0)
 S MSG(3)="FILED BY IVM error cleanup process was requested to stop"
"RTN","IVM2101C",140,0)
 S MSG(4)="by the user. Please restart the process by using the following"
"RTN","IVM2101C",141,0)
 S MSG(5)="command at the programmer prompt:"
"RTN","IVM2101C",142,0)
 S MSG(6)="D EP^IVM2101C"
"RTN","IVM2101C",143,0)
 D ^XMD
"RTN","IVM2101C",144,0)
 Q
"RTN","IVM2101C",145,0)
COMPMSG ;Send message for completed Task.
"RTN","IVM2101C",146,0)
 N MSG,XMDUX,XMSUB,XMTEXT,XMY
"RTN","IVM2101C",147,0)
 S XMSUB=NAMESPC_" - FILED BY IVM FLAG CLEANUP completed"
"RTN","IVM2101C",148,0)
 S XMDUZ=NAMESPC_" INSTALLATION PROCESS"
"RTN","IVM2101C",149,0)
 S (XMY(.5),XMY(DUZ))="",XMTEXT="MSG("
"RTN","IVM2101C",150,0)
 S MSG(1)="TASK: "_$G(^XTMP(NAMESPC,"CONFIG","TASK"))_" FILED BY IVM FLAG CLEANUP"
"RTN","IVM2101C",151,0)
 S MSG(2)=""
"RTN","IVM2101C",152,0)
 S MSG(3)="FILED BY IVM error cleanup process has completed.  Review the"
"RTN","IVM2101C",153,0)
 S MSG(4)="following ^XTMP global for details on the Patient Relation file (408.12)"
"RTN","IVM2101C",154,0)
 S MSG(5)="records converted: ^XTMP("""_NAMESPC_""","
"RTN","IVM2101C",155,0)
 S MSG(6)=""
"RTN","IVM2101C",156,0)
 S MSG(7)="This global will be deleted in no more than 120 days from the date"
"RTN","IVM2101C",157,0)
 S MSG(8)="of this message."
"RTN","IVM2101C",158,0)
 D ^XMD
"RTN","IVM2101C",159,0)
 Q
"RTN","IVMCM3")
0^2^B18372205^B14729184
"RTN","IVMCM3",1,0)
IVMCM3 ;ALB/SEK - ADD NEW DCD DEPENDENT TO PATIENT RELATION FILE ; 25-APR-95
"RTN","IVMCM3",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**17,101**;21-OCT-94;Build 5
"RTN","IVMCM3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMCM3",4,0)
 ;
"RTN","IVMCM3",5,0)
EN ; this routine will add entries for new dependents to PATIENT
"RTN","IVMCM3",6,0)
 ; RELATION file-408.12 (including 408.1275) or will add new entries
"RTN","IVMCM3",7,0)
 ; to effective date multiple (408.1275) for all DCD spouses and
"RTN","IVMCM3",8,0)
 ; dependents.  if only adding to 408.1275 and DCD relationship is
"RTN","IVMCM3",9,0)
 ; different then VAMC relationship, change in 408.12 and add to
"RTN","IVMCM3",10,0)
 ; MEANS TEST CHANGES file (408.41).
"RTN","IVMCM3",11,0)
 ;
"RTN","IVMCM3",12,0)
 ; input  dfn        ien of file #2
"RTN","IVMCM3",13,0)
 ;        dgipi      408.13 ien
"RTN","IVMCM3",14,0)
 ;        dgmti      408.31 ien
"RTN","IVMCM3",15,0)
 ;        dgpri      408.12 ien
"RTN","IVMCM3",16,0)
 ;        ivmeffdt   effective (dependent) date of spouse/dependent
"RTN","IVMCM3",17,0)
 ;        ivmreln    DCD relationship
"RTN","IVMCM3",18,0)
 ;        ivmrelo    VAMC relationship
"RTN","IVMCM3",19,0)
 ;        ivmseg     ZDP segment of spouse/dependent
"RTN","IVMCM3",20,0)
 ;
"RTN","IVMCM3",21,0)
 ;
"RTN","IVMCM3",22,0)
 I IVMFLG2 G NEWPR
"RTN","IVMCM3",23,0)
 ;
"RTN","IVMCM3",24,0)
 ; add new entry to 408.1275
"RTN","IVMCM3",25,0)
 ;
"RTN","IVMCM3",26,0)
 N X,Y
"RTN","IVMCM3",27,0)
 K DINUM
"RTN","IVMCM3",28,0)
 S DA(1)=DGPRI
"RTN","IVMCM3",29,0)
 S (DIK,DIC)="^DGPR(408.12,DA(1),""E"",",DIC(0)="L",DLAYGO=408.1275,X=IVMEFFDT K DD,DO D FILE^DICN S DA=+Y K DLAYGO
"RTN","IVMCM3",30,0)
 ;
"RTN","IVMCM3",31,0)
 ; if can't create stub notify site & IVM Center
"RTN","IVMCM3",32,0)
 I DA'>0 D  Q
"RTN","IVMCM3",33,0)
 .S (IVMTEXT(6))="Can't create stub for file 408.1275"
"RTN","IVMCM3",34,0)
 .D PROB^IVMCMC(IVMTEXT(6))
"RTN","IVMCM3",35,0)
 .D ERRBULL^IVMPREC7,MAIL^IVMUFNC("DGMT MT/CT UPLOAD ALERTS")
"RTN","IVMCM3",36,0)
 .S IVMFERR=""
"RTN","IVMCM3",37,0)
 ;
"RTN","IVMCM3",38,0)
 ;Set value of FILED BY IVM field : GTS - IVM*2*101
"RTN","IVMCM3",39,0)
 ;DGFIVM is YES when source of Means Test is DCD or IVM
"RTN","IVMCM3",40,0)
 N DGFIVM ;IVM*2*101
"RTN","IVMCM3",41,0)
 S DGFIVM=$$SRCOFMT(DGMTI) ;IVM*2*101
"RTN","IVMCM3",42,0)
 ;
"RTN","IVMCM3",43,0)
 L +^DGPR(408.12,+DGPRI) S $P(^DGPR(408.12,DA(1),"E",DA,0),"^",2,4)=1_"^"_DGFIVM_$S(IVMTYPE=3:"",1:"^"_DGMTI) D IX1^DIK L -^DGPR(408.12,+DGPRI)
"RTN","IVMCM3",44,0)
 K IVMEFFDT,DA,DIC,DIK
"RTN","IVMCM3",45,0)
 ;
"RTN","IVMCM3",46,0)
 ; replace relationship in 408.12 with DCD relationship if different
"RTN","IVMCM3",47,0)
 ; and add both values to 408.41
"RTN","IVMCM3",48,0)
 ;
"RTN","IVMCM3",49,0)
 Q:IVMRELN=IVMRELO
"RTN","IVMCM3",50,0)
 S DA=DGPRI,DIE="^DGPR(408.12,",DR=".02////^S X=IVMRELN" D ^DIE K DA,DIE,DR
"RTN","IVMCM3",51,0)
 S DGMTYPT=$S(IVMTYPE=3:"",1:IVMTYPE),DGMTACT="REL",DGMTSOLD=IVMRELO,DGMTSNEW=IVMRELN,DGDEPI=DGIPI
"RTN","IVMCM3",52,0)
 I IVMMTIEN S DGMTA=$G(^DGMT(408.31,IVMMTIEN,0))
"RTN","IVMCM3",53,0)
 S $P(DGMTA,"^",2)=DFN
"RTN","IVMCM3",54,0)
 D SET^DGMTAUD
"RTN","IVMCM3",55,0)
 K DGDEPI,DGMTA,DGMTACT,DGMTSNEW,DGMTSOLD
"RTN","IVMCM3",56,0)
 Q
"RTN","IVMCM3",57,0)
 ;
"RTN","IVMCM3",58,0)
NEWPR ;Add entry to file #408.12
"RTN","IVMCM3",59,0)
 ;In -  dgrp0nd  0 node of 408.12
"RTN","IVMCM3",60,0)
 ;      ivmeffdt effective date of dependent
"RTN","IVMCM3",61,0)
 ;      ivmreln  DCD relationship
"RTN","IVMCM3",62,0)
 ;Out - dgpri ien of new 408.12 entry
"RTN","IVMCM3",63,0)
 ;
"RTN","IVMCM3",64,0)
 S DGRP0ND=DFN_"^"_IVMRELN_"^"_+DGIPI_";DGPR(408.13,"
"RTN","IVMCM3",65,0)
 ;
"RTN","IVMCM3",66,0)
 N DGFIVM ;IVM*2*101
"RTN","IVMCM3",67,0)
 N X,Y
"RTN","IVMCM3",68,0)
 K DINUM
"RTN","IVMCM3",69,0)
 S (DIK,DIC)="^DGPR(408.12,",DIC(0)="L",DLAYGO=408.12,X=+DGRP0ND K DD,DO D FILE^DICN S (DGPRI,DA)=+Y K DLAYGO
"RTN","IVMCM3",70,0)
 ;
"RTN","IVMCM3",71,0)
 ; if can't create stub notify site & IVM Center
"RTN","IVMCM3",72,0)
 I DGPRI'>0 D  Q
"RTN","IVMCM3",73,0)
 .S (IVMTEXT(6))="Can't create stub for file 408.12"
"RTN","IVMCM3",74,0)
 .D PROB^IVMCMC(IVMTEXT(6))
"RTN","IVMCM3",75,0)
 .D ERRBULL^IVMPREC7,MAIL^IVMUFNC("DGMT MT/CT UPLOAD ALERTS")
"RTN","IVMCM3",76,0)
 .S IVMFERR=""
"RTN","IVMCM3",77,0)
 ;
"RTN","IVMCM3",78,0)
 ;Set value of FILED BY IVM field : GTS - IVM*2*101
"RTN","IVMCM3",79,0)
 ;DGFIVM is YES when source of Means Test is DCD or IVM
"RTN","IVMCM3",80,0)
 S DGFIVM=$$SRCOFMT(DGMTI)
"RTN","IVMCM3",81,0)
 ;
"RTN","IVMCM3",82,0)
 ;Create Patient Relation record : GTS - IVM*2*101 (DGFIVM replaces default of 1)
"RTN","IVMCM3",83,0)
 L +^DGPR(408.12,+DGPRI) S ^DGPR(408.12,+DGPRI,0)=DGRP0ND,^DGPR(408.12,+DGPRI,"E",0)="^408.1275D^1^1",^(1,0)=IVMEFFDT_"^1^"_DGFIVM_$S(IVMTYPE=3:"",1:"^"_DGMTI) D IX1^DIK L -^DGPR(408.12,+DGPRI)
"RTN","IVMCM3",84,0)
 K IVMEFFDT,DA,DIC,DIK
"RTN","IVMCM3",85,0)
 ;
"RTN","IVMCM3",86,0)
 ; to prevent the logic in IVMCM2 from matching a dependent sent from
"RTN","IVMCM3",87,0)
 ; the IVM Center (with no 408.12 ien) with this dependent, an entry
"RTN","IVMCM3",88,0)
 ; is made in array IVMAR.  subscripts of this array is ien of 408.12
"RTN","IVMCM3",89,0)
 ; transmitted by the IVM Center or created or found by upload.
"RTN","IVMCM3",90,0)
 S IVMAR(DGPRI)=""
"RTN","IVMCM3",91,0)
 Q
"RTN","IVMCM3",92,0)
 ;
"RTN","IVMCM3",93,0)
NEWVET ; if no entry in file #408.12 for vet add
"RTN","IVMCM3",94,0)
 N DGRPDOB,DA,DIC,DIK,X,Y
"RTN","IVMCM3",95,0)
 S DGPRI=$O(^DGPR(408.12,"C",DFN_";DPT(",0))
"RTN","IVMCM3",96,0)
 I '$D(^DGPR(408.12,+DGPRI,0)) S DGRP0ND=DFN_"^"_1_"^"_DFN_";DPT(",DGRPDOB=$P($G(^DPT(+DFN,0)),"^",3) D
"RTN","IVMCM3",97,0)
 .K DINUM
"RTN","IVMCM3",98,0)
 .S (DIK,DIC)="^DGPR(408.12,",DIC(0)="L",DLAYGO=408.12,X=+DGRP0ND K DD,DO D FILE^DICN S (DGPRI,DA)=+Y K DLAYGO
"RTN","IVMCM3",99,0)
 .;
"RTN","IVMCM3",100,0)
 .; if can't create stub notify site & IVM Center
"RTN","IVMCM3",101,0)
 .I DGPRI'>0 D  Q
"RTN","IVMCM3",102,0)
 ..S (IVMTEXT(6))="Can't create stub for file 408.12"
"RTN","IVMCM3",103,0)
 ..D PROB^IVMCMC(IVMTEXT(6))
"RTN","IVMCM3",104,0)
 ..D ERRBULL^IVMPREC7,MAIL^IVMUFNC("DGMT MT/CT UPLOAD ALERTS")
"RTN","IVMCM3",105,0)
 ..S IVMFERR=""
"RTN","IVMCM3",106,0)
 .L +^DGPR(408.12,+DGPRI) S ^DGPR(408.12,+DGPRI,0)=DGRP0ND,^DGPR(408.12,+DGPRI,"E",0)="^408.1275D^1^1",^(1,0)=DGRPDOB_"^1^1"_$S(IVMTYPE=3:"",1:"^"_DGMTI) D IX1^DIK L -^DGPR(408.12,+DGPRI)
"RTN","IVMCM3",107,0)
 ;
"RTN","IVMCM3",108,0)
 Q
"RTN","IVMCM3",109,0)
 ;
"RTN","IVMCM3",110,0)
SRCOFMT(DGMTI) ;Define value of FILED BY IVM field : GTS - IVM*2*101
"RTN","IVMCM3",111,0)
 ;
"RTN","IVMCM3",112,0)
 ; Input:   DGMTI - IEN for related Annual Means Test record (408.31)
"RTN","IVMCM3",113,0)
 ; Output:  DGFIVM - Null when Source of Means Test is Other Facility or VAMC
"RTN","IVMCM3",114,0)
 ;                 - 1 when source of Means Test is DCD or IVM
"RTN","IVMCM3",115,0)
 N DGFIVM
"RTN","IVMCM3",116,0)
 S:(+$G(DGMTI)'>0) DGFIVM=""
"RTN","IVMCM3",117,0)
 I +$G(DGMTI)>0 DO
"RTN","IVMCM3",118,0)
 . N DGSOURCE
"RTN","IVMCM3",119,0)
 . S DGSOURCE=$P($G(^DGMT(408.31,DGMTI,0)),"^",23)
"RTN","IVMCM3",120,0)
 . I (DGSOURCE=1)!(DGSOURCE=4) S DGFIVM=""
"RTN","IVMCM3",121,0)
 . I (DGSOURCE=2)!(DGSOURCE=3) S DGFIVM=1
"RTN","IVMCM3",122,0)
 Q DGFIVM
"RTN","IVMUM3")
0^1^B8050850^B6919069
"RTN","IVMUM3",1,0)
IVMUM3 ;ALB/SEK,GTS - ADD NEW DEPENDENT TO PATIENT RELATIONS FILE ; 12 MAY 94
"RTN","IVMUM3",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**1,17,101**;21-OCT-94;Build 5
"RTN","IVMUM3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMUM3",4,0)
 ;
"RTN","IVMUM3",5,0)
EN ; this routine will add entries for new dependents to PATIENT
"RTN","IVMUM3",6,0)
 ; RELATION file-408.12 (including 408.1275) or will add new entries
"RTN","IVMUM3",7,0)
 ; to effective date multiple (408.1275) for all IVM spouses and
"RTN","IVMUM3",8,0)
 ; dependents.  if only adding to 408.1275 and IVM relationship is
"RTN","IVMUM3",9,0)
 ; different then VAMC relationship, change in 408.12 and add to
"RTN","IVMUM3",10,0)
 ; MEANS TEST CHANGES file (408.41).
"RTN","IVMUM3",11,0)
 ;
"RTN","IVMUM3",12,0)
 ; input  dfn        ien of file #2
"RTN","IVMUM3",13,0)
 ;        dgipi      408.13 ien
"RTN","IVMUM3",14,0)
 ;        dgmti      408.31 ien
"RTN","IVMUM3",15,0)
 ;        dgpri      408.12 ien
"RTN","IVMUM3",16,0)
 ;        ivmeffdt   effective (dependent) date of spouse/dependent
"RTN","IVMUM3",17,0)
 ;        ivmreln    IVM relationship
"RTN","IVMUM3",18,0)
 ;        ivmrelo    VAMC relationship
"RTN","IVMUM3",19,0)
 ;        ivmseg     ZDP segment of spouse/dependent
"RTN","IVMUM3",20,0)
 ;
"RTN","IVMUM3",21,0)
 ;
"RTN","IVMUM3",22,0)
 I IVMFLG2 G NEWPR
"RTN","IVMUM3",23,0)
 ;
"RTN","IVMUM3",24,0)
 ; add new entry to 408.1275
"RTN","IVMUM3",25,0)
 ;
"RTN","IVMUM3",26,0)
 K DINUM
"RTN","IVMUM3",27,0)
 S DA(1)=DGPRI
"RTN","IVMUM3",28,0)
 S (DIK,DIC)="^DGPR(408.12,DA(1),""E"",",DIC(0)="L",DLAYGO=408.1275,X=IVMEFFDT K DD,DO D FILE^DICN S DA=+Y K DLAYGO
"RTN","IVMUM3",29,0)
 ;
"RTN","IVMUM3",30,0)
 ; if can't create stub notify site & IVM Center
"RTN","IVMUM3",31,0)
 I DA'>0 D  Q
"RTN","IVMUM3",32,0)
 .S (IVMTEXT(6),HLERR)="Can't create stub for file 408.1275"
"RTN","IVMUM3",33,0)
 .D ERRBULL^IVMPREC7,MAIL^IVMUFNC()
"RTN","IVMUM3",34,0)
 .S IVMFERR=""
"RTN","IVMUM3",35,0)
 ;
"RTN","IVMUM3",36,0)
 ;Set value of FILED BY IVM field : GTS - IVM*2*101
"RTN","IVMUM3",37,0)
 ;DGFIVM is YES when source of Means Test is DCD or IVM
"RTN","IVMUM3",38,0)
 N DGFIVM ;IVM*2*101
"RTN","IVMUM3",39,0)
 S DGFIVM=$$SRCOFMT^IVMCM3(DGMTI) ;IVM*2*101
"RTN","IVMUM3",40,0)
 ;
"RTN","IVMUM3",41,0)
 L +^DGPR(408.12,+DGPRI) S $P(^DGPR(408.12,DA(1),"E",DA,0),"^",2,4)=1_"^"_DGFIVM_"^"_DGMTI D IX1^DIK L -^DGPR(408.12,+DGPRI)
"RTN","IVMUM3",42,0)
 K IVMEFFDT,DA,DIC,DIK
"RTN","IVMUM3",43,0)
 ;
"RTN","IVMUM3",44,0)
 ; replace relationship in 408.12 with IVM relationship if different
"RTN","IVMUM3",45,0)
 ; and add both values to 408.41
"RTN","IVMUM3",46,0)
 ;
"RTN","IVMUM3",47,0)
 Q:IVMRELN=IVMRELO
"RTN","IVMUM3",48,0)
 S DA=DGPRI,DIE="^DGPR(408.12,",DR=".02////^S X=IVMRELN" D ^DIE K DA,DIE,DR
"RTN","IVMUM3",49,0)
 S DGMTYPT=1,DGMTACT="REL",DGMTSOLD=IVMRELO,DGMTSNEW=IVMRELN,DGDEPI=DGIPI,DGMTA=DGMTP
"RTN","IVMUM3",50,0)
 D SET^DGMTAUD
"RTN","IVMUM3",51,0)
 K DGDEPI,DGMTA,DGMTACT,DGMTSNEW,DGMTSOLD
"RTN","IVMUM3",52,0)
 Q
"RTN","IVMUM3",53,0)
 ;
"RTN","IVMUM3",54,0)
NEWPR ;Add entry to file #408.12
"RTN","IVMUM3",55,0)
 ;In -  dgrp0nd  0 node of 408.12
"RTN","IVMUM3",56,0)
 ;      ivmeffdt effective date of dependent
"RTN","IVMUM3",57,0)
 ;      ivmreln  IVM relationship
"RTN","IVMUM3",58,0)
 ;Out - dgpri ien of new 408.12 entry
"RTN","IVMUM3",59,0)
 ;
"RTN","IVMUM3",60,0)
 N DGFIVM ;IVM*2*101
"RTN","IVMUM3",61,0)
 S DGRP0ND=DFN_"^"_IVMRELN_"^"_+DGIPI_";DGPR(408.13,"
"RTN","IVMUM3",62,0)
 ;
"RTN","IVMUM3",63,0)
 K DINUM
"RTN","IVMUM3",64,0)
 S (DIK,DIC)="^DGPR(408.12,",DIC(0)="L",DLAYGO=408.12,X=+DGRP0ND K DD,DO D FILE^DICN S (DGPRI,DA)=+Y K DLAYGO
"RTN","IVMUM3",65,0)
 ;
"RTN","IVMUM3",66,0)
 ; if can't create stub notify site & IVM Center
"RTN","IVMUM3",67,0)
 I DGPRI'>0 D  Q
"RTN","IVMUM3",68,0)
 .S (IVMTEXT(6),HLERR)="Can't create stub for file 408.12"
"RTN","IVMUM3",69,0)
 .D ERRBULL^IVMPREC7,MAIL^IVMUFNC()
"RTN","IVMUM3",70,0)
 .S IVMFERR=""
"RTN","IVMUM3",71,0)
 ;
"RTN","IVMUM3",72,0)
 ;Set value of FILED BY IVM field : GTS - IVM*2*101
"RTN","IVMUM3",73,0)
 ;DGFIVM is YES when source of Means Test is DCD or IVM
"RTN","IVMUM3",74,0)
 S DGFIVM=$$SRCOFMT^IVMCM3(DGMTI)
"RTN","IVMUM3",75,0)
 ;
"RTN","IVMUM3",76,0)
 ;Create Patient Relation record : GTS - IVM*2*101 (DGFIVM replaces default of 1)
"RTN","IVMUM3",77,0)
 L +^DGPR(408.12,+DGPRI) S ^DGPR(408.12,+DGPRI,0)=DGRP0ND,^DGPR(408.12,+DGPRI,"E",0)="^408.1275D^1^1",^(1,0)=IVMEFFDT_"^"_1_"^"_DGFIVM_"^"_DGMTI D IX1^DIK L -^DGPR(408.12,+DGPRI)
"RTN","IVMUM3",78,0)
 K IVMEFFDT,DA,DIC,DIK
"RTN","IVMUM3",79,0)
 ;
"RTN","IVMUM3",80,0)
 ; to prevent the logic in IVMUM2 from matching a dependent sent from
"RTN","IVMUM3",81,0)
 ; the IVM Center (with no 408.12 ien) with this dependent, an entry
"RTN","IVMUM3",82,0)
 ; is made in array IVMAR.  subscripts of this array is ien of 408.12
"RTN","IVMUM3",83,0)
 ; transmitted by the IVM Center or created or found by upload.
"RTN","IVMUM3",84,0)
 S IVMAR(DGPRI)=""
"RTN","IVMUM3",85,0)
 Q
"VER")
8.0^22.0
"BLD",6506,6)
^101
**END**
**END**
