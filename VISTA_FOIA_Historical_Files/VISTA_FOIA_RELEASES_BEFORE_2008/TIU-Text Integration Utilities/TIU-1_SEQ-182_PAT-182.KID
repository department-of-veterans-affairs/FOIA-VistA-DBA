Released TIU*1*182 SEQ #182
Extracted from mail message
**KIDS**:TIU*1.0*182^

**INSTALL NAME**
TIU*1.0*182
"BLD",5082,0)
TIU*1.0*182^TEXT INTEGRATION UTILITIES^0^3050104^y
"BLD",5082,1,0)
^^2^2^3040518^
"BLD",5082,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",5082,1,2,0)
under TIU*1*182.
"BLD",5082,4,0)
^9.64PA^8925^1
"BLD",5082,4,8925,0)
8925
"BLD",5082,4,8925,2,0)
^9.641^8925^1
"BLD",5082,4,8925,2,8925,0)
TIU DOCUMENT  (File-top level)
"BLD",5082,4,8925,2,8925,1,0)
^9.6411^70201^1
"BLD",5082,4,8925,2,8925,1,70201,0)
PROCEDURE SUMMARY CODE
"BLD",5082,4,8925,222)
y^y^p^^^^n^^n
"BLD",5082,4,8925,224)

"BLD",5082,4,"APDD",8925,8925)

"BLD",5082,4,"APDD",8925,8925,70201)

"BLD",5082,4,"B",8925,8925)

"BLD",5082,"INID")
n^n
"BLD",5082,"INIT")
TIUPS182
"BLD",5082,"KRN",0)
^9.67PA^8989.52^19
"BLD",5082,"KRN",.4,0)
.4
"BLD",5082,"KRN",.401,0)
.401
"BLD",5082,"KRN",.402,0)
.402
"BLD",5082,"KRN",.403,0)
.403
"BLD",5082,"KRN",.5,0)
.5
"BLD",5082,"KRN",.84,0)
.84
"BLD",5082,"KRN",3.6,0)
3.6
"BLD",5082,"KRN",3.8,0)
3.8
"BLD",5082,"KRN",9.2,0)
9.2
"BLD",5082,"KRN",9.8,0)
9.8
"BLD",5082,"KRN",9.8,"NM",0)
^9.68A^19^18
"BLD",5082,"KRN",9.8,"NM",1,0)
TIU182D^^0^B6651920
"BLD",5082,"KRN",9.8,"NM",2,0)
TIUCP^^0^B6780383
"BLD",5082,"KRN",9.8,"NM",3,0)
TIUEN182^^0^B27891193
"BLD",5082,"KRN",9.8,"NM",4,0)
TIUEPRNT^^0^B4201050
"BLD",5082,"KRN",9.8,"NM",5,0)
TIULC^^0^B28717551
"BLD",5082,"KRN",9.8,"NM",6,0)
TIUPD^^0^B24253849
"BLD",5082,"KRN",9.8,"NM",7,0)
TIUPRCN^^0^B5982929
"BLD",5082,"KRN",9.8,"NM",8,0)
TIUPRD^^0^B17707406
"BLD",5082,"KRN",9.8,"NM",9,0)
TIUPRDS^^0^B4754364
"BLD",5082,"KRN",9.8,"NM",10,0)
TIUPRPN1^^0^B47306640
"BLD",5082,"KRN",9.8,"NM",11,0)
TIUPRPN8^^0^B28910137
"BLD",5082,"KRN",9.8,"NM",12,0)
TIUPS182^^0^B1757313
"BLD",5082,"KRN",9.8,"NM",13,0)
TIURA^^0^B63108562
"BLD",5082,"KRN",9.8,"NM",14,0)
TIURA2^^0^B33326183
"BLD",5082,"KRN",9.8,"NM",16,0)
TIURC^^0^B18442801
"BLD",5082,"KRN",9.8,"NM",17,0)
TIU182D1^^0^B6732986
"BLD",5082,"KRN",9.8,"NM",18,0)
TIU182DF^^0^B41147338
"BLD",5082,"KRN",9.8,"NM",19,0)
TIULP^^0^B42061138
"BLD",5082,"KRN",9.8,"NM","B","TIU182D",1)

"BLD",5082,"KRN",9.8,"NM","B","TIU182D1",17)

"BLD",5082,"KRN",9.8,"NM","B","TIU182DF",18)

"BLD",5082,"KRN",9.8,"NM","B","TIUCP",2)

"BLD",5082,"KRN",9.8,"NM","B","TIUEN182",3)

"BLD",5082,"KRN",9.8,"NM","B","TIUEPRNT",4)

"BLD",5082,"KRN",9.8,"NM","B","TIULC",5)

"BLD",5082,"KRN",9.8,"NM","B","TIULP",19)

"BLD",5082,"KRN",9.8,"NM","B","TIUPD",6)

"BLD",5082,"KRN",9.8,"NM","B","TIUPRCN",7)

"BLD",5082,"KRN",9.8,"NM","B","TIUPRD",8)

"BLD",5082,"KRN",9.8,"NM","B","TIUPRDS",9)

"BLD",5082,"KRN",9.8,"NM","B","TIUPRPN1",10)

"BLD",5082,"KRN",9.8,"NM","B","TIUPRPN8",11)

"BLD",5082,"KRN",9.8,"NM","B","TIUPS182",12)

"BLD",5082,"KRN",9.8,"NM","B","TIURA",13)

"BLD",5082,"KRN",9.8,"NM","B","TIURA2",14)

"BLD",5082,"KRN",9.8,"NM","B","TIURC",16)

"BLD",5082,"KRN",19,0)
19
"BLD",5082,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",5082,"KRN",19,"NM",1,0)
TIU182 DDEFS, MED CONVERSION^^0
"BLD",5082,"KRN",19,"NM","B","TIU182 DDEFS, MED CONVERSION",1)

"BLD",5082,"KRN",19.1,0)
19.1
"BLD",5082,"KRN",101,0)
101
"BLD",5082,"KRN",409.61,0)
409.61
"BLD",5082,"KRN",771,0)
771
"BLD",5082,"KRN",870,0)
870
"BLD",5082,"KRN",8989.51,0)
8989.51
"BLD",5082,"KRN",8989.52,0)
8989.52
"BLD",5082,"KRN",8994,0)
8994
"BLD",5082,"KRN","B",.4,.4)

"BLD",5082,"KRN","B",.401,.401)

"BLD",5082,"KRN","B",.402,.402)

"BLD",5082,"KRN","B",.403,.403)

"BLD",5082,"KRN","B",.5,.5)

"BLD",5082,"KRN","B",.84,.84)

"BLD",5082,"KRN","B",3.6,3.6)

"BLD",5082,"KRN","B",3.8,3.8)

"BLD",5082,"KRN","B",9.2,9.2)

"BLD",5082,"KRN","B",9.8,9.8)

"BLD",5082,"KRN","B",19,19)

"BLD",5082,"KRN","B",19.1,19.1)

"BLD",5082,"KRN","B",101,101)

"BLD",5082,"KRN","B",409.61,409.61)

"BLD",5082,"KRN","B",771,771)

"BLD",5082,"KRN","B",870,870)

"BLD",5082,"KRN","B",8989.51,8989.51)

"BLD",5082,"KRN","B",8989.52,8989.52)

"BLD",5082,"KRN","B",8994,8994)

"BLD",5082,"PRE")
TIUEN182
"BLD",5082,"PRET")

"BLD",5082,"QUES",0)
^9.62^^
"BLD",5082,"REQB",0)
^9.611^6^6
"BLD",5082,"REQB",1,0)
TIU*1.0*121^2
"BLD",5082,"REQB",2,0)
TIU*1.0*112^2
"BLD",5082,"REQB",3,0)
TIU*1.0*176^2
"BLD",5082,"REQB",4,0)
TIU*1.0*175^2
"BLD",5082,"REQB",5,0)
TIU*1.0*109^2
"BLD",5082,"REQB",6,0)
TIU*1.0*157^2
"BLD",5082,"REQB","B","TIU*1.0*109",5)

"BLD",5082,"REQB","B","TIU*1.0*112",2)

"BLD",5082,"REQB","B","TIU*1.0*121",1)

"BLD",5082,"REQB","B","TIU*1.0*157",6)

"BLD",5082,"REQB","B","TIU*1.0*175",4)

"BLD",5082,"REQB","B","TIU*1.0*176",3)

"FIA",8925)
TIU DOCUMENT
"FIA",8925,0)
^TIU(8925,
"FIA",8925,0,0)
8925IPs
"FIA",8925,0,1)
y^y^p^^^^n^^n
"FIA",8925,0,10)

"FIA",8925,0,11)

"FIA",8925,0,"RLRO")

"FIA",8925,0,"VR")
1.0^TIU
"FIA",8925,8925)
1
"FIA",8925,8925,70201)

"INIT")
TIUPS182
"KRN",19,9453,-1)
0^1
"KRN",19,9453,0)
TIU182 DDEFS, MED CONVERSION^Create DDEFS for Med Conversion^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1
"KRN",19,9453,1,0)
^19.06^13^13^3040510^^
"KRN",19,9453,1,1,0)
This option creates new Historical Procedure Document Definitions (DDEFS)
"KRN",19,9453,1,2,0)
for the Medicine Package Conversion. The option is exported with patch
"KRN",19,9453,1,3,0)
TIU*1*182.  It is this option, not the patch itself, which actually
"KRN",19,9453,1,4,0)
creates the new Document Definitions.
"KRN",19,9453,1,5,0)
 
"KRN",19,9453,1,6,0)
This option must be run after the patch is installed.  When the option has
"KRN",19,9453,1,7,0)
run successfully to the end and messages have indicated that all DDEFS
"KRN",19,9453,1,8,0)
have been created successfully with no problems encountered, the option
"KRN",19,9453,1,9,0)
may be deleted.
"KRN",19,9453,1,10,0)
 
"KRN",19,9453,1,11,0)
This option may be rerun if desired.  However, it will not attempt to
"KRN",19,9453,1,12,0)
recreate entries that were already created successfully the first time the
"KRN",19,9453,1,13,0)
option was run.
"KRN",19,9453,20)
D BEGIN^TIU182DF
"KRN",19,9453,"U")
CREATE DDEFS FOR MED CONVERSIO
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
182^3050104
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3050104
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,2,0)
under TIU*1*182.
"PRE")
TIUEN182
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
18
"RTN","TIU182D")
0^1^B6651920
"RTN","TIU182D",1,0)
TIU182D ; SLC/MAM - Data, etc for Post-Install for TIU*1*182 ; 10/5/2004
"RTN","TIU182D",2,0)
 ;;1.0;Text Integration Utilities;**182**;Jun 20, 1997
"RTN","TIU182D",3,0)
 ;
"RTN","TIU182D",4,0)
SETDATA ; Set more data for DDEFS
"RTN","TIU182D",5,0)
 ; Basic data set in TIUEN182.  See rtn TIUEN182 for ordered list of
"RTN","TIU182D",6,0)
 ;DDEF Names and Types.
"RTN","TIU182D",7,0)
 ; -- Set Print Name, Owner, Status, National into FILEDATA node
"RTN","TIU182D",8,0)
 ;    of data array ^TMP("TIU182":
"RTN","TIU182D",9,0)
 N NUM S NUM=0
"RTN","TIU182D",10,0)
 F NUM=1:1:13 D
"RTN","TIU182D",11,0)
 . S ^TMP("TIU182",$J,"FILEDATA",NUM,.03)=$G(^TMP("TIU182",$J,"BASICS",NUM,"NAME")) ;Name node MUST exist.  Using $G to ease testing of fewer DDEFS.
"RTN","TIU182D",12,0)
 . S ^TMP("TIU182",$J,"FILEDATA",NUM,.06)="CLINICAL COORDINATOR"
"RTN","TIU182D",13,0)
 . S ^TMP("TIU182",$J,"FILEDATA",NUM,.07)="INACTIVE"
"RTN","TIU182D",14,0)
 . S ^TMP("TIU182",$J,"FILEDATA",NUM,.13)="YES"
"RTN","TIU182D",15,0)
 ; -- Set Document Class to ACTIVE:
"RTN","TIU182D",16,0)
 S ^TMP("TIU182",$J,"FILEDATA",1,.07)="ACTIVE"
"RTN","TIU182D",17,0)
 ; -- Set Exterior Type:
"RTN","TIU182D",18,0)
 S ^TMP("TIU182",$J,"FILEDATA",1,.04)="DOCUMENT CLASS"
"RTN","TIU182D",19,0)
 N NUM S NUM=0
"RTN","TIU182D",20,0)
 F NUM=2:1:13 S ^TMP("TIU182",$J,"FILEDATA",NUM,.04)="TITLE"
"RTN","TIU182D",21,0)
 ; -- Set Parent and Menu Text into DATA nodes of ^TMP("TIU182":
"RTN","TIU182D",22,0)
 ; -- Set PIEN node = IEN of parent if known, or if not,
"RTN","TIU182D",23,0)
 ;    set PNUM node = DDEF# of parent                   
"RTN","TIU182D",24,0)
 ;    Set Parent of Document Class to CLINICAL PROCEDURES Class:
"RTN","TIU182D",25,0)
 S ^TMP("TIU182",$J,"DATA",1,"PIEN")=$$CLASS^TIUCP
"RTN","TIU182D",26,0)
 N NUM
"RTN","TIU182D",27,0)
 F NUM=2:1:13 S ^TMP("TIU182",$J,"DATA",NUM,"PNUM")=1
"RTN","TIU182D",28,0)
 F NUM=1:1:13 S ^TMP("TIU182",$J,"DATA",NUM,"MENUTXT")=$P($T(MENUTXT+NUM),";;",2,99)
"RTN","TIU182D",29,0)
 ;
"RTN","TIU182D",30,0)
PRINT ; Print out results from message array ^TMP("TIU182MSG",$J
"RTN","TIU182D",31,0)
 N TIUCNT,TIUCONT
"RTN","TIU182D",32,0)
 I $D(ZTQUEUED) S ZTREQ="@" ; Tell TaskMan to delete Task log entry
"RTN","TIU182D",33,0)
 I $E(IOST)="C-" W @IOF,!
"RTN","TIU182D",34,0)
 S TIUCNT="",TIUCONT=1
"RTN","TIU182D",35,0)
 F  S TIUCNT=$O(^TMP("TIU182MSG",$J,TIUCNT)) Q:TIUCNT=""  D  Q:'TIUCONT
"RTN","TIU182D",36,0)
 . S TIUCONT=$$SETCONT Q:'TIUCONT
"RTN","TIU182D",37,0)
 . W ^TMP("TIU182MSG",$J,TIUCNT),!
"RTN","TIU182D",38,0)
PRINTX Q
"RTN","TIU182D",39,0)
 ;
"RTN","TIU182D",40,0)
STOP() ;on screen paging check
"RTN","TIU182D",41,0)
 ; quits TIUCONT=1 if cont. ELSE quits TIUCONT=0
"RTN","TIU182D",42,0)
 N DIR,Y,TIUCONT
"RTN","TIU182D",43,0)
 S DIR(0)="E" D ^DIR
"RTN","TIU182D",44,0)
 S TIUCONT=Y
"RTN","TIU182D",45,0)
 I TIUCONT W @IOF,!
"RTN","TIU182D",46,0)
 Q TIUCONT
"RTN","TIU182D",47,0)
 ;
"RTN","TIU182D",48,0)
SETCONT() ; D form feed, Set TIUCONT
"RTN","TIU182D",49,0)
 N TIUCONT
"RTN","TIU182D",50,0)
 S TIUCONT=1
"RTN","TIU182D",51,0)
 I $E(IOST)="C-" G SETX:$Y+5<IOSL
"RTN","TIU182D",52,0)
 I $E(IOST)="C-" S TIUCONT=$$STOP G SETX
"RTN","TIU182D",53,0)
 G:$Y+8<IOSL SETX
"RTN","TIU182D",54,0)
 W @IOF
"RTN","TIU182D",55,0)
SETX Q TIUCONT
"RTN","TIU182D",56,0)
 ;
"RTN","TIU182D",57,0)
MENUTXT ; -- List ordered 1-13 for menutext.  Cut off at 20 chars
"RTN","TIU182D",58,0)
 ;;Hist Procedures
"RTN","TIU182D",59,0)
 ;;Hist Cardiac Cathete
"RTN","TIU182D",60,0)
 ;;Hist Electrocardiogr
"RTN","TIU182D",61,0)
 ;;Hist Echocardiogram
"RTN","TIU182D",62,0)
 ;;Hist Electrophysiolo
"RTN","TIU182D",63,0)
 ;;Hist Holter Procedur
"RTN","TIU182D",64,0)
 ;;Hist Exercise Tolera
"RTN","TIU182D",65,0)
 ;;Hist Pre/Post Surger
"RTN","TIU182D",66,0)
 ;;Hist Endoscopic Proc
"RTN","TIU182D",67,0)
 ;;Hist Pulmonary Funct
"RTN","TIU182D",68,0)
 ;;Hist Hematology Proc
"RTN","TIU182D",69,0)
 ;;Hist Pacemaker Impla
"RTN","TIU182D",70,0)
 ;;Hist Rheumatology Pr
"RTN","TIU182D",71,0)
 Q
"RTN","TIU182D1")
0^17^B6732986
"RTN","TIU182D1",1,0)
TIU182D1 ; SLC/MAM - After installing TIU*1*182 ; 05/20/2004
"RTN","TIU182D1",2,0)
 ;;1.0;Text Integration Utilities;**182**;Jun 20, 1997
"RTN","TIU182D1",3,0)
 ; External References
"RTN","TIU182D1",4,0)
 ;   DBIA 3409  ^USR(8930,"B"
"RTN","TIU182D1",5,0)
DELETE(TIUDA,PIEN,ITEMDA) ; Delete DDEF TIUDA; If parent PIEN and
"RTN","TIU182D1",6,0)
 ;Item IEN ITEMDA sent, first delete item from parent
"RTN","TIU182D1",7,0)
 N DA,DIK,X,Y,I
"RTN","TIU182D1",8,0)
 I $G(PIEN),$G(ITEMDA) D
"RTN","TIU182D1",9,0)
 . S DA(1)=PIEN,DA=ITEMDA,DIK="^TIU(8925.1,DA(1),10," D ^DIK
"RTN","TIU182D1",10,0)
 N DA,DIK
"RTN","TIU182D1",11,0)
 S DA=TIUDA,DIK="^TIU(8925.1," D ^DIK
"RTN","TIU182D1",12,0)
 Q
"RTN","TIU182D1",13,0)
 ;
"RTN","TIU182D1",14,0)
PARENT(NUM) ; Return IEN of parent new DDEF should be added to
"RTN","TIU182D1",15,0)
 N PIEN,PNUM
"RTN","TIU182D1",16,0)
 ; Parent node has form:
"RTN","TIU182D1",17,0)
 ;   ^TMP("TIU182",$J,"DATA",NUM,PIEN) = IEN of parent if known, or
"RTN","TIU182D1",18,0)
 ;   ^TMP("TIU182",$J,"DATA",NUM,PNUM) = DDEF# of parent if not
"RTN","TIU182D1",19,0)
 S PIEN=$G(^TMP("TIU182",$J,"DATA",NUM,"PIEN"))
"RTN","TIU182D1",20,0)
 ; -- If parent IEN is known, we're done:
"RTN","TIU182D1",21,0)
 I PIEN G PARENTX
"RTN","TIU182D1",22,0)
 ; -- If not, get DDEF# of parent
"RTN","TIU182D1",23,0)
 S PNUM=+$G(^TMP("TIU182",$J,"DATA",NUM,"PNUM"))
"RTN","TIU182D1",24,0)
 ; -- Get Parent IEN from "DONE" node, which was set
"RTN","TIU182D1",25,0)
 ;    when parent was created:
"RTN","TIU182D1",26,0)
 S PIEN=+$G(^XTMP("TIU182",PNUM,"DONE"))
"RTN","TIU182D1",27,0)
PARENTX I 'PIEN!'$D(^TIU(8925.1,PIEN,0)) D
"RTN","TIU182D1",28,0)
 . S ^TMP("TIU182ERR",$J,NUM)="FINDPARENT"
"RTN","TIU182D1",29,0)
 Q PIEN
"RTN","TIU182D1",30,0)
 ;
"RTN","TIU182D1",31,0)
ADDITEM(NUM,TIUDA,PIEN)  ; Add DDEF TIUDA to Parent; Return Item IEN
"RTN","TIU182D1",32,0)
 N MENUTXT,TIUFPRIV,TIUFISCR
"RTN","TIU182D1",33,0)
 N DIE,DR
"RTN","TIU182D1",34,0)
 S TIUFPRIV=1
"RTN","TIU182D1",35,0)
 N DA,DIC,DLAYGO,X,Y
"RTN","TIU182D1",36,0)
 N I,DIY
"RTN","TIU182D1",37,0)
 S DA(1)=PIEN
"RTN","TIU182D1",38,0)
 S DIC="^TIU(8925.1,"_DA(1)_",10,",DIC(0)="LX"
"RTN","TIU182D1",39,0)
 S DLAYGO=8925.14
"RTN","TIU182D1",40,0)
 ; -- If TIUDA is say, x, and Parent has x as IFN in Item subfile,
"RTN","TIU182D1",41,0)
 ;    code finds item x under parent instead of creating a new item,
"RTN","TIU182D1",42,0)
 ;    so don't use "`"_TIUDA:
"RTN","TIU182D1",43,0)
 S X=^TMP("TIU182",$J,"BASICS",NUM,"NAME")
"RTN","TIU182D1",44,0)
 ; -- Make sure the DDEF it adds is TIUDA and not another w same name:
"RTN","TIU182D1",45,0)
 S TIUFISCR=TIUDA ; activates item screen on fld 10, Subfld .01 in DD
"RTN","TIU182D1",46,0)
 D ^DIC I Y'>0!($P(Y,U,3)'=1) S ^TMP("TIU182ERR",$J,NUM)="ADDITEM"
"RTN","TIU182D1",47,0)
 Q Y
"RTN","TIU182D1",48,0)
 ;
"RTN","TIU182D1",49,0)
FILEITEM(NUM,PIEN,ITEMDA) ; File Menu Text for DDEF item ITEMDA
"RTN","TIU182D1",50,0)
 ;under parent
"RTN","TIU182D1",51,0)
 N TIUFPRIV,MENUTXT,ITEMFDA
"RTN","TIU182D1",52,0)
 K TIUIERR
"RTN","TIU182D1",53,0)
 S TIUFPRIV=1,MENUTXT=$G(^TMP("TIU182",$J,"DATA",NUM,"MENUTXT"))
"RTN","TIU182D1",54,0)
 S ITEMFDA(8925.14,ITEMDA_","_PIEN_",",4)=MENUTXT
"RTN","TIU182D1",55,0)
 D FILE^DIE("TE","ITEMFDA","TIUIERR")
"RTN","TIU182D1",56,0)
 I $D(TIUIERR) S ^TMP("TIU182ERR",$J,NUM)="FILEITEM"
"RTN","TIU182D1",57,0)
 Q
"RTN","TIU182D1",58,0)
 ;
"RTN","TIU182D1",59,0)
FILE(NUM,TIUDA) ; File fields for new DDEF TIUDA
"RTN","TIU182D1",60,0)
 ; Files ALL FIELDS set in "FILEDATA" nodes of ^TMP:
"RTN","TIU182D1",61,0)
 ;   ^TMP("TIU182",$J,"FILEDATA",NUM,Field#)
"RTN","TIU182D1",62,0)
 N TIUFPRIV,FDA
"RTN","TIU182D1",63,0)
 K ^TMP("DIERR",$J)
"RTN","TIU182D1",64,0)
 S TIUFPRIV=1
"RTN","TIU182D1",65,0)
 M FDA(8925.1,TIUDA_",")=^TMP("TIU182",$J,"FILEDATA",NUM)
"RTN","TIU182D1",66,0)
 D FILE^DIE("TE","FDA")
"RTN","TIU182D1",67,0)
 I $D(^TMP("DIERR",$J)) S ^TMP("TIU182ERR",$J,NUM)="FILE"
"RTN","TIU182D1",68,0)
 Q
"RTN","TIU182D1",69,0)
 ;
"RTN","TIU182D1",70,0)
CREATE(NUM) ; Create new DDEF entry
"RTN","TIU182D1",71,0)
 N DIC,DLAYGO,DA,X,Y
"RTN","TIU182D1",72,0)
 S DIC="^TIU(8925.1,",DLAYGO=8925.1
"RTN","TIU182D1",73,0)
 S DIC(0)="LX",X=^TMP("TIU182",$J,"BASICS",NUM,"NAME")
"RTN","TIU182D1",74,0)
 S DIC("S")="I $P(^(0),U,4)="_""""_^TMP("TIU182",$J,"BASICS",NUM,"INTTYPE")_""""
"RTN","TIU182D1",75,0)
 D ^DIC
"RTN","TIU182D1",76,0)
 I $P($G(Y),U,3)'=1 S ^TMP("TIU182ERR",$J,NUM)="CREATE"
"RTN","TIU182D1",77,0)
 Q $G(Y)
"RTN","TIU182DF")
0^18^B41147338
"RTN","TIU182DF",1,0)
TIU182DF ; SLC/MAM - Create new HP DDEFS ; 7/22/04
"RTN","TIU182DF",2,0)
 ;;1.0;Text Integration Utilities;**182**;Jun 20, 1997
"RTN","TIU182DF",3,0)
 ; Run this after installing patch 182.
"RTN","TIU182DF",4,0)
 ;Use option: TIU182 DDEFS, MED CONVERSION
"RTN","TIU182DF",5,0)
 ; External References
"RTN","TIU182DF",6,0)
 ;   DBIA 3409  ^USR(8930,"B"
"RTN","TIU182DF",7,0)
BEGIN ; Create DDEFS
"RTN","TIU182DF",8,0)
 W !!,"This option creates Historical Procedure Document Definitions (DDEFS) for",!,"the Medicine Package conversion."
"RTN","TIU182DF",9,0)
 W !,"It may take one or two minutes to run.  It will tell you whether or not",!,"it is successful."
"RTN","TIU182DF",10,0)
 W ! K IOP N %ZIS S %ZIS="Q" D ^%ZIS I POP K POP Q
"RTN","TIU182DF",11,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","TIU182DF",12,0)
 .S ZTRTN="MAIN^TIUPS182"
"RTN","TIU182DF",13,0)
 .S ZTDESC="Create DDEFS for Medicine Conversion - TIU*1*182"
"RTN","TIU182DF",14,0)
 .D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Canceled!")
"RTN","TIU182DF",15,0)
 .K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","TIU182DF",16,0)
 .D HOME^%ZIS
"RTN","TIU182DF",17,0)
 U IO D MAIN,^%ZISC
"RTN","TIU182DF",18,0)
 Q
"RTN","TIU182DF",19,0)
 ;
"RTN","TIU182DF",20,0)
MAIN ; Create Historical Procedure DDEFS for Medicine Conversion
"RTN","TIU182DF",21,0)
 N TIUDUPS,TMPCNT,TIUSTTS
"RTN","TIU182DF",22,0)
 ; -- Set ^XTMP deletion date for about 2 years hence:
"RTN","TIU182DF",23,0)
 ;    Set it even if all are already created, in case it's in test
"RTN","TIU182DF",24,0)
 ;      for more than 2 years, so sites can reset it by running option.
"RTN","TIU182DF",25,0)
 S ^XTMP("TIU182",0)=$$FMADD^XLFDT(DT,730)_U_DT_U_"Tracks DDEFS created by Option TIU182 DDEFS, MED CONVERSION"
"RTN","TIU182DF",26,0)
 K ^TMP("TIU182MSG",$J),^TMP("TIU182ERR",$J),^TMP("TIU182",$J)
"RTN","TIU182DF",27,0)
 ; -- Begin message array ^TMP("TIU182MSG",$J:
"RTN","TIU182DF",28,0)
 S TMPCNT=0
"RTN","TIU182DF",29,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="*** Historical Procedure Document Definitions for the Medicine Conversion ***"
"RTN","TIU182DF",30,0)
 ; -- Check if ALL done; check for Class Clinical Coord:
"RTN","TIU182DF",31,0)
 I $G(^XTMP("TIU182","DONE"))="ALL" D  G MAINX
"RTN","TIU182DF",32,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="All DDEFS exported for the conversion have already been created"
"RTN","TIU182DF",33,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="by option TIU182 DDEFS, MED CONVERSION."
"RTN","TIU182DF",34,0)
 N CPCLASS S CPCLASS=$$CLASS^TIUCP I 'CPCLASS D
"RTN","TIU182DF",35,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="I can't find Class CLINICAL PROCEDURES, exported in patch TIU*1*109."
"RTN","TIU182DF",36,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="Option cannot be run without it."
"RTN","TIU182DF",37,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)=""
"RTN","TIU182DF",38,0)
 I $O(^USR(8930,"B","CLINICAL COORDINATOR",""))="" D
"RTN","TIU182DF",39,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="I can't find User Class CLINICAL COORDINATOR. Option cannot be run without it."
"RTN","TIU182DF",40,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)=""
"RTN","TIU182DF",41,0)
 ; -- Set basic DDEF data into BASICS node of data array ^TMP("TIU182":
"RTN","TIU182DF",42,0)
 D SETBASIC^TIUEN182
"RTN","TIU182DF",43,0)
 ; -- Check for potential DDEF duplicates at site:
"RTN","TIU182DF",44,0)
 D TIUDUPS^TIUEN182(.TIUDUPS,1)
"RTN","TIU182DF",45,0)
 ; -- If potential duplicates exist, add them to message array:
"RTN","TIU182DF",46,0)
 I TIUDUPS D LISTDUPS^TIUEN182(.TIUDUPS,.TMPCNT,1) G MAINX
"RTN","TIU182DF",47,0)
 I $O(^USR(8930,"B","CLINICAL COORDINATOR",""))="" G MAINX
"RTN","TIU182DF",48,0)
 I 'CPCLASS G MAINX
"RTN","TIU182DF",49,0)
 ; -- If no potential dups, User Class exists, CLINICAL PROCEDURES
"RTN","TIU182DF",50,0)
 ;    Class exists, go on:
"RTN","TIU182DF",51,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="Environment looks OK."
"RTN","TIU182DF",52,0)
 ; -- Check if some DDEFS done:
"RTN","TIU182DF",53,0)
 I $G(^XTMP("TIU182","DONE"))="SOME" D
"RTN","TIU182DF",54,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="Some of the DDEFS exported for the conversion have already been"
"RTN","TIU182DF",55,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="created by this option. I will now create the others..."
"RTN","TIU182DF",56,0)
 ; -- If none created yet:
"RTN","TIU182DF",57,0)
 I '$D(^XTMP("TIU182","DONE")) D
"RTN","TIU182DF",58,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="Creating the Document Definitions..."
"RTN","TIU182DF",59,0)
 ; -- Set flds for FILE call & item data into nodes FILEDATA & DATA
"RTN","TIU182DF",60,0)
 ;    of array ^TMP("TIU182":
"RTN","TIU182DF",61,0)
 D SETDATA^TIU182D
"RTN","TIU182DF",62,0)
 ; -- Loop through DDEFS to create them:
"RTN","TIU182DF",63,0)
 N NUM
"RTN","TIU182DF",64,0)
 F NUM=1:1:13 D
"RTN","TIU182DF",65,0)
 . N TIUIEN,YDDEF,TIUDA,PIEN,ITEMDA
"RTN","TIU182DF",66,0)
 . ; -- If DDEF was previously created by this option,
"RTN","TIU182DF",67,0)
 . ;    quit and get next DDEF:
"RTN","TIU182DF",68,0)
 . S TIUIEN=+$G(^XTMP("TIU182",NUM,"DONE")) Q:TIUIEN
"RTN","TIU182DF",69,0)
 . ; -- If not, create new DDEF:
"RTN","TIU182DF",70,0)
 . S YDDEF=$$CREATE^TIU182D1(NUM)
"RTN","TIU182DF",71,0)
 . ; -- If DDEF couldn't be created or was found by lookup
"RTN","TIU182DF",72,0)
 . ;    instead of being created, quit and get next DDEF: 
"RTN","TIU182DF",73,0)
 . I $G(^TMP("TIU182ERR",$J,NUM))="CREATE" Q
"RTN","TIU182DF",74,0)
 . S TIUDA=+YDDEF
"RTN","TIU182DF",75,0)
 . ; -- Call FILE to stuff fields from ^TMP("TIU182",$J,"FILEDATA",NUM:
"RTN","TIU182DF",76,0)
 . D FILE^TIU182D1(NUM,TIUDA)
"RTN","TIU182DF",77,0)
 . I $G(^TMP("TIU182ERR",$J,NUM))="FILE" D DELETE^TIU182D1(TIUDA) Q
"RTN","TIU182DF",78,0)
 . ; -- Add item to parent, stuff item data:
"RTN","TIU182DF",79,0)
 . S PIEN=$$PARENT^TIU182D1(NUM)
"RTN","TIU182DF",80,0)
 . I $G(^TMP("TIU182ERR",$J,NUM))="FINDPARENT" D DELETE^TIU182D1(TIUDA) Q
"RTN","TIU182DF",81,0)
 . S ITEMDA=+$$ADDITEM^TIU182D1(NUM,TIUDA,PIEN)
"RTN","TIU182DF",82,0)
 . I $G(^TMP("TIU182ERR",$J,NUM))="ADDITEM" D DELETE^TIU182D1(TIUDA) Q
"RTN","TIU182DF",83,0)
 . D FILEITEM^TIU182D1(NUM,PIEN,ITEMDA)
"RTN","TIU182DF",84,0)
 . I $G(^TMP("TIU182ERR",$J,NUM))="FILEITEM" D DELETE^TIU182D1(TIUDA,PIEN,ITEMDA) Q
"RTN","TIU182DF",85,0)
 . ; -- DDEF NUM has been created and edited successfully:
"RTN","TIU182DF",86,0)
 . S ^XTMP("TIU182",NUM,"DONE")=TIUDA
"RTN","TIU182DF",87,0)
 . S ^XTMP("TIU182","DONE")="SOME"
"RTN","TIU182DF",88,0)
 . Q
"RTN","TIU182DF",89,0)
 ; -- Add results from CREATE loop to message array:
"RTN","TIU182DF",90,0)
 N NUM S NUM=0
"RTN","TIU182DF",91,0)
 I $O(^TMP("TIU182ERR",$J,NUM))="" D  G MAINX
"RTN","TIU182DF",92,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="All Document Definitions have now been created successfully."
"RTN","TIU182DF",93,0)
 . S ^XTMP("TIU182","DONE")="ALL"
"RTN","TIU182DF",94,0)
 . ; -- Kill indiv DONE nodes:
"RTN","TIU182DF",95,0)
 . N NUMBER F NUMBER=1:1:13 K ^XTMP("TIU182",NUMBER)
"RTN","TIU182DF",96,0)
 . ; -- Edit Print Form Header,delete PF Number of Class CP:
"RTN","TIU182DF",97,0)
 . N FDA,TIUFPRIV S FDA(8925.1,CPCLASS_",",6.1)="CLINICAL PROCEDURES"
"RTN","TIU182DF",98,0)
 . S FDA(8925.1,CPCLASS_",",6.12)="@"
"RTN","TIU182DF",99,0)
 . S TIUFPRIV=1
"RTN","TIU182DF",100,0)
 . D FILE^DIE("TE","FDA")
"RTN","TIU182DF",101,0)
 . Q:'$D(^TMP("DIERR",$J))
"RTN","TIU182DF",102,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="Couldn't update CP Print Fields. See patch description or contact EVS."
"RTN","TIU182DF",103,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)=""
"RTN","TIU182DF",104,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="Problems were encountered creating the following Document Definitions:"
"RTN","TIU182DF",105,0)
 F  S NUM=$O(^TMP("TIU182ERR",$J,NUM)) Q:NUM=""  D
"RTN","TIU182DF",106,0)
 . N PROB S PROB=^TMP("TIU182ERR",$J,NUM)
"RTN","TIU182DF",107,0)
 . D
"RTN","TIU182DF",108,0)
 . . I PROB="CREATE" S PROB="Couldn't create DDEF." Q
"RTN","TIU182DF",109,0)
 . . I PROB="FILE" S PROB="Couldn't file fields. DDEF deleted." Q
"RTN","TIU182DF",110,0)
 . . I PROB="FINDPARENT" S PROB="Couldn't find parent. DDEF deleted." Q
"RTN","TIU182DF",111,0)
 . . I PROB="ADDITEM" S PROB="Couldn't add DDEF to parent. DDEF deleted."
"RTN","TIU182DF",112,0)
 . . I PROB="FILEITEM" S PROB="Couldn't file Menu Text. DDEF deleted."
"RTN","TIU182DF",113,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)=$S(NUM=1:"Document Class ",1:"Title ")_^TMP("TIU182",$J,"BASICS",NUM,"NAME")_": "
"RTN","TIU182DF",114,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="  "_PROB
"RTN","TIU182DF",115,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)=""
"RTN","TIU182DF",116,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="Please contact Enterprise VistA Support. When problems have been resolved,"
"RTN","TIU182DF",117,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="come back and rerun the option."
"RTN","TIU182DF",118,0)
MAINX ; Exit
"RTN","TIU182DF",119,0)
 ; -- Leave latest error arrays ^TMP("DIERR",$J) & TIUIERR around until
"RTN","TIU182DF",120,0)
 ;    now in case modules are run separately for debugging:
"RTN","TIU182DF",121,0)
 K TIUIERR,^TMP("DIERR",$J)
"RTN","TIU182DF",122,0)
 ; -- Finish message array ^TMP("TIU182MSG",$J and print it:
"RTN","TIU182DF",123,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)=""
"RTN","TIU182DF",124,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="                           *************"
"RTN","TIU182DF",125,0)
 D PRINT^TIU182D
"RTN","TIU182DF",126,0)
 K ^TMP("TIU182MSG",$J),^TMP("TIU182ERR",$J),^TMP("TIU182",$J)
"RTN","TIU182DF",127,0)
 Q
"RTN","TIUCP")
0^2^B6780383
"RTN","TIUCP",1,0)
TIUCP ;SLC/RMO - Clinical Procedures API(s) and RPC(s) ;5/12/04
"RTN","TIUCP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**109,182**;Jun 20, 1997
"RTN","TIUCP",3,0)
 ;
"RTN","TIUCP",4,0)
CLASS() ;Get the CLINICAL PROCEDURES Class TIU Document Definition
"RTN","TIUCP",5,0)
 ;file (#8925.1) IEN
"RTN","TIUCP",6,0)
 ; Input  -- None    
"RTN","TIUCP",7,0)
 ; Output -- TIU Document Definition file (#8925.1) IEN
"RTN","TIUCP",8,0)
 N Y,TIUI,TYPE
"RTN","TIUCP",9,0)
 S (Y,TIUI)=0
"RTN","TIUCP",10,0)
 ; -- Make sure type is CLASS (P182):
"RTN","TIUCP",11,0)
 F  S TIUI=+$O(^TIU(8925.1,"B","CLINICAL PROCEDURES",TIUI)) Q:'TIUI  D  Q:Y
"RTN","TIUCP",12,0)
 . S TYPE=$P($G(^TIU(8925.1,TIUI,0)),U,4)
"RTN","TIUCP",13,0)
 . I TYPE="CL" S Y=TIUI
"RTN","TIUCP",14,0)
 Q Y
"RTN","TIUCP",15,0)
 ;
"RTN","TIUCP",16,0)
HISTDC() ;Get Historical Procedures Document Class IEN (under Class CLINICAL PROCEDURES) in TIU DDEF file (#8925.1)
"RTN","TIUCP",17,0)
 ; -- P182
"RTN","TIUCP",18,0)
 ; Input  -- None    
"RTN","TIUCP",19,0)
 ; Output -- TIU Document Definition file (#8925.1) IEN
"RTN","TIUCP",20,0)
 N Y,TIUI,TYPE,TIUISCP
"RTN","TIUCP",21,0)
 S (Y,TIUI)=0
"RTN","TIUCP",22,0)
 F  S TIUI=+$O(^TIU(8925.1,"B","HISTORICAL PROCEDURES",TIUI)) Q:'TIUI  D  Q:Y
"RTN","TIUCP",23,0)
 . S TYPE=$P($G(^TIU(8925.1,TIUI,0)),U,4)
"RTN","TIUCP",24,0)
 . I TYPE="DC" D ISCP(.TIUISCP,TIUI) S:TIUISCP Y=TIUI
"RTN","TIUCP",25,0)
 Q Y
"RTN","TIUCP",26,0)
 ;
"RTN","TIUCP",27,0)
ISHISTCP(TITLE) ; Function evaluates whether a Title is under the
"RTN","TIUCP",28,0)
 ;Historical Procedures Document Class under Class CP
"RTN","TIUCP",29,0)
 ; -- P182
"RTN","TIUCP",30,0)
 ; Input  -- TITLE    TIU Document Definition file (#8925.1) IEN
"RTN","TIUCP",31,0)
 ; Output -- 1=True and 0=False
"RTN","TIUCP",32,0)
 N TIUDCLAS,Y
"RTN","TIUCP",33,0)
 ; -- Exit if Title is not defined:
"RTN","TIUCP",34,0)
 I $G(TITLE)'>0 S Y=0 G ISHISTX
"RTN","TIUCP",35,0)
 ; -- Get HISTORICAL PROCEDURES Document Class IEN in 8925.1:
"RTN","TIUCP",36,0)
 S TIUDCLAS=$$HISTDC
"RTN","TIUCP",37,0)
 ; -- Exit if Document Class is not found:
"RTN","TIUCP",38,0)
 I TIUDCLAS'>0 S Y=0 G ISHISTX
"RTN","TIUCP",39,0)
 ; -- Check if Title is under HISTORICAL PROCEDURES Document Class:
"RTN","TIUCP",40,0)
 S Y=+$$ISA^TIULX(TITLE,TIUDCLAS)
"RTN","TIUCP",41,0)
ISHISTX Q Y
"RTN","TIUCP",42,0)
 ;
"RTN","TIUCP",43,0)
HPCAN(TIUACT) ; Is action allowed (not prohibited outright) for HP docmts
"RTN","TIUCP",44,0)
 ; Returns 1 if action allowed (not prohibited outright)
"RTN","TIUCP",45,0)
 ;         0^WHYNOT if action not allowed (prohibited outright)
"RTN","TIUCP",46,0)
 ; Requires TIUACT=IEN in USR ACTION file
"RTN","TIUCP",47,0)
 N ALLOWED S ALLOWED=1
"RTN","TIUCP",48,0)
 I TIUACT=19 S ALLOWED="0^ Historical Procedures may not be addended."
"RTN","TIUCP",49,0)
 I TIUACT=20 S ALLOWED="0^ Historical Procedures may not have signers identified."
"RTN","TIUCP",50,0)
 I TIUACT=21 S ALLOWED="0^ Historical Procedures may not be reassigned."
"RTN","TIUCP",51,0)
 I TIUACT=22 S ALLOWED="0^ Historical Procedures may not have their titles changed."
"RTN","TIUCP",52,0)
 I TIUACT=23 S ALLOWED="0^ Historical Procedures may not be linked with requests."
"RTN","TIUCP",53,0)
 Q ALLOWED
"RTN","TIUCP",54,0)
 ;
"RTN","TIUCP",55,0)
ISCP(TIUY,TITLE) ;RPC that evaluates whether or not a Title is under
"RTN","TIUCP",56,0)
 ;the CLINICAL PROCEDURES Class
"RTN","TIUCP",57,0)
 ; Input  -- TITLE    TIU Document Definition file (#8925.1) IEN
"RTN","TIUCP",58,0)
 ;                    (May be Document Class instead of Title.)
"RTN","TIUCP",59,0)
 ; Output -- TIUY     1=True and 0=False
"RTN","TIUCP",60,0)
 N TIUCLASS
"RTN","TIUCP",61,0)
 ;
"RTN","TIUCP",62,0)
 ;Exit if a Title is not defined
"RTN","TIUCP",63,0)
 I +$G(TITLE)'>0 S TIUY=0 G ISCPQ
"RTN","TIUCP",64,0)
 ;
"RTN","TIUCP",65,0)
 ;Get CLINICAL PROCEDURES TIU Document Definition file (#8925.1) IEN
"RTN","TIUCP",66,0)
 S TIUCLASS=+$$CLASS
"RTN","TIUCP",67,0)
 ;
"RTN","TIUCP",68,0)
 ;Exit if the CLINICAL PROCEDURES Class is not found
"RTN","TIUCP",69,0)
 I +TIUCLASS'>0 S TIUY=0 G ISCPQ
"RTN","TIUCP",70,0)
 ;
"RTN","TIUCP",71,0)
 ;Check if the Title is under the CLINICAL PROCEDURES Class
"RTN","TIUCP",72,0)
 S TIUY=+$$ISA^TIULX(TITLE,TIUCLASS)
"RTN","TIUCP",73,0)
ISCPQ Q
"RTN","TIUCP",74,0)
 ;
"RTN","TIUCP",75,0)
CPCLASS(Y) ;RPC that gets the CLINICAL PROCEDURES TIU Document
"RTN","TIUCP",76,0)
 ;Definition file (#8925.1) IEN
"RTN","TIUCP",77,0)
 ; Input  -- None
"RTN","TIUCP",78,0)
 ; Output -- Y        TIU Document Definition file (#8925.1) IEN
"RTN","TIUCP",79,0)
 S Y=$$CLASS
"RTN","TIUCP",80,0)
 Q
"RTN","TIUCP",81,0)
 ;
"RTN","TIUCP",82,0)
LNGCP(Y,FROM,DIR) ;RPC that serves data to a longlist of selectable Titles
"RTN","TIUCP",83,0)
 ; Input  -- FROM     Reference Title from which the longlist is
"RTN","TIUCP",84,0)
 ;                    scrolling
"RTN","TIUCP",85,0)
 ;           DIR      Direction from which the longlist is scrolling
"RTN","TIUCP",86,0)
 ;                    from the reference Title  (Optional- default 1)
"RTN","TIUCP",87,0)
 ; Output -- Y        An array of the 44 nearest Titles to that indicated
"RTN","TIUCP",88,0)
 ;                    by the user in the direction passed by the longlist
"RTN","TIUCP",89,0)
 ;                    component
"RTN","TIUCP",90,0)
 N TIUCLASS
"RTN","TIUCP",91,0)
 ;
"RTN","TIUCP",92,0)
 ;Exit if a reference Title is not defined
"RTN","TIUCP",93,0)
 I '$D(FROM) G LNGCPQ
"RTN","TIUCP",94,0)
 ;
"RTN","TIUCP",95,0)
 ;Get CLINICAL PROCEDURES TIU Document Definition file (#8925.1) IEN
"RTN","TIUCP",96,0)
 S TIUCLASS=+$$CLASS
"RTN","TIUCP",97,0)
 ;
"RTN","TIUCP",98,0)
 ;Exit if the CLINICAL PROCEDURES Class is not found
"RTN","TIUCP",99,0)
 I +TIUCLASS'>0 G LNGCPQ
"RTN","TIUCP",100,0)
 ;
"RTN","TIUCP",101,0)
 ;Get the longlist of Titles for the CLINICAL PROCEDURES Class
"RTN","TIUCP",102,0)
 D LONGLIST^TIUSRVD(.Y,TIUCLASS,FROM,$G(DIR,1))
"RTN","TIUCP",103,0)
LNGCPQ Q
"RTN","TIUEN182")
0^3^B27891193
"RTN","TIUEN182",1,0)
TIUEN182 ; SLC/MAM - Environment Check Rtn for TIU*1*182 ; 6/9/04
"RTN","TIUEN182",2,0)
 ;;1.0;Text Integration Utilities;**182**;Jun 20, 1997
"RTN","TIUEN182",3,0)
 ; External References
"RTN","TIUEN182",4,0)
 ;   DBIA 3409  ^USR(8930,"B"
"RTN","TIUEN182",5,0)
MAIN ; Check environment.  If problems found, warn but do not abort install.
"RTN","TIUEN182",6,0)
 ; -- Check if done:
"RTN","TIUEN182",7,0)
 I $G(^XTMP("TIU182","DONE"))="ALL" W !,"All Document Definitions exported for the Medicine Conversion have already",!," been created. You won't need to rerun the option." Q
"RTN","TIUEN182",8,0)
 I '$$CLASS^TIUCP W !,"I can't find Class CLINICAL PROCEDURES, exported in patch TIU*1*109. You",!,"won't be able to run the option that creates the Document Definitions",!,"without this class. See patch description.",!
"RTN","TIUEN182",9,0)
 I $O(^USR(8930,"B","CLINICAL COORDINATOR",""))="" W !,"I can't find User Class CLINICAL COORDINATOR. You won't be able to run",!,"the option that creates the Document Definitions without this class. See",!,"patch description.",!
"RTN","TIUEN182",10,0)
 ; -- Check for potential DDEF duplicates at site:
"RTN","TIUEN182",11,0)
 D SETBASIC ; Set basic data for DDEFS into ^TMP for dups check
"RTN","TIUEN182",12,0)
 W !,"Checking for potential duplicate Document Definitions..."
"RTN","TIUEN182",13,0)
 N TIUDUPS
"RTN","TIUEN182",14,0)
 D TIUDUPS(.TIUDUPS)
"RTN","TIUEN182",15,0)
 I 'TIUDUPS W !,"     No potential duplicates found.",!,"Remember to run option TIU182 DDEFS, MED CONVERSION after installing the patch." G MAINX
"RTN","TIUEN182",16,0)
 ; -- If potential duplicates exist, list them:
"RTN","TIUEN182",17,0)
 K ^TMP("TIU182MSG",$J) ; LISTDUPS needs new ^TMP("TIU182MSG",$J)
"RTN","TIUEN182",18,0)
 D LISTDUPS(.TIUDUPS,0,0)
"RTN","TIUEN182",19,0)
MAINX K ^TMP("TIU182MSG",$J) ; Clean up after LISTDUPS
"RTN","TIUEN182",20,0)
 K ^TMP("TIU182",$J) ; Clean up after SETBASIC
"RTN","TIUEN182",21,0)
 Q
"RTN","TIUEN182",22,0)
 ;
"RTN","TIUEN182",23,0)
SETBASIC ; Set up basic data in ^TMP("TIU182",$J,"BASICS")
"RTN","TIUEN182",24,0)
 N NUMBER
"RTN","TIUEN182",25,0)
 ; -- Set ^TMP("TIU182",$J,"BASICS",[NUMBER],["INTTYPE" or "NAME"])
"RTN","TIUEN182",26,0)
 ; -- Set basic data NAME and interior TYPE for new DDEFS into TMP.
"RTN","TIUEN182",27,0)
 ;    Reference DDEFS by NUMBER.
"RTN","TIUEN182",28,0)
 ;    Number parent-to-be BEFORE child.
"RTN","TIUEN182",29,0)
 ;    Name MUST be upper case or ADDITEM fails
"RTN","TIUEN182",30,0)
 S ^TMP("TIU182",$J,"BASICS",1,"INTTYPE")="DC"
"RTN","TIUEN182",31,0)
 F NUMBER=2:1:13 S ^TMP("TIU182",$J,"BASICS",NUMBER,"INTTYPE")="DOC"
"RTN","TIUEN182",32,0)
 F NUMBER=1:1:13 S ^TMP("TIU182",$J,"BASICS",NUMBER,"NAME")=$P($T(NAME+NUMBER),";;",2,99)
"RTN","TIUEN182",33,0)
 Q
"RTN","TIUEN182",34,0)
 ;
"RTN","TIUEN182",35,0)
TIUDUPS(TIUDUPS,OPTFLG) ; Set array TIUDUPS of potential duplicate DDEFS
"RTN","TIUEN182",36,0)
 N NUM S TIUDUPS=0,OPTFLG=+$G(OPTFLG)
"RTN","TIUEN182",37,0)
 I $G(^XTMP("TIU182","DONE"))="ALL" Q
"RTN","TIUEN182",38,0)
 F NUM=1:1:13 Q:'NUM  D
"RTN","TIUEN182",39,0)
 . ; -- When looking for duplicates, ignore DDEF if
"RTN","TIUEN182",40,0)
 . ;    previously created by this patch:
"RTN","TIUEN182",41,0)
 . Q:$G(^XTMP("TIU182",NUM,"DONE"))
"RTN","TIUEN182",42,0)
 . ; -- If site already has DDEF w/ same Name & Type as one
"RTN","TIUEN182",43,0)
 . ;    we are exporting, set its number into array TIUDUPS:
"RTN","TIUEN182",44,0)
 . N NAME,TYPE,TIUDA S TIUDA=0
"RTN","TIUEN182",45,0)
 . S NAME=^TMP("TIU182",$J,"BASICS",NUM,"NAME")
"RTN","TIUEN182",46,0)
 . S TYPE=^TMP("TIU182",$J,"BASICS",NUM,"INTTYPE")
"RTN","TIUEN182",47,0)
 . F  S TIUDA=$O(^TIU(8925.1,"B",NAME,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUEN182",48,0)
 . . I $P($G(^TIU(8925.1,+TIUDA,0)),U,4)=TYPE S TIUDUPS(NUM)=+TIUDA,TIUDUPS=1
"RTN","TIUEN182",49,0)
 Q
"RTN","TIUEN182",50,0)
 ;
"RTN","TIUEN182",51,0)
LISTDUPS(TIUDUPS,TMPCNT,OPTFLG) ; List duplicates by name
"RTN","TIUEN182",52,0)
 ; TIUDUPS = array as set in TIUDUPS. Required.
"RTN","TIUEN182",53,0)
 ; TMPCNT = Count at which to start message array ^TMP("TIU182MSG",$J,TMPCNT); Received by reference. (Array already has some nodes if called from option.) Optional.
"RTN","TIUEN182",54,0)
 ; OPTFLG = 1 if called from option;
"RTN","TIUEN182",55,0)
 ;          0 if called from env check. Optional.
"RTN","TIUEN182",56,0)
 N NUM
"RTN","TIUEN182",57,0)
 S OPTFLG=+$G(OPTFLG)
"RTN","TIUEN182",58,0)
 S TMPCNT=$S($G(TMPCNT):TMPCNT,1:0)
"RTN","TIUEN182",59,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="You already have the following Document Definitions exported by this patch."
"RTN","TIUEN182",60,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="I don't want to overwrite them. Please change their names so they no longer"
"RTN","TIUEN182",61,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="match the exported ones, or if you are not using them, delete them. If you"
"RTN","TIUEN182",62,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="change the name of a Document Definition you plan to continue using, remember"
"RTN","TIUEN182",63,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="to update its Print Name, as well. For help, contact Enterprise VistA Support."
"RTN","TIUEN182",64,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)=""
"RTN","TIUEN182",65,0)
 S TMPCNT=TMPCNT+1
"RTN","TIUEN182",66,0)
 I 'OPTFLG D
"RTN","TIUEN182",67,0)
 . S ^TMP("TIU182MSG",$J,TMPCNT)="You will not be able to run option TIU182 DDEFS, MED CONVERSION to create the"
"RTN","TIUEN182",68,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="DDEFS until these matches are eliminated."
"RTN","TIUEN182",69,0)
 E  S ^TMP("TIU182MSG",$J,TMPCNT)="You may not run this option until these matches are eliminated."
"RTN","TIUEN182",70,0)
 S NUM=0
"RTN","TIUEN182",71,0)
 F  S NUM=$O(TIUDUPS(NUM)) Q:'NUM  D
"RTN","TIUEN182",72,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU182MSG",$J,TMPCNT)="     "_^TMP("TIU182",$J,"BASICS",NUM,"NAME")
"RTN","TIUEN182",73,0)
 ; -- If called from env check, not option, write list:
"RTN","TIUEN182",74,0)
 I OPTFLG Q
"RTN","TIUEN182",75,0)
 N TIUI S TIUI=0
"RTN","TIUEN182",76,0)
 F  S TIUI=$O(^TMP("TIU182MSG",$J,TIUI)) Q:'TIUI  D
"RTN","TIUEN182",77,0)
 . W !,^TMP("TIU182MSG",$J,TIUI)
"RTN","TIUEN182",78,0)
 Q
"RTN","TIUEN182",79,0)
 ;
"RTN","TIUEN182",80,0)
NAME ; Names of DDEFS in order from 1 to 13
"RTN","TIUEN182",81,0)
 ;;HISTORICAL PROCEDURES
"RTN","TIUEN182",82,0)
 ;;HISTORICAL CARDIAC CATHETERIZATION PROCEDURE
"RTN","TIUEN182",83,0)
 ;;HISTORICAL ELECTROCARDIOGRAM PROCEDURE
"RTN","TIUEN182",84,0)
 ;;HISTORICAL ECHOCARDIOGRAM PROCEDURE
"RTN","TIUEN182",85,0)
 ;;HISTORICAL ELECTROPHYSIOLOGY PROCEDURE
"RTN","TIUEN182",86,0)
 ;;HISTORICAL HOLTER PROCEDURE
"RTN","TIUEN182",87,0)
 ;;HISTORICAL EXERCISE TOLERANCE TEST PROCEDURE
"RTN","TIUEN182",88,0)
 ;;HISTORICAL PRE/POST SURGERY RISK NOTE
"RTN","TIUEN182",89,0)
 ;;HISTORICAL ENDOSCOPIC PROCEDURE
"RTN","TIUEN182",90,0)
 ;;HISTORICAL PULMONARY FUNCTION TEST PROCEDURE
"RTN","TIUEN182",91,0)
 ;;HISTORICAL HEMATOLOGY PROCEDURE
"RTN","TIUEN182",92,0)
 ;;HISTORICAL PACEMAKER IMPLANTATION PROCEDURE
"RTN","TIUEN182",93,0)
 ;;HISTORICAL RHEUMATOLOGY PROCEDURE
"RTN","TIUEN182",94,0)
 Q
"RTN","TIUEPRNT")
0^4^B4201050
"RTN","TIUEPRNT",1,0)
TIUEPRNT ; SLC/JER - Handle print following entry/edit ; 5/3/04
"RTN","TIUEPRNT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**20,100,182**;Jun 20, 1997
"RTN","TIUEPRNT",3,0)
PRINT(TIUDA) ; Prompt and print
"RTN","TIUEPRNT",4,0)
 N TIUDEV,TIUTYP,DFN,TIUPMTHD,TIUD0,TIUMSG,TIUPR,TIUDARR,TIUFLAG,TIUDPRM
"RTN","TIUEPRNT",5,0)
 N TIUPGRP,TIUPFHDR,TIUPFNBR
"RTN","TIUEPRNT",6,0)
 S TIUMSG="Print this note"
"RTN","TIUEPRNT",7,0)
 S TIUPR=$$READ^TIUU("Y",TIUMSG,"No")
"RTN","TIUEPRNT",8,0)
 I +TIUPR'>0 Q
"RTN","TIUEPRNT",9,0)
 I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=$P($G(^TIU(8925,+TIUDA,0)),U,6)
"RTN","TIUEPRNT",10,0)
 I $G(^TIU(8925,TIUDA,21)) S TIUDA=^TIU(8925,TIUDA,21)
"RTN","TIUEPRNT",11,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUEPRNT",12,0)
 S TIUTYP=$P(TIUD0,U),DFN=$P(TIUD0,U,2)
"RTN","TIUEPRNT",13,0)
 I +TIUTYP'>0 Q
"RTN","TIUEPRNT",14,0)
 S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYP)
"RTN","TIUEPRNT",15,0)
 S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYP)
"RTN","TIUEPRNT",16,0)
 S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYP)
"RTN","TIUEPRNT",17,0)
 S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYP)
"RTN","TIUEPRNT",18,0)
 D DOCPRM^TIULC1(+TIUTYP,.TIUDPRM,TIUDA)
"RTN","TIUEPRNT",19,0)
 I +$P($G(TIUDPRM(0)),U,9) S TIUFLAG=$$FLAG^TIUPRPN3
"RTN","TIUEPRNT",20,0)
 ;I $G(TIUPMTHD)]"",+$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") S TIUDARR(TIUPMTHD,$G(TIUPGRP)_"$"_TIUPFHDR_";"_DFN,1,TIUDA)=TIUPFNBR
"RTN","TIUEPRNT",21,0)
 ;E  S TIUDARR(TIUPMTHD,DFN,1,TIUDA)=""
"RTN","TIUEPRNT",22,0)
 I $G(TIUPMTHD)']"" W !,$C(7),"No Print Method Defined for ",$P($G(^TIU(8925.1,+TIUTYP,0)),U) H 2 G PRINT1X
"RTN","TIUEPRNT",23,0)
 ; -- P182: Set array same whether or not flds are defined, with
"RTN","TIUEPRNT",24,0)
 ;    TIUPGRP piece possibly 0, TIUPFHDR piece possibly null, and
"RTN","TIUEPRNT",25,0)
 ;    array value TIUPFNBR possibly null.
"RTN","TIUEPRNT",26,0)
 S TIUDARR(TIUPMTHD,+$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_DFN,1,TIUDA)=$G(TIUPFNBR)
"RTN","TIUEPRNT",27,0)
 S TIUDEV=$$DEVICE^TIUDEV(.IO) ; Get Device/allow queueing
"RTN","TIUEPRNT",28,0)
 I $S($G(IO)']"":1,TIUDEV']"":1,1:0) D ^%ZISC Q
"RTN","TIUEPRNT",29,0)
 I $D(IO("Q")) D QUE^TIUDEV("PRINTQ^TIUEPRNT",TIUDEV) G PRINT1X
"RTN","TIUEPRNT",30,0)
 D PRINTQ,^%ZISC
"RTN","TIUEPRNT",31,0)
PRINT1X ; Exit single document print
"RTN","TIUEPRNT",32,0)
 Q
"RTN","TIUEPRNT",33,0)
PRINTQ ; Entry point for queued single document print
"RTN","TIUEPRNT",34,0)
 D PRNTDOC(TIUPMTHD,.TIUDARR)
"RTN","TIUEPRNT",35,0)
 Q
"RTN","TIUEPRNT",36,0)
PRNTDOC(TIUPMTHD,TIUDARR) ; Print a single document type
"RTN","TIUEPRNT",37,0)
 ; Receives TIUPMTHD & TIUDARR
"RTN","TIUEPRNT",38,0)
 N TIUDA
"RTN","TIUEPRNT",39,0)
 I '+$D(TIUDARR) W !,"No Documents selected." Q
"RTN","TIUEPRNT",40,0)
 M ^TMP("TIUPR",$J)=TIUDARR(TIUPMTHD)
"RTN","TIUEPRNT",41,0)
 I TIUPMTHD']"" D  G PRNTDOCX
"RTN","TIUEPRNT",42,0)
 . W !!,"No Print Method Defined for ",$P(TIUTYP,U,2) H 2
"RTN","TIUEPRNT",43,0)
 X TIUPMTHD
"RTN","TIUEPRNT",44,0)
PRNTDOCX ; Exit single document type print
"RTN","TIUEPRNT",45,0)
 K ^TMP("TIUPR",$J)
"RTN","TIUEPRNT",46,0)
 Q
"RTN","TIULC")
0^5^B28717551
"RTN","TIULC",1,0)
TIULC ; SLC/JER - Computational functions ;8/23/04
"RTN","TIULC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,9,19,23,53,93,109,182**;Jun 20, 1997
"RTN","TIULC",3,0)
LINECNT(DA) ; Compute line count for document record
"RTN","TIULC",4,0)
 N CPL,CCNT S CPL=$S(+$P($G(TIUPRM0),U,3)>0:$P(TIUPRM0,U,3),1:60)
"RTN","TIULC",5,0)
 Q $$CHARCNT(DA)\CPL
"RTN","TIULC",6,0)
CHARCNT(DA) ; Compute character count for a record
"RTN","TIULC",7,0)
 N TIUI
"RTN","TIULC",8,0)
 N:'$D(CCNT) CCNT ; Character count is static
"RTN","TIULC",9,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925,DA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIULC",10,0)
 . S CCNT=+$G(CCNT)+$L($$STRIP^TIULS(^TIU(8925,DA,"TEXT",TIUI,0)))
"RTN","TIULC",11,0)
 S TIUI=0
"RTN","TIULC",12,0)
 F  S TIUI=$O(^TIU(8925,"DAD",DA,TIUI)) Q:+TIUI'>0!+$$ISADDNDM^TIULC1(+TIUI)  S CCNT=$$CHARCNT(TIUI)
"RTN","TIULC",13,0)
 Q +$G(CCNT)
"RTN","TIULC",14,0)
STATUS(DA) ; Evaluate Status of Reports
"RTN","TIULC",15,0)
 N NODE12,NODE13,NODE15,NODE16,AMENDED,STATUS,SIGNED,COSIGNED,PURGED
"RTN","TIULC",16,0)
 N VERIFIED,RELEASED,SIGNER,COSIGNER,SIGSTAT,TYPE,REQVER,REQREL,REQCOS
"RTN","TIULC",17,0)
 N DELETED,TIUDPARM,ADMINCL
"RTN","TIULC",18,0)
 S STATUS=""
"RTN","TIULC",19,0)
 S TYPE=$S($D(TIUTYP(1)):$P(TIUTYP(1),U,2),1:+$G(^TIU(8925,+DA,0)))
"RTN","TIULC",20,0)
 D DOCPRM^TIULC1(TYPE,.TIUDPARM,DA)
"RTN","TIULC",21,0)
 S REQVER=$$REQVER(+DA,+$P($G(TIUDPARM(0)),U,3))
"RTN","TIULC",22,0)
 S REQREL=+$P($G(TIUDPARM(0)),U,2)
"RTN","TIULC",23,0)
 S NODE12=$G(^TIU(8925,+DA,12)),NODE13=$G(^TIU(8925,+DA,13))
"RTN","TIULC",24,0)
 S NODE15=$G(^TIU(8925,+DA,15)),NODE16=$G(^TIU(8925,+DA,16))
"RTN","TIULC",25,0)
 S SIGNED=+$P(NODE15,U),COSIGNED=+$P(NODE15,U,7),REQCOS=+$P(NODE15,U,6)
"RTN","TIULC",26,0)
 S SIGNER=+$P(NODE12,U,2),COSIGNER=+$P(NODE12,U,4)
"RTN","TIULC",27,0)
 S ADMINCL=+$P(NODE16,U,6) ;P182
"RTN","TIULC",28,0)
 S AMENDED=+$P(NODE16,U),PURGED=+$P(NODE16,U,9),DELETED=+$P(NODE16,U,11)
"RTN","TIULC",29,0)
 S RELEASED=+$P(NODE13,U,4),VERIFIED=+$P(NODE13,U,5)
"RTN","TIULC",30,0)
 I PURGED S STATUS="purged" G STATUSX
"RTN","TIULC",31,0)
 I DELETED S STATUS="deleted" G STATUSX
"RTN","TIULC",32,0)
 I AMENDED S STATUS="amended" G STATUSX
"RTN","TIULC",33,0)
 I +$$ISA^TIULX(+TYPE,+$$CLASS^TIUCP),'SIGNER S STATUS="undictated" G STATUSX
"RTN","TIULC",34,0)
 I '+NODE12,+NODE13 S STATUS="untranscribed" G STATUSX
"RTN","TIULC",35,0)
 I REQREL,'RELEASED S STATUS="unreleased" G STATUSX
"RTN","TIULC",36,0)
 I REQVER,'VERIFIED S STATUS="unverified" G STATUSX
"RTN","TIULC",37,0)
 I SIGNED,$S('REQCOS:1,COSIGNED:1,1:0) S STATUS="completed" G STATUSX
"RTN","TIULC",38,0)
 I ADMINCL S STATUS="completed" G STATUSX
"RTN","TIULC",39,0)
 I 'SIGNED S STATUS="unsigned" G STATUSX
"RTN","TIULC",40,0)
 I REQCOS,'COSIGNED S STATUS="uncosigned"
"RTN","TIULC",41,0)
STATUSX Q STATUS
"RTN","TIULC",42,0)
REQVER(TIUDA,TIUVPRM) ; Evaluate conditions of verification requirement
"RTN","TIULC",43,0)
 N TIUD0,TIUD13,TIUD15,TIUY
"RTN","TIULC",44,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD13=$G(^(13)),TIUD15=$G(^(15))
"RTN","TIULC",45,0)
 I +$G(TIUVPRM)'>0!(+$P(TIUD13,U,5)>0) S TIUY=0 G REQVX
"RTN","TIULC",46,0)
 I +$G(TIUVPRM)>0,+$G(TIUD15) S TIUY=0 G REQVX
"RTN","TIULC",47,0)
 I +$G(TIUVPRM)=1 S TIUY=1 G REQVX
"RTN","TIULC",48,0)
 I +$G(TIUVPRM)=2,($P(TIUD13,U,3)="U") S TIUY=1 G REQVX
"RTN","TIULC",49,0)
 I +$G(TIUVPRM)=3,($P(TIUD13,U,3)="D") S TIUY=1
"RTN","TIULC",50,0)
REQVX Q +$G(TIUY)
"RTN","TIULC",51,0)
PRCDNC(DA,SCREEN) ; Determine sort precedence of each record
"RTN","TIULC",52,0)
 N SIGNED,URGENCY
"RTN","TIULC",53,0)
 S URGENCY=$P($G(^TIU(8925,+DA,0)),U,9)
"RTN","TIULC",54,0)
 I +$$SIGNED(DA,.SCREEN)'>0 S Y=$S(URGENCY="P":1,1:2)
"RTN","TIULC",55,0)
 E  S Y=3
"RTN","TIULC",56,0)
 Q Y
"RTN","TIULC",57,0)
PURGE(TIUDA) ; Checks whether or not a given Document should be purged
"RTN","TIULC",58,0)
 N TIUEDT,TIUY S TIUY=0
"RTN","TIULC",59,0)
 ; if parameters not in symbol table, get them
"RTN","TIULC",60,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIULC",61,0)
 ; exit if no Archive/purge grace period defined
"RTN","TIULC",62,0)
 I +$P(TIUPRM0,U,4)'>0 G PURGEX
"RTN","TIULC",63,0)
 S TIUEDT=$P($G(^TIU(8925,TIUDA,12)),U)
"RTN","TIULC",64,0)
 I +TIUEDT'>0 G PURGEX ;Transcription date blank
"RTN","TIULC",65,0)
 I +$$ISPN^TIULX(+$G(^TIU(8925,+TIUDA,0))) G PURGEX ; PN's exempt
"RTN","TIULC",66,0)
 I +$$ISADDNDM^TIULC1(+TIUDA),+$$ISPN^TIULX(+$G(^TIU(8925,+$P(^TIU(8925,+TIUDA,0),U,6),0))) G PURGEX ; Addenda to Progress Notes exempt
"RTN","TIULC",67,0)
 I +$P($G(^TIU(8925,+TIUDA,0)),U,5)<7 G PURGEX ;Incomplete--don't purge
"RTN","TIULC",68,0)
 I +$P($G(^TIU(8925,TIUDA,16)),U,4)>0 G PURGEX ;Document already purged
"RTN","TIULC",69,0)
 I $$FMDIFF^XLFDT(DT,TIUEDT)>+$P(TIUPRM0,U,4) S TIUY=1
"RTN","TIULC",70,0)
PURGEX Q TIUY
"RTN","TIULC",71,0)
OVERDUE(TIUDA) ; Checks whether or not a given document is overdue
"RTN","TIULC",72,0)
 N TIUD0,TIUDATE,TIUY,TIUDPRM S TIUY=0,TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIULC",73,0)
 ; if parameters not in symbol table, get them
"RTN","TIULC",74,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIULC",75,0)
 D DOCPRM^TIULC1(+TIUD0,.TIUDPRM,TIUDA)
"RTN","TIULC",76,0)
 ; exit if no signature grace period defined
"RTN","TIULC",77,0)
 I +$P(TIUPRM0,U,5)'>0 G OVERX
"RTN","TIULC",78,0)
 I '$D(TIUDPRM) G OVERX
"RTN","TIULC",79,0)
 S TIUDATE=$S($$REQVER(TIUDA,+$P(TIUDPRM(0),U,3)):$P($G(^TIU(8925,+TIUDA,13)),U,5),$P(TIUDPRM(0),U,2):$P($G(^TIU(8925,+TIUDA,13)),U,4),1:$P($G(^TIU(8925,+TIUDA,12)),U))
"RTN","TIULC",80,0)
 G:+TIUDATE'>0 OVERX
"RTN","TIULC",81,0)
 I $$FMDIFF^XLFDT(DT,TIUDATE)>$P(TIUPRM0,U,5),(+$P($G(^TIU(8925,+TIUDA,0)),U,5)>4),(+$P($G(^TIU(8925,+TIUDA,0)),U,5)<7) S TIUY=1
"RTN","TIULC",82,0)
OVERX Q TIUY
"RTN","TIULC",83,0)
NOW() ; Extrinsic function returning current date/time to nearest .01 second
"RTN","TIULC",84,0)
 N %,%H,%I,X
"RTN","TIULC",85,0)
 D NOW^%DTC
"RTN","TIULC",86,0)
 Q %
"RTN","TIULC",87,0)
IDATE(X) ; Recieves date in external format, returns internal format
"RTN","TIULC",88,0)
 N %DT,Y
"RTN","TIULC",89,0)
 I ($L(X," ")=2),(X?1.2N1P1.2N1P1.2N1" "1.2N.E) S X=$TR(X," ","@")
"RTN","TIULC",90,0)
 S %DT="TSP" D ^%DT
"RTN","TIULC",91,0)
 Q Y
"RTN","TIULC",92,0)
SIGNED(TIUDA,SCREEN) ; Check whether document requires signature or
"RTN","TIULC",93,0)
 ; cosignature on user-sensitive basis
"RTN","TIULC",94,0)
 N Y S Y=0 ; Initialize return value to FALSE
"RTN","TIULC",95,0)
 ; If archived/purged return TRUE
"RTN","TIULC",96,0)
 I +$P($G(^TIU(8925,+TIUDA,16)),U,9) S Y=1 G SIGNEDX
"RTN","TIULC",97,0)
 ; If OPTION is Act on MY Unsigned Documents, check
"RTN","TIULC",98,0)
 ; whether his/her signature is present
"RTN","TIULC",99,0)
 I $P($G(SCREEN(1)),U)="AAU",($P($G(SCREEN(2)),U)="ASUP") D  G SIGNEDX
"RTN","TIULC",100,0)
 . ; If dictated by user and signed return TRUE
"RTN","TIULC",101,0)
 . I $P($G(^TIU(8925,+TIUDA,12)),U,4)=DUZ,(+$P($G(^(15)),U)>0) S Y=1
"RTN","TIULC",102,0)
 . ; If user is Expected Cosigner and cosigned, return TRUE
"RTN","TIULC",103,0)
 . I $P($G(^TIU(8925,+TIUDA,12)),U,8)=DUZ,(+$P($G(^(15)),U,7)>0) S Y=1
"RTN","TIULC",104,0)
 ; Otherwise check search criteria to determine signature status
"RTN","TIULC",105,0)
 I $P($G(SCREEN(1)),U)="AAU",+$P($G(^TIU(8925,+TIUDA,15)),U) S Y=1 G SIGNEDX
"RTN","TIULC",106,0)
 I $P($G(SCREEN(1)),U)="ASUP",+$P($G(^TIU(8925,+TIUDA,15)),U,7) S Y=1 G SIGNEDX
"RTN","TIULC",107,0)
 I +$P($G(^TIU(8925,+TIUDA,15)),U),+$P($G(^(15)),U,7) S Y=1
"RTN","TIULC",108,0)
SIGNEDX Q Y
"RTN","TIULC",109,0)
BLANK(TIUDA) ; Reads a given document for blank lines
"RTN","TIULC",110,0)
 ; Returns: 1:Record contains 1 or more blanks
"RTN","TIULC",111,0)
 ;          0:Record contains no blanks
"RTN","TIULC",112,0)
 N BLANK,TIUI,Y S (TIUI,Y)=0
"RTN","TIULC",113,0)
 I '$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIULC",114,0)
 I $P($G(TIUPRM1),U,6)']"" G BLANKX
"RTN","TIULC",115,0)
 S BLANK=$P(TIUPRM1,U,6)
"RTN","TIULC",116,0)
 F  S TIUI=$O(^TIU(8925,TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIULC",117,0)
 . I $G(^TIU(8925,TIUDA,"TEXT",TIUI,0))[BLANK S Y=1
"RTN","TIULC",118,0)
BLANKX Q Y
"RTN","TIULC",119,0)
CHKSUM(TIUROOT,TIUY) ; Calculates checksum for a record
"RTN","TIULC",120,0)
 N TIUI,X S TIUI=0,TIUY=+$G(TIUY)
"RTN","TIULC",121,0)
 F  S TIUI=$O(@TIUROOT@(TIUI)) Q:+TIUI'>0  D
"RTN","TIULC",122,0)
 . S X=$G(@TIUROOT@(TIUI,0))
"RTN","TIULC",123,0)
 . N TIUJ
"RTN","TIULC",124,0)
 . F TIUJ=1:1:$L(X) S TIUY=+$G(TIUY)+(($A(X,TIUJ)*TIUI)*TIUJ)
"RTN","TIULC",125,0)
 S TIUI=0
"RTN","TIULC",126,0)
 F  S TIUI=$O(^TIU(8925,"DAD",+$P(TIUROOT,",",2),TIUI)) Q:+TIUI'>0  D
"RTN","TIULC",127,0)
 . I +$$ISADDNDM^TIULC1(+TIUI) Q
"RTN","TIULC",128,0)
 . S TIUY=+$G(TIUY)+$$CHKSUM("^TIU(8925,"_+TIUI_",""TEXT"")",TIUY)
"RTN","TIULC",129,0)
 Q +$G(TIUY)
"RTN","TIULP")
0^19^B42061138
"RTN","TIULP",1,0)
TIULP ; SLC/JER - Functions determining privilege ;1/4/05
"RTN","TIULP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**98,100,116,109,138,152,175,157,182**;Jun 20, 1997
"RTN","TIULP",3,0)
CANDO(TIUDA,TIUACT,PERSON) ; Can PERSON perform action now
"RTN","TIULP",4,0)
 ; Receives: TIUDA=Record number in file 8925
"RTN","TIULP",5,0)
 ;           TIUACT=Name of user action in 8930.8 (USR ACTION)
"RTN","TIULP",6,0)
 ;           PERSON=New Person file IFN.
"RTN","TIULP",7,0)
 ;                  Assumed to be DUZ if not received.
"RTN","TIULP",8,0)
 ;                  New **100** ID param, backward compatible.
"RTN","TIULP",9,0)
 ;  Returns:   TIUY=1:yes,0:no_"^"_why not message
"RTN","TIULP",10,0)
 N TIUI,TIUTYP,TIUROLE,STATUS,TIUY,TIUATYP,MSG,WHO,MODIFIER,TIUD0
"RTN","TIULP",11,0)
 S TIUY=0 I '$G(PERSON) S PERSON=DUZ
"RTN","TIULP",12,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)) I 'TIUD0 G CANDOX
"RTN","TIULP",13,0)
 ;**100** was I +TIUACT'>0 S TIUACT etc.
"RTN","TIULP",14,0)
 S TIUACT=$$USREVNT(TIUACT) I +TIUACT'>0 G CANDOX
"RTN","TIULP",15,0)
 ; -- Historical Procedures - Prohibit actions detailed in
"RTN","TIULP",16,0)
 ;    HPCAN^TIUCP: P182
"RTN","TIULP",17,0)
 N HPCAN I $$ISHISTCP^TIUCP(+TIUD0) S HPCAN=$$HPCAN^TIUCP(+TIUACT) I 'HPCAN S TIUY=HPCAN G CANDOX
"RTN","TIULP",18,0)
 ; **152 Get status to evaluate for completed document.
"RTN","TIULP",19,0)
 S STATUS=+$P(TIUD0,U,5)
"RTN","TIULP",20,0)
 ; **152 prevents editing or sending back a completed document.
"RTN","TIULP",21,0)
 I STATUS>6,(+TIUACT=9)!(+TIUACT=17) D  G CANDOX
"RTN","TIULP",22,0)
 .; **152 Displays message to user
"RTN","TIULP",23,0)
 . I +TIUACT=9 S TIUY="0^ You may not edit a completed document."
"RTN","TIULP",24,0)
 . I +TIUACT=17 S TIUY="0^You may not send back this completed document."
"RTN","TIULP",25,0)
 ; -- In case business rules have changed, & children already existed:
"RTN","TIULP",26,0)
 I +TIUACT=24,$D(^TIU(8925,"GDAD",TIUDA)) D  G CANDOX
"RTN","TIULP",27,0)
 . S TIUY="0^ This note cannot be attached; it has its own children."
"RTN","TIULP",28,0)
 I +TIUACT=25,+$G(^TIU(8925,TIUDA,21)) D  G CANDOX
"RTN","TIULP",29,0)
 . S TIUY="0^ This note cannot receive interdisciplinary children; it is itself a child."
"RTN","TIULP",30,0)
 I +TIUACT=4!(+TIUACT=5),+$$BLANK^TIULC(TIUDA) D  G CANDOX
"RTN","TIULP",31,0)
 . S TIUY="0^ Contains blanks ("_$P(TIUPRM1,U,6)_") which must be filled before "_$P(TIUACT,U,2)_"ATURE."
"RTN","TIULP",32,0)
 S TIUROLE=$$USRROLE(TIUDA,PERSON)
"RTN","TIULP",33,0)
 S TIUTYP=+TIUD0
"RTN","TIULP",34,0)
 I $$ISADDNDM^TIULC1(+TIUDA) S TIUATYP=TIUTYP,TIUTYP=+$G(^TIU(8925,+$P(TIUD0,U,6),0))
"RTN","TIULP",35,0)
 I TIUROLE']"" S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,PERSON)
"RTN","TIULP",36,0)
 F TIUI=1:1:($L(TIUROLE,U)-1) D  Q:+$G(TIUY)>0
"RTN","TIULP",37,0)
 . S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,PERSON,$P(TIUROLE,U,TIUI))
"RTN","TIULP",38,0)
 I +$G(TIUATYP) S TIUTYP=+$G(TIUATYP)
"RTN","TIULP",39,0)
 ;**100** update for PERSON param; update for verb modifier:
"RTN","TIULP",40,0)
 I +TIUY'>0 D  G CANDOX
"RTN","TIULP",41,0)
 . S WHO=" You"
"RTN","TIULP",42,0)
 . ;I PERSON'=DUZ S WHO=$P(^VA(200,PERSON,0),U),WHO=$$NAME^TIULS(WHO,"FIRST LAST")
"RTN","TIULP",43,0)
 . I PERSON'=DUZ S WHO=$$NAME^TIULS($$GET1^DIQ(200,PERSON,.01),"FIRST LAST") ;P182
"RTN","TIULP",44,0)
 . S MODIFIER=$P(TIUACT,U,3) I $L(MODIFIER) S MODIFIER=" "_MODIFIER
"RTN","TIULP",45,0)
 . ;e.g. "You may not ATTACH this UNSIGNED TELEPHONE NOTE TO AN ID NOTE."
"RTN","TIULP",46,0)
 . S MSG=WHO_" may not "_$P(TIUACT,U,2)_" this "_$P($G(^TIU(8925.6,+STATUS,0)),U)_" "_$$PNAME^TIULC1(TIUTYP)_MODIFIER_"."
"RTN","TIULP",47,0)
 . S TIUY=TIUY_U_MSG
"RTN","TIULP",48,0)
 I +TIUACT=15,$$HASIMG^TIURB2(+TIUDA) D  G CANDOX
"RTN","TIULP",49,0)
 . S TIUY="0^ This document contains linked images. You must ""delete"" the Images using the Imaging package before proceeding."
"RTN","TIULP",50,0)
CANDOX Q TIUY
"RTN","TIULP",51,0)
 ;
"RTN","TIULP",52,0)
CANLINK(TIUTYP) ; Can user (DUZ) link (attach) a document of a particular type
"RTN","TIULP",53,0)
 ;to an ID note.
"RTN","TIULP",54,0)
 ; For use in ADD NEW ID NOTE, where docmt is not entered yet.
"RTN","TIULP",55,0)
 ; Assume most favorable circumstances (user will complete
"RTN","TIULP",56,0)
 ;the note, so if user still can't attach, can tell them no,
"RTN","TIULP",57,0)
 ;when they first select title for the new entry.
"RTN","TIULP",58,0)
 ; Rule out if TIUTYP can be an ID parent, since ID parent
"RTN","TIULP",59,0)
 ;and ID kid function as mutually exclusive, (regardless of
"RTN","TIULP",60,0)
 ;business rules).
"RTN","TIULP",61,0)
 N TIUACT,STATUS,USRROLE,TIUY
"RTN","TIULP",62,0)
 S TIUACT=$$USREVNT("ATTACH TO ID NOTE"),STATUS=7 ; complete
"RTN","TIULP",63,0)
 S USRROLE=+$O(^USR(8930.2,"B","COMPLETER",0))
"RTN","TIULP",64,0)
 S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,DUZ,USRROLE)
"RTN","TIULP",65,0)
 I '$G(TIUY) S TIUY="0^ You may not use this title for interdisciplinary child entries." Q TIUY
"RTN","TIULP",66,0)
 ; -- If user can attach a certain note, but note can also receive
"RTN","TIULP",67,0)
 ;    ID entries, don't let user attach it. --
"RTN","TIULP",68,0)
 I $$POSSPRNT^TIULP(TIUTYP) S TIUY="0^ This interdisciplinary PARENT title cannot be used for CHILD entries."
"RTN","TIULP",69,0)
 ; -- If selected type is a CWAD, don't let user attach it: --
"RTN","TIULP",70,0)
 I $$ISCWAD^TIULX(TIUTYP) S TIUY="0^ CWAD titles cannot be used for interdisciplinary entries."
"RTN","TIULP",71,0)
 ; -- If selected type is a consult, don't let user attach it: --
"RTN","TIULP",72,0)
 I $$ISA^TIULX(TIUTYP,+$$CLASS^TIUCNSLT) S TIUY="0^ Consult titles cannot be used for interdisciplinary entries."
"RTN","TIULP",73,0)
 Q TIUY
"RTN","TIULP",74,0)
 ;
"RTN","TIULP",75,0)
POSSPRNT(TIUTYP) ; Is a docmt intended as a possible ID parent?
"RTN","TIULP",76,0)
 ;Returns 1^WHYCAN'TATTACH if there are business rules permitting ANYONE
"RTN","TIULP",77,0)
 ;to attach ID entries to notes of type TIUTYP.
"RTN","TIULP",78,0)
 ;Else returns 0.
"RTN","TIULP",79,0)
 N TIUACT,STATUS,TIUY,DADTYP
"RTN","TIULP",80,0)
 S TIUY=0,TIUACT=+$$USREVNT("ATTACH ID ENTRY")
"RTN","TIULP",81,0)
 F STATUS=6,7,8 D  G:TIUY POSSX
"RTN","TIULP",82,0)
 . I $O(^USR(8930.1,"AR",TIUTYP,STATUS,TIUACT,0)) S TIUY=1 Q
"RTN","TIULP",83,0)
 . I $O(^USR(8930.1,"AC",TIUTYP,STATUS,TIUACT,0)) S TIUY=1
"RTN","TIULP",84,0)
 ; -- If no rules for TIUTYP, try its parent: --
"RTN","TIULP",85,0)
 S DADTYP=$O(^TIU(8925.1,"AD",TIUTYP,0)) G:DADTYP'>0 POSSX
"RTN","TIULP",86,0)
 S TIUY=$$POSSPRNT(DADTYP)
"RTN","TIULP",87,0)
POSSX I TIUY S TIUY="1^ Interdisciplinary PARENT notes cannot be attached as CHILD entries."
"RTN","TIULP",88,0)
 Q TIUY
"RTN","TIULP",89,0)
 ;
"RTN","TIULP",90,0)
CANENTR(TIUTYP) ; Evaluate privilege to enter a document of a particular type
"RTN","TIULP",91,0)
 N TIUACT,STATUS,USRROLE,TIUY
"RTN","TIULP",92,0)
 S TIUACT=$$USREVNT("ENTRY"),STATUS=2 ; untranscribed
"RTN","TIULP",93,0)
 S USRROLE=3 ; transcriber
"RTN","TIULP",94,0)
 S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,DUZ,USRROLE)
"RTN","TIULP",95,0)
 Q TIUY
"RTN","TIULP",96,0)
USRROLE(TIUDA,PERSON) ; Identify the user's role with respect to the document
"RTN","TIULP",97,0)
 ; 3/20/00 **100** Added role COMPLETER
"RTN","TIULP",98,0)
 ; 3/20/00 **100** Added PERSON param
"RTN","TIULP",99,0)
 N TIU0,TIU12,TIU13,TIUY,TIU15,COMPLTR,STATUS
"RTN","TIULP",100,0)
 S PERSON=$G(PERSON,DUZ)
"RTN","TIULP",101,0)
 S TIU0=$G(^TIU(8925,+TIUDA,0)),STATUS=$P(TIU0,U,5)
"RTN","TIULP",102,0)
 S TIU12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIULP",103,0)
 S TIU13=$G(^TIU(8925,+TIUDA,13)),TIU15=$G(^TIU(8925,+TIUDA,15))
"RTN","TIULP",104,0)
 I PERSON=+$P(TIU13,U,2) S TIUY=+$O(^USR(8930.2,"B","TRANSCRIBER",0))_U
"RTN","TIULP",105,0)
 I PERSON=+$P(TIU12,U,2) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","AUTHOR/DICTATOR",0))_U
"RTN","TIULP",106,0)
 I PERSON=+$P(TIU12,U,9) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","ATTENDING PHYSICIAN",0))_U
"RTN","TIULP",107,0)
 I PERSON=+$P(TIU12,U,4) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","EXPECTED SIGNER",0))_U
"RTN","TIULP",108,0)
 I PERSON=+$P(TIU12,U,8) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","EXPECTED COSIGNER",0))_U
"RTN","TIULP",109,0)
 I $$ASURG^TIUADSIG(TIUDA) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","SURROGATE",0))_U ;P157
"RTN","TIULP",110,0)
 ;Check if the person can be an Interpreter for this document via a Consult API
"RTN","TIULP",111,0)
 I $$CPINTERP^GMRCCP(+TIUDA,PERSON) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","INTERPRETER",0))_U
"RTN","TIULP",112,0)
 I STATUS>6 D  I COMPLTR S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","COMPLETER",0))_U
"RTN","TIULP",113,0)
 . S COMPLTR=0
"RTN","TIULP",114,0)
 . I PERSON=+$P(TIU15,U,8) S COMPLTR=1 Q
"RTN","TIULP",115,0)
 . I '$P(TIU15,U,8),PERSON=+$P(TIU15,U,2) S COMPLTR=1
"RTN","TIULP",116,0)
 I +$O(^TIU(8925.7,"AE",+TIUDA,+PERSON,0)) D
"RTN","TIULP",117,0)
 . N TIUXTRA S TIUXTRA=+$O(^TIU(8925.7,"AE",+TIUDA,+PERSON,0))
"RTN","TIULP",118,0)
 . I +$P($G(^TIU(8925.7,+TIUXTRA,0)),U,4) Q
"RTN","TIULP",119,0)
 . S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","ADDITIONAL SIGNER",0))_U
"RTN","TIULP",120,0)
 Q $G(TIUY)
"RTN","TIULP",121,0)
USREVNT(EVENT) ; Given event name, return:
"RTN","TIULP",122,0)
 ;EVENT = event pointer^user verb^verb modifier
"RTN","TIULP",123,0)
 ; **100** added verb modifier piece (.07)
"RTN","TIULP",124,0)
 N TIUY,TIUDA,NODE0
"RTN","TIULP",125,0)
 S TIUDA=+$O(^USR(8930.8,"B",EVENT,0))
"RTN","TIULP",126,0)
 S NODE0=$G(^USR(8930.8,TIUDA,0))
"RTN","TIULP",127,0)
 S TIUY=TIUDA_U_$P(NODE0,U,5)_U_$P(NODE0,U,7)
"RTN","TIULP",128,0)
 Q TIUY
"RTN","TIULP",129,0)
CANPICK(TIUTYP) ; Screens selection of title by title status and
"RTN","TIULP",130,0)
 ;(for status TEST), by owner.
"RTN","TIULP",131,0)
 N TIUPOWN,TIUCOWN,TIUT0,TIUTSTAT,TIUY S TIUY=0
"RTN","TIULP",132,0)
 S TIUT0=$G(^TIU(8925.1,+TIUTYP,0)),TIUTSTAT=$P(TIUT0,U,7)
"RTN","TIULP",133,0)
 I TIUTSTAT']"" S TIUY=0 G CANPIX
"RTN","TIULP",134,0)
 I TIUTSTAT=13 S TIUY=0 G CANPIX
"RTN","TIULP",135,0)
 I TIUTSTAT=11 S TIUY=1 G CANPIX
"RTN","TIULP",136,0)
 S TIUPOWN=$P(TIUT0,U,5),TIUCOWN=+$P(TIUT0,U,6)
"RTN","TIULP",137,0)
 I TIUTSTAT=10 S TIUY=$S(TIUPOWN=DUZ:1,+$$ISA^USRLM(DUZ,TIUCOWN):1,1:0)
"RTN","TIULP",138,0)
CANPIX Q +$G(TIUY)
"RTN","TIULP",139,0)
REQCOSIG(TIUTYP,TIUDA,USER,TIUDT) ; Evaluate whether user requires cosignature
"RTN","TIULP",140,0)
 N TIUI,TIUY,TIUDPRM S USER=$S(+$G(USER):+$G(USER),1:+$G(DUZ))
"RTN","TIULP",141,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,+$G(TIUDA))
"RTN","TIULP",142,0)
 I $G(TIUDPRM(5))="" G REQCOSX
"RTN","TIULP",143,0)
 I +$G(TIUDT)'>0 S TIUDT=+$P($P(+$G(^TIU(8925,+$G(TIUDA),13)),U),".")
"RTN","TIULP",144,0)
 F TIUI=1:1:$L(TIUDPRM(5),U) D  Q:+TIUY>0
"RTN","TIULP",145,0)
 . S TIUY=+$$ISA^USRLM(+USER,+$P(TIUDPRM(5),U,TIUI),,+$G(TIUDT))
"RTN","TIULP",146,0)
REQCOSX Q +$G(TIUY)
"RTN","TIULP",147,0)
 ;
"RTN","TIULP",148,0)
REQCPF(TIUCDA) ;Check if clinical procedure fields are required
"RTN","TIULP",149,0)
 ; Input  -- TIUCDA   Request/Consult File (#123) IEN
"RTN","TIULP",150,0)
 ; Output -- 1=Required and 0=Not Required
"RTN","TIULP",151,0)
 N TIUCPACT,REQF
"RTN","TIULP",152,0)
 I '$G(TIUCDA) G REQCPFQ
"RTN","TIULP",153,0)
 S TIUCPACT=$$CPACTM^GMRCCP(TIUCDA)
"RTN","TIULP",154,0)
 I TIUCPACT=1!(TIUCPACT=3) S REQF=1
"RTN","TIULP",155,0)
REQCPFQ Q +$G(REQF)
"RTN","TIUPD")
0^6^B24253849
"RTN","TIUPD",1,0)
TIUPD ; SLC/JER - Background Print Driver ;5/3/04
"RTN","TIUPD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,89,100,182**;Jun 20, 1997
"RTN","TIUPD",3,0)
MAIN(DA,TIUACT) ; Control Branching
"RTN","TIUPD",4,0)
 ;  TIUACT=R ==> Release from transcription,
"RTN","TIUPD",5,0)
 ;         V ==> Verified by MAS,
"RTN","TIUPD",6,0)
 ;         A ==> AMENDED by Privacy Act Officer
"RTN","TIUPD",7,0)
 ;         S ==> On completion by electronic signature by appropriate
"RTN","TIUPD",8,0)
 ;               person (i.e., author or expected cosigner)
"RTN","TIUPD",9,0)
 ; TIUSTAT=1 ==> STAT urgency,
"RTN","TIUPD",10,0)
 ;   TIURP=routine print event(s)
"RTN","TIUPD",11,0)
 ;   TIUSP=stat print event(s)
"RTN","TIUPD",12,0)
 N TIUSTAT,TIURP,TIUSP,TIUDPARM
"RTN","TIUPD",13,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,+DA,0)),.TIUDPARM,+DA)
"RTN","TIUPD",14,0)
 Q:+$P($G(TIUDPARM(0)),U,8)>0!(+$G(TIUDPARM(0))'>0)
"RTN","TIUPD",15,0)
 Q:$G(TIUACT)=""!("ARVS"'[TIUACT)!(+$G(DA)'>0)
"RTN","TIUPD",16,0)
 S:$P($G(^TIU(8925,+DA,0)),U,9)="P" TIUSTAT=1
"RTN","TIUPD",17,0)
 S TIURP=$P($G(TIUDPARM(0)),U,6),TIUSP=$P($G(TIUDPARM(0)),U,7)
"RTN","TIUPD",18,0)
 I TIUACT="S" D TSKPRINT(DA,2,"",.TIUDPARM) Q
"RTN","TIUPD",19,0)
 I TIUACT="A" D TSKPRINT(DA,1,"",.TIUDPARM) Q
"RTN","TIUPD",20,0)
 I TIUACT="V",TIUSP]"","VB"[TIUSP D TSKPRINT(DA,1,"",.TIUDPARM) Q
"RTN","TIUPD",21,0)
 I +$G(TIUSTAT) D  ;STAT Document processing
"RTN","TIUPD",22,0)
 . I TIUACT="R",TIUSP]"","RB"[TIUSP D TSKPRINT(DA,1,TIUSTAT,.TIUDPARM) Q
"RTN","TIUPD",23,0)
 . I TIUACT="V",TIUSP]"","VB"[TIUSP D TSKPRINT(DA,1,"",.TIUDPARM) Q
"RTN","TIUPD",24,0)
 E  D  ;Non-stat Document processing
"RTN","TIUPD",25,0)
 . I TIUACT="R",TIURP]"","RB"[TIURP D TSKPRINT(DA,1,"",.TIUDPARM) Q
"RTN","TIUPD",26,0)
 . I TIUACT="V",TIURP]"","VB"[TIURP D TSKPRINT(DA,1,"",.TIUDPARM) Q
"RTN","TIUPD",27,0)
 Q
"RTN","TIUPD",28,0)
RPC(TIUY,TIUDA,TIUIO,TIUFLAG,TIUWIN) ; Remote Procedure to print a record
"RTN","TIUPD",29,0)
 ;TIUFLAG > 1 Chart Copy, TIUFLAG = 2 Electronically signed Chart Copy
"RTN","TIUPD",30,0)
 ;TIUWIN = 1 Windows printer, 0 or "" VistA printer
"RTN","TIUPD",31,0)
 N DFN,TIUD0,TIUX,ZTIO,ZTDTH,ZTRTN,ZTSK,ZTDESC,TIUTYPE,TIUPMTHD,TIUTNM
"RTN","TIUPD",32,0)
 N TIUDATE,TIUPFHDR,TIUPFNBR,TIUPGRP,TIUD13,TIUD15,TIUIDDAD
"RTN","TIUPD",33,0)
 K ^TMP("TIUPR",$J)
"RTN","TIUPD",34,0)
 I '$D(^TIU(8925,+$G(TIUDA),0)) S TIUY="1^No such record in TIU" Q
"RTN","TIUPD",35,0)
 I $G(TIUIO)']"" S TIUY="1^No device selected" Q
"RTN","TIUPD",36,0)
 ; Get Print Method for the document
"RTN","TIUPD",37,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD13=$G(^TIU(8925,+TIUDA,13))
"RTN","TIUPD",38,0)
 S TIUD15=$G(^TIU(8925,+TIUDA,15)),TIUTYPE=+TIUD0,TIUFLAG=+$G(TIUFLAG)
"RTN","TIUPD",39,0)
 S TIUDATE=$S(+TIUD15>0:+TIUD15,+TIUD13>0:+TIUD13,1:+$G(DT))
"RTN","TIUPD",40,0)
 I '+TIUTYPE Q
"RTN","TIUPD",41,0)
 S DFN=+$P(TIUD0,U,2)
"RTN","TIUPD",42,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYPE)
"RTN","TIUPD",43,0)
 S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYPE,TIUDA)
"RTN","TIUPD",44,0)
 S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYPE,TIUDA)
"RTN","TIUPD",45,0)
 S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYPE,TIUDA)
"RTN","TIUPD",46,0)
 S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYPE,TIUDA)
"RTN","TIUPD",47,0)
 I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=+$P($G(^TIU(8925,+TIUDA,0)),U,6)
"RTN","TIUPD",48,0)
 S TIUIDDAD=$$HASIDDAD^TIUGBR(TIUDA)
"RTN","TIUPD",49,0)
 I TIUIDDAD S TIUDA=TIUIDDAD
"RTN","TIUPD",50,0)
 I $G(TIUPMTHD)']"" S TIUY="1^No Print Method Defined" Q
"RTN","TIUPD",51,0)
 ;I $G(TIUPMTHD)]"",+$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") D
"RTN","TIUPD",52,0)
 ;. S ^TMP("TIUPR",$J,$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_DFN,1,TIUDA)=$G(TIUPFNBR)
"RTN","TIUPD",53,0)
 ;E  S ^TMP("TIUPR",$J,DFN,1,TIUDA)=""
"RTN","TIUPD",54,0)
 ; -- P182: Set array same whether or not flds are defined, with
"RTN","TIUPD",55,0)
 ;    TIUPGRP piece possibly 0, TIUPFHDR piece possibly null, and
"RTN","TIUPD",56,0)
 ;    array value TIUPFNBR possibly null.
"RTN","TIUPD",57,0)
 S ^TMP("TIUPR",$J,+$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_DFN,1,TIUDA)=$G(TIUPFNBR)
"RTN","TIUPD",58,0)
 I +$G(TIUWIN) D
"RTN","TIUPD",59,0)
 . U IO
"RTN","TIUPD",60,0)
 . X TIUPMTHD
"RTN","TIUPD",61,0)
 E  D
"RTN","TIUPD",62,0)
 . S ZTIO=TIUIO,ZTDTH=$H
"RTN","TIUPD",63,0)
 . S ZTDESC=$S(+TIUFLAG:"CHART",1:"WORK")_" copy of "_$$UPPER^TIULS(TIUTNM)
"RTN","TIUPD",64,0)
 . S ZTRTN=$P(TIUPMTHD," ",2),ZTSAVE("^TMP(""TIUPR"",$J,")=""
"RTN","TIUPD",65,0)
 . S ZTSAVE("TIUFLAG")="",ZTSAVE("TIUPRM*")="",ZTSAVE("DUZ(")=""
"RTN","TIUPD",66,0)
 . D ^%ZTLOAD ;K ^TMP("TIUPR",$J,+$P(TIUD0,U,2),1,TIUDA) P182
"RTN","TIUPD",67,0)
 . I $D(ZTSK) S TIUY="0^"_$S(+$G(TIUFLAG):"Chart",1:"Draft")_" copy queued"
"RTN","TIUPD",68,0)
 . E  S TIUY="1^Task Rejected"
"RTN","TIUPD",69,0)
 K ^TMP("TIUPR",$J,+$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_DFN,1,TIUDA) ;P182
"RTN","TIUPD",70,0)
 Q
"RTN","TIUPD",71,0)
TSKPRINT(DA,TIUFLAG,TIUSTAT,TIUDPARM) ;Set up task and do a queued print
"RTN","TIUPD",72,0)
 ;TIUFLAG > 1 Chart Copy, TIUFLAG = 2 Electronically signed Chart Copy
"RTN","TIUPD",73,0)
 ;TIUSTAT > 1 Stat printed at Release, check for Stat Chart Copy Printer
"RTN","TIUPD",74,0)
 N TIUD0,TIUDA,TIUX,ZTIO,ZTDTH,ZTRTN,ZTSK,ZTDESC,TIUTYPE,TIUPMTHD,TIUTNM
"RTN","TIUPD",75,0)
 N TIUDATE,TIUPFHDR,TIUPFNBR,TIUPGRP,TIUD13,TIUD15,TIUIDDAD
"RTN","TIUPD",76,0)
 K ^TMP("TIUPR",$J)
"RTN","TIUPD",77,0)
 I '$D(^TIU(8925,+$G(DA),0)) Q
"RTN","TIUPD",78,0)
 ; Get Print Method for the document
"RTN","TIUPD",79,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD13=$G(^TIU(8925,+DA,13))
"RTN","TIUPD",80,0)
 S TIUD15=$G(^TIU(8925,+DA,15)),TIUTYPE=+TIUD0
"RTN","TIUPD",81,0)
 S TIUDATE=$S(+TIUD15>0:+TIUD15,+TIUD13>0:+TIUD13,1:+$G(DT))
"RTN","TIUPD",82,0)
 I '+TIUTYPE Q
"RTN","TIUPD",83,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYPE)
"RTN","TIUPD",84,0)
 S TIUPMTHD=$P($$PRNTMTHD^TIULG(+TIUTYPE,DA)," ",2)
"RTN","TIUPD",85,0)
 S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYPE,DA)
"RTN","TIUPD",86,0)
 S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYPE,DA)
"RTN","TIUPD",87,0)
 S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYPE,DA)
"RTN","TIUPD",88,0)
 I +$$ISADDNDM^TIULC1(DA) S DA=+$P($G(^TIU(8925,+DA,0)),U,6)
"RTN","TIUPD",89,0)
 S TIUIDDAD=$$HASIDDAD^TIUGBR(DA)
"RTN","TIUPD",90,0)
 I TIUIDDAD S DA=TIUIDDAD
"RTN","TIUPD",91,0)
 I TIUPMTHD']"" Q
"RTN","TIUPD",92,0)
 S ZTIO=$$GETDEV(DA,.TIUDPARM,+$G(TIUSTAT)),ZTDTH=$H
"RTN","TIUPD",93,0)
 I ZTIO']"" K ^TMP("TIUPR",$J) Q
"RTN","TIUPD",94,0)
 S ZTDESC="CHART COPY OF "_$$UPPER^TIULS(TIUTNM)
"RTN","TIUPD",95,0)
 S ZTRTN=TIUPMTHD,ZTSAVE("^TMP(""TIUPR"",$J,")="",ZTSAVE("TIUFLAG")=""
"RTN","TIUPD",96,0)
 S ZTSAVE("TIUPRM*")="",ZTSAVE("DUZ(")=""
"RTN","TIUPD",97,0)
 ;I $G(TIUPMTHD)]"",+$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") D
"RTN","TIUPD",98,0)
 ;. S ^TMP("TIUPR",$J,$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_+$P(TIUD0,U,2),TIUDATE,DA)=$G(TIUPFNBR)
"RTN","TIUPD",99,0)
 ;E  S ^TMP("TIUPR",$J,+$P(TIUD0,U,2),TIUDATE,DA)=""
"RTN","TIUPD",100,0)
 ; -- P182: See RPC
"RTN","TIUPD",101,0)
 S ^TMP("TIUPR",$J,+$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_+$P(TIUD0,U,2),TIUDATE,DA)=$G(TIUPFNBR)
"RTN","TIUPD",102,0)
 D ^%ZTLOAD ;K ^TMP("TIUPR",$J,+$P(TIUD0,U,2),TIUDATE,DA) P182
"RTN","TIUPD",103,0)
 K ^TMP("TIUPR",$J,+$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_+$P(TIUD0,U,2),TIUDATE,DA) ;P182
"RTN","TIUPD",104,0)
 I $D(ZTSK),'$D(XWBOS) W !,$S(+$G(TIUFLAG):"Chart",1:"Draft")," copy queued."
"RTN","TIUPD",105,0)
 Q
"RTN","TIUPD",106,0)
GETDEV(DA,TIUDPARM,TIUSTAT) ; Get Chart copy print device name
"RTN","TIUPD",107,0)
 N DIC,DIQ,DR,X,Y,TIUDPDA,TIUDIV,TIUDEV,TIUI,TIU,TIUY
"RTN","TIUPD",108,0)
 D GETTIU^TIULD(.TIU,+DA)
"RTN","TIUPD",109,0)
 S TIUDPDA=+$O(^TIU(8925.95,"B",+$G(TIUDPARM(0)),0)) I '+TIUDPDA G GETDX
"RTN","TIUPD",110,0)
 S TIUDIV=+$O(^TIU(8925.95,+TIUDPDA,2,"B",+$G(TIU("DIV")),0))
"RTN","TIUPD",111,0)
 I +TIUDIV>0 D
"RTN","TIUPD",112,0)
 . S DIC="^TIU(8925.95,"_TIUDPDA_",2,",DA=+TIUDIV
"RTN","TIUPD",113,0)
 . S DIQ="TIUDEV",DR=".02;.03" D EN^DIQ1
"RTN","TIUPD",114,0)
 . I +$G(TIUSTAT),($G(TIUDEV(8925.952,+DA,.03))]"") S TIUY=$G(TIUDEV(8925.952,+DA,.03))
"RTN","TIUPD",115,0)
 . E  S TIUY=$G(TIUDEV(8925.952,+DA,.02))
"RTN","TIUPD",116,0)
GETDX Q $G(TIUY)
"RTN","TIUPRCN")
0^7^B5982929
"RTN","TIUPRCN",1,0)
TIUPRCN ; SLC/JER - Driver to Print Form 513 Consult Reports ;10/5/04
"RTN","TIUPRCN",2,0)
 ;;1.0;TEXT INTEGRATION UTILITY;**4,182**;Jun 20, 1997
"RTN","TIUPRCN",3,0)
 ; Call to TIUEN^GMRCP513 supported by DBIA 3957
"RTN","TIUPRCN",4,0)
ENTRY ; Entry point to print SF 513
"RTN","TIUPRCN",5,0)
 N TIUERR,TIUI,TIUJ,D0,DN,Y,DTOUT,DUOUT,DIRUT,DIROUT,TIU0,TIU14,TIUINI
"RTN","TIUPRCN",6,0)
 K ^TMP("TIULQ",$J)
"RTN","TIUPRCN",7,0)
 S TIUINI=1 ; Indicate initials only for transcriber
"RTN","TIUPRCN",8,0)
 I $D(ZTQUEUED) S ZTREQ="@" ; Tell TaskMan to delete Task log entry
"RTN","TIUPRCN",9,0)
 U IO
"RTN","TIUPRCN",10,0)
 I '$D(^TMP("TIUPR",$J)) W !,"No Document Record Specified.",$C(7) Q
"RTN","TIUPRCN",11,0)
 ; -- P182 If no Print Group, TIUJ may begin 0$... 
"RTN","TIUPRCN",12,0)
 S TIUJ=0 F  S TIUJ=$O(^TMP("TIUPR",$J,TIUJ)) G:TIUJ="" ENTRYX  D
"RTN","TIUPRCN",13,0)
 . S TIUI=0 F  S TIUI=$O(^TMP("TIUPR",$J,TIUJ,TIUI)) Q:TIUI'>0!$D(DIROUT)  D
"RTN","TIUPRCN",14,0)
 . . N TIUDA,TIUCDA ;P182
"RTN","TIUPRCN",15,0)
 . . S TIUDA=0
"RTN","TIUPRCN",16,0)
 . . F  S TIUDA=+$O(^TMP("TIUPR",$J,TIUJ,TIUI,TIUDA)) Q:+TIUDA'>0!$D(DIROUT)  D
"RTN","TIUPRCN",17,0)
 . . . S TIU0=$G(^TIU(8925,+TIUDA,0)),TIU14=$G(^(14))
"RTN","TIUPRCN",18,0)
 . . . I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=$P(TIU0,U,6)
"RTN","TIUPRCN",19,0)
 . . . S TIUCDA=+$P(TIU14,U,5)
"RTN","TIUPRCN",20,0)
 . . . I +TIUCDA'>0 D  Q
"RTN","TIUPRCN",21,0)
 . . . . ; W !!,"This Consult Result is not associated with a request.",!
"RTN","TIUPRCN",22,0)
 . . . . ; -- If note has no request, print that note only, using
"RTN","TIUPRCN",23,0)
 . . . . ;    PN Print Method (P182):
"RTN","TIUPRCN",24,0)
 . . . . M ^TMP("TIUTMPPR",$J)=^TMP("TIUPR",$J)
"RTN","TIUPRCN",25,0)
 . . . . K ^TMP("TIUPR",$J)
"RTN","TIUPRCN",26,0)
 . . . . S ^TMP("TIUPR",$J,TIUJ,TIUI,TIUDA)=^TMP("TIUTMPPR",$J,TIUJ,TIUI,TIUDA)
"RTN","TIUPRCN",27,0)
 . . . . D ENTRY^TIUPRPN
"RTN","TIUPRCN",28,0)
 . . . . M ^TMP("TIUPR",$J)=^TMP("TIUTMPPR",$J)
"RTN","TIUPRCN",29,0)
 . . . . K ^TMP("TIUTMPPR",$J)
"RTN","TIUPRCN",30,0)
 . . . . ; I $E(IOST)="C-",$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUPRCN",31,0)
 . . . . K ^TMP("TIUPR",$J,TIUJ,TIUI,TIUDA)
"RTN","TIUPRCN",32,0)
 . . . N VALMAR,VALMCNT,VALMPGE
"RTN","TIUPRCN",33,0)
 . . . ; -- Don't repeat if request already printed (P182):
"RTN","TIUPRCN",34,0)
 . . . I '$D(^TMP("TIUPRCDA",$J,TIUCDA)) D TIUEN^GMRCP513(TIUCDA) S ^TMP("TIUPRCDA",$J,TIUCDA)="" I $E(IOST)="C-",$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUPRCN",35,0)
 . . . K ^TMP("TIUPR",$J,TIUJ,TIUI,TIUDA)
"RTN","TIUPRCN",36,0)
ENTRYX ;
"RTN","TIUPRCN",37,0)
 K ^TMP("TIUPRCDA",$J)
"RTN","TIUPRCN",38,0)
 Q
"RTN","TIUPRD")
0^8^B17707406
"RTN","TIUPRD",1,0)
TIUPRD ; SLC/JER - Single patient print ;5/19/04
"RTN","TIUPRD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,100,121,182**;Jun 20, 1997
"RTN","TIUPRD",3,0)
 ;
"RTN","TIUPRD",4,0)
REPLACE(TIUDA) ; Populate TMP array w records received,
"RTN","TIUPRD",5,0)
 ;replacing ID kids w ID parents; replacing addenda with their parents
"RTN","TIUPRD",6,0)
 ;or grandparents.
"RTN","TIUPRD",7,0)
 ; Requires TIUDA. 
"RTN","TIUPRD",8,0)
 ; Sets ^TMP("TIUREPLACE",$J,IFN)=1 or 1^TIUDA, or 0
"RTN","TIUPRD",9,0)
 ;where IFN is TIUDA or parent or grandparent of TIUDA.
"RTN","TIUPRD",10,0)
 ; If TIUDA is replaced, then ^TMP("TIUREPLACE",$J,IFN)=1^TIUDA,
"RTN","TIUPRD",11,0)
 ;to know what child the parent was included in the list for.
"RTN","TIUPRD",12,0)
 ; Sets & passes back ^TMP("TIUREPLACE",$J) = # of elements in array.
"RTN","TIUPRD",13,0)
 N IDPRNT,ADDPRNT,ADDGPNT
"RTN","TIUPRD",14,0)
 S ^TMP("TIUREPLACE",$J)=+$G(^TMP("TIUREPLACE",$J))
"RTN","TIUPRD",15,0)
 S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIUPRD",16,0)
 ; -- If kid has parent that doesn't exist,
"RTN","TIUPRD",17,0)
 ;    treat kid as stand-alone:
"RTN","TIUPRD",18,0)
 I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIUPRD",19,0)
 S ADDPRNT=$P(^TIU(8925,TIUDA,0),U,6)
"RTN","TIUPRD",20,0)
 I ADDPRNT,'$D(^TIU(8925,ADDPRNT,0)) Q
"RTN","TIUPRD",21,0)
 I ADDPRNT S ADDGPNT=+$G(^TIU(8925,ADDPRNT,21))
"RTN","TIUPRD",22,0)
 I $G(ADDGPNT),'$D(^TIU(8925,ADDGPNT,0)) S ADDGPNT=0
"RTN","TIUPRD",23,0)
 ;============================================
"RTN","TIUPRD",24,0)
 ; -- If TIUDA is not an ID kid & not addm, just put it
"RTN","TIUPRD",25,0)
 ;    in array and quit: --
"RTN","TIUPRD",26,0)
 I 'IDPRNT,'ADDPRNT D  G REPX
"RTN","TIUPRD",27,0)
 . ; -- If TIUDA is already in array (as parent/gpa of previous kid),
"RTN","TIUPRD",28,0)
 . ;    and is now received on its own merit, forget the original
"RTN","TIUPRD",29,0)
 . ;    child.  If not already in array, put it in.  Quit.
"RTN","TIUPRD",30,0)
 . I $D(^TMP("TIUREPLACE",$J,TIUDA)) S $P(^TMP("TIUREPLACE",$J,TIUDA),U,2)="" Q
"RTN","TIUPRD",31,0)
 . S ^TMP("TIUREPLACE",$J,TIUDA)=1
"RTN","TIUPRD",32,0)
 . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUPRD",33,0)
 ; ==========================================
"RTN","TIUPRD",34,0)
 ; -- If TIUDA is an ID kid, put its parent in array and track
"RTN","TIUPRD",35,0)
 ;    original child:
"RTN","TIUPRD",36,0)
 I IDPRNT D  G REPX
"RTN","TIUPRD",37,0)
 . S ^TMP("TIUREPLACE",$J,IDPRNT)=1_U_TIUDA
"RTN","TIUPRD",38,0)
 . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUPRD",39,0)
 ; ===========================================
"RTN","TIUPRD",40,0)
 ; -- If TIUDA is an addm to standalone note, put parent in
"RTN","TIUPRD",41,0)
 ;    array and track orig addm:
"RTN","TIUPRD",42,0)
 I ADDPRNT,'ADDGPNT D  G REPX
"RTN","TIUPRD",43,0)
 . S ^TMP("TIUREPLACE",$J,ADDPRNT)=1_U_TIUDA
"RTN","TIUPRD",44,0)
 . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUPRD",45,0)
 ; ===========================================
"RTN","TIUPRD",46,0)
 ; -- If TIUDA is an addm to ID kid, put ID parent in
"RTN","TIUPRD",47,0)
 ;    array and track orig addm:
"RTN","TIUPRD",48,0)
 I ADDPRNT,ADDGPNT D  G REPX
"RTN","TIUPRD",49,0)
 . S ^TMP("TIUREPLACE",$J,ADDGPNT)=1_U_TIUDA
"RTN","TIUPRD",50,0)
 . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUPRD",51,0)
REPX Q
"RTN","TIUPRD",52,0)
 ;
"RTN","TIUPRD",53,0)
MAIN(TIUTYP) ; Control Branching
"RTN","TIUPRD",54,0)
 N DFN,TIU,TIUOUT,TIUREL,TIUCHK,TIUA,TIUSEE,ACT,TIUY,TIUFLAG
"RTN","TIUPRD",55,0)
 N TIUDAT,TIUOUT,TIUSEE,TIUI,TIUQUIT,TIUDEV
"RTN","TIUPRD",56,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUPRD",57,0)
 S:$D(ORVP) DFN=+ORVP S TIUTYP=$G(TIUTYP,38)
"RTN","TIUPRD",58,0)
 D SELPAT^TIULA2(.TIUDAT,TIUTYP,+$G(DFN))
"RTN","TIUPRD",59,0)
 I +$G(TIUDAT)'>0,($D(TIUDAT)'>9) S TIUOUT=1 Q
"RTN","TIUPRD",60,0)
 S TIUFLAG=$$FLAG^TIUPRPN3
"RTN","TIUPRD",61,0)
 S TIUDEV=$$DEVICE^TIUDEV(.IO) ; Get Device/allow queueing
"RTN","TIUPRD",62,0)
 I IO']"" G PRINTX
"RTN","TIUPRD",63,0)
 I $D(IO("Q")) D QUE^TIUDEV("PRINTN^TIUPRD",TIUDEV) G PRINTX
"RTN","TIUPRD",64,0)
 D PRINTN
"RTN","TIUPRD",65,0)
PRINTX D ^%ZISC
"RTN","TIUPRD",66,0)
 K ^TMP("TIUPR",$J)
"RTN","TIUPRD",67,0)
 Q
"RTN","TIUPRD",68,0)
PRINTN ; Loop through selected doc's & invoke print code as appropriate
"RTN","TIUPRD",69,0)
 N TIUI,TIUTYP,TIUDARR,DFN,TIULNO,DIROUT
"RTN","TIUPRD",70,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUPRD",71,0)
 U IO
"RTN","TIUPRD",72,0)
 S TIUI=0
"RTN","TIUPRD",73,0)
 F  S TIUI=$O(TIUDAT(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIUPRD",74,0)
 . N TIUPGRP,TIUPMTHD,TIUPFHDR,TIUPFNBR,ORIGCHLD
"RTN","TIUPRD",75,0)
 . S TIUDA=+$G(TIUDAT(TIUI))
"RTN","TIUPRD",76,0)
 . I '+$G(^TIU(8925,+TIUDA,0)) Q
"RTN","TIUPRD",77,0)
 . ; -- Set ^TMP("TIUREPLACE",$J),
"RTN","TIUPRD",78,0)
 . ;    with ID kids & adda replaced by parents:
"RTN","TIUPRD",79,0)
 . D REPLACE(TIUDA)
"RTN","TIUPRD",80,0)
 . S TIULNO(TIUDA)=TIUI
"RTN","TIUPRD",81,0)
 ; -- Set TIUDARR w info needed to print TIUDA:
"RTN","TIUPRD",82,0)
 S TIUDA=0 F  S TIUDA=$O(^TMP("TIUREPLACE",$J,TIUDA)) Q:'TIUDA  D
"RTN","TIUPRD",83,0)
 . S TIUTYP=$P(^TIU(8925,TIUDA,0),U),DFN=$P(^(0),U,2)
"RTN","TIUPRD",84,0)
 . I +TIUTYP D
"RTN","TIUPRD",85,0)
 . . S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYP)
"RTN","TIUPRD",86,0)
 . . S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYP)
"RTN","TIUPRD",87,0)
 . . S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYP)
"RTN","TIUPRD",88,0)
 . . S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYP)
"RTN","TIUPRD",89,0)
 . Q:$G(TIUPMTHD)']""
"RTN","TIUPRD",90,0)
 . S TIUI=$G(TIULNO(TIUDA))
"RTN","TIUPRD",91,0)
 . I '$G(TIUI) D
"RTN","TIUPRD",92,0)
 . . S ORIGCHLD=$P(^TMP("TIUREPLACE",$J,TIUDA),U,2),TIUI=$G(TIULNO(ORIGCHLD))
"RTN","TIUPRD",93,0)
 . ;I +$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") S TIUDARR(TIUPMTHD,$G(TIUPGRP)_"$"_TIUPFHDR_";"_DFN,TIUI,TIUDA)=TIUPFNBR
"RTN","TIUPRD",94,0)
 . ;E  S TIUDARR(TIUPMTHD,DFN,TIUI,TIUDA)=""
"RTN","TIUPRD",95,0)
 . ; -- P182: Set array same whether or not flds are defined, with
"RTN","TIUPRD",96,0)
 . ;    TIUPGRP piece possibly 0, TIUPFHDR piece possibly null, and
"RTN","TIUPRD",97,0)
 . ;    array value TIUPFNBR possibly null.
"RTN","TIUPRD",98,0)
 . S TIUDARR(TIUPMTHD,+$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_DFN,TIUI,TIUDA)=$G(TIUPFNBR)
"RTN","TIUPRD",99,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUPRD",100,0)
 ; -- Sort printout by printmethod (prints similar docmts together):
"RTN","TIUPRD",101,0)
 S TIUPMTHD="" F  S TIUPMTHD=$O(TIUDARR(TIUPMTHD)) Q:TIUPMTHD=""  D
"RTN","TIUPRD",102,0)
 . D PRNTDOC^TIURA(TIUPMTHD,.TIUDARR)
"RTN","TIUPRD",103,0)
 Q
"RTN","TIUPRDS")
0^9^B4754364
"RTN","TIUPRDS",1,0)
TIUPRDS ; SLC/SBW - Print Form 10-1000 Discharge Summaries ; 6/9/04
"RTN","TIUPRDS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**182**;Jun 20, 1997
"RTN","TIUPRDS",3,0)
WRITE(TIUFLAG) ; Writes form 10-1000 data to screen or paper.
"RTN","TIUPRDS",4,0)
 N ZTRTN,%I,%T,%Y,POP
"RTN","TIUPRDS",5,0)
 S ZTRTN="ENTRY^TIUPRDS"
"RTN","TIUPRDS",6,0)
DEVICE ; Device handling
"RTN","TIUPRDS",7,0)
 ; Call with: ZTRTN
"RTN","TIUPRDS",8,0)
 N %ZIS,IOP
"RTN","TIUPRDS",9,0)
 S:$D(TIUDEV) %ZIS("B")=TIUDEV
"RTN","TIUPRDS",10,0)
 S %ZIS="Q" D ^%ZIS Q:POP
"RTN","TIUPRDS",11,0)
 S TIUDEV=ION
"RTN","TIUPRDS",12,0)
 G:$D(IO("Q")) QUE
"RTN","TIUPRDS",13,0)
NOQUE D @ZTRTN
"RTN","TIUPRDS",14,0)
 D ^%ZISC
"RTN","TIUPRDS",15,0)
 Q
"RTN","TIUPRDS",16,0)
QUE ; Queue output
"RTN","TIUPRDS",17,0)
 N %,ZTDTH,ZTIO,ZTSAVE,ZTSK
"RTN","TIUPRDS",18,0)
 Q:'$D(ZTRTN)  K IO("Q"),ZTSAVE F %="DA","DFN","TIU*" S ZTSAVE(%)=""
"RTN","TIUPRDS",19,0)
 S:'$D(ZTDESC) ZTDESC="PRINT DISCHARGE SUMMARY" S ZTIO=ION
"RTN","TIUPRDS",20,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","TIUPRDS",21,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","TIUPRDS",22,0)
 S IOP="HOME" D ^%ZIS
"RTN","TIUPRDS",23,0)
 Q
"RTN","TIUPRDS",24,0)
ENTRY ; Entry point to print queued discharge summary
"RTN","TIUPRDS",25,0)
 N TIUERR,TIUI,TIUJ,D0,DN,Y,DTOUT,DUOUT,DIRUT,DIROUT,TIU0,TIUINI
"RTN","TIUPRDS",26,0)
 K ^TMP("TIULQ",$J)
"RTN","TIUPRDS",27,0)
 S TIUINI=1 ; Indicate initials only for transcriber
"RTN","TIUPRDS",28,0)
 I $D(ZTQUEUED) S ZTREQ="@" ; Tell TaskMan to delete Task log entry
"RTN","TIUPRDS",29,0)
 U IO
"RTN","TIUPRDS",30,0)
 I '$D(^TMP("TIUPR",$J)) W !,"No Document Record Specified.",$C(7) Q
"RTN","TIUPRDS",31,0)
 ; -- Change variable DFN to TIUJ since not used except to sort,
"RTN","TIUPRDS",32,0)
 ;    and does not equal DFN with changes to TIURA in patch 182.
"RTN","TIUPRDS",33,0)
 S TIUJ=0 F  S TIUJ=$O(^TMP("TIUPR",$J,TIUJ)) Q:TIUJ=""  D
"RTN","TIUPRDS",34,0)
 . S TIUI=0 F  S TIUI=$O(^TMP("TIUPR",$J,TIUJ,TIUI)) Q:+TIUI'>0!$D(DIROUT)  D
"RTN","TIUPRDS",35,0)
 . . N TIUDA S TIUDA=0
"RTN","TIUPRDS",36,0)
 . . F  S TIUDA=+$O(^TMP("TIUPR",$J,TIUJ,TIUI,TIUDA)) Q:+TIUDA'>0!$D(DIROUT)  D
"RTN","TIUPRDS",37,0)
 . . . S TIU0=$G(^TIU(8925,+TIUDA,0))
"RTN","TIUPRDS",38,0)
 . . . I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=$P(TIU0,U,6)
"RTN","TIUPRDS",39,0)
 . . . D EXTRACT^TIULQ(+TIUDA,"^TMP(""TIULQ"",$J)",.TIUERR,"","",1)
"RTN","TIUPRDS",40,0)
 . . . I +$G(TIUERR) W !,$P(TIUERR,U,2) Q
"RTN","TIUPRDS",41,0)
 . . . Q:'$D(^TMP("TIULQ",$J))
"RTN","TIUPRDS",42,0)
 . . . D PRINT^TIUPRDS1(+TIUDA,$G(TIUFLAG))
"RTN","TIUPRDS",43,0)
 . . . K ^TMP("TIULQ",$J),^TMP("TIUPR",$J,TIUJ,TIUI,TIUDA)
"RTN","TIUPRDS",44,0)
 Q
"RTN","TIUPRPN1")
0^10^B47306640
"RTN","TIUPRPN1",1,0)
TIUPRPN1 ;SLC/JER - Print SF 509-Progress Notes ;10/5/04
"RTN","TIUPRPN1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**45,52,87,100,162,182**;Jun 20, 1997
"RTN","TIUPRPN1",3,0)
 ; DBIA 908 ^SC(D0,0)
"RTN","TIUPRPN1",4,0)
PRINT(TIUFLAG,TIUSPG) ; Print Document
"RTN","TIUPRPN1",5,0)
 ; ^TMP("TIUPR",$J) is array of records to be printed
"RTN","TIUPRPN1",6,0)
 ; TIUFLAG=1 --> Chart Copy     TIUSPG=1 --> Contiguous
"RTN","TIUPRPN1",7,0)
 ; TIUFLAG=0 --> Work Copy      TIUSPG=0 --> Fresh Page- each note
"RTN","TIUPRPN1",8,0)
 ; TIUCONT=1 --> Continue printing
"RTN","TIUPRPN1",9,0)
 ; TIUCONT1=1 --> Write "Continue to next/from previous-page" msgs
"RTN","TIUPRPN1",10,0)
 ; TIUPFNBR ---> Print Form # like vice 509
"RTN","TIUPRPN1",11,0)
 ; TIUMISC=TIUFLAG_U_TIUPFNBR_U_TIUDA
"RTN","TIUPRPN1",12,0)
 N TIUI,TIUJ,TIUPAGE,TIUFOOT,TIUK,TIUDA,TIUCONT,TIUPGRP,TIUTYP
"RTN","TIUPRPN1",13,0)
 N TIUPFHDR,TIUPFNBR,TIUMISC,TIUCONT1,TIUIDONE,TMP
"RTN","TIUPRPN1",14,0)
 S TIUFLAG=+$G(TIUFLAG),TIUSPG=+$G(TIUSPG)
"RTN","TIUPRPN1",15,0)
 S TIUCONT=1,TIUCONT1=0
"RTN","TIUPRPN1",16,0)
 S TIUI=0 F  S TIUI=$O(^TMP("TIUPR",$J,TIUI)) Q:TIUI=""  D  Q:'TIUCONT
"RTN","TIUPRPN1",17,0)
 . N DFN,TIU
"RTN","TIUPRPN1",18,0)
 . ; -- P182 TIUI has form PGRP$PFHDR;DFN with PGRP possibly 0, and
"RTN","TIUPRPN1",19,0)
 . ;    PFHDR possibly null (see TIURA):
"RTN","TIUPRPN1",20,0)
 . S TIUPGRP=+$P(TIUI,"$"),TIUPFHDR=$P($P(TIUI,";"),"$",2)
"RTN","TIUPRPN1",21,0)
 . I TIUPFHDR']"" S TIUPFHDR="Progress Notes"
"RTN","TIUPRPN1",22,0)
 . S DFN=$P(TIUI,";",2)
"RTN","TIUPRPN1",23,0)
 . I $G(TIUPGRP)>2 S TIUSPG=0
"RTN","TIUPRPN1",24,0)
 . D PATPN^TIULV(.TIUFOOT,DFN)
"RTN","TIUPRPN1",25,0)
 . I +$G(TIUSPG) D HEADER^TIUPRPN2(.TIUFOOT,TIUFLAG,.TIUPFHDR,TIUCONT1)
"RTN","TIUPRPN1",26,0)
 . ; Use TIUJ="" (not TIUJ=0), to print "complete" notes w/o sigdt:
"RTN","TIUPRPN1",27,0)
 . S TIUJ="" F  S TIUJ=$O(^TMP("TIUPR",$J,TIUI,TIUJ)) Q:TIUJ=""  D  Q:'TIUCONT
"RTN","TIUPRPN1",28,0)
 . . S TIUK=0 F  S TIUK=$O(^TMP("TIUPR",$J,TIUI,TIUJ,TIUK)) Q:'TIUK  D  Q:'TIUCONT
"RTN","TIUPRPN1",29,0)
 . . . S TIUCONT1=0 S TIUPFNBR=^TMP("TIUPR",$J,TIUI,TIUJ,TIUK)
"RTN","TIUPRPN1",30,0)
 . . . ; Note: TIUPFNBR may be null
"RTN","TIUPRPN1",31,0)
 . . . ;P182 Set TIUMISC BEFORE quitting if deleted
"RTN","TIUPRPN1",32,0)
 . . . S TIUDA=TIUK,TIUMISC=TIUFLAG_U_TIUPFNBR_U_TIUDA
"RTN","TIUPRPN1",33,0)
 . . . ; Quit docmt if deleted:
"RTN","TIUPRPN1",34,0)
 . . . I '$D(^TIU(8925,+TIUDA,0)) D  Q
"RTN","TIUPRPN1",35,0)
 . . . . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",36,0)
 . . . . W !!,"NOTE DATED:",!,"Document #",TIUDA," for ",$G(TIUFOOT("PNMP")),!,"no longer exists in the TIU DOCUMENT file.",!!!
"RTN","TIUPRPN1",37,0)
 . . . . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN1",38,0)
 . . . N TIUROOT
"RTN","TIUPRPN1",39,0)
 . . . I '+$G(TIUSPG) D HEADER^TIUPRPN2(.TIUFOOT,TIUFLAG,.TIUPFHDR,TIUCONT1)
"RTN","TIUPRPN1",40,0)
 . . . K ^TMP("TIULQ",$J)
"RTN","TIUPRPN1",41,0)
 . . . D EXTRACT^TIULQ(+TIUDA,"^TMP(""TIULQ"",$J)",.TIUERR,"","",1)
"RTN","TIUPRPN1",42,0)
 . . . I +$G(TIUERR) W !,$P(TIUERR,U,2) Q
"RTN","TIUPRPN1",43,0)
 . . . Q:'$D(^TMP("TIULQ",$J))
"RTN","TIUPRPN1",44,0)
 . . . S TIUROOT="^TMP(""TIULQ"",$J,"_TIUDA_")"
"RTN","TIUPRPN1",45,0)
 . . . D REPORT(TIUROOT,.TIUFOOT,TIUMISC,.TIUCONT) Q:'TIUCONT
"RTN","TIUPRPN1",46,0)
 . . . D IDKIDS(TIUROOT,.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT) Q:'TIUCONT
"RTN","TIUPRPN1",47,0)
 . . . I '+$G(TIUSPG) S TIUCONT1=0 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,1,$G(TIUROOT))
"RTN","TIUPRPN1",48,0)
 . Q:'TIUCONT
"RTN","TIUPRPN1",49,0)
 . I $E(IOST)="C-" S TIUCONT=$$STOP^TIUPRPN2() Q:'TIUCONT
"RTN","TIUPRPN1",50,0)
 . I +$G(TIUSPG),$E(IOST)'="C-" S TIUCONT1=0 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,1,$G(TIUROOT))
"RTN","TIUPRPN1",51,0)
 Q
"RTN","TIUPRPN1",52,0)
 ;
"RTN","TIUPRPN1",53,0)
REPORT(TIUROOT,TIUFOOT,TIUMISC,TIUCONT,TIUIDEND) ; Report Text
"RTN","TIUPRPN1",54,0)
 ; Requires array TIUFOOT, vars TIUMISC, TIUCONT
"RTN","TIUPRPN1",55,0)
 ; Requires TIUROOT =
"RTN","TIUPRPN1",56,0)
 ; ^TMP("TIULQ",$J,NOTEIFN) for parent/stand-alone note, or
"RTN","TIUPRPN1",57,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZADD",ADDMIFN) for addendum, or
"RTN","TIUPRPN1",58,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZZID",KIDSEQ#,IDKIDIFN) for ID kid, or
"RTN","TIUPRPN1",59,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZZID",KIDSEQ#,IDKIDIFN,"ZADD",KIDADDMIFN)
"RTN","TIUPRPN1",60,0)
 ;       for ID kid addm.
"RTN","TIUPRPN1",61,0)
 N DIW,DIWF,DIWL,DIWR,DIWT,TIUERR,TIU,TIUI,X,Z,LOC
"RTN","TIUPRPN1",62,0)
 N REFDT,TITLE,ADT,HLOC,SUBJ
"RTN","TIUPRPN1",63,0)
 N TIUDA,TIUCONT1,HASIDKID,HASIDDAD
"RTN","TIUPRPN1",64,0)
 S TIUDA=$P(TIUMISC,U,3),TIUCONT1=0
"RTN","TIUPRPN1",65,0)
 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",66,0)
 S HASIDKID=$G(^TMP("TIULQ",$J,TIUDA,"ZZID",0)) ;how many ID kids
"RTN","TIUPRPN1",67,0)
 S HASIDDAD=$S(TIUROOT["ZZID":1,1:0)
"RTN","TIUPRPN1",68,0)
 I HASIDKID W "<< Interdisciplinary Note - Begin >>",!
"RTN","TIUPRPN1",69,0)
 I HASIDDAD W "<< Interdisciplinary Note - Cont. >>",!
"RTN","TIUPRPN1",70,0)
 W $S('HASIDKID&'HASIDDAD:"NOTE DATED: ",1:"ENTRY DATED: ")
"RTN","TIUPRPN1",71,0)
 S REFDT=@TIUROOT@(1301,"I")
"RTN","TIUPRPN1",72,0)
 W $$DATE^TIULS(REFDT,"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN1",73,0)
 S TITLE=@TIUROOT@(.01,"E")
"RTN","TIUPRPN1",74,0)
 W ?30,$$UP^XLFSTR(TITLE),!
"RTN","TIUPRPN1",75,0)
 S LOC=$G(@TIUROOT@(1205,"I"))
"RTN","TIUPRPN1",76,0)
 I +LOC D
"RTN","TIUPRPN1",77,0)
 . W $S($P(^SC(LOC,0),U,3)="W":"ADMITTED: ",1:"VISIT: ")
"RTN","TIUPRPN1",78,0)
 . S ADT=$G(@TIUROOT@(.07,"I"))
"RTN","TIUPRPN1",79,0)
 . W $$DATE^TIULS(ADT,"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN1",80,0)
 . S HLOC=$G(@TIUROOT@(1205,"E"))
"RTN","TIUPRPN1",81,0)
 . W " ",HLOC
"RTN","TIUPRPN1",82,0)
 S SUBJ=$G(@TIUROOT@(1701,"E"))
"RTN","TIUPRPN1",83,0)
 I SUBJ]"" W !,"SUBJECT: ",^("E"),!
"RTN","TIUPRPN1",84,0)
 S TIUCONT1=1
"RTN","TIUPRPN1",85,0)
 I $D(@TIUROOT@("PROBLEM")) D  Q:'TIUCONT
"RTN","TIUPRPN1",86,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",87,0)
 . W !,"ASSOCIATED PROBLEMS:"
"RTN","TIUPRPN1",88,0)
 . N TIUI S TIUI=0
"RTN","TIUPRPN1",89,0)
 . F  S TIUI=$O(@TIUROOT@("PROBLEM",TIUI)) Q:'TIUI  D  Q:'TIUCONT
"RTN","TIUPRPN1",90,0)
 ..W !,^(TIUI,0)
"RTN","TIUPRPN1",91,0)
 ..S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",92,0)
 W !
"RTN","TIUPRPN1",93,0)
 S TIUI=0,DIWF="WN",DIWL=1,DIWR=79 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",94,0)
 F  S TIUI=$O(@TIUROOT@("TEXT",TIUI)) Q:TIUI'>0  D  Q:'TIUCONT  ; D ^DIWW
"RTN","TIUPRPN1",95,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",96,0)
 . S X=@TIUROOT@("TEXT",TIUI,0) S:X="" X=" " D ^DIWP
"RTN","TIUPRPN1",97,0)
 D ^DIWW K ^UTILITY($J,"W")
"RTN","TIUPRPN1",98,0)
 Q:'TIUCONT
"RTN","TIUPRPN1",99,0)
 D GETSIG(TIUROOT,.TIUSIG)
"RTN","TIUPRPN1",100,0)
 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",101,0)
 W !
"RTN","TIUPRPN1",102,0)
 D SIGBLK^TIUPRPN8(.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT,.TIUSIG,TIUROOT)
"RTN","TIUPRPN1",103,0)
 Q:'TIUCONT
"RTN","TIUPRPN1",104,0)
ADDENDA ; Fall through and do Addenda of docmt TIUDA
"RTN","TIUPRPN1",105,0)
 N DIW,DIWF,DIWL,DIWR,DIWT,X,Z,TIUI,TIUADD,ADDMRDT
"RTN","TIUPRPN1",106,0)
 S TIUADD=0,DIWF="WN",DIWL=1,DIWR=79 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",107,0)
 F  S TIUADD=$O(@TIUROOT@("ZADD",TIUADD)) Q:TIUADD'>0  D  Q:'TIUCONT
"RTN","TIUPRPN1",108,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",109,0)
 . S ADDMRDT=@TIUROOT@("ZADD",TIUADD,1301,"I")
"RTN","TIUPRPN1",110,0)
 . W !!,$$DATE^TIULS(ADDMRDT,"MM/DD/CCYY HR:MIN"),?21,"ADDENDUM"
"RTN","TIUPRPN1",111,0)
 . W ?39,"STATUS: ",@TIUROOT@("ZADD",TIUADD,.05,"E") ;P162
"RTN","TIUPRPN1",112,0)
 . S TIUI=0
"RTN","TIUPRPN1",113,0)
 . F  S TIUI=$O(@TIUROOT@("ZADD",TIUADD,"TEXT",TIUI)) Q:TIUI'>0  D  Q:'TIUCONT
"RTN","TIUPRPN1",114,0)
 . . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",115,0)
 . . S X=@TIUROOT@("ZADD",TIUADD,"TEXT",TIUI,0) S:X="" X=" " D ^DIWP
"RTN","TIUPRPN1",116,0)
 . D ^DIWW
"RTN","TIUPRPN1",117,0)
 . Q:'TIUCONT
"RTN","TIUPRPN1",118,0)
 . N TIUADRT
"RTN","TIUPRPN1",119,0)
 . S TIUADRT=$P(TIUROOT,")")_",""ZADD"","_TIUADD_")"
"RTN","TIUPRPN1",120,0)
 . D GETSIG(TIUADRT,.TIUSIG)
"RTN","TIUPRPN1",121,0)
 . D SIGBLK^TIUPRPN8(.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT,.TIUSIG,TIUADRT)
"RTN","TIUPRPN1",122,0)
 ; Need ! in front for amended notes:
"RTN","TIUPRPN1",123,0)
 I $G(TIUIDEND) W !,"<< Interdisciplinary Note - End >>",!
"RTN","TIUPRPN1",124,0)
 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",125,0)
 ; Write 2 linefeeds between records
"RTN","TIUPRPN1",126,0)
 W:TIUCONT !!
"RTN","TIUPRPN1",127,0)
 Q
"RTN","TIUPRPN1",128,0)
 ;
"RTN","TIUPRPN1",129,0)
IDKIDS(TIUROOT,TIUFOOT,TIUMISC,TIUCONT1,TIUCONT) ; Print ID kids
"RTN","TIUPRPN1",130,0)
 ;of docmt TIUDA (each kid does its own addenda)
"RTN","TIUPRPN1",131,0)
 N TIUL,KIDDA,TIUDA,TIUSORT,TIUIDRT,TIUIDEND
"RTN","TIUPRPN1",132,0)
 S TIUDA=$P(TIUMISC,U,3),TIUIDEND=0
"RTN","TIUPRPN1",133,0)
 S TIUL=0
"RTN","TIUPRPN1",134,0)
 F  S TIUL=$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL)) Q:'TIUL  D  Q:'TIUCONT
"RTN","TIUPRPN1",135,0)
 . S KIDDA=$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL,0))
"RTN","TIUPRPN1",136,0)
 . S TIUMISC=TIUFLAG_U_TIUPFNBR_U_KIDDA
"RTN","TIUPRPN1",137,0)
 . S TIUIDRT="^TMP(""TIULQ"",$J,"_TIUDA_",""ZZID"","_TIUL_","_KIDDA_")"
"RTN","TIUPRPN1",138,0)
 . I '$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL)) S TIUIDEND=1
"RTN","TIUPRPN1",139,0)
 . D REPORT(TIUIDRT,.TIUFOOT,TIUMISC,.TIUCONT,TIUIDEND)
"RTN","TIUPRPN1",140,0)
 Q
"RTN","TIUPRPN1",141,0)
 ;
"RTN","TIUPRPN1",142,0)
GETSIG(TIUROOT,TIUSIG) ; Get signature info from TIULQ global;
"RTN","TIUPRPN1",143,0)
 ; Set info into TIUSIG array **100**
"RTN","TIUPRPN1",144,0)
 ; Requires array name TIUROOT; passes back array TIUSIG
"RTN","TIUPRPN1",145,0)
 ; TIUROOT = ^TMP("TIULQ",$J,NOTEIFN) for parent note, or
"RTN","TIUPRPN1",146,0)
 ;           ^TMP("TIULQ",$J,NOTEIFN,"ZADD",ADDMIFN) for addendum, or
"RTN","TIUPRPN1",147,0)
 ;           ^TMP("TIULQ",$J,NOTEIFN,"ZZID",IDKIDIFN) for ID kid.
"RTN","TIUPRPN1",148,0)
 ; Signature should be on bottom of form, Addenda on Subsequent pages
"RTN","TIUPRPN1",149,0)
 N TIULINE S $P(TIULINE,"-",81)=""
"RTN","TIUPRPN1",150,0)
 S TIUSIG("AUTHOR")=$G(@TIUROOT@(1202,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",151,0)
 S TIUSIG("EXPSIGNR")=$G(@TIUROOT@(1204,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",152,0)
 S TIUSIG("EXPCOSNR")=$G(@TIUROOT@(1208,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",153,0)
 S TIUSIG("SIGNDATE")=$G(@TIUROOT@(1501,"I"))
"RTN","TIUPRPN1",154,0)
 S TIUSIG("SIGNEDBY")=$G(@TIUROOT@(1502,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",155,0)
 S TIUSIG("SIGNNAME")=$G(@TIUROOT@(1503,"E"))
"RTN","TIUPRPN1",156,0)
 S TIUSIG("SIGTITL")=$G(@TIUROOT@(1504,"E"))
"RTN","TIUPRPN1",157,0)
 S TIUSIG("SIGNMODE")=$G(@TIUROOT@(1505,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",158,0)
 S TIUSIG("COSGDATE")=$G(@TIUROOT@(1507,"I"))
"RTN","TIUPRPN1",159,0)
 S TIUSIG("COSGEDBY")=$G(@TIUROOT@(1508,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",160,0)
 S TIUSIG("COSGNAME")=$G(@TIUROOT@(1509,"E"))
"RTN","TIUPRPN1",161,0)
 S TIUSIG("COSGTITL")=$G(@TIUROOT@(1510,"E"))
"RTN","TIUPRPN1",162,0)
 S TIUSIG("COSGMODE")=$G(@TIUROOT@(1511,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",163,0)
 S TIUSIG("SIGCHRT")=$G(@TIUROOT@(1512,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",164,0)
 S TIUSIG("COSCHRT")=$G(@TIUROOT@(1513,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",165,0)
 ; -- P182 Set Admin Clos Date:
"RTN","TIUPRPN1",166,0)
 S TIUSIG("ADMINCDT")=$G(@TIUROOT@(1606,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",167,0)
 Q
"RTN","TIUPRPN1",168,0)
 ;
"RTN","TIUPRPN1",169,0)
SETCONT(TIUFOOT,TIUMISC,TIUCONT1,TIUHEAD,TIUROOT) ;Does footer
"RTN","TIUPRPN1",170,0)
 ;and returns TIUCONT
"RTN","TIUPRPN1",171,0)
 ; Requires array TIUFOOT, vars TIUMISC,TIUCONT1; optional TIUHEAD
"RTN","TIUPRPN1",172,0)
 ; Optional TIUROOT
"RTN","TIUPRPN1",173,0)
 Q $$FOOTER^TIUPRPN2(.TIUFOOT,TIUMISC,TIUCONT1,TIUHEAD,$G(TIUROOT))
"RTN","TIUPRPN8")
0^11^B28910137
"RTN","TIUPRPN8",1,0)
TIUPRPN8 ;SLC/MAM - Print SF 509-Progress Notes, Cont ;11/10/04 [1/4/05 12:17pm]
"RTN","TIUPRPN8",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,176,157,182**;Jun 20, 1997
"RTN","TIUPRPN8",3,0)
 ;
"RTN","TIUPRPN8",4,0)
SIGBLK(TIUFOOT,TIUMISC,TIUCONT1,TIUCONT,TIUSIG,TIUROOT) ; Print signature block info
"RTN","TIUPRPN8",5,0)
 ; Requires array TIUFOOT, requires TIUMISC
"RTN","TIUPRPN8",6,0)
 ; Requires TIUCONT1
"RTN","TIUPRPN8",7,0)
 ; Receives TIUCONT by ref (req'd)
"RTN","TIUPRPN8",8,0)
 ; Receives array TIUSIG by ref, required.
"RTN","TIUPRPN8",9,0)
 ; Requires TIUROOT
"RTN","TIUPRPN8",10,0)
 N TIUDA,TIUFLAG
"RTN","TIUPRPN8",11,0)
 S TIUCONT=1,TIUDA=$P(TIUMISC,U,3),TIUFLAG=$P(TIUMISC,U)
"RTN","TIUPRPN8",12,0)
 ;S TIUGROOT=$NA(^TMP("TIULQ",$J,TIUDA))
"RTN","TIUPRPN8",13,0)
 ; -- P182 Don't marked admin signed notes as draft:
"RTN","TIUPRPN8",14,0)
 I '+TIUSIG("SIGNDATE"),'+TIUSIG("ADMINCDT") D  Q:'TIUCONT
"RTN","TIUPRPN8",15,0)
 . W "**DRAFT COPY - DRAFT COPY -- ABOVE NOTE IS UNSIGNED--"
"RTN","TIUPRPN8",16,0)
 . W " DRAFT COPY - DRAFT COPY**",!
"RTN","TIUPRPN8",17,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN8",18,0)
 ;I TIUSIG("SIGNEDBY")]"",(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",19,0)
 ;. W ?21,"Author:      ",$P(TIUSIG("AUTHOR"),";",2),!
"RTN","TIUPRPN8",20,0)
 I +TIUSIG("SIGNDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",21,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",22,0)
 . W ?18,"Signed by:",$S($P(TIUSIG("SIGNMODE"),";")="C":" /s/  ",1:" /es/ "),?34,$S(TIUSIG("SIGNNAME")]"":TIUSIG("SIGNNAME"),1:$P(TIUSIG("SIGNEDBY"),";",2))
"RTN","TIUPRPN8",23,0)
 . I $L(TIUSIG("SIGTITL"))>45 D
"RTN","TIUPRPN8",24,0)
 . . N TIUFT
"RTN","TIUPRPN8",25,0)
 . . D WRAP^TIUFLD(TIUSIG("SIGTITL"),45)
"RTN","TIUPRPN8",26,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",27,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",28,0)
 . I $L(TIUSIG("SIGTITL"))<46,TIUSIG("SIGTITL")]"" W !?34,TIUSIG("SIGTITL")
"RTN","TIUPRPN8",29,0)
 . W !?34,$$DATE^TIULS(+TIUSIG("SIGNDATE"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",30,0)
 . I '+$G(TIUFLAG)!($E(IOST)="C-") D
"RTN","TIUPRPN8",31,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U) W !?34,"Analog Pager: ",$P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U)
"RTN","TIUPRPN8",32,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U,2) W !?34,"Digital Pager: ",$P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U,2)
"RTN","TIUPRPN8",33,0)
 I $P(TIUSIG("SIGNMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",34,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",35,0)
 . N TIUONCH
"RTN","TIUPRPN8",36,0)
 . S TIUONCH=$P(TIUSIG("SIGCHRT"),";",2)
"RTN","TIUPRPN8",37,0)
 . I TIUONCH']"" S TIUONCH=$P(TIUSIG("COSCHRT"),";",2)
"RTN","TIUPRPN8",38,0)
 . W !?2,"Marked signed on chart by:",?34,$G(TIUONCH)
"RTN","TIUPRPN8",39,0)
 ; -- If signer is not author, write "for the author":
"RTN","TIUPRPN8",40,0)
 ;    P182 SIGNEDBY may =";" and follow null even when no signer:
"RTN","TIUPRPN8",41,0)
 ;I TIUSIG("SIGNEDBY")]"",(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",42,0)
 I TIUSIG("SIGNEDBY")]"",(TIUSIG("SIGNEDBY")'=";"),(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",43,0)
 . N TIUSIGTL
"RTN","TIUPRPN8",44,0)
 . W !?34,"for ",$P(TIUSIG("AUTHOR"),";",2)
"RTN","TIUPRPN8",45,0)
 . S TIUSIGTL=$$GET1^DIQ(200,$P(TIUSIG("AUTHOR"),";",1),20.3)
"RTN","TIUPRPN8",46,0)
 . I $D(TIUSIGTL) D
"RTN","TIUPRPN8",47,0)
 . . N TIUFT
"RTN","TIUPRPN8",48,0)
 . . D WRAP^TIUFLD(TIUSIGTL,45)
"RTN","TIUPRPN8",49,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",50,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",51,0)
 I $G(@TIUROOT@(.05,"E"))="UNCOSIGNED" D
"RTN","TIUPRPN8",52,0)
 . W !?34,"**REQUIRES COSIGNATURE**",!
"RTN","TIUPRPN8",53,0)
 ;I +$G(TIUADD) S TIUGROOT=$NA(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD))
"RTN","TIUPRPN8",54,0)
 I +$D(@TIUROOT@("EXTRASGNR")) D  Q:'TIUCONT  ;**100** added the quit
"RTN","TIUPRPN8",55,0)
 . N TIUI S TIUI=0
"RTN","TIUPRPN8",56,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",57,0)
 . W !?4,"Receipt Acknowledged By:"
"RTN","TIUPRPN8",58,0)
 . F  S TIUI=$O(@TIUROOT@("EXTRASGNR",TIUI)) Q:'TIUI  D
"RTN","TIUPRPN8",59,0)
 . . I +$G(@TIUROOT@("EXTRASGNR",TIUI,"DATE"))'>0 Q
"RTN","TIUPRPN8",60,0)
 . . I TIUI>1 S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",61,0)
 . . W !?29,"/es/ ",$G(@TIUROOT@("EXTRASGNR",TIUI,"NAME"))
"RTN","TIUPRPN8",62,0)
 . . I $L($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")))>45 D
"RTN","TIUPRPN8",63,0)
 . . . N TIUFT
"RTN","TIUPRPN8",64,0)
 . . . D WRAP^TIUFLD($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")),45)
"RTN","TIUPRPN8",65,0)
 . . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",66,0)
 . . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",67,0)
 . . I $L($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")))<46 W !?34,$G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE"))
"RTN","TIUPRPN8",68,0)
 . . I $G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")),$G(@TIUROOT@("EXTRASGNR",TIUI,"EXPIEN"))'=$G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")) D
"RTN","TIUPRPN8",69,0)
 . . . W !?30,"for ",$P($G(@TIUROOT@("EXTRASGNR",TIUI,"EXPNAME")),",",2)
"RTN","TIUPRPN8",70,0)
 . . . W " ",$P($G(@TIUROOT@("EXTRASGNR",TIUI,"EXPNAME")),",")
"RTN","TIUPRPN8",71,0)
 . . W !?34,$$DATE^TIULS($G(@TIUROOT@("EXTRASGNR",TIUI,"DATE")),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",72,0)
 . . I '+$G(TIUFLAG)!($E(IOST)="C-") D
"RTN","TIUPRPN8",73,0)
 . . . N BEEP
"RTN","TIUPRPN8",74,0)
 . . . S BEEP=$$BEEP^TIULC1(+$G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")))
"RTN","TIUPRPN8",75,0)
 . . . I +BEEP W !?34,"Analog Pager:  ",$P(BEEP,U)
"RTN","TIUPRPN8",76,0)
 . . . I +$P(BEEP,U,2) W !?34,"Digital Pager: ",$P(BEEP,U,2)
"RTN","TIUPRPN8",77,0)
 . ;K @TIUROOT@("EXTRASGNR") ;**100** commented out
"RTN","TIUPRPN8",78,0)
 ;I +TIUSIG("COSGDATE"),(+TIUSIG("COSGEDBY")'=+TIUSIG("SIGNEDBY")) D  Q:'TIUCONT
"RTN","TIUPRPN8",79,0)
 I +TIUSIG("COSGDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",80,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",81,0)
 . W !!?16,"Cosigned by:",$S($P(TIUSIG("COSGMODE"),";")="C":" /s/  ",1:" /es/ "),?34,$S(TIUSIG("COSGNAME")]"":TIUSIG("COSGNAME"),1:$P(TIUSIG("COSGEDBY"),";",2))
"RTN","TIUPRPN8",82,0)
 . I $L(TIUSIG("COSGTITL"))>45 D
"RTN","TIUPRPN8",83,0)
 . . N TIUFT
"RTN","TIUPRPN8",84,0)
 . . D WRAP^TIUFLD(TIUSIG("COSGTITL"),45)
"RTN","TIUPRPN8",85,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",86,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",87,0)
 . I $L(TIUSIG("COSGTITL"))<46 W !?34,TIUSIG("COSGTITL")
"RTN","TIUPRPN8",88,0)
 . W !?34,$$DATE^TIULS(+TIUSIG("COSGDATE"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",89,0)
 . I '+$G(TIUFLAG)!($E(IOST)="C-") D
"RTN","TIUPRPN8",90,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U) W !?34,"Analog Pager: ",$P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U)
"RTN","TIUPRPN8",91,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U,2) W !?34,"Digital Pager: ",$P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U,2)
"RTN","TIUPRPN8",92,0)
 ;I +TIUSIG("COSCHRT"),$P(TIUSIG("COSGMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",93,0)
 I $P(TIUSIG("COSGMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",94,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",95,0)
 . W !,"Marked cosigned on chart by:",?34,$P(TIUSIG("COSCHRT"),";",2)
"RTN","TIUPRPN8",96,0)
 W !
"RTN","TIUPRPN8",97,0)
 ;K TIUCONT1 ; kills the cont on next page msgs since no longer in middle
"RTN","TIUPRPN8",98,0)
 ;of a note.  **100** moved down to amend code
"RTN","TIUPRPN8",99,0)
AMEND ; signature blocks of amender
"RTN","TIUPRPN8",100,0)
 ;N TIUY S TIUY=4 ;I don't think we need TIUY anymore **100**
"RTN","TIUPRPN8",101,0)
 I '$G(@TIUROOT@(1601,"I")) K TIUCONT1 Q
"RTN","TIUPRPN8",102,0)
 S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN8",103,0)
 K TIUCONT1 Q:'TIUCONT
"RTN","TIUPRPN8",104,0)
 I +$G(@TIUROOT@(1601,"I")) D
"RTN","TIUPRPN8",105,0)
 . W !!?12,"Amendment Filed:",?34,$$DATE^TIULS(@TIUROOT@(1601,"I"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",106,0)
 . I $G(@TIUROOT@(1603,"E"))']"" D
"RTN","TIUPRPN8",107,0)
 . . W !!?29 F TIUI=1:1:40 W "_"
"RTN","TIUPRPN8",108,0)
 . . W !?29,$$SIGNAME^TIULS(@TIUROOT@(1602,"I"))
"RTN","TIUPRPN8",109,0)
 . . W !?29,$$SIGTITL^TIULS(@TIUROOT@(1602,"I"))
"RTN","TIUPRPN8",110,0)
 . I $G(@TIUROOT@(1604,"E"))]"" D
"RTN","TIUPRPN8",111,0)
 . . W !?29,"/es/",?34,@TIUROOT@(1604,"E")
"RTN","TIUPRPN8",112,0)
 . . W !?34,@TIUROOT@(1605,"E")
"RTN","TIUPRPN8",113,0)
 Q
"RTN","TIUPRPN8",114,0)
 ;
"RTN","TIUPS182")
0^12^B1757313
"RTN","TIUPS182",1,0)
TIUPS182 ; SLC/MAM - TIU*1*182 Post Install ; 05/25/2004
"RTN","TIUPS182",2,0)
 ;;1.0;Text Integration Utilities;**182**;Jun 20, 1997
"RTN","TIUPS182",3,0)
 ;
"RTN","TIUPS182",4,0)
 ; -- Edit Print Form Header,delete PF Number of Class CP:
"RTN","TIUPS182",5,0)
 N FDA,TIUFPRIV,CPCLASS
"RTN","TIUPS182",6,0)
 S CPCLASS=$$CLASS^TIUCP,FDA(8925.1,CPCLASS_",",6.1)="Clinical Procedures"
"RTN","TIUPS182",7,0)
 S FDA(8925.1,CPCLASS_",",6.12)="@"
"RTN","TIUPS182",8,0)
 S TIUFPRIV=1
"RTN","TIUPS182",9,0)
 D FILE^DIE("TE","FDA")
"RTN","TIUPS182",10,0)
 I '$D(^TMP("DIERR",$J)) D BMES^XPDUTL("Class Clinical Procedures Print Form Header and Number updated successfully.") Q
"RTN","TIUPS182",11,0)
 D BMES^XPDUTL("Couldn't update Class CP Print Form Header or Number. See patch description or contact EVS.")
"RTN","TIUPS182",12,0)
 K ^TMP("DIERR",$J)
"RTN","TIUPS182",13,0)
 Q
"RTN","TIURA")
0^13^B63108562
"RTN","TIURA",1,0)
TIURA ; SLC/JER - Review screen actions ; 7/7/04
"RTN","TIURA",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,10,20,79,88,58,100,109,182**;Jun 20, 1997
"RTN","TIURA",3,0)
 ; Call to ISA^USRLM supported by DBIA 2324
"RTN","TIURA",4,0)
EDIT ; Edit Documents
"RTN","TIURA",5,0)
 N TIUDA,DFN,TIUDDT,TIUDATA,TIUCHNG,TIUEDIT,TIUI,DIROUT,TIUDAARY
"RTN","TIURA",6,0)
 N TIULST,MSGVERB
"RTN","TIURA",7,0)
 S TIUI=0
"RTN","TIURA",8,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA",9,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA",10,0)
 . N RSTRCTD
"RTN","TIURA",11,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA",12,0)
 . D CLEAR^VALM1 W !!,"Editing #",+TIUDATA
"RTN","TIURA",13,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA",14,0)
 . I RSTRCTD D  Q
"RTN","TIURA",15,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURA",16,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA",17,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURA",18,0)
 . S TIUCHNG=0
"RTN","TIURA",19,0)
 . I +$D(^TIU(8925,+TIUDA,0)) D EDIT1
"RTN","TIURA",20,0)
 . I +$G(TIUCHNG) D
"RTN","TIURA",21,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURA",22,0)
 ; -- Update or Rebuild list, restore video: --
"RTN","TIURA",23,0)
 I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURA",24,0)
 E  S TIUCHNG("UPDATE")=1
"RTN","TIURA",25,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURA",26,0)
 S VALMBCK="R"
"RTN","TIURA",27,0)
 S MSGVERB=$S($G(TIUCHNG("ADDM")):"edited/addended",1:"edited")
"RTN","TIURA",28,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,MSGVERB)
"RTN","TIURA",29,0)
 Q
"RTN","TIURA",30,0)
EDIT1 ; Single record edit
"RTN","TIURA",31,0)
 ; Receives TIUDA
"RTN","TIURA",32,0)
 N %X,%Y,C,D,D0,DDWTMP,DFN,DI,DIC,TIUEDIT,TIUMSG,TIUQUIT,TIUADD,TIUREL
"RTN","TIURA",33,0)
 N TIUTYP,TIUT0,TIUDPRM,TIULDT,DIWESUB,TIU,TIUCMMTX
"RTN","TIURA",34,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIURA",35,0)
 I '+$G(TIUDA) W !,"No Documents selected." H 2 Q
"RTN","TIURA",36,0)
 ; Evaluate edit privilege
"RTN","TIURA",37,0)
 S TIUEDIT=$$CANDO^TIULP(TIUDA,"EDIT RECORD")
"RTN","TIURA",38,0)
 ; if 'canedit, offer explanation, and let add addendum
"RTN","TIURA",39,0)
 I '+TIUEDIT D  Q
"RTN","TIURA",40,0)
 . K ^TIU(8925,"ASAVE",DUZ,TIUDA)
"RTN","TIURA",41,0)
 . W !!,$C(7),$P(TIUEDIT,U,2),!
"RTN","TIURA",42,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIURA",43,0)
 . D ADDENDUM^TIUADD(TIUDA,"",.TIUCHNG)
"RTN","TIURA",44,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0)),TIUT0=$G(^TIU(8925.1,+TIUTYP,0))
"RTN","TIURA",45,0)
 S TIUTYP(1)="1^"_+TIUTYP_U_$P(TIUT0,U,3)_U
"RTN","TIURA",46,0)
 S DFN=$P($G(^TIU(8925,+TIUDA,0)),U,2),TIULDT=$P(^(0),U,8)
"RTN","TIURA",47,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIURA",48,0)
 S DIWESUB="Patient: "_$G(TIU("PNM"))
"RTN","TIURA",49,0)
 D DIE^TIUEDI4(TIUDA,.TIUQUIT,.TIUCHNG) ; **100**
"RTN","TIURA",50,0)
 K ^TIU(8925,"ASAVE",DUZ,TIUDA)
"RTN","TIURA",51,0)
 I +$G(TIUCPYNG),+$G(TIUQUIT) D DELETE^TIUEDIT(TIUDA,0,"",1) Q
"RTN","TIURA",52,0)
 Q:+$G(TIUQUIT)=2
"RTN","TIURA",53,0)
 ;If (CP) and (Timeout or Not Select Consult) and (Consult Associated), Quit before EMPTYDOC check
"RTN","TIURA",54,0)
 I +$$ISA^TIULX(TIUTYP,+$$CLASS^TIUCP),+$G(TIUQUIT)=1,+$P($G(^TIU(8925,+TIUDA,14)),U,5)>0 Q
"RTN","TIURA",55,0)
 I $$EMPTYDOC^TIULF(TIUDA) D DELETE^TIUEDIT(TIUDA,0) S TIUCHNG("DELETE")=1 H 2 Q
"RTN","TIURA",56,0)
 Q:+$G(TIUQUIT)
"RTN","TIURA",57,0)
 I +$G(TIU("STOP")) D DEFER^TIUVSIT(TIUDA,TIU("STOP")) I 1
"RTN","TIURA",58,0)
 E  I +$P($G(^TIU(8925,+TIUDA,0)),U,3)'>0 D QUE^TIUPXAP1
"RTN","TIURA",59,0)
 ; - Commit proc -
"RTN","TIURA",60,0)
 S TIUCMMTX=$$COMMIT^TIULC1(+$P(TIUTYP(1),U,2))
"RTN","TIURA",61,0)
 I TIUCMMTX]"" D
"RTN","TIURA",62,0)
 . N DA S DA=TIUDA X TIUCMMTX
"RTN","TIURA",63,0)
 ;   i. Execute RELEASE logic
"RTN","TIURA",64,0)
 D RELEASE^TIUT(+TIUDA)
"RTN","TIURA",65,0)
 ;  ii. Execute VERIFICATION logic
"RTN","TIURA",66,0)
 D VERIFY^TIUT(+TIUDA)
"RTN","TIURA",67,0)
 ; iii. Execute ES logic
"RTN","TIURA",68,0)
 D EDSIG^TIURS(+TIUDA,"",1)
"RTN","TIURA",69,0)
 ;  iv. If document is an ADDENDUM process alert
"RTN","TIURA",70,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D SENDADD^TIUALRT(+TIUDA)
"RTN","TIURA",71,0)
 I $D(^TMP("TIUR",$J,"CTXT")),(+$P($G(^TIU(8925,+TIUDA,0)),U,5)'<6) S VALMBCK="Q"
"RTN","TIURA",72,0)
 Q
"RTN","TIURA",73,0)
PRINT ; Print selected documents
"RTN","TIURA",74,0)
 N DFN,TIUDA,TIUDARR,TIUDATA,TIUI,DIROUT,TIUDE,POP,TIUPFLG,TIUDEV
"RTN","TIURA",75,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0)) G:$D(VALMY)'>9 PRINTX
"RTN","TIURA",76,0)
 D CLEAR^VALM1
"RTN","TIURA",77,0)
 D PRNTSCRN^TIURA2(.VALMY)
"RTN","TIURA",78,0)
 I '$D(VALMY) D  G PRINTX
"RTN","TIURA",79,0)
 . W !!,"No Printable Documents Remain in your List.",!
"RTN","TIURA",80,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIURA",81,0)
 I +$$CHARTANY^TIURA1(.VALMY) S TIUPFLG=$$FLAG^TIUPRPN3
"RTN","TIURA",82,0)
 S TIUDEV=$$DEVICE^TIUDEV(.IO) ; Get Device/allow queueing
"RTN","TIURA",83,0)
 I $S(IO']"":1,TIUDEV']"":1,1:0) G PRINTX
"RTN","TIURA",84,0)
 I $D(IO("Q")) D QUE^TIUDEV("PRINTN^TIURA",TIUDEV) G PRINTX
"RTN","TIURA",85,0)
 D PRINTN
"RTN","TIURA",86,0)
PRINTX N IOSTBM D ^%ZISC,FIXLSTNW^TIULM
"RTN","TIURA",87,0)
 K VALMY S VALMBCK="R"
"RTN","TIURA",88,0)
 Q
"RTN","TIURA",89,0)
PRINTN ; Loop through selected doc's & invoke print code
"RTN","TIURA",90,0)
 N TIUI,TIUTYP,TIUDARR,DFN K ^TMP("TIUPR",$J)
"RTN","TIURA",91,0)
 N ARRAYDA
"RTN","TIURA",92,0)
 U IO
"RTN","TIURA",93,0)
 S TIUI=0
"RTN","TIURA",94,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA",95,0)
 . N TIUPMTHD,TIUDTYP,TIUPFHDR,TIUPFNBR,TIUPGRP,TIUPRINT,TIUFLAG
"RTN","TIURA",96,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA",97,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURA",98,0)
 . S TIUTYP=+$G(^TIU(8925,TIUDA,0)) ;P182
"RTN","TIURA",99,0)
 . I TIUTYP'>0 D  Q
"RTN","TIURA",100,0)
 . . W !!,"Item #",TIUI," no longer exists.",!
"RTN","TIURA",101,0)
 . . I IO=IO(0),'$D(ZTQUEUED),$$READ^TIUU("EA","RETURN to continue...")
"RTN","TIURA",102,0)
 . S ARRAYDA(TIUDA)=""
"RTN","TIURA",103,0)
 . ; -- If TIUDA is an addendum, print its parent instead,
"RTN","TIURA",104,0)
 . ;    or quit if the parent has already been printed: --
"RTN","TIURA",105,0)
 . I +$$ISADDNDM^TIULC1(TIUDA) D  Q:'TIUDA
"RTN","TIURA",106,0)
 . . S TIUDA=+$P($G(^TIU(8925,TIUDA,0)),U,6)
"RTN","TIURA",107,0)
 . . I $D(ARRAYDA(TIUDA)) S TIUDA=0 Q
"RTN","TIURA",108,0)
 . . S TIUDTYP=+$G(^TIU(8925,TIUDA,0))
"RTN","TIURA",109,0)
 . ; -- If TIUDA is an ID kid, print its parent instead,
"RTN","TIURA",110,0)
 . ;    or quit if the parent has already been printed: --
"RTN","TIURA",111,0)
 . I $G(^TIU(8925,TIUDA,21)) D  Q:'TIUDA
"RTN","TIURA",112,0)
 . . S TIUDA=^TIU(8925,TIUDA,21)
"RTN","TIURA",113,0)
 . . I $D(ARRAYDA(TIUDA)) S TIUDA=0 Q
"RTN","TIURA",114,0)
 . . S TIUDTYP=+$G(^TIU(8925,TIUDA,0))
"RTN","TIURA",115,0)
 . S TIUPRINT=$$CANDO^TIULP(TIUDA,"PRINT RECORD")
"RTN","TIURA",116,0)
 . I +TIUPRINT'>0 D  Q  ; Exclude records user can't print
"RTN","TIURA",117,0)
 . . W !!,"Item #",TIUI,": ",!,$P(TIUPRINT,U,2),!
"RTN","TIURA",118,0)
 . . I IO=IO(0),'$D(ZTQUEUED),$$READ^TIUU("EA","RETURN to continue...")
"RTN","TIURA",119,0)
 . I +$G(TIUPFLG) S TIUFLAG=+$$CHARTONE^TIURA1(TIUDA)
"RTN","TIURA",120,0)
 . S DFN=$P($G(^TIU(8925,+TIUDA,0)),U,2)
"RTN","TIURA",121,0)
 . I +TIUTYP,'$G(TIUDTYP) D
"RTN","TIURA",122,0)
 . . S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYP)
"RTN","TIURA",123,0)
 . . S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYP)
"RTN","TIURA",124,0)
 . . S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYP)
"RTN","TIURA",125,0)
 . . S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYP)
"RTN","TIURA",126,0)
 . I +$G(TIUDTYP) S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUDTYP),TIUPGRP=$$PRNTGRP^TIULG(+TIUDTYP),TIUPFHDR=$$PRNTHDR^TIULG(+TIUDTYP),TIUPFNBR=$$PRNTNBR^TIULG(+TIUDTYP)
"RTN","TIURA",127,0)
 . I $G(TIUPMTHD)']"" D  Q  ; Exclude records lacking print method P182
"RTN","TIURA",128,0)
 . . W !!,"Item #",TIUI," has no Print Method.",!
"RTN","TIURA",129,0)
 . . I IO=IO(0),'$D(ZTQUEUED),$$READ^TIUU("EA","RETURN to continue...")
"RTN","TIURA",130,0)
 . ;I +$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") S TIUDARR(TIUPMTHD,$G(TIUPGRP)_"$"_TIUPFHDR_";"_DFN,TIUI,TIUDA)=TIUPFNBR
"RTN","TIURA",131,0)
 . ;E  S TIUDARR(TIUPMTHD,DFN,TIUI,TIUDA)=""
"RTN","TIURA",132,0)
 . ; -- P182: Set array same whether or not flds are defined, with
"RTN","TIURA",133,0)
 . ;    TIUPGRP piece possibly 0, TIUPFHDR piece possibly null, and
"RTN","TIURA",134,0)
 . ;    array value TIUPFNBR possibly null.
"RTN","TIURA",135,0)
 . S TIUDARR(TIUPMTHD,+$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_DFN,TIUI,TIUDA)=$G(TIUPFNBR)
"RTN","TIURA",136,0)
 . D:'$D(ZTQUEUED) RESTORE^VALM10(+TIUI)
"RTN","TIURA",137,0)
 S TIUPMTHD="" F  S TIUPMTHD=$O(TIUDARR(TIUPMTHD)) Q:TIUPMTHD=""  D
"RTN","TIURA",138,0)
 . D PRNTDOC(TIUPMTHD,.TIUDARR)
"RTN","TIURA",139,0)
 Q
"RTN","TIURA",140,0)
PRINT1 ; Print a single document
"RTN","TIURA",141,0)
 N TIUDARR,TIUDEV,TIUTYP,DFN,TIUPMTHD,TIUD0,TIUDPRM,TIUFLAG,TIUDTYP
"RTN","TIURA",142,0)
 N TIUPGRP,TIUPFHDR,TIUPFNBR,TIUPRINT,POP,TIUTMPDA
"RTN","TIURA",143,0)
 D CLEAR^VALM1
"RTN","TIURA",144,0)
 S TIUTMPDA=TIUDA
"RTN","TIURA",145,0)
 I +$$ISADDNDM^TIULC1(TIUTMPDA) D
"RTN","TIURA",146,0)
 . S TIUTMPDA=+$P($G(^TIU(8925,TIUTMPDA,0)),U,6)
"RTN","TIURA",147,0)
 . S TIUDTYP=+$G(^TIU(8925,TIUTMPDA,0))
"RTN","TIURA",148,0)
 I $G(^TIU(8925,TIUTMPDA,21)) D
"RTN","TIURA",149,0)
 . S TIUTMPDA=^TIU(8925,TIUTMPDA,21)
"RTN","TIURA",150,0)
 . S TIUDTYP=+$G(^TIU(8925,TIUTMPDA,0))
"RTN","TIURA",151,0)
 S TIUPRINT=$$CANDO^TIULP(TIUTMPDA,"PRINT RECORD")
"RTN","TIURA",152,0)
 I +TIUPRINT'>0 D  Q
"RTN","TIURA",153,0)
 . W !!,$C(7),$P(TIUPRINT,U,2),!
"RTN","TIURA",154,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA",155,0)
 I +$G(TIUDTYP) D
"RTN","TIURA",156,0)
 . S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUDTYP)
"RTN","TIURA",157,0)
 . S TIUPGRP=$$PRNTGRP^TIULG(+TIUDTYP)
"RTN","TIURA",158,0)
 . S TIUPFHDR=$$PRNTHDR^TIULG(+TIUDTYP)
"RTN","TIURA",159,0)
 . S TIUPFNBR=$$PRNTNBR^TIULG(+TIUDTYP)
"RTN","TIURA",160,0)
 . D DOCPRM^TIULC1(+TIUDTYP,.TIUDPRM,TIUTMPDA)
"RTN","TIURA",161,0)
 S TIUD0=$G(^TIU(8925,TIUTMPDA,0))
"RTN","TIURA",162,0)
 S TIUTYP=$P(TIUD0,U),DFN=$P(TIUD0,U,2)
"RTN","TIURA",163,0)
 I +TIUTYP'>0 Q
"RTN","TIURA",164,0)
 I '$G(TIUDTYP) D
"RTN","TIURA",165,0)
 . S TIUPMTHD=$$PRNTMTHD^TIULG(+TIUTYP)
"RTN","TIURA",166,0)
 . S TIUPGRP=$$PRNTGRP^TIULG(+TIUTYP)
"RTN","TIURA",167,0)
 . S TIUPFHDR=$$PRNTHDR^TIULG(+TIUTYP)
"RTN","TIURA",168,0)
 . S TIUPFNBR=$$PRNTNBR^TIULG(+TIUTYP)
"RTN","TIURA",169,0)
 . D DOCPRM^TIULC1(+TIUTYP,.TIUDPRM,TIUTMPDA)
"RTN","TIURA",170,0)
 I +$P($G(TIUDPRM(0)),U,9) S TIUFLAG=$$FLAG^TIUPRPN3
"RTN","TIURA",171,0)
 I (+$P($G(TIUDPRM(0)),U,9)'>0),+$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION") S TIUFLAG=$$FLAG^TIUPRPN3
"RTN","TIURA",172,0)
 ;I $G(TIUPMTHD)]"",+$G(TIUPGRP),($G(TIUPFHDR)]""),($G(TIUPFNBR)]"") S TIUDARR(TIUPMTHD,$G(TIUPGRP)_"$"_TIUPFHDR_";"_DFN,1,TIUTMPDA)=TIUPFNBR
"RTN","TIURA",173,0)
 ;E  S TIUDARR(TIUPMTHD,DFN,1,TIUTMPDA)=""
"RTN","TIURA",174,0)
 I $G(TIUPMTHD)']"" W !,$C(7),"No Print Method Defined for ",$P($G(^TIU(8925.1,+TIUTYP,0)),U) H 2 G PRINT1X
"RTN","TIURA",175,0)
 ; -- P182: See PRINTN
"RTN","TIURA",176,0)
 S TIUDARR(TIUPMTHD,+$G(TIUPGRP)_"$"_$G(TIUPFHDR)_";"_DFN,1,TIUTMPDA)=$G(TIUPFNBR)
"RTN","TIURA",177,0)
 S TIUDEV=$$DEVICE^TIUDEV(.IO) ; Get Device
"RTN","TIURA",178,0)
 I $S(IO']"":1,TIUDEV']"":1,1:0) G PRINT1X
"RTN","TIURA",179,0)
 I $D(IO("Q")) D QUE^TIUDEV("PRINTQ^TIURA",TIUDEV) G PRINT1X
"RTN","TIURA",180,0)
 D PRINTQ
"RTN","TIURA",181,0)
PRINT1X D ^%ZISC
"RTN","TIURA",182,0)
 Q
"RTN","TIURA",183,0)
PRINTQ ; Queued document print
"RTN","TIURA",184,0)
 D PRNTDOC(TIUPMTHD,.TIUDARR)
"RTN","TIURA",185,0)
 Q
"RTN","TIURA",186,0)
PRNTDOC(TIUPMTHD,TIUDARR) ; Print docmts w/ Print Method TIUPMTHD in
"RTN","TIURA",187,0)
 ;array TIUDARR
"RTN","TIURA",188,0)
 ; Requires TIUPMTHD & TIUDARR
"RTN","TIURA",189,0)
 N TIUDA
"RTN","TIURA",190,0)
 I '+$D(TIUDARR) W !,"No Documents selected." Q
"RTN","TIURA",191,0)
 M ^TMP("TIUPR",$J)=TIUDARR(TIUPMTHD)
"RTN","TIURA",192,0)
 I TIUPMTHD']"" D  G PRNTDOCX
"RTN","TIURA",193,0)
 . W !!,"No Print Method Defined for ",$P(TIUTYP,U,2) H 2
"RTN","TIURA",194,0)
 X TIUPMTHD
"RTN","TIURA",195,0)
PRNTDOCX K ^TMP("TIUPR",$J)
"RTN","TIURA",196,0)
 Q
"RTN","TIURA",197,0)
BROWS1(TIULTMP) ; -- Call to BROWS1 for backward compatibility
"RTN","TIURA",198,0)
 D BROWS1^TIURA2(TIULTMP,TIUDA)
"RTN","TIURA",199,0)
 Q
"RTN","TIURA2")
0^14^B33326183
"RTN","TIURA2",1,0)
TIURA2 ; SLC/JER - More review screen actions ;4/29/04
"RTN","TIURA2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**88,58,100,123,112,182**;Jun 20, 1997
"RTN","TIURA2",3,0)
 ; 6/20/00: Moved DISPLAY, BROWSE, & BROWS1 from TIURA to TIURA2
"RTN","TIURA2",4,0)
DISPLAY ; Detailed Display
"RTN","TIURA2",5,0)
 N TIUDA,TIUD,TIUDATA,TIUI,Y,DIROUT,TIUQUIT,RSTRCTD
"RTN","TIURA2",6,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA2",7,0)
 S TIUI=0
"RTN","TIURA2",8,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(TIUQUIT)
"RTN","TIURA2",9,0)
 . N TIUVIEW
"RTN","TIURA2",10,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",11,0)
 . D CLEAR^VALM1
"RTN","TIURA2",12,0)
 . W !!,"Reviewing #",+TIUDATA
"RTN","TIURA2",13,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURA2",14,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURA2",15,0)
 . I +TIUVIEW'>0 D  Q
"RTN","TIURA2",16,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURA2",17,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",18,0)
 . . D RESTORE^VALM10(+TIUI)
"RTN","TIURA2",19,0)
 . S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA2",20,0)
 . I RSTRCTD D  Q
"RTN","TIURA2",21,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURA2",22,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",23,0)
 . . D RESTORE^VALM10(+TIUI)
"RTN","TIURA2",24,0)
 . D EN^TIUAUDIT
"RTN","TIURA2",25,0)
 . I +$G(TIUQUIT) D FIXLSTNW^TIULM Q
"RTN","TIURA2",26,0)
 . I TIUI'=$P($G(TIUGLINK),U,2) D RESTORE^VALM10(+TIUI) ; See rtn TIURL
"RTN","TIURA2",27,0)
 K VALMY S VALMBCK="R"
"RTN","TIURA2",28,0)
 Q
"RTN","TIURA2",29,0)
BROWSE(TIULTMP) ; Browse selected documents
"RTN","TIURA2",30,0)
 ; TIULTMP is list template name
"RTN","TIURA2",31,0)
 N TIUDA,DFN,TIU,TIUCHNG,TIUDATA,TIUI,Y,DIROUT,TIUQUIT
"RTN","TIURA2",32,0)
 N TIUGDATA
"RTN","TIURA2",33,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA2",34,0)
 S TIUI=0
"RTN","TIURA2",35,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(TIUQUIT)
"RTN","TIURA2",36,0)
 . N TIUVIEW,TIUGACT,RSTRCTD
"RTN","TIURA2",37,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",38,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURA2",39,0)
 . S TIUGDATA=$G(^TMP("TIUR",$J,"IDDATA",TIUDA)) ; ID note/entry
"RTN","TIURA2",40,0)
 . D CLEAR^VALM1
"RTN","TIURA2",41,0)
 . W !!,"Reviewing Item #",TIUI
"RTN","TIURA2",42,0)
 . S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA2",43,0)
 . I RSTRCTD D  Q
"RTN","TIURA2",44,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURA2",45,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",46,0)
 . D BROWS1(TIULTMP,TIUDA,TIUGDATA)
"RTN","TIURA2",47,0)
 ; -- Update or Rebuild list: --
"RTN","TIURA2",48,0)
 I $G(TIUCHNG("DELETE"))!$G(TIUCHNG("ADDM")) S TIUCHNG("RBLD")=1
"RTN","TIURA2",49,0)
 S TIUCHNG("UPDATE")=1 ; default
"RTN","TIURA2",50,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURA2",51,0)
 S VALMBCK="R"
"RTN","TIURA2",52,0)
 Q
"RTN","TIURA2",53,0)
GETSORT(PRMSORT,EXPSORT) ; Get order for ID entries
"RTN","TIURA2",54,0)
 Q $S($G(EXPSORT)'="":EXPSORT,1:PRMSORT)
"RTN","TIURA2",55,0)
 ;
"RTN","TIURA2",56,0)
BROWS1(TIULTMP,TIUDA,TIUGDATA) ; Browse single document
"RTN","TIURA2",57,0)
 ;  Calls EN^VALM
"RTN","TIURA2",58,0)
 N %DT,C,D0,DIQ2,FINISH,TIU,TIUVIEW
"RTN","TIURA2",59,0)
 I '$D(TIUGDATA) S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIURA2",60,0)
 I TIULTMP="TIU COMPLETE NOTES",$P(TIUGDATA,U,2) W !!,"You are completing the PARENT ENTRY of this interdisciplinary note."
"RTN","TIURA2",61,0)
 I '$P(TIUGDATA,U,2) D  Q:+TIUVIEW'>0  ;TIU*1*123
"RTN","TIURA2",62,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURA2",63,0)
 . I +TIUVIEW'>0 D
"RTN","TIURA2",64,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURA2",65,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",66,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIURA2",67,0)
 D EN^VALM(TIULTMP)
"RTN","TIURA2",68,0)
 K ^TMP("TIUVIEW",$J)
"RTN","TIURA2",69,0)
 Q
"RTN","TIURA2",70,0)
 ;
"RTN","TIURA2",71,0)
EXPAND ; Expand/Collapse ID notes, Addenda in lists
"RTN","TIURA2",72,0)
 N TIUDNM,TIULNM,TIUSTAT
"RTN","TIURA2",73,0)
 D:'$D(VALMY) EN^VALM2(XQORNOD(0))
"RTN","TIURA2",74,0)
 I $D(VALMY) D EC^TIURECL(.VALMY)
"RTN","TIURA2",75,0)
 W !,"Refreshing the list."
"RTN","TIURA2",76,0)
 K VALMY
"RTN","TIURA2",77,0)
 S VALMCNT=+$G(@VALMAR@(0))
"RTN","TIURA2",78,0)
 S VALMBCK="R"
"RTN","TIURA2",79,0)
 Q
"RTN","TIURA2",80,0)
 ;
"RTN","TIURA2",81,0)
PRNTSCRN(VALMY) ; Evaluate whether a record may be printed
"RTN","TIURA2",82,0)
 N TIUI S TIUI=""
"RTN","TIURA2",83,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA2",84,0)
 . N TIUPMTHD,TIUDTYP,TIUPFHDR,TIUPFNBR,TIUPGRP,TIUPRINT,TIUFLAG,RSTRCTD,TIUTYP
"RTN","TIURA2",85,0)
 . S RSTRCTD=0,TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",86,0)
 . S TIUDA=+$P(TIUDATA,U,2),TIUTYP=$P(^TIU(8925,TIUDA,0),U)
"RTN","TIURA2",87,0)
 . ; Evaluate whether user can print record
"RTN","TIURA2",88,0)
 . S TIUPRINT=$$CANDO^TIULP(TIUDA,"PRINT RECORD")
"RTN","TIURA2",89,0)
 . I +TIUPRINT'>0 D  Q
"RTN","TIURA2",90,0)
 . . W !!,"Item #",TIUI,": ",!,$P(TIUPRINT,U,2),!
"RTN","TIURA2",91,0)
 . . K VALMY(TIUI)
"RTN","TIURA2",92,0)
 . . I $$READ^TIUU("EA","RETURN to continue...")
"RTN","TIURA2",93,0)
 . ;-- Add Check for restricted record when available --
"RTN","TIURA2",94,0)
 . S DFN=+$P(^TIU(8925,TIUDA,0),U,2)
"RTN","TIURA2",95,0)
 . S RSTRCTD=$$PTRES^TIULRR(DFN)
"RTN","TIURA2",96,0)
 . I +RSTRCTD D  Q
"RTN","TIURA2",97,0)
 . . W !!,"Item #",TIUI," Removed from print list.",!
"RTN","TIURA2",98,0)
 . . K VALMY(TIUI)
"RTN","TIURA2",99,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIURA2",100,0)
 . I +$G(TIUPFLG) S TIUFLAG=+$$CHARTONE^TIURA1(TIUDA)
"RTN","TIURA2",101,0)
 Q
"RTN","TIURA2",102,0)
DICTATED        ; Mark Document(s) "dictated"
"RTN","TIURA2",103,0)
 N TIUCHNG,TIUI,TIUY,Y,DIROUT
"RTN","TIURA2",104,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURA2",105,0)
 S TIUI=0
"RTN","TIURA2",106,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURA2",107,0)
 . N TIU,DFN,TIUDA,TIUDATA,RSTRCTD
"RTN","TIURA2",108,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURA2",109,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURA2",110,0)
 . I RSTRCTD D  Q
"RTN","TIURA2",111,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURA2",112,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURA2",113,0)
 . D EN^VALM("TIU DOCUMENT DICTATED")
"RTN","TIURA2",114,0)
 ; -- Update or Rebuild list: --
"RTN","TIURA2",115,0)
 S TIUCHNG("UPDATE")=1
"RTN","TIURA2",116,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURA2",117,0)
 S VALMBCK="R"
"RTN","TIURA2",118,0)
 Q
"RTN","TIURA2",119,0)
DICTATE1(TIUDA) ; Single record sign on chart
"RTN","TIURA2",120,0)
 N DICMSG D FULL^VALM1
"RTN","TIURA2",121,0)
 D DICT(TIUDA,.DICMSG)
"RTN","TIURA2",122,0)
 W !!,$G(DICMSG(1)),!,$G(DICMSG(2)),! H $S($D(DICMSG(0)):+DICMSG(0),1:3)
"RTN","TIURA2",123,0)
 Q
"RTN","TIURA2",124,0)
DICT(DA,MSG) ; Mark signed on chart. Edit on-chart signatures.
"RTN","TIURA2",125,0)
 N AUTHOR,DIE,DR,Y,TIUSTAT,EXPCSNR,ATTNDNG,TIUDA,TIUPRMT,TIU0,TIU12,TIU13
"RTN","TIURA2",126,0)
 S TIU0=$G(^TIU(8925,+DA,0)),TIU12=$G(^(12)),TIU13=$G(^(13))
"RTN","TIURA2",127,0)
 S TIUSTAT=$P(TIU0,U,5)
"RTN","TIURA2",128,0)
 S TIUPRMT=$S(TIUSTAT>1:"Edit Dictation Data? ",1:"Has this document been dictated? ")
"RTN","TIURA2",129,0)
 W ! S MSG=$$READ^TIUU("YAO",TIUPRMT,"NO") W !
"RTN","TIURA2",130,0)
 I 'MSG S TIUCHNG=0 G DICTX
"RTN","TIURA2",131,0)
 S TIUCHNG=1
"RTN","TIURA2",132,0)
 S AUTHOR=$$PERSNAME^TIULC1(+$P(TIU12,U,2))
"RTN","TIURA2",133,0)
 S EXPCSNR=$$PERSNAME^TIULC1(+$P(TIU12,U,8))
"RTN","TIURA2",134,0)
 S:+$P(TIU12,U,9) ATTNDNG=$$PERSNAME^TIULC1(+$P(TIU12,U,9))
"RTN","TIURA2",135,0)
 S DR="1202//^S X=AUTHOR;1307//^S X=$S(+$P(TIU13,U,7)'>0:""NOW"",1:$$DATE^TIULS(+$P(TIU13,U,7),""MM/DD/CCYY@HR:MIN:SEC""))"
"RTN","TIURA2",136,0)
 I $D(ATTNDNG) S DR=DR_";1209//^S X=ATTNDNG"
"RTN","TIURA2",137,0)
 E  I $D(EXPCSNR) S DR=DR_";1208//^S X=EXPCSNR"
"RTN","TIURA2",138,0)
 S DR=DR_";1204////^S X=$$WHOSIGNS^TIULC1(DA);1208////^S X=$$WHOCOSIG^TIULC1(DA)"
"RTN","TIURA2",139,0)
 S DIE=8925 D ^DIE
"RTN","TIURA2",140,0)
 S TIU0=$G(^TIU(8925,+DA,0)),TIU12=$G(^(12)),TIU13=$G(^(13))
"RTN","TIURA2",141,0)
 ;Toggle status between undictated and untranscribed, depending on Dict Date
"RTN","TIURA2",142,0)
 S DR=".05///^S X=$S(+$P(TIU13,U,7):""UNTRANSCRIBED"",1:""UNDICTATED"")",DIE=8925 D ^DIE
"RTN","TIURA2",143,0)
 D UPDTIRT^TIUDIRT(.TIU,+DA)
"RTN","TIURA2",144,0)
DICTX S MSG(1)="  Dictation data "_$S(TIUCHNG:"",1:"NOT ")_"changed."
"RTN","TIURA2",145,0)
 Q
"RTN","TIURC")
0^16^B18442801
"RTN","TIURC",1,0)
TIURC ; SLC/JER - Additional Review screen actions ;5/19/04
"RTN","TIURC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,4,36,48,67,79,58,100,182**;Jun 20, 1997
"RTN","TIURC",3,0)
VERIFY ; Verify Documents
"RTN","TIURC",4,0)
 N TIUCHNG,TIUDATA,TIUI,TIUY,Y,DIROUT,TIULST,TIUDAARY
"RTN","TIURC",5,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURC",6,0)
 S TIUI=0
"RTN","TIURC",7,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURC",8,0)
 . N TIU,TIUDATA,TIUDA,RSTRCTD
"RTN","TIURC",9,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURC",10,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURC",11,0)
 . I RSTRCTD D  Q
"RTN","TIURC",12,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURC",13,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC",14,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURC",15,0)
 . S TIUCHNG=0
"RTN","TIURC",16,0)
 . D EN^VALM("TIU VERIFY")
"RTN","TIURC",17,0)
 . K ^TMP("TIUVIEW",$J)
"RTN","TIURC",18,0)
 . I +$G(TIUCHNG) D
"RTN","TIURC",19,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURC",20,0)
 ; -- Update or Rebuild list, restore video:
"RTN","TIURC",21,0)
 I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURC",22,0)
 E  S TIUCHNG("UPDATE")=1
"RTN","TIURC",23,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURC",24,0)
 S VALMBCK="R"
"RTN","TIURC",25,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"verified/unverified")
"RTN","TIURC",26,0)
 Q
"RTN","TIURC",27,0)
VERIFY1 ; Single record verify
"RTN","TIURC",28,0)
 ; Receives TIUDA
"RTN","TIURC",29,0)
 N DA,DIE,DR,TIUTYP,TIUQUIT,TIUT0,TIUTNM,TIUVERX
"RTN","TIURC",30,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0)),TIUT0=$G(^TIU(8925.1,+TIUTYP,0))
"RTN","TIURC",31,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYP)
"RTN","TIURC",32,0)
 S TIUTYP(1)="1^"_+TIUTYP_U_TIUTNM_U
"RTN","TIURC",33,0)
 I $$DADORKID^TIUGBR(TIUDA) D  Q
"RTN","TIURC",34,0)
 . W !!,$C(7),"This ",TIUTNM," is an interdisciplinary entry.",!,"ID entries must be verified prior to attaching.",!
"RTN","TIURC",35,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC",36,0)
 I +$P($G(^TIU(8925,+TIUDA,15)),U)!+$P($G(^(15)),U,7) D  Q
"RTN","TIURC",37,0)
 . W !!,$C(7),"This ",TIUTNM," is already signed.",!
"RTN","TIURC",38,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC",39,0)
 ; -- Can't verify admin closed docmts (P182):
"RTN","TIURC",40,0)
 I +$P($G(^TIU(8925,+TIUDA,16)),U,6) D  Q
"RTN","TIURC",41,0)
 . W !!,$C(7),"This ",TIUTNM," is already closed.",!
"RTN","TIURC",42,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC",43,0)
 I +$P($G(^TIU(8925,+TIUDA,13)),U,5) D  Q
"RTN","TIURC",44,0)
 . W !!,"This ",TIUTNM," is already verified."
"RTN","TIURC",45,0)
 . S TIUY=$$READ^TIUU("YO","Do you want to UNVERIFY this "_TIUTNM,"NO","^D UNVER^TIUDIRH")
"RTN","TIURC",46,0)
 . I TIUY W !,TIUTNM," UNVERIFIED" D
"RTN","TIURC",47,0)
 . . S DA=TIUDA,DIE=8925,DR=".05///UNVERIFIED;1305///@;1306///@" D ^DIE
"RTN","TIURC",48,0)
 . . W "." S TIUCHNG=1
"RTN","TIURC",49,0)
 . . D ALERTDEL^TIUALRT(TIUDA)
"RTN","TIURC",50,0)
 N DUOUT,DIROUT,DTOUT
"RTN","TIURC",51,0)
 S TIUY=$$READ^TIUU("YO","Do you want to edit this "_TIUTNM,"NO")
"RTN","TIURC",52,0)
 I +TIUY D
"RTN","TIURC",53,0)
 . D GETTIU^TIULD(.TIU,TIUDA),CLEAR^VALM1
"RTN","TIURC",54,0)
 . D DIE^TIUEDI4(TIUDA,.TIUQUIT) ; **100**
"RTN","TIURC",55,0)
 I +TIUY'>0,$S(+$G(TIUQUIT):1,$D(DUOUT):1,$D(DIROUT):1,$D(DTOUT):1,1:0) Q
"RTN","TIURC",56,0)
 S TIUY=$$READ^TIUU("YO","VERIFY this "_TIUTNM,"NO","^D VER^TIUDIRH")
"RTN","TIURC",57,0)
 I 'TIUY W !,TIUTNM," NOT VERIFIED." Q
"RTN","TIURC",58,0)
 S DA=TIUDA,DIE=8925,DR=".05///UNSIGNED;1305////"_$$NOW^TIULC_";1306////"_$G(DUZ) D ^DIE
"RTN","TIURC",59,0)
 S TIUCHNG=1,TIUVERX=$$VERIFY^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIURC",60,0)
 I TIUVERX]"" X TIUVERX
"RTN","TIURC",61,0)
 I +DA W !,TIUTNM," VERIFIED." D MAIN^TIUPD(DA,"V"),SEND^TIUALRT(DA)
"RTN","TIURC",62,0)
 Q
"RTN","TIURC",63,0)
ADD ; Add Document
"RTN","TIURC",64,0)
 N TIUONCE,TIUNDA,TIUCLASS,TIUCREAT,TIUITEM,LINENO,VALMY,TIUCHNG,RSTRCTD
"RTN","TIURC",65,0)
 ; OK to new TIUCHNG here, this is not used in browse.
"RTN","TIURC",66,0)
 S TIUONCE=1
"RTN","TIURC",67,0)
 S TIUCLASS=$S($G(VALM("ENTITY"))="Progress Note":3,$G(VALM("ENTITY"))="Discharge Summary":244,1:38)
"RTN","TIURC",68,0)
 D FULL^VALM1
"RTN","TIURC",69,0)
 I +$G(DFN) D  Q:+$G(RSTRCTD)
"RTN","TIURC",70,0)
 . S RSTRCTD=$$PTRES^TIULRR(DFN)
"RTN","TIURC",71,0)
 . I RSTRCTD D  Q
"RTN","TIURC",72,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURC",73,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC",74,0)
 ; -- MAIN^TIUEDIT looks like:
"RTN","TIURC",75,0)
 ;    MAIN(TIUCLASS,SUCCESS,DFN,TIUTITLE,EVNTFLAG,NOSAVE,
"RTN","TIURC",76,0)
 ;         TIUNDA,TIUSNGL,TIUCHNG)
"RTN","TIURC",77,0)
 ;    i.e. TIUTITLE,EVNTFLAG,NOSAVE,TIUSNGL are null
"RTN","TIURC",78,0)
 D MAIN^TIUEDIT(TIUCLASS,.TIUCREAT,+$G(DFN),"","","",.TIUNDA,"",.TIUCHNG)
"RTN","TIURC",79,0)
 I $G(TIUCHNG("DELETE"))!$G(TIUCHNG("ADDM"))!$G(TIUCHNG("EXIST"))!$G(TIUCHNG("AVAIL")) S TIUCHNG("RBLD")=1
"RTN","TIURC",80,0)
 I +$O(TIUNDA(0))'>0 S TIUCHNG("REFRESH")=1 G ADDX
"RTN","TIURC",81,0)
 ; -- If in TIU OE/RR REVIEW PN, rebuild list and quit:
"RTN","TIURC",82,0)
 I $G(^TMP("TIUR",$J,"RTN"))="TIUROR" S TIUCHNG("RBLD")=1 G ADDX
"RTN","TIURC",83,0)
 ; -- If in Review Notes by Patient (no review screen),
"RTN","TIURC",84,0)
 ;    or rebuilding, don't add elements to end of screen:
"RTN","TIURC",85,0)
 I '$D(^TMP("TIUR",$J,"RTN")) G ADDX
"RTN","TIURC",86,0)
 I $G(TIUCHNG("RBLD")) G ADDX
"RTN","TIURC",87,0)
 ; -- If in an integrated docmts option, add one line
"RTN","TIURC",88,0)
 ;    to screen for each new docmt, refresh list, and quit:
"RTN","TIURC",89,0)
 S TIUNDA=0
"RTN","TIURC",90,0)
 F  S TIUNDA=$O(TIUNDA(TIUNDA)) Q:+TIUNDA'>0  D
"RTN","TIURC",91,0)
 . S TIUITEM=+$G(^TMP("TIUR",$J,0))
"RTN","TIURC",92,0)
 . ; -- Don't add if editing existing docmt which is already in list:
"RTN","TIURC",93,0)
 . S LINENO=$O(^TMP("TIUR",$J,"IEN",TIUNDA,0))
"RTN","TIURC",94,0)
 . I LINENO D  Q
"RTN","TIURC",95,0)
 . . S VALMY(LINENO)="",TIUCHNG("UPDATE")=1
"RTN","TIURC",96,0)
 . D ADDELMNT^TIUR2(TIUNDA,+TIUITEM,1)
"RTN","TIURC",97,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURC",98,0)
ADDX D UPRBLD^TIURL(.TIUCHNG,.VALMY)
"RTN","TIURC",99,0)
 Q
"RTN","TIURC",100,0)
COPY1 ; -- Call to COPY1 for backward compatibility
"RTN","TIURC",101,0)
 G COPY1^TIURC1
"RTN","TIURC",102,0)
 Q
"VER")
8.0^22.0
"^DD",8925,8925,70201,0)
PROCEDURE SUMMARY CODE^S^1:Normal;2:Abnormal;3:Borderline;4:Incomplete;5:Machine Resulted;^702;1^Q
"^DD",8925,8925,70201,3)
Indicate the summary code for this procedure once it is complete.
"^DD",8925,8925,70201,21,0)
^.001^2^2^3041110^^
"^DD",8925,8925,70201,21,1,0)
This field contains the summary code for this procedure once it is
"^DD",8925,8925,70201,21,2,0)
complete.  'Machine Resulted' is the initial, default code.
"^DD",8925,8925,70201,"DT")
3040722
"BLD",5082,6)
^SEQ #182
**END**
**END**
