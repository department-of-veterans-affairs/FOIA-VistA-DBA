KIDS Distribution saved on Oct 24, 1997@15:33:12
Drug Accountability/Inventory Interface V. 3.0
**KIDS**:DRUG ACCOUNTABILITY V. 3.0^

**INSTALL NAME**
DRUG ACCOUNTABILITY V. 3.0
"BLD",334,0)
DRUG ACCOUNTABILITY V. 3.0^DRUG ACCOUNTABILITY^0^2971024^y
"BLD",334,1,0)
^^1^1^2971024^
"BLD",334,1,1,0)
Drug Accountability/Inventory Interface V. 3.0
"BLD",334,4,0)
^9.64PA^58.8^4
"BLD",334,4,58.8,0)
58.8
"BLD",334,4,58.8,222)
y^y^f^^^^n
"BLD",334,4,58.81,0)
58.81
"BLD",334,4,58.81,222)
y^y^f^^^^n
"BLD",334,4,58.811,0)
58.811
"BLD",334,4,58.811,222)
y^y^f^^^^n
"BLD",334,4,58.84,0)
58.84
"BLD",334,4,58.84,222)
y^y^f^^n^^y^o^y
"BLD",334,4,"B",58.8,58.8)

"BLD",334,4,"B",58.81,58.81)

"BLD",334,4,"B",58.811,58.811)

"BLD",334,4,"B",58.84,58.84)

"BLD",334,"ABPKG")
n
"BLD",334,"INIT")
PSAPOST
"BLD",334,"KRN",0)
^9.67PA^19^18
"BLD",334,"KRN",.4,0)
.4
"BLD",334,"KRN",.4,"NM",0)
^9.68A^5^5
"BLD",334,"KRN",.4,"NM",1,0)
PSADRI    FILE #50^50^0
"BLD",334,"KRN",.4,"NM",2,0)
PSADRIH    FILE #50^50^0
"BLD",334,"KRN",.4,"NM",3,0)
PSADRIP    FILE #50^50^0
"BLD",334,"KRN",.4,"NM",4,0)
PSAINV    FILE #58.8^58.8^0
"BLD",334,"KRN",.4,"NM",5,0)
PSANDC    FILE #50.6^50.6^0
"BLD",334,"KRN",.4,"NM","B","PSADRI    FILE #50",1)

"BLD",334,"KRN",.4,"NM","B","PSADRIH    FILE #50",2)

"BLD",334,"KRN",.4,"NM","B","PSADRIP    FILE #50",3)

"BLD",334,"KRN",.4,"NM","B","PSAINV    FILE #58.8",4)

"BLD",334,"KRN",.4,"NM","B","PSANDC    FILE #50.6",5)

"BLD",334,"KRN",.401,0)
.401
"BLD",334,"KRN",.402,0)
.402
"BLD",334,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",334,"KRN",.402,"NM",1,0)
PSAENT    FILE #58.8^58.8^0
"BLD",334,"KRN",.402,"NM",2,0)
PSAGIP    FILE #58.8^58.8^0
"BLD",334,"KRN",.402,"NM","B","PSAENT    FILE #58.8",1)

"BLD",334,"KRN",.402,"NM","B","PSAGIP    FILE #58.8",2)

"BLD",334,"KRN",.403,0)
.403
"BLD",334,"KRN",.5,0)
.5
"BLD",334,"KRN",.84,0)
.84
"BLD",334,"KRN",3.6,0)
3.6
"BLD",334,"KRN",3.8,0)
3.8
"BLD",334,"KRN",9.2,0)
9.2
"BLD",334,"KRN",9.2,"NM",0)
^9.68A^12^12
"BLD",334,"KRN",9.2,"NM",1)
^^^
"BLD",334,"KRN",9.2,"NM",1,0)
PSA AR/WS^^1
"BLD",334,"KRN",9.2,"NM",2)
^^^
"BLD",334,"KRN",9.2,"NM",2,0)
PSA AUTOMATED CONNECTION^^1
"BLD",334,"KRN",9.2,"NM",3)
^^^
"BLD",334,"KRN",9.2,"NM",3,0)
PSA CONTROLLED CONNECTION^^1
"BLD",334,"KRN",9.2,"NM",4)
^^^
"BLD",334,"KRN",9.2,"NM",4,0)
PSA DRUG ACCOUNTABILITY^^1
"BLD",334,"KRN",9.2,"NM",5)
^^^
"BLD",334,"KRN",9.2,"NM",5,0)
PSA CONNECTION MENU^^1
"BLD",334,"KRN",9.2,"NM",6)
^^^
"BLD",334,"KRN",9.2,"NM",6,0)
PSA LOCATION EDIT^^1
"BLD",334,"KRN",9.2,"NM",7)
^^^
"BLD",334,"KRN",9.2,"NM",7,0)
PSA NDC^^1
"BLD",334,"KRN",9.2,"NM",8)
^^^
"BLD",334,"KRN",9.2,"NM",8,0)
PSA PERPETUAL INVENTORY^^1
"BLD",334,"KRN",9.2,"NM",9)
^^^
"BLD",334,"KRN",9.2,"NM",9,0)
PSA PRIMARY INVENTORY POINT^^1
"BLD",334,"KRN",9.2,"NM",10)
^^^
"BLD",334,"KRN",9.2,"NM",10,0)
PSA PRIME VENDOR^^1
"BLD",334,"KRN",9.2,"NM",11)
^^^
"BLD",334,"KRN",9.2,"NM",11,0)
PSA RECEIVING^^1
"BLD",334,"KRN",9.2,"NM",12)
^^^
"BLD",334,"KRN",9.2,"NM",12,0)
PSA SINGLE DRUG MATCH^^1
"BLD",334,"KRN",9.2,"NM","B","PSA AR/WS",1)

"BLD",334,"KRN",9.2,"NM","B","PSA AUTOMATED CONNECTION",2)

"BLD",334,"KRN",9.2,"NM","B","PSA CONNECTION MENU",5)

"BLD",334,"KRN",9.2,"NM","B","PSA CONTROLLED CONNECTION",3)

"BLD",334,"KRN",9.2,"NM","B","PSA DRUG ACCOUNTABILITY",4)

"BLD",334,"KRN",9.2,"NM","B","PSA LOCATION EDIT",6)

"BLD",334,"KRN",9.2,"NM","B","PSA NDC",7)

"BLD",334,"KRN",9.2,"NM","B","PSA PERPETUAL INVENTORY",8)

"BLD",334,"KRN",9.2,"NM","B","PSA PRIMARY INVENTORY POINT",9)

"BLD",334,"KRN",9.2,"NM","B","PSA PRIME VENDOR",10)

"BLD",334,"KRN",9.2,"NM","B","PSA RECEIVING",11)

"BLD",334,"KRN",9.2,"NM","B","PSA SINGLE DRUG MATCH",12)

"BLD",334,"KRN",9.8,0)
9.8
"BLD",334,"KRN",9.8,"NM",0)
^9.68A^116^113
"BLD",334,"KRN",9.8,"NM",1,0)
PSACON^^0^B11156423
"BLD",334,"KRN",9.8,"NM",2,0)
PSACON1^^0^B6728697
"BLD",334,"KRN",9.8,"NM",3,0)
PSACON2^^0^B14430118
"BLD",334,"KRN",9.8,"NM",4,0)
PSACONW^^0^B10426785
"BLD",334,"KRN",9.8,"NM",5,0)
PSACOST^^0^B29116689
"BLD",334,"KRN",9.8,"NM",6,0)
PSACREDO^^0^B70380086
"BLD",334,"KRN",9.8,"NM",7,0)
PSACREDR^^0^B29238766
"BLD",334,"KRN",9.8,"NM",8,0)
PSADA^^0^B17894012
"BLD",334,"KRN",9.8,"NM",9,0)
PSADAI^^0^B16881459
"BLD",334,"KRN",9.8,"NM",10,0)
PSADJ^^0^B43436108
"BLD",334,"KRN",9.8,"NM",11,0)
PSADJI^^0^B10851547
"BLD",334,"KRN",9.8,"NM",12,0)
PSADJR^^0^B20301579
"BLD",334,"KRN",9.8,"NM",14,0)
PSADRU^^0^B12305810
"BLD",334,"KRN",9.8,"NM",15,0)
PSADRUG^^0^B21853949
"BLD",334,"KRN",9.8,"NM",16,0)
PSADRUGP^^0^B19317845
"BLD",334,"KRN",9.8,"NM",17,0)
PSAENT^^0^B16807435
"BLD",334,"KRN",9.8,"NM",18,0)
PSAENTO^^0^B47506063
"BLD",334,"KRN",9.8,"NM",19,0)
PSAENVIR^^0^B9070577
"BLD",334,"KRN",9.8,"NM",20,0)
PSAGIP^^0^B23156140
"BLD",334,"KRN",9.8,"NM",21,0)
PSAGIP1^^0^B15477240
"BLD",334,"KRN",9.8,"NM",22,0)
PSAHIS^^0^B22842217
"BLD",334,"KRN",9.8,"NM",23,0)
PSAHIS1^^0^B38497683
"BLD",334,"KRN",9.8,"NM",24,0)
PSALEVEL^^0^B42942400
"BLD",334,"KRN",9.8,"NM",26,0)
PSALFA^^0^B15382366
"BLD",334,"KRN",9.8,"NM",27,0)
PSALFM^^0^B6434024
"BLD",334,"KRN",9.8,"NM",28,0)
PSALFS^^0^B9346895
"BLD",334,"KRN",9.8,"NM",29,0)
PSALNA^^0^B16278285
"BLD",334,"KRN",9.8,"NM",30,0)
PSALND^^0^B9745215
"BLD",334,"KRN",9.8,"NM",31,0)
PSALNM^^0^B4238211
"BLD",334,"KRN",9.8,"NM",32,0)
PSALOG^^0^B23075878
"BLD",334,"KRN",9.8,"NM",33,0)
PSALOG0^^0^B9534043
"BLD",334,"KRN",9.8,"NM",34,0)
PSALOG1^^0^B13165498
"BLD",334,"KRN",9.8,"NM",35,0)
PSALOG1H^^0^B7881402
"BLD",334,"KRN",9.8,"NM",36,0)
PSALOG2^^0^B25456790
"BLD",334,"KRN",9.8,"NM",37,0)
PSALOG3^^0^B4005996
"BLD",334,"KRN",9.8,"NM",38,0)
PSALOGON^^0^B5620706
"BLD",334,"KRN",9.8,"NM",40,0)
PSANAC^^0^B26095776
"BLD",334,"KRN",9.8,"NM",41,0)
PSANDC^^0^B11125863
"BLD",334,"KRN",9.8,"NM",42,0)
PSANDF^^0^B56425423
"BLD",334,"KRN",9.8,"NM",43,0)
PSANDF1^^0^B9896545
"BLD",334,"KRN",9.8,"NM",44)
^^^
"BLD",334,"KRN",9.8,"NM",44,0)
PSAONL^^1^B318620
"BLD",334,"KRN",9.8,"NM",45,0)
PSAOP^^0^B33230190
"BLD",334,"KRN",9.8,"NM",46,0)
PSAOP1^^0^B17931264
"BLD",334,"KRN",9.8,"NM",47,0)
PSAOP2^^0^B29186825
"BLD",334,"KRN",9.8,"NM",48,0)
PSAOP3^^0^B1700083
"BLD",334,"KRN",9.8,"NM",49,0)
PSAOP4^^0^B6250004
"BLD",334,"KRN",9.8,"NM",50,0)
PSAORDP^^0^B66639820
"BLD",334,"KRN",9.8,"NM",51,0)
PSAORDP1^^0^B64718282
"BLD",334,"KRN",9.8,"NM",52,0)
PSAORDP2^^0^B11720132
"BLD",334,"KRN",9.8,"NM",53,0)
PSAPOST^^0^B3787169
"BLD",334,"KRN",9.8,"NM",54,0)
PSAPROC^^0^B57730280
"BLD",334,"KRN",9.8,"NM",55,0)
PSAPROC1^^0^B36726244
"BLD",334,"KRN",9.8,"NM",56,0)
PSAPROC2^^0^B68760720
"BLD",334,"KRN",9.8,"NM",57,0)
PSAPROC3^^0^B50759949
"BLD",334,"KRN",9.8,"NM",58,0)
PSAPROC4^^0^B46247334
"BLD",334,"KRN",9.8,"NM",59,0)
PSAPROC5^^0^B43289322
"BLD",334,"KRN",9.8,"NM",60,0)
PSAPROC6^^0^B71935962
"BLD",334,"KRN",9.8,"NM",61,0)
PSAPROC7^^0^B29463325
"BLD",334,"KRN",9.8,"NM",62,0)
PSAPROC8^^0^B42291814
"BLD",334,"KRN",9.8,"NM",63,0)
PSAPROC9^^0^B63695164
"BLD",334,"KRN",9.8,"NM",64,0)
PSAPSI^^0^B24028473
"BLD",334,"KRN",9.8,"NM",65,0)
PSAPSI1^^0^B9513101
"BLD",334,"KRN",9.8,"NM",66,0)
PSAPSI2^^0^B24667963
"BLD",334,"KRN",9.8,"NM",67,0)
PSAPSI3^^0^B23307435
"BLD",334,"KRN",9.8,"NM",68,0)
PSAPSI4^^0^B3007637
"BLD",334,"KRN",9.8,"NM",69,0)
PSAPSI5^^0^B7116664
"BLD",334,"KRN",9.8,"NM",70,0)
PSAPUR^^0^B5628949
"BLD",334,"KRN",9.8,"NM",71,0)
PSAPV^^0^B24582055
"BLD",334,"KRN",9.8,"NM",72,0)
PSAREC^^0^B38410289
"BLD",334,"KRN",9.8,"NM",73,0)
PSAREC1^^0^B25107953
"BLD",334,"KRN",9.8,"NM",74,0)
PSAREORD^^0^B29683514
"BLD",334,"KRN",9.8,"NM",75,0)
PSAREPV^^0^B8564816
"BLD",334,"KRN",9.8,"NM",76,0)
PSAREV^^0^B8979963
"BLD",334,"KRN",9.8,"NM",77,0)
PSAREVC^^0^B12087001
"BLD",334,"KRN",9.8,"NM",78,0)
PSAREVD^^0^B14354651
"BLD",334,"KRN",9.8,"NM",79,0)
PSARIN^^0^B13046992
"BLD",334,"KRN",9.8,"NM",80,0)
PSARWS^^0^B16594818
"BLD",334,"KRN",9.8,"NM",81,0)
PSASIG^^0^B20550915
"BLD",334,"KRN",9.8,"NM",82,0)
PSATI^^0^B27630373
"BLD",334,"KRN",9.8,"NM",83,0)
PSATRAN^^0^B28465280
"BLD",334,"KRN",9.8,"NM",84,0)
PSATRAN1^^0^B20498296
"BLD",334,"KRN",9.8,"NM",85,0)
PSAUDP^^0^B9536295
"BLD",334,"KRN",9.8,"NM",86,0)
PSAUNI^^0^B12029895
"BLD",334,"KRN",9.8,"NM",87,0)
PSAUNL^^0^B6920762
"BLD",334,"KRN",9.8,"NM",88,0)
PSAUNM^^0^B6514917
"BLD",334,"KRN",9.8,"NM",89,0)
PSAUP^^0^B48235287
"BLD",334,"KRN",9.8,"NM",90,0)
PSAUP1^^0^B26408679
"BLD",334,"KRN",9.8,"NM",91,0)
PSAUP2^^0^B16813124
"BLD",334,"KRN",9.8,"NM",92,0)
PSAUP3^^0^B2511679
"BLD",334,"KRN",9.8,"NM",93,0)
PSAUP4^^0^B68852076
"BLD",334,"KRN",9.8,"NM",94,0)
PSAUP5^^0^B46189416
"BLD",334,"KRN",9.8,"NM",95,0)
PSAUP6^^0^B7903113
"BLD",334,"KRN",9.8,"NM",96,0)
PSAUTL^^0^B3306487
"BLD",334,"KRN",9.8,"NM",97,0)
PSAUTL1^^0^B34722514
"BLD",334,"KRN",9.8,"NM",98,0)
PSAUTL2^^0^B15097031
"BLD",334,"KRN",9.8,"NM",99,0)
PSAUTL3^^0^B22365082
"BLD",334,"KRN",9.8,"NM",100,0)
PSAUTL4^^0^B22876816
"BLD",334,"KRN",9.8,"NM",101,0)
PSAVER^^0^B73058041
"BLD",334,"KRN",9.8,"NM",102,0)
PSAVER1^^0^B45500503
"BLD",334,"KRN",9.8,"NM",103,0)
PSAVER2^^0^B44207438
"BLD",334,"KRN",9.8,"NM",104,0)
PSAVER3^^0^B62747199
"BLD",334,"KRN",9.8,"NM",105,0)
PSAVER4^^0^B8381163
"BLD",334,"KRN",9.8,"NM",106,0)
PSAVER5^^0^B26676151
"BLD",334,"KRN",9.8,"NM",107,0)
PSAVER6^^0^B29774458
"BLD",334,"KRN",9.8,"NM",108,0)
PSAVER7^^0^B31930451
"BLD",334,"KRN",9.8,"NM",109,0)
PSAVIN^^0^B8772386
"BLD",334,"KRN",9.8,"NM",110,0)
PSAVIN1^^0^B13547391
"BLD",334,"KRN",9.8,"NM",111,0)
PSAVIN2^^0^B12055488
"BLD",334,"KRN",9.8,"NM",112,0)
PSAVINC^^0^B10279199
"BLD",334,"KRN",9.8,"NM",113,0)
PSAWARD^^0^B20802300
"BLD",334,"KRN",9.8,"NM",114,0)
PSAMON^^0^B48673025
"BLD",334,"KRN",9.8,"NM",115,0)
PSAMON1^^0^B9687683
"BLD",334,"KRN",9.8,"NM",116,0)
PSALEVRP^^0^B50078903
"BLD",334,"KRN",9.8,"NM","B","PSACON",1)

"BLD",334,"KRN",9.8,"NM","B","PSACON1",2)

"BLD",334,"KRN",9.8,"NM","B","PSACON2",3)

"BLD",334,"KRN",9.8,"NM","B","PSACONW",4)

"BLD",334,"KRN",9.8,"NM","B","PSACOST",5)

"BLD",334,"KRN",9.8,"NM","B","PSACREDO",6)

"BLD",334,"KRN",9.8,"NM","B","PSACREDR",7)

"BLD",334,"KRN",9.8,"NM","B","PSADA",8)

"BLD",334,"KRN",9.8,"NM","B","PSADAI",9)

"BLD",334,"KRN",9.8,"NM","B","PSADJ",10)

"BLD",334,"KRN",9.8,"NM","B","PSADJI",11)

"BLD",334,"KRN",9.8,"NM","B","PSADJR",12)

"BLD",334,"KRN",9.8,"NM","B","PSADRU",14)

"BLD",334,"KRN",9.8,"NM","B","PSADRUG",15)

"BLD",334,"KRN",9.8,"NM","B","PSADRUGP",16)

"BLD",334,"KRN",9.8,"NM","B","PSAENT",17)

"BLD",334,"KRN",9.8,"NM","B","PSAENTO",18)

"BLD",334,"KRN",9.8,"NM","B","PSAENVIR",19)

"BLD",334,"KRN",9.8,"NM","B","PSAGIP",20)

"BLD",334,"KRN",9.8,"NM","B","PSAGIP1",21)

"BLD",334,"KRN",9.8,"NM","B","PSAHIS",22)

"BLD",334,"KRN",9.8,"NM","B","PSAHIS1",23)

"BLD",334,"KRN",9.8,"NM","B","PSALEVEL",24)

"BLD",334,"KRN",9.8,"NM","B","PSALEVRP",116)

"BLD",334,"KRN",9.8,"NM","B","PSALFA",26)

"BLD",334,"KRN",9.8,"NM","B","PSALFM",27)

"BLD",334,"KRN",9.8,"NM","B","PSALFS",28)

"BLD",334,"KRN",9.8,"NM","B","PSALNA",29)

"BLD",334,"KRN",9.8,"NM","B","PSALND",30)

"BLD",334,"KRN",9.8,"NM","B","PSALNM",31)

"BLD",334,"KRN",9.8,"NM","B","PSALOG",32)

"BLD",334,"KRN",9.8,"NM","B","PSALOG0",33)

"BLD",334,"KRN",9.8,"NM","B","PSALOG1",34)

"BLD",334,"KRN",9.8,"NM","B","PSALOG1H",35)

"BLD",334,"KRN",9.8,"NM","B","PSALOG2",36)

"BLD",334,"KRN",9.8,"NM","B","PSALOG3",37)

"BLD",334,"KRN",9.8,"NM","B","PSALOGON",38)

"BLD",334,"KRN",9.8,"NM","B","PSAMON",114)

"BLD",334,"KRN",9.8,"NM","B","PSAMON1",115)

"BLD",334,"KRN",9.8,"NM","B","PSANAC",40)

"BLD",334,"KRN",9.8,"NM","B","PSANDC",41)

"BLD",334,"KRN",9.8,"NM","B","PSANDF",42)

"BLD",334,"KRN",9.8,"NM","B","PSANDF1",43)

"BLD",334,"KRN",9.8,"NM","B","PSAONL",44)

"BLD",334,"KRN",9.8,"NM","B","PSAOP",45)

"BLD",334,"KRN",9.8,"NM","B","PSAOP1",46)

"BLD",334,"KRN",9.8,"NM","B","PSAOP2",47)

"BLD",334,"KRN",9.8,"NM","B","PSAOP3",48)

"BLD",334,"KRN",9.8,"NM","B","PSAOP4",49)

"BLD",334,"KRN",9.8,"NM","B","PSAORDP",50)

"BLD",334,"KRN",9.8,"NM","B","PSAORDP1",51)

"BLD",334,"KRN",9.8,"NM","B","PSAORDP2",52)

"BLD",334,"KRN",9.8,"NM","B","PSAPOST",53)

"BLD",334,"KRN",9.8,"NM","B","PSAPROC",54)

"BLD",334,"KRN",9.8,"NM","B","PSAPROC1",55)

"BLD",334,"KRN",9.8,"NM","B","PSAPROC2",56)

"BLD",334,"KRN",9.8,"NM","B","PSAPROC3",57)

"BLD",334,"KRN",9.8,"NM","B","PSAPROC4",58)

"BLD",334,"KRN",9.8,"NM","B","PSAPROC5",59)

"BLD",334,"KRN",9.8,"NM","B","PSAPROC6",60)

"BLD",334,"KRN",9.8,"NM","B","PSAPROC7",61)

"BLD",334,"KRN",9.8,"NM","B","PSAPROC8",62)

"BLD",334,"KRN",9.8,"NM","B","PSAPROC9",63)

"BLD",334,"KRN",9.8,"NM","B","PSAPSI",64)

"BLD",334,"KRN",9.8,"NM","B","PSAPSI1",65)

"BLD",334,"KRN",9.8,"NM","B","PSAPSI2",66)

"BLD",334,"KRN",9.8,"NM","B","PSAPSI3",67)

"BLD",334,"KRN",9.8,"NM","B","PSAPSI4",68)

"BLD",334,"KRN",9.8,"NM","B","PSAPSI5",69)

"BLD",334,"KRN",9.8,"NM","B","PSAPUR",70)

"BLD",334,"KRN",9.8,"NM","B","PSAPV",71)

"BLD",334,"KRN",9.8,"NM","B","PSAREC",72)

"BLD",334,"KRN",9.8,"NM","B","PSAREC1",73)

"BLD",334,"KRN",9.8,"NM","B","PSAREORD",74)

"BLD",334,"KRN",9.8,"NM","B","PSAREPV",75)

"BLD",334,"KRN",9.8,"NM","B","PSAREV",76)

"BLD",334,"KRN",9.8,"NM","B","PSAREVC",77)

"BLD",334,"KRN",9.8,"NM","B","PSAREVD",78)

"BLD",334,"KRN",9.8,"NM","B","PSARIN",79)

"BLD",334,"KRN",9.8,"NM","B","PSARWS",80)

"BLD",334,"KRN",9.8,"NM","B","PSASIG",81)

"BLD",334,"KRN",9.8,"NM","B","PSATI",82)

"BLD",334,"KRN",9.8,"NM","B","PSATRAN",83)

"BLD",334,"KRN",9.8,"NM","B","PSATRAN1",84)

"BLD",334,"KRN",9.8,"NM","B","PSAUDP",85)

"BLD",334,"KRN",9.8,"NM","B","PSAUNI",86)

"BLD",334,"KRN",9.8,"NM","B","PSAUNL",87)

"BLD",334,"KRN",9.8,"NM","B","PSAUNM",88)

"BLD",334,"KRN",9.8,"NM","B","PSAUP",89)

"BLD",334,"KRN",9.8,"NM","B","PSAUP1",90)

"BLD",334,"KRN",9.8,"NM","B","PSAUP2",91)

"BLD",334,"KRN",9.8,"NM","B","PSAUP3",92)

"BLD",334,"KRN",9.8,"NM","B","PSAUP4",93)

"BLD",334,"KRN",9.8,"NM","B","PSAUP5",94)

"BLD",334,"KRN",9.8,"NM","B","PSAUP6",95)

"BLD",334,"KRN",9.8,"NM","B","PSAUTL",96)

"BLD",334,"KRN",9.8,"NM","B","PSAUTL1",97)

"BLD",334,"KRN",9.8,"NM","B","PSAUTL2",98)

"BLD",334,"KRN",9.8,"NM","B","PSAUTL3",99)

"BLD",334,"KRN",9.8,"NM","B","PSAUTL4",100)

"BLD",334,"KRN",9.8,"NM","B","PSAVER",101)

"BLD",334,"KRN",9.8,"NM","B","PSAVER1",102)

"BLD",334,"KRN",9.8,"NM","B","PSAVER2",103)

"BLD",334,"KRN",9.8,"NM","B","PSAVER3",104)

"BLD",334,"KRN",9.8,"NM","B","PSAVER4",105)

"BLD",334,"KRN",9.8,"NM","B","PSAVER5",106)

"BLD",334,"KRN",9.8,"NM","B","PSAVER6",107)

"BLD",334,"KRN",9.8,"NM","B","PSAVER7",108)

"BLD",334,"KRN",9.8,"NM","B","PSAVIN",109)

"BLD",334,"KRN",9.8,"NM","B","PSAVIN1",110)

"BLD",334,"KRN",9.8,"NM","B","PSAVIN2",111)

"BLD",334,"KRN",9.8,"NM","B","PSAVINC",112)

"BLD",334,"KRN",9.8,"NM","B","PSAWARD",113)

"BLD",334,"KRN",19,0)
19
"BLD",334,"KRN",19,"NM",0)
^9.68A^72^72
"BLD",334,"KRN",19,"NM",1,0)
PSA ACTIVE DRUGS/ITEM FILE^^0
"BLD",334,"KRN",19,"NM",2,0)
PSA BALANCE ADJUSTMENTS^^0
"BLD",334,"KRN",19,"NM",3,0)
PSA BALANCE ADJUSTMENTS REPORT^^0
"BLD",334,"KRN",19,"NM",4,0)
PSA BALANCE INITIALIZE^^0
"BLD",334,"KRN",19,"NM",5,0)
PSA COMPARISON REPORT^^0
"BLD",334,"KRN",19,"NM",6,0)
PSA CONNECTION MENU^^0
"BLD",334,"KRN",19,"NM",7,0)
PSA CP TRANSACTION REVIEW^^0
"BLD",334,"KRN",19,"NM",8,0)
PSA CREDIT RESOLUTION^^0
"BLD",334,"KRN",19,"NM",9,0)
PSA DISPENSING MENU^^0
"BLD",334,"KRN",19,"NM",10,0)
PSA DISPLAY CONNECTED DRUG^^0
"BLD",334,"KRN",19,"NM",11,0)
PSA DISPLAY LOCATION^^0
"BLD",334,"KRN",19,"NM",12,0)
PSA DRUG ACCOUNTABILITY MENU^^0
"BLD",334,"KRN",19,"NM",13,0)
PSA DRUG DISPLAY^^0
"BLD",334,"KRN",19,"NM",14,0)
PSA DRUG ENTER/EDIT^^0
"BLD",334,"KRN",19,"NM",15,0)
PSA DRUG HISTORY^^0
"BLD",334,"KRN",19,"NM",16,0)
PSA DRUG INQUIRE^^0
"BLD",334,"KRN",19,"NM",17,0)
PSA DRUGS NOT IN INVENTORY^^0
"BLD",334,"KRN",19,"NM",18,0)
PSA FSN AUTO LOOP^^0
"BLD",334,"KRN",19,"NM",19,0)
PSA FSN CONTROL LOOP^^0
"BLD",334,"KRN",19,"NM",20,0)
PSA FSN MENU^^0
"BLD",334,"KRN",19,"NM",21,0)
PSA FSN REPORT^^0
"BLD",334,"KRN",19,"NM",22,0)
PSA GIP COMPARE^^0
"BLD",334,"KRN",19,"NM",23,0)
PSA GIP CONT BAL UPDATE^^0
"BLD",334,"KRN",19,"NM",24,0)
PSA GIP DISCREPANCIES^^0
"BLD",334,"KRN",19,"NM",25,0)
PSA GIP INTERFACE MENU^^0
"BLD",334,"KRN",19,"NM",26,0)
PSA GIP LINK REPORT^^0
"BLD",334,"KRN",19,"NM",27,0)
PSA GIP LOCATION MENU^^0
"BLD",334,"KRN",19,"NM",28,0)
PSA GIP MAINTENANCE RPT MENU^^0
"BLD",334,"KRN",19,"NM",29,0)
PSA GIP MENU^^0
"BLD",334,"KRN",19,"NM",30,0)
PSA GIP POPULATE^^0
"BLD",334,"KRN",19,"NM",31,0)
PSA GIP REPORT^^0
"BLD",334,"KRN",19,"NM",32,0)
PSA INVOICE COST SUMMARY^^0
"BLD",334,"KRN",19,"NM",33,0)
PSA INVOICE REVIEW^^0
"BLD",334,"KRN",19,"NM",34,0)
PSA IV ALL DRUGS^^0
"BLD",334,"KRN",19,"NM",35,0)
PSA IV ALL LOCATIONS^^0
"BLD",334,"KRN",19,"NM",36,0)
PSA IV SINGLE^^0
"BLD",334,"KRN",19,"NM",37,0)
PSA LOCATION EDIT^^0
"BLD",334,"KRN",19,"NM",38,0)
PSA MONTHLY SUMMARY^^0
"BLD",334,"KRN",19,"NM",39,0)
PSA NDC AUTO LOOP^^0
"BLD",334,"KRN",19,"NM",40,0)
PSA NDC CONTROL LOOP^^0
"BLD",334,"KRN",19,"NM",41,0)
PSA NDC DUPLICATE REPORT^^0
"BLD",334,"KRN",19,"NM",42,0)
PSA NDC MENU^^0
"BLD",334,"KRN",19,"NM",43,0)
PSA NDC REPORT^^0
"BLD",334,"KRN",19,"NM",44,0)
PSA OP ALL DRUGS^^0
"BLD",334,"KRN",19,"NM",45,0)
PSA OP SINGLE^^0
"BLD",334,"KRN",19,"NM",46,0)
PSA ORDERS ALERT^^0
"BLD",334,"KRN",19,"NM",47,0)
PSA ORDERS MENU^^0
"BLD",334,"KRN",19,"NM",48,0)
PSA OUTSTANDING CREDITS^^0
"BLD",334,"KRN",19,"NM",49,0)
PSA POSTED DRUG REPORT^^0
"BLD",334,"KRN",19,"NM",50,0)
PSA PRIME VENDOR INTERFACE^^0
"BLD",334,"KRN",19,"NM",51,0)
PSA PRINT ORDERS^^0
"BLD",334,"KRN",19,"NM",52,0)
PSA PROCESS PRIME VENDOR DATA^^0
"BLD",334,"KRN",19,"NM",53,0)
PSA PROCESSOR AND VERIFIER^^0
"BLD",334,"KRN",19,"NM",54,0)
PSA PURCHASE ORDER REVIEW^^0
"BLD",334,"KRN",19,"NM",55,0)
PSA PV DRUG ENTER/EDIT^^0
"BLD",334,"KRN",19,"NM",56,0)
PSA PV LOCATION MENU^^0
"BLD",334,"KRN",19,"NM",57,0)
PSA PV MAINTENANCE RPT MENU^^0
"BLD",334,"KRN",19,"NM",58,0)
PSA RECEIPTS MENU^^0
"BLD",334,"KRN",19,"NM",59,0)
PSA RECEIVING^^0
"BLD",334,"KRN",19,"NM",60,0)
PSA SINGLE DRUG MATCH^^0
"BLD",334,"KRN",19,"NM",61,0)
PSA STOCK & REORDER LEVEL RPT^^0
"BLD",334,"KRN",19,"NM",62,0)
PSA STOCK AND REORDER LEVELS^^0
"BLD",334,"KRN",19,"NM",63,0)
PSA TRANSFER DRUGS^^0
"BLD",334,"KRN",19,"NM",64,0)
PSA TRANSFER SIGNATURE SHEET^^0
"BLD",334,"KRN",19,"NM",65,0)
PSA UNLINKED LOOP^^0
"BLD",334,"KRN",19,"NM",66,0)
PSA UNLINKED REPORT^^0
"BLD",334,"KRN",19,"NM",67,0)
PSA UNPOST PROCUREMENT HISTORY^^0
"BLD",334,"KRN",19,"NM",68,0)
PSA UPLOAD PRIME VENDOR DATA^^0
"BLD",334,"KRN",19,"NM",69,0)
PSA VERIFY INVOICES^^0
"BLD",334,"KRN",19,"NM",70)
^^^
"BLD",334,"KRN",19,"NM",70,0)
PSA DRUG MENU^^1
"BLD",334,"KRN",19,"NM",71)
^^^
"BLD",334,"KRN",19,"NM",71,0)
PSA LOCATION MENU^^1
"BLD",334,"KRN",19,"NM",72)
^^^
"BLD",334,"KRN",19,"NM",72,0)
PSA ONLINE DOCUMENTATION^^1
"BLD",334,"KRN",19,"NM","B","PSA ACTIVE DRUGS/ITEM FILE",1)

"BLD",334,"KRN",19,"NM","B","PSA BALANCE ADJUSTMENTS",2)

"BLD",334,"KRN",19,"NM","B","PSA BALANCE ADJUSTMENTS REPORT",3)

"BLD",334,"KRN",19,"NM","B","PSA BALANCE INITIALIZE",4)

"BLD",334,"KRN",19,"NM","B","PSA COMPARISON REPORT",5)

"BLD",334,"KRN",19,"NM","B","PSA CONNECTION MENU",6)

"BLD",334,"KRN",19,"NM","B","PSA CP TRANSACTION REVIEW",7)

"BLD",334,"KRN",19,"NM","B","PSA CREDIT RESOLUTION",8)

"BLD",334,"KRN",19,"NM","B","PSA DISPENSING MENU",9)

"BLD",334,"KRN",19,"NM","B","PSA DISPLAY CONNECTED DRUG",10)

"BLD",334,"KRN",19,"NM","B","PSA DISPLAY LOCATION",11)

"BLD",334,"KRN",19,"NM","B","PSA DRUG ACCOUNTABILITY MENU",12)

"BLD",334,"KRN",19,"NM","B","PSA DRUG DISPLAY",13)

"BLD",334,"KRN",19,"NM","B","PSA DRUG ENTER/EDIT",14)

"BLD",334,"KRN",19,"NM","B","PSA DRUG HISTORY",15)

"BLD",334,"KRN",19,"NM","B","PSA DRUG INQUIRE",16)

"BLD",334,"KRN",19,"NM","B","PSA DRUG MENU",70)

"BLD",334,"KRN",19,"NM","B","PSA DRUGS NOT IN INVENTORY",17)

"BLD",334,"KRN",19,"NM","B","PSA FSN AUTO LOOP",18)

"BLD",334,"KRN",19,"NM","B","PSA FSN CONTROL LOOP",19)

"BLD",334,"KRN",19,"NM","B","PSA FSN MENU",20)

"BLD",334,"KRN",19,"NM","B","PSA FSN REPORT",21)

"BLD",334,"KRN",19,"NM","B","PSA GIP COMPARE",22)

"BLD",334,"KRN",19,"NM","B","PSA GIP CONT BAL UPDATE",23)

"BLD",334,"KRN",19,"NM","B","PSA GIP DISCREPANCIES",24)

"BLD",334,"KRN",19,"NM","B","PSA GIP INTERFACE MENU",25)

"BLD",334,"KRN",19,"NM","B","PSA GIP LINK REPORT",26)

"BLD",334,"KRN",19,"NM","B","PSA GIP LOCATION MENU",27)

"BLD",334,"KRN",19,"NM","B","PSA GIP MAINTENANCE RPT MENU",28)

"BLD",334,"KRN",19,"NM","B","PSA GIP MENU",29)

"BLD",334,"KRN",19,"NM","B","PSA GIP POPULATE",30)

"BLD",334,"KRN",19,"NM","B","PSA GIP REPORT",31)

"BLD",334,"KRN",19,"NM","B","PSA INVOICE COST SUMMARY",32)

"BLD",334,"KRN",19,"NM","B","PSA INVOICE REVIEW",33)

"BLD",334,"KRN",19,"NM","B","PSA IV ALL DRUGS",34)

"BLD",334,"KRN",19,"NM","B","PSA IV ALL LOCATIONS",35)

"BLD",334,"KRN",19,"NM","B","PSA IV SINGLE",36)

"BLD",334,"KRN",19,"NM","B","PSA LOCATION EDIT",37)

"BLD",334,"KRN",19,"NM","B","PSA LOCATION MENU",71)

"BLD",334,"KRN",19,"NM","B","PSA MONTHLY SUMMARY",38)

"BLD",334,"KRN",19,"NM","B","PSA NDC AUTO LOOP",39)

"BLD",334,"KRN",19,"NM","B","PSA NDC CONTROL LOOP",40)

"BLD",334,"KRN",19,"NM","B","PSA NDC DUPLICATE REPORT",41)

"BLD",334,"KRN",19,"NM","B","PSA NDC MENU",42)

"BLD",334,"KRN",19,"NM","B","PSA NDC REPORT",43)

"BLD",334,"KRN",19,"NM","B","PSA ONLINE DOCUMENTATION",72)

"BLD",334,"KRN",19,"NM","B","PSA OP ALL DRUGS",44)

"BLD",334,"KRN",19,"NM","B","PSA OP SINGLE",45)

"BLD",334,"KRN",19,"NM","B","PSA ORDERS ALERT",46)

"BLD",334,"KRN",19,"NM","B","PSA ORDERS MENU",47)

"BLD",334,"KRN",19,"NM","B","PSA OUTSTANDING CREDITS",48)

"BLD",334,"KRN",19,"NM","B","PSA POSTED DRUG REPORT",49)

"BLD",334,"KRN",19,"NM","B","PSA PRIME VENDOR INTERFACE",50)

"BLD",334,"KRN",19,"NM","B","PSA PRINT ORDERS",51)

"BLD",334,"KRN",19,"NM","B","PSA PROCESS PRIME VENDOR DATA",52)

"BLD",334,"KRN",19,"NM","B","PSA PROCESSOR AND VERIFIER",53)

"BLD",334,"KRN",19,"NM","B","PSA PURCHASE ORDER REVIEW",54)

"BLD",334,"KRN",19,"NM","B","PSA PV DRUG ENTER/EDIT",55)

"BLD",334,"KRN",19,"NM","B","PSA PV LOCATION MENU",56)

"BLD",334,"KRN",19,"NM","B","PSA PV MAINTENANCE RPT MENU",57)

"BLD",334,"KRN",19,"NM","B","PSA RECEIPTS MENU",58)

"BLD",334,"KRN",19,"NM","B","PSA RECEIVING",59)

"BLD",334,"KRN",19,"NM","B","PSA SINGLE DRUG MATCH",60)

"BLD",334,"KRN",19,"NM","B","PSA STOCK & REORDER LEVEL RPT",61)

"BLD",334,"KRN",19,"NM","B","PSA STOCK AND REORDER LEVELS",62)

"BLD",334,"KRN",19,"NM","B","PSA TRANSFER DRUGS",63)

"BLD",334,"KRN",19,"NM","B","PSA TRANSFER SIGNATURE SHEET",64)

"BLD",334,"KRN",19,"NM","B","PSA UNLINKED LOOP",65)

"BLD",334,"KRN",19,"NM","B","PSA UNLINKED REPORT",66)

"BLD",334,"KRN",19,"NM","B","PSA UNPOST PROCUREMENT HISTORY",67)

"BLD",334,"KRN",19,"NM","B","PSA UPLOAD PRIME VENDOR DATA",68)

"BLD",334,"KRN",19,"NM","B","PSA VERIFY INVOICES",69)

"BLD",334,"KRN",19.1,0)
19.1
"BLD",334,"KRN",19.1,"NM",0)
^9.68A^2^2
"BLD",334,"KRN",19.1,"NM",1,0)
PSA ORDERS^^0
"BLD",334,"KRN",19.1,"NM",2,0)
PSAMGR^^0
"BLD",334,"KRN",19.1,"NM","B","PSA ORDERS",1)

"BLD",334,"KRN",19.1,"NM","B","PSAMGR",2)

"BLD",334,"KRN",101,0)
101
"BLD",334,"KRN",409.61,0)
409.61
"BLD",334,"KRN",771,0)
771
"BLD",334,"KRN",869.2,0)
869.2
"BLD",334,"KRN",870,0)
870
"BLD",334,"KRN",8994,0)
8994
"BLD",334,"KRN","B",.4,.4)

"BLD",334,"KRN","B",.401,.401)

"BLD",334,"KRN","B",.402,.402)

"BLD",334,"KRN","B",.403,.403)

"BLD",334,"KRN","B",.5,.5)

"BLD",334,"KRN","B",.84,.84)

"BLD",334,"KRN","B",3.6,3.6)

"BLD",334,"KRN","B",3.8,3.8)

"BLD",334,"KRN","B",9.2,9.2)

"BLD",334,"KRN","B",9.8,9.8)

"BLD",334,"KRN","B",19,19)

"BLD",334,"KRN","B",19.1,19.1)

"BLD",334,"KRN","B",101,101)

"BLD",334,"KRN","B",409.61,409.61)

"BLD",334,"KRN","B",771,771)

"BLD",334,"KRN","B",869.2,869.2)

"BLD",334,"KRN","B",870,870)

"BLD",334,"KRN","B",8994,8994)

"BLD",334,"PRE")
PSAENVIR
"BLD",334,"QUES",0)
^9.62^^
"BLD",334,"REQB",0)
^9.611^^
"DATA",58.84,1,0)
RECEIPT INTO PHARMACY
"DATA",58.84,2,0)
DISPENSED FROM PHARMACY
"DATA",58.84,3,0)
RETURNED TO STOCK
"DATA",58.84,4,0)
DESTROYED
"DATA",58.84,5,0)
TRANSFER BETWEEN NAOUS
"DATA",58.84,6,0)
OUTPATIENT RX
"DATA",58.84,7,0)
CANCEL AN ORDER
"DATA",58.84,8,0)
COMPLETE A GREEN SHEET
"DATA",58.84,9,0)
BALANCE ADJUSTMENT
"DATA",58.84,10,0)
RETURNED TO MANUFACTURER
"DATA",58.84,11,0)
BALANCE INITIALIZATION
"DATA",58.84,12,0)
INITIALIZE EXISTING GS
"DATA",58.84,13,0)
CANCEL VERIFIED ORDER
"DATA",58.84,14,0)
EDIT VERIFIED ORDER
"DATA",58.84,15,0)
IV DISPENSING
"DATA",58.84,16,0)
TRANSFER BETWEEN VAULTS
"DATA",58.84,17,0)
LOGGED FOR PATIENT
"DATA",58.84,18,0)
WASTED
"DATA",58.84,19,0)
START INVENTORY (PHARMACY)
"DATA",58.84,20,0)
COMPLETE INVENTORY (PHARMACY)
"DATA",58.84,21,0)
START INVENTORY (INSPECTOR)
"DATA",58.84,22,0)
COMPLETE INVENTORY (INSPECTOR)
"DATA",58.84,23,0)
COUNT VERIFICATION
"DATA",58.84,24,0)
TRANSFER BETWEEN PHARMACIES
"FIA",58.8)
DRUG ACCOUNTABILITY STATS
"FIA",58.8,0)
^PSD(58.8,
"FIA",58.8,0,0)
58.8I
"FIA",58.8,0,1)
y^y^f^^^^n
"FIA",58.8,0,10)

"FIA",58.8,0,11)

"FIA",58.8,0,"RLRO")

"FIA",58.8,0,"VR")
3.0^DRUG ACCOUNTABILITY V.
"FIA",58.8,58.8)
0
"FIA",58.8,58.8001)
0
"FIA",58.8,58.800115)
0
"FIA",58.8,58.800116)
0
"FIA",58.8,58.800118)
0
"FIA",58.8,58.80011813)
0
"FIA",58.8,58.800119)
0
"FIA",58.8,58.801)
0
"FIA",58.8,58.828)
0
"FIA",58.8,58.831)
0
"FIA",58.8,58.842)
0
"FIA",58.8,58.8445)
0
"FIA",58.81)
DRUG ACCOUNTABILITY TRANSACTION
"FIA",58.81,0)
^PSD(58.81,
"FIA",58.81,0,0)
58.81I
"FIA",58.81,0,1)
y^y^f^^^^n
"FIA",58.81,0,10)

"FIA",58.81,0,11)

"FIA",58.81,0,"RLRO")

"FIA",58.81,0,"VR")
3.0^DRUG ACCOUNTABILITY V.
"FIA",58.81,58.81)
0
"FIA",58.81,58.8126)
0
"FIA",58.811)
DRUG ACCOUNTABILITY ORDER
"FIA",58.811,0)
^PSD(58.811,
"FIA",58.811,0,0)
58.811
"FIA",58.811,0,1)
y^y^f^^^^n
"FIA",58.811,0,10)

"FIA",58.811,0,11)

"FIA",58.811,0,"RLRO")

"FIA",58.811,0,"VR")
3.0^DRUG ACCOUNTABILITY V.
"FIA",58.811,58.811)
0
"FIA",58.811,58.8112)
0
"FIA",58.811,58.81125)
0
"FIA",58.811,58.811259)
0
"FIA",58.811,58.81126)
0
"FIA",58.84)
DRUG ACCOUNTABILITY TRANSACTION TYPE
"FIA",58.84,0)
^PSD(58.84,
"FIA",58.84,0,0)
58.84
"FIA",58.84,0,1)
y^y^f^^n^^y^o^y
"FIA",58.84,0,10)

"FIA",58.84,0,11)

"FIA",58.84,0,"RLRO")

"FIA",58.84,0,"VR")
3.0^DRUG ACCOUNTABILITY V.
"FIA",58.84,58.84)
0
"INIT")
PSAPOST
"KRN",.4,533,-1)
0^1
"KRN",.4,533,0)
PSADRI^2970401.1026^#^50^^@^2970926
"KRN",.4,533,"DXS",1,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^PSDRUG(D0,2)):^(2),1:"") S X=$P(DIP(1),U,4) K DIC S DIC="^PRC(441,",DIC(0)="NMF" D ^DIC S (D,D0,D(0))=+Y
"KRN",.4,533,"DXS",2,9)
W "$"_$P(^PRC(441,+NO,2,+VE,0),U,2)_"/"_$P($G(^PRCD(420.5,+$P(^PRC(441,+NO,2,+VE,0),U,7),0)),U)
"KRN",.4,533,"DXS",3,9)
W $P(^PRC(441,+NO,2,+VE,0),U,8)_"/"_$P($G(^PRCD(420.5,+$P(^PRC(441,+NO,2,+VE,0),U,7),0)),U)
"KRN",.4,533,"DXS",4,9)
S DIP(1)=$S($D(^PSDRUG(I(0,0),660)):^(660),1:"") S X="PR" Q:X[U!(X["$C(94)")!X  S X=$S($D(@X):@X,1:"") S X=X,X=$S($P(DIP(1),U,5):X/$P(DIP(1),U,5),1:"*******")
"KRN",.4,533,"DXS",5,9.2)
S I(100,0)=$S($D(D0):D0,1:""),DIP(101)=$S($D(^PRC(441,D0,0)):^(0),1:"") S X=$P(DIP(101),U,1) K DIC S DIC="^VA(200,",DIC(0)="NMF" D ^DIC S (D,D0,D(0))=+Y
"KRN",.4,533,"F",1)
"DRUG file";C1~"ITEM MASTER file";C40~
"KRN",.4,533,"F",2)
S X="_",DIP(1)=X S X=80,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;Z;"DUP("_",80)"~.01;C1;L35;S~
"KRN",.4,533,"F",3)
-441,^PRC(441,^^X DXS(1,9.2) S DIP(101)=$S($D(^PRC(441,D0,0)):^(0),1:"") S X=$P(DIP(101),U,1) S D0=I(0,0);Z;"NDC:ITEM MASTER:"~-441,.1,.01;W40~
"KRN",.4,533,"F",4)
-441,S NO=D0;X;Z;"S NO=D0"~-441,S DIP(101)=$S($D(^PRC(441,D0,0)):^(0),1:"") S X="ITEM NUMBER: "_$P(DIP(101),U,1) W X K DIP;C40;Z;""ITEM NUMBER: "_#.01"~
"KRN",.4,533,"F",5)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),0)):^(0),1:"") S X=$P(DIP(1),U,6) W X K DIP;S;Z;"FSN"~-441,"-NSN-";C30~-441,5;C40~
"KRN",.4,533,"F",6)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),2)):^(2),1:"") S X=$P(DIP(1),U,4) W X K DIP;S;Z;"NDC"~-441,S NDC=X;Z;"S NDC=X"~-441,"-NDC-";C30~
"KRN",.4,533,"F",7)
-441,S VE=$O(^PRC(441,"F",NDC,+NO,"")) W $P(^PRC(441,+NO,2,+VE,0),U,5);C40;Z;"S VE=$O(^PRC(441,"F",NDC,+NO,"")) W $P(^PRC(441,+NO,2,+VE,0),U,5)"~
"KRN",.4,533,"F",8)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),660)):^(660),1:"") S X="$"_$P(DIP(1),U,3)_"/"_$S('$D(^DIC(51.5,+$P(DIP(1),U,2),0)):"",1:$P(^(0),U,1)) W X K DIP;S;Z;""$"_PRICE PER ORDER UNIT_"/"_ORDER UNIT"~
"KRN",.4,533,"F",9)
-441,"-COST-";C30~-441,X DXS(2,9);C40;Z;"W "$"_$P(^PRC(441,+NO,2,+VE,0),U,2)_"/"_$P($G(^PRCD(420.5,+$P(^PRC(441,+NO,2,+VE,0),U,7),0)),U)"~
"KRN",.4,533,"F",10)
-441,W "Date of price: " S Y=$P(^PRC(441,+NO,2,+VE,0),U,6) X ^DD("DD") W Y;Z;"W "Date of price: " S Y=$P(^PRC(441,+NO,2,+VE,0),U,6) X ^DD("DD") W Y"~
"KRN",.4,533,"F",11)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),660)):^(660),1:"") S X=$P(DIP(1),U,5)_"/"_$S('$D(^DIC(51.5,+$P(DIP(1),U,2),0)):"",1:$P(^(0),U,1)) W X K DIP;S;Z;"DISPENSE UNITS PER ORDER UNIT_"/"_ORDER UNIT"~
"KRN",.4,533,"F",12)
-441,"-PKG-";C30~-441,X DXS(3,9);C40;Z;"W $P(^PRC(441,+NO,2,+VE,0),U,8)_"/"_$P($G(^PRCD(420.5,+$P(^PRC(441,+NO,2,+VE,0),U,7),0)),U)"~
"KRN",.4,533,"F",13)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),660)):^(660),1:"") S X="$"_$P(DIP(1),U,6)_"/"_$P(DIP(1),U,8) W X K DIP;S;Z;""$"_PRICE PER DISPENSE UNIT_"/"_DISPENSE UNIT"~
"KRN",.4,533,"F",14)
-441,"-UNIT COST-";C27~-441,W "$";C40;Z;"W "$""~-441,S PR=$P(^PRC(441,+NO,2,+VE,0),U,2);X;Z;"S PR=$P(^PRC(441,+NO,2,+VE,0),U,2)"~
"KRN",.4,533,"F",15)
-441,X DXS(4,9) W X K DIP;X;Z;"VAR("PR")/DISPENSE UNITS PER ORDER"~-441,"(Based on dispense unit)"~
"KRN",.4,533,"F",16)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),660)):^(660),1:"") S X=$P(DIP(1),U,7) W X K DIP;S;Z;"SOURCE OF SUPPLY"~-441,"-SOURCE-";C29~
"KRN",.4,533,"F",17)
-441,W $P($G(^PRC(440,+$P(^PRC(441,+NO,2,+VE,0),U),0)),U);C40;Z;"W $P($G(^PRC(440,+$P(^PRC(441,+NO,2,+VE,0),U),0)),U)"~
"KRN",.4,533,"F",18)
-441,S DIP(101)=$S($D(^PRC(441,D0,0)):^(0),1:"") S X="Purchasing Agent:  "_$S('$D(^VA(200,+$P(DIP(101),U,11),0)):"",1:$P(^(0),U,1)) W X K DIP;C1;S;Z;""Purchasing Agent:  "_#15"~
"KRN",.4,533,"F",19)
-441,-200,^VA(200,^^X DXS(5,9.2) S DIP(201)=$S($D(^VA(200,D0,0)):^(0),1:"") S X=$P(DIP(201),U,1) S D0=I(100,0);Z;".01:NEW PERSON:"~
"KRN",.4,533,"F",20)
-441,-200,S DIP(201)=$S($D(^VA(200,D0,.13)):^(.13),1:"") S X="Phone:  "_$P(DIP(201),U,2) W X K DIP;C40;Z;""Phone:  "_#.132"~
"KRN",.4,533,"H")
@
"KRN",.4,533,"IOM")
80
"KRN",.4,533,"LAST")

"KRN",.4,533,"ROU")
^PSADRI
"KRN",.4,533,"ROUOLD")
PSADRI
"KRN",.4,533,"SUB")
1
"KRN",.4,540,-1)
0^3
"KRN",.4,540,0)
PSADRIP^2931028.1501^@^50^^@^2970926
"KRN",.4,540,"DXS",1,9)
X DXS(1,9.2) S %Y=1,%=$S($D(DIWF):$F(DIWF,"B"),1:0) X:% "F %Y=%:1 Q:$E(DIWF,%Y)'?1N" S:$D(DIWF) DIWF=$E(DIWF,1,%-2)_$E(DIWF,%Y,999)_"B"_(X\1) X:X>(IOSL-$Y)&$D(^UTILITY($J,1))&'$D(^("W"))&'$D(DIWF) ^(1) S X=""
"KRN",.4,540,"DXS",1,9.2)
S X=10
"KRN",.4,540,"DXS",2,9.2)
S I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^PSDRUG(D0,2)):^(2),1:"") S X=$P(DIP(1),U,4) K DIC S DIC="^PRC(441,",DIC(0)="NMF" D ^DIC S (D,D0,D(0))=+Y
"KRN",.4,540,"DXS",3,9)
W:VE]"" "$"_$P(^PRC(441,+NO,2,+VE,0),U,2)_"/"_$P($G(^PRCD(420.5,+$P(^PRC(441,+NO,2,+VE,0),U,7),0)),U)
"KRN",.4,540,"DXS",4,9)
W:VE]"" $P(^PRC(441,+NO,2,+VE,0),U,8)_"/"_$P($G(^PRCD(420.5,+$P(^PRC(441,+NO,2,+VE,0),U,7),0)),U)
"KRN",.4,540,"F",1)
X DXS(1,9) W X K DIP;X;Z;"PAGEFEED(10)"~
"KRN",.4,540,"F",2)
S X="_",DIP(1)=X S X=80,X1=DIP(1) S %=X,X="" Q:X1=""  S $P(X,X1,%\$L(X1)+1)=X1,X=$E(X,1,%) W X K DIP;C1;Z;"DUP("_",80)"~.01;L37;S~
"KRN",.4,540,"F",3)
I $P($G(^PSDRUG(D0,2)),U,4)']"" W "   NO NDC IN DRUG FILE, NO MATCH";X;Z;"I $P($G(^PSDRUG(D0,2)),U,4)']"" W "   NO NDC IN DRUG FILE, NO MATCH""~
"KRN",.4,540,"F",4)
S PR(1)=$P($G(^PSDRUG(D0,660)),U,5);Z;"S PR(1)=$P($G(^PSDRUG(D0,660)),U,5)"~
"KRN",.4,540,"F",5)
-441,^PRC(441,^^X DXS(2,9.2) S DIP(101)=$S($D(^PRC(441,D0,0)):^(0),1:"") S X=$P(DIP(101),U,1) S D0=I(0,0);Z;"NDC:ITEM MASTER:"~
"KRN",.4,540,"F",6)
-441,S DIP(101)=$S($D(^PRC(441,D0,0)):^(0),1:"") S X="ITEM NUMBER: "_$P(DIP(101),U,1) W X K DIP;C40;Z;""ITEM NUMBER: "_#.01"~
"KRN",.4,540,"F",7)
-441,S DIP(101)=$S($D(^PRC(441,D0,0)):^(0),1:"") S X=$P(DIP(101),U,2),DIP(102)=X S X=1,DIP(103)=X S X=40,X=$E(DIP(102),DIP(103),X) W X K DIP;C40;Z;"$E(SHORT DESCRIPTION,1,40)"~
"KRN",.4,540,"F",8)
-441,S NO=D0;X;Z;"S NO=D0"~-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),0)):^(0),1:"") S X=$P(DIP(1),U,6) W X K DIP;X;C1;Z;"FSN"~-441,"-NSN-";C30~-441,5;C40~
"KRN",.4,540,"F",9)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),2)):^(2),1:"") S X=$P(DIP(1),U,4) W X K DIP;S;Z;"NDC"~-441,S NDC=X;Z;"S NDC=X"~-441,"-NDC-";C30~
"KRN",.4,540,"F",10)
-441,S VE=$O(^PRC(441,"F",NDC,+NO,"")) W:VE]"" $P(^PRC(441,+NO,2,+VE,0),U,5);C40;Z;"S VE=$O(^PRC(441,"F",NDC,+NO,"")) W:VE]"" $P(^PRC(441,+NO,2,+VE,0),U,5)"~
"KRN",.4,540,"F",11)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),660)):^(660),1:"") S X="$"_$P(DIP(1),U,3)_"/"_$S('$D(^DIC(51.5,+$P(DIP(1),U,2),0)):"",1:$P(^(0),U,1)) W X K DIP;S;Z;""$"_PRICE PER ORDER UNIT_"/"_ORDER UNIT"~
"KRN",.4,540,"F",12)
-441,"-COST-";C30~-441,X DXS(3,9);C40;Z;"W:VE]"" "$"_$P(^PRC(441,+NO,2,+VE,0),U,2)_"/"_$P($G(^PRCD(420.5,+$P(^PRC(441,+NO,2,+VE,0),U,7),0)),U)"~
"KRN",.4,540,"F",13)
-441,I VE]"" W "Date of price: " S Y=$P(^PRC(441,+NO,2,+VE,0),U,6) X ^DD("DD") W Y;Z;"I VE]"" W "Date of price: " S Y=$P(^PRC(441,+NO,2,+VE,0),U,6) X ^DD("DD") W Y"~
"KRN",.4,540,"F",14)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),660)):^(660),1:"") S X=$P(DIP(1),U,5)_"/"_$S('$D(^DIC(51.5,+$P(DIP(1),U,2),0)):"",1:$P(^(0),U,1)) W X K DIP;S;Z;"DISPENSE UNITS PER ORDER UNIT_"/"_ORDER UNIT"~
"KRN",.4,540,"F",15)
-441,"-PKG-";C30~-441,X DXS(4,9);C40;Z;"W:VE]"" $P(^PRC(441,+NO,2,+VE,0),U,8)_"/"_$P($G(^PRCD(420.5,+$P(^PRC(441,+NO,2,+VE,0),U,7),0)),U)"~
"KRN",.4,540,"F",16)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),660)):^(660),1:"") S X="$"_$P(DIP(1),U,6)_"/"_$P(DIP(1),U,8) W X K DIP;S;Z;""$"_PRICE PER DISPENSE UNIT_"/"_DISPENSE UNIT"~
"KRN",.4,540,"F",17)
-441,"-UNIT COST-";C27~-441,S:VE]""&(PR(1)) PR=$P(^PRC(441,+NO,2,+VE,0),U,2)/PR(1);X;Z;"S:VE]""&(PR(1)) PR=$P(^PRC(441,+NO,2,+VE,0),U,2)/PR(1)"~
"KRN",.4,540,"F",18)
-441,S:$G(PR) X=PR,X2="3$",X3=4 D COMMA^%DTC W X;Z;"S:$G(PR) X=PR,X2="3$",X3=4 D COMMA^%DTC W X"~-441,"(Based on dispense unit)";X~
"KRN",.4,540,"F",19)
-441,S DIP(1)=$S($D(^PSDRUG(I(0,0),660)):^(660),1:"") S X=$P(DIP(1),U,7) W X K DIP;S;Z;"SOURCE OF SUPPLY"~-441,"-SOURCE-";C29~
"KRN",.4,540,"F",20)
-441,W:VE]"" $P($G(^PRC(440,+$P(^PRC(441,+NO,2,+VE,0),U),0)),U);C40;Z;"W:VE]"" $P($G(^PRC(440,+$P(^PRC(441,+NO,2,+VE,0),U),0)),U)"~
"KRN",.4,540,"F",21)
K PR,NDC,NO,VE,X2,X3;Z;"K PR,NDC,NO,VE,X2,X3"~
"KRN",.4,540,"H")
[PSADRIH]
"KRN",.4,542,-1)
0^5
"KRN",.4,542,0)
PSANDC^2920326.1227^@^50.6^^@^2920326
"KRN",.4,542,"F",2)
.01~2,2,1,1,1,1,.01~
"KRN",.4,542,"H")
NATIONAL DRUG LIST
"KRN",.4,543,-1)
0^4
"KRN",.4,543,0)
PSAINV^2930305.1036^^58.8^^^2970826^
"KRN",.4,543,"F",1)
S DIP(1)=$S($D(^PSD(58.8,D0,0)):^(0),1:"") S X="Location:  "_$P(DIP(1),U,1) W X K DIP;Z;""Location:  "_#.01"~
"KRN",.4,543,"F",2)
22,S DIP(1)=$S($D(^PSD(58.8,D0,4,D1,0)):^(0),1:"") S X="Inventory link:  "_$S('$D(^PRCP(445,+$P(DIP(1),U,1),0)):"",1:$P(^(0),U,1)) W X K DIP;C40;Z;""Inventory link:  "_#.01"~
"KRN",.4,543,"F",3)
"Drug:";S~"Balance:";C50~10,.01;S~10,3;C50~10,W " "_$P($G(^PSDRUG(D1,660)),U,8);Z;"W " "_$P($G(^PSDRUG(D1,660)),U,8)"~
"KRN",.4,543,"H")
@
"KRN",.4,543,"SUB")
1
"KRN",.4,581,-1)
0^2
"KRN",.4,581,0)
PSADRIH^2921201.1023^^50^^^2970926^
"KRN",.4,581,"DXS",1,9)
S X="DRUG file/ITEM MASTER file COMPARISON REPORT",X=$J("",$S($D(DIWR)+$D(DIWL)=2:DIWR-DIWL+1,$D(IOM):IOM,1:80)-$L(X)\2-$X)_X
"KRN",.4,581,"F",2)
X DXS(1,9) W X K DIP;Z;"CENTER("DRUG file/ITEM MASTER file COMPARISON REPORT")";X~"DRUG";S~"ITEM MASTER file";C40~
"KRN",.4,581,"H")
@
"KRN",.4,581,"SUB")
1
"KRN",.402,694,-1)
0^1
"KRN",.402,694,0)
PSAENT^2931109.0903^^58.8^^^2971015
"KRN",.402,694,"DR",1,58.8)
1////P;12;W "";S:'$P($G(^PSD(58.8,D0,0)),U,8) Y=22;13;22;
"KRN",.402,694,"DR",2,58.8445)
.01;S:X PSAINV=X;2;N PSAMG S PSAMG=$P($G(^PSD(58.8,D0,4,D1,0)),U,3) Q:PSAMG']""  W:'$O(^XMB(3.8,"B",PSAMG,0)) $C(7),!!,"The ",PSAMG," mail group has not been created!",!!,"Messages can't be sent until creation.",!!;1;
"KRN",.402,737,-1)
0^2
"KRN",.402,737,0)
PSAGIP^2931021.1347^^58.8^^^2941208
"KRN",.402,737,"DR",1,58.8)
22;
"KRN",.402,737,"DR",2,58.8445)
.01;S:X PSAINV=X;1;S:'$P($G(^PSD(58.8,D0,4,D1,0)),U,2) Y=0;2;
"KRN",.402,737,"DR",2,58.8445,1)
N PSAMG S PSAMG=$P($G(^PSD(58.8,D0,4,D1,0)),U,3) Q:PSAMG']""  W:'$O(^XMB(3.8,"B",PSAMG,0)) $C(7),!!,"The ",PSAMG," mail group has not been created!",!!,"Messages can't be sent until creation.",!!;
"KRN",9.2,655,-1)
1^1
"KRN",9.2,655,0)
PSA AR/WS
"KRN",9.2,656,-1)
1^2
"KRN",9.2,656,0)
PSA AUTOMATED CONNECTION
"KRN",9.2,657,-1)
1^3
"KRN",9.2,657,0)
PSA CONTROLLED CONNECTION
"KRN",9.2,658,-1)
1^4
"KRN",9.2,658,0)
PSA DRUG ACCOUNTABILITY
"KRN",9.2,659,-1)
1^5
"KRN",9.2,659,0)
PSA CONNECTION MENU
"KRN",9.2,660,-1)
1^6
"KRN",9.2,660,0)
PSA LOCATION EDIT
"KRN",9.2,661,-1)
1^7
"KRN",9.2,661,0)
PSA NDC
"KRN",9.2,662,-1)
1^8
"KRN",9.2,662,0)
PSA PERPETUAL INVENTORY
"KRN",9.2,663,-1)
1^9
"KRN",9.2,663,0)
PSA PRIMARY INVENTORY POINT
"KRN",9.2,664,-1)
1^10
"KRN",9.2,664,0)
PSA PRIME VENDOR
"KRN",9.2,665,-1)
1^11
"KRN",9.2,665,0)
PSA RECEIVING
"KRN",9.2,666,-1)
1^12
"KRN",9.2,666,0)
PSA SINGLE DRUG MATCH
"KRN",19,4123,-1)
0^12
"KRN",19,4123,0)
PSA DRUG ACCOUNTABILITY MENU^Drug Accountability Menu^^M^^^^^^^^DRUG ACCOUNTABILITY^^^
"KRN",19,4123,1,0)
^^2^2^2970905^^^^
"KRN",19,4123,1,1,0)
The Drug Accountability menu is used to assist in the maintenance of a
"KRN",19,4123,1,2,0)
Pharmacy perpetual inventory.
"KRN",19,4123,10,0)
^19.01PI^2^2
"KRN",19,4123,10,1,0)
8619^1^10
"KRN",19,4123,10,1,"^")
PSA GIP INTERFACE MENU
"KRN",19,4123,10,2,0)
8617^2^20
"KRN",19,4123,10,2,"^")
PSA PRIME VENDOR INTERFACE
"KRN",19,4123,15)

"KRN",19,4123,20)

"KRN",19,4123,99)
57240,56259
"KRN",19,4123,99.1)
55579,36110
"KRN",19,4123,"U")
DRUG ACCOUNTABILITY MENU
"KRN",19,4125,-1)
0^41
"KRN",19,4125,0)
PSA NDC DUPLICATE REPORT^NDC Duplicates Report (ITEM MASTER file)^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4125,1,0)
^^3^3^2970923^^^
"KRN",19,4125,1,1,0)
The NDC Duplicates Report (ITEM MASTER file) option checks for more than
"KRN",19,4125,1,2,0)
one drug in the ITEM MASTER file (#441) which contains the same National
"KRN",19,4125,1,3,0)
Drug Code (NDC).
"KRN",19,4125,25)
PSANDC
"KRN",19,4125,"U")
NDC DUPLICATES REPORT (ITEM MA
"KRN",19,4126,-1)
0^16
"KRN",19,4126,0)
PSA DRUG INQUIRE^Inquire/Compare DRUG file/ITEM MASTER file^^I^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4126,1,0)
^^2^2^2970923^^
"KRN",19,4126,1,1,0)
The Inquire/Compare DRUG file/ITEM MASTER file option compares the
"KRN",19,4126,1,2,0)
packaging and pricing between the DRUG (#50) and ITEM MASTER (#441) files.
"KRN",19,4126,30)
PSDRUG(
"KRN",19,4126,31)
AEMQ
"KRN",19,4126,34)
I '$G(^("I"))&($G(^("I"))'>DT)
"KRN",19,4126,35)
W:'$O(^(441,0)) ?65,"NOT CONNECTED"
"KRN",19,4126,63)
[PSADRI]
"KRN",19,4126,80)
PSDRUG(
"KRN",19,4126,"U")
INQUIRE/COMPARE DRUG FILE/ITEM
"KRN",19,4127,-1)
0^5
"KRN",19,4127,0)
PSA COMPARISON REPORT^DRUG file/ITEM MASTER file Comparison Report^^P^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4127,1,0)
^^3^3^2970923^^
"KRN",19,4127,1,1,0)
The DRUG file/ITEM MASTER file Comparison Report option generates a report
"KRN",19,4127,1,2,0)
from a selected sort range of the DRUG file (#50)/ITEM MASTER file (#441)
"KRN",19,4127,1,3,0)
comparative information on packaging and pricing.
"KRN",19,4127,60)
PSDRUG(
"KRN",19,4127,62)
0
"KRN",19,4127,63)
[PSADRIP]
"KRN",19,4127,64)

"KRN",19,4127,65)

"KRN",19,4127,66)

"KRN",19,4127,69)
I '$G(^PSDRUG(D0,"I"))&($G(^("I"))'>DT)
"KRN",19,4127,"U")
DRUG FILE/ITEM MASTER FILE COM
"KRN",19,4128,-1)
0^60
"KRN",19,4128,0)
PSA SINGLE DRUG MATCH^Single Drug Match^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4128,1,0)
^^3^3^2970923^^
"KRN",19,4128,1,1,0)
The Single Drug Match option attempts to link the DRUG (#50) and ITEM
"KRN",19,4128,1,2,0)
MASTER (#441) files using the National Drug Code (NDC), Federal Stock
"KRN",19,4128,1,3,0)
Number (FSN), or a link to the NATIONAL DRUG file (#50.6).
"KRN",19,4128,25)
PSATI
"KRN",19,4128,"U")
SINGLE DRUG MATCH
"KRN",19,4129,-1)
0^6
"KRN",19,4129,0)
PSA CONNECTION MENU^Connection Menu (DRUG file/ITEM MASTER file)^^M^^^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,4129,1,0)
^^3^3^2970923^
"KRN",19,4129,1,1,0)
The Connection Menu (DRUG file/ITEM MASTER file) menu contains options
"KRN",19,4129,1,2,0)
that facilitate the direct linking of an entry in the DRUG file (#50) to
"KRN",19,4129,1,3,0)
one or more entries in the ITEM MASTER file (#441).
"KRN",19,4129,10,0)
^19.01PI^10^10
"KRN",19,4129,10,2,0)
4128^3^30
"KRN",19,4129,10,2,"^")
PSA SINGLE DRUG MATCH
"KRN",19,4129,10,3,0)
4134^1^10
"KRN",19,4129,10,3,"^")
PSA NDC MENU
"KRN",19,4129,10,4,0)
4141^2^20
"KRN",19,4129,10,4,"^")
PSA FSN MENU
"KRN",19,4129,10,5,0)
4142^4^40
"KRN",19,4129,10,5,"^")
PSA UNLINKED REPORT
"KRN",19,4129,10,6,0)
4143^5^50
"KRN",19,4129,10,6,"^")
PSA UNLINKED LOOP
"KRN",19,4129,10,7,0)
4232^7^70
"KRN",19,4129,10,7,"^")
PSA DISPLAY CONNECTED DRUG
"KRN",19,4129,10,8,0)
4238^8^80
"KRN",19,4129,10,8,"^")
PSA UNPOST PROCUREMENT HISTORY
"KRN",19,4129,10,9,0)
4239^9^90
"KRN",19,4129,10,9,"^")
PSA POSTED DRUG REPORT
"KRN",19,4129,10,10,0)
4283^6^60
"KRN",19,4129,10,10,"^")
PSA ACTIVE DRUGS/ITEM FILE
"KRN",19,4129,15)

"KRN",19,4129,20)
W !!?10,"GIP Interface"
"KRN",19,4129,99)
57233,57617
"KRN",19,4129,"U")
CONNECTION MENU (DRUG FILE/ITE
"KRN",19,4130,-1)
0^27
"KRN",19,4130,0)
PSA GIP LOCATION MENU^Pharmacy Location Maintenance Menu^^M^^^^^^^^DRUG ACCOUNTABILITY^^1^1
"KRN",19,4130,1,0)
^^5^5^2970923^
"KRN",19,4130,1,1,0)
The Pharmacy Location Maintenance menu contains options that set up and
"KRN",19,4130,1,2,0)
edit pharmacy locations. The drug balances can be initialized and
"KRN",19,4130,1,3,0)
adjusted. Drug prices in the DRUG file (#50) are compared with prices in
"KRN",19,4130,1,4,0)
the Generic Inventory Package. Items can be loaded and reports can be
"KRN",19,4130,1,5,0)
generated from a primary inventory point to a pharmacy location.
"KRN",19,4130,10,0)
^19.01PI^17^17
"KRN",19,4130,10,1,0)
4131^1^10
"KRN",19,4130,10,1,"^")
PSA LOCATION EDIT
"KRN",19,4130,10,11,0)
4162^5^50
"KRN",19,4130,10,11,"^")
PSA GIP MENU
"KRN",19,4130,10,12,0)
5333^4^40
"KRN",19,4130,10,12,"^")
PSA DRUG ENTER/EDIT
"KRN",19,4130,10,14,0)
4871^6^60
"KRN",19,4130,10,14,"^")
PSA GIP CONT BAL UPDATE
"KRN",19,4130,10,15,0)
4167^2^20
"KRN",19,4130,10,15,"^")
PSA BALANCE ADJUSTMENTS
"KRN",19,4130,10,16,0)
4868^3^30
"KRN",19,4130,10,16,"^")
PSA BALANCE INITIALIZE
"KRN",19,4130,10,17,0)
8629^7^70
"KRN",19,4130,10,17,"^")
PSA TRANSFER DRUGS
"KRN",19,4130,15)
K PSAPVMEN
"KRN",19,4130,20)
S PSAPVMEN=0 W !!?10,"GIP Interface"
"KRN",19,4130,99)
57233,57617
"KRN",19,4130,"U")
PHARMACY LOCATION MAINTENANCE 
"KRN",19,4131,-1)
0^37
"KRN",19,4131,0)
PSA LOCATION EDIT^Set Up/Edit a Pharmacy Location^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4131,1,0)
^^4^4^2970923^
"KRN",19,4131,1,1,0)
The Set Up/Edit a Pharmacy Location option creates and edits a pharmacy
"KRN",19,4131,1,2,0)
location. The pharmacy location's name, location type, and drugs can be
"KRN",19,4131,1,3,0)
entered and edited. If it is an Inpatient pharmacy location, wards can be
"KRN",19,4131,1,4,0)
entered and edited.
"KRN",19,4131,15)

"KRN",19,4131,20)

"KRN",19,4131,25)
PSAENT
"KRN",19,4131,"U")
SET UP/EDIT A PHARMACY LOCATIO
"KRN",19,4133,-1)
0^11
"KRN",19,4133,0)
PSA DISPLAY LOCATION^Drug Balances by Location^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4133,1,0)
^^3^3^2970722^^
"KRN",19,4133,1,1,0)
The Drug Balances by Location option generates a report by pharmacy
"KRN",19,4133,1,2,0)
location listing each of its drugs' name, quantity on hand, and dispense
"KRN",19,4133,1,3,0)
unit.
"KRN",19,4133,25)
PSADAI
"KRN",19,4133,"U")
DRUG BALANCES BY LOCATION
"KRN",19,4134,-1)
0^42
"KRN",19,4134,0)
PSA NDC MENU^NDC Menu^^M^^^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,4134,1,0)
^^3^3^2970922^
"KRN",19,4134,1,1,0)
The NDC menu contains options that use the National Drug Code (NDC) link
"KRN",19,4134,1,2,0)
between the DRUG (#50) and ITEM MASTER (#441) files for matching,
"KRN",19,4134,1,3,0)
inquiring, and reporting.
"KRN",19,4134,10,0)
^19.01PI^6^6
"KRN",19,4134,10,1,0)
4126^5^50
"KRN",19,4134,10,1,"^")
PSA DRUG INQUIRE
"KRN",19,4134,10,2,0)
4127^6^60
"KRN",19,4134,10,2,"^")
PSA COMPARISON REPORT
"KRN",19,4134,10,3,0)
4125^1^10
"KRN",19,4134,10,3,"^")
PSA NDC DUPLICATE REPORT
"KRN",19,4134,10,4,0)
4135^2^20
"KRN",19,4134,10,4,"^")
PSA NDC REPORT
"KRN",19,4134,10,5,0)
4136^3^30
"KRN",19,4134,10,5,"^")
PSA NDC CONTROL LOOP
"KRN",19,4134,10,6,0)
4137^4^40
"KRN",19,4134,10,6,"^")
PSA NDC AUTO LOOP
"KRN",19,4134,20)
W !!?10,"GIP Interface"
"KRN",19,4134,99)
57233,57617
"KRN",19,4134,"U")
NDC MENU
"KRN",19,4135,-1)
0^43
"KRN",19,4135,0)
PSA NDC REPORT^Report Potential NDC Matches^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4135,1,0)
^^4^4^2970923^
"KRN",19,4135,1,1,0)
The Report Potential NDC Matches option scans the DRUG file (#50) for
"KRN",19,4135,1,2,0)
entries not yet linked to the ITEM MASTER file (#441) that have a National
"KRN",19,4135,1,3,0)
Drug Code (NDC) entered. It then checks the ITEM MASTER file for an NDC
"KRN",19,4135,1,4,0)
match.
"KRN",19,4135,25)
PSALND
"KRN",19,4135,"U")
REPORT POTENTIAL NDC MATCHES
"KRN",19,4136,-1)
0^40
"KRN",19,4136,0)
PSA NDC CONTROL LOOP^Controlled Connection by NDC Match^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4136,1,0)
^^4^4^2970923^^
"KRN",19,4136,1,1,0)
The Controlled Connection by NDC Match option loops through the DRUG file
"KRN",19,4136,1,2,0)
(#50) for entries not yet linked to the ITEM MASTER file (#441). It checks
"KRN",19,4136,1,3,0)
for a National Drug Code (NDC) match with the ITEM MASTER file and ,if one
"KRN",19,4136,1,4,0)
is located, the user is asked to approve the link.
"KRN",19,4136,25)
PSALNM
"KRN",19,4136,"U")
CONTROLLED CONNECTION BY NDC M
"KRN",19,4137,-1)
0^39
"KRN",19,4137,0)
PSA NDC AUTO LOOP^Automated DRUG/ITEM MASTER file Link by NDC^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4137,1,0)
^^4^4^2970923^^
"KRN",19,4137,1,1,0)
The Automated DRUG/ITEM MASTER file Link by NDC option loops through the
"KRN",19,4137,1,2,0)
DRUG file (#50) for entries not yet linked to the ITEM MASTER file (#441).
"KRN",19,4137,1,3,0)
It links all National Drug Code (NDC) matches found in the ITEM MASTER
"KRN",19,4137,1,4,0)
file and reports the matches to the user as links occur.
"KRN",19,4137,25)
PSALNA
"KRN",19,4137,"U")
AUTOMATED DRUG/ITEM MASTER FIL
"KRN",19,4138,-1)
0^21
"KRN",19,4138,0)
PSA FSN REPORT^Report Potential FSN Matches^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4138,1,0)
^^4^4^2970923^
"KRN",19,4138,1,1,0)
The Report Potential FSN Matches option scans the DRUG file (#50) for
"KRN",19,4138,1,2,0)
entries not yet linked to the ITEM MASTER file (#441) that have a Federal
"KRN",19,4138,1,3,0)
Stock Number (FSN) entered. It then checks the ITEM MASTER file for a FSN
"KRN",19,4138,1,4,0)
match.
"KRN",19,4138,25)
PSALFS
"KRN",19,4138,"U")
REPORT POTENTIAL FSN MATCHES
"KRN",19,4139,-1)
0^19
"KRN",19,4139,0)
PSA FSN CONTROL LOOP^Controlled Connection by FSN Match^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4139,1,0)
^^4^4^2970923^
"KRN",19,4139,1,1,0)
The Controlled Connection by FSN Match option loops through the DRUG file
"KRN",19,4139,1,2,0)
(#50) for entries not yet linked to the ITEM MASTER file (#441). It checks
"KRN",19,4139,1,3,0)
for a Federal Stock Number (FSN) match with the ITEM MASTER file and, if
"KRN",19,4139,1,4,0)
one is located, the user is asked to approve the link.
"KRN",19,4139,25)
PSALFM
"KRN",19,4139,"U")
CONTROLLED CONNECTION BY FSN M
"KRN",19,4140,-1)
0^18
"KRN",19,4140,0)
PSA FSN AUTO LOOP^Automated DRUG/ITEM MASTER file Link by FSN^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4140,1,0)
^^4^4^2970923^
"KRN",19,4140,1,1,0)
The Automated DRUG/ITEM MASTER file Link by FSN option loops through the
"KRN",19,4140,1,2,0)
DRUG file (#50) for entries not yet linked to the ITEM MASTER file (#441).
"KRN",19,4140,1,3,0)
It links all Federal Stock Numbers (FSN) matches found in the ITEM MASTER
"KRN",19,4140,1,4,0)
file, reporting matches to the user as links occur.
"KRN",19,4140,25)
PSALFA
"KRN",19,4140,"U")
AUTOMATED DRUG/ITEM MASTER FIL
"KRN",19,4141,-1)
0^20
"KRN",19,4141,0)
PSA FSN MENU^FSN Menu^^M^^^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,4141,1,0)
^^3^3^2970923^^
"KRN",19,4141,1,1,0)
The FSN menu contains options that report and match drugs by the Federal
"KRN",19,4141,1,2,0)
Stock Number (FSN) link between the DRUG (#50) and ITEM MASTER (#441)
"KRN",19,4141,1,3,0)
files.
"KRN",19,4141,10,0)
^19.01PI^3^3
"KRN",19,4141,10,1,0)
4138^1^10
"KRN",19,4141,10,1,"^")
PSA FSN REPORT
"KRN",19,4141,10,2,0)
4139^2^20
"KRN",19,4141,10,2,"^")
PSA FSN CONTROL LOOP
"KRN",19,4141,10,3,0)
4140^3^30
"KRN",19,4141,10,3,"^")
PSA FSN AUTO LOOP
"KRN",19,4141,20)
W !!?10,"GIP Interface"
"KRN",19,4141,99)
57233,57617
"KRN",19,4141,"U")
FSN MENU
"KRN",19,4142,-1)
0^66
"KRN",19,4142,0)
PSA UNLINKED REPORT^Report of Unlinked DRUG/ITEM MASTER file Entries^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4142,1,0)
^^5^5^2970923^
"KRN",19,4142,1,1,0)
The Report of Unlinked DRUG/ITEM MASTER file Entries option scans the DRUG
"KRN",19,4142,1,2,0)
file (#50) for entries that do not yet have an ITEM MASTER file (#441)
"KRN",19,4142,1,3,0)
link. It lists the Federal Stock Number (FSN), National Drug Code (NDC),
"KRN",19,4142,1,4,0)
and indicates whether or not the drug is linked to the NATIONAL DRUG file
"KRN",19,4142,1,5,0)
(#50.6).
"KRN",19,4142,25)
PSAUNM
"KRN",19,4142,"U")
REPORT OF UNLINKED DRUG/ITEM M
"KRN",19,4143,-1)
0^65
"KRN",19,4143,0)
PSA UNLINKED LOOP^Connect Unlinked DRUG/ITEM MASTER file Entries^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4143,1,0)
^^4^4^2970923^
"KRN",19,4143,1,1,0)
The Connect Unlinked DRUG/ITEM MASTER file Entries option loops through
"KRN",19,4143,1,2,0)
the DRUG file (#50) for entries that do not yet have ITEM MASTER file
"KRN",19,4143,1,3,0)
(#441) entries and uses the Single Drug Match [PSA SINGLE DRUG MATCH]
"KRN",19,4143,1,4,0)
option to attempt a link.
"KRN",19,4143,25)
PSAUNL
"KRN",19,4143,"U")
CONNECT UNLINKED DRUG/ITEM MAS
"KRN",19,4144,-1)
0^26
"KRN",19,4144,0)
PSA GIP LINK REPORT^Report of Inventory Items' Link to DRUG file^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4144,1,0)
^^3^3^2970923^
"KRN",19,4144,1,1,0)
The Report of Inventory Items' Link to DRUG file option generates a
"KRN",19,4144,1,2,0)
listing of all inventory items and whether or not they are linked to the
"KRN",19,4144,1,3,0)
DRUG file (#50). If they are linked, the link is shown.
"KRN",19,4144,25)
PSAVIN
"KRN",19,4144,"U")
REPORT OF INVENTORY ITEMS' LIN
"KRN",19,4145,-1)
0^31
"KRN",19,4145,0)
PSA GIP REPORT^Loadable Inventory Items Report^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4145,1,0)
^^3^3^2970923^
"KRN",19,4145,1,1,0)
The Loadable Inventory Items Report option generates a report of inventory
"KRN",19,4145,1,2,0)
items with DRUG file (#50) links that have yet to be added to a selected
"KRN",19,4145,1,3,0)
pharmacy location.
"KRN",19,4145,25)
PSARIN
"KRN",19,4145,"U")
LOADABLE INVENTORY ITEMS REPOR
"KRN",19,4146,-1)
0^30
"KRN",19,4146,0)
PSA GIP POPULATE^Populate Pharmacy Location with Inventory Items^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4146,1,0)
^^3^3^2970923^
"KRN",19,4146,1,1,0)
The Populate Pharmacy Location with Inventory Items option loads each item
"KRN",19,4146,1,2,0)
from the inventory point that has a DRUG file (#50) link into a selected
"KRN",19,4146,1,3,0)
pharmacy location.
"KRN",19,4146,25)
PSANAC
"KRN",19,4146,"U")
POPULATE PHARMACY LOCATION WIT
"KRN",19,4159,-1)
0^59
"KRN",19,4159,0)
PSA RECEIVING^Receiving Directly into Drug Accountability^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4159,1,0)
^^4^4^2970923^
"KRN",19,4159,1,1,0)
The Receiving Directly into Drug Accountability option processes prime
"KRN",19,4159,1,2,0)
vendor Integrated Funds Distribution, Control Point Activity, Accounting
"KRN",19,4159,1,3,0)
and Procurement (IFCAP) or non-traditional IFCAP receipts updating the
"KRN",19,4159,1,4,0)
balance, transaction file, monthly activity, and the DRUG file (#50).
"KRN",19,4159,25)
PSAREC
"KRN",19,4159,"U")
RECEIVING DIRECTLY INTO DRUG A
"KRN",19,4162,-1)
0^29
"KRN",19,4162,0)
PSA GIP MENU^Inventory Interface^^M^^^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,4162,1,0)
^^2^2^2970722^
"KRN",19,4162,1,1,0)
The Inventory Interface menu contains options that report and load items
"KRN",19,4162,1,2,0)
from a primary inventory point to a Drug Accountability pharmacy location.
"KRN",19,4162,10,0)
^19.01PI^6^6
"KRN",19,4162,10,1,0)
4144^1^10
"KRN",19,4162,10,1,"^")
PSA GIP LINK REPORT
"KRN",19,4162,10,2,0)
4145^2^20
"KRN",19,4162,10,2,"^")
PSA GIP REPORT
"KRN",19,4162,10,3,0)
4146^3^30
"KRN",19,4162,10,3,"^")
PSA GIP POPULATE
"KRN",19,4162,10,4,0)
4284^4^40
"KRN",19,4162,10,4,"^")
PSA DRUGS NOT IN INVENTORY
"KRN",19,4162,10,5,0)
4869^5^50
"KRN",19,4162,10,5,"^")
PSA GIP COMPARE
"KRN",19,4162,10,6,0)
4870^6^60
"KRN",19,4162,10,6,"^")
PSA GIP DISCREPANCIES
"KRN",19,4162,20)
W !!?10,"GIP Interface"
"KRN",19,4162,99)
57233,57617
"KRN",19,4162,"U")
INVENTORY INTERFACE
"KRN",19,4163,-1)
0^54
"KRN",19,4163,0)
PSA PURCHASE ORDER REVIEW^Purchase Order Review^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4163,1,0)
^^3^3^2970922^
"KRN",19,4163,1,1,0)
The Purchase Order Review option reviews all receipt transactions for a
"KRN",19,4163,1,2,0)
selected Integrated Funds Distribution, Control Point Activity, Accounting
"KRN",19,4163,1,3,0)
and Procurement (IFCAP) purchase order.
"KRN",19,4163,25)
PSAREV
"KRN",19,4163,"U")
PURCHASE ORDER REVIEW
"KRN",19,4165,-1)
0^7
"KRN",19,4165,0)
PSA CP TRANSACTION REVIEW^Control Point Transaction Review^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4165,1,0)
^^2^2^2970722^^
"KRN",19,4165,1,1,0)
The Control Point Transaction Review option reviews the receipts
"KRN",19,4165,1,2,0)
transactions processed for a selected control point transaction number.
"KRN",19,4165,25)
PSAREVC
"KRN",19,4165,99)
55599,53181
"KRN",19,4165,"U")
CONTROL POINT TRANSACTION REVI
"KRN",19,4166,-1)
0^15
"KRN",19,4166,0)
PSA DRUG HISTORY^Drug Receipt History Review^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4166,1,0)
^^2^2^2970507^
"KRN",19,4166,1,1,0)
The Drug Receipt History Review option reviews all receipts processed over
"KRN",19,4166,1,2,0)
a selected time range for a selected drug.
"KRN",19,4166,25)
PSAREVD
"KRN",19,4166,"U")
DRUG RECEIPT HISTORY REVIEW
"KRN",19,4167,-1)
0^2
"KRN",19,4167,0)
PSA BALANCE ADJUSTMENTS^Balance Adjustments^^R^^PSAMGR^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4167,1,0)
^^2^2^2970507^^^
"KRN",19,4167,1,1,0)
The Balance Adjustments option reviews or enters adjustments to correct
"KRN",19,4167,1,2,0)
the balance of a drug.
"KRN",19,4167,25)
PSADJ
"KRN",19,4167,99)
55768,51136
"KRN",19,4167,"U")
BALANCE ADJUSTMENTS
"KRN",19,4228,-1)
0^13
"KRN",19,4228,0)
PSA DRUG DISPLAY^Drug Transaction History^^R^^^^^^^^DRUG ACCOUNTABILITY^^^
"KRN",19,4228,1,0)
^^2^2^2970722^^
"KRN",19,4228,1,1,0)
The Drug Transaction History option generates a list for one, some, or all
"KRN",19,4228,1,2,0)
drugs within a pharmacy location for a given date range.
"KRN",19,4228,15)

"KRN",19,4228,20)

"KRN",19,4228,25)
PSAHIS
"KRN",19,4228,99)
55646,58028
"KRN",19,4228,"U")
DRUG TRANSACTION HISTORY
"KRN",19,4232,-1)
0^10
"KRN",19,4232,0)
PSA DISPLAY CONNECTED DRUG^Display Connected Drug and Procurement History^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4232,1,0)
^^5^5^2970923^^
"KRN",19,4232,1,1,0)
The Display Connected Drug and Procurement History option displays
"KRN",19,4232,1,2,0)
comparison and vendor's price/packaging data for both the DRUG (#50) and
"KRN",19,4232,1,3,0)
ITEM MASTER (#441) files if a drug is connected to the ITEM MASTER file.
"KRN",19,4232,1,4,0)
If there is a procurement history it is displayed for a date range for a
"KRN",19,4232,1,5,0)
selected control point.
"KRN",19,4232,25)
PSACON
"KRN",19,4232,"U")
DISPLAY CONNECTED DRUG AND PRO
"KRN",19,4238,-1)
0^67
"KRN",19,4238,0)
PSA UNPOST PROCUREMENT HISTORY^Unposted Procurement History^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4238,1,0)
^^2^2^2970923^
"KRN",19,4238,1,1,0)
The Unposted Procurement History option lists all Pharmacy procurements
"KRN",19,4238,1,2,0)
for a selected month and a detailed list of each item procured.
"KRN",19,4238,25)
PSALOG
"KRN",19,4238,"U")
UNPOSTED PROCUREMENT HISTORY
"KRN",19,4239,-1)
0^49
"KRN",19,4239,0)
PSA POSTED DRUG REPORT^Posted Drug Procurement History^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4239,1,0)
^^2^2^2970507^
"KRN",19,4239,1,1,0)
The Posted Drug Procurement History option alphabetically lists drugs
"KRN",19,4239,1,2,0)
procured from the warehouse for a selected month.
"KRN",19,4239,25)
PSALOG2
"KRN",19,4239,"U")
POSTED DRUG PROCUREMENT HISTOR
"KRN",19,4240,-1)
0^33
"KRN",19,4240,0)
PSA INVOICE REVIEW^Invoice Review^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4240,1,0)
^^3^3^2970922^
"KRN",19,4240,1,1,0)
The Invoice Review option lists all receipts that have been posted for a
"KRN",19,4240,1,2,0)
selected Integrated Funds Distribution, Control Point Activity, Accounting
"KRN",19,4240,1,3,0)
and Procurement (IFCAP) invoice number.
"KRN",19,4240,25)
PSAREPV
"KRN",19,4240,"U")
INVOICE REVIEW
"KRN",19,4283,-1)
0^1
"KRN",19,4283,0)
PSA ACTIVE DRUGS/ITEM FILE^Active, Unlinked Drugs in the ITEM MASTER file^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4283,1,0)
^^4^4^2970923^^
"KRN",19,4283,1,1,0)
The Active, Unlinked Drugs in the ITEM MASTER file option generates a
"KRN",19,4283,1,2,0)
report from a user-specified last purchase date. It uses the last purchase
"KRN",19,4283,1,3,0)
date to scan the ITEM MASTER file (#441) for drugs that are not yet linked
"KRN",19,4283,1,4,0)
to the DRUG file (#50) and have been purchased since the selected date.
"KRN",19,4283,25)
PSAUNI
"KRN",19,4283,"U")
ACTIVE, UNLINKED DRUGS IN THE 
"KRN",19,4284,-1)
0^17
"KRN",19,4284,0)
PSA DRUGS NOT IN INVENTORY^Drugs Not Found in Linked Inventory^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4284,1,0)
^^3^3^2970722^^
"KRN",19,4284,1,1,0)
The Drugs Not Found in Linked Inventory option generates a list of drugs
"KRN",19,4284,1,2,0)
in a pharmacy location not found in the primary inventory point that is
"KRN",19,4284,1,3,0)
linked to it.
"KRN",19,4284,25)
PSADRU
"KRN",19,4284,"U")
DRUGS NOT FOUND IN LINKED INVE
"KRN",19,4868,-1)
0^4
"KRN",19,4868,0)
PSA BALANCE INITIALIZE^Balance Initialization^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4868,1,0)
^^2^2^2970507^^
"KRN",19,4868,1,1,0)
The Balance Initialization option establishes the balance for any drugs
"KRN",19,4868,1,2,0)
that do not yet have a balance.
"KRN",19,4868,25)
PSADJI
"KRN",19,4868,"U")
BALANCE INITIALIZATION
"KRN",19,4869,-1)
0^22
"KRN",19,4869,0)
PSA GIP COMPARE^Physical Inventory Balance Review^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4869,1,0)
^^3^3^2970722^
"KRN",19,4869,1,1,0)
The Physical Inventory Balance Review option displays each drug selected
"KRN",19,4869,1,2,0)
from a pharmacy location along with its balance.  If the item is stocked
"KRN",19,4869,1,3,0)
in any primary inventory points, those balances will also be displayed.
"KRN",19,4869,25)
PSAVIN1
"KRN",19,4869,99)
55645,60604
"KRN",19,4869,"U")
PHYSICAL INVENTORY BALANCE REV
"KRN",19,4870,-1)
0^24
"KRN",19,4870,0)
PSA GIP DISCREPANCIES^Compare Prices (DA/GIP)^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4870,1,0)
^^3^3^2970923^
"KRN",19,4870,1,1,0)
The Compare Prices (DA/GIP) option generates a report listing a selected
"KRN",19,4870,1,2,0)
pharmacy location's drugs' DRUG file (#50) prices in comparison with the
"KRN",19,4870,1,3,0)
prices in the Generic Inventory Package (GIP).
"KRN",19,4870,25)
PSAVIN2
"KRN",19,4870,"U")
COMPARE PRICES (DA/GIP)
"KRN",19,4871,-1)
0^23
"KRN",19,4871,0)
PSA GIP CONT BAL UPDATE^Update Prices^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,4871,1,0)
^^3^3^2970923^
"KRN",19,4871,1,1,0)
The Update Prices option compares prices in the DRUG file (#50) with
"KRN",19,4871,1,2,0)
prices in the Generic Inventory Package (GIP). It updates the DRUG file if
"KRN",19,4871,1,3,0)
desired.
"KRN",19,4871,25)
PSAVINC
"KRN",19,4871,99)
55640,50380
"KRN",19,4871,"U")
UPDATE PRICES
"KRN",19,5117,-1)
0^9
"KRN",19,5117,0)
PSA DISPENSING MENU^Dispensing Menu^^M^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,5117,1,0)
^^2^2^2970507^
"KRN",19,5117,1,1,0)
The Dispensing menu contains options that assist with the gathering of
"KRN",19,5117,1,2,0)
dispensing activity from other Pharmacy packages.
"KRN",19,5117,10,0)
^19.01PI^4^4
"KRN",19,5117,10,1,0)
5118^1^10
"KRN",19,5117,10,1,"^")
PSA IV SINGLE
"KRN",19,5117,10,2,0)
5119^2^20
"KRN",19,5117,10,2,"^")
PSA IV ALL DRUGS
"KRN",19,5117,10,3,0)
5230^3^30
"KRN",19,5117,10,3,"^")
PSA OP SINGLE
"KRN",19,5117,10,4,0)
5231^4^40
"KRN",19,5117,10,4,"^")
PSA OP ALL DRUGS
"KRN",19,5117,99)
57233,57617
"KRN",19,5117,"U")
DISPENSING MENU
"KRN",19,5118,-1)
0^36
"KRN",19,5118,0)
PSA IV SINGLE^IV Dispensing (Single Drug)^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,5118,1,0)
^^4^4^2970923^
"KRN",19,5118,1,1,0)
The IV Dispensing (Single Drug) option collects introvenous (IV)
"KRN",19,5118,1,2,0)
dispensing for a single drug from the IV STATS file (#50.8). If present,
"KRN",19,5118,1,3,0)
the last IV collection date is used as a starting point. Otherwise a date
"KRN",19,5118,1,4,0)
from which to begin collection is requested.
"KRN",19,5118,25)
PSAPSI
"KRN",19,5118,"U")
IV DISPENSING (SINGLE DRUG)
"KRN",19,5119,-1)
0^34
"KRN",19,5119,0)
PSA IV ALL DRUGS^IV Dispensing (All Drugs)^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,5119,1,0)
^^4^4^2970923^
"KRN",19,5119,1,1,0)
The IV Dispensing (All Drugs) option collects intravenous (IV) dispensing
"KRN",19,5119,1,2,0)
for all drugs in this location from the IV STATS file (#50.8). If present,
"KRN",19,5119,1,3,0)
the last IV collection date is used as a starting point. Otherwise the
"KRN",19,5119,1,4,0)
user selected date is used.
"KRN",19,5119,25)
PSAPSI2
"KRN",19,5119,99)
55675,53247
"KRN",19,5119,"U")
IV DISPENSING (ALL DRUGS)
"KRN",19,5120,-1)
0^35
"KRN",19,5120,0)
PSA IV ALL LOCATIONS^All Location Dispense/Purge^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,5120,1,0)
^^10^10^2970923^^
"KRN",19,5120,1,1,0)
The All Location Dispense/Purge option should be scheduled, using TaskMan,
"KRN",19,5120,1,2,0)
to run nightly to update all Drug Accountability locations with dispensing
"KRN",19,5120,1,3,0)
from the IV STATS (#50.8), PRESCRIPTION (#52), and the UNIT DOSE PICK LIST
"KRN",19,5120,1,4,0)
STATS (#57.6) files. It also searches all active pharmacy locations and
"KRN",19,5120,1,5,0)
master vaults for drug balances  equal to or less than the reorder level
"KRN",19,5120,1,6,0)
if drug balances are maintained in the location or vault. A mail message
"KRN",19,5120,1,7,0)
containing these drugs is sent to all holders of the PSA ORDERS key. To
"KRN",19,5120,1,8,0)
avoid competing locks of ^PSD globals, it should not be scheduled within
"KRN",19,5120,1,9,0)
one hour of the Update AMIS Stats File [PSGW UPDATE AMIS STATS] option and
"KRN",19,5120,1,10,0)
after the Compile IV Costs in Background [PSJI BACKGROUND JOB] option.
"KRN",19,5120,25)
PSAPSI3
"KRN",19,5120,99)
55720,28423
"KRN",19,5120,200.9)
y
"KRN",19,5120,"U")
ALL LOCATION DISPENSE/PURGE
"KRN",19,5121,-1)
0^38
"KRN",19,5121,0)
PSA MONTHLY SUMMARY^Monthly Summary^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,5121,1,0)
^^3^3^2970507^
"KRN",19,5121,1,1,0)
The Monthly Summary option generates a report of total receipts,
"KRN",19,5121,1,2,0)
dispensing, and adjustments by month. It creates a report for one,
"KRN",19,5121,1,3,0)
several, or all drugs within a selected date range.
"KRN",19,5121,25)
PSAMON
"KRN",19,5121,99)
55627,38373
"KRN",19,5121,"U")
MONTHLY SUMMARY
"KRN",19,5230,-1)
0^45
"KRN",19,5230,0)
PSA OP SINGLE^Outpatient Dispensing (Single Drug)^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,5230,1,0)
^^4^4^2970923^
"KRN",19,5230,1,1,0)
The Outpatient Dispensing (Single Drug) option collects outpatient
"KRN",19,5230,1,2,0)
dispensing for a single drug from the PRESCRIPTION file (#52). If present,
"KRN",19,5230,1,3,0)
the last outpatient dispensing date is used as a starting point.
"KRN",19,5230,1,4,0)
Otherwise, a date from which to begin collection is requested.
"KRN",19,5230,25)
PSAOP
"KRN",19,5230,"U")
OUTPATIENT DISPENSING (SINGLE 
"KRN",19,5231,-1)
0^44
"KRN",19,5231,0)
PSA OP ALL DRUGS^Outpatient Dispensing (All Drugs)^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,5231,1,0)
^^4^4^2970923^
"KRN",19,5231,1,1,0)
The Outpatient Dispensing (All Drugs) option collects outpatient
"KRN",19,5231,1,2,0)
dispensing for all drugs in this location from the PRESCRIPTION file
"KRN",19,5231,1,3,0)
(#52). If present, the last outpatient dispensing date is used as a
"KRN",19,5231,1,4,0)
starting point. Otherwise, the user selected date is used.
"KRN",19,5231,25)
PSAOP2
"KRN",19,5231,"U")
OUTPATIENT DISPENSING (ALL DRU
"KRN",19,5333,-1)
0^14
"KRN",19,5333,0)
PSA DRUG ENTER/EDIT^Enter/Edit a Drug^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,5333,1,0)
^^2^2^2970729^
"KRN",19,5333,1,1,0)
The Enter/Edit a Drug option adds a new drug to the pharmacy location. It
"KRN",19,5333,1,2,0)
also displays the balance of an existing drug.
"KRN",19,5333,25)
PSADRUG
"KRN",19,5333,"U")
ENTER/EDIT A DRUG
"KRN",19,7340,-1)
0^47
"KRN",19,7340,0)
PSA ORDERS MENU^Orders Menu^^M^^PSA ORDERS^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,7340,1,0)
^^3^3^2970520^^
"KRN",19,7340,1,1,0)
The Orders menu allows the user to upload, process, verify, and print
"KRN",19,7340,1,2,0)
prime vendor orders. It also allows printing of an outstanding credits
"KRN",19,7340,1,3,0)
report and entering of credit data.
"KRN",19,7340,10,0)
^19.01IP^7^7
"KRN",19,7340,10,1,0)
7341^1^10
"KRN",19,7340,10,1,"^")
PSA UPLOAD PRIME VENDOR DATA
"KRN",19,7340,10,2,0)
7342^2^20
"KRN",19,7340,10,2,"^")
PSA PROCESS PRIME VENDOR DATA
"KRN",19,7340,10,5,0)
7345^4^40
"KRN",19,7340,10,5,"^")
PSA PRINT ORDERS
"KRN",19,7340,10,6,0)
7344^3^30
"KRN",19,7340,10,6,"^")
PSA VERIFY INVOICES
"KRN",19,7340,10,7,0)
8032^5^50
"KRN",19,7340,10,7,"^")
PSA CREDIT RESOLUTION
"KRN",19,7340,20)
W !!?10,"Prime Vendor Interface"
"KRN",19,7340,25)

"KRN",19,7340,99)
57233,57617
"KRN",19,7340,"U")
ORDERS MENU
"KRN",19,7341,-1)
0^68
"KRN",19,7341,0)
PSA UPLOAD PRIME VENDOR DATA^Upload and Process Prime Vendor Invoice Data^^R^^PSA ORDERS^^^^^^DRUG ACCOUNTABILITY
"KRN",19,7341,1,0)
^^4^4^2970507^
"KRN",19,7341,1,1,0)
The Upload and Process Prime Vendor Invoice Data option uploads invoice
"KRN",19,7341,1,2,0)
data received from the prime vendor. The invoice data may be processed
"KRN",19,7341,1,3,0)
after the data is uploaded. It also allows the user to print the invoices
"KRN",19,7341,1,4,0)
immediately following the upload and immediately following the processing.
"KRN",19,7341,25)
PSAUP
"KRN",19,7341,"U")
UPLOAD AND PROCESS PRIME VENDO
"KRN",19,7342,-1)
0^52
"KRN",19,7342,0)
PSA PROCESS PRIME VENDOR DATA^Process Uploaded Prime Vendor Invoice Data^^R^^PSA ORDERS^^^^^^DRUG ACCOUNTABILITY^^1^
"KRN",19,7342,1,0)
^^2^2^2970507^
"KRN",19,7342,1,1,0)
The Process Uploaded Prime Vendor Invoice Data option processes uploaded
"KRN",19,7342,1,2,0)
prime vendor invoice data.
"KRN",19,7342,15)

"KRN",19,7342,20)
S PSAENTRY=1
"KRN",19,7342,25)
PSAPROC
"KRN",19,7342,99)
56873,44873
"KRN",19,7342,"U")
PROCESS UPLOADED PRIME VENDOR 
"KRN",19,7344,-1)
0^69
"KRN",19,7344,0)
PSA VERIFY INVOICES^Verify Invoices^^R^^PSA ORDERS^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,7344,1,0)
^^3^3^2970722^
"KRN",19,7344,1,1,0)
The Verify Invoices option validates processed invoices. The verifier and
"KRN",19,7344,1,2,0)
processor cannot be the same person. When the invoices are verified, the
"KRN",19,7344,1,3,0)
drug balances are updated in the pharmacy location and/or master vault.
"KRN",19,7344,20)
Q
"KRN",19,7344,25)
PSAVER
"KRN",19,7344,"U")
VERIFY INVOICES
"KRN",19,7345,-1)
0^51
"KRN",19,7345,0)
PSA PRINT ORDERS^Print Orders^^R^^PSA ORDERS^^^^^^DRUG ACCOUNTABILITY^^
"KRN",19,7345,1,0)
^^4^4^2970507^
"KRN",19,7345,1,1,0)
The Print Orders option generates invoices by entering the order number,
"KRN",19,7345,1,2,0)
invoice number, or invoice status. If the invoice has not been processed, 
"KRN",19,7345,1,3,0)
the PRIME VENDOR UPLOAD REPORT prints. If the invoice has been processed,
"KRN",19,7345,1,4,0)
the PRIME VENDOR ORDER REPORT prints.
"KRN",19,7345,20)

"KRN",19,7345,25)
PSAORDP
"KRN",19,7345,"U")
PRINT ORDERS
"KRN",19,8032,-1)
0^8
"KRN",19,8032,0)
PSA CREDIT RESOLUTION^Credit Resolution^^R^^PSAMGR^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,8032,1,0)
^^1^1^2970507^
"KRN",19,8032,1,1,0)
The Credit Resolution option enters credit memo data.
"KRN",19,8032,20)
Q
"KRN",19,8032,25)
PSACREDR
"KRN",19,8032,"U")
CREDIT RESOLUTION
"KRN",19,8033,-1)
0^48
"KRN",19,8033,0)
PSA OUTSTANDING CREDITS^Outstanding Credits^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,8033,1,0)
^^2^2^2970507^
"KRN",19,8033,1,1,0)
The Outstanding Credits Report option displays or prints invoice data if
"KRN",19,8033,1,2,0)
the invoice has an outstanding credit.
"KRN",19,8033,25)
PSACREDO
"KRN",19,8033,"U")
OUTSTANDING CREDITS
"KRN",19,8035,-1)
0^58
"KRN",19,8035,0)
PSA RECEIPTS MENU^Receipts Menu^^M^^^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,8035,1,0)
^^2^2^2970722^
"KRN",19,8035,1,1,0)
The Receipts menu contains options that process and report receipts for
"KRN",19,8035,1,2,0)
purchase orders and control point transactions.
"KRN",19,8035,10,0)
^19.01IP^5^5
"KRN",19,8035,10,1,0)
4159^1^10
"KRN",19,8035,10,1,"^")
PSA RECEIVING
"KRN",19,8035,10,2,0)
4163^2^20
"KRN",19,8035,10,2,"^")
PSA PURCHASE ORDER REVIEW
"KRN",19,8035,10,3,0)
4165^3^30
"KRN",19,8035,10,3,"^")
PSA CP TRANSACTION REVIEW
"KRN",19,8035,10,4,0)
4166^4^40
"KRN",19,8035,10,4,"^")
PSA DRUG HISTORY
"KRN",19,8035,10,5,0)
4240^5^50
"KRN",19,8035,10,5,"^")
PSA INVOICE REVIEW
"KRN",19,8035,20)
W !!?10,"GIP Interface"
"KRN",19,8035,99)
57233,57617
"KRN",19,8035,"U")
RECEIPTS MENU
"KRN",19,8441,-1)
0^46
"KRN",19,8441,0)
PSA ORDERS ALERT^Prime Vendor Processing/Verifying Alerts at Signon^^A^^^^^^^^DRUG ACCOUNTABILITY^^1^
"KRN",19,8441,1,0)
^^4^4^2970519^
"KRN",19,8441,1,1,0)
The Prime Vendor Processing/Verifying Alerts at Signon option checks to
"KRN",19,8441,1,2,0)
see if there are any invoices that need to be processed or verified by the
"KRN",19,8441,1,3,0)
user. If so a message is displayed when the user signs on the system
"KRN",19,8441,1,4,0)
stating the number of invoices that need to be processed and/or verified.
"KRN",19,8441,15)

"KRN",19,8441,20)
D ^PSALOGON
"KRN",19,8441,"U")
PRIME VENDOR PROCESSING/VERIFY
"KRN",19,8451,-1)
0^62
"KRN",19,8451,0)
PSA STOCK AND REORDER LEVELS^Enter/Edit Stock and Reorder Levels^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,8451,1,0)
^^5^5^2970507^
"KRN",19,8451,1,1,0)
The Enter/Edit Stock and Reorder Levels option flags a pharmacy location
"KRN",19,8451,1,2,0)
or master vault to maintain the stock and reorder levels or removes the
"KRN",19,8451,1,3,0)
flag. It also allows the user to enter the stock and reorder levels. These
"KRN",19,8451,1,4,0)
levels are used to determine the number of dispense units that need to be
"KRN",19,8451,1,5,0)
ordered.
"KRN",19,8451,25)
PSALEVEL
"KRN",19,8451,"U")
ENTER/EDIT STOCK AND REORDER L
"KRN",19,8613,-1)
0^28
"KRN",19,8613,0)
PSA GIP MAINTENANCE RPT MENU^Maintenance Reports Menu^^M^^^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,8613,1,0)
^^3^3^2970813^^
"KRN",19,8613,1,1,0)
The Maintenance Reports menu contains options that generate reports on
"KRN",19,8613,1,2,0)
balance adjustments, drug balances by location, monthly summary, and drug
"KRN",19,8613,1,3,0)
transaction history reports.
"KRN",19,8613,10,0)
^19.01IP^8^8
"KRN",19,8613,10,3,0)
5121^4^40
"KRN",19,8613,10,3,"^")
PSA MONTHLY SUMMARY
"KRN",19,8613,10,4,0)
4228^3^30
"KRN",19,8613,10,4,"^")
PSA DRUG DISPLAY
"KRN",19,8613,10,5,0)
4133^2^20
"KRN",19,8613,10,5,"^")
PSA DISPLAY LOCATION
"KRN",19,8613,10,7,0)
8616^1^10
"KRN",19,8613,10,7,"^")
PSA BALANCE ADJUSTMENTS REPORT
"KRN",19,8613,10,8,0)
8630^5^50
"KRN",19,8613,10,8,"^")
PSA TRANSFER SIGNATURE SHEET
"KRN",19,8613,20)
W !!?10,"GIP Interface"
"KRN",19,8613,99)
57233,57617
"KRN",19,8613,"U")
MAINTENANCE REPORTS MENU
"KRN",19,8614,-1)
0^32
"KRN",19,8614,0)
PSA INVOICE COST SUMMARY^Invoice Cost Summary^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,8614,1,0)
^^3^3^2970507^
"KRN",19,8614,1,1,0)
The Invoice Cost Summary option generates a report of all invoices' cost
"KRN",19,8614,1,2,0)
data for a date range. It lists the order number, invoice number, invoice
"KRN",19,8614,1,3,0)
date, total invoice cost, total adjusted cost, and cost difference.
"KRN",19,8614,25)
PSACOST
"KRN",19,8614,"U")
INVOICE COST SUMMARY
"KRN",19,8615,-1)
0^53
"KRN",19,8615,0)
PSA PROCESSOR AND VERIFIER^Processor and Verifier^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,8615,1,0)
^^4^4^2970507^
"KRN",19,8615,1,1,0)
The Processor and Verifier option generates a report containing invoices'
"KRN",19,8615,1,2,0)
processor and verifier information for a date range. It lists the order
"KRN",19,8615,1,3,0)
number, invoice number, invoice date, processor's name, process date,
"KRN",19,8615,1,4,0)
verifier's name, and verification date.
"KRN",19,8615,25)
PSAPV
"KRN",19,8615,"U")
PROCESSOR AND VERIFIER
"KRN",19,8616,-1)
0^3
"KRN",19,8616,0)
PSA BALANCE ADJUSTMENTS REPORT^Balance Adjustments History^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,8616,1,0)
^^3^3^2970908^
"KRN",19,8616,1,1,0)
The Balance Adjustments History option contains the drug adjustment
"KRN",19,8616,1,2,0)
history. It lists the adjustment/transfer date and time, quantity,
"KRN",19,8616,1,3,0)
transactor, and reason.
"KRN",19,8616,25)
PSADJR
"KRN",19,8616,"U")
BALANCE ADJUSTMENTS HISTORY
"KRN",19,8617,-1)
0^50
"KRN",19,8617,0)
PSA PRIME VENDOR INTERFACE^Prime Vendor Interface Menu^^M^^^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,8617,1,0)
^^2^2^2970519^^
"KRN",19,8617,1,1,0)
The Prime Vendor Interface menu assists in the maintenance of a Pharmacy
"KRN",19,8617,1,2,0)
perpetual inventory by interfacing with the prime vendor's invoice data.
"KRN",19,8617,10,0)
^19.01IP^4^4
"KRN",19,8617,10,1,0)
8618^1^10
"KRN",19,8617,10,1,"^")
PSA PV LOCATION MENU
"KRN",19,8617,10,2,0)
5117^2^20
"KRN",19,8617,10,2,"^")
PSA DISPENSING MENU
"KRN",19,8617,10,3,0)
8620^4^40
"KRN",19,8617,10,3,"^")
PSA PV MAINTENANCE RPT MENU
"KRN",19,8617,10,4,0)
7340^3^30
"KRN",19,8617,10,4,"^")
PSA ORDERS MENU
"KRN",19,8617,20)
W !!?10,"Prime Vendor Interface"
"KRN",19,8617,99)
57233,57617
"KRN",19,8617,"U")
PRIME VENDOR INTERFACE MENU
"KRN",19,8618,-1)
0^56
"KRN",19,8618,0)
PSA PV LOCATION MENU^Pharmacy Location Maintenance Menu^^M^^^^^^^^DRUG ACCOUNTABILITY^^1^1
"KRN",19,8618,1,0)
^^3^3^2970812^^^^
"KRN",19,8618,1,1,0)
The Pharmacy Location Maintenance menu contains options that set up and
"KRN",19,8618,1,2,0)
edit pharmacy locations. The drug balances can be inititalized and
"KRN",19,8618,1,3,0)
adjusted. The drug stock and reorder levels can be entered and edited.
"KRN",19,8618,10,0)
^19.01IP^6^6
"KRN",19,8618,10,1,0)
4131^1^10
"KRN",19,8618,10,1,"^")
PSA LOCATION EDIT
"KRN",19,8618,10,2,0)
4868^3^30
"KRN",19,8618,10,2,"^")
PSA BALANCE INITIALIZE
"KRN",19,8618,10,3,0)
4167^2^20
"KRN",19,8618,10,3,"^")
PSA BALANCE ADJUSTMENTS
"KRN",19,8618,10,4,0)
8627^4^40
"KRN",19,8618,10,4,"^")
PSA PV DRUG ENTER/EDIT
"KRN",19,8618,10,5,0)
8451^5^50
"KRN",19,8618,10,5,"^")
PSA STOCK AND REORDER LEVELS
"KRN",19,8618,10,6,0)
8629^6^60
"KRN",19,8618,10,6,"^")
PSA TRANSFER DRUGS
"KRN",19,8618,15)
K PSAPVMEN
"KRN",19,8618,20)
S PSAPVMEN=1 W !!?10,"Prime Vendor Interface"
"KRN",19,8618,99)
57233,57617
"KRN",19,8618,"U")
PHARMACY LOCATION MAINTENANCE 
"KRN",19,8619,-1)
0^25
"KRN",19,8619,0)
PSA GIP INTERFACE MENU^GIP Interface Menu^^M^^^^^^^^DRUG ACCOUNTABILITY^^1^
"KRN",19,8619,1,0)
^^2^2^2970923^
"KRN",19,8619,1,1,0)
The GIP Interface menu assists in the maintenance of a Pharmacy perpetual
"KRN",19,8619,1,2,0)
inventory by interfacing with the Generic Inventory Package (GIP).
"KRN",19,8619,10,0)
^19.01IP^6^6
"KRN",19,8619,10,1,0)
4130^2^20
"KRN",19,8619,10,1,"^")
PSA GIP LOCATION MENU
"KRN",19,8619,10,2,0)
5117^4^40
"KRN",19,8619,10,2,"^")
PSA DISPENSING MENU
"KRN",19,8619,10,3,0)
8613^5^50
"KRN",19,8619,10,3,"^")
PSA GIP MAINTENANCE RPT MENU
"KRN",19,8619,10,5,0)
4129^1^10
"KRN",19,8619,10,5,"^")
PSA CONNECTION MENU
"KRN",19,8619,10,6,0)
8035^3^30
"KRN",19,8619,10,6,"^")
PSA RECEIPTS MENU
"KRN",19,8619,15)

"KRN",19,8619,20)
W !!?10,"GIP Interface"
"KRN",19,8619,99)
57233,57617
"KRN",19,8619,"U")
GIP INTERFACE MENU
"KRN",19,8620,-1)
0^57
"KRN",19,8620,0)
PSA PV MAINTENANCE RPT MENU^Maintenance Reports Menu^^M^^^^^^^^DRUG ACCOUNTABILITY^^1
"KRN",19,8620,1,0)
^^4^4^2970813^^
"KRN",19,8620,1,1,0)
The Maintenance Reports menu contains options that generate reports on
"KRN",19,8620,1,2,0)
balance adjustments, drug transaction history, drug balances by pharmacy
"KRN",19,8620,1,3,0)
location, invoice cost summary, monthly summary, processor and verifier of
"KRN",19,8620,1,4,0)
an invoice, and stock and reorder levels for drugs in a pharmacy location.
"KRN",19,8620,10,0)
^19.01IP^10^10
"KRN",19,8620,10,2,0)
4133^2^20
"KRN",19,8620,10,2,"^")
PSA DISPLAY LOCATION
"KRN",19,8620,10,3,0)
8614^4^40
"KRN",19,8620,10,3,"^")
PSA INVOICE COST SUMMARY
"KRN",19,8620,10,4,0)
5121^5^50
"KRN",19,8620,10,4,"^")
PSA MONTHLY SUMMARY
"KRN",19,8620,10,5,0)
8615^7^70
"KRN",19,8620,10,5,"^")
PSA PROCESSOR AND VERIFIER
"KRN",19,8620,10,6,0)
4228^3^30
"KRN",19,8620,10,6,"^")
PSA DRUG DISPLAY
"KRN",19,8620,10,7,0)
8033^6^60
"KRN",19,8620,10,7,"^")
PSA OUTSTANDING CREDITS
"KRN",19,8620,10,8,0)
8616^1^10
"KRN",19,8620,10,8,"^")
PSA BALANCE ADJUSTMENTS REPORT
"KRN",19,8620,10,9,0)
8621^8^80
"KRN",19,8620,10,9,"^")
PSA STOCK & REORDER LEVEL RPT
"KRN",19,8620,10,10,0)
8630^9^90
"KRN",19,8620,10,10,"^")
PSA TRANSFER SIGNATURE SHEET
"KRN",19,8620,20)
W !!?10,"Prime Vendor Interface"
"KRN",19,8620,99)
57233,57617
"KRN",19,8620,"U")
MAINTENANCE REPORTS MENU
"KRN",19,8621,-1)
0^61
"KRN",19,8621,0)
PSA STOCK & REORDER LEVEL RPT^Stock and Reorder Level^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,8621,1,0)
^^3^3^2970616^
"KRN",19,8621,1,1,0)
The Stock and Reorder Levels option prints a report by pharmacy location
"KRN",19,8621,1,2,0)
and/or master vault. The report contains the drug name, stock level, and
"KRN",19,8621,1,3,0)
reorder level.
"KRN",19,8621,25)
PSALEVRP
"KRN",19,8621,"U")
STOCK AND REORDER LEVEL
"KRN",19,8627,-1)
0^55
"KRN",19,8627,0)
PSA PV DRUG ENTER/EDIT^Enter/Edit a Drug^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,8627,1,0)
^^4^4^2970729^^
"KRN",19,8627,1,1,0)
The Enter/Edit a Drug option adds a new drug to the pharmacy location. If
"KRN",19,8627,1,2,0)
the drug is being added to the location and the location maintains stock
"KRN",19,8627,1,3,0)
and reorder levels, it prompts for the stock and reorder levels. It also
"KRN",19,8627,1,4,0)
displays the balance of an existing drug.
"KRN",19,8627,25)
PSADRUGP
"KRN",19,8627,"U")
ENTER/EDIT A DRUG
"KRN",19,8629,-1)
0^63
"KRN",19,8629,0)
PSA TRANSFER DRUGS^Transfer Drugs Between Pharmacies^^R^^PSAMGR^^^^^^DRUG ACCOUNTABILITY
"KRN",19,8629,1,0)
^^5^5^2970812^
"KRN",19,8629,1,1,0)
The Transfer Drugs Between Pharmacies option allows a pharmacist to move
"KRN",19,8629,1,2,0)
drugs between pharmacy locations. The number of dispense units to be moved
"KRN",19,8629,1,3,0)
is subtracted from the dispensing pharmacy location and added to the
"KRN",19,8629,1,4,0)
receiving pharmacy location. A Transfer Signature Sheet may be printed
"KRN",19,8629,1,5,0)
after all transfers are completed.
"KRN",19,8629,25)
PSATRAN
"KRN",19,8629,"U")
TRANSFER DRUGS BETWEEN PHARMAC
"KRN",19,8630,-1)
0^64
"KRN",19,8630,0)
PSA TRANSFER SIGNATURE SHEET^Transfer Signature Sheet^^R^^^^^^^^DRUG ACCOUNTABILITY
"KRN",19,8630,1,0)
^^4^4^2970813^^
"KRN",19,8630,1,1,0)
The Transfer Signature Sheet option prints a report of all transferred
"KRN",19,8630,1,2,0)
drugs within a specific date range. This report is used to record the
"KRN",19,8630,1,3,0)
signature of the person who received the drugs or to review transfer
"KRN",19,8630,1,4,0)
history.
"KRN",19,8630,25)
REPRINT^PSASIG
"KRN",19,8630,"U")
TRANSFER SIGNATURE SHEET
"KRN",19,8643,-1)
1^70
"KRN",19,8643,0)
PSA DRUG MENU
"KRN",19,8644,-1)
1^71
"KRN",19,8644,0)
PSA LOCATION MENU
"KRN",19,8645,-1)
1^72
"KRN",19,8645,0)
PSA ONLINE DOCUMENTATION
"KRN",19.1,151,-1)
0^2
"KRN",19.1,151,0)
PSAMGR^Drug Acct. Manager's key^l
"KRN",19.1,151,1,0)
^^6^6^2970926^^
"KRN",19.1,151,1,1,0)
The PSAMGR key is required to manually change drug balances and enter
"KRN",19.1,151,1,2,0)
credit memo data.
"KRN",19.1,151,1,3,0)
 
"KRN",19.1,151,1,4,0)
The PSAMGR key restricts access to the Balance Adjustments [PSA BALANCE
"KRN",19.1,151,1,5,0)
ADJUSTMENTS], Credit Resolution [PSA CREDIT RESOLUTION], and Transfer
"KRN",19.1,151,1,6,0)
Drugs Between Pharmacies [PSA TRANSFER DRUGS] options.
"KRN",19.1,219,-1)
0^1
"KRN",19.1,219,0)
PSA ORDERS^Process & verify orders key^l
"KRN",19.1,219,1,0)
^^2^2^2970922^^
"KRN",19.1,219,1,1,0)
The PSA ORDERS key is required to process and verify Drug Accountability
"KRN",19.1,219,1,2,0)
prime vendor orders.
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",1,9.2)
9.2;1;;;HELP^XPDTA1;HLPF1^XPDIA1;HLPE1^XPDIA1;HLPF2^XPDIA1;;HLPDEL^XPDIA1
"ORD",1,9.2,0)
HELP FRAME
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",182,-1)
1^1
"PKG",182,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability/Inventory Interface^
"PKG",182,5)
BIRMINGHAM
"PKG",182,7)
BIRMINGHAM
"PKG",182,20,0)
^9.402P^^0
"PKG",182,22,0)
^9.49I^1^1
"PKG",182,22,1,0)
3.0^2971024^2970912^531
"PKG",182,22,1,1,0)
^^1^1^2971024
"PKG",182,22,1,1,1,0)
Drug Accountability/Inventory Interface V. 3.0
"PKG",182,"DEV")
JANICE BARNETT BIR CIO-FO
"PKG",182,"VERSION")
3.0
"PRE")
PSAENVIR
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
113
"RTN","PSACON")
0^1^B11156423
"RTN","PSACON",1,0)
PSACON ;BIR/LTL-Display Connected Drug and Procurement History ;7/23/97
"RTN","PSACON",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSACON",3,0)
 ;
"RTN","PSACON",4,0)
 N DA,DIC,DTOUT,DUOUT,PSA,PSACON,PSAW,X,Y
"RTN","PSACON",5,0)
 D DT^DICRW
"RTN","PSACON",6,0)
 F  S DIC="^PSDRUG(",DIC(0)="AEMQZ",DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)",DIC("W")="W:'$O(^(441,0)) ?65,""NOT CONNECTED""" W ! D ^DIC K DA,DIC G:Y<0 END S PSA=+Y D  G:Y<0 END G:$G(PSAW) ^PSACONW D:$G(PSACON) ^PSACON1 D ^PSACON2
"RTN","PSACON",7,0)
 .W @IOF,!!,$P($G(^PSDRUG(+PSA,0)),U),!!,?25,"** FROM THE DRUG FILE **",!!
"RTN","PSACON",8,0)
 .W "FSN: ",$P($G(^PSDRUG(+PSA,0)),U,6),?40,"NDC: ",$P($G(^PSDRUG(+PSA,2)),U,4),!!
"RTN","PSACON",9,0)
 .S PSA(5)=$S($P($G(^PSDRUG(+PSA,660)),U,5):$P($G(^(660)),U,5),1:1)
"RTN","PSACON",10,0)
 .S PSA(6)=$P($G(^DIC(51.5,+$P($G(^PSDRUG(+PSA,660)),U,2),0)),U)
"RTN","PSACON",11,0)
 .W "PACKAGING: ",PSA(5),"/",PSA(6)
"RTN","PSACON",12,0)
 .S PSA(8)=$P($G(^PSDRUG(+PSA,660)),U,8)
"RTN","PSACON",13,0)
 .W ?20,"PRICE: $",$P($G(^PSDRUG(+PSA,660)),U,3),"/",PSA(6)
"RTN","PSACON",14,0)
 .W ?40,"PRICE/DISPENSE UNIT: $",$P($G(^PSDRUG(+PSA,660)),U,6),"/",PSA(8)
"RTN","PSACON",15,0)
 .S PSA(15)=$O(^PSDRUG(+PSA,441,0)),PSA(1)=$G(^(+PSA(15),0))
"RTN","PSACON",16,0)
 .;more than one item linked
"RTN","PSACON",17,0)
 .D:$O(^PSDRUG(+PSA,441,PSA(15)))  Q:Y<0  K DIC,DA
"RTN","PSACON",18,0)
 ..W !!,"There is more than one item linked to this drug.",!
"RTN","PSACON",19,0)
 ..S DIC="^PSDRUG(+PSA,441,",DIC(0)="AEQ",DA(1)=+PSA
"RTN","PSACON",20,0)
 ..S DIC("W")="W ?10,$$DESCR^PRCPUX1(0,$G(^(0)))"
"RTN","PSACON",21,0)
 ..D ^DIC Q:Y<0  S PSA(1)=$G(^PSDRUG(+PSA,441,+Y,0)) K DIC,DA
"RTN","PSACON",22,0)
 .I 'PSA(1) S Y=-1 Q
"RTN","PSACON",23,0)
 .D:PSA(1)  Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSACON",24,0)
 ..W !!?25,"<< FROM THE ITEM MASTER FILE >>",!!
"RTN","PSACON",25,0)
 ..S PSA(11)=$G(^PRC(441,+PSA(1),0))
"RTN","PSACON",26,0)
 ..W "ITEM #: ",PSA(1),?15,$$DESCR^PRCPUX1(0,PSA(1)),!!
"RTN","PSACON",27,0)
 ..W "NSN: ",$$NSN^PRCPUX1(PSA(1))
"RTN","PSACON",28,0)
 ..I $P($G(^PRC(440,+$P(PSA(11),U,8),0)),U,11)="S" S PSAW=$O(^PRCP(445,"AC","W","")) Q
"RTN","PSACON",29,0)
 ..S PSA(3)=$O(^PRC(441,+PSA(1),2,0))
"RTN","PSACON",30,0)
 ..I PSA(3)&('$O(^PRC(441,+PSA(1),2,+PSA(3)))) D  Q
"RTN","PSACON",31,0)
 ...W ?40,"ONLY VENDOR: ",$E($$VENNAME^PRCPUX1(+PSA(3)_"PRC(440"),1,28),!!
"RTN","PSACON",32,0)
 ...S PSA(33)=$G(^PRC(441,+PSA(1),2,+PSA(3),0))
"RTN","PSACON",33,0)
 ...W "VENDOR STOCK #: ",$P(PSA(33),U,4)
"RTN","PSACON",34,0)
 ...W ?40,"NDC: ",$P(PSA(33),U,5),!!
"RTN","PSACON",35,0)
 ...W "PACKAGING: ",$$UNITVAL^PRCPUX1($P(PSA(33),U,8),$P(PSA(33),U,7))
"RTN","PSACON",36,0)
 ...W ?20,"PRICE: $",$P(PSA(33),U,2),"/",$$UNITCODE^PRCPUX1($P(PSA(33),U,7))
"RTN","PSACON",37,0)
 ...W ?40,"PRICE/DISPENSE UNIT: $",$P(PSA(33),U,2)/PSA(5)
"RTN","PSACON",38,0)
 ...W !!,"MINIMUM ORDER: ",$P(PSA(33),U,12)
"RTN","PSACON",39,0)
 ...S Y=$P(PSA(33),U,6) X ^DD("DD")
"RTN","PSACON",40,0)
 ...S Y=$E(Y,1,4)_$S($L(Y)=10:$E(Y,7,10),$L(Y)=11:$E(Y,8,11),1:"")
"RTN","PSACON",41,0)
 ...W ?20,"PRICE DATE: ",Y
"RTN","PSACON",42,0)
 ...W ?40,"REQUIRED ORDER MULTIPLE: ",$P(PSA(33),U,11),!!
"RTN","PSACON",43,0)
 ..W !!,"LAST VENDOR ORDERED: ",$$VENNAME^PRCPUX1($P(PSA(11),U,4)_"PRC(440"),!!
"RTN","PSACON",44,0)
 ..W "MANDATORY SOURCE: ",$$VENNAME^PRCPUX1($P(PSA(11),U,8)_"PRC(440"),!
"RTN","PSACON",45,0)
 ..K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("A")="For Vendor listing, please select DEVICE: " D ^%ZIS I POP S DTOUT=1,Y=-1 W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSACON",46,0)
 ..I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="^PSACON1",ZTDESC="DRUG VENDORS",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S Y=1 Q
"RTN","PSACON",47,0)
 ..S (DTOUT,PSACON)=1 Q
"RTN","PSACON",48,0)
END K PSAOUT Q
"RTN","PSACON1")
0^2^B6728697
"RTN","PSACON1",1,0)
PSACON1 ;BIR/LTL-Display Connected Drug and Procurement History - CONT'D ;7/23/97
"RTN","PSACON1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSACON1",3,0)
 ;This routine is call by PSACON.
"RTN","PSACON1",4,0)
 ;
"RTN","PSACON1",5,0)
VEN N PSALN,PSAPG,PSARPDT S (PSA(7),PSAPG,PSAOUT)=0
"RTN","PSACON1",6,0)
 S Y=DT X ^DD("DD") S PSARPDT=Y D HEADER
"RTN","PSACON1",7,0)
 F  S PSA(7)=$O(^PRC(441,+PSA(1),2,PSA(7))) Q:'PSA(7)  S ^TMP("PSA",$J,(9999999-$P($G(^PRC(441,+PSA(1),2,+PSA(7),0)),U,6)),PSA(7))=$G(^PRC(441,+PSA(1),2,+PSA(7),0))
"RTN","PSACON1",8,0)
 S (PSA(7),PSA(77))=0
"RTN","PSACON1",9,0)
 F  S PSA(7)=$O(^TMP("PSA",$J,PSA(7))) Q:PSAOUT!('PSA(7))  D:$Y+4>IOSL HEADER Q:PSAOUT  F  S PSA(77)=$O(^TMP("PSA",$J,+PSA(7),PSA(77))) Q:PSAOUT!('PSA(77))  D
"RTN","PSACON1",10,0)
 .S PSA(66)=$G(^TMP("PSA",$J,+PSA(7),+PSA(77)))
"RTN","PSACON1",11,0)
 .S PSA(4)=$$UNITCODE^PRCPUX1($P($G(PSA(66)),U,7))
"RTN","PSACON1",12,0)
 .W !!,$E($$VENNAME^PRCPUX1(PSA(77)_"PRC(440"),1,20)
"RTN","PSACON1",13,0)
 .W ?22,$P($G(PSA(66)),U,8),"/",PSA(4)
"RTN","PSACON1",14,0)
 .W ?32,"$",$J($P($G(PSA(66)),U,2),7,2),"/",PSA(4)
"RTN","PSACON1",15,0)
 .W ?45,"$",$J($P($G(PSA(66)),U,2)/PSA(5),7,3),"/",PSA(8)
"RTN","PSACON1",16,0)
 .S Y=$P($G(PSA(66)),U,6) X ^DD("DD")
"RTN","PSACON1",17,0)
 .W ?60,Y
"RTN","PSACON1",18,0)
 .I $O(^PRC(440,+PSA(77),4,0)) S PSA(55)=0 F  S PSA(55)=$O(^PRC(440,+PSA(77),4,PSA(55))) Q:'PSA(55)  S:$P($G(^PRC(440,+PSA(77),4,+PSA(55),0)),U,2)'<DT PSA(44)=1
"RTN","PSACON1",19,0)
 .W:$G(PSA(44)) ?73,"YES" K PSA(44)
"RTN","PSACON1",20,0)
 I $E(IOST)'="C" W @IOF
"RTN","PSACON1",21,0)
 I $E(IOST,1,2)="C-",'PSAOUT S DIR(0)="EA",DIR("A")="END OF LIST!  Press <RET> to return to the option." W ! D ^DIR K DIR S:Y<1 PSAOUT=1
"RTN","PSACON1",22,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q") D HOME^%ZIS
"RTN","PSACON1",23,0)
 K ^TMP("PSA",$J) Q
"RTN","PSACON1",24,0)
HEADER I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSACON1",25,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSACON1",26,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1
"RTN","PSACON1",27,0)
 W !,$E($$DESCR^PRCPUX1(0,PSA(1)),1,45),?50,PSARPDT,?70,"PAGE: ",PSAPG,!,PSALN,!,"VENDOR",?23,"PKG",?32,"COST/PKG",?45,"COST/UNIT",?60,"PRICE DATE  CONTRACT",!,PSALN
"RTN","PSACON1",28,0)
 Q
"RTN","PSACON2")
0^3^B14430118
"RTN","PSACON2",1,0)
PSACON2 ;BIR/LTL-Display Connected Drug and Procurement History - CONT'D ;7/23/97
"RTN","PSACON2",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSACON2",3,0)
 ;This routine is called by PSACON.
"RTN","PSACON2",4,0)
 ;
"RTN","PSACON2",5,0)
 Q:'$O(^PRC(441,+PSA(1),4,0))!($G(PSAOUT))
"RTN","PSACON2",6,0)
HIS K PSACON N DIRUT,PSADT,PSAOUT,PSAB,PSAD,PSAQ S (PSA(9),PSAOUT)=0
"RTN","PSACON2",7,0)
 I PSA(1) F  S PSA(9)=$O(^PRC(441,+PSA(1),4,PSA(9))) Q:'PSA(9)  S:$O(^PRC(441,+PSA(1),4,+PSA(9),1,0)) PSA(10)=1
"RTN","PSACON2",8,0)
 I $G(PSA(10)) S DIR(0)="Y",DIR("A")="Procurement history exists, would you like to review",DIR("B")="Yes" W ! D ^DIR K DIR D:Y  I Y<1 S PSAOUT=1 G END G:$D(DIRUT) END
"RTN","PSACON2",9,0)
 .S DIR(0)="D",DIR("A")="How far back in time would you like to go",DIR("B")="T-6M" W ! D ^DIR K DIR Q:$D(DIRUT)  S PSA(13)=+Y
"RTN","PSACON2",10,0)
 .X ^DD("DD") S PSADT=Y
"RTN","PSACON2",11,0)
 .D NOW^%DTC S X1=X,X2=PSA(13) D ^%DTC S PSAD=$S(X/30>0:X/30,1:1)
"RTN","PSACON2",12,0)
 .S PSA(9)=$O(^PRC(441,+PSA(1),4,0)),Y=1
"RTN","PSACON2",13,0)
 I '$O(^PRC(441,+PSA(1),4,PSA(9))) G DEV
"RTN","PSACON2",14,0)
 S DIC="^PRC(441,+PSA(1),4,",DIC(0)="AEMQZ",DIC("W")="W:'$O(^(1,0)) ""  NO HISTORY""",DA(1)=PSA(1) W ! D ^DIC K DIC S PSA(9)=+Y I Y<0 S PSAOUT=1 G END
"RTN","PSACON2",15,0)
 I '$O(^PRC(441,+PSA(1),4,+PSA(9),1,0)) W !,"Sorry, no history for that particular Control Point.",! G END
"RTN","PSACON2",16,0)
DEV K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("A")="For procurement history, please select DEVICE: " W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" S PSAOUT=1 G END
"RTN","PSACON2",17,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="LOOP^PSACON2",ZTDESC="Drug Procurement History",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSACON2",18,0)
LOOP N PSALN,PSAPG,PSARPDT S (PSAPG,PSA(11))=0,Y=1 D HEADER
"RTN","PSACON2",19,0)
 F  S PSA(11)=$O(^PRC(441,+PSA(1),4,+PSA(9),1,PSA(11))),PSA(14)=$P($G(^PRC(442,+PSA(11),1)),U,15) Q:'PSA(11)!(PSAOUT)  D:$Y+4>IOSL HEADER G:'Y END D:PSA(14)'<PSA(13)
"RTN","PSACON2",20,0)
 .W !,$E($P($G(^PRC(442,+PSA(11),0)),U),5,10)
"RTN","PSACON2",21,0)
 .W ?8,$E($$VENNAME^PRCPUX1($P($G(^PRC(442,+PSA(11),1)),U)_"PRC(440"),1,20)
"RTN","PSACON2",22,0)
 .S Y=PSA(14) X ^DD("DD") W ?32,Y
"RTN","PSACON2",23,0)
 .S PSA(12)=$O(^PRC(442,+PSA(11),2,"AE",+PSA(1),""))
"RTN","PSACON2",24,0)
 .W ?45,$J($P($G(^PRC(442,+PSA(11),2,+PSA(12),0)),U,2),3) S PSAQ=$G(PSAQ)+$P($G(^(0)),U,2)
"RTN","PSACON2",25,0)
 .W " ",$$UNITCODE^PRCPUX1($P($G(^PRC(442,+PSA(11),2,+PSA(12),0)),U,3))
"RTN","PSACON2",26,0)
 .W ?55,"$",$J($P($G(^PRC(442,+PSA(11),2,+PSA(12),2)),U),9,2) S PSAB=$G(PSAB)+$P($G(^(2)),U)
"RTN","PSACON2",27,0)
 .W ?70,$P($G(^PRC(442,+PSA(11),2,+PSA(12),2)),U,8),! S Y=1
"RTN","PSACON2",28,0)
 .I '$O(^PRC(441,+PSA(1),4,+PSA(9),1,PSA(11))) S X=$G(PSAQ)/PSAD,X2=1,X3=5 D COMMA^%DTC W PSALN,!!,"Average ordered/month: ",X,?34,"TOTAL ORD: ",$J($G(PSAQ),3),?50,"TOTAL $: " S X=PSAB,X2="0$",X3=5 D COMMA^%DTC W X
"RTN","PSACON2",29,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSACON2",30,0)
 I $E(IOST,1,2)="C-",'PSAOUT S DIR(0)="EA",DIR("A")="END OF HISTORY!  Press <RET> to return to the option." W ! D ^DIR K DIR
"RTN","PSACON2",31,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSACON2",32,0)
 K PSA,PSACON
"RTN","PSACON2",33,0)
 Q
"RTN","PSACON2",34,0)
HEADER I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSACON2",35,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSACON2",36,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !,$E($P($G(^PSDRUG(+PSA,0)),U),1,40)
"RTN","PSACON2",37,0)
 W "=> from ",$G(PSADT),?60,"PAGE: ",PSAPG,!,PSALN,!,"PO #",?10,"VENDOR",?33,"PO DATE",?45,"QTY ORD",?57,"COST",?70,"QTY RECD",!,PSALN,!
"RTN","PSACON2",38,0)
 Q
"RTN","PSACONW")
0^4^B10426785
"RTN","PSACONW",1,0)
PSACONW ;BIR/LTL-Display Connected Drug and Procurement History - CONT'D ;7/23/97
"RTN","PSACONW",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSACONW",3,0)
 ;This routine contains the history of warehoused drugs. It is called
"RTN","PSACONW",4,0)
 ;by PSACON.
"RTN","PSACONW",5,0)
 ;
"RTN","PSACONW",6,0)
 N PSAI,PSAD,PSAN,PSAQ S (PSAI,PSAOUT)=0
"RTN","PSACONW",7,0)
 W !!,"The Supply Warehouse is the mandatory source for this item.",!
"RTN","PSACONW",8,0)
 I '$O(^PRCP(445.2,"AD",+PSAW,+PSA(1),"")) W !!,"NO HISTORY!" Q
"RTN","PSACONW",9,0)
 W !,"There is a procurement history."
"RTN","PSACONW",10,0)
 S DIR(0)="D",DIR("A")="How far back in time would you like to view",DIR("B")="T-3M" W ! D ^DIR K DIR S PSAD=Y I $D(DIRUT) S PSAOUT=1 G QUIT
"RTN","PSACONW",11,0)
 X ^DD("DD") S PSAD(2)=Y
"RTN","PSACONW",12,0)
 D NOW^%DTC S X1=X,X2=PSAD D ^%DTC S PSAD(1)=$S(X/30>0:X/30,1:1)
"RTN","PSACONW",13,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" W ! D ^%ZIS
"RTN","PSACONW",14,0)
 I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" S PSAOUT=1 G QUIT
"RTN","PSACONW",15,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="LOOP^PSACONW",ZTDESC="Drug Issue history",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G QUIT
"RTN","PSACONW",16,0)
LOOP N PSALN,PSAPG S PSAPG=0 D HEADER
"RTN","PSACONW",17,0)
 F  S PSAI=$O(^PRCP(445.2,"AD",+PSAW,+PSA(1),+PSAI)) Q:PSAOUT!('PSAI)  D:$Y+4>IOSL HEADER G:PSAOUT QUIT I $P($G(^PRCP(445.2,PSAI,0)),U,2)?1"R".N S PSAN=$G(^(0)) D:$G(PSAN)&($P($G(PSAN),U,17)'<PSAD)
"RTN","PSACONW",18,0)
 .S Y=$P($P(PSAN,U,17),".") D DD^%DT W !!,Y
"RTN","PSACONW",19,0)
 .W ?14,$P(PSAN,U,19),?33,$J(-$P(PSAN,U,7),3) S PSAQ=$G(PSAQ)-$P(PSAN,U,7)
"RTN","PSACONW",20,0)
 .W ?39,$P(PSAN,U,6)
"RTN","PSACONW",21,0)
 .S X=$P(PSAN,U,9),X2="2$",X3=5 D COMMA^%DTC S PSAN(1)=X
"RTN","PSACONW",22,0)
 .S X=$P(PSAN,U,9)*-$P(PSAN,U,7),X2="2$",X3=10 D COMMA^%DTC S PSAN(2)=X,PSAN(3)=$G(PSAN(3))+($P(PSAN,U,9)*-$P(PSAN,U,7))
"RTN","PSACONW",23,0)
 .W ?47,PSAN(1),?55,PSAN(2)
"RTN","PSACONW",24,0)
 .W ?66,$E($$INVNAME^PRCPUX1($P(PSAN,U,18)),1,14)
"RTN","PSACONW",25,0)
 S X=$G(PSAQ)/PSAD(1),X2=1,X3=5 D COMMA^%DTC W !,PSALN,!!,"Average ord/mon: ",X,?24,"TOT ORD: ",$J($G(PSAQ),3),?49,"TOTAL $: " S X=$G(PSAN(3)),X2="2$",X3=4 D COMMA^%DTC W X
"RTN","PSACONW",26,0)
QUIT W:$E(IOST)'="C" @IOF
"RTN","PSACONW",27,0)
 I $E(IOST,1,2)="C-",'PSAOUT S DIR(0)="EA",DIR("A")="END OF HISTORY!  Press <RET> to return to the option." W ! D ^DIR K DIR
"RTN","PSACONW",28,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q") D HOME^%ZIS
"RTN","PSACONW",29,0)
 Q
"RTN","PSACONW",30,0)
HEADER I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSACONW",31,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSACONW",32,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1
"RTN","PSACONW",33,0)
 W !,$E($P($G(^PSDRUG(+PSA,0)),U),1,40),"=> from ",PSAD(2),?60,"PAGE: ",PSAPG,!,PSALN,!?2,"DATE",?16,"TRANSACTION",?33,"QTY",?39,"PKG",?47,"UNIT $",?57,"TOTAL $",?66,"INVENTORY",!,PSALN
"RTN","PSACOST")
0^5^B29116689
"RTN","PSACOST",1,0)
PSACOST ;BIR/JMB-Invoice Cost Summary ;7/23/97
"RTN","PSACOST",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSACOST",3,0)
 ;This routine prints the order number, invoice number, invoice date,
"RTN","PSACOST",4,0)
 ;total invoice cost, total adjusted cost, and cost difference for a
"RTN","PSACOST",5,0)
 ;specified invoice date range.
"RTN","PSACOST",6,0)
 ;
"RTN","PSACOST",7,0)
 I '$D(^XUSEC("PSA ORDERS",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSACOST",8,0)
 I '$O(^PSD(58.811,"ADATE",0)) W !,"There are no invoices." G EXIT
"RTN","PSACOST",9,0)
 S PSAOUT=0 D BDATE^PSAPV G:PSAOUT EXIT
"RTN","PSACOST",10,0)
DEVICE ;Asks device & queueing info
"RTN","PSACOST",11,0)
 K IO("Q"),%ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=""
"RTN","PSACOST",12,0)
 W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSACOST",13,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSACOST",14,0)
 .N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK
"RTN","PSACOST",15,0)
 .S ZTRTN="COMPILE^PSACOST",ZTDESC="Drug Acct. - Invoice Cost Summary Report"
"RTN","PSACOST",16,0)
 .S:$D(PSABEG) ZTSAVE("PSABEG")="" S:$D(PSAEND) ZTSAVE("PSAEND")=""
"RTN","PSACOST",17,0)
 .D ^%ZTLOAD
"RTN","PSACOST",18,0)
 ;
"RTN","PSACOST",19,0)
COMPILE ;Compiles the data into ^TMP("PSACOST",$J)
"RTN","PSACOST",20,0)
 S PSAOUT=0,PSADATE=PSABEG
"RTN","PSACOST",21,0)
 F  S PSADATE=+$O(^PSD(58.811,"ADATE",PSADATE)) Q:'PSADATE!(PSADATE>PSAEND)!(PSAOUT)  D
"RTN","PSACOST",22,0)
 .S PSAIEN=0 F  S PSAIEN=+$O(^PSD(58.811,"ADATE",PSADATE,PSAIEN)) Q:'PSAIEN!(PSAOUT)  D
"RTN","PSACOST",23,0)
 ..Q:'$D(^PSD(58.811,PSAIEN,0))  S PSAORD=$P(^PSD(58.811,PSAIEN,0),"^"),(PSAIEN1,PSAOECST)=0
"RTN","PSACOST",24,0)
 ..F  S PSAIEN1=+$O(^PSD(58.811,"ADATE",PSADATE,PSAIEN,PSAIEN1)) Q:'PSAIEN1!(PSAOUT)  D
"RTN","PSACOST",25,0)
 ...Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0))
"RTN","PSACOST",26,0)
 ...S PSAIN=^PSD(58.811,PSAIEN,1,PSAIEN1,0),PSAINV=$P(PSAIN,"^"),PSAINVDT=$E(PSADATE,4,5)_"/"_$E(PSADATE,6,7)_"/"_$E(PSADATE,2,3)
"RTN","PSACOST",27,0)
 ...S (PSAAECST,PSAIECST)=0
"RTN","PSACOST",28,0)
 ...S PSALINE=0 F  S PSALINE=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE)) Q:'PSALINE!(PSAOUT)  D
"RTN","PSACOST",29,0)
 ....Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0))
"RTN","PSACOST",30,0)
 ....S PSADATA=^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0) D LINE
"RTN","PSACOST",31,0)
 ...S PSADIFF=PSAIECST-PSAAECST,PSAOECST=PSAOECST+PSAAECST
"RTN","PSACOST",32,0)
 ...S ^TMP("PSACOST",$J,PSAORD,PSAINV)=PSAINVDT_"^"_$J(PSAIECST,$L(PSAIECST),2)_"^"_$J(PSAAECST,$L($P(PSAAECST,".")),2)_"^"_$J(PSADIFF,$L(PSADIFF),2)
"RTN","PSACOST",33,0)
 ;
"RTN","PSACOST",34,0)
ORDER S PSAORD="" F  S PSAORD=$O(^TMP("PSACOST",$J,PSAORD)) Q:PSAORD=""  D
"RTN","PSACOST",35,0)
 .S (PSAACOST,PSADIFF,PSAICOST)=0,PSAINV=""
"RTN","PSACOST",36,0)
 .F  S PSAINV=$O(^TMP("PSACOST",$J,PSAORD,PSAINV)) Q:PSAINV=""  D
"RTN","PSACOST",37,0)
 ..S PSAICOST=PSAICOST+$P(^TMP("PSACOST",$J,PSAORD,PSAINV),"^",2),PSAACOST=PSAACOST+$P(^TMP("PSACOST",$J,PSAORD,PSAINV),"^",3),PSADIFF=PSADIFF+$P(^TMP("PSACOST",$J,PSAORD,PSAINV),"^",4)
"RTN","PSACOST",38,0)
 .S ^TMP("PSACOST",$J,PSAORD)=$J(PSAICOST,$L(PSAICOST),2)_"^"_$J(PSAACOST,$L($P(PSAACOST,".")),2)_"^"_$J(PSADIFF,$L(PSADIFF),2)
"RTN","PSACOST",39,0)
 ;
"RTN","PSACOST",40,0)
PRINT ;Prints invoices' totals
"RTN","PSACOST",41,0)
 S Y=PSAEND D DD^%DT S PSAENDX=Y K X,Y,%DT
"RTN","PSACOST",42,0)
 S Y=PSABEG D DD^%DT S PSABEGX=Y K X,Y,%DT
"RTN","PSACOST",43,0)
 D NOW^%DTC S PSARUN=%,PSARUN=$E(PSARUN,4,5)_"/"_$E(PSARUN,6,7)_"/"_$E(PSARUN,2,3)_"@"_$E($P(PSARUN,".",2),1,2)_":"_$E($P(PSARUN,".",2),3,4)
"RTN","PSACOST",44,0)
 S PSAPG=0,PSASLN="",$P(PSASLN,"-",80)="" K Y D HDR
"RTN","PSACOST",45,0)
 S PSAORD=$O(^TMP("PSACOST",$J,"")) I PSAORD="" W !!,"There is no invoice data in the file for the selected date range.",! D END^PSAPROC G EXIT
"RTN","PSACOST",46,0)
 S PSAORD="" F  S PSAORD=$O(^TMP("PSACOST",$J,PSAORD)) Q:PSAORD=""!(PSAOUT)  D
"RTN","PSACOST",47,0)
 .S PSAODIFF=$P(^TMP("PSACOST",$J,PSAORD),"^",2)
"RTN","PSACOST",48,0)
 .I $Y+5>IOSL D HDR Q:PSAOUT
"RTN","PSACOST",49,0)
 .W !,"ORDER#: "_PSAORD
"RTN","PSACOST",50,0)
 .S PSAINV="" F  S PSAINV=$O(^TMP("PSACOST",$J,PSAORD,PSAINV)) Q:PSAINV=""!(PSAOUT)  D
"RTN","PSACOST",51,0)
 ..S PSAINVDT=$P(^TMP("PSACOST",$J,PSAORD,PSAINV),"^"),PSAICOST=$P(^(PSAINV),"^",2),PSAACOST=$P(^(PSAINV),"^",3),PSADIFF=$P(^(PSAINV),"^",4)
"RTN","PSACOST",52,0)
 ..I $Y+4>IOSL D HDR Q:PSAOUT
"RTN","PSACOST",53,0)
 ..W !,PSAINV,?27,PSAINVDT,?39,$J(PSAICOST,9,2),?55,$J(PSAACOST,9,2),?71,$J(PSADIFF,7,2)
"RTN","PSACOST",54,0)
 .I $Y+4>IOSL D HDR Q:PSAOUT
"RTN","PSACOST",55,0)
 .S PSAOCOST=$P(^TMP("PSACOST",$J,PSAORD),"^"),PSAOACST=$P(^(PSAORD),"^",2),PSAODIFF=$P(^(PSAORD),"^",3)
"RTN","PSACOST",56,0)
 .I PSAICOST'=PSAOCOST!(PSAACOST'=PSAOACST) W !,"ORDER TOTAL" W ?39,$J(PSAOCOST,9,2),?55,$J(PSAOACST,9,2),?69 W $J(PSAODIFF,9,2),!
"RTN","PSACOST",57,0)
 .E  W !
"RTN","PSACOST",58,0)
 I $E(IOST,1,2)="C-" Q:PSAOUT  D END^PSAPROC
"RTN","PSACOST",59,0)
 E  W @IOF
"RTN","PSACOST",60,0)
 ;
"RTN","PSACOST",61,0)
EXIT D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q"),^TMP("PSACOST",$J)
"RTN","PSACOST",62,0)
 K %,%DT,%ZIS,PSAACOST,PSAAECST,PSABEG,PSABEGX,PSADATA,PSADATE,PSADIFF,PSADJ,PSADJP,PSADJQ,PSAEND,PSAENDX,PSAICOST,PSAIECST,PSAIEN
"RTN","PSACOST",63,0)
 K PSAIEN1,PSAIN,PSAINV,PSAINVDT,PSALCOST,PSALINE,PSANODE,PSAOACST,PSAOCOST,PSAODIFF,PSAOECST,PSAORD,PSAOUT,PSAPG,PSAPRICE,PSARUN,PSASLN,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSACOST",64,0)
 Q
"RTN","PSACOST",65,0)
 ;
"RTN","PSACOST",66,0)
LINE ;Get line item data
"RTN","PSACOST",67,0)
 S PSALCOST=$P(PSADATA,"^",3)*$P(PSADATA,"^",5),PSAIECST=PSAIECST+PSALCOST
"RTN","PSACOST",68,0)
PRICE S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","P",0))
"RTN","PSACOST",69,0)
 I +PSADJ S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)),PSAPRICE=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:+$P(PSANODE,"^",2)),PSADJP=PSAPRICE
"RTN","PSACOST",70,0)
 I '+PSADJ S PSAPRICE=$P(PSADATA,"^",5)
"RTN","PSACOST",71,0)
QTY S PSADJQ=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","Q",0))
"RTN","PSACOST",72,0)
 I +PSADJ D
"RTN","PSACOST",73,0)
 .S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0))
"RTN","PSACOST",74,0)
 .S PSADJQ=$S($P(PSANODE,"^",6)'="":+$P(PSANODE,"^",6),1:+$P(PSANODE,"^",2))
"RTN","PSACOST",75,0)
 .S PSAACOST=PSADJQ*PSAPRICE,PSAAECST=PSAAECST+PSAACOST
"RTN","PSACOST",76,0)
 I '+PSADJQ S PSAACOST=$P(PSADATA,"^",3)*PSAPRICE,PSAAECST=PSAAECST+PSAACOST
"RTN","PSACOST",77,0)
 Q
"RTN","PSACOST",78,0)
 ;
"RTN","PSACOST",79,0)
HDR ;Report header
"RTN","PSACOST",80,0)
 I $E(IOST,1,2)="C-" W:'PSAPG @IOF D:+PSAPG END^PSAPROC Q:PSAOUT
"RTN","PSACOST",81,0)
 I $E(IOST)'="C",+PSAPG W @IOF
"RTN","PSACOST",82,0)
 S PSAPG=PSAPG+1
"RTN","PSACOST",83,0)
 W !?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",?72,"PAGE "_PSAPG
"RTN","PSACOST",84,0)
 W !?27,"INVOICE COST SUMMARY REPORT"
"RTN","PSACOST",85,0)
 I $E(IOST)'="C" W !,"RUN: "_PSARUN,?27,PSABEGX_" - "_PSAENDX
"RTN","PSACOST",86,0)
 E  W !,?27,PSABEGX_" - "_PSAENDX
"RTN","PSACOST",87,0)
 W !!?28,"INVOICE",?41,"INVOICE",?56,"ADJUSTED"
"RTN","PSACOST",88,0)
 W !,"INVOICE#",?31,"DATE",?44,"COST",?60,"COST",?68,"DIFFERENCE",!,PSASLN
"RTN","PSACOST",89,0)
 Q
"RTN","PSACREDO")
0^6^B70380086
"RTN","PSACREDO",1,0)
PSACREDO ;BIR/JMB-Outstanding Credits ;7/23/97
"RTN","PSACREDO",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSACREDO",3,0)
 ;This routine prints detailed or summary outstanding credits report.
"RTN","PSACREDO",4,0)
 ;
"RTN","PSACREDO",5,0)
 I '$D(^XUSEC("PSA ORDERS",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSACREDO",6,0)
 I '$O(^PSD(58.811,"AC",1,0)) W !!,"There are no outstanding credit memos." Q
"RTN","PSACREDO",7,0)
 S DIR(0)="S^D:Detailed Report;S:Summary Report",DIR("A")="Print a detailed or summary report",DIR("??")="^D RPT^PSACREDO" D ^DIR K DIR I $G(DIRUT) G EXIT
"RTN","PSACREDO",8,0)
 S PSARPT=Y W:PSARPT="D" !!,"The report must be sent to a 132 column printer."
"RTN","PSACREDO",9,0)
DEVICE W ! S %ZIS="Q" D ^%ZIS G:POP EXIT
"RTN","PSACREDO",10,0)
 I PSARPT="D",$E(IOST,1,2)="C-" W !!,"The report must be sent to a 132 column printer." G DEVICE
"RTN","PSACREDO",11,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSACREDO",12,0)
 .S ZTDESC="Drug Acct. - Print Outstanding Credits",ZTRTN="DQ^PSACREDO"
"RTN","PSACREDO",13,0)
 .S ZTSAVE("PSARPT")="" D ^%ZTLOAD
"RTN","PSACREDO",14,0)
DQ S PSASLN="",$P(PSASLN,"-",80)="",PSALSLN="",$P(PSALSLN,"-",132)=""
"RTN","PSACREDO",15,0)
 S (PSAGDF,PSA,PSAOUT,PSAPG)=0
"RTN","PSACREDO",16,0)
 F  S PSA=+$O(^PSD(58.811,"AC",1,PSA)) Q:'PSA  D  Q:PSAOUT
"RTN","PSACREDO",17,0)
 .Q:'$D(^PSD(58.811,PSA,0))
"RTN","PSACREDO",18,0)
 .S PSAORD=$P(^PSD(58.811,PSA,0),"^"),(PSA1,PSAOECST,PSAODF)=0
"RTN","PSACREDO",19,0)
 .F  S PSA1=+$O(^PSD(58.811,"AC",1,PSA,PSA1)) Q:'PSA1  D  Q:PSAOUT
"RTN","PSACREDO",20,0)
 ..Q:'$D(^PSD(58.811,PSA,1,PSA1,0))
"RTN","PSACREDO",21,0)
 ..S PSAINV=$P(^PSD(58.811,PSA,1,PSA1,0),"^"),(PSACRED,PSAAECST,PSAIECST)=0
"RTN","PSACREDO",22,0)
 ..S PSA2=0 F  S PSA2=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2)) Q:'PSA2!(PSAOUT)  D  Q:PSAOUT
"RTN","PSACREDO",23,0)
 ...Q:'$D(^PSD(58.811,PSA,1,PSA1,1,PSA2,0))
"RTN","PSACREDO",24,0)
 ...S PSADATA=^PSD(58.811,PSA,1,PSA1,1,PSA2,0)
"RTN","PSACREDO",25,0)
 ...D LINE
"RTN","PSACREDO",26,0)
 ..D CREDITS S PSAODF=PSAODF+$G(PSADF),PSAOECST=PSAOECST+PSAAECST
"RTN","PSACREDO",27,0)
 .S PSA(PSAORD)=$J(PSAOECST,$L($P(PSAOECST,".")),2)_"^"_$J(PSAODF,$L($P(PSAODF,".")),2)
"RTN","PSACREDO",28,0)
 .S PSAGDF=PSAGDF+PSAODF
"RTN","PSACREDO",29,0)
 ;
"RTN","PSACREDO",30,0)
 S PSAORD="" F  S PSAORD=$O(PSA(PSAORD)) Q:PSAORD=""  S PSAINV="" F  S PSAINV=$O(^PSD(58.811,"AORD",PSAORD,PSAINV)) Q:PSAINV=""  D
"RTN","PSACREDO",31,0)
 .Q:$D(PSA(PSAORD,PSAINV))  S (PSA,PSAAECST,PSAIECST)=0
"RTN","PSACREDO",32,0)
 .F  S PSA=$O(^PSD(58.811,"AORD",PSAORD,PSAINV,PSA)) Q:'PSA  S PSA1=0 F  S PSA1=$O(^PSD(58.811,"AORD",PSAORD,PSAINV,PSA,PSA1)) Q:'PSA1  D
"RTN","PSACREDO",33,0)
 ..D GETLINE
"RTN","PSACREDO",34,0)
 ..I 'PSAAECST&(+PSAIECST) S $P(PSA(PSAORD),"^")=+$P(PSA(PSAORD),"^")+PSAIECST,$P(PSA(PSAORD),"^")=$J($P(PSA(PSAORD),"^"),$L($P($P(PSA(PSAORD),"^"),".")),2)
"RTN","PSACREDO",35,0)
 ..I PSAAECST S $P(PSA(PSAORD),"^")=+$P(PSA(PSAORD),"^")+PSAAECST,$P(PSA(PSAORD),"^")=$J($P(PSA(PSAORD),"^"),$L($P($P(PSA(PSAORD),"^"),".")),2)
"RTN","PSACREDO",36,0)
 D PRINT
"RTN","PSACREDO",37,0)
 ;
"RTN","PSACREDO",38,0)
EXIT D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSACREDO",39,0)
 K %ZIS,DIR,DIRUT,PSA,PSA1,PSA2,PSAACST,PSAAECST,PSAAVAL,PSAC,PSACRED,PSADATA,PSADF,PSADJ,PSADJD,PSADJP,PSADJQ,PSADRG,PSADT,PSAFLD,PSAGDF,PSAICST
"RTN","PSACREDO",40,0)
 K PSAIDF,PSAIECST,PSAINV,PSAINVDT,PSAIVAL,PSAKK,PSALN,PSALSLN,PSAN,PSAODF,PSAOECST,PSAORD,PSAOUT,PSAPFLD,PSAPG,PSAPRC,PSAPRT,PSAQFLD,PSAREA,PSARPDT,PSARPT,PSASLN,PSASS,Y,ZTDESC,ZTRTN,ZTSAVE
"RTN","PSACREDO",41,0)
 Q
"RTN","PSACREDO",42,0)
 ;
"RTN","PSACREDO",43,0)
LINE ;Get line item data
"RTN","PSACREDO",44,0)
 S PSARPDT=$E($$HTFM^XLFDT($H),1,12),PSADT=$P(PSARPDT,".")
"RTN","PSACREDO",45,0)
 S PSARPDT=$E(PSADT,4,5)_"/"_$E(PSADT,6,7)_"/"_$E(PSADT,2,3)_"@"_$P(PSARPDT,".",2)
"RTN","PSACREDO",46,0)
 S (PSADJQ,PSADJP,PSADJD,PSAPFLD,PSAQFLD,PSAREA)="",(PSADRG,PSAACST,PSAICST)=0
"RTN","PSACREDO",47,0)
 S PSADJ=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,"B","D",0))
"RTN","PSACREDO",48,0)
 I +PSADJ D
"RTN","PSACREDO",49,0)
 .S PSAN=$G(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,PSADJ,0))
"RTN","PSACREDO",50,0)
 .S PSADJD=$S($P(PSAN,"^",6)'="":$P(PSAN,"^",6),1:$P(PSAN,"^",2)),PSADRG=PSADJD
"RTN","PSACREDO",51,0)
 .Q:+PSADJD&($L(PSADJD)=+$L(PSADJD))
"RTN","PSACREDO",52,0)
 E  S PSADRG=$P(PSADATA,"^",2)
"RTN","PSACREDO",53,0)
 S PSAICST=$P(PSADATA,"^",3)*$P(PSADATA,"^",5),PSAIECST=PSAIECST+PSAICST
"RTN","PSACREDO",54,0)
 S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,"B","P",0))
"RTN","PSACREDO",55,0)
 I +PSADJ D
"RTN","PSACREDO",56,0)
 .S PSAN=$G(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,PSADJ,0)),PSAPRC=$S($P(PSAN,"^",6)'="":$P(PSAN,"^",6),1:+$P(PSAN,"^",2)),PSADJP=PSAPRC
"RTN","PSACREDO",57,0)
 .S PSAPFLD="P"
"RTN","PSACREDO",58,0)
 I '+PSADJ S PSAPRC=$P(PSADATA,"^",5)
"RTN","PSACREDO",59,0)
 S PSADJQ=0,PSADJ=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,"B","Q",0))
"RTN","PSACREDO",60,0)
 I +PSADJ D
"RTN","PSACREDO",61,0)
 .S PSAN=$G(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,PSADJ,0))
"RTN","PSACREDO",62,0)
 .S PSADJQ=$S($P(PSAN,"^",6)'="":+$P(PSAN,"^",6),1:+$P(PSAN,"^",2))
"RTN","PSACREDO",63,0)
 .S PSAREA=$S($P(PSAN,"^",7)'="":$P(PSAN,"^",7),1:$P(PSAN,"^",3)),PSAQFLD="Q"
"RTN","PSACREDO",64,0)
 I PSADJQ S PSAACST=PSADJQ*PSAPRC,PSAAECST=PSAAECST+PSAACST
"RTN","PSACREDO",65,0)
 I '+PSADJQ S PSAACST=$P(PSADATA,"^",3)*PSAPRC,PSAAECST=PSAAECST+PSAACST
"RTN","PSACREDO",66,0)
 I PSAICST'=PSAACST D
"RTN","PSACREDO",67,0)
 .S PSALN=$P(PSADATA,"^")
"RTN","PSACREDO",68,0)
 .S PSADRG=$S(+PSADRG&($P($G(^PSDRUG(PSADRG,0)),"^")'=""):$P(^PSDRUG(PSADRG,0),"^"),'PSADRG:PSADRG,1:"UNKNOWN DRUG")
"RTN","PSACREDO",69,0)
 .I PSAPFLD="P" S PSA(PSAORD,PSAINV,PSALN,PSAPFLD)=PSADRG_"^^"_$J($P(PSADATA,"^",5),$L($P(PSADATA,"^",5)),2)_"^"_$J(PSADJP,$L(PSADJP),2)
"RTN","PSACREDO",70,0)
 .I PSAQFLD="Q" S PSA(PSAORD,PSAINV,PSALN,PSAQFLD)=PSADRG_"^"_$S(PSAREA'="":PSAREA,1:"UNK")_"^"_$P(PSADATA,"^",3)_"^"_PSADJQ
"RTN","PSACREDO",71,0)
 Q
"RTN","PSACREDO",72,0)
 ;
"RTN","PSACREDO",73,0)
GETLINE ;Gets invoice cost from line items
"RTN","PSACREDO",74,0)
 S PSA2=0 F  S PSA2=$O(^PSD(58.811,PSA,1,PSA1,1,PSA2)) Q:'PSA2  D
"RTN","PSACREDO",75,0)
 .Q:'$D(^PSD(58.811,PSA,1,PSA1,1,PSA2,0))
"RTN","PSACREDO",76,0)
 .S PSADATA=^PSD(58.811,PSA,1,PSA1,1,PSA2,0),PSAIECST=PSAIECST+($P(PSADATA,"^",3)*$P(PSADATA,"^",5))
"RTN","PSACREDO",77,0)
 .S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,"B","P",0))
"RTN","PSACREDO",78,0)
 .I +PSADJ S PSAN=$G(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,PSADJ,0)),PSAPRC=$S($P(PSAN,"^",6)'="":$P(PSAN,"^",6),1:+$P(PSAN,"^",2)),PSADJP=PSAPRC
"RTN","PSACREDO",79,0)
 .S:'+PSADJ PSAPRC=$P(PSADATA,"^",5)
"RTN","PSACREDO",80,0)
 .;
"RTN","PSACREDO",81,0)
 .S PSADJQ=0,PSADJ=+$O(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,"B","Q",0))
"RTN","PSACREDO",82,0)
 .S:+PSADJ PSAN=$G(^PSD(58.811,PSA,1,PSA1,1,PSA2,1,PSADJ,0)),PSADJQ=$S($P(PSAN,"^",6)'="":+$P(PSAN,"^",6),1:+$P(PSAN,"^",2))
"RTN","PSACREDO",83,0)
 .S:PSADJQ PSAAECST=PSAAECST+(PSADJQ*PSAPRC)
"RTN","PSACREDO",84,0)
 .S:'+PSADJQ PSAAECST=PSAAECST+($P(PSADATA,"^",3)*PSAPRC)
"RTN","PSACREDO",85,0)
 Q
"RTN","PSACREDO",86,0)
 ;
"RTN","PSACREDO",87,0)
CREDITS ;Adds existing credits to adjusted extended cost.
"RTN","PSACREDO",88,0)
 S PSAC=0 F  S PSAC=$O(^PSD(58.811,PSA,1,PSA1,2,PSAC)) Q:'PSAC  D
"RTN","PSACREDO",89,0)
 .Q:'$D(^PSD(58.811,PSA,1,PSA1,2,PSAC,0))
"RTN","PSACREDO",90,0)
 .S PSACRED=PSACRED+$P(^PSD(58.811,PSA,1,PSA1,2,PSAC,0),"^",3)
"RTN","PSACREDO",91,0)
 I PSAAECST'=PSAIECST D
"RTN","PSACREDO",92,0)
 .S PSADF=PSAIECST-(PSAAECST+PSACRED)
"RTN","PSACREDO",93,0)
 .S PSA(PSAORD,PSAINV)=$J(PSAIECST,$L(PSAIECST),2)_"^"_$J(PSAAECST,$L($P(PSAAECST,".")),2)_"^"_$J(PSACRED,$L(PSACRED),2)_"^"_$J(PSADF,$L(PSADF),2)_"^"_+$P($G(^PSD(58.811,PSA,1,PSA1,0)),"^",2)
"RTN","PSACREDO",94,0)
 Q
"RTN","PSACREDO",95,0)
 ;
"RTN","PSACREDO",96,0)
PRINT ;Displays the invoices with outstanding credits
"RTN","PSACREDO",97,0)
 D:PSARPT="S" HDRSUM D:PSARPT="D" HDRDET
"RTN","PSACREDO",98,0)
 S PSAORD="" F  S PSAORD=$O(PSA(PSAORD)) Q:PSAORD=""!(PSAOUT)  D
"RTN","PSACREDO",99,0)
 .S PSAODF=$P(PSA(PSAORD),"^",2)
"RTN","PSACREDO",100,0)
 .I $Y+4>IOSL D:PSARPT="S" HDRSUM D:PSARPT="D" HDRDET Q:PSAOUT
"RTN","PSACREDO",101,0)
 .W:PSARPT="S" ! W:PSARPT="D" !,PSALSLN W !,"ORDER#: "_PSAORD_" ($"_$P(PSA(PSAORD),"^")_")"
"RTN","PSACREDO",102,0)
 .S PSAINV="" F  S PSAINV=$O(PSA(PSAORD,PSAINV)) Q:PSAINV=""  D
"RTN","PSACREDO",103,0)
 ..S PSAIECST=$P(PSA(PSAORD,PSAINV),"^"),PSAAECST=$P(PSA(PSAORD,PSAINV),"^",2),PSACRED=$P(PSA(PSAORD,PSAINV),"^",3),PSAIDF=$P(PSA(PSAORD,PSAINV),"^",4)
"RTN","PSACREDO",104,0)
 ..S PSAINVDT=$P(PSA(PSAORD,PSAINV),"^",5),PSAINVDT=$E(PSAINVDT,4,5)_"/"_$E(PSAINVDT,6,7)_"/"_$E(PSAINVDT,2,3)
"RTN","PSACREDO",105,0)
 ..S PSAPRT=0,PSALN="" F  S PSALN=$O(PSA(PSAORD,PSAINV,PSALN)) Q:PSALN=""  D
"RTN","PSACREDO",106,0)
 ...S PSAFLD="" F  S PSAFLD=$O(PSA(PSAORD,PSAINV,PSALN,PSAFLD)) Q:PSAFLD=""  D
"RTN","PSACREDO",107,0)
 ....S PSADATA=PSA(PSAORD,PSAINV,PSALN,PSAFLD),PSADRG=$P(PSADATA,"^"),PSAREA=$P(PSADATA,"^",2),PSAIVAL=$P(PSADATA,"^",3),PSAAVAL=$P(PSADATA,"^",4),PSAPRT=PSAPRT+1
"RTN","PSACREDO",108,0)
 ....I PSARPT="D",$Y+5>IOSL D HDRDET Q:PSAOUT
"RTN","PSACREDO",109,0)
 ....I PSARPT="D" D:PSAPRT=1 PRTDLINE D:PSAPRT>1 PRTDLIN1
"RTN","PSACREDO",110,0)
 ..I PSARPT="S",$Y+5>IOSL D HDRSUM Q:PSAOUT
"RTN","PSACREDO",111,0)
 ..D:PSARPT="S" PRTSLINE
"RTN","PSACREDO",112,0)
 .I $Y+4>IOSL D:PSARPT="S" HDRSUM D:PSARPT="D" HDRDET Q:PSAOUT
"RTN","PSACREDO",113,0)
 .I PSAODF'=PSADF W !,"ORDER TOTAL" W:PSARPT="D" ?65 W:PSARPT="S" ?69 W $J(PSAODF,9,2)
"RTN","PSACREDO",114,0)
 I $Y+4>IOSL D:PSARPT="S" HDRSUM D:PSARPT="D" HDRDET Q:PSAOUT
"RTN","PSACREDO",115,0)
 W ! W:PSARPT="S" PSASLN W:PSARPT="D" PSALSLN
"RTN","PSACREDO",116,0)
 W !,"GRAND TOTAL" W:PSARPT="D" ?65 W:PSARPT="S" ?69 W $J(PSAGDF,9,2),!
"RTN","PSACREDO",117,0)
 I $E(IOST,1,2)="C-" D END^PSAPROC
"RTN","PSACREDO",118,0)
 E  W @IOF
"RTN","PSACREDO",119,0)
 Q
"RTN","PSACREDO",120,0)
 ;
"RTN","PSACREDO",121,0)
HDRDET ;Header for detail report
"RTN","PSACREDO",122,0)
 I $E(IOST,1,2)="C-" W:'PSAPG @IOF D:+PSAPG END^PSAPROC Q:PSAOUT
"RTN","PSACREDO",123,0)
 I $E(IOST)'="C",+PSAPG W @IOF
"RTN","PSACREDO",124,0)
 S PSAPG=PSAPG+1
"RTN","PSACREDO",125,0)
 W ! W:$E(IOST)'="C" "RUN DATE: "_PSARPDT
"RTN","PSACREDO",126,0)
 W ?46,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE"
"RTN","PSACREDO",127,0)
 W !?53,"OUTSTANDING CREDITS REPORT",!?124,"PAGE "_PSAPG
"RTN","PSACREDO",128,0)
 W !!?36,"INVOICE",?46,"ADJUSTED",?58,"RECEIVED",?68,"OUTST.",?84,"DRUG &"
"RTN","PSACREDO",129,0)
 W !,"INVOICE#",?28,"DATE",?39,"COST",?50,"COST",?59,"CREDITS",?68,"CREDIT",?77,"LINE#",?84,"ADJUSTMENT REASON",?117,"INVOICE",?129,"ADJ",!
"RTN","PSACREDO",130,0)
 W:PSAPG'=1 PSALSLN
"RTN","PSACREDO",131,0)
 Q
"RTN","PSACREDO",132,0)
 ;
"RTN","PSACREDO",133,0)
PRTDLINE ;Prints a line of data on the detailed report
"RTN","PSACREDO",134,0)
 W !,PSAINV,?26,PSAINVDT,?30,$J(PSAIECST,9,2),?45,$J(PSAAECST,9,2),?57,$J(PSACRED,9,2),?67,$J(PSAIDF,7,2),?74,$J(PSALN,8,0),?84,$E(PSADRG,1,33),?117,$J(PSAIVAL,7),?125,$J(PSAAVAL,7)
"RTN","PSACREDO",135,0)
 W !?84,$S(PSAFLD="P":"ORDER UNIT PRICE CHANGED ",PSAFLD="Q":"QTY: "_PSAREA,1:"")
"RTN","PSACREDO",136,0)
 Q
"RTN","PSACREDO",137,0)
 ;
"RTN","PSACREDO",138,0)
PRTDLIN1 ;Prints a line of data on the detailed report
"RTN","PSACREDO",139,0)
 W !?74,$J(PSALN,8,0),?84,PSADRG,?117,$J(PSAIVAL,7),?125,$J(PSAAVAL,7)
"RTN","PSACREDO",140,0)
 W !?84,$S(PSAFLD="P":"ORDER UNIT PRICE CHANGED ",PSAFLD="Q":"QTY: "_PSAREA,1:"")
"RTN","PSACREDO",141,0)
 Q
"RTN","PSACREDO",142,0)
 ;
"RTN","PSACREDO",143,0)
HDRSUM ;Header for summary report
"RTN","PSACREDO",144,0)
 I $E(IOST,1,2)="C-" W:'PSAPG @IOF D:+PSAPG END^PSAPROC Q:PSAOUT
"RTN","PSACREDO",145,0)
 I $E(IOST)'="C",+PSAPG W @IOF
"RTN","PSACREDO",146,0)
 S PSAPG=PSAPG+1
"RTN","PSACREDO",147,0)
 W !?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE"
"RTN","PSACREDO",148,0)
 W !?27,"OUTSTANDING CREDITS REPORT",!?72,"PAGE "_PSAPG
"RTN","PSACREDO",149,0)
 W ! W:$E(IOST)'="C" "RUN DATE: "_PSARPDT
"RTN","PSACREDO",150,0)
 W !?36,"INVOICE",?46,"ADJUSTED",?58,"RECEIVED",?72,"OUTST."
"RTN","PSACREDO",151,0)
 W !,"INVOICE#",?28,"DATE",?39,"COST",?50,"COST",?59,"CREDITS",?72,"CREDIT",!,PSASLN
"RTN","PSACREDO",152,0)
 Q
"RTN","PSACREDO",153,0)
 ;
"RTN","PSACREDO",154,0)
PRTSLINE ;Prints a line of data on the summary report
"RTN","PSACREDO",155,0)
 W !,PSAINV,?26,PSAINVDT,?30,$J(PSAIECST,9,2),?45,$J(PSAAECST,9,2),?57,$J(PSACRED,9,2),?71,$J(PSAIDF,7,2)
"RTN","PSACREDO",156,0)
 Q
"RTN","PSACREDO",157,0)
 ;
"RTN","PSACREDO",158,0)
RPT ;Extended help for "Print a detailed or summary report"
"RTN","PSACREDO",159,0)
 W !?5,"Select DETAILED to print the order number, invoice number, invoice date,",!?5,"total invoice cost, adjusted cost, received credits, and Derence."
"RTN","PSACREDO",160,0)
 W !!?5,"Select SUMMARY to print all of the data on the detailed report plus the",!?5,"line item data that created the need for a credit. The line item data is"
"RTN","PSACREDO",161,0)
 W !?5,"the line item number, drug name, quantity invoiced, quantity received,",!?5,"reason for credit."
"RTN","PSACREDO",162,0)
 Q
"RTN","PSACREDR")
0^7^B29238766
"RTN","PSACREDR",1,0)
PSACREDR ;BIR/JMB-Credit Resolution ;7/23/97
"RTN","PSACREDR",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSACREDR",3,0)
 ;This routine allows the user to apply credit memos to invoices.
"RTN","PSACREDR",4,0)
 ;
"RTN","PSACREDR",5,0)
 I '$D(^XUSEC("PSA ORDERS",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSACREDR",6,0)
 I '$D(^XUSEC("PSAMGR",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSACREDR",7,0)
 I '$O(^PSD(58.811,"AC",1,0)) W !!,"There are no outstanding credit memos." Q
"RTN","PSACREDR",8,0)
 S PSASLN="",$P(PSASLN,"-",80)=""
"RTN","PSACREDR",9,0)
START W ! S DIC="^PSD(58.811,",DIC(0)="AEQM",DIC("S")="I $D(^PSD(58.811,""AC"",1,+Y))" D ^DIC K DIE G:Y<0 EXIT
"RTN","PSACREDR",10,0)
 G:'$D(^PSD(58.811,+Y,0)) START
"RTN","PSACREDR",11,0)
 S PSAIEN=+Y,(PSAIEN1,PSAOUT)=0
"RTN","PSACREDR",12,0)
 F  S PSAIEN1=$O(^PSD(58.811,"AC",1,PSAIEN,PSAIEN1)) Q:'PSAIEN1  D
"RTN","PSACREDR",13,0)
 .Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0))
"RTN","PSACREDR",14,0)
 .S (PSACRED,PSAAECST,PSAIECST)=0
"RTN","PSACREDR",15,0)
 .S PSAIEN2=0 F  S PSAIEN2=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2)) Q:'PSAIEN2!(PSAOUT)  D LINE Q:PSAOUT
"RTN","PSACREDR",16,0)
 .D CREDITS
"RTN","PSACREDR",17,0)
 D LIST
"RTN","PSACREDR",18,0)
 G:PSAOUT EXIT G START
"RTN","PSACREDR",19,0)
 ;
"RTN","PSACREDR",20,0)
EXIT ;Kills printing variables only
"RTN","PSACREDR",21,0)
 K DA,DIC,DIE,DIR,DIRUT,DR,PSA,PSAAECST,PSACIEN,PSACNT,PSACRED,PSADATA,PSADIF,PSADJ,PSADJD,PSADJDA,PSADJP,PSADJQ,PSADJSUP
"RTN","PSACREDR",22,0)
 K PSAIECST,PSAIEN,PSAIEN1,PSAIEN2,PSAINV,PSALEN,PSAMENU,PSANODE,PSAOUT,PSAPC,PSAPRICE,PSASEL,PSASLN,Y
"RTN","PSACREDR",23,0)
 Q
"RTN","PSACREDR",24,0)
 ;
"RTN","PSACREDR",25,0)
LINE ;Get line item data
"RTN","PSACREDR",26,0)
 Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2,0))
"RTN","PSACREDR",27,0)
 K PSADJQ,PSADJP,PSADJD
"RTN","PSACREDR",28,0)
 S PSADATA=^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2,0),PSADJSUP=0
"RTN","PSACREDR",29,0)
DRUG S PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2,1,"B","D",0))
"RTN","PSACREDR",30,0)
 I +PSADJ D  Q:PSADJSUP
"RTN","PSACREDR",31,0)
 .S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2,1,PSADJ,0))
"RTN","PSACREDR",32,0)
 .S PSADJD=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSACREDR",33,0)
 .Q:+PSADJD&($L(PSADJD)=+$L(PSADJD))
"RTN","PSACREDR",34,0)
 .S PSADJSUP=1
"RTN","PSACREDR",35,0)
 S PSAIECST=PSAIECST+($P(PSADATA,"^",3)*$P(PSADATA,"^",5))
"RTN","PSACREDR",36,0)
PRICE S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2,1,"B","P",0))
"RTN","PSACREDR",37,0)
 I +PSADJ S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2,1,PSADJ,0)),PSAPRICE=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:+$P(PSANODE,"^",2))
"RTN","PSACREDR",38,0)
 I '+PSADJ S PSAPRICE=$P(PSADATA,"^",5)
"RTN","PSACREDR",39,0)
QTY S PSADJQ=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2,1,"B","Q",0))
"RTN","PSACREDR",40,0)
 I +PSADJ S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2,1,PSADJ,0)),PSADJQ=$S($P(PSANODE,"^",6)'="":+$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSACREDR",41,0)
 I +PSADJQ S PSAAECST=PSAAECST+(PSADJQ*PSAPRICE)
"RTN","PSACREDR",42,0)
 I '+PSADJQ S PSAAECST=PSAAECST+($P(PSADATA,"^",3)*PSAPRICE)
"RTN","PSACREDR",43,0)
 Q
"RTN","PSACREDR",44,0)
 ;
"RTN","PSACREDR",45,0)
CREDITS ;Adds existing credits to adjusted extended cost.
"RTN","PSACREDR",46,0)
 S PSACIEN=0 F  S PSACIEN=$O(^PSD(58.811,PSAIEN,1,PSAIEN1,2,PSACIEN)) Q:'PSACIEN  D
"RTN","PSACREDR",47,0)
 .Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,2,PSACIEN,0))
"RTN","PSACREDR",48,0)
 .S PSACRED=PSACRED+$P(^PSD(58.811,PSAIEN,1,PSAIEN1,2,PSACIEN,0),"^",3)
"RTN","PSACREDR",49,0)
 S:PSAAECST'=PSAIECST PSA(PSAIEN1)=PSAIECST_"^"_$J(PSAAECST,$L($P(PSAAECST,".")),2)_"^"_PSACRED
"RTN","PSACREDR",50,0)
 Q
"RTN","PSACREDR",51,0)
 ;
"RTN","PSACREDR",52,0)
LIST ;Displays the invoices with outstanding credits
"RTN","PSACREDR",53,0)
 W @IOF,!,"Order#: "_$P($G(^PSD(58.811,PSAIEN,0)),"^")
"RTN","PSACREDR",54,0)
 W !?28,"Invoice",?42,"Adjusted",?56,"Received",!?4,"Invoice#",?31,"Cost",?46,"Cost",?57,"Credits",?69,"Difference",!,PSASLN
"RTN","PSACREDR",55,0)
 S (PSACNT,PSAIEN1)=0 F  S PSAIEN1=+$O(PSA(PSAIEN1)) Q:'PSAIEN1  D
"RTN","PSACREDR",56,0)
 .S PSAIECST=+$P(PSA(PSAIEN1),"^"),PSAAECST=+$P(PSA(PSAIEN1),"^",2),PSACRED=+$P(PSA(PSAIEN1),"^",3)
"RTN","PSACREDR",57,0)
 .S PSACNT=PSACNT+1,PSAMENU(PSACNT,PSAIEN1)=PSA(PSAIEN1)
"RTN","PSACREDR",58,0)
 .W !,($J(PSACNT,2)),".",?4,$P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,0)),"^"),?26,$J(PSAIECST,9,2),?41,$J(PSAAECST,9,2)
"RTN","PSACREDR",59,0)
 .W ?55,$J(PSACRED,9,2)
"RTN","PSACREDR",60,0)
 .S PSADIF=PSAIECST-(PSAAECST+PSACRED)
"RTN","PSACREDR",61,0)
 .W ?70,$J(PSADIF,9,2)
"RTN","PSACREDR",62,0)
 W ! K DIR S DIR(0)="LO^1:"_PSACNT,DIR("A")="Select invoices",DIR("?")="Select the invoices to which you want to apply credit memos.",DIR("??")="^D CREDHELP^PSACREDR"
"RTN","PSACREDR",63,0)
 D ^DIR K DIR Q:Y=""  I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSACREDR",64,0)
 S PSASEL=Y
"RTN","PSACREDR",65,0)
 ;
"RTN","PSACREDR",66,0)
SELECT ;Selects invoices for credit memos
"RTN","PSACREDR",67,0)
 F PSAPC=1:1 S PSACNT=+$P(PSASEL,",",PSAPC) Q:'PSACNT  D  Q:PSAOUT
"RTN","PSACREDR",68,0)
 .S PSAINV=$O(PSAMENU(PSACNT,0)),PSAIECST=$P(PSAMENU(PSACNT,PSAINV),"^"),PSAAECST=$P(PSAMENU(PSACNT,PSAINV),"^",2),PSACRED=$P(PSAMENU(PSACNT,PSAINV),"^",3)
"RTN","PSACREDR",69,0)
 .W !!,"Invoice: "_$P($G(^PSD(58.811,PSAIEN,1,PSAINV,0)),"^"),!
"RTN","PSACREDR",70,0)
 .S DA(2)=PSAIEN,DA(1)=PSAINV,DA=PSAIEN2
"RTN","PSACREDR",71,0)
 .S:'$D(^PSD(58.811,PSAIEN,1,PSAINV,2,0)) DIC("P")=$P(^DD(58.8112,6,0),"^",2)
"RTN","PSACREDR",72,0)
 .S DIC="^PSD(58.811,"_DA(2)_",1,"_DA(1)_",2,",DIC(0)="AEMQL",DIC("A")="CREDIT MEMO: ",DR=.01,DLAYGO=58.811
"RTN","PSACREDR",73,0)
 .F  L +^PSD(58.811,PSAIEN,1,PSAINV,2,0):0 I  Q
"RTN","PSACREDR",74,0)
 .D ^DIC K DLAYGO I Y<0 S PSAOUT=1 K DIC Q
"RTN","PSACREDR",75,0)
 .S DIE=DIC,DR="1;2;3",(PSADJDA,DA)=+Y D ^DIE K DA,DIE,DIC L -^PSD(58.811,PSAIEN,1,PSAINV,2,0)
"RTN","PSACREDR",76,0)
 .S PSACRED=PSACRED+$P($G(^PSD(58.811,PSAIEN,1,PSAINV,2,PSADJDA,0)),"^",3)
"RTN","PSACREDR",77,0)
 .I PSAIECST=$J((PSAAECST+PSACRED),2) S DA(1)=PSAIEN,DA=PSAINV,DIE="^PSD(58.811,"_DA(1)_",1,",DR="10////0" D ^DIE K DIE
"RTN","PSACREDR",78,0)
 .W !!,"Invoice: "_$P($G(^PSD(58.811,PSAIEN,1,PSAINV,0)),"^") S PSALEN=$L($P($G(^PSD(58.811,PSAIEN,1,PSAINV,0)),"^"))+11
"RTN","PSACREDR",79,0)
 .W ?PSALEN,"Total Invoiced Cost: "_$J(PSAIECST,9,2),!?PSALEN,"Total Adjusted Cost: "_$J(PSAAECST,9,2)
"RTN","PSACREDR",80,0)
 .W !?PSALEN,"Total Credits      : "_$J(PSACRED,9,2)
"RTN","PSACREDR",81,0)
 .W !?PSALEN,"Difference         : "_$J((PSAIECST-(PSAAECST+PSACRED)),9,2),!
"RTN","PSACREDR",82,0)
 Q
"RTN","PSACREDR",83,0)
 ;
"RTN","PSACREDR",84,0)
CREDHELP ;Extended help to 'Select invoices'
"RTN","PSACREDR",85,0)
 W !?5,"Enter the numbers to the left of the invoices for which you want to",!?5,"enter credit memos. To select more than one invoice number, enter"
"RTN","PSACREDR",86,0)
 W !?5,"the numbers to the left of the invoices separated by a comma or a dash.",!!?5,"For example: Enter 1,2,3,5 or 1-3,5"
"RTN","PSACREDR",87,0)
 Q
"RTN","PSADA")
0^8^B17894012
"RTN","PSADA",1,0)
PSADA ;BIR/LTL-Pharmacy Location Lookup Utility ;7/23/97
"RTN","PSADA",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSADA",3,0)
 ;This routine is called by many routines. It is used to allow the user
"RTN","PSADA",4,0)
 ;to select a pharmacy location.
"RTN","PSADA",5,0)
 ;
"RTN","PSADA",6,0)
START D DT^DICRW N D,DIC,DIR,DIRUT,DTOUT,DUOUT,PSA,PSAB,PSAC,PSADRUG,PSAII,PSAIT,PSAIPS,PSAINV,PSAISIT,PSAOC,PSAOSIT,PSASTO,PSAITY,PSAOP,PSAO,PSAI,PSAOU,X,Y
"RTN","PSADA",7,0)
 S PSALOC(1)=$O(^PSD(58.8,"ADISP","P",0))
"RTN","PSADA",8,0)
 I 'PSALOC(1) W !,"No Drug Accountability location has been created yet.",! G QUIT
"RTN","PSADA",9,0)
 ;only one
"RTN","PSADA",10,0)
 I '$O(^PSD(58.8,"ADISP","P",+PSALOC(1))) S PSALOC=PSALOC(1),PSALOC(1)=0
"RTN","PSADA",11,0)
 I $G(PSALOC) S PSALOCN=$P($G(^PSD(58.8,+PSALOC,0)),U),PSAISIT=$P($G(^(0)),U,3),PSAOSIT=$P($G(^(0)),U,10) G QUIT
"RTN","PSADA",12,0)
 ;pick type
"RTN","PSADA",13,0)
PIC S DIR(0)="S^1:INPATIENT;2:OUTPATIENT;3:COMBINED (IP/OP)",DIR("A")="Select Pharmacy type",PSALOC(1)=0 D ^DIR K DIR S:'Y PSAOUT=1,PSALOC=0 G:'Y QUIT
"RTN","PSADA",14,0)
 S PSAITY=+Y,PSALOCN=Y(0)
"RTN","PSADA",15,0)
SKIP I PSAITY'=2  D
"RTN","PSADA",16,0)
 .;check for more than one IP site
"RTN","PSADA",17,0)
 .S (PSA(1),PSA(2))=0 F  S PSA(1)=$O(^PS(59.4,PSA(1))) Q:'PSA(1)  S:$P($G(^(PSA(1),0)),U,26)=1 PSA(2)=PSA(2)+1,PSAB=PSA(1)
"RTN","PSADA",18,0)
 .I PSA(2)<1 W !!,"An Inpatient Site has not been identified for AR/WS.",!,"AR/WS dispensing data may not be gathered.",! S:PSAITY=3 PSAO=1 Q
"RTN","PSADA",19,0)
 .S:PSA(2)=1 PSAISIT=PSAB
"RTN","PSADA",20,0)
 .D:PSA(2)>1  I Y<1 S PSAOU=1 K PSALOC Q
"RTN","PSADA",21,0)
 ..W !!,"Because there is more than one Inpatient Site at this facility, I need you to"
"RTN","PSADA",22,0)
 ..S DIC="^PS(59.4,",DIC(0)="AEMQZ",DIC("A")="select an AR/WS Inpatient Site Name: ",DIC("S")="I $P($G(^(0)),U,26)=1" D ^DIC K DIC S:$D(DUOUT)!($D(DTOUT)) PSAOU=1 S:PSAITY=3&(Y<1) PSAO=1 Q:Y<1  S PSAISIT=+Y
"RTN","PSADA",23,0)
 .S PSALOC=$O(^PSD(58.8,"ASITE",PSAISIT,"P",""))
"RTN","PSADA",24,0)
 .I 'PSALOC S:PSAITY=3 PSAO=1 Q
"RTN","PSADA",25,0)
 .I PSALOC S PSALOCN=$P($G(^PSD(58.8,+PSALOC,0)),U) D:$O(^PSD(58.8,+PSALOC,3,0))
"RTN","PSADA",26,0)
 ..W !!,"Checking wards for accurate collection of UD/IV dispensing.",!
"RTN","PSADA",27,0)
 ..N PSAWARD S PSAWARD=0 F  S PSAWARD=$O(^DIC(42,PSAWARD)) Q:'PSAWARD  W "*" D:'$O(^PSD(58.8,"AB",+PSAWARD,0))&('$D(^DIC(42,+PSAWARD,"I")))
"RTN","PSADA",28,0)
 ...W !!,$P($G(^DIC(42,+PSAWARD,0)),U)," is an active ward and NOT linked to any location."
"RTN","PSADA",29,0)
 S:PSAITY>1 PSAO=1 G @$S($D(PSAOU):"QUIT",$D(PSAO):"OP",1:"QUIT")
"RTN","PSADA",30,0)
OP S Y=1,PSA=$O(^PS(59,0)) D:$O(^PS(59,PSA))  G:Y<0 QUIT
"RTN","PSADA",31,0)
 .;more than one OP site
"RTN","PSADA",32,0)
 .W !!,"Because there is more than one Outpatient Site at this facility, I need you to "
"RTN","PSADA",33,0)
 .S DIC="^PS(59,",DIC(0)="AEMQ",DIC("A")="select an Outpatient Site: " D ^DIC K DIC S PSAOSIT=+Y
"RTN","PSADA",34,0)
 S:'$D(PSAOSIT) PSAOSIT=PSA
"RTN","PSADA",35,0)
 S PSALOC=$O(^PSD(58.8,"AOP",+PSAOSIT,"")),PSALOCN=$P($G(^PSD(58.8,+PSALOC,0)),U)
"RTN","PSADA",36,0)
 I $G(PSAOSIT),'$G(PSALOC) W !!,"No Drug Accountability location has been created for ",$P($G(^PS(59,+PSAOSIT,0)),U),".",!
"RTN","PSADA",37,0)
QUIT I '$G(PSALOC) W !,"No site was selected.",! Q
"RTN","PSADA",38,0)
 I $G(PSALOC) S PSACNT=0 W !!,PSALOCN," for " D
"RTN","PSADA",39,0)
 .I $P($G(^PS(59.4,+$G(PSAISIT),0)),U)'="" W $P(^(0),U)_" (IP) " S PSACNT=PSACNT+1
"RTN","PSADA",40,0)
 .I $P($G(^PS(59,+$G(PSAOSIT),0)),U)'="" W $P(^(0),U)_" (OP)" S PSACNT=PSACNT+1
"RTN","PSADA",41,0)
 .I 'PSACNT W "...I'm not sure"
"RTN","PSADA",42,0)
 I $G(PSALOC(1)) S DIR(0)="Y",DIR("A")="OK",DIR("B")="Yes",DIR("?")="Answering no will allow you to change Location." D ^DIR K DIR K:Y=0 PSAOSIT,PSAISIT,PSALOC G:Y=0 PIC K:$D(DIRUT) PSALOC
"RTN","PSADA",43,0)
 Q
"RTN","PSADA",44,0)
COP I '$O(^PSD(58.8,"AOP",0)) W !,"No outpatient sites have been set up.",! Q
"RTN","PSADA",45,0)
 S PSALOC=$O(^PSD(58.8,"AOP",0)),PSALOCN=$P($G(^PSD(58.8,+PSALOC,0)),U)
"RTN","PSADA",46,0)
 Q:'$O(^PSD(58.8,"AOP",+PSALOC))
"RTN","PSADA",47,0)
 W !!,"Because there is more than one Outpatient Site at this facility, I need you to "
"RTN","PSADA",48,0)
 S DIC="^PSD(58.8,",DIC(0)="AEMQ",DIC("A")="select an Outpatient Site: ",D="AOP" D MIX^DIC1 S PSALOC=+Y,PSALOCN=$P($G(^PSD(58.8,+Y,0)),U)
"RTN","PSADA",49,0)
 Q
"RTN","PSADAI")
0^9^B16881459
"RTN","PSADAI",1,0)
PSADAI ;BIR/LTL,JMB-Drug Balances by Location ;7/23/97
"RTN","PSADAI",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSADAI",3,0)
 ;
"RTN","PSADAI",4,0)
LOC S (PSACNT,PSAOUT)=0 D ^PSAUTL3 G:PSAOUT EXIT1
"RTN","PSADAI",5,0)
 S PSACNT=0,PSACHK=$O(PSALOC(""))
"RTN","PSADAI",6,0)
 I PSACHK="",'PSALOC W !,"There are no active pharmacy locations." G EXIT1
"RTN","PSADAI",7,0)
 I PSACHK'="",$G(PSASEL)="",PSALOC W !!,PSALOCN
"RTN","PSADAI",8,0)
 ;
"RTN","PSADAI",9,0)
DEVICE W ! K IO("Q") S %ZIS="0Q" D ^%ZIS I POP S DTOUT=1,Y=-1 W !,"No Device was selected or output printed." G EXIT1
"RTN","PSADAI",10,0)
 I $D(IO("Q")) S ZTRTN="START^PSADAI",ZTDESC="Drug Accountability - Drug Location Report",ZTSAVE("PSALOC(")="" D ^%ZTLOAD,HOME^%ZIS S Y=1 G EXIT1
"RTN","PSADAI",11,0)
START S PSAOUT=0,PSALOCN="",$P(PSASLN,"-",80)=""
"RTN","PSADAI",12,0)
 S PSARPDT=$E($$HTFM^XLFDT($H),1,12),PSADT=$P(PSARPDT,".")
"RTN","PSADAI",13,0)
 S PSARPDT=$E(PSADT,4,5)_"/"_$E(PSADT,6,7)_"/"_$E(PSADT,2,3)_"@"_$P(PSARPDT,".",2)
"RTN","PSADAI",14,0)
 F  S PSALOCN=$O(PSALOC(PSALOCN)) Q:PSALOCN=""  D  Q:PSAOUT
"RTN","PSADAI",15,0)
 .S PSAIEN=0 F  S PSAIEN=+$O(PSALOC(PSALOCN,PSAIEN)) Q:'PSAIEN  D  Q:PSAOUT
"RTN","PSADAI",16,0)
 ..S PSAISIT=+$P(PSALOC(PSALOCN,PSAIEN),"^"),PSAOSIT=+$P(PSALOC(PSALOCN,PSAIEN),"^",2)
"RTN","PSADAI",17,0)
 ..S PSAISITN=$S($P($G(^PS(59.4,PSAISIT,0)),"^")'="":$P($G(^PS(59.4,PSAISIT,0)),"^"),1:"UNKNOWN")
"RTN","PSADAI",18,0)
 ..S PSAOSITN=$S($P($G(^PS(59,PSAOSIT,0)),"^")'="":$P($G(^PS(59,PSAOSIT,0)),"^"),1:"UNKNOWN")
"RTN","PSADAI",19,0)
 ..S PSASITES=$S(PSAISIT&(PSAOSIT):PSAISITN_" (IP)  "_PSAOSITN_" (OP)",PSAISIT:PSAISITN_" (IP)",1:PSAOSITN_" (OP)")
"RTN","PSADAI",20,0)
 ..D COMPILE D:'PSAOUT DONE
"RTN","PSADAI",21,0)
EXIT D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q") W:$E(IOST,1,2)="C-" @IOF
"RTN","PSADAI",22,0)
EXIT1 K ^TMP($J,"PSADRG"),%ZIS,DIR,DIRUT,DTOUT
"RTN","PSADAI",23,0)
 K PSACHK,PSACNT,PSADRG,PSADT,PSAIEN,PSAINV,PSAISIT,PSAISITN,PSALEN,PSALINK,PSALNK,PSALOC,PSALOCA,PSALOCN,PSAOSIT,PSAOSITN
"RTN","PSADAI",24,0)
 K PSAOUT,PSAPG,PSARPDT,PSAS,PSASEL,PSASITES,PSASLN,PSASS,PSATMP,X,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK
"RTN","PSADAI",25,0)
 Q
"RTN","PSADAI",26,0)
COMPILE ;Creates ^TMP(Drug Name)= current balance ^ dispense unit ^ total inventory (current balance in 50)
"RTN","PSADAI",27,0)
 K ^TMP($J,"PSADRG")
"RTN","PSADAI",28,0)
 S PSADRG=0 F  S PSADRG=+$O(^PSD(58.8,PSAIEN,1,PSADRG)) Q:'PSADRG  D
"RTN","PSADAI",29,0)
 .Q:'$D(^PSDRUG(PSADRG,0))
"RTN","PSADAI",30,0)
 .S ^TMP($J,"PSADRG",$P(^PSDRUG(PSADRG,0),"^"))=$P($G(^PSD(58.8,PSAIEN,1,PSADRG,0)),"^",4)_"^"_$P($G(^PSDRUG(PSADRG,660)),"^",8)_"^"_$P($G(^PSDRUG(PSADRG,660.1)),"^")
"RTN","PSADAI",31,0)
PRINT ;Prints body of report
"RTN","PSADAI",32,0)
 ;Finds longest length of inventory link(s).
"RTN","PSADAI",33,0)
 S (PSALNK,PSALEN)=0 F  S PSALNK=+$O(^PSD(58.8,PSAIEN,4,PSALNK)) Q:'PSALNK  D
"RTN","PSADAI",34,0)
 .S PSALINK(+$P($G(^PSD(58.8,PSAIEN,4,PSALNK,0)),"^"))=""
"RTN","PSADAI",35,0)
 .S PSAINV="INVENTORY LINK: "_$S($P($G(^PRCP(445,PSALNK,0)),"^")'="":$P($G(^PRCP(445,PSALNK,0)),"^"),1:"NONE")
"RTN","PSADAI",36,0)
 .S:PSALEN<$L(PSAINV) PSALEN=$L(PSAINV)
"RTN","PSADAI",37,0)
 S PSAPG=0,PSADRG="" D HDR
"RTN","PSADAI",38,0)
 ;If no data in ^TMP, prints message & exit routine.
"RTN","PSADAI",39,0)
 S PSATMP=$O(^TMP($J,"PSADRG","")) I PSATMP="" W !!,"<< NO DRUGS WERE FOUND. >>",! G DONE
"RTN","PSADAI",40,0)
 ;If data is found, prints drug name, current balance, & dispense unit
"RTN","PSADAI",41,0)
 F  S PSADRG=$O(^TMP($J,"PSADRG",PSADRG)) Q:PSADRG=""  D  I PSAOUT W:$E(IOST,1,2)="C-" @IOF Q
"RTN","PSADAI",42,0)
 .D:$Y+4>IOSL HDR Q:PSAOUT
"RTN","PSADAI",43,0)
 .W !,PSADRG
"RTN","PSADAI",44,0)
 .S PSALEN=$L($P($P(^TMP($J,"PSADRG",PSADRG),"^"),".",2))
"RTN","PSADAI",45,0)
 .W ?(44+PSALEN),$J($FN($P(^TMP($J,"PSADRG",PSADRG),"^"),",",PSALEN),(10+PSALEN))
"RTN","PSADAI",46,0)
 .W:$P(^TMP($J,"PSADRG",PSADRG),"^",2)'="" ?61,$P(^TMP($J,"PSADRG",PSADRG),"^",2)
"RTN","PSADAI",47,0)
 .W ?69,$J($FN($P(^TMP($J,"PSADRG",PSADRG),"^",3),",",0),9)
"RTN","PSADAI",48,0)
 Q
"RTN","PSADAI",49,0)
DONE ;Holds screen or ejects paper if sent to printer
"RTN","PSADAI",50,0)
 I $E(IOST,1,2)="C-" D
"RTN","PSADAI",51,0)
 .S PSAS=22-$Y F PSASS=1:1:PSAS W !
"RTN","PSADAI",52,0)
 .S DIR(0)="EA",DIR("A")="End of display! Enter RETURN to continue or '^' to exit:" D ^DIR K DIR S:'Y PSAOUT=1
"RTN","PSADAI",53,0)
 W:$E(IOST)'="C" @IOF
"RTN","PSADAI",54,0)
 Q
"RTN","PSADAI",55,0)
HDR ;Print header
"RTN","PSADAI",56,0)
 S PSAPG=PSAPG+1
"RTN","PSADAI",57,0)
 I PSAPG=1,$E(IOST,1,2)="C-" W @IOF
"RTN","PSADAI",58,0)
 I PSAPG>1,$E(IOST)'="C" W @IOF
"RTN","PSADAI",59,0)
 I $E(IOST,1,2)="C-",PSAPG>1 D  Q:PSAOUT
"RTN","PSADAI",60,0)
 .S PSAS=22-$Y F PSASS=1:1:PSAS W !
"RTN","PSADAI",61,0)
 .S DIR(0)="E" D ^DIR K DIR W:'$G(DIRUT) @IOF S:'Y PSAOUT=1
"RTN","PSADAI",62,0)
 W:$E(IOST)'="C" !!,PSARPDT W:$E(IOST,1,2)="C-" !
"RTN","PSADAI",63,0)
 W ?21,"D R U G   A C C O U N T A B I L I T Y",?71,"Page ",$J(PSAPG,2)
"RTN","PSADAI",64,0)
 W !?24,"DRUG BALANCES BY LOCATION REPORT"
"RTN","PSADAI",65,0)
 W !?((80-$L(PSALOCN))/2),PSALOCN
"RTN","PSADAI",66,0)
 S PSALNK=0 F  S PSALNK=$O(PSALINK(PSALNK)) Q:'PSALNK  D
"RTN","PSADAI",67,0)
 .S PSAINV="INVENTORY LINK: "_$S($P($G(^PRCP(445,PSALNK,0)),"^")'="":$P($G(^PRCP(445,PSALNK,0)),"^"),1:"NONE")
"RTN","PSADAI",68,0)
 .W !?((80-$L(PSAINV))/2),PSAINV
"RTN","PSADAI",69,0)
 W !!?47,"CURRENT",?58,"DISPENSE",?72,"TOTAL"
"RTN","PSADAI",70,0)
 W !,"DRUG NAME",?47,"BALANCE",?60,"UNIT",?70,"INVENTORY",!,PSASLN
"RTN","PSADAI",71,0)
 Q
"RTN","PSADJ")
0^10^B43436108
"RTN","PSADJ",1,0)
PSADJ ;BIR/LTL,JMB-Balance Adjustments ;8/21/97
"RTN","PSADJ",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSADJ",3,0)
 ;This routine allows the user to review the drug history then enter
"RTN","PSADJ",4,0)
 ;adjustments.
"RTN","PSADJ",5,0)
 ;
"RTN","PSADJ",6,0)
 S DIR(0)="Y",DIR("A")="Review drug adjustment history",DIR("B")="No",DIR("?",1)="Enter yes to display all adjustments within a selected date range.",DIR("?")="Enter no to enter the adjustment."
"RTN","PSADJ",7,0)
 S DIR("??")="^D ADJ^PSADJ" D ^DIR K DIR G:$D(DIRUT) EXIT D:Y=1 ^PSADJR G:$G(DTOUT)!($G(DUOUT)) EXIT
"RTN","PSADJ",8,0)
 D SIG^XUSESIG G:X1="" EXIT
"RTN","PSADJ",9,0)
LOC ;Gets locations to have adjustments
"RTN","PSADJ",10,0)
 S (PSACNT,PSAOUT)=0 D ^PSAUTL3 G:PSAOUT EXIT
"RTN","PSADJ",11,0)
 S PSACNT=0,PSACHK=$O(PSALOC(""))
"RTN","PSADJ",12,0)
 I PSACHK="",'PSALOC W !,"There are no active pharmacy locations." G EXIT
"RTN","PSADJ",13,0)
 S PSALOCN="" F  S PSALOCN=$O(PSALOC(PSALOCN)) Q:PSALOCN=""  S PSALOC=0 F  S PSALOC=+$O(PSALOC(PSALOCN,PSALOC)) Q:'PSALOC  D  Q:PSAOUT
"RTN","PSADJ",14,0)
 .D SITES^PSAUTL1,DRUG
"RTN","PSADJ",15,0)
 .I PSAOUT S PSAX=$O(PSALOC(PSALOCN)) I PSAX'="" S PSAOUT=0
"RTN","PSADJ",16,0)
 .K PSAX
"RTN","PSADJ",17,0)
 ;
"RTN","PSADJ",18,0)
EXIT ;Kills all variables
"RTN","PSADJ",19,0)
 K %,%DT,%ZIS,D0,D1,DA,DD,DIC,DIE,DINUM,DIR,DIRUT,DO,DR,DTOUT,DUOUT,PSA,PSACHK,PSACNT,PSACOMB,PSADJDT,PSADRUG,PSADRUGN,PSADT,PSAIEN,PSAISIT,PSAISITN
"RTN","PSADJ",20,0)
 K PSALOC,PSALOCA,PSALOCN,PSAOUT,PSAQ,PSAR,PSAREC,PSASEL,PSAT,X,X1,X2,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSADJ",21,0)
 Q
"RTN","PSADJ",22,0)
 ;
"RTN","PSADJ",23,0)
DRUG ;Selects location's drug and processes adjustment
"RTN","PSADJ",24,0)
 F  S DIC="^PSD(58.8,PSALOC,1,",DIC(0)="AEMQZ",DIC("A")="Select drug to adjust: " D  Q:PSAOUT
"RTN","PSADJ",25,0)
 .S DIC("S")="I $S($P($G(^(0)),""^"",14):$P($G(^(0)),""^"",14)>DT,1:1)",DA(1)=PSALOC
"RTN","PSADJ",26,0)
 .W !!,PSALOCN D ^DIC K DIC I (Y<0&(X="")!(X="^"))!($G(DTOUT))!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSADJ",27,0)
 .Q:Y<0&(X'="")
"RTN","PSADJ",28,0)
 .S PSADRUG=+Y,PSADRUGN=$P($G(^PSDRUG(PSADRUG,0)),"^")
"RTN","PSADJ",29,0)
 .S PSAQ=$P($G(^PSD(58.8,PSALOC,1,PSADRUG,0)),"^",4)
"RTN","PSADJ",30,0)
 .W !!,"Current Balance: ",+PSAQ,!
"RTN","PSADJ",31,0)
 .S DIR(0)="NO^-999999:999999:2" S DIR("A")="Adjustment quantity"
"RTN","PSADJ",32,0)
 .S DIR("?",1)="Enter the amount of the adjustment. If it is a negative",DIR("?")="number, enter a minus sign '-' before the number.",DIR("??")="^D QTY^PSADJ"
"RTN","PSADJ",33,0)
 .D ^DIR K DIR Q:Y=0!(Y="")!($G(DUOUT))  I $G(DTOUT) S PSAOUT=1 Q
"RTN","PSADJ",34,0)
 .S PSAREC=Y
"RTN","PSADJ",35,0)
 .S DIR(0)="F^1:45",DIR("A")="Adjustment reason",DIR("?")="Enter the reason why the adjustment was made",DIR("??")="^D REASON^PSADJ" D ^DIR K DIR
"RTN","PSADJ",36,0)
 .Q:$G(DUOUT)!(Y=" ")  I $G(DTOUT) S PSAOUT=1 Q
"RTN","PSADJ",37,0)
 .S PSAR=Y,Y=DT D DD^%DT S PSADJDT=Y
"RTN","PSADJ",38,0)
 .S DIR(0)="D^:"_DT_":EX",DIR("A")="Adjustment date",DIR("B")=PSADJDT,DIR("?")="Enter the date that the adjustment applies",DIR("??")="^D ADJDATE^PSADJ"
"RTN","PSADJ",39,0)
 .D ^DIR K DIR Q:$G(DUOUT)  I $G(DTOUT) S PSAOUT=1 Q
"RTN","PSADJ",40,0)
 .S PSADJDT=Y
"RTN","PSADJ",41,0)
POST .;Post adjustment if yes.
"RTN","PSADJ",42,0)
 .S DIR(0)="Y",DIR("A")="OK to post",DIR("B")="Yes",DIR("?",1)="Enter yes to add or subtract the adjustment quantity from the current",DIR("?")="balance and record this transaction. Enter no to cancel this transaction."
"RTN","PSADJ",43,0)
 .S DIR("??")="^D OK^PSADJ" D ^DIR K DIR
"RTN","PSADJ",44,0)
 .I 'Y!($G(DIRUT)) S:$G(DTOUT) PSAOUT=1 W ! Q
"RTN","PSADJ",45,0)
 .D:Y=1  K PSADRUG Q
"RTN","PSADJ",46,0)
 ..W !,"There were ",$S($P($G(^PSD(58.8,PSALOC,1,PSADRUG,0)),"^",4):$P($G(^(0)),"^",4),1:0)," on hand.  There are now ",$P($G(^(0)),"^",4)+$G(PSAREC)," on hand."
"RTN","PSADJ",47,0)
 ..W !,"Updating files. Please wait."
"RTN","PSADJ",48,0)
 ..F  L +^PSD(58.8,PSALOC,1,PSADRUG,0):0 I  Q
"RTN","PSADJ",49,0)
 ..D NOW^%DTC S PSADT=+$E(%,1,12)
"RTN","PSADJ",50,0)
 ..S PSAQ=$S($P($G(^PSD(58.8,PSALOC,1,PSADRUG,0)),"^",4):$P($G(^(0)),"^",4),1:0)
"RTN","PSADJ",51,0)
 ..S $P(^PSD(58.8,PSALOC,1,PSADRUG,0),"^",4)=PSAREC+PSAQ
"RTN","PSADJ",52,0)
 ..L -^PSD(58.8,PSALOC,1,PSADRUG,0) W "."
"RTN","PSADJ",53,0)
MON ..S:'$D(^PSD(58.8,PSALOC,1,PSADRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSADJ",54,0)
 ..I '$D(^PSD(58.8,PSALOC,1,PSADRUG,5,$E(PSADJDT,1,5)*100,0)) D
"RTN","PSADJ",55,0)
 ...K DD,DO S DIC="^PSD(58.8,"_PSALOC_",1,"_PSADRUG_",5,",DIC(0)="L",DIC("DR")="1////^S X=PSAQ",(X,DINUM)=$E(PSADJDT,1,5)*100
"RTN","PSADJ",56,0)
 ...S DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DLAYGO,DD,DO
"RTN","PSADJ",57,0)
 ...S X="T-1M" D ^%DT S DIC="^PSD(58.8,"_PSALOC_",1,"_PSADRUG_",5,",DIC(0)="L",(X,DINUM)=$E(Y,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DLAYGO S DA=+Y
"RTN","PSADJ",58,0)
 ...S DIE="^PSD(58.8,"_PSALOC_",1,"_PSADRUG_",5,",DA(2)=PSALOC,DA(1)=PSADRUG,DR="3////^S X=PSAQ" D ^DIE K DIE
"RTN","PSADJ",59,0)
 ..S DIE="^PSD(58.8,"_PSALOC_",1,"_PSADRUG_",5,",DA(2)=PSALOC,DA(1)=PSADRUG,DA=$E(PSADJDT,1,5)*100
"RTN","PSADJ",60,0)
 ..S DR="7////^S X="_($P($G(^PSD(58.8,PSALOC,1,PSADRUG,5,DA,0)),"^",5)+PSAREC)_";3////^S X="_($P($G(^(0)),"^",4)+PSAREC)
"RTN","PSADJ",61,0)
 ..D ^DIE W "."
"RTN","PSADJ",62,0)
TR ..F  L +^PSD(58.81,0):0 I  Q
"RTN","PSADJ",63,0)
FIND ..S PSAT=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSAT,0)) S $P(^(0),"^",3)=$P(^(0),"^",3)+1 G FIND
"RTN","PSADJ",64,0)
 ..L -^PSD(58.81,0) K DD,DIC,DO W "."
"RTN","PSADJ",65,0)
 ..S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,X=PSAT D ^DIC K DIC,DLAYGO W "."
"RTN","PSADJ",66,0)
 ..S DR="1////9;2////^S X=PSALOC;3////^S X="_$S(PSADJDT=$E(PSADT,1,7):PSADT,1:PSADJDT)_";4////^S X=PSADRUG;5////^S X=PSAREC;6////^S X=DUZ;9////^S X=PSAQ;15////^S X=PSAR"_$S(PSADJDT'=$E(PSADT,1,7):";22////^S X="_PSADT,1:"")
"RTN","PSADJ",67,0)
 ..S DIE="^PSD(58.81,",DA=PSAT D ^DIE K DIE,DD,DO W "."
"RTN","PSADJ",68,0)
 ..S:'$D(^PSD(58.8,PSALOC,1,PSADRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSADJ",69,0)
 ..S DIC="^PSD(58.8,PSALOC,1,PSADRUG,4,",DIC(0)="L",(X,DINUM)=PSAT
"RTN","PSADJ",70,0)
 ..S DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DLAYGO,DA,PSADRUG W ".",!
"RTN","PSADJ",71,0)
 Q
"RTN","PSADJ",72,0)
 ;
"RTN","PSADJ",73,0)
ADJ ;Extended help for "Review drug adjustment history" at PSADJ+2
"RTN","PSADJ",74,0)
 W !,"Enter yes to print all adjustments for this drug on the screen",!,"or printer. You can enter an adjustment after the report prints."
"RTN","PSADJ",75,0)
 W !!,"Enter no to bypass the report and make an adjustment."
"RTN","PSADJ",76,0)
 Q
"RTN","PSADJ",77,0)
ADJDATE ;Extended help for "Adjustment date"
"RTN","PSADJ",78,0)
 W !,"If the adjustment pertains today, press the Return key.",!!,"If the adjustment is for a previous date, enter that date."
"RTN","PSADJ",79,0)
 W !,"Today's date will be recorded as the date the adjustment was made."
"RTN","PSADJ",80,0)
 Q
"RTN","PSADJ",81,0)
OK    ;Extended help for "OK to post?"
"RTN","PSADJ",82,0)
 W !,"Enter yes to record this adjustment. The adjustment quantity will be subtracted",!,"from or added to the drug's current balance. The transaction will be recorded"
"RTN","PSADJ",83,0)
 W !,"in the activity log and the monthly balance will be adjusted.",!!,"Enter no to abort the adjustment process and return to the menu."
"RTN","PSADJ",84,0)
 Q
"RTN","PSADJ",85,0)
QTY ;Extended help for "Adjustment quantity"
"RTN","PSADJ",86,0)
 W !,"Enter the quantity to be added or subtracted from the current balance.",!,"If the quantity should be subtracted from the balance, enter a minus"
"RTN","PSADJ",87,0)
 W !,"sign '-' before the quantity.",!!,"For example: -10 or -150 will be subtracted from the balance.",!?14,"10 or 150 will be added to the balance."
"RTN","PSADJ",88,0)
 Q
"RTN","PSADJ",89,0)
REASON ;Extended help for "Adjustment reason"
"RTN","PSADJ",90,0)
 W !,"Enter the reason you are changing the current balance."
"RTN","PSADJ",91,0)
 Q
"RTN","PSADJI")
0^11^B10851547
"RTN","PSADJI",1,0)
PSADJI ;BIR/LTL-Balance Initialization ;7/23/97
"RTN","PSADJI",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSADJI",3,0)
 ;This routine allows the user to enter a beginning balance on hand for
"RTN","PSADJI",4,0)
 ;a drug in a pharmacy location.
"RTN","PSADJI",5,0)
 ;
"RTN","PSADJI",6,0)
 D ^PSADA G:'$G(PSALOC) QUIT
"RTN","PSADJI",7,0)
 N D1,D2,DIC,DIE,DINUM,D0,D1,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,PSAC,PSADT,DA,PSADRUG,PSADRUGN,PSAS,PSAQ,PSAR,PSAREC,PSAOUT,PSAT,X,Y
"RTN","PSADJI",8,0)
CHKD I '$O(^PSD(58.8,PSALOC,1,0)) W !!,"There are no drugs in ",$G(PSALOCN) G QUIT
"RTN","PSADJI",9,0)
 W !!,"Give me a second to alphabetize.",!
"RTN","PSADJI",10,0)
 S PSADRUG=0,PSADRUGN=""
"RTN","PSADJI",11,0)
 F  S PSADRUG=$O(^PSD(58.8,+PSALOC,1,PSADRUG)) Q:'PSADRUG!($P($G(^PSDRUG(+PSADRUG,0)),U)']"")  D
"RTN","PSADJI",12,0)
 .S ^TMP("PSAB",$J,$P($G(^PSDRUG(+PSADRUG,0)),U),PSADRUG)="" K Y
"RTN","PSADJI",13,0)
 W @IOF
"RTN","PSADJI",14,0)
 F PSAC=1:1 S PSADRUGN=$O(^TMP("PSAB",$J,PSADRUGN)) Q:PSADRUGN']""  S PSADRUG=$O(^TMP("PSAB",$J,PSADRUGN,0)) D  G:$D(Y) QUIT
"RTN","PSADJI",15,0)
 .I $P($G(^PSD(58.8,+PSALOC,1,PSADRUG,0)),U,4)]"" D:$Y+9>IOSL  Q:$D(DUOUT)!($D(DTOUT))  W !!,PSADRUGN," may have to be adjusted.",!!,"There's already ",$P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,0)),U,4)," on hand." Q
"RTN","PSADJI",16,0)
 ..S DIR(0)="E" D ^DIR K DIR K:Y Y W @IOF
"RTN","PSADJI",17,0)
 .W !!,PSADRUGN,!!,"Dispensing Unit: "
"RTN","PSADJI",18,0)
 .W $P($G(^PSDRUG(+PSADRUG,660)),U,8),!
"RTN","PSADJI",19,0)
 .F  L +^PSD(58.8,+PSALOC,1,+PSADRUG,0):0 I  Q
"RTN","PSADJI",20,0)
 .S DIR(0)="N^0:999999:2",DIR("A")="Initial Balance" D ^DIR K DIR
"RTN","PSADJI",21,0)
 .I $D(DIRUT) L -^PSD(58.8,+PSALOC,1,+PSADRUG,0) S Y=1 Q
"RTN","PSADJI",22,0)
 .S PSAREC=Y D NOW^%DTC S PSADT=+$E(%,1,12),DIE="^PSD(58.8,+PSALOC,1,"
"RTN","PSADJI",23,0)
 .S DA(1)=PSALOC,DA=PSADRUG,DR="3////"_PSAREC D ^DIE
"RTN","PSADJI",24,0)
 .L -^PSD(58.8,+PSALOC,1,+PSADRUG,0)
"RTN","PSADJI",25,0)
 .Q:$G(PSAREC)']""
"RTN","PSADJI",26,0)
MON .S:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSADJI",27,0)
 .I '$D(^PSD(58.8,+PSALOC,1,+PSADRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DIC(0)="L",(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DLAYGO
"RTN","PSADJI",28,0)
 .S DIE="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DA(2)=PSALOC,DA(1)=PSADRUG,DA=$E(DT,1,5)*100,DR="1////0;7////^S X=PSAREC" D ^DIE
"RTN","PSADJI",29,0)
 .W !!,"Updating beginning balance and transaction history.",!
"RTN","PSADJI",30,0)
TR .F  L +^PSD(58.81,0):0 I  Q
"RTN","PSADJI",31,0)
FIND .S PSAT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSAT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSADJI",32,0)
 .S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSADJI",33,0)
 .S DIE="^PSD(58.81,",DA=PSAT,DR="1////11;2////^S X=PSALOC;3////^S X=PSADT;4////^S X=PSADRUG;5////^S X=PSAREC;6////^S X=DUZ;9////0" D ^DIE K DIE
"RTN","PSADJI",34,0)
 .S:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSADJI",35,0)
 .S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,4,",DIC(0)="L",(X,DINUM)=PSAT
"RTN","PSADJI",36,0)
 .S DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DA,DLAYGO,Y
"RTN","PSADJI",37,0)
QUIT K ^TMP("PSAB",$J) Q
"RTN","PSADJR")
0^12^B20301579
"RTN","PSADJR",1,0)
PSADJR ;BIR/LTL,JMB-Balance Adjustments History ;8/21/97
"RTN","PSADJR",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSADJR",3,0)
 ;This routine reviews adjustment transactions for drugs.
"RTN","PSADJR",4,0)
 ;
"RTN","PSADJR",5,0)
LOOK ;Get locations to display
"RTN","PSADJR",6,0)
 S (PSACNT,PSAOUT)=0 D ^PSAUTL3 G:PSAOUT EXIT
"RTN","PSADJR",7,0)
 S PSACNT=0,PSACHK=$O(PSALOC(""))
"RTN","PSADJR",8,0)
 I PSACHK="",'PSALOC W !,"There are no active pharmacy locations." G EXIT
"RTN","PSADJR",9,0)
 I '$O(^PSD(58.8,PSALOC,1,0)) W !!,"There are no drugs in ",PSALOCN S PSAOUT=1 G EXIT
"RTN","PSADJR",10,0)
 S DIC="^PSD(58.8,PSALOC,1,",DIC(0)="AEMQZ",DIC("A")="Select drug for history: ",DA(1)=PSALOC,DIC("W")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)'>DT,1:0) W $C(7),""   ***INACTIVE ***""" W !
"RTN","PSADJR",11,0)
 D ^DIC K DIC S PSA=+Y I PSA<0 S PSAOUT=1 G EXIT
"RTN","PSADJR",12,0)
 I '$O(^PSD(58.81,"F",+Y,"")) W !!,"There have been no adjustments for this drug.",!! S PSAOUT=1 G EXIT
"RTN","PSADJR",13,0)
 W ! S DIR(0)="D:AEP",DIR("A")="How far back in time do you want to go: ",DIR("B")="T-6M" D ^DIR K DIR I $D(DIRUT) S PSAOUT=1 G EXIT
"RTN","PSADJR",14,0)
 S PSAT=Y
"RTN","PSADJR",15,0)
DEV ;asks device and queueing info
"RTN","PSADJR",16,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" S PSAOUT=1 G EXIT
"RTN","PSADJR",17,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSADJR",ZTDESC="Drug Acct. - Drug adjustment review",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G EXIT
"RTN","PSADJR",18,0)
START ;compiles and prints output
"RTN","PSADJR",19,0)
 D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSADJR",20,0)
 S PSADRG=$P($G(^PSDRUG(PSA,0)),"^"),PSATAB=(80-$L(PSADRG))/2
"RTN","PSADJR",21,0)
 N %DT,PSASLN,PSAPG,PSAOUT,PSARPDT S (PSAPG,PSAOUT)=0,$P(PSASLN,"-",81)="",Y=DT D DD^%DT S PSARPDT=Y,PSAR=0 D HEADER
"RTN","PSADJR",22,0)
LOOP F  S PSAR=+$O(^PSD(58.81,"F",PSA,PSAR)) Q:'PSAR  I $P($G(^PSD(58.81,PSAR,0)),"^",4)'<PSAT,$P($G(^(0)),"^",2)=9!($P($G(^(0)),"^",2)=24),$P($G(^(0)),"^",3)=PSALOC D  Q:PSAOUT
"RTN","PSADJR",23,0)
 .I $P($G(^PSD(58.81,PSAR,0)),"^",2)=9,$Y+4>IOSL D HEADER Q:PSAOUT
"RTN","PSADJR",24,0)
 .I $P($G(^PSD(58.81,PSAR,0)),"^",2)=24,$Y+6>IOSL D HEADER Q:PSAOUT
"RTN","PSADJR",25,0)
 .S Y=$P($G(^PSD(58.81,PSAR,0)),"^",4) X ^DD("DD") W !,$E(Y,1,17)
"RTN","PSADJR",26,0)
 .W:$P($G(^PSD(58.81,PSAR,0)),"^",2)=9 ?22 W:$P($G(^PSD(58.81,PSAR,0)),"^",2)=24 ?30 W $J($P($G(^PSD(58.81,PSAR,0)),"^",6),5,0)
"RTN","PSADJR",27,0)
 .W ?37,$E($P($G(^VA(200,+$P($G(^PSD(58.81,PSAR,0)),"^",7),0)),"^"),1,20)
"RTN","PSADJR",28,0)
 .I $P($G(^PSD(58.81,PSAR,0)),"^",2)=9 W !?37,$P($G(^PSD(58.81,PSAR,0)),"^",16),! Q
"RTN","PSADJR",29,0)
 .S PSATRANL=$P($G(^PSD(58.81,+$P($G(^PSD(58.81,PSAR,0)),"^",17),0)),"^",3),PSAHOLD=PSALOC,PSAHOLDN=PSALOCN,PSALOC=PSATRANL
"RTN","PSADJR",30,0)
 .I PSALOC="" W !?37,"TRANSFER DATA MISSING",! S PSALOC=PSAHOLD,PSALOCN=PSAHOLDN Q
"RTN","PSADJR",31,0)
 .D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSADJR",32,0)
 .I $P($G(^PSD(58.81,PSAR,0)),"^",6)<0 W:$L(PSALOCN)<42 !?37,"TO "_PSALOCN,! I $L(PSALOCN)>43 S PSATF="T" W !?37,"TO " D TRAN
"RTN","PSADJR",33,0)
 .I $P($G(^PSD(58.81,PSAR,0)),"^",6)>0 W:$L(PSALOCN)<42 !?37,"FROM "_PSALOCN,! I $L(PSALOCN)>43 S PSATF="F" W !?37,"FROM " D TRAN
"RTN","PSADJR",34,0)
 .S PSALOC=PSAHOLD,PSALOCN=PSAHOLDN
"RTN","PSADJR",35,0)
EXIT W:$E(IOST)'="C" @IOF
"RTN","PSADJR",36,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) D
"RTN","PSADJR",37,0)
 .S PSASS=21-$Y F PSAKK=1:1:PSASS W !
"RTN","PSADJR",38,0)
 .S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR W @IOF
"RTN","PSADJR",39,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSADJR",40,0)
 K DA,DIC,DIR,DIRUT,DTOUT,DUOUT,PSA,PSACHK,PSACNT,PSACOMB,PSADRG,PSAHOLD,PSAHOLDN,PSAKK,PSALOC,PSALOCA,PSALOCN,PSAOUT,PSAR,PSASEL,PSASS,PSAT,PSATAB,PSATF,PSATRAN,PSATRANL,X,Y
"RTN","PSADJR",41,0)
 Q
"RTN","PSADJR",42,0)
HEADER ;prints header info
"RTN","PSADJR",43,0)
 I $E(IOST,1,2)="C-",PSAPG D  Q:PSAOUT
"RTN","PSADJR",44,0)
 .S PSASS=21-$Y F PSAKK=1:1:PSASS W !
"RTN","PSADJR",45,0)
 .S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSADJR",46,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),"^"),"." S PSAOUT=1
"RTN","PSADJR",47,0)
 W:$Y @IOF S PSAPG=PSAPG+1
"RTN","PSADJR",48,0)
 W:$E(IOST)'="C" !,PSARPDT,?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE"
"RTN","PSADJR",49,0)
 W !?22,"HISTORY OF ADJUSTMENTS AND TRANSFERS",?70,"PAGE: ",PSAPG,!
"RTN","PSADJR",50,0)
 W:$L(PSALOCN)>76 ?2,$P(PSALOCN,"(IP)",1)_"(IP)",!?19,$P(PSALOCN,"(IP)",2),! W:$L(PSALOCN)<77 ?((80-$L(PSALOCN))/2),PSALOCN,!?PSATAB,PSADRG,!
"RTN","PSADJR",51,0)
 I $P($G(^PSD(58.8,PSALOC,1,PSA,0)),"^",14),$P($G(^(0)),"^",14)'>DT W ?20,"** INACTIVE DRUG IN PHARMACY LOCATION **",!
"RTN","PSADJR",52,0)
 W !,"DATE",?22,"ADJUST",?30,"TRANS",?37,"TRANSACTOR & REASON",!,PSASLN
"RTN","PSADJR",53,0)
 Q
"RTN","PSADJR",54,0)
TRAN ;
"RTN","PSADJR",55,0)
 I $E(PSALOCN)="I" W $P($P(PSALOCN,":",2),"(IP)"),!
"RTN","PSADJR",56,0)
 I $E(PSALOCN)="O" W $P($P(PSALOCN,":",2),"(OP)"),!
"RTN","PSADJR",57,0)
 I $E(PSALOCN)="C" W "COMBINED:"_$P($P(PSALOCN,":",2),"(IP)",1)_"(IP)",! W:PSATF="T" ?49 W:PSATF="F" ?51 W $P($P(PSALOCN,":",2),"(IP)",2),!
"RTN","PSADJR",58,0)
 Q
"RTN","PSADRU")
0^14^B12305810
"RTN","PSADRU",1,0)
PSADRU ;BIR/LTL-Drugs Not Found in Linked Inventory ;7/23/97
"RTN","PSADRU",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSADRU",3,0)
 ;This routine reports the inventory/DA items.
"RTN","PSADRU",4,0)
 ;
"RTN","PSADRU",5,0)
SETUP N D0,D1,DA,DIE,DIC,DIR,DIRUT,DLAYGO,DR,DTOUT,DUOUT,PSA,PSADRUG,PSAINV,PSAOUT,X,Y
"RTN","PSADRU",6,0)
 ;LOOK UP LOCATION
"RTN","PSADRU",7,0)
LOOK D ^PSADA I '$G(PSALOC) S PSAOUT=1 G QUIT
"RTN","PSADRU",8,0)
 I '$O(^PSD(58.8,+PSALOC,1,0)) W !!,"There are no drugs in ",PSALOCN S PSAOUT=1 G QUIT
"RTN","PSADRU",9,0)
NOINV I '$O(^PSD(58.8,PSALOC,4,0)) W !,$G(PSALOCN)_" is not linked to an Inventory Point.",! D  G:$G(PSAOUT) QUIT
"RTN","PSADRU",10,0)
 .S DIR(0)="Y",DIR("A")="Would you like to attempt a link now",DIR("B")="Yes" D ^DIR K DIR S:Y'=1 PSAOUT=1 Q:Y'=1  D  I $D(Y) S PSAOUT=1 Q
"RTN","PSADRU",11,0)
INV ..S DIE=58.8,DA=PSALOC,DR="[PSAGIP]" D ^DIE K DIE
"RTN","PSADRU",12,0)
DEV K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSAOUT=1 G QUIT
"RTN","PSADRU",13,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSADRU",ZTDESC="DA Location items not found in Inventory",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G QUIT
"RTN","PSADRU",14,0)
START N %DT,PSALN,PSAIT,PSAL,PSAD,PSAPG,PSARPDT,X,Y S (PSAPG,PSAOUT)=0,Y=DT D DD^%DT S PSARPDT=Y,PSAIT=0
"RTN","PSADRU",15,0)
 S PSA=0
"RTN","PSADRU",16,0)
 D HEADER
"RTN","PSADRU",17,0)
LOOP F  S PSA=$O(^PSD(58.8,+PSALOC,1,PSA)) Q:'PSA  D:$Y+6>IOSL HEADER Q:PSAOUT  D  Q:PSAOUT
"RTN","PSADRU",18,0)
 .W !!,$P($G(^PSDRUG(+PSA,0)),U)
"RTN","PSADRU",19,0)
 .S PSA(1)=$O(^PSDRUG(+PSA,441,0))
"RTN","PSADRU",20,0)
 .I 'PSA(1) W !!,"NOT CONNECTED TO THE ITEM MASTER FILE",!,PSALN Q
"RTN","PSADRU",21,0)
 .S PSA(2)=$G(^PSDRUG(+PSA,441,+PSA(1),0)),PSAINV=0
"RTN","PSADRU",22,0)
 .I '$O(^PSDRUG(+PSA,441,+PSA(1))) D  Q
"RTN","PSADRU",23,0)
 ..W !!,"CONNECTED TO: (",PSA(2),") ",$$DESCR^PRCPUX1(0,PSA(2))
"RTN","PSADRU",24,0)
 ..I '$O(^PRCP(445,"AE",+PSA(2),0)) W !!,"BUT NOT STOCKED BY AN INVENTORY POINT.",!,PSALN Q
"RTN","PSADRU",25,0)
 ..F  S PSAINV=$O(^PRCP(445,"AE",+PSA(2),PSAINV)) Q:'PSAINV  W !!,"AND STOCKED BY ",$$INVNAME^PRCPUX1(PSAINV),!,PSALN
"RTN","PSADRU",26,0)
 .W !!,"CONNECTED TO THE FOLLOWING ITEMS:"
"RTN","PSADRU",27,0)
 .S PSA(1)=0
"RTN","PSADRU",28,0)
 .F  S PSA(1)=$O(^PSDRUG(+PSA,441,PSA(1))) Q:'PSA(1)  D:$Y+6>IOSL HEADER Q:PSAOUT  D
"RTN","PSADRU",29,0)
 ..S PSA(2)=$G(^PSDRUG(+PSA,441,+PSA(1),0)),PSAINV=0
"RTN","PSADRU",30,0)
 ..W !!,"(",PSA(2),") ",$$DESCR^PRCPUX1(0,PSA(2))
"RTN","PSADRU",31,0)
 ..I '$O(^PRCP(445,"AE",+PSA(2),0)) W !!,"BUT NOT STOCKED BY AN INVENTORY POINT.",!,PSALN Q
"RTN","PSADRU",32,0)
 ..F  S PSAINV=$O(^PRCP(445,"AE",+PSA(2),PSAINV)) Q:'PSAINV  W !!,"AND STOCKED BY ",$$INVNAME^PRCPUX1(PSAINV),!,PSALN
"RTN","PSADRU",33,0)
QUIT I $E(IOST)'="C" W @IOF
"RTN","PSADRU",34,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSADRU",35,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSADRU",36,0)
 K PSAIT Q
"RTN","PSADRU",37,0)
HEADER I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSADRU",38,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSADRU",39,0)
 S PSAINV(2)=$E($P(^PSD(58.8,PSALOC,0),U),1,10)
"RTN","PSADRU",40,0)
 S:$E(PSAINV(2),10)="(" PSAINV(2)=$E(PSAINV(2),1,8)
"RTN","PSADRU",41,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !,PSAINV(2)_"'S Items Relationship to an Inventory Point",?56,PSARPDT,?70,"PAGE: "_PSAPG,!,PSALN
"RTN","PSADRU",42,0)
 Q
"RTN","PSADRUG")
0^15^B21853949
"RTN","PSADRUG",1,0)
PSADRUG ;BIR/LTL-Add/edit Pharmacy Location drugs ;7/23/97
"RTN","PSADRUG",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSADRUG",3,0)
 N DIC,DA,DIE,DLAYGO,DINUM,DR,DIR,DIRUT,PSA,PSAINV,PSAIT,X,Y
"RTN","PSADRUG",4,0)
 D ^PSADA G:'$G(PSALOC) QUIT
"RTN","PSADRUG",5,0)
NOINV S:'$D(^PSD(58.8,PSALOC,1,0)) ^(0)="^58.8001IP^^"
"RTN","PSADRUG",6,0)
 S DA(1)=PSALOC,DIC="^PSD(58.8,PSALOC,1,",DIC(0)="AEMQL",DIC("W")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)'>DT,1:0) W $C(7),""   *** INACTIVE ***""",DLAYGO=58.8 W ! D ^DIC K DIC,DLAYGO G:Y<1 QUIT S PSAIT=+Y
"RTN","PSADRUG",7,0)
 S PSAIT(2)=$P($G(^PSDRUG(+PSAIT,0)),U)
"RTN","PSADRUG",8,0)
NOT I '$O(^PSDRUG(PSAIT,441,0)) W !?10,"**This drug is not linked to the ITEM MASTER file**",!?12,"To automate receiving, a link is needed.",! D
"RTN","PSADRUG",9,0)
 .S DIR(0)="Y",DIR("A")="Attempt link now",DIR("B")="Yes" D ^DIR K DIR Q:$D(DIRUT)!(Y<1)  D START^PSATI
"RTN","PSADRUG",10,0)
 I $O(^PSD(58.8,+PSALOC,4,0)),$O(^PSDRUG(+PSAIT,441,0)) S PSA(1)=0 D
"RTN","PSADRUG",11,0)
 .N PSAINV
"RTN","PSADRUG",12,0)
 .F  S PSA(1)=$O(^PSDRUG(+PSAIT,441,PSA(1))) Q:'PSA(1)  D
"RTN","PSADRUG",13,0)
 ..S PSAINV=0,PSA(1)=$G(^PSDRUG(+PSAIT,441,+PSA(1),0))
"RTN","PSADRUG",14,0)
 ..F  S PSAINV=$O(^PRCP(445,"AE",+PSA(1),PSAINV)) Q:'PSAINV!($O(^PSD(58.8,"P",+PSAINV,+PSALOC,0)))
"RTN","PSADRUG",15,0)
 ..I 'PSAINV W !!,"**",PSAIT(2),", from the DRUG file is linked to",!!,$$DESCR^PRCPUX1($G(PSAINV),PSA(1))," from the ITEM MASTER file",!!," but has NOT been added to a linked Inventory Point.**" Q
"RTN","PSADRUG",16,0)
 ..S PSAIT(1)=$G(PSAIT(1))+1
"RTN","PSADRUG",17,0)
 ..W:PSAIT(1)=1 !!,PSAIT(2),", from the DRUG file is linked to",!!
"RTN","PSADRUG",18,0)
 ..W $$DESCR^PRCPUX1(PSAINV,PSA(1))," from the ITEM MASTER file.",!!
"RTN","PSADRUG",19,0)
 ..W $$INVNAME^PRCPUX1(PSAINV)," shows a current balance of",!!
"RTN","PSADRUG",20,0)
 ..S PSAIT(3)=$G(^PRCP(445,+PSAINV,1,+PSA(1),0))
"RTN","PSADRUG",21,0)
 ..W $S($P(PSAIT(3),U,7):$P(PSAIT(3),U,7),1:0)," ",$$UNITCODE^PRCPUX1($P(PSAIT(3),U,5))
"RTN","PSADRUG",22,0)
 ..W " times dispensing unit conv factor = "
"RTN","PSADRUG",23,0)
 ..W $P(PSAIT(3),U,7)*$S($P(PSAIT(3),U,29):$P(PSAIT(3),U,29),1:1)
"RTN","PSADRUG",24,0)
 ..W " ",$P(PSAIT(3),U,28),!
"RTN","PSADRUG",25,0)
 S PSAIT(4)=$G(^PSDRUG(+PSAIT,660))
"RTN","PSADRUG",26,0)
 K PSA G:$P($G(^PSD(58.8,+PSALOC,1,+PSAIT,0)),U,4)]"" DISP
"RTN","PSADRUG",27,0)
DRUG S DIE="^PSD(58.8,PSALOC,1,",DA=PSAIT,DR="3Please enter total "_$P(PSAIT(4),U,8)_" currently on hand: ;S PSA(2)=X",DA(1)=PSALOC
"RTN","PSADRUG",28,0)
 D:$P(PSAIT(4),U,2)]""
"RTN","PSADRUG",29,0)
 .W !!?30,"DRUG FILE info:",!
"RTN","PSADRUG",30,0)
 .W ?20,"Order unit: "_$P(^DIC(51.5,+$P(PSAIT(4),U,2),0),U,2),!?20,"Dispense units per order unit: "_$P(PSAIT(4),U,5),!?20,"Dispense unit: "_$P(PSAIT(4),U,8)
"RTN","PSADRUG",31,0)
 .W !!,"Current Inventory from the DRUG file = "_$P($G(^PSDRUG(PSAIT,660.1)),U),!
"RTN","PSADRUG",32,0)
 W:'$P(^PSD(58.8,PSALOC,1,PSAIT,0),U,4) !,"Once an initial quantity is entered it can only be updated by receiving,",!,"dispensing or adjusting.",!!,"Updating will occur to the balance in ",$G(PSALOCN),".",!!,"The Current Inventory "
"RTN","PSADRUG",33,0)
 W "from the DRUG file is only offered as an initial balance",!,"and is NOT updated."
"RTN","PSADRUG",34,0)
 F  L +^PSD(58.8,+PSALOC,1,+PSAIT,0):0 I  Q
"RTN","PSADRUG",35,0)
 D ^DIE L -^PSD(58.8,+PSALOC,1,+PSAIT,0) G:$D(Y) QUIT
"RTN","PSADRUG",36,0)
DISP W !!,"Current balance:  "_$P(^PSD(58.8,PSALOC,1,PSAIT,0),U,4)," ",$P(PSAIT(4),U,8),!
"RTN","PSADRUG",37,0)
 G:$G(PSA(2))']"" AGAIN
"RTN","PSADRUG",38,0)
 N PSAT,PSADT
"RTN","PSADRUG",39,0)
 D NOW^%DTC S PSADT=+$E(%,1,12) K %
"RTN","PSADRUG",40,0)
MON S:'$D(^PSD(58.8,+PSALOC,1,+PSAIT,5,0)) ^(0)="^58.801A^^"
"RTN","PSADRUG",41,0)
 I '$D(^PSD(58.8,+PSALOC,1,+PSAIT,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSALOC,1,+PSAIT,5,",DIC(0)="LM",(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSALOC,DA(1)=PSAIT,DLAYGO=58.8 D ^DIC K DIC,DLAYGO
"RTN","PSADRUG",42,0)
 S DIE="^PSD(58.8,+PSALOC,1,+PSAIT,5,",DA(2)=PSALOC,DA(1)=PSAIT,DA=$E(DT,1,5)*100,DR="1////^S X=PSA(2);7////^S X=PSA(2)" D ^DIE K DIE
"RTN","PSADRUG",43,0)
 W !,"Updating beginning balance and transaction history.",!
"RTN","PSADRUG",44,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSADRUG",45,0)
FIND S PSAT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSAT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSADRUG",46,0)
 S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAT D ^DIC
"RTN","PSADRUG",47,0)
 L -^PSD(58.81,0) K DIC,DLAYGO
"RTN","PSADRUG",48,0)
 S DIE="^PSD(58.81,",DA=PSAT,DR="1////11;2////^S X=PSALOC;3////^S X=PSADT;4////^S X=PSAIT;5////^S X=PSA(2);6////^S X=DUZ;9////0" D ^DIE K DIE
"RTN","PSADRUG",49,0)
 S:'$D(^PSD(58.8,+PSALOC,1,+PSAIT,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSADRUG",50,0)
 S DIC="^PSD(58.8,+PSALOC,1,+PSAIT,4,",DIC(0)="L",(X,DINUM)=PSAT
"RTN","PSADRUG",51,0)
 S DA(2)=PSALOC,DA(1)=PSAIT,DLAYGO=58.8 D ^DIC K DA,DIC,DLAYGO
"RTN","PSADRUG",52,0)
AGAIN D:$O(^PS(52.6,"AC",+PSAIT,0))!($O(^PS(52.7,"AC",+PSAIT,0))) ^PSAPSI4 S DIR(0)="Y",DIR("A")="Another Drug",DIR("B")="No" W ! D ^DIR K DIR G:Y=1 NOINV
"RTN","PSADRUG",53,0)
QUIT Q
"RTN","PSADRUGP")
0^16^B19317845
"RTN","PSADRUGP",1,0)
PSADRUGP ;BIR/LTL,JMB-Enter/Edit a Drug ;7/23/97
"RTN","PSADRUGP",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSADRUGP",3,0)
 ;
"RTN","PSADRUGP",4,0)
LOC G:+$G(PSAOUT)&($G(PSACNT)=1) EXIT
"RTN","PSADRUGP",5,0)
 S (PSADD,PSACNT,PSAOUT)=0,PSASLN="",$P(PSASLN,"-",80)=""
"RTN","PSADRUGP",6,0)
 D ^PSAUTL3 G:PSAOUT EXIT S PSACHK=$O(PSALOC(""))
"RTN","PSADRUGP",7,0)
 I PSACHK="",'PSALOC W !,"There are no active pharmacy locations." G EXIT
"RTN","PSADRUGP",8,0)
 I $O(PSALOC(PSACHK))="" W !,PSALOCN
"RTN","PSADRUGP",9,0)
 ;
"RTN","PSADRUGP",10,0)
GETDRUG S PSAQTY=0
"RTN","PSADRUGP",11,0)
 S:'$D(^PSD(58.8,PSALOC,1,0)) ^(0)="^58.8001IP^^"
"RTN","PSADRUGP",12,0)
 S DA(1)=PSALOC,DIC="^PSD(58.8,"_PSALOC_",1,",DIC(0)="AEMQL",DIC("W")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)'>DT,1:0) W $C(7),""   *** INACTIVE ***""",DLAYGO=58.8 W ! D ^DIC K DIC,DLAYGO
"RTN","PSADRUGP",13,0)
 I Y<0!($G(DTOUT))!($G(DUOUT)) S PSAOUT=1 G LOC
"RTN","PSADRUGP",14,0)
 S PSADRG=+Y,PSADRGN=$P($G(^PSDRUG(PSADRG,0)),"^")
"RTN","PSADRUGP",15,0)
 I $D(^PSD(58.8,PSALOC,1,PSADRG,0)),+$P(^(0),"^",14),$P(^(0),"^",14)'>DT W !,$C(7),"   *** INACTIVE ***" G GETDRUG
"RTN","PSADRUGP",16,0)
 S PSA660=$G(^PSDRUG(PSADRG,660))
"RTN","PSADRUGP",17,0)
 I '$D(^PSD(58.8,PSALOC,1,PSADRG,0)) G NOINV
"RTN","PSADRUGP",18,0)
 I $D(^PSD(58.8,PSALOC,1,PSADRG,0)),$P(^(0),"^",4)="" G DRUG
"RTN","PSADRUGP",19,0)
 G DISP
"RTN","PSADRUGP",20,0)
 ;
"RTN","PSADRUGP",21,0)
NOINV I '$D(^PSD(58.8,PSALOC,1,PSADRG,0)) D
"RTN","PSADRUGP",22,0)
 .S:'$D(^PSD(58.8,PSALOC,1,0)) ^(0)="^58.8001IP^^"
"RTN","PSADRUGP",23,0)
 .K DA,DD,DO S DIC="^PSD(58.8,"_PSALOC_",1,",DIC(0)="LM",DA(1)=PSALOC,(X,DINUM)=PSADRG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSADRUGP",24,0)
DRUG S DIE="^PSD(58.8,"_PSALOC_",1,",DA(1)=PSALOC,DA=PSADRG,DR="3Enter total "_$P(PSA660,"^",8)_" currently on hand: "
"RTN","PSADRUGP",25,0)
 W @IOF,!,$G(PSALOCN),!,"DRUG: "_PSADRGN
"RTN","PSADRUGP",26,0)
 D:+$P(PSA660,"^",2)
"RTN","PSADRUGP",27,0)
 .W !!?30,"DRUG FILE info:",!
"RTN","PSADRUGP",28,0)
 .W ?20,"Order unit: "_$P(^DIC(51.5,$P(PSA660,"^",2),0),"^",2),!?20,"Dispense units per order unit: "_$P(PSA660,"^",5),!?20,"Dispense unit: "_$P(PSA660,"^",8)
"RTN","PSADRUGP",29,0)
 .W !!,"Current Inventory from the DRUG file = "_$P($G(^PSDRUG(PSADRG,660.1)),"^")
"RTN","PSADRUGP",30,0)
 I '$P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",4) D
"RTN","PSADRUGP",31,0)
 .W !!,"Once an initial quantity is entered, it can only be updated by receiving,",!,"dispensing, adjusting, or transferring."
"RTN","PSADRUGP",32,0)
 .W:+$P(PSA660,"^",2) " The Current Inventory from the",!,"DRUG file is only offered as an initial balance and and is NOT updated."
"RTN","PSADRUGP",33,0)
 F  L +^PSD(58.8,PSALOC,1,PSADRG,0):0 I  Q
"RTN","PSADRUGP",34,0)
 W ! D ^DIE L -^PSD(58.8,PSALOC,1,PSADRG,0) K DA,DIE G:$D(Y) LOC
"RTN","PSADRUGP",35,0)
 S PSAQTY=X
"RTN","PSADRUGP",36,0)
 I +$P($G(^PSD(58.8,PSALOC,0)),"^",14) D
"RTN","PSADRUGP",37,0)
 .S DIE="^PSD(58.8,"_PSALOC_",1,",DA(1)=PSALOC,DA=PSADRG,DR="2Stock Level: ;4Reorder Level: "
"RTN","PSADRUGP",38,0)
 .F  L +^PSD(58.8,PSALOC,1,PSADRG,0):0 I  Q
"RTN","PSADRUGP",39,0)
 .D ^DIE L -^PSD(58.8,PSALOC,1,PSADRG,0) K DA,DIE
"RTN","PSADRUGP",40,0)
DISP W !!,"Current balance:  "_+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",4)," ",$P(PSA660,"^",8)
"RTN","PSADRUGP",41,0)
 G:'+PSAQTY GETDRUG
"RTN","PSADRUGP",42,0)
 D NOW^%DTC S PSADT=+$E(%,1,12)
"RTN","PSADRUGP",43,0)
MON S:'$D(^PSD(58.8,PSALOC,1,PSADRG,5,0)) ^PSD(58.8,PSALOC,1,PSADRG,5,0)="^58.801A^^"
"RTN","PSADRUGP",44,0)
 I '$D(^PSD(58.8,PSALOC,1,PSADRG,5,+($E(DT,1,5)*100),0)) S DIC="^PSD(58.8,"_PSALOC_",1,"_PSADRG_",5,",DIC(0)="LM",(X,DINUM)=($E(DT,1,5)*100),DA(2)=PSALOC,DA(1)=PSADRG,DLAYGO=58.8 D ^DIC K DA,DIC,DLAYGO
"RTN","PSADRUGP",45,0)
 S DIE="^PSD(58.8,"_PSALOC_",1,"_PSADRG_",5,",DA(2)=PSALOC,DA(1)=PSADRG,DA=($E(DT,1,5)*100),DR="1////^S X=PSAQTY;7////^S X=PSAQTY" D ^DIE K DA,DIE
"RTN","PSADRUGP",46,0)
 W !!,"Updating beginning balance and transaction history."
"RTN","PSADRUGP",47,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSADRUGP",48,0)
FIND S PSAT=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSAT)) S $P(^PSD(58.81,0),"^",3)=$P(^PSD(58.81,0),"^",3)+1 G FIND
"RTN","PSADRUGP",49,0)
 S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAT D ^DIC
"RTN","PSADRUGP",50,0)
 L -^PSD(58.81,0) K DIC,DLAYGO
"RTN","PSADRUGP",51,0)
 S DIE="^PSD(58.81,",DA=PSAT,DR="1////11;2////^S X=PSALOC;3////^S X=PSADT;4////^S X=PSADRG;5////^S X=PSAQTY;6////^S X=DUZ;9////0" D ^DIE K DIE,DA
"RTN","PSADRUGP",52,0)
 S:'$D(^PSD(58.8,PSALOC,1,PSADRG,4,0)) ^PSD(58.8,PSALOC,1,PSADRG,4,0)="^58.800119PA^^"
"RTN","PSADRUGP",53,0)
 S DIC="^PSD(58.8,"_PSALOC_",1,"_PSADRG_",4,",DIC(0)="LM",(X,DINUM)=PSAT
"RTN","PSADRUGP",54,0)
 S DA(2)=PSALOC,DA(1)=PSADRG,DLAYGO=58.8 D ^DIC K DA,DIC,DLAYGO
"RTN","PSADRUGP",55,0)
 G GETDRUG
"RTN","PSADRUGP",56,0)
EXIT K %,DA,DIC,DIE,DINUM,DR,DTOUT,DUOUT,PSA660,PSACHK,PSACNT,PSADD,PSADRG,PSADRGN,PSADT,PSALOC,PSALOCA,PSALOCN,PSAOUT,PSAQTY,PSASLN,PSAT,X,Y
"RTN","PSADRUGP",57,0)
 Q
"RTN","PSAENT")
0^17^B16807435
"RTN","PSAENT",1,0)
PSAENT ;BIR/LTL,JMB-Set Up/Edit a Pharmacy Location ;7/23/97
"RTN","PSAENT",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAENT",3,0)
 ;
"RTN","PSAENT",4,0)
START D DT^DICRW
"RTN","PSAENT",5,0)
 N D0,D1,DA,DIE,DIC,DIR,DIRUT,DLAYGO,DR,DTOUT,DUOUT,PSA,PSAB,PSAC,PSADRUG,PSAII,PSAIT,PSAIPS,PSAINV,PSAISIT,PSAIVLOC,PSALOC,PSAOC,PSALOCN,PSAOSIT,PSASTO,PSAITY,PSANOW,PSAOP,PSAO,PSAI,PSAOU,X,Y
"RTN","PSAENT",6,0)
 ;pick type
"RTN","PSAENT",7,0)
 S DIR(0)="S^1:INPATIENT;2:OUTPATIENT;3:COMBINED (IP/OP)",DIR("A")="Select Pharmacy type",DIR("?")="You can separate Inpatient and Outpatient or combine into one Location.",DIR("??")="PSA LOCATION EDIT"
"RTN","PSAENT",8,0)
 D ^DIR K DIR Q:'Y  S PSAITY=+Y,PSALOCN=Y(0)
"RTN","PSAENT",9,0)
 ;new IP or combined
"RTN","PSAENT",10,0)
 D:'$O(^PSD(58.8,"ADISP","P",0))
"RTN","PSAENT",11,0)
 .W !!,"Creating ",PSALOCN H 1
"RTN","PSAENT",12,0)
 .S DIC="^PSD(58.8,",DIC(0)="L",DLAYGO=58.8,X=PSALOCN,DIC("DR")="1////P",DIC("S")="I $S($P($G(^(0)),U,2)]"""":$P($G(^(0)),U,2)=""P"",1:1)" D ^DIC K DIC S PSALOC=+Y
"RTN","PSAENT",13,0)
 D:PSAITY'=2
"RTN","PSAENT",14,0)
 .;check for more than one IP site
"RTN","PSAENT",15,0)
 .S (PSA(1),PSA(2))=0 F  S PSA(1)=$O(^PS(59.4,PSA(1))) Q:'PSA(1)  S:$P($G(^(PSA(1),0)),U,26)=1 PSA(2)=PSA(2)+1,PSAB=PSA(1)
"RTN","PSAENT",16,0)
 .I PSA(2)<1 W !!,"An Inpatient Site has not been identified for AR/WS.",!!,"AR/WS dispensing data may not be gathered.",!! S:PSAITY=3 PSAO=1 S:PSAITY=1 PSAOU=1 Q
"RTN","PSAENT",17,0)
 .S:PSA(2)=1 PSAISIT=PSAB
"RTN","PSAENT",18,0)
 .D:PSA(2)>1  I Y<1 S PSAOU=1 Q
"RTN","PSAENT",19,0)
 ..W !!,"Because there is more than one Inpatient Site at this facility, I need you to"
"RTN","PSAENT",20,0)
 ..S DIC="^PS(59.4,",DIC(0)="AEMQZ",DIC("A")="select an AR/WS Inpatient Site Name: ",DIC("S")="I $P($G(^(0)),U,26)=1" D ^DIC K DIC S:$D(DUOUT)!($D(DTOUT))!(X="") PSAOU=1 S:PSAITY=3&(Y<1) PSAO=1 Q:Y<1  S PSAISIT=+Y
"RTN","PSAENT",21,0)
 .I $D(PSALOC) D  Q
"RTN","PSAENT",22,0)
 ..S DIE="^PSD(58.8,",DA=PSALOC,DR="2////^S X=PSAISIT" D ^DIE K DIE S Y=0
"RTN","PSAENT",23,0)
 .S PSALOC=""
"RTN","PSAENT",24,0)
 .F  S PSALOC=$O(^PSD(58.8,"ASITE",PSAISIT,"P",PSALOC)) Q:'PSALOC  I $S('$G(^PSD(58.8,+PSALOC,"I")):1,+^("I")>DT:1,1:0) Q
"RTN","PSAENT",25,0)
 .D:'PSALOC
"RTN","PSAENT",26,0)
 ..K DD,DO S DIC="^PSD(58.8,",DIC(0)="LZ",X=PSALOCN,DIC("DR")="1////P;2////^S X=PSAISIT" D FILE^DICN K DIC S PSALOC=+Y,PSALOCN=Y(0,0)
"RTN","PSAENT",27,0)
 .I PSALOC S PSALOCN=$P($G(^PSD(58.8,+PSALOC,0)),U) D  Q:'Y
"RTN","PSAENT",28,0)
 ..W !!,PSALOCN," is set up to gather AR/WS dispensing data for ",$P($G(^PS(59.4,PSAISIT,0)),U)
"RTN","PSAENT",29,0)
 ..S DIR(0)="Y",DIR("A")="Do you wish to change this",DIR("B")="No" D ^DIR K DIR S:'Y&(PSAITY=3) PSAO=1 S:$D(DIRUT) PSAOU=1 Q:'Y
"RTN","PSAENT",30,0)
 ..S DIR(0)="Y",DIR("A")="Do you want to change "_PSALOCN_" to "_$S($E(PSALOCN)="I":"COMBINED (IP/OP)",$E(PSALOCN)="C":"INPATIENT",1:""),DIR("B")="No" D ^DIR K DIR S:'Y PSAO=1 S:$D(DIRUT) PSAOU=1 Q:'Y  D
"RTN","PSAENT",31,0)
 ...S DIE="^PSD(58.8,",DA=PSALOC,DR=$S($E(PSALOCN)="I":".01////COMBINED (IP/OP)",$E(PSALOCN)="C":".01////INPATIENT;20////@",1:"") D ^DIE K DIE,DA S Y=1 I $E(PSALOCN)="I" S PSAO=1,PSAOC=1
"RTN","PSAENT",32,0)
 ...S PSALOCN=$P($G(^PSD(58.8,+PSALOC,0)),U)
"RTN","PSAENT",33,0)
 D:PSAITY'=2&('$G(PSAOU)) ^PSAWARD S:PSAITY=2 PSAO=1 Q:$D(PSAOU)
"RTN","PSAENT",34,0)
 I $D(PSAO) D OP^PSAENTO G QUIT
"RTN","PSAENT",35,0)
 D:'$G(PSAPVMEN) ED^PSAENTO D:$G(PSAPVMEN) DRUGS^PSAENTO
"RTN","PSAENT",36,0)
QUIT Q:'$D(PSALOC)
"RTN","PSAENT",37,0)
 W ! S DIE="^PSD(58.8,",DA=PSALOC,DR=$S(+$G(PSAPVMEN):"34Maintain reorder levels;35Days to keep invoice data;4Inactive Date",1:"4Inactive Date") D ^DIE K DIE
"RTN","PSAENT",38,0)
 Q
"RTN","PSAENTO")
0^18^B47506063
"RTN","PSAENTO",1,0)
PSAENTO ;BIR/LTL,JMB-Set Up/Edit a Pharmacy Location - CONT'D ;7/23/97
"RTN","PSAENTO",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAENTO",3,0)
 ;This routines is called by PSAENT.
"RTN","PSAENTO",4,0)
 ;
"RTN","PSAENTO",5,0)
OP G:$P($G(^PSD(58.8,+$G(PSALOC),0)),U,10) OPC
"RTN","PSAENTO",6,0)
 S Y=1 S PSA=$O(^PS(59,0)) D:$O(^PS(59,PSA))  G:Y<0 QUIT
"RTN","PSAENTO",7,0)
 .;more than one OP site
"RTN","PSAENTO",8,0)
 .W !!,"Because there is more than one Outpatient Site at this facility, I need you to "
"RTN","PSAENTO",9,0)
 .S DIC="^PS(59,",DIC(0)="AEMQ",DIC("A")="select an Outpatient Site: " D ^DIC K DIC S PSAOSIT=+Y
"RTN","PSAENTO",10,0)
 S:'$D(PSAOSIT) PSAOSIT=+$O(^PS(59,0))
"RTN","PSAENTO",11,0)
 ;if IP changed to combined, check for existing OP and zap
"RTN","PSAENTO",12,0)
 I +$G(PSALOC),+$G(PSAOC),$O(^PSD(58.8,"AOP",+PSAOSIT,"")),($O(^PSD(58.8,"AOP",+PSAOSIT,""))'=$G(PSALOC)) S DIE="^PSD(58.8,",DA=$O(^PSD(58.8,"AOP",+PSAOSIT,"")),DR="20////@" D ^DIE K DIE
"RTN","PSAENTO",13,0)
 I $G(PSALOC),'$O(^PSD(58.8,"AOP",+PSAOSIT,"")) S DIE="^PSD(58.8,",DA=PSALOC,DR="20////^S X=+PSAOSIT" D ^DIE K DIE
"RTN","PSAENTO",14,0)
 I '$O(^PSD(58.8,"AOP",+PSAOSIT,"")) D  G:Y<0 QUIT
"RTN","PSAENTO",15,0)
 .S DIC="^PSD(58.8,",DIC(0)="AEMQLZ",DLAYGO=58.8,DIC("A")="Please select Location: ",DIC("B")=$S(PSAITY=2:"OUTPATIENT",PSAITY=3:"COMBINED (IP/OP)",1:"")
"RTN","PSAENTO",16,0)
 .S DIC("DR")="1////P;20////^S X=+PSAOSIT",DIC("S")="I $P($G(^(0)),U,2)=""P"",$S($P($G(^(0)),U,10):$P($G(^(0)),U,10)=+PSAOSIT,1:1)"
"RTN","PSAENTO",17,0)
 .S:PSAITY=3 DIC("W")="W ?30,""IP SITE: "",$P($G(^PS(59.4,+$P($G(^(0)),U,3),0)),U)"
"RTN","PSAENTO",18,0)
 .D ^DIC K DIC,DLAYGO S:Y>0 PSALOC=+Y,PSALOCN=Y(0,0)
"RTN","PSAENTO",19,0)
 S:'$D(PSALOC) PSALOC=$O(^PSD(58.8,"AOP",+PSAOSIT,"")),PSALOCN=$P($G(^PSD(58.8,+PSALOC,0)),U)
"RTN","PSAENTO",20,0)
OPC W !!,"Outpatient site selection affects the collection of dispensing data.",!
"RTN","PSAENTO",21,0)
 S DIE="^PSD(58.8,",DA=PSALOC,DR="20//^S X=$P($G(^PS(59,+PSAOSIT,0)),U)" D ^DIE K DIE G:$D(Y) QUIT
"RTN","PSAENTO",22,0)
 S PSAOSIT=+$P($G(^PSD(58.8,PSALOC,0)),"^",10)
"RTN","PSAENTO",23,0)
 G:'PSALOC QUIT
"RTN","PSAENTO",24,0)
 N PSADT,PSAT,PSAQTY,PSAY
"RTN","PSAENTO",25,0)
 G:$G(PSAPVMEN) DRUGS
"RTN","PSAENTO",26,0)
ED S DIE=58.8,DA=PSALOC,DR="[PSAENT]" D ^DIE K DIE,DA G:$D(Y) QUIT G:'$D(PSAINV) DRUGS D:$O(^PRCP(445,PSAINV,1,0))   G:$D(DIRUT) QUIT
"RTN","PSAENTO",27,0)
QUES .S DIR(0)="Y",DIR("A",1)="Would you like to loop through "_$$INVNAME^PRCPUX1($G(PSAINV))_"'S",DIR("A")="items to check for any new entries that are ready to load"
"RTN","PSAENTO",28,0)
 .S DIR("?")="I will check for items that are linked to the DRUG file but not yet stocked."
"RTN","PSAENTO",29,0)
 .W ! D ^DIR K DIR Q:'Y  S PSAIT=0 D
"RTN","PSAENTO",30,0)
 ..S DIR(0)="Y",DIR("A")="Load inventory quantities also",DIR("B")="Yes",DIR("?")="Inventory quantities will be multiplied by the dispensing unit conversion factor." D ^DIR K DIR Q:$D(DIRUT)  S:Y=1 PSAY=1
"RTN","PSAENTO",31,0)
 ..S:'$D(^PSD(58.8,+PSALOC,1,0)) ^(0)="^58.8001IP^^"
"RTN","PSAENTO",32,0)
LOOP ..F  S PSAIT=$O(^PRCP(445,+PSAINV,1,PSAIT)) Q:'PSAIT  I '$G(^PRC(441,PSAIT,3)),$O(^PSDRUG("AB",+PSAIT,0)) S PSADRUG=$O(^PSDRUG("AB",PSAIT,0)) D:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,0))  Q:$D(DIRUT)
"RTN","PSAENTO",33,0)
 ...Q:'$S('$D(^PSDRUG(PSADRUG,"I")):1,+^("I")>DT:1,1:0)
"RTN","PSAENTO",34,0)
 ...S DIR(0)="Y",DIR("A",1)="OK to load "_$P($G(^PSDRUG(PSADRUG,0)),U)_" from the DRUG file",DIR("A")="linked to inventory item: "_$$DESCR^PRCPUX1($G(PSAINV),$G(PSAIT)),DIR("B")="Yes" D ^DIR K DIR Q:Y<1  S X=PSADRUG
"RTN","PSAENTO",35,0)
 ...S:$G(PSAY) DIC("DR")="3//^S X=PSAQTY;S PSAQTY=X"
"RTN","PSAENTO",36,0)
ITEM ...S DA(1)=PSALOC,DIC="^PSD(58.8,PSALOC,1,",DIC(0)="EMQL",DLAYGO=58.8,PSAQTY=$P($G(^PRCP(445,+PSAINV,1,PSAIT,0)),U,7)*$S($P($G(^(0)),U,29):$P(^(0),U,29),1:1) D ^DIC K DIC,DLAYGO Q:Y<0
"RTN","PSAENTO",37,0)
 ...Q:'$G(PSAY)
"RTN","PSAENTO",38,0)
 ...W !,"Updating Beginning balance and transaction history.",!
"RTN","PSAENTO",39,0)
 ...D NOW^%DTC S PSADT=+$E(%,1,12) K %
"RTN","PSAENTO",40,0)
 ...S ^PSD(58.8,+PSALOC,1,+PSADRUG,5,0)="^58.801A^^"
"RTN","PSAENTO",41,0)
 ...S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DIC(0)="LM",(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DIC("DR")="1////^S X=$G(PSAQTY);5////^S X=$G(PSAQTY)",DLAYGO=58.8 D ^DIC K DIC,DLAYGO
"RTN","PSAENTO",42,0)
 ...F  L +^PSD(58.81,0):0 I  Q
"RTN","PSAENTO",43,0)
FIND ...S PSAT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSAT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSAENTO",44,0)
 ...S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAT D ^DIC K DIC,DLAYGO L -^PSD(58.81,0)
"RTN","PSAENTO",45,0)
 ...S DIE="^PSD(58.81,",DA=PSAT,DR="1////11;2////^S X=PSALOC;3////^S X=PSADT;4////^S X=PSADRUG;5////^S X=PSAQTY;6////^S X=DUZ;9////0" D ^DIE K DIE
"RTN","PSAENTO",46,0)
 ...S:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSAENTO",47,0)
 ...S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,4,",DLAYGO=58.8,DIC(0)="L",(X,DINUM)=PSAT
"RTN","PSAENTO",48,0)
 ...S DA(2)=PSALOC,DA(1)=PSADRUG D ^DIC K DA,DIC,DLAYGO
"RTN","PSAENTO",49,0)
 ...I $O(^PS(52.6,"AC",+PSADRUG,0))!($O(^PS(52.7,"AC",+PSADRUG,0))) S PSAIT(1)=PSAIT,PSAIT(2)=$P($G(^PSDRUG(+PSADRUG,0)),U),PSAIT(4)=$G(^PSDRUG(+PSADRUG,660)),PSAIT=PSADRUG D ^PSAPSI4 S PSAIT=PSAIT(1)
"RTN","PSAENTO",50,0)
DRUGS W ! S DIR(0)="Y",DIR("A")="Add/edit drugs",DIR("B")="No" D ^DIR K DIR D:Y=1 ^PSADRUG
"RTN","PSAENTO",51,0)
 Q:'+$G(PSAOSIT)
"RTN","PSAENTO",52,0)
IV I '$O(^PSD(58.8,PSALOC,3.5,0)) W ! S DIR(0)="Y",DIR("A")="Does the outpatient site dispense IVs to IV rooms",DIR("B")="No" D ^DIR K DIR G:Y=0 QUIT
"RTN","PSAENTO",53,0)
 S PSALEN=$L($P($G(^PS(59,+PSAOSIT,0)),"^")),PSALEN=PSALEN+16
"RTN","PSAENTO",54,0)
IV1 W @IOF,!?((80-PSALEN)/2),$P($G(^PS(59,+PSAOSIT,0)),"^")_" Outpatient Site",!!
"RTN","PSAENTO",55,0)
 I $O(^PSD(58.8,PSALOC,3.5,0)) D
"RTN","PSAENTO",56,0)
 .W "Currently linked IV Rooms:" S PSANOW=0
"RTN","PSAENTO",57,0)
 .F  S PSANOW=$O(^PSD(58.8,PSALOC,3.5,PSANOW)) Q:'PSANOW  S PSANOW($P($G(^PS(59.5,PSANOW,0)),"^"))=""
"RTN","PSAENTO",58,0)
 .S PSANOW="" F  S PSANOW=$O(PSANOW(PSANOW)) Q:PSANOW=""  W ?27,PSANOW,!
"RTN","PSAENTO",59,0)
 S DIR(0)="SAO^L:Link;U:Unlink",DIR("A")="Link or unlink IV rooms (L/U): " D ^DIR K DIR G:$G(DIRUT) QUIT G:Y="U" UNLINK
"RTN","PSAENTO",60,0)
 W !!,"Enter the IV rooms that receive IVs from the outpatient site.",!
"RTN","PSAENTO",61,0)
 S DIC="^PS(59.5,",DIC(0)="AEQZ"
"RTN","PSAENTO",62,0)
 F  D ^DIC Q:$G(DTOUT)!($G(DUOUT))!(Y<0)  D
"RTN","PSAENTO",63,0)
 .S PSAIVLOC=+$O(^PSD(58.8,"AIV",+Y,0))
"RTN","PSAENTO",64,0)
 .I PSAIVLOC,PSAIVLOC'=PSALOC W !!,"<< "_Y(0,0)_" is already linked to the "_$P($G(^PS(59,+$P($G(^PSD(58.8,PSALOC,0)),"^",10),0)),"^"),!?4,"outpatient site in the "_$P($G(^PSD(58.8,PSALOC,0)),"^")_" pharmacy location. >>",! K Y Q
"RTN","PSAENTO",65,0)
 .I PSAIVLOC,PSAIVLOC=PSALOC W !!,"<< "_Y(0,0)_" is already linked to this outpatient site. >>",! K Y Q
"RTN","PSAENTO",66,0)
 .S:$D(Y(0,0)) PSAIV(Y(0,0))=+Y
"RTN","PSAENTO",67,0)
 K DIC S PSAIV=$O(PSAIV("")) I PSAIV="" W !!,"<< No IV rooms were selected to be linked to the Outpatient site. >>",! G QUIT
"RTN","PSAENTO",68,0)
 W @IOF W !?((80-PSALEN)/2),$P($G(^PS(59,+PSAOSIT,0)),"^")_" Outpatient Site",!!,"IV rooms to be linked:"
"RTN","PSAENTO",69,0)
 S PSAIV="" F  S PSAIV=$O(PSAIV(PSAIV)) Q:PSAIV=""  W ?23,PSAIV,!
"RTN","PSAENTO",70,0)
 S DIR(0)="Y",DIR("A")="Should the IV rooms be linked",DIR("B")="N" D ^DIR K DIR I 'Y K PSAIV G IV1
"RTN","PSAENTO",71,0)
 S:'$D(^PSD(58.8,PSALOC,3.5,0)) ^PSD(58.8,PSALOC,3.5,0)="^58.831P^^"
"RTN","PSAENTO",72,0)
 W ! S DIC="^PSD(58.8,"_PSALOC_",3.5,",DIC(0)="ML",PSAIV="" K DD,DO
"RTN","PSAENTO",73,0)
 W !,"Linking IV rooms"
"RTN","PSAENTO",74,0)
 F  S PSAIV=$O(PSAIV(PSAIV)) Q:PSAIV=""  K DD,DO S (X,DINUM)=PSAIV(PSAIV),DA(1)=PSALOC D FILE^DICN W "."
"RTN","PSAENTO",75,0)
 W !,"The IV rooms were linked successfully."
"RTN","PSAENTO",76,0)
 K DIC,PSAIV,DINUM,X
"RTN","PSAENTO",77,0)
QUIT Q
"RTN","PSAENTO",78,0)
UNLINK ;Unlink IV Rooms
"RTN","PSAENTO",79,0)
 S DIR(0)="Y",DIR("B")="N",PSANOW="" W !
"RTN","PSAENTO",80,0)
 F  S PSANOW=$O(PSANOW(PSANOW)) Q:PSANOW=""  S DIR("A")="Unlink "_PSANOW D ^DIR Q:$G(DIRUT)  I Y S PSANOW(PSANOW)=Y,PSADEL(PSANOW)=""
"RTN","PSAENTO",81,0)
 S PSANOW="",PSADEL=$O(PSADEL(PSANOW))
"RTN","PSAENTO",82,0)
 W @IOF,!?((80-PSALEN)/2),$P($G(^PS(59,+PSAOSIT,0)),"^")_" Outpatient Site",!!
"RTN","PSAENTO",83,0)
 I PSADEL'="" W !,"To be unlinked:" S PSANOW="" D
"RTN","PSAENTO",84,0)
 .F  S PSANOW=$O(PSADEL(PSANOW)) Q:PSANOW=""  W ?16,PSANOW,!
"RTN","PSAENTO",85,0)
 .W ! S DIR(0)="Y",DIR("B")="N",DIR("A")="Okay to unlink the IV Rooms" D ^DIR K DIR Q:$G(DIRUT)  I 'Y W !,"No IV rooms were unlinked." Q
"RTN","PSAENTO",86,0)
 .W !,"Unlinking IV rooms"
"RTN","PSAENTO",87,0)
 .S PSANOW="",DIE="^PSD(58.8,"_PSALOC_",3.5,",DA(1)=PSALOC F  S PSANOW=$O(PSADEL(PSANOW)) Q:PSANOW=""  S DA=$O(^PS(59.5,"B",PSANOW,0)),DR=".01///@" D ^DIE W "."
"RTN","PSAENTO",88,0)
 .K DIE W !,"IV rooms unlinked."
"RTN","PSAENTO",89,0)
 Q
"RTN","PSAENVIR")
0^19^B9070577
"RTN","PSAENVIR",1,0)
PSAENVIR ;BIR/JMB-Environment Check ;9/6/97
"RTN","PSAENVIR",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAENVIR",3,0)
 ;
"RTN","PSAENVIR",4,0)
1 ;CS not installed or not V. 3.0 or greater
"RTN","PSAENVIR",5,0)
 S Y=$$VERSION^XPDUTL("PSD")
"RTN","PSAENVIR",6,0)
 I Y<3 D
"RTN","PSAENVIR",7,0)
 .W !!,"Controlled Substances V. 2.0 or greater must be installed before installing",!,"Drug Accountability. After you install the correct version and setup a",!,"master vault, you can install Drug Accountability." S XPDABORT=1
"RTN","PSAENVIR",8,0)
 I '$$PATCH^XPDUTL("PSD*3.0*6") W !,"Patch PSD*3.0*6 must be installed before installing Drug Accountability.",! S XPDABORT=1
"RTN","PSAENVIR",9,0)
 ;
"RTN","PSAENVIR",10,0)
2 ;PDM not installed or not V. 1.0
"RTN","PSAENVIR",11,0)
 S Y=$$VERSION^XPDUTL("PSS")
"RTN","PSAENVIR",12,0)
 I Y="" W !!,"Pharmacy Data Management V. 1.0 or greater must be installed before",!,"installing Drug Accountability." S XPDABORT=1
"RTN","PSAENVIR",13,0)
 ;
"RTN","PSAENVIR",14,0)
3 ;Kernel not V. 8.0
"RTN","PSAENVIR",15,0)
 S Y=+$$VERSION^XPDUTL("XU")
"RTN","PSAENVIR",16,0)
 I Y<8 W !!,"Kernel V. 8.0 or greater must be installed before installing Drug",!,"Accountability." S XPDABORT=1
"RTN","PSAENVIR",17,0)
 ;
"RTN","PSAENVIR",18,0)
4 ;Toolkit not installed or not V. 7.2
"RTN","PSAENVIR",19,0)
 S Y=+$$VERSION^XPDUTL("XT")
"RTN","PSAENVIR",20,0)
 I Y<7.2 W !!,"Toolkit V. 7.2 or greater must be installed before installing Drug",!,"Accountability." S XPDABORT=1
"RTN","PSAENVIR",21,0)
 ;
"RTN","PSAENVIR",22,0)
5 ;PSN not installed or not V. 3.16
"RTN","PSAENVIR",23,0)
 S Y=+$$VERSION^XPDUTL("PSN")
"RTN","PSAENVIR",24,0)
 I Y<3.16 W !!,"National Drug File V. 3.16 or greater must be installed before installing",!,"Drug Accountability." S XPDABORT=1
"RTN","PSAENVIR",25,0)
 ;
"RTN","PSAENVIR",26,0)
6 ;No master vault.
"RTN","PSAENVIR",27,0)
 I '$O(^PSD(58.8,"ADISP","M",0)) D
"RTN","PSAENVIR",28,0)
 .W !!,"A master vault must be set up in the Controlled Substances package before",!,"installing Drug Accountability. After you have set up a master vault, you",!,"can install Drug Accountability."
"RTN","PSAENVIR",29,0)
 .S XPDABORT=1
"RTN","PSAENVIR",30,0)
 K Y
"RTN","PSAENVIR",31,0)
 Q
"RTN","PSAGIP")
0^20^B23156140
"RTN","PSAGIP",1,0)
PSAGIP ;BIR/LTL,JMB-DA receiving from GIP ;7/23/97
"RTN","PSAGIP",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAGIP",3,0)
 Q
"RTN","PSAGIP",4,0)
EN(PSAGIP,PSAITEM,PSAQTY,PSAISS,PSAEX,PSATR,PSACOST,PSANDC)     ; GIP passes recing data
"RTN","PSAGIP",5,0)
 ;PSAGIP=D0 from #445, PSAITEM=D0 from #441,
"RTN","PSAGIP",6,0)
 ;PSAQTY=qty rec'd converted to dispensing unit, PSAISS=D0 from #410,
"RTN","PSAGIP",7,0)
 ;PSAEX=external form of D0 from either #410 or #442,
"RTN","PSAGIP",8,0)
 ;PSATR=D0 from #445.2, PSACOST=total cost of receipt,
"RTN","PSAGIP",9,0)
 ;PSANDC=NDC with dashes
"RTN","PSAGIP",10,0)
 Q:'$G(PSAQTY)
"RTN","PSAGIP",11,0)
 Q:'$O(^PSD(58.8,"P",+$G(PSAGIP),""))  ; GIP not linked to DA location
"RTN","PSAGIP",12,0)
 ;check item linked to drug, drug stocked by DA loc, rec fail flag
"RTN","PSAGIP",13,0)
 N PSALOC S PSALOC=$O(^PSD(58.8,"P",+$G(PSAGIP),0)),PSADRUG=+$O(^PSDRUG("AB",+$G(PSAITEM),0))
"RTN","PSAGIP",14,0)
 S ^TMP("PSAC",$J,+PSALOC)=$G(PSAGIP)_U_$G(PSAEX)
"RTN","PSAGIP",15,0)
 I 'PSADRUG,$P($G(^PSD(58.8,+PSALOC,4,+$G(PSAGIP),0)),U,2) S ^TMP("PSAB",$J,+$G(PSAITEM))="#"+$G(PSAITEM)_"  "_$$DESCR^PRCPUX1($G(PSAGIP),$G(PSAITEM))_" NOT LINKED." Q
"RTN","PSAGIP",16,0)
 I '$D(^PSD(58.8,+PSALOC,1,PSADRUG,0)),$P($G(^PSD(58.8,+PSALOC,4,+$G(PSAGIP),0)),U,2) S ^TMP("PSAB",$J,+$G(PSAITEM))="#"_$G(PSAITEM)_"  "_$$DESCR^PRCPUX1($G(PSAGIP),$G(PSAITEM))_" NOT STOCKED." Q
"RTN","PSAGIP",17,0)
 Q:'$D(^PSD(58.8,+PSALOC,1,$G(PSADRUG),0))
"RTN","PSAGIP",18,0)
 S ^TMP("PSA",$J,$G(PSADRUG))=$G(PSAQTY)_U_$G(PSAISS)_U_$G(PSAEX)_U_$G(PSATR)_U_$G(PSACOST)_U_$G(PSAITEM)_U_$G(PSANDC)
"RTN","PSAGIP",19,0)
 Q
"RTN","PSAGIP",20,0)
EX N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK,PSALOC,PSADAT,PSAB,PSAT,PSAGIP
"RTN","PSAGIP",21,0)
 Q:'$O(^TMP("PSAC",$J,0))
"RTN","PSAGIP",22,0)
 Q:'$O(^TMP("PSA",$J,0))&('$O(^TMP("PSAB",$J,0)))
"RTN","PSAGIP",23,0)
 S PSALOC=$O(^TMP("PSAC",$J,0)),PSAGIP=$P($G(^TMP("PSAC",$J,+PSALOC)),U)
"RTN","PSAGIP",24,0)
 S ZTDTH=$H,ZTIO="",ZTRTN="TSK^PSAGIP",ZTDESC="GIP/DA Receiving"
"RTN","PSAGIP",25,0)
 S ZTSAVE("PSALOC")="",ZTSAVE("PSAGIP")=""
"RTN","PSAGIP",26,0)
 S:$O(^TMP("PSA",$J,0)) ZTSAVE("^TMP(""PSA"",$J,")=""
"RTN","PSAGIP",27,0)
 S:$O(^TMP("PSAB",$J,0)) ZTSAVE("^TMP(""PSAB"",$J,")=""
"RTN","PSAGIP",28,0)
 S ZTSAVE("^TMP(""PSAC"",$J,")=""
"RTN","PSAGIP",29,0)
 D ^%ZTLOAD,HOME^%ZIS
"RTN","PSAGIP",30,0)
 K IO("Q"),^TMP("PSA",$J),^TMP("PSAB",$J),^TMP("PSAC",$J)
"RTN","PSAGIP",31,0)
 Q
"RTN","PSAGIP",32,0)
TSK N PSAM
"RTN","PSAGIP",33,0)
 S:$P($G(^PSD(58.8,+PSALOC,0)),U,2)="M" PSAM=1
"RTN","PSAGIP",34,0)
 F PSADRUG=0:0 S PSADRUG=$O(^TMP("PSA",$J,PSADRUG)) Q:'PSADRUG  S PSAQTY=$P($G(^TMP("PSA",$J,PSADRUG)),U),PSAISS=$P($G(^(PSADRUG)),U,2),PSAP=$P($G(^(PSADRUG)),U,3),PSATR=$P($G(^(PSADRUG)),U,4),PSACOST=$P($G(^(PSADRUG)),U,5) D
"RTN","PSAGIP",35,0)
 .S PSANDC=$P($G(^TMP("PSA",$J,PSADRUG)),U,7) D ^PSAGIP1
"RTN","PSAGIP",36,0)
 .S:'$P(PSAP,"-",3) PSAPO=PSAP
"RTN","PSAGIP",37,0)
 .L +^PSD(58.8,+PSALOC,1,+PSADRUG):5
"RTN","PSAGIP",38,0)
 .D NOW^%DTC S PSADAT=+$E(%,1,12) K %
"RTN","PSAGIP",39,0)
 .S PSAB=$P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,0)),U,4)
"RTN","PSAGIP",40,0)
 .S $P(^PSD(58.8,+PSALOC,1,+PSADRUG,0),U,4)=$G(PSAQTY)+PSAB
"RTN","PSAGIP",41,0)
 .L -^PSD(58.8,+PSALOC,1,+PSADRUG)
"RTN","PSAGIP",42,0)
MON .S:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSAGIP",43,0)
 .I '$D(^PSD(58.8,+PSALOC,1,+PSADRUG,5,$E(DT,1,5)*100,0)) S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DIC(0)="LM",DIC("DR")="1////^S X=$G(PSAB)" D
"RTN","PSAGIP",44,0)
 ..S (X,DINUM)=$E(DT,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO,X
"RTN","PSAGIP",45,0)
 ..S X="T-1M" D ^%DT S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DIC(0)="L",(X,DINUM)=$E(Y,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO,X S DA=+Y K Y
"RTN","PSAGIP",46,0)
 ..S DIE="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DA(2)=PSALOC,DA(1)=PSADRUG
"RTN","PSAGIP",47,0)
 ..S DR="3////^S X=$G(PSAB)" D ^DIE K DIE,DR
"RTN","PSAGIP",48,0)
 .S DIE="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DA(2)=PSALOC,DA(1)=PSADRUG,DA=$E(DT,1,5)*100,DR="5////^S X=$P($G(^(0)),U,3)+$G(PSAQTY)" D ^DIE K DIE,DR
"RTN","PSAGIP",49,0)
TR .F  L +^PSD(58.81,0):0 I  Q
"RTN","PSAGIP",50,0)
FIND .D FIND1 S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAT D ^DIC K DIC,DINUM,DLAYGO L -^PSD(58.81,0)
"RTN","PSAGIP",51,0)
 .S DIE="^PSD(58.81,",DA=PSAT
"RTN","PSAGIP",52,0)
 .S DR="1////^S X=$S($E($G(PSATR))=""R"":1,1:9);2////^S X=$G(PSALOC);3////^S X=PSADAT;4////^S X=$G(PSADRUG);5////^S X=$G(PSAQTY);6////^S X=DUZ;7////^S X=$G(PSAISS);8///^S X=$G(PSAPO);9////^S X=PSAB;100////^S X=$G(PSAM)"
"RTN","PSAGIP",53,0)
 .D ^DIE K DIE,DR
"RTN","PSAGIP",54,0)
 .S:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSAGIP",55,0)
 .S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,4,",DIC(0)="L",(X,DINUM)=PSAT
"RTN","PSAGIP",56,0)
 .S DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DA,DIC,DLAYGO,DINUM,PSAB,PSAISS,PSANDC,PSAPO,PSAQTY,PSATR
"RTN","PSAGIP",57,0)
 K ^TMP("PSA",$J)
"RTN","PSAGIP",58,0)
 Q:'$O(^TMP("PSAB",$J,0))
"RTN","PSAGIP",59,0)
 S:'$G(PSAP) PSAP=$P($G(^TMP("PSAC",$J,PSALOC)),U,2)
"RTN","PSAGIP",60,0)
 S XMDUZ="Failed Receipt Notifier",XMSUB="Failed DA/GIP Receipts - "_PSAP
"RTN","PSAGIP",61,0)
 S XMY(DUZ)=""
"RTN","PSAGIP",62,0)
 I $P($G(^PSD(58.8,+PSALOC,4,+$G(PSAGIP),0)),U,3)'="",$O(^XMB(3.8,"B",$P($G(^PSD(58.8,+PSALOC,4,+$G(PSAGIP),0)),U,3),0)) D
"RTN","PSAGIP",63,0)
 .S PSA=0,PSA(1)=$O(^XMB(3.8,"B",$P($G(^PSD(58.8,+PSALOC,4,+$G(PSAGIP),0)),U,3),0))
"RTN","PSAGIP",64,0)
 .F  S PSA=$O(^XMB(3.8,PSA(1),1,"B",PSA)) Q:'PSA  S XMY(PSA)=""
"RTN","PSAGIP",65,0)
 S XMTEXT="^TMP(""PSAB"",$J,"
"RTN","PSAGIP",66,0)
 G:'$D(XMY) QUIT1 D ^XMD
"RTN","PSAGIP",67,0)
QUIT1 K XMDUZ,XMSUB,XMTEXT,XMY
"RTN","PSAGIP",68,0)
 S:$D(ZTQUEUED) ZTREQ="@" K ^TMP("PSAB",$J)
"RTN","PSAGIP",69,0)
QUIT Q
"RTN","PSAGIP",70,0)
FIND1 S PSAT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSAT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND1
"RTN","PSAGIP",71,0)
 Q
"RTN","PSAGIP1")
0^21^B15477240
"RTN","PSAGIP1",1,0)
PSAGIP1 ;BIR/LTL,JMB-DA receiving from GIP - CONT'D;7/23/97
"RTN","PSAGIP1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAGIP1",3,0)
 N PSACOS,PSACO,PSACOD,PSAPC1,PSAPC2,PSAPC3,PSAFND,PSAONDC,PSAQT,PSAC,DA,DIE,DR,XMDUZ,XMSUB,XMY,XMTEXT
"RTN","PSAGIP1",4,0)
 G:'PSACOST!('PSAQTY) NDC
"RTN","PSAGIP1",5,0)
 S PSACOS=+$J((PSACOST/PSAQTY),0,3)
"RTN","PSAGIP1",6,0)
 S PSACO=$G(^PSDRUG(+PSADRUG,660))
"RTN","PSAGIP1",7,0)
 G:PSACOS=+$P(PSACO,U,6)!('$P(PSACO,U,5)) NDC
"RTN","PSAGIP1",8,0)
 S PSAQT=$P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,0)),U,4)
"RTN","PSAGIP1",9,0)
 I PSAQT>0 S PSACOST=PSACOST+(PSAQT*+$P(PSACO,U,6)),PSAQT=PSAQTY+PSAQT,PSACOS=+$J((PSACOST/PSAQT),0,3)
"RTN","PSAGIP1",10,0)
 G:PSACOS=+$P(PSACO,U,6) NDC
"RTN","PSAGIP1",11,0)
 S PSAC=+$J((PSACOS*$P(PSACO,U,5)),0,2)
"RTN","PSAGIP1",12,0)
 S DIE="^PSDRUG(",DA=PSADRUG
"RTN","PSAGIP1",13,0)
 S PSAFND=0,PSAONDC=$P($G(^PSDRUG(PSADRUG,2)),"^",4)
"RTN","PSAGIP1",14,0)
 D:PSANDC'=PSAONDC&(PSANDC'="")
"RTN","PSAGIP1",15,0)
 .S PSAPC1=$L($P(PSANDC,"-")),PSAPC2=$L($P(PSANDC,"-",2)),PSAPC3=$L($P(PSANDC,"-",3))
"RTN","PSAGIP1",16,0)
 .I PSAPC1=4,PSAPC2=4,PSAPC3=2 S PSAFND=1 Q
"RTN","PSAGIP1",17,0)
 .I PSAPC1=5,PSAPC2=3,PSAPC3=2 S PSAFND=1 Q
"RTN","PSAGIP1",18,0)
 .I PSAPC1=5,PSAPC2=4,PSAPC3=1 S PSAFND=1 Q
"RTN","PSAGIP1",19,0)
 .I PSAPC1=5,PSAPC2=4,PSAPC3=2 S PSAFND=1 Q
"RTN","PSAGIP1",20,0)
 .I PSAPC1=6,PSAPC2=4,PSAPC3=2 S PSAFND=1
"RTN","PSAGIP1",21,0)
 S DR=$S(PSAFND:"13////"_PSAC_";31////"_PSANDC,1:"13////"_PSAC) D ^DIE K DIE,DA
"RTN","PSAGIP1",22,0)
 S ^TMP("PSAD",$J,$E($P($G(^PSDRUG(+PSADRUG,0)),U),1,25))=$E($P($G(^PSDRUG(+PSADRUG,0)),U),1,25)_", Item #"_$P($G(^TMP("PSA",$J,PSADRUG)),U,6)_", Old price: $"_$P(PSACO,U,6)_", New price: $"_PSACOS
"RTN","PSAGIP1",23,0)
 I PSANDC'=PSAONDC,PSANDC'="" D
"RTN","PSAGIP1",24,0)
 .S ^TMP("PSAD",$J,$E($P($G(^PSDRUG(+PSADRUG,0)),U),1,25),1)="   Old NDC: "_$S(PSAONDC'="":PSAONDC,1:"None")_", New NDC: "_PSANDC
"RTN","PSAGIP1",25,0)
 .I 'PSAFND S ^TMP("PSAD",$J,$E($P($G(^PSDRUG(+PSADRUG,0)),U),1,25),2)="   The new NDC was not entered in the DRUG file due to an invalid format."
"RTN","PSAGIP1",26,0)
END Q:$O(^TMP("PSA",$J,PSADRUG))
"RTN","PSAGIP1",27,0)
 N PSAMSG S PSAMSG=$O(^TMP("PSAD",$J,"")) Q:PSAMSG=""
"RTN","PSAGIP1",28,0)
 N PSADRG S PSACNT=1,PSADRG=""
"RTN","PSAGIP1",29,0)
 F  S PSADRG=$O(^TMP("PSAD",$J,PSADRG)) Q:PSADRG=""  D
"RTN","PSAGIP1",30,0)
 .S ^TMP("PSAMSG",$J,PSACNT)=^TMP("PSAD",$J,PSADRG),PSACNT=PSACNT+1
"RTN","PSAGIP1",31,0)
 .S:$D(^TMP("PSAD",$J,PSADRG,1)) ^TMP("PSAMSG",$J,PSACNT)=^TMP("PSAD",$J,PSADRG,1),PSACNT=PSACNT+1
"RTN","PSAGIP1",32,0)
 .S:$D(^TMP("PSAD",$J,PSADRG,2)) ^TMP("PSAMSG",$J,PSACNT)=^TMP("PSAD",$J,PSADRG,2),PSACNT=PSACNT+1
"RTN","PSAGIP1",33,0)
 S XMDUZ="Price & NDC Updater",XMSUB="DRUG file Price/NDC Update - "_PSAP
"RTN","PSAGIP1",34,0)
 S XMY(DUZ)="",XMTEXT="^TMP(""PSAMSG"",$J,"
"RTN","PSAGIP1",35,0)
 I $P($G(^PSD(58.8,+PSALOC,4,+$G(PSAGIP),0)),U,3)'="",$O(^XMB(3.8,"B",$P($G(^PSD(58.8,+PSALOC,4,+$G(PSAGIP),0)),U,3),0)) D
"RTN","PSAGIP1",36,0)
 .S PSA=0,PSA(1)=$O(^XMB(3.8,"B",$P($G(^PSD(58.8,+PSALOC,4,+$G(PSAGIP),0)),U,3),0))
"RTN","PSAGIP1",37,0)
 .F  S PSA=$O(^XMB(3.8,PSA(1),1,"B",PSA)) Q:'PSA  S XMY(PSA)=""
"RTN","PSAGIP1",38,0)
 G:'$D(XMY) QUIT D ^XMD
"RTN","PSAGIP1",39,0)
QUIT K ^TMP("PSAD",$J),^TMP("PSAMSG",$J)
"RTN","PSAGIP1",40,0)
 Q
"RTN","PSAGIP1",41,0)
NDC ;This is called if the cost has not changed.
"RTN","PSAGIP1",42,0)
 S PSAFND=0,PSAONDC=$P($G(^PSDRUG(PSADRUG,2)),"^",4)
"RTN","PSAGIP1",43,0)
 G:PSANDC=PSAONDC!(PSANDC="") END
"RTN","PSAGIP1",44,0)
 D:PSANDC'=""
"RTN","PSAGIP1",45,0)
 .S PSAPC1=$L($P(PSANDC,"-")),PSAPC2=$L($P(PSANDC,"-",2)),PSAPC3=$L($P(PSANDC,"-",3))
"RTN","PSAGIP1",46,0)
 .I PSAPC1=4,PSAPC2=4,PSAPC3=2 S PSAFND=1
"RTN","PSAGIP1",47,0)
 .I PSAPC1=5,PSAPC2=3,PSAPC3=2 S PSAFND=1
"RTN","PSAGIP1",48,0)
 .I PSAPC1=5,PSAPC2=4,PSAPC3=1 S PSAFND=1
"RTN","PSAGIP1",49,0)
 .I PSAPC1=5,PSAPC2=4,PSAPC3=2 S PSAFND=1
"RTN","PSAGIP1",50,0)
 .I PSAPC1=6,PSAPC2=4,PSAPC3=2 S PSAFND=1
"RTN","PSAGIP1",51,0)
 .I PSAFND S DIE="^PSDRUG(",DA=PSADRUG,DR=";31////^S X=PSANDC" D ^DIE K DIE,DA
"RTN","PSAGIP1",52,0)
 S ^TMP("PSAD",$J,$E($P($G(^PSDRUG(+PSADRUG,0)),U),1,25))=$E($P($G(^PSDRUG(+PSADRUG,0)),U),1,25)_", Item #"_$P($G(^TMP("PSA",$J,PSADRUG)),U,6)
"RTN","PSAGIP1",53,0)
 S ^TMP("PSAD",$J,$E($P($G(^PSDRUG(+PSADRUG,0)),U),1,25),1)="   Old NDC: "_$S(PSAONDC'="":PSAONDC,1:"None")_", New NDC: "_PSANDC
"RTN","PSAGIP1",54,0)
 I 'PSAFND S ^TMP("PSAD",$J,$E($P($G(^PSDRUG(+PSADRUG,0)),U),1,25),2)="   The new NDC was not entered in the DRUG file due to an invalid format."
"RTN","PSAGIP1",55,0)
 G END
"RTN","PSAHIS")
0^22^B22842217
"RTN","PSAHIS",1,0)
PSAHIS ;BIR/LTL,JMB-Drug Transaction History ;7/23/97
"RTN","PSAHIS",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAHIS",3,0)
 ;This routine prints a report of all or specific drugs in a pharmacy
"RTN","PSAHIS",4,0)
 ;location for a user-specified number of days.
"RTN","PSAHIS",5,0)
 ;
"RTN","PSAHIS",6,0)
LOC ;Gets locations & drugs to print
"RTN","PSAHIS",7,0)
 S (PSACNT,PSAOUT)=0 D ^PSAUTL3 G:PSAOUT EXIT1
"RTN","PSAHIS",8,0)
 S PSACNT=0,PSACHK=$O(PSALOC(""))
"RTN","PSAHIS",9,0)
 I PSACHK="",'PSALOC W !,"There are no active pharmacy locations." G EXIT1
"RTN","PSAHIS",10,0)
 W ! S PSALOCN="" F  S PSALOCN=$O(PSALOC(PSALOCN)) Q:PSALOCN=""!(PSAOUT)  S PSALOC=0 F  S PSALOC=$O(PSALOC(PSALOCN,PSALOC)) Q:'PSALOC!(PSAOUT)  D
"RTN","PSAHIS",11,0)
 .W @IOF W:$L(PSALOCN)>79 !,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<80 !,PSALOCN
"RTN","PSAHIS",12,0)
 .D DRUG Q:PSAOUT  Q:X["^A"
"RTN","PSAHIS",13,0)
 G:PSAOUT EXIT G DAYS
"RTN","PSAHIS",14,0)
DRUG ;Gets drugs to print
"RTN","PSAHIS",15,0)
 W !!,"You may select one, several, or ^ALL drugs."
"RTN","PSAHIS",16,0)
 F  S DIC="^PSD(58.8,"_+PSALOC_",1,",DIC(0)="AEMQ",DIC("A")="Select Drug: " D  Q:PSAOUT!(Y<0)!(X["^A")
"RTN","PSAHIS",17,0)
 .D ^DIC K DIC I X'["^A"&(Y<1)&('PSACNT) S PSAOUT=1 Q
"RTN","PSAHIS",18,0)
 .I X["^A" D ALL^PSAHIS1 Q
"RTN","PSAHIS",19,0)
 .Q:Y<0  I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAHIS",20,0)
 .S ^TMP("PSADRG",$J,PSALOC,$P($G(^PSDRUG(+Y,0)),"^"),+Y)="" S PSACNT=PSACNT+1
"RTN","PSAHIS",21,0)
 .I PSACNT=1,'$O(^PSD(58.81,"F",+$O(^TMP("PSADRG",$J,PSALOC,$P($G(^PSDRUG(+Y,0)),"^"),0)),0)) W !!,"There have been no transactions for this drug.",!
"RTN","PSAHIS",22,0)
 I '$D(PSALOC) W !!,"There are no drugs in all the selected location(s)." G EXIT
"RTN","PSAHIS",23,0)
 Q
"RTN","PSAHIS",24,0)
 ;
"RTN","PSAHIS",25,0)
DAYS G:$O(^TMP("PSADRG",$J,""))="" EXIT
"RTN","PSAHIS",26,0)
 S DIR(0)="D:AEP",DIR("A")="How many days back do you want to search for the drug: ",DIR("B")="T-4M",DIR("?")="I will list transactions for your selected drug(s) within the last six months if you press return" W ! D ^DIR K DIR
"RTN","PSAHIS",27,0)
 S PSABDT=Y G:$G(DIRUT) EXIT
"RTN","PSAHIS",28,0)
 ;
"RTN","PSAHIS",29,0)
DEV ;Asks device & queueing info
"RTN","PSAHIS",30,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" W !
"RTN","PSAHIS",31,0)
 D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSAHIS",32,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSAHIS",33,0)
 .N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK
"RTN","PSAHIS",34,0)
 .S ZTRTN="START^PSAHIS",ZTDESC="Drug Acct.-Drug Transaction History"
"RTN","PSAHIS",35,0)
 .S ZTSAVE("PSALOC(")="",ZTSAVE("PSABDT")="",ZTSAVE("^TMP(""PSADRG"",$J,")="" D ^%ZTLOAD
"RTN","PSAHIS",36,0)
 ;
"RTN","PSAHIS",37,0)
START ;Compiles & prints output data
"RTN","PSAHIS",38,0)
 S PSARPDT=$E($$HTFM^XLFDT($H),1,12),PSADT=$P(PSARPDT,"."),PSATM=$P(PSARPDT,".",2)
"RTN","PSAHIS",39,0)
 S PSARPDT=$E(PSADT,4,5)_"-"_$E(PSADT,6,7)_"-"_$E(PSADT,2,3),PSARUN=PSARPDT_"@"_PSATM
"RTN","PSAHIS",40,0)
 S PSADLN="=====================================|==========|=====|=====|==========|========"
"RTN","PSAHIS",41,0)
 S PSABDTR=$E(PSABDT,4,5)_"-"_$E(PSABDT,6,7)_"-"_$E(PSABDT,2,3),PSAOUT=0
"RTN","PSAHIS",42,0)
 S PSALOCN="" F  S PSALOCN=$O(PSALOC(PSALOCN)) Q:PSALOCN=""  D  G:PSAOUT EXIT
"RTN","PSAHIS",43,0)
 .S PSALOC=0 F  S PSALOC=$O(PSALOC(PSALOCN,PSALOC)) Q:'PSALOC  D SITES^PSAUTL1,FIND Q:PSAOUT
"RTN","PSAHIS",44,0)
 ;
"RTN","PSAHIS",45,0)
EXIT W:$E(IOST,1,2)="C-" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSAHIS",46,0)
 K IO("Q"),^TMP("PSADRG",$J),^TMP("PSAHIS",$J),PSALOC,PSALOCA,PSALOCN
"RTN","PSAHIS",47,0)
 G:'PSAOUT LOC
"RTN","PSAHIS",48,0)
EXIT1 K %ZIS,DIC,DIR,DIRUT,DTOUT,DUOUT,PSA50,PSABAD,PSABAD1,PSABAL,PSABDT,PSABDTR,PSACHK,PSACNT,PSACOMB,PSADJT,PSADJDT,PSADLN,PSADRG,PSADRUG,PSADT
"RTN","PSAHIS",49,0)
 K PSAFIRST,PSAHOLD,PSAHOLDN,PSAIPT,PSAISIT,PSAISITN,PSALN,PSALOC,PSALOCA,PSALOCN,PSANONE,PSAOPT,PSAOSIT,PSAOSITN,PSAOUT,PSAPC,PSAPC1,PSAPCS,PSAPG
"RTN","PSAHIS",50,0)
 K PSAREA,PSARECT,PSARPDT,PSARPDT,PSARUN,PSAS,PSASEL,PSASITES,PSASS,PSATM,PSATR,PSATR0,PSATRANL,PSATRCNT,PSAWRT,X,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSAHIS",51,0)
 Q
"RTN","PSAHIS",52,0)
FIND ;Finds drugs & puts in alpha order in ^TMP("PSAHIS",$J)
"RTN","PSAHIS",53,0)
 K ^TMP("PSAHIS",$J),PSAFIRST
"RTN","PSAHIS",54,0)
 S (PSACNT,PSAPG)=0,PSADRG=""
"RTN","PSAHIS",55,0)
 F  S PSADRG=$O(^TMP("PSADRG",$J,PSALOC,PSADRG)) Q:PSADRG=""  S (PSABAD,PSA50)=0 F  S PSA50=$O(^TMP("PSADRG",$J,PSALOC,PSADRG,PSA50)) Q:'PSA50  D
"RTN","PSAHIS",56,0)
 .;I '$G(PSATR),$O(^TMP("PSADRG",$J,PSALOC,PSADRG,0)) S PSA50=$O(^TMP("PSADRG",$J,PSALOC,PSADRG,0))
"RTN","PSAHIS",57,0)
 .S (PSAFIRST,PSATR)=0 F  S PSATR=+$O(^PSD(58.81,"F",PSA50,PSATR)) Q:'PSATR!(PSAOUT)  D  Q:PSAOUT
"RTN","PSAHIS",58,0)
 ..S PSATR0=$G(^PSD(58.81,PSATR,0)) Q:$P(PSATR0,"^",3)'=PSALOC
"RTN","PSAHIS",59,0)
 ..I $P(PSATR0,"^",4)'<PSABDT S ^TMP("PSAHIS",$J,PSADRG,$E($P(PSATR0,"^",4),1,7),PSATR)="" S:'PSAFIRST PSAFIRST=PSATR,PSAFIRST(PSADRG)=PSATR Q
"RTN","PSAHIS",60,0)
 ..I PSAFIRST,PSATR>PSAFIRST S PSABAD1=$S($P(PSATR0,"^",2)=2!($P(PSATR0,"^",2)=15)!($P(PSATR0,"^",2)=6):-$P(PSATR0,"^",6),1:$P(PSATR0,"^",6)) S PSABAD(PSADRG)=$G(PSABAD(PSADRG))+PSABAD1
"RTN","PSAHIS",61,0)
 I $D(^TMP("PSAHIS",$J)) D ^PSAHIS1 Q
"RTN","PSAHIS",62,0)
 I '$D(^TMP("PSAHIS",$J)) W !!,"No transactions were found for the pharmacy location." H 1
"RTN","PSAHIS",63,0)
 Q
"RTN","PSAHIS1")
0^23^B38497683
"RTN","PSAHIS1",1,0)
PSAHIS1 ;BIR/LTL,JMB-Drug Transaction History - CONT'D ;7/23/97
"RTN","PSAHIS1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAHIS1",3,0)
 ;Prints the Show Drug Transaction History report in pharmacy location
"RTN","PSAHIS1",4,0)
 ;then date order. It is called by PSAHIS.
"RTN","PSAHIS1",5,0)
 ;
"RTN","PSAHIS1",6,0)
PRINT D HEADER S PSADRG="",PSACNT=0
"RTN","PSAHIS1",7,0)
 F  S PSADRG=$O(^TMP("PSAHIS",$J,PSADRG)) Q:PSADRG=""!(PSAOUT)  D:$Y+6>IOSL HEADER Q:PSAOUT  K PSABAL,PSATRCNT S PSADT=0 D  Q:PSAOUT
"RTN","PSAHIS1",8,0)
 .F  S PSADT=+$O(^TMP("PSAHIS",$J,PSADRG,PSADT)) Q:'PSADT!(PSAOUT)  D  Q:PSAOUT
"RTN","PSAHIS1",9,0)
 ..S PSATR=0 F  S PSATR=+$O(^TMP("PSAHIS",$J,PSADRG,PSADT,PSATR)) Q:'PSATR!(PSAOUT)  D:$Y+6>IOSL HEADER Q:PSAOUT  D TRANS
"RTN","PSAHIS1",10,0)
 .Q:PSAOUT  D:$Y+6>IOSL HEADER Q:PSAOUT  D TOTALS
"RTN","PSAHIS1",11,0)
 I 'PSACNT W !!,"No transactions were found for the pharmacy location."
"RTN","PSAHIS1",12,0)
 Q:PSAOUT
"RTN","PSAHIS1",13,0)
 ;
"RTN","PSAHIS1",14,0)
DONE ;Holds screen or ejects paper if sent to printer
"RTN","PSAHIS1",15,0)
 I $E(IOST,1,2)="C-" D
"RTN","PSAHIS1",16,0)
 .S PSAS=21-$Y F PSASS=1:1:PSAS W !
"RTN","PSAHIS1",17,0)
 .S DIR(0)="EA",DIR("A")="End of pharmacy location's display! Enter RETURN to continue or '^' to exit:" D ^DIR K DIR S:$G(DIRUT) PSAOUT=1
"RTN","PSAHIS1",18,0)
 I $E(IOST)'="C" W !!!,"REPORT RUN: ",PSARUN W @IOF
"RTN","PSAHIS1",19,0)
 Q
"RTN","PSAHIS1",20,0)
 ;
"RTN","PSAHIS1",21,0)
TRANS S PSATR0=$G(^PSD(58.81,PSATR,0)),PSACNT=1,PSATRCNT=$G(PSATRCNT)+1
"RTN","PSAHIS1",22,0)
 ;If it is first transaction for drug, print drug name & beg balance.
"RTN","PSAHIS1",23,0)
 ;Beg balance = 1st transaction + (receipts(+), adjs(+/-), &
"RTN","PSAHIS1",24,0)
 ;dispensing(-) made prior to beg date & fell within rpt date range)
"RTN","PSAHIS1",25,0)
 I PSATRCNT=1 D
"RTN","PSAHIS1",26,0)
 .W !,?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" D WRAPDRUG
"RTN","PSAHIS1",27,0)
 .S PSABAL=$P($G(^PSD(58.81,+PSAFIRST(PSADRG),0)),"^",10)+$G(PSABAD(PSADRG)) W ?72,$J(PSABAL,7)
"RTN","PSAHIS1",28,0)
 ;
"RTN","PSAHIS1",29,0)
 ;Print transaction date & +/- qty from balance
"RTN","PSAHIS1",30,0)
 W !,$E(PSADT,4,5)_"-"_$E(PSADT,6,7)_"-"_$E(PSADT,2,3),?10,$E($P($G(^VA(200,+$P(PSATR0,"^",7),0)),"^"),1,28)
"RTN","PSAHIS1",31,0)
 I $P(PSATR0,"^",2)'=24 S PSABAL=$S(119[$P(PSATR0,"^",2):PSABAL+$P(PSATR0,"^",6),1:PSABAL-$P(PSATR0,"^",6))
"RTN","PSAHIS1",32,0)
 I $P(PSATR0,"^",2)=24 S PSABAL=PSABAL+$P(PSATR0,"^",6)
"RTN","PSAHIS1",33,0)
 ;Receipts
"RTN","PSAHIS1",34,0)
 I $P(PSATR0,"^",2)=1 S PSAWRT=0 W ?37,"|",?41,$J($P(PSATR0,"^",6),6),?48,"|",?54,"|",?60,"|",?71,"|",?72,$J(PSABAL,7),! S PSARECT=$G(PSARECT)+$P(PSATR0,"^",6) D  Q
"RTN","PSAHIS1",35,0)
 .I $P($G(^PRC(442,+$P(PSATR0,"^",9),0)),"^") W ?11,"PO# ",$P($G(^(0)),"^"),?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" S PSALN=$G(PSALN)+1 S PSAWRT=1
"RTN","PSAHIS1",36,0)
 .I $P($G(^PRCS(410,+$P(PSATR0,"^",8),0)),"^") W:PSAWRT ! W ?11,"TR# ",$P($G(^(0)),"^"),?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" S PSALN=$G(PSALN)+1,PSAWRT=1
"RTN","PSAHIS1",37,0)
 .I $P($G(^PSD(58.81,PSATR,8)),"^",2)'="" W:PSAWRT ! W ?11,"ORD# ",$P($G(^(8)),"^",2),?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" S PSALN=$G(PSALN)+1,PSAWRT=1
"RTN","PSAHIS1",38,0)
 .I $P($G(^PSD(58.81,PSATR,8)),"^")'="" W:PSAWRT ! W ?11,"INV# ",$P($G(^(8)),"^"),?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" S PSALN=$G(PSALN)+1,PSAWRT=1
"RTN","PSAHIS1",39,0)
 .W:$G(PSAW) !?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" K PSAW
"RTN","PSAHIS1",40,0)
 ;Adjusted or transferred
"RTN","PSAHIS1",41,0)
 I $P(PSATR0,"^",2)=9!($P(PSATR0,"^",2)=11)!($P(PSATR0,"^",2)=24) D  Q
"RTN","PSAHIS1",42,0)
 .W ?37,"|",?48,"|",?54,"|",?60,"|",?64,$J($P(PSATR0,"^",6),6),?71,"|",?72,$J(PSABAL,7)
"RTN","PSAHIS1",43,0)
 .I +$P(PSATR0,"^",19) S PSADJDT=$P(PSATR0,"^",19) W !?11,"DATE ENTERED: "_$E(PSADJDT,4,5)_"-"_$E(PSADJDT,6,7)_"-"_$E(PSADJDT,2,3),?37,"|",?48,"|",?54,"|",?60,"|",?71,"|"
"RTN","PSAHIS1",44,0)
 .I $P(PSATR0,"^",2)=9!($P(PSATR0,"^",2)=11),$P(PSATR0,"^",16)'="" D REASON
"RTN","PSAHIS1",45,0)
 .D:$P(PSATR0,"^",2)=24 TRANSFER S PSADJT=$G(PSADJT)+$P(PSATR0,"^",6)
"RTN","PSAHIS1",46,0)
 ;Dispensed by IP (2 means Unit Dose or Ward Stock 15 means IV)
"RTN","PSAHIS1",47,0)
 I $P(PSATR0,"^",2)=2!($P(PSATR0,"^",2)=15) W ?10,"NIGHTLY BACKGROUND JOB",?37,"|",?48,"|",?49,$J($P(PSATR0,"^",6),5),?54,"|",?60,"|",?71,"|",?72,$J(PSABAL,7) S PSAIPT=$G(PSAIPT)+$P(PSATR0,"^",6) Q
"RTN","PSAHIS1",48,0)
 ;Dispensed by OP
"RTN","PSAHIS1",49,0)
 I $P(PSATR0,"^",2)=6 W ?10,"NIGHTLY BACKGROUND JOB",?37,"|",?48,"|",?54,"|",?55,$J($P(PSATR0,"^",6),5),?60,"|",?71,"|",?72,$J(PSABAL,7) S PSAOPT=$G(PSAOPT)+$P(PSATR0,"^",6)
"RTN","PSAHIS1",50,0)
 Q
"RTN","PSAHIS1",51,0)
 ;
"RTN","PSAHIS1",52,0)
HEADER ;Prints header info
"RTN","PSAHIS1",53,0)
 S PSAPG=PSAPG+1 I PSAPG=1,$E(IOST,1,2)="C-" W @IOF
"RTN","PSAHIS1",54,0)
 I $E(IOST,1,2)="C-",PSAPG>1 D  Q:PSAOUT
"RTN","PSAHIS1",55,0)
 .S PSAS=21-$Y F PSASS=1:1:PSAS W !
"RTN","PSAHIS1",56,0)
 .S DIR(0)="E" D ^DIR K DIR W:'$G(DIRUT) @IOF S:$G(DIRUT) PSAOUT=1
"RTN","PSAHIS1",57,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),"^"),"." S PSAOUT=1 Q
"RTN","PSAHIS1",58,0)
 I PSAPG>1,$E(IOST)'="C" W @IOF
"RTN","PSAHIS1",59,0)
 W !?22,"D R U G   A C C O U N T A B I L I T Y",?71,"Page ",$J(PSAPG,2)
"RTN","PSAHIS1",60,0)
 W !?((42-$L(PSABDTR)-$L(PSARPDT))/2),"HISTORY OF DRUG TRANSACTIONS FROM ",PSABDTR," TO ",PSARPDT
"RTN","PSAHIS1",61,0)
 W !?((80-$L(PSALOCN))/2),PSALOCN
"RTN","PSAHIS1",62,0)
 W !!?37,"|",?48,"| DISPENSED |",?71,"|"
"RTN","PSAHIS1",63,0)
 W !,"DATE",?10,"INITIATOR",?37,"| RECEIVED |  IP |  OP | ADJUSTED | BALANCE"
"RTN","PSAHIS1",64,0)
 W !,PSADLN
"RTN","PSAHIS1",65,0)
 I $G(PSADRG)'=""&($G(PSATRCNT)) D WRAPDRUG W ?72,$J(PSABAL,7)
"RTN","PSAHIS1",66,0)
 Q
"RTN","PSAHIS1",67,0)
 ;
"RTN","PSAHIS1",68,0)
ALL ;Creates drug array with all drugs in location
"RTN","PSAHIS1",69,0)
 S PSA50=0 F  S PSA50=+$O(^PSD(58.8,PSALOC,1,PSA50)) Q:'PSA50  S:$P($G(^PSDRUG(PSA50,0)),"^")'="" ^TMP("PSADRG",$J,PSALOC,$P($G(^PSDRUG(PSA50,0)),"^"),PSA50)="",PSACNT=PSACNT+1
"RTN","PSAHIS1",70,0)
 Q
"RTN","PSAHIS1",71,0)
 ;
"RTN","PSAHIS1",72,0)
WRAPDRUG ;Prints drug name w/o spliting words
"RTN","PSAHIS1",73,0)
 I $L(PSADRG)<36 W !,"* ",PSADRG,?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" Q
"RTN","PSAHIS1",74,0)
 S PSAPC1="" F PSAPCS=1:1 S PSAPC=$P(PSADRG," ",PSAPCS) Q:PSAPC=""  D
"RTN","PSAHIS1",75,0)
 .I $L(PSAPC1)+$L(PSAPC)+1<36 S PSAPC1=PSAPC1_PSAPC_" " Q
"RTN","PSAHIS1",76,0)
 .I $L(PSAPC1)+$L(PSAPC)+1>35 W !,"* "_PSAPC1,?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" S PSAPC1=PSAPC_" "
"RTN","PSAHIS1",77,0)
 W:$L(PSAPC1) !?4,PSAPC1,?37,"|",?48,"|",?54,"|",?60,"|",?71,"|"
"RTN","PSAHIS1",78,0)
 Q
"RTN","PSAHIS1",79,0)
 ;
"RTN","PSAHIS1",80,0)
REASON ;Prints transaction reason w/o spliting words
"RTN","PSAHIS1",81,0)
 S PSAREA=$P(PSATR0,"^",16)
"RTN","PSAHIS1",82,0)
 I $L(PSAREA)<27 W !?11,PSAREA,?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" Q
"RTN","PSAHIS1",83,0)
 S PSAPC1="" F PSAPCS=1:1 S PSAPC=$P(PSAREA," ",PSAPCS) Q:PSAPC=""  D
"RTN","PSAHIS1",84,0)
 .I $L(PSAPC1)+$L(PSAPC)+1<27 S PSAPC1=PSAPC1_PSAPC_" " Q
"RTN","PSAHIS1",85,0)
 .I $L(PSAPC1)+$L(PSAPC)+1>26 W !?11,PSAPC1,?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" S PSAPC1=PSAPC_" "
"RTN","PSAHIS1",86,0)
 W:$L(PSAPC1) !?11,PSAPC1,?37,"|",?48,"|",?54,"|",?60,"|",?71,"|"
"RTN","PSAHIS1",87,0)
 Q
"RTN","PSAHIS1",88,0)
 ;
"RTN","PSAHIS1",89,0)
TRANSFER ;Prints transfer pharm loc that rec'd or sent drugs
"RTN","PSAHIS1",90,0)
 S PSATRANL=$P($G(^PSD(58.81,+$P(PSATR0,"^",17),0)),"^",3),PSAHOLD=PSALOC,PSAHOLDN=PSALOCN,PSALOC=PSATRANL
"RTN","PSAHIS1",91,0)
 I PSALOC="" S PSAREA="TRANSFER DATA MISSING" S PSALOC=PSAHOLD,PSALOCN=PSAHOLDN Q
"RTN","PSAHIS1",92,0)
 D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSAHIS1",93,0)
 S PSAREA="TRANSFER "_$S($P(PSATR0,"^",6)<0:"TO ",1:"FROM ") D TRAN
"RTN","PSAHIS1",94,0)
 S PSALOC=PSAHOLD,PSALOCN=PSAHOLDN
"RTN","PSAHIS1",95,0)
 S PSAPC1="" F PSAPCS=1:1 S PSAPC=$P(PSAREA," ",PSAPCS) Q:PSAPC=""  D
"RTN","PSAHIS1",96,0)
 .I $L(PSAPC1)+$L(PSAPC)+1<27 S PSAPC1=PSAPC1_PSAPC_" " Q
"RTN","PSAHIS1",97,0)
 .I $L(PSAPC1)+$L(PSAPC)+1>26 W !?11,PSAPC1,?37,"|",?48,"|",?54,"|",?60,"|",?71,"|" S PSAPC1=PSAPC_" "
"RTN","PSAHIS1",98,0)
 W:$L(PSAPC1) !?11,PSAPC1,?37,"|",?48,"|",?54,"|",?60,"|",?71,"|"
"RTN","PSAHIS1",99,0)
 Q
"RTN","PSAHIS1",100,0)
 ;
"RTN","PSAHIS1",101,0)
TRAN ;Prints transferred location w/o spliting words
"RTN","PSAHIS1",102,0)
 I $E(PSALOCN)="I" S PSAREA=PSAREA_"INPATIENT:"_$P($P(PSALOCN,":",2),"(IP)")
"RTN","PSAHIS1",103,0)
 I $E(PSALOCN)="O" S PSAREA=PSAREA_"OUTPATIENT:"_$P($P(PSALOCN,":",2),"(OP)")
"RTN","PSAHIS1",104,0)
 I $E(PSALOCN)="C" S PSAREA=PSAREA_"COMBINED:"_$P($P(PSALOCN,":",2),"(IP)")_"(IP)"_$P($P(PSALOCN,":",2),"(IP)",2)
"RTN","PSAHIS1",105,0)
 W !?11,$P(PSAREA,":")_":",?37,"|",?48,"|",?54,"|",?60,"|",?71,"|"
"RTN","PSAHIS1",106,0)
 S PSAREA=$P(PSAREA,": ",2)
"RTN","PSAHIS1",107,0)
 Q
"RTN","PSAHIS1",108,0)
 ;
"RTN","PSAHIS1",109,0)
TOTALS ;Prints totals
"RTN","PSAHIS1",110,0)
 W !?37,"|----------|-----|-----|----------|--------"
"RTN","PSAHIS1",111,0)
 W !?25,"DRUG TOTALS",?37,"|",?41,$J($G(PSARECT),6),?48,"|",$J($G(PSAIPT),5),?54,"|",$J($G(PSAOPT),5),?60,"|",?64,$J($G(PSADJT),6),?71,"|",!,PSADLN
"RTN","PSAHIS1",112,0)
 K PSADJT,PSAIPT,PSAOPT,PSARECT
"RTN","PSAHIS1",113,0)
 Q
"RTN","PSALEVEL")
0^24^B42942400
"RTN","PSALEVEL",1,0)
PSALEVEL ;BIR/JMB-Enter/Edit Stock and Reorder Levels ;7/23/97
"RTN","PSALEVEL",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALEVEL",3,0)
 ;This routine allows the user to select a pharmacy location/master vault
"RTN","PSALEVEL",4,0)
 ;to set the MAINTAIN STOCK LEVELS? field. If yes, the stock and reorder
"RTN","PSALEVEL",5,0)
 ;levels can be edited.
"RTN","PSALEVEL",6,0)
 ;
"RTN","PSALEVEL",7,0)
 I '$D(^XUSEC("PSA ORDERS",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSALEVEL",8,0)
SETUP S PSASLN="",$P(PSASLN,"-",80)=""
"RTN","PSALEVEL",9,0)
 ;Counts pharmacy locations
"RTN","PSALEVEL",10,0)
 S (PSALOC,PSANUM)=0
"RTN","PSALEVEL",11,0)
 F  S PSALOC=+$O(^PSD(58.8,"ADISP","P",PSALOC)) Q:'PSALOC  D
"RTN","PSALEVEL",12,0)
 .Q:'$D(^PSD(58.8,PSALOC,0))!($P($G(^PSD(58.8,PSALOC,0)),"^")="")
"RTN","PSALEVEL",13,0)
 .I +$G(^PSD(58.8,PSALOC,"I")),+^PSD(58.8,PSALOC,"I")'>DT Q
"RTN","PSALEVEL",14,0)
 .S PSANUM=PSANUM+1,PSAONE=PSALOC,PSAISIT=+$P(^PSD(58.8,PSALOC,0),"^",3),PSAOSIT=+$P(^(0),"^",10)
"RTN","PSALEVEL",15,0)
 .D SITES^PSAUTL1 S PSALOCA($P(^PSD(58.8,PSALOC,0),"^")_PSACOMB,PSALOC)=PSAISIT_"^"_PSAOSIT
"RTN","PSALEVEL",16,0)
 ;Counts master vaults
"RTN","PSALEVEL",17,0)
 S (PSAMVNUM,PSAMV)=0
"RTN","PSALEVEL",18,0)
 F  S PSAMV=+$O(^PSD(58.8,"ADISP","M",PSAMV)) Q:'PSAMV  D
"RTN","PSALEVEL",19,0)
 .Q:'$D(^PSD(58.8,PSAMV,0))!($P($G(^PSD(58.8,PSAMV,0)),"^")="")!('$P($G(^PSD(58.8,PSAMV,0)),"^",8))
"RTN","PSALEVEL",20,0)
 .I +$G(^PSD(58.8,PSAMV,"I")),+^PSD(58.8,PSAMV,"I")'>DT Q
"RTN","PSALEVEL",21,0)
 .S PSAMVNUM=PSAMVNUM+1,PSAONEMV=PSAMV,PSAMV($P(^PSD(58.8,PSAMV,0),"^"),PSAMV)=""
"RTN","PSALEVEL",22,0)
 ;
"RTN","PSALEVEL",23,0)
BEGIN S (PSABEG,PSALOC,PSAMV,PSAOUT)=0
"RTN","PSALEVEL",24,0)
 I $D(^XUSEC("PSJ RPHARM",DUZ)) G:'PSAMVNUM&('PSANUM) NONE D PHARMKEY
"RTN","PSALEVEL",25,0)
 I '$D(^XUSEC("PSJ RPHARM",DUZ)) G:'PSANUM NONE D:PSANUM=1 ONE D:PSANUM>1 MANY
"RTN","PSALEVEL",26,0)
 G:PSAOUT EXIT G:PSABEG BEGIN
"RTN","PSALEVEL",27,0)
 ;
"RTN","PSALEVEL",28,0)
MAINTAIN ;Maintain reorder levels in pharmacy location/master vault?
"RTN","PSALEVEL",29,0)
 S PSA=$S(PSALOC:PSALOC,1:PSAMV)
"RTN","PSALEVEL",30,0)
 S DIE="^PSD(58.8,",DA=PSA,DR=34 D ^DIE K DA,DIE
"RTN","PSALEVEL",31,0)
 G:$G(DTOUT)!($G(DUOUT)) EXIT
"RTN","PSALEVEL",32,0)
 I '+X G:PSANUM&(PSAMVNUM) BEGIN G EXIT
"RTN","PSALEVEL",33,0)
 ;
"RTN","PSALEVEL",34,0)
GETDRUG ;Gets drug levels
"RTN","PSALEVEL",35,0)
 W ! S DIC(0)="AEMQZ",DIC="^PSD(58.8,"_PSA_",1,",DA(1)=PSA,DIC("S")="I +$P($G(^PSD(58.8,PSA,1,+Y,0)),U,14)'<DT!('$P($G(^PSD(58.8,PSA,1,+Y,0)),U,14))"
"RTN","PSALEVEL",36,0)
 D ^DIC K DA,DIC G:$G(DTOUT)!($G(DUOUT)) EXIT
"RTN","PSALEVEL",37,0)
 I Y=-1 G:(PSANUM=1&('PSAMVNUM))!('PSANUM&(PSAMVNUM=1)) EXIT G BEGIN
"RTN","PSALEVEL",38,0)
 S PSADRG=+Y
"RTN","PSALEVEL",39,0)
 S DIE="^PSD(58.8,"_PSA_",1,",DA(1)=PSA,DA=PSADRG,DR="2STOCK LEVEL (in Dispense Units);4REORDER LEVEL (in Dispense Units)" D ^DIE K DIE
"RTN","PSALEVEL",40,0)
 G:$G(DTOUT)!($G(DUOUT)) EXIT
"RTN","PSALEVEL",41,0)
 G GETDRUG
"RTN","PSALEVEL",42,0)
 ;
"RTN","PSALEVEL",43,0)
CHOOSE ;Selects the type of location to have the levels enter/edited.
"RTN","PSALEVEL",44,0)
 W @IOF,!?16,"<< ENTER/EDIT STOCK AND REORDER LEVELS SCREEN >>",!,PSASLN
"RTN","PSALEVEL",45,0)
 S DIR(0)="SO^P:Pharmacy Location;M:Master Vault",DIR("A")="Enter/edit levels for a pharmacy location or master vault",DIR("??")="^D CHO^PSALEVEL"
"RTN","PSALEVEL",46,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSALEVEL",47,0)
 S PSACHO=Y
"RTN","PSALEVEL",48,0)
 I PSACHO="P" D:PSANUM=1 ONE D:PSANUM>1 MANY Q
"RTN","PSALEVEL",49,0)
 I PSACHO="M" D:PSAMVNUM=1 ONEMV D:PSAMVNUM>1 MANYMV
"RTN","PSALEVEL",50,0)
 Q
"RTN","PSALEVEL",51,0)
 ;
"RTN","PSALEVEL",52,0)
EXIT ;Kills variables
"RTN","PSALEVEL",53,0)
 K DA,DIC,DIE,DIR,DIRUT,DR,DTOUT,DUOUT,PSA,PSABEG,PSACHO,PSACNT,PSACOMB,PSADRG,PSAISIT,PSAISITN,PSALOC,PSALOCA,PSALOCN
"RTN","PSALEVEL",54,0)
 K PSAMENU,PSAMV,PSAMVA,PSAMVIEN,PSAMVNUM,PSANUM,PSAONE,PSAONEMV,PSAOSIT,PSAOSITN,PSAOUT,PSASEL,PSASLN,PSAVAULT,X,Y
"RTN","PSALEVEL",55,0)
 Q
"RTN","PSALEVEL",56,0)
 ;
"RTN","PSALEVEL",57,0)
PHARMKEY ;
"RTN","PSALEVEL",58,0)
 I 'PSAMVNUM D:PSANUM=1 ONE D:PSANUM>1 MANY Q
"RTN","PSALEVEL",59,0)
 I PSANUM D CHOOSE Q
"RTN","PSALEVEL",60,0)
 I 'PSANUM D:PSAMVNUM=1 ONEMV D:PSAMVNUM>1 MANYMV
"RTN","PSALEVEL",61,0)
 Q
"RTN","PSALEVEL",62,0)
 ;
"RTN","PSALEVEL",63,0)
ONEMV ;Assigns invoice to Master Vault
"RTN","PSALEVEL",64,0)
 S PSAMV=PSAONEMV
"RTN","PSALEVEL",65,0)
 W @IOF,!?16,"<< ENTER/EDIT STOCK AND REORDER LEVELS SCREEN >>"
"RTN","PSALEVEL",66,0)
 W !?31,"<< MASTER VAULT >>",!!,$P(^PSD(58.8,PSAMV,0),"^"),!,PSASLN,!
"RTN","PSALEVEL",67,0)
 Q
"RTN","PSALEVEL",68,0)
 ;
"RTN","PSALEVEL",69,0)
MANYMV ;Displays active master vaults
"RTN","PSALEVEL",70,0)
 W @IOF,!?16,"<< ENTER/EDIT STOCK AND REORDER LEVELS SCREEN >>",!,PSASLN,!
"RTN","PSALEVEL",71,0)
 S PSASEL=0,PSAMVA="" F  S PSAMVA=$O(PSAMV(PSAMVA)) Q:PSAMVA=""  D
"RTN","PSALEVEL",72,0)
 .S PSAMVIEN=0 F  S PSAMVIEN=$O(PSAMV(PSAMVA,PSAMVIEN)) Q:'PSAMVIEN  D
"RTN","PSALEVEL",73,0)
 ..S PSASEL=PSASEL+1,PSAVAULT(PSASEL,PSAMVA,PSAMVIEN)=""
"RTN","PSALEVEL",74,0)
 ..W !,$J(PSASEL,2)_".",?4,PSAMVA
"RTN","PSALEVEL",75,0)
 W ! S DIR(0)="NO^1:"_PSASEL,DIR("A")="Select Master Vault",DIR("?")="Select the Master Vault to be edited",DIR("??")="^D MV^PSALEVEL"
"RTN","PSALEVEL",76,0)
 D ^DIR K DIR I Y="",PSANUM S PSABEG=1 Q
"RTN","PSALEVEL",77,0)
 I Y="",'PSANUM S PSAOUT=1 Q
"RTN","PSALEVEL",78,0)
 I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSALEVEL",79,0)
 S PSASEL=Y
"RTN","PSALEVEL",80,0)
 S PSAMVA=$O(PSAVAULT(PSASEL,"")) Q:PSAMVA=""  S PSAMVIEN=+$O(PSAVAULT(PSASEL,PSAMVA,0)) Q:'PSAMVIEN  S PSAMV=PSAMVIEN
"RTN","PSALEVEL",81,0)
 W @IOF,!?16,"<< ENTER/EDIT STOCK AND REORDER LEVELS SCREEN >>"
"RTN","PSALEVEL",82,0)
 W !?31,"<< MASTER VAULT >>",!!,$P(^PSD(58.8,PSAMV,0),"^"),!,PSASLN,!
"RTN","PSALEVEL",83,0)
 Q
"RTN","PSALEVEL",84,0)
 ;
"RTN","PSALEVEL",85,0)
NONE ;No DA pharmacy locations
"RTN","PSALEVEL",86,0)
 Q:PSAMVNUM
"RTN","PSALEVEL",87,0)
 W !!,"There are no Drug Accountability pharmacy locations.",!!,"Use the Set Up/Edit a Pharmacy Location option on Pharmacy Location menu"
"RTN","PSALEVEL",88,0)
 W !,"to setup one or more pharmacy locations."
"RTN","PSALEVEL",89,0)
 G EXIT
"RTN","PSALEVEL",90,0)
 ;
"RTN","PSALEVEL",91,0)
ONE ;Only one location
"RTN","PSALEVEL",92,0)
 S PSACNT=0,PSALOC=PSAONE,PSALOCN=$O(PSALOCA(""))
"RTN","PSALEVEL",93,0)
 W @IOF,!?16,"<< ENTER/EDIT STOCK AND REORDER LEVELS SCREEN >>"
"RTN","PSALEVEL",94,0)
 W !?31,"PHARMACY LOCATION",!!
"RTN","PSALEVEL",95,0)
 I $L(PSALOCN)>76 W $P(PSALOCN,":")_" :"_$P($P(PSALOCN,":",2),"(IP)",1)_"(IP)",!?20,$P(PSALOCN,"(IP)",2)
"RTN","PSALEVEL",96,0)
 W:$L(PSALOCN)<77 PSALOCN W !,PSASLN,!
"RTN","PSALEVEL",97,0)
 Q
"RTN","PSALEVEL",98,0)
 ;
"RTN","PSALEVEL",99,0)
MANY ;If more than one pharmacy location, display invoices.
"RTN","PSALEVEL",100,0)
 W @IOF,!?16,"<< ENTER/EDIT STOCK AND REORDER LEVELS SCREEN >>",!,PSASLN,!
"RTN","PSALEVEL",101,0)
 S PSACNT=0,PSALOCN="" F  S PSALOCN=$O(PSALOCA(PSALOCN)) Q:PSALOCN=""  D
"RTN","PSALEVEL",102,0)
 .S PSALOC=0 F  S PSALOC=$O(PSALOCA(PSALOCN,PSALOC)) Q:'PSALOC  D
"RTN","PSALEVEL",103,0)
 ..S PSACNT=PSACNT+1,PSAMENU(PSACNT,PSALOCN,PSALOC)=PSALOC
"RTN","PSALEVEL",104,0)
 ..W !,$J(PSACNT,2)_"." W:$L(PSALOCN)>72 ?4,$P(PSALOCN,"(IP)",1)_"(IP)",!?21,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<73 ?4,PSALOCN
"RTN","PSALEVEL",105,0)
 W !! K DIR S DIR(0)="NO^1:"_PSACNT,DIR("A")="Pharmacy Location",DIR("?")="Select the pharmacy location to be edited",DIR("??")="^D PL^PSALEVEL"
"RTN","PSALEVEL",106,0)
 D ^DIR K DIR I Y="",PSAMVNUM S PSABEG=1 Q
"RTN","PSALEVEL",107,0)
 I Y="",'PSAMVNUM S PSAOUT=1 Q
"RTN","PSALEVEL",108,0)
 I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSALEVEL",109,0)
 S PSASEL=Y,PSALOCN=$O(PSAMENU(PSASEL,"")) Q:PSALOCN=""
"RTN","PSALEVEL",110,0)
 S PSALOC=$O(PSAMENU(PSASEL,PSALOCN,0)) Q:'PSALOC
"RTN","PSALEVEL",111,0)
 W @IOF,!?16,"<< ENTER/EDIT STOCK AND REORDER LEVELS SCREEN >>"
"RTN","PSALEVEL",112,0)
 W !?28,"<< PHARMACY LOCATION >>",!!
"RTN","PSALEVEL",113,0)
 I $L(PSALOCN)>76 W $P(PSALOCN,"(IP)",1)_"(IP)",!?20,$P(PSALOCN,"(IP)",2)
"RTN","PSALEVEL",114,0)
 W:$L(PSALOCN)<77 PSALOCN W !,PSASLN,!
"RTN","PSALEVEL",115,0)
 Q
"RTN","PSALEVEL",116,0)
 ;
"RTN","PSALEVEL",117,0)
CHO ;Extended help for "Enter/edit levels for pharmacy location or master vault."
"RTN","PSALEVEL",118,0)
 W !?5,"Enter P to add or edit stock and reorder levels in a pharmacy location.",!?5,"Enter M to add or edit stock and reorder levels in a master vault."
"RTN","PSALEVEL",119,0)
 W !!?5,"After making your selection, you will be given a list of active pharmacy",!?5,"locations or master vaults from which to choose."
"RTN","PSALEVEL",120,0)
 Q
"RTN","PSALEVEL",121,0)
MV ;Extended help for "Select Master Vault"
"RTN","PSALEVEL",122,0)
 W !?5,"Enter the numbers of master vaults from the list. Select the ones that",!?5,"contain drugs you want to add or edit stock and reorder levels."
"RTN","PSALEVEL",123,0)
 Q
"RTN","PSALEVEL",124,0)
PL ;Extended help for "Select Pharmacy Location"
"RTN","PSALEVEL",125,0)
 W !?5,"Enter the numbers of pharmacy locations from the list. Select the ones that",!?5,"contain drugs you want to add or edit stock and reorder levels."
"RTN","PSALEVEL",126,0)
 Q
"RTN","PSALEVRP")
0^116^B50078903
"RTN","PSALEVRP",1,0)
PSALEVRP ;BIR/LTL,JMB-Stock and Reorder Report ;7/23/97
"RTN","PSALEVRP",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALEVRP",3,0)
 ;This routine prints a report of all drugs with their stock and reorder
"RTN","PSALEVRP",4,0)
 ;levels in a pharmacy location.
"RTN","PSALEVRP",5,0)
 ;
"RTN","PSALEVRP",6,0)
 D LOC G MASTER
"RTN","PSALEVRP",7,0)
 ;
"RTN","PSALEVRP",8,0)
 ;Gets locations
"RTN","PSALEVRP",9,0)
LOC S PSAOUT=0,PSALOC=+$O(^PSD(58.8,"ADISP","P",0))
"RTN","PSALEVRP",10,0)
 I 'PSALOC W !!?5,"No Drug Accountability location has been created yet." S PSAOUT=1 G MASTER
"RTN","PSALEVRP",11,0)
 ;
"RTN","PSALEVRP",12,0)
 ;Collect locations in alpha order
"RTN","PSALEVRP",13,0)
 S (PSACNT,PSALOC)=0 W !
"RTN","PSALEVRP",14,0)
 F  S PSALOC=+$O(^PSD(58.8,"ADISP","P",PSALOC)) Q:'PSALOC  D
"RTN","PSALEVRP",15,0)
 .Q:'$D(^PSD(58.8,PSALOC,0))!($P($G(^PSD(58.8,PSALOC,0)),"^")="")
"RTN","PSALEVRP",16,0)
 .I +$G(^PSD(58.8,PSALOC,"I")),+^PSD(58.8,PSALOC,"I")'>DT Q
"RTN","PSALEVRP",17,0)
 .Q:'$O(^PSD(58.8,PSALOC,1,0))  D SITES^PSAUTL1
"RTN","PSALEVRP",18,0)
 .S PSACNT=PSACNT+1
"RTN","PSALEVRP",19,0)
 .S PSALOCA($P(^PSD(58.8,PSALOC,0),"^")_PSACOMB,PSALOC)=$P(^(0),"^",3)_"^"_$P(^(0),"^",10)_"^"_+$G(^PSD(58.8,PSALOC,"I"))
"RTN","PSALEVRP",20,0)
 S PSACHK=$O(PSALOCA("")) I PSACHK="" G MASTER
"RTN","PSALEVRP",21,0)
 Q:$G(PSAHIS)&(PSACNT=1)
"RTN","PSALEVRP",22,0)
 ;
"RTN","PSALEVRP",23,0)
DISPLOC ;Displays the available pharmacy locations.
"RTN","PSALEVRP",24,0)
 W @IOF,!,"Choose one or many pharmacy locations:",!
"RTN","PSALEVRP",25,0)
 S PSACNT=0,PSALOCN=""
"RTN","PSALEVRP",26,0)
 F  S PSALOCN=$O(PSALOCA(PSALOCN)) Q:PSALOCN=""  D
"RTN","PSALEVRP",27,0)
 .S PSALOC=0 F  S PSALOC=$O(PSALOCA(PSALOCN,PSALOC)) Q:'PSALOC  D
"RTN","PSALEVRP",28,0)
 ..S PSACNT=PSACNT+1,PSAMENU(PSACNT,PSALOCN,PSALOC)=""
"RTN","PSALEVRP",29,0)
 ..W !,$J(PSACNT,2)
"RTN","PSALEVRP",30,0)
 ..W:$L(PSALOCN)>76 ?4,$P(PSALOCN,"(IP)",1)_"(IP)",!?21,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 ?4,PSALOCN
"RTN","PSALEVRP",31,0)
 ;
"RTN","PSALEVRP",32,0)
SELLOC W ! S DIR(0)="LO^1:"_PSACNT,DIR("A")="Select PHARMACY LOCATION",DIR("?")="Enter the number(s) of the Pharmacy Location",DIR("??")="^D HELP^PSAUTL3"
"RTN","PSALEVRP",33,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 G EXIT
"RTN","PSALEVRP",34,0)
 Q:Y=""&('$G(PSAHIS))  I Y="",$G(PSAHIS) S PSAOUT=1 Q
"RTN","PSALEVRP",35,0)
 S PSASEL=Y
"RTN","PSALEVRP",36,0)
 F PSAPC=1:1 S PSANUM=+$P(PSASEL,",",PSAPC) Q:'PSANUM  D
"RTN","PSALEVRP",37,0)
 .S PSALOCN=$O(PSAMENU(PSANUM,"")),PSALOC=$O(PSAMENU(PSANUM,PSALOCN,0))
"RTN","PSALEVRP",38,0)
 .S PSALOC(PSALOCN,PSALOC)=PSALOCA(PSALOCN,PSALOC)
"RTN","PSALEVRP",39,0)
 ;
"RTN","PSALEVRP",40,0)
 S PSACHK=$O(PSALOC(""))
"RTN","PSALEVRP",41,0)
 I PSACHK="",'PSALOC W !,"There are no active pharmacy locations." G EXIT1
"RTN","PSALEVRP",42,0)
 W ! S PSALOCN="" F  S PSALOCN=$O(PSALOC(PSALOCN)) Q:PSALOCN=""!(PSAOUT)  S PSALOC=0 F  S PSALOC=$O(PSALOC(PSALOCN,PSALOC)) Q:'PSALOC!(PSAOUT)  D
"RTN","PSALEVRP",43,0)
 .I '$O(^PSD(58.8,PSALOC,1,0)) D
"RTN","PSALEVRP",44,0)
 ..W:$L(PSALOCN)>79 !!,$P(PSALOCN,"(IP)",1)_"(IP)",!!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<80 !!,PSALOCN
"RTN","PSALEVRP",45,0)
 ..W !,"There are no drugs in the pharmacy location."
"RTN","PSALEVRP",46,0)
 Q
"RTN","PSALEVRP",47,0)
 ;
"RTN","PSALEVRP",48,0)
MASTER G:'$D(^XUSEC("PSA ORDERS",DUZ)) TEST S (PSAMVN,PSAMV)=0
"RTN","PSALEVRP",49,0)
 F  S PSAMV=+$O(^PSD(58.8,"ADISP","M",PSAMV)) Q:'PSAMV  D
"RTN","PSALEVRP",50,0)
 .I +$G(^PSD(58.8,PSAMV,"I")),+^PSD(58.8,PSAMV,"I")'>DT Q
"RTN","PSALEVRP",51,0)
 .S PSAMVN=PSAMVN+1,PSAMV($P(^PSD(58.8,PSAMV,0),"^"),PSAMV)=""
"RTN","PSALEVRP",52,0)
 G:'PSAMVN TEST
"RTN","PSALEVRP",53,0)
 ;
"RTN","PSALEVRP",54,0)
DISPMV ;Displays active master vaults
"RTN","PSALEVRP",55,0)
 W @IOF,!,"Choose one or many master vaults:",!
"RTN","PSALEVRP",56,0)
 S PSA=0,PSAMVA="" F  S PSAMVA=$O(PSAMV(PSAMVA)) Q:PSAMVA=""  D
"RTN","PSALEVRP",57,0)
 .S PSAMV=0 F  S PSAMV=$O(PSAMV(PSAMVA,PSAMV)) Q:'PSAMV  D
"RTN","PSALEVRP",58,0)
 ..S PSA=PSA+1,PSAVAULT(PSA,PSAMVA,PSAMV)="" W !,$J(PSA,2)_".",?4,PSAMVA
"RTN","PSALEVRP",59,0)
 K PSAMV
"RTN","PSALEVRP",60,0)
 ;
"RTN","PSALEVRP",61,0)
SELMV ;Select displayed master vaults
"RTN","PSALEVRP",62,0)
 W ! S DIR(0)="LO^1:"_PSA,DIR("A")="Select Master Vault",DIR("?")="Select the Master Vault that received the invoice's drugs",DIR("??")="^D MV^PSAPROC"
"RTN","PSALEVRP",63,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSALEVRP",64,0)
 G:Y="" TEST S PSASEL=Y
"RTN","PSALEVRP",65,0)
 F PSAPC=1:1 S PSA=+$P(PSASEL,",",PSAPC) Q:'PSA  D
"RTN","PSALEVRP",66,0)
 .S PSAMVA="",PSAMVA=$O(PSAVAULT(PSA,PSAMVA)) Q:PSAMVA=""
"RTN","PSALEVRP",67,0)
 .S PSAMVIEN=+$O(PSAVAULT(PSA,PSAMVA,0)) Q:'PSAMVIEN
"RTN","PSALEVRP",68,0)
 .S PSAMAST(PSAMVA,PSAMVIEN)=""
"RTN","PSALEVRP",69,0)
 K PSAVAULT
"RTN","PSALEVRP",70,0)
 ;
"RTN","PSALEVRP",71,0)
TEST G:PSAOUT EXIT
"RTN","PSALEVRP",72,0)
 S PSA=$O(PSALOC("")),PSAMV=$O(PSAMAST(""))
"RTN","PSALEVRP",73,0)
 I PSA="",PSAMV="" G EXIT
"RTN","PSALEVRP",74,0)
 ;
"RTN","PSALEVRP",75,0)
DEV ;Asks device & queueing info
"RTN","PSALEVRP",76,0)
 W !!,"Each pharmacy location can contain all drugs in the DRUG file. Therefore,",!,"this report could be very long. It is advised to queue the report to run",!,"during non-critical hours.",!
"RTN","PSALEVRP",77,0)
 K IO("Q") K %ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")=""
"RTN","PSALEVRP",78,0)
 D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSALEVRP",79,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSALEVRP",80,0)
 .N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK
"RTN","PSALEVRP",81,0)
 .S ZTRTN="COMPILE^PSALEVRP",ZTDESC="Drug Acct. - Stock and Reorder Report"
"RTN","PSALEVRP",82,0)
 .S:PSA'="" ZTSAVE("PSALOC(")="" S:PSAMV'="" ZTSAVE("PSAMAST(")=""
"RTN","PSALEVRP",83,0)
 .D ^%ZTLOAD
"RTN","PSALEVRP",84,0)
 ;
"RTN","PSALEVRP",85,0)
COMPILE ;Compiles data
"RTN","PSALEVRP",86,0)
 S PSA=$O(PSALOC("")) G:PSA="" MV
"RTN","PSALEVRP",87,0)
 S PSALOCN="" F  S PSALOCN=$O(PSALOC(PSALOCN)) Q:PSALOCN=""  D
"RTN","PSALEVRP",88,0)
 .S PSALOC=0 F  S PSALOC=$O(PSALOC(PSALOCN,PSALOC)) Q:'PSALOC  D
"RTN","PSALEVRP",89,0)
 ..S PSADRG=0 F  S PSADRG=+$O(^PSD(58.8,PSALOC,1,PSADRG)) Q:'PSADRG  D
"RTN","PSALEVRP",90,0)
 ...Q:'$D(^PSD(58.8,PSALOC,1,PSADRG,0))!($P($G(^PSDRUG(PSADRG,0)),"^")="")
"RTN","PSALEVRP",91,0)
 ...S ^TMP("PSALEV",$J,1,PSALOC,$P(^PSDRUG(PSADRG,0),"^"))=+$P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",3)_"^"_+$P(^(0),"^",5)
"RTN","PSALEVRP",92,0)
 ;
"RTN","PSALEVRP",93,0)
MV S PSA=$O(PSAMAST("")) G:PSA="" PRINT
"RTN","PSALEVRP",94,0)
 S PSAMVN="" F  S PSAMVN=$O(PSAMAST(PSAMVN)) Q:PSAMVN=""  D
"RTN","PSALEVRP",95,0)
 .S PSAMV=0 F  S PSAMV=$O(PSAMAST(PSAMVN,PSAMV)) Q:'PSAMV  D
"RTN","PSALEVRP",96,0)
 ..S PSADRG=0 F  S PSADRG=+$O(^PSD(58.8,PSAMV,1,PSADRG)) Q:'PSADRG  D
"RTN","PSALEVRP",97,0)
 ...Q:'$D(^PSD(58.8,PSAMV,1,PSADRG,0))!($P($G(^PSDRUG(PSADRG,0)),"^")="")
"RTN","PSALEVRP",98,0)
 ...S ^TMP("PSALEV",$J,2,PSAMV,$P(^PSDRUG(PSADRG,0),"^"))=+$P(^PSD(58.8,PSAMV,1,PSADRG,0),"^",3)_"^"_+$P(^(0),"^",5)
"RTN","PSALEVRP",99,0)
 ;
"RTN","PSALEVRP",100,0)
PRINT ;Prints report
"RTN","PSALEVRP",101,0)
 D NOW^%DTC S PSARUN=%,PSARUN=$E(PSARUN,4,5)_"/"_$E(PSARUN,6,7)_"/"_$E(PSARUN,2,3)_"@"_$E($P(PSARUN,".",2),1,2)_":"_$E($P(PSARUN,".",2),3,4)
"RTN","PSALEVRP",102,0)
 S PSAPG=0,PSASLN="",$P(PSASLN,"-",80)="",PSAOUT=0 K Y
"RTN","PSALEVRP",103,0)
 S PSAFIRST=1,PSALOC=0 F  S PSALOC=+$O(^TMP("PSALEV",$J,1,PSALOC)) Q:'PSALOC!(PSAOUT)  D
"RTN","PSALEVRP",104,0)
 .D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSALEVRP",105,0)
 .I PSAFIRST D HDR Q:PSAOUT  S PSAFIRST=0
"RTN","PSALEVRP",106,0)
 .S PSADRG="" F  S PSADRG=$O(^TMP("PSALEV",$J,1,PSALOC,PSADRG)) Q:PSADRG=""!(PSAOUT)  D
"RTN","PSALEVRP",107,0)
 ..I $Y+5>IOSL D HDR Q:PSAOUT
"RTN","PSALEVRP",108,0)
 ..S PSASTOCK=$P(^TMP("PSALEV",$J,1,PSALOC,PSADRG),"^"),PSAREORD=$P(^(PSADRG),"^",2)
"RTN","PSALEVRP",109,0)
 ..W !,PSADRG
"RTN","PSALEVRP",110,0)
 ..W ?(45-$L($P(PSASTOCK,".",2))),$J(PSASTOCK,9,+$L($P(PSASTOCK,".",2)))
"RTN","PSALEVRP",111,0)
 ..W ?(67-$L($P(PSAREORD,".",2))),$J(PSAREORD,9,+$L($P(PSAREORD,".",2)))
"RTN","PSALEVRP",112,0)
 ;
"RTN","PSALEVRP",113,0)
 S PSA=$O(^TMP("PSALEV",$J,2,"")) G:PSA="" EXIT
"RTN","PSALEVRP",114,0)
 S PSAFIRST=1,PSAMV=0
"RTN","PSALEVRP",115,0)
 F  S PSAMV=+$O(^TMP("PSALEV",$J,2,PSAMV)) Q:'PSAMV!(PSAOUT)  D  S PSAFIRST=1
"RTN","PSALEVRP",116,0)
 .I PSAFIRST D HDR Q:PSAOUT  S PSAFIRST=0
"RTN","PSALEVRP",117,0)
 .S PSADRG="" F  S PSADRG=$O(^TMP("PSALEV",$J,2,PSAMV,PSADRG)) Q:PSADRG=""!(PSAOUT)  D
"RTN","PSALEVRP",118,0)
 ..I $Y+5>IOSL D HDR Q:PSAOUT
"RTN","PSALEVRP",119,0)
 ..S PSASTOCK=$P(^TMP("PSALEV",$J,2,PSAMV,PSADRG),"^"),PSAREORD=$P(^(PSADRG),"^",2)
"RTN","PSALEVRP",120,0)
 ..W !,PSADRG
"RTN","PSALEVRP",121,0)
 ..W ?(45-$L($P(PSASTOCK,".",2))),$J(PSASTOCK,9,+$L($P(PSASTOCK,".",2)))
"RTN","PSALEVRP",122,0)
 ..W ?(67-$L($P(PSAREORD,".",2))),$J(PSAREORD,9,+$L($P(PSAREORD,".",2)))
"RTN","PSALEVRP",123,0)
 I 'PSAOUT,$E(IOST,1,2)="C-" S PSAOUT=1 D END^PSAPROC G:PSAOUT EXIT1
"RTN","PSALEVRP",124,0)
 ;
"RTN","PSALEVRP",125,0)
EXIT W:$E(IOST,1,2)="C-" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSALEVRP",126,0)
EXIT1 K IO("Q"),^TMP("PSALEV",$J)
"RTN","PSALEVRP",127,0)
 K %,%ZIS,DIR,DTOUT,DUOUT,PSA,PSACHK,PSACNT,PSACOMB,PSADRG,PSAFIRST,PSAISIT,PSAISITN,PSALOC,PSALOCA,PSALOCN,PSAMAST,PSAMENU,PSAMV,PSAMVA,PSAMVIEN,PSAMVN
"RTN","PSALEVRP",128,0)
 K PSANUM,PSAOSIT,PSAOSITN,PSAOUT,PSAPC,PSAPG,PSAREORD,PSARUN,PSASEL,PSASLN,PSASTOCK,PSAVAULT,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSALEVRP",129,0)
 Q
"RTN","PSALEVRP",130,0)
 ;
"RTN","PSALEVRP",131,0)
HDR ;Report header
"RTN","PSALEVRP",132,0)
 I $E(IOST,1,2)="C-" W:'PSAPG @IOF D:+PSAPG END^PSAPROC Q:PSAOUT
"RTN","PSALEVRP",133,0)
 I $E(IOST)'="C",+PSAPG W @IOF
"RTN","PSALEVRP",134,0)
 S PSAPG=PSAPG+1
"RTN","PSALEVRP",135,0)
 W !?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",?72,"PAGE "_PSAPG
"RTN","PSALEVRP",136,0)
 W !?25,"STOCK AND REORDER LEVEL REPORT",!
"RTN","PSALEVRP",137,0)
 I $E(IOST)'="C" W "RUN: "_PSARUN
"RTN","PSALEVRP",138,0)
 I $G(PSALOC) W ?31,"PHARMACY LOCATION" W:$L(PSALOCN)>79 !!,$P(PSALOCN,"(IP)",1)_"(IP)",!!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<80 !!,PSALOCN
"RTN","PSALEVRP",139,0)
 I $G(PSAMV) W !,"MASTER VAULT: "_$P($G(^PSD(58.8,PSAMV,0)),"^")
"RTN","PSALEVRP",140,0)
 W !!,"DRUG",?43,"STOCK LEVEL",?63,"REORDER LEVEL",!,PSASLN
"RTN","PSALEVRP",141,0)
 Q
"RTN","PSALFA")
0^26^B15382366
"RTN","PSALFA",1,0)
PSALFA ;BIR/LTL-Automated DRUG/ITEM MASTER file Link by FSN ;7/23/97
"RTN","PSALFA",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALFA",3,0)
 ;This routine automatically loops by FSN.
"RTN","PSALFA",4,0)
 ;
"RTN","PSALFA",5,0)
 D DT^DICRW
"RTN","PSALFA",6,0)
START ;sets up edit loop
"RTN","PSALFA",7,0)
 N D0,D1,DA,DIC,DIE,DLAYGO,DR,DTOUT,DUOUT,DIR,DIRUT,PSAD,PSADD,PSAF,PSAFSN,PSAIT,PSALN,PSAOUT,PSARPDT,PSAPG,X,Y
"RTN","PSALFA",8,0)
QUES S DIR(0)="Y",DIR("A")="Have you run the Report Potential FSN Matches option",DIR("??")="^D RUN^PSALFA",PSAOUT=1 D ^DIR K DIR G:$D(DIRUT) QUIT D:'Y
"RTN","PSALFA",9,0)
 .S DIR(0)="Y",DIR("A")="Would you like to run the report now",DIR("B")="Yes" D ^DIR K DIR D:Y ^PSALFS
"RTN","PSALFA",10,0)
 S DIR(0)="Y",DIR("A")="Are you ready to link ALL of the drugs that have matches in the ITEM MASTER file",DIR("B")="No" D ^DIR K DIR G:'Y QUIT
"RTN","PSALFA",11,0)
DEV ;asks device and queueing info
"RTN","PSALFA",12,0)
 W !,"I'll list each DRUG/ITEM MASTER file entry as they're linked.",!
"RTN","PSALFA",13,0)
 K IO("Q") N %ZIS,%ZIS,IOP,POP S %ZIS="0Q",%ZIS("A")="Please select DEVICE for output: " D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G QUIT
"RTN","PSALFA",14,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="LOOP^PSALFA",ZTDESC="Linking DRUG/ITEM FILE by FSN" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G QUIT
"RTN","PSALFA",15,0)
LOOP S (PSAD,PSAPG,PSAOUT)=0,Y=DT D DD^%DT S PSARPDT=Y,Y=1 D HEADER
"RTN","PSALFA",16,0)
 F  S PSAD=$O(^PSDRUG(PSAD)) G:'PSAD QUIT D:$Y+4>IOSL HEADER G:PSAOUT QUIT I $P($G(^PSDRUG(PSAD,0)),U,6)]"",'$O(^PSDRUG(PSAD,441,0)),'$D(^PSDRUG(PSAD,"I")) D
"RTN","PSALFA",17,0)
FORM .S PSAFSN=$P(^PSDRUG(PSAD,0),U,6) W !,PSAFSN D
"RTN","PSALFA",18,0)
 ..I $O(^PRC(441,"BB",PSAFSN,0)) N PSADD S PSAIT=$O(^PRC(441,"BB",PSAFSN,0)) D  W !,$E($P(^PSDRUG(PSAD,0),U),1,39),?40,$E($$DESCR^PRCPUX1(0,PSAIT),1,39),! D:'$D(PSADD) LINK
"RTN","PSALFA",19,0)
USED ...I $O(^PSDRUG("AB",PSAIT,"")) S PSADD=$O(^PSDRUG("AB",PSAIT,"")) W !,"**"_$P(^PSDRUG(PSADD,0),U)_" is already linked to Item #"_PSAIT_"**"
"RTN","PSALFA",20,0)
INAC ...I $E($G(^PRC(441,PSAIT,3)),1)=1 W !,"Sorry, Item #"_PSAIT_" is INACTIVE, can't link.",! S PSADD=""
"RTN","PSALFA",21,0)
QUIT W:$E(IOST)'="C" @IOF
"RTN","PSALFA",22,0)
 I $E(IOST,1,2)="C-",'PSAOUT W !! S DIR(0)="E",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR
"RTN","PSALFA",23,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q") Q
"RTN","PSALFA",24,0)
LINK S DIE=50,DA=PSAD,DR="441///^S X=PSAIT" D ^DIE W "Linked to Item #"_PSAIT Q
"RTN","PSALFA",25,0)
HEADER ;prints header info
"RTN","PSALFA",26,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSALFA",27,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSALFA",28,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !?2,"Linking DRUG/ITEM MASTER file by FSN",?55,PSARPDT,?70,"PAGE: "_PSAPG,!,PSALN,!,"DRUG file",?40,"ITEM MASTER file"
"RTN","PSALFA",29,0)
 Q
"RTN","PSALFA",30,0)
READY ;Extended help for 'Have you run the Report Potential FSN Matches option?'
"RTN","PSALFA",31,0)
 W !?5,"Enter YES to begin linking every drug that has been matched.",!?5,"Enter NO to exit the option."
"RTN","PSALFA",32,0)
 Q
"RTN","PSALFA",33,0)
RUN ;Extended help to 'Have you run the Report Potential FSN Matches option?'
"RTN","PSALFA",34,0)
 W !?5,"Enter YES if you have run the Report Potential FSN Matches option",!?5,"and produced a report.",!!?5,"Enter NO if you have not run the option.  You will be given the",!?5,"opportunity to run the report now."
"RTN","PSALFA",35,0)
 Q 
"RTN","PSALFM")
0^27^B6434024
"RTN","PSALFM",1,0)
PSALFM ;BIR/LTL-Controlled Connection by FSN Match ;7/23/97
"RTN","PSALFM",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALFM",3,0)
 ;
"RTN","PSALFM",4,0)
 D DT^DICRW
"RTN","PSALFM",5,0)
START ;compiles data for edit
"RTN","PSALFM",6,0)
EXPL W !,"I'll loop through the FSNs in your DRUG file.",!,"If I find a match in the ITEM MASTER file, I'll let you know.",!
"RTN","PSALFM",7,0)
 N D0,D1,DA,DIC,DIE,DIR,DIRUT,DIW,DIWF,DIWL,DIWR,DIWT,DLAYGO,DR,DTOUT,DUOUT,PSA,PSAD,PSADD,PSAF,PSAFSN,PSAIT,PSAOUT,X,Y S (PSA,PSAD)=0
"RTN","PSALFM",8,0)
LOOP F  S PSAD=$O(^PSDRUG(PSAD)) G:'PSAD!($D(PSAOUT)) END I $P($G(^PSDRUG(PSAD,0)),U,6)]"",'$O(^PSDRUG(PSAD,441,0)),'$D(^PSDRUG(PSAD,"I")) D  G:$G(PSAOUT) END
"RTN","PSALFM",9,0)
 .I $Y+5>IOSL S DIR(0)="E" D ^DIR K DIR S:'Y PSAOUT=1 W @IOF Q
"RTN","PSALFM",10,0)
FORM .S PSAFSN=$P(^PSDRUG(PSAD,0),U,6) W !,PSAFSN D:$O(^PRC(441,"BB",PSAFSN,0))
"RTN","PSALFM",11,0)
 ..N PSADD S PSAIT=$O(^PRC(441,"BB",PSAFSN,"")) D  W !,$E($P(^PSDRUG(PSAD,0),U),1,39)
"RTN","PSALFM",12,0)
USED ...I $O(^PSDRUG("AB",PSAIT,"")) S PSADD=$O(^PSDRUG("AB",PSAIT,"")) W !,"**"_$P(^PSDRUG(PSADD,0),U)_" is already linked to Item #"_PSAIT_"**"
"RTN","PSALFM",13,0)
INAC ...I $E($G(^PRC(441,PSAIT,3)),1)=1 W !,"Sorry, Item #"_PSAIT_" is INACTIVE, can't link.",! S PSADD=""
"RTN","PSALFM",14,0)
 ..I $L($G(^PRC(441,+PSAIT,1,1,0)))<40,'$O(^PRC(441,+PSAIT,1,1)) W ?40,$G(^PRC(441,+PSAIT,1,1,0)),! G SH
"RTN","PSALFM",15,0)
 ..K ^UTILITY($J,"W") S DIWL=40,DIWR=80,DIWF="W"
"RTN","PSALFM",16,0)
 ..F  S PSA=$O(^PRC(441,+PSAIT,1,PSA)) Q:'PSA  S X=$G(^PRC(441,+PSAIT,1,PSA,0)) D ^DIWP
"RTN","PSALFM",17,0)
 ..D ^DIWW S PSA=0
"RTN","PSALFM",18,0)
SH ..D:'$D(PSADD) OFFER
"RTN","PSALFM",19,0)
END I '$G(PSAOUT) S DIR(0)="EA",DIR("A")="Done with FSN's.  Press <RET> to return to the menu." D ^DIR
"RTN","PSALFM",20,0)
QUIT Q
"RTN","PSALFM",21,0)
OFFER S DIR(0)="Y",DIR("A")="Do we have a match",DIR("B")="Yes" D ^DIR K DIR S:$D(DIRUT) PSAOUT=1 Q:'Y  D
"RTN","PSALFM",22,0)
OK S DIE=50,DA=PSAD,DR="441///^S X=PSAIT" D ^DIE W "  Linked to Item #"_PSAIT
"RTN","PSALFS")
0^28^B9346895
"RTN","PSALFS",1,0)
PSALFS ;BIR/LTL-Report Potential FSN Matches ;7/23/97
"RTN","PSALFS",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALFS",3,0)
 ;
"RTN","PSALFS",4,0)
 D DT^DICRW
"RTN","PSALFS",5,0)
DEV ;asks device and queueing info
"RTN","PSALFS",6,0)
 K IO("Q") N %ZIS,DTOUT,DUOUT,IOP,POP,PSAOUT S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSAOUT=1 G QUIT
"RTN","PSALFS",7,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSALFS",ZTDESC="Unlinked DRUG/ITEM FILE matches by FSN" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G QUIT
"RTN","PSALFS",8,0)
START ;compiles and prints data for report
"RTN","PSALFS",9,0)
 N DIR,DIRUT,PSAPG,POP,PSA,PSAD,PSADD,PSAF,PSAFSN,PSAIT,PSALN,PSARPDT,X,Y S (PSA,PSAD,PSAPG,PSAOUT)=0,Y=DT D DD^%DT S PSARPDT=Y D HEADER
"RTN","PSALFS",10,0)
LOOP F  S PSAD=$O(^PSDRUG(PSAD)) G:'PSAD QUIT D:$Y+4>IOSL HEADER G:PSAOUT QUIT I $P($G(^PSDRUG(PSAD,0)),U,6)]"",'$O(^PSDRUG(PSAD,441,0)),'$D(^PSDRUG(PSAD,"I")) D
"RTN","PSALFS",11,0)
 .W !!,$P($G(^PSDRUG(+PSAD,0)),U),!
"RTN","PSALFS",12,0)
FORM .S PSAFSN=$P(^PSDRUG(PSAD,0),U,6) W !,PSAFSN S PSAIT=$O(^PRC(441,"BB",PSAFSN,0)) W:'PSAIT ?40,"No matching NSN in ITEM MASTER file" Q:'PSAIT  D
"RTN","PSALFS",13,0)
 ..D
"RTN","PSALFS",14,0)
USED ...I $O(^PSDRUG("AB",PSAIT,"")) S PSADD=$O(^PSDRUG("AB",PSAIT,"")) W !,"**"_$P(^PSDRUG(PSADD,0),U)_" is already linked to Item #"_PSAIT_"**"
"RTN","PSALFS",15,0)
 ...W ?40,"ITEM Number:  "_PSAIT,!
"RTN","PSALFS",16,0)
 ..I $L($G(^PRC(441,+PSAIT,1,1,0)))<40,'$O(^PRC(441,+PSAIT,1,1)) W ?40,$G(^PRC(441,+PSAIT,1,1,0)),! Q
"RTN","PSALFS",17,0)
 ..K ^UTILITY($J,"W") S DIWL=40,DIWR=80,DIWF="W"
"RTN","PSALFS",18,0)
 ..F  S PSA=$O(^PRC(441,+PSAIT,1,PSA)) Q:'PSA  S X=$G(^PRC(441,+PSAIT,1,PSA,0)) D ^DIWP
"RTN","PSALFS",19,0)
 ..D ^DIWW S PSA=0
"RTN","PSALFS",20,0)
QUIT I $E(IOST)'="C" W @IOF
"RTN","PSALFS",21,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSALFS",22,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSALFS",23,0)
 Q
"RTN","PSALFS",24,0)
HEADER ;prints header info
"RTN","PSALFS",25,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSALFS",26,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSALFS",27,0)
 W:$Y @IOF S $P(PSALN,"*",81)="",PSAPG=PSAPG+1 W !?2,"Unlinked DRUG/ITEM MASTER file entries by common FSN",?55,PSARPDT,?70,"PAGE: "_PSAPG,!,PSALN,!,"DRUG file FSN",?40,"ITEM MASTER file"
"RTN","PSALFS",28,0)
 Q
"RTN","PSALNA")
0^29^B16278285
"RTN","PSALNA",1,0)
PSALNA ;BIR/LTL-Automated DRUG/ITEM MASTER file Link by NDC ;7/23/97
"RTN","PSALNA",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALNA",3,0)
 D DT^DICRW
"RTN","PSALNA",4,0)
START ;sets up edit loop
"RTN","PSALNA",5,0)
 N D0,D1,DA,DIC,DIE,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,PSAD,PSADD,PSAIT,PSALN,PSAOUT,PSAPG,PSARPDT,X,Y
"RTN","PSALNA",6,0)
QUES S DIR(0)="Y",DIR("A")="Have you run the Report Potential NDC Matches option",DIR("??")="^D RUN^PSALNA",PSAOUT=1 D ^DIR K DIR G:$D(DIRUT) QUIT D:Y<1  G:PSAOUT QUIT
"RTN","PSALNA",7,0)
 .S DIR(0)="Y",DIR("A")="Would you like to run the report now",DIR("B")="YES",DIR("??")="^D NOW^PSALNA" D ^DIR K DIR S:$G(DIRUT) PSAOUT=1 I Y D ^PSALND S PSAOUT=0
"RTN","PSALNA",8,0)
 W ! S DIR(0)="Y",DIR("A",1)="Are you ready to link ALL of the drugs",DIR("A")="that have matches in the ITEM MASTER file",DIR("B")="N",DIR("??")="^D READY^PSALNA"
"RTN","PSALNA",9,0)
 D ^DIR K DIR G:'Y!($G(DIRUT)) QUIT
"RTN","PSALNA",10,0)
DEV ;asks device and queueing info
"RTN","PSALNA",11,0)
 W !!,"I'll list each DRUG/ITEM MASTER file entry as they're linked.",!
"RTN","PSALNA",12,0)
 K IO("Q") N %ZIS,%ZIS,IOP,POP S %ZIS="0Q",%ZIS("A")="Please select DEVICE for output: " D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G QUIT
"RTN","PSALNA",13,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="LOOP^PSALNA",ZTDESC="Linking DRUG/ITEM FILE by NDC" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G QUIT
"RTN","PSALNA",14,0)
LOOP S (PSAD,PSAPG,PSAOUT)=0,Y=DT D DD^%DT S PSARPDT=Y,Y=1 D HEADER
"RTN","PSALNA",15,0)
 F  K PSADD S PSAD=$O(^PSDRUG(PSAD)) G:'PSAD QUIT D:$Y+4>IOSL HEADER G:PSAOUT QUIT W:'(PSAD#100) "." I $P($G(^PSDRUG(PSAD,2)),U,4)]"" S PSAD(1)=$P($G(^(2)),U,4) D:'$D(^PSDRUG(PSAD,"I"))
"RTN","PSALNA",16,0)
 .S PSAIT=$$ITEM^PSAUTL(PSAD(1)) Q:'PSAIT  I $D(^PRC(441,+PSAIT,0)) D  Q:$D(PSADD)  W !,$E($P(^PSDRUG(PSAD,0),U),1,39),?40,$E($P(^PRC(441,PSAIT,0),U,2),1,39),!
"RTN","PSALNA",17,0)
NOT ..S:$O(^PSDRUG("AB",PSAIT,"")) PSADD="" I $D(^PRC(441,PSAIT,3)),$P(^(3),U)=1 S PSADD=""
"RTN","PSALNA",18,0)
OK .I '$D(PSADD) S DIE=50,DA=PSAD,DR="441///^S X=PSAIT" D ^DIE W "Linked to Item #"_PSAIT
"RTN","PSALNA",19,0)
QUIT I $E(IOST)'="C" W @IOF
"RTN","PSALNA",20,0)
 I $E(IOST,1,2)="C-",'PSAOUT W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSALNA",21,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q") Q
"RTN","PSALNA",22,0)
HEADER ;prints header info
"RTN","PSALNA",23,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSALNA",24,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSALNA",25,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !?2,"Linking DRUG/ITEM MASTER file by NDC",?55,PSARPDT,?70,"PAGE: "_PSAPG,!,PSALN,!,"DRUG file",?40,"ITEM MASTER file"
"RTN","PSALNA",26,0)
 Q
"RTN","PSALNA",27,0)
NOW ;Extended help to 'Would you like to run the report now?'
"RTN","PSALNA",28,0)
 W !?5,"Enter YES if you want to print the report now.",!!?5,"Enter NO if you do not want to run the report now.",!?5,"You will not exit the option."
"RTN","PSALNA",29,0)
 Q
"RTN","PSALNA",30,0)
READY ;Extended help to 'Are you ready to link ALL of the drugs that have matches in the ITEM MASTER file?'
"RTN","PSALNA",31,0)
 W !?5,"Enter YES to begin linking every drug that has been matched.",!?5,"Enter NO to exit the option."
"RTN","PSALNA",32,0)
 Q
"RTN","PSALNA",33,0)
RUN ;Extended help to 'Have you run the Report Potential NDC Matches option?'
"RTN","PSALNA",34,0)
 W !?5,"Enter YES if you have run the Report Potential NDC Matches option",!?5,"and produced a report.",!!?5,"Enter NO if you have not run the option. You will be given the",!?5,"opportunity to run the report now."
"RTN","PSALNA",35,0)
 Q 
"RTN","PSALND")
0^30^B9745215
"RTN","PSALND",1,0)
PSALND ;BIR/LTL-Report Potential NDC Matches ;7/23/97
"RTN","PSALND",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALND",3,0)
 ;
"RTN","PSALND",4,0)
 D DT^DICRW
"RTN","PSALND",5,0)
DEV ;asks device and queueing info
"RTN","PSALND",6,0)
 K IO("Q") N %ZIS,DIR,DTOUT,DUOUT,IOP,POP,PSAOUT S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSAOUT=1 G QUIT
"RTN","PSALND",7,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSALND",ZTDESC="Unlinked DRUG/ITEM FILE matches by NDC" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G QUIT
"RTN","PSALND",8,0)
START ;compiles and prints data for report
"RTN","PSALND",9,0)
 N DIRUT,PSAPG,POP,PSA,PSAB,PSAD,PSADD,PSAIT,PSALN,PSARPDT,X,Y S (PSA,PSAD,PSAPG,PSAOUT)=0,Y=DT D DD^%DT S PSARPDT=Y D HEADER
"RTN","PSALND",10,0)
LOOP F  S PSAD=$O(^PSDRUG(PSAD)) G:'PSAD QUIT D:$Y+7>IOSL HEADER G:PSAOUT QUIT W:'(PSAD#100) "." I $P($G(^PSDRUG(PSAD,2)),U,4)]"" S PSAD(1)=$P($G(^(2)),U,4) D:'$D(^PSDRUG(PSAD,"I"))  G:$G(PSAOUT) QUIT
"RTN","PSALND",11,0)
 .S PSAIT=$$ITEM^PSAUTL(PSAD(1))
"RTN","PSALND",12,0)
 .Q:'PSAIT!($O(^PSDRUG(PSAD,441,"B",+PSAIT,0)))
"RTN","PSALND",13,0)
 .I $D(^PRC(441,PSAIT,0)) D:$O(^PSDRUG("AB",PSAIT,0))
"RTN","PSALND",14,0)
USED ..S PSADD=$O(^PSDRUG("AB",PSAIT,"")) W !,"**"_$P(^PSDRUG(PSADD,0),U)_" is already linked to Item #"_PSAIT_"**"
"RTN","PSALND",15,0)
 .W !!,"NDC:  "_$P(^PSDRUG(PSAD,2),U,4),?40,"Item Number:  "_$P(^PRC(441,PSAIT,0),U),!
"RTN","PSALND",16,0)
 .W !,$E($P(^PSDRUG(PSAD,0),U),1,39)
"RTN","PSALND",17,0)
 .I $L($G(^PRC(441,+PSAIT,1,1,0)))<40,'$O(^PRC(441,+PSAIT,1,1)) W ?40,$G(^PRC(441,+PSAIT,1,1,0)) Q
"RTN","PSALND",18,0)
 .K ^UTILITY($J,"W") S DIWL=40,DIWR=80,DIWF="W"
"RTN","PSALND",19,0)
 .F  S PSA=$O(^PRC(441,+PSAIT,1,+PSA)) Q:'PSA  S X=$G(^PRC(441,+PSAIT,1,+PSA,0)) D:$Y+3>IOSL HEADER Q:$G(PSAOUT)  D ^DIWP D ^DIWW
"RTN","PSALND",20,0)
 .S PSA=0
"RTN","PSALND",21,0)
QUIT I $E(IOST)'="C" W @IOF
"RTN","PSALND",22,0)
 I $E(IOST,1,2)="C-",'PSAOUT W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSALND",23,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSALND",24,0)
 Q
"RTN","PSALND",25,0)
HEADER ;prints header info
"RTN","PSALND",26,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSALND",27,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSALND",28,0)
 W:$Y @IOF S $P(PSALN,"*",81)="",PSAPG=PSAPG+1 W !?2,"Unlinked DRUG/ITEM MASTER file entries by common NDC",?55,PSARPDT,?70,"PAGE: "_PSAPG,!,PSALN,!,"DRUG file",?40,"ITEM MASTER file"
"RTN","PSALND",29,0)
 W:$G(PSA)&($O(^PRC(441,+$G(PSAIT),1,+$G(PSA)))) !,$P(^PSDRUG(PSAD,0),U)," continued"
"RTN","PSALND",30,0)
 Q
"RTN","PSALNM")
0^31^B4238211
"RTN","PSALNM",1,0)
PSALNM ;BIR/LTL-NDC Duplicates Report (ITEM MASTER file) ;7/23/97
"RTN","PSALNM",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALNM",3,0)
 ;This routine manually loops through the DRUG file for any unmatched
"RTN","PSALNM",4,0)
 ;entries that have an NDC link to an item in the ITEM MASTER file.
"RTN","PSALNM",5,0)
 ;
"RTN","PSALNM",6,0)
 D DT^DICRW
"RTN","PSALNM",7,0)
START ;sets up edit loop
"RTN","PSALNM",8,0)
 N D0,D1,DA,DIC,DIE,DLAYGO,DR,DTOUT,DUOUT,DIRUT,PSA,PSAD,PSADD,PSAIT,X,Y S (PSA,PSAD)=0,Y=1
"RTN","PSALNM",9,0)
EXPL W !,"I'll look through your DRUG file for any unmatched entries that have",!,"an NDC link to an item in the ITEM MASTER file.",!
"RTN","PSALNM",10,0)
LOOP F  K PSADD S PSAD=$O(^PSDRUG(PSAD)) G:'PSAD!($D(DIRUT)) QUIT I $P($G(^PSDRUG(PSAD,2)),U,4)]"" S PSAD(1)=$P($G(^(2)),U,4) D:'$D(^PSDRUG(PSAD,"I"))
"RTN","PSALNM",11,0)
 .S PSAIT=$$ITEM^PSAUTL(PSAD(1)) Q:'PSAIT  I $D(^PRC(441,+PSAIT,0)) D  Q:$D(PSADD)  W !,$E($P(^PSDRUG(PSAD,0),U),1,39)
"RTN","PSALNM",12,0)
NOT ..S:$O(^PSDRUG("AB",PSAIT,"")) PSADD="" I $D(^PRC(441,PSAIT,3)),$P(^(3),U)=1 S PSADD=""
"RTN","PSALNM",13,0)
 .I $L($G(^PRC(441,+PSAIT,1,1,0)))<40,'$O(^PRC(441,+PSAIT,1,1)) W ?40,$G(^PRC(441,+PSAIT,1,1,0)) G ED
"RTN","PSALNM",14,0)
 .K ^UTILITY($J,"W") S DIWL=40,DIWR=80,DIWP="W"
"RTN","PSALNM",15,0)
 .F  S PSA=$O(^PRC(441,+PSAIT,1,PSA)) Q:'PSA  S X=$G(^PRC(441,+PSAIT,1,+PSA,0)) D ^DIWP D ^DIWW
"RTN","PSALNM",16,0)
 .S PSA=0
"RTN","PSALNM",17,0)
ED .S DIR(0)="Y",DIR("A")="Do we have a match",DIR("B")="Yes" W ! D ^DIR K DIR W ! Q:Y<1  D
"RTN","PSALNM",18,0)
OK ..S DIE=50,DA=PSAD,DR="441///^S X=PSAIT" D ^DIE W "  Linked to Item #"_PSAIT
"RTN","PSALNM",19,0)
QUIT Q
"RTN","PSALOG")
0^32^B23075878
"RTN","PSALOG",1,0)
PSALOG ;BIR/LTL,JMB-Unposted Procurement History ;7/23/97
"RTN","PSALOG",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALOG",3,0)
 ;This routine gets the user specifications to print the Unposted
"RTN","PSALOG",4,0)
 ;Procurement History report for a specific month, the Item Total report,
"RTN","PSALOG",5,0)
 ;and High Dollar report. It calls PSALOG0 and PSALOG1.
"RTN","PSALOG",6,0)
 ;
"RTN","PSALOG",7,0)
 ;Get month
"RTN","PSALOG",8,0)
 D DT^DICRW S %DT="AEP",%DT("A")="Select month: ",%DT("B")="T-1M"
"RTN","PSALOG",9,0)
 D ^%DT S PSAYRMO=$E(Y,1,5)*100,PSAMO=$E(PSAYRMO,4,5) G:Y<0 EXIT
"RTN","PSALOG",10,0)
 X ^DD("DD") S PSAMOYR=$E(Y,1,3)_" '"_$E(PSAYRMO,2,3)
"RTN","PSALOG",11,0)
 ;
"RTN","PSALOG",12,0)
 S DIR(0)="Y",DIR("A")="Print item totals",DIR("B")="Yes",DIR("?",1)="Enter yes to print a report of the items ordered during the selected month.",DIR("?")="Enter no if you do not want to print the report."
"RTN","PSALOG",13,0)
 S DIR("??")="^D HELPTOT^PSALOG" W ! D ^DIR K DIR G:$G(DIRUT) EXIT S PSATOTAL=Y
"RTN","PSALOG",14,0)
 ;
"RTN","PSALOG",15,0)
 S DIR(0)="Y",DIR("A")="Print a high dollar items report",DIR("B")="Yes",DIR("?",1)="Enter yes to print a list of purchased items that cost a high",DIR("?")="dollar amount. Enter no if you do not want to print the report."
"RTN","PSALOG",16,0)
 S DIR("??")="^D HELPHIGH^PSALOG" W ! D ^DIR K DIR G:$G(DIRUT) EXIT G:'Y DEVICE S PSAHIGH=Y
"RTN","PSALOG",17,0)
 ;
"RTN","PSALOG",18,0)
 S DIR(0)="N",DIR("A")="Enter the lowest dollar amount to print $",DIR("B")=1000,DIR("?",1)="Enter the lowest dollar amount to be printed.",DIR("?")="Do not enter the dollar sign($).",DIR("??")="^D HELPLOW^PSALOG"
"RTN","PSALOG",19,0)
 W ! D ^DIR K DIR G:$G(DIRUT) EXIT S:Y PSALOW=Y
"RTN","PSALOG",20,0)
 ;
"RTN","PSALOG",21,0)
DEVICE W ! K IO("Q") S %ZIS="0Q" D ^%ZIS
"RTN","PSALOG",22,0)
 I POP W !,"No device selected or report printed!" G EXIT
"RTN","PSALOG",23,0)
 I $D(IO("Q")) S ZTRTN="QUE^PSALOG",ZTDESC="Drug Accountability - Unposted Pharmacy Procurement Reports",ZTSAVE("PSA*")="" D ^%ZTLOAD
"RTN","PSALOG",24,0)
 I  G:$D(ZTSK) EXIT I '$D(ZTSK) W !,"The report was not sent to the printer." G EXIT
"RTN","PSALOG",25,0)
QUE ;Calls routines to print the 3 reports.
"RTN","PSALOG",26,0)
 U IO K ^TMP("PSA",$J),^TMP("PSAB",$J),^TMP("PSAC",$J)
"RTN","PSALOG",27,0)
 S PSASTART=1
"RTN","PSALOG",28,0)
 D ^PSALOG0 G:PSAOUT EXIT
"RTN","PSALOG",29,0)
 I $G(PSATOTAL) D ^PSALOG1 G:PSAOUT EXIT
"RTN","PSALOG",30,0)
 D:$G(PSAHIGH) ^PSALOG1H
"RTN","PSALOG",31,0)
EXIT W:$G(PSASTART) @IOF
"RTN","PSALOG",32,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSALOG",33,0)
 K IO("Q"),^TMP("PSA",$J),^TMP("PSAB",$J),^TMP("PSAC",$J)
"RTN","PSALOG",34,0)
 K %DT,%ZIS,DIR,DIRUT,PSAC,PSACP,PSADATE,PSADLN,PSADT,PSAFCP,PSAHIGH,PSAIEN,PSAINVO,PSAITEM,PSAKK,PSALOW,PSAMO,PSAMORE,PSAMOYR,PSAN0,PSAN1,PSAOUT,PSAPG
"RTN","PSALOG",35,0)
 K PSAQTYO,PSAQTYP,PSARPDT,PSASLN,PSASTART,PSATMP,PSATOT,PSATOTAL,PSATOTO,PSATOTP,PSATOTR,PSATQTYO,PSAUNIT,PSAYRMO,PSASS,X,X2,X3,Y,ZTDESC,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE
"RTN","PSALOG",36,0)
 Q
"RTN","PSALOG",37,0)
HELPTOT ;Extended help for "Print item totals?"
"RTN","PSALOG",38,0)
 W !!,"Enter yes to print a report of the items purchased during the selected",!,"month. The report contains the total dollar amount per item per purchase"
"RTN","PSALOG",39,0)
 W !,"order. The report lists the purchase order number, date ordered quantity,",!,"ordered, quantity received, dollar amount per dispensed unit, dispensed"
"RTN","PSALOG",40,0)
 W !,"unit, total order cost, and total cost of items received."
"RTN","PSALOG",41,0)
 W !!,"Enter no if you do not want to print the report."
"RTN","PSALOG",42,0)
 Q
"RTN","PSALOG",43,0)
HELPHIGH ;Extended help for "Print a high dollar items report?"
"RTN","PSALOG",44,0)
 W !!,"Enter yes to choose a cut-off dollar amount and print the report.",!,"The report lists the items from highest to lowest dollar amounts."
"RTN","PSALOG",45,0)
 Q
"RTN","PSALOG",46,0)
HELPLOW ;Extended help for "Enter the lowest dollar amount to print $"
"RTN","PSALOG",47,0)
 W !!,"Enter the lowest dollar amount paid for an order of an item. The",!,"dollar amount is the total amount paid for the item on a purchase order."
"RTN","PSALOG",48,0)
 W !,"For example, if a drug cost $500 per unit and 3 units were ordered, the",!,"total dollar amount is $1500. In order to print this item on the report,",!,"the lowest dollar amount to print must be $1500 or less."
"RTN","PSALOG",49,0)
 Q
"RTN","PSALOG0")
0^33^B9534043
"RTN","PSALOG0",1,0)
PSALOG0 ;BIR/LTL,JMB-Unposted Procurement History - CONT'D ;7/23/97
"RTN","PSALOG0",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALOG0",3,0)
 ;This routine prints the Unposted Pharmacy Procurement report. It is
"RTN","PSALOG0",4,0)
 ;called from PSALOG.
"RTN","PSALOG0",5,0)
 ;
"RTN","PSALOG0",6,0)
POS S (PSAPG,PSAOUT)=0,$P(PSASLN,"-",81)="",$P(PSADLN,"=",81)=""
"RTN","PSALOG0",7,0)
 S PSARPDT=$E($$HTFM^XLFDT($H),1,12),PSADT=$P(PSARPDT,".")
"RTN","PSALOG0",8,0)
 S PSARPDT=$E(PSADT,4,5)_"/"_$E(PSADT,6,7)_"/"_$E(PSADT,2,3)_"@"_$P(PSARPDT,".",2)
"RTN","PSALOG0",9,0)
 D HDR G:PSAOUT END
"RTN","PSALOG0",10,0)
RT F  S PSAYRMO=$O(^PRC(442,"AB",PSAYRMO)) Q:'PSAYRMO!($E(PSAYRMO,4,5)'=PSAMO)  S PSAIEN="" D
"RTN","PSALOG0",11,0)
 .F  S PSAIEN=+$O(^PRC(442,"AB",PSAYRMO,PSAIEN)) Q:'PSAIEN  I $P($G(^PRC(442,PSAIEN,0)),"^",5)=822400,$P($G(^PRC(442,PSAIEN,7)),"^")>14&($P($G(^(7)),"^")<45) D
"RTN","PSALOG0",12,0)
 ..S ^TMP("PSAB",$J,$E($P($G(^PRC(442,PSAIEN,0)),"^"),1,3)_$E($P($G(^PRC(442,PSAIEN,0)),"^",3),1,4),PSAIEN)=""
"RTN","PSALOG0",13,0)
RTD I '$D(^TMP("PSAB",$J)) W !!,"No items were found for the selected month." G END
"RTN","PSALOG0",14,0)
 S PSACP=""
"RTN","PSALOG0",15,0)
 F  S PSACP=$O(^TMP("PSAB",$J,PSACP)) Q:PSACP=""  D:$Y+4>IOSL HDR G:PSAOUT END W !!,"STATION/CP: ",PSACP S PSAIEN=0 F  S PSAIEN=+$O(^TMP("PSAB",$J,PSACP,PSAIEN)) Q:'PSAIEN  D:$Y+4>IOSL HDR G:PSAOUT END  D
"RTN","PSALOG0",16,0)
 .S PSAN0=$G(^PRC(442,PSAIEN,0))
"RTN","PSALOG0",17,0)
 .W !,$E($P(PSAN0,"^"),5,10)
"RTN","PSALOG0",18,0)
 .S PSAN1=$G(^PRC(442,PSAIEN,1)),PSADT=$P(PSAN1,"^",15)
"RTN","PSALOG0",19,0)
 .S Y=PSADT X ^DD("DD") W ?10,Y
"RTN","PSALOG0",20,0)
 .W ?22,$E($P(PSAN0,"^",3),1,3),?27,$E($$VENNAME^PRCPUX1($P(PSAN1,"^")_"PRC(440"),1,30)
"RTN","PSALOG0",21,0)
 .S X=$P(PSAN0,"^",15),PSATOT=$G(PSATOT)+X,X2="2$",X3=10 D COMMA^%DTC
"RTN","PSALOG0",22,0)
 .W ?69,X
"RTN","PSALOG0",23,0)
 .Q:'$D(^PRC(442,PSAIEN,2,0))  S PSAITEM=0
"RTN","PSALOG0",24,0)
 .F  S PSAITEM=+$O(^PRC(442,PSAIEN,2,PSAITEM)) Q:'PSAITEM  D
"RTN","PSALOG0",25,0)
 ..S:$G(^PRC(442,PSAIEN,2,PSAITEM,1,1,0))]"" ^TMP("PSA",$J,PSACP,$E($G(^PRC(442,PSAIEN,2,PSAITEM,1,1,0)),1,65),PSAIEN)=$G(^PRC(442,PSAIEN,2,PSAITEM,0))
"RTN","PSALOG0",26,0)
 .I $G(PSATOT),'$O(^TMP("PSAB",$J,PSACP,PSAIEN)) S X=PSATOT,X2="2$",X3=10 D COMMA^%DTC S PSACOST=X D  Q:PSAOUT
"RTN","PSALOG0",27,0)
 ..D:$Y+5>IOSL HDR Q:PSAOUT
"RTN","PSALOG0",28,0)
 ..W !,PSADLN,!,?57,"TOTAL COST: ",PSACOST K PSATOT
"RTN","PSALOG0",29,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSALOG0",30,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) D
"RTN","PSALOG0",31,0)
 .S PSASS=22-$Y F PSAKK=1:1:PSASS W !
"RTN","PSALOG0",32,0)
 .S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to continue." D ^DIR K DIR S:'Y PSAOUT=1
"RTN","PSALOG0",33,0)
 Q
"RTN","PSALOG0",34,0)
HDR I $E(IOST,1,2)="C-",PSAPG D  Q:PSAOUT
"RTN","PSALOG0",35,0)
 .S PSASS=22-$Y F PSAKK=1:1:PSASS W !
"RTN","PSALOG0",36,0)
 .S DIR(0)="E" D ^DIR K DIR S:'Y PSAOUT=1
"RTN","PSALOG0",37,0)
 I $$S^%ZTLOAD S PSAOUT=1 Q
"RTN","PSALOG0",38,0)
 W:$Y @IOF S PSAPG=PSAPG+1
"RTN","PSALOG0",39,0)
 W:$E(IOST)'="C" !!,PSARPDT W:$E(IOST,1,2)="C-" !
"RTN","PSALOG0",40,0)
 W ?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",?72,"PAGE ",$J(PSAPG,2)
"RTN","PSALOG0",41,0)
 W !?19,"UNPOSTED PHARMACY PROCUREMENTS FOR ",PSAMOYR
"RTN","PSALOG0",42,0)
 W !!,"PO #",?10,"PO DATE",?22,"CP",?27,"VENDOR",?69,"TOTAL COST",!,PSADLN
"RTN","PSALOG0",43,0)
 Q
"RTN","PSALOG1")
0^34^B13165498
"RTN","PSALOG1",1,0)
PSALOG1 ;BIR/LTL,JMB-Unposted Procurement History - CONT'D ;7/23/97
"RTN","PSALOG1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALOG1",3,0)
 ;This routine prints the pharmacy procurement history Item Totals report
"RTN","PSALOG1",4,0)
 ;for a selected month. This routine is called by PSALOG.
"RTN","PSALOG1",5,0)
 ;
"RTN","PSALOG1",6,0)
TOTALS S (PSAPG,PSACP,PSAIEN)=0,PSAITEM="" D HDR
"RTN","PSALOG1",7,0)
 I '$D(^TMP("PSA",$J)) W !!,"No items were found for the selected month." G END^PSALOG0
"RTN","PSALOG1",8,0)
 F PSAC=0:1 S PSACP=$O(^TMP("PSA",$J,PSACP)) Q:'PSACP!(PSAOUT)  D:PSAC HDR G:PSAOUT END^PSALOG0 W !," << STATION/CP: "_PSACP_" >>" D  G:PSAOUT END^PSALOG0
"RTN","PSALOG1",9,0)
 .F  S PSAITEM=$O(^TMP("PSA",$J,PSACP,PSAITEM)) Q:PSAOUT!(PSAITEM']"")  D:$Y+6>IOSL HDR Q:PSAOUT  F  S PSAIEN=$O(^TMP("PSA",$J,PSACP,PSAITEM,PSAIEN)) Q:PSAOUT!('PSAIEN)  D:$Y+4>IOSL HDR Q:PSAOUT  D
"RTN","PSALOG1",10,0)
 ..S PSATMP=$G(^TMP("PSA",$J,PSACP,PSAITEM,PSAIEN))
"RTN","PSALOG1",11,0)
 ..W:'$G(PSAMORE) !,$E(PSAITEM,1,50),$S($P(PSATMP,"^",5):" ("_$P(PSATMP,"^",5)_")",1:""),?60,"NDC: ",$P(PSATMP,"^",15),!," DRUG file: ",$S($P($G(^PSDRUG(+$O(^PSDRUG("AB",+$P(PSATMP,"^",5),0)),0)),"^")]"":$P($G(^(0)),"^"),1:"Not connected yet")
"RTN","PSALOG1",12,0)
 ..W !," Vendor: ",$$VENNAME^PRCPUX1($P($G(^PRC(442,+PSAIEN,1)),"^")_"PRC(440")
"RTN","PSALOG1",13,0)
 ..S PSAUNIT=$$UNITCODE^PRCPUX1($P(PSATMP,"^",3))
"RTN","PSALOG1",14,0)
 ..I $Y+7>IOSL D HDR Q:PSAOUT
"RTN","PSALOG1",15,0)
 ..W:'$G(PSAMORE) !!," PO#",?9,"DATE",?21,"QTY",?32,"QTY",?44,"$/",PSAUNIT,?60,"TOTAL",?74,"TOTAL",!?21,"ORD",?31,"REC'D",?60,"ORD",?74,"REC'D"
"RTN","PSALOG1",16,0)
 ..W !!," "_$E($P($G(^PRC(442,+PSAIEN,0)),"^"),5,10) S PSAFCP=$P($G(^(0)),"^",3)
"RTN","PSALOG1",17,0)
 ..S Y=$P($G(^PRC(442,+PSAIEN,1)),"^",15) X ^DD("DD") S PSADATE=$S($L(Y)=10:$E(Y,1,5),$L(Y)=11:$E(Y,1,6),1:"UNKNOWN")
"RTN","PSALOG1",18,0)
 ..S PSAQTYO=$P(PSATMP,"^",2),PSATQTYO=$G(PSATQTYO)+PSAQTYO
"RTN","PSALOG1",19,0)
 ..W ?9,PSADATE,$J(PSAQTYO,8)_" ",PSAUNIT
"RTN","PSALOG1",20,0)
 ..S PSAQTYP=$P($G(^PRC(442,+PSAIEN,2,+$O(^PRC(442,+PSAIEN,2,"B",+$P(PSATMP,"^"),0)),2)),"^",8),PSATOTP=$G(PSATOTP)+PSAQTYP W $J(PSAQTYP,8)_" ",PSAUNIT
"RTN","PSALOG1",21,0)
 ..S X=$P(PSATMP,"^",9),X2="2$",X3=10 D COMMA^%DTC W ?40,X
"RTN","PSALOG1",22,0)
 ..S X=PSAQTYO*$P(PSATMP,"^",9),PSATOTO=$G(PSATOTO)+X,X2="2$" D COMMA^%DTC W ?56,X
"RTN","PSALOG1",23,0)
 ..S X=PSAQTYP*$P(PSATMP,"^",9),PSATOTR=$G(PSATOTR)+X,X2="2$" D COMMA^%DTC W ?70,X
"RTN","PSALOG1",24,0)
 ..W !,PSASLN
"RTN","PSALOG1",25,0)
 ..I '$O(^TMP("PSA",$J,PSACP,PSAITEM,PSAIEN)),$G(PSAMORE) D  Q:PSAOUT
"RTN","PSALOG1",26,0)
 ...I $Y+4>IOSL D HDR Q:PSAOUT
"RTN","PSALOG1",27,0)
 ...W !?6,"TOTALS=>",$J(PSATQTYO,8),?25,$J(PSATOTP,8) S X=PSATOTO,X2="2$" D COMMA^%DTC W ?55,X S X=PSATOTR,X2="2$" D COMMA^%DTC W ?70,X,!,PSADLN
"RTN","PSALOG1",28,0)
 ..K PSAMORE,PSATQTYO,PSATOTP
"RTN","PSALOG1",29,0)
 ..S:$O(^TMP("PSA",$J,PSACP,PSAITEM,PSAIEN)) PSAMORE=1
"RTN","PSALOG1",30,0)
 ..I '$O(^TMP("PSA",$J,PSACP,PSAITEM,PSAIEN)) S ^TMP("PSAC",$J,(999999999-PSATOTO),PSAITEM)=PSATOTO_"^"_PSACP K PSATOTO
"RTN","PSALOG1",31,0)
 G END^PSALOG0
"RTN","PSALOG1",32,0)
HDR I $E(IOST,1,2)="C-",PSAPG D  Q:PSAOUT
"RTN","PSALOG1",33,0)
 .S PSASS=22-$Y F PSAKK=1:1:PSASS W !
"RTN","PSALOG1",34,0)
 .S DIR(0)="E" D ^DIR K DIR S:'Y PSAOUT=1
"RTN","PSALOG1",35,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),"^"),"." S PSAOUT=1 Q
"RTN","PSALOG1",36,0)
 W:$Y @IOF S PSAPG=PSAPG+1
"RTN","PSALOG1",37,0)
 W:$E(IOST)'="C" !!,PSARPDT W:$E(IOST,1,2)="C-" !
"RTN","PSALOG1",38,0)
 W ?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",?72,"PAGE ",$J(PSAPG,2)
"RTN","PSALOG1",39,0)
 W !?11,"UNPOSTED PHARMACY PROCUREMENTS FOR "_PSAMOYR_" ITEM TOTALS REPORT"
"RTN","PSALOG1",40,0)
 W:$E(IOST)'="C" ! W !,PSADLN
"RTN","PSALOG1",41,0)
 Q
"RTN","PSALOG1H")
0^35^B7881402
"RTN","PSALOG1H",1,0)
PSALOG1H ;BIR/LTL,JMB-Unposted Procurement History - CONT'D ;7/23/97
"RTN","PSALOG1H",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALOG1H",3,0)
 ;This routine prints the pharmacy procurement history High Cost Items
"RTN","PSALOG1H",4,0)
 ;report for a selected month. It is called by PSALOG.
"RTN","PSALOG1H",5,0)
 ;
"RTN","PSALOG1H",6,0)
HIGH S PSAPG=0 D HDR
"RTN","PSALOG1H",7,0)
 ;If the "PSA" array does not exist, the "PSAC" array cannot be created.
"RTN","PSALOG1H",8,0)
 I '$D(^TMP("PSA",$J)) W !!,"No items were found for the selected month." G END^PSALOG0
"RTN","PSALOG1H",9,0)
 ;If the "PSA" array exists, the "PSAC" does not exit, and the user
"RTN","PSALOG1H",10,0)
 ;requested the Item Totals report, the routine attempted to create
"RTN","PSALOG1H",11,0)
 ;the "PSAC" array and found no data.
"RTN","PSALOG1H",12,0)
 I $D(^TMP("PSA",$J)),'$D(^TMP("PSAC",$J)),$G(PSATOTAL) W !!,"No items were found for the selected month." G END^PSALOG0
"RTN","PSALOG1H",13,0)
 ;If the "PSA" array exists, the "PSAC" does not exit, and the user
"RTN","PSALOG1H",14,0)
 ;did not request the Item Totals report, create the "PSAC" array.
"RTN","PSALOG1H",15,0)
 I $D(^TMP("PSA",$J)),'$D(^TMP("PSAC",$J)),'$G(PSATOTAL) D CREATE
"RTN","PSALOG1H",16,0)
 I '$D(^TMP("PSAC",$J)) W !!,"No items were found for the selected month." G END^PSALOG0
"RTN","PSALOG1H",17,0)
 S PSAINVO=0 F  S PSAINVO=+$O(^TMP("PSAC",$J,PSAINVO)) Q:'PSAINVO!(PSAOUT)  D
"RTN","PSALOG1H",18,0)
 .D:$Y+4>IOSL HDR Q:PSAOUT
"RTN","PSALOG1H",19,0)
 .S PSAITEM="" F  S PSAITEM=$O(^TMP("PSAC",$J,PSAINVO,PSAITEM)) Q:PSAITEM=""  D
"RTN","PSALOG1H",20,0)
 ..Q:$G(^TMP("PSAC",$J,PSAINVO,PSAITEM))<PSALOW
"RTN","PSALOG1H",21,0)
 ..W !,$E(PSAITEM,1,56)
"RTN","PSALOG1H",22,0)
 ..S X=$P($G(^TMP("PSAC",$J,PSAINVO,PSAITEM)),"^"),X2="2$" D COMMA^%DTC
"RTN","PSALOG1H",23,0)
 ..W ?58,X,"(",$P($G(^TMP("PSAC",$J,PSAINVO,PSAITEM)),"^",2),")",!
"RTN","PSALOG1H",24,0)
 G END^PSALOG0
"RTN","PSALOG1H",25,0)
HDR I $E(IOST,1,2)="C-",PSAPG D  Q:PSAOUT
"RTN","PSALOG1H",26,0)
 .S PSASS=22-$Y F PSAKK=1:1:PSASS W !
"RTN","PSALOG1H",27,0)
 .S DIR(0)="E" D ^DIR K DIR S:'Y PSAOUT=1
"RTN","PSALOG1H",28,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),"^"),"." S PSAOUT=1 Q
"RTN","PSALOG1H",29,0)
 W:$Y @IOF S PSAPG=PSAPG+1
"RTN","PSALOG1H",30,0)
 W:$E(IOST)'="C" !!,PSARPDT W:$E(IOST,1,2)="C-" !
"RTN","PSALOG1H",31,0)
 W ?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",?72,"PAGE ",$J(PSAPG,2)
"RTN","PSALOG1H",32,0)
 W !?((80-(65+$L(PSALOW)))/2),"UNPOSTED PHARMACY PROCUREMENTS FOR "_PSAMOYR_" HIGH COST ITEMS OVER $",PSALOW
"RTN","PSALOG1H",33,0)
 W !!?1,"ITEM NAME",?61,"TOTAL ITEM COST",!,PSADLN
"RTN","PSALOG1H",34,0)
 Q
"RTN","PSALOG1H",35,0)
CREATE ;Create the "PSAC" array.
"RTN","PSALOG1H",36,0)
 S PSACP=0 F  S PSACP=$O(^TMP("PSA",$J,PSACP)) Q:'PSACP  D
"RTN","PSALOG1H",37,0)
 .S PSAITEM="" F  S PSAITEM=$O(^TMP("PSA",$J,PSACP,PSAITEM)) Q:PSAITEM']""  S PSAIEN=0 F  S PSAIEN=$O(^TMP("PSA",$J,PSACP,PSAITEM,PSAIEN)) Q:'PSAIEN  D
"RTN","PSALOG1H",38,0)
 ..S PSATMP=$G(^TMP("PSA",$J,PSACP,PSAITEM,PSAIEN))
"RTN","PSALOG1H",39,0)
 ..S PSATOTO=$G(PSATOTO)+($P(PSATMP,"^",2)*$P(PSATMP,"^",9))
"RTN","PSALOG1H",40,0)
 ..I '$O(^TMP("PSA",$J,PSACP,PSAITEM,PSAIEN)) S ^TMP("PSAC",$J,(999999999-PSATOTO),PSAITEM)=PSATOTO_"^"_PSACP K PSATOTO
"RTN","PSALOG1H",41,0)
 Q
"RTN","PSALOG2")
0^36^B25456790
"RTN","PSALOG2",1,0)
PSALOG2 ;BIR/LTL-Post Drug Procurement History ;7/23/97
"RTN","PSALOG2",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALOG2",3,0)
 ;This routine compiles a report of warehouse drugs.
"RTN","PSALOG2",4,0)
 ;
"RTN","PSALOG2",5,0)
 N PSA,PSAB,PSAC,PSAION,PSAOUT,X,X2,X3,Y,PSAPG,DIR,DIRUT,DTOUT,DUOUT,%DT,PSALN
"RTN","PSALOG2",6,0)
 S %DT="AEP",%DT("A")="Please select month: ",%DT("B")="T-1M"
"RTN","PSALOG2",7,0)
 D ^%DT S PSA(11)=$E(Y,1,5),PSA(12)=$E(PSA(11),4,5),PSAOUT=0
"RTN","PSALOG2",8,0)
 I Y<0 S PSAOUT=1 G END
"RTN","PSALOG2",9,0)
 X ^DD("DD") S PSA(13)=$E(Y,1,3)_" '"_$E(PSA(11),2,3)
"RTN","PSALOG2",10,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" W ! D ^%ZIS S PSAION=$G(ION)
"RTN","PSALOG2",11,0)
 I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSAOUT=1 G END
"RTN","PSALOG2",12,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="GO^PSALOG2",ZTDESC="Monthly warehoused drug report",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSALOG2",13,0)
GO S PSA=$O(^PRCP(445,"AC","W","")),(PSA(1),PSAPG)=0 D HEADER
"RTN","PSALOG2",14,0)
 F  S PSA(1)=$O(^PRCP(445,+PSA,1,PSA(1))) Q:'PSA(1)  I $P($G(^PRC(441,+PSA(1),0)),U,3)=6505 W:$E($G(IOST))="C" "." S ^TMP("PSA",$J,$P($G(^PRC(441,+PSA(1),0)),U,2))=$G(^(0))
"RTN","PSALOG2",15,0)
 S PSA(2)=0
"RTN","PSALOG2",16,0)
 F  S PSA(2)=$O(^TMP("PSA",$J,PSA(2))) Q:PSA(2)']""  S PSA(3)=$P($G(^TMP("PSA",$J,PSA(2))),U) D:$O(^PRCP(445.2,"AD",PSA,PSA(3),""))
"RTN","PSALOG2",17,0)
 .S PSA(4)=0
"RTN","PSALOG2",18,0)
 .F  S PSA(4)=$O(^PRCP(445.2,"AD",+PSA,PSA(3),PSA(4))) Q:'PSA(4)  D:$P($G(^PRCP(445.2,+PSA(4),0)),U,4)?1"R"&($E($P($G(^(0)),U,17),1,5)=PSA(11))
"RTN","PSALOG2",19,0)
 ..S ^TMP("PSAB",$J,$P($G(^PRCP(445.2,+PSA(4),0)),U,18),$P($G(^(0)),U,5),PSA(4))=$G(^(0))
"RTN","PSALOG2",20,0)
 S (PSA(4),PSAB,PSAB(1))=0
"RTN","PSALOG2",21,0)
 F PSAC=0:1 S PSAB=$O(^TMP("PSAB",$J,PSAB)) Q:'PSAB  D:PSAC HEADER G:PSAOUT END W !!,"PRIMARY INVENTORY: ",$$INVNAME^PRCPUX1(PSAB) F  S PSA(4)=$O(^TMP("PSAB",$J,PSAB,PSA(4))) Q:'PSA(4)!(PSAOUT)  D  G:PSAOUT END
"RTN","PSALOG2",22,0)
 .W !!,"ITEM #: ",PSA(4),?15,$$DESCR^PRCPUX1(PSAB,PSA(4)),!!,"QTY",?9,"QTY",?19,"PKG",?29,"UNIT",?40,"TOTAL",?51,"DATE",?61,"TRANSACTION",!,"ORD",?9,"REC",?29,"COST",?40,"COST"
"RTN","PSALOG2",23,0)
 .F  S PSAB(1)=$O(^TMP("PSAB",$J,+PSAB,+PSA(4),PSAB(1))) Q:'PSAB(1)!(PSAOUT)  S PSA(5)=$G(^TMP("PSAB",$J,+PSAB,+PSA(4),+PSAB(1))) D  D:$Y+6>IOSL HEADER Q:PSAOUT
"RTN","PSALOG2",24,0)
 ..Q:'$P(PSA(5),U,19)
"RTN","PSALOG2",25,0)
 ..S PSA(22)=0,PSA(33)=$O(^PRCS(410,"B",$P(PSA(5),U,19),""))
"RTN","PSALOG2",26,0)
 ..F  S PSA(22)=$O(^PRCS(410,+PSA(33),"IT",PSA(22))) Q:'PSA(22)  S:$P($G(^PRCS(410,+PSA(33),"IT",PSA(22),0)),U,5)=PSA(4) PSA(44)=$P($G(^(0)),U,2)
"RTN","PSALOG2",27,0)
 ..W !!,$J($G(PSA(44)),3)
"RTN","PSALOG2",28,0)
 ..S PSA(99)=$G(PSA(99))+PSA(44) K PSA(44)
"RTN","PSALOG2",29,0)
 ..S PSA(8)=-$P(PSA(5),U,7),PSA(9)=$G(PSA(9))+PSA(8) W ?9,$J(PSA(8),3)
"RTN","PSALOG2",30,0)
 ..W ?18,$P(PSA(5),U,6)
"RTN","PSALOG2",31,0)
 ..S (X,PSA(7))=$P(PSA(5),U,9),X2="2$" D COMMA^%DTC W X
"RTN","PSALOG2",32,0)
 ..S X=-$P(PSA(5),U,7)*PSA(7),X2="2$",PSA(10)=$G(PSA(10))+X D COMMA^%DTC W X
"RTN","PSALOG2",33,0)
 ..S Y=$P($P(PSA(5),U,17),".") X ^DD("DD") W ?50,$S($L(Y)=11:$E(Y,1,6),$L(Y)=10:$E(Y,1,5),1:"UNKNOWN")
"RTN","PSALOG2",34,0)
 ..W ?59,$P(PSA(5),U,19)
"RTN","PSALOG2",35,0)
 ..I '$O(^TMP("PSAB",$J,+PSAB,+PSA(4),+PSAB(1))) W !,PSALN,!,$J(PSA(99),3),?9,$J(PSA(9),3) S X=$G(PSA(10)),X2="2$" D COMMA^%DTC W ?16,"<TOTALS>",?34,X S ^TMP("PSAC",$J,(999999999-PSA(10)),+PSA(4))=PSA(10)_U_PSAB K PSA(9),PSA(10),PSA(99)
"RTN","PSALOG2",36,0)
 I '$D(^TMP("PSAB",$J)) W !,"Sorry, no procurements for that month!",! S PSAOUT=1
"RTN","PSALOG2",37,0)
 I $D(ZTQUEUED),$D(^TMP("PSAB",$J)) S PSA(44)=500 D LOOP2^PSALOG3
"RTN","PSALOG2",38,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSALOG2",39,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) W ! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR K DIR
"RTN","PSALOG2",40,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSALOG2",41,0)
 K ^TMP("PSA",$J),^TMP("PSAB",$J) I $G(PSAOUT) K ^TMP("PSAC",$J) Q
"RTN","PSALOG2",42,0)
 S DIR(0)="Y",DIR("A")="Would you like a list of high dollar items",DIR("B")="Yes",DIR("?")="If yes, I'll let you pick a cut-off dollar amount and sort from high to low" W ! D ^DIR K DIR I 'Y S PSAOUT=1 G END
"RTN","PSALOG2",43,0)
 S DIR(0)="N",DIR("A")="Please enter the lowest amount you are interested in listing",DIR("B")=1000,DIR("?")="Enter the lowest dollar amount that you want included, without $" W ! D ^DIR K DIR S:Y PSA(44)=Y I 'Y S PSAOUT=1 G END
"RTN","PSALOG2",44,0)
 K IO("Q") N %ZIS,IOP,POP,X3 S %ZIS="0Q",%ZIS("B")=$G(PSAION) W ! D ^%ZIS
"RTN","PSALOG2",45,0)
 I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" S PSAOUT=1 G END
"RTN","PSALOG2",46,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="LOOP2^PSALOG3",ZTDESC="High Dollar Drug Report",ZTSAVE("^TMP(""PSAC"",$J,")="",ZTSAVE("PSA*")="",ZTSAVE("PSALN")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSALOG2",47,0)
 D LOOP2^PSALOG3 G END
"RTN","PSALOG2",48,0)
HEADER I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSALOG2",49,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSALOG2",50,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1
"RTN","PSALOG2",51,0)
 W !,?2,"WAREHOUSE DRUG PROCUREMENTS FOR ",PSA(13),?70,"PAGE: ",PSAPG,!,PSALN
"RTN","PSALOG2",52,0)
 Q
"RTN","PSALOG3")
0^37^B4005996
"RTN","PSALOG3",1,0)
PSALOG3 ;BIR/LTL-Post Drug Procurement History - CONT'D;7/23/97
"RTN","PSALOG3",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALOG3",3,0)
 ;This routine contains the warehouse drug report. It is called by PSALOG2.
"RTN","PSALOG3",4,0)
 ;
"RTN","PSALOG3",5,0)
LOOP2 S PSAPG=0 D HEADER2
"RTN","PSALOG3",6,0)
 S (PSA(33),PSA(55))=0
"RTN","PSALOG3",7,0)
 F  S PSA(33)=$O(^TMP("PSAC",$J,PSA(33))) Q:'PSA(33)!(PSAOUT)  D:$Y+4>IOSL HEADER2 Q:PSAOUT  F  S PSA(55)=$O(^TMP("PSAC",$J,+PSA(33),PSA(55))) Q:'PSA(55)!($P($G(^TMP("PSAC",$J,+PSA(33),+PSA(55))),U)<PSA(44))  D
"RTN","PSALOG3",8,0)
 .W !,$E($$DESCR^PRCPUX1($P($G(^TMP("PSAC",$J,+PSA(33),PSA(55))),U,2),PSA(55)),1,50)
"RTN","PSALOG3",9,0)
 .S X=$P($G(^TMP("PSAC",$J,+PSA(33),PSA(55))),U),X2="2$"
"RTN","PSALOG3",10,0)
 .D COMMA^%DTC W ?53,X,"(",$E($$INVNAME^PRCPUX1($P($G(^TMP("PSAC",$J,+PSA(33),PSA(55))),U,2)),1,20),")",!
"RTN","PSALOG3",11,0)
 I $E(IOST,1,2)="C-",'PSAOUT W ! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the option." D ^DIR
"RTN","PSALOG3",12,0)
 K ^TMP("PSAC",$J) S PSAOUT=1 Q
"RTN","PSALOG3",13,0)
HEADER2 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSALOG3",14,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSALOG3",15,0)
 W:$Y @IOF S PSAPG=PSAPG+1 W !,"High Cost Items Over $",PSA(44),?57,"TOTAL $",?75,"PSAPG:",PSAPG,!,PSALN
"RTN","PSALOG3",16,0)
 Q
"RTN","PSALOGON")
0^38^B5620706
"RTN","PSALOGON",1,0)
PSALOGON ;BIR/JMB-Logon Utility ;7/23/97
"RTN","PSALOGON",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSALOGON",3,0)
 ;This routine displays the number of invoices the user needs to process
"RTN","PSALOGON",4,0)
 ;or verify when the user signs on the system. The PSALOGON option needs
"RTN","PSALOGON",5,0)
 ;to be placed on the system that the users signon to. Then PSA ORDERS
"RTN","PSALOGON",6,0)
 ;ALERT option needs to be added as an item to the XU USER SIGN-ON
"RTN","PSALOGON",7,0)
 ;option.
"RTN","PSALOGON",8,0)
 ;
"RTN","PSALOGON",9,0)
SIGNON Q:'$D(^XUSEC("PSA ORDERS",DUZ))
"RTN","PSALOGON",10,0)
 S (PSACNTP,PSACTRL)=0
"RTN","PSALOGON",11,0)
 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:'PSACTRL  D
"RTN","PSALOGON",12,0)
 .Q:'$D(^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSALOGON",13,0)
 .S:$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",8)'="P" PSACNTP=PSACNTP+1
"RTN","PSALOGON",14,0)
VERIFY S (PSACNTV,PSAORD)=0
"RTN","PSALOGON",15,0)
 F  S PSAORD=$O(^PSD(58.811,"ASTAT","P",PSAORD)) Q:'PSAORD  D
"RTN","PSALOGON",16,0)
 .S PSAINV=0 F  S PSAINV=$O(^PSD(58.811,"ASTAT","P",PSAORD,PSAINV)) Q:'PSAINV  D
"RTN","PSALOGON",17,0)
 ..Q:+$P($G(^PSD(58.811,PSAORD,1,PSAINV,0)),"^",10)=DUZ
"RTN","PSALOGON",18,0)
 ..I $P($G(^PSD(58.811,PSAORD,1,PSAINV,0)),"^",8)="S"!($P($G(^PSD(58.811,PSAORD,0)),"^",8)="A"),'$D(^XUSEC("PSJ RPHARM",DUZ)) Q
"RTN","PSALOGON",19,0)
 ..S PSACNTV=PSACNTV+1
"RTN","PSALOGON",20,0)
 G:'PSACNTP&('PSACNTV) EXIT
"RTN","PSALOGON",21,0)
 I PSACNTP,PSACNTV S PSAMSG="!There "_$S(PSACNTP>1:"are "_PSACNTP_" invoices",1:"is 1 invoice")_" to process and "_$S(PSACNTV>1:PSACNTV_" invoices",1:"1 invoice")_" to verify." G SEND
"RTN","PSALOGON",22,0)
 I PSACNTP S:PSACNTP>1 PSAMSG="!There are "_PSACNTP_" invoices to process." S:PSACNTP=1 PSAMSG="!There is 1 invoice to process." G SEND
"RTN","PSALOGON",23,0)
 I PSACNTV S:PSACNTV>1 PSAMSG="!There are "_PSACNTV_" invoices to verify." S:PSACNTV=1 PSAMSG="!There is 1 invoice to verify." G SEND
"RTN","PSALOGON",24,0)
 Q
"RTN","PSALOGON",25,0)
 ;
"RTN","PSALOGON",26,0)
SEND D SET^XUS1A(PSAMSG)
"RTN","PSALOGON",27,0)
 ;
"RTN","PSALOGON",28,0)
EXIT K PSACNTP,PSACNTV,PSACTRL,PSAINV,PSAMSG,PSAORD
"RTN","PSALOGON",29,0)
 Q
"RTN","PSAMON")
0^114^B48673025
"RTN","PSAMON",1,0)
PSAMON ;BIR/LTL,JMB-Monthly Summary ;7/23/97
"RTN","PSAMON",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAMON",3,0)
 ;This routine allows the user to print a report per pharmacy location
"RTN","PSAMON",4,0)
 ;of the drug, beginning balance, ending balance, total received, total
"RTN","PSAMON",5,0)
 ;dispensed, and total adjustments. Specific or all drugs can be selected
"RTN","PSAMON",6,0)
 ;for the report. The report can be sent to the screen and printer.
"RTN","PSAMON",7,0)
 ;
"RTN","PSAMON",8,0)
LOC K ^TMP("PSAD",$J) S PSAHIS=1,(PSACNT,PSAOUT)=0
"RTN","PSAMON",9,0)
 D LOC^PSALEVRP I $G(DIRUT) S PSAOUT=1 G END1
"RTN","PSAMON",10,0)
 S PSACHK=$O(PSALOC(""))
"RTN","PSAMON",11,0)
 I 'PSACNT,PSACHK="" W !,"There are no active pharmacy locations." G END1
"RTN","PSAMON",12,0)
 I PSACNT=1 D
"RTN","PSAMON",13,0)
 .S PSALOCN=$O(PSALOCA("")),PSALOC=$O(PSALOCA(PSALOCN,0)),PSALOC(PSALOCN,PSALOC)=PSALOCA(PSALOCN,PSALOC),PSAMENU(1,PSALOCN,PSALOC)="",PSASEL=1,PSATOT=0
"RTN","PSAMON",14,0)
 .W:$L(PSALOCN)>76 !,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 !,PSALOCN
"RTN","PSAMON",15,0)
 D DT^DICRW S Y=$E(DT,1,5) X ^DD("DD") S PSAMON=Y
"RTN","PSAMON",16,0)
 S DIR(0)="D:AEP",DIR("A")="Select month and year: ",DIR("B")=PSAMON D ^DIR K DIR I $D(DIRUT) S PSAOUT=1 G END1
"RTN","PSAMON",17,0)
 S PSAMON=+($E(Y,1,5)*100),PSA=0,Y=PSAMON X ^DD("DD") S PSAMONN=Y,PSACNT=0
"RTN","PSAMON",18,0)
 W ! F PSAPC=1:1 S PSAPICK=+$P(PSASEL,",",PSAPC) Q:'PSAPICK  D
"RTN","PSAMON",19,0)
 .S PSALOCN="" F  S PSALOCN=$O(PSAMENU(PSAPICK,PSALOCN)) Q:PSALOCN=""!(PSAOUT)  S PSALOC=0 F  S PSALOC=$O(PSAMENU(PSAPICK,PSALOCN,PSALOC)) Q:'PSALOC!(PSAOUT)  D
"RTN","PSAMON",20,0)
 ..S PSACNT=PSACNT+1
"RTN","PSAMON",21,0)
 ..W @IOF W:$L(PSALOCN)>79 !,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<80 !,PSALOCN
"RTN","PSAMON",22,0)
 ..I '$O(^PSD(58.8,+PSALOC,1,0)) W !!,"There are no drugs in ",$G(PSALOCN) S PSAOUT=1 Q
"RTN","PSAMON",23,0)
 ..D DRUG Q:PSAOUT
"RTN","PSAMON",24,0)
 I PSACNT=1!(PSAOUT) S PSATOT=0 G DEV
"RTN","PSAMON",25,0)
 W ! S DIR(0)="Y",DIR("A")="Print summary report",DIR("B")="Y",DIR("?",1)="Enter YES to print a report of the total figures for each selected",DIR("?",2)="drug in all selected pharmacy locations."
"RTN","PSAMON",26,0)
 S DIR("?")="Enter NO to print only the report per pharmacy location.",DIR("??")="^D SUMHELP^PSAMON" D ^DIR K DIR G:$G(DIRUT) END1 S PSATOT=+Y
"RTN","PSAMON",27,0)
 G DEV
"RTN","PSAMON",28,0)
 ;
"RTN","PSAMON",29,0)
DRUG W !!,"Select one, several, or ^ALL drugs.",!
"RTN","PSAMON",30,0)
 S PSADONE=0,DIC="^PSD(58.8,+PSALOC,1,",DIC(0)="AEMQ",DIC("A")="Select Drug: "
"RTN","PSAMON",31,0)
 F  D ^DIC S:$G(DTOUT)!(X="^") PSAOUT=1 Q:Y=-1&(X'="^A")&(X'="^ALL")  D  Q:PSAOUT!(PSADONE)
"RTN","PSAMON",32,0)
 .I X'="^A",X'="^ALL",'+Y S PSAOUT=1 Q
"RTN","PSAMON",33,0)
 .I X="^A"!(X="^ALL") D  Q
"RTN","PSAMON",34,0)
 ..W !,"Please wait." S PSA=0 F  S PSA=$O(^PSD(58.8,+PSALOC,1,PSA)) Q:'PSA  S:$G(^PSD(58.8,+PSALOC,1,+PSA,5,PSAMON,0))'="" ^TMP("PSAD",$J,PSALOCN,PSA)="" W:(PSA#500) "."
"RTN","PSAMON",35,0)
 ..D END^PSAPROC S PSADONE=1
"RTN","PSAMON",36,0)
 .I +Y,$G(^PSD(58.8,+PSALOC,1,+Y,5,PSAMON,0))="" W !!,"Sorry, no history for that month." Q
"RTN","PSAMON",37,0)
 .S ^TMP("PSAD",$J,PSALOCN,+Y)=""
"RTN","PSAMON",38,0)
 K DIC
"RTN","PSAMON",39,0)
 Q
"RTN","PSAMON",40,0)
 ;
"RTN","PSAMON",41,0)
DEV ;asks device and queueing info
"RTN","PSAMON",42,0)
 S PSA=$O(^TMP("PSAD",$J,"")) G:PSA=""!(PSAOUT) END1
"RTN","PSAMON",43,0)
 K IO("Q") N IOP,POP S %ZIS="0Q" W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" G END1
"RTN","PSAMON",44,0)
 I $D(IO("Q")) D  G END1
"RTN","PSAMON",45,0)
 .K ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK
"RTN","PSAMON",46,0)
 .S ZTRTN="START^PSAMON",ZTDESC="Drug Accountability Monthly Summary Report",ZTSAVE("PSA*")="",ZTSAVE("^TMP(""PSAD"",$J,")=""
"RTN","PSAMON",47,0)
 .D ^%ZTLOAD,HOME^%ZIS
"RTN","PSAMON",48,0)
 ;
"RTN","PSAMON",49,0)
START ;compiles and prints output
"RTN","PSAMON",50,0)
 S PSARPDT=$E($$HTFM^XLFDT($H),1,12),PSADT=$P(PSARPDT,".")
"RTN","PSAMON",51,0)
 S PSARPDT=$E(PSADT,4,5)_"/"_$E(PSADT,6,7)_"/"_$E(PSADT,2,3)_"@"_$P(PSARPDT,".",2)
"RTN","PSAMON",52,0)
 S (PSAOUT,PSAPG)=0,$P(PSADLN,"=",81)="",$P(PSASLN,"-",81)="",PSATABH=(66-($L(PSAMONN)+$L($E(PSALOCN,1,20))))/2
"RTN","PSAMON",53,0)
 K ^TMP("PSAMON",$J)
"RTN","PSAMON",54,0)
LOOP S PSALOCN="" F  S PSALOCN=$O(^TMP("PSAD",$J,PSALOCN)) Q:PSALOCN=""!(PSAOUT)  D
"RTN","PSAMON",55,0)
 .D HEADER S PSALOC=$O(PSALOC(PSALOCN,0))
"RTN","PSAMON",56,0)
 .F PSA=0:0 S PSA=+$O(^TMP("PSAD",$J,PSALOCN,PSA)) Q:'PSA  D
"RTN","PSAMON",57,0)
 ..I $D(^PSD(58.8,PSALOC,1,PSA,5,PSAMON,0)) S ^TMP("PSAMON",$J,$P($G(^PSDRUG(PSA,0)),U))=PSA
"RTN","PSAMON",58,0)
 .D PRINT K ^TMP("PSAMON",$J)
"RTN","PSAMON",59,0)
 .I 'PSAOUT D:$Y+4>IOSL HEADER Q:PSAOUT  W !,"TOTAL",?36,$J(PSATREC,6,0),?49,$J(PSATDISP,6,0),?60,$J(PSATADJ,6,0),?73,$J(PSATTF,6,0),!,PSADLN,!
"RTN","PSAMON",60,0)
 G END
"RTN","PSAMON",61,0)
 ;
"RTN","PSAMON",62,0)
PRINT ;Prints in drug order.
"RTN","PSAMON",63,0)
 S PSAX="",PSAX=$O(^TMP("PSAMON",$J,PSAX)) I PSAX="" W !!,"<< NO DATA WAS FOUND. >>" G END
"RTN","PSAMON",64,0)
 S (PSATREC,PSATDISP,PSATADJ,PSATTF)=0
"RTN","PSAMON",65,0)
 S PSADRUG="" F  S PSADRUG=$O(^TMP("PSAMON",$J,PSADRUG)) Q:PSADRUG=""  D  Q:PSAOUT
"RTN","PSAMON",66,0)
 .D:$Y+4>IOSL HEADER Q:PSAOUT  S PSA=+^TMP("PSAMON",$J,PSADRUG)
"RTN","PSAMON",67,0)
 .W !,PSADRUG
"RTN","PSAMON",68,0)
 .W !?17 W:+$P($G(^PSD(58.8,PSALOC,1,PSA,5,PSAMON,0)),U,2) $J($P($G(^PSD(58.8,PSALOC,1,PSA,5,PSAMON,0)),U,2),6,0)
"RTN","PSAMON",69,0)
 .I '+$P($G(^PSD(58.8,PSALOC,1,PSA,5,PSAMON,0)),U,2) S PSABAL=$P($G(^PSD(58.8,PSALOC,1,PSA,5,PSAMON,0)),U,4) W $J($S($G(PSABAL):PSABAL,1:0),6,0)
"RTN","PSAMON",70,0)
 .W ?26,$J($S($P($G(^PSD(58.8,PSALOC,1,PSA,5,PSAMON,0)),U,4)]"":$P($G(^(0)),U,4),1:$P($G(^PSD(58.8,PSALOC,1,PSA,0)),U,4)),6,0)
"RTN","PSAMON",71,0)
 .S PSAREC=$P($G(^PSD(58.8,PSALOC,1,PSA,5,PSAMON,0)),U,3),PSATREC=PSATREC+PSAREC W ?36,$J(PSAREC,6,0)
"RTN","PSAMON",72,0)
 .S PSADISP=$P($G(^PSD(58.8,PSALOC,1,PSA,5,PSAMON,0)),U,6),PSATDISP=PSATDISP+PSADISP W ?49,$J(PSADISP,6,0)
"RTN","PSAMON",73,0)
 .S PSADJ=$P($G(^PSD(58.8,PSALOC,1,PSA,5,PSAMON,0)),U,5),PSATADJ=PSATADJ+PSADJ W ?60,$J(PSADJ,6,0)
"RTN","PSAMON",74,0)
 .S PSATF=$P($G(^PSD(58.8,PSALOC,1,PSA,5,PSAMON,0)),U,9),PSATTF=PSATTF+PSATF W ?73,$J(PSATF,6,0),!
"RTN","PSAMON",75,0)
 .W:$O(^TMP("PSAMON",$J,PSADRUG))'="" PSASLN W:$O(^TMP("PSAMON",$J,PSADRUG))="" PSADLN
"RTN","PSAMON",76,0)
 .I PSATOT D
"RTN","PSAMON",77,0)
 ..S $P(^TMP("PSAG",$J,PSADRUG),"^")=$P($G(^TMP("PSAG",$J,PSADRUG)),"^")+PSAREC,$P(^(PSADRUG),"^",2)=$P($G(^(PSADRUG)),"^",2)+PSADISP
"RTN","PSAMON",78,0)
 ..S $P(^TMP("PSAG",$J,PSADRUG),"^",3)=$P($G(^TMP("PSAG",$J,PSADRUG)),"^",3)+PSADJ,$P(^(PSADRUG),"^",4)=$P($G(^(PSADRUG)),"^",4)+PSATF
"RTN","PSAMON",79,0)
 Q
"RTN","PSAMON",80,0)
 ;
"RTN","PSAMON",81,0)
END ;End of page
"RTN","PSAMON",82,0)
 I $E($G(IOST))="C",'$G(PSAOUT) D
"RTN","PSAMON",83,0)
 .S PSAS=22-$Y F PSASS=1:1:PSAS W !
"RTN","PSAMON",84,0)
 .S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR K DIR I $G(DIRUT) S PSAOUT=1
"RTN","PSAMON",85,0)
 W @IOF I 'PSAOUT,PSATOT D ^PSAMON1
"RTN","PSAMON",86,0)
 ;
"RTN","PSAMON",87,0)
END1 ;Kills variables at end of report
"RTN","PSAMON",88,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSAMON",89,0)
 K IO("Q"),^TMP("PSAD",$J),^TMP("PSAG",$J),^TMP("PSAMON",$J)
"RTN","PSAMON",90,0)
 K %ZIS,DIC,DIRUT,DTOUT,DUOUT,PSA,PSABAL,PSACHK,PSACNT,PSACOMB,PSAD,PSADISP,PSADJ,PSADLN,PSADONE,PSADRUG,PSADT,PSAGADJ,PSAGDISP,PSAGREC,PSAGTF,PSAHIS
"RTN","PSAMON",91,0)
 K PSAISIT,PSAISITN,PSALOC,PSALOCA,PSALOCN,PSAMENU,PSAMON,PSAMONN,PSANODE,PSANUM,PSAOSIT,PSAOSITN,PSAOUT,PSAPC,PSAPC1,PSAPCS,PSAPICK
"RTN","PSAMON",92,0)
 K PSAREC,PSAPG,PSARPDT,PSAS,PSASEL,PSASLN,PSAS,PSASS,PSASUB,PSATABH,PSATADJ,PSATDISP,PSATF,PSATOT,PSATREC,PSATTF,PSAX,X,Y,ZTDESC,ZTRTN
"RTN","PSAMON",93,0)
 Q
"RTN","PSAMON",94,0)
 ;
"RTN","PSAMON",95,0)
HEADER ;prints header info
"RTN","PSAMON",96,0)
 I $E(IOST,1,2)="C-",PSAPG S DIR(0)="E" D  Q:PSAOUT
"RTN","PSAMON",97,0)
 .S PSAS=22-$Y F PSASS=1:1:PSAS W !
"RTN","PSAMON",98,0)
 .S DIR(0)="E" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1
"RTN","PSAMON",99,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAMON",100,0)
 I $E(IOST,1,2)="C-" W @IOF
"RTN","PSAMON",101,0)
 I $E(IOST)'="C",PSAPG W @IOF
"RTN","PSAMON",102,0)
 S PSAPG=PSAPG+1 W:$E(IOST)'="C" !,PSARPDT W:$E(IOST,1,2)="C-" !
"RTN","PSAMON",103,0)
 W ?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",?71,"PAGE: ",PSAPG
"RTN","PSAMON",104,0)
 W !?22,"MONTHLY SUMMARY REPORT FOR "_PSAMONN
"RTN","PSAMON",105,0)
 W:$L(PSALOCN)>79 !!,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2)
"RTN","PSAMON",106,0)
 W:$L(PSALOCN)<80 !?((80-$L(PSALOCN))/2),PSALOCN
"RTN","PSAMON",107,0)
 W !!,?14,"BEGINNING",?26,"ENDING",?36,"TOTAL",?48,"TOTAL",?60,"TOTAL",?72,"TOTAL"
"RTN","PSAMON",108,0)
 W !,"DRUG",?16,"BALANCE",?25,"BALANCE",?34,"RECEIVED",?46,"DISPENSED",?58,"ADJUSTED",?69,"TRANSFERRED"
"RTN","PSAMON",109,0)
 W !,PSADLN
"RTN","PSAMON",110,0)
 Q
"RTN","PSAMON",111,0)
 ;
"RTN","PSAMON",112,0)
SUMHELP ;Extended help to 'Print summary report?'
"RTN","PSAMON",113,0)
 W !!?5,"Enter YES to print a report with the totals for each selected drug",!?5,"in all the pharmacy locations that were selected. A total line will"
"RTN","PSAMON",114,0)
 W !?5,"print for the total dispense units received, dispensed, adjusted,",!?5,"and transferrred during the selected month."
"RTN","PSAMON",115,0)
 W !!?5,"Enter NO to print each pharmacy location's report without the",!?5,"summary report."
"RTN","PSAMON",116,0)
 Q
"RTN","PSAMON1")
0^115^B9687683
"RTN","PSAMON1",1,0)
PSAMON1 ;BIR/LTL,JMB-Monthly Summary - CONT'D;9/11/97
"RTN","PSAMON1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAMON1",3,0)
 ;This routine allows the user to print a report per pharmacy location
"RTN","PSAMON1",4,0)
 ;of the drug, beginning balance, ending balance, total received, total
"RTN","PSAMON1",5,0)
 ;dispensed, and total adjustments. Specific or all drugs can be selected
"RTN","PSAMON1",6,0)
 ;for the report. The report can be sent to the screen and printer.
"RTN","PSAMON1",7,0)
 ;
"RTN","PSAMON1",8,0)
PRINT ;Prints totals report
"RTN","PSAMON1",9,0)
 S (PSAGADJ,PSAGDISP,PSAGREC,PSAGTF,PSAPG)=0 D HEADER
"RTN","PSAMON1",10,0)
 S PSADRUG="" F  S PSADRUG=$O(^TMP("PSAG",$J,PSADRUG)) Q:PSADRUG=""!(PSAOUT)  D  Q:PSAOUT
"RTN","PSAMON1",11,0)
 .D:$Y+4>IOSL HEADER Q:PSAOUT
"RTN","PSAMON1",12,0)
 .S PSANODE=^TMP("PSAG",$J,PSADRUG),PSAGREC=PSAGREC+$P(PSANODE,"^"),PSAGDISP=PSAGDISP+$P(PSANODE,"^",2),PSAGADJ=PSAGADJ+$P(PSANODE,"^",3),PSAGTF=PSAGTF+$P(PSANODE,"^",4)
"RTN","PSAMON1",13,0)
 .D WRAPDRG
"RTN","PSAMON1",14,0)
 .W ?36,$J($P(PSANODE,"^"),6,0),?49,$J($P(PSANODE,"^",2),6,0),?60,$J($P(PSANODE,"^",3),6,0),?73,$J($P(PSANODE,"^",4),6,0),!
"RTN","PSAMON1",15,0)
 .W:$O(^TMP("PSAG",$J,PSADRUG))'="" PSASLN W:$O(^TMP("PSAG",$J,PSADRUG))="" PSADLN
"RTN","PSAMON1",16,0)
 I 'PSAOUT D:$Y+4>IOSL HEADER Q:PSAOUT  W !,"GRAND TOTAL",?36,$J(PSAGREC,6,0),?49,$J(PSAGDISP,6,0),?60,$J(PSAGADJ,6,0),?73,$J(PSAGTF,6,0),!,PSADLN,!
"RTN","PSAMON1",17,0)
 ;
"RTN","PSAMON1",18,0)
END I $E($G(IOST))="C",'$G(PSAOUT) D
"RTN","PSAMON1",19,0)
 .S PSAS=22-$Y F PSASS=1:1:PSAS W !
"RTN","PSAMON1",20,0)
 .S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR K DIR I $G(DIRUT) S PSAOUT=1
"RTN","PSAMON1",21,0)
 W @IOF
"RTN","PSAMON1",22,0)
 Q
"RTN","PSAMON1",23,0)
 ;
"RTN","PSAMON1",24,0)
HEADER ;prints header info
"RTN","PSAMON1",25,0)
 I $E(IOST,1,2)="C-",PSAPG D  Q:PSAOUT
"RTN","PSAMON1",26,0)
 .S PSAS=22-$Y F PSASS=1:1:PSAS W !
"RTN","PSAMON1",27,0)
 .S DIR(0)="E" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1
"RTN","PSAMON1",28,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAMON1",29,0)
 I $E(IOST,1,2)="C-" W @IOF
"RTN","PSAMON1",30,0)
 I $E(IOST)'="C",PSAPG W @IOF
"RTN","PSAMON1",31,0)
 S PSAPG=PSAPG+1 W:$E(IOST)'="C" !,PSARPDT W:$E(IOST,1,2)="C-" !
"RTN","PSAMON1",32,0)
 W ?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",?71,"PAGE: ",PSAPG
"RTN","PSAMON1",33,0)
 W !?19,"MONTHLY SUMMARY TOTALS REPORT FOR "_PSAMONN
"RTN","PSAMON1",34,0)
 F PSAPC=1:1 S PSAPICK=+$P(PSASEL,",",PSAPC) Q:'PSAPICK  D
"RTN","PSAMON1",35,0)
 .S PSALOCN="" F  S PSALOCN=$O(PSAMENU(PSAPICK,PSALOCN)) Q:PSALOCN=""!(PSAOUT)  S PSALOC=0 F  S PSALOC=$O(PSAMENU(PSAPICK,PSALOCN,PSALOC)) Q:'PSALOC!(PSAOUT)  D
"RTN","PSAMON1",36,0)
 ..W:$L(PSALOCN)>79 !!,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<80 !?((80-$L(PSALOCN))/2),PSALOCN
"RTN","PSAMON1",37,0)
 W !!?36,"TOTAL",?48,"TOTAL",?60,"TOTAL",?72,"TOTAL"
"RTN","PSAMON1",38,0)
 W !,"DRUG",?34,"RECEIVED",?46,"DISPENSED",?58,"ADJUSTED",?69,"TRANSFERRED",!,PSADLN
"RTN","PSAMON1",39,0)
 Q
"RTN","PSAMON1",40,0)
 ;
"RTN","PSAMON1",41,0)
WRAPDRG ;Wraps the drug name if it is longer than 34 characters
"RTN","PSAMON1",42,0)
 I $L(PSADRUG)<36 W !,PSADRUG Q
"RTN","PSAMON1",43,0)
 S PSAPC1="" F PSAPCS=1:1 S PSAPC=$P(PSADRUG," ",PSAPCS) Q:PSAPC=""  D
"RTN","PSAMON1",44,0)
 .I $L(PSAPC1)+$L(PSAPC)+1<36 S PSAPC1=PSAPC1_PSAPC_" " Q
"RTN","PSAMON1",45,0)
 .I $L(PSAPC1)+$L(PSAPC)+1>35 W !,PSAPC1 S PSAPC1=PSAPC_" "
"RTN","PSAMON1",46,0)
 W:$L(PSAPC1) !?4,PSAPC1
"RTN","PSAMON1",47,0)
 Q
"RTN","PSANAC")
0^40^B26095776
"RTN","PSANAC",1,0)
PSANAC ;BIR/LTL-Populate Pharmacy Location with Inventory Items ;7/23/97
"RTN","PSANAC",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSANAC",3,0)
 ;This routine loads inventory/DA items into a pharmacy location.
"RTN","PSANAC",4,0)
 ;
"RTN","PSANAC",5,0)
SETUP N DA,DIE,DIC,DIR,DIRUT,DTOUT,DUOUT,DR,PSAOUT,PSADRUG,PSAIT,PSAINV,PSAQTY,PSAY,X,Y
"RTN","PSANAC",6,0)
 ;LOOK UP LOCATION
"RTN","PSANAC",7,0)
LOOK D ^PSADA I '$G(PSALOC) S PSAOUT=1 G QUIT
"RTN","PSANAC",8,0)
NOINV I '$O(^PSD(58.8,+PSALOC,4,0)) W !,$G(PSALOCN)_" is not linked to an Inventory Point.",! S DIR(0)="Y",DIR("A")="Would you like to attempt a link now",DIR("B")="Yes" D ^DIR K DIR G:Y'=1 QUIT D  G:$D(Y)!('$G(PSAINV)) QUIT
"RTN","PSANAC",9,0)
INV .S DIE=58.8,DA=PSALOC,DR="[PSAGIP]" D ^DIE
"RTN","PSANAC",10,0)
CHEC S DIR(0)="Y",DIR("A")="Have you looked at the loadable Inventory items",DIR("B")="No" D ^DIR K DIR G:$D(DIRUT) QUIT D:Y'=1  G:$G(PSAOUT) QUIT
"RTN","PSANAC",11,0)
 .S DIR(0)="Y",DIR("A")="Would you like to look at them now",DIR("B")="Yes" D ^DIR K DIR D:Y=1 DEV^PSARIN
"RTN","PSANAC",12,0)
 .S:$D(DTOUT)!($D(DUOUT))!('$G(PSADRUG(1))) PSAOUT=1 Q:$G(PSAOUT)  S DIR(0)="Y",DIR("A")="Ready to load",DIR("B")="No" D ^DIR K DIR S:Y'=1 PSAOUT=1
"RTN","PSANAC",13,0)
 S DIR(0)="Y",DIR("A")="Load inventory quantities also",DIR("B")="Yes",DIR("?")="If yes, I'll bring over the current inventory quantity with each item." D ^DIR K DIR S:Y=1 PSAY=1 I $D(DIRUT) S PSAOUT=1 G QUIT
"RTN","PSANAC",14,0)
EXP W !,"I will display each item as it is loaded",!
"RTN","PSANAC",15,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q",%ZIS("A")="Please select DEVICE for output:  " D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSAOUT=1 G QUIT
"RTN","PSANAC",16,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSANAC",ZTDESC="Inventory items loading into DA Location",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G QUIT
"RTN","PSANAC",17,0)
START N %DT,DIC,PSAD,PSADT,PSAL,PSALN,PSAT,PSAPG,PSARPDT,X,Y S (PSAPG,PSAOUT)=0,Y=DT D DD^%DT S PSARPDT=Y,PSAIT=0
"RTN","PSANAC",18,0)
 S PSAD="W !,PSAIT,?10,$E($$DESCR^PRCPUX1(PSAINV,PSAIT),1,34),?45,$E($P(^PSDRUG($O(^PSDRUG(""AB"",PSAIT,0)),0),U),1,34)"
"RTN","PSANAC",19,0)
 S PSAINV=$O(^PSD(58.8,+PSALOC,4,0))
"RTN","PSANAC",20,0)
 I $O(^PSD(58.8,+PSALOC,4,PSAINV)) D  S:Y<1 PSAOUT=1 G QUIT
"RTN","PSANAC",21,0)
 .S DIC="^PSD(58.8,+PSALOC,4,",DIC(0)="AEMQ",DA(1)=PSALOC D ^DIC K DIC
"RTN","PSANAC",22,0)
 .S PSAINV=+Y
"RTN","PSANAC",23,0)
 D HEADER
"RTN","PSANAC",24,0)
 S:'$D(^PSD(58.8,+PSALOC,1,0)) ^(0)="^58.8001IP^^"
"RTN","PSANAC",25,0)
LOOP F  S PSAIT=$O(^PRCP(445,PSAINV,1,PSAIT)) Q:'PSAIT  D:$Y+4>IOSL HEADER Q:PSAOUT  I '$G(^PRC(441,+PSAIT,3)),$O(^PSDRUG("AB",PSAIT,0)) S PSADRUG=$O(^PSDRUG("AB",PSAIT,0)) D:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,0))
"RTN","PSANAC",26,0)
 .I $S('$D(^PSDRUG(PSADRUG,"I")):1,+^("I")>DT:1,1:0) X PSAD D
"RTN","PSANAC",27,0)
STUFF ..S PSAQTY=$P($G(^PRCP(445,+PSAINV,1,+PSAIT,0)),U,7)*$S($P($G(^(0)),U,29):$P($G(^(0)),U,29),1:1)
"RTN","PSANAC",28,0)
 ..S:$G(PSAY) DIC("DR")="3////^S X=PSAQTY"
"RTN","PSANAC",29,0)
 ..S DIC="^PSD(58.8,+PSALOC,1,",DIC(0)="L",DA(1)=PSALOC,X=PSADRUG,DLAYGO=58.8 D ^DIC  K DIC,DLAYGO
"RTN","PSANAC",30,0)
 ..W !,"Loaded "_$P(^PSDRUG(PSADRUG,0),U)
"RTN","PSANAC",31,0)
 ..Q:'$G(PSAY)
"RTN","PSANAC",32,0)
 ..W !,"Updating beginning balance and transaction history.",!
"RTN","PSANAC",33,0)
 ..D NOW^%DTC S PSADT=+$E(%,1,12) K %
"RTN","PSANAC",34,0)
 ..S ^PSD(58.8,+PSALOC,1,+PSADRUG,5,0)="^58.801A^^"
"RTN","PSANAC",35,0)
 ..S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DIC(0)="L",(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DIC("DR")="1////^S X=PSAQTY",DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSANAC",36,0)
 ..F  L +^PSD(58.81,0):0 I  Q
"RTN","PSANAC",37,0)
FIND ..S PSAT=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSAT)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSANAC",38,0)
 ..S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAT D ^DIC K DIC,DINUM,DLAYGO L -^PSD(58.81,0)
"RTN","PSANAC",39,0)
 ..S DIE="^PSD(58.81,",DA=PSAT,DR="1////11;2////^S X=PSALOC;3////^S X=PSADT;4////^S X=PSADRUG;5////^S X=PSAQTY;6////^S X=DUZ;9////0" D ^DIE K DIE
"RTN","PSANAC",40,0)
 ..S:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSANAC",41,0)
 ..S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,4,",DIC(0)="L",(X,DINUM)=PSAT
"RTN","PSANAC",42,0)
 ..S DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DA,DIC,DINUM,DLAYGO
"RTN","PSANAC",43,0)
 ..I $E(IOST,1,2)="C-"&($O(^PS(52.6,"AC",+PSADRUG,0))!($O(^PS(52.7,"AC",+PSADRUG,0)))) S PSAIT(1)=PSAIT,PSAIT(2)=$P($G(^PSDRUG(+PSADRUG,0)),U),PSAIT(4)=$G(^PSDRUG(+PSADRUG,660)),PSAIT=PSADRUG D ^PSAPSI4 S PSAIT=PSAIT(1)
"RTN","PSANAC",44,0)
QUIT I $E(IOST)'="C" W @IOF
"RTN","PSANAC",45,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSANAC",46,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSANAC",47,0)
 K %ZIS("B"),IO("Q") Q
"RTN","PSANAC",48,0)
HEADER I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSANAC",49,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSANAC",50,0)
 S PSAINV(1)=$E($P(^PSD(58.8,+PSALOC,0),U),1,10)
"RTN","PSANAC",51,0)
 S:$E(PSAINV(1),10)="(" PSAINV(1)=$E(PSAINV(1),1,9)
"RTN","PSANAC",52,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !,$E($P(^PRCP(445,+PSAINV,0),U),1,24)," items loading into ",PSAINV(1),?56,PSARPDT,?70,"PAGE: ",PSAPG,!,PSALN,!,"ITEM",?10,"DESCRIPTION",?50,"DRUG FILE LINK",!
"RTN","PSANAC",53,0)
 Q
"RTN","PSANDC")
0^41^B11125863
"RTN","PSANDC",1,0)
PSANDC ;BIR/LTL-NDC Duplicates Report ;7/23/97
"RTN","PSANDC",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSANDC",3,0)
 ;This routine checks the ITEM FILE for multiple NDC's.
"RTN","PSANDC",4,0)
 ;
"RTN","PSANDC",5,0)
 F I=0:1:4 W !,$P($T(NAR+I),";;",2,99)
"RTN","PSANDC",6,0)
NAR ;Expanation
"RTN","PSANDC",7,0)
 ;;     This report lists each National Drug Code (NDC) that has been
"RTN","PSANDC",8,0)
 ;;     entered for more than one item.  In order for the DRUG file to
"RTN","PSANDC",9,0)
 ;;     correctly link to the ITEM MASTER file, it is recommended that the NDC
"RTN","PSANDC",10,0)
 ;;     be removed from all but the one correct entry.
"RTN","PSANDC",11,0)
 D DT^DICRW
"RTN","PSANDC",12,0)
DEV ;asks device and queueing info
"RTN","PSANDC",13,0)
 K I,IO("Q") N %ZIS,DTOUT,DUOUT,IOP,POP,PSAOUT S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSAOUT=1 G END
"RTN","PSANDC",14,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSANDC",ZTDESC="Duplicate NDC Report" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSANDC",15,0)
START ;compiles and prints data for report
"RTN","PSANDC",16,0)
 N %DT,DIR,DIRUT,PSAPG,PSANDC,PSALN,PSANDCD,PSARPDT,X,Y S (PSANDC,PSANDCD)="",(PSAPG,PSAOUT)=0,Y=DT D DD^%DT S PSARPDT=Y D HEADER
"RTN","PSANDC",17,0)
LOOP F  S PSANDC=$O(^PRC(441,"F",PSANDC)) G:PSANDC=""!(PSAOUT) END D:$Y+10>IOSL HEADER D  G:PSAOUT END
"RTN","PSANDC",18,0)
 .S PSANDC(1)=0
"RTN","PSANDC",19,0)
 .F  S PSANDCD=$O(^PRC(441,"F",PSANDC,PSANDCD)) Q:'PSANDCD!(PSAOUT)  I $O(^PRC(441,"F",PSANDC,PSANDCD)),'$G(^PRC(441,+PSANDCD,3)),'$G(^PRC(441,+$O(^PRC(441,"F",PSANDC,PSANDCD)),3)) D  D:$Y+10>IOSL HEADER Q:PSAOUT
"RTN","PSANDC",20,0)
 ..S PSANDC(1)=PSANDC(1)+1
"RTN","PSANDC",21,0)
 ..W:PSANDC(1)=1 !,PSALN,!,?30,"NDC:  "_PSANDC,!!,"ITEM #",?10,"DESCRIPTION",?50,"VENDOR",!!,PSANDCD,?10,$E($$DESCR^PRCPUX1(0,PSANDCD),1,37),?50,$E($$VENNAME^PRCPUX1($O(^PRC(441,"F",PSANDC,PSANDCD,0))_"PRC(440"),1,30)
"RTN","PSANDC",22,0)
 ..W !!,$O(^PRC(441,"F",PSANDC,PSANDCD)),?10,$E($$DESCR^PRCPUX1(0,$O(^PRC(441,"F",PSANDC,PSANDCD))),1,37),?50,$E($$VENNAME^PRCPUX1($O(^PRC(441,"F",PSANDC,$O(^PRC(441,"F",PSANDC,PSANDCD)),0))_"PRC(440"),1,30)
"RTN","PSANDC",23,0)
END I $E(IOST)'="C" W @IOF
"RTN","PSANDC",24,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSANDC",25,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSANDC",26,0)
 Q
"RTN","PSANDC",27,0)
HEADER ;prints header info
"RTN","PSANDC",28,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSANDC",29,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSANDC",30,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !?2,"DUPLICATE NDC REPORT",?35,PSARPDT,?70,"PAGE: "_PSAPG,!,!!
"RTN","PSANDC",31,0)
 Q
"RTN","PSANDF")
0^42^B56425423
"RTN","PSANDF",1,0)
PSANDF ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSANDF",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSANDF",3,0)
 ;This routine searches NDF for the NDC. If it is not found, the user
"RTN","PSANDF",4,0)
 ;is asked to select the drug from the DRUG file.
"RTN","PSANDF",5,0)
 ;
"RTN","PSANDF",6,0)
 I PSANDC="",$P(PSADATA,"^",26)'="" D  Q
"RTN","PSANDF",7,0)
 .I +$P($P(PSADATA,"^",26),"~",2) D
"RTN","PSANDF",8,0)
 ..K PSASUP S PSASUP="S"_$P(PSADATA,"^",26),(PSACNT,PSAIEN50)=0
"RTN","PSANDF",9,0)
 ..F  S PSAIEN50=$O(^PSDRUG("C",PSASUP,PSAIEN50)) Q:PSAIEN50=""  D
"RTN","PSANDF",10,0)
 ...S PSASSUB=0 F  S PSASSUB=$O(^PSDRUG("C",PSASUP,PSAIEN50,PSASSUB)) Q:'PSASSUB  S PSACNT=PSACNT+1,PSASUP(PSACNT)=PSAIEN50_"^"_PSASSUB
"RTN","PSANDF",11,0)
 ..I 'PSACNT D  Q
"RTN","PSANDF",12,0)
 ...W !,"The vendor sent no NDC or UPC for the item."
"RTN","PSANDF",13,0)
 ...D ASKDRUG S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSANDF",14,0)
 ..I PSACNT=1 D  Q
"RTN","PSANDF",15,0)
 ...S PSAIEN=$P(PSASUP(1),"^"),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6)=PSAIEN,PSASUB=$P(PSASUP(1),"^",2),$P(^(PSALINE),"^",7)=PSASUB
"RTN","PSANDF",16,0)
 ...S PSANDC=PSASUP,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,PSAVSN=$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",4),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=PSAVSN
"RTN","PSANDF",17,0)
 ...S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSANDF",18,0)
 ..I PSACNT>1 S PSACNT=$O(PSASUP(0)) D:PSACNT MANYUPCS^PSAPROC5
"RTN","PSANDF",19,0)
 ;
"RTN","PSANDF",20,0)
LOOKNDF S (PSACNT,PSAD0)=0 F  S PSAD0=+$O(^PSNDF("NDC",PSANDC,PSAD0)) Q:'PSAD0  D
"RTN","PSANDF",21,0)
 .S PSAD1=0 F  S PSAD1=+$O(^PSNDF("NDC",PSANDC,PSAD0,PSAD1)) Q:'PSAD1  D
"RTN","PSANDF",22,0)
 ..S PSAD2=0 F  S PSAD2=+$O(^PSNDF("NDC",PSANDC,PSAD0,PSAD1,PSAD2)) Q:'PSAD2  D
"RTN","PSANDF",23,0)
 ...S PSAD3=0 F  S PSAD3=+$O(^PSNDF("NDC",PSANDC,PSAD0,PSAD1,PSAD2,PSAD3)) Q:'PSAD3  D
"RTN","PSANDF",24,0)
 ....S PSAD4=0 F  S PSAD4=+$O(^PSNDF("NDC",PSANDC,PSAD0,PSAD1,PSAD2,PSAD3,PSAD4)) Q:'PSAD4  D
"RTN","PSANDF",25,0)
 .....S PSAD5=0 F  S PSAD5=+$O(^PSNDF("NDC",PSANDC,PSAD0,PSAD1,PSAD2,PSAD3,PSAD4,PSAD5)) Q:'PSAD5  D
"RTN","PSANDF",26,0)
 ......S PSAD6=0 F  S PSAD6=+$O(^PSNDF("NDC",PSANDC,PSAD0,PSAD1,PSAD2,PSAD3,PSAD4,PSAD5,PSAD6)) Q:'PSAD6  D
"RTN","PSANDF",27,0)
 .......S PSAPTR=+$P($G(^PSNDF(PSAD0,2,PSAD1,3,PSAD2,4,PSAD3,5,PSAD4,6,PSAD5,7,PSAD6,0)),"^",4) Q:'PSAPTR
"RTN","PSANDF",28,0)
 .......S PSAVAPN=$P($G(^PSNDF(PSAD0,5,PSAPTR,0)),"^") Q:PSAVAPN=""
"RTN","PSANDF",29,0)
 .......S PSAIEN50=+$O(^PSDRUG("VAPN",$E(PSAVAPN,1,30),0)) Q:'PSAIEN50  K ^TMP("PSANDF",$J)
"RTN","PSANDF",30,0)
 .......S PSAIEN50=0 F  S PSAIEN50=+$O(^PSDRUG("VAPN",$E(PSAVAPN,1,30),PSAIEN50)) Q:'PSAIEN50  S:$P($G(^PSDRUG(PSAIEN50,0)),"^")'="" ^TMP("PSANDF",$J,PSAIEN50)=$P(^PSDRUG(PSAIEN50,0),"^"),PSACNT=PSACNT+1
"RTN","PSANDF",31,0)
NONE I 'PSACNT D  Q
"RTN","PSANDF",32,0)
 .I +$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4),"~",2)!($P($P(^(PSALINE),"^",4),"~",3)'="") D ^PSAPROC4
"RTN","PSANDF",33,0)
 .E  D ASKDRUG
"RTN","PSANDF",34,0)
 I PSACNT=1 D ONE Q
"RTN","PSANDF",35,0)
 ;
"RTN","PSANDF",36,0)
MANY ;Display for selection if more than 1 drug is found for the Product Name
"RTN","PSANDF",37,0)
 W !!,"The NDC has the VA Product Name of "_PSAVAPN_".",!,"The following drugs have the same VA Product Name.",!
"RTN","PSANDF",38,0)
 S (PSACNT,PSAGET,PSAIEN50)=0 F  S PSAIEN50=+$O(^TMP("PSANDF",$J,PSAIEN50)) Q:'PSAIEN50  D  Q:PSAGET!(+$G(PSAIEN))
"RTN","PSANDF",39,0)
 .S PSACNT=PSACNT+1,^TMP("PSACNT",$J,PSACNT)=PSAIEN50
"RTN","PSANDF",40,0)
 .W !?2,PSACNT_". "_^TMP("PSANDF",$J,PSAIEN50)
"RTN","PSANDF",41,0)
 .I PSACNT#5=0 D  Q:PSAGET!($G(PSAIEN))
"RTN","PSANDF",42,0)
 ..W ! S DIR(0)="N^1:"_PSACNT,DIR("A",1)="Select the received drug or",DIR("A")="enter ""^"" to select the drug from the DRUG file.",DIR("?",1)="Choose the drug you received and assign it to the line item."
"RTN","PSANDF",43,0)
 ..S DIR("?")="To exit the list and select the drug from the DRUG file, enter ""^"".",DIR("??")="^D SELNDF^PSANDF1" D ^DIR K DIR I $G(DUOUT) S PSAGET=1 Q
"RTN","PSANDF",44,0)
 ..I $G(DTOUT) S PSAOUT=1 Q
"RTN","PSANDF",45,0)
 ..I +Y S PSAIEN=^TMP("PSACNT",$J,+Y),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=PSAIEN,$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT
"RTN","PSANDF",46,0)
 I '$G(PSAIEN),'PSAOUT,PSACNT#5'=0 D  G:Y="^" ASKDRUG Q:PSAOUT!($G(PSAIEN))
"RTN","PSANDF",47,0)
 .W ! S DIR(0)="N^1:"_PSACNT,DIR("A",1)="Select the received drug or",DIR("A")="enter ""^"" to select the drug from the DRUG file."
"RTN","PSANDF",48,0)
 .S DIR("?")="Select the drug you received or enter ""^""  to select the drug from the DRUG file.",DIR("??")="^D SELNDF^PSANDF1" D ^DIR K DIR Q:Y="^"
"RTN","PSANDF",49,0)
 .I $G(DTOUT) S PSAOUT=1 Q
"RTN","PSANDF",50,0)
 .S PSAIEN=^TMP("PSACNT",$J,+Y),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=PSAIEN,$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT,PSADATA=^(PSALINE) D EDITDISP^PSAUTL1
"RTN","PSANDF",51,0)
 K ^TMP("PSACNT",$J,PSACNT),^TMP("PSANDF",$J)
"RTN","PSANDF",52,0)
 Q:+$G(PSAIEN)!(PSAOUT)
"RTN","PSANDF",53,0)
 I +$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4),"~",2),$P($P(^(PSALINE),"^",4),"~",3)'="" G ^PSAPROC4
"RTN","PSANDF",54,0)
 ;
"RTN","PSANDF",55,0)
ASKDRUG ;If the NDC found by searching NDF is not correct OR if the NDC can't
"RTN","PSANDF",56,0)
 ;be found, the user is asked to select the drug.
"RTN","PSANDF",57,0)
 W !!,"If the item will never be in the DRUG, press the Return key then",!,"answer YES to the ""Is this a supply item?"" prompt. To bypass this",!,"line item, enter ""^"" then press the Return key.",!
"RTN","PSANDF",58,0)
 S (PSASKIP,PSAPASS)=0,DIC("A")="Select Drug: ",DIC(0)="AEMZQ",DIC="^PSDRUG("
"RTN","PSANDF",59,0)
 D ^DIC K DIC I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSANDF",60,0)
 S PSAREA=""
"RTN","PSANDF",61,0)
 I +Y=-1 D  Q:PSASUPP  Q:PSASKIP
"RTN","PSANDF",62,0)
 .D SUPPLY Q:PSAOUT
"RTN","PSANDF",63,0)
 .I 'PSASUPP S PSASKIP=1 Q
"RTN","PSANDF",64,0)
 .S PSAIEN=0,^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")=DUZ_"^"_DT_"^"_PSAREA,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",18)="P",PSADATA=^(PSALINE)
"RTN","PSANDF",65,0)
 S PSAIEN=+Y K ^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")
"RTN","PSANDF",66,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=+Y,$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT,PSADATA=^(PSALINE)
"RTN","PSANDF",67,0)
 D EDITDISP^PSAUTL1
"RTN","PSANDF",68,0)
 ;
"RTN","PSANDF",69,0)
CHECK I $G(PSANDC)'="" D  Q
"RTN","PSANDF",70,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,PSAFND=0
"RTN","PSANDF",71,0)
 .S PSASUB=0 F  S PSASUB=+$O(^PSDRUG(PSAIEN,1,PSASUB)) Q:'PSASUB  I $P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^")=PSANDC S PSAFND=1 Q
"RTN","PSANDF",72,0)
 .I PSAFND S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",7)=PSASUB
"RTN","PSANDF",73,0)
 ;
"RTN","PSANDF",74,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",7)="0~1"
"RTN","PSANDF",75,0)
 I $P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4),"~")="",$P($P(^(PSALINE),"^",26),"~")="" D
"RTN","PSANDF",76,0)
 .W !,"The vendor did not send a NDC or UPC for the drug. Enter the",!,"NDC if it is available. Enter the UPC if you do not know the NDC.",!
"RTN","PSANDF",77,0)
 .S DIR(0)="SA^N:NDC;U:UPC",DIR("A")="Will you enter the NDC or UPC? ",DIR("B")="N",DIR("??")="^D NDCUPC^PSANDF1" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSANDF",78,0)
 .I Y="N" D GETNDC Q:PSAOUT  S PSANDC=Y,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC
"RTN","PSANDF",79,0)
 .I Y="U" D GETUPC Q:PSAOUT  S PSANDC="S"_Y,PSAUPC=Y,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,$P(^(PSALINE),"^",26)=PSAUPC
"RTN","PSANDF",80,0)
 Q
"RTN","PSANDF",81,0)
 ;
"RTN","PSANDF",82,0)
ONE ;Display for selection if 1 drug is found for that Product Name.
"RTN","PSANDF",83,0)
 S PSAIEN50=$O(^TMP("PSANDF",$J,0))
"RTN","PSANDF",84,0)
 W !!,"The NDC has the VA Product Name of "_PSAVAPN_"."
"RTN","PSANDF",85,0)
 S DIR("A")="Is "_^TMP("PSANDF",$J,PSAIEN50)_" the drug you received",DIR(0)="Y",DIR("B")="N"
"RTN","PSANDF",86,0)
 S DIR("?",1)="Enter Yes if the drug is the one you received for this line item.",DIR("?")="Enter No if it is not the drug you received.",DIR("??")="^D NDFDRG^PSANDF1"
"RTN","PSANDF",87,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSANDF",88,0)
 I +Y S PSAIEN=+PSAIEN50,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=PSAIEN,$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT K ^TMP("PSANDF",$J) D EDITDISP^PSAUTL1 Q
"RTN","PSANDF",89,0)
 D ASKDRUG
"RTN","PSANDF",90,0)
 Q
"RTN","PSANDF",91,0)
 ;
"RTN","PSANDF",92,0)
GETNDC ;Gets NDC for selected drug.
"RTN","PSANDF",93,0)
 S DIR(0)="F^12:12",DIR("A")="NDC",DIR("?")="Enter the 12-digit National Drug Code. Do not enter dashes",DIR("??")="^D NDC^PSANDF1"
"RTN","PSANDF",94,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSANDF",95,0)
 I Y'?12N W !,"You must enter exactly twelve numbers." G GETNDC
"RTN","PSANDF",96,0)
 Q
"RTN","PSANDF",97,0)
GETUPC ;Gets UPC for selected drug.
"RTN","PSANDF",98,0)
 S DIR(0)="F^1:30",DIR("A")="UPC",DIR("?")="Enter the Universal Product Code",DIR("??")="^D UPC^PSANDF1"
"RTN","PSANDF",99,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSANDF",100,0)
 Q
"RTN","PSANDF",101,0)
SUPPLY ;Asks if item is a supply. If so, asks for supply info.
"RTN","PSANDF",102,0)
 S DIR(0)="Y",DIR("A")="Is this a supply item",DIR("?")="Enter YES if the item is not and will never be in the DRUG file",DIR("??")="^D SUP^PSANDF1" D ^DIR K DIR S PSASUPP=Y Q:$G(DIRUT)
"RTN","PSANDF",103,0)
 I 'PSASUPP S PSAPASS=1 Q
"RTN","PSANDF",104,0)
 W ! S DIR(0)="F^3:30",DIR("A",1)="Enter either a description of the item or",DIR("A")="the reason why the item is not in the DRUG file"
"RTN","PSANDF",105,0)
 S DIR("?",1)="If the item is a supply, enter the name of the supply",DIR("?")="or a reason why this item is not in the DRUG file.",DIR("??")="^D REA^PSANDF1" D ^DIR K DIR S PSAREA=Y I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1
"RTN","PSANDF",106,0)
 S:PSAREA="" PSAREA="SUPPLY ITEM"
"RTN","PSANDF",107,0)
 Q:$G(PSAVER)
"RTN","PSANDF",108,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)="",$P(^(PSALINE),"^",16)="",$P(^(PSALINE),"^",17)=""
"RTN","PSANDF",109,0)
 Q
"RTN","PSANDF1")
0^43^B9896545
"RTN","PSANDF1",1,0)
PSANDF1 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSANDF1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSANDF1",3,0)
 ;This routine provides the extended help for calls in PSANDF.
"RTN","PSANDF1",4,0)
 ;
"RTN","PSANDF1",5,0)
NDC ;Extended help for entering NDC
"RTN","PSANDF1",6,0)
 W !?5,"The NDC must be 12-digits. If the NDC does not contain",!?5,"12 numbers, zero fill the section of the NDC that is missing."
"RTN","PSANDF1",7,0)
 W !!?5,"The NDC contains three sections separated by dashes.",!?5,"It contains 6 digits, a dash, 4 digits, a dash, then 2 digits."
"RTN","PSANDF1",8,0)
 W !!?5,"For Example: If the NDC is 12345-123-1, enter 012345012301.",!?5,"             If the NDC is 123456-123-12, enter 123456012312."
"RTN","PSANDF1",9,0)
 Q
"RTN","PSANDF1",10,0)
NDCUPC ;Extended help for selecting either NDC or UPC
"RTN","PSANDF1",11,0)
 W !?5,"Select NDC to enter a National Drug Code prompt.",!?5,"Select UPC to enter a Universal Product Code prompt."
"RTN","PSANDF1",12,0)
 Q
"RTN","PSANDF1",13,0)
NDFDRG ;Extended help for NDF "Is XXX the drug you received?" question.
"RTN","PSANDF1",14,0)
 W !?5,"Enter YES to assign the drug to the line item.",!!?5,"If it is not the drug you received, enter NO. You",!?5,"will then be able to select the correct drug from the DRUG file."
"RTN","PSANDF1",15,0)
 Q
"RTN","PSANDF1",16,0)
REA ;Extended help for 'description or reason why the item is not in the DRUG file'
"RTN","PSANDF1",17,0)
 W !?5,"You must enter a description or reason why the item will never be",!?5,"found in the DRUG file. Enter 1-30 characters. This description or"
"RTN","PSANDF1",18,0)
 W !?5,"reason will be printed on the invoice where the drug name is usually",!?5,"printed. By entering a description or reason, you will be allowed to"
"RTN","PSANDF1",19,0)
 W !?5,$S($D(PSABEFOR):"verify",1:"process")_" the item."
"RTN","PSANDF1",20,0)
 Q
"RTN","PSANDF1",21,0)
SELNDF ;Extended help for selecting a NDF drug
"RTN","PSANDF1",22,0)
 W !?5,"Select the drug you received for the line item.",!?5,"If you want to choose the drug from the DRUG file, enter ""^""."
"RTN","PSANDF1",23,0)
 Q
"RTN","PSANDF1",24,0)
SUP ;Extended help for 'Is this a supply item'
"RTN","PSANDF1",25,0)
 W !?5,"Enter YES if the item is a supply item or if it will never be entered",!?5,"into the DRUG file. Enter NO if the item is or will be in the DRUG file."
"RTN","PSANDF1",26,0)
 Q
"RTN","PSANDF1",27,0)
UPC ;Extended help for entering UPC
"RTN","PSANDF1",28,0)
 W !?5,"Enter up to 30 characters in the Universal Product Code field."
"RTN","PSANDF1",29,0)
 Q
"RTN","PSAONL")
1^44
"RTN","PSAOP")
0^45^B33230190
"RTN","PSAOP",1,0)
PSAOP ;BIR/LTL-Outpatient Dispensing (Single Drug) ;7/23/97
"RTN","PSAOP",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAOP",3,0)
 ;This routine is the gathers OP dispensing for a date range.
"RTN","PSAOP",4,0)
 ;
"RTN","PSAOP",5,0)
 N DIC,DIE,DINUM,D0,D1,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,PSADR,PSADREC,PSADT,PSAPG,PSAS,PSA,PSAOUT,PSARELDT,PSADT,DA,PSADRUG,PSADRUGN,PSALN,PSAP,PSAN,PSAQ,PSAR,X,X2,Y
"RTN","PSAOP",6,0)
LOOK D:'$G(PSALOC) OP^PSADA
"RTN","PSAOP",7,0)
 I $G(PSALOC)<0 K PSALOC G QUIT
"RTN","PSAOP",8,0)
 S:'$G(PSALOCN) PSALOCN=$P($G(^PSD(58.8,+PSALOC,0)),U)
"RTN","PSAOP",9,0)
 S DIR(0)="Y",DIR("A")="OK",DIR("B")="Yes",DIR("?")="No allows you to change Location." D ^DIR K DIR S:$D(DIRUT) PSAOUT=1 G:$D(DIRUT) QUIT I Y=0 K PSALOC D OP^PSADA G:'$G(PSALOC) QUIT
"RTN","PSAOP",10,0)
 I '$O(^PSD(58.8,+PSALOC,1,0)) W !!,"There are no drugs in ",PSALOCN G QUIT
"RTN","PSAOP",11,0)
 D NOW^%DTC S PSADT=X,X="T-60" D ^%DT S PSADT(1)=Y
"RTN","PSAOP",12,0)
 S DIC="^PSD(58.8,+PSALOC,1,",DIC(0)="AEQ",DIC("A")="Please select "_PSALOCN_"'S drug: ",DIC("S")="I $S($P($G(^(0)),U,14):$P($G(^(0)),U,14)>DT,1:1)"
"RTN","PSAOP",13,0)
 S PSAS=$P($G(^PSD(58.8,+PSALOC,0)),U,10),PSADT(3)=0
"RTN","PSAOP",14,0)
 F  W ! S DA(1)=PSALOC D ^DIC G:Y<0 QUIT S PSADRUG=+Y D  G:$G(PSAOUT) QUIT G:$G(PSA(5)) TR D DEV Q:(PSAOUT)
"RTN","PSAOP",15,0)
 .D:'$G(^PSD(58.8,+PSALOC,1,+PSADRUG,6))  Q:$G(PSAOUT)
"RTN","PSAOP",16,0)
 ..W !!,"Dispensing has never been collected for this drug.",!!
"RTN","PSAOP",17,0)
 ..S DIR(0)="D^"_PSADT(1)_":"_PSADT_":AEX",DIR("A")="How far back would you like to collect",DIR("B")="T-60"  D ^DIR K DIR S (PSADT(2),PSADT(4),PSAR,PSAP,PSAN)=Y,(PSADT(3),PSAR(1),PSAP(1),PSAN(1))=0 I Y<1 S PSAOUT=1 Q
"RTN","PSAOP",18,0)
 .S PSAG=$G(^PSD(58.8,+PSALOC,1,+PSADRUG,6))
"RTN","PSAOP",19,0)
 .S:'$G(PSADT(2)) PSADT(2)=$P(PSAG,U),PSA(7)=1
"RTN","PSAOP",20,0)
 .W !!,"Checking dispensing"
"RTN","PSAOP",21,0)
 .S:'$G(PSAR) PSAR=$P(PSAG,U,2) S:'$G(PSAP) PSAP=$P(PSAG,U,7)
"RTN","PSAOP",22,0)
 .S:'$G(PSAN) PSAN=$P(PSAG,U,9) S (PSAR(1),PSAP(1),PSAN(1))=0
"RTN","PSAOP",23,0)
 .F  S PSADT(2)=$O(^PSRX("AL",PSADT(2))) Q:'PSADT(2)  F  S PSADT(3)=$O(^PSRX("AL",+PSADT(2),PSADT(3))) Q:'PSADT(3)  W:'(PSADT(3)#10) "." D:$P($G(^PSRX(+PSADT(3),0)),U,6)=PSADRUG&($P($G(^PSRX(+PSADT(3),2)),U,9)=PSAS)
"RTN","PSAOP",24,0)
 ..S PSADT(4)="" F  S PSADT(4)=$O(^PSRX("AL",+PSADT(2),+PSADT(3),PSADT(4))) Q:PSADT(4)=""  D
"RTN","PSAOP",25,0)
 ...S ^TMP("PSA",$J,+PSADRUG,$E(PSADT(2),1,7))=($P($G(^TMP("PSA",$J,+PSADRUG,$E(PSADT(2),1,7))),U)+$S(PSADT(4):$P($G(^PSRX(+PSADT(3),1,+PSADT(4),0)),U,4),1:$P($G(^PSRX(+PSADT(3),0)),U,7)))_U_PSADT(2)_U_PSADT(3),PSA(9)=PSADT(3)
"RTN","PSAOP",26,0)
 .W !!,"Checking refills"
"RTN","PSAOP",27,0)
 .D:$O(^PSRX("AJ",PSAR))
"RTN","PSAOP",28,0)
 ..F  S PSAR=$O(^PSRX("AJ",PSAR)) Q:'PSAR  F  S PSAR(1)=$O(^PSRX("AJ",+PSAR,+PSAR(1))) Q:'PSAR(1)  W "." D:$P($G(^PSRX(+PSAR(1),0)),U,6)=PSADRUG&($P($G(^PSRX(+PSAR(1),2)),U,9)=PSAS)
"RTN","PSAOP",29,0)
 ...S PSAR(3)="" F  S PSAR(3)=$O(^PSRX("AJ",+PSAR,+PSAR(1),PSAR(3))) Q:PSAR(3)=""  D
"RTN","PSAOP",30,0)
 ....S $P(^TMP("PSA",$J,+PSADRUG,$E(PSAR,1,7)),U)=($P($G(^TMP("PSA",$J,+PSADRUG,$E(PSAR,1,7))),U)-$S(PSAR(3):$P($G(^PSRX(+PSAR(1),1,+PSAR(3),0)),U,4),1:$P($G(^PSRX(+PSAR(1),0)),U,7)))
"RTN","PSAOP",31,0)
 ....S $P(^TMP("PSA",$J,+PSADRUG,$E(PSAR,1,7)),U,4)=PSAR,$P(^($E(PSAR,1,7)),U,5)=PSAR(1),PSAR(2)=PSAR(1)
"RTN","PSAOP",32,0)
 .D:$O(^PSRX("AM",+PSAP))!($O(^PSRX("AN",+PSAN))) AM^PSAOP4
"RTN","PSAOP",33,0)
 .I '$D(^TMP("PSA",$J,+PSADRUG)) W !!,"Sorry, no dispensing for this drug has occurred since " S Y=$S($P(PSAG,U):$P(PSAG,U),1:$G(PSADT(4))) X ^DD("DD") W Y,".",! S PSAOUT=1 Q
"RTN","PSAOP",34,0)
 .S DIR(0)="Y",DIR("A")="Would you like a report of dispensing totals",DIR("B")="Yes" D ^DIR K DIR S:$D(DIRUT) PSAOUT=1 S:Y'=1 PSA(5)=1
"RTN","PSAOP",35,0)
 ;
"RTN","PSAOP",36,0)
DEV K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" I Y=1 W ! D ^%ZIS
"RTN","PSAOP",37,0)
 I $G(POP) W !,"NO DEVICE SELECTED OR ACTION TAKEN!" S PSAOUT=1 G QUIT
"RTN","PSAOP",38,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="LUP^PSAOP",ZTDESC="Drug Acct-OP Dispensing Log",(ZTSAVE("^TMP(""PSA"",$J,+PSADRUG,"),ZTSAVE("PSA*"))="" D ^%ZTLOAD,HOME^%ZIS G QUIT
"RTN","PSAOP",39,0)
LUP S (PSAPG,PSAOUT)=0,PSADRUG(1)=$P($G(^PSDRUG(+PSADRUG,660)),U,6),PSADRUG(2)=$P($G(^(660)),U,8)
"RTN","PSAOP",40,0)
 S X=PSADRUG(1),X2="3$" D COMMA^%DTC S PSADRUG(3)=X
"RTN","PSAOP",41,0)
 D HEADER
"RTN","PSAOP",42,0)
 S (PSA(4),PSA(6))=0 F  S PSA(4)=$O(^TMP("PSA",$J,+PSADRUG,PSA(4))) Q:'PSA(4)  S PSA(6)=PSA(6)+1,Y=PSA(4) X ^DD("DD") D
"RTN","PSAOP",43,0)
 .W !!,Y S X=$P($G(^TMP("PSA",$J,+PSADRUG,PSA(4))),U),X2=0 D COMMA^%DTC W ?14,X,PSADRUG(2),?40,PSADRUG(3),"/",PSADRUG(2),?63
"RTN","PSAOP",44,0)
 .S PSADRUG(4)=$G(PSADRUG(4))+$P($G(^TMP("PSA",$J,+PSADRUG,PSA(4))),U)
"RTN","PSAOP",45,0)
 .S X=$P($G(^TMP("PSA",$J,+PSADRUG,PSA(4))),U)*PSADRUG(1),PSADRUG(5)=$G(PSADRUG(5))+X,X2="2$" D COMMA^%DTC W ?40,X
"RTN","PSAOP",46,0)
 W !,PSALN,!,PSA(6)," DAY TOTALS: " S X=PSADRUG(4),X2=0 D COMMA^%DTC W ?5,X,PSADRUG(2)
"RTN","PSAOP",47,0)
 S X=PSADRUG(5),X2="2$" D COMMA^%DTC W ?63,X
"RTN","PSAOP",48,0)
STOP W:$E(IOST)'="C" @IOF
"RTN","PSAOP",49,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) W ! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR K DIR
"RTN","PSAOP",50,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAOP",51,0)
 W !!,"Updating history and dispensing totals."
"RTN","PSAOP",52,0)
TR S ZTIO="",ZTRTN="LOOP^PSAOP",ZTDESC="Drug Acct-Dispensing Totals",ZTDTH=$H,(ZTSAVE("^TMP(""PSA"",$J,+PSADRUG,"),ZTSAVE("PSA*"))="" D ^%ZTLOAD,HOME^%ZIS
"RTN","PSAOP",53,0)
 K ^TMP("PSA",$J,+PSADRUG),PSA,PSADRUG
"RTN","PSAOP",54,0)
QUIT Q
"RTN","PSAOP",55,0)
HEADER I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAOP",56,0)
 I $$S^%ZTLOAD S PSAOUT=1 Q
"RTN","PSAOP",57,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !,?2,"DAILY DISPENSING TOTALS FOR ",$E($P($G(^PSDRUG(+PSADRUG,0)),U),1,30),?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAOP",58,0)
 W "  DATE",?23,"TOTAL",?45,"$/DISP",?67,"TOTAL",!
"RTN","PSAOP",59,0)
 W "DISPENSED",?23,"DISP",?46,"UNIT",?68,"COST",!,PSALN
"RTN","PSAOP",60,0)
 Q
"RTN","PSAOP",61,0)
LOOP S PSA(2)=0 F  S PSA(2)=$O(^TMP("PSA",$J,+PSADRUG,PSA(2))) Q:'PSA(2)  S PSA(3)=$P(^TMP("PSA",$J,+PSADRUG,PSA(2)),"^") D
"RTN","PSAOP",62,0)
 .S PSA=^TMP("PSA",$J,+PSADRUG,PSA(2)),PSAOP=+$P($G(^PSD(58.8,PSALOC,0)),"^",10),PSARELDT=+$P(PSA(2),".")
"RTN","PSAOP",63,0)
 .K:$D(^XTMP("PSA",PSAOP,PSADRUG,PSARELDT)) ^XTMP("PSA",PSAOP,PSADRUG,PSARELDT)
"RTN","PSAOP",64,0)
 .D ^PSAOP1
"RTN","PSAOP",65,0)
 .S DIE="^PSD(58.8,"_+PSALOC_",1,",DA(1)=PSALOC,DA=PSADRUG
"RTN","PSAOP",66,0)
 .S DR="22////"_$P(PSA,U,2)_";22.1////"_$P(PSA,U,3)_";23////"_$P(PSA,U,4)_";23.1////"_$P(PSA,U,5)_";22.2////"_$P(PSA,U,6)_";22.3////"_$P(PSA,U,7)_";23.2////"_$P(PSA,U,8)_";23.3////"_$P(PSA,U,9)
"RTN","PSAOP",67,0)
 .D ^DIE K DA,DIE,DR
"RTN","PSAOP",68,0)
 Q
"RTN","PSAOP1")
0^46^B17931264
"RTN","PSAOP1",1,0)
PSAOP1 ;BIR/LTL-Outpatient Dispensing (Single Drug) & (All Drugs) ;7/23/97
"RTN","PSAOP1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAOP1",3,0)
 ;PSAOP,PSAOP1,PSAOP2, & PSAOP4 gathers Outpatient dispensing data.
"RTN","PSAOP1",4,0)
 ;PSAOP3 calls this routine to stuff Outpatient dispensing data in
"RTN","PSAOP1",5,0)
 ;#58.81 and update 58.8 balance. It is called by PSAOP, PSAOP2,
"RTN","PSAOP1",6,0)
 ;PSAOP3, & PSAOP4.
"RTN","PSAOP1",7,0)
 ;
"RTN","PSAOP1",8,0)
 N DIC,PSAD,PSAT,PSAB,X
"RTN","PSAOP1",9,0)
 ;Get transaction number
"RTN","PSAOP1",10,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSAOP1",11,0)
FIND S PSAD=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSAD)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSAOP1",12,0)
 S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAD D ^DIC
"RTN","PSAOP1",13,0)
 L -^PSD(58.81,0) K DLAYGO,DINUM
"RTN","PSAOP1",14,0)
 ;Get date + current balance + update balance
"RTN","PSAOP1",15,0)
 F  L +^PSD(58.8,+PSALOC,1,+PSADRUG,0):0 I  Q
"RTN","PSAOP1",16,0)
 S PSAB=$P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,0)),U,4)
"RTN","PSAOP1",17,0)
 S $P(^PSD(58.8,+PSALOC,1,+PSADRUG,0),U,4)=$P($G(^(0)),U,4)-PSA(3)
"RTN","PSAOP1",18,0)
EDO S:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSAOP1",19,0)
 ;If no monthly activity data yet,
"RTN","PSAOP1",20,0)
 I '$D(^PSD(58.8,+PSALOC,1,+PSADRUG,5,+$E(PSA(2),1,5)*100,0)) D
"RTN","PSAOP1",21,0)
 .;Set up current month's node with beginning balance.
"RTN","PSAOP1",22,0)
 .S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DIC(0)="L",DIC("DR")="1////"_$G(PSAB),(X,DINUM)=$E(PSA(2),1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSAOP1",23,0)
 .;Set up last month's node with ending balance.
"RTN","PSAOP1",24,0)
 .S X="T-1M" D ^%DT S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DIC(0)="L",(X,DINUM)=$E(Y,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO S DA=+Y
"RTN","PSAOP1",25,0)
 .S DIE="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DA(2)=PSALOC,DA(1)=PSADRUG
"RTN","PSAOP1",26,0)
 .S DR="3////"_$G(PSAB) D ^DIE K DIE
"RTN","PSAOP1",27,0)
 ;Stuff the Total Dispensed with itself+new dispensing data.
"RTN","PSAOP1",28,0)
 S DIE="^PSD(58.8,"_+PSALOC_",1,"_+PSADRUG_",5,",DR="9////^S X=$P($G(^(0)),U,6)+PSA(3)",DA=$E(PSA(2),1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG D ^DIE K DA
"RTN","PSAOP1",29,0)
 L -^PSD(58.8,+PSALOC,1,+PSADRUG,0)
"RTN","PSAOP1",30,0)
 ;Update transaction
"RTN","PSAOP1",31,0)
 S DIE="^PSD(58.81,",DR="1////6;2////^S X=PSALOC;3///^S X=PSA(2);4////^S X=PSADRUG;5////^S X=PSA(3);9////^S X=$G(PSAB)",DA=PSAD
"RTN","PSAOP1",32,0)
 D ^DIE K DIE,DA,DR
"RTN","PSAOP1",33,0)
 ;Update Activity
"RTN","PSAOP1",34,0)
 S:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSAOP1",35,0)
 S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,4,",DIC(0)="L",(X,DINUM)=PSAD
"RTN","PSAOP1",36,0)
 S DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DA,DINUM,DLAYGO
"RTN","PSAOP1",37,0)
END Q
"RTN","PSAOP1",38,0)
TMP ;TMP("PSA",$J)
"RTN","PSAOP1",39,0)
 N DIC,PSAD,PSAT,PSAB,X
"RTN","PSAOP1",40,0)
 ;Get transaction number
"RTN","PSAOP1",41,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSAOP1",42,0)
FIND1 S PSAD=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSAD)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND1
"RTN","PSAOP1",43,0)
 S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAD D ^DIC
"RTN","PSAOP1",44,0)
 L -^PSD(58.81,0) K DLAYGO,DINUM
"RTN","PSAOP1",45,0)
 ;Get date + current balance + update balance
"RTN","PSAOP1",46,0)
 F  L +^PSD(58.8,+PSALOC,1,+PSADRUG,0):0 I  Q
"RTN","PSAOP1",47,0)
 S PSAB=$P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,0)),U,4)
"RTN","PSAOP1",48,0)
 S $P(^PSD(58.8,+PSALOC,1,+PSADRUG,0),U,4)=$P($G(^(0)),U,4)-PSA(3)
"RTN","PSAOP1",49,0)
 S:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSAOP1",50,0)
 ;;If no monthly activity data yet,
"RTN","PSAOP1",51,0)
 I '$D(^PSD(58.8,+PSALOC,1,+PSADRUG,5,+$E(PSA(2),1,5)*100,0)) D
"RTN","PSAOP1",52,0)
 .;Set up current month's node with beginning balance.
"RTN","PSAOP1",53,0)
 .S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DIC(0)="L",DIC("DR")="1////"_$G(PSAB),(X,DINUM)=$E(PSA(2),1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSAOP1",54,0)
 .;Set up last month's node with ending balance.
"RTN","PSAOP1",55,0)
 .S X="T-1M" D ^%DT S DIC="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DIC(0)="L",(X,DINUM)=$E(Y,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO S DA=+Y
"RTN","PSAOP1",56,0)
 .S DIE="^PSD(58.8,"_+PSALOC_",1,"_+PSADRUG_",5,",DA(2)=PSALOC,DA(1)=PSADRUG
"RTN","PSAOP1",57,0)
 .S DR="3////"_$G(PSAB) D ^DIE K DIE
"RTN","PSAOP1",58,0)
 ;Stuff the Total Dispensed with itself+new dispensing data.
"RTN","PSAOP1",59,0)
 S DIE="^PSD(58.8,+PSALOC,1,+PSADRUG,5,",DR="9////^S X=$P($G(^(0)),U,6)+PSA(3)",DA=$E(PSA(2),1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG D ^DIE K DA
"RTN","PSAOP1",60,0)
 L -^PSD(58.8,+PSALOC,1,+PSADRUG,0)
"RTN","PSAOP1",61,0)
 ;Update transaction
"RTN","PSAOP1",62,0)
 S DIE="^PSD(58.81,",DR="1////6;2////^S X=PSALOC;3///^S X=PSA(2);4////^S X=PSADRUG;5////^S X=PSA(3);9////^S X=$G(PSAB)",DA=PSAD
"RTN","PSAOP1",63,0)
 D ^DIE K DIE,DA,DR
"RTN","PSAOP1",64,0)
 ;Update Activity
"RTN","PSAOP1",65,0)
 S:'$D(^PSD(58.8,+PSALOC,1,+PSADRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSAOP1",66,0)
 S DIC="^PSD(58.8,"_+PSALOC_",1,"_+PSADRUG_",4,",DIC(0)="L",(X,DINUM)=PSAD
"RTN","PSAOP1",67,0)
 S DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DA,DIC,DINUM,DLAYGO
"RTN","PSAOP1",68,0)
 K ^TMP("PSA",$J,PSADRUG)
"RTN","PSAOP1",69,0)
 Q
"RTN","PSAOP2")
0^47^B29186825
"RTN","PSAOP2",1,0)
PSAOP2 ;BIR/LTL-Outpatient Dispensing (All Drugs) ;7/23/97
"RTN","PSAOP2",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAOP2",3,0)
 ;This routine gathers outpatient dispensing for all drugs in a location
"RTN","PSAOP2",4,0)
 ;from the PRESCRIPTION file. If present, the last outpatient dispensing
"RTN","PSAOP2",5,0)
 ;date is used as a starting point. Otherwise the user selected date is
"RTN","PSAOP2",6,0)
 ;used.
"RTN","PSAOP2",7,0)
 ;
"RTN","PSAOP2",8,0)
 N DIC,DIE,DINUM,D0,D1,DA,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,PSAPG,PSA,PSADT,PSADRUG,PSADRUGN,PSAG,PSALN,PSAN,PSAOP,PSAOUT,PSAP,PSAQ,PSAR,PSAREC,PSAS,PSAT,X,X2,Y
"RTN","PSAOP2",9,0)
LOOK D:'$G(PSALOC) OP^PSADA
"RTN","PSAOP2",10,0)
 G:'$G(PSALOC) QUIT W !,$G(PSALOCN)
"RTN","PSAOP2",11,0)
 S DIR(0)="Y",DIR("A")="OK",DIR("B")="Yes",DIR("?")="Answering no will allow you to change Location." D ^DIR K DIR S:$D(DIRUT) PSAOUT=1 G:$D(DIRUT) QUIT I Y=0 K PSALOC D OP^PSADA G:'$G(PSALOC) QUIT
"RTN","PSAOP2",12,0)
 I '$O(^PSD(58.8,+PSALOC,1,0)) W !!,"There are no drugs in ",PSALOCN,!! G QUIT
"RTN","PSAOP2",13,0)
 D NOW^%DTC S PSADT=X,X="T-60" D ^%DT S PSADT(1)=Y,(PSAPG,PSAOUT,PSADRUG)=0
"RTN","PSAOP2",14,0)
 S DIR(0)="D^"_PSADT(1)_":"_PSADT_":AEX",DIR("A")="How far back would you like to collect",DIR("B")="T-60"  D ^DIR K DIR S (PSADT(2),PSADT(22),PSAR,PSAP,PSAN)=Y,(PSADT(3),PSAR(1),PSAP(1),PSAN(1))=0 I Y<1 S PSAOUT=1 Q
"RTN","PSAOP2",15,0)
 S (PSAOP,PSAS)=$P($G(^PSD(58.8,+PSALOC,0)),U,10)
"RTN","PSAOP2",16,0)
 S DIR(0)="Y",DIR("A")="Would you like a report of daily dispensing totals",DIR("B")="Yes" D ^DIR K DIR S:$D(DIRUT) PSAOUT=1 G:$D(DIRUT) STOP
"RTN","PSAOP2",17,0)
 I Y'=1 S PSA(5)=1,ZTIO="",ZTRTN="LUP^PSAOP2",ZTDESC="Drug Acct.-Drug Dispensing Report",ZTSAVE("PSA*")="",ZTDTH=$H D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G STOP
"RTN","PSAOP2",18,0)
DEV K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" I Y=1 W ! D ^%ZIS
"RTN","PSAOP2",19,0)
 I $G(POP) W !,"NO DEVICE SELECTED OR ACTION TAKEN!" S PSAOUT=1 G QUIT
"RTN","PSAOP2",20,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="LUP^PSAOP2",ZTDESC="Drug Acct-Daily Drug Dispensing Log",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G STOP
"RTN","PSAOP2",21,0)
LUP F  S PSADRUG=$O(^PSD(58.8,+PSALOC,1,PSADRUG)) Q:'PSADRUG  D:$Y+5>$G(IOSL)&('$G(PSA(5))) HEADER G:$G(PSAOUT) STOP D:$S($P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,0)),U,14):$P($G(^(0)),U,14)>DT,1:1)
"RTN","PSAOP2",22,0)
 .S PSADRUGN=$P($G(^PSDRUG(+PSADRUG,0)),U)
"RTN","PSAOP2",23,0)
 .I '$G(PSA(5))&('$G(PSAPG)) W @IOF D HEADER
"RTN","PSAOP2",24,0)
 .S PSAG=$G(^PSD(58.8,+PSALOC,1,+PSADRUG,6))
"RTN","PSAOP2",25,0)
 .S:$P(PSAG,U) PSADT(2)=$P(PSAG,U),PSA(7)=1 S:$P(PSAG,U,9) PSAN=$P(PSAG,U,9)
"RTN","PSAOP2",26,0)
 .S:$P(PSAG,U,2) PSAR=$P(PSAG,U,2) S:$P(PSAG,U,7) PSAP=$P(PSAG,U,7)
"RTN","PSAOP2",27,0)
 .F  S PSADT(2)=$O(^PSRX("AL",PSADT(2))) Q:'PSADT(2)  F  S PSADT(3)=$O(^PSRX("AL",+PSADT(2),+PSADT(3))) Q:'PSADT(3)  D:$P($G(^PSRX(+PSADT(3),0)),U,6)=PSADRUG&($P($G(^PSRX(+PSADT(3),2)),U,9)=PSAS)
"RTN","PSAOP2",28,0)
 ..S PSADT(4)="" F  S PSADT(4)=$O(^PSRX("AL",+PSADT(2),+PSADT(3),PSADT(4))) Q:PSADT(4)=""  D
"RTN","PSAOP2",29,0)
 ...S ^TMP("PSA",$J,+PSADRUG,$E(PSADT(2),1,7))=$P($G(^TMP("PSA",$J,+PSADRUG,$E(PSADT(2),1,7))),U)+$S(PSADT(4):$P($G(^PSRX(+PSADT(3),1,+PSADT(4),0)),U,4),1:$P($G(^PSRX(+PSADT(3),0)),U,7))_U_PSADT(2)_U_PSADT(3),PSA(9)=PSADT(3)
"RTN","PSAOP2",30,0)
 .D:$O(^PSRX("AJ",PSAR))
"RTN","PSAOP2",31,0)
 ..F  S PSAR=$O(^PSRX("AJ",PSAR)) Q:'PSAR  F  S PSAR(1)=$O(^PSRX("AJ",+PSAR,+PSAR(1))) Q:'PSAR(1)  D:$P($G(^PSRX(+PSAR(1),0)),U,6)=PSADRUG&($P($G(^PSRX(+PSAR(1),2)),U,9)=PSAS)
"RTN","PSAOP2",32,0)
 ...S PSAR(3)="" F  S PSAR(3)=$O(^PSRX("AJ",+PSAR,+PSAR(1),PSAR(3))) Q:PSAR(3)=""  D
"RTN","PSAOP2",33,0)
 ....S $P(^TMP("PSA",$J,+PSADRUG,$E(PSAR,1,7)),U)=$P($G(^TMP("PSA",$J,+PSADRUG,$E(PSAR,1,7))),U)-$S(PSAR(3):$P($G(^PSRX(+PSAR(1),1,+PSAR(3),0)),U,4),1:$P($G(^PSRX(+PSAR(1),0)),U,7)),PSAR(2)=PSAR(1)
"RTN","PSAOP2",34,0)
 ....S $P(^TMP("PSA",$J,+PSADRUG,$E(PSAR,1,7)),U,4)=PSAR,$P(^($E(PSAR,1,7)),U,5)=PSAR(1)
"RTN","PSAOP2",35,0)
 .D:$O(^PSRX("AM",+PSAP))!($O(^PSRX("AN",+PSAN))) AM^PSAOP4
"RTN","PSAOP2",36,0)
 .S (PSADT(2),PSAR,PSAP,PSAN)=PSADT(22) S PSADT(3)=0 Q:$G(PSA(5))
"RTN","PSAOP2",37,0)
 .I '$D(^TMP("PSA",$J,+PSADRUG)) W !!,$E(PSADRUGN,1,36)," hasn't been dispensed since " S Y=$S($P(PSAG,U):$E($P(PSAG,U),1,7),1:PSADT(22)) X ^DD("DD") W Y,"." Q
"RTN","PSAOP2",38,0)
 .S PSADRUG(1)=$P($G(^PSDRUG(+PSADRUG,660)),U,6),PSADRUG(2)=$P($G(^(660)),U,8)
"RTN","PSAOP2",39,0)
 .S X=PSADRUG(1),X2="3$" D COMMA^%DTC S PSADRUG(3)=X
"RTN","PSAOP2",40,0)
 .S (PSA(4),PSA(6))=0 F  S PSA(4)=$O(^TMP("PSA",$J,+PSADRUG,PSA(4))) Q:'PSA(4)  D:$Y+4>IOSL HEADER Q:PSAOUT  S PSA(6)=PSA(6)+1,Y=PSA(4) X ^DD("DD") D
"RTN","PSAOP2",41,0)
 ..W !!,PSADRUGN,!!,Y S X=$G(^TMP("PSA",$J,+PSADRUG,PSA(4))),X2=0 D COMMA^%DTC W ?14,X,PSADRUG(2),?40,PSADRUG(3),"/",PSADRUG(2),?63
"RTN","PSAOP2",42,0)
 ..S PSADRUG(4)=$G(PSADRUG(4))+$G(^TMP("PSA",$J,+PSADRUG,PSA(4)))
"RTN","PSAOP2",43,0)
 ..S X=$G(^TMP("PSA",$J,+PSADRUG,PSA(4)))*PSADRUG(1),PSADRUG(5)=$G(PSADRUG(5))+X,X2="2$" D COMMA^%DTC W ?40,X
"RTN","PSAOP2",44,0)
 .W !,PSALN,!,PSA(6)," DAY TOTALS: " S X=$G(PSADRUG(4)),X2=0 D COMMA^%DTC W ?5,X,PSADRUG(2)
"RTN","PSAOP2",45,0)
 .S X=$G(PSADRUG(5)),X2="2$" D COMMA^%DTC W ?63,X K PSADRUG(4),PSADRUG(5)
"RTN","PSAOP2",46,0)
 I 'PSADRUG&($G(PSA(5))) S PSAOUT=1
"RTN","PSAOP2",47,0)
STOP W:$E($G(IOST),1,2)="P-" @IOF
"RTN","PSAOP2",48,0)
 I $E($G(IOST))="C",'$G(PSAOUT) W ! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR K DIR
"RTN","PSAOP2",49,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAOP2",50,0)
 I $O(^TMP("PSA",$J,0)) S ZTIO="",ZTRTN="^PSAOP4",ZTDTH=$H,ZTDESC="Drug Acct.-OP Dispensing Totals",(ZTSAVE("^TMP(""PSA"",$J,"),ZTSAVE("PSA*"))="" D ^%ZTLOAD,HOME^%ZIS
"RTN","PSAOP2",51,0)
QUIT K ^TMP("PSA",$J) Q
"RTN","PSAOP2",52,0)
HEADER I $E(IOST,1,2)'="P-",$G(PSAPG) S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAOP2",53,0)
 I $$S^%ZTLOAD S PSAOUT=1 Q
"RTN","PSAOP2",54,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=$G(PSAPG)+1 W !,?2,"DAILY DISPENSING TOTALS FOR ",$E($G(PSALOCN),1,30),?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAOP2",55,0)
 W "  DATE",?23,"TOTAL",?45,"$/DISP",?67,"TOTAL",!
"RTN","PSAOP2",56,0)
 W "DISPENSED",?23,"DISP",?46,"UNIT",?68,"COST",!,PSALN
"RTN","PSAOP2",57,0)
 Q
"RTN","PSAOP3")
0^48^B1700083
"RTN","PSAOP3",1,0)
PSAOP3 ;BIR/LTL,JMB-Nightly Background Job ;7/23/97
"RTN","PSAOP3",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAOP3",3,0)
 ;This is the entry point to gather outpatient pharmacy dispensing data
"RTN","PSAOP3",4,0)
 ;for all drugs in all pharmacy locations. When the drug is released in
"RTN","PSAOP3",5,0)
 ;outpatient, an ^XTMP("PSA") global is set to contain the dispensing
"RTN","PSAOP3",6,0)
 ;data. It is called by PSAPSI3.
"RTN","PSAOP3",7,0)
 ;^XTMP("PSA",59.7 OP Site#,50 Drug#,Date dispensed)=Total Qty Dispensed
"RTN","PSAOP3",8,0)
 ;
"RTN","PSAOP3",9,0)
 N PSA,PSADRUG,PSALOC ;PSA=OP SITE, PSA(1)=DRUG(IEN), PSA(2)=DT
"RTN","PSAOP3",10,0)
LUP S PSA=0 F  S PSA=$O(^XTMP("PSA",PSA)) Q:'PSA  D
"RTN","PSAOP3",11,0)
 .S PSA(1)=0 F  S PSA(1)=$O(^XTMP("PSA",PSA,PSA(1))) Q:'PSA(1)  D
"RTN","PSAOP3",12,0)
 ..S PSA(2)=0 F  S PSA(2)=$O(^XTMP("PSA",PSA,PSA(1),PSA(2))) Q:'PSA(2)  D
"RTN","PSAOP3",13,0)
 ...S PSALOC=$O(^PSD(58.8,"AOP",PSA,0)),PSADRUG=PSA(1)
"RTN","PSAOP3",14,0)
 ...S PSA(3)=$G(^XTMP("PSA",PSA,PSA(1),PSA(2)))
"RTN","PSAOP3",15,0)
 ...D:$D(^PSD(58.8,+PSALOC,1,PSADRUG))&($P($G(^PSD(58.8,+PSALOC,0)),U,2)="P") ^PSAOP1
"RTN","PSAOP3",16,0)
 ...K ^XTMP("PSA",PSA,PSA(1),PSA(2))
"RTN","PSAOP3",17,0)
 S X1=DT,X2=7 D C^%DTC S ^XTMP("PSA",0)=X_"^"_DT_"^Drug Accountability Dispensing Data"
"RTN","PSAOP3",18,0)
QUIT Q
"RTN","PSAOP4")
0^49^B6250004
"RTN","PSAOP4",1,0)
PSAOP4 ;BIR/LTL-Outpatient Dispensing (Single Drug) & (All Drugs) - CONT'D ;7/23/97
"RTN","PSAOP4",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAOP4",3,0)
 ;This routine gathers outpatient dispensing and is called by PSAOP2.
"RTN","PSAOP4",4,0)
 ;
"RTN","PSAOP4",5,0)
 N PSADRUG S PSADRUG=0
"RTN","PSAOP4",6,0)
 F  S PSADRUG=$O(^TMP("PSA",$J,PSADRUG)) Q:'PSADRUG  D
"RTN","PSAOP4",7,0)
 .S PSA(2)=0 F  S PSA(2)=$O(^TMP("PSA",$J,PSADRUG,PSA(2))) Q:'PSA(2)  D
"RTN","PSAOP4",8,0)
 ..S PSA(3)=+^TMP("PSA",$J,PSADRUG,PSA(2)) D TMP^PSAOP1
"RTN","PSAOP4",9,0)
 ..K:$D(^XTMP("PSA",PSAS,PSADRUG)) ^XTMP("PSA",PSAS,PSADRUG)
"RTN","PSAOP4",10,0)
QUIT K ^TMP("PSA",$J) S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSAOP4",11,0)
 Q
"RTN","PSAOP4",12,0)
 ;
"RTN","PSAOP4",13,0)
AM ;Collects partial fills released & returned to stock.
"RTN","PSAOP4",14,0)
 F  S PSAP=$O(^PSRX("AM",PSAP)) Q:'PSAP  F  S PSAP(1)=$O(^PSRX("AM",+PSAP,PSAP(1))) Q:'PSAP(1)  D:$P($G(^PSRX(+PSAP(1),0)),U,6)=PSADRUG&($P($G(^PSRX(+PSAP(1),2)),U,9)=PSAS)
"RTN","PSAOP4",15,0)
 .S PSAP(2)="" F  S PSAP(2)=$O(^PSRX("AM",+PSAP,+PSAP(1),PSAP(2))) Q:'PSAP(2)  S $P(^TMP("PSA",$J,+PSADRUG,$E(PSAP,1,7)),U)=$P($G(^TMP("PSA",$J,+PSADRUG,$E(PSAP,1,7))),U)+$P($G(^PSRX(+PSAP(1),"P",+PSAP(2),0)),U,4) D
"RTN","PSAOP4",16,0)
 ..S $P(^TMP("PSA",$J,+PSADRUG,$E(PSAP,1,7)),U,6)=PSAP,$P(^($E(PSAP,1,7)),U,7)=PSAP(1)
"RTN","PSAOP4",17,0)
 F  S PSAN=$O(^PSRX("AN",PSAN)) Q:'PSAN  F  S PSAN(1)=$O(^PSRX("AN",+PSAN,PSAN(1))) Q:'PSAN(1)  D:$P($G(^PSRX(+PSAN(1),0)),U,6)=PSADRUG&($P($G(^PSRX(+PSAN(1),2)),U,0)=PSAS)
"RTN","PSAOP4",18,0)
 .S PSAN(2)="" F  S PSAN(2)=$O(^PSRX("AN",+PSAN,+PSAN(1),PSAN(2))) Q:'PSAN(2)  S $P(^TMP("PSA",$J,+PSADRUG,$E(PSAN,1,7)),U)=$P($G(^($E(PSAN,1,7))),U)-$P($G(^PSRX(+PSAN(1),"P",+PSAN(2),0)),U,4) D
"RTN","PSAOP4",19,0)
 ..S $P(^TMP("PSA",$J,+PSADRUG,$E(PSAN,1,7)),U,8)=PSAN,$P(^($E(PSAN,1,7)),U,9)=PSAN(1)
"RTN","PSAOP4",20,0)
 Q
"RTN","PSAORDP")
0^50^B66639820
"RTN","PSAORDP",1,0)
PSAORDP ;BIR/JMB-Print Orders ;9/19/97
"RTN","PSAORDP",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAORDP",3,0)
 ;This routine selects the orders, invoices, or invoice status to be
"RTN","PSAORDP",4,0)
 ;printed from the DRUG ACCOUNTABILITY ORDERS. It calls PSAORDP1 to
"RTN","PSAORDP",5,0)
 ;print processed invoices and ^PSAUP4 to print unprocessed invoices.
"RTN","PSAORDP",6,0)
 ;
"RTN","PSAORDP",7,0)
 I '$D(^XUSEC("PSA ORDERS",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSAORDP",8,0)
START W !! S DIR(0)="S^O:Order Number;I:Invoice Number;S:Invoice Status",DIR("A")="Print by Order#, Invoice#, or Invoice Status",DIR("B")="O",DIR("??")="^D SELHELP^PSAORDP" D ^DIR K DIR
"RTN","PSAORDP",9,0)
 Q:$G(DIRUT)  S PSAPRT=Y,PSAOUT=0
"RTN","PSAORDP",10,0)
 D:PSAPRT="O" ORDER D:PSAPRT="I" INVOICE D:PSAPRT="S" STATUS G:PSAOUT EXIT
"RTN","PSAORDP",11,0)
 I PSAPRT="O"!(PSAPRT="I"),$O(PSAORD(""))="" G EXIT
"RTN","PSAORDP",12,0)
 W ! S %ZIS="Q" D ^%ZIS G:POP EXIT
"RTN","PSAORDP",13,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSAORDP",14,0)
 .S ZTDESC="Drug Acct. - Print Prime Vendor Invoices",ZTRTN="DQ^PSAORDP"
"RTN","PSAORDP",15,0)
 .F PSASAVE="PSAINV","PSAPRT","PSASTA" S:$D(@PSASAVE) ZTSAVE(PSASAVE)=""
"RTN","PSAORDP",16,0)
 .S ZTSAVE("PSAORD(")="" D ^%ZTLOAD
"RTN","PSAORDP",17,0)
 ;
"RTN","PSAORDP",18,0)
DQ S PSAOUT=0
"RTN","PSAORDP",19,0)
 I PSAPRT="O" D PRTORD G EXIT
"RTN","PSAORDP",20,0)
 I PSAPRT="I" D PRTINV G EXIT
"RTN","PSAORDP",21,0)
 D:PSAPRT="S" PRTSTA
"RTN","PSAORDP",22,0)
 ;
"RTN","PSAORDP",23,0)
EXIT W:$E(IOST,1,2)="C-" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAORDP",24,0)
 K %,%ZIS,DA,DIC,DTOUT,DUOUT,PSA,PSAAECST,PSABY,PSACIEN,PSACNT,PSACTRL,PSACTRLH,PSADATA,PSADEC,PSADJDRG,PSADJSUP,PSADLN,PSADONE,PSADRG,PSADS
"RTN","PSAORDP",25,0)
 K PSAECOST,PSAEND,PSAFIN,PSAFIRST,PSAFPG,PSAICOST,PSAIECST,PSAIN,PSAINV,PSAINVB,PSAINVBH,PSAINVH,PSALINE,PSANDC,PSAORD,PSAORDB,PSAOUT,PSAPAGE,PSAPC,PSAPRT,PSARUN
"RTN","PSAORDP",26,0)
 K PSAS,PSASAVE,PSASLN,PSASS,PSAST,PSASTA,PSASUB,PSATOT,PSAXCNT,X,ZTDESC,ZTRTN,ZTSAVE
"RTN","PSAORDP",27,0)
 Q
"RTN","PSAORDP",28,0)
 ;
"RTN","PSAORDP",29,0)
INVOICE ;Prompts for order and invoice
"RTN","PSAORDP",30,0)
 K PSAORD S (PSACNT,PSADONE,PSAFIN,PSAXCNT)=0,PSASLN="",$P(PSASLN,"-",80)=""
"RTN","PSAORDP",31,0)
 F  W !,PSASLN S DIR(0)="FO^1:22",DIR("A")="Select ORDER NUMBER",DIR("?")="Enter the order number of the invoice to be printed",DIR("??")="^D ORDIHELP^PSAORDP" D ^DIR K DIR D  Q:PSAOUT!(PSAFIN)
"RTN","PSAORDP",32,0)
 .S PSAORDB=Y I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAORDP",33,0)
 .I PSAORDB="" S PSAFIN=1 Q
"RTN","PSAORDP",34,0)
 .Q:PSAORDB=" "
"RTN","PSAORDP",35,0)
 .;In 58.811
"RTN","PSAORDP",36,0)
 .I $O(^PSD(58.811,"B",PSAORDB,0)) S PSAORD=+$O(^PSD(58.811,"B",PSAORDB,0)),PSAINVB="" D
"RTN","PSAORDP",37,0)
 ..F  S PSAINVB=$O(^PSD(58.811,PSAORD,1,"B",PSAINVB)) Q:PSAINVB=""  S PSACNT=PSACNT+1,(PSAINV,PSAINVH)=$O(^PSD(58.811,PSAORD,1,"B",PSAINVB,0)),PSAINVBH=PSAINVB
"RTN","PSAORDP",38,0)
 .;In XTMP
"RTN","PSAORDP",39,0)
 .Q:PSAOUT  S (PSACTRL,PSADONE)=0
"RTN","PSAORDP",40,0)
 .F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""!(PSADONE)  D
"RTN","PSAORDP",41,0)
 ..I $P($G(^XTMP("PSAPV",PSACTRL,"IN")),"^",4)=PSAORDB S PSAXCNT=PSAXCNT+1,(PSAINVH,PSAINVB)=$P(^("IN"),"^",2),PSACTRLH=PSACTRL,PSA(PSAORDB,PSAINVB,PSACTRL)=""
"RTN","PSAORDP",42,0)
 .Q:PSAOUT
"RTN","PSAORDP",43,0)
 .I PSACNT,'PSAXCNT D  Q
"RTN","PSAORDP",44,0)
 ..I PSACNT=1 W !,"Invoice# "_PSAINVBH S PSAORD(PSAORDB,PSAORD)=PSAINVH Q
"RTN","PSAORDP",45,0)
 ..D:PSACNT>1 INV
"RTN","PSAORDP",46,0)
 .I 'PSACNT,PSAXCNT D  Q
"RTN","PSAORDP",47,0)
 ..I PSAXCNT=1 W !,"Invoice# "_PSAINVH S PSAORD(PSAORDB,0)=PSAINVH_"~"_PSACTRLH,PSACTRL=PSACTRLH Q
"RTN","PSAORDP",48,0)
 ..D:PSAXCNT>1 INVXTMP
"RTN","PSAORDP",49,0)
 .I PSACNT,PSAXCNT D INVBOTH Q
"RTN","PSAORDP",50,0)
 .I '$D(PSAORD(PSAORDB)) W !,PSAORDB_" is an invalid order number."
"RTN","PSAORDP",51,0)
 Q
"RTN","PSAORDP",52,0)
 ;
"RTN","PSAORDP",53,0)
INV ;Select invoice from 58.811
"RTN","PSAORDP",54,0)
 S (PSACNT,PSADONE)=0
"RTN","PSAORDP",55,0)
 F  S DA(1)=PSAORD,DIC="^PSD(58.811,"_DA(1)_",1,",DIC("A")="Select INVOICE NUMBER: ",DIC(0)="AEMZQ",DA(1)=PSAORD D ^DIC K DIC D  Q:PSAOUT!(PSADONE)
"RTN","PSAORDP",56,0)
 .I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAORDP",57,0)
 .I Y=-1 S PSADONE=1 Q
"RTN","PSAORDP",58,0)
 .I 'PSACNT S PSAORD(PSAORDB,PSAORD)=+Y,PSACNT=1 Q
"RTN","PSAORDP",59,0)
 .I PSACNT S PSAORD(PSAORDB,PSAORD)=PSAORD(PSAORDB,PSAORD)_","_+Y
"RTN","PSAORDP",60,0)
 Q
"RTN","PSAORDP",61,0)
 ;
"RTN","PSAORDP",62,0)
INVXTMP ;Select invoice from XTMP
"RTN","PSAORDP",63,0)
 S (PSAXCNT,PSADONE)=0,PSAFIRST=1
"RTN","PSAORDP",64,0)
 F  S DIR(0)="FO^1:22",DIR("A")="Select INVOICE NUMBER" D ^DIR K DIR D  Q:PSAOUT!(PSADONE)
"RTN","PSAORDP",65,0)
 .I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAORDP",66,0)
 .I Y="" S PSADONE=1 Q
"RTN","PSAORDP",67,0)
 .Q:Y=" "  S PSAINV=Y
"RTN","PSAORDP",68,0)
 .I 'PSAXCNT S PSAORD(PSAORDB,0)=Y_"~"_PSACTRLH,PSAXCNT=1 Q
"RTN","PSAORDP",69,0)
 .I PSAXCNT S PSACTRL=PSACTRLH S:'PSAFIRST PSAORD(PSAORDB,0)=PSAORD(PSAORDB,0)_","_Y_"~"_PSACTRL S:PSAFIRST PSAORD(PSAORDB,0)=Y_"~"_PSACTRL,PSAFIRST=0
"RTN","PSAORDP",70,0)
 Q
"RTN","PSAORDP",71,0)
 ;
"RTN","PSAORDP",72,0)
INVBOTH ;Select invoice from XTMP & 58.811
"RTN","PSAORDP",73,0)
 S (PSADONE)=0
"RTN","PSAORDP",74,0)
 F  S DIR(0)="FO^1:22",DIR("A")="Select INVOICE NUMBER" D ^DIR K DIR D  Q:PSAOUT!(PSADONE)
"RTN","PSAORDP",75,0)
 .I $G(DTOUT)!($G(DUOUT)) S PSAXCNT=1 Q
"RTN","PSAORDP",76,0)
 .Q:Y=" "
"RTN","PSAORDP",77,0)
 .I Y="" S PSADONE=1 Q
"RTN","PSAORDP",78,0)
 .S PSAINVB=Y,PSAINV=$O(^PSD(58.811,PSAORD,1,"B",PSAINVB,0))
"RTN","PSAORDP",79,0)
 .I PSAINV S:$D(PSAORD(PSAORDB,PSAORD)) PSAORD(PSAORDB,PSAORD)=PSAORD(PSAORDB,PSAORD)_","_PSAINV S:'$D(PSAORD(PSAORDB,PSAORD)) PSAORD(PSAORDB,PSAORD)=PSAINV Q
"RTN","PSAORDP",80,0)
 .I $D(PSA(PSAORDB,PSAINVB)) S PSACTRL=$O(PSA(PSAORDB,PSAINVB,0)) I PSACTRL'="" S:$D(PSAORD(PSAORDB,0)) PSAORD(PSAORDB,0)=PSAORD(PSAORDB,0)_","_PSAINVB_"~"_PSACTRL S:'$D(PSAORD(PSAORDB,0)) PSAORD(PSAORDB,0)=PSAINVB_"~"_PSACTRL Q
"RTN","PSAORDP",81,0)
 .W !,PSAINVB_" is an invalid invoice number."
"RTN","PSAORDP",82,0)
 Q
"RTN","PSAORDP",83,0)
 ;
"RTN","PSAORDP",84,0)
PRTINV ;Loops thru orders & invoices to print invoices
"RTN","PSAORDP",85,0)
 S PSAORDB="" F  S PSAORDB=$O(PSAORD(PSAORDB)) Q:PSAORDB=""!(PSAOUT)  D
"RTN","PSAORDP",86,0)
 .S PSAORD="" F  S PSAORD=$O(PSAORD(PSAORDB,PSAORD)) Q:PSAORD=""!(PSAOUT)  D
"RTN","PSAORDP",87,0)
 ..F PSAPC=1:1 S PSAINV=$P(PSAORD(PSAORDB,PSAORD),",",PSAPC) Q:PSAINV=""!(PSAOUT)  D
"RTN","PSAORDP",88,0)
 ...I PSAORD D ^PSAORDP1 Q
"RTN","PSAORDP",89,0)
 ...S PSACTRL=$P(PSAINV,"~",2),PSAINV=$P(PSAINV,"~"),IOM=80
"RTN","PSAORDP",90,0)
 ...D NOW^%DTC S Y=% D DD^%DT S PSARUN=$E(Y,1,18),PSAPAGE=1,$P(PSASLN,"-",80)="",$P(PSADLN,"=",80)="",PSADJDRG=0,PSAFPG=1
"RTN","PSAORDP",91,0)
 ...D START^PSAUP4
"RTN","PSAORDP",92,0)
 Q
"RTN","PSAORDP",93,0)
 ;
"RTN","PSAORDP",94,0)
ORDER ;Select order
"RTN","PSAORDP",95,0)
 K PSAORD S PSADONE=0
"RTN","PSAORDP",96,0)
 F  W ! S DIR(0)="FO^1:22",DIR("A")="Select ORDER NUMBER",DIR("?")="Enter the number of the order to be printed",DIR("??")="^D ORDHELP^PSAORDP" D ^DIR K DIR D  Q:PSAOUT!(PSADONE)
"RTN","PSAORDP",97,0)
 .I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAORDP",98,0)
 .Q:X=" "
"RTN","PSAORDP",99,0)
 .I X="" S PSADONE=1 Q
"RTN","PSAORDP",100,0)
 .I $O(^PSD(58.811,"B",Y,0)) S PSAORD(Y,+$O(^PSD(58.811,"B",Y,0)))=""
"RTN","PSAORDP",101,0)
 .S PSACTRL=0 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""!(PSADONE)  I $P($G(^XTMP("PSAPV",PSACTRL,"IN")),"^",4)=Y S PSAORD(Y,0)="",PSADONE=1
"RTN","PSAORDP",102,0)
 .S PSADONE=0
"RTN","PSAORDP",103,0)
 .I '$D(PSAORD(X)) W !,Y_" is an invalid order number."
"RTN","PSAORDP",104,0)
 Q
"RTN","PSAORDP",105,0)
 ;
"RTN","PSAORDP",106,0)
PRTORD ;Loops thru invoices to print all for one order
"RTN","PSAORDP",107,0)
 S PSAORDB="" F  S PSAORDB=$O(PSAORD(PSAORDB)) Q:PSAORDB=""!(PSAOUT)  D
"RTN","PSAORDP",108,0)
 .S PSAORD="" F  S PSAORD=$O(PSAORD(PSAORDB,PSAORD)) Q:PSAORD=""!(PSAOUT)  D
"RTN","PSAORDP",109,0)
 ..I 'PSAORD S PSACTRL=0 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""!(PSAOUT)  D
"RTN","PSAORDP",110,0)
 ...Q:$P($G(^XTMP("PSAPV",PSACTRL,"IN")),"^",4)'=PSAORDB
"RTN","PSAORDP",111,0)
 ...D NOW^%DTC S Y=% D DD^%DT S PSARUN=$E(Y,1,18),PSAPAGE=1,$P(PSASLN,"-",80)="",$P(PSADLN,"=",80)="",PSADJDRG=0,PSAFPG=1
"RTN","PSAORDP",112,0)
 ...S PSAINV=$P($G(^XTMP("PSAPV",PSACTRL,"IN")),"^",2) D START^PSAUP4
"RTN","PSAORDP",113,0)
 ..I PSAORD S PSAINVB="" F  S PSAINVB=$O(^PSD(58.811,PSAORD,1,"B",PSAINVB)) Q:PSAINVB=""!(PSAOUT)  S PSAINV=$O(^PSD(58.811,PSAORD,1,"B",PSAINVB,0)) D ^PSAORDP1
"RTN","PSAORDP",114,0)
 G EXIT
"RTN","PSAORDP",115,0)
 ;
"RTN","PSAORDP",116,0)
STATUS ;Select status
"RTN","PSAORDP",117,0)
 W ! S DIR(0)="SOB^U:Unprocessed;P:Processed",DIR("A")="Select Unprocessed or Processed Invoice Status",DIR("??")="^D STATHELP^PSAORDP"
"RTN","PSAORDP",118,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAORDP",119,0)
 S PSASTA=Y
"RTN","PSAORDP",120,0)
 I PSASTA="P",'$O(^PSD(58.811,"ASTAT","P",0)) W !!,"There are no invoices with the status of Processed." G STATUS
"RTN","PSAORDP",121,0)
 I PSASTA="U" D  G:'PSACNT STATUS
"RTN","PSAORDP",122,0)
 .S (PSACNT,PSACTRL)=0 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""!(PSACNT)  I $D(^XTMP("PSAPV",PSACTRL,"IN")),$P(^("IN"),"^",8)'="P" S PSACNT=1
"RTN","PSAORDP",123,0)
 .I 'PSACNT W !!,"There are no invoices with the status of Unprocessed."
"RTN","PSAORDP",124,0)
 Q
"RTN","PSAORDP",125,0)
 ;
"RTN","PSAORDP",126,0)
PRTSTA ;Sets up printing & prints Unprocessed invoices
"RTN","PSAORDP",127,0)
 G:PSASTA="P" PROCESS
"RTN","PSAORDP",128,0)
 S PSACTRL=0 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""!(PSAOUT)  D
"RTN","PSAORDP",129,0)
 .Q:$P($G(^XTMP("PSAPV",PSACTRL,"IN")),"^",8)="P"
"RTN","PSAORDP",130,0)
 .S IOM=80 D NOW^%DTC S Y=% D DD^%DT S PSARUN=$E(Y,1,18),PSAPAGE=1,$P(PSASLN,"-",80)="",$P(PSADLN,"=",80)="",PSADJDRG=0,PSAFPG=1
"RTN","PSAORDP",131,0)
 .D START^PSAUP4
"RTN","PSAORDP",132,0)
 Q
"RTN","PSAORDP",133,0)
 ;
"RTN","PSAORDP",134,0)
PROCESS ;Prints Processed invoices
"RTN","PSAORDP",135,0)
 ;S PSAORDB="" F  S PSAORDB=$O(^PSD(58.811,"AORD",PSAORDB)) Q:PSAORDB=""!(PSAOUT)  D
"RTN","PSAORDP",136,0)
 ;.S PSAINVB="" F  S PSAINVB=$O(^PSD(58.811,"AORD",PSAORDB,PSAINVB)) Q:PSAINVB=""!(PSAOUT)  D
"RTN","PSAORDP",137,0)
 ;..S PSAORD=0 F  S PSAORD=$O(^PSD(58.811,"AORD",PSAORDB,PSAINVB,PSAORD)) Q:'PSAORD!(PSAOUT)  D
"RTN","PSAORDP",138,0)
 ;...S PSAINV=0 F  S PSAINV=$O(^PSD(58.811,"AORD",PSAORDB,PSAINVB,PSAORD,PSAINV))  Q:'PSAINV!(PSAOUT)  D ^PSAORDP1
"RTN","PSAORDP",139,0)
 S PSAORD=0 F  S PSAORD=$O(^PSD(58.811,"ASTAT","P",PSAORD)) Q:'PSAORD!(PSAOUT)  D
"RTN","PSAORDP",140,0)
 .S PSAINV=0 F  S PSAINV=$O(^PSD(58.811,"ASTAT","P",PSAORD,PSAINV)) Q:'PSAINV!(PSAOUT)  D
"RTN","PSAORDP",141,0)
 ..S PSAORDB=$P($G(^PSD(58.811,PSAORD,0)),"^"),PSAINVB=$P($G(^PSD(58.811,PSAORD,1,PSAINV,0)),"^") Q:PSAORDB=""!(PSAINVB="")  D ^PSAORDP1
"RTN","PSAORDP",142,0)
 G EXIT
"RTN","PSAORDP",143,0)
 ;
"RTN","PSAORDP",144,0)
ORDHELP ;Extended help to Select Order
"RTN","PSAORDP",145,0)
 W !?5,"Enter the order number assigned to the order to be print."
"RTN","PSAORDP",146,0)
 Q
"RTN","PSAORDP",147,0)
ORDIHELP ;Extended help to Select Invoice's Order
"RTN","PSAORDP",148,0)
 W !?5,"Enter the invoice's order number to be print. The invoice number ",!?5,"prompt will follow."
"RTN","PSAORDP",149,0)
 Q
"RTN","PSAORDP",150,0)
SELHELP ;Extended help to Print by Order#, Invoice#, or Invoice Status
"RTN","PSAORDP",151,0)
 W !?5,"To print all invoices for a specific order, select Order Number.",!?5,"To print a specific invoice, select Invoice Number. To print all"
"RTN","PSAORDP",152,0)
 W !?5,"invoices with an unprocessed or processed status, select Invoice",!?5,"Status."
"RTN","PSAORDP",153,0)
 Q
"RTN","PSAORDP",154,0)
STATHELP ;Extended help for Enter Status
"RTN","PSAORDP",155,0)
 W !?5,"Enter U to print all uploaded invoices that have not been processed.",!?5,"Enter P to print all processed invoices that have not been verified."
"RTN","PSAORDP",156,0)
 Q
"RTN","PSAORDP1")
0^51^B64718282
"RTN","PSAORDP1",1,0)
PSAORDP1 ;BIR/JMB-Print Orders - CONT'D ;9/19/97
"RTN","PSAORDP1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAORDP1",3,0)
 ;This routine prints invoices from the DRUG ACCOUNTABILITY ORDERS
"RTN","PSAORDP1",4,0)
 ;file on the screen or to a printer.
"RTN","PSAORDP1",5,0)
 ;
"RTN","PSAORDP1",6,0)
DQ S IOM=80 D NOW^%DTC S Y=% D DD^%DT S PSARUN=$E(Y,1,18),PSAPAGE=1,$P(PSASLN,"-",80)="",$P(PSADLN,"=",80)="",(PSADJDRG,PSAOUT)=0,PSAFPG=1
"RTN","PSAORDP1",7,0)
 S PSAEND=0,PSAORDER=$P(^PSD(58.811,PSAORD,0),"^") D HEADER^PSAORDP2
"RTN","PSAORDP1",8,0)
 S PSAIN=$G(^PSD(58.811,PSAORD,1,PSAINV,0)),PSAINVN=$P(PSAIN,"^"),PSASTA=$P(PSAIN,"^",3),PSADEL=+$P(PSAIN,"^",6),PSAREC=+$P(PSAIN,"^",7)
"RTN","PSAORDP1",9,0)
START W !,"PRIME VENDOR : ",$S($P($G(^PSD(58.811,PSAORD,0)),"^",2)'="":$P($G(^(0)),"^",2),1:"UNKNOWN")
"RTN","PSAORDP1",10,0)
 W !!,"ORDER#  : "_PSAORDER,?40,"ORDER DATE   : "_$$DATE($P(PSAIN,"^",4))
"RTN","PSAORDP1",11,0)
 W !,"INVOICE#: "_PSAINVN,?40,"INVOICE DATE : "_$$DATE($P(PSAIN,"^",2))
"RTN","PSAORDP1",12,0)
 W !,"STATUS  : "_$S(PSASTA="P":"PROCESSED",PSASTA="V":"VERIFIED",PSASTA="C":"COMPLETED",1:"UNKNOWN")_$S(+$P(PSAIN,"^",13):" (SUPPLY INVOICE)",1:"")
"RTN","PSAORDP1",13,0)
 W ?40,"DELIVERY DATE: "_$S(PSADEL:$$DATE(PSADEL),1:"UNKNOWN")
"RTN","PSAORDP1",14,0)
 W !?40,"DATE RECEIVED: "_$S(PSAREC:$$DATE(PSAREC),PSADEL:$$DATE(PSADEL),1:"UNKNOWN"),!
"RTN","PSAORDP1",15,0)
 S PSADJDRG=0 S (PSAIECST,PSAAECST)=0 D LINE
"RTN","PSAORDP1",16,0)
 ;
"RTN","PSAORDP1",17,0)
EXIT ;Kills printing variables only
"RTN","PSAORDP1",18,0)
 K %,DIR,DIRUT,PSAAECST,PSACIEN,PSADATA,PSADATE,PSADEC,PSADEL,PSADJ,PSADJD,PSADJDP,PSADJDRG,PSADJSUP,PSADJDV,PSADPDT,PSADPDUZ,PSADVDT,PSADVDUZ,PSADJO,PSADJOP,PSADJOV
"RTN","PSAORDP1",19,0)
 K PSADJP,PSADJPP,PSADJPV,PSADJQ,PSADJQP,PSADJQV,PSADLN,PSADRG,PSAECOST,PSAEND,PSAFPG,PSAICOST,PSAIECST,PSAIN,PSAINVN
"RTN","PSAORDP1",20,0)
 K PSALN,PSAMORE,PSANDC,PSANODE,PSAOPDT,PSAOPDUZ,PSAORDER,PSAOU,PSAOVDT,PSAOVDUZ,PSAPAGE,PSAPPDT,PSAPPDUZ,PSAPRICE
"RTN","PSAORDP1",21,0)
 K PSAPVDT,PSAPVDUZ,PSAQPDT,PSAQPDUZ,PSAQPREA,PSAQVDT,PSAQVDUZ,PSAQVREA,PSAREC,PSARUN,PSAS,PSASLN,PSASS,PSASTA,PSATOT,Y
"RTN","PSAORDP1",22,0)
 Q
"RTN","PSAORDP1",23,0)
 ;
"RTN","PSAORDP1",24,0)
DATE(PSADATE)         ;convert date
"RTN","PSAORDP1",25,0)
 S %=$E(PSADATE,4,5)_"/"_$E(PSADATE,6,7)_"/"_$E(PSADATE,2,3)
"RTN","PSAORDP1",26,0)
 I $TR(%,"/")="" S %="UNKNOWN"
"RTN","PSAORDP1",27,0)
 Q %
"RTN","PSAORDP1",28,0)
 ;
"RTN","PSAORDP1",29,0)
LINE ;print line items
"RTN","PSAORDP1",30,0)
 D LINEHDR^PSAORDP2 S (PSAICOST,PSALN,PSATOT)=0
"RTN","PSAORDP1",31,0)
 F  S PSALN=+$O(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN)) Q:'PSALN!(PSAOUT)  D  Q:PSAOUT
"RTN","PSAORDP1",32,0)
 .Q:'$D(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,0))
"RTN","PSAORDP1",33,0)
 .S PSADATA=^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,0)
"RTN","PSAORDP1",34,0)
 .K PSADJQP,PSAQPDUZ,PSAQPDT,PSAQPREA,PSADJQV,PSAQVDUZ,PSAQVDT,PSAQVREA
"RTN","PSAORDP1",35,0)
 .K PSADJOP,PSAOPDUZ,PSAOPDT,PSADJOV,PSAOVDUZ,PSAOVDT
"RTN","PSAORDP1",36,0)
 .K PSADJPP,PSAPPDUZ,PSAPPDT,PSADJPV,PSAPVDUZ,PSAPVDT
"RTN","PSAORDP1",37,0)
 .K PSADJDP,PSADPDUZ,PSADPDT,PSADJDV,PSADVDUZ,PSADVDT
"RTN","PSAORDP1",38,0)
 .S PSADJSUP=0
"RTN","PSAORDP1",39,0)
 .I $D(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2)) S PSAMORE=4 D
"RTN","PSAORDP1",40,0)
 ..S:+$P(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2),"^") PSAMORE=5
"RTN","PSAORDP1",41,0)
 ..S:+$P(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2),"^",2) PSAMORE=PSAMORE+1
"RTN","PSAORDP1",42,0)
 .E  S PSAMORE=4
"RTN","PSAORDP1",43,0)
 .I ($Y+PSAMORE)>IOSL D:$E(IOST,1,2)="C-" SCREEN^PSAORDP2 Q:PSAOUT  D HEADER^PSAORDP2,LINEHDR^PSAORDP2
"RTN","PSAORDP1",44,0)
 .W !,$P(PSADATA,"^")
"RTN","PSAORDP1",45,0)
DRUG .S PSADRG=0,PSADJ=+$O(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,1,"B","D",0))
"RTN","PSAORDP1",46,0)
 .I +PSADJ D
"RTN","PSAORDP1",47,0)
 ..S PSANODE=$G(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,1,PSADJ,0))
"RTN","PSAORDP1",48,0)
 ..S PSADJD=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAORDP1",49,0)
 ..I +PSADJD,$L(PSADJD)=+$L(PSADJD),$P($G(^PSDRUG(+PSADJD,0)),"^")'="" D  Q
"RTN","PSAORDP1",50,0)
 ...W ?8,"*"_$P($G(^PSDRUG(+PSADJD,0)),"^") S PSADJDRG=1,PSADRG=PSADJD
"RTN","PSAORDP1",51,0)
 ...I $P(PSANODE,"^",6)'="" S PSADJDV=$P(PSANODE,"^",6),PSADVDT=$P(PSANODE,"^",8),PSADVDUZ=$P(PSANODE,"^",9)
"RTN","PSAORDP1",52,0)
 ...I $P(PSANODE,"^",2)'="" S PSADJDP=$P(PSANODE,"^",2),PSADPDT=$P(PSANODE,"^",4),PSADPDUZ=$P(PSANODE,"^",5)
"RTN","PSAORDP1",53,0)
 ..I +PSADJD,$L(PSADJD)=+$L(PSADJD),$P($G(^PSDRUG(+PSADJD,0)),"^")="" S PSADJ=0 Q
"RTN","PSAORDP1",54,0)
 ..W ?7,"**"_PSADJD S PSADJSUP=1,PSADRG=0
"RTN","PSAORDP1",55,0)
 ..I $P(PSANODE,"^",6)'="" S PSADJDV=$P(PSANODE,"^",6),PSADVDT=$P(PSANODE,"^",8),PSADVDUZ=$P(PSANODE,"^",9)
"RTN","PSAORDP1",56,0)
 ..I $P(PSANODE,"^",2)'="" S PSADJDP=$P(PSANODE,"^",2),PSADPDT=$P(PSANODE,"^",4),PSADPDUZ=$P(PSANODE,"^",5)
"RTN","PSAORDP1",57,0)
 .I '+PSADJ D
"RTN","PSAORDP1",58,0)
 ..S PSADRG=$S(+$P(PSADATA,"^",2)&($P($G(^PSDRUG(+$P(PSADATA,"^",2),0)),"^")'=""):+$P(PSADATA,"^",2),1:0)
"RTN","PSAORDP1",59,0)
 ..W ?9,$S(+$P(PSADATA,"^",2)&($P($G(^PSDRUG(+$P(PSADATA,"^",2),0)),"^")'=""):$P(^PSDRUG(+$P(PSADATA,"^",2),0),"^"),1:"DRUG UNKNOWN")
"RTN","PSAORDP1",60,0)
CS .I +$P(PSADATA,"^",10) W " (CONTROLLED SUBS)" I $P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSADRG,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !?5,"*** INACTIVE IN MASTER VAULT ***"
"RTN","PSAORDP1",61,0)
 .E  I PSADRG,$P($G(^PSD(58.8,+$P(PSAIN,"^",5),1,PSADRG,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !?5,"*** INACTIVE IN PHARMACY LOCATION ***"
"RTN","PSAORDP1",62,0)
UPC .W:$P(PSADATA,"^",13)'="" !?9,"UPC: "_$P(PSADATA,"^",13)
"RTN","PSAORDP1",63,0)
NDC .S PSANDC=$P(PSADATA,"^",11)
"RTN","PSAORDP1",64,0)
 .I $E(PSANDC)'="S" W !?9,$S(PSANDC'=""&(PSANDC?12N):$E(PSANDC,1,6)_"-"_$E(PSANDC,7,10)_"-"_$E(PSANDC,11,12),1:"NDC UNKNOWN")
"RTN","PSAORDP1",65,0)
 .S PSASUB=$S(+$P($G(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2)),"^",3):+$P($G(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2)),"^",3),+$O(^PSDRUG("C",PSANDC,+PSADRG,0)):+$O(^PSDRUG("C",PSANDC,+PSADRG,0)),1:0)
"RTN","PSAORDP1",66,0)
 .;
"RTN","PSAORDP1",67,0)
VSN .W ?25,$S($P(PSADATA,"^",12)'="":$P(PSADATA,"^",12),1:"VSN UNKNOWN")
"RTN","PSAORDP1",68,0)
 .;
"RTN","PSAORDP1",69,0)
QTY .;No Adj. Qty
"RTN","PSAORDP1",70,0)
 .S PSAIECST=PSAIECST+($P(PSADATA,"^",3)*$P(PSADATA,"^",5))
"RTN","PSAORDP1",71,0)
 .S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,1,"B","P",0))
"RTN","PSAORDP1",72,0)
 .I +PSADJ S PSANODE=$G(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,1,PSADJ,0)),PSAPRICE=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:+$P(PSANODE,"^",2))
"RTN","PSAORDP1",73,0)
 .I '+PSADJ S PSAPRICE=$P(PSADATA,"^",5)
"RTN","PSAORDP1",74,0)
 .S PSADJQ="",PSADJ=+$O(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,1,"B","Q",0))
"RTN","PSAORDP1",75,0)
 .I +PSADJ S PSANODE=$G(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,1,PSADJ,0)),PSADJQ=$S($P(PSANODE,"^",6)'="":+$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAORDP1",76,0)
 .;Adj. Qty
"RTN","PSAORDP1",77,0)
 .I +PSADJQ D
"RTN","PSAORDP1",78,0)
 ..I $P(PSANODE,"^",6)'="" S PSADJQV=$P(PSANODE,"^",6),PSAQVREA=$P(PSANODE,"^",7),PSAQVDT=$P(PSANODE,"^",8),PSAQVDUZ=$P(PSANODE,"^",9)
"RTN","PSAORDP1",79,0)
 ..I $P(PSANODE,"^",2)'="" S PSADJQP=$P(PSANODE,"^",2),PSAQPREA=$P(PSANODE,"^",3),PSAQPDT=$P(PSANODE,"^",4),PSAQPDUZ=$P(PSANODE,"^",5)
"RTN","PSAORDP1",80,0)
 ..S PSAECOST=PSADJQ*PSAPRICE,PSAAECST=PSAAECST+PSAECOST
"RTN","PSAORDP1",81,0)
 ..W ?40,$S($G(PSADJQV)'="":$J(PSADJQV,6),1:$J(PSADJQP,6))_"("_$P(PSADATA,"^",3)_")"
"RTN","PSAORDP1",82,0)
 .I '+PSADJQ W ?40,$J($P(PSADATA,"^",3),6) S PSAECOST=$P(PSADATA,"^",3)*PSAPRICE,PSAAECST=PSAAECST+PSAECOST
"RTN","PSAORDP1",83,0)
 .;
"RTN","PSAORDP1",84,0)
OU .;Order Unit
"RTN","PSAORDP1",85,0)
 .S PSAOU=$S(+$P(PSADATA,"^",4):$P($G(^DIC(51.5,+$P(PSADATA,"^",4),0)),"^"),+PSASUB&(+$P($G(^PSDRUG(PSADRG,1,+PSASUB,0)),"^",5)):$P($G(^DIC(51.5,+$P($G(^PSDRUG(PSADRG,1,+PSASUB,0)),"^",5),0)),"^"),1:"")
"RTN","PSAORDP1",86,0)
 .S PSADJO="",PSADJ=+$O(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,1,"B","O",0))
"RTN","PSAORDP1",87,0)
 .I +PSADJ S PSANODE=$G(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,1,PSADJ,0)),PSADJO=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAORDP1",88,0)
 .;Adj. Order Unit
"RTN","PSAORDP1",89,0)
 .I PSADJO'="" D
"RTN","PSAORDP1",90,0)
 ..I $P(PSANODE,"^",6)'="" S PSADJOV=$P(PSANODE,"^",6),PSAOVDT=$P(PSANODE,"^",8),PSAOVDUZ=$P(PSANODE,"^",9)
"RTN","PSAORDP1",91,0)
 ..I $P(PSANODE,"^",2)'="" S PSADJOP=$P(PSANODE,"^",2),PSAOPDT=$P(PSANODE,"^",4),PSAOPDUZ=$P(PSANODE,"^",5)
"RTN","PSAORDP1",92,0)
 ..W ?53,$S(+PSADJO:$P($G(^DIC(51.5,+PSADJO,0)),"^"),1:"UNKNOWN")_" ("_$S(PSAOU'="":PSAOU,1:"")_")"
"RTN","PSAORDP1",93,0)
 .I PSADJO="" W ?53,$S(PSAOU'="":PSAOU,1:"()")
"RTN","PSAORDP1",94,0)
 .;
"RTN","PSAORDP1",95,0)
PRICE .;Unit price
"RTN","PSAORDP1",96,0)
 .S PSADEC=$S($L($P($P(PSADATA,"^",5),".",2))>1:$L($P($P(PSADATA,"^",5),".",2)),1:2)
"RTN","PSAORDP1",97,0)
 .S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,1,"B","P",0))
"RTN","PSAORDP1",98,0)
 .I +PSADJ S PSANODE=$G(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,1,PSADJ,0)),PSADJP=$S(+$P(PSANODE,"^",6):+$P(PSANODE,"^",6),1:+$P(PSANODE,"^",2))
"RTN","PSAORDP1",99,0)
 .;Adj. Unit Price
"RTN","PSAORDP1",100,0)
 .I +PSADJP D
"RTN","PSAORDP1",101,0)
 ..I +$P(PSANODE,"^",6) S PSADJPV=$P(PSANODE,"^",6),PSAPVDT=$P(PSANODE,"^",8),PSAPVDUZ=$P(PSANODE,"^",9)
"RTN","PSAORDP1",102,0)
 ..I +$P(PSANODE,"^",2) S PSADJPP=$P(PSANODE,"^",2),PSAPPDT=$P(PSANODE,"^",4),PSAPPDUZ=$P(PSANODE,"^",5)
"RTN","PSAORDP1",103,0)
 ..W ?60,$J(PSADJP,7,2)_" ("_$S(+$P(PSADATA,"^",5):$P(PSADATA,"^",5),$P(PSADATA,"^",5)=0:0,1:"")_")"
"RTN","PSAORDP1",104,0)
 .I '+PSADJP D
"RTN","PSAORDP1",105,0)
 ..I +$P(PSADATA,"^",5)!($P(PSADATA,"^",5)=0) W ?60,$S(+$P(PSADATA,"^",5):$J($P(PSADATA,"^",5),7,PSADEC),1:0) Q
"RTN","PSAORDP1",106,0)
 ..W ?65,"(Blank)"
"RTN","PSAORDP1",107,0)
 .;
"RTN","PSAORDP1",108,0)
XCOST .;Extended cost
"RTN","PSAORDP1",109,0)
 .W:PSADJP ?67,$J(PSAECOST,7,2) W:'PSADJP ?70,$J(PSAECOST,9,2)
"RTN","PSAORDP1",110,0)
 .;
"RTN","PSAORDP1",111,0)
LEVELS .;If Processed status & new stock level, reorder level, or dispense units per order unit, print the data.
"RTN","PSAORDP1",112,0)
 .I PSASTA="P",$D(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2)) D
"RTN","PSAORDP1",113,0)
 ..W:+$P(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2),"^") !?9,"DISPENSE UNITS PER ORDER UNIT: "_$FN(+$P(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2),"^"),",")
"RTN","PSAORDP1",114,0)
 ..W:+$P(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2),"^",4) !?9,"STOCK LEVEL  : "_$FN(+$P(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2),"^",4),",")
"RTN","PSAORDP1",115,0)
 ..W:+$P(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2),"^",2) !?9,"REORDER LEVEL: "_$FN(+$P(^PSD(58.811,PSAORD,1,PSAINV,1,PSALN,2),"^",2),",")
"RTN","PSAORDP1",116,0)
 .;
"RTN","PSAORDP1",117,0)
 .I $Y+5>IOSL D:$E(IOST,1,2)="C-" SCREEN^PSAORDP2 Q:PSAOUT  D HEADER^PSAORDP2 D LINEHDR^PSAORDP2
"RTN","PSAORDP1",118,0)
 .D ^PSAORDP2 Q:PSAOUT
"RTN","PSAORDP1",119,0)
 .W !
"RTN","PSAORDP1",120,0)
 Q:PSAOUT
"RTN","PSAORDP1",121,0)
 I $Y+5>IOSL D:$E(IOST,1,2)="C-" SCREEN^PSAORDP2 Q:PSAOUT  D HEADER^PSAORDP2
"RTN","PSAORDP1",122,0)
 W !,PSASLN
"RTN","PSAORDP1",123,0)
 I +PSAAECST'=+PSAIECST D
"RTN","PSAORDP1",124,0)
 .W !?47,"TOTAL ADJUSTED COST",?67,$J(PSAAECST,12,2),!
"RTN","PSAORDP1",125,0)
 .I +$O(^PSD(58.811,PSAORD,1,PSAINV,2,0)) D
"RTN","PSAORDP1",126,0)
 ..S PSACIEN=0 F  S PSACIEN=+$O(^PSD(58.811,PSAORD,1,PSAINV,2,PSACIEN)) Q:'PSACIEN  D
"RTN","PSAORDP1",127,0)
 ...Q:'$D(^PSD(58.811,PSAORD,1,PSAINV,2,PSACIEN,0))
"RTN","PSAORDP1",128,0)
 ...I $Y+3>IOSL D:$E(IOST,1,2)="C-" SCREEN^PSAORDP2 Q:PSAOUT  D HEADER^PSAORDP2
"RTN","PSAORDP1",129,0)
 ...W:+$P(^PSD(58.811,PSAORD,1,PSAINV,2,PSACIEN,0),"^",3) ?55,"CREDIT MEMO "_$J($P(^(0),"^",3),12,2),!
"RTN","PSAORDP1",130,0)
 W !?47,"TOTAL INVOICED COST",?67,$J(PSAIECST,12,2)
"RTN","PSAORDP1",131,0)
 S PSAEND=1
"RTN","PSAORDP1",132,0)
 I $E(IOST)'="C" D
"RTN","PSAORDP1",133,0)
 .I PSADJDRG D:$Y+4>IOSL HEADER^PSAORDP2 W !!," * THE DRUG WAS MATCHED TO THE DRUG FILE.",!
"RTN","PSAORDP1",134,0)
 .I PSADJSUP D:$Y+4>IOSL HEADER^PSAORDP2 W !,"** THE ITEM IS A SUPPLY ITEM.",!
"RTN","PSAORDP1",135,0)
 D:$E(IOST,1,2)="C-" SCREEN^PSAORDP2
"RTN","PSAORDP1",136,0)
 W !
"RTN","PSAORDP1",137,0)
 Q
"RTN","PSAORDP2")
0^52^B11720132
"RTN","PSAORDP2",1,0)
PSAORDP2 ;BIR/JMB-Print Orders - CONT'D ;7/23/97
"RTN","PSAORDP2",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAORDP2",3,0)
 ;This routine prints the adjustment and header data on the invoices.
"RTN","PSAORDP2",4,0)
 ;It is called from PSAORDP1
"RTN","PSAORDP2",5,0)
 ;
"RTN","PSAORDP2",6,0)
ADJD ;Print Adj Drug
"RTN","PSAORDP2",7,0)
 I $G(PSADJD)'="" D  Q:PSAOUT
"RTN","PSAORDP2",8,0)
 .I ($G(PSADJDV)'=""&($Y+5>IOSL))!(($G(PSADJDP)'=""&($Y+4>IOSL))) D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAORDP2",9,0)
 .I $G(PSADJDV)'="" W !?9,$$DATE^PSAORDP1(PSADVDT)_" "_$P($G(^VA(200,+PSADVDUZ,0)),"^")_" (V)"
"RTN","PSAORDP2",10,0)
 .I $G(PSADJDP)'="" W !?9,$$DATE^PSAORDP1(PSADPDT)_" "_$P($G(^VA(200,+PSADPDUZ,0)),"^")_" (P)"
"RTN","PSAORDP2",11,0)
 ;
"RTN","PSAORDP2",12,0)
ADJQ ;Print Adj Qty
"RTN","PSAORDP2",13,0)
 I $G(PSADJQ)'="" D  Q:PSAOUT
"RTN","PSAORDP2",14,0)
 .I ($G(PSADJQV)'=""&($Y+8>IOSL))!(($G(PSADJQP)'=""&($Y+6>IOSL))) D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAORDP2",15,0)
 .W !!?9,"ADJUSTED QUANTITY: "_PSADJQ
"RTN","PSAORDP2",16,0)
 .I $G(PSADJQV)'="" W !?9,$$DATE^PSAORDP1(PSAQVDT)_" "_$P($G(^VA(200,+PSAQVDUZ,0)),"^")_" (V) = "_PSADJQV,!?11,PSAQVREA
"RTN","PSAORDP2",17,0)
 .I $G(PSADJQP)'="" W !?9,$$DATE^PSAORDP1(PSAQPDT)_" "_$P($G(^VA(200,+PSAQPDUZ,0)),"^")_" (P) = "_PSADJQP,!?11,PSAQPREA
"RTN","PSAORDP2",18,0)
 ;
"RTN","PSAORDP2",19,0)
ADJO ;Print Adj Order Unit
"RTN","PSAORDP2",20,0)
 I $G(PSADJO)'="" D  Q:PSAOUT
"RTN","PSAORDP2",21,0)
 .I ($G(PSADJOV)'=""&($Y+6>IOSL))!(($G(PSADJOP)'=""&($Y+4>IOSL))) D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAORDP2",22,0)
 .W !!,?9,"ADJUSTED ORDER UNIT: "_$P($G(^DIC(51.5,+PSADJO,0)),"^")
"RTN","PSAORDP2",23,0)
 .I $G(PSADJOV)'="" W !?9,$$DATE^PSAORDP1(PSAOVDT)_" "_$P($G(^VA(200,+PSAOVDUZ,0)),"^")_" (V) = "_$P($G(^DIC(51.5,+PSADJOV,0)),"^")
"RTN","PSAORDP2",24,0)
 .I $G(PSADJOP)'="" W !?9,$$DATE^PSAORDP1(PSAOPDT)_" "_$P($G(^VA(200,+PSAOPDUZ,0)),"^")_" (P) = "_$P($G(^DIC(51.5,+PSADJOP,0)),"^")
"RTN","PSAORDP2",25,0)
 ;
"RTN","PSAORDP2",26,0)
ADJP ;Print Adj Price
"RTN","PSAORDP2",27,0)
 I +$G(PSADJP) D  Q:PSAOUT
"RTN","PSAORDP2",28,0)
 .I ($G(PSADJPV)'=""&($Y+6>IOSL))!(($G(PSADJPP)'=""&($Y+4>IOSL))) D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAORDP2",29,0)
 .W !!,?9,"ADJUSTED PRICE PER ORDER UNIT: $"_$S($L($P(PSADJP,".",2))<2:$FN(PSADJP,",",2),1:PSADJP)
"RTN","PSAORDP2",30,0)
 .I $G(PSADJPV)'="" W !?9,$$DATE^PSAORDP1(PSAPVDT)_" "_$P($G(^VA(200,+PSAPVDUZ,0)),"^")_" (V) = $"_$S($L($P(PSADJPV,".",2))<2:$FN(PSADJPV,",",2),1:PSADJPV)
"RTN","PSAORDP2",31,0)
 .I $G(PSADJPP)'="" W !?9,$$DATE^PSAORDP1(PSAPPDT)_" "_$P($G(^VA(200,+PSAPPDUZ,0)),"^")_" (P) = $"_$S($L($P(PSADJPP,".",2))<2:$FN(PSADJPP,",",2),1:PSADJPP)
"RTN","PSAORDP2",32,0)
 Q
"RTN","PSAORDP2",33,0)
 ;
"RTN","PSAORDP2",34,0)
LINEHDR ;item header
"RTN","PSAORDP2",35,0)
 W !?50,"ORDER",?62,"COST/",?71,"EXTENDED"
"RTN","PSAORDP2",36,0)
 W !,"LINE#",?9,"NDC",?25,"VSN",?43,"QTY",?51,"UNIT",?62,"UNIT",?75,"COST",!,PSADLN,!
"RTN","PSAORDP2",37,0)
 Q
"RTN","PSAORDP2",38,0)
 ;
"RTN","PSAORDP2",39,0)
HEADER ;Page header
"RTN","PSAORDP2",40,0)
 I PSAFPG&($E(IOST,1,2)="C-") W @IOF G HDR1
"RTN","PSAORDP2",41,0)
 S PSAFPG=0
"RTN","PSAORDP2",42,0)
 I 'PSAFPG W @IOF
"RTN","PSAORDP2",43,0)
HDR1 W !?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE"
"RTN","PSAORDP2",44,0)
 W !?27,"PRIME VENDOR ORDER REPORT",!
"RTN","PSAORDP2",45,0)
 W:PSAPAGE'=1 !,"ORDER#: "_PSAORDER_"  INVOICE#: "_PSAINVN
"RTN","PSAORDP2",46,0)
 I $E(IOST,1,2)="C-" W ?(74-$L(PSAPAGE)),"PAGE "_PSAPAGE,!,PSADLN
"RTN","PSAORDP2",47,0)
 I $E(IOST)'="C" W !,"RUN: "_PSARUN,?(74-$L(PSAPAGE)),"PAGE "_PSAPAGE,!,PSADLN
"RTN","PSAORDP2",48,0)
 S PSAPAGE=PSAPAGE+1
"RTN","PSAORDP2",49,0)
 Q
"RTN","PSAORDP2",50,0)
SCREEN ;Hold on screen
"RTN","PSAORDP2",51,0)
 S PSAS=20-$Y I +PSAS F PSASS=1:1:PSAS W !
"RTN","PSAORDP2",52,0)
 I PSADJDRG,PSAEND W " * THE DRUG WAS MATCHED TO THE DRUG FILE."
"RTN","PSAORDP2",53,0)
 I PSADJSUP,PSAEND W !,"** THE ITEM IS A SUPPLY ITEM."
"RTN","PSAORDP2",54,0)
 S DIR(0)="E" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1
"RTN","PSAORDP2",55,0)
 Q
"RTN","PSAPOST")
0^53^B3787169
"RTN","PSAPOST",1,0)
PSAPOST ;BIR/JMB-Post Init ;7/23/97
"RTN","PSAPOST",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPOST",3,0)
 ;If there is a NDC in field #31, the NDC is added to the SYNONYM
"RTN","PSAPOST",4,0)
 ;multiple.
"RTN","PSAPOST",5,0)
 ;
"RTN","PSAPOST",6,0)
SYNONYM D BMES^XPDUTL("Copying the NDCs to the SYNONYM multiple in the DRUG file.")
"RTN","PSAPOST",7,0)
 S PSAIEN=0 F  S PSAIEN=$O(^PSDRUG(PSAIEN)) Q:'PSAIEN  D
"RTN","PSAPOST",8,0)
 .Q:$P($G(^PSDRUG(PSAIEN,2)),"^",4)=""
"RTN","PSAPOST",9,0)
 .S PSANDC4=$P($G(^PSDRUG(PSAIEN,2)),"^",4)
"RTN","PSAPOST",10,0)
 .S PSANDC=$E("000000",1,(6-$L($P(PSANDC4,"-"))))_$P(PSANDC4,"-")_$E("0000",1,(4-$L($P(PSANDC4,"-",2))))_$P(PSANDC4,"-",2)_$E("00",1,(2-$L($P(PSANDC4,"-",3))))_$P(PSANDC4,"-",3)
"RTN","PSAPOST",11,0)
 .S PSADASH=$E("000000",1,(6-$L($P(PSANDC4,"-"))))_$P(PSANDC4,"-")_"-"_$E("0000",1,(4-$L($P(PSANDC4,"-",2))))_$P(PSANDC4,"-",2)_"-"_$E("00",1,(2-$L($P(PSANDC4,"-",3))))_$P(PSANDC4,"-",3)
"RTN","PSAPOST",12,0)
 .I '$D(^PSDRUG(PSAIEN,1,0)) S ^PSDRUG(PSAIEN,1,0)="^50.1A^^"
"RTN","PSAPOST",13,0)
 .K DD,DO,DA S DA(1)=PSAIEN,DIC="^PSDRUG("_DA(1)_",1,",DIC(0)="LM",X=PSANDC,DLAYGO=50 D ^DIC K DIC,DLAYGO
"RTN","PSAPOST",14,0)
 .Q:$G(DA)=""
"RTN","PSAPOST",15,0)
 .S DR="2///"_PSADASH_";1///D",DA=+Y,DIE="^PSDRUG("_DA(1)_",1,"
"RTN","PSAPOST",16,0)
 .F  L +^PSDRUG(PSAIEN,0):0 I  Q
"RTN","PSAPOST",17,0)
 .D ^DIE K DIE L -^PSDRUG(PSAIEN,0)
"RTN","PSAPOST",18,0)
 K DA,DIC,DIE,DR,PSADASH,PSAIEN,PSANDC,PSANDC4,X,Y
"RTN","PSAPOST",19,0)
 D BMES^XPDUTL("Copying NDCs is complete!")
"RTN","PSAPOST",20,0)
 Q
"RTN","PSAPROC")
0^54^B57730280
"RTN","PSAPROC",1,0)
PSAPROC ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data ;10/9/97
"RTN","PSAPROC",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPROC",3,0)
 ;This routine assigns a pharmacy location or master vault to all invoices.
"RTN","PSAPROC",4,0)
 ;
"RTN","PSAPROC",5,0)
 I '$D(^XUSEC("PSA ORDERS",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSAPROC",6,0)
ESIG D SIG^XUSESIG I X1="" S PSAOUT=1 G EXIT
"RTN","PSAPROC",7,0)
 S PSASLN="",$P(PSASLN,"-",80)="",PSADLN="",$P(PSADLN,"=",80)="",(PSACNT,PSACTRL,PSAOUT)=0
"RTN","PSAPROC",8,0)
 ;
"RTN","PSAPROC",9,0)
CNT ;Count invoices that need a pharm location or master vault assigned.
"RTN","PSAPROC",10,0)
 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""  D
"RTN","PSAPROC",11,0)
 .Q:'$D(^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAPROC",12,0)
 .S PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC",13,0)
 .I $P(PSAIN,"^",10)="ALL CS",$P(PSAIN,"^",12)="" S PSACNT=PSACNT+1,PSACS(PSACTRL)="" Q
"RTN","PSAPROC",14,0)
 .I $P(PSAIN,"^",10)'="ALL CS" D
"RTN","PSAPROC",15,0)
 ..I $P(PSAIN,"^",9)="CS" S:$P(PSAIN,"^",7)="" PSANCS(PSACTRL)="" S:$P(PSAIN,"^",12)="" PSACS(PSACTRL)="" S:$P(PSAIN,"^",7)=""!($P(PSAIN,"^",12)="") PSACNT=PSACNT+1 Q
"RTN","PSAPROC",16,0)
 ..I $P(PSAIN,"^",9)="",$P(PSAIN,"^",7)="" S PSACNT=PSACNT+1,PSANCS(PSACTRL)=""
"RTN","PSAPROC",17,0)
 I 'PSACNT D ^PSAPROC1 G EXIT
"RTN","PSAPROC",18,0)
 ;
"RTN","PSAPROC",19,0)
 ;Gets pharmacy locations
"RTN","PSAPROC",20,0)
 S (PSALOC,PSANUM)=0 F  S PSALOC=+$O(^PSD(58.8,"ADISP","P",PSALOC)) Q:'PSALOC  D
"RTN","PSAPROC",21,0)
 .Q:'$D(^PSD(58.8,PSALOC,0))!($P($G(^PSD(58.8,PSALOC,0)),"^")="")
"RTN","PSAPROC",22,0)
 .I +$G(^PSD(58.8,PSALOC,"I")),+^PSD(58.8,PSALOC,"I")'>DT Q
"RTN","PSAPROC",23,0)
 .S PSANUM=PSANUM+1,PSAONE=PSALOC,PSAISIT=+$P(^PSD(58.8,PSALOC,0),"^",3),PSAOSIT=+$P(^(0),"^",10)
"RTN","PSAPROC",24,0)
 .D SITES^PSAUTL1 S PSALOCA($P(^PSD(58.8,PSALOC,0),"^")_PSACOMB,PSALOC)=PSAISIT_"^"_PSAOSIT
"RTN","PSAPROC",25,0)
 ;
"RTN","PSAPROC",26,0)
 ;Gets master vaults
"RTN","PSAPROC",27,0)
 S (PSAMVN,PSAMV)=0 F  S PSAMV=+$O(^PSD(58.8,"ADISP","M",PSAMV)) Q:'PSAMV  D
"RTN","PSAPROC",28,0)
 .Q:'$D(^PSD(58.8,PSAMV,0))!($P($G(^PSD(58.8,PSAMV,0)),"^")="")
"RTN","PSAPROC",29,0)
 .I +$G(^PSD(58.8,PSAMV,"I")),+^PSD(58.8,PSAMV,"I")'>DT Q
"RTN","PSAPROC",30,0)
 .S PSAMVN=PSAMVN+1,PSAONEMV=PSAMV,PSAMV($P(^PSD(58.8,PSAMV,0),"^"),PSAMV)=""
"RTN","PSAPROC",31,0)
 I 'PSANUM D NONE G EXIT
"RTN","PSAPROC",32,0)
 I PSANUM=1 D ONE Q:PSAOUT
"RTN","PSAPROC",33,0)
 I PSANUM>1 D MANY Q:PSAOUT
"RTN","PSAPROC",34,0)
 D ^PSAPROC1 G EXIT
"RTN","PSAPROC",35,0)
 ;
"RTN","PSAPROC",36,0)
NONE ;No DA pharmacy locations
"RTN","PSAPROC",37,0)
 W !!,"There are no Drug Accountability pharmacy locations.",!!,"Use the Set Up/Edit a Pharmacy Location option on Pharmacy Location Maintenance"
"RTN","PSAPROC",38,0)
 W !,"Menu to setup one or more pharmacy locations. Then select the Process Uploaded",!,"Prime Vendor Invoice Data option to process the invoices."
"RTN","PSAPROC",39,0)
 D END S PSA=$O(PSACS("")) D:PSA'="" MASTER,END
"RTN","PSAPROC",40,0)
 Q
"RTN","PSAPROC",41,0)
 ;
"RTN","PSAPROC",42,0)
ONE ;Only one location
"RTN","PSAPROC",43,0)
 S PSACNT=0,PSALOC=PSAONE,PSALOCN=$O(PSALOCA(""))
"RTN","PSAPROC",44,0)
 W !!,"The invoices are being assigned to the pharmacy location. Please wait."
"RTN","PSAPROC",45,0)
 S PSACTRL="" F  S PSACTRL=$O(PSANCS(PSACTRL)) Q:PSACTRL=""  D
"RTN","PSAPROC",46,0)
 .Q:'$D(^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAPROC",47,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",7)=PSALOC,PSACNT=1 W "."
"RTN","PSAPROC",48,0)
 H 1 S PSA=$O(PSACS("")) D:PSA'="" MASTER
"RTN","PSAPROC",49,0)
 Q
"RTN","PSAPROC",50,0)
 ;
"RTN","PSAPROC",51,0)
MANY ;If more than one pharmacy location, display invoices.
"RTN","PSAPROC",52,0)
 S PSACTRL="" F  S PSACTRL=$O(PSANCS(PSACTRL)) Q:PSACTRL=""  D  Q:PSAOUT
"RTN","PSAPROC",53,0)
 .Q:'$D(^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAPROC",54,0)
 .S PSAIN=$G(^XTMP("PSAPV",PSACTRL,"IN")),PSAORD=$P(PSAIN,"^",4),PSAINV=$P(PSAIN,"^",2)
"RTN","PSAPROC",55,0)
 .D DISPLOC
"RTN","PSAPROC",56,0)
 .W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN)
"RTN","PSAPROC",57,0)
 .W:$D(PSACS(PSACTRL)) !,"Some controlled substances" D SELECT
"RTN","PSAPROC",58,0)
 S PSA=$O(PSACS("")) D:PSA'="" MASTER,END K PSAMENU,PSALOCA
"RTN","PSAPROC",59,0)
 Q
"RTN","PSAPROC",60,0)
 ;
"RTN","PSAPROC",61,0)
DISPLOC ;Displays the active pharmacy locations.
"RTN","PSAPROC",62,0)
 W @IOF,!?19,"<<< ASSIGN A PHARMACY LOCATION SCREEN >>>",!,PSASLN
"RTN","PSAPROC",63,0)
 S (PSACNT,PSASTOP)=0,PSALOCN=""
"RTN","PSAPROC",64,0)
 F  S PSALOCN=$O(PSALOCA(PSALOCN)) Q:PSALOCN=""!(PSASTOP)  D
"RTN","PSAPROC",65,0)
 .S PSALOC=0 F  S PSALOC=$O(PSALOCA(PSALOCN,PSALOC)) Q:'PSALOC!(PSASTOP)  D
"RTN","PSAPROC",66,0)
 ..S PSACNT=PSACNT+1,PSAMENU(PSACNT,PSALOCN,PSALOC)=PSALOC
"RTN","PSAPROC",67,0)
 ..I $Y+3>IOSL D HDR I PSAOUT S PSAOUT=0,PSASTOP=1 Q
"RTN","PSAPROC",68,0)
 ..W !,$J(PSACNT,2)_"." W:$L(PSALOCN)>72 ?4,$P(PSALOCN,"(IP)",1)_"(IP)",!?21,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<73 ?4,PSALOCN
"RTN","PSAPROC",69,0)
 W ! K PSASTOP
"RTN","PSAPROC",70,0)
 Q
"RTN","PSAPROC",71,0)
 ;
"RTN","PSAPROC",72,0)
HDR D END
"RTN","PSAPROC",73,0)
 W @IOF,!?19,"<<< ASSIGN A PHARMACY LOCATION SCREEN >>>",!,PSASLN
"RTN","PSAPROC",74,0)
 Q
"RTN","PSAPROC",75,0)
 ;
"RTN","PSAPROC",76,0)
SELECT ;Select the Pharmacy Location to be assigned to the order.
"RTN","PSAPROC",77,0)
 W ! K DIR S DIR(0)="NO^1:"_PSACNT,DIR("A")="Pharmacy Location",DIR("?")="Select the pharmacy location that received the invoice's drugs"
"RTN","PSAPROC",78,0)
 S DIR("??")="^D PHARM^PSAPROC" D ^DIR K DIR Q:Y=""
"RTN","PSAPROC",79,0)
 I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC",80,0)
 S PSASEL=Y,PSALOCN=""
"RTN","PSAPROC",81,0)
 F  S PSALOCN=$O(PSAMENU(PSASEL,PSALOCN)) Q:PSALOCN=""  D
"RTN","PSAPROC",82,0)
 .S PSALOC=0 F  S PSALOC=+$O(PSAMENU(PSASEL,PSALOCN,PSALOC)) Q:'PSALOC  D
"RTN","PSAPROC",83,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",7)=PSALOC
"RTN","PSAPROC",84,0)
 Q
"RTN","PSAPROC",85,0)
 ;
"RTN","PSAPROC",86,0)
MASTER ;Assigns invoice to Master Vault
"RTN","PSAPROC",87,0)
 I 'PSAMVN W !!,"No master vaults are set up. You must set up a master vault then",!,"select the Process Uploaded Prime Vendor Invoices Data option." S PSAOUT=1 Q
"RTN","PSAPROC",88,0)
 ;
"RTN","PSAPROC",89,0)
 I PSAMVN=1 D  H 1 Q
"RTN","PSAPROC",90,0)
 .S PSACTRL=$O(PSACS(""))
"RTN","PSAPROC",91,0)
 .W !!,"The invoices are being assigned to the master vault. Please wait."
"RTN","PSAPROC",92,0)
 .S PSACTRL="" F  S PSACTRL=$O(PSACS(PSACTRL)) Q:PSACTRL=""  D
"RTN","PSAPROC",93,0)
 ..Q:'$D(^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAPROC",94,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)=PSAONEMV W "."
"RTN","PSAPROC",95,0)
 ;
"RTN","PSAPROC",96,0)
 I PSAMVN>1 D
"RTN","PSAPROC",97,0)
 .S PSACTRL="" F  S PSACTRL=$O(PSACS(PSACTRL)) Q:PSACTRL=""  D  Q:PSAOUT
"RTN","PSAPROC",98,0)
 ..Q:'$D(^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAPROC",99,0)
 ..S PSAIN=^XTMP("PSAPV",PSACTRL,"IN"),PSAORD=$P(PSAIN,"^",4),PSAINV=$P(PSAIN,"^",2)
"RTN","PSAPROC",100,0)
 ..D DISPMV W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN)
"RTN","PSAPROC",101,0)
 ..W:$P(PSAIN,"^",10)="ALL CS" !,"** All controlled substances"
"RTN","PSAPROC",102,0)
 ..W:$P(PSAIN,"^",10)'="ALL CS" !,"** Some controlled substances"
"RTN","PSAPROC",103,0)
 ..D SELMV
"RTN","PSAPROC",104,0)
 Q
"RTN","PSAPROC",105,0)
 ;
"RTN","PSAPROC",106,0)
DISPMV ;Displays active master vaults
"RTN","PSAPROC",107,0)
 W @IOF,!?22,"<<< ASSIGN A MASTER VAULT SCREEN >>>",!,PSASLN
"RTN","PSAPROC",108,0)
 S PSA=0,PSAMVA="" F  S PSAMVA=$O(PSAMV(PSAMVA)) Q:PSAMVA=""  D
"RTN","PSAPROC",109,0)
 .S PSAMVIEN=0 F  S PSAMVIEN=$O(PSAMV(PSAMVA,PSAMVIEN)) Q:'PSAMVIEN  D
"RTN","PSAPROC",110,0)
 ..S PSA=PSA+1,PSAVAULT(PSA,PSAMVA,PSAMVIEN)=""
"RTN","PSAPROC",111,0)
 ..W !,$J(PSA,2)_".",?4,PSAMVA
"RTN","PSAPROC",112,0)
 W !
"RTN","PSAPROC",113,0)
 Q
"RTN","PSAPROC",114,0)
 ;
"RTN","PSAPROC",115,0)
SELMV ;Select displayed master vaults
"RTN","PSAPROC",116,0)
 W ! S DIR(0)="NO^1:"_PSA,DIR("A")="Select Master Vault",DIR("?")="Select the Master Vault that received the invoice's drugs"
"RTN","PSAPROC",117,0)
 S DIR("??")="^D MV^PSAPROC" D ^DIR K DIR Q:Y=""  I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC",118,0)
 S PSASEL=Y
"RTN","PSAPROC",119,0)
 S PSAMVA=$O(PSAVAULT(PSASEL,"")) Q:PSAMVA=""  S PSAMVIEN=+$O(PSAVAULT(PSASEL,PSAMVA,0)) Q:'PSAMVIEN  S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)=PSAMVIEN
"RTN","PSAPROC",120,0)
 Q
"RTN","PSAPROC",121,0)
 ;
"RTN","PSAPROC",122,0)
END ;Holds screen
"RTN","PSAPROC",123,0)
 S PSASS=21-$Y F PSAKK=1:1:PSASS W !
"RTN","PSAPROC",124,0)
 S DIR(0)="E" D ^DIR K DIR S:$G(DIRUT) PSAOUT=1 W @IOF
"RTN","PSAPROC",125,0)
 Q
"RTN","PSAPROC",126,0)
 ;
"RTN","PSAPROC",127,0)
EXIT ;Kills processing variables
"RTN","PSAPROC",128,0)
 D:$G(PSAENTRY) PRINT2^PSAUP
"RTN","PSAPROC",129,0)
 D ^PSAPROC7
"RTN","PSAPROC",130,0)
 K DA,DIC,DIE,DIK,DIR,DIRUT,DR,DTOUT,DUOUT,PSA,PSABEFOR,PSACHG,PSACHO,PSACNT,PSACNT1,PSACNTER,PSACNTOK,PSACOMB,PSACONT,PSACS,PSACTRL
"RTN","PSAPROC",131,0)
 K PSAD0,PSAD1,PSAD2,PSAD3,PSAD4,PSAD5,PSAD6,PSADATA,PSADIFF,PSADISP,PSADJQTY,PSADLN,PSADONE,PSADU,PSAENTRY,PSAERR,PSAFLDS,PSAFND,PSAFPR,PSAGET,PSAHDR
"RTN","PSAPROC",132,0)
 K PSAIEN,PSAIEN3,PSAIEN50,PSAIN,PSAINV,PSAIPR,PSAISIT,PSAISITN,PSAJUST,PSAKK,PSALINE,PSALINES,PSALLSUP,PSALN,PSALNCNT,PSALNSU,PSALOC,PSALOCA,PSALOCN,PSALOCN
"RTN","PSAPROC",133,0)
 K PSAMENU,PSAMV,PSAMVA,PSAMVIEN,PSAMVN,PSANCS,PSANDC,PSANEXT,PSANODE,PSANUM,PSAOK,PSAONE,PSAONEMV,PSAORD,PSAOSIT,PSAOSITN,PSAOUT,PSAPASS,PSAPC,PSAPCF,PSAPCL,PSAPHARM,PSAPICK,PSAPRICE,PSAPTR
"RTN","PSAPROC",134,0)
 K PSARECD,PSAREORD,PSASAME,PSASEL,PSASEL1,PSASKIP,PSASLN,PSASNODE,PSASS,PSASSUB,PSASTOCK,PSASUB,PSASUP,PSASUPP,PSASYN,PSAVAPN,PSAVAULT,PSAVSN,X1,Y,ZTDTH,ZTIO
"RTN","PSAPROC",135,0)
 Q
"RTN","PSAPROC",136,0)
 ;
"RTN","PSAPROC",137,0)
MV ;Extended help for the select "Master Vault" prompt
"RTN","PSAPROC",138,0)
 W !?5,"Enter the number of the master vault for which you want to assign",!?5,"the order. The invoiced drugs in the assigned master vault will be"
"RTN","PSAPROC",139,0)
 W !?5,"incremented with the quantity received after the order is verified."
"RTN","PSAPROC",140,0)
 Q
"RTN","PSAPROC",141,0)
PHARM ;Extended help for the select "Pharmacy Location" prompt
"RTN","PSAPROC",142,0)
 W !?5,"Enter the number of the pharmacy location for which you want to assign",!?5,"the order. The invoiced drugs in the assigned pharmacy location will be"
"RTN","PSAPROC",143,0)
 W !?5,"incremented with the quantity received after the order is verified."
"RTN","PSAPROC",144,0)
 Q
"RTN","PSAPROC1")
0^55^B36726244
"RTN","PSAPROC1",1,0)
PSAPROC1 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSAPROC1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPROC1",3,0)
 ;This routine processes uploaded invoices.
"RTN","PSAPROC1",4,0)
 ;
"RTN","PSAPROC1",5,0)
CHK ;Check for invoices with a status of "OK" (uploaded & error free)
"RTN","PSAPROC1",6,0)
 ;& status of "" (uploaded & errors). 
"RTN","PSAPROC1",7,0)
 K PSA,PSAOK S (PSACNTOK,PSACNTER,PSACTRL)=0
"RTN","PSAPROC1",8,0)
 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""  D
"RTN","PSAPROC1",9,0)
 .Q:'$D(^XTMP("PSAPV",PSACTRL,"IN"))  S PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC1",10,0)
 .I $P(PSAIN,"^",8)="OK"!($P(PSAIN,"^",13)="SUP") D  Q
"RTN","PSAPROC1",11,0)
 ..I $P(PSAIN,"^",10)="ALL CS",$P(PSAIN,"^",12)'="" D OK Q
"RTN","PSAPROC1",12,0)
 ..I $P(PSAIN,"^",10)'="ALL CS",$P(PSAIN,"^",9)="CS",$P(PSAIN,"^",12)'="",$P(PSAIN,"^",7)'="" D OK Q
"RTN","PSAPROC1",13,0)
 ..I $P(PSAIN,"^",10)'="ALL CS",$P(PSAIN,"^",9)'="CS",$P(PSAIN,"^",7)'="" D OK Q
"RTN","PSAPROC1",14,0)
 ..S PSACNTER=PSACNTER+1,PSAERR(PSACNTER)=$P(PSAIN,"^",4)_"^"_$P(PSAIN,"^",2)_"^"_PSACTRL_"^"_$P(PSAIN,"^",7)
"RTN","PSAPROC1",15,0)
 .I $P(PSAIN,"^",8)="" S PSACNTER=PSACNTER+1,PSAERR(PSACNTER)=$P(PSAIN,"^",4)_"^"_$P(PSAIN,"^",2)_"^"_PSACTRL_"^"_$P(PSAIN,"^",7)
"RTN","PSAPROC1",16,0)
 S PSA=+$O(PSAOK(0))
"RTN","PSAPROC1",17,0)
 G:'PSA ^PSAPROC2
"RTN","PSAPROC1",18,0)
 ;
"RTN","PSAPROC1",19,0)
NOERROR ;Display list of invoices that can be processed by selecting
"RTN","PSAPROC1",20,0)
 ;invoice number.
"RTN","PSAPROC1",21,0)
 W @IOF,!?21,"<<< PROCESS ENTIRE INVOICE SCREEN >>>"
"RTN","PSAPROC1",22,0)
 W !!?2,"No errors have been detected on the following invoices. If there are no",!?2,"corrections, you can change the invoices' status to ""Processed"" by"
"RTN","PSAPROC1",23,0)
 W !?2,"selecting them from the list. If you do have corrections, press the return",!?2,"key then a second list will be displayed. You will be able to choose the",!?2,"invoices from that list and enter corrections."
"RTN","PSAPROC1",24,0)
 W !!?2,"Choose the invoices from the list you want to process.",!,PSADLN
"RTN","PSAPROC1",25,0)
 S (PSACNT,PSASTOP)=0,PSAMENU=""
"RTN","PSAPROC1",26,0)
 F  S PSAMENU=$O(PSAOK(PSAMENU)) Q:PSAMENU=""!(PSAOUT)  D  Q:PSASTOP
"RTN","PSAPROC1",27,0)
 .I $Y+4>IOSL D HEADER Q:PSASTOP
"RTN","PSAPROC1",28,0)
 .S PSAORD=$P(PSAOK(PSAMENU),"^"),PSAINV=$P(PSAOK(PSAMENU),"^",2),PSACTRL=$P(PSAOK(PSAMENU),"^",3),PSACNT=PSACNT+1
"RTN","PSAPROC1",29,0)
 .W !?2,PSAMENU_". ",?4,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAPROC1",30,0)
 K PSASTOP W !,PSADLN
"RTN","PSAPROC1",31,0)
 S DIR(0)="LO^1:"_PSACNT,DIR("A")="Select invoices to process",DIR("?",1)="Enter the number to the left of the invoice",DIR("?")="data to be processed or a range of numbers." W !
"RTN","PSAPROC1",32,0)
 S DIR("??")="^D SEL^PSAPROC1" D ^DIR K DIR G:Y="" EDIT I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC1",33,0)
 S PSASEL=Y
"RTN","PSAPROC1",34,0)
INVSEL F PSAPC=1:1 S PSA=+$P(PSASEL,",",PSAPC) Q:'PSA  D  Q:PSAOUT
"RTN","PSAPROC1",35,0)
 .S PSACTRL=$P(PSAOK(PSA),"^",3) Q:'$D(^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAPROC1",36,0)
 .S PSAIN=^XTMP("PSAPV",PSACTRL,"IN"),PSARECD=+$P(PSAIN,"^",6),PSALINES=0
"RTN","PSAPROC1",37,0)
 .D PROCESS
"RTN","PSAPROC1",38,0)
 Q:PSAOUT  G:'+$O(PSAOK(0)) PROC2
"RTN","PSAPROC1",39,0)
EDIT ;Edit error free invoices
"RTN","PSAPROC1",40,0)
 S PSA=0 F  S PSA=$O(PSAOK(PSA)) Q:'PSA  D
"RTN","PSAPROC1",41,0)
 .I $P($G(^XTMP("PSAPV",$P(PSAOK(PSA),"^",3),"IN")),"^",8)="OK"!($P($G(^("IN")),"^",13)="SUP") D
"RTN","PSAPROC1",42,0)
 ..S PSACNTER=PSACNTER+1,PSAERR(PSACNTER)=$P(^XTMP("PSAPV",$P(PSAOK(PSA),"^",3),"IN"),"^",4)_"^"_$P(^("IN"),"^",2)_"^"_$P(PSAOK(PSA),"^",3)_"^"_$P(^("IN"),"^",7)
"RTN","PSAPROC1",43,0)
 ;
"RTN","PSAPROC1",44,0)
PROC2 I +$O(PSAERR(0)) D ^PSAPROC2
"RTN","PSAPROC1",45,0)
 Q
"RTN","PSAPROC1",46,0)
 ;
"RTN","PSAPROC1",47,0)
HEADER S PSASS=21-$Y F PSAKK=1:1:PSASS W !
"RTN","PSAPROC1",48,0)
 S DIR(0)="E" D ^DIR K DIR I $G(DIRUT) S PSASTOP=1 Q
"RTN","PSAPROC1",49,0)
 W @IOF,!?21,"<<< PROCESS ENTIRE INVOICE SCREEN >>>",!!,PSADLN
"RTN","PSAPROC1",50,0)
 Q
"RTN","PSAPROC1",51,0)
 ;
"RTN","PSAPROC1",52,0)
PROCESS ;Get date recd & line item data
"RTN","PSAPROC1",53,0)
 I $P(PSAIN,"^",13)="SUP" D HDR,SUPPLY^PSAPROC6 Q
"RTN","PSAPROC1",54,0)
 D HDR,RECD^PSAPROC3 Q:PSAOUT  S (PSACS,PSALNCNT)=0,PSALINE=""
"RTN","PSAPROC1",55,0)
 F  S PSALINE=$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:PSALINE=""  D  Q:PSAOUT
"RTN","PSAPROC1",56,0)
 .K PSAPHARM,PSAMV
"RTN","PSAPROC1",57,0)
 .S PSALNCNT=PSALNCNT+1,(PSADISP,PSADU,PSAHDR)=0
"RTN","PSAPROC1",58,0)
 .S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE),PSAIEN=$S(+$P(PSADATA,"^",15):+$P(PSADATA,"^",15),+$P(PSADATA,"^",6):+$P(PSADATA,"^",6),1:0),PSASUB=+$P(PSADATA,"^",7)
"RTN","PSAPROC1",59,0)
 .S:$P(PSADATA,"^",19)="CS" PSAMV=+$P(PSAIN,"^",12) S:$P(PSADATA,"^",19)'="CS" PSAPHARM=+$P(PSAIN,"^",7)
"RTN","PSAPROC1",60,0)
 .S PSALOC=+$S($P(PSADATA,"^",19)="CS":PSAMV,1:PSAPHARM)
"RTN","PSAPROC1",61,0)
 .I $P($G(^PSDRUG(PSAIEN,660)),"^",8)="" D:'PSAHDR HDR D:'PSADISP DISPLAY^PSAUTL1 D DU^PSAPROC8 Q:PSAOUT
"RTN","PSAPROC1",62,0)
 .I '+$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",7),$P($G(^PSDRUG(PSAIEN,660)),"^",8)'="" D:'PSAHDR HDR D:'PSADISP DISPLAY^PSAUTL1 D:PSASUB DUOU^PSAPROC8 D:'PSASUB DUOU^PSAPROC3 Q:PSAOUT
"RTN","PSAPROC1",63,0)
 .I +$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",6)'=+$P(PSADATA,"^",3) D:'PSAHDR HDR D:'PSADISP DISPLAY^PSAUTL1 D PRICE^PSAPROC8 Q:PSAOUT
"RTN","PSAPROC1",64,0)
 .I +$P($G(^PSD(58.8,PSALOC,0)),"^",14) D  Q:PSAOUT
"RTN","PSAPROC1",65,0)
 ..I '+$P($G(^PSD(58.8,PSALOC,1,PSAIEN,0)),"^",3),'+$P(PSADATA,"^",27) D:'PSAHDR HDR D:'PSADISP DISPLAY^PSAUTL1 D STOCK^PSAPROC8 Q:PSAOUT
"RTN","PSAPROC1",66,0)
 ..I '+$P($G(^PSD(58.8,PSALOC,1,PSAIEN,0)),"^",5),'+$P(PSADATA,"^",21) D:'PSAHDR HDR D:'PSADISP DISPLAY^PSAUTL1 D REORDER^PSAPROC8
"RTN","PSAPROC1",67,0)
 .D SETLINE^PSAPROC3 S:$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",19)="CS" PSACS=PSACS+1
"RTN","PSAPROC1",68,0)
 S PSAOK=0
"RTN","PSAPROC1",69,0)
CS I PSACS D  Q:PSAOUT
"RTN","PSAPROC1",70,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",9)="CS"
"RTN","PSAPROC1",71,0)
 .I $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)="" K PSACS S PSACS(PSACTRL)="" D MASTER^PSAPROC9 Q:PSAOUT  S:$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)'="" PSAOK=1
"RTN","PSAPROC1",72,0)
 .I PSACS=PSALNCNT S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",10)="ALL CS" Q
"RTN","PSAPROC1",73,0)
 .I PSACS'=PSALNCNT S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",10)=""
"RTN","PSAPROC1",74,0)
NCS I 'PSACS S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",9)="",$P(^("IN"),"^",10)="",$P(^("IN"),"^",12)="" D:$P(^("IN"),"^",7)="" GETLOC^PSAPROC9 Q:PSAOUT  S:$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",7)'="" PSAOK=1
"RTN","PSAPROC1",75,0)
 ;
"RTN","PSAPROC1",76,0)
 I PSALNCNT=PSALINES S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",8)="P" K PSAOK(PSACTRL) W !!,"The invoice status has been changed to Processed!"
"RTN","PSAPROC1",77,0)
 E  W !!,"** The invoice has not been placed in a Processed status!"
"RTN","PSAPROC1",78,0)
 D END^PSAPROC
"RTN","PSAPROC1",79,0)
 Q
"RTN","PSAPROC1",80,0)
 ;
"RTN","PSAPROC1",81,0)
HDR ;Header for editing line items with missing data
"RTN","PSAPROC1",82,0)
 S PSAHDR=1
"RTN","PSAPROC1",83,0)
 W @IOF,!?21,"<<< PROCESS ENTIRE INVOICE SCREEN >>>",!,"Order#: "_$P(PSAIN,"^",4)_"  Invoice#: "_$P(PSAIN,"^",2)_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN),!,PSADLN
"RTN","PSAPROC1",84,0)
 Q
"RTN","PSAPROC1",85,0)
OK ;Sets okay array
"RTN","PSAPROC1",86,0)
 S PSACNTOK=PSACNTOK+1,PSAOK(PSACNTOK)=$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",4)_"^"_$P(^("IN"),"^",2)_"^"_PSACTRL_"^"_$P(^("IN"),"^",7)
"RTN","PSAPROC1",87,0)
 Q
"RTN","PSAPROC1",88,0)
 ;
"RTN","PSAPROC1",89,0)
SEL ;Extended help to 'Select invoices'
"RTN","PSAPROC1",90,0)
 W !?5,"Enter the number to the left of the invoice data that you want to process."
"RTN","PSAPROC1",91,0)
 Q
"RTN","PSAPROC2")
0^56^B68760720
"RTN","PSAPROC2",1,0)
PSAPROC2 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSAPROC2",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPROC2",3,0)
 ;This routine allows the user to edit invoices with errors or missing
"RTN","PSAPROC2",4,0)
 ;data.
"RTN","PSAPROC2",5,0)
 ;
"RTN","PSAPROC2",6,0)
CHK S PSA=+$O(PSAERR(0))
"RTN","PSAPROC2",7,0)
 I 'PSA W @IOF,!!,"There are no invoices that need to be processed." D END^PSAPROC Q
"RTN","PSAPROC2",8,0)
 ;
"RTN","PSAPROC2",9,0)
INV D HDR W !,"  More data is needed on the following invoices. Choose the invoices from",!,"  the list you want to edit.",!,PSASLN
"RTN","PSAPROC2",10,0)
 S (PSACNT,PSAMENU,PSASTOP)=0
"RTN","PSAPROC2",11,0)
 F  S PSAMENU=+$O(PSAERR(PSAMENU)) Q:'PSAMENU!(PSAOUT)  D  Q:PSASTOP
"RTN","PSAPROC2",12,0)
 .I $Y+4>IOSL D HEADER Q:PSASTOP
"RTN","PSAPROC2",13,0)
 .S PSAORD=$P(PSAERR(PSAMENU),"^"),PSAINV=$P(PSAERR(PSAMENU),"^",2),PSACTRL=$P(PSAERR(PSAMENU),"^",3),PSACNT=PSACNT+1
"RTN","PSAPROC2",14,0)
 .W !?2,PSAMENU_". ",?6,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAPROC2",15,0)
 W !,PSASLN K DIR,PSASTOP
"RTN","PSAPROC2",16,0)
 S DIR(0)="LO^1:"_PSACNT,DIR("A")="Select invoices to edit",DIR("?",1)="Enter the number to the left of the invoice",DIR("?")="data to be processed or a range of numbers." W !
"RTN","PSAPROC2",17,0)
 S DIR("??")="^D SELHELP^PSAPROC2" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC2",18,0)
 S PSASEL=Y
"RTN","PSAPROC2",19,0)
 ;
"RTN","PSAPROC2",20,0)
PROC W ! S DIR("A",1)="Do you want to select the line items to be edited (S) or",DIR("A")="have them automatically (A) displayed for you?",DIR("B")="A",DIR(0)="SB^S:Select;A:Automatically displayed"
"RTN","PSAPROC2",21,0)
 S DIR("?",1)="Enter ""S"" to allow you to select the line items to be edited.",DIR("?",2)="Enter ""A"" to automatically receive prompts for the line items",DIR("?")="that need editing."
"RTN","PSAPROC2",22,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC2",23,0)
 G:Y="S" SEL^PSAPROC6
"RTN","PSAPROC2",24,0)
 ;
"RTN","PSAPROC2",25,0)
AUTO ;Process line items
"RTN","PSAPROC2",26,0)
 F PSAPC=1:1 S PSAMENU=$P(PSASEL,",",PSAPC) Q:'PSAMENU!(PSAOUT)  S PSACTRL=$P(PSAERR(PSAMENU),"^",3),(PSALNCNT,PSALINES,PSACS,PSALLSUP)=0 D  Q:PSAOUT
"RTN","PSAPROC2",27,0)
 .Q:'$D(^XTMP("PSAPV",PSACTRL,"IN"))!('$D(^XTMP("PSAPV",PSACTRL,"IT")))
"RTN","PSAPROC2",28,0)
 .S PSAIN=^XTMP("PSAPV",PSACTRL,"IN"),PSALOC=+$P(PSAIN,"^",7),PSAMV=+$P(PSAIN,"^",12)
"RTN","PSAPROC2",29,0)
 .D HDR W !,"Order#: "_$P(PSAIN,"^",4)_"  Invoice#: "_$P(PSAIN,"^",2)_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN),!,PSASLN
"RTN","PSAPROC2",30,0)
 .W:$P(PSAIN,"^",9)="CS" !!,"MASTER VAULT: "_$S(PSAMV:$P($G(^PSD(58.8,PSAMV,0)),"^"),1:"Blank")
"RTN","PSAPROC2",31,0)
 .I $P(PSAIN,"^",10)="" D
"RTN","PSAPROC2",32,0)
 ..D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSAPROC2",33,0)
 ..W !!,"PHARMACY LOCATION: " I 'PSALOC W "Blank" Q
"RTN","PSAPROC2",34,0)
 ..W:$L(PSALOCN)>76 !,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 !,PSALOCN
"RTN","PSAPROC2",35,0)
 .W ! S PSARECD=$S(+$P(PSAIN,"^",11):+$P(PSAIN,"^",11),+$P(PSAIN,"^",6):+$P(PSAIN,"^",6),1:"") D RECD^PSAPROC3 Q:PSAOUT
"RTN","PSAPROC2",36,0)
 .;
"RTN","PSAPROC2",37,0)
 .;Gets & processes the line items
"RTN","PSAPROC2",38,0)
 .S PSALINE="" F  S PSALINE=$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:PSALINE=""!(PSAOUT)  D  Q:PSAOUT
"RTN","PSAPROC2",39,0)
 ..S PSALNCNT=PSALNCNT+1,(PSAPASS,PSASUPP)=0,PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC2",40,0)
 ..I $P(PSADATA,"^",18)="OK"!($P(PSADATA,"^",18)="P") S:$P(PSADATA,"^",18)="OK" $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",18)="P" S PSALINES=PSALINES+1 S:$P(PSADATA,"^",19)="CS" PSACS=PSACS+1 Q
"RTN","PSAPROC2",41,0)
 ..S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC2",42,0)
 ..S PSAIEN=$S(+$P(PSADATA,"^",15):+$P(PSADATA,"^",15),1:+$P(PSADATA,"^",6)),PSASUB=+$P(PSADATA,"^",7),PSANDC=$P($P(PSADATA,"^",4),"~"),PSAVSN=$P($P(PSADATA,"^",5),"~")
"RTN","PSAPROC2",43,0)
 ..D EDITDISP^PSAUTL1 D ^PSAPROC9
"RTN","PSAPROC2",44,0)
 .D:'PSAOUT SETINV
"RTN","PSAPROC2",45,0)
 Q:PSAOUT
"RTN","PSAPROC2",46,0)
 W @IOF,!,"If you are changing the status of an invoice to Processed, this is the",!,"last time you will be allowed to edit it before it goes to the verifier."
"RTN","PSAPROC2",47,0)
 W !,"If you are not changing the status of an invoice to Processed, you can",!,"edit it now.",!!,"You can edit the invoice's delivery date, pharmacy location, master vault,"
"RTN","PSAPROC2",48,0)
 W !,"and the line item's drug, quantity received, order unit, and dispense units",!,"per order unit. The reorder level can be edited if the pharmacy location or"
"RTN","PSAPROC2",49,0)
 W !,"master vault is set up to track the reorder levels.",!
"RTN","PSAPROC2",50,0)
 S DIR(0)="Y",DIR("A")="Edit invoices",DIR("B")="N",DIR("?",1)="Enter Yes to edit the invoices you just processed.",DIR("?",1)="Enter No to accept the invoices as they are now."
"RTN","PSAPROC2",51,0)
 S DIR("??")="^D EDIT^PSAPROC2" D ^DIR K DIR I $G(DIRUT)!('Y) S PSAOUT=1 Q
"RTN","PSAPROC2",52,0)
 ;
"RTN","PSAPROC2",53,0)
EDITINV ;Edits the invoice before placing in Processed status.
"RTN","PSAPROC2",54,0)
 K PSAERR S (PSACTRL,PSAERR,PSAOUT)=0
"RTN","PSAPROC2",55,0)
 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""  D
"RTN","PSAPROC2",56,0)
 .S:$D(^XTMP("PSAPV",PSACTRL,"IN")) PSAERR=PSAERR+1,PSAERR(PSAERR)=$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",4)_"^"_$P(^("IN"),"^",2)_"^"_PSACTRL_"^"_$P(^("IN"),"^",7)_"^"_$P(^("IN"),"^",12)
"RTN","PSAPROC2",57,0)
 ;
"RTN","PSAPROC2",58,0)
 W @IOF,!?26,"<<< EDIT INVOICE SCREEN >>>"
"RTN","PSAPROC2",59,0)
 W !!,"Choose the invoices to be edited. You can edit the invoice's date received and",!,"the line item's drug, quantity received, and order unit. The reorder and"
"RTN","PSAPROC2",60,0)
 W !,"stock levels can be edited if the pharmacy location or master vault is set",!,"up to maintain the reorder levels.",!,PSASLN,!
"RTN","PSAPROC2",61,0)
 S (PSACNT,PSAMENU,PSASTOP)=0
"RTN","PSAPROC2",62,0)
 F  S PSAMENU=+$O(PSAERR(PSAMENU)) Q:'PSAMENU!(PSAOUT)  D  Q:PSASTOP
"RTN","PSAPROC2",63,0)
 .I $Y+4>IOSL D HDR1 Q:PSASTOP
"RTN","PSAPROC2",64,0)
 .S PSAORD=$P(PSAERR(PSAMENU),"^"),PSAINV=$P(PSAERR(PSAMENU),"^",2),PSACTRL=$P(PSAERR(PSAMENU),"^",3),PSACNT=PSACNT+1
"RTN","PSAPROC2",65,0)
 .W !?1,PSACNT_".",?4,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAPROC2",66,0)
 K PSASTOP
"RTN","PSAPROC2",67,0)
 S DIR(0)="LO^1:"_PSACNT,DIR("A")="Select invoices",DIR("?",1)="Enter the number to the left of the invoice",DIR("?")="data to be edited or a range of numbers." W !
"RTN","PSAPROC2",68,0)
 S DIR("??")="^D SEL^PSAPROC2" D ^DIR K DIR G:Y="" SETINV I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC2",69,0)
 S PSASEL=Y D ^PSAPROC6
"RTN","PSAPROC2",70,0)
 Q
"RTN","PSAPROC2",71,0)
HDR ;Screen header
"RTN","PSAPROC2",72,0)
 W @IOF,!?19,"<<< EDIT INVOICES TO BE PROCESSED SCREEN >>>",!
"RTN","PSAPROC2",73,0)
 Q
"RTN","PSAPROC2",74,0)
 ;
"RTN","PSAPROC2",75,0)
HDR1 ;Screen header with hold
"RTN","PSAPROC2",76,0)
 S PSASS=21-$Y F PSAKK=1:1:PSASS W !
"RTN","PSAPROC2",77,0)
 S DIR(0)="E" D ^DIR K DIR I $G(DIRUT) S PSASTOP=1 Q
"RTN","PSAPROC2",78,0)
 W @IOF,!?26,"<<< EDIT INVOICE SCREEN >>>",!!,PSASLN
"RTN","PSAPROC2",79,0)
 Q
"RTN","PSAPROC2",80,0)
 ;
"RTN","PSAPROC2",81,0)
HEADER ;Screen hold with header
"RTN","PSAPROC2",82,0)
 S PSASS=21-$Y F PSAKK=1:1:PSASS W !
"RTN","PSAPROC2",83,0)
 S DIR(0)="E" D ^DIR K DIR I $G(DIRUT) S PSASTOP=1 Q
"RTN","PSAPROC2",84,0)
 W @IOF,!?19,"<<< EDIT INVOICES TO BE PROCESSED SCREEN >>>",!!,PSASLN
"RTN","PSAPROC2",85,0)
 Q
"RTN","PSAPROC2",86,0)
 ;
"RTN","PSAPROC2",87,0)
SETINV ;Sets invoice to processed if okay.
"RTN","PSAPROC2",88,0)
 S PSAOK=1
"RTN","PSAPROC2",89,0)
 I PSALLSUP=PSALNCNT S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",7)="",$P(^("IN"),"^",9)="",$P(^("IN"),"^",10)="",$P(^("IN"),"^",12)="",$P(^("IN"),"^",13)="SUP",PSAOK=1 G STATUS
"RTN","PSAPROC2",90,0)
 E  S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",13)=""
"RTN","PSAPROC2",91,0)
 I PSACS D  Q:PSAOUT
"RTN","PSAPROC2",92,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",9)="CS"
"RTN","PSAPROC2",93,0)
 .I $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)="" S PSACS(PSACTRL)="" D MASTER^PSAPROC9 Q:PSAOUT  S:$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)="" PSAOK=0
"RTN","PSAPROC2",94,0)
 .I PSACS=PSALNCNT S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",10)="ALL CS" Q
"RTN","PSAPROC2",95,0)
 .I PSACS'=PSALNCNT S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",10)=""
"RTN","PSAPROC2",96,0)
 I 'PSACS S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",9)="",$P(^("IN"),"^",10)="",$P(^("IN"),"^",12)="" D:$P(^("IN"),"^",7)="" GETLOC^PSAPROC9 Q:PSAOUT  S:$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",7)="" PSAOK=0
"RTN","PSAPROC2",97,0)
 ;
"RTN","PSAPROC2",98,0)
STATUS I PSALNCNT=PSALINES!(PSALNCNT=PSALLSUP),PSAOK D CHG^PSAPROC6,END^PSAPROC Q
"RTN","PSAPROC2",99,0)
 E  W !!,"** The invoice has not been placed in a Processed status!"
"RTN","PSAPROC2",100,0)
 D END^PSAPROC
"RTN","PSAPROC2",101,0)
 Q
"RTN","PSAPROC2",102,0)
EDIT ;Extended help for 'edit any invoices'
"RTN","PSAPROC2",103,0)
 W !?5,"If you answer Yes, a list of the invoices you were able to process will",!?5,"be displayed. You will be able to select the invoices to be edited then"
"RTN","PSAPROC2",104,0)
 W !?5,"the line item numbers. You will be able to edit the date the invoice was",!?5,"received, drug, quantity, order unit, and dispense units per order unit."
"RTN","PSAPROC2",105,0)
 W !?5,"If the drugs are assigned to a pharmacy location or master vault that",!?5,"maintains reorder levels, you will also be able to edit the reorder and",!?5,"stock levels.",!!?5,"Enter No if the invoice are correct."
"RTN","PSAPROC2",106,0)
 Q
"RTN","PSAPROC2",107,0)
SEL ;Extended help to 'Select invoices to process'
"RTN","PSAPROC2",108,0)
 W !?5,"Enter the number to the left of the invoice data that you want to process."
"RTN","PSAPROC2",109,0)
 Q
"RTN","PSAPROC2",110,0)
SELHELP ;Extended help to 'Select invoices to edit'
"RTN","PSAPROC2",111,0)
 W !?5,"Enter the number to the left of the invoice data that you want to",!?5,"edit. The line items will be displayed for you to select the ones"
"RTN","PSAPROC2",112,0)
 W !?5,"you want to edit. You are given this opportunity to edit the invoice",!?5,"because the automatic display may not catch all the needed corrections."
"RTN","PSAPROC2",113,0)
 W !!?5,"For example, the quantity on the invoice may be 6, but one bottle may",!?5,"be broken. Six is a valid quantity that the automatic display will not"
"RTN","PSAPROC2",114,0)
 W !?5,"realize as being incorrect. By answering Yes, you will be allowed to change",!?5,"the quantity to 5."
"RTN","PSAPROC2",115,0)
 Q
"RTN","PSAPROC3")
0^57^B50759949
"RTN","PSAPROC3",1,0)
PSAPROC3 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSAPROC3",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPROC3",3,0)
 ;This routine allows the user to edit invoices with errors or missing
"RTN","PSAPROC3",4,0)
 ;data.
"RTN","PSAPROC3",5,0)
 ;
"RTN","PSAPROC3",6,0)
DUOU ;Gets & stores dispense unit per order unit in XTMP
"RTN","PSAPROC3",7,0)
 W:'$G(PSADU) !,"DISPENSE UNITS: "_$P($G(^PSDRUG(PSAIEN,660)),"^",8)
"RTN","PSAPROC3",8,0)
 S PSADU=1
"RTN","PSAPROC3",9,0)
 S DIR(0)="NO",DIR("A")="DISPENSE UNIT PER ORDER UNIT",DIR("?")="Enter the number of dispense units contained in one order unit.",DIR("??")="^D DUOUHELP^PSAPROC3"
"RTN","PSAPROC3",10,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC3",11,0)
 I +Y S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",20)=+Y,PSADATA=^(PSALINE) Q
"RTN","PSAPROC3",12,0)
 ;
"RTN","PSAPROC3",13,0)
 W !,"The dispense units per order unit must be entered",!,"to change the status of the invoice to Processed."
"RTN","PSAPROC3",14,0)
 S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to enter the data now"
"RTN","PSAPROC3",15,0)
 S DIR("?",1)="Enter Yes to return to the DISPENSE UNIT PER ORDER UNIT prompt.",DIR("?")="Enter No to bypass entering the dispense units now."
"RTN","PSAPROC3",16,0)
 S DIR("??")="^D DUOUYN^PSAPROC8" D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC3",17,0)
 Q:Y=""  G:+Y DUOU Q
"RTN","PSAPROC3",18,0)
 ;
"RTN","PSAPROC3",19,0)
GETOU ;Get the Order Unit if it is blank or if it is not in the ORDER UNIT file.
"RTN","PSAPROC3",20,0)
 S DIR(0)="P^51.5:EMZ",DIR("A")="ORDER UNIT",DIR("?")="Enter the unit of order.",DIR("??")="^D OUHELP^PSAPROC3"
"RTN","PSAPROC3",21,0)
 S DIR("B")=$S(+$P($P(PSADATA,"^",2),"~",2):$P($G(^DIC(51.5,+$P($P(PSADATA,"^",2),"~",2),0)),"^"),+$P($G(^PSDRUG(PSAIEN,660)),"^",2):$P($G(^DIC(51.5,+$P($G(^PSDRUG(PSAIEN,660)),"^",2),0)),"^"),1:"")
"RTN","PSAPROC3",22,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC3",23,0)
 Q:+$P($P(PSADATA,"^",2),"~",2)=+Y
"RTN","PSAPROC3",24,0)
 I +Y,+Y'=+$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",2),"~",2) S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",12)=+Y,$P(^(PSALINE),"^",13)=DUZ,$P(^(PSALINE),"^",14)=DT,PSADATA=^(PSALINE) Q
"RTN","PSAPROC3",25,0)
 ;
"RTN","PSAPROC3",26,0)
 W !,"The order unit must be entered to change",!,"the status of the invoice to Processed.",!
"RTN","PSAPROC3",27,0)
 S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to enter the data now"
"RTN","PSAPROC3",28,0)
 S DIR("?",1)="Enter Yes to return to the ORDER UNIT prompt.",DIR("?")="Enter No to bypass entering the order units now.",DIR("??")="^D OUYN^PSAPROC3"
"RTN","PSAPROC3",29,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC3",30,0)
 Q:Y=""
"RTN","PSAPROC3",31,0)
 G:+Y GETOU
"RTN","PSAPROC3",32,0)
 Q
"RTN","PSAPROC3",33,0)
 ;
"RTN","PSAPROC3",34,0)
PRICE ;If price per order unit is blank or 0, get price from user.
"RTN","PSAPROC3",35,0)
 S DIR(0)="NO^0:9999:4",DIR("A")="PRICE PER ORDER UNIT",DIR("B")=0
"RTN","PSAPROC3",36,0)
 S DIR("?",1)="If the price per order unit is not zero (0), enter",DIR("?",2)="the correct price. If the price per order unit is",DIR("?")="zero, press return to verify that the price is correct."
"RTN","PSAPROC3",37,0)
 S DIR("??")="^D PRICEHLP^PSAPROC3" D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC3",38,0)
 I +$P(PSADATA,"^",3),+$P(PSADATA,"^",3)=+Y Q
"RTN","PSAPROC3",39,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",23)=+Y,$P(^(PSALINE),"^",24)=DUZ,$P(^(PSALINE),"^",25)=DT,PSADATA=^(PSALINE)
"RTN","PSAPROC3",40,0)
 Q
"RTN","PSAPROC3",41,0)
 ;
"RTN","PSAPROC3",42,0)
QTY ;If qty is blank, prompt for it.
"RTN","PSAPROC3",43,0)
 S DIR(0)="N",DIR("A")="QUANTITY RECEIVED",DIR("B")=$S(+$P(PSADATA,"^",8):+$P(PSADATA,"^",8),+PSADATA:+PSADATA,1:0)
"RTN","PSAPROC3",44,0)
 S DIR("?",1)="If the quantity received is different than the",DIR("?")="quantity invoiced, enter the correct quantity received.",DIR("??")="^D QTYHELP^PSAPROC3"
"RTN","PSAPROC3",45,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC3",46,0)
 Q:+PSADATA=+Y  S PSADJQTY=+Y
"RTN","PSAPROC3",47,0)
 S DIR(0)="F^1:30",DIR("A")="ADJUSTMENT REASON",DIR("?")="Enter the reason you adjusted the quantity received.",DIR("??")="^D ADJREA^PSAPROC3"
"RTN","PSAPROC3",48,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC3",49,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",8)=PSADJQTY,$P(^(PSALINE),"^",9)=DUZ,$P(^(PSALINE),"^",10)=DT,$P(^(PSALINE),"^",11)=Y,PSADATA=^(PSALINE)
"RTN","PSAPROC3",50,0)
 Q
"RTN","PSAPROC3",51,0)
 ;
"RTN","PSAPROC3",52,0)
RECD ;Enter the date the invoiced drugs were received.
"RTN","PSAPROC3",53,0)
 S DIR(0)="D",DIR("A")="Date received",DIR("?")="Enter the date the drugs were received.",DIR("??")="^D RECHELP^PSAPROC3" S:PSARECD DIR("B")=$$FMTE^XLFDT(PSARECD)
"RTN","PSAPROC3",54,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC3",55,0)
 S:$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",6)'=+Y $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",11)=+Y S PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC3",56,0)
 Q
"RTN","PSAPROC3",57,0)
 ;
"RTN","PSAPROC3",58,0)
SETLINE ;Set line as process if all data is present.
"RTN","PSAPROC3",59,0)
 S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE),PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC3",60,0)
 I $D(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")) S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",18)="P",PSALINES=PSALINES+1,PSALLSUP=PSALLSUP+1 Q
"RTN","PSAPROC3",61,0)
 S PSAIEN=$S(+$P(PSADATA,"^",15):+$P(PSADATA,"^",15),+$P(PSADATA,"^",6):+$P(PSADATA,"^",6),1:0),PSASUB=+$P(PSADATA,"^",7)
"RTN","PSAPROC3",62,0)
 I PSAIEN,$P($G(^PSDRUG(PSAIEN,2)),"^",3)["N" S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",19)="CS"
"RTN","PSAPROC3",63,0)
 E  S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",19)=""
"RTN","PSAPROC3",64,0)
 S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE),PSALOC=$S($P(PSADATA,"^",19)'="CS":+$P(PSAIN,"^",7),1:+$P(PSAIN,"^",12))
"RTN","PSAPROC3",65,0)
 I +$P(PSADATA,"^",6)!(+$P(PSADATA,"^",15)),$P(PSADATA,"^")'=""!($P(PSADATA,"^",8)'=""),$P($G(^PSDRUG(PSAIEN,660)),"^",8)'="" D
"RTN","PSAPROC3",66,0)
 .I +$P($G(^PSDRUG(PSAIEN,1,+$G(PSASUB),0)),"^",7)!(+$P(PSADATA,"^",20)),+$P($P(PSADATA,"^",2),"~",2)!(+$P(PSADATA,"^",12))!(+$P($G(^PSDRUG(PSAIEN,1,+$G(PSASUB),0)),"^",5)) D
"RTN","PSAPROC3",67,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",18)="P",PSALINES=PSALINES+1,$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",13)="",PSAIN=^("IN")
"RTN","PSAPROC3",68,0)
 Q
"RTN","PSAPROC3",69,0)
 ;
"RTN","PSAPROC3",70,0)
ADJREA ;Extended help for 'qty adjustment reason'
"RTN","PSAPROC3",71,0)
 W !?5,"Enter why you changed the quantity.",!?5,"For example: 2 bottles were broken.",!?5,"             Package contained only 11 tubes."
"RTN","PSAPROC3",72,0)
 Q
"RTN","PSAPROC3",73,0)
DUOUHELP ;Extended help for entering dispense units per order unit
"RTN","PSAPROC3",74,0)
 W !?5,"Enter the number of dispense units contained in the order unit.",!!?5,"For example: Dispense Units: TAB",!?18,"Order Unit    : CS"
"RTN","PSAPROC3",75,0)
 W !!?18,"The case contains 12 bottles of 1,000 tablets",!?18,"12 x 1,000 = 12,000",!?18,"DISPENSE UNITS PER ORDER UNIT: 12,000"
"RTN","PSAPROC3",76,0)
 Q
"RTN","PSAPROC3",77,0)
NDCHELP ;Extended help for selecting invoiced drug
"RTN","PSAPROC3",78,0)
 W !?5,"Enter the number to the left of the invoiced drug. If you select  a drug",!?5,"from the list, the invoiced drug will be matched to that drug. If you"
"RTN","PSAPROC3",79,0)
 W !?5,"choose to select another drug, you can select the invoiced drug from the",!?5,"DRUG file or flag this item as a supply item."
"RTN","PSAPROC3",80,0)
 Q
"RTN","PSAPROC3",81,0)
OUHELP ;Extended help for selecting the Order Unit
"RTN","PSAPROC3",82,0)
 W !?5,"Enter the packaging unit for which the drug was ordered."
"RTN","PSAPROC3",83,0)
 Q
"RTN","PSAPROC3",84,0)
OUYN ;Extended help for returning to the 'ORDER UNIT' prompt.
"RTN","PSAPROC3",85,0)
 W !?5,"Enter Yes if you want to enter the order unit now.",!?5,"Enter No to bypass entering the order unit."
"RTN","PSAPROC3",86,0)
 W !!?5,"The invoice will not be placed in a Processed",!?5,"status if the order units are not entered."
"RTN","PSAPROC3",87,0)
 Q
"RTN","PSAPROC3",88,0)
PRICEHLP ;Extended help for price per order unit
"RTN","PSAPROC3",89,0)
 W !?5,"If the price per order unit is not zero, enter the correct price. ",!?5,"The total cost for the item will be adjusted. If it is zero, press ",!?5,"the return key to verify that zero is the correct price."
"RTN","PSAPROC3",90,0)
 Q
"RTN","PSAPROC3",91,0)
QTYHELP ;Extended help for quantity delivered
"RTN","PSAPROC3",92,0)
 W !?5,"If the quantity received is different than the quantity",!?5,"displayed, enter the correct quantity you received. The",!?5,"total cost for the item will be adjusted."
"RTN","PSAPROC3",93,0)
 Q
"RTN","PSAPROC3",94,0)
RECHELP ;Extended help to 'Date Received'
"RTN","PSAPROC3",95,0)
 W !?5,"Enter the date the drugs were received. The date the prime vendor",!?5,"said the drugs were delivered and the date you say the drugs were",!?5,"received will be retained."
"RTN","PSAPROC3",96,0)
 Q
"RTN","PSAPROC4")
0^58^B46247334
"RTN","PSAPROC4",1,0)
PSAPROC4 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSAPROC4",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPROC4",3,0)
 ;This routine allows the user to edit invoices with errors or missing
"RTN","PSAPROC4",4,0)
 ;data.
"RTN","PSAPROC4",5,0)
 ;
"RTN","PSAPROC4",6,0)
MANYNDCS ;List drug synonym data & ask user which on to use
"RTN","PSAPROC4",7,0)
 K PSADIFF,PSASAME S (PSACNT,PSAFND,PSAIEN50)=0,PSANDC=$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4),"~")
"RTN","PSAPROC4",8,0)
 F  S PSAIEN50=$O(^PSDRUG("C",PSANDC,PSAIEN50)) Q:'PSAIEN50  S PSASYN=0 D
"RTN","PSAPROC4",9,0)
 .F  S PSASYN=$O(^PSDRUG("C",PSANDC,PSAIEN50,PSASYN)) Q:'PSASYN  D
"RTN","PSAPROC4",10,0)
 ..Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAPROC4",11,0)
 ..I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^",4)=PSAVSN S PSAFND=PSAFND+1,PSASAME(PSAFND)=PSAIEN50_"^"_PSASYN
"RTN","PSAPROC4",12,0)
 ..I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^",4)'=PSAVSN S PSACNT=PSACNT+1,PSADIFF(PSACNT)=PSAIEN50_"^"_PSASYN
"RTN","PSAPROC4",13,0)
 G:PSAFND SAME G:PSACNT DIFF
"RTN","PSAPROC4",14,0)
 Q
"RTN","PSAPROC4",15,0)
 ;
"RTN","PSAPROC4",16,0)
SAME ;If more than one drug with same VSN, assign to correct drug.
"RTN","PSAPROC4",17,0)
 W !,"There is more than one item in the DRUG file",!,"with the same NDC and Vendor Stock Number.",!
"RTN","PSAPROC4",18,0)
 S (PSACNT,PSAMENU)=0 F  S PSACNT=$O(PSASAME(PSACNT)) Q:'PSACNT  D
"RTN","PSAPROC4",19,0)
 .S PSAIEN50=$P(PSASAME(PSACNT),"^"),PSASYN=$P(PSASAME(PSACNT),"^",2),PSANODE=^PSDRUG(PSAIEN50,1,PSASYN,0) S PSAMENU=PSAMENU+1
"RTN","PSAPROC4",20,0)
 .Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAPROC4",21,0)
 .D LIST Q:PSAOUT
"RTN","PSAPROC4",22,0)
 D CHOOSE Q:PSAOUT!(Y="")
"RTN","PSAPROC4",23,0)
 I PSAPICK=PSAMENU D ASKDRUG^PSANDF G KILL
"RTN","PSAPROC4",24,0)
 I PSAPICK<PSAMENU D
"RTN","PSAPROC4",25,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,$P(^(PSALINE),"^",7)=$P(PSASAME(PSAPICK),"^",2),$P(^(PSALINE),"^",5)=$P($P(^(PSALINE),"^",5),"~"),PSANEXT=1,PSADATA=^(PSALINE)
"RTN","PSAPROC4",26,0)
 .I $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)'=$P(PSASAME(PSAPICK),"^") D
"RTN","PSAPROC4",27,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=$P(PSASAME(PSAPICK),"^"),$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT,PSANEXT=1,PSADATA=^(PSALINE)
"RTN","PSAPROC4",28,0)
 ..I $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",13)="SUP" S $P(^("IN"),"^",13)="",PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC4",29,0)
 ..D HDR^PSAPROC6,EDIT1^PSAUTL1
"RTN","PSAPROC4",30,0)
 G KILL
"RTN","PSAPROC4",31,0)
 ;
"RTN","PSAPROC4",32,0)
DIFF ;If more than one drug with different VSN, assign to correct drug.
"RTN","PSAPROC4",33,0)
 W !,"There is more than one item in the DRUG file with the same NDC.",!
"RTN","PSAPROC4",34,0)
 S (PSACNT,PSAMENU)=0 F  S PSACNT=$O(PSADIFF(PSACNT)) Q:'PSACNT  D
"RTN","PSAPROC4",35,0)
 .S PSAIEN50=$P(PSADIFF(PSACNT),"^"),PSASYN=$P(PSADIFF(PSACNT),"^",2),PSANODE=^PSDRUG(PSAIEN50,1,PSASYN,0),PSAMENU=PSAMENU+1
"RTN","PSAPROC4",36,0)
 .Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAPROC4",37,0)
 .D LIST Q:PSAOUT
"RTN","PSAPROC4",38,0)
 D CHOOSE Q:PSAOUT!(Y="")
"RTN","PSAPROC4",39,0)
 I PSAPICK=PSAMENU D ASKDRUG^PSANDF G KILL
"RTN","PSAPROC4",40,0)
 I PSAPICK<PSAMENU D
"RTN","PSAPROC4",41,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,$P(^(PSALINE),"^",7)=$P(PSADIFF(PSAPICK),"^",2),PSANEXT=1,PSADATA=^(PSALINE)
"RTN","PSAPROC4",42,0)
 .I $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)'=$P(PSADIFF(PSAPICK),"^") D
"RTN","PSAPROC4",43,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=$P(PSADIFF(PSAPICK),"^"),$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT,PSANEXT=1,PSADATA=^(PSALINE)
"RTN","PSAPROC4",44,0)
 ..I $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",13)="SUP" S $P(^("IN"),"^",13)="",PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC4",45,0)
 ..D HDR^PSAPROC6,EDIT1^PSAUTL1
"RTN","PSAPROC4",46,0)
KILL K PSASAME,PSAFND
"RTN","PSAPROC4",47,0)
 Q
"RTN","PSAPROC4",48,0)
 ;
"RTN","PSAPROC4",49,0)
LIST Q:PSANODE=""!($P($G(^PSDRUG(PSAIEN50,0)),"^")="")
"RTN","PSAPROC4",50,0)
 W !?1,PSAMENU_".",?4,$P($G(^PSDRUG(PSAIEN50,0)),"^")
"RTN","PSAPROC4",51,0)
 I +$P(PSANODE,"^",5),$P($G(^DIC(51.5,+$P(PSANODE,"^",5),0)),"^")'="" W !?4,"Order Unit: "_$P(^DIC(51.5,+$P(PSANODE,"^",5),0),"^"),?45,"Price Per Order Unit   : $"_$S(+$P(PSANODE,"^",6):$P(PSANODE,"^",6),1:"(Blank)")
"RTN","PSAPROC4",52,0)
 E  I +$P(PSANODE,"^",6) W !?4,"Price Per Order Unit: $"_$P(PSANODE,"^",6)
"RTN","PSAPROC4",53,0)
 I $P(PSANODE,"^",9)'="" W !?4,"Vendor: "_$P(PSANODE,"^",9),?45,"VSN: "_$S($P(PSANODE,"^",4)'="":$P(PSANODE,"^",4),1:"(Blank)")
"RTN","PSAPROC4",54,0)
 E  I $P(PSANODE,"^",4)'="" W !?4,"VSN: "_$S($P(PSANODE,"^",4)'="":$P(PSANODE,"^",4),1:"(Blank)")
"RTN","PSAPROC4",55,0)
 Q
"RTN","PSAPROC4",56,0)
 ;
"RTN","PSAPROC4",57,0)
CHOOSE S PSAMENU=PSAMENU+1
"RTN","PSAPROC4",58,0)
 W !?1,PSAMENU,".",?4,"Select another drug."
"RTN","PSAPROC4",59,0)
 W ! S DIR(0)="N^1:"_PSAMENU,DIR("A")="Select the invoiced drug",DIR("?")="Select the drug from the list for which you were invoiced.",DIR("??")="^D NDCHELP^PSAPROC4"
"RTN","PSAPROC4",60,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC4",61,0)
 S PSAPICK=+Y
"RTN","PSAPROC4",62,0)
 Q
"RTN","PSAPROC4",63,0)
 ;
"RTN","PSAPROC4",64,0)
MANYVSNS ;List drug synonym data & ask user which on to use
"RTN","PSAPROC4",65,0)
 K PSADIFF,PSASAME S (PSACNT,PSAFND,PSAIEN50)=0,PSAVSN=$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5),"~")
"RTN","PSAPROC4",66,0)
 F  S PSAIEN50=$O(^PSDRUG("AVSN",PSAVSN,PSAIEN50)) Q:'PSAIEN50  S PSASYN=0 D
"RTN","PSAPROC4",67,0)
 .F  S PSASYN=$O(^PSDRUG("AVSN",PSAVSN,PSAIEN50,PSASYN)) Q:'PSASYN  D
"RTN","PSAPROC4",68,0)
 ..Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAPROC4",69,0)
 ..I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^")=PSANDC S PSAFND=PSAFND+1,PSASAME(PSAFND)=PSAIEN50_"^"_PSASYN
"RTN","PSAPROC4",70,0)
 ..I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^")'=PSANDC S PSACNT=PSACNT+1,PSADIFF(PSACNT)=PSAIEN50_"^"_PSASYN
"RTN","PSAPROC4",71,0)
 G:PSAFND SAMEV G:PSACNT DIFFV
"RTN","PSAPROC4",72,0)
 Q
"RTN","PSAPROC4",73,0)
 ;
"RTN","PSAPROC4",74,0)
SAMEV ;If more than one drug with same NDC, assign to correct drug.
"RTN","PSAPROC4",75,0)
 W !,"There is more than one item in the DRUG file",!,"with the same NDC and Vendor Stock Number.",!
"RTN","PSAPROC4",76,0)
 S (PSACNT,PSAMENU)=0 F  S PSACNT=$O(PSASAME(PSACNT)) Q:'PSACNT  D
"RTN","PSAPROC4",77,0)
 .S PSAIEN50=$P(PSASAME(PSACNT),"^"),PSASYN=$P(PSASAME(PSACNT),"^",2),PSANODE=^PSDRUG(PSAIEN50,1,PSASYN,0),PSAMENU=PSAMENU+1
"RTN","PSAPROC4",78,0)
 .Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAPROC4",79,0)
 .D LIST Q:PSAOUT
"RTN","PSAPROC4",80,0)
 D CHOOSE Q:PSAOUT!(Y="")
"RTN","PSAPROC4",81,0)
 I PSAPICK=PSAMENU D ASKDRUG^PSANDF G KILL
"RTN","PSAPROC4",82,0)
 I PSAPICK<PSAMENU D
"RTN","PSAPROC4",83,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=PSAVSN,$P(^(PSALINE),"^",7)=$P(PSASAME(PSAPICK),"^",2),PSANEXT=1,PSADATA=^(PSALINE)
"RTN","PSAPROC4",84,0)
 .I $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)'=$P(PSASAME(PSAPICK),"^") D
"RTN","PSAPROC4",85,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=$P(PSASAME(PSAPICK),"^"),$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT,PSANEXT=1,PSADATA=^(PSALINE)
"RTN","PSAPROC4",86,0)
 ..I $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",13)="SUP" S $P(^("IN"),"^",13)="",PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC4",87,0)
 ..D HDR^PSAPROC6,EDIT1^PSAUTL1
"RTN","PSAPROC4",88,0)
 G KILL
"RTN","PSAPROC4",89,0)
 ;
"RTN","PSAPROC4",90,0)
DIFFV ;If more than one drug with different VSN, assign to correct drug.
"RTN","PSAPROC4",91,0)
 W !,"There is more than one item in the DRUG file with the same VSN.",!
"RTN","PSAPROC4",92,0)
 S (PSACNT,PSAMENU)=0 F  S PSACNT=$O(PSADIFF(PSACNT)) Q:'PSACNT  D
"RTN","PSAPROC4",93,0)
 .S PSAIEN50=$P(PSADIFF(PSACNT),"^"),PSASYN=$P(PSADIFF(PSACNT),"^",2),PSANODE=$G(^PSDRUG(PSAIEN50,1,PSASYN,0)),PSAMENU=PSAMENU+1
"RTN","PSAPROC4",94,0)
 .Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAPROC4",95,0)
 .D LIST Q:PSAOUT
"RTN","PSAPROC4",96,0)
 D CHOOSE Q:PSAOUT!(Y="")
"RTN","PSAPROC4",97,0)
 I PSAPICK=PSAMENU D ASKDRUG^PSANDF G KILL
"RTN","PSAPROC4",98,0)
 I PSAPICK<PSAMENU D
"RTN","PSAPROC4",99,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=PSAVSN,$P(^(PSALINE),"^",7)=$P(PSADIFF(PSAPICK),"^",2),PSANEXT=1
"RTN","PSAPROC4",100,0)
 .I $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)'=$P(PSADIFF(PSAPICK),"^") D
"RTN","PSAPROC4",101,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",15)=$P(PSADIFF(PSAPICK),"^"),$P(^(PSALINE),"^",16)=DUZ,$P(^(PSALINE),"^",17)=DT,PSADATA=^(PSALINE)
"RTN","PSAPROC4",102,0)
 ..S PSANDC=$P($G(^PSDRUG(+$P(PSADIFF(PSAPICK),"^"),1,+$P(PSADIFF(PSAPICK),"^",2),0)),"^"),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC
"RTN","PSAPROC4",103,0)
 ..I $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",13)="SUP" S $P(^("IN"),"^",13)="",PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC4",104,0)
 ..D HDR^PSAPROC6,EDIT1^PSAUTL1
"RTN","PSAPROC4",105,0)
 G KILL
"RTN","PSAPROC4",106,0)
 ;
"RTN","PSAPROC4",107,0)
NDCHELP ;Extended help for selecting invoiced drug
"RTN","PSAPROC4",108,0)
 W !?5,"Enter the number to the left of the invoiced drug. If you select a drug",!?5,"from the list, the invoiced drug will be matched to that drug. If you"
"RTN","PSAPROC4",109,0)
 W !?5,"choose to select another drug, you can select the invoiced drug from the",!?5,"DRUG file or flag this item as a supply item."
"RTN","PSAPROC4",110,0)
 Q
"RTN","PSAPROC5")
0^59^B43289322
"RTN","PSAPROC5",1,0)
PSAPROC5 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSAPROC5",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPROC5",3,0)
 ;This routine allows the user to edit invoices with errors or missing
"RTN","PSAPROC5",4,0)
 ;data.
"RTN","PSAPROC5",5,0)
 ;
"RTN","PSAPROC5",6,0)
MANYUPCS ;List supply synonym data & ask user which on to use
"RTN","PSAPROC5",7,0)
 K PSADIFF,PSASAME
"RTN","PSAPROC5",8,0)
 S (PSACNT,PSAFND,PSAIEN50)=0,PSASUP=$P($P(PSADATA,"^",26),"~"),PSANDC="S"_PSASUP
"RTN","PSAPROC5",9,0)
 F  S PSAIEN50=$O(^PSDRUG("C",PSANDC,PSAIEN50)) Q:'PSAIEN50  S PSASYN=0 D
"RTN","PSAPROC5",10,0)
 .F  S PSASYN=$O(^PSDRUG("C",PSANDC,PSAIEN50,PSASYN)) Q:'PSASYN  D
"RTN","PSAPROC5",11,0)
 ..Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAPROC5",12,0)
 ..I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^",4)=PSAVSN S PSAFND=PSAFND+1,PSASAME(PSAFND)=PSAIEN50_"^"_PSASYN
"RTN","PSAPROC5",13,0)
 ..I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^",4)'=PSAVSN S PSACNT=PSACNT+1,PSADIFF(PSACNT)=PSAIEN50_"^"_PSASYN
"RTN","PSAPROC5",14,0)
 G:PSAFND SAMEU G:PSACNT DIFFU
"RTN","PSAPROC5",15,0)
 Q
"RTN","PSAPROC5",16,0)
 ;
"RTN","PSAPROC5",17,0)
SAMEU ;If more than one drug with same VSN, assign to correct drug.
"RTN","PSAPROC5",18,0)
 W !!,"There is more than one supply in the DRUG file",!,"with the same UPC and Vendor Stock Number.",!
"RTN","PSAPROC5",19,0)
 S (PSACNT,PSAMENU)=0
"RTN","PSAPROC5",20,0)
 F  S PSACNT=$O(PSASAME(PSACNT)) Q:'PSACNT  D
"RTN","PSAPROC5",21,0)
 .S PSAIEN50=$P(PSASAME(PSACNT),"^"),PSASYN=$P(PSASAME(PSACNT),"^",2),PSANODE=$G(^PSDRUG(PSAIEN50,1,PSASYN,0)),PSAMENU=PSAMENU+1
"RTN","PSAPROC5",22,0)
 .Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAPROC5",23,0)
 .D LIST^PSAPROC4 Q:PSAOUT
"RTN","PSAPROC5",24,0)
 D CHOOSEU Q:PSAOUT
"RTN","PSAPROC5",25,0)
 I PSAPICK=PSAMENU D ASKDRUG^PSANDF G:PSAOUT KILL^PSAPROC4 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",26)=PSASUP,PSANEXT=1,PSADATA=^(PSALINE) G KILL^PSAPROC4
"RTN","PSAPROC5",26,0)
 I PSAPICK<PSAMENU D
"RTN","PSAPROC5",27,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,$P(^(PSALINE),"^",7)=$P(PSASAME(PSAPICK),"^",2),$P(^(PSALINE),"^",15)=$P(PSASAME(PSAPICK),"^"),$P(^(PSALINE),"^",26)=PSASUP,PSANEXT=1,PSADATA=^(PSALINE)
"RTN","PSAPROC5",28,0)
 .I $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",13)="SUP" S $P(^("IN"),"^",13)="",PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC5",29,0)
 G KILL^PSAPROC4
"RTN","PSAPROC5",30,0)
 ;
"RTN","PSAPROC5",31,0)
DIFFU ;If more than one supply with different UPC, assign to correct drug.
"RTN","PSAPROC5",32,0)
 W !!,"There is more than one supply in the DRUG file with the same UPC.",!
"RTN","PSAPROC5",33,0)
 S (PSACNT,PSAMENU)=0 F  S PSACNT=$O(PSADIFF(PSACNT)) Q:'PSACNT  D
"RTN","PSAPROC5",34,0)
 .S PSAIEN50=$P(PSADIFF(PSACNT),"^"),PSASYN=$P(PSADIFF(PSACNT),"^",2),PSANODE=$G(^PSDRUG(PSAIEN50,1,PSASYN,0)),PSAMENU=PSAMENU+1
"RTN","PSAPROC5",35,0)
 .Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAPROC5",36,0)
 .D LIST^PSAPROC4 Q:PSAOUT
"RTN","PSAPROC5",37,0)
 D CHOOSEU Q:PSAOUT
"RTN","PSAPROC5",38,0)
 I PSAPICK=PSAMENU D ASKDRUG^PSANDF G:PSAOUT KILL^PSAPROC4 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",26)=PSASUP,PSANEXT=1,PSADATA=^(PSALINE) G KILL^PSAPROC4
"RTN","PSAPROC5",39,0)
 I PSAPICK<PSAMENU D
"RTN","PSAPROC5",40,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,$P(^(PSALINE),"^",7)=$P(PSADIFF(PSAPICK),"^",2),$P(^(PSALINE),"^",15)=$P(PSADIFF(PSAPICK),"^"),$P(^(PSALINE),"^",26)=PSASUP,PSANEXT=1,PSADATA=^(PSALINE)
"RTN","PSAPROC5",41,0)
 .I $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",13)="SUP" S $P(^("IN"),"^",13)="",PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC5",42,0)
 G KILL^PSAPROC4
"RTN","PSAPROC5",43,0)
 ;
"RTN","PSAPROC5",44,0)
CHOOSEU S PSAMENU=PSAMENU+1
"RTN","PSAPROC5",45,0)
 W !?1,PSAMENU_".",?4,"Select another item."
"RTN","PSAPROC5",46,0)
 W ! S DIR(0)="NO^1:"_PSAMENU,DIR("A")="Select the invoiced item",DIR("?")="Select the item from the list for which you were invoiced.",DIR("??")="^D UPCHELP^PSAPROC5"
"RTN","PSAPROC5",47,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC5",48,0)
 S PSAPICK=+Y
"RTN","PSAPROC5",49,0)
 Q
"RTN","PSAPROC5",50,0)
 ;
"RTN","PSAPROC5",51,0)
NDCDIFF ;If New NDC is correct, remove "~" piece with questionable NDC in ^XTMP.
"RTN","PSAPROC5",52,0)
 ;If Old NDC is correct, remove "~" piece with questionable NDC & set
"RTN","PSAPROC5",53,0)
 ;old NDC in NDC piece in ^XTMP.
"RTN","PSAPROC5",54,0)
 W !!,"There is a change in Vendor Stock Number's NDC."
"RTN","PSAPROC5",55,0)
 W !,"New NDC: "_PSANDC_"  "
"RTN","PSAPROC5",56,0)
 W !,"Old NDC: "_$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5),"~",3),!
"RTN","PSAPROC5",57,0)
 S DIR(0)="Y",DIR("A")="Is the new NDC correct",DIR("B")="Y",DIR("?",1)="Enter Yes if the line item's NDC is correct.",DIR("?")="Enter No is the old NDC is correct."
"RTN","PSAPROC5",58,0)
 S DIR("??")="^D NEWOLDN^PSAPROC5" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC5",59,0)
 I +Y S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=PSAVSN_"~~~1",$P(^(PSALINE),"^",4)=PSANDC,PSADATA=^(PSALINE),PSANEXT=1 Q
"RTN","PSAPROC5",60,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5),"~",3),$P(^(PSALINE),"^",5)=PSAVSN,PSANEXT=1,PSADATA=^(PSALINE)
"RTN","PSAPROC5",61,0)
 Q
"RTN","PSAPROC5",62,0)
 ;
"RTN","PSAPROC5",63,0)
SUPDIFF ;If New UPC is correct, remove "~" piece with questionable UPC in ^XTMP.
"RTN","PSAPROC5",64,0)
 ;If Old UPC is correct, remove "~" piece with questionable UPC & set old UPC in VSN piece in ^XTMP.
"RTN","PSAPROC5",65,0)
 W !!,"There is a change in item's Universal Product Code (UPC)."
"RTN","PSAPROC5",66,0)
 W !,"New UPC: "_PSAUPC
"RTN","PSAPROC5",67,0)
 W !,"Old UPC: "_$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",26),"~",3),!
"RTN","PSAPROC5",68,0)
 S DIR(0)="Y",DIR("A")="Is the new UPC correct",DIR("B")="Y",DIR("?",1)="Enter Yes if the line item's Universal Product Code is correct.",DIR("?")="Enter No is the old Universal Product Code is correct."
"RTN","PSAPROC5",69,0)
 S DIR("??")="^D NEWUPC^PSAPROC5" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC5",70,0)
 S PSANDC="S"_$P($P(PSADATA,"^",26),"~")
"RTN","PSAPROC5",71,0)
 I +Y S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC,$P(^(PSALINE),"^",26)=PSAUPC,PSADATA=^(PSALINE),PSANEXT=1 Q
"RTN","PSAPROC5",72,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",26)=$P($P(^(PSALINE),"^",26),"~",3),$P(^(PSALINE),"^",4)=PSANDC,PSADATA=^(PSALINE),PSANEXT=1
"RTN","PSAPROC5",73,0)
 Q
"RTN","PSAPROC5",74,0)
 ;
"RTN","PSAPROC5",75,0)
VSNDIFF ;If New VSN is correct, remove "~" piece with questionable VSN in ^XTMP.
"RTN","PSAPROC5",76,0)
 ;If Old VSN is correct, remove "~" piece with questionable VSN & set old VSN in VSN piece in ^XTMP.
"RTN","PSAPROC5",77,0)
 W !!,"There is a change in the NDC's Vendor Stock Number (VSN)."
"RTN","PSAPROC5",78,0)
 W !,"New VSN: "_PSAVSN_"  "
"RTN","PSAPROC5",79,0)
 W !,"Old VSN: "_$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4),"~",3),!
"RTN","PSAPROC5",80,0)
 S DIR(0)="Y",DIR("A")="Is the new VSN correct",DIR("B")="Y",DIR("?",1)="Enter Yes if the line item's Vendor Stock Number is correct.",DIR("?")="Enter No is the old Vendor Stock Number is correct."
"RTN","PSAPROC5",81,0)
 S DIR("??")="^D NEWOLD^PSAPROC5" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC5",82,0)
 I +Y S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC_"~~~1",$P(^(PSALINE),"^",5)=PSAVSN,PSADATA=^(PSALINE),PSANEXT=1 Q
"RTN","PSAPROC5",83,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4),"~",3),$P(^(PSALINE),"^",4)=PSANDC,PSADATA=^(PSALINE),PSANEXT=1
"RTN","PSAPROC5",84,0)
 Q
"RTN","PSAPROC5",85,0)
 ;
"RTN","PSAPROC5",86,0)
NEWOLD ;Extended help to 'Is new VSN correct'
"RTN","PSAPROC5",87,0)
 W !?5,"Enter Yes to add another synonym for the NDC with the new VSN.",!?5,"Enter No to discard the new VSN."
"RTN","PSAPROC5",88,0)
 Q
"RTN","PSAPROC5",89,0)
NEWOLDN ;Extended help to 'Is new NDC correct'
"RTN","PSAPROC5",90,0)
 W !?5,"Enter Yes to add another synonym for the NDC with the new NDC.",!?5,"Enter No to discard the new NDC."
"RTN","PSAPROC5",91,0)
 Q
"RTN","PSAPROC5",92,0)
NEWUPC ;Extended help to 'Is new UPC correct'
"RTN","PSAPROC5",93,0)
 W !?5,"Enter Yes to add another synonym for the NDC with the new UPC.",!?5,"Enter No to discard the new UPC."
"RTN","PSAPROC5",94,0)
 Q
"RTN","PSAPROC5",95,0)
UPCHELP ;Extended help for selecting invoiced supply
"RTN","PSAPROC5",96,0)
 W !?5,"Enter the number of the invoiced item. If you select an item from the",!?5,"list, the invoice data will be added to that item. If you select to"
"RTN","PSAPROC5",97,0)
 W !?5,"add a new entry in the DRUG file for the invoiced item, a new",!?5,"synonym for the item will be added to the DRUG file."
"RTN","PSAPROC5",98,0)
 Q
"RTN","PSAPROC6")
0^60^B71935962
"RTN","PSAPROC6",1,0)
PSAPROC6 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;10/7/97
"RTN","PSAPROC6",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPROC6",3,0)
 ;This routine allows the user to edit invoices by selecting the
"RTN","PSAPROC6",4,0)
 ;invoice's line item number.
"RTN","PSAPROC6",5,0)
 ;
"RTN","PSAPROC6",6,0)
SEL ;Loops thru selected invoices
"RTN","PSAPROC6",7,0)
 F PSAPC=1:1 S PSAMENU=$P(PSASEL,",",PSAPC) Q:'PSAMENU!(PSAOUT)  D CORR Q:PSAOUT
"RTN","PSAPROC6",8,0)
 ;
"RTN","PSAPROC6",9,0)
CHECK ;Looks to see if all line items are processed
"RTN","PSAPROC6",10,0)
 S (PSACS,PSAERR,PSALINE,PSALINES,PSALNCNT,PSALNSU,PSAOUT,PSASUP)=0
"RTN","PSAPROC6",11,0)
 F  S PSALINE=$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:'PSALINE  D
"RTN","PSAPROC6",12,0)
 .S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE),PSALNCNT=PSALNCNT+1
"RTN","PSAPROC6",13,0)
 .S:$P(PSADATA,"^",18)="P"!($P(PSADATA,"^",18)="OK") PSALINES=PSALINES+1
"RTN","PSAPROC6",14,0)
 .S:$P(PSADATA,"^",19)="CS" PSACS=PSACS+1
"RTN","PSAPROC6",15,0)
 I PSACS,PSALNCNT=PSACS D
"RTN","PSAPROC6",16,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",10)="ALL CS",$P(^("IN"),"^",9)="CS" W !,"All drugs on the invoice are marked as a controlled substance."
"RTN","PSAPROC6",17,0)
 .D:$P($G(^PSD(58.8,+$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12),0)),"^",2)'="M" MASTER^PSAPROC9
"RTN","PSAPROC6",18,0)
 E  S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",10)=""
"RTN","PSAPROC6",19,0)
 I PSACS S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",9)="CS"
"RTN","PSAPROC6",20,0)
 I +PSALNCNT,PSALNCNT=PSALINES D CHG D END^PSAPROC Q
"RTN","PSAPROC6",21,0)
 E  W !!,"** The invoice has not been placed in a Processed status!"
"RTN","PSAPROC6",22,0)
 D END^PSAPROC
"RTN","PSAPROC6",23,0)
 Q
"RTN","PSAPROC6",24,0)
 ;
"RTN","PSAPROC6",25,0)
CHG ;Asks if invoice's status should be changed to verified. If so, status
"RTN","PSAPROC6",26,0)
 ;is changed & new drugs to location is listed.
"RTN","PSAPROC6",27,0)
 W ! S DIR(0)="Y",DIR("A")="Do you want to change the invoice's status to Processed",DIR("?",1)="Enter YES to change the invoice's status to Processed.",DIR("?")="Enter NO to keep the invoice's status as Uploaded."
"RTN","PSAPROC6",28,0)
 S DIR("??")="^D CHGYN^PSAPROC6" D ^DIR K DIR
"RTN","PSAPROC6",29,0)
 I 'Y!($G(DIRUT)) S PSACHG=0,$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",8)="" W !!,"** The invoice's status has not been changed to Processed." Q
"RTN","PSAPROC6",30,0)
 S PSACHG=+Y,$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",8)="P"
"RTN","PSAPROC6",31,0)
 W !!,"The invoice status has been changed to Processed!"
"RTN","PSAPROC6",32,0)
 Q
"RTN","PSAPROC6",33,0)
 ;
"RTN","PSAPROC6",34,0)
CORR S PSACTRL=$P(PSAERR(PSAMENU),"^",3),(PSALNCNT,PSALINES,PSACS)=0
"RTN","PSAPROC6",35,0)
 S PSAIN=^XTMP("PSAPV",PSACTRL,"IN"),PSARECD=$S(+$P(PSAIN,"^",11):+$P(PSAIN,"^",11),+$P(PSAIN,"^",6):+$P(PSAIN,"^",6),1:""),PSALOC=+$P(PSAIN,"^",7),PSAMV=+$P(PSAIN,"^",12)
"RTN","PSAPROC6",36,0)
 D HDR,RECD^PSAPROC3 Q:PSAOUT
"RTN","PSAPROC6",37,0)
LOC I $P(PSAIN,"^",9)="CS" W !!,"MASTER VAULT: "_$P($G(^PSD(58.8,PSAMV,0)),"^") D MV Q:PSAOUT
"RTN","PSAPROC6",38,0)
 I $P(PSAIN,"^",10)="" D  Q:PSAOUT
"RTN","PSAPROC6",39,0)
 .D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSAPROC6",40,0)
 .W !!,"PHARMACY LOCATION: "
"RTN","PSAPROC6",41,0)
 .W:$L(PSALOCN)>76 !,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 !,PSALOCN D PHARM
"RTN","PSAPROC6",42,0)
LINES S PSADONE=0 F  W !!,"Line Item Numbers: " D  Q:PSAOUT!(PSADONE)
"RTN","PSAPROC6",43,0)
 .S PSALINE=0 S PSALINE=$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:'PSALINE  W ?19,PSALINE
"RTN","PSAPROC6",44,0)
 .F  S PSALINE=$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:'PSALINE  D
"RTN","PSAPROC6",45,0)
 ..I $X+$L(PSALINE)+2>79 W !,?19,PSALINE Q
"RTN","PSAPROC6",46,0)
 ..W ","_PSALINE
"RTN","PSAPROC6",47,0)
 .W ! S DIR(0)="LO",DIR("A")="Select Line Item Number",DIR("?")="Enter the line numbers to be edited",DIR("??")="^D LNHELP^PSAPROC6"
"RTN","PSAPROC6",48,0)
 .D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC6",49,0)
 .I X="" S PSADONE=1 Q
"RTN","PSAPROC6",50,0)
 .S PSALINE=X
"RTN","PSAPROC6",51,0)
 .I '$D(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) W !,"Invalid line number." Q
"RTN","PSAPROC6",52,0)
 .S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC6",53,0)
 .S PSAIEN=$S(+$P(PSADATA,"^",15):+$P(PSADATA,"^",15),1:+$P(PSADATA,"^",6))
"RTN","PSAPROC6",54,0)
 .S PSANDC=$P($P(PSADATA,"^",4),"~"),PSAVSN=$P($P(PSADATA,"^",5),"~"),PSASUB=+$P(PSADATA,"^",7),PSASUP=0
"RTN","PSAPROC6",55,0)
 .S PSALOC=$S($P(PSADATA,"^",19)="CS":+$P(PSAIN,"^",12),1:+$P(PSAIN,"^",7))
"RTN","PSAPROC6",56,0)
 .D EDITDISP^PSAUTL1 W !,PSASLN,!
"RTN","PSAPROC6",57,0)
 .W "1. Drug",!,"2. Quantity Received",!,"3. Order Unit",!,"4. Dispense Units per Order Unit" S PSACHO=4
"RTN","PSAPROC6",58,0)
 .I +$P($G(^PSD(58.8,PSALOC,0)),"^",14) W !,"5. Stock Level",!,"6. Reorder Level" S PSACHO=6
"RTN","PSAPROC6",59,0)
 .W ! S DIR(0)="LO^1:"_PSACHO,DIR("A")="Edit fields",DIR("?")="Enter the number(s) of the data to be edited",DIR("??")="^D DQOR^PSAPROC6"
"RTN","PSAPROC6",60,0)
 .D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC6",61,0)
 .Q:Y=""  S PSAFLDS=Y,PSADU=0 D EDITDISP^PSAUTL1 W !,PSASLN
"RTN","PSAPROC6",62,0)
FIELDS .F PSAPCF=1:1 S PSAFLD=$P(PSAFLDS,",",PSAPCF) Q:'PSAFLD!(PSAOUT)  D
"RTN","PSAPROC6",63,0)
 ..I PSAFLD=1 D ASKDRUG^PSANDF Q
"RTN","PSAPROC6",64,0)
 ..I PSAFLD=2 D QTY^PSAPROC3 Q
"RTN","PSAPROC6",65,0)
 ..I PSAFLD=3 D GETOU^PSAPROC3 Q
"RTN","PSAPROC6",66,0)
 ..I PSAFLD=4,PSAIEN,PSASUB D:$P($G(^PSDRUG(PSAIEN,660)),"^",8)="" DU^PSAPROC8 D DUOU^PSAPROC8 Q
"RTN","PSAPROC6",67,0)
 ..I PSAFLD=4,PSAIEN,'PSASUB D:$P($G(^PSDRUG(PSAIEN,660)),"^",8)="" DU^PSAPROC8 D DUOU^PSAPROC3 Q
"RTN","PSAPROC6",68,0)
 ..I PSAFLD=5 D STOCK^PSAPROC8 Q
"RTN","PSAPROC6",69,0)
 ..I PSAFLD=6 D REORDER^PSAPROC8
"RTN","PSAPROC6",70,0)
 .D:'PSAOUT PROCESS
"RTN","PSAPROC6",71,0)
 Q
"RTN","PSAPROC6",72,0)
 ;
"RTN","PSAPROC6",73,0)
PROCESS ;Checks for & prompts for missing data.
"RTN","PSAPROC6",74,0)
 Q:$D(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP"))
"RTN","PSAPROC6",75,0)
 S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC6",76,0)
 S PSAIEN=$S(+$P(PSADATA,"^",15):+$P(PSADATA,"^",15),+$P(PSADATA,"^",6):+$P(PSADATA,"^",6),1:0),PSASUB=+$P(PSADATA,"^",7)
"RTN","PSAPROC6",77,0)
 ;If no order unit, store it.
"RTN","PSAPROC6",78,0)
 I '+$P($P(PSADATA,"^",2),"~",2),'$P(PSADATA,"^",12) D  Q:PSAOUT
"RTN","PSAPROC6",79,0)
 .I PSAIEN,PSASUB,'$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",5) D GETOU^PSAPROC3 Q
"RTN","PSAPROC6",80,0)
 .I PSAIEN,'PSASUB D GETOU^PSAPROC3
"RTN","PSAPROC6",81,0)
 ;If synonym & doesn't have disp units/order unit, store it 50.
"RTN","PSAPROC6",82,0)
 I PSAIEN,PSASUB,'+$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",7),'+$P(PSADATA,"^",20) S PSADU=0 D DUOU^PSAPROC8 Q:PSAOUT
"RTN","PSAPROC6",83,0)
 ;If no synonym & disp units/order unit, store it XTMP.
"RTN","PSAPROC6",84,0)
 I PSAIEN,'PSASUB,'$P(PSADATA,"^",20) D DUOU^PSAPROC3 Q:PSAOUT
"RTN","PSAPROC6",85,0)
 I '+$P(PSADATA,"^",3) D PRICE^PSAPROC3 Q:PSAOUT
"RTN","PSAPROC6",86,0)
 ;If not CS & maintains stock, prompt for stock & reorder levels
"RTN","PSAPROC6",87,0)
 I $P(PSADATA,"^",19)'="CS",+$P(PSAIN,"^",7),+$P($G(^PSD(58.8,+$P(PSAIN,"^",7),0)),"^",14) D
"RTN","PSAPROC6",88,0)
 .I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSAIEN,0)),"^",3),'+$P(PSADATA,"^",27) S PSALOC=$P(PSAIN,"^",7) D STOCK^PSAPROC8 Q:PSAOUT
"RTN","PSAPROC6",89,0)
 .I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSAIEN,0)),"^",5),'+$P(PSADATA,"^",21) S PSALOC=$P(PSAIN,"^",7) D REORDER^PSAPROC8 Q:PSAOUT
"RTN","PSAPROC6",90,0)
 ;If CS & maintains stock, prompt for stock & reorder level
"RTN","PSAPROC6",91,0)
 I $P(PSADATA,"^",19)="CS",+$P(PSAIN,"^",12),+$P($G(^PSD(58.8,+$P(PSAIN,"^",12),0)),"^",14) D
"RTN","PSAPROC6",92,0)
 .I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSAIEN,0)),"^",3),'+$P(PSADATA,"^",27) S PSALOC=$P(PSAIN,"^",12) D STOCK^PSAPROC8 Q:PSAOUT
"RTN","PSAPROC6",93,0)
 .I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSAIEN,0)),"^",5),'+$P(PSADATA,"^",21) S PSALOC=$P(PSAIN,"^",12) D REORDER^PSAPROC8 Q:PSAOUT
"RTN","PSAPROC6",94,0)
 Q:PSAOUT  D CHECK^PSANDF Q:PSAOUT  D SETLINE^PSAPROC3
"RTN","PSAPROC6",95,0)
 Q
"RTN","PSAPROC6",96,0)
 ;
"RTN","PSAPROC6",97,0)
MV ;Assigns master vault
"RTN","PSAPROC6",98,0)
 S DIC("A")="Select Master Vault: ",DIC="^PSD(58.8,",DIC(0)="QAEMZ" S:+PSAMV DIC("B")=$P($G(^PSD(58.8,+PSAMV,0)),"^")
"RTN","PSAPROC6",99,0)
 S DIC("S")="I $D(^PSD(58.8,""ADISP"",""M"",+Y)),'+$G(^PSD(58.8,+Y,""I""))!(+$G(^PSD(58.8,+Y,""I""))&(+$G(^PSD(58.8,+Y,""I""))'<DT))"
"RTN","PSAPROC6",100,0)
 D ^DIC K DIC I $G(DTOUT)!($G(DUOUT))!(Y<0) S PSAOUT=1 Q
"RTN","PSAPROC6",101,0)
 S PSAMV=+Y,$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)=+Y,PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC6",102,0)
 Q
"RTN","PSAPROC6",103,0)
 ;
"RTN","PSAPROC6",104,0)
PHARM ;Assigns pharmacy location
"RTN","PSAPROC6",105,0)
 S DIC("A")="Select Pharmacy Location: ",DIC="^PSD(58.8,",DIC(0)="QAEMZ" S:+PSALOC DIC("B")=$P($G(^PSD(58.8,+PSALOC,0)),"^")
"RTN","PSAPROC6",106,0)
 S DIC("S")="I $D(^PSD(58.8,""ADISP"",""P"",+Y)),'$G(^PSD(58.8,+Y,""I""))!(+$G(^PSD(58.8,+Y,""I""))&(+$G(^PSD(58.8,+Y,""I""))'<DT))"
"RTN","PSAPROC6",107,0)
 D ^DIC K DIC I $G(DTOUT)!($G(DUOUT))!(Y<0) S PSAOUT=1 Q
"RTN","PSAPROC6",108,0)
 S PSALOC=+Y,$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",7)=+Y,PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAPROC6",109,0)
 Q
"RTN","PSAPROC6",110,0)
 ;
"RTN","PSAPROC6",111,0)
SUPPLY ;Asks if all items are supply items. If so, invoice is deleted from
"RTN","PSAPROC6",112,0)
 ;^XTMP global. If not, invoice is added to list of invoices to be edited.
"RTN","PSAPROC6",113,0)
 W ! S DIR(0)="Y",DIR("A")="Are all the items on the invoice supply items",DIR("B")="N"
"RTN","PSAPROC6",114,0)
 S DIR("?",1)="Enter YES if all line items are not drugs in the DRUG file.",DIR("?")="Enter NO if there is at least one line item that is in the DRUG file."
"RTN","PSAPROC6",115,0)
 S DIR("??")="^D ALLSUP^PSAPROC6" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC6",116,0)
 G:'Y NO
"RTN","PSAPROC6",117,0)
 W ! S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="Y",DIR("?",1)="Enter YES if all the line items on the invoice are supply items.",DIR("?")="Enter NO if there is at least one item on the invoice that is not a supply."
"RTN","PSAPROC6",118,0)
 S DIR("??")="^D ALLSUP^PSAPROC6" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC6",119,0)
NO I 'Y S PSACNTER=PSACNTER+1,PSAERR(PSACNTER)=PSAOK(PSA) K PSAOK(PSA) Q
"RTN","PSAPROC6",120,0)
 K PSAOK(PSA) S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",8)="P",PSASUP=1,PSALINE=0
"RTN","PSAPROC6",121,0)
 F  S PSALINE=$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:'PSALINE  D
"RTN","PSAPROC6",122,0)
 .S ^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")=DUZ_"^"_DT_"^"_"SUPPLY ITEM",$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",18)="P"
"RTN","PSAPROC6",123,0)
 Q
"RTN","PSAPROC6",124,0)
 ;
"RTN","PSAPROC6",125,0)
HDR ;Screen header
"RTN","PSAPROC6",126,0)
 W @IOF,!?26,"<<< EDIT INVOICE SCREEN >>>",!,"Order#: "_$P(PSAIN,"^",4)_"  Invoice#: "_$P(PSAIN,"^",2)_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN),!,PSASLN
"RTN","PSAPROC6",127,0)
 Q
"RTN","PSAPROC6",128,0)
 ;
"RTN","PSAPROC6",129,0)
CHGYN ;Extended help - 'Do you want to change the invoice's status to Processed'
"RTN","PSAPROC6",130,0)
 W !?5,"Enter YES if the invoice is completely correct. You will not be able",!?5,"to edit it again."
"RTN","PSAPROC6",131,0)
 W !!?5,"Enter NO if you need to edit the invoice again. You can edit it again",!?5,"by selecting the Process Orders option."
"RTN","PSAPROC6",132,0)
 Q
"RTN","PSAPROC6",133,0)
DQOR ;Extended help - 'Edit field'
"RTN","PSAPROC6",134,0)
 W !?5,"Enter the number or range of numbers of the field you want to edit."
"RTN","PSAPROC6",135,0)
 Q
"RTN","PSAPROC6",136,0)
LNHELP ;Extended help - 'Line Number"
"RTN","PSAPROC6",137,0)
 W !?5,"Enter the number of the item on the invoice you want to edit. You can",!?5,"enter a line item number then edit that line item. The ""Line Number""",!?5,"prompt will be displayed again. You can keep entering and editing line"
"RTN","PSAPROC6",138,0)
 W !?5,"items until you press the Return key at the ""Line Number"" prompt."
"RTN","PSAPROC6",139,0)
 Q
"RTN","PSAPROC6",140,0)
ALLSUP ;Extended help - "Are all the items on the invoice supply items" &
"RTN","PSAPROC6",141,0)
 ;"Are you sure?"
"RTN","PSAPROC6",142,0)
 W !!?5,"Enter YES if none of the line items on the invoice are",!?5,"in the DRUG file and will never be in the DRUG file.",!!?5,"Enter NO if there is at least one line item on the",!?5,"invoice that is in the DRUG file."
"RTN","PSAPROC6",143,0)
 Q
"RTN","PSAPROC7")
0^61^B29463325
"RTN","PSAPROC7",1,0)
PSAPROC7 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;9/6/97
"RTN","PSAPROC7",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPROC7",3,0)
 ;This routine takes the data in XTMP and moves it to DA ORDERS file.
"RTN","PSAPROC7",4,0)
 ;It deletes the data in XTMP after it is copies.
"RTN","PSAPROC7",5,0)
 ;
"RTN","PSAPROC7",6,0)
 S ZTDESC="Drug Acct. - Process Prime Vendor Invoices",ZTDTH=$H,ZTRTN="INVOICE^PSAPROC7",ZTIO="" S PSADUZ=DUZ,ZTSAVE("PSADUZ")=""
"RTN","PSAPROC7",7,0)
 D ^%ZTLOAD S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSAPROC7",8,0)
 Q
"RTN","PSAPROC7",9,0)
 ;
"RTN","PSAPROC7",10,0)
INVOICE S PSACTRL=0 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""  D
"RTN","PSAPROC7",11,0)
 .S PSAIN=$G(^XTMP("PSAPV",PSACTRL,"IN")) Q:PSAIN=""
"RTN","PSAPROC7",12,0)
 .Q:$P(PSAIN,"^",8)'="P"
"RTN","PSAPROC7",13,0)
 .S PSAORD=$P(PSAIN,"^",4),PSAIEN=+$O(^PSD(58.811,"B",PSAORD,0)),PSACRED=0
"RTN","PSAPROC7",14,0)
 .I 'PSAIEN D
"RTN","PSAPROC7",15,0)
 ..F  L +^PSD(58.811,0):0 I  Q
"RTN","PSAPROC7",16,0)
 ..S DIC="^PSD(58.811,",DIC(0)="L",X=PSAORD,DLAYGO=58.811 D ^DIC K DIC,DLAYGO L -^PSD(58.811,0) S PSAIEN=+Y
"RTN","PSAPROC7",17,0)
 .F  L +^PSD(58.811,PSAIEN,0):10 I  Q
"RTN","PSAPROC7",18,0)
 .S:'$D(^PSD(58.811,PSAIEN,1,0)) DIC("P")=$P(^DD(58.811,2,0),"^",2)
"RTN","PSAPROC7",19,0)
 .S DA(1)=PSAIEN,DIC="^PSD(58.811,"_DA(1)_",1,",DIC(0)="L",X=$P(PSAIN,"^",2),DLAYGO=58.811 D ^DIC K DA,DLAYGO S PSAIEN1=+Y
"RTN","PSAPROC7",20,0)
 .S DA(1)=PSAIEN,DA=PSAIEN1,DIE=DIC K DIC
"RTN","PSAPROC7",21,0)
 .S PSALOCDR=$S(+$P(PSAIN,"^",7):";4///^S X="_$P(PSAIN,"^",7),1:"")
"RTN","PSAPROC7",22,0)
 .S PSADELDR=$S(+$P(PSAIN,"^",6)&(+$P(PSAIN,"^",6)?7N):";7///^S X="_$P(PSAIN,"^",6),1:"")
"RTN","PSAPROC7",23,0)
 .S PSACSDR=$S($P(PSAIN,"^",10)="ALL CS":";9///A",$P(PSAIN,"^",9)="CS":";9///S",1:";9///N")
"RTN","PSAPROC7",24,0)
 .S PSARECD=$S(+$P(PSAIN,"^",11)&(+$P(PSAIN,"^",11)?7N):";8///^S X="_+$P(PSAIN,"^",11),1:"")
"RTN","PSAPROC7",25,0)
 .S PSAMV=$S(+$P(PSAIN,"^",12):";13///^S X="_$P(PSAIN,"^",12),1:"")
"RTN","PSAPROC7",26,0)
 .S PSASUP=$S($P(PSAIN,"^",13)="SUP":";14///1",1:"")
"RTN","PSAPROC7",27,0)
 .S DR="1///^S X="_$P(PSAIN,"^")_";2///P"_";3///^S X="_$P(PSAIN,"^",3)_PSALOCDR_PSADELDR_PSACSDR_PSARECD_";11///^S X="_PSADUZ_PSAMV_PSASUP
"RTN","PSAPROC7",28,0)
 .D ^DIE K DIE,DA
"RTN","PSAPROC7",29,0)
 .S PSALINE=0 F  S PSALINE=$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:PSALINE=""  D LINE
"RTN","PSAPROC7",30,0)
 .I PSACRED K DA S DA(1)=PSAIEN,DA=PSAIEN1,DIE="^PSD(58.811,"_DA(1)_",1,",DR="10///^S X=1" D ^DIE K DIE
"RTN","PSAPROC7",31,0)
 .S $P(^PSD(58.811,PSAIEN,0),"^",2)=$P($G(^XTMP("PSAPV",PSACTRL,"DS")),"^")
"RTN","PSAPROC7",32,0)
 .I $P($G(^XTMP("PSAPV",PSACTRL,"DS")),"^")="BBC" S $P(^PSD(58.811,PSAIEN,0),"^",2)="Bergen Brunswig Corporation"
"RTN","PSAPROC7",33,0)
 .L -^PSD(58.811,PSAIEN,0)
"RTN","PSAPROC7",34,0)
 .K ^XTMP("PSAPV",PSACTRL)
"RTN","PSAPROC7",35,0)
EXIT I '$O(^XTMP("PSAPV",0)) K ^XTMP("PSAPV")
"RTN","PSAPROC7",36,0)
 K DA,DD,DIC,DIE,DO,DR,PSACRED,PSACTRL,PSACS,PSACSDR,PSADATA,PSADELDR,PSADJ,PSADT,PSADUZ,PSAFLD,PSAIEN,PSAIEN1,PSAIEN2,PSAIEN3,PSAIN
"RTN","PSAPROC7",37,0)
 K PSALINE,PSALOCDR,PSAMV,PSANDC,PSAORD,PSAREA,PSARECD,PSASNODE,PSASUP,PSAUNIT,PSAUPC,PSAVSN,X,Y,ZTDESC,ZTDTH,ZTRTN
"RTN","PSAPROC7",38,0)
 Q
"RTN","PSAPROC7",39,0)
 ;
"RTN","PSAPROC7",40,0)
LINE ;Files line items.
"RTN","PSAPROC7",41,0)
 S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE) S:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,0)) DIC("P")=$P(^DD(58.8112,5,0),"^",2)
"RTN","PSAPROC7",42,0)
 S DA(2)=PSAIEN,DA(1)=PSAIEN1,(DA,X)=PSALINE,DIC="^PSD(58.811,"_DA(2)_",1,"_DA(1)_",1,",DIC(0)="L",DLAYGO=58.811 D ^DIC S PSAIEN2=+Y K DA,DIC,DLAYGO
"RTN","PSAPROC7",43,0)
 S PSAUNIT=$S(+$P($P(PSADATA,"^",2),"~",2):+$P($P(PSADATA,"^",2),"~",2),+$P($G(^PSDRUG(PSAIEN,1,PSAIEN1,0)),"^",5):+$P($G(^PSDRUG(PSAIEN,1,PSAIEN1,0)),"^",5),1:0)
"RTN","PSAPROC7",44,0)
 S PSACS=$S($P(PSADATA,"^",19)="CS":1,1:0),PSANDC=$P($P(PSADATA,"^",4),"~"),PSAVSN=$P($P(PSADATA,"^",5),"~"),PSAUPC=$P($P(PSADATA,"^",26),"~")
"RTN","PSAPROC7",45,0)
 I PSANDC="",$P($P(PSADATA,"^",26),"~")'="" S PSANDC="S"_$P($P(PSADATA,"^",26),"~")
"RTN","PSAPROC7",46,0)
 S DA(2)=PSAIEN,DA(1)=PSAIEN1,DA=PSAIEN2,DIE="^PSD(58.811,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","PSAPROC7",47,0)
 S DR="2///^S X="_+PSADATA_$S(PSANDC'="":";13///^S X=PSANDC",1:"")_$S(PSAVSN'="":";14///^S X=PSAVSN",1:"")_$S(PSAUPC'="":";15///^S X=PSAUPC",1:"") D ^DIE
"RTN","PSAPROC7",48,0)
 S DR="12///^S X="_PSACS_$S(+$P(PSADATA,"^",6):";1///^S X="_$P(PSADATA,"^",6),1:"")_$S(+PSAUNIT:";3///^S X="_+PSAUNIT,1:"")_";4///^S X="_+$P(PSADATA,"^",3)_";5////^S X="_DT_";6///^S X="_PSADUZ
"RTN","PSAPROC7",49,0)
 D ^DIE K DIE
"RTN","PSAPROC7",50,0)
 I +$P(PSADATA,"^",15)!($D(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP"))) D ADJDRUG
"RTN","PSAPROC7",51,0)
 I $P(PSADATA,"^",8)'="" D QTY
"RTN","PSAPROC7",52,0)
 I +$P(PSADATA,"^",12) D OU
"RTN","PSAPROC7",53,0)
 I +$P(PSADATA,"^",23) D PRICE
"RTN","PSAPROC7",54,0)
 ;Adds the reorder level and/or dispense units per order unit
"RTN","PSAPROC7",55,0)
 I +$P(PSADATA,"^",7)!(+$P(PSADATA,"^",20))!(+$P(PSADATA,"^",21))!(+$P(PSADATA,"^",27)) D
"RTN","PSAPROC7",56,0)
 .S ^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2,2)=$P(PSADATA,"^",20)_"^"_$P(PSADATA,"^",21)_"^"_$S(+$P(PSADATA,"^",7):+$P(PSADATA,"^",7),1:0)_"^"_+$P(PSADATA,"^",27)
"RTN","PSAPROC7",57,0)
 K ^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC7",58,0)
 Q
"RTN","PSAPROC7",59,0)
ADJDRUG ;Records adjusted drug received
"RTN","PSAPROC7",60,0)
 S PSAFLD="D"
"RTN","PSAPROC7",61,0)
 I +$P(PSADATA,"^",15) S PSADJ=+$P(PSADATA,"^",15),PSADUZ=+$P(PSADATA,"^",16),PSADT=+$P(PSADATA,"^",17),PSAREA="" D RECORD Q
"RTN","PSAPROC7",62,0)
 I $D(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")) S PSASNODE=^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP"),PSADJ=$P(PSASNODE,"^",3),PSADUZ=+$P(PSASNODE,"^"),PSADT=+$P(PSASNODE,"^",2),PSAREA="" D RECORD
"RTN","PSAPROC7",63,0)
 Q
"RTN","PSAPROC7",64,0)
OU ;Records adjusted order unit
"RTN","PSAPROC7",65,0)
 S PSAFLD="O",PSADJ=+$P(PSADATA,"^",12),PSADUZ=+$P(PSADATA,"^",13),PSADT=+$P(PSADATA,"^",14),PSAREA=""
"RTN","PSAPROC7",66,0)
 D RECORD
"RTN","PSAPROC7",67,0)
 Q
"RTN","PSAPROC7",68,0)
PRICE ;Records adjusted price per order unit
"RTN","PSAPROC7",69,0)
 S PSAFLD="P",PSADJ=+$P(PSADATA,"^",23),PSADUZ=+$P(PSADATA,"^",24),PSADT=+$P(PSADATA,"^",25),PSAREA=""
"RTN","PSAPROC7",70,0)
 S:PSADJ'=+$P(PSADATA,"^",3) PSACRED=1
"RTN","PSAPROC7",71,0)
 D RECORD
"RTN","PSAPROC7",72,0)
 Q
"RTN","PSAPROC7",73,0)
QTY ;Records adjusted quantity received.
"RTN","PSAPROC7",74,0)
 S PSAFLD="Q",PSADJ=+$P(PSADATA,"^",8),PSADUZ=+$P(PSADATA,"^",9),PSADT=+$P(PSADATA,"^",10),PSAREA=$P(PSADATA,"^",11)
"RTN","PSAPROC7",75,0)
 S:PSADJ'=+$P(PSADATA,"^") PSACRED=1
"RTN","PSAPROC7",76,0)
 D RECORD
"RTN","PSAPROC7",77,0)
 Q
"RTN","PSAPROC7",78,0)
RECORD ;Adds adjusted data to DA ORDERS file
"RTN","PSAPROC7",79,0)
 K DA S DA(3)=PSAIEN,DA(2)=PSAIEN1,DA(1)=PSAIEN2,X=PSAFLD
"RTN","PSAPROC7",80,0)
 S:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAIEN2,1,0)) DIC("P")=$P(^DD(58.81125,9,0),"^",2)
"RTN","PSAPROC7",81,0)
 S DIC="^PSD(58.811,"_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1,",DIC(0)="L",DLAYGO=58.811 D ^DIC S PSAIEN3=+Y K DLAYGO
"RTN","PSAPROC7",82,0)
 S DIE=DIC,DA=PSAIEN3,DR="1///"_PSADJ_$S(PSAREA'="":";2////^S X=PSAREA",1:"")_";3///^S X="_PSADT_";4///^S X="_PSADUZ K DIC D ^DIE
"RTN","PSAPROC7",83,0)
 S DIK=DIE,DA=PSAIEN3 D IX1^DIK K DA,DIE,DIK,PSAFLD
"RTN","PSAPROC7",84,0)
 Q
"RTN","PSAPROC8")
0^62^B42291814
"RTN","PSAPROC8",1,0)
PSAPROC8 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSAPROC8",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPROC8",3,0)
 ;This routine processes uploaded invoices.
"RTN","PSAPROC8",4,0)
 ;
"RTN","PSAPROC8",5,0)
DU ;Prompts Dispense Unit if blank
"RTN","PSAPROC8",6,0)
 F  L +^PSDRUG(PSAIEN,0):0 I  Q
"RTN","PSAPROC8",7,0)
 S DIE="^PSDRUG(",DA=PSAIEN,DR=14.5 D ^DIE K DIE L -^PSDRUG(PSAIEN,0)
"RTN","PSAPROC8",8,0)
 I +$P($G(^PSDRUG(PSAIEN,660)),"^",8) D  G DU
"RTN","PSAPROC8",9,0)
 .F  L +^PSDRUG(PSAIEN,0):0 I  Q
"RTN","PSAPROC8",10,0)
 .S DIE="^PSDRUG(",DA=PSAIEN,DR="14.5///@" D ^DIE K DIE L -^PSDRUG(PSAIEN,0)
"RTN","PSAPROC8",11,0)
 I $P($G(^PSDRUG(PSAIEN,660)),"^",8)'="" S PSADU=1 Q
"RTN","PSAPROC8",12,0)
 ;
"RTN","PSAPROC8",13,0)
 W !,"The dispense units must be entered to change",!,"the status of the invoice to Processed."
"RTN","PSAPROC8",14,0)
 S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to enter the dispense units now",DIR("?",1)="Enter Yes to return to the DISPENSE UNIT prompt.",DIR("?")="Enter No to bypass entering the dispense units now."
"RTN","PSAPROC8",15,0)
 S DIR("??")="^D DISPYN^PSAPROC8" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC8",16,0)
 G:+Y DU
"RTN","PSAPROC8",17,0)
 Q
"RTN","PSAPROC8",18,0)
 ;
"RTN","PSAPROC8",19,0)
DUOU ;Gets Dispense Units per Order Unit
"RTN","PSAPROC8",20,0)
 W:'$G(PSADU) !,"DISPENSE UNITS: "_$P($G(^PSDRUG(PSAIEN,660)),"^",8)
"RTN","PSAPROC8",21,0)
 S PSADU=1
"RTN","PSAPROC8",22,0)
 F  L +^PSDRUG(PSAIEN,0):0 I  Q
"RTN","PSAPROC8",23,0)
 S DIE="^PSDRUG("_PSAIEN_",1,",DA(1)=PSAIEN,DA=+PSASUB,DR=403 D ^DIE K DIE L -^PSDRUG(PSAIEN,0)
"RTN","PSAPROC8",24,0)
 I $D(Y)!($G(DTOUT)) S PSAOUT=1 Q
"RTN","PSAPROC8",25,0)
 Q:+$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",7)
"RTN","PSAPROC8",26,0)
 ;
"RTN","PSAPROC8",27,0)
 S DIR(0)="Y",DIR("B")="Y",DIR("A",1)="The dispense units per order unit must be entered to change the ",DIR("A")="status of the invoice to Processed. Do you want to enter the data now"
"RTN","PSAPROC8",28,0)
 S DIR("?",1)="Enter Yes to return to the "_$P($G(^PSDRUG(PSAIEN,660)),"^",8)_"s per "_$P($G(^DIC(51.5,+$P($P(PSADATA,"^",2),"~",2),0)),"^",2)_" prompt."
"RTN","PSAPROC8",29,0)
 S DIR("?")="Enter No to bypass entering the dispense units now.",DIR("??")="^D DUOUYN^PSAPROC8"
"RTN","PSAPROC8",30,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC8",31,0)
 G:+Y DUOU
"RTN","PSAPROC8",32,0)
 Q
"RTN","PSAPROC8",33,0)
OK ;
"RTN","PSAPROC8",34,0)
 S PSACNTOK=PSACNTOK+1,PSAOK(PSACNTOK)=$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",4)_"^"_$P(^("IN"),"^",2)_"^"_PSACTRL_"^"_$P(^("IN"),"^",7)
"RTN","PSAPROC8",35,0)
 Q
"RTN","PSAPROC8",36,0)
PRICE ;Price per Order Unit changed
"RTN","PSAPROC8",37,0)
 S PSAIPR=$L($FN($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",3),",",2)),PSAFPR=$L($FN($P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",6),",",2))
"RTN","PSAPROC8",38,0)
 S PSAJUST=$S(PSAIPR>PSAFPR:PSAIPR,1:PSAFPR)
"RTN","PSAPROC8",39,0)
 W !!,"Price per Order Unit -- Invoice's: $"_$J($FN($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",3),",",2),PSAJUST,2),!?24,"File's   : $"_$J($FN($P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",6),",",2),PSAJUST,2),!
"RTN","PSAPROC8",40,0)
 S DIR(0)="Y",DIR("A")="Is the invoice's price per order unit correct",DIR("B")="Y",DIR("?",1)="Enter Yes if "_$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",3)_" is correct."
"RTN","PSAPROC8",41,0)
 S DIR("?")="Enter No to keep the file's price per order unit.",DIR("??")="^D PRICEOU^PSAPROC1" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC8",42,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",22)=+Y
"RTN","PSAPROC8",43,0)
 I '+Y S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",23)=+$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",6),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",24)=DUZ,$P(^(PSALINE),"^",25)=DT
"RTN","PSAPROC8",44,0)
 Q
"RTN","PSAPROC8",45,0)
 ;
"RTN","PSAPROC8",46,0)
REORDER ;Enter reorder level for drug if the field is blank.
"RTN","PSAPROC8",47,0)
 W:'$G(PSADU) !,"DISPENSE UNITS: "_$P($G(^PSDRUG(+PSAIEN,660)),"^",8)
"RTN","PSAPROC8",48,0)
 S PSADU=1,DIR(0)="NO^0:99999",DIR("A")="REORDER LEVEL IN "_$P($G(^PSD(58.8,PSALOC,0)),"^")
"RTN","PSAPROC8",49,0)
 S DIR("?")="Enter the minimum number of dispense units to keep in the "_$S($P(PSADATA,"^",19)="CS":"master vault.",1:"pharmacy location."),DIR("??")="^D REORD^PSAPROC8"
"RTN","PSAPROC8",50,0)
 S DIR("B")=$S(+$P(PSADATA,"^",21):+$P(PSADATA,"^",21),+$P($G(^PSD(58.8,PSALOC,1,PSAIEN,0)),"^",3):$P(^PSD(58.8,PSALOC,1,PSAIEN,0),"^",3),1:"")
"RTN","PSAPROC8",51,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC8",52,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",21)=+Y
"RTN","PSAPROC8",53,0)
 Q
"RTN","PSAPROC8",54,0)
 ;
"RTN","PSAPROC8",55,0)
STOCK ;Enter stock level for drug if the field is blank.
"RTN","PSAPROC8",56,0)
 W:'$G(PSADU) !,"DISPENSE UNITS: "_$P($G(^PSDRUG(+PSAIEN,660)),"^",8)
"RTN","PSAPROC8",57,0)
 S PSADU=1,DIR(0)="NO^0:99999",DIR("A")="STOCK LEVEL IN "_$P($G(^PSD(58.8,+PSALOC,0)),"^")
"RTN","PSAPROC8",58,0)
 S DIR("?")="Enter the minimum number of dispense units to keep on the shelf",DIR("??")="^D STKLEVEL^PSAPROC8"
"RTN","PSAPROC8",59,0)
 S DIR("B")=$S(+$P(PSADATA,"^",27):+$P(PSADATA,"^",27),+$P($G(^PSD(58.8,PSALOC,1,PSAIEN,0)),"^",3):$P(^PSD(58.8,PSALOC,1,PSAIEN,0),"^",5),1:"")
"RTN","PSAPROC8",60,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAPROC8",61,0)
 Q:$G(DIRUT)
"RTN","PSAPROC8",62,0)
 S:+Y $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",27)=+Y
"RTN","PSAPROC8",63,0)
 Q
"RTN","PSAPROC8",64,0)
 ;
"RTN","PSAPROC8",65,0)
DISPYN ;Extended help to enter dispense units
"RTN","PSAPROC8",66,0)
 W !?5,"Enter Yes if you want to enter the dispense units now.",!!?5,"Enter No to bypass entering the dispense units. The invoice will not",!?5,"be placed in a Processed status if the dispense units are not entered."
"RTN","PSAPROC8",67,0)
 Q
"RTN","PSAPROC8",68,0)
DUOUYN ;Extended help to enter dispense units per order units
"RTN","PSAPROC8",69,0)
 W !?5,"Enter Yes if you want to enter the dispense units per order unit now.",!!?5,"Enter No to bypass entering the dispense units per order unit. The"
"RTN","PSAPROC8",70,0)
 W !?5,"invoice will not be placed in a "_$S($D(PSABEFOR):"Verified",1:"Processed")_" status if the dispense units",!?5,"are not entered."
"RTN","PSAPROC8",71,0)
 Q
"RTN","PSAPROC8",72,0)
PRICEOU ;Extended help to 'Is invoice's price per order unit correct'
"RTN","PSAPROC8",73,0)
 W !?5,"Enter Yes if the invoice's price per order unit is correct. The",!?5,"invoice's price per order unit will be entered into the DRUG file."
"RTN","PSAPROC8",74,0)
 W !!?5,"Enter No if the invoice's price per order unit is not correct.",!?5,"The DRUG file's price per order unit will remain the same."
"RTN","PSAPROC8",75,0)
 Q
"RTN","PSAPROC8",76,0)
REORD ;Extended help for 'Reorder level'
"RTN","PSAPROC8",77,0)
 W !?5,"Enter the lowest amount of "_$P($G(^PSDRUG(PSAIEN,660)),"^",8)_"s to keep in the "_$S($P(PSADATA,"^",19)="CS":"master vault",1:"pharmacy location")_"."
"RTN","PSAPROC8",78,0)
 W !!?5,"When the amount on hand is lower than the reorder level, a mail",!?5,"message will be sent showing the drug name, reorder level, and",!?5,"quantity on hand."
"RTN","PSAPROC8",79,0)
 Q
"RTN","PSAPROC8",80,0)
STKLEVEL ;Extended help for 'Stock level'
"RTN","PSAPROC8",81,0)
 W !?5,"Enter the ideal number of dispense units to keep on the shelf. When the",!?5,"number of dispense units is equal to or less than the reorder level, the"
"RTN","PSAPROC8",82,0)
 W !?5,"amount to order is determined by subtracting the current number of dispense",!?5,"units from the stock level."
"RTN","PSAPROC8",83,0)
 Q
"RTN","PSAPROC9")
0^63^B63695164
"RTN","PSAPROC9",1,0)
PSAPROC9 ;BIR/JMB-Process Uploaded Prime Vendor Invoice Data - CONT'D ;8/19/97
"RTN","PSAPROC9",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPROC9",3,0)
 ;This routine processes the line item when the user selects automatic
"RTN","PSAPROC9",4,0)
 ;processing.
"RTN","PSAPROC9",5,0)
 ;
"RTN","PSAPROC9",6,0)
 S (PSACONT,PSADU,PSANEXT)=0
"RTN","PSAPROC9",7,0)
 I '+$P(PSADATA,"^",6),PSANDC="" D  Q:PSAOUT  G:PSANEXT NEXT
"RTN","PSAPROC9",8,0)
 .I +$P($P(PSADATA,"^",5),"~",2) D MANYVSNS^PSAPROC4 D:PSAOUT CONT Q
"RTN","PSAPROC9",9,0)
 .I PSAVSN="" D  Q:PSAOUT  G:PSANEXT NEXT
"RTN","PSAPROC9",10,0)
 ..I +$P($P(PSADATA,"^",26),"~",2) D ^PSAPROC5 D:PSAOUT CONT Q
"RTN","PSAPROC9",11,0)
 ..I +$P($P(PSADATA,"^",26),"~",3) D SUPDIFF^PSAPROC5 D:PSAOUT CONT
"RTN","PSAPROC9",12,0)
 I '+$P(PSADATA,"^",6),'+$P(PSADATA,"^",15),PSANDC'="" D ^PSANDF D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",13,0)
 I PSANDC'="" D  Q:PSAOUT  G:PSANEXT NEXT
"RTN","PSAPROC9",14,0)
 .I +$P($P(PSADATA,"^",4),"~",2) D MANYNDCS^PSAPROC4 D:PSAOUT CONT Q
"RTN","PSAPROC9",15,0)
 .I $P($P(PSADATA,"^",4),"~",3)'="" D VSNDIFF^PSAPROC5 D:PSAOUT CONT
"RTN","PSAPROC9",16,0)
 I +$P($P(PSADATA,"^",5),"~",2) D MANYVSNS^PSAPROC4 D:PSAOUT CONT Q:PSAOUT  G:PSANEXT NEXT
"RTN","PSAPROC9",17,0)
 I +$P($P(PSADATA,"^",5),"~",3) D NDCDIFF^PSAPROC5 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",18,0)
NEXT Q:PSACONT
"RTN","PSAPROC9",19,0)
 S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC9",20,0)
 I '+$P(PSADATA,"^",6),'+$P(PSADATA,"^",15),'$D(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")) D:'$G(PSAPASS) ASKDRUG^PSANDF D:PSAOUT CONT Q:PSAOUT  S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC9",21,0)
 Q:$G(PSAPASS)
"RTN","PSAPROC9",22,0)
 I $G(PSASUPP) S PSALINES=PSALINES+1 Q
"RTN","PSAPROC9",23,0)
 S PSAIEN=$S(+$P(PSADATA,"^",15):+$P(PSADATA,"^",15),1:+$P(PSADATA,"^",6))
"RTN","PSAPROC9",24,0)
 I PSAIEN S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",19)=$S($P($G(^PSDRUG(PSAIEN,2)),"^",3)["N":"CS",1:"")
"RTN","PSAPROC9",25,0)
 I PSAIEN,PSANDC'="" S PSASUB=0 F  S PSASUB=$O(^PSDRUG("C",PSANDC,PSAIEN,PSASUB)) Q:'PSASUB  I $P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^")=PSANDC Q
"RTN","PSAPROC9",26,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",7)=$S(+$G(PSASUB):PSASUB,1:"0~1")
"RTN","PSAPROC9",27,0)
QTY I '+PSADATA,$P(PSADATA,"^",8)="" D QTY^PSAPROC3 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",28,0)
OU I '+$P($P(PSADATA,"^",2),"~",2),'+$P(PSADATA,"^",12) D  D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",29,0)
 .I PSAIEN,PSASUB,'$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",5) D GETOU^PSAPROC3 Q
"RTN","PSAPROC9",30,0)
 .I PSAIEN,'PSASUB D GETOU^PSAPROC3
"RTN","PSAPROC9",31,0)
DU I PSAIEN,$P($G(^PSDRUG(PSAIEN,660)),"^",8)="" D DU^PSAPROC8 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",32,0)
DUOU ;If drug has synonym & no conv factor set conv factor in 50.
"RTN","PSAPROC9",33,0)
 I PSAIEN,PSASUB,$D(^PSDRUG(PSAIEN,1,PSASUB,0)),'+$P(^PSDRUG(PSAIEN,1,PSASUB,0),"^",7),'+$P(PSADATA,"^",20) D DUOU^PSAPROC8 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",34,0)
 ;If drug doesn't have synonym & disp units/order unit, store disp units/order unit in XTMP.
"RTN","PSAPROC9",35,0)
 I PSAIEN,'PSASUB,'+$P(PSADATA,"^",20) D DUOU^PSAPROC3 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",36,0)
PRICE I '+$P(PSADATA,"^",3) D PRICE^PSAPROC3 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",37,0)
NOTCS ;If drug is not a CS & no stock level/reorder level, store in XTMP.
"RTN","PSAPROC9",38,0)
 S PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE)
"RTN","PSAPROC9",39,0)
 I $P(PSADATA,"^",19)'="CS" D  Q:PSAOUT
"RTN","PSAPROC9",40,0)
 .I '+$P(PSAIN,"^",7) D GETLOC D EDITDISP^PSAUTL1,END^PSAPROC D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",41,0)
 .I $P(PSADATA,"^",19)'="CS",+$P(PSAIN,"^",7),+$P($G(^PSD(58.8,+$P(PSAIN,"^",7),0)),"^",14) D  Q:PSAOUT
"RTN","PSAPROC9",42,0)
 ..I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSAIEN,0)),"^",3),'+$P(PSADATA,"^",27) S PSALOC=$P(PSAIN,"^",7) D STOCK^PSAPROC8 D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",43,0)
 ..I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSAIEN,0)),"^",5),'+$P(PSADATA,"^",21) S PSALOC=$P(PSAIN,"^",7) D REORDER^PSAPROC8 D:PSAOUT CONT
"RTN","PSAPROC9",44,0)
CS ;If drug is a CS & no stock level/reorder level, store in XTMP.
"RTN","PSAPROC9",45,0)
 I $P(PSADATA,"^",19)="CS" D  Q:PSAOUT
"RTN","PSAPROC9",46,0)
 .S PSACS=PSACS+1
"RTN","PSAPROC9",47,0)
 .I '+$P(PSAIN,"^",12) D MASTER D EDITDISP^PSAUTL1,END^PSAPROC D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",48,0)
 .I +$P(PSAIN,"^",12),+$P($G(^PSD(58.8,+$P(PSAIN,"^",12),0)),"^",14) D  Q:PSAOUT
"RTN","PSAPROC9",49,0)
 ..I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSAIEN,0)),"^",3),'+$P(PSADATA,"^",27) S PSALOC=$P(PSAIN,"^",12) D STOCK^PSAPROC8 S PSALOC=+$P(PSAIN,"^",7),PSAMV=+$P(PSAIN,"^",12) D:PSAOUT CONT Q:PSAOUT
"RTN","PSAPROC9",50,0)
 ..I '+$P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSAIEN,0)),"^",5),'+$P(PSADATA,"^",21) S PSALOC=$P(PSAIN,"^",12) D REORDER^PSAPROC8 S PSALOC=+$P(PSAIN,"^",7),PSAMV=+$P(PSAIN,"^",12) D:PSAOUT CONT
"RTN","PSAPROC9",51,0)
 D CHECK^PSANDF D:PSAOUT CONT Q:PSAOUT  D SETLINE^PSAPROC3 W !
"RTN","PSAPROC9",52,0)
 Q
"RTN","PSAPROC9",53,0)
 ;
"RTN","PSAPROC9",54,0)
CONT ;Asks if user wants to continue processing invoice.
"RTN","PSAPROC9",55,0)
 S PSAINV=$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",2)
"RTN","PSAPROC9",56,0)
 W ! S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to continue processing invoice# "_PSAINV,DIR("?")="Enter YES to process the next line item.",DIR("?")="Enter NO to stop processing the invoice.",DIR("??")="^D CONTYN^PSAPROC9"
"RTN","PSAPROC9",57,0)
 D ^DIR K DIR S PSACONT=Y Q:$G(DIRUT)!('Y)
"RTN","PSAPROC9",58,0)
 S PSAOUT=0
"RTN","PSAPROC9",59,0)
 Q
"RTN","PSAPROC9",60,0)
MASTER ;Assigns invoice to Master Vault
"RTN","PSAPROC9",61,0)
 S PSAINV=$P($G(^XTMP("PSAPV",PSACTRL,"IN")),"^",2)
"RTN","PSAPROC9",62,0)
 S (PSAMVN,PSAMV)=0 F  S PSAMV=+$O(^PSD(58.8,"ADISP","M",PSAMV)) Q:'PSAMV  D
"RTN","PSAPROC9",63,0)
 .Q:'$D(^PSD(58.8,PSAMV,0))!($P($G(^PSD(58.8,PSAMV,0)),"^")="")
"RTN","PSAPROC9",64,0)
 .I +$G(^PSD(58.8,PSAMV,"I")),+^PSD(58.8,PSAMV,"I")'>DT Q
"RTN","PSAPROC9",65,0)
 .S PSAMVN=PSAMVN+1,PSAONEMV=PSAMV,PSAMV($P(^PSD(58.8,PSAMV,0),"^"),PSAMV)=""
"RTN","PSAPROC9",66,0)
 I 'PSAMVN W !!,"No master vaults are set up. You must set up a master vault then",!,"select the Process Uploaded Prime Vendor Invoices Data option." S PSAOUT=1 Q
"RTN","PSAPROC9",67,0)
 I PSAMVN=1 D  Q
"RTN","PSAPROC9",68,0)
 .S PSAMV=PSAONEMV
"RTN","PSAPROC9",69,0)
 .W @IOF,!?22,"<<< ASSIGN A MASTER VAULT SCREEN >>>"
"RTN","PSAPROC9",70,0)
 .W !!,"Controlled substances on the invoice has been",!,"automatically assigned to the Master Vault."
"RTN","PSAPROC9",71,0)
 .W !!,$P(^PSD(58.8,PSAMV,0),"^"),!,PSASLN
"RTN","PSAPROC9",72,0)
 .W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN)
"RTN","PSAPROC9",73,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)=PSAMV,PSAIN=^("IN")
"RTN","PSAPROC9",74,0)
 .D END^PSAPROC
"RTN","PSAPROC9",75,0)
 I PSAMVN>1 D DISPMV W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN) D SELMV
"RTN","PSAPROC9",76,0)
 Q
"RTN","PSAPROC9",77,0)
 ;
"RTN","PSAPROC9",78,0)
DISPMV ;Displays active master vaults
"RTN","PSAPROC9",79,0)
 W @IOF,!?22,"<<< ASSIGN A MASTER VAULT SCREEN >>>",!,PSASLN
"RTN","PSAPROC9",80,0)
 S PSA=0,PSAMVA="" F  S PSAMVA=$O(PSAMV(PSAMVA)) Q:PSAMVA=""  D
"RTN","PSAPROC9",81,0)
 .S PSAMVIEN=0 F  S PSAMVIEN=$O(PSAMV(PSAMVA,PSAMVIEN)) Q:'PSAMVIEN  D
"RTN","PSAPROC9",82,0)
 ..S PSA=PSA+1,PSAVAULT(PSA,PSAMVA,PSAMVIEN)=""
"RTN","PSAPROC9",83,0)
 ..W !,$J(PSA,2)_".",?4,PSAMVA
"RTN","PSAPROC9",84,0)
 W !
"RTN","PSAPROC9",85,0)
 Q
"RTN","PSAPROC9",86,0)
 ;
"RTN","PSAPROC9",87,0)
SELMV ;Select displayed master vaults
"RTN","PSAPROC9",88,0)
 W ! S DIR(0)="NO^1:"_PSA,DIR("A")="Select Master Vault",DIR("?")="Select the Master Vault that received the invoice's drugs"
"RTN","PSAPROC9",89,0)
 S DIR("??")="^D MV^PSAPROC" D ^DIR K DIR Q:Y=""  I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC9",90,0)
 S PSASEL1=Y
"RTN","PSAPROC9",91,0)
 S PSAMVA=$O(PSAVAULT(PSASEL1,"")) Q:PSAMVA=""  S PSAMVIEN=+$O(PSAVAULT(PSASEL1,PSAMVA,0)) Q:'PSAMVIEN  S PSAMV=PSAMVIEN,$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",12)=PSAMV,PSAIN=^("IN")
"RTN","PSAPROC9",92,0)
 Q
"RTN","PSAPROC9",93,0)
 ;
"RTN","PSAPROC9",94,0)
GETLOC ;Gets pharmacy locations
"RTN","PSAPROC9",95,0)
 S PSAINV=$P($G(^XTMP("PSAPV",PSACTRL,"IN")),"^",2)
"RTN","PSAPROC9",96,0)
 S (PSALOC,PSANUM)=0 F  S PSALOC=+$O(^PSD(58.8,"ADISP","P",PSALOC)) Q:'PSALOC  D
"RTN","PSAPROC9",97,0)
 .Q:'$D(^PSD(58.8,PSALOC,0))!($P($G(^PSD(58.8,PSALOC,0)),"^")="")
"RTN","PSAPROC9",98,0)
 .I +$G(^PSD(58.8,PSALOC,"I")),+^PSD(58.8,PSALOC,"I")'>DT Q
"RTN","PSAPROC9",99,0)
 .S PSANUM=PSANUM+1,PSAONE=PSALOC,PSAISIT=+$P(^PSD(58.8,PSALOC,0),"^",3),PSAOSIT=+$P(^(0),"^",10)
"RTN","PSAPROC9",100,0)
 .D SITES^PSAUTL1 S PSALOCA($P(^PSD(58.8,PSALOC,0),"^")_PSACOMB,PSALOC)=PSAISIT_"^"_PSAOSIT
"RTN","PSAPROC9",101,0)
 G:'PSANUM NONE G:PSANUM=1 ONE G:PSANUM>1 MANY
"RTN","PSAPROC9",102,0)
 ;
"RTN","PSAPROC9",103,0)
NONE ;No DA pharmacy locations
"RTN","PSAPROC9",104,0)
 W !!,"There are no Drug Accountability pharmacy locations.",!!,"Use the Set Up/Edit a Pharmacy Location option on Pharmacy Location menu"
"RTN","PSAPROC9",105,0)
 W !,"to setup one or more pharmacy locations. Then select the Process Uploaded",!,"Prime Vendor Invoice Data option to process the invoices."
"RTN","PSAPROC9",106,0)
 Q
"RTN","PSAPROC9",107,0)
 ;
"RTN","PSAPROC9",108,0)
ONE ;Only one location
"RTN","PSAPROC9",109,0)
 S PSACNT=0,PSALOC=PSAONE,PSALOCN=$O(PSALOCA(""))
"RTN","PSAPROC9",110,0)
 W @IOF,!?19,"<<< ASSIGN A PHARMACY LOCATION SCREEN >>>"
"RTN","PSAPROC9",111,0)
 W !!,"The non-controlled substance items on the invoice have",!,"been automatically assigned to the Pharmacy Location.",!
"RTN","PSAPROC9",112,0)
 W:$L(PSALOCN)>76 !,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 PSALOCN W !,PSASLN
"RTN","PSAPROC9",113,0)
 W !!,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN)
"RTN","PSAPROC9",114,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",7)=PSALOC,PSAIN=^("IN")
"RTN","PSAPROC9",115,0)
 Q
"RTN","PSAPROC9",116,0)
 ;
"RTN","PSAPROC9",117,0)
MANY ;If more than one pharmacy location, display invoices.
"RTN","PSAPROC9",118,0)
 D DISPLOC W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN) D SELLOC
"RTN","PSAPROC9",119,0)
 Q
"RTN","PSAPROC9",120,0)
 ;
"RTN","PSAPROC9",121,0)
DISPLOC ;Displays the active pharmacy locations.
"RTN","PSAPROC9",122,0)
 W @IOF,!?19,"<<< ASSIGN A PHARMACY LOCATION SCREEN >>>",!,PSASLN,!
"RTN","PSAPROC9",123,0)
 S PSACNT=0,PSALOCN="" F  S PSALOCN=$O(PSALOCA(PSALOCN)) Q:PSALOCN=""  D
"RTN","PSAPROC9",124,0)
 .S PSALOC=0 F  S PSALOC=$O(PSALOCA(PSALOCN,PSALOC)) Q:'PSALOC  D
"RTN","PSAPROC9",125,0)
 ..S PSACNT=PSACNT+1,PSAMENU(PSACNT,PSALOCN,PSALOC)=PSALOC
"RTN","PSAPROC9",126,0)
 ..W !,$J(PSACNT,2)_"." W:$L(PSALOCN)>72 ?4,$P(PSALOCN,"(IP)",1)_"(IP)",!?21,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<73 ?4,PSALOCN
"RTN","PSAPROC9",127,0)
 W !
"RTN","PSAPROC9",128,0)
 Q
"RTN","PSAPROC9",129,0)
 ;
"RTN","PSAPROC9",130,0)
SELLOC ;Select the Pharmacy Location to be assigned to the order.
"RTN","PSAPROC9",131,0)
 W ! K DIR S DIR(0)="NO^1:"_PSACNT,DIR("A")="Pharmacy Location",DIR("?")="Select the pharmacy location that received the invoice's drugs"
"RTN","PSAPROC9",132,0)
 S DIR("??")="^D LOCHELP^PSAVER5" D ^DIR K DIR Q:Y=""  I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAPROC9",133,0)
 S PSASEL1=Y
"RTN","PSAPROC9",134,0)
 S PSALOCN=$O(PSAMENU(PSASEL1,"")) Q:PSALOCN=""  S PSALOC=$O(PSAMENU(PSASEL1,PSALOCN,0)) Q:'PSALOC  S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",7)=PSALOC,PSAIN=^("IN")
"RTN","PSAPROC9",135,0)
 Q
"RTN","PSAPROC9",136,0)
 ;
"RTN","PSAPROC9",137,0)
CONTYN ;Extended help for 'Do you want to continue processing invoice# 99'
"RTN","PSAPROC9",138,0)
 W !?5,"Enter YES to continue processing the current invoice and line item.",!?5,"Enter NO to discontinue processing the current invoice and exit the option."
"RTN","PSAPROC9",139,0)
 Q
"RTN","PSAPSI")
0^64^B24028473
"RTN","PSAPSI",1,0)
PSAPSI ;BIR/LTL-IV Dispensing (Single Drug) ;7/23/97
"RTN","PSAPSI",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPSI",3,0)
 ;This routine gathers IV dispensing data for a single drug.
"RTN","PSAPSI",4,0)
 ;
"RTN","PSAPSI",5,0)
 N DIC,DIE,DINUM,D0,D1,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,PSAPG,PSAW,PSAIV,PSAOUT,PSADT,DA,PSADRUG,PSADRUGN,PSALN,PSAQ,PSAR,X,Y
"RTN","PSAPSI",6,0)
LOOK D ^PSADA I '$G(PSALOC) S PSAOUT=1 G QUIT
"RTN","PSAPSI",7,0)
 I '$O(^PSD(58.8,+PSALOC,1,0)) W !!,"There are no drugs in ",PSALOCN,!! G QUIT
"RTN","PSAPSI",8,0)
 D NOW^%DTC S PSADT=X,X="T-60" D ^%DT S PSADT(1)=Y
"RTN","PSAPSI",9,0)
 F  W ! S DIC="^PSD(58.8,+PSALOC,1,",DA(1)=PSALOC,DIC(0)="AEQ",DIC("A")="Please select "_PSALOCN_" drug: " D ^DIC G:Y<0 QUIT S PSADRUG=+Y,(PSAIV,PSADT(2))=0 D  G:$G(PSAOUT) QUIT D DEV
"RTN","PSAPSI",10,0)
 .I '$O(^PS(52.6,"AC",+PSADRUG,0))&('$O(^PS(52.7,"AC",+PSADRUG,0))) W !!,"This drug is not linked to an entry in the IV ADDITIVE or SOLUTION file.",!! S PSAOUT=1 Q
"RTN","PSAPSI",11,0)
 .S PSADRUG(1)=$O(^PS(52.6,"AC",+PSADRUG,0))
"RTN","PSAPSI",12,0)
 .S PSADRUG(2)=$O(^PS(52.7,"AC",+PSADRUG,0))
"RTN","PSAPSI",13,0)
 .D:'$P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,6)),U,3)  Q:$G(PSAOUT)
"RTN","PSAPSI",14,0)
 ..W !!,"IV dispensing data has never been collected for this drug.",!!
"RTN","PSAPSI",15,0)
 ..S DIR(0)="D^"_PSADT(1)_":"_PSADT_":AEX",DIR("A")="How far back would you like to collect",DIR("B")="T-60"  D ^DIR K DIR S (PSADT(2),PSAR)=Y,(PSADT(3),PSAR(1))=0 I Y<1 S PSAOUT=1 Q
"RTN","PSAPSI",16,0)
 .I '$G(PSADT(2)) S PSADT(2)=$P($P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,6)),U,3),","),PSADT(3)=0,PSA(7)=1
"RTN","PSAPSI",17,0)
 .S PSAW=PSADT(3)
"RTN","PSAPSI",18,0)
 .F  S PSAIV=$O(^PS(50.8,PSAIV)) Q:'PSAIV  F PSADT(4)=PSADT(2):0 S PSADT(4)=$O(^PS(50.8,+PSAIV,2,PSADT(4))) Q:'PSADT(4)  D  D:$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.7,+PSADRUG(2),0)) ^PSAPSI5
"RTN","PSAPSI",19,0)
 ..Q:'$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.6,+PSADRUG(1),0))
"RTN","PSAPSI",20,0)
 ..S PSADRUG(3)=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.6,+PSADRUG(1),0))
"RTN","PSAPSI",21,0)
 ..F  S PSAW=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW)) Q:'PSAW  S PSAW(1)=PSAW D:$O(^PSD(58.8,"AB",PSAW,0))=PSALOC
"RTN","PSAPSI",22,0)
 ...S PSAQ=$G(PSAQ)+$P($G(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW,0)),U,2)-$P($G(^(0)),U,5)
"RTN","PSAPSI",23,0)
 ..S:$G(PSAQ) ^TMP("PSA",$J,+PSADRUG,PSADT(4))=$G(^TMP("PSA",$J,+PSADRUG,PSADT(4)))+PSAQ S (PSAQ,PSAW)=0
"RTN","PSAPSI",24,0)
DEV I '$D(^TMP("PSA",$J,+PSADRUG)) W !!,"Sorry, no dispensing for this drug has been compiled since " S Y=$G(PSADT(2)) X ^DD("DD") W $S(Y]"":Y,1:"ever"),".",!! D  G QUIT
"RTN","PSAPSI",25,0)
 .W "The Compile IV Costs in Background option is scheduled to run "
"RTN","PSAPSI",26,0)
 .S Y=$P($G(^DIC(19,+$O(^DIC(19,"B","PSJI BACKGROUND JOB",0)),200)),U)
"RTN","PSAPSI",27,0)
 .X ^DD("DD") W $S(Y:Y,1:"*not scheduled*"),"."
"RTN","PSAPSI",28,0)
 S DIR(0)="Y",DIR("A")="Would you like a report of daily dispensing totals",DIR("B")="Yes" D ^DIR K DIR G:$D(DIRUT) QUIT G:Y'=1 TR
"RTN","PSAPSI",29,0)
 K IO("Q"),DIC N %ZIS,IOP,POP S %ZIS="0Q" I Y=1 W ! D ^%ZIS
"RTN","PSAPSI",30,0)
 I $G(POP) W !,"NO DEVICE SELECTED OR ACTION TAKEN!" S PSAOUT=1 G QUIT
"RTN","PSAPSI",31,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="LUP^PSAPSI",ZTDESC="Daily drug dispensing log",(ZTSAVE("^TMP(""PSA"",$J,+PSADRUG,"),ZTSAVE("PSA*"))="" D ^%ZTLOAD,HOME^%ZIS G QUIT
"RTN","PSAPSI",32,0)
LUP S (PSAPG,PSAOUT)=0,PSADRUG(1)=$P($G(^PSDRUG(+PSADRUG,660)),U,6),PSADRUG(2)=$P($G(^(660)),U,8)
"RTN","PSAPSI",33,0)
 S X=PSADRUG(1),X2="3$" D COMMA^%DTC S PSADRUG(3)=X
"RTN","PSAPSI",34,0)
 D HEADER
"RTN","PSAPSI",35,0)
 S (PSA(4),PSA(6))=0 F  S PSA(4)=$O(^TMP("PSA",$J,+PSADRUG,PSA(4))) Q:'PSA(4)  D:$Y+5>IOSL HEADER G:PSAOUT STOP S PSA(6)=PSA(6)+1,Y=PSA(4) X ^DD("DD") D
"RTN","PSAPSI",36,0)
 .W !!,Y
"RTN","PSAPSI",37,0)
 .S (X,PSADRUG(6))=$G(^TMP("PSA",$J,+PSADRUG,PSA(4))),X2=0
"RTN","PSAPSI",38,0)
 .S:$P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,6)),U,4) X=X/$P($G(^(6)),U,4)
"RTN","PSAPSI",39,0)
 .S PSADRUG(4)=$G(PSADRUG(4))+X
"RTN","PSAPSI",40,0)
 .D COMMA^%DTC W ?14,X,PSADRUG(2),?40,PSADRUG(3),"/",PSADRUG(2),?63
"RTN","PSAPSI",41,0)
 .S X=X*PSADRUG(1),PSADRUG(5)=$G(PSADRUG(5))+X,X2="2$" D COMMA^%DTC W ?40,X
"RTN","PSAPSI",42,0)
 W !,PSALN,!,PSA(6)," DAY TOTALS: " S X=PSADRUG(4),X2=0 D COMMA^%DTC W ?5,X,PSADRUG(2)
"RTN","PSAPSI",43,0)
 S X=PSADRUG(5),X2="2$" D COMMA^%DTC W ?63,X
"RTN","PSAPSI",44,0)
STOP W:$E(IOST)'="C" @IOF
"RTN","PSAPSI",45,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) W ! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR K DIR
"RTN","PSAPSI",46,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAPSI",47,0)
 W:'$G(PSAOUT) !!,"Updating transaction history and dispensing totals."
"RTN","PSAPSI",48,0)
TR I '$G(PSAOUT) S ZTIO="",ZTRTN="^PSAPSI1",ZTDESC="Update dispensing totals",ZTDTH=$H,(ZTSAVE("^TMP(""PSA"",$J,+PSADRUG,"),ZTSAVE("PSA*"))="" D ^%ZTLOAD,HOME^%ZIS
"RTN","PSAPSI",49,0)
QUIT K:$G(PSADRUG) ^TMP("PSA",$J,+PSADRUG),PSADRUG K PSA
"RTN","PSAPSI",50,0)
 Q
"RTN","PSAPSI",51,0)
HEADER I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAPSI",52,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAPSI",53,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !,?2,"DAILY DISPENSING TOTALS FOR ",$E($P($G(^PSDRUG(+PSADRUG,0)),U),1,30),?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAPSI",54,0)
 W "  DATE",?23,"TOTAL",?45,"$/DISP",?67,"TOTAL",!
"RTN","PSAPSI",55,0)
 W "DISPENSED",?23,"DISP",?46,"UNIT",?68,"COST",!,PSALN
"RTN","PSAPSI",56,0)
 Q
"RTN","PSAPSI1")
0^65^B9513101
"RTN","PSAPSI1",1,0)
PSAPSI1 ;BIR/LTL-IV Dispensing (Single Drug) & (All Drugs) ;7/23/97
"RTN","PSAPSI1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPSI1",3,0)
 ;This routine places the IV data into files 58.8 and 58.81. It is called
"RTN","PSAPSI1",4,0)
 ;by PSAPSI, PSAPSI2, AND PSAPSI3.
"RTN","PSAPSI1",5,0)
 ;
"RTN","PSAPSI1",6,0)
 N DIC,PSAD,PSAT
"RTN","PSAPSI1",7,0)
 S (PSA(4),PSA(6))=0 F  S PSA(4)=$O(^TMP("PSA",$J,PSADRUG,PSA(4))) Q:'PSA(4)  S PSA(6)=PSA(6)+1
"RTN","PSAPSI1",8,0)
 ;get transaction numbers
"RTN","PSAPSI1",9,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSAPSI1",10,0)
FIND S PSAD=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSAD)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSAPSI1",11,0)
 S PSAT=PSAD,DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81
"RTN","PSAPSI1",12,0)
 F PSAD=PSAT:1:(PSAT+(PSA(6)-1)) S (DINUM,X)=PSAD D ^DIC
"RTN","PSAPSI1",13,0)
 L -^PSD(58.81,0) K DIC,DINUM,DLAYGO
"RTN","PSAPSI1",14,0)
 ;loop thru array
"RTN","PSAPSI1",15,0)
LUP S PSA(4)=0 F  S PSA(4)=$O(^TMP("PSA",$J,PSADRUG,PSA(4))) Q:'PSA(4)  S PSA=$G(^TMP("PSA",$J,PSADRUG,PSA(4))) S:$P($G(^PSD(58.8,PSALOC,1,PSADRUG,6)),U,4) PSA=PSA/$P($G(^(6)),U,4) D LUP1
"RTN","PSAPSI1",16,0)
 K ^TMP("PSA",$J,PSADRUG)
"RTN","PSAPSI1",17,0)
 Q
"RTN","PSAPSI1",18,0)
LUP1 ;get date + current balance + update balance
"RTN","PSAPSI1",19,0)
 F  L +^PSD(58.8,PSALOC,1,PSADRUG,0):0 I  Q
"RTN","PSAPSI1",20,0)
 S PSAB=$P($G(^PSD(58.8,PSALOC,1,PSADRUG,0)),U,4)
"RTN","PSAPSI1",21,0)
 G:'$G(PSA(7)) EDO
"RTN","PSAPSI1",22,0)
 S $P(^PSD(58.8,PSALOC,1,PSADRUG,0),U,4)=$P($G(^(0)),U,4)-PSA
"RTN","PSAPSI1",23,0)
EDO L -^PSD(58.8,PSALOC,1,PSADRUG,0)
"RTN","PSAPSI1",24,0)
 S:'$D(^PSD(58.8,PSALOC,1,PSADRUG,5,0)) ^(0)="^58.801A^^"
"RTN","PSAPSI1",25,0)
 I '$D(^PSD(58.8,PSALOC,1,PSADRUG,5,+$E(PSA(4),1,5)*100,0)) D
"RTN","PSAPSI1",26,0)
 .S DIC="^PSD(58.8,"_PSALOC_",1,"_PSADRUG_",5,",DIC(0)="L",DIC("DR")="1////^S X=$G(PSAB)",(X,DINUM)=$E(PSA(4),1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSAPSI1",27,0)
 .S X="T-1M" D ^%DT S DIC="^PSD(58.8,"_PSALOC_",1,"_PSADRUG_",5,",DIC(0)="L",(X,DINUM)=$E(Y,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO S DA=+Y
"RTN","PSAPSI1",28,0)
 .S DIE="^PSD(58.8,"_PSALOC_",1,"_PSADRUG_",5,",DA(2)=PSALOC,DA(1)=PSADRUG
"RTN","PSAPSI1",29,0)
 .S DR="3////^S X=$G(PSAB)" D ^DIE K DIE
"RTN","PSAPSI1",30,0)
 S DIE="^PSD(58.8,"_PSALOC_",1,"_PSADRUG_",5,",DR="9////^S X=$P($G(^(0)),U,6)+PSA",DA=$E(PSA(4),1,5)*100,DA(2)=PSALOC,DA(1)=PSADRUG D ^DIE K DA
"RTN","PSAPSI1",31,0)
 ;update transaction
"RTN","PSAPSI1",32,0)
 S DIE="^PSD(58.81,",DR="1////15;2////^S X=PSALOC;3///^S X=PSA(4);4////^S X=PSADRUG;5////^S X=PSA;9////^S X=$G(PSAB)",DA=PSAT
"RTN","PSAPSI1",33,0)
 D ^DIE K DIE,DA,PSAB
"RTN","PSAPSI1",34,0)
 S:'$D(^PSD(58.8,PSALOC,1,PSADRUG,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSAPSI1",35,0)
 S DIC="^PSD(58.8,"_PSALOC_",1,"_PSADRUG_",4,",DIC(0)="L",(X,DINUM)=PSAT
"RTN","PSAPSI1",36,0)
 S DA(2)=PSALOC,DA(1)=PSADRUG,DLAYGO=58.8 D ^DIC K DA,DIC,DINUM,DLAYGO
"RTN","PSAPSI1",37,0)
 S DIE="^PSD(58.8,"_PSALOC_",1,",DA(1)=PSALOC,DA=PSADRUG,DR="24////^S X=PSA(4)_"",""_$G(PSAW(1))" D ^DIE S PSAT=PSAT+1
"RTN","PSAPSI1",38,0)
 Q
"RTN","PSAPSI2")
0^66^B24667963
"RTN","PSAPSI2",1,0)
PSAPSI2 ;BIR/LTL-IV Dispensing (All Drugs) ;7/23/97
"RTN","PSAPSI2",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPSI2",3,0)
 ;This routine gathers IV dispensing for all drugs in a pharmacy location.
"RTN","PSAPSI2",4,0)
 ;
"RTN","PSAPSI2",5,0)
 N DIC,DIE,DINUM,D0,D1,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,PSAPG,PSALN,PSALOCN,PSAS,PSA,PSAOUT,PSADT,DA,PSADRUG,PSADRUGN,PSAQ,PSAIV,PSAW,X,X2,Y,ZTSK
"RTN","PSAPSI2",6,0)
LOOK D ^PSADA G:'$G(PSALOC) QUIT
"RTN","PSAPSI2",7,0)
 I '$O(^PSD(58.8,+PSALOC,1,0)) W !!,"There are no drugs in ",PSALOCN,!! G QUIT
"RTN","PSAPSI2",8,0)
 D NOW^%DTC S PSADT=X,X="T-60" D ^%DT S PSADT(1)=Y,(PSAPG,PSAOUT,PSADRUG)=0
"RTN","PSAPSI2",9,0)
 S DIR(0)="D^"_PSADT(1)_":"_PSADT_":AEX",DIR("A")="How far back would you like to collect",DIR("B")="T-60"  D ^DIR K DIR S (PSADT(2),PSAR)=Y,(PSADT(3),PSAR(1))=0 I Y<1 S PSAOUT=1 Q
"RTN","PSAPSI2",10,0)
 S (PSADT(22),PSADT(23),PSAIV)=0
"RTN","PSAPSI2",11,0)
 S DIR(0)="Y",DIR("A")="Would you like a report of daily dispensing totals",DIR("B")="Yes" D ^DIR K DIR S:$D(DIRUT) PSAOUT=1 G:$D(DIRUT) STOP
"RTN","PSAPSI2",12,0)
 I Y'=1 S PSA(5)=1,ZTIO="",ZTRTN="LUP^PSAPSI2",ZTDESC="DA drug disp",ZTSAVE("PSA*")="",ZTDTH=$H D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G STOP
"RTN","PSAPSI2",13,0)
DEV K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" I Y=1 W ! D ^%ZIS
"RTN","PSAPSI2",14,0)
 I $G(POP) W !,"NO DEVICE SELECTED OR ACTION TAKEN!" S PSAOUT=1 G QUIT
"RTN","PSAPSI2",15,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH S ZTRTN="LUP^PSAPSI2",ZTDESC="Daily drug dispensing",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G STOP
"RTN","PSAPSI2",16,0)
LUP F  S PSADRUG=$O(^PSD(58.8,+PSALOC,1,PSADRUG)) Q:'PSADRUG  D:$Y+5>$G(IOSL)&('$G(PSA(5))) HEADER G:$G(PSAOUT) STOP D:$S($P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,0)),U,14):$P($G(^(0)),U,14)>DT,1:1)  D:$D(^TMP("PSA",$J,+PSADRUG)) TASK
"RTN","PSAPSI2",17,0)
 .Q:$P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,6)),U,3)
"RTN","PSAPSI2",18,0)
 .S PSADRUGN=$P($G(^PSDRUG(+PSADRUG,0)),U),PSAIV=0
"RTN","PSAPSI2",19,0)
 .I '$G(PSA(5))&('$G(PSAPG)) W @IOF D HEADER
"RTN","PSAPSI2",20,0)
 .S PSADT(3)=0,PSA(7)=1
"RTN","PSAPSI2",21,0)
 .I '$O(^PS(52.6,"AC",+PSADRUG,0))&('$O(^PS(52.7,"AC",+PSADRUG,0)))&('$G(PSA(5))) Q
"RTN","PSAPSI2",22,0)
 .S PSADRUG(1)=$O(^PS(52.6,"AC",+PSADRUG,0))
"RTN","PSAPSI2",23,0)
 .S PSADRUG(2)=$O(^PS(52.7,"AC",+PSADRUG,0))
"RTN","PSAPSI2",24,0)
 .S PSAW=PSADT(3)
"RTN","PSAPSI2",25,0)
 .F  S PSAIV=$O(^PS(50.8,PSAIV)) Q:'PSAIV  F PSADT(4)=PSADT(2):0 S PSADT(4)=$O(^PS(50.8,+PSAIV,2,PSADT(4))) Q:'PSADT(4)  D  D:$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.7,+PSADRUG(2),0)) SOL
"RTN","PSAPSI2",26,0)
 ..Q:'$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.6,+PSADRUG(1),0))
"RTN","PSAPSI2",27,0)
 ..S PSADRUG(3)=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.6,+PSADRUG(1),0))
"RTN","PSAPSI2",28,0)
 ..F  S PSAW=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW)) Q:'PSAW  S PSAW(1)=PSAW D:$O(^PSD(58.8,"AB",PSAW,0))=PSALOC
"RTN","PSAPSI2",29,0)
 ...S PSAQ=$G(PSAQ)+$P($G(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW,0)),U,2)-$P($G(^(0)),U,5)
"RTN","PSAPSI2",30,0)
 ..S:$G(PSAQ) ^TMP("PSA",$J,+PSADRUG,PSADT(4))=$G(^TMP("PSA",$J,+PSADRUG,PSADT(4)))+PSAQ S (PSAQ,PSAW)=0
"RTN","PSAPSI2",31,0)
 .Q:$G(PSA(5))
"RTN","PSAPSI2",32,0)
 .S PSADRUG(1)=$P($G(^PSDRUG(+PSADRUG,660)),U,6),PSADRUG(2)=$P($G(^(660)),U,8)
"RTN","PSAPSI2",33,0)
 .S X=PSADRUG(1),X2="3$" D COMMA^%DTC S PSADRUG(3)=X
"RTN","PSAPSI2",34,0)
 .S (PSA(4),PSA(6))=0 F  S PSA(4)=$O(^TMP("PSA",$J,+PSADRUG,PSA(4))) Q:'PSA(4)  D:$Y+4>IOSL HEADER Q:PSAOUT  S PSA(6)=PSA(6)+1,Y=PSA(4) X ^DD("DD") D
"RTN","PSAPSI2",35,0)
 ..W:$G(PSA(6))=1 !!,PSADRUGN W !!,Y
"RTN","PSAPSI2",36,0)
 ..S (X,PSADRUG(6))=$G(^TMP("PSA",$J,+PSADRUG,PSA(4))),X2=0
"RTN","PSAPSI2",37,0)
 ..S:$P($G(^PSD(58.8,+PSALOC,1,+PSADRUG,6)),U,4) X=X/$P($G(^(6)),U,4)
"RTN","PSAPSI2",38,0)
 ..D COMMA^%DTC W ?14,X,PSADRUG(2),?40,PSADRUG(3),"/",PSADRUG(2),?63
"RTN","PSAPSI2",39,0)
 ..S PSADRUG(4)=$G(PSADRUG(4))+X
"RTN","PSAPSI2",40,0)
 ..S X=X*PSADRUG(1),PSADRUG(5)=$G(PSADRUG(5))+X,X2="2$" D COMMA^%DTC W ?40,X
"RTN","PSAPSI2",41,0)
 .I PSA(6) W !,PSALN,!,PSA(6)," DAY TOTALS: " S X=$G(PSADRUG(4)),X2=0 D COMMA^%DTC W ?5,X,PSADRUG(2) S PSADRUG(4)=0 S X=$G(PSADRUG(5)),X2="2$" D COMMA^%DTC W ?63,X S PSADRUG(5)=0
"RTN","PSAPSI2",42,0)
 I 'PSADRUG&($G(PSA(5))) S PSAOUT=1
"RTN","PSAPSI2",43,0)
STOP W:$E($G(IOST),1,2)="P-" @IOF
"RTN","PSAPSI2",44,0)
 I $E($G(IOST))="C",'$G(PSAOUT) W ! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR K DIR
"RTN","PSAPSI2",45,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAPSI2",46,0)
 K ^TMP("PSA",$J),PSA
"RTN","PSAPSI2",47,0)
QUIT Q
"RTN","PSAPSI2",48,0)
HEADER I $E(IOST,1,2)'="P-",$G(PSAPG) S DIR(0)="E" D ^DIR K DIR I Y<1 S PSAOUT=1 Q
"RTN","PSAPSI2",49,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAPSI2",50,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=$G(PSAPG)+1 W !,?2,"DAILY DISPENSING TOTALS FOR ",$E($G(PSALOCN),1,30),?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAPSI2",51,0)
 W "  DATE",?23,"TOTAL",?45,"$/DISP",?67,"TOTAL",!
"RTN","PSAPSI2",52,0)
 W "DISPENSED",?23,"DISP",?46,"UNIT",?68,"COST",!,PSALN
"RTN","PSAPSI2",53,0)
 Q
"RTN","PSAPSI2",54,0)
TASK S ZTIO="",ZTRTN="^PSAPSI1",ZTDTH=$H,ZTDESC="Dispensing totals",(ZTSAVE("^TMP(""PSA"",$J,+PSADRUG,"),ZTSAVE("PSA*"))="" D ^%ZTLOAD,HOME^%ZIS
"RTN","PSAPSI2",55,0)
 W:'$G(PSA(5)) !!,"Updating transaction file and dispensing totals." Q
"RTN","PSAPSI2",56,0)
SOL S PSAW=PSADT(3),PSADRUG(3)=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.7,+PSADRUG(2),0))
"RTN","PSAPSI2",57,0)
 F  S PSAW=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW)) Q:'PSAW  S PSAW(1)=PSAW D:$O(^PSD(58.8,"AB",PSAW,0))=PSALOC
"RTN","PSAPSI2",58,0)
 .S PSAQ=$G(PSAQ)+$P($G(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW,0)),U,2)-$P($G(^(0)),U,5)
"RTN","PSAPSI2",59,0)
 S:PSAQ ^TMP("PSA",$J,+PSADRUG,PSADT(4))=$G(^TMP("PSA",$J,+PSADRUG,PSADT(4)))+PSAQ S (PSAQ,PSAW)=0
"RTN","PSAPSI2",60,0)
 Q
"RTN","PSAPSI3")
0^67^B23307435
"RTN","PSAPSI3",1,0)
PSAPSI3 ;BIR/LTL-Nightly Background Job ;8/7/97
"RTN","PSAPSI3",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPSI3",3,0)
 ;This is the entry point for the nightly job. It collects dispensing
"RTN","PSAPSI3",4,0)
 ;data in IV Solutions, Unit Dose, and Outpatient then purges old data.
"RTN","PSAPSI3",5,0)
 ;It calls ^PSAREORD that searches the pharmacy locations & master vaults
"RTN","PSAPSI3",6,0)
 ;for drug balances <= the reorder level IF the location/vault is
"RTN","PSAPSI3",7,0)
 ;maintaining reorder levels.
"RTN","PSAPSI3",8,0)
 ;
"RTN","PSAPSI3",9,0)
 S PSALOC=0 F  S PSALOC=+$O(^PSD(58.8,"ADISP","P",PSALOC)) G:'PSALOC NEXT D:$O(^PSD(58.8,PSALOC,1,0)) LUP
"RTN","PSAPSI3",10,0)
NEXT D:$D(^TMP("PSA",$J)) ^PSAPSI1 K ^TMP("PSA",$J)
"RTN","PSAPSI3",11,0)
 ;Gets dispensed data in Unit Dose and Outpatient. Purge data.
"RTN","PSAPSI3",12,0)
 D ^PSAUDP,^PSAOP3,^PSAPUR D:$D(^XTMP("PSAPV",0)) XTMP
"RTN","PSAPSI3",13,0)
END K D3,PSA,PSADRUG,PSADT,PSAIV,PSAIV5,PSALOC,PSAQ,PSAW,PSGDRG,PSGPLFDT,PSGRTN,PSGWARD,PSGX,X,Y
"RTN","PSAPSI3",14,0)
 G ^PSAREORD
"RTN","PSAPSI3",15,0)
 Q
"RTN","PSAPSI3",16,0)
LUP D NOW^%DTC S PSADT=X,X="T-2" D ^%DT
"RTN","PSAPSI3",17,0)
 S (PSADT(2),PSADT(22))=Y,(PSADRUG,PSADT(3),PSAIV)=0
"RTN","PSAPSI3",18,0)
 ;If drug's inactivation date is after today, continue.
"RTN","PSAPSI3",19,0)
 F  S PSADRUG=+$O(^PSD(58.8,PSALOC,1,PSADRUG)) Q:'PSADRUG  D:$S($P($G(^PSD(58.8,PSALOC,1,PSADRUG,0)),U,14):$P($G(^(0)),U,14)>DT,1:1)  D:$D(^TMP("PSA",$J,PSADRUG)) ^PSAPSI1
"RTN","PSAPSI3",20,0)
 .;If last collection date is in file, set PSADT equal to it.
"RTN","PSAPSI3",21,0)
 .I $P($P($G(^PSD(58.8,PSALOC,1,PSADRUG,6)),U,3),",") S PSADT(2)=$P($P($G(^(6)),U,3),","),PSADT(3)=0,PSA(7)=1
"RTN","PSAPSI3",22,0)
 .;Quit if the drug is not in IV SOLUTIONS & IV ADDITIVES files.
"RTN","PSAPSI3",23,0)
 .Q:'$O(^PS(52.6,"AC",PSADRUG,0))&('$O(^PS(52.7,"AC",PSADRUG,0)))
"RTN","PSAPSI3",24,0)
 .;Set array = to DRUG file's drug that is linked to it.
"RTN","PSAPSI3",25,0)
 .S PSADRUG(1)=$O(^PS(52.6,"AC",PSADRUG,0)),PSAIV=0
"RTN","PSAPSI3",26,0)
 .S PSADRUG(2)=$O(^PS(52.7,"AC",PSADRUG,0))
"RTN","PSAPSI3",27,0)
 .S PSAW=PSADT(3)
"RTN","PSAPSI3",28,0)
 .F  S PSAIV=$O(^PS(50.8,PSAIV)) Q:'PSAIV  F PSADT(4)=PSADT(2):0 S PSADT(4)=$O(^PS(50.8,+PSAIV,2,PSADT(4))) Q:'PSADT(4)  D  D:$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.7,+PSADRUG(2),0)) SOL
"RTN","PSAPSI3",29,0)
 ..Q:'$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.6,+PSADRUG(1),0))
"RTN","PSAPSI3",30,0)
 ..S PSADRUG(3)=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.6,+PSADRUG(1),0))
"RTN","PSAPSI3",31,0)
 ..F  S PSAW=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW)) Q:'PSAW  S PSAW(1)=PSAW D
"RTN","PSAPSI3",32,0)
 ...I PSAW'=.5 Q:'$O(^PSD(58.8,"AB",PSAW,0))=PSALOC
"RTN","PSAPSI3",33,0)
 ...;If it is OP dispensing IVs to IV Rooms, quit if the pharmacy
"RTN","PSAPSI3",34,0)
 ...;location does not have an IV Room assigned to it or if it does not
"RTN","PSAPSI3",35,0)
 ...;have an OP site set up.
"RTN","PSAPSI3",36,0)
 ...I PSAW=.5 D OP Q
"RTN","PSAPSI3",37,0)
 ...S PSAQ=$G(PSAQ)+$P($G(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW,0)),U,2)-$P($G(^(0)),U,5)
"RTN","PSAPSI3",38,0)
 ..S:$G(PSAQ) ^TMP("PSA",$J,PSADRUG,PSADT(4))=$G(^TMP("PSA",$J,PSADRUG,PSADT(4)))+PSAQ S (PSAQ,PSAW)=0
"RTN","PSAPSI3",39,0)
 .S PSADT(2)=PSADT(22)
"RTN","PSAPSI3",40,0)
 Q
"RTN","PSAPSI3",41,0)
SOL S PSAW=PSADT(3),PSADRUG(3)=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.7,+PSADRUG(2),0))
"RTN","PSAPSI3",42,0)
 F  S PSAW=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW)) Q:'PSAW  S PSAW(1)=PSAW D:$O(^PSD(58.8,"AB",PSAW,0))=PSALOC
"RTN","PSAPSI3",43,0)
 .S PSAQ=$G(PSAQ)+$P($G(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW,0)),U,2)-$P($G(^(0)),U,5)
"RTN","PSAPSI3",44,0)
 S:$G(PSAQ) ^TMP("PSA",$J,PSADRUG,PSADT(4))=$G(^TMP("PSA",$J,PSADRUG,PSADT(4)))+PSAQ S (PSAQ,PSAW)=0
"RTN","PSAPSI3",45,0)
 Q
"RTN","PSAPSI3",46,0)
OP ;
"RTN","PSAPSI3",47,0)
 S PSAIV5=+$O(^PSD(58.8,"AIV",PSALOC,0)) Q:'PSAIV5!('+$P($G(^PSD(58.8,PSALOC,0)),"^",10))
"RTN","PSAPSI3",48,0)
 S PSAFND=0 F  S PSAFND=$O(^PSD(58.8,"AB",PSAW,0)) Q:'PSAFND!(PSAFND=PSALOC)
"RTN","PSAPSI3",49,0)
 Q:$G(PSAFND)'=PSALOC
"RTN","PSAPSI3",50,0)
 S PSAQ=$G(PSAQ)+$P($G(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW,0)),U,2)-$P($G(^(0)),U,5)
"RTN","PSAPSI3",51,0)
 Q
"RTN","PSAPSI3",52,0)
 ;
"RTN","PSAPSI3",53,0)
XTMP ;If the XTMP global is going to be deleted in 4 days, sent a warning
"RTN","PSAPSI3",54,0)
 ;mail msg to holders of PSA ORDERS.
"RTN","PSAPSI3",55,0)
 S PSAEND=+$P(^XTMP("PSAPV",0),"^") Q:'PSAEND
"RTN","PSAPSI3",56,0)
 S X1=PSAEND,X2=DT D ^%DTC Q:X>4  S PSADAYS=X,(PSACNT,PSACTRL)=0
"RTN","PSAPSI3",57,0)
 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""  S:$D(^XTMP("PSAPV",PSACTRL,"IN")) PSACNT=PSACNT+1
"RTN","PSAPSI3",58,0)
 Q:'PSACNT
"RTN","PSAPSI3",59,0)
 I PSACNT>1 D
"RTN","PSAPSI3",60,0)
 .S ^TMP("PSAXTMP",$J,1)="There are "_PSACNT_" invoices that have been uploaded and not processed. If these"
"RTN","PSAPSI3",61,0)
 .S ^TMP("PSAXTMP",$J,2)="invoices are not processed in four calendar days or if more invoices are not"
"RTN","PSAPSI3",62,0)
 .S ^TMP("PSAXTMP",$J,3)="uploaded in four calendar days, the "_PSACNT_" invoices will be deleted."
"RTN","PSAPSI3",63,0)
 I PSACNT=1 D
"RTN","PSAPSI3",64,0)
 .S ^TMP("PSAXTMP",$J,1)="There is 1 invoice that has been uploaded and not processed. If this"
"RTN","PSAPSI3",65,0)
 .S ^TMP("PSAXTMP",$J,2)="invoice is not processed in four calendar days or if more invoices"
"RTN","PSAPSI3",66,0)
 .S ^TMP("PSAXTMP",$J,3)="are not uploaded in four calendar days, the invoice will be deleted."
"RTN","PSAPSI3",67,0)
 S XMDUZ="Drug Accountability System",XMSUB="Unprocessed Invoice"_$S(PSACNT>1:"s",1:"")_" Due to Expire in "_PSADAYS_" day"_$S(PSADAYS>1:"s",1:""),XMTEXT="^TMP(""PSAXTMP"",$J,"
"RTN","PSAPSI3",68,0)
 S PSADUZ=0 F  S PSADUZ=+$O(^XUSEC("PSA ORDERS",PSADUZ)) Q:'PSADUZ  S XMY(PSADUZ)=""
"RTN","PSAPSI3",69,0)
 G:'$D(XMY) QUIT D ^XMD
"RTN","PSAPSI3",70,0)
QUIT K ^TMP("PSAXTMP",$J),PSACNT,PSACTRL,PSADAYS,PSADUZ,X,X1,X2,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","PSAPSI3",71,0)
 Q
"RTN","PSAPSI4")
0^68^B3007637
"RTN","PSAPSI4",1,0)
PSAPSI4 ; BIR/LTL-IV Dispensing (Single Drug) & (All Drugs) ;7/23/97
"RTN","PSAPSI4",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPSI4",3,0)
 ;This routine gets and sets the IV conversion factors.
"RTN","PSAPSI4",4,0)
 ;
"RTN","PSAPSI4",5,0)
 N PSADD,PSASOL,PSAC,Y,DIE,DA,DR
"RTN","PSAPSI4",6,0)
ADD S PSADD=$O(^PS(52.6,"AC",+PSAIT,0)) D:PSADD
"RTN","PSAPSI4",7,0)
 .W !,PSAIT(2)," is an IV Additive and will therefore be"
"RTN","PSAPSI4",8,0)
 I 'PSADD S PSASOL=$O(^PS(52.7,"AC",+PSAIT,0)) W !,PSAIT(2)," is an IV Solution and will therefore be"
"RTN","PSAPSI4",9,0)
 W !!,"dispensed in the IV module by the " D:PSADD
"RTN","PSAPSI4",10,0)
 .S Y=$P($G(^PS(52.6,+PSADD,0)),U,3),PSAC=$P(^DD(52.6,2,0),U,2)
"RTN","PSAPSI4",11,0)
 .D Y^DIQ W Y
"RTN","PSAPSI4",12,0)
 W:$G(PSASOL) "ML"
"RTN","PSAPSI4",13,0)
 W ", but in ",PSALOCN," by the ",$P(PSAIT(4),U,8),".",!!
"RTN","PSAPSI4",14,0)
 W:PSADD "Please enter the number of ",Y,"s per ",$P(PSAIT(4),U,8),".",!
"RTN","PSAPSI4",15,0)
 S DIE="^PSD(58.8,+PSALOC,1,",DA(1)=PSALOC,DA=PSAIT,DR="25"
"RTN","PSAPSI4",16,0)
 I $G(PSASOL) W "The IV conversion factor is set to " S PSASOL(1)=+$P($G(^PS(52.7,+PSASOL,0)),U,3),DR="25////"_PSASOL(1) W PSASOL(1),".  <determined by IV Solution volume>",!
"RTN","PSAPSI4",17,0)
 D ^DIE K DIE,DA,DR,PSADD,PSASOL
"RTN","PSAPSI5")
0^69^B7116664
"RTN","PSAPSI5",1,0)
PSAPSI5 ;BIR/LTL,JMB-Nightly Background Job - CONT'D ;7/23/97
"RTN","PSAPSI5",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPSI5",3,0)
 ;This routine gathers IV and unit dose dispensing data.
"RTN","PSAPSI5",4,0)
 ;
"RTN","PSAPSI5",5,0)
SOL S PSAW=PSADT(3),PSADRUG(3)=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,"AC",52.7,+PSADRUG(2),0))
"RTN","PSAPSI5",6,0)
 F  S PSAW=$O(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW)) Q:'PSAW  S PSAW(1)=PSAW D:$O(^PSD(58.8,"AB",PSAW,0))=PSALOC
"RTN","PSAPSI5",7,0)
 .S PSAQ=$G(PSAQ)+$P($G(^PS(50.8,+PSAIV,2,+PSADT(4),2,+PSADRUG(3),3,PSAW,0)),"^",2)-$P($G(^(0)),"^",5)
"RTN","PSAPSI5",8,0)
 S:PSAQ ^TMP("PSA",$J,+PSADRUG,PSADT(4))=$G(^TMP("PSA",$J,+PSADRUG,PSADT(4)))+PSAQ S (PSAQ,PSAW)=0
"RTN","PSAPSI5",9,0)
 Q
"RTN","PSAPSI5",10,0)
 ; Entry point Unit Dose dispensing, returns, extras, & pre-exchange
"RTN","PSAPSI5",11,0)
 ; needs. It is called by ^PSGAMSA & ^PSGPFL.
"RTN","PSAPSI5",12,0)
 ;Checks for Drug Acct background job K8 & K7.1
"RTN","PSAPSI5",13,0)
EN I $D(^DIC(19.2)) S PSGBK=+$O(^DIC(19.2,"B",+$O(^DIC(19,"B","PSA IV ALL LOCATIONS",0)),0)) G:'PSGBK EXIT I $P($G(^DIC(19.2,PSGBK,0)),"^",2)>DT S PSADA=1 G SETXTMP
"RTN","PSAPSI5",14,0)
 I $P($G(^DIC(19,+$O(^DIC(19,"B","PSA IV ALL LOCATIONS",0)),200)),"^")>DT S PSADA=1
"RTN","PSAPSI5",15,0)
SETXTMP ; Unit Dose returns, extras, & pre-exchange needs
"RTN","PSAPSI5",16,0)
 S X1=DT,X2=1 D C^%DTC S ^XTMP("PSAPL",0)=X
"RTN","PSAPSI5",17,0)
 G:'$G(PSADA) EXIT G:$G(PSGRTN)="PSGPLF" PICKLST
"RTN","PSAPSI5",18,0)
 ;drug stocked in Drug Acct Location?
"RTN","PSAPSI5",19,0)
 G:'+PSGDRG!('$D(^PSD(58.8,"C",+PSGDRG))) EXIT
"RTN","PSAPSI5",20,0)
 S PSADA("LOC")=$O(^PSD(58.8,"AB",PSGWARD,0))
"RTN","PSAPSI5",21,0)
 ;Quit if the ward is not in 58.8, the pharmacy location is not a drug
"RTN","PSAPSI5",22,0)
 ;acct. drug, the pharmacy location is inactive, or there is no inpatient
"RTN","PSAPSI5",23,0)
 ;site in the pharmacy location.
"RTN","PSAPSI5",24,0)
 I 'PSADA("LOC")!('$D(^PSD(58.8,"ADISP","P",+PSADA("LOC"))))!('+$P($G(^PSD(58.8,+PSADA("LOC"),0)),"^",3)) G EXIT
"RTN","PSAPSI5",25,0)
 I +$G(^PSD(58.8,+PSADA("LOC"),"I")),+^PSD(58.8,+PSADA("LOC"),"I")'>DT G EXIT
"RTN","PSAPSI5",26,0)
 S PSADA("IPSITE")=+$P($G(^PSD(58.8,PSADA("LOC"),0)),"^",3)
"RTN","PSAPSI5",27,0)
 S ^XTMP("PSAPL",+PSADA("IPSITE"),+PSGDRG,+$S($D(PSGPLFDT):PSGPLFDT,1:%))=$G(^XTMP("PSAPL",+PSADA("IPSITE"),+PSGDRG,+$S($D(PSGPLFDT):PSGPLFDT,1:%)))+$G(PSGX)
"RTN","PSAPSI5",28,0)
EXIT K PSGBK,PSADA,PSGRTN
"RTN","PSAPSI5",29,0)
 Q
"RTN","PSAPSI5",30,0)
PICKLST ;Pick List dispensing and returns.
"RTN","PSAPSI5",31,0)
 ;Drug stocked in Drug Acct Location?
"RTN","PSAPSI5",32,0)
 I '+D3!('$D(^PSD(58.8,"C",D3))) G EXIT
"RTN","PSAPSI5",33,0)
 S PSADA("LOC")=$O(^PSD(58.8,"AB",D1,0))
"RTN","PSAPSI5",34,0)
 ;Quit if the ward is not in 58.8, the pharmacy location is not a drug
"RTN","PSAPSI5",35,0)
 ;acct. drug, the pharmacy location is inactive, or there is no inpatient
"RTN","PSAPSI5",36,0)
 ;site in the pharmacy location.
"RTN","PSAPSI5",37,0)
 I 'PSADA("LOC")!('$D(^PSD(58.8,"ADISP","P",+PSADA("LOC"))))!('+$P($G(^PSD(58.8,+PSADA("LOC"),0)),"^",3)) G EXIT
"RTN","PSAPSI5",38,0)
 I +$G(^PSD(58.8,+PSADA("LOC"),"I")),+^PSD(58.8,+PSADA("LOC"),"I")'>DT G EXIT
"RTN","PSAPSI5",39,0)
 S PSADA("IPSITE")=+$P($G(^PSD(58.8,PSADA("LOC"),0)),"^",3)
"RTN","PSAPSI5",40,0)
 S ^XTMP("PSAPL",+PSADA("IPSITE"),+D3,+D0)=$G(^XTMP("PSAPL",+PSADA("IPSITE"),+D3,+D0))+$G(Y)
"RTN","PSAPSI5",41,0)
 Q
"RTN","PSAPUR")
0^70^B5628949
"RTN","PSAPUR",1,0)
PSAPUR ;BIR/LTL-Nightly Background Job - CONT'D ;7/23/97
"RTN","PSAPUR",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPUR",3,0)
 ;This routine purges all DA transactions greater than 120 days old. It
"RTN","PSAPUR",4,0)
 ;also purges all invoices from the DA ORDERS file if they are over the
"RTN","PSAPUR",5,0)
 ;number of days set in 58.8. It is called by PSAPSI5.
"RTN","PSAPUR",6,0)
 ;
"RTN","PSAPUR",7,0)
 N DIC,DIE,DINUM,D0,D1,DLAYGO,DR,PSAS,PSA,PSALOC,PSAOUT,PSADT,DA,PSADRUG,PSADRUGN,PSAT,PSAR,X,Y
"RTN","PSAPUR",8,0)
 S PSALOC=0
"RTN","PSAPUR",9,0)
 S X="T-120" D ^%DT S PSADT=Y
"RTN","PSAPUR",10,0)
 F  S PSALOC=$O(^PSD(58.8,PSALOC)) G:'PSALOC END D:$P($G(^PSD(58.8,+PSALOC,0)),U,2)="P"
"RTN","PSAPUR",11,0)
 .S PSADRUG=0
"RTN","PSAPUR",12,0)
LUP .F  S PSADRUG=$O(^PSD(58.8,+PSALOC,1,PSADRUG)) Q:'PSADRUG  D:$O(^PSD(58.8,+PSALOC,1,+PSADRUG,4,0))
"RTN","PSAPUR",13,0)
 ..S PSAT=0
"RTN","PSAPUR",14,0)
 ..F  S PSAT=$O(^PSD(58.8,+PSALOC,1,+PSADRUG,4,PSAT)) Q:'PSAT  D:$P($G(^PSD(58.81,+PSAT,0)),U,4)<PSADT&('$P($G(^PSD(58.81,+PSAT,"CS")),U))
"RTN","PSAPUR",15,0)
 ...S DIE="^PSD(58.8,+PSALOC,1,+PSADRUG,4,",DA(2)=PSALOC,DA(1)=PSADRUG,DA=PSAT,DR=".01////@" D ^DIE
"RTN","PSAPUR",16,0)
 ...S DIE="^PSD(58.81,",DA=PSAT,DR=".01////@" D ^DIE
"RTN","PSAPUR",17,0)
 ;
"RTN","PSAPUR",18,0)
ORDERS ;Deletes invoices from the DA ORDERS file if they are over the number
"RTN","PSAPUR",19,0)
 ;of days set in 58.8.
"RTN","PSAPUR",20,0)
 S PSALOC=0 F  S PSALOC=$O(^PSD(58.811,"ALOC",PSALOC)) Q:'PSALOC  D
"RTN","PSAPUR",21,0)
 .S PSALOCDT=$S(+$P($G(^PSD(58.8,PSALOC,0)),"^",15):+$P($G(^PSD(58.8,PSALOC,0)),"^",15),1:120) S X1=DT,X2=-PSALOCDT D C^%DTC S PSALOCDT=X
"RTN","PSAPUR",22,0)
 .S PSADT=0 F  S PSADT=$O(^PSD(58.811,"ALOC",PSALOC,PSADT)) Q:'PSADT!(PSADT>PSALOCDT)  D
"RTN","PSAPUR",23,0)
 ..S PSAIEN=0 F  S PSAIEN=$O(^PSD(58.811,"ALOC",PSALOC,PSADT,PSAIEN)) Q:'PSAIEN  D
"RTN","PSAPUR",24,0)
 ...S PSAIEN1=0 F  S PSAIEN1=$O(^PSD(58.811,"ALOC",PSALOC,PSADT,PSAIEN,PSAIEN1)) Q:'PSAIEN1  D
"RTN","PSAPUR",25,0)
 ....Q:$P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,0)),"^",3)'="C"!('$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0)))
"RTN","PSAPUR",26,0)
 ....S DA(1)=PSAIEN,DA=PSAIEN1,DIK="^PSD(58.811,"_DA(1)_",1," D ^DIK K DA,DIK
"RTN","PSAPUR",27,0)
 ...I '$O(^PSD(58.811,PSAIEN,1,0)) S DA=PSAIEN,DIK="^PSD(58.811," D ^DIK K DA,DIK
"RTN","PSAPUR",28,0)
 K PSADT,PSAIEN,PSAIEN1,PSALOC,PSALOCDT,X,X1,X2
"RTN","PSAPUR",29,0)
END Q
"RTN","PSAPV")
0^71^B24582055
"RTN","PSAPV",1,0)
PSAPV ;BIR/JMB-Processor and Verifier ;9/6/97
"RTN","PSAPV",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAPV",3,0)
 ;This routine prints the order number, invoice number, invoice date,
"RTN","PSAPV",4,0)
 ;processor's name, process date, verifier's name, and verification
"RTN","PSAPV",5,0)
 ;date for a specified invoice date range.
"RTN","PSAPV",6,0)
 ;
"RTN","PSAPV",7,0)
 I '$D(^XUSEC("PSA ORDERS",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSAPV",8,0)
 I '$O(^PSD(58.811,"ADATE",0)) W !,"There are no invoices." G EXIT
"RTN","PSAPV",9,0)
 S PSAOUT=0 D BDATE G:PSAOUT EXIT
"RTN","PSAPV",10,0)
DEVICE ;Asks device & queueing info
"RTN","PSAPV",11,0)
 W !!,"The report must be sent to a printer that supports 132 columns.",!
"RTN","PSAPV",12,0)
DEV K IO("Q"),%ZIS,IOP,POP S %ZIS="0Q",%ZIS("B")="",IOM=132
"RTN","PSAPV",13,0)
 D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSAPV",14,0)
 I $E(IOST)["C"!($G(IOM)<132) W !,"The printout must be sent to a 132 column printer!",! G DEV
"RTN","PSAPV",15,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSAPV",16,0)
 .N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK
"RTN","PSAPV",17,0)
 .S ZTRTN="COMPILE^PSAPV",ZTDESC="Drug Acct. - Processor and Verifier Report"
"RTN","PSAPV",18,0)
 .S:$D(PSABEG) ZTSAVE("PSABEG")="" S:$D(PSAEND) ZTSAVE("PSAEND")=""
"RTN","PSAPV",19,0)
 .D ^%ZTLOAD
"RTN","PSAPV",20,0)
 ;
"RTN","PSAPV",21,0)
COMPILE ;Compiles data
"RTN","PSAPV",22,0)
 S PSAOUT=0,X1=PSABEG,X2=-1 D C^%DTC S PSADATE=X_.239999
"RTN","PSAPV",23,0)
 F  S PSADATE=+$O(^PSD(58.811,"ADATE",PSADATE)) Q:'PSADATE!(PSADATE>PSAEND)!(PSAOUT)  D
"RTN","PSAPV",24,0)
 .S PSAIEN=0 F  S PSAIEN=+$O(^PSD(58.811,"ADATE",PSADATE,PSAIEN)) Q:'PSAIEN!(PSAOUT)  D
"RTN","PSAPV",25,0)
 ..Q:'$D(^PSD(58.811,PSAIEN,0))  S PSAORD=$P(^PSD(58.811,PSAIEN,0),"^"),PSAIEN1=0
"RTN","PSAPV",26,0)
 ..F  S PSAIEN1=+$O(^PSD(58.811,"ADATE",PSADATE,PSAIEN,PSAIEN1)) Q:'PSAIEN1!(PSAOUT)  D
"RTN","PSAPV",27,0)
 ...Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0))
"RTN","PSAPV",28,0)
 ...S PSAIN=^PSD(58.811,PSAIEN,1,PSAIEN1,0),PSAINV=$P(PSAIN,"^"),PSAINVDT=$P(PSAIN,"^",2),PSAPROC=+$P(PSAIN,"^",10),PSAVER=+$P(PSAIN,"^",11)
"RTN","PSAPV",29,0)
 ...S PSAPROC=$S($P($G(^VA(200,PSAPROC,0)),"^")'="":$P($G(^VA(200,PSAPROC,0)),"^"),1:"")
"RTN","PSAPV",30,0)
 ...S PSAVER=$S($P($G(^VA(200,PSAVER,0)),"^")'="":$P($G(^VA(200,PSAVER,0)),"^"),1:"")
"RTN","PSAPV",31,0)
 ...S (PSALINE,PSAPROCD,PSAVERD)=0
"RTN","PSAPV",32,0)
 ...Q:PSAPROC=""&(PSAVER="")
"RTN","PSAPV",33,0)
 ...F  S PSALINE=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE)) Q:'PSALINE!(PSAOUT)  D
"RTN","PSAPV",34,0)
 ....Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0))
"RTN","PSAPV",35,0)
 ....S PSADATA=^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0) S:PSAPROCD<$P(PSADATA,"^",6) PSAPROCD=$P(PSADATA,"^",6) S:PSAVERD<$P(PSADATA,"^",8) PSAVERD=$P(PSADATA,"^",8)
"RTN","PSAPV",36,0)
 ..S PSAINVDT=$S(+PSAINVDT:$E(PSAINVDT,4,5)_"/"_$E(PSAINVDT,6,7)_"/"_$E(PSAINVDT,2,3),1:"UNKNOWN")
"RTN","PSAPV",37,0)
 ..S PSAPROCD=$S(+PSAPROCD&(PSAPROC'=""):$E(PSAPROCD,4,5)_"/"_$E(PSAPROCD,6,7)_"/"_$E(PSAPROCD,2,3),1:"")
"RTN","PSAPV",38,0)
 ..S PSAVERD=$S(+PSAVERD&(PSAVER'=""):$E(PSAVERD,4,5)_"/"_$E(PSAVERD,6,7)_"/"_$E(PSAVERD,2,3),1:"")
"RTN","PSAPV",39,0)
 ..S ^TMP("PSAPVR",$J,PSAORD,PSAINV)=PSAINVDT_"^"_PSAPROC_"^"_PSAPROCD_"^"_PSAVER_"^"_PSAVERD
"RTN","PSAPV",40,0)
 ;
"RTN","PSAPV",41,0)
PRINT ;Print data
"RTN","PSAPV",42,0)
 S Y=PSAEND D DD^%DT S PSAENDX=Y K X,Y,%DT
"RTN","PSAPV",43,0)
 S Y=PSABEG D DD^%DT S PSABEGX=Y K X,Y,%DT
"RTN","PSAPV",44,0)
 D NOW^%DTC S PSARUN=%,PSARUN=$E(PSARUN,4,5)_"/"_$E(PSARUN,6,7)_"/"_$E(PSARUN,2,3)_"@"_$E($P(PSARUN,".",2),1,2)_":"_$E($P(PSARUN,".",2),3,4)
"RTN","PSAPV",45,0)
 S PSAPG=0,PSASLN="",$P(PSASLN,"-",123)="" K Y D HDR
"RTN","PSAPV",46,0)
 S PSAORD="" F  S PSAORD=$O(^TMP("PSAPVR",$J,PSAORD)) Q:PSAORD=""  D
"RTN","PSAPV",47,0)
 .I $Y+4>IOSL D HDR
"RTN","PSAPV",48,0)
 .W !,"Order #: "_PSAORD,?24,"|",?36,"|",?68,"|",?80,"|",?112,"|"
"RTN","PSAPV",49,0)
 .S PSAINV="" F  S PSAINV=$O(^TMP("PSAPVR",$J,PSAORD,PSAINV)) Q:PSAINV=""  D
"RTN","PSAPV",50,0)
 ..S PSADATA=^TMP("PSAPVR",$J,PSAORD,PSAINV),PSAINVDT=$P(PSADATA,"^"),PSAPROC=$P(PSADATA,"^",2),PSAPROCD=$P(PSADATA,"^",3),PSAVER=$P(PSADATA,"^",4),PSAVERD=$P(PSADATA,"^",5)
"RTN","PSAPV",51,0)
 ..W !,PSAINV,?24,"|",?26,PSAINVDT,?36,"|",?38,PSAPROC,?68,"|",?70,PSAPROCD,?80,"|",?82,PSAVER,?112,"|",?114,PSAVERD
"RTN","PSAPV",52,0)
 .W !,"                        |           |                               |           |                               |"
"RTN","PSAPV",53,0)
 W !,PSASLN,!
"RTN","PSAPV",54,0)
 ;
"RTN","PSAPV",55,0)
EXIT W @IOF
"RTN","PSAPV",56,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q"),^TMP("PSAPVR",$J)
"RTN","PSAPV",57,0)
 K %,%ZIS,DTOUT,PSABEG,PSABEG,PSABEGX,PSADATA,PSADATE,PSAEND,PSAENDX,PSAIEN,PSAIEN1,PSAIN,PSAINV,PSAINVDT
"RTN","PSAPV",58,0)
 K PSALINE,PSAORD,PSAOUT,PSAPG,PSAPROC,PSAPROCD,PSARUN,PSASLN,PSAVER,PSAVERD,X,X1,X2,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","PSAPV",59,0)
 Q
"RTN","PSAPV",60,0)
 ;
"RTN","PSAPV",61,0)
BDATE ;Gets beginning and ending invoice dates
"RTN","PSAPV",62,0)
 W ! S %DT="AEP",%DT("A")="Beginning Date: " D ^%DT
"RTN","PSAPV",63,0)
 I +Y<1!($D(DTOUT))!(X["^")!(X']"") S PSAOUT=1 Q
"RTN","PSAPV",64,0)
 I Y>DT K X,Y,%DT W !!,"Future dates are not permitted.",! K X,Y,%DT G BDATE
"RTN","PSAPV",65,0)
 S PSABEG=+Y
"RTN","PSAPV",66,0)
EDATE W ! S %DT="AE",%DT("A")="Ending Date   : " D ^%DT
"RTN","PSAPV",67,0)
 I +Y<1!($D(DTOUT))!(X["^")!(X']"") S PSAOUT=1 Q
"RTN","PSAPV",68,0)
 I Y<PSABEG K X,Y,%DT W !!,"Ending Date cannot be before the Start Date.",! K X,Y,%DT G EDATE
"RTN","PSAPV",69,0)
 S PSAEND=+Y
"RTN","PSAPV",70,0)
 Q
"RTN","PSAPV",71,0)
 ;
"RTN","PSAPV",72,0)
HDR ;Report header
"RTN","PSAPV",73,0)
 I $E(IOST)'="C",PSAPG W !,PSASLN,@IOF
"RTN","PSAPV",74,0)
 S PSAPG=PSAPG+1
"RTN","PSAPV",75,0)
 W !?46,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",?114,"PAGE "_PSAPG,!?51,"PROCESSOR AND VERIFIER REPORT"
"RTN","PSAPV",76,0)
 I $E(IOST,1,2)="C-" W !,"RUN DATE: "_PSARUN,?52,PSABEGX_" - "_PSAENDX
"RTN","PSAPV",77,0)
 E  W !,?52,PSABEGX_" - "_PSAENDX
"RTN","PSAPV",78,0)
 W !!?24,"|  INVOICE",?36,"|",?68,"|   DATE",?80,"|",?112,"|   DATE"
"RTN","PSAPV",79,0)
 W !,"INVOICE#",?24,"|   DATE",?36,"| PROCESSOR",?68,"| PROCESSED",?80,"| VERIFIER",?112,"| VERIFIED"
"RTN","PSAPV",80,0)
 W !,"========================|===========|===============================|===========|===============================|========="
"RTN","PSAPV",81,0)
 Q
"RTN","PSAREC")
0^72^B38410289
"RTN","PSAREC",1,0)
PSAREC ;BIR/LTL,JMB-Receiving Directly into Drug Accountability ;7/23/97
"RTN","PSAREC",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAREC",3,0)
 ;This routine receives non-prime vendor's drugs into pharmacy locations.
"RTN","PSAREC",4,0)
 ;The balances are incremented in the pharmacy location & the DRUG file.
"RTN","PSAREC",5,0)
 ;
"RTN","PSAREC",6,0)
SETUP S (PSACNT,PSAOUT)=0 D ^PSAUTL3 G:PSAOUT EXIT
"RTN","PSAREC",7,0)
 S PSACHK=$O(PSALOC(""))
"RTN","PSAREC",8,0)
 I PSACHK="",'PSALOC W !,"There are no active pharmacy locations." G EXIT
"RTN","PSAREC",9,0)
 S PSAPO=$P($G(^PSD(58.8,+PSALOC,0)),"^",9)
"RTN","PSAREC",10,0)
 I +$E($P($G(^PRC(442,+PSAPO,12)),"^",5),4,5)'=+$E(DT,4,5) W !!,"The current PO# for this location doesn't seem current.",! D  G:$D(DIRUT) EXIT
"RTN","PSAREC",11,0)
 .S DIR(0)="Y",DIR("A")="Would you like to correct it",DIR("B")="No",DIR("?")="You can store a obligation number and it will be presented as the default.",DIR("??")="^D CORRECT^PSAREC"
"RTN","PSAREC",12,0)
 .D ^DIR K DIR Q:$D(DIRUT)!(Y<1)
"RTN","PSAREC",13,0)
 .S DIE="^PSD(58.8,",DA=PSALOC,DR="13" D ^DIE K DIE
"RTN","PSAREC",14,0)
 .S DIC("B")=$P($G(^PRC(442,+$P($G(^PSD(58.8,+PSALOC,0)),"^",9),0)),"^")
"RTN","PSAREC",15,0)
PO S PSAOUT=0 W ! S DIC="^PRC(442,",DIC(0)="AEMQZ"
"RTN","PSAREC",16,0)
 S DIC("A")="Select Obligation Number: ",DIC("S")="I $P($G(^(0)),""^"",5)[822400" D ^DIC K DIC G:Y<1 EXIT S PSAPO=+Y,PSACON=$P($G(Y(0)),"^",12)
"RTN","PSAREC",17,0)
 S DIE="^PSD(58.8,",DA=PSALOC,DR="13///^S X="+PSAPO D ^DIE K DIE
"RTN","PSAREC",18,0)
PART D START G PO
"RTN","PSAREC",19,0)
 ;
"RTN","PSAREC",20,0)
EXIT K %,DA,DIE,DINUM,DIRUT,DR,DTOUT,DUOUT,PSA,PSA50SYN,PSACBAL,PSACHK,PSACNT,PSACOMB,PSACON,PSACOST,PSADASH,PSADRG,PSADRGN,PSADT,PSADUOU
"RTN","PSAREC",21,0)
 K PSAIEN,PSAIEN1,PSAISIT,PSAISITN,PSALEN,PSALINE,PSALOC,PSALOCN,PSANDC,PSANODE,PSANPDU,PSANPOU,PSAODASH,PSAONDC,PSAOSIT,PSAOSITN,PSAOU,PSAOUT
"RTN","PSAREC",22,0)
 K PSAPDU,PSAPO,PSAPOU,PSAPV,PSAREC,PSASEL,PSAT,PSATDRG,PSAVEND,X,Y
"RTN","PSAREC",23,0)
 Q
"RTN","PSAREC",24,0)
 ;
"RTN","PSAREC",25,0)
START S DIC="^PRCS(410,",DIC(0)="AEMQZ",DIC("A")="Select Pharmacy Transaction number: ",DIC("B")=$S($D(PSACON):$P($G(^PRCS(410,+PSACON,0)),"^"),1:""),DIC("S")="I $P($G(^(0)),""^"",2)=""O"",$P($G(^(3)),""^"",3)[822400"
"RTN","PSAREC",26,0)
 D ^DIC K DIC Q:Y<1  S PSACON=$S(Y>0:+Y,1:"")
"RTN","PSAREC",27,0)
 S DIR(0)="58.81,71O",DIR("A")="Invoice number",DIR("?")="The invoice will be stored, allowing look-ups for receipts against this invoice.",DIR("??")="^D INV^PSAREC"
"RTN","PSAREC",28,0)
 D ^DIR K DIR Q:Y'=""&($D(DIRUT))  S PSAPV=Y
"RTN","PSAREC",29,0)
 I $G(PSAPV)'="",$O(^PSD(58.81,"PV",Y,"")) D  Q:$D(DIRUT)  G:Y=1 DEV^PSAREPV
"RTN","PSAREC",30,0)
 .W !!,"Previous receipts have been processed for this invoice.",!! S DIR(0)="Y",DIR("A")="Would you like to review",DIR("B")="Yes" D ^DIR K DIR
"RTN","PSAREC",31,0)
 ;
"RTN","PSAREC",32,0)
DRUG W !!,$G(PSALOCN),!
"RTN","PSAREC",33,0)
 F  S DIC="^PSDRUG(",DIC(0)="AEMQ",DA(1)=PSALOC D  Q:PSAOUT
"RTN","PSAREC",34,0)
 .D ^DIC K DIC I Y<0 S PSAOUT=1 Q
"RTN","PSAREC",35,0)
 .D GETDATA Q:$G(PSAOUT)
"RTN","PSAREC",36,0)
 Q
"RTN","PSAREC",37,0)
 ;
"RTN","PSAREC",38,0)
GETDATA ;Gets receipts data
"RTN","PSAREC",39,0)
 S PSADRG=+Y,PSADRGN=$P($G(^PSDRUG(+Y,0)),"^"),PSACBAL=$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",4)
"RTN","PSAREC",40,0)
NDC S DIR(0)="FO^1:15",DIR("A")="NDC",DIR("?")="Enter the National Drug Code for the drug received.",DIR("??")="^D NDCHELP^PSAREC"
"RTN","PSAREC",41,0)
 D ^DIR K DIR
"RTN","PSAREC",42,0)
 I $G(DIRUT) S (PSADASH,PSADUOU,PSANDC,PSAOU,PSAPOU)="",PSA50SYN=0 G OU
"RTN","PSAREC",43,0)
 S:Y'="" PSADASH=Y
"RTN","PSAREC",44,0)
 I PSADASH["-" S PSANDC=$E("000000",1,(6-$L($P(PSADASH,"-"))))_$P(PSADASH,"-")_$E("0000",1,(4-$L($P(PSADASH,"-",2))))_$P(PSADASH,"-",2)_$E("00",1,(2-$L($P(PSADASH,"-",3))))_$P(PSADASH,"-",3)
"RTN","PSAREC",45,0)
 E  S PSANDC=""
"RTN","PSAREC",46,0)
 S:PSANDC'?12N PSANDC="" S (PSAOU,PSADUOU,PSAPOU)=""
"RTN","PSAREC",47,0)
 I PSANDC'="",$O(^PSDRUG("C",PSANDC,PSADRG,0)) D
"RTN","PSAREC",48,0)
 .S PSA50SYN=+$O(^PSDRUG("C",PSANDC,PSADRG,0))
"RTN","PSAREC",49,0)
 .Q:'$D(^PSDRUG(PSADRG,1,PSA50SYN,0))
"RTN","PSAREC",50,0)
 .S PSAOU=$P($G(^PSDRUG(PSADRG,1,PSA50SYN,0)),"^",5),PSADUOU=$P($G(^(0)),"^",7),PSAPOU=$P($G(^(0)),"^",6)
"RTN","PSAREC",51,0)
 E  S PSA50SYN=0
"RTN","PSAREC",52,0)
OU S DIC(0)="QAEMZ",DIC="^DIC(51.5,",DIC("A")="Order Unit: ",DR=.01 S:PSAOU DIC("B")=PSAOU D ^DIC K DIC
"RTN","PSAREC",53,0)
 I Y<0 S PSAOUT=1 Q
"RTN","PSAREC",54,0)
 S PSAOU=+Y
"RTN","PSAREC",55,0)
 W !,"Dispense Units: "_$S($P($G(^PSDRUG(PSADRG,660)),"^",8)'="":$P(^PSDRUG(PSADRG,660),"^",8),1:"Unknown")
"RTN","PSAREC",56,0)
DUOU S DIR(0)="NO",DIR("A")="Dispense Units per Order Unit" S:PSADUOU DIR("B")=PSADUOU
"RTN","PSAREC",57,0)
 S DIR("?")="Enter the number of dispense units contained in one order unit.",DIR("??")="^D DUOUHELP^PSAPROC3" D ^DIR K DIR
"RTN","PSAREC",58,0)
 I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAREC",59,0)
 S PSADUOU=+Y
"RTN","PSAREC",60,0)
PRICE S DIR(0)="NO^0:9999:4",DIR("A")="Price per Order Unit",DIR("?")="Enter the price for each order unit.",DIR("??")="^D PRICEHLP^PSAREC" S:PSAPOU DIR("B")=PSAPOU D ^DIR K DIR
"RTN","PSAREC",61,0)
 I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAREC",62,0)
 S PSAPOU=+Y S:+PSAPOU&(PSADUOU) PSAPDU=PSAPOU/PSADUOU
"RTN","PSAREC",63,0)
QTY S DIR(0)="N^0:9999999:0",DIR("A")="Quantity received",DIR("?")="Enter the number of order units you received.",DIR("??")="^D QTYHELP^PSAREC" D ^DIR K DIR
"RTN","PSAREC",64,0)
 I $D(DIRUT) S PSAOUT=1 Q
"RTN","PSAREC",65,0)
 S (PSAREC,PSAREC(1))=Y,PSAVEND=$P($G(^PRC(440,+$P($G(^PRC(442,PSAPO,1)),"^"),0)),"^"),PSACOST=PSAREC*PSAPOU,PSAREC=PSADUOU*PSAREC
"RTN","PSAREC",66,0)
DISP W ?50,"Converted quantity: ",PSAREC
"RTN","PSAREC",67,0)
 ;
"RTN","PSAREC",68,0)
 W ! S DIR(0)="Y",DIR("A")="Okay to post",DIR("B")="Yes",DIR("?",1)="Enter YES to add the received drug to the pharmacy location.",DIR("?")="Enter NO to cancel the receipt of the drug.",DIR("??")="^D POSTHELP^PSAREC"
"RTN","PSAREC",69,0)
 D ^DIR K DIR I $D(DIRUT) S PSAOUT=1 Q
"RTN","PSAREC",70,0)
 D:+Y POST^PSAREC1
"RTN","PSAREC",71,0)
 Q
"RTN","PSAREC",72,0)
 ;
"RTN","PSAREC",73,0)
CORRECT ;Extended help for 'Would you like to correct it'
"RTN","PSAREC",74,0)
 W !?5,"Enter YES to enter the current obligation number. It will be presented",!?5,"as the default the next time the obligation number prompt is displayed."
"RTN","PSAREC",75,0)
 W !!?5,"Enter NO to keep the current obligation number as the default."
"RTN","PSAREC",76,0)
 Q
"RTN","PSAREC",77,0)
 ;
"RTN","PSAREC",78,0)
INV ;Extended help for 'Invoice number'
"RTN","PSAREC",79,0)
 W !?5,"Enter the invoice number for the receipts."
"RTN","PSAREC",80,0)
 Q
"RTN","PSAREC",81,0)
NDCHELP ;Extended help for 'NDC'
"RTN","PSAREC",82,0)
 W !?5,"Enter the National Drug Code (NDC) for the received drug.",!?5,"Enter the NDC with dashes or 12-digits without dashes."
"RTN","PSAREC",83,0)
 Q
"RTN","PSAREC",84,0)
POSTHELP ;Extended help for 'Okay to post?'
"RTN","PSAREC",85,0)
 W !?5,"Enter YES to update the balances in the pharmacy location and DRUG file",!?5,"and add a transaction."
"RTN","PSAREC",86,0)
 W !?5,"Enter NO to abort receiving the drug."
"RTN","PSAREC",87,0)
 Q
"RTN","PSAREC",88,0)
PRICEHLP ;Extended help for 'Price per order unit'
"RTN","PSAREC",89,0)
 W !?5,"Enter the cost for each order unit."
"RTN","PSAREC",90,0)
 Q
"RTN","PSAREC",91,0)
QTYHELP ;
"RTN","PSAREC",92,0)
 W !?5,"The quantity entered will be multiplied by the dispense units",!?5,"per order unit to determine the number of dispense units received."
"RTN","PSAREC",93,0)
 Q
"RTN","PSAREC1")
0^73^B25107953
"RTN","PSAREC1",1,0)
PSAREC1 ;BIR/LTL,JMB-Receiving Directly into Drug Accountability - CONT'D  ;7/23/97
"RTN","PSAREC1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAREC1",3,0)
 ;This routine posts non-prime vendor's drugs into pharmacy locations.
"RTN","PSAREC1",4,0)
 ;The balances are incremented in the pharmacy location & the DRUG file.
"RTN","PSAREC1",5,0)
 ;
"RTN","PSAREC1",6,0)
POST ;Posts the data in 58.8, 58.81, and 50
"RTN","PSAREC1",7,0)
 D NOW^%DTC S PSADT=+$E(%,1,12) K %
"RTN","PSAREC1",8,0)
 I '$D(^PSD(58.8,PSALOC,1,PSADRG,0)) D
"RTN","PSAREC1",9,0)
 .S:'$D(^PSD(58.8,PSALOC,1,0)) DIC("P")=$P(^DD(58.8,10,0),"^",2)
"RTN","PSAREC1",10,0)
 .S DA(1)=PSALOC,DIC="^PSD(58.8,"_DA(1)_",1,",(DA,X)=PSADRG,DIC(0)="L",DLAYGO=58.8
"RTN","PSAREC1",11,0)
 .F  L +^PSD(58.8,PSALOC,0):0 I  Q
"RTN","PSAREC1",12,0)
 .D ^DIC L -^PSD(58.8,PSALOC,0) K DIC,DA
"RTN","PSAREC1",13,0)
 W !!,"There were ",$S($P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",4):$P($G(^(0)),"^",4),1:0)," on hand.",?40,"There are now ",$P($G(^(0)),"^",4)+PSAREC," on hand.",!
"RTN","PSAREC1",14,0)
 F  L +^PSD(58.8,PSALOC,1,PSADRG,0):0 I  Q
"RTN","PSAREC1",15,0)
 S $P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",4)=PSAREC+PSACBAL
"RTN","PSAREC1",16,0)
 L -^PSD(58.8,PSALOC,1,PSADRG,0)
"RTN","PSAREC1",17,0)
 ;
"RTN","PSAREC1",18,0)
MONTHLY I '$D(^PSD(58.8,PSALOC,1,PSADRG,5,$E(DT,1,5)*100,0)) D
"RTN","PSAREC1",19,0)
 .S:'$D(^PSD(58.8,PSALOC,1,PSADRG,5,0)) DIC("P")=$P(^DD(58.8001,28,0),"^",2)
"RTN","PSAREC1",20,0)
 .S DIC="^PSD(58.8,PSALOC,1,PSADRG,5,",DIC(0)="L",DIC("DR")="1////^S X=$G(PSACBAL)",(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSAREC1",21,0)
 .S X="T-1M" D ^%DT
"RTN","PSAREC1",22,0)
 .S DIC="^PSD(58.8,PSALOC,1,PSADRG,5,",DIC(0)="L",(X,DINUM)=$E(Y,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRG,DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO S DA=+Y
"RTN","PSAREC1",23,0)
 .S DIE="^PSD(58.8,PSALOC,1,PSADRG,5,",DA(2)=PSALOC,DA(1)=PSADRG,DR="3////^S X=$G(PSACBAL)" D ^DIE K DIE
"RTN","PSAREC1",24,0)
 S DIE="^PSD(58.8,"_PSALOC_",1,"_PSADRG_",5,",DA(2)=PSALOC,DA(1)=PSADRG,DA=$E(DT,1,5)*100,DR="5////^S X="_$P($G(^(0)),"^",3)+PSAREC D ^DIE
"RTN","PSAREC1",25,0)
 W !,"Updating monthly receipts and transaction history.",!
"RTN","PSAREC1",26,0)
TR F  L +^PSD(58.81,0):0 I  Q
"RTN","PSAREC1",27,0)
FIND S PSAT=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSAT)) S $P(^PSD(58.81,0),"^",3)=$P(^PSD(58.81,0),"^",3)+1 G FIND
"RTN","PSAREC1",28,0)
 S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAT D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSAREC1",29,0)
 S DIE="^PSD(58.81,",DA=PSAT,DR="1////1;2////^S X=PSALOC;3////^S X=PSADT;4////^S X=PSADRG;5////^S X=PSAREC;6////^S X=DUZ;7////^S X=PSACON;8////^S X=PSAPO;9////^S X=PSACBAL;71////^S X=$G(PSAPV)" D ^DIE
"RTN","PSAREC1",30,0)
 L -^PSD(58.81,0)
"RTN","PSAREC1",31,0)
 S:'$D(^PSD(58.8,PSALOC,1,PSADRG,4,0)) DIC("P")=$P(^DD(58.8001,19,0),"^",2)
"RTN","PSAREC1",32,0)
ACT S DIC="^PSD(58.8,PSALOC,1,PSADRG,4,",DIC(0)="L",(X,DINUM)=PSAT,DA(2)=PSALOC,DA(1)=PSADRG,DLAYGO=58.8
"RTN","PSAREC1",33,0)
 F  L +^PSD(58.8,PSALOC,0):0 I  Q
"RTN","PSAREC1",34,0)
 D ^DIC
"RTN","PSAREC1",35,0)
 L -^PSD(58.8,PSALOC,0) K DA,DIC,DINUM,DLAYGO
"RTN","PSAREC1",36,0)
 ;
"RTN","PSAREC1",37,0)
50 S (PSATDRG,PSA)=0 F  S PSA=$O(^PSD(58.8,"C",PSADRG,PSA)) Q:'PSA  D
"RTN","PSAREC1",38,0)
 .I PSA=PSALOC Q:PSACBAL<0  S PSATDRG=PSATDRG+PSACBAL Q
"RTN","PSAREC1",39,0)
 .I +$G(^PSD(58.8,PSA,"I")),+^PSD(58.8,PSA,"I")'>DT Q
"RTN","PSAREC1",40,0)
 .Q:$P($G(^PSD(58.8,PSA,0)),"^",2)'="M"&($P($G(^PSD(58.8,PSA,0)),"^",2)'="P")
"RTN","PSAREC1",41,0)
 .S PSATDRG=PSATDRG+$P($G(^PSD(58.8,PSA,1,PSADRG,0)),"^",4)
"RTN","PSAREC1",42,0)
 S PSANODE=$G(^PSDRUG(PSADRG,660))
"RTN","PSAREC1",43,0)
 I PSACBAL>0!(PSATDRG>0) D
"RTN","PSAREC1",44,0)
 .S PSACOST=PSACOST+(PSATDRG*+$P(PSANODE,"^",6)),PSATDRG=PSAREC+PSATDRG,PSANPDU=+$J((PSACOST/PSATDRG),0,3),PSANPOU=PSANPDU*PSADUOU
"RTN","PSAREC1",45,0)
 .S PSALEN=$L($P(PSANPOU,".")),PSANPOU=$J(PSANPOU,(PSALEN+3),2)
"RTN","PSAREC1",46,0)
 E  S PSATDRG=PSATDRG+PSACBAL,PSANPOU=PSAPOU,PSANPDU=PSAPDU
"RTN","PSAREC1",47,0)
 S DIE="^PSDRUG(",DA=PSADRG,DR="50////^S X="_(PSAREC+$G(^PSDRUG(PSADRG,660.1)))
"RTN","PSAREC1",48,0)
 F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAREC1",49,0)
 D ^DIE L -^PSDRUG(DA,0) K DIE,DA
"RTN","PSAREC1",50,0)
 S PSAODASH=$P($G(^PSDRUG(PSADRG,2)),"^",2)
"RTN","PSAREC1",51,0)
 S PSAONDC=$S(PSAODASH'="":$E("000000",1,(6-$L($P(PSAODASH,"-"))))_$P(PSAODASH,"-")_$E("0000",1,(4-$L($P(PSAODASH,"-",2))))_$P(PSAODASH,"-",2)_$E("00",1,(2-$L($P(PSAODASH,"-",3))))_$P(PSAODASH,"-",3),1:"")
"RTN","PSAREC1",52,0)
 I +PSANPDU=+$P(PSANODE,"^",6),PSANDC=PSAONDC,PSANDC'="" G NEXT
"RTN","PSAREC1",53,0)
 I ($P(PSANODE,"^",2)=PSAOU&($P(PSANODE,"^",5)=PSADUOU))!('$P(PSANODE,"^",2)&('$P(PSANODE,"^",5))) D
"RTN","PSAREC1",54,0)
 .I PSANDC'="",PSANDC'=PSAONDC D
"RTN","PSAREC1",55,0)
 ..S DIE="^PSDRUG(",DA=PSADRG,DR="31////^S X=PSADASH"
"RTN","PSAREC1",56,0)
 ..F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAREC1",57,0)
 ..D ^DIE L -^PSDRUG(DA,0) K DIE,DA
"RTN","PSAREC1",58,0)
 .I +PSANPDU,+PSANPDU'=+$P(PSANODE,"^",6),+PSANPOU D
"RTN","PSAREC1",59,0)
 ..S DIE="^PSDRUG(",DA=PSADRG,DR="13///^S X="_PSANPOU
"RTN","PSAREC1",60,0)
 ..F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAREC1",61,0)
 ..D ^DIE L -^PSDRUG(DA,0) K DIE,DA
"RTN","PSAREC1",62,0)
 .I '$P(PSANODE,"^",2),'$P(PSANODE,"^",5),PSAOU,PSADUOU D
"RTN","PSAREC1",63,0)
 ..S DIE="^PSDRUG(",DA=PSADRG,DR="12////^S X=PSAOU;15////^S X=PSADUOU"
"RTN","PSAREC1",64,0)
 ..F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAREC1",65,0)
 ..D ^DIE L -^PSDRUG(DA,0) K DIE,DA
"RTN","PSAREC1",66,0)
NEXT Q:$G(PSANDC)=""
"RTN","PSAREC1",67,0)
SYNONYM S PSADASH=$E(PSANDC,1,6)_"-"_$E(PSANDC,7,10)_"-"_$E(PSANDC,11,12)
"RTN","PSAREC1",68,0)
 S PSA50SYN=+$O(^PSDRUG("C",PSANDC,PSADRG,0))
"RTN","PSAREC1",69,0)
 K DA,DR S:'$D(^PSDRUG(PSADRG,1,0)) DIC("P")=$P(^DD(50,9,0),"^",2)
"RTN","PSAREC1",70,0)
 S DA(1)=PSADRG
"RTN","PSAREC1",71,0)
 I 'PSA50SYN!(PSA50SYN&('$D(^PSDRUG(PSADRG,1,PSA50SYN,0)))) D  Q:Y<0
"RTN","PSAREC1",72,0)
 .S DIC="^PSDRUG("_DA(1)_",1,",DIC(0)="LM",X=PSANDC,DLAYGO=50
"RTN","PSAREC1",73,0)
 .F  L +^PSDRUG(PSADRG,0):0 I  Q
"RTN","PSAREC1",74,0)
 .D ^DIC L -^PSDRUG(PSADRG,0) K DIC,DLAYGO S PSA50SYN=+Y
"RTN","PSAREC1",75,0)
 S DA=PSA50SYN,DIE="^PSDRUG("_DA(1)_",1,"
"RTN","PSAREC1",76,0)
 S DR="2////^S X=PSADASH;1////D"_$S(+PSAOU:";401////^S X=PSAOU",1:"")_$S(+PSAPOU:";402////^S X=PSAPOU",1:"")_";403////^S X=PSADUOU"_$S(+$G(PSAPDU):";404////^S X=PSAPDU",1:"")_$S(PSAVEND'="":";405///^S X=PSAVEND",1:"")
"RTN","PSAREC1",77,0)
 F  L +^PSDRUG(PSADRG,0):0 I  Q
"RTN","PSAREC1",78,0)
 D ^DIE L -^PSDRUG(PSADRG,0)
"RTN","PSAREC1",79,0)
 K DIE,DR
"RTN","PSAREC1",80,0)
 Q
"RTN","PSAREC1",81,0)
PRICEHLP ;Extended help for price per order unit
"RTN","PSAREC1",82,0)
 W !?5,"Enter the cost for each order unit."
"RTN","PSAREC1",83,0)
 Q
"RTN","PSAREORD")
0^74^B29683514
"RTN","PSAREORD",1,0)
PSAREORD ;BIR/JMB-Nightly Background Job - CONT'D ;7/23/97
"RTN","PSAREORD",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAREORD",3,0)
 ;This routine checks each pharmacy location for current balances less
"RTN","PSAREORD",4,0)
 ;than or equal to the reorder level. A list is sent to the holders of
"RTN","PSAREORD",5,0)
 ;the PSA ORDERS key. If the location is a master vault, the message
"RTN","PSAREORD",6,0)
 ;will include those CS drugs only if the user has the PSJ RPHARM key.
"RTN","PSAREORD",7,0)
 ;
"RTN","PSAREORD",8,0)
PHARM ;Looks for drugs that are >= reorder level in pharmacy locations.
"RTN","PSAREORD",9,0)
 K ^TMP("PSAMSGO",$J),^TMP("PSAREORD",$J) S (PSACNT,PSALOC)=0
"RTN","PSAREORD",10,0)
 F  S PSALOC=$O(^PSD(58.8,"ADISP","P",PSALOC)) Q:'PSALOC  D
"RTN","PSAREORD",11,0)
 .Q:'$P($G(^PSD(58.8,PSALOC,0)),"^",14)!('$D(^PSD(58.8,PSALOC,0)))
"RTN","PSAREORD",12,0)
 .I +$G(^PSD(58.8,PSALOC,"I")),+^PSD(58.8,PSALOC,"I")'>DT Q
"RTN","PSAREORD",13,0)
 .S PSAFIRST=1,PSADRG=0
"RTN","PSAREORD",14,0)
 .F  S PSADRG=+$O(^PSD(58.8,PSALOC,1,PSADRG)) Q:'PSADRG  D
"RTN","PSAREORD",15,0)
 ..S PSANODE=$G(^PSD(58.8,PSALOC,1,PSADRG,0)) Q:PSANODE=""
"RTN","PSAREORD",16,0)
 ..Q:+$P(PSANODE,"^",4)>+$P(PSANODE,"^",5)
"RTN","PSAREORD",17,0)
 ..Q:'+$P(PSANODE,"^",4)&('+$P(PSANODE,"^",5))
"RTN","PSAREORD",18,0)
 ..S PSANDC=$P($G(^PSDRUG(PSADRG,2)),"^",4) K PSALVSN D:PSANDC'="" NDC
"RTN","PSAREORD",19,0)
 ..S ^TMP("PSAORD",$J,PSALOC,$S($P($G(^PSDRUG(PSADRG,0)),"^")'="":$P(^PSDRUG(PSADRG,0),"^"),1:"UNKNOWN ("_PSADRG_")"))=+$P(PSANODE,"^",3)_"^"_+$P(PSANODE,"^",4)_"^"_$G(PSALVSN)
"RTN","PSAREORD",20,0)
 K PSALVSN
"RTN","PSAREORD",21,0)
 ;
"RTN","PSAREORD",22,0)
VAULT ;Looks for drugs that are >= reorder level in master vaults.
"RTN","PSAREORD",23,0)
 S PSALOC=0 F  S PSALOC=$O(^PSD(58.8,"ADISP","M",PSALOC)) Q:'PSALOC  D
"RTN","PSAREORD",24,0)
 .Q:'$P($G(^PSD(58.8,PSALOC,0)),"^",14)!('$D(^PSD(58.8,PSALOC,0)))
"RTN","PSAREORD",25,0)
 .I +$G(^PSD(58.8,PSALOC,"I")),+^PSD(58.8,PSALOC,"I")'>DT Q
"RTN","PSAREORD",26,0)
 .S PSAFIRST=1,PSADRG=0
"RTN","PSAREORD",27,0)
 .F  S PSADRG=$O(^PSD(58.8,PSALOC,1,PSADRG)) Q:'PSADRG  D
"RTN","PSAREORD",28,0)
 ..S PSANODE=$G(^PSD(58.8,PSALOC,1,PSADRG,0))
"RTN","PSAREORD",29,0)
 ..Q:PSANODE=""!(+$P(PSANODE,"^",4)>+$P(PSANODE,"^",5))
"RTN","PSAREORD",30,0)
 ..Q:'+$P(PSANODE,"^",4)&('+$P(PSANODE,"^",5))
"RTN","PSAREORD",31,0)
 ..S PSANDC=$P($G(^PSDRUG(PSADRG,2)),"^",4) K PSALVSN D:PSANDC'="" NDC
"RTN","PSAREORD",32,0)
 ..S ^TMP("PSAORDCS",$J,PSALOC,$S($P($G(^PSDRUG(PSADRG,0)),"^")'="":$P(^PSDRUG(PSADRG,0),"^"),1:"UNKNOWN ("_PSADRG_")"))=+$P(PSANODE,"^",3)_"^"_+$P(PSANODE,"^",4)_"^"_$G(PSALVSN)
"RTN","PSAREORD",33,0)
 K PSALVSN I '$O(^TMP("PSAORD",$J,0)),'$O(^TMP("PSAORDCS",$J,0)) G EXIT
"RTN","PSAREORD",34,0)
 ;
"RTN","PSAREORD",35,0)
NONCS ;Loops through the non-controlled subs to create mail message text.
"RTN","PSAREORD",36,0)
 G:'$O(^TMP("PSAORD",$J,0)) CS K PSA S (PSACNT,PSALOC)=0
"RTN","PSAREORD",37,0)
 F  S PSALOC=$O(^TMP("PSAORD",$J,PSALOC)) Q:'PSALOC  D
"RTN","PSAREORD",38,0)
 .S PSAFIRST=1,PSADRG=""
"RTN","PSAREORD",39,0)
 .F  S PSADRG=$O(^TMP("PSAORD",$J,PSALOC,PSADRG)) Q:PSADRG=""  D
"RTN","PSAREORD",40,0)
 ..S PSASTOCK=$P(^TMP("PSAORD",$J,PSALOC,PSADRG),"^"),PSABAL=$P(^(PSADRG),"^",2),PSAVSN=$P(^(PSADRG),"^",3) D SETMSG
"RTN","PSAREORD",41,0)
 G:'$D(^XUSEC("PSJ RPHARM",DUZ))!('$O(^TMP("PSAORDCS",$J,0))) SEND
"RTN","PSAREORD",42,0)
 ;
"RTN","PSAREORD",43,0)
CS ;Loops through the controlled subs to create mail message text.
"RTN","PSAREORD",44,0)
 S PSALOC=0 F  S PSALOC=$O(^TMP("PSAORDCS",$J,PSALOC)) Q:'PSALOC  D
"RTN","PSAREORD",45,0)
 .S PSAFIRST=1,PSADRG=""
"RTN","PSAREORD",46,0)
 .F  S PSADRG=$O(^TMP("PSAORDCS",$J,PSALOC,PSADRG)) Q:PSADRG=""  D
"RTN","PSAREORD",47,0)
 ..S PSASTOCK=$P(^TMP("PSAORDCS",$J,PSALOC,PSADRG),"^"),PSABAL=$P(^(PSADRG),"^",2) D SETMSG
"RTN","PSAREORD",48,0)
 ;
"RTN","PSAREORD",49,0)
SEND ;Send the mail message to the holders of the PSA ORDERS key.
"RTN","PSAREORD",50,0)
 S XMTEXT="^TMP(""PSAMSGO"",$J,",XMDUZ="Drug Accountability System",XMSUB="Drug Balances Below Reorder Level"
"RTN","PSAREORD",51,0)
 S PSADUZ=0 F  S PSADUZ=$O(^XUSEC("PSA ORDERS",PSADUZ)) Q:'PSADUZ  S XMY(PSADUZ)=""
"RTN","PSAREORD",52,0)
 G:'$D(XMY) QUIT D ^XMD
"RTN","PSAREORD",53,0)
QUIT K XMY,^TMP("PSAMSGO",$J)
"RTN","PSAREORD",54,0)
 Q
"RTN","PSAREORD",55,0)
 ;
"RTN","PSAREORD",56,0)
NDC ;Gets VSN dispense units,dispense units/order unit, order unit for
"RTN","PSAREORD",57,0)
 ;^TMP global
"RTN","PSAREORD",58,0)
 K PSASYN,PSAVSN,PSAOU,PSADUOU,PSADU,PSALVSN
"RTN","PSAREORD",59,0)
 S PSANDC=$E("000000",1,(6-$L($P(PSANDC,"-"))))_$P(PSANDC,"-")_$E("0000",1,(4-$L($P(PSANDC,"-",2))))_$P(PSANDC,"-",2)_$E("00",1,(2-$L($P(PSANDC,"-",3))))_$P(PSANDC,"-",3)
"RTN","PSAREORD",60,0)
 S PSASYN=+$O(^PSDRUG("C",PSANDC,PSADRG,0)) Q:'PSASYN!('$D(^PSDRUG(PSADRG,1,PSASYN,0)))
"RTN","PSAREORD",61,0)
 S PSAVSN=$P(^PSDRUG(PSADRG,1,PSASYN,0),"^",4),PSAOU=$S(+$P(^(0),"^",5):$P($G(^DIC(51.5,+$P(^(0),"^",5),0)),"^"),1:"")
"RTN","PSAREORD",62,0)
 S PSADUOU=$S(+$P(^PSDRUG(PSADRG,1,PSASYN,0),"^",7):+$P(^(0),"^",7),1:""),PSADU=$P($G(^PSDRUG(PSADRG,660)),"^",8)
"RTN","PSAREORD",63,0)
 Q:PSAVSN=""
"RTN","PSAREORD",64,0)
 S PSALVSN="VSN: "_PSAVSN I PSAOU'="",+PSADUOU,PSADU'="" S PSALVSN=PSALVSN_" "_PSADUOU_" "_PSADU_"/"_PSAOU
"RTN","PSAREORD",65,0)
 K PSASYN,PSAVSN,PSAOU,PSADUOU,PSADU
"RTN","PSAREORD",66,0)
 Q
"RTN","PSAREORD",67,0)
SETMSG ;Creates the body of the mail message.
"RTN","PSAREORD",68,0)
 I PSAFIRST D
"RTN","PSAREORD",69,0)
 .I PSACNT'=0 S PSACNT=PSACNT+1,^TMP("PSAMSGO",$J,PSACNT)="=============================================================================",PSACNT=PSACNT+1,^TMP("PSAMSGO",$J,PSACNT)=" "
"RTN","PSAREORD",70,0)
 .K PSALOCA D SITES^PSAUTL1 S PSALOCA($P(^PSD(58.8,PSALOC,0),"^")_PSACOMB,PSALOC)=PSAISIT_"^"_PSAOSIT,PSALOCN=$O(PSALOCA("")),PSAFIRST=0
"RTN","PSAREORD",71,0)
 .S PSACNT=PSACNT+1,PSACNT(PSACNT)=$S($P(^PSD(58.8,PSALOC,0),"^",2)="P":"PHARMACY LOCATION",1:"MASTER VAULT")
"RTN","PSAREORD",72,0)
 .I $L(PSALOCN)>76 S PSACNT=PSACNT+1,^TMP("PSAMSGO",$J,PSACNT)=$P(PSALOCN,"(IP)",1)_"(IP)" S PSACNT=PSACNT+1,^TMP("PSAMSGO",$J,PSACNT)="                 "_$P(PSALOCN,"(IP)",2)
"RTN","PSAREORD",73,0)
 .I $L(PSALOCN)<77 S PSACNT=PSACNT+1,^TMP("PSAMSGO",$J,PSACNT)=PSALOCN
"RTN","PSAREORD",74,0)
 .S PSACNT=PSACNT+1,^TMP("PSAMSGO",$J,PSACNT)="                                           Stock    Current    Amount to"
"RTN","PSAREORD",75,0)
 .S PSACNT=PSACNT+1,^TMP("PSAMSGO",$J,PSACNT)="Drug Name:                                 Level    Balance        Order"
"RTN","PSAREORD",76,0)
 .S PSACNT=PSACNT+1,^TMP("PSAMSGO",$J,PSACNT)="-----------------------------------------------------------------------------"
"RTN","PSAREORD",77,0)
 S PSALEN=$L(PSADRG),PSASPACE=$E("                                        ",1,(42-PSALEN))
"RTN","PSAREORD",78,0)
 S PSACNT=PSACNT+1,^TMP("PSAMSGO",$J,PSACNT)=PSADRG_PSASPACE_$J(PSASTOCK,6,0)_"     "_$J(PSABAL,6,0)_"       "_$S((PSASTOCK-PSABAL)>.001:$J((PSASTOCK-PSABAL),6,0),1:"   N/A")
"RTN","PSAREORD",79,0)
 S PSACNT=PSACNT+1 S:PSAVSN'="" ^TMP("PSAMSGO",$J,PSACNT)="  "_PSAVSN
"RTN","PSAREORD",80,0)
 Q
"RTN","PSAREORD",81,0)
 ;
"RTN","PSAREORD",82,0)
EXIT ;Kills the variables & TMP globals.
"RTN","PSAREORD",83,0)
 K ^TMP("PSAMSGO",$J),^TMP("PSAORD",$J),^TMP("PSAORDCS",$J)
"RTN","PSAREORD",84,0)
 K PSA,PSABAL,PSACNT,PSACOMB,PSADRG,PSAFIRST,PSAISIT,PSALEN,PSALOC,PSALOCA,PSALOCN,PSANODE,PSAOSIT,PSAISITN,PSAOSITN,PSASPACE,PSASTOCK,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","PSAREORD",85,0)
 Q
"RTN","PSAREPV")
0^75^B8564816
"RTN","PSAREPV",1,0)
PSAREPV ;BIR/LTL,JMB-Invoice Review ;7/23/97
"RTN","PSAREPV",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAREPV",3,0)
 ;This routine reviews prime vendor receipt transactions in GIP.
"RTN","PSAREPV",4,0)
 ;
"RTN","PSAREPV",5,0)
 N DIC,DIR,DTOUT,DUOUT,PSA,PSALOC,PSAOUT,X,Y
"RTN","PSAREPV",6,0)
 D DT^DICRW
"RTN","PSAREPV",7,0)
 S DIC="^PSD(58.81,",DIC(0)="AEQS",D="PV",DIC("A")="Please select Prime Vendor Invoice number: "
"RTN","PSAREPV",8,0)
 D IX^DIC K DIC S PSA=+Y,PSA(2)=$P($G(^PSD(58.81,+Y,8)),"^") I Y<0 S PSAOUT=1 G END
"RTN","PSAREPV",9,0)
 I $P($G(^PSD(58.81,+Y,8)),"^")']"" S PSAOUT=1 G END
"RTN","PSAREPV",10,0)
DEV ;asks device and queueing info
"RTN","PSAREPV",11,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" S PSAOUT=1 G END
"RTN","PSAREPV",12,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSAREPV",ZTDESC="Invoice receipt review",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSAREPV",13,0)
START ;compiles and prints output
"RTN","PSAREPV",14,0)
 N %DT,PSALN,PSAPG,PSARPDT S (PSAPG,PSAOUT)=0,Y=DT,PSA(1)="" X ^DD("DD") S PSARPDT=Y D HEADER
"RTN","PSAREPV",15,0)
LOOP F  S PSA(1)=$O(^PSD(58.81,"PV",PSA(2),PSA(1))) G:$G(PSAOUT)!('PSA(1)) END D:$Y+5>IOSL HEADER G:PSAOUT END D
"RTN","PSAREPV",16,0)
 .I '$D(PSALOC) S PSALOC=$P($G(^PSD(58.81,+PSA(1),0)),"^",3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+PSALOC,0)),"^"),!
"RTN","PSAREPV",17,0)
 .I $G(PSALOC)'=$P($G(^PSD(58.81,+PSA(1),0)),"^",3) S PSALOC=$P($G(^(0)),"^",3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+$P($G(^PSD(58.81,+PSA(1),0)),"^",3),0)),"^"),!
"RTN","PSAREPV",18,0)
 .S Y=$P($G(^PSD(58.81,+PSA(1),0)),"^",4) X ^DD("DD") W !,Y,"  ",$E($P($G(^PSDRUG(+$P($G(^PSD(58.81,+PSA(1),0)),"^",5),0)),"^"),1,25)," => "
"RTN","PSAREPV",19,0)
 .W $P($G(^PSD(58.81,+PSA(1),0)),"^",6)," rec'd by ",$E($P($G(^VA(200,+$P($G(^PSD(58.81,+PSA(1),0)),"^",7),0)),"^"),1,20),!
"RTN","PSAREPV",20,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSAREPV",21,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu. " D ^DIR
"RTN","PSAREPV",22,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAREPV",23,0)
 Q
"RTN","PSAREPV",24,0)
HEADER ;prints header info
"RTN","PSAREPV",25,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAREPV",26,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),"^"),"." S PSAOUT=1 Q
"RTN","PSAREPV",27,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !,"History of receipts for Invoice # ",PSA(2),?57,PSARPDT,?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAREPV",28,0)
 Q
"RTN","PSAREV")
0^76^B8979963
"RTN","PSAREV",1,0)
PSAREV ;BIR/LTL-Purchase Order Review ;7/23/97
"RTN","PSAREV",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAREV",3,0)
 ;This routine reviews receipt transactions.
"RTN","PSAREV",4,0)
 ;
"RTN","PSAREV",5,0)
 N DIC,DIR,DTOUT,DUOUT,PSALOC,PSAOUT,PSAPO,X,Y
"RTN","PSAREV",6,0)
 S DIC="^PRC(442,",DIC(0)="AEMQZ",DIC("A")="Please Select Purchase Order Number: ",DIC("S")="I $P($G(^(0)),U,5)[822400",PSAOUT=1 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END S PSAPO=+Y
"RTN","PSAREV",7,0)
 I '$O(^PSD(58.81,"C",+Y,"")) W !!,"There have been no receipts for this Purchase Order.",!! G END
"RTN","PSAREV",8,0)
DEV ;asks device and queueing info
"RTN","PSAREV",9,0)
 K IO("Q"),PSALOC N %ZIS,IOP,POP S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSAREV",10,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSAREV",ZTDESC="Receipt transaction review",ZTSAVE("PSAPO")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSAREV",11,0)
START ;compiles and prints output
"RTN","PSAREV",12,0)
 N %DT,PSALN,PSAR,PSAPG,PSARPDT S (PSAPG,PSAOUT)=0,Y=DT,PSAR="" X ^DD("DD") S PSARPDT=Y D HEADER
"RTN","PSAREV",13,0)
LOOP F  S PSAR=$O(^PSD(58.81,"C",PSAPO,PSAR)) G:'PSAR END D:$Y+5>IOSL HEADER G:PSAOUT END D
"RTN","PSAREV",14,0)
 .I '$D(PSALOC) S PSALOC=$P($G(^PSD(58.81,+PSAR,0)),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+PSALOC,0)),U),!
"RTN","PSAREV",15,0)
 .I $G(PSALOC)'=$P($G(^PSD(58.81,+PSAR,0)),U,3) S PSALOC=$P($G(^(0)),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+$P($G(^PSD(58.81,+PSAR,0)),U,3),0)),U),!
"RTN","PSAREV",16,0)
 .S Y=$P($G(^PSD(58.81,+PSAR,0)),U,4) X ^DD("DD") W !,Y,"  ",$E($P($G(^PSDRUG(+$P($G(^PSD(58.81,PSAR,0)),U,5),0)),U),1,25)," -> "
"RTN","PSAREV",17,0)
 .W $P($G(^PSD(58.81,+PSAR,0)),U,6)," rec'd by ",$E($P($G(^VA(200,+$P($G(^PSD(58.81,+PSAR,0)),U,7),0)),U),1,20),!
"RTN","PSAREV",18,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSAREV",19,0)
 I $E(IOST,1,2)="C-",'PSAOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSAREV",20,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAREV",21,0)
 Q
"RTN","PSAREV",22,0)
HEADER ;prints header info
"RTN","PSAREV",23,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAREV",24,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAREV",25,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !?2,"History of receipts for P.O.# ",$P($G(^PRC(442,+PSAPO,0)),U),?50,PSARPDT,?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAREV",26,0)
 Q
"RTN","PSAREVC")
0^77^B12087001
"RTN","PSAREVC",1,0)
PSAREVC ;BIR/LTL-Control Point Transaction Review ;7/23/97
"RTN","PSAREVC",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAREVC",3,0)
 ;
"RTN","PSAREVC",4,0)
 W !!,"Because of the size of this file, look-ups of less than four characters",!!,"are NOT advised.  Please enter either the entire transaction number,",!!,"Station-FY-QTR-Control Point-Sequence Number, or at least the four digit"
"RTN","PSAREVC",5,0)
 W !!,"Sequence Number.",!!
"RTN","PSAREVC",6,0)
 N DIC,DIR,DTOUT,DUOUT,PSACON,PSALOC,PSAOUT,X,Y
"RTN","PSAREVC",7,0)
 S DIC="^PRCS(410,",DIC(0)="AEMQ",DIC("A")="Please select Control Point Transaction: ",DIC("S")="I $P($G(^(0)),U,2)=""O"",$P($G(^(3)),U,3)[822400",PSAOUT=1 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END S PSACON=+Y
"RTN","PSAREVC",8,0)
 I '$O(^PSD(58.81,"E",+PSACON,"")) W !!,"There are no receipts for this Transaction.",!! G END
"RTN","PSAREVC",9,0)
DEV ;asks device and queueing info
"RTN","PSAREVC",10,0)
 K IO("Q"),PSALOC N %ZIS,IOP,POP S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSAREVC",11,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSAREVC",ZTDESC="Receipt transaction review",ZTSAVE("PSACON")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSAREVC",12,0)
START ;compiles and prints output
"RTN","PSAREVC",13,0)
 N %DT,PSALN,PSAR,PSAPG,PSARPDT S (PSAPG,PSAOUT)=0,Y=DT,PSAR="" X ^DD("DD") S PSARPDT=Y D HEADER
"RTN","PSAREVC",14,0)
LOOP F  S PSAR=$O(^PSD(58.81,"E",+PSACON,PSAR)) G:'PSAR END D:$Y+5>IOSL HEADER G:PSAOUT END D
"RTN","PSAREVC",15,0)
 .I '$D(PSALOC) S PSALOC=$P($G(^PSD(58.81,+PSAR,0)),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+PSALOC,0)),U),!
"RTN","PSAREVC",16,0)
 .I $G(PSALOC)'=$P($G(^PSD(58.81,+PSAR,0)),U,3) S PSALOC=$P($G(^(0)),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+$P($G(^PSD(58.81,+PSAR,0)),U,3),0)),U),!
"RTN","PSAREVC",17,0)
 .S Y=$P($G(^PSD(58.81,+PSAR,0)),U,4) X ^DD("DD") W !,Y,"  ",$E($P($G(^PSDRUG(+$P($G(^PSD(58.81,PSAR,0)),U,5),0)),U),1,25)," -> "
"RTN","PSAREVC",18,0)
 .W $P($G(^PSD(58.81,+PSAR,0)),U,6)," rec'd by ",$E($P($G(^VA(200,+$P($G(^PSD(58.81,+PSAR,0)),U,7),0)),U),1,20),!
"RTN","PSAREVC",19,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSAREVC",20,0)
 I $E(IOST,1,2)="C-",'PSAOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSAREVC",21,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAREVC",22,0)
 Q
"RTN","PSAREVC",23,0)
HEADER ;prints header info
"RTN","PSAREVC",24,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAREVC",25,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAREVC",26,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !,"History of receipts for Transaction # ",$P($G(^PRCS(410,+PSACON,0)),U),?57,PSARPDT,?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAREVC",27,0)
 Q
"RTN","PSAREVD")
0^78^B14354651
"RTN","PSAREVD",1,0)
PSAREVD ;BIR/LTL-Drug Receipt History Review ;7/23/97
"RTN","PSAREVD",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAREVD",3,0)
 ;This routine reviews receipt transactions for a drug.
"RTN","PSAREVD",4,0)
 ;
"RTN","PSAREVD",5,0)
 N DIC,DIR,DTOUT,DUOUT,PSA,PSACNT,PSALOCN,PSAR,PSAU,PSAOUT,PSAT,X,Y S PSAOUT=1,PSAU=0
"RTN","PSAREVD",6,0)
LOOK D ^PSADA I '$G(PSALOC) S PSAOUT=1 G END
"RTN","PSAREVD",7,0)
 I '$O(^PSD(58.8,PSALOC,1,0)) W !!,"There are no drugs in ",PSALOCN G END
"RTN","PSAREVD",8,0)
 S PSACNT=0 W !!,"You may select one, several, or ^ALL drugs.",!
"RTN","PSAREVD",9,0)
CHKD F  S DIC="^PSD(58.8,+PSALOC,1,",DIC(0)="AEMQ",DIC("A")="Please Select "_PSALOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('PSACNT) END Q:Y<0  S PSA(+Y)="",PSACNT=PSACNT+1
"RTN","PSAREVD",10,0)
 I PSACNT=1&('$O(^PSD(58.81,"F",+$O(PSA(0)),0))) W !!,"There have been no receipts for this drug.",!! G END
"RTN","PSAREVD",11,0)
 I X="^ALL" F  S PSAU=$O(^PSD(58.8,+PSALOC,1,PSAU)) Q:'PSAU  S PSA(PSAU)=""
"RTN","PSAREVD",12,0)
 S DIR(0)="D:AEP",DIR("A")="How far back in time do you want to go? ",DIR("B")="T-6M",DIR("?")="I will list receipts for your selected drug(s) within the last six months if you press return" W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSAREVD",13,0)
 S PSAT=Y
"RTN","PSAREVD",14,0)
DEV ;asks device and queueing info
"RTN","PSAREVD",15,0)
 K IO("Q"),PSALOC N %ZIS,IOP,POP S %ZIS="0Q" W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSAREVD",16,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSAREVD",ZTDESC="Drug receipt transaction review",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSAREVD",17,0)
START ;compiles and prints output
"RTN","PSAREVD",18,0)
 N %DT,PSALN,PSAR,PSAPG,PSARPDT S (PSAPG,PSAOUT)=0,Y=DT,PSAR="" X ^DD("DD") S PSARPDT=Y,PSAU(1)=$O(PSA(0)) D HEADER S PSAU=0
"RTN","PSAREVD",19,0)
 F  S PSAU=$O(PSA(PSAU)) Q:'PSAU  K PSAR(1) D  G:PSAOUT END I 'PSAR,$O(PSA(PSAU)) S PSAU(1)=$O(PSA(PSAU))
"RTN","PSAREVD",20,0)
LOOP .F  S PSAR=$O(^PSD(58.81,"F",PSAU,PSAR)) Q:'PSAR  D:$Y+6>IOSL HEADER Q:PSAOUT  S PSAR(2)=$G(^PSD(58.81,+PSAR,0)) D:$P(PSAR(2),U,4)'<PSAT&($P(PSAR(2),U,2)=1)
"RTN","PSAREVD",21,0)
 ..S PSAR(1)=$G(PSAR(1))+1 W:PSAR(1)=1 $P($G(^PSDRUG(+PSAU,0)),U),!
"RTN","PSAREVD",22,0)
 ..I '$D(PSALOC) S PSALOC=$P(PSAR(2),U,3) W !,"Receiving Site: ",$P($G(^PSD(58.8,+PSALOC,0)),U),!
"RTN","PSAREVD",23,0)
 ..I $G(PSALOC)'=$P(PSAR(2),U,3) S PSALOC=$P(PSAR(2),U,3) W !,"Receiving site: ",$P($G(^PSD(58.8,+PSALOC,0)),U),!
"RTN","PSAREVD",24,0)
 ..S Y=$E($P(PSAR(2),U,4),1,12) X ^DD("DD") W !,Y,"   -> "
"RTN","PSAREVD",25,0)
 ..W $P(PSAR(2),U,6)," received by ",$P($G(^VA(200,+$P(PSAR(2),U,7),0)),U),!!
"RTN","PSAREVD",26,0)
 ..W:$P($G(^PRC(442,+$P(PSAR(2),U,9),0)),U) "PO#:  ",$P($G(^(0)),U),?20
"RTN","PSAREVD",27,0)
 ..W:$P($G(^PRCS(410,+$P(PSAR(2),U,8),0)),U) "TR#:  ",$P($G(^(0)),U),"  "
"RTN","PSAREVD",28,0)
 ..W:$P($G(^PSD(58.81,+PSAR,8)),U)]"" "INV#:  ",$P($G(^(8)),U)
"RTN","PSAREVD",29,0)
 ..W !,PSALN,!
"RTN","PSAREVD",30,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSAREVD",31,0)
 I $E(IOST,1,2)="C-",'PSAOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSAREVD",32,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAREVD",33,0)
 Q
"RTN","PSAREVD",34,0)
HEADER ;prints header info
"RTN","PSAREVD",35,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAREVD",36,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAREVD",37,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !?2,"History of Drug Receipts",?50,PSARPDT,?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAREVD",38,0)
 Q
"RTN","PSARIN")
0^79^B13046992
"RTN","PSARIN",1,0)
PSARIN ;BIR/LTL-Loadable Inventory Items Report ;7/23/97
"RTN","PSARIN",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSARIN",3,0)
 ;This routine reports the inventory/DA items.
"RTN","PSARIN",4,0)
 ;
"RTN","PSARIN",5,0)
SETUP N D0,D1,DA,DIE,DIC,DIR,DIRUT,DLAYGO,DR,DTOUT,DUOUT,PSADRUG,PSAINV,PSAOUT,X,Y
"RTN","PSARIN",6,0)
 ;LOOK UP LOCATION
"RTN","PSARIN",7,0)
LOOK D ^PSADA I '$G(PSALOC) S PSAOUT=1 G QUIT
"RTN","PSARIN",8,0)
NOINV I '$O(^PSD(58.8,+PSALOC,4,0)) W !,$G(PSALOCN)_" is not linked to an Inventory Point.",! D  G:$G(PSAOUT) QUIT
"RTN","PSARIN",9,0)
 .S DIR(0)="Y",DIR("A")="Would you like to attempt a link now",DIR("B")="Yes" D ^DIR K DIR S:Y'=1 PSAOUT=1 Q:Y'=1  D  I $D(Y)!('$G(PSAINV)) S PSAOUT=1 Q
"RTN","PSARIN",10,0)
INV ..S DIE=58.8,DA=PSALOC,DR="[PSAGIP]" D ^DIE K DIE
"RTN","PSARIN",11,0)
DEV K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSAOUT=1 G QUIT
"RTN","PSARIN",12,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSARIN",ZTDESC="Inventory items to load into DA Location",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G QUIT
"RTN","PSARIN",13,0)
START N %DT,PSALN,PSAIT,PSAL,PSAD,PSAPG,PSARPDT,X,Y S (PSAPG,PSAOUT)=0,Y=DT D DD^%DT S PSARPDT=Y,PSAIT=0
"RTN","PSARIN",14,0)
 S PSAD="W !!,PSAIT,?10,$E($$DESCR^PRCPUX1(PSAINV,PSAIT),1,33),?45,$E($P(^PSDRUG($O(^PSDRUG(""AB"",PSAIT,0)),0),U),1,34)"
"RTN","PSARIN",15,0)
 S PSAINV=$O(^PSD(58.8,+PSALOC,4,0))
"RTN","PSARIN",16,0)
 I $O(^PSD(58.8,+PSALOC,4,+PSAINV)) D  S:Y<1 PSAOUT=1 G QUIT
"RTN","PSARIN",17,0)
 .S DIC="^PSD(58.8,+PSALOC,4,",DIC(0)="AEMQ",DA(1)=PSALOC D ^DIC K DIC
"RTN","PSARIN",18,0)
 .S PSAINV=+Y
"RTN","PSARIN",19,0)
 D HEADER
"RTN","PSARIN",20,0)
LOOP F  S PSAIT=$O(^PRCP(445,PSAINV,1,PSAIT)) Q:'PSAIT  D:$Y+4>IOSL HEADER Q:PSAOUT  I '$G(^PRC(441,PSAIT,3)),$O(^PSDRUG("AB",PSAIT,"")) S PSADRUG=$O(^PSDRUG("AB",PSAIT,"")) D:'$D(^PSD(58.8,PSALOC,1,PSADRUG,0))
"RTN","PSARIN",21,0)
 .S PSADRUG(1)=PSADRUG
"RTN","PSARIN",22,0)
 .I $S('$D(^PSDRUG(PSADRUG,"I")):1,+^("I")>DT:1,1:0) X PSAD W !!,"Inventory balance:  " S PSAIT(1)=$G(^PRCP(445,+PSAINV,1,+PSAIT,0)) D
"RTN","PSARIN",23,0)
 ..W $P(PSAIT(1),U,7)," ",$$UNITCODE^PRCPUX1($P(PSAIT(1),U,5))," times dispensing unit conv factor = ",$P(PSAIT(1),U,7)*$S($P(PSAIT(1),U,29):$P(PSAIT(1),U,29),1:1)," ",$P(PSAIT(1),U,28)
"RTN","PSARIN",24,0)
QUIT I $E(IOST)'="C" W @IOF
"RTN","PSARIN",25,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSARIN",26,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSARIN",27,0)
 K PSAIT Q
"RTN","PSARIN",28,0)
HEADER I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSARIN",29,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSARIN",30,0)
 S PSAINV(1)=$E($P(^PSD(58.8,PSALOC,0),U),1,10)
"RTN","PSARIN",31,0)
 S:$E(PSAINV(1),10)="(" PSAINV(1)=$E(PSAINV(1),1,9)
"RTN","PSARIN",32,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !,$E($$INVNAME^PRCPUX1(PSAINV),1,24)_" items to load into "_PSAINV(1),?56,PSARPDT,?70,"PAGE: "_PSAPG,!,PSALN,!,"ITEM",?10,"DESCRIPTION",?50,"DRUG FILE LINK"
"RTN","PSARIN",33,0)
 Q
"RTN","PSARWS")
0^80^B16594818
"RTN","PSARWS",1,0)
PSARWS ;BIR/LTL,JMB-Collects Ward Stock Data ;7/23/97
"RTN","PSARWS",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSARWS",3,0)
 ;This routine gathers AR/WS dispensing data. It is called by PSGWUAS.
"RTN","PSARWS",4,0)
 ;
"RTN","PSARWS",5,0)
 N D0,DR,DA,DIC,DIE,DLAYGO,PSA,PSAB,PSAD,PSADT,PSASIT,PSAT,PSADRUG,PSALOC,PSAQTY,PSADA,PSADAL,PSAPS,X,Y S (PSAPS,PSA)=0,PSADA=""
"RTN","PSARWS",6,0)
 ;get date dispensed,site(aou),drug,qty
"RTN","PSARWS",7,0)
 F  S PSA=$O(^PSI(58.5,"AMIS",PSA)),(PSADT,PSA(1),PSASIT,PSADRUG,PSAQTY)="" Q:'PSA  S PSADT=$O(^PSI(58.5,"AMIS",PSA,PSADT)) Q:'PSADT  S PSA(1)=$O(^PSI(58.5,"AMIS",PSA,PSADT,PSA(1))) Q:PSA(1)']""  D
"RTN","PSARWS",8,0)
 .S PSASIT=$O(^PSI(58.5,"AMIS",PSA,PSADT,PSA(1),PSASIT)) Q:'PSASIT!('$P($G(^PS(59.4,+$G(^PSI(58.1,+PSASIT,"SITE")),0)),U,26))  S PSASIT(1)=$G(^PSI(58.1,PSASIT,"SITE"))
"RTN","PSARWS",9,0)
 .S PSADRUG=$O(^PSI(58.5,"AMIS",PSA,PSADT,PSA(1),PSASIT,PSADRUG))
"RTN","PSARWS",10,0)
 .;drug stocked by any primary DA location?
"RTN","PSARWS",11,0)
 .Q:'PSADRUG!('$O(^PSD(58.8,"C",+PSADRUG,0)))
"RTN","PSARWS",12,0)
 .S (PSAPS,PSADA)=0
"RTN","PSARWS",13,0)
 .;If the location is active, the drug is tracked, & it is tracked in an
"RTN","PSARWS",14,0)
 .;inpatient site, set the PSADA(PSAPS) array.
"RTN","PSARWS",15,0)
 .F  S PSADA=$O(^PSD(58.8,"C",+PSADRUG,PSADA)) Q:'PSADA  I $G(^PSD(58.8,+PSADA,"I"))="",$P($G(^PSD(58.8,+PSADA,0)),U,2)="P",+$P($G(^PSD(58.8,+PSADA,0)),U,3) S PSAPS=PSAPS+1,PSADA(PSAPS)=PSADA
"RTN","PSARWS",16,0)
 .Q:'PSAPS
"RTN","PSARWS",17,0)
 .S PSAQTY=$O(^PSI(58.5,"AMIS",PSA,PSADT,PSA(1),PSASIT,PSADRUG,0))
"RTN","PSARWS",18,0)
 .S:PSA(1)="R" PSAQTY=-PSAQTY
"RTN","PSARWS",19,0)
 .;drug stocked by only one DA location
"RTN","PSARWS",20,0)
 .I PSAPS=1 D  S ^TMP("PSAR",$J,PSADRUG,PSADA(PSAPS))=PSAQTY+$G(^TMP("PSAR",$J,PSADRUG,PSADA(PSAPS))) Q
"RTN","PSARWS",21,0)
 .Q:'$D(^PSD(58.8,"ASITE",+PSASIT(1),"P"))
"RTN","PSARWS",22,0)
 .;more than one, check site
"RTN","PSARWS",23,0)
 .S (PSAPS,PSAPS(1))=0 F  S PSAPS(1)=$O(PSADA(PSAPS(1))) Q:'PSAPS(1)!(PSADA(PSAPS(1))=$O(^PSD(58.8,"ASITE",+PSASIT(1),"P",0)))
"RTN","PSARWS",24,0)
 .;don't use AR conversion
"RTN","PSARWS",25,0)
 .S PSADA=PSADA(PSAPS(1)),^TMP("PSAR",$J,PSADRUG,PSADA)=PSAQTY+$G(^TMP("PSAR",$J,PSADRUG,PSADA))
"RTN","PSARWS",26,0)
COUNT G:'$O(^TMP("PSAR",$J,"")) END S PSAPS(1)=0
"RTN","PSARWS",27,0)
 F PSA=0:1 S PSA=$O(^TMP("PSAR",$J,PSA)) Q:'PSA  S PSAPS(1)=$G(PSAPS(1))+1
"RTN","PSARWS",28,0)
 ;get transaction numbers
"RTN","PSARWS",29,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSARWS",30,0)
FIND S PSAD=$P(^PSD(58.81,0),U,3)+1 I $D(^PSD(58.81,PSAD)) S $P(^PSD(58.81,0),U,3)=$P(^PSD(58.81,0),U,3)+1 G FIND
"RTN","PSARWS",31,0)
 S PSAT=PSAD,DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(PSA,PSA(1))=""
"RTN","PSARWS",32,0)
 F PSAD=PSAT:1:(PSAT+PSAPS(1)-1) S (DINUM,X)=PSAD D ^DIC
"RTN","PSARWS",33,0)
 L -^PSD(58.81,0) K DIC,DINUM,DLAYGO
"RTN","PSARWS",34,0)
 ;loop thru array
"RTN","PSARWS",35,0)
 F  S PSA=$O(^TMP("PSAR",$J,PSA)) Q:'PSA  D
"RTN","PSARWS",36,0)
 .S PSALOC=$O(^TMP("PSAR",$J,PSA,0))
"RTN","PSARWS",37,0)
 .S PSAB(1)=$G(^TMP("PSAR",$J,PSA,PSALOC))
"RTN","PSARWS",38,0)
 .;get date + current balance + update balance
"RTN","PSARWS",39,0)
 .F  L +^PSD(58.8,+PSALOC,1,+PSA,0):0 I  Q
"RTN","PSARWS",40,0)
 .D NOW^%DTC
"RTN","PSARWS",41,0)
 .S PSADT=+$E(%,1,12),PSAB=+$P($G(^PSD(58.8,+PSALOC,1,+PSA,0)),U,4),$P(^PSD(58.8,+PSALOC,1,+PSA,0),U,4)=PSAB-PSAB(1) K %
"RTN","PSARWS",42,0)
 .L -^PSD(58.8,+PSALOC,1,+PSA,0)
"RTN","PSARWS",43,0)
 .;update monthly activity multiple
"RTN","PSARWS",44,0)
 .S:'$D(^PSD(58.8,+PSALOC,1,+PSA,5,0)) ^(0)="^58.801A^^"
"RTN","PSARWS",45,0)
 .I '$D(^PSD(58.8,+PSALOC,1,+PSA,5,$E(DT,1,5)*100,0)) D
"RTN","PSARWS",46,0)
 ..S DIC="^PSD(58.8,+PSALOC,1,+PSA,5,",DIC(0)="L",DIC("DR")="1////^S X=$G(PSAB)",(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSALOC,DA(1)=PSA,DLAYGO=58.8 D ^DIC K DIC("DR"),DINUM,DLAYGO
"RTN","PSARWS",47,0)
 ..S X="T-1M" D ^%DT S (X,DINUM)=$E(Y,1,5)*100 D ^DIC K DINUM
"RTN","PSARWS",48,0)
 ..S DIE=DIC,DA=+Y,DR="3////^S X=$G(PSAB)" D ^DIE K DIE,DA
"RTN","PSARWS",49,0)
 .S DIE="^PSD(58.8,+PSALOC,1,+PSA,5,",DA(2)=PSALOC,DA(1)=PSA
"RTN","PSARWS",50,0)
 .S DA=$E(DT,1,5)*100,DR="9////^S X=$P($G(^PSD(58.8,+PSALOC,1,+PSA,5,+$E(DT,1,5)*100,0)),U,6)+PSAB(1)"
"RTN","PSARWS",51,0)
 .D ^DIE K DIE,DA
"RTN","PSARWS",52,0)
 .;update transaction
"RTN","PSARWS",53,0)
 .S DIE="^PSD(58.81,",DR="1////2;2////^S X=PSALOC;3///^S X=PSADT;4////^S X=PSA;5////^S X=$G(PSAB(1));9////^S X=PSAB",DA=PSAT
"RTN","PSARWS",54,0)
 .D ^DIE
"RTN","PSARWS",55,0)
 .S:'$D(^PSD(58.8,+PSALOC,1,+PSA,4,0)) ^(0)="^58.800119PA^^"
"RTN","PSARWS",56,0)
 .S DIC="^PSD(58.8,+PSALOC,1,+PSA,4,",DIC(0)="L",(X,DINUM)=PSAT,DA(2)=PSALOC,DA(1)=PSA,DLAYGO=58.8 D ^DIC K DA,DIC,DINUM,DLAYGO S PSAT=PSAT+1
"RTN","PSARWS",57,0)
END K ^TMP("PSAR",$J)
"RTN","PSARWS",58,0)
 Q
"RTN","PSASIG")
0^81^B20550915
"RTN","PSASIG",1,0)
PSASIG ;BIR/JMB-Transfer Signature Sheet ;7/23/97
"RTN","PSASIG",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSASIG",3,0)
 ;This routine prints transfer signature sheets.
"RTN","PSASIG",4,0)
 ;
"RTN","PSASIG",5,0)
TEMP ;Entry point for printing immediately after transfer is entered. It is
"RTN","PSASIG",6,0)
 ;called by PSATRAN1. All transactions are placed in ^TMP("PSASIG",$J)
"RTN","PSASIG",7,0)
 ;while inputing the transaction. The transfer sheets are printed using
"RTN","PSASIG",8,0)
 ;this array.
"RTN","PSASIG",9,0)
 W ! S %ZIS="Q" D ^%ZIS G:POP EXIT
"RTN","PSASIG",10,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSASIG",11,0)
 .S ZTDESC="Drug Acct.-Print Transfer Signature Sheets",ZTRTN="TQUE^PSASIG"
"RTN","PSASIG",12,0)
 .S ZTSAVE("^TMP(""PSASIG"",$J,")="" D ^%ZTLOAD
"RTN","PSASIG",13,0)
TQUE S PSAOUT=0,PSAFIRST=1,PSASLN="",$P(PSASLN,"-",80)="",PSADLN="",$P(PSADLN,"=",80)=""
"RTN","PSASIG",14,0)
 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S PSARPDT=Y
"RTN","PSASIG",15,0)
 S PSAFROM=0 F  S PSAFROM=+$O(^TMP("PSASIG",$J,PSAFROM)) Q:'PSAFROM!(PSAOUT)  S PSATO=0 F  S PSATO=+$O(^TMP("PSASIG",$J,PSAFROM,PSATO)) Q:'PSATO!(PSAOUT)  D
"RTN","PSASIG",16,0)
 .S PSAPG=0,PSALOC=PSAFROM D SITES^PSAUTL1 S PSAFROMN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSASIG",17,0)
 .S PSALOC=PSATO D SITES^PSAUTL1 S PSATON=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSASIG",18,0)
 .D HDR Q:PSAOUT
"RTN","PSASIG",19,0)
 .S PSADA=0 F  S PSADA=$O(^TMP("PSASIG",$J,PSAFROM,PSATO,PSADA)) Q:'PSADA!(PSAOUT)  D PRINT S PSAFIRST=0
"RTN","PSASIG",20,0)
EXIT I $E(IOST)'="C" W @IOF
"RTN","PSASIG",21,0)
 I $E(IOST,1,2)="C-",'PSAOUT D
"RTN","PSASIG",22,0)
 .S PSASS=21-$Y F PSAKK=1:1:PSASS W !
"RTN","PSASIG",23,0)
 .S DIR(0)="E",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR W @IOF
"RTN","PSASIG",24,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSASIG",25,0)
 K ^TMP("PSASIG",$J),%,%ZIS,DIR,DTOUT,PSABAL,PSABEG,PSACHK,PSACNT,PSACOMB,PSADA,PSADLN,PSADRG,PSADT,PSAEND,PSAFIRST,PSAFROM,PSAFROMN,PSAKK
"RTN","PSASIG",26,0)
 K PSALOC,PSALOCA,PSALOCN,PSANODE,PSAOUT,PSAPG,PSAQTY,PSAREPRT,PSARPDT,PSASAVE,PSASEL,PSASLN,PSASS,PSATO,PSATON,PSATRAN,PSATRDT,PSAWHO,Y,ZTDESC,ZTRTN,ZTSAVE
"RTN","PSASIG",27,0)
 Q
"RTN","PSASIG",28,0)
 ;
"RTN","PSASIG",29,0)
REPRINT ;Entry point for Transfer Signature Sheets. It prompts for the
"RTN","PSASIG",30,0)
 ;dispensing pharmacy location, receiving pharmacy location, beginning
"RTN","PSASIG",31,0)
 ;date, then ending date.
"RTN","PSASIG",32,0)
 S PSAREPRT=1,(PSACNT,PSAOUT)=0,PSATRAN="F"
"RTN","PSASIG",33,0)
 D ^PSAUTL3 G:PSAOUT EXIT S PSACNT=0,PSACHK=$O(PSALOC(""))
"RTN","PSASIG",34,0)
 I PSACHK="",'PSALOC W !,"There are no active pharmacy locations." G EXIT
"RTN","PSASIG",35,0)
 S PSAFROM=+PSALOC,PSAFROMN=PSALOCN D TO^PSATRAN
"RTN","PSASIG",36,0)
 D BDATE^PSAPV
"RTN","PSASIG",37,0)
 W ! S %ZIS="Q" D ^%ZIS G:POP EXIT
"RTN","PSASIG",38,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PSASIG",39,0)
 .S ZTDESC="Drug Acct.-Reprint Transfer Signature Sheets",ZTRTN="RQUE^PSASIG"
"RTN","PSASIG",40,0)
 .F PSASAVE="PSABEG","PSAEND","PSAFROM","PSAFROMN","PSATO","PSATON" S:$D(PSASAVE) ZTSAVE(PSASAVE)=""
"RTN","PSASIG",41,0)
 .S ZTSAVE("^TMP(""PSASIG"",$J,")="" D ^%ZTLOAD
"RTN","PSASIG",42,0)
RQUE S (PSAPG,PSAOUT)=0,PSAREPRT=1,PSASLN="",$P(PSASLN,"-",80)="",PSADLN="",$P(PSADLN,"=",80)="",PSADT=PSABEG
"RTN","PSASIG",43,0)
 D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S PSARPDT=Y,PSAFIRST=1
"RTN","PSASIG",44,0)
 D HDR S PSAFIRST=0
"RTN","PSASIG",45,0)
 F  S PSADT=+$O(^PSD(58.81,"AF",PSADT)) Q:'PSADT!($P(PSADT,".")>PSAEND)!(PSAOUT)  S PSADA=0 F  S PSADA=+$O(^PSD(58.81,"AF",PSADT,PSAFROM,24,PSADA)) Q:'PSADA!(PSAOUT)  D
"RTN","PSASIG",46,0)
 .S PSANODE=$G(^PSD(58.81,PSADA,0)) I $P(PSANODE,"^",6)<0,$P($G(^PSD(58.81,+$P(PSANODE,"^",17),0)),"^",3)=PSATO D PRINT
"RTN","PSASIG",47,0)
 G EXIT
"RTN","PSASIG",48,0)
 ;
"RTN","PSASIG",49,0)
PRINT S PSANODE=$G(^PSD(58.81,PSADA,0)),PSATRDT=$E($$FMTE^XLFDT($P(PSANODE,"^",4),1),1,18),PSADRG=$P(PSANODE,"^",5)
"RTN","PSASIG",50,0)
 S PSAQTY=$P(PSANODE,"^",6),PSAWHO=$P($G(^VA(200,+$P(PSANODE,"^",7),0)),"^"),PSABAL=+$P(PSANODE,"^",10)
"RTN","PSASIG",51,0)
 S:PSAQTY<0 PSAQTY=-PSAQTY D:$Y+7>IOSL HDR Q:PSAOUT
"RTN","PSASIG",52,0)
 W !,PSATRDT,?20,$J(PSAQTY,6),?30,$S($P($G(^PSDRUG(PSADRG,0)),"^")'="":$P($G(^PSDRUG(PSADRG,0)),"^"),1:"UNKNOWN"),?73,$S(+PSABAL:$J((PSABAL-PSAQTY),6),1:"UNKNOWN")
"RTN","PSASIG",53,0)
 W !!,?2,"Dispensed by:  "_$S(PSAWHO'="":PSAWHO,1:"_____________________"),?40,"Rec'd by:  ____________________________"
"RTN","PSASIG",54,0)
 W !,?20,"(Full Name)",?55,"(Full Name)",!,PSADLN
"RTN","PSASIG",55,0)
 Q
"RTN","PSASIG",56,0)
 ;
"RTN","PSASIG",57,0)
HDR ;Header
"RTN","PSASIG",58,0)
 I $E(IOST,1,2)="C-",'PSAFIRST D  I 'Y S PSAOUT=1 Q
"RTN","PSASIG",59,0)
 .S PSASS=21-$Y F PSAKK=1:1:PSASS W !
"RTN","PSASIG",60,0)
 .S DIR(0)="E" D ^DIR K DIR
"RTN","PSASIG",61,0)
 I $E(IOST,1,2)="C-",'PSAPG W @IOF
"RTN","PSASIG",62,0)
 W:$E(IOST,1,2)'="C-"&('PSAPG)&('PSAFIRST) @IOF
"RTN","PSASIG",63,0)
 W:PSAPG @IOF S PSAPG=PSAPG+1
"RTN","PSASIG",64,0)
 W:$G(PSAREPRT) !,?32,"*** REPRINT ***"
"RTN","PSASIG",65,0)
 W !,PSARPDT,?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",?72,"Page: ",PSAPG
"RTN","PSASIG",66,0)
 W !?18,"DRUG TRANSFER BETWEEN PHARMACIES SIGNATURE SHEET"
"RTN","PSASIG",67,0)
 W:$L(PSAFROMN)>76 !!,$P(PSAFROMN,"(IP)",1)_"(IP)",!?17,$P(PSAFROMN,"(IP)",2) W:$L(PSAFROMN)<77 !?((80-$L(PSAFROMN))/2),PSAFROMN
"RTN","PSASIG",68,0)
 W !!!,"TRANSFERRED TO: " W:$L(PSATON)>63 $P(PSATON,"(IP)",1)_"(IP)",!?17,$P(PSATON,"(IP)",2) W:$L(PSATON)<74 PSATON W !,PSASLN
"RTN","PSASIG",69,0)
 W !,"TRANSFER DATE",?23,"QTY",?30,"DRUG",?68,"NEW BALANCE",!,PSASLN
"RTN","PSASIG",70,0)
 Q
"RTN","PSATI")
0^82^B27630373
"RTN","PSATI",1,0)
PSATI ;BIR/LTL-Single Drug Match ;7/23/97
"RTN","PSATI",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSATI",3,0)
 ;This routine enters/edits links with the ITEM MASTER file.
"RTN","PSATI",4,0)
 ;
"RTN","PSATI",5,0)
 N PSAIT,DTOUT,DUOUT,DIE,D0,D1,DA,DIC,DIR,DLAYGO,DR,DIRUT
"RTN","PSATI",6,0)
START D DT^DICRW
"RTN","PSATI",7,0)
 ;For call by ^PSAENT & ^PSAUNL 
"RTN","PSATI",8,0)
 I $G(PSAIT) S DIC(0)="Q",X=PSAIT W !!,$P($G(^PSDRUG(+PSAIT,0)),U),!!
"RTN","PSATI",9,0)
 ;LOOK UP DRUG
"RTN","PSATI",10,0)
LOOK S:'$D(DIC(0)) DIC(0)="AEMQ" S DIC=50,DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<0) QUIT S (PSADRUG,PSAIT)=$P(Y,U)
"RTN","PSATI",11,0)
DIS I $O(^PSDRUG(+PSADRUG,441,0)) W !,"This drug is currently linked to the following item(s):",!!  S PSAIM=0 F  S PSAIM=$O(^PSDRUG(PSADRUG,441,PSAIM)) Q:PSAIM="B"  S PSAI=$P(^PSDRUG(PSADRUG,441,PSAIM,0),U) D:$$DESCR^PRCPUX1(0,PSAI)]""
"RTN","PSATI",12,0)
 .W !,PSAI_"  "_$$DESCR^PRCPUX1(0,PSAI)_"  ",$$VENNAME^PRCPUX1($P($G(^PRC(441,+PSAI,0)),U,4)_"PRC(440"),!
"RTN","PSATI",13,0)
QUES1 I $D(PSAI) S DIR(0)="Y",DIR("A")="Would you like to alter the link(s)",DIR("B")="No" D ^DIR K DIR G:Y<1&('$D(PSALOC)) AGAIN G:Y<1 QUIT
"RTN","PSATI",14,0)
 W !!,"Current potential ITEM MASTER file links based on NDC or FSN are:",!!
"RTN","PSATI",15,0)
 ;Attempt match by NDC between #50/#441
"RTN","PSATI",16,0)
NDC I $P($G(^PSDRUG(PSADRUG,2)),U,4)]"" S PSANDC=$P(^(2),U,4),PSAI=$$ITEM^PSAUTL(PSANDC) W "DRUG file NDC:  "_PSANDC
"RTN","PSATI",17,0)
 I $D(PSAI),$D(PSANDC),PSAI W ?40,"ITEM NUMBER:  "_PSAI,!!,"DESC:  "_$$DESCR^PRCPUX1(0,PSAI),! W:$G(^PRC(441,+PSAI,3)) !?60,"* Inactive item" D:$O(^PRC(441,"F",PSANDC,PSAI))
"RTN","PSATI",18,0)
MORE .S PSAZ=1,PSAI(PSAZ)=PSAI F  S PSAI(PSAZ)=$O(^PRC(441,"F",PSANDC,PSAI(PSAZ))) Q:PSAI(PSAZ)=""  W !?40,"ITEM NUMBER:  "_PSAI(PSAZ),!!,"DESC:  ",$$DESCR^PRCPUX1(0,PSAI(PSAZ)) W:$G(^PRC(441,+PSAI(PSAZ),3)) !?60,"* Inactive item"
"RTN","PSATI",19,0)
 ;Attempt match between FSN (#50) and NSN (#441)
"RTN","PSATI",20,0)
FSN I '$G(PSAI),$P(^PSDRUG(PSADRUG,0),U,6)]"" S PSAFSN=$P(^(0),U,6) D:$D(^PRC(441,"BB",PSAFSN))
"RTN","PSATI",21,0)
 .S PSAI=$O(^PRC(441,"BB",PSAFSN,"")) W "  NO NDC MATCH IN ITEM MASTER file.",!!,"DRUG file FSN:  "_PSAFSN,?40,"ITEM NUMBER:  "_PSAI,!!,"DESC:  ",$$DESCR^PRCPUX1(0,PSAI),!
"RTN","PSATI",22,0)
FAIL S:'$D(PSAI) PSAI="" W:PSAI']"" !!,"No NDC or FSN match in the ITEM MASTER file.",!
"RTN","PSATI",23,0)
 S:'$D(^PSDRUG(+PSADRUG,441,0)) ^(0)="^50.0441P^^"
"RTN","PSATI",24,0)
CON S DIE="^PSDRUG(",DA=PSADRUG,DR="441//^S X=$G(PSAI)" D ^DIE K DIE I $D(Y)!($D(DTOUT)) S DIRUT=1 G QUIT
"RTN","PSATI",25,0)
 I '$D(^PSDRUG(PSADRUG,"ND")) W !!,"No NDF link, can't help.",!  G AGAIN
"RTN","PSATI",26,0)
 I $P(^PSDRUG(PSADRUG,"ND"),U)']"" W !!,"No NDF link, can't help.",!  K DUOUT G AGAIN
"RTN","PSATI",27,0)
 ;Check for package size or type = OTHER
"RTN","PSATI",28,0)
 I $P($G(^PSDRUG(+PSADRUG,"ND")),U,4)=2058 W !!,"No matching PACKAGE SIZE in the National Drug File." G AGAIN
"RTN","PSATI",29,0)
 I $P($G(^PSDRUG(+PSADRUG,"ND")),U,5)=623 W !!,"No matching PACKAGE TYPE in the National Drug file." G AGAIN
"RTN","PSATI",30,0)
NDF ;Offer NDF path
"RTN","PSATI",31,0)
 W !!,"This drug is linked to the NATIONAL DRUG file.",!!,"There may be an NDC there that will link to the ITEM MASTER file.",!
"RTN","PSATI",32,0)
 S DIR(0)="Y",DIR("A")="Would you like to check",DIR("B")="No" D ^DIR K DIR G:$D(DIRUT)!(Y<1) AGAIN
"RTN","PSATI",33,0)
 S PSANDF=$P(^PSDRUG(PSADRUG,"ND"),U),PSAV=$P(^("ND"),U,3),PSAP=$P(^("ND"),U,4),PSAT=$P(^("ND"),U,5),PSADO=$P(^PSNDF(PSANDF,5,PSAV,0),U,2),PSAS=$P(^(0),U,3),PSAU=$P(^(0),U,4),PSAPB=$O(^PSNDF(PSANDF,2,PSADO,3,PSAS,4,PSAU,5,"B",PSAP,""))
"RTN","PSATI",34,0)
 S PSATB=$O(^PSNDF(+PSANDF,2,+PSADO,3,+PSAS,4,+PSAU,5,+PSAPB,6,"B",PSAT,"")),PSA=0,PSAB="",Y=1
"RTN","PSATI",35,0)
 I PSATB+PSAPB<2 W !!,"Not enough INFO, can't find NDC, sorry.",! G AGAIN
"RTN","PSATI",36,0)
 W:$P(^PSNDF(PSANDF,2,PSADO,3,PSAS,4,PSAU,5,PSAPB,6,PSATB,7,0),U,4)>1 !,"There are "_$P(^(0),U,4)_" NDCs for this drug.",!! W:$P(^(0),U,4)=1 !,"There is one NDC for this drug",!!
"RTN","PSATI",37,0)
 F  S PSA=$O(^PSNDF(PSANDF,2,PSADO,3,PSAS,4,PSAU,5,PSAPB,6,PSATB,7,PSA)) Q:PSA=""  D  Q:Y<1  D FIND
"RTN","PSATI",38,0)
 .W !,"Going to check NDC #"_PSA,! S DIR(0)="Y",DIR("A")="OK",DIR("B")="No" D ^DIR K DIR Q:$D(DIRUT)!(Y<1)
"RTN","PSATI",39,0)
AGAIN K PSA,PSAB,PSAD,PSADO,PSADRUG,PSAF,PSAFSN,PSANDC,PSANDF,PSAI,PSAIM,PSAIQ,PSAIQT,PSAIAC,PSAILC,PSAINV,PSAINVN,PSAP,PSAPB,PSAS,PSAT,PSATB,PSAU,PSAV,PSAZ,X,Y
"RTN","PSATI",40,0)
 Q:$D(PSAS)!($D(PSALOC))  W ! S DIR(0)="Y",DIR("A")="Another drug",DIR("B")="Yes" D ^DIR K DIR I Y>0 K PSAIT,PSAI G START
"RTN","PSATI",41,0)
QUIT N:'$G(PSAIT(1)) PSAIT,Y K PSA,PSAB,PSAI,PSAD,PSADO,PSADRUG,PSAF,PSAFSN,PSANDC,PSANDF,PSAI,PSAIM,PSAIQ,PSAIQT,PSAIAC,PSAILC,PSAINV,PSAINVN,PSAP,PSAPB,PSAS,PSAT,PSATB,PSAU,PSAV,PSAZ,X,Y Q
"RTN","PSATI",42,0)
BINGO S PSAI=$O(^PRC(441,"F",PSAB,""))
"RTN","PSATI",43,0)
 Q:$O(^PSDRUG("AB",+PSAI,0))
"RTN","PSATI",44,0)
 W !!,"DRUG file:  "_$P(^PSDRUG(PSADRUG,0),U),!!,"Item #:  "_PSAI,"  Desc:  ",$$DESCR^PRCPUX1(0,PSAI),! D
"RTN","PSATI",45,0)
 .S DIR(0)="Y",DIR("A")="OK to link",DIR("B")="Yes",DIR("?")="If yes, I'll perform the link" D ^DIR K DIR K:(Y=0) Y Q:($G(Y)<1)
"RTN","PSATI",46,0)
 .S DIE=50,DA=PSADRUG,DR="441///^S X=""`""_PSAI" D ^DIE W " linked."
"RTN","PSATI",47,0)
 Q
"RTN","PSATI",48,0)
FIND K Y F PSAI=1:1 S PSAB=$O(^PRC(441,"F",PSAB)) W:PSAI#10=0 "." Q:PSAB=""  D:$G(^PSNDF(PSANDF,2,PSADO,3,PSAS,4,PSAU,5,PSAPB,6,PSATB,7,PSA,0))[$TR(PSAB,"-","") BINGO Q:$D(Y)
"RTN","PSATI",49,0)
 Q
"RTN","PSATRAN")
0^83^B28465280
"RTN","PSATRAN",1,0)
PSATRAN ;BIR/JMB-Transfer Drugs between Pharmacies ;8/21/97
"RTN","PSATRAN",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSATRAN",3,0)
 ;
"RTN","PSATRAN",4,0)
 I $D(^XUSEC("PSAMGR",DUZ)),'$D(^XUSEC("PSJ RPHARM",DUZ)) W !!,"** Contact your Pharmacy Coordinator for access to transfer drugs between",!,?4,"pharmacies. PSAMGR and PSJ RPHARM security keys are required.",! Q
"RTN","PSATRAN",5,0)
 S PSADUZ=DUZ,PSADUZN=$P($G(^VA(200,PSADUZ,0)),"^") D SIG^XUSESIG G:X1="" EXIT
"RTN","PSATRAN",6,0)
FROM ;select FROM pharmacy
"RTN","PSATRAN",7,0)
 S (PSADD,PSACNT,PSAOUT)=0,PSASLN="",$P(PSASLN,"-",80)="",PSATRAN="F"
"RTN","PSATRAN",8,0)
 D ^PSAUTL3 G:PSAOUT EXIT S PSACHK=$O(PSALOC(""))
"RTN","PSATRAN",9,0)
 I PSACHK="",'PSALOC W !,"There are no active pharmacy locations." G EXIT
"RTN","PSATRAN",10,0)
 S PSAFROM=+PSALOC,PSAFROMN=PSALOCN
"RTN","PSATRAN",11,0)
DRUG ;select drug
"RTN","PSATRAN",12,0)
 I '$O(^PSD(58.8,PSAFROM,1,0)) W !!,"There are no drugs in the transferring pharmacy.",!! G EXIT
"RTN","PSATRAN",13,0)
 W @IOF,!,PSAFROMN
"RTN","PSATRAN",14,0)
 K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSAFROM,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSATRAN",15,0)
 S DIC("A")="Select DRUG: ",DA(1)=+PSAFROM,DIC(0)="QEAM",DIC="^PSD(58.8,"_PSAFROM_",1,"
"RTN","PSATRAN",16,0)
 D ^DIC K DIC G:Y<0 FROM I ($D(DTOUT))!($D(DUOUT)) G EXIT
"RTN","PSATRAN",17,0)
 G:Y<0 FROM
"RTN","PSATRAN",18,0)
 S PSADRG=+Y,PSADRGN=$P($G(^PSDRUG(PSADRG,0)),"^"),PSABAL=+$P($G(^PSD(58.8,PSAFROM,1,PSADRG,0)),"^",4)
"RTN","PSATRAN",19,0)
 I PSABAL'>0 W $C(7),!!,PSADRGN," has a "_$S(PSABAL=0:"zero",1:"negative")_" balance.",!,"Select another drug to transfer." G DRUG
"RTN","PSATRAN",20,0)
QTY ;enter quantity
"RTN","PSATRAN",21,0)
 S PSADU=$S($P($G(^PSDRUG(PSADRG,660)),"^",8)'="":$P($G(^PSDRUG(PSADRG,660)),"^",8),1:"Unknown")
"RTN","PSATRAN",22,0)
 W !!,?5,"Dispense Unit: ",PSADU,?35,"Current Balance: "_PSABAL,!
"RTN","PSATRAN",23,0)
 S DIR(0)="NO^1:"_PSABAL_":0",DIR("A")="Enter Quantity to Transfer",DIR("?")="Enter a whole number between 1 and "_PSABAL,DIR("??")="^D QTYHELP^PSATRAN"
"RTN","PSATRAN",24,0)
 D ^DIR K DIR I $G(DIRUT) D MSG G DRUG
"RTN","PSATRAN",25,0)
 S PSATQTY=+Y D TO
"RTN","PSATRAN",26,0)
 ;
"RTN","PSATRAN",27,0)
CHK I '$D(^PSD(58.8,PSATO,1,PSADRG,0)) W $C(7),!!,PSATON," does not stock ",PSADRGN,"!",! D ADD G:'PSADD DRUG
"RTN","PSATRAN",28,0)
ASK ;ask ok
"RTN","PSATRAN",29,0)
 W !,PSASLN,!,$P($G(^PSDRUG(PSADRG,0)),"^"),!,"Transferring: ",PSATQTY," (",$P($G(^PSDRUG(PSADRG,660)),"^",8),")",!!,"From: ",PSAFROMN,!,"To  : ",PSATON,!,PSASLN,!
"RTN","PSATRAN",30,0)
 K DIR,DIRUT S DIR(0)="Y",DIR("A")="OK to post",DIR("B")="Yes",DIR("?")="Answer 'YES' to post this transfer, 'NO' or '^' to quit.",DIR("??")="^D HELP^PSATRAN"
"RTN","PSATRAN",31,0)
 D ^DIR K DIR I 'Y!$D(DIRUT) D MSG G DRUG
"RTN","PSATRAN",32,0)
 D:PSADD ADD1 D ^PSATRAN1 G:'PSAOUT DRUG
"RTN","PSATRAN",33,0)
 ;
"RTN","PSATRAN",34,0)
EXIT I $O(^TMP("PSASIG",$J,0)) D
"RTN","PSATRAN",35,0)
 .W ! S DIR(0)="Y",DIR("A")="Print transfer signature sheets",DIR("B")="Y",DIR("?",1)="Enter YES to print transfer signature sheets for the transfers just entered."
"RTN","PSATRAN",36,0)
 .S DIR("?")="Enter NO to bypass printing the sheets then exit the option.",DIR("??")="^D PRINTYN^PSATRAN" D ^DIR K DIR Q:$G(DIRUT)!('+Y)
"RTN","PSATRAN",37,0)
 .D ^PSASIG
"RTN","PSATRAN",38,0)
 ;
"RTN","PSATRAN",39,0)
KILL K %,DA,DIC,DIE,DINUM,DIR,DIRUT,DTOUT,DUOUT,PSABAL,PSACHK,PSACNT,PSADD,PSADISP,PSADJ,PSADRG,PSADRGN,PSADT,PSADU,PSADUZ,PSADUZN,PSAFRDA,PSAFROM,PSAFROMN
"RTN","PSATRAN",40,0)
 K PSAJJ,PSALCNT,PSALES,PSALOC,PSALOCA,PSALOCN,PSANODE,PSARDT,PSAREC,PSAREPRT,PSARET,PSASEL,PSASLN,PSAOUT
"RTN","PSATRAN",41,0)
 K PSATEMP,PSATF,PSATODA,PSATO,PSATON,PSATQTY,PSATRAN,X,X1,X2,XMDUZ,XMSUB,XMTEXT,XMY,Y,YY
"RTN","PSATRAN",42,0)
 Q
"RTN","PSATRAN",43,0)
MSG W $C(7),!!,"No action taken.",! H 1
"RTN","PSATRAN",44,0)
 Q
"RTN","PSATRAN",45,0)
ADD ;ask to add drug
"RTN","PSATRAN",46,0)
 K DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want to continue",DIR("?")="Answer 'YES' to continue with this transfer, 'NO' or '^' to quit.",DIR("??")="^D HELP^PSATRAN"
"RTN","PSATRAN",47,0)
 D ^DIR K DIR I $G(DIRUT) D MSG Q
"RTN","PSATRAN",48,0)
 S PSADD=+Y
"RTN","PSATRAN",49,0)
 Q
"RTN","PSATRAN",50,0)
ADD1 ;add drug
"RTN","PSATRAN",51,0)
 Q:$D(^PSD(58.8,PSATO,1,PSADRG,0))
"RTN","PSATRAN",52,0)
 S:'$D(^PSD(58.8,PSATO,1,0)) ^PSD(58.8,PSATO,1,0)="^58.8001IP^^"
"RTN","PSATRAN",53,0)
 K DA,DD,DO S DIC(0)="L",DIC="^PSD(58.8,"_+PSATO_",1,",DA(1)=+PSATO,(X,DINUM)=+PSADRG D FILE^DICN K DA,DIC
"RTN","PSATRAN",54,0)
 Q
"RTN","PSATRAN",55,0)
 ;
"RTN","PSATRAN",56,0)
TO ;transfer TO pharmacy
"RTN","PSATRAN",57,0)
 K PSALOCA(PSAFROMN),DA
"RTN","PSATRAN",58,0)
 S PSACNT=0,PSATON="" F  S PSATON=$O(PSALOCA(PSATON)) Q:PSATON=""  S PSACNT=PSACNT+1
"RTN","PSATRAN",59,0)
 I PSACNT=1 S PSATON=$O(PSALOCA("")),PSATO=+$O(PSALOCA(PSATON,0)) Q:'$G(PSAREPRT)
"RTN","PSATRAN",60,0)
 ;
"RTN","PSATRAN",61,0)
 S PSACNT=0,PSATRAN="T" W ! D DISP^PSAUTL3 G:PSAOUT EXIT S PSACNT=0,PSACHK=$O(PSALOC(""))
"RTN","PSATRAN",62,0)
 S PSATO=+PSALOC,PSATON=PSALOCN
"RTN","PSATRAN",63,0)
 Q
"RTN","PSATRAN",64,0)
HELP ;Extended help for 'Do you want to continue?'
"RTN","PSATRAN",65,0)
 W !?5,"Enter YES if it is okay to transfer this drug. Enter NO to abort the transfer."
"RTN","PSATRAN",66,0)
 Q
"RTN","PSATRAN",67,0)
PRINTYN ;Extended help for 'Print transfer signature sheets?'
"RTN","PSATRAN",68,0)
 W !?5,"Enter YES if you want to print sheets that can be carried with the drugs",!?5,"to the receiving pharmacy for signature. The person signing the sheet is",!?5,"signing that he/she received the drug(s)."
"RTN","PSATRAN",69,0)
 W !!?5,"Enter NO if you do not want to print the signature sheets. You will exit",!?5,"from the option."
"RTN","PSATRAN",70,0)
 Q
"RTN","PSATRAN",71,0)
QTYHELP ;Extended help for 'Enter Quantity to Transfer'
"RTN","PSATRAN",72,0)
 W !?5,"Enter the number of dispense units to be transferred out of the",!?5,"pharmacy location. Enter a whole number between 1 and "_PSABAL_"."
"RTN","PSATRAN",73,0)
 Q
"RTN","PSATRAN1")
0^84^B20498296
"RTN","PSATRAN1",1,0)
PSATRAN1 ;BIR/JMB-Transfer Drugs between Pharmacies - CONT'D ;7/23/97
"RTN","PSATRAN1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSATRAN1",3,0)
 ;This routine updates the dispensing and receiving locations. The drug
"RTN","PSATRAN1",4,0)
 ;balance & monthly activity are updated. It creates an activity in 58.8,
"RTN","PSATRAN1",5,0)
 ;a transaction in 58.81, sends a mail message if the drug is new to the
"RTN","PSATRAN1",6,0)
 ;receiving location, and stores the data so the signature sheet can
"RTN","PSATRAN1",7,0)
 ;print. It is called by PSATRAN.
"RTN","PSATRAN1",8,0)
 ;
"RTN","PSATRAN1",9,0)
UPDATE ;update location balances
"RTN","PSATRAN1",10,0)
 D CHK Q:PSALES  W !!,"Updating pharmacy on-hand balances now..."
"RTN","PSATRAN1",11,0)
 S (PSATODA,PSAFRDA)=0
"RTN","PSATRAN1",12,0)
 F PSALCNT=1:1:2 D CALC
"RTN","PSATRAN1",13,0)
 I PSATODA,PSAFRDA D
"RTN","PSATRAN1",14,0)
 .S DIE="^PSD(58.81,",DA=PSATODA,DR="16///^S X=PSAFRDA"
"RTN","PSATRAN1",15,0)
 .F  L +^PSD(58.81,DA,0):0 I  Q
"RTN","PSATRAN1",16,0)
 .D ^DIE L -^PSD(58.81,DA,0) K DA
"RTN","PSATRAN1",17,0)
 .S DA=PSAFRDA,DR="16///^S X=PSATODA"
"RTN","PSATRAN1",18,0)
 .F  L +^PSD(58.81,DA,0):0 I  Q
"RTN","PSATRAN1",19,0)
 .D ^DIE L -^PSD(58.81,DA,0) K DA,DIE
"RTN","PSATRAN1",20,0)
 W !,"Done!" H 1 S ^TMP("PSASIG",$J,+PSAFROM,+PSATO,PSAFRDA)=""
"RTN","PSATRAN1",21,0)
 D:PSADD MSG I 'PSADD H 1
"RTN","PSATRAN1",22,0)
 S (PSADD,PSAOUT)=0
"RTN","PSATRAN1",23,0)
 Q
"RTN","PSATRAN1",24,0)
CALC ;sub/add qty from dsp sites
"RTN","PSATRAN1",25,0)
 W "." S PSATEMP=+$S(PSALCNT=1:PSAFROM,1:PSATO),PSATQTY=-PSATQTY
"RTN","PSATRAN1",26,0)
 F  L +^PSD(58.8,PSATEMP,1,PSADRG,0):0 I  Q
"RTN","PSATRAN1",27,0)
 D NOW^%DTC S PSADT=+%
"RTN","PSATRAN1",28,0)
 S PSABAL(PSALCNT)=$P(^PSD(58.8,PSATEMP,1,PSADRG,0),"^",4),$P(^(0),"^",4)=$P(^(0),"^",4)+PSATQTY,$P(PSABAL(PSALCNT),"^",2)=(+PSABAL(PSALCNT)+PSATQTY)
"RTN","PSATRAN1",29,0)
 L -^PSD(58.8,PSATEMP,1,PSADRG,0)
"RTN","PSATRAN1",30,0)
ADD ;find entry number
"RTN","PSATRAN1",31,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSATRAN1",32,0)
FIND S PSAREC=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSAREC)) S $P(^PSD(58.81,0),"^",3)=PSAREC G FIND
"RTN","PSATRAN1",33,0)
 K DIC,DLAYGO S DIC(0)="L",DIC="^PSD(58.81,",DLAYGO=58.81,(X,DINUM)=PSAREC D ^DIC K DIC,DINUM,DLAYGO
"RTN","PSATRAN1",34,0)
 L -^PSD(58.81,0) W "."
"RTN","PSATRAN1",35,0)
 S:PSALCNT=1 PSAFRDA=PSAREC S:PSALCNT=2 PSATODA=PSAREC
"RTN","PSATRAN1",36,0)
TRANS ;update transaction data
"RTN","PSATRAN1",37,0)
 K DA,DIE,DR S DA=PSAREC,DIE=58.81
"RTN","PSATRAN1",38,0)
 S DR="1////24;2////"_PSATEMP_";4////"_PSADRG_";3////"_PSADT_";5////"_PSATQTY_";6////"_PSADUZ_";9////"_$P(PSABAL(PSALCNT),"^")
"RTN","PSATRAN1",39,0)
 D ^DIE K DA,DIE,DR W "."
"RTN","PSATRAN1",40,0)
ACT ;update location drug info
"RTN","PSATRAN1",41,0)
 S:'$D(^PSD(58.8,PSATEMP,1,PSADRG,4,0)) ^PSD(58.8,PSATEMP,1,PSADRG,4,0)="^58.800119PA^^"
"RTN","PSATRAN1",42,0)
 I '$D(^PSD(58.8,PSATEMP,1,PSADRG,4,PSAREC,0)) K DA,DD,DO S DIC(0)="L",DIC="^PSD(58.8,"_PSATEMP_",1,"_PSADRG_",4,",DA(2)=PSATEMP,DA(1)=PSADRG,(X,DINUM)=PSAREC D ^DIC K DA,DIC,DINUM W "."
"RTN","PSATRAN1",43,0)
MON ;update monthly activity node
"RTN","PSATRAN1",44,0)
 S:'$D(^PSD(58.8,PSATEMP,1,PSADRG,5,0)) ^(0)="^58.801A^^"
"RTN","PSATRAN1",45,0)
 I '$D(^PSD(58.8,PSATEMP,1,PSADRG,5,$E(PSADT,1,5)*100,0)) D
"RTN","PSATRAN1",46,0)
 .S DIC="^PSD(58.8,"_PSATEMP_",1,"_PSADRG_",5,",DIC(0)="LM"
"RTN","PSATRAN1",47,0)
 .S DA(2)=PSATEMP,DA(1)=PSADRG,(X,DINUM)=($E(PSADT,1,5)*100),DLAYGO=58.8 D ^DIC K DIC,DINUM,DLAYGO W "." S DA=+Y
"RTN","PSATRAN1",48,0)
 .S DIE="^PSD(58.8,"_PSATEMP_",1,"_PSADRG_",5,",DA(2)=PSATEMP,DA(1)=PSADRG,DR="1////^S X="_+PSABAL(PSALCNT) D ^DIE K DIE
"RTN","PSATRAN1",49,0)
 .S X="T-1M" D ^%DT
"RTN","PSATRAN1",50,0)
 .S DIC="^PSD(58.8,"_PSATEMP_",1,"_PSADRG_",5,",DIC(0)="LM",DA(2)=PSATEMP,DA(1)=PSADRG,(X,DINUM)=($E(Y,1,5)*100),DLAYGO=58.8 D ^DIC K DINUM,DLAYGO
"RTN","PSATRAN1",51,0)
 ;.S DIE=DIC,DR="3////^S X="_($P($G(^PSD(58.8,PSATEMP,1,PSADRG,0)),"^",4)-PSATQTY) K DIC D ^DIE K DA,DIE W "."
"RTN","PSATRAN1",52,0)
 S DA=($E(PSADT,1,5)*100),PSANODE=$G(^PSD(58.8,PSATEMP,1,PSADRG,5,DA,0)) Q:'$D(PSANODE)
"RTN","PSATRAN1",53,0)
 S PSAREC=$P(PSANODE,"^",3),PSADJ=$P(PSANODE,"^",5),PSADISP=$P(PSANODE,"^",6),PSARET=$P(PSANODE,"^",7),PSATF=$P(PSANODE,"^",9)+PSATQTY
"RTN","PSATRAN1",54,0)
 S PSABAL=$P(PSANODE,"^",2)+PSAREC+PSADJ-PSADISP+PSARET+PSATF
"RTN","PSATRAN1",55,0)
 S DIE="^PSD(58.8,"_PSATEMP_",1,"_PSADRG_",5,",DA(2)=PSATEMP,DA(1)=PSADRG
"RTN","PSATRAN1",56,0)
 S DR="13////^S X="_($P($G(^PSD(58.8,PSATEMP,1,PSADRG,5,DA,0)),"^",9)+PSATQTY)_";3////^S X="_PSABAL
"RTN","PSATRAN1",57,0)
 D ^DIE K DA,DIE W "."
"RTN","PSATRAN1",58,0)
 Q
"RTN","PSATRAN1",59,0)
CHK ;check for valid bal
"RTN","PSATRAN1",60,0)
 S PSALES=0 D:PSATQTY>$P(^PSD(58.8,PSAFROM,1,PSADRG,0),"^",4)
"RTN","PSATRAN1",61,0)
 .W $C(7),!!,"=>   The drug balance is "_+$P(^PSD(58.8,PSAFROM,1,PSADRG,0),"^",4)_".  You cannot transfer "_PSATQTY_" for this drug.",! S PSALES=1
"RTN","PSATRAN1",62,0)
 .W "No action taken.",!
"RTN","PSATRAN1",63,0)
 Q
"RTN","PSATRAN1",64,0)
MSG ;send mailman message with transfer info
"RTN","PSATRAN1",65,0)
 K XMY,^TMP("PSATRAN",$J)
"RTN","PSATRAN1",66,0)
 S ^TMP("PSATRAN",$J,1,0)="Drug: "_PSADRGN
"RTN","PSATRAN1",67,0)
 S ^TMP("PSATRAN",$J,2,0)="Quantity  : "_PSATQTY_" ("_PSADU_")",^TMP("PSATRAN",$J,3,0)="Pharmacist: "_PSADUZN,^TMP("PSATRAN",$J,4,0)=" "
"RTN","PSATRAN1",68,0)
 S ^TMP("PSATRAN",$J,5,0)="Transferred from:",^TMP("PSATRAN",$J,6,0)=PSAFROMN,^TMP("PSATRAN",$J,7,0)=" "
"RTN","PSATRAN1",69,0)
 S ^TMP("PSATRAN",$J,8,0)="Transferred and Added to:",^TMP("PSATRAN",$J,9,0)=PSATON
"RTN","PSATRAN1",70,0)
 S XMSUB="Drug Transfer Between Pharmacies",XMTEXT="^TMP(""PSATRAN"",$J,",XMDUZ="Drug Accountability System"
"RTN","PSATRAN1",71,0)
 F PSAJJ=0:0 S PSAJJ=$O(^XUSEC("PSAMGR",PSAJJ)) Q:'PSAJJ  S XMY(PSAJJ)=""
"RTN","PSATRAN1",72,0)
 G:'$D(XMY) QUIT D ^XMD
"RTN","PSATRAN1",73,0)
QUIT K XMY,^TMP("PSATRAN",$J)
"RTN","PSATRAN1",74,0)
 Q
"RTN","PSAUDP")
0^85^B9536295
"RTN","PSAUDP",1,0)
PSAUDP ;BIR/LTL,JMB-Nightly Background Job - CONT'D ;7/23/97
"RTN","PSAUDP",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUDP",3,0)
 ;This is the entry point to gather IP dispensing data for all drugs in
"RTN","PSAUDP",4,0)
 ;all pharmacy locations. When the pick list is filed away, an
"RTN","PSAUDP",5,0)
 ;^XTMP("PSAPL") global is set to contain the dispensing data.
"RTN","PSAUDP",6,0)
 ;^XTMP("PSA",59.4 IP Site#,50 Drug#,Date dispensed)=Total Qty Dispensed
"RTN","PSAUDP",7,0)
 ;It is called by PSAPSI3.
"RTN","PSAUDP",8,0)
 ;
"RTN","PSAUDP",9,0)
PICKLST Q:'$O(^XTMP("PSAPL",0))
"RTN","PSAUDP",10,0)
 D DT^DICRW
"RTN","PSAUDP",11,0)
 ;PSAIP=IP SITE, PSA50=DRUG(IEN), PSADT=DT
"RTN","PSAUDP",12,0)
 S PSAIP=0 F  S PSAIP=$O(^XTMP("PSAPL",PSAIP)) Q:'PSAIP  D
"RTN","PSAUDP",13,0)
 .S PSA50=0 F  S PSA50=$O(^XTMP("PSAPL",PSAIP,PSA50)) Q:'PSA50  D
"RTN","PSAUDP",14,0)
 ..S PSADT=0 F  S PSADT=$O(^XTMP("PSAPL",PSAIP,PSA50,PSADT)) Q:'PSADT  D
"RTN","PSAUDP",15,0)
 ...S PSALOC=+$O(^PSD(58.8,"ASITE",PSAIP,"P",0))
"RTN","PSAUDP",16,0)
 ...S PSAQTY=+$G(^XTMP("PSAPL",PSAIP,PSA50,PSADT))
"RTN","PSAUDP",17,0)
 ...D:$D(^PSD(58.8,PSALOC,1,PSA50)) PROCESS
"RTN","PSAUDP",18,0)
 ...K ^XTMP("PSAPL",PSAIP,PSA50,PSADT)
"RTN","PSAUDP",19,0)
 S ^XTMP("PSAPL",0)=DT+1
"RTN","PSAUDP",20,0)
END K DA,DIC,DIE,DINUM,DLAYGO,DR,PSA50,PSABAL,PSADT,PSAIP,PSALOC,PSANUM,PSAQTY,X,Y
"RTN","PSAUDP",21,0)
 Q
"RTN","PSAUDP",22,0)
PROCESS ;Stuff last UD dispensing fld with DT
"RTN","PSAUDP",23,0)
 F  L +^PSD(58.8,PSALOC,0):0 I  Q
"RTN","PSAUDP",24,0)
 S DIE="^PSD(58.8,",DA=PSALOC,DR="27////"_PSADT D ^DIE K DIE,DA,DR
"RTN","PSAUDP",25,0)
 ;Subtract dispensing from balance
"RTN","PSAUDP",26,0)
 S PSABAL=$P($G(^PSD(58.8,PSALOC,1,PSA50,0)),"^",4)
"RTN","PSAUDP",27,0)
 S $P(^PSD(58.8,PSALOC,1,PSA50,0),"^",4)=PSABAL-$G(PSAQTY)
"RTN","PSAUDP",28,0)
 ;If no monthly activity node, add node with beginning balance.
"RTN","PSAUDP",29,0)
 I '$D(^PSD(58.8,PSALOC,1,PSA50,5,+$E(PSADT,1,5)*100,0)) D
"RTN","PSAUDP",30,0)
 .S DIC="^PSD(58.8,PSALOC,1,PSA50,5,",DIC(0)="L",DIC("P")=$P(^DD(58.8001,20,0),U,2),(X,DINUM)=$E(PSADT,1,5)*100,DA(2)=PSALOC,DA(1)=PSA50
"RTN","PSAUDP",31,0)
 .S DIC("DR")="1////^S X=$G(PSABAL)",DLAYGO=58.8 D ^DIC K DIC,DLAYGO
"RTN","PSAUDP",32,0)
 .;Add current month's node and stuff beginning & ending balance.
"RTN","PSAUDP",33,0)
 .S DIC="^PSD(58.8,PSALOC,1,PSA50,5,",DIC(0)="L",(X,DINUM)=$E(PSADT-100-(+$E(PSADT,4,5)=1*8800),1,5)*100,DA(2)=PSALOC,DA(1)=PSA50,DLAYGO=58.8 D ^DIC K DIC,DLAYGO S DA=+Y
"RTN","PSAUDP",34,0)
 .S DIE="^PSD(58.8,PSALOC,1,PSA50,5,",DA(2)=PSALOC,DA(1)=PSA50,DR="3////^S X=$G(PSABAL)" D ^DIE K DIE
"RTN","PSAUDP",35,0)
 ;Stuff total dispensed
"RTN","PSAUDP",36,0)
 S DIE="^PSD(58.8,PSALOC,1,PSA50,5,",DA(2)=PSALOC,DA(1)=PSA50,DA=$E(PSADT,1,5)*100,DR="9////^S X=$P($G(^(0)),U,6)+PSAQTY" D ^DIE K DIE,DA
"RTN","PSAUDP",37,0)
 ;Get next transaction node number
"RTN","PSAUDP",38,0)
FIND S PSANUM=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSANUM)) S $P(^PSD(58.81,0),"^",3)=$P(^PSD(58.81,0),"^",3)+1 G FIND
"RTN","PSAUDP",39,0)
 ;Add next transaction node with data.
"RTN","PSAUDP",40,0)
 S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSANUM D ^DIC K DIC,DLAYGO
"RTN","PSAUDP",41,0)
 S DIE="^PSD(58.81,",DA=PSANUM
"RTN","PSAUDP",42,0)
 S DR="1////2;2////^S X=PSALOC;3////^S X=PSADT;4////^S X=PSA50;5////^S X=PSAQTY;9////^S X=$G(PSABAL)" D ^DIE K DIE,DA
"RTN","PSAUDP",43,0)
 ;Add activity node
"RTN","PSAUDP",44,0)
 S DIC="^PSD(58.8,PSALOC,1,PSA50,4,",DIC(0)="L",(X,DINUM)=PSANUM,DIC("P")=$P(^DD(58.8001,19,0),"^",2),DA(2)=PSALOC,DA(1)=PSA50,DLAYGO=58.8 D ^DIC K DA,DIC,DLAYGO
"RTN","PSAUDP",45,0)
 L -^PSD(58.8,PSALOC,0)
"RTN","PSAUDP",46,0)
 Q
"RTN","PSAUNI")
0^86^B12029895
"RTN","PSAUNI",1,0)
PSAUNI ;BIR/LTL-Unlinked Drugs in the ITEM MASTER file ;7/23/97
"RTN","PSAUNI",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUNI",3,0)
 ;Check ITEM FILE for unlinked drugs
"RTN","PSAUNI",4,0)
 ;This report lists each active drug in the ITEM MASTER FILE that has not
"RTN","PSAUNI",5,0)
 ;yet been linked to an entry in the DRUG FILE. If you enter a date from
"RTN","PSAUNI",6,0)
 ;which to begin, only items that have been purchased since that date
"RTN","PSAUNI",7,0)
 ;will be listed.
"RTN","PSAUNI",8,0)
 ;
"RTN","PSAUNI",9,0)
 N DIR,PSA,PSADT,X,Y D DT^DICRW
"RTN","PSAUNI",10,0)
 S DIR(0)="D^::AEX",DIR("A")="Please enter oldest purchase date to include",DIR("B")="T-12M",DIR("?")="I will check each active drug to make sure it has been purchased since this date" W ! D ^DIR K DIR I 'Y S PSAOUT=1 G END
"RTN","PSAUNI",11,0)
 S PSADT=Y X ^DD("DD") S PSADT(1)=Y
"RTN","PSAUNI",12,0)
DEV ;asks device and queueing info
"RTN","PSAUNI",13,0)
 K I,IO("Q") N %ZIS,DTOUT,DUOUT,IOP,POP,PSAOUT S %ZIS="0Q" W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSAOUT=1 G END
"RTN","PSAUNI",14,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSAUNI",ZTSAVE("PSA*")="",ZTDESC="Active, Unlinked Drug Report" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSAUNI",15,0)
START ;compiles and prints data for report
"RTN","PSAUNI",16,0)
 N PSALN,PSAPG S (PSA,PSAPG,PSAOUT)=0 D HEADER
"RTN","PSAUNI",17,0)
LOOP F  S PSA=$O(^PRC(441,PSA)) G:'PSA!(PSAOUT) END D:$Y+10>IOSL HEADER I $P($G(^PRC(441,+PSA,0)),U,3)=6505,'$G(^PRC(441,+PSA,3)),$O(^PRC(441,+PSA,4,0)),'$O(^PSDRUG("AB",PSA,"")) D
"RTN","PSAUNI",18,0)
 .W:$E(IOST,1,2)="C-" "."
"RTN","PSAUNI",19,0)
 .S PSA(1)=0
"RTN","PSAUNI",20,0)
 .F  S PSA(1)=$O(^PRC(441,+PSA,4,PSA(1))) Q:'PSA(1)!('$O(^PRC(441,+PSA,4,PSA(1),1,0)))  D  Q:$G(PSA(3))
"RTN","PSAUNI",21,0)
 ..S PSA(2)=0 F  S PSA(2)=$O(^PRC(441,+PSA,4,PSA(1),1,PSA(2))) Q:'PSA(2)  I $P($G(^PRC(442,+$G(^PRC(441,+PSA,4,PSA(1),1,PSA(2),0)),1)),U,15)>PSADT D  Q
"RTN","PSAUNI",22,0)
 ...W !!,"ITEM #: ",PSA,"  ",$P($G(^PRC(441,+PSA,0)),U,2),!!,"NSN: ",$P($G(^(0)),U,5),?25,"LAST VENDOR ORDERED: ",$E($P($G(^PRC(440,+$P($G(^PRC(441,+PSA,0)),U,4),0)),U),1,30)
"RTN","PSAUNI",23,0)
 ...W !!,"NDC: ",$P($G(^PRC(441,+PSA,2,+$P($G(^PRC(441,+PSA,0)),U,4),0)),U,5)
"RTN","PSAUNI",24,0)
 ...S PSA(3)=1
"RTN","PSAUNI",25,0)
 ...W ?20,"LONG DESCRIPTION: "
"RTN","PSAUNI",26,0)
 ...I $L(^PRC(441,+PSA,1,1,0))<40,'$O(^PRC(441,+PSA,1,1)) W $G(^PRC(441,+PSA,1,1,0)),! Q
"RTN","PSAUNI",27,0)
 ...K ^UTILITY($J,"W") S DIWL=40,DIWR=80,DIWF="W"
"RTN","PSAUNI",28,0)
 ...S PSA(4)=0
"RTN","PSAUNI",29,0)
 ...F  S PSA(4)=$O(^PRC(441,+PSA,1,PSA(4))) Q:'PSA(4)  S X=$G(^PRC(441,+PSA,1,PSA(4),0)) D ^DIWP D ^DIWW
"RTN","PSAUNI",30,0)
END I $E(IOST)'="C" W @IOF
"RTN","PSAUNI",31,0)
 I $E(IOST,1,2)="C-",'PSAOUT W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSAUNI",32,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAUNI",33,0)
 Q
"RTN","PSAUNI",34,0)
HEADER ;prints header info
"RTN","PSAUNI",35,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAUNI",36,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAUNI",37,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !?2,"UNLINKED ITEM MASTER file DRUGS PURCHASED SINCE ",PSADT(1),?70,"PAGE: "_PSAPG,!,PSALN,!!
"RTN","PSAUNI",38,0)
 Q
"RTN","PSAUNL")
0^87^B6920762
"RTN","PSAUNL",1,0)
PSAUNL ;BIR/LTL-Connect Unlinked DRUG/ITEM MASTER file Entries ;7/23/97
"RTN","PSAUNL",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUNL",3,0)
 ;
"RTN","PSAUNL",4,0)
 D DT^DICRW
"RTN","PSAUNL",5,0)
STOR ;to store and retrieve a restart drug
"RTN","PSAUNL",6,0)
 N D0,D1,DA,DIC,DIE,DIR,DIRUT,DLAYGO,DR,DTOUT,DUOUT,PSASTOP,PSAIT,PSAS,X,Y S PSAS=+$O(^PS(59.7,0)) G:'$D(^PS(59.7,PSAS,70)) START
"RTN","PSAUNL",7,0)
CHEC W !!,$S($P($G(^VA(200,+$P(^PS(59.7,PSAS,70),U,2),0)),U)]"":$P(^(0),U),1:"Someone")_" was last scanning on "
"RTN","PSAUNL",8,0)
 S Y=$S($P(^PS(59.7,PSAS,70),U,3):$P(^(70),U,3),1:"sometime") X ^DD("DD") W Y_".",!!,"He/she stopped at "_$S($P($G(^PSDRUG(+$P(^PS(59.7,PSAS,70),U),0)),U)]"":$P(^(0),U),1:"... gee, I'm not sure")_".",! D  G:$D(DIRUT) QUIT
"RTN","PSAUNL",9,0)
 .S DIR(0)="Y",DIR("A")="Would you like to start from there" D ^DIR K DIR S:Y=1&($P(^PS(59.7,+PSAS,70),U)) PSAIT=+$P(^PS(59.7,PSAS,70),U)-1
"RTN","PSAUNL",10,0)
START ;compiles edit loop
"RTN","PSAUNL",11,0)
 S:'$D(PSAIT) PSAIT=0
"RTN","PSAUNL",12,0)
LOOP F  S PSAIT=$O(^PSDRUG(PSAIT)) Q:'PSAIT  S PSASTOP=PSAIT I '$O(^PSDRUG(PSAIT,441,0)),'$D(^PSDRUG(PSAIT,"I")) D START^PSATI Q:$D(DIRUT)
"RTN","PSAUNL",13,0)
 W:$G(PSAIT) !,"OK, done with "_$P(^PSDRUG(PSAIT,0),U),!
"RTN","PSAUNL",14,0)
STOP I $G(PSAIT),$D(PSAS),$D(PSASTOP) S DIE="^PS(59.7,",DA=PSAS,DR="70///^S X=PSASTOP;70.1///^S X=""`""_DUZ;70.2///^S X=DT" D ^DIE K DIE W !!,"I'll store this last drug in case you want to resume at this point next time.",!!
"RTN","PSAUNL",15,0)
 W:'$G(PSAIT) !,"**Congratulations, you've reached the end of your DRUG file.**",!
"RTN","PSAUNL",16,0)
QUIT Q
"RTN","PSAUNM")
0^88^B6514917
"RTN","PSAUNM",1,0)
PSAUNM ;BIR/LTL-Report of Unlinked DRUG/ITEM MASTER file Entries ;7/23/97
"RTN","PSAUNM",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUNM",3,0)
 ;
"RTN","PSAUNM",4,0)
 D DT^DICRW
"RTN","PSAUNM",5,0)
DEV ;asks device and queueing info
"RTN","PSAUNM",6,0)
 K IO("Q") N %ZIS,DTOUT,DUOUT,IOP,POP,PSAOUT S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSAOUT=1 G QUIT
"RTN","PSAUNM",7,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSAUNM",ZTDESC="Unlinked DRUG/ITEM FILE entries" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G QUIT
"RTN","PSAUNM",8,0)
START ;compiles and prints data for report
"RTN","PSAUNM",9,0)
 N DIR,DIRUT,POP,PSAB,PSAD,PSADD,PSAIT,PSALN,PSAPG,PSARPDT,X,Y S (PSAD,PSAPG,PSAOUT)=0,Y=DT D DD^%DT S PSARPDT=Y D HEADER
"RTN","PSAUNM",10,0)
LOOP F  S PSAD=$O(^PSDRUG(PSAD)) G:'PSAD QUIT D:$Y+4>IOSL HEADER G:PSAOUT QUIT I '$O(^PSDRUG(PSAD,441,0)),'$D(^PSDRUG(PSAD,"I")) W !!,$E($P(^PSDRUG(PSAD,0),U),1,35),?36,$P(^(0),U,6),?56,$P($G(^(2)),U,4),?75,$S($D(^("ND")):"YES",1:"NO")
"RTN","PSAUNM",11,0)
QUIT I $E(IOST)'="C" W @IOF
"RTN","PSAUNM",12,0)
 I $E(IOST,1,2)="C-",'PSAOUT W !! S DIR(0)="E",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR
"RTN","PSAUNM",13,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAUNM",14,0)
 Q
"RTN","PSAUNM",15,0)
HEADER ;prints header info
"RTN","PSAUNM",16,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAUNM",17,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAUNM",18,0)
 W:$Y @IOF S $P(PSALN,"*",81)="",PSAPG=PSAPG+1 W !?2,"Unlinked DRUG/ITEM MASTER file entries",?55,PSARPDT,?70,"PAGE: "_PSAPG,!,PSALN,!,"DRUG",?36,"FSN",?56,"NDC",?75,"NDF?"
"RTN","PSAUNM",19,0)
 Q
"RTN","PSAUP")
0^89^B48235287
"RTN","PSAUP",1,0)
PSAUP ;BIR/JMB-Upload and Process Prime Vendor Invoice Data ;7/23/97
"RTN","PSAUP",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUP",3,0)
 ;This routine uploads the prime vendor data into ^TMP("PSAPV",$J).
"RTN","PSAUP",4,0)
 ;The  X12 data is checked for proper format. If the X12 data is correct,
"RTN","PSAUP",5,0)
 ;it is loaded into ^XTMP("PSAX12").
"RTN","PSAUP",6,0)
 ;
"RTN","PSAUP",7,0)
 I '$D(^XUSEC("PSA ORDERS",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSAUP",8,0)
 W @IOF,!,"****************************** I M P O R T A N T ******************************"
"RTN","PSAUP",9,0)
 W !!,"This option uploads the invoice data received from your prime vendor.",!,"In order to upload the data, you must be running ProComm Plus software",!,"on Pharmacy's prime vendor PC.",!!
"RTN","PSAUP",10,0)
 S PSASTLN="",$P(PSASTLN,"*",80)="" W PSASTLN,! K PSASTLN
"RTN","PSAUP",11,0)
 S DIR("A")="Are you ready to upload the prime vendor invoice data",DIR(0)="Y",DIR("B")="Yes",DIR("??")="^D YNUPLOAD^PSAUP1" D ^DIR K DIR
"RTN","PSAUP",12,0)
 I 'Y S PSAOUT=1 G KILL
"RTN","PSAUP",13,0)
 I $D(^DIZ(8980,"AOK",DUZ)) S XTKDIC="^TMP(""PSAX12"",$J,",DWLC=0,XTKMODE=2
"RTN","PSAUP",14,0)
 I '$D(^DIZ(8980,"AOK",DUZ)) D RFILE^XTKERM4
"RTN","PSAUP",15,0)
 S PSAOUT=0 K ^TMP("PSAX12",$J)
"RTN","PSAUP",16,0)
 W !!,"Press <ALT> 1 if your Prime Vendor script is installed as a Meta Key,",!,"otherwise press <ALT> F5 and enter ""PV""",!
"RTN","PSAUP",17,0)
 X ^%ZOSF("EOFF") R X:20 X ^%ZOSF("EON") D HASH^XUSHSHP I X'="$4_\y o\Xp>RN}ab*_%," S PSAOUT=1
"RTN","PSAUP",18,0)
 I '$G(PSAOUT) S XTKDIC="^TMP(""PSAX12"",$J,",DWLC=0,XTKMODE=2 D RECEIVE^XTKERMIT
"RTN","PSAUP",19,0)
 I $G(PSAOUT) S XTKERR="The invoice file cannot be uploaded. Contact your IRM staff for assistance." K ^TMP("PSAPV",$J) H 1
"RTN","PSAUP",20,0)
 I $G(XTKERR)'=0 W !!,"ERROR - "_XTKERR S PSAOUT=1 Q
"RTN","PSAUP",21,0)
 I DWLC=0 W !,"ERROR - NO LINES RECEIVED." S PSAOUT=1 Q
"RTN","PSAUP",22,0)
 W @IOF,!,"The data uploaded to a temporary file. "_DWLC," lines received.",!! H 2
"RTN","PSAUP",23,0)
 G:'$O(^TMP("PSAX12",$J,0)) KILL
"RTN","PSAUP",24,0)
 ;
"RTN","PSAUP",25,0)
UNWRAP ;Changes the data element and segment delimiters to ^ & ~, places each
"RTN","PSAUP",26,0)
 ;segment on a node to itself, then removes leading spaces from each
"RTN","PSAUP",27,0)
 ;data element
"RTN","PSAUP",28,0)
 W !,"Unwrapping the invoice."
"RTN","PSAUP",29,0)
 ;
"RTN","PSAUP",30,0)
 ;Get delimiters
"RTN","PSAUP",31,0)
 S (PSABBC,PSAISA,PSALINE,PSASEGD,PSALND)=0
"RTN","PSAUP",32,0)
 F  S PSALINE=$O(^TMP("PSAX12",$J,PSALINE)) Q:'PSALINE  D  Q:PSABBC&(PSAISA)
"RTN","PSAUP",33,0)
 .I $E($G(^TMP("PSAX12",$J,PSALINE,0)),1,3)="ISA" S PSASEGD=$E(^(0),4,4),PSALND=$E(^(0),106,106),PSAISA=1 W "." Q
"RTN","PSAUP",34,0)
 .I $P($G(^TMP("PSAX12",$J,PSALINE,0)),PSASEGD,2)="DS",$P($G(^(0)),PSASEGD,3)="BBC" S PSABBC=1
"RTN","PSAUP",35,0)
 ;If drug company is Bergen (BBC), changes data element to ^ and adds
"RTN","PSAUP",36,0)
 ;segment delimiters to ~.
"RTN","PSAUP",37,0)
 I PSABBC S (PSACNT,PSALINE)=0 F  S PSALINE=$O(^TMP("PSAX12",$J,PSALINE)) Q:'PSALINE  D
"RTN","PSAUP",38,0)
 .S PSADATA=^TMP("PSAX12",$J,PSALINE,0)_"~"
"RTN","PSAUP",39,0)
 .I PSASEGD'="^" S PSADATA=$TR(PSADATA,PSASEGD,"^")
"RTN","PSAUP",40,0)
 .I $E($G(^TMP("PSAX12",$J,PSALINE,0)),1,3)="ISA" W "."
"RTN","PSAUP",41,0)
 .S ^TMP("PSAX12",$J,PSALINE,0)=PSADATA
"RTN","PSAUP",42,0)
 G:PSABBC LINE
"RTN","PSAUP",43,0)
 ;
"RTN","PSAUP",44,0)
 I PSASEGD=""!(PSALND="") D  G KILL
"RTN","PSAUP",45,0)
 .S PSASTAR="",$P(PSASTAR,"*",80)=""
"RTN","PSAUP",46,0)
 .W @IOF,!,PSASTAR,!,"There is a major error in the invoice file.",!,"Contact your IRM Staff for assistance."
"RTN","PSAUP",47,0)
 .W !!,"Press the Esc key then enter YES at the 'EXIT SCRIPT (Y/N)' prompt.",!,"Press RETURN to exit the option.",!,PSASTAR D END^PSAPROC
"RTN","PSAUP",48,0)
 G:PSASEGD="~"&(PSALND="^") LINE
"RTN","PSAUP",49,0)
 ;
"RTN","PSAUP",50,0)
 ;Changes the data element and segment delimiters to ^ and ~.
"RTN","PSAUP",51,0)
 S (PSACNT,PSALINE)=0 F  S PSALINE=$O(^TMP("PSAX12",$J,PSALINE)) Q:'PSALINE  D  Q:PSAOUT
"RTN","PSAUP",52,0)
 .S PSADATA=^TMP("PSAX12",$J,PSALINE,0)
"RTN","PSAUP",53,0)
 .I PSALND'="~" S PSADATA=$TR(PSADATA,PSALND,"~")
"RTN","PSAUP",54,0)
 .I PSASEGD'="^" S PSADATA=$TR(PSADATA,PSASEGD,"^")
"RTN","PSAUP",55,0)
 .S ^TMP("PSAX12",$J,PSALINE,0)=PSADATA
"RTN","PSAUP",56,0)
 .I $P(^TMP("PSAX12",$J,PSALINE,0),"^")="ISA" W "."
"RTN","PSAUP",57,0)
 ;
"RTN","PSAUP",58,0)
LINE ;Places each segment on a node to itself.
"RTN","PSAUP",59,0)
 K ^TMP("PSAPV",$J)
"RTN","PSAUP",60,0)
 S PSAHOLD="",(PSACNT,PSALINE)=0
"RTN","PSAUP",61,0)
 F  S PSALINE=$O(^TMP("PSAX12",$J,PSALINE)) Q:'PSALINE  D
"RTN","PSAUP",62,0)
 .S PSADATA=^TMP("PSAX12",$J,PSALINE,0),PSADATA=PSAHOLD_PSADATA
"RTN","PSAUP",63,0)
 .I PSADATA'["~" S PSAHOLD=PSADATA Q
"RTN","PSAUP",64,0)
 .S PSASTOP=0 F  S PSASEG=$P(PSADATA,"~") Q:PSASEG=""  D  Q:PSASTOP
"RTN","PSAUP",65,0)
 ..S PSACNT=PSACNT+1,^TMP("PSAPV",$J,PSACNT,0)=PSASEG
"RTN","PSAUP",66,0)
 ..I $P(PSASEG,"^")="ISA" W "."
"RTN","PSAUP",67,0)
 ..S PSADATA=$P(PSADATA,"~",2,99) I PSADATA'["~" S PSASTOP=1,PSAHOLD=PSADATA Q
"RTN","PSAUP",68,0)
 ..S PSAHOLD=""
"RTN","PSAUP",69,0)
 ;
"RTN","PSAUP",70,0)
SPACES ;remove all leading spaces in all data elements
"RTN","PSAUP",71,0)
 K ^TMP("PSAX12",$J)
"RTN","PSAUP",72,0)
 S (PSACNT,PSALINE)=0 F  S PSALINE=$O(^TMP("PSAPV",$J,PSALINE)) Q:'PSALINE  D
"RTN","PSAUP",73,0)
 .S PSASEG=^TMP("PSAPV",$J,PSALINE,0)
"RTN","PSAUP",74,0)
 .I $E(PSASEG,1,3)="ISA" S ^TMP("PSAPVS",$J,PSALINE)=^TMP("PSAPV",$J,PSALINE,0) W "." Q
"RTN","PSAUP",75,0)
 .S PSACNT=0,PSASEGL=$L(PSASEG)
"RTN","PSAUP",76,0)
 .F PSAEX=1:1:PSASEGL S PSAX=$E(PSASEG,PSAEX,PSAEX) S:PSAX="^" PSACNT=PSACNT+1
"RTN","PSAUP",77,0)
 .F PSAPC=1:1:(PSACNT+1) S PSADE=$P(PSASEG,"^",PSAPC) D
"RTN","PSAUP",78,0)
 ..F  Q:$E(PSADE,1,1)'=" "  S PSADE=$E(PSADE,2,999)
"RTN","PSAUP",79,0)
 ..S $P(PSASEG,"^",PSAPC)=PSADE
"RTN","PSAUP",80,0)
 .S ^TMP("PSAPVS",$J,PSALINE)=PSASEG
"RTN","PSAUP",81,0)
 K ^TMP("PSAPV",$J)
"RTN","PSAUP",82,0)
 W !,"Finished unwrapping the invoice." H 2
"RTN","PSAUP",83,0)
 ;
"RTN","PSAUP",84,0)
CHECK ;Looks for X12 errors. If no errors, loads data into ^TMP("PSAPV SET",$J)
"RTN","PSAUP",85,0)
 W !!,"Checking the invoice data."
"RTN","PSAUP",86,0)
 D ^PSAUP2
"RTN","PSAUP",87,0)
 K ^TMP("PSAPVS",$J)
"RTN","PSAUP",88,0)
 I PSAOUT K ^TMP("PSAPV SET",$J) G KILL
"RTN","PSAUP",89,0)
 W !,"Finished checking the invoice data." H 2
"RTN","PSAUP",90,0)
 ;
"RTN","PSAUP",91,0)
LOADXTMP ;Loads data into ^XTMP("PSAPV").
"RTN","PSAUP",92,0)
 W !!,"Loading data into VISTA."
"RTN","PSAUP",93,0)
 D XTMP^PSAUP1
"RTN","PSAUP",94,0)
 K ^TMP("PSAPV SET",$J) G:PSAOUT KILL
"RTN","PSAUP",95,0)
 W !,"Finished loading data into VISTA."
"RTN","PSAUP",96,0)
 W !!,"** The upload was successful. **" H 4
"RTN","PSAUP",97,0)
 D END^PSAPROC
"RTN","PSAUP",98,0)
 ;
"RTN","PSAUP",99,0)
STORE ;Get the line item data and store in ^XTMP("PSAPV")
"RTN","PSAUP",100,0)
 W @IOF S PSANEXT=$O(^XTMP("PSAPV",0))
"RTN","PSAUP",101,0)
 I PSANEXT="" W !,"There are no valid invoices to process." H 1 G KILL
"RTN","PSAUP",102,0)
 W !,"Searching for and storing the drug data for each line item."
"RTN","PSAUP",103,0)
 D ^PSAUP5
"RTN","PSAUP",104,0)
 W !,"Finished storing the drug data." H 1
"RTN","PSAUP",105,0)
 ;
"RTN","PSAUP",106,0)
PRINT ;Ask if user wants to print invoices.
"RTN","PSAUP",107,0)
 S PSASTA="U"
"RTN","PSAUP",108,0)
 W ! S DIR(0)="Y",DIR("A")="Print all uploaded invoices",DIR("B")="Y",DIR("?",1)="Enter YES to print the invoices that were uploaded.",DIR("?")="Enter NO to bypass printing the invoices and continue.",DIR("??")="^D YNPRINT^PSAUP1"
"RTN","PSAUP",109,0)
 D ^DIR K DIR G:$G(DIRUT) KILL D:Y ^PSAUP4
"RTN","PSAUP",110,0)
 ;
"RTN","PSAUP",111,0)
PROC ;Ask if user wants to process the invoice data now.
"RTN","PSAUP",112,0)
 W ! S DIR(0)="Y",DIR("A")="Do you want to process the invoices now",DIR("B")="Y",DIR("?",1)="Enter YES to process the invoices that were uploaded.",DIR("?")="Enter NO to exit the option.",DIR("??")="^D YNPROCES^PSAUP1"
"RTN","PSAUP",113,0)
 D ^DIR K DIR G:'Y!($G(DIRUT)) KILL
"RTN","PSAUP",114,0)
 D KILL
"RTN","PSAUP",115,0)
 ;
"RTN","PSAUP",116,0)
PHARM ;Assign a pharmacy location or master vault to each Order.
"RTN","PSAUP",117,0)
 ;Then process the invoice data.
"RTN","PSAUP",118,0)
 S PSAOUT=0
"RTN","PSAUP",119,0)
 D ^PSAPROC G:$G(PSAOUT) EXIT^PSAPROC
"RTN","PSAUP",120,0)
 ;
"RTN","PSAUP",121,0)
PRINT2 W !! S DIR(0)="Y",DIR("A")="Print all unprocessed and just processed invoices",DIR("B")="N"
"RTN","PSAUP",122,0)
 S DIR("?",1)="Enter YES to print all of the uploaded invoices that are",DIR("?")="unprocessed or just processed. Enter NO to exit the option."
"RTN","PSAUP",123,0)
 S DIR("??")="^D PRT2^PSAUP1"
"RTN","PSAUP",124,0)
 D ^DIR K DIR D:+Y ^PSAUP4 S PSAENTRY=0
"RTN","PSAUP",125,0)
 G EXIT^PSAPROC
"RTN","PSAUP",126,0)
 ;
"RTN","PSAUP",127,0)
KILL ;Kills uploading variables
"RTN","PSAUP",128,0)
 K ^TMP("PSAPV",$J),^TMP("PSAPVS",$J),^TMP("PSAPV SET",$J),^TMP("PSAX12",$J)
"RTN","PSAUP",129,0)
 K %,DIR,DIRUT,DWLC,PSABBC,PSACNT,PSACTN1,PSACOMB,PSACS,PSACTRL,PSACTRL2,PSADATA,PSADE,PSADT,PSADUP,PSAENTRY,PSAERR,PSAEX,PSAEXPEC,PSAFND1,PSAGS,PSAHOLD,PSAIEN,PSAIN,PSAINV,PSAINVDT,PSAINVN,PSAISA,PSAISIT,PSAISITN,PSAITCNT,PSAITEM
"RTN","PSAUP",130,0)
 K PSALAST,PSALINE,PSALLCS,PSALLOK,PSALND,PSALOC,PSANDC,PSANEW,PSANEXT,PSANTYPE,PSAOK,PSAORD,PSAORDDT,PSAORDN,PSAOSIT,PSAOSITN,PSAOUT,PSAPC
"RTN","PSAUP",131,0)
 K PSAS,PSASEG,PSASEGL,PSASEGD,PSASS,PSAST,PSASTA,PSASTAR,PSASTCNT,PSASUB,PSASYN,PSAUOM,PSAUOM1,PSAUOMH,PSAUOMH1,PSAVSN,PSAX,X,X1,X2,XTKDIC,XTKERR,XTKMODE,Y
"RTN","PSAUP",132,0)
 Q
"RTN","PSAUP1")
0^90^B26408679
"RTN","PSAUP1",1,0)
PSAUP1 ;BIR/JMB-Upload and Process Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSAUP1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUP1",3,0)
XTMP ;This modules copies the prime vendor data in ^TMP("PSAPV SET",$J) to
"RTN","PSAUP1",4,0)
 ;^XTMP("PSAPV"). The data has passed all X12 checks.
"RTN","PSAUP1",5,0)
 ;
"RTN","PSAUP1",6,0)
 S X1=DT,X2=21 D C^%DTC S ^XTMP("PSAPV",0)=X_"^"_DT_"^Drug Accountability Prime Vendor Uploaded Invoice Data" L +^XTMP("PSAPV",0):0
"RTN","PSAUP1",7,0)
 ;
"RTN","PSAUP1",8,0)
 ;Sets array of orders & invoices in XTMP (uploaded or processed).
"RTN","PSAUP1",9,0)
 S PSACTRL=0 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:'PSACTRL  D
"RTN","PSAUP1",10,0)
 .Q:'$D(^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAUP1",11,0)
 .S PSAIN=^XTMP("PSAPV",PSACTRL,"IN")
"RTN","PSAUP1",12,0)
 .Q:$P(PSAIN,"^",2)=""!($P(PSAIN,"^",4))=""
"RTN","PSAUP1",13,0)
 .S PSADUP($P(PSAIN,"^",4),$P(PSAIN,"^",2))=$S($P(PSAIN,"^",8)="P":"P",1:"U")
"RTN","PSAUP1",14,0)
 ;
"RTN","PSAUP1",15,0)
 ;Sets XTMP if incoming order & invoice is not a duplicate.
"RTN","PSAUP1",16,0)
 S (PSACTRL,PSADUP)=0
"RTN","PSAUP1",17,0)
 F  S PSACTRL=$O(^TMP("PSAPV SET",$J,PSACTRL)) Q:PSACTRL=""  D
"RTN","PSAUP1",18,0)
 .S PSASEG="" F  S PSASEG=$O(^TMP("PSAPV SET",$J,PSACTRL,PSASEG)) Q:PSASEG=""  S PSADUP=0 D
"RTN","PSAUP1",19,0)
 ..I PSASEG'="IT" D  Q
"RTN","PSAUP1",20,0)
 ...I PSASEG="IN" S PSAIN=^TMP("PSAPV SET",$J,PSACTRL,PSASEG) W "." D  Q
"RTN","PSAUP1",21,0)
 ....I $P(PSAIN,"^",2)=""!($P(PSAIN,"^",4)="") K ^TMP("PSAPV SET",$J,PSACTRL),^XTMP("PSAPV",PSACTRL) Q
"RTN","PSAUP1",22,0)
 ....D CHKDUP Q:PSADUP
"RTN","PSAUP1",23,0)
 ....S ^XTMP("PSAPV",PSACTRL,"IN")=^TMP("PSAPV SET",$J,PSACTRL,PSASEG)
"RTN","PSAUP1",24,0)
 ....F PSAPC=1,3,5,6 S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",PSAPC)=$S(+$E($P(^XTMP("PSAPV",PSACTRL,"IN"),"^",PSAPC),1,2)>90:"2",1:"3")_$P(^XTMP("PSAPV",PSACTRL,"IN"),"^",PSAPC)
"RTN","PSAUP1",25,0)
 ....S PSAORD=$P($G(^TMP("PSAPV SET",$J,PSACTRL,"IN")),"^",4),PSAINV=$P($G(^("IN")),"^",2),PSAORDDT=$P($G(^("IN")),"^",3),PSAINVDT=$P($G(^("IN")),"^")
"RTN","PSAUP1",26,0)
 ....W:$D(^TMP("PSAPV SET",$J,PSACTRL,"IT")) !,">> Uploading order# "_PSAORD_", invoice# "_PSAINV
"RTN","PSAUP1",27,0)
 ...I PSASEG'="IN" S ^XTMP("PSAPV",PSACTRL,PSASEG)=^TMP("PSAPV SET",$J,PSACTRL,PSASEG)
"RTN","PSAUP1",28,0)
 ..I PSASEG="IT" S PSALINE=0 F  S PSALINE=$O(^TMP("PSAPV SET",$J,PSACTRL,PSASEG,PSALINE)) Q:'PSALINE  S ^XTMP("PSAPV",PSACTRL,PSASEG,PSALINE)=^TMP("PSAPV SET",$J,PSACTRL,PSASEG,PSALINE)
"RTN","PSAUP1",29,0)
 .K ^TMP("PSAPV SET",$J,PSACTRL)
"RTN","PSAUP1",30,0)
 .I '$D(^XTMP("PSAPV",PSACTRL,"IT")) K ^XTMP("PSAPV",PSACTRL)
"RTN","PSAUP1",31,0)
 L -^XTMP("PSAPV",0)
"RTN","PSAUP1",32,0)
 Q
"RTN","PSAUP1",33,0)
 ;
"RTN","PSAUP1",34,0)
CHKDUP ;Checks for duplicate orders & invoices and duplicates in XTMP.
"RTN","PSAUP1",35,0)
 I $D(PSADUP($P(PSAIN,"^",4),$P(PSAIN,"^",2))) S PSASTA=PSADUP($P(PSAIN,"^",4),$P(PSAIN,"^",2)) D  Q
"RTN","PSAUP1",36,0)
 .W !,"** Order# "_$P(PSAIN,"^",4)_", invoice# "_$P(PSAIN,"^",2)_" has been "
"RTN","PSAUP1",37,0)
 .I PSASTA="U" W " uploaded and",!,"   is awaiting processing. It cannot be uploaded more than once."
"RTN","PSAUP1",38,0)
 .I PSASTA'="U" W " processed and",!,"   is being prepared for verification. It cannot be uploaded more than once."
"RTN","PSAUP1",39,0)
 .D KILLDUP
"RTN","PSAUP1",40,0)
 ;
"RTN","PSAUP1",41,0)
 Q:'$D(^PSD(58.811,"AORD",$P(PSAIN,"^",4),$P(PSAIN,"^",2)))
"RTN","PSAUP1",42,0)
 ;
"RTN","PSAUP1",43,0)
 ;Checks for duplicates in 58.811
"RTN","PSAUP1",44,0)
 S PSAORD=$P(PSAIN,"^",4),PSAINV=$P(PSAIN,"^",2),PSAORDN=$O(^PSD(58.811,"B",PSAORD,0)) Q:'PSAORDN
"RTN","PSAUP1",45,0)
 S PSAINVN=$O(^PSD(58.811,PSAORDN,1,"B",PSAINV,0)) Q:'PSAINVN
"RTN","PSAUP1",46,0)
 Q:'$D(^PSD(58.811,PSAORDN,1,PSAINVN,0))
"RTN","PSAUP1",47,0)
 S PSAIN=^PSD(58.811,PSAORDN,1,PSAINVN,0),PSASTA=$P(PSAIN,"^",3),PSAPC=$S(PSASTA="P":6,PSASTA="V"!(PSASTA="C"):8,1:0)
"RTN","PSAUP1",48,0)
 S (PSADT,PSALINE)=0 F  S PSALINE=$O(^PSD(58.811,PSAORDN,1,PSAINVN,1,PSALINE)) Q:'PSALINE!($G(PSADT))  S PSADT=+$P($G(^PSD(58.811,PSAORDN,1,PSAINVN,1,PSALINE,0)),"^",PSAPC)
"RTN","PSAUP1",49,0)
 W !,"** Order# "_PSAORD_" Invoice# "_PSAINV
"RTN","PSAUP1",50,0)
 S:+PSADT PSADT=$E(PSADT,4,5)_"/"_$E(PSADT,6,7)_"/"_$E(PSADT,2,3)
"RTN","PSAUP1",51,0)
 I PSASTA="P" W " has been processed"_$S(+PSADT:" on "_PSADT,1:"")_" and",!,"   is awaiting verification. It cannot be uploaded more than once."
"RTN","PSAUP1",52,0)
 I PSASTA="V" W !,"   has been verified"_$S(+PSADT:" on "_PSADT,1:"")_"and",!,"   is updating the pharmacy location. It cannot be uploaded more than once."
"RTN","PSAUP1",53,0)
 I PSASTA="C" W " has been completed.",!,"   It cannot be uploaded more than once."
"RTN","PSAUP1",54,0)
 ;
"RTN","PSAUP1",55,0)
KILLDUP S PSADUP=1
"RTN","PSAUP1",56,0)
 K ^TMP("PSAPV SET",$J,PSACTRL),^XTMP("PSAPV",PSACTRL)
"RTN","PSAUP1",57,0)
 Q
"RTN","PSAUP1",58,0)
PRT2 ;Extended help to second "Print invoices?"
"RTN","PSAUP1",59,0)
 W !?5,"Enter YES to print all invoices that are not processed and",!?5,"the invoices that were processed while you were in this option.",!!?5,"Enter NO to exit the option."
"RTN","PSAUP1",60,0)
 Q
"RTN","PSAUP1",61,0)
YNPRINT ;Extended help to "Print invoices?"
"RTN","PSAUP1",62,0)
 W !?5,"Enter YES to print the uploaded invoices. You",!?5,"can check the invoices prior to processing them.",!!?5,"Enter NO to not print the invoices."
"RTN","PSAUP1",63,0)
 Q
"RTN","PSAUP1",64,0)
 ;
"RTN","PSAUP1",65,0)
YNPROCES ;Extended help to "Do you want to process the invoices now?"
"RTN","PSAUP1",66,0)
 W !?5,"Enter YES to begin processing the uploaded invoices.",!!?5,"Enter NO if you do not want to process the invoices now. You can process"
"RTN","PSAUP1",67,0)
 W !?5,"them later by selecting the ""Process Uploaded Prime Vendor Invoice Data"" option."
"RTN","PSAUP1",68,0)
 Q
"RTN","PSAUP1",69,0)
 ;
"RTN","PSAUP1",70,0)
YNUPLOAD ;Extended help to "Are you ready to upload the prime vendor invoice data?"
"RTN","PSAUP1",71,0)
 W !?5,"Enter YES to start uploading the invoices.",!?5,"Enter NO or ""^"" to exit the option."
"RTN","PSAUP1",72,0)
 Q
"RTN","PSAUP1",73,0)
 ;
"RTN","PSAUP2")
0^91^B16813124
"RTN","PSAUP2",1,0)
PSAUP2 ;BIR/JMB-Upload and Process Prime Vendor Invoice Data - CONT'D ;8/13/97
"RTN","PSAUP2",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUP2",3,0)
 ;Checking the X12 invoice data.
"RTN","PSAUP2",4,0)
 K ^TMP("PSAPV SET",$J),PSAERR
"RTN","PSAUP2",5,0)
 S PSALAST=""
"RTN","PSAUP2",6,0)
 S PSALINE=0 F  S PSALINE=$O(^TMP("PSAPVS",$J,PSALINE)) Q:PSALINE=""  S PSADATA=^(PSALINE) D
"RTN","PSAUP2",7,0)
 .;check segment order
"RTN","PSAUP2",8,0)
 .D ^PSAUP3 S PSALAST=$P(PSADATA,"^")
"RTN","PSAUP2",9,0)
ISA .;control header
"RTN","PSAUP2",10,0)
 .I PSALAST="ISA" D  Q
"RTN","PSAUP2",11,0)
 ..S PSAISA=PSADATA,PSACTRL="" W "." I $L($P(PSADATA,"^",14))'=9 S PSASEG="ISA" D MSG^PSAUTL2
"RTN","PSAUP2",12,0)
 .;
"RTN","PSAUP2",13,0)
IEA .;control trailer
"RTN","PSAUP2",14,0)
 .I PSALAST="IEA" D  Q
"RTN","PSAUP2",15,0)
 ..I $P(PSADATA,"^",3)'=$P(PSAISA,"^",14) S PSASEG="IEA" D MSG^PSAUTL2
"RTN","PSAUP2",16,0)
 .;
"RTN","PSAUP2",17,0)
GS .;group header
"RTN","PSAUP2",18,0)
 .I PSALAST="GS" S PSAGS=PSADATA D  Q
"RTN","PSAUP2",19,0)
 ..F %=3,4 S PSAPC=$S(%=3:7,1:9) I $P(PSADATA,"^",%)'=$TR($P(PSAISA,"^",PSAPC)," ") S PSASEG="GS" D MSG^PSAUTL2
"RTN","PSAUP2",20,0)
 .;
"RTN","PSAUP2",21,0)
GE .;group trailer
"RTN","PSAUP2",22,0)
 .I PSALAST="GE" D  Q
"RTN","PSAUP2",23,0)
 ..I $P(PSADATA,"^",3)'=$P($G(PSAGS),"^",7) S PSASEG="GE" D MSG^PSAUTL2
"RTN","PSAUP2",24,0)
 .;
"RTN","PSAUP2",25,0)
ST .;set header
"RTN","PSAUP2",26,0)
 .I PSALAST="ST" D  Q
"RTN","PSAUP2",27,0)
 ..S PSAST=PSADATA,PSACTRL=$P(PSADATA,"^",3),PSASTCNT=1,PSAITCNT=0,PSANTYPE=""
"RTN","PSAUP2",28,0)
 ..I $L(PSACTRL)>3,$L(PSACTRL)<10 Q
"RTN","PSAUP2",29,0)
 ..S PSASEG="ST" D MSG^PSAUTL2 Q
"RTN","PSAUP2",30,0)
 .;
"RTN","PSAUP2",31,0)
SE .;set trailer
"RTN","PSAUP2",32,0)
 .I PSALAST="SE" S PSASTCNT=PSASTCNT+1 D  Q
"RTN","PSAUP2",33,0)
 ..I $P(PSADATA,"^",3)'=PSACTRL S PSASEG="SE1" D MSG^PSAUTL2 Q
"RTN","PSAUP2",34,0)
 ..I PSASTCNT'=$P(PSADATA,"^",2) S PSASEG="SE2" D MSG^PSAUTL2
"RTN","PSAUP2",35,0)
 .;
"RTN","PSAUP2",36,0)
BIG .;beginning segment for invoice
"RTN","PSAUP2",37,0)
 .I PSALAST="BIG" S PSASTCNT=PSASTCNT+1 D  Q
"RTN","PSAUP2",38,0)
 ..I $P(PSADATA,"^",4)="" S $P(PSADATA,"^",4)=$P(PSADATA,"^",2)
"RTN","PSAUP2",39,0)
 ..S $P(PSADATA,"^",5)=$TR($P(PSADATA,"^",5)," ")
"RTN","PSAUP2",40,0)
 ..S ^TMP("PSAPV SET",$J,PSACTRL,"IN")=$P(PSADATA,"^",2,5)
"RTN","PSAUP2",41,0)
 .;
"RTN","PSAUP2",42,0)
REF .;(not used)
"RTN","PSAUP2",43,0)
 .I PSALAST="REF" S PSASTCNT=PSASTCNT+1 Q
"RTN","PSAUP2",44,0)
 .;
"RTN","PSAUP2",45,0)
 .;buyer, seller, shipping addresses
"RTN","PSAUP2",46,0)
N1 .I PSALAST="N1" S PSASTCNT=PSASTCNT+1,PSANTYPE=$P(PSADATA,"^",2) D  Q
"RTN","PSAUP2",47,0)
 ..I PSANTYPE'="BY",PSANTYPE'="DS",PSANTYPE'="ST" S PSASEG="N1" D MSG^PSAUTL2 Q
"RTN","PSAUP2",48,0)
 ..S ^TMP("PSAPV SET",$J,PSACTRL,PSANTYPE)=$P(PSADATA,"^",3)
"RTN","PSAUP2",49,0)
 .;
"RTN","PSAUP2",50,0)
N2 .I PSALAST="N2" D  Q
"RTN","PSAUP2",51,0)
 ..D:PSANTYPE="" NTYPE
"RTN","PSAUP2",52,0)
 ..S $P(^TMP("PSAPV SET",$J,PSACTRL,PSANTYPE),"^",2)=$P(PSADATA,"^",2) S PSASTCNT=PSASTCNT+1
"RTN","PSAUP2",53,0)
 .;
"RTN","PSAUP2",54,0)
N3 .I PSALAST="N3" D  Q
"RTN","PSAUP2",55,0)
 ..D:PSANTYPE="" NTYPE
"RTN","PSAUP2",56,0)
 ..S $P(^TMP("PSAPV SET",$J,PSACTRL,PSANTYPE),"^",3)=$P(PSADATA,"^",2) S PSASTCNT=PSASTCNT+1
"RTN","PSAUP2",57,0)
 .;
"RTN","PSAUP2",58,0)
N4 .I PSALAST="N4" D  Q
"RTN","PSAUP2",59,0)
 ..D:PSANTYPE="" NTYPE
"RTN","PSAUP2",60,0)
 ..S $P(^TMP("PSAPV SET",$J,PSACTRL,PSANTYPE),"^",4,6)=$P(PSADATA,"^",2,4) S PSASTCNT=PSASTCNT+1,PSANTYPE=""
"RTN","PSAUP2",61,0)
 .;
"RTN","PSAUP2",62,0)
DTM .;date time reference
"RTN","PSAUP2",63,0)
 .I PSALAST="DTM" S PSASTCNT=PSASTCNT+1 D  Q
"RTN","PSAUP2",64,0)
 ..S %=$S($P(PSADATA,"^",2)="002":5,$P(PSADATA,"^",2)="035":6,1:0) I '% Q
"RTN","PSAUP2",65,0)
 ..S $P(^TMP("PSAPV SET",$J,PSACTRL,"IN"),"^",%)=$P(PSADATA,"^",3)
"RTN","PSAUP2",66,0)
 .;
"RTN","PSAUP2",67,0)
IT1 .;invoice line item
"RTN","PSAUP2",68,0)
 .I PSALAST="IT1" S PSASTCNT=PSASTCNT+1,PSAITCNT=PSAITCNT+1 D ITEM Q
"RTN","PSAUP2",69,0)
CTT .;item count
"RTN","PSAUP2",70,0)
 .I PSALAST="CTT" S PSASTCNT=PSASTCNT+1 D  Q
"RTN","PSAUP2",71,0)
 ..I PSAITCNT'=$P(PSADATA,"^",2) S PSASEG="CTT" D MSG^PSAUTL2
"RTN","PSAUP2",72,0)
 .;
"RTN","PSAUP2",73,0)
UNKNOWN .;Segment we don't use
"RTN","PSAUP2",74,0)
 .S PSASTCNT=PSASTCNT+1
"RTN","PSAUP2",75,0)
 ;
"RTN","PSAUP2",76,0)
ERROR S PSASEG=$O(PSAERR("")) D:PSASEG'="" ERROR^PSAUTL2
"RTN","PSAUP2",77,0)
 Q
"RTN","PSAUP2",78,0)
 ;
"RTN","PSAUP2",79,0)
NTYPE S PSASEG="NONTYPE" D MSG^PSAUTL2
"RTN","PSAUP2",80,0)
 Q
"RTN","PSAUP2",81,0)
 ;
"RTN","PSAUP2",82,0)
ITEM ;check line item
"RTN","PSAUP2",83,0)
 I '$P(PSADATA,"^",2) S PSASEG="IT1-1" D MSG^PSAUTL2 Q
"RTN","PSAUP2",84,0)
 I $P(PSADATA,"^",6)'="DS" S PSASEG="IT1-2" D MSG^PSAUTL2 Q
"RTN","PSAUP2",85,0)
 I $P(PSADATA,"^",8)="",$P(PSADATA,"^",12)="" S PSASEG="IT1-3" D MSG^PSAUTL2 Q
"RTN","PSAUP2",86,0)
 ;"IT1" Seg=Qty Invoiced ^ Unit of Measure ^ Unit Price ^ Basic Unit Code "DS" ^ NDC ^ VSN
"RTN","PSAUP2",87,0)
 S PSAITEM=+$P(PSADATA,"^",2),^TMP("PSAPV SET",$J,PSACTRL,"IT",PSAITEM)=+$P(PSADATA,"^",3)_"^"_$P(PSADATA,"^",4)_"^"_$P(PSADATA,"^",5)_"^"_$P(PSADATA,"^",8)_"^"_$P(PSADATA,"^",10)
"RTN","PSAUP2",88,0)
 I $P(PSADATA,"^",12)'="",$P(PSADATA,"^",11)="UP" S $P(^TMP("PSAPV SET",$J,PSACTRL,"IT",PSAITEM),"^",26)=$P(PSADATA,"^",12)
"RTN","PSAUP2",89,0)
 Q
"RTN","PSAUP3")
0^92^B2511679
"RTN","PSAUP3",1,0)
PSAUP3 ;BIR/JMB-Upload and Process Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSAUP3",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUP3",3,0)
 ;This routine checks for correct X12 formating.
"RTN","PSAUP3",4,0)
 ;
"RTN","PSAUP3",5,0)
ORDER ;  check order of code sheets
"RTN","PSAUP3",6,0)
 ;  isa   <--------------+
"RTN","PSAUP3",7,0)
 ;    gs    <----------+ |
"RTN","PSAUP3",8,0)
 ;      st    <------+ | |
"RTN","PSAUP3",9,0)
 ;      | big        | | |
"RTN","PSAUP3",10,0)
 ;      | it1   <--+ | | |
"RTN","PSAUP3",11,0)
 ;      | ...      | | | |--repeats
"RTN","PSAUP3",12,0)
 ;      | it1   <--+ | | |
"RTN","PSAUP3",13,0)
 ;      | ctt        | | |
"RTN","PSAUP3",14,0)
 ;      se    <------+ | |
"RTN","PSAUP3",15,0)
 ;    ge    <----------+ |
"RTN","PSAUP3",16,0)
 ;  iea   <--------------+
"RTN","PSAUP3",17,0)
 S PSANEXT=$P(PSADATA,"^")
"RTN","PSAUP3",18,0)
 ;
"RTN","PSAUP3",19,0)
 I PSALAST="GE",PSANEXT="GS" Q
"RTN","PSAUP3",20,0)
 I PSALAST="GE",PSANEXT'="IEA" D ORDERROR("GE",PSANEXT,"IEA") Q
"RTN","PSAUP3",21,0)
 ;
"RTN","PSAUP3",22,0)
 I PSALAST="ISA",PSANEXT'="GS" D ORDERROR("ISA",PSANEXT,"GS") Q
"RTN","PSAUP3",23,0)
 ;
"RTN","PSAUP3",24,0)
 I PSALAST="SE",PSANEXT="ST" Q
"RTN","PSAUP3",25,0)
 I PSALAST="SE",PSANEXT'="GE" D ORDERROR("SE",PSANEXT,"GE") Q
"RTN","PSAUP3",26,0)
 ;
"RTN","PSAUP3",27,0)
 I PSALAST="GS",PSANEXT'="ST" D ORDERROR("GS",PSANEXT,"ST") Q
"RTN","PSAUP3",28,0)
 ;
"RTN","PSAUP3",29,0)
 I PSALAST="CTT",PSANEXT'="SE" D ORDERROR("CTT",PSANEXT,"SE") Q
"RTN","PSAUP3",30,0)
 ;
"RTN","PSAUP3",31,0)
 I PSALAST="ST",PSANEXT'="BIG" D ORDERROR("ST",PSANEXT,"BIG") Q
"RTN","PSAUP3",32,0)
 ;
"RTN","PSAUP3",33,0)
 I PSALAST="IT1",PSANEXT="IT1" Q
"RTN","PSAUP3",34,0)
 I PSALAST="IT1",PSANEXT'="CTT"&(PSANEXT'="TDS") D ORDERROR("IT1",PSANEXT,"CTT") Q
"RTN","PSAUP3",35,0)
 Q
"RTN","PSAUP3",36,0)
 ;
"RTN","PSAUP3",37,0)
ORDERROR(PSALAST,PSANEW,PSAEXPEC) ;Segments out of order
"RTN","PSAUP3",38,0)
 ;ISA segment should be first
"RTN","PSAUP3",39,0)
 I PSALAST="" S PSASEG="ORDER1" D MSG^PSAUTL2 Q
"RTN","PSAUP3",40,0)
 ;Segments other than ISA
"RTN","PSAUP3",41,0)
 S PSASEG="ORDER2" D MSG^PSAUTL2
"RTN","PSAUP3",42,0)
 Q
"RTN","PSAUP4")
0^93^B68852076
"RTN","PSAUP4",1,0)
PSAUP4 ;BIR/JMB-Upload and Process Prime Vendor Invoice Data - CONT'D ;9/19/97
"RTN","PSAUP4",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUP4",3,0)
 ;This routine prints invoices from the ^XTMP global on the screen or
"RTN","PSAUP4",4,0)
 ;to a printer.
"RTN","PSAUP4",5,0)
 ;
"RTN","PSAUP4",6,0)
 W !!,"Enter the device which will be used to print",!,"the invoices with all items, errors, and adjustments.",!
"RTN","PSAUP4",7,0)
 S %ZIS="Q" D ^%ZIS I POP S PSAOUT=1 Q
"RTN","PSAUP4",8,0)
 I $D(IO("Q")) S ZTDESC="Drug Acct. - Prime Vendor Invoice Upload Report",ZTRTN="DQ^PSAUP4" D ^%ZTLOAD Q
"RTN","PSAUP4",9,0)
 ;
"RTN","PSAUP4",10,0)
DQ ;queue starts here
"RTN","PSAUP4",11,0)
 S IOM=80
"RTN","PSAUP4",12,0)
 D NOW^%DTC S Y=% D DD^%DT S PSARUN=$E(Y,1,18),$P(PSASLN,"-",80)="",$P(PSADLN,"=",80)="",(PSADJDRG,PSADJSUP,PSAOUT)=0,PSAFPG=1
"RTN","PSAUP4",13,0)
 U IO
"RTN","PSAUP4",14,0)
 S PSACTRL=0 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""!(PSAOUT)  D START
"RTN","PSAUP4",15,0)
 W @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAUP4",16,0)
 ;
"RTN","PSAUP4",17,0)
EXIT ;Kills printing variables only
"RTN","PSAUP4",18,0)
 K %,%ZIS,DIR,DIRUT,PSAAECST,PSABY,PSACS,PSACTRL,PSADATA,PSADATE,PSADEC,PSADRG,PSADJDRG,PSADJORD,PSADJQTY,PSADJSUP,PSADLN,PSADS,PSAECOST,PSAEND,PSAFPG,PSAICOST,PSAIECST
"RTN","PSAUP4",19,0)
 K PSAIN,PSALINE,PSANDC,PSAODT,PSAODUZ,PSAOREA,PSAOUT,PSAPAGE,PSAPHARM,PSAQDT,PSAQDUZ,PSAQREA,PSAMV,PSARUN,PSAS,PSASLN,PSASS,PSAST,PSASTA,PSATOT,Y,ZTDESC,ZTRTN,ZTSK
"RTN","PSAUP4",20,0)
 Q
"RTN","PSAUP4",21,0)
 ;
"RTN","PSAUP4",22,0)
START S PSAPAGE=1,PSAEND=0 D HEADER S PSAIN=$G(^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAUP4",23,0)
 S (PSADJDRG,PSADJSUP,PSAIECST,PSAAECST)=0,PSAPHARM=$P(PSAIN,"^",7),PSAMV=$P(PSAIN,"^",12)
"RTN","PSAUP4",24,0)
 W !,"PRIME VENDOR : ",$S($P($G(^XTMP("PSAPV",PSACTRL,"DS")),"^")'="":$P($G(^("DS")),"^"),1:"UNKNOWN")
"RTN","PSAUP4",25,0)
 W !!,"ORDER#  : "_$P(PSAIN,"^",4),?40,"ORDER DATE  : "_$$DATE($P(PSAIN,"^",3))
"RTN","PSAUP4",26,0)
 W !,"INVOICE#: "_$P(PSAIN,"^",2),?40,"INVOICE DATE: "_$$DATE(+PSAIN)
"RTN","PSAUP4",27,0)
 S PSASTA=$P(PSAIN,"^",8)
"RTN","PSAUP4",28,0)
 W !,"STATUS  : "_$S(PSASTA="":"UPLOADED WITH ERRORS",PSASTA="OK":"UPLOADED WITHOUT ERRORS",PSASTA="P":"PROCESSED",1:"UNKNOWN")_$S($P(PSAIN,"^",13)="SUP":" (SUPPLY INVOICE)",1:"")
"RTN","PSAUP4",29,0)
 I $Y+8>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER
"RTN","PSAUP4",30,0)
 I $E(IOST,1,2)="C-" D LINE Q
"RTN","PSAUP4",31,0)
 W !!,"DELIVERY DATE REQUESTED: ",$$DATE($P(PSAIN,"^",5))
"RTN","PSAUP4",32,0)
 W !,"DATE RECEIVED          : "_$S(+$P(PSAIN,"^",11)&($$DATE(+$P(PSAIN,"^",11))):" ("_$$DATE($P(PSAIN,"^",6))_")",1:$$DATE($P(PSAIN,"^",6)))
"RTN","PSAUP4",33,0)
 I $Y+8>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:$G(PSAOUT)  D HEADER
"RTN","PSAUP4",34,0)
 ;
"RTN","PSAUP4",35,0)
BUYSHIP W !!,"BUYER INFORMATION:",?40,"SHIPPING INFORMATION:"
"RTN","PSAUP4",36,0)
 S PSABY=$G(^XTMP("PSAPV",PSACTRL,"BY"))
"RTN","PSAUP4",37,0)
 S PSAST=$G(^XTMP("PSAPV",PSACTRL,"ST"))
"RTN","PSAUP4",38,0)
 W !?2,$P(PSABY,"^"),?42,$P(PSAST,"^")
"RTN","PSAUP4",39,0)
 I $P(PSABY,"^",2)'=""!($P(PSAST,"^",2)'="") W ! W:$P(PSABY,"^",2)'="" ?2,$P(PSABY,"^",2) W:$P(PSAST,"^",2)'="" ?42,$P(PSAST,"^",2)
"RTN","PSAUP4",40,0)
 I $P(PSABY,"^",3)'=""!($P(PSAST,"^",3)'="") W ! W:$P(PSABY,"^",3)'="" ?2,$P(PSABY,"^",3) W:$P(PSAST,"^",3)'="" ?42,$P(PSAST,"^",3)
"RTN","PSAUP4",41,0)
 W !?2,$P(PSABY,"^",4)_" "_$P(PSABY,"^",5)_"  ",$P(PSABY,"^",6)
"RTN","PSAUP4",42,0)
 W ?42,$P(PSAST,"^",4)_" "_$P(PSAST,"^",5)_"  ",$P(PSAST,"^",6)
"RTN","PSAUP4",43,0)
 I $Y+8>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER
"RTN","PSAUP4",44,0)
 ;
"RTN","PSAUP4",45,0)
DISTRIB W !!,"DISTRIBUTOR INFORMATION:"
"RTN","PSAUP4",46,0)
 S PSADS=$G(^XTMP("PSAPV",PSACTRL,"DS"))
"RTN","PSAUP4",47,0)
 W !?2,$P(PSADS,"^")
"RTN","PSAUP4",48,0)
 W:$P(PSADS,"^",2)'="" !?2,$P(PSADS,"^",2)
"RTN","PSAUP4",49,0)
 W:$P(PSADS,"^",3)'="" !?2,$P(PSADS,"^",3)
"RTN","PSAUP4",50,0)
 W !?2,$P(PSADS,"^",4)_" "_$P(PSADS,"^",5)_"  ",$P(PSADS,"^",6)
"RTN","PSAUP4",51,0)
 I $Y+8>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER
"RTN","PSAUP4",52,0)
 D LINE
"RTN","PSAUP4",53,0)
 Q
"RTN","PSAUP4",54,0)
 ;
"RTN","PSAUP4",55,0)
DATE(PSADATE)         ;convert date
"RTN","PSAUP4",56,0)
 S %=$E(PSADATE,4,5)_"/"_$E(PSADATE,6,7)_"/"_$E(PSADATE,2,3)
"RTN","PSAUP4",57,0)
 I $TR(%,"/")="" S %="UNKNOWN"
"RTN","PSAUP4",58,0)
 Q %
"RTN","PSAUP4",59,0)
 ;
"RTN","PSAUP4",60,0)
LINE ;print line items
"RTN","PSAUP4",61,0)
 D LINEHDR
"RTN","PSAUP4",62,0)
 S (PSAICOST,PSALINE,PSATOT)=0 F  S PSALINE=$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:'PSALINE!(PSAOUT)  S PSADATA=^(PSALINE),PSADRG=0 D  Q:PSAOUT
"RTN","PSAUP4",63,0)
 .I $Y+5>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAUP4",64,0)
 .K PSADJQTY,PSAQDUZ,PSAQDT,PSAQREA,PSADJORD,PSAODUZ,PSAODT,PSAOREA
"RTN","PSAUP4",65,0)
 .W !,PSALINE
"RTN","PSAUP4",66,0)
DRUG .;Drug
"RTN","PSAUP4",67,0)
 .I +$P(PSADATA,"^",15) S PSADRG=+$P(PSADATA,"^",15) W ?8,"*"_$P($G(^PSDRUG(+$P(PSADATA,"^",15),0)),"^")_$S(+$P(PSADATA,"^",6)&($P($G(^PSDRUG(+$P(PSADATA,"^",6),0)),"^")'=""):" ("_$P(^PSDRUG(+$P(PSADATA,"^",6),0),"^")_")",1:"") S PSADJDRG=1
"RTN","PSAUP4",68,0)
 .I '+$P(PSADATA,"^",15) D
"RTN","PSAUP4",69,0)
 ..I +$P(PSADATA,"^",6),$P($G(^PSDRUG(+$P(PSADATA,"^",6),0)),"^")'="" W ?9,$P(^PSDRUG(+$P(PSADATA,"^",6),0),"^") S PSADRG=+$P(PSADATA,"^",6) Q
"RTN","PSAUP4",70,0)
 ..I $P($G(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")),"^",3)'="" W ?7,"**"_$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP"),"^",3)  S PSADJSUP=1,PSADRG=0 Q
"RTN","PSAUP4",71,0)
 ..W ?9,"DRUG UNKNOWN"
"RTN","PSAUP4",72,0)
 .I $P(PSADATA,"^",19)="CS" W " (CONTROLLED SUBS)" I $P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSADRG,0)),"^",14),$P($G(^(0)),"^",14)'>DT  W !?5,"*** INACTIVE IN MASTER VAULT"
"RTN","PSAUP4",73,0)
 .E  I PSADRG,$P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSADRG,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !?5,"*** INACTIVE IN PHARMACY LOCATION"
"RTN","PSAUP4",74,0)
 .;UPC
"RTN","PSAUP4",75,0)
 .I $P($P(PSADATA,"^",26),"~")'="" W !?9,"UPC: "_$P($P(PSADATA,"^",26),"~")
"RTN","PSAUP4",76,0)
 .;NDC
"RTN","PSAUP4",77,0)
 .S PSANDC=$P($P(PSADATA,"^",4),"~")
"RTN","PSAUP4",78,0)
 .I $E(PSANDC)'="S" D
"RTN","PSAUP4",79,0)
 ..W !?9 I PSANDC?12N W $E(PSANDC,1,6)_"-"_$E(PSANDC,7,10)_"-"_$E(PSANDC,11,12) Q
"RTN","PSAUP4",80,0)
 ..I PSANDC'="" W PSANDC Q
"RTN","PSAUP4",81,0)
 ..W "NDC UNKNOWN"
"RTN","PSAUP4",82,0)
 .;
"RTN","PSAUP4",83,0)
 .;VSN
"RTN","PSAUP4",84,0)
 .W ?25,$S($P($P(PSADATA,"^",5),"~")'="":$E($P($P(PSADATA,"^",5),"~"),1,14),1:"VSN UNKNOWN")
"RTN","PSAUP4",85,0)
 .;
"RTN","PSAUP4",86,0)
 .;QTY
"RTN","PSAUP4",87,0)
 .;No Adjusted Qty
"RTN","PSAUP4",88,0)
 .S PSAIECST=PSAIECST+($P(PSADATA,"^")*$P(PSADATA,"^",3))
"RTN","PSAUP4",89,0)
 .I $P(PSADATA,"^",8)="" W ?40,$J($P(PSADATA,"^"),6) S PSAECOST=$P(PSADATA,"^")*$P(PSADATA,"^",3),PSAAECST=PSAAECST+PSAECOST
"RTN","PSAUP4",90,0)
 .;Adj. Qty (P)
"RTN","PSAUP4",91,0)
 .I $P(PSADATA,"^",8)'="" D
"RTN","PSAUP4",92,0)
 ..S PSADJQTY=$P(PSADATA,"^",8),PSAQDUZ=$P(PSADATA,"^",9),PSAQDT=$P(PSADATA,"^",10),PSAQREA=$P(PSADATA,"^",11)
"RTN","PSAUP4",93,0)
 ..S PSAECOST=PSADJQTY*$P(PSADATA,"^",3),PSAAECST=PSAAECST+PSAECOST
"RTN","PSAUP4",94,0)
 ..W ?40,$J($P(PSADATA,"^",8),6)_"("_$P(PSADATA,"^")_")"
"RTN","PSAUP4",95,0)
 .;
"RTN","PSAUP4",96,0)
 .;Order Unit
"RTN","PSAUP4",97,0)
 .I '+$P(PSADATA,"^",12) D
"RTN","PSAUP4",98,0)
 ..I +$P($P(PSADATA,"^",2),"~",2),$P($G(^DIC(51.5,+$P($P(PSADATA,"^",2),"~",2),0)),"^")'="" W ?53,$P($G(^DIC(51.5,+$P($P(PSADATA,"^",2),"~",2),0)),"^") Q
"RTN","PSAUP4",99,0)
 ..I $P($P(PSADATA,"^",2),"~")="" W ?50,"(Blank)"
"RTN","PSAUP4",100,0)
 .;Adj. OU (P)
"RTN","PSAUP4",101,0)
 .I +$P(PSADATA,"^",12) S PSADJORD=$P(PSADATA,"^",12),PSAODUZ=$P(PSADATA,"^",13),PSAODT=$P(PSADATA,"^",14) W ?53,$P($G(^DIC(51.5,+$P(PSADATA,"^",12),0)),"^")_"("_$P($P(PSADATA,"^",2),"~")_")"
"RTN","PSAUP4",102,0)
 .;Unit price
"RTN","PSAUP4",103,0)
 .S PSADEC=$S($L($P($P(PSADATA,"^",3),".",2))>1:$L($P($P(PSADATA,"^",3),".",2)),1:2)
"RTN","PSAUP4",104,0)
 .W ?59,$J($P(PSADATA,"^",3),7,PSADEC)
"RTN","PSAUP4",105,0)
 .;Extended cost
"RTN","PSAUP4",106,0)
 .W ?67,$J(PSAECOST,12,2)
"RTN","PSAUP4",107,0)
 .I $Y+9>IOSL,+$P(PSADATA,"^",21),+$P(PSADATA,"^",27) D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAUP4",108,0)
 .I +PSADRG D HAVEDRG
"RTN","PSAUP4",109,0)
 .I '+PSADRG W !?9,"STOCK LEVEL  : ",!?9,"REORDER LEVEL: "_$P(PSADATA,"^",21),!?9,"DISPENSE UNITS/ORDER UNIT: "
"RTN","PSAUP4",110,0)
 .;
"RTN","PSAUP4",111,0)
 .;Print Adj Qty
"RTN","PSAUP4",112,0)
 .I $G(PSADJQTY)'="" D
"RTN","PSAUP4",113,0)
 ..I $Y+5>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAUP4",114,0)
 ..W !!?9,"ADJUSTED QUANTITY: "_PSADJQTY,!?9,$$DATE(PSAQDT)_" "_$P($G(^VA(200,+PSAQDUZ,0)),"^"),!?11,PSAQREA
"RTN","PSAUP4",115,0)
 .;Print Adj OU
"RTN","PSAUP4",116,0)
 .I +$G(PSADJORD) D
"RTN","PSAUP4",117,0)
 ..I $Y+5>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAUP4",118,0)
 ..W !!,?9,"ADJUSTED ORDER UNIT: "_$P($G(^DIC(51.5,+PSADJORD,0)),"^")
"RTN","PSAUP4",119,0)
 ..W !?9,$$DATE(PSAODT)_" "_$P($G(^VA(200,+PSAODUZ,0)),"^")_" - "_$P($G(^DIC(51.5,PSADJORD,0)),"^")
"RTN","PSAUP4",120,0)
 .W !
"RTN","PSAUP4",121,0)
 Q:PSAOUT
"RTN","PSAUP4",122,0)
 I $Y+6>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER
"RTN","PSAUP4",123,0)
 W !,PSASLN
"RTN","PSAUP4",124,0)
 W:+PSAAECST'=+PSAIECST !?48,"TOTAL ADUSTED COST",?67,$J(PSAAECST,12,2),!
"RTN","PSAUP4",125,0)
 W !?48,"TOTAL INVOICED COST",?67,$J(PSAIECST,12,2)
"RTN","PSAUP4",126,0)
 S PSAEND=1
"RTN","PSAUP4",127,0)
 I $Y+5>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER
"RTN","PSAUP4",128,0)
 I PSADJDRG,$E(IOST)'="C" W !!,"* THE DRUG WAS MATCHED TO THE DRUG FILE."
"RTN","PSAUP4",129,0)
 I PSADJSUP,$E(IOST)'="C" W !!,"* THE ITEM IS A SUPPLY ITEM."
"RTN","PSAUP4",130,0)
 D:$E(IOST,1,2)="C-" SCREEN
"RTN","PSAUP4",131,0)
 Q
"RTN","PSAUP4",132,0)
 ;
"RTN","PSAUP4",133,0)
LINEHDR ;item header
"RTN","PSAUP4",134,0)
 W !?50,"ORDER",?62,"COST/",?71,"EXTENDED"
"RTN","PSAUP4",135,0)
 W !,"LINE#",?9,"NDC",?25,"VSN",?43,"QTY",?51,"UNIT",?62,"UNIT",?75,"COST",!,PSADLN,!
"RTN","PSAUP4",136,0)
 Q
"RTN","PSAUP4",137,0)
 ;
"RTN","PSAUP4",138,0)
HEADER ;Page header
"RTN","PSAUP4",139,0)
 I PSAFPG&($E(IOST,1,2)="C-") W @IOF G HDR1
"RTN","PSAUP4",140,0)
 S PSAFPG=0
"RTN","PSAUP4",141,0)
 W:'PSAFPG @IOF
"RTN","PSAUP4",142,0)
HDR1 W !?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE"
"RTN","PSAUP4",143,0)
 W !?26,"PRIME VENDOR UPLOAD REPORT",!
"RTN","PSAUP4",144,0)
 W:PSAPAGE'=1 !,"ORDER#: "_$P(PSAIN,"^",4)_"  INVOICE#: "_$P(PSAIN,"^",2)
"RTN","PSAUP4",145,0)
 I $E(IOST,1,2)="C-" W ?(74-$L(PSAPAGE)),"PAGE "_PSAPAGE,!,PSADLN
"RTN","PSAUP4",146,0)
 I $E(IOST)'="C" W !,"RUN: "_PSARUN,?(74-$L(PSAPAGE)),"PAGE "_PSAPAGE,!,PSADLN
"RTN","PSAUP4",147,0)
 S PSAPAGE=PSAPAGE+1
"RTN","PSAUP4",148,0)
 Q
"RTN","PSAUP4",149,0)
SCREEN ;Hold on screen
"RTN","PSAUP4",150,0)
 S PSAS=20-$Y I PSAS F PSASS=1:1:PSAS W !
"RTN","PSAUP4",151,0)
 I PSADJDRG,PSAEND W !," * THE DRUG WAS MATCHED TO THE DRUG FILE."
"RTN","PSAUP4",152,0)
 I PSADJSUP,PSAEND W !,"** THE ITEM IS A SUPPLY ITEM."
"RTN","PSAUP4",153,0)
 S DIR(0)="E" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1
"RTN","PSAUP4",154,0)
 Q
"RTN","PSAUP4",155,0)
 ;
"RTN","PSAUP4",156,0)
HAVEDRG ;Display data if drug is found.
"RTN","PSAUP4",157,0)
 S PSACS=$S($P(^PSDRUG(PSADRG,2),"^",3)["N":1,1:0)
"RTN","PSAUP4",158,0)
 I PSACS D
"RTN","PSAUP4",159,0)
 .I PSAMV,+$P($G(^PSD(58.8,PSAMV,0)),"^",14) D  Q
"RTN","PSAUP4",160,0)
 ..W !?9,"STOCK LEVEL  : "_$S(+$P(PSADATA,"^",27):+$P(PSADATA,"^",27),1:+$P($G(^PSD(58.8,PSAMV,1,PSADRG,0)),"^",3))
"RTN","PSAUP4",161,0)
 ..W !?9,"REORDER LEVEL: "_$S(+$P(PSADATA,"^",21):+$P(PSADATA,"^",21),1:+$P($G(^PSD(58.8,PSAMV,1,PSADRG,0)),"^",5))
"RTN","PSAUP4",162,0)
 .I 'PSAMV W !?9,"STOCK LEVEL  : "_$P(PSADATA,"^",27),!?9,"REORDER LEVEL: "_$P(PSADATA,"^",21)
"RTN","PSAUP4",163,0)
 I 'PSACS D
"RTN","PSAUP4",164,0)
 .I PSAPHARM,+$P($G(^PSD(58.8,PSAPHARM,0)),"^",14) D
"RTN","PSAUP4",165,0)
 ..W !?9,"STOCK LEVEL  : "_$S(+$P(PSADATA,"^",27):+$P(PSADATA,"^",27),1:+$P($G(^PSD(58.8,PSAPHARM,1,PSADRG,0)),"^",3))
"RTN","PSAUP4",166,0)
 ..W !?9,"REORDER LEVEL: "_$S(+$P(PSADATA,"^",21):+$P(PSADATA,"^",21),1:+$P($G(^PSD(58.8,PSAPHARM,1,PSADRG,0)),"^",5))
"RTN","PSAUP4",167,0)
 .I 'PSAPHARM W !?9,"STOCK LEVEL  : "_$P(PSADATA,"^",27),!?9,"REORDER LEVEL: "_$P(PSADATA,"^",21)
"RTN","PSAUP4",168,0)
 W !?9,"DISPENSE UNITS/ORDER UNIT: "
"RTN","PSAUP4",169,0)
 W $S(+$P(PSADATA,"^",20):+$P(PSADATA,"^",20),+$P($G(^PSDRUG(PSADRG,1,+$P(PSADATA,"^",7),0)),"^",7):+$P($G(^PSDRUG(PSADRG,1,+$P(PSADATA,"^",7),0)),"^",7),1:"")
"RTN","PSAUP4",170,0)
 Q
"RTN","PSAUP5")
0^94^B46189416
"RTN","PSAUP5",1,0)
PSAUP5 ;BIR/JMB-Upload and Process Prime Vendor Invoice Data - CONT'D ;10/9/97
"RTN","PSAUP5",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUP5",3,0)
 ;This routine looks in the DRUG file for each line item on the order.
"RTN","PSAUP5",4,0)
 ;It looks for the NDC then VSN. If it is not found, no data is stored.
"RTN","PSAUP5",5,0)
 ;
"RTN","PSAUP5",6,0)
 S PSACTRL=0 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""  D
"RTN","PSAUP5",7,0)
 .I '$D(^XTMP("PSAPV",PSACTRL,"IN"))!($P($G(^XTMP("PSAPV",PSACTRL,"IN")),"^",8)="P") Q
"RTN","PSAUP5",8,0)
 .S PSAIN=^XTMP("PSAPV",PSACTRL,"IN"),PSAORD=$P(PSAIN,"^",4),PSAINV=$P(PSAIN,"^",2),PSACS=0
"RTN","PSAUP5",9,0)
 .W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN)
"RTN","PSAUP5",10,0)
 .S PSALINE=0 F  S PSALINE=$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:'PSALINE  D
"RTN","PSAUP5",11,0)
 ..Q:'$D(^XTMP("PSAPV",PSACTRL,"IT",PSALINE))  Q:$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",18)="P"
"RTN","PSAUP5",12,0)
 ..S PSAOK=1,PSADATA=^XTMP("PSAPV",PSACTRL,"IT",PSALINE),PSANDC=$P(PSADATA,"^",4),PSAVSN=$P(PSADATA,"^",5)
"RTN","PSAUP5",13,0)
 ..DO GETDRUG W "."
"RTN","PSAUP5",14,0)
 ..S:PSAOK $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",18)="OK"
"RTN","PSAUP5",15,0)
 .S (PSACNT,PSALLCS,PSALLOK,PSASUP)=0
"RTN","PSAUP5",16,0)
 .S:PSACS $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",9)="CS"
"RTN","PSAUP5",17,0)
 .S PSALINE=0 F  S PSALINE=+$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:'PSALINE  D
"RTN","PSAUP5",18,0)
 ..S PSACNT=PSACNT+1
"RTN","PSAUP5",19,0)
 ..S:$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",19)="CS" PSALLCS=PSALLCS+1
"RTN","PSAUP5",20,0)
 ..S:$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",18)="OK" PSALLOK=PSALLOK+1
"RTN","PSAUP5",21,0)
 ..S:'+$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6) PSASUP=PSASUP+1
"RTN","PSAUP5",22,0)
 .I PSACNT=PSASUP S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",13)="SUP"
"RTN","PSAUP5",23,0)
 .I PSACNT=PSALLCS S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",10)="ALL CS"
"RTN","PSAUP5",24,0)
 .I PSACNT=PSALLOK S $P(^XTMP("PSAPV",PSACTRL,"IN"),"^",8)="OK"
"RTN","PSAUP5",25,0)
 Q
"RTN","PSAUP5",26,0)
 ;
"RTN","PSAUP5",27,0)
GETDRUG ;Looks for NDC then VSNs in DRUG file.
"RTN","PSAUP5",28,0)
 G:PSANDC=0 GETVSN
"RTN","PSAUP5",29,0)
 I PSANDC'="" S PSAIEN=+$O(^PSDRUG("C",PSANDC,0)) I PSAIEN S PSASUB=+$O(^PSDRUG("C",PSANDC,PSAIEN,0)) G FOUND
"RTN","PSAUP5",30,0)
 ;
"RTN","PSAUP5",31,0)
GETVSN ;Looks for Vendor Stock Number then NDC.
"RTN","PSAUP5",32,0)
 I PSAVSN'="" S PSAIEN=+$O(^PSDRUG("AVSN",PSAVSN,0)) I PSAIEN S PSASUB=+$O(^PSDRUG("AVSN",PSAVSN,PSAIEN,0)) G FOUND
"RTN","PSAUP5",33,0)
 ;
"RTN","PSAUP5",34,0)
 I (PSANDC=""&PSANDC'=0),$P(PSADATA,"^",26)'="" D ^PSAUP6
"RTN","PSAUP5",35,0)
 ;
"RTN","PSAUP5",36,0)
 S:'+$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6) PSAOK=0
"RTN","PSAUP5",37,0)
 G UOM
"RTN","PSAUP5",38,0)
 ;
"RTN","PSAUP5",39,0)
FOUND ;Store line item data if ordered item was found in DRUG file.
"RTN","PSAUP5",40,0)
 I $P($G(^PSDRUG(PSAIEN,2)),"^",3)["N" S PSACS=1,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",19)="CS"
"RTN","PSAUP5",41,0)
 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6)=PSAIEN,$P(^(PSALINE),"^",7)=PSASUB
"RTN","PSAUP5",42,0)
 ;
"RTN","PSAUP5",43,0)
NDC ;If >1 NDC in DRUG file, store how many.
"RTN","PSAUP5",44,0)
 ;^XTMP $P4=NDC ~ # of nodes with same VSN (if >1 NDC) ~ VSN if different
"RTN","PSAUP5",45,0)
 ;          than one on SYNONYM multiple (if 1 NDC)
"RTN","PSAUP5",46,0)
 I PSANDC'="",$O(^PSDRUG("C",PSANDC,0)) D
"RTN","PSAUP5",47,0)
 .S (PSACNT,PSACNT1,PSAFND,PSAFND1,PSAIEN50)=0
"RTN","PSAUP5",48,0)
 .F  S PSAIEN50=+$O(^PSDRUG("C",PSANDC,PSAIEN50)) Q:'PSAIEN50  S PSASYN=0 F  S PSASYN=+$O(^PSDRUG("C",PSANDC,PSAIEN50,PSASYN)) Q:'PSASYN  D
"RTN","PSAUP5",49,0)
 ..Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAUP5",50,0)
 ..I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^",4)=PSAVSN S PSAFND=PSAFND+1,PSAFND1=PSAIEN50_"^"_PSASYN Q
"RTN","PSAUP5",51,0)
 ..I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^",4)'=PSAVSN S PSACNT=PSACNT+1,PSACNT1=PSAIEN50_"^"_PSASYN
"RTN","PSAUP5",52,0)
 .;
"RTN","PSAUP5",53,0)
 .;If NDC & VSN match, set ^XTMP
"RTN","PSAUP5",54,0)
 .I PSAFND=1 S PSAIEN=$P(PSAFND1,"^"),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6)=PSAIEN,PSASUB=$P(PSAFND1,"^",2),$P(^(PSALINE),"^",7)=PSASUB,$P(^(PSALINE),"^",4)=PSANDC Q
"RTN","PSAUP5",55,0)
 .;
"RTN","PSAUP5",56,0)
 .;If >1 with same NDC & VSN, set # with same NDC & VSN in ^XTMP & flag
"RTN","PSAUP5",57,0)
 .I PSAFND>1 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)_"~"_PSAFND,PSAOK=0 Q
"RTN","PSAUP5",58,0)
 .;
"RTN","PSAUP5",59,0)
 .;If 1 NDC and ...
"RTN","PSAUP5",60,0)
 .I PSACNT=1 S PSAIEN=$P(PSACNT1,"^"),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6)=PSAIEN,PSASUB=$P(PSACNT1,"^",2),$P(^(PSALINE),"^",7)=PSASUB D  Q
"RTN","PSAUP5",61,0)
 ..;VSN is null, accept as found & set ^XTMP
"RTN","PSAUP5",62,0)
 ..I $P(^PSDRUG(PSAIEN,1,PSASUB,0),"^",4)="" S PSAIEN=$P(PSACNT1,"^"),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6)=PSAIEN,PSASUB=$P(PSACNT1,"^",2),$P(^(PSALINE),"^",7)=PSASUB,$P(^(PSALINE),"^",4)=PSANDC Q
"RTN","PSAUP5",63,0)
 ..;Different VSN, set VSN in NDC piece in ^XTMP
"RTN","PSAUP5",64,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)_"~~"_$P(^PSDRUG(PSAIEN,1,PSASUB,0),"^",4),PSAOK=0
"RTN","PSAUP5",65,0)
 .;
"RTN","PSAUP5",66,0)
 .;If >1 NDC with differnt VSN, set flag in NDC piece of ^XTMP
"RTN","PSAUP5",67,0)
 .I PSACNT>1 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)_"~"_PSACNT,PSAOK=0
"RTN","PSAUP5",68,0)
 ;
"RTN","PSAUP5",69,0)
VSN ;If there >1 VSN with same VSN, store how many.
"RTN","PSAUP5",70,0)
 ;^XTMP $P5=VSN ~ # of nodes with same UOM (if >1 VSN) ~ NDC if different
"RTN","PSAUP5",71,0)
 ;          than one on SYNONYM multiple (if 1 VSN)
"RTN","PSAUP5",72,0)
 I PSAVSN'="",$O(^PSDRUG("AVSN",PSAVSN,0))  D
"RTN","PSAUP5",73,0)
 .S (PSACNT,PSACNT1,PSAFND,PSAFND1,PSAIEN50)=0
"RTN","PSAUP5",74,0)
 .F  S PSAIEN50=+$O(^PSDRUG("AVSN",PSAVSN,PSAIEN50)) Q:'PSAIEN50  S PSASYN=0 F  S PSASYN=+$O(^PSDRUG("AVSN",PSAVSN,PSAIEN50,PSASYN)) Q:'PSASYN  D
"RTN","PSAUP5",75,0)
 ..Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAUP5",76,0)
 ..I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^")=PSANDC S PSAFND=PSAFND+1,PSAFND1=PSAIEN50_"^"_PSASYN Q
"RTN","PSAUP5",77,0)
 ..I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^")'=PSANDC S PSACNT=PSACNT+1,PSACNT1=PSAIEN50_"^"_PSASYN
"RTN","PSAUP5",78,0)
 .;
"RTN","PSAUP5",79,0)
 .;If VSN & NDC match, set ^XTMP
"RTN","PSAUP5",80,0)
 .I PSAFND=1 D  Q
"RTN","PSAUP5",81,0)
 ..I '+$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6) D
"RTN","PSAUP5",82,0)
 ...S PSAIEN=$P(PSAFND1,"^"),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6)=PSAIEN,PSASUB=$P(PSAFND1,"^",2),$P(^(PSALINE),"^",7)=PSASUB
"RTN","PSAUP5",83,0)
 ...S:$P($G(^PSDRUG(PSAIEN,2)),"^",3)["N" $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",19)="CS",PSACS=1
"RTN","PSAUP5",84,0)
 ...S:$P($G(^PSDRUG(PSAIEN,2)),"^",3)'["N" $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",19)="",PSACS=0
"RTN","PSAUP5",85,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=PSAVSN
"RTN","PSAUP5",86,0)
 .;
"RTN","PSAUP5",87,0)
 .;If >1 with same VSN & NDC, set # with same NDC & VSN in ^XTMP & flag
"RTN","PSAUP5",88,0)
 .I PSAFND>1 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)_"~"_PSAFND,PSAOK=0 Q
"RTN","PSAUP5",89,0)
 .;
"RTN","PSAUP5",90,0)
 .;If 1 VSN and ...
"RTN","PSAUP5",91,0)
 .I PSACNT=1 D  Q
"RTN","PSAUP5",92,0)
 ..I '+$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6) S PSAIEN=$P(PSACNT1,"^"),$P(^(PSALINE),"^",6)=PSAIEN,PSASUB=$P(PSACNT1,"^",2),$P(^(PSALINE),"^",7)=PSASUB
"RTN","PSAUP5",93,0)
 ..;NDC is null, accept as found & set ^XTMP
"RTN","PSAUP5",94,0)
 ..I $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)="" S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=PSAVSN,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=$P(^PSDRUG(PSAIEN,1,PSASUB,0),"^") Q
"RTN","PSAUP5",95,0)
 ..;Different VSN, set VSN in NDC piece in ^XTMP
"RTN","PSAUP5",96,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)_"~~"_$P(^PSDRUG(PSAIEN,1,PSASUB,0),"^"),PSAOK=0
"RTN","PSAUP5",97,0)
 .;
"RTN","PSAUP5",98,0)
 .;If >1 VSN with different NDC, set flag in NDC piece of ^XTMP
"RTN","PSAUP5",99,0)
 .I PSACNT>1 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)_"~"_PSACNT,PSAOK=0
"RTN","PSAUP5",100,0)
 ;
"RTN","PSAUP5",101,0)
UOM ;Locates X12 Unit of Measure Code in ORDER UNIT file.
"RTN","PSAUP5",102,0)
 ;^XTMP $P2=Alpha OU ~ 51.5 IEN
"RTN","PSAUP5",103,0)
 K PSAUOM I $P(PSADATA,"^",2)="" S PSAOK=0 G QTY
"RTN","PSAUP5",104,0)
 ;
"RTN","PSAUP5",105,0)
 ;If order unit is standard order unit, set IEN in ^XTMP
"RTN","PSAUP5",106,0)
 S PSAUOM=$O(^DIC(51.5,"B",$P($P(PSADATA,"^",2),"~"),0))
"RTN","PSAUP5",107,0)
 I 'PSAUOM D  Q:'PSAOK
"RTN","PSAUP5",108,0)
 .I +$P(PSADATA,"^",6),+$P(PSADATA,"^",7),+$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",5) D
"RTN","PSAUP5",109,0)
 ..S PSAUOM=+$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",5),PSAUOMN=$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",2),"~")
"RTN","PSAUP5",110,0)
 ..S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",2)=PSAUOMN_"~"_PSAUOM K PSAUOMN
"RTN","PSAUP5",111,0)
 .S:'PSAUOM PSAOK=0
"RTN","PSAUP5",112,0)
 I PSAUOM S PSAUOMN=$P($P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",2),"~"),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",2)=PSAUOMN_"~"_PSAUOM K PSAUOMN
"RTN","PSAUP5",113,0)
 ;
"RTN","PSAUP5",114,0)
QTY ;If qty is 0 or blank, set flag
"RTN","PSAUP5",115,0)
 I '+$P(PSADATA,"^") S PSAOK=0 Q
"RTN","PSAUP5",116,0)
 ;
"RTN","PSAUP5",117,0)
DUOU ;If no dispense units per order unit, set flag.
"RTN","PSAUP5",118,0)
 S PSADRG=$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6),PSASYN=$P(^(PSALINE),"^",7)
"RTN","PSAUP5",119,0)
 S:'PSASYN PSAOK=0
"RTN","PSAUP5",120,0)
 I PSASYN,'$P($G(^PSDRUG(PSADRG,1,PSASYN,0)),"^",7) S PSAOK=0
"RTN","PSAUP5",121,0)
 Q
"RTN","PSAUP6")
0^95^B7903113
"RTN","PSAUP6",1,0)
PSAUP6 ;BIR/JMB-Upload and Process Prime Vendor Invoice Data - CONT'D ;7/23/97
"RTN","PSAUP6",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUP6",3,0)
 ;This routine looks in the DRUG file for a supply line item. It looks
"RTN","PSAUP6",4,0)
 ;for a NDC with an "S" in front of the UPC. It then looks for a matching
"RTN","PSAUP6",5,0)
 ;VSN. If it is found, the NDC becomes "S"_UPC.
"RTN","PSAUP6",6,0)
 ;
"RTN","PSAUP6",7,0)
UPC ;If there is no NDC, the VSN is not found, & there is a UPC, look
"RTN","PSAUP6",8,0)
 ;for a supply item.
"RTN","PSAUP6",9,0)
 S (PSACNT,PSACNT1,PSAFND,PSAFND1,PSAIEN50)=0,PSASUP="S"_$P($P(PSADATA,"^",26),"~")
"RTN","PSAUP6",10,0)
 F  S PSAIEN50=+$O(^PSDRUG("C",PSASUP,PSAIEN50)) Q:'PSAIEN50  S PSASYN=0 F  S PSASYN=+$O(^PSDRUG("C",PSASUP,PSAIEN50,PSASYN)) Q:'PSASYN  D
"RTN","PSAUP6",11,0)
 .Q:'$D(^PSDRUG(PSAIEN50,1,PSASYN,0))
"RTN","PSAUP6",12,0)
 .I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^",4)=PSAVSN S PSAFND=PSAFND+1,PSAFND1=PSAIEN50_"^"_PSASYN Q
"RTN","PSAUP6",13,0)
 .I $P(^PSDRUG(PSAIEN50,1,PSASYN,0),"^",4)'=PSAVSN S PSACNT=PSACNT+1,PSACNT1=PSAIEN50_"^"_PSASYN
"RTN","PSAUP6",14,0)
 ;
"RTN","PSAUP6",15,0)
 ;If VSN & UPC match, set ^XTMP
"RTN","PSAUP6",16,0)
 I PSAFND=1 D  Q
"RTN","PSAUP6",17,0)
 .S PSAIEN=$P(PSAFND1,"^"),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6)=PSAIEN,PSASUB=$P(PSAFND1,"^",2),$P(^(PSALINE),"^",7)=PSASUB
"RTN","PSAUP6",18,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=PSAVSN,PSANDC=PSASUP,$P(^(PSALINE),"^",4)=PSANDC
"RTN","PSAUP6",19,0)
 ;
"RTN","PSAUP6",20,0)
 ;If >1 with same VSN & UPC, set # with same UPC & VSN in ^XTMP & flag
"RTN","PSAUP6",21,0)
 I PSAFND>1 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",26)=$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",26)_"~"_PSAFND,PSAOK=0 Q
"RTN","PSAUP6",22,0)
 ;
"RTN","PSAUP6",23,0)
 ;If 1 UPC and ...
"RTN","PSAUP6",24,0)
 I PSACNT=1 S PSAIEN=$P(PSACNT1,"^"),$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",6)=PSAIEN,PSASUB=$P(PSACNT1,"^",2),$P(^(PSALINE),"^",7)=PSASUB D  Q
"RTN","PSAUP6",25,0)
 .;VSN is null, accept as found & set ^XTMP
"RTN","PSAUP6",26,0)
 .I $P(^PSDRUG(PSAIEN,1,PSASUB,0),"^",4)="" S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",5)=PSAVSN,PSANDC=PSASUP,$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",4)=PSANDC Q
"RTN","PSAUP6",27,0)
 .;Different VSN, set VSN in UPC piece in ^XTMP
"RTN","PSAUP6",28,0)
 .S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",26)=$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",26)_"~~"_$P(^PSDRUG(PSAIEN,1,PSASUB,0),"^",5),PSAOK=0
"RTN","PSAUP6",29,0)
 ;
"RTN","PSAUP6",30,0)
 ;If >1 VSN with differnt NDC, set flag in NDC piece of ^XTMP
"RTN","PSAUP6",31,0)
 I PSACNT>1 S $P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",26)=$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE),"^",26)_"~"_PSACNT,PSAOK=0
"RTN","PSAUP6",32,0)
 Q
"RTN","PSAUTL")
0^96^B3306487
"RTN","PSAUTL",1,0)
PSAUTL ;BIR/LTL-GIP Utility ;7/23/97
"RTN","PSAUTL",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUTL",3,0)
 ;This routine is a utility that checks for Primarys already linked to
"RTN","PSAUTL",4,0)
 ;a pharmacy location. It also returns the ITEM MASTER file's internal
"RTN","PSAUTL",5,0)
 ;entry number of an item. It is called by PSALNA, PSALND, PSALNM, and;
"RTN","PSAUTL",6,0)
 ;PSATI.
"RTN","PSAUTL",7,0)
 ;
"RTN","PSAUTL",8,0)
DALINK ;check for Primary already linked to DA location
"RTN","PSAUTL",9,0)
 I $O(^PSD(58.8,"P",X,0)) S PSA=$P($G(^PSD(58.8,+$O(^PSD(58.8,"P",X,0)),0)),U)_" is already linked to "_$$INVNAME^PRCPUX1(X)_"." D EN^DDIOL(PSA) K PSA,X Q
"RTN","PSAUTL",10,0)
 Q
"RTN","PSAUTL",11,0)
FI N PSA S PSA=$O(^PSDRUG("AB",+X,0)) S:PSA=DA PSA=$O(^(DA)) W:$G(PSA) $C(7),!!,$P($G(^PSDRUG(+$O(^PSDRUG("AB",+X,"")),0)),U)," is already linked to",!!,"Item #",X,"  ",$$DESCR^PRCPUX1(0,X) S:$G(PSA) X="" Q
"RTN","PSAUTL",12,0)
 ;
"RTN","PSAUTL",13,0)
ITEM(PSA) ;return Item Master # ^PRC(441
"RTN","PSAUTL",14,0)
 ;PSA = NDC from ^PSDRUG(
"RTN","PSAUTL",15,0)
 S PSA(1)=$O(^PRC(441,"F",PSA,0))
"RTN","PSAUTL",16,0)
 D:'PSA(1)
"RTN","PSAUTL",17,0)
 .S:$L($P(PSA,"-"))<6 PSA(1)=$O(^PRC(441,"F",0_PSA,0))
"RTN","PSAUTL",18,0)
 .S:'PSA(1)&($L($P(PSA,"-"))=4) PSA(1)=$O(^PRC(441,"F","00"_PSA,0))
"RTN","PSAUTL",19,0)
 .I 'PSA(1),'$E(PSA),$L($P(PSA,"-"))>4 S PSA(1)=$O(^PRC(441,"F",$E(PSA,2,14),0))
"RTN","PSAUTL",20,0)
 .I 'PSA(1),'$E(PSA,1,2),$L($P(PSA,"-"))=6 S PSA(1)=$O(^PRC(441,"F",$E(PSA,3,14),0))
"RTN","PSAUTL",21,0)
 Q PSA(1)
"RTN","PSAUTL",22,0)
 ;
"RTN","PSAUTL1")
0^97^B34722514
"RTN","PSAUTL1",1,0)
PSAUTL1 ;BIR/JMB-Prime Vendor Invoice Data Utility ;9/19/97
"RTN","PSAUTL1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUTL1",3,0)
 ;This routine contains utilities to get the location name, display an
"RTN","PSAUTL1",4,0)
 ;error-free item, display an item with errors, and display a line ready
"RTN","PSAUTL1",5,0)
 ;for verification. It is called by PSADJ, PSAHIS, PSALEVEL, PSALEVRP,
"RTN","PSAUTL1",6,0)
 ;PSANDF, PSAPROC, PSAPROC1, PSAPROC2, PSAPROC4, PSAPROC6, PSAPROC9,
"RTN","PSAUTL1",7,0)
 ;PSAREORD, PSAUTL3, PSAVER, PSAVER1, PSAVER2, PSAVER4, and PSAVER5.
"RTN","PSAUTL1",8,0)
 ;
"RTN","PSAUTL1",9,0)
SITES ;Gets the combined IP/OP's IP & OP site names
"RTN","PSAUTL1",10,0)
 S PSAISIT=+$P(^PSD(58.8,PSALOC,0),"^",3),PSAOSIT=+$P(^(0),"^",10)
"RTN","PSAUTL1",11,0)
 S PSAISITN=$S($P($G(^PS(59.4,PSAISIT,0)),"^")'="":$P($G(^PS(59.4,PSAISIT,0)),"^"),1:"UNKNOWN")
"RTN","PSAUTL1",12,0)
 S PSAOSITN=$S($P($G(^PS(59,PSAOSIT,0)),"^")'="":$P($G(^PS(59,PSAOSIT,0)),"^"),1:"UNKNOWN")
"RTN","PSAUTL1",13,0)
 I PSAISIT,PSAOSIT S PSACOMB=": "_PSAISITN_" (IP) "_PSAOSITN_" (OP)" Q
"RTN","PSAUTL1",14,0)
 I PSAISIT S PSACOMB=": "_PSAISITN_" (IP)" Q
"RTN","PSAUTL1",15,0)
 I PSAOSIT S PSACOMB=": "_PSAOSITN_" (OP)"
"RTN","PSAUTL1",16,0)
 Q
"RTN","PSAUTL1",17,0)
 ;
"RTN","PSAUTL1",18,0)
DISPLAY ;Displays an error-free line item
"RTN","PSAUTL1",19,0)
 S PSADISP=1
"RTN","PSAUTL1",20,0)
 S PSAIEN=$P(PSADATA,"^",6),PSASUB=$P($P(PSADATA,"^",7),"~"),PSANDC=$P($P(PSADATA,"^",4),"~"),PSAVSN=$P($P(PSADATA,"^",5),"~")
"RTN","PSAUTL1",21,0)
 W !,PSALINE_"  "_$S($P($G(^PSDRUG(PSAIEN,0)),"^")'="":$P(^PSDRUG(PSAIEN,0),"^"),1:"UNKNOWN")
"RTN","PSAUTL1",22,0)
 I PSAIEN D
"RTN","PSAUTL1",23,0)
 .I $P($G(^PSDRUG(PSAIEN,2)),"^",3)["N" W " (Controlled Substance)" I $P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSAIEN,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !,$C(7),$C(7),"** INACTIVE IN MASTER VAULT **" Q
"RTN","PSAUTL1",24,0)
 .I $P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSAIEN,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !,$C(7),$C(7),"** INACTIVE IN PHARMACY LOCATION **"
"RTN","PSAUTL1",25,0)
 W !,"Qty Invoiced: "_+$P(PSADATA,"^")
"RTN","PSAUTL1",26,0)
 W:$P($P(PSADATA,"^",26),"~")'="" ?38,"UPC: "_$P($P(PSADATA,"^",26),"~")
"RTN","PSAUTL1",27,0)
 W !,"Order Unit  : "
"RTN","PSAUTL1",28,0)
 S PSAOU=$S(+$P(PSADATA,"^",12):+$P(PSADATA,"^",12),+$P($P(PSADATA,"^",2),"~",2):+$P($P(PSADATA,"^",2),"~",2),PSAIEN&(PSASUB)&(+$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",5)):+$P(^PSDRUG(PSAIEN,1,PSASUB,0),"^",5),1:0)
"RTN","PSAUTL1",29,0)
 W $S(PSAOU:$P($G(^DIC(51.5,+PSAOU,0)),"^"),1:"UNKNOWN")
"RTN","PSAUTL1",30,0)
 W:$E(PSANDC)'="S" ?38,"NDC: "_$E(PSANDC,1,6)_"-"_$E(PSANDC,7,10)_"-"_$E(PSANDC,11,12)
"RTN","PSAUTL1",31,0)
 W !,"Unit Price  : $"_$P(PSADATA,"^",3),?38,"VSN: "_$S(PSAVSN'="":PSAVSN,1:"Blank"),!
"RTN","PSAUTL1",32,0)
 W !,"Dispense Units: "_$S(+PSAIEN&($P($G(^PSDRUG(+PSAIEN,660)),"^",8)'=""):$P($G(^PSDRUG(+PSAIEN,660)),"^",8),1:"Blank")
"RTN","PSAUTL1",33,0)
 W !,"Dispense Units Per Order Unit: "_$S($P(PSADATA,"^",20):+$P(PSADATA,"^",20),+PSASUB&(+$P($G(^PSDRUG(+PSAIEN,1,PSASUB,0)),"^",7)):+$P($G(^PSDRUG(+PSAIEN,1,PSASUB,0)),"^",7),1:"Blank")
"RTN","PSAUTL1",34,0)
 S PSALOC=$S($P(PSADATA,"^",19)="":+$P(PSAIN,"^",7),1:+$P(PSAIN,"^",12))
"RTN","PSAUTL1",35,0)
 Q:'+$P($G(^PSD(58.8,+PSALOC,0)),"^",14)!('$G(PSAIEN))
"RTN","PSAUTL1",36,0)
 S PSASTOCK=$S(+$P(PSADATA,"^",27):+$P(PSADATA,"^",27),+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",3):+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",3),1:"Blank")
"RTN","PSAUTL1",37,0)
 W !,"Stock Level   : "_PSASTOCK
"RTN","PSAUTL1",38,0)
 S PSAREORD=$S(+$P(PSADATA,"^",20):+$P(PSADATA,"^",20),+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",5):+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",5),1:"Blank")
"RTN","PSAUTL1",39,0)
 W !,"Reorder Level : "_PSAREORD,!
"RTN","PSAUTL1",40,0)
 Q
"RTN","PSAUTL1",41,0)
 ;
"RTN","PSAUTL1",42,0)
EDITDISP ;Displays a line item with errors.
"RTN","PSAUTL1",43,0)
 W @IOF,!?23,"<<< PROCESS LINE ITEM SCREEN >>>",!,"Order#: "_$P(PSAIN,"^",4)_"  Invoice#: "_$P(PSAIN,"^",2)_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN),!,PSASLN
"RTN","PSAUTL1",44,0)
EDIT1 S PSADATA=$G(^XTMP("PSAPV",PSACTRL,"IT",PSALINE))
"RTN","PSAUTL1",45,0)
 S PSALOC=$S($P(PSADATA,"^",19)="":+$P(PSAIN,"^",7),1:+$P(PSAIN,"^",12))
"RTN","PSAUTL1",46,0)
 W !,PSALINE_"  "_$S($D(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")):$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP"),"^",3),PSAIEN&($P($G(^PSDRUG(PSAIEN,0)),"^")'=""):$P(^PSDRUG(PSAIEN,0),"^"),1:"UNKNOWN ITEM")
"RTN","PSAUTL1",47,0)
 I PSAIEN D
"RTN","PSAUTL1",48,0)
 .I $P($G(^PSDRUG(PSAIEN,2)),"^",3)["N" W " (Controlled Substance)" I $P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSAIEN,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !,$C(7),$C(7),"** INACTIVE IN MASTER VAULT **" Q
"RTN","PSAUTL1",49,0)
 .I $P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSAIEN,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !,$C(7),$C(7),"** INACTIVE IN PHARMACY LOCATION **"
"RTN","PSAUTL1",50,0)
 ;
"RTN","PSAUTL1",51,0)
 W !,"Qty Invoiced: "
"RTN","PSAUTL1",52,0)
 I $P(PSADATA,"^",8)'="" W +$P(PSADATA,"^",8)_" ("_$S(+PSADATA:+PSADATA,$P(PSADATA,"^")=0:0,1:"Blank")_")"
"RTN","PSAUTL1",53,0)
 I $P(PSADATA,"^",8)="" W $S(+PSADATA:+PSADATA,$P(PSADATA,"^")=0:0,1:"Blank")
"RTN","PSAUTL1",54,0)
 W:$P($P(PSADATA,"^",26),"~")'="" ?38,"UPC: "_$P($P(PSADATA,"^",26),"~")
"RTN","PSAUTL1",55,0)
 ;
"RTN","PSAUTL1",56,0)
 W !,"Order Unit  : "
"RTN","PSAUTL1",57,0)
 I +$P(PSADATA,"^",12) D
"RTN","PSAUTL1",58,0)
 .W $P($G(^DIC(51.5,+$P(PSADATA,"^",12),0)),"^")
"RTN","PSAUTL1",59,0)
 .W " ("_$S($P($P(PSADATA,"^",2),"~")'="":$P($P(PSADATA,"^",2),"~"),$P($G(^DIC(51.5,+$P($P(PSADATA,"^",2),"~",3),0)),"^")'="":$P($G(^DIC(51.5,+$P($P(PSADATA,"^",2),"~",3),0)),"^"),1:"Blank")_")"
"RTN","PSAUTL1",60,0)
 I '+$P(PSADATA,"^",12) D
"RTN","PSAUTL1",61,0)
 .W $S(+$P($P(PSADATA,"^",2),"~",2):$P($P(PSADATA,"^",2),"~"),PSAIEN&(PSASUB)&(+$P($G(^PSDRUG(PSAIEN,1,PSASUB,0)),"^",5)):$P($G(^DIC(51.5,+$P(^PSDRUG(PSAIEN,1,PSASUB,0),"^",5),0)),"^"),1:"Blank")
"RTN","PSAUTL1",62,0)
 ;
"RTN","PSAUTL1",63,0)
 W:$E(PSANDC)'="S" ?38,"NDC: "_$S(PSANDC'="":$E(PSANDC,1,6)_"-"_$E(PSANDC,7,10)_"-"_$E(PSANDC,11,12),1:"Blank")
"RTN","PSAUTL1",64,0)
 S PSAPRICE=$P(PSADATA,"^",3)
"RTN","PSAUTL1",65,0)
 I +PSAPRICE,$L($P(PSAPRICE,".",2))<2 S PSAPRICE=$P(PSAPRICE,".")_"."_$P(PSAPRICE,".",2)_$E("00",1,(2-$L($P(PSAPRICE,".",2))))
"RTN","PSAUTL1",66,0)
 W !,"Unit Price  : $"_$S(+PSAPRICE:PSAPRICE,PSAPRICE=0:0,1:"Blank"),?38,"VSN: "_$S(PSAVSN'="":PSAVSN,1:"Blank"),!
"RTN","PSAUTL1",67,0)
 S PSAIN=^XTMP("PSAPV",PSACTRL,"IN"),PSALOC=$S($P(PSADATA,"^",19)="CS":+$P(PSAIN,"^",12),1:+$P(PSAIN,"^",7))
"RTN","PSAUTL1",68,0)
DU W !,"Dispense Units: "_$S(+PSAIEN&($P($G(^PSDRUG(+PSAIEN,660)),"^",8)'=""):$P($G(^PSDRUG(+PSAIEN,660)),"^",8),1:"Blank")
"RTN","PSAUTL1",69,0)
DUOU W !,"Dispense Units Per Order Unit: "_$S($P(PSADATA,"^",20):+$P(PSADATA,"^",20),+PSASUB&(+$P($G(^PSDRUG(+PSAIEN,1,PSASUB,0)),"^",7)):+$P($G(^PSDRUG(+PSAIEN,1,PSASUB,0)),"^",7),1:"Blank"),!
"RTN","PSAUTL1",70,0)
 ;
"RTN","PSAUTL1",71,0)
 Q:'+$P($G(^PSD(58.8,+PSALOC,0)),"^",14)
"RTN","PSAUTL1",72,0)
 ;
"RTN","PSAUTL1",73,0)
 S PSASTOCK=$S(+$P(PSADATA,"^",27):+$P(PSADATA,"^",27),+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",3):+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",3),1:"Blank")
"RTN","PSAUTL1",74,0)
 W "Stock Level   : "_PSASTOCK
"RTN","PSAUTL1",75,0)
 S PSAREORD=$S(+$P(PSADATA,"^",21):+$P(PSADATA,"^",21),+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",5):+$P($G(^PSD(58.8,+PSALOC,1,+PSAIEN,0)),"^",5),1:"Blank")
"RTN","PSAUTL1",76,0)
 W !,"Reorder Level : "_PSAREORD,!
"RTN","PSAUTL1",77,0)
 Q
"RTN","PSAUTL2")
0^98^B15097031
"RTN","PSAUTL2",1,0)
PSAUTL2 ;BIR/JMB-Upload and Process Prime Vendor Invoice Data Utility ;9/19/97
"RTN","PSAUTL2",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUTL2",3,0)
 ;This routine is a utility that writes X12 errors to the screen. It is
"RTN","PSAUTL2",4,0)
 ;used during the uploading of prime vendor invoices. It is called by
"RTN","PSAUTL2",5,0)
 ;PSAUP2 and PSAUP3.
"RTN","PSAUTL2",6,0)
 ;
"RTN","PSAUTL2",7,0)
ERROR ;Writes X12 error messages.
"RTN","PSAUTL2",8,0)
 S PSASLN="",$P(PSASLN,"-",80)=""
"RTN","PSAUTL2",9,0)
 W @IOF,!,"The format of the invoice file is incorrect."
"RTN","PSAUTL2",10,0)
 W !,"Call your IRM staff and relay the error messages listed below."
"RTN","PSAUTL2",11,0)
 W !!,"ERROR MESSAGES:",!,PSASLN S PSAOUT=1
"RTN","PSAUTL2",12,0)
 S PSACTRL2="" F  S PSACTRL2=$O(PSAERR(PSACTRL2)) Q:PSACTRL2=""  W !!,"Control# "_PSACTRL2_":" D
"RTN","PSAUTL2",13,0)
 .S PSASEG="" F  S PSASEG=$O(PSAERR(PSACTRL2,PSASEG)) Q:PSASEG=""  W !,PSAERR(PSACTRL2,PSASEG)
"RTN","PSAUTL2",14,0)
 S PSAS=22-$Y F PSASS=1:1:PSAS W !
"RTN","PSAUTL2",15,0)
 S DIR(0)="E",DIR("A")="Press ESC, answer Yes to the ""EXIT SCRIPT?"" question, then press RETURN." D ^DIR K DIR
"RTN","PSAUTL2",16,0)
 Q
"RTN","PSAUTL2",17,0)
MSG S:$G(PSACTRL)="" PSACTRL="UNKNOWN"
"RTN","PSAUTL2",18,0)
 I PSASEG="ISA" S PSAERR(PSACTRL,PSASEG)="The ISA control# (piece 14) should be 9 characters in length." Q
"RTN","PSAUTL2",19,0)
 I PSASEG="IEA" S PSAERR(PSACTRL,PSASEG)="The IEA control# (piece 3) should equal the ISA control# (piece 14 = "_$P($G(PSAISA),"^",14)_")" Q
"RTN","PSAUTL2",20,0)
 I PSASEG="GS" S PSAERR(PSACTRL,PSASEG)="GS piece "_%_" should equal ISA's piece "_$G(PSAPC)_" ("_$TR($P($G(PSAISA),"^",$G(PSAPC))," ")_")." Q
"RTN","PSAUTL2",21,0)
 I PSASEG="GE" S PSAERR(PSACTRL,PSASEG)="The GE control# (piece 3) should equal GS's control# piece 7 ("_$P($G(PSAGS),"^",7)_")." Q
"RTN","PSAUTL2",22,0)
 I PSASEG="ST" S PSAERR(PSACTRL,PSASEG)="The ST control# (piece 3) should be 4 to 9 characters in length." Q
"RTN","PSAUTL2",23,0)
 I $E(PSASEG,1,2)="SE" D  Q
"RTN","PSAUTL2",24,0)
 .I PSASEG="SE1" S PSAERR(PSACTRL,PSASEG)="The SE control# (piece 3) should be equal to ST's control# (piece 3 = "_PSACTRL_")" Q
"RTN","PSAUTL2",25,0)
 .I PSASEG="SE2" S PSAERR(PSACTRL,PSASEG)="SE's count of segments (piece 2) should equal the number of segments ("_$G(PSASTCNT)_")."
"RTN","PSAUTL2",26,0)
 I PSASEG="N1" S PSAERR(PSACTRL,PSASEG)="N1's piece 2 should equal 'BY', 'DS' OR 'ST'."
"RTN","PSAUTL2",27,0)
 I PSASEG="NONTYPE" S PSAERR(PSACTRL,PSASEG)="The identifier segment 'N1' needs to come before the '"_$P($G(PSADATA),"^")_"' segment." Q
"RTN","PSAUTL2",28,0)
 I PSASEG="CTT" S PSAERR(PSACTRL,PSASEG)="CTT's line item count (piece 2) should equal the number of line items ("_$G(PSAITCNT)_")."
"RTN","PSAUTL2",29,0)
 I $E(PSASEG,1,3)="IT1" D  Q
"RTN","PSAUTL2",30,0)
 .I PSASEG="IT1-1" S PSAERR(PSACTRL,PSASEG)="The IT1 invoice line number "_$G(PSAITEM)_" (piece 2) is not defined." Q
"RTN","PSAUTL2",31,0)
 .I PSASEG="IT1-2" S PSAERR(PSACTRL,PSASEG)="The IT1 unit price code (piece 6) should equal 'DS' for discount." Q
"RTN","PSAUTL2",32,0)
 .I PSASEG="IT1-3" S PSAERR(PSACTRL,PSASEG)="The IT1 does not contain a NDC (piece 8) or an UPC (piece 12)."
"RTN","PSAUTL2",33,0)
 I PSASEG="ORDER1" S PSAERR(PSACTRL,PSASEG)="Segments are out of order. The starting segment should be 'ISA', not '"_$G(PSANEW)_"'." Q
"RTN","PSAUTL2",34,0)
 I PSASEG="ORDER2" S PSAERR(PSACTRL,PSASEG)="Segments are out of order. The segment following '"_$G(PSALAST)_"' should be '"_$G(PSAEXPEC)_"', not '"_$G(PSANEW)_"'."
"RTN","PSAUTL2",35,0)
 Q
"RTN","PSAUTL2",36,0)
NONTYPE ;
"RTN","PSAUTL2",37,0)
 I PSANTYPE="" S PSASEG="NONTYPE" D ERROR
"RTN","PSAUTL2",38,0)
 Q
"RTN","PSAUTL3")
0^99^B22365082
"RTN","PSAUTL3",1,0)
PSAUTL3 ;BIR/JMB-Upload and Process Prime Vendor Invoice Data Utility - CONT'D ;7/23/97
"RTN","PSAUTL3",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUTL3",3,0)
 ;This utility displays locations & allows user to select one, many, or
"RTN","PSAUTL3",4,0)
 ;all locations.
"RTN","PSAUTL3",5,0)
 ;
"RTN","PSAUTL3",6,0)
 S PSALOC=+$O(^PSD(58.8,"ADISP","P",0))
"RTN","PSAUTL3",7,0)
 I 'PSALOC W !!?5,"No Drug Accountability location has been created yet." S PSAOUT=1 G EXIT
"RTN","PSAUTL3",8,0)
 ;
"RTN","PSAUTL3",9,0)
ORDER ;If more than one pharmacy location, collect them in alpha order.
"RTN","PSAUTL3",10,0)
 S (PSACNT,PSALOC)=0 W !
"RTN","PSAUTL3",11,0)
 F  S PSALOC=+$O(^PSD(58.8,"ADISP","P",PSALOC)) Q:'PSALOC  D
"RTN","PSAUTL3",12,0)
 .Q:'$D(^PSD(58.8,PSALOC,0))!($P($G(^PSD(58.8,PSALOC,0)),"^")="")
"RTN","PSAUTL3",13,0)
 .I +$G(^PSD(58.8,PSALOC,"I")),+^PSD(58.8,PSALOC,"I")'>DT Q
"RTN","PSAUTL3",14,0)
 .I '$D(PSATRAN) Q:'$O(^PSD(58.8,PSALOC,1,0))
"RTN","PSAUTL3",15,0)
 .D SITES^PSAUTL1
"RTN","PSAUTL3",16,0)
 .S PSACNT=PSACNT+1,PSAONE=+PSALOC
"RTN","PSAUTL3",17,0)
 .S PSALOCA($P(^PSD(58.8,PSALOC,0),"^")_PSACOMB,PSALOC)=$P(^(0),"^",3)_"^"_$P(^(0),"^",10)_"^"_$P($G(^PSD(58.8,PSALOC,"I")),"^")
"RTN","PSAUTL3",18,0)
 I PSACNT=1 G:$G(PSATRAN)="" ONE W !?5,"There is only one active pharmacy location.",!?5,"There must be at least two to transfer drugs." S PSAOUT=1 Q
"RTN","PSAUTL3",19,0)
 S PSACHK=$O(PSALOCA("")) I PSACHK="" G EXIT
"RTN","PSAUTL3",20,0)
 G DISP
"RTN","PSAUTL3",21,0)
 ;
"RTN","PSAUTL3",22,0)
ONE ;only one
"RTN","PSAUTL3",23,0)
 S PSALOC=PSAONE
"RTN","PSAUTL3",24,0)
 I '$D(^PSD(58.8,PSALOC,0))!($P($G(^PSD(58.8,PSALOC,0)),"^")="") W !,"There are no Drug Accountability pharmacy locations with data." Q
"RTN","PSAUTL3",25,0)
 S PSALOCN="",PSALOCN=$O(PSALOCA(PSALOCN)) Q:PSALOCN=""  S PSALOC=0,PSALOC=+$O(PSALOCA(PSALOCN,PSALOC)) Q:'PSALOC  S PSALOC(PSALOCN,PSALOC)=PSALOCA(PSALOCN,PSALOC)
"RTN","PSAUTL3",26,0)
 G EXIT
"RTN","PSAUTL3",27,0)
 ;
"RTN","PSAUTL3",28,0)
DISP ;Displays the available pharmacy locations.
"RTN","PSAUTL3",29,0)
 W @IOF,!
"RTN","PSAUTL3",30,0)
 W:$G(PSATRAN)="F" "Choose the pharmacy location transferring the drugs:"
"RTN","PSAUTL3",31,0)
 W:$G(PSATRAN)="T" "Choose the pharmacy location receiving the transferred drugs:"
"RTN","PSAUTL3",32,0)
 W:$G(PSATRAN)="" "Choose one or many pharmacy locations:"
"RTN","PSAUTL3",33,0)
 W ! S PSACNT=0,PSALOCN=""
"RTN","PSAUTL3",34,0)
 F  S PSALOCN=$O(PSALOCA(PSALOCN)) Q:PSALOCN=""  D
"RTN","PSAUTL3",35,0)
 .S PSALOC=0 F  S PSALOC=+$O(PSALOCA(PSALOCN,PSALOC)) Q:'PSALOC  D
"RTN","PSAUTL3",36,0)
 ..S PSACNT=PSACNT+1,PSAMENU(PSACNT,PSALOCN,PSALOC)=""
"RTN","PSAUTL3",37,0)
 ..W !,$J(PSACNT,2)
"RTN","PSAUTL3",38,0)
 ..W:$L(PSALOCN)>76 ?4,$P(PSALOCN,"(IP)",1)_"(IP)",!?21,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 ?4,PSALOCN
"RTN","PSAUTL3",39,0)
 W !
"RTN","PSAUTL3",40,0)
 ;
"RTN","PSAUTL3",41,0)
SELECT I $G(PSATRAN)="" S DIR(0)="L^1:"_PSACNT,DIR("A")="Select PHARMACY LOCATION",DIR("??")="^D HELP^PSAUTL3"
"RTN","PSAUTL3",42,0)
 I $G(PSATRAN)="F"!($G(PSATRAN)="T") S DIR(0)="N^1:"_PSACNT D
"RTN","PSAUTL3",43,0)
 .I $G(PSATRAN)="F" S DIR("A")="Select Transfer from Pharmacy",DIR("??")="^D FROMHELP^PSAUTL3"
"RTN","PSAUTL3",44,0)
 .I $G(PSATRAN)="T" S DIR(0)="N^1:"_PSACNT,DIR("A")="Select Transfer to Pharmacy",DIR("??")="^D TOHELP^PSAUTL3"
"RTN","PSAUTL3",45,0)
 S DIR("?")="Enter the number(s) of the pharmacy location"
"RTN","PSAUTL3",46,0)
 D ^DIR K DIR I 'Y S PSAOUT=1 G EXIT
"RTN","PSAUTL3",47,0)
 S PSASEL=Y F PSAPC=1:1 S PSANUM=+$P(PSASEL,",",PSAPC) Q:'PSANUM  D
"RTN","PSAUTL3",48,0)
 .S PSALOCN=$O(PSAMENU(PSANUM,"")),PSALOC=+$O(PSAMENU(PSANUM,PSALOCN,0))
"RTN","PSAUTL3",49,0)
 .S PSALOC(PSALOCN,PSALOC)=PSALOCA(PSALOCN,PSALOC)
"RTN","PSAUTL3",50,0)
 ;
"RTN","PSAUTL3",51,0)
EXIT ;Kills all variables except PSALOC array & PSAOUT
"RTN","PSAUTL3",52,0)
 K DIR,PSACOMB,PSAISIT,PSAISITN,PSAMENU,PSAONE,PSANUM,PSAOSIT,PSAOSITN,PSAPC,Y
"RTN","PSAUTL3",53,0)
 Q
"RTN","PSAUTL3",54,0)
 ;
"RTN","PSAUTL3",55,0)
FROMHELP ;Extended help to 'Select Transfer from Pharmacy'
"RTN","PSAUTL3",56,0)
 W !?5,"Enter the number of the pharmacy location that will transfer the drugs to another pharmacy."
"RTN","PSAUTL3",57,0)
 Q
"RTN","PSAUTL3",58,0)
HELP ;Extended help to 'Select PHARMACY LOCATION'
"RTN","PSAUTL3",59,0)
 W !?5,"Enter the number of the pharmacy location you want to select.",!?5,"If you want more than one pharmacy location, enter the numbers",!?5,"separated by a comma."
"RTN","PSAUTL3",60,0)
 W !!?5,"For example: Enter 1,3 or 1-3,5."
"RTN","PSAUTL3",61,0)
 Q
"RTN","PSAUTL3",62,0)
TOHELP ;Extended help to 'Select Transfer to Pharmacy'
"RTN","PSAUTL3",63,0)
 W !?5,"Enter the number of the pharmacy location that will receive the transferred the drugs."
"RTN","PSAUTL3",64,0)
 Q
"RTN","PSAUTL3",65,0)
 ;
"RTN","PSAUTL3",66,0)
SETAORD ;Set logic for "AORD" X-Ref
"RTN","PSAUTL3",67,0)
 S PSADA(1)=$O(^PSD(58.811,"B",X,0))
"RTN","PSAUTL3",68,0)
 S PSADA=0 F  S PSADA=$O(^PSD(58.811,PSADA(1),1,PSADA)) Q:'PSADA  D
"RTN","PSAUTL3",69,0)
 .S ^PSD(58.811,"AORD",X,$P($G(^PSD(58.811,PSADA(1),1,PSADA,0)),"^"),PSADA(1),PSADA)=""
"RTN","PSAUTL3",70,0)
 K PSADA
"RTN","PSAUTL3",71,0)
 Q
"RTN","PSAUTL3",72,0)
KILLAORD ;Kill logic for "AORD" X-Ref
"RTN","PSAUTL3",73,0)
 K ^PSD(58.811,"AORD",X)
"RTN","PSAUTL3",74,0)
 Q
"RTN","PSAUTL3",75,0)
 ;
"RTN","PSAUTL3",76,0)
SLOC ;Set logic for "ALOC" X-Ref on Pharmacy Location & Master Vault fields
"RTN","PSAUTL3",77,0)
 Q:'+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",2)
"RTN","PSAUTL3",78,0)
 S ^PSD(58.811,"ALOC",X,+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",2),DA(1),DA)=""
"RTN","PSAUTL3",79,0)
 Q
"RTN","PSAUTL3",80,0)
KLOC ;Kill logic for "ALOC" X-Ref on Pharmacy Location & Master Vault fields
"RTN","PSAUTL3",81,0)
 K ^PSD(58.811,"ALOC",X,+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",2),DA(1),DA)
"RTN","PSAUTL3",82,0)
 Q
"RTN","PSAUTL3",83,0)
 ;
"RTN","PSAUTL3",84,0)
SLOCDT ;Set logic for "ALOC" X-Ref on Invoice Date field
"RTN","PSAUTL3",85,0)
 S:+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",5) ^PSD(58.811,"ALOC",+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",5),X,DA(1),DA)=""
"RTN","PSAUTL3",86,0)
 S:+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",12) ^PSD(58.811,"ALOC",+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",12),X,DA(1),DA)=""
"RTN","PSAUTL3",87,0)
 Q
"RTN","PSAUTL3",88,0)
KLOCDT ;Kill logic for "ALOC" X-Ref
"RTN","PSAUTL3",89,0)
 K ^PSD(58.811,"ALOC",+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",5),X,DA(1),DA)
"RTN","PSAUTL3",90,0)
 K ^PSD(58.811,"ALOC",+$P($G(^PSD(58.811,DA(1),1,DA,0)),"^",12),X,DA(1),DA)
"RTN","PSAUTL3",91,0)
 Q
"RTN","PSAUTL4")
0^100^B22876816
"RTN","PSAUTL4",1,0)
PSAUTL4 ;BIR ISC/JMB-Verify Invoices Utility ; 8/19/97
"RTN","PSAUTL4",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAUTL4",3,0)
 ;This routine contains an utility to display a line item ready for
"RTN","PSAUTL4",4,0)
 ;verification. It is called by PSAVER1 and PSAVER2.
"RTN","PSAUTL4",5,0)
 ;
"RTN","PSAUTL4",6,0)
VERDISP ;Displays a line item on a processed or verified invoice
"RTN","PSAUTL4",7,0)
 W PSALINEN_"  "
"RTN","PSAUTL4",8,0)
DRUG S PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","D",0))
"RTN","PSAUTL4",9,0)
 I +PSADJ D
"RTN","PSAUTL4",10,0)
 .S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0))
"RTN","PSAUTL4",11,0)
 .S PSADJD=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAUTL4",12,0)
 .I PSADJD'?1.N S PSASUP=1
"RTN","PSAUTL4",13,0)
 .S PSADRG=$S(PSADJ&('PSASUP):+PSADJD,PSADJ&(PSASUP):0,1:+$P(PSADATA,"^",2))
"RTN","PSAUTL4",14,0)
 .I +PSADJD,$L(PSADJD)=+$L(PSADJD),$P($G(^PSDRUG(+PSADJD,0)),"^")'="" W "*"_$P($G(^PSDRUG(+PSADJD,0)),"^") S (PSADRG,PSA50IEN)=+PSADJD Q
"RTN","PSAUTL4",15,0)
 .I +PSADJD,$L(PSADJD)=+$L(PSADJD),$P($G(^PSDRUG(+PSADJD,0)),"^")="" S (PSADJ,PSADRG)=0 Q
"RTN","PSAUTL4",16,0)
 .W ?7,"**"_PSADJD S PSADJSUP=1,(PSADRG,PSA50IEN)=PSADJD
"RTN","PSAUTL4",17,0)
 I '+PSADJ D
"RTN","PSAUTL4",18,0)
 .S (PSA50IEN,PSADRG)=$S(+$P(PSADATA,"^",2)&($P($G(^PSDRUG(+$P(PSADATA,"^",2),0)),"^")'=""):+$P(PSADATA,"^",2),1:0)
"RTN","PSAUTL4",19,0)
 .W $S(+$P(PSADATA,"^",2)&($P($G(^PSDRUG(+$P(PSADATA,"^",2),0)),"^")'=""):$P(^PSDRUG(+$P(PSADATA,"^",2),0),"^"),1:"DRUG UNKNOWN")
"RTN","PSAUTL4",20,0)
 I PSADRG D
"RTN","PSAUTL4",21,0)
 .I $P($G(^PSDRUG(PSADRG,2)),"^",3)["N" W " (Controlled Substance)" I $P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSADRG,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !,$C(7),$C(7),"** INACTIVE IN MASTER VAULT **" Q
"RTN","PSAUTL4",22,0)
 .I $P($G(^PSD(58.8,+$P(PSAIN,"^",5),1,PSADRG,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !,$C(7),$C(7),"** INACTIVE IN PHARMACY LOCATION **"
"RTN","PSAUTL4",23,0)
QTY W !,"Qty Invoiced: "
"RTN","PSAUTL4",24,0)
 ;No Adj. Qty
"RTN","PSAUTL4",25,0)
 S PSADJQ="",PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","Q",0))
"RTN","PSAUTL4",26,0)
 I +PSADJ S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)),PSADJQ=$S($P(PSANODE,"^",6)'="":+$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAUTL4",27,0)
 ;Adj. Qty
"RTN","PSAUTL4",28,0)
 I +PSADJQ S PSAQTY=PSADJQ W PSAQTY_" ("_$S(+$P(PSADATA,"^",3):+$P(PSADATA,"^",3),$P(PSADATA,"^",3)=0:0,1:"Blank")_")"
"RTN","PSAUTL4",29,0)
 I '+PSADJQ W $P(PSADATA,"^",3) S PSAQTY=+$P(PSADATA,"^",3)
"RTN","PSAUTL4",30,0)
UPC W:$P(PSADATA,"^",13)'="" ?38,"UPC: "_$P(PSADATA,"^",13)
"RTN","PSAUTL4",31,0)
OU W !,"Order Unit  : "
"RTN","PSAUTL4",32,0)
 S PSAOU=$S(+$P(PSADATA,"^",4)&($P($G(^DIC(51.5,+$P(PSADATA,"^",4),0)),"^")'=""):+$P(PSADATA,"^",4),1:"")
"RTN","PSAUTL4",33,0)
 S PSATEMP=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2))
"RTN","PSAUTL4",34,0)
 I +$P(PSATEMP,"^",3),PSADRG,+$P($G(^PSDRUG(PSADRG,1,+$P(PSATEMP,"^",3),0)),"^",5) S PSAOU=+$P(^PSDRUG(PSADRG,1,+$P(PSATEMP,"^",3),0),"^",5)
"RTN","PSAUTL4",35,0)
 S PSADJO="",PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","O",0))
"RTN","PSAUTL4",36,0)
 I +PSADJ S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)),PSADJO=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAUTL4",37,0)
 ;Adj. Order Unit
"RTN","PSAUTL4",38,0)
 I PSADJO'="" W $S(+PSADJO&($P($G(^DIC(51.5,+PSADJO,0)),"^")'=""):$P($G(^DIC(51.5,+PSADJO,0)),"^"),1:"UNKNOWN")_" ("_$S(PSAOU:$P($G(^DIC(51.5,+PSAOU,0)),"^"),1:"Blank")_")" S PSAOU=+PSADJO
"RTN","PSAUTL4",39,0)
 I PSADJO="" W $S(+PSAOU:$P($G(^DIC(51.5,+PSAOU,0)),"^"),1:"Blank")
"RTN","PSAUTL4",40,0)
 ;
"RTN","PSAUTL4",41,0)
NDC S PSANDC=$P(PSADATA,"^",11)
"RTN","PSAUTL4",42,0)
 I $E(PSANDC)'="S" W ?38,"NDC: "_$S(PSANDC'="":$E(PSANDC,1,6)_"-"_$E(PSANDC,7,10)_"-"_$E(PSANDC,11,12),1:"Blank")
"RTN","PSAUTL4",43,0)
 ;
"RTN","PSAUTL4",44,0)
PRICE W !,"Unit Price  : $"
"RTN","PSAUTL4",45,0)
 S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","P",0))
"RTN","PSAUTL4",46,0)
 I +PSADJ S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)),PSADJP=$S(+$P(PSANODE,"^",6):+$P(PSANODE,"^",6),1:+$P(PSANODE,"^",2))
"RTN","PSAUTL4",47,0)
 ;Adj. Unit Price
"RTN","PSAUTL4",48,0)
 I +PSADJP D
"RTN","PSAUTL4",49,0)
 .I $L($P(PSADJP,".",2))<2 S PSADJP=$P(PSADJP,".")_"."_$P(PSADJP,".",2)_$E("00",1,(2-$L($P(PSADJP,".",2))))
"RTN","PSAUTL4",50,0)
 .W $FN(PSADJP,",")_" ($"_$S(+$P(PSADATA,"^",5):$FN($P(PSADATA,"^",5),","),$P(PSADATA,"^",5)=0:"0.00",1:"")_")"
"RTN","PSAUTL4",51,0)
 .S PSAPRICE=PSADJP
"RTN","PSAUTL4",52,0)
 I '+PSADJP D
"RTN","PSAUTL4",53,0)
 .S PSAPRICE=+$P(PSADATA,"^",5)
"RTN","PSAUTL4",54,0)
 .I +PSAPRICE!(PSAPRICE=0) W $S(+PSAPRICE:PSAPRICE,1:"0.00") Q
"RTN","PSAUTL4",55,0)
 .W "Blank"
"RTN","PSAUTL4",56,0)
 ;
"RTN","PSAUTL4",57,0)
VSN W ?38,"VSN: "_$S(PSAVSN'="":PSAVSN,1:"Blank"),!
"RTN","PSAUTL4",58,0)
VDU S PSADUOU=+$P(PSATEMP,"^"),PSAREORD=+$P(PSATEMP,"^",2),PSASUB=+$P(PSATEMP,"^",3),PSASTOCK=+$P(PSATEMP,"^",4)
"RTN","PSAUTL4",59,0)
 W !,"Dispense Units: "_$S($P($G(^PSDRUG(+PSADRG,660)),"^",8)'="":$P($G(^PSDRUG(+PSADRG,660)),"^",8),1:"Blank")
"RTN","PSAUTL4",60,0)
VDUOU W !,"Dispense Units Per Order Unit: "_$S(+PSADUOU:+PSADUOU,+PSASUB&(+$P($G(^PSDRUG(+PSADRG,1,PSASUB,0)),"^",7)):+$P($G(^PSDRUG(+PSADRG,1,PSASUB,0)),"^",7),1:"Blank"),!
"RTN","PSAUTL4",61,0)
 ;
"RTN","PSAUTL4",62,0)
 Q:'+$P($G(^PSD(58.8,+PSALOC,0)),"^",14)
"RTN","PSAUTL4",63,0)
 ;
"RTN","PSAUTL4",64,0)
STOCK S PSASTOCK=$S(+PSASTOCK:+PSASTOCK,+$P($G(^PSD(58.8,+PSALOC,1,+PSADRG,0)),"^",3):+$P($G(^PSD(58.8,+PSALOC,1,+PSADRG,0)),"^",3),1:"Blank")
"RTN","PSAUTL4",65,0)
 W "Stock Level   : "_PSASTOCK
"RTN","PSAUTL4",66,0)
REORDER S PSAREORD=$S(+PSAREORD:+PSAREORD,+$P($G(^PSD(58.8,+PSALOC,1,+PSADRG,0)),"^",5):+$P($G(^PSD(58.8,+PSALOC,1,+PSADRG,0)),"^",5),1:"Blank")
"RTN","PSAUTL4",67,0)
 W !,"Reorder Level : "_PSAREORD,!
"RTN","PSAUTL4",68,0)
 Q
"RTN","PSAVER")
0^101^B73058041
"RTN","PSAVER",1,0)
PSAVER ;BIR/JMB-Verify Invoices ;9/6/97
"RTN","PSAVER",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAVER",3,0)
 ;This routine allows the user to verify processed invoices. The entire
"RTN","PSAVER",4,0)
 ;invoice may be verified with/without editing. After verification, the
"RTN","PSAVER",5,0)
 ;pharmacy location or master vault balances are incremented during a
"RTN","PSAVER",6,0)
 ;background job (PSAVER5).
"RTN","PSAVER",7,0)
 ;
"RTN","PSAVER",8,0)
 I '$D(^XUSEC("PSA ORDERS",DUZ)) W !,"You do not hold the key to enter the option." Q
"RTN","PSAVER",9,0)
 I '$D(^PSD(58.811,"ASTAT","P")) W !!,"There are no invoices that need to be verified." H 1 Q
"RTN","PSAVER",10,0)
 ;
"RTN","PSAVER",11,0)
 ;Creates a list of invoices that can be verified by the user. If the
"RTN","PSAVER",12,0)
 ;invoice contains at least one item marked as a controlled substance,
"RTN","PSAVER",13,0)
 ;the user must have the pharmacist key before it can be verified.
"RTN","PSAVER",14,0)
 S (PSACNT,PSAIEN,PSASUP)=0
"RTN","PSAVER",15,0)
 F  S PSAIEN=+$O(^PSD(58.811,"ASTAT","P",PSAIEN)) Q:'PSAIEN  D
"RTN","PSAVER",16,0)
 .Q:'$D(^PSD(58.811,PSAIEN,0))
"RTN","PSAVER",17,0)
 .S PSAIEN1=0 F  S PSAIEN1=+$O(^PSD(58.811,"ASTAT","P",PSAIEN,PSAIEN1)) Q:'PSAIEN1  D
"RTN","PSAVER",18,0)
 ..Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0))
"RTN","PSAVER",19,0)
 ..I $P(^PSD(58.811,PSAIEN,1,PSAIEN1,0),"^",10)'=DUZ,$P(^(0),"^",8)="N"!(($P(^(0),"^",8)="S"!($P(^(0),"^",8)="A"))&($D(^XUSEC("PSJ RPHARM",DUZ)))) S PSACNT=PSACNT+1,PSAVER(PSACNT)=PSAIEN_"^"_PSAIEN1
"RTN","PSAVER",20,0)
 I 'PSACNT D  H 1 G EXIT
"RTN","PSAVER",21,0)
 .W !!,"There is at least one invoice that needs to be verified. However, invoices",!,"cannot be verified by the same person who processed them and a pharmacist",!,"must verify invoices that contain a drug marked as a controlled substance."
"RTN","PSAVER",22,0)
 .W !!,"There are no invoices you can verify because the invoice(s) meet one of the",!,"above conditions."
"RTN","PSAVER",23,0)
 ;
"RTN","PSAVER",24,0)
ESIG D SIG^XUSESIG G:X1="" EXIT  S PSAOUT=0
"RTN","PSAVER",25,0)
 ;
"RTN","PSAVER",26,0)
PRINT ;Asks & prints all invoices the user can verify.
"RTN","PSAVER",27,0)
 W ! S DIR(0)="Y",DIR("B")="N",DIR("A")="Print processed invoices",DIR("?",1)="Enter YES to print all invoices you can verify then begin verification.",DIR("?")="Enter NO to bypass printing the invoices and begin verification."
"RTN","PSAVER",28,0)
 S DIR("??")="^D PRINTYN^PSAVER"
"RTN","PSAVER",29,0)
 D ^DIR K DIR G:$G(DIRUT) EXIT G:'Y ENTIRE
"RTN","PSAVER",30,0)
 W ! S %ZIS="Q" D ^%ZIS G:POP ENTIRE
"RTN","PSAVER",31,0)
 I $D(IO("Q")) D  G ENTIRE
"RTN","PSAVER",32,0)
 .K ZTSAVE
"RTN","PSAVER",33,0)
 .S ZTDESC="Drug Acct. - Print Prime Vendor Invoices",ZTDTH=$H,ZTRTN="PRTINV^PSAVER",ZTSAVE("PSAVER(")="" D ^%ZTLOAD
"RTN","PSAVER",34,0)
 D PRTINV
"RTN","PSAVER",35,0)
 ;
"RTN","PSAVER",36,0)
ENTIRE ;Displays a list of all invoices the user can select to be verified.
"RTN","PSAVER",37,0)
 S PSASLN="",$P(PSASLN,"-",80)="",PSADLN="",$P(PSADLN,"=",80)=""
"RTN","PSAVER",38,0)
 W @IOF,!?21,"<<< VERIFY ENTIRE INVOICE SCREEN >>>"
"RTN","PSAVER",39,0)
 W !!?2,"If there are no corrections, you can change the invoices' status",!?2,"to ""Verified"" by selecting them from the list. If you do have"
"RTN","PSAVER",40,0)
 W !?2,"corrections, press the return key then a second list will be",!?2,"displayed. You will be able to choose the invoices from that list",!?2,"and enter corrections.",!!?2,"Choose the invoices from the list you want to verify.",!,PSADLN
"RTN","PSAVER",41,0)
 S (PSA,PSACNT,PSASTOP)=0
"RTN","PSAVER",42,0)
 F  S PSA=+$O(PSAVER(PSA)) Q:'PSA  D  Q:PSASTOP
"RTN","PSAVER",43,0)
 .I $Y+5>IOSL D HDR Q:PSASTOP
"RTN","PSAVER",44,0)
 .S PSAIEN=$P(PSAVER(PSA),"^"),PSAIEN1=$P(PSAVER(PSA),"^",2),PSAORD=$P(^PSD(58.811,PSAIEN,0),"^"),PSAINV=$P(^PSD(58.811,PSAIEN,1,PSAIEN1,0),"^"),PSAINVDT=+$P(^(0),"^",2),PSACNT=PSACNT+1
"RTN","PSAVER",45,0)
 .W !?(3-$L(PSA)),PSA_".  Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(PSAINVDT)
"RTN","PSAVER",46,0)
 K PSASTOP W !,PSADLN
"RTN","PSAVER",47,0)
 S DIR(0)="LO^1:"_PSACNT,DIR("A")="Select invoices to verify",DIR("?",1)="Enter the number to the left of the invoice",DIR("?")="data to be verified or a range of numbers.",DIR("??")="^D SEL^PSAVER"
"RTN","PSAVER",48,0)
 W ! D ^DIR K DIR G:$G(DTOUT)!($G(DUOUT)) EXIT
"RTN","PSAVER",49,0)
 I Y="" D LOAD G EDIT
"RTN","PSAVER",50,0)
 S PSASEL=Y
"RTN","PSAVER",51,0)
 ;
"RTN","PSAVER",52,0)
OKAY ;Verifies correct invoices were selected.
"RTN","PSAVER",53,0)
 W @IOF,!?21,"<<< VERIFY ENTIRE INVOICE SCREEN >>>",!,PSADLN,!
"RTN","PSAVER",54,0)
 S PSACNT=0 F PSAPC=1:1 S PSA=+$P(PSASEL,",",PSAPC) Q:'PSA  D
"RTN","PSAVER",55,0)
 .S PSAIEN=$P(PSAVER(PSA),"^"),PSAIEN1=$P(PSAVER(PSA),"^",2)
"RTN","PSAVER",56,0)
 .Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0))
"RTN","PSAVER",57,0)
 .S PSAIN=^PSD(58.811,PSAIEN,1,PSAIEN1,0)
"RTN","PSAVER",58,0)
 .S PSAORD=$P(^PSD(58.811,PSAIEN,0),"^"),PSAINV=$P(PSAIN,"^"),PSAINVDT=+$P(PSAIN,"^",2),PSACNT=PSACNT+1
"RTN","PSAVER",59,0)
 .W !?(3-$L(PSACNT)),PSACNT_".  Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(PSAINVDT)
"RTN","PSAVER",60,0)
 .I +$P(PSAIN,"^",5) D
"RTN","PSAVER",61,0)
 ..S PSALOC=+$P(PSAIN,"^",5) D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSAVER",62,0)
 ..W:$L(PSALOCN)>76 !?6,$P(PSALOCN,"(IP)",1)_"(IP)",!?23,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 !?6,PSALOCN
"RTN","PSAVER",63,0)
 .I +$P(PSAIN,"^",12) W !?6,"MASTER VAULT: "_$P(^PSD(58.8,+$P(PSAIN,"^",12),0),"^")
"RTN","PSAVER",64,0)
 .W !
"RTN","PSAVER",65,0)
 S DIR(0)="Y",DIR("B")="N",DIR("A")="Are you sure "_$S(PSACNT=1:"this invoice's",1:"these invoices'")_" status should be changed to Verified"
"RTN","PSAVER",66,0)
 S DIR("?",1)="Enter YES if the list contains invoices with no corrections.",DIR("?",2)="Enter NO if the list contains at least one invoice you do not",DIR("?")="want to verify.",DIR("??")="^D VERIFY^PSAVER"
"RTN","PSAVER",67,0)
 D ^DIR K DIR G:$G(DIRUT) EXIT G:'Y ENTIRE
"RTN","PSAVER",68,0)
 ;
"RTN","PSAVER",69,0)
 ;Send entire invoices to be verified in background, delete these
"RTN","PSAVER",70,0)
 ;invoices from the list, then create a new list of remaining invoices
"RTN","PSAVER",71,0)
 ;to be verified.
"RTN","PSAVER",72,0)
BKGJOB K PSAVBKG W ! F PSAPC=1:1 S PSA=+$P(PSASEL,",",PSAPC) Q:'PSA!(PSAOUT)  D
"RTN","PSAVER",73,0)
 .S PSAIEN=$P(PSAVER(PSA),"^"),PSAIEN1=$P(PSAVER(PSA),"^",2),PSASUP=0
"RTN","PSAVER",74,0)
 .Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0))!('$D(^PSD(58.811,PSAIEN,0)))
"RTN","PSAVER",75,0)
 .S (PSACS,PSAERR,PSALINE,PSALNCNT,PSALNERR,PSALNSU)=0
"RTN","PSAVER",76,0)
 .S PSAIN=^PSD(58.811,PSAIEN,1,PSAIEN1,0),PSAINV=$P(PSAIN,"^"),PSAORD=$P(^PSD(58.811,PSAIEN,0),"^")
"RTN","PSAVER",77,0)
 .F  S PSALINE=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE)) Q:'PSALINE!(PSAOUT)  D
"RTN","PSAVER",78,0)
 ..Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0))
"RTN","PSAVER",79,0)
 ..S PSADATA=^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0),PSALNCNT=PSALNCNT+1
"RTN","PSAVER",80,0)
 ..S PSALOC=$S(+$P(PSADATA,"^",10):$P(PSAIN,"^",12),1:$P(PSAIN,"^",5))
"RTN","PSAVER",81,0)
 ..W "." D SETLINE^PSAVER3
"RTN","PSAVER",82,0)
 .Q:PSAOUT
"RTN","PSAVER",83,0)
 .I '$O(PSANOVER(PSAIEN,PSAIEN1,0)) D  Q
"RTN","PSAVER",84,0)
 ..S PSAVBKG(PSAIEN,PSAIEN1)="" K PSAVER(PSA) D STATUS^PSAVER3
"RTN","PSAVER",85,0)
 ..I '+$P(^PSD(58.811,PSAIEN,1,PSAIEN1,0),"^",13),$P($G(^PSD(58.8,+$P(PSAIN,"^",5),0)),"^",14)!($P($G(^PSD(58.8,+$P(PSAIN,"^",12),0)),"^",14)) D NEWDRUG^PSAVER1
"RTN","PSAVER",86,0)
 ..W !,"   Order# "_PSAORD_" Invoice# "_PSAINV_"'s status has been changed to Verified!"
"RTN","PSAVER",87,0)
 .H 1 I $O(PSANOVER(PSAIEN,PSAIEN1,0)) D
"RTN","PSAVER",88,0)
 ..W !,"** Order# "_PSAORD_" Invoice# "_PSAINV_"'s status has not been changed to Verified."
"RTN","PSAVER",89,0)
 ..S PSAERR=0,PSAVER(PSA)=PSAIEN_"^"_PSAIEN1
"RTN","PSAVER",90,0)
 ..D PRINT^PSAVER3
"RTN","PSAVER",91,0)
 ;
"RTN","PSAVER",92,0)
 ;If the invoices selected are error free, send them to the background
"RTN","PSAVER",93,0)
 ;job to complete the invoice and increment inventory.
"RTN","PSAVER",94,0)
 D LOAD
"RTN","PSAVER",95,0)
 I $O(PSAVBKG(0)) D
"RTN","PSAVER",96,0)
 .K ZTSAVE S ZTDESC="Drug Acct. - Verify Prime Vendor Invoices",ZTIO="",ZTDTH=$H,ZTRTN="^PSAVER6",ZTSAVE("PSASEL")="",ZTSAVE("PSAVBKG(")="" D ^%ZTLOAD Q:$G(POP)
"RTN","PSAVER",97,0)
 K PSAVBKG G:'$O(PSAEDIT(0)) EXIT
"RTN","PSAVER",98,0)
EDIT D EDIT^PSAVER1
"RTN","PSAVER",99,0)
 ;
"RTN","PSAVER",100,0)
EXIT I $O(PSANEWD(0)) D ^PSAVER4
"RTN","PSAVER",101,0)
 K %ZIS,DA,DD,DIC,DIE,DIK,DIR,DIRUT,DO,DR,DTOUT,DUOUT,PSA,PSA10,PSAGAIN,PSA50IEN,PSAA,PSABEFOR,PSACHG,PSACHO,PSACNT,PSACOMB,PSACS,PSACSLN,PSACTRL
"RTN","PSAVER",102,0)
 K PSADATA,PSADD,PSADJ,PSADJD,PSADJFLD,PSADJN,PSADJO,PSADJOP,PSADJOV,PSADJP,PSADJPP,PSADJPV,PSADJQ,PSADJQP,PSADJQV,PSADJSUP,PSADLN,PSADRG
"RTN","PSAVER",103,0)
 K PSADRGN,PSADUOU,PSAEDIT,PSAERR,PSAFLD,PSAFLDS,PSAHOLD,PSAIEN,PSAIEN1,PSAIN,PSAINV,PSAINVDT,PSAISIT,PSAISITN,PSAKK,PSAL,PSALEN,PSALINE,PSALINEN
"RTN","PSAVER",104,0)
 K PSALINES,PSALN,PSALN0,PSALNCNT,PSALND,PSALNERR,PSALNP,PSALNSU,PSALNV,PSALOAD,PSALOC,PSALOCA,PSALOCN,PSAMENU,PSAMV,PSAMVA,PSAMVIEN,PSAMVN,PSAN10,PSANAME,PSANDC,PSANEW,PSANEWD
"RTN","PSAVER",105,0)
 K PSANO,PSANODE,PSANOVER,PSANUM,PSAONE,PSAONEMV,PSAORD,PSAORDU,PSAPHARM,PSAPRICE,PSAOSIT,PSAOSITN,PSAOU,PSAOUT,PSAPC,PSAPCF,PSAPCL,PSAPG,PSAPRINT,PSAQTY
"RTN","PSAVER",106,0)
 K PSAREA,PSAREC,PSARECD,PSAREORD,PSASAVE,PSASEL,PSASET,PSASLN,PSASTOCK,PSASUB,PSASUP,PSASUPP,PSATAB,PSATEMP,PSAUPC,PSAVAULT,PSAVBKG,PSAVER,PSAVSN,PSAOU
"RTN","PSAVER",107,0)
 K PSASS,X,X1,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PSAVER",108,0)
 Q
"RTN","PSAVER",109,0)
 ;
"RTN","PSAVER",110,0)
HDR ;Header with screen hold
"RTN","PSAVER",111,0)
 S PSASS=21-$Y F PSAKK=1:1:PSASS W !
"RTN","PSAVER",112,0)
 S DIR(0)="E" D ^DIR K DIR I $G(DIRUT) S PSASTOP=1 Q
"RTN","PSAVER",113,0)
 W @IOF,!?21,"<<< VERIFY ENTIRE INVOICE SCREEN >>>",!!,PSADLN
"RTN","PSAVER",114,0)
 Q
"RTN","PSAVER",115,0)
LOAD ;Loads invoices to be edited into an array
"RTN","PSAVER",116,0)
 K PSAEDIT S (PSALOAD,PSACNT)=0
"RTN","PSAVER",117,0)
 F  S PSALOAD=+$O(PSAVER(PSALOAD)) Q:'PSALOAD  S PSACNT=PSACNT+1,PSAEDIT(PSACNT)=PSAVER(PSALOAD)
"RTN","PSAVER",118,0)
 K PSAVER
"RTN","PSAVER",119,0)
 Q
"RTN","PSAVER",120,0)
 ;
"RTN","PSAVER",121,0)
PRTINV ;Sends invoices to printer
"RTN","PSAVER",122,0)
 S (PSA,PSAOUT)=0 F  S PSA=+$O(PSAVER(PSA)) Q:'PSA!(PSAOUT)  D
"RTN","PSAVER",123,0)
 .S PSAORD=$P(PSAVER(PSA),"^"),PSAINV=$P(PSAVER(PSA),"^",2) D ^PSAORDP1
"RTN","PSAVER",124,0)
 D ^%ZISC
"RTN","PSAVER",125,0)
 Q
"RTN","PSAVER",126,0)
 ;
"RTN","PSAVER",127,0)
SEL ;Extended help to 'Select invoices'
"RTN","PSAVER",128,0)
 W !?5,"Enter the number to the left of the invoice data that you want to verify.",!?5,"The invoices' statuses will be changed to Verified."
"RTN","PSAVER",129,0)
 Q
"RTN","PSAVER",130,0)
SELHELP ;Extended help for 'Select invoices to verify'
"RTN","PSAVER",131,0)
 W !?5,"Enter the number to the left of the invoice data you want to verify.",!?5,"The line items will be displayed for you to select the ones you want"
"RTN","PSAVER",132,0)
 W !?5,"to correct."
"RTN","PSAVER",133,0)
 Q
"RTN","PSAVER",134,0)
PRINTYN ;Extended help for 'Print invoices?'
"RTN","PSAVER",135,0)
 W !?5,"Enter YES to print all of the processed invoices you can verify.",!?5,"Enter NO to bypass printing the invoices and continue with verification."
"RTN","PSAVER",136,0)
 Q
"RTN","PSAVER",137,0)
VERIFY ;Extended help for 'Are you sure...'
"RTN","PSAVER",138,0)
 W !!?5,"Enter YES if the list contains invoices to be verified.",!!?5,"Enter NO if the list contains at least one invoice that should not be"
"RTN","PSAVER",139,0)
 W !?5,"verified. You will be returned to the original list so you can choose",!?5,"the invoices to be verified again."
"RTN","PSAVER",140,0)
 Q
"RTN","PSAVER1")
0^102^B45500503
"RTN","PSAVER1",1,0)
PSAVER1 ;BIR/JMB-Verify Invoices - CONT'D ;7/23/97
"RTN","PSAVER1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAVER1",3,0)
 ;This routine allows the user to edit processed invoices by selecting
"RTN","PSAVER1",4,0)
 ;the invoice's line item number. If there are no errors after editing
"RTN","PSAVER1",5,0)
 ;the line item is verified.
"RTN","PSAVER1",6,0)
 ;
"RTN","PSAVER1",7,0)
EDIT W @IOF,!?18,"<<< EDIT INVOICES TO BE VERIFIED SCREEN >>>",!!?2,"Choose the invoices from the list you want to edit.",!,PSASLN
"RTN","PSAVER1",8,0)
 S (PSA,PSACNT,PSASTOP)=0 F  S PSA=+$O(PSAEDIT(PSA)) Q:'PSA  D  Q:PSASTOP
"RTN","PSAVER1",9,0)
 .I $Y+5>IOSL D HEADER Q:PSASTOP
"RTN","PSAVER1",10,0)
 .S PSAIEN=$P(PSAEDIT(PSA),"^"),PSAIEN1=$P(PSAEDIT(PSA),"^",2),PSAORD=$P(^PSD(58.811,PSAIEN,0),"^")
"RTN","PSAVER1",11,0)
 .S PSAINV=$P(^PSD(58.811,PSAIEN,1,PSAIEN1,0),"^"),PSAINVDT=+$P(^(0),"^",2),PSACNT=PSACNT+1
"RTN","PSAVER1",12,0)
 .W !?2,PSA_".",?6,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(PSAINVDT)
"RTN","PSAVER1",13,0)
 K PSASTOP W !,PSASLN
"RTN","PSAVER1",14,0)
 S DIR(0)="LO^1:"_PSACNT,DIR("A")="Select invoices to edit",DIR("?",1)="Enter the number to the left of the invoice",DIR("?")="data to be verified or a range of numbers.",DIR("??")="^D SELHELP^PSAVER"
"RTN","PSAVER1",15,0)
 W ! D ^DIR K DIR Q:$G(DIRUT)
"RTN","PSAVER1",16,0)
 S PSASEL=Y
"RTN","PSAVER1",17,0)
 ;
"RTN","PSAVER1",18,0)
SEL ;Select line items to be edit
"RTN","PSAVER1",19,0)
 K PSAVBKG
"RTN","PSAVER1",20,0)
 F PSAPC=1:1 S PSA=$P(PSASEL,",",PSAPC) Q:'PSA  D CORR Q:PSAOUT
"RTN","PSAVER1",21,0)
 I $O(PSAVBKG(0)) D
"RTN","PSAVER1",22,0)
 .K ZTSAVE S ZTDESC="Drug Acct. - Verify Prime Vendor Invoices",ZTIO="",ZTDTH=$H,ZTRTN="^PSAVER6",ZTSAVE("PSAVBKG(")="" D ^%ZTLOAD
"RTN","PSAVER1",23,0)
 Q
"RTN","PSAVER1",24,0)
 ;
"RTN","PSAVER1",25,0)
HEADER ;Header with screen hold
"RTN","PSAVER1",26,0)
 S PSASS=21-$Y F PSAKK=1:1:PSASS W !
"RTN","PSAVER1",27,0)
 S DIR(0)="E" D ^DIR K DIR I $G(DIRUT) S PSASTOP=1 Q
"RTN","PSAVER1",28,0)
 W @IOF,!?18,"<<< EDIT INVOICES TO BE VERIFIED SCREEN >>>",!!,PSASLN
"RTN","PSAVER1",29,0)
 Q
"RTN","PSAVER1",30,0)
 ;
"RTN","PSAVER1",31,0)
CORR S PSAIEN=$P(PSAEDIT(PSA),"^"),PSAIEN1=$P(PSAEDIT(PSA),"^",2)
"RTN","PSAVER1",32,0)
 S PSAIN=^PSD(58.811,PSAIEN,1,PSAIEN1,0),PSAINV=$P(^(0),"^"),PSAINVDT=$P(^(0),"^",2),PSAORD=$P(^PSD(58.811,PSAIEN,0),"^")
"RTN","PSAVER1",33,0)
 D HDR,RECD^PSAVER2 Q:PSAOUT  S PSALOC=+$P(PSAIN,"^",5),PSAMV=+$P(PSAIN,"^",12)
"RTN","PSAVER1",34,0)
 I PSALOC!($P(PSAIN,"^",8)="S")!($P(PSAIN,"^",8)="N") D  Q:PSAOUT
"RTN","PSAVER1",35,0)
 .D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSAVER1",36,0)
 .W:$L(PSALOCN)>76 !!,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 !!,PSALOCN
"RTN","PSAVER1",37,0)
 .S DR=4 D PHARM^PSAVER2
"RTN","PSAVER1",38,0)
 I PSAMV!($P(PSAIN,"^",8)="S")!($P(PSAIN,"^",8)="A") W !!,$P($G(^PSD(58.8,PSAMV,0)),"^") S DR=13 D PHARM^PSAVER2 Q:PSAOUT
"RTN","PSAVER1",39,0)
 ;
"RTN","PSAVER1",40,0)
LINES F  W ! S DIC="^PSD(58.811,"_PSAIEN_",1,"_PSAIEN1_",1,",DA(2)=PSAIEN,DA(1)=PSAIEN1,DIC(0)="QAEMZ",DIC("A")="Select Line#: " D ^DIC K DIC D  Q:PSAOUT
"RTN","PSAVER1",41,0)
 .I $G(DTOUT)!($G(DUOUT))!(Y<1) S PSAOUT=1 Q
"RTN","PSAVER1",42,0)
 .S PSALINE=+Y,PSALINEN=$P(Y,"^",2)
"RTN","PSAVER1",43,0)
 .I '$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0)) W !,"Invalid line number." Q
"RTN","PSAVER1",44,0)
 .S PSADATA=^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0),PSASUP=0
"RTN","PSAVER1",45,0)
 .S PSANDC=$P(PSADATA,"^",11),PSAVSN=$P(PSADATA,"^",12),PSALOC=$S(+$P(PSADATA,"^",10):+$P(PSAIN,"^",12),1:+$P(PSAIN,"^",5))
"RTN","PSAVER1",46,0)
VIEW .D HDR,VERDISP^PSAUTL4 W PSASLN,!
"RTN","PSAVER1",47,0)
 .W "1. Drug",!,"2. Quantity Received",!,"3. Order Unit",!,"4. Dispense Units per Order Unit",! S PSACHO=4
"RTN","PSAVER1",48,0)
 .I $P($G(^PSD(58.8,PSALOC,0)),"^",14)  W "5. Stock Level",!,"6. Reorder Level",! S PSACHO=6
"RTN","PSAVER1",49,0)
 .S DIR(0)="LO^1:"_PSACHO,DIR("A")="Edit fields",DIR("?")="Enter the number(s) of the data to be edited" S DIR("??")="^D DDQOR^PSAVER3"
"RTN","PSAVER1",50,0)
 .D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAVER1",51,0)
 .Q:Y=""  S PSAFLDS=Y,PSASET=0 D HDR,VERDISP^PSAUTL4 W PSASLN
"RTN","PSAVER1",52,0)
FIELDS .F PSAPCF=1:1 S PSAFLD=$P(PSAFLDS,",",PSAPCF) Q:'PSAFLD!(PSAOUT)  D
"RTN","PSAVER1",53,0)
 ..I PSAFLD=1 D ASKDRUG^PSAVER2 Q
"RTN","PSAVER1",54,0)
 ..I PSAFLD=2 D QTY^PSAVER2 Q
"RTN","PSAVER1",55,0)
 ..I PSAFLD=3 D OU^PSAVER2 Q
"RTN","PSAVER1",56,0)
 ..I PSAFLD=4,'PSASET S PSA50IEN=PSADRG D DUOU^PSAVER2 Q
"RTN","PSAVER1",57,0)
 ..I PSAFLD=5 D STOCK^PSAVER2 Q
"RTN","PSAVER1",58,0)
 ..I PSAFLD=6 D REORDER^PSAVER2
"RTN","PSAVER1",59,0)
 ;
"RTN","PSAVER1",60,0)
 ;Looks to see if all line items are processed.
"RTN","PSAVER1",61,0)
PROCESS S (PSACS,PSAERR,PSALINE,PSALINES,PSALNCNT,PSALNSU,PSAOUT,PSASUP)=0
"RTN","PSAVER1",62,0)
 S PSAIN=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,0)),PSAORD=$P($G(^PSD(58.811,PSAIEN,0)),"^")
"RTN","PSAVER1",63,0)
 F  S PSALINE=$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE)) Q:'PSALINE!(PSAOUT)  D
"RTN","PSAVER1",64,0)
 .S PSADATA=^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0),PSALNERR=0,PSALNCNT=PSALNCNT+1
"RTN","PSAVER1",65,0)
 .D SETLINE^PSAVER3 Q:PSAOUT
"RTN","PSAVER1",66,0)
 .S:'+$G(PSALNERR) PSALINES=PSALINES+1 S PSADATA=^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0)
"RTN","PSAVER1",67,0)
 .S:+$P(PSADATA,"^",10) PSACS=PSACS+1
"RTN","PSAVER1",68,0)
 ;
"RTN","PSAVER1",69,0)
CHECK I PSALNCNT'=PSALINES K PSAHOLD(PSALOC,PSAIEN,PSAIEN1) W !!,"** The invoice has not been placed in a Verified status!" D END^PSAPROC D:+$G(PSAERR) PRINT^PSAVER3 Q
"RTN","PSAVER1",70,0)
 I +PSALNCNT,PSALNCNT=PSACS D
"RTN","PSAVER1",71,0)
 .S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,0),"^",8)="A" W !,"All drugs on the invoice are marked as a controlled substance."
"RTN","PSAVER1",72,0)
 .D:'+$P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,0)),"^",12) MASTER^PSAVER5
"RTN","PSAVER1",73,0)
 I PSACS,PSALNCNT'=PSACS S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,0),"^",8)="S" D:'$P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,0)),"^",5) GETLOC^PSAVER5
"RTN","PSAVER1",74,0)
 I 'PSACS S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,0),"^",8)="N" D:'$P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,0)),"^",5) GETLOC^PSAVER5
"RTN","PSAVER1",75,0)
 I +PSALNCNT,PSALNCNT=PSALINES D  Q
"RTN","PSAVER1",76,0)
 .D CHG
"RTN","PSAVER1",77,0)
 .I PSALNCNT=PSASUP S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,0),"^",13)=1 Q
"RTN","PSAVER1",78,0)
 .S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,0),"^",13)=0
"RTN","PSAVER1",79,0)
 D END^PSAPROC D:+$G(PSAERR) PRINT^PSAVER3
"RTN","PSAVER1",80,0)
 Q
"RTN","PSAVER1",81,0)
 ;
"RTN","PSAVER1",82,0)
CHG ;Determines if the invoice's status should be changed to verified. If
"RTN","PSAVER1",83,0)
 ;so, the status is changed and the new drugs to the location is listed.
"RTN","PSAVER1",84,0)
 W ! S DIR(0)="Y",DIR("A")="Do you want to change the invoice's status to Verified",DIR("?",1)="Enter YES to change the invoice's status to Verified.",DIR("?")="Enter NO to keep the invoice's status as Processed."
"RTN","PSAVER1",85,0)
 S DIR("??")="^D CHGYN^PSAVER1" D ^DIR K DIR
"RTN","PSAVER1",86,0)
 I $G(DIRUT)!('Y) S PSACHG=0 W !!,"** The invoice's status has not been changed to Verified!" K PSAHOLD(PSALOC,PSAIEN,PSAIEN1) Q
"RTN","PSAVER1",87,0)
 S PSACHG=Y,PSAVBKG(PSAIEN,PSAIEN1)=""
"RTN","PSAVER1",88,0)
 D STATUS^PSAVER3,NEWDRUG
"RTN","PSAVER1",89,0)
 W !!,"The invoice status has been changed to Verified!"
"RTN","PSAVER1",90,0)
 D END^PSAPROC
"RTN","PSAVER1",91,0)
 Q
"RTN","PSAVER1",92,0)
 ;
"RTN","PSAVER1",93,0)
NEWDRUG ;If this invoice will add new drugs to location/vault, store in an
"RTN","PSAVER1",94,0)
 ;array the location/vault and drug name to be printed later.
"RTN","PSAVER1",95,0)
 K PSALND,PSALN0,PSALNP,PSALNV
"RTN","PSAVER1",96,0)
 S PSALINE=0,PSAPHARM=+$P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,0)),"^",5),PSAMV=$P($G(^(0)),"^",12)
"RTN","PSAVER1",97,0)
 Q:'PSALOC
"RTN","PSAVER1",98,0)
 F  S PSALINE=$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE)) Q:'PSALINE  D
"RTN","PSAVER1",99,0)
 .S PSALN0=+$P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0)),"^",2),PSALOC=$S($P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0)),"^",10):PSAMV,1:PSAPHARM)
"RTN","PSAVER1",100,0)
 .I $O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"D",0)) D
"RTN","PSAVER1",101,0)
 ..S PSADJ=$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"D",0))
"RTN","PSAVER1",102,0)
 ..Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0))
"RTN","PSAVER1",103,0)
 ..S PSALNP=+$P(PSADJ,"^",2),PSALNV=+$P(PSADJ,"^",6)
"RTN","PSAVER1",104,0)
 .S PSADD=$S($G(PSALNV):PSALNV,$G(PSALNP):PSALNP,PSALN0:PSALN0,1:0)
"RTN","PSAVER1",105,0)
 .I PSADD,'$D(^PSD(58.8,PSALOC,1,PSADD,0)) S PSANEWD(PSALOC,$S($P($G(^PSDRUG(PSADD,0)),"^")'="":$P($G(^PSDRUG(PSADD,0)),"^"),1:"UNKNOWN"))=PSADD
"RTN","PSAVER1",106,0)
 Q
"RTN","PSAVER1",107,0)
 ;
"RTN","PSAVER1",108,0)
HDR ;Header for screen that displays invoice data to be edited.
"RTN","PSAVER1",109,0)
 W @IOF,!?18,"<<< EDIT INVOICES TO BE VERIFIED SCREEN >>>"
"RTN","PSAVER1",110,0)
 W !!,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(PSAINVDT),!,PSASLN,!
"RTN","PSAVER1",111,0)
 Q
"RTN","PSAVER1",112,0)
 ;
"RTN","PSAVER1",113,0)
CHGYN ;Extended help for 'Do you want to change the invoice's status to Verified'
"RTN","PSAVER1",114,0)
 W !?5,"Enter YES if the invoice is completely correct. You will not be able",!?5,"to edit it again."
"RTN","PSAVER1",115,0)
 W !!?5,"Enter NO if you need to edit the invoice again. You can edit it again",!?5,"by selecting the Verify Orders option."
"RTN","PSAVER1",116,0)
 Q
"RTN","PSAVER2")
0^103^B44207438
"RTN","PSAVER2",1,0)
PSAVER2 ;BIR/JMB-Verify Invoices - CONT'D ;10/7/97
"RTN","PSAVER2",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAVER2",3,0)
 ;This routine contains the prompts for the fields that the verifier
"RTN","PSAVER2",4,0)
 ;is allowed to edit.
"RTN","PSAVER2",5,0)
 ;
"RTN","PSAVER2",6,0)
ASKDRUG W !,"If the item will never be in the DRUG, press the Return key then",!,"answer YES to the ""Is this a supply item?"" prompt. To bypass this",!,"line item, enter ""^"" then press the Return key.",!
"RTN","PSAVER2",7,0)
 S PSAGAIN=0,PSABEFOR=PSADRG,DIC(0)="AEMQZ",DIC="^PSDRUG(" D ^DIC K DIC
"RTN","PSAVER2",8,0)
 I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAVER2",9,0)
 S PSADJFLD="D",PSAREA="",PSASUPP=0
"RTN","PSAVER2",10,0)
 I +Y=-1 D  Q:PSASUPP!(PSAOUT)
"RTN","PSAVER2",11,0)
 .S PSAVER=1 D SUPPLY^PSANDF Q:PSAOUT  I 'PSASUPP S PSAGAIN=1 Q
"RTN","PSAVER2",12,0)
 .S PSA50IEN=0,PSADJ=PSAREA,PSAREA="" K ^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2)
"RTN","PSAVER2",13,0)
 .D RECORD
"RTN","PSAVER2",14,0)
 G:$G(PSAGAIN) ASKDRUG
"RTN","PSAVER2",15,0)
 S (PSA50IEN,PSADJ,PSADRG)=+Y D RECORD,HDR^PSAVER1,VERDISP^PSAUTL4
"RTN","PSAVER2",16,0)
 I PSANDC'="",$O(^PSDRUG("C",PSANDC,PSA50IEN,0)) D
"RTN","PSAVER2",17,0)
 .S PSASUB=+$O(^PSDRUG("C",PSANDC,PSA50IEN,0)),$P(^PSD(58.811,PSAIEN,1,PSAIEN1,2),"^",3)=PSASUB
"RTN","PSAVER2",18,0)
 .I '+$P($G(^PSDRUG(PSA50IEN,1,PSASUB,0)),"^",7) D DUOU Q
"RTN","PSAVER2",19,0)
 .I +$P($G(^PSDRUG(PSA50IEN,1,PSASUB,0)),"^",7),+$P($G(^PSDRUG(PSA50IEN,1,PSASUB,0)),"^",7)'=+$P($G(^PSDRUG(PSABEFOR,1,PSASUB,0)),"^",7) D DUOU
"RTN","PSAVER2",20,0)
 ;
"RTN","PSAVER2",21,0)
 I PSANDC'="",'$O(^PSDRUG("C",PSANDC,PSA50IEN,0)),PSA50IEN'=PSABEFOR D DUOU
"RTN","PSAVER2",22,0)
 ;
"RTN","PSAVER2",23,0)
 I PSANDC="",PSAUPC="" D
"RTN","PSAVER2",24,0)
 .W !,"The vendor did not send a NDC or UPC for the drug. Enter the",!,"NDC if it is available. Enter the UPC if you do not know the NDC.",!
"RTN","PSAVER2",25,0)
 .S DIR(0)="SA^N:NDC;U:UPC",DIR("A")="Will you enter the NDC or UPC? ",DIR("B")="N",DIR("??")="^D NDCUPC^PSANDF1" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAVER2",26,0)
 .I Y="N" D GETNDC^PSANDF Q:PSAOUT  S PSANDC=Y D:PSANDC'="" ADDDATA
"RTN","PSAVER2",27,0)
 .I Y="U" D GETUPC^PSANDF Q:PSAOUT  S PSANDC="S"_Y,PSAUPC=Y D:PSANDC'="" ADDDATA
"RTN","PSAVER2",28,0)
 Q
"RTN","PSAVER2",29,0)
 ;
"RTN","PSAVER2",30,0)
ADDDATA ;Adds the missing NDC and/or UPC
"RTN","PSAVER2",31,0)
 K DA S DA(2)=PSAIEN,DA(1)=PSAIEN1,DA=PSALINE,DIE="^PSD(58.811,"_DA(2)_",1,"_DA(1)_",1,",DR="13///^S X="_PSANDC_$S(PSAUPC'="":";15///^S X="_PSAUPC,1:"")
"RTN","PSAVER2",32,0)
 F  L +^PSD(58.811,PSAIEN,1,PSAIEN1,0):0 I  Q
"RTN","PSAVER2",33,0)
 D ^DIE L -^PSD(58.811,PSAIEN,1,PSAIEN1,0)
"RTN","PSAVER2",34,0)
 K DIE I $G(DTOUT)!($G(DUOUT)) S PSAOUT=0 Q
"RTN","PSAVER2",35,0)
 D VERDISP^PSAUTL4
"RTN","PSAVER2",36,0)
 Q
"RTN","PSAVER2",37,0)
RECORD ;Adds adjusted data to DA ORDERS file
"RTN","PSAVER2",38,0)
 S PSANEW=0
"RTN","PSAVER2",39,0)
 I '$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,0)) S ^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,0)="^58.811259SA^^"
"RTN","PSAVER2",40,0)
 I $D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B",PSADJFLD)) D  Q
"RTN","PSAVER2",41,0)
 .S DA=$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B",PSADJFLD,0))
"RTN","PSAVER2",42,0)
 .I '$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,DA,0)) D NEW Q
"RTN","PSAVER2",43,0)
 .D ADJ
"RTN","PSAVER2",44,0)
 ;
"RTN","PSAVER2",45,0)
NEW S:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,0)) DIC("P")=$P(^DD(58.81125,9,0),"^",2) K DA
"RTN","PSAVER2",46,0)
 S DA(3)=PSAIEN,DA(2)=PSAIEN1,DA(1)=PSALINE,X=PSADJFLD,DIC="^PSD(58.811,"_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1,",DIC(0)="L",DLAYGO=58.811
"RTN","PSAVER2",47,0)
 F  L +^PSD(58.811,PSAIEN,1,PSAIEN1,0):0 I  Q
"RTN","PSAVER2",48,0)
 D ^DIC L -^PSD(58.811,PSAIEN,1,PSAIEN1,0) K DIC,DLAYGO S DA=+Y
"RTN","PSAVER2",49,0)
 ;
"RTN","PSAVER2",50,0)
ADJ S DA(3)=PSAIEN,DA(2)=PSAIEN1,DA(1)=PSALINE,DIE="^PSD(58.811,"_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","PSAVER2",51,0)
 S DR="5///"_PSADJ_$S(PSAREA'="":";6////^S X=PSAREA",1:"")_";7///^S X="_DT_";8///^S X="_DUZ
"RTN","PSAVER2",52,0)
 F  L +^PSD(58.811,PSAIEN,1,PSAIEN1,0):0 I  Q
"RTN","PSAVER2",53,0)
 D ^DIE
"RTN","PSAVER2",54,0)
INDEX S DIK=DIE D IX1^DIK K DIE,DIK L -^PSD(58.811,PSAIEN,1,PSAIEN1,0)
"RTN","PSAVER2",55,0)
 Q
"RTN","PSAVER2",56,0)
 ;
"RTN","PSAVER2",57,0)
DUOU ;Gets Dispense Units Per Order Unit
"RTN","PSAVER2",58,0)
 W !,"DISPENSE UNITS: "_$S($P($G(^PSDRUG(PSA50IEN,660)),"^",8)'="":$P($G(^PSDRUG(PSA50IEN,660)),"^",8),1:"Blank")
"RTN","PSAVER2",59,0)
 S DIR(0)="NO",DIR("A")="DISPENSE UNITS PER ORDER UNIT",DIR("B")=$P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2)),"^")
"RTN","PSAVER2",60,0)
 S DIR("?")="Enter the number of dispense units contained in one order unit",DIR("??")="^D DUOUHELP^PSAVER2"
"RTN","PSAVER2",61,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAVER2",62,0)
 S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2),"^")=+Y S:+Y PSASET=1
"RTN","PSAVER2",63,0)
 Q:Y'=""
"RTN","PSAVER2",64,0)
 ;
"RTN","PSAVER2",65,0)
 W !!,"The dispense units per order unit must be entered",!,"to change the status of the invoice to Verified."
"RTN","PSAVER2",66,0)
 S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to enter the data now"
"RTN","PSAVER2",67,0)
 S DIR("?",1)="Enter Yes to return to the DISPENSE UNITS PER ORDER UNIT prompt.",DIR("?")="Enter No to bypass entering the dispense units now."
"RTN","PSAVER2",68,0)
 S DIR("??")="^D DUOUYN^PSAPROC8" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAVER2",69,0)
 W ! G:+Y DUOU
"RTN","PSAVER2",70,0)
 Q
"RTN","PSAVER2",71,0)
 ;
"RTN","PSAVER2",72,0)
OU ;Get order unit
"RTN","PSAVER2",73,0)
 S DIC(0)="QAEMZ",DIC="^DIC(51.5,",DIC("A")="ORDER UNIT: ",DR=.01 S:+PSAOU&($P($G(^DIC(51.5,+PSAOU,0)),"^")'="") DIC("B")=$P(^DIC(51.5,+PSAOU,0),"^") D ^DIC K DIC
"RTN","PSAVER2",74,0)
 I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAVER2",75,0)
 I +Y,+Y=+$P(PSADATA,"^",4) Q
"RTN","PSAVER2",76,0)
 G:Y=-1 OU S PSADJFLD="O",PSADJ=+Y,PSAREA="" D RECORD
"RTN","PSAVER2",77,0)
 Q
"RTN","PSAVER2",78,0)
 ;
"RTN","PSAVER2",79,0)
PHARM ;Pharmacy Location/Master Vault -- DR is set prior to the call.
"RTN","PSAVER2",80,0)
 K DA S DA(1)=PSAIEN,DA=PSAIEN1,DIE="^PSD(58.811,"_DA(1)_",1," D ^DIE K DIE
"RTN","PSAVER2",81,0)
 S:$G(DTOUT)!($G(DUOUT)) PSAOUT=1
"RTN","PSAVER2",82,0)
 Q
"RTN","PSAVER2",83,0)
 ;
"RTN","PSAVER2",84,0)
QTY ;Adjust the quantity received
"RTN","PSAVER2",85,0)
 S DIR(0)="N",DIR("A")="QUANTITY RECEIVED",DIR("B")=PSAQTY
"RTN","PSAVER2",86,0)
 S DIR("?",1)="If the quantity received is different than the invoiced or",DIR("?")="adjusted quantity, enter the correct quantity received.",DIR("??")="^D QTYHELP^PSAPROC3"
"RTN","PSAVER2",87,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAVER2",88,0)
 Q:PSAQTY=+Y  S PSADJ=+Y
"RTN","PSAVER2",89,0)
 S DIR(0)="F^1:30",DIR("A")="ADJUSTMENT REASON",DIR("?")="Enter the reason you adjusted the quantity received.",DIR("??")="^D ADJREA^PSAPROC3"
"RTN","PSAVER2",90,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAVER2",91,0)
 S PSADJFLD="Q",PSAREA=Y D RECORD
"RTN","PSAVER2",92,0)
 Q
"RTN","PSAVER2",93,0)
 ;
"RTN","PSAVER2",94,0)
RECD ;Date Received
"RTN","PSAVER2",95,0)
 K PSARECD S PSAREC=$S(+$P(PSAIN,"^",7):+$P(PSAIN,"^",7),+$P(PSAIN,"^",6):+$P(PSAIN,"^",6),1:"")
"RTN","PSAVER2",96,0)
 S DIR(0)="D",DIR("A")="Date received",DIR("?")="Enter the date the drugs were received.",DIR("??")="^D RECHELP^PSAPROC3" S:PSAREC DIR("B")=$$FMTE^XLFDT(PSAREC)
"RTN","PSAVER2",97,0)
 D ^DIR K DIR I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAVER2",98,0)
 Q:'+$P(PSAIN,"^",7)&(+Y=+$P(PSAIN,"^",6))
"RTN","PSAVER2",99,0)
 Q:+$P(PSAIN,"^",6)'=+$P(PSAIN,"^",7)&(+$P(PSAIN,"^",7)=+Y)
"RTN","PSAVER2",100,0)
 S:+$P(PSAIN,"^",6)=+Y PSARECD="@"
"RTN","PSAVER2",101,0)
 S:+$P(PSAIN,"^",6)'=+Y&(+$P(PSAIN,"^",7)'=+Y) PSARECD=+Y
"RTN","PSAVER2",102,0)
 Q:'$D(PSARECD)  K DA
"RTN","PSAVER2",103,0)
 S DA(1)=PSAIEN,DA=PSAIEN1,DIE="^PSD(58.811,"_DA(1)_",1,",DR="8///"_$S(+PSARECD:"^S X="_PSARECD,1:"@")
"RTN","PSAVER2",104,0)
 F  L +^PSD(58.811,PSAIEN,1,PSAIEN1,0):0 I  Q
"RTN","PSAVER2",105,0)
 D ^DIE L -^PSD(58.811,PSAIEN,1,PSAIEN1,0)
"RTN","PSAVER2",106,0)
 K DIE
"RTN","PSAVER2",107,0)
 I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1
"RTN","PSAVER2",108,0)
 Q
"RTN","PSAVER2",109,0)
 ;
"RTN","PSAVER2",110,0)
REORDER ;Enter reorder level for drug if the field is blank.
"RTN","PSAVER2",111,0)
 S DIR(0)="NO^0:99999",DIR("A")="REORDER LEVEL (in Dispense Units)",DIR("??")="^D REORD^PSAPROC8",DIR("B")=+PSAREORD
"RTN","PSAVER2",112,0)
 S DIR("?")="Enter the minimum number of dispense units to keep in the "_$S(+$P(PSADATA,"^",10):"master vault",1:"pharmacy location")_"."
"RTN","PSAVER2",113,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAVER2",114,0)
 S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2),"^",2)=+Y
"RTN","PSAVER2",115,0)
 Q
"RTN","PSAVER2",116,0)
STOCK ;Enter stock level for drug if the field is blank.
"RTN","PSAVER2",117,0)
 S DIR(0)="NO^0:99999",DIR("A")="STOCK LEVEL (in Dispense Units)",DIR("??")="^D STKLEVEL^PSAPROC8",DIR("B")=+PSASTOCK
"RTN","PSAVER2",118,0)
 S DIR("?")="Enter the ideal number of dispense units to keep on the shelf."
"RTN","PSAVER2",119,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAVER2",120,0)
 S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2),"^",4)=+Y
"RTN","PSAVER2",121,0)
 Q
"RTN","PSAVER3")
0^104^B62747199
"RTN","PSAVER3",1,0)
PSAVER3 ;BIR/JMB-Verify Invoices - CONT'D ;9/5/97
"RTN","PSAVER3",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAVER3",3,0)
 ;This routine checks for verification errors, prints an error report,
"RTN","PSAVER3",4,0)
 ;& changes data in DA ORDERS to verification if there are no errors.
"RTN","PSAVER3",5,0)
 ;
"RTN","PSAVER3",6,0)
SETLINE ;Set line as verified if all data is present.
"RTN","PSAVER3",7,0)
 K PSADRG,PSAOU,PSAQTY S (PSADJN,PSADJ)=0
"RTN","PSAVER3",8,0)
 S PSADATA=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0))
"RTN","PSAVER3",9,0)
 I $O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,0)) D
"RTN","PSAVER3",10,0)
 .S PSAA=$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,0)) Q:PSAA=2
"RTN","PSAVER3",11,0)
 .S PSADJ=0 F  S PSADJ=$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ)) Q:'PSADJ  D
"RTN","PSAVER3",12,0)
 ..Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0))
"RTN","PSAVER3",13,0)
 ..S PSADJN=^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)
"RTN","PSAVER3",14,0)
 ..I $P(PSADJN,"^")="D" D
"RTN","PSAVER3",15,0)
 ...I (+$P(PSADJN,"^",9)&($P(PSADJN,"^",6)'?.N))!('+$P(PSADJN,"^",9)&(+$P(PSADJN,"^",5))&($P(PSADJN,"^",2)'?.N)) S PSASUP=PSASUP+1,PSALNSU=1,PSADRG=0 Q
"RTN","PSAVER3",16,0)
 ...S PSADRG=$S($P(PSADJN,"^",6)'="":$P(PSADJN,"^",6),$P(PSADJN,"^",2)'="":$P(PSADJN,"^",2),1:0)
"RTN","PSAVER3",17,0)
 ..I $P(PSADJN,"^")="O" S PSAOU=$S(+$P(PSADJN,"^",6):+$P(PSADJN,"^",6),+$P(PSADJN,"^",2):+$P(PSADJN,"^",2),1:0)
"RTN","PSAVER3",18,0)
 ..I $P(PSADJN,"^")="Q" S PSAQTY=$S($P(PSADJN,"^",6)'="":+$P(PSADJN,"^",6),$P(PSADJN,"^",2)'="":+$P(PSADJN,"^",2),1:0)
"RTN","PSAVER3",19,0)
 S:'$G(PSADRG) PSADRG=+$P(PSADATA,"^",2) S:'$D(PSAQTY) PSAQTY=+$P(PSADATA,"^",3)
"RTN","PSAVER3",20,0)
 S PSATEMP=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2)),PSANDC=$P(PSADATA,"^",11)
"RTN","PSAVER3",21,0)
 S PSASUB=$S(+$P(PSATEMP,"^",3):+$P(PSATEMP,"^",3),+$O(^PSDRUG("C",PSANDC,PSADRG,0)):+$O(^PSDRUG("C",PSANDC,PSADRG,0)),1:0)
"RTN","PSAVER3",22,0)
 S PSADUOU=+$P(PSATEMP,"^"),PSAREORD=+$P(PSATEMP,"^",2),PSASTOCK=+$P(PSATEMP,"^",4)
"RTN","PSAVER3",23,0)
 I '$D(PSAOU) D
"RTN","PSAVER3",24,0)
 .I +$P(PSADATA,"^",4),$P($G(^DIC(51.5,+$P(PSADATA,"^",4),0)),"^")'="" S PSAOU=+$P(PSADATA,"^",4) Q
"RTN","PSAVER3",25,0)
 .I PSADRG,PSASUB,$P($G(^PSDRUG(PSADRG,1,PSASUB,0)),"^",5) S PSAOU=$P($G(^PSDRUG(PSADRG,1,PSASUB,0)),"^",5) Q
"RTN","PSAVER3",26,0)
 .I $P(PSATEMP,"^",5)'="",+$P($P(PSATEMP,"^",5),"~",2) S PSAOU=+$P($P(PSATEMP,"^",5),"~",2)
"RTN","PSAVER3",27,0)
 I PSASUB D
"RTN","PSAVER3",28,0)
 .S:'PSADUOU PSADUOU=$S(PSADRG&(+$P($G(^PSDRUG(PSADRG,1,PSASUB,0)),"^",7)):+$P($G(^PSDRUG(PSADRG,1,PSASUB,0)),"^",7),1:0)
"RTN","PSAVER3",29,0)
 .S:'PSASTOCK PSASTOCK=$S(PSADRG:+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",3),1:0)
"RTN","PSAVER3",30,0)
 .S:'PSAREORD PSAREORD=$S(PSADRG:+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",5),1:0)
"RTN","PSAVER3",31,0)
 ;
"RTN","PSAVER3",32,0)
SUPPLY ;If it is a supply, automatically verify it.
"RTN","PSAVER3",33,0)
 I '+$G(PSAERR),PSALNSU,'$G(PSAPRINT) D VERIFY,VERIFY1 Q
"RTN","PSAVER3",34,0)
 ;
"RTN","PSAVER3",35,0)
NEWDRUG ;Store in array if drug is new to location/vault
"RTN","PSAVER3",36,0)
 I +PSADRG D
"RTN","PSAVER3",37,0)
 .I $P($G(^PSDRUG(PSADRG,2)),"^",3)["N",+$P(PSAIN,"^",12),'$D(^PSD(58.8,+$P(PSAIN,"^",12),1,PSADRG,0)) D
"RTN","PSAVER3",38,0)
 ..S PSAHOLD(+$P(PSAIN,"^",12),PSAIEN,PSAIEN1,$S($P($G(^PSDRUG(PSADRG,0)),"^")'="":$P($G(^PSDRUG(PSADRG,0)),"^"),1:"UNKNOWN"))=PSADRG,$P(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0),"^",10)=1
"RTN","PSAVER3",39,0)
 .I $P($G(^PSDRUG(PSADRG,2)),"^",3)'["N",+$P(PSAIN,"^",5),'$D(^PSD(58.8,+$P(PSAIN,"^",5),1,PSADRG,0)) D
"RTN","PSAVER3",40,0)
 ..S PSAHOLD(+$P(PSAIN,"^",5),PSAIEN,PSAIEN1,$S($P($G(^PSDRUG(PSADRG,0)),"^")'="":$P($G(^PSDRUG(PSADRG,0)),"^"),1:"UNKNOWN"))=PSADRG,$P(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0),"^",10)=0
"RTN","PSAVER3",41,0)
 ;
"RTN","PSAVER3",42,0)
NOTSUP ;If it is not a supply, look for drug, qty, dispense units, dispense
"RTN","PSAVER3",43,0)
 ;units/order unit, order unit, location/master vault, & reorder level
"RTN","PSAVER3",44,0)
 I '+$P(PSADATA,"^",2)&('$G(PSADRG)) S PSANOVER(PSAIEN,PSAIEN1,PSALINE)=$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))_"D"
"RTN","PSAVER3",45,0)
 I $P(PSADATA,"^",3)=""&($G(PSAQTY)="") S PSANOVER(PSAIEN,PSAIEN1,PSALINE)=$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))_"Q"
"RTN","PSAVER3",46,0)
 I $P($G(^PSDRUG(PSADRG,660)),"^",8)="" S PSANOVER(PSAIEN,PSAIEN1,PSALINE)=$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))_8
"RTN","PSAVER3",47,0)
 I '+$P($G(^PSDRUG(PSADRG,1,+PSASUB,0)),"^",7)&('+$G(PSADUOU)) S PSANOVER(PSAIEN,PSAIEN1,PSALINE)=$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))_"U"
"RTN","PSAVER3",48,0)
 I '+$P(PSADATA,"^",4)&('$G(PSAOU)) S PSANOVER(PSAIEN,PSAIEN1,PSALINE)=$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))_"O"
"RTN","PSAVER3",49,0)
 ;
"RTN","PSAVER3",50,0)
 I $P($G(^PSDRUG(PSADRG,2)),"^",3)'["N" D
"RTN","PSAVER3",51,0)
 .I '+$P(PSAIN,"^",5) S PSANOVER(PSAIEN,PSAIEN1,PSALINE)=$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))_"P" D CS^PSAVER5
"RTN","PSAVER3",52,0)
 .S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0),"^",10)=0,PSADATA=^(0)
"RTN","PSAVER3",53,0)
 I $P(PSAIN,"^",8)="N"!($P(PSAIN,"^",8)="S"),'+$P(PSAIN,"^",5),$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))'["P" S PSANOVER(PSAIEN,PSAIEN1,PSALINE)=$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))_"P"
"RTN","PSAVER3",54,0)
 ;
"RTN","PSAVER3",55,0)
 I $P($G(^PSDRUG(PSADRG,2)),"^",3)["N" D
"RTN","PSAVER3",56,0)
 .I '+$P(PSAIN,"^",12) S PSANOVER(PSAIEN,PSAIEN1,PSALINE)=$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))_"M" D CS^PSAVER5
"RTN","PSAVER3",57,0)
 .S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0),"^",10)=1,PSADATA=^(0)
"RTN","PSAVER3",58,0)
 I $P(PSAIN,"^",8)="A"!($P(PSAIN,"^",8)="S"),'+$P(PSAIN,"^",12),$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))'["M" S PSANOVER(PSAIEN,PSAIEN1,PSALINE)=$G(PSANOVER(PSAIEN,PSAIEN1,PSALINE))_"M"
"RTN","PSAVER3",59,0)
 ;
"RTN","PSAVER3",60,0)
 S:$D(PSANOVER(PSAIEN,PSAIEN1,PSALINE)) PSAERR=PSAERR+1,PSALNERR=1
"RTN","PSAVER3",61,0)
 I 'PSAERR D GOOD Q
"RTN","PSAVER3",62,0)
 Q
"RTN","PSAVER3",63,0)
 ;
"RTN","PSAVER3",64,0)
GOOD ;If no errors found, verify invoice.
"RTN","PSAVER3",65,0)
 D VERIFY,VERIFY1
"RTN","PSAVER3",66,0)
 S PSAL=0 F  S PSAL=+$O(PSAHOLD(PSAL)) Q:'PSAL  D
"RTN","PSAVER3",67,0)
 .S PSANAME="" F  S PSANAME=$O(PSAHOLD(PSAL,PSAIEN,PSAIEN1,PSANAME)) Q:PSANAME=""  D
"RTN","PSAVER3",68,0)
 ..S PSANEWD(PSAL,PSANAME)=PSAHOLD(PSAL,PSAIEN,PSAIEN1,PSANAME)
"RTN","PSAVER3",69,0)
 K PSAHOLD
"RTN","PSAVER3",70,0)
 Q
"RTN","PSAVER3",71,0)
 ;
"RTN","PSAVER3",72,0)
PRINT ;Prints verification error list
"RTN","PSAVER3",73,0)
 S DIR(0)="Y",DIR("A")="Do you want to print the verification error report",DIR("B")="N"
"RTN","PSAVER3",74,0)
 S DIR("?",1)="Enter YES if you want to print the report just displayed.",DIR("?")="Enter NO if you do not want to print the report.",DIR("??")="^D PRINTYN^PSAVER3"
"RTN","PSAVER3",75,0)
 D ^DIR K DIR I $G(DTOUT)!($G(DUOUT)) S PSAOUT=1 Q
"RTN","PSAVER3",76,0)
 Q:Y=""!('+Y)
"RTN","PSAVER3",77,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP
"RTN","PSAVER3",78,0)
 I $D(IO("Q")) D  Q
"RTN","PSAVER3",79,0)
 .S ZTDESC="Drug Acct. - Print Prime Vendor Invoices",ZTRTN="PRN^PSAVER3"
"RTN","PSAVER3",80,0)
 .F PSASAVE="PSAIN","PSASLN" S:$D(@PSASAVE) ZTSAVE(PSASAVE)=""
"RTN","PSAVER3",81,0)
 .D ^%ZTLOAD
"RTN","PSAVER3",82,0)
 ;
"RTN","PSAVER3",83,0)
PRN ;Entry point to print verification errors
"RTN","PSAVER3",84,0)
 S (PSAERR,PSALINE,PSAOUT,PSAPG)=0,PSAPRINT=1
"RTN","PSAVER3",85,0)
 S PSAIEN=0 F  S PSAIEN=$O(PSANOVER(PSAIEN)) Q:'PSAIEN!(PSAOUT)  D
"RTN","PSAVER3",86,0)
 .Q:'$D(^PSD(58.811,PSAIEN,0))  S PSAORD=$P(^PSD(58.811,PSAIEN,0),"^")
"RTN","PSAVER3",87,0)
 .S PSAIEN1=0 F  S PSAIEN1=$O(PSANOVER(PSAIEN,PSAIEN1)) Q:'PSAIEN1!(PSAOUT)  D
"RTN","PSAVER3",88,0)
 ..Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0))  S PSAIN=^PSD(58.811,PSAIEN,1,PSAIEN1,0),PSAINV=$P(PSAIN,"^")
"RTN","PSAVER3",89,0)
 ..S PSALINE=0 F  S PSALINE=$O(PSANOVER(PSAIEN,PSAIEN1,PSALINE)) Q:'PSALINE!(PSAOUT)  D
"RTN","PSAVER3",90,0)
 ...D NOVER
"RTN","PSAVER3",91,0)
 .K PSANOVER(PSAIEN)
"RTN","PSAVER3",92,0)
 W !!,"** The invoice has not been placed in a Verified status!",!
"RTN","PSAVER3",93,0)
 D:$E(IOST,1,2)="C-" END^PSAPROC W:$E(IOST)'="C" @IOF
"RTN","PSAVER3",94,0)
 D ^%ZISC
"RTN","PSAVER3",95,0)
 Q
"RTN","PSAVER3",96,0)
 ;
"RTN","PSAVER3",97,0)
NOVER ;Prints errors
"RTN","PSAVER3",98,0)
 S PSANO=PSANOVER(PSAIEN,PSAIEN1,PSALINE),PSALEN=$L(PSANO)
"RTN","PSAVER3",99,0)
 S PSALINEN=$P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0)),"^"),PSATAB=$L(PSALINEN)+8
"RTN","PSAVER3",100,0)
 I $E(IOST,1,2)="C-" D:'PSAPG HDR I $Y+(4+PSALEN)>IOSL D END^PSAPROC Q:PSAOUT  D HDR
"RTN","PSAVER3",101,0)
 I $E(IOST)'="C",$Y+(4+PSALEN)>IOSL!('PSAPG) D HDR
"RTN","PSAVER3",102,0)
 W "Line# "_PSALINEN_": "
"RTN","PSAVER3",103,0)
 W:PSANO[8 ?PSATAB,"Dispense unit",!
"RTN","PSAVER3",104,0)
 W:PSANO["U" ?PSATAB,"Dispense unit per order unit",!
"RTN","PSAVER3",105,0)
 W:PSANO["D" ?PSATAB,"Drug",!
"RTN","PSAVER3",106,0)
 I PSANO["M" W ?PSATAB,"Master Vault",!
"RTN","PSAVER3",107,0)
 W:PSANO["O" ?PSATAB,"Order unit",!
"RTN","PSAVER3",108,0)
 I PSANO["P" W ?PSATAB,"Pharmacy location",!
"RTN","PSAVER3",109,0)
 W:PSANO["Q" ?PSATAB,"Quantity",!
"RTN","PSAVER3",110,0)
 W !
"RTN","PSAVER3",111,0)
 Q
"RTN","PSAVER3",112,0)
 ;
"RTN","PSAVER3",113,0)
HDR ;Prints header
"RTN","PSAVER3",114,0)
 I $E(IOST,1,2)="C-" W @IOF,!?23,"<<< VERIFICATION ERROR REPORT >>>"
"RTN","PSAVER3",115,0)
 I $E(IOST)'="C" W:PSAPG'=1 @IOF W !?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",!?27,"VERIFICATION ERROR REPORT",?72,"Page "_PSAPG,!
"RTN","PSAVER3",116,0)
 S PSAPG=PSAPG+1
"RTN","PSAVER3",117,0)
 W !,"Order#: "_PSAORD_"  Invoice#: "_$P(PSAIN,"^")_"  Invoice Date: "_$$FMTE^XLFDT(+$P(PSAIN,"^",2)) W:'$G(PSAERR) !,PSASLN,!
"RTN","PSAVER3",118,0)
 I $G(PSAERR) W !!,"The following line numbers' status cannot be changed to Verified.",!,"The fields that contain an error or need data are listed with the line item.",!,PSASLN,!
"RTN","PSAVER3",119,0)
 Q
"RTN","PSAVER3",120,0)
 ;
"RTN","PSAVER3",121,0)
STATUS ;Sets invoice's status to Verified
"RTN","PSAVER3",122,0)
 S DA=PSAIEN1,DA(1)=PSAIEN,DIE="^PSD(58.811,"_DA(1)_",1,",DR="2///V;12///^S X="_DUZ
"RTN","PSAVER3",123,0)
 F  L +^PSD(58.811,PSAIEN,1,PSAIEN1,0):0 I  Q
"RTN","PSAVER3",124,0)
 D ^DIE L -^PSD(58.811,PSAIEN,1,PSAIEN1,0)
"RTN","PSAVER3",125,0)
 K DIE
"RTN","PSAVER3",126,0)
 Q
"RTN","PSAVER3",127,0)
 ;
"RTN","PSAVER3",128,0)
VERIFY ;Set line item to verified
"RTN","PSAVER3",129,0)
 I PSADRG,$P($G(^PSDRUG(PSADRG,2)),"^",3)["N" S PSACSLN=1
"RTN","PSAVER3",130,0)
 E  S PSACSLN=0
"RTN","PSAVER3",131,0)
 K DA S DA=PSALINE,DA(1)=PSAIEN1,DA(2)=PSAIEN,DIE="^PSD(58.811,"_DA(2)_",1,"_DA(1)_",1,",DR="7///^S X="_DT_";8///^S X="_DUZ_";12///^S X=PSACSLN"
"RTN","PSAVER3",132,0)
 F  L +^PSD(58.811,PSAIEN,1,PSAIEN1,0):0 I  Q
"RTN","PSAVER3",133,0)
 D ^DIE L -^PSD(58.811,PSAIEN,1,PSAIEN1,0)
"RTN","PSAVER3",134,0)
 K DIE
"RTN","PSAVER3",135,0)
 Q
"RTN","PSAVER3",136,0)
 ;
"RTN","PSAVER3",137,0)
VERIFY1 ;Set adjs if entire invioce was verified
"RTN","PSAVER3",138,0)
 S DA=0 F  S DA=$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,DA)) Q:'DA  D
"RTN","PSAVER3",139,0)
 .Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,DA,0))
"RTN","PSAVER3",140,0)
 .Q:$P(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,DA,0),"^",9)=DUZ
"RTN","PSAVER3",141,0)
 .S PSAREA="",PSADJ=$P(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,DA,0),"^",2) D ADJ^PSAVER2
"RTN","PSAVER3",142,0)
 Q
"RTN","PSAVER3",143,0)
 ;
"RTN","PSAVER3",144,0)
DDQOR ;Extended help for 'Edit field'
"RTN","PSAVER3",145,0)
 W !?5,"Enter the number or range of numbers of the field you want to edit.",!?5,"For example, 1-3 or 1,3"
"RTN","PSAVER3",146,0)
 Q
"RTN","PSAVER3",147,0)
LNHELP ;Extended help for 'Line Number"
"RTN","PSAVER3",148,0)
 W !?5,"Enter the number of the item on the invoice you want to edit.",!?5,"You may enter several line item numbers separated by comas.",!!?5,"Do NOT enter a range of numbers separated by a dash."
"RTN","PSAVER3",149,0)
 Q
"RTN","PSAVER3",150,0)
PRINTYN ;Extended help for 'Print verification report'
"RTN","PSAVER3",151,0)
 W !?5,"Enter YES to print the Verification Error Report on a printer.",!?5,"Enter NO if you do not want to print the report."
"RTN","PSAVER3",152,0)
 Q
"RTN","PSAVER4")
0^105^B8381163
"RTN","PSAVER4",1,0)
PSAVER4 ;;BIR/JMB-Verify Invoices - CONT'D ;9/8/97
"RTN","PSAVER4",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAVER4",3,0)
 ;This routine prints the report of new drugs that will be added to
"RTN","PSAVER4",4,0)
 ;each pharmacy location or master vault.
"RTN","PSAVER4",5,0)
 ;
"RTN","PSAVER4",6,0)
 ;Asks & prints all invoices the user can verify.
"RTN","PSAVER4",7,0)
 W @IOF,!,"The verified invoices contain new drugs for the assigned pharmacy location.",!,"A report will print by pharmacy location listing the new drugs. Use the"
"RTN","PSAVER4",8,0)
 W !,"Balance Adjustment option to enter an adjustment that reflects the total",!,"dispense units on hand for each new drug.",!!,"It is suggested that you send the report to a print."
"RTN","PSAVER4",9,0)
 K IO("Q") S %ZIS="0Q" W !
"RTN","PSAVER4",10,0)
 D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSAVER4",11,0)
 I $D(IO("Q")) D  G QUIT
"RTN","PSAVER4",12,0)
 .N ZTSAVE,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK
"RTN","PSAVER4",13,0)
 .S ZTDESC="Drug Acct. - Print New Drugs",ZTDTH=$H,ZTRTN="PRINT^PSAVER4"
"RTN","PSAVER4",14,0)
 .S ZTSAVE("PSANEWD(")="" D ^%ZTLOAD
"RTN","PSAVER4",15,0)
 ;
"RTN","PSAVER4",16,0)
PRINT ;Sends invoices to printer
"RTN","PSAVER4",17,0)
 S (PSALOC,PSAOUT)=0,PSAPG=1,PSADLN="",$P(PSADLN,"=",80)="",PSASLN="",$P(PSASLN,"-",80)=""
"RTN","PSAVER4",18,0)
 F  S PSALOC=+$O(PSANEWD(PSALOC)) Q:'PSALOC!(PSAOUT)  S PSADRGN=1 D HDR  Q:PSAOUT  D  Q:PSAOUT
"RTN","PSAVER4",19,0)
 .F  S PSADRGN=$O(PSANEWD(PSALOC,PSADRGN)) Q:PSADRGN=""!(PSAOUT)  D:$Y+5>IOSL HDR Q:PSAOUT  W !,PSADRGN,!,PSASLN,!
"RTN","PSAVER4",20,0)
 D:$E(IOST,1,2)="C-"&('PSAOUT) END^PSAPROC W:$E(IOST)'="C" @IOF
"RTN","PSAVER4",21,0)
 K PSANEWD(PSALOC)
"RTN","PSAVER4",22,0)
QUIT D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAVER4",23,0)
 Q
"RTN","PSAVER4",24,0)
 ;
"RTN","PSAVER4",25,0)
HDR     ;Prints the header to the New Drug Report on the screen & paper.
"RTN","PSAVER4",26,0)
 I $E(IOST,1,2)="C-" D:PSAPG'=1 END^PSAPROC Q:PSAOUT  W @IOF,!?28,"<<< NEW DRUG REPORT >>>"
"RTN","PSAVER4",27,0)
 I $E(IOST)'="C" W:PSAPG'=1 @IOF W !?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE",!?28,"<<< NEW DRUG REPORT >>>",?72,"Page "_PSAPG
"RTN","PSAVER4",28,0)
 I $P($G(^PSD(58.8,PSALOC,0)),"^",2)="M" W !?34,"MASTER VAULT",!!,$P($G(^PSD(58.8,PSALOC,0)),"^")
"RTN","PSAVER4",29,0)
 I $P($G(^PSD(58.8,PSALOC,0)),"^",2)="P" D
"RTN","PSAVER4",30,0)
 .D SITES^PSAUTL1 S PSALOCN=$P(^PSD(58.8,PSALOC,0),"^")_PSACOMB
"RTN","PSAVER4",31,0)
 .W !?31,"PHARMACY LOCATION",!!
"RTN","PSAVER4",32,0)
 .W:$L(PSALOCN)>76 $P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 PSALOCN
"RTN","PSAVER4",33,0)
 W !,PSADLN S PSAPG=PSAPG+1
"RTN","PSAVER4",34,0)
 Q
"RTN","PSAVER5")
0^106^B26676151
"RTN","PSAVER5",1,0)
PSAVER5 ;BIR/JMB-Verify Invoices - CONT'D ;10/6/97
"RTN","PSAVER5",2,0)
 ;;3.0t2; DRUG ACCOUNTABILITY ;;
"RTN","PSAVER5",3,0)
 ;This routine assigns an invoice to a pharmacy location or master vault
"RTN","PSAVER5",4,0)
 ;if the location changes during verification.
"RTN","PSAVER5",5,0)
 ;
"RTN","PSAVER5",6,0)
MASTER ;Assigns invoice to Master Vault
"RTN","PSAVER5",7,0)
 S (PSAMVN,PSAMV)=0 F  S PSAMV=+$O(^PSD(58.8,"ADISP","M",PSAMV)) Q:'PSAMV  D
"RTN","PSAVER5",8,0)
 .S PSAMVN=PSAMVN+1,PSAONEMV=PSAMV,PSAMV($P(^PSD(58.8,PSAMV,0),"^"),PSAMV)=""
"RTN","PSAVER5",9,0)
 I 'PSAMVN W !!,"No master vaults are set up. You must set up a master vault then",!,"select the Process Uploaded Prime Vendor Invoices Data option." S PSAOUT=1 Q
"RTN","PSAVER5",10,0)
 I PSAMVN=1 D  Q
"RTN","PSAVER5",11,0)
 .W !!,"Controlled substances on the invoice has been",!,"automatically assigned to the Master Vault."
"RTN","PSAVER5",12,0)
 .W !,$P(^PSD(58.8,PSAONEMV,0),"^")
"RTN","PSAVER5",13,0)
 .W !!,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN)
"RTN","PSAVER5",14,0)
 .S DR="13///^S X="_PSAONEMV D PHARM^PSAVER2
"RTN","PSAVER5",15,0)
 I PSAMVN>1 D DISPMV W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN) D SELMV
"RTN","PSAVER5",16,0)
 Q
"RTN","PSAVER5",17,0)
 ;
"RTN","PSAVER5",18,0)
DISPMV ;Displays active master vaults
"RTN","PSAVER5",19,0)
 W @IOF,!?22,"<<< ASSIGN A MASTER VAULT SCREEN >>>",!,PSASLN
"RTN","PSAVER5",20,0)
 S PSA=0,PSAMVA="" F  S PSAMVA=$O(PSAMV(PSAMVA)) Q:PSAMVA=""  D
"RTN","PSAVER5",21,0)
 .S PSAMVIEN=0 F  S PSAMVIEN=$O(PSAMV(PSAMVA,PSAMVIEN)) Q:'PSAMVIEN  D
"RTN","PSAVER5",22,0)
 ..S PSA=PSA+1,PSAVAULT(PSA,PSAMVA,PSAMVIEN)=""
"RTN","PSAVER5",23,0)
 ..W !,$J(PSA,2)_".",?4,PSAMVA
"RTN","PSAVER5",24,0)
 W !
"RTN","PSAVER5",25,0)
 Q
"RTN","PSAVER5",26,0)
 ;
"RTN","PSAVER5",27,0)
SELMV ;Select displayed master vaults
"RTN","PSAVER5",28,0)
 W ! S DIR(0)="NO^1:"_PSA,DIR("A")="Select Master Vault",DIR("?")="Select the Master Vault that received the invoice's drugs"
"RTN","PSAVER5",29,0)
 S DIR("??")="^D MV^PSAPROC" D ^DIR K DIR Q:Y=""  I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAVER5",30,0)
 S PSASEL=Y
"RTN","PSAVER5",31,0)
 S PSAMVA=$O(PSAVAULT(PSASEL,"")) Q:PSAMVA=""  S PSAMVIEN=+$O(PSAVAULT(PSASEL,PSAMVA,0)) Q:'PSAMVIEN  S DR="13///^S X="_PSAMVIEN D PHARM^PSAVER2
"RTN","PSAVER5",32,0)
 Q
"RTN","PSAVER5",33,0)
 ;
"RTN","PSAVER5",34,0)
GETLOC ;Gets pharmacy locations
"RTN","PSAVER5",35,0)
 S (PSALOC,PSANUM)=0 F  S PSALOC=+$O(^PSD(58.8,"ADISP","P",PSALOC)) Q:'PSALOC  D
"RTN","PSAVER5",36,0)
 .Q:'$D(^PSD(58.8,PSALOC,0))!($P($G(^PSD(58.8,PSALOC,0)),"^")="")
"RTN","PSAVER5",37,0)
 .I +$G(^PSD(58.8,PSALOC,"I")),+^PSD(58.8,PSALOC,"I")'>DT Q
"RTN","PSAVER5",38,0)
 .S PSANUM=PSANUM+1,PSAONE=PSALOC,PSAISIT=+$P(^PSD(58.8,PSALOC,0),"^",3),PSAOSIT=+$P(^(0),"^",10)
"RTN","PSAVER5",39,0)
 .D SITES^PSAUTL1 S PSALOCA($P(^PSD(58.8,PSALOC,0),"^")_PSACOMB,PSALOC)=PSAISIT_"^"_PSAOSIT
"RTN","PSAVER5",40,0)
 G:'PSANUM NONE G:PSANUM=1 ONE G:PSANUM>1 MANY
"RTN","PSAVER5",41,0)
 ;
"RTN","PSAVER5",42,0)
NONE ;No DA pharmacy locations
"RTN","PSAVER5",43,0)
 W !!,"There are no Drug Accountability pharmacy locations.",!!,"Use the Set Up/Edit a Pharmacy Location option on Pharmacy Location menu"
"RTN","PSAVER5",44,0)
 W !,"to setup one or more pharmacy locations. Then select the Process Uploaded",!,"Prime Vendor Invoice Data option to process the invoices."
"RTN","PSAVER5",45,0)
 Q
"RTN","PSAVER5",46,0)
 ;
"RTN","PSAVER5",47,0)
ONE ;Only one location
"RTN","PSAVER5",48,0)
 S PSACNT=0,PSALOC=PSAONE,PSALOCN=$O(PSALOCA(""))
"RTN","PSAVER5",49,0)
 W !!,"The non-controlled substance items on the invoice have",!,"been automatically assigned to the Pharmacy Location."
"RTN","PSAVER5",50,0)
 W:$L(PSALOCN)>76 !,$P(PSALOCN,"(IP)",1)_"(IP)",!?17,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<77 PSALOCN
"RTN","PSAVER5",51,0)
 W !!,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN)
"RTN","PSAVER5",52,0)
 S DR="4///^S X="_PSAONE D PHARM^PSAVER2
"RTN","PSAVER5",53,0)
 Q
"RTN","PSAVER5",54,0)
 ;
"RTN","PSAVER5",55,0)
MANY ;If more than one pharmacy location, display invoices.
"RTN","PSAVER5",56,0)
 D DISPLOC W !,"Order#: "_PSAORD_"  Invoice#: "_PSAINV_"  Invoice Date: "_$$FMTE^XLFDT(+PSAIN) D SELLOC
"RTN","PSAVER5",57,0)
 Q
"RTN","PSAVER5",58,0)
 ;
"RTN","PSAVER5",59,0)
DISPLOC ;Displays the active pharmacy locations.
"RTN","PSAVER5",60,0)
 W @IOF,!?19,"<<< ASSIGN A PHARMACY LOCATION SCREEN >>>",!,PSASLN
"RTN","PSAVER5",61,0)
 S PSACNT=0,PSALOCN="" F  S PSALOCN=$O(PSALOCA(PSALOCN)) Q:PSALOCN=""  D
"RTN","PSAVER5",62,0)
 .S PSALOC=0 F  S PSALOC=$O(PSALOCA(PSALOCN,PSALOC)) Q:'PSALOC  D
"RTN","PSAVER5",63,0)
 ..S PSACNT=PSACNT+1,PSAMENU(PSACNT,PSALOCN,PSALOC)=PSALOC
"RTN","PSAVER5",64,0)
 ..W !,$J(PSACNT,2)_"." W:$L(PSALOCN)>72 ?4,$P(PSALOCN,"(IP)",1)_"(IP)",!?21,$P(PSALOCN,"(IP)",2) W:$L(PSALOCN)<73 ?4,PSALOCN
"RTN","PSAVER5",65,0)
 W !
"RTN","PSAVER5",66,0)
 Q
"RTN","PSAVER5",67,0)
 ;
"RTN","PSAVER5",68,0)
SELLOC ;Select the Pharmacy Location to be assigned to the order.
"RTN","PSAVER5",69,0)
 W ! K DIR S DIR(0)="NO^1:"_PSACNT,DIR("A")="Pharmacy Location",DIR("?")="Select the pharmacy location that received the invoice's drugs"
"RTN","PSAVER5",70,0)
 S DIR("??")="^D LOCHELP^PSAVER5" D ^DIR K DIR Q:Y=""  I $G(DIRUT) S PSAOUT=1 Q
"RTN","PSAVER5",71,0)
 S PSASEL=Y
"RTN","PSAVER5",72,0)
 S PSALOCN=$O(PSAMENU(PSASEL,"")) Q:PSALOCN=""  S PSALOC=$O(PSAMENU(PSASEL,PSALOCN,0)) Q:'PSALOC  S DR="4///^S X="_PSALOC D PHARM^PSAVER2
"RTN","PSAVER5",73,0)
 Q
"RTN","PSAVER5",74,0)
 ;
"RTN","PSAVER5",75,0)
CS ;Sets invoice's CONTROLLED SUBSTANCES field if a drug changed from CS to
"RTN","PSAVER5",76,0)
 ;non-CS or vice-versa.
"RTN","PSAVER5",77,0)
 S (PSA10,PSAL,PSAN10)=0 F  S PSAL=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAL)) Q:'PSAL  D
"RTN","PSAVER5",78,0)
 .I +$P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSAL,0)),"^",10) S PSA10=PSA10+1 Q
"RTN","PSAVER5",79,0)
 .S PSAN10=PSA10+1
"RTN","PSAVER5",80,0)
 S $P(^PSD(58.811,PSAIEN,1,PSAIEN1,0),"^",8)=$S(PSA10&(PSAN10):"S",PSA10&('PSAN10):"A",1:"N")
"RTN","PSAVER5",81,0)
 S PSAIN=^PSD(58.811,PSAIEN,1,PSAIEN1,0)
"RTN","PSAVER5",82,0)
 Q
"RTN","PSAVER5",83,0)
 ;
"RTN","PSAVER5",84,0)
LOCHELP ;Extended help for the select "Pharmacy Location" prompt
"RTN","PSAVER5",85,0)
 W !?5,"Enter the number of the pharmacy location for which you want to assign",!?5,"the order. The invoiced drugs in the assigned pharmacy location will be"
"RTN","PSAVER5",86,0)
 W !?5,"incremented with the quantity received after the order is verified."
"RTN","PSAVER5",87,0)
 Q
"RTN","PSAVER6")
0^107^B29774458
"RTN","PSAVER6",1,0)
PSAVER6 ;BIR/JMB-Verify Invoices - CONT'D ;10/3/97
"RTN","PSAVER6",2,0)
 ;;3.0t2; DRUG ACCOUNTABILITY ;;
"RTN","PSAVER6",3,0)
 ;Background Job:
"RTN","PSAVER6",4,0)
 ;This routine increments pharmacy location and master vault balances
"RTN","PSAVER6",5,0)
 ;in 58.8 after invoices have been verified.
"RTN","PSAVER6",6,0)
 ;
"RTN","PSAVER6",7,0)
START S PSAIEN=0  F  S PSAIEN=+$O(PSAVBKG(PSAIEN)) Q:'PSAIEN  D
"RTN","PSAVER6",8,0)
 .Q:'$D(^PSD(58.811,PSAIEN,0))
"RTN","PSAVER6",9,0)
 .S PSAORD=$P(^PSD(58.811,PSAIEN,0),"^"),PSAVEND=$P(^(0),"^",2),PSAIEN1=0
"RTN","PSAVER6",10,0)
 .F  S PSAIEN1=+$O(PSAVBKG(PSAIEN,PSAIEN1)) Q:'PSAIEN1  D
"RTN","PSAVER6",11,0)
 ..Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0))
"RTN","PSAVER6",12,0)
 ..S PSAIN=^PSD(58.811,PSAIEN,1,PSAIEN1,0)
"RTN","PSAVER6",13,0)
 ..I +$P(PSAIN,"^",13) K DA S DIE="^PSD(58.811,"_PSAIEN_",1,",DA(1)=PSAIEN,DA=PSAIEN1,DR="2////C" D ^DIE K DIE,DA,DR Q
"RTN","PSAVER6",14,0)
 ..S PSAINV=$P(PSAIN,"^"),PSAINVDT=$P(PSAIN,"^",2),PSALINE=0
"RTN","PSAVER6",15,0)
 ..F  S PSALINE=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE)) Q:'PSALINE  D
"RTN","PSAVER6",16,0)
 ...Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0))
"RTN","PSAVER6",17,0)
 ...S PSADATA=^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0) D GETDATA D:'PSASUP FILE
"RTN","PSAVER6",18,0)
 ..K DA S DIE="^PSD(58.811,"_PSAIEN_",1,",DA(1)=PSAIEN,DA=PSAIEN1,DR="2////C" D ^DIE K DIE,DA,DR
"RTN","PSAVER6",19,0)
 ..D MSG^PSAVER7
"RTN","PSAVER6",20,0)
EXIT ;Kills variables
"RTN","PSAVER6",21,0)
 K %,DA,DD,DIC,DIE,DINUM,DLAYGO,DO,PSA,PSAA,PSABAL,PSACBAL,PSACNT,PSACNT,PSACOD,PSACOST,PSACS,PSADASH,PSADATA,PSADJ,PSADJD,PSADJO,PSADJP,PSADJQ
"RTN","PSAVER6",22,0)
 K PSADRG,PSADT,PSADUOU,PSADUQTY,PSADUREC,PSAIEN,PSAIEN1,PSAIN,PSAINV,PSAINVDT,PSALEN,PSALINE,PSALOC,PSAMSG,PSANDC,PSANODE,PSANPDU,PSANPOU
"RTN","PSAVER6",23,0)
 K PSAODASH,PSAONDC,PSAORD,PSAOU,PSAPDU,PSAPOU,PSAQTY,PSAREORD,PSASET,PSASTOCK,PSASUP,PSAT,PSATDRG,PSATEMP,PSAVBKG,PSAVDUZ,PSAVEND,PSAVSN,X,XMDUZ,XMSUB,XMTEXT,XMY,XMZ,Y
"RTN","PSAVER6",24,0)
 Q
"RTN","PSAVER6",25,0)
 ;
"RTN","PSAVER6",26,0)
GETDATA ;Gets invoice data to help file the data
"RTN","PSAVER6",27,0)
 S PSAVDUZ=$P(PSADATA,"^",9),PSASUP=0
"RTN","PSAVER6",28,0)
 S PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","D",0))
"RTN","PSAVER6",29,0)
 I '+PSADJ S PSADRG=$S(+$P(PSADATA,"^",2):+$P(PSADATA,"^",2),1:0) G CS
"RTN","PSAVER6",30,0)
 I +PSADJ D
"RTN","PSAVER6",31,0)
 .S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0))
"RTN","PSAVER6",32,0)
 .S PSADJD=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAVER6",33,0)
 .I PSADJD'?1.N S PSASUP=1
"RTN","PSAVER6",34,0)
 .S PSADRG=$S(PSADJ&('PSASUP):+PSADJD,PSADJ&(PSASUP):0,1:+$P(PSADATA,"^",2))
"RTN","PSAVER6",35,0)
 .I +PSADJD,$L(PSADJD)=+$L(PSADJD),$P($G(^PSDRUG(+PSADJD,0)),"^")'="" S PSADRG=+PSADJD Q
"RTN","PSAVER6",36,0)
 .I +PSADJD,$L(PSADJD)=+$L(PSADJD),$P($G(^PSDRUG(+PSADJD,0)),"^")="" S (PSADJ,PSADRG)=0 Q
"RTN","PSAVER6",37,0)
CS Q:PSASUP!('PSADRG)
"RTN","PSAVER6",38,0)
 S PSACS=$S(+$P(PSADATA,"^",10):1,1:0)
"RTN","PSAVER6",39,0)
 S PSADJQ=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","Q",0))
"RTN","PSAVER6",40,0)
 I +PSADJ S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)),PSADJQ=$S($P(PSANODE,"^",6)'="":+$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAVER6",41,0)
 S PSAQTY=$S(+PSADJQ:PSADJQ,1:+$P(PSADATA,"^",3))
"RTN","PSAVER6",42,0)
 S PSAOU=$S(+$P(PSADATA,"^",4):+$P(PSADATA,"^",4),1:"")
"RTN","PSAVER6",43,0)
 I +$P($P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2)),"^",5),"~",2) S PSAOU=$P($P($G(^(2)),"^",5),"~",2)
"RTN","PSAVER6",44,0)
 S PSADJO=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","O",0))
"RTN","PSAVER6",45,0)
 I +PSADJ S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)),PSADJO=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAVER6",46,0)
 S:+PSADJO PSAOU=+PSADJO
"RTN","PSAVER6",47,0)
 S PSANDC=$P(PSADATA,"^",11),PSADASH=$E(PSANDC,1,6)_"-"_$E(PSANDC,7,10)_"-"_$E(PSANDC,11,12)
"RTN","PSAVER6",48,0)
 S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","P",0))
"RTN","PSAVER6",49,0)
 I +PSADJ S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)),PSADJP=$S(+$P(PSANODE,"^",6):+$P(PSANODE,"^",6),1:+$P(PSANODE,"^",2))
"RTN","PSAVER6",50,0)
 S (PSAPOU,PSANPOU)=$S(+PSADJP:PSADJP,1:+$P(PSADATA,"^",5)),PSALEN=$L($P(PSANPOU,".")),(PSAPOU,PSANPOU)=$J(PSANPOU,PSALEN,2)
"RTN","PSAVER6",51,0)
 S PSAVSN=$P(PSADATA,"^",12)
"RTN","PSAVER6",52,0)
 S PSALOC=$S(+PSACS:+$P(PSAIN,"^",12),1:+$P(PSAIN,"^",5))
"RTN","PSAVER6",53,0)
TEMP S PSATEMP=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2))
"RTN","PSAVER6",54,0)
 S PSADUOU=+$P(PSATEMP,"^"),PSAREORD=+$P(PSATEMP,"^",2),PSASUB=+$P(PSATEMP,"^",3),PSASTOCK=+$P(PSATEMP,"^",4)
"RTN","PSAVER6",55,0)
 S PSADUOU=$S(+PSADUOU:+PSADUOU,+PSASUB&(+$P($G(^PSDRUG(PSADRG,1,PSASUB,0)),"^",7)):+$P($G(^PSDRUG(PSADRG,1,PSASUB,0)),"^",7),1:0)
"RTN","PSAVER6",56,0)
 S PSADUREC=$S(PSADUOU:PSAQTY*PSADUOU,1:0)
"RTN","PSAVER6",57,0)
 Q:'+$P($G(^PSD(58.8,PSALOC,0)),"^",14)
"RTN","PSAVER6",58,0)
 S PSAREORD=$S(+PSAREORD:+PSAREORD,+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",5):+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",5),1:0)
"RTN","PSAVER6",59,0)
 S PSASTOCK=$S(+PSASTOCK:+PSASTOCK,+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",5):+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",5),1:0)
"RTN","PSAVER6",60,0)
 Q
"RTN","PSAVER6",61,0)
 ;
"RTN","PSAVER6",62,0)
FILE ;File data in 58.8
"RTN","PSAVER6",63,0)
 D NOW^%DTC S PSADT=+$E(%,1,14)
"RTN","PSAVER6",64,0)
 I '$D(^PSD(58.8,PSALOC,1,PSADRG,0)) D
"RTN","PSAVER6",65,0)
 .S:'$D(^PSD(58.8,PSALOC,1,0)) DIC("P")=$P(^DD(58.8,10,0),"^",2)
"RTN","PSAVER6",66,0)
 .S DA(1)=PSALOC,DIC="^PSD(58.8,"_DA(1)_",1,",(DA,X)=PSADRG,DIC(0)="L",DLAYGO=58.8
"RTN","PSAVER6",67,0)
 .F  L +^PSD(58.8,PSALOC,0):0 I  Q
"RTN","PSAVER6",68,0)
 .D ^DIC L -^PSD(58.8,PSALOC,0) K DIC,DA,DLAYGO
"RTN","PSAVER6",69,0)
 F  L +^PSD(58.8,PSALOC,1,PSADRG,0):0 I  Q
"RTN","PSAVER6",70,0)
 S PSABAL=$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",4)
"RTN","PSAVER6",71,0)
 S $P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",4)=PSADUREC+PSABAL
"RTN","PSAVER6",72,0)
 I +$P($G(^PSD(58.8,PSALOC,0)),"^",14) D
"RTN","PSAVER6",73,0)
 .I PSASTOCK'=$P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",3) S $P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",3)=PSASTOCK
"RTN","PSAVER6",74,0)
 .I PSAREORD'=$P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",5) S $P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",5)=PSAREORD
"RTN","PSAVER6",75,0)
 S:'$D(^PSD(58.8,PSALOC,1,PSADRG,5,0)) DIC("P")=$P(^DD(58.8001,20,0),"^",2)
"RTN","PSAVER6",76,0)
 I '$D(^PSD(58.8,PSALOC,1,PSADRG,5,$E(DT,1,5)*100,0)) D
"RTN","PSAVER6",77,0)
 .S DIC="^PSD(58.8,"_PSALOC_",1,"_PSADRG_",5,",DIC(0)="L",DIC("DR")="1////^S X=$G(PSABAL)",(X,DINUM)=$E(DT,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRG,DLAYGO=58.8 D ^DIC K DIC
"RTN","PSAVER6",78,0)
 .S X="T-1M" D ^%DT S DIC="^PSD(58.8,"_PSALOC_",1,"_PSADRG_",5,",DIC(0)="L",(X,DINUM)=$E(Y,1,5)*100 D ^DIC K DIC,DLAYGO S DA=+Y
"RTN","PSAVER6",79,0)
 .S DA(2)=PSALOC,DA(1)=PSADRG,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",5,",DR="3////^S X=$G(PSABAL)" D ^DIE K DIE
"RTN","PSAVER6",80,0)
 S DA(2)=PSALOC,DA(1)=PSADRG,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",5,",DA=$E(DT,1,5)*100,DR="5////^S X="_($P($G(^(0)),"^",3)+PSADUREC) D ^DIE K DIE
"RTN","PSAVER6",81,0)
 L -^PSD(58.8,PSALOC,1,PSADRG,0)
"RTN","PSAVER6",82,0)
 G TR^PSAVER7
"RTN","PSAVER7")
0^108^B31930451
"RTN","PSAVER7",1,0)
PSAVER7 ;BIR/JMB-Verify Invoices - CONT'D ;7/23/97
"RTN","PSAVER7",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAVER7",3,0)
 ;Background Job:
"RTN","PSAVER7",4,0)
 ;This routine increments pharmacy location and master vault balances
"RTN","PSAVER7",5,0)
 ;in 58.8 after invoices have been verified. This routine is called
"RTN","PSAVER7",6,0)
 ;by PSAVER6.
"RTN","PSAVER7",7,0)
 ;
"RTN","PSAVER7",8,0)
TR ;File transaction data in 58.81
"RTN","PSAVER7",9,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSAVER7",10,0)
FIND S PSAT=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSAT)) S $P(^PSD(58.81,0),"^",3)=$P(^PSD(58.81,0),"^",3)+1 G FIND
"RTN","PSAVER7",11,0)
 S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAT D ^DIC K DIC,DINUM,DLAYGO L -^PSD(58.81,0)
"RTN","PSAVER7",12,0)
 S DIE="^PSD(58.81,",DA=PSAT,DR="1////1;2////^S X=PSALOC;3////^S X=PSADT;4////^S X=PSADRG;5////^S X=PSADUREC;6////^S X=PSAVDUZ;9////^S X=PSABAL;71////^S X=PSAINV;106////^S X=PSAORD"
"RTN","PSAVER7",13,0)
 I PSACS S DR=DR_";100////^S X=PSACS"
"RTN","PSAVER7",14,0)
 F  L +^PSD(58.81,DA,0):0 I  Q
"RTN","PSAVER7",15,0)
 D ^DIE L -^PSD(58.81,DA,0) K DIE
"RTN","PSAVER7",16,0)
 S:'$D(^PSD(58.8,PSALOC,1,PSADRG,4,0)) DIC("P")=$P(^DD(58.8001,19,0),"^",2)
"RTN","PSAVER7",17,0)
 S DA(2)=PSALOC,DA(1)=PSADRG,(X,DINUM)=PSAT,DIC="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",4,",DIC(0)="L",DLAYGO=58.8
"RTN","PSAVER7",18,0)
 F  L +^PSD(58.8,PSALOC,1,PSADRG,0):0 I  Q
"RTN","PSAVER7",19,0)
 D ^DIC L -^PSD(58.8,PSALOC,1,PSADRG,0) K DIC,DINUM,DLAYGO
"RTN","PSAVER7",20,0)
 ;
"RTN","PSAVER7",21,0)
50 S PSAODASH=$P($G(^PSDRUG(PSADRG,2)),"^",4)
"RTN","PSAVER7",22,0)
 S PSAONDC=$S(PSAODASH'="":$E("000000",1,(6-$L($P(PSAODASH,"-"))))_$P(PSAODASH,"-")_$E("0000",1,(4-$L($P(PSAODASH,"-",2))))_$P(PSAODASH,"-",2)_$E("00",1,(2-$L($P(PSAODASH,"-",3))))_$P(PSAODASH,"-",3),1:"")
"RTN","PSAVER7",23,0)
 S PSACOST=PSAQTY*PSAPOU G:'PSACOST!('PSAQTY) NDC
"RTN","PSAVER7",24,0)
 S PSAPDU=+$J($S(PSADUOU:(PSAPOU/PSADUOU),1:0),0,3),PSANODE=$G(^PSDRUG(PSADRG,660))
"RTN","PSAVER7",25,0)
 I PSAPDU=+$P(PSANODE,"^",6)!('PSADUOU&('$P(PSANODE,"^",5))) G NDC
"RTN","PSAVER7",26,0)
 ;
"RTN","PSAVER7",27,0)
 S PSADUREC=(PSAQTY*PSADUOU),PSACBAL=$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",4)-PSADUREC
"RTN","PSAVER7",28,0)
 S DIE="^PSDRUG(",DA=PSADRG,DR="50////^S X="_(PSADUREC+$G(^PSDRUG(PSADRG,660.1)))
"RTN","PSAVER7",29,0)
 F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAVER7",30,0)
 D ^DIE L -^PSDRUG(DA,0) K DIE,DA
"RTN","PSAVER7",31,0)
 S (PSATDRG,PSA)=0 F  S PSA=$O(^PSD(58.8,"C",PSADRG,PSA)) Q:'PSA  D
"RTN","PSAVER7",32,0)
 .Q:PSA=PSALOC
"RTN","PSAVER7",33,0)
 .I +$G(^PSD(58.8,PSA,"I")),+^PSD(58.8,PSA,"I")'>DT Q
"RTN","PSAVER7",34,0)
 .Q:$P($G(^PSD(58.8,PSA,0)),"^",2)'="M"&($P($G(^PSD(58.8,PSA,0)),"^",2)'="P")
"RTN","PSAVER7",35,0)
 .S PSATDRG=PSATDRG+$P($G(^PSD(58.8,PSA,1,PSADRG,0)),"^",4)
"RTN","PSAVER7",36,0)
 ;Total Cost=Receipt cost + On hand cost
"RTN","PSAVER7",37,0)
 ;Current Balance=Current Balance + Receipts' dispense units
"RTN","PSAVER7",38,0)
 ;New Price per Dispense Unit=Cost / Current Balance
"RTN","PSAVER7",39,0)
 ;Price/Order Unit=New Price/Dispense Unit * Dispense Units/Order Units
"RTN","PSAVER7",40,0)
 I PSACBAL>0!(PSATDRG>0) D
"RTN","PSAVER7",41,0)
 .S PSATDRG=PSATDRG+PSACBAL
"RTN","PSAVER7",42,0)
 .S PSACOST=PSACOST+(PSATDRG*+$P(PSANODE,"^",6)),PSATDRG=PSADUREC+PSATDRG,PSANPDU=+$J((PSACOST/PSATDRG),0,3),PSANPOU=PSANPDU*PSADUOU
"RTN","PSAVER7",43,0)
 .S PSALEN=$L($P(PSANPOU,".")),PSANPOU=$J(PSANPOU,PSALEN,2)
"RTN","PSAVER7",44,0)
 E  S PSANPDU=PSAPDU
"RTN","PSAVER7",45,0)
 ;
"RTN","PSAVER7",46,0)
 I +PSANPDU=+$P(PSANODE,"^",6),PSANDC=PSAONDC G SYNONYM
"RTN","PSAVER7",47,0)
 I +PSANPDU=+$P(PSANODE,"^",6),PSANDC'=PSAONDC&(PSANDC'="") G NDC
"RTN","PSAVER7",48,0)
 I $P(PSANODE,"^",2)=PSAOU,$P(PSANODE,"^",5)=PSADUOU D
"RTN","PSAVER7",49,0)
 .I PSANDC'="",PSANDC'=PSAONDC D
"RTN","PSAVER7",50,0)
 ..S DIE="^PSDRUG(",DA=PSADRG,DR="31////^S X=PSADASH"
"RTN","PSAVER7",51,0)
 ..F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAVER7",52,0)
 ..D ^DIE L -^PSDRUG(DA,0) K DIE,DA
"RTN","PSAVER7",53,0)
 .I +PSANPDU,+PSANPDU'=+$P(PSANODE,"^",6) D
"RTN","PSAVER7",54,0)
 ..S DIE="^PSDRUG(",DA=PSADRG,DR="13///^S X="_PSANPOU
"RTN","PSAVER7",55,0)
 ..F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAVER7",56,0)
 ..D ^DIE L -^PSDRUG(DA,0) K DIE,DA
"RTN","PSAVER7",57,0)
 S PSASET=0
"RTN","PSAVER7",58,0)
 I +PSANPDU D
"RTN","PSAVER7",59,0)
 .I '+$P(PSANODE,"^",6) S PSASET=1 Q
"RTN","PSAVER7",60,0)
 .S:+$P(PSANODE,"^",6)>+PSANPDU PSASET=+$P(PSANODE,"^",6)/+PSANPDU
"RTN","PSAVER7",61,0)
 .S:+PSANPDU>+$P(PSANODE,"^",6) PSASET=+PSANPDU/+$P(PSANODE,"^",6)
"RTN","PSAVER7",62,0)
 .S PSASET=$S(PSASET>1.1:1,1:0)
"RTN","PSAVER7",63,0)
 I PSASET!(PSANDC'=PSAONDC&(PSANDC'="")) D
"RTN","PSAVER7",64,0)
 .S PSAA=0
"RTN","PSAVER7",65,0)
 .S ^TMP("PSAD",$J,$P($G(^PSDRUG(PSADRG,0)),"^"))=$P($G(^PSDRUG(PSADRG,0)),"^")
"RTN","PSAVER7",66,0)
 .I PSASET S PSAA=PSAA+1,^TMP("PSAD",$J,$P($G(^PSDRUG(PSADRG,0)),"^"),PSAA)="   Old price: $"_$P(PSANODE,"^",6)_"  New price: $"_$S(+PSAPOU&(+PSADUOU):$J((PSAPOU/PSADUOU),$L((PSAPOU/PSADUOU)),3),1:$J(0,1,3))
"RTN","PSAVER7",67,0)
 .I PSANDC'=PSAONDC,PSANDC'="" S PSAA=PSAA+1,^TMP("PSAD",$J,$P($G(^PSDRUG(PSADRG,0)),"^"),PSAA)="   Old NDC  : "_$S(PSAODASH'="":PSAODASH,1:"None")_"   New NDC: "_PSADASH
"RTN","PSAVER7",68,0)
 ;
"RTN","PSAVER7",69,0)
SYNONYM ;Adds/edits the SYNONYM multiple in DRUG file
"RTN","PSAVER7",70,0)
 Q:PSANDC=""  K DA,DR S DA(1)=PSADRG
"RTN","PSAVER7",71,0)
 S:'$D(^PSDRUG(PSADRG,1,0)) DIC("P")=$P(^DD(50,9,0),"^",2)
"RTN","PSAVER7",72,0)
 I 'PSASUB!(PSASUB&('$D(^PSDRUG(PSADRG,1,PSASUB,0)))) D
"RTN","PSAVER7",73,0)
 .S DIC="^PSDRUG("_DA(1)_",1,",DIC(0)="LM",X=PSANDC,DLAYGO=50
"RTN","PSAVER7",74,0)
 .F  L +^PSDRUG(PSADRG,0):0 I  Q
"RTN","PSAVER7",75,0)
 .D ^DIC L -^PSDRUG(PSADRG,0) K DIC,DLAYGO S PSASUB=+Y
"RTN","PSAVER7",76,0)
 I PSASUB,$D(^PSDRUG(PSADRG,1,PSASUB,0)) S DA=PSASUB
"RTN","PSAVER7",77,0)
 S DIE="^PSDRUG("_DA(1)_",1,"
"RTN","PSAVER7",78,0)
 S DR="2////^S X=PSADASH"_$S(PSACS:";1////C",1:";1////D")_";400////^S X=PSAVSN;401////^S X=PSAOU"_$S(+PSAPOU:";402////^S X=PSAPOU",1:"")_";403////^S X=PSADUOU"_$S(+$G(PSAPDU):";404////^S X=PSAPDU",1:"")_";405///^S X=PSAVEND"
"RTN","PSAVER7",79,0)
 F  L +^PSDRUG(PSADRG,0):0 I  Q
"RTN","PSAVER7",80,0)
 D ^DIE L -^PSDRUG(PSADRG,0)
"RTN","PSAVER7",81,0)
 K DIE,DR,^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2)
"RTN","PSAVER7",82,0)
 Q
"RTN","PSAVER7",83,0)
 ;
"RTN","PSAVER7",84,0)
MSG ;Sends a mail message if an order's drug price or NDC changed.
"RTN","PSAVER7",85,0)
 N PSAMSG S PSAMSG=$O(^TMP("PSAD",$J,"")) Q:PSAMSG=""
"RTN","PSAVER7",86,0)
 S PSACNT=1,PSADRG=""
"RTN","PSAVER7",87,0)
 F  S PSADRG=$O(^TMP("PSAD",$J,PSADRG)) Q:PSADRG=""  D
"RTN","PSAVER7",88,0)
 .S ^TMP("PSAMSG",$J,PSACNT)=^TMP("PSAD",$J,PSADRG),PSACNT=PSACNT+1
"RTN","PSAVER7",89,0)
 .S:$D(^TMP("PSAD",$J,PSADRG,1)) ^TMP("PSAMSG",$J,PSACNT)=^TMP("PSAD",$J,PSADRG,1),PSACNT=PSACNT+1
"RTN","PSAVER7",90,0)
 .S:$D(^TMP("PSAD",$J,PSADRG,2)) ^TMP("PSAMSG",$J,PSACNT)=^TMP("PSAD",$J,PSADRG,2),PSACNT=PSACNT+1
"RTN","PSAVER7",91,0)
 S XMDUZ="Price & NDC Updater",XMSUB="DRUG file Price/NDC Update",XMTEXT="^TMP(""PSAMSG"",$J,"
"RTN","PSAVER7",92,0)
 F PSAJJ=0:0 S PSAJJ=+$O(^XUSEC("PSAMGR",PSAJJ)) Q:'PSAJJ  S XMY(PSAJJ)=""
"RTN","PSAVER7",93,0)
 G:'$D(XMY) QUIT D ^XMD
"RTN","PSAVER7",94,0)
QUIT K ^TMP("PSAD",$J),^TMP("PSAMSG",$J),PSAJJ
"RTN","PSAVER7",95,0)
 Q
"RTN","PSAVER7",96,0)
 ;
"RTN","PSAVER7",97,0)
NDC ;This is called if the cost has not changed.
"RTN","PSAVER7",98,0)
 I PSANDC'="",$P($G(^PSDRUG(PSADRG,660)),"^",2)=PSAOU,$P($G(^PSDRUG(PSADRG,660)),"^",5)=PSADUOU,PSANDC'=PSAONDC D
"RTN","PSAVER7",99,0)
 .S DIE="^PSDRUG(",DA=PSADRG,DR="31////^S X=PSADASH"
"RTN","PSAVER7",100,0)
 .F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAVER7",101,0)
 .D ^DIE L -^PSDRUG(DA,0) K DIE,DA
"RTN","PSAVER7",102,0)
 .S ^TMP("PSAD",$J,$P($G(^PSDRUG(PSADRG,0)),"^"))=$P($G(^PSDRUG(PSADRG,0)),"^")
"RTN","PSAVER7",103,0)
 .S ^TMP("PSAD",$J,$P($G(^PSDRUG(PSADRG,0)),"^"),1)="   Old NDC: "_$S($G(PSAODASH)'="":PSAODASH,1:"None")_"  New NDC: "_PSADASH
"RTN","PSAVER7",104,0)
 G SYNONYM
"RTN","PSAVER7",105,0)
 Q
"RTN","PSAVIN")
0^109^B8772386
"RTN","PSAVIN",1,0)
PSAVIN ;BIR/LTL-Report of Inventory items' link to DRUG FILE ;7/23/97
"RTN","PSAVIN",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAVIN",3,0)
 ;
"RTN","PSAVIN",4,0)
 D DT^DICRW N DIR,DIRUT,X,Y,PSALOC,PSAOUT,DIC,DTOUT,DUOUT,PSAINV,PSAIT
"RTN","PSAVIN",5,0)
LOOK ;Select Inventory point
"RTN","PSAVIN",6,0)
 S DIC="^PRCP(445,",DIC(0)="AEMQ",DIC("S")="I $P($G(^(0)),U,20)=""D""",PRCPPRIV=1 D ^DIC K DIC,PRCPPRIV S PSAINV=+Y,PSAIT=0 I Y<0 S PSAOUT=1 G QUIT
"RTN","PSAVIN",7,0)
 I '$O(^PSD(58.8,"P",+PSAINV,0)) W !!,$$INVNAME^PRCPUX1(PSAINV)_" is NOT linked to a Drug Accountability Location.",!!
"RTN","PSAVIN",8,0)
 S PSALOC=$O(^PSD(58.8,"P",+PSAINV,0)) W:PSALOC !!,$$INVNAME^PRCPUX1(PSAINV)_" is linked to",!!,$P($G(^PSD(58.8,+PSALOC,0)),U),!!
"RTN","PSAVIN",9,0)
DEV ;asks device and queueing info
"RTN","PSAVIN",10,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" S PSAOUT=1 G QUIT
"RTN","PSAVIN",11,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSAVIN",ZTDESC="Inventory items link to DRUG FILE Report",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G QUIT
"RTN","PSAVIN",12,0)
START N %DT,DIR,DIRUT,PSALN,PSAD,PSAPG,PSAOUT,PSARPDT,X,Y S (PSAPG,PSAOUT)=0,Y=DT D DD^%DT S PSARPDT=Y
"RTN","PSAVIN",13,0)
 D HEADER
"RTN","PSAVIN",14,0)
LOOP F  S PSAIT=$O(^PRCP(445,PSAINV,1,PSAIT)) Q:'PSAIT  D:$Y+4>IOSL HEADER Q:PSAOUT  D
"RTN","PSAVIN",15,0)
 .W !!,PSAIT,?10,$E($$DESCR^PRCPUX1(PSAINV,PSAIT),1,33),?45,$E($S($P($G(^PSDRUG(+$O(^PSDRUG("AB",+PSAIT,0)),0)),U)]"":$P($G(^(0)),U),1:"NONE"),1,34)
"RTN","PSAVIN",16,0)
QUIT I $E(IOST)'="C" W @IOF
"RTN","PSAVIN",17,0)
 I $E(IOST,1,2)="C-",'$G(PSAOUT) W !! S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSAVIN",18,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAVIN",19,0)
 Q
"RTN","PSAVIN",20,0)
HEADER ;prints header info
"RTN","PSAVIN",21,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAVIN",22,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAVIN",23,0)
 W:$Y @IOF S $P(PSALN,"-",81)="",PSAPG=PSAPG+1 W !,$E($$INVNAME^PRCPUX1(PSAINV),1,23)_" Items' Link to DRUG file",?50,PSARPDT,?70,"PAGE: "_PSAPG,!,PSALN,!,"ITEM",?10,"DESCRIPTION",?45,"DRUG FILE LINK"
"RTN","PSAVIN",24,0)
 Q
"RTN","PSAVIN1")
0^110^B13547391
"RTN","PSAVIN1",1,0)
PSAVIN1 ;BIR/LTL-Physical Inventory Balance Review ;7/23/97
"RTN","PSAVIN1",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAVIN1",3,0)
 ;This routine reviews balances for a drug.
"RTN","PSAVIN1",4,0)
 ;
"RTN","PSAVIN1",5,0)
 N DIC,DIR,DTOUT,DUOUT,PSA,PSACNT,PSALOCN,PSAR,PSAU,PSAOUT,PSAT,X,Y S PSAOUT=1,PSAU=0
"RTN","PSAVIN1",6,0)
LOOK D ^PSADA I '$G(PSALOC) S PSAOUT=1 G END
"RTN","PSAVIN1",7,0)
 I '$O(^PSD(58.8,PSALOC,1,0)) W !!,"There are no drugs in ",PSALOCN G END
"RTN","PSAVIN1",8,0)
 W !!,"The balances displayed from a Primary Inventory Point are based on the most",!,"recent physical inventory and may NOT reflect accurate quantities when",!,"converted to the dispensing unit level."
"RTN","PSAVIN1",9,0)
 S PSACNT=0 W !!,"You may select one, several, or ^ALL drugs.",!
"RTN","PSAVIN1",10,0)
CHKD F  S DIC="^PSD(58.8,+PSALOC,1,",DIC(0)="AEMQ",DIC("A")="Please Select "_PSALOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('PSACNT) END Q:Y<0  S PSA(+Y)="",PSACNT=PSACNT+1
"RTN","PSAVIN1",11,0)
 I X="^ALL" F  S PSAU=$O(^PSD(58.8,+PSALOC,1,PSAU)) Q:'PSAU  S PSA(PSAU)=""
"RTN","PSAVIN1",12,0)
DEV ;asks device and queueing info
"RTN","PSAVIN1",13,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSAVIN1",14,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSAVIN1",ZTDESC="Drug balance review",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSAVIN1",15,0)
START ;compiles and prints output
"RTN","PSAVIN1",16,0)
 N %DT,PSALN,PSAR,PSAPG,PSARPDT S (PSAPG,PSAOUT)=0,Y=DT,PSAR="" X ^DD("DD") S PSARPDT=Y,PSAU(1)=$O(PSA(0)) D HEADER S PSAU=0
"RTN","PSAVIN1",17,0)
 F  S PSAU=$O(PSA(PSAU)) Q:'PSAU  D  Q:$G(PSAOUT)
"RTN","PSAVIN1",18,0)
LOOP .D:$Y+8>IOSL HEADER  Q:$G(PSAOUT)
"RTN","PSAVIN1",19,0)
 .I $G(PSAU(5))>1 W "Total of all Primary Inventory items: ",$G(PSAU(7)),!!
"RTN","PSAVIN1",20,0)
 .W !,$P($G(^PSDRUG(+PSAU,0)),U) K PSAU(5),PSAU(7)
"RTN","PSAVIN1",21,0)
 .W !!,$G(PSALOCN),"'s balance: ",$P($G(^PSD(58.8,+PSALOC,1,+PSAU,0)),U,4)," "
"RTN","PSAVIN1",22,0)
 .W $P($G(^PSDRUG(+PSAU,660)),U,8),!!
"RTN","PSAVIN1",23,0)
 .Q:'$O(^PSDRUG(+PSAU,441,0))
"RTN","PSAVIN1",24,0)
 .F PSAU(1)=0:0 S PSAU(1)=$O(^PSDRUG(+PSAU,441,PSAU(1))) Q:'PSAU(1)  D
"RTN","PSAVIN1",25,0)
 ..S PSAU(2)=$P($G(^PSDRUG(+PSAU,441,+PSAU(1),0)),U) Q:'PSAU(2)
"RTN","PSAVIN1",26,0)
 ..Q:'$O(^PRCP(445,"AE",+PSAU(2),0))
"RTN","PSAVIN1",27,0)
 ..F PSAU(3)=0:0 S PSAU(3)=$O(^PRCP(445,"AE",+PSAU(2),PSAU(3))) Q:'PSAU(3)  D:$O(^PSD(58.8,"P",PSAU(3),0))
"RTN","PSAVIN1",28,0)
 ...S PSAU(5)=$G(PSAU(5))+1
"RTN","PSAVIN1",29,0)
 ...W $$DESCR^PRCPUX1(PSAU(3),PSAU(2))
"RTN","PSAVIN1",30,0)
 ...W !!,$$INVNAME^PRCPUX1(PSAU(3)),"'s balance: "
"RTN","PSAVIN1",31,0)
 ...S PSAU(6)=$P($G(^PRCP(445,+PSAU(3),1,+PSAU(2),0)),U,7)*$S($P($G(^(0)),U,29):$P($G(^(0)),U,29),1:1) W PSAU(6)," ",$P($G(^(0)),U,28),!!
"RTN","PSAVIN1",32,0)
 ...S PSAU(7)=$G(PSAU(7))+PSAU(6)
"RTN","PSAVIN1",33,0)
 W:$G(PSAU(5))>1 "Total of all Primary Inventory items: ",$G(PSAU(7)),!!
"RTN","PSAVIN1",34,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSAVIN1",35,0)
 I $E(IOST,1,2)="C-",'PSAOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSAVIN1",36,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAVIN1",37,0)
 Q
"RTN","PSAVIN1",38,0)
HEADER ;prints header info
"RTN","PSAVIN1",39,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAVIN1",40,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAVIN1",41,0)
 W:$Y @IOF S $P(PSALN,"&",81)="",PSAPG=PSAPG+1 W !?2,"Physical Inventory Balance Review",?55,PSARPDT,?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAVIN1",42,0)
 Q
"RTN","PSAVIN2")
0^111^B12055488
"RTN","PSAVIN2",1,0)
PSAVIN2 ;BIR/LTL-Compares Prices (DA/GIP) ;7/23/97
"RTN","PSAVIN2",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAVIN2",3,0)
 ;This routine reviews prices for a drug.
"RTN","PSAVIN2",4,0)
 ;
"RTN","PSAVIN2",5,0)
 N DIC,DIR,DTOUT,DUOUT,PSA,PSACNT,PSALOCN,PSAR,PSAU,PSAOUT,PSAT,X,X2,X3,Y S PSAOUT=1,PSAU=0
"RTN","PSAVIN2",6,0)
LOOK D ^PSADA I '$G(PSALOC) S PSAOUT=1 G END
"RTN","PSAVIN2",7,0)
 I '$O(^PSD(58.8,PSALOC,1,0)) W !!,"There are no drugs in ",PSALOCN G END
"RTN","PSAVIN2",8,0)
 S PSACNT=0 W !!,"You may select one, several, or ^ALL drugs.",!
"RTN","PSAVIN2",9,0)
CHKD F  S DIC="^PSD(58.8,+PSALOC,1,",DIC(0)="AEMQ",DIC("A")="Please Select "_PSALOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('PSACNT) END Q:Y<0  S PSA(+Y)="",PSACNT=PSACNT+1
"RTN","PSAVIN2",10,0)
 I X="^ALL" F  S PSAU=$O(^PSD(58.8,+PSALOC,1,PSAU)) Q:'PSAU  S PSA(PSAU)=""
"RTN","PSAVIN2",11,0)
DEV ;asks device and queueing info
"RTN","PSAVIN2",12,0)
 K IO("Q") N %ZIS,IOP,POP S %ZIS="0Q" W ! D ^%ZIS I POP W !,"NO DEVICE SELECTED OR OUTPUT PRINTED!" Q
"RTN","PSAVIN2",13,0)
 I $D(IO("Q")) N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSAVIN2",ZTDESC="Drug price review",ZTSAVE("PSA*")="" D ^%ZTLOAD,HOME^%ZIS S PSAOUT=1 G END
"RTN","PSAVIN2",14,0)
START ;compiles and prints output
"RTN","PSAVIN2",15,0)
 N %DT,PSALN,PSAR,PSAPG,PSARPDT S (PSAPG,PSAOUT)=0,Y=DT,PSAR="" X ^DD("DD") S PSARPDT=Y,PSAU(1)=$O(PSA(0)) D HEADER S PSAU=0
"RTN","PSAVIN2",16,0)
 F  S PSAU=$O(PSA(PSAU)) Q:'PSAU  D  Q:$G(PSAOUT)
"RTN","PSAVIN2",17,0)
LOOP .D:$Y+8>IOSL HEADER  Q:$G(PSAOUT)
"RTN","PSAVIN2",18,0)
 .W !,$P($G(^PSDRUG(+PSAU,0)),U)
"RTN","PSAVIN2",19,0)
 .S PSAU(9)=$G(^PSDRUG(+PSAU,660))
"RTN","PSAVIN2",20,0)
 .W !!,"DRUG file prices: "
"RTN","PSAVIN2",21,0)
 .S X=$P(PSAU(9),U,3),X2="2$",X3=4 D COMMA^%DTC W X,"/"
"RTN","PSAVIN2",22,0)
 .S PSAU(8)=$P($G(^DIC(51.5,+$P(PSAU(9),U,2),0)),U)
"RTN","PSAVIN2",23,0)
 .W PSAU(8),"     (",$P(PSAU(9),U,5)," ",$P(PSAU(9),U,8),"/",PSAU(8)
"RTN","PSAVIN2",24,0)
 .S X=$P(PSAU(9),U,6),X2="3$",X3=4 D COMMA^%DTC
"RTN","PSAVIN2",25,0)
 .W ")     => ",X,"/",$P(PSAU(9),U,8),!!
"RTN","PSAVIN2",26,0)
 .Q:'$O(^PSDRUG(+PSAU,441,0))
"RTN","PSAVIN2",27,0)
 .F PSAU(1)=0:0 S PSAU(1)=$O(^PSDRUG(+PSAU,441,PSAU(1))) Q:'PSAU(1)  D
"RTN","PSAVIN2",28,0)
 ..S PSAU(2)=$P($G(^PSDRUG(+PSAU,441,+PSAU(1),0)),U) Q:'PSAU(2)
"RTN","PSAVIN2",29,0)
 ..Q:'$O(^PRCP(445,"AE",+PSAU(2),0))
"RTN","PSAVIN2",30,0)
 ..F PSAU(3)=0:0 S PSAU(3)=$O(^PRCP(445,"AE",+PSAU(2),PSAU(3))) Q:'PSAU(3)  D:$O(^PSD(58.8,"P",PSAU(3),0))
"RTN","PSAVIN2",31,0)
 ...S PSAU(5)=$G(PSAU(5))+1
"RTN","PSAVIN2",32,0)
 ...W $$DESCR^PRCPUX1(PSAU(3),PSAU(2))
"RTN","PSAVIN2",33,0)
 ...W !!,$$INVNAME^PRCPUX1(PSAU(3)),"'s prices: "
"RTN","PSAVIN2",34,0)
 ...S PSAU(6)=$G(^PRCP(445,+PSAU(3),1,+PSAU(2),0))
"RTN","PSAVIN2",35,0)
 ...S X=$P(PSAU(6),U,15),X2="2$",X3=4 D COMMA^%DTC W X,"/"
"RTN","PSAVIN2",36,0)
 ...S PSAU(11)=$$UNITCODE^PRCPUX1($P(PSAU(6),U,5))
"RTN","PSAVIN2",37,0)
 ...W PSAU(11),"     (",$P(PSAU(6),U,29)
"RTN","PSAVIN2",38,0)
 ...W " ",$P(PSAU(6),U,28),"/",PSAU(11),")"
"RTN","PSAVIN2",39,0)
 ...S X=($P(PSAU(6),U,15)/($S(($P(PSAU(6),U,29)>0):$P(PSAU(6),U,29),1:1)))
"RTN","PSAVIN2",40,0)
 ...S X2="3$",X3=4 D COMMA^%DTC W "  => ",X,"/",$P(PSAU(6),U,28),!!
"RTN","PSAVIN2",41,0)
END W:$E(IOST)'="C" @IOF
"RTN","PSAVIN2",42,0)
 I $E(IOST,1,2)="C-",'PSAOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR
"RTN","PSAVIN2",43,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAVIN2",44,0)
 Q
"RTN","PSAVIN2",45,0)
HEADER ;prints header info
"RTN","PSAVIN2",46,0)
 I $E(IOST,1,2)'="P-",PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAVIN2",47,0)
 I $$S^%ZTLOAD W !!,"Task #",$G(ZTSK),", ",$G(ZTDESC)," was stopped by ",$P($G(^VA(200,+$G(DUZ),0)),U),"." S PSAOUT=1 Q
"RTN","PSAVIN2",48,0)
 W:$Y @IOF S $P(PSALN,"&",81)="",PSAPG=PSAPG+1 W !?2,"DRUG File/Inventory Price Review",?55,PSARPDT,?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAVIN2",49,0)
 Q
"RTN","PSAVINC")
0^112^B10279199
"RTN","PSAVINC",1,0)
PSAVINC ;BIR/LTL-Update Prices ;7/23/97
"RTN","PSAVINC",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAVINC",3,0)
 ;This routine updates prices for a drug.
"RTN","PSAVINC",4,0)
 ;
"RTN","PSAVINC",5,0)
 N DA,DIC,DIR,DR,DTOUT,DUOUT,PSA,PSACNT,PSALOC,PSALOCN,PSAOUT,PSAR,PSARPDT,PSAT,PSAU,X,X2,X3,Y S PSAOUT=1,PSAU=0
"RTN","PSAVINC",6,0)
LOOK D ^PSADA I '$G(PSALOC) S PSAOUT=1 G END
"RTN","PSAVINC",7,0)
 I '$O(^PSD(58.8,PSALOC,1,0)) W !!,"There are no drugs in ",PSALOCN G END
"RTN","PSAVINC",8,0)
 S PSACNT=0 W !!,"You may select one, several, or ^ALL drugs.",!
"RTN","PSAVINC",9,0)
CHKD F  S DIC="^PSD(58.8,+PSALOC,1,",DIC(0)="AEMQ",DIC("A")="Please Select "_PSALOCN_"'s Drug: ",DIC("S")="I $S($G(^(""I"")):$G(^(""I""))>DT,1:1)" W ! D ^DIC K DIC G:X'="^ALL"&(Y<1)&('PSACNT) END Q:Y<0  S PSA(+Y)="",PSACNT=PSACNT+1
"RTN","PSAVINC",10,0)
 I X="^ALL" F  S PSAU=$O(^PSD(58.8,+PSALOC,1,PSAU)) Q:'PSAU  S PSA(PSAU)=""
"RTN","PSAVINC",11,0)
START ;begin
"RTN","PSAVINC",12,0)
 N %DT,PSALN,PSAR,PSAPG,PSARPDT S (PSAPG,PSAOUT)=0,Y=DT,PSAR="" X ^DD("DD") S PSARPDT=Y,PSAU(1)=$O(PSA(0)) D HEADER S PSAU=0
"RTN","PSAVINC",13,0)
 F  S PSAU=$O(PSA(PSAU)) Q:'PSAU  D  Q:$G(PSAOUT)
"RTN","PSAVINC",14,0)
LOOP .D:$Y+8>IOSL HEADER  Q:$G(PSAOUT)
"RTN","PSAVINC",15,0)
 .W !,$P($G(^PSDRUG(+PSAU,0)),U)
"RTN","PSAVINC",16,0)
 .S PSAU(9)=$G(^PSDRUG(+PSAU,660))
"RTN","PSAVINC",17,0)
 .W !!,"DRUG file prices: "
"RTN","PSAVINC",18,0)
 .S X=$P(PSAU(9),U,3),X2="2$",X3=4 D COMMA^%DTC W X,"/"
"RTN","PSAVINC",19,0)
 .S PSAU(8)=$P($G(^DIC(51.5,+$P(PSAU(9),U,2),0)),U)
"RTN","PSAVINC",20,0)
 .W PSAU(8),"     (",$P(PSAU(9),U,5)," ",$P(PSAU(9),U,8),"/",PSAU(8)
"RTN","PSAVINC",21,0)
 .S X=$P(PSAU(9),U,6),X2="3$",X3=4 D COMMA^%DTC
"RTN","PSAVINC",22,0)
 .W ")     => ",X,"/",$P(PSAU(9),U,8),!!
"RTN","PSAVINC",23,0)
 .G:'$O(^PSDRUG(+PSAU,441,0)) PRI
"RTN","PSAVINC",24,0)
 .F PSAU(1)=0:0 S PSAU(1)=$O(^PSDRUG(+PSAU,441,PSAU(1))) Q:'PSAU(1)  D
"RTN","PSAVINC",25,0)
 ..S PSAU(2)=$P($G(^PSDRUG(+PSAU,441,+PSAU(1),0)),U) Q:'PSAU(2)
"RTN","PSAVINC",26,0)
 ..Q:'$O(^PRCP(445,"AE",+PSAU(2),0))
"RTN","PSAVINC",27,0)
 ..F PSAU(3)=0:0 S PSAU(3)=$O(^PRCP(445,"AE",+PSAU(2),PSAU(3))) Q:'PSAU(3)  D:$O(^PSD(58.8,"P",PSAU(3),0))
"RTN","PSAVINC",28,0)
 ...S PSAU(5)=$G(PSAU(5))+1
"RTN","PSAVINC",29,0)
 ...W $$DESCR^PRCPUX1(PSAU(3),PSAU(2))
"RTN","PSAVINC",30,0)
 ...W !!,$$INVNAME^PRCPUX1(PSAU(3)),"'s prices: "
"RTN","PSAVINC",31,0)
 ...S PSAU(6)=$G(^PRCP(445,+PSAU(3),1,+PSAU(2),0))
"RTN","PSAVINC",32,0)
 ...S X=$P(PSAU(6),U,15),X2="2$",X3=4 D COMMA^%DTC W X,"/"
"RTN","PSAVINC",33,0)
 ...S PSAU(11)=$$UNITCODE^PRCPUX1($P(PSAU(6),U,5))
"RTN","PSAVINC",34,0)
 ...W PSAU(11),"     (",$P(PSAU(6),U,29)
"RTN","PSAVINC",35,0)
 ...W " ",$P(PSAU(6),U,28),"/",PSAU(11),")"
"RTN","PSAVINC",36,0)
 ...S X=($P(PSAU(6),U,15)/($S(($P(PSAU(6),U,29)>0):$P(PSAU(6),U,29),1:1)))
"RTN","PSAVINC",37,0)
 ...S X2="3$",X3=4 D COMMA^%DTC W "  => ",X,"/",$P(PSAU(6),U,28),!!
"RTN","PSAVINC",38,0)
PRI .S DIE="^PSDRUG(",DA=PSAU,DR="13DRUG file Price per Order Unit: "
"RTN","PSAVINC",39,0)
 .D ^DIE K DIE W !! I $D(Y) S PSAOUT=1 Q
"RTN","PSAVINC",40,0)
 .I $P($G(^PSDRUG(+PSAU,660)),U,3)'=$P(PSAU(9),U,3) W "New price per ",$P(PSAU(9),U,8)," => ",$P($G(^(660)),U,6),!!
"RTN","PSAVINC",41,0)
END I 'PSAOUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu." D ^DIR K DIR
"RTN","PSAVINC",42,0)
 Q
"RTN","PSAVINC",43,0)
HEADER ;prints header info
"RTN","PSAVINC",44,0)
 I PSAPG S DIR(0)="E" D ^DIR K DIR I 'Y S PSAOUT=1 Q
"RTN","PSAVINC",45,0)
 W:$Y @IOF S $P(PSALN,"&",81)="",PSAPG=PSAPG+1 W !?2,"DRUG File Price Update",?55,PSARPDT,?70,"PAGE: ",PSAPG,!,PSALN,!
"RTN","PSAVINC",46,0)
 Q
"RTN","PSAWARD")
0^113^B20802300
"RTN","PSAWARD",1,0)
PSAWARD ;BIR/LTL,JMB-Set Up/Edit a Pharmacy Location ;7/23/97
"RTN","PSAWARD",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;; 10/24/97
"RTN","PSAWARD",3,0)
 ;This routine links wards to the pharmacy location.
"RTN","PSAWARD",4,0)
 ;
"RTN","PSAWARD",5,0)
 N DIC,DIE,D0,D1,DLAYGO,DR,DIR,DIRUT,DTOUT,DUOUT,DA,PSAW,PSADR,X,Y,PSAOUT
"RTN","PSAWARD",6,0)
 W @IOF,!?5,"For the purpose of collecting Unit Dose and IV dispensing data,",!,"any ward at which such dispensing might ever occur should be added."
"RTN","PSAWARD",7,0)
 W !,"The ONLY reason to NOT add a ward would be if the dispensing at that ward",!,"should NOT update ",$G(PSALOCN),"."
"RTN","PSAWARD",8,0)
 W !!,"There is NO harm in adding inactive wards."
"RTN","PSAWARD",9,0)
 I '$D(^PSD(58.8,+PSALOC,3,0)) S ^(0)="^58.842P^^"
"RTN","PSAWARD",10,0)
ALL I $G(PSA(2))=1 S PSA(3)=0,DIC="^PSD(58.8,+PSALOC,3,",DA(1)=PSALOC,DIC(0)="LNX" W !!,PSALOCN," is linked to " F  S (DA,DINUM,X,PSA(3))=$O(^DIC(42,PSA(3))) Q:'PSA(3)  K DD,DO D:'$G(^PSD(58.8,+PSALOC,3,+PSA(3),0)) FILE^DICN D
"RTN","PSAWARD",11,0)
 .W $P($G(^DIC(42,+PSA(3),0)),U) W:$O(^DIC(42,PSA(3))) ", "
"RTN","PSAWARD",12,0)
 .I '$O(^DIC(42,PSA(3))) W ".",!
"RTN","PSAWARD",13,0)
 .W:$X+10>IOM !!
"RTN","PSAWARD",14,0)
 K DINUM
"RTN","PSAWARD",15,0)
 G:$G(PSA(2))=1 QUIT
"RTN","PSAWARD",16,0)
MUL I $O(^PSD(58.8,+PSALOC,3,0)) D  G:$G(PSAOUT) QUIT
"RTN","PSAWARD",17,0)
 .S PSA(3)=0
"RTN","PSAWARD",18,0)
 .W !!,"The following wards are currently connected to ",PSALOCN,":",!!
"RTN","PSAWARD",19,0)
 .F  S PSA(3)=$O(^PSD(58.8,+PSALOC,3,+PSA(3))) Q:'PSA(3)  W:$X+10>IOM !! W $P($G(^DIC(42,+PSA(3),0)),U),$S($O(^PSD(58.8,+PSALOC,3,+PSA(3))):", ",1:".")
"RTN","PSAWARD",20,0)
 .S DIR(0)="Y",DIR("A")="Do you wish to change this",DIR("B")="No",DIR("?")="Any dispensing to these wards by the UD or IV modules will update this location"
"RTN","PSAWARD",21,0)
 .W ! D ^DIR K DIR I Y'=1 S PSAOUT=1 Q
"RTN","PSAWARD",22,0)
 .S DIR(0)="SBOA^A:ADD;D:DELETE",DIR("A")="Do you wish to ADD or DELETE WARDS?  (A/D): "
"RTN","PSAWARD",23,0)
 .S DIR("?",1)="Enter 'A' to ADD a Ward, 'D' to DELETE a Ward"
"RTN","PSAWARD",24,0)
 .S DIR("?")="or '^' to quit" D ^DIR K DIR S PSAOUT(1)=Y I $D(DIRUT) S PSAOUT=1 Q
"RTN","PSAWARD",25,0)
 .I Y="D" S DIC="^PSD(58.8,+PSALOC,3,",DIC(0)="AEMQ",DA(1)=PSALOC,DIC("A")="Select "_$G(PSALOCN)_" WARD: " F  D ^DIC Q:Y<0!(Y="")  S PSAW=+Y,PSAW(1)=$P($G(^DIC(42,+PSAW,0)),U) D  I $D(DIRUT) S PSAOUT=1 Q
"RTN","PSAWARD",26,0)
 ..S DIR(0)="Y",DIR("A")="OK to delete "_$G(PSAW(1))
"RTN","PSAWARD",27,0)
 ..S DIR("B")="No",DIR("?")="If yes, I'll remove it from "_$G(PSALOCN)
"RTN","PSAWARD",28,0)
 ..D ^DIR I Y'=1 S PSAOUT=1 Q
"RTN","PSAWARD",29,0)
 ..S DIK=DIC,DA(1)=PSALOC,DA=PSAW D ^DIK W !,$G(PSAW(1))," deleted."
"RTN","PSAWARD",30,0)
 .K DIC,DIK,DA,PSAW S:PSAOUT(1)'="A" PSAOUT=1
"RTN","PSAWARD",31,0)
 S DIR(0)="SBOA^A:ALL;R:RANGE",DIR("A")="Do you wish to add ALL wards or select a RANGE of wards?  (A/R): "
"RTN","PSAWARD",32,0)
 S DIR("?",1)="Enter 'A' to add ALL wards, 'R' to select a range"
"RTN","PSAWARD",33,0)
 S DIR("?")="or '^' to quit" D ^DIR K DIR I $D(DIRUT) S PSAOUT=1 Q
"RTN","PSAWARD",34,0)
 I Y="A" S PSA(2)=1 G ALL
"RTN","PSAWARD",35,0)
 S PSAW=0,(PSA,PSA(3))=1,PSA(2)=20
"RTN","PSAWARD",36,0)
LOOP F PSA=PSA:1:PSA(2) S PSAW=$O(^DIC(42,PSAW)) Q:'PSAW  S PSA=PSA-1 I '$O(^PSD(58.8,"AB",+PSAW,0)) S PSA=PSA+1 W !,PSA,?10,$P($G(^DIC(42,PSAW,0)),U) S PSADR(PSA)=PSAW W:$D(^DIC(42,+PSAW,"I")) ?40,"***INACTIVE***"
"RTN","PSAWARD",37,0)
 I PSA=1 W !!,"Sorry, you've already added all the wards that you can." G QUIT
"RTN","PSAWARD",38,0)
 S:$O(PSADR(PSA)) PSA=$O(PSADR(PSA))
"RTN","PSAWARD",39,0)
 I $G(PSAW) F PSAW(1)=PSAW:0 S PSAW(1)=$O(^DIC(42,PSAW(1))) Q:'PSAW(1)!($G(PSAW(2))>19)  I '$O(^PSD(58.8,"AB",+PSAW(1),0)) S PSAW(2)=$G(PSAW(2))+1
"RTN","PSAWARD",40,0)
 I $G(PSA)'>$G(PSA(3)) G QUIT
"RTN","PSAWARD",41,0)
 S PSA(2)=$G(PSA(2))+$G(PSAW(2))
"RTN","PSAWARD",42,0)
 S DIR("?")="You can only select wards that are not yet linked to a location"
"RTN","PSAWARD",43,0)
 S DIR(0)="LA^"_PSA(3)_":"_$S($O(PSADR((PSA-1))):PSA,1:PSA-1),DIR("A",1)="Select the ward(s) or range of wards from which you want "_PSALOCN,DIR("A")="to collect dispensing data: " D ^DIR K DIR G:$D(DIRUT) QUIT S PSAC=Y
"RTN","PSAWARD",44,0)
 S DIC="^PSD(58.8,"_+PSALOC_",3,",DIC(0)="LNX",DA(1)=PSALOC
"RTN","PSAWARD",45,0)
 F PSAB=1:1:PSA I $P($G(PSAC),",",PSAB) K DD,DO S (DA,DINUM,X)=$G(PSADR($P(PSAC,",",PSAB))) D FILE^DICN W "." K DINUM,PSA(1) Q:$G(PSAOUT)
"RTN","PSAWARD",46,0)
 K PSAB I $G(PSAW(2)) W @IOF S (PSA,PSA(3))=$G(PSA)+1 G LOOP
"RTN","PSAWARD",47,0)
 K DIC,PSA,PSADR G MUL
"RTN","PSAWARD",48,0)
QUIT I '$D(DIRUT) W ! S DIE="^PS(59.7,",DA=$O(^PS(59.7,0)),DR="72Inpatient Dispensing Update?" D ^DIE K DIE,DA S:$D(Y) PSAOUT=1
"RTN","PSAWARD",49,0)
 Q
"SEC","^DIC",58.8,58.8,0,"AUDIT")
@
"SEC","^DIC",58.8,58.8,0,"DD")
@
"SEC","^DIC",58.8,58.8,0,"DEL")
@
"SEC","^DIC",58.8,58.8,0,"LAYGO")
@
"SEC","^DIC",58.8,58.8,0,"RD")
@
"SEC","^DIC",58.8,58.8,0,"WR")
@
"SEC","^DIC",58.81,58.81,0,"AUDIT")
@
"SEC","^DIC",58.81,58.81,0,"DD")
@
"SEC","^DIC",58.81,58.81,0,"DEL")
@
"SEC","^DIC",58.81,58.81,0,"LAYGO")
@
"SEC","^DIC",58.81,58.81,0,"RD")
@
"SEC","^DIC",58.81,58.81,0,"WR")
@
"SEC","^DIC",58.811,58.811,0,"AUDIT")
@
"SEC","^DIC",58.811,58.811,0,"DD")
@
"SEC","^DIC",58.811,58.811,0,"DEL")
@
"SEC","^DIC",58.811,58.811,0,"LAYGO")
@
"SEC","^DIC",58.811,58.811,0,"RD")
@
"SEC","^DIC",58.811,58.811,0,"WR")
@
"SEC","^DIC",58.84,58.84,0,"AUDIT")
@
"SEC","^DIC",58.84,58.84,0,"DD")
@
"SEC","^DIC",58.84,58.84,0,"DEL")
@
"SEC","^DIC",58.84,58.84,0,"LAYGO")
@
"SEC","^DIC",58.84,58.84,0,"RD")
@
"SEC","^DIC",58.84,58.84,0,"WR")
@
"VER")
8.0^21.0
"^DD",58.8,58.8,0)
FIELD^^35^35
"^DD",58.8,58.8,0,"DDA")
N
"^DD",58.8,58.8,0,"DT")
2970630
"^DD",58.8,58.8,0,"ID","WRITE")
I $D(^("I")),^("I")]"",^("I")'>DT D EN^DDIOL($C(7)_"**INACTIVE**")
"^DD",58.8,58.8,0,"IX","AB",58.842,.01)

"^DD",58.8,58.8,0,"IX","AC",58.800118,10)

"^DD",58.8,58.8,0,"IX","AD",58.800118,14)

"^DD",58.8,58.8,0,"IX","ADISP",58.8,1)

"^DD",58.8,58.8,0,"IX","AEXP",58.8001,11)

"^DD",58.8,58.8,0,"IX","AEXPO",58.800118,9)

"^DD",58.8,58.8,0,"IX","AIV",58.831,.01)

"^DD",58.8,58.8,0,"IX","AOP",58.8,20)

"^DD",58.8,58.8,0,"IX","ASITE",58.8,2)

"^DD",58.8,58.8,0,"IX","ASITE1",58.8,1)

"^DD",58.8,58.8,0,"IX","B",58.8,.01)

"^DD",58.8,58.8,0,"IX","C",58.8001,.01)

"^DD",58.8,58.8,0,"IX","D",58.800115,.01)

"^DD",58.8,58.8,0,"IX","E",58.8,11)

"^DD",58.8,58.8,0,"IX","F",58.800118,16)

"^DD",58.8,58.8,0,"IX","P",58.8445,.01)

"^DD",58.8,58.8,0,"NM","DRUG ACCOUNTABILITY STATS")

"^DD",58.8,58.8,0,"PT",58.29,.01)

"^DD",58.8,58.8,0,"PT",58.8,3)

"^DD",58.8,58.8,0,"PT",58.800118,2)

"^DD",58.8,58.8,0,"PT",58.81,2)

"^DD",58.8,58.8,0,"PT",58.81,17)

"^DD",58.8,58.8,0,"PT",58.81,66)

"^DD",58.8,58.8,0,"PT",58.8112,4)

"^DD",58.8,58.8,0,"PT",58.8112,13)

"^DD",58.8,58.8,0,"PT",58.85,1)

"^DD",58.8,58.8,0,"PT",58.85,2)

"^DD",58.8,58.8,0,"PT",58.86,6)

"^DD",58.8,58.8,0,"PT",58.87,5)

"^DD",58.8,58.8,0,"PT",58.87,12)

"^DD",58.8,58.8,0,"PT",58.89,6)

"^DD",58.8,58.8,0,"VRPK")
DRUG ACCOUNTABILITY
"^DD",58.8,58.8,.01,0)
PHARMACY LOCATION^RF^^0;1^K:$L(X)>30!($L(X)<2)!'(X'?1P.E) X
"^DD",58.8,58.8,.01,.1)
NAOU
"^DD",58.8,58.8,.01,1,0)
^.1
"^DD",58.8,58.8,.01,1,1,0)
58.8^B
"^DD",58.8,58.8,.01,1,1,1)
S ^PSD(58.8,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.8,.01,1,1,2)
K ^PSD(58.8,"B",$E(X,1,30),DA)
"^DD",58.8,58.8,.01,3)
Answer must be 2-30 characters in length.
"^DD",58.8,58.8,.01,21,0)
^^4^4^2921106^^^^
"^DD",58.8,58.8,.01,21,1,0)
This field contains the name of the Pharmacy location.
"^DD",58.8,58.8,.01,21,2,0)
   
"^DD",58.8,58.8,.01,21,3,0)
The Controlled Substances module will recognize this location as the
"^DD",58.8,58.8,.01,21,4,0)
Narcotic Area of Use (NAOU) throughout this package.
"^DD",58.8,58.8,.01,23,0)
^^1^1^2920504^^^^
"^DD",58.8,58.8,.01,23,1,0)
Free text name of this Pharmacy location.  Not to exceed 30 characters.
"^DD",58.8,58.8,.01,"DEL",.01,0)
I 1 W !,?5,"DO NOT DELETE.  Use the Inactivate NAOU option. "
"^DD",58.8,58.8,.01,"DT")
2920305
"^DD",58.8,58.8,1,0)
LOCATION TYPE^RSX^M:MASTER VAULT;S:SATELLITE VAULT;N:NARCOTIC LOCATION;P:PRIMARY;^0;2^K X W $C(7),!,?10," ** No Editing ** ",!
"^DD",58.8,58.8,1,.1)
Location Type
"^DD",58.8,58.8,1,1,0)
^.1
"^DD",58.8,58.8,1,1,1,0)
58.8^ADISP
"^DD",58.8,58.8,1,1,1,1)
S ^PSD(58.8,"ADISP",$E(X,1,30),DA)=""
"^DD",58.8,58.8,1,1,1,2)
K ^PSD(58.8,"ADISP",$E(X,1,30),DA)
"^DD",58.8,58.8,1,1,1,"DT")
2920530
"^DD",58.8,58.8,1,1,2,0)
58.8^ASITE1^MUMPS
"^DD",58.8,58.8,1,1,2,1)
D SASITE1^PSDUTL
"^DD",58.8,58.8,1,1,2,2)
D KASITE1^PSDUTL
"^DD",58.8,58.8,1,1,2,3)
DO NOT DELETE
"^DD",58.8,58.8,1,1,2,"%D",0)
^^3^3^2920912^^^
"^DD",58.8,58.8,1,1,2,"%D",1,0)
This cross-reference is used in determining site for all Controlled
"^DD",58.8,58.8,1,1,2,"%D",2,0)
Substances applications.
"^DD",58.8,58.8,1,1,2,"%D",3,0)
The cross-reference is ^PSD(58.8,"ASITE",INPATIENT SITE,LOC TYPE,DA)="".
"^DD",58.8,58.8,1,1,2,"DT")
2920606
"^DD",58.8,58.8,1,3)
Enter the location type.
"^DD",58.8,58.8,1,21,0)
^^10^10^2970729^
"^DD",58.8,58.8,1,21,1,0)
This field contains the location type for this pharmacy location.
"^DD",58.8,58.8,1,21,2,0)
Location types are "M" for master vault, "S" for satellite vault, "N" for
"^DD",58.8,58.8,1,21,3,0)
narcotic location, and "P" for primary.
"^DD",58.8,58.8,1,21,4,0)
  
"^DD",58.8,58.8,1,21,5,0)
This field should NOT be edited directly using VA FileMan.  The Drug
"^DD",58.8,58.8,1,21,6,0)
Accountability and Controlled Substances modules depend on the accuracy
"^DD",58.8,58.8,1,21,7,0)
of this data.
"^DD",58.8,58.8,1,21,8,0)
 
"^DD",58.8,58.8,1,21,9,0)
The Controlled Substances module supports "M", "S" and "N" location types.
"^DD",58.8,58.8,1,21,10,0)
For CS use, enter the master vault locations first. 
"^DD",58.8,58.8,1,23,0)
^^1^1^2970729^^^
"^DD",58.8,58.8,1,23,1,0)
Set of codes.  Do NOT edit directly using VA FileMan.
"^DD",58.8,58.8,1,"DT")
2931021
"^DD",58.8,58.8,2,0)
INPATIENT SITE^R*P59.4'^PS(59.4,^0;3^S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",31)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.8,2,.1)
CS SITE
"^DD",58.8,58.8,2,1,0)
^.1
"^DD",58.8,58.8,2,1,1,0)
58.8^ASITE^MUMPS
"^DD",58.8,58.8,2,1,1,1)
D SASITE^PSDUTL
"^DD",58.8,58.8,2,1,1,2)
D KASITE^PSDUTL
"^DD",58.8,58.8,2,1,1,3)
DO NOT DELETE
"^DD",58.8,58.8,2,1,1,"%D",0)
^^4^4^2940923^^^^
"^DD",58.8,58.8,2,1,1,"%D",1,0)
This cross-reference is used in distinguishing multi-divisional
"^DD",58.8,58.8,2,1,1,"%D",2,0)
sites.  The Controlled Substances software uses this cross-reference
"^DD",58.8,58.8,2,1,1,"%D",3,0)
in all ordering, dispensing, and reporting activity.
"^DD",58.8,58.8,2,1,1,"%D",4,0)
The cross-reference is ^PSD(58.8,"ASITE",INPATIENT SITE,LOC TYPE,DA)="".
"^DD",58.8,58.8,2,1,1,"DT")
2920606
"^DD",58.8,58.8,2,3)
Enter inpatient site.
"^DD",58.8,58.8,2,12)
Select only sites that are "Selectable for CS" in File 59.4.
"^DD",58.8,58.8,2,12.1)
S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",31)"
"^DD",58.8,58.8,2,21,0)
^^2^2^2940923^^^^
"^DD",58.8,58.8,2,21,1,0)
This field contains a pointer to the inpatient site.  This is a required
"^DD",58.8,58.8,2,21,2,0)
data element within the Controlled Substances module.
"^DD",58.8,58.8,2,23,0)
^^1^1^2940923^^^^
"^DD",58.8,58.8,2,23,1,0)
Screened pointer to File 59.4 - INPATIENT SITE file.  Required for CS use.
"^DD",58.8,58.8,2,"DT")
2920609
"^DD",58.8,58.8,3,0)
PRIMARY DISPENSING SITE^*P58.8'^PSD(58.8,^0;4^S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,+Y'=DA,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.8,3,.1)
Primary Dispensing Site
"^DD",58.8,58.8,3,3)
Answer must be the name of an existing Master or Satellite vault.
"^DD",58.8,58.8,3,12)
Selection limited to Master or Satellite vault.
"^DD",58.8,58.8,3,12.1)
S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,+Y'=DA,$S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"^DD",58.8,58.8,3,21,0)
^^3^3^2970729^
"^DD",58.8,58.8,3,21,1,0)
This field contains a pointer to the primary dispensing site for this
"^DD",58.8,58.8,3,21,2,0)
pharmacy location.  This data is utilized within the Controlled Substances
"^DD",58.8,58.8,3,21,3,0)
module.
"^DD",58.8,58.8,3,23,0)
^^2^2^2970729^^^^
"^DD",58.8,58.8,3,23,1,0)
Screened pointer to File 58.8 - DRUG ACCOUNTABILITY STATS file.
"^DD",58.8,58.8,3,23,2,0)
Selection limited to Master vault or Satellite vault.
"^DD",58.8,58.8,3,"DT")
2920821
"^DD",58.8,58.8,4,0)
INACTIVE DATE^D^^I;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8,4,.1)
Inactive Date
"^DD",58.8,58.8,4,3)
Enter the date when this pharmacy location became inactive.
"^DD",58.8,58.8,4,21,0)
^^1^1^2970729^^
"^DD",58.8,58.8,4,21,1,0)
The date on which this pharmacy location was inactivated.
"^DD",58.8,58.8,4,23,0)
^^1^1^2970729^
"^DD",58.8,58.8,4,23,1,0)
Inactive date for this pharmacy location.
"^DD",58.8,58.8,4,"DT")
2920106
"^DD",58.8,58.8,5,0)
ASK MFG/LOT #/EXP.DATE?^S^1:YES;0:NO;^0;5^Q
"^DD",58.8,58.8,5,.1)
Ask Mfg/Lot #/Exp.Date?
"^DD",58.8,58.8,5,3)
Enter "1" or "Y" if you wish to be prompted for mfg., lot #, and exp. date.
"^DD",58.8,58.8,5,21,0)
^^7^7^2940923^^^^
"^DD",58.8,58.8,5,21,1,0)
The answer for asking manufacturer, lot #, and expiration date on drugs
"^DD",58.8,58.8,5,21,2,0)
tracked within this Pharmacy location .  If this field is set to "1" or
"^DD",58.8,58.8,5,21,3,0)
"YES", manufacturer, lot number, and expiration date will be asked when
"^DD",58.8,58.8,5,21,4,0)
dispensing drugs within this Pharmacy location.
"^DD",58.8,58.8,5,21,5,0)
  
"^DD",58.8,58.8,5,21,6,0)
For Controlled Substances use, this field should be answered for Master
"^DD",58.8,58.8,5,21,7,0)
vaults and Satellite vaults.
"^DD",58.8,58.8,5,23,0)
^^1^1^2940923^^^^
"^DD",58.8,58.8,5,23,1,0)
Set of codes - "1" for "YES" or "0" for "NO".
"^DD",58.8,58.8,5,"DT")
2920106
"^DD",58.8,58.8,6,0)
IS THIS PHARM WORKING STOCK?^S^1:YES;0:NO;^0;7^Q
"^DD",58.8,58.8,6,.1)
Is this a Pharmacy NAOU for Working Stock?
"^DD",58.8,58.8,6,3)
Enter "1" or "Y" if this is a Pharmacy NAOU for working stock.
"^DD",58.8,58.8,6,21,0)
^^3^3^2940923^^^^
"^DD",58.8,58.8,6,21,1,0)
Pharmacy location designated as a Narcotic Area of Use for pharmacy working
"^DD",58.8,58.8,6,21,2,0)
stock. If this field is set to "1" or "YES" drug data will be utilized
"^DD",58.8,58.8,6,21,3,0)
differently within the Controlled Substances module.
"^DD",58.8,58.8,6,23,0)
^^1^1^2940923^^^
"^DD",58.8,58.8,6,23,1,0)
Set of codes - "1" for "YES" or "0" for "NO".
"^DD",58.8,58.8,6,"DT")
2920505
"^DD",58.8,58.8,10,0)
DRUG^58.8001IP^^1;0
"^DD",58.8,58.8,10,21,0)
^^8^8^2970729^
"^DD",58.8,58.8,10,21,1,0)
Drug is defined by physical location, stock level, balance on-hand,
"^DD",58.8,58.8,10,21,2,0)
reorder level, quantity to reorder, breakdown unit, package size,
"^DD",58.8,58.8,10,21,3,0)
manufacturer, lot number, and expiration date.  Other information available
"^DD",58.8,58.8,10,21,4,0)
is inventory types, ward (for drug), and prime vendor item number
"^DD",58.8,58.8,10,21,5,0)
(if applicable).
"^DD",58.8,58.8,10,21,6,0)
  
"^DD",58.8,58.8,10,21,7,0)
In the Controlled Substances module, all CS order requests are stored
"^DD",58.8,58.8,10,21,8,0)
in the ORDERS multiple within DRUG.
"^DD",58.8,58.8,11,0)
*PRIMARY INVENTORY POINT^*P445'X^PRCP(445,^0;6^S DATABASE=1,DIC("S")="I $P(^(0),U,3)=""P""&($P(^(0),U,7)=822400)" D ^DIC K DIC S DIC=DIE,X=+Y D ^PSAUTL K DATABASE K:Y<0 X
"^DD",58.8,58.8,11,.1)
*Primary Inventory Point
"^DD",58.8,58.8,11,1,0)
^.1
"^DD",58.8,58.8,11,1,1,0)
58.8^E
"^DD",58.8,58.8,11,1,1,1)
S ^PSD(58.8,"E",$E(X,1,30),DA)=""
"^DD",58.8,58.8,11,1,1,2)
K ^PSD(58.8,"E",$E(X,1,30),DA)
"^DD",58.8,58.8,11,1,1,"%D",0)
^^1^1^2940915^^
"^DD",58.8,58.8,11,1,1,"%D",1,0)
To identify Pharmacy location linked to an Inventory Point.
"^DD",58.8,58.8,11,1,1,"DT")
2930309
"^DD",58.8,58.8,11,3)
For Controlled Substances enter the name of the pharmacy inventory point which contains ONLY the controlled substances stored in this pharmacy master vault.
"^DD",58.8,58.8,11,12)
You can only select a Primary Inventory Point with a Cost Center of 822400.
"^DD",58.8,58.8,11,12.1)
S DIC("S")="I $P(^(0),U,3)=""P""&($P(^(0),U,7)=822400)"
"^DD",58.8,58.8,11,21,0)
^^3^3^2970729^
"^DD",58.8,58.8,11,21,1,0)
To provide a direct link between a pharmacy inventory point and a pharmacy
"^DD",58.8,58.8,11,21,2,0)
location entry in this file.  Receiving that occurs in the inventory point
"^DD",58.8,58.8,11,21,3,0)
will update on hand quantities in the pharmacy location.
"^DD",58.8,58.8,11,23,0)
^^2^2^2970729^^^^
"^DD",58.8,58.8,11,23,1,0)
To provide a direct link between the GENERIC INVENTORY file (#445) and the 
"^DD",58.8,58.8,11,23,2,0)
DRUG ACCOUNTABILITY STATS file (#58.8).
"^DD",58.8,58.8,11,"DT")
2970729
"^DD",58.8,58.8,11.5,0)
*RECEIPT FAILURE NOTIFICATION?^S^1:YES;0:NO;^0;11^Q
"^DD",58.8,58.8,11.5,3)
Enter "1" or "Y" to notify the RECEIPT FAILURE mail group of items that could not be received.
"^DD",58.8,58.8,11.5,21,0)
^^7^7^2940923^^^
"^DD",58.8,58.8,11.5,21,1,0)
If a Drug Accountability location is linked to a Primary Inventory Point
"^DD",58.8,58.8,11.5,21,2,0)
the items received into the Primary Inventory Point will also be updated in
"^DD",58.8,58.8,11.5,21,3,0)
the Drug Accountability location.  If items are received into the linked
"^DD",58.8,58.8,11.5,21,4,0)
Primary Inventory that are not connected to the DRUG file (#50) or not
"^DD",58.8,58.8,11.5,21,5,0)
stocked in the Drug Accountability location, and this field is set to
"^DD",58.8,58.8,11.5,21,6,0)
"YES", the RECEIPT FAILURE mail group will be notified with a list
"^DD",58.8,58.8,11.5,21,7,0)
of the items.
"^DD",58.8,58.8,11.5,23,0)
^^1^1^2940915^^
"^DD",58.8,58.8,11.5,23,1,0)
Set of codes - "1" for "YES" or "0" for "NO".
"^DD",58.8,58.8,11.5,"DT")
2930319
"^DD",58.8,58.8,12,0)
PRIME VENDOR?^S^1:YES;0:NO;^0;8^Q
"^DD",58.8,58.8,12,.1)
Prime Vendor?
"^DD",58.8,58.8,12,3)
Enter "1" or "Y" for "YES". Enter "0" or "N" for "NO".
"^DD",58.8,58.8,12,21,0)
^^5^5^2970923^^^
"^DD",58.8,58.8,12,21,1,0)
To more efficiently process prime vendor receipts, setting this flag to
"^DD",58.8,58.8,12,21,2,0)
"YES" will allow you to store an obligation number.  This number will then
"^DD",58.8,58.8,12,21,3,0)
be offered as a default whenever using the Receive Directly into Drug
"^DD",58.8,58.8,12,21,4,0)
Accountability [PSA RECEIVING] option on the Receipts Menu [PSA RECEIPTS
"^DD",58.8,58.8,12,21,5,0)
MENU] menu.
"^DD",58.8,58.8,12,23,0)
^^2^2^2970923^^
"^DD",58.8,58.8,12,23,1,0)
Directs the flow of receipt processing and checks for a 1358 obligation
"^DD",58.8,58.8,12,23,2,0)
number stored in the CURRENT PRIME VENDOR PO# field (#13).
"^DD",58.8,58.8,12,"DT")
2970729
"^DD",58.8,58.8,13,0)
CURRENT PRIME VENDOR PO#^*P442'^PRC(442,^0;9^S DIC("S")="I $P($G(^(0)),U,5)[822400" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.8,13,.1)
Current Prime Vendor PO#
"^DD",58.8,58.8,13,3)
Enter the 1358 obligation number for the current month.
"^DD",58.8,58.8,13,12)
You can only select P.O.#s with a 822400 cost center.
"^DD",58.8,58.8,13,12.1)
S DIC("S")="I $P($G(^(0)),U,5)[822400"
"^DD",58.8,58.8,13,21,0)
^^1^1^2970729^
"^DD",58.8,58.8,13,21,1,0)
This entry will be used as a default when receiving from the prime vendor.
"^DD",58.8,58.8,13,23,0)
^^1^1^2970729^
"^DD",58.8,58.8,13,23,1,0)
Default value for prime vendor receiving.
"^DD",58.8,58.8,13,"DT")
2970729
"^DD",58.8,58.8,14,0)
AUTO GENERATE DISPENSING #'S?^S^1:YES;0:NO;^2;1^Q
"^DD",58.8,58.8,14,3)
Answer "YES" to automatically generate the pharmacy dispensing # for CS orders.
"^DD",58.8,58.8,14,21,0)
^^5^5^2941027^^^^
"^DD",58.8,58.8,14,21,1,0)
The pharmacy dispensing number (Green Sheet #) will be automatically
"^DD",58.8,58.8,14,21,2,0)
generated when dispensing Controlled Substances orders if this field is
"^DD",58.8,58.8,14,21,3,0)
set to "1" or "YES".  If left blank, or if "0", or "NO" are entered the
"^DD",58.8,58.8,14,21,4,0)
pharmacy employee processing the Controlled Substances order will have
"^DD",58.8,58.8,14,21,5,0)
to enter the dispensing number (Green Sheet #).
"^DD",58.8,58.8,14,"DT")
2920606
"^DD",58.8,58.8,15,0)
LOW DISPENSING #^NJ9,0X^^2;2^K:'$D(PSDJLP) X W:'$D(X) " NO EDITING" Q:'$D(X)  K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X D LOW^PSDSITE K:$D(PSDFLAG) X K PSD,PSDFLAG,PSDL
"^DD",58.8,58.8,15,3)
Enter the lowest CS dispensing # for this dispensing site (1 to 999999999).
"^DD",58.8,58.8,15,21,0)
^^2^2^2940915^^
"^DD",58.8,58.8,15,21,1,0)
The lowest CS pharmacy dispensing number for this dispensing site.  The
"^DD",58.8,58.8,15,21,2,0)
system will not allow numbers smaller than the one you choose.
"^DD",58.8,58.8,15,"DT")
2921123
"^DD",58.8,58.8,16,0)
HIGH DISPENSING #^NJ9,0X^^2;3^K:'$D(PSDJLP) X W:'$D(X) " NO EDITING" Q:'$D(X)  K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X D HIGH^PSDSITE K:$D(PSDFLAG) X K PSD,PSDFLAG,PSDH,PSDL
"^DD",58.8,58.8,16,3)
Enter the largest CS dispensing number for this dispensing site (1-999999999).
"^DD",58.8,58.8,16,21,0)
^^4^4^2920915^^^
"^DD",58.8,58.8,16,21,1,0)
The largest acceptable pharmacy dispensing number for this dispensing
"^DD",58.8,58.8,16,21,2,0)
site.  The difference between this number and the lowest pharmacy
"^DD",58.8,58.8,16,21,3,0)
dispensing number should be substantial.  The system will not allow
"^DD",58.8,58.8,16,21,4,0)
numbers larger than the one you choose.
"^DD",58.8,58.8,16,"DT")
2921123
"^DD",58.8,58.8,17,0)
LAST DISPENSING #^NJ9,0X^^2;4^K:'$D(PSDJLP) X W:'$D(X) " NO EDITING" Q:'$D(X)  K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X D LAST^PSDSITE K:$D(PSDFLAG) X K PSDFLAG
"^DD",58.8,58.8,17,3)
Enter the last CS dispensing number used for this dispensing site (1 to 999999999).
"^DD",58.8,58.8,17,21,0)
^^4^4^2940915^^^^
"^DD",58.8,58.8,17,21,1,0)
The last CS pharmacy dispensing number used.  This number will
"^DD",58.8,58.8,17,21,2,0)
start at the lowest pharmacy dispensing number, increment it by
"^DD",58.8,58.8,17,21,3,0)
one until it finds a number that has not been used, and then use
"^DD",58.8,58.8,17,21,4,0)
that number for the next Controlled Substances order.
"^DD",58.8,58.8,17,"DT")
2921123
"^DD",58.8,58.8,18,0)
USING PERPETUAL INVENTORY?^S^1:YES;0:NO;^2;5^Q
"^DD",58.8,58.8,18,.1)
Using Perpetual Inventory?
"^DD",58.8,58.8,18,3)
Answer "YES" if this site is using the perpetual inventory method.
"^DD",58.8,58.8,18,21,0)
^^15^15^2970923^
"^DD",58.8,58.8,18,21,1,0)
This flag is used to determine if this NAOU is using the Controlled
"^DD",58.8,58.8,18,21,2,0)
Substances perpetual inventory functionality.
"^DD",58.8,58.8,18,21,3,0)
 
"^DD",58.8,58.8,18,21,4,0)
If this field is set to "YES" or "1" the standard Controlled Substance
"^DD",58.8,58.8,18,21,5,0)
Administration Record VA FORM 10-2638 (Green Sheet) WILL NOT be printed
"^DD",58.8,58.8,18,21,6,0)
and will be replaced by the perpetual inventory method of tracking CS
"^DD",58.8,58.8,18,21,7,0)
drugs.
"^DD",58.8,58.8,18,21,8,0)
 
"^DD",58.8,58.8,18,21,9,0)
For an NAOU that is using a perpetual inventory, the MAXIMUM
"^DD",58.8,58.8,18,21,10,0)
QUANTITY PER ORDER field (#8.5) for a drug in the dispensing site will
"^DD",58.8,58.8,18,21,11,0)
limit the maximum quantity that Nursing Service may enter for any single
"^DD",58.8,58.8,18,21,12,0)
order for that drug.  If the MAXIMUM QUANTITY PER ORDER is left blank,
"^DD",58.8,58.8,18,21,13,0)
deleted, or set to zero, Nursing Service will be able to enter any
"^DD",58.8,58.8,18,21,14,0)
quantity that is a multiple of package size, up to 999999, for any single 
"^DD",58.8,58.8,18,21,15,0)
order of that drug.
"^DD",58.8,58.8,18,"DT")
2970922
"^DD",58.8,58.8,19,0)
PRINT GREEN SHEET^S^1:YES;0:NO;^2;6^Q
"^DD",58.8,58.8,19,3)
Enter "YES" to print the Green Sheet after process only, "NO" to print after RPh verification.
"^DD",58.8,58.8,19,21,0)
^^6^6^2940915^^^
"^DD",58.8,58.8,19,21,1,0)
This is a flag used to determine the sequence in which a Controlled
"^DD",58.8,58.8,19,21,2,0)
Substance Administration Record VA FORM 10-2638 (Green Sheet) will
"^DD",58.8,58.8,19,21,3,0)
be printed.  If set to "YES" or "1" the "Green Sheet" will print
"^DD",58.8,58.8,19,21,4,0)
after the order has been processed and prior to a RPh verification.
"^DD",58.8,58.8,19,21,5,0)
If set to "NO" or "0" the "Green Sheet" will print after a RPh has
"^DD",58.8,58.8,19,21,6,0)
verified the filled order.
"^DD",58.8,58.8,19,"DT")
2920606
"^DD",58.8,58.8,19.5,0)
GREEN SHEET STOCK^S^1:GPO 1992 PRINTING;0:OTHER GPO PRINTING;^2.5;1^Q
"^DD",58.8,58.8,19.5,3)
Enter 1 for GPO 1992 printed stock.
"^DD",58.8,58.8,19.5,21,0)
^^4^4^2940915^^^
"^DD",58.8,58.8,19.5,21,1,0)
The VA FORM 10-2638 (Green Sheet) stock was printed on 8 x 10 1/2 paper.
"^DD",58.8,58.8,19.5,21,2,0)
In 1992, the paper size changed to 8 1/2 x 11.  This field is used as a
"^DD",58.8,58.8,19.5,21,3,0)
site parameter when printing the Green Sheet forms.  Additional spacing
"^DD",58.8,58.8,19.5,21,4,0)
is required for the GPO 1992 printed stock.
"^DD",58.8,58.8,19.5,"DT")
2930526
"^DD",58.8,58.8,20,0)
OUTPATIENT SITE^P59'X^PS(59,^0;10^I $D(X) S Z=$O(^PSD(58.8,"AOP",+X,0)) S:Z=DA Z=$O(^(DA)) W:$G(Z) $C(7),!,$P($G(^PSD(58.8,+$O(^PSD(58.8,"AOP",+X,0)),0)),U)," is already linked to ",$P($G(^PS(59,+X,0)),U) K:$G(Z) X,Z
"^DD",58.8,58.8,20,.1)
Outpatient Site
"^DD",58.8,58.8,20,1,0)
^.1
"^DD",58.8,58.8,20,1,1,0)
58.8^AOP
"^DD",58.8,58.8,20,1,1,1)
S ^PSD(58.8,"AOP",$E(X,1,30),DA)=""
"^DD",58.8,58.8,20,1,1,2)
K ^PSD(58.8,"AOP",$E(X,1,30),DA)
"^DD",58.8,58.8,20,1,1,"%D",0)
^^1^1^2940915^^
"^DD",58.8,58.8,20,1,1,"%D",1,0)
To be used for automated updating of total dispensed when Rx is filled.
"^DD",58.8,58.8,20,1,1,"DT")
2920701
"^DD",58.8,58.8,20,3)
Enter the Outpatient Site from which to gather prescription dispensing data.
"^DD",58.8,58.8,20,21,0)
^^2^2^2970729^^
"^DD",58.8,58.8,20,21,1,0)
When prescriptions are filled the corresponding drug for this Outpatient
"^DD",58.8,58.8,20,21,2,0)
Site will be updated for monthly total dispensed.
"^DD",58.8,58.8,20,23,0)
^^1^1^2970729^^^
"^DD",58.8,58.8,20,23,1,0)
To be used for automated updating of total dispensed when Rx is filled.
"^DD",58.8,58.8,20,"DT")
2970729
"^DD",58.8,58.8,21,0)
WARD^58.842P^^3;0
"^DD",58.8,58.8,21,21,0)
^^2^2^2950801^^^
"^DD",58.8,58.8,21,21,1,0)
When Unit Dose and IV dispensing data is compiled, it will affect 
"^DD",58.8,58.8,21,21,2,0)
the Drug Accountability Location to which a ward is linked.
"^DD",58.8,58.8,21,23,0)
^^1^1^2950801^^^
"^DD",58.8,58.8,21,23,1,0)
For UD/IV dispensing to be subtracted from the appropriate DA location.
"^DD",58.8,58.8,22,0)
PRIMARY INVENTORY POINT(S)^58.8445P^^4;0
"^DD",58.8,58.8,22,12)
Must be Special Inventory Point Type "D" for Drug Accountability.
"^DD",58.8,58.8,22,12.1)
S DIC("S")="I $P(^(0),U,20)=""D"""
"^DD",58.8,58.8,22,21,0)
^^3^3^2970729^
"^DD",58.8,58.8,22,21,1,0)
To provide a direct link between a pharmacy inventory point and a pharmacy
"^DD",58.8,58.8,22,21,2,0)
location entry in this file.  Receiving that occurs in the inventory point
"^DD",58.8,58.8,22,21,3,0)
will update on hand quantities in the pharmacy location.
"^DD",58.8,58.8,22,23,0)
^^2^2^2970729^^^^
"^DD",58.8,58.8,22,23,1,0)
To provide a direct link between the GENERIC INVENTORY file (#445)
"^DD",58.8,58.8,22,23,2,0)
and the DRUG ACCOUNTABILITY STATS file (#58.8).
"^DD",58.8,58.8,23,0)
DISPENSING WORKSHEET SORT^S^D:DRUG/NAOU;N:NAOU/DRUG;S:SELECT AT PRINTING;^2;7^Q
"^DD",58.8,58.8,23,3)
Enter the sort order to be used in creating the dispensing worksheet.
"^DD",58.8,58.8,23,21,0)
^^4^4^2940929^^^^
"^DD",58.8,58.8,23,21,1,0)
This field determines the sort order when printing the Controlled
"^DD",58.8,58.8,23,21,2,0)
Substances "Pharmacy Dispensing Worksheet".  The sort order may be defined
"^DD",58.8,58.8,23,21,3,0)
by drug then NAOU, by NAOU then drug, or selected when printing
"^DD",58.8,58.8,23,21,4,0)
the worksheet.
"^DD",58.8,58.8,23,23,0)
^^2^2^2940915^^^
"^DD",58.8,58.8,23,23,1,0)
Set of codes used in determining the sort order when printing the "Pharmacy
"^DD",58.8,58.8,23,23,2,0)
Dispensing Worksheet".
"^DD",58.8,58.8,23,"DT")
2930426
"^DD",58.8,58.8,24,0)
DEFAULT GREEN SHEET PRINTER^P3.5'^%ZIS(1,^2;8^Q
"^DD",58.8,58.8,24,3)
Enter the name of the device selected to print Green Sheets.
"^DD",58.8,58.8,24,21,0)
^^2^2^2930427^^
"^DD",58.8,58.8,24,21,1,0)
A pointer to the name of the device selected as the default printer
"^DD",58.8,58.8,24,21,2,0)
for Green Sheets.
"^DD",58.8,58.8,24,23,0)
^^1^1^2940915^^
"^DD",58.8,58.8,24,23,1,0)
Pointer to File 3.5 - the DEVICE file.
"^DD",58.8,58.8,24,"DT")
2930426
"^DD",58.8,58.8,25,0)
DEFAULT REPORT PRINTER^P3.5'^%ZIS(1,^2;9^Q
"^DD",58.8,58.8,25,3)
Enter the name of the device selected to print CS reports.
"^DD",58.8,58.8,25,21,0)
^^2^2^2941027^^^
"^DD",58.8,58.8,25,21,1,0)
A pointer to the name of the device selected as the default printer for
"^DD",58.8,58.8,25,21,2,0)
various Controlled Substances reports.
"^DD",58.8,58.8,25,23,0)
^^1^1^2940915^^^
"^DD",58.8,58.8,25,23,1,0)
Pointer to File 3.5 - the DEVICE file.
"^DD",58.8,58.8,25,"DT")
2930426
"^DD",58.8,58.8,26,0)
DEFAULT LABEL PRINTER^P3.5'^%ZIS(1,^2;10^Q
"^DD",58.8,58.8,26,3)
Enter the name of the device selected to print CS labels.
"^DD",58.8,58.8,26,21,0)
^^2^2^2930427^
"^DD",58.8,58.8,26,21,1,0)
A pointer to the name of the device selected as the default printer
"^DD",58.8,58.8,26,21,2,0)
for Controlled Substances labels.
"^DD",58.8,58.8,26,23,0)
^^1^1^2940915^^
"^DD",58.8,58.8,26,23,1,0)
Pointer to File 3.5 - the DEVICE file.
"^DD",58.8,58.8,26,"DT")
2930426
"^DD",58.8,58.8,27,0)
LAST UD UPDATE^D^^0;12^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8,27,.1)
Last UD Update
"^DD",58.8,58.8,27,3)
The last date that dispensing from the UNIT DOSE PICK LIST STATS file (#57.6) was collected to update this location.
"^DD",58.8,58.8,27,21,0)
^^3^3^2970729^
"^DD",58.8,58.8,27,21,1,0)
When the UD dispensing data is collected from the UNIT DOSE PICK LIST STATS
"^DD",58.8,58.8,27,21,2,0)
file (#57.6) a date is stored here.  Each time unit dose dispensing data
"^DD",58.8,58.8,27,21,3,0)
is collected, it begins FROM this date.
"^DD",58.8,58.8,27,23,0)
^^2^2^2970729^^^^
"^DD",58.8,58.8,27,23,1,0)
Used and stored by the PSAUDP routine for the collection of dispensing data
"^DD",58.8,58.8,27,23,2,0)
from the UNIT DOSE PICK LIST STATS file (#57.6).
"^DD",58.8,58.8,27,"DT")
2970729
"^DD",58.8,58.8,28,0)
ORDER ENTRY BANNER^58.828^^5;0
"^DD",58.8,58.8,28,21,0)
^^3^3^2950130^^^
"^DD",58.8,58.8,28,21,1,0)
A banner to be displayed for Nursing Order Entry, Pharmacy Order Entry
"^DD",58.8,58.8,28,21,2,0)
from Nursing, and Infusion Order Entry.  This banner may be edited via
"^DD",58.8,58.8,28,21,3,0)
the option, Create/Edit the Narcotic Area of Use.
"^DD",58.8,58.8,28,23,0)
^^1^1^2950130^^^
"^DD",58.8,58.8,28,23,1,0)
A banner to be displayed for Order Entry.
"^DD",58.8,58.8,29,0)
EMERGENCY ORDER PRINTER^P3.5'^%ZIS(1,^2;11^Q
"^DD",58.8,58.8,29,3)
Select a device for this dispensing vault which can receive notice of emergency orders submitted by nursing personnel.
"^DD",58.8,58.8,29,21,0)
^^4^4^2950130^
"^DD",58.8,58.8,29,21,1,0)
This device will be used to print a notice of emergency orders submitted
"^DD",58.8,58.8,29,21,2,0)
by nursing personnel.  The printer designated to receive these messages
"^DD",58.8,58.8,29,21,3,0)
SHOULD NOT be the printer which prints green sheets or controlled
"^DD",58.8,58.8,29,21,4,0)
substances labels.
"^DD",58.8,58.8,29,23,0)
^^1^1^2950130^
"^DD",58.8,58.8,29,23,1,0)
This field is a pointer to the DEVICE file (#3.5).
"^DD",58.8,58.8,29,"DT")
2950130
"^DD",58.8,58.8,30,0)
ALLOW ONE-TIME REQUESTS?^S^1:YES;0:NO;^0;13^Q
"^DD",58.8,58.8,30,3)
Enter "1" or "Y" to allow NAOUs to place one-time requests.
"^DD",58.8,58.8,30,21,0)
^^5^5^2950801^^
"^DD",58.8,58.8,30,21,1,0)
     If the primary dispensing site for an NAOU allows one-time requests,
"^DD",58.8,58.8,30,21,2,0)
any active drug in that dispensing site may be ordered, even though it may
"^DD",58.8,58.8,30,21,3,0)
be inactive or not stocked by that NAOU.  Certain drugs within a dispensing
"^DD",58.8,58.8,30,21,4,0)
site may be marked as not selectable and are unavailable for even one-time
"^DD",58.8,58.8,30,21,5,0)
requests.
"^DD",58.8,58.8,30,23,0)
^^1^1^2950801^^
"^DD",58.8,58.8,30,23,1,0)
Checked by order entry routines (PSDOR*) before allowing one-time requests.
"^DD",58.8,58.8,30,"DT")
2950731
"^DD",58.8,58.8,31,0)
IV ROOM^58.831P^^3.5;0
"^DD",58.8,58.8,31,21,0)
^^4^4^2970729^^
"^DD",58.8,58.8,31,21,1,0)
The IV Room multiple contains the Outpatient Clinic's IV rooms to which the 
"^DD",58.8,58.8,31,21,2,0)
Outpatient Pharmacy dispenses IVs. When IV dispensing data is compiled, it 
"^DD",58.8,58.8,31,21,3,0)
will affect the Drug Accountability outpatient pharmacy location to which 
"^DD",58.8,58.8,31,21,4,0)
the IV Room is linked.
"^DD",58.8,58.8,31,23,0)
^^1^1^2970729^^
"^DD",58.8,58.8,31,23,1,0)
This field points to the IV ROOM FILE (#59.5).
"^DD",58.8,58.8,32,0)
ADJUSTMENT MAIL GROUP^P3.8'^XMB(3.8,^6;1^Q
"^DD",58.8,58.8,32,3)
Enter the mail group that should receive messages when adjustments occur.
"^DD",58.8,58.8,32,21,0)
^^2^2^2961007^
"^DD",58.8,58.8,32,21,1,0)
The persons in this mail group will receive messages whenever an adjustment
"^DD",58.8,58.8,32,21,2,0)
or count correction occurs for this Narcotic Area of Use (NAOU).
"^DD",58.8,58.8,32,"DT")
2961007
"^DD",58.8,58.8,33,0)
TIME LIMIT FOR DELAYED DOSES^NJ5,2^^6;2^K:+X'=X!(X>12)!(X<0)!(X?.E1"."3N.N) X
"^DD",58.8,58.8,33,3)
Type a Number between 0 and 12, 2 Decimal Digits
"^DD",58.8,58.8,33,21,0)
^^4^4^2961007^
"^DD",58.8,58.8,33,21,1,0)
This is the time limit for Nursing to record a delayed wastage
"^DD",58.8,58.8,33,21,2,0)
or return to stock for a dose that was not administered to a patient.
"^DD",58.8,58.8,33,21,3,0)
If a "1" is entered, Nurses will have one hour to record the
"^DD",58.8,58.8,33,21,4,0)
disposition of a dose for this Narcotic Area of Use.
"^DD",58.8,58.8,33,"DT")
2961007
"^DD",58.8,58.8,34,0)
MAINTAIN REORDER LEVELS?^S^1:YES;0:NO;^0;14^Q
"^DD",58.8,58.8,34,.1)
Maintain Reorder Levels?
"^DD",58.8,58.8,34,3)
Enter YES if the reorder level is to entered for each drug in the pharmacy location or master vault.
"^DD",58.8,58.8,34,21,0)
^^2^2^2970729^^^^
"^DD",58.8,58.8,34,21,1,0)
The MAINTAIN REORDER LEVELS? field denotes if the drugs in the pharmacy
"^DD",58.8,58.8,34,21,2,0)
location or master vault are to maintain their reorder levels.
"^DD",58.8,58.8,34,"DT")
2970131
"^DD",58.8,58.8,35,0)
DAYS TO KEEP INVOICE DATA^NJ4,0^^0;15^K:+X'=X!(X>9999)!(X<120)!(X?.E1"."1N.N) X
"^DD",58.8,58.8,35,.1)
Days to Keep Invoice Data
"^DD",58.8,58.8,35,3)
Enter the number of days to keep the invoices in the DA ORDERS file.  Enter 120 to 9999 days.
"^DD",58.8,58.8,35,21,0)
^^4^4^2970729^^^
"^DD",58.8,58.8,35,21,1,0)
The DAYS TO KEEP INVOICE DATA field contains the number of days invoices
"^DD",58.8,58.8,35,21,2,0)
are to remain in the DRUG ACCOUNTABILITY ORDERS (#58.811) file. A nightly
"^DD",58.8,58.8,35,21,3,0)
job checks this field to determine if the invoice data should be deleted.
"^DD",58.8,58.8,35,21,4,0)
Invoice data must remain in the file at least 120 days.
"^DD",58.8,58.8,35,"DT")
2970519
"^DD",58.8,58.8001,0)
DRUG SUB-FIELD^^29^38
"^DD",58.8,58.8001,0,"DT")
2970630
"^DD",58.8,58.8001,0,"IX","AC",58.8001,13)

"^DD",58.8,58.8001,0,"IX","B",58.8001,.01)

"^DD",58.8,58.8001,0,"IX","C",58.8001,12)

"^DD",58.8,58.8001,0,"NM","DRUG")

"^DD",58.8,58.8001,0,"UP")
58.8
"^DD",58.8,58.8001,.01,0)
DRUG^MR*P50'X^PSDRUG(^0;1^S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" S:$D(PSDSITE) DIC("S")=DIC("S")_",$S($P($G(^(2)),""^"",3)[""N"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X S:$D(X) DINUM=X
"^DD",58.8,58.8001,.01,.1)
CS Drug
"^DD",58.8,58.8001,.01,1,0)
^.1
"^DD",58.8,58.8001,.01,1,1,0)
58.8001^B
"^DD",58.8,58.8001,.01,1,1,1)
S ^PSD(58.8,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.8001,.01,1,1,2)
K ^PSD(58.8,DA(1),1,"B",$E(X,1,30),DA)
"^DD",58.8,58.8001,.01,1,1,"DT")
2920220
"^DD",58.8,58.8001,.01,1,2,0)
58.8^C
"^DD",58.8,58.8001,.01,1,2,1)
S ^PSD(58.8,"C",$E(X,1,30),DA(1),DA)=""
"^DD",58.8,58.8001,.01,1,2,2)
K ^PSD(58.8,"C",$E(X,1,30),DA(1),DA)
"^DD",58.8,58.8001,.01,1,2,3)
DO NOT DELETE
"^DD",58.8,58.8001,.01,1,2,"%D",0)
^^2^2^2920912^^^
"^DD",58.8,58.8001,.01,1,2,"%D",1,0)
This cross-reference will be used for various reports within the
"^DD",58.8,58.8001,.01,1,2,"%D",2,0)
Drug Accountability and Controlled Substances modules.
"^DD",58.8,58.8001,.01,1,2,"DT")
2920330
"^DD",58.8,58.8001,.01,3)
Enter the name of the drug being stocked in this pharmacy location.
"^DD",58.8,58.8001,.01,4)

"^DD",58.8,58.8001,.01,12)
For CS locations, select only ACTIVE drugs marked for CS package use.
"^DD",58.8,58.8001,.01,12.1)
S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" S:$D(PSDSITE) DIC("S")=DIC("S")_",$S($P($G(^(2)),""^"",3)[""N"":1,1:0)"
"^DD",58.8,58.8001,.01,21,0)
^^2^2^2970729^
"^DD",58.8,58.8001,.01,21,1,0)
This field contains a pointer to the drug being stocked in this pharmacy
"^DD",58.8,58.8001,.01,21,2,0)
location.
"^DD",58.8,58.8001,.01,23,0)
^^5^5^2970729^^^^
"^DD",58.8,58.8001,.01,23,1,0)
Within the Controlled Substances module, select only ACTIVE drugs marked
"^DD",58.8,58.8001,.01,23,2,0)
for use in the CS package.   Do not select INACTIVE or NON-PHARMACY drugs.
"^DD",58.8,58.8001,.01,23,3,0)
This field should not be edited directly using VA FileMan.  The appropriate
"^DD",58.8,58.8001,.01,23,4,0)
screen for selecting ACTIVE drugs marked for CS use is contained within
"^DD",58.8,58.8001,.01,23,5,0)
the package functionality.  DINUMed pointer to File 50 - DRUG file.
"^DD",58.8,58.8001,.01,"DEL",.01,0)
I 1 W !,?5,"DO NOT DELETE.  For CS locations, use the Inactivate Stocked CS Drug option. "
"^DD",58.8,58.8001,.01,"DT")
2920330
"^DD",58.8,58.8001,1,0)
LOCATION^F^^0;2^K:$L(X)>12!($L(X)<1) X
"^DD",58.8,58.8001,1,.1)
Location
"^DD",58.8,58.8001,1,3)
Answer must be 1-12 characters in length.
"^DD",58.8,58.8001,1,21,0)
^^4^4^2970729^
"^DD",58.8,58.8001,1,21,1,0)
This is the location address of the drug in the pharmacy location.  It
"^DD",58.8,58.8001,1,21,2,0)
can consist of up to 3 levels, each separated by a comma.  For example,
"^DD",58.8,58.8001,1,21,3,0)
"MR,CA,S3" or "CUR,CB,D1".  This information is used to sort drugs on
"^DD",58.8,58.8001,1,21,4,0)
inventory sheets and other printouts.
"^DD",58.8,58.8001,1,23,0)
^^3^3^2970729^^^^
"^DD",58.8,58.8001,1,23,1,0)
Location address of this drug.  It can consist of up to 3 levels
"^DD",58.8,58.8001,1,23,2,0)
of locations defined in File 58.17 - AOU ITEM LOCATION file.
"^DD",58.8,58.8001,1,23,3,0)
Not to exceed 12 characters.
"^DD",58.8,58.8001,1,"DT")
2910904
"^DD",58.8,58.8001,2,0)
STOCK LEVEL^NJ6,0^^0;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.8,58.8001,2,.1)
Stock Level
"^DD",58.8,58.8001,2,3)
Enter the ideal number of dispense units to keep on the shelf.
"^DD",58.8,58.8001,2,21,0)
^^2^2^2970729^
"^DD",58.8,58.8001,2,21,1,0)
This field contains the quantity that is the required stock level for 
"^DD",58.8,58.8001,2,21,2,0)
the drug in this pharmacy location. It is recorded in dispense units.
"^DD",58.8,58.8001,2,"DT")
2920324
"^DD",58.8,58.8001,3,0)
BALANCE^NJ9,2^^0;4^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.8001,3,.1)
Balance
"^DD",58.8,58.8001,3,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.8,58.8001,3,21,0)
^^1^1^2970729^^^^
"^DD",58.8,58.8001,3,21,1,0)
This field contains the current balance (quantity) of this stocked drug.
"^DD",58.8,58.8001,3,"DT")
2930428
"^DD",58.8,58.8001,4,0)
REORDER LEVEL^NJ6,0^^0;5^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.8,58.8001,4,.1)
Reorder Level
"^DD",58.8,58.8001,4,3)
Enter the minimum number of dispense units you want to have in the pharmacy location.
"^DD",58.8,58.8001,4,21,0)
^^2^2^2970408^^^
"^DD",58.8,58.8001,4,21,1,0)
This field contains the on-hand level that must be reached before a drug
"^DD",58.8,58.8001,4,21,2,0)
will have replacements dispensed. It is recorded in dispense units.
"^DD",58.8,58.8001,4,"DT")
2920324
"^DD",58.8,58.8001,5,0)
QUANTITY TO REORDER^NJ6,0^^0;6^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.8,58.8001,5,.1)
Quantity to Reorder
"^DD",58.8,58.8001,5,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.8,58.8001,5,21,0)
^^1^1^2920624^^
"^DD",58.8,58.8001,5,21,1,0)
This field contains the quantity to reorder for this stocked drug.
"^DD",58.8,58.8001,5,"DT")
2920324
"^DD",58.8,58.8001,6,0)
DA CONVERSION #^CJ8,0^^ ; ^X ^DD(58.8001,6,9.2) S D0=$P(Y(58.8001,6,1),U,1) S:'$D(^PSDRUG(+D0,0)) D0=-1 S Y(58.8001,6,101)=$S($D(^PSDRUG(D0,660)):^(660),1:"") S X=$P(Y(58.8001,6,101),U,5) S D0=Y(58.8001,6,80) S D1=Y(58.8001,6,81)
"^DD",58.8,58.8001,6,.1)
Drug Accountability Conversion #
"^DD",58.8,58.8001,6,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.8,58.8001,6,9)
^
"^DD",58.8,58.8001,6,9.01)
50^15;58.8001^.01
"^DD",58.8,58.8001,6,9.1)
DRUG:DISPENSE UNITS PER ORDER UNIT
"^DD",58.8,58.8001,6,9.2)
S Y(58.8001,6,81)=$S($D(D1):D1,1:""),Y(58.8001,6,80)=$S($D(D0):D0,1:""),Y(58.8001,6,1)=$S($D(^PSD(58.8,D0,1,D1,0)):^(0),1:"")
"^DD",58.8,58.8001,6,21,0)
^^3^3^2970729^^^^
"^DD",58.8,58.8001,6,21,1,0)
This field is computed by the value in the corresponding drug field,
"^DD",58.8,58.8001,6,21,2,0)
dispensing units per order unit and used to convert receipts.
"^DD",58.8,58.8001,6,21,3,0)
 
"^DD",58.8,58.8001,6,"DT")
2920422
"^DD",58.8,58.8001,7,0)
BREAKDOWN UNIT^F^^0;8^K:$L(X)>10!($L(X)<1)!'(X?1A.A) X
"^DD",58.8,58.8001,7,.1)
Breakdown Unit
"^DD",58.8,58.8001,7,3)
Enter dispensing unit, i.e., PACK, BOTTLE, EACH.  Not to exceed 10 characters.
"^DD",58.8,58.8001,7,21,0)
^^6^6^2921123^^^^
"^DD",58.8,58.8001,7,21,1,0)
This unit represents the pharmacy dispensing unit.
"^DD",58.8,58.8001,7,21,2,0)
Examples: BOX, EACH, BOTTLE, etc.
"^DD",58.8,58.8001,7,21,3,0)
   
"^DD",58.8,58.8001,7,21,4,0)
In the Controlled Substances module this is referred to as the "Narcotic
"^DD",58.8,58.8001,7,21,5,0)
Breakdown Unit" and will be displayed during order entry.  This information
"^DD",58.8,58.8001,7,21,6,0)
is required for order entry.
"^DD",58.8,58.8001,7,23,0)
^^3^3^2921123^^^^
"^DD",58.8,58.8001,7,23,1,0)
The breakdown unit name is free text not to exceed 10 characters.
"^DD",58.8,58.8001,7,23,2,0)
In the Controlled Substances module this unit is required for order
"^DD",58.8,58.8001,7,23,3,0)
entry.
"^DD",58.8,58.8001,7,"DT")
2920330
"^DD",58.8,58.8001,8,0)
PACKAGE SIZE^NJ6,0^^0;9^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.8,58.8001,8,.1)
Package Size
"^DD",58.8,58.8001,8,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.8,58.8001,8,21,0)
^^5^5^2941027^^^^
"^DD",58.8,58.8001,8,21,1,0)
This is the number of units dispensed from pharmacy.
"^DD",58.8,58.8001,8,21,2,0)
  
"^DD",58.8,58.8001,8,21,3,0)
In the Controlled Substances module, this is referred to as the "Narcotic
"^DD",58.8,58.8001,8,21,4,0)
Package Size" and will be displayed during order entry.  This information
"^DD",58.8,58.8001,8,21,5,0)
is required for order entry.
"^DD",58.8,58.8001,8,23,0)
^^1^1^2920912^^^
"^DD",58.8,58.8001,8,23,1,0)
In the Controlled Substances module this is required for order entry.
"^DD",58.8,58.8001,8,"DT")
2920330
"^DD",58.8,58.8001,8.5,0)
MAXIMUM QUANTITY PER ORDER^NJ6,0X^^0;7^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X I $P($G(^PSD(58.8,DA(1),1,DA,0)),U,9),$G(X)#$P($G(^(0)),U,9) D EN^DDIOL("Must be a multiple of "_$P($G(^(0)),U,9)) K X
"^DD",58.8,58.8001,8.5,3)
Type a Number between 0 and 999999, 0 Decimal Digits, and a multiple of the package size.
"^DD",58.8,58.8001,8.5,21,0)
^^5^5^2940608^^
"^DD",58.8,58.8001,8.5,21,1,0)
     For an NAOU that is keeping a perpetual inventory, this field may be
"^DD",58.8,58.8001,8.5,21,2,0)
used to limit the maximum quantity that Nursing Service may enter for any
"^DD",58.8,58.8001,8.5,21,3,0)
single order for this drug.  If this field is left blank, deleted, or set
"^DD",58.8,58.8001,8.5,21,4,0)
to zero, Nursing Service will be able to enter any quantity that is a 
"^DD",58.8,58.8001,8.5,21,5,0)
multiple of package size, up to 999999, for any single order of this drug.
"^DD",58.8,58.8001,8.5,23,0)
^^4^4^2940914^^^
"^DD",58.8,58.8001,8.5,23,1,0)
If the fifth piece of the second node of an entry in File 58.8 equals 1,
"^DD",58.8,58.8001,8.5,23,2,0)
the routine PSDSTK will allow access to this field.  Under the same
"^DD",58.8,58.8001,8.5,23,3,0)
circumstances, this field will be used to limit order entry in routine
"^DD",58.8,58.8001,8.5,23,4,0)
PSDOR2.
"^DD",58.8,58.8001,8.5,"DT")
2940608
"^DD",58.8,58.8001,9,0)
MANUFACTURER^F^^0;10^K:$L(X)>30!($L(X)<1) X
"^DD",58.8,58.8001,9,.1)
Manufacturer
"^DD",58.8,58.8001,9,3)
Answer must be 1-30 characters in length.
"^DD",58.8,58.8001,9,21,0)
^^2^2^2920624^^^
"^DD",58.8,58.8001,9,21,1,0)
This field contains the manufacturer of the currently stocked drug in
"^DD",58.8,58.8001,9,21,2,0)
this Pharmacy location.
"^DD",58.8,58.8001,9,"DT")
2910904
"^DD",58.8,58.8001,10,0)
LOT #^F^^0;11^K:$L(X)>10!($L(X)<1) X
"^DD",58.8,58.8001,10,.1)
Lot #
"^DD",58.8,58.8001,10,3)
Answer must be 1-10 characters in length.
"^DD",58.8,58.8001,10,21,0)
^^2^2^2920624^^^
"^DD",58.8,58.8001,10,21,1,0)
This field contains the lot # of the currently stocked drug in this
"^DD",58.8,58.8001,10,21,2,0)
Pharmacy location.
"^DD",58.8,58.8001,10,"DT")
2910904
"^DD",58.8,58.8001,11,0)
EXPIRATION DATE^D^^0;12^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,11,.1)
Expiration Date
"^DD",58.8,58.8001,11,1,0)
^.1
"^DD",58.8,58.8001,11,1,1,0)
58.8^AEXP^MUMPS
"^DD",58.8,58.8001,11,1,1,1)
S ^PSD(58.8,"AEXP",$E(X,1,30),DA,DA(1))=""
"^DD",58.8,58.8001,11,1,1,2)
K ^PSD(58.8,"AEXP",$E(X,1,30),DA,DA(1))
"^DD",58.8,58.8001,11,1,1,3)
DO NOT DELETE
"^DD",58.8,58.8001,11,1,1,"%D",0)
^^4^4^2940914^^^^
"^DD",58.8,58.8001,11,1,1,"%D",1,0)
This cross-reference is used for compiling the Expiration Date Report
"^DD",58.8,58.8001,11,1,1,"%D",2,0)
in the Controlled Substances module.
"^DD",58.8,58.8001,11,1,1,"%D",3,0)
  
"^DD",58.8,58.8001,11,1,1,"%D",4,0)
The cross-reference is ^PSD(58.8,"AEXP",DATE,DRUG,DA)="".
"^DD",58.8,58.8001,11,1,1,"DT")
2920310
"^DD",58.8,58.8001,11,3)
Enter expiration date for this drug.
"^DD",58.8,58.8001,11,21,0)
^^1^1^2920504^^^
"^DD",58.8,58.8001,11,21,1,0)
This field contains the expiration date for this stocked drug.
"^DD",58.8,58.8001,11,23,0)
^^1^1^2920504^
"^DD",58.8,58.8001,11,23,1,0)
Date may be imprecise.
"^DD",58.8,58.8001,11,"DT")
2920421
"^DD",58.8,58.8001,12,0)
PRIME VENDOR ITEM #^F^^0;13^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<3) X
"^DD",58.8,58.8001,12,.1)

"^DD",58.8,58.8001,12,1,0)
^.1
"^DD",58.8,58.8001,12,1,1,0)
58.8001^C
"^DD",58.8,58.8001,12,1,1,1)
S ^PSD(58.8,DA(1),1,"C",$E(X,1,30),DA)=""
"^DD",58.8,58.8001,12,1,1,2)
K ^PSD(58.8,DA(1),1,"C",$E(X,1,30),DA)
"^DD",58.8,58.8001,12,1,1,"%D",0)
^^1^1^2920526^
"^DD",58.8,58.8001,12,1,1,"%D",1,0)
To allow look-up by Prime Vendor Item number during receiving.
"^DD",58.8,58.8001,12,1,1,"DT")
2920526
"^DD",58.8,58.8001,12,3)
Answer must be 3-30 characters in length.
"^DD",58.8,58.8001,12,21,0)
^^2^2^2920817^^^^
"^DD",58.8,58.8001,12,21,1,0)
To allow look-up by Prime Vendor Item # during receipt process.
"^DD",58.8,58.8001,12,21,2,0)
Also to locate by Prime Vendor Item #, all receipts for that item.
"^DD",58.8,58.8001,12,23,0)
^^1^1^2920817^^^
"^DD",58.8,58.8001,12,23,1,0)
Used as a cross-reference for look-up during Prime Vendor receiving.
"^DD",58.8,58.8001,12,"DT")
2920526
"^DD",58.8,58.8001,13,0)
INACTIVATION DATE^D^^0;14^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,13,.1)
Inactivation Date
"^DD",58.8,58.8001,13,1,0)
^.1
"^DD",58.8,58.8001,13,1,1,0)
58.8001^AC^MUMPS
"^DD",58.8,58.8001,13,1,1,1)
S ^PSD(58.8,DA(1),1,DA,"I",X)=""
"^DD",58.8,58.8001,13,1,1,2)
K ^PSD(58.8,DA(1),1,DA,"I",X) D DELR^PSDUTL
"^DD",58.8,58.8001,13,1,1,"%D",0)
^^1^1^2920114^^
"^DD",58.8,58.8001,13,1,1,"%D",1,0)
This cross reference is used for locating inactivated CS stocked drugs.
"^DD",58.8,58.8001,13,1,1,"DT")
2920114
"^DD",58.8,58.8001,13,21,0)
^^3^3^2920305^^
"^DD",58.8,58.8001,13,21,1,0)
This field contains the date on which this drug was inactivated, and thus
"^DD",58.8,58.8001,13,21,2,0)
is no longer considered part of the standard stock for this Pharmacy
"^DD",58.8,58.8001,13,21,3,0)
location.
"^DD",58.8,58.8001,13,"DT")
2920114
"^DD",58.8,58.8001,14,0)
INACTIVATION REASON^S^N:NOT USED;O:OTHER;DF:DELETED FROM FORMULARY;^0;15^Q
"^DD",58.8,58.8001,14,.1)
Inactivation Reason
"^DD",58.8,58.8001,14,21,0)
^^2^2^2921117^^^^
"^DD",58.8,58.8001,14,21,1,0)
This field contains the reason that the drug has been inactivated from
"^DD",58.8,58.8001,14,21,2,0)
the list of drugs normally stocked in this Pharmacy location.
"^DD",58.8,58.8001,14,"DT")
2910911
"^DD",58.8,58.8001,14.5,0)
INACTIVATION REASON (OTHER)^F^^0;16^K:$L(X)>40!($L(X)<3) X
"^DD",58.8,58.8001,14.5,.1)
Inactivation Reason (Other)
"^DD",58.8,58.8001,14.5,3)
Answer must be 3-40 characters in length.
"^DD",58.8,58.8001,14.5,21,0)
^^3^3^2921117^^^^
"^DD",58.8,58.8001,14.5,21,1,0)
This field contains the custom reason for inactivating the drug from
"^DD",58.8,58.8001,14.5,21,2,0)
the stock list.  An inactivation reason of "other" should have been
"^DD",58.8,58.8001,14.5,21,3,0)
entered if a custom reason is to be listed.
"^DD",58.8,58.8001,14.5,"DT")
2910911
"^DD",58.8,58.8001,15,0)
WARD (FOR DRUG)^58.800115PA^^1;0
"^DD",58.8,58.8001,15,21,0)
^^3^3^2920912^^^
"^DD",58.8,58.8001,15,21,1,0)
Names of the ward or wards using this drug will be entered.  This is
"^DD",58.8,58.8001,15,21,2,0)
a link between the Controlled Substances package and the Unit Dose
"^DD",58.8,58.8001,15,21,3,0)
package for determining ward stocked drugs.
"^DD",58.8,58.8001,16,0)
INVENTORY TYPE^58.800116PA^^2;0
"^DD",58.8,58.8001,16,21,0)
^^2^2^2920718^^
"^DD",58.8,58.8001,16,21,1,0)
Inventory types are used to group related drugs in a Narcotic Area of
"^DD",58.8,58.8001,16,21,2,0)
Use.
"^DD",58.8,58.8001,16,"DT")
2920122
"^DD",58.8,58.8001,17,0)
SKIP PRINTING VA FORM 10-2638?^S^1:YES;0:NO;^GS;1^Q
"^DD",58.8,58.8001,17,.1)
Skip printing VA Form 10-2638 when dispensing this drug?
"^DD",58.8,58.8001,17,3)
Enter "YES" or "1" to skip printing VA FORM 10-2638 when dispensing this drug.
"^DD",58.8,58.8001,17,21,0)
^^2^2^2940914^^
"^DD",58.8,58.8001,17,21,1,0)
Answer "1" or "YES" to skip printing the VA FORM 10-2638 (Green Sheet)
"^DD",58.8,58.8001,17,21,2,0)
when dispensing this drug to this Narcotic Area of Use.
"^DD",58.8,58.8001,17,"DT")
2920422
"^DD",58.8,58.8001,18,0)
ORDERS^58.800118A^^3;0
"^DD",58.8,58.8001,18,21,0)
^^2^2^2920912^^
"^DD",58.8,58.8001,18,21,1,0)
The ORDERS multiple stores all data associated with Controlled
"^DD",58.8,58.8001,18,21,2,0)
Substances order requests.
"^DD",58.8,58.8001,18,"DT")
2920319
"^DD",58.8,58.8001,19,0)
ACTIVITY^58.800119PA^^4;0
"^DD",58.8,58.8001,19,21,0)
^^5^5^2940923^^^^
"^DD",58.8,58.8001,19,21,1,0)
A link to the DRUG ACCOUNTABILITY TRANSACTION file (#58.81) where each
"^DD",58.8,58.8001,19,21,2,0)
receipt and adjustment is stored as an audit trail.
"^DD",58.8,58.8001,19,21,3,0)
  
"^DD",58.8,58.8001,19,21,4,0)
In the Controlled Substances package, each dispensing transaction is
"^DD",58.8,58.8001,19,21,5,0)
also stored.
"^DD",58.8,58.8001,20,0)
MONTHLY ACTIVITY^58.801A^^5;0
"^DD",58.8,58.8001,20,21,0)
^^2^2^2920718^
"^DD",58.8,58.8001,20,21,1,0)
As activity (receipts, adjustments, dispensing) occurs for each drug,
"^DD",58.8,58.8001,20,21,2,0)
an entry will be added here in which to store totals.
"^DD",58.8,58.8001,21,0)
PRICE PER DISPENSE UNIT^CJ10,2X^^ ; ^S X=$S($D(^PSDRUG(D1,660)):$P(^PSDRUG(D1,660),U,6),1:0)
"^DD",58.8,58.8001,21,9)
^
"^DD",58.8,58.8001,21,9.01)

"^DD",58.8,58.8001,21,9.1)
S X=$P(^PSDRUG(D1,660),U,6)
"^DD",58.8,58.8001,21,21,0)
^^1^1^2941208^^^^
"^DD",58.8,58.8001,21,21,1,0)
Computed by price per dispense unit in the DRUG file (#50).
"^DD",58.8,58.8001,21,23,0)
^^1^1^2940915^^
"^DD",58.8,58.8001,21,23,1,0)
Uses price per dispense unit from File 50 - DRUG file.
"^DD",58.8,58.8001,21,"DT")
2920511
"^DD",58.8,58.8001,22,0)
LAST OP COLLECTION DATE^D^^6;1^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,22,3)
Enter the last date to collect Outpatient dispensing.
"^DD",58.8,58.8001,22,21,0)
^^3^3^2940915^^^^
"^DD",58.8,58.8001,22,21,1,0)
When collecting Outpatient dispensing data, this field will be used
"^DD",58.8,58.8001,22,21,2,0)
in conjunction with the "AL" cross-reference in File 52 - PRESCRIPTION
"^DD",58.8,58.8001,22,21,3,0)
file - to determine a starting point from which to gather dispensing data.
"^DD",58.8,58.8001,22,23,0)
^^2^2^2940915^^^^
"^DD",58.8,58.8001,22,23,1,0)
This field contains the date from the last
"^DD",58.8,58.8001,22,23,2,0)
collection of Outpatient dispensing data.
"^DD",58.8,58.8001,22,"DT")
2930713
"^DD",58.8,58.8001,22.1,0)
LAST OP COLLECTION RX^F^^6;5^K:$L(X)>11!($L(X)<1) X
"^DD",58.8,58.8001,22.1,3)
Answer must be 1-11 characters in length.
"^DD",58.8,58.8001,22.1,21,0)
^^1^1^2930713^
"^DD",58.8,58.8001,22.1,21,1,0)
The last prescription for which dispensing data was collected.
"^DD",58.8,58.8001,22.1,23,0)
^^2^2^2930713^
"^DD",58.8,58.8001,22.1,23,1,0)
The last entry from the PRESCRIPTION file (#52) for which dispensing
"^DD",58.8,58.8001,22.1,23,2,0)
data was collected.
"^DD",58.8,58.8001,22.1,"DT")
2930713
"^DD",58.8,58.8001,22.2,0)
LAST OP PARTIAL DATE^D^^6;7^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,22.2,3)
Enter last partial date.
"^DD",58.8,58.8001,22.2,21,0)
^^1^1^2940915^^
"^DD",58.8,58.8001,22.2,21,1,0)
The last date that a partial was dispensed for this drug.
"^DD",58.8,58.8001,22.2,23,0)
^^2^2^2940915^^
"^DD",58.8,58.8001,22.2,23,1,0)
Determined by looping through the "AM" cross-reference in the PRESCRIPTION
"^DD",58.8,58.8001,22.2,23,2,0)
file (#52).
"^DD",58.8,58.8001,22.2,"DT")
2930713
"^DD",58.8,58.8001,22.3,0)
LAST OP PARTIAL RX^F^^6;8^K:$L(X)>11!($L(X)<1) X
"^DD",58.8,58.8001,22.3,3)
Answer must be 1-11 characters in length.
"^DD",58.8,58.8001,22.3,21,0)
^^1^1^2940915^^
"^DD",58.8,58.8001,22.3,21,1,0)
Last partial prescription dispensed.
"^DD",58.8,58.8001,22.3,23,0)
^^2^2^2940915^^
"^DD",58.8,58.8001,22.3,23,1,0)
The last entry in the PRESCRIPTION file (#52) for which a partial was
"^DD",58.8,58.8001,22.3,23,2,0)
dispensed.
"^DD",58.8,58.8001,22.3,"DT")
2930713
"^DD",58.8,58.8001,23,0)
LAST OP RET TO STOCK DATE^D^^6;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,23,3)
Enter the last date for collection of Outpatient dispensing.
"^DD",58.8,58.8001,23,21,0)
^^4^4^2940915^^^
"^DD",58.8,58.8001,23,21,1,0)
When collecting Outpatient dispensing data, this field will be used
"^DD",58.8,58.8001,23,21,2,0)
in conjunction with the "AJ" cross-reference in File 52 - PRESCRIPTION
"^DD",58.8,58.8001,23,21,3,0)
file - to determine a starting point from which to gather return to
"^DD",58.8,58.8001,23,21,4,0)
stock data.
"^DD",58.8,58.8001,23,23,0)
^^2^2^2940915^^^
"^DD",58.8,58.8001,23,23,1,0)
This field contains the date from the last
"^DD",58.8,58.8001,23,23,2,0)
collection of return to stock data in the Outpatient module.
"^DD",58.8,58.8001,23,"DT")
2930713
"^DD",58.8,58.8001,23.1,0)
LAST OP RET TO STOCK RX^F^^6;6^K:$L(X)>11!($L(X)<1) X
"^DD",58.8,58.8001,23.1,3)
Answer must be 1-11 characters in length.
"^DD",58.8,58.8001,23.1,21,0)
^^1^1^2930713^
"^DD",58.8,58.8001,23.1,21,1,0)
The last prescription returned to stock.
"^DD",58.8,58.8001,23.1,23,0)
^^1^1^2930713^
"^DD",58.8,58.8001,23.1,23,1,0)
The last entry in the PRESCRIPTION file (#52) returned to stock.
"^DD",58.8,58.8001,23.1,"DT")
2930713
"^DD",58.8,58.8001,23.2,0)
LAST OP PARTIAL RET DATE^D^^6;9^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.8001,23.2,3)
Enter date of last partial returned to stock.
"^DD",58.8,58.8001,23.2,21,0)
^^1^1^2930713^
"^DD",58.8,58.8001,23.2,21,1,0)
Date that the last partial was returned to stock for this drug.
"^DD",58.8,58.8001,23.2,23,0)
^^1^1^2930713^
"^DD",58.8,58.8001,23.2,23,1,0)
The date that the last partial was returned to stock for this drug.
"^DD",58.8,58.8001,23.2,"DT")
2930713
"^DD",58.8,58.8001,23.3,0)
LAST OP PARTIAL RET RX^F^^6;10^K:$L(X)>11!($L(X)<1) X
"^DD",58.8,58.8001,23.3,3)
Answer must be 1-11 characters in length.
"^DD",58.8,58.8001,23.3,21,0)
^^1^1^2930713^
"^DD",58.8,58.8001,23.3,21,1,0)
The last partial prescription returned to stock for this drug.
"^DD",58.8,58.8001,23.3,23,0)
^^2^2^2940915^^
"^DD",58.8,58.8001,23.3,23,1,0)
The last entry in the PRESCRIPTION file (#52) that had a partial returned to
"^DD",58.8,58.8001,23.3,23,2,0)
stock.
"^DD",58.8,58.8001,23.3,"DT")
2930713
"^DD",58.8,58.8001,24,0)
LAST IV COLLECTION DATE,WARD^F^^6;3^K:$L(X)>60!($L(X)<3) X
"^DD",58.8,58.8001,24,3)
Answer must be 3-60 characters in length.
"^DD",58.8,58.8001,24,21,0)
^^3^3^2940915^^^
"^DD",58.8,58.8001,24,21,1,0)
When collecting IV dispensing data, this field will be used to store
"^DD",58.8,58.8001,24,21,2,0)
the last date,ward collected from the IV STATS file (#50.8).  It will then
"^DD",58.8,58.8001,24,21,3,0)
be used as a starting point for future collections.
"^DD",58.8,58.8001,24,23,0)
^^2^2^2940915^^
"^DD",58.8,58.8001,24,23,1,0)
Date and ward from File 50.8 - IV STATS file - at which dispensing data
"^DD",58.8,58.8001,24,23,2,0)
was last collected.
"^DD",58.8,58.8001,24,"DT")
2920903
"^DD",58.8,58.8001,25,0)
IV CONVERSION FACTOR^NJ9,2^^6;4^K:+X'=X!(X>999999)!(X<.01)!(X?.E1"."3N.N) X
"^DD",58.8,58.8001,25,3)
Enter a number to convert IV drug units to DRUG file (#50) dispense units.
"^DD",58.8,58.8001,25,21,0)
^^2^2^2940915^^^
"^DD",58.8,58.8001,25,21,1,0)
When dispensing occurs in the IV module, this number will be used to
"^DD",58.8,58.8001,25,21,2,0)
convert IV drug units to DRUG file (#50) dispense units.
"^DD",58.8,58.8001,25,23,0)
^^1^1^2940915^^^
"^DD",58.8,58.8001,25,23,1,0)
Used to convert IV drug units to DRUG file (#50) dispense units.
"^DD",58.8,58.8001,25,"DT")
2930702
"^DD",58.8,58.8001,26,0)
LIQUID?^S^0:NO;1:YES;^7;1^Q
"^DD",58.8,58.8001,26,3)
Is this CS drug a liquid?
"^DD",58.8,58.8001,26,21,0)
^^1^1^2930817^
"^DD",58.8,58.8001,26,21,1,0)
This field is used to flag a Controlled Substances drug as a liquid.
"^DD",58.8,58.8001,26,"DT")
2930817
"^DD",58.8,58.8001,27,0)
INITIALIZED BALANCE^S^1:YES;0:NO;^0;17^Q
"^DD",58.8,58.8001,27,3)
Enter YES if this drug balance has been initialized.
"^DD",58.8,58.8001,27,21,0)
^^2^2^2940923^^^
"^DD",58.8,58.8001,27,21,1,0)
When the drug balance has been initialized, this field will be set
"^DD",58.8,58.8001,27,21,2,0)
to "1" or "YES".  A drug balance may only be initialized once.
"^DD",58.8,58.8001,27,"DT")
2930829
"^DD",58.8,58.8001,28,0)
RESTRICT FROM NAOUS?^S^1:YES;0:NO;^7;2^Q
"^DD",58.8,58.8001,28,3)
Enter "1" or "Y" to prevent one-time requests.
"^DD",58.8,58.8001,28,21,0)
^^3^3^2951122^^^
"^DD",58.8,58.8001,28,21,1,0)
     If the primary dispensing site for an NAOU allows one-time requests,
"^DD",58.8,58.8001,28,21,2,0)
entering "YES" will prevent this drug from being ordered by any NAOU that
"^DD",58.8,58.8001,28,21,3,0)
does not already stock it.
"^DD",58.8,58.8001,28,23,0)
^^1^1^2951122^^^
"^DD",58.8,58.8001,28,23,1,0)
Checked by order entry routines (PSDOR*) before allowing one-time requests.
"^DD",58.8,58.8001,28,"DT")
2950731
"^DD",58.8,58.8001,29,0)
ALWAYS PRINT VA FORM 10-2638?^S^1:YES;0:NO;^7;3^Q
"^DD",58.8,58.8001,29,3)
Enter "YES" or "1" to force printing VA FORM 10-2638.
"^DD",58.8,58.8001,29,21,0)
^^3^3^2960308^
"^DD",58.8,58.8001,29,21,1,0)
Answer "1" or "YES" to force printing a VA FORM 10-2638 even when
"^DD",58.8,58.8001,29,21,2,0)
dispensing to a Narcotic Area of Use that is keeping a perpetual
"^DD",58.8,58.8001,29,21,3,0)
inventory.
"^DD",58.8,58.8001,29,"DT")
2960308
"^DD",58.8,58.800115,0)
WARD (FOR DRUG) SUB-FIELD^^.01^1
"^DD",58.8,58.800115,0,"DT")
2920321
"^DD",58.8,58.800115,0,"NM","WARD (FOR DRUG)")

"^DD",58.8,58.800115,0,"UP")
58.8001
"^DD",58.8,58.800115,.01,0)
WARD (FOR DRUG)^MP42'X^DIC(42,^0;1^S:$D(X) DINUM=X
"^DD",58.8,58.800115,.01,1,0)
^.1
"^DD",58.8,58.800115,.01,1,1,0)
58.8^D^MUMPS
"^DD",58.8,58.800115,.01,1,1,1)
I $D(^PSD(58.8,DA(2),1,DA(1),0)),^(0) D INACT^PSDUTL I $D(PSDFLAG) S ^PSD(58.8,"D",+^(0),DA,DA(2))="" K PSDFLAG
"^DD",58.8,58.800115,.01,1,1,2)
I $D(^PSD(58.8,DA(2),1,DA(1),0)),^(0) K ^PSD(58.8,"D",+^(0),DA,DA(2))
"^DD",58.8,58.800115,.01,1,1,3)
DO NOT DELETE
"^DD",58.8,58.800115,.01,1,1,"%D",0)
^^3^3^2940929^^^^
"^DD",58.8,58.800115,.01,1,1,"%D",1,0)
This cross-reference is the link between the Controlled Substances
"^DD",58.8,58.800115,.01,1,1,"%D",2,0)
package and the Unit Dose package for determining ward stocked drugs.
"^DD",58.8,58.800115,.01,1,1,"%D",3,0)
The cross-reference is ^PSD(58.8,"D",DRUG,WARD,DA)=""
"^DD",58.8,58.800115,.01,1,1,"DT")
2920321
"^DD",58.8,58.800115,.01,3)
Enter the ward which uses this drug.
"^DD",58.8,58.800115,.01,21,0)
^^5^5^2940920^^^^
"^DD",58.8,58.800115,.01,21,1,0)
This field contains information from the WARD LOCATION file (#42).  Names
"^DD",58.8,58.800115,.01,21,2,0)
of the ward or wards using this drug will be entered.  This is the
"^DD",58.8,58.800115,.01,21,3,0)
link between the Controlled Substances package and the Unit Dose
"^DD",58.8,58.800115,.01,21,4,0)
package for determining ward stocked drugs.
"^DD",58.8,58.800115,.01,21,5,0)
  
"^DD",58.8,58.800115,.01,23,0)
^^1^1^2940914^^^^
"^DD",58.8,58.800115,.01,23,1,0)
DINUMed pointer to File 42 - WARD LOCATION file.
"^DD",58.8,58.800115,.01,"DT")
2920321
"^DD",58.8,58.800116,0)
INVENTORY TYPE SUB-FIELD^^.01^1
"^DD",58.8,58.800116,0,"DT")
2920213
"^DD",58.8,58.800116,0,"NM","INVENTORY TYPE")

"^DD",58.8,58.800116,0,"UP")
58.8001
"^DD",58.8,58.800116,.01,0)
TYPE^M*P58.16'X^PSI(58.16,^0;1^S DIC("S")="I $P(^(0),""^"")'=""ALL""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X S:$D(X) DINUM=X
"^DD",58.8,58.800116,.01,1,0)
^.1^^0
"^DD",58.8,58.800116,.01,3)
Enter the inventory type(s) for this CS drug.
"^DD",58.8,58.800116,.01,12)
Screens out selection of "ALL" as Inventory Type.
"^DD",58.8,58.800116,.01,12.1)
S DIC("S")="I $P(^(0),""^"")'=""ALL"""
"^DD",58.8,58.800116,.01,21,0)
^^5^5^2940920^^^^
"^DD",58.8,58.800116,.01,21,1,0)
Pointer to the inventory types defined in File 58.16 - AOU INVENTORY
"^DD",58.8,58.800116,.01,21,2,0)
TYPE file.
"^DD",58.8,58.800116,.01,21,3,0)
   
"^DD",58.8,58.800116,.01,21,4,0)
The Controlled Substances module uses inventory types to group related
"^DD",58.8,58.800116,.01,21,5,0)
drugs in a Narcotic Area of Use.
"^DD",58.8,58.800116,.01,23,0)
^^1^1^2940914^^^^
"^DD",58.8,58.800116,.01,23,1,0)
DINUMed pointer to File 58.16 - AOU INVENTORY TYPE file.
"^DD",58.8,58.800116,.01,"DT")
2920213
"^DD",58.8,58.800118,0)
ORDERS SUB-FIELD^^25^26
"^DD",58.8,58.800118,0,"DT")
2961031
"^DD",58.8,58.800118,0,"IX","B",58.800118,.01)

"^DD",58.8,58.800118,0,"NM","ORDERS")

"^DD",58.8,58.800118,0,"UP")
58.8001
"^DD",58.8,58.800118,.01,0)
REQUEST #^NJ8,0X^^0;1^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",58.8,58.800118,.01,1,0)
^.1
"^DD",58.8,58.800118,.01,1,1,0)
58.800118^B
"^DD",58.8,58.800118,.01,1,1,1)
S ^PSD(58.8,DA(2),1,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.800118,.01,1,1,2)
K ^PSD(58.8,DA(2),1,DA(1),3,"B",$E(X,1,30),DA)
"^DD",58.8,58.800118,.01,3)
Type a Number between 1 and 99999999, 0 Decimal Digits
"^DD",58.8,58.800118,.01,21,0)
^^1^1^2920912^^^
"^DD",58.8,58.800118,.01,21,1,0)
Internal entry number for this Controlled Substances request order.
"^DD",58.8,58.800118,.01,23,0)
^^1^1^2920503^
"^DD",58.8,58.800118,.01,23,1,0)
DINUM
"^DD",58.8,58.800118,.01,"DT")
2920322
"^DD",58.8,58.800118,1,0)
REQUEST DATE/TIME^D^^0;2^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.800118,1,3)
Enter the request date or date/time for this order.
"^DD",58.8,58.800118,1,21,0)
^^2^2^2920912^^^
"^DD",58.8,58.800118,1,21,1,0)
The date or date/time this Controlled Substances request order was
"^DD",58.8,58.800118,1,21,2,0)
generated.
"^DD",58.8,58.800118,1,"DT")
2920319
"^DD",58.8,58.800118,2,0)
DISPENSING SITE^R*P58.8'^PSD(58.8,^0;3^S DIC("S")="I $S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.800118,2,3)
Enter the Pharmacy dispensing location.
"^DD",58.8,58.800118,2,12)
Allows selection of master vault or satellite vault as a dispensing site.
"^DD",58.8,58.800118,2,12.1)
S DIC("S")="I $S($P(^(0),""^"",2)=""M"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"^DD",58.8,58.800118,2,21,0)
^^3^3^2940923^^^^
"^DD",58.8,58.800118,2,21,1,0)
A pointer to the primary dispensing site for this Controlled Substances
"^DD",58.8,58.800118,2,21,2,0)
request order.  A primary dispensing site is defined in the DRUG
"^DD",58.8,58.800118,2,21,3,0)
ACCOUNTABILITY STATS file (#58.8) as a Master vault or Satellite vault.
"^DD",58.8,58.800118,2,23,0)
^^3^3^2940923^^^
"^DD",58.8,58.800118,2,23,1,0)
Screened pointer to File 58.8 - DRUG ACCOUNTABILITY STATS file.
"^DD",58.8,58.800118,2,23,2,0)
Allows selection of Master vault or Satellite vault as a dispensing
"^DD",58.8,58.800118,2,23,3,0)
site.
"^DD",58.8,58.800118,2,"DT")
2920325
"^DD",58.8,58.800118,3,0)
ORDERED BY^R*P200'^VA(200,^0;4^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.800118,3,3)
Enter the name of the person requesting this CS order.
"^DD",58.8,58.800118,3,12)
Access granted to nurses and pharmacy personnel holding the appropriate security key.
"^DD",58.8,58.800118,3,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.8,58.800118,3,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,3,21,1,0)
A pointer to the name of the person requesting this Controlled Substances
"^DD",58.8,58.800118,3,21,2,0)
order.
"^DD",58.8,58.800118,3,23,0)
^^1^1^2940914^^
"^DD",58.8,58.800118,3,23,1,0)
Screened pointer to File 200 - NEW PERSON file.
"^DD",58.8,58.800118,3,"DT")
2920419
"^DD",58.8,58.800118,4,0)
DISPENSED BY^R*P200'^VA(200,^0;5^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.800118,4,3)
Enter the name of the pharmacist dispensing this CS order.
"^DD",58.8,58.800118,4,12)
Access granted to pharmacist holding the appropriate security key.
"^DD",58.8,58.800118,4,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.8,58.800118,4,21,0)
^^2^2^2920912^^^
"^DD",58.8,58.800118,4,21,1,0)
A pointer to the name of the pharmacist dispensing the drug for this
"^DD",58.8,58.800118,4,21,2,0)
Controlled Substances order.
"^DD",58.8,58.800118,4,23,0)
^^1^1^2940914^^
"^DD",58.8,58.800118,4,23,1,0)
Screened pointer to File 200 - NEW PERSON file.
"^DD",58.8,58.800118,4,"DT")
2920503
"^DD",58.8,58.800118,5,0)
QUANTITY ORDERED^RNJ6,0^^0;6^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.8,58.800118,5,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.8,58.800118,5,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,5,21,1,0)
The drug quantity originally requested on this Controlled Substances
"^DD",58.8,58.800118,5,21,2,0)
order.
"^DD",58.8,58.800118,5,"DT")
2920330
"^DD",58.8,58.800118,6,0)
RECEIVED BY^*P200'^VA(200,^0;7^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.800118,6,3)
Enter the name of the person receiving this CS order.
"^DD",58.8,58.800118,6,12)
Access granted to nurses and pharmacy personnel holding the appropriate security key.
"^DD",58.8,58.800118,6,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.8,58.800118,6,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,6,21,1,0)
A pointer to the name of the person receiving this Controlled Substances
"^DD",58.8,58.800118,6,21,2,0)
order.
"^DD",58.8,58.800118,6,23,0)
^^3^3^2940914^^^
"^DD",58.8,58.800118,6,23,1,0)
Screened pointer to File 200 - NEW PERSON file.
"^DD",58.8,58.800118,6,23,2,0)
Limits selection to nurses or pharmacy personnel holding the
"^DD",58.8,58.800118,6,23,3,0)
appropriate security key.
"^DD",58.8,58.800118,6,"DT")
2930527
"^DD",58.8,58.800118,7,0)
MANUFACTURER^F^^0;8^K:$L(X)>30!($L(X)<1) X
"^DD",58.8,58.800118,7,3)
Enter the current manufacturer for the drug dispensed on this CS order.
"^DD",58.8,58.800118,7,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,7,21,1,0)
The current manufacturer of the drug dispensed on this Controlled
"^DD",58.8,58.800118,7,21,2,0)
Substances order.
"^DD",58.8,58.800118,7,"DT")
2920107
"^DD",58.8,58.800118,8,0)
LOT #^F^^0;9^K:$L(X)>10!($L(X)<1) X
"^DD",58.8,58.800118,8,3)
Enter the current lot # for the drug dispensed on this CS order.
"^DD",58.8,58.800118,8,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,8,21,1,0)
The current lot # for the drug dispensed on this Controlled Substances
"^DD",58.8,58.800118,8,21,2,0)
order.
"^DD",58.8,58.800118,8,"DT")
2920107
"^DD",58.8,58.800118,9,0)
EXPIRATION DATE^D^^0;10^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.800118,9,1,0)
^.1
"^DD",58.8,58.800118,9,1,1,0)
58.8^AEXPO^MUMPS
"^DD",58.8,58.800118,9,1,1,1)
S ^PSD(58.8,"AEXPO",$E(X,1,30),DA(1),DA(2),DA)=""
"^DD",58.8,58.800118,9,1,1,2)
K ^PSD(58.8,"AEXPO",$E(X,1,30),DA(1),DA(2),DA)
"^DD",58.8,58.800118,9,1,1,3)
DO NOT DELETE
"^DD",58.8,58.800118,9,1,1,"%D",0)
^^4^4^2940929^^^^
"^DD",58.8,58.800118,9,1,1,"%D",1,0)
This cross-reference is used for compiling the Expiration Date
"^DD",58.8,58.800118,9,1,1,"%D",2,0)
Report in the Controlled Substances module.
"^DD",58.8,58.800118,9,1,1,"%D",3,0)
  
"^DD",58.8,58.800118,9,1,1,"%D",4,0)
The cross-reference is ^PSD(58.8,"AEXPO",DATE,DRUG,NAOU,REQUEST #)=""
"^DD",58.8,58.800118,9,1,1,"DT")
2920504
"^DD",58.8,58.800118,9,3)
Enter the expiration date for the drug dispensed on this CS order.
"^DD",58.8,58.800118,9,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,9,21,1,0)
The current expiration date for the drug dispensed on this Controlled
"^DD",58.8,58.800118,9,21,2,0)
Substances order.
"^DD",58.8,58.800118,9,23,0)
^^1^1^2920624^^
"^DD",58.8,58.800118,9,23,1,0)
Date may be imprecise.
"^DD",58.8,58.800118,9,"DT")
2920504
"^DD",58.8,58.800118,10,0)
ORDER STATUS^P58.82'^PSD(58.82,^0;11^Q
"^DD",58.8,58.800118,10,1,0)
^.1
"^DD",58.8,58.800118,10,1,1,0)
58.8^AC^MUMPS
"^DD",58.8,58.800118,10,1,1,1)
S ^PSD(58.8,"AC",$E(X,1,30),DA(2),DA(1),DA)=""
"^DD",58.8,58.800118,10,1,1,2)
K ^PSD(58.8,"AC",$E(X,1,30),DA(2),DA(1),DA)
"^DD",58.8,58.800118,10,1,1,3)
DO NOT DELETE
"^DD",58.8,58.800118,10,1,1,"%D",0)
^^3^3^2940929^^^^
"^DD",58.8,58.800118,10,1,1,"%D",1,0)
This cross reference is used in compiling data for various Controlled
"^DD",58.8,58.800118,10,1,1,"%D",2,0)
Substances statistical reports.
"^DD",58.8,58.800118,10,1,1,"%D",3,0)
It represents ^PSD(58.8,"AC",ORDER STATUS,NAOU,DRUG,REQUEST #)=""
"^DD",58.8,58.800118,10,1,1,"DT")
2920325
"^DD",58.8,58.800118,10,3)
Enter the status of this Controlled Substances order.
"^DD",58.8,58.800118,10,21,0)
^^1^1^2920912^^^
"^DD",58.8,58.800118,10,21,1,0)
The status of this Controlled Substances order.
"^DD",58.8,58.800118,10,"DT")
2920325
"^DD",58.8,58.800118,11,0)
COMPLETION STATUS^P58.83'^PSD(58.83,^0;12^Q
"^DD",58.8,58.800118,11,1,0)
^.1^^0
"^DD",58.8,58.800118,11,3)
Enter the completion status of this Controlled Substances order.
"^DD",58.8,58.800118,11,21,0)
^^1^1^2920916^^
"^DD",58.8,58.800118,11,21,1,0)
The completion status for this Controlled Substances order.
"^DD",58.8,58.800118,11,"DT")
2920629
"^DD",58.8,58.800118,12,0)
COMPLETION DATE/TIME^D^^0;13^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.800118,12,3)
Enter the date/time this order was completed.
"^DD",58.8,58.800118,12,21,0)
^^1^1^2920912^^^^
"^DD",58.8,58.800118,12,21,1,0)
The date or date/time this Controlled Substances order was completed.
"^DD",58.8,58.800118,12,"DT")
2930701
"^DD",58.8,58.800118,13,0)
COMMENTS^58.80011813^^1;0
"^DD",58.8,58.800118,13,21,0)
^^2^2^2920915^^^^
"^DD",58.8,58.800118,13,21,1,0)
Comments to pharmacy concerning this Controlled Substances order
"^DD",58.8,58.800118,13,21,2,0)
request.
"^DD",58.8,58.800118,14,0)
DISPENSED DATE/TIME^D^^0;14^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.800118,14,1,0)
^.1
"^DD",58.8,58.800118,14,1,1,0)
58.8^AD
"^DD",58.8,58.800118,14,1,1,1)
S ^PSD(58.8,"AD",$E(X,1,30),DA(2),DA(1),DA)=""
"^DD",58.8,58.800118,14,1,1,2)
K ^PSD(58.8,"AD",$E(X,1,30),DA(2),DA(1),DA)
"^DD",58.8,58.800118,14,1,1,3)
DO NOT DELETE
"^DD",58.8,58.800118,14,1,1,"DT")
2920908
"^DD",58.8,58.800118,14,3)
Enter the date/time pharmacy dispensed this drug.
"^DD",58.8,58.800118,14,21,0)
^^2^2^2920915^^^
"^DD",58.8,58.800118,14,21,1,0)
The date or date/time this Controlled Substances order was dispensed
"^DD",58.8,58.800118,14,21,2,0)
from pharmacy.
"^DD",58.8,58.800118,14,"DT")
2930701
"^DD",58.8,58.800118,15,0)
RECEIPT DATE/TIME^D^^0;15^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.8,58.800118,15,1,0)
^.1^^0
"^DD",58.8,58.800118,15,3)
Enter date/time this drug was received into this Narcotic Area of Use.
"^DD",58.8,58.800118,15,21,0)
^^2^2^2920503^
"^DD",58.8,58.800118,15,21,1,0)
The date or date/time this drug order was received into this Narcotic
"^DD",58.8,58.800118,15,21,2,0)
Area of Use.
"^DD",58.8,58.800118,15,"DT")
2920908
"^DD",58.8,58.800118,16,0)
PHARMACY DISPENSING #^F^^0;16^K:$L(X)>9!($L(X)<1) X
"^DD",58.8,58.800118,16,1,0)
^.1
"^DD",58.8,58.800118,16,1,1,0)
58.8^F
"^DD",58.8,58.800118,16,1,1,1)
S ^PSD(58.8,"F",$E(X,1,30),DA(2),DA(1),DA)=""
"^DD",58.8,58.800118,16,1,1,2)
K ^PSD(58.8,"F",$E(X,1,30),DA(2),DA(1),DA)
"^DD",58.8,58.800118,16,1,1,3)
DO NOT DELETE
"^DD",58.8,58.800118,16,1,1,"DT")
2920513
"^DD",58.8,58.800118,16,3)
Answer must be 1-9 characters in length.
"^DD",58.8,58.800118,16,21,0)
^^6^6^2940914^^^^
"^DD",58.8,58.800118,16,21,1,0)
The Controlled Substances control number (Green Sheet #) pharmacy assigned
"^DD",58.8,58.800118,16,21,2,0)
to this order.
"^DD",58.8,58.800118,16,21,3,0)
   
"^DD",58.8,58.800118,16,21,4,0)
If the site parameter "AUTO GENERATE DISPENSING #'S?" was answered
"^DD",58.8,58.800118,16,21,5,0)
"YES", this number will be automatically generated within the
"^DD",58.8,58.800118,16,21,6,0)
Controlled Substances package.
"^DD",58.8,58.800118,16,"DT")
2920812
"^DD",58.8,58.800118,17,0)
TRANSACTION #^P58.81'^PSD(58.81,^0;17^Q
"^DD",58.8,58.800118,17,3)
Enter the transaction number for this CS order.
"^DD",58.8,58.800118,17,21,0)
^^1^1^2920912^^^^
"^DD",58.8,58.800118,17,21,1,0)
A pointer to the transaction for this Controlled Substances order.
"^DD",58.8,58.800118,17,23,0)
^^1^1^2940914^^^^
"^DD",58.8,58.800118,17,23,1,0)
Pointer to File 58.81 - DRUG ACCOUNTABILITY TRANSACTION file.
"^DD",58.8,58.800118,17,"DT")
2920322
"^DD",58.8,58.800118,18,0)
RX #^P52'^PSRX(^0;18^Q
"^DD",58.8,58.800118,18,3)
Enter the prescription number for this CS order.
"^DD",58.8,58.800118,18,21,0)
^^1^1^2920912^^^
"^DD",58.8,58.800118,18,21,1,0)
The prescription number for this Controlled Substances order.
"^DD",58.8,58.800118,18,23,0)
^^1^1^2940914^^
"^DD",58.8,58.800118,18,23,1,0)
Pointer to File 52 - PRESCRIPTION file.
"^DD",58.8,58.800118,18,"DT")
2920323
"^DD",58.8,58.800118,19,0)
QUANTITY DISPENSED^NJ6,0^^0;19^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.8,58.800118,19,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.8,58.800118,19,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.800118,19,21,1,0)
The actual quantity of the drug dispensed from pharmacy on this
"^DD",58.8,58.800118,19,21,2,0)
Controlled Substances order.
"^DD",58.8,58.800118,19,"DT")
2920330
"^DD",58.8,58.800118,20,0)
QUANTITY RECEIVED^NJ6,0^^0;20^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.8,58.800118,20,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.8,58.800118,20,21,0)
^^2^2^2930823^^^^
"^DD",58.8,58.800118,20,21,1,0)
The actual quantity of the drug received on this Controlled Substances
"^DD",58.8,58.800118,20,21,2,0)
order.
"^DD",58.8,58.800118,20,"DT")
2930823
"^DD",58.8,58.800118,21,0)
DISCREPANCY UNRESOLVED^S^1:YES;0:NO;^0;21^Q
"^DD",58.8,58.800118,21,1,0)
^.1^^0
"^DD",58.8,58.800118,21,3)
Answer "YES" if this receiving discrepancy is unresolved.
"^DD",58.8,58.800118,21,21,0)
^^3^3^2921106^^
"^DD",58.8,58.800118,21,21,1,0)
If the actual quantity of the drug received is different from the
"^DD",58.8,58.800118,21,21,2,0)
actual quantity pharmacy dispensed, then this field will be set
"^DD",58.8,58.800118,21,21,3,0)
to "1" or "YES".
"^DD",58.8,58.800118,21,"DT")
2920629
"^DD",58.8,58.800118,22,0)
BALANCE^NJ6,0^^0;22^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."1N.N) X
"^DD",58.8,58.800118,22,3)
Type a Number between -999999 and 999999, 0 Decimal Digits
"^DD",58.8,58.800118,22,21,0)
^^1^1^2930823^^^^
"^DD",58.8,58.800118,22,21,1,0)
Actual balance of the drug for this Controlled Substances order.
"^DD",58.8,58.800118,22,"DT")
2930823
"^DD",58.8,58.800118,23,0)
COMPLETED BY NURSE^*P200'^VA(200,^2;1^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.8,58.800118,23,3)
Enter the name of the nurse returning this order.
"^DD",58.8,58.800118,23,12)
Access granted to nurses holding the appropriate security key.
"^DD",58.8,58.800118,23,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.8,58.800118,23,21,0)
^^2^2^2940914^^^^
"^DD",58.8,58.800118,23,21,1,0)
A pointer to the name of the nurse returning the VA FORM 10-2638
"^DD",58.8,58.800118,23,21,2,0)
(Green Sheet) to pharmacy.
"^DD",58.8,58.800118,23,23,0)
^^2^2^2940914^
"^DD",58.8,58.800118,23,23,1,0)
Screened pointer to File 200 - NEW PERSON file.  Limits selection
"^DD",58.8,58.800118,23,23,2,0)
to nurses holding the appropriate security key.
"^DD",58.8,58.800118,23,"DT")
2930527
"^DD",58.8,58.800118,24,0)
EMERGENCY^S^1:YES;0:NO;^2;2^Q
"^DD",58.8,58.800118,24,3)
Answer "YES" if this is an emergency order.
"^DD",58.8,58.800118,24,21,0)
^^2^2^2950214^
"^DD",58.8,58.800118,24,21,1,0)
A "YES" entry in this field will cause an order to print on the pharmacy
"^DD",58.8,58.800118,24,21,2,0)
emergency order printer and allow for expedited processing.
"^DD",58.8,58.800118,24,23,0)
^^1^1^2950214^^
"^DD",58.8,58.800118,24,23,1,0)
This field is used to flag orders for expedited processing.
"^DD",58.8,58.800118,24,"DT")
2950214
"^DD",58.8,58.800118,25,0)
BALANCE BEFORE RECEIPT^NJ10,3^^2;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."4N.N) X
"^DD",58.8,58.800118,25,3)
Type a Number between 0 and 999999, 3 Decimal Digits
"^DD",58.8,58.800118,25,21,0)
^^1^1^2961031^
"^DD",58.8,58.800118,25,21,1,0)
The balance of this drug before receiving this order
"^DD",58.8,58.800118,25,"DT")
2961031
"^DD",58.8,58.80011813,0)
COMMENTS SUB-FIELD^^.01^1
"^DD",58.8,58.80011813,0,"DT")
2920323
"^DD",58.8,58.80011813,0,"NM","COMMENTS")

"^DD",58.8,58.80011813,0,"UP")
58.800118
"^DD",58.8,58.80011813,.01,0)
COMMENTS^W^^0;1^Q
"^DD",58.8,58.80011813,.01,3)
Enter any comments for this order.
"^DD",58.8,58.80011813,.01,21,0)
^^2^2^2920912^^^^
"^DD",58.8,58.80011813,.01,21,1,0)
Comments to pharmacy concerning this Controlled Substances order
"^DD",58.8,58.80011813,.01,21,2,0)
request.
"^DD",58.8,58.80011813,.01,"DT")
2920323
"^DD",58.8,58.800119,0)
ACTIVITY SUB-FIELD^^.01^1
"^DD",58.8,58.800119,0,"DT")
2920423
"^DD",58.8,58.800119,0,"IX","B",58.800119,.01)

"^DD",58.8,58.800119,0,"NM","ACTIVITY")

"^DD",58.8,58.800119,0,"UP")
58.8001
"^DD",58.8,58.800119,.01,0)
ACTIVITY^MP58.81X^PSD(58.81,^0;1^S:$D(X) DINUM=X
"^DD",58.8,58.800119,.01,1,0)
^.1
"^DD",58.8,58.800119,.01,1,1,0)
58.800119^B
"^DD",58.8,58.800119,.01,1,1,1)
S ^PSD(58.8,DA(2),1,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.800119,.01,1,1,2)
K ^PSD(58.8,DA(2),1,DA(1),4,"B",$E(X,1,30),DA)
"^DD",58.8,58.800119,.01,21,0)
^^2^2^2940923^^^
"^DD",58.8,58.800119,.01,21,1,0)
A link to the DRUG ACCOUNTABILITY TRANSACTION file (#58.81) where each
"^DD",58.8,58.800119,.01,21,2,0)
receipt and adjustment is stored as an audit trail.
"^DD",58.8,58.800119,.01,23,0)
^^2^2^2940923^^^
"^DD",58.8,58.800119,.01,23,1,0)
Points to File 58.81 - DRUG ACCOUNTABILITY TRANSACTION file - where full
"^DD",58.8,58.800119,.01,23,2,0)
information about each transaction is stored.
"^DD",58.8,58.800119,.01,"DT")
2920427
"^DD",58.8,58.801,0)
MONTHLY ACTIVITY SUB-FIELD^^13^14
"^DD",58.8,58.801,0,"DT")
2970630
"^DD",58.8,58.801,0,"IX","B",58.801,.01)

"^DD",58.8,58.801,0,"NM","MONTHLY ACTIVITY")

"^DD",58.8,58.801,0,"UP")
58.8001
"^DD",58.8,58.801,.01,0)
MONTHLY ACTIVITY^NJ5,0OX^^0;1^K:+X'=X!(X>9999999)!(X<29204)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",58.8,58.801,.01,1,0)
^.1^^0
"^DD",58.8,58.801,.01,1,1,0)
58.801^B
"^DD",58.8,58.801,.01,1,1,1)
S ^PSD(58.8,DA(2),1,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.801,.01,1,1,2)
K ^PSD(58.8,DA(2),1,DA(1),5,"B",$E(X,1,30),DA)
"^DD",58.8,58.801,.01,2)
S Y(0)=Y X ^DD("DD")
"^DD",58.8,58.801,.01,2.1)
X ^DD("DD")
"^DD",58.8,58.801,.01,3)
Type a Number between 29204 and 9999999, 0 Decimal Digits
"^DD",58.8,58.801,.01,21,0)
^^2^2^2930225^^^
"^DD",58.8,58.801,.01,21,1,0)
As activity (receipts, adjustments, dispensing) occurs for each drug,
"^DD",58.8,58.801,.01,21,2,0)
an entry will be added here in which to store totals.
"^DD",58.8,58.801,.01,23,0)
^^1^1^2930225^^^
"^DD",58.8,58.801,.01,23,1,0)
Month of activity stored in seven digit FM format.
"^DD",58.8,58.801,.01,"DT")
2930225
"^DD",58.8,58.801,1,0)
BEGINNING BALANCE^NJ10,2^^0;2^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,1,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,1,21,0)
^^2^2^2921106^^^^
"^DD",58.8,58.801,1,21,1,0)
At the beginning of each month, the current balance of a drug will be
"^DD",58.8,58.801,1,21,2,0)
stuffed here by a queued option.
"^DD",58.8,58.801,1,23,0)
^^1^1^2921106^^^
"^DD",58.8,58.801,1,23,1,0)
The balance of a drug at the beginning of the month.
"^DD",58.8,58.801,1,"DT")
2930503
"^DD",58.8,58.801,2,0)
BEGINNING VALUE^CJ10,2X^^ ; ^X $P(^DD(58.8001,21,0),U,5,99) S Y(58.801,2,2)=X S Y(58.801,2,1)=$S($D(^PSD(58.8,D0,1,D1,5,D2,0)):^(0),1:"") S X=$P(Y(58.801,2,1),U,2)*Y(58.801,2,2)
"^DD",58.8,58.801,2,9)
^
"^DD",58.8,58.801,2,9.01)
58.8001^12;58.801^1
"^DD",58.8,58.801,2,9.1)
BEG*PRICE PER DI
"^DD",58.8,58.801,2,21,0)
^^2^2^2940923^^^^
"^DD",58.8,58.801,2,21,1,0)
Computed by the price per dispense unit from the DRUG file (#50) times the
"^DD",58.8,58.801,2,21,2,0)
beginning balance.
"^DD",58.8,58.801,2,23,0)
^^2^2^2940923^^^^
"^DD",58.8,58.801,2,23,1,0)
Uses price per dispense unit from File 50 - DRUG file - times beginning
"^DD",58.8,58.801,2,23,2,0)
balance.
"^DD",58.8,58.801,2,"DT")
2920429
"^DD",58.8,58.801,3,0)
ENDING BALANCE^NJ10,2^^0;4^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,3,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,3,21,0)
^^2^2^2940923^^^
"^DD",58.8,58.801,3,21,1,0)
At the beginning of each month the current balance will be stuffed as
"^DD",58.8,58.801,3,21,2,0)
the previous month's ending balance.
"^DD",58.8,58.801,3,23,0)
^^1^1^2940923^^
"^DD",58.8,58.801,3,23,1,0)
The balance of a drug at the end of the month.
"^DD",58.8,58.801,3,"DT")
2930503
"^DD",58.8,58.801,4,0)
ENDING VALUE^CJ10,2^^ ; ^X $P(^DD(58.8001,21,0),U,5,99) S Y(58.801,4,2)=X S Y(58.801,4,1)=$S($D(^PSD(58.8,D0,1,D1,5,D2,0)):^(0),1:"") S X=$P(Y(58.801,4,1),U,4)*Y(58.801,4,2)
"^DD",58.8,58.801,4,9)
^
"^DD",58.8,58.801,4,9.01)
58.8001^21;58.801^3
"^DD",58.8,58.801,4,9.1)
ENDING BALANCE*PRICE PER DISPENSE UNIT
"^DD",58.8,58.801,4,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,4,21,1,0)
Computed by the price per dispense unit from the DRUG file (#50) times the
"^DD",58.8,58.801,4,21,2,0)
ending balance.
"^DD",58.8,58.801,4,23,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,4,23,1,0)
Uses price per dispense unit from File 50 - DRUG file - times ending
"^DD",58.8,58.801,4,23,2,0)
balance.
"^DD",58.8,58.801,5,0)
TOTAL RECEIVED^NJ10,2^^0;3^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,5,3)
Type a Number between 0 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,5,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,5,21,1,0)
Each receipt added to the DRUG ACCOUNTABILITY TRANSACTION file (#58.81) will
"^DD",58.8,58.801,5,21,2,0)
increment this amount.
"^DD",58.8,58.801,5,23,0)
^^2^2^2940915^^^
"^DD",58.8,58.801,5,23,1,0)
Incremented by receipt transactions in File 58.81 - DRUG ACCOUNTABILITY
"^DD",58.8,58.801,5,23,2,0)
TRANSACTION file.
"^DD",58.8,58.801,5,"DT")
2930923
"^DD",58.8,58.801,6,0)
VALUE RECEIVED^CJ10,2^^ ; ^X $P(^DD(58.8001,21,0),U,5,99) S Y(58.801,6,2)=X S Y(58.801,6,1)=$S($D(^PSD(58.8,D0,1,D1,5,D2,0)):^(0),1:"") S X=$P(Y(58.801,6,1),U,3)*Y(58.801,6,2)
"^DD",58.8,58.801,6,9)
^
"^DD",58.8,58.801,6,9.01)
58.8001^21;58.801^5
"^DD",58.8,58.801,6,9.1)
TOTAL RECEIVED*PRICE PER DISPENSE UNIT
"^DD",58.8,58.801,6,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,6,21,1,0)
Computed by the price per dispense unit from the DRUG file (#50) times the
"^DD",58.8,58.801,6,21,2,0)
total received.
"^DD",58.8,58.801,6,23,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,6,23,1,0)
Uses price per dispense unit from File 50 - DRUG file - times total
"^DD",58.8,58.801,6,23,2,0)
received.
"^DD",58.8,58.801,7,0)
TOTAL ADJUSTED^NJ10,2^^0;5^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,7,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,7,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,7,21,1,0)
Each adjustment added to the DRUG ACCOUNTABILITY TRANSACTION file (#58.81)
"^DD",58.8,58.801,7,21,2,0)
will increment/decrement this amount.
"^DD",58.8,58.801,7,23,0)
^^2^2^2940915^^^
"^DD",58.8,58.801,7,23,1,0)
Incremented/decremented by adjustments in File 58.81 - DRUG ACCOUNTABILITY
"^DD",58.8,58.801,7,23,2,0)
TRANSACTION file.
"^DD",58.8,58.801,7,"DT")
2930923
"^DD",58.8,58.801,8,0)
VALUE ADJUSTED^CJ10,2^^ ; ^X $P(^DD(58.8001,21,0),U,5,99) S Y(58.801,8,2)=X S Y(58.801,8,1)=$S($D(^PSD(58.8,D0,1,D1,5,D2,0)):^(0),1:"") S X=$P(Y(58.801,8,1),U,5)*Y(58.801,8,2)
"^DD",58.8,58.801,8,9)
^
"^DD",58.8,58.801,8,9.01)
58.8001^21;58.801^7
"^DD",58.8,58.801,8,9.1)
TOTAL ADJUSTED*PRICE PER DISPENSE UNIT
"^DD",58.8,58.801,8,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,8,21,1,0)
Computed by the price per dispense unit from the DRUG file (#50) times the
"^DD",58.8,58.801,8,21,2,0)
total adjusted.
"^DD",58.8,58.801,8,23,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,8,23,1,0)
Uses price per dispense unit from File 50 - DRUG file - times total
"^DD",58.8,58.801,8,23,2,0)
adjusted.
"^DD",58.8,58.801,9,0)
TOTAL DISPENSED^NJ10,2^^0;6^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,9,3)
Type a Number between 0 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,9,21,0)
^^2^2^2940915^^^
"^DD",58.8,58.801,9,21,1,0)
Each dispensing transaction added to the DRUG ACCOUNTABILITY TRANSACTION
"^DD",58.8,58.801,9,21,2,0)
file (#58.81) will increment this amount.
"^DD",58.8,58.801,9,23,0)
^^2^2^2940915^^
"^DD",58.8,58.801,9,23,1,0)
Incremented by dispensing recorded in File 58.81 - DRUG ACCOUNTABILITY
"^DD",58.8,58.801,9,23,2,0)
TRANSACTION file.
"^DD",58.8,58.801,9,"DT")
2930923
"^DD",58.8,58.801,10,0)
VALUE DISPENSED^CJ10,2^^ ; ^X $P(^DD(58.8001,21,0),U,5,99) S Y(58.801,10,2)=X S Y(58.801,10,1)=$S($D(^PSD(58.8,D0,1,D1,5,D2,0)):^(0),1:"") S X=$P(Y(58.801,10,1),U,6)*Y(58.801,10,2)
"^DD",58.8,58.801,10,9)
^
"^DD",58.8,58.801,10,9.01)
58.8001^21;58.801^9
"^DD",58.8,58.801,10,9.1)
TOTAL DISPENSED*PRICE PER DISPENSE UNIT
"^DD",58.8,58.801,10,21,0)
^^2^2^2940915^^^^
"^DD",58.8,58.801,10,21,1,0)
Computed by the price per dispense unit from the DRUG file (#50) times the
"^DD",58.8,58.801,10,21,2,0)
total dispensed.
"^DD",58.8,58.801,10,23,0)
^^2^2^2940915^^
"^DD",58.8,58.801,10,23,1,0)
Uses price per dispense unit from File 50 - DRUG file - times total
"^DD",58.8,58.801,10,23,2,0)
dispensed.
"^DD",58.8,58.801,11,0)
TOTAL RETURN TO STOCK^NJ10,2^^0;7^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,11,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,11,21,0)
^^2^2^2930803^
"^DD",58.8,58.801,11,21,1,0)
The total number of drugs return to stock during this month.  This total
"^DD",58.8,58.801,11,21,2,0)
includes cancelled orders returned to stock.
"^DD",58.8,58.801,11,23,0)
^^1^1^2930803^
"^DD",58.8,58.801,11,23,1,0)
Monthly total of drugs returned to stock.
"^DD",58.8,58.801,11,"DT")
2930803
"^DD",58.8,58.801,12,0)
TOTAL TURN IN FOR DESTRUCTION^NJ10,2^^0;8^K:+X'=X!(X>9999999)!(X<-9999999)!(X?.E1"."3N.N) X
"^DD",58.8,58.801,12,3)
Type a Number between -9999999 and 9999999, 2 Decimal Digits
"^DD",58.8,58.801,12,21,0)
^^1^1^2930803^
"^DD",58.8,58.801,12,21,1,0)
The total number of drugs turned into the pharmacy for destruction.
"^DD",58.8,58.801,12,23,0)
^^1^1^2930803^
"^DD",58.8,58.801,12,23,1,0)
Monthly total of drugs turned in for destruction.
"^DD",58.8,58.801,12,"DT")
2930803
"^DD",58.8,58.801,13,0)
TOTAL TRANSFERRED^NJ8,0^^0;9^K:+X'=X!(X>99999999)!(X<-99999999)!(X?.E1"."1N.N) X
"^DD",58.8,58.801,13,.1)
Total Transferred
"^DD",58.8,58.801,13,3)
Enter the total number of dispense units transferred to and from the pharmacy location.
"^DD",58.8,58.801,13,21,0)
^^2^2^2970630^^^
"^DD",58.8,58.801,13,21,1,0)
The TOTAL TRANSFERRED field contains the total number of dispense units
"^DD",58.8,58.801,13,21,2,0)
that were transferred from or to the pharmacy location.
"^DD",58.8,58.801,13,23,0)
^^2^2^2970630^
"^DD",58.8,58.801,13,23,1,0)
The number of dispense units transferred from the pharmacy location are
"^DD",58.8,58.801,13,23,2,0)
subtracted from the dispense units transferred to the pharmacy location.
"^DD",58.8,58.801,13,"DT")
2970630
"^DD",58.8,58.828,0)
ORDER ENTRY BANNER SUB-FIELD^^.01^1
"^DD",58.8,58.828,0,"DT")
2950116
"^DD",58.8,58.828,0,"NM","ORDER ENTRY BANNER")

"^DD",58.8,58.828,0,"UP")
58.8
"^DD",58.8,58.828,.01,0)
ORDER ENTRY BANNER^W^^0;1^Q
"^DD",58.8,58.828,.01,3)
Enter a banner which will be displayed for Nursing Order Entry,                 Pharmacy Order Entry from Nursing, and Infusion Order Entry.
"^DD",58.8,58.828,.01,"DT")
2950116
"^DD",58.8,58.831,0)
IV ROOM SUB-FIELD^^.01^1
"^DD",58.8,58.831,0,"DT")
2951215
"^DD",58.8,58.831,0,"NM","IV ROOM")

"^DD",58.8,58.831,0,"UP")
58.8
"^DD",58.8,58.831,.01,0)
IV ROOM^P59.5'X^PS(59.5,^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",58.8,58.831,.01,.1)
IV Room
"^DD",58.8,58.831,.01,1,0)
^.1
"^DD",58.8,58.831,.01,1,1,0)
58.8^AIV
"^DD",58.8,58.831,.01,1,1,1)
S ^PSD(58.8,"AIV",$E(X,1,30),DA(1),DA)=""
"^DD",58.8,58.831,.01,1,1,2)
K ^PSD(58.8,"AIV",$E(X,1,30),DA(1),DA)
"^DD",58.8,58.831,.01,1,1,3)
DO NOT DELETE!
"^DD",58.8,58.831,.01,1,1,"%D",0)
^^2^2^2960112^^^^
"^DD",58.8,58.831,.01,1,1,"%D",1,0)
The cross-reference is used to locate the outpatient pharmacy location
"^DD",58.8,58.831,.01,1,1,"%D",2,0)
that is linked to the IV Room. 
"^DD",58.8,58.831,.01,1,1,"DT")
2951215
"^DD",58.8,58.831,.01,3)
Enter the IV Room to which the Outpatient Pharmacy Location dispenses IVs.
"^DD",58.8,58.831,.01,21,0)
^^4^4^2970729^^^
"^DD",58.8,58.831,.01,21,1,0)
The IV Room is the Outpatient Clinic's IV room to which the Outpatient
"^DD",58.8,58.831,.01,21,2,0)
Pharmacy dispenses IVs. When IV dispensing data is compiled, it will affect
"^DD",58.8,58.831,.01,21,3,0)
the Drug Accountability outpatient pharmacy location to which the IV
"^DD",58.8,58.831,.01,21,4,0)
Room is linked.
"^DD",58.8,58.831,.01,23,0)
^^1^1^2970729^^
"^DD",58.8,58.831,.01,23,1,0)
This field points to the IV ROOM FILE (#59.5).
"^DD",58.8,58.831,.01,"DT")
2951215
"^DD",58.8,58.842,0)
WARD SUB-FIELD^^.01^1
"^DD",58.8,58.842,0,"DT")
2920825
"^DD",58.8,58.842,0,"IX","B",58.842,.01)

"^DD",58.8,58.842,0,"NM","WARD")

"^DD",58.8,58.842,0,"UP")
58.8
"^DD",58.8,58.842,.01,0)
WARD^MP42'X^DIC(42,^0;1^S:$D(X) DINUM=X
"^DD",58.8,58.842,.01,1,0)
^.1
"^DD",58.8,58.842,.01,1,1,0)
58.842^B
"^DD",58.8,58.842,.01,1,1,1)
S ^PSD(58.8,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.842,.01,1,1,2)
K ^PSD(58.8,DA(1),3,"B",$E(X,1,30),DA)
"^DD",58.8,58.842,.01,1,2,0)
58.8^AB
"^DD",58.8,58.842,.01,1,2,1)
S ^PSD(58.8,"AB",$E(X,1,30),DA(1),DA)=""
"^DD",58.8,58.842,.01,1,2,2)
K ^PSD(58.8,"AB",$E(X,1,30),DA(1),DA)
"^DD",58.8,58.842,.01,1,2,"%D",0)
^^2^2^2950718^^^^
"^DD",58.8,58.842,.01,1,2,"%D",1,0)
To be used to determine which Drug Accountability location should be
"^DD",58.8,58.842,.01,1,2,"%D",2,0)
affected by Unit Dose and IV dispensing data.
"^DD",58.8,58.842,.01,1,2,"DT")
2920825
"^DD",58.8,58.842,.01,3)
Select those wards for which you wish to gather Unit Dose or IV dispensing data.
"^DD",58.8,58.842,.01,21,0)
^^2^2^2940915^^
"^DD",58.8,58.842,.01,21,1,0)
When Unit Dose and IV dispensing data is compiled, it will affect the
"^DD",58.8,58.842,.01,21,2,0)
Drug Accountability location to which a ward is linked.
"^DD",58.8,58.842,.01,23,0)
^^1^1^2940915^^
"^DD",58.8,58.842,.01,23,1,0)
For UD/IV dispensing to be subtracted from the appropriate DA location.
"^DD",58.8,58.842,.01,"DT")
2950802
"^DD",58.8,58.8445,0)
PRIMARY INVENTORY POINT(S) SUB-FIELD^^2^3
"^DD",58.8,58.8445,0,"DT")
2930301
"^DD",58.8,58.8445,0,"IX","B",58.8445,.01)

"^DD",58.8,58.8445,0,"NM","PRIMARY INVENTORY POINT(S)")

"^DD",58.8,58.8445,0,"UP")
58.8
"^DD",58.8,58.8445,.01,0)
PRIMARY INVENTORY POINT(S)^M*P445'X^PRCP(445,^0;1^S PRCPPRIV=1,DIC("S")="I $P(^(0),U,20)=""D""" D ^DIC K DIC S DIC=DIE,X=+Y K PRCPPRIV K:Y<0 X S:$D(X) DINUM=X
"^DD",58.8,58.8445,.01,.1)
Primary Inventory Points(s)
"^DD",58.8,58.8445,.01,1,0)
^.1
"^DD",58.8,58.8445,.01,1,1,0)
58.8445^B
"^DD",58.8,58.8445,.01,1,1,1)
S ^PSD(58.8,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",58.8,58.8445,.01,1,1,2)
K ^PSD(58.8,DA(1),4,"B",$E(X,1,30),DA)
"^DD",58.8,58.8445,.01,1,2,0)
58.8^P
"^DD",58.8,58.8445,.01,1,2,1)
S ^PSD(58.8,"P",$E(X,1,30),DA(1),DA)=""
"^DD",58.8,58.8445,.01,1,2,2)
K ^PSD(58.8,"P",$E(X,1,30),DA(1),DA)
"^DD",58.8,58.8445,.01,1,2,"%D",0)
^^3^3^2940915^^
"^DD",58.8,58.8445,.01,1,2,"%D",1,0)
When receiving occurs in a Primary Inventory Point flagged as a Drug
"^DD",58.8,58.8445,.01,1,2,"%D",2,0)
Accountability special inventory type, this cross-reference will be used
"^DD",58.8,58.8445,.01,1,2,"%D",3,0)
to locate the correct Drug Accountability location to update.
"^DD",58.8,58.8445,.01,1,2,"DT")
2930223
"^DD",58.8,58.8445,.01,3)
Only primary inventory points that are set up with a special inventory type of "D" for Drug Accountability may be selected.
"^DD",58.8,58.8445,.01,12)
Must be Special Inventory Type "D" for Drug Accountability.
"^DD",58.8,58.8445,.01,12.1)
S DIC("S")="I $P(^(0),U,20)=""D"""
"^DD",58.8,58.8445,.01,21,0)
^^3^3^2970729^
"^DD",58.8,58.8445,.01,21,1,0)
To provide a direct link between a pharmacy inventory point and a pharmacy
"^DD",58.8,58.8445,.01,21,2,0)
location entry in this file.  Receiving that occurs in the inventory point
"^DD",58.8,58.8445,.01,21,3,0)
will update on hand quantities in the pharmacy location.
"^DD",58.8,58.8445,.01,23,0)
^^2^2^2970729^^^^
"^DD",58.8,58.8445,.01,23,1,0)
To provide a direct link between the GENERIC INVENTORY file (#445)
"^DD",58.8,58.8445,.01,23,2,0)
and the DRUG ACCOUNTABILITY STATS file (#58.8).
"^DD",58.8,58.8445,.01,"DT")
2970729
"^DD",58.8,58.8445,.01,"LAYGO",1,0)
N PSA S PSA=$O(^PSD(58.8,"P",+X,0)) S:PSA=DA PSA=$O(^(DA)) D:$G(PSA) EN^DDIOL($C(7)_$P($G(^PSD(58.8,+$O(^PSD(58.8,"P",+X,0)),0)),U)_" is already linked to "_$$INVNAME^PRCPUX1(X)) I '$G(PSA)
"^DD",58.8,58.8445,1,0)
RECEIPT FAILURE NOTIFICATION?^S^1:YES;0:NO;^0;2^Q
"^DD",58.8,58.8445,1,.1)
Receipt Failure Notification?
"^DD",58.8,58.8445,1,3)
Enter "1" or "Y" to transmit a MailMan message to the receiver and the RECEIPT FAILURE mail group each time a failure occurs.
"^DD",58.8,58.8445,1,21,0)
^^6^6^2970729^
"^DD",58.8,58.8445,1,21,1,0)
If a Drug Accountability location is linked to a primary inventory point,
"^DD",58.8,58.8445,1,21,2,0)
items received into the primary inventory point will also be updated in
"^DD",58.8,58.8445,1,21,3,0)
the Drug Accountability location.  If items are received that are not 
"^DD",58.8,58.8445,1,21,4,0)
connected to the DRUG file (#50) or not stocked in the Drug Accountability
"^DD",58.8,58.8445,1,21,5,0)
location, and this field is set to "YES", the receiver and the RECEIPT
"^DD",58.8,58.8445,1,21,6,0)
FAILURE mail group will be notified with a list of failed items.
"^DD",58.8,58.8445,1,23,0)
^^1^1^2970729^^^^
"^DD",58.8,58.8445,1,23,1,0)
Set of codes - "1" for "YES" or "0" for "NO".
"^DD",58.8,58.8445,1,"DT")
2970729
"^DD",58.8,58.8445,2,0)
RECEIPT MAIL GROUP^FX^^0;3^K:$L(X)>30!($L(X)<1) X
"^DD",58.8,58.8445,2,.1)
Receipt Mail Group
"^DD",58.8,58.8445,2,3)
Answer must be 1-30 characters in length.
"^DD",58.8,58.8445,2,21,0)
^^3^3^2970729^
"^DD",58.8,58.8445,2,21,1,0)
Enter the name of the mail group that should receive messages whenever
"^DD",58.8,58.8445,2,21,2,0)
inventory items cannot be received into a pharmacy location and also
"^DD",58.8,58.8445,2,21,3,0)
this same group will receive DRUG file (#50) price update messages.
"^DD",58.8,58.8445,2,23,0)
^^2^2^2970729^^^^
"^DD",58.8,58.8445,2,23,1,0)
When the routine PSAGIP is passed data by IFCAP, items that cannot
"^DD",58.8,58.8445,2,23,2,0)
be updated are listed in messages sent to the receiver and this group.
"^DD",58.8,58.8445,2,"DT")
2970729
"^DD",58.81,58.81,0)
FIELD^^106^96
"^DD",58.81,58.81,0,"DDA")
N
"^DD",58.81,58.81,0,"DT")
2970717
"^DD",58.81,58.81,0,"ID",4)
S %I=Y,Y=$S('$D(^(0)):"",$D(^PSDRUG(+$P(^(0),U,5),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(50,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",58.81,58.81,0,"ID",17)
S %I=Y,Y=$S('$D(^(0)):"",$D(^PSD(58.8,+$P(^(0),U,18),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(58.8,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",58.81,58.81,0,"IX","AC",58.81,102)

"^DD",58.81,58.81,0,"IX","ACT",58.81,3)

"^DD",58.81,58.81,0,"IX","ACT1",58.81,1)

"^DD",58.81,58.81,0,"IX","ACT2",58.81,2)

"^DD",58.81,58.81,0,"IX","ACT3",58.81,4)

"^DD",58.81,58.81,0,"IX","ACT4",58.81,34)

"^DD",58.81,58.81,0,"IX","ACT5",58.81,48)

"^DD",58.81,58.81,0,"IX","ACT6",58.81,55)

"^DD",58.81,58.81,0,"IX","ACT7",58.81,37)

"^DD",58.81,58.81,0,"IX","AD",58.81,10)

"^DD",58.81,58.81,0,"IX","AD1",58.81,17)

"^DD",58.81,58.81,0,"IX","AE",58.81,69)

"^DD",58.81,58.81,0,"IX","AEM",58.81,3)

"^DD",58.81,58.81,0,"IX","AEM1",58.81,85)

"^DD",58.81,58.81,0,"IX","AEM2",58.81,2)

"^DD",58.81,58.81,0,"IX","AEM3",58.81,4)

"^DD",58.81,58.81,0,"IX","AF",58.81,3)

"^DD",58.81,58.81,0,"IX","AF1",58.81,2)

"^DD",58.81,58.81,0,"IX","AF2",58.81,1)

"^DD",58.81,58.81,0,"IX","AG",58.81,11)

"^DD",58.81,58.81,0,"IX","AG1",58.81,17)

"^DD",58.81,58.81,0,"IX","AH",58.81,103)

"^DD",58.81,58.81,0,"IX","AK",58.81,21)

"^DD",58.81,58.81,0,"IX","AK1",58.81,17)

"^DD",58.81,58.81,0,"IX","AL",58.81,104)

"^DD",58.81,58.81,0,"IX","AOP",58.81,60)

"^DD",58.81,58.81,0,"IX","ATRN",58.81,64)

"^DD",58.81,58.81,0,"IX","B",58.81,.01)

"^DD",58.81,58.81,0,"IX","C",58.81,8)

"^DD",58.81,58.81,0,"IX","D",58.81,16)

"^DD",58.81,58.81,0,"IX","E",58.81,7)

"^DD",58.81,58.81,0,"IX","F",58.81,4)

"^DD",58.81,58.81,0,"IX","PV",58.81,71)

"^DD",58.81,58.81,0,"NM","DRUG ACCOUNTABILITY TRANSACTION")

"^DD",58.81,58.81,0,"PT",58.800118,17)

"^DD",58.81,58.81,0,"PT",58.800119,.01)

"^DD",58.81,58.81,0,"PT",58.81,69)

"^DD",58.81,58.81,0,"PT",58.85,7)

"^DD",58.81,58.81,0,"PT",58.86,8)

"^DD",58.81,58.81,0,"PT",58.89,1)

"^DD",58.81,58.81,0,"VRPK")
DRUG ACCOUNTABILITY
"^DD",58.81,58.81,.01,0)
TRANSACTION NUMBER^RNJ9,0X^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",58.81,58.81,.01,1,0)
^.1
"^DD",58.81,58.81,.01,1,1,0)
58.81^B
"^DD",58.81,58.81,.01,1,1,1)
S ^PSD(58.81,"B",$E(X,1,30),DA)=""
"^DD",58.81,58.81,.01,1,1,2)
K ^PSD(58.81,"B",$E(X,1,30),DA)
"^DD",58.81,58.81,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",58.81,58.81,.01,21,0)
^^1^1^2920624^
"^DD",58.81,58.81,.01,21,1,0)
The internal entry number for this transaction.
"^DD",58.81,58.81,.01,23,0)
^^1^1^2920624^
"^DD",58.81,58.81,.01,23,1,0)
DINUMed.
"^DD",58.81,58.81,.01,"DT")
2920616
"^DD",58.81,58.81,1,0)
TYPE^P58.84'^PSD(58.84,^0;2^Q
"^DD",58.81,58.81,1,1,0)
^.1
"^DD",58.81,58.81,1,1,1,0)
58.81^AF2^MUMPS
"^DD",58.81,58.81,1,1,1,1)
D SAFT^PSDUTL
"^DD",58.81,58.81,1,1,1,2)
D KAFT^PSDUTL
"^DD",58.81,58.81,1,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,1,1,1,"%D",0)
^^3^3^2940929^^^
"^DD",58.81,58.81,1,1,1,"%D",1,0)
This cross-reference is used for Controlled Substances and Drug
"^DD",58.81,58.81,1,1,1,"%D",2,0)
Accountability statistical reporting.  The cross-reference is 
"^DD",58.81,58.81,1,1,1,"%D",3,0)
^PSD(58.81,"AF",DATE/TIME,LOCATION,TYPE,DA)=""
"^DD",58.81,58.81,1,1,1,"DT")
2920609
"^DD",58.81,58.81,1,1,2,0)
58.81^ACT1^MUMPS
"^DD",58.81,58.81,1,1,2,1)
D SACT1^PSDUTL1
"^DD",58.81,58.81,1,1,2,2)
D KACT1^PSDUTL1
"^DD",58.81,58.81,1,1,2,3)
DO NOT DELETE
"^DD",58.81,58.81,1,1,2,"%D",0)
^^4^4^2940929^^^^
"^DD",58.81,58.81,1,1,2,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,1,1,2,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,1,1,2,"%D",3,0)
  
"^DD",58.81,58.81,1,1,2,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",DATE/TIME,LOCATION,DRUG,TYPE,DA)=""
"^DD",58.81,58.81,1,1,2,"DT")
2920612
"^DD",58.81,58.81,1,3)
Enter the transaction type.
"^DD",58.81,58.81,1,21,0)
^^1^1^2920912^^
"^DD",58.81,58.81,1,21,1,0)
A pointer to the name of this type transaction.
"^DD",58.81,58.81,1,"DT")
2920612
"^DD",58.81,58.81,2,0)
PHARMACY LOCATION^*P58.8'^PSD(58.8,^0;3^S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)'=""P""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,2,.1)
DISPENSING SITE
"^DD",58.81,58.81,2,1,0)
^.1
"^DD",58.81,58.81,2,1,1,0)
58.81^AF1^MUMPS
"^DD",58.81,58.81,2,1,1,1)
D SAFL^PSDUTL
"^DD",58.81,58.81,2,1,1,2)
D KAFL^PSDUTL
"^DD",58.81,58.81,2,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,2,1,1,"%D",0)
^^3^3^2940915^^^
"^DD",58.81,58.81,2,1,1,"%D",1,0)
This cross-reference is used for Controlled Substances and Drug
"^DD",58.81,58.81,2,1,1,"%D",2,0)
Accountability statistical reporting.  The cross-reference is
"^DD",58.81,58.81,2,1,1,"%D",3,0)
^PSD(58.81,"AF",DATE/TIME,LOCATION,TYPE,DA)="".
"^DD",58.81,58.81,2,1,1,"DT")
2920602
"^DD",58.81,58.81,2,1,2,0)
58.81^ACT2^MUMPS
"^DD",58.81,58.81,2,1,2,1)
D SACT2^PSDUTL1
"^DD",58.81,58.81,2,1,2,2)
D KACT2^PSDUTL1
"^DD",58.81,58.81,2,1,2,3)
DO NOT DELETE
"^DD",58.81,58.81,2,1,2,"%D",0)
^^4^4^2950216^^^^
"^DD",58.81,58.81,2,1,2,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,2,1,2,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,2,1,2,"%D",3,0)
 
"^DD",58.81,58.81,2,1,2,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",DATE/TIME,LOCATION,DRUG,TYPE,DA)="".
"^DD",58.81,58.81,2,1,2,"DT")
2920613
"^DD",58.81,58.81,2,1,3,0)
58.81^AEM2^MUMPS
"^DD",58.81,58.81,2,1,3,1)
D SAEM2^PSDUTL5
"^DD",58.81,58.81,2,1,3,2)
D KAEM2^PSDUTL5
"^DD",58.81,58.81,2,1,3,3)
DO NOT DELETE
"^DD",58.81,58.81,2,1,3,"%D",0)
^^3^3^2950216^
"^DD",58.81,58.81,2,1,3,"%D",1,0)
This cross-reference is used to track emergency orders.
"^DD",58.81,58.81,2,1,3,"%D",2,0)
 
"^DD",58.81,58.81,2,1,3,"%D",3,0)
The cross-reference is ^PSD(58.81,"AEM",DATE/TIME,LOCATION,DRUG,DA)="".
"^DD",58.81,58.81,2,1,3,"DT")
2950216
"^DD",58.81,58.81,2,3)
Enter the pharmacy location for this transaction.
"^DD",58.81,58.81,2,12)
For CS, does not allow selection of a "primary" type pharmacy location.
"^DD",58.81,58.81,2,12.1)
S:$D(PSDSITE) DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)'=""P"""
"^DD",58.81,58.81,2,21,0)
^^4^4^2921117^^^^
"^DD",58.81,58.81,2,21,1,0)
This field contains a pointer to the Pharmacy location in the DRUG
"^DD",58.81,58.81,2,21,2,0)
ACCOUNTABILITY STATS file (#58.8).  The Controlled Substances module
"^DD",58.81,58.81,2,21,3,0)
will recognize this location as the Narcotic Area of Use (NAOU),
"^DD",58.81,58.81,2,21,4,0)
usually the pharmacy dispensing site (vault).
"^DD",58.81,58.81,2,"DT")
2950216
"^DD",58.81,58.81,3,0)
DATE/TIME^D^^0;4^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,3,1,0)
^.1
"^DD",58.81,58.81,3,1,1,0)
58.81^AF^MUMPS
"^DD",58.81,58.81,3,1,1,1)
D SAF^PSDUTL
"^DD",58.81,58.81,3,1,1,2)
D KAF^PSDUTL
"^DD",58.81,58.81,3,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,3,1,1,"%D",0)
^^3^3^2920912^^^
"^DD",58.81,58.81,3,1,1,"%D",1,0)
This cross-reference is used for Controlled Substances and Drug 
"^DD",58.81,58.81,3,1,1,"%D",2,0)
Accountability statistical reporting.  The cross-reference is
"^DD",58.81,58.81,3,1,1,"%D",3,0)
^PSD(58.81,"AF",DATE/TIME,LOCATION,TYPE,DA)=""
"^DD",58.81,58.81,3,1,1,"DT")
2920602
"^DD",58.81,58.81,3,1,2,0)
58.81^ACT^MUMPS
"^DD",58.81,58.81,3,1,2,1)
D SACT^PSDUTL1
"^DD",58.81,58.81,3,1,2,2)
D KACT^PSDUTL1
"^DD",58.81,58.81,3,1,2,3)
DO NOT DELETE
"^DD",58.81,58.81,3,1,2,"%D",0)
^^4^4^2950216^^^
"^DD",58.81,58.81,3,1,2,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,3,1,2,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,3,1,2,"%D",3,0)
  
"^DD",58.81,58.81,3,1,2,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",DATE/TIME,LOCATION,DRUG,TYPE,DA)="".
"^DD",58.81,58.81,3,1,2,"DT")
2920613
"^DD",58.81,58.81,3,1,3,0)
58.81^AEM^MUMPS
"^DD",58.81,58.81,3,1,3,1)
D SAEM^PSDUTL5
"^DD",58.81,58.81,3,1,3,2)
D KAEM^PSDUTL5
"^DD",58.81,58.81,3,1,3,3)
DO NOT DELETE
"^DD",58.81,58.81,3,1,3,"%D",0)
^^3^3^2950216^
"^DD",58.81,58.81,3,1,3,"%D",1,0)
This cross-reference is used to track emergency orders.
"^DD",58.81,58.81,3,1,3,"%D",2,0)
 
"^DD",58.81,58.81,3,1,3,"%D",3,0)
The cross-reference is ^PSD(58.81,"AEM",DATE/TIME,LOCATION,DRUG,DA)="".
"^DD",58.81,58.81,3,1,3,"DT")
2950216
"^DD",58.81,58.81,3,2)
S Y(0)=Y X ^DD("DD")
"^DD",58.81,58.81,3,2.1)
X ^DD("DD")
"^DD",58.81,58.81,3,3)
Enter the date of this transaction.
"^DD",58.81,58.81,3,21,0)
^^4^4^2920912^^^
"^DD",58.81,58.81,3,21,1,0)
The date/time of this transaction.
"^DD",58.81,58.81,3,21,2,0)
  
"^DD",58.81,58.81,3,21,3,0)
For Controlled Substances dispensing transactions, this is the date/time
"^DD",58.81,58.81,3,21,4,0)
the pharmacist verified this transaction.
"^DD",58.81,58.81,3,"DT")
2950216
"^DD",58.81,58.81,4,0)
DRUG^*P50'^PSDRUG(^0;5^S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" S:$D(PSDSITE) DIC("S")=DIC("S")_",$S($P($G(^(2)),""^"",3)[""N"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,4,1,0)
^.1
"^DD",58.81,58.81,4,1,1,0)
58.81^F
"^DD",58.81,58.81,4,1,1,1)
S ^PSD(58.81,"F",$E(X,1,30),DA)=""
"^DD",58.81,58.81,4,1,1,2)
K ^PSD(58.81,"F",$E(X,1,30),DA)
"^DD",58.81,58.81,4,1,1,"%D",0)
^^1^1^2920520^
"^DD",58.81,58.81,4,1,1,"%D",1,0)
To locate all receipt history for a given drug.
"^DD",58.81,58.81,4,1,1,"DT")
2920520
"^DD",58.81,58.81,4,1,2,0)
58.81^ACT3^MUMPS
"^DD",58.81,58.81,4,1,2,1)
D SACT3^PSDUTL1
"^DD",58.81,58.81,4,1,2,2)
D KACT3^PSDUTL1
"^DD",58.81,58.81,4,1,2,3)
DO NOT DELETE
"^DD",58.81,58.81,4,1,2,"%D",0)
^^4^4^2940929^^^
"^DD",58.81,58.81,4,1,2,"%D",1,0)
This cross-reference is used for compiling data to print the pharmacy
"^DD",58.81,58.81,4,1,2,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,4,1,2,"%D",3,0)
  
"^DD",58.81,58.81,4,1,2,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",DATE/TIME,LOCATION,DRUG,TYPE,DA)=""
"^DD",58.81,58.81,4,1,2,"DT")
2920613
"^DD",58.81,58.81,4,1,3,0)
58.81^AEM3^MUMPS
"^DD",58.81,58.81,4,1,3,1)
D SAEM3^PSDUTL5
"^DD",58.81,58.81,4,1,3,2)
D KAEM3^PSDUTL5
"^DD",58.81,58.81,4,1,3,3)
DO NOT DELETE
"^DD",58.81,58.81,4,1,3,"%D",0)
^^3^3^2950216^
"^DD",58.81,58.81,4,1,3,"%D",1,0)
This cross-reference is used to track emergency orders.
"^DD",58.81,58.81,4,1,3,"%D",2,0)
 
"^DD",58.81,58.81,4,1,3,"%D",3,0)
The cross-reference is ^PSD(58.81,"AEM",DATE/TIME,LOCATION,DRUG,DA)="".
"^DD",58.81,58.81,4,1,3,"DT")
2950216
"^DD",58.81,58.81,4,3)
Enter the name of the drug being processed in this transaction.
"^DD",58.81,58.81,4,12)
For CS locations, select only ACTIVE drugs marked for CS package use.
"^DD",58.81,58.81,4,12.1)
S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0)" S:$D(PSDSITE) DIC("S")=DIC("S")_",$S($P($G(^(2)),""^"",3)[""N"":1,1:0)"
"^DD",58.81,58.81,4,21,0)
^^1^1^2940915^^^
"^DD",58.81,58.81,4,21,1,0)
A pointer to the drug for this transaction.
"^DD",58.81,58.81,4,23,0)
^^6^6^2940915^^^^
"^DD",58.81,58.81,4,23,1,0)
Within the Controlled Substances module, select only ACTIVE drugs
"^DD",58.81,58.81,4,23,2,0)
marked for use in the CS package.  Do not select INACTIVE or
"^DD",58.81,58.81,4,23,3,0)
NON-PHARMACY drugs.  This field should not be edited directly
"^DD",58.81,58.81,4,23,4,0)
using VA FileMan.  The appropriate screen for selecting ACTIVE drugs
"^DD",58.81,58.81,4,23,5,0)
marked for CS use is contained within the package functionality.
"^DD",58.81,58.81,4,23,6,0)
DINUMed pointer to File 50 - DRUG file.
"^DD",58.81,58.81,4,"DT")
2950216
"^DD",58.81,58.81,5,0)
QUANTITY^NJ9,2^^0;6^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,5,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,5,21,0)
^^4^4^2940915^^^^
"^DD",58.81,58.81,5,21,1,0)
The transaction quantity for this drug.
"^DD",58.81,58.81,5,21,2,0)
  
"^DD",58.81,58.81,5,21,3,0)
If the transaction type is BALANCE ADJUSTMENT, this quantity may
"^DD",58.81,58.81,5,21,4,0)
be a negative number.
"^DD",58.81,58.81,5,"DT")
2930923
"^DD",58.81,58.81,6,0)
TRANSACTOR^P200'^VA(200,^0;7^Q
"^DD",58.81,58.81,6,3)
Enter the name of the person initiating this transaction.
"^DD",58.81,58.81,6,21,0)
^^2^2^2920415^
"^DD",58.81,58.81,6,21,1,0)
This field contains a pointer to the name of the person initiating
"^DD",58.81,58.81,6,21,2,0)
this transaction.
"^DD",58.81,58.81,6,"DT")
2920415
"^DD",58.81,58.81,7,0)
CONTROL POINT ACTIVITY^P410'^PRCS(410,^0;8^Q
"^DD",58.81,58.81,7,1,0)
^.1
"^DD",58.81,58.81,7,1,1,0)
58.81^E
"^DD",58.81,58.81,7,1,1,1)
S ^PSD(58.81,"E",$E(X,1,30),DA)=""
"^DD",58.81,58.81,7,1,1,2)
K ^PSD(58.81,"E",$E(X,1,30),DA)
"^DD",58.81,58.81,7,1,1,"%D",0)
^^1^1^2920515^
"^DD",58.81,58.81,7,1,1,"%D",1,0)
To locate all transactions linked to a certain Control Point Activity #.
"^DD",58.81,58.81,7,1,1,"DT")
2920515
"^DD",58.81,58.81,7,3)
Enter the Control Point Activity number.
"^DD",58.81,58.81,7,21,0)
^^3^3^2921117^^^
"^DD",58.81,58.81,7,21,1,0)
Posted (Warehouse) Issue activity that created this transaction.
"^DD",58.81,58.81,7,21,2,0)
This field is a pointer to the CONTROL POINT ACTIVITY file (#410) and
"^DD",58.81,58.81,7,21,3,0)
will be used mainly for receipt transactions.
"^DD",58.81,58.81,7,23,0)
^^2^2^2940915^^^^
"^DD",58.81,58.81,7,23,1,0)
Pointer to the entry in File 410 - CONTROL POINT ACTIVITY file - that
"^DD",58.81,58.81,7,23,2,0)
created this transaction.
"^DD",58.81,58.81,7,"DT")
2920415
"^DD",58.81,58.81,8,0)
PURCHASE ORDER NUMBER^P442'^PRC(442,^0;9^Q
"^DD",58.81,58.81,8,1,0)
^.1
"^DD",58.81,58.81,8,1,1,0)
58.81^C
"^DD",58.81,58.81,8,1,1,1)
S ^PSD(58.81,"C",$E(X,1,30),DA)=""
"^DD",58.81,58.81,8,1,1,2)
K ^PSD(58.81,"C",$E(X,1,30),DA)
"^DD",58.81,58.81,8,1,1,"DT")
2920501
"^DD",58.81,58.81,8,3)
Enter the Purchase Order number for this transaction.
"^DD",58.81,58.81,8,21,0)
^^4^4^2921106^^^^
"^DD",58.81,58.81,8,21,1,0)
The Unposted (Non-Warehouse) Purchase Order from which this transaction
"^DD",58.81,58.81,8,21,2,0)
was created.  This field is a pointer to the PROCUREMENT & ACCOUNTING
"^DD",58.81,58.81,8,21,3,0)
TRANSACTION file (#442) and will be used mainly for receipt
"^DD",58.81,58.81,8,21,4,0)
transactions.
"^DD",58.81,58.81,8,23,0)
^^2^2^2940915^^^^
"^DD",58.81,58.81,8,23,1,0)
Pointer to the entry in File 442 - PROCUREMENT & ACCOUNTING TRANSACTION
"^DD",58.81,58.81,8,23,2,0)
file - to which this transaction is linked.
"^DD",58.81,58.81,8,"DT")
2920501
"^DD",58.81,58.81,9,0)
BALANCE FORWARD^NJ9,2^^0;10^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,9,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,9,21,0)
^^3^3^2921106^^^
"^DD",58.81,58.81,9,21,1,0)
The pharmacy dispensing site (vault) inventory balance forward for
"^DD",58.81,58.81,9,21,2,0)
this drug.  This balance is used in listing pharmacy's "Daily
"^DD",58.81,58.81,9,21,3,0)
Activity Log".
"^DD",58.81,58.81,9,"DT")
2930428
"^DD",58.81,58.81,10,0)
ORDER STATUS^P58.82'^PSD(58.82,^0;11^Q
"^DD",58.81,58.81,10,1,0)
^.1
"^DD",58.81,58.81,10,1,1,0)
58.81^AD^MUMPS
"^DD",58.81,58.81,10,1,1,1)
D SAD^PSDUTL
"^DD",58.81,58.81,10,1,1,2)
D KAD^PSDUTL
"^DD",58.81,58.81,10,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,10,1,1,"%D",0)
^^3^3^2940929^^^^
"^DD",58.81,58.81,10,1,1,"%D",1,0)
This cross-reference is used for compiling the "Narcotic Dispensing
"^DD",58.81,58.81,10,1,1,"%D",2,0)
Report".
"^DD",58.81,58.81,10,1,1,"%D",3,0)
The cross-reference is ^PSD(58.81,"AD",ORDER STATUS,NAOU,DA)=""
"^DD",58.81,58.81,10,1,1,"DT")
2920507
"^DD",58.81,58.81,10,3)
Enter the processing status for this order.
"^DD",58.81,58.81,10,21,0)
^^3^3^2921117^^^^
"^DD",58.81,58.81,10,21,1,0)
The processing status for the Controlled Substances order being updated
"^DD",58.81,58.81,10,21,2,0)
in this transaction.  This field is a pointer to the CS ORDER STATUS
"^DD",58.81,58.81,10,21,3,0)
file (#58.82).
"^DD",58.81,58.81,10,23,0)
^^1^1^2940915^^^
"^DD",58.81,58.81,10,23,1,0)
Pointer to File 58.82 - CS ORDER STATS file.
"^DD",58.81,58.81,10,"DT")
2920507
"^DD",58.81,58.81,11,0)
COMPLETION STATUS^P58.83'^PSD(58.83,^0;12^Q
"^DD",58.81,58.81,11,1,0)
^.1
"^DD",58.81,58.81,11,1,1,0)
58.81^AG^MUMPS
"^DD",58.81,58.81,11,1,1,1)
D SAG^PSDUTL2
"^DD",58.81,58.81,11,1,1,2)
D KAG^PSDUTL2
"^DD",58.81,58.81,11,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,11,1,1,"%D",0)
^^3^3^2940929^^^^
"^DD",58.81,58.81,11,1,1,"%D",1,0)
This cross-reference is used for compiling reports displaying Green Sheet
"^DD",58.81,58.81,11,1,1,"%D",2,0)
discrepancies.
"^DD",58.81,58.81,11,1,1,"%D",3,0)
The cross-reference is ^PSD(58.81,"AG",COMPLETION STATUS,NAOU,DA)=""
"^DD",58.81,58.81,11,1,1,"DT")
2920905
"^DD",58.81,58.81,11,3)
Enter the completion status for this Controlled Substances order.
"^DD",58.81,58.81,11,21,0)
^^3^3^2940915^^^^
"^DD",58.81,58.81,11,21,1,0)
The completion status for this Controlled Substances order being updated
"^DD",58.81,58.81,11,21,2,0)
by this transaction.  This field is a pointer to the CS COMPLETION STATUS
"^DD",58.81,58.81,11,21,3,0)
file (#58.83).
"^DD",58.81,58.81,11,23,0)
^^1^1^2940915^^^^
"^DD",58.81,58.81,11,23,1,0)
Pointer to File 58.83 - CS COMPLETION STATUS file.
"^DD",58.81,58.81,11,"DT")
2920905
"^DD",58.81,58.81,12,0)
MANUFACTURER^F^^0;13^K:$L(X)>30!($L(X)<1) X
"^DD",58.81,58.81,12,3)
Enter the current manufacturer (1-30 characters).
"^DD",58.81,58.81,12,21,0)
^^1^1^2920415^
"^DD",58.81,58.81,12,21,1,0)
The current manufacturer of this drug.
"^DD",58.81,58.81,12,"DT")
2920415
"^DD",58.81,58.81,13,0)
LOT #^F^^0;14^K:$L(X)>10!($L(X)<1) X
"^DD",58.81,58.81,13,3)
Enter the current lot # for this drug (1-10 characters).
"^DD",58.81,58.81,13,21,0)
^^1^1^2920415^
"^DD",58.81,58.81,13,21,1,0)
The current lot # of this drug.
"^DD",58.81,58.81,13,"DT")
2920415
"^DD",58.81,58.81,14,0)
EXPIRATION DATE^D^^0;15^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,14,3)
Enter the expiration date for this drug.
"^DD",58.81,58.81,14,21,0)
^^1^1^2920601^^
"^DD",58.81,58.81,14,21,1,0)
The current expiration date for this drug.
"^DD",58.81,58.81,14,"DT")
2920430
"^DD",58.81,58.81,15,0)
REASON^F^^0;16^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,15,3)
Answer must be 1-45 characters in length.
"^DD",58.81,58.81,15,21,0)
^^1^1^2951108^^^
"^DD",58.81,58.81,15,21,1,0)
Reason for creating this transaction.
"^DD",58.81,58.81,15,"DT")
2920415
"^DD",58.81,58.81,16,0)
PHARMACY DISPENSING #^F^^0;17^K:$L(X)>9!($L(X)<1) X
"^DD",58.81,58.81,16,1,0)
^.1
"^DD",58.81,58.81,16,1,1,0)
58.81^D
"^DD",58.81,58.81,16,1,1,1)
S ^PSD(58.81,"D",$E(X,1,30),DA)=""
"^DD",58.81,58.81,16,1,1,2)
K ^PSD(58.81,"D",$E(X,1,30),DA)
"^DD",58.81,58.81,16,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,16,1,1,"DT")
2920501
"^DD",58.81,58.81,16,3)
Answer must be 1-9 characters in length.
"^DD",58.81,58.81,16,21,0)
^^3^3^2920912^^
"^DD",58.81,58.81,16,21,1,0)
The pharmacy control number to identify and track this Controlled
"^DD",58.81,58.81,16,21,2,0)
Substances transaction.  This number may be manually entered in
"^DD",58.81,58.81,16,21,3,0)
pharmacy or auto-generated by the CS software.
"^DD",58.81,58.81,16,"DT")
2920812
"^DD",58.81,58.81,17,0)
NAOU^*P58.8'^PSD(58.8,^0;18^S DIC("S")="I $S($P(^(0),""^"",2)=""N"":1,$P(^(0),""^"",2)=""S"":1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,17,1,0)
^.1
"^DD",58.81,58.81,17,1,1,0)
58.81^AD1^MUMPS
"^DD",58.81,58.81,17,1,1,1)
D SAD^PSDUTL1
"^DD",58.81,58.81,17,1,1,2)
D KAD^PSDUTL1
"^DD",58.81,58.81,17,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,17,1,1,"%D",0)
^^2^2^2940929^^^^
"^DD",58.81,58.81,17,1,1,"%D",1,0)
This cross-reference is used in compiling the "Narcotic Dispensing Report".
"^DD",58.81,58.81,17,1,1,"%D",2,0)
The cross-reference is ^PSD(58.81,"AD",ORDER STATUS,NAOU,DA)=""
"^DD",58.81,58.81,17,1,1,"DT")
2920805
"^DD",58.81,58.81,17,1,2,0)
58.81^AG1^MUMPS
"^DD",58.81,58.81,17,1,2,1)
D SAG1^PSDUTL2
"^DD",58.81,58.81,17,1,2,2)
D KAG1^PSDUTL2
"^DD",58.81,58.81,17,1,2,3)
DO NOT DELETE
"^DD",58.81,58.81,17,1,2,"%D",0)
^^3^3^2940929^^^^
"^DD",58.81,58.81,17,1,2,"%D",1,0)
This cross-reference is used in compiling reports displaying Green Sheet
"^DD",58.81,58.81,17,1,2,"%D",2,0)
discrepancies.
"^DD",58.81,58.81,17,1,2,"%D",3,0)
The cross-reference is ^PSD(58.81,"AG",COMPLETION STATUS,NAOU,DA)=""
"^DD",58.81,58.81,17,1,2,"DT")
2920905
"^DD",58.81,58.81,17,1,3,0)
58.81^AK1^MUMPS
"^DD",58.81,58.81,17,1,3,1)
D SAK1^PSDUTL4
"^DD",58.81,58.81,17,1,3,2)
D KAK1^PSDUTL4
"^DD",58.81,58.81,17,1,3,3)
DO NOT DELETE
"^DD",58.81,58.81,17,1,3,"%D",0)
^^3^3^2940929^^^^
"^DD",58.81,58.81,17,1,3,"%D",1,0)
This cross-reference is used in compiling the "Inspector's Log for
"^DD",58.81,58.81,17,1,3,"%D",2,0)
Controlled Substances" generated by date received on the NAOU.
"^DD",58.81,58.81,17,1,3,"%D",3,0)
The cross-reference is ^PSD(58.81,"AK",D/T RECD,NAOU,DA)=""
"^DD",58.81,58.81,17,1,3,"DT")
2940523
"^DD",58.81,58.81,17,3)
Enter the NAOU ordering this drug.
"^DD",58.81,58.81,17,12)
Allows selection of a Satellite vault or Narcotic location.
"^DD",58.81,58.81,17,12.1)
S DIC("S")="I $S($P(^(0),""^"",2)=""N"":1,$P(^(0),""^"",2)=""S"":1,1:0)"
"^DD",58.81,58.81,17,21,0)
^^1^1^2920912^^^
"^DD",58.81,58.81,17,21,1,0)
The NAOU ordering this Controlled Substances drug.
"^DD",58.81,58.81,17,"DT")
2940523
"^DD",58.81,58.81,18,0)
DISPENSED BY^*P200'^VA(200,^1;1^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,18,3)
Enter the pharmacist dispensing this drug.
"^DD",58.81,58.81,18,12)
Access granted to pharmacists holding the appropriate security key.
"^DD",58.81,58.81,18,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.81,58.81,18,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,18,21,1,0)
A pointer to the name of the pharmacist dispensing this drug.
"^DD",58.81,58.81,18,"DT")
2920415
"^DD",58.81,58.81,19,0)
PROCESSED DATE/TIME^D^^1;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,19,1,0)
^.1^^0
"^DD",58.81,58.81,19,3)
Enter the date/time pharmacy processed this drug.
"^DD",58.81,58.81,19,21,0)
^^3^3^2920912^^
"^DD",58.81,58.81,19,21,1,0)
The date/time this transaction was processed.
"^DD",58.81,58.81,19,21,2,0)
For Controlled Substances dispensing transactions, this is the date/time
"^DD",58.81,58.81,19,21,3,0)
a pharmacy technician processed this transaction.
"^DD",58.81,58.81,19,"DT")
2930701
"^DD",58.81,58.81,20,0)
ORDER RECEIVED BY^*P200'^VA(200,^1;3^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,20,3)
Enter the person receiving this drug.
"^DD",58.81,58.81,20,12)
Access granted to persons holding the appropriate security key.
"^DD",58.81,58.81,20,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.81,58.81,20,21,0)
^^2^2^2920912^^^
"^DD",58.81,58.81,20,21,1,0)
A pointer to the name of the person receiving this Controlled
"^DD",58.81,58.81,20,21,2,0)
Substances drug into the ordering Narcotic Area of Use.
"^DD",58.81,58.81,20,"DT")
2930527
"^DD",58.81,58.81,21,0)
RECEIPT DATE/TIME^D^^1;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,21,1,0)
^.1
"^DD",58.81,58.81,21,1,1,0)
58.81^AK^MUMPS
"^DD",58.81,58.81,21,1,1,1)
D SAK^PSDUTL4
"^DD",58.81,58.81,21,1,1,2)
D KAK^PSDUTL4
"^DD",58.81,58.81,21,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,21,1,1,"%D",0)
^^3^3^2941003^^^^
"^DD",58.81,58.81,21,1,1,"%D",1,0)
This cross-reference is used in compiling the "Inspector's Log for
"^DD",58.81,58.81,21,1,1,"%D",2,0)
Controlled Substances" generated by date received on the NAOU.
"^DD",58.81,58.81,21,1,1,"%D",3,0)
The cross-reference is ^PSD(58.81,"AK",D/T RECD,NAOU,DA)=""
"^DD",58.81,58.81,21,1,1,"DT")
2940523
"^DD",58.81,58.81,21,3)
Enter the date/time this drug was received from pharmacy.
"^DD",58.81,58.81,21,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,21,21,1,0)
The date/time this drug was received into the ordering Narcotic
"^DD",58.81,58.81,21,21,2,0)
Area of Use.
"^DD",58.81,58.81,21,"DT")
2940523
"^DD",58.81,58.81,22,0)
COMPLETION DATE/TIME^D^^0;19^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,22,3)
Enter the date/time this order was completed.
"^DD",58.81,58.81,22,21,0)
^^2^2^2940915^^^
"^DD",58.81,58.81,22,21,1,0)
The date/time this Controlled Substances Green Sheet (VA FORM 10-2638)
"^DD",58.81,58.81,22,21,2,0)
was reviewed as complete by pharmacy.
"^DD",58.81,58.81,22,"DT")
2920415
"^DD",58.81,58.81,23,0)
FILLED BY^*P200'^VA(200,^1;5^S DIC("S")="I $S($D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,23,3)
Enter the name of the pharmacy employee processing this transaction.
"^DD",58.81,58.81,23,12)
Access granted to technicians holding the appropriate security key.
"^DD",58.81,58.81,23,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.81,58.81,23,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,23,21,1,0)
A pointer to the name of the pharmacy technician processing this
"^DD",58.81,58.81,23,21,2,0)
Controlled Substances transaction.
"^DD",58.81,58.81,23,"DT")
2920530
"^DD",58.81,58.81,24,0)
REQUEST DATE/TIME^D^^1;6^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,24,3)
Enter the request date for this order.
"^DD",58.81,58.81,24,21,0)
^^1^1^2920912^^
"^DD",58.81,58.81,24,21,1,0)
The date/time the Controlled Substances order request was generated.
"^DD",58.81,58.81,24,"DT")
2920501
"^DD",58.81,58.81,25,0)
ORDERED BY^*P200'^VA(200,^1;7^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,25,3)
Enter the person's name requesting this order.
"^DD",58.81,58.81,25,12)
Access granted to nurses and pharmacy personnel holding the appropriate security key.
"^DD",58.81,58.81,25,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.81,58.81,25,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,25,21,1,0)
A pointer to the name of the person requesting this Controlled
"^DD",58.81,58.81,25,21,2,0)
Substances drug.
"^DD",58.81,58.81,25,"DT")
2920628
"^DD",58.81,58.81,25.5,0)
ORDERED BY PHARMACY^*P200'^VA(200,^1.5;1^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,25.5,3)
Enter the person's name requesting this order for nursing.
"^DD",58.81,58.81,25.5,12)
Access granted to pharmacy personnel holding the appropriate security key.
"^DD",58.81,58.81,25.5,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)"
"^DD",58.81,58.81,25.5,21,0)
^^2^2^2931010^
"^DD",58.81,58.81,25.5,21,1,0)
A pointer to the name of the pharmacy employee requesting the Controlled
"^DD",58.81,58.81,25.5,21,2,0)
Substances order for nursing.
"^DD",58.81,58.81,25.5,23,0)
^^1^1^2940923^^
"^DD",58.81,58.81,25.5,23,1,0)
A screened pointer to NEW PERSON file (#200).
"^DD",58.81,58.81,25.5,"DT")
2931010
"^DD",58.81,58.81,26,0)
COMMENTS^58.8126^^2;0
"^DD",58.81,58.81,26,21,0)
^^1^1^2950301^^^^
"^DD",58.81,58.81,26,21,1,0)
Comments concerning this transaction.
"^DD",58.81,58.81,27,0)
QUANTITY RECEIVED^NJ6,0^^1;8^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,27,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,27,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,27,21,1,0)
The actual quantity of the drug received by the ordering NAOU.
"^DD",58.81,58.81,27,"DT")
2920517
"^DD",58.81,58.81,28,0)
DISCREPANCY UNRESOLVED^S^1:YES;0:NO;^1;9^Q
"^DD",58.81,58.81,28,1,0)
^.1^^0
"^DD",58.81,58.81,28,3)
Enter "YES" if a receiving/dispensing discrepancy exists.
"^DD",58.81,58.81,28,21,0)
^^3^3^2921117^^
"^DD",58.81,58.81,28,21,1,0)
If the actual quantity of the drug received is different from the
"^DD",58.81,58.81,28,21,2,0)
actual quantity pharmacy dispensed, then this field is set to "1"
"^DD",58.81,58.81,28,21,3,0)
or "YES".
"^DD",58.81,58.81,28,"DT")
2920629
"^DD",58.81,58.81,29,0)
COMPLETED BY NURSE^*P200'^VA(200,^1;10^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,29,3)
Enter the name of the nurse returning this Green Sheet.
"^DD",58.81,58.81,29,12)
Access granted to nurses holding the appropriate security key.
"^DD",58.81,58.81,29,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.81,58.81,29,21,0)
^^2^2^2940915^^^
"^DD",58.81,58.81,29,21,1,0)
A pointer to the name of the nurse returning the Green Sheet
"^DD",58.81,58.81,29,21,2,0)
(VA FORM 10-2638) to pharmacy.
"^DD",58.81,58.81,29,"DT")
2930527
"^DD",58.81,58.81,29.5,0)
COMP BY NURSE DATE/TIME^D^^1.5;2^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,29.5,3)
Enter the date/time this Green Sheet was completed by nursing.
"^DD",58.81,58.81,29.5,21,0)
^^2^2^2931010^^
"^DD",58.81,58.81,29.5,21,1,0)
The date/time this Green Sheet was completed by nursing and ready for
"^DD",58.81,58.81,29.5,21,2,0)
pharmacy pickup.
"^DD",58.81,58.81,29.5,"DT")
2931010
"^DD",58.81,58.81,29.6,0)
D/T PLACED ON INSP HOLD^D^^1.5;3^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,29.6,3)
Enter the date/time this Green Sheet was placed on hold.
"^DD",58.81,58.81,29.6,21,0)
^^2^2^2931110^
"^DD",58.81,58.81,29.6,21,1,0)
The date/time this Green Sheet was placed on hold for review by the
"^DD",58.81,58.81,29.6,21,2,0)
Controlled Substances Inspector.
"^DD",58.81,58.81,29.6,"DT")
2931110
"^DD",58.81,58.81,29.7,0)
D/T INSP HOLD REMOVED^D^^1.5;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,29.7,3)
Enter the date/time this Green Sheet was removed from hold.
"^DD",58.81,58.81,29.7,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,29.7,21,1,0)
The date/time this Green Sheet was removed from hold by the Controlled
"^DD",58.81,58.81,29.7,21,2,0)
Substances inspector.
"^DD",58.81,58.81,29.7,"DT")
2931110
"^DD",58.81,58.81,29.8,0)
HOLD REMARKS^F^^1.6;1^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,29.8,3)
Answer must be 1-45 characters in length.
"^DD",58.81,58.81,29.8,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,29.8,21,1,0)
This field contains information concerning the Green Sheet being held
"^DD",58.81,58.81,29.8,21,2,0)
for CS inspector's review.
"^DD",58.81,58.81,29.8,"DT")
2940105
"^DD",58.81,58.81,30,0)
RECEIVED BY TECH^*P200'^VA(200,^1;11^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,30,3)
Enter the name of the tech receiving this order.
"^DD",58.81,58.81,30,12)
Access granted to technicians with appropriate security key.
"^DD",58.81,58.81,30,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)"
"^DD",58.81,58.81,30,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,30,21,1,0)
A pointer to the name of the pharmacy technician receiving this
"^DD",58.81,58.81,30,21,2,0)
Controlled Substances drug into the NAOU.
"^DD",58.81,58.81,30,"DT")
2920601
"^DD",58.81,58.81,31,0)
PICK UP DATE/TIME^D^^1;12^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,31,3)
Enter the date/time pharmacy picked up the Green Sheet.
"^DD",58.81,58.81,31,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,31,21,1,0)
The date/time pharmacy picked up the Green Sheet (VA FORM 10-2638)
"^DD",58.81,58.81,31,21,2,0)
from the NAOU.
"^DD",58.81,58.81,31,"DT")
2920531
"^DD",58.81,58.81,32,0)
PICKED UP BY^*P200'^VA(200,^1;13^S DIC("S")="I $S($D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,32,3)
Enter the name of the technician picking up the Green Sheet.
"^DD",58.81,58.81,32,12)
Access granted to technicians picking up Green Sheets.
"^DD",58.81,58.81,32,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.81,58.81,32,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,32,21,1,0)
A pointer to the name of the pharmacy technician picking up the
"^DD",58.81,58.81,32,21,2,0)
Green Sheet (VA FORM 10-2638) from the NAOU.
"^DD",58.81,58.81,32,"DT")
2920531
"^DD",58.81,58.81,33,0)
COMPLETED BY PHARMACIST^*P200'^VA(200,^1;14^S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,33,3)
Enter the name of the pharmacist or tech completing this Green Sheet.
"^DD",58.81,58.81,33,12)
Access granted to the pharmacists or techs holding the appropriate security key.
"^DD",58.81,58.81,33,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RPHARM"",+Y)):1,$D(^XUSEC(""PSJ PHARM TECH"",+Y)):1,1:0)"
"^DD",58.81,58.81,33,21,0)
^^2^2^2940915^^^^
"^DD",58.81,58.81,33,21,1,0)
A pointer to the name of the pharmacist or pharmacy technician completing
"^DD",58.81,58.81,33,21,2,0)
the Green Sheet (VA FORM 10-2638).
"^DD",58.81,58.81,33,"DT")
2930413
"^DD",58.81,58.81,34,0)
DATE/TIME RET TO STOCK^D^^3;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,34,1,0)
^.1
"^DD",58.81,58.81,34,1,1,0)
58.81^ACT4^MUMPS
"^DD",58.81,58.81,34,1,1,1)
D SACT4^PSDUTL1
"^DD",58.81,58.81,34,1,1,2)
D KACT4^PSDUTL1
"^DD",58.81,58.81,34,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,34,1,1,"%D",0)
^^4^4^2941003^^^
"^DD",58.81,58.81,34,1,1,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,34,1,1,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,34,1,1,"%D",3,0)
  
"^DD",58.81,58.81,34,1,1,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",RET TO STK D/T,LOC,DRUG,TYPE,DA)=""
"^DD",58.81,58.81,34,1,1,"DT")
2920613
"^DD",58.81,58.81,34,3)
Enter date/time returned to stock.
"^DD",58.81,58.81,34,21,0)
^^1^1^2920625^^
"^DD",58.81,58.81,34,21,1,0)
The date/time this drug is being returned to stock.
"^DD",58.81,58.81,34,"DT")
2930701
"^DD",58.81,58.81,35,0)
QUANTITY RET TO STOCK^NJ6,0^^3;2^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,35,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,35,21,0)
^^1^1^2920625^^
"^DD",58.81,58.81,35,21,1,0)
The actual quantity of this drug being returned to stock.
"^DD",58.81,58.81,35,"DT")
2920603
"^DD",58.81,58.81,36,0)
REASON RETURNED TO STOCK^F^^3;3^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,36,3)
Enter reason this drug was returned to stock.
"^DD",58.81,58.81,36,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,36,21,1,0)
The reason this drug is being returned to stock.
"^DD",58.81,58.81,36,"DT")
2920604
"^DD",58.81,58.81,37,0)
DATE/TIME TURN IN DESTROY^D^^3;4^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,37,1,0)
^.1
"^DD",58.81,58.81,37,1,1,0)
58.81^ACT7^MUMPS
"^DD",58.81,58.81,37,1,1,1)
D SACT7^PSDUTL3
"^DD",58.81,58.81,37,1,1,2)
D KACT7^PSDUTL3
"^DD",58.81,58.81,37,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,37,1,1,"%D",0)
^^3^3^2941003^^^^
"^DD",58.81,58.81,37,1,1,"%D",1,0)
This cross-reference is used in compiling the cost reports.
"^DD",58.81,58.81,37,1,1,"%D",2,0)
 
"^DD",58.81,58.81,37,1,1,"%D",3,0)
The cross-reference reads ^PSD(58.81,"ACT",D/T TURN IN DEST,LOC,DRUG,DA)=""
"^DD",58.81,58.81,37,1,1,"DT")
2940118
"^DD",58.81,58.81,37,3)
Enter the date/time this drug was turned in for destruction.
"^DD",58.81,58.81,37,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,37,21,1,0)
The date/time this drug is being turned in for destruction.
"^DD",58.81,58.81,37,"DT")
2930701
"^DD",58.81,58.81,38,0)
QUANTITY TURN IN FOR DESTROY^NJ9,2^^3;5^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,38,3)
Type a Number between 0 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,38,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,38,21,1,0)
The actual quantity of this drug being turned in for destruction.
"^DD",58.81,58.81,38,"DT")
2940518
"^DD",58.81,58.81,39,0)
REASON TURN IN FOR DESTROY^F^^3;6^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,39,3)
Enter reason this drug was turned in for destruction.
"^DD",58.81,58.81,39,21,0)
^^1^1^2950927^^
"^DD",58.81,58.81,39,21,1,0)
The reason this drug is being turned in for destruction.
"^DD",58.81,58.81,39,"DT")
2920604
"^DD",58.81,58.81,40,0)
REQUEST #^NJ8,0^^0;20^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,40,3)
Type a Number between 1 and 99999999, 0 Decimal Digits
"^DD",58.81,58.81,40,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,40,21,1,0)
The order request number from the ordering NAOU.
"^DD",58.81,58.81,40,"DT")
2920606
"^DD",58.81,58.81,41,0)
BALANCE FWD RET/STK^NJ9,2^^3;7^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,41,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,41,21,0)
^^2^2^2921117^^
"^DD",58.81,58.81,41,21,1,0)
The inventory balance forward for this drug being returned to stock.
"^DD",58.81,58.81,41,21,2,0)
This balance is used in listing pharmacy's "Daily Activity Log".
"^DD",58.81,58.81,41,"DT")
2930428
"^DD",58.81,58.81,47,0)
DEST HOLDING #^P58.86'^PSD(58.86,^3;8^Q
"^DD",58.81,58.81,47,3)
Enter the destruction holding file # for this transaction.
"^DD",58.81,58.81,47,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,47,21,1,0)
A pointer to the destruction number for this drug being held for
"^DD",58.81,58.81,47,21,2,0)
destruction.
"^DD",58.81,58.81,47,"DT")
2920607
"^DD",58.81,58.81,48,0)
EDIT VERIFIED ORDER DATE/TIME^D^^4;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,48,1,0)
^.1
"^DD",58.81,58.81,48,1,1,0)
58.81^ACT5^MUMPS
"^DD",58.81,58.81,48,1,1,1)
D SACT5^PSDUTL1
"^DD",58.81,58.81,48,1,1,2)
D KACT5^PSDUTL1
"^DD",58.81,58.81,48,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,48,1,1,"%D",0)
^^4^4^2941003^^^^
"^DD",58.81,58.81,48,1,1,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,48,1,1,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,48,1,1,"%D",3,0)
  
"^DD",58.81,58.81,48,1,1,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",EDIT D/T,LOCATION,DRUG,TYPE,DA)=""
"^DD",58.81,58.81,48,1,1,"DT")
2920613
"^DD",58.81,58.81,48,3)
Enter date/time this order was verified.
"^DD",58.81,58.81,48,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,48,21,1,0)
The date/time this verified order is being edited.
"^DD",58.81,58.81,48,"DT")
2930701
"^DD",58.81,58.81,49,0)
PHARMACIST EDITING^*P200'^VA(200,^4;2^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,49,3)
Enter the name of the pharmacist editing this verified order.
"^DD",58.81,58.81,49,12)
Access granted to pharmacists holding the appropriate security key.
"^DD",58.81,58.81,49,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.81,58.81,49,21,0)
^^1^1^2920625^^
"^DD",58.81,58.81,49,21,1,0)
A pointer to name of the pharmacist editing this verified order.
"^DD",58.81,58.81,49,"DT")
2920610
"^DD",58.81,58.81,50,0)
NEW QUANTITY^NJ6,0^^4;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,50,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,50,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,50,21,1,0)
The actual quantity of this drug being dispensed, if quantity is being
"^DD",58.81,58.81,50,21,2,0)
edited.
"^DD",58.81,58.81,50,"DT")
2920610
"^DD",58.81,58.81,51,0)
ADJUSTED BY QUANTITY^NJ6,0^^4;4^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,51,3)
Type a Number between -999999 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,51,21,0)
^^3^3^2920625^
"^DD",58.81,58.81,51,21,1,0)
The difference in the original quantity dispensed and the edited
"^DD",58.81,58.81,51,21,2,0)
quantity dispensed.  The inventory balance will be adjusted by this
"^DD",58.81,58.81,51,21,3,0)
amount.  This quantity may be a negative number.
"^DD",58.81,58.81,51,"DT")
2920610
"^DD",58.81,58.81,52,0)
EDIT MFG/LOT/EXP.DATE^S^1:Y;0:N;^4;5^Q
"^DD",58.81,58.81,52,3)
Answer "YES" if manufacturer, lot #, or exp. date is edited.
"^DD",58.81,58.81,52,21,0)
^^2^2^2940923^^^^
"^DD",58.81,58.81,52,21,1,0)
This field is set to "1" or "YES" if  the manufacturer, lot #,
"^DD",58.81,58.81,52,21,2,0)
or expiration date is being edited on this verified order.
"^DD",58.81,58.81,52,"DT")
2920610
"^DD",58.81,58.81,53,0)
REASON EDITED^F^^4;6^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,53,3)
Answer must be 1-45 characters in length.
"^DD",58.81,58.81,53,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,53,21,1,0)
The reason this verified order is being edited.
"^DD",58.81,58.81,53,"DT")
2920610
"^DD",58.81,58.81,54,0)
BAL FWD EDIT VERIFIED ORDER^NJ6,0^^4;7^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,54,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,54,21,0)
^^3^3^2921106^^^
"^DD",58.81,58.81,54,21,1,0)
The inventory balance forward for this drug at the time this verified
"^DD",58.81,58.81,54,21,2,0)
order is being edited.  This balance is used in listing pharmacy's
"^DD",58.81,58.81,54,21,3,0)
"Daily Activity Log".
"^DD",58.81,58.81,54,"DT")
2920610
"^DD",58.81,58.81,55,0)
CANCEL VERIFIED ORD DATE/TIME^D^^5;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,55,1,0)
^.1
"^DD",58.81,58.81,55,1,1,0)
58.81^ACT6^MUMPS
"^DD",58.81,58.81,55,1,1,1)
D SACT6^PSDUTL1
"^DD",58.81,58.81,55,1,1,2)
D KACT6^PSDUTL1
"^DD",58.81,58.81,55,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,55,1,1,"%D",0)
^^4^4^2941003^^^
"^DD",58.81,58.81,55,1,1,"%D",1,0)
This cross-reference is used in compiling data to print the pharmacy
"^DD",58.81,58.81,55,1,1,"%D",2,0)
VA FORM 10-2320.
"^DD",58.81,58.81,55,1,1,"%D",3,0)
  
"^DD",58.81,58.81,55,1,1,"%D",4,0)
The cross-reference is ^PSD(58.81,"ACT",CANCEL D/T,LOC,DRUG,TYPE,DA)=""
"^DD",58.81,58.81,55,1,1,"DT")
2920613
"^DD",58.81,58.81,55,3)
Enter the date/time this verified order was cancelled.
"^DD",58.81,58.81,55,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,55,21,1,0)
The date/time this verified order is being cancelled.
"^DD",58.81,58.81,55,"DT")
2930701
"^DD",58.81,58.81,56,0)
PHARMACIST CANCELLING^*P200'^VA(200,^5;2^S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,56,3)
Enter the name of the pharmacist holding the appropriate security key.
"^DD",58.81,58.81,56,12)
Access granted to pharmacists holding the appropriate security key.
"^DD",58.81,58.81,56,12.1)
S DIC("S")="I $D(^XUSEC(""PSJ RPHARM"",+Y))"
"^DD",58.81,58.81,56,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,56,21,1,0)
A pointer to the name of the pharmacist cancelling this verified
"^DD",58.81,58.81,56,21,2,0)
order.
"^DD",58.81,58.81,56,"DT")
2920610
"^DD",58.81,58.81,57,0)
ADJUSTMENT QUANTITY^NJ6,0^^5;3^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,57,3)
Type a Number between -999999 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,57,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,57,21,1,0)
The actual quantity of the drug for this cancelled order.  The drug
"^DD",58.81,58.81,57,21,2,0)
inventory balance will be increased by this adjustment quantity.
"^DD",58.81,58.81,57,"DT")
2920610
"^DD",58.81,58.81,58,0)
REASON CANCELLED^F^^5;4^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,58,3)
Answer must be 1-45 characters in length.
"^DD",58.81,58.81,58,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,58,21,1,0)
The reason this verified order is being cancelled.
"^DD",58.81,58.81,58,"DT")
2920610
"^DD",58.81,58.81,59,0)
BAL FWD CANCEL VERIFIED ORD^NJ6,0^^5;5^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,59,3)
Type a Number between 0 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,59,21,0)
^^3^3^2921117^^^
"^DD",58.81,58.81,59,21,1,0)
The inventory balance forward for this drug at the time this
"^DD",58.81,58.81,59,21,2,0)
verified order is being cancelled.  This balance is used in listing
"^DD",58.81,58.81,59,21,3,0)
pharmacy's "Daily Activity Log".
"^DD",58.81,58.81,59,"DT")
2920610
"^DD",58.81,58.81,60,0)
RX #^P52'^PSRX(^6;1^Q
"^DD",58.81,58.81,60,1,0)
^.1
"^DD",58.81,58.81,60,1,1,0)
58.81^AOP
"^DD",58.81,58.81,60,1,1,1)
S ^PSD(58.81,"AOP",$E(X,1,30),DA)=""
"^DD",58.81,58.81,60,1,1,2)
K ^PSD(58.81,"AOP",$E(X,1,30),DA)
"^DD",58.81,58.81,60,1,1,3)
DO NOT DELETE.
"^DD",58.81,58.81,60,1,1,"DT")
2920824
"^DD",58.81,58.81,60,3)
Enter prescription number for this CS transaction.
"^DD",58.81,58.81,60,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,60,21,1,0)
A pointer to the outpatient prescription number.
"^DD",58.81,58.81,60,"DT")
2920824
"^DD",58.81,58.81,61,0)
REFILL #^NJ3,0^^6;2^K:+X'=X!(X>100)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,61,3)
Type a Number between 1 and 100, 0 Decimal Digits
"^DD",58.81,58.81,61,21,0)
^^2^2^2920625^^
"^DD",58.81,58.81,61,21,1,0)
If this prescription is a refill, this field will contain the refill
"^DD",58.81,58.81,61,21,2,0)
number.
"^DD",58.81,58.81,61,"DT")
2920616
"^DD",58.81,58.81,62,0)
PRESCRIPTION DATE^D^^6;3^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,62,3)
Enter the date/time this prescription was filled.
"^DD",58.81,58.81,62,21,0)
^^1^1^2920625^
"^DD",58.81,58.81,62,21,1,0)
The fill date for this prescription.
"^DD",58.81,58.81,62,"DT")
2920616
"^DD",58.81,58.81,63,0)
PARTIAL #^NJ3,0^^6;4^K:+X'=X!(X>100)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,63,3)
Type a Number between 1 and 100, 0 Decimal Digits
"^DD",58.81,58.81,63,21,0)
^^2^2^2920625^
"^DD",58.81,58.81,63,21,1,0)
If this prescription is a partial, this field contains the partial
"^DD",58.81,58.81,63,21,2,0)
number.
"^DD",58.81,58.81,63,"DT")
2920616
"^DD",58.81,58.81,63.5,0)
OUTPATIENT RX #^F^^6;5^K:$L(X)>11!($L(X)<1) X
"^DD",58.81,58.81,63.5,3)
Answer must be 1-11 characters in length.
"^DD",58.81,58.81,63.5,21,0)
^^1^1^2930507^
"^DD",58.81,58.81,63.5,21,1,0)
This is the external form of the Outpatient prescription number.
"^DD",58.81,58.81,63.5,"DT")
2930507
"^DD",58.81,58.81,63.6,0)
RELEASING PHARMACIST^P200'^VA(200,^6;6^Q
"^DD",58.81,58.81,63.6,3)
Enter the pharmacist processing the Outpatient release.
"^DD",58.81,58.81,63.6,21,0)
^^3^3^2940915^^
"^DD",58.81,58.81,63.6,21,1,0)
This field is used to store the pharmacist responsible for the release
"^DD",58.81,58.81,63.6,21,2,0)
of an Outpatient prescription in case it is a different person than the
"^DD",58.81,58.81,63.6,21,3,0)
transactor.
"^DD",58.81,58.81,63.6,23,0)
^^2^2^2940915^^
"^DD",58.81,58.81,63.6,23,1,0)
This field records the releasing pharmacist in case this is a different
"^DD",58.81,58.81,63.6,23,2,0)
person than the transactor.
"^DD",58.81,58.81,63.6,"DT")
2940727
"^DD",58.81,58.81,64,0)
TRANSFER FROM NAOU DATE/TIME^D^^7;1^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,64,1,0)
^.1
"^DD",58.81,58.81,64,1,1,0)
58.81^ATRN
"^DD",58.81,58.81,64,1,1,1)
S ^PSD(58.81,"ATRN",$E(X,1,30),DA)=""
"^DD",58.81,58.81,64,1,1,2)
K ^PSD(58.81,"ATRN",$E(X,1,30),DA)
"^DD",58.81,58.81,64,1,1,3)
DO NOT DELETE.
"^DD",58.81,58.81,64,1,1,"DT")
2920804
"^DD",58.81,58.81,64,3)
Enter the date/time the drug was transferred from this NAOU.
"^DD",58.81,58.81,64,21,0)
^^2^2^2920912^^^
"^DD",58.81,58.81,64,21,1,0)
The date/time the Controlled Substances drug was transferred from this
"^DD",58.81,58.81,64,21,2,0)
NAOU to another NAOU.
"^DD",58.81,58.81,64,"DT")
2920804
"^DD",58.81,58.81,65,0)
TRANSFER FROM NAOU NURSE^*P200'^VA(200,^7;2^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,65,3)
Enter the name of the nurse transferring the drug from this NAOU.
"^DD",58.81,58.81,65,12)
Access granted to nurses holding the appropriate security key.
"^DD",58.81,58.81,65,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,$D(^XUSEC(""PSJ RPHARM"",+Y)):1,1:0)"
"^DD",58.81,58.81,65,21,0)
^^2^2^2931014^^^
"^DD",58.81,58.81,65,21,1,0)
A pointer to the name of the nurse or pharmacist transferring the
"^DD",58.81,58.81,65,21,2,0)
Controlled Substances drug from this NAOU to another NAOU.
"^DD",58.81,58.81,65,"DT")
2931014
"^DD",58.81,58.81,66,0)
TRANSFER TO NAOU^*P58.8'^PSD(58.8,^7;3^S DIC("S")="I $P(^(0),""^"",2)=""N""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,66,3)
Enter the NAOU receiving the transferred drug.
"^DD",58.81,58.81,66,12)
Allows selection of a Satellite vault or Narcotic location.
"^DD",58.81,58.81,66,12.1)
S DIC("S")="I $P(^(0),""^"",2)=""N"""
"^DD",58.81,58.81,66,21,0)
^^1^1^2920912^^^
"^DD",58.81,58.81,66,21,1,0)
The NAOU receiving this Controlled Substances drug from another NAOU.
"^DD",58.81,58.81,66,"DT")
2930527
"^DD",58.81,58.81,67,0)
TRANSFER TO NAOU DATE/TIME^D^^7;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,67,3)
Enter the date/time the drug was transferred to this NAOU.
"^DD",58.81,58.81,67,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,67,21,1,0)
The date/time the Controlled Substances drug was transferred to this
"^DD",58.81,58.81,67,21,2,0)
NAOU from another NAOU.
"^DD",58.81,58.81,67,"DT")
2920804
"^DD",58.81,58.81,68,0)
TRANSFER TO NAOU NURSE^*P200'^VA(200,^7;5^S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,68,3)
Enter the name of the nurse receiving this transferred drug.
"^DD",58.81,58.81,68,12)
Access granted to nurses holding the appropriate security key.
"^DD",58.81,58.81,68,12.1)
S DIC("S")="I $S($D(^XUSEC(""PSJ RNURSE"",+Y)):1,$D(^XUSEC(""PSD NURSE"",+Y)):1,1:0)"
"^DD",58.81,58.81,68,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,68,21,1,0)
A pointer to the name of the nurse receiving this transferred Controlled
"^DD",58.81,58.81,68,21,2,0)
Substances drug from another NAOU.
"^DD",58.81,58.81,68,"DT")
2930527
"^DD",58.81,58.81,69,0)
PREVIOUS TRANSACTION #^*P58.81'^PSD(58.81,^7;6^S DIC("S")="I $P(^(0),""^"",11)=10" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.81,58.81,69,1,0)
^.1
"^DD",58.81,58.81,69,1,1,0)
58.81^AE
"^DD",58.81,58.81,69,1,1,1)
S ^PSD(58.81,"AE",$E(X,1,30),DA)=""
"^DD",58.81,58.81,69,1,1,2)
K ^PSD(58.81,"AE",$E(X,1,30),DA)
"^DD",58.81,58.81,69,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,69,1,1,"DT")
2920804
"^DD",58.81,58.81,69,3)
Enter the previous transferred from NAOU transaction number.
"^DD",58.81,58.81,69,12)
Allows selection of transactions transferred from an NAOU.
"^DD",58.81,58.81,69,12.1)
S DIC("S")="I $P(^(0),""^"",11)=10"
"^DD",58.81,58.81,69,21,0)
^^2^2^2920915^^
"^DD",58.81,58.81,69,21,1,0)
The transaction number of the transferred from NAOU Controlled Substances
"^DD",58.81,58.81,69,21,2,0)
drug.  This is the previous transaction number for this drug.
"^DD",58.81,58.81,69,"DT")
2920804
"^DD",58.81,58.81,70,0)
QUANTITY TRANSFERRED^NJ6,0^^7;7^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,70,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,70,21,0)
^^2^2^2920912^^
"^DD",58.81,58.81,70,21,1,0)
The quantity of this Controlled Substances drug being transferred
"^DD",58.81,58.81,70,21,2,0)
from an NAOU to another NAOU.
"^DD",58.81,58.81,70,"DT")
2920805
"^DD",58.81,58.81,71,0)
PRIME VENDOR INVOICE^F^^8;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",58.81,58.81,71,.1)
Prime Vendor Invoice
"^DD",58.81,58.81,71,1,0)
^.1
"^DD",58.81,58.81,71,1,1,0)
58.81^PV^MUMPS
"^DD",58.81,58.81,71,1,1,1)
I $P($G(^PSD(58.81,DA,8)),U,2)="" S ^PSD(58.81,"PV",X,DA)=""
"^DD",58.81,58.81,71,1,1,2)
I $P($G(^PSD(58.81,DA,8)),U,2)="" K ^PSD(58.81,"PV",X,DA)
"^DD",58.81,58.81,71,1,1,3)
DO NOT DELETE!
"^DD",58.81,58.81,71,1,1,"%D",0)
^^4^4^2970922^^
"^DD",58.81,58.81,71,1,1,"%D",1,0)
This cross-reference is used to located the transactions for specific
"^DD",58.81,58.81,71,1,1,"%D",2,0)
Prime Vendor invoices.
"^DD",58.81,58.81,71,1,1,"%D",3,0)
 
"^DD",58.81,58.81,71,1,1,"%D",4,0)
^PSD(58.81,"PV",Prime Vendor Invoice#,Transaction internal entry#)=""
"^DD",58.81,58.81,71,1,1,"DT")
2970507
"^DD",58.81,58.81,71,3)
Answer must be 1-30 characters in length.
"^DD",58.81,58.81,71,21,0)
^^5^5^2970922^
"^DD",58.81,58.81,71,21,1,0)
To allow the entering of a Prime Vendor Invoice number for a receipt.
"^DD",58.81,58.81,71,21,2,0)
The Integrated Funds Distribution, Control Point Activity, Accounting and
"^DD",58.81,58.81,71,21,3,0)
Procurement (IFCAP) Purchase Order number may be used all month and there
"^DD",58.81,58.81,71,21,4,0)
may not be a corresponding IFCAP transaction number for each Prime Vendor
"^DD",58.81,58.81,71,21,5,0)
receipt.
"^DD",58.81,58.81,71,23,0)
^^1^1^2970922^^
"^DD",58.81,58.81,71,23,1,0)
To track Prime Vendor receipts in the absence of a transaction number.
"^DD",58.81,58.81,71,"DT")
2970922
"^DD",58.81,58.81,72,0)
REFERRED REASON^F^^1;15^K:$L(X)>45!($L(X)<1) X
"^DD",58.81,58.81,72,3)
Answer must be 1-45 characters in length.
"^DD",58.81,58.81,72,21,0)
^^2^2^2920825^
"^DD",58.81,58.81,72,21,1,0)
When a completed Green Sheet has been referred to a pharmacy supervisor
"^DD",58.81,58.81,72,21,2,0)
for review, this field may contain comments about the reason.
"^DD",58.81,58.81,72,"DT")
2920824
"^DD",58.81,58.81,73,0)
PATIENT^P2'^DPT(^9;1^Q
"^DD",58.81,58.81,73,3)
Enter the name of the patient receiving this medication.
"^DD",58.81,58.81,73,21,0)
^^2^2^2930722^
"^DD",58.81,58.81,73,21,1,0)
This field contains a pointer to the name of the patient receiving
"^DD",58.81,58.81,73,21,2,0)
this Controlled Substances medication.
"^DD",58.81,58.81,73,23,0)
^^1^1^2930722^
"^DD",58.81,58.81,73,23,1,0)
Pointer to the PATIENT file #2.
"^DD",58.81,58.81,73,"DT")
2930722
"^DD",58.81,58.81,73.5,0)
FROM PATIENT ID LIST?^S^1:YES;0:NO;^9.5;1^Q
"^DD",58.81,58.81,73.5,3)
Is this Patient ID from the Patient ID list?
"^DD",58.81,58.81,73.5,21,0)
^^2^2^2940923^^
"^DD",58.81,58.81,73.5,21,1,0)
This field will be "YES" when the patient ID was picked up from the patient
"^DD",58.81,58.81,73.5,21,2,0)
ID list.
"^DD",58.81,58.81,73.5,"DT")
2931010
"^DD",58.81,58.81,74,0)
NURSE ID^P200'^VA(200,^9;2^Q
"^DD",58.81,58.81,74,3)
Enter the name of the nurse dispensing this medication.
"^DD",58.81,58.81,74,21,0)
^^2^2^2930722^^^
"^DD",58.81,58.81,74,21,1,0)
This field contains a pointer to the name of the nurse dispensing
"^DD",58.81,58.81,74,21,2,0)
this Controlled Substances medication.
"^DD",58.81,58.81,74,23,0)
^^1^1^2940923^^^^
"^DD",58.81,58.81,74,23,1,0)
Pointer to the NEW PERSON file (#200).
"^DD",58.81,58.81,74,"DT")
2930722
"^DD",58.81,58.81,75,0)
ORIGINAL COUNT^NJ9,2^^9;3^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,75,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,75,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,75,21,1,0)
This field contains the original count or balance of this drug when
"^DD",58.81,58.81,75,21,2,0)
loaded into the TRAKKER for medication dispensing on the NAOU.
"^DD",58.81,58.81,75,"DT")
2930722
"^DD",58.81,58.81,76,0)
WASTED QUANTITY^NJ9,2^^9;4^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,76,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,76,21,0)
^^2^2^2930722^
"^DD",58.81,58.81,76,21,1,0)
This field contains the quantity of this Controlled Substances drug
"^DD",58.81,58.81,76,21,2,0)
that was wasted during dispensing at the NAOU.
"^DD",58.81,58.81,76,"DT")
2930722
"^DD",58.81,58.81,77,0)
LIQUID AMOUNT^NJ6,0^^9;5^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."1N.N) X
"^DD",58.81,58.81,77,3)
Type a Number between -999999 and 999999, 0 Decimal Digits
"^DD",58.81,58.81,77,21,0)
^^2^2^2930722^
"^DD",58.81,58.81,77,21,1,0)
This field contains the liquid quantity of the drug dispensed at the
"^DD",58.81,58.81,77,21,2,0)
NAOU.
"^DD",58.81,58.81,77,"DT")
2930722
"^DD",58.81,58.81,78,0)
SECOND NURSE ID^P200'^VA(200,^9;6^Q
"^DD",58.81,58.81,78,3)
Enter the name of the nurse witnessing this transaction.
"^DD",58.81,58.81,78,21,0)
^^2^2^2930722^
"^DD",58.81,58.81,78,21,1,0)
This field contains a pointer to the name of the nurse witnessing this
"^DD",58.81,58.81,78,21,2,0)
Controlled Substances transaction.
"^DD",58.81,58.81,78,23,0)
^^1^1^2940923^^
"^DD",58.81,58.81,78,23,1,0)
Pointer to the NEW PERSON file (#200).
"^DD",58.81,58.81,78,"DT")
2930722
"^DD",58.81,58.81,79,0)
CORRECT COUNT^NJ9,2^^9;7^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."3N.N) X
"^DD",58.81,58.81,79,3)
Type a Number between -999999 and 999999, 2 Decimal Digits
"^DD",58.81,58.81,79,21,0)
^^2^2^2940923^^
"^DD",58.81,58.81,79,21,1,0)
This field contains the correct count or balance for a Controlled
"^DD",58.81,58.81,79,21,2,0)
Substances drug on an NAOU.
"^DD",58.81,58.81,79,"DT")
2930722
"^DD",58.81,58.81,80,0)
PHARMACIST ID^P200'^VA(200,^9;8^Q
"^DD",58.81,58.81,80,3)
Enter the name of the pharmacist inventorying this CS drug.
"^DD",58.81,58.81,80,21,0)
^^2^2^2930930^
"^DD",58.81,58.81,80,21,1,0)
This field contains a pointer to name of the pharmacist inventorying
"^DD",58.81,58.81,80,21,2,0)
this Controlled Substances drug.
"^DD",58.81,58.81,80,23,0)
^^1^1^2940923^^
"^DD",58.81,58.81,80,23,1,0)
Pointer to the NEW PERSON file (#200).
"^DD",58.81,58.81,80,"DT")
2930930
"^DD",58.81,58.81,81,0)
SECOND PHARMACIST ID^P200'^VA(200,^9;9^Q
"^DD",58.81,58.81,81,3)
Enter the name of the pharmacist witnessing this transaction.
"^DD",58.81,58.81,81,21,0)
^^2^2^2930930^
"^DD",58.81,58.81,81,21,1,0)
This field contains a pointer to the name of the pharmacist
"^DD",58.81,58.81,81,21,2,0)
witnessing this Controlled Substances transaction.
"^DD",58.81,58.81,81,23,0)
^^1^1^2940923^^
"^DD",58.81,58.81,81,23,1,0)
Pointer to the NEW PERSON file (#200).
"^DD",58.81,58.81,81,"DT")
2930930
"^DD",58.81,58.81,82,0)
ACTUAL DATE/TIME^D^^9;10^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,82,3)
Enter actual date/time of this transaction.
"^DD",58.81,58.81,82,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,82,21,1,0)
This field contains the actual date/time this transaction was performed
"^DD",58.81,58.81,82,21,2,0)
using the barcode TRAKKER.
"^DD",58.81,58.81,82,"DT")
2930930
"^DD",58.81,58.81,83,0)
CS INSPECTOR^P200'^VA(200,^9;11^Q
"^DD",58.81,58.81,83,3)
Enter the name of the CS inspector performing this inventory.
"^DD",58.81,58.81,83,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,83,21,1,0)
This option contains a pointer to the name of the Controlled
"^DD",58.81,58.81,83,21,2,0)
Substances inspector inventorying this CS drug.
"^DD",58.81,58.81,83,"DT")
2931109
"^DD",58.81,58.81,84,0)
SECOND CS INSPECTOR^P200'^VA(200,^9;12^Q
"^DD",58.81,58.81,84,3)
Enter the name of the CS inspector witnessing this inventory.
"^DD",58.81,58.81,84,21,0)
^^2^2^2940915^^
"^DD",58.81,58.81,84,21,1,0)
This field contains a pointer to the name of the Controlled
"^DD",58.81,58.81,84,21,2,0)
Substances inspector witnessing the inventory of this CS drug.
"^DD",58.81,58.81,84,"DT")
2931109
"^DD",58.81,58.81,85,0)
EMERGENCY^S^1:YES;0:NO;^CS;6^Q
"^DD",58.81,58.81,85,1,0)
^.1
"^DD",58.81,58.81,85,1,1,0)
58.81^AEM1^MUMPS
"^DD",58.81,58.81,85,1,1,1)
D SAEM1^PSDUTL5
"^DD",58.81,58.81,85,1,1,2)
D KAEM1^PSDUTL5
"^DD",58.81,58.81,85,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,85,1,1,"%D",0)
^^3^3^2950216^^
"^DD",58.81,58.81,85,1,1,"%D",1,0)
This cross-reference is used to track emergency orders.
"^DD",58.81,58.81,85,1,1,"%D",2,0)
 
"^DD",58.81,58.81,85,1,1,"%D",3,0)
The cross-reference is ^PSD(58.81,"AEM",DATE/TIME,LOCATION,DRUG,DA)="".
"^DD",58.81,58.81,85,1,1,"DT")
2950216
"^DD",58.81,58.81,85,3)
Anser "YES" if this is an emergency order.
"^DD",58.81,58.81,85,21,0)
^^2^2^2950214^
"^DD",58.81,58.81,85,21,1,0)
A "YES" entry in this field will cause an order to print on the pharmacy
"^DD",58.81,58.81,85,21,2,0)
emergency order printer and allow for expedited processing.
"^DD",58.81,58.81,85,23,0)
^^1^1^2950214^
"^DD",58.81,58.81,85,23,1,0)
This field is used to flag orders for expedited processing.
"^DD",58.81,58.81,85,"DT")
2950216
"^DD",58.81,58.81,100,0)
CS TRANSACTION^S^1:YES;^CS;1^Q
"^DD",58.81,58.81,100,3)
Is this a Controlled Substances transaction?
"^DD",58.81,58.81,100,21,0)
^^3^3^2921117^^^
"^DD",58.81,58.81,100,21,1,0)
This field will be set to "1" or "YES" if this is a Controlled
"^DD",58.81,58.81,100,21,2,0)
Substances package transaction.  This CS flag will be used when
"^DD",58.81,58.81,100,21,3,0)
purging data within this file.
"^DD",58.81,58.81,100,"DT")
2920416
"^DD",58.81,58.81,101,0)
PRINTED 2320^S^1:YES;0:NO;^CS;2^Q
"^DD",58.81,58.81,101,3)
Enter "1" or "Y" if this transaction has been printed.
"^DD",58.81,58.81,101,21,0)
^^2^2^2940915^^^
"^DD",58.81,58.81,101,21,1,0)
This field is set to "1" or "YES" when this transaction is printed
"^DD",58.81,58.81,101,21,2,0)
on pharmacy's VA FORM 10-2320 for this drug.
"^DD",58.81,58.81,101,"DT")
2920504
"^DD",58.81,58.81,102,0)
PRINTED 2321^D^^CS;3^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,102,1,0)
^.1
"^DD",58.81,58.81,102,1,1,0)
58.81^AC
"^DD",58.81,58.81,102,1,1,1)
S ^PSD(58.81,"AC",$E(X,1,30),DA)=""
"^DD",58.81,58.81,102,1,1,2)
K ^PSD(58.81,"AC",$E(X,1,30),DA)
"^DD",58.81,58.81,102,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,102,1,1,"DT")
2920504
"^DD",58.81,58.81,102,3)
Enter date or date/time this transaction was printed in lieu of the form 2321.
"^DD",58.81,58.81,102,21,0)
^^6^6^2940915^^^^
"^DD",58.81,58.81,102,21,1,0)
This field is set to "1" or "YES" when this transaction is printed
"^DD",58.81,58.81,102,21,2,0)
on the dispensing/receiving report (in lieu of VA FORM 10-2321).
"^DD",58.81,58.81,102,21,3,0)
This flag is used in printing this transaction only once on the
"^DD",58.81,58.81,102,21,4,0)
dispensing/receiving report.  A reprint option is provided in
"^DD",58.81,58.81,102,21,5,0)
the Controlled Substances module for additional copies to be
"^DD",58.81,58.81,102,21,6,0)
printed.
"^DD",58.81,58.81,102,"DT")
2920504
"^DD",58.81,58.81,103,0)
PRINTED 2638^S^1:YES;0:NO;^CS;4^Q
"^DD",58.81,58.81,103,1,0)
^.1
"^DD",58.81,58.81,103,1,1,0)
58.81^AH
"^DD",58.81,58.81,103,1,1,1)
S ^PSD(58.81,"AH",$E(X,1,30),DA)=""
"^DD",58.81,58.81,103,1,1,2)
K ^PSD(58.81,"AH",$E(X,1,30),DA)
"^DD",58.81,58.81,103,1,1,"DT")
2920524
"^DD",58.81,58.81,103,3)
Enter "1" or "YES" if the FORM 10-2638 has been printed for this transaction.
"^DD",58.81,58.81,103,21,0)
^^5^5^2940915^^^^
"^DD",58.81,58.81,103,21,1,0)
This field is set to "1" or "YES" when a Green Sheet (VA FORM 10-
"^DD",58.81,58.81,103,21,2,0)
2638) is printed for this Controlled Substances order.  This flag
"^DD",58.81,58.81,103,21,3,0)
is used in printing this transaction only once.  A reprint option
"^DD",58.81,58.81,103,21,4,0)
is provided in the Controlled Substances module for additional
"^DD",58.81,58.81,103,21,5,0)
copies to be printed.
"^DD",58.81,58.81,103,"DT")
2920524
"^DD",58.81,58.81,104,0)
PRINTED LABEL^D^^CS;5^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",58.81,58.81,104,1,0)
^.1
"^DD",58.81,58.81,104,1,1,0)
58.81^AL
"^DD",58.81,58.81,104,1,1,1)
S ^PSD(58.81,"AL",$E(X,1,30),DA)=""
"^DD",58.81,58.81,104,1,1,2)
K ^PSD(58.81,"AL",$E(X,1,30),DA)
"^DD",58.81,58.81,104,1,1,3)
DO NOT DELETE
"^DD",58.81,58.81,104,1,1,"DT")
2930829
"^DD",58.81,58.81,104,3)
Enter the date or date/time this transaction label was printed.
"^DD",58.81,58.81,104,21,0)
^^4^4^2940310^^
"^DD",58.81,58.81,104,21,1,0)
This field is set to the date/time when the label for this transaction
"^DD",58.81,58.81,104,21,2,0)
is printed.  This flag is used in printing labels only once for this
"^DD",58.81,58.81,104,21,3,0)
transaction.  A reprint label option is provided in the Controlled
"^DD",58.81,58.81,104,21,4,0)
Substances module for additional labels to be printed.
"^DD",58.81,58.81,104,"DT")
2930829
"^DD",58.81,58.81,105,0)
SPECIALTY^P42.4'^DIC(42.4,^9;13^Q
"^DD",58.81,58.81,105,3)
Enter specialty for patient at time dose dispensed.
"^DD",58.81,58.81,105,21,0)
^^2^2^2950803^
"^DD",58.81,58.81,105,21,1,0)
For CDR reporting the specialty for the patient is stored at the
"^DD",58.81,58.81,105,21,2,0)
time each dose is dispensed.
"^DD",58.81,58.81,105,23,0)
^^1^1^2950803^
"^DD",58.81,58.81,105,23,1,0)
For CDR reporting a call is made to INP^VADPT to get specialty.
"^DD",58.81,58.81,105,"DT")
2950803
"^DD",58.81,58.81,106,0)
PRIME VENDOR ORDER NUMBER^F^^8;2^K:$L(X)>22!($L(X)<1) X
"^DD",58.81,58.81,106,.1)
Prime Vendor Order Number
"^DD",58.81,58.81,106,3)
Enter the prime vendor's order number if the drug is not marked as a controlled substance.
"^DD",58.81,58.81,106,21,0)
^^3^3^2970717^
"^DD",58.81,58.81,106,21,1,0)
The PRIME VENDOR ORDER NUMBER field contains the order number on which
"^DD",58.81,58.81,106,21,2,0)
the drugs were purchased if the drug is not marked as a controlled
"^DD",58.81,58.81,106,21,3,0)
substance.
"^DD",58.81,58.81,106,"DT")
2970717
"^DD",58.81,58.8126,0)
COMMENTS SUB-FIELD^^.01^1
"^DD",58.81,58.8126,0,"DT")
2920511
"^DD",58.81,58.8126,0,"NM","COMMENTS")

"^DD",58.81,58.8126,0,"UP")
58.81
"^DD",58.81,58.8126,.01,0)
COMMENTS^W^^0;1^Q
"^DD",58.81,58.8126,.01,3)
Enter your comments for this transaction.
"^DD",58.81,58.8126,.01,21,0)
^^1^1^2950301^^^^
"^DD",58.81,58.8126,.01,21,1,0)
This field contains the comments for this transaction.
"^DD",58.81,58.8126,.01,23,0)
^^1^1^2950301^^^^
"^DD",58.81,58.8126,.01,23,1,0)
Word Processing.
"^DD",58.81,58.8126,.01,"DT")
2920511
"^DD",58.811,58.811,0)
FIELD^^2^3
"^DD",58.811,58.811,0,"DDA")
N
"^DD",58.811,58.811,0,"DT")
2971017
"^DD",58.811,58.811,0,"IX","AC",58.8112,10)

"^DD",58.811,58.811,0,"IX","ADATE",58.8112,1)

"^DD",58.811,58.811,0,"IX","AINV",58.8112,.01)

"^DD",58.811,58.811,0,"IX","AINV2",58.811,.01)

"^DD",58.811,58.811,0,"IX","AINVDT",58.8112,1)

"^DD",58.811,58.811,0,"IX","ALOC",58.8112,4)

"^DD",58.811,58.811,0,"IX","ALOCMV",58.8112,13)

"^DD",58.811,58.811,0,"IX","ASTAT",58.8112,2)

"^DD",58.811,58.811,0,"IX","B",58.811,.01)

"^DD",58.811,58.811,0,"NM","DRUG ACCOUNTABILITY ORDER")

"^DD",58.811,58.811,0,"VRPK")
DRUG ACCOUNTABILITY
"^DD",58.811,58.811,.01,0)
ORDER NUMBER^RF^^0;1^K:$L(X)>22!($L(X)<1)!'(X'?1P.E) X
"^DD",58.811,58.811,.01,.1)
Order Number
"^DD",58.811,58.811,.01,1,0)
^.1
"^DD",58.811,58.811,.01,1,1,0)
58.811^B
"^DD",58.811,58.811,.01,1,1,1)
S ^PSD(58.811,"B",$E(X,1,30),DA)=""
"^DD",58.811,58.811,.01,1,1,2)
K ^PSD(58.811,"B",$E(X,1,30),DA)
"^DD",58.811,58.811,.01,1,1,3)
DO NOT DELETE!
"^DD",58.811,58.811,.01,1,1,"%D",0)
^^1^1^2970522^
"^DD",58.811,58.811,.01,1,1,"%D",1,0)
This cross-reference is used to locate an order number.
"^DD",58.811,58.811,.01,1,2,0)
58.811^AINV2^MUMPS
"^DD",58.811,58.811,.01,1,2,1)
D SETAORD^PSAUTL3
"^DD",58.811,58.811,.01,1,2,2)
D KILLAORD^PSAUTL3
"^DD",58.811,58.811,.01,1,2,3)
DO NOT DELETE!
"^DD",58.811,58.811,.01,1,2,"%D",0)
^^5^5^2970923^
"^DD",58.811,58.811,.01,1,2,"%D",1,0)
This cross-reference is used to determine if an order's invoice has been
"^DD",58.811,58.811,.01,1,2,"%D",2,0)
received. It set the "AORD" cross-reference.
"^DD",58.811,58.811,.01,1,2,"%D",3,0)
 
"^DD",58.811,58.811,.01,1,2,"%D",4,0)
^PSD(58.811,"AORD",ORDER NUMBER,INVOICE NUMBER,DA,Invoice internal
"^DD",58.811,58.811,.01,1,2,"%D",5,0)
entry#)=""
"^DD",58.811,58.811,.01,1,2,"DT")
2970522
"^DD",58.811,58.811,.01,3)
Enter the order number.
"^DD",58.811,58.811,.01,9)
^
"^DD",58.811,58.811,.01,21,0)
^^2^2^2970922^^^^
"^DD",58.811,58.811,.01,21,1,0)
The ORDER NUMBER field contains number of the order placed with 
"^DD",58.811,58.811,.01,21,2,0)
the prime vendor.
"^DD",58.811,58.811,.01,"DT")
2971021
"^DD",58.811,58.811,1,0)
VENDOR NAME^F^^0;2^K:$L(X)>35!($L(X)<3) X
"^DD",58.811,58.811,1,.1)
Vendor Name
"^DD",58.811,58.811,1,3)
Enter the vendor's name.
"^DD",58.811,58.811,1,9)
^
"^DD",58.811,58.811,1,21,0)
^^2^2^2960503^^
"^DD",58.811,58.811,1,21,1,0)
The VENDOR NAME field contains the name of the vendor from
"^DD",58.811,58.811,1,21,2,0)
whom the order was placed.
"^DD",58.811,58.811,1,"DT")
2971021
"^DD",58.811,58.811,2,0)
INVOICE DATA^58.8112AI^^1;0
"^DD",58.811,58.811,2,9)
^
"^DD",58.811,58.811,2,21,0)
^^2^2^2970926^^^
"^DD",58.811,58.811,2,21,1,0)
The INVOICE DATA multiple contains detail invoice data. It contains the
"^DD",58.811,58.811,2,21,2,0)
line item data and adjustment data.
"^DD",58.811,58.811,2,"DT")
2970926
"^DD",58.811,58.8112,0)
INVOICE DATA SUB-FIELD^^14^15
"^DD",58.811,58.8112,0,"DT")
2971017
"^DD",58.811,58.8112,0,"ID",1)
W "   ",$E($P(^(0),U,2),4,5)_"-"_$E($P(^(0),U,2),6,7)_"-"_$E($P(^(0),U,2),2,3)
"^DD",58.811,58.8112,0,"IX","B",58.8112,.01)

"^DD",58.811,58.8112,0,"NM","INVOICE DATA")

"^DD",58.811,58.8112,0,"UP")
58.811
"^DD",58.811,58.8112,.01,0)
INVOICE NUMBER^F^^0;1^K:$L(X)>22!($L(X)<1) X
"^DD",58.811,58.8112,.01,.1)
Invoice Number
"^DD",58.811,58.8112,.01,1,0)
^.1
"^DD",58.811,58.8112,.01,1,1,0)
58.8112^B
"^DD",58.811,58.8112,.01,1,1,1)
S ^PSD(58.811,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",58.811,58.8112,.01,1,1,2)
K ^PSD(58.811,DA(1),1,"B",$E(X,1,30),DA)
"^DD",58.811,58.8112,.01,1,1,3)
DO NOT DELETE!
"^DD",58.811,58.8112,.01,1,1,"%D",0)
^^1^1^2970522^
"^DD",58.811,58.8112,.01,1,1,"%D",1,0)
This cross-reference is used to locate an invoice number.
"^DD",58.811,58.8112,.01,1,2,0)
58.811^AINV^MUMPS
"^DD",58.811,58.8112,.01,1,2,1)
S ^PSD(58.811,"AORD",$P($G(^PSD(58.811,DA(1),0)),"^"),X,DA(1),DA)=""
"^DD",58.811,58.8112,.01,1,2,2)
K ^PSD(58.811,"AORD",$P($G(^PSD(58.811,DA(1),0)),"^"),X,DA(1),DA)
"^DD",58.811,58.8112,.01,1,2,3)
DO NOT DELETE!
"^DD",58.811,58.8112,.01,1,2,"%D",0)
^^5^5^2970923^
"^DD",58.811,58.8112,.01,1,2,"%D",1,0)
This cross-reference is used to determine if an order's invoice has been
"^DD",58.811,58.8112,.01,1,2,"%D",2,0)
received. It set the "AORD" cross-reference.
"^DD",58.811,58.8112,.01,1,2,"%D",3,0)
 
"^DD",58.811,58.8112,.01,1,2,"%D",4,0)
^PSD(58.811,"AORD",ORDER NUMBER,INVOICE NUMBER,Order internal
"^DD",58.811,58.8112,.01,1,2,"%D",5,0)
entry#,DA)=""
"^DD",58.811,58.8112,.01,1,2,"DT")
2961127
"^DD",58.811,58.8112,.01,3)
Enter the invoice number from the prime vendor.
"^DD",58.811,58.8112,.01,21,0)
^^2^2^2960503^
"^DD",58.811,58.8112,.01,21,1,0)
The INVOICE NUMBER field contains the number of the invoice from
"^DD",58.811,58.8112,.01,21,2,0)
the prime vendor.
"^DD",58.811,58.8112,.01,"DT")
2971021
"^DD",58.811,58.8112,1,0)
INVOICE DATE^D^^0;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.811,58.8112,1,.1)
Invoice Date
"^DD",58.811,58.8112,1,1,0)
^.1
"^DD",58.811,58.8112,1,1,1,0)
58.811^ADATE
"^DD",58.811,58.8112,1,1,1,1)
S ^PSD(58.811,"ADATE",$E(X,1,30),DA(1),DA)=""
"^DD",58.811,58.8112,1,1,1,2)
K ^PSD(58.811,"ADATE",$E(X,1,30),DA(1),DA)
"^DD",58.811,58.8112,1,1,1,3)
DO NOT DELETE!
"^DD",58.811,58.8112,1,1,1,"%D",0)
^^1^1^2971015^^
"^DD",58.811,58.8112,1,1,1,"%D",1,0)
This cross-reference is used to locate an invoice number.
"^DD",58.811,58.8112,1,1,1,"DT")
2970510
"^DD",58.811,58.8112,1,1,2,0)
58.811^AINVDT^MUMPS
"^DD",58.811,58.8112,1,1,2,1)
D SLOCDT^PSAUTL3
"^DD",58.811,58.8112,1,1,2,2)
D KLOCDT^PSAUTL3
"^DD",58.811,58.8112,1,1,2,3)
DO NOT DELETE!
"^DD",58.811,58.8112,1,1,2,"%D",0)
^^13^13^2970926^
"^DD",58.811,58.8112,1,1,2,"%D",1,0)
This cross-reference is used to locate invoices within a pharmacy location
"^DD",58.811,58.8112,1,1,2,"%D",2,0)
or master vault for a specific invoice date. It sets the "ALOC"
"^DD",58.811,58.8112,1,1,2,"%D",3,0)
cross-reference.
"^DD",58.811,58.8112,1,1,2,"%D",4,0)
 
"^DD",58.811,58.8112,1,1,2,"%D",5,0)
If there is data in the PHARMACY LOCATION field (#4),
"^DD",58.811,58.8112,1,1,2,"%D",6,0)
^PSD(58.811,"ALOC",PHARMACY LOCATION,Order's internal entry#,DA)="" is
"^DD",58.811,58.8112,1,1,2,"%D",7,0)
set.
"^DD",58.811,58.8112,1,1,2,"%D",8,0)
 
"^DD",58.811,58.8112,1,1,2,"%D",9,0)
If there is data in the MASTER VAULT field (#13),
"^DD",58.811,58.8112,1,1,2,"%D",10,0)
^PSD(58.811,"ALOC",MASTER VAULT,Order's internal entry#,DA)="" is set.
"^DD",58.811,58.8112,1,1,2,"%D",11,0)
 
"^DD",58.811,58.8112,1,1,2,"%D",12,0)
If there is data in both the PHARMACY LOCATION and MASTER VAULT fields,
"^DD",58.811,58.8112,1,1,2,"%D",13,0)
both cross-references are set.
"^DD",58.811,58.8112,1,1,2,"DT")
2970522
"^DD",58.811,58.8112,1,3)
Enter the date of the invoice.
"^DD",58.811,58.8112,1,21,0)
^^2^2^2960503^^
"^DD",58.811,58.8112,1,21,1,0)
The INVOICE DATE field contains the date the invoice was issued
"^DD",58.811,58.8112,1,21,2,0)
by the vendor
"^DD",58.811,58.8112,1,"DT")
2970522
"^DD",58.811,58.8112,2,0)
INVOICE STATUS^S^P:PROCESSED;V:VERIFIED;C:COMPLETED;^0;3^Q
"^DD",58.811,58.8112,2,.1)
Invoice Status
"^DD",58.811,58.8112,2,1,0)
^.1
"^DD",58.811,58.8112,2,1,1,0)
58.811^ASTAT
"^DD",58.811,58.8112,2,1,1,1)
S ^PSD(58.811,"ASTAT",$E(X,1,30),DA(1),DA)=""
"^DD",58.811,58.8112,2,1,1,2)
K ^PSD(58.811,"ASTAT",$E(X,1,30),DA(1),DA)
"^DD",58.811,58.8112,2,1,1,3)
DO NOT DELETE!
"^DD",58.811,58.8112,2,1,1,"%D",0)
^^2^2^2961129^^
"^DD",58.811,58.8112,2,1,1,"%D",1,0)
This cross-reference is used to locate all invoices with a specific
"^DD",58.811,58.8112,2,1,1,"%D",2,0)
status.
"^DD",58.811,58.8112,2,1,1,"DT")
2961129
"^DD",58.811,58.8112,2,3)
Enter the status of the invoice.
"^DD",58.811,58.8112,2,21,0)
^^3^3^2960503^^
"^DD",58.811,58.8112,2,21,1,0)
The INVOICE STATUS field contains the status of the invoice. 
"^DD",58.811,58.8112,2,21,2,0)
When the invoice is completed, the drug balances are incremented 
"^DD",58.811,58.8112,2,21,3,0)
with the quantities received on the invoice.
"^DD",58.811,58.8112,2,"DT")
2961129
"^DD",58.811,58.8112,3,0)
ORDER DATE^D^^0;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.811,58.8112,3,.1)
Order Date
"^DD",58.811,58.8112,3,3)
Enter the date the order was placed with the prime vendor.
"^DD",58.811,58.8112,3,21,0)
^^2^2^2960503^^
"^DD",58.811,58.8112,3,21,1,0)
The ORDER DATE field contains the date the order was placed for
"^DD",58.811,58.8112,3,21,2,0)
the invoiced drugs.
"^DD",58.811,58.8112,3,"DT")
2960503
"^DD",58.811,58.8112,4,0)
PHARMACY LOCATION^*P58.8'^PSD(58.8,^0;5^S DIC("S")="I $P($G(^PSD(58.8,+Y,0)),U,2)=""P""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.811,58.8112,4,.1)
Pharmacy Location
"^DD",58.811,58.8112,4,1,0)
^.1
"^DD",58.811,58.8112,4,1,1,0)
58.811^ALOC^MUMPS
"^DD",58.811,58.8112,4,1,1,1)
D SLOC^PSAUTL3
"^DD",58.811,58.8112,4,1,1,2)
D KLOC^PSAUTL3
"^DD",58.811,58.8112,4,1,1,3)
DO NOT DELETE!
"^DD",58.811,58.8112,4,1,1,"%D",0)
^^4^4^2970926^^
"^DD",58.811,58.8112,4,1,1,"%D",1,0)
This cross-reference is used to locate invoices within a pharmacy location
"^DD",58.811,58.8112,4,1,1,"%D",2,0)
for a specific invoice date. It sets the "ALOC"cross-reference.
"^DD",58.811,58.8112,4,1,1,"%D",3,0)
 
"^DD",58.811,58.8112,4,1,1,"%D",4,0)
^PSD(58.811,"ALOC",PHARMACY LOCATION,Order's internal entry#,DA)=""
"^DD",58.811,58.8112,4,1,1,"DT")
2970522
"^DD",58.811,58.8112,4,3)
Enter the Drug Accountability pharmacy location for which the order was placed.
"^DD",58.811,58.8112,4,12)
Only pharmacy locations can be selected.
"^DD",58.811,58.8112,4,12.1)
S DIC("S")="I $P($G(^PSD(58.8,+Y,0)),U,2)=""P"""
"^DD",58.811,58.8112,4,21,0)
^^3^3^2970923^^^^
"^DD",58.811,58.8112,4,21,1,0)
The PHARMACY LOCATION field contains the Drug Accountability pharmacy
"^DD",58.811,58.8112,4,21,2,0)
location for which the invoiced order was placed. The pharmacy location 
"^DD",58.811,58.8112,4,21,3,0)
received the items not marked as a controlled substance.
"^DD",58.811,58.8112,4,23,0)
^^2^2^2970926^
"^DD",58.811,58.8112,4,23,1,0)
The field points to the DRUG ACCOUNTABILITY STATS file (#58.8). The node
"^DD",58.811,58.8112,4,23,2,0)
pointed to must contain an "P" in the LOCATION TYPE field (#1).
"^DD",58.811,58.8112,4,"DT")
2970829
"^DD",58.811,58.8112,5,0)
LINE ITEM DATA^58.81125AI^^1;0
"^DD",58.811,58.8112,5,21,0)
^^4^4^2970923^
"^DD",58.811,58.8112,5,21,1,0)
The LINE ITEM DATA multiple contains the line item number, drug, quantity
"^DD",58.811,58.8112,5,21,2,0)
invoiced, order unit, price per order unit, date drugs were received, date
"^DD",58.811,58.8112,5,21,3,0)
the line item was processed, processor, date the line item was verified,
"^DD",58.811,58.8112,5,21,4,0)
verifier, and adjustment data for each line item.
"^DD",58.811,58.8112,6,0)
CREDITS^58.81126A^^2;0
"^DD",58.811,58.8112,6,21,0)
^^2^2^2961107^
"^DD",58.811,58.8112,6,21,1,0)
The CREDITS multiple contains the credit memo data issued
"^DD",58.811,58.8112,6,21,2,0)
against the invoice.
"^DD",58.811,58.8112,7,0)
DELIVERY DATE^D^^0;6^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.811,58.8112,7,.1)
Delivery Date
"^DD",58.811,58.8112,7,3)
Enter the delivery date on the invoice.
"^DD",58.811,58.8112,7,21,0)
^^2^2^2961107^^
"^DD",58.811,58.8112,7,21,1,0)
The DELIVERY DATE field contains the date the prime
"^DD",58.811,58.8112,7,21,2,0)
vendor's invoice shows the items were delivered.
"^DD",58.811,58.8112,7,"DT")
2961107
"^DD",58.811,58.8112,8,0)
DATE RECEIVED^D^^0;7^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.811,58.8112,8,.1)
Date Received
"^DD",58.811,58.8112,8,3)
Enter the date the items were received.
"^DD",58.811,58.8112,8,21,0)
^^3^3^2961107^^
"^DD",58.811,58.8112,8,21,1,0)
The DATE RECEIVED field contains the date the drugs were 
"^DD",58.811,58.8112,8,21,2,0)
received if it is different than the delivery date on the 
"^DD",58.811,58.8112,8,21,3,0)
invoice.
"^DD",58.811,58.8112,8,"DT")
2961107
"^DD",58.811,58.8112,9,0)
CONTROLLED SUBSTANCES^S^A:ALL;S:SOME;N:NONE;^0;8^Q
"^DD",58.811,58.8112,9,.1)
Controlled Substances
"^DD",58.811,58.8112,9,3)
Enter the invoice's controlled substances category.
"^DD",58.811,58.8112,9,21,0)
^^2^2^2970923^
"^DD",58.811,58.8112,9,21,1,0)
The CONTROLLED SUBSTANCES field contains a flag indicating if all, some,
"^DD",58.811,58.8112,9,21,2,0)
or none of the drugs on the invoice are flagged as controlled substances.
"^DD",58.811,58.8112,9,"DT")
2961108
"^DD",58.811,58.8112,10,0)
OUTSTANDING CREDIT MEMO^S^1:YES;^0;9^Q
"^DD",58.811,58.8112,10,.1)
Outstanding Credit Memo
"^DD",58.811,58.8112,10,1,0)
^.1
"^DD",58.811,58.8112,10,1,1,0)
58.811^AC
"^DD",58.811,58.8112,10,1,1,1)
S ^PSD(58.811,"AC",$E(X,1,30),DA(1),DA)=""
"^DD",58.811,58.8112,10,1,1,2)
K ^PSD(58.811,"AC",$E(X,1,30),DA(1),DA)
"^DD",58.811,58.8112,10,1,1,3)
DO NOT DELETE!
"^DD",58.811,58.8112,10,1,1,"%D",0)
^^2^2^2971017^^
"^DD",58.811,58.8112,10,1,1,"%D",1,0)
The cross-reference is used to determine if there is an outstanding
"^DD",58.811,58.8112,10,1,1,"%D",2,0)
credit memo for the invoice.
"^DD",58.811,58.8112,10,1,1,"DT")
2961205
"^DD",58.811,58.8112,10,3)
Enter "1" if there is an outstanding credit memo for the invoice.
"^DD",58.811,58.8112,10,21,0)
^^3^3^2970923^
"^DD",58.811,58.8112,10,21,1,0)
The CREDIT MEMO REQUIRED? field is a flag used to determine if there is an
"^DD",58.811,58.8112,10,21,2,0)
outstanding credit memo for the invoice. The field is set to "1" if a
"^DD",58.811,58.8112,10,21,3,0)
credit memo is needed and has not been received.
"^DD",58.811,58.8112,10,"DT")
2961205
"^DD",58.811,58.8112,11,0)
PROCESSOR^*P200'^VA(200,^0;10^I $D(^XUSEC("PSA ORDERS",DUZ)) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.811,58.8112,11,.1)
Processor
"^DD",58.811,58.8112,11,3)
Enter the last person who processed the invoice.
"^DD",58.811,58.8112,11,12)
The user must hold the PSA ORDERS key.
"^DD",58.811,58.8112,11,12.1)
I $D(^XUSEC("PSA ORDERS",DUZ))
"^DD",58.811,58.8112,11,21,0)
^^2^2^2961210^^
"^DD",58.811,58.8112,11,21,1,0)
The PROCESSOR field contains the name of the person who last processed
"^DD",58.811,58.8112,11,21,2,0)
the invoice.
"^DD",58.811,58.8112,11,"DT")
2961210
"^DD",58.811,58.8112,12,0)
VERIFIER^*P200'^VA(200,^0;11^I $D(^XUSEC("PSA ORDERS",DUZ)) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.811,58.8112,12,.1)
Verifier
"^DD",58.811,58.8112,12,3)
Enter the name of the person who verified the invoice.
"^DD",58.811,58.8112,12,12)
The user must hold the PSA ORDERS key.
"^DD",58.811,58.8112,12,12.1)
I $D(^XUSEC("PSA ORDERS",DUZ))
"^DD",58.811,58.8112,12,21,0)
^^2^2^2961210^^^^
"^DD",58.811,58.8112,12,21,1,0)
The VERIFIER field contains the name of the person who last verified
"^DD",58.811,58.8112,12,21,2,0)
the invoice. The verifier cannot be the processor.
"^DD",58.811,58.8112,12,"DT")
2961210
"^DD",58.811,58.8112,13,0)
MASTER VAULT^*P58.8'^PSD(58.8,^0;12^S DIC("S")="I $P($G(^PSD(58.8,+Y,0)),U,2)=""M""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.811,58.8112,13,.1)
Master Vault
"^DD",58.811,58.8112,13,1,0)
^.1
"^DD",58.811,58.8112,13,1,1,0)
58.811^ALOCMV^MUMPS
"^DD",58.811,58.8112,13,1,1,1)
D SLOC^PSAUTL3
"^DD",58.811,58.8112,13,1,1,2)
D KLOC^PSAUTL3
"^DD",58.811,58.8112,13,1,1,3)
DO NOT DELETE!
"^DD",58.811,58.8112,13,1,1,"%D",0)
^^4^4^2970926^^
"^DD",58.811,58.8112,13,1,1,"%D",1,0)
This cross-reference is used to locate invoices within a master vault for
"^DD",58.811,58.8112,13,1,1,"%D",2,0)
a specific invoice date. It sets the "ALOC"cross-reference.
"^DD",58.811,58.8112,13,1,1,"%D",3,0)
 
"^DD",58.811,58.8112,13,1,1,"%D",4,0)
^PSD(58.811,"ALOC",MASTER VAULT,Order's internal entry#,DA)=""
"^DD",58.811,58.8112,13,1,1,"DT")
2970522
"^DD",58.811,58.8112,13,3)
Enter the master vault that received the controlled substances.
"^DD",58.811,58.8112,13,12)
Only master vaults can be selected.
"^DD",58.811,58.8112,13,12.1)
S DIC("S")="I $P($G(^PSD(58.8,+Y,0)),U,2)=""M"""
"^DD",58.811,58.8112,13,21,0)
^^2^2^2970923^^^^
"^DD",58.811,58.8112,13,21,1,0)
The MASTER VAULT field contains the master vault that received the
"^DD",58.811,58.8112,13,21,2,0)
controlled substances on the invoice.
"^DD",58.811,58.8112,13,23,0)
^^2^2^2970923^
"^DD",58.811,58.8112,13,23,1,0)
The field points to the DRUG ACCOUNTABILITY STATS file (#58.8). The master
"^DD",58.811,58.8112,13,23,2,0)
vault pointed to must contain an "M" in the LOCATION TYPE field (#1).
"^DD",58.811,58.8112,13,"DT")
2970829
"^DD",58.811,58.8112,14,0)
ALL SUPPLY ITEMS?^S^1:YES;0:NO;^0;13^Q
"^DD",58.811,58.8112,14,.1)
All Supply Items?
"^DD",58.811,58.8112,14,3)
Enter "YES" if all items on the invoice are supply items.
"^DD",58.811,58.8112,14,21,0)
^^4^4^2970923^
"^DD",58.811,58.8112,14,21,1,0)
The ALL SUPPLY ITEMS? field contains "YES" if all items on the invoice are
"^DD",58.811,58.8112,14,21,2,0)
supply items or will never be matched to drugs in the DRUG file (#50). It
"^DD",58.811,58.8112,14,21,3,0)
contains "NO" if there is at least one item on the invoice that is not a
"^DD",58.811,58.8112,14,21,4,0)
supply item or will be matched to a drug in the DRUG file.
"^DD",58.811,58.8112,14,"DT")
2970131
"^DD",58.811,58.81125,0)
LINE ITEM DATA SUB-FIELD^^17^18
"^DD",58.811,58.81125,0,"DT")
2971017
"^DD",58.811,58.81125,0,"ID",1)
S %I=Y,Y=$S('$D(^(0)):"",$D(^PSDRUG(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(50,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",58.811,58.81125,0,"IX","B",58.81125,.01)

"^DD",58.811,58.81125,0,"NM","LINE ITEM DATA")

"^DD",58.811,58.81125,0,"UP")
58.8112
"^DD",58.811,58.81125,.01,0)
LINE ITEM NUMBER^F^^0;1^K:$L(X)>11!($L(X)<1) X
"^DD",58.811,58.81125,.01,.1)
Line Item Number
"^DD",58.811,58.81125,.01,1,0)
^.1
"^DD",58.811,58.81125,.01,1,1,0)
58.81125^B
"^DD",58.811,58.81125,.01,1,1,1)
S ^PSD(58.811,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",58.811,58.81125,.01,1,1,2)
K ^PSD(58.811,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",58.811,58.81125,.01,1,1,3)
DO NOT DELETE!
"^DD",58.811,58.81125,.01,1,1,"%D",0)
^^1^1^2970522^
"^DD",58.811,58.81125,.01,1,1,"%D",1,0)
This cross-reference is used to locate a line item number.
"^DD",58.811,58.81125,.01,3)
Enter the number of the item on the invoice.
"^DD",58.811,58.81125,.01,21,0)
^^2^2^2960503^
"^DD",58.811,58.81125,.01,21,1,0)
The LINE ITEM NUMBER field contains the number of the item on the
"^DD",58.811,58.81125,.01,21,2,0)
invoice.
"^DD",58.811,58.81125,.01,"DT")
2960503
"^DD",58.811,58.81125,1,0)
DRUG^P50'^PSDRUG(^0;2^Q
"^DD",58.811,58.81125,1,.1)
Drug
"^DD",58.811,58.81125,1,3)
Enter the drug that was invoiced.
"^DD",58.811,58.81125,1,21,0)
^^1^1^2960503^
"^DD",58.811,58.81125,1,21,1,0)
The DRUG field contains the drug that was invoiced.
"^DD",58.811,58.81125,1,"DT")
2960503
"^DD",58.811,58.81125,2,0)
QUANTITY INVOICED^NJ10,0^^0;3^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.811,58.81125,2,.1)
Quantity Invoiced
"^DD",58.811,58.81125,2,3)
Enter the quantity of the drug that was invoiced.
"^DD",58.811,58.81125,2,21,0)
^^2^2^2960503^
"^DD",58.811,58.81125,2,21,1,0)
The QUANTITY INVOICED field contains the quantity of the ordered
"^DD",58.811,58.81125,2,21,2,0)
drug that invoiced.
"^DD",58.811,58.81125,2,"DT")
2960503
"^DD",58.811,58.81125,3,0)
ORDER UNIT^P51.5'^DIC(51.5,^0;4^Q
"^DD",58.811,58.81125,3,.1)
Order Unit
"^DD",58.811,58.81125,3,3)
Enter the order unit for which the drug was invoiced.
"^DD",58.811,58.81125,3,21,0)
^^2^2^2961205^^
"^DD",58.811,58.81125,3,21,1,0)
The ORDER UNIT field contains the packaging unit for which
"^DD",58.811,58.81125,3,21,2,0)
the drug was invoiced.
"^DD",58.811,58.81125,3,"DT")
2960503
"^DD",58.811,58.81125,4,0)
PRICE PER ORDER UNIT^NJ14,3^^0;5^K:+X'=X!(X>9999999999.999)!(X<0)!(X?.E1"."4N.N) X
"^DD",58.811,58.81125,4,.1)
Price per Order Unit
"^DD",58.811,58.81125,4,3)
Enter the dollar amount invoiced for each unit of order.
"^DD",58.811,58.81125,4,21,0)
^^2^2^2960503^^
"^DD",58.811,58.81125,4,21,1,0)
The PRICE PER ORDER UNIT field contains the dollar amount for each
"^DD",58.811,58.81125,4,21,2,0)
order unit.
"^DD",58.811,58.81125,4,"DT")
2960503
"^DD",58.811,58.81125,5,0)
DATE PROCESSED^D^^0;6^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.811,58.81125,5,.1)
Date Processed
"^DD",58.811,58.81125,5,3)
Enter the date the line item was processed.
"^DD",58.811,58.81125,5,21,0)
^^1^1^2961105^^^^
"^DD",58.811,58.81125,5,21,1,0)
The DATE PROCESSED field contains the date the line item was processed.
"^DD",58.811,58.81125,5,"DT")
2961105
"^DD",58.811,58.81125,6,0)
PROCESSOR^*P200'^VA(200,^0;7^I $D(^XUSEC("PSA ORDERS",DUZ)) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.811,58.81125,6,.1)
Processor
"^DD",58.811,58.81125,6,3)
Enter the name of the person who processed the line item.
"^DD",58.811,58.81125,6,12)
The user must hold the PSA ORDERS key.
"^DD",58.811,58.81125,6,12.1)
I $D(^XUSEC("PSA ORDERS",DUZ))
"^DD",58.811,58.81125,6,21,0)
^^2^2^2961203^^^^
"^DD",58.811,58.81125,6,21,1,0)
The PROCESSOR field contains the name of the person who processed
"^DD",58.811,58.81125,6,21,2,0)
the line item.
"^DD",58.811,58.81125,6,"DT")
2961203
"^DD",58.811,58.81125,7,0)
DATE VERIFIED^D^^0;8^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.811,58.81125,7,.1)
Date Verified
"^DD",58.811,58.81125,7,3)
Enter the date the line item was verified.
"^DD",58.811,58.81125,7,21,0)
^^1^1^2961105^^^
"^DD",58.811,58.81125,7,21,1,0)
The DATE VERIFIED field contains the date the line item was verified.
"^DD",58.811,58.81125,7,"DT")
2961105
"^DD",58.811,58.81125,8,0)
VERIFIER^*P200'^VA(200,^0;9^I $D(^XUSEC("PSA ORDERS",DUZ)) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.811,58.81125,8,.1)
Verifier
"^DD",58.811,58.81125,8,3)
Enter the name of the person who verified the line item.
"^DD",58.811,58.81125,8,12)
The user must hold the PSA ORDERS key.
"^DD",58.811,58.81125,8,12.1)
I $D(^XUSEC("PSA ORDERS",DUZ))
"^DD",58.811,58.81125,8,21,0)
^^2^2^2961205^^^^
"^DD",58.811,58.81125,8,21,1,0)
The VERIFIER field contains the name of the person who verified the
"^DD",58.811,58.81125,8,21,2,0)
line item.
"^DD",58.811,58.81125,8,"DT")
2961205
"^DD",58.811,58.81125,9,0)
ADJUSTMENTS^58.811259SA^^1;0
"^DD",58.811,58.81125,9,21,0)
^^2^2^2961107^^
"^DD",58.811,58.81125,9,21,1,0)
The ADJUSTMENTS multiple contains the changes the processor and
"^DD",58.811,58.81125,9,21,2,0)
verifier made to the invoice data.
"^DD",58.811,58.81125,10,0)
DISPENSE UNITS PER ORDER UNIT^NJ10,3^^2;1^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."4N.N) X
"^DD",58.811,58.81125,10,.1)
Dispense Units per Order Unit
"^DD",58.811,58.81125,10,3)
Enter the number of dispense units contained in one order unit.
"^DD",58.811,58.81125,10,21,0)
^^2^2^2961107^
"^DD",58.811,58.81125,10,21,1,0)
The DISPENSE UNITS PER ORDER UNIT field contains the
"^DD",58.811,58.81125,10,21,2,0)
number of dispense units in one order unit.
"^DD",58.811,58.81125,10,"DT")
2970110
"^DD",58.811,58.81125,11,0)
REORDER LEVEL^NJ9,0^^2;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.811,58.81125,11,.1)
Reorder Level
"^DD",58.811,58.81125,11,3)
Enter the minimum number of dispense units you want to have in the pharmacy location.
"^DD",58.811,58.81125,11,21,0)
^^3^3^2970408^^^^
"^DD",58.811,58.81125,11,21,1,0)
The REORDER LEVEL field contains the minimum number of dispense 
"^DD",58.811,58.81125,11,21,2,0)
units to be retained in the pharmacy location for the line item's 
"^DD",58.811,58.81125,11,21,3,0)
drug.
"^DD",58.811,58.81125,11,"DT")
2970408
"^DD",58.811,58.81125,12,0)
CONTROLLED SUBSTANCE?^S^1:YES;0:NO;^0;10^Q
"^DD",58.811,58.81125,12,.1)
Controlled Substance?
"^DD",58.811,58.81125,12,3)
Enter "YES" if the item is marked as a controlled substance.
"^DD",58.811,58.81125,12,21,0)
^^4^4^2970923^
"^DD",58.811,58.81125,12,21,1,0)
The CONTROLLED SUBSTANCE? field contains a flag indicating if the drug is
"^DD",58.811,58.81125,12,21,2,0)
marked as a controlled substance in the DRUG file (#50). If there is an
"^DD",58.811,58.81125,12,21,3,0)
adjusted drug, the flag is set for that drug. If there is no adjusted
"^DD",58.811,58.81125,12,21,4,0)
drug, the flag is set for the invoiced drug.
"^DD",58.811,58.81125,12,"DT")
2961108
"^DD",58.811,58.81125,13,0)
NDC^F^^0;11^K:$L(X)>31!($L(X)<1) X
"^DD",58.811,58.81125,13,.1)
National Drug Code
"^DD",58.811,58.81125,13,3)
Enter the National Drug Code (NDC). If there is no NDC, enter "S" concatenated to the Universal Product Code (UPC).
"^DD",58.811,58.81125,13,21,0)
^^3^3^2970923^^^
"^DD",58.811,58.81125,13,21,1,0)
The NDC field contains the National Drug Code (NDC) for the received item.
"^DD",58.811,58.81125,13,21,2,0)
If the item was adjusted, the NDC is for the adjusted item. If the item
"^DD",58.811,58.81125,13,21,3,0)
was not adjusted, the NDC is for the invoiced item.
"^DD",58.811,58.81125,13,23,0)
^^3^3^2970923^
"^DD",58.811,58.81125,13,23,1,0)
If the item is a drug, the NDC is twelve numbers. If the item is a supply,
"^DD",58.811,58.81125,13,23,2,0)
the National Drug Code (NDC) is "S" concatenated to the Universal Product
"^DD",58.811,58.81125,13,23,3,0)
Code (UPC).
"^DD",58.811,58.81125,13,"DT")
2961114
"^DD",58.811,58.81125,14,0)
VSN^F^^0;12^K:$L(X)>30!($L(X)<1) X
"^DD",58.811,58.81125,14,.1)
Vendor Stock Number
"^DD",58.811,58.81125,14,3)
Enter the vendor's stock number for the item.
"^DD",58.811,58.81125,14,21,0)
^^1^1^2961108^^
"^DD",58.811,58.81125,14,21,1,0)
The VSN field contains the Vendor Stock Number for the item received.
"^DD",58.811,58.81125,14,"DT")
2961108
"^DD",58.811,58.81125,15,0)
UPC^F^^0;13^K:$L(X)>30!($L(X)<1) X
"^DD",58.811,58.81125,15,.1)
Universal Product Code
"^DD",58.811,58.81125,15,3)
Enter the item's Universal Product Code.
"^DD",58.811,58.81125,15,21,0)
^^2^2^2970922^^^
"^DD",58.811,58.81125,15,21,1,0)
The UPC field contains the Universal Product Code for the item
"^DD",58.811,58.81125,15,21,2,0)
received.
"^DD",58.811,58.81125,15,"DT")
2961108
"^DD",58.811,58.81125,16,0)
SYNONYM NODE^NJ6,0^^2;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.811,58.81125,16,.1)
Synonym Node
"^DD",58.811,58.81125,16,3)
Enter the DRUG file's SYNONYM multiple's internal entry number that contains the data for the invoiced item.
"^DD",58.811,58.81125,16,21,0)
^^2^2^2970923^
"^DD",58.811,58.81125,16,21,1,0)
The SYNONYM NODE field contains the DRUG file's (#50) SYNONYM multiple's 
"^DD",58.811,58.81125,16,21,2,0)
internal entry number that contains the data for the invoiced item.
"^DD",58.811,58.81125,16,23,0)
^^2^2^2970923^^
"^DD",58.811,58.81125,16,23,1,0)
This field will contain data until the invoice is verified. The 2 node
"^DD",58.811,58.81125,16,23,2,0)
will be deleted then.
"^DD",58.811,58.81125,16,"DT")
2970110
"^DD",58.811,58.81125,17,0)
STOCK LEVEL^NJ7,0^^2;4^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",58.811,58.81125,17,.1)
Stock Level
"^DD",58.811,58.81125,17,3)
Enter the ideal number of dispense units to keep on the shelf.
"^DD",58.811,58.81125,17,21,0)
^^2^2^2970408^^^
"^DD",58.811,58.81125,17,21,1,0)
The STOCK LEVEL field contains the ideal number of dispense units to
"^DD",58.811,58.81125,17,21,2,0)
keep on the shelf.
"^DD",58.811,58.81125,17,"DT")
2970201
"^DD",58.811,58.811259,0)
ADJUSTMENTS SUB-FIELD^^8^9
"^DD",58.811,58.811259,0,"DT")
2961220
"^DD",58.811,58.811259,0,"IX","B",58.811259,.01)

"^DD",58.811,58.811259,0,"NM","ADJUSTMENTS")

"^DD",58.811,58.811259,0,"UP")
58.81125
"^DD",58.811,58.811259,.01,0)
ADJUSTED FIELD^S^D:DRUG;Q:QUANTITY INVOICED;O:ORDER UNIT;P:PRICE PER ORDER UNIT;^0;1^Q
"^DD",58.811,58.811259,.01,.1)
Adjusted Field
"^DD",58.811,58.811259,.01,1,0)
^.1
"^DD",58.811,58.811259,.01,1,1,0)
58.811259^B
"^DD",58.811,58.811259,.01,1,1,1)
S ^PSD(58.811,DA(3),1,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",58.811,58.811259,.01,1,1,2)
K ^PSD(58.811,DA(3),1,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",58.811,58.811259,.01,3)
Enter the field that was adjusted.
"^DD",58.811,58.811259,.01,21,0)
^^2^2^2961107^^
"^DD",58.811,58.811259,.01,21,1,0)
The ADJUSTED FIELD field contains the name of the field that 
"^DD",58.811,58.811259,.01,21,2,0)
was adjusted.
"^DD",58.811,58.811259,.01,"DT")
2961107
"^DD",58.811,58.811259,1,0)
PROCESSOR ADJUSTMENT^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",58.811,58.811259,1,.1)
Processor Adjustment
"^DD",58.811,58.811259,1,3)
Enter the adjustment made by the processor.
"^DD",58.811,58.811259,1,21,0)
^^8^8^2970923^
"^DD",58.811,58.811259,1,21,1,0)
The PROCESSOR ADJUSTMENT field contains the processor's adjustment. If the
"^DD",58.811,58.811259,1,21,2,0)
ADJUSTED FIELD field (.01) is "DRUG", the adjustment is the drug received
"^DD",58.811,58.811259,1,21,3,0)
or a description of supply item. If the ADJUSTED FIELD field is "QUANTITY
"^DD",58.811,58.811259,1,21,4,0)
INVOICED", the adjustment is the positive or negative number to be added
"^DD",58.811,58.811259,1,21,5,0)
to the QUANTITY INVOICED field (#2). If the ADJUSTED FIELD field is "ORDER
"^DD",58.811,58.811259,1,21,6,0)
UNIT", the adjustment is the abbreviation of the unit of order received.
"^DD",58.811,58.811259,1,21,7,0)
If the ADJUSTED FIELD field is "PRICE PER ORDER UNIT", the adjustment is
"^DD",58.811,58.811259,1,21,8,0)
the dollar amount charged for each order unit.
"^DD",58.811,58.811259,1,23,0)
^^6^6^2970923^
"^DD",58.811,58.811259,1,23,1,0)
A "DRUG" adjustment is the internal entry number of the drug in the DRUG
"^DD",58.811,58.811259,1,23,2,0)
file (#50) or a description of supply item. A "QUANTITY INVOICED"
"^DD",58.811,58.811259,1,23,3,0)
adjustment is the positive or negative number to be added to the QUANTITY
"^DD",58.811,58.811259,1,23,4,0)
INVOICED field (#2). An "ORDER UNIT" adjustment is the internal entry
"^DD",58.811,58.811259,1,23,5,0)
number of the unit of measure in the ORDER UNIT file (#51.5). A "PRICE PER
"^DD",58.811,58.811259,1,23,6,0)
ORDER UNIT" adjustment is the dollar amount to be paid for one order unit.
"^DD",58.811,58.811259,1,"DT")
2961220
"^DD",58.811,58.811259,2,0)
PROCESSOR'S REASON^F^^0;3^K:$L(X)>30!($L(X)<1) X
"^DD",58.811,58.811259,2,.1)
Processor's Reason
"^DD",58.811,58.811259,2,3)
Enter the reason the processor made the adjustment.
"^DD",58.811,58.811259,2,21,0)
^^1^1^2961107^^^
"^DD",58.811,58.811259,2,21,1,0)
The PROCESSOR'S REASON field contains reason the adjustment was made.
"^DD",58.811,58.811259,2,"DT")
2961107
"^DD",58.811,58.811259,3,0)
PROCESS DATE^D^^0;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.811,58.811259,3,.1)
Process Date
"^DD",58.811,58.811259,3,3)
Enter the date the processor entered the adjustment.
"^DD",58.811,58.811259,3,21,0)
^^2^2^2961107^^
"^DD",58.811,58.811259,3,21,1,0)
The PROCESS DATE field contains the date the processor made 
"^DD",58.811,58.811259,3,21,2,0)
the adjustment.
"^DD",58.811,58.811259,3,"DT")
2961107
"^DD",58.811,58.811259,4,0)
PROCESSOR^*P200'^VA(200,^0;5^I $D(^XUSEC("PSA ORDERS",DUZ)) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.811,58.811259,4,.1)
Processor
"^DD",58.811,58.811259,4,3)
Enter the name of the processor who entered the adjustment.
"^DD",58.811,58.811259,4,12)
The processor must hold the PSA ORDERS key.
"^DD",58.811,58.811259,4,12.1)
I $D(^XUSEC("PSA ORDERS",DUZ))
"^DD",58.811,58.811259,4,21,0)
^^2^2^2961107^^
"^DD",58.811,58.811259,4,21,1,0)
The PROCESSOR field contains the name of the person who entered 
"^DD",58.811,58.811259,4,21,2,0)
the adjustment.
"^DD",58.811,58.811259,4,"DT")
2961107
"^DD",58.811,58.811259,5,0)
VERIFIER ADJUSTMENT^F^^0;6^K:$L(X)>30!($L(X)<1) X
"^DD",58.811,58.811259,5,.1)
Verifier Adjustment
"^DD",58.811,58.811259,5,3)
Enter the adjustment made by the verifier.
"^DD",58.811,58.811259,5,21,0)
^^9^9^2970923^
"^DD",58.811,58.811259,5,21,1,0)
The VERIFIER ADJUSTMENT field contains the adjustment that the verifier
"^DD",58.811,58.811259,5,21,2,0)
made to the line item. If the ADJUSTED FIELD field (#.01) is "DRUG", the
"^DD",58.811,58.811259,5,21,3,0)
adjustment is the drug received or a description of supply item. If the
"^DD",58.811,58.811259,5,21,4,0)
ADJUSTED FIELD field is "QUANTITY INVOICED", the adjustment is the
"^DD",58.811,58.811259,5,21,5,0)
positive or negative number to be added to the QUANTITY INVOICED field
"^DD",58.811,58.811259,5,21,6,0)
(#2). If the ADJUSTED FIELD field is "ORDER UNIT", the adjustment is the
"^DD",58.811,58.811259,5,21,7,0)
abbreviation of the unit of order received. If the ADJUSTED FIELD field is
"^DD",58.811,58.811259,5,21,8,0)
"PRICE PER ORDER UNIT", the adjustment is the dollar amount charged for
"^DD",58.811,58.811259,5,21,9,0)
each order unit.
"^DD",58.811,58.811259,5,23,0)
^^6^6^2970923^
"^DD",58.811,58.811259,5,23,1,0)
A "DRUG" adjustment is the internal entry number of the drug in the DRUG
"^DD",58.811,58.811259,5,23,2,0)
file (#50) or a description of supply item. A "QUANTITY INVOICED"
"^DD",58.811,58.811259,5,23,3,0)
adjustment is the positive or negative number to be added to the QUANTITY
"^DD",58.811,58.811259,5,23,4,0)
INVOICED field (#2). An "ORDER UNIT" adjustment is the internal entry
"^DD",58.811,58.811259,5,23,5,0)
number of the unit of measure in the ORDER UNIT file (#51.5). A "PRICE PER
"^DD",58.811,58.811259,5,23,6,0)
ORDER UNIT" adjustment is the dollar amount to be paid for one order unit.
"^DD",58.811,58.811259,5,"DT")
2961220
"^DD",58.811,58.811259,6,0)
VERIFIER'S REASON^F^^0;7^K:$L(X)>30!($L(X)<1) X
"^DD",58.811,58.811259,6,.1)
Verifier's Reason
"^DD",58.811,58.811259,6,3)
Enter the reason the verifier made the adjustment.
"^DD",58.811,58.811259,6,21,0)
^^2^2^2970922^
"^DD",58.811,58.811259,6,21,1,0)
The VERIFIER'S REASON field contains the reason the verifier made the
"^DD",58.811,58.811259,6,21,2,0)
adjustment.
"^DD",58.811,58.811259,6,"DT")
2961107
"^DD",58.811,58.811259,7,0)
VERIFICATION DATE^D^^0;8^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.811,58.811259,7,.1)
Verification Date
"^DD",58.811,58.811259,7,3)
Enter the date the verifier made the adjustment.
"^DD",58.811,58.811259,7,21,0)
^^2^2^2961107^^
"^DD",58.811,58.811259,7,21,1,0)
The VERIFICATION DATE field contains the date the verifier 
"^DD",58.811,58.811259,7,21,2,0)
made the adjustment.
"^DD",58.811,58.811259,7,"DT")
2961107
"^DD",58.811,58.811259,8,0)
VERIFIER^*P200'^VA(200,^0;9^I $D(^XUSEC("PSA ORDERS",DUZ)) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",58.811,58.811259,8,.1)
Verifier
"^DD",58.811,58.811259,8,3)
Enter the name of the verifier who made the adjustment.
"^DD",58.811,58.811259,8,12)
The verifier must hold the PSA ORDERS key.
"^DD",58.811,58.811259,8,12.1)
I $D(^XUSEC("PSA ORDERS",DUZ))
"^DD",58.811,58.811259,8,21,0)
^^2^2^2961107^^
"^DD",58.811,58.811259,8,21,1,0)
The VERIFIER field contains the name of the verifier who entered 
"^DD",58.811,58.811259,8,21,2,0)
the adjustment.
"^DD",58.811,58.811259,8,"DT")
2961107
"^DD",58.811,58.81126,0)
CREDITS SUB-FIELD^^3^4
"^DD",58.811,58.81126,0,"DT")
2970228
"^DD",58.811,58.81126,0,"IX","B",58.81126,.01)

"^DD",58.811,58.81126,0,"NM","CREDITS")

"^DD",58.811,58.81126,0,"UP")
58.8112
"^DD",58.811,58.81126,.01,0)
CREDIT MEMO^F^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",58.811,58.81126,.01,.1)
Credit Memo
"^DD",58.811,58.81126,.01,1,0)
^.1
"^DD",58.811,58.81126,.01,1,1,0)
58.81126^B
"^DD",58.811,58.81126,.01,1,1,1)
S ^PSD(58.811,DA(2),1,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",58.811,58.81126,.01,1,1,2)
K ^PSD(58.811,DA(2),1,DA(1),2,"B",$E(X,1,30),DA)
"^DD",58.811,58.81126,.01,1,1,3)
DO NOT DELETE!
"^DD",58.811,58.81126,.01,1,1,"%D",0)
^^1^1^2970522^
"^DD",58.811,58.81126,.01,1,1,"%D",1,0)
This cross-reference is used to locate a credit memo number.
"^DD",58.811,58.81126,.01,3)
Enter the credit memo number. If there is no credit memo number, enter "None".
"^DD",58.811,58.81126,.01,21,0)
^^2^2^2970923^
"^DD",58.811,58.81126,.01,21,1,0)
The CREDIT MEMO field contains the credit memo number issued against the
"^DD",58.811,58.81126,.01,21,2,0)
invoice.
"^DD",58.811,58.81126,.01,"DT")
2961107
"^DD",58.811,58.81126,1,0)
CREDIT DATE^D^^0;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",58.811,58.81126,1,.1)
Credit Date
"^DD",58.811,58.81126,1,3)
Enter the date the credit memo was issued.
"^DD",58.811,58.81126,1,21,0)
^^2^2^2961107^^
"^DD",58.811,58.81126,1,21,1,0)
The CREDIT DATE field contains the date the credit memo
"^DD",58.811,58.81126,1,21,2,0)
was issued.
"^DD",58.811,58.81126,1,"DT")
2961107
"^DD",58.811,58.81126,2,0)
AMOUNT^NJ12,2^^0;3^S:X["$" X=$P(X,"$",2) K:X'?."-".N.1".".2N!(X>999999999)!(X<-999999999) X
"^DD",58.811,58.81126,2,.1)
Amount
"^DD",58.811,58.81126,2,3)
Enter the credit memo amount.
"^DD",58.811,58.81126,2,21,0)
^^1^1^2961107^^
"^DD",58.811,58.81126,2,21,1,0)
The AMOUNT field contains the dollar value of the credit issued.
"^DD",58.811,58.81126,2,"DT")
2970226
"^DD",58.811,58.81126,3,0)
REASON^F^^0;4^K:$L(X)>40!($L(X)<1) X
"^DD",58.811,58.81126,3,.1)
Reason
"^DD",58.811,58.81126,3,3)
Enter the reason the credit was issued. Enter 1-40 characters.
"^DD",58.811,58.81126,3,21,0)
^^2^2^2970227^^^
"^DD",58.811,58.81126,3,21,1,0)
The REASON field contains the explanation why the credit memo was
"^DD",58.811,58.81126,3,21,2,0)
issued.
"^DD",58.811,58.81126,3,"DT")
2970228
"^DD",58.84,58.84,0)
FIELD^^.01^1
"^DD",58.84,58.84,0,"DDA")
N
"^DD",58.84,58.84,0,"IX","B",58.84,.01)

"^DD",58.84,58.84,0,"NM","DRUG ACCOUNTABILITY TRANSACTION TYPE")

"^DD",58.84,58.84,0,"PT",58.81,1)

"^DD",58.84,58.84,0,"VRPK")
DRUG ACCOUNTABILITY
"^DD",58.84,58.84,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",58.84,58.84,.01,1,0)
^.1
"^DD",58.84,58.84,.01,1,1,0)
58.84^B
"^DD",58.84,58.84,.01,1,1,1)
S ^PSD(58.84,"B",$E(X,1,30),DA)=""
"^DD",58.84,58.84,.01,1,1,2)
K ^PSD(58.84,"B",$E(X,1,30),DA)
"^DD",58.84,58.84,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",58.84,58.84,.01,21,0)
^^1^1^2920415^
"^DD",58.84,58.84,.01,21,1,0)
This field contains the transaction type name.
"^DIC",58.8,58.8,0)
DRUG ACCOUNTABILITY STATS^58.8I
"^DIC",58.8,58.8,0,"GL")
^PSD(58.8,
"^DIC",58.8,58.8,"%D",0)
^^11^11^2970922^
"^DIC",58.8,58.8,"%D",1,0)
This file contains data associated with the Pharmacy Drug Accountability
"^DIC",58.8,58.8,"%D",2,0)
Stats location.  Entries in this file may be edited but not deleted.
"^DIC",58.8,58.8,"%D",3,0)
Entries in this file should NOT be edited directly using VA FileMan.
"^DIC",58.8,58.8,"%D",4,0)
  
"^DIC",58.8,58.8,"%D",5,0)
This file is designed to be shared between the Drug Accountability module
"^DIC",58.8,58.8,"%D",6,0)
and the Controlled Substances module of the Pharmacy software.
"^DIC",58.8,58.8,"%D",7,0)
The Controlled Substances module will recognize a location as a Narcotic
"^DIC",58.8,58.8,"%D",8,0)
Area of Use (NAOU). The menu option Inactivate NAOU [PSD INACTIVATE NAOU]
"^DIC",58.8,58.8,"%D",9,0)
is used to inactivate NAOUs no longer in use.  The menu option Inactivate
"^DIC",58.8,58.8,"%D",10,0)
NAOU Stock Drug [PSD INACTIVATE NAOU STOCK DRUG] is used to inactivate
"^DIC",58.8,58.8,"%D",11,0)
drugs no longer stocked within that NAOU.
"^DIC",58.8,"B","DRUG ACCOUNTABILITY STATS",58.8)

"^DIC",58.81,58.81,0)
DRUG ACCOUNTABILITY TRANSACTION^58.81
"^DIC",58.81,58.81,0,"GL")
^PSD(58.81,
"^DIC",58.81,58.81,"%D",0)
^^9^9^2931019^^^^
"^DIC",58.81,58.81,"%D",1,0)
This file contains the data associated with drug accountability
"^DIC",58.81,58.81,"%D",2,0)
transactions.  This file is designed to be shared between the
"^DIC",58.81,58.81,"%D",3,0)
Drug Accountability module and the Controlled Substances module.
"^DIC",58.81,58.81,"%D",4,0)
   
"^DIC",58.81,58.81,"%D",5,0)
Entries in this file should NOT be edited directly for Controlled
"^DIC",58.81,58.81,"%D",6,0)
Substances use.  The CS module contains all appropriate checks for this
"^DIC",58.81,58.81,"%D",7,0)
file's use.
"^DIC",58.81,58.81,"%D",8,0)
  
"^DIC",58.81,58.81,"%D",9,0)
Controlled Substances entries will be flagged.
"^DIC",58.81,"B","DRUG ACCOUNTABILITY TRANSACTION",58.81)

"^DIC",58.811,58.811,0)
DRUG ACCOUNTABILITY ORDER^58.811I
"^DIC",58.811,58.811,0,"GL")
^PSD(58.811,
"^DIC",58.811,58.811,"%",0)
^1.005^^0
"^DIC",58.811,58.811,"%D",0)
^^5^5^2970922^
"^DIC",58.811,58.811,"%D",1,0)
The DRUG ACCOUNTABILITY ORDER file contains prime vendor pharmacy 
"^DIC",58.811,58.811,"%D",2,0)
orders with all adjustments. The prime vendor invoice data is 
"^DIC",58.811,58.811,"%D",3,0)
uploaded from the prime vendor. All data is processed and verified
"^DIC",58.811,58.811,"%D",4,0)
before it increments the drug balances in Drug Accountability 
"^DIC",58.811,58.811,"%D",5,0)
pharmacy locations and master vaults.
"^DIC",58.811,"B","DRUG ACCOUNTABILITY ORDER",58.811)

"^DIC",58.84,58.84,0)
DRUG ACCOUNTABILITY TRANSACTION TYPE^58.84
"^DIC",58.84,58.84,0,"GL")
^PSD(58.84,
"^DIC",58.84,58.84,"%D",0)
5^^9^9^2941121^^^^
"^DIC",58.84,58.84,"%D",1,0)
This file contains the standard types of transactions utilized in
"^DIC",58.84,58.84,"%D",2,0)
pharmacy drug accountability.
"^DIC",58.84,58.84,"%D",3,0)
 
"^DIC",58.84,58.84,"%D",4,0)
This file is shared between the Drug Accountability module and the
"^DIC",58.84,58.84,"%D",5,0)
Controlled Substances module.
"^DIC",58.84,58.84,"%D",6,0)
 
"^DIC",58.84,58.84,"%D",7,0)
This is a standard file exported by both the Controlled Substances and
"^DIC",58.84,58.84,"%D",8,0)
Drug Accountability modules and additional entries should not be added.
"^DIC",58.84,58.84,"%D",9,0)
Existing data will be merged.
"^DIC",58.84,"B","DRUG ACCOUNTABILITY TRANSACTION TYPE",58.84)

**END**
**END**
