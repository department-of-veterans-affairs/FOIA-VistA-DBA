Released PX*1*116 SEQ #102
Extracted from mail message
**KIDS**:PX*1.0*116^

**INSTALL NAME**
PX*1.0*116
"BLD",3558,0)
PX*1.0*116^PCE PATIENT CARE ENCOUNTER^0^3040401^y
"BLD",3558,1,0)
^^4^4^3020107^^
"BLD",3558,1,1,0)
This patch will modify PCE so that it will create a visit with the progress
"BLD",3558,1,2,0)
note associated with a disposition location in the same way like with
"BLD",3558,1,3,0)
other locations.
"BLD",3558,1,4,0)

"BLD",3558,4,0)
^9.64PA^^
"BLD",3558,"ABPKG")
n
"BLD",3558,"KRN",0)
^9.67PA^19^17
"BLD",3558,"KRN",.4,0)
.4
"BLD",3558,"KRN",.401,0)
.401
"BLD",3558,"KRN",.402,0)
.402
"BLD",3558,"KRN",.403,0)
.403
"BLD",3558,"KRN",.5,0)
.5
"BLD",3558,"KRN",.84,0)
.84
"BLD",3558,"KRN",3.6,0)
3.6
"BLD",3558,"KRN",3.8,0)
3.8
"BLD",3558,"KRN",9.2,0)
9.2
"BLD",3558,"KRN",9.8,0)
9.8
"BLD",3558,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",3558,"KRN",9.8,"NM",1,0)
PXCEVSIT^^0^B23642458
"BLD",3558,"KRN",9.8,"NM",2,0)
PXCAVST^^0^B33433105
"BLD",3558,"KRN",9.8,"NM",3,0)
PXBAPI1^^0^B45855402
"BLD",3558,"KRN",9.8,"NM",4,0)
PXAIVSTV^^0^B51076022
"BLD",3558,"KRN",9.8,"NM","B","PXAIVSTV",4)

"BLD",3558,"KRN",9.8,"NM","B","PXBAPI1",3)

"BLD",3558,"KRN",9.8,"NM","B","PXCAVST",2)

"BLD",3558,"KRN",9.8,"NM","B","PXCEVSIT",1)

"BLD",3558,"KRN",19,0)
19
"BLD",3558,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",3558,"KRN",19,"NM",1,0)
PX PCE EDIT DISPOSITION CLINIC^^1^
"BLD",3558,"KRN",19,"NM","B","PX PCE EDIT DISPOSITION CLINIC",1)

"BLD",3558,"KRN",19.1,0)
19.1
"BLD",3558,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",3558,"KRN",101,0)
101
"BLD",3558,"KRN",409.61,0)
409.61
"BLD",3558,"KRN",771,0)
771
"BLD",3558,"KRN",870,0)
870
"BLD",3558,"KRN",8994,0)
8994
"BLD",3558,"KRN","B",.4,.4)

"BLD",3558,"KRN","B",.401,.401)

"BLD",3558,"KRN","B",.402,.402)

"BLD",3558,"KRN","B",.403,.403)

"BLD",3558,"KRN","B",.5,.5)

"BLD",3558,"KRN","B",.84,.84)

"BLD",3558,"KRN","B",3.6,3.6)

"BLD",3558,"KRN","B",3.8,3.8)

"BLD",3558,"KRN","B",9.2,9.2)

"BLD",3558,"KRN","B",9.8,9.8)

"BLD",3558,"KRN","B",19,19)

"BLD",3558,"KRN","B",19.1,19.1)

"BLD",3558,"KRN","B",101,101)

"BLD",3558,"KRN","B",409.61,409.61)

"BLD",3558,"KRN","B",771,771)

"BLD",3558,"KRN","B",870,870)

"BLD",3558,"KRN","B",8994,8994)

"BLD",3558,"QUES",0)
^9.62^^
"BLD",3558,"REQB",0)
^9.611^4^3
"BLD",3558,"REQB",1,0)
PX*1.0*122^2
"BLD",3558,"REQB",3,0)
PX*1.0*70^2
"BLD",3558,"REQB",4,0)
PX*1.0*111^2
"BLD",3558,"REQB","B","PX*1.0*111",4)

"BLD",3558,"REQB","B","PX*1.0*122",1)

"BLD",3558,"REQB","B","PX*1.0*70",3)

"KRN",19,11269,-1)
1^1
"KRN",19,11269,0)
PX PCE EDIT DISPOSITION CLINIC
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",327,-1)
1^1
"PKG",327,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)
"PKG",327,20,0)
^9.402P^^
"PKG",327,22,0)
^9.49I^1^1
"PKG",327,22,1,0)
1.0^2970109^2970108^1453
"PKG",327,22,1,"PAH",1,0)
116^3040401^823
"PKG",327,22,1,"PAH",1,1,0)
^^4^4^3040401
"PKG",327,22,1,"PAH",1,1,1,0)
This patch will modify PCE so that it will create a visit with the progress
"PKG",327,22,1,"PAH",1,1,2,0)
note associated with a disposition location in the same way like with
"PKG",327,22,1,"PAH",1,1,3,0)
other locations.
"PKG",327,22,1,"PAH",1,1,4,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PXAIVSTV")
0^4^B51076022
"RTN","PXAIVSTV",1,0)
PXAIVSTV ;ISL/JVS,ISA/KWP - VALIDATE THE VISIT DATA ; 1/7/02 3:54pm
"RTN","PXAIVSTV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**9,15,19,74,111,116**;Aug 12, 1996
"RTN","PXAIVSTV",3,0)
 ;
"RTN","PXAIVSTV",4,0)
 ;
"RTN","PXAIVSTV",5,0)
 Q
"RTN","PXAIVSTV",6,0)
VALSCC ;--VALIDATE SERVICE CONNECTIVENESS
"RTN","PXAIVSTV",7,0)
 N ERR,ERR1
"RTN","PXAIVSTV",8,0)
 D SCC^PXUTLSCC($G(PXAA("PATIENT")),$G(PXAA("ENC D/T")),$G(PXAA("HOS LOC")),$G(PXAVISIT),$G(AFTER800),.AFTER8A,.ERR)
"RTN","PXAIVSTV",9,0)
 ;PX*1*111 - Add HNC
"RTN","PXAIVSTV",10,0)
 I $P(ERR,"^",1)=0,$P(ERR,"^",2)=0,$P(ERR,"^",3)=0,$P(ERR,"^",4)=0,$P(ERR,"^",5)=0,$P(ERR,"^",6)=0 Q
"RTN","PXAIVSTV",11,0)
 S PXADI("DIALOG")=8390001.003
"RTN","PXAIVSTV",12,0)
 S PXAERRF=1
"RTN","PXAIVSTV",13,0)
 S PXAERR("1W")=$S($P(AFTER800,"^",1)']"":"NULL",1:$P(AFTER800,"^",1))
"RTN","PXAIVSTV",14,0)
 S PXAERR("2W")=$S($P(AFTER800,"^",2)']"":"NULL",1:$P(AFTER800,"^",2))
"RTN","PXAIVSTV",15,0)
 S PXAERR("3W")=$S($P(AFTER800,"^",3)']"":"NULL",1:$P(AFTER800,"^",3))
"RTN","PXAIVSTV",16,0)
 S PXAERR("4W")=$S($P(AFTER800,"^",4)']"":"NULL",1:$P(AFTER800,"^",4))
"RTN","PXAIVSTV",17,0)
 S PXAERR("5W")=$S($P(AFTER800,"^",5)']"":"NULL",1:$P(AFTER800,"^",5))
"RTN","PXAIVSTV",18,0)
 ;PX*1*111 - Add HNC
"RTN","PXAIVSTV",19,0)
 S PXAERR("16W")=$S($P(AFTER800,"^",6)']"":"NULL",1:$P(AFTER800,"^",6))
"RTN","PXAIVSTV",20,0)
 S ERR1=$P(ERR,"^",1),PXAERR("6W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",21,0)
 S ERR1=$P(ERR,"^",2),PXAERR("7W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",22,0)
 S ERR1=$P(ERR,"^",3),PXAERR("8W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",23,0)
 S ERR1=$P(ERR,"^",4),PXAERR("9W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",24,0)
 S ERR1=$P(ERR,"^",5),PXAERR("10W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",25,0)
 ;PX*1*111 - Add HNC
"RTN","PXAIVSTV",26,0)
 S ERR1=$P(ERR,"^",6),PXAERR("17W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",27,0)
 S PXAERR("11W")=$S($P(AFTER8A,"^",1)']"":"NULL",1:$P(AFTER8A,"^",1))
"RTN","PXAIVSTV",28,0)
 S PXAERR("12W")=$S($P(AFTER8A,"^",2)']"":"NULL",1:$P(AFTER8A,"^",2))
"RTN","PXAIVSTV",29,0)
 S PXAERR("13W")=$S($P(AFTER8A,"^",3)']"":"NULL",1:$P(AFTER8A,"^",3))
"RTN","PXAIVSTV",30,0)
 S PXAERR("14W")=$S($P(AFTER8A,"^",4)']"":"NULL",1:$P(AFTER8A,"^",4))
"RTN","PXAIVSTV",31,0)
 S PXAERR("15W")=$S($P(AFTER8A,"^",5)']"":"NULL",1:$P(AFTER8A,"^",5))
"RTN","PXAIVSTV",32,0)
 ;PX*1*111 - Add HNC
"RTN","PXAIVSTV",33,0)
 S PXAERR("18W")=$S($P(AFTER8A,"^",6)']"":"NULL",1:$P(AFTER8A,"^",6))
"RTN","PXAIVSTV",34,0)
 D ERR^PXAI K PXAERRF
"RTN","PXAIVSTV",35,0)
 Q
"RTN","PXAIVSTV",36,0)
 ;
"RTN","PXAIVSTV",37,0)
VAL ;--VALIDATE ENOUGH DATA
"RTN","PXAIVSTV",38,0)
 ;
"RTN","PXAIVSTV",39,0)
 ;---Is the visit sent TO US valid?
"RTN","PXAIVSTV",40,0)
 I $G(PXAVISIT) D  Q:$D(STOP)
"RTN","PXAIVSTV",41,0)
 .I '$D(^AUPNVSIT(PXAVISIT,0)) D  Q:$G(STOP)
"RTN","PXAIVSTV",42,0)
 ..S STOP=1
"RTN","PXAIVSTV",43,0)
 ..S PXAERRF=1
"RTN","PXAIVSTV",44,0)
 ..S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",45,0)
 ..S PXAERR(11)=$G(PXAVISIT)
"RTN","PXAIVSTV",46,0)
 ..S PXAERR(12)="The value that was sent to us is not a valid visit in the VISIT file # 9000010. The Patients name will be derived from the visit file and could cause the data to be given to the wrong patient if not correct."
"RTN","PXAIVSTV",47,0)
 ..S PXAERR(13)="If the correct VISIT isn't known, set the 'ENCOUNTER' array and we will look it up or create a correct one. Setting both at the same time will only add confusion as to what data is correct."
"RTN","PXAIVSTV",48,0)
 Q:$G(PXAVISIT)
"RTN","PXAIVSTV",49,0)
 ;
"RTN","PXAIVSTV",50,0)
 ;----Missing a date and time of visit
"RTN","PXAIVSTV",51,0)
 I $G(PXAA("ENC D/T"))']"" D  Q:$G(STOP)
"RTN","PXAIVSTV",52,0)
 .S STOP=1 ;--USED TO STOP DO LOOP
"RTN","PXAIVSTV",53,0)
 .S PXAERRF=1 ;--FLAG INDICATES THERE IS AN ERR
"RTN","PXAIVSTV",54,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",55,0)
 .S PXAERR(9)="ENC D/T"
"RTN","PXAIVSTV",56,0)
 .S PXAERR(11)=$G(PXAA("ENC D/T"))
"RTN","PXAIVSTV",57,0)
 .S PXAERR(12)="You are missing the date and time of the visit in FileManager internal format."
"RTN","PXAIVSTV",58,0)
 ;
"RTN","PXAIVSTV",59,0)
 ;----Missing Time and not Historical Visit
"RTN","PXAIVSTV",60,0)
 I $L($G(PXAA("ENC D/T")),".")=1,$G(PXAA("SERVICE CATEGORY"))'="E" D
"RTN","PXAIVSTV",61,0)
 .S STOP=1 ;--USED TO STOP DO LOOP
"RTN","PXAIVSTV",62,0)
 .S PXAERRF=1 ;--FLAG INDICATES THERE IS AN ERR
"RTN","PXAIVSTV",63,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",64,0)
 .S PXAERR(9)="ENC D/T"
"RTN","PXAIVSTV",65,0)
 .S PXAERR(11)=$G(PXAA("ENC D/T"))
"RTN","PXAIVSTV",66,0)
 .S PXAERR(12)="You are missing the TIME of the visit in FileManager internal format. Unless this is an HISTORICAL encounter, you must have the time."
"RTN","PXAIVSTV",67,0)
 ;
"RTN","PXAIVSTV",68,0)
 ;
"RTN","PXAIVSTV",69,0)
 ;
"RTN","PXAIVSTV",70,0)
 ;----MISSING a pointer to PATIENT/IHS FILE # 9000001
"RTN","PXAIVSTV",71,0)
 I $G(PXAA("PATIENT"))']"" D  Q:$G(STOP)
"RTN","PXAIVSTV",72,0)
 .S STOP=1
"RTN","PXAIVSTV",73,0)
 .S PXAERRF=1
"RTN","PXAIVSTV",74,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",75,0)
 .S PXAERR(9)="PATIENT"
"RTN","PXAIVSTV",76,0)
 .S PXAERR(11)=$G(PXAA("PATIENT"))
"RTN","PXAIVSTV",77,0)
 .S PXAERR(12)="Missing a pointer to the PATIENT/IHS file #9000001"
"RTN","PXAIVSTV",78,0)
 ;
"RTN","PXAIVSTV",79,0)
 ;
"RTN","PXAIVSTV",80,0)
 ;----Not a pointer to the PATIENT/IHS file #9000001
"RTN","PXAIVSTV",81,0)
 I '$D(^AUPNPAT($G(PXAA("PATIENT")),0)) D  Q:$G(STOP)
"RTN","PXAIVSTV",82,0)
 .S STOP=1
"RTN","PXAIVSTV",83,0)
 .S PXAERRF=1
"RTN","PXAIVSTV",84,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",85,0)
 .S PXAERR(9)="PATIENT"
"RTN","PXAIVSTV",86,0)
 .S PXAERR(11)=$G(PXAA("PATIENT"))
"RTN","PXAIVSTV",87,0)
 .S PXAERR(12)="This value is not a pointer to file PATIENT/IHS file # 9000001"
"RTN","PXAIVSTV",88,0)
 ;
"RTN","PXAIVSTV",89,0)
 ;---Missing required information
"RTN","PXAIVSTV",90,0)
 I $G(PXAA("OUTSIDE LOC"))']"",$G(PXAA("HOS LOC"))']"",$G(PXAA("SERVICE CATEGORY"))'="E" D  Q:$G(STOP)
"RTN","PXAIVSTV",91,0)
 .S STOP=1
"RTN","PXAIVSTV",92,0)
 .S PXAERRF=1
"RTN","PXAIVSTV",93,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",94,0)
 .S PXAERR(9)="HOS LOC or OUTSIDE LOC"
"RTN","PXAIVSTV",95,0)
 .S PXAERR(11)="BOTH ENTRIES ARE NULL AND SERVICE CATEGORY IS NOT ""E"""
"RTN","PXAIVSTV",96,0)
 .S PXAERR(12)="The HOSPITAL LOCATION (pointer to the HOSPITAL LOCATION file #44 ) needs to be sent in order to create a visit."
"RTN","PXAIVSTV",97,0)
 ;
"RTN","PXAIVSTV",98,0)
 ;---not a pointer to hospital location file
"RTN","PXAIVSTV",99,0)
 I $D(PXAA("HOS LOC")) D  Q:$G(STOP)
"RTN","PXAIVSTV",100,0)
 .I '$D(^SC($G(PXAA("HOS LOC")),0)) D  Q:$G(STOP)
"RTN","PXAIVSTV",101,0)
 ..S STOP=1
"RTN","PXAIVSTV",102,0)
 ..S PXAERRF=1
"RTN","PXAIVSTV",103,0)
 ..S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",104,0)
 ..S PXAERR(9)="HOS LOC"
"RTN","PXAIVSTV",105,0)
 ..S PXAERR(11)=$G(PXAA("HOS LOC"))
"RTN","PXAIVSTV",106,0)
 ..S PXAERR(12)="This HOSPITAL LOCATION is not a pointer to the HOSPITAL LOCATION file #44"
"RTN","PXAIVSTV",107,0)
 ;---hospital location is the dispositioning location
"RTN","PXAIVSTV",108,0)
 ;Allow a dispositioning location to be used
"RTN","PXAIVSTV",109,0)
 ;I $D(PXAA("HOS LOC")) D  Q:$G(STOP)  ;PX*1*116
"RTN","PXAIVSTV",110,0)
 ;.I $D(^PX(815,1,"DHL","B",$G(PXAA("HOS LOC")))) D  Q:$G(STOP)
"RTN","PXAIVSTV",111,0)
 ;..S STOP=1
"RTN","PXAIVSTV",112,0)
 ;..S PXAERRF=1
"RTN","PXAIVSTV",113,0)
 ;..S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",114,0)
 ;..S PXAERR(9)="HOS LOC"
"RTN","PXAIVSTV",115,0)
 ;..S PXAERR(11)=$G(PXAA("HOS LOC"))
"RTN","PXAIVSTV",116,0)
 ;..S PXAERR(12)="This HOSPITAL LOCATION is a dispositioning location and connot be used. Refer to entries in file#815 PCE PARAMETERS"
"RTN","PXAIVSTV",117,0)
 ;--Not a service category
"RTN","PXAIVSTV",118,0)
 I '$D(PXAA("SERVICE CATEGORY")) D  Q:$G(STOP)
"RTN","PXAIVSTV",119,0)
 .S STOP=1
"RTN","PXAIVSTV",120,0)
 .S PXAERRF=1
"RTN","PXAIVSTV",121,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",122,0)
 .S PXAERR(9)="SERVICE CATEGORY"
"RTN","PXAIVSTV",123,0)
 .S PXAERR(11)=$G(PXAA("SERVICE CATEGORY"))
"RTN","PXAIVSTV",124,0)
 .S PXAERR(12)="SERVICE CATEGORY is a required field"
"RTN","PXAIVSTV",125,0)
 Q
"RTN","PXAIVSTV",126,0)
 ;
"RTN","PXAIVSTV",127,0)
VPTR ;---Is the visit sent TO US valid?
"RTN","PXAIVSTV",128,0)
 I $G(PXAVISIT) D  Q:$D(STOP)
"RTN","PXAIVSTV",129,0)
 .I '$D(^AUPNVSIT(PXAVISIT,0)) D  Q:$G(STOP)
"RTN","PXAIVSTV",130,0)
 ..S STOP=1
"RTN","PXAIVSTV",131,0)
 ..S PXAK=1
"RTN","PXAIVSTV",132,0)
 ..S PXAERRF=1
"RTN","PXAIVSTV",133,0)
 ..S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",134,0)
 ..S PXAERR(7)="ENCOUNTER"
"RTN","PXAIVSTV",135,0)
 ..S PXAERR(9)="GENERAL NATURE"
"RTN","PXAIVSTV",136,0)
 ..S PXAERR(11)=$G(PXAVISIT)
"RTN","PXAIVSTV",137,0)
 ..S PXAERR(12)="The value that was sent to us is not a valid visit in the VISIT file # 9000010. The Patients name will be derived from the visit file and could cause the data to be given to the wrong patient if not correct."
"RTN","PXAIVSTV",138,0)
 ..S PXAERR(13)="If the correct VISIT isn't known, set the 'ENCOUNTER' array and we will look it up or create a correct one. Setting both at the same time will only add confusion as to what data is correct."
"RTN","PXAIVSTV",139,0)
 Q:$G(PXAVISIT)
"RTN","PXAIVSTV",140,0)
 Q
"RTN","PXBAPI1")
0^3^B45855402
"RTN","PXBAPI1",1,0)
PXBAPI1 ;ISL/JVS,dee - PCE's API - interview questions ;10/15/96
"RTN","PXBAPI1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**1,9,23,56,104,111,113,122,116**;Aug 12, 1996
"RTN","PXBAPI1",3,0)
 ;;
"RTN","PXBAPI1",4,0)
 Q
"RTN","PXBAPI1",5,0)
 ;
"RTN","PXBAPI1",6,0)
PROCESS(PXBEXIT) ;
"RTN","PXBAPI1",7,0)
 I WHAT="INTV" D
"RTN","PXBAPI1",8,0)
 . ;-- Interview is all of the questions
"RTN","PXBAPI1",9,0)
 . D ADQ(.PXBEXIT) I PXBEXIT<1 Q 
"RTN","PXBAPI1",10,0)
1 . D PRV(.PXBEXIT) I PXBEXIT<1 Q
"RTN","PXBAPI1",11,0)
3 . D POV(.PXBEXIT) I PXBEXIT<1 Q
"RTN","PXBAPI1",12,0)
2 . D CPT(.PXBEXIT) I PXBEXIT<1 Q
"RTN","PXBAPI1",13,0)
 . I $P($G(^AUPNVSIT($G(PXBVST),150)),"^",3)="O" S PXBEXIT=0 Q
"RTN","PXBAPI1",14,0)
 . I '$$DISPOSIT^PXUTL1($G(PXBPAT),$P($G(^AUPNVSIT(PXBVST,0)),"^",1),$G(PXBVST)) D STP(.PXBEXIT) I PXBEXIT<1 Q
"RTN","PXBAPI1",15,0)
 E  I WHAT="ADDEDIT" D
"RTN","PXBAPI1",16,0)
 . D ADDEDIT
"RTN","PXBAPI1",17,0)
 E  I WHAT="ADQ" D
"RTN","PXBAPI1",18,0)
 . ;-- Adminstrative questions
"RTN","PXBAPI1",19,0)
 . D ADQ(.PXBEXIT)
"RTN","PXBAPI1",20,0)
 E  I WHAT="CODT" D
"RTN","PXBAPI1",21,0)
 . ;-- Check out Date/Time
"RTN","PXBAPI1",22,0)
 . D CODT(.PXBEXIT)
"RTN","PXBAPI1",23,0)
 . Q:PXBEXIT<1
"RTN","PXBAPI1",24,0)
 . D VISIT(.PXBEXIT)
"RTN","PXBAPI1",25,0)
 . I PXBVST'>0 S PXBEXIT=-2 Q
"RTN","PXBAPI1",26,0)
 E  I WHAT="SCC" D
"RTN","PXBAPI1",27,0)
 . ;-- Service connected conditions
"RTN","PXBAPI1",28,0)
 . D SCC(.PXBEXIT)
"RTN","PXBAPI1",29,0)
 . Q:PXBEXIT<1
"RTN","PXBAPI1",30,0)
 . D VISIT(.PXBEXIT)
"RTN","PXBAPI1",31,0)
 . I PXBVST'>0 S PXBEXIT=-2 Q
"RTN","PXBAPI1",32,0)
 E  I WHAT="PRV" D
"RTN","PXBAPI1",33,0)
 . ;-- Providers
"RTN","PXBAPI1",34,0)
 . D PRV(.PXBEXIT)
"RTN","PXBAPI1",35,0)
 E  I WHAT="CPT" D
"RTN","PXBAPI1",36,0)
 . ;-- Providers and CPT codes
"RTN","PXBAPI1",37,0)
 . D CPT(.PXBEXIT)
"RTN","PXBAPI1",38,0)
 E  I WHAT="POV" D
"RTN","PXBAPI1",39,0)
 . ;-- Diagnoses
"RTN","PXBAPI1",40,0)
 . D POV(.PXBEXIT)
"RTN","PXBAPI1",41,0)
 E  I WHAT="STP" D
"RTN","PXBAPI1",42,0)
 . ;-- Stop Codes
"RTN","PXBAPI1",43,0)
 . D STP(.PXBEXIT)
"RTN","PXBAPI1",44,0)
 E  S PXBEXIT=-3 W !,"Procedure ""INTV^PXAPI"" was called incorrectly, contact IRM."
"RTN","PXBAPI1",45,0)
 Q
"RTN","PXBAPI1",46,0)
 ;
"RTN","PXBAPI1",47,0)
ADDEDIT ;
"RTN","PXBAPI1",48,0)
 N ANS
"RTN","PXBAPI1",49,0)
ADDEDIT1 ;
"RTN","PXBAPI1",50,0)
 D ADQ(.PXBEXIT)
"RTN","PXBAPI1",51,0)
 G:PXBEXIT<1 ADDEDIT2
"RTN","PXBAPI1",52,0)
 D PRV(.PXBEXIT)
"RTN","PXBAPI1",53,0)
 G:PXBEXIT<1 ADDEDIT2
"RTN","PXBAPI1",54,0)
 D POV(.PXBEXIT)
"RTN","PXBAPI1",55,0)
 G:PXBEXIT<1 ADDEDIT2
"RTN","PXBAPI1",56,0)
 ;
"RTN","PXBAPI1",57,0)
 ;Call to CPT is not determined by a credit stop code any more
"RTN","PXBAPI1",58,0)
 ;
"RTN","PXBAPI1",59,0)
 D CPT(.PXBEXIT)
"RTN","PXBAPI1",60,0)
 G:PXBEXIT<1 ADDEDIT2
"RTN","PXBAPI1",61,0)
ADDEDIT2 ;
"RTN","PXBAPI1",62,0)
 I PXBVST>0,'$D(^AUPNVCPT("AD",PXBVST)),'$D(^AUPNVSIT("AD",PXBVST)) D  I ANS'=1 S PXBEXIT=1 G ADDEDIT1
"RTN","PXBAPI1",63,0)
 . N DIR,X,Y
"RTN","PXBAPI1",64,0)
 . W !!
"RTN","PXBAPI1",65,0)
 . S DIR(0)="Y"
"RTN","PXBAPI1",66,0)
 . S DIR("A",1)="Must have a STOP CODE or a PROCEDURE to complete this action."
"RTN","PXBAPI1",67,0)
 . S DIR("A")="Do you want to delete this encounter"
"RTN","PXBAPI1",68,0)
 . S DIR("B")="NO"
"RTN","PXBAPI1",69,0)
 . D ^DIR
"RTN","PXBAPI1",70,0)
 . S ANS=Y
"RTN","PXBAPI1",71,0)
 . Q:ANS'=1
"RTN","PXBAPI1",72,0)
 . I $$DELVFILE^PXAPIDEL("ALL",PXBVST,"","","","","")=1 S PXBEXIT=-1
"RTN","PXBAPI1",73,0)
 I PXBVST>0,'$D(^AUPNVSIT(PXBVST,0)) S PXBVST=""
"RTN","PXBAPI1",74,0)
 Q
"RTN","PXBAPI1",75,0)
 ;
"RTN","PXBAPI1",76,0)
ADQ(PXBEXIT) ;Ask the Administration questions
"RTN","PXBAPI1",77,0)
 I PXBVST'>0 D
"RTN","PXBAPI1",78,0)
 . ;This is only done for new visits
"RTN","PXBAPI1",79,0)
 . I PXBPAT'>0 S PXBPAT=$$ASKPAT I PXBPAT'>0 S PXBEXIT=-1 Q
"RTN","PXBAPI1",80,0)
 . S DFN=PXBPAT
"RTN","PXBAPI1",81,0)
 . I PXBHLOC'>0 S PXBHLOC=$$ASKHL I PXBHLOC'>0 S PXBEXIT=-1 Q
"RTN","PXBAPI1",82,0)
 . S PXBVSTDT=$S(PXBAPPT>0:PXBAPPT,1:$$ASKDT) I PXBVSTDT'>0 S PXBEXIT=-1 Q
"RTN","PXBAPI1",83,0)
 . I PXBAPPT'>0&PXBHLOC'=+$G(^DPT(PXBPAT,"S",PXBVSTDT,0)) D
"RTN","PXBAPI1",84,0)
 .. ;This is only done if there is no appointment.
"RTN","PXBAPI1",85,0)
 .. S PXELAP=$$ELAP^SDPCE(PXBPAT,PXBHLOC)
"RTN","PXBAPI1",86,0)
 I PXBEXIT'<1,PXBHLOC'>0 S PXBHLOC=$$ASKHL I PXBHLOC'>0 S PXBEXIT=-1 Q
"RTN","PXBAPI1",87,0)
 I PXBEXIT'<1 D CODT(.PXBEXIT)
"RTN","PXBAPI1",88,0)
 I PXBEXIT'<1 D SCC(.PXBEXIT)
"RTN","PXBAPI1",89,0)
 I PXBEXIT'<1 D
"RTN","PXBAPI1",90,0)
 . D VISIT(.PXBEXIT)
"RTN","PXBAPI1",91,0)
 . I PXBVST'>0 S PXBEXIT=-2 Q
"RTN","PXBAPI1",92,0)
 Q
"RTN","PXBAPI1",93,0)
 ;
"RTN","PXBAPI1",94,0)
ASKPAT() ;Ask user for a patient
"RTN","PXBAPI1",95,0)
 ;DIC on file 9000001
"RTN","PXBAPI1",96,0)
 N DIR,DIC,Y,X,DA
"RTN","PXBAPI1",97,0)
 S DIR(0)="P^9000001:AEMQ"
"RTN","PXBAPI1",98,0)
 S DIR("A")="Patient Name"
"RTN","PXBAPI1",99,0)
 D ^DIR
"RTN","PXBAPI1",100,0)
 Q $S(+Y>0:+Y,1:-1)
"RTN","PXBAPI1",101,0)
 ;
"RTN","PXBAPI1",102,0)
ASKHL() ;Ask user for a Hospital Location
"RTN","PXBAPI1",103,0)
ASKHL2 ;DIC on file 44
"RTN","PXBAPI1",104,0)
 N DIR,DIC,Y,X,DA
"RTN","PXBAPI1",105,0)
 S DIR(0)="PA^44:AEMQ"
"RTN","PXBAPI1",106,0)
 S DIR("A")="Clinic: "
"RTN","PXBAPI1",107,0)
 ; not occasion of service and not dispositioning
"RTN","PXBAPI1",108,0)
 ;I PXALHLOC S DIR("S")="I '+$G(^(""OOS""))&'$O(^PX(815,1,""DHL"",""B"",Y,0))"
"RTN","PXBAPI1",109,0)
 ; not occasion of service only  ;PX*1*116
"RTN","PXBAPI1",110,0)
 I PXALHLOC S DIR("S")="I '+$G(^(""OOS""))"   ;PX*1*116
"RTN","PXBAPI1",111,0)
 ; only clinic that are not occasion of service and not dispositioning
"RTN","PXBAPI1",112,0)
 ;E  S DIR("S")="I $P(^(0),U,3)=""C""&'+$G(^(""OOS""))&'$O(^PX(815,1,""DHL"",""B"",Y,0))"
"RTN","PXBAPI1",113,0)
 E  S DIR("S")="I $P(^(0),U,3)=""C""&'+$G(^(""OOS""))"
"RTN","PXBAPI1",114,0)
 D ^DIR
"RTN","PXBAPI1",115,0)
 ;enable to select a disposition clinic
"RTN","PXBAPI1",116,0)
 ;I $D(^PX(815,1,"DHL","B",+Y)) D HELPDISP^PXCEVSIT W !,$C(7) G ASKHL2
"RTN","PXBAPI1",117,0)
 Q $S(+Y>0:+Y,1:-1)
"RTN","PXBAPI1",118,0)
 ;
"RTN","PXBAPI1",119,0)
ASKDT() ;Ask user for the encounter Date/Time
"RTN","PXBAPI1",120,0)
 N DIR,Y,X,DA
"RTN","PXBAPI1",121,0)
 S DIR(0)="D^"_$S(PXLIMDT>2960000:PXLIMDT,1:"")_":"_(DT+.24)_":AEPRSX"
"RTN","PXBAPI1",122,0)
 S DIR("A")="Encounter Date and Time"
"RTN","PXBAPI1",123,0)
 S DIR("?")="Enter the Date and Time of this encounter"
"RTN","PXBAPI1",124,0)
 D ^DIR
"RTN","PXBAPI1",125,0)
 Q $S(+Y>0:+Y,1:-1)
"RTN","PXBAPI1",126,0)
 ;
"RTN","PXBAPI1",127,0)
CODT(PXBEXIT) ;Ask the user the Check out Date/Time
"RTN","PXBAPI1",128,0)
 N PXCHKOUT
"RTN","PXBAPI1",129,0)
 D CHIKOUT^PXBAPI2("",PXBPAT,PXBHLOC,PXBVSTDT)
"RTN","PXBAPI1",130,0)
 S PXBCODT=PXCHKOUT
"RTN","PXBAPI1",131,0)
 S:PXCHKOUT=-1 PXBCODT=""
"RTN","PXBAPI1",132,0)
 ;; PX*1*113 - Change for EAS*1*3 Appointment processing removed
"RTN","PXBAPI1",133,0)
 ;S X="EASMTCHK" X ^%ZOSF("TEST") I $T D  Q:PXBEXIT<1
"RTN","PXBAPI1",134,0)
 ;. S:$G(EASACT)'="W" EASACT="C"
"RTN","PXBAPI1",135,0)
 ;. I $$MT^EASMTCHK(PXBPAT,"",EASACT,PXBVSTDT) D  S PXBEXIT=-1
"RTN","PXBAPI1",136,0)
 ;. . D PAUSE^VALM1
"RTN","PXBAPI1",137,0)
 I WHAT'["ADDEDIT",PXCHKOUT=-1 S PXBEXIT=-1
"RTN","PXBAPI1",138,0)
 I $G(PXBVST),$$DISPOSIT^PXUTL1(DFN,$P($G(^AUPNVSIT(PXBVST,0)),"^",1),PXBVST) S PXBEXIT=1
"RTN","PXBAPI1",139,0)
 Q
"RTN","PXBAPI1",140,0)
 ;
"RTN","PXBAPI1",141,0)
SCC(PXBEXIT) ;Ask the user the Service connected conditions
"RTN","PXBAPI1",142,0)
 N PXBDATA,PXBCLASS,PXBOUTEN
"RTN","PXBAPI1",143,0)
 S PXBOUTEN=""
"RTN","PXBAPI1",144,0)
 ;I $$APPOINT^PXUTL1(PXBPAT,PXBVSTDT,PXBHLOC) D
"RTN","PXBAPI1",145,0)
 ;. S PXBOUTEN=$P($G(^DPT(+PXBPAT,"S",+PXBVSTDT,0)),"^",20)
"RTN","PXBAPI1",146,0)
 ;E  I $$DISPOSIT^PXUTL1(PXBPAT,PXBVSTDT,PXBVST) D
"RTN","PXBAPI1",147,0)
 ;. S PXBOUTEN=+$P($G(^DPT(+PXBPAT,"DIS",9999999-PXBVSTDT,0)),"^",18)
"RTN","PXBAPI1",148,0)
 ;I 'PXBOUTEN,$G(PXBVST)>0 S PXBOUTEN=$O(^SCE("AVSIT",PXBVST,0))
"RTN","PXBAPI1",149,0)
 ;D CLASS^PXBAPI21(PXBOUTEN,PXBPAT,PXBVSTDT,PXBHLOC)
"RTN","PXBAPI1",150,0)
 D CLASS^PXBAPI21(PXBOUTEN,PXBPAT,PXBVSTDT,PXBHLOC,PXBVST)
"RTN","PXBAPI1",151,0)
 ;PX*1*111 - Add HNC
"RTN","PXBAPI1",152,0)
 F PXBCLASS=1:1:6 I $G(PXBDATA("ERR",PXBCLASS))=4 S PXBEXIT=-1 Q  ; changed 6/17/98 for MST enhancement
"RTN","PXBAPI1",153,0)
 Q:PXBEXIT<1
"RTN","PXBAPI1",154,0)
 S PXB800(1)=$P($G(PXBDATA(3)),"^",2)
"RTN","PXBAPI1",155,0)
 S PXB800(2)=$P($G(PXBDATA(1)),"^",2)
"RTN","PXBAPI1",156,0)
 S PXB800(3)=$P($G(PXBDATA(2)),"^",2)
"RTN","PXBAPI1",157,0)
 S PXB800(4)=$P($G(PXBDATA(4)),"^",2)
"RTN","PXBAPI1",158,0)
 S PXB800(5)=$P($G(PXBDATA(5)),"^",2) ;added 6/17/98 for MST enhancement
"RTN","PXBAPI1",159,0)
 ;PX*1*111 - Add HNC
"RTN","PXBAPI1",160,0)
 S PXB800(6)=$P($G(PXBDATA(6)),"^",2)
"RTN","PXBAPI1",161,0)
 Q
"RTN","PXBAPI1",162,0)
 ;
"RTN","PXBAPI1",163,0)
VISIT(PXBEXIT) ;Creat or edit the Visit
"RTN","PXBAPI1",164,0)
 ;Set up ^TMP("PXK",$J and call PXK
"RTN","PXBAPI1",165,0)
 I PXBVST>0 L +^AUPNVSIT(PXBVST):10 E  W !!,$C(7),"Cannot edit at this time, try again later." D WAIT^PXCEHELP S PXBEXIT=-2 Q
"RTN","PXBAPI1",166,0)
 K ^TMP("PXK",$J)
"RTN","PXBAPI1",167,0)
 N PXBNODE,PXBAFTER,PXKERROR
"RTN","PXBAPI1",168,0)
 F PXBNODE=0,21,150,800,811,812 D
"RTN","PXBAPI1",169,0)
 . S PXBAFTER(PXBNODE)=$S(PXBVST>0:$G(^AUPNVSIT(PXBVST,PXBNODE)),1:"")
"RTN","PXBAPI1",170,0)
 . S ^TMP("PXK",$J,"VST",1,PXBNODE,"BEFORE")=PXBAFTER(PXBNODE)
"RTN","PXBAPI1",171,0)
 I PXBVST'>0 D
"RTN","PXBAPI1",172,0)
 . S $P(PXBAFTER(0),"^",1)=PXBVSTDT
"RTN","PXBAPI1",173,0)
 . S $P(PXBAFTER(0),"^",5)=PXBPAT
"RTN","PXBAPI1",174,0)
 . S $P(PXBAFTER(0),"^",8)=$P(^SC(PXBHLOC,0),"^",7)
"RTN","PXBAPI1",175,0)
 . S:PXBAPPT>0 $P(PXBAFTER(0),"^",16)="A"
"RTN","PXBAPI1",176,0)
 . S $P(PXBAFTER(150),"^",3)="P"
"RTN","PXBAPI1",177,0)
 . S $P(PXBAFTER(812),"^",2)=PXBPKG
"RTN","PXBAPI1",178,0)
 . S $P(PXBAFTER(812),"^",3)=PXBSOURC
"RTN","PXBAPI1",179,0)
 S $P(PXBAFTER(0),"^",18)=$G(PXBCODT)
"RTN","PXBAPI1",180,0)
 S:$P(PXBAFTER(0),"^",22)="" $P(PXBAFTER(0),"^",22)=PXBHLOC
"RTN","PXBAPI1",181,0)
 S $P(PXBAFTER(800),"^",1)=$G(PXB800(1))
"RTN","PXBAPI1",182,0)
 S $P(PXBAFTER(800),"^",2)=$G(PXB800(2))
"RTN","PXBAPI1",183,0)
 S $P(PXBAFTER(800),"^",3)=$G(PXB800(3))
"RTN","PXBAPI1",184,0)
 S $P(PXBAFTER(800),"^",4)=$G(PXB800(4))
"RTN","PXBAPI1",185,0)
 S $P(PXBAFTER(800),"^",5)=$G(PXB800(5)) ;added 6/17/98 for MST emhancement
"RTN","PXBAPI1",186,0)
 ;PX*1*111 - Add HNC
"RTN","PXBAPI1",187,0)
 S $P(PXBAFTER(800),"^",6)=$G(PXB800(6))
"RTN","PXBAPI1",188,0)
 I $D(PXELAP)#2 D
"RTN","PXBAPI1",189,0)
 . S $P(PXBAFTER(0),"^",21)=+PXELAP
"RTN","PXBAPI1",190,0)
 F PXBNODE=0,21,150,800,811,812 D
"RTN","PXBAPI1",191,0)
 . S ^TMP("PXK",$J,"VST",1,PXBNODE,"AFTER")=PXBAFTER(PXBNODE)
"RTN","PXBAPI1",192,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=$S(PXBVST>0:PXBVST,1:"")
"RTN","PXBAPI1",193,0)
 S ^TMP("PXK",$J,"SOR")=PXBSOURC
"RTN","PXBAPI1",194,0)
 D EN1^PXKMAIN
"RTN","PXBAPI1",195,0)
 I PXBVST>0 L -^AUPNVSIT(PXBVST):5
"RTN","PXBAPI1",196,0)
 S PXBVST=$G(^TMP("PXK",$J,"VST",1,"IEN"))
"RTN","PXBAPI1",197,0)
 Q
"RTN","PXBAPI1",198,0)
 ;
"RTN","PXBAPI1",199,0)
CPT(PXBEXIT) ;Ask the user Providers and CTPs
"RTN","PXBAPI1",200,0)
 D CPT^PXBMCPT(PXBVST) K PRVDR
"RTN","PXBAPI1",201,0)
 Q
"RTN","PXBAPI1",202,0)
 ;
"RTN","PXBAPI1",203,0)
POV(PXBEXIT) ;Ask the user Diagnoses
"RTN","PXBAPI1",204,0)
 D POV^PXBMPOV(PXBVST) K PRVDR
"RTN","PXBAPI1",205,0)
 Q
"RTN","PXBAPI1",206,0)
 ;
"RTN","PXBAPI1",207,0)
PRV(PXBEXIT) ;Ask the user Providers
"RTN","PXBAPI1",208,0)
 D PRV^PXBMPRV(PXBVST,"PRV") K PRVDR
"RTN","PXBAPI1",209,0)
 Q
"RTN","PXBAPI1",210,0)
 ;
"RTN","PXBAPI1",211,0)
STP(PXBEXIT) ;Ask the user Stop Codes
"RTN","PXBAPI1",212,0)
 I $L($T(DATE^SCDXUTL)),$$DATE^SCDXUTL(+$G(^AUPNVSIT(PXBVST,0))) Q
"RTN","PXBAPI1",213,0)
 D STP^PXBMSTP(PXBVST) K PRVDR
"RTN","PXBAPI1",214,0)
 Q
"RTN","PXBAPI1",215,0)
 ;
"RTN","PXCAVST")
0^2^B33433105
"RTN","PXCAVST",1,0)
PXCAVST ;ISL/dee & LEA/Chylton - Validates data from the PCE Device Interface for the Visit and Providers ; 1/7/02 11:40am
"RTN","PXCAVST",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**14,33,74,111,116**;Aug 12, 1996
"RTN","PXCAVST",3,0)
 Q
"RTN","PXCAVST",4,0)
 ;
"RTN","PXCAVST",5,0)
ENCOUNT(PXCA,PXCABULD,PXCAERRS,PXCAEVAL) ;
"RTN","PXCAVST",6,0)
 I '($D(PXCA("ENCOUNTER"))#2) S PXCA("ERROR","ENCOUNTER",0,0,0)="ENCOUNTER node of the local data array is missing" Q
"RTN","PXCAVST",7,0)
 N PXCAENC
"RTN","PXCAVST",8,0)
 N PXCAITEM,PXCAITM2,PXCAOUT,PXCAERR
"RTN","PXCAVST",9,0)
 S PXCAENC=$G(PXCA("ENCOUNTER"))
"RTN","PXCAVST",10,0)
 I PXCAENC="" S PXCA("ERROR","ENCOUNTER",0,0,0)="ENCOUNTER data missing" Q
"RTN","PXCAVST",11,0)
 I '($D(^DPT(PXCAPAT,0))#2) S PXCA("ERROR","ENCOUNTER",0,0,2)="Patient missing or invalid in file 2^"_PXCAPAT
"RTN","PXCAVST",12,0)
 I '($D(^AUPNPAT(PXCAPAT,0))#2) S PXCA("ERROR","ENCOUNTER",0,0,2)="Patient missing or invalid in file 9000001^"_PXCAPAT
"RTN","PXCAVST",13,0)
 S PXCAITEM=+$P(PXCAENC,"^",1)
"RTN","PXCAVST",14,0)
 I 'PXCAITEM S PXCA("ERROR","ENCOUNTER",0,0,1)="Encounter Data/Time Missing^"_PXCAITEM
"RTN","PXCAVST",15,0)
 E  I $D(^DPT(PXCAPAT,"S",PXCAITEM,0)),$D(^SC(+PXCAHLOC,0)),^DPT(PXCAPAT,"S",PXCAITEM,0),PXCAHLOC D
"RTN","PXCAVST",16,0)
 . ;Have an appointment at this time
"RTN","PXCAVST",17,0)
 . N VASD,VAERR
"RTN","PXCAVST",18,0)
 . S VASD("W")=345678
"RTN","PXCAVST",19,0)
 . S VASD("F")=PXCAITEM-.0000001
"RTN","PXCAVST",20,0)
 . S VASD("T")=PXCAITEM+.0000001
"RTN","PXCAVST",21,0)
 . S VASD("C",PXCAHLOC)=""
"RTN","PXCAVST",22,0)
 . D SDA^VADPT
"RTN","PXCAVST",23,0)
 . I $D(^UTILITY("VASD",$J)) S PXCA("ERROR","ENCOUNTER",0,0,1)="Appointment is No Show or Canceled^"_PXCAITEM
"RTN","PXCAVST",24,0)
 I '$D(^DPT(PXCAPAT,"S",PXCAITEM,0))!(+$G(^DPT(PXCAPAT,"S",PXCAITEM,0))'=PXCAHLOC),'(+$P(PXCAENC,"^",5)),'$D(PXCA("PROCEDURE")),'$D(^AUPNVCPT("AD",+PXCAVSIT)) D
"RTN","PXCAVST",25,0)
 . S PXCA("ERROR","ENCOUNTER",0,0,1)="Encounters that do not have an appointment must have a procedure^"
"RTN","PXCAVST",26,0)
 E  I PXCAITEM>(DT+.7) S PXCA("ERROR","ENCOUNTER",0,0,1)="Encounter Date/Time is later that today^"_PXCAITEM
"RTN","PXCAVST",27,0)
 I '$D(^SC(PXCAHLOC,0)) S PXCA("ERROR","ENCOUNTER",0,0,3)="HOSPITAL LOCATION Missing is not in file 44^"_PXCAHLOC
"RTN","PXCAVST",28,0)
 ;Allow a disposition clinic to be used as HOSPITAL LOCATION; PX*1*116
"RTN","PXCAVST",29,0)
 ;I $D(^PX(815,1,"DHL","B",PXCAHLOC)) S PXCA("ERROR","ENCOUNTER",0,0,3)="HOSPITAL LOCATION Can not be a disposition clinic^"_PXCAHLOC
"RTN","PXCAVST",30,0)
 D EVALCODE^PXCAVST2(.PXCAEVAL)
"RTN","PXCAVST",31,0)
 D SCC^PXUTLSCC(PXCAPAT,PXCADT,PXCAHLOC,PXCAVSIT,$P(PXCAENC,"^",6,11),.PXCAOUT,.PXCAERR)
"RTN","PXCAVST",32,0)
 S PXCAITEM=$P(PXCAERR,"^",1)
"RTN","PXCAVST",33,0)
 I PXCAITEM=-1 S PXCA("ERROR","ENCOUNTER",0,0,6)="SC flag bad^"_$P(PXCAENC,"^",6)
"RTN","PXCAVST",34,0)
 I PXCAITEM=-2,$P(PXCAENC,"^",6)=1 S PXCA("WARNING","ENCOUNTER",0,0,6)="SC flag must be N/A not YES for this patient^"_$P(PXCAENC,"^",6)
"RTN","PXCAVST",35,0)
 I PXCAITEM=1,$P($G(^PX(815,1,"DI")),"^",1) S PXCA("WARNING","ENCOUNTER",0,0,6)="SC flag is missing^"_$P(PXCAENC,"^",6)
"RTN","PXCAVST",36,0)
 S PXCAITEM=$P(PXCAERR,"^",2)
"RTN","PXCAVST",37,0)
 I PXCAITEM=-1 S PXCA("ERROR","ENCOUNTER",0,0,7)="AO flag bad^"_$P(PXCAENC,"^",7)
"RTN","PXCAVST",38,0)
 I PXCAITEM=-2,$P(PXCAENC,"^",7)=1 S PXCA("WARNING","ENCOUNTER",0,0,7)="AO flag must be N/A not YES for this patient^"_$P(PXCAENC,"^",7)
"RTN","PXCAVST",39,0)
 I PXCAITEM=-3,$P(PXCAENC,"^",7)=1 S PXCA("WARNING","ENCOUNTER",0,0,7)="AO flag must be N/A not YES because SC flag is true^"_$P(PXCAENC,"^",7)
"RTN","PXCAVST",40,0)
 I PXCAITEM=1,$P($G(^PX(815,1,"DI")),"^",1) S PXCA("WARNING","ENCOUNTER",0,0,7)="AO flag is missing^"_$P(PXCAENC,"^",7)
"RTN","PXCAVST",41,0)
 S PXCAITEM=$P(PXCAERR,"^",3)
"RTN","PXCAVST",42,0)
 I PXCAITEM=-1 S PXCA("ERROR","ENCOUNTER",0,0,8)="IR flag bad^"_$P(PXCAENC,"^",8)
"RTN","PXCAVST",43,0)
 I PXCAITEM=-2,$P(PXCAENC,"^",8)=1 S PXCA("WARNING","ENCOUNTER",0,0,8)="IR flag must be N/A not YES for this patient^"_$P(PXCAENC,"^",8)
"RTN","PXCAVST",44,0)
 I PXCAITEM=-3,$P(PXCAENC,"^",8)=1 S PXCA("WARNING","ENCOUNTER",0,0,8)="IR flag must be N/A not YES because SC flag is true^"_$P(PXCAENC,"^",8)
"RTN","PXCAVST",45,0)
 I PXCAITEM=1,$P($G(^PX(815,1,"DI")),"^",1) S PXCA("WARNING","ENCOUNTER",0,0,8)="IR flag is missing^"_$P(PXCAENC,"^",8)
"RTN","PXCAVST",46,0)
 S PXCAITEM=$P(PXCAERR,"^",4)
"RTN","PXCAVST",47,0)
 I PXCAITEM=-1 S PXCA("ERROR","ENCOUNTER",0,0,9)="EC flag bad^"_$P(PXCAENC,"^",9)
"RTN","PXCAVST",48,0)
 I PXCAITEM=-2,$P(PXCAENC,"^",9)=1 S PXCA("WARNING","ENCOUNTER",0,0,9)="EC flag must be N/A not YES for this patient^"_$P(PXCAENC,"^",9)
"RTN","PXCAVST",49,0)
 I PXCAITEM=-3,$P(PXCAENC,"^",9)=1 S PXCA("WARNING","ENCOUNTER",0,0,9)="EC flag must be N/A not YES because SC flag is true^"_$P(PXCAENC,"^",9)
"RTN","PXCAVST",50,0)
 I PXCAITEM=1,$P($G(^PX(815,1,"DI")),"^",1) S PXCA("WARNING","ENCOUNTER",0,0,9)="EC flag is missing^"_$P(PXCAENC,"^",9)
"RTN","PXCAVST",51,0)
 S PXCAITEM=$P(PXCAERR,"^",5)
"RTN","PXCAVST",52,0)
 I PXCAITEM=-1 S PXCA("ERROR","ENCOUNTER",0,0,10)="MST flag bad^"_$P(PXCAENC,"^",10)
"RTN","PXCAVST",53,0)
 I PXCAITEM=-2,$P(PXCAENC,"^",10)=1 S PXCA("WARNING","ENCOUNTER",0,0,10)="MST flag must be N/A not YES for this patient^"_$P(PXCAENC,"^",10)
"RTN","PXCAVST",54,0)
 S PXCAITEM=$P(PXCAERR,"^",16)
"RTN","PXCAVST",55,0)
 I PXCAITEM=-1 S PXCA("ERROR","ENCOUNTER",0,0,18)="HNC flag bad^"_$P(PXCAENC,"^",17)
"RTN","PXCAVST",56,0)
 I PXCAITEM=-2,$P(PXCAENC,"^",11)=1 S PXCA("WARNING","ENCOUNTER",0,0,17)="HNC flag must be N/A not YES for this patient^"_$P(PXCAENC,"^",17)
"RTN","PXCAVST",57,0)
 S $P(PXCAENC,"^",6,11)=PXCAOUT
"RTN","PXCAVST",58,0)
 S PXCAITEM=+$P(PXCAENC,"^",13)
"RTN","PXCAVST",59,0)
 I PXCAITEM D
"RTN","PXCAVST",60,0)
 . N PXCADILF,DIERR
"RTN","PXCAVST",61,0)
 . S PXCAITM2=$$EXTERNAL^DILFD(9000010,.21,"",PXCAITEM,"PXCADILF")
"RTN","PXCAVST",62,0)
 . I $D(DIERR) S PXCA("ERROR","ENCOUNTER",0,0,13)="Eligibility code not in File 8^"_PXCAITEM
"RTN","PXCAVST",63,0)
 . E  I PXCAITEM=$P($G(PXCAPAT("ELIG")),"^",1)
"RTN","PXCAVST",64,0)
 . E  I $D(PXCAPAT("ELIG",PXCAITEM))=1
"RTN","PXCAVST",65,0)
 . E  S PXCA("ERROR","ENCOUNTER",0,0,13)="Eligibility code is not one of this patient's Eligibilities^"_PXCAITEM
"RTN","PXCAVST",66,0)
 S PXCAITEM=+$P(PXCAENC,"^",14)
"RTN","PXCAVST",67,0)
 I PXCAITEM=0
"RTN","PXCAVST",68,0)
 E  I PXCAITEM>(DT+.7) S PXCA("ERROR","ENCOUNTER",0,0,14)="Check-out Date and Time is later that today^"_PXCAITEM
"RTN","PXCAVST",69,0)
 E  I PXCAITEM#1=0 S PXCA("ERROR","ENCOUNTER",0,0,14)="Time is required for Check-out Date and Time^"_PXCAITEM
"RTN","PXCAVST",70,0)
 I PXCACSTP'="" D
"RTN","PXCAVST",71,0)
 . I '$D(^DIC(40.7,+PXCACSTP,0)) S PXCA("ERROR","ENCOUNTER",0,0,17)="Optional CREDIT STOP not in File 40.7^"_PXCACSTP
"RTN","PXCAVST",72,0)
 . E  I $P(^DIC(40.7,+PXCACSTP,0),"^",3),PXCADT'<$P(^(0),"^",3) S PXCA("ERROR","ENCOUNTER",0,0,17)="Optional CREDIT STOP is inactive in file 40.7^"_PXCACSTP
"RTN","PXCAVST",73,0)
 ;
"RTN","PXCAVST",74,0)
 I PXCABULD&'$D(PXCA("ERROR","ENCOUNTER"))!PXCAERRS D VST^PXCAVST1(PXCAENC)
"RTN","PXCAVST",75,0)
 ;
"RTN","PXCAVST",76,0)
 D PROVIDER^PXCAVST2
"RTN","PXCAVST",77,0)
 ;
"RTN","PXCAVST",78,0)
 Q
"RTN","PXCAVST",79,0)
 ;
"RTN","PXCEVSIT")
0^1^B23642458
"RTN","PXCEVSIT",1,0)
PXCEVSIT ;slc/dee,ISA/KWP-Used in editing a visit ; 1/7/02 11:36am
"RTN","PXCEVSIT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**9,23,70,116**;Aug 12, 1996
"RTN","PXCEVSIT",3,0)
 Q
"RTN","PXCEVSIT",4,0)
 ;
"RTN","PXCEVSIT",5,0)
 ;********************************
"RTN","PXCEVSIT",6,0)
 ;
"RTN","PXCEVSIT",7,0)
 ;Functions
"RTN","PXCEVSIT",8,0)
 ;
"RTN","PXCEVSIT",9,0)
ELIGIBIL(PATIENT,HOSPLOC,DATETIME) ;+Eligibility from appointment if there is one.
"RTN","PXCEVSIT",10,0)
 Q:$G(PATIENT)'>0 -1
"RTN","PXCEVSIT",11,0)
 Q:$G(HOSPLOC)'>0 -1
"RTN","PXCEVSIT",12,0)
 Q:$G(DATETIME)'>1600000 -1
"RTN","PXCEVSIT",13,0)
 Q:'($D(^SC(HOSPLOC,"S",DATETIME,1))\10) -1
"RTN","PXCEVSIT",14,0)
 N PXCEELIG,PXCEINDX
"RTN","PXCEVSIT",15,0)
 S PXCEELIG=-1
"RTN","PXCEVSIT",16,0)
 S PXCEINDX=0
"RTN","PXCEVSIT",17,0)
 F  S PXCEINDX=$O(^SC(HOSPLOC,"S",DATETIME,1,PXCEINDX)) Q:PXCEINDX=""  I $P($G(^SC(HOSPLOC,"S",DATETIME,1,PXCEINDX,0)),"^",1)=PATIENT S PXCEELIG=$S($P(^(0),"^",10)>0:$P(^(0),"^",10),1:-1) Q
"RTN","PXCEVSIT",18,0)
 Q PXCEELIG
"RTN","PXCEVSIT",19,0)
 ;
"RTN","PXCEVSIT",20,0)
 ;********************************
"RTN","PXCEVSIT",21,0)
 ;Special cases for edit of the visit.
"RTN","PXCEVSIT",22,0)
 ;
"RTN","PXCEVSIT",23,0)
EVISITDT(REQTIME,DEFAULT) ;
"RTN","PXCEVSIT",24,0)
 ;+REQTIME is 1 if time is required,
"RTN","PXCEVSIT",25,0)
 ;+           0 if time is optional
"RTN","PXCEVSIT",26,0)
 ;+          -1 if the date can be imprecise
"RTN","PXCEVSIT",27,0)
 ;+DEFAULT is the default date/time is there is not one in the file.
"RTN","PXCEVSIT",28,0)
 ;+        If it is -1 then NOW will be used as the default.
"RTN","PXCEVSIT",29,0)
 ;+        If it is 0 then TODAY will be used as the default.
"RTN","PXCEVSIT",30,0)
 N PXLIMDT
"RTN","PXCEVSIT",31,0)
 S PXLIMDT=$S(PXCECAT="HIST":0,1:$$SWITCHD^PXAPI)
"RTN","PXCEVSIT",32,0)
 S DIR(0)="DO^"_$S(PXLIMDT>2960000:PXLIMDT,1:"")_":"_(DT+.24)_":ESP"
"RTN","PXCEVSIT",33,0)
 I $G(REQTIME)=1 S DIR(0)=DIR(0)_"RX"
"RTN","PXCEVSIT",34,0)
 E  I $G(REQTIME)=-1 S DIR(0)=DIR(0)_"T"
"RTN","PXCEVSIT",35,0)
 E  S DIR(0)=DIR(0)_"TX"
"RTN","PXCEVSIT",36,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" S DIR("B")=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVSIT",37,0)
 E  I ($D(DEFAULT)#2) D
"RTN","PXCEVSIT",38,0)
 . N %H,%I,%
"RTN","PXCEVSIT",39,0)
 . I DEFAULT>0 S DIR("B")=DEFAULT
"RTN","PXCEVSIT",40,0)
 . E  I DEFAULT=0 S DIR("B")=DT
"RTN","PXCEVSIT",41,0)
 . E  I DEFAULT=-1 D NOW^%DTC S DIR("B")=%
"RTN","PXCEVSIT",42,0)
 I $D(DIR("B"))#2 S Y=DIR("B") D DD^%DT S DIR("B")=Y
"RTN","PXCEVSIT",43,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVSIT",44,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVSIT",45,0)
 D ^DIR
"RTN","PXCEVSIT",46,0)
 K DIR,DA
"RTN","PXCEVSIT",47,0)
 Q
"RTN","PXCEVSIT",48,0)
 ;
"RTN","PXCEVSIT",49,0)
 ;
"RTN","PXCEVSIT",50,0)
EHOSPLOC ;
"RTN","PXCEVSIT",51,0)
 N HLOC
"RTN","PXCEVSIT",52,0)
 I $P(PXCEAFTR(0),"^",22)'="" D
"RTN","PXCEVSIT",53,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVSIT",54,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVSIT",55,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVSIT",56,0)
 . S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVSIT",57,0)
 S DIR(0)="PA^44:AEMQ"
"RTN","PXCEVSIT",58,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVSIT",59,0)
 I $P(PXCETEXT,"~",8)]"" S DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVSIT",60,0)
 ;Only clinics that are not occasion of service 
"RTN","PXCEVSIT",61,0)
 ; and are not dispositioning clinics
"RTN","PXCEVSIT",62,0)
 ;S DIR("S")="I $P(^(0),U,3)=""C""&'+$G(^(""OOS""))&'$O(^PX(815,1,""DHL"",""B"",Y,0))"
"RTN","PXCEVSIT",63,0)
 ;Only hospital locations that are not dispositioning clinics
"RTN","PXCEVSIT",64,0)
 ;
"RTN","PXCEVSIT",65,0)
 ;not occasion of service and not dispositioning clinics
"RTN","PXCEVSIT",66,0)
 ;S DIR("S")="I '+$G(^(""OOS""))&'$O(^PX(815,1,""DHL"",""B"",Y,0))"
"RTN","PXCEVSIT",67,0)
 ;Exclude disposition clinics from the above listed condition.
"RTN","PXCEVSIT",68,0)
 S DIR("S")="I '+$G(^(""OOS""))" ;PX*1*116
"RTN","PXCEVSIT",69,0)
 D ^DIR
"RTN","PXCEVSIT",70,0)
 K DIR,DA
"RTN","PXCEVSIT",71,0)
 I $D(DTOUT)!$D(DUOUT) S (PXCEEND,PXCEQUIT)=1 Q
"RTN","PXCEVSIT",72,0)
 I +Y'>0,PXCECAT'="HIST" D HELPHLOC W !,$C(7) G EHOSPLOC
"RTN","PXCEVSIT",73,0)
 S HLOC=$S(+Y>0:+Y,1:"")
"RTN","PXCEVSIT",74,0)
 S $P(PXCEAFTR(0),"^",22)=HLOC
"RTN","PXCEVSIT",75,0)
 ;
"RTN","PXCEVSIT",76,0)
 ;Get the eligibility and appointment type
"RTN","PXCEVSIT",77,0)
 ;  if there is not already an appointment.
"RTN","PXCEVSIT",78,0)
 ;  Creating a new visit or will lookup and find an old visit.
"RTN","PXCEVSIT",79,0)
 I '$$APPOINT^PXUTL1(PXCEPAT,+PXCEAFTR(0),HLOC) D
"RTN","PXCEVSIT",80,0)
 . S PXELAP=$$ELAP^SDPCE($P(PXCEAFTR(0),"^",5),$P(PXCEAFTR(0),"^",22))
"RTN","PXCEVSIT",81,0)
 E  I HLOC>0 D
"RTN","PXCEVSIT",82,0)
 . ;Get the ELIGIBILITY for the appointment if there is one.
"RTN","PXCEVSIT",83,0)
 . N PXCEELIG
"RTN","PXCEVSIT",84,0)
 . S PXCEELIG=$$ELIGIBIL(PXCEPAT,HLOC,$P(PXCEAFTR(0),"^",1))
"RTN","PXCEVSIT",85,0)
 . S:PXCEELIG>0 $P(PXCEAFTR(0),"^",21)=PXCEELIG
"RTN","PXCEVSIT",86,0)
 Q
"RTN","PXCEVSIT",87,0)
 ;
"RTN","PXCEVSIT",88,0)
HELPDISP ;
"RTN","PXCEVSIT",89,0)
 W !,"You can not select a Dispositioning Clinic."
"RTN","PXCEVSIT",90,0)
 Q
"RTN","PXCEVSIT",91,0)
 ;
"RTN","PXCEVSIT",92,0)
HELPHLOC ;
"RTN","PXCEVSIT",93,0)
 W !!,"Enter the name of the Clinic for this Encounter."
"RTN","PXCEVSIT",94,0)
 W !,"Hospital Location is required."
"RTN","PXCEVSIT",95,0)
 Q
"RTN","PXCEVSIT",96,0)
 ;
"RTN","PXCEVSIT",97,0)
EWORKLOD(ASK) ;
"RTN","PXCEVSIT",98,0)
 ;+If ASK=0 do not ask default to the one for the Hospital Location
"RTN","PXCEVSIT",99,0)
 N DIC,DA
"RTN","PXCEVSIT",100,0)
EWORKLD2 ;
"RTN","PXCEVSIT",101,0)
 K DTOUT,DUOUT,DIC,DA
"RTN","PXCEVSIT",102,0)
 I $P(PXCEAFTR(0),"^",8)+$P(PXCEAFTR(0),"^",22) D
"RTN","PXCEVSIT",103,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVSIT",104,0)
 . I $P(PXCEAFTR(0),"^",8)'="" S PXCEINT=$P(PXCEAFTR(0),"^",8)
"RTN","PXCEVSIT",105,0)
 . E  S PXCEINT=$P(^SC($P(PXCEAFTR(0),"^",22),0),"^",7)
"RTN","PXCEVSIT",106,0)
 . S Y=+PXCEINT
"RTN","PXCEVSIT",107,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVSIT",108,0)
 . S DIC("B")=$S('$D(DIERR):PXCEEXT,1:$P(PXCEAFTR(0),"^",8))
"RTN","PXCEVSIT",109,0)
 S DIC="^DIC(40.7,"
"RTN","PXCEVSIT",110,0)
 S DIC(0)="AEM"
"RTN","PXCEVSIT",111,0)
 S DIC("S")="I $P(^(0),U,3)=""""!($P(^(0),U,3)'<$P(PXCEAFTR(0),U))"
"RTN","PXCEVSIT",112,0)
 S DIC("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVSIT",113,0)
 I Y'>0!ASK D
"RTN","PXCEVSIT",114,0)
 . D ^DIC
"RTN","PXCEVSIT",115,0)
 K DIR,DA
"RTN","PXCEVSIT",116,0)
 I $D(DTOUT)!$D(DUOUT) S (PXCEEND,PXCEQUIT)=1 Q
"RTN","PXCEVSIT",117,0)
 I +Y'>0,PXCECAT'="HIST" G EWORKLD2
"RTN","PXCEVSIT",118,0)
 ;+set the stop code into the visit file
"RTN","PXCEVSIT",119,0)
 S $P(PXCEAFTR(0),"^",8)=$S(+Y>0:+Y,1:"")
"RTN","PXCEVSIT",120,0)
 N PXHLOC,PXSC
"RTN","PXCEVSIT",121,0)
 S PXHLOC=$P(PXCEAFTR(0),"^",22)
"RTN","PXCEVSIT",122,0)
 S PXSC=$P($G(^SC(+PXHLOC,0)),"^",7)
"RTN","PXCEVSIT",123,0)
 ;+if the hospital location is a ward then set the encounter type to a P for primary
"RTN","PXCEVSIT",124,0)
 I $P($G(^SC(+PXHLOC,0)),"^",3)["W" S $P(PXCEAFTR(150),"^",3)="P" Q
"RTN","PXCEVSIT",125,0)
 ;+if the stop code on file for the hospital location is the stop code entered or if the stop code in the hospital location file is null then set the encounter type to P for primary
"RTN","PXCEVSIT",126,0)
 I PXSC=+Y!(PXSC=""&PXHLOC) S $P(PXCEAFTR(150),"^",3)="P"
"RTN","PXCEVSIT",127,0)
 Q
"RTN","PXCEVSIT",128,0)
 ;
"RTN","PXCEVSIT",129,0)
ECODT ;Check out date time
"RTN","PXCEVSIT",130,0)
 N PXCHKOUT
"RTN","PXCEVSIT",131,0)
 D CHIKOUT^PXBAPI2("",PXCEPAT,+$P(PXCEAFTR(0),"^",22),$P(PXCEAFTR(0),"^",1))
"RTN","PXCEVSIT",132,0)
 S:PXCHKOUT>0 $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=PXCHKOUT
"RTN","PXCEVSIT",133,0)
 Q
"RTN","PXCEVSIT",134,0)
 ;
"RTN","PXCEVSIT",135,0)
EPAT ;
"RTN","PXCEVSIT",136,0)
 I $P(PXCEAFTR(0),"^",5)'="" Q
"RTN","PXCEVSIT",137,0)
 S DIR(0)="9000010,.05A"
"RTN","PXCEVSIT",138,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVSIT",139,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVSIT",140,0)
 D ^DIR
"RTN","PXCEVSIT",141,0)
 K DIR,DA
"RTN","PXCEVSIT",142,0)
 I X="@" S Y="@"
"RTN","PXCEVSIT",143,0)
 E  I $D(DTOUT)!$D(DUOUT) S (PXCEEND,PXCEQUIT)=1 Q  ;for visit
"RTN","PXCEVSIT",144,0)
 S $P(PXCEAFTR(0),"^",5)=$P(Y,"^")
"RTN","PXCEVSIT",145,0)
 S PXCEPAT=$P(Y,"^") D PATINFO^PXCEPAT(.PXCEPAT)
"RTN","PXCEVSIT",146,0)
 Q
"RTN","PXCEVSIT",147,0)
 ;
"RTN","PXCEVSIT",148,0)
SKIP ;Just returns used when need a edit routine that does nothing.
"RTN","PXCEVSIT",149,0)
 Q
"RTN","PXCEVSIT",150,0)
 ;
"VER")
8.0^22.0
**END**
**END**
