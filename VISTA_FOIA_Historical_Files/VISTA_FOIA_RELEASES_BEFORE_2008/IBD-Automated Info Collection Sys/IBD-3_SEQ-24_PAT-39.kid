Released IBD*3*39 SEQ #24
Extracted from mail message
**KIDS**:IBD*3.0*39^

**INSTALL NAME**
IBD*3.0*39
"BLD",1927,0)
IBD*3.0*39^AUTOMATED INFO COLLECTION SYS^0^2990721^y
"BLD",1927,1,0)
^^11^11^2990528^
"BLD",1927,1,1,0)
When AICS users print encounter forms that contain
"BLD",1927,1,2,0)
'an overflow list' of problems, a null subscript
"BLD",1927,1,3,0)
error occurs.
"BLD",1927,1,4,0)

"BLD",1927,1,5,0)
IBD*3.0*39 resolves this problem, and addresses the
"BLD",1927,1,6,0)
following NOIS(s):
"BLD",1927,1,7,0)

"BLD",1927,1,8,0)
1. RIC-0599-20455
"BLD",1927,1,9,0)
2. DAY-1298-40380
"BLD",1927,1,10,0)
3. CLA-0399-22584
"BLD",1927,1,11,0)
4. NJH-1198-20059
"BLD",1927,4,0)
^9.64PA^^
"BLD",1927,"KRN",0)
^9.67PA^19^18
"BLD",1927,"KRN",.4,0)
.4
"BLD",1927,"KRN",.401,0)
.401
"BLD",1927,"KRN",.402,0)
.402
"BLD",1927,"KRN",.403,0)
.403
"BLD",1927,"KRN",.5,0)
.5
"BLD",1927,"KRN",.84,0)
.84
"BLD",1927,"KRN",3.6,0)
3.6
"BLD",1927,"KRN",3.8,0)
3.8
"BLD",1927,"KRN",9.2,0)
9.2
"BLD",1927,"KRN",9.8,0)
9.8
"BLD",1927,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1927,"KRN",9.8,"NM",1,0)
IBDF1B3^^0^B23979811
"BLD",1927,"KRN",9.8,"NM","B","IBDF1B3",1)

"BLD",1927,"KRN",19,0)
19
"BLD",1927,"KRN",19.1,0)
19.1
"BLD",1927,"KRN",101,0)
101
"BLD",1927,"KRN",409.61,0)
409.61
"BLD",1927,"KRN",771,0)
771
"BLD",1927,"KRN",869.2,0)
869.2
"BLD",1927,"KRN",870,0)
870
"BLD",1927,"KRN",8994,0)
8994
"BLD",1927,"KRN","B",.4,.4)

"BLD",1927,"KRN","B",.401,.401)

"BLD",1927,"KRN","B",.402,.402)

"BLD",1927,"KRN","B",.403,.403)

"BLD",1927,"KRN","B",.5,.5)

"BLD",1927,"KRN","B",.84,.84)

"BLD",1927,"KRN","B",3.6,3.6)

"BLD",1927,"KRN","B",3.8,3.8)

"BLD",1927,"KRN","B",9.2,9.2)

"BLD",1927,"KRN","B",9.8,9.8)

"BLD",1927,"KRN","B",19,19)

"BLD",1927,"KRN","B",19.1,19.1)

"BLD",1927,"KRN","B",101,101)

"BLD",1927,"KRN","B",409.61,409.61)

"BLD",1927,"KRN","B",771,771)

"BLD",1927,"KRN","B",869.2,869.2)

"BLD",1927,"KRN","B",870,870)

"BLD",1927,"KRN","B",8994,8994)

"BLD",1927,"QUES",0)
^9.62^^
"BLD",1927,"REQB",0)
^9.611^1^1
"BLD",1927,"REQB",1,0)
AUTOMATED INFO COLLECTION SYS 3.0^1
"BLD",1927,"REQB","B","AUTOMATED INFO COLLECTION SYS 3.0",1)

"MBREQ")
0
"PKG",421,-1)
1^1
"PKG",421,0)
AUTOMATED INFO COLLECTION SYS^IBD^The utilities for generating a paper encounter form.
"PKG",421,20,0)
^9.402P^^
"PKG",421,22,0)
^9.49I^1^1
"PKG",421,22,1,0)
3.0^2970212^2970424^1258
"PKG",421,22,1,"PAH",1,0)
39^2990721
"PKG",421,22,1,"PAH",1,1,0)
^^11^11^2990721
"PKG",421,22,1,"PAH",1,1,1,0)
When AICS users print encounter forms that contain
"PKG",421,22,1,"PAH",1,1,2,0)
'an overflow list' of problems, a null subscript
"PKG",421,22,1,"PAH",1,1,3,0)
error occurs.
"PKG",421,22,1,"PAH",1,1,4,0)

"PKG",421,22,1,"PAH",1,1,5,0)
IBD*3.0*39 resolves this problem, and addresses the
"PKG",421,22,1,"PAH",1,1,6,0)
following NOIS(s):
"PKG",421,22,1,"PAH",1,1,7,0)

"PKG",421,22,1,"PAH",1,1,8,0)
1. RIC-0599-20455
"PKG",421,22,1,"PAH",1,1,9,0)
2. DAY-1298-40380
"PKG",421,22,1,"PAH",1,1,10,0)
3. CLA-0399-22584
"PKG",421,22,1,"PAH",1,1,11,0)
4. NJH-1198-20059
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBDF1B3")
0^1^B23979811
"RTN","IBDF1B3",1,0)
IBDF1B3 ;ALB/CJM - ENCOUNTER FORM - (lists data that did not fit on the encounter form);4/28/93
"RTN","IBDF1B3",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**39**;APR 24, 1997
"RTN","IBDF1B3",3,0)
OVERFLOW ;
"RTN","IBDF1B3",4,0)
 ;loops through @IBARRAY("OVERFLOW"), printing in list form all the data that did not fit
"RTN","IBDF1B3",5,0)
 ;
"RTN","IBDF1B3",6,0)
 N IBBLK,FIELD,TYPE,ITEM,RTN,PAGE
"RTN","IBDF1B3",7,0)
 Q:'$D(@IBARRAY("OVERFLOW"))
"RTN","IBDF1B3",8,0)
 S PAGE=1
"RTN","IBDF1B3",9,0)
 D HDR
"RTN","IBDF1B3",10,0)
 S IBBLK="" F  S IBBLK=$O(@IBARRAY("OVERFLOW")@(IBBLK)) Q:'IBBLK  D
"RTN","IBDF1B3",11,0)
 .Q:$$BLKDESCR^IBDFU1B(.IBBLK)
"RTN","IBDF1B3",12,0)
 .D BLOCKBRK
"RTN","IBDF1B3",13,0)
 .S FIELD="" F  S FIELD=$O(@IBARRAY("OVERFLOW")@(IBBLK,FIELD)) Q:'FIELD  D
"RTN","IBDF1B3",14,0)
 ..S TYPE="" F  S TYPE=$O(@IBARRAY("OVERFLOW")@(IBBLK,FIELD,TYPE)) Q:TYPE=""  D
"RTN","IBDF1B3",15,0)
 ...I TYPE="DYNAMIC LIST" D LIST Q
"RTN","IBDF1B3",16,0)
 ...D FIELD
"RTN","IBDF1B3",17,0)
 D FOOTER
"RTN","IBDF1B3",18,0)
 K @IBARRAY("OVERFLOW")
"RTN","IBDF1B3",19,0)
 Q
"RTN","IBDF1B3",20,0)
HDR ;writes header to top of page
"RTN","IBDF1B3",21,0)
 N HDR
"RTN","IBDF1B3",22,0)
 S HDR="ADDITIONAL ENCOUNTER FORM DATA"
"RTN","IBDF1B3",23,0)
 W !,?((IOM-$L(HDR))/2),HDR,?(IOM-10),"PAGE: ",PAGE,!
"RTN","IBDF1B3",24,0)
 W !,"CLINIC:   ",$P($G(^SC(IBCLINIC,0)),"^")
"RTN","IBDF1B3",25,0)
 W !,"PATIENT:  " I $G(DFN) W $P($G(^DPT(DFN,0)),"^")
"RTN","IBDF1B3",26,0)
 W !,"FORM:     ",$P($G(^IBE(357,IBFORM,0)),"^"),!
"RTN","IBDF1B3",27,0)
 S PAGE=PAGE+1
"RTN","IBDF1B3",28,0)
 Q
"RTN","IBDF1B3",29,0)
BLOCKBRK ;writes a line to the report with the block name
"RTN","IBDF1B3",30,0)
 I $Y>(IOSL-3) W @IOF D HDR
"RTN","IBDF1B3",31,0)
 W !!,"BLOCK:  ",$P($G(^IBE(357.1,IBBLK,0)),"^")
"RTN","IBDF1B3",32,0)
 Q
"RTN","IBDF1B3",33,0)
FOOTER ;
"RTN","IBDF1B3",34,0)
 N FTR S FTR="END OF REPORT"
"RTN","IBDF1B3",35,0)
 W !!!,?((IOM-$L(FTR))\2),FTR,@IOF
"RTN","IBDF1B3",36,0)
 Q
"RTN","IBDF1B3",37,0)
FIELD ;displays the field (if list, displays all, if record, displays subfields)
"RTN","IBDF1B3",38,0)
  N LASTITEM,RTN,LABEL,XLAB,YLAB,XIO,YIO,WIO,HIO,BLK,ITEM,PIECE,SPACING,DISPLAY,VALUE,FLDNAME,RTN,LIST,IFARY
"RTN","IBDF1B3",39,0)
 ;
"RTN","IBDF1B3",40,0)
 Q:'$$FLDDESCR^IBDFU1A(FIELD)  ;gets the field description
"RTN","IBDF1B3",41,0)
 D RTNDSCR^IBDFU1B(.RTN) ;get the rtn used by the field
"RTN","IBDF1B3",42,0)
 S IFARY=RTN("DATA_LOCATION")
"RTN","IBDF1B3",43,0)
 W !
"RTN","IBDF1B3",44,0)
 I RTN("DATATYPE")=5 D TXTPRINT Q  ;wordprocessing fields treated differently
"RTN","IBDF1B3",45,0)
 ;now do other than wordprocessing
"RTN","IBDF1B3",46,0)
 S LIST=$S((RTN("DATATYPE")=3)!(RTN("DATATYPE")=4):1,1:0)
"RTN","IBDF1B3",47,0)
 I LIST,TYPE="CURRENT" S ITEM=$G(@IBARRAY("OVERFLOW")@(IBBLK,FIELD,TYPE))
"RTN","IBDF1B3",48,0)
 I TYPE="NEXT",LIST D
"RTN","IBDF1B3",49,0)
 .I $Y>(IOSL-5) W @IOF D HDR
"RTN","IBDF1B3",50,0)
 .S ITEM=1 W !,?5,"**** LIST OF ",$E(RTN("NAME"),$F(RTN("NAME")," "),40)," ****" F  D LISTVAL D  Q:'ITEM
"RTN","IBDF1B3",51,0)
 ..I VALUE'="" D SUBFLDS W !
"RTN","IBDF1B3",52,0)
 I TYPE="CURRENT" D
"RTN","IBDF1B3",53,0)
 .W !,?5,"**** ",$E(RTN("NAME"),$F(RTN("NAME")," "),40)_$S(LIST:" (#"_ITEM_")",1:"")_" ****"
"RTN","IBDF1B3",54,0)
 .I 'LIST D SNGLVAL
"RTN","IBDF1B3",55,0)
 .I LIST D LISTVAL
"RTN","IBDF1B3",56,0)
 .D SUBFLDS
"RTN","IBDF1B3",57,0)
 Q
"RTN","IBDF1B3",58,0)
SUBFLDS ;process each subfield
"RTN","IBDF1B3",59,0)
 N LAST,PVALUE
"RTN","IBDF1B3",60,0)
 S LAST=$$SFLDDSCR^IBDFU1A(FIELD,0) Q:'LAST
"RTN","IBDF1B3",61,0)
 F  D  S LAST=$$SFLDDSCR^IBDFU1A(FIELD,LAST) Q:'LAST
"RTN","IBDF1B3",62,0)
 .I RTN("DATATYPE")=1!(RTN("DATATYPE")=3) S PIECE=1
"RTN","IBDF1B3",63,0)
 .S PVALUE=$P($G(VALUE),"^",PIECE)
"RTN","IBDF1B3",64,0)
 .;don't use the label appearing on the encounter form - it might be 'context sensitive' - use description form package interface file
"RTN","IBDF1B3",65,0)
 .S LABEL=$$DATANAME^IBDFU1B(RTN,PIECE)
"RTN","IBDF1B3",66,0)
 .I $Y>(IOSL-3) W @IOF D HDR
"RTN","IBDF1B3",67,0)
 .W !,?5,LABEL_": ",PVALUE
"RTN","IBDF1B3",68,0)
 Q
"RTN","IBDF1B3",69,0)
 ;
"RTN","IBDF1B3",70,0)
LIST ;displays the list
"RTN","IBDF1B3",71,0)
 N RTN,LABEL,ITEM,PIECE,VALUE,LIST,IFARY,CNT
"RTN","IBDF1B3",72,0)
 ;
"RTN","IBDF1B3",73,0)
 S LIST=FIELD
"RTN","IBDF1B3",74,0)
 Q:$$LSTDESCR^IBDFU1(.LIST)  ;gets the list description
"RTN","IBDF1B3",75,0)
 S RTN=LIST("RTN")
"RTN","IBDF1B3",76,0)
 D RTNDSCR^IBDFU1B(.RTN) ;get the PACKAGE INTERFACE used
"RTN","IBDF1B3",77,0)
 S IFARY=RTN("DATA_LOCATION")
"RTN","IBDF1B3",78,0)
 W !
"RTN","IBDF1B3",79,0)
 ;
"RTN","IBDF1B3",80,0)
 D
"RTN","IBDF1B3",81,0)
 .S CNT=0
"RTN","IBDF1B3",82,0)
 .I $Y>(IOSL-5) W @IOF D HDR
"RTN","IBDF1B3",83,0)
 .S ITEM=1 W !,?5,"**** LIST OF ",$E(RTN("NAME"),$F(RTN("NAME")," "),40)," ****" F  D LISTVAL D  Q:'ITEM
"RTN","IBDF1B3",84,0)
 ..; -- file overflow data if not re-printing & there is a form ID
"RTN","IBDF1B3",85,0)
 ..I '$G(REPRINT),($G(LIST("INPUT_RTN"))]""),$G(IBPFID) D
"RTN","IBDF1B3",86,0)
 ...S CNT=CNT+1
"RTN","IBDF1B3",87,0)
 ...S DIC="^IBD(357.96,IBPFID,2,",DIC(0)="L",DIC("P")=$P(^DD(357.96,2,0),"^",2),DA(1)=IBPFID,X=CNT,DLAYGO=357.96
"RTN","IBDF1B3",88,0)
 ...S DIC("DR")=".03////^S X=LIST(""INPUT_RTN"");.04////^S X=$P(VALUE,""^"");.06////^S X=""S""_LIST_""("";.08////^S X=$P(VALUE,""^"",2)"
"RTN","IBDF1B3",89,0)
 ...K DD,DO D FILE^DICN K DIC,DA,DLAYGO,DD,DO
"RTN","IBDF1B3",90,0)
 ..I VALUE'="" D SUBCOLS W !
"RTN","IBDF1B3",91,0)
 Q
"RTN","IBDF1B3",92,0)
SUBCOLS ;process each subcolumn
"RTN","IBDF1B3",93,0)
 N PVALUE,SUB,PIECE
"RTN","IBDF1B3",94,0)
 F SUB=1:1:6 D
"RTN","IBDF1B3",95,0)
 .Q:(LIST("SCTYPE",SUB)'=1)
"RTN","IBDF1B3",96,0)
 .Q:'LIST("SCPIECE",SUB)
"RTN","IBDF1B3",97,0)
 .S PIECE=LIST("SCPIECE",SUB)
"RTN","IBDF1B3",98,0)
 .S PVALUE=$P($G(VALUE),"^",PIECE)
"RTN","IBDF1B3",99,0)
 .;don't use the label appearing on the encounter form - it might be 'context sensitive' - use description form package interface file
"RTN","IBDF1B3",100,0)
 .S LABEL=$$DATANAME^IBDFU1B(RTN,PIECE)
"RTN","IBDF1B3",101,0)
 .I $Y>(IOSL-3) W @IOF D HDR
"RTN","IBDF1B3",102,0)
 .W !,?5,LABEL_": ",PVALUE
"RTN","IBDF1B3",103,0)
 Q
"RTN","IBDF1B3",104,0)
 ;
"RTN","IBDF1B3",105,0)
SNGLVAL ;output - VALUE
"RTN","IBDF1B3",106,0)
 S VALUE=$G(@IFARY)
"RTN","IBDF1B3",107,0)
 Q
"RTN","IBDF1B3",108,0)
LISTVAL ;input - ITEM=prior item processes, output - VALUE,ITEM=current item processed
"RTN","IBDF1B3",109,0)
 ;
"RTN","IBDF1B3",110,0)
 S VALUE=$S(ITEM:$G(@IFARY@(ITEM)),1:"")
"RTN","IBDF1B3",111,0)
 ;increment ITEM to next item
"RTN","IBDF1B3",112,0)
 S ITEM=$O(@IFARY@(ITEM))
"RTN","IBDF1B3",113,0)
 Q
"RTN","IBDF1B3",114,0)
TXTPRINT ;for printing a word-processing field
"RTN","IBDF1B3",115,0)
 N LINE,X,DIWL,DIWR,DIWF,LABEL
"RTN","IBDF1B3",116,0)
 S LINE=0,DIWR=IOM-10,DIWL=0,DIWF=""
"RTN","IBDF1B3",117,0)
 K ^UTILITY($J,"W",1)
"RTN","IBDF1B3",118,0)
 F  S LINE=$O(@IFARY@(LINE)) Q:'LINE  S X=$G(@IFARY@(LINE,0)) I X'="" D ^DIWP
"RTN","IBDF1B3",119,0)
 S LABEL=$E(RTN("NAME"),$F(RTN("NAME")," "),40)
"RTN","IBDF1B3",120,0)
 I $Y>(IOSL-5) W @IOF D HDR
"RTN","IBDF1B3",121,0)
 W !,?5,LABEL_": "
"RTN","IBDF1B3",122,0)
 S X=0 F  S X=$O(^UTILITY($J,"W",0,X)) Q:'X  D
"RTN","IBDF1B3",123,0)
 .I $Y>(IOSL-3) W @IOF D HDR
"RTN","IBDF1B3",124,0)
 .W !,?10,$G(^UTILITY($J,"W",0,X,0))
"RTN","IBDF1B3",125,0)
 K ^UTILITY($J,"W",1)
"RTN","IBDF1B3",126,0)
 Q
"VER")
8.0^21.0
**END**
**END**
