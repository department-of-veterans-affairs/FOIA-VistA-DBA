EMERGENCY Released RG*1*5 SEQ #6
Extracted from mail message
**KIDS**:RG*1.0*5^

**INSTALL NAME**
RG*1.0*5
"BLD",886,0)
RG*1.0*5^CLINICAL INFO RESOURCE NETWORK^0^3000823^y
"BLD",886,1,0)
^^5^5^3000410^
"BLD",886,1,1,0)
FACILITY INTEGRATION MESSAGE
"BLD",886,1,2,0)
This patch contains functionality for processing the new Facility 
"BLD",886,1,3,0)
Integration Message used during National Database Integration (NDBI)
"BLD",886,1,4,0)
site integrations.  Refer to patch RG*1*5 in the FORUM Patch Module
"BLD",886,1,5,0)
for a complete description.
"BLD",886,4,0)
^9.64PA^991.11^1
"BLD",886,4,991.11,0)
991.11
"BLD",886,4,991.11,222)
y^y^f^^y^^y^m^n
"BLD",886,4,991.11,223)

"BLD",886,4,991.11,224)
N X S X=+^(0) I (X=1)!(X=6)!(X=7)!(X=230)!(X=231)!(X=232)
"BLD",886,4,"B",991.11,991.11)

"BLD",886,"ABNS",0)
^9.66A^^
"BLD",886,"ABPKG")
n^^
"BLD",886,"INID")
y
"BLD",886,"KRN",0)
^9.67PA^19^17
"BLD",886,"KRN",.4,0)
.4
"BLD",886,"KRN",.401,0)
.401
"BLD",886,"KRN",.402,0)
.402
"BLD",886,"KRN",.403,0)
.403
"BLD",886,"KRN",.5,0)
.5
"BLD",886,"KRN",.84,0)
.84
"BLD",886,"KRN",3.6,0)
3.6
"BLD",886,"KRN",3.8,0)
3.8
"BLD",886,"KRN",9.2,0)
9.2
"BLD",886,"KRN",9.8,0)
9.8
"BLD",886,"KRN",9.8,"NM",0)
^9.68A^11^6
"BLD",886,"KRN",9.8,"NM",1,0)
RGFIBM^^0^B16904375
"BLD",886,"KRN",9.8,"NM",2,0)
RGFIPM^^0^B17346269
"BLD",886,"KRN",9.8,"NM",3,0)
RGFIPM1^^0^B31534117
"BLD",886,"KRN",9.8,"NM",4,0)
RGFIRM^^0^B21437143
"BLD",886,"KRN",9.8,"NM",5,0)
RGFIU^^0^B33943423
"BLD",886,"KRN",9.8,"NM",11,0)
RGFIACK^^0^B2165170
"BLD",886,"KRN",9.8,"NM","B","RGFIACK",11)

"BLD",886,"KRN",9.8,"NM","B","RGFIBM",1)

"BLD",886,"KRN",9.8,"NM","B","RGFIPM",2)

"BLD",886,"KRN",9.8,"NM","B","RGFIPM1",3)

"BLD",886,"KRN",9.8,"NM","B","RGFIRM",4)

"BLD",886,"KRN",9.8,"NM","B","RGFIU",5)

"BLD",886,"KRN",19,0)
19
"BLD",886,"KRN",19.1,0)
19.1
"BLD",886,"KRN",101,0)
101
"BLD",886,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",886,"KRN",101,"NM",1,0)
RG FACILITY INTEGRATION CLIENT^^0
"BLD",886,"KRN",101,"NM",2,0)
RG FACILITY INTEGRATION SERVER^^0
"BLD",886,"KRN",101,"NM","B","RG FACILITY INTEGRATION CLIENT",1)

"BLD",886,"KRN",101,"NM","B","RG FACILITY INTEGRATION SERVER",2)

"BLD",886,"KRN",409.61,0)
409.61
"BLD",886,"KRN",771,0)
771
"BLD",886,"KRN",771,"NM",0)
^9.68A^1^1
"BLD",886,"KRN",771,"NM",1,0)
RG SITE MERGE^^0
"BLD",886,"KRN",771,"NM","B","RG SITE MERGE",1)

"BLD",886,"KRN",870,0)
870
"BLD",886,"KRN",870,"NM",0)
^9.68A^^
"BLD",886,"KRN",8994,0)
8994
"BLD",886,"KRN","B",.4,.4)

"BLD",886,"KRN","B",.401,.401)

"BLD",886,"KRN","B",.402,.402)

"BLD",886,"KRN","B",.403,.403)

"BLD",886,"KRN","B",.5,.5)

"BLD",886,"KRN","B",.84,.84)

"BLD",886,"KRN","B",3.6,3.6)

"BLD",886,"KRN","B",3.8,3.8)

"BLD",886,"KRN","B",9.2,9.2)

"BLD",886,"KRN","B",9.8,9.8)

"BLD",886,"KRN","B",19,19)

"BLD",886,"KRN","B",19.1,19.1)

"BLD",886,"KRN","B",101,101)

"BLD",886,"KRN","B",409.61,409.61)

"BLD",886,"KRN","B",771,771)

"BLD",886,"KRN","B",870,870)

"BLD",886,"KRN","B",8994,8994)

"BLD",886,"PRE")
RGP5ENV
"BLD",886,"QUES",0)
^9.62^^
"BLD",886,"REQB",0)
^9.611^7^6
"BLD",886,"REQB",2,0)
HL*1.6*58^2
"BLD",886,"REQB",3,0)
RG*1.0*3^2
"BLD",886,"REQB",4,0)
XU*8.0*131^2
"BLD",886,"REQB",5,0)
MPIF*1.0*3^2
"BLD",886,"REQB",6,0)
DG*5.3*255^2
"BLD",886,"REQB",7,0)
DG*5.3*316^2
"BLD",886,"REQB","B","DG*5.3*255",6)

"BLD",886,"REQB","B","DG*5.3*316",7)

"BLD",886,"REQB","B","HL*1.6*58",2)

"BLD",886,"REQB","B","MPIF*1.0*3",5)

"BLD",886,"REQB","B","RG*1.0*3",3)

"BLD",886,"REQB","B","XU*8.0*131",4)

"DATA",991.11,1,0)
1^2^0^85^5
"DATA",991.11,1,10)
Invalid integration control number
"DATA",991.11,1,99,0)
^^13^13^2970624^^
"DATA",991.11,1,99,1,0)
The integration control number (ICN) is used to uniquely identify a patient 
"DATA",991.11,1,99,2,0)
within VHA.  This patient's ICN has failed validation for one of the reasons 
"DATA",991.11,1,99,3,0)
listed below:
"DATA",991.11,1,99,4,0)

"DATA",991.11,1,99,5,0)
NO MPI NODE or NO ICN:  The patient has not been assigned an ICN.  This should 
"DATA",991.11,1,99,6,0)
not occur under normal circumstances.
"DATA",991.11,1,99,7,0)

"DATA",991.11,1,99,8,0)
BAD ICN CHECKSUM:  The checksum accompanying the ICN in the message does not 
"DATA",991.11,1,99,9,0)
match that stored in the ICN CHECKSUM field of the PATIENT file entry for this 
"DATA",991.11,1,99,10,0)
patient.  Further processing of the message is not possible until this problem 
"DATA",991.11,1,99,11,0)
is resolved.  Possible causes include a bad checksum stored in the PATIENT file 
"DATA",991.11,1,99,12,0)
of either the sending or the receiving institution, or a message that was 
"DATA",991.11,1,99,13,0)
corrupted during transmission.
"DATA",991.11,6,0)
6^2^0^85^1517
"DATA",991.11,6,10)
Unexpected system error
"DATA",991.11,6,99,0)
^^3^3^2970206^
"DATA",991.11,6,99,1,0)
An unexpected error caused processing of the message to terminate prematurely.  
"DATA",991.11,6,99,2,0)
This should be reported to the CIRN Support Team for analysis and remedial 
"DATA",991.11,6,99,3,0)
action.
"DATA",991.11,7,0)
7^2^0^85^0
"DATA",991.11,7,10)
Unknown segment identifier
"DATA",991.11,7,99,0)
^^3^3^2970206.113327
"DATA",991.11,7,99,1,0)
A segment identifier is not recognized as valid by CIRN.  This could be caused 
"DATA",991.11,7,99,2,0)
by a corrupt message, a message that has been directed to the wrong receiver, 
"DATA",991.11,7,99,3,0)
or a change in the format of the message. 
"DATA",991.11,230,0)
230^2^1^85
"DATA",991.11,230,10)
Invalid Sender Of Facility Integration Message
"DATA",991.11,230,99,0)
^^1^1^3000330^^^^
"DATA",991.11,230,99,1,0)
The CMOR can only accept the Facility Integration Message from the legacy site.
"DATA",991.11,231,0)
231^1^1^85
"DATA",991.11,231,10)
Treating Facility Not Known To CMOR
"DATA",991.11,231,99,0)
^^2^2^3000330^^^^
"DATA",991.11,231,99,1,0)
This site has treating facilities for the patient that the
"DATA",991.11,231,99,2,0)
CMOR does not have.
"DATA",991.11,232,0)
232^1^1^85
"DATA",991.11,232,10)
Subscriber Not Known To CMOR
"DATA",991.11,232,99,0)
^^1^1^3000330^^^^
"DATA",991.11,232,99,1,0)
This site has subscribers that the CMOR does not have.
"FIA",991.11)
CIRN HL7 EXCEPTION TYPE
"FIA",991.11,0)
^RGHL7(991.11,
"FIA",991.11,0,0)
991.11I
"FIA",991.11,0,1)
y^y^f^^y^^y^m^n
"FIA",991.11,0,10)

"FIA",991.11,0,11)
N X S X=+^(0) I (X=1)!(X=6)!(X=7)!(X=230)!(X=231)!(X=232)
"FIA",991.11,0,"RLRO")

"FIA",991.11,0,"VR")
1.0^RG
"FIA",991.11,991.11)
0
"FIA",991.11,991.112)
0
"FIA",991.11,991.1199)
0
"FRV1",991.11,"1,0",4)
MPIF EXCEPTIONS
"FRV1",991.11,"1,0",4,"F")
;XMB(3.8,
"FRV1",991.11,"230,0",4)
MPIF EXCEPTIONS
"FRV1",991.11,"230,0",4,"F")
;XMB(3.8,
"FRV1",991.11,"231,0",4)
MPIF EXCEPTIONS
"FRV1",991.11,"231,0",4,"F")
;XMB(3.8,
"FRV1",991.11,"232,0",4)
MPIF EXCEPTIONS
"FRV1",991.11,"232,0",4,"F")
;XMB(3.8,
"FRV1",991.11,"6,0",4)
MPIF EXCEPTIONS
"FRV1",991.11,"6,0",4,"F")
;XMB(3.8,
"FRV1",991.11,"7,0",4)
MPIF EXCEPTIONS
"FRV1",991.11,"7,0",4,"F")
;XMB(3.8,
"KRN",101,1726,-1)
0^2
"KRN",101,1726,0)
RG FACILITY INTEGRATION SERVER^Facility Integration Server^^E^^^^^^^^
"KRN",101,1726,1,0)
^^3^3^3000405^^^^
"KRN",101,1726,1,1,0)
This is the server for the Facility Integration Message.  It notifies
"KRN",101,1726,1,2,0)
other sites when there is a site integration that affects a particular
"KRN",101,1726,1,3,0)
patient.
"KRN",101,1726,99)
58174,56635
"KRN",101,1726,770)
RG SITE MERGE^^ADT^A08^^P^^AL^AL^2.3^
"KRN",101,1726,772)
D ACK^RGFIACK
"KRN",101,1726,774)

"KRN",101,1726,775,0)
^101.0775PA^1^1
"KRN",101,1726,775,1,0)
1727
"KRN",101,1726,775,1,"^")
RG FACILITY INTEGRATION CLIENT
"KRN",101,1727,-1)
0^1
"KRN",101,1727,0)
RG FACILITY INTEGRATION CLIENT^Facility Integration Client^^S^^^^^^^^
"KRN",101,1727,1,0)
^^4^4^3000410^^^^
"KRN",101,1727,1,1,0)
This is the client for the Facility Integration Message, which notifies 
"KRN",101,1727,1,2,0)
sites that there has been a site integration which affects Clinical 
"KRN",101,1727,1,3,0)
Information Resource Network - Patient Demographics and Master Patient 
"KRN",101,1727,1,4,0)
Index (CIRN PD/MPI) for a particular patient.
"KRN",101,1727,99)
58174,56697
"KRN",101,1727,770)
^RG SITE MERGE^^A08^d^P^^^^2.3^ACK
"KRN",101,1727,771)
D RECEIVE^RGFIPM1
"KRN",101,1727,773)
1^1^0^0
"KRN",101,1727,774)
Q
"KRN",771,52,-1)
0^1
"KRN",771,52,0)
RG SITE MERGE^a^^RG CIRN HL7 PROBLEMS^^^US
"MBREQ")
0
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PGL",991.11,0,4,6)
MAIL GROUP^P3.8'^XMB(3.8,^0;4^Q
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
5^3000823
"PKG",272,22,1,"PAH",1,1,0)
^^5^5^3000823
"PKG",272,22,1,"PAH",1,1,1,0)
FACILITY INTEGRATION MESSAGE
"PKG",272,22,1,"PAH",1,1,2,0)
This patch contains functionality for processing the new Facility 
"PKG",272,22,1,"PAH",1,1,3,0)
Integration Message used during National Database Integration (NDBI)
"PKG",272,22,1,"PAH",1,1,4,0)
site integrations.  Refer to patch RG*1*5 in the FORUM Patch Module
"PKG",272,22,1,"PAH",1,1,5,0)
for a complete description.
"PRE")
RGP5ENV
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","RGFIACK")
0^11^B2165170
"RTN","RGFIACK",1,0)
RGFIACK ;ALB/CJM-PROCESS APPLICATION ACKNOWLEDGMENT ;08/27/99
"RTN","RGFIACK",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**5**;30 Apr 99
"RTN","RGFIACK",3,0)
 ;
"RTN","RGFIACK",4,0)
ACK ;
"RTN","RGFIACK",5,0)
 ;Description: Process the Facility Integration Message
"RTN","RGFIACK",6,0)
 ;
"RTN","RGFIACK",7,0)
 ;Input:
"RTN","RGFIACK",8,0)
 ;  HL7 variables must be defined
"RTN","RGFIACK",9,0)
 ;Output: none
"RTN","RGFIACK",10,0)
 ;Variables:
"RTN","RGFIACK",11,0)
 ;  FS - field seperator
"RTN","RGFIACK",12,0)
 ;  CS - component seperator
"RTN","RGFIACK",13,0)
 ;  CODE - returned error code
"RTN","RGFIACK",14,0)
 ;  MSG - error text returned
"RTN","RGFIACK",15,0)
 ;  TYPE - ack type (AA,ER)
"RTN","RGFIACK",16,0)
 ;  MSGID - HL7 msg id
"RTN","RGFIACK",17,0)
 ;  RGLOG - ien of entry in the CIRN HL7 Exception file
"RTN","RGFIACK",18,0)
 ;
"RTN","RGFIACK",19,0)
 ;
"RTN","RGFIACK",20,0)
 N FS,CS,QUIT,CODE,MSG,TYPE,MSGID,RGLOG
"RTN","RGFIACK",21,0)
 S FS=HL("FS")
"RTN","RGFIACK",22,0)
 S CS=$E(HL("ECH"),1)
"RTN","RGFIACK",23,0)
 S QUIT=0
"RTN","RGFIACK",24,0)
 K HLERR
"RTN","RGFIACK",25,0)
 ;
"RTN","RGFIACK",26,0)
 X HLNEXT D  Q:QUIT
"RTN","RGFIACK",27,0)
 .I (HLQUIT'>0) S HLERR="MISSING MSH SEGMENT",QUIT=1 Q
"RTN","RGFIACK",28,0)
 .I $P(HLNODE,FS)'["MSH" S HLERR="MISSING MSH SEGMENT",QUIT=1 Q
"RTN","RGFIACK",29,0)
 X HLNEXT D  Q:QUIT
"RTN","RGFIACK",30,0)
 .I (HLQUIT'>0) S HLERR="MISSING MSA SEGMENT",QUIT=1 Q
"RTN","RGFIACK",31,0)
 .I $P(HLNODE,FS)'["MSA" S HLERR="MISSING MSA SEGMENT",QUIT=1 Q
"RTN","RGFIACK",32,0)
 .S TYPE=$P(HLNODE,FS,2)
"RTN","RGFIACK",33,0)
 .S MSGID=$P(HLNODE,FS,3)
"RTN","RGFIACK",34,0)
 .S MSG=$P(HLNODE,FS,4)
"RTN","RGFIACK",35,0)
 .S CODE=$P($P(HLNODE,FS,7),CS,4)
"RTN","RGFIACK",36,0)
 I ($G(TYPE)["R"),$G(MSGID),$G(CODE) D
"RTN","RGFIACK",37,0)
 .N HLMTIEN
"RTN","RGFIACK",38,0)
 .S HLMTIEN=MSGID
"RTN","RGFIACK",39,0)
 .D EXC^RGFIU(CODE,"APPLICATION ACKNOWLEDGMENT TO MSGID: "_MSGID_" - "_MSG)
"RTN","RGFIACK",40,0)
 .D STOP^RGHLLOG(1)
"RTN","RGFIACK",41,0)
 Q
"RTN","RGFIBM")
0^1^B16904375
"RTN","RGFIBM",1,0)
RGFIBM ;ALB/CJM-SEND FACILITY INTEGRATION MESSAGE ;08/27/99
"RTN","RGFIBM",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**5**;30 Apr 99
"RTN","RGFIBM",3,0)
 ;
"RTN","RGFIBM",4,0)
SEND(DFN,LEGACY,PRIMARY,RESULTS,ERROR) ;
"RTN","RGFIBM",5,0)
 ;Description:  Sends the facility integration message for this patient
"RTN","RGFIBM",6,0)
 ;using routing logic based on the subscription list.
"RTN","RGFIBM",7,0)
 ;
"RTN","RGFIBM",8,0)
 ;Input:
"RTN","RGFIBM",9,0)
 ;  DFN - ien of patient
"RTN","RGFIBM",10,0)
 ;  LEGACY - station number of the legacy site
"RTN","RGFIBM",11,0)
 ;  PRIMARY - station number of the primary site
"RTN","RGFIBM",12,0)
 ;Output:
"RTN","RGFIBM",13,0)
 ;  Function Value - 1 on success, 0 on failure
"RTN","RGFIBM",14,0)
 ;  RESULTS() - results array returned by calling GENERATE^HLMA (pass by reference,optional)
"RTN","RGFIBM",15,0)
 ;  ERROR - error message (pass by reference,optional)
"RTN","RGFIBM",16,0)
 ;
"RTN","RGFIBM",17,0)
 N HL,HLA,HLERR,HLL,HLDT,HLCD,HLINK0,HLINKIEN,HLINKP,HLINKX,HLDOM,HLECH,HLFS,HLHDR,HLINST,HLN,HLPARAM,HLQ,HLSAN,HLTYPE,HLX
"RTN","RGFIBM",18,0)
 K RESULTS,ERROR
"RTN","RGFIBM",19,0)
 ;
"RTN","RGFIBM",20,0)
 ;
"RTN","RGFIBM",21,0)
 I $G(DFN),$G(PRIMARY),$G(LEGACY) D
"RTN","RGFIBM",22,0)
 .;just checking!
"RTN","RGFIBM",23,0)
 E  S ERROR="MISSING PARAMETER" Q 0
"RTN","RGFIBM",24,0)
 ;
"RTN","RGFIBM",25,0)
 I '$$BUILD("HLA(""HLS"")",DFN,LEGACY,PRIMARY,.ERROR) Q 0
"RTN","RGFIBM",26,0)
 ;
"RTN","RGFIBM",27,0)
 D ROUTE^RGFIRM(DFN,LEGACY,PRIMARY,.HLL)
"RTN","RGFIBM",28,0)
 ;
"RTN","RGFIBM",29,0)
 D GENERATE^HLMA("RG FACILITY INTEGRATION SERVER","LM",1,.RESULTS)
"RTN","RGFIBM",30,0)
 ;
"RTN","RGFIBM",31,0)
 I $P($G(RESULTS),"^",2) S ERROR=$P(RESULTS,"^",3),ERROR="ERROR ENCOUNTERED BY HL7 WHILE SENDING FACILITY INTEGRATION MESSAGE: "_ERROR D EXC^RGFIU(6,ERROR,DFN) Q 0
"RTN","RGFIBM",32,0)
 Q 1
"RTN","RGFIBM",33,0)
 ;
"RTN","RGFIBM",34,0)
BUILD(LOC,DFN,LEGACY,PRIMARY,ERROR) ;
"RTN","RGFIBM",35,0)
 ;Description:  Builds the facility integration message.
"RTN","RGFIBM",36,0)
 ;
"RTN","RGFIBM",37,0)
 ;Input:
"RTN","RGFIBM",38,0)
 ;  LOC - global location to place the message, referenced by @indirection
"RTN","RGFIBM",39,0)
 ;  DFN - ien of patient
"RTN","RGFIBM",40,0)
 ;  LEGACY - station number of the legacy site
"RTN","RGFIBM",41,0)
 ;  PRIMARY - station number of the primary site
"RTN","RGFIBM",42,0)
 ;Output:
"RTN","RGFIBM",43,0)
 ;  Function Value - 1 on success, 0 on failure
"RTN","RGFIBM",44,0)
 ;  ERROR - error message (pass by reference,optional)
"RTN","RGFIBM",45,0)
 ;  HL7 variables defined by INIT^HLFNC2
"RTN","RGFIBM",46,0)
 ;
"RTN","RGFIBM",47,0)
 N ICNPLUS
"RTN","RGFIBM",48,0)
 K ERROR
"RTN","RGFIBM",49,0)
 ;
"RTN","RGFIBM",50,0)
 ;
"RTN","RGFIBM",51,0)
 I $G(DFN),$G(PRIMARY),$G(LEGACY) D
"RTN","RGFIBM",52,0)
 .;just checking!
"RTN","RGFIBM",53,0)
 E  S ERROR="MISSING PARAMETER NEEDED TO BUILD FACILITY INTEGRATION MESSAGE" D EXC^RGFIU(6,ERROR,DFN) Q 0
"RTN","RGFIBM",54,0)
 ;
"RTN","RGFIBM",55,0)
 ;don't send message if there is no ICN to identify it
"RTN","RGFIBM",56,0)
 S ICNPLUS=$$GETICN^MPIF001(DFN)
"RTN","RGFIBM",57,0)
 I (+ICNPLUS)'>0 S ERROR="UNABLE TO SEND FACILITY INTEGRATION MESSAGE - PATIENT LACKS ICN" D EXC^RGFIU(6,ERROR,DFN) Q 0
"RTN","RGFIBM",58,0)
 ;
"RTN","RGFIBM",59,0)
 ;don't send if local ICN
"RTN","RGFIBM",60,0)
 I $$IFLOCAL^MPIF001(DFN) S ERROR="UNABLE TO SEND FACILITY INTEGRATION MESSAGE - PATIENT ICN IS LOCAL" D EXC^RGFIU(6,ERROR,DFN) Q 0
"RTN","RGFIBM",61,0)
 ;
"RTN","RGFIBM",62,0)
 D INIT^HLFNC2("RG FACILITY INTEGRATION SERVER",.HL)
"RTN","RGFIBM",63,0)
 I $G(HL) S ERROR="ERROR ENCOUNTERED BY HL7 WHILE SENDING FACILITY INTEGRATION MESSAGE: "_HL D EXC^RGFIU(6,ERROR,DFN) Q 0
"RTN","RGFIBM",64,0)
 ;
"RTN","RGFIBM",65,0)
 S @LOC@(1)=$$EVN^VAFHLEVN("A08",51)
"RTN","RGFIBM",66,0)
 S @LOC@(2)=$$EN^VAFCPID(DFN,"2,3,5,19")
"RTN","RGFIBM",67,0)
 S @LOC@(3)="PV1"
"RTN","RGFIBM",68,0)
 S $P(@LOC@(3),HL("FS"),3)="O"
"RTN","RGFIBM",69,0)
 S @LOC@(4)="NTE"
"RTN","RGFIBM",70,0)
 S $P(@LOC@(4),HL("FS"),3)="P"
"RTN","RGFIBM",71,0)
 S $P(@LOC@(4),HL("FS"),4)=LEGACY_$E(HL("ECH"),1)_PRIMARY
"RTN","RGFIBM",72,0)
 Q 1
"RTN","RGFIBM",73,0)
 ;
"RTN","RGFIBM",74,0)
SITESEND(TO,DFN,LEGACY,PRIMARY,RESULTS,ERROR) ;
"RTN","RGFIBM",75,0)
 ;Description:  Sends the facility integration message for this patient
"RTN","RGFIBM",76,0)
 ;to a single site.
"RTN","RGFIBM",77,0)
 ;
"RTN","RGFIBM",78,0)
 ;Input:
"RTN","RGFIBM",79,0)
 ;  TO - station # of destination
"RTN","RGFIBM",80,0)
 ;  DFN - ien of patient
"RTN","RGFIBM",81,0)
 ;  LEGACY - station number (without suffix) of the legacy site
"RTN","RGFIBM",82,0)
 ;  PRIMARY - station number (without suffix) of the primary site
"RTN","RGFIBM",83,0)
 ;Output:
"RTN","RGFIBM",84,0)
 ;  Function Value - 1 on success, 0 on failure
"RTN","RGFIBM",85,0)
 ;  RESULTS() - results array returned by calling GENERATE^HLMA (pass by reference,optional)
"RTN","RGFIBM",86,0)
 ;  ERROR - error message (pass by reference,optional)
"RTN","RGFIBM",87,0)
 ;
"RTN","RGFIBM",88,0)
 N HL,HLA,HLERR,HLL,SITEIEN,LINK,HLDT,HLCD,HLINK0,HLINKIEN,HLINKP,HLINKX,HLDOM,HLECH,HLFS,HLHDR,HLINST,HLN,HLPARAM,HLQ,HLSAN,HLTYPE,HLX
"RTN","RGFIBM",89,0)
 K RESULTS,ERROR
"RTN","RGFIBM",90,0)
 ;
"RTN","RGFIBM",91,0)
 ;
"RTN","RGFIBM",92,0)
 I $G(DFN),$G(PRIMARY),$G(LEGACY),$G(TO) D
"RTN","RGFIBM",93,0)
 .;just checking!
"RTN","RGFIBM",94,0)
 E  S ERROR="MISSING PARAMETER" Q 0
"RTN","RGFIBM",95,0)
 ;
"RTN","RGFIBM",96,0)
 S SITEIEN=$$LKUP^XUAF4(TO)
"RTN","RGFIBM",97,0)
 I 'SITEIEN S ERROR="SITE NOT FOUND IN INSTITUTION FILE" Q 0
"RTN","RGFIBM",98,0)
 ;
"RTN","RGFIBM",99,0)
 ;set HLL array to route message to a single site
"RTN","RGFIBM",100,0)
 S LINK=$$GETLINK^RGFIU(SITEIEN)
"RTN","RGFIBM",101,0)
 I '$L(LINK) D
"RTN","RGFIBM",102,0)
 .D EXC^RGFIU(224,"Facility Integration Message not sent to station #  "_TO,DFN)
"RTN","RGFIBM",103,0)
 E  D
"RTN","RGFIBM",104,0)
 .S HLL("LINKS",1)="RG FACILITY INTEGRATION CLIENT^"_LINK
"RTN","RGFIBM",105,0)
 ;
"RTN","RGFIBM",106,0)
 ;create the message
"RTN","RGFIBM",107,0)
 I '$$BUILD("HLA(""HLS"")",DFN,LEGACY,PRIMARY,.ERROR) Q 0
"RTN","RGFIBM",108,0)
 ;
"RTN","RGFIBM",109,0)
 D GENERATE^HLMA("RG FACILITY INTEGRATION SERVER","LM",1,.RESULTS)
"RTN","RGFIBM",110,0)
 ;
"RTN","RGFIBM",111,0)
 I $P($G(RESULTS),"^",2) S ERROR=$P(RESULTS,"^",3),ERROR="ERROR ENCOUNTERED BY HL7 WHILE SENDING FACILITY INTEGRATION MESSAGE: "_ERROR D EXC^RGFIU(6,ERROR,DFN) Q 0
"RTN","RGFIBM",112,0)
 Q 1
"RTN","RGFIPM")
0^2^B17346269
"RTN","RGFIPM",1,0)
RGFIPM ;ALB/CJM-PROCESS FACILITY INTEGRATION MESSAGE ;08/27/99
"RTN","RGFIPM",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**5**;30 Apr 99
"RTN","RGFIPM",3,0)
 ;
"RTN","RGFIPM",4,0)
XCHANGE(DFN,LEGSN,PRIMSN,ERROR) ;
"RTN","RGFIPM",5,0)
 ;Description:  If the CMOR is the legacy site it changes to the
"RTN","RGFIPM",6,0)
 ;primary site. If the legacy system is on the treating facility list
"RTN","RGFIPM",7,0)
 ;it is removed.  If the primary system is not on the treating facility
"RTN","RGFIPM",8,0)
 ;list it is added.The subscription for the legacy system is terminated.
"RTN","RGFIPM",9,0)
 ;If the primary system is not on the subscriber list it is added.
"RTN","RGFIPM",10,0)
 ;
"RTN","RGFIPM",11,0)
 ;Input:
"RTN","RGFIPM",12,0)
 ;  DFN - ien of patient (required)
"RTN","RGFIPM",13,0)
 ;  LEGSN- station # of the legacy site (required)-
"RTN","RGFIPM",14,0)
 ;  PRIMSN - station # of the primary site (required)
"RTN","RGFIPM",15,0)
 ;Output:
"RTN","RGFIPM",16,0)
 ;  Function Value - 0 if any error condition encountered, 1 otherwise
"RTN","RGFIPM",17,0)
 ;  ERROR() - (optional,pass by reference) - an array of error messages
"RTN","RGFIPM",18,0)
 ;
"RTN","RGFIPM",19,0)
 ;Variables:
"RTN","RGFIPM",20,0)
 ;  PRIMIEN - ien of the primary site in the Institution file
"RTN","RGFIPM",21,0)
 ;  PRIMLINK - name of logical link for primary site
"RTN","RGFIPM",22,0)
 ;  FOUNDERR - flag set to 1 if an error is found
"RTN","RGFIPM",23,0)
 ;  MPIDATA() - array containing MPI data for this patient
"RTN","RGFIPM",24,0)
 ;
"RTN","RGFIPM",25,0)
 N PRIMIEN,PRIMLINK,FOUNDERR,MPIDATA,RETURN,LEGIEN
"RTN","RGFIPM",26,0)
 ;
"RTN","RGFIPM",27,0)
 D
"RTN","RGFIPM",28,0)
 .S FOUNDERR=0
"RTN","RGFIPM",29,0)
 .I DFN,LEGSN,PRIMSN
"RTN","RGFIPM",30,0)
 .E  D ADDERROR("INPUT PARAMETER MISSING, TAG=XCHANGE,RTN=RGFIPM",6) Q
"RTN","RGFIPM",31,0)
 .;
"RTN","RGFIPM",32,0)
 .S PRIMIEN=$$LKUP^XUAF4(PRIMSN)
"RTN","RGFIPM",33,0)
 .I 'PRIMIEN D ADDERROR("INSTITUTION LOOKUP FAILED, STATION# = "_PRIMSN,229) Q
"RTN","RGFIPM",34,0)
 .S LEGIEN=$$LKUP^XUAF4(LEGSN)
"RTN","RGFIPM",35,0)
 .I 'LEGIEN D ADDERROR("INSTITUTION LOOKUP FAILED, STATION# = "_LEGSN,229)
"RTN","RGFIPM",36,0)
 .;
"RTN","RGFIPM",37,0)
 .D GETALL^RGFIU(DFN,.MPIDATA)
"RTN","RGFIPM",38,0)
 .;
"RTN","RGFIPM",39,0)
 .;if the legacy site is the CMOR change it to the primary site
"RTN","RGFIPM",40,0)
 .I MPIDATA("CMOR")=LEGSN,($$CHANGE^MPIF001(DFN,PRIMIEN)'=1) D ADDERROR("ERROR CHANGING CMOR TO "_PRIMSN,6)
"RTN","RGFIPM",41,0)
 .;
"RTN","RGFIPM",42,0)
 .;if the legacy system is on the TF list, remove it
"RTN","RGFIPM",43,0)
 .I $D(MPIDATA("TF",LEGSN)) S RETURN=$$DELETETF^VAFCTFU(MPIDATA("ICN"),MPIDATA("TF",LEGSN,"INSTIEN")) I +RETURN D ADDERROR("FAILURE TO DELETE TREATING FACILITY = "_LEGSN,6)
"RTN","RGFIPM",44,0)
 .;
"RTN","RGFIPM",45,0)
 .;if the primary site is not on the TF list, then add it OR
"RTN","RGFIPM",46,0)
 .;its on the Tf list but with an earlier date than the legacy and legacy has an event reason OR legacy has an event reason and primary doesn't, change it
"RTN","RGFIPM",47,0)
 .I ('$D(MPIDATA("TF",PRIMSN)))!($G(MPIDATA("TF",PRIMSN,"LASTDATE"))<$G(MPIDATA("TF",LEGSN,"LASTDATE"))&$G(MPIDATA("TF",LEGSN,"EVENT")))!($G(MPIDATA("TF",LEGSN,"EVENT"))&('$G(MPIDATA("TF",PRIMSN,"EVENT")))) D 
"RTN","RGFIPM",48,0)
 ..;should not be necessar to delete old TF entry for primary before calling FILE^VACTFU
"RTN","RGFIPM",49,0)
 ..;I $D(MPIDATA("TF",PRIMSN)) S RETURN=$$DELETETF^VAFCTFU(MPIDATA("ICN"),MPIDATA("TF",PRIMSN,"INSTIEN"))
"RTN","RGFIPM",50,0)
 ..;
"RTN","RGFIPM",51,0)
 ..D FILE^VAFCTFU(DFN,PRIMIEN_"^"_$G(MPIDATA("TF",LEGSN,"LASTDATE"))_"^"_$G(MPIDATA("TF",LEGSN,"EVENT")),1)
"RTN","RGFIPM",52,0)
 .;
"RTN","RGFIPM",53,0)
 .Q:'MPIDATA("SUB")
"RTN","RGFIPM",54,0)
 .;Terminate the subscription of legacy site
"RTN","RGFIPM",55,0)
 .I LEGIEN,LEGIEN'=+$$SITE^VASITE D UPD^HLSUB(MPIDATA("SUB"),$$GETLINK^RGFIU(LEGIEN),,,$$NOW^XLFDT)
"RTN","RGFIPM",56,0)
 .;
"RTN","RGFIPM",57,0)
 .;if the primary site is not on the subscription list then add it - unless this site is the primary site!
"RTN","RGFIPM",58,0)
 .D
"RTN","RGFIPM",59,0)
 ..Q:(($P($$SITE^VASITE(),"^",3))=PRIMSN)
"RTN","RGFIPM",60,0)
 ..;Add primary site as a subscriber
"RTN","RGFIPM",61,0)
 ..N ERR
"RTN","RGFIPM",62,0)
 ..;Get the logical link for the primary site
"RTN","RGFIPM",63,0)
 ..S PRIMLINK=$$GETLINK^RGFIU(PRIMIEN)
"RTN","RGFIPM",64,0)
 ..I PRIMLINK="" D ADDERROR("FAILURE TO ADD SUBSCRIPTION FOR STATION# = "_PRIMSN,224) Q
"RTN","RGFIPM",65,0)
 ..D UPD^HLSUB(MPIDATA("SUB"),PRIMLINK,0,,"@",,.ERR)
"RTN","RGFIPM",66,0)
 ..I $O(ERR(0)) D ADDERROR("FAILURE TO ADD SUBSCRIPTION FOR STATION# = "_PRIMSN,6)
"RTN","RGFIPM",67,0)
 Q $S(FOUNDERR:0,1:1)
"RTN","RGFIPM",68,0)
 ;
"RTN","RGFIPM",69,0)
ADDERROR(MSG,CODE) ;
"RTN","RGFIPM",70,0)
 ;Description:  Puts the error message on a list.  If an exception type code is passed the exception handler will be called.
"RTN","RGFIPM",71,0)
 ;
"RTN","RGFIPM",72,0)
 ;Input:
"RTN","RGFIPM",73,0)
 ;  MSG - message text
"RTN","RGFIPM",74,0)
 ;  CODE  - a CIRN exception type (optional)
"RTN","RGFIPM",75,0)
 ;  ERROR() - this is the array where errors are being tracked
"RTN","RGFIPM",76,0)
 ;  DFN - the patient DFN should be defined
"RTN","RGFIPM",77,0)
 ;Output:
"RTN","RGFIPM",78,0)
 ;  ERROR() array has the addtional error entered
"RTN","RGFIPM",79,0)
 ;  FOUNDERR is set to 1, is a flag indicating that an error was encountered
"RTN","RGFIPM",80,0)
 ;
"RTN","RGFIPM",81,0)
 N NEXT
"RTN","RGFIPM",82,0)
 S FOUNDERR=1
"RTN","RGFIPM",83,0)
 S NEXT=($O(ERROR(-1))+1)
"RTN","RGFIPM",84,0)
 S ERROR(NEXT)=MSG
"RTN","RGFIPM",85,0)
 S ERROR(NEXT,"CODE")=$G(CODE)
"RTN","RGFIPM",86,0)
 I $G(CODE),$G(DFN) D EXC^RGFIU(CODE,"FACILITY INTEGRATION ERROR: "_$P($$ERROR^RGFIPM1(MSG,CODE,$$ICN^RGFIU(DFN)),"^",2),DFN)
"RTN","RGFIPM",87,0)
 Q
"RTN","RGFIPM1")
0^3^B31534117
"RTN","RGFIPM1",1,0)
RGFIPM1 ;ALB/CJM-PROCESS FACILITY INTEGRATION MESSAGE ;08/27/99
"RTN","RGFIPM1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**5**;30 Apr 99
"RTN","RGFIPM1",3,0)
 ;
"RTN","RGFIPM1",4,0)
RECEIVE ;
"RTN","RGFIPM1",5,0)
 ;Description: Process the Facility Integration Message
"RTN","RGFIPM1",6,0)
 ;
"RTN","RGFIPM1",7,0)
 ;Input:
"RTN","RGFIPM1",8,0)
 ;  HL7 variables must be defined
"RTN","RGFIPM1",9,0)
 ;Output: none
"RTN","RGFIPM1",10,0)
 ;Variables:
"RTN","RGFIPM1",11,0)
 ;  LEGACY - station # of legacy site
"RTN","RGFIPM1",12,0)
 ;  PRIMARY - station # of primary site
"RTN","RGFIPM1",13,0)
 ;  ICN - patient ICN from message
"RTN","RGFIPM1",14,0)
 ;  CHECKSUM - ICN checksum from message
"RTN","RGFIPM1",15,0)
 ;  CMOR - station # of CMOR
"RTN","RGFIPM1",16,0)
 ;  CMORIEN - ien of CMOR in Institution file
"RTN","RGFIPM1",17,0)
 ;  HERE - ien in Institution file of site this routine is executing on
"RTN","RGFIPM1",18,0)
 ;  FROM - station # of sending site
"RTN","RGFIPM1",19,0)
 ;  DFN - ien from the patient file
"RTN","RGFIPM1",20,0)
 ;  HLERR - error encountered
"RTN","RGFIPM1",21,0)
 ;  LCHKSUM - local checksum
"RTN","RGFIPM1",22,0)
 ;
"RTN","RGFIPM1",23,0)
 N CMOR,CMORIEN,LEGACY,PRIMARY,ICN,FROM,HERE,DFN,CHECKSUM,LCHKSUM
"RTN","RGFIPM1",24,0)
 K HLERR
"RTN","RGFIPM1",25,0)
 D
"RTN","RGFIPM1",26,0)
 .I '$$PARSE(0,.LEGACY,.PRIMARY,.ICN,.CHECKSUM,.FROM,.HLERR) Q
"RTN","RGFIPM1",27,0)
 .S HERE=+$$SITE^VASITE()
"RTN","RGFIPM1",28,0)
 .S DFN=$$DFN^RGFIU(ICN)
"RTN","RGFIPM1",29,0)
 .I ('DFN)!('$D(^DPT(+DFN))) D  Q
"RTN","RGFIPM1",30,0)
 ..S HLERR=$$ERROR("PATIENT LOOKUP BASED ON ICN FAILED",228,ICN)
"RTN","RGFIPM1",31,0)
 .;
"RTN","RGFIPM1",32,0)
 .S LCHKSUM=$P($$GETICN^MPIF001(DFN),"V",2)
"RTN","RGFIPM1",33,0)
 .I (+CHECKSUM)'=(+LCHKSUM) D  Q
"RTN","RGFIPM1",34,0)
 ..;If this is a local problem notify the local site
"RTN","RGFIPM1",35,0)
 ..I (+LCHKSUM)'=(+$$CHECKDG^MPIFSPC(ICN)) D
"RTN","RGFIPM1",36,0)
 ...S HLERR=$$ERROR("LOCAL DATABASE HAS INCORRECT ICN CHECKSUM",1,ICN)
"RTN","RGFIPM1",37,0)
 ...D EXC^RGFIU(1,$P(HLERR,"^",2),DFN)
"RTN","RGFIPM1",38,0)
 ..E  D
"RTN","RGFIPM1",39,0)
 ...S HLERR=$$ERROR("SENT INCORRECT ICN CHECKSUM",1,ICN)
"RTN","RGFIPM1",40,0)
 .;
"RTN","RGFIPM1",41,0)
 .S CMORIEN=$P($$MPINODE^RGFIU(DFN),"^",3)
"RTN","RGFIPM1",42,0)
 .S CMOR=$$STATNUM^RGFIU(CMORIEN)
"RTN","RGFIPM1",43,0)
 .;
"RTN","RGFIPM1",44,0)
 .;Notify site if there is no station number for CMOR
"RTN","RGFIPM1",45,0)
 .I 'CMOR D EXC^RGFIU(221,"ERROR ENCOUNTERED WHILE PROCESSING FACILITY INTEGRATION MESSAGE",DFN)
"RTN","RGFIPM1",46,0)
 .;
"RTN","RGFIPM1",47,0)
 .;
"RTN","RGFIPM1",48,0)
 .;If this site is the CMOR, it should only be receiving this message
"RTN","RGFIPM1",49,0)
 .;from the legacy site
"RTN","RGFIPM1",50,0)
 .I (CMORIEN=HERE),(FROM'=LEGACY) D  Q
"RTN","RGFIPM1",51,0)
 ..S HLERR=$$ERROR("SITE INTEGRATION MSG TO CMOR NOT FROM LEGACY SITE",230,ICN)
"RTN","RGFIPM1",52,0)
 .;
"RTN","RGFIPM1",53,0)
 .;If this site is not the CMOR, the message must be from the CMOR
"RTN","RGFIPM1",54,0)
 .I CMORIEN,HERE'=CMORIEN,FROM'=CMOR D  Q
"RTN","RGFIPM1",55,0)
 ..S HLERR=$$ERROR("SITE INTEGRATION MSG NOT FROM CMOR, CMOR IS "_CMOR,226,ICN)
"RTN","RGFIPM1",56,0)
 ..D EXC^RGFIU(226,$P(HLERR,"^",2),DFN)
"RTN","RGFIPM1",57,0)
 .;
"RTN","RGFIPM1",58,0)
 .;
"RTN","RGFIPM1",59,0)
 .;update database
"RTN","RGFIPM1",60,0)
 .I '$$XCHANGE^RGFIPM(DFN,LEGACY,PRIMARY) ;local exceptins are logged by $$XCHANGE if errors are encountered
"RTN","RGFIPM1",61,0)
 .;
"RTN","RGFIPM1",62,0)
 .;at this point the receiving application has decided that it can accept the message.  An AA will be returned to the sender.
"RTN","RGFIPM1",63,0)
 .;
"RTN","RGFIPM1",64,0)
 .I '$D(HLERR),$G(HL("APAT"))="AL" D ACK(FROM,.HLERR)
"RTN","RGFIPM1",65,0)
 .;
"RTN","RGFIPM1",66,0)
 .;if this is the CMOR, notify subscribers & MPI of the site integration
"RTN","RGFIPM1",67,0)
 .I CMORIEN=HERE,'$$SEND^RGFIBM(DFN,LEGACY,PRIMARY) ;local exceptions are logged by $$SEND if errors are encountered
"RTN","RGFIPM1",68,0)
 ;
"RTN","RGFIPM1",69,0)
 I $D(HLERR),$G(HL("APAT"))="AL" D ACK(FROM,.HLERR)
"RTN","RGFIPM1",70,0)
 D:$G(RGLOG) STOP^RGHLLOG(1)
"RTN","RGFIPM1",71,0)
 Q
"RTN","RGFIPM1",72,0)
 ;
"RTN","RGFIPM1",73,0)
ACK(FROM,HLERR) ;
"RTN","RGFIPM1",74,0)
 ;Description:  Send an acknowledment
"RTN","RGFIPM1",75,0)
 ;
"RTN","RGFIPM1",76,0)
 ;Input:
"RTN","RGFIPM1",77,0)
 ;  FROM - station number of site that sent the original message
"RTN","RGFIPM1",78,0)
 ;  HLERR - error to be returned in format <exception code>^<error text>
"RTN","RGFIPM1",79,0)
 ;  HL7 variables - assumed defined
"RTN","RGFIPM1",80,0)
 ;
"RTN","RGFIPM1",81,0)
 N RESULT,HLA,FS,CS,HLL,TOLINK
"RTN","RGFIPM1",82,0)
 S TOLINK=$$GETLINK^RGFIU($$LKUP^XUAF4(FROM))
"RTN","RGFIPM1",83,0)
 S HLL("LINKS",1)="RG FACILITY INTEGRATION CLIENT^"_TOLINK
"RTN","RGFIPM1",84,0)
 S FS=HL("FS"),CS=$E(HL("ECH"),1)
"RTN","RGFIPM1",85,0)
 I $D(HLERR) D
"RTN","RGFIPM1",86,0)
 .;return NAK
"RTN","RGFIPM1",87,0)
 .S HLA("HLA",1)="MSA"_FS_"ER"_FS_HL("MID")_FS_$P($G(HLERR),";;",2)_FS_FS_FS_CS_CS_CS_$P($G(HLERR),";;")
"RTN","RGFIPM1",88,0)
 E  D
"RTN","RGFIPM1",89,0)
 .;return ACK
"RTN","RGFIPM1",90,0)
 .S HLA("HLA",1)="MSA"_FS_"AA"_FS_HL("MID")
"RTN","RGFIPM1",91,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"LM",1,.RESULT)
"RTN","RGFIPM1",92,0)
 Q
"RTN","RGFIPM1",93,0)
 ;
"RTN","RGFIPM1",94,0)
PARSE(SKIPMSH,LEGACY,PRIMARY,ICN,CHECKSUM,FROM,HLERR) ;
"RTN","RGFIPM1",95,0)
 ;Description:  Parses the message and returns parameters.
"RTN","RGFIPM1",96,0)
 ;Input:
"RTN","RGFIPM1",97,0)
 ;   SKIPMSH - (optional) if set to 1, means that the MSH segment is
"RTN","RGFIPM1",98,0)
 ;              not expected to exist. This is the case when the
"RTN","RGFIPM1",99,0)
 ;              routing logic is called.
"RTN","RGFIPM1",100,0)
 ;   HL7 variables must be defined (assumed)
"RTN","RGFIPM1",101,0)
 ;Output:
"RTN","RGFIPM1",102,0)
 ;  Function Value:  1 on success, 0 on failure
"RTN","RGFIPM1",103,0)
 ;  LEGACY - station # of legacy site (pass by reference)
"RTN","RGFIPM1",104,0)
 ;  PRIMARY - station # of primary site (pass by reference)
"RTN","RGFIPM1",105,0)
 ;  ICN - ICN of patient (pass by reference)
"RTN","RGFIPM1",106,0)
 ;  CHECKSUM - ICN checksum (pass by reference)
"RTN","RGFIPM1",107,0)
 ;  FROM - station # of sendign site (pass by reference)
"RTN","RGFIPM1",108,0)
 ;  HLERR - returns a message if an error is encountered (pass by reference) 
"RTN","RGFIPM1",109,0)
 ;
"RTN","RGFIPM1",110,0)
 ;Variables:
"RTN","RGFIPM1",111,0)
 ;  FS - field seperator
"RTN","RGFIPM1",112,0)
 ;  CS - component seperator
"RTN","RGFIPM1",113,0)
 ;  ERRFLAG - initially set to 1, set to 0 if message passes all checks
"RTN","RGFIPM1",114,0)
 ;
"RTN","RGFIPM1",115,0)
 N FS,CS,ERRFLAG
"RTN","RGFIPM1",116,0)
 S FS=HL("FS")
"RTN","RGFIPM1",117,0)
 S CS=$E(HL("ECH"),1)
"RTN","RGFIPM1",118,0)
 S ERRFLAG=1
"RTN","RGFIPM1",119,0)
 S (LEGACY,PRIMARY,ICN,CHECKSUM,FROM)=""
"RTN","RGFIPM1",120,0)
 K HLERR
"RTN","RGFIPM1",121,0)
 ;
"RTN","RGFIPM1",122,0)
 D
"RTN","RGFIPM1",123,0)
 .D:'$G(SKIPMSH)  Q:$D(HLERR)
"RTN","RGFIPM1",124,0)
 ..X HLNEXT I (HLQUIT'>0) S HLERR=$$SEGERROR("MSH") Q
"RTN","RGFIPM1",125,0)
 ..I $P(HLNODE,FS)'["MSH" S HLERR=$$SEGERROR("MSH") Q
"RTN","RGFIPM1",126,0)
 ..S FROM=$P($P(HLNODE,FS,4),CS)
"RTN","RGFIPM1",127,0)
 ..I 'FROM S HLERR=$$ERROR("MISSING STATION NUMBER IN MSH SEGMENT FOR SENDING SITE",11) Q
"RTN","RGFIPM1",128,0)
 .;
"RTN","RGFIPM1",129,0)
 .X HLNEXT I (HLQUIT'>0) S HLERR=$$SEGERROR("EVN") Q
"RTN","RGFIPM1",130,0)
 .I $P(HLNODE,FS)'["EVN" D  Q:$D(HLERR)
"RTN","RGFIPM1",131,0)
 ..I $G(SKIPMSH) X HLNEXT
"RTN","RGFIPM1",132,0)
 ..I $P(HLNODE,FS)'["EVN" S HLERR=$$SEGERROR("EVN") Q
"RTN","RGFIPM1",133,0)
 .I $P(HLNODE,FS,5)'=51 S HLERR=$$ERROR("EVENT REASON CODE NOT 51",9) Q
"RTN","RGFIPM1",134,0)
 .;
"RTN","RGFIPM1",135,0)
 .X HLNEXT I (HLQUIT'>0) S HLERR=$$SEGERROR("PID") Q
"RTN","RGFIPM1",136,0)
 .I $P(HLNODE,FS)'["PID" S HLERR=$$SEGERROR("PID") Q
"RTN","RGFIPM1",137,0)
 .S ICN=$P($P(HLNODE,FS,3),"V")
"RTN","RGFIPM1",138,0)
 .I 'ICN D  Q
"RTN","RGFIPM1",139,0)
 ..S HLERR=$$ERROR("MISSING ICN IN PID SEGMENT",10)
"RTN","RGFIPM1",140,0)
 .S CHECKSUM=$P($P(HLNODE,FS,3),"V",2)
"RTN","RGFIPM1",141,0)
 .;
"RTN","RGFIPM1",142,0)
 .X HLNEXT I (HLQUIT'>0) S HLERR=$$SEGERROR("PV1",ICN) Q
"RTN","RGFIPM1",143,0)
 .I $P(HLNODE,FS)'["PV1" S HLERR=$$SEGERROR("PV1",ICN) Q
"RTN","RGFIPM1",144,0)
 .;
"RTN","RGFIPM1",145,0)
 .X HLNEXT I (HLQUIT'>0) S HLERR=$$SEGERROR("NTE",ICN) Q
"RTN","RGFIPM1",146,0)
 .I $P(HLNODE,FS)'["NTE" S HLERR=$$SEGERROR("NTE",ICN) Q
"RTN","RGFIPM1",147,0)
 .S LEGACY=$P($P(HLNODE,FS,4),CS)
"RTN","RGFIPM1",148,0)
 .I 'LEGACY S HLERR=$$ERROR("MISSING LEGACY STATION # IN NTE SEGMENT",8,ICN) Q
"RTN","RGFIPM1",149,0)
 .S PRIMARY=$P($P(HLNODE,FS,4),CS,2)
"RTN","RGFIPM1",150,0)
 .I 'PRIMARY S HLERR=$$ERROR("MISSING PRIMARY STATION # IN NTE SEGMENT",8,ICN) Q
"RTN","RGFIPM1",151,0)
 .S ERRFLAG=0
"RTN","RGFIPM1",152,0)
 Q 'ERRFLAG
"RTN","RGFIPM1",153,0)
 ;
"RTN","RGFIPM1",154,0)
ERROR(ERRMSG,CODE,ICN) ;
"RTN","RGFIPM1",155,0)
 ;Description:  formats ERRMSG in format <exception type>;;<error text>
"RTN","RGFIPM1",156,0)
 ;Input:
"RTN","RGFIPM1",157,0)
 ;  ERRMSG - text to incorporate into message
"RTN","RGFIPM1",158,0)
 ;  CODE - Exception Type
"RTN","RGFIPM1",159,0)
 ;  ICN - patient ICN
"RTN","RGFIPM1",160,0)
 ;  
"RTN","RGFIPM1",161,0)
 ;
"RTN","RGFIPM1",162,0)
 Q $G(CODE)_";;"_" From Station:"_$P($$SITE^VASITE(),"^",3)_" ICN:"_$G(ICN)_" Code:"_$G(CODE)_" Msg:"_$G(ERRMSG)
"RTN","RGFIPM1",163,0)
 ;
"RTN","RGFIPM1",164,0)
 ;
"RTN","RGFIPM1",165,0)
SEGERROR(SEGMENT,ICN) ;
"RTN","RGFIPM1",166,0)
 ;Description:  formats error if expected segment not there
"RTN","RGFIPM1",167,0)
 S ERRMSG="MISSING SEGMENT: "_SEGMENT
"RTN","RGFIPM1",168,0)
 Q $$ERROR(ERRMSG,7,$G(ICN))
"RTN","RGFIRM")
0^4^B21437143
"RTN","RGFIRM",1,0)
RGFIRM ;ALB/CJM-ROUTE FACILITY INTEGRATION MESSAGE ;08/27/99
"RTN","RGFIRM",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**5**;30 Apr 99
"RTN","RGFIRM",3,0)
 ;
"RTN","RGFIRM",4,0)
MROUTE ;
"RTN","RGFIRM",5,0)
 ;Description: routing logic for the Facility Integration Message. This
"RTN","RGFIRM",6,0)
 ;entry point is meant to be called by the HL7 pacakge when used in
"RTN","RGFIRM",7,0)
 ;the message routing logic of the client protocol.
"RTN","RGFIRM",8,0)
 ;
"RTN","RGFIRM",9,0)
 ;Input:
"RTN","RGFIRM",10,0)
 ;  HL7 variables must be defined
"RTN","RGFIRM",11,0)
 ;Output:
"RTN","RGFIRM",12,0)
 ;  HLL("LINKS") array containing the dynamic routing list
"RTN","RGFIRM",13,0)
 ;Variables:
"RTN","RGFIRM",14,0)
 ;  LEGACY - station # of legacy site
"RTN","RGFIRM",15,0)
 ;  PRIMARY - station # of primary site
"RTN","RGFIRM",16,0)
 ;  ICN - patient ICN from message
"RTN","RGFIRM",17,0)
 ;  DFN - ien from the patient file
"RTN","RGFIRM",18,0)
 ;
"RTN","RGFIRM",19,0)
 N LEGACY,PRIMARY,ICN,DFN
"RTN","RGFIRM",20,0)
 S (DFN,LEGACY,PRIMARY,ICN)=""
"RTN","RGFIRM",21,0)
 Q:'$$PARSE^RGFIPM1(1,.LEGACY,.PRIMARY,.ICN)
"RTN","RGFIRM",22,0)
 S DFN=$$DFN^RGFIU(ICN)
"RTN","RGFIRM",23,0)
 Q:'DFN
"RTN","RGFIRM",24,0)
 D ROUTE(DFN,LEGACY,PRIMARY,.HLL)
"RTN","RGFIRM",25,0)
 Q
"RTN","RGFIRM",26,0)
 ;
"RTN","RGFIRM",27,0)
ROUTE(DFN,LEGACY,PRIMARY,HLL) ;
"RTN","RGFIRM",28,0)
 ;Description: routing logic for the Facility Integration Message. This
"RTN","RGFIRM",29,0)
 ;entry point is designed to be called directly by the application.
"RTN","RGFIRM",30,0)
 ;
"RTN","RGFIRM",31,0)
 ;Input:
"RTN","RGFIRM",32,0)
 ;  DFN - ien from the patient file
"RTN","RGFIRM",33,0)
 ;  LEGACY - station # of legacy site
"RTN","RGFIRM",34,0)
 ;  PRIMARY - station # of primary site
"RTN","RGFIRM",35,0)
 ;Output:
"RTN","RGFIRM",36,0)
 ;  HLL("LINKS") array containing the dynamic routing list (pass HLL by reference)
"RTN","RGFIRM",37,0)
 ;Variables:
"RTN","RGFIRM",38,0)
 ;  SUB - ien of the subscriber list
"RTN","RGFIRM",39,0)
 ;  HERE - station # of site this routine is executing on
"RTN","RGFIRM",40,0)
 ;  HEREIEN - ien in Institution file of site this routine is executing on
"RTN","RGFIRM",41,0)
 ;  MPINODE - "MPI" node from the Patient file
"RTN","RGFIRM",42,0)
 ;  CMOR - station # of CMOR
"RTN","RGFIRM",43,0)
 ;  CMORIEN - ien in Institution file of CMOR
"RTN","RGFIRM",44,0)
 ;
"RTN","RGFIRM",45,0)
 K HLL("LINKS")
"RTN","RGFIRM",46,0)
 ;
"RTN","RGFIRM",47,0)
 I $G(LEGACY),$G(PRIMARY),$G(DFN) D
"RTN","RGFIRM",48,0)
 .;just checking
"RTN","RGFIRM",49,0)
 E  Q
"RTN","RGFIRM",50,0)
 ;
"RTN","RGFIRM",51,0)
 N SUB,HERE,HEREIEN,MPINODE,CMOR,CMORIEN
"RTN","RGFIRM",52,0)
 S (SUB,HERE,HEREIEN,MPINODE,CMOR,CMORIEN)=""
"RTN","RGFIRM",53,0)
 S HEREIEN=$$SITE^VASITE(),HERE=$P(HEREIEN,"^",3),HEREIEN=+HEREIEN
"RTN","RGFIRM",54,0)
 S MPINODE=$$MPINODE^RGFIU(DFN)
"RTN","RGFIRM",55,0)
 S CMORIEN=$P(MPINODE,"^",3)
"RTN","RGFIRM",56,0)
 S CMOR=$$STATNUM^RGFIU(CMORIEN)
"RTN","RGFIRM",57,0)
 ;
"RTN","RGFIRM",58,0)
 ;If the CMOR is not known, the message can not be routed
"RTN","RGFIRM",59,0)
 I 'CMORIEN D  Q
"RTN","RGFIRM",60,0)
 .D EXC^RGFIU(221,"ERROR ENCOUNTERED WHILE PROCESSING FACITLIY INTEGRATION MESSAGE: MISSING CMOR",DFN)
"RTN","RGFIRM",61,0)
 ;
"RTN","RGFIRM",62,0)
 S SUB=$P(MPINODE,"^",5)
"RTN","RGFIRM",63,0)
 I CMOR=HERE D
"RTN","RGFIRM",64,0)
 .;this is the CMOR, so send to subscribers (except legacy) and Austin MPI
"RTN","RGFIRM",65,0)
 .N MPILINK ;logical link of MPI
"RTN","RGFIRM",66,0)
 .S MPILINK=$$MPILINK^MPIFAPI()
"RTN","RGFIRM",67,0)
 .I $P(MPILINK,"^")=-1 D
"RTN","RGFIRM",68,0)
 ..D EXC^RGFIU(224,"Facility Integration Message not sent to MPI, no MPI link identified in CIRN SITE PARAMETER file (#991.8)",DFN)
"RTN","RGFIRM",69,0)
 .E  D
"RTN","RGFIRM",70,0)
 ..S HLL("LINKS",1)="RG FACILITY INTEGRATION CLIENT^"_MPILINK
"RTN","RGFIRM",71,0)
 .;
"RTN","RGFIRM",72,0)
 .;If this prmary site is not the CMOR, than make sure the prmary site
"RTN","RGFIRM",73,0)
 .;is on the subscription list
"RTN","RGFIRM",74,0)
 .;If this prmary site is not the CMOR, than make sure the prmary site
"RTN","RGFIRM",75,0)
 .;is on the subscription list
"RTN","RGFIRM",76,0)
 .I PRIMARY'=CMOR D
"RTN","RGFIRM",77,0)
 ..;PRIMIEN = ien of primary site in Institution file, LINK = its logical link
"RTN","RGFIRM",78,0)
 ..N PRIMIEN,LINK
"RTN","RGFIRM",79,0)
 ..S PRIMIEN=$$LKUP^XUAF4(PRIMARY)
"RTN","RGFIRM",80,0)
 ..Q:'PRIMIEN
"RTN","RGFIRM",81,0)
 ..;set HLL array to route message to primary site
"RTN","RGFIRM",82,0)
 ..S LINK=$$GETLINK^RGFIU(PRIMIEN)
"RTN","RGFIRM",83,0)
 ..I '$L(LINK) D
"RTN","RGFIRM",84,0)
 ...D EXC^RGFIU(224,"Facility Integration Message not sent to primary site, station # "_PRIMARY,DFN)
"RTN","RGFIRM",85,0)
 ..E  D
"RTN","RGFIRM",86,0)
 ...S HLL("LINKS",2)="RG FACILITY INTEGRATION CLIENT^"_LINK
"RTN","RGFIRM",87,0)
 .;
"RTN","RGFIRM",88,0)
 .D:SUB
"RTN","RGFIRM",89,0)
 ..;there is a subscription list, use it to route the message, with changes
"RTN","RGFIRM",90,0)
 ..;Variables:
"RTN","RGFIRM",91,0)
 ..;  ITEM - one of the sites (by subscript # on HLL("LINKS") array) on the subscriber list
"RTN","RGFIRM",92,0)
 ..;  LINK - logical link ien of subscriber
"RTN","RGFIRM",93,0)
 ..;  HERELINK - logical link of this site
"RTN","RGFIRM",94,0)
 ..;  LEGLINK - logical link of legacy site
"RTN","RGFIRM",95,0)
 ..;
"RTN","RGFIRM",96,0)
 ..N ITEM,NODE,LINK,HERELINK,LEGLINK
"RTN","RGFIRM",97,0)
 ..S HERELINK=$$GETLINK^RGFIU(HEREIEN)
"RTN","RGFIRM",98,0)
 ..S LEGLINK=$$GETLINK^RGFIU($$LKUP^XUAF4(LEGACY))
"RTN","RGFIRM",99,0)
 ..D GET^HLSUB(SUB,,"RG FACILITY INTEGRATION CLIENT",.HLL)
"RTN","RGFIRM",100,0)
 ..;screen out legacy and this (here) site
"RTN","RGFIRM",101,0)
 ..S ITEM=0 F  S ITEM=$O(HLL("LINKS",ITEM)) Q:'ITEM  S NODE=$G(HLL("LINKS",ITEM)),LINK=$P(NODE,"^",6) D:LINK
"RTN","RGFIRM",102,0)
 ...I HERELINK=LINK K HLL("LINKS",ITEM) Q
"RTN","RGFIRM",103,0)
 ...I LEGLINK=LINK K HLL("LINKS",ITEM) Q
"RTN","RGFIRM",104,0)
 E  D
"RTN","RGFIRM",105,0)
 .;send message to CMOR, but only if this is the legacy site
"RTN","RGFIRM",106,0)
 .N CMORLINK
"RTN","RGFIRM",107,0)
 .Q:(LEGACY'=HERE)
"RTN","RGFIRM",108,0)
 .S CMORLINK=$$GETLINK^RGFIU(CMORIEN)
"RTN","RGFIRM",109,0)
 .I '$L(CMORLINK) D
"RTN","RGFIRM",110,0)
 ..D EXC^RGFIU(224,"Facility Integration Message not sent to site "_CMOR,DFN)
"RTN","RGFIRM",111,0)
 .E  D
"RTN","RGFIRM",112,0)
 ..S HLL("LINKS",1)="RG FACILITY INTEGRATION CLIENT^"_CMORLINK
"RTN","RGFIRM",113,0)
 Q
"RTN","RGFIU")
0^5^B33943423
"RTN","RGFIU",1,0)
RGFIU ;ALB/CJM-MPI/PD NDBI MERGE UTILITY (CONTINUED) ;08/27/99
"RTN","RGFIU",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**5**;30 Apr 99
"RTN","RGFIU",3,0)
 ;
"RTN","RGFIU",4,0)
STATNUM(IEN) ;
"RTN","RGFIU",5,0)
 ;Description:  Given an ien to the Institution file, returns as the function value the station number.  Returns "" on failure.
"RTN","RGFIU",6,0)
 ;
"RTN","RGFIU",7,0)
 N STATION
"RTN","RGFIU",8,0)
 Q:'$G(IEN) ""
"RTN","RGFIU",9,0)
 Q:'$D(^DIC(4,IEN,0)) ""
"RTN","RGFIU",10,0)
 S STATION=$P($$NNT^XUAF4(IEN),"^",2)
"RTN","RGFIU",11,0)
 Q $S(+STATION:STATION,1:"")
"RTN","RGFIU",12,0)
 ;
"RTN","RGFIU",13,0)
UPD(FILE,RGDA,DATA,ERROR) ;File data into an existing record.
"RTN","RGFIU",14,0)
 ; Input:
"RTN","RGFIU",15,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",16,0)
 ;   RGDA - New name for traditional DA array, with same meaning.
"RTN","RGFIU",17,0)
 ;            Pass by reference.
"RTN","RGFIU",18,0)
 ;   DATA - Data array to file (pass by reference)
"RTN","RGFIU",19,0)
 ;          Format: DATA(<field #>)=<value>
"RTN","RGFIU",20,0)
 ;
"RTN","RGFIU",21,0)
 ; Output:
"RTN","RGFIU",22,0)
 ;  Function Value -     0=error and 1=no error
"RTN","RGFIU",23,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",24,0)
 ;
"RTN","RGFIU",25,0)
 ; Example: To update a record in subfile 2.0361 in record with ien=353,
"RTN","RGFIU",26,0)
 ;          subrecord ien=68, with the field .01 value = 21:
"RTN","RGFIU",27,0)
 ;    S DATA(.01)=21,RGDA=68,RGDA(1)=353 I $$UPD^RGFIU(2.0361,.RGDA,.DATA,.ERROR) W !,"DONE"
"RTN","RGFIU",28,0)
 ;
"RTN","RGFIU",29,0)
 N FDA,FIELD,IENS,ERRORS
"RTN","RGFIU",30,0)
 ;
"RTN","RGFIU",31,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","RGFIU",32,0)
 ;FDA - the FDA array as defined by FM
"RTN","RGFIU",33,0)
 ;
"RTN","RGFIU",34,0)
 I '$G(RGDA) S ERROR="IEN OF RECORD TO BE UPDATED NOT SPECIFIED" Q 0
"RTN","RGFIU",35,0)
 S IENS=$$IENS^DILF(.RGDA)
"RTN","RGFIU",36,0)
 S FIELD=0
"RTN","RGFIU",37,0)
 F  S FIELD=$O(DATA(FIELD)) Q:'FIELD  D
"RTN","RGFIU",38,0)
 .S FDA(FILE,IENS,FIELD)=$G(DATA(FIELD))
"RTN","RGFIU",39,0)
 D FILE^DIE("K","FDA","ERRORS(1)")
"RTN","RGFIU",40,0)
 I +$G(DIERR) D
"RTN","RGFIU",41,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","RGFIU",42,0)
 E  D
"RTN","RGFIU",43,0)
 .S ERROR=""
"RTN","RGFIU",44,0)
 ;
"RTN","RGFIU",45,0)
 I $S(+$G(DIERR):0,1:1) D CLEAN^DILF Q 1
"RTN","RGFIU",46,0)
 E  D CLEAN^DILF Q 0
"RTN","RGFIU",47,0)
 ;
"RTN","RGFIU",48,0)
GETFIELD(FILE,FIELD,RGDA,ERROR) ;Get field value from an existing record.
"RTN","RGFIU",49,0)
 ; Input:
"RTN","RGFIU",50,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",51,0)
 ;   RGDA - New name for traditional DA array, with same meaning.
"RTN","RGFIU",52,0)
 ;            Pass by reference.
"RTN","RGFIU",53,0)
 ;   FIELD - Field for which value is needed
"RTN","RGFIU",54,0)
 ;
"RTN","RGFIU",55,0)
 ; Output:
"RTN","RGFIU",56,0)
 ;  Function Value -  field value in internal format,"" if an error was encountered
"RTN","RGFIU",57,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",58,0)
 ;
"RTN","RGFIU",59,0)
 N FDA,IENS,ERRORS,VALUE
"RTN","RGFIU",60,0)
 ;
"RTN","RGFIU",61,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","RGFIU",62,0)
 ;FDA - the FDA array as defined by FM
"RTN","RGFIU",63,0)
 ;
"RTN","RGFIU",64,0)
 I '$G(RGDA) S ERROR="IEN OF RECORD TO BE UPDATED NOT SPECIFIED" Q ""
"RTN","RGFIU",65,0)
 S IENS=$$IENS^DILF(.RGDA)
"RTN","RGFIU",66,0)
 S VALUE=$$GET1^DIQ(FILE,IENS,FIELD,"I",,"ERRORS(1)")
"RTN","RGFIU",67,0)
 I +$G(DIERR) D
"RTN","RGFIU",68,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","RGFIU",69,0)
 E  D
"RTN","RGFIU",70,0)
 .S ERROR=""
"RTN","RGFIU",71,0)
 ;
"RTN","RGFIU",72,0)
 I $S(+$G(DIERR):0,1:1) D CLEAN^DILF Q VALUE
"RTN","RGFIU",73,0)
 E  D CLEAN^DILF Q ""
"RTN","RGFIU",74,0)
 ;
"RTN","RGFIU",75,0)
DELETE(FILE,RGDA,ERROR) ;Delete an existing record.
"RTN","RGFIU",76,0)
 ; Input:
"RTN","RGFIU",77,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",78,0)
 ;   RGDA - New name for traditional DA array, with same meaning.
"RTN","RGFIU",79,0)
 ;            Pass by reference.
"RTN","RGFIU",80,0)
 ;
"RTN","RGFIU",81,0)
 ; Output:
"RTN","RGFIU",82,0)
 ;  Function Value -     0=error and 1=no error
"RTN","RGFIU",83,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",84,0)
 ;
"RTN","RGFIU",85,0)
 ; Example: To delete a record in subfile 2.0361 in record with ien=353,
"RTN","RGFIU",86,0)
 ;          subrecord ien=68:
"RTN","RGFIU",87,0)
 ;    S RGDA=68,RGDA(1)=353 I $$DELETE^RGFIU(2.0361,.RGDA,.DATA,.ERROR) W !,"DONE"
"RTN","RGFIU",88,0)
 ;
"RTN","RGFIU",89,0)
 N DATA
"RTN","RGFIU",90,0)
 S DATA(.01)="@"
"RTN","RGFIU",91,0)
 Q $$UPD^RGFIU(FILE,.RGDA,.DATA,.ERROR)
"RTN","RGFIU",92,0)
 Q
"RTN","RGFIU",93,0)
 ;
"RTN","RGFIU",94,0)
ADD(FILE,RGDA,DATA,ERROR,IEN) ;
"RTN","RGFIU",95,0)
 ;Description: Creates a new record and files the data.
"RTN","RGFIU",96,0)
 ; Input:
"RTN","RGFIU",97,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",98,0)
 ;   RGDA - New name for traditional FileMan DA array with same
"RTN","RGFIU",99,0)
 ;            meaning. Pass by reference.  Only needed if adding to a
"RTN","RGFIU",100,0)
 ;            subfile.
"RTN","RGFIU",101,0)
 ;   DATA - Data array to file, pass by reference
"RTN","RGFIU",102,0)
 ;          Format: DATA(<field #>)=<value>
"RTN","RGFIU",103,0)
 ;   IEN - internal entry number to use (optional)
"RTN","RGFIU",104,0)
 ;
"RTN","RGFIU",105,0)
 ; Output:
"RTN","RGFIU",106,0)
 ;   Function Value - If no error then it returns the ien of the created record, else returns NULL.
"RTN","RGFIU",107,0)
 ;  RGDA - returns the ien of the new record, NULL if none created.  If needed, pass by reference.
"RTN","RGFIU",108,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",109,0)
 ;
"RTN","RGFIU",110,0)
 ; Example: To add a record in subfile 2.0361 in the record with ien=353
"RTN","RGFIU",111,0)
 ;          with the field .01 value = 21:
"RTN","RGFIU",112,0)
 ;  S DATA(.01)=21,RGDA(1)=353 I $$ADD^RGFIU(2.0361,.RGDA,.DATA) W !,"DONE"
"RTN","RGFIU",113,0)
 ;
"RTN","RGFIU",114,0)
 ; Example: If creating a record not in a subfile, would look like this:
"RTN","RGFIU",115,0)
 ;          S DATA(.01)=21 I $$ADD^RGFIU(867,,.DATA) W !,"DONE"
"RTN","RGFIU",116,0)
 ;
"RTN","RGFIU",117,0)
 N FDA,FIELD,IENA,IENS,ERRORS
"RTN","RGFIU",118,0)
 ;
"RTN","RGFIU",119,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","RGFIU",120,0)
 ;IENA - the Internal Entry Numebr Array defined by FM
"RTN","RGFIU",121,0)
 ;FDA - the FDA array defined by FM
"RTN","RGFIU",122,0)
 ;IEN - the ien of the new record
"RTN","RGFIU",123,0)
 ;
"RTN","RGFIU",124,0)
 S RGDA="+1"
"RTN","RGFIU",125,0)
 S IENS=$$IENS^DILF(.RGDA)
"RTN","RGFIU",126,0)
 S FIELD=0
"RTN","RGFIU",127,0)
 F  S FIELD=$O(DATA(FIELD)) Q:'FIELD  D
"RTN","RGFIU",128,0)
 .S FDA(FILE,IENS,FIELD)=$G(DATA(FIELD))
"RTN","RGFIU",129,0)
 I $G(IEN) S IENA(1)=IEN
"RTN","RGFIU",130,0)
 D UPDATE^DIE("","FDA","IENA","ERRORS(1)")
"RTN","RGFIU",131,0)
 I +$G(DIERR) D
"RTN","RGFIU",132,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","RGFIU",133,0)
 .S IEN=""
"RTN","RGFIU",134,0)
 E  D
"RTN","RGFIU",135,0)
 .S IEN=IENA(1)
"RTN","RGFIU",136,0)
 .S ERROR=""
"RTN","RGFIU",137,0)
 D CLEAN^DILF
"RTN","RGFIU",138,0)
 S RGDA=IEN
"RTN","RGFIU",139,0)
 Q IEN
"RTN","RGFIU",140,0)
 ;
"RTN","RGFIU",141,0)
TESTVAL(FILE,FIELD,VALUE) ;
"RTN","RGFIU",142,0)
 ;Description: returns 1 if VALUE is a valid value for FIELD in FILE
"RTN","RGFIU",143,0)
 ;
"RTN","RGFIU",144,0)
 Q:(('$G(FILE))!('$G(FIELD))) 0
"RTN","RGFIU",145,0)
 ;
"RTN","RGFIU",146,0)
 N DISPLAY,VALID,RESULT
"RTN","RGFIU",147,0)
 S VALID=1
"RTN","RGFIU",148,0)
 ;
"RTN","RGFIU",149,0)
 ;if there is no external value then it is not valid
"RTN","RGFIU",150,0)
 S DISPLAY=$$EXTERNAL^DILFD(FILE,FIELD,"F",VALUE)
"RTN","RGFIU",151,0)
 I (DISPLAY="") S VALID=0
"RTN","RGFIU",152,0)
 ; 
"RTN","RGFIU",153,0)
 I VALID,$$GET1^DID(FILE,FIELD,"","TYPE")'["POINTER" D
"RTN","RGFIU",154,0)
 .D CHK^DIE(FILE,FIELD,,VALUE,.RESULT) I RESULT="^" S VALID=0 Q
"RTN","RGFIU",155,0)
 Q VALID
"RTN","RGFIU",156,0)
 ;
"RTN","RGFIU",157,0)
GETLINK(INSTIEN) ;
"RTN","RGFIU",158,0)
 ;Description:  Returns name of logical link for institition, given the institution ien.  Returns "" if a logical link name not found.
"RTN","RGFIU",159,0)
 ;
"RTN","RGFIU",160,0)
 Q:'$G(INSTIEN) ""
"RTN","RGFIU",161,0)
 ;
"RTN","RGFIU",162,0)
 N LINK,I,LINKNAME
"RTN","RGFIU",163,0)
 S LINKNAME=""
"RTN","RGFIU",164,0)
 D
"RTN","RGFIU",165,0)
 .;don't check if enabled - if shut down, message will be queued
"RTN","RGFIU",166,0)
 .;Q:'$$CHKLL^HLUTIL(INSTIEN)
"RTN","RGFIU",167,0)
 .;
"RTN","RGFIU",168,0)
 .D LINK^HLUTIL3(INSTIEN,.LINK)
"RTN","RGFIU",169,0)
 .S I=$O(LINK(0))
"RTN","RGFIU",170,0)
 .I I,$L(LINK(I)) S LINKNAME=LINK(I)
"RTN","RGFIU",171,0)
 Q LINKNAME
"RTN","RGFIU",172,0)
 ;
"RTN","RGFIU",173,0)
ASKYESNO(PROMPT,DEFAULT) ;
"RTN","RGFIU",174,0)
 ;Description: Displays PROMPT, appending '?'.  Expects a YES NO response.
"RTN","RGFIU",175,0)
 ;Input:
"RTN","RGFIU",176,0)
 ;   PROMPT - text to display as prompt.  Appends '?'
"RTN","RGFIU",177,0)
 ;   DEFAULT - (optional) YES or NO.  If not passed, defaults to YES
"RTN","RGFIU",178,0)
 ;Output:
"RTN","RGFIU",179,0)
 ;  Function value: 1 if yes, 0 if no, "" if '^' entered or timeout
"RTN","RGFIU",180,0)
 ;
"RTN","RGFIU",181,0)
 N DIR,Y
"RTN","RGFIU",182,0)
 S DIR(0)="Y"
"RTN","RGFIU",183,0)
 S DIR("A")=PROMPT
"RTN","RGFIU",184,0)
 S DIR("B")=$S($G(DEFAULT)="NO":"NO",1:"YES")
"RTN","RGFIU",185,0)
 D ^DIR
"RTN","RGFIU",186,0)
 Q:$D(DIRUT) ""
"RTN","RGFIU",187,0)
 Q Y
"RTN","RGFIU",188,0)
 ;
"RTN","RGFIU",189,0)
EXC(RGEXC,RGERR,RGDFN) ;
"RTN","RGFIU",190,0)
 N ICN
"RTN","RGFIU",191,0)
 I +$G(RGDFN) D
"RTN","RGFIU",192,0)
 .S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGFIU",193,0)
 .I ICN'>0 S ICN=""
"RTN","RGFIU",194,0)
 .S RGERR=$G(RGERR)_"  Patient Name: "_$E($$NAME(RGDFN),1,25)_" SSN: "_$$SSN(RGDFN)_"  ICN: "_ICN
"RTN","RGFIU",195,0)
 D EXC^RGHLLOG($G(RGEXC),$E($G(RGERR),1,235),$G(RGDFN))
"RTN","RGFIU",196,0)
 Q
"RTN","RGFIU",197,0)
 ;
"RTN","RGFIU",198,0)
SSN(DFN) ;
"RTN","RGFIU",199,0)
 ;Description: Function returns the patient's SSN, or "" on failure.
"RTN","RGFIU",200,0)
 Q $$GETFIELD(2,.09,.DFN)
"RTN","RGFIU",201,0)
 ;
"RTN","RGFIU",202,0)
NAME(DFN) ;
"RTN","RGFIU",203,0)
 ;Description: Function returns the patient's NAME, or "" on failure.
"RTN","RGFIU",204,0)
 Q $$GETFIELD(2,.01,.DFN)
"RTN","RGFIU",205,0)
 ;
"RTN","RGFIU",206,0)
ICN(DFN) ;Return patient ICN
"RTN","RGFIU",207,0)
 NEW RESULT
"RTN","RGFIU",208,0)
 S RESULT=$$GETICN^MPIF001($G(DFN))
"RTN","RGFIU",209,0)
 I RESULT<0 Q ""
"RTN","RGFIU",210,0)
 Q +RESULT
"RTN","RGFIU",211,0)
 ;
"RTN","RGFIU",212,0)
DFN(ICN) ;Return patient IEN
"RTN","RGFIU",213,0)
 NEW RESULT
"RTN","RGFIU",214,0)
 S RESULT=$$GETDFN^MPIF001($G(ICN))
"RTN","RGFIU",215,0)
 I RESULT<0 Q ""
"RTN","RGFIU",216,0)
 Q RESULT
"RTN","RGFIU",217,0)
 ;
"RTN","RGFIU",218,0)
MPINODE(DFN) ;
"RTN","RGFIU",219,0)
 N NODE
"RTN","RGFIU",220,0)
 S NODE=$$MPINODE^MPIFAPI($G(DFN))
"RTN","RGFIU",221,0)
 I +NODE=-1 S NODE=""
"RTN","RGFIU",222,0)
 Q NODE
"RTN","RGFIU",223,0)
 ;
"RTN","RGFIU",224,0)
GETALL(DFN,MPIDATA) ;
"RTN","RGFIU",225,0)
 ;Descripition: Gets the MPI data and treating facility list
"RTN","RGFIU",226,0)
 ;
"RTN","RGFIU",227,0)
 ;Input:
"RTN","RGFIU",228,0)
 ;   DFN - patient ien
"RTN","RGFIU",229,0)
 ;Output:
"RTN","RGFIU",230,0)
 ;   MPIDATA       - output array (pass by reference)
"RTN","RGFIU",231,0)
 ;       "ICN") = <ICN>
"RTN","RGFIU",232,0)
 ;       "CHKSUM") = <ICN checksum>
"RTN","RGFIU",233,0)
 ;       "LOC") = <1 if ICN is local, 0 if national>
"RTN","RGFIU",234,0)
 ;       "CMOR") = <station number of CMOR>
"RTN","RGFIU",235,0)
 ;       "TF",<station number of TF>,"INSTIEN")=<ien of treating facility in Institution file>
"RTN","RGFIU",236,0)
 ;       "TF",<station number of TF>,"LASTDATE")=<date last treated>
"RTN","RGFIU",237,0)
 ;       "TF",<station number of TF>,"EVENT")=<ADT event reason (a pointer)>
"RTN","RGFIU",238,0)
 ;       "SUB") = <ien of subscriber list>
"RTN","RGFIU",239,0)
 ;
"RTN","RGFIU",240,0)
 N NODE,IEN,STAT,INST,LINK,I,HLL
"RTN","RGFIU",241,0)
 ;
"RTN","RGFIU",242,0)
 K MPIDATA
"RTN","RGFIU",243,0)
 ;
"RTN","RGFIU",244,0)
 ;get MPI data
"RTN","RGFIU",245,0)
 S NODE=$$MPINODE^RGFIU(DFN)
"RTN","RGFIU",246,0)
 S MPIDATA("ICN")=$P(NODE,"^"),MPIDATA("CHKSUM")=$P(NODE,"^",2),MPIDATA("LOC")=$P(NODE,"^",4),MPIDATA("CMOR")=$$STATNUM^RGFIU($P(NODE,"^",3)),MPIDATA("SUB")=$P(NODE,"^",5)
"RTN","RGFIU",247,0)
 ;
"RTN","RGFIU",248,0)
 ;get TF list
"RTN","RGFIU",249,0)
 I MPIDATA("ICN") D
"RTN","RGFIU",250,0)
 .N ARRAY,ITEM,NODE,STAT
"RTN","RGFIU",251,0)
 .Q:$$QUERYTF^VAFCTFU1(MPIDATA("ICN"),"ARRAY")
"RTN","RGFIU",252,0)
 .S ITEM=0
"RTN","RGFIU",253,0)
 .F  S ITEM=$O(ARRAY(ITEM)) Q:'ITEM  D
"RTN","RGFIU",254,0)
 ..S NODE=ARRAY(ITEM)
"RTN","RGFIU",255,0)
 ..S STAT=$$STATNUM^RGFIU($P(NODE,"^"))
"RTN","RGFIU",256,0)
 ..Q:'STAT
"RTN","RGFIU",257,0)
 ..S MPIDATA("TF",STAT,"INSTIEN")=$P(NODE,"^",1)
"RTN","RGFIU",258,0)
 ..S MPIDATA("TF",STAT,"LASTDATE")=$P(NODE,"^",2)
"RTN","RGFIU",259,0)
 ..S MPIDATA("TF",STAT,"EVENT")=$P(NODE,"^",3)
"RTN","RGFIU",260,0)
 Q
"RTN","RGP5ENV")
0^^B591920
"RTN","RGP5ENV",1,0)
RGP5ENV ;B'HAM/PTD/CJM-RG*1*5 PATCH ENVIRONMENT CHECK ROUTINE ;06/17/99
"RTN","RGP5ENV",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**5**;30 Apr 99
"RTN","RGP5ENV",3,0)
 ;Determine current version of CIRN installed.
"RTN","RGP5ENV",4,0)
 S RGVER=$$VERSION^XPDUTL("RG")
"RTN","RGP5ENV",5,0)
 ;If version not 1.0, abort install.
"RTN","RGP5ENV",6,0)
 I (RGVER'="1.0") W !!," CLINICAL INFO RESOURCE NETWORK version 1.0 must be installed." S XPDQUIT=2
"RTN","RGP5ENV",7,0)
 I '$D(XPDQUIT) W !!,"Environment check is ok.",!
"RTN","RGP5ENV",8,0)
 K RGVER
"RTN","RGP5ENV",9,0)
 Q
"RTN","RGP5ENV",10,0)
 ;
"SEC","^DIC",991.11,991.11,0,"AUDIT")
@
"SEC","^DIC",991.11,991.11,0,"DD")
@
"SEC","^DIC",991.11,991.11,0,"DEL")
@
"SEC","^DIC",991.11,991.11,0,"LAYGO")
@
"SEC","^DIC",991.11,991.11,0,"RD")
@
"SEC","^DIC",991.11,991.11,0,"WR")
@
"VER")
8.0^22.0
"^DD",991.11,991.11,0)
FIELD^^99^8
"^DD",991.11,991.11,0,"DDA")
N
"^DD",991.11,991.11,0,"DT")
2980721
"^DD",991.11,991.11,0,"ID",10)
W:$D(^(10)) "   ",$E(^(10),1,100)
"^DD",991.11,991.11,0,"IX","B",991.11,.01)

"^DD",991.11,991.11,0,"IX","C",991.11,10)

"^DD",991.11,991.11,0,"NM","CIRN HL7 EXCEPTION TYPE")

"^DD",991.11,991.11,0,"PT",991.12,2)

"^DD",991.11,991.11,0,"VRPK")
RG
"^DD",991.11,991.11,.01,0)
NUMBER^RNJ12,0X^^0;1^K:X'=X\1!(X<1) X S:$D(X) DINUM=X
"^DD",991.11,991.11,.01,1,0)
^.1
"^DD",991.11,991.11,.01,1,1,0)
991.11^B
"^DD",991.11,991.11,.01,1,1,1)
S ^RGHL7(991.11,"B",$E(X,1,30),DA)=""
"^DD",991.11,991.11,.01,1,1,2)
K ^RGHL7(991.11,"B",$E(X,1,30),DA)
"^DD",991.11,991.11,.01,3)
Index of this exception.
"^DD",991.11,991.11,.01,21,0)
^^1^1^2990308^^
"^DD",991.11,991.11,.01,21,1,0)
This is the index number of this exception.
"^DD",991.11,991.11,.01,"DT")
2970201
"^DD",991.11,991.11,1,0)
SEVERITY^S^0:INFORMATIONAL;1:MINOR;2:SEVERE;^0;2^Q
"^DD",991.11,991.11,1,3)
Severity level of this exception.
"^DD",991.11,991.11,1,21,0)
^^2^2^2990308^^
"^DD",991.11,991.11,1,21,1,0)
This is the severity level of this exception, '0' for Informational,
"^DD",991.11,991.11,1,21,2,0)
'1' for Minor or '2' for Severe.
"^DD",991.11,991.11,1,"DT")
2970201
"^DD",991.11,991.11,2,0)
ACTION^S^0:NONE;1:MAIL;2:ALERT;^0;3^Q
"^DD",991.11,991.11,2,3)
Action to be taken upon logging this exception.
"^DD",991.11,991.11,2,21,0)
^^2^2^2990308^^
"^DD",991.11,991.11,2,21,1,0)
This is the action to be taken upon logging this exception,
"^DD",991.11,991.11,2,21,2,0)
'0' for None, '1' for Mail, or '2' for Alert.
"^DD",991.11,991.11,2,"DT")
2970201
"^DD",991.11,991.11,3,0)
COUNT^NJ12,0X^^0;5^K:X\1'=X!(X<0) X
"^DD",991.11,991.11,3,3)
Total number of exceptions logged with this type.
"^DD",991.11,991.11,3,21,0)
^^1^1^2990308^^
"^DD",991.11,991.11,3,21,1,0)
This is a count of all exceptions logged of this type.
"^DD",991.11,991.11,3,"DT")
2970317
"^DD",991.11,991.11,6,0)
MAIL GROUP^P3.8'^XMB(3.8,^0;4^Q
"^DD",991.11,991.11,6,3)
Mail group to which notification will be sent for alert and mail action types.
"^DD",991.11,991.11,6,21,0)
^^3^3^2990308^^
"^DD",991.11,991.11,6,21,1,0)
This is a pointer to the MAIL GROUP file (#3.8), indicating
"^DD",991.11,991.11,6,21,2,0)
which mail group a notification will be sent to for alert
"^DD",991.11,991.11,6,21,3,0)
and mail action types.
"^DD",991.11,991.11,6,"DT")
2970201
"^DD",991.11,991.11,10,0)
TEXT^F^^10;E1,100^K:$L(X)>100!($L(X)<1) X
"^DD",991.11,991.11,10,1,0)
^.1
"^DD",991.11,991.11,10,1,1,0)
991.11^C
"^DD",991.11,991.11,10,1,1,1)
S ^RGHL7(991.11,"C",$E(X,1,30),DA)=""
"^DD",991.11,991.11,10,1,1,2)
K ^RGHL7(991.11,"C",$E(X,1,30),DA)
"^DD",991.11,991.11,10,1,1,"DT")
2970201
"^DD",991.11,991.11,10,3)
Text message for this exception.
"^DD",991.11,991.11,10,21,0)
^^2^2^2990308^^
"^DD",991.11,991.11,10,21,1,0)
This is a free text field (up to 100 characters) which holds the
"^DD",991.11,991.11,10,21,2,0)
message for this exception.
"^DD",991.11,991.11,10,"DT")
2970201
"^DD",991.11,991.11,20,0)
SECURITY KEY^991.112P^^20;0
"^DD",991.11,991.11,20,21,0)
^^4^4^2990308^^^
"^DD",991.11,991.11,20,21,1,0)
This is used to control access to a particular exception type. 
"^DD",991.11,991.11,20,21,2,0)
A user must possess at least one of the listed security keys to 
"^DD",991.11,991.11,20,21,3,0)
access the associated exception.  If no security keys are listed, 
"^DD",991.11,991.11,20,21,4,0)
access is unrestricted.
"^DD",991.11,991.11,99,0)
DESCRIPTION^991.1199^^99;0
"^DD",991.11,991.11,99,21,0)
^^2^2^2990308^^^
"^DD",991.11,991.11,99,21,1,0)
This is a word-processing field used for storing
"^DD",991.11,991.11,99,21,2,0)
the detailed explanation of this exception type.
"^DD",991.11,991.112,0)
SECURITY KEY SUB-FIELD^^.01^1
"^DD",991.11,991.112,0,"DT")
2980721
"^DD",991.11,991.112,0,"IX","B",991.112,.01)

"^DD",991.11,991.112,0,"NM","SECURITY KEY")

"^DD",991.11,991.112,0,"UP")
991.11
"^DD",991.11,991.112,.01,0)
SECURITY KEY^MP19.1'X^DIC(19.1,^0;1^S DINUM=X
"^DD",991.11,991.112,.01,1,0)
^.1
"^DD",991.11,991.112,.01,1,1,0)
991.112^B
"^DD",991.11,991.112,.01,1,1,1)
S ^RGHL7(991.11,DA(1),20,"B",$E(X,1,30),DA)=""
"^DD",991.11,991.112,.01,1,1,2)
K ^RGHL7(991.11,DA(1),20,"B",$E(X,1,30),DA)
"^DD",991.11,991.112,.01,3)
Enter a security key to control access to this exception.
"^DD",991.11,991.112,.01,21,0)
^^4^4^2990308^^
"^DD",991.11,991.112,.01,21,1,0)
This is used to control access to a particular exception type. 
"^DD",991.11,991.112,.01,21,2,0)
A user must possess at least one of the listed security keys to 
"^DD",991.11,991.112,.01,21,3,0)
access the associated exception.  If no security keys are listed, 
"^DD",991.11,991.112,.01,21,4,0)
access is unrestricted.
"^DD",991.11,991.112,.01,"DT")
2980721
"^DD",991.11,991.1199,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",991.11,991.1199,0,"DT")
2970201
"^DD",991.11,991.1199,0,"NM","DESCRIPTION")

"^DD",991.11,991.1199,0,"UP")
991.11
"^DD",991.11,991.1199,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",991.11,991.1199,.01,3)
Detailed explanation of this exception.
"^DD",991.11,991.1199,.01,21,0)
^^1^1^2990308^^^
"^DD",991.11,991.1199,.01,21,1,0)
This field holds the detailed explanation of this exception.
"^DD",991.11,991.1199,.01,"DT")
2970201
"^DIC",991.11,991.11,0)
CIRN HL7 EXCEPTION TYPE^991.11
"^DIC",991.11,991.11,0,"GL")
^RGHL7(991.11,
"^DIC",991.11,991.11,"%D",0)
^^3^3^2990308^^
"^DIC",991.11,991.11,"%D",1,0)
This file holds the CIRN HL7 exception types.  It is pointed to by
"^DIC",991.11,991.11,"%D",2,0)
the TYPE field (#2) for the EXCEPTION subfield (#991.12) of the CIRN
"^DIC",991.11,991.11,"%D",3,0)
HL7 EXCEPTION LOG file (#991.1).
"^DIC",991.11,"B","CIRN HL7 EXCEPTION TYPE",991.11)

**END**
**END**
