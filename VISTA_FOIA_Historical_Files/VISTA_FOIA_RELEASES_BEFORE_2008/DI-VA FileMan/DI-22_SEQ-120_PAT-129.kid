Released DI*22*129 SEQ #120
Extracted from mail message
**KIDS**:DI*22.0*129^

**INSTALL NAME**
DI*22.0*129
"BLD",501,0)
DI*22.0*129^VA FILEMAN^0^3031125^y
"BLD",501,1,0)
^^2^2^3030804^
"BLD",501,1,1,0)
See patch DI*22*129 in the National Patch Module on FORUM for complete
"BLD",501,1,2,0)
information on this patch.
"BLD",501,4,0)
^9.64PA^^
"BLD",501,"INIT")
DIPR129
"BLD",501,"KRN",0)
^9.67PA^8989.52^19
"BLD",501,"KRN",.4,0)
.4
"BLD",501,"KRN",.401,0)
.401
"BLD",501,"KRN",.402,0)
.402
"BLD",501,"KRN",.403,0)
.403
"BLD",501,"KRN",.5,0)
.5
"BLD",501,"KRN",.84,0)
.84
"BLD",501,"KRN",3.6,0)
3.6
"BLD",501,"KRN",3.8,0)
3.8
"BLD",501,"KRN",9.2,0)
9.2
"BLD",501,"KRN",9.8,0)
9.8
"BLD",501,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",501,"KRN",9.8,"NM",1,0)
DIET^^0^B6605913
"BLD",501,"KRN",9.8,"NM",2,0)
DIAU^^0^B19507595
"BLD",501,"KRN",9.8,"NM","B","DIAU",2)

"BLD",501,"KRN",9.8,"NM","B","DIET",1)

"BLD",501,"KRN",19,0)
19
"BLD",501,"KRN",19.1,0)
19.1
"BLD",501,"KRN",101,0)
101
"BLD",501,"KRN",409.61,0)
409.61
"BLD",501,"KRN",771,0)
771
"BLD",501,"KRN",870,0)
870
"BLD",501,"KRN",8989.51,0)
8989.51
"BLD",501,"KRN",8989.52,0)
8989.52
"BLD",501,"KRN",8994,0)
8994
"BLD",501,"KRN","B",.4,.4)

"BLD",501,"KRN","B",.401,.401)

"BLD",501,"KRN","B",.402,.402)

"BLD",501,"KRN","B",.403,.403)

"BLD",501,"KRN","B",.5,.5)

"BLD",501,"KRN","B",.84,.84)

"BLD",501,"KRN","B",3.6,3.6)

"BLD",501,"KRN","B",3.8,3.8)

"BLD",501,"KRN","B",9.2,9.2)

"BLD",501,"KRN","B",9.8,9.8)

"BLD",501,"KRN","B",19,19)

"BLD",501,"KRN","B",19.1,19.1)

"BLD",501,"KRN","B",101,101)

"BLD",501,"KRN","B",409.61,409.61)

"BLD",501,"KRN","B",771,771)

"BLD",501,"KRN","B",870,870)

"BLD",501,"KRN","B",8989.51,8989.51)

"BLD",501,"KRN","B",8989.52,8989.52)

"BLD",501,"KRN","B",8994,8994)

"BLD",501,"QUES",0)
^9.62^^
"BLD",501,"REQB",0)
^9.611^2^2
"BLD",501,"REQB",1,0)
DI*22.0*76^2
"BLD",501,"REQB",2,0)
DI*22.0*104^2
"BLD",501,"REQB","B","DI*22.0*104",2)

"BLD",501,"REQB","B","DI*22.0*76",1)

"INIT")
DIPR129
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
VA FILEMAN^DI^FM INIT
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
22.0^2990330^3030110^41
"PKG",5,22,1,"PAH",1,0)
129^3031125
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3031125
"PKG",5,22,1,"PAH",1,1,1,0)
See patch DI*22*129 in the National Patch Module on FORUM for complete
"PKG",5,22,1,"PAH",1,1,2,0)
information on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DIAU")
0^2^B19507595
"RTN","DIAU",1,0)
DIAU ;SFISC/XAK-AUDIT OPTIONS ;24JUNE2003
"RTN","DIAU",2,0)
 ;;22.0;VA FileMan;**76,129**;Mar 30, 1999
"RTN","DIAU",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIAU",4,0)
0 S DIC="^DOPT(""DIAU"","
"RTN","DIAU",5,0)
 G OPT:$D(^DOPT("DIAU",5)) S ^(0)="AUDIT OPTION^1.01" K ^("B")
"RTN","DIAU",6,0)
 F X=1:1:5 S ^DOPT("DIAU",X,0)=$P($T(@X),";;",2)
"RTN","DIAU",7,0)
 S DIK=DIC D IXALL^DIK
"RTN","DIAU",8,0)
OPT ;
"RTN","DIAU",9,0)
 S DIC(0)="AEQIZ" D ^DIC G Q:Y<0 S DI=+Y D EN G 0
"RTN","DIAU",10,0)
EN ;
"RTN","DIAU",11,0)
 D @DI W !!
"RTN","DIAU",12,0)
Q K %,DIC,DIK,DI,DA,I,J,X,Y Q
"RTN","DIAU",13,0)
 ;
"RTN","DIAU",14,0)
1 ;;FIELDS BEING AUDITED
"RTN","DIAU",15,0)
 D L^DICRW1 Q:'$D(DIC)  S (DUB,DIB,DFF)=+Y,BY(0)="^DD(DFF,""AUDIT"",",L(0)=1
"RTN","DIAU",16,0)
 S DIB(1)=$O(^DD($O(^DIC(DIB(1)))),-1) S:'DIB(1) DIB(1)=DIB
"RTN","DIAU",17,0)
 I $O(^DD(DIB,"AUDIT",""))="" F  S DIB=$O(^DD(+DIB)) Q:'DIB!(DIB>DIB(1))  I $O(^DD(DIB,"AUDIT",""))]"" S (DUB,DFF)=DIB Q
"RTN","DIAU",18,0)
 I 'DIB!(DIB>DIB(1)) G Q2
"RTN","DIAU",19,0)
 S FLDS="W DFF;C1;L9;""FILE"",.001;L9,.01;L20,.25;L15,1.1",DISUPNO=1
"RTN","DIAU",20,0)
 S L=0,DHD="AUDITED FIELDS",DIS(0)="I $D(^DD(DFF,D0,""AUDIT"")),""n""'[^(""AUDIT"")"
"RTN","DIAU",21,0)
 S DIA=1,DIC="^DD(DFF,",DIOEND="G L^DIDC" D EN1^DIP
"RTN","DIAU",22,0)
 G Q2
"RTN","DIAU",23,0)
 ;
"RTN","DIAU",24,0)
2 ;;DATA DICTIONARIES BEING AUDITED
"RTN","DIAU",25,0)
 S DIC=1,BY=.001,FLDS=".001;L14;""FILE"",.01",L=0
"RTN","DIAU",26,0)
 S DIS(0)="I $D(^DD(D0,0,""DDA"")),^(""DDA"")[""Y"""
"RTN","DIAU",27,0)
 S DHD="DATA DICTIONARIES BEING AUDITED" D EN1^DIP
"RTN","DIAU",28,0)
Q2 K DIA,A,B,DIJ,DP,P,BY,FLDS,DIS,DHD,DCC,L,DNP,DFF,DIB,DIJS,DIPQ,DIMS,DIPP,DUB,DIOEND Q
"RTN","DIAU",29,0)
 ;
"RTN","DIAU",30,0)
3 ;;PURGE DATA AUDITS
"RTN","DIAU",31,0)
 S DIC("S")="I $D(^DIA(+Y)),'$D(^DD(+Y,0,""AUDPURGEFORBID"")) S DIAC=""AUDIT"",DIFILE=+Y D ^DIAC I DIAC"
"RTN","DIAU",32,0)
 S DIA="" D AU^DICRW K DIC("S") G Q2:$D(DTOUT),Q2:Y<0,Q2:'$D(DIC)
"RTN","DIAU",33,0)
 S DDA="DATA" D ALL G Q2:$D(DIRUT)
"RTN","DIAU",34,0)
 I Y W !!,"..." K ^DIA(DIA) H 3 W "DELETED" G Q2
"RTN","DIAU",35,0)
 W ! S L="PURGE AUDIT RECORDS",DIOEND="D ENDKILL^DIAU",DISTOP=0
"RTN","DIAU",36,0)
 S FLDS="",DHD="PURGE OF AUDIT DATA: "_$O(^DD(DIA,0,"NM",0))_" FILE",DISUPNO=1
"RTN","DIAU",37,0)
 S DHIT="D KILLDIA^DIAU",DIACNT=0
"RTN","DIAU",38,0)
 D EN1^DIP K DISTOP,DHIT,DIK,DA,DIACNT G Q2
"RTN","DIAU",39,0)
 ;
"RTN","DIAU",40,0)
KILLDIA ;CALLED FROM DHIT
"RTN","DIAU",41,0)
 S X=$G(^DIA(DIA,D0,0)) K ^DIA(DIA,D0)
"RTN","DIAU",42,0)
 S Y=$P(X,U) I Y K ^DIA(DIA,"B",Y,D0)
"RTN","DIAU",43,0)
 S Y=$P(X,U,2) I Y K ^DIA(DIA,"C",Y,D0)
"RTN","DIAU",44,0)
 S Y=$P(X,U,4) K ^DIA(DIA,"D",+Y,D0)
"RTN","DIAU",45,0)
 S DIACNT=DIACNT+1 Q
"RTN","DIAU",46,0)
 ;
"RTN","DIAU",47,0)
ENDKILL ;CHECK DANGLERS
"RTN","DIAU",48,0)
 S $P(^(0),U,4)=$P($G(^DIA(DIA,0)),U,4)-DIACNT
"RTN","DIAU",49,0)
 W !!,"...",! W $$DANGLE(DIA)," POINTERS FIXED."
"RTN","DIAU",50,0)
 W !!,DIACNT," RECORDS PURGED."
"RTN","DIAU",51,0)
 Q
"RTN","DIAU",52,0)
 ;
"RTN","DIAU",53,0)
DANGLE(DIA) ;CLEAN DANGLERS
"RTN","DIAU",54,0)
 N A,B,D0,AA,C
"RTN","DIAU",55,0)
 S C=0
"RTN","DIAU",56,0)
 F AA=1,2,4 S A=$E("BC D",AA),B="" D
"RTN","DIAU",57,0)
 .F  S B=$O(^DIA(DIA,A,B)) Q:B=""  D
"RTN","DIAU",58,0)
 ..F D0=0:0 S D0=$O(^DIA(DIA,A,B,D0)) Q:'D0  I $P($G(^DIA(DIA,D0,0)),U,AA)'=B K ^DIA(DIA,A,B,D0) S C=C+1
"RTN","DIAU",59,0)
 Q C
"RTN","DIAU",60,0)
 ;
"RTN","DIAU",61,0)
4 ;;PURGE DD AUDITS
"RTN","DIAU",62,0)
 S DIC("S")="I '$D(^DD(+Y,0,""DDAUDPURGEFORBID"")) S DIAC=""AUDIT"",DIFILE=+Y D ^DIAC I DIAC"
"RTN","DIAU",63,0)
 S DIA="DDA",DDA="DD" D A^DICRW G Q:$D(DTOUT)!(Y<0)!'$D(DIC)
"RTN","DIAU",64,0)
 D ALL G:$D(DIRUT) Q I Y S X=DIA D PR G Q
"RTN","DIAU",65,0)
 W ! S L="PURGE DD AUDIT RECORDS",DIOEND="G M^DIAU",DISTOP=0,DISUPNO=1
"RTN","DIAU",66,0)
 S FLDS="",DHD="PURGE OF DD AUDIT: "_$O(^DD(DIA,0,"NM",0))_" FILE"
"RTN","DIAU",67,0)
 S DHIT="S DIK=DCC,DA=D0,DIACNT=DIACNT+1 D ^DIK",DIACNT=0,DIC="^DDA(DDA,"
"RTN","DIAU",68,0)
 S DDA=DIA D EN1^DIP K DISTOP,DHIT,DIK,DA,DIACNT G Q2
"RTN","DIAU",69,0)
 ;
"RTN","DIAU",70,0)
5 ;;TURN DATA AUDIT ON/OFF
"RTN","DIAU",71,0)
 N J,DUOUT,DIRUT,DA,DDA,DIAU,DIA,C,D,%,DIC,X,Y,DIR
"RTN","DIAU",72,0)
 S (DDA,DIA)=0 D AU^DICRW I 'DIA Q
"RTN","DIAU",73,0)
51 S DIC="^DD("_DIA_",",DIC(0)="QEANIZ",DA(1)=DIA
"RTN","DIAU",74,0)
 S DIC("S")="I 1 S %=$P(^(0),U,2) Q:'%&($E(%)'=""C"")  I $E(%)'=""C"",$P(^DD(+%,.01,0),U,2)'[""W"""
"RTN","DIAU",75,0)
52 S DIC("W")="W:$P(^(0),U,2) ""  (multiple)"" W ""   "",$G(^(""AUDIT""))"
"RTN","DIAU",76,0)
 D ^DIC I Y<0 K DIA G Q
"RTN","DIAU",77,0)
 I $P(Y(0),U,2) S DA(1)=+$P(Y(0),U,2),DIC="^DD("_DA(1)_"," G 52
"RTN","DIAU",78,0)
 K DIC,DIR S DDA=+Y S:$D(^("AUDIT")) DIR("B")=^("AUDIT")
"RTN","DIAU",79,0)
 S DIR(0)="0,1.1" D ^DIR I $D(DIRUT) Q:X'="@"  S Y="n"
"RTN","DIAU",80,0)
 D TURNON^DIAUTL(DA(1),DDA,Y) I $D(DIRUT) K ^DD(DA(1),DDA,"AUDIT")
"RTN","DIAU",81,0)
 W !! G 51
"RTN","DIAU",82,0)
 ;
"RTN","DIAU",83,0)
ALL S DIR(0)="Y",DIR("B")="NO"
"RTN","DIAU",84,0)
 S DIR("A")="DO YOU WANT TO PURGE ALL "_DDA_" AUDIT RECORDS"
"RTN","DIAU",85,0)
 S DIR("??")="^W !!?5,""Answer 'YES' to purge all the "_DDA_" audit records for this file, or"",!?5,""answer 'NO' to sort out the records to be purged."""
"RTN","DIAU",86,0)
 D ^DIR Q:$D(DIRUT)  I Y S DIR("A")="ARE YOU SURE" D ^DIR
"RTN","DIAU",87,0)
 K DIR Q
"RTN","DIAU",88,0)
 ;
"RTN","DIAU",89,0)
PR ;
"RTN","DIAU",90,0)
 N DIA S DIA=X N X K ^DDA(DIA)
"RTN","DIAU",91,0)
 F X=0:0 S X=$O(^DD(DIA,"SB",X)) Q:X'>0  D PR
"RTN","DIAU",92,0)
 Q
"RTN","DIAU",93,0)
M S DDA=$O(^DDA(DDA))
"RTN","DIAU",94,0)
 I DDA'>0!(DDA-1>DIA) W !!,DIACNT," RECORDS PURGED." G QM
"RTN","DIAU",95,0)
 S %=0,X=DDA D UP G P:%,M:'%
"RTN","DIAU",96,0)
UP Q:'$D(^DD(X,0,"UP"))  S X=^("UP") I X=DIA S %=1 Q
"RTN","DIAU",97,0)
 G UP
"RTN","DIAU",98,0)
P K ^UTILITY($J,0) S %X="DIPP(",%Y="DPP(" D %XY^%RCR
"RTN","DIAU",99,0)
 S DPP=DIPP,L=0,DJ=DIJS,DPQ=DIPQ,M=DIMS,C=",",DIOSL=IOSL G ^DIO
"RTN","DIAU",100,0)
 Q
"RTN","DIAU",101,0)
QM ;RETURN TO ^DIO4 FROM LINE TAG M
"RTN","DIAU",102,0)
 G STOP^DIO4
"RTN","DIET")
0^1^B6605913
"RTN","DIET",1,0)
DIET ;SFISC/XAK-DISPLAY INPUT TEMPLATE    ALSO DOES AUDITING! ;25JULY2003
"RTN","DIET",2,0)
 ;;22.0;VA FileMan;**69,49,104,129**;Mar 30, 1999
"RTN","DIET",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIET",4,0)
 N DICMX
"RTN","DIET",5,0)
 I '$D(^DIE(D0,0)) G EXIT
"RTN","DIET",6,0)
 S DICMX="W X,!"
"RTN","DIET",7,0)
EN ;
"RTN","DIET",8,0)
 N DI,DIET,DIETS,D
"RTN","DIET",9,0)
 S DIET=D0 D GET^DIETED("DIETS")
"RTN","DIET",10,0)
 F D=0:0 S D=$O(DIETS(D)) Q:'D  S X=DIETS(D) X DICMX Q:'$D(D)
"RTN","DIET",11,0)
EXIT S X="" Q
"RTN","DIET",12,0)
 ;
"RTN","DIET",13,0)
 ;
"RTN","DIET",14,0)
 ;
"RTN","DIET",15,0)
AUD N DP,DG,DPS,DIEX,DIIX,DIANUM ; DI*22*49
"RTN","DIET",16,0)
 S DIIX="3^.01^A",DP=+DO(2) D AUDIT:DP>0 Q
"RTN","DIET",17,0)
AUDIT ;
"RTN","DIET",18,0)
 N C,DIEDA,DIEF,%T,%F,%D,%,Y
"RTN","DIET",19,0)
 I $D(^DD(DP,+$P(DIIX,U,2),"AX")) X ^("AX") Q:'$T
"RTN","DIET",20,0)
 K % S DIEX=X D @+DIIX
"RTN","DIET",21,0)
 K DIIX,DPS,DIEX
"RTN","DIET",22,0)
 Q
"RTN","DIET",23,0)
3 ;
"RTN","DIET",24,0)
 I $D(DG),$D(DIANUM($P(DIIX,U,2))) S Y=X,(DIEX(1),C)=$P(^DD(DP,+$P(DIIX,U,2),0),U,2) D Y^DIQ S @DIANUM($P(DIIX,U,2))=Y K DIANUM($P(DIIX,U,2)) G I
"RTN","DIET",25,0)
2 ;
"RTN","DIET",26,0)
 S:$D(DP(1)) DPS=DP(1) S DIEDA="",DIEF="",%=1,DP(1)=DP,%F=+DP,X=DA
"RTN","DIET",27,0)
 F C=1:1 Q:'$D(^DD(DP(1),0,"UP"))  S %F=^("UP"),%=$O(^DD(%F,"SB",DP(1),0)) S:%="" %=-1 S DIEDA=DA(C)_","_DIEDA,DIEF=%_","_DIEF,DP(1)=%F
"RTN","DIET",28,0)
 D ADD I $D(DG),+DIIX=2 S DIANUM($P(DIIX,U,2))="^DIA("_%F_","_+Y_",3)"
"RTN","DIET",29,0)
 S (DIEX(1),C)=$P(^DD(DP,+$P(DIIX,U,2),0),U,2),Y=DIEX D Y^DIQ
"RTN","DIET",30,0)
 S ^DIA(%F,"B",DIEDA_DA,%D)="",X=DIEX S:$D(DPS) DP(1)=DPS
"RTN","DIET",31,0)
 S ^DIA(%F,%D,0)=DIEDA_DA_U_%T_U_DIEF_+$P(DIIX,U,2)_U_DUZ_U_$P(DIIX,U,3),^(+DIIX)=Y
"RTN","DIET",32,0)
I I (DIEX(1)["D")!(DIEX(1)["P")!(DIEX(1)["V")!(DIEX(1)["S") S ^(DIIX+.1)=X_U_DIEX(1)
"RTN","DIET",33,0)
 Q
"RTN","DIET",34,0)
 ;
"RTN","DIET",35,0)
ACCESSED(%F,REF) ;WILL FLAG ENTRY 'REF' IN FILE '%F' AS BEING ACCESSED BY CURRENT USER, CURRENT TIME, CURRENT OPTION
"RTN","DIET",36,0)
 N Y,X,%T,%D
"RTN","DIET",37,0)
 D:'$G(DT) DT^DICRW
"RTN","DIET",38,0)
 Q:'%F!'REF  S %F=+%F,(REF,X)=+REF Q:'$D(^DIC(%F))
"RTN","DIET",39,0)
 D ADD ;COMES BACK WITH %T AND Y--THE AUDIT REF
"RTN","DIET",40,0)
 S ^DIA(%F,Y,0)=REF_U_%T_U_.01_U_DUZ_U_U_"i"
"RTN","DIET",41,0)
 S ^DIA(%F,"B",REF,Y)=""
"RTN","DIET",42,0)
 Q
"RTN","DIET",43,0)
 ;
"RTN","DIET",44,0)
ADD S Y=$O(^DIA(%F,"A"),-1) I 'Y S ^DIA(%F,0)=$P(^DIC(%F,0),U)_" AUDIT^1.1I"
"RTN","DIET",45,0)
 F Y=Y+1:1 I '$D(^(Y)) L +^DIA(%F,Y):0 I  Q:'$D(^(Y))  L -^DIA(%F,Y)
"RTN","DIET",46,0)
 S ^(Y,0)=X L -^DIA(%F,Y)
"RTN","DIET",47,0)
 S %T=$G(XQY),%D=$S($D(XQORNOD)#2:XQORNOD,$D(HLORNOD)#2:HLORNOD,1:"") I %T!%D S ^DIA(%F,Y,4.1)=%T_U_%D
"RTN","DIET",48,0)
 S $P(^(0),U,3,4)=Y_U_($P(^DIA(%F,0),U,4)+1)
"RTN","DIET",49,0)
TIME S %D=Y,%T=$$HTFM^DILIBF($H)
"RTN","DIET",50,0)
 S ^DIA(%F,"C",%T,Y)="",^DIA(%F,"D",DUZ,Y)=""
"RTN","DIET",51,0)
 Q
"RTN","DIPR129")
0^^B2419462
"RTN","DIPR129",1,0)
DIPR129 ;OOIFO/SO- REMOVE DANGLING AUDIT XREFS ;8:09 AM  24 Nov 2003
"RTN","DIPR129",2,0)
 ;;22.0;VA FileMan;**129**;Mar 30, 1999
"RTN","DIPR129",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIPR129",4,0)
 I $$TM^%ZTLOAD,$G(XPDNM)]"" D  Q
"RTN","DIPR129",5,0)
 . N ZTSAVE,ZTRTN,ZTDTH,ZTDESC,ZTIO
"RTN","DIPR129",6,0)
 . S ZTSAVE("XPD*")="",ZTRTN="DEQUE^DIPR129",ZTDTH=$H,ZTIO=""
"RTN","DIPR129",7,0)
 . S ZTDESC="DI*22*129 Post Installation"
"RTN","DIPR129",8,0)
 . D ^%ZTLOAD
"RTN","DIPR129",9,0)
 . D MES^XPDUTL("Post Install Task Number is: "_$G(ZTSK))
"RTN","DIPR129",10,0)
DEQUE ;
"RTN","DIPR129",11,0)
 N ZZ
"RTN","DIPR129",12,0)
 D MES^XPDUTL(" ")
"RTN","DIPR129",13,0)
 I $G(ZTSK)]"" D MES^XPDUTL("Queued Post Install Dialog, Task#: "_$G(ZTSK))
"RTN","DIPR129",14,0)
 D TIME
"RTN","DIPR129",15,0)
 D MES^XPDUTL("Began checking Audit cross reference: "_ZZ_"...")
"RTN","DIPR129",16,0)
 N FILE
"RTN","DIPR129",17,0)
 S FILE=1.99999 ;Begin after Fileman Files
"RTN","DIPR129",18,0)
 F  S FILE=$O(^DIC(FILE)) Q:'FILE  D
"RTN","DIPR129",19,0)
 . I '$D(^DIA(FILE)) Q
"RTN","DIPR129",20,0)
 . N I
"RTN","DIPR129",21,0)
 . S I=$$DANGLE^DIAU(FILE)
"RTN","DIPR129",22,0)
 . I I D MES^XPDUTL("File: "_FILE_" had a total of:"_I_" dangling cross references removed.")
"RTN","DIPR129",23,0)
 . Q
"RTN","DIPR129",24,0)
 D TIME
"RTN","DIPR129",25,0)
 D MES^XPDUTL("Finished checking Audit cross references: "_ZZ_".")
"RTN","DIPR129",26,0)
 Q
"RTN","DIPR129",27,0)
 ;
"RTN","DIPR129",28,0)
TIME ; GET CURRENT DATE/TIME
"RTN","DIPR129",29,0)
 N %,%H,%I,Y
"RTN","DIPR129",30,0)
 D NOW^%DTC
"RTN","DIPR129",31,0)
 S Y=%
"RTN","DIPR129",32,0)
 D DD^%DT
"RTN","DIPR129",33,0)
 S ZZ=Y
"RTN","DIPR129",34,0)
 Q
"VER")
8^22.0
**END**
**END**
