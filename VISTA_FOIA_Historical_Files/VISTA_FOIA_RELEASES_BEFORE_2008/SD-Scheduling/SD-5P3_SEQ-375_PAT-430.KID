Released SD*5.3*430 SEQ #375
Extracted from mail message
**KIDS**:SD*5.3*430^

**INSTALL NAME**
SD*5.3*430
"BLD",5808,0)
SD*5.3*430^SCHEDULING^0^3060113^y
"BLD",5808,4,0)
^9.64PA^409.55^1
"BLD",5808,4,409.55,0)
409.55
"BLD",5808,4,409.55,222)
y^y^f^^^^n
"BLD",5808,4,"B",409.55,409.55)

"BLD",5808,"KRN",0)
^9.67PA^8989.52^19
"BLD",5808,"KRN",.4,0)
.4
"BLD",5808,"KRN",.401,0)
.401
"BLD",5808,"KRN",.402,0)
.402
"BLD",5808,"KRN",.403,0)
.403
"BLD",5808,"KRN",.5,0)
.5
"BLD",5808,"KRN",.84,0)
.84
"BLD",5808,"KRN",3.6,0)
3.6
"BLD",5808,"KRN",3.6,"NM",0)
^9.68A^1^1
"BLD",5808,"KRN",3.6,"NM",1,0)
SD API ERROR NOTICE^^0
"BLD",5808,"KRN",3.6,"NM","B","SD API ERROR NOTICE",1)

"BLD",5808,"KRN",3.8,0)
3.8
"BLD",5808,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",5808,"KRN",3.8,"NM",1,0)
SD RSA API ERRORS^^0
"BLD",5808,"KRN",3.8,"NM","B","SD RSA API ERRORS",1)

"BLD",5808,"KRN",9.2,0)
9.2
"BLD",5808,"KRN",9.8,0)
9.8
"BLD",5808,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5808,"KRN",9.8,"NM",1,0)
SDPFSS^^0^B18894412
"BLD",5808,"KRN",9.8,"NM",2,0)
SDPFSS2^^0^B9459306
"BLD",5808,"KRN",9.8,"NM",3,0)
SDVSIT0^^0^B10655905
"BLD",5808,"KRN",9.8,"NM",4,0)
SD53430P^^0^B59881265
"BLD",5808,"KRN",9.8,"NM","B","SD53430P",4)

"BLD",5808,"KRN",9.8,"NM","B","SDPFSS",1)

"BLD",5808,"KRN",9.8,"NM","B","SDPFSS2",2)

"BLD",5808,"KRN",9.8,"NM","B","SDVSIT0",3)

"BLD",5808,"KRN",19,0)
19
"BLD",5808,"KRN",19.1,0)
19.1
"BLD",5808,"KRN",101,0)
101
"BLD",5808,"KRN",101,"NM",0)
^9.68A^3^3
"BLD",5808,"KRN",101,"NM",1,0)
SDAM DELETE CHECK OUT^^0
"BLD",5808,"KRN",101,"NM",2,0)
SDAM APPOINTMENT EVENTS^^2
"BLD",5808,"KRN",101,"NM",3,0)
SDAM PFSS EVENT^^0
"BLD",5808,"KRN",101,"NM","B","SDAM APPOINTMENT EVENTS",2)

"BLD",5808,"KRN",101,"NM","B","SDAM DELETE CHECK OUT",1)

"BLD",5808,"KRN",101,"NM","B","SDAM PFSS EVENT",3)

"BLD",5808,"KRN",409.61,0)
409.61
"BLD",5808,"KRN",771,0)
771
"BLD",5808,"KRN",870,0)
870
"BLD",5808,"KRN",8989.51,0)
8989.51
"BLD",5808,"KRN",8989.52,0)
8989.52
"BLD",5808,"KRN",8994,0)
8994
"BLD",5808,"KRN","B",.4,.4)

"BLD",5808,"KRN","B",.401,.401)

"BLD",5808,"KRN","B",.402,.402)

"BLD",5808,"KRN","B",.403,.403)

"BLD",5808,"KRN","B",.5,.5)

"BLD",5808,"KRN","B",.84,.84)

"BLD",5808,"KRN","B",3.6,3.6)

"BLD",5808,"KRN","B",3.8,3.8)

"BLD",5808,"KRN","B",9.2,9.2)

"BLD",5808,"KRN","B",9.8,9.8)

"BLD",5808,"KRN","B",19,19)

"BLD",5808,"KRN","B",19.1,19.1)

"BLD",5808,"KRN","B",101,101)

"BLD",5808,"KRN","B",409.61,409.61)

"BLD",5808,"KRN","B",771,771)

"BLD",5808,"KRN","B",870,870)

"BLD",5808,"KRN","B",8989.51,8989.51)

"BLD",5808,"KRN","B",8989.52,8989.52)

"BLD",5808,"KRN","B",8994,8994)

"BLD",5808,"QUES",0)
^9.62^^
"BLD",5808,"REQB",0)
^9.611^1^1
"BLD",5808,"REQB",1,0)
SD*5.3*257^1
"BLD",5808,"REQB","B","SD*5.3*257",1)

"FIA",409.55)
APPOINTMENT PFSS ACCOUNT REFERENCE
"FIA",409.55,0)
^SD(409.55,
"FIA",409.55,0,0)
409.55D
"FIA",409.55,0,1)
y^y^f^^^^n
"FIA",409.55,0,10)

"FIA",409.55,0,11)

"FIA",409.55,0,"RLRO")

"FIA",409.55,0,"VR")
5.3^SD
"FIA",409.55,409.55)
0
"IX",409.55,409.55,"D",0)
409.55^D^Uniqueness Index for Key 'A' of File #409.55^R^^R^IR^I^409.55^^^^^LS
"IX",409.55,409.55,"D",1)
S ^SD(409.55,"D",X(1),X(2),X(3),DA)=""
"IX",409.55,409.55,"D",2)
K ^SD(409.55,"D",X(1),X(2),X(3),DA)
"IX",409.55,409.55,"D",2.5)
K ^SD(409.55,"D")
"IX",409.55,409.55,"D",11.1,0)
^.114IA^3^3
"IX",409.55,409.55,"D",11.1,1,0)
1^F^409.55^.01^^1
"IX",409.55,409.55,"D",11.1,2,0)
2^F^409.55^.02^^2
"IX",409.55,409.55,"D",11.1,3,0)
3^F^409.55^.03^^3
"KEY",409.55,409.55,"A",0)
409.55^A^P^514
"KEY",409.55,409.55,"A",2,0)
^.312IA^3^3
"KEY",409.55,409.55,"A",2,1,0)
.01^409.55^1
"KEY",409.55,409.55,"A",2,2,0)
.02^409.55^2
"KEY",409.55,409.55,"A",2,3,0)
.03^409.55^3
"KEYPTR",409.55,409.55,"A")
409.55^D
"KRN",3.6,275,-1)
0^1
"KRN",3.6,275,0)
SD API ERROR NOTICE^SCHEDULING PFSS NOTICE
"KRN",3.6,275,1,0)
^^10^10^3050513^
"KRN",3.6,275,1,1,0)
The following error condition was reported:
"KRN",3.6,275,1,2,0)
 
"KRN",3.6,275,1,3,0)
Patient Name    : |1|
"KRN",3.6,275,1,4,0)
Clinic          : |3|
"KRN",3.6,275,1,5,0)
Appt. Date/Time : |2|
"KRN",3.6,275,1,6,0)
 
"KRN",3.6,275,1,7,0)
Message Type: |4|
"KRN",3.6,275,1,8,0)
 
"KRN",3.6,275,1,9,0)
Error:
"KRN",3.6,275,1,10,0)
|5|
"KRN",3.6,275,3,0)
^3.63^2^2^3050513^^^
"KRN",3.6,275,3,1,0)
This bulletin is for posting error conditions that occur during the 
"KRN",3.6,275,3,2,0)
Scheduling API or PFSS Event Driver processes.
"KRN",3.6,275,4,0)
^3.64A^5^5
"KRN",3.6,275,4,1,0)
1
"KRN",3.6,275,4,1,1,0)
^^1^1^3050513^
"KRN",3.6,275,4,1,1,1,0)
Patient Name
"KRN",3.6,275,4,2,0)
2
"KRN",3.6,275,4,2,1,0)
^^1^1^3050513^
"KRN",3.6,275,4,2,1,1,0)
Appointment Date Time
"KRN",3.6,275,4,3,0)
3
"KRN",3.6,275,4,3,1,0)
^^1^1^3050513^
"KRN",3.6,275,4,3,1,1,0)
Clinic Name
"KRN",3.6,275,4,4,0)
4
"KRN",3.6,275,4,4,1,0)
^^1^1^3050513^
"KRN",3.6,275,4,4,1,1,0)
HL7 Message Type
"KRN",3.6,275,4,5,0)
5
"KRN",3.6,275,4,5,1,0)
^3.65^1^1^3050513^^
"KRN",3.6,275,4,5,1,1,0)
Error Message
"KRN",3.8,364,-1)
0^1
"KRN",3.8,364,0)
SD RSA API ERRORS^PU^y^^^^
"KRN",3.8,364,2,0)
^3.801^2^2^3050513^^
"KRN",3.8,364,2,1,0)
This mail group will receive any error notifications or conditions from 
"KRN",3.8,364,2,2,0)
the PFSS Event Driver and Scheduling RSA API calls.
"KRN",3.8,364,3)

"KRN",101,414,-1)
2^2
"KRN",101,414,0)
SDAM APPOINTMENT EVENTS^Appointment Event Driver^^X^2438^^^^^^^16
"KRN",101,414,10,0)
^101.01PA^19^18
"KRN",101,414,10,19,0)
7972^^99^
"KRN",101,414,10,19,"^")
SDAM PFSS EVENT
"KRN",101,782,-1)
0^1
"KRN",101,782,0)
SDAM DELETE CHECK OUT^Delete Check Out^^A^^^^^^^^SCHEDULING
"KRN",101,782,1,0)
^101.06^1^1^3050509^^
"KRN",101,782,1,1,0)
This action permits the user to delete a check out.
"KRN",101,782,15)
K SDPFSFLG
"KRN",101,782,20)
S SDPFSFLG=1 D DEL^SDCOAM
"KRN",101,782,24)

"KRN",101,782,99)
60247,35944
"KRN",101,7972,-1)
0^3
"KRN",101,7972,0)
SDAM PFSS EVENT^PFSS Account Number Driver^^A^^^^^^^^SCHEDULING
"KRN",101,7972,1,0)
^^4^4^3050509^
"KRN",101,7972,1,1,0)
This protocol is called as an extended action on the SDAM APPOINTMENT
"KRN",101,7972,1,2,0)
EVENTS protocol.  It's calls the IBB GETACCT^IBBAPI to send or update 
"KRN",101,7972,1,3,0)
appointment data to the PFSS external system.  On new appointments, the 
"KRN",101,7972,1,4,0)
IBB API will return the account number reference for the appointment.
"KRN",101,7972,20)
D EVENT^SDPFSS
"KRN",101,7972,99)
60247,35956
"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
430^3060113
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SD53430P")
0^4^B59881265
"RTN","SD53430P",1,0)
SD53430P ;WOIFO/CLC - PFSS Scheduled Outpatient Conversion Backload ;22-APR-2005
"RTN","SD53430P",2,0)
 ;;5.3;Scheduling;**430**;Aug 13, 1993
"RTN","SD53430P",3,0)
 D HDR
"RTN","SD53430P",4,0)
 Q
"RTN","SD53430P",5,0)
 ;
"RTN","SD53430P",6,0)
PRECHK ;
"RTN","SD53430P",7,0)
 N VCNT
"RTN","SD53430P",8,0)
 D HDR W !!,"Pre-Backload Analysis - Outpatient future appointments."
"RTN","SD53430P",9,0)
 S VCNT=$$FUTRAPP(0)
"RTN","SD53430P",10,0)
 I VCNT<0 W !,"Analysis exited without processing..." Q
"RTN","SD53430P",11,0)
 W !!,VCNT," Outpatient future appointments identified in VistA..."
"RTN","SD53430P",12,0)
 W !!,"Analysis complete...."
"RTN","SD53430P",13,0)
 Q
"RTN","SD53430P",14,0)
FUTRAPP(CMP) ;
"RTN","SD53430P",15,0)
 N I,DFN,APP,STDT,DT,APPINFO
"RTN","SD53430P",16,0)
 S (DFN,APP)=0
"RTN","SD53430P",17,0)
 S STDT=$$GETRESP($$NOW^XLFDT(),"Future Appointment search start date") I STDT="" S APP=-1 G OFAQ
"RTN","SD53430P",18,0)
 W !,"Checking VistA future appointments ",STDT," forward..."
"RTN","SD53430P",19,0)
 F I=1:1 S DFN=$O(^DPT(DFN)) Q:+DFN<1  D
"RTN","SD53430P",20,0)
    .I I#10000=0 W "."
"RTN","SD53430P",21,0)
    .S DT=STDT
"RTN","SD53430P",22,0)
    .F  S DT=$O(^DPT(DFN,"S",DT)) Q:+DT<1  D
"RTN","SD53430P",23,0)
      ..S APPINFO=$G(^DPT(DFN,"S",DT,0))
"RTN","SD53430P",24,0)
      ..I APPINFO="" W !,"Invalid Patient Appointment Node:",DFN,"-",DT Q
"RTN","SD53430P",25,0)
      ..I $P(APPINFO,"^",2)="" D
"RTN","SD53430P",26,0)
         ...S APP=APP+1
"RTN","SD53430P",27,0)
         ...I CMP I $G(^TMP($J,"OFA",DFN))="" S EXC(DFN_"^"_DT)=^DPT(DFN,0)
"RTN","SD53430P",28,0)
OFAQ Q APP
"RTN","SD53430P",29,0)
POSTCHK ;
"RTN","SD53430P",30,0)
 N PATH,FILENM,LN,TMP,I,DFN,BLCNT,EXC,VCNT
"RTN","SD53430P",31,0)
 D HDR W !!,"Post-Backload Analysis - Outpatient future appointments."
"RTN","SD53430P",32,0)
 S FILENM="SDCONV_ACCT.TXT",BLCNT=0,PATH=$$PWD^%ZISH()
"RTN","SD53430P",33,0)
 S PATH=$$GETRESP(PATH,"Select Backload Path") Q:PATH=""
"RTN","SD53430P",34,0)
 I '$$LISTF(PATH) S FILENM=""
"RTN","SD53430P",35,0)
 S FILENM=$$GETRESP(FILENM,"Select Backload File") Q:FILENM=""
"RTN","SD53430P",36,0)
 ;
"RTN","SD53430P",37,0)
 K ^TMP($J,"OFA")
"RTN","SD53430P",38,0)
 D OPEN^%ZISH("SD",PATH,FILENM,"R")
"RTN","SD53430P",39,0)
 F  U IO R LN:1 Q:LN']""  S ^TMP($J,"OFA",$P(LN,"^"))=LN,BLCNT=BLCNT+1
"RTN","SD53430P",40,0)
 D CLOSE^%ZISH(IO)
"RTN","SD53430P",41,0)
 ;
"RTN","SD53430P",42,0)
 W !!,"File: ",FILENM," contains: ",BLCNT," records."
"RTN","SD53430P",43,0)
 S VCNT=$$FUTRAPP(1)
"RTN","SD53430P",44,0)
 W !!,VCNT," Outpatient future appointments identified in VistA..."
"RTN","SD53430P",45,0)
 ;
"RTN","SD53430P",46,0)
 W !,"   VistA Total:",$J(VCNT,10)
"RTN","SD53430P",47,0)
 W !,"Backload Total:",$J(BLCNT,10)
"RTN","SD53430P",48,0)
 W !,"=================================="
"RTN","SD53430P",49,0)
 W !,"               ",$J(VCNT-BLCNT,10)
"RTN","SD53430P",50,0)
 ;
"RTN","SD53430P",51,0)
 I '$D(EXC) W !,"No Discrepencies between VistA and the Backload file" Q
"RTN","SD53430P",52,0)
 W !!,"Missing patients from backload file:",!
"RTN","SD53430P",53,0)
 S DFN=0
"RTN","SD53430P",54,0)
 F I=1:1 S DFN=$O(EXC(DFN)) Q:DFN=""  W !,I,") ",DFN,"^",EXC(DFN)
"RTN","SD53430P",55,0)
 W !!,"Post analysis complete...."
"RTN","SD53430P",56,0)
 K ^TMP($J,"OFA")
"RTN","SD53430P",57,0)
 Q
"RTN","SD53430P",58,0)
EP1 ;
"RTN","SD53430P",59,0)
 N CNT,GOOD,ERR,SDKEY,ANS,PATH,Y,FN,GFILE,RFILE,FILENM
"RTN","SD53430P",60,0)
 S SDKEY="SDCONV_ACCT.TXT",FILENM=SDKEY
"RTN","SD53430P",61,0)
 S PATH=$$PWD^%ZISH(),(CNT,GOOD)=0
"RTN","SD53430P",62,0)
 D HDR
"RTN","SD53430P",63,0)
 S PATH=$$GETRESP(PATH,"Select Backload Path") Q:PATH=""
"RTN","SD53430P",64,0)
 ;
"RTN","SD53430P",65,0)
 I '$$LISTF(PATH) S FILENM=""
"RTN","SD53430P",66,0)
 S FILENM=$$GETRESP(FILENM,"Select Backload File") Q:FILENM=""
"RTN","SD53430P",67,0)
 S CNT=$$LOADFILE(PATH,FILENM)
"RTN","SD53430P",68,0)
 ;
"RTN","SD53430P",69,0)
 I CNT>0 S GOOD=$$PROCESS(CNT)
"RTN","SD53430P",70,0)
 D RPTERR(CNT,GOOD,PATH_FILENM)
"RTN","SD53430P",71,0)
 W !!,"Finished.... Mailman message sent to:",$$GET1^DIQ(200,DUZ,.01)," and G.PATCHES"
"RTN","SD53430P",72,0)
 Q
"RTN","SD53430P",73,0)
LISTF(PATH) ;
"RTN","SD53430P",74,0)
 N GFILE,Y,RFILE,FN
"RTN","SD53430P",75,0)
 S GFILE("SD*.TXT")=""
"RTN","SD53430P",76,0)
 S Y=$$LIST^%ZISH(PATH,"GFILE","RFILE")
"RTN","SD53430P",77,0)
 W !!,"SD*.TXT Files in ",PATH,!,"=================================="
"RTN","SD53430P",78,0)
 I Y=1 S FN="" F  S FN=$O(RFILE(FN))  Q:FN=""  W !,?10,FN
"RTN","SD53430P",79,0)
 I Y=0 W !!,?10,"** No files matching the SD*.TXT filter exists **"
"RTN","SD53430P",80,0)
 Q Y
"RTN","SD53430P",81,0)
HDR ;
"RTN","SD53430P",82,0)
 D HOME^%ZIS  W @IOF
"RTN","SD53430P",83,0)
 W !!,"==========================================================="
"RTN","SD53430P",84,0)
 W !,"Scheduled Outpatient Conversion Backload",!
"RTN","SD53430P",85,0)
 W !,"    **********************************************************"
"RTN","SD53430P",86,0)
 W !,"    * This Routine should ONLY be run by PFSS Implementation *"
"RTN","SD53430P",87,0)
 W !,"    * Staff.  DO NOT run this routine as part of the normal  *"
"RTN","SD53430P",88,0)
 W !,"    * Patch installation process.                            *"
"RTN","SD53430P",89,0)
 W !,"    **********************************************************"
"RTN","SD53430P",90,0)
 W !!,"==========================================================="
"RTN","SD53430P",91,0)
 Q
"RTN","SD53430P",92,0)
GETRESP(DEF,TXT) ;
"RTN","SD53430P",93,0)
 N DIR,DIRUT,DTOUT,X,Y
"RTN","SD53430P",94,0)
 S DIR(0)="Fr",DIR("A")=TXT,DIR("B")=DEF D ^DIR
"RTN","SD53430P",95,0)
 I $D(DIRUT)!$D(DTOUT) S Y=""
"RTN","SD53430P",96,0)
 Q Y
"RTN","SD53430P",97,0)
RPTERR(CNT,GOOD,FULLPATH) ;
"RTN","SD53430P",98,0)
 N REC,CAT,ROW,ERR,ET,DETAIL
"RTN","SD53430P",99,0)
 N XMDF,XMDUZ,XMSUB,XMDUN,XMTEXT,XMSTRIP,XMROU,XMY,XMZ,XMMG
"RTN","SD53430P",100,0)
 S XMDF="",XMDUZ="SD53430P-"_$TR($P($$SITE^VASITE(),"^",2,3),"^","-")
"RTN","SD53430P",101,0)
 S XMY(DUZ)="",XMY("G.PATCHES")=""
"RTN","SD53430P",102,0)
 S XMSUB="PFSS Scheduled Outpatient Conversion"
"RTN","SD53430P",103,0)
 D XMZ^XMA2                                 ; Call Create Message Module
"RTN","SD53430P",104,0)
 I XMZ<1 D  Q
"RTN","SD53430P",105,0)
   .W !!,"** UNABLE TO CREATE MAILMAN MESSAGE PLEASE CHECK XTMP FOR DETAILS!"
"RTN","SD53430P",106,0)
 ;
"RTN","SD53430P",107,0)
 S ^XMB(3.9,XMZ,2,1,0)="Scheduled OutPatient Conversion Backload"
"RTN","SD53430P",108,0)
 S ^XMB(3.9,XMZ,2,2,0)="             File: "_FULLPATH
"RTN","SD53430P",109,0)
 S ^XMB(3.9,XMZ,2,3,0)="           Run By: "_$$GET1^DIQ(200,DUZ,.01)
"RTN","SD53430P",110,0)
 S ^XMB(3.9,XMZ,2,4,0)=""
"RTN","SD53430P",111,0)
 S ^XMB(3.9,XMZ,2,5,0)="Sucessful Records: "_GOOD
"RTN","SD53430P",112,0)
 S ^XMB(3.9,XMZ,2,7,0)="                 ----------------------"
"RTN","SD53430P",113,0)
 S ^XMB(3.9,XMZ,2,8,0)="  Total Processed: "_CNT
"RTN","SD53430P",114,0)
 S ^XMB(3.9,XMZ,2,9,0)="==============================================="
"RTN","SD53430P",115,0)
 ;
"RTN","SD53430P",116,0)
 S REC="",ROW=9,ERR=0
"RTN","SD53430P",117,0)
 F  S REC=$O(^XTMP(SDKEY,"ERR",REC)) Q:REC=""  D
"RTN","SD53430P",118,0)
   .S ERR=ERR+1,ROW=ROW+1
"RTN","SD53430P",119,0)
   .S ^XMB(3.9,XMZ,2,ROW,0)="Record: "_REC_"     ----------------------"
"RTN","SD53430P",120,0)
   .S CAT=""
"RTN","SD53430P",121,0)
   .F  S CAT=$O(^XTMP(SDKEY,"ERR",REC,CAT)) Q:CAT=""  D
"RTN","SD53430P",122,0)
      ..S ROW=ROW+1,^XMB(3.9,XMZ,2,ROW,0)="   "_CAT
"RTN","SD53430P",123,0)
      ..S ET=""
"RTN","SD53430P",124,0)
      ..F  S ET=$O(^XTMP(SDKEY,"ERR",REC,CAT,ET)) Q:ET=""  D
"RTN","SD53430P",125,0)
         ...S ROW=ROW+1
"RTN","SD53430P",126,0)
         ...S ^XMB(3.9,XMZ,2,ROW,0)="        "_^XTMP(SDKEY,"ERR",REC,CAT,ET)
"RTN","SD53430P",127,0)
 ;
"RTN","SD53430P",128,0)
 S ^XMB(3.9,XMZ,2,6,0)="    Error Records: "_ERR
"RTN","SD53430P",129,0)
 I ROW=9 S ROW=10,^XMB(3.9,XMZ,2,ROW,0)="Sucessful Backload..... No ERRORS found..."
"RTN","SD53430P",130,0)
 ;
"RTN","SD53430P",131,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92^"_ROW_"^"_ROW_"^"_$$NOW^XLFDT()
"RTN","SD53430P",132,0)
 D ENT1^XMD                                                 ;Deliver MSG
"RTN","SD53430P",133,0)
 K ^XTMP(SDKEY)
"RTN","SD53430P",134,0)
 Q
"RTN","SD53430P",135,0)
LOADFILE(PATH,FILENM) ;
"RTN","SD53430P",136,0)
 N POP,NOW,PURGDT,STOP,TOT,LN
"RTN","SD53430P",137,0)
 W !,"Loading backload file..."
"RTN","SD53430P",138,0)
 K ^XTMP(SDKEY)
"RTN","SD53430P",139,0)
 S NOW=$$NOW^XLFDT(),PURGDT=NOW+2,TOT=0             ;Purge 2 days later
"RTN","SD53430P",140,0)
 S ^XTMP(SDKEY,0)=PURGDT_"^"_NOW_"^PFSS Scheduled Outpatient Back Load"
"RTN","SD53430P",141,0)
 ;
"RTN","SD53430P",142,0)
 D OPEN^%ZISH("SD",PATH,FILENM,"R")
"RTN","SD53430P",143,0)
 I $G(POP) S ^XTMP(SDKEY,"ERR",0,"FATAL",1)="Could NOT PROCESS File!"
"RTN","SD53430P",144,0)
 ;
"RTN","SD53430P",145,0)
 S (STOP,TOT)=0
"RTN","SD53430P",146,0)
 F  U IO R LN:1 Q:LN']""  Q:$$STATUS^%ZISH  Q:STOP  D
"RTN","SD53430P",147,0)
    .I $G(LN)="" S STOP=1 Q
"RTN","SD53430P",148,0)
    .S TOT=TOT+1,^XTMP(SDKEY,"DAT",TOT)=LN I TOT#1000=0 U 0 W "."
"RTN","SD53430P",149,0)
 ;
"RTN","SD53430P",150,0)
 D CLOSE^%ZISH(IO)
"RTN","SD53430P",151,0)
LFQ Q TOT
"RTN","SD53430P",152,0)
 ;
"RTN","SD53430P",153,0)
PROCESS(TOT) ;
"RTN","SD53430P",154,0)
 N CNT,INFO,DFN,SDT,SDCLN,SDEXVN,SDANR,SDCHK,GOOD
"RTN","SD53430P",155,0)
 W !,"Processing data..."
"RTN","SD53430P",156,0)
 S GOOD=0
"RTN","SD53430P",157,0)
 F CNT=1:1:TOT D
"RTN","SD53430P",158,0)
    .I CNT#1000=0 W "."
"RTN","SD53430P",159,0)
    .S INFO=^XTMP(SDKEY,"DAT",CNT)
"RTN","SD53430P",160,0)
    .S DFN=$P(INFO,"^",1),SDT=$P(INFO,"^",18)
"RTN","SD53430P",161,0)
    .S SDCLN=$P(INFO,"^",8),SDEXVN=$TR($P(INFO,"^",21)," ","")
"RTN","SD53430P",162,0)
    .;
"RTN","SD53430P",163,0)
    .Q:$$CHKINFO(CNT,DFN,SDT,SDCLN,SDEXVN)
"RTN","SD53430P",164,0)
    .S SDANR=$$GETARN^SDPFSS2(SDT,DFN,SDCLN)
"RTN","SD53430P",165,0)
    .I +SDANR>0 D  Q
"RTN","SD53430P",166,0)
       ..I $$EXTNUM^IBBAPI(DFN,SDANR)'=SDEXVN D  Q
"RTN","SD53430P",167,0)
           ...S ^XTMP(SDKEY,"ERR",CNT,"ACCT",1)="Visit Number Discrepancy: "_INFO_" NOT EQUAL: "_SDANR
"RTN","SD53430P",168,0)
       ..S GOOD=GOOD+1
"RTN","SD53430P",169,0)
    .;
"RTN","SD53430P",170,0)
    .S SDANR=$$IBBACONV^IBBAADTI(DFN,"O",SDT,SDCLN,SDEXVN)
"RTN","SD53430P",171,0)
    .I SDANR="" S ^XTMP(SDKEY,"ERR",CNT,"ACCT",2)="PFSS Account Reference NOT Created" Q
"RTN","SD53430P",172,0)
    .;
"RTN","SD53430P",173,0)
    .S SDCHK=$$FILE^SDPFSS(DFN,SDT,SDCLN,SDANR)
"RTN","SD53430P",174,0)
    .I +SDCHK<0 D
"RTN","SD53430P",175,0)
       ..S ^XTMP(SDKEY,"ERR",CNT,"APPT LINK",1)="Unable to update file 409.55"
"RTN","SD53430P",176,0)
       ..S ^XTMP(SDKEY,"ERR",CNT,"APPT LINK",2)=SDCHK
"RTN","SD53430P",177,0)
    .I SDCHK="" S ^XTMP(SDKEY,"ERR",CNT,"APPT LINK",3)="Link Already Exists:"_INFO
"RTN","SD53430P",178,0)
    .I +SDCHK=1 S GOOD=GOOD+1
"RTN","SD53430P",179,0)
 Q GOOD
"RTN","SD53430P",180,0)
CHKINFO(CNT,DFN,SDT,SDCLN,SDEXVN) ;
"RTN","SD53430P",181,0)
 I SDEXVN="" S ^XTMP(SDKEY,"ERR",CNT,"IDX",1)="NO IDX Vist Number:"_INFO
"RTN","SD53430P",182,0)
 ;
"RTN","SD53430P",183,0)
 I +DFN=0 S ^XTMP(SDKEY,"ERR",CNT,"PATIENT",1)="DFN Invalid or Missing"
"RTN","SD53430P",184,0)
 I +DFN>0 D
"RTN","SD53430P",185,0)
   .I $G(^DPT(DFN,0))="" S ^XTMP(SDKEY,"ERR",CNT,"PATIENT",2)="Invalid Patient: "_DFN
"RTN","SD53430P",186,0)
 ;
"RTN","SD53430P",187,0)
 I +SDT=0 S ^XTMP(SDKEY,"ERR",CNT,"APPT DT/TIME",1)="Appointment Date/Time Invalid or Missing"
"RTN","SD53430P",188,0)
 ;
"RTN","SD53430P",189,0)
 I +SDCLN=0 S ^XTMP(SDKEY,"ERR",CNT,"LOCATION",1)="Location Invalid or Missing"
"RTN","SD53430P",190,0)
 I +SDCLN>0 D
"RTN","SD53430P",191,0)
   .I $G(^SC(SDCLN,0))="" S ^XTMP(SDKEY,"ERR",CNT,"LOCATION",2)="Invalid Location:"_SDCLN
"RTN","SD53430P",192,0)
 Q $D(^XTMP(SDKEY,"ERR",CNT))
"RTN","SD53430P",193,0)
 ;
"RTN","SDPFSS")
0^1^B18894412
"RTN","SDPFSS",1,0)
SDPFSS ;ALB/SCK - Patient Financial Services System  ;22-APR-2005
"RTN","SDPFSS",2,0)
 ;;5.3;Scheduling;**430**;Aug 13, 1993
"RTN","SDPFSS",3,0)
 ;
"RTN","SDPFSS",4,0)
 Q
"RTN","SDPFSS",5,0)
 ;
"RTN","SDPFSS",6,0)
EVENT ; Entry point for PFSS Protocol event.  This procedure will manage the IBB event actions.
"RTN","SDPFSS",7,0)
 ;
"RTN","SDPFSS",8,0)
 N SDEVENT,SDTEST,SDBEFORE,SDAFTER,SDMSG,SDARRAY,SDCNT,SDPRV,SDERR,SDERRMSG,SDNODE,SDOK
"RTN","SDPFSS",9,0)
 N IBBDFN,IBBAPLR,IBBEVENT,IBBPV1,IBBPV2,IBBARFN
"RTN","SDPFSS",10,0)
 ;
"RTN","SDPFSS",11,0)
 ; Check conditions before proceeding
"RTN","SDPFSS",12,0)
 Q:'$G(DFN)
"RTN","SDPFSS",13,0)
 Q:'$$CHECK
"RTN","SDPFSS",14,0)
 Q:$$TESTPAT^VADPT(DFN)
"RTN","SDPFSS",15,0)
 ;
"RTN","SDPFSS",16,0)
 ; Call the ICN API to generate an ICN if one does not exist for the patient.
"RTN","SDPFSS",17,0)
 S SDOK=$$ICNLC^MPIF001(DFN)
"RTN","SDPFSS",18,0)
 I SDOK<0 D
"RTN","SDPFSS",19,0)
 . D ERRMSG^SDPFSS2(SDOK)
"RTN","SDPFSS",20,0)
 ;
"RTN","SDPFSS",21,0)
 ; Get event type
"RTN","SDPFSS",22,0)
 S SDEVENT=$S($D(SDAMEVT):$$GET1^DIQ(409.66,SDAMEVT,.01),1:"OTHER")
"RTN","SDPFSS",23,0)
 I SDEVENT="CHECK-OUT",+$G(SDPFSFLG) S SDEVENT="DELETE CO"
"RTN","SDPFSS",24,0)
 ;
"RTN","SDPFSS",25,0)
 S SDBEFORE=$P($G(SDATA("BEFORE","STATUS")),U,3)
"RTN","SDPFSS",26,0)
 S SDAFTER=$P($G(SDATA("AFTER","STATUS")),U,3)
"RTN","SDPFSS",27,0)
 ;
"RTN","SDPFSS",28,0)
 I SDEVENT="CHECK-IN" D
"RTN","SDPFSS",29,0)
 . I SDBEFORE="ACT REQ/CHECKED IN"&(SDAFTER["NO ACTION TAKEN") S SDEVENT="DELETE CI"
"RTN","SDPFSS",30,0)
 ;
"RTN","SDPFSS",31,0)
 I SDEVENT="NO-SHOW" D
"RTN","SDPFSS",32,0)
 . I SDBEFORE="NO-SHOW"&(SDAFTER["NO ACTION TAKEN") S SDEVENT="DELETE NS"
"RTN","SDPFSS",33,0)
 ;
"RTN","SDPFSS",34,0)
 S IBBDFN=DFN
"RTN","SDPFSS",35,0)
 S IBBAPLR=""
"RTN","SDPFSS",36,0)
 S IBBEVENT=$$GETEVT^SDPFSS2(SDEVENT)
"RTN","SDPFSS",37,0)
 ;
"RTN","SDPFSS",38,0)
 ; Call the Scheduling Appointment Data API to retrieve appointment data
"RTN","SDPFSS",39,0)
 K ^TMP($J,"SDAMA301")
"RTN","SDPFSS",40,0)
 S SDARRAY(1)=$G(SDT)_";"_$G(SDT)
"RTN","SDPFSS",41,0)
 S SDARRAY(2)=$G(SDCL)
"RTN","SDPFSS",42,0)
 S SDARRAY(4)=$G(DFN)
"RTN","SDPFSS",43,0)
 S SDARRAY("FLDS")="1;2;3;8;9;10;11;13;14;15;16;17;18"
"RTN","SDPFSS",44,0)
 S SDCNT=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SDPFSS",45,0)
 ;
"RTN","SDPFSS",46,0)
 ; check for any errors in the TMP global
"RTN","SDPFSS",47,0)
 I SDCNT<0 D
"RTN","SDPFSS",48,0)
 . S SDERR=$O(^TMP($J,"SDAMA301",0))
"RTN","SDPFSS",49,0)
 . I SDERR D
"RTN","SDPFSS",50,0)
 . . S SDERRMSG=^TMP($J,"SDAMA301",SDERR)
"RTN","SDPFSS",51,0)
 . . S SDERR=SDERR_"^"_SDERRMSG
"RTN","SDPFSS",52,0)
 . E  D
"RTN","SDPFSS",53,0)
 . . S SDERR="-1^Undefined error returned by SDAPI"
"RTN","SDPFSS",54,0)
 . D ERRMSG^SDPFSS2(SDERR)
"RTN","SDPFSS",55,0)
 . ; Null out the data global for further processing
"RTN","SDPFSS",56,0)
 . S ^TMP($J,"SDAMA301",DFN,SDCL,SDT)=""
"RTN","SDPFSS",57,0)
 ;
"RTN","SDPFSS",58,0)
 I SDCNT=0 D
"RTN","SDPFSS",59,0)
 . S SDERR="-1^No appointments were returned by SDAPI"_"^"_DFN_"^"_SDT_"^"_SDCL
"RTN","SDPFSS",60,0)
 . D ERRMSG^SDPFSS2(SDERR)
"RTN","SDPFSS",61,0)
 ;
"RTN","SDPFSS",62,0)
 ; Build data arrays for PFSS Account API
"RTN","SDPFSS",63,0)
 S SDNODE=$G(^TMP($J,"SDAMA301",DFN,SDCL,SDT))
"RTN","SDPFSS",64,0)
 S IBBPV1(2)="O"
"RTN","SDPFSS",65,0)
 S IBBPV1(3)=SDCL
"RTN","SDPFSS",66,0)
 S IBBPV1(4)=+$P(SDNODE,U,10)
"RTN","SDPFSS",67,0)
 S IBBPV1(10)=+$P(SDNODE,U,18)
"RTN","SDPFSS",68,0)
 S IBBPV1(18)=$P($P(SDNODE,U,13),";",1)
"RTN","SDPFSS",69,0)
 S IBBPV1(51)=$P(SDNODE,U,15)
"RTN","SDPFSS",70,0)
 S IBBPV1(25)=$S(SDEVENT="DELETE CI":"",1:$P(SDNODE,U,9))
"RTN","SDPFSS",71,0)
 S IBBPV1(41)=$P($P(SDNODE,U,14),";",1)
"RTN","SDPFSS",72,0)
 I "A05,A38"[IBBEVENT
"RTN","SDPFSS",73,0)
 E  S IBBPV1(44)=SDT
"RTN","SDPFSS",74,0)
 ;
"RTN","SDPFSS",75,0)
 S IBBPV2(7)=$P($P(SDNODE,U,8),";",1)
"RTN","SDPFSS",76,0)
 I "A05,A38"[IBBEVENT S IBBPV2(8)=SDT
"RTN","SDPFSS",77,0)
 S IBBPV2(24)=$P($P(SDNODE,U,3),";",1)
"RTN","SDPFSS",78,0)
 S IBBPV2(46)=$P(SDNODE,U,16)
"RTN","SDPFSS",79,0)
 ;
"RTN","SDPFSS",80,0)
 I SDEVENT="CHECK-OUT" D
"RTN","SDPFSS",81,0)
 . S SDPRV=$$ENCPRV^SDPFSS2(DFN,$G(SDVSIT))
"RTN","SDPFSS",82,0)
 . S IBBPV1(45)=$P(SDNODE,U,11)
"RTN","SDPFSS",83,0)
 I +$G(SDPRV)'>0 S SDPRV=$$DEFPRV^SDPFSS2(SDCL)
"RTN","SDPFSS",84,0)
 ;
"RTN","SDPFSS",85,0)
 I SDEVENT="DELETE CO" S IBBPV1(45)="",SDPRV=""
"RTN","SDPFSS",86,0)
 S IBBPV1(7)=$P($G(SDPRV),U,1)
"RTN","SDPFSS",87,0)
 ;
"RTN","SDPFSS",88,0)
 S IBBARFN=$S(SDEVENT="MAKE":"",1:$$GETARN^SDPFSS2(SDT,DFN,SDCL))
"RTN","SDPFSS",89,0)
B1 ; Call the Get Account API and retrieve the account number reference
"RTN","SDPFSS",90,0)
 S SDANR=$$GETACCT^IBBAPI(IBBDFN,IBBARFN,IBBEVENT,IBBAPLR,.IBBPV1,.IBBPV2)
"RTN","SDPFSS",91,0)
 ;
"RTN","SDPFSS",92,0)
 ;  If this is a "Make" appt., then create a new entry in the Appointment Acct. No. Reference File
"RTN","SDPFSS",93,0)
 I SDEVENT="MAKE",+$G(SDANR)>0 D
"RTN","SDPFSS",94,0)
 . S SDOK=$$FILE(DFN,SDT,SDCL,SDANR)
"RTN","SDPFSS",95,0)
 . I 'SDOK D
"RTN","SDPFSS",96,0)
 . . S SDERRMSG=$S($P($G(SDOK),U,2)]"":$P($G(SDOK),U,2),1:"Unable to File Account Number Reference")
"RTN","SDPFSS",97,0)
 . . D ERRMSG^SDPFSS2(SDERRMSG)
"RTN","SDPFSS",98,0)
 K ^TMP($J,"SDAMA301")
"RTN","SDPFSS",99,0)
 Q
"RTN","SDPFSS",100,0)
 ;
"RTN","SDPFSS",101,0)
CHECK() ; Check routine for unit testing to allow for on/off PFSS Switch
"RTN","SDPFSS",102,0)
 N RSLT,X
"RTN","SDPFSS",103,0)
 ;
"RTN","SDPFSS",104,0)
 ; Check if the PFSS Switch Status API call is installed
"RTN","SDPFSS",105,0)
 ; If it is, then return the status of the switch, otherwise
"RTN","SDPFSS",106,0)
 ; return 0
"RTN","SDPFSS",107,0)
 I $T(SWSTAT^IBBAPI)'="" S RSLT=+$$SWSTAT^IBBAPI
"RTN","SDPFSS",108,0)
 Q +$G(RSLT)
"RTN","SDPFSS",109,0)
 ;
"RTN","SDPFSS",110,0)
FILE(DFN,SDT,SDCLN,SDANR) ;  Procedure to validate and load appointment information and account number reference into file #409.55
"RTN","SDPFSS",111,0)
 ;
"RTN","SDPFSS",112,0)
 ; Input
"RTN","SDPFSS",113,0)
 ;    DFN    - Patient IEN in File #2
"RTN","SDPFSS",114,0)
 ;    SDT    - Appointment Date/Time in Fileman format
"RTN","SDPFSS",115,0)
 ;    SDCLN  - Clinic IEN in Hospital Location File, #44
"RTN","SDPFSS",116,0)
 ;    SDANR  - Account Number Reference from IBB
"RTN","SDPFSS",117,0)
 ;
"RTN","SDPFSS",118,0)
 ; Output
"RTN","SDPFSS",119,0)
 ;    1 - If entry successfully created
"RTN","SDPFSS",120,0)
 ;   -1^error message - if load is unsuccessful
"RTN","SDPFSS",121,0)
 ;
"RTN","SDPFSS",122,0)
 N FDA,FDAIEN,ERR
"RTN","SDPFSS",123,0)
 ;
"RTN","SDPFSS",124,0)
 I '$G(DFN) S ERR="-1^MISSING DFN" G FILEQ
"RTN","SDPFSS",125,0)
 I '$D(^DPT(DFN)) S ERR="-1^INVALID PATIENT ENTRY" G FILEQ
"RTN","SDPFSS",126,0)
 I '$G(SDT) S ERR="-1^MISSING APPOINTMENT DATE/TIME" G FILEQ
"RTN","SDPFSS",127,0)
 I '$G(SDCLN) S ERR="-1^MISSING CLINIC LOCATION" G FILEQ
"RTN","SDPFSS",128,0)
 I '$D(^SC(SDCLN)) S ERR="-1^INVALID HOSPITAL LOCATION ENTRY" G FILEQ
"RTN","SDPFSS",129,0)
 I '$G(SDANR) S ERR="-1^No Account Number Reference provided" G FILEQ
"RTN","SDPFSS",130,0)
 ;
"RTN","SDPFSS",131,0)
 S FDA(1,409.55,"+1,",.01)=SDT
"RTN","SDPFSS",132,0)
 S FDA(1,409.55,"+1,",.02)=DFN
"RTN","SDPFSS",133,0)
 S FDA(1,409.55,"+1,",.03)=SDCLN
"RTN","SDPFSS",134,0)
 S FDA(1,409.55,"+1,",.04)=SDANR
"RTN","SDPFSS",135,0)
 D UPDATE^DIE("","FDA(1)","FDAIEN","ERR")
"RTN","SDPFSS",136,0)
 ;
"RTN","SDPFSS",137,0)
 I '$D(ERR) S ERR=1
"RTN","SDPFSS",138,0)
FILEQ Q $G(ERR)
"RTN","SDPFSS2")
0^2^B9459306
"RTN","SDPFSS2",1,0)
SDPFSS2 ;ALD/SCK - Patient Financial Services System cont. ; 22-April-2005
"RTN","SDPFSS2",2,0)
 ;;5.3;Scheduling;**430**;Aug 13, 1993
"RTN","SDPFSS2",3,0)
 ;
"RTN","SDPFSS2",4,0)
 Q
"RTN","SDPFSS2",5,0)
 ;
"RTN","SDPFSS2",6,0)
GETARN(SDT,DFN,SDCL) ; Get the PFSS Account Number Reference from file #409.55 for the matching Appt. D/T,
"RTN","SDPFSS2",7,0)
 ; patient DFN, and clinic location.
"RTN","SDPFSS2",8,0)
 ;   Input
"RTN","SDPFSS2",9,0)
 ;      SDT  - Appointment Date/Time
"RTN","SDPFSS2",10,0)
 ;      DFN  - Patient IEN to File #2
"RTN","SDPFSS2",11,0)
 ;      SDCL - Clinic IEN to File #44
"RTN","SDPFSS2",12,0)
 ;
"RTN","SDPFSS2",13,0)
 ;   Output
"RTN","SDPFSS2",14,0)
 ;      If an error occurred : -1^Error message
"RTN","SDPFSS2",15,0)
 ;      0 if no match found
"RTN","SDPFSS2",16,0)
 ;      SDANR if a match is found
"RTN","SDPFSS2",17,0)
 ;
"RTN","SDPFSS2",18,0)
 N SDANR,SDIEN
"RTN","SDPFSS2",19,0)
 ;
"RTN","SDPFSS2",20,0)
 S DFN=$G(DFN) I 'DFN S SDANR="-1^No DFN was provided" G ARNQ
"RTN","SDPFSS2",21,0)
 S SDT=$G(SDT) I 'SDT S SDANR="-1^No Appointment Date/Time provided" G ARNQ
"RTN","SDPFSS2",22,0)
 S SDCL=$G(SDCL) I 'SDCL S SDANR="-1^No Clinic information was provided"  G ARNQ
"RTN","SDPFSS2",23,0)
 ;
"RTN","SDPFSS2",24,0)
 S SDIEN=0
"RTN","SDPFSS2",25,0)
 S SDIEN=$O(^SD(409.55,"D",SDT,DFN,SDCL,0))
"RTN","SDPFSS2",26,0)
 I SDIEN>0 D
"RTN","SDPFSS2",27,0)
 . S SDANR=$$GET1^DIQ(409.55,SDIEN,.04)
"RTN","SDPFSS2",28,0)
 E  D
"RTN","SDPFSS2",29,0)
 . S SDANR=0
"RTN","SDPFSS2",30,0)
ARNQ Q $G(SDANR)
"RTN","SDPFSS2",31,0)
 ;
"RTN","SDPFSS2",32,0)
ENCPRV(DFN,SDVSIT) ; Returns the encounter provider associated with the visit.
"RTN","SDPFSS2",33,0)
 ; Input
"RTN","SDPFSS2",34,0)
 ;    DFN    - Patient IEN from the PATIENT File (#2)
"RTN","SDPFSS2",35,0)
 ;    SDVSIT - Visit IEN from the VISIT File (#9000010)
"RTN","SDPFSS2",36,0)
 ;      DFN and SDVSIT are references to global variables which are available as part 
"RTN","SDPFSS2",37,0)
 ; of the SD application.
"RTN","SDPFSS2",38,0)
 ;
"RTN","SDPFSS2",39,0)
 ; Output
"RTN","SDPFSS2",40,0)
 ;    Visit Provider from the NEW PERSON File (#200)
"RTN","SDPFSS2",41,0)
 ;    IEN^Provider Name or Null
"RTN","SDPFSS2",42,0)
 ;
"RTN","SDPFSS2",43,0)
 N PRVIEN,SDX,PRVNAME,RSLT
"RTN","SDPFSS2",44,0)
 ;
"RTN","SDPFSS2",45,0)
 I $G(SDVSIT)>0 S SDX=$O(^AUPNVPRV("AD",SDVSIT,0))
"RTN","SDPFSS2",46,0)
 I +$G(SDX)>0 D
"RTN","SDPFSS2",47,0)
 . S PRVIEN=$P($G(^AUPNVPRV(SDX,0)),U)
"RTN","SDPFSS2",48,0)
 . I PRVIEN>0,$P($G(^AUPNVPRV(SDX,0)),U,2)=DFN S PRVNAME=$$GET1^DIQ(200,PRVIEN,.01)
"RTN","SDPFSS2",49,0)
 . S RSLT=$G(PRVIEN)_"^"_$G(PRVNAME)
"RTN","SDPFSS2",50,0)
 Q $G(RSLT)
"RTN","SDPFSS2",51,0)
 ;
"RTN","SDPFSS2",52,0)
DEFPRV(SDCLN) ; Return the default provider for a clinic if one is specified
"RTN","SDPFSS2",53,0)
 ; Input
"RTN","SDPFSS2",54,0)
 ;    SDCLN - Clinic IEN for HOSPITAL LOCATION File (#44)
"RTN","SDPFSS2",55,0)
 ; Output
"RTN","SDPFSS2",56,0)
 ;    Provider from NEW PERSON File (#200):
"RTN","SDPFSS2",57,0)
 ;    IEN^Provider Name or Null
"RTN","SDPFSS2",58,0)
 ;
"RTN","SDPFSS2",59,0)
 N SDX,PRVIEN,PRVNAME,RSLT
"RTN","SDPFSS2",60,0)
 ;
"RTN","SDPFSS2",61,0)
 S SDX=0
"RTN","SDPFSS2",62,0)
 F  S SDX=$O(^SC(SDCLN,"PR",SDX)) Q:'SDX  D
"RTN","SDPFSS2",63,0)
 . Q:'$P($G(^SC(SDCLN,"PR",SDX,0)),U,2)
"RTN","SDPFSS2",64,0)
 . S PRVIEN=$P($G(^SC(SDCLN,"PR",SDX,0)),U)
"RTN","SDPFSS2",65,0)
 . S PRVNAME=$$GET1^DIQ(200,PRVIEN,.01)
"RTN","SDPFSS2",66,0)
 . S RSLT=$G(PRVIEN)_"^"_$G(PRVNAME)
"RTN","SDPFSS2",67,0)
 Q $G(RSLT)
"RTN","SDPFSS2",68,0)
 ;
"RTN","SDPFSS2",69,0)
ERRMSG(ERRCODE) ; Generate bulletin when an error condition is processed
"RTN","SDPFSS2",70,0)
 ; Bulletins will be sent only if the receiving mail group SD RSA API ERRORS
"RTN","SDPFSS2",71,0)
 ; contains at least 1 member
"RTN","SDPFSS2",72,0)
 ;
"RTN","SDPFSS2",73,0)
 N XMDUZ,XMSUB,XMTEXT,XMB,X,Y,MSG,SDMG,XMY
"RTN","SDPFSS2",74,0)
 ;
"RTN","SDPFSS2",75,0)
 S SDMG=$O(^XMB(3.8,"B","SD RSA API ERRORS",0))
"RTN","SDPFSS2",76,0)
 Q:'SDMG
"RTN","SDPFSS2",77,0)
 ; Check mail group for members.  Quit if there are no members assigned to the group
"RTN","SDPFSS2",78,0)
 Q:'$D(^XMB(3.8,SDMG,1,"B"))
"RTN","SDPFSS2",79,0)
 ;
"RTN","SDPFSS2",80,0)
 ; Get the error message, or set a generic message
"RTN","SDPFSS2",81,0)
 S MSG=$P($G(ERRCODE),U,2)
"RTN","SDPFSS2",82,0)
 I MSG']"" S MSG="A general error condition occurred during the PFSS Event Driver processing"
"RTN","SDPFSS2",83,0)
 ;
"RTN","SDPFSS2",84,0)
 S XMDUZ="PFSS EVENT DRIVER"
"RTN","SDPFSS2",85,0)
 S XMY("G.SD RSA API ERRORS")=""
"RTN","SDPFSS2",86,0)
 S XMB="SD API ERROR NOTICE"
"RTN","SDPFSS2",87,0)
 S XMB(1)=$$GET1^DIQ(2,DFN,.01)
"RTN","SDPFSS2",88,0)
 S XMB(2)=$$FMTE^XLFDT(SDT)
"RTN","SDPFSS2",89,0)
 S XMB(3)=$$GET1^DIQ(44,SDCL,.01)
"RTN","SDPFSS2",90,0)
 S XMB(4)=IBBEVENT
"RTN","SDPFSS2",91,0)
 S XMB(5)=MSG
"RTN","SDPFSS2",92,0)
 D ^XMB
"RTN","SDPFSS2",93,0)
 Q
"RTN","SDPFSS2",94,0)
 ;
"RTN","SDPFSS2",95,0)
GETEVT(EVT) ; Return message type for appointment event
"RTN","SDPFSS2",96,0)
 ; The following appoint events will return the indicated message type
"RTN","SDPFSS2",97,0)
 ;   MAKE              A05
"RTN","SDPFSS2",98,0)
 ;   CHECK-IN          A04
"RTN","SDPFSS2",99,0)
 ;   CHECK-OUT         A03
"RTN","SDPFSS2",100,0)
 ;   NO-SHOW           A38
"RTN","SDPFSS2",101,0)
 ;
"RTN","SDPFSS2",102,0)
 ;   CANCEL APPT.      A38
"RTN","SDPFSS2",103,0)
 ;   CANCEL CHECK-IN   A11
"RTN","SDPFSS2",104,0)
 ;   CANCEL CHECK-OUT  A13
"RTN","SDPFSS2",105,0)
 ;   CANCEL NO-SHOW    A05
"RTN","SDPFSS2",106,0)
 ;
"RTN","SDPFSS2",107,0)
 Q $S(EVT="MAKE":"A05",EVT="CHECK-IN":"A04",EVT="CHECK-OUT":"A03",EVT="NO-SHOW":"A38",EVT="CANCEL":"A38",EVT="DELETE CO":"A13",EVT="DELETE CI":"A11",EVT="DELETE NS":"A05",1:"")
"RTN","SDVSIT0")
0^3^B10655905
"RTN","SDVSIT0",1,0)
SDVSIT0 ;MJK/ALB,ESW,SCK - OE Processing ; 11/21/02 11:00am
"RTN","SDVSIT0",2,0)
 ;;5.3;Scheduling;**27,99,132,257,430**;AUG 13, 1993
"RTN","SDVSIT0",3,0)
 ;
"RTN","SDVSIT0",4,0)
ADD(SDT,SDVSIT) ; -- add/find outpatient encounter
"RTN","SDVSIT0",5,0)
 ; input        SDT = visit date internal format
"RTN","SDVSIT0",6,0)
 ;           SDVSIT = <see bottom of routine>
"RTN","SDVSIT0",7,0)
 ;
"RTN","SDVSIT0",8,0)
 ; returned = ien of 409.67
"RTN","SDVSIT0",9,0)
 ; *** search code to be written ***
"RTN","SDVSIT0",10,0)
 ; -- set up vars
"RTN","SDVSIT0",11,0)
 S SDVSIT("VST")=""
"RTN","SDVSIT0",12,0)
 ; -- add a visit file entry
"RTN","SDVSIT0",13,0)
 D VISIT(SDT,.SDVSIT)
"RTN","SDVSIT0",14,0)
 ; -- add opt encounter
"RTN","SDVSIT0",15,0)
 Q $$NEW(SDT,.SDVSIT)
"RTN","SDVSIT0",16,0)
 ;
"RTN","SDVSIT0",17,0)
NEW(SDT,SDVSIT) ; -- create new outpatient encounter record
"RTN","SDVSIT0",18,0)
 ; input        SDT = visit date internal format
"RTN","SDVSIT0",19,0)
 ;           SDVSIT = <see bottom of routine>
"RTN","SDVSIT0",20,0)
 ;
"RTN","SDVSIT0",21,0)
 ; returned = ien of 409.67
"RTN","SDVSIT0",22,0)
 ;
"RTN","SDVSIT0",23,0)
 N SDOE,X,DA,DR,DIE,DQ,DE,I
"RTN","SDVSIT0",24,0)
 ; -- creation hard set for performance
"RTN","SDVSIT0",25,0)
 S I=$P(^SCE(0),U,3)
"RTN","SDVSIT0",26,0)
LOCK S I=I+1 L +^SCE(I):1 I '$T!$D(^SCE(I)) L -^SCE(I) G LOCK
"RTN","SDVSIT0",27,0)
 S ^SCE(I,0)=SDT,^SCE("B",SDT,I)="",^SCE(0)=$P(^SCE(0),"^",1,2)_"^"_I_"^"_($P(^SCE(0),"^",4)+1),^DISV($S($D(DUZ)'[0:DUZ,1:0),"^SCE(")=I,Y=I
"RTN","SDVSIT0",28,0)
 ;K DD,DO S SDOE=0,X=SDT,DIC="^SCE(",DIC(0)="L" D FILE^DICN G NEWQ:'Y
"RTN","SDVSIT0",29,0)
 S:'$G(SDVSIT("ELG")) SDVSIT("ELG")=$P($G(^DPT(SDVSIT("DFN"),.36)),U)
"RTN","SDVSIT0",30,0)
 S SDVSIT("STA")=$$STATUS(+SDVSIT("DFN"),SDT,+$G(SDVSIT("LOC")),SDVSIT("ORG"),"KILL")
"RTN","SDVSIT0",31,0)
 S (SDOE,DA)=+Y,DIE="^SCE(",DR="[SD ENCOUNTER ENTRY]" D ^DIE
"RTN","SDVSIT0",32,0)
 D:$$REQ^SDM1A(SDT)'="CO" EN^SDCOM(SDOE,0,99999)
"RTN","SDVSIT0",33,0)
 L -^SCE(SDOE)
"RTN","SDVSIT0",34,0)
NEWQ Q SDOE
"RTN","SDVSIT0",35,0)
 ;
"RTN","SDVSIT0",36,0)
VISIT(SDT,SDVSIT) ; -- add visit file entry
"RTN","SDVSIT0",37,0)
 N VSIT,DFN,DIE,DIC,DR,DA,X,VSITPKG
"RTN","SDVSIT0",38,0)
 ; -- is visit tracking loaded
"RTN","SDVSIT0",39,0)
 S X="VSITKIL" X ^%ZOSF("TEST") I '$T G VISITQ
"RTN","SDVSIT0",40,0)
 ; -- set up vars
"RTN","SDVSIT0",41,0)
 ;S VSIT(0)="ENMD0",VSIT=SDT,DFN=SDVSIT("DFN"),VSITPKG="SD"
"RTN","SDVSIT0",42,0)
 S VSIT(0)="F",VSIT=SDT,DFN=SDVSIT("DFN"),VSITPKG="SD"
"RTN","SDVSIT0",43,0)
 S VSIT("CLN")=$G(SDVSIT("CLN")),VSIT("SVC")=$S($G(SDVSIT("SVC"))]"":SDVSIT("SVC"),$$INP^SDAM2(DFN,SDT)="I":"I",1:"A")
"RTN","SDVSIT0",44,0)
 ;S VSIT("INS")=$P($G(^DG(40.8,+$G(SDVSIT("DIV")),0)),U,7)
"RTN","SDVSIT0",45,0)
 S VSIT("ELG")=$S($G(SDVSIT("ELG")):SDVSIT("ELG"),1:+$G(^DPT(DFN,.36)))
"RTN","SDVSIT0",46,0)
 I $G(SDVSIT("LOC")) S VSIT("LOC")=SDVSIT("LOC")
"RTN","SDVSIT0",47,0)
 I $G(SDVSIT("PAR")) S X=$G(^SCE(SDVSIT("PAR"),0)) I X]"" S VSIT=+X I $P(X,U,5) S VSIT("LNK")=$P(X,U,5)
"RTN","SDVSIT0",48,0)
 S VSIT("ACT")=$$GETARN^SDPFSS2(SDT,DFN,$G(SDVSIT("LOC")))
"RTN","SDVSIT0",49,0)
 I $G(VSIT("LNK")) D  ;PX/96 - accept passed INSTITUTION
"RTN","SDVSIT0",50,0)
 .N DR,DIC,DA,DIQ,INST,DIC1
"RTN","SDVSIT0",51,0)
 .S DR=".06",DIC=9000010,DIC1=DIC,DA=VSIT("LNK"),DIQ="INST",DIQ(0)="I" D EN^DIQ1
"RTN","SDVSIT0",52,0)
 .S VSIT("INS")=+$G(INST(DIC1,DA,DR,"I"))
"RTN","SDVSIT0",53,0)
 .I VSIT("INS")'>0 S VSIT("INS")=$P($G(^DG(40.8,+$G(SDVSIT("DIV")),0)),U,7)
"RTN","SDVSIT0",54,0)
 .Q
"RTN","SDVSIT0",55,0)
 ;
"RTN","SDVSIT0",56,0)
 I '$G(SDVSIT("PAR")) D
"RTN","SDVSIT0",57,0)
 . S VSIT("PRI")="P"
"RTN","SDVSIT0",58,0)
 E  D
"RTN","SDVSIT0",59,0)
 . I SDVSIT("ORG")=4 D
"RTN","SDVSIT0",60,0)
 .. S VSIT("PRI")="C",VSIT("SVC")=$S($$INP^SDAM2(DFN,SDT)="I":"D",1:"X")
"RTN","SDVSIT0",61,0)
 . E  D
"RTN","SDVSIT0",62,0)
 .. S VSIT("PRI")="S"
"RTN","SDVSIT0",63,0)
 ;
"RTN","SDVSIT0",64,0)
 ; -- changes for database conversion to pass in source and service
"RTN","SDVSIT0",65,0)
 I $D(SCCVT) D
"RTN","SDVSIT0",66,0)
 . I $G(SCCVT("SOR"))'="" S VSIT("SOR")=$$SOURCE^PXAPI(SCCVT("SOR"))
"RTN","SDVSIT0",67,0)
 . I $G(SCCVT("SVC"))'="" S VSIT("SVC")=SCCVT("SVC")
"RTN","SDVSIT0",68,0)
 . I $G(SCCVT("LOC"))'="" S VSIT("LOC")=SCCVT("LOC")
"RTN","SDVSIT0",69,0)
 ;
"RTN","SDVSIT0",70,0)
 ; -- do checks
"RTN","SDVSIT0",71,0)
 I 'VSIT,'DFN,'VSIT("ELG")!('VSIT("INS"))!('VSIT("CLN")) G VISITQ
"RTN","SDVSIT0",72,0)
 ;
"RTN","SDVSIT0",73,0)
 ; -- add/find visit
"RTN","SDVSIT0",74,0)
 ;-- change call if orinating process is a disposition.
"RTN","SDVSIT0",75,0)
 I SDVSIT("ORG")=3 D DISPVSIT^PXAPI
"RTN","SDVSIT0",76,0)
 I SDVSIT("ORG")'=3 D ^VSIT
"RTN","SDVSIT0",77,0)
 IF +$G(VSIT("IEN"))>0 S SDVSIT("VST")=+VSIT("IEN")
"RTN","SDVSIT0",78,0)
VISITQ Q
"RTN","SDVSIT0",79,0)
 ;
"RTN","SDVSIT0",80,0)
STATUS(DFN,SDT,SDCL,SDORG,SDACT) ; -- 409.68;.07 x-ref
"RTN","SDVSIT0",81,0)
 N Y S Y=0
"RTN","SDVSIT0",82,0)
 I $$INP^SDAM2(DFN,SDT)="I" S Y=8
"RTN","SDVSIT0",83,0)
 I 'Y,$P($G(^SC(+SDCL,0)),U,17)="Y" S Y=12
"RTN","SDVSIT0",84,0)
 I 'Y S Y=$S(SDACT="SET":2,$$REQ^SDM1A(SDT)="CO":14,1:2)
"RTN","SDVSIT0",85,0)
 Q Y
"RTN","SDVSIT0",86,0)
 ;
"RTN","SDVSIT0",87,0)
 ;
"RTN","SDVSIT0",88,0)
 ; Additional input/output variable documentation
"RTN","SDVSIT0",89,0)
 ;
"RTN","SDVSIT0",90,0)
 ;       SDVSIT("LOC") = file # 44     ien (location)
"RTN","SDVSIT0",91,0)
 ;             ("ELG") = file #  8     ien (eligibility)
"RTN","SDVSIT0",92,0)
 ;             ("CLN") = file # 40.7   ien (clinic stop code)
"RTN","SDVSIT0",93,0)
 ;             ("DIV") = file # 40.8   ien (med ctr div)
"RTN","SDVSIT0",94,0)
 ;             ("DFN") = file #  2     ien (patient)
"RTN","SDVSIT0",95,0)
 ;             ("STA") = file #409.63  ien (appt status)
"RTN","SDVSIT0",96,0)
 ;             ("ORG") = orginating process
"RTN","SDVSIT0",97,0)
 ;                 1 - appt
"RTN","SDVSIT0",98,0)
 ;                 2 - add/edit
"RTN","SDVSIT0",99,0)
 ;                 3 - disposition
"RTN","SDVSIT0",100,0)
 ;             ("TYP") = file #409.1   ien (appt type)
"RTN","SDVSIT0",101,0)
 ;             ("VST") = file #9000010 ien (visit)
"RTN","SDVSIT0",102,0)
 ;             ("LNK") = file #9000010 ien (parent visit)
"RTN","SDVSIT0",103,0)
 ;             ("REF") = extended reference
"RTN","SDVSIT0",104,0)
 ;              appt - ^SC(<clinic>,"S",<date/time>,1,<ext ref>,0)
"RTN","SDVSIT0",105,0)
 ;              disp - ^DPT(<dfn>,"DIS",<ext ref>,0)
"RTN","SDVSIT0",106,0)
 ;             ("PAR") = file #409.68 ien (outpatient encounter)
"RTN","SDVSIT0",107,0)
 ;                         - parent encounter ien
"RTN","SDVSIT0",108,0)
 ;      SDVIEN         = passed in Visit file ien
"RTN","SDVSIT0",109,0)
 ;
"SEC","^DIC",409.55,409.55,0,"AUDIT")
@
"SEC","^DIC",409.55,409.55,0,"DD")
@
"SEC","^DIC",409.55,409.55,0,"DEL")
@
"SEC","^DIC",409.55,409.55,0,"LAYGO")
@
"SEC","^DIC",409.55,409.55,0,"RD")
@
"SEC","^DIC",409.55,409.55,0,"WR")
@
"VER")
8.0^22.0
"^DD",409.55,409.55,0)
FIELD^^.001^5
"^DD",409.55,409.55,0,"DDA")
N
"^DD",409.55,409.55,0,"DT")
3050419
"^DD",409.55,409.55,0,"IX","B",409.55,.01)

"^DD",409.55,409.55,0,"IX","C",409.55,.02)

"^DD",409.55,409.55,0,"IX","E",409.55,.04)

"^DD",409.55,409.55,0,"NM","APPOINTMENT PFSS ACCOUNT REFERENCE")

"^DD",409.55,409.55,.001,0)
APPOINTMENT ENTRY^RNJ9,0I^^ ^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1.N) X
"^DD",409.55,409.55,.001,3)
Type a number between 1 and 999999999, 0 Decimal Digits
"^DD",409.55,409.55,.001,21,0)
^^1^1^3050419^
"^DD",409.55,409.55,.001,21,1,0)
This field is the unique record identifier for the appointment /  account number reference.
"^DD",409.55,409.55,.001,23,0)
^^1^1^3050419^
"^DD",409.55,409.55,.001,23,1,0)
XXXX--CAN'T BE ALTERED EXCEPT BY PROGRAMMER
"^DD",409.55,409.55,.001,"DT")
3050419
"^DD",409.55,409.55,.01,0)
APPOINTMENT DATE/TIME^RD^^0;1^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",409.55,409.55,.01,1,0)
^.1
"^DD",409.55,409.55,.01,1,1,0)
409.55^B
"^DD",409.55,409.55,.01,1,1,1)
S ^SD(409.55,"B",$E(X,1,30),DA)=""
"^DD",409.55,409.55,.01,1,1,2)
K ^SD(409.55,"B",$E(X,1,30),DA)
"^DD",409.55,409.55,.01,3)
Enter the date/time for the scheduled appointment.
"^DD",409.55,409.55,.01,4)
S %DT="ESTX" D HELP^%DTC
"^DD",409.55,409.55,.01,21,0)
^^1^1^3050419^
"^DD",409.55,409.55,.01,21,1,0)
This is the Date/Time of the scheduled appointment.
"^DD",409.55,409.55,.01,"DT")
3050419
"^DD",409.55,409.55,.02,0)
PATIENT^RP2'^DPT(^0;2^Q
"^DD",409.55,409.55,.02,1,0)
^.1
"^DD",409.55,409.55,.02,1,1,0)
409.55^C
"^DD",409.55,409.55,.02,1,1,1)
S ^SD(409.55,"C",$E(X,1,30),DA)=""
"^DD",409.55,409.55,.02,1,1,2)
K ^SD(409.55,"C",$E(X,1,30),DA)
"^DD",409.55,409.55,.02,1,1,"DT")
3050419
"^DD",409.55,409.55,.02,3)
Select patient for this appointment reference.
"^DD",409.55,409.55,.02,21,0)
^^1^1^3050419^
"^DD",409.55,409.55,.02,21,1,0)
Reference to Patient File (#2) for patient's appointment
"^DD",409.55,409.55,.02,"DT")
3050419
"^DD",409.55,409.55,.03,0)
CLINIC^RP44'^SC(^0;3^Q
"^DD",409.55,409.55,.03,3)
Enter clinic location for appointment.
"^DD",409.55,409.55,.03,21,0)
^^1^1^3050419^
"^DD",409.55,409.55,.03,21,1,0)
This field is the pointer to the HOSPITAL LOCATION File (#44)
"^DD",409.55,409.55,.03,"DT")
3050531
"^DD",409.55,409.55,.04,0)
PFSS ACCOUNT REFERENCE^P375'I^IBBAA(375,^0;4^Q
"^DD",409.55,409.55,.04,.1)

"^DD",409.55,409.55,.04,1,0)
^.1
"^DD",409.55,409.55,.04,1,1,0)
409.55^E
"^DD",409.55,409.55,.04,1,1,1)
S ^SD(409.55,"E",$E(X,1,30),DA)=""
"^DD",409.55,409.55,.04,1,1,2)
K ^SD(409.55,"E",$E(X,1,30),DA)
"^DD",409.55,409.55,.04,1,1,"%D",0)
^^2^2^3050419^
"^DD",409.55,409.55,.04,1,1,"%D",1,0)
Cross-reference to return appointment information for an account number
"^DD",409.55,409.55,.04,1,1,"%D",2,0)
reference.
"^DD",409.55,409.55,.04,1,1,"DT")
3050419
"^DD",409.55,409.55,.04,3)
The PFSS ACCOUNT file reference must be set through the PFSS event driver
"^DD",409.55,409.55,.04,21,0)
^^3^3^3050602^
"^DD",409.55,409.55,.04,21,1,0)
This is the file reference to the PFSS ACCOUNT File (#375) which 
"^DD",409.55,409.55,.04,21,2,0)
contains the IBB Account Number reference.  This is the reference to the 
"^DD",409.55,409.55,.04,21,3,0)
account number returned from the external system.
"^DD",409.55,409.55,.04,23,0)
^^1^1^3050419^
"^DD",409.55,409.55,.04,23,1,0)
XXXX--CAN'T BE ALTERED EXCEPT BY PROGRAMMER
"^DD",409.55,409.55,.04,"DT")
3050620
"^DIC",409.55,409.55,0)
APPOINTMENT PFSS ACCOUNT REFERENCE^409.55
"^DIC",409.55,409.55,0,"GL")
^SD(409.55,
"^DIC",409.55,409.55,"%",0)
^1.005^^
"^DIC",409.55,409.55,"%D",0)
^^4^4^3050620^
"^DIC",409.55,409.55,"%D",1,0)
This file provides a linkage between the scheduled appointment
"^DIC",409.55,409.55,"%D",2,0)
identifiers: DFN-Appointment Date/Time-Clinic IEN and the PFSS ACCOUNT
"^DIC",409.55,409.55,"%D",3,0)
File (#375).  Indexes allow the lookup of the PFSS Account Reference by
"^DIC",409.55,409.55,"%D",4,0)
using the appointment identifiers.
"^DIC",409.55,"B","APPOINTMENT PFSS ACCOUNT REFERENCE",409.55)

"BLD",5808,6)
^375
**END**
**END**
