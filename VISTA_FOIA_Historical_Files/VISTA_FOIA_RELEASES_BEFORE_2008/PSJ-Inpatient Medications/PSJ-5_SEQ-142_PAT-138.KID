Released PSJ*5*138 SEQ #142
Extracted from mail message
**KIDS**:PSJ*5.0*138^

**INSTALL NAME**
PSJ*5.0*138
"BLD",5285,0)
PSJ*5.0*138^INPATIENT MEDICATIONS^0^3050708^y
"BLD",5285,1,0)
^^24^24^3050708^^
"BLD",5285,1,1,0)
 1. An undefined variable error occurs when an attempt is made to print a
"BLD",5285,1,2,0)
 MAR label for a non-verified order. The error occurs when the software
"BLD",5285,1,3,0)
 attempts to retrieve clinic appointment information from the non-verified
"BLD",5285,1,4,0)
 order. Once the order is verified the MAR label prints without producing
"BLD",5285,1,5,0)
 the error. This patch corrects this issue by correctly processing
"BLD",5285,1,6,0)
 non-verified orders without appointment information.
"BLD",5285,1,7,0)
 HD0000000068851
"BLD",5285,1,8,0)
 
"BLD",5285,1,9,0)
 2. Immediately after copying a unit dose order, if the order's schedule
"BLD",5285,1,10,0)
 is edited, administration times and schedule frequency from the new
"BLD",5285,1,11,0)
 schedule do not default into the copied order. This patch corrects this  
"BLD",5285,1,12,0)
 issue by using the administration times and schedule frequency from the 
"BLD",5285,1,13,0)
 newly entered schedule. 
"BLD",5285,1,14,0)
 HD0000000102178 
"BLD",5285,1,15,0)
 
"BLD",5285,1,16,0)
 3. When changing an IV order's schedule from a continuous schedule to a 
"BLD",5285,1,17,0)
 one-time schedule with no frequency defined in the ADMINISTRATION 
"BLD",5285,1,18,0)
 SCHEDULE file (#51.1), the order's schedule interval is not updated, 
"BLD",5285,1,19,0)
 resulting in the order's IV labels printing based on the frequency of
"BLD",5285,1,20,0)
 the original schedule. For example, if an IV order's schedule is changed 
"BLD",5285,1,21,0)
 from Q6H to ONCE, IV labels will continue to print based on the Q6H 
"BLD",5285,1,22,0)
 schedule, or 4 labels per day. This patch will require an order's 
"BLD",5285,1,23,0)
 schedule interval to be updated with the frequency from the new schedule.
"BLD",5285,1,24,0)
 HD0000000092412
"BLD",5285,4,0)
^9.64PA^^
"BLD",5285,"ABPKG")
n
"BLD",5285,"KRN",0)
^9.67PA^8989.52^19
"BLD",5285,"KRN",.4,0)
.4
"BLD",5285,"KRN",.401,0)
.401
"BLD",5285,"KRN",.402,0)
.402
"BLD",5285,"KRN",.403,0)
.403
"BLD",5285,"KRN",.5,0)
.5
"BLD",5285,"KRN",.84,0)
.84
"BLD",5285,"KRN",3.6,0)
3.6
"BLD",5285,"KRN",3.8,0)
3.8
"BLD",5285,"KRN",9.2,0)
9.2
"BLD",5285,"KRN",9.8,0)
9.8
"BLD",5285,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5285,"KRN",9.8,"NM",1,0)
PSGLOI^^0^B33789368
"BLD",5285,"KRN",9.8,"NM",2,0)
PSGS0^^0^B43687182
"BLD",5285,"KRN",9.8,"NM",3,0)
PSIVSP^^0^B34275860
"BLD",5285,"KRN",9.8,"NM","B","PSGLOI",1)

"BLD",5285,"KRN",9.8,"NM","B","PSGS0",2)

"BLD",5285,"KRN",9.8,"NM","B","PSIVSP",3)

"BLD",5285,"KRN",19,0)
19
"BLD",5285,"KRN",19.1,0)
19.1
"BLD",5285,"KRN",101,0)
101
"BLD",5285,"KRN",409.61,0)
409.61
"BLD",5285,"KRN",771,0)
771
"BLD",5285,"KRN",870,0)
870
"BLD",5285,"KRN",8989.51,0)
8989.51
"BLD",5285,"KRN",8989.52,0)
8989.52
"BLD",5285,"KRN",8994,0)
8994
"BLD",5285,"KRN","B",.4,.4)

"BLD",5285,"KRN","B",.401,.401)

"BLD",5285,"KRN","B",.402,.402)

"BLD",5285,"KRN","B",.403,.403)

"BLD",5285,"KRN","B",.5,.5)

"BLD",5285,"KRN","B",.84,.84)

"BLD",5285,"KRN","B",3.6,3.6)

"BLD",5285,"KRN","B",3.8,3.8)

"BLD",5285,"KRN","B",9.2,9.2)

"BLD",5285,"KRN","B",9.8,9.8)

"BLD",5285,"KRN","B",19,19)

"BLD",5285,"KRN","B",19.1,19.1)

"BLD",5285,"KRN","B",101,101)

"BLD",5285,"KRN","B",409.61,409.61)

"BLD",5285,"KRN","B",771,771)

"BLD",5285,"KRN","B",870,870)

"BLD",5285,"KRN","B",8989.51,8989.51)

"BLD",5285,"KRN","B",8989.52,8989.52)

"BLD",5285,"KRN","B",8994,8994)

"BLD",5285,"QUES",0)
^9.62^^
"BLD",5285,"REQB",0)
^9.611^2^1
"BLD",5285,"REQB",2,0)
PSJ*5.0*133^2
"BLD",5285,"REQB","B","PSJ*5.0*133",2)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
138^3050708
"PKG",197,22,1,"PAH",1,1,0)
^^24^24^3050708
"PKG",197,22,1,"PAH",1,1,1,0)
 1. An undefined variable error occurs when an attempt is made to print a
"PKG",197,22,1,"PAH",1,1,2,0)
 MAR label for a non-verified order. The error occurs when the software
"PKG",197,22,1,"PAH",1,1,3,0)
 attempts to retrieve clinic appointment information from the non-verified
"PKG",197,22,1,"PAH",1,1,4,0)
 order. Once the order is verified the MAR label prints without producing
"PKG",197,22,1,"PAH",1,1,5,0)
 the error. This patch corrects this issue by correctly processing
"PKG",197,22,1,"PAH",1,1,6,0)
 non-verified orders without appointment information.
"PKG",197,22,1,"PAH",1,1,7,0)
 HD0000000068851
"PKG",197,22,1,"PAH",1,1,8,0)
 
"PKG",197,22,1,"PAH",1,1,9,0)
 2. Immediately after copying a unit dose order, if the order's schedule
"PKG",197,22,1,"PAH",1,1,10,0)
 is edited, administration times and schedule frequency from the new
"PKG",197,22,1,"PAH",1,1,11,0)
 schedule do not default into the copied order. This patch corrects this  
"PKG",197,22,1,"PAH",1,1,12,0)
 issue by using the administration times and schedule frequency from the 
"PKG",197,22,1,"PAH",1,1,13,0)
 newly entered schedule. 
"PKG",197,22,1,"PAH",1,1,14,0)
 HD0000000102178 
"PKG",197,22,1,"PAH",1,1,15,0)
 
"PKG",197,22,1,"PAH",1,1,16,0)
 3. When changing an IV order's schedule from a continuous schedule to a 
"PKG",197,22,1,"PAH",1,1,17,0)
 one-time schedule with no frequency defined in the ADMINISTRATION 
"PKG",197,22,1,"PAH",1,1,18,0)
 SCHEDULE file (#51.1), the order's schedule interval is not updated, 
"PKG",197,22,1,"PAH",1,1,19,0)
 resulting in the order's IV labels printing based on the frequency of
"PKG",197,22,1,"PAH",1,1,20,0)
 the original schedule. For example, if an IV order's schedule is changed 
"PKG",197,22,1,"PAH",1,1,21,0)
 from Q6H to ONCE, IV labels will continue to print based on the Q6H 
"PKG",197,22,1,"PAH",1,1,22,0)
 schedule, or 4 labels per day. This patch will require an order's 
"PKG",197,22,1,"PAH",1,1,23,0)
 schedule interval to be updated with the frequency from the new schedule.
"PKG",197,22,1,"PAH",1,1,24,0)
 HD0000000092412
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSGLOI")
0^1^B33789368
"RTN","PSGLOI",1,0)
PSGLOI ;BIR/CML3-ORDER INFO (AND PRINT) FOR LABELS ;30 Apr 98 / 4:41 PM
"RTN","PSGLOI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,44,58,110,111,138**;16 DEC 97
"RTN","PSGLOI",3,0)
 ;
"RTN","PSGLOI",4,0)
 ;Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGLOI",5,0)
 ;Reference to ^PSD(58.8 is supported by DBIA 2283.
"RTN","PSGLOI",6,0)
 ;Reference to ^PSI(58.1 is supported by DBIA 2284.
"RTN","PSGLOI",7,0)
 ;Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGLOI",8,0)
 ;
"RTN","PSGLOI",9,0)
ENOI ;
"RTN","PSGLOI",10,0)
 S F="^PS("_$S(PSGORD["N":"53.1,",PSGORD["P":"53.1,",1:"55,"_PSGOP_",5,")_+PSGORD_","
"RTN","PSGLOI",11,0)
 ; the quit below corrects an error if the Order has been moved to 55
"RTN","PSGLOI",12,0)
 Q:'$D(@(F_"0)"))
"RTN","PSGLOI",13,0)
 S ND=$G(@(F_"0)")),PSGLPR=$P(ND,"^",2),PSGLMR=$P(ND,"^",3),PSGLST=$P(ND,"^",7),PSGLSTAT=$P(ND,"^",9),PSGLTD=$P(ND,"^",12),PSGLOD=$P(ND,"^",14),PSGLSM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),NG=$P(ND,"^",22)
"RTN","PSGLOI",14,0)
 S ND=$G(@(F_".2)")),PSGLDRG=$P(ND,"^"),PSGLDDA=+ND,PSGLDO=$P(ND,"^",2)
"RTN","PSGLOI",15,0)
 S PSGCLN=$S(F[53.1:$G(@(F_"""DSS"")")),1:$G(@(F_"8)"))) I PSGCLN]"" S PSGLWDN=$P(^SC($P(PSGCLN,"^"),0),"^")
"RTN","PSGLOI",16,0)
 ;
"RTN","PSGLOI",17,0)
SET ;
"RTN","PSGLOI",18,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",19,0)
 K PSGLAT S ND=$G(@(F_"2)")),(PSGLSSD,PSGLSD)=$P(ND,"^",2),(PSGLFFD,PSGLFD)=$P(ND,"^",4),PSGLAT=$P(ND,"^",5),PSGLMN=$P(ND,"^",6),PSGLSCH=$P(ND,"^"),ND=$G(^(7)),PSGLDT=+ND,PSGLR=$P(ND,"^",2)
"RTN","PSGLOI",20,0)
 I PSGLST'="R",PSGLMN="D",PSGLAT="" S PSGLAT=$E($P(PSGLSD,".",2)_"0000",1,4)
"RTN","PSGLOI",21,0)
 I PSGLAT,PSGLSCH["@" S PSGLSCH=$P(PSGLSCH,"@")
"RTN","PSGLOI",22,0)
 S (PSGLAT(0),X)=0 I PSGLFD]"",PSGLFD'>PSGDT S (PSGLAT(0),X)=5,(PSGLAT(1),PSGLAT(2),PSGLAT(4),PSGLAT(5))="****",PSGLAT(3)=$S(PSGLSTAT["D":"DC'D",1:"EX'D")
"RTN","PSGLOI",23,0)
 E  I $S(PSGLSTAT="P":1,PSGLSTAT="U":1,PSGLST="OC":1,PSGLST="P":1,1:PSGLSCH["PRN") S PSGLAT=""
"RTN","PSGLOI",24,0)
 E  I PSGLAT S PSGLAT(0)=$L(PSGLAT,"-"),X=0 D
"RTN","PSGLOI",25,0)
 .F Q=1:1:5 S PSGLAT(Q)=""
"RTN","PSGLOI",26,0)
 .S Q=PSGLAT(0),Y=PSGLAT I Q=1 S PSGLAT(3)=$P(Y,"-") Q
"RTN","PSGLOI",27,0)
 .I Q=2 S PSGLAT(1)=$P(Y,"-"),PSGLAT(5)=$P(Y,"-",2) Q
"RTN","PSGLOI",28,0)
 .I Q=3 S PSGLAT(1)=$P(Y,"-"),PSGLAT(3)=$P(Y,"-",2),PSGLAT(5)=$P(Y,"-",3) Q
"RTN","PSGLOI",29,0)
 .F Q=1:1:PSGLAT(0) S X=X+1,PSGLAT(X)=$P(PSGLAT,"-",Q) I PSGLAT(0)<4 S X=X+1 S:Q<5 PSGLAT(X)=""
"RTN","PSGLOI",30,0)
 I X<5 F Q=X+1:1:5 S:'$G(PSGLAT(Q)) PSGLAT(Q)=""
"RTN","PSGLOI",31,0)
 I $G(DFN),$G(PSGORD) N PSGLREN S PSGLREN=+$$LASTREN^PSJLMPRI(DFN,PSGORD)
"RTN","PSGLOI",32,0)
 S ND=$G(@(F_"4)")),PSGLRN=+ND,PSGLRPH=+$P(ND,"^",3) N PSGLRNDT S PSGLRNDT=$P(ND,"^",2) I PSGLRNDT,$G(PSGLREN) I $G(PSGLREN)>PSGLRNDT S PSGLRN=0
"RTN","PSGLOI",33,0)
 I NG S PSGLSI="*** NOT TO BE GIVEN ***"
"RTN","PSGLOI",34,0)
 E  S PSGLSI=$P($G(@(F_"6)")),"^") S:PSGLSI]"" PSGLSI=$$ENSET^PSGSICHK(PSGLSI)
"RTN","PSGLOI",35,0)
 ;* I PSGLSI="",$P(@(F_"0)"),U,9)="P",$O(@(F_"12,0)")) S X=0 F  S X=$O(@(F_"12,"_X_")")) Q:'X  S Z=$G(^(X,0)),Y=$L(PSGLSI) S:Y+$L(Z)'>179 PSGLSI=PSGLSI_Z_" " I Y+$L(Z)>179 S PSGLSI=PSGLSI_$E(Z,1,177-Y)_"..." Q
"RTN","PSGLOI",36,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",37,0)
 I PSGLSI="",$P(@(F_"0)"),U,9)="P",$O(@(F_"12,0)")) S X=0 F  S X=$O(@(F_"12,"_X_")")) Q:'X  S Z=$G(^(X,0)),Y=$L(PSGLSI) S:Y+$L(Z)'>179 PSGLSI=PSGLSI_Z_" " I Y+$L(Z)>179 S PSGLSI="SEE PROVIDER COMMENTS" Q
"RTN","PSGLOI",38,0)
 S PSGLDT=$$ENDTC^PSGMI(PSGLDT),PSGLOD=$E($$ENDTC^PSGMI(PSGLOD),1,5)
"RTN","PSGLOI",39,0)
 I PSGLSTAT="P"!(PSGLSTAT="U") S PSGLSD="           ",PSGLFD="              ",PSGLST=" "
"RTN","PSGLOI",40,0)
 E  S PSGLSD=$$ENDTC1^PSGMI(PSGLSD),PSGLSD=$E(PSGLSD,1,5)_$E(PSGLSD,9,14),PSGLFD=$$ENDTC1^PSGMI(PSGLFD)
"RTN","PSGLOI",41,0)
 ;I PSGLSTAT="P"!(PSGLSTAT="U") S (PSGLSD,PSGLFD)="     ",PSGLST=" "
"RTN","PSGLOI",42,0)
 ;E  S PSGLSD=$E($$ENDTC^PSGMI(PSGLSD),1,5),PSGLFD=$$ENDTC^PSGMI(PSGLFD)
"RTN","PSGLOI",43,0)
 S:'PSGLRN PSGLRN="_____" I PSGLRN,$D(^VA(200,+PSGLRN,0))#2 S X=^(0),X=$S($P(X,"^",2)]"":$P(X,"^",2),1:$P(X,"^")),PSGLRN=$S(X'[",":X,1:$E(X,$F(X,","))_$E(X))
"RTN","PSGLOI",44,0)
 S:'PSGLRPH PSGLRPH="_____" I PSGLRPH,$D(^VA(200,+PSGLRPH,0))#2 S X=^(0),X=$S($P(X,"^",2)]"":$P(X,"^",2),1:$P(X,"^")),PSGLRPH=$S(X'[",":X,1:$E(X,$F(X,","))_$E(X))
"RTN","PSGLOI",45,0)
 I $P($G(^PS(51.2,+PSGLMR,0)),"^")]"" S PSGLMR=$E($S($P(^(0),"^",3)]"":$P(^(0),"^",3),1:$P(^(0),"^")),1,5)
"RTN","PSGLOI",46,0)
 I $P($G(^VA(200,+PSGLPR,0)),"^")]"" S PSGLPR=$P(^(0),"^")
"RTN","PSGLOI",47,0)
 S Q=32-$L(PSGLDO)-$L(PSGLMR) I $L(PSGLSCH)>Q S PSGLSCH=$E(PSGLSCH,1,Q-3)_"..."
"RTN","PSGLOI",48,0)
 NEW DRUGNAME
"RTN","PSGLOI",49,0)
 D DRGDISP^PSJLMUT1(DFN,$S(PSGORD["A":+PSGORD_"U",PSGORD["U":+PSGORD_"U",1:+PSGORD_"P"),40,34,.DRUGNAME,0)
"RTN","PSGLOI",50,0)
 ;* N PSGNOW D NOW^%DTC S PSGNOW=% S (PSGLNF,PSGLWS)=0 F X=0:0 S X=$O(@(F_"1,"_X_")")) Q:'X!(PSGLWS)  S Y=$G(^(X,0)) I $P(Y,U,3)>PSGNOW!'$P(Y,U,3) S PSGLWS=$D(^PSI(58.1,"D",+Y,+PSGLWD))
"RTN","PSGLOI",51,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",52,0)
 N PSGNOW D NOW^%DTC S PSGNOW=% S (PSGLNF,PSGLWS)=0 F X=0:0 S X=$O(@(F_"1,"_X_")")) Q:'X!(PSGLWS)  S Y=$G(^(X,0)) I $P(Y,U,3)>PSGNOW!'$P(Y,U,3) S PSGLWS=$S($D(^PSI(58.1,"D",+Y,+PSGLWD)):1,$D(^PSD(58.8,"D",+Y,+PSGLWD)):1,1:0)
"RTN","PSGLOI",53,0)
 I $D(PSGLSTOP) Q
"RTN","PSGLOI",54,0)
 ;
"RTN","PSGLOI",55,0)
ENP ;
"RTN","PSGLOI",56,0)
 ;W $C(13),?1,PSGLOD," | ",PSGLSD," | ",PSGLFD,?35,"(",PSGLBS5,")",?43,"|",PSGLAT(1),?52,PSGLPN,?88,$J($S(PSGLRB]"":PSGLRB,1:"*NF*"),12)
"RTN","PSGLOI",57,0)
 I PSGLSD["     ",+$G(@(F_"4)")) S X="P E N D I N G"
"RTN","PSGLOI",58,0)
 E  S X=PSGLSD_" |"_PSGLFD
"RTN","PSGLOI",59,0)
 W $C(13),?1,PSGLOD," |",X,?36,"(",PSGLBS5,")",?42,"|",PSGLAT(1),?52,PSGLPN,?88,$J($S(PSGLRB]"":PSGLRB,1:"*NF*"),12)
"RTN","PSGLOI",60,0)
 ;W $C(13),?1,PSGLOD," | ",X,?35,"(",PSGLBS5,")",?43,"|",PSGLAT(1),?52,PSGLPN,?88,$J($S(PSGLRB]"":PSGLRB,1:"*NF*"),12)
"RTN","PSGLOI",61,0)
 F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  D
"RTN","PSGLOI",62,0)
 . I X=1 W !?1,DRUGNAME(X),?42,PSGLST,?43,"|",PSGLAT(2),?52,PSGLSSN,?70,PSGLDOB,"  (",PSGLAGE,")",?85,$J($S(PSGLTM]"":PSGLTM,1:"NOT FOUND"),15)
"RTN","PSGLOI",63,0)
 . I X=2 W !?1,DRUGNAME(X),?43,"|",PSGLAT(3),?52,PSGLSEX,?65,"DX: ",PSGLDX
"RTN","PSGLOI",64,0)
 . S L=X+1
"RTN","PSGLOI",65,0)
 . I L=5,PSGLSI]"" W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",66,0)
 . I X>2 W !?1,DRUGNAME(X) D NXTLNE
"RTN","PSGLOI",67,0)
 I L=5,PSGLSI]"" W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",68,0)
 F Y=1:1:$L(PSGLSI," ") S Y1=$P(PSGLSI," ",Y) D
"RTN","PSGLOI",69,0)
 .I $L(Y1)>42 F  Q:$L(Y1)<42  D
"RTN","PSGLOI",70,0)
 ..S LEN=43-$X W $E(Y1,1,LEN) S Y1=$E(Y1,LEN+1,255) D NXTLNE
"RTN","PSGLOI",71,0)
 ..I L#5=0 W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",72,0)
 .I ($X+$L(Y1))>42 D NXTLNE I L#5=0 W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",73,0)
 .W Y1," "
"RTN","PSGLOI",74,0)
 D:PSGLSI]"" NXTLNE
"RTN","PSGLOI",75,0)
 I $D(PSGLAT(L+1)) F  Q:'$D(PSGLAT(L+1))  D
"RTN","PSGLOI",76,0)
 .I L#5=0 W ?1,"See next label for continuation" D NXTLNE W ! Q
"RTN","PSGLOI",77,0)
 .D NXTLNE
"RTN","PSGLOI",78,0)
 I L#5>0 F  Q:L#5=0  D NXTLNE
"RTN","PSGLOI",79,0)
 W $E("WS",1,PSGLWS*2) W:PSGLSM ?4,$E("HSM",PSGLSM,3) W ?8,$E("NF",1,PSGLNF*2),?24,"RPH:",PSGLRPH,?33," RN:",PSGLRN D NXTLNE
"RTN","PSGLOI",80,0)
 W !
"RTN","PSGLOI",81,0)
 Q
"RTN","PSGLOI",82,0)
 ;
"RTN","PSGLOI",83,0)
NXTLNE ; Print info to right of drug
"RTN","PSGLOI",84,0)
 W ?43,"|",$G(PSGLAT(L))
"RTN","PSGLOI",85,0)
 I L=4 D
"RTN","PSGLOI",86,0)
 .N Y S Y=PSGLR W ?52 W:PSGLDT PSGLDT,?77,$S(Y="NR":"RENEWAL ",Y["N":"NEW ",1:""),"ORDER "
"RTN","PSGLOI",87,0)
 .W $S(Y="E":"EDITED",Y="DE":"DC'ED (EDIT)",Y["D":"DISCONTINUED",Y="NE":"(EDIT)",PSGLR="H1":"ON HOLD",PSGLR="H0":"OFF OF HOLD",PSGLR="RE":"REINSTATED",1:"")
"RTN","PSGLOI",88,0)
 .I PSGLFFD]"",PSGLFFD'>PSGDT,PSGLR'["D" W " (EXPIRED)"
"RTN","PSGLOI",89,0)
 W:L=5 ?52,$S(PSGLWGN]"":$E(PSGLWGN,1,21),1:"NOT FOUND"),?79,$J($S(PSGLWDN]"":$E(PSGLWDN,1,21),1:"NOT FOUND"),21)
"RTN","PSGLOI",90,0)
 W !,?1 S L=L+1
"RTN","PSGLOI",91,0)
 Q
"RTN","PSGLOI",92,0)
ENKV ;*** Kill var created from this routine
"RTN","PSGLOI",93,0)
 K PSGDT,PSGLAGE,PSGLAT,PSGLBS5,PSGLDDA,PSGLDO,PSGLDOB,PSGLDRG,PSGLDT,PSGLDX,PSGLFD,PSGLFFD,PSGLMN,PSGLMR,PSGLNF,PSGLOD,PSGLPN
"RTN","PSGLOI",94,0)
 K PSGLPR,PSGLR,PSGLRB,PSGLRN,PSGLRPH,PSGLSCH,PSGLSD,PSGLSEX,PSGLSI,PSGLSM,PSGLSSD,PSGLSSN,PSGLST
"RTN","PSGLOI",95,0)
 K PSGLSTAT,PSGLSTOP,PSGLTD,PSGLTM,PSGLWD,PSGLWDN,PSGLWGN,PSGLWS,PSGNOW,PSGOP,PSGORD
"RTN","PSGLOI",96,0)
 Q
"RTN","PSGS0")
0^2^B43687182
"RTN","PSGS0",1,0)
PSGS0 ;BIR/CML3-SCHEDULE PROCESSOR ;29 Jan 99 / 8:04 AM
"RTN","PSGS0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**12,25,26,50,63,74,83,116,110,111,133,138**;16 DEC 97
"RTN","PSGS0",3,0)
 ;
"RTN","PSGS0",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGS0",5,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSGS0",6,0)
 ;
"RTN","PSGS0",7,0)
ENA ; entry point for train option
"RTN","PSGS0",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGS0",9,0)
 F  S (PSGS0Y,PSGS0XT)="" R !!,"Select STANDARD SCHEDULE: ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" ENQ^PSGSH I X'?1."?" D EN W:$D(X)[0 $C(7),"  ??" I $D(X)#2,'PSGS0Y,PSGS0XT W "  Every ",PSGS0XT," minutes"
"RTN","PSGS0",10,0)
 K DIC,DIE,PSGS0XT,PSGS0Y,Q,X,Y,PSGDT Q
"RTN","PSGS0",11,0)
 ;
"RTN","PSGS0",12,0)
EN3 ;
"RTN","PSGS0",13,0)
 S PSGST=$P($G(^PS(53.1,DA,0)),"^",7) G EN
"RTN","PSGS0",14,0)
 ;
"RTN","PSGS0",15,0)
EN5 ;
"RTN","PSGS0",16,0)
 S PSGST=$P($G(^PS(55,DA(1),5,DA,0)),"^",7)
"RTN","PSGS0",17,0)
 ;
"RTN","PSGS0",18,0)
EN ; validate
"RTN","PSGS0",19,0)
 K PSGS0Y
"RTN","PSGS0",20,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X)>70)!($L(X)<1) K X Q
"RTN","PSGS0",21,0)
 S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSGS0",22,0)
 I X?.E1L.E S X=$$ENLU^PSGMI(X) I '$D(PSGOES) D EN^DDIOL("  ("_X_")")
"RTN","PSGS0",23,0)
 ;
"RTN","PSGS0",24,0)
ENOS ; order set entry
"RTN","PSGS0",25,0)
 N X0,Y0,PSJXI,PSJDIC2
"RTN","PSGS0",26,0)
 I $G(X)="",$G(P(2)),$G(P(3)) S X=$G(P(9))
"RTN","PSGS0",27,0)
 I $G(X)="" Q
"RTN","PSGS0",28,0)
 S PSGXT=$G(PSGS0XT),(PSGS0XT,PSGS0Y,XT,Y,PSJNSS)=""
"RTN","PSGS0",29,0)
 S X0=X I X?2.4N1"-".E!(X?2.4N) D ENCHK S:$D(X) Y=X G Q
"RTN","PSGS0",30,0)
 I X["PRN",$$PRNOK(X),'$D(^PS(51.1,"AC","PSJ",X)) D  G Q
"RTN","PSGS0",31,0)
 .I X["@"!$$DOW^PSIVUTL($P(X," PRN")) N DOW D  I $G(DOW) S (Y0,Y,PSGS0Y)=$P($P(X,"@",2)," ")
"RTN","PSGS0",32,0)
 ..N TMP S TMP=X N X S X=$P(TMP," PRN") D DW I $G(X)]"" S DOW=1
"RTN","PSGS0",33,0)
 ..I $G(DOW),$G(PSGST)]"" I ",P,R,"'[(","_PSGST_",") S (XT,PSGS0XT)="D"
"RTN","PSGS0",34,0)
 D DIC I $G(XT)]""!$G(Y0)!($G(X)]""&$G(PSJXI)) D  I $G(X)]"" G:$D(^PS(51.1,"AC","PSJ",X)) Q3 I $P(X,"@")]"" G:$D(^PS(51.1,"AC","PSJ",$P(X,"@"))) Q3
"RTN","PSGS0",35,0)
 .S PSGS0XT=XT S:$G(Y0) (Y,PSGS0Y)=Y0 S:'PSGS0Y&((PSGS0XT)="D")&(X["@") PSGS0Y=$P(X,"@",2)
"RTN","PSGS0",36,0)
 .S PSGS0Y=$P(PSGS0Y," ")
"RTN","PSGS0",37,0)
 N TMPSCHX S TMPSCHX=X I $L(X,"@")<3 S TMPX=X D DW I $G(X)]"" K PSJNSS S (PSGS0XT,XT)="D" D  G Q
"RTN","PSGS0",38,0)
 .S Y=$S(($G(TMPSCHX)["@"):$P(TMPSCHX,"@",2),1:"")
"RTN","PSGS0",39,0)
 .I Y,(X'["@"),(TMPSCHX["@") S X=TMPSCHX
"RTN","PSGS0",40,0)
 S X=TMPSCHX
"RTN","PSGS0",41,0)
 I X'="" I $D(^PS(51.1,"AC","PSJ",X)) K PSJNSS G Q
"RTN","PSGS0",42,0)
 ;
"RTN","PSGS0",43,0)
NS I ($G(X)="^")!($G(X)="") K X S Y="" Q
"RTN","PSGS0",44,0)
 N NS S NS=0,PSJNSS=0
"RTN","PSGS0",45,0)
 I $G(Y)'>0 S X=X0,Y="",NS=1,PSJNSS=1
"RTN","PSGS0",46,0)
Q ;
"RTN","PSGS0",47,0)
 S PSGS0XT=$S(XT]"":XT,1:$G(PSGS0XT)),PSGS0Y=$S($G(Y):Y,$G(PSGS0Y):PSGS0Y,1:"") S:PSGS0XT<0 PSGS0XT=""
"RTN","PSGS0",48,0)
 I ('$G(PSGS0Y)&'$G(PSJDIC2)&$G(PSGAT))&'$G(PSJNEWOE)&$G(PSGS0XT) I PSGS0XT<1441 I ($L($G(PSGAT),"-")=PSGS0XT/1440)!($G(X)]""&($G(PSGSCH)=$G(X))) S PSGS0Y=$G(PSGAT)
"RTN","PSGS0",49,0)
Q2 K YY
"RTN","PSGS0",50,0)
 I '$G(PSJNSS),'$G(PSGS0Y),$G(YY) S PSGS0Y=YY
"RTN","PSGS0",51,0)
 I $G(X)]"",$$SCHREQ^PSJLIVFD(.P) D
"RTN","PSGS0",52,0)
 .I $$DOW^PSIVUTL(X)!$$PRNOK(X)!$D(^PS(51.1,"AC","PSJ",X)) S PSJNSS=0 Q
"RTN","PSGS0",53,0)
 .I $G(P(2))&$G(P(3)) D NSSCONT(X,PSGS0XT) S TMPX="" K X
"RTN","PSGS0",54,0)
 I ($G(PSJNSS)&($G(VALMBCK)'="Q"))!($G(PSJNSS)&$G(PSJLIFNI))!($G(PSJNSS)&$G(PSJTUD)) D
"RTN","PSGS0",55,0)
 .I $G(P(2))&$G(P(3)) Q
"RTN","PSGS0",56,0)
 .I ($G(X)]"") I ($G(PSGS0XT)'="D") D NSSCONT(X,PSGS0XT) S TMPX="" K X
"RTN","PSGS0",57,0)
Q3 I $G(X)]"" I $D(^PS(51.1,"AC","PSJ",X)) K PSJNSS
"RTN","PSGS0",58,0)
 K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSGS0",59,0)
 ;
"RTN","PSGS0",60,0)
NSSCONT(SCH,FREQ) ;
"RTN","PSGS0",61,0)
 Q:SCH=""!($G(VALMBCK)]"")!$G(PSGMARSD)!$G(PSIVFN1)
"RTN","PSGS0",62,0)
 I $G(PSGOES),'$G(NSFF) Q
"RTN","PSGS0",63,0)
 N PSGS0XT,PSGSCH,DIR,X,Y S PSGSCH=SCH,PSGS0XT=FREQ,PSJNSS=1
"RTN","PSGS0",64,0)
 D NSSMSG I ($L(PSJNSS)>2),'$G(PSJXI) W !!,PSJNSS,! S PSJNSS=1
"RTN","PSGS0",65,0)
 S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSGS0",66,0)
 K NSFF Q
"RTN","PSGS0",67,0)
 ;
"RTN","PSGS0",68,0)
NSSMSG ;
"RTN","PSGS0",69,0)
 Q:$G(PSJXI)
"RTN","PSGS0",70,0)
 I '(",O,"[(","_$G(PSGST)_",")),$G(PSJNSS),$G(PSGSCH)]"" D
"RTN","PSGS0",71,0)
 .S PSJNSS=" WARNING - "_PSGSCH_" is an invalid schedule."
"RTN","PSGS0",72,0)
 S PSGSCH="",PSGS0XT=""
"RTN","PSGS0",73,0)
 Q
"RTN","PSGS0",74,0)
 ;
"RTN","PSGS0",75,0)
NSO(FQ) ;
"RTN","PSGS0",76,0)
 Q:'FQ!(FQ<0)!(",D,O,"[(","_$G(PSGST)_",")) ""
"RTN","PSGS0",77,0)
 K FRQOUT S FRQOUT=$S(FQ<60:(FQ_"minute"),(FQ<1440)&(FQ#60):(FQ_" minute"),(FQ<1440)!(FQ#1440):(FQ/60_" hour"),1:(FQ/1440_" day")) D
"RTN","PSGS0",78,0)
 . S:(+FRQOUT'=1) FRQOUT=FRQOUT_"s"
"RTN","PSGS0",79,0)
 Q FRQOUT
"RTN","PSGS0",80,0)
 ;
"RTN","PSGS0",81,0)
ENCHK ;
"RTN","PSGS0",82,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSGS0",83,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSGS0",84,0)
 S X(1)=$L(X(1)) I X'["-"&((X>$E(2400,1,X(1))!($E(X,3,4)>59))) K X Q
"RTN","PSGS0",85,0)
 F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$E(2400,1,X(1)):1,$E(X(3),3,4)>59:1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSGS0",86,0)
 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSGS0",87,0)
 ;
"RTN","PSGS0",88,0)
DIC ;
"RTN","PSGS0",89,0)
 K Y0,PSJXI N Y
"RTN","PSGS0",90,0)
 S Z=0 F PSJXI=0:1 S Z=$O(^PS(51.1,"AC","PSJ",X,Z)) Q:'Z
"RTN","PSGS0",91,0)
 I $G(X)]"",'$G(PSJSLUP) D
"RTN","PSGS0",92,0)
 .I $D(^PS(51.1,"AC","PSJ",X)) D  Q:$G(PSGS0Y)&($G(PSGS0XT)]"")
"RTN","PSGS0",93,0)
 ..I $$DOW^PSIVUTL(X) S PSGS0XT="D",PSJNSS=0 S:X["@" (Y0,PSGS0Y)=$P(X,"@",2) Q
"RTN","PSGS0",94,0)
 ..I $G(NSFF) S Y0=$S($G(PSGS0Y):PSGS0Y,$G(PSGAT)&'$G(PSJNEWOE):PSGAT,1:"") S:Y0 PSGS0Y=Y0
"RTN","PSGS0",95,0)
 .; Check for duplicate schedules - force selection
"RTN","PSGS0",96,0)
 .Q:PSJXI>1&('$G(PSGOES))&($G(PSGS0XT)]"")
"RTN","PSGS0",97,0)
 .I $D(^PS(51.1,"AC","PSJ",X)) N FREQ,ADMATCH S FREQ=PSGS0XT D
"RTN","PSGS0",98,0)
 ..N PSGS0XT,PSGS0Y,PSGST,PSGS0XT D ADMIN^PSJORPOE S:$G(PSGS0XT) XT=PSGS0XT S:$G(PSGS0Y) (Y0,Y)=PSGS0Y
"RTN","PSGS0",99,0)
 .S:$G(XT)]"" PSGS0XT=XT S:$G(Y) PSGS0Y=Y
"RTN","PSGS0",100,0)
 .I $$DOW^PSIVUTL(X) S:PSGS0XT="" (XT,PSGS0XT)="D" S:PSGS0Y="" (Y0,PSGS0Y)=$S($P(X,"@",2):$P(X,"@",2),1:"")
"RTN","PSGS0",101,0)
 I $G(PSJLIFNI)!($G(P(4))]""&($G(P(2))]"")) I '$D(^PS(51.1,"AC","PSJ",X))!($G(PSJXI)>1) S PSJSLUP=1
"RTN","PSGS0",102,0)
 I $G(NSFF),$G(PSJXI)>1 D
"RTN","PSGS0",103,0)
 .I $G(PSGS0XT)="",$G(NSFF),$G(PSGXT)]"" S PSGS0XT=PSGXT Q
"RTN","PSGS0",104,0)
 .I $G(PSGS0XT)=""!($G(PSGS0Y)="") S PSJSLUP=1
"RTN","PSGS0",105,0)
 I '$G(PSJSLUP) Q:$G(PSGS0XT)]""&($G(PSGS0Y)]"")  Q:($G(PSGS0XT)="D"&('$D(^PS(51.1,"AC","PSJ",X))))
"RTN","PSGS0",106,0)
 Q:$G(PSGOES)=2
"RTN","PSGS0",107,0)
 K PSJSLUP
"RTN","PSGS0",108,0)
 ;
"RTN","PSGS0",109,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSGOES))_"ISZ",DIC("W")="W ""  "","_$S('$D(PSJPWD):"$P(^(0),""^"",2)",'PSJPWD:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ"
"RTN","PSGS0",110,0)
 I $D(PSGST) ;S DIC("S")="I $P(^(0),""^"",5)"_$E("'",PSGST'="O")_"=""O"""
"RTN","PSGS0",111,0)
 S PSJDIC2=1
"RTN","PSGS0",112,0)
 D IX^DIC K DIC S:$D(DIE)#2 DIC=DIE I Y'>0 D  Q
"RTN","PSGS0",113,0)
 .I '$$DOW^PSIVUTL(X),'$$PRNOK(X) S X="",PSJNSS=1,XT="",PSJXI=""
"RTN","PSGS0",114,0)
 S XT=$S("C"[$P(Y(0),"^",5):$P(Y(0),"^",3),1:$P(Y(0),"^",5))
"RTN","PSGS0",115,0)
 S X=+Y,Y="" I $D(PSJPWD),$D(^PS(51.1,+X,1,+PSJPWD,0)) S Y=$P(^(0),"^",2)
"RTN","PSGS0",116,0)
 S (X,X0)=Y(0,0) S:$G(Y)="" Y=$P(Y(0),"^",2)
"RTN","PSGS0",117,0)
 S (PSGS0Y,Y0)=$G(Y),Y0(0)=Y(0) I $P(Y(0),"^",3) S XT=$P(Y(0),"^",3)
"RTN","PSGS0",118,0)
 I $G(PSGS0XT)="",$$DOW^PSIVUTL(X) S (XT,PSGS0XT)="D"
"RTN","PSGS0",119,0)
 Q
"RTN","PSGS0",120,0)
 ;
"RTN","PSGS0",121,0)
DW ;
"RTN","PSGS0",122,0)
 N Y
"RTN","PSGS0",123,0)
 Q:($L(X,"@")>2)
"RTN","PSGS0",124,0)
 N AT I X["@" S AT=$P(X,"@",2)
"RTN","PSGS0",125,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) N XABB S XABB=""
"RTN","PSGS0",126,0)
 I X]"" D ENCHK Q:'$D(X)
"RTN","PSGS0",127,0)
 S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-"  ;F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSGS0",128,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSGS0",129,0)
 I $D(X) F II=1:1:$L(X,X(1)) S XABB=$G(XABB)_$E($P(X,X(1),II),1,2)_"-"
"RTN","PSGS0",130,0)
 K X(1) S:$D(X) X=SDW I $G(X)]"" I $TR(XABB,"-")]"" S X=$E($G(XABB),1,$L(XABB)-1)
"RTN","PSGS0",131,0)
 I $G(AT) S PSGS0Y=AT
"RTN","PSGS0",132,0)
 Q
"RTN","PSGS0",133,0)
DWC I $L(Z)<2 K X Q
"RTN","PSGS0",134,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSGS0",135,0)
 E  K X
"RTN","PSGS0",136,0)
 Q
"RTN","PSGS0",137,0)
 ;
"RTN","PSGS0",138,0)
PRNOK(PSCH) ;
"RTN","PSGS0",139,0)
 Q:PSCH'["PRN" 0
"RTN","PSGS0",140,0)
 I $TR(PSCH," ")="PRN" Q 1
"RTN","PSGS0",141,0)
 N BASE,I,OK S OK=0 S I=$P(PSCH," PRN") I I]"",$D(^PS(51.1,"AC","PSJ",I)) S OK=1
"RTN","PSGS0",142,0)
 I 'OK D
"RTN","PSGS0",143,0)
 .I PSCH["@" I $D(^PS(51.1,"AC","PSJ",$P(PSCH,"@")))!$$DOW^PSIVUTL($P(PSCH,"@")) S OK=1 Q
"RTN","PSGS0",144,0)
 .I $$DOW^PSIVUTL($P(PSCH," PRN")) S OK=1
"RTN","PSGS0",145,0)
 Q OK
"RTN","PSGS0",146,0)
ODD(PSF) ;determine if this is an odd schedule
"RTN","PSGS0",147,0)
 I PSF>1439,PSF#1440 Q 1
"RTN","PSGS0",148,0)
 I PSF,PSF<1440,1440#PSF Q 1
"RTN","PSGS0",149,0)
 Q 0
"RTN","PSIVSP")
0^3^B34275860
"RTN","PSIVSP",1,0)
PSIVSP ;BIR/RGY,PR,CML3-DOSE PROCESSOR ;09 Feb 99 / 12:30 PM
"RTN","PSIVSP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**30,37,41,50,56,74,83,111,133,138**;16 DEC 97
"RTN","PSIVSP",3,0)
 ;
"RTN","PSIVSP",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSIVSP",5,0)
 ;
"RTN","PSIVSP",6,0)
EN ;
"RTN","PSIVSP",7,0)
 Q:'$D(X)
"RTN","PSIVSP",8,0)
 ;/S (PSIVAT,PSIVWAT,Y)="",XT=-1,X0=X,X=$S(X="ON CALL":X,X["ONE ":X,1:$P(X," "))
"RTN","PSIVSP",9,0)
 S ATZERO=0 I X["@",$P(X,"@",2)=0 S ATZERO=1,X=$P(X,"@")
"RTN","PSIVSP",10,0)
 D EN^PSGS0 S (P(9),PSIVSC1)=$S($G(X)]"":X,1:$G(P(9))),P(11)=$S($G(PSGS0Y):PSGS0Y,1:$G(P(11))),(XT,P(15))=$S(($G(PSGS0XT)!($G(PSGS0XT)="O")!($G(PSGS0XT)="D")):$G(PSGS0XT),1:$G(P(15)))
"RTN","PSIVSP",11,0)
 I $G(ATZERO) S P(7)=1
"RTN","PSIVSP",12,0)
 K ATZERO Q
"RTN","PSIVSP",13,0)
EN1 ;
"RTN","PSIVSP",14,0)
 S (PSIVAT,PSIVWAT,Y)="",XT=-1,X0=X,X=$S(X="ON CALL":X,X="ONCALL":X,X="ON-CALL":X,X="ONETIME":X,X="ONE-TIME":X,X="ONE TIME":X,X="1TIME":X,X="1 TIME":X,X="1-TIME":X,$L(X," ")<3:$P(X," "),1:$P(X," ",1,2))
"RTN","PSIVSP",15,0)
 S:$E(X)="^" X=$E(X,2,999) G:X="" Q S:X["@0" ATZERO=1 S X=$S(X["@0":$P(X,"@"),1:X),P(7)=$S($D(ATZERO):1,1:"") K ATZERO
"RTN","PSIVSP",16,0)
 ;;I X0["@",$P(X0,"@",2)'=0 K X Q
"RTN","PSIVSP",17,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC I Y'<0 G SH
"RTN","PSIVSP",18,0)
 ;;I $S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE-TIME":1,X="ONE TIME":1,1:0) S XT=0,Y(0)=X G SH
"RTN","PSIVSP",19,0)
NS0 S Y=""
"RTN","PSIVSP",20,0)
 I $E(X,1,2)="AD" S XT=-1 Q
"RTN","PSIVSP",21,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S XT=1440\$F("BTQ",$E(X))
"RTN","PSIVSP",22,0)
 E  S:$E(X)="Q" X=$E(X,2,99) S:'X X=$E(X)["O"+1_X S I=+X,X=$P(X,I,2),XT=I*$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:0),X=X0 D 
"RTN","PSIVSP",23,0)
 . I 'XT,X'="NOW",X'="STAT",X'="ONCE",X'="ONE-TIME",X'="ONE TIME",X'="ONETIME",X'="1-TIME",X'="1 TIME",X'="1TIME",Y="" S XT=-1
"RTN","PSIVSP",24,0)
SH ;
"RTN","PSIVSP",25,0)
 I +Y<1,$E(X0)'="^" W:$G(ON)'["P" "  ",$S(XT=0&($S("^NOW^STAT^ONCE^ONE-TIME^ONETIME^1TIME^1-TIME^"[(U_$P(X," ")_U):1,X["1 TIME":1,1:X["ONE TIME")):"(ONCE ONLY)",XT>0:"Nonstandard schedule",XT<0:"",1:"(??)") W:XT>0 " (",XT," MINUTES)"
"RTN","PSIVSP",26,0)
Q Q:X="ONE TIME"
"RTN","PSIVSP",27,0)
 N I S X0=$P(X," ")_$S($L(X0," ")-1:" ",1:"")_$P(X0," ",2,99) K:XT<0!($L(X0)>22) X S:$D(X) X=X0 K X0 S:$G(P(7)) XT="" Q
"RTN","PSIVSP",28,0)
 ;N I S X0=$P(X," ")_$S($L(X0," ")-1:" ",1:"")_$P(X," ",2,99) K:XT<0!($L(X0)>22) X S:$D(X) X=X0 K X0 S:$G(P(7)) XT="" Q
"RTN","PSIVSP",29,0)
 ;S X0=X K:XT<0!($L(X0)>22) X S:$D(X) X=X0 K X0 S:$G(P(7)) XT="" Q
"RTN","PSIVSP",30,0)
NEWQ ;N I S X0=$P(X," ")_$S($L(X0," ")-1:" ",1:"")_$P(X0," ",2,99) K:XT<0!($L(X0)>22) X S:$D(X) X=X0 S:P(7) X=X0 K X0 K:XT>0&('P(7)) X Q
"RTN","PSIVSP",31,0)
 Q
"RTN","PSIVSP",32,0)
 ;
"RTN","PSIVSP",33,0)
ENDL W "   Dose limit ....  " S PSIVMIN=P(15)*X,PSIVSD=+P(2)
"RTN","PSIVSP",34,0)
 I PSIVMIN<0 W !!," --- There is something wrong with this order !!",!,"     Call inpatient supervisor ....." S Y=-1 K PSIVMIN Q
"RTN","PSIVSP",35,0)
 I P(4)="P"!(P(5))!(P(23)="P"),PSIVMIN=0,"^NOW^STAT^ONCE^ONE-TIME^ONE TIME^ON CALL^ONETIME^1TIME^1 TIME^1-TIME^"'[(U_P(9)_U) D DLP G QDL
"RTN","PSIVSP",36,0)
 D ENT^PSIVWL
"RTN","PSIVSP",37,0)
QDL I $D(X) S X=Y X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2) S Y=X
"RTN","PSIVSP",38,0)
 Q
"RTN","PSIVSP",39,0)
DLP ;
"RTN","PSIVSP",40,0)
 S X=X+1,$P(PSIVSD,".",2)=$P(PSIVSD,".",2)_$E("0000",1,4-$L($P(PSIVSD,".",2))) D CHK S X2=0,Y=1 I X<2 S Y=+PSIVSD G QDLP
"RTN","PSIVSP",41,0)
 I $P(PSIVSD,".",2)>$P(P(11),"-",$L(P(11),"-")) S X2=1 G OV
"RTN","PSIVSP",42,0)
 G:$P(P(11),"-")>$P(PSIVSD,".",2) OV
"RTN","PSIVSP",43,0)
 F Y=1:1 S X1=$P(P(11),"-",Y) I X1=$P(PSIVSD,".",2)!($P(PSIVSD,".",2)<X1) Q
"RTN","PSIVSP",44,0)
OV I P(11)="" W $C(7)," ???",!?15,"*** You have not defined any administration times !!" K X Q
"RTN","PSIVSP",45,0)
 F Y=Y:1 S:$P(P(11),"-",Y)="" X2=X2+1,Y=0,X=X+1 S X=X-1 Q:X<1
"RTN","PSIVSP",46,0)
 S X=PSIVSD\1 I X2>0 S X1=PSIVSD D C^%DTC S X=$P(X,".") ; install with version 17.3 of fileman
"RTN","PSIVSP",47,0)
 S Y=+(X_"."_$P(P(11),"-",Y))
"RTN","PSIVSP",48,0)
QDLP K X1,X2 Q
"RTN","PSIVSP",49,0)
 ;
"RTN","PSIVSP",50,0)
ENI ;
"RTN","PSIVSP",51,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X)!'$D(P(4)) Q
"RTN","PSIVSP",52,0)
 I P(4)="P"!(P(5))!(P(23)="P") Q:'X  S X="INFUSE OVER "_X_" MIN." W "   ",X Q
"RTN","PSIVSP",53,0)
 I X'=+X,($P(X,"@",2,999)'=+$P(X,"@",2,999)!(+$P(X,"@",2,999)<0)) K X Q
"RTN","PSIVSP",54,0)
 S SPSOL=$O(DRG("SOL",0)) I 'SPSOL K SPSOL,X W "  You must define at least one solution !!" Q
"RTN","PSIVSP",55,0)
 I X=+X S X=X_" ml/hr" W " ml/hr" D SPSOL S P(15)=$S('X:0,1:SPSOL\X*60+(SPSOL#X/X*60+.5)\1) K SPSOL Q
"RTN","PSIVSP",56,0)
 S SPSOL=$P(X,"@",2) S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr" W "   ",+SPSOL," Label",$S(SPSOL'=1:"s",1:"")," per day",!?15,"at an infusion rate of: ",$P(X,"@") S P(15)=$S('SPSOL:0,1:1440/SPSOL\1) K SPSOL
"RTN","PSIVSP",57,0)
 Q
"RTN","PSIVSP",58,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(DRG("SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(DRG("SOL",XXX),U,3)
"RTN","PSIVSP",59,0)
 K XXX Q
"RTN","PSIVSP",60,0)
CHK F Y=1:1 Q:$L(P(11))>240!($P(P(11),"-",Y)="")  S $P(P(11),"-",Y)=$P(P(11),"-",Y)_$E("0000",1,4-$L($P(P(11),"-",Y)))
"RTN","PSIVSP",61,0)
 Q
"RTN","PSIVSP",62,0)
 ;
"RTN","PSIVSP",63,0)
DIC ; 51.1 look-up
"RTN","PSIVSP",64,0)
 N PSJSCH S PSJSCH=X I '$D(WSCHADM) N VAIP D IN5^VADPT S WSCHADM=VAIP(5),X=PSJSCH
"RTN","PSIVSP",65,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(NOECH))_"ISZ"
"RTN","PSIVSP",66,0)
 S DIC("W")="W ""  "","_$S('$D(WSCHADM):"$P(^(0),""^"",2)",'+WSCHADM:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+WSCHADM,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ" S:$D(PSIVSPQF) DIC(0)=DIC(0)_"O"
"RTN","PSIVSP",67,0)
 D IX^DIC K DIC
"RTN","PSIVSP",68,0)
 S:$D(DIE)#2 DIC=DIE Q:Y<0
"RTN","PSIVSP",69,0)
 S X=Y(0,0),ZZY=Y,(XT,Y)="" I $D(WSCHADM),$D(^PS(51.1,+ZZY,1,+WSCHADM,0)),$P(^(0),"^",2)]"" S (PSIVWAT,Y)=$P(^(0),"^",2)
"RTN","PSIVSP",70,0)
 K ZZY,WSCHADM S:Y="" (X,PSIVSC1)=$P(Y(0),U),(PSIVAT,Y)=$P(Y(0),"^",2) S XT=$P(Y(0),"^",3) Q
"RTN","PSIVSP",71,0)
 ;
"RTN","PSIVSP",72,0)
ORINF ;  OERR input transform for Infusion Rate
"RTN","PSIVSP",73,0)
 ;  X=data
"RTN","PSIVSP",74,0)
 N INFUSE
"RTN","PSIVSP",75,0)
 K:$L(X)<1!($L(X)>30)!(X["""")!($A(X)=45) X I '$D(X) Q
"RTN","PSIVSP",76,0)
 I X?.E1L.E S INFUSE=$$ENLU^PSGMI(X) Q:(INFUSE="TITRATE")!(INFUSE="BOLUS")
"RTN","PSIVSP",77,0)
 Q:(X="TITRATE")!(X="BOLUS")
"RTN","PSIVSP",78,0)
 I X["=" D  Q   ; NOIS LOU-0501-42191
"RTN","PSIVSP",79,0)
 .N X2,X1 S X1=$P(X,"="),X2=$P(X,"=",2)
"RTN","PSIVSP",80,0)
 .I X1["ML/HR",(+X1=$P(X1,"ML/HR"))!(+X1=$P(X1," ML/HR")) D
"RTN","PSIVSP",81,0)
 ..S X1=$TR(X1,"ML/HR","ml/hr")
"RTN","PSIVSP",82,0)
 .I X2["ML/HR",(+X2=$P(X2,"ML/HR"))!(+X2=$P(X2," ML/HR")) D
"RTN","PSIVSP",83,0)
 ..S X2=$TR(X2,"ML/HR","ml/hr")
"RTN","PSIVSP",84,0)
 .I X1[" ml/hr",(+X1=$P(X1," ml/hr")) D
"RTN","PSIVSP",85,0)
 ..S X1=$P(X1," ml/hr")_$P(X1," ml/hr",2,9999)
"RTN","PSIVSP",86,0)
 .I X2[" ml/hr",(+X2=$P(X2," ml/hr")) D
"RTN","PSIVSP",87,0)
 ..S X2=$P(X2," ml/hr")_$P(X2," ml/hr",2,9999)
"RTN","PSIVSP",88,0)
 .I X1["ml/hr",(+X1=$P(X1,"ml/hr")) D
"RTN","PSIVSP",89,0)
 ..S X1=$P(X1,"ml/hr")_$P(X1,"ml/hr",2,9999)
"RTN","PSIVSP",90,0)
 .I X2["ml/hr",(+X2=$P(X2,"ml/hr")) D
"RTN","PSIVSP",91,0)
 ..S X2=$P(X2,"ml/hr")_$P(X2,"ml/hr",2,9999)
"RTN","PSIVSP",92,0)
 .I X2'=+X2 D
"RTN","PSIVSP",93,0)
 ..I ($P(X2,"@",2,999)'=+$P(X2,"@",2,999)!(+$P(X2,"@",2,999)<0)) K X Q
"RTN","PSIVSP",94,0)
 .I X1=+X1 S X1=X1_" ml/hr"
"RTN","PSIVSP",95,0)
 .I X2=+X2 S X2=X2_" ml/hr"
"RTN","PSIVSP",96,0)
 .S:$P(X2,"@")=+X2 $P(X2,"@")=$P(X2,"@")_" ml/hr"
"RTN","PSIVSP",97,0)
 .S X=X1_"="_X2
"RTN","PSIVSP",98,0)
 I X["ML/HR",(+X=$P(X,"ML/HR"))!(+X=$P(X," ML/HR")) S X=$TR(X,"ML/HR","ml/hr")
"RTN","PSIVSP",99,0)
 I X[" ml/hr",+X=$P(X," ml/hr") S X=$P(X," ml/hr")_$P(X," ml/hr",2,9999)
"RTN","PSIVSP",100,0)
 I X["ml/hr",+X=$P(X,"ml/hr") S X=$P(X,"ml/hr")_$P(X,"ml/hr",2,9999)
"RTN","PSIVSP",101,0)
 I X'=+X,($P(X,"@",2,999)'=+$P(X,"@",2,999)!(+$P(X,"@",2,999)<0)) K X Q
"RTN","PSIVSP",102,0)
 I X=+X S X=X_" ml/hr" Q
"RTN","PSIVSP",103,0)
 S:$P(X,"@")=+X $P(X,"@")=$P(X,"@")_" ml/hr"
"RTN","PSIVSP",104,0)
 Q
"VER")
8.0^22.0
"BLD",5285,6)
^142
**END**
**END**
