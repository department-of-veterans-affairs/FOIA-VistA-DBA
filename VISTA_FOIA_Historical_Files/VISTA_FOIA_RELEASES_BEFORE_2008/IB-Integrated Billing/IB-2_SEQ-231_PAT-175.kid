Released IB*2*175 SEQ #231
Extracted from mail message
**KIDS**:IB*2.0*175^

**INSTALL NAME**
IB*2.0*175
"BLD",3157,0)
IB*2.0*175^INTEGRATED BILLING^0^3040213^y
"BLD",3157,1,0)
^9.61A^1^1^3040213^^^
"BLD",3157,1,1,0)
Add Tortiously Liable and Interagency Rates for January 2004.
"BLD",3157,4,0)
^9.64PA^^
"BLD",3157,"ABPKG")
n
"BLD",3157,"INIT")
POST^IBYPPD
"BLD",3157,"KRN",0)
^9.67PA^8989.52^19
"BLD",3157,"KRN",.4,0)
.4
"BLD",3157,"KRN",.401,0)
.401
"BLD",3157,"KRN",.402,0)
.402
"BLD",3157,"KRN",.403,0)
.403
"BLD",3157,"KRN",.5,0)
.5
"BLD",3157,"KRN",.84,0)
.84
"BLD",3157,"KRN",3.6,0)
3.6
"BLD",3157,"KRN",3.8,0)
3.8
"BLD",3157,"KRN",9.2,0)
9.2
"BLD",3157,"KRN",9.8,0)
9.8
"BLD",3157,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",3157,"KRN",9.8,"NM",1,0)
IBCRBG2^^0^B7011356
"BLD",3157,"KRN",9.8,"NM",2,0)
IBCRHU2^^0^B32389256
"BLD",3157,"KRN",9.8,"NM",3,0)
IBYPPD^^0^B6270504
"BLD",3157,"KRN",9.8,"NM",4,0)
IBYPPD1^^0^B27166058
"BLD",3157,"KRN",9.8,"NM",5,0)
IBYPPD2^^0^B30291523
"BLD",3157,"KRN",9.8,"NM","B","IBCRBG2",1)

"BLD",3157,"KRN",9.8,"NM","B","IBCRHU2",2)

"BLD",3157,"KRN",9.8,"NM","B","IBYPPD",3)

"BLD",3157,"KRN",9.8,"NM","B","IBYPPD1",4)

"BLD",3157,"KRN",9.8,"NM","B","IBYPPD2",5)

"BLD",3157,"KRN",19,0)
19
"BLD",3157,"KRN",19.1,0)
19.1
"BLD",3157,"KRN",101,0)
101
"BLD",3157,"KRN",409.61,0)
409.61
"BLD",3157,"KRN",771,0)
771
"BLD",3157,"KRN",870,0)
870
"BLD",3157,"KRN",8989.51,0)
8989.51
"BLD",3157,"KRN",8989.52,0)
8989.52
"BLD",3157,"KRN",8994,0)
8994
"BLD",3157,"KRN","B",.4,.4)

"BLD",3157,"KRN","B",.401,.401)

"BLD",3157,"KRN","B",.402,.402)

"BLD",3157,"KRN","B",.403,.403)

"BLD",3157,"KRN","B",.5,.5)

"BLD",3157,"KRN","B",.84,.84)

"BLD",3157,"KRN","B",3.6,3.6)

"BLD",3157,"KRN","B",3.8,3.8)

"BLD",3157,"KRN","B",9.2,9.2)

"BLD",3157,"KRN","B",9.8,9.8)

"BLD",3157,"KRN","B",19,19)

"BLD",3157,"KRN","B",19.1,19.1)

"BLD",3157,"KRN","B",101,101)

"BLD",3157,"KRN","B",409.61,409.61)

"BLD",3157,"KRN","B",771,771)

"BLD",3157,"KRN","B",870,870)

"BLD",3157,"KRN","B",8989.51,8989.51)

"BLD",3157,"KRN","B",8989.52,8989.52)

"BLD",3157,"KRN","B",8994,8994)

"BLD",3157,"QUES",0)
^9.62^^
"BLD",3157,"REQB",0)
^9.611^1^1
"BLD",3157,"REQB",1,0)
IB*2.0*245^1
"BLD",3157,"REQB","B","IB*2.0*245",1)

"INIT")
POST^IBYPPD
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
175^3040213^10882
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3040213
"PKG",200,22,1,"PAH",1,1,1,0)
Add Tortiously Liable and Interagency Rates for January 2004.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","IBCRBG2")
0^1^B7011356
"RTN","IBCRBG2",1,0)
IBCRBG2 ;ALB/ARH - RATES: BILL SOURCE EVENTS (INPT CONT) ; 01-OCT-03
"RTN","IBCRBG2",2,0)
 ;;2.0;INTEGRATED BILLING;**245,175**;21-MAR-94
"RTN","IBCRBG2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCRBG2",4,0)
 ;
"RTN","IBCRBG2",5,0)
INPTRSET(IBIFN,CS) ; reset Inpatient data due to bedsection Tort 03 and Other Type of Care RC v2.0
"RTN","IBCRBG2",6,0)
 ; (based on INPTPTF since that deals with timeframe and end of bill)
"RTN","IBCRBG2",7,0)
 N IBRC S IBRC=1 I +$G(CS),$E($G(^IBE(363.1,+CS,0)),1,2)'="RC" S IBRC=0
"RTN","IBCRBG2",8,0)
 ;
"RTN","IBCRBG2",9,0)
 D INPTBS(IBIFN,IBRC)
"RTN","IBCRBG2",10,0)
 D INPTOTH(IBIFN,IBRC)
"RTN","IBCRBG2",11,0)
 Q
"RTN","IBCRBG2",12,0)
 ;
"RTN","IBCRBG2",13,0)
INPTBS(IBIFN,RC) ; with output from INPTPTF^IBCRBG, reset bedsections due to changes with Tort 03 and RC
"RTN","IBCRBG2",14,0)
 ; - Some Specialties are changed to PRRTP bedsection (beginning with Tort 03)
"RTN","IBCRBG2",15,0)
 ; - Some Specialties are changed to ICU bedsection for RC only (beginning with RC v2.0)
"RTN","IBCRBG2",16,0)
 ; - Nursing Home Care and Observation bedsections are not billable with RC DRG (per diem) so remove DRG
"RTN","IBCRBG2",17,0)
 ; (based on INPTPTF since that deals with timeframe and end of bill)
"RTN","IBCRBG2",18,0)
 ;
"RTN","IBCRBG2",19,0)
 N IBDT,IBLN,IBSPCLTY,IBNLN,IBNBS,IBNDRG,IBCGTY
"RTN","IBCRBG2",20,0)
 ;
"RTN","IBCRBG2",21,0)
 S IBDT=0 F  S IBDT=$O(^TMP($J,"IBCRC-INDT",IBDT)) Q:'IBDT  D
"RTN","IBCRBG2",22,0)
 . S IBLN=$G(^TMP($J,"IBCRC-INDT",IBDT)) Q:'IBLN
"RTN","IBCRBG2",23,0)
 . S IBSPCLTY=$P(IBLN,U,6) Q:'IBSPCLTY
"RTN","IBCRBG2",24,0)
 . ;
"RTN","IBCRBG2",25,0)
 . S IBNLN=IBLN
"RTN","IBCRBG2",26,0)
 . S IBNBS=$$BSUPD(IBSPCLTY,IBDT,+$G(RC)) I +IBNBS S $P(IBNLN,U,2)=+IBNBS
"RTN","IBCRBG2",27,0)
 . S IBNDRG=$$NODRG(IBSPCLTY) I +IBNDRG S $P(IBNLN,U,4)=""
"RTN","IBCRBG2",28,0)
 . I 'IBNBS,'IBNDRG Q
"RTN","IBCRBG2",29,0)
 . S ^TMP($J,"IBCRC-INDT",IBDT)=IBNLN
"RTN","IBCRBG2",30,0)
 Q
"RTN","IBCRBG2",31,0)
 ; 
"RTN","IBCRBG2",32,0)
INPTOTH(IBIFN,RC) ; with output from INPTPTF^IBCRBG, reset Other type of care and Tort 03 changes
"RTN","IBCRBG2",33,0)
 ; - If type of care is Other then bedsection is replaced and DRG deleted (began with RC v2.0)
"RTN","IBCRBG2",34,0)
 ; (based on INPTPTF since that deals with timeframe and end of bill)
"RTN","IBCRBG2",35,0)
 ;
"RTN","IBCRBG2",36,0)
 N IBOT,IBOTLN,IBBS,IBDT1,IBDT2,IBDT,IBLN,IBNLN Q:'$G(RC)
"RTN","IBCRBG2",37,0)
 I +$G(IBIFN) S IBOT=0 F  S IBOT=$O(^DGCR(399,IBIFN,"OT",IBOT)) Q:'IBOT  D
"RTN","IBCRBG2",38,0)
 . S IBOTLN=$G(^DGCR(399,IBIFN,"OT",IBOT,0)) Q:'IBOTLN
"RTN","IBCRBG2",39,0)
 . S IBDT1=+$P(IBOTLN,U,2) Q:'IBDT1  S IBDT2=+$P(IBOTLN,U,3) Q:'IBDT2
"RTN","IBCRBG2",40,0)
 . S IBBS=+IBOTLN Q:'IBOTLN
"RTN","IBCRBG2",41,0)
 . ;
"RTN","IBCRBG2",42,0)
 . S IBDT=IBDT1-.1 F  S IBDT=$O(^TMP($J,"IBCRC-INDT",IBDT)) Q:('IBDT)!(IBDT'<IBDT2)  D
"RTN","IBCRBG2",43,0)
 .. S IBLN=$G(^TMP($J,"IBCRC-INDT",IBDT)) Q:'IBLN
"RTN","IBCRBG2",44,0)
 .. I IBDT<$$RC20 Q
"RTN","IBCRBG2",45,0)
 .. ;
"RTN","IBCRBG2",46,0)
 .. S IBNLN=IBLN
"RTN","IBCRBG2",47,0)
 .. S $P(IBNLN,U,2)=+IBBS,$P(IBNLN,U,4)=""
"RTN","IBCRBG2",48,0)
 .. S ^TMP($J,"IBCRC-INDT",IBDT)=IBNLN
"RTN","IBCRBG2",49,0)
 Q
"RTN","IBCRBG2",50,0)
 ;
"RTN","IBCRBG2",51,0)
 ;
"RTN","IBCRBG2",52,0)
BSUPD(SPCLTY,DATE,RC) ; return updated bedsection name for specialty passed in (42.4 ifn)
"RTN","IBCRBG2",53,0)
 ; beginning with TORT 2003 some specialties were moved to new PRRTP bedsection
"RTN","IBCRBG2",54,0)
 ; beginning with RC v2.0 some specialties were moved to a new ICU bedsection, only applies to RC charges
"RTN","IBCRBG2",55,0)
 N IBX,IBY,IBZ S (IBZ,IBX)="",SPCLTY=","_+$G(SPCLTY)_",",DATE=$S(+$G(DATE):(DATE\1),1:DT)
"RTN","IBCRBG2",56,0)
 I DATE'<$$TORT03,",25,26,27,28,29,38,39,"[SPCLTY S IBX="PRRTP"
"RTN","IBCRBG2",57,0)
 I +$G(RC),DATE'<$$RC20,",12,16,17,63,"[SPCLTY S IBX="ICU"
"RTN","IBCRBG2",58,0)
 I IBX'="" S IBY=$O(^DGCR(399.1,"B",IBX,0)) I +IBY S IBZ=IBY_U_IBX
"RTN","IBCRBG2",59,0)
 Q IBZ
"RTN","IBCRBG2",60,0)
 ;
"RTN","IBCRBG2",61,0)
TORT03() ; return effective date of TORT 2003, date when PRRTP bedsection specialties changed
"RTN","IBCRBG2",62,0)
 Q 3040107
"RTN","IBCRBG2",63,0)
 ;
"RTN","IBCRBG2",64,0)
RC20() ; return effective date of RC v2.0, date when ICU bedsection specialties changed
"RTN","IBCRBG2",65,0)
 Q 3031219
"RTN","IBCRBG2",66,0)
 ;
"RTN","IBCRBG2",67,0)
NODRG(SPCLTY) ; return specialty ifn followed by bedsection name if the specialty should not be charged a DRG charge
"RTN","IBCRBG2",68,0)
 N IBX,IBS S IBX=0,IBS=","_+$G(SPCLTY)_","
"RTN","IBCRBG2",69,0)
 I ",80,81,96,"[IBS S IBX=+SPCLTY_"^Nursing Home Care"
"RTN","IBCRBG2",70,0)
 I ",18,23,24,36,41,65,94,"[IBS S IBX=+SPCLTY_"^Observation"
"RTN","IBCRBG2",71,0)
 Q IBX
"RTN","IBCRHU2")
0^2^B32389256
"RTN","IBCRHU2",1,0)
IBCRHU2 ;ALB/ARH - RATES: UPLOAD UTILITIES (ADD CM ELEMENTS) ; 10-OCT-1998
"RTN","IBCRHU2",2,0)
 ;;2.0;INTEGRATED BILLING;**106,138,245,175**;21-MAR-94
"RTN","IBCRHU2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCRHU2",4,0)
 ;
"RTN","IBCRHU2",5,0)
RG(NAME,DIV,ID,TY) ; add a new Billing Region for Reasonable Charges (363.31), input region name, MC division site #
"RTN","IBCRHU2",6,0)
 ; returns IFN of billing region (new or existing) ^ region name, null otherwise
"RTN","IBCRHU2",7,0)
 ; the division number surrounded by spaces is expected in the name for any match to be made
"RTN","IBCRHU2",8,0)
 N IBA,IBDV,IBFN,IBNEW,IBX,DD,DO,DLAYGO,DIC,DIE,DA,DR,X,Y S DIV=$G(DIV),IBDV="",(IBFN,IBNEW)=0
"RTN","IBCRHU2",9,0)
 I $G(NAME)="" G RGQ
"RTN","IBCRHU2",10,0)
 I NAME[" (DIV)" S NAME=$P(NAME," (DIV)",1)_$P(NAME," (DIV)",2)
"RTN","IBCRHU2",11,0)
 I NAME[" (2)" S NAME=$P(NAME," (2)",1)_$P(NAME," (2)",2)
"RTN","IBCRHU2",12,0)
 I NAME[" (3)" S NAME=$P(NAME," (2)",1)_$P(NAME," (3)",2)
"RTN","IBCRHU2",13,0)
 ;
"RTN","IBCRHU2",14,0)
 S IBX="" F  S IBX=$O(^IBE(363.31,"B",IBX)) Q:IBX=""  I IBX[(" "_DIV_" ") S IBFN=$O(^IBE(363.31,"B",IBX,0)) Q
"RTN","IBCRHU2",15,0)
 I +IBFN S IBFN=IBFN_U_$E(IBX,1,30),IBNEW=0 G RGQ
"RTN","IBCRHU2",16,0)
 ;
"RTN","IBCRHU2",17,0)
 S IBDV=$$DIV(DIV) I 'IBDV D MSG("     *** Warning: No MC division "_DIV_" defined, no division added to Region")
"RTN","IBCRHU2",18,0)
 ;
"RTN","IBCRHU2",19,0)
 I $G(ID)'="" S DIC("DR")=".02////"_$E(ID,1,10)_";"
"RTN","IBCRHU2",20,0)
 I $G(TY)'="" S DIC("DR")=DIC("DR")_".03////"_$E(TY,1,10)
"RTN","IBCRHU2",21,0)
 K DD,DO S DLAYGO=363.31,DIC="^IBE(363.31,",DIC(0)="L",X=$E(NAME,1,30) D FILE^DICN K DIC I Y<1 K X,Y Q
"RTN","IBCRHU2",22,0)
 S IBFN=Y,IBNEW=1
"RTN","IBCRHU2",23,0)
 ;
"RTN","IBCRHU2",24,0)
 I +IBDV S DLAYGO=363.31,DA(1)=+IBFN,DIC="^IBE(363.31,"_DA(1)_",11,",DIC(0)="L",X=+IBDV,DIC("P")="363.3111P" D ^DIC K DIC,DIE,DLAYGO
"RTN","IBCRHU2",25,0)
 ;
"RTN","IBCRHU2",26,0)
RGQ I +IBNEW!($D(IBA)) S IBA(1)="  >> "_$E(NAME,1,30)_" Billing Region "_$S('$G(IBFN):"NOT ",1:"")_"added "_$S(+IBDV:"for MCD "_$P(IBDV,U,3)_" "_$P(IBDV,U,2),1:"") D MSGP
"RTN","IBCRHU2",27,0)
 Q $G(IBFN)
"RTN","IBCRHU2",28,0)
 ;
"RTN","IBCRHU2",29,0)
CS(NAME,RATE,EVENT,RG,CT,RV,BS) ; add Charge Set for Reasonable Charges (363.1), all input in external form
"RTN","IBCRHU2",30,0)
 ; returns IFN of new charge set, 0 otherwise
"RTN","IBCRHU2",31,0)
 N IBA,IBBR,IBBE,IBRG,IBRV,IBBS,IBCT,IBOK,IBFN,IBCSN,IBJ,DD,DO,DLAYGO,DINUM,DIC,DIE,DA,DR,X,Y,IBFND S IBOK=1
"RTN","IBCRHU2",32,0)
 S NAME=$G(NAME),RATE=$G(RATE),EVENT=$G(EVENT),RG=$G(RG),CT=$G(CT),RV=$G(RV),BS=$G(BS) I NAME=""!(RATE="") G CSQ
"RTN","IBCRHU2",33,0)
 ;
"RTN","IBCRHU2",34,0)
 S IBFND=+$O(^IBE(363.1,"B",$E(NAME,1,30),0)) I +IBFND S IBFN=IBFND,IBCSN=NAME G CSQ
"RTN","IBCRHU2",35,0)
 ;
"RTN","IBCRHU2",36,0)
 S IBBR=$O(^IBE(363.3,"B",RATE,0)) I 'IBBR S IBOK=0 D MSG("     *** Error: "_RATE_" Billing Rate does not exist")
"RTN","IBCRHU2",37,0)
 S IBBE=$$MCCRUTL(EVENT,14) I 'IBBE S IBOK=0 D MSG("     *** Error: "_EVENT_" Billable Event undefined")
"RTN","IBCRHU2",38,0)
 S IBRG="" I RG'="" S IBRG=$O(^IBE(363.31,"B",$E(RG,1,30),0))
"RTN","IBCRHU2",39,0)
 I 'IBRG,RG'="" S IBOK=0 D MSG("     *** Error: "_$E(RG,1,30)_" Billing Region does not exist")
"RTN","IBCRHU2",40,0)
 I '$G(IBOK) G CSQ
"RTN","IBCRHU2",41,0)
 S IBRV=$$RVCD(RV) I 'IBRV D MSG("     *** Warning: No default revenue code added for Charge Set")
"RTN","IBCRHU2",42,0)
 S IBBS=$$MCCRUTL(BS,5) I 'IBBS D MSG("     *** Warning: No default bedsection added for Charge Set")
"RTN","IBCRHU2",43,0)
 S IBCT=$S($E(CT)="I":1,$E(CT)="P":2,1:"")
"RTN","IBCRHU2",44,0)
 ;
"RTN","IBCRHU2",45,0)
 F IBJ=1:1 S IBFN=$G(^IBE(363.1,IBJ,0)) I IBFN="" S DINUM=IBJ Q
"RTN","IBCRHU2",46,0)
 ;
"RTN","IBCRHU2",47,0)
 K DD,DO S DLAYGO=363.1,DIC="^IBE(363.1,",DIC(0)="L",X=$E(NAME,1,30) D FILE^DICN K DIC K DIC,DINUM,DLAYGO I Y<1 K X,Y Q
"RTN","IBCRHU2",48,0)
 S IBFN=+Y,IBCSN=$P(Y,U,2)
"RTN","IBCRHU2",49,0)
 ;
"RTN","IBCRHU2",50,0)
 S DR=".02////"_IBBR_";.03////"_IBBE_";.04////"_IBCT_";.07////"_IBRG
"RTN","IBCRHU2",51,0)
 I +IBRV S DR=DR_";.05////"_IBRV
"RTN","IBCRHU2",52,0)
 I +IBBS S DR=DR_";.06////"_IBBS
"RTN","IBCRHU2",53,0)
 S DIE="^IBE(363.1,",DA=+IBFN D ^DIE K DIE,DA,DR,X,Y
"RTN","IBCRHU2",54,0)
 ;
"RTN","IBCRHU2",55,0)
 ;
"RTN","IBCRHU2",56,0)
CSQ I +$G(IBFN),$G(IBCSN)'="" D RS(IBCSN)
"RTN","IBCRHU2",57,0)
 ;
"RTN","IBCRHU2",58,0)
 S IBA(1)="  >> "_$E(NAME,1,30)_" Charge Set "_$S('$G(IBFN):"NOT ",1:"")_$S(+$G(IBFND):"used",1:"added") D MSGP
"RTN","IBCRHU2",59,0)
 Q +$G(IBFN)
"RTN","IBCRHU2",60,0)
 ;
"RTN","IBCRHU2",61,0)
USECS(CSN) ; return an existing CS for a set of RC charges, given the name to look for, or write an error message
"RTN","IBCRHU2",62,0)
 N IBCS S IBCS=0
"RTN","IBCRHU2",63,0)
 I $G(CSN)'="" S IBCS=$O(^IBE(363.1,"B",$E(CSN,1,30),0))
"RTN","IBCRHU2",64,0)
 I 'IBCS W !,"     *** Warning:  No Charge Set found for these charges"
"RTN","IBCRHU2",65,0)
 I +IBCS W !,"  >> "_$E(CSN,1,30)_" Charge Set used"
"RTN","IBCRHU2",66,0)
 Q IBCS
"RTN","IBCRHU2",67,0)
 ;
"RTN","IBCRHU2",68,0)
MCCRUTL(X,P) ; returns IFN of item in 399.1 if Name is found and piece P is true
"RTN","IBCRHU2",69,0)
 N IBX,IBY S IBY=""
"RTN","IBCRHU2",70,0)
 I $G(X)'="" S IBX=0 F  S IBX=$O(^DGCR(399.1,"B",X,IBX)) Q:'IBX  I $P($G(^DGCR(399.1,IBX,0)),U,+$G(P)) S IBY=IBX
"RTN","IBCRHU2",71,0)
 Q IBY
"RTN","IBCRHU2",72,0)
 ;
"RTN","IBCRHU2",73,0)
RVCD(RVCD) ; check for valid revenue code (#399.2), input either revenue code or revenue code IFN
"RTN","IBCRHU2",74,0)
 ; returns IFN if revenue code is valid and active, null otherwise
"RTN","IBCRHU2",75,0)
 N IBX,IBY S IBY=""
"RTN","IBCRHU2",76,0)
 I +$G(RVCD) S IBX=$G(^DGCR(399.2,+RVCD,0)) I +$P(IBX,U,3) S IBY=+RVCD
"RTN","IBCRHU2",77,0)
 Q IBY
"RTN","IBCRHU2",78,0)
 ;
"RTN","IBCRHU2",79,0)
DIV(DIV) ; check for valid medical center division (#40.8), input facility/site number
"RTN","IBCRHU2",80,0)
 ; returns 'IFN ^ name ^ #' of division if it exists in Medical Center Division file (40.8), 0 otherwise
"RTN","IBCRHU2",81,0)
 N IBX,IBY S IBX=0
"RTN","IBCRHU2",82,0)
 I $G(DIV)'="" S DIV=+$O(^DG(40.8,"C",DIV,0))
"RTN","IBCRHU2",83,0)
 I +$G(DIV) S IBY=$G(^DG(40.8,+DIV,0)) I IBY'="" S IBX=DIV_U_$P(IBY,U,1,2)
"RTN","IBCRHU2",84,0)
 Q IBX
"RTN","IBCRHU2",85,0)
 ;
"RTN","IBCRHU2",86,0)
MSG(X) ; add message to end of message list, reserves IBA(1) for primary message
"RTN","IBCRHU2",87,0)
 N IBX S IBX=$O(IBA(999999),-1) S:'IBX IBX=1 S IBX=IBX+1
"RTN","IBCRHU2",88,0)
 S IBA(IBX)=$G(X)
"RTN","IBCRHU2",89,0)
 Q
"RTN","IBCRHU2",90,0)
MSGP ; print error messages in IBA
"RTN","IBCRHU2",91,0)
 N IBX S IBX="" F  S IBX=$O(IBA(IBX)) Q:'IBX  W !,IBA(IBX)
"RTN","IBCRHU2",92,0)
 Q
"RTN","IBCRHU2",93,0)
 ;
"RTN","IBCRHU2",94,0)
 ;
"RTN","IBCRHU2",95,0)
RS(CSN) ; add new RC Charge Sets to Rate Schedules, input Charge Set Name
"RTN","IBCRHU2",96,0)
 ; finds the RS to add the CS to based on the effective/inactive dates of the RS and version being loaded
"RTN","IBCRHU2",97,0)
 ; for RC 1.x only adds physician to inpt if there was also inpatient facility charges
"RTN","IBCRHU2",98,0)
 ; Tort Feasor began using Reasonable Charges on 01/07/04
"RTN","IBCRHU2",99,0)
 N IBCSFN,IBRSN,IBRS,IBRS0,IBRSLST,IBVBEG,IBVEND,IBVERS,IBAUTO,IBFND,IBSITE,IBI,DINUM,DD,DO,DLAYGO,DIC,DIE,DA,DR,X,Y
"RTN","IBCRHU2",100,0)
 ;
"RTN","IBCRHU2",101,0)
 I $G(CSN)="" Q
"RTN","IBCRHU2",102,0)
 S IBCSFN=$O(^IBE(363.1,"B",$E(CSN,1,30),0)) I 'IBCSFN Q
"RTN","IBCRHU2",103,0)
 S IBAUTO=1 I $P($G(^IBE(363.3,+$P($G(^IBE(363.1,+IBCSFN,0)),U,2),0)),U,4)=9 S IBAUTO=""
"RTN","IBCRHU2",104,0)
 S IBVERS=$$VERSION^IBCRHBRV,IBVBEG=$$VERSDT^IBCRHBRV,IBVEND=$$VERSEDT^IBCRHBRV,IBFND=1
"RTN","IBCRHU2",105,0)
 S IBI=$L(CSN," "),IBSITE=$P(CSN," ",IBI)
"RTN","IBCRHU2",106,0)
 ;
"RTN","IBCRHU2",107,0)
 I IBVERS<2 D
"RTN","IBCRHU2",108,0)
 . I CSN["INPT " S IBRSLST="RI-INPT,NF-INPT,WC-INPT"
"RTN","IBCRHU2",109,0)
 . I CSN["SNF " S IBRSLST="RI-INPT,NF-INPT,WC-INPT"
"RTN","IBCRHU2",110,0)
 . I CSN["OPT " S IBRSLST="RI-OPT,NF-OPT,WC-OPT"
"RTN","IBCRHU2",111,0)
 . I CSN["PHYS" S IBRSLST="RI-OPT,NF-OPT,WC-OPT"
"RTN","IBCRHU2",112,0)
 . I CSN["PHYS",$O(^IBE(363.1,"B","RC-INPT ANC "_IBSITE,0)) S IBRSLST=IBRSLST_",RI-INPT,NF-INPT,WC-INPT"
"RTN","IBCRHU2",113,0)
 ;
"RTN","IBCRHU2",114,0)
 I IBVERS'<2 D
"RTN","IBCRHU2",115,0)
 . I CSN["INPT " S IBRSLST="RI-INPT,NF-INPT,WC-INPT,TF-INPT"
"RTN","IBCRHU2",116,0)
 . I CSN["SNF " S IBRSLST="RI-SNF,NF-SNF,WC-SNF,TF-SNF"
"RTN","IBCRHU2",117,0)
 . I CSN["OPT " S IBRSLST="RI-OPT,NF-OPT,WC-OPT,TF-OPT"
"RTN","IBCRHU2",118,0)
 . I CSN[" FS " S IBRSLST="RI-OPT,NF-OPT,WC-OPT,TF-OPT"
"RTN","IBCRHU2",119,0)
 I $G(IBRSLST)="" Q
"RTN","IBCRHU2",120,0)
 ;
"RTN","IBCRHU2",121,0)
 F IBI=1:1 S IBRSN=$P(IBRSLST,",",IBI) Q:IBRSN=""  D
"RTN","IBCRHU2",122,0)
 . S IBRS=0 F  S IBRS=$O(^IBE(363,"B",IBRSN,IBRS)) Q:'IBRS  D  Q:+IBFND
"RTN","IBCRHU2",123,0)
 .. S IBRS0=$G(^IBE(363,IBRS,0))
"RTN","IBCRHU2",124,0)
 .. I $E(IBRSN,1,3)="TF-",+$P(IBRS0,U,6),$P(IBRS0,U,6)<3040107 S IBFND=0 Q
"RTN","IBCRHU2",125,0)
 .. I +$P(IBRS0,U,6),$P(IBRS0,U,6)<IBVBEG S IBFND=0 Q
"RTN","IBCRHU2",126,0)
 .. I +IBVEND,+$P(IBRS0,U,5),$P(IBRS0,U,5)>IBVEND S IBFND=0 Q
"RTN","IBCRHU2",127,0)
 .. S IBFND=1 I $O(^IBE(363,+IBRS,11,"B",+IBCSFN,0)) Q
"RTN","IBCRHU2",128,0)
 .. I +IBAUTO S DIC("DR")=".02////"_1
"RTN","IBCRHU2",129,0)
 .. S DLAYGO=363,DA(1)=+IBRS,DIC="^IBE(363,"_DA(1)_",11,",DIC(0)="LX",X=CSN,DIC("P")="363.0011P" D ^DIC K DIC,DIE
"RTN","IBCRHU2",130,0)
 Q
"RTN","IBYPPD")
0^3^B6270504
"RTN","IBYPPD",1,0)
IBYPPD ;ALB/ARH - IB*2*175 POST INIT: TORT/INTERAGENCY RATES JAN 2004 ; 03/06/02
"RTN","IBYPPD",2,0)
 ;;2.0;INTEGRATED BILLING;**175**;21-MAR-94
"RTN","IBYPPD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBYPPD",4,0)
 ; 
"RTN","IBYPPD",5,0)
 Q
"RTN","IBYPPD",6,0)
POST ;
"RTN","IBYPPD",7,0)
 N IBA,IBEFFDT
"RTN","IBYPPD",8,0)
 S IBA(1)="",IBA(2)="    IB*2*175 Post-Install .....",IBA(3)="" D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPPD",9,0)
 ;
"RTN","IBYPPD",10,0)
 S IBEFFDT=3040107 ;            effective date of Tort Jan 2004
"RTN","IBYPPD",11,0)
 ;
"RTN","IBYPPD",12,0)
 D ADDBS ;                      add Bedsection for PRRTP
"RTN","IBYPPD",13,0)
 D ADDCI^IBYPPD2(IBEFFDT) ;     add new Tort Liable and Interagency charges
"RTN","IBYPPD",14,0)
 ;
"RTN","IBYPPD",15,0)
 ;
"RTN","IBYPPD",16,0)
 D ADDRSI^IBYPPD1(IBEFFDT) ;    inactivate existing Tort Feasor Rate Schedules
"RTN","IBYPPD",17,0)
 D ADDRS^IBYPPD1(IBEFFDT) ;     add new Rate Schedules linking Tort Feasor and Reasonable Charges
"RTN","IBYPPD",18,0)
 ;
"RTN","IBYPPD",19,0)
 S IBA(1)="",IBA(2)="    IB*2*175 Post-Install Complete",IBA(3)="" D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPPD",20,0)
 Q
"RTN","IBYPPD",21,0)
 ;
"RTN","IBYPPD",22,0)
 ;
"RTN","IBYPPD",23,0)
ADDBS ; Add Bedsection (399.1, .12=1)
"RTN","IBYPPD",24,0)
 N IBA,IBCNT,IBI,IBLN,IBFN,DD,DO,DLAYGO,DIC,DIE,DA,DR,X,Y S IBCNT=0
"RTN","IBYPPD",25,0)
 ;
"RTN","IBYPPD",26,0)
 F IBI=1:1 S IBLN=$P($T(BSF+IBI),";;",2) Q:+IBLN!(IBLN="")  I $E(IBLN)?1A D
"RTN","IBYPPD",27,0)
 . ;
"RTN","IBYPPD",28,0)
 . I +$$MCCRUTL($P(IBLN,U,1),5) D MSG("No Change, Bedsection PRRTP already exists") Q
"RTN","IBYPPD",29,0)
 . ;
"RTN","IBYPPD",30,0)
 . K DD,DO S DLAYGO=399.1,DIC="^DGCR(399.1,",DIC(0)="L",X=$P(IBLN,U,1) D FILE^DICN K DIC I Y<1 K X,Y Q
"RTN","IBYPPD",31,0)
 . S IBFN=+Y,IBCNT=IBCNT+1
"RTN","IBYPPD",32,0)
 . ;
"RTN","IBYPPD",33,0)
 . S DR=".03////"_$P(IBLN,U,2)_";.12////"_1 S DIE="^DGCR(399.1,",DA=+IBFN D ^DIE K DIE,DA,DR,X,Y
"RTN","IBYPPD",34,0)
 ;
"RTN","IBYPPD",35,0)
BSQ S IBA(1)="      >> "_IBCNT_" Bedsection PRRTP added (399.1)" D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPPD",36,0)
 Q
"RTN","IBYPPD",37,0)
 ;
"RTN","IBYPPD",38,0)
 ;
"RTN","IBYPPD",39,0)
 ;
"RTN","IBYPPD",40,0)
MCCRUTL(X,P) ; returns IFN of item in 399.1 if Name is found and piece P is true
"RTN","IBYPPD",41,0)
 N IBX,IBY S IBY=""
"RTN","IBYPPD",42,0)
 I $G(X)'="" S IBX=0 F  S IBX=$O(^DGCR(399.1,"B",X,IBX)) Q:'IBX  I $P($G(^DGCR(399.1,IBX,0)),U,+$G(P)) S IBY=IBX
"RTN","IBYPPD",43,0)
 Q IBY
"RTN","IBYPPD",44,0)
 ;
"RTN","IBYPPD",45,0)
 ;
"RTN","IBYPPD",46,0)
MSG(X) ;
"RTN","IBYPPD",47,0)
 N IBX S IBX=$O(IBA(999999),-1) S:'IBX IBX=1 S IBX=IBX+1
"RTN","IBYPPD",48,0)
 S IBA(IBX)="         "_$G(X)
"RTN","IBYPPD",49,0)
 Q
"RTN","IBYPPD",50,0)
 ;
"RTN","IBYPPD",51,0)
 ;
"RTN","IBYPPD",52,0)
 ;
"RTN","IBYPPD",53,0)
 ;
"RTN","IBYPPD",54,0)
BSF ;  Bedsections (399.1,.12):  name ^ abbreviation
"RTN","IBYPPD",55,0)
 ;;    
"RTN","IBYPPD",56,0)
 ;;PRRTP^PRRTP
"RTN","IBYPPD",57,0)
 ;;
"RTN","IBYPPD",58,0)
 Q
"RTN","IBYPPD1")
0^4^B27166058
"RTN","IBYPPD1",1,0)
IBYPPD1 ;ALB/ARH - IB*2*175 POST INIT: RESET TORT FEASOR TO REASONABLE CHARGES ; 06/05/03
"RTN","IBYPPD1",2,0)
 ;;2.0;INTEGRATED BILLING;**175**;21-MAR-94
"RTN","IBYPPD1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBYPPD1",4,0)
 ;
"RTN","IBYPPD1",5,0)
 ; 
"RTN","IBYPPD1",6,0)
ADDRSI(EFFDT) ; Inactivate Existing Tort Feasor Rate Schedules
"RTN","IBYPPD1",7,0)
 N IBA,IBCNT,IBENDDT,IBRSFN,IBRS0,IBRSNM,IBRSRT,IBRATET,DD,DO,DIC,DIE,DA,DR,X,Y S IBCNT=0
"RTN","IBYPPD1",8,0)
 ;
"RTN","IBYPPD1",9,0)
 S IBENDDT="" I +$G(EFFDT) S IBENDDT=$$FMADD^XLFDT(EFFDT,-1)
"RTN","IBYPPD1",10,0)
 I 'IBENDDT D MSG("**Error: No Date, could not inactivate old RS") G ADDRSIQ
"RTN","IBYPPD1",11,0)
 ;
"RTN","IBYPPD1",12,0)
 S IBRSFN=0 F  S IBRSFN=$O(^IBE(363,IBRSFN)) Q:'IBRSFN  D
"RTN","IBYPPD1",13,0)
 . S IBRS0=$G(^IBE(363,IBRSFN,0))
"RTN","IBYPPD1",14,0)
 . ;
"RTN","IBYPPD1",15,0)
 . S IBRSNM=$P(IBRS0,U,1)
"RTN","IBYPPD1",16,0)
 . S IBRSRT=$P(IBRS0,U,2) Q:'IBRSRT  S IBRATET=$P($G(^DGCR(399.3,+IBRSRT,0)),U,1)
"RTN","IBYPPD1",17,0)
 . ;
"RTN","IBYPPD1",18,0)
 . I IBRATET'["TORT FEASOR",$E(IBRSNM,1,3)'="TF-" Q  ; tort feasor only
"RTN","IBYPPD1",19,0)
 . ;
"RTN","IBYPPD1",20,0)
 . I ($P(IBRS0,U,5)'="")!($P(IBRS0,U,6)'="") Q  ; dates already set
"RTN","IBYPPD1",21,0)
 . ;
"RTN","IBYPPD1",22,0)
 . S IBCNT=IBCNT+1,DR=".06////"_IBENDDT,DIE="^IBE(363,",DA=+IBRSFN D ^DIE K DIE,DA,DR,X,Y
"RTN","IBYPPD1",23,0)
 ;
"RTN","IBYPPD1",24,0)
ADDRSIQ S IBA(1)="      >> "_IBCNT_" Tort Feasor Rate Schedules inactivated on "_$$FMTE^XLFDT(IBENDDT,2)_" (363)"
"RTN","IBYPPD1",25,0)
 D MES^XPDUTL(.IBA)
"RTN","IBYPPD1",26,0)
 Q
"RTN","IBYPPD1",27,0)
 ;
"RTN","IBYPPD1",28,0)
 ;
"RTN","IBYPPD1",29,0)
ADDRS(EFFDT) ; add Tort Feasor Rate Schedules (363) for Reasonable Charges, if they don't already exist
"RTN","IBYPPD1",30,0)
 ; (all RC charge sets added here in post init and whenever RC rates are uploaded)
"RTN","IBYPPD1",31,0)
 N IBA,IBCNT,IBI,IBLN,IBFN,IBRT,IBBS,IBJ,IBSTDT,IBRS,IBCNTCS,DINUM,DD,DO,DLAYGO,DIC,DIE,DA,DR,X,Y S IBCNT=0
"RTN","IBYPPD1",32,0)
 ;
"RTN","IBYPPD1",33,0)
 S IBSTDT=+$G(EFFDT) I 'IBSTDT D MSG("**Error: No Date, could not link Rate Schedules to Charge Sets") G ADDRSQ
"RTN","IBYPPD1",34,0)
 ;
"RTN","IBYPPD1",35,0)
 I $$RSEXISTS(IBSTDT,"TF-INPT") D MSG("No Change, Rate Schedule linking TF and RC already exists") G ADDRSQ
"RTN","IBYPPD1",36,0)
 ;
"RTN","IBYPPD1",37,0)
 F IBI=1:1 S IBLN=$P($T(RSF+IBI),";;",2) Q:+IBLN!(IBLN="")  I $E(IBLN)?1A D
"RTN","IBYPPD1",38,0)
 . ;
"RTN","IBYPPD1",39,0)
 . S IBBS=$P(IBLN,U,4) I IBBS'="" S IBBS=$$MCCRUTL(IBBS,13) D  Q:'IBBS
"RTN","IBYPPD1",40,0)
 .. I 'IBBS D MSG("** Error: Billable Service "_$P(IBLN,U,4)_" not defined, RS "_$P(IBLN,U,1)_" not created")
"RTN","IBYPPD1",41,0)
 . ;
"RTN","IBYPPD1",42,0)
 . S IBRT=$P(IBLN,U,2),IBRT=$O(^DGCR(399.3,"B",IBRT,0)) D  Q:'IBRT
"RTN","IBYPPD1",43,0)
 .. I 'IBRT D MSG("** Error: Rate Type "_$P(IBLN,U,2)_" not defined, RS "_$P(IBLN,U,1)_" not created")
"RTN","IBYPPD1",44,0)
 .. I +$P($G(^DGCR(399.3,+IBRT,0)),U,3) S IBRT=0 D MSG("** Warning: Rate Type "_$P(IBLN,U,2)_" not Active, RS "_$P(IBLN,U,1)_" not created")
"RTN","IBYPPD1",45,0)
 . ;
"RTN","IBYPPD1",46,0)
 . F IBJ=1:1 S IBRS=$G(^IBE(363,IBJ,0)) I IBRS="" S DINUM=IBJ Q
"RTN","IBYPPD1",47,0)
 . ;
"RTN","IBYPPD1",48,0)
 . K DD,DO S DLAYGO=363,DIC="^IBE(363,",DIC(0)="L",X=$P(IBLN,U,1) D FILE^DICN K DIC,DINUM,DLAYGO I Y<1 K X,Y Q
"RTN","IBYPPD1",49,0)
 . S IBFN=+Y,IBCNT=IBCNT+1,IBCNTCS=0
"RTN","IBYPPD1",50,0)
 . ;
"RTN","IBYPPD1",51,0)
 . S DR=".02////"_IBRT_";.03////"_$P(IBLN,U,3) S:+IBBS DR=DR_";.04////"_IBBS S DR=DR_";.05////"_IBSTDT
"RTN","IBYPPD1",52,0)
 . S DIE="^IBE(363,",DA=+Y D ^DIE K DIE,DA,DR,X,Y
"RTN","IBYPPD1",53,0)
 . ;
"RTN","IBYPPD1",54,0)
 . S IBCNTCS=IBCNTCS+$$RSCS(IBFN) ; add all Reasonable Charges Charge Sets
"RTN","IBYPPD1",55,0)
 . ;
"RTN","IBYPPD1",56,0)
 . I 'IBCNTCS D MSG("** Warning: No Charge Sets added to RS "_$P(IBLN,U,1))
"RTN","IBYPPD1",57,0)
 ;
"RTN","IBYPPD1",58,0)
ADDRSQ S IBA(1)="      >> "_IBCNT_" Tort Feasor Rate Schedules added for RC, active "_$$FMTE^XLFDT(IBSTDT,2)_" (363)"
"RTN","IBYPPD1",59,0)
 D MES^XPDUTL(.IBA)
"RTN","IBYPPD1",60,0)
 Q
"RTN","IBYPPD1",61,0)
 ;
"RTN","IBYPPD1",62,0)
 ;
"RTN","IBYPPD1",63,0)
RSCS(RSFN) ; add existing Reasonable Charges Charge Sets to Rate Schedule, return number added
"RTN","IBYPPD1",64,0)
 ; copy the Charge Sets from the corresponding RI Rate Schedule (RC V2.0)
"RTN","IBYPPD1",65,0)
 N IBCNT,IBRS0,IBBTYPE,IBRSNM,IB2DT,IBCOPY,IBXFN,IBLN,IBCSFN,IBCS0,IBAA S (IBCOPY,IBCNT)=0
"RTN","IBYPPD1",66,0)
 ;
"RTN","IBYPPD1",67,0)
 S IBRS0=$G(^IBE(363,+$G(RSFN),0)),IBRSNM=$P(IBRS0,U,1)
"RTN","IBYPPD1",68,0)
 S IBBTYPE=$P(IBRS0,U,3)
"RTN","IBYPPD1",69,0)
 S IB2DT=$$VERSDT^IBCRU8(2)
"RTN","IBYPPD1",70,0)
 ;
"RTN","IBYPPD1",71,0)
 I IBRSNM["INPT" S IBCOPY=+$$RSEXISTS(IB2DT,"RI-INPT")
"RTN","IBYPPD1",72,0)
 I IBRSNM["SNF" S IBCOPY=+$$RSEXISTS(IB2DT,"RI-SNF")
"RTN","IBYPPD1",73,0)
 I IBRSNM["OPT" S IBCOPY=+$$RSEXISTS(IB2DT,"RI-OPT")
"RTN","IBYPPD1",74,0)
 I IBRSNM["RX" S IBCOPY=+$$RSEXISTS(IB2DT,"RI-RX")
"RTN","IBYPPD1",75,0)
 I 'IBCOPY G RSCSQ
"RTN","IBYPPD1",76,0)
 ;
"RTN","IBYPPD1",77,0)
 I +$P($G(^IBE(363,+IBCOPY,0)),U,3)=IBBTYPE D
"RTN","IBYPPD1",78,0)
 . ;
"RTN","IBYPPD1",79,0)
 . S IBXFN=0 F  S IBXFN=$O(^IBE(363,IBCOPY,11,IBXFN)) Q:'IBXFN  D
"RTN","IBYPPD1",80,0)
 .. ;
"RTN","IBYPPD1",81,0)
 .. S IBLN=$G(^IBE(363,IBCOPY,11,IBXFN,0)),IBCSFN=+IBLN,IBAA=$P(IBLN,U,2),IBCS0=$G(^IBE(363.1,IBCSFN,0))
"RTN","IBYPPD1",82,0)
 .. I +$$RSCSFILE(RSFN,$P(IBCS0,U,1),IBAA) S IBCNT=IBCNT+1
"RTN","IBYPPD1",83,0)
 ;
"RTN","IBYPPD1",84,0)
RSCSQ Q IBCNT
"RTN","IBYPPD1",85,0)
 ;
"RTN","IBYPPD1",86,0)
RSCSFILE(RSFN,CSNM,AA) ; Add Charge Set to a Rate Schedule
"RTN","IBYPPD1",87,0)
 N IBX,DD,DO,DLAYGO,DIC,DIE,DA,DR,X,Y,IBCSFN S IBX=0
"RTN","IBYPPD1",88,0)
 I $G(^IBE(363,+$G(RSFN),0))="" G RSCSFQ
"RTN","IBYPPD1",89,0)
 I $G(CSNM)="" G RSCSFQ
"RTN","IBYPPD1",90,0)
 S IBCSFN=$O(^IBE(363.1,"B",CSNM,0)) I 'IBCSFN G RSCSFQ
"RTN","IBYPPD1",91,0)
 I $O(^IBE(363,RSFN,11,"B",IBCSFN,0)) G RSCSFQ
"RTN","IBYPPD1",92,0)
 ;
"RTN","IBYPPD1",93,0)
 S DLAYGO=363,DA(1)=+RSFN,DIC="^IBE(363,"_DA(1)_",11,",DIC(0)="L",X=CSNM,DIC("DR")=".02////"_$G(AA),DIC("P")="363.0011P" D ^DIC K DIC,DIE S IBX=1
"RTN","IBYPPD1",94,0)
RSCSFQ Q IBX
"RTN","IBYPPD1",95,0)
 ;
"RTN","IBYPPD1",96,0)
 ;
"RTN","IBYPPD1",97,0)
RSEXISTS(EFFDT,NAME) ; return RS IFN if Rate Schedule exists for Effective Date
"RTN","IBYPPD1",98,0)
 N IBX,IBRSFN,IBRS0 S IBX=0
"RTN","IBYPPD1",99,0)
 I +$G(EFFDT),$G(NAME)'="" S IBRSFN=0 F  S IBRSFN=$O(^IBE(363,IBRSFN)) Q:'IBRSFN  D  I IBX Q
"RTN","IBYPPD1",100,0)
 . S IBRS0=$G(^IBE(363,IBRSFN,0))
"RTN","IBYPPD1",101,0)
 . I $P(IBRS0,U,1)=NAME,$P(IBRS0,U,5)=EFFDT S IBX=IBRSFN
"RTN","IBYPPD1",102,0)
 Q IBX
"RTN","IBYPPD1",103,0)
 ;
"RTN","IBYPPD1",104,0)
 ;
"RTN","IBYPPD1",105,0)
MCCRUTL(X,P) ; returns IFN of item in 399.1 if Name is found and piece P is true
"RTN","IBYPPD1",106,0)
 N IBX,IBY S IBY=""
"RTN","IBYPPD1",107,0)
 I $G(X)'="" S IBX=0 F  S IBX=$O(^DGCR(399.1,"B",X,IBX)) Q:'IBX  I $P($G(^DGCR(399.1,IBX,0)),U,+$G(P)) S IBY=IBX
"RTN","IBYPPD1",108,0)
 Q IBY
"RTN","IBYPPD1",109,0)
 ;
"RTN","IBYPPD1",110,0)
MSG(X) ;
"RTN","IBYPPD1",111,0)
 N IBX S IBX=$O(IBA(999999),-1) S:'IBX IBX=1 S IBX=IBX+1
"RTN","IBYPPD1",112,0)
 S IBA(IBX)="         "_$G(X)
"RTN","IBYPPD1",113,0)
 Q
"RTN","IBYPPD1",114,0)
 ;
"RTN","IBYPPD1",115,0)
 ;
"RTN","IBYPPD1",116,0)
 ;
"RTN","IBYPPD1",117,0)
RSF ;  Rate Schedules (363)
"RTN","IBYPPD1",118,0)
 ;; rs name ^ rate type ^ bill type ^ billable service ^ effective date ^^ charge sets
"RTN","IBYPPD1",119,0)
 ;; 
"RTN","IBYPPD1",120,0)
 ;;TF-INPT^TORT FEASOR^1^^
"RTN","IBYPPD1",121,0)
 ;;TF-SNF^TORT FEASOR^1^SKILLED NURSING^
"RTN","IBYPPD1",122,0)
 ;;TF-OPT^TORT FEASOR^3^^
"RTN","IBYPPD1",123,0)
 ;;TF-RX^TORT FEASOR^3^
"RTN","IBYPPD1",124,0)
 ;;
"RTN","IBYPPD2")
0^5^B30291523
"RTN","IBYPPD2",1,0)
IBYPPD2 ;ALB/ARH - IB*2*175 POST INIT: ADD TORT/INTERAGENCY RATES JAN 2003 ; 03/06/02
"RTN","IBYPPD2",2,0)
 ;;2.0;INTEGRATED BILLING;**175**;21-MAR-94
"RTN","IBYPPD2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBYPPD2",4,0)
 ; 
"RTN","IBYPPD2",5,0)
 ;
"RTN","IBYPPD2",6,0)
 ; Add Jan 2003 Tort and Interagency Charges to the Charge Master, 61 Charge Items
"RTN","IBYPPD2",7,0)
 Q
"RTN","IBYPPD2",8,0)
ADDCI(EFFDAT) ; Add Charge Items (363.2) needs Charge Sets, pass in the effective date of the new charges
"RTN","IBYPPD2",9,0)
 N IBA,IBCNT,IBCNT1,IBI,IBLN,IBFN,IBCS,IBXRF,IBCI,IBRVCD,IBCHG,DD,DO,DLAYGO,DIC,DIE,DA,DR,X,Y,IBX,IBZ,IBDFLTDT,IBDT S (IBCNT,IBCNT1)=0
"RTN","IBYPPD2",10,0)
 ;
"RTN","IBYPPD2",11,0)
 S IBDFLTDT=+$G(EFFDAT) I 'IBDFLTDT D MSG("** Error: No Date, No Charges Added") G CIQ
"RTN","IBYPPD2",12,0)
 ;
"RTN","IBYPPD2",13,0)
 F IBI=1:1 S IBLN=$P($T(CIF+IBI),";;",2) Q:+IBLN!(IBLN="")  I $E(IBLN)?1A D SETCI
"RTN","IBYPPD2",14,0)
 ;
"RTN","IBYPPD2",15,0)
 I +IBCNT1 D MSG(IBCNT1_" Duplicate Charge Items already exist, not re-added")
"RTN","IBYPPD2",16,0)
 ;
"RTN","IBYPPD2",17,0)
CIQ S IBA(1)="      >> "_IBCNT_" Tort/Interagency Charge Items added (363.2)" D MES^XPDUTL(.IBA) K IBA
"RTN","IBYPPD2",18,0)
 Q
"RTN","IBYPPD2",19,0)
 ;
"RTN","IBYPPD2",20,0)
SETCI ; set Charge Item (duplicates based on item, CS, eff dt, rev cd)
"RTN","IBYPPD2",21,0)
 ;
"RTN","IBYPPD2",22,0)
 S IBCS=$P(IBLN,U,2),IBCS=+$O(^IBE(363.1,"B",IBCS,0)) I 'IBCS D MSG("** Error: CS "_$P(IBLN,U,2)_" undefined") Q
"RTN","IBYPPD2",23,0)
 S IBCI=+$$MCCRUTL($P(IBLN,U,1),5) I 'IBCI D MSG("** Error: BS "_$P(IBLN,U,1)_" undefined") Q
"RTN","IBYPPD2",24,0)
 S IBDT=IBDFLTDT I +$P(IBLN,U,3) S IBDT=+$P(IBLN,U,3)
"RTN","IBYPPD2",25,0)
 S IBRVCD=$$RVCD($P(IBLN,U,4))
"RTN","IBYPPD2",26,0)
 S IBCHG=+$P(IBLN,U,5)
"RTN","IBYPPD2",27,0)
 S IBXRF="AIVDTS"_IBCS
"RTN","IBYPPD2",28,0)
 ;
"RTN","IBYPPD2",29,0)
 S IBX=0 F  S IBX=$O(^IBA(363.2,IBXRF,IBCI,-IBDT,IBX)) Q:'IBX  S IBZ=$G(^IBA(363.2,IBX,0)) I $P(IBZ,U,6)=IBRVCD D
"RTN","IBYPPD2",30,0)
 . S IBCI=0,IBCNT1=IBCNT1+1 I +$P(IBZ,U,5)'=IBCHG D MSG("** Error: Item exists, wrong charge: "_IBLN)
"RTN","IBYPPD2",31,0)
 Q:'IBCI
"RTN","IBYPPD2",32,0)
 ;
"RTN","IBYPPD2",33,0)
 K DD,DO S DLAYGO=363.2,DIC="^IBA(363.2,",DIC(0)="L",X=IBCI_";DGCR(399.1," D FILE^DICN K DIC I Y<1 K X,Y Q
"RTN","IBYPPD2",34,0)
 S IBFN=+Y,IBCNT=IBCNT+1
"RTN","IBYPPD2",35,0)
 ;
"RTN","IBYPPD2",36,0)
 S DR=".02////"_IBCS_";.03////"_IBDT_";.05////"_IBCHG I +IBRVCD S DR=DR_";.06////"_IBRVCD
"RTN","IBYPPD2",37,0)
 S DIE="^IBA(363.2,",DA=+IBFN D ^DIE K DIE,DA,DR,X,Y
"RTN","IBYPPD2",38,0)
 Q
"RTN","IBYPPD2",39,0)
 ;
"RTN","IBYPPD2",40,0)
 ;
"RTN","IBYPPD2",41,0)
MCCRUTL(X,P) ; returns IFN of item in 399.1 if Name is found and piece P is true
"RTN","IBYPPD2",42,0)
 N IBX,IBY S IBY=""
"RTN","IBYPPD2",43,0)
 I $G(X)'="" S IBX=0 F  S IBX=$O(^DGCR(399.1,"B",X,IBX)) Q:'IBX  I $P($G(^DGCR(399.1,IBX,0)),U,+$G(P)) S IBY=IBX
"RTN","IBYPPD2",44,0)
 Q IBY
"RTN","IBYPPD2",45,0)
 ;
"RTN","IBYPPD2",46,0)
RVCD(RVCD) ; returns IFN if revenue code is valid and active
"RTN","IBYPPD2",47,0)
 N IBX,IBY S IBY=""
"RTN","IBYPPD2",48,0)
 I +$G(RVCD) S IBX=$G(^DGCR(399.2,+RVCD,0)) I +$P(IBX,U,3) S IBY=+RVCD
"RTN","IBYPPD2",49,0)
 Q IBY
"RTN","IBYPPD2",50,0)
 ;
"RTN","IBYPPD2",51,0)
MSG(X) ;
"RTN","IBYPPD2",52,0)
 N IBX S IBX=$O(IBA(999999),-1) S:'IBX IBX=1 S IBX=IBX+1
"RTN","IBYPPD2",53,0)
 S IBA(IBX)="         "_$G(X)
"RTN","IBYPPD2",54,0)
 Q
"RTN","IBYPPD2",55,0)
 ;
"RTN","IBYPPD2",56,0)
 ;
"RTN","IBYPPD2",57,0)
 ;
"RTN","IBYPPD2",58,0)
 ;
"RTN","IBYPPD2",59,0)
 ;
"RTN","IBYPPD2",60,0)
 ;
"RTN","IBYPPD2",61,0)
CIF ; Charge Items (363.2):  Bedsection ^ Charge Set ^Effective Date ^ Revenue Code ^ Charge
"RTN","IBYPPD2",62,0)
 ;;     
"RTN","IBYPPD2",63,0)
TORT ;; 2002 Tortiously Liable All Inclusive
"RTN","IBYPPD2",64,0)
 ;;        
"RTN","IBYPPD2",65,0)
 ;;ALCOHOL AND DRUG TREATMENT^TL-INPT (INCLUSIVE)^^^1206
"RTN","IBYPPD2",66,0)
 ;;BLIND REHABILITATION^TL-INPT (INCLUSIVE)^^^1254
"RTN","IBYPPD2",67,0)
 ;;GENERAL MEDICAL CARE^TL-INPT (INCLUSIVE)^^^1815
"RTN","IBYPPD2",68,0)
 ;;INTERMEDIATE CARE^TL-INPT (INCLUSIVE)^^^801
"RTN","IBYPPD2",69,0)
 ;;NEUROLOGY^TL-INPT (INCLUSIVE)^^^2289
"RTN","IBYPPD2",70,0)
 ;;NURSING HOME CARE^TL-INPT (INCLUSIVE)^^^451
"RTN","IBYPPD2",71,0)
 ;;PRRTP^TL-INPT (INCLUSIVE)^^^276
"RTN","IBYPPD2",72,0)
 ;;PSYCHIATRIC CARE^TL-INPT (INCLUSIVE)^^^971
"RTN","IBYPPD2",73,0)
 ;;REHABILITATION MEDICINE^TL-INPT (INCLUSIVE)^^^1723
"RTN","IBYPPD2",74,0)
 ;;SPINAL CORD INJURY CARE^TL-INPT (INCLUSIVE)^^^1237
"RTN","IBYPPD2",75,0)
 ;;SURGICAL CARE^TL-INPT (INCLUSIVE)^^^3513
"RTN","IBYPPD2",76,0)
 ;;             
"RTN","IBYPPD2",77,0)
 ;; Tortiously Liable Non-Professional
"RTN","IBYPPD2",78,0)
 ;;ALCOHOL AND DRUG TREATMENT^TL-INPT (NPF)^^101^812
"RTN","IBYPPD2",79,0)
 ;;ALCOHOL AND DRUG TREATMENT^TL-INPT (NPF)^^240^279
"RTN","IBYPPD2",80,0)
 ;;BLIND REHABILITATION^TL-INPT (NPF)^^101^530
"RTN","IBYPPD2",81,0)
 ;;BLIND REHABILITATION^TL-INPT (NPF)^^240^623
"RTN","IBYPPD2",82,0)
 ;;GENERAL MEDICAL CARE^TL-INPT (NPF)^^101^1125
"RTN","IBYPPD2",83,0)
 ;;GENERAL MEDICAL CARE^TL-INPT (NPF)^^240^473
"RTN","IBYPPD2",84,0)
 ;;INTERMEDIATE CARE^TL-INPT (NPF)^^101^644
"RTN","IBYPPD2",85,0)
 ;;INTERMEDIATE CARE^TL-INPT (NPF)^^240^118
"RTN","IBYPPD2",86,0)
 ;;NEUROLOGY^TL-INPT (NPF)^^101^1350
"RTN","IBYPPD2",87,0)
 ;;NEUROLOGY^TL-INPT (NPF)^^240^604
"RTN","IBYPPD2",88,0)
 ;;NURSING HOME CARE^TL-INPT (NPF)^^101^376
"RTN","IBYPPD2",89,0)
 ;;NURSING HOME CARE^TL-INPT (NPF)^^240^61
"RTN","IBYPPD2",90,0)
 ;;PRRTP^TL-INPT (NPF)^^101^230
"RTN","IBYPPD2",91,0)
 ;;PRRTP^TL-INPT (NPF)^^240^29
"RTN","IBYPPD2",92,0)
 ;;PSYCHIATRIC CARE^TL-INPT (NPF)^^101^726
"RTN","IBYPPD2",93,0)
 ;;PSYCHIATRIC CARE^TL-INPT (NPF)^^240^153
"RTN","IBYPPD2",94,0)
 ;;REHABILITATION MEDICINE^TL-INPT (NPF)^^101^1001
"RTN","IBYPPD2",95,0)
 ;;REHABILITATION MEDICINE^TL-INPT (NPF)^^240^526
"RTN","IBYPPD2",96,0)
 ;;SPINAL CORD INJURY CARE^TL-INPT (NPF)^^101^773
"RTN","IBYPPD2",97,0)
 ;;SPINAL CORD INJURY CARE^TL-INPT (NPF)^^240^311
"RTN","IBYPPD2",98,0)
 ;;SURGICAL CARE^TL-INPT (NPF)^^101^2061
"RTN","IBYPPD2",99,0)
 ;;SURGICAL CARE^TL-INPT (NPF)^^240^1065
"RTN","IBYPPD2",100,0)
 ;;              
"RTN","IBYPPD2",101,0)
 ;; Tortiously Liable Professional
"RTN","IBYPPD2",102,0)
 ;;ALCOHOL AND DRUG TREATMENT^TL-INPT (PF)^^^115
"RTN","IBYPPD2",103,0)
 ;;BLIND REHABILITATION^TL-INPT (PF)^^^101
"RTN","IBYPPD2",104,0)
 ;;GENERAL MEDICAL CARE^TL-INPT (PF)^^^217
"RTN","IBYPPD2",105,0)
 ;;INTERMEDIATE CARE^TL-INPT (PF)^^^39
"RTN","IBYPPD2",106,0)
 ;;NEUROLOGY^TL-INPT (PF)^^^335
"RTN","IBYPPD2",107,0)
 ;;NURSING HOME CARE^TL-INPT (PF)^^^14
"RTN","IBYPPD2",108,0)
 ;;PRRTP^TL-INPT (PF)^^^17
"RTN","IBYPPD2",109,0)
 ;;PSYCHIATRIC CARE^TL-INPT (PF)^^^92
"RTN","IBYPPD2",110,0)
 ;;REHABILITATION MEDICINE^TL-INPT (PF)^^^196
"RTN","IBYPPD2",111,0)
 ;;SPINAL CORD INJURY CARE^TL-INPT (PF)^^^153
"RTN","IBYPPD2",112,0)
 ;;SURGICAL CARE^TL-INPT (PF)^^^387
"RTN","IBYPPD2",113,0)
 ;;                    
"RTN","IBYPPD2",114,0)
 ;; Tortiously Liable Other
"RTN","IBYPPD2",115,0)
 ;;OUTPATIENT VISIT^TL-OPT VST^^^300
"RTN","IBYPPD2",116,0)
 ;;PRESCRIPTION^TL-RX FILL^^^45
"RTN","IBYPPD2",117,0)
 ;;OUTPATIENT DENTAL^TL-OPT DENTAL^^^185
"RTN","IBYPPD2",118,0)
 ;;          
"RTN","IBYPPD2",119,0)
 ;;         
"RTN","IBYPPD2",120,0)
IA ;; 2002 Interagency
"RTN","IBYPPD2",121,0)
 ;;            
"RTN","IBYPPD2",122,0)
 ;;ALCOHOL AND DRUG TREATMENT^IA-INPT^^^1106
"RTN","IBYPPD2",123,0)
 ;;BLIND REHABILITATION^IA-INPT^^^1162
"RTN","IBYPPD2",124,0)
 ;;GENERAL MEDICAL CARE^IA-INPT^^^1668
"RTN","IBYPPD2",125,0)
 ;;INTERMEDIATE CARE^IA-INPT^^^733
"RTN","IBYPPD2",126,0)
 ;;NEUROLOGY^IA-INPT^^^2098
"RTN","IBYPPD2",127,0)
 ;;NURSING HOME CARE^IA-INPT^^^411
"RTN","IBYPPD2",128,0)
 ;;PRRTP^IA-INPT^^^252
"RTN","IBYPPD2",129,0)
 ;;PSYCHIATRIC CARE^IA-INPT^^^888
"RTN","IBYPPD2",130,0)
 ;;REHABILITATION MEDICINE^IA-INPT^^^1574
"RTN","IBYPPD2",131,0)
 ;;SPINAL CORD INJURY CARE^IA-INPT^^^1136
"RTN","IBYPPD2",132,0)
 ;;SURGICAL CARE^IA-INPT^^^3255
"RTN","IBYPPD2",133,0)
 ;;            
"RTN","IBYPPD2",134,0)
 ;;OUTPATIENT VISIT^IA-OPT VST^^^282
"RTN","IBYPPD2",135,0)
 ;;PRESCRIPTION^IA-RX FILL^^^45
"RTN","IBYPPD2",136,0)
 ;;OUTPATIENT DENTAL^IA-OPT DENTAL^^^167
"RTN","IBYPPD2",137,0)
 ;;
"RTN","IBYPPD2",138,0)
 Q
"VER")
8.0^22.0
**END**
**END**
