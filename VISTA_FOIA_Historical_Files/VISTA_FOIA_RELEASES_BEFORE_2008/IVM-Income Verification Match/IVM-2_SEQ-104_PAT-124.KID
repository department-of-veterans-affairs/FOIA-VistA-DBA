EMERGENCY Released IVM*2*124 SEQ #104
Extracted from mail message
**KIDS**:IVM*2.0*124^

**INSTALL NAME**
IVM*2.0*124
"BLD",7094,0)
IVM*2.0*124^INCOME VERIFICATION MATCH^0^3070712^y
"BLD",7094,4,0)
^9.64PA^^
"BLD",7094,6.3)
1
"BLD",7094,"ABPKG")
n
"BLD",7094,"KRN",0)
^9.67PA^8989.52^19
"BLD",7094,"KRN",.4,0)
.4
"BLD",7094,"KRN",.401,0)
.401
"BLD",7094,"KRN",.402,0)
.402
"BLD",7094,"KRN",.403,0)
.403
"BLD",7094,"KRN",.5,0)
.5
"BLD",7094,"KRN",.84,0)
.84
"BLD",7094,"KRN",3.6,0)
3.6
"BLD",7094,"KRN",3.8,0)
3.8
"BLD",7094,"KRN",9.2,0)
9.2
"BLD",7094,"KRN",9.8,0)
9.8
"BLD",7094,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7094,"KRN",9.8,"NM",1,0)
IVMLDEM6^^0^B62806178
"BLD",7094,"KRN",9.8,"NM","B","IVMLDEM6",1)

"BLD",7094,"KRN",19,0)
19
"BLD",7094,"KRN",19.1,0)
19.1
"BLD",7094,"KRN",101,0)
101
"BLD",7094,"KRN",409.61,0)
409.61
"BLD",7094,"KRN",771,0)
771
"BLD",7094,"KRN",870,0)
870
"BLD",7094,"KRN",8989.51,0)
8989.51
"BLD",7094,"KRN",8989.52,0)
8989.52
"BLD",7094,"KRN",8994,0)
8994
"BLD",7094,"KRN","B",.4,.4)

"BLD",7094,"KRN","B",.401,.401)

"BLD",7094,"KRN","B",.402,.402)

"BLD",7094,"KRN","B",.403,.403)

"BLD",7094,"KRN","B",.5,.5)

"BLD",7094,"KRN","B",.84,.84)

"BLD",7094,"KRN","B",3.6,3.6)

"BLD",7094,"KRN","B",3.8,3.8)

"BLD",7094,"KRN","B",9.2,9.2)

"BLD",7094,"KRN","B",9.8,9.8)

"BLD",7094,"KRN","B",19,19)

"BLD",7094,"KRN","B",19.1,19.1)

"BLD",7094,"KRN","B",101,101)

"BLD",7094,"KRN","B",409.61,409.61)

"BLD",7094,"KRN","B",771,771)

"BLD",7094,"KRN","B",870,870)

"BLD",7094,"KRN","B",8989.51,8989.51)

"BLD",7094,"KRN","B",8989.52,8989.52)

"BLD",7094,"KRN","B",8994,8994)

"BLD",7094,"QUES",0)
^9.62^^
"BLD",7094,"REQB",0)
^9.611^1^1
"BLD",7094,"REQB",1,0)
IVM*2.0*105^2
"BLD",7094,"REQB","B","IVM*2.0*105",1)

"MBREQ")
0
"PKG",120,-1)
1^1
"PKG",120,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",120,20,0)
^9.402P^^
"PKG",120,22,0)
^9.49I^1^1
"PKG",120,22,1,0)
2.0^2941021^2960823
"PKG",120,22,1,"PAH",1,0)
124^3070712
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IVMLDEM6")
0^1^B62806178^B60562553
"RTN","IVMLDEM6",1,0)
IVMLDEM6 ;ALB/KCL/BRM/PHH/CKN - IVM DEMOGRAPHIC UPLOAD FILE ADDRESS ; 7/12/07 5:31pm
"RTN","IVMLDEM6",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**10,58,73,79,108,106,105,124**; 21-OCT-94;Build 1
"RTN","IVMLDEM6",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMLDEM6",4,0)
 ;
"RTN","IVMLDEM6",5,0)
 ;
"RTN","IVMLDEM6",6,0)
ADDR(DFN,IVMDA2,IVMDA1,IVMDA,IVMPPICK) ; - function to check if uploadable field
"RTN","IVMLDEM6",7,0)
 ;                          is an address field and return a flag
"RTN","IVMLDEM6",8,0)
 ;
"RTN","IVMLDEM6",9,0)
 ;  Input:      DFN  -  as patient IEN
"RTN","IVMLDEM6",10,0)
 ;           IVMDA2  -  pointer to case record in (#301.5) file
"RTN","IVMLDEM6",11,0)
 ;           IVMDA1  -  pointer to PID msg in (#301.501) sub-file
"RTN","IVMLDEM6",12,0)
 ;            IVMDA  -  pointer to record in (#301.511) sub-file
"RTN","IVMLDEM6",13,0)
 ;         IVMPPICK  -  residence phone number and/or another address
"RTN","IVMLDEM6",14,0)
 ;                        field selected
"RTN","IVMLDEM6",15,0)
 ;                      0 - phone or an address field not selected 
"RTN","IVMLDEM6",16,0)
 ;                      1 - address field(s) selected
"RTN","IVMLDEM6",17,0)
 ;                      2 - phone selected
"RTN","IVMLDEM6",18,0)
 ;                      3 - both address field(s) and phone selected
"RTN","IVMLDEM6",19,0)
 ;
"RTN","IVMLDEM6",20,0)
 ; Output: IVMFLAG   -  1 if address field
"RTN","IVMLDEM6",21,0)
 ;                      0 if not an address field
"RTN","IVMLDEM6",22,0)
 ;
"RTN","IVMLDEM6",23,0)
 ;
"RTN","IVMLDEM6",24,0)
 N IVMFLAG,IVMI,IVMJ,IVMNODE,IVMPTR,Y
"RTN","IVMLDEM6",25,0)
 ;
"RTN","IVMLDEM6",26,0)
 ; - initialize flags
"RTN","IVMLDEM6",27,0)
 S IVMFLAG=0
"RTN","IVMLDEM6",28,0)
 ;
"RTN","IVMLDEM6",29,0)
 ; - check for required parameters
"RTN","IVMLDEM6",30,0)
 I '$G(DFN)!('$G(IVMDA))!('$G(IVMDA1))!'($G(IVMDA2)) G ADDRQ
"RTN","IVMLDEM6",31,0)
 ;
"RTN","IVMLDEM6",32,0)
 ; - get pointer to (#301.92) file from (#301.511) sub-file
"RTN","IVMLDEM6",33,0)
 S IVMPTR=+$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMDA,0)) G ADDRQ:'IVMPTR
"RTN","IVMLDEM6",34,0)
 ;
"RTN","IVMLDEM6",35,0)
ASK I '$D(^IVM(301.92,"AD",+IVMPTR)) G ADDRQ
"RTN","IVMLDEM6",36,0)
 I IVMPPICK=2 G ASK1
"RTN","IVMLDEM6",37,0)
 W ! S DIR("A")="Do you wish to proceed with this action"
"RTN","IVMLDEM6",38,0)
 S DIR("A",1)="You have selected to update an address field."
"RTN","IVMLDEM6",39,0)
 S DIR("A",2)="You will be required to upload the entire address."
"RTN","IVMLDEM6",40,0)
 S DIR("?")="Enter 'YES' to continue or 'NO' to abort."
"RTN","IVMLDEM6",41,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","IVMLDEM6",42,0)
 D ^DIR K DIR
"RTN","IVMLDEM6",43,0)
 S IVMFLAG=1 G ADDRQ:'Y
"RTN","IVMLDEM6",44,0)
 W ! S DIR("A")="Are you sure that you want to update the complete address"
"RTN","IVMLDEM6",45,0)
 S:$$PHARM(+$G(DFN)) DIR("A",1)="*** WARNING: This patient has ACTIVE PRESCRIPTIONS on file."
"RTN","IVMLDEM6",46,0)
 S DIR("A",2)=""
"RTN","IVMLDEM6",47,0)
 I $$ADRDTCK^IVMLDEM9(+$G(DFN),IVMDA2,IVMDA1) S DIR("A",2)="*** WARNING: The address that you are attempting to file is OLDER than",DIR("A",3)="             the address on file.",DIR("A",4)=""
"RTN","IVMLDEM6",48,0)
 S DIR("?",1)="Enter 'YES' to update the complete address that was received from"
"RTN","IVMLDEM6",49,0)
 S DIR("?")="HEC.  Enter 'NO' to quit."
"RTN","IVMLDEM6",50,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","IVMLDEM6",51,0)
 D ^DIR K DIR
"RTN","IVMLDEM6",52,0)
 S IVMFLAG=1 G ADDRQ:'Y
"RTN","IVMLDEM6",53,0)
 W !,"Filing address fields... "
"RTN","IVMLDEM6",54,0)
 ;
"RTN","IVMLDEM6",55,0)
 ; determine correct address change date/time to use
"RTN","IVMLDEM6",56,0)
 D ADDRDT(DFN,IVMDA2,IVMDA1)
"RTN","IVMLDEM6",57,0)
 ;
"RTN","IVMLDEM6",58,0)
LOOP ;
"RTN","IVMLDEM6",59,0)
 N DGPRIOR D GETPRIOR^DGADDUTL(DFN,.DGPRIOR)
"RTN","IVMLDEM6",60,0)
 ;
"RTN","IVMLDEM6",61,0)
 ; - loop thru fields in ^IVM(301.92,"AD" x-ref
"RTN","IVMLDEM6",62,0)
 S IVMI=0 F  S IVMI=$O(^IVM(301.92,"AD",IVMI)) Q:IVMI']""  D
"RTN","IVMLDEM6",63,0)
 .S IVMJ=0 F  S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,IVMJ)) Q:IVMJ']""  D
"RTN","IVMLDEM6",64,0)
 ..;
"RTN","IVMLDEM6",65,0)
 ..; - check for data node in (#301.511) sub-file
"RTN","IVMLDEM6",66,0)
 ..S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0)) Q:IVMNODE']""
"RTN","IVMLDEM6",67,0)
 ..Q:'(+IVMNODE)!($P(IVMNODE,"^",2)']"")
"RTN","IVMLDEM6",68,0)
 ..;
"RTN","IVMLDEM6",69,0)
 ..; - check if residence phone number and not selected to upload
"RTN","IVMLDEM6",70,0)
 ..Q:(IVMPPICK=1&(+IVMNODE=$O(^IVM(301.92,"B","PHONE NUMBER [RESIDENCE]",0))))
"RTN","IVMLDEM6",71,0)
 ..; - check if not residence phone number and only phone selected to upload
"RTN","IVMLDEM6",72,0)
 ..Q:(IVMPPICK=2&(+IVMNODE'=$O(^IVM(301.92,"B","PHONE NUMBER [RESIDENCE]",0))))
"RTN","IVMLDEM6",73,0)
 ..;
"RTN","IVMLDEM6",74,0)
 ..; - perform any necessary address field manipulation and
"RTN","IVMLDEM6",75,0)
 ..;   load addr field rec'd from IVM into DHCP (#2) file
"RTN","IVMLDEM6",76,0)
 ..D UPLOAD(+DFN,$P($G(^IVM(301.92,+IVMNODE,0)),"^",5),$P(IVMNODE,"^",2)) S IVMFLAG=1
"RTN","IVMLDEM6",77,0)
 ..;
"RTN","IVMLDEM6",78,0)
 ..; - remove entry from (#301.511) sub-file
"RTN","IVMLDEM6",79,0)
 ..D DELENT^IVMLDEMU(IVMDA2,IVMDA1,IVMJ)
"RTN","IVMLDEM6",80,0)
 ;
"RTN","IVMLDEM6",81,0)
 I IVMFLAG W "completed.",! D
"RTN","IVMLDEM6",82,0)
 .N DGCURR
"RTN","IVMLDEM6",83,0)
 .D GETUPDTS^DGADDUTL(DFN,.DGCURR)
"RTN","IVMLDEM6",84,0)
 .D UPDADDLG^DGADDUTL(DFN,.DGPRIOR,.DGCURR)
"RTN","IVMLDEM6",85,0)
 ;
"RTN","IVMLDEM6",86,0)
 ; - if addr is uploaded and phone # is not - ask user delete phone
"RTN","IVMLDEM6",87,0)
 I IVMFLAG,$P($G(^DPT(+DFN,.13)),"^")]"",(2>IVMPPICK) D PHONE
"RTN","IVMLDEM6",88,0)
 S VALMBCK="R"
"RTN","IVMLDEM6",89,0)
 ;
"RTN","IVMLDEM6",90,0)
 ;
"RTN","IVMLDEM6",91,0)
ADDRQ ; - return  -->  1 if uploadable field is an address field
"RTN","IVMLDEM6",92,0)
 ;           -->  0 if uploadable field is not an address field
"RTN","IVMLDEM6",93,0)
 ;
"RTN","IVMLDEM6",94,0)
 I IVMFLAG D RESET^IVMLDEMU
"RTN","IVMLDEM6",95,0)
 Q IVMFLAG
"RTN","IVMLDEM6",96,0)
 ;
"RTN","IVMLDEM6",97,0)
 ;
"RTN","IVMLDEM6",98,0)
UPLOAD(DFN,IVMFIELD,IVMVALUE) ; - file address fields received from IVM
"RTN","IVMLDEM6",99,0)
 ;
"RTN","IVMLDEM6",100,0)
 ;  Input:       DFN  -  as patient IEN
"RTN","IVMLDEM6",101,0)
 ;          IVMFIELD  -  as the field number to be updated
"RTN","IVMLDEM6",102,0)
 ;          IVMVALUE  -  as the value of the field
"RTN","IVMLDEM6",103,0)
 ;
"RTN","IVMLDEM6",104,0)
 ; Output: None
"RTN","IVMLDEM6",105,0)
 ;
"RTN","IVMLDEM6",106,0)
 ;
"RTN","IVMLDEM6",107,0)
 ; - update specified address field in the Patient (#2) file
"RTN","IVMLDEM6",108,0)
 S DIE="^DPT(",DA=DFN,DR=IVMFIELD_"////^S X=IVMVALUE"
"RTN","IVMLDEM6",109,0)
 D ^DIE K DA,DIE,DR
"RTN","IVMLDEM6",110,0)
 ;
"RTN","IVMLDEM6",111,0)
 ; - delete inaccurate Addr Change Site data if Source is not VAMC
"RTN","IVMLDEM6",112,0)
 ;   (trigger x-ref does not fire with 4 slash stuff)
"RTN","IVMLDEM6",113,0)
 I IVMFIELD=.119,IVMVALUE'="VAMC" S FDA(2,+DFN_",",.12)="@" D UPDATE^DIE("E","FDA")
"RTN","IVMLDEM6",114,0)
 ;
"RTN","IVMLDEM6",115,0)
 ; - delete the Bad Address Indicator field
"RTN","IVMLDEM6",116,0)
 I $$BADADR^DGUTL3(DFN) D DELBAI^DGUTL3(DFN)
"RTN","IVMLDEM6",117,0)
 Q
"RTN","IVMLDEM6",118,0)
 ;
"RTN","IVMLDEM6",119,0)
 ;
"RTN","IVMLDEM6",120,0)
PHONE ; - ask user to delete phone # [Residence] from Patient (#2) file
"RTN","IVMLDEM6",121,0)
 D FULL^VALM1
"RTN","IVMLDEM6",122,0)
 W ! S DIR("A")="Is it okay to delete the patient's Phone Number [Residence]"
"RTN","IVMLDEM6",123,0)
 W ! S DIR("A",1)="The patient's address has been updated and the phone number"
"RTN","IVMLDEM6",124,0)
 S DIR("A",2)="remains on file."
"RTN","IVMLDEM6",125,0)
 S DIR("A",3)=" "
"RTN","IVMLDEM6",126,0)
 S DIR("A",4)="Patient Name: "_$P($$PT^IVMUFNC4(+DFN),"^")_" ("_$P($$PT^IVMUFNC4(+DFN),"^",3)_")"
"RTN","IVMLDEM6",127,0)
 S DIR("A",5)="Phone Number [Residence]: "_$P($G(^DPT(+DFN,.13)),"^")
"RTN","IVMLDEM6",128,0)
 S DIR("A",6)=" "
"RTN","IVMLDEM6",129,0)
 S DIR("?",1)="Enter 'YES' to delete the patient's Phone Number [Residence] that is"
"RTN","IVMLDEM6",130,0)
 S DIR("?",2)="currently on file.  Enter 'NO' to quit without deleting the patient's"
"RTN","IVMLDEM6",131,0)
 S DIR("?")="Phone Number [Residence]."
"RTN","IVMLDEM6",132,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","IVMLDEM6",133,0)
 D ^DIR K DIR
"RTN","IVMLDEM6",134,0)
 S:Y $P(^DPT(DFN,.13),"^")="" W !!,"Patient's Phone Number [Residence] has ",$S(Y:"",1:"not "),"been deleted."
"RTN","IVMLDEM6",135,0)
 Q
"RTN","IVMLDEM6",136,0)
 ;
"RTN","IVMLDEM6",137,0)
ASK1 ; - phone selected to be uploaded - address fields not selected
"RTN","IVMLDEM6",138,0)
 W ! S DIR("A")="Okay to update the PHONE NUMBER [RESIDENCE] field"
"RTN","IVMLDEM6",139,0)
 S DIR("?",1)="Enter 'YES' to update the patient's Phone Number [Residence] that was"
"RTN","IVMLDEM6",140,0)
 S DIR("?",2)="received from HEC.  Enter 'NO' to quit."
"RTN","IVMLDEM6",141,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","IVMLDEM6",142,0)
 D ^DIR K DIR
"RTN","IVMLDEM6",143,0)
 S IVMFLAG=1 G ADDRQ:'Y
"RTN","IVMLDEM6",144,0)
 W !,"Updating PHONE NUMBER [RESIDENCE] field... "
"RTN","IVMLDEM6",145,0)
 G LOOP
"RTN","IVMLDEM6",146,0)
 ;
"RTN","IVMLDEM6",147,0)
AUTOADDR(DFN,IVMPPICK,NOUPDT) ;
"RTN","IVMLDEM6",148,0)
 ; this functionality is copied from above and modified to allow
"RTN","IVMLDEM6",149,0)
 ; an automated upload of patient address information as stipulated
"RTN","IVMLDEM6",150,0)
 ; in the business requirements for Address Indexing to support GMT
"RTN","IVMLDEM6",151,0)
 ;
"RTN","IVMLDEM6",152,0)
 ;  Input:      DFN  -  as patient IEN
"RTN","IVMLDEM6",153,0)
 ;         IVMPPICK  -  residence phone number and/or another address
"RTN","IVMLDEM6",154,0)
 ;                        field selected
"RTN","IVMLDEM6",155,0)
 ;                      1 - address field(s) selected
"RTN","IVMLDEM6",156,0)
 ;                      3 - both address field(s) and phone selected
"RTN","IVMLDEM6",157,0)
 ;           NOUPDT  -  (optional) this flag is set when the incoming
"RTN","IVMLDEM6",158,0)
 ;                      address data is older than the existing
"RTN","IVMLDEM6",159,0)
 ;                      address in the Patient (#2) file
"RTN","IVMLDEM6",160,0)
 ;
"RTN","IVMLDEM6",161,0)
 ; Output: IVMFLAG   -  1 if address fields updated
"RTN","IVMLDEM6",162,0)
 ;                      0 if address fields not updated
"RTN","IVMLDEM6",163,0)
 ;
"RTN","IVMLDEM6",164,0)
 ;
"RTN","IVMLDEM6",165,0)
 ;
"RTN","IVMLDEM6",166,0)
 N IVMFLAG,IVMI,IVMJ,IVMNODE,IVMPTR,Y,DELFLG
"RTN","IVMLDEM6",167,0)
 ;
"RTN","IVMLDEM6",168,0)
 ; - initialize flags
"RTN","IVMLDEM6",169,0)
 S IVMFLAG=0,DELFLG=1
"RTN","IVMLDEM6",170,0)
 S:'$G(NOUPDT) NOUPDT=0
"RTN","IVMLDEM6",171,0)
 ;
"RTN","IVMLDEM6",172,0)
 ; - check for required parameters
"RTN","IVMLDEM6",173,0)
 Q:'$G(DFN) IVMFLAG
"RTN","IVMLDEM6",174,0)
 ;
"RTN","IVMLDEM6",175,0)
 N DGPRIOR D GETPRIOR^DGADDUTL(DFN,.DGPRIOR)
"RTN","IVMLDEM6",176,0)
 ; Set the flag to don't auto-update if there is an active
"RTN","IVMLDEM6",177,0)
 ; Prescription record and the Bad Address Indicator is null
"RTN","IVMLDEM6",178,0)
 I ('NOUPDT),$$PHARM(+DFN),'$$BADADR^DGUTL3(+DFN) S DELFLG=0
"RTN","IVMLDEM6",179,0)
 I ('NOUPDT),DELFLG D EN^DGCLEAR(DFN) ;Deleting existing address before update
"RTN","IVMLDEM6",180,0)
 ;
"RTN","IVMLDEM6",181,0)
 S IVMDA2=$G(IVM3015)
"RTN","IVMLDEM6",182,0)
 Q:'$G(IVMDA2) IVMFLAG
"RTN","IVMLDEM6",183,0)
 S IVMDA1=$O(^HL(771.3,"B","PID",""))
"RTN","IVMLDEM6",184,0)
 S IVMDA1=$O(^IVM(301.5,IVMDA2,"IN","B",IVMDA1,""),-1)
"RTN","IVMLDEM6",185,0)
 Q:'IVMDA1 IVMFLAG
"RTN","IVMLDEM6",186,0)
 ;
"RTN","IVMLDEM6",187,0)
 S IVMI=0 F  S IVMI=$O(^IVM(301.92,"AD",IVMI)) Q:IVMI']""  D
"RTN","IVMLDEM6",188,0)
 .S IVMJ=0 F  S IVMJ=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IVMI,IVMJ)) Q:IVMJ']""  D
"RTN","IVMLDEM6",189,0)
 ..;
"RTN","IVMLDEM6",190,0)
 ..; - check for data node in (#301.511) sub-file
"RTN","IVMLDEM6",191,0)
 ..S IVMNODE=$G(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM",IVMJ,0))
"RTN","IVMLDEM6",192,0)
 ..I ('+IVMNODE)!($P(IVMNODE,"^",2)']"") Q
"RTN","IVMLDEM6",193,0)
 ..;
"RTN","IVMLDEM6",194,0)
 ..; - check if residence phone number -> do not auto-upload
"RTN","IVMLDEM6",195,0)
 ..I (IVMPPICK=1&(+IVMNODE=$O(^IVM(301.92,"B","PHONE NUMBER [RESIDENCE]",0)))) D DEMBULL^IVMPREC6 Q
"RTN","IVMLDEM6",196,0)
 ..;
"RTN","IVMLDEM6",197,0)
 ..; don't auto-update if there is an active Prescription record and
"RTN","IVMLDEM6",198,0)
 ..; the Bad Address Indicator is null
"RTN","IVMLDEM6",199,0)
 ..I 'DELFLG D DEMBULL^IVMPREC6 Q
"RTN","IVMLDEM6",200,0)
 ..;
"RTN","IVMLDEM6",201,0)
 ..; - load addr field rec'd from IVM into DHCP (#2) file
"RTN","IVMLDEM6",202,0)
 ..I 'NOUPDT D UPLOAD(+DFN,$P($G(^IVM(301.92,+IVMNODE,0)),"^",5),$P(IVMNODE,"^",2)) S IVMFLAG=1
"RTN","IVMLDEM6",203,0)
 ..;
"RTN","IVMLDEM6",204,0)
 ..; - remove entry from (#301.511) sub-file
"RTN","IVMLDEM6",205,0)
 ..D DELENT^IVMLDEMU(IVMDA2,IVMDA1,IVMJ)
"RTN","IVMLDEM6",206,0)
 ..; - if no display or uploadable fields left, then delete the PID
"RTN","IVMLDEM6",207,0)
 ..;   segment
"RTN","IVMLDEM6",208,0)
 ..I '$$DEMO^IVMLDEM5(IVMDA2,IVMDA1,0),'$$DEMO^IVMLDEM5(IVMDA2,IVMDA1,1) D
"RTN","IVMLDEM6",209,0)
 ...D DELETE^IVMLDEM5(IVMDA2,IVMDA1," ") ; Dummy up name parameter
"RTN","IVMLDEM6",210,0)
 I IVMFLAG D
"RTN","IVMLDEM6",211,0)
 .N DGCURR
"RTN","IVMLDEM6",212,0)
 .D GETUPDTS^DGADDUTL(DFN,.DGCURR)
"RTN","IVMLDEM6",213,0)
 .D UPDADDLG^DGADDUTL(DFN,.DGPRIOR,.DGCURR)
"RTN","IVMLDEM6",214,0)
 Q IVMFLAG
"RTN","IVMLDEM6",215,0)
 ;
"RTN","IVMLDEM6",216,0)
ADDRDT(DFN,IVMDA2,IVMDA1) ;
"RTN","IVMLDEM6",217,0)
 ; - validate Address Change Dt/Tm before filing
"RTN","IVMLDEM6",218,0)
 ;   if incoming address is accepted and the change date is older
"RTN","IVMLDEM6",219,0)
 ;   than what's on file, then use today's date for Addr Chg Dt/Tm
"RTN","IVMLDEM6",220,0)
 ;
"RTN","IVMLDEM6",221,0)
 Q:'$$ADRDTCK^IVMLDEM9(DFN,IVMDA2,IVMDA1)
"RTN","IVMLDEM6",222,0)
 N FDA,IEN92,IVMDA,IENS,ERR
"RTN","IVMLDEM6",223,0)
 S IEN92=$O(^IVM(301.92,"C","RF171","")) Q:'IEN92
"RTN","IVMLDEM6",224,0)
 Q:'$D(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IEN92))
"RTN","IVMLDEM6",225,0)
 S IVMDA=$O(^IVM(301.5,IVMDA2,"IN",IVMDA1,"DEM","B",IEN92,"")) Q:'IVMDA
"RTN","IVMLDEM6",226,0)
 S IENS=IVMDA_","_IVMDA1_","_IVMDA2_","
"RTN","IVMLDEM6",227,0)
 S FDA(301.511,IENS,.02)=$$NOW^XLFDT
"RTN","IVMLDEM6",228,0)
 D FILE^DIE("","FDA","ERR")
"RTN","IVMLDEM6",229,0)
 Q
"RTN","IVMLDEM6",230,0)
 ;
"RTN","IVMLDEM6",231,0)
PHARM(DFN) ;does this patient have active pharmacy prescriptions?
"RTN","IVMLDEM6",232,0)
 ;
"RTN","IVMLDEM6",233,0)
 ;External reference to $$EN^PSSRXACT supported by IA #4237
"RTN","IVMLDEM6",234,0)
 ;
"RTN","IVMLDEM6",235,0)
 Q $S('$G(DFN):0,1:$$EN^PSSRXACT(DFN))
"VER")
8.0^22.0
"BLD",7094,6)
^104
**END**
**END**
