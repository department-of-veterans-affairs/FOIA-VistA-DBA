Released PSS*1*118 SEQ #109
Extracted from mail message
**KIDS**:PSS*1.0*118^

**INSTALL NAME**
PSS*1.0*118
"BLD",6388,0)
PSS*1.0*118^PHARMACY DATA MANAGEMENT^0^3070109^y
"BLD",6388,1,0)
^^20^20^3061109^
"BLD",6388,1,1,0)
This patch adds ORDERABLE ITEM field (#108) from the PHARMACY PATIENT 
"BLD",6388,1,2,0)
file (#55), NAME field (#.01) from the PHARMACY ORDERABLE ITEM file 
"BLD",6388,1,3,0)
(#50.7), DOSAGE FORM field (#.02) from the PHARMACY ODERABLE ITEM file 
"BLD",6388,1,4,0)
(#50.07), and NAME field (#.01) from the DOSAGE FORM file (#50.606) to 
"BLD",6388,1,5,0)
the following APIs.
"BLD",6388,1,6,0)
 
"BLD",6388,1,7,0)
* PSS431^PSS55
"BLD",6388,1,8,0)
* PSS432^PSS55
"BLD",6388,1,9,0)
* PSS433^PSS55
"BLD",6388,1,10,0)
* PSS435^PSS55
"BLD",6388,1,11,0)
* PSS436^PSS55
"BLD",6388,1,12,0)
 
"BLD",6388,1,13,0)
Additionally, this patch clears up an issue in DIC^PSSDI, DATA^PSS50, 
"BLD",6388,1,14,0)
ALL^PSS51P2, and MIX^PSSDI where in rare circumstances, an error could
"BLD",6388,1,15,0)
occur due to incorrect API initialization.
"BLD",6388,1,16,0)
 
"BLD",6388,1,17,0)
Finally, this patch introduces the parameter PSSFREQ to AP^PSS51P1.  
"BLD",6388,1,18,0)
PSSFREQ is compared to the FREQUENCY field (#2) in the ADMINISTRATION 
"BLD",6388,1,19,0)
SCHEDULE file (#51.1) to filter records based on the frequency of 
"BLD",6388,1,20,0)
delivery.
"BLD",6388,4,0)
^9.64PA^^
"BLD",6388,6.3)
8
"BLD",6388,"ABPKG")
n
"BLD",6388,"KRN",0)
^9.67PA^8989.52^19
"BLD",6388,"KRN",.4,0)
.4
"BLD",6388,"KRN",.401,0)
.401
"BLD",6388,"KRN",.402,0)
.402
"BLD",6388,"KRN",.403,0)
.403
"BLD",6388,"KRN",.5,0)
.5
"BLD",6388,"KRN",.84,0)
.84
"BLD",6388,"KRN",3.6,0)
3.6
"BLD",6388,"KRN",3.8,0)
3.8
"BLD",6388,"KRN",9.2,0)
9.2
"BLD",6388,"KRN",9.8,0)
9.8
"BLD",6388,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",6388,"KRN",9.8,"NM",1,0)
PSS55^^0^B48173815
"BLD",6388,"KRN",9.8,"NM",2,0)
PSSDI^^0^B34671411
"BLD",6388,"KRN",9.8,"NM",3,0)
PSS51P1^^0^B18714317
"BLD",6388,"KRN",9.8,"NM",4,0)
PSS51P1A^^0^B55592695
"BLD",6388,"KRN",9.8,"NM",5,0)
PSS51P1B^^0^B44061032
"BLD",6388,"KRN",9.8,"NM",6,0)
PSS551^^0^B15638671
"BLD",6388,"KRN",9.8,"NM",7,0)
PSS50DAT^^0^B59458374
"BLD",6388,"KRN",9.8,"NM",8,0)
PSS51P2^^0^B45679954
"BLD",6388,"KRN",9.8,"NM","B","PSS50DAT",7)

"BLD",6388,"KRN",9.8,"NM","B","PSS51P1",3)

"BLD",6388,"KRN",9.8,"NM","B","PSS51P1A",4)

"BLD",6388,"KRN",9.8,"NM","B","PSS51P1B",5)

"BLD",6388,"KRN",9.8,"NM","B","PSS51P2",8)

"BLD",6388,"KRN",9.8,"NM","B","PSS55",1)

"BLD",6388,"KRN",9.8,"NM","B","PSS551",6)

"BLD",6388,"KRN",9.8,"NM","B","PSSDI",2)

"BLD",6388,"KRN",19,0)
19
"BLD",6388,"KRN",19.1,0)
19.1
"BLD",6388,"KRN",101,0)
101
"BLD",6388,"KRN",409.61,0)
409.61
"BLD",6388,"KRN",771,0)
771
"BLD",6388,"KRN",870,0)
870
"BLD",6388,"KRN",8989.51,0)
8989.51
"BLD",6388,"KRN",8989.52,0)
8989.52
"BLD",6388,"KRN",8994,0)
8994
"BLD",6388,"KRN","B",.4,.4)

"BLD",6388,"KRN","B",.401,.401)

"BLD",6388,"KRN","B",.402,.402)

"BLD",6388,"KRN","B",.403,.403)

"BLD",6388,"KRN","B",.5,.5)

"BLD",6388,"KRN","B",.84,.84)

"BLD",6388,"KRN","B",3.6,3.6)

"BLD",6388,"KRN","B",3.8,3.8)

"BLD",6388,"KRN","B",9.2,9.2)

"BLD",6388,"KRN","B",9.8,9.8)

"BLD",6388,"KRN","B",19,19)

"BLD",6388,"KRN","B",19.1,19.1)

"BLD",6388,"KRN","B",101,101)

"BLD",6388,"KRN","B",409.61,409.61)

"BLD",6388,"KRN","B",771,771)

"BLD",6388,"KRN","B",870,870)

"BLD",6388,"KRN","B",8989.51,8989.51)

"BLD",6388,"KRN","B",8989.52,8989.52)

"BLD",6388,"KRN","B",8994,8994)

"BLD",6388,"QUES",0)
^9.62^^
"BLD",6388,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
118^3070109
"PKG",517,22,1,"PAH",1,1,0)
^^20^20^3070109
"PKG",517,22,1,"PAH",1,1,1,0)
This patch adds ORDERABLE ITEM field (#108) from the PHARMACY PATIENT 
"PKG",517,22,1,"PAH",1,1,2,0)
file (#55), NAME field (#.01) from the PHARMACY ORDERABLE ITEM file 
"PKG",517,22,1,"PAH",1,1,3,0)
(#50.7), DOSAGE FORM field (#.02) from the PHARMACY ODERABLE ITEM file 
"PKG",517,22,1,"PAH",1,1,4,0)
(#50.07), and NAME field (#.01) from the DOSAGE FORM file (#50.606) to 
"PKG",517,22,1,"PAH",1,1,5,0)
the following APIs.
"PKG",517,22,1,"PAH",1,1,6,0)
 
"PKG",517,22,1,"PAH",1,1,7,0)
* PSS431^PSS55
"PKG",517,22,1,"PAH",1,1,8,0)
* PSS432^PSS55
"PKG",517,22,1,"PAH",1,1,9,0)
* PSS433^PSS55
"PKG",517,22,1,"PAH",1,1,10,0)
* PSS435^PSS55
"PKG",517,22,1,"PAH",1,1,11,0)
* PSS436^PSS55
"PKG",517,22,1,"PAH",1,1,12,0)
 
"PKG",517,22,1,"PAH",1,1,13,0)
Additionally, this patch clears up an issue in DIC^PSSDI, DATA^PSS50, 
"PKG",517,22,1,"PAH",1,1,14,0)
ALL^PSS51P2, and MIX^PSSDI where in rare circumstances, an error could
"PKG",517,22,1,"PAH",1,1,15,0)
occur due to incorrect API initialization.
"PKG",517,22,1,"PAH",1,1,16,0)
 
"PKG",517,22,1,"PAH",1,1,17,0)
Finally, this patch introduces the parameter PSSFREQ to AP^PSS51P1.  
"PKG",517,22,1,"PAH",1,1,18,0)
PSSFREQ is compared to the FREQUENCY field (#2) in the ADMINISTRATION 
"PKG",517,22,1,"PAH",1,1,19,0)
SCHEDULE file (#51.1) to filter records based on the frequency of 
"PKG",517,22,1,"PAH",1,1,20,0)
delivery.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","PSS50DAT")
0^7^B59458374^B58906701
"RTN","PSS50DAT",1,0)
PSS50DAT ;BHAM ISC/TSS - CONTINUATION OF API FOR INFORMATION FROM FILE 50; 5 Sep 03 
"RTN","PSS50DAT",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**85,92,112,118**;9/30/97;Build 8
"RTN","PSS50DAT",3,0)
DATA ;
"RTN","PSS50DAT",4,0)
 ;PSSIEN - IEN of entry in 50
"RTN","PSS50DAT",5,0)
 ;PSSFT - Free Text name in 50
"RTN","PSS50DAT",6,0)
 ;PSSFL - Inactive flag - "" - All entries
"RTN","PSS50DAT",7,0)
 ;                        FileMan Date - Only entries with no Inactive Date or an Inactive Date greater than this date.
"RTN","PSS50DAT",8,0)
 ;PSSPK - Application Package's Use - "" - All entries
"RTN","PSS50DAT",9,0)
 ;                                         Alphabetic codes that represent the DHCP packages that consider this drug to be
"RTN","PSS50DAT",10,0)
 ;                                         part of their formulary.
"RTN","PSS50DAT",11,0)
 ;PSSRTOI - Orderable Item - return only entries matched to a Pharmacy Orderable Item                                         
"RTN","PSS50DAT",12,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the Field Number of the data
"RTN","PSS50DAT",13,0)
 ;       piece being returned.
"RTN","PSS50DAT",14,0)
 ;Reference to ^PSNDF(50.68 is supported by DBIA 3735
"RTN","PSS50DAT",15,0)
 ;NEW UNPROTECTED FILEMAN VARIABLES
"RTN","PSS50DAT",16,0)
 N DO,DINDEX,DISUB,DIVAL
"RTN","PSS50DAT",17,0)
 N PSSBGCNT
"RTN","PSS50DAT",18,0)
 N PSSCNT
"RTN","PSS50DAT",19,0)
 N PSSTIEN
"RTN","PSS50DAT",20,0)
 N PSSTMP
"RTN","PSS50DAT",21,0)
 N PSSOLD
"RTN","PSS50DAT",22,0)
 N PSSALT
"RTN","PSS50DAT",23,0)
 N PSSMATCH
"RTN","PSS50DAT",24,0)
 N PSSSYN
"RTN","PSS50DAT",25,0)
 N PSSCAP
"RTN","PSS50DAT",26,0)
 S PSSBGCNT=0
"RTN","PSS50DAT",27,0)
 S SCR("S")=""
"RTN","PSS50DAT",28,0)
 I $G(LIST)']"" Q
"RTN","PSS50DAT",29,0)
 I +$G(PSSIEN)'>0,($G(PSSFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS50DAT",30,0)
 K ^TMP("DILIST",$J)
"RTN","PSS50DAT",31,0)
 K ^TMP($J,LIST)
"RTN","PSS50DAT",32,0)
 S SCR("S")=""
"RTN","PSS50DAT",33,0)
 I +$G(PSSFL)>0!($G(PSSPK)]"")!($G(PSSRTOI)=1) N PSS5ND,PSSZ3,PSSZ4 D SETSCRN^PSS50A
"RTN","PSS50DAT",34,0)
 I +$G(PSSIEN)>0 N PSSIEN2 S PSSIEN2=$$FIND1^DIC(50,"","A","`"_PSSIEN,,SCR("S"),"") D  K ^TMP("PSSP50",$J) D COUNTBG Q
"RTN","PSS50DAT",35,0)
 .I PSSIEN2>0 D DIRREAD
"RTN","PSS50DAT",36,0)
 I +$G(PSSIEN)=0 D
"RTN","PSS50DAT",37,0)
 .I PSSFT="??" D LOOPDIR D COUNTBG Q
"RTN","PSS50DAT",38,0)
 .D FIND^DIC(50,,"@;.01","QP",PSSFT,,"B",SCR("S"),,"") D LOOPDI D COUNTBG
"RTN","PSS50DAT",39,0)
 Q
"RTN","PSS50DAT",40,0)
 ;
"RTN","PSS50DAT",41,0)
COUNTBG ;CHECKS PSSBGCNT AND FILLS COUNT IN ON 0 NODE OF ^TMP($J,LIST)
"RTN","PSS50DAT",42,0)
 I PSSBGCNT>0 D
"RTN","PSS50DAT",43,0)
 .S ^TMP($J,LIST,0)=PSSBGCNT
"RTN","PSS50DAT",44,0)
 ELSE  S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND"
"RTN","PSS50DAT",45,0)
 Q
"RTN","PSS50DAT",46,0)
 ;
"RTN","PSS50DAT",47,0)
LOOPDI ;LOOPS ON "DILIST" FROM FILEMAN CALL (USED FOR RETURNING MULTIPLE DRUGS FROM PSSFT)
"RTN","PSS50DAT",48,0)
 S PSSTIEN=0 ;TEMP IEN TO ITERATE OVER DILIST
"RTN","PSS50DAT",49,0)
 F  S PSSTIEN=$O(^TMP("DILIST",$J,PSSTIEN)) Q:PSSTIEN=""  D
"RTN","PSS50DAT",50,0)
 .S PSSIEN2=($P(^TMP("DILIST",$J,PSSTIEN,0),U,1))
"RTN","PSS50DAT",51,0)
 .D DIRREAD
"RTN","PSS50DAT",52,0)
 Q
"RTN","PSS50DAT",53,0)
 ;
"RTN","PSS50DAT",54,0)
LOOPDIR ;LOOP FOR A DIRECT READ.  READS ALL IENs FOR ^PSDRUG(
"RTN","PSS50DAT",55,0)
 S PSSIEN2=0
"RTN","PSS50DAT",56,0)
 F  S PSSIEN2=$O(^PSDRUG(PSSIEN2)) Q:'PSSIEN2  D
"RTN","PSS50DAT",57,0)
 .I $P($G(^PSDRUG(PSSIEN2,0)),U,1)'="" D DIRALL
"RTN","PSS50DAT",58,0)
 Q
"RTN","PSS50DAT",59,0)
 ;
"RTN","PSS50DAT",60,0)
DIRALL ;TEST FOR PSSFL, PSSRTOI, PSSPK, BAILS IF CONDITIONS MEET TRUE
"RTN","PSS50DAT",61,0)
 I $G(PSSFL),$P($G(^PSDRUG(PSSIEN2,"I")),"^"),$P($G(^("I")),"^")'>PSSFL Q
"RTN","PSS50DAT",62,0)
 I $G(PSSRTOI)=1,'$P($G(^PSDRUG(PSSIEN2,2)),"^") Q
"RTN","PSS50DAT",63,0)
 I $G(PSSPK)]"" N PSSZ5,PSSZ6 S PSSZ5=0 F PSSZ6=1:1:$L(PSSPK) Q:PSSZ5  I $P($G(^PSDRUG(PSSIEN2,2)),U,3)[$E(PSSPK,PSSZ6) S PSSZ5=1
"RTN","PSS50DAT",64,0)
 I $G(PSSPK)]"",'PSSZ5 Q
"RTN","PSS50DAT",65,0)
 D DIRREAD
"RTN","PSS50DAT",66,0)
 Q
"RTN","PSS50DAT",67,0)
 ;
"RTN","PSS50DAT",68,0)
DIRREAD ;MAIN DIRECT READ FOR ENTIRE ROUTINE
"RTN","PSS50DAT",69,0)
 D DIRREAD^PSS50TMP
"RTN","PSS50DAT",70,0)
 D SYNONYM
"RTN","PSS50DAT",71,0)
 S ^TMP($J,LIST,"B",$G(^TMP($J,LIST,PSSIEN2,.01)),PSSIEN2)=""
"RTN","PSS50DAT",72,0)
 D FORMALT
"RTN","PSS50DAT",73,0)
 D OLD
"RTN","PSS50DAT",74,0)
 D SRVCODE($P(^TMP($J,LIST,PSSIEN2,22),U,1))
"RTN","PSS50DAT",75,0)
 S PSSBGCNT=PSSBGCNT+1
"RTN","PSS50DAT",76,0)
 Q
"RTN","PSS50DAT",77,0)
 ;
"RTN","PSS50DAT",78,0)
SYNONYM ; FILLS SYNONYM MULTIPLE
"RTN","PSS50DAT",79,0)
 S PSSCNT=0
"RTN","PSS50DAT",80,0)
 S PSSTMP=""
"RTN","PSS50DAT",81,0)
 S PSSSYN=""
"RTN","PSS50DAT",82,0)
 F  S PSSSYN=$O(^PSDRUG(PSSIEN2,1,PSSSYN)) Q:PSSSYN=""  D
"RTN","PSS50DAT",83,0)
 .I $P($G(^PSDRUG(PSSIEN2,1,PSSSYN,0)),U,1)'="" D
"RTN","PSS50DAT",84,0)
 ..S ^TMP($J,LIST,PSSIEN2,"SYN",PSSSYN,.01)=$P($G(^PSDRUG(PSSIEN2,1,PSSSYN,0)),U,1)
"RTN","PSS50DAT",85,0)
 ..;;;;;INTENDED USE
"RTN","PSS50DAT",86,0)
 ..S PSSTMP=$P($G(^PSDRUG(PSSIEN2,1,PSSSYN,0)),U,3)
"RTN","PSS50DAT",87,0)
 ..I PSSTMP="0" S ^TMP($J,LIST,PSSIEN2,"SYN",PSSSYN,1)=PSSTMP_U_"TRADE NAME"
"RTN","PSS50DAT",88,0)
 ..I PSSTMP="1" S ^TMP($J,LIST,PSSIEN2,"SYN",PSSSYN,1)=PSSTMP_U_"QUICK CODE"
"RTN","PSS50DAT",89,0)
 ..I PSSTMP="D" S ^TMP($J,LIST,PSSIEN2,"SYN",PSSSYN,1)=PSSTMP_U_"DRUG ACCOUNTABILITY"
"RTN","PSS50DAT",90,0)
 ..I PSSTMP="C" S ^TMP($J,LIST,PSSIEN2,"SYN",PSSSYN,1)=PSSTMP_U_"CONTROLLED SUBSTANCES"
"RTN","PSS50DAT",91,0)
 ..I PSSTMP="" S ^TMP($J,LIST,PSSIEN2,"SYN",PSSSYN,1)=""
"RTN","PSS50DAT",92,0)
 ..;;;;;NDC CODE
"RTN","PSS50DAT",93,0)
 ..S ^TMP($J,LIST,PSSIEN2,"SYN",PSSSYN,2)=$P($G(^PSDRUG(PSSIEN2,1,PSSSYN,0)),U,2)
"RTN","PSS50DAT",94,0)
 ..S ^TMP($J,LIST,PSSIEN2,"SYN",PSSSYN,403)=$P($G(^PSDRUG(PSSIEN2,1,PSSSYN,0)),U,7)
"RTN","PSS50DAT",95,0)
 ..S PSSCNT=PSSCNT+1
"RTN","PSS50DAT",96,0)
 I PSSCNT=0 S ^TMP($J,LIST,PSSIEN2,"SYN",0)="-1^NO DATA FOUND"
"RTN","PSS50DAT",97,0)
 ELSE  S ^TMP($J,LIST,PSSIEN2,"SYN",0)=PSSCNT
"RTN","PSS50DAT",98,0)
 Q
"RTN","PSS50DAT",99,0)
 ;
"RTN","PSS50DAT",100,0)
FORMALT ;FILLS FORMULARY ALTERATIVE MULTIPLE
"RTN","PSS50DAT",101,0)
 S PSSCNT=0
"RTN","PSS50DAT",102,0)
 S PSSALT=0
"RTN","PSS50DAT",103,0)
 F  S PSSALT=$O(^PSDRUG(PSSIEN2,65,PSSALT)) Q:PSSALT=""  D
"RTN","PSS50DAT",104,0)
 .I $P($G(^PSDRUG(PSSIEN2,65,PSSALT,0)),U,1)'="" D
"RTN","PSS50DAT",105,0)
 ..S ^TMP($J,LIST,PSSIEN2,"FRM",PSSALT,2)=$P($G(^PSDRUG(PSSIEN2,65,PSSALT,0)),U,1)_U_$P($G(^PSDRUG($P($G(^PSDRUG(PSSIEN2,65,PSSALT,0)),U,1),0)),U,1)
"RTN","PSS50DAT",106,0)
 ..S PSSCNT=PSSCNT+1
"RTN","PSS50DAT",107,0)
 I PSSCNT=0 S ^TMP($J,LIST,PSSIEN2,"FRM",0)="-1^NO DATA FOUND"
"RTN","PSS50DAT",108,0)
 ELSE  S ^TMP($J,LIST,PSSIEN2,"FRM",0)=PSSCNT
"RTN","PSS50DAT",109,0)
 Q
"RTN","PSS50DAT",110,0)
 ;
"RTN","PSS50DAT",111,0)
OLD ;FILLS THE OLD NAME MULTIPLE
"RTN","PSS50DAT",112,0)
 S PSSCNT=0
"RTN","PSS50DAT",113,0)
 S PSSOLD=0
"RTN","PSS50DAT",114,0)
 F  S PSSOLD=$O(^PSDRUG(PSSIEN2,900,PSSOLD)) Q:PSSOLD=""  D
"RTN","PSS50DAT",115,0)
 .I $P($G(^PSDRUG(PSSIEN2,900,PSSOLD,0)),U,2)'="" D
"RTN","PSS50DAT",116,0)
 ..S PSSCAP=$$UP^XLFSTR($$FMTE^XLFDT($P(^PSDRUG(PSSIEN2,900,PSSOLD,0),U,2)))
"RTN","PSS50DAT",117,0)
 ..S ^TMP($J,LIST,PSSIEN2,"OLD",PSSOLD,.02)=$P($G(^PSDRUG(PSSIEN2,900,PSSOLD,0)),U,2)_U_PSSCAP
"RTN","PSS50DAT",118,0)
 .ELSE  S ^TMP($J,LIST,PSSIEN2,"OLD",PSSOLD,.02)=""
"RTN","PSS50DAT",119,0)
 .I $P($G(^PSDRUG(PSSIEN2,900,PSSOLD,0)),U,1)'="" D
"RTN","PSS50DAT",120,0)
 ..S ^TMP($J,LIST,PSSIEN2,"OLD",PSSOLD,.01)=$P($G(^PSDRUG(PSSIEN2,900,PSSOLD,0)),U,1)
"RTN","PSS50DAT",121,0)
 ..S PSSCNT=PSSCNT+1
"RTN","PSS50DAT",122,0)
 .ELSE  S ^TMP($J,LIST,PSSIEN2,"OLD",PSSOLD,.01)=""
"RTN","PSS50DAT",123,0)
 I PSSCNT=0 S ^TMP($J,LIST,PSSIEN2,"OLD",0)="-1^NO DATA FOUND"
"RTN","PSS50DAT",124,0)
 ELSE  S ^TMP($J,LIST,PSSIEN2,"OLD",0)=PSSCNT
"RTN","PSS50DAT",125,0)
 Q
"RTN","PSS50DAT",126,0)
 ;
"RTN","PSS50DAT",127,0)
SRVCODE(PSSMATCH)     ;FILLS SERVICE CODE MULTIPLE
"RTN","PSS50DAT",128,0)
 I PSSMATCH'="" S ^TMP($J,LIST,PSSIEN2,400)=$P($G(^PSNDF(50.68,PSSMATCH,"PFS")),U,1)
"RTN","PSS50DAT",129,0)
 I $P($G(^TMP($J,LIST,PSSIEN2,400)),U,1)="" S ^TMP($J,LIST,PSSIEN2,400)=$P($G(^PSDRUG(PSSIEN2,"PFS")),U,1)
"RTN","PSS50DAT",130,0)
 I $P($G(^TMP($J,LIST,PSSIEN2,400)),U,1)="" S ^TMP($J,LIST,PSSIEN2,400)=600000
"RTN","PSS50DAT",131,0)
 Q
"RTN","PSS50DAT",132,0)
 ;
"RTN","PSS50DAT",133,0)
DRG ;
"RTN","PSS50DAT",134,0)
 ;PSSIEN - IEN of entry in 50
"RTN","PSS50DAT",135,0)
 ;PSSFT - Free Text name in 50
"RTN","PSS50DAT",136,0)
 ;PSSFL - Inactive flag - "" - All entries
"RTN","PSS50DAT",137,0)
 ;                        FileMan Date - Only entries with no Inactive Date or an Inactive Date greater than this date.
"RTN","PSS50DAT",138,0)
 ;PSSPK - Application Package's Use - "" - All entries
"RTN","PSS50DAT",139,0)
 ;                                         Alphabetic codes that represent the DHCP packages that consider this drug to be
"RTN","PSS50DAT",140,0)
 ;                                         part of their formulary.
"RTN","PSS50DAT",141,0)
 ;PSSRTOI - Orderable Item - return only entries matched to a Pharmacy Orderable Item
"RTN","PSS50DAT",142,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the Field Number of the data
"RTN","PSS50DAT",143,0)
 ;       piece being returned.
"RTN","PSS50DAT",144,0)
 N DIERR,ZZERR,PSSP50,SCR,PSS,PSSMLCT
"RTN","PSS50DAT",145,0)
 I $G(LIST)']"" Q
"RTN","PSS50DAT",146,0)
 K ^TMP($J,LIST)
"RTN","PSS50DAT",147,0)
 I +$G(PSSIEN)'>0,($G(PSSFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS50DAT",148,0)
 S SCR("S")=""
"RTN","PSS50DAT",149,0)
 I +$G(PSSFL)>0!($G(PSSPK)]"")!($G(PSSRTOI)=1) N PSS5ND,PSSZ3,PSSZ4 D SETSCRN^PSS50A
"RTN","PSS50DAT",150,0)
 I +$G(PSSIEN)>0 N PSSIEN2 S PSSIEN2=$$FIND1^DIC(50,"","A","`"_PSSIEN,,SCR("S"),"") D  K ^TMP("PSSP50",$J) Q
"RTN","PSS50DAT",151,0)
 .K ^TMP("DIERR",$J)
"RTN","PSS50DAT",152,0)
 .I +PSSIEN2'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS50DAT",153,0)
 .S ^TMP($J,LIST,0)=1
"RTN","PSS50DAT",154,0)
 .K ^TMP("PSSP50",$J) D GETS^DIQ(50,+PSSIEN2,".01;62.01:62.05;905","IE","^TMP(""PSSP50"",$J)") S PSS(1)=0
"RTN","PSS50DAT",155,0)
 .F  S PSS(1)=$O(^TMP("PSSP50",$J,50,PSS(1))) Q:'PSS(1)  D SETDRG^PSS50A1
"RTN","PSS50DAT",156,0)
 I $G(PSSIEN)'="" S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS50DAT",157,0)
 I $G(PSSFT)]"" D
"RTN","PSS50DAT",158,0)
 .I PSSFT["??" D LOOP^PSS50A1 Q
"RTN","PSS50DAT",159,0)
 .K ^TMP("DILIST",$J)
"RTN","PSS50DAT",160,0)
 .D FIND^DIC(50,,"@;.01","QP",PSSFT,,"B",SCR("S"),,"")
"RTN","PSS50DAT",161,0)
 .I +$G(^TMP("DILIST",$J,0))=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS50DAT",162,0)
 .I +^TMP("DILIST",$J,0)>0 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0) N PSSXX S PSSXX=0 F  S PSSXX=$O(^TMP("DILIST",$J,PSSXX)) Q:'PSSXX  D
"RTN","PSS50DAT",163,0)
 ..S PSSIEN=+^TMP("DILIST",$J,PSSXX,0)
"RTN","PSS50DAT",164,0)
 ..K ^TMP("PSSP50",$J) D GETS^DIQ(50,+PSSIEN,".01;62.01:62.05;905","IE","^TMP(""PSSP50"",$J)") S PSS(1)=0
"RTN","PSS50DAT",165,0)
 ..F  S PSS(1)=$O(^TMP("PSSP50",$J,50,PSS(1))) Q:'PSS(1)  D SETDRG^PSS50A1
"RTN","PSS50DAT",166,0)
 K ^TMP("DILIST",$J),^TMP("PSSP50",$J)
"RTN","PSS50DAT",167,0)
 Q
"RTN","PSS50DAT",168,0)
 ;
"RTN","PSS50DAT",169,0)
LOOP ;
"RTN","PSS50DAT",170,0)
 N PSS50DD1,PSS50DD2,PSS50DD3,PSS50DD4,PSS50ER1,PSS50ER2,PSS50ER3,PSS50ER4,PSS51NFD,PSS52NFD,PSSG2N,PSS501NX
"RTN","PSS50DAT",171,0)
 D FIELD^DID(50,51,"Z","POINTER","PSS50DD1","PSS50ER1") S PSS51NFD=$G(PSS50DD1("POINTER"))
"RTN","PSS50DAT",172,0)
 D FIELD^DID(50,52,"Z","POINTER","PSS50DD2","PSS50ER2") S PSS52NFD=$G(PSS50DD2("POINTER"))
"RTN","PSS50DAT",173,0)
 D FIELD^DID(50,301,"Z","POINTER","PSS50DD3","PSS50ER3") S PSSG2N=$G(PSS50DD3("POINTER"))
"RTN","PSS50DAT",174,0)
 D FIELD^DID(50.1,1,"Z","POINTER","PSS50DD4","PSS50ER4") S PSS501NX=$G(PSS50DD4("POINTER"))
"RTN","PSS50DAT",175,0)
 N PSSENCT
"RTN","PSS50DAT",176,0)
 S PSSENCT=0
"RTN","PSS50DAT",177,0)
 S PSS(1)=0 F  S PSS(1)=$O(^PSDRUG(PSS(1))) Q:'PSS(1)  D
"RTN","PSS50DAT",178,0)
 .I $P($G(^PSDRUG(PSS(1),0)),"^")="" Q
"RTN","PSS50DAT",179,0)
 .I $G(PSSFL),$P($G(^PSDRUG(PSS(1),"I")),"^"),$P($G(^("I")),"^")'>PSSFL Q
"RTN","PSS50DAT",180,0)
 .I $G(PSSRTOI)=1,'$P($G(^PSDRUG(PSS(1),2)),"^") Q
"RTN","PSS50DAT",181,0)
 .;Naked reference below refers to ^PSDRUG(PSS(1),2)
"RTN","PSS50DAT",182,0)
 .I $G(PSSPK)]"" N PSSZ5,PSSZ6 S PSSZ5=0 F PSSZ6=1:1:$L(PSSPK) Q:PSSZ5  I $P($G(^(2)),"^",3)[$E(PSSPK,PSSZ6) S PSSZ5=1
"RTN","PSS50DAT",183,0)
 .I $G(PSSPK)]"",'PSSZ5 Q
"RTN","PSS50DAT",184,0)
 .D SETSUB1^PSS50AQM(PSS(1)),SETSUB2^PSS50AQM(PSS(1)),SETSUB3^PSS50AQM(PSS(1))
"RTN","PSS50DAT",185,0)
 .D SETALL^PSS50AQM,SETOLD^PSS50AQM,SETSYN^PSS50AQM,SETFMA^PSS50AQM
"RTN","PSS50DAT",186,0)
 .S PSSENCT=PSSENCT+1
"RTN","PSS50DAT",187,0)
 S ^TMP($J,LIST,0)=$S($G(PSSENCT):$G(PSSENCT),1:"-1^NO DATA FOUND")
"RTN","PSS50DAT",188,0)
 Q
"RTN","PSS51P1")
0^3^B18714317^B16972270
"RTN","PSS51P1",1,0)
PSS51P1 ;BIR/LDT - API FOR INFORMATION FROM FILE 51.1 ;5 Sep 03
"RTN","PSS51P1",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**85,91,108,118**;9/30/97;Build 8
"RTN","PSS51P1",3,0)
 ;
"RTN","PSS51P1",4,0)
ZERO(PSSIEN,PSSFT,PSSPP,PSSTSCH,LIST) ;
"RTN","PSS51P1",5,0)
 ;PSSIEN - IEN of entry in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",6,0)
 ;PSSFT - Free Text name in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",7,0)
 ;PSSPP - PACKAGE PREFIX field (#4) in ADMINISTRATION SCHEDULE file (#51.1). Screens for Administration
"RTN","PSS51P1",8,0)
 ;Schedules for the Package Prefix passed.
"RTN","PSS51P1",9,0)
 ;PSSTSCH - TYPE OF SCHEDULE field (#5) of ADMINISTRATION SCHEDULE file (#51.1). Screens for
"RTN","PSS51P1",10,0)
 ;          One-time "O" if PSSTSCH passed in.
"RTN","PSS51P1",11,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the
"RTN","PSS51P1",12,0)
 ;       Field Number of the data piece being returned.
"RTN","PSS51P1",13,0)
 ;Returns NAME field (#.01), STANDARD ADMINISTRATION TIMES field (#1), FREQUENCY (IN MINUTES) field (#2),
"RTN","PSS51P1",14,0)
 ;MAXIMUM DAYS FOR ORDERS field (#2.5), PACKAGE PREFIX field (#4), TYPE OF SCHEDULE field (#5),
"RTN","PSS51P1",15,0)
 ;STANDARD SHIFTS field (#6), OUTPATIENT EXPANSION field (#8), and OTHER LANGUAGE EXPANSIONS field (#8.1)
"RTN","PSS51P1",16,0)
 ;of ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",17,0)
 N DIERR,ZZERR,PSS51P1,SCR,PSS
"RTN","PSS51P1",18,0)
 I $G(LIST)']"" Q
"RTN","PSS51P1",19,0)
 K ^TMP($J,LIST)
"RTN","PSS51P1",20,0)
 I +$G(PSSIEN)'>0,($G(PSSFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1",21,0)
 I $G(PSSIEN)]"",+$G(PSSIEN)'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1",22,0)
 I $G(PSSTSCH)]"",PSSTSCH'="O" S PSSTSCH=""
"RTN","PSS51P1",23,0)
 S SCR("S")="" I $G(PSSTSCH)]""!$G(PSSPP)]"" D SETSCR
"RTN","PSS51P1",24,0)
 I +$G(PSSIEN)>0 N PSSIEN2 S PSSIEN2=$$FIND1^DIC(51.1,"","A","`"_PSSIEN,"B",SCR("S"),"") D
"RTN","PSS51P1",25,0)
 .I +PSSIEN2'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1",26,0)
 .S ^TMP($J,LIST,0)=1
"RTN","PSS51P1",27,0)
 .D GETS^DIQ(51.1,+PSSIEN2,".01;1;2;4;5;6;2.5;8;8.1","IE","PSS51P1") S PSS(1)=0
"RTN","PSS51P1",28,0)
 .F  S PSS(1)=$O(PSS51P1(51.1,PSS(1))) Q:'PSS(1)  D SETZRO^PSS51P1B
"RTN","PSS51P1",29,0)
 I +$G(PSSIEN)'>0,$G(PSSFT)]"" D
"RTN","PSS51P1",30,0)
 .I PSSFT["??" D LOOP^PSS51P1B(1) Q
"RTN","PSS51P1",31,0)
 .D FIND^DIC(51.1,,"@;.01;1","QP",PSSFT,,"B",SCR("S"),,"")
"RTN","PSS51P1",32,0)
 .I +$G(^TMP("DILIST",$J,0))=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1",33,0)
 .I +^TMP("DILIST",$J,0)>0 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0) N PSSXX S PSSXX=0 F  S PSSXX=$O(^TMP("DILIST",$J,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P1",34,0)
 ..S PSSIEN=+^TMP("DILIST",$J,PSSXX,0) K PSS51P1 D GETS^DIQ(51.1,+PSSIEN,".01;1;2;4;5;6;2.5;8;8.1","IE","PSS51P1") S PSS(1)=0
"RTN","PSS51P1",35,0)
 ..F  S PSS(1)=$O(PSS51P1(51.1,PSS(1))) Q:'PSS(1)  D SETZRO^PSS51P1B
"RTN","PSS51P1",36,0)
 K ^TMP("DILIST",$J)
"RTN","PSS51P1",37,0)
 Q
"RTN","PSS51P1",38,0)
 ;
"RTN","PSS51P1",39,0)
WARD(PSSIEN,PSSFT,PSSIEN2,LIST) ;
"RTN","PSS51P1",40,0)
 ;PSSIEN - IEN of entry in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",41,0)
 ;PSSFT - Free Text name in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",42,0)
 ;PSSIEN2 - IEN of entry in WARD sub-file (#51.11)
"RTN","PSS51P1",43,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the
"RTN","PSS51P1",44,0)
 ;       Field Number of the data piece being returned.
"RTN","PSS51P1",45,0)
 ;Returns NAME field (#.01), WARD multiple (#51.11) WARD field (#.01), and WARD ADMINISTRATION TIMES field (#1)
"RTN","PSS51P1",46,0)
 ;of ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",47,0)
 N DIERR,ZZERR,PSS51P1,PSS,CNT
"RTN","PSS51P1",48,0)
 S CNT=0
"RTN","PSS51P1",49,0)
 I $G(LIST)']"" Q
"RTN","PSS51P1",50,0)
 K ^TMP($J,LIST)
"RTN","PSS51P1",51,0)
 I +$G(PSSIEN)'>0,($G(PSSFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1",52,0)
 I $G(PSSIEN)]"",+$G(PSSIEN)'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1",53,0)
 I $G(PSSIEN2)]"",+$G(PSSIEN2)'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1",54,0)
 D WARD^PSS51P1C
"RTN","PSS51P1",55,0)
 Q
"RTN","PSS51P1",56,0)
 ;
"RTN","PSS51P1",57,0)
HOSP(PSSIEN,PSSFT,LIST) ;
"RTN","PSS51P1",58,0)
 ;PSSIEN - IEN of entry in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",59,0)
 ;PSSFT - Free Text name in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",60,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the
"RTN","PSS51P1",61,0)
 ;       Field Number of the data piece being returned.
"RTN","PSS51P1",62,0)
 ;Returns NAME field (#.01), HOSPITAL LOCATION multiple (#51.17) HOSPITAL LOCATION field (#.01), ADMINISTRATION TIMES field (#1),
"RTN","PSS51P1",63,0)
 ;and SHIFTS field (#2) of ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",64,0)
 N DIERR,ZZERR,PSS51P1,SCR,PSS,CNT
"RTN","PSS51P1",65,0)
 I $G(LIST)']"" Q
"RTN","PSS51P1",66,0)
 D HOSP^PSS51P1A
"RTN","PSS51P1",67,0)
 Q
"RTN","PSS51P1",68,0)
 ;
"RTN","PSS51P1",69,0)
IEN(PSSFT,LIST) ;
"RTN","PSS51P1",70,0)
 ;PSSFT - Free Text name in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",71,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the
"RTN","PSS51P1",72,0)
 ;       Field Number of the data piece being returned.
"RTN","PSS51P1",73,0)
 ;Returns NAME field (#.01) and STANDARD ADMINISTRATION TIMES field (#1) of ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",74,0)
 N DIERR,ZZERR,PSS51P1,SCR,PSS
"RTN","PSS51P1",75,0)
 I $G(LIST)']"" Q
"RTN","PSS51P1",76,0)
 K ^TMP($J,LIST)
"RTN","PSS51P1",77,0)
 I $G(PSSFT)']"" S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1",78,0)
 D IEN^PSS51P1A
"RTN","PSS51P1",79,0)
 Q
"RTN","PSS51P1",80,0)
 ;
"RTN","PSS51P1",81,0)
AP(PSSPP,PSSFT,PSSWDIEN,PSSTYP,LIST,PSSFREQ) ;
"RTN","PSS51P1",82,0)
 ;PSSPP - PACKAGE PREFIX in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",83,0)
 ;PSSFT - Free Text name in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",84,0)
 ;PSSWDIEN - IEN of entry of WARD multiple in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",85,0)
 ;PSSSTYP - TYPE OF SCHEDULE field (#5) in ADMINISTRATION SCHEDULE file (#51.1). 
"RTN","PSS51P1",86,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the
"RTN","PSS51P1",87,0)
 ;       Field Number of the data piece being returned.
"RTN","PSS51P1",88,0)
 ;Returns NAME field (#.01), STANDARD ADMINISTRATION TIMES field (#1), and PACKAGE PREFIX field (#4)
"RTN","PSS51P1",89,0)
 ;of ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",90,0)
 ;If PSSWDIEN is passed in then the WARD multiple (#51.11) WARD field (#.01), and WARD ADMINISTRATION TIMES field (#1)
"RTN","PSS51P1",91,0)
 ;of ADMINISTRATION SCHEDULE file (#51.1) is returned.
"RTN","PSS51P1",92,0)
 N DIERR,ZZERR,PSS51P1,SCR,PSS,PSSIEN,PSSVAL,PSSTMP
"RTN","PSS51P1",93,0)
 I $G(PSSFREQ)']"" S PSSFREQ=""
"RTN","PSS51P1",94,0)
 I $G(LIST)']"" Q
"RTN","PSS51P1",95,0)
 D AP^PSS51P1A
"RTN","PSS51P1",96,0)
 Q
"RTN","PSS51P1",97,0)
 ;
"RTN","PSS51P1",98,0)
IX(PSSFT,PSSPP,LIST) ;
"RTN","PSS51P1",99,0)
 ;PSSFT - Free Text name in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",100,0)
 ;PSSPP - PACKAGE PREFIX in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",101,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the
"RTN","PSS51P1",102,0)
 ;       Field Number of the data piece being returned.
"RTN","PSS51P1",103,0)
 ;Returns NAME field (#.01), STANDARD ADMINISTRATION TIMES field (#1), FREQUENCY (IN MINUTES) field (#2),
"RTN","PSS51P1",104,0)
 ;MAXIMUM DAYS FOR ORDERS field (#2.5),PACKAGE PREFIX field (#4), TYPE OF SCHEDULE field (#5), STANDARD
"RTN","PSS51P1",105,0)
 ;SHIFTS field (#6), OUTPATIENT EXPANSION field (#8), and OTHER LANGUAGE EXPANSION field (#8.1) of
"RTN","PSS51P1",106,0)
 ;ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",107,0)
 N DIERR,ZZERR,PSS51P1,PSS
"RTN","PSS51P1",108,0)
 I $G(LIST)']"" Q
"RTN","PSS51P1",109,0)
 D IX^PSS51P1A
"RTN","PSS51P1",110,0)
 Q
"RTN","PSS51P1",111,0)
 ;
"RTN","PSS51P1",112,0)
ADM(PSSADM) ; admin times
"RTN","PSS51P1",113,0)
 N X S X=PSSADM
"RTN","PSS51P1",114,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q "^"
"RTN","PSS51P1",115,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q "^"
"RTN","PSS51P1",116,0)
 S X(1)=$L(X(1)) F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$S(X(1)=2:24,1:2400):1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSS51P1",117,0)
 I '$D(X) Q "^"
"RTN","PSS51P1",118,0)
 K:$D(X) X(1),X(2),X(3) Q PSSADM
"RTN","PSS51P1",119,0)
 ;
"RTN","PSS51P1",120,0)
ALL(PSSIEN,PSSFT,LIST) ;
"RTN","PSS51P1",121,0)
 ;PSSIEN - IEN of entry in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",122,0)
 ;PSSFT - Free Text name in ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",123,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is the
"RTN","PSS51P1",124,0)
 ;       Field Number of the data piece being returned.
"RTN","PSS51P1",125,0)
 ;Returns NAME field (#.01), STANDARD ADMINISTRATION TIMES field (#1), FREQUENCY (IN MINUTES) field (#2),
"RTN","PSS51P1",126,0)
 ;MAXIMUM DAYS FOR ORDERS field (#2.5), PACKAGE PREFIX field (#4), TYPE OF SCHEDULE field (#5),
"RTN","PSS51P1",127,0)
 ;STANDARD SHIFTS field (#6), OUTPATIENT EXPANSION field (#8), OTHER LANGUAGE EXPANSIONS field (#8.1),
"RTN","PSS51P1",128,0)
 ; HOSPITAL LOCATION multiple (#51.17) HOSPITAL LOCATION field (#.01), ADMINISTRATION TIMES field (#1),
"RTN","PSS51P1",129,0)
 ;SHIFTS field (#2), WARD multiple (#51.11) WARD field (#.01), and WARD ADMINISTRATION TIMES field (#1)
"RTN","PSS51P1",130,0)
 ;of ADMINISTRATION SCHEDULE file (#51.1).
"RTN","PSS51P1",131,0)
 N DIERR,ZZERR,PSS
"RTN","PSS51P1",132,0)
 I $G(LIST)']"" Q
"RTN","PSS51P1",133,0)
 K ^TMP($J,LIST)
"RTN","PSS51P1",134,0)
 I +$G(PSSIEN)'>0,($G(PSSFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1",135,0)
 I $G(PSSIEN)]"",+$G(PSSIEN)'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1",136,0)
 D ALL^PSS51P1C
"RTN","PSS51P1",137,0)
 Q
"RTN","PSS51P1",138,0)
 ;
"RTN","PSS51P1",139,0)
SETSCR ;Set Screen for One-time schedule type
"RTN","PSS51P1",140,0)
 ;Naked reference below refers to ^PS(51.1,+Y,0)
"RTN","PSS51P1",141,0)
 I $G(PSSTSCH)]"" S SCR("S")="I $P(^(0),""^"",5)=""O"""
"RTN","PSS51P1",142,0)
 ;Naked reference below refers to ^PS(51.1,+Y,0)
"RTN","PSS51P1",143,0)
 I $G(PSSPP)]"" S SCR("S")=$S(SCR("S")]"":SCR("S")_" I $P(^(0),""^"",4)=PSSPP",1:"I $P(^(0),""^"",4)=PSSPP")
"RTN","PSS51P1",144,0)
 Q
"RTN","PSS51P1",145,0)
FREQ(PSSVAL,PSSFREQ) ; VALIDATES FREQUNCY FIELD
"RTN","PSS51P1",146,0)
 S PSSTMP=0
"RTN","PSS51P1",147,0)
 I PSSVAL>PSSFREQ S PSSTMP=1
"RTN","PSS51P1",148,0)
 I PSSVAL<1 S PSSTMP=1
"RTN","PSS51P1",149,0)
 I PSSFREQ="" S PSSTMP=0
"RTN","PSS51P1",150,0)
 Q PSSTMP
"RTN","PSS51P1",151,0)
PSSDQ ;DQ^DICQ call on 51.1
"RTN","PSS51P1",152,0)
 N DIC,D,DZ S DIC="^PS(51.1,",D="B",DIC(0)="EQS",DZ="??" D DQ^DICQ Q
"RTN","PSS51P1A")
0^4^B55592695^B44739215
"RTN","PSS51P1A",1,0)
PSS51P1A ;BIR/LDT - API FOR INFORMATION FROM FILE 51.1 CONT.; 5 Sep 03
"RTN","PSS51P1A",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**85,91,118**;9/30/97;Build 8
"RTN","PSS51P1A",3,0)
 ;
"RTN","PSS51P1A",4,0)
HOSP ;
"RTN","PSS51P1A",5,0)
 K ^TMP($J,LIST)
"RTN","PSS51P1A",6,0)
 I +$G(PSSIEN)'>0,($G(PSSFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",7,0)
 I +$G(PSSIEN)>0 N PSSIEN2 S PSSIEN2=$$FIND1^DIC(51.1,"","A","`"_PSSIEN,,,"") D
"RTN","PSS51P1A",8,0)
 .I +PSSIEN2'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",9,0)
 .D GETS^DIQ(51.1,+PSSIEN2,".01;7*","IE","^TMP($J,""PSS51P1""") S (PSS(1),CNT)=0
"RTN","PSS51P1A",10,0)
 .S PSSIEN=+PSSIEN2 F  S PSS(1)=$O(^TMP($J,"PSS51P1",51.17,PSS(1))) Q:'PSS(1)  D SETLOC^PSS51P1B S CNT=CNT+1
"RTN","PSS51P1A",11,0)
 .S ^TMP($J,LIST,+PSSIEN,"HOSP",0)=$S(CNT>0:CNT,1:"-1^NO DATA FOUND")
"RTN","PSS51P1A",12,0)
 .S PSS(2)=0 F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.1,PSS(2))) Q:'PSS(2)  D
"RTN","PSS51P1A",13,0)
 ..S ^TMP($J,LIST,+PSS(2),.01)=$G(^TMP($J,"PSS51P1",51.1,PSS(2),.01,"I"))
"RTN","PSS51P1A",14,0)
 ..S ^TMP($J,LIST,"B",$G(^TMP($J,"PSS51P1",51.1,PSS(2),.01,"E")),+PSS(2))=""
"RTN","PSS51P1A",15,0)
 I +$G(PSSIEN)'>0,$G(PSSFT)]"" D
"RTN","PSS51P1A",16,0)
 .I PSSFT["??" D LOOP^PSS51P1B(3) Q
"RTN","PSS51P1A",17,0)
 .D FIND^DIC(51.1,,"@;.01","QP",PSSFT,,"B",,,"")
"RTN","PSS51P1A",18,0)
 .I +$G(^TMP("DILIST",$J,0))=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",19,0)
 .I +^TMP("DILIST",$J,0)>0 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0) N PSSXX S PSSXX=0 F  S PSSXX=$O(^TMP("DILIST",$J,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P1A",20,0)
 ..S PSSIEN=+^TMP("DILIST",$J,PSSXX,0) K ^TMP($J,"PSS51P1") D GETS^DIQ(51.1,+PSSIEN,".01;7*","IE","^TMP($J,""PSS51P1""") S (PSS(1),CNT)=0 D
"RTN","PSS51P1A",21,0)
 ...F  S PSS(1)=$O(^TMP($J,"PSS51P1",51.17,PSS(1))) Q:'PSS(1)  D SETLOC^PSS51P1B S CNT=CNT+1
"RTN","PSS51P1A",22,0)
 ...S ^TMP($J,LIST,+PSSIEN,"HOSP",0)=$S(CNT>0:CNT,1:"-1^NO DATA FOUND")
"RTN","PSS51P1A",23,0)
 ...S PSS(2)=0 F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.1,PSS(2))) Q:'PSS(2)  D
"RTN","PSS51P1A",24,0)
 ....S ^TMP($J,LIST,+PSS(2),.01)=$G(^TMP($J,"PSS51P1",51.1,PSS(2),.01,"I"))
"RTN","PSS51P1A",25,0)
 ....S ^TMP($J,LIST,"B",$G(^TMP($J,"PSS51P1",51.1,PSS(2),.01,"E")),+PSS(2))=""
"RTN","PSS51P1A",26,0)
 K ^TMP("DILIST",$J),^TMP($J,"PSS51P1")
"RTN","PSS51P1A",27,0)
 Q
"RTN","PSS51P1A",28,0)
 ;
"RTN","PSS51P1A",29,0)
SCRFREQ ;
"RTN","PSS51P1A",30,0)
 I (SCR("S")="")&(PSSFREQ'="") D
"RTN","PSS51P1A",31,0)
 .S SCR("S")="I ($P($G(^PS(51.1,+Y,0)),""^"",3)'>PSSFREQ)&($P($G(^PS(51.1,+Y,0)),""^"",3)'="""")" Q
"RTN","PSS51P1A",32,0)
 I ((SCR("S")'="")&(PSSFREQ'="")) D
"RTN","PSS51P1A",33,0)
 .S SCR("S")=SCR("S")_"&($P($G(^PS(51.1,+Y,0)),""^"",3)'>PSSFREQ)&($P($G(^PS(51.1,+Y,0)),""^"",3)'="""")" Q
"RTN","PSS51P1A",34,0)
 Q
"RTN","PSS51P1A",35,0)
 ;
"RTN","PSS51P1A",36,0)
AP ;
"RTN","PSS51P1A",37,0)
 K ^TMP($J,LIST)
"RTN","PSS51P1A",38,0)
 S SCR("S")=""
"RTN","PSS51P1A",39,0)
 S SCR("S")=$S($G(PSSTYP)]"":"I ($P($G(^PS(51.1,+Y,0)),""^"",5)[PSSTYP)",1:"")
"RTN","PSS51P1A",40,0)
 D SCRFREQ
"RTN","PSS51P1A",41,0)
 I $G(PSSPP)']"" S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",42,0)
 I $G(PSSPP)]"",$G(PSSFT)="" D LIST^DIC(51.1,"","@;.01;1;2;2.5;4;5IE;8","P",,,,"AP"_PSSPP,SCR("S"),,) D
"RTN","PSS51P1A",43,0)
 .I +^TMP("DILIST",$J,0)'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",44,0)
 .I +^TMP("DILIST",$J,0)>0 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0)
"RTN","PSS51P1A",45,0)
 .N PSSXX S PSSXX=0 F  S PSSXX=$O(^TMP("DILIST",$J,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P1A",46,0)
 ..S PSSIEN=+^TMP("DILIST",$J,PSSXX,0)
"RTN","PSS51P1A",47,0)
 ..S ^TMP($J,LIST,+PSSIEN,.01)=$P($G(^TMP("DILIST",$J,PSSXX,0)),"^",2)
"RTN","PSS51P1A",48,0)
 ..S ^TMP($J,LIST,"AP"_PSSPP,$P($G(^TMP("DILIST",$J,PSSXX,0)),"^",2),+$G(^TMP("DILIST",$J,PSSXX,0)))=""
"RTN","PSS51P1A",49,0)
 ..S ^TMP($J,LIST,+PSSIEN,1)=$P($G(^TMP("DILIST",$J,PSSXX,0)),"^",3)
"RTN","PSS51P1A",50,0)
 ..S ^TMP($J,LIST,+PSSIEN,2)=$P($G(^TMP("DILIST",$J,PSSXX,0)),"^",4)
"RTN","PSS51P1A",51,0)
 ..S ^TMP($J,LIST,+PSSIEN,2.5)=$P($G(^TMP("DILIST",$J,PSSXX,0)),"^",5)
"RTN","PSS51P1A",52,0)
 ..S ^TMP($J,LIST,+PSSIEN,4)=$P($G(^TMP("DILIST",$J,PSSXX,0)),"^",6)
"RTN","PSS51P1A",53,0)
 ..S ^TMP($J,LIST,+PSSIEN,5)=$S($P($G(^TMP("DILIST",$J,PSSXX,0)),"^",7)="":"",1:$P($G(^TMP("DILIST",$J,PSSXX,0)),"^",7)_"^"_$P($G(^TMP("DILIST",$J,PSSXX,0)),"^",8))
"RTN","PSS51P1A",54,0)
 ..S ^TMP($J,LIST,+PSSIEN,8)=$P($G(^TMP("DILIST",$J,PSSXX,0)),"^",9)
"RTN","PSS51P1A",55,0)
 ..D HOSPLOC(LIST,+PSSIEN)
"RTN","PSS51P1A",56,0)
 ..I +$G(PSSWDIEN)'>0 K ^TMP($J,"PSS51P1") D GETS^DIQ(51.1,+PSSIEN,".01;3*","IE","^TMP($J,""PSS51P1""") D
"RTN","PSS51P1A",57,0)
 ...S PSS(1)=+PSSIEN,(PSS(2),CNT)=0 F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.11,PSS(2))) Q:'PSS(2)  D SETWARD^PSS51P1B S CNT=CNT+1
"RTN","PSS51P1A",58,0)
 ...S ^TMP($J,LIST,+PSSIEN,"WARD",0)=$S(CNT>0:CNT,1:-1_"^"_"NO DATA FOUND")
"RTN","PSS51P1A",59,0)
 ..I +$G(PSSWDIEN)>0 K ^TMP($J,"PSS51P1") D GETS^DIQ(51.1,+PSSIEN,".01;3*","IE","^TMP($J,""PSS51P1""") D
"RTN","PSS51P1A",60,0)
 ...I +$D(^TMP($J,"PSS51P1",51.11))'>0 S ^TMP($J,LIST,+PSSIEN,"WARD",0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",61,0)
 ...S (PSS(2),CNT)=0 F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.11,PSS(2))) Q:'PSS(2)  D
"RTN","PSS51P1A",62,0)
 ....I PSSWDIEN=$P($G(^TMP($J,"PSS51P1",51.11,PSS(2),.01,"I")),"^") D SETWRD2^PSS51P1B Q
"RTN","PSS51P1A",63,0)
 ....S ^TMP($J,LIST,+PSSIEN,"WARD",0)="-1^NO DATA FOUND FOR PSSWDIEN #"_PSSWDIEN
"RTN","PSS51P1A",64,0)
 I $G(PSSPP)]"",$G(PSSFT)]""  D
"RTN","PSS51P1A",65,0)
 .I PSSFT["??" D LOOP^PSS51P1B(5) Q
"RTN","PSS51P1A",66,0)
 .D FIND^DIC(51.1,,"@;.01;1;2;2.5;4;5IE;8",,PSSFT,,"AP"_PSSPP,SCR("S"),,"")
"RTN","PSS51P1A",67,0)
 .I +$G(^TMP("DILIST",$J,0))'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",68,0)
 .I +^TMP("DILIST",$J,0)>0 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0) N PSSXX S PSSXX=0 F  S PSSXX=$O(^TMP("DILIST",$J,2,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P1A",69,0)
 ..S PSSIEN=+^TMP("DILIST",$J,2,PSSXX)
"RTN","PSS51P1A",70,0)
 ..S ^TMP($J,LIST,+PSSIEN,.01)=$G(^TMP("DILIST",$J,"ID",PSSXX,.01))
"RTN","PSS51P1A",71,0)
 ..S ^TMP($J,LIST,"AP"_PSSPP,$G(^TMP("DILIST",$J,"ID",PSSXX,.01)),+PSSIEN)=""
"RTN","PSS51P1A",72,0)
 ..S ^TMP($J,LIST,+PSSIEN,1)=$G(^TMP("DILIST",$J,"ID",PSSXX,1))
"RTN","PSS51P1A",73,0)
 ..S ^TMP($J,LIST,+PSSIEN,2)=$G(^TMP("DILIST",$J,"ID",PSSXX,2))
"RTN","PSS51P1A",74,0)
 ..S ^TMP($J,LIST,+PSSIEN,2.5)=$G(^TMP("DILIST",$J,"ID",PSSXX,2.5))
"RTN","PSS51P1A",75,0)
 ..S ^TMP($J,LIST,+PSSIEN,4)=$G(^TMP("DILIST",$J,"ID",PSSXX,4))
"RTN","PSS51P1A",76,0)
 ..S ^TMP($J,LIST,+PSSIEN,5)=$S($G(^TMP("DILIST",$J,"ID",PSSXX,5,"I"))="":"",1:$G(^TMP("DILIST",$J,"ID",PSSXX,5,"I"))_"^"_$G(^TMP("DILIST",$J,"ID",PSSXX,5,"E")))
"RTN","PSS51P1A",77,0)
 ..S ^TMP($J,LIST,+PSSIEN,8)=$G(^TMP("DILIST",$J,"ID",PSSXX,8))
"RTN","PSS51P1A",78,0)
 ..D HOSPLOC(LIST,+PSSIEN)
"RTN","PSS51P1A",79,0)
 ..I +$G(PSSWDIEN)'>0 K ^TMP($J,"PSS51P1") D GETS^DIQ(51.1,+PSSIEN,".01;3*","IE","^TMP($J,""PSS51P1""") D
"RTN","PSS51P1A",80,0)
 ...S PSS(1)=+PSSIEN,(PSS(2),CNT)=0 F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.11,PSS(2))) Q:'PSS(2)  D SETWARD^PSS51P1B S CNT=CNT+1
"RTN","PSS51P1A",81,0)
 ...S ^TMP($J,LIST,+PSSIEN,"WARD",0)=$S(CNT>0:CNT,1:-1_"^"_"NO DATA FOUND")
"RTN","PSS51P1A",82,0)
 ..I +$G(PSSWDIEN)>0 K ^TMP($J,"PSS51P1") D GETS^DIQ(51.1,+PSSIEN,".01;3*","IE","^TMP($J,""PSS51P1""") D
"RTN","PSS51P1A",83,0)
 ...I +$D(^TMP($J,"PSS51P1",51.11))'>0 S ^TMP($J,LIST,+PSSIEN,"WARD",0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",84,0)
 ...S (PSS(2),CNT)=0 F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.11,PSS(2))) Q:'PSS(2)  D
"RTN","PSS51P1A",85,0)
 ....I PSSWDIEN=$P($G(^TMP($J,"PSS51P1",51.11,PSS(2),.01,"I")),"^") D SETWRD2^PSS51P1B Q
"RTN","PSS51P1A",86,0)
 ....S ^TMP($J,LIST,+PSSIEN,"WARD",0)="-1^NO DATA FOUND FOR PSSWDIEN #"_PSSWDIEN
"RTN","PSS51P1A",87,0)
 K ^TMP("DILIST",$J),^TMP($J,"PSS51P1")
"RTN","PSS51P1A",88,0)
 Q
"RTN","PSS51P1A",89,0)
 ;
"RTN","PSS51P1A",90,0)
HOSPLOC(LIST,PSSIEN) ;
"RTN","PSS51P1A",91,0)
 N PSSCNT S PSSCNT=0
"RTN","PSS51P1A",92,0)
 N PSSHOSP D GETS^DIQ(51.1,+PSSIEN,"7*","IE","PSSHOSP")
"RTN","PSS51P1A",93,0)
 N PSSTIM S PSSTIM=0 F  S PSSTIM=$O(PSSHOSP(51.17,PSSTIM)) Q:'PSSTIM  D
"RTN","PSS51P1A",94,0)
 .S ^TMP($J,LIST,+PSSIEN,"HOSPITAL LOCATION",+PSSTIM,.01)=PSSHOSP(51.17,PSSTIM,.01,"I")_U_PSSHOSP(51.17,PSSTIM,.01,"E")
"RTN","PSS51P1A",95,0)
 .S ^TMP($J,LIST,+PSSIEN,"HOSPITAL LOCATION",+PSSTIM,1)=$S(PSSHOSP(51.17,PSSTIM,1,"I")="":"",1:PSSHOSP(51.17,PSSTIM,1,"I"))
"RTN","PSS51P1A",96,0)
 .S PSSCNT=PSSCNT+1
"RTN","PSS51P1A",97,0)
 S ^TMP($J,LIST,+PSSIEN,"HOSPITAL LOCATION",0)=$S(PSSCNT>0:PSSCNT,1:"-1^NO DATA FOUND")
"RTN","PSS51P1A",98,0)
 Q
"RTN","PSS51P1A",99,0)
 ;
"RTN","PSS51P1A",100,0)
IX ;
"RTN","PSS51P1A",101,0)
 N CNT
"RTN","PSS51P1A",102,0)
 K ^TMP($J,LIST)
"RTN","PSS51P1A",103,0)
 I $G(PSSPP)']"" S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",104,0)
 I $G(PSSFT)']"" S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",105,0)
 I $G(PSSPP)]"",$G(PSSFT)]""  D
"RTN","PSS51P1A",106,0)
 .I PSSFT["??" D LOOP^PSS51P1B(6) Q
"RTN","PSS51P1A",107,0)
 .D FIND^DIC(51.1,,"@;.01","QP",PSSFT,,"AP"_PSSPP,,,"")
"RTN","PSS51P1A",108,0)
 .I +$G(^TMP("DILIST",$J,0))'>0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",109,0)
 .I +^TMP("DILIST",$J,0)>0 N PSSXX S (PSSXX,CNT)=0 F  S PSSXX=$O(^TMP("DILIST",$J,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P1A",110,0)
 ..S PSSIEN=+^TMP("DILIST",$J,PSSXX,0)
"RTN","PSS51P1A",111,0)
 ..K PSS51P1 D GETS^DIQ(51.1,+PSSIEN,".01;1;2;2.5;4;5;6;8;8.1","IE","PSS51P1")
"RTN","PSS51P1A",112,0)
 ..N PSSXX S PSSXX=0 F  S PSSXX=$O(PSS51P1(51.1,PSSXX)) Q:'PSSXX  D  S CNT=CNT+1
"RTN","PSS51P1A",113,0)
 ...S ^TMP($J,LIST,+PSSXX,.01)=$G(PSS51P1(51.1,PSSXX,.01,"E"))
"RTN","PSS51P1A",114,0)
 ...S ^TMP($J,LIST,"AP"_PSSPP,$G(PSS51P1(51.1,PSSXX,.01,"E")),+PSSXX)=""
"RTN","PSS51P1A",115,0)
 ...S ^TMP($J,LIST,+PSSXX,1)=$G(PSS51P1(51.1,PSSXX,1,"E"))
"RTN","PSS51P1A",116,0)
 ...S ^TMP($J,LIST,+PSSXX,2)=$G(PSS51P1(51.1,PSSXX,2,"E"))
"RTN","PSS51P1A",117,0)
 ...S ^TMP($J,LIST,+PSSXX,2.5)=$G(PSS51P1(51.1,PSSXX,2.5,"E"))
"RTN","PSS51P1A",118,0)
 ...S ^TMP($J,LIST,+PSSXX,4)=$G(PSS51P1(51.1,PSSXX,4,"E"))
"RTN","PSS51P1A",119,0)
 ...S ^TMP($J,LIST,+PSSXX,5)=$S($G(PSS51P1(51.1,PSSXX,5,"I"))]"":$G(PSS51P1(51.1,PSSXX,5,"I"))_"^"_$G(PSS51P1(51.1,PSSXX,5,"E")),1:"")
"RTN","PSS51P1A",120,0)
 ...S ^TMP($J,LIST,+PSSXX,6)=$G(PSS51P1(51.1,PSSXX,6,"E"))
"RTN","PSS51P1A",121,0)
 ...S ^TMP($J,LIST,+PSSXX,8)=$G(PSS51P1(51.1,PSSXX,8,"E"))
"RTN","PSS51P1A",122,0)
 ...S ^TMP($J,LIST,+PSSXX,8.1)=$G(PSS51P1(51.1,PSSXX,8.1,"E"))
"RTN","PSS51P1A",123,0)
 ..S ^TMP($J,LIST,0)=$S(CNT>0:CNT,1:"-1^NO DATA FOUND")
"RTN","PSS51P1A",124,0)
 K PSS51P1
"RTN","PSS51P1A",125,0)
 K ^TMP("DILIST",$J)
"RTN","PSS51P1A",126,0)
 Q
"RTN","PSS51P1A",127,0)
 ;
"RTN","PSS51P1A",128,0)
IEN ;
"RTN","PSS51P1A",129,0)
 I $G(PSSFT)]"" D
"RTN","PSS51P1A",130,0)
 .I PSSFT["??" D LOOP^PSS51P1B(4) Q
"RTN","PSS51P1A",131,0)
 .D FIND^DIC(51.1,,"@;.01;1","QP",PSSFT,,"B",,,"PSS51P1")
"RTN","PSS51P1A",132,0)
 .I +PSS51P1("DILIST",0)=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P1A",133,0)
 .I +PSS51P1("DILIST",0)>0 S ^TMP($J,LIST,0)=+PSS51P1("DILIST",0) N PSSXX S PSSXX=0 F  S PSSXX=$O(PSS51P1("DILIST",PSSXX)) Q:'PSSXX  D
"RTN","PSS51P1A",134,0)
 ..S ^TMP($J,LIST,+$G(PSS51P1("DILIST",PSSXX,0)),.01)=$P($G(PSS51P1("DILIST",PSSXX,0)),"^",2)
"RTN","PSS51P1A",135,0)
 ..S ^TMP($J,LIST,+$G(PSS51P1("DILIST",PSSXX,0)),1)=$P($G(PSS51P1("DILIST",PSSXX,0)),"^",3)
"RTN","PSS51P1A",136,0)
 ..S ^TMP($J,LIST,"B",$P($G(PSS51P1("DILIST",PSSXX,0)),"^",2),+$G(PSS51P1("DILIST",PSSXX,0)))=""
"RTN","PSS51P1A",137,0)
 K ^TMP("DILIST",$J)
"RTN","PSS51P1A",138,0)
 Q
"RTN","PSS51P1B")
0^5^B44061032^B43057007
"RTN","PSS51P1B",1,0)
PSS51P1B ;BIR/LDT - API FOR INFORMATION FROM FILE 51.1 CONT.; 5 Sep 03
"RTN","PSS51P1B",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**85,91,118**;9/30/97;Build 8
"RTN","PSS51P1B",3,0)
 ;
"RTN","PSS51P1B",4,0)
SETZRO ;
"RTN","PSS51P1B",5,0)
 S ^TMP($J,LIST,+PSS(1),.01)=$G(PSS51P1(51.1,PSS(1),.01,"I"))
"RTN","PSS51P1B",6,0)
 S ^TMP($J,LIST,"B",$G(PSS51P1(51.1,PSS(1),.01,"I")),+PSS(1))=""
"RTN","PSS51P1B",7,0)
 S ^TMP($J,LIST,+PSS(1),1)=$G(PSS51P1(51.1,PSS(1),1,"I"))
"RTN","PSS51P1B",8,0)
 S ^TMP($J,LIST,+PSS(1),2)=$G(PSS51P1(51.1,PSS(1),2,"I"))
"RTN","PSS51P1B",9,0)
 S ^TMP($J,LIST,+PSS(1),4)=$G(PSS51P1(51.1,PSS(1),4,"I"))
"RTN","PSS51P1B",10,0)
 S ^TMP($J,LIST,+PSS(1),5)=$S($G(PSS51P1(51.1,PSS(1),5,"I"))="":"",1:PSS51P1(51.1,PSS(1),5,"I")_"^"_PSS51P1(51.1,PSS(1),5,"E"))
"RTN","PSS51P1B",11,0)
 S ^TMP($J,LIST,+PSS(1),6)=$G(PSS51P1(51.1,PSS(1),6,"I"))
"RTN","PSS51P1B",12,0)
 S ^TMP($J,LIST,+PSS(1),2.5)=$G(PSS51P1(51.1,PSS(1),2.5,"I"))
"RTN","PSS51P1B",13,0)
 S ^TMP($J,LIST,+PSS(1),8)=$G(PSS51P1(51.1,PSS(1),8,"I"))
"RTN","PSS51P1B",14,0)
 S ^TMP($J,LIST,+PSS(1),8.1)=$G(PSS51P1(51.1,PSS(1),8.1,"I"))
"RTN","PSS51P1B",15,0)
 Q
"RTN","PSS51P1B",16,0)
 ;
"RTN","PSS51P1B",17,0)
SETWARD ;
"RTN","PSS51P1B",18,0)
 S ^TMP($J,LIST,+PSS(1),"WARD",+PSS(2),.01)=$S($G(^TMP($J,"PSS51P1",51.11,PSS(2),.01,"I"))="":"",1:^TMP($J,"PSS51P1",51.11,PSS(2),.01,"I")_"^"_^TMP($J,"PSS51P1",51.11,PSS(2),.01,"E"))
"RTN","PSS51P1B",19,0)
 S ^TMP($J,LIST,+PSS(1),"WARD",+PSS(2),1)=$G(^TMP($J,"PSS51P1",51.11,PSS(2),1,"I"))
"RTN","PSS51P1B",20,0)
 Q
"RTN","PSS51P1B",21,0)
 ;
"RTN","PSS51P1B",22,0)
SETLOC ;
"RTN","PSS51P1B",23,0)
 S ^TMP($J,LIST,+PSSIEN,"HOSP",+PSS(1),.01)=$S($G(^TMP($J,"PSS51P1",51.17,PSS(1),.01,"I"))="":"",1:^TMP($J,"PSS51P1",51.17,PSS(1),.01,"I")_"^"_^TMP($J,"PSS51P1",51.17,PSS(1),.01,"E"))
"RTN","PSS51P1B",24,0)
 S ^TMP($J,LIST,+PSSIEN,"HOSP",+PSS(1),1)=$G(^TMP($J,"PSS51P1",51.17,PSS(1),1,"I"))
"RTN","PSS51P1B",25,0)
 S ^TMP($J,LIST,+PSSIEN,"HOSP",+PSS(1),2)=$G(^TMP($J,"PSS51P1",51.17,PSS(1),2,"I"))
"RTN","PSS51P1B",26,0)
 Q
"RTN","PSS51P1B",27,0)
 ;
"RTN","PSS51P1B",28,0)
LOOP(PSSLP) ;
"RTN","PSS51P1B",29,0)
 N CNT,CNT1,PSS S (CNT,PSS(3))=0
"RTN","PSS51P1B",30,0)
 F  S PSS(3)=$O(^PS(51.1,PSS(3))) Q:'PSS(3)  D @(PSSLP)
"RTN","PSS51P1B",31,0)
 S ^TMP($J,LIST,0)=$S(CNT>0:CNT,1:"-1^NO DATA FOUND")
"RTN","PSS51P1B",32,0)
 K ^TMP("DILIST",$J)
"RTN","PSS51P1B",33,0)
 Q
"RTN","PSS51P1B",34,0)
 ;
"RTN","PSS51P1B",35,0)
SETWRD2 ;
"RTN","PSS51P1B",36,0)
 S ^TMP($J,LIST,+PSSIEN,"WARD",+PSS(2),.01)=$S($G(^TMP($J,"PSS51P1",51.11,PSS(2),.01,"I"))="":"",1:^TMP($J,"PSS51P1",51.11,PSS(2),.01,"I")_"^"_^TMP($J,"PSS51P1",51.11,PSS(2),.01,"E"))
"RTN","PSS51P1B",37,0)
 S ^TMP($J,LIST,+PSSIEN,"WARD",+PSS(2),1)=$G(^TMP($J,"PSS51P1",51.11,PSS(2),1,"I"))
"RTN","PSS51P1B",38,0)
 S ^TMP($J,LIST,+PSSIEN,"WARD",0)=1
"RTN","PSS51P1B",39,0)
 Q
"RTN","PSS51P1B",40,0)
 ;
"RTN","PSS51P1B",41,0)
1 ;
"RTN","PSS51P1B",42,0)
 I $G(PSSTSCH)]"" Q:$P($G(^PS(51.1,PSS(3),0)),"^",5)'="O"
"RTN","PSS51P1B",43,0)
 I $G(PSSPP)]"" Q:$P($G(^PS(51.1,PSS(3),0)),"^",4)'=PSSPP
"RTN","PSS51P1B",44,0)
 S PSSIEN=PSS(3) K PSS51P1 D GETS^DIQ(51.1,+PSSIEN,".01;1;2;4;5;6;2.5;8;8.1","IE","PSS51P1") S PSS(1)=0
"RTN","PSS51P1B",45,0)
 F  S PSS(1)=$O(PSS51P1(51.1,PSS(1))) Q:'PSS(1)  D SETZRO S CNT=CNT+1
"RTN","PSS51P1B",46,0)
 K PSS51P1
"RTN","PSS51P1B",47,0)
 Q
"RTN","PSS51P1B",48,0)
 ;
"RTN","PSS51P1B",49,0)
2 ;
"RTN","PSS51P1B",50,0)
 S PSSIEN=PSS(3) K ^TMP($J,"PSS51P1")
"RTN","PSS51P1B",51,0)
 I +$G(PSSIEN2)'>0 D GETS^DIQ(51.1,+PSSIEN,".01;3*","IE","^TMP($J,""PSS51P1""") S PSS(1)=0 D
"RTN","PSS51P1B",52,0)
 .F  S PSS(1)=$O(^TMP($J,"PSS51P1",51.1,PSS(1))) Q:'PSS(1)  D
"RTN","PSS51P1B",53,0)
 ..S ^TMP($J,LIST,+PSS(1),.01)=$G(^TMP($J,"PSS51P1",51.1,PSS(1),.01,"I")),CNT=CNT+1
"RTN","PSS51P1B",54,0)
 ..S ^TMP($J,LIST,"B",$G(^TMP($J,"PSS51P1",51.1,PSS(1),.01,"E")),+PSS(1))="" S (PSS(2),CNT1)=0 D
"RTN","PSS51P1B",55,0)
 ...F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.11,PSS(2))) Q:'PSS(2)  D SETWARD S CNT1=CNT1+1
"RTN","PSS51P1B",56,0)
 ...S ^TMP($J,LIST,+PSS(1),"WARD",0)=$S(CNT1>0:CNT1,1:"-1^NO DATA FOUND")
"RTN","PSS51P1B",57,0)
 I +$G(PSSIEN2)>0 D GETS^DIQ(51.1,+PSSIEN,".01","IE","^TMP($J,""PSS51P1""") D
"RTN","PSS51P1B",58,0)
 .S PSS(4)=0 F  S PSS(4)=$O(^TMP($J,"PSS51P1",51.1,PSS(4))) Q:'PSS(4)  D
"RTN","PSS51P1B",59,0)
 ..S ^TMP($J,LIST,+PSS(4),.01)=$G(^TMP($J,"PSS51P1",51.1,PSS(4),.01,"I")),CNT=CNT+1
"RTN","PSS51P1B",60,0)
 ..S ^TMP($J,LIST,"B",$G(^TMP($J,"PSS51P1",51.1,PSS(4),.01,"E")),+PSS(4))=""
"RTN","PSS51P1B",61,0)
 ..D GETS^DIQ(51.11,+PSSIEN2_","_+PSSIEN,".01;1","IE","^TMP($J,""PSS51P1""")
"RTN","PSS51P1B",62,0)
 ..S PSS(1)=+PSSIEN,(PSS(2),CNT1)=0 F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.11,PSS(2))) Q:'PSS(2)  D SETWARD^PSS51P1B S CNT1=CNT1+1
"RTN","PSS51P1B",63,0)
 ..S ^TMP($J,LIST,+PSSIEN,"WARD",0)=$S(CNT1>0:CNT1,1:"-1^NO DATA FOUND FOR PSSIEN2 #"_PSSIEN2)
"RTN","PSS51P1B",64,0)
 K ^TMP($J,"PSS51P1")
"RTN","PSS51P1B",65,0)
 Q
"RTN","PSS51P1B",66,0)
3 ;
"RTN","PSS51P1B",67,0)
 S PSSIEN=PSS(3) K ^TMP($J,"PSS51P1") D GETS^DIQ(51.1,+PSSIEN,".01;7*","IE","^TMP($J,""PSS51P1""") S (PSS(1),CNT1)=0 D
"RTN","PSS51P1B",68,0)
 .F  S PSS(1)=$O(^TMP($J,"PSS51P1",51.17,PSS(1))) Q:'PSS(1)  D SETLOC S CNT1=CNT1+1
"RTN","PSS51P1B",69,0)
 .S ^TMP($J,LIST,+PSSIEN,"HOSP",0)=$S(CNT1>0:CNT1,1:"-1^NO DATA FOUND")
"RTN","PSS51P1B",70,0)
 .S PSS(2)=0 F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.1,PSS(2))) Q:'PSS(2)  D
"RTN","PSS51P1B",71,0)
 ..S ^TMP($J,LIST,+PSS(2),.01)=$G(^TMP($J,"PSS51P1",51.1,PSS(2),.01,"I")),CNT=CNT+1
"RTN","PSS51P1B",72,0)
 ..S ^TMP($J,LIST,"B",$G(^TMP($J,"PSS51P1",51.1,PSS(2),.01,"E")),+PSS(2))=""
"RTN","PSS51P1B",73,0)
 K ^TMP($J,"PSS51P1")
"RTN","PSS51P1B",74,0)
 Q
"RTN","PSS51P1B",75,0)
4 ;
"RTN","PSS51P1B",76,0)
 S PSSIEN=PSS(3)
"RTN","PSS51P1B",77,0)
 D GETS^DIQ(51.1,+PSSIEN,".01;1","IE","PSS51P1")
"RTN","PSS51P1B",78,0)
 N PSSXX S PSSXX=0 F  S PSSXX=$O(PSS51P1(51.1,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P1B",79,0)
 .S ^TMP($J,LIST,+PSSXX,.01)=$G(PSS51P1(51.1,PSSXX,.01,"E")),CNT=CNT+1
"RTN","PSS51P1B",80,0)
 .S ^TMP($J,LIST,"B",$G(PSS51P1(51.1,PSSXX,.01,"E")),+PSSXX)=""
"RTN","PSS51P1B",81,0)
 .S ^TMP($J,LIST,+PSSXX,1)=$G(PSS51P1(51.1,PSSXX,1,"E"))
"RTN","PSS51P1B",82,0)
 K PSS51P1
"RTN","PSS51P1B",83,0)
 Q
"RTN","PSS51P1B",84,0)
5 ;
"RTN","PSS51P1B",85,0)
 I $G(PSSPP)]"",$P($G(^PS(51.1,+PSS(3),0)),"^",4)'=$G(PSSPP) Q
"RTN","PSS51P1B",86,0)
 I $G(PSSTYP)]"",$P($G(^PS(51.1,+PSS(3),0)),"^",5)'[PSSTYP Q
"RTN","PSS51P1B",87,0)
 D FIND^DIC(51.1,,"@;.01;1;2;2.5;4;5IE;8","Q","`"_PSS(3),,,,"")
"RTN","PSS51P1B",88,0)
 N PSSXX S PSSXX=0 F  S PSSXX=$O(^TMP("DILIST",$J,"ID",PSSXX)) Q:'PSSXX  D
"RTN","PSS51P1B",89,0)
 .S PSSIEN=+PSS(3)
"RTN","PSS51P1B",90,0)
 .I $$FREQ^PSS51P1(+$G(^TMP("DILIST",$J,"ID",PSSXX,2)),PSSFREQ) Q
"RTN","PSS51P1B",91,0)
 .S CNT=CNT+1
"RTN","PSS51P1B",92,0)
 .S ^TMP($J,LIST,+PSSIEN,.01)=$G(^TMP("DILIST",$J,"ID",PSSXX,.01))
"RTN","PSS51P1B",93,0)
 .S ^TMP($J,LIST,"AP"_PSSPP,$G(^TMP("DILIST",$J,"ID",PSSXX,.01)),+PSSIEN)=""
"RTN","PSS51P1B",94,0)
 .S ^TMP($J,LIST,+PSSIEN,1)=$G(^TMP("DILIST",$J,"ID",PSSXX,1))
"RTN","PSS51P1B",95,0)
 .S ^TMP($J,LIST,+PSSIEN,2)=$G(^TMP("DILIST",$J,"ID",PSSXX,2))
"RTN","PSS51P1B",96,0)
 .S ^TMP($J,LIST,+PSSIEN,2.5)=$G(^TMP("DILIST",$J,"ID",PSSXX,2.5))
"RTN","PSS51P1B",97,0)
 .S ^TMP($J,LIST,+PSSIEN,4)=$G(^TMP("DILIST",$J,"ID",PSSXX,4))
"RTN","PSS51P1B",98,0)
 .S ^TMP($J,LIST,+PSSIEN,5)=$S($G(^TMP("DILIST",$J,"ID",PSSXX,5,"I"))="":"",1:$G(^TMP("DILIST",$J,"ID",PSSXX,5,"I"))_"^"_$G(^TMP("DILIST",$J,"ID",PSSXX,5,"E")))
"RTN","PSS51P1B",99,0)
 .S ^TMP($J,LIST,+PSSIEN,8)=$G(^TMP("DILIST",$J,"ID",PSSXX,8))
"RTN","PSS51P1B",100,0)
 .D HOSPLOC^PSS51P1A(LIST,+PSSIEN)
"RTN","PSS51P1B",101,0)
 .I +$G(PSSWDIEN)'>0 K ^TMP($J,"PSS51P1") D GETS^DIQ(51.1,+PSSIEN,".01;3*","IE","^TMP($J,""PSS51P1""") D
"RTN","PSS51P1B",102,0)
 ..S PSS(1)=+PSSIEN,(PSS(2),CNT1)=0 F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.11,PSS(2))) Q:'PSS(2)  D SETWARD^PSS51P1B S CNT1=CNT1+1
"RTN","PSS51P1B",103,0)
 ..S ^TMP($J,LIST,+PSSIEN,"WARD",0)=$S(CNT1>0:CNT1,1:-1_"^"_"NO DATA FOUND")
"RTN","PSS51P1B",104,0)
 .I +$G(PSSWDIEN)>0 K ^TMP($J,"PSS51P1") D GETS^DIQ(51.1,+PSSIEN,".01;3*","IE","^TMP($J,""PSS51P1""") D
"RTN","PSS51P1B",105,0)
 ..S (PSS(2),CNT1)=0 F  S PSS(2)=$O(^TMP($J,"PSS51P1",51.11,PSS(2))) Q:'PSS(2)  D
"RTN","PSS51P1B",106,0)
 ...I PSSWDIEN=$P($G(^TMP($J,"PSS51P1",51.11,PSS(2),.01,"I")),"^") D SETWRD2^PSS51P1B S CNT1=CNT1+1
"RTN","PSS51P1B",107,0)
 ..S ^TMP($J,LIST,+PSSIEN,"WARD",0)=$S(CNT1>0:CNT1,1:"-1^NO DATA FOUND FOR PSSWDIEN #"_PSSWDIEN)
"RTN","PSS51P1B",108,0)
 K ^TMP("DILIST",$J),^TMP($J,"PSS51P1")
"RTN","PSS51P1B",109,0)
 Q
"RTN","PSS51P1B",110,0)
 ;
"RTN","PSS51P1B",111,0)
6 ;
"RTN","PSS51P1B",112,0)
 I $G(PSSPP)]"",$P($G(^PS(51.1,+PSS(3),0)),"^",4)'=PSSPP Q
"RTN","PSS51P1B",113,0)
 K PSS51P1 D GETS^DIQ(51.1,+PSS(3),".01;1;2;2.5;4;5;6;8;8.1","IE","PSS51P1")
"RTN","PSS51P1B",114,0)
 N PSSXX S PSSXX=0 F  S PSSXX=$O(PSS51P1(51.1,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P1B",115,0)
 .S ^TMP($J,LIST,+PSSXX,.01)=$G(PSS51P1(51.1,PSSXX,.01,"E")),CNT=CNT+1
"RTN","PSS51P1B",116,0)
 .S ^TMP($J,LIST,"AP"_PSSPP,$G(PSS51P1(51.1,PSSXX,.01,"E")),+PSSXX)=""
"RTN","PSS51P1B",117,0)
 .S ^TMP($J,LIST,+PSSXX,1)=$G(PSS51P1(51.1,PSSXX,1,"E"))
"RTN","PSS51P1B",118,0)
 .S ^TMP($J,LIST,+PSSXX,2)=$G(PSS51P1(51.1,PSSXX,2,"E"))
"RTN","PSS51P1B",119,0)
 .S ^TMP($J,LIST,+PSSXX,2.5)=$G(PSS51P1(51.1,PSSXX,2.5,"E"))
"RTN","PSS51P1B",120,0)
 .S ^TMP($J,LIST,+PSSXX,4)=$G(PSS51P1(51.1,PSSXX,4,"E"))
"RTN","PSS51P1B",121,0)
 .S ^TMP($J,LIST,+PSSXX,5)=$S($G(PSS51P1(51.1,PSSXX,5,"I"))]"":$G(PSS51P1(51.1,PSSXX,5,"I"))_"^"_$G(PSS51P1(51.1,PSSXX,5,"E")),1:"")
"RTN","PSS51P1B",122,0)
 .S ^TMP($J,LIST,+PSSXX,6)=$G(PSS51P1(51.1,PSSXX,6,"E"))
"RTN","PSS51P1B",123,0)
 .S ^TMP($J,LIST,+PSSXX,8)=$G(PSS51P1(51.1,PSSXX,8,"E"))
"RTN","PSS51P1B",124,0)
 .S ^TMP($J,LIST,+PSSXX,8.1)=$G(PSS51P1(51.1,PSSXX,8.1,"E"))
"RTN","PSS51P1B",125,0)
 K PSS51P1
"RTN","PSS51P1B",126,0)
 Q
"RTN","PSS51P2")
0^8^B45679954^B45538228
"RTN","PSS51P2",1,0)
PSS51P2 ;BIR/LDT - API FOR INFORMATION FROM FILE 51.2; 5 Sep 03
"RTN","PSS51P2",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**85,112,118**;9/30/97;Build 8
"RTN","PSS51P2",3,0)
 ;
"RTN","PSS51P2",4,0)
ALL(PSSIEN,PSSFT,PSSFL,PSSPK,LIST) ;
"RTN","PSS51P2",5,0)
 ;PSSIEN - IEN of entry in MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",6,0)
 ;PSSFT - Free Text name in MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",7,0)
 ;PSSFL - Inactive flag - "" - All entries
"RTN","PSS51P2",8,0)
 ;        FileMan Date - Only entries with no Inactive Date or an Inactive Date greater than this date.
"RTN","PSS51P2",9,0)
 ;PSSPK - PACKAGE USE field (#3) of the MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",10,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is
"RTN","PSS51P2",11,0)
 ;the Field Number of the data piece being returned.
"RTN","PSS51P2",12,0)
 ;Returns NAME field (#.01), ABBREVIATION field (#1), PACKAGE USE field (#3), OUTPATIENT EXPANSION field (#4),
"RTN","PSS51P2",13,0)
 ;OTHER LANGUAGE EXPANSION field (#4.1), INACTIVATION DATE field (#5), and IV FLAG field (#6)
"RTN","PSS51P2",14,0)
 ;of MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",15,0)
 N DIERR,ZZERR,PSS51P2,SCR,PSS,PSSBGCNT,PSSCNT,PSSTIEN,PSSTMP,PSSNAM,PSSCAP
"RTN","PSS51P2",16,0)
 S PSSBGCNT=0
"RTN","PSS51P2",17,0)
 S SCR("S")=""
"RTN","PSS51P2",18,0)
 I $G(LIST)']"" Q
"RTN","PSS51P2",19,0)
 K ^TMP("DILIST",$J)
"RTN","PSS51P2",20,0)
 K ^TMP($J,LIST)
"RTN","PSS51P2",21,0)
 I +$G(PSSIEN)'>0,($G(PSSFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P2",22,0)
 S SCR("S")=""
"RTN","PSS51P2",23,0)
 I +$G(PSSFL)>0 N ND D SETSCRN
"RTN","PSS51P2",24,0)
 ;Naked reference below refers to ^PS(51.2,+Y,0)
"RTN","PSS51P2",25,0)
 I $G(PSSPK)]"" S SCR("S")=$S(SCR("S")]"":SCR("S")_" I $P($G(^(0)),U,4)=$G(PSSPK)",1:"I $P($G(^(0)),U,4)=$G(PSSPK)")
"RTN","PSS51P2",26,0)
 I +$G(PSSIEN)>0 N PSSIEN2 S PSSIEN2=$$FIND1^DIC(51.2,"","A","`"_PSSIEN,,SCR("S"),"") D  D COUNTBG Q
"RTN","PSS51P2",27,0)
 .I PSSIEN2>0 D DIRREAD
"RTN","PSS51P2",28,0)
 I +$G(PSSIEN)=0 D
"RTN","PSS51P2",29,0)
 .I PSSFT="??" D LOOPDIR D COUNTBG Q
"RTN","PSS51P2",30,0)
 .D FIND^DIC(51.2,,"@;.01;1","QP",PSSFT,,"B",SCR("S"),,"") D LOOPDI D COUNTBG
"RTN","PSS51P2",31,0)
 Q
"RTN","PSS51P2",32,0)
 ;
"RTN","PSS51P2",33,0)
COUNTBG ;CHECKS PSSBGCNT AND FILLS COUNT IN ON 0 NODE OF ^TMP($J,LIST)
"RTN","PSS51P2",34,0)
 I PSSBGCNT>0 D
"RTN","PSS51P2",35,0)
 .S ^TMP($J,LIST,0)=PSSBGCNT
"RTN","PSS51P2",36,0)
 ELSE  S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND"
"RTN","PSS51P2",37,0)
 Q
"RTN","PSS51P2",38,0)
 ;
"RTN","PSS51P2",39,0)
LOOPDI ;LOOPS ON "DILIST" FROM FILEMAN CALL (USED FOR RETURNING MULTIPLE DRUGS FROM PSSFT)
"RTN","PSS51P2",40,0)
 S PSSTIEN=0 ;TEMP IEN TO ITERATE OVER DILIST
"RTN","PSS51P2",41,0)
 F  S PSSTIEN=$O(^TMP("DILIST",$J,PSSTIEN)) Q:PSSTIEN=""  D
"RTN","PSS51P2",42,0)
 .S PSSIEN2=($P(^TMP("DILIST",$J,PSSTIEN,0),U,1))
"RTN","PSS51P2",43,0)
 .D DIRREAD
"RTN","PSS51P2",44,0)
 Q
"RTN","PSS51P2",45,0)
 ;
"RTN","PSS51P2",46,0)
LOOPDIR ;LOOP FOR A DIRECT READ.  READS ALL IENs FOR ^PSDRUG(
"RTN","PSS51P2",47,0)
 S PSSIEN2=0
"RTN","PSS51P2",48,0)
 F  S PSSIEN2=$O(^PS(51.2,PSSIEN2)) Q:'PSSIEN2  D 
"RTN","PSS51P2",49,0)
 .D DIRALL
"RTN","PSS51P2",50,0)
 Q
"RTN","PSS51P2",51,0)
 ;
"RTN","PSS51P2",52,0)
DIRALL ;TEST FOR PSSFL, PSSPK, BAILS IF CONDITIONS MEET TRUE
"RTN","PSS51P2",53,0)
 I $G(PSSFL),$P($G(^PS(51.2,PSSIEN2,0)),U,5),$P($G(^PS(51.2,PSSIEN2,0)),U,5)'>PSSFL Q
"RTN","PSS51P2",54,0)
 I $G(PSSPK)]"" N PSSZ5,PSSZ6 S PSSZ5=0 F PSSZ6=1:1:$L(PSSPK) Q:PSSZ5  I $P($G(^PS(51.2,PSSIEN2,0)),U,4)[$E(PSSPK,PSSZ6) S PSSZ5=1
"RTN","PSS51P2",55,0)
 I $G(PSSPK)]"",'PSSZ5 Q
"RTN","PSS51P2",56,0)
 D DIRREAD
"RTN","PSS51P2",57,0)
 Q
"RTN","PSS51P2",58,0)
 ;
"RTN","PSS51P2",59,0)
DIRREAD ;MAIN DIRECT READ FOR ENTIRE ROUTINE
"RTN","PSS51P2",60,0)
 S PSSNAM=$P($G(^PS(51.2,PSSIEN2,0)),U,1)
"RTN","PSS51P2",61,0)
 S ^TMP($J,LIST,PSSIEN2,.01)=PSSNAM
"RTN","PSS51P2",62,0)
 S ^TMP($J,LIST,PSSIEN2,1)=$P($G(^PS(51.2,PSSIEN2,0)),U,3)
"RTN","PSS51P2",63,0)
 S PSSTMP=$P($G(^PS(51.2,PSSIEN2,0)),U,4)
"RTN","PSS51P2",64,0)
 I PSSTMP="0" S ^TMP($J,LIST,PSSIEN2,3)=PSSTMP_U_"NATIONAL DRUG FILE ONLY"
"RTN","PSS51P2",65,0)
 I PSSTMP="1" S ^TMP($J,LIST,PSSIEN2,3)=PSSTMP_U_"ALL PACKAGES"
"RTN","PSS51P2",66,0)
 I PSSTMP="" S ^TMP($J,LIST,PSSIEN2,3)=""
"RTN","PSS51P2",67,0)
 S ^TMP($J,LIST,PSSIEN2,4)=$P($G(^PS(51.2,PSSIEN2,0)),U,2)
"RTN","PSS51P2",68,0)
 S ^TMP($J,LIST,PSSIEN2,4.1)=$P($G(^PS(51.2,PSSIEN2,0)),U,7)
"RTN","PSS51P2",69,0)
 I $P($G(^PS(51.2,PSSIEN2,0)),U,5)'="" D
"RTN","PSS51P2",70,0)
 .S PSSCAP=$$UP^XLFSTR($$FMTE^XLFDT($P($G(^PS(51.2,PSSIEN2,0)),U,5)))
"RTN","PSS51P2",71,0)
 .S ^TMP($J,LIST,PSSIEN2,5)=$P($G(^PS(51.2,PSSIEN2,0)),U,5)_U_PSSCAP
"RTN","PSS51P2",72,0)
 ELSE  S ^TMP($J,LIST,PSSIEN2,5)=""
"RTN","PSS51P2",73,0)
 N PSSTMP S PSSTMP=$P($G(^PS(51.2,PSSIEN2,0)),U,6)
"RTN","PSS51P2",74,0)
 I PSSTMP="0"!PSSTMP="" S ^TMP($J,LIST,PSSIEN2,6)=PSSTMP_U_"NO"
"RTN","PSS51P2",75,0)
 I PSSTMP="1" D
"RTN","PSS51P2",76,0)
 .S ^TMP($J,LIST,PSSIEN2,6)=PSSTMP_U_"YES"
"RTN","PSS51P2",77,0)
 .S ^TMP($J,LIST,"IV",PSSNAM,PSSIEN2)=""
"RTN","PSS51P2",78,0)
 I PSSTMP="" S ^TMP($J,LIST,PSSIEN2,6)=""
"RTN","PSS51P2",79,0)
 S ^TMP($J,LIST,"B",$P($G(^PS(51.2,PSSIEN2,0)),U,1),PSSIEN2)=""
"RTN","PSS51P2",80,0)
 S PSSBGCNT=PSSBGCNT+1
"RTN","PSS51P2",81,0)
 Q
"RTN","PSS51P2",82,0)
 ;
"RTN","PSS51P2",83,0)
SETSCRN ;Set Screen for inactive Medication Routes
"RTN","PSS51P2",84,0)
 ;Naked reference below refers to ^PS(51.2,+Y,0)
"RTN","PSS51P2",85,0)
 S SCR("S")="S ND=$P($G(^(0)),U,5) I ND=""""!(ND>PSSFL)"
"RTN","PSS51P2",86,0)
 Q
"RTN","PSS51P2",87,0)
 ;
"RTN","PSS51P2",88,0)
NAME(PSSFT,PSSPK,LIST) ;
"RTN","PSS51P2",89,0)
 ;PSSFT - Free Text name in MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",90,0)
 ;PSSPK - PACKAGE USE field (#3) of the MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",91,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is
"RTN","PSS51P2",92,0)
 ;the Field Number of the data piece being returned.
"RTN","PSS51P2",93,0)
 ;Returns NAME field (#.01), ABBREVIATION field (#1), and INACTIVATION DATE field (#5)
"RTN","PSS51P2",94,0)
 ;of MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",95,0)
 N DIERR,ZZERR,PSS51P2,SCR,PSS
"RTN","PSS51P2",96,0)
 I $G(LIST)']"" Q
"RTN","PSS51P2",97,0)
 K ^TMP($J,LIST)
"RTN","PSS51P2",98,0)
 I ($G(PSSFT)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P2",99,0)
 ;Naked reference below refers to ^PS(51.2,+Y,0)
"RTN","PSS51P2",100,0)
 S SCR("S")=$S($G(PSSPK)]"":"I $P($G(^(0)),""^"",4)=$G(PSSPK)",1:"")
"RTN","PSS51P2",101,0)
 I PSSFT["??" D LOOP(2) Q
"RTN","PSS51P2",102,0)
 D FIND^DIC(51.2,,"@;.01;1","QP",PSSFT,,"B",SCR("S"),,"")
"RTN","PSS51P2",103,0)
 I +$G(^TMP("DILIST",$J,0))=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P2",104,0)
 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0)
"RTN","PSS51P2",105,0)
 N PSSXX S PSSXX=0 F  S PSSXX=$O(^TMP("DILIST",$J,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P2",106,0)
 .S PSSIEN=+^TMP("DILIST",$J,PSSXX,0) K ^TMP("PSS51P2",$J) D GETS^DIQ(51.2,+PSSIEN,".01;1;5","IE","^TMP(""PSS51P2"",$J)") S PSS(1)=0
"RTN","PSS51P2",107,0)
 .F  S PSS(1)=$O(^TMP("PSS51P2",$J,51.2,PSS(1))) Q:'PSS(1)  D SETZRO2
"RTN","PSS51P2",108,0)
 K TMP("DILIST",$J),^TMP("PSS51P2",$J)
"RTN","PSS51P2",109,0)
 Q
"RTN","PSS51P2",110,0)
 ;
"RTN","PSS51P2",111,0)
IEN(PSSABBR,LIST) ;
"RTN","PSS51P2",112,0)
 ;PSSABBR - ABBREVIATION field (#1) in MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",113,0)
 ;LIST - Subscript of ^TMP array in the form ^TMP($J,LIST,Field Number where Field Number is
"RTN","PSS51P2",114,0)
 ;the Field Number of the data piece being returned.
"RTN","PSS51P2",115,0)
 ;Returns NAME field (#.01), ABBREVIATION field (#1), and INACTIVATION DATE field (#5)
"RTN","PSS51P2",116,0)
 ;of MEDICATION ROUTES file (#51.2).
"RTN","PSS51P2",117,0)
 N DIERR,ZZERR,PSS51P2,SCR,PSS
"RTN","PSS51P2",118,0)
 I $G(LIST)']"" Q
"RTN","PSS51P2",119,0)
 K ^TMP($J,LIST)
"RTN","PSS51P2",120,0)
 I ($G(PSSABBR)']"") S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P2",121,0)
 D FIND^DIC(51.2,,"@;.01;1","QP",PSSABBR,,"C",,,"")
"RTN","PSS51P2",122,0)
 I +$G(^TMP("DILIST",$J,0))=0 S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS51P2",123,0)
 S ^TMP($J,LIST,0)=+^TMP("DILIST",$J,0)
"RTN","PSS51P2",124,0)
 N PSSXX S PSSXX=0 F  S PSSXX=$O(^TMP("DILIST",$J,PSSXX)) Q:'PSSXX  D
"RTN","PSS51P2",125,0)
 .S PSSIEN=+^TMP("DILIST",$J,PSSXX,0) K ^TMP("PSS51P2",$J) D GETS^DIQ(51.2,+PSSIEN,".01;1;3;4;5;6;4.1","IE","^TMP(""PSS51P2"",$J)") S PSS(1)=0
"RTN","PSS51P2",126,0)
 .F  S PSS(1)=$O(^TMP("PSS51P2",$J,51.2,PSS(1))) Q:'PSS(1)  D SETZRO2
"RTN","PSS51P2",127,0)
 K TMP("DILIST",$J),^TMP("PSS51P2",$J)
"RTN","PSS51P2",128,0)
 Q
"RTN","PSS51P2",129,0)
 ;
"RTN","PSS51P2",130,0)
SETZRO ;
"RTN","PSS51P2",131,0)
 S ^TMP($J,LIST,+PSS(1),.01)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),.01,"I"))
"RTN","PSS51P2",132,0)
 S ^TMP($J,LIST,"B",$G(^TMP("PSS51P2",$J,51.2,PSS(1),.01,"I")),+PSS(1))=""
"RTN","PSS51P2",133,0)
 S ^TMP($J,LIST,+PSS(1),4)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),4,"I"))
"RTN","PSS51P2",134,0)
 S ^TMP($J,LIST,+PSS(1),1)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),1,"I"))
"RTN","PSS51P2",135,0)
 S ^TMP($J,LIST,+PSS(1),3)=$S($G(^TMP("PSS51P2",$J,51.2,PSS(1),3,"I"))="":"",1:^TMP("PSS51P2",$J,51.2,PSS(1),3,"I")_"^"_^TMP("PSS51P2",$J,51.2,PSS(1),3,"E"))
"RTN","PSS51P2",136,0)
 S ^TMP($J,LIST,+PSS(1),5)=$S($G(^TMP("PSS51P2",$J,51.2,PSS(1),5,"I"))="":"",1:^TMP("PSS51P2",$J,51.2,PSS(1),5,"I")_"^"_^TMP("PSS51P2",$J,51.2,PSS(1),5,"E"))
"RTN","PSS51P2",137,0)
 S ^TMP($J,LIST,+PSS(1),6)=$S($G(^TMP("PSS51P2",$J,51.2,PSS(1),6,"I"))="":"",1:^TMP("PSS51P2",$J,51.2,PSS(1),6,"I")_"^"_^TMP("PSS51P2",$J,51.2,PSS(1),6,"E"))
"RTN","PSS51P2",138,0)
 S ^TMP($J,LIST,+PSS(1),4.1)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),4.1,"I"))
"RTN","PSS51P2",139,0)
 Q
"RTN","PSS51P2",140,0)
 ;
"RTN","PSS51P2",141,0)
SETZRO2 ;
"RTN","PSS51P2",142,0)
 S ^TMP($J,LIST,+PSS(1),.01)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),.01,"I"))
"RTN","PSS51P2",143,0)
 S ^TMP($J,LIST,"B",$G(^TMP("PSS51P2",$J,51.2,PSS(1),.01,"I")),+PSS(1))=""
"RTN","PSS51P2",144,0)
 S ^TMP($J,LIST,+PSS(1),1)=$G(^TMP("PSS51P2",$J,51.2,PSS(1),1,"I"))
"RTN","PSS51P2",145,0)
 S ^TMP($J,LIST,+PSS(1),5)=$S($G(^TMP("PSS51P2",$J,51.2,PSS(1),5,"I"))="":"",1:^TMP("PSS51P2",$J,51.2,PSS(1),5,"I")_"^"_^TMP("PSS51P2",$J,51.2,PSS(1),5,"E"))
"RTN","PSS51P2",146,0)
 Q
"RTN","PSS51P2",147,0)
 ;
"RTN","PSS51P2",148,0)
LOOP(PSS) ;
"RTN","PSS51P2",149,0)
 N CNT S CNT=0
"RTN","PSS51P2",150,0)
 S PSSIEN=0 F  S PSSIEN=$O(^PS(51.2,PSSIEN)) Q:'PSSIEN  D @(PSS)
"RTN","PSS51P2",151,0)
 S ^TMP($J,LIST,0)=$S($G(CNT)>0:CNT,1:"-1^NO DATA FOUND")
"RTN","PSS51P2",152,0)
 Q
"RTN","PSS51P2",153,0)
 ;
"RTN","PSS51P2",154,0)
1 ;
"RTN","PSS51P2",155,0)
 S ND=$G(^PS(51.2,+PSSIEN,0))
"RTN","PSS51P2",156,0)
 I +$G(PSSFL)>0 Q:$P($G(ND),"^",5)]""&($P($G(ND),"^",5)'>$G(PSSFL))
"RTN","PSS51P2",157,0)
 I $G(PSSPK)]"" Q:$P($G(ND),"^",4)'=$G(PSSPK)
"RTN","PSS51P2",158,0)
 K ^TMP("PSS51P2",$J) D GETS^DIQ(51.2,+PSSIEN,".01;1;3;4;5;6;4.1","IE","^TMP(""PSS51P2"",$J)") S PSS(1)=0 D
"RTN","PSS51P2",159,0)
 .F  S PSS(1)=$O(^TMP("PSS51P2",$J,51.2,PSS(1))) Q:'PSS(1)  D SETZRO S CNT=CNT+1
"RTN","PSS51P2",160,0)
 Q
"RTN","PSS51P2",161,0)
 ;
"RTN","PSS51P2",162,0)
2 ;
"RTN","PSS51P2",163,0)
 I $G(PSSPK)]"",$P($G(^PS(51.2,+PSSIEN,0)),"^",4)'=$G(PSSPK) Q
"RTN","PSS51P2",164,0)
 K ^TMP("PSS51P2",$J) D GETS^DIQ(51.2,+PSSIEN,".01;1;5","IE","^TMP(""PSS51P2"",$J)") S PSS(1)=0 D
"RTN","PSS51P2",165,0)
 .F  S PSS(1)=$O(^TMP("PSS51P2",$J,51.2,PSS(1))) Q:'PSS(1)  D SETZRO2 S CNT=CNT+1
"RTN","PSS51P2",166,0)
 Q
"RTN","PSS55")
0^1^B48173815^B41074993
"RTN","PSS55",1,0)
PSS55 ;BHM/DB/TSS - API FOR PHARMACY PATIENT FILE ;15 JUN 05
"RTN","PSS55",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**101,108,118**;9/30/97;Build 8
"RTN","PSS55",3,0)
 ;;Reference to ^PSNDF(50.606 is supported by DBIA 2174
"RTN","PSS55",4,0)
PSS431(DFN,PO,PSDATE,PEDATE,LIST) ;
"RTN","PSS55",5,0)
 G ^PSS551
"RTN","PSS55",6,0)
PSS432(DFN,PO,LIST) ;SRS 3.2.43.2
"RTN","PSS55",7,0)
 N D0,DA,DR,DIC,IEN,PSSTMP,PSSTMP2
"RTN","PSS55",8,0)
 ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS55",9,0)
 ;PO: Order # IEN [optional] If left blank, all active orders will be returned
"RTN","PSS55",10,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",11,0)
 N PSSPO,PSSDT,PSSIEN,PSSDATA
"RTN","PSS55",12,0)
 Q:$G(LIST)=""  K ^TMP($J,LIST)
"RTN","PSS55",13,0)
 I +$G(DFN)'>0 G NODATA
"RTN","PSS55",14,0)
 S ^TMP($J,LIST,0)=0
"RTN","PSS55",15,0)
 I '$D(^PS(55,DFN,0)) G NODATA
"RTN","PSS55",16,0)
 I $G(PO)'="",$D(^PS(55,DFN,5,PO)) S PSSPO=$P(^PS(55,DFN,5,PO,0),"^") I $G(PSSPO)>0 S (DA(55.06),IEN)=PO G AUS2
"RTN","PSS55",17,0)
 I $G(PO)'="",$G(PSSPO)="" G NODATA
"RTN","PSS55",18,0)
 S PSSDT=0
"RTN","PSS55",19,0)
AUS ;Loop through stop date/time xref
"RTN","PSS55",20,0)
 F  S PSSDT=$O(^PS(55,DFN,5,"AUS",PSSDT)) Q:PSSDT'>0  S PSSIEN=0 D
"RTN","PSS55",21,0)
 .F  S PSSIEN=$O(^PS(55,DFN,5,"AUS",PSSDT,PSSIEN)) Q:PSSIEN'>0  D
"RTN","PSS55",22,0)
 ..S (IEN,DA(55.06))=PSSIEN,PSSDATA=$G(^PS(55,DFN,5,PSSIEN,0)) I $P(PSSDATA,"^",9)'="A" Q
"RTN","PSS55",23,0)
 ..D AUSDIQ
"RTN","PSS55",24,0)
 S ^TMP($J,LIST,0)=$S(^TMP($J,LIST,0)=0:"-1^NO DATA FOUND",1:^TMP($J,LIST,0))
"RTN","PSS55",25,0)
 K PSSIEN,PSSDT,PSSDATA,LIST
"RTN","PSS55",26,0)
 Q
"RTN","PSS55",27,0)
AUSDIQ K ^UTILITY("DIQ1",$J),DIQ
"RTN","PSS55",28,0)
 S DA=DFN,DIC=55,DR=62,DR(55.06)=".01;.5;1;3;4;5;6;7;9;11;12;26;27;27.1;28",DIQ(0)="IE" D EN^DIQ1
"RTN","PSS55",29,0)
 S PSSPO=$G(^UTILITY("DIQ1",$J,55.06,IEN,.01,"E")) F X=.01,.5,1,3,4,5,6,7,9,11,12,26,27,27.1,28 S ^TMP($J,LIST,IEN,X)=$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"I"))
"RTN","PSS55",30,0)
 F X=.5,1,3,4,5,6,7,9,27,27.1,28 S ^TMP($J,LIST,IEN,X)=$S($G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E"))'="":^TMP($J,LIST,IEN,X)_"^"_$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E")),1:"")
"RTN","PSS55",31,0)
 S PSSTMP=$P($G(^PS(55,DFN,5,IEN,.2)),U) I PSSTMP'="" S ^TMP($J,LIST,IEN,108)=$$ORDITEM(+PSSTMP)
"RTN","PSS55",32,0)
 K ^UTILITY("DIQ1",$J),DIQ
"RTN","PSS55",33,0)
 S ^TMP($J,LIST,"B",IEN)="",^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",34,0)
 Q
"RTN","PSS55",35,0)
ORDITEM(PSSTMP) ;
"RTN","PSS55",36,0)
 ;Reference to ^PSNDF(50.606 is supported by DBIA 2174
"RTN","PSS55",37,0)
 S PSSTMP2=$G(^PS(50.7,PSSTMP,0))
"RTN","PSS55",38,0)
 I PSSTMP2'="" S PSSTMP=PSSTMP_U_$P($G(PSSTMP2),U)_U_$P($G(PSSTMP2),U,2)_U_$P($G(^PS(50.606,$P($G(PSSTMP2),U,2),0)),U,1)
"RTN","PSS55",39,0)
 Q PSSTMP
"RTN","PSS55",40,0)
AUS2 ;one PO
"RTN","PSS55",41,0)
 S PSSQ=1 D AUSDIQ
"RTN","PSS55",42,0)
 S ^TMP($J,LIST,0)=$S(^TMP($J,LIST,0)=0:"-1^NO DATA FOUND",1:^TMP($J,LIST,0))
"RTN","PSS55",43,0)
AUSQ K PSSDT,PSSIEN,PSSDATA,PSSPO,LIST,X,PSSQ,DA,DR,DIC Q
"RTN","PSS55",44,0)
 ;
"RTN","PSS55",45,0)
PSS433(DFN,LIST) ;
"RTN","PSS55",46,0)
 ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS55",47,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",48,0)
 N X,DA,DR,PSSPO,PSSIEN,D0,IEN,PSSTMP,PSSTMP2
"RTN","PSS55",49,0)
 Q:$G(LIST)=""  K ^TMP($J,LIST)
"RTN","PSS55",50,0)
 I $G(DFN)'>0 S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",51,0)
 I '$D(^PS(55,DFN)) G NODATA
"RTN","PSS55",52,0)
 S PSSIEN=0,^TMP($J,LIST,0)=0
"RTN","PSS55",53,0)
BGN433 S PSSIEN=$O(^PS(55,DFN,5,PSSIEN)) G Q433:PSSIEN'>0 S PSSPO=$P($G(^PS(55,DFN,5,PSSIEN,0)),"^")
"RTN","PSS55",54,0)
 S (IEN,DA(55.06))=PSSIEN,DIC=55,DA=DFN,DR=62,DR(55.06)=".5;9;25;26;34;41;42;70",DIQ(0)="IE" D EN^DIQ1
"RTN","PSS55",55,0)
 F X=.5,9,25,26,34,41,42,70 S ^TMP($J,LIST,+PSSIEN,X)=$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"I"))
"RTN","PSS55",56,0)
 S PSSTMP=$P($G(^PS(55,DFN,5,PSSIEN,.2)),U) I PSSTMP'=""  S ^TMP($J,LIST,PSSIEN,108)=$$ORDITEM(+PSSTMP)
"RTN","PSS55",57,0)
 F X=.5,9,25,34,70 S ^TMP($J,LIST,+PSSIEN,X)=$S($G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E"))'="":^TMP($J,LIST,+PSSIEN,X)_"^"_$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E")),1:"")
"RTN","PSS55",58,0)
 S ^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",59,0)
 S ^TMP($J,LIST,"B",+PSSIEN)=""
"RTN","PSS55",60,0)
 G BGN433
"RTN","PSS55",61,0)
Q433 K ^UTILITY("DIQ1",$J),PSSIEN,X,DR,DIC,DA,LIST Q
"RTN","PSS55",62,0)
PSS435(DFN,PO,LIST) ;SRS 3.2.43.5
"RTN","PSS55",63,0)
 N D0,DA,DIC,DR,IEN,X,PSSPO,PSSDATA,PSSIEN,PSSDT,PSSTMP,PSSTMP2
"RTN","PSS55",64,0)
 ;DFN:  IEN of Patient [REQUIRED]
"RTN","PSS55",65,0)
 ;PO: Order # [optional] If left blank, all active orders will be returned. 
"RTN","PSS55",66,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",67,0)
 ;Active hyperal orders utilizing "AIT" cross reference
"RTN","PSS55",68,0)
 Q:$G(LIST)=""  K ^TMP($J,LIST)
"RTN","PSS55",69,0)
 I $G(DFN)'>0  S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",70,0)
 I '$D(^PS(55,DFN,"IV","AIT","H")) S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",71,0)
 S PSSDT=0,^TMP($J,LIST,0)=0
"RTN","PSS55",72,0)
AIT ;loop trough AIT xref
"RTN","PSS55",73,0)
 S PSSDT=$O(^PS(55,DFN,"IV","AIT","H",PSSDT)) G AITQ:PSSDT'>0 S PSSIEN=0
"RTN","PSS55",74,0)
AIT1 S PSSIEN=$O(^PS(55,DFN,"IV","AIT","H",PSSDT,PSSIEN)) G AIT:PSSIEN'>0
"RTN","PSS55",75,0)
 S PSSDATA=$G(^PS(55,DFN,"IV",PSSIEN,0)),PSSSTAT=$P($G(PSSDATA),"^",17) I PSSSTAT'="A",$G(PO)'>0 G AIT1
"RTN","PSS55",76,0)
 I +$G(PO)>0 G AIT1:PSSIEN'=PO
"RTN","PSS55",77,0)
 S PSSPO=$P(PSSDATA,"^",1),^TMP($J,LIST,"B",+PSSIEN)=""
"RTN","PSS55",78,0)
AITDIQ K ^UTILITY("DIQ1",$J) S DA=DFN,(IEN,DA(55.01))=PSSIEN,DIC=55,DR=100,DIQ(0)="IE",DR(55.01)=".01;.02;.03;.04;.06;.08;.09;.12;.17;.24;9;31;100;104;106;108;110;112;120;121;132" D EN^DIQ1
"RTN","PSS55",79,0)
 F X=.01,.02,.03,.04,.06,.08,.09,.12,.17,.24,9,31,100,104,106,108,110,112,120,121,132 S ^TMP($J,LIST,PSSPO,X)=$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"I"))
"RTN","PSS55",80,0)
 F X=.02,.03,.04,.06,9,100,106,108,112,120,121,132 S ^TMP($J,LIST,PSSPO,X)=$S($G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E"))'="":^TMP($J,LIST,PSSPO,X)_"^"_$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E")),1:"")
"RTN","PSS55",81,0)
 S PSSTMP=$P($G(^PS(55,DFN,"IV",PSSIEN,.2)),U) I PSSTMP'="" S ^TMP($J,LIST,PSSIEN,130)=$$ORDITEM(+PSSTMP)
"RTN","PSS55",82,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PSS55",83,0)
 S ^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",84,0)
 G AIT1
"RTN","PSS55",85,0)
AITQ I $G(^TMP($J,LIST,0))=0 K ^TMP($J,LIST) S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSS55",86,0)
 K PSSIEN,PSSDT,PSSSTAT,PSSDATA,PO,X,LIST Q
"RTN","PSS55",87,0)
 ;
"RTN","PSS55",88,0)
PSS436(DFN,ORDER,LIST) ;SRS 3.2.43.6
"RTN","PSS55",89,0)
 N D0,IEN,X,PSSTMP,PSSTMP2
"RTN","PSS55",90,0)
 ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS55",91,0)
 ;ORDER:  ORDER NUMBER [REQUIRED]
"RTN","PSS55",92,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",93,0)
 ;Active IV AD nodes
"RTN","PSS55",94,0)
 K PSSLOOP Q:$G(LIST)=""  K ^TMP($J,LIST) I $G(DFN)'>0  S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",95,0)
 I '$D(^PS(55,DFN)) S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",96,0)
 K ^TMP($J,LIST) I $G(ORDER)="" S PSSLOOP=1 S ORDER=0 G LOOP436
"RTN","PSS55",97,0)
 I $G(ORDER)'="" S PSSPO=$O(^PS(55,DFN,"IV","B",ORDER,0)) G PSS436Q:$G(PSSPO)'>0 G DIQ436
"RTN","PSS55",98,0)
LOOP436 S ORDER=$O(^PS(55,DFN,"IV","B",ORDER)) G PSS436Q:ORDER'>0  S PSSPO=$O(^PS(55,DFN,"IV","B",ORDER,0))
"RTN","PSS55",99,0)
DIQ436 K DA,DR S DA=DFN,(IEN,DA(55.01))=PSSPO,DIC=55,DR=100
"RTN","PSS55",100,0)
 S DR(55.01)=".01;.02;.03;.04;.06;.08;.09;.12;.17;.24;9;31;100;104;106;108;110;112;120;121;132;147"
"RTN","PSS55",101,0)
 S DIQ(0)="IE" D EN^DIQ1 I '$D(^UTILITY("DIQ1",$J)) G NODATA
"RTN","PSS55",102,0)
 F X=.01,.02,.03,.04,.06,.08,.09,.12,.17,.24,9,31,100,104,106,108,110,112,120,121,132,147 S ^TMP($J,LIST,PSSPO,X)=$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"I"))
"RTN","PSS55",103,0)
 F X=.02,.03,.04,.06,9,100,106,108,112,120,121,132,147 S ^TMP($J,LIST,PSSPO,X)=$S($G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E"))'="":^TMP($J,LIST,PSSPO,X)_"^"_$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E")),1:"")
"RTN","PSS55",104,0)
 S PSSTMP=$P($G(^PS(55,DFN,"IV",PSSPO,.2)),U) I PSSTMP'="" S ^TMP($J,LIST,PSSPO,130)=$$ORDITEM(+PSSTMP)
"RTN","PSS55",105,0)
 S ^TMP($J,LIST,"B",PSSPO)="",PSSA=0,^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",106,0)
 S ^TMP($J,LIST,PSSPO,"ADD",0)=0
"RTN","PSS55",107,0)
PSSA S PSSA=$O(^PS(55,DFN,"IV",PSSPO,"AD",PSSA)) I PSSA'>0 S PSSS=0 S ^TMP($J,LIST,PSSPO,"SOL",0)=0 G PSSS
"RTN","PSS55",108,0)
 S PSSDATA=$G(^PS(55,DFN,"IV",PSSPO,"AD",PSSA,0)),X1=$P(PSSDATA,"^"),X2=$P(PSSDATA,"^",2),X3=$P(PSSDATA,"^",3)
"RTN","PSS55",109,0)
 S ^TMP($J,LIST,PSSPO,"ADD",PSSA,.01)=X1_"^"_$P($G(^PS(52.6,X1,0)),"^")
"RTN","PSS55",110,0)
 S ^TMP($J,LIST,PSSPO,"ADD",PSSA,.02)=X2
"RTN","PSS55",111,0)
 S ^TMP($J,LIST,PSSPO,"ADD",PSSA,.03)=X3
"RTN","PSS55",112,0)
 S ^TMP($J,LIST,PSSPO,"ADD",0)=$G(^TMP($J,LIST,PSSPO,"ADD",0))+1
"RTN","PSS55",113,0)
 G PSSA
"RTN","PSS55",114,0)
PSSS I ^TMP($J,LIST,PSSPO,"ADD",0)'>0 S ^TMP($J,LIST,PSSPO,"ADD",0)="-1^NO DATA FOUND"
"RTN","PSS55",115,0)
 S PSSS=$O(^PS(55,DFN,"IV",PSSPO,"SOL",PSSS)) I PSSS'>0,$G(PSSLOOP)'=1 D  G PSS436Q
"RTN","PSS55",116,0)
 .I ^TMP($J,LIST,PSSPO,"SOL",0)=0 S ^TMP($J,LIST,PSSPO,"SOL",0)="-1^NO DATA FOUND"
"RTN","PSS55",117,0)
 I PSSS'>0 D  G LOOP436
"RTN","PSS55",118,0)
 .I ^TMP($J,LIST,PSSPO,"SOL",0)=0 S ^TMP($J,LIST,PSSPO,"SOL",0)="-1^NO DATA FOUND"
"RTN","PSS55",119,0)
 S PSSDATA=$G(^PS(55,DFN,"IV",PSSPO,"SOL",PSSS,0)),X1=$P(PSSDATA,"^"),X2=$P(PSSDATA,"^",2)
"RTN","PSS55",120,0)
 S ^TMP($J,LIST,PSSPO,"SOL",PSSS,.01)=X1_"^"_$P($G(^PS(52.7,X1,0)),"^")
"RTN","PSS55",121,0)
 S ^TMP($J,LIST,PSSPO,"SOL",PSSS,1)=X2
"RTN","PSS55",122,0)
 S ^TMP($J,LIST,PSSPO,"SOL",0)=$G(^TMP($J,LIST,PSSPO,"SOL",0))+1
"RTN","PSS55",123,0)
 G PSSS
"RTN","PSS55",124,0)
PSS436Q K ^UTILITY("DIQ1",$J),DIQ I '$D(^TMP($J,LIST,"B")) S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSS55",125,0)
 K PSSPO,PSSA,PSSDATA,X,LIST,X1,X2,PSSS,ORDER,PSSLOOP,DA,DR,DIC Q
"RTN","PSS55",126,0)
NODATA S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSS55",127,0)
Q K IEN,PSSA,PSSS,PSSSTAT,X,LIST,X1,X2,X3,PSSDIY Q
"RTN","PSS551")
0^6^B15638671^B14966377
"RTN","PSS551",1,0)
PSS551 ;BHM/DB - API FOR PHARMACY PATIENT FILE ;15 JUN 05
"RTN","PSS551",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**108,118**;9/30/97;Build 8
"RTN","PSS551",3,0)
 ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS551",4,0)
 ;PO: Order # [optional]
"RTN","PSS551",5,0)
 ;PSDATE: Start Date [optional]
"RTN","PSS551",6,0)
 ;PEDATE: End Date [optional]
"RTN","PSS551",7,0)
 ;If a start date is sent, an end date must also be sent
"RTN","PSS551",8,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS551",9,0)
 N PSSPO,PSSIEN,DA,DR,DIC,PSS,CNT1,X,PSSTMP
"RTN","PSS551",10,0)
 I $G(LIST)="" Q
"RTN","PSS551",11,0)
 K ^TMP($J,LIST)
"RTN","PSS551",12,0)
 I $G(DFN)="" S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS551",13,0)
 S PSSIEN=$G(DFN),PSSPO=$G(PO) S ^TMP($J,LIST,0)=0
"RTN","PSS551",14,0)
 I $G(PSSPO)>0,$G(PSSIEN)>0 S DA=PSSIEN,(IEN,DA(55.06))=PSSPO G DIQ431
"RTN","PSS551",15,0)
 I $G(PSSPO)="",$G(PSDATE)'="",$G(PEDATE)'="" S PSDATE=$S('$P(PSDATE,".",2):PSDATE_.000001,1:PSDATE),PEDATE=$S('$P($G(PEDATE),".",2):PEDATE_.999999,1:$G(PEDATE)) N PSS56 G DT431
"RTN","PSS551",16,0)
 I $G(PSSPO)="" N PSSPO1 G LOOP431
"RTN","PSS551",17,0)
 Q
"RTN","PSS551",18,0)
LOOP431 S (PSSPO1,PSSPO)=0 F  S PSSPO1=$O(^PS(55,DFN,5,"B",PSSPO1)) Q:PSSPO1'>0  F  S PSSPO=$O(^PS(55,DFN,5,"B",PSSPO1,PSSPO)) Q:PSSPO'>0  S PO=PSSPO D DIQ431
"RTN","PSS551",19,0)
 Q
"RTN","PSS551",20,0)
DIQ431 ;
"RTN","PSS551",21,0)
 I '$D(^PS(55,DFN,5,PO,0)) Q
"RTN","PSS551",22,0)
 S PSSIEN=PO_","_DFN_"," K DIQ
"RTN","PSS551",23,0)
 D GETS^DIQ(55.06,PSSIEN,".01;.5;1;2*;3;4;5;6;7;11;12;27;27.1;28;66","IE","^TMP(""PSS5506"",$J)")
"RTN","PSS551",24,0)
 F X=.01,.5,1,3,4,5,6,7,11,12,27,27.1,28,66 S ^TMP($J,LIST,+PSSPO,X)=$G(^TMP("PSS5506",$J,55.06,PSSIEN,X,"I"))
"RTN","PSS551",25,0)
 F X=.5,1,3,4,5,6,7,27,27.1,28 S ^TMP($J,LIST,+PSSPO,X)=$S($G(^TMP("PSS5506",$J,55.06,PSSIEN,X,"E"))'="":^TMP($J,LIST,+PSSPO,X)_"^"_$G(^TMP("PSS5506",$J,55.06,PSSIEN,X,"E")),1:"")
"RTN","PSS551",26,0)
 S PSSTMP=$P($G(^PS(55,DFN,5,PO,.2)),U) I PSSTMP'="" S ^TMP($J,LIST,PO,108)=$$ORDITEM^PSS55(+PSSTMP)
"RTN","PSS551",27,0)
 S (PSS(1),CNT1)=0 F  S PSS(1)=$O(^TMP("PSS5506",$J,55.07,PSS(1))) Q:'PSS(1)  D
"RTN","PSS551",28,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.11)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.11,"I"))
"RTN","PSS551",29,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.12)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.12,"I"))
"RTN","PSS551",30,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.01)=$S($G(^TMP("PSS5506",$J,55.07,PSS(1),.01,"E"))'="":$G(^TMP("PSS5506",$J,55.07,PSS(1),.01,"I"))_"^"_$G(^TMP("PSS5506",$J,55.07,PSS(1),.01,"E")),1:"")
"RTN","PSS551",31,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.02)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.02,"I"))
"RTN","PSS551",32,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.03)=$S($G(^TMP("PSS5506",$J,55.07,PSS(1),.03,"E"))'="":$G(^TMP("PSS5506",$J,55.07,PSS(1),.03,"I"))_"^"_$G(^TMP("PSS5506",$J,55.07,PSS(1),.03,"E")),1:"")
"RTN","PSS551",33,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.04)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.04,"I"))
"RTN","PSS551",34,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.05)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.05,"I"))
"RTN","PSS551",35,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.06)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.06,"I"))
"RTN","PSS551",36,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.07)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.07,"I"))
"RTN","PSS551",37,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.08)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.08,"I"))
"RTN","PSS551",38,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.09)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.09,"I"))
"RTN","PSS551",39,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.1)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.1,"I"))
"RTN","PSS551",40,0)
 .S CNT1=CNT1+1
"RTN","PSS551",41,0)
 K ^TMP("PSS5506",$J),PSS(1) S ^TMP($J,LIST,"B",+PSSPO)=""
"RTN","PSS551",42,0)
 S ^TMP($J,LIST,0)=^TMP($J,LIST,0)+1
"RTN","PSS551",43,0)
 S ^TMP($J,LIST,+PSSPO,"DDRUG",0)=$S(CNT1=0:"-1^NO DATA FOUND",1:CNT1)
"RTN","PSS551",44,0)
 S ^TMP($J,LIST,0)=$S(^TMP($J,LIST,0)=0:"-1^NO DATA FOUND",1:^TMP($J,LIST,0))
"RTN","PSS551",45,0)
 Q
"RTN","PSS551",46,0)
DT431 F  S PSDATE=$O(^PS(55,DFN,5,"AUS",PSDATE)) Q:((+$G(PEDATE)>0)&(PSDATE>$G(PEDATE)))  Q:PSDATE'>0  D
"RTN","PSS551",47,0)
 .S PSS56=0 F  S PSS56=$O(^PS(55,DFN,5,"AUS",PSDATE,PSS56)) Q:PSS56'>0  S (PSSPO,PO)=PSS56 D DIQ431
"RTN","PSS551",48,0)
 S ^TMP($J,LIST,0)=$S(^TMP($J,LIST,0)=0:"-1^NO DATA FOUND",1:^TMP($J,LIST,0))
"RTN","PSS551",49,0)
 K CNT1,LIST,DA,DFN,DIC,DIQ,DR,IEN,PEDATE,PO,PSDATE,PSS,PSS56,PSSPO,PSSPO1,X Q
"RTN","PSSDI")
0^2^B34671411^B33977209
"RTN","PSSDI",1,0)
PSSDI ;BIR/LDT/TSS - API FOR FILEMAN CALLS ;5 Sep 03
"RTN","PSSDI",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**85,91,97,104,108,118**;9/30/97;Build 8
"RTN","PSSDI",3,0)
 ;
"RTN","PSSDI",4,0)
DIC(PSSFILE,PSSAPP,DIC,X,DLAYGO,PSSSCRDT,PSSSCRUS,PSSVACL) ;
"RTN","PSSDI",5,0)
 N PSSX1 ;ADDED BY TS ON 09.20.2006
"RTN","PSSDI",6,0)
 S PSSDIY=""
"RTN","PSSDI",7,0)
 I +$G(PSSFILE)'>0 S PSSDIY=-1 G Q
"RTN","PSSDI",8,0)
 N PSRTEST S PSRTEST=$$TEST(PSSFILE)
"RTN","PSSDI",9,0)
 I 'PSRTEST S PSSDIY=-1 G Q
"RTN","PSSDI",10,0)
 K DIC("S")
"RTN","PSSDI",11,0)
 I +$G(PSSSCRDT)>0 N PSSSUBSC,PSSPIECE D SCREEN
"RTN","PSSDI",12,0)
 I $D(PSSVACL),$O(PSSVACL(0))'="" D VACL I $D(PSSX1) S DIC("S")=$S($G(DIC("S"))'="":DIC("S")_" ",1:"")_PSSX1 K PSSX1
"RTN","PSSDI",13,0)
 I $G(PSSSCRUS)'="",$G(PSSFILE)=50 N PSSAPLP D
"RTN","PSSDI",14,0)
 .S DIC("S")=$S($G(DIC("S"))'="":DIC("S")_" ",1:"")_"F PSSAPLP=1:1:$L(PSSSCRUS) I $P($G(^(2)),""^"",3)[$E(PSSSCRUS,PSSAPLP) Q"
"RTN","PSSDI",15,0)
 I '$P(PSRTEST,"^",2) K DLAYGO I $G(DIC(0))'="" S DIC(0)=$TR(DIC(0),"L","") I $G(DIC(0))="" S PSSDIY=-1 G Q
"RTN","PSSDI",16,0)
 I $G(DIC(0))="",$G(X)="" S PSSDIY=-1 G Q
"RTN","PSSDI",17,0)
 K DTOUT,DUOUT D ^DIC
"RTN","PSSDI",18,0)
 G Q
"RTN","PSSDI",19,0)
DO(PSSFILE,PSSAPP,DIC) ;
"RTN","PSSDI",20,0)
 S PSSDIY=""
"RTN","PSSDI",21,0)
 I +$G(PSSFILE)'>0 S PSSDIY=-1 G Q
"RTN","PSSDI",22,0)
 N PSRTEST S PSRTEST=$$TEST(PSSFILE)
"RTN","PSSDI",23,0)
 I 'PSRTEST S PSSDIY=-1 G Q
"RTN","PSSDI",24,0)
 K DTOUT,DUOUT D DO^DIC1
"RTN","PSSDI",25,0)
 Q
"RTN","PSSDI",26,0)
IX(PSSFILE,PSSAPP,DIC,D,X,DLAYGO) ;
"RTN","PSSDI",27,0)
 S PSSDIY=""
"RTN","PSSDI",28,0)
 I +$G(PSSFILE)'>0 S PSSDIY=-1 G Q
"RTN","PSSDI",29,0)
 N PSRTEST S PSRTEST=$$TEST(PSSFILE)
"RTN","PSSDI",30,0)
 I 'PSRTEST S PSSDIY=-1 G Q
"RTN","PSSDI",31,0)
 I '$P(PSRTEST,"^",2) K DLAYGO I $G(DIC(0))'="" S DIC(0)=$TR(DIC(0),"L","") I $G(DIC(0))="" S PSSDIY=-1 G Q
"RTN","PSSDI",32,0)
 I $G(DIC(0))="",$G(X)="" S PSSDIY=-1 G Q
"RTN","PSSDI",33,0)
 K DTOUT,DUOUT D IX^DIC
"RTN","PSSDI",34,0)
 Q
"RTN","PSSDI",35,0)
MIX(PSSFILE,PSSAPP,DIC,D,X,DLAYGO,PSSSCRDT,PSSSCRUS,PSSVACL) ;
"RTN","PSSDI",36,0)
 N PSSX1 ;ADDED BY TS ON 09.20.2006
"RTN","PSSDI",37,0)
 S PSSDIY=""
"RTN","PSSDI",38,0)
 I +$G(PSSFILE)'>0 S PSSDIY=-1 G Q
"RTN","PSSDI",39,0)
 N PSRTEST S PSRTEST=$$TEST(PSSFILE)
"RTN","PSSDI",40,0)
 I 'PSRTEST S PSSDIY=-1 G Q
"RTN","PSSDI",41,0)
 K DIC("S")
"RTN","PSSDI",42,0)
 I +$G(PSSSCRDT)>0 N PSSSUBSC,PSSPIECE D SCREEN
"RTN","PSSDI",43,0)
 I $D(PSSVACL),$O(PSSVACL(0))'="" D VACL I $D(PSSX1) S DIC("S")=$S($G(DIC("S"))'="":DIC("S")_" ",1:"")_PSSX1 K PSSX1
"RTN","PSSDI",44,0)
 I $G(PSSSCRUS)'="",$G(PSSFILE)=50 N PSSAPLP D
"RTN","PSSDI",45,0)
 .S DIC("S")=$S($G(DIC("S"))'="":DIC("S")_" ",1:"")_"F PSSAPLP=1:1:$L(PSSSCRUS) I $P($G(^(2)),""^"",3)[$E(PSSSCRUS,PSSAPLP) Q"
"RTN","PSSDI",46,0)
 I '$P(PSRTEST,"^",2) K DLAYGO I $G(DIC(0))'="" S DIC(0)=$TR(DIC(0),"L","") I $G(DIC(0))="" S PSSDIY=-1 G Q
"RTN","PSSDI",47,0)
 I $G(DIC(0))="",$G(X)="" S PSSDIY=-1 G Q
"RTN","PSSDI",48,0)
 K DTOUT,DUOUT D MIX^DIC1
"RTN","PSSDI",49,0)
 G Q
"RTN","PSSDI",50,0)
FILE(PSSFILE,PSSAPP,DIC,DA,X,DINUM,DLAYGO) ;
"RTN","PSSDI",51,0)
 S PSSDIY=""
"RTN","PSSDI",52,0)
 I +$G(PSSFILE)'>0 S PSSDIY=-1 G Q
"RTN","PSSDI",53,0)
 N PSRTEST S PSRTEST=$$TEST(PSSFILE)
"RTN","PSSDI",54,0)
 I 'PSRTEST S PSSDIY=-1 G Q
"RTN","PSSDI",55,0)
 I '$P(PSRTEST,"^",2) S PSSDIY=-1 G Q
"RTN","PSSDI",56,0)
 K DTOUT,DUOUT,DO D FILE^DICN
"RTN","PSSDI",57,0)
 Q
"RTN","PSSDI",58,0)
DIE(PSSFILE,PSSAPP,DIE,DA,DR,DIDEL) ;
"RTN","PSSDI",59,0)
 S PSSDIY=""
"RTN","PSSDI",60,0)
 I +$G(PSSFILE)'>0 S PSSDIY=-1 G Q
"RTN","PSSDI",61,0)
 N PSRTEST S PSRTEST=$$TEST(PSSFILE)
"RTN","PSSDI",62,0)
 I 'PSRTEST S PSSDIY=-1 G Q
"RTN","PSSDI",63,0)
 I '$P(PSRTEST,"^",2) S PSSDIY=-1 G Q
"RTN","PSSDI",64,0)
 K DTOUT D ^DIE
"RTN","PSSDI",65,0)
 Q
"RTN","PSSDI",66,0)
EN1(PSSFILE,PSSAPP,DIC,L,FLDS,BY,FR,TO,DHD) ;
"RTN","PSSDI",67,0)
 S PSSDIY=""
"RTN","PSSDI",68,0)
 I +$G(PSSFILE)'>0 S PSSDIY=-1 G Q
"RTN","PSSDI",69,0)
 N PSRTEST S PSRTEST=$$TEST(PSSFILE)
"RTN","PSSDI",70,0)
 I 'PSRTEST S PSSDIY=-1 G Q
"RTN","PSSDI",71,0)
 D EN1^DIP
"RTN","PSSDI",72,0)
 Q
"RTN","PSSDI",73,0)
EN(PSSFILE,PSSAPP,DIC,DR,DA,DIQ) ;
"RTN","PSSDI",74,0)
 S PSSDIY=""
"RTN","PSSDI",75,0)
 I +$G(PSSFILE)'>0 S PSSDIY=-1 G Q
"RTN","PSSDI",76,0)
 N PSRTEST S PSRTEST=$$TEST(PSSFILE)
"RTN","PSSDI",77,0)
 I 'PSRTEST S PSSDIY=-1 G Q
"RTN","PSSDI",78,0)
 D EN^DIQ1
"RTN","PSSDI",79,0)
 Q
"RTN","PSSDI",80,0)
FNAME(PSSFNO,PSSFILE) ;
"RTN","PSSDI",81,0)
 ;Return the label for the field of the File or Subfile passed in
"RTN","PSSDI",82,0)
 ;PSSFNO  - Field number
"RTN","PSSDI",83,0)
 ;PSSFILE - File or Subfile number
"RTN","PSSDI",84,0)
 Q $$FNAME^PSS50E($G(PSSFNO),$G(PSSFILE))
"RTN","PSSDI",85,0)
 ;
"RTN","PSSDI",86,0)
TEST(PSTFILE) ;
"RTN","PSSDI",87,0)
 N CNT,PSSAPP2,PSFFLAG,PSFLOOP,PSFTEST,PSLNODE,PSRSLT S PSRSLT="0^0",PSFFLAG=0
"RTN","PSSDI",88,0)
 F PSFLOOP=1:1 S PSFTEST=$P($T(FILE2+PSFLOOP),";;",2) Q:+$G(PSFTEST)'>0!PSFFLAG  I +PSFTEST=PSTFILE S $P(PSRSLT,"^")=1 S PSLNODE=$T(FILE2+PSFLOOP) D
"RTN","PSSDI",89,0)
 .F CNT=2:1:$L(PSLNODE,";;") S PSSAPP2=$P(PSLNODE,";;",CNT) Q:$P(PSRSLT,"^",2)=1  I PSSAPP2=$G(PSSAPP) S PSFFLAG=1,$P(PSRSLT,"^",2)=1
"RTN","PSSDI",90,0)
 Q PSRSLT
"RTN","PSSDI",91,0)
 ;
"RTN","PSSDI",92,0)
FILE2 ;For DIC call, IF PACKAGE IS LISTED, PACKAGE HAS WRITE ACCESS          
"RTN","PSSDI",93,0)
 ;;50;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",94,0)
 ;;50.1;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",95,0)
 ;;50.0214;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",96,0)
 ;;50.037;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",97,0)
 ;;50.065;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",98,0)
 ;;50.0212;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",99,0)
 ;;50.0441;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",100,0)
 ;;50.01;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",101,0)
 ;;50.02;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",102,0)
 ;;50.0903;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",103,0)
 ;;50.0904;;PSX;;PSD;;PSJ;;PSN;;PSO;;PSGW;;PSS
"RTN","PSSDI",104,0)
 ;;50.4;;PSJ;;PSS
"RTN","PSSDI",105,0)
 ;;50.606;;PSJ;;PSN;;PSS
"RTN","PSSDI",106,0)
 ;;50.7;;PSJ;;PSO;;PSN;;PSS
"RTN","PSSDI",107,0)
 ;;50.76;;PSJ;;PSO;;PSN;;PSS
"RTN","PSSDI",108,0)
 ;;50.72;;PSJ;;PSO;;PSN;;PSS
"RTN","PSSDI",109,0)
 ;;51;;PSJ;;PSS
"RTN","PSSDI",110,0)
 ;;51.01;;PSJ;;PSS
"RTN","PSSDI",111,0)
 ;;51.1;;PSJ;;PSS
"RTN","PSSDI",112,0)
 ;;51.11;;PSJ;;PSS
"RTN","PSSDI",113,0)
 ;;51.17;;PSJ;;PSS
"RTN","PSSDI",114,0)
 ;;51.2;;PSJ;;PSS
"RTN","PSSDI",115,0)
 ;;51.5;;PSS
"RTN","PSSDI",116,0)
 ;;52.6;;PSJ;;PSN;;PSS
"RTN","PSSDI",117,0)
 ;;52.61;;PSJ;;PSN;;PSS
"RTN","PSSDI",118,0)
 ;;52.62;;PSJ;;PSN;;PSS
"RTN","PSSDI",119,0)
 ;;52.63;;PSJ;;PSN;;PSS
"RTN","PSSDI",120,0)
 ;;52.64;;PSJ;;PSN;;PSS
"RTN","PSSDI",121,0)
 ;;52.7;;PSJ;;PSN;;PSS
"RTN","PSSDI",122,0)
 ;;52.702;;PSJ;;PSN;;PSS
"RTN","PSSDI",123,0)
 ;;52.703;;PSJ;;PSN;;PSS
"RTN","PSSDI",124,0)
 ;;52.704;;PSJ;;PSN;;PSS
"RTN","PSSDI",125,0)
 ;;54;;PSS;;PSO
"RTN","PSSDI",126,0)
 ;;54.1;;PSS;;PSO
"RTN","PSSDI",127,0)
 ;;9009032.3;;PSS
"RTN","PSSDI",128,0)
 ;;9009032.5;;PSS
"RTN","PSSDI",129,0)
 ;;
"RTN","PSSDI",130,0)
 Q
"RTN","PSSDI",131,0)
 ;
"RTN","PSSDI",132,0)
FILE3 ;For Lookup calls, check for Inactive Date Screen
"RTN","PSSDI",133,0)
 ;;50;;I;;1
"RTN","PSSDI",134,0)
 ;;50.606;;0;;2
"RTN","PSSDI",135,0)
 ;;50.7;;0;;4
"RTN","PSSDI",136,0)
 ;;51.2;;0;;5
"RTN","PSSDI",137,0)
 ;;52.6;;I;;1
"RTN","PSSDI",138,0)
 ;;52.7;;I;;1
"RTN","PSSDI",139,0)
 ;;
"RTN","PSSDI",140,0)
 Q
"RTN","PSSDI",141,0)
SCREEN ;Set screen if Inactive Date is passed in, and for File 50, addition screen if Application Packages Use is passed in
"RTN","PSSDI",142,0)
 N PSSILOOP,PSSILOC,PSSINFLG,PSSINODE S PSSINFLG=0
"RTN","PSSDI",143,0)
 F PSSILOOP=1:1 S PSSILOC=$P($T(FILE3+PSSILOOP),";;",2) Q:+$G(PSSILOC)'>0!PSSINFLG  I +PSSILOC=PSSFILE S PSSINFLG=1 S PSSINODE=$T(FILE3+PSSILOOP) D
"RTN","PSSDI",144,0)
 .S PSSSUBSC=$P(PSSINODE,";;",3),PSSPIECE=$P(PSSINODE,";;",4)
"RTN","PSSDI",145,0)
 .I PSSSUBSC'="",PSSPIECE'="" S DIC("S")="I $P($G(^(PSSSUBSC)),""^"",PSSPIECE)=""""!(+$P($G(^(PSSSUBSC)),""^"",PSSPIECE)>+$G(PSSSCRDT))"
"RTN","PSSDI",146,0)
 Q
"RTN","PSSDI",147,0)
VACL S PSSVACL1=0,PSSX=$S($D(PSSVACL("R")):"=",1:"'=") K PSSX1
"RTN","PSSDI",148,0)
 F  S PSSVACL1=$O(PSSVACL(PSSVACL1)) Q:PSSVACL1=""  I PSSVACL1'="R",PSSVACL1'="P" S PSSX1=$S($G(PSSX1)="":"I $P(^PSDRUG(+Y,0),U,2)"_PSSX_""""_PSSVACL1_"""",1:PSSX1_$S(PSSX="=":"!",1:"&")_"($P(^PSDRUG(+Y,0),U,2)"_PSSX_""""_PSSVACL1_""""_")")
"RTN","PSSDI",149,0)
 Q
"RTN","PSSDI",150,0)
Q K PSSVACL,PSSVACL1,PSSX,PSSX1,PSSFILE,PSSAPP,PSSINODE,PSSSCRUS Q
"VER")
8.0^22.0
"BLD",6388,6)
^109
**END**
**END**
