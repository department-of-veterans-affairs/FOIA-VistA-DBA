Released SD*5.3*473 SEQ #411
Extracted from mail message
**KIDS**:SD*5.3*473^

**INSTALL NAME**
SD*5.3*473
"BLD",6984,0)
SD*5.3*473^SCHEDULING^0^3070419^y
"BLD",6984,1,0)
^^4^4^3070209^
"BLD",6984,1,1,0)
Inactivate menu option SD TRANS RX CANC APPT REPORT per HSD&D request.  
"BLD",6984,1,2,0)
Also, fix errors occurring with several Scheduling options:  Clinic 
"BLD",6984,1,3,0)
Availability Report, Clinic Assignment Listing, No Show Report, Patient 
"BLD",6984,1,4,0)
Profile MAS and Cancelling Appointment.
"BLD",6984,4,0)
^9.64PA^^
"BLD",6984,6.3)
4
"BLD",6984,"ABPKG")
n
"BLD",6984,"KRN",0)
^9.67PA^8989.52^19
"BLD",6984,"KRN",.4,0)
.4
"BLD",6984,"KRN",.401,0)
.401
"BLD",6984,"KRN",.402,0)
.402
"BLD",6984,"KRN",.403,0)
.403
"BLD",6984,"KRN",.5,0)
.5
"BLD",6984,"KRN",.84,0)
.84
"BLD",6984,"KRN",3.6,0)
3.6
"BLD",6984,"KRN",3.8,0)
3.8
"BLD",6984,"KRN",9.2,0)
9.2
"BLD",6984,"KRN",9.8,0)
9.8
"BLD",6984,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",6984,"KRN",9.8,"NM",1,0)
SDCLAS^^0^B18871590
"BLD",6984,"KRN",9.8,"NM",2,0)
SDCLAV0^^0^B9198436
"BLD",6984,"KRN",9.8,"NM",3,0)
SDCLAV1^^0^B53863406
"BLD",6984,"KRN",9.8,"NM",4,0)
SDCNP0^^0^B32984064
"BLD",6984,"KRN",9.8,"NM",5,0)
SDCNP1A^^0^B30809654
"BLD",6984,"KRN",9.8,"NM",6,0)
SDNOS0^^0^B27834725
"BLD",6984,"KRN",9.8,"NM",7,0)
SDPPAPP1^^0^B15912910
"BLD",6984,"KRN",9.8,"NM","B","SDCLAS",1)

"BLD",6984,"KRN",9.8,"NM","B","SDCLAV0",2)

"BLD",6984,"KRN",9.8,"NM","B","SDCLAV1",3)

"BLD",6984,"KRN",9.8,"NM","B","SDCNP0",4)

"BLD",6984,"KRN",9.8,"NM","B","SDCNP1A",5)

"BLD",6984,"KRN",9.8,"NM","B","SDNOS0",6)

"BLD",6984,"KRN",9.8,"NM","B","SDPPAPP1",7)

"BLD",6984,"KRN",19,0)
19
"BLD",6984,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",6984,"KRN",19,"NM",1,0)
SD TRANS RX CANC APPT REPORT^^1^
"BLD",6984,"KRN",19,"NM","B","SD TRANS RX CANC APPT REPORT",1)

"BLD",6984,"KRN",19.1,0)
19.1
"BLD",6984,"KRN",101,0)
101
"BLD",6984,"KRN",409.61,0)
409.61
"BLD",6984,"KRN",771,0)
771
"BLD",6984,"KRN",870,0)
870
"BLD",6984,"KRN",8989.51,0)
8989.51
"BLD",6984,"KRN",8989.52,0)
8989.52
"BLD",6984,"KRN",8994,0)
8994
"BLD",6984,"KRN","B",.4,.4)

"BLD",6984,"KRN","B",.401,.401)

"BLD",6984,"KRN","B",.402,.402)

"BLD",6984,"KRN","B",.403,.403)

"BLD",6984,"KRN","B",.5,.5)

"BLD",6984,"KRN","B",.84,.84)

"BLD",6984,"KRN","B",3.6,3.6)

"BLD",6984,"KRN","B",3.8,3.8)

"BLD",6984,"KRN","B",9.2,9.2)

"BLD",6984,"KRN","B",9.8,9.8)

"BLD",6984,"KRN","B",19,19)

"BLD",6984,"KRN","B",19.1,19.1)

"BLD",6984,"KRN","B",101,101)

"BLD",6984,"KRN","B",409.61,409.61)

"BLD",6984,"KRN","B",771,771)

"BLD",6984,"KRN","B",870,870)

"BLD",6984,"KRN","B",8989.51,8989.51)

"BLD",6984,"KRN","B",8989.52,8989.52)

"BLD",6984,"KRN","B",8994,8994)

"BLD",6984,"QUES",0)
^9.62^^
"BLD",6984,"REQB",0)
^9.611^5^5
"BLD",6984,"REQB",1,0)
SD*5.3*80^2
"BLD",6984,"REQB",2,0)
SD*5.3*243^2
"BLD",6984,"REQB",3,0)
SD*5.3*410^2
"BLD",6984,"REQB",4,0)
SD*5.3*478^2
"BLD",6984,"REQB",5,0)
SD*5.3*490^2
"BLD",6984,"REQB","B","SD*5.3*243",2)

"BLD",6984,"REQB","B","SD*5.3*410",3)

"BLD",6984,"REQB","B","SD*5.3*478",4)

"BLD",6984,"REQB","B","SD*5.3*490",5)

"BLD",6984,"REQB","B","SD*5.3*80",1)

"KRN",19,13006,-1)
1^1
"KRN",19,13006,0)
SD TRANS RX CANC APPT REPORT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
473^3070419
"PKG",16,22,1,"PAH",1,1,0)
^^4^4^3070419
"PKG",16,22,1,"PAH",1,1,1,0)
Inactivate menu option SD TRANS RX CANC APPT REPORT per HSD&D request.  
"PKG",16,22,1,"PAH",1,1,2,0)
Also, fix errors occurring with several Scheduling options:  Clinic 
"PKG",16,22,1,"PAH",1,1,3,0)
Availability Report, Clinic Assignment Listing, No Show Report, Patient 
"PKG",16,22,1,"PAH",1,1,4,0)
Profile MAS and Cancelling Appointment.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","SDCLAS")
0^1^B18871590^B18724083
"RTN","SDCLAS",1,0)
SDCLAS ;ALB/TMP,MRY - Clinic Assignment List Extract ;12/23/92  11:42
"RTN","SDCLAS",2,0)
 ;;5.3;Scheduling;**63,243,473**;Aug 13, 1993;Build 4
"RTN","SDCLAS",3,0)
 ;SD/473 CORRECTED ALL $NEXT FUNCTIONAL COMMANDS
"RTN","SDCLAS",4,0)
 S DIV="" D DIV^SDUTL I $T D CALST^SDDIV Q:Y<0
"RTN","SDCLAS",5,0)
 S:'$D(DTIME) DTIME=300 I '$D(DT) D DT^SDUTL
"RTN","SDCLAS",6,0)
 S SDIFN="",SDI=0,DIC="^SC(",DIC(0)="EFMQ",DIC("S")="I $P(^(0),U,3)=""C"",'$G(^(""OOS"")),$S(DIV="""":1,$P(^(0),U,15)=DIV:1,1:0)" D SELECT^SDCLAS0 K DIC Q:X["^"
"RTN","SDCLAS",7,0)
 S Y=DT D DTS^SDUTL S SDTS=Y
"RTN","SDCLAS",8,0)
OPT2 W !!,"Select 'As of' Date: ",SDTS," // " R X:DTIME Q:X["^"  I X']"" S SDTS=DT G OVR
"RTN","SDCLAS",9,0)
 S %DT(0)=-DT,%DT="EPX" D ^%DT K %DT
"RTN","SDCLAS",10,0)
 I Y'>0 W !,*7,"A date must be entered here to get a 'snapshot' of the clinic's enrollment as of",!,"  this date.  Date can not be in future." G OPT2
"RTN","SDCLAS",11,0)
 S SDTS=+Y
"RTN","SDCLAS",12,0)
OVR I SDSRT="C",SDSAV']"",SDIFN'="ALL",$S('$D(^SC(SDIFN,"I")):0,+^("I")=0:0,+^("I")>SDTS:0,+$P(^("I"),"^",2)'>SDTS&(+$P(^("I"),"^",2)'=0):0,1:1) W !,"Clinic ",$S(SDTS=DT:"is",1:"was")," inactive" W:SDTS<DT " on date selected" G END^SDCLAS1
"RTN","SDCLAS",13,0)
 W !!,*7,"This needs to be printed at 132 columns"
"RTN","SDCLAS",14,0)
 S PGM="START^SDCLAS",VAR="SDIFN^SDSRT^DIV^SDTS^SDSAV^SDFAST",VAL=SDIFN_"^"_SDSRT_"^"_DIV_"^"_SDTS_"^"_SDSAV_"^"_SDFAST D ZIS^DGUTQ Q:POP
"RTN","SDCLAS",15,0)
START K ^UTILITY($J) S SDSTOP=$S(SDSRT="S":SDIFN,1:""),SD1="",U="^" U IO G:SDIFN="ALL"!(SDSRT="S")!(SDSAV]"") ALL
"RTN","SDCLAS",16,0)
ONE S ONE=1 D INIT S SDAPPT=0 F  S SDAPPT=$O(^SC(SDIFN,"S",SDAPPT)) Q:'SDAPPT  D PT
"RTN","SDCLAS",17,0)
 D:'SDFAST AEB^SDCLAS0 G ^SDCLAS1
"RTN","SDCLAS",18,0)
ALL S ONE=0 I SDSAV']"" S SDIFN=0 F  S SDIFN=$O(^SC(SDIFN)) Q:'SDIFN  I $P(^(SDIFN,0),"^",3)="C" D APPT
"RTN","SDCLAS",19,0)
 I SDSAV]"" D APART S SDIFN=0 F  S SDIFN=$O(SDZ(SDIFN)) Q:'SDIFN  I $D(^SC(SDIFN,0)),$P(^(0),"^",3)="C" D APPT
"RTN","SDCLAS",20,0)
 G ^SDCLAS1
"RTN","SDCLAS",21,0)
APPT D CHECK I 'POP K ^UTILITY($J,"PAT",SDIFN) D INIT S SDAPPT=0 F  S SDAPPT=$O(^SC(SDIFN,"S",SDAPPT)) D:SDAPPT PT I 'SDAPPT D:'SDFAST AEB^SDCLAS0 Q
"RTN","SDCLAS",22,0)
 Q
"RTN","SDCLAS",23,0)
PT S SD=0 F  S SD=$O(^SC(SDIFN,"S",SDAPPT,1,SD)) Q:'SD  Q:'$D(^(SD,0))  S DFN=+^(0) D PT1
"RTN","SDCLAS",24,0)
 Q
"RTN","SDCLAS",25,0)
PT1 I '$D(^UTILITY($J,"PAT",SDIFN,DFN)),$D(^DPT(DFN,0)),$D(^("S",SDAPPT,0)),$P(^(0),"^",2)=""!($P(^(0),"^",2)="I"),$S('$D(^DPT(DFN,.35)):1,'^(.35):1,1:0) D S,EXT^SDCLAS0
"RTN","SDCLAS",26,0)
 Q
"RTN","SDCLAS",27,0)
S S Y(0)=^DPT(DFN,0),SDACT=1,SDENR=0 D SET1
"RTN","SDCLAS",28,0)
 S I=0 F  S I=$O(^DPT(DFN,"DE","B",SDIFN,I)) Q:'I  I $D(^DPT(DFN,"DE",I,0)) D EDENR Q:SDENR
"RTN","SDCLAS",29,0)
 S ^UTILITY($J,"PAT",SDIFN,DFN)="" S:'$D(Y(1))!('SDENR) Y(1)="" I '$D(^UTILITY($J,"PAT"," ",DFN)) D MT S ^UTILITY($J,"PAT"," ",DFN)=$P(Y(0),"^",9)_"^"_SDELIG_"^"_SDZIP_"^"_$P(Y(0),"^",3)_U_SDMT
"RTN","SDCLAS",30,0)
 Q
"RTN","SDCLAS",31,0)
EDENR K Y(1) S I1=0 F  S I1=$O(^DPT(DFN,"DE",I,1,I1)) Q:'I1  S X=$P(^(I1,0),"^"),X(1)=$P(^(0),"^",3) Q:X>SDTS  S:'X(1)!(X(1)>SDTS) Y(1)=^(0),SDENR=1 Q:SDENR
"RTN","SDCLAS",32,0)
 Q
"RTN","SDCLAS",33,0)
SET1 S SDELIG=$S($D(^DPT(DFN,.36)):$P(^(.36),"^",1),1:""),SDELIG=$S($D(^DIC(8,+SDELIG,0)):SDELIG,1:""),SDELIG(1)=$S(SDELIG]"":$P(^(0),"^",5),1:""),SDZIP=$S($D(^DPT(DFN,.11)):$P(^(.11),"^",6),1:"")
"RTN","SDCLAS",34,0)
 Q
"RTN","SDCLAS",35,0)
MT ;
"RTN","SDCLAS",36,0)
 S SDMT="*" Q:SDELIG(1)']""  I SDELIG(1)="N" S SDMT="N" Q
"RTN","SDCLAS",37,0)
 S SDMT=$$LST^DGMTU(DFN) I SDMT']"" S SDMT=$S(SDELIG'=6:"A",1:"X") Q
"RTN","SDCLAS",38,0)
 S:$P(SDMT,U,2)>SDTS SDMT=$$LST^DGMTU(DFN,SDTS)
"RTN","SDCLAS",39,0)
 I $P(SDMT,U,4)="P" S SDMT=$$PA^DGMTUTL($P(SDMT,U)),SDMT=$S('$D(SDMT):"U",SDMT="MT":"C",SDMT="GMT":"G",1:"U")
"RTN","SDCLAS",40,0)
 E  S SDMT=$P(SDMT,U,4)
"RTN","SDCLAS",41,0)
 I SDMT="" S SDMT="X"
"RTN","SDCLAS",42,0)
 I SDMT="P" S SDMT="C"
"RTN","SDCLAS",43,0)
 I SDMT="R" S SDMT="U"
"RTN","SDCLAS",44,0)
 I SDMT="N" S SDMT="A"
"RTN","SDCLAS",45,0)
 D DOM^SDOPC4(DFN,SDTS_.9,.SDMT) I SDMT="X0" S SDMT="X"
"RTN","SDCLAS",46,0)
 K SDMT1 Q
"RTN","SDCLAS",47,0)
CHECK S POP=0 I SDSRT="S",SDSTOP'="ALL",$P(^SC(SDIFN,0),"^",7)'=SDSTOP S POP=1 Q
"RTN","SDCLAS",48,0)
 I $S(DIV="":1,$P(^SC(SDIFN,0),"^",15)=DIV:1,1:0),$S('$D(^SC(SDIFN,"I")):1,+^("I")=0:1,+^("I")>DT:1,+$P(^("I"),"^",2)'>DT&(+$P(^("I"),"^",2)'=0):1,1:0) Q
"RTN","SDCLAS",49,0)
 S POP=1 Q
"RTN","SDCLAS",50,0)
APART S SDZ="" F I=1:1 Q:$P(SDSAV,",",I)']""  S SDZ=$P(SDSAV,",",I) D:SDZ["--" SPLIT^SDCLAS0 I SDZ'["--" S:'$D(SDZ(+SDZ)) SDZ(+SDZ)=""
"RTN","SDCLAS",51,0)
 Q
"RTN","SDCLAS",52,0)
INIT F I1="SDENR","SDACT" S I2="^UTILITY("_$J_","""_I1_""","_SDIFN_")",@I2=0
"RTN","SDCLAS",53,0)
 Q
"RTN","SDCLAV0")
0^2^B9198436^B6584983
"RTN","SDCLAV0",1,0)
SDCLAV0 ;ALB/LDB - OUTPUT PATTERNS (cont.) ; 05 Mar 99 11:31 AM
"RTN","SDCLAV0",2,0)
 ;;5.3;Scheduling;**184,439,490,473**;Aug 13, 1993;Build 4
"RTN","SDCLAV0",3,0)
 ;SD/473 CHANGED FOR LOOPS
"RTN","SDCLAV0",4,0)
 I 'VAUTC S SDC=0 F  S SDC=$O(VAUTC(SDC)) Q:'SDC  S SDV=VAUTC(SDC) D:VAUTD!($D(VAUTD(+$P(^SC(SDC,0),"^",15))))!('$P(^(0),"^",15)&$D(VAUTD($P(^DG(43,1,"GL"),"^",3)))) S1
"RTN","SDCLAV0",5,0)
 I VAUTC S SDC=0 F  S SDC=$O(^SC(SDC)) Q:'SDC  I $P(^(SDC,0),"^",3)="C" D:VAUTD!($D(VAUTD(+$P(^(0),"^",15))))!('$P(^(0),"^",15)&$D(VAUTD($P(^DG(43,1,"GL"),"^",3)))) S1
"RTN","SDCLAV0",6,0)
 I $D(^UTILITY($J,"SDNMS")) D S2^SDCLAV1
"RTN","SDCLAV0",7,0)
 S DGTCH="CLINIC AVAILABILITY REPORT^CLINIC^PAGE#" D:$E(IOST,1,2)="P-" TP^DGUTL K SDBD,SDCI,SDED D END^SDCLAV Q
"RTN","SDCLAV0",8,0)
S1 S SD=^SC(SDC,0),D=$S($P(SD,"^",15):$P(SD,"^",15),1:$P(^DG(43,1,"GL"),"^",3)),SD5=0,SDNM=$P(SD,"^")
"RTN","SDCLAV0",9,0)
 S $P(^UTILITY($J,"SDNMS",D,SDNM),"^",3)=SDC
"RTN","SDCLAV0",10,0)
 Q
"RTN","SDCLAV0",11,0)
NM ;called by SDCLAV1 - SD/473 CHANGED FOR LOOP
"RTN","SDCLAV0",12,0)
 S SDAP1=0 F  S SDAP1=$O(^SC(SDC,"S",SDAP,1,SDAP1)) Q:'SDAP1  D NM1
"RTN","SDCLAV0",13,0)
 K M1,SDN1,SDN2,SDN3,SDC3,SDAP1  ; SD*5.3*439 added Kill of local vars
"RTN","SDCLAV0",14,0)
 Q
"RTN","SDCLAV0",15,0)
NM1 I '$D(^SC(SDC,"S",SDAP,1,SDAP1,0)) N POP S POP=0 D CHECK,KILL Q  ;added SD/473
"RTN","SDCLAV0",16,0)
 S SDN1=+^SC(SDC,"S",SDAP,1,SDAP1,0),M1=$P(^(0),"^",2),SDC3=$P(^(0),"^",9),SDN2=$P(^DPT(+SDN1,0),"^"),SDN3=$P(^(0),"^",9),SDN3=$S(SDN3="":"UNKNOWN",1:SDN3) I $D(SDCI) D NM2 Q
"RTN","SDCLAV0",17,0)
 ; SD*5.3*439 added quit if clinic in "S" node not = to selected clinic
"RTN","SDCLAV0",18,0)
 I '$D(SDCI),$D(^DPT(SDN1,"S",SDAP,0)),$P(^(0),"^",2)'["C",$P(^(0),"^",2)'="N",$P(^(0),"^",2)'="NA" Q:$P(^(0),U,1)'=SDC  D NM2 Q
"RTN","SDCLAV0",19,0)
 Q
"RTN","SDCLAV0",20,0)
 ;SD*5.3*490 do not display appts prior to clinic start date
"RTN","SDCLAV0",21,0)
NM2 Q:$P(SDAP,".",1)<$O(^SC(SDC,"T",0))  ;SD*5.3*490
"RTN","SDCLAV0",22,0)
 S:$D(^DPT(SDN1,"S",SDAP,0)) ^UTILITY($J,"SDNMS",D,SDV,SDAP,SDN2,SDN3)=M1_$S(($P(^DPT(SDN1,"S",SDAP,0),"^",2)["C"):"^*",SDC3="C":"^*",($P(^(0),"^",2)="N"):"^**",($P(^(0),"^",2)="NA"):"^**",1:"")
"RTN","SDCLAV0",23,0)
 S:$D(^DPT(SDN1,"S",SDAP,0)) $P(^UTILITY($J,"SDNMS",D,SDV,SDAP,SDN2,SDN3),"^",3)=$S($P(^DPT(SDN1,"S",SDAP,0),"^",7)=4:"***",1:"")
"RTN","SDCLAV0",24,0)
 Q
"RTN","SDCLAV0",25,0)
 ;
"RTN","SDCLAV0",26,0)
CHECK ;Added SD/473
"RTN","SDCLAV0",27,0)
 N SDIEN,NODE,NODE0,HDFN,HDNAM,HDSN,POP
"RTN","SDCLAV0",28,0)
 S SDIEN=0,NODE="",HDAP1=SDAP1
"RTN","SDCLAV0",29,0)
 F  S SDIEN=$O(^SCE("B",SDAP,SDIEN)) Q:'SDIEN  D
"RTN","SDCLAV0",30,0)
 .S NODE=^SCE(SDIEN,0)
"RTN","SDCLAV0",31,0)
 .Q:$P(NODE,U,4)'=SDC
"RTN","SDCLAV0",32,0)
 .S HDFN=$P(NODE,U,2),HDNAM=$P(^DPT(HDFN,0),U),HDSN=$P(^(0),U,9)
"RTN","SDCLAV0",33,0)
 .Q:$D(^UTILITY($J,"SDNMS",D,SDV,SDAP,HDNAM,HDSN))
"RTN","SDCLAV0",34,0)
 .S POP=0 D CHECK1 Q:POP
"RTN","SDCLAV0",35,0)
 .S SDN1=$P(NODE,U,2),SDN2=$P(^DPT(SDN1,0),U),SDN3=$P(^DPT(SDN1,0),U,9),M1="",SDC3=""
"RTN","SDCLAV0",36,0)
 .D NM2
"RTN","SDCLAV0",37,0)
 Q
"RTN","SDCLAV0",38,0)
 ;
"RTN","SDCLAV0",39,0)
CHECK1 ;Added SD/473
"RTN","SDCLAV0",40,0)
 S HDAP1=$O(^SC(SDC,"S",SDAP,1,HDAP1)) Q:'HDAP1
"RTN","SDCLAV0",41,0)
 Q:'$D(^SC(SDC,"S",SDAP,1,HDAP1,0))  S NODE0=^(0)
"RTN","SDCLAV0",42,0)
 I $P(NODE0,U,1)=HDFN S POP=1 Q
"RTN","SDCLAV0",43,0)
 Q
"RTN","SDCLAV0",44,0)
 ;
"RTN","SDCLAV0",45,0)
KILL K SDIEN,NODE,NODE0,POP,HDFN,HDNAM,HDSN,HDAP1  ;added SD/473
"RTN","SDCLAV0",46,0)
 Q
"RTN","SDCLAV1")
0^3^B53863406^B39056960
"RTN","SDCLAV1",1,0)
SDCLAV1 ;ALB/LDB - OUTPUT PATTERNS (cont.) ; 9/1/00 10:57am
"RTN","SDCLAV1",2,0)
 ;;5.3;Scheduling;**140,167,168,76,383,463,490,473**;Aug 13, 1993;Build 4
"RTN","SDCLAV1",3,0)
 ;
"RTN","SDCLAV1",4,0)
 ;PATCH 383 STOPPED REPORT FROM CREATING AVAILIBILTY-TEH
"RTN","SDCLAV1",5,0)
 ;
"RTN","SDCLAV1",6,0)
S2 N I1,SC,SDAV,SDMED,SI,SL,SM,SS,STARTDAY,SDDD,YCNT,SDFRST
"RTN","SDCLAV1",7,0)
 S P=0 F D=0:0 S D=$O(^UTILITY($J,"SDNMS",D)) Q:D'>0!(SDUP)  S SDV="",SDZ2=SDBD F X5=0:0 S SDV=$O(^UTILITY($J,"SDNMS",D,SDV)) Q:SDV=""!SDUP  S SDC=$P(^UTILITY($J,"SDNMS",D,SDV),"^",3) D S ;Q:SDUP  ;D WR ;,SS
"RTN","SDCLAV1",8,0)
 Q
"RTN","SDCLAV1",9,0)
S1 S SD=^SC(SDC,0),D=$S($P(SD,"^",15):$P(SD,"^",15),1:$P(^DG(43,1,"GL"),"^",3)),SD5=0,SDNM=$P(SD,"^")
"RTN","SDCLAV1",10,0)
 S $P(^UTILITY($J,"SDNMS",D,SDNM),"^",3)=SDC Q
"RTN","SDCLAV1",11,0)
S I '$D(^SC(SDC,"SL")) D SDM,HDR W !!,"THIS CLINIC DOES NOT HAVE APPT. LENGTH" Q
"RTN","SDCLAV1",12,0)
 S (SDZ,SDZ2)=SDBD D SDM,HDR,TIME S SDZ=SDBD-1,SD0=0,SDMED=SDED+.9
"RTN","SDCLAV1",13,0)
 N X,SDSOH S SC=+SDC,SL=^SC(SC,"SL"),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),X=$P(SL,U,6),SI=$S(X="":4,X<3:4,X:X,1:4),X=SDBD,SDSOH=$P(SL,"^",8),SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00",SDZ=SDBD
"RTN","SDCLAV1",14,0)
 N POP S POP=0  ;SD/473
"RTN","SDCLAV1",15,0)
LOOP D SDM D:0&$E(SDZ,2,5)=$E(SDZ1,2,5) MON I $E(SDZ,2,5)'=$E(SDZ1,2,5) I 'SDUP D X1 I 'SDUP D A I 'SDUP D:SD0!($E(IOST,1,2)="C-") 3 I 'SDUP D WR I 'SDUP,$E(IOST,1,2)="C-" D 3
"RTN","SDCLAV1",16,0)
 D:POP MSG  ;SD/473
"RTN","SDCLAV1",17,0)
 I 'SDUP I X<SDED S (X,SDZ2)=$S($E(X,4,5)=12:$E(X,1,3)+1_"01",1:$E(X,1,5)+1)_"01",SDZ=X D SDM,HDR,TIME G LOOP
"RTN","SDCLAV1",18,0)
 D:POP MSG  ;SD/473
"RTN","SDCLAV1",19,0)
 Q
"RTN","SDCLAV1",20,0)
 ;
"RTN","SDCLAV1",21,0)
MSG ;Added SD/473
"RTN","SDCLAV1",22,0)
 D WARN
"RTN","SDCLAV1",23,0)
 Q
"RTN","SDCLAV1",24,0)
 ;
"RTN","SDCLAV1",25,0)
SS Q:SDUP  S SDZ=SDZ1,SD5=1
"RTN","SDCLAV1",26,0)
 D A Q:SDUP  D 3 Q:SDUP  D WR Q:SDUP  D:$E(IOST,1,2)="C-" 3 Q
"RTN","SDCLAV1",27,0)
MON Q:'$D(^SC(+SDC,"ST",SDZ,1))  S SDPT=^SC(+SDC,"ST",SDZ,1) D SDPT1
"RTN","SDCLAV1",28,0)
 Q
"RTN","SDCLAV1",29,0)
SDPT1 I YCNT+6>IOSL D:$E(IOST,1,2)="C-" 3 Q:SDUP  D HDR,TIME
"RTN","SDCLAV1",30,0)
 W !,SDPT S SDAP=SDZ-1 F Z=1:1 S SDAP=$O(^SC(SDC,"S",SDAP)) Q:SDAP'>0!(SDAP>(SDZ+.9999))!SDUP  D NM^SDCLAV0
"RTN","SDCLAV1",31,0)
 D YCNT
"RTN","SDCLAV1",32,0)
 Q
"RTN","SDCLAV1",33,0)
TIME S Z5=$P(^SC(+SDC,"SL"),U,3),SDT=$S(Z5:Z5,1:8),Z5=$P(^("SL"),U,6),SDI=$S(Z5="":4,Z5<3:4,Z5:Z5,1:4)
"RTN","SDCLAV1",34,0)
 W !!," TIME",?SDI+SDI-1 F Z6=SDT:1:65\(SDI+SDI)+SDT W $E("|"_$S('Z6:0,1:(Z6-1#12+1))_"                 ",1,SDI+SDI)
"RTN","SDCLAV1",35,0)
 W !," DATE",?SDI+SDI-1,"|" K J F Z7=0:1:6 I $D(^SC(+SDC,"T"_Z7)) S J(Z7)=""
"RTN","SDCLAV1",36,0)
 S YCNT=YCNT+3
"RTN","SDCLAV1",37,0)
 F Z8=1:1:65\(SDI+SDI) W $J("|",SDI+SDI)
"RTN","SDCLAV1",38,0)
 Q
"RTN","SDCLAV1",39,0)
WR N X S (Y3,X1,SDC1,SD0)=0,C=SDZ2
"RTN","SDCLAV1",40,0)
 F S8=C:0 S SDC1=SDC1+1,C=$O(^UTILITY($J,"SDNMS",D,SDV,C)) Q:C'>0!(C>SDMED&('SD5))!SDUP  S SD0=1 D:SDC1=1 HDR1 S X=C D DW^%DTC S Y=C X ^DD("DD") S Y1=$P(Y,"@"),Y2=$P(Y,"@",2),X9=X W:Y1'=Y3 !!,?1,X9,?11,Y1 D WR1 Q:SDUP
"RTN","SDCLAV1",41,0)
 Q:SDUP  I 'SD0 D HDR1 W !!,"No appointments scheduled"
"RTN","SDCLAV1",42,0)
 D:SD0 WR2 S SDZ2=SDZ Q  ;SD/473
"RTN","SDCLAV1",43,0)
WR1 S X4="" F X1=0:0 S X4=$O(^UTILITY($J,"SDNMS",D,SDV,C,X4)) Q:X4=""!SDUP  S X6="" F X2=0:0 S X6=$O(^UTILITY($J,"SDNMS",D,SDV,C,X4,X6)) Q:X6=""  D W1
"RTN","SDCLAV1",44,0)
 Q
"RTN","SDCLAV1",45,0)
 ;
"RTN","SDCLAV1",46,0)
WR2 ;Added SD/473
"RTN","SDCLAV1",47,0)
 D 3 W @IOF D HDR1,DAT
"RTN","SDCLAV1",48,0)
 D A1^SDCLAV
"RTN","SDCLAV1",49,0)
 Q
"RTN","SDCLAV1",50,0)
 ;
"RTN","SDCLAV1",51,0)
HDR N X D NOW^%DTC S Y=$E(%,1,12) X ^DD("DD") S YCNT=1 W @IOF,!?52,Y D:$E(IOST,1,2)="P-" PG^SDCLAV
"RTN","SDCLAV1",52,0)
 I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2) W !?30,$P(^DG(40.8,D,0),"^")
"RTN","SDCLAV1",53,0)
 W !?30,SDV,!?30,SDM,"  ",($E(SDZ,1,3)+1700) S YCNT=4 Q
"RTN","SDCLAV1",54,0)
HDR1 S SDZ2=$S(SDZ2=0:SDBD,SDZ2>SDED:SDED,1:SDZ2) W !!,?30,SDV,!,?30,$P(SDM1,"^",+$E(SDZ2,4,5)),"  ",($E(SDZ2,1,3)+1700) S YCNT=YCNT+3 Q
"RTN","SDCLAV1",55,0)
SDM S SDM1="JANUARY^FEBRUARY^MARCH^APRIL^MAY^JUNE^JULY^AUGUST^SEPTEMBER^OCTOBER^NOVEMBER^DECEMBER",SDM=$P(SDM1,"^",+($E(SDZ,4,5))) Q
"RTN","SDCLAV1",56,0)
W S SDUT=^UTILITY($J,"SDNMS",D,SDV,C,X4,X6) S D1="" F D8=2,3 S D1=$S($P(SDUT,"^",D8)]"":$P(SDUT,"^",D8),1:"")_D1
"RTN","SDCLAV1",57,0)
 W D1 Q
"RTN","SDCLAV1",58,0)
W1 ;added next 2 lines and changed 3rd line SD/473
"RTN","SDCLAV1",59,0)
 S X=C X ^DD("FUNC",2,1)
"RTN","SDCLAV1",60,0)
 I +^UTILITY($J,"SDNMS",D,SDV,C,X4,X6)=0 S X="**WARNING** "_X D W2 Q
"RTN","SDCLAV1",61,0)
 D TAB W:T ?10 W:'T ?11 W X,?20,X4,?51,X6 D MIN W ?61,"("_M1_") MINUTES" D W S Y3=Y1,X1=X9 I YCNT+6>IOSL D 3 Q:SDUP  D HDR1,DAT
"RTN","SDCLAV1",62,0)
 Q
"RTN","SDCLAV1",63,0)
 ;
"RTN","SDCLAV1",64,0)
W2 ;added SD/473
"RTN","SDCLAV1",65,0)
 S POP=1
"RTN","SDCLAV1",66,0)
 D TAB W:T ?1 W:'T ?2 W X,?23,X4,?51,X6 D MIN W ?61,"("_M1_") MINUTES" D W S Y3=Y1,X1=X9 I YCNT+6>IOSL D 3 Q:SDUP  D HDR1,DAT
"RTN","SDCLAV1",67,0)
 Q
"RTN","SDCLAV1",68,0)
WARN ;added SD/473
"RTN","SDCLAV1",69,0)
 W @IOF,! D:$E(IOST,1,2)="P-" PG^SDCLAV
"RTN","SDCLAV1",70,0)
 D HDR1,DAT
"RTN","SDCLAV1",71,0)
 W !!,"*************************************************************************"
"RTN","SDCLAV1",72,0)
 W !,"* WARNING: There is a data inconsistency or data corruption problem      *"
"RTN","SDCLAV1",73,0)
 W !,"* with one or more of the above appointments.  These appointments will   *"
"RTN","SDCLAV1",74,0)
 W !,"* have WARNING displayed to the left of the time.  Corrective action     *"
"RTN","SDCLAV1",75,0)
 W !,"* needs to be taken.  Please cancel any of the appointments above, which *"
"RTN","SDCLAV1",76,0)
 W !,"* have the WARNING display.  If any of them are valid appointments, they *"
"RTN","SDCLAV1",77,0)
 W !,"* will have to be re-entered via Appointment Management.                 *"
"RTN","SDCLAV1",78,0)
 W !,"**************************************************************************"
"RTN","SDCLAV1",79,0)
 D 3
"RTN","SDCLAV1",80,0)
 S POP=0
"RTN","SDCLAV1",81,0)
 Q
"RTN","SDCLAV1",82,0)
 ;
"RTN","SDCLAV1",83,0)
3 N X I $E(IOST,1,2)="C-" F X=$Y:1:IOSL-6 W ! D YCNT
"RTN","SDCLAV1",84,0)
 I  R !!,"PRESS RETURN TO CONTINUE OR ^ TO QUIT  ",SDU:DTIME S:SDU="^"!('$T) SDUP=1
"RTN","SDCLAV1",85,0)
 I YCNT+6'<IOSL,'SDUP W @IOF,! S YCNT=1 D:$E(IOST,1,2)="P-" PG^SDCLAV Q
"RTN","SDCLAV1",86,0)
 Q
"RTN","SDCLAV1",87,0)
A N X D:YCNT+13>IOSL 3 Q:SDUP  D INAC^SDCLAV W !!!,"FOR CLINIC AVAILABILITY PATTERNS:"
"RTN","SDCLAV1",88,0)
 W !!?4,"0-9 and j-z",?15," --denote available slots where j=10,k=11...z=26",!?12,"A-W",?15," --denote overbooks with A being the first slot to be overbooked",!?18,"and B being the second for that same time, etc."
"RTN","SDCLAV1",89,0)
 W !?6,"*,$,!,@,#",?15," --denote overbooks or appts. that fall outside of a clinic's",!?18,"regular hours" S YCNT=YCNT+8 Q
"RTN","SDCLAV1",90,0)
TAB W ! S:$L(X)>7 T=1 S:$L(X)<8 T=0 D YCNT Q
"RTN","SDCLAV1",91,0)
MIN S M1=+^UTILITY($J,"SDNMS",D,SDV,C,X4,X6) Q
"RTN","SDCLAV1",92,0)
DAT I $E($O(^UTILITY($J,"SDNMS",D,SDV,C)),2,7)=$E(C,2,7) W !,?1,X1,?11,Y1 D YCNT
"RTN","SDCLAV1",93,0)
 Q
"RTN","SDCLAV1",94,0)
X1 S X1=X\100_$P("31^28^31^30^31^30^31^31^30^31^30^31",U,$E(X,4,5))
"RTN","SDCLAV1",95,0)
 S X1=$$LEAP(X1) I X1>SDED S X1=SDED
"RTN","SDCLAV1",96,0)
 S SDMED=X1+.9,SDAP=X-.01 F  S SDAP=$O(^SC(SDC,"S",SDAP)) Q:SDAP'>0!(SDAP>(X1+.9999))!SDUP  D NM^SDCLAV0
"RTN","SDCLAV1",97,0)
 D DOW S SDDD=Y
"RTN","SDCLAV1",98,0)
WW ;
"RTN","SDCLAV1",99,0)
 I '$D(^SC(+SC,"ST",X,1)),$$CHKDT() S Y=SDDD#7 G L:'$D(J(Y)),H:$D(^HOLIDAY(X))&('SDSOH) S SS=+$O(^SC(+SC,"T"_Y,X)) G L:SS'>0,L:^(SS,1)="" D
"RTN","SDCLAV1",100,0)
 .S ^SC(+SC,"ST",$P(X,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(X,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(X,".")
"RTN","SDCLAV1",101,0)
 ;SD*5.3*490 added GOTO command so dates prior to clinic start date no
"RTN","SDCLAV1",102,0)
 ;longer display on grid
"RTN","SDCLAV1",103,0)
 S SDAV=1 D:X>SM WM I $D(^SC(+SC,"ST",X,1)),^(1)["["!(^(1)["CANCELLED")!($D(^HOLIDAY(X))) G:X<$O(^SC(+SC,"T",0)) L W !,$E(^SC(+SC,"ST",X,1),1,80) D YCNT S:'$D(^HOLIDAY(X))&('SDAV) SDAV=1
"RTN","SDCLAV1",104,0)
 I YCNT+6>IOSL D 3 Q:SDUP  D HDR
"RTN","SDCLAV1",105,0)
L S X=X+1,SDDD=SDDD+1
"RTN","SDCLAV1",106,0)
 G WW:X'>X1 Q
"RTN","SDCLAV1",107,0)
 ;
"RTN","SDCLAV1",108,0)
 ;
"RTN","SDCLAV1",109,0)
 ;
"RTN","SDCLAV1",110,0)
WM W !?36 S Y=$E(X,1,5)_"00",SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00" D YCNT
"RTN","SDCLAV1",111,0)
DT W $$FMTE^XLFDT(Y) Q
"RTN","SDCLAV1",112,0)
 ;
"RTN","SDCLAV1",113,0)
DOW S Y=$$DOW^XLFDT(X,1) Q
"RTN","SDCLAV1",114,0)
YCNT S YCNT=YCNT+1 Q
"RTN","SDCLAV1",115,0)
 ;
"RTN","SDCLAV1",116,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDCLAV1",117,0)
DIFF S X1=SDRE,X2=X D ^%DTC S SDDD=SDDD+X,X=SDRE,X1=X\100_28 Q
"RTN","SDCLAV1",118,0)
H S ^SC(+SC,"ST",X,1)="   "_$E(X,6,7)_"    "_$P(^(X,0),U,2),^(0)=X G WW
"RTN","SDCLAV1",119,0)
 ;
"RTN","SDCLAV1",120,0)
LEAP(SDEOM) ;Check for leap year, adjust if indicated
"RTN","SDCLAV1",121,0)
 ;Input: SDEOM=end of month date to adjust for leap year
"RTN","SDCLAV1",122,0)
 Q:$E(SDEOM,4,5)'="02" SDEOM  ; only adjust February
"RTN","SDCLAV1",123,0)
 N SDLEAP
"RTN","SDCLAV1",124,0)
 S SDLEAP=$$FMADD^XLFDT(SDEOM,1)
"RTN","SDCLAV1",125,0)
 Q $S($E(SDLEAP,4,5)="02":SDLEAP,1:SDEOM)
"RTN","SDCLAV1",126,0)
CHKDT() ;
"RTN","SDCLAV1",127,0)
 N Y,RET,SDFA
"RTN","SDCLAV1",128,0)
 I '$D(SDFRST(D,+SC)) D
"RTN","SDCLAV1",129,0)
 .; Create array of days that have a current template.
"RTN","SDCLAV1",130,0)
 .N %H,X,SDFMTDAY,SDAYCNT,SDAYI,SDST,SDAYCHK,SDAYNAM,SDAYNUM
"RTN","SDCLAV1",131,0)
 .S %H=$H
"RTN","SDCLAV1",132,0)
 .D YX^%DTC S SDFMTDAY=X
"RTN","SDCLAV1",133,0)
 .S SDAYCNT=0
"RTN","SDCLAV1",134,0)
 .F SDAYI=0:1:6 D
"RTN","SDCLAV1",135,0)
 ..Q:'$D(^SC(+SC,"T"_SDAYI))
"RTN","SDCLAV1",136,0)
 ..I $O(^SC(+SC,"T"_SDAYI,""),-1)'<SDFMTDAY S SDFRST(D,+SC,SDAYI)="",SDAYCNT=SDAYCNT+1
"RTN","SDCLAV1",137,0)
 .; Calculate first available date for each day that has current template.
"RTN","SDCLAV1",138,0)
 .S SDST=0,SDAYCHK=0
"RTN","SDCLAV1",139,0)
 .F  S SDST=$O(^SC(+SC,"ST",SDST)) Q:SDST=""!(SDAYCHK=SDAYCNT)  D
"RTN","SDCLAV1",140,0)
 ..S SDAYNAM=$E($G(^SC(+SC,"ST",SDST,1)),1,2)
"RTN","SDCLAV1",141,0)
 ..S SDAYNUM=$S(SDAYNAM="MO":1,SDAYNAM="TU":2,SDAYNAM="WE":3,SDAYNAM="TH":4,SDAYNAM="FR":5,SDAYNAM="SA":6,SDAYNAM="SU":0,1:"")
"RTN","SDCLAV1",142,0)
 ..Q:SDAYNUM=""
"RTN","SDCLAV1",143,0)
 ..Q:$G(SDFRST(D,+SC,SDAYNUM))'=""
"RTN","SDCLAV1",144,0)
 ..Q:'$D(^SC(+SC,"T"_SDAYNUM))
"RTN","SDCLAV1",145,0)
 ..S SDFRST(D,+SC,SDAYNUM)=SDST,SDAYCHK=SDAYCHK+1
"RTN","SDCLAV1",146,0)
 ; Get first avail date from array for particular day of week
"RTN","SDCLAV1",147,0)
 S Y=SDDD#7,RET=0
"RTN","SDCLAV1",148,0)
 S SDFA=$G(SDFRST(D,+SC,Y))
"RTN","SDCLAV1",149,0)
 I SDFA'="" D
"RTN","SDCLAV1",150,0)
 .S SDFA=$S(+$H>SDFA:+$H,1:SDFA)
"RTN","SDCLAV1",151,0)
 .I X'<SDFA S RET=1
"RTN","SDCLAV1",152,0)
 Q RET
"RTN","SDCNP0")
0^4^B32984064^B29432577
"RTN","SDCNP0",1,0)
SDCNP0 ;ALB/LDB - CANCEL APPT. FOR A PATIENT ; 3/2/05 3:13pm
"RTN","SDCNP0",2,0)
 ;;5.3;Scheduling;**132,167,478,473**;Aug 13, 1993;Build 4
"RTN","SDCNP0",3,0)
EN2 D WAIT^DICD S NDT=HDT/1,L=0 F J=1:1 S NDT=$O(^DPT(DFN,"S",NDT)) Q:NDT'>0!(SDPV&(NDT'<SDTM))  S SD0=^(NDT,0) I $P(SD0,"^",2)'["C" S SC=+SD0,L=L\1+1,APL="" D FLEN^SDCNP1A S ^UTILITY($J,"SDCNP",L)=NDT_"^"_SC_"^"_COV_"^"_APL_"^^"_APL D CHKSO
"RTN","SDCNP0",4,0)
WH1 G:L'>0 NO S (SDCTRL,SDCTR)=0,APP="" W:'SDERR @IOF
"RTN","SDCNP0",5,0)
 W ! F Z=0:0 S Z=$O(^UTILITY($J,"SDCNP",Z)) Q:Z'>0  W !,$J($S(Z\1=Z:"("_$J(Z,2)_") ",1:""),5) S AT=$S($P(^(Z),"^",2)'?.N:1,1:0),Y=$P($P(^(Z),"^"),".") D DT^SDM0 S X=$P(^(Z),"^"),^(Z,"CNT")="" X ^DD("FUNC",2,1) W " ",$J(X,8) D MORE Q:SDCTRL
"RTN","SDCNP0",6,0)
 S:SDERR SDCTRL=1 I Z>0 G:SDCTRL&(APP']"") NOPE^SDCNP1 G:SDCTRL DEL
"RTN","SDCNP0",7,0)
 D WH G NOPE^SDCNP1:APP']"",DEL
"RTN","SDCNP0",8,0)
WH W !!,"SELECT APPOINTMENTS TO BE CANCELLED" W:Z>0 " OR HIT RETURN TO CONTINUE DISPLAY" R ": ",APP:DTIME I '$T!(APP="^") S SDCTRL=1,APP="" Q
"RTN","SDCNP0",9,0)
 S SDMSG="W !,""Enter appt. numbers separated by commas and/or a range separated"",!,""by dashes (ie 2,4,6-9)"" H 2" I APP["?" X SDMSG G WH
"RTN","SDCNP0",10,0)
 S SDCTRL=$S(APP']"":0,1:1) Q
"RTN","SDCNP0",11,0)
DEL S SDERR=0 F J=1:1 S SDDH=$P(APP,",",J) Q:SDDH']""  D MTCH^SDCNP1
"RTN","SDCNP0",12,0)
 G:SDERR WH1
"RTN","SDCNP0",13,0)
DEL1 F J=1:1 S SDDH=$P(APP,",",J) Q:SDDH']""  S SDDI=$P(SDDH,"-"),SDDM=$P(SDDH,"-",2) D CKK^SDCNP1A Q:SDERR  D CKK1^SDCNP1A Q:SDERR  Q:'SDDI  F A1=SDDI:1:$S(SDDM:SDDM,1:SDDI) D BEGD
"RTN","SDCNP0",14,0)
 G:SDERR WH1 G NOPE^SDCNP1
"RTN","SDCNP0",15,0)
BEGD S (SD,S)=$P(^UTILITY($J,"SDCNP",A1),"^",1),I=$P(^UTILITY($J,"SDCNP",A1),"^",2)
"RTN","SDCNP0",16,0)
 S SL=^SC(I,"SL"),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SB=STARTDAY-1/100,X=$P(SL,U,6),HSI=$S(X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4),STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2) K Y
"RTN","SDCNP0",17,0)
 I $$CODT^SDCOU(DFN,+^UTILITY($J,"SDCNP",A1),+$P(^(A1),U,2)) W !,*7,">>> Appointment #",A1," has a check out date and cannot be cancelled." Q
"RTN","SDCNP0",18,0)
 D PROT^SDCNP1A Q:SDPRT=1  D CAN S $P(^UTILITY($J,"SDCNP",A1),"^",4)="*** JUST CANCELLED ***" Q
"RTN","SDCNP0",19,0)
CAN Q:$P(^UTILITY($J,"SDCNP",A1),"^",4)["JUST CANCELLED"  S CNT=CNT+1,DIV=$S($P(^SC(I,0),"^",15)]"":" "_$P(^(0),"^",15),1:" 1") I $D(^DPT("ASDPSD","C",DIV,I,S,DFN)) K ^(DFN)
"RTN","SDCNP0",20,0)
 N SDATA,SDCPHDL S SDCPHDL=$$HANDLE^SDAMEVT(1) D BEFORE^SDAMEVT(.SDATA,DFN,S,I,"",SDCPHDL)
"RTN","SDCNP0",21,0)
 S:'$D(^DPT(DFN,"S",0)) ^(0)="^2.98P^^" I $D(SDREM) S DIE="^DPT("_DFN_",""S"",",(DA,Y)=S,DA(1)=DFN,DR="17///^S X="_"""""_SDREM_""""" D ^DIE K DIE,DR
"RTN","SDCNP0",22,0)
 S ^DPT("ASDCN",I,DA,DA(1))=$S(SDWH["P":1,1:"") K DA
"RTN","SDCNP0",23,0)
 S $P(^DPT(DFN,"S",S,0),"^",2)=SDWH S:$D(DUZ) $P(^(0),"^",12)=DUZ D NOW^%DTC S SDT=$J(%,2,4),$P(^(0),"^",14)=SDT,$P(^(0),"^",15)=SDSCR,(DA,Y)=0 F X=0:0 S X=+$O(^SC(I,"S",S,1,X)) Q:'$D(^(X,0))  D C Q:Y&(DA)
"RTN","SDCNP0",24,0)
 I $D(^DPT("ASDPSD","B",DIV,S\1,DFN)) D CK1
"RTN","SDCNP0",25,0)
 Q:'Y  S SL=$P(^SC(I,"S",S,1,Y,0),U,2) I DA,'$D(^("OB")) K ^SC(I,"S",S,1,DA,"OB")
"RTN","SDCNP0",26,0)
 S SDDA=DA,SDTTM=S,SDRT="D",SDPL=Y,SDSC=I D RT^SDUTL D CANCEL^SDCNSLT S Y=SDPL,S=SDTTM,I=SDSC,DA=SDDA K SDDA ;SD/478
"RTN","SDCNP0",27,0)
 S SDNODE=^SC(I,"S",S,1,Y,0),^SC("ARAD",I,S,DFN)="N",TLNK=$P($G(^SC(I,"S",S,1,Y,"CONS")),U) K ^SC(I,"S",S,1,Y) K:$O(^SC(I,"S",S,0))'>0 ^SC(I,"S",S,0) D CLRK^SDCNP1  ;SD/478
"RTN","SDCNP0",28,0)
 K:TLNK'="" ^SC("AWAS1",TLNK),TLNK ;SD/478
"RTN","SDCNP0",29,0)
 ;S SDNODE=^SC(I,"S",S,1,Y,0),^SC("ARAD",I,S,DFN)="N" S DA(2)=I,DA(1)=S,DA=Y,DIK="^SC("_DA(2)_",""S"","_DA(1)_",1," D ^DIK K:$O(^SC(I,"S",S,0))'>0 ^SC(I,"S",S,0) D CLRK^SDCNP1 ;SD/478
"RTN","SDCNP0",30,0)
 D EVT
"RTN","SDCNP0",31,0)
 Q:'$D(^SC(I,"ST",SD\1,1))
"RTN","SDCNP0",32,0)
EN01 S S=^SC(I,"ST",SD\1,1),Y=SD#1-SB*100,ST=Y#1*SI\.6+(Y\1*SI),SS=SL*HSI/60
"RTN","SDCNP0",33,0)
 I Y'<1 F I=ST+ST:SDDIF S Y=$E(STR,$F(STR,$E(S,I+1))) Q:Y=""  S S=$E(S,1,I)_Y_$E(S,I+2,999),SS=SS-1 Q:SS'>0
"RTN","SDCNP0",34,0)
 S ^(1)=S Q  ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDCNP0",35,0)
C I +^SC(I,"S",S,1,X,0)=DFN S Y=X Q
"RTN","SDCNP0",36,0)
 Q:'$D(^("OB"))!DA  S:^("OB")?1"O".E DA=X Q
"RTN","SDCNP0",37,0)
NO W !,"NO ",$S('SDPV:"PENDING",1:"PREVIOUS")," APPOINTMENTS",*7,*7,*7
"RTN","SDCNP0",38,0)
 D END^SDCNP G RD^SDCNP
"RTN","SDCNP0",39,0)
 Q
"RTN","SDCNP0",40,0)
CHKSO S COV=$S($P(^DPT(DFN,"S",NDT,0),"^",11)=1:" (COLLATERAL) ",1:"") F SDJ=3,4,5 I $P(^DPT(DFN,"S",NDT,0),"^",SDJ)]"" S L=L+.1,^UTILITY($J,"SDCNP",L)=$P(^(0),"^",SDJ)_"^"_$S(SDJ=3:"LAB",SDJ=4:"XRAY",1:"EKG")_"^0^0"
"RTN","SDCNP0",41,0)
 Q
"RTN","SDCNP0",42,0)
MORE S SDCTR=SDCTR+2 I AT W ?41,$P(^UTILITY($J,"SDCNP",Z),"^",2) G OVR
"RTN","SDCNP0",43,0)
 W " ",$S($P(^UTILITY($J,"SDCNP",Z),"^",4)?.N:"("_$P(^(Z),"^",4)_" MIN) ",1:$P(^(Z),"^",4))," ",$S($D(^SC($P(^(Z),"^",2),0)):$P(^(0),"^",1),1:"DELETED CLINIC"),$P(^UTILITY($J,"SDCNP",Z),"^",3) ;SD/478
"RTN","SDCNP0",44,0)
 N CSND,CSDT,CSSD,CONSULT,Y
"RTN","SDCNP0",45,0)
 S CSND=^UTILITY($J,"SDCNP",Z),CSDT=$P(CSND,U),CSSD=$P(CSND,U,2) S CONSULT=$$CONSULT(CSSD,CSDT) I +$G(CONSULT) S Y=$P(^GMR(123,CONSULT,0),U) D DD^%DT W !?5,"CONSULT ",Y,"/ ",CONSULT
"RTN","SDCNP0",46,0)
 D STATUS($X>55)
"RTN","SDCNP0",47,0)
OVR I SDCTR>20,$O(^UTILITY($J,"SDCNP",Z)) S (SDCTRL,SDCTR)=0 W *7 D WH W:'SDCTRL @IOF
"RTN","SDCNP0",48,0)
 ;Following code added SD/473
"RTN","SDCNP0",49,0)
 I (($P(CSND,U,4)="")!($P(CSND,U,6)="")) D
"RTN","SDCNP0",50,0)
 .W !,"**********************************************************************"
"RTN","SDCNP0",51,0)
 .W !,"* WARNING: There is a data inconsistency or data corruption problem  *"
"RTN","SDCNP0",52,0)
 .W !,"* with the above appointment.  Corrective action needs to be taken.  *"
"RTN","SDCNP0",53,0)
 .W !,"* Please cancel the appointment above.  If it is a valid appointment,*"
"RTN","SDCNP0",54,0)
 .W !,"* it will have to be re-entered via Appointment Management.          *"
"RTN","SDCNP0",55,0)
 .W !,"**********************************************************************",!
"RTN","SDCNP0",56,0)
 Q
"RTN","SDCNP0",57,0)
CONSULT(CSSD,CSDT) ;
"RTN","SDCNP0",58,0)
 N CSI S CONSULT=""
"RTN","SDCNP0",59,0)
 S CSI=0 F  S CSI=$O(^SC(CSSD,"S",CSDT,1,CSI)) Q:'+CSI  I $P($G(^SC(CSSD,"S",CSDT,1,CSI,0)),U)=DFN S CONSULT=$P($G(^SC(CSSD,"S",CSDT,1,CSI,"CONS")),U) Q  ;SD/478
"RTN","SDCNP0",60,0)
 Q CONSULT
"RTN","SDCNP0",61,0)
CK1 S SDX=0 F SD1=S\1:0 S SD1=$O(^DPT(DFN,"S",SD1)) Q:'SD1!((SD1\1)'=(S\1))  I $P(^(SD1,0),"^",2)'["C",$P(^(0),"^",2)'["N" S SDX=1 Q
"RTN","SDCNP0",62,0)
 Q:SDX  F SD1=2,4 I $D(^SC("AAS",SD1,S\1,DFN)) S SDX=1 Q
"RTN","SDCNP0",63,0)
 Q:SDX  IF $D(^SCE(+$$EXAE^SDOE(DFN,S\1,S\1),0)) S SDX=1
"RTN","SDCNP0",64,0)
 Q:SDX  K ^DPT("ASDPSD","B",DIV,S\1,DFN) Q
"RTN","SDCNP0",65,0)
 ;
"RTN","SDCNP0",66,0)
STATUS(LF) ;
"RTN","SDCNP0",67,0)
 W:LF !
"RTN","SDCNP0",68,0)
 W ?55,"(",$E($$LOWER^VALM1($P($$STATUS^SDAM1(DFN,+^UTILITY($J,"SDCNP",Z),+$P(^(Z),U,2),$G(^DPT(DFN,"S",+^(Z),0))),";",3)),1,23),")"
"RTN","SDCNP0",69,0)
 W:'LF !
"RTN","SDCNP0",70,0)
 Q
"RTN","SDCNP0",71,0)
 ;
"RTN","SDCNP0",72,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDCNP0",73,0)
 N I,STR,SS,SL,SD,SB,SI,HSI,J,APP,S,A1,STARTDAY,CNT,DIV,SDERR,SDDIF
"RTN","SDCNP0",74,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SDTTM,SDSC,SDPL,0,SDCPHDL)
"RTN","SDCNP0",75,0)
 Q
"RTN","SDCNP1A")
0^5^B30809654^B28182331
"RTN","SDCNP1A",1,0)
SDCNP1A ;ALB/LDB - CANCEL APPT. (continued) ; 5/26/05 10:59am
"RTN","SDCNP1A",2,0)
 ;;5.3;Scheduling;**167,340,398,478,473**;Aug 13, 1993;Build 4
"RTN","SDCNP1A",3,0)
LOOP S SDCNT1=0 F SDAP=0:0 S SDAP=$O(^UTILITY($J,"SDCNP2","REBK",DFN,SDAP)) Q:SDAP'>0  S SDP1=^(SDAP),S1=$P(SDP1,"^",2),S9=$P(^SC(S1,0),"^") D SDDT Q:X8="^"  D RBK S MAX=1
"RTN","SDCNP1A",4,0)
 Q
"RTN","SDCNP1A",5,0)
SDDT W !!,"IN ",S9 D:'$D(DT) DT^SDUTL D DT S %DT="AEX",%DT("A")="START REBOOKING FROM WHAT DATE: "_D S %DT(0)=DT D ^%DT K %DT S X8=X Q:$D(DTOUT)!(X="^")  S:X8="" Y=DT G:Y<0 SDDT S SDDT=+Y\1 K X,Y,DIC S X1=SDDT,X2=DT D ^%DTC
"RTN","SDCNP1A",6,0)
 S (M8,MAX)=0,S1=$P(SDP1,"^",2),S2=$P(SDP1,"^"),M1=$S($D(^SC(S1,"SDP")):$P(^("SDP"),"^",4),1:0) D MAX G:M8 SDDT
"RTN","SDCNP1A",7,0)
 I S2>DT S X1=SDDT,X2=1 D C^%DTC S SDDT=X
"RTN","SDCNP1A",8,0)
 Q
"RTN","SDCNP1A",9,0)
MAX I X>M1 S M8=1 W !!,"Exceeds maximum number of days for rebooking in ",S9 S MAX=0
"RTN","SDCNP1A",10,0)
 Q
"RTN","SDCNP1A",11,0)
RBK S GDATE=S2,SC=S1,LEN=$P(SDP1,"^",6),A=DFN_"^"_LEN,(CDATE,DATE)=SDDT D OVR1,SDIN D ^SDAUT1 D:'MAX NRBK D:MAX ^SDAUT2,SDNP K SDIN Q
"RTN","SDCNP1A",12,0)
OVR1 N X S SL=$S($D(^SC(SC,"SL")):^("SL"),1:"") Q:'SL  S X=$P(SL,U,6),SI=$S(X="":4,X<3:4,X:X,1:4),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SDSTRTDT=$S(DT>DATE:DT,1:DATE),STIME=$S($D(^SC(SC,"SDP")):$P(^("SDP"),U,3),1:"0800"),SDSTRTDT=SDSTRTDT+2
"RTN","SDCNP1A",13,0)
 Q
"RTN","SDCNP1A",14,0)
SDIN I $D(^SC(SC,"I")) S SDIN=+^("I") Q
"RTN","SDCNP1A",15,0)
 Q
"RTN","SDCNP1A",16,0)
SDNP S SDCL(SDAP)=SC_"^"_GDATE_"^"_NDATE S:NDATE SDCNT1=SDCNT1+1 Q
"RTN","SDCNP1A",17,0)
NRBK W !,"NO REBOOKING ALLOWED FOR ",$P(^SC(SC,0),"^") Q
"RTN","SDCNP1A",18,0)
DT S X1=$P(DT,"."),X2=10 D C^%DTC S Y=X D D^DIQ S D=Y_"//" Q
"RTN","SDCNP1A",19,0)
PROT S SDPRT=0 I $D(^SC(+I,"SDPROT")),$P(^("SDPROT"),U)="Y",'$D(^SC(+I,"SDPRIV",DUZ)) W !,*7,"Appt. in ",$P(^SC(+I,0),"^")," NOT CANCELLED ",!,"Access to this clinic is restricted to only privileged users!",*7 S SDPRT=1 Q
"RTN","SDCNP1A",20,0)
 Q
"RTN","SDCNP1A",21,0)
 ;SD/473 added new IF statement, changed For loop & added 2 new linetags
"RTN","SDCNP1A",22,0)
FLEN S (ZPL,SDSP)=""  ;SD/473
"RTN","SDCNP1A",23,0)
 S COV=$S($P(^DPT(DFN,"S",NDT,0),"^",11)=1:" (COLLATERAL) ",1:"") I $D(^SC(SC,"S",NDT)) S ZL=0 F  S ZL=$O(^SC(SC,"S",NDT,1,ZL)) Q:'ZL  D
"RTN","SDCNP1A",24,0)
 .I '$D(^SC(SC,"S",NDT,1,ZL,0)) D FLEN1 Q
"RTN","SDCNP1A",25,0)
 .I +^SC(SC,"S",NDT,1,ZL,0)=DFN S APL=$P(^(0),U,2),SDSP=$P($G(^SC(SC,"S",NDT,1,ZL,"CONS")),U)
"RTN","SDCNP1A",26,0)
 .Q
"RTN","SDCNP1A",27,0)
 ;S COV=$S($P(^DPT(DFN,"S",NDT,0),"^",11)=1:" (COLLATERAL) ",1:"") I $D(^SC(SC,"S",NDT)) F ZL=0:0 S ZL=$O(^SC(SC,"S",NDT,1,ZL)) Q:ZL'>0  I +^(ZL,0)=DFN S APL=$P(^(0),"^",2),SDSP=$P($G(^SC(SC,"S",NDT,1,ZL,"CONS")),U) Q  ;SD/478
"RTN","SDCNP1A",28,0)
 Q
"RTN","SDCNP1A",29,0)
 ;
"RTN","SDCNP1A",30,0)
 ;FLNSET ;SD/473 added as FLEN exceeded 245 characters
"RTN","SDCNP1A",31,0)
 ;Q:'ZL
"RTN","SDCNP1A",32,0)
 ;Q:'$D(^SC(SC,"S",NDT,1,ZL,0))
"RTN","SDCNP1A",33,0)
 ;I +^SC(SC,"S",NDT,1,ZL,0)=DFN S APL=$P(^(0),"^",2),SDSP=$P($G(^SC(SC,"S",NDT,1,ZL,"CONS")),U) Q  ;SD/478
"RTN","SDCNP1A",34,0)
 ;Q
"RTN","SDCNP1A",35,0)
 ;SD/473 added new linetag to kill any lingering "C" nodes
"RTN","SDCNP1A",36,0)
FLEN1 Q:'$D(^SC(SC,"S",NDT,1,ZL,"C"))
"RTN","SDCNP1A",37,0)
 S DA(2)=SC,DA(1)=NDT,DA=ZL,DIK="^SC("_DA(2)_",""S"","_DA(1)_",1," D ^DIK
"RTN","SDCNP1A",38,0)
 Q
"RTN","SDCNP1A",39,0)
 ;
"RTN","SDCNP1A",40,0)
LOOP1 S SDCNT1=0 F L=0:0 S L=$O(^UTILITY($J,"SDCNP",L)) Q:L'>0  I ^(L)["JUST CANCELLED" S $P(SDCL(L),"^")=$P(^(L),"^",2),$P(SDCL(L),"^",2)=$P(^(L),"^")
"RTN","SDCNP1A",41,0)
 K ^UTILITY($J) Q
"RTN","SDCNP1A",42,0)
SDLET N NDT,GDT
"RTN","SDCNP1A",43,0)
 U IO D Q
"RTN","SDCNP1A",44,0)
 F SDP=0:0 S SDP=$O(SDCL(SDP)) Q:SDP'>0  D
"RTN","SDCNP1A",45,0)
 . S SDP1=SDCL(SDP),SDC=+SDP1,GDT=$P(SDP1,"^",2),NDT=$P(SDP1,"^",3),SDV1=$P(^SC(SDC,0),"^",15)
"RTN","SDCNP1A",46,0)
 . D B I (SDB)!(SDK) Q
"RTN","SDCNP1A",47,0)
 . S:'SDV1 SDV1=+$O(^DG(40.8,0))
"RTN","SDCNP1A",48,0)
 . D F S:SDLET ^UTILITY($J,SDLET,+A,GDT)=SDC_"^"_NDT
"RTN","SDCNP1A",49,0)
 F SDLET=0:0 S SDLET=$O(^UTILITY($J,SDLET)) Q:SDLET'>0  F B0=0:0 S A1=B0,B0=$O(^UTILITY($J,SDLET,B0)) D:'B0 R Q:'B0  D:A1&(A1'=B0) R S A=B0 D ^SDLT,APP
"RTN","SDCNP1A",50,0)
 I $D(^UTILITY($J,"NO")) W @IOF,! F SC=0:0 S SC=$O(^UTILITY($J,"NO",SC)) Q:SC'>0  W !,$P(^SC(SC,0),"^")," Clinic is not assigned a letter",!!
"RTN","SDCNP1A",51,0)
E I $D(^TMP($J,"BADADD")) D BADADD^SDLT K ^TMP($J,"BADADD") I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K ^DIR(0)
"RTN","SDCNP1A",52,0)
 ;I $G(SDB),SDB W !!,"BAD ADDRESS INDICATOR FOR THIS PATIENT. NO LETTER WILL BE PRINTED." S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1A",53,0)
 I $G(SDK),'SDK W !!,"NO LETTER CAN BE PRINTED FOR THIS PATIENT." S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1A",54,0)
 K A,SDCL D CLOSE^DGUTQ
"RTN","SDCNP1A",55,0)
Q K A1,SDFORM,SDLET,SDNDT,SDP1,SDV1,^UTILITY($J),SDB,SDK Q
"RTN","SDCNP1A",56,0)
F S SDFORM="" I $D(^DG(40.8,SDV1,"LTR")),^("LTR") S SDFORM=^("LTR")
"RTN","SDCNP1A",57,0)
 S SDLET="" I $D(^SC(SDC,"LTR")) S:SDWH["P" SDLET=$P(^("LTR"),"^",4) S:SDWH'["P" SDLET=$P(^("LTR"),"^",3)
"RTN","SDCNP1A",58,0)
 I 'SDLET S ^UTILITY($J,"NO",SDC)=""
"RTN","SDCNP1A",59,0)
 Q
"RTN","SDCNP1A",60,0)
R I $D(^UTILITY($J,"R",SDLET,A1)) W !!,"The appointment(s) have been rescheduled as follows:",! F A2=0:0 S A2=$O(^UTILITY($J,"R",SDLET,A1,A2)) Q:A2'>0  S (X,SDX)=A2,SDC=+^(A2),A=A1,SDS=^DPT(DFN,"S",SDX,0) D WRAPP^SDLT K X,SDX
"RTN","SDCNP1A",61,0)
 D REST^SDLT Q
"RTN","SDCNP1A",62,0)
APP F SDX=0:0 S SDX=$O(^UTILITY($J,SDLET,A,SDX)) Q:SDX'>0  S S=^DPT(+A,"S",SDX,0),SDC=+^(0) D WRAPP^SDLT I $P(^UTILITY($J,SDLET,A,SDX),"^",2) S ^UTILITY($J,"R",SDLET,A,$P(^UTILITY($J,SDLET,A,SDX),"^",2))=$P(^(SDX),"^")
"RTN","SDCNP1A",63,0)
 Q
"RTN","SDCNP1A",64,0)
CKK I $L(SDDI)>4!($L(SDDM)>4) S SDERR=1 W !,"There is no appointment number ",$S($L(SDDI)>5:SDDI,1:SDDM) Q
"RTN","SDCNP1A",65,0)
 Q
"RTN","SDCNP1A",66,0)
CKK1 F Z0=SDDI,SDDM Q:'SDDI!('SDDM&(SDDI-Z0))  S SDERR=0 S:$L(Z0)>5 SDERR=1 Q:SDERR  S:$L(SDDI)<5 SDDI=+SDDI S:$L(SDDM)<5 SDDM=+SDDM I $L(Z0)>5!('$D(^UTILITY($J,"SDCNP",Z0,"CNT"))) S SDERR=1 Q
"RTN","SDCNP1A",67,0)
 W:SDERR !,*7,"There is no appointment number ",Z0 H 2 Q
"RTN","SDCNP1A",68,0)
CKK2 F Z0=SDDI,SDDM Q:'SDDI!('SDDM&(SDDI-Z0))  S SDERR=0 S:$L(Z0)>5 SDERR=1 Q:SDERR  S:$L(SDDI)<5 SDDI=+SDDI S:$L(SDDM)<5 SDDM=+SDDM I $L(Z0)>5!('$D(^UTILITY($J,"SDCNP2",DFN,Z0))) S SDERR=1 Q
"RTN","SDCNP1A",69,0)
 W:SDERR !,*7,"There is no appointment number ",Z0 Q
"RTN","SDCNP1A",70,0)
B S SDB=$$BADADR^DGUTL3(+A)
"RTN","SDCNP1A",71,0)
 S:SDB ^TMP($J,"BADADD",$P(^DPT(+A,0),"^"),+A)=""
"RTN","SDCNP1A",72,0)
CHECK S SDK=0 I $S('$D(^DPT(+A,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(+A,"S",GDT,0)),$S($P(^(0),"^",2)["N":1,$D(SDCP)&$P(^(0),"^",2)["C":1,1:0),$P(^(0),"^",14)=SDTIME!(SDTIME="*"),'$D(^DPT(+A,.1)) S SDK=1
"RTN","SDCNP1A",73,0)
 Q
"RTN","SDNOS0")
0^6^B27834725^B27720027
"RTN","SDNOS0",1,0)
SDNOS0 ;ALB/LDB - NO SHOW REPORT ; 07 May 99 10:21 AM
"RTN","SDNOS0",2,0)
 ;;5.3;Scheduling;**20,194,410,473**;Aug 13, 1993;Build 4
"RTN","SDNOS0",3,0)
 D END1^SDNOS
"RTN","SDNOS0",4,0)
 S (SDV1,SDIN,SDNM,SDNM1)=0,SDDIVO=SDDIV
"RTN","SDNOS0",5,0)
 I $D(^DG(43,1,"GL")),$P(^("GL"),U,2) S SDV1=1
"RTN","SDNOS0",6,0)
 I SDDIV'="A" S (^UTILITY($J,"SDNO",SDDIV,"***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***N***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***NA***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***SDNMS***"))=0
"RTN","SDNOS0",7,0)
 I SDDIV="A" D DIVRPT
"RTN","SDNOS0",8,0)
 I SDCL(1)="ALL" S SDCL=0 D SDCL
"RTN","SDNOS0",9,0)
 I SDCL(1)'="ALL" F SDSUB=0:0 S SDSUB=$O(SDCL(SDSUB)) Q:SDSUB=""  S SDCL=SDCL(SDSUB),SDLAB=$S(SDCL?.N1"*".E:"RANGE",1:"SDTST") D @SDLAB
"RTN","SDNOS0",10,0)
 S (P1,SDTOT,SDTOT1)=0,DGTCH="NO-SHOW REPORT^CLINIC^PAGE#",(SDEND,SDHD)=0
"RTN","SDNOS0",11,0)
 D ^SDNOS1
"RTN","SDNOS0",12,0)
 Q
"RTN","SDNOS0",13,0)
 ;
"RTN","SDNOS0",14,0)
DIVRPT F SDDIV=0:0 S SDDIV=$O(^DG(40.8,SDDIV)) Q:'SDDIV  S (^UTILITY($J,"SDNO",SDDIV,"***N***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***NA***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***SDNMS***"))=0
"RTN","SDNOS0",15,0)
 Q
"RTN","SDNOS0",16,0)
 ;
"RTN","SDNOS0",17,0)
SDCL F SDZ=1:1 S SDCL=$O(^SC(SDCL)) Q:'SDCL  D SDTST
"RTN","SDNOS0",18,0)
 Q
"RTN","SDNOS0",19,0)
 ;
"RTN","SDNOS0",20,0)
SDTST S SDNM=0,SDCL1=^SC(SDCL,0) I $P(SDCL1,U,3)'="C" Q
"RTN","SDNOS0",21,0)
 I SDDIVO,SDCL(1),'$D(SDR1) D DATES Q
"RTN","SDNOS0",22,0)
 I $S((SDDIVO&'SDCL(1)&(SDDIVO=$P(SDCL1,U,15))):1,'SDDIVO:1,$D(SDR1)&SDDIVO&($P(SDCL1,U,15)=SDDIVO):1,'$P(SDCL1,U,15)&(SDDIVO=$P(^DG(43,1,"GL"),U,3)):1,'SDV1:1,1:0) S SDIN=0 D:$D(^SC(SDCL,"I")) INAC^SDNOS1A Q:SDIN  D DATES
"RTN","SDNOS0",23,0)
 Q
"RTN","SDNOS0",24,0)
 ;
"RTN","SDNOS0",25,0)
DATES S:'SDDIVO SDDIV=$S($P(SDCL1,U,15)&SDV1:$P(SDCL1,U,15),$D(^DG(43,"GL")):$P(^("GL"),U,3),1:$O(^DG(40.8,0)))
"RTN","SDNOS0",26,0)
 Q:$D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***"))  S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")=0,^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***SDNMS***")=0
"RTN","SDNOS0",27,0)
 S (SDEN,SDBEG)=0,SDBEG1=SDBD F SDZ1=1:1 S SDBEG1=$O(^SC(SDCL,"S",SDBEG1)) Q:SDBEG1'>0  D SDED Q:SDBEG!SDEN  D CHK
"RTN","SDNOS0",28,0)
 S ^UTILITY($J,"SDNO",SDDIV,"***SDNMS***")=SDNM+^UTILITY($J,"SDNO",SDDIV,"***SDNMS***")
"RTN","SDNOS0",29,0)
 Q
"RTN","SDNOS0",30,0)
 ;
"RTN","SDNOS0",31,0)
SDED S SDBEG=0,SDEN=0 I $D(SDED),(SDBEG1>(SDED+.99999)) S SDEN=1 Q
"RTN","SDNOS0",32,0)
 I '$D(SDED),(SDBEG1>(SDBD+.99999)) S SDBEG=1 Q
"RTN","SDNOS0",33,0)
 Q
"RTN","SDNOS0",34,0)
 ;Added 2nd Quit below SD/473
"RTN","SDNOS0",35,0)
CHK S SDAPP=0 F  S SDAPP=$O(^SC(SDCL,"S",SDBEG1,1,SDAPP)) Q:'SDAPP  Q:'$D(^(SDAPP,0))  I $D(^SC(SDCL,"S",SDBEG1,1,SDAPP))=10,$P(^(SDAPP,0),U,9)'="C" S SDPAT=$P(^SC(SDCL,"S",SDBEG1,1,SDAPP,0),U,1) I $D(^DPT(SDPAT,"S",SDBEG1)) D CHK1
"RTN","SDNOS0",36,0)
 Q
"RTN","SDNOS0",37,0)
 ;
"RTN","SDNOS0",38,0)
CHK1 S SD="SD" F SDCHK=1,2,10,12,14 S @(SD_SDCHK)=$P(^DPT(SDPAT,"S",SDBEG1,0),U,SDCHK)
"RTN","SDNOS0",39,0)
 S:'SDDIVO&$P(SDCL1,U,15) SDDIV=$P(SDCL1,U,15) S:'SDDIVO&'$P(SDCL1,U,15) SDDIV=$O(^DG(40.8,0))
"RTN","SDNOS0",40,0)
 S:'$D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")) ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")=0
"RTN","SDNOS0",41,0)
 I SDFMT=1 D
"RTN","SDNOS0",42,0)
 .I (SD2="N")!(SD2="NA"),$$NOSHOW(SDPAT,SDBEG1,SDCL,$G(^DPT(SDPAT,"S",SDBEG1,0)),SDAPP) D 
"RTN","SDNOS0",43,0)
 ..D SET,TOTAL Q
"RTN","SDNOS0",44,0)
 I SDFMT=2 D
"RTN","SDNOS0",45,0)
 .I (SD2=""&('$D(^SC(SDCL,"S",SDBEG1,1,SDAPP,"C"))))!(SD2="N")!(SD2="NA")!(SD2="NT"),$$NOSHOW(SDPAT,SDBEG1,SDCL,$G(DPT(SDPAT,"S",SDBEG1,0)),SDAPP) D
"RTN","SDNOS0",46,0)
 ..D SET,TOTAL Q
"RTN","SDNOS0",47,0)
 I SD2'["C" S SDNM=SDNM+1,^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***SDNMS***")=SDNM
"RTN","SDNOS0",48,0)
 Q
"RTN","SDNOS0",49,0)
 ;
"RTN","SDNOS0",50,0)
SET S:$P(SDCL1,U,15)&SDDIVO&SDV1 SDDIV=$P(SDCL1,U,15) S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),SDBEG1,$P(^DPT(SDPAT,0),U),+$P(^(0),U,9))=SD2_U_SD10_U_SD12
"RTN","SDNOS0",51,0)
 Q
"RTN","SDNOS0",52,0)
 ;
"RTN","SDNOS0",53,0)
TOTAL S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***"_SD2_"***","***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***"_SD2_"***","***TOT***")):^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***"_SD2_"***","***TOT***")+1,1:1)
"RTN","SDNOS0",54,0)
 S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),$P(SDBEG1,"."),"***"_SD2_"***","***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),$P(SDBEG1,"."),"***"_SD2_"***","***TOT***")):^("***TOT***")+1,1:1)
"RTN","SDNOS0",55,0)
 S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")):^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")+1,1:1)
"RTN","SDNOS0",56,0)
 S ^("***TOT***")=^UTILITY($J,"SDNO",SDDIV,"***TOT***")+1,^("***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,"***"_SD2_"***","***TOT***")):^UTILITY($J,"SDNO",SDDIV,"***"_SD2_"***","***TOT***")+1,1:1)
"RTN","SDNOS0",57,0)
 Q
"RTN","SDNOS0",58,0)
 ;
"RTN","SDNOS0",59,0)
RANGE S SDREST=$E(SDCL,$F(SDCL,"*"),$L(SDCL)),SDCL=$E(SDCL,1,($F(SDCL,"*")-2)),SDCL1=^SC(SDCL,0)
"RTN","SDNOS0",60,0)
 S:'SDDIVO SDDIV=$S($P(SDCL1,U,15):$P(SDCL1,U,15),'$P(SDCL1,U,15)&$D(^DG(43,"GL")):$P(^DG(43,"GL"),U,3),1:$O(^DG(40.8,0)))
"RTN","SDNOS0",61,0)
 S SDR1=1,SDR=$P(SDCL1,U) D SDTST K SDR1
"RTN","SDNOS0",62,0)
 S SDREST="1"_""""_SDREST_""""_".E" F SDCXX=1:1 S SDR=$O(^SC("B",SDR)) Q:'(SDR?@SDREST)!(SDR="")  S SDCL=$O(^SC("B",SDR,-1)) S SDR1=1 D RANGE1 K SDR1
"RTN","SDNOS0",63,0)
 Q
"RTN","SDNOS0",64,0)
 ;
"RTN","SDNOS0",65,0)
RANGE1 S:'SDDIVO SDDIV=$S($P(SDCL1,U,15):$P(SDCL1,U,15),'$P(SDCL1,U,15)&$D(^DG(43,"GL")):$P(^DG(43,"GL"),U,3),1:$O(^DG(40.8,0))) D SDTST
"RTN","SDNOS0",66,0)
 Q
"RTN","SDNOS0",67,0)
 ;
"RTN","SDNOS0",68,0)
NOSHOW(DFN,SDT,CIFN,PAT,DA) ;Input:  DFN=Patient IFN, SDT=Appointment D/T
"RTN","SDNOS0",69,0)
 ;  CIFN=Clinic IFN, PAT=Zero node of pat. appt., DA=Clinic appt. IFN
"RTN","SDNOS0",70,0)
 ;                        Output:  1 or 0 for noshow yes/no
"RTN","SDNOS0",71,0)
 N NSQUERY,NS S NS=1,NSQUERY=$$STATUS^SDAM1(DFN,SDT,CIFN,PAT,DA)
"RTN","SDNOS0",72,0)
 I $P(NSQUERY,";",3)["ACTION REQ" S NS=0
"RTN","SDNOS0",73,0)
NOSHOWQ Q NS
"RTN","SDPPAPP1")
0^7^B15912910^B10770758
"RTN","SDPPAPP1",1,0)
SDPPAPP1 ;ALB/CAW - Display Appointments; 5/4/92
"RTN","SDPPAPP1",2,0)
 ;;5.3;Scheduling;**6,22,140,80,473**;Aug 13, 1993;Build 4
"RTN","SDPPAPP1",3,0)
 ;
"RTN","SDPPAPP1",4,0)
 ;
"RTN","SDPPAPP1",5,0)
EN1 ; Loop through appt. date/time
"RTN","SDPPAPP1",6,0)
 N SDAP,SDCI,SDOB,SDPDATA,SDPOV,SDPV,SDWHEN,SDSTART,SDSTOP
"RTN","SDPPAPP1",7,0)
 S SDFST=13,SDSEC=55,SDLEN=25,$P(SDASH,"-",IOM+1)="",SDSTART=$S($D(SDBEG):SDBEG,'SDBD:SDBD,1:SDBD-.1),SDSTOP=$S($D(SDEND):SDEND,1:SDED)
"RTN","SDPPAPP1",8,0)
 F SDDT=SDSTART:0 S SDDT=$O(^DPT(DFN,"S",SDDT)) Q:'SDDT!(SDDT>(SDSTOP+.9))  D
"RTN","SDPPAPP1",9,0)
 .S SDPDATA=^(SDDT,0)
"RTN","SDPPAPP1",10,0)
 .I $D(SDY),SDY'=+SDPDATA Q
"RTN","SDPPAPP1",11,0)
 .S ^TMP("SDAPT",$J,-SDDT,0)=SDPDATA
"RTN","SDPPAPP1",12,0)
 .I $D(^DPT(DFN,"S",SDDT,"R")) S ^TMP("SDAPT",$J,-SDDT,"R")=^DPT(DFN,"S",SDDT,"R")
"RTN","SDPPAPP1",13,0)
 .F SDAP=0:0 S SDAP=$O(^SC(+SDPDATA,"S",SDDT,1,SDAP)) Q:'SDAP  I '$D(^(SDAP,0)) D CHK Q  S SDCDATA=^(SDAP,0),SDCI=$G(^("C")),SDOB=$G(^("OB")) I +SDCDATA=DFN S ^TMP("SDAPT",$J,-SDDT,1)=SDCDATA,^("C")=SDCI  ;SD/473 added CHK
"RTN","SDPPAPP1",14,0)
 .I '$D(SDCDATA) S (SDCDATA,SDCI,SDOB)=0 S ^TMP("SDAPT",$J,-SDDT,1)=SDCDATA,^("C")=SDCI
"RTN","SDPPAPP1",15,0)
 .K SDCDATA
"RTN","SDPPAPP1",16,0)
 F I=-9999999.99:0 S I=$O(^TMP("SDAPT",$J,I)) Q:'I  S SDWHEN=$E(I,2,999),SDPDATA=^(I,0),SDCDATA=$G(^(1)),SDCI=$G(^("C")),SDREMARK=$G(^("R")) D INFO
"RTN","SDPPAPP1",17,0)
 K ^TMP("SDAPT",$J)
"RTN","SDPPAPP1",18,0)
 Q
"RTN","SDPPAPP1",19,0)
 ;
"RTN","SDPPAPP1",20,0)
CHK ;SD/473
"RTN","SDPPAPP1",21,0)
 S SDCDATA=DFN_U_0
"RTN","SDPPAPP1",22,0)
 S ^TMP("SDAPT",$J,-SDDT,1)=SDCDATA
"RTN","SDPPAPP1",23,0)
 Q
"RTN","SDPPAPP1",24,0)
 ;
"RTN","SDPPAPP1",25,0)
INFO ; Set information
"RTN","SDPPAPP1",26,0)
 ;
"RTN","SDPPAPP1",27,0)
DATE ; Date/Time and Type
"RTN","SDPPAPP1",28,0)
 S X="",X=$$SETSTR^VALM1("Date/Time:",X,2,10)
"RTN","SDPPAPP1",29,0)
 S X=$$SETSTR^VALM1($TR($$FMTE^XLFDT(SDWHEN,"5F")," ","0"),X,SDFST,SDLEN)
"RTN","SDPPAPP1",30,0)
 S X=$$SETSTR^VALM1("Type:",X,49,5)
"RTN","SDPPAPP1",31,0)
 S X=$$SETSTR^VALM1($P($G(^SD(409.1,+$P(SDPDATA,U,16),0)),U),X,SDSEC,SDLEN)
"RTN","SDPPAPP1",32,0)
 D SET(X)
"RTN","SDPPAPP1",33,0)
CLINIC ; Clinic and Eligibility of Visit
"RTN","SDPPAPP1",34,0)
 S X="",X=$$SETSTR^VALM1("Clinic:",X,5,7)
"RTN","SDPPAPP1",35,0)
 S X=$$SETSTR^VALM1($P($G(^SC(+SDPDATA,0)),U),X,SDFST,SDLEN)
"RTN","SDPPAPP1",36,0)
 I $P(SDCDATA,U,10)'="" D
"RTN","SDPPAPP1",37,0)
 .S X=$$SETSTR^VALM1("Elig. of Vst.:",X,40,14)
"RTN","SDPPAPP1",38,0)
 .S X=$$SETSTR^VALM1($P($G(^DIC(8,+$P(SDCDATA,U,10),0)),U),X,SDSEC,SDLEN)
"RTN","SDPPAPP1",39,0)
 D SET(X)
"RTN","SDPPAPP1",40,0)
STAT ; Status and Clerk
"RTN","SDPPAPP1",41,0)
 S X="",X=$$SETSTR^VALM1("Status:",X,5,7)
"RTN","SDPPAPP1",42,0)
 S X=$$SETSTR^VALM1($P($$STATUS^SDAM1(DFN,SDWHEN,+SDPDATA,SDPDATA),";",3),X,SDFST,SDLEN)
"RTN","SDPPAPP1",43,0)
 S X=$$SETSTR^VALM1("Clerk:",X,48,6)
"RTN","SDPPAPP1",44,0)
 S X=$$SETSTR^VALM1($P($G(^VA(200,$S($P(SDCDATA,U,6):$P(SDCDATA,U,6),1:+$P(SDPDATA,U,18)),0)),U),X,SDSEC,SDLEN)
"RTN","SDPPAPP1",45,0)
 D SET(X)
"RTN","SDPPAPP1",46,0)
PURP ; Purpose of Visit and Date Appt. Made
"RTN","SDPPAPP1",47,0)
 S X="",X=$$SETSTR^VALM1("POV:",X,8,4)
"RTN","SDPPAPP1",48,0)
 S SDPOV=$P(SDPDATA,U,7),SDPV=$S(SDPOV=1:"C&P",SDPOV=2:"10-10",SDPOV=3:"SCHEDULED",SDPOV=4:"UNSCHEDULED",1:"UNKNOWN")
"RTN","SDPPAPP1",49,0)
 S X=$$SETSTR^VALM1(SDPV,X,SDFST,SDLEN)
"RTN","SDPPAPP1",50,0)
 S X=$$SETSTR^VALM1("Date Made:",X,44,10)
"RTN","SDPPAPP1",51,0)
 S X=$$SETSTR^VALM1($TR($$FMTE^XLFDT($S($P(SDCDATA,U,7):$P(SDCDATA,U,7),1:$P(SDPDATA,U,19)),"5DF")," ","0"),X,SDSEC,SDLEN)
"RTN","SDPPAPP1",52,0)
 D SET(X)
"RTN","SDPPAPP1",53,0)
CI ; Checked-In and Checked-Out Times
"RTN","SDPPAPP1",54,0)
 S X=""
"RTN","SDPPAPP1",55,0)
 I +SDCI D
"RTN","SDPPAPP1",56,0)
 .S X=$$SETSTR^VALM1("Checked-In:",X,1,11)
"RTN","SDPPAPP1",57,0)
 .S X=$$SETSTR^VALM1($$FMTE^XLFDT($P(SDCI,U),"5"),X,SDFST,SDLEN)
"RTN","SDPPAPP1",58,0)
 I $P(SDCI,U,3)'="" D
"RTN","SDPPAPP1",59,0)
 .S X=$$SETSTR^VALM1("Checked-Out:",X,42,12)
"RTN","SDPPAPP1",60,0)
 .S X=$$SETSTR^VALM1($TR($$FMTE^XLFDT($P(SDCI,U,3),"5F")," ","0"),X,SDSEC,SDLEN)
"RTN","SDPPAPP1",61,0)
 ;following logic for Warning added per SD/473
"RTN","SDPPAPP1",62,0)
 I $D(SDCDATA) I $P(SDCDATA,U,2)=0 D
"RTN","SDPPAPP1",63,0)
 .S X="" D SET(X)
"RTN","SDPPAPP1",64,0)
 .D SET("**************************** WARNING *******************************************")
"RTN","SDPPAPP1",65,0)
 .D SET("There is a data inconsistency or data corruption problem with the above")
"RTN","SDPPAPP1",66,0)
 .D SET("appointment.  Corrective action needs to be taken.  Please cancel")
"RTN","SDPPAPP1",67,0)
 .D SET("the appointment above.  If it is a valid appointment, it will have to")
"RTN","SDPPAPP1",68,0)
 .D SET("be re-entered via Appointment Management.")
"RTN","SDPPAPP1",69,0)
 .D SET("********************************************************************************")
"RTN","SDPPAPP1",70,0)
 .S X="" D SET(X)
"RTN","SDPPAPP1",71,0)
 ;
"RTN","SDPPAPP1",72,0)
 D:X'="" SET(X)
"RTN","SDPPAPP1",73,0)
 D ^SDPPAPP2
"RTN","SDPPAPP1",74,0)
 Q
"RTN","SDPPAPP1",75,0)
SET(X) ; Set in ^TMP global for display
"RTN","SDPPAPP1",76,0)
 ;
"RTN","SDPPAPP1",77,0)
 S SDLN=SDLN+1,^TMP("SDPPALL",$J,SDLN,0)=X
"RTN","SDPPAPP1",78,0)
 S VALMCNT=SDLN
"RTN","SDPPAPP1",79,0)
 Q
"VER")
8.0^22.0
"BLD",6984,6)
^411
**END**
**END**
