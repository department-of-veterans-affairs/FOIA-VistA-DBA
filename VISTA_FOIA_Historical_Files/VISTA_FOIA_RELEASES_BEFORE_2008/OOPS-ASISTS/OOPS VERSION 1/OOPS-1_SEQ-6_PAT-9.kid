Released OOPS*1*9 SEQ #6
Extracted from mail message
**KIDS**:OOPS*1.0*9^

**INSTALL NAME**
OOPS*1.0*9
"BLD",2352,0)
OOPS*1.0*9^ASISTS^0^3000208^y
"BLD",2352,1,0)
^^1^1^3000202^
"BLD",2352,1,1,0)
Print Log from Union Menu Correction
"BLD",2352,4,0)
^9.64PA^^
"BLD",2352,"ABPKG")
n
"BLD",2352,"KRN",0)
^9.67PA^19^18
"BLD",2352,"KRN",.4,0)
.4
"BLD",2352,"KRN",.401,0)
.401
"BLD",2352,"KRN",.402,0)
.402
"BLD",2352,"KRN",.403,0)
.403
"BLD",2352,"KRN",.5,0)
.5
"BLD",2352,"KRN",.84,0)
.84
"BLD",2352,"KRN",3.6,0)
3.6
"BLD",2352,"KRN",3.8,0)
3.8
"BLD",2352,"KRN",9.2,0)
9.2
"BLD",2352,"KRN",9.8,0)
9.8
"BLD",2352,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",2352,"KRN",9.8,"NM",1,0)
OOPSLOG^^0^B29990098
"BLD",2352,"KRN",9.8,"NM",2,0)
OOPSPRT1^^0^B30655598
"BLD",2352,"KRN",9.8,"NM","B","OOPSLOG",1)

"BLD",2352,"KRN",9.8,"NM","B","OOPSPRT1",2)

"BLD",2352,"KRN",19,0)
19
"BLD",2352,"KRN",19.1,0)
19.1
"BLD",2352,"KRN",101,0)
101
"BLD",2352,"KRN",409.61,0)
409.61
"BLD",2352,"KRN",771,0)
771
"BLD",2352,"KRN",869.2,0)
869.2
"BLD",2352,"KRN",870,0)
870
"BLD",2352,"KRN",8994,0)
8994
"BLD",2352,"KRN","B",.4,.4)

"BLD",2352,"KRN","B",.401,.401)

"BLD",2352,"KRN","B",.402,.402)

"BLD",2352,"KRN","B",.403,.403)

"BLD",2352,"KRN","B",.5,.5)

"BLD",2352,"KRN","B",.84,.84)

"BLD",2352,"KRN","B",3.6,3.6)

"BLD",2352,"KRN","B",3.8,3.8)

"BLD",2352,"KRN","B",9.2,9.2)

"BLD",2352,"KRN","B",9.8,9.8)

"BLD",2352,"KRN","B",19,19)

"BLD",2352,"KRN","B",19.1,19.1)

"BLD",2352,"KRN","B",101,101)

"BLD",2352,"KRN","B",409.61,409.61)

"BLD",2352,"KRN","B",771,771)

"BLD",2352,"KRN","B",869.2,869.2)

"BLD",2352,"KRN","B",870,870)

"BLD",2352,"KRN","B",8994,8994)

"BLD",2352,"QUES",0)
^9.62^^
"BLD",2352,"REQB",0)
^9.611^4^4
"BLD",2352,"REQB",1,0)
OOPS*1.0*1^2
"BLD",2352,"REQB",2,0)
OOPS*1.0*2^2
"BLD",2352,"REQB",3,0)
OOPS*1.0*3^2
"BLD",2352,"REQB",4,0)
OOPS*1.0*5^2
"BLD",2352,"REQB","B","OOPS*1.0*1",1)

"BLD",2352,"REQB","B","OOPS*1.0*2",2)

"BLD",2352,"REQB","B","OOPS*1.0*3",3)

"BLD",2352,"REQB","B","OOPS*1.0*5",4)

"MBREQ")
0
"PKG",472,-1)
1^1
"PKG",472,0)
ASISTS^OOPS^Automated Safety Incident Surveillance Tracking System
"PKG",472,20,0)
^9.402P^^
"PKG",472,22,0)
^9.49I^1^1
"PKG",472,22,1,0)
1.0^^2980819^66481
"PKG",472,22,1,"PAH",1,0)
9^3000208
"PKG",472,22,1,"PAH",1,1,0)
^^1^1^3000208
"PKG",472,22,1,"PAH",1,1,1,0)
Print Log from Union Menu Correction
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","OOPSLOG")
0^1^B29990098
"RTN","OOPSLOG",1,0)
OOPSLOG ;HINES CIOFO/GB-Log of Federal Occupational Injuries and Illnesses;8/15/96
"RTN","OOPSLOG",2,0)
 ;;1.0;ASISTS;**1,2,5,9**;Jun 01, 1998
"RTN","OOPSLOG",3,0)
 N CN,CL,DA,DASHES,DATE,EX,FCILL,FCINJ,FCINJILL,FYR,FY,HDR,HDR1
"RTN","OOPSLOG",4,0)
 N HDR2,ILL,INC,INJ,INJILL,LIN,LP1,LTILL,LTINJ,LTINJILL,LYR,OUT,PG,STA
"RTN","OOPSLOG",5,0)
 S CN=0 F  S CN=$O(^OOPS(2260,"B",CN)) Q:CN'>0  S CL($E(CN,1,4))=""
"RTN","OOPSLOG",6,0)
 Q:'$D(CL)
"RTN","OOPSLOG",7,0)
 S FYR=$O(CL(0)),LYR=$O(CL(""),-1)
"RTN","OOPSLOG",8,0)
 K DIR S DIR(0)="N^"_FYR_":"_LYR,DIR("A")="Fiscal Year"
"RTN","OOPSLOG",9,0)
 S DIR("?")="Enter a fiscal year from the above range"
"RTN","OOPSLOG",10,0)
 D ^DIR K DIR
"RTN","OOPSLOG",11,0)
 Q:$D(DIRUT)
"RTN","OOPSLOG",12,0)
 S FY=Y
"RTN","OOPSLOG",13,0)
 I $D(EV) S INC=0,HDR1="Employees and volunteers only" G PREDEV
"RTN","OOPSLOG",14,0)
 K DIR S DIR(0)="SA^E/V:Employees and volunteers only;A:All cases",DIR("A")="Cases to be included: " D ^DIR K DIR
"RTN","OOPSLOG",15,0)
 Q:$D(DIRUT)
"RTN","OOPSLOG",16,0)
 S EV=Y
"RTN","OOPSLOG",17,0)
 K DIR S DIR(0)="Y",DIR("A")="Include names of persons involved",DIR("B")="Yes" D ^DIR K DIR
"RTN","OOPSLOG",18,0)
 Q:$D(DIRUT)
"RTN","OOPSLOG",19,0)
 S INC=Y
"RTN","OOPSLOG",20,0)
 ; Patch 5 -Get Station Number
"RTN","OOPSLOG",21,0)
PREDEV S OUT=""
"RTN","OOPSLOG",22,0)
 D STATION(.STA,.OUT)
"RTN","OOPSLOG",23,0)
 Q:$D(DIRUT)!(OUT)
"RTN","OOPSLOG",24,0)
DEV K IOP,%ZIS S %ZIS="MQ" W ! D ^%ZIS K %ZIS,IOP G:POP EXIT
"RTN","OOPSLOG",25,0)
 I $D(IO("Q")) D TASK G EXIT
"RTN","OOPSLOG",26,0)
 U IO D PRT D ^%ZISC K %ZIS,IOP G EXIT
"RTN","OOPSLOG",27,0)
PRT S PG=0
"RTN","OOPSLOG",28,0)
 S (INJ,ILL,FCINJ,FCILL,LTINJ,LTILL)=0
"RTN","OOPSLOG",29,0)
 S EX="",LIN=$S(IOST?1"C".E:IOSL-5,1:IOSL-6)
"RTN","OOPSLOG",30,0)
 K DASHES S $P(DASHES,"-",80)="-"
"RTN","OOPSLOG",31,0)
 D NOW^%DTC S DATE=%,Y=DATE X ^DD("DD") S DATE=Y
"RTN","OOPSLOG",32,0)
 S HDR=$S($G(NS):"Log of Needlestick Incidents for Fiscal Year ",1:"Log of Federal Occupational Injuries and Illnesses for Fiscal Year ")
"RTN","OOPSLOG",33,0)
 S HDR1=$S(EV="E/V":"Employees and volunteers only",1:"All cases")
"RTN","OOPSLOG",34,0)
 ; Patch 5 - change for Station Number looping
"RTN","OOPSLOG",35,0)
 S LP1=""
"RTN","OOPSLOG",36,0)
 I STA="A" D  Q
"RTN","OOPSLOG",37,0)
 . F  S LP1=$O(^OOPS(2260,"D",LP1)) Q:LP1=""!(EX=U)  D HDR D
"RTN","OOPSLOG",38,0)
 .. S DA=0 F  S DA=$O(^OOPS(2260,"D",LP1,DA)) D:DA="" LOGSUM Q:DA=""!(EX=U)  D DATA
"RTN","OOPSLOG",39,0)
 I STA'="A" D  Q
"RTN","OOPSLOG",40,0)
 . S LP1=STA
"RTN","OOPSLOG",41,0)
 . D HDR
"RTN","OOPSLOG",42,0)
 . S DA=0 F  S DA=$O(^OOPS(2260,"D",LP1,DA)) D:DA="" LOGSUM Q:DA=""!(EX=U)  D DATA
"RTN","OOPSLOG",43,0)
EXIT ; Clean up and exit
"RTN","OOPSLOG",44,0)
 K POP,X,Y,%,NS,EV
"RTN","OOPSLOG",45,0)
 Q
"RTN","OOPSLOG",46,0)
DATA ;
"RTN","OOPSLOG",47,0)
 N CASE,OOPS,YR,DIC,DIQ,DR
"RTN","OOPSLOG",48,0)
 S CASE=$$GET1^DIQ(2260,DA,.01)
"RTN","OOPSLOG",49,0)
 S YR=$E(CASE,1,4)
"RTN","OOPSLOG",50,0)
 I FY'="",(FY'=YR) Q
"RTN","OOPSLOG",51,0)
 K OOPS
"RTN","OOPSLOG",52,0)
 S DIC="^OOPS(2260,"
"RTN","OOPSLOG",53,0)
 S DR=".01;2;3;4;1;15;14;29;30;33;51;52"
"RTN","OOPSLOG",54,0)
 S DIQ="OOPS",DIQ(0)="IE" D EN^DIQ1
"RTN","OOPSLOG",55,0)
 I $G(NS),OOPS(2260,DA,3,"I")<11 Q
"RTN","OOPSLOG",56,0)
 I EV="E/V","1,2,6,"'[OOPS(2260,DA,2,"I")_"," Q
"RTN","OOPSLOG",57,0)
 Q:OOPS(2260,DA,51,"E")="Deleted"
"RTN","OOPSLOG",58,0)
 Q:OOPS(2260,DA,51,"E")="Replaced by amendment"
"RTN","OOPSLOG",59,0)
 ; Patch 9 fix summary logic
"RTN","OOPSLOG",60,0)
 I OOPS(2260,DA,52,"E")="Injury" S INJ=INJ+1 D
"RTN","OOPSLOG",61,0)
 . S:OOPS(2260,DA,29,"E")="Death" FCINJ=FCINJ+1
"RTN","OOPSLOG",62,0)
 . S:OOPS(2260,DA,33,"E")="Yes" LTINJ=LTINJ+1
"RTN","OOPSLOG",63,0)
 I OOPS(2260,DA,52,"E")="Illness/disease" S ILL=ILL+1 D
"RTN","OOPSLOG",64,0)
 . S:OOPS(2260,DA,29,"E")="Death" FCILL=FCILL+1
"RTN","OOPSLOG",65,0)
 . S:OOPS(2260,DA,33,"E")="Yes" LTILL=LTILL+1
"RTN","OOPSLOG",66,0)
 S:INC=0 OOPS(2260,DA,1,"E")="",OOPS(2260,DA,15,"E")="",OOPS(2260,DA,14,"E")=""
"RTN","OOPSLOG",67,0)
 W !,CASE,?12,$P(OOPS(2260,DA,4,"E"),"@",1),?26,OOPS(2260,DA,1,"E"),?57,OOPS(2260,DA,15,"E"),?63,OOPS(2260,DA,14,"E"),?74,OOPS(2260,DA,33,"E")
"RTN","OOPSLOG",68,0)
 W !,OOPS(2260,DA,52,"E"),?26,OOPS(2260,DA,3,"E")
"RTN","OOPSLOG",69,0)
 W !,?26,OOPS(2260,DA,29,"E")
"RTN","OOPSLOG",70,0)
 W !,OOPS(2260,DA,51,"E"),?26,OOPS(2260,DA,30,"E")
"RTN","OOPSLOG",71,0)
 W !,DASHES
"RTN","OOPSLOG",72,0)
 Q
"RTN","OOPSLOG",73,0)
LOGSUM ;Log Summary
"RTN","OOPSLOG",74,0)
 ; Patch 9 - if nothing to summarize, don't print
"RTN","OOPSLOG",75,0)
 I 'INJ&('ILL)&('FCINJ)&('FCILL)&('LTINJ)&('LTILL) Q
"RTN","OOPSLOG",76,0)
 I IOST?1"C".E,$Y>14 D  Q:EX=U
"RTN","OOPSLOG",77,0)
 .W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","OOPSLOG",78,0)
 .W @IOF S PG=PG+1
"RTN","OOPSLOG",79,0)
 .W !,HDR,FY,?72,"Page",$S($L(PG)=2:" ",1:"  "),PG
"RTN","OOPSLOG",80,0)
 .W !,DASHES
"RTN","OOPSLOG",81,0)
 W !,"Log Summary" D P Q:EX=U
"RTN","OOPSLOG",82,0)
 W !,DASHES D P Q:EX=U
"RTN","OOPSLOG",83,0)
 W !,"Injuries.: ",$J(INJ,3),?16,"Fatal Injuries....: ",$J(FCINJ,3)
"RTN","OOPSLOG",84,0)
 W ?41,"Lost Time Injuries....: ",$J(LTINJ,3) D P Q:EX=U
"RTN","OOPSLOG",85,0)
 W !,"Illnesses: ",$J(ILL,3),?16,"Fatal Illnesses...: ",$J(FCILL,3)
"RTN","OOPSLOG",86,0)
 W ?41,"Lost Time Illnesses...: ",$J(LTILL,3) D P Q:EX=U
"RTN","OOPSLOG",87,0)
 W !,"--------------",?16,"-----------------------",?41,"---------------------------" D P Q:EX=U
"RTN","OOPSLOG",88,0)
 S INJILL=INJ+ILL,FCINJILL=FCINJ+FCILL,LTINJILL=LTINJ+LTILL
"RTN","OOPSLOG",89,0)
 W !,"Total....: ",$J(INJILL,3),?16,"Total.............: ",$J(FCINJILL,3)
"RTN","OOPSLOG",90,0)
 W ?41,"Total.................: ",$J(LTINJILL,3)
"RTN","OOPSLOG",91,0)
 W !,DASHES
"RTN","OOPSLOG",92,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","OOPSLOG",93,0)
 S (INJ,FCINJ,LTINJ,ILL,FCILL,LTILL,INJILL,FCINJILL,LTINJILL)=0
"RTN","OOPSLOG",94,0)
 Q
"RTN","OOPSLOG",95,0)
P ;Display Data
"RTN","OOPSLOG",96,0)
 I $Y'<LIN D  Q:EX=U
"RTN","OOPSLOG",97,0)
 .I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","OOPSLOG",98,0)
 .D HDR
"RTN","OOPSLOG",99,0)
 Q
"RTN","OOPSLOG",100,0)
TASK ;Queue a task
"RTN","OOPSLOG",101,0)
 K IO("Q"),ZTUCI,ZTDTH,ZTIO,ZTSAVE
"RTN","OOPSLOG",102,0)
 S ZTRTN="PRT^OOPSLOG",ZTREQ="@",ZTSAVE("ZTREQ")=""
"RTN","OOPSLOG",103,0)
 S ZTDESC="Log of Federal Occupational Injuries and Illnesses"
"RTN","OOPSLOG",104,0)
 S ZTSAVE("FY")="",ZTSAVE("INC")="",ZTSAVE("NS")="",ZTSAVE("EV")=""
"RTN","OOPSLOG",105,0)
 ; Patch 5 - added STA
"RTN","OOPSLOG",106,0)
 S ZTSAVE("STA")=""
"RTN","OOPSLOG",107,0)
 D ^%ZTLOAD D ^%ZISC U IO W !,"Request Queued",!
"RTN","OOPSLOG",108,0)
 K ZTSK Q
"RTN","OOPSLOG",109,0)
HDR ;Header
"RTN","OOPSLOG",110,0)
 S HDR2="Station Number: "_$$GET1^DIQ(4,LP1,.01,"E")
"RTN","OOPSLOG",111,0)
 W @IOF S PG=PG+1
"RTN","OOPSLOG",112,0)
 W !,HDR,FY,?72,"Page",$S($L(PG)=2:" ",1:"  "),PG
"RTN","OOPSLOG",113,0)
 W !?(40-($L(HDR2)/2)),HDR2,!,HDR1
"RTN","OOPSLOG",114,0)
 W !?74,"Lost"
"RTN","OOPSLOG",115,0)
 W:INC=1 !,"Case #      Date          Name                           Occ   CC/Org     time"
"RTN","OOPSLOG",116,0)
 W:INC=0 !,"Case #      Date                                                          time"
"RTN","OOPSLOG",117,0)
 W !,DASHES
"RTN","OOPSLOG",118,0)
 Q
"RTN","OOPSLOG",119,0)
STATION(STA,OUT) ; Get 'ALL' or one station
"RTN","OOPSLOG",120,0)
 S STA=""
"RTN","OOPSLOG",121,0)
 N DIC,DIR,DIRUT,Y
"RTN","OOPSLOG",122,0)
 S DIR(0)="Y",DIR("A")="Run report for 'ALL' Stations",DIR("B")="Yes"
"RTN","OOPSLOG",123,0)
 S DIR("?")="Enter 'Y'es to run for all Stations or 'N'o to run "
"RTN","OOPSLOG",124,0)
 S DIR("?")=DIR("?")_"for just one Station."
"RTN","OOPSLOG",125,0)
 D ^DIR I Y S STA="A" Q
"RTN","OOPSLOG",126,0)
 I $D(DIRUT)!($D(DUOUT)) S OUT=1 Q
"RTN","OOPSLOG",127,0)
S1 ; if get here user <CR>
"RTN","OOPSLOG",128,0)
 S DIC("A")="Select STATION NUMBER: "
"RTN","OOPSLOG",129,0)
 S DIC="^DIC(4,",DIC(0)="AEMQZ"
"RTN","OOPSLOG",130,0)
 D ^DIC
"RTN","OOPSLOG",131,0)
 I $D(DUOUT) S OUT=1 Q
"RTN","OOPSLOG",132,0)
 I Y=-1 W !?5,"No Station selected, report will not run" S OUT=1 Q
"RTN","OOPSLOG",133,0)
 S STA=+Y
"RTN","OOPSLOG",134,0)
 I '$D(^OOPS(2260,"D",STA)) W !?5,"No data for that Station Number, Please select again." G S1
"RTN","OOPSLOG",135,0)
 Q
"RTN","OOPSPRT1")
0^2^B30655598
"RTN","OOPSPRT1",1,0)
OOPSPRT1 ;HINES/WAA - Utilities Routines - 3/24/98
"RTN","OOPSPRT1",2,0)
 ;;1.0;ASISTS;**2,3,5,9**;Jun 01, 1998
"RTN","OOPSPRT1",3,0)
 ;;
"RTN","OOPSPRT1",4,0)
 ; This routine is to display all the report that a person has
"RTN","OOPSPRT1",5,0)
 ; access to.
"RTN","OOPSPRT1",6,0)
EN1(CALLER) ;
"RTN","OOPSPRT1",7,0)
 ; Input:
"RTN","OOPSPRT1",8,0)
 ;    Caller O = Safety Officer
"RTN","OOPSPRT1",9,0)
 ;           U = Union
"RTN","OOPSPRT1",10,0)
 ;           S = Supervisor
"RTN","OOPSPRT1",11,0)
 ;           E = Employee
"RTN","OOPSPRT1",12,0)
 ; 
"RTN","OOPSPRT1",13,0)
 N YEAR,OUT,PAGE,STA,OUTPUT,SSN
"RTN","OOPSPRT1",14,0)
 ; Patch 5 - added logic to print all stations or 1
"RTN","OOPSPRT1",15,0)
 S OUT=0,PAGE=1,OUTPUT=0
"RTN","OOPSPRT1",16,0)
 S YEAR=""
"RTN","OOPSPRT1",17,0)
 I CALLER="E" D
"RTN","OOPSPRT1",18,0)
 .S SSN=$P(^VA(200,DUZ,1),U,9)
"RTN","OOPSPRT1",19,0)
 .Q:$D(^OOPS(2260,"SSN",SSN))<1
"RTN","OOPSPRT1",20,0)
 .Q
"RTN","OOPSPRT1",21,0)
 D RANGE(.YEAR,.OUT)
"RTN","OOPSPRT1",22,0)
 I 'OUT D STATION(.STA,.OUT)
"RTN","OOPSPRT1",23,0)
 D:'OUT DEVICE
"RTN","OOPSPRT1",24,0)
 I 'OUT D:'$D(IO("Q")) PRINT
"RTN","OOPSPRT1",25,0)
EXIT ;
"RTN","OOPSPRT1",26,0)
 I 'OUTPUT W !,?20,"No Data Found for this report."
"RTN","OOPSPRT1",27,0)
 D ^%ZISC
"RTN","OOPSPRT1",28,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","OOPSPRT1",29,0)
 K IO("Q")
"RTN","OOPSPRT1",30,0)
 Q
"RTN","OOPSPRT1",31,0)
RANGE(YEAR,OUT) ; This Subroutine will allow the user to select a range.
"RTN","OOPSPRT1",32,0)
 ; Output
"RTN","OOPSPRT1",33,0)
 ;   YEAR = The year that the user what to print
"RTN","OOPSPRT1",34,0)
 ;        = "" all years
"RTN","OOPSPRT1",35,0)
 ;
"RTN","OOPSPRT1",36,0)
 N DIR,DIRUT,Y
"RTN","OOPSPRT1",37,0)
R1 S DIR(0)="NAO^0:9999:0"
"RTN","OOPSPRT1",38,0)
 S DIR("A")="Select the Fiscal Year or RETURN for ALL: "
"RTN","OOPSPRT1",39,0)
 S DIR("??")="Enter the Fiscal Year that you want to print for or RETURN for data in file"
"RTN","OOPSPRT1",40,0)
 D ^DIR
"RTN","OOPSPRT1",41,0)
 I $D(DTOUT)!($D(DUOUT)) S OUT=1 Q
"RTN","OOPSPRT1",42,0)
 I Y'="",$L(Y)'=4 W !,"You must enter a 4 digit year." G R1
"RTN","OOPSPRT1",43,0)
 S YEAR=Y
"RTN","OOPSPRT1",44,0)
 I YEAR'="",'$O(^OOPS(2260,"B",(YEAR_"00000"))) W !,"No date for that Fiscal Year please select again." G R1
"RTN","OOPSPRT1",45,0)
 Q
"RTN","OOPSPRT1",46,0)
STATION(STA,OUT) ;
"RTN","OOPSPRT1",47,0)
 S STA=""
"RTN","OOPSPRT1",48,0)
 N DIC,DIR,DIRUT,Y
"RTN","OOPSPRT1",49,0)
 S DIR(0)="Y",DIR("A")="Run report for 'ALL' Stations",DIR("B")="Yes"
"RTN","OOPSPRT1",50,0)
 S DIR("?")="Enter 'Y'es to run for all Stations or 'N'o to run "
"RTN","OOPSPRT1",51,0)
 S DIR("?")=DIR("?")_"for just one Station."
"RTN","OOPSPRT1",52,0)
 D ^DIR I Y S STA="A" Q
"RTN","OOPSPRT1",53,0)
 I $D(DIRUT)!($D(DUOUT)) S OUT=1 Q
"RTN","OOPSPRT1",54,0)
S1 ; if get here user <CR>
"RTN","OOPSPRT1",55,0)
 S DIC("A")="Select STATION NUMBER: "
"RTN","OOPSPRT1",56,0)
 S DIC="^DIC(4,",DIC(0)="AEMQZ"
"RTN","OOPSPRT1",57,0)
 D ^DIC K DIC
"RTN","OOPSPRT1",58,0)
 I Y=-1 W !?5,"No Station selected, report will not run" S OUT=1 Q
"RTN","OOPSPRT1",59,0)
 S STA=+Y
"RTN","OOPSPRT1",60,0)
 I '$D(^OOPS(2260,"D",STA)) W !?5,"No data for that Station Number, Please select again." G S1
"RTN","OOPSPRT1",61,0)
 Q
"RTN","OOPSPRT1",62,0)
DEVICE ; This is the device selection routine.
"RTN","OOPSPRT1",63,0)
 ;
"RTN","OOPSPRT1",64,0)
 S %ZIS="QM" D ^%ZIS I POP S OUT=1 Q
"RTN","OOPSPRT1",65,0)
 I $D(IO("Q")) D  Q
"RTN","OOPSPRT1",66,0)
 .S ZTRTN="PRINT^OOPSPRT1",ZTDESC="Print Accident Report Sign-off list"
"RTN","OOPSPRT1",67,0)
 .S ZTSAVE("YEAR")="",ZTSAVE("STA")=""   ; Patch 5 - added STA
"RTN","OOPSPRT1",68,0)
 .S ZTSAVE("OUT")=""
"RTN","OOPSPRT1",69,0)
 .S ZTSAVE("CALLER")=""
"RTN","OOPSPRT1",70,0)
 .S ZTSAVE("SSN")=""
"RTN","OOPSPRT1",71,0)
 .S ZTSAVE("PAGE")=""
"RTN","OOPSPRT1",72,0)
 .D ^%ZTLOAD D HOME^%ZIS Q
"RTN","OOPSPRT1",73,0)
 .Q
"RTN","OOPSPRT1",74,0)
 Q
"RTN","OOPSPRT1",75,0)
PRINT ; This is the main print portion of the routine
"RTN","OOPSPRT1",76,0)
 N CNT,LOOP
"RTN","OOPSPRT1",77,0)
 S CNT=0
"RTN","OOPSPRT1",78,0)
 S LOOP=$S(STA="A":"",1:STA)
"RTN","OOPSPRT1",79,0)
 U IO
"RTN","OOPSPRT1",80,0)
 I STA'="A" D ONE Q
"RTN","OOPSPRT1",81,0)
MAIN ; Main Loop
"RTN","OOPSPRT1",82,0)
 F  S LOOP=$O(^OOPS(2260,"D",LOOP)) Q:LOOP=""!OUT  S HEAD=1 D:$D(^(LOOP)) HEAD Q:OUT  D
"RTN","OOPSPRT1",83,0)
 . S IEN=0 F  S IEN=$O(^OOPS(2260,"D",LOOP,IEN)) Q:IEN<1!OUT  D DATA
"RTN","OOPSPRT1",84,0)
 Q
"RTN","OOPSPRT1",85,0)
ONE ; Only 1 Station Selected
"RTN","OOPSPRT1",86,0)
 I $D(^OOPS(2260,"D",LOOP)) D HEAD
"RTN","OOPSPRT1",87,0)
 S IEN=0 F  S IEN=$O(^OOPS(2260,"D",LOOP,IEN)) Q:IEN<1!OUT  D DATA
"RTN","OOPSPRT1",88,0)
 Q
"RTN","OOPSPRT1",89,0)
DATA ; Loop to get & print data
"RTN","OOPSPRT1",90,0)
 N CASE,NAME,SSN1,DATE,INC,CAT,YR
"RTN","OOPSPRT1",91,0)
 S CASE=$$GET1^DIQ(2260,IEN,.01)
"RTN","OOPSPRT1",92,0)
 S YR=$E(CASE,1,4)
"RTN","OOPSPRT1",93,0)
 I YEAR,YEAR'=YR Q
"RTN","OOPSPRT1",94,0)
 ; Only get OPEN cases - field 51 - 0 = OPEN
"RTN","OOPSPRT1",95,0)
 I $$GET1^DIQ(2260,IEN,51,"I") Q
"RTN","OOPSPRT1",96,0)
 S INC=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSPRT1",97,0)
 S NAME=$E($$GET1^DIQ(2260,IEN,1,"E"),1,30)
"RTN","OOPSPRT1",98,0)
 S SSN1=$$GET1^DIQ(2260,IEN,5,"E")
"RTN","OOPSPRT1",99,0)
 S DATE=$$GET1^DIQ(2260,IEN,4,"E")
"RTN","OOPSPRT1",100,0)
 S CAT=$$GET1^DIQ(2260,IEN,2,"I")
"RTN","OOPSPRT1",101,0)
 S CNT=CNT+1
"RTN","OOPSPRT1",102,0)
 I CALLER="E" Q:SSN'=SSN1
"RTN","OOPSPRT1",103,0)
 I CALLER="S" I ($$GET1^DIQ(2260,IEN,53,"I")'=DUZ),($$GET1^DIQ(2260,IEN,53.1,"I")'=DUZ) Q
"RTN","OOPSPRT1",104,0)
 D HEAD Q:OUT
"RTN","OOPSPRT1",105,0)
 W !!,CASE
"RTN","OOPSPRT1",106,0)
 W:CALLER'="U" ?12,NAME,?42,SSN1
"RTN","OOPSPRT1",107,0)
 W ?57,DATE S OUTPUT=1
"RTN","OOPSPRT1",108,0)
 W !,?35,"   CA1   ",?50,"   CA2   ",?65,"  2162   "
"RTN","OOPSPRT1",109,0)
 W !,?35,"---------",?50,"---------",?65,"---------"
"RTN","OOPSPRT1",110,0)
 D          ; Employee Data
"RTN","OOPSPRT1",111,0)
 . N SIGN
"RTN","OOPSPRT1",112,0)
 . S SIGN=$$EDSTA^OOPSUTL1(IEN,"E")
"RTN","OOPSPRT1",113,0)
 . W !,?20,"EMPLOYEE:"
"RTN","OOPSPRT1",114,0)
 . I INC=1 W ?35
"RTN","OOPSPRT1",115,0)
 . I INC=2 W ?50
"RTN","OOPSPRT1",116,0)
 . ; Also, not a Non-PAID Employee either
"RTN","OOPSPRT1",117,0)
 . ; Patch 5 - logic changed for new Personnel Categories
"RTN","OOPSPRT1",118,0)
 . I '$$ISEMP^OOPSUTL4(IEN) W "N/A(",$E($$GET1^DIQ(2260,IEN,2,"E"),1,7),")" Q
"RTN","OOPSPRT1",119,0)
 . W $S($P(SIGN,U,INC):" ",1:"UN-"),"SIGNED"
"RTN","OOPSPRT1",120,0)
 . Q
"RTN","OOPSPRT1",121,0)
 Q:CALLER="E"
"RTN","OOPSPRT1",122,0)
 D           ; Supervisor Data
"RTN","OOPSPRT1",123,0)
 . N SIGN
"RTN","OOPSPRT1",124,0)
 . S SIGN=$$EDSTA^OOPSUTL1(IEN,"S")
"RTN","OOPSPRT1",125,0)
 . W !,?20,"SUPERVISOR:"
"RTN","OOPSPRT1",126,0)
 . I INC=1 W ?35
"RTN","OOPSPRT1",127,0)
 . I INC=2 W ?50
"RTN","OOPSPRT1",128,0)
 .;Also not a Non-Paid Employee either
"RTN","OOPSPRT1",129,0)
 .; Patch 5 - See above
"RTN","OOPSPRT1",130,0)
 . I '$$ISEMP^OOPSUTL4(IEN) W "N/A(",$E($$GET1^DIQ(2260,IEN,2,"E"),1,7),")"
"RTN","OOPSPRT1",131,0)
 . E  W $S($P(SIGN,U,INC):" ",1:"UN-"),"SIGNED"
"RTN","OOPSPRT1",132,0)
 . W ?65,$S($P(SIGN,U,3):" ",1:"UN-"),"SIGNED"
"RTN","OOPSPRT1",133,0)
 . Q
"RTN","OOPSPRT1",134,0)
 Q:CALLER="S"
"RTN","OOPSPRT1",135,0)
 D           ; Safety Officer Data
"RTN","OOPSPRT1",136,0)
 . N SIGN
"RTN","OOPSPRT1",137,0)
 . S SIGN=$$EDSTA^OOPSUTL1(IEN,"O")
"RTN","OOPSPRT1",138,0)
 . W !,?20,"SAFETY OFFICER:"
"RTN","OOPSPRT1",139,0)
 . W ?65,$S($P(SIGN,U):" ",1:"UN-"),"SIGNED"
"RTN","OOPSPRT1",140,0)
 . Q
"RTN","OOPSPRT1",141,0)
 Q
"RTN","OOPSPRT1",142,0)
HEAD ; This is the head portion of the routine
"RTN","OOPSPRT1",143,0)
 I PAGE=1 D
"RTN","OOPSPRT1",144,0)
 .W:$E(IOST,1,2)="C-" @IOF
"RTN","OOPSPRT1",145,0)
 .Q
"RTN","OOPSPRT1",146,0)
 I PAGE'=1 Q:($Y<(IOSL-6)&('HEAD))
"RTN","OOPSPRT1",147,0)
 I $E(IOST,1,2)="C-" D  Q:OUT
"RTN","OOPSPRT1",148,0)
 .I PAGE=1 W @IOF Q
"RTN","OOPSPRT1",149,0)
 .I PAGE'=1 D  Q:OUT
"RTN","OOPSPRT1",150,0)
 ..N DIR S DIR(0)="E" D ^DIR I 'Y S OUT=1
"RTN","OOPSPRT1",151,0)
 ..K Y
"RTN","OOPSPRT1",152,0)
 ..Q
"RTN","OOPSPRT1",153,0)
 .Q
"RTN","OOPSPRT1",154,0)
 Q:OUT
"RTN","OOPSPRT1",155,0)
 I PAGE'=1 W @IOF
"RTN","OOPSPRT1",156,0)
 N LINER,TAB,LINE2,TAB2
"RTN","OOPSPRT1",157,0)
 W !,$$FMTE^XLFDT($$NOW^XLFDT,1),?70,"PAGE: ",PAGE,!
"RTN","OOPSPRT1",158,0)
 S LINER="Accident Report Status"_$S(YEAR="":"",1:" for the fiscal Year "_YEAR)
"RTN","OOPSPRT1",159,0)
 S TAB=(40-($L(LINER)/2))
"RTN","OOPSPRT1",160,0)
 S LINE2="Station Number: "_$$GET1^DIQ(4,LOOP,.01,"E")
"RTN","OOPSPRT1",161,0)
 S TAB2=(40-($L(LINE2)/2))
"RTN","OOPSPRT1",162,0)
 W ?TAB,LINER,!,?TAB2,LINE2
"RTN","OOPSPRT1",163,0)
 W !,"Case No."
"RTN","OOPSPRT1",164,0)
 W:CALLER'="U" ?12,"Name",?46,"SSN"
"RTN","OOPSPRT1",165,0)
 W ?57,"DATE OF INCIDENT"
"RTN","OOPSPRT1",166,0)
 W !,"============================================================================="
"RTN","OOPSPRT1",167,0)
 S PAGE=PAGE+1,HEAD=""
"RTN","OOPSPRT1",168,0)
 Q
"VER")
8.0^22.0
**END**
**END**
