Released PPP*1*42 SEQ #37
Extracted from mail message
**KIDS**:PPP*1.0*42^

**INSTALL NAME**
PPP*1.0*42
"BLD",7035,0)
PPP*1.0*42^PHARMACY PRESCRIPTION PRACTICE^0^3070129^y
"BLD",7035,4,0)
^9.64PA^^
"BLD",7035,6.3)
4
"BLD",7035,"ABPKG")
n
"BLD",7035,"KRN",0)
^9.67PA^8989.52^19
"BLD",7035,"KRN",.4,0)
.4
"BLD",7035,"KRN",.401,0)
.401
"BLD",7035,"KRN",.402,0)
.402
"BLD",7035,"KRN",.403,0)
.403
"BLD",7035,"KRN",.5,0)
.5
"BLD",7035,"KRN",.84,0)
.84
"BLD",7035,"KRN",3.6,0)
3.6
"BLD",7035,"KRN",3.8,0)
3.8
"BLD",7035,"KRN",9.2,0)
9.2
"BLD",7035,"KRN",9.8,0)
9.8
"BLD",7035,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7035,"KRN",9.8,"NM",1,0)
PPPSCN2^^0^B15900549
"BLD",7035,"KRN",9.8,"NM","B","PPPSCN2",1)

"BLD",7035,"KRN",19,0)
19
"BLD",7035,"KRN",19.1,0)
19.1
"BLD",7035,"KRN",101,0)
101
"BLD",7035,"KRN",409.61,0)
409.61
"BLD",7035,"KRN",771,0)
771
"BLD",7035,"KRN",870,0)
870
"BLD",7035,"KRN",8989.51,0)
8989.51
"BLD",7035,"KRN",8989.52,0)
8989.52
"BLD",7035,"KRN",8994,0)
8994
"BLD",7035,"KRN","B",.4,.4)

"BLD",7035,"KRN","B",.401,.401)

"BLD",7035,"KRN","B",.402,.402)

"BLD",7035,"KRN","B",.403,.403)

"BLD",7035,"KRN","B",.5,.5)

"BLD",7035,"KRN","B",.84,.84)

"BLD",7035,"KRN","B",3.6,3.6)

"BLD",7035,"KRN","B",3.8,3.8)

"BLD",7035,"KRN","B",9.2,9.2)

"BLD",7035,"KRN","B",9.8,9.8)

"BLD",7035,"KRN","B",19,19)

"BLD",7035,"KRN","B",19.1,19.1)

"BLD",7035,"KRN","B",101,101)

"BLD",7035,"KRN","B",409.61,409.61)

"BLD",7035,"KRN","B",771,771)

"BLD",7035,"KRN","B",870,870)

"BLD",7035,"KRN","B",8989.51,8989.51)

"BLD",7035,"KRN","B",8989.52,8989.52)

"BLD",7035,"KRN","B",8994,8994)

"BLD",7035,"QUES",0)
^9.62^^
"BLD",7035,"REQB",0)
^9.611^1^1
"BLD",7035,"REQB",1,0)
PPP*1.0*41^2
"BLD",7035,"REQB","B","PPP*1.0*41",1)

"MBREQ")
0
"PKG",521,-1)
1^1
"PKG",521,0)
PHARMACY PRESCRIPTION PRACTICE^PPP^3P
"PKG",521,20,0)
^9.402P^^
"PKG",521,22,0)
^9.49I^1^1
"PKG",521,22,1,0)
1.0^2950407^2951019
"PKG",521,22,1,"PAH",1,0)
42^3070129
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PPPSCN2")
0^1^B15900549^B16603361
"RTN","PPPSCN2",1,0)
PPPSCN2 ;ALB/DMB - PPP CLINIC SCAN ROUTINE ; 2/20/92
"RTN","PPPSCN2",2,0)
 ;;1.0;PHARMACY PRESCRIPTION PRACTICE;**9,41,42**;APR 7,1995;Build 4
"RTN","PPPSCN2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PPPSCN2",4,0)
 ;Reference to GETPLIST^SDAMA202 supported by IA #3869
"RTN","PPPSCN2",5,0)
 ;Reference to ^SC("AC" supported by IA #4084
"RTN","PPPSCN2",6,0)
 ;
"RTN","PPPSCN2",7,0)
FFSCAN ; Scan clinic for patients to send PDX's for
"RTN","PPPSCN2",8,0)
 ;
"RTN","PPPSCN2",9,0)
 N X,TMP,DTCERR,PFGERR,CSCNSTRT,CSCNEND,DATE,SCANDATE,PCSD,TOTPATS
"RTN","PPPSCN2",10,0)
 N PDXSTRT,PDXEND,CODE,ERR,FFXIFN,LPDX,MAXDAYS,RSLTPTR,UNSPTR
"RTN","PPPSCN2",11,0)
 N PATDFN,STAPTR,TOTSTA,X1,X2,PROCPTR,AUTOPTR
"RTN","PPPSCN2",12,0)
 ;
"RTN","PPPSCN2",13,0)
 S PPPMRT="FFSCAN_PPPSCN2"
"RTN","PPPSCN2",14,0)
 S DTCERR=-9006
"RTN","PPPSCN2",15,0)
 S PFGERR=-9007
"RTN","PPPSCN2",16,0)
 S CSCNSTRT=1006
"RTN","PPPSCN2",17,0)
 S CSCNEND=1007
"RTN","PPPSCN2",18,0)
 S PDXSTRT=1008
"RTN","PPPSCN2",19,0)
 S PDXEND=1009
"RTN","PPPSCN2",20,0)
 S ^TMP("PPP",$J,"ERR",1)="The following Errors occurred while attempting to send PDX's:"
"RTN","PPPSCN2",21,0)
 S ^TMP("PPP",$J,"ERR",2)=" "
"RTN","PPPSCN2",22,0)
 S (PDXSNT,TOTSTA)=0
"RTN","PPPSCN2",23,0)
 S ERR=0
"RTN","PPPSCN2",24,0)
 ;GET POINTERS TO ACCEPTABLE PDX STATUSES
"RTN","PPPSCN2",25,0)
 S RSLTPTR=$$GETSTPTR^PPPGET7("VAQ-RSLT")
"RTN","PPPSCN2",26,0)
 S UNSPTR=$$GETSTPTR^PPPGET7("VAQ-UNSOL")
"RTN","PPPSCN2",27,0)
 S PROCPTR=$$GETSTPTR^PPPGET7("VAQ-PROC")
"RTN","PPPSCN2",28,0)
 S AUTOPTR=$$GETSTPTR^PPPGET7("VAQ-AUTO")
"RTN","PPPSCN2",29,0)
 ;
"RTN","PPPSCN2",30,0)
 S TMP=$$LOGEVNT^PPPMSC1(CSCNSTRT,PPPMRT)
"RTN","PPPSCN2",31,0)
 ;
"RTN","PPPSCN2",32,0)
 D NOW^%DTC
"RTN","PPPSCN2",33,0)
 I X="" D  Q
"RTN","PPPSCN2",34,0)
 .S TMP=$$LOGEVNT^PPPMSC1(DTCERR,PPPMRT)
"RTN","PPPSCN2",35,0)
 S DATE=X
"RTN","PPPSCN2",36,0)
 K %,%H,%I,X
"RTN","PPPSCN2",37,0)
 ;
"RTN","PPPSCN2",38,0)
 S PCSD=$P($G(^PPP(1020.1,1,0)),"^",2)
"RTN","PPPSCN2",39,0)
 I PCSD="" D  Q
"RTN","PPPSCN2",40,0)
 .S TMP=$$LOGEVNT^PPPMSC1(PFGERR,PPPMRT)
"RTN","PPPSCN2",41,0)
 S X1=DATE
"RTN","PPPSCN2",42,0)
 S X2=PCSD
"RTN","PPPSCN2",43,0)
 D C^%DTC
"RTN","PPPSCN2",44,0)
 I X="" D  Q
"RTN","PPPSCN2",45,0)
 .S TMP=$$LOGEVNT^PPPMSC1(DTCERR,PPPMRT)
"RTN","PPPSCN2",46,0)
 S SCANDATE=X
"RTN","PPPSCN2",47,0)
 K X1,X2,X,%H
"RTN","PPPSCN2",48,0)
 ;
"RTN","PPPSCN2",49,0)
 S TOTPATS=$$CLINSCAN(SCANDATE,"^TMP(""PPP"",$J,SCANDATE)")
"RTN","PPPSCN2",50,0)
 S TMP=$$LOGEVNT^PPPMSC1(CSCNEND,PPPMRT,"TOTAL ENTRIES = "_TOTPATS)
"RTN","PPPSCN2",51,0)
 ;
"RTN","PPPSCN2",52,0)
 S MAXDAYS=$P($G(^PPP(1020.1,1,0)),"^",3)
"RTN","PPPSCN2",53,0)
 S TMP=$$LOGEVNT^PPPMSC1(PDXSTRT,PPPMRT)
"RTN","PPPSCN2",54,0)
 ;
"RTN","PPPSCN2",55,0)
 F PATDFN=0:0 D  Q:PATDFN=""
"RTN","PPPSCN2",56,0)
 .K PPPSTA
"RTN","PPPSCN2",57,0)
 .S PATDFN=$O(^TMP("PPP",$J,SCANDATE,PATDFN)) Q:PATDFN=""
"RTN","PPPSCN2",58,0)
 .F STAPTR=0:0 D  Q:STAPTR=""
"RTN","PPPSCN2",59,0)
 ..S STAPTR=$O(^PPP(1020.2,"APOV",PATDFN,STAPTR)) Q:STAPTR=""
"RTN","PPPSCN2",60,0)
 ..S FFXIFN=$O(^PPP(1020.2,"APOV",PATDFN,STAPTR,"")) Q:FFXIFN=""
"RTN","PPPSCN2",61,0)
 ..I '$D(^PPP(1020.5,"B",STAPTR)) D
"RTN","PPPSCN2",62,0)
 ...S LPDX=$P($G(^PPP(1020.2,FFXIFN,1)),"^",2)
"RTN","PPPSCN2",63,0)
 ...I LPDX=""!($$DIFFDT^PPPCNV1(DATE,LPDX)>MAXDAYS) D
"RTN","PPPSCN2",64,0)
 ....S CODE=$P($G(^PPP(1020.2,FFXIFN,1)),"^",3)
"RTN","PPPSCN2",65,0)
 ....I ((CODE=RSLTPTR)!(CODE=UNSPTR)!(CODE=PROCPTR)!(CODE=AUTOPTR)!(CODE="")) D
"RTN","PPPSCN2",66,0)
 .....S PPPSTA(STAPTR)=""
"RTN","PPPSCN2",67,0)
 .....S TOTSTA=TOTSTA+1
"RTN","PPPSCN2",68,0)
 .I $O(PPPSTA(""))'="" D  Q:ERR
"RTN","PPPSCN2",69,0)
 ..S ERR=$$SNDPDX^PPPPDX1(PATDFN,"PPPSTA","^TMP(""PPP"",$J,""ERR"")")
"RTN","PPPSCN2",70,0)
 ..I ERR D
"RTN","PPPSCN2",71,0)
 ...S TMP=$$LOGEVNT^PPPMSC1(ERR,PPPMRT,"Error From PPPPDX1 ==> "_ERR)
"RTN","PPPSCN2",72,0)
 ...S PATDFN=""
"RTN","PPPSCN2",73,0)
 ;
"RTN","PPPSCN2",74,0)
 ; Set the last batch request date to today
"RTN","PPPSCN2",75,0)
 ;
"RTN","PPPSCN2",76,0)
 S $P(^PPP(1020.1,1,0),"^",6)=DT
"RTN","PPPSCN2",77,0)
 S TMP=$$LOGEVNT^PPPMSC1(PDXEND,PPPMRT,"TOTAL PDX'S REQUESTED = "_TOTSTA)
"RTN","PPPSCN2",78,0)
 I '$D(^TMP("PPP",$J,"ERR",3)) S ^TMP("PPP",$J,"ERR",1)="No Errors occurred while attempting to send PDX's"
"RTN","PPPSCN2",79,0)
 ;S ^TMP("PPP",$J,"ERR",4)=""
"RTN","PPPSCN2",80,0)
 S TMP=$$SNDBLTN^PPPMSC1("PPP DAILY BATCH "_$$SLASHDT^PPPCNV1(DT),"PRESCRIPTION PRACTICES","^TMP(""PPP"",$J,""ERR"",")
"RTN","PPPSCN2",81,0)
 ;
"RTN","PPPSCN2",82,0)
 K ^TMP("PPP",$J,"ERR"),^TMP("PPP",$J,SCANDATE),PPPMRT,PPPSTA,PDXSNT
"RTN","PPPSCN2",83,0)
 Q
"RTN","PPPSCN2",84,0)
 ;
"RTN","PPPSCN2",85,0)
CLINSCAN(SCANDATE,ARRYNM) ; Scan the clinics for appointments
"RTN","PPPSCN2",86,0)
 N CLINIC,PATDFN,TPATS,SEQ
"RTN","PPPSCN2",87,0)
 ;
"RTN","PPPSCN2",88,0)
 S CLINIC="",TPATS=0
"RTN","PPPSCN2",89,0)
 F  S CLINIC=$O(^SC("AC","C",CLINIC)) Q:CLINIC=""  D
"RTN","PPPSCN2",90,0)
 .K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","PPPSCN2",91,0)
 .D GETPLIST^SDAMA202(CLINIC,"3;4;12",,SCANDATE,SCANDATE)
"RTN","PPPSCN2",92,0)
 .S SEQ=0
"RTN","PPPSCN2",93,0)
 .F  S SEQ=$O(^TMP($J,"SDAMA202","GETPLIST",SEQ)) Q:'SEQ  D
"RTN","PPPSCN2",94,0)
 ..I $P($G(^TMP($J,"SDAMA202","GETPLIST",SEQ,3)),"^")="R",$P($G(^TMP($J,"SDAMA202","GETPLIST",SEQ,12)),"^")="O" D
"RTN","PPPSCN2",95,0)
 ...S PATDFN=+$G(^TMP($J,"SDAMA202","GETPLIST",SEQ,4)) Q:'PATDFN
"RTN","PPPSCN2",96,0)
 ...S @ARRYNM@(PATDFN)=""
"RTN","PPPSCN2",97,0)
 ...S TPATS=TPATS+1
"RTN","PPPSCN2",98,0)
 K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","PPPSCN2",99,0)
 ;
"RTN","PPPSCN2",100,0)
 Q TPATS
"VER")
8.0^22.0
"BLD",7035,6)
^37
**END**
**END**
