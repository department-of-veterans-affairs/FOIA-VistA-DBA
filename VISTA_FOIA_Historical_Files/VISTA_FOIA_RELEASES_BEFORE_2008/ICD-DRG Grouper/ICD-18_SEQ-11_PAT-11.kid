Released ICD*18*11 SEQ #11
Extracted from mail message
**KIDS**:ICD*18.0*11^

**INSTALL NAME**
ICD*18.0*11
"BLD",3614,0)
ICD*18.0*11^DRG GROUPER^0^3031202^y
"BLD",3614,1,0)
^^2^2^3031022^
"BLD",3614,1,1,0)
Please see the National Patch Module for details
"BLD",3614,1,2,0)
of the enhancements included in this patch.
"BLD",3614,4,0)
^9.64PA^^
"BLD",3614,"INID")
n^n
"BLD",3614,"INIT")
POST^ICD1811
"BLD",3614,"KRN",0)
^9.67PA^8989.52^19
"BLD",3614,"KRN",.4,0)
.4
"BLD",3614,"KRN",.401,0)
.401
"BLD",3614,"KRN",.402,0)
.402
"BLD",3614,"KRN",.403,0)
.403
"BLD",3614,"KRN",.5,0)
.5
"BLD",3614,"KRN",.84,0)
.84
"BLD",3614,"KRN",3.6,0)
3.6
"BLD",3614,"KRN",3.8,0)
3.8
"BLD",3614,"KRN",9.2,0)
9.2
"BLD",3614,"KRN",9.8,0)
9.8
"BLD",3614,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3614,"KRN",9.8,"NM",1,0)
ICDAPIU^^0^B27530689
"BLD",3614,"KRN",9.8,"NM",2,0)
ICDUPDT^^0^B196286
"BLD",3614,"KRN",9.8,"NM",3,0)
ICD1811^^0^B5298201
"BLD",3614,"KRN",9.8,"NM","B","ICD1811",3)

"BLD",3614,"KRN",9.8,"NM","B","ICDAPIU",1)

"BLD",3614,"KRN",9.8,"NM","B","ICDUPDT",2)

"BLD",3614,"KRN",19,0)
19
"BLD",3614,"KRN",19.1,0)
19.1
"BLD",3614,"KRN",101,0)
101
"BLD",3614,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",3614,"KRN",101,"NM",1,0)
ICD CODE UPDATE EVENT^^4^
"BLD",3614,"KRN",101,"NM",2,0)
LEXICAL SERVICES UPDATE^^2
"BLD",3614,"KRN",101,"NM","B","ICD CODE UPDATE EVENT",1)

"BLD",3614,"KRN",101,"NM","B","LEXICAL SERVICES UPDATE",2)

"BLD",3614,"KRN",409.61,0)
409.61
"BLD",3614,"KRN",771,0)
771
"BLD",3614,"KRN",870,0)
870
"BLD",3614,"KRN",8989.51,0)
8989.51
"BLD",3614,"KRN",8989.52,0)
8989.52
"BLD",3614,"KRN",8994,0)
8994
"BLD",3614,"KRN","B",.4,.4)

"BLD",3614,"KRN","B",.401,.401)

"BLD",3614,"KRN","B",.402,.402)

"BLD",3614,"KRN","B",.403,.403)

"BLD",3614,"KRN","B",.5,.5)

"BLD",3614,"KRN","B",.84,.84)

"BLD",3614,"KRN","B",3.6,3.6)

"BLD",3614,"KRN","B",3.8,3.8)

"BLD",3614,"KRN","B",9.2,9.2)

"BLD",3614,"KRN","B",9.8,9.8)

"BLD",3614,"KRN","B",19,19)

"BLD",3614,"KRN","B",19.1,19.1)

"BLD",3614,"KRN","B",101,101)

"BLD",3614,"KRN","B",409.61,409.61)

"BLD",3614,"KRN","B",771,771)

"BLD",3614,"KRN","B",870,870)

"BLD",3614,"KRN","B",8989.51,8989.51)

"BLD",3614,"KRN","B",8989.52,8989.52)

"BLD",3614,"KRN","B",8994,8994)

"BLD",3614,"PRE")

"BLD",3614,"QUES",0)
^9.62^^
"BLD",3614,"REQB",0)
^9.611^1^1
"BLD",3614,"REQB",1,0)
ICD*18.0*6^2
"BLD",3614,"REQB","B","ICD*18.0*6",1)

"INIT")
POST^ICD1811
"KRN",101,4406,-1)
4^1
"KRN",101,4406,0)
ICD CODE UPDATE EVENT
"KRN",101,4475,-1)
2^2
"KRN",101,4475,0)
LEXICAL SERVICES UPDATE^Lexical Services Update^^X^100988^^^^^^^512
"KRN",101,4475,10,0)
^101.01PA^2^2
"KRN",101,4475,10,2,0)
4406^ICD^^
"KRN",101,4475,10,2,"^")
ICD CODE UPDATE EVENT
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",152,-1)
1^1
"PKG",152,0)
DRG GROUPER^ICD^DRG GROUPER
"PKG",152,20,0)
^9.402P^^
"PKG",152,22,0)
^9.49I^1^1
"PKG",152,22,1,0)
18.0^3001024^3001122^11721
"PKG",152,22,1,"PAH",1,0)
11^3031202
"PKG",152,22,1,"PAH",1,1,0)
^^2^2^3031202
"PKG",152,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details
"PKG",152,22,1,"PAH",1,1,2,0)
of the enhancements included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ICD1811")
0^3^B5298201
"RTN","ICD1811",1,0)
ICD1811 ;DLS/DEK - ICD Patch Driver ; 10/22/2003
"RTN","ICD1811",2,0)
 ;;18.0;DRG Grouper;**11**;Oct 20, 2000
"RTN","ICD1811",3,0)
 ;
"RTN","ICD1811",4,0)
 ; NOIS calls addressed:
"RTN","ICD1811",5,0)
 ;   Gender in wrong field
"RTN","ICD1811",6,0)
 ;     IRO-1003-41917, LON-1003-62093
"RTN","ICD1811",7,0)
 ;   Change needed to description
"RTN","ICD1811",8,0)
 ;     DAN-1003-41641
"RTN","ICD1811",9,0)
 ;
"RTN","ICD1811",10,0)
 ; Quit if Protocol NOT found on the system
"RTN","ICD1811",11,0)
 ;   XPDABORT  Signals the KIDS system to abort the load 
"RTN","ICD1811",12,0)
 ;
"RTN","ICD1811",13,0)
 ; External References
"RTN","ICD1811",14,0)
 ;   DBIA  3990  CODEN^ICDCODE
"RTN","ICD1811",15,0)
 ;   DBIA  2053  FILE^DIE
"RTN","ICD1811",16,0)
 ;   DBIA 10141  BMES^XPDUTL, MES^XPDUTL
"RTN","ICD1811",17,0)
 ;
"RTN","ICD1811",18,0)
POST ;Post-Init
"RTN","ICD1811",19,0)
 K ^TMP("DIERR",$J)
"RTN","ICD1811",20,0)
 D IRO41917,DAN41641
"RTN","ICD1811",21,0)
 Q
"RTN","ICD1811",22,0)
 ;
"RTN","ICD1811",23,0)
IRO41917        ; gender issue
"RTN","ICD1811",24,0)
 N INFO,CODE,I,IEN,FDA,SEX,ALO,AHI
"RTN","ICD1811",25,0)
 F I=2:1 S INFO=$P($T(IRO+I),";;",2) Q:INFO']""  D
"RTN","ICD1811",26,0)
 . S CODE=$P(INFO,"^",1),IEN=(+$$CODEN^ICDCODE(CODE,80))_","
"RTN","ICD1811",27,0)
 . I IEN<0 D SHO("INVALID ICD9 CODE: "_CODE) Q
"RTN","ICD1811",28,0)
 . S SEX=$P(INFO,"^",2),FDA(80,IEN,9.5)=SEX
"RTN","ICD1811",29,0)
 . S ALO=$P(INFO,"^",3),FDA(80,IEN,14)=ALO
"RTN","ICD1811",30,0)
 . S AHI=$P(INFO,"^",4),FDA(80,IEN,15)=$S(AHI>99:"",1:AHI)
"RTN","ICD1811",31,0)
 . D FILE^DIE("K","FDA")
"RTN","ICD1811",32,0)
 . I $D(^TMP("DIERR",$J)) D
"RTN","ICD1811",33,0)
 . . S $P(^ICD9(+IEN,0),"^",10)=SEX,$P(^(0),"^",14,15)=ALO_"^"_AHI
"RTN","ICD1811",34,0)
 . . K ^TMP("DIERR",$J)
"RTN","ICD1811",35,0)
 Q
"RTN","ICD1811",36,0)
 ;
"RTN","ICD1811",37,0)
DAN41641        ; description issue
"RTN","ICD1811",38,0)
 N CODE,IEN,FDA
"RTN","ICD1811",39,0)
 S CODE=491.21,IEN=(+$$CODEN^ICDCODE(CODE,80))_","
"RTN","ICD1811",40,0)
 I IEN<0 D SHO("INVALID ICD9 CODE: "_CODE) Q
"RTN","ICD1811",41,0)
 S FDA(80,IEN,10)="OBSTRUCTIVE CHRONIC BRONCHITIS, WITH (ACUTE) EXACERBATION"
"RTN","ICD1811",42,0)
 D FILE^DIE("K","FDA")
"RTN","ICD1811",43,0)
 I $D(^TMP("DIERR",$J)) D
"RTN","ICD1811",44,0)
 . D BMES^XPDUTL("Unable to alter description for ICD9 Code: "_CODE)
"RTN","ICD1811",45,0)
 . K ^TMP("DIERR",$J)
"RTN","ICD1811",46,0)
 Q
"RTN","ICD1811",47,0)
 ;
"RTN","ICD1811",48,0)
SHO(M1,M2)      ;show messages
"RTN","ICD1811",49,0)
 N STARS
"RTN","ICD1811",50,0)
 S STARS="<<< *************************************  >>>"
"RTN","ICD1811",51,0)
 D BMES^XPDUTL(STARS)
"RTN","ICD1811",52,0)
 D MES^XPDUTL("  "_M1)
"RTN","ICD1811",53,0)
 D:$G(M2)]"" MES^XPDUTL("  "_M2)
"RTN","ICD1811",54,0)
 D MES^XPDUTL(STARS)
"RTN","ICD1811",55,0)
 Q
"RTN","ICD1811",56,0)
 ;
"RTN","ICD1811",57,0)
IRO ;data for IRO-1003-41917, LON-1003-62093
"RTN","ICD1811",58,0)
 Q  ;Not an entry point
"RTN","ICD1811",59,0)
 ;;600.00^M^15^124
"RTN","ICD1811",60,0)
 ;;600.01^M^15^124
"RTN","ICD1811",61,0)
 ;;600.10^M^15^124
"RTN","ICD1811",62,0)
 ;;600.11^M^15^124
"RTN","ICD1811",63,0)
 ;;600.20^M^15^124
"RTN","ICD1811",64,0)
 ;;600.21^M^15^124
"RTN","ICD1811",65,0)
 ;;600.90^M^15^124
"RTN","ICD1811",66,0)
 ;;600.91^M^15^124
"RTN","ICD1811",67,0)
 ;;607.85^M^15^124
"RTN","ICD1811",68,0)
 ;;674.50^F^12^55
"RTN","ICD1811",69,0)
 ;;674.51^F^12^55
"RTN","ICD1811",70,0)
 ;;674.52^F^12^55
"RTN","ICD1811",71,0)
 ;;674.53^F^12^55
"RTN","ICD1811",72,0)
 ;;674.54^F^12^55
"RTN","ICD1811",73,0)
 ;;
"RTN","ICDAPIU")
0^1^B27530689
"RTN","ICDAPIU",1,0)
ICDAPIU ;DLS/DEK - ICD UTILITIES FOR APIS ; 04/28/2003
"RTN","ICDAPIU",2,0)
 ;;18.0;DRG Grouper;**6,11**;Oct 20, 2000
"RTN","ICDAPIU",3,0)
 ;
"RTN","ICDAPIU",4,0)
 ; External References
"RTN","ICDAPIU",5,0)
 ;   DBIA 10103  $$DT^XLFDT
"RTN","ICDAPIU",6,0)
 ;
"RTN","ICDAPIU",7,0)
DTBR(CDT,CS) ; Date Business Rules
"RTN","ICDAPIU",8,0)
 ; Input:
"RTN","ICDAPIU",9,0)
 ;   CDT - Code Date to check (FileMan format, default=Today)
"RTN","ICDAPIU",10,0)
 ;   CS - Code System (0:ICD, 1:CPT/HCPCS, 2:DRG, Default=0)
"RTN","ICDAPIU",11,0)
 ;
"RTN","ICDAPIU",12,0)
 ; Output:
"RTN","ICDAPIU",13,0)
 ;   If CDT < 2781001 and CS=0, use 2781001
"RTN","ICDAPIU",14,0)
 ;   If CDT < 2890101 and CS=1, use 2890101
"RTN","ICDAPIU",15,0)
 ;   If CDT < 2821001 and CS=2, use 2821001
"RTN","ICDAPIU",16,0)
 ;   If CDT is year only, use first of the year
"RTN","ICDAPIU",17,0)
 ;   If CDT is year and month only, use first of the month
"RTN","ICDAPIU",18,0)
 ;
"RTN","ICDAPIU",19,0)
 Q:'$G(CDT) $$DT^XLFDT ;nothing passed - use today
"RTN","ICDAPIU",20,0)
 Q:$L($P(CDT,"."))'=7 $$DT^XLFDT ;bad date format - use today
"RTN","ICDAPIU",21,0)
 N BRDAT ;Business rule date
"RTN","ICDAPIU",22,0)
 S CS=+$G(CS) S:CS>2!(CS<0) CS=0
"RTN","ICDAPIU",23,0)
 S BRDAT=+$P("2781001^2890101^2821001","^",CS+1)
"RTN","ICDAPIU",24,0)
 I CDT#10000=0 S CDT=CDT+101
"RTN","ICDAPIU",25,0)
 S:CDT#100=0 CDT=CDT+1
"RTN","ICDAPIU",26,0)
 Q $S(CDT<BRDAT:BRDAT,1:CDT)
"RTN","ICDAPIU",27,0)
 ;
"RTN","ICDAPIU",28,0)
MSG(CDT,CS) ; inform of code text inaccuracy
"RTN","ICDAPIU",29,0)
 ; Input:
"RTN","ICDAPIU",30,0)
 ;   CDT - Code Date to check (FileMan format, Default = today)
"RTN","ICDAPIU",31,0)
 ;   CS - Code System (0:ICD, 1:CPT/HCPCS, 2:DRG, 3:LEX, Default=0)
"RTN","ICDAPIU",32,0)
 ; Output: User Alert
"RTN","ICDAPIU",33,0)
 ;
"RTN","ICDAPIU",34,0)
 S CS=+$G(CS) S:CS>3!(CS<0) CS=0
"RTN","ICDAPIU",35,0)
 S CDT=$S($G(CDT)="":$$DT^XLFDT,1:$$DTBR(CDT,CS))
"RTN","ICDAPIU",36,0)
 N MSGTXT S MSGTXT="CODE TEXT MAY BE INACCURATE"
"RTN","ICDAPIU",37,0)
 ; On Date Text Versioning is Implemented (MSGDAT), code becomes:
"RTN","ICDAPIU",38,0)
 ; Q $S(CDT<MSGDAT:MSGTXT,1:"")
"RTN","ICDAPIU",39,0)
 I CS=3,CDT'<3031001 Q ""
"RTN","ICDAPIU",40,0)
 Q MSGTXT
"RTN","ICDAPIU",41,0)
 ;
"RTN","ICDAPIU",42,0)
STATCHK(CODE,CDT) ; Check Status of ICD Code
"RTN","ICDAPIU",43,0)
 ; Input:
"RTN","ICDAPIU",44,0)
 ;    CODE - ICD Code  REQUIRED
"RTN","ICDAPIU",45,0)
 ;    CDT - Date to screen against (FileMan format, default = today)
"RTN","ICDAPIU",46,0)
 ; Output:
"RTN","ICDAPIU",47,0)
 ;    2-Piece String containing the code's status
"RTN","ICDAPIU",48,0)
 ;    and the IEN if the code exists, else -1.
"RTN","ICDAPIU",49,0)
 ;    The following are possible outputs:
"RTN","ICDAPIU",50,0)
 ;         1^IEN    Active Code
"RTN","ICDAPIU",51,0)
 ;         0^IEN    Inactive Code
"RTN","ICDAPIU",52,0)
 ;         0^-1     Code not Found
"RTN","ICDAPIU",53,0)
 ;
"RTN","ICDAPIU",54,0)
 ; This API requires the ACT Cross-Reference
"RTN","ICDAPIU",55,0)
 ;     ^ICD9("ACT",<code>,<status>,<date>,<ien>)
"RTN","ICDAPIU",56,0)
 ;     ^ICD0("ACT",<code>,<status>,<date>,<ien>)
"RTN","ICDAPIU",57,0)
 ;
"RTN","ICDAPIU",58,0)
 N ICDC,ICDD,ICDIEN,ICDI,ICDA,ICDG,ICDR,X
"RTN","ICDAPIU",59,0)
 S ICDC=$G(CODE) Q:'$L(ICDC) "0^-1"
"RTN","ICDAPIU",60,0)
 ;    Case 1:  Not Valid                           0^-1
"RTN","ICDAPIU",61,0)
 ;             Fails Pattern Match for Code
"RTN","ICDAPIU",62,0)
 S CODE=$$CODEN^ICDCODE(CODE),ICDG=$P(CODE,"~",2),ICDIEN=+CODE
"RTN","ICDAPIU",63,0)
 Q:ICDIEN<1 "0^-1"
"RTN","ICDAPIU",64,0)
 ;    Case 2:  Never Active                        0^IEN
"RTN","ICDAPIU",65,0)
 ;             No Active/Inactive Date
"RTN","ICDAPIU",66,0)
 S ICDD=$S($G(CDT)="":$$DT^XLFDT,1:$$DTBR(CDT,1)),ICDD=CDT+.001
"RTN","ICDAPIU",67,0)
 S ICDR=$$ACTROOT(ICDG,ICDC,1,ICDD),ICDA=$O(@(ICDR_")"),-1)
"RTN","ICDAPIU",68,0)
 I '$L(ICDA) D  Q X
"RTN","ICDAPIU",69,0)
 . S ICDA=$O(@(ICDR_")")),X="0^-1" Q:'$L(ICDA)
"RTN","ICDAPIU",70,0)
 . S ICDR=$$ACTROOT(ICDG,ICDC,1,ICDA)
"RTN","ICDAPIU",71,0)
 . S ICDIEN=$O(@(ICDR_",0)")) S:+ICDIEN<1 ICDIEN=-1
"RTN","ICDAPIU",72,0)
 . S X="0^"_ICDIEN
"RTN","ICDAPIU",73,0)
 ;    Case 3:  Active, Never Inactive              1^IEN
"RTN","ICDAPIU",74,0)
 ;             Has an Activation Date
"RTN","ICDAPIU",75,0)
 ;             No Inactivation Date
"RTN","ICDAPIU",76,0)
 S ICDR=$$ACTROOT(ICDG,ICDC,0,ICDD),ICDI=$O(@(ICDR_")"),-1)
"RTN","ICDAPIU",77,0)
 I $L(ICDA),'$L(ICDI) D  Q X
"RTN","ICDAPIU",78,0)
 . S ICDR=$$ACTROOT(ICDG,ICDC,1,ICDA),ICDIEN=$O(@(ICDR_",0)"))
"RTN","ICDAPIU",79,0)
 . S X=$S(+ICDIEN=0:"0^-1",1:"1^"_ICDIEN)
"RTN","ICDAPIU",80,0)
 ;    Case 4:  Active, but later Inactivated       0^IEN
"RTN","ICDAPIU",81,0)
 ;             Has an Activation Date
"RTN","ICDAPIU",82,0)
 ;             Has an Inactivation Date
"RTN","ICDAPIU",83,0)
 I $L(ICDA),$L(ICDI),ICDI>ICDA,ICDI<ICDD D  Q X
"RTN","ICDAPIU",84,0)
 . S ICDR=$$ACTROOT(ICDG,ICDC,0,ICDI),ICDIEN=$O(@(ICDR_",0)"))
"RTN","ICDAPIU",85,0)
 . S X=$S(+ICDIEN=0:"0^-1",1:"0^"_ICDIEN)
"RTN","ICDAPIU",86,0)
 ;    Case 5:  Active, and not later Inactivated   1^IEN
"RTN","ICDAPIU",87,0)
 ;             Has an Activation Date
"RTN","ICDAPIU",88,0)
 ;             Has an Inactivation Date
"RTN","ICDAPIU",89,0)
 ;             Has a Newer Activation Date
"RTN","ICDAPIU",90,0)
 I $L(ICDA),$L(ICDI),ICDI'>ICDA D  Q X
"RTN","ICDAPIU",91,0)
 . S ICDR=$$ACTROOT(ICDG,ICDC,0,ICDI),ICDIEN=$O(@(ICDR_",1)"))
"RTN","ICDAPIU",92,0)
 . S X=$S(+$O(@(ICDR_",0)"))=0:"0^-1",1:"1^"_ICDIEN)
"RTN","ICDAPIU",93,0)
 ;    Case 6:  Fails Time Test                     0^-1
"RTN","ICDAPIU",94,0)
 Q ("0^"_$S(+($G(ICDIEN))>0:+($G(ICDIEN)),1:"-1"))
"RTN","ICDAPIU",95,0)
 ;
"RTN","ICDAPIU",96,0)
NEXT(CODE) ; Next ICD Code (active or inactive)
"RTN","ICDAPIU",97,0)
 ; Input:
"RTN","ICDAPIU",98,0)
 ;    CODE = ICD Code   REQUIRED
"RTN","ICDAPIU",99,0)
 ; Output:
"RTN","ICDAPIU",100,0)
 ;    The Next ICD Code, Null if none
"RTN","ICDAPIU",101,0)
 ;
"RTN","ICDAPIU",102,0)
 N ICDC,ICDG S ICDC=$G(CODE) Q:'$L(ICDC) ""
"RTN","ICDAPIU",103,0)
 Q:ICDC?1.9N ""  ;app passed an IEN
"RTN","ICDAPIU",104,0)
 S ICDG=$P($$CODEN^ICDCODE(ICDC),"~",2)
"RTN","ICDAPIU",105,0)
 Q:ICDG="INVALID CODE" ""
"RTN","ICDAPIU",106,0)
 S ICDC=$O(@(ICDG_"""BA"","""_ICDC_" "")"))
"RTN","ICDAPIU",107,0)
 Q $S(ICDC="":"",1:$E(ICDC,1,$L(ICDC)-1))
"RTN","ICDAPIU",108,0)
 ;
"RTN","ICDAPIU",109,0)
PREV(CODE) ; Previous ICD Code (active or inactive)
"RTN","ICDAPIU",110,0)
 ; Input:
"RTN","ICDAPIU",111,0)
 ;    CODE = ICD Code   REQUIRED
"RTN","ICDAPIU",112,0)
 ; Output:
"RTN","ICDAPIU",113,0)
 ;    The Previous ICD Code, Null if none
"RTN","ICDAPIU",114,0)
 ;
"RTN","ICDAPIU",115,0)
 N ICDC,ICDG
"RTN","ICDAPIU",116,0)
 S ICDC=$G(CODE) Q:'$L(ICDC) ""
"RTN","ICDAPIU",117,0)
 Q:ICDC?1.9N ""  ;app passed an IEN
"RTN","ICDAPIU",118,0)
 S ICDG=$P($$CODEN^ICDCODE(ICDC),"~",2)
"RTN","ICDAPIU",119,0)
 Q:ICDG="INVALID CODE" ""
"RTN","ICDAPIU",120,0)
 S ICDC=$O(@(ICDG_"""BA"","""_ICDC_" "")"),-1)
"RTN","ICDAPIU",121,0)
 Q $S(ICDC="":"",1:$E(ICDC,1,$L(ICDC)-1))
"RTN","ICDAPIU",122,0)
 ;
"RTN","ICDAPIU",123,0)
HIST(CODE,ARY)  ; Activation History
"RTN","ICDAPIU",124,0)
 ; Input:
"RTN","ICDAPIU",125,0)
 ;    CODE - ICD Code                     REQUIRED
"RTN","ICDAPIU",126,0)
 ;    .ARY - Array, passed by Reference   REQUIRED
"RTN","ICDAPIU",127,0)
 ;
"RTN","ICDAPIU",128,0)
 ; Output:    Mirrors ARY(0) (or, -1 on error)
"RTN","ICDAPIU",129,0)
 ;    ARY(0) = Number of Activation History Entries
"RTN","ICDAPIU",130,0)
 ;    ARY(<date>) = status    where: 1 is Active
"RTN","ICDAPIU",131,0)
 ;    ARY("IEN") = <ien>
"RTN","ICDAPIU",132,0)
 ;
"RTN","ICDAPIU",133,0)
 Q:$G(CODE)="" -1
"RTN","ICDAPIU",134,0)
 N ICDC,ICDI,ICDA,ICDN,ICDD,ICDG,ICDF
"RTN","ICDAPIU",135,0)
 S ICDI=$$CODEN^ICDCODE(CODE),ICDG=$P(ICDI,"~",2)
"RTN","ICDAPIU",136,0)
 S ICDI=+ICDI Q:ICDI<1 -1
"RTN","ICDAPIU",137,0)
 S ARY("IEN")=ICDI,ICDA="" M ICDA=@(ICDG_ICDI_",66)")
"RTN","ICDAPIU",138,0)
 K ICDA("B") S ARY(0)=+($P($G(ICDA(0)),"^",4))
"RTN","ICDAPIU",139,0)
 S:+ARY(0)=0 ARY(0)=-1 K:ARY(0)=-1 ARY("IEN")
"RTN","ICDAPIU",140,0)
 S (ICDI,ICDC)=0 F  S ICDI=$O(ICDA(ICDI)) Q:+ICDI=0  D
"RTN","ICDAPIU",141,0)
 . S ICDD=$P($G(ICDA(ICDI,0)),"^",1) Q:+ICDD=0
"RTN","ICDAPIU",142,0)
 . S ICDF=$P($G(ICDA(ICDI,0)),"^",2) Q:'$L(ICDF)
"RTN","ICDAPIU",143,0)
 . S ICDC=ICDC+1,ARY(0)=ICDC,ARY(ICDD)=ICDF
"RTN","ICDAPIU",144,0)
 Q ARY(0)
"RTN","ICDAPIU",145,0)
 ;
"RTN","ICDAPIU",146,0)
PERIOD(CODE,ARY) ; return Activation/Inactivation Period in ARY
"RTN","ICDAPIU",147,0)
 ; Input:
"RTN","ICDAPIU",148,0)
 ;    CODE - ICD Code                     REQUIRED
"RTN","ICDAPIU",149,0)
 ;    .ARY - Array, passed by Reference   REQUIRED
"RTN","ICDAPIU",150,0)
 ; Output:
"RTN","ICDAPIU",151,0)
 ;    ARY(0) = IEN^Selectable
"RTN","ICDAPIU",152,0)
 ;       Where IEN = -1 if error
"RTN","ICDAPIU",153,0)
 ;             Selectable = 0 for VA Only codes
"RTN","ICDAPIU",154,0)
 ;    ARY(Act_date) = Inactivation Date^Short Name Text
"RTN","ICDAPIU",155,0)
 ;
"RTN","ICDAPIU",156,0)
 I $G(CODE)="" S ARY(0)="-1^0" Q
"RTN","ICDAPIU",157,0)
 N ICDC,ICDI,ICDA,ICDG,ICDF,ICDBA,ICDBI,ICDST,ICDS,ICDZ
"RTN","ICDAPIU",158,0)
 S ICDC=$$CODEN^ICDCODE(CODE),ICDG=$P(ICDC,"~",2),ICDC=+ICDC
"RTN","ICDAPIU",159,0)
 I ICDC<1 S ARY(0)="-1^0" Q
"RTN","ICDAPIU",160,0)
 S ICDI=$S(ICDG="^ICD9(":3,1:4),ICDZ=$G(@(ICDG_ICDC_",0)"))
"RTN","ICDAPIU",161,0)
 S ICDS=$P(ICDZ,"^",ICDI),ARY(0)=ICDC_"^"_'$P(ICDZ,"^",8)
"RTN","ICDAPIU",162,0)
 S (ICDA,ICDBA)=0,ICDG=ICDG_ICDC_",66,"
"RTN","ICDAPIU",163,0)
 F  Q:ICDBA  D
"RTN","ICDAPIU",164,0)
 . S ICDA=$O(@(ICDG_"""B"","_ICDA_")"))
"RTN","ICDAPIU",165,0)
 . I ICDA="" S ICDBA=1 Q
"RTN","ICDAPIU",166,0)
 . S ICDF=$O(@(ICDG_"""B"","_ICDA_",0)"))
"RTN","ICDAPIU",167,0)
 . I '+ICDF S ICDBA=1 Q
"RTN","ICDAPIU",168,0)
 . S ICDST=$P($G(@(ICDG_ICDF_",0)")),"^",2)
"RTN","ICDAPIU",169,0)
 . Q:'ICDST  ;outer loop looks for active
"RTN","ICDAPIU",170,0)
 . S ARY(ICDA)="^"_ICDS,ICDBI=0,ICDI=ICDA
"RTN","ICDAPIU",171,0)
 . F  Q:ICDBI  D
"RTN","ICDAPIU",172,0)
 . . S ICDI=$O(@(ICDG_"""B"","_ICDI_")"))
"RTN","ICDAPIU",173,0)
 . . I ICDI="" S (ICDBI,ICDBA)=1 Q
"RTN","ICDAPIU",174,0)
 . . S ICDF=$O(@(ICDG_"""B"","_ICDI_",0)"))
"RTN","ICDAPIU",175,0)
 . . I '+ICDF S (ICDBI,ICDBA)=1 Q
"RTN","ICDAPIU",176,0)
 . . S ICDST=$P($G(@(ICDG_ICDF_",0)")),"^",2)
"RTN","ICDAPIU",177,0)
 . . I ICDST S ICDBI=1 Q  ;inner loop looks for inactive
"RTN","ICDAPIU",178,0)
 . . S $P(ARY(ICDA),"^")=ICDI,ICDBI=1,ICDA=ICDI
"RTN","ICDAPIU",179,0)
 Q
"RTN","ICDAPIU",180,0)
 ;
"RTN","ICDAPIU",181,0)
ACTROOT(ICDG,ICDC,ICDS,ICDD) ; return "ACT" root
"RTN","ICDAPIU",182,0)
 Q ICDG_"""ACT"","""_ICDC_" "","_ICDS_","_ICDD
"RTN","ICDUPDT")
0^2^B196286
"RTN","ICDUPDT",1,0)
ICDUPDT ;DLS/DEK/KER - ICD Update Protocol for ICD Codes ; 10/22/2003
"RTN","ICDUPDT",2,0)
 ;;18.0;DRG Grouper;**6,11**;Oct 20, 2000
"RTN","ICDUPDT",3,0)
 ;
"RTN","ICDUPDT",4,0)
 ; Quit Update if NOT ICD Diagnosis/Procedure Related 
"RTN","ICDUPDT",5,0)
 ;
"RTN","ICDUPDT",6,0)
 ;   XQORQUIT  Signals the Unwinder to not process 
"RTN","ICDUPDT",7,0)
 ;             any protocols that are subordinate to 
"RTN","ICDUPDT",8,0)
 ;             the current protocol.  Control is passed
"RTN","ICDUPDT",9,0)
 ;             to the next sibling protocol.
"RTN","ICDUPDT",10,0)
 ;
"RTN","ICDUPDT",11,0)
 S:'$D(LEXSCHG(757.9,"B",80))&('$D(LEXSCHG(757.9,"B",80.1))) XQORQUIT=1
"RTN","ICDUPDT",12,0)
 Q
"VER")
8.0^22.0
**END**
**END**
