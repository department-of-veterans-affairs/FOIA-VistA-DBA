Released GMTS*2.7*31 SEQ #31
Extracted from mail message
**KIDS**:GMTS*2.7*31^

**INSTALL NAME**
GMTS*2.7*31
"BLD",1572,0)
GMTS*2.7*31^HEALTH SUMMARY^0^2991007^y
"BLD",1572,1,0)
^^2^2^2990728^^
"BLD",1572,1,1,0)
The description of this patch may be found on the National Patch Module 
"BLD",1572,1,2,0)
under GMTS*2.7*31.
"BLD",1572,4,0)
^9.64PA^^
"BLD",1572,"ABPKG")
n
"BLD",1572,"INID")
^
"BLD",1572,"INIT")

"BLD",1572,"KRN",0)
^9.67PA^19^18
"BLD",1572,"KRN",.4,0)
.4
"BLD",1572,"KRN",.401,0)
.401
"BLD",1572,"KRN",.402,0)
.402
"BLD",1572,"KRN",.403,0)
.403
"BLD",1572,"KRN",.5,0)
.5
"BLD",1572,"KRN",.84,0)
.84
"BLD",1572,"KRN",3.6,0)
3.6
"BLD",1572,"KRN",3.8,0)
3.8
"BLD",1572,"KRN",9.2,0)
9.2
"BLD",1572,"KRN",9.8,0)
9.8
"BLD",1572,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",1572,"KRN",9.8,"NM",1,0)
GMTSU^^0^B13669938
"BLD",1572,"KRN",9.8,"NM",2,0)
GMTS^^0^B27339255
"BLD",1572,"KRN",9.8,"NM",3,0)
GMTSADHC^^0^B18705165
"BLD",1572,"KRN",9.8,"NM",4,0)
GMTSDVR^^0^B33316785
"BLD",1572,"KRN",9.8,"NM","B","GMTS",2)

"BLD",1572,"KRN",9.8,"NM","B","GMTSADHC",3)

"BLD",1572,"KRN",9.8,"NM","B","GMTSDVR",4)

"BLD",1572,"KRN",9.8,"NM","B","GMTSU",1)

"BLD",1572,"KRN",19,0)
19
"BLD",1572,"KRN",19,"NM",0)
^9.68A^^
"BLD",1572,"KRN",19.1,0)
19.1
"BLD",1572,"KRN",101,0)
101
"BLD",1572,"KRN",409.61,0)
409.61
"BLD",1572,"KRN",771,0)
771
"BLD",1572,"KRN",869.2,0)
869.2
"BLD",1572,"KRN",870,0)
870
"BLD",1572,"KRN",8994,0)
8994
"BLD",1572,"KRN","B",.4,.4)

"BLD",1572,"KRN","B",.401,.401)

"BLD",1572,"KRN","B",.402,.402)

"BLD",1572,"KRN","B",.403,.403)

"BLD",1572,"KRN","B",.5,.5)

"BLD",1572,"KRN","B",.84,.84)

"BLD",1572,"KRN","B",3.6,3.6)

"BLD",1572,"KRN","B",3.8,3.8)

"BLD",1572,"KRN","B",9.2,9.2)

"BLD",1572,"KRN","B",9.8,9.8)

"BLD",1572,"KRN","B",19,19)

"BLD",1572,"KRN","B",19.1,19.1)

"BLD",1572,"KRN","B",101,101)

"BLD",1572,"KRN","B",409.61,409.61)

"BLD",1572,"KRN","B",771,771)

"BLD",1572,"KRN","B",869.2,869.2)

"BLD",1572,"KRN","B",870,870)

"BLD",1572,"KRN","B",8994,8994)

"BLD",1572,"QUES",0)
^9.62^^
"BLD",1572,"REQB",0)
^9.611^2^1
"BLD",1572,"REQB",2,0)
GMTS*2.7*30^2
"BLD",1572,"REQB","B","GMTS*2.7*30",2)

"MBREQ")
0
"PKG",187,-1)
1^1
"PKG",187,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",187,20,0)
^9.402P^^
"PKG",187,22,0)
^9.49I^1^1
"PKG",187,22,1,0)
2.7^2951020^2960308
"PKG",187,22,1,"PAH",1,0)
31^2991007^1118
"PKG",187,22,1,"PAH",1,1,0)
^^2^2^2991007
"PKG",187,22,1,"PAH",1,1,1,0)
The description of this patch may be found on the National Patch Module 
"PKG",187,22,1,"PAH",1,1,2,0)
under GMTS*2.7*31.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","GMTS")
0^2^B27339255
"RTN","GMTS",1,0)
GMTS ; SLC/KER - Health Summary Main Routine ; 07/31/1999
"RTN","GMTS",2,0)
 ;;2.7;Health Summary;**16,24,28,30,31**;Oct 20, 1995
"RTN","GMTS",3,0)
 ;
"RTN","GMTS",4,0)
MAIN ; Controls branching
"RTN","GMTS",5,0)
 ; GMTSPXGO & GMRANGE are set in 2 calling options, They aren't meant
"RTN","GMTS",6,0)
 ; to be used together.
"RTN","GMTS",7,0)
 I +$G(GMTSPXGO)'>0,$L($T(PATIENT^ORU1)),($$VERSION^XPDUTL("OR")>2.19) D MAIN^GMTSDVR Q
"RTN","GMTS",8,0)
 N DIROUT,DUOUT,ZTRTN,GMTSPX1,GMTSPX2,GMNAME,GMPSAP
"RTN","GMTS",9,0)
 S GMTSTYP=0 K DIC,DIROUT,DUOUT
"RTN","GMTS",10,0)
 S DIC("B")=$P($G(^GMT(142,+$G(^DISV(+$G(DUZ),"^GMT(142,")),0)),U)
"RTN","GMTS",11,0)
 F  Q:$D(DIROUT)!$D(DUOUT)  D SELTYP Q:GMTSTYP'>0!$D(DIROUT)!$D(DUOUT)  D
"RTN","GMTS",12,0)
 . N GMPAT,DFN,GMTSMULT
"RTN","GMTS",13,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DIROUT)!$D(DUOUT)!(+$D(GMPAT)'>0)!+$G(ORVP)
"RTN","GMTS",14,0)
 . . K GMPAT,DFN
"RTN","GMTS",15,0)
 . . I +$G(ORVP) D
"RTN","GMTS",16,0)
 . . . S (DFN,GMPAT(1))=+ORVP,GMNAME=$P($G(^DPT(+DFN,0)),U) Q:GMNAME=""  S GMPATT(GMNAME,DFN)="",(GMTSPX1,GMTSPX2)=""
"RTN","GMTS",17,0)
 . . . W !!,"For patient ",GMNAME," please answer the following."
"RTN","GMTS",18,0)
 . . . I +$G(GMTSPXGO)>0 D MENU^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1)
"RTN","GMTS",19,0)
 . . . I $G(GMTSPX1)']""!($G(GMTSPX2)']"") S DIROUT=1 K GMPAT,GMPATT Q
"RTN","GMTS",20,0)
 . . . Q:$D(DIROUT)  S GMPAT(GMNAME_(9999999-GMTSPX1),+DFN)=+DFN_U_$G(GMTSPX1)_U_$G(GMTSPX2)
"RTN","GMTS",21,0)
 . . I '(+($G(ORVP))) F  Q:$D(DIROUT)  K GMPATT D SELPT Q:$D(DIROUT)!('$D(GMPATT))  S GMNAME="" F  S GMNAME=$O(GMPATT(GMNAME)) Q:GMNAME=""!$D(DIROUT)  F DFN=0:0 S DFN=$O(GMPATT(GMNAME,DFN)) Q:DFN=""  D  Q:$D(DIROUT)
"RTN","GMTS",22,0)
 . . . S (GMTSPX1,GMTSPX2)="" W !!,"For patient ",GMNAME," please answer the following."
"RTN","GMTS",23,0)
 . . . I +$G(GMTSPXGO)>0 D MENU^GMTSPXU2(DFN,.GMTSPX2,.GMTSPX1) I $G(GMTSPX1)']""!($G(GMTSPX2)']"") Q
"RTN","GMTS",24,0)
 . . . Q:$D(DIROUT)
"RTN","GMTS",25,0)
 . . . S GMPAT(GMNAME_(9999999-GMTSPX1),+DFN)=+DFN_U_$G(GMTSPX1)_U_$G(GMTSPX2)
"RTN","GMTS",26,0)
 . . Q:$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTS",27,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX1,.GMTSPX2) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTS",28,0)
 . . Q:$D(DIROUT)
"RTN","GMTS",29,0)
 . . D RESUB^GMTSDVR(.GMPAT)
"RTN","GMTS",30,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DTOUT)
"RTN","GMTS",31,0)
 . . S ZTRTN="PQ^GMTS"
"RTN","GMTS",32,0)
 . . D HSOUT^GMTSDVR,END W !
"RTN","GMTS",33,0)
 K GMTSTYP,GMTSTITL,GMTSEG,GMTSEGI,GMTSEGC,GMX,DFN,X,Y,I,GMP,GMPATT
"RTN","GMTS",34,0)
 Q
"RTN","GMTS",35,0)
SELTYP ; Select a Health Summary Type for printing
"RTN","GMTS",36,0)
 Q:GMTSTYP=-1  S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTS",37,0)
 S Y=$$TYPE^GMTSULT K DIC S GMTSTYP=+Y,GMTSTITL=$S($D(^GMT(142,+Y,"T")):^("T"),1:"") S:GMTSTITL="" GMTSTITL=$P(Y,"^",2)
"RTN","GMTS",38,0)
 I GMTSTYP>0,$S($D(^GMT(142,GMTSTYP,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"This Summary Type includes no components...Please choose another." G SELTYP
"RTN","GMTS",39,0)
SELTYP1 ; Loop through HS Type and call LOADSEG to get each component record
"RTN","GMTS",40,0)
 K GMTSEG,GMTSEGI S (GMI,S1)=0 F  S S1=$O(^GMT(142,GMTSTYP,1,S1)) Q:'S1  S GMX=^(S1,0) D LOADSEG
"RTN","GMTS",41,0)
 S GMTSEGC=GMI K S1,S2,GMI
"RTN","GMTS",42,0)
 Q
"RTN","GMTS",43,0)
LOADSEG ; Load ENABLED COMPONENTS into GMTSEG array
"RTN","GMTS",44,0)
 S GMTS0=^GMT(142.1,$P(GMX,"^",2),0)
"RTN","GMTS",45,0)
 S GMI=GMI+1,GMTSEG(GMI)=GMX,GMTSEGI($P(GMX,U,2))=GMI D SELFILE
"RTN","GMTS",46,0)
 Q
"RTN","GMTS",47,0)
SELPT ; Select a patient for printing of Health Summary
"RTN","GMTS",48,0)
 N DUOUT,GMTSPRO,GMTSVER K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP
"RTN","GMTS",49,0)
 S GMTSVER=+($$VERSION^XPDUTL("OR")),GMTSPRO=+($$PROK^GMTSU("ORU1",11))
"RTN","GMTS",50,0)
 D:+GMTSVER>2.9&(GMTSPRO) PATIENT^ORU1(.GMP,,"I  $P($G(^(""OOS"")),""^"")")
"RTN","GMTS",51,0)
 D:+GMTSVER'>2.9!('GMTSPRO) PATIENT^ORU1(.GMP)
"RTN","GMTS",52,0)
 D PATCOPY^GMTSDVR(.GMP,.GMPATT)
"RTN","GMTS",53,0)
 Q
"RTN","GMTS",54,0)
SELFILE ; Loop through SELECTION ITEM multiple and load GMTSEG( with ITEMS
"RTN","GMTS",55,0)
 S S2=0 F  S S2=$O(^GMT(142,GMTSTYP,1,S1,1,S2)) Q:'S2  S ENTRY=^(S2,0),GMTSEG(GMI,+$P(@(U_$P(ENTRY,";",2)_"0)"),U,2),S2)=$P(ENTRY,";") I S2=1 S GMTSEG(GMI,+$P(@(U_$P(ENTRY,";",2)_"0)"),U,2),0)=U_$P(ENTRY,";",2)
"RTN","GMTS",56,0)
 Q
"RTN","GMTS",57,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTS",58,0)
 N DFN,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTS",59,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTS",60,0)
 N TRFAC,VAERR,VAIN
"RTN","GMTS",61,0)
 S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTS",62,0)
 . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTS",63,0)
 . I +$G(GMTSPXGO)>0 S GMTSPX1=$P($G(GMPAT(GMTJ)),U,2) D
"RTN","GMTS",64,0)
 . . S GMTSPX2=$P($G(GMPAT(GMTJ)),U,3)
"RTN","GMTS",65,0)
 . . I +GMTSPX1'>0!+GMTSPX2'>0 K GMTSPX1,GMTSPX2
"RTN","GMTS",66,0)
 . N GMDUOUT
"RTN","GMTS",67,0)
 . D EN^GMTS1
"RTN","GMTS",68,0)
 . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTS",69,0)
 . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTS",70,0)
 Q
"RTN","GMTS",71,0)
HSOUT ; Output Summary, with DEVICE handling
"RTN","GMTS",72,0)
 K ZTSK
"RTN","GMTS",73,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D EN^GMTS1 Q
"RTN","GMTS",74,0)
 K IOP S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTS",75,0)
 G:$D(IO("Q")) QUE
"RTN","GMTS",76,0)
NOQUE ; Print non-queued output to selected device
"RTN","GMTS",77,0)
 D EN^GMTS1
"RTN","GMTS",78,0)
 D ^%ZISC
"RTN","GMTS",79,0)
 Q
"RTN","GMTS",80,0)
QUE ; Call TaskMan to Queue output
"RTN","GMTS",81,0)
 K IO("Q"),ZTSAVE F %="DFN","GMTS*","ENTRY" S ZTSAVE(%)=""
"RTN","GMTS",82,0)
 S ZTRTN="EN^GMTS1",ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTS",83,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTS",84,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTS",85,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTS",86,0)
 Q
"RTN","GMTS",87,0)
END ; Clean up environmental variables and EXIT Health Summary
"RTN","GMTS",88,0)
 K %T,DIC,GMTS,GMTSLO,GMTSPNM,GMTSRB,GMTSWARD,GMTSDOB,DIC,X,Y,VA,VAIN,VAINDT,VADM,VAEL,VAPA,VAERR,GMTSSN,GMTS0,GMTS1,GMTS2
"RTN","GMTS",89,0)
 K GMTSAGE,GMTSTIM,GMTSEGN,GMTSEGH,GMTSEGL,GMTSHDR,GMTSNPG,GMTSPG,GMTSQIT,GMTSX,ENTRY,Z1,GMTSDTM,GMTSLOCK,GMTSLPG,SEX,POP,C,GMTSTOF
"RTN","GMTS",90,0)
 Q
"RTN","GMTS",91,0)
ENCWA ;Entry point printing components
"RTN","GMTS",92,0)
 ;GMTSPRM can be set to any component abbreviations except ones that 
"RTN","GMTS",93,0)
 ;require selection items. Needs to be valid component abbreviation 
"RTN","GMTS",94,0)
 ;from the "C" x-ref of File 142.1.
"RTN","GMTS",95,0)
 ;
"RTN","GMTS",96,0)
 ;call with DFN,GMTSPRM="CD,CN,CW,ADR",GMTSTITL="TITLE"
"RTN","GMTS",97,0)
 ;          GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTS",98,0)
 ;          GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTS",99,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTS",100,0)
 ;        is desired.
"RTN","GMTS",101,0)
 N GMI,GMJ,GMTSEG,GMTSEGI,GMTSEGC
"RTN","GMTS",102,0)
 S GMTS1="9999999",GMTS2="6666666",GMI=0,GMTSPNF=1
"RTN","GMTS",103,0)
 I '$D(GMTSPRM) W !,"The parameter GMTSPRM is undefined.",! Q
"RTN","GMTS",104,0)
 I '$D(GMTSTITL) W !,"The parameter GMTSTITL is undefined.",! Q
"RTN","GMTS",105,0)
 I '+$G(DFN) W !,"The parameter DFN is undefined.",! Q
"RTN","GMTS",106,0)
 F GMJ=1:1:$L(GMTSPRM,",") S ABB=$P(GMTSPRM,",",GMJ) D LOAD Q:GMJ=-1
"RTN","GMTS",107,0)
 S GMTSEGC=GMI K ABB,IFN
"RTN","GMTS",108,0)
 D EN^GMTS1
"RTN","GMTS",109,0)
 D END K GMTSEG,GMTSEGI,GMTSEGC,GMTSTITL,GMTSPRM,GMTSPNF
"RTN","GMTS",110,0)
 Q
"RTN","GMTS",111,0)
LOAD ; Load GMTSEG() using GMTSPRM abbreviations
"RTN","GMTS",112,0)
 S IFN=$O(^GMT(142.1,"C",ABB,"")) Q:IFN=""
"RTN","GMTS",113,0)
 S GMI=GMI+1,GMTSEG(GMI)=GMI_"^"_IFN,GMTSEGI(IFN)=GMI
"RTN","GMTS",114,0)
 Q
"RTN","GMTSADHC")
0^3^B18705165
"RTN","GMTSADHC",1,0)
GMTSADHC ; SLC/JER,KER - Ad Hoc Summary Driver ; 07/31/1999
"RTN","GMTSADHC",2,0)
 ;;2.7;Health Summary;**6,27,28,30,31**;Oct 20, 1995
"RTN","GMTSADHC",3,0)
MAIN N I,XQORSPEW
"RTN","GMTSADHC",4,0)
 S DIC=142,DIC(0)="MZF",X="GMTS HS ADHOC OPTION"
"RTN","GMTSADHC",5,0)
 S Y=$$TYPE^GMTSULT K DIC Q:+Y'>0  S GMTSTYP=+Y,GMTSTITL="AD HOC"
"RTN","GMTSADHC",6,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!'$D(GMTSEG)
"RTN","GMTSADHC",7,0)
 . K GMTSEG,GMTSEGI,GMTSEGC
"RTN","GMTSADHC",8,0)
 . D BUILD
"RTN","GMTSADHC",9,0)
 . Q:$D(DUOUT)!$D(DIROUT)!'$D(GMTSEG)
"RTN","GMTSADHC",10,0)
 . N GMPAT,GMP
"RTN","GMTSADHC",11,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)!+$G(ORVP)
"RTN","GMTSADHC",12,0)
 . . K GMP,GMPAT
"RTN","GMTSADHC",13,0)
 . . I +$G(ORVP) S GMPAT(1)=+ORVP
"RTN","GMTSADHC",14,0)
 . . E  F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PTPC Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,$P($G(^VA(200,DUZ,100.1)),U,6)]"":1,1:0)  D
"RTN","GMTSADHC",15,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSADHC",16,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSADHC",17,0)
 . . D RESUB^GMTSDVR(.GMPAT)
"RTN","GMTSADHC",18,0)
 . . S ZTRTN="PQ^GMTSADHC"
"RTN","GMTSADHC",19,0)
 . . W !
"RTN","GMTSADHC",20,0)
 . . D HSOUT^GMTSDVR
"RTN","GMTSADHC",21,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSADHC",22,0)
 Q
"RTN","GMTSADHC",23,0)
PTPC ; Combined Patient/Patient Copy
"RTN","GMTSADHC",24,0)
 N GMTSPRO,GMTSVER S GMTSVER=+($$VERSION^XPDUTL("OR")),GMTSPRO=+($$PROK^GMTSU("ORU1",11))
"RTN","GMTSADHC",25,0)
 D:GMTSVER>2.9&(GMTSPRO) PATIENT^ORU1(.GMP,,"I  $P($G(^(""OOS"")),""^"")")
"RTN","GMTSADHC",26,0)
 D:GMTSVER'>2.9!('GMTSPRO) PATIENT^ORU1(.GMP) D PATCOPY^GMTSDVR(.GMP,.GMPAT)
"RTN","GMTSADHC",27,0)
 Q
"RTN","GMTSADHC",28,0)
PQ ; Queued subroutine to print Ad Hoc HS for each patient
"RTN","GMTSADHC",29,0)
 N GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG
"RTN","GMTSADHC",30,0)
 N GMTSPHDR,GMTSPNM,GMTSRB,GMTSSN,GMTSTOF,GMTSWARD,VADM,VAERR,VAIN,VAROOT
"RTN","GMTSADHC",31,0)
 S GMPAT=0 F  S GMPAT=$O(GMPAT(GMPAT)) Q:GMPAT'>0  D  Q:$D(GMTSQIT)!$D(DIROUT)
"RTN","GMTSADHC",32,0)
 . S DFN=+$G(GMPAT(GMPAT)) D EN^GMTS1
"RTN","GMTSADHC",33,0)
 Q
"RTN","GMTSADHC",34,0)
BUILD ; Conducts Dialogue to build ad hoc summary
"RTN","GMTSADHC",35,0)
 N GMI,GMJ,X,XQORM,Y
"RTN","GMTSADHC",36,0)
 Q:$D(GMTSQIT)!($D(DIROUT))
"RTN","GMTSADHC",37,0)
 W @IOF
"RTN","GMTSADHC",38,0)
 S XQORM("S")="I $D(^GMT(142,DA(1),1,DA,0)),($P(^GMT(142.1,$P(^GMT(142,DA(1),1,DA,0),U,2),0),U,6)'=""T"")",XQORM("M")=6
"RTN","GMTSADHC",39,0)
 S XQORM=GMTSTYP_";GMT(142,",XQORM(0)="AD",XQORM("A")="Select NEW set of COMPONENT(S): ",XQORM("??")="D HELP^GMTSADH" D EN^XQORM I Y'>0 S GMTSQIT="" Q
"RTN","GMTSADHC",40,0)
 I +Y,(X?1"^^".E) D RJUMP^GMTSUP1 G BUILD
"RTN","GMTSADHC",41,0)
 S GMTSEGC=Y
"RTN","GMTSADHC",42,0)
 S (X,GMI,GMJ)=0 F  S GMI=$O(Y(GMI)) Q:'GMI  D LOAD
"RTN","GMTSADHC",43,0)
 D GETLIM^GMTSADH1
"RTN","GMTSADHC",44,0)
 Q
"RTN","GMTSADHC",45,0)
LOAD ; Load enabled components into GMTSEG
"RTN","GMTSADHC",46,0)
 N SREC,STRN
"RTN","GMTSADHC",47,0)
 S STRN=+Y(GMI),SREC=^GMT(142,GMTSTYP,1,STRN,0)
"RTN","GMTSADHC",48,0)
LOAD1 S GMJ=GMJ+1,GMTSEG(GMJ)=SREC,GMTSEGI($P(SREC,U,2))=GMJ D LOADSEL
"RTN","GMTSADHC",49,0)
 Q
"RTN","GMTSADHC",50,0)
LOADSEL ; Loads GMTSEG(J,FN,IFN), when Selection items are present
"RTN","GMTSADHC",51,0)
 N S2,SJ,SEL
"RTN","GMTSADHC",52,0)
 S S2=0,SJ=GMJ
"RTN","GMTSADHC",53,0)
 F  S S2=$O(^GMT(142,GMTSTYP,1,STRN,1,S2)) Q:'S2  S SEL=^(S2,0),GMTSEG(GMJ,+$P(@(U_$P(SEL,";",2)_"0)"),U,2),S2)=$P(SEL,";") I S2=1 S GMTSEG(SJ,+$P(@(U_$P(SEL,";",2)_"0)"),U,2),0)=U_$P(SEL,";",2)
"RTN","GMTSADHC",54,0)
 Q
"RTN","GMTSADHC",55,0)
HELP ; 
"RTN","GMTSADHC",56,0)
 N GMJ,GMTSTXT,HLP
"RTN","GMTSADHC",57,0)
 S HLP=$S(X="??":"HTX2",X="?":"HTX1",1:"") I $L(HLP) W ! F GMJ=1:1 S GMTSTXT=$T(@HLP+GMJ) Q:GMTSTXT["ZZZZ"  W !,$P(GMTSTXT,";",3,99)
"RTN","GMTSADHC",58,0)
 I X="???" W !! D HELP2^GMTSUP1
"RTN","GMTSADHC",59,0)
 D REDISP
"RTN","GMTSADHC",60,0)
 Q
"RTN","GMTSADHC",61,0)
REDISP ; Ask Whether or not to redisplay menu
"RTN","GMTSADHC",62,0)
 N I,DIR,X,Y
"RTN","GMTSADHC",63,0)
 S DIR(0)="Y",DIR("A")="Redisplay items",DIR("B")="YES" D ^DIR Q:'Y
"RTN","GMTSADHC",64,0)
 W @IOF
"RTN","GMTSADHC",65,0)
 D DISP^XQORM1 W !
"RTN","GMTSADHC",66,0)
 Q
"RTN","GMTSADHC",67,0)
HTX1 ;;Help Text for "?" and "??"
"RTN","GMTSADHC",68,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADHC",69,0)
 ;;
"RTN","GMTSADHC",70,0)
 ;;Enter: ??  to see HELP for MULTIPLE SELECTION
"RTN","GMTSADHC",71,0)
 ;;       ??? to see HELP for "^^"-jump
"RTN","GMTSADHC",72,0)
 ;;
"RTN","GMTSADHC",73,0)
 ;;ZZZZ
"RTN","GMTSADHC",74,0)
HTX2 ; HELP for ??
"RTN","GMTSADHC",75,0)
 ;;
"RTN","GMTSADHC",76,0)
 ;;The Health Summary components you select at this prompt create
"RTN","GMTSADHC",77,0)
 ;;an ADHOC Health Summary.
"RTN","GMTSADHC",78,0)
 ;;
"RTN","GMTSADHC",79,0)
 ;;Select ONE or MORE items from the menu, separated by commas.
"RTN","GMTSADHC",80,0)
 ;;
"RTN","GMTSADHC",81,0)
 ;;ALL items may be selected by typing "ALL".
"RTN","GMTSADHC",82,0)
 ;;
"RTN","GMTSADHC",83,0)
 ;;EXCEPTIONS may be entered by preceding them with a minus.
"RTN","GMTSADHC",84,0)
 ;;  For example, "ALL,-THIS,-THAT" selects all but "THIS" and "THAT".
"RTN","GMTSADHC",85,0)
 ;;
"RTN","GMTSADHC",86,0)
 ;;NOTE: Menu items are ordered alphabetically by the Component NAME.
"RTN","GMTSADHC",87,0)
 ;;      However, the displayed text is the Header Name which generally 
"RTN","GMTSADHC",88,0)
 ;;      is different from the Component Name. Component may be picked
"RTN","GMTSADHC",89,0)
 ;;      by their abbreviation, Header Name or Component Name.
"RTN","GMTSADHC",90,0)
 ;;
"RTN","GMTSADHC",91,0)
 ;;ZZZZ
"RTN","GMTSDVR")
0^4^B33316785
"RTN","GMTSDVR",1,0)
GMTSDVR ; SLC/JER,KER - Health Summary Driver ; 07/31/1999
"RTN","GMTSDVR",2,0)
 ;;2.7;Health Summary;**6,16,27,28,30,31**;Oct 20, 1995
"RTN","GMTSDVR",3,0)
MAIN ; Control branching
"RTN","GMTSDVR",4,0)
 N C,I,GMTYP,VADM,VAROOT,ZTRTN,GMPSAP
"RTN","GMTSDVR",5,0)
 K DIROUT,DUOUT
"RTN","GMTSDVR",6,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",7,0)
 . D SELTYP Q:$D(DUOUT)!$D(DIROUT)!($D(GMTYP)'>9)
"RTN","GMTSDVR",8,0)
 . N GMPAT,GMP
"RTN","GMTSDVR",9,0)
 . F  Q:$D(DIROUT)  D  Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)!(+($G(ORVP))>0)
"RTN","GMTSDVR",10,0)
 . . K GMP,GMPAT
"RTN","GMTSDVR",11,0)
 . . I +($G(ORVP)) S GMPAT(1)=+($G(ORVP))
"RTN","GMTSDVR",12,0)
 . . E  F  Q:$D(DIROUT)  K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP"),GMP D PTPC Q:$S($D(DUOUT):1,$D(DIROUT):1,'+$G(GMP):1,$P($G(^VA(200,DUZ,100.1)),U,6)]"":1,1:0)  D
"RTN","GMTSDVR",13,0)
 . . . W !!,"Another patient(s) can be selected."
"RTN","GMTSDVR",14,0)
 . . Q:$D(DUOUT)!$D(DIROUT)!(+$D(GMPAT)'>0)
"RTN","GMTSDVR",15,0)
 . . N GMTSPX1,GMTSPX2
"RTN","GMTSDVR",16,0)
 . . I +$G(GMRANGE)>0 D GETRANGE^GMTSU(.GMTSPX2,.GMTSPX1) Q:$G(GMTSPX1)=""!($G(GMTSPX2)="")
"RTN","GMTSDVR",17,0)
 . . Q:$D(DUOUT)!$D(DIROUT)
"RTN","GMTSDVR",18,0)
 . . D RESUB(.GMPAT)
"RTN","GMTSDVR",19,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSDVR",20,0)
 . . S ZTRTN="PQ^GMTSDVR"
"RTN","GMTSDVR",21,0)
 . . D HSOUT
"RTN","GMTSDVR",22,0)
 K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW"),^("ORLP")
"RTN","GMTSDVR",23,0)
 Q
"RTN","GMTSDVR",24,0)
PTPC ; Combined Patient/Patient Copy
"RTN","GMTSDVR",25,0)
 N GMTSPRO,GMTSVER S GMTSVER=+($$VERSION^XPDUTL("OR")),GMTSPRO=+($$PROK^GMTSU("ORU1",11))
"RTN","GMTSDVR",26,0)
 D:GMTSVER>2.9&(GMTSPRO) PATIENT^ORU1(.GMP,,"I  $P($G(^(""OOS"")),""^"")")
"RTN","GMTSDVR",27,0)
 D:GMTSVER'>2.9!('GMTSPRO) PATIENT^ORU1(.GMP) D PATCOPY^GMTSDVR(.GMP,.GMPAT)
"RTN","GMTSDVR",28,0)
 Q
"RTN","GMTSDVR",29,0)
PATCOPY(GMP,GMPAT) ;Copies patients retrieved from ^ORU1 in GMP array
"RTN","GMTSDVR",30,0)
 ;                to GMPAT array
"RTN","GMTSDVR",31,0)
 N IFN,GMDFN
"RTN","GMTSDVR",32,0)
 S IFN=0
"RTN","GMTSDVR",33,0)
 ; GMPAT(NAME,GMDFN) - want array in alphabetic order by patient
"RTN","GMTSDVR",34,0)
 F  S IFN=$O(GMP(IFN)) Q:IFN'>0  D
"RTN","GMTSDVR",35,0)
 . S GMDFN=+$G(GMP(IFN))
"RTN","GMTSDVR",36,0)
 . ; Getting name from ^DPT because name returned from ^ORUS sometimes
"RTN","GMTSDVR",37,0)
 . ; has trailing spaces which could allow duplicate recs for a patient
"RTN","GMTSDVR",38,0)
 . S GMPAT($P($G(^DPT(GMDFN,0)),U),+GMDFN)=+GMDFN
"RTN","GMTSDVR",39,0)
 Q
"RTN","GMTSDVR",40,0)
RESUB(GMP) ;Subscripts in GMP array are convert to one numeric subscript.
"RTN","GMTSDVR",41,0)
 ;        Done inorder to have GMP array in alphabetic order by patient.
"RTN","GMTSDVR",42,0)
 N NAME,GMDFN,CNT
"RTN","GMTSDVR",43,0)
 S CNT=0,NAME=""
"RTN","GMTSDVR",44,0)
 F  S NAME=$O(GMP(NAME)) Q:NAME']""  D
"RTN","GMTSDVR",45,0)
 . S GMDFN=0
"RTN","GMTSDVR",46,0)
 . F  S GMDFN=$O(GMP(NAME,GMDFN)) Q:GMDFN'>0  D
"RTN","GMTSDVR",47,0)
 . . S CNT=CNT+1
"RTN","GMTSDVR",48,0)
 . . S GMP(CNT)=GMP(NAME,GMDFN)
"RTN","GMTSDVR",49,0)
 . . K GMP(NAME,GMDFN)
"RTN","GMTSDVR",50,0)
 Q
"RTN","GMTSDVR",51,0)
ENXQ ; External call for tasked HS print
"RTN","GMTSDVR",52,0)
 ; Input: GMTSTYP=Record # of HS type in file 142
"RTN","GMTSDVR",53,0)
 ;            DFN=Record # of patient in file 2
"RTN","GMTSDVR",54,0)
 ;        GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTSDVR",55,0)
 ;        GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTSDVR",56,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTSDVR",57,0)
 ;        is desired.
"RTN","GMTSDVR",58,0)
 ; To call from TaskMan:
"RTN","GMTSDVR",59,0)
 ;        S ZTRTN="ENXQ^GMTSDVR",ZTSAVE("GMTSTYP")="",ZTSAVE("DFN")=""
"RTN","GMTSDVR",60,0)
 ;        D ^%ZTLOAD
"RTN","GMTSDVR",61,0)
 D ENX(DFN,GMTSTYP,$G(GMTSPX2),$G(GMTSPX1))
"RTN","GMTSDVR",62,0)
 Q
"RTN","GMTSDVR",63,0)
ENX(DFN,GMTSTYP,GMTSPX2,GMTSPX1) ; External call to print a Health Summary
"RTN","GMTSDVR",64,0)
 ; call with: GMTSTYP=HEALTH SUMMARY TYPE file record number
"RTN","GMTSDVR",65,0)
 ;                DFN=PATIENT file record number
"RTN","GMTSDVR",66,0)
 ;
"RTN","GMTSDVR",67,0)
 ;            GMTSPX1=Optional internal FM date for range ending date
"RTN","GMTSDVR",68,0)
 ;            GMTSPX2=Optional internal FM date for range beginning date
"RTN","GMTSDVR",69,0)
 ;  NOTE: Optional date range variables are both required if a date range
"RTN","GMTSDVR",70,0)
 ;        is desired.
"RTN","GMTSDVR",71,0)
 N DI,DX,DY,GMQUIT,GMTYP,GMPAT,VADM,VAIN,VAROOT
"RTN","GMTSDVR",72,0)
 F  Q:($D(^GMT(142,+GMTSTYP,1))>9)&$D(^DPT(DFN))!+$G(GMQUIT)  D
"RTN","GMTSDVR",73,0)
 . I $D(^GMT(142,+GMTSTYP,1))'>9 D
"RTN","GMTSDVR",74,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",75,0)
 . . W !?3,"Invalid HEALTH SUMMARY TYPE." D SELTYP S GMTSTYP=+$G(GMTYP(1))
"RTN","GMTSDVR",76,0)
 . I '$D(^DPT(DFN)) D
"RTN","GMTSDVR",77,0)
 . . I $D(ZTQUEUED) S GMQUIT=1 Q
"RTN","GMTSDVR",78,0)
 . . W !?3,"Invalid PATIENT ID." D PATIENT^ORU1(.GMPAT) S DFN=+$G(GMPAT(1))
"RTN","GMTSDVR",79,0)
 Q:+$G(GMQUIT)
"RTN","GMTSDVR",80,0)
 S:$D(GMTYP)'>9 GMTYP(0)=1,GMTYP(1)=+$G(GMTSTYP)_U_$P($G(^GMT(142,+GMTSTYP,0)),U)
"RTN","GMTSDVR",81,0)
 S:$D(GMPAT)'>9 GMPAT=1,GMPAT(0)=1,GMPAT(1)=DFN_U_$P($G(^DPT(DFN,0)),U)
"RTN","GMTSDVR",82,0)
 D PQ
"RTN","GMTSDVR",83,0)
 Q
"RTN","GMTSDVR",84,0)
SELTYP ; Select Health Summary Type(s)
"RTN","GMTSDVR",85,0)
 N DIC,X,Y
"RTN","GMTSDVR",86,0)
 S DIC=142,DIC("A")="Select Health Summary Type: ",DIC(0)="AEMQZ"
"RTN","GMTSDVR",87,0)
 S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSDVR",88,0)
 I $D(GMTYP)<10 S DIC("B")=$S($D(^DISV(DUZ,"^GMT(142,"))=10:$G(^DISV(DUZ,"^GMT(142,",$O(^("^GMT(142,",0)))),1:$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U))
"RTN","GMTSDVR",89,0)
 K GMTYP S Y=$$TYPE^GMTSULT Q:+Y'>0
"RTN","GMTSDVR",90,0)
 I $S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) W !,"The Summary Type "_$P(Y,U,2)_" includes no components...Please choose another",! Q
"RTN","GMTSDVR",91,0)
 S GMTYP(0)=1,GMTYP(1)=Y_U_$P(Y,U,2)_U_$P(Y,U,2)_U_$P(Y,U,2)
"RTN","GMTSDVR",92,0)
 Q
"RTN","GMTSDVR",93,0)
PQ ; Queued subroutine for HS by patient
"RTN","GMTSDVR",94,0)
 N DFN,GMTI,GMTS,GMTS1,GMTS2,GMTSAGE,GMTSDOB,GMTSDTM,GMTSLO,GMTSLPG,GMTSPNM
"RTN","GMTSDVR",95,0)
 N GMTSRB,GMTSSN,GMTSTOF,GMTSTYP,GMTSTITL,GMTSWARD,GMTJ,I,IX0,J,M4,P17,SEX
"RTN","GMTSDVR",96,0)
 N GMTSPHDR,TRFAC,VAERR,VAIN
"RTN","GMTSDVR",97,0)
 S GMTI=0 F  S GMTI=$O(GMTYP(GMTI)) Q:GMTI'>0!$D(DIROUT)  D
"RTN","GMTSDVR",98,0)
 .N GMTSEG,GMTSEGC,GMTSEGI
"RTN","GMTSDVR",99,0)
 .S GMTSTYP=+$G(GMTYP(GMTI)),GMTSTITL=$G(^GMT(142,+GMTSTYP,"T"))
"RTN","GMTSDVR",100,0)
 .S:'$L(GMTSTITL) GMTSTITL=$P(GMTYP(GMTI),U,2)
"RTN","GMTSDVR",101,0)
 .D LOADSEG
"RTN","GMTSDVR",102,0)
 .S GMTJ=0 F  S GMTJ=$O(GMPAT(GMTJ)) Q:GMTJ'>0!$D(DIROUT)  D
"RTN","GMTSDVR",103,0)
 . . S DFN=+$G(GMPAT(GMTJ))
"RTN","GMTSDVR",104,0)
 . . N GMDUOUT
"RTN","GMTSDVR",105,0)
 . . D EN^GMTS1
"RTN","GMTSDVR",106,0)
 . . Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSDVR",107,0)
 . . D ACTPROF^GMTSDVR(DFN)
"RTN","GMTSDVR",108,0)
 Q
"RTN","GMTSDVR",109,0)
LOADSEG ;LOAD ENABLED COMPONENTS INTO GMTSEG ARRAY
"RTN","GMTSDVR",110,0)
 N GMTI,GMTJ,GMX
"RTN","GMTSDVR",111,0)
 S (GMTI,GMTJ)=0 F  S GMTJ=$O(^GMT(142,GMTSTYP,1,GMTJ)) Q:GMTJ'>0  S GMX=^(GMTJ,0) D
"RTN","GMTSDVR",112,0)
 .S GMTI=GMTI+1,GMTSEG(GMTI)=GMX,GMTSEGI($P(GMX,U,2))=GMTI D SELFILE
"RTN","GMTSDVR",113,0)
 S GMTSEGC=GMTI
"RTN","GMTSDVR",114,0)
 Q
"RTN","GMTSDVR",115,0)
SELFILE ; Get Selection item information for GMTSEG(
"RTN","GMTSDVR",116,0)
 N GMTK,ITEM,FST
"RTN","GMTSDVR",117,0)
 S GMTK=0,FST=1
"RTN","GMTSDVR",118,0)
 F  S GMTK=$O(^GMT(142,GMTSTYP,1,GMTJ,1,GMTK)) Q:GMTK'>0  S ITEM=^(GMTK,0),GMTSEG(GMTI,+$P(@(U_$P(ITEM,";",2)_"0)"),U,2),GMTK)=$P(ITEM,";") I $G(FST) S GMTSEG(GMTI,+$P(@(U_$P(ITEM,";",2)_"0)"),U,2),0)=U_$P(ITEM,";",2) K FST
"RTN","GMTSDVR",119,0)
 Q
"RTN","GMTSDVR",120,0)
HSOUT ; Output summary, with device control
"RTN","GMTSDVR",121,0)
 ; Call with: ZTRTN
"RTN","GMTSDVR",122,0)
 I $D(^XUSEC("GMTS VIEW ONLY",DUZ)) D @ZTRTN Q
"RTN","GMTSDVR",123,0)
 N %ZIS,IOP
"RTN","GMTSDVR",124,0)
 S %ZIS="PQ" D ^%ZIS Q:POP
"RTN","GMTSDVR",125,0)
 G:$D(IO("Q")) QUE
"RTN","GMTSDVR",126,0)
NOQUE D @ZTRTN
"RTN","GMTSDVR",127,0)
 D ^%ZISC
"RTN","GMTSDVR",128,0)
 Q
"RTN","GMTSDVR",129,0)
QUE ; Queue output
"RTN","GMTSDVR",130,0)
 N %,ZTDESC,ZTDTH,ZTIO,ZTSAVE,ZTSK
"RTN","GMTSDVR",131,0)
 Q:'$D(ZTRTN)  K IO("Q"),ZTSAVE F %="DFN","GM*","ENTRY","O*" S ZTSAVE(%)=""
"RTN","GMTSDVR",132,0)
 S ZTDESC="HEALTH SUMMARY",ZTIO=ION
"RTN","GMTSDVR",133,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","GMTSDVR",134,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE D ^%ZISC
"RTN","GMTSDVR",135,0)
 S IOP="HOME" D ^%ZIS
"RTN","GMTSDVR",136,0)
 Q
"RTN","GMTSDVR",137,0)
ACTPROF(GMDFN) ; Check & print Action Profile for patient if +$G(GMPSAP)
"RTN","GMTSDVR",138,0)
 N DFN,PSTYPE,PSONOPG,PSOPAR,PSOINST
"RTN","GMTSDVR",139,0)
 I +$G(GMPSAP) D
"RTN","GMTSDVR",140,0)
 . S (PSTYPE,PSONOPG)=1,DFN=GMDFN
"RTN","GMTSDVR",141,0)
 . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSDVR",142,0)
 . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSDVR",143,0)
 . D DFN^PSOSD1
"RTN","GMTSDVR",144,0)
 . S DFN=GMDFN ;Have to reset DFN because ^PSOSD1 call kills it and it is
"RTN","GMTSDVR",145,0)
 . ; needed for the ^GMTSPL call.
"RTN","GMTSDVR",146,0)
 . D PAGE^GMTSPL
"RTN","GMTSU")
0^1^B13669938
"RTN","GMTSU",1,0)
GMTSU ; SLC/JER,KER/NDBI - Health Summary Utilities ; 07/31/1999
"RTN","GMTSU",2,0)
 ;;2.7;Health Summary;**27,28,31**;Oct 20, 1995
"RTN","GMTSU",3,0)
MTIM ;CONVERT TIME from X=2890313.1304 INTO X=13:04
"RTN","GMTSU",4,0)
 S X=$P(X,".",2) Q:'$L(X)
"RTN","GMTSU",5,0)
 S X=$S(X:$E(X,1,2)_$E("00",0,2-$L($E(X,1,2)))_":"_$E(X,3,4)_$E("00",0,2-$L($E(X,3,4))),1:"")
"RTN","GMTSU",6,0)
 Q
"RTN","GMTSU",7,0)
PROK(X,Y) ; Routine and Patch # OK (in UCI)
"RTN","GMTSU",8,0)
 N GMTS,GMTSI,GMTSO S X=$G(X),Y=$G(Y) Q:'$L(X) 0 Q:Y'=""&(+Y=0)
"RTN","GMTSU",9,0)
 S Y=+Y,GMTS=$$ROK(X) Q:'GMTS 0 Q:+Y=0 1 S GMTSO=0,GMTS=$T(@("+2^"_X)),GMTS=$P($P(GMTS,"**",2),"**",1)
"RTN","GMTSU",10,0)
 F GMTSI=1:1:$L(GMTS,",") S:+($P(GMTS,",",GMTSI))=Y GMTSO=1 Q:GMTSO=1
"RTN","GMTSU",11,0)
 S X=GMTSO Q X
"RTN","GMTSU",12,0)
ROK(X) ; Routine OK (in UCI) (NDBI)
"RTN","GMTSU",13,0)
 S X=$G(X) Q:'$L(X) 0 Q:$L(X)>8 0 X ^%ZOSF("TEST") Q:$T 1 Q 0
"RTN","GMTSU",14,0)
NDBI(X) ; National Database Integration site 1 = yes  0 = no
"RTN","GMTSU",15,0)
 N R,G S X="A7RDUP" X ^%ZOSF("TEST") S R=$T,G=$S($D(^A7RCP):1,1:0),X=R+G,X=$S(X=2:1,1:0) Q X
"RTN","GMTSU",16,0)
REGDT ; Receives X in internal date.time, and returns X in MM/DD/YY format
"RTN","GMTSU",17,0)
 S X=$TR($$FMTE^XLFDT(X,"2DZ"),"@"," ") Q
"RTN","GMTSU",18,0)
REGDT4 ; Receives X in internal date.time, and returns X in MM/DD/YYYY format
"RTN","GMTSU",19,0)
 S X=$TR($$FMTE^XLFDT(X,"5DZ"),"@"," ") Q
"RTN","GMTSU",20,0)
REGDTM ;Receives X in internal date.time, and returns X in MM/DD/YY TT:TT
"RTN","GMTSU",21,0)
 S X=$TR($$FMTE^XLFDT(X,"2ZM"),"@"," ") Q
"RTN","GMTSU",22,0)
REGDTM4 ;Receives X in internal date.time, and returns X in MM/DD/YYYY TT:TT
"RTN","GMTSU",23,0)
 S X=$TR($$FMTE^XLFDT(X,"5ZM"),"@"," ") Q
"RTN","GMTSU",24,0)
SIDT ; Receives X as internal date/time and returns X in DD MMM YY
"RTN","GMTSU",25,0)
 N MON,MM
"RTN","GMTSU",26,0)
 S X=$P(X,".") I 'X S X="" Q
"RTN","GMTSU",27,0)
 S MON="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"
"RTN","GMTSU",28,0)
 S MM=$E(X,4,5),MM=$S(MM:$P(MON,U,MM),1:"")
"RTN","GMTSU",29,0)
 S X=$E(X,6,7)_" "_MM_" "_$E(X,2,3)
"RTN","GMTSU",30,0)
 Q
"RTN","GMTSU",31,0)
FMHL7DTM ; Recieves X as internal date/time and returns X in CCYYMMDDHHMM
"RTN","GMTSU",32,0)
 N T
"RTN","GMTSU",33,0)
 S T=$P(X,".",2)
"RTN","GMTSU",34,0)
 S T=$S(T:$E(T,1,2)_$E("00",0,2-$L($E(T,1,2)))_$E(T,3,4)_$E("00",0,2-$L($E(T,3,4))),1:"0000")
"RTN","GMTSU",35,0)
 S X=($E($P(X,"."),1,3)+1700)_$E($P(X,"."),4,7)_T
"RTN","GMTSU",36,0)
 Q
"RTN","GMTSU",37,0)
HL7FMDTM ; Recieves X as CCYYMMDDHHMM and returns X as internal date/time
"RTN","GMTSU",38,0)
 N DATE,TIME
"RTN","GMTSU",39,0)
 S DATE=$E(X,1,8),TIME=$E(X,9,12)
"RTN","GMTSU",40,0)
 S DATE=DATE-17000000,X=DATE_"."_TIME
"RTN","GMTSU",41,0)
 Q
"RTN","GMTSU",42,0)
DEM ; Gets Demographic Data from VADPT
"RTN","GMTSU",43,0)
 ; Receives: DFN
"RTN","GMTSU",44,0)
 ; Returns: GMTSPNM,GMTSSN,GMTSDOB,SEX,GMTSWARD,GMTSRB,GMTSAGE
"RTN","GMTSU",45,0)
 K VAHOW D OERR^VADPT
"RTN","GMTSU",46,0)
 S GMTSPNM=VADM(1)
"RTN","GMTSU",47,0)
 S GMTSSN=$S($D(VA("PID")):VA("PID"),1:$P(VADM(2),"^",2))
"RTN","GMTSU",48,0)
 S GMTSAGE=$S(+VADM(4)>0:+VADM(4),1:99),SEX=$P(VADM(5),"^")
"RTN","GMTSU",49,0)
 S GMTSWARD=$P(VAIN(4),"^",2),GMTSRB=VAIN(5)
"RTN","GMTSU",50,0)
 S X=$P(VADM(3),"^") D REGDT4 S GMTSDOB=X
"RTN","GMTSU",51,0)
 K VA
"RTN","GMTSU",52,0)
 ;Establish the information for the patient header.
"RTN","GMTSU",53,0)
 K GMTSPHDR
"RTN","GMTSU",54,0)
 N DOB,LWARDRB,NMSSN,NMSSNE,WARDRB,WARDRBE,WARDRBS
"RTN","GMTSU",55,0)
 S NMSSN=GMTSPNM_"    "_GMTSSN
"RTN","GMTSU",56,0)
 S NMSSNE=$L(NMSSN)+2
"RTN","GMTSU",57,0)
 S WARDRB=GMTSWARD_" "_GMTSRB
"RTN","GMTSU",58,0)
 S LWARDRB=$L(WARDRB)
"RTN","GMTSU",59,0)
 S WARDRBS=40-(LWARDRB/2),WARDRBE=WARDRBS+LWARDRB
"RTN","GMTSU",60,0)
 S DOB="DOB: "_GMTSDOB
"RTN","GMTSU",61,0)
 S GMTSPHDR("NMSSN")=NMSSN
"RTN","GMTSU",62,0)
 S GMTSPHDR("WARDRB")=WARDRB
"RTN","GMTSU",63,0)
 S GMTSPHDR("WARDRBS")=WARDRBS
"RTN","GMTSU",64,0)
 S GMTSPHDR("DOB")=DOB
"RTN","GMTSU",65,0)
 S GMTSPHDR("DOBS")=64
"RTN","GMTSU",66,0)
 I (NMSSNE'<WARDRBS)!(WARDRBE'<64) S GMTSPHDR("TWO")=1
"RTN","GMTSU",67,0)
 Q
"RTN","GMTSU",68,0)
NAME ; Format names ;6/30/89  11:20 ;
"RTN","GMTSU",69,0)
 ; Recieves: FILE (3 for User, 16 for Person, 6 for Provider)
"RTN","GMTSU",70,0)
 ;           IFN (Internal file # for above file),
"RTN","GMTSU",71,0)
 ;           NML (Desired length for name to be returned)
"RTN","GMTSU",72,0)
 ;           FNF (Flag to specify first name format: 0 for FI, 1 for FN)
"RTN","GMTSU",73,0)
 ; Returns: Lastname,First(name/initial) to specified length as NM
"RTN","GMTSU",74,0)
 ;
"RTN","GMTSU",75,0)
 N DIC,RAWNM,LN,FN,FA,NI,CH,X,Y
"RTN","GMTSU",76,0)
 S DIC=FILE,DIC(0)="NXZ",X=IFN D ^DIC S RAWNM=$S($D(Y(0,0)):Y(0,0),1:"UNKNOWN")
"RTN","GMTSU",77,0)
 S LN=$P(RAWNM,","),FN=$P(RAWNM,",",2)
"RTN","GMTSU",78,0)
 S FA=0 I $L(FN) F NI=1:1 S CH=$E(FN,NI) Q:CH?1A  S FA=NI
"RTN","GMTSU",79,0)
 I FA S FN=$E(FN,FA+1,$L(FN))
"RTN","GMTSU",80,0)
 I 'FNF S FN=$E(FN,1)
"RTN","GMTSU",81,0)
 S NM=$S($L(FN):LN_","_FN,1:LN),NM=$E(NM,1,NML)
"RTN","GMTSU",82,0)
 K FILE,IFN,NML,FNF
"RTN","GMTSU",83,0)
 Q
"RTN","GMTSU",84,0)
GETRANGE(FROMDATE,TODATE) ; Selection by Date Range (from and to dates)
"RTN","GMTSU",85,0)
 ;      VARIABLES LIST (OUTPUT)
"RTN","GMTSU",86,0)
 ; FROMDATE = FROM DATE
"RTN","GMTSU",87,0)
 ; TODATE = TO DATE
"RTN","GMTSU",88,0)
 N DIR,X,Y,DTOUT,DIRUT S DIR(0)="DO^:DT",DIR("A")="Enter Beginning Date (MM/DD/YY)"
"RTN","GMTSU",89,0)
 W ! D ^DIR I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) W ! Q
"RTN","GMTSU",90,0)
 S FROMDATE=Y I +FROMDATE>0 D
"RTN","GMTSU",91,0)
 . W "  (",$$UP^XLFSTR($$FMTE^XLFDT(+FROMDATE,1)),")"
"RTN","GMTSU",92,0)
 . N DIR,X,Y
"RTN","GMTSU",93,0)
 . S DIR(0)="DO^::EX",DIR("A")="Enter Ending Date (MM/DD/YY)"
"RTN","GMTSU",94,0)
 . S DIR("B")="TODAY"
"RTN","GMTSU",95,0)
 . D ^DIR
"RTN","GMTSU",96,0)
 . I $D(DIROUT)!$D(DUOUT)!$D(DTOUT)!$D(DIRUT) K FROMDATE Q
"RTN","GMTSU",97,0)
 . I Y'>0 K FROMDATE Q
"RTN","GMTSU",98,0)
 . S TODATE=Y Q:TODATE>FROMDATE!(TODATE=FROMDATE) 
"RTN","GMTSU",99,0)
 . ; If 2nd date older than 1st date entered (Dates entered in reverse order)
"RTN","GMTSU",100,0)
 . N FRDT S FRDT=FROMDATE,FROMDATE=TODATE,TODATE=FRDT
"RTN","GMTSU",101,0)
 W !
"RTN","GMTSU",102,0)
 Q
"VER")
8.0^22.0
**END**
**END**
