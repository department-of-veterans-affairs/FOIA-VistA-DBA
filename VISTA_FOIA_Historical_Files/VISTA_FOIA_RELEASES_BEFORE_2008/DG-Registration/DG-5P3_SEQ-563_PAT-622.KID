Released DG*5.3*622 SEQ #563
Extracted from mail message
**KIDS**:DG*5.3*622^

**INSTALL NAME**
DG*5.3*622
"BLD",5761,0)
DG*5.3*622^REGISTRATION^0^3050121^y
"BLD",5761,1,0)
^^5^5^3041220^
"BLD",5761,1,1,0)
This patch will remove any duplicate race entries in the 2.02 multiple
"BLD",5761,1,2,0)
of the patient file, and will ensure that when data is imported 
"BLD",5761,1,3,0)
using the Register Once Messaging (ROM) query during registration,
"BLD",5761,1,4,0)
that entries in the Race and Ethnicity multiples are dynamically 
"BLD",5761,1,5,0)
numbered.
"BLD",5761,4,0)
^9.64PA^^
"BLD",5761,"ABPKG")
n
"BLD",5761,"KRN",0)
^9.67PA^8989.52^19
"BLD",5761,"KRN",.4,0)
.4
"BLD",5761,"KRN",.401,0)
.401
"BLD",5761,"KRN",.402,0)
.402
"BLD",5761,"KRN",.403,0)
.403
"BLD",5761,"KRN",.5,0)
.5
"BLD",5761,"KRN",.84,0)
.84
"BLD",5761,"KRN",3.6,0)
3.6
"BLD",5761,"KRN",3.8,0)
3.8
"BLD",5761,"KRN",9.2,0)
9.2
"BLD",5761,"KRN",9.8,0)
9.8
"BLD",5761,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5761,"KRN",9.8,"NM",1,0)
DGROHLR1^^0^B30049286
"BLD",5761,"KRN",9.8,"NM",2,0)
DG53P622^^0^B28651387
"BLD",5761,"KRN",9.8,"NM","B","DG53P622",2)

"BLD",5761,"KRN",9.8,"NM","B","DGROHLR1",1)

"BLD",5761,"KRN",19,0)
19
"BLD",5761,"KRN",19,"NM",0)
^9.68A^^
"BLD",5761,"KRN",19.1,0)
19.1
"BLD",5761,"KRN",101,0)
101
"BLD",5761,"KRN",409.61,0)
409.61
"BLD",5761,"KRN",771,0)
771
"BLD",5761,"KRN",870,0)
870
"BLD",5761,"KRN",8989.51,0)
8989.51
"BLD",5761,"KRN",8989.52,0)
8989.52
"BLD",5761,"KRN",8994,0)
8994
"BLD",5761,"KRN","B",.4,.4)

"BLD",5761,"KRN","B",.401,.401)

"BLD",5761,"KRN","B",.402,.402)

"BLD",5761,"KRN","B",.403,.403)

"BLD",5761,"KRN","B",.5,.5)

"BLD",5761,"KRN","B",.84,.84)

"BLD",5761,"KRN","B",3.6,3.6)

"BLD",5761,"KRN","B",3.8,3.8)

"BLD",5761,"KRN","B",9.2,9.2)

"BLD",5761,"KRN","B",9.8,9.8)

"BLD",5761,"KRN","B",19,19)

"BLD",5761,"KRN","B",19.1,19.1)

"BLD",5761,"KRN","B",101,101)

"BLD",5761,"KRN","B",409.61,409.61)

"BLD",5761,"KRN","B",771,771)

"BLD",5761,"KRN","B",870,870)

"BLD",5761,"KRN","B",8989.51,8989.51)

"BLD",5761,"KRN","B",8989.52,8989.52)

"BLD",5761,"KRN","B",8994,8994)

"BLD",5761,"QUES",0)
^9.62^^
"BLD",5761,"REQB",0)
^9.611^1^1
"BLD",5761,"REQB",1,0)
DG*5.3*572^2
"BLD",5761,"REQB","B","DG*5.3*572",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
622^3050121^100850
"PKG",5,22,1,"PAH",1,1,0)
^^5^5^3050121
"PKG",5,22,1,"PAH",1,1,1,0)
This patch will remove any duplicate race entries in the 2.02 multiple
"PKG",5,22,1,"PAH",1,1,2,0)
of the patient file, and will ensure that when data is imported 
"PKG",5,22,1,"PAH",1,1,3,0)
using the Register Once Messaging (ROM) query during registration,
"PKG",5,22,1,"PAH",1,1,4,0)
that entries in the Race and Ethnicity multiples are dynamically 
"PKG",5,22,1,"PAH",1,1,5,0)
numbered.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DG53P622")
0^2^B28651387
"RTN","DG53P622",1,0)
DG53P622 ;BAY/JAT - Patient File Updat; 6/7/04 7:13pm ; 1/21/05 1:15pm
"RTN","DG53P622",2,0)
 ;;5.3;Registration;**622**;Aug 13,1993
"RTN","DG53P622",3,0)
 Q
"RTN","DG53P622",4,0)
 ;
"RTN","DG53P622",5,0)
CLEANUP ;This entry point will do the update.
"RTN","DG53P622",6,0)
 ;
"RTN","DG53P622",7,0)
 N DGENSKIP
"RTN","DG53P622",8,0)
 S DGENSKIP=0
"RTN","DG53P622",9,0)
 W !,"This is a one-time update of the Patient File."
"RTN","DG53P622",10,0)
 W !,"It will correct Race & Ethnicity records."
"RTN","DG53P622",11,0)
 N X1,X2
"RTN","DG53P622",12,0)
 K ^XTMP("DG53P622",$J)
"RTN","DG53P622",13,0)
 S X1=DT,X2=90 D C^%DTC
"RTN","DG53P622",14,0)
 S ^XTMP("DG53P622",$J,0)=X_"^"_DT_"^Patient File update"
"RTN","DG53P622",15,0)
 I $$DEVICE() D ENTER
"RTN","DG53P622",16,0)
 Q
"RTN","DG53P622",17,0)
 ;
"RTN","DG53P622",18,0)
REPORT ;This entry point was provided for testing, so that before
"RTN","DG53P622",19,0)
 ;patient records are updated the site can have a list of
"RTN","DG53P622",20,0)
 ;the DFN's that would be affected.
"RTN","DG53P622",21,0)
 ; 
"RTN","DG53P622",22,0)
 ;Use this entry point to report on what the update would do.
"RTN","DG53P622",23,0)
 ;No changes will be made to the database.
"RTN","DG53P622",24,0)
 ;
"RTN","DG53P622",25,0)
 N DGENSKIP
"RTN","DG53P622",26,0)
 S DGENSKIP=1
"RTN","DG53P622",27,0)
 W !,"This is a preliminary report by DFN of the Patient file"
"RTN","DG53P622",28,0)
 W !,"records which would be affected by the update."
"RTN","DG53P622",29,0)
 N X1,X2
"RTN","DG53P622",30,0)
 K ^XTMP("DG53P622",$J)
"RTN","DG53P622",31,0)
 S X1=DT,X2=90 D C^%DTC
"RTN","DG53P622",32,0)
 S ^XTMP("DG53P622",$J,0)=X_"^"_DT_"^Patient File update"
"RTN","DG53P622",33,0)
 I $$DEVICE() D ENTER
"RTN","DG53P622",34,0)
 Q
"RTN","DG53P622",35,0)
 ;
"RTN","DG53P622",36,0)
ENTER ;
"RTN","DG53P622",37,0)
 ;
"RTN","DG53P622",38,0)
 D UPDATE(DGENSKIP)
"RTN","DG53P622",39,0)
 D:(DGENSKIP) ^%ZISC
"RTN","DG53P622",40,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","DG53P622",41,0)
 Q
"RTN","DG53P622",42,0)
DEVICE() ;
"RTN","DG53P622",43,0)
 ;Description: allows the user to select a device.
"RTN","DG53P622",44,0)
 ;
"RTN","DG53P622",45,0)
 ;Output:
"RTN","DG53P622",46,0)
 ;  Function Value - Returns 0 if the user decides not to print or to
"RTN","DG53P622",47,0)
 ;       queue the report, 1 otherwise.
"RTN","DG53P622",48,0)
 ;
"RTN","DG53P622",49,0)
 N OK,IOP,POP,%ZIS
"RTN","DG53P622",50,0)
 S OK=1
"RTN","DG53P622",51,0)
 S %ZIS="MQ"
"RTN","DG53P622",52,0)
 D ^%ZIS
"RTN","DG53P622",53,0)
 S:POP OK=0
"RTN","DG53P622",54,0)
 D:OK&$D(IO("Q"))
"RTN","DG53P622",55,0)
 .N ZTRTN,ZTDESC,ZTSKM,ZTREQ,ZTSTOP
"RTN","DG53P622",56,0)
 .S ZTRTN="ENTER^DG53P622",ZTDESC=$S(DGENSKIP:"Report",1:"Update")_" of Patient Records"
"RTN","DG53P622",57,0)
 .S ZTSAVE("DGENSKIP")=""
"RTN","DG53P622",58,0)
 .D ^%ZTLOAD
"RTN","DG53P622",59,0)
 .W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","DG53P622",60,0)
 .D HOME^%ZIS
"RTN","DG53P622",61,0)
 .S OK=0
"RTN","DG53P622",62,0)
 Q OK
"RTN","DG53P622",63,0)
 ;
"RTN","DG53P622",64,0)
UPDATE(DGENSKIP) ;
"RTN","DG53P622",65,0)
 ;This will update patient records --
"RTN","DG53P622",66,0)
 ;
"RTN","DG53P622",67,0)
 ;Input: If DGENSKIP=1, the records will not be updated,
"RTN","DG53P622",68,0)
 ;just reported.
"RTN","DG53P622",69,0)
 ;
"RTN","DG53P622",70,0)
 N DFN,COUNT,DGMULT,DGSAVE,DGDUPE,DGETHN,DGDATA,DGRACE,DGETHNIC,DGFDA,X,DINUM,DIC,DA,DGTEST
"RTN","DG53P622",71,0)
 S (COUNT,DFN)=0
"RTN","DG53P622",72,0)
 F  S DFN=$O(^DPT(DFN)) Q:'DFN  D
"RTN","DG53P622",73,0)
 .; merged record
"RTN","DG53P622",74,0)
 .I $D(^DPT(DFN,-9)) Q
"RTN","DG53P622",75,0)
 .; in process of being merged
"RTN","DG53P622",76,0)
 .I $P($G(^DPT(DFN,0)),U)["MERGING INTO" Q
"RTN","DG53P622",77,0)
 .I '$D(^DPT(DFN,0)) Q
"RTN","DG53P622",78,0)
 .I $P(^DPT(DFN,0),U)="" Q
"RTN","DG53P622",79,0)
 .; look for duplicates
"RTN","DG53P622",80,0)
 .S (DGMULT,DGSAVE,DGDUPE)=0
"RTN","DG53P622",81,0)
 .F  S DGMULT=$O(^DPT(DFN,.02,DGMULT)) Q:'DGMULT  D
"RTN","DG53P622",82,0)
 ..I DGSAVE=0 S DGSAVE=$P($G(^DPT(DFN,.02,DGMULT,0)),U) Q
"RTN","DG53P622",83,0)
 ..I DGSAVE=$P($G(^DPT(DFN,.02,DGMULT,0)),U) S DGDUPE=1 D UPDR S DGDUPE=0
"RTN","DG53P622",84,0)
 .S (DGMULT,DGSAVE,DGETHN)=0
"RTN","DG53P622",85,0)
 .F  S DGMULT=$O(^DPT(DFN,.06,DGMULT)) Q:'DGMULT  D
"RTN","DG53P622",86,0)
 ..I DGSAVE=0 S DGSAVE=$P($G(^DPT(DFN,.06,DGMULT,0)),U) Q
"RTN","DG53P622",87,0)
 ..I DGSAVE=$P($G(^DPT(DFN,.06,DGMULT,0)),U) S DGETHN=1 D UPDR S DGETHN=0
"RTN","DG53P622",88,0)
 .;look for no dinums
"RTN","DG53P622",89,0)
 .S (DGMULT,DGRACE,DGETHNIC)=0
"RTN","DG53P622",90,0)
 .F  S DGMULT=$O(^DPT(DFN,.02,DGMULT)) Q:'DGMULT  D
"RTN","DG53P622",91,0)
 ..S DGDATA=$G(^DPT(DFN,.02,DGMULT,0))
"RTN","DG53P622",92,0)
 ..S DGRACE=$P(DGDATA,U)
"RTN","DG53P622",93,0)
 ..I DGMULT'=DGRACE D UPDR
"RTN","DG53P622",94,0)
 .S (DGMULT,DGRACE,DGETHNIC)=0
"RTN","DG53P622",95,0)
 .F  S DGMULT=$O(^DPT(DFN,.06,DGMULT)) Q:'DGMULT  D
"RTN","DG53P622",96,0)
 ..S DGDATA=$G(^DPT(DFN,.06,DGMULT,0))
"RTN","DG53P622",97,0)
 ..S DGETHNIC=$P(DGDATA,U)
"RTN","DG53P622",98,0)
 ..I DGMULT'=DGETHNIC D UPDR
"RTN","DG53P622",99,0)
 ;
"RTN","DG53P622",100,0)
 D PRINT
"RTN","DG53P622",101,0)
 Q
"RTN","DG53P622",102,0)
 ;
"RTN","DG53P622",103,0)
UPDR ;
"RTN","DG53P622",104,0)
 I '$D(^XTMP("DG53P622",$J,DFN)) S COUNT=COUNT+1
"RTN","DG53P622",105,0)
 S DGTEXT=""
"RTN","DG53P622",106,0)
 I $D(^XTMP("DG53P622",$J,DFN)) S DGTEXT=$G(^XTMP("DG53P622",$J,DFN))
"RTN","DG53P622",107,0)
 S ^XTMP("DG53P622",$J,DFN)=$S(DGDUPE:"dupe race",DGETHN:"dupe ethnic",DGRACE:"race entry not dinumed",DGETHNIC:"ethnicity entry not dinumed",1:"unknown")_"^"_DGTEXT
"RTN","DG53P622",108,0)
 I 'DGENSKIP D
"RTN","DG53P622",109,0)
 .I DGDUPE D
"RTN","DG53P622",110,0)
 ..S DGFDA(2.02,DGMULT_","_DFN_",",.01)="@"
"RTN","DG53P622",111,0)
 ..D FILE^DIE(,"DGFDA",)
"RTN","DG53P622",112,0)
 .I DGETHN D
"RTN","DG53P622",113,0)
 ..S DGFDA(2.06,DGMULT_","_DFN_",",.01)="@"
"RTN","DG53P622",114,0)
 ..D FILE^DIE(,"DGFDA",)
"RTN","DG53P622",115,0)
 .I DGRACE D
"RTN","DG53P622",116,0)
 ..S DGFDA(2.02,DGMULT_","_DFN_",",.01)="@"
"RTN","DG53P622",117,0)
 ..D FILE^DIE(,"DGFDA",)
"RTN","DG53P622",118,0)
 ..S (X,DINUM)=DGRACE,DIC="^DPT(DFN,.02,",DA(1)=DFN,DIC(0)="L"
"RTN","DG53P622",119,0)
 ..K DO D FILE^DICN
"RTN","DG53P622",120,0)
 .I DGETHNIC D
"RTN","DG53P622",121,0)
 ..S DGFDA(2.06,DGMULT_","_DFN_",",.01)="@"
"RTN","DG53P622",122,0)
 ..D FILE^DIE(,"DGFDA",)
"RTN","DG53P622",123,0)
 ..S (X,DINUM)=DGETHNIC,DIC="^DPT(DFN,.06,",DA(1)=DFN,DIC(0)="L"
"RTN","DG53P622",124,0)
 ..K DO D FILE^DICN
"RTN","DG53P622",125,0)
 Q
"RTN","DG53P622",126,0)
PRINT ;
"RTN","DG53P622",127,0)
 U IO
"RTN","DG53P622",128,0)
 N DGDDT,DGQUIT,DGPG
"RTN","DG53P622",129,0)
 S DGDDT=$$FMTE^XLFDT($$NOW^XLFDT,"D")
"RTN","DG53P622",130,0)
 S (DGQUIT,DGPG)=0
"RTN","DG53P622",131,0)
 D HEAD
"RTN","DG53P622",132,0)
 I '$G(COUNT) D  Q
"RTN","DG53P622",133,0)
 .W !!!,?20,"*** No records to report ***"
"RTN","DG53P622",134,0)
 W !!,"*** COUNT OF BAD PATIENT RECORDS"_$S(DGENSKIP:"",1:" UPDATED")_": ",COUNT," ***",!!
"RTN","DG53P622",135,0)
 S DFN=0
"RTN","DG53P622",136,0)
 F  S DFN=$O(^XTMP("DG53P622",$J,DFN)) Q:'DFN  D  Q:DGQUIT
"RTN","DG53P622",137,0)
 .I $Y>(IOSL-4) D HEAD
"RTN","DG53P622",138,0)
 .W ?2,DFN,?15,$G(^XTMP("DG53P622",$J,DFN)),!
"RTN","DG53P622",139,0)
 ;
"RTN","DG53P622",140,0)
 I DGQUIT W:$D(ZTQUEUED) !!,"Report stopped at user's request" Q
"RTN","DG53P622",141,0)
 I $G(DGPG)>0,$E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:+Y=0 DGQUIT=1
"RTN","DG53P622",142,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","DG53P622",143,0)
 Q
"RTN","DG53P622",144,0)
 ;
"RTN","DG53P622",145,0)
HEAD ;
"RTN","DG53P622",146,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S (ZTSTOP,DGQUIT)=1 Q
"RTN","DG53P622",147,0)
 I $G(DGPG)>0,$E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:+Y=0 DGQUIT=1
"RTN","DG53P622",148,0)
 Q:DGQUIT
"RTN","DG53P622",149,0)
 S DGPG=$G(DGPG)+1
"RTN","DG53P622",150,0)
 W @IOF,!,DGDDT,?15,"DG*5.3*622 Patient File Update Utility",?70,"Page:",$J(DGPG,5),! K X S $P(X,"-",81)="" W X,!
"RTN","DG53P622",151,0)
 W !
"RTN","DG53P622",152,0)
 W !,?2,"DFN",?15,"Action to be taken",!
"RTN","DG53P622",153,0)
 S $P(X,"-",81)="" W X,!
"RTN","DG53P622",154,0)
 Q
"RTN","DGROHLR1")
0^1^B30049286
"RTN","DGROHLR1",1,0)
DGROHLR1 ;GTS - ROM HL7 RECEIVE DRIVERS ; 11/12/04 7:54pm
"RTN","DGROHLR1",2,0)
 ;;5.3;Registration;**572,622**;Aug 13, 1993
"RTN","DGROHLR1",3,0)
 ;
"RTN","DGROHLR1",4,0)
CONVFDA(DFN,DGDATA) ; LOOP THROUGH DATA TO FILE
"RTN","DGROHLR1",5,0)
 N DFNC,F,IEN,FIELD,DGROAR,FNUM,QVAR,INX
"RTN","DGROHLR1",6,0)
 ;
"RTN","DGROHLR1",7,0)
 ;*DGROAR: Indirect reference to DGROAYi where "i" is the ORDER INDEX
"RTN","DGROHLR1",8,0)
 ;* field value in 391.23.  ORDER INDEX defines order for a group of
"RTN","DGROHLR1",9,0)
 ;* fields loaded into the LST.
"RTN","DGROHLR1",10,0)
 ;* DGROAYi defined for each group maintaining proper order.
"RTN","DGROHLR1",11,0)
 ;*  DG*5.3*572
"RTN","DGROHLR1",12,0)
 ;
"RTN","DGROHLR1",13,0)
 S DFNC=DFN_","
"RTN","DGROHLR1",14,0)
 S INX=""
"RTN","DGROHLR1",15,0)
 F  S INX=$O(^DGRO(391.23,"D",INX)) Q:INX=""  D
"RTN","DGROHLR1",16,0)
 . S DGROAR="DGROAY"_INX
"RTN","DGROHLR1",17,0)
 . S QVAR=0
"RTN","DGROHLR1",18,0)
 . S F=""
"RTN","DGROHLR1",19,0)
 . F  S F=$O(@DGDATA@(F)) Q:F=""  D
"RTN","DGROHLR1",20,0)
 . . S IEN=""
"RTN","DGROHLR1",21,0)
 . . F  S IEN=$O(@DGDATA@(F,IEN)) Q:IEN=""  D
"RTN","DGROHLR1",22,0)
 . . . S FIELD=""
"RTN","DGROHLR1",23,0)
 . . . F  S FIELD=$O(@DGDATA@(F,IEN,FIELD)) Q:FIELD=""  D
"RTN","DGROHLR1",24,0)
 . . . . S ORDINX=$O(^DGRO(391.23,"E",F,FIELD,""))
"RTN","DGROHLR1",25,0)
 . . . . D:(ORDINX=INX) SETARY
"RTN","DGROHLR1",26,0)
 . . . . ;* Following line files Internal PEC, Rmv once Ext PEC is filed
"RTN","DGROHLR1",27,0)
 . . . . I (ORDINX=INX)&(F=2) DO
"RTN","DGROHLR1",28,0)
 . . . . .D:(FIELD=.361) FILEPEC
"RTN","DGROHLR1",29,0)
 . . . . .D:((FIELD=.117)!(FIELD=.12111)!(FIELD=.14111)) FILECNTY
"RTN","DGROHLR1",30,0)
 . . I (+$O(@DGROAR@(""))>0) S QVAR=1 D FILE
"RTN","DGROHLR1",31,0)
 Q
"RTN","DGROHLR1",32,0)
 ;
"RTN","DGROHLR1",33,0)
FILECNTY ;*Retrieve county IEN and file county
"RTN","DGROHLR1",34,0)
 ;*Retrieve State IEN corresponding to Temp, Conf, or Perm State
"RTN","DGROHLR1",35,0)
 I (FIELD=.117),($D(^DPT(DFN,.11))) S STATEIEN=$P(^DPT(DFN,.11),"^",5)
"RTN","DGROHLR1",36,0)
 I (FIELD=.12111),($D(^DPT(DFN,.121))) S STATEIEN=$P(^DPT(DFN,.121),"^",5)
"RTN","DGROHLR1",37,0)
 I (FIELD=.14111),($D(^DPT(DFN,.141))) S STATEIEN=$P(^DPT(DFN,.141),"^",5)
"RTN","DGROHLR1",38,0)
 ;
"RTN","DGROHLR1",39,0)
 ;*Retrieve County IEN for exact county returned from LST
"RTN","DGROHLR1",40,0)
 S DIC="^DIC(5,"_STATEIEN_",1,"
"RTN","DGROHLR1",41,0)
 S DIC(0)="XS"
"RTN","DGROHLR1",42,0)
 S X=@DGROAR@(F,DFNC,FIELD)
"RTN","DGROHLR1",43,0)
 D ^DIC
"RTN","DGROHLR1",44,0)
 S DGROCTY(F,DFNC,FIELD)=+Y
"RTN","DGROHLR1",45,0)
 D FILE^DIE("","DGROCTY","ERR") ;File County IEN
"RTN","DGROHLR1",46,0)
 K @DGROAR@(F,DFNC,FIELD)
"RTN","DGROHLR1",47,0)
 K STATEIEN,DGROCTY
"RTN","DGROHLR1",48,0)
 Q
"RTN","DGROHLR1",49,0)
 ;
"RTN","DGROHLR1",50,0)
FILEPEC ;File Internal value of Prim Elig Code
"RTN","DGROHLR1",51,0)
 ;Called from CONVFDA^DGROHLR1
"RTN","DGROHLR1",52,0)
 ;Remove this call when fields required by PEC are received
"RTN","DGROHLR1",53,0)
 ; from LST
"RTN","DGROHLR1",54,0)
 I $D(@DGROAR@(F,DFNC,FIELD)) DO
"RTN","DGROHLR1",55,0)
 . S DIC="^DIC(8,"
"RTN","DGROHLR1",56,0)
 . S DIC(0)="MNSX"
"RTN","DGROHLR1",57,0)
 . S X=@DGROAR@(F,DFNC,FIELD)
"RTN","DGROHLR1",58,0)
 . D ^DIC
"RTN","DGROHLR1",59,0)
 . S DGROPEC(F,DFNC,FIELD)=+Y
"RTN","DGROHLR1",60,0)
 . D FILE^DIE("","DGROPEC","ERR")
"RTN","DGROHLR1",61,0)
 . K @DGROAR@(F,DFNC,FIELD)
"RTN","DGROHLR1",62,0)
 . K DGROPEC,DIC,X
"RTN","DGROHLR1",63,0)
 Q
"RTN","DGROHLR1",64,0)
 ;
"RTN","DGROHLR1",65,0)
FILE ;*Execute FILE or UPDATE per FNUM (1st subscpt) for file # according
"RTN","DGROHLR1",66,0)
 ;* to file/multiple record add or adding existing Patient data add
"RTN","DGROHLR1",67,0)
 S FNUM=$O(@DGROAR@(""))
"RTN","DGROHLR1",68,0)
 K %DT ;* Clean up leaks from Input transforms that set %DT(0)
"RTN","DGROHLR1",69,0)
 ;
"RTN","DGROHLR1",70,0)
 ;* Patient file processing
"RTN","DGROHLR1",71,0)
 I +FNUM=2 DO
"RTN","DGROHLR1",72,0)
 . D FILE^DIE("E","@DGROAR","ERR") ;*Add to existing Patient entry
"RTN","DGROHLR1",73,0)
 ;
"RTN","DGROHLR1",74,0)
 ;* Patient file multiples processing
"RTN","DGROHLR1",75,0)
 I (+FNUM=2.01)!(+FNUM=2.141) DO
"RTN","DGROHLR1",76,0)
 . D UPDATE^DIE("E","@DGROAR","","ERR")
"RTN","DGROHLR1",77,0)
 I (+FNUM=2.02)!(+FNUM=2.06) DO
"RTN","DGROHLR1",78,0)
 . N DGRODNUM,DGIEN,DNUMDATA,DGIEN2,DGROIEN
"RTN","DGROHLR1",79,0)
 . S DGRODNUM=0
"RTN","DGROHLR1",80,0)
 . F  S DGRODNUM=$O(@DGROAR@(+FNUM,DGRODNUM)) Q:DGRODNUM=""  D
"RTN","DGROHLR1",81,0)
 . . S DGIEN=$P(DGRODNUM,",")
"RTN","DGROHLR1",82,0)
 . . I DGIEN S DGIEN2=$P(DGIEN,"+",2)
"RTN","DGROHLR1",83,0)
 . . S DNUMDATA=$G(@DGROAR@(+FNUM,DGRODNUM,.01))
"RTN","DGROHLR1",84,0)
 . . I DGIEN2 S DGROIEN(DGIEN2)=DNUMDATA D
"RTN","DGROHLR1",85,0)
 . . . D UPDATE^DIE("","@DGROAR","DGROIEN","ERR") ;*Converted Ext to Int
"RTN","DGROHLR1",86,0)
 ;
"RTN","DGROHLR1",87,0)
 ;* Processing fields [indicated in 391.23] not part of Patient file.
"RTN","DGROHLR1",88,0)
 ;* Define IF section for each file not a Patient file field or
"RTN","DGROHLR1",89,0)
 ;* Multiple.
"RTN","DGROHLR1",90,0)
 I (+$P(FNUM,".")'=2) DO
"RTN","DGROHLR1",91,0)
 . I +FNUM=38.1 DO
"RTN","DGROHLR1",92,0)
 . . N DGROARBI
"RTN","DGROHLR1",93,0)
 . . S DGROARBI(1)=DFN ;*Set 38.1 IEN to DFN
"RTN","DGROHLR1",94,0)
 . . D UPDATE^DIE("E","@DGROAR","DGROARBI","ERR")
"RTN","DGROHLR1",95,0)
 ;
"RTN","DGROHLR1",96,0)
 K @DGROAR
"RTN","DGROHLR1",97,0)
 Q
"RTN","DGROHLR1",98,0)
 ;
"RTN","DGROHLR1",99,0)
SETARY ;* Setup arrays of data to be filed
"RTN","DGROHLR1",100,0)
 N U,D,DATA,NODE,NODE2,INENNUM
"RTN","DGROHLR1",101,0)
 ;
"RTN","DGROHLR1",102,0)
 I '$D(^DGRO(391.23,"C",F,FIELD)) Q
"RTN","DGROHLR1",103,0)
 ;
"RTN","DGROHLR1",104,0)
 S U="^"
"RTN","DGROHLR1",105,0)
 ;
"RTN","DGROHLR1",106,0)
 ;CHECK LOCAL PATIENT FILE FOR EXISTING DATA, DO NOT OVERWRITE
"RTN","DGROHLR1",107,0)
 S D=$$GET1^DIQ(F,DFNC,FIELD)
"RTN","DGROHLR1",108,0)
 I D'="" K @DGDATA@(F,IEN,FIELD) Q
"RTN","DGROHLR1",109,0)
 ;
"RTN","DGROHLR1",110,0)
 S DATA=$G(@DGDATA@(F,IEN,FIELD,"E"))
"RTN","DGROHLR1",111,0)
 Q:DATA=""
"RTN","DGROHLR1",112,0)
 ;
"RTN","DGROHLR1",113,0)
 ;* Design of this Subroutine:
"RTN","DGROHLR1",114,0)
 ;* Set array defining groups of date for Fileman filing in
"RTN","DGROHLR1",115,0)
 ;*  a predefined order.
"RTN","DGROHLR1",116,0)
 ;* Indirection defined various array names for different ordered
"RTN","DGROHLR1",117,0)
 ;*  data groups in CONVFDA.
"RTN","DGROHLR1",118,0)
 ;* File Ext. values returned from LST per ORDER INDEX.
"RTN","DGROHLR1",119,0)
 ;* DG*5.3*572
"RTN","DGROHLR1",120,0)
 ;
"RTN","DGROHLR1",121,0)
 ;* Get field entry IEN in ROM 391.23 file
"RTN","DGROHLR1",122,0)
 S INENNUM=INX
"RTN","DGROHLR1",123,0)
 ;
"RTN","DGROHLR1",124,0)
 I F=2 DO  Q
"RTN","DGROHLR1",125,0)
 . S @DGROAR@(F,DFNC,FIELD)=DATA ;*Indirection to Patient Array
"RTN","DGROHLR1",126,0)
 . K @DGDATA@(F,IEN,FIELD)
"RTN","DGROHLR1",127,0)
 ;
"RTN","DGROHLR1",128,0)
 ;* Set array for all other files (not Patient or Security files)
"RTN","DGROHLR1",129,0)
 ;* This section is for new entries in files.  Not for Multiples.
"RTN","DGROHLR1",130,0)
 ;*  Code to process specific files needed in CONVFDA
"RTN","DGROHLR1",131,0)
 I (+$P(F,".")'=2),(F'=38.1) DO  Q
"RTN","DGROHLR1",132,0)
 . S @DGROAR@(F,"+1,",FIELD)=DATA
"RTN","DGROHLR1",133,0)
 . K @DGDATA@(F,IEN,FIELD)
"RTN","DGROHLR1",134,0)
 ;
"RTN","DGROHLR1",135,0)
 ;SET ALIAS AND CONFIDENTIAL ADDRESS CAT. SUBFILE ARRAYS
"RTN","DGROHLR1",136,0)
 I (F=2.01)!(F=2.141) D  Q
"RTN","DGROHLR1",137,0)
 . S NODE2="+"
"RTN","DGROHLR1",138,0)
 . S NODE2=NODE2_$P(IEN,",")_","_DFNC
"RTN","DGROHLR1",139,0)
 . S @DGROAR@(F,NODE2,FIELD)=DATA ;*Indirection to Patient Array
"RTN","DGROHLR1",140,0)
 . K @DGDATA@(F,IEN,FIELD)
"RTN","DGROHLR1",141,0)
 ;
"RTN","DGROHLR1",142,0)
 ;SET RACE AND ETHNICITY ARRAYS
"RTN","DGROHLR1",143,0)
 I (F=2.02)!(F=2.06) D  Q
"RTN","DGROHLR1",144,0)
 . N REFILE,REIEN,DATA30,QFL,DATACOMP,TEST,ERR,INACTIVE
"RTN","DGROHLR1",145,0)
 . I (F=2.02),(FIELD=.01) S REFILE=10
"RTN","DGROHLR1",146,0)
 . I (F=2.06),(FIELD=.01) S REFILE=10.2
"RTN","DGROHLR1",147,0)
 . I FIELD=.02 S REFILE=10.3
"RTN","DGROHLR1",148,0)
 . S DATA30=$E(DATA,1,30) D
"RTN","DGROHLR1",149,0)
 . . S QFL=0,REIEN="",NODE=""
"RTN","DGROHLR1",150,0)
 . . D FIND^DIC(REFILE,"","@;.01;200","",DATA30,,"B","","","TEST","ERR")
"RTN","DGROHLR1",151,0)
 . . F  S NODE=$O(TEST("DILIST",2,NODE)) Q:'NODE  D  Q:$G(QFL)=1
"RTN","DGROHLR1",152,0)
 . . . S REIEN=$G(TEST("DILIST",2,NODE))
"RTN","DGROHLR1",153,0)
 . . . S INACTIVE=$G(TEST("DILIST","ID",NODE,200))
"RTN","DGROHLR1",154,0)
 . . . Q:INACTIVE="YES"  ;* QUIT if Race or Eth Inact
"RTN","DGROHLR1",155,0)
 . . . S DATACOMP=$G(TEST("DILIST","ID",NODE,.01))
"RTN","DGROHLR1",156,0)
 . . . I DATACOMP=DATA S QFL=1
"RTN","DGROHLR1",157,0)
 . Q:'QFL
"RTN","DGROHLR1",158,0)
 . Q:$G(INACTIVE)="YES"  ;* No entry for Inactive Race/Ethncty
"RTN","DGROHLR1",159,0)
 . S DATA=REIEN ;*Race/Ethncty/MOC (10/10.2/10.3) IEN for data recvd
"RTN","DGROHLR1",160,0)
 . ;
"RTN","DGROHLR1",161,0)
 . S NODE2="+" ;*+ for all fields, All fields added in one UPDATE
"RTN","DGROHLR1",162,0)
 . S NODE2=NODE2_$P(IEN,",")_","_DFNC ;*No + for DFNC, DPT record exists
"RTN","DGROHLR1",163,0)
 . S @DGROAR@(F,NODE2,FIELD)=DATA ;*Indirection to Patient Array
"RTN","DGROHLR1",164,0)
 . K @DGDATA@(F,IEN,FIELD)
"RTN","DGROHLR1",165,0)
 ;
"RTN","DGROHLR1",166,0)
 ;* Set all sensitive fields (38.1) in array
"RTN","DGROHLR1",167,0)
 I F=38.1 D  Q
"RTN","DGROHLR1",168,0)
 . Q:('$D(@DGDATA@(F)))  ;*Data already filed
"RTN","DGROHLR1",169,0)
 . S FIELD=.01
"RTN","DGROHLR1",170,0)
 . S @DGROAR@(F,"+1,",FIELD)=$$GET1^DIQ(2,DFN,.01)
"RTN","DGROHLR1",171,0)
 . F  S FIELD=$O(@DGDATA@(F,IEN,FIELD)) Q:'FIELD  D
"RTN","DGROHLR1",172,0)
 . . S @DGROAR@(F,"+1,",FIELD)=@DGDATA@(F,IEN,FIELD,"E")
"RTN","DGROHLR1",173,0)
 . K @DGDATA@(F,IEN)
"RTN","DGROHLR1",174,0)
 . S FIELD=999999 ;*Skip to end of 38.1 field list in @DGDATA
"RTN","DGROHLR1",175,0)
 Q
"VER")
8.0^22.0
**END**
**END**
