Released LR*5.2*317 SEQ #285
Extracted from mail message
**KIDS**:LR*5.2*317^

**INSTALL NAME**
LR*5.2*317
"BLD",5314,0)
LR*5.2*317^LAB SERVICE^0^3061030^y
"BLD",5314,1,0)
^^536^536^3061030^^^^
"BLD",5314,1,1,0)
Description:
"BLD",5314,1,2,0)
===========
"BLD",5314,1,3,0)
 
"BLD",5314,1,4,0)
               ************************************
"BLD",5314,1,5,0)
*************************************************************************
"BLD",5314,1,6,0)
SPECIAL NOTE:  
"BLD",5314,1,7,0)
Installation of this patch MUST be coordinated with Laboratory personnel.  
"BLD",5314,1,8,0)
The Pre-Installation instructions within the Installation Section below, 
"BLD",5314,1,9,0)
MUST be followed and completed before installation can begin.
"BLD",5314,1,10,0)
*************************************************************************
"BLD",5314,1,11,0)
               ************************************
"BLD",5314,1,12,0)
 
"BLD",5314,1,13,0)
BLOOD BANK CLEARANCE
"BLD",5314,1,14,0)
====================
"BLD",5314,1,15,0)
 
"BLD",5314,1,16,0)
VISTA Laboratory Package patch LR*5.2*317 contains changes to 
"BLD",5314,1,17,0)
software controlled by VHA DIRECTIVE 2004-053, titled VISTA BLOOD 
"BLD",5314,1,18,0)
BANK SOFTWARE. Changes include: 
"BLD",5314,1,19,0)
File     Sub-file     Field   Field Name                      Action
"BLD",5314,1,20,0)
----     --------     -----   ----------                      ------
"BLD",5314,1,21,0)
63       63.207       .03     RELEASE SUPP REPORT MODIFIED    New Field
"BLD",5314,1,22,0)
63       63.324       .03     RELEASE SUPP REPORT MODIFIED    New Field
"BLD",5314,1,23,0)
63       63.817       .03     RELEASE SUPP REPORT MODIFIED    New Field
"BLD",5314,1,24,0)
63       63.907       .03     RELEASE SUPP REPORT MODIFIED    New Field
"BLD",5314,1,25,0)
 
"BLD",5314,1,26,0)
All of the above changes have been reviewed by the VISTA Blood Bank 
"BLD",5314,1,27,0)
Developer and found to have no impact on the VISTA BLOOD BANK 
"BLD",5314,1,28,0)
SOFTWARE control functions.
"BLD",5314,1,29,0)
 
"BLD",5314,1,30,0)
RISK ANALYSIS: Changes made by patch LR*5.2*317 have no effect on 
"BLD",5314,1,31,0)
Blood Bank software functionality, therefore RISK is none.
"BLD",5314,1,32,0)
 
"BLD",5314,1,33,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LR*5.2*317 does 
"BLD",5314,1,34,0)
not alter or modify any software design safeguards or safety 
"BLD",5314,1,35,0)
critical elements functions.
"BLD",5314,1,36,0)
 
"BLD",5314,1,37,0)
POTENTIAL IMPACT ON SITES: This patch contains changes to 0 
"BLD",5314,1,38,0)
routines and 1 file identified in Veterans Health Administration 
"BLD",5314,1,39,0)
(VHA) Directive 2004-053, group B listing. The changes have no 
"BLD",5314,1,40,0)
effect on Blood Bank functionality or medical device control 
"BLD",5314,1,41,0)
functions. There is no adverse potential to sites.
"BLD",5314,1,42,0)
 
"BLD",5314,1,43,0)
VALIDATION REQUIREMENTS BY OPTION: 
"BLD",5314,1,44,0)
There are no validation requirements associated with this patch.
"BLD",5314,1,45,0)
 
"BLD",5314,1,46,0)
MINIMAL TEST CASE SCENARIOS BY OPTION, INCLUSIVE OF ALL CONTROL FUNCTIONS:
"BLD",5314,1,47,0)
There are no test case scenarios associated with this patch.
"BLD",5314,1,48,0)
 
"BLD",5314,1,49,0)
=================
"BLD",5314,1,50,0)
 
"BLD",5314,1,51,0)
VistA Laboratory Anatomic Pathology (AP) Modifications/Enhancements patch 
"BLD",5314,1,52,0)
LR*5.2*317 addresses two patient safety issues (PSI) reported in PSI-04-025 
"BLD",5314,1,53,0)
that arose from the release and implementation of the VistA Laboratory 
"BLD",5314,1,54,0)
Anatomic Pathology Electronic Signature Patch LR*5.2*259.
"BLD",5314,1,55,0)
 
"BLD",5314,1,56,0)
The patient safety issues are described as follows:
"BLD",5314,1,57,0)
 
"BLD",5314,1,58,0)
1. Users that should not be allowed to modify an Anatomic Pathology SF515 or 
"BLD",5314,1,59,0)
Autopsy Protocol released report are given access to the Modify released report 
"BLD",5314,1,60,0)
[LRAPMRL] option in order to allow the user to add supplementary reports.
"BLD",5314,1,61,0)
 
"BLD",5314,1,62,0)
2. The original Anatomic Pathology SF515 or Autopsy Protocol report is not 
"BLD",5314,1,63,0)
viewable in the Computer Patient Records System (CPRS) during the time a 
"BLD",5314,1,64,0)
supplementary report is underway. Personnel are unable to view the report 
"BLD",5314,1,65,0)
during this time.
"BLD",5314,1,66,0)
 
"BLD",5314,1,67,0)
The VistA Laboratory Anatomic Pathology Electronic Signature Patch 
"BLD",5314,1,68,0)
LR*5.2*259 changed the location and the method by which supplementary 
"BLD",5314,1,69,0)
reports are added. The Modify released report [LRAPMRL] option is used to add 
"BLD",5314,1,70,0)
supplementary reports to the original report. Laboratory personnel allowed to 
"BLD",5314,1,71,0)
add supplementary reports to Anatomic Pathology released reports must have 
"BLD",5314,1,72,0)
access to the Modify released report [LRAPMRL] option. This access opened up 
"BLD",5314,1,73,0)
the potential for errors in which the report could be accidentally modified 
"BLD",5314,1,74,0)
when a supplementary report was added.
"BLD",5314,1,75,0)
 
"BLD",5314,1,76,0)
Patch LR*5.2*317 resolves this problem by removing the supplementary report 
"BLD",5314,1,77,0)
addition functionality from the Modify released reports [LRAPMRL] option and 
"BLD",5314,1,78,0)
placing the functionality back to the Supplementary Report, Anat Path 
"BLD",5314,1,79,0)
[LRAPDSR] option for Cytology, Electron Microscopy, and Surgical Pathology 
"BLD",5314,1,80,0)
released reports and the Autopsy supplementary report [LRAPAUSR] option for 
"BLD",5314,1,81,0)
Autopsy released reports.
"BLD",5314,1,82,0)
 
"BLD",5314,1,83,0)
Another concern had to do with the addition of a supplementary report to a 
"BLD",5314,1,84,0)
released Anatomic Pathology report, which unreleased the original report and 
"BLD",5314,1,85,0)
made it unavailable for viewing in Computerized Patient Record System (CPRS).
"BLD",5314,1,86,0)
The time span in which the original report remained unavailable for viewing by 
"BLD",5314,1,87,0)
the Providers could be crucial. It was considered a major patient safety issue 
"BLD",5314,1,88,0)
if a doctor, who was with a patient, was not able to view the report at that 
"BLD",5314,1,89,0)
time.
"BLD",5314,1,90,0)
 
"BLD",5314,1,91,0)
Patch LR*5.2*317 resolves this problem by leaving the original report in 
"BLD",5314,1,92,0)
released status during the time a supplementary report is being added. The 
"BLD",5314,1,93,0)
original report remains available for viewing in CPRS during this time.
"BLD",5314,1,94,0)
 
"BLD",5314,1,95,0)
Enhancements to LAB DATA file (#63):
"BLD",5314,1,96,0)
-------------
"BLD",5314,1,97,0)
A new field, RELEASE SUPP REPORT MODIFIED (#.03), has been added to the 
"BLD",5314,1,98,0)
SUPPLEMENTARY REPORT SUB-FILE for the anatomic pathology sections 
"BLD",5314,1,99,0)
Cytopathology, Electron Microscopy, and Surgical Pathology; and to 
"BLD",5314,1,100,0)
the AUTOPSY SUPPLEMENTARY REPORT for Autopsy.  The field is a flag, when 
"BLD",5314,1,101,0)
set to '1', indicates a released supplementary report is being modified, 
"BLD",5314,1,102,0)
and has not yet been released.
"BLD",5314,1,103,0)
 
"BLD",5314,1,104,0)
63.207,.03    RELEASE SUPP REPORT MODIFIED 0;3 SET
"BLD",5314,1,105,0)
 
"BLD",5314,1,106,0)
                                 '1' FOR YES; 
"BLD",5314,1,107,0)
                                 '0' FOR NO; 
"BLD",5314,1,108,0)
              LAST EDITED:      SEP 08, 2004 
"BLD",5314,1,109,0)
              DESCRIPTION:      This flag will be set to '1' when a
"BLD",5314,1,110,0)
                  released supplementary report is modified. It is
"BLD",5314,1,111,0)
                  removed when the modified supplementary report is
"BLD",5314,1,112,0)
                  released.  
"BLD",5314,1,113,0)
 
"BLD",5314,1,114,0)
63.817,.03    RELEASE SUPP REPORT MODIFIED 0;3 SET
"BLD",5314,1,115,0)
 
"BLD",5314,1,116,0)
                                 '1' FOR YES; 
"BLD",5314,1,117,0)
                                 '0' FOR NO; 
"BLD",5314,1,118,0)
               LAST EDITED:      SEP 08, 2004 
"BLD",5314,1,119,0)
               DESCRIPTION:      This flag will be set to '1' when a 
"BLD",5314,1,120,0)
                released supplementary report is modified. It is 
"BLD",5314,1,121,0)
                removed when the modified supplementary report is
"BLD",5314,1,122,0)
                released.  
"BLD",5314,1,123,0)
 
"BLD",5314,1,124,0)
63.907,.03    RELEASE SUPP REPORT MODIFIED 0;3 SET
"BLD",5314,1,125,0)
 
"BLD",5314,1,126,0)
                                 '1' FOR YES; 
"BLD",5314,1,127,0)
                                 '0' FOR NO; 
"BLD",5314,1,128,0)
               LAST EDITED:      SEP 08, 2004 
"BLD",5314,1,129,0)
               DESCRIPTION:      This flag will be set to '1' when a 
"BLD",5314,1,130,0)
                 released supplementary report is modified.  It is
"BLD",5314,1,131,0)
                 removed when the modified supplementary report is
"BLD",5314,1,132,0)
                 released.  
"BLD",5314,1,133,0)
 
"BLD",5314,1,134,0)
63.324,.03    RELEASE SUPP REPORT MODIFIED 0;3 SET
"BLD",5314,1,135,0)
 
"BLD",5314,1,136,0)
                                 '1' FOR YES; 
"BLD",5314,1,137,0)
                                 '0' FOR NO; 
"BLD",5314,1,138,0)
               LAST EDITED:      SEP 08, 2004 
"BLD",5314,1,139,0)
               DESCRIPTION:      This flag will be set to '1' when a 
"BLD",5314,1,140,0)
                released supplementary report is modified. It is        
"BLD",5314,1,141,0)
                removed when the modified supplementary report is
"BLD",5314,1,142,0)
                released. 
"BLD",5314,1,143,0)
 
"BLD",5314,1,144,0)
Modifications:
"BLD",5314,1,145,0)
--------------
"BLD",5314,1,146,0)
The following options have been modified. Please refer to the User 
"BLD",5314,1,147,0)
Guide distributed with this patch for detailed information and examples.
"BLD",5314,1,148,0)
 
"BLD",5314,1,149,0)
Supplementary Report, Anat Path [LRAPDSR] option
"BLD",5314,1,150,0)
Supplementary report release, anat path [LRAPRS] option
"BLD",5314,1,151,0)
Autopsy supplementary report [LRAPAUSR] option
"BLD",5314,1,152,0)
Modify released pathology report [LRAPMRL] option 
"BLD",5314,1,153,0)
Print all reports on queue [LRAP PRINT ALL ON QUEUE] option
"BLD",5314,1,154,0)
Print single report only [LRAP PRINT SINGLE] option
"BLD",5314,1,155,0)
Print final path reports by accession # [LRAPFICH] option
"BLD",5314,1,156,0)
 
"BLD",5314,1,157,0)
 
"BLD",5314,1,158,0)
This patch addresses the following E3R's:
"BLD",5314,1,159,0)
========================================
"BLD",5314,1,160,0)
N/A
"BLD",5314,1,161,0)
 
"BLD",5314,1,162,0)
 
"BLD",5314,1,163,0)
This patch addresses the following NOIS / Remedy Ticket:
"BLD",5314,1,164,0)
=======================================================
"BLD",5314,1,165,0)
BRX-0704-11083 / HD0000000070862
"BLD",5314,1,166,0)
CPH-0904-40215 / HD0000000070983
"BLD",5314,1,167,0)
MIA-0604-31201 / HD0000000070788
"BLD",5314,1,168,0)
PRO-0604-10213 / HD0000000070762
"BLD",5314,1,169,0)
SLC-0604-50484 / HD0000000070766
"BLD",5314,1,170,0)
SLC-0604-50594 / HD0000000070769
"BLD",5314,1,171,0)
SLC-0604-51082 / H00000000070778
"BLD",5314,1,172,0)
 
"BLD",5314,1,173,0)
 
"BLD",5314,1,174,0)
Overview of NOIS / Remedy Tickets:
"BLD",5314,1,175,0)
=================================
"BLD",5314,1,176,0)
 
"BLD",5314,1,177,0)
BRX-0704-11083 / HD0000000070862
"BLD",5314,1,178,0)
Problem:  Pathologists are complaining about changes in procedure done
"BLD",5314,1,179,0)
by the Electronic Signature patch. When a supplemental report is added 
"BLD",5314,1,180,0)
the system un-verifies the parent report. This unverified report becomes 
"BLD",5314,1,181,0)
available for other Pathologists and transcriptionists to edit it. Before 
"BLD",5314,1,182,0)
once a report was verified it could not be changed. The Chief Pathologist 
"BLD",5314,1,183,0)
is very concerned with the legal and clinical ramifications of this change.
"BLD",5314,1,184,0)
 
"BLD",5314,1,185,0)
Resolution: The resolution of this issue is contained in the section 
"BLD",5314,1,186,0)
above that describes the resolution to patient safety issues #1 and #2.
"BLD",5314,1,187,0)
 
"BLD",5314,1,188,0)
CPH-0904-40215 / HD0000000070983 - 
"BLD",5314,1,189,0)
Problem:  Our pathologists are concerned that post patch 259, addition of 
"BLD",5314,1,190,0)
supplemental reports (additional information) must be added under MM Modify 
"BLD",5314,1,191,0)
option, thus un-releasing the original report, and necessitating the 
"BLD",5314,1,192,0)
re-release of both original and supplemental reports.  They feel modified 
"BLD",5314,1,193,0)
reports should be reserved for edition/correction of previous released 
"BLD",5314,1,194,0)
reports. They feel this is a patient safety issue.  
"BLD",5314,1,195,0)
The post 259 options [LRAPDSR] and [LRAPDSS] are redundant when they are 
"BLD",5314,1,196,0)
operable only with un-released reports.  
"BLD",5314,1,197,0)
 
"BLD",5314,1,198,0)
Resolution: The resolution of this issue is contained in the section 
"BLD",5314,1,199,0)
above that describes the resolution to patient safety issues #1 and #2.
"BLD",5314,1,200,0)
 
"BLD",5314,1,201,0)
MIA-0604-31201 / HD0000000070788 - 
"BLD",5314,1,202,0)
Problem:  According to our lab folks in Anatomic path they used to go in to 
"BLD",5314,1,203,0)
an option called Supplementary Report, Anat Path to make a correction to 
"BLD",5314,1,204,0)
the original after it is released.  They don't want to go under the edit 
"BLD",5314,1,205,0)
modify to reopen the report any ideas on how they can go into the 
"BLD",5314,1,206,0)
supplementary to attach to the original accession report or something like 
"BLD",5314,1,207,0)
that.  
"BLD",5314,1,208,0)
 
"BLD",5314,1,209,0)
Resolution: The resolution of this issue is contained in the section 
"BLD",5314,1,210,0)
above that describes the resolution to patient safety issues #1 and #2.
"BLD",5314,1,211,0)
 
"BLD",5314,1,212,0)
PRO-0604-10213 / HD0000000070762 - 
"BLD",5314,1,213,0)
Problem:  Our LAB Service Chief does not want IRM to install patch 
"BLD",5314,1,214,0)
LR*5.2*259 for the following  Patient Safety, integrity, and additional 
"BLD",5314,1,215,0)
keystrokes reasons.  For example the Surgical Pathology Reports, the new 
"BLD",5314,1,216,0)
patch, takes the Supplemental report feature away (ie. For a special 
"BLD",5314,1,217,0)
stain), it's replaced with a modified report feature, which allows you to 
"BLD",5314,1,218,0)
make changes to the original report in addition to adding.  Also, while  
"BLD",5314,1,219,0)
using the  modify report feature, while your in it, it makes the original 
"BLD",5314,1,220,0)
report unavailable for the Providers to view.  He feels that this is a 
"BLD",5314,1,221,0)
Major Patient Safety issue, that if a Doctor is with the patient, he won't 
"BLD",5314,1,222,0)
be able to view the report.  
"BLD",5314,1,223,0)
  
"BLD",5314,1,224,0)
Resolution: The resolution of this issue is contained in the section 
"BLD",5314,1,225,0)
above that describes the resolution to patient safety issues #1 and #2.
"BLD",5314,1,226,0)
 
"BLD",5314,1,227,0)
SLC-0604-50484 / HD0000000070766 - 
"BLD",5314,1,228,0)
Problem:  I've just reviewed the NOIS MEM-0504-71296, and we are struggling 
"BLD",5314,1,229,0)
with the same issues of supplementary reports that they are. (Post install 
"BLD",5314,1,230,0)
of patch LR*5.2*259).  We currently do not have the electronic signature 
"BLD",5314,1,231,0)
turned on.  The concern is, that once a report is unreleased, the 
"BLD",5314,1,232,0)
previously released portion of the report is not viewable on CPRS, and the 
"BLD",5314,1,233,0)
way we operate here is that the secretaries transcribe the report, and the 
"BLD",5314,1,234,0)
pathologist signs them sometime later.  We have only had the patch 
"BLD",5314,1,235,0)
installed for a couple of days, and the path lab has already received calls 
"BLD",5314,1,236,0)
that reports have "disappeared" on CPRS ... are there any suggestions for a 
"BLD",5314,1,237,0)
process change that could help with this?  
"BLD",5314,1,238,0)
 
"BLD",5314,1,239,0)
Resolution: The resolution of this issue is contained in the section 
"BLD",5314,1,240,0)
above that describes the resolution to patient safety issues #1 and #2.
"BLD",5314,1,241,0)
 
"BLD",5314,1,242,0)
SLC-0604-50594 / HD0000000070769 - 
"BLD",5314,1,243,0)
Problem:  Post installation of LA*5.2*259 we have encountered the usual 
"BLD",5314,1,244,0)
problems with any software install that changes the daily routine of 
"BLD",5314,1,245,0)
workflow, but there is a problem that we feel does affect patient care .  
"BLD",5314,1,246,0)
We now have to "unrelease" a report prior to adding a supplementary report, 
"BLD",5314,1,247,0)
the secretaries then transcribe the supplemental report, then the 
"BLD",5314,1,248,0)
pathologists must review/correct and sign it prior to the secretaries 
"BLD",5314,1,249,0)
re-releasing the report.  This leaves a window of several hours during 
"BLD",5314,1,250,0)
which the original report is not viewable on the computer, we have already 
"BLD",5314,1,251,0)
received calls about "disappearing" path reports.  Our pathologists feel 
"BLD",5314,1,252,0)
that a supplemental report should truly be regarded as an addendum to the 
"BLD",5314,1,253,0)
original report, and should not make the original report unviewable while 
"BLD",5314,1,254,0)
the supplemental report is being processed.    
"BLD",5314,1,255,0)
 
"BLD",5314,1,256,0)
Resolution: The resolution of this issue is contained in the section 
"BLD",5314,1,257,0)
above that describes the resolution to patient safety issues #1 and #2.
"BLD",5314,1,258,0)
 
"BLD",5314,1,259,0)
SLC-0604-51082 / H00000000070778 -
"BLD",5314,1,260,0)
Problem:  We have found a problem with the electronic signature patch.  Our 
"BLD",5314,1,261,0)
transcriptionist mistakenly selected the field to add a date to the 
"BLD",5314,1,262,0)
supplementary report field (thru edit/modify), but didn't add text to the 
"BLD",5314,1,263,0)
free text field.  He was unable to sign a supplementary report (the 
"BLD",5314,1,264,0)
computer says it doesn't exist), but when he tries to release the original 
"BLD",5314,1,265,0)
report, it says that the supplementary needs to be released first.  The lab 
"BLD",5314,1,266,0)
figured out a way to release this, but it is an issue.  
"BLD",5314,1,267,0)
 
"BLD",5314,1,268,0)
Resolution: The resolution of this issue is contained in the section 
"BLD",5314,1,269,0)
above that describes the resolution to patient safety issues #1 and #2.
"BLD",5314,1,270,0)
 
"BLD",5314,1,271,0)
 
"BLD",5314,1,272,0)
TEST SITES
"BLD",5314,1,273,0)
==========
"BLD",5314,1,274,0)
Ann Arbor VAMC  - CACHE/VMS, large site
"BLD",5314,1,275,0)
Boston HCS      - CACHE/VMS, large integrated site
"BLD",5314,1,276,0)
Long Beach VAMC - CACHE/VMS, large site
"BLD",5314,1,277,0)
Providence VAMC - CACHE/VMS, medium site
"BLD",5314,1,278,0)
Salem VAMC      - CACHE/VMS, medium site
"BLD",5314,1,279,0)
 
"BLD",5314,1,280,0)
ROUTINE SUMMARY:
"BLD",5314,1,281,0)
================
"BLD",5314,1,282,0)
The following is a list of the routines included  in this patch.  
"BLD",5314,1,283,0)
The second line of each of these routines look like:
"BLD",5314,1,284,0)
 
"BLD",5314,1,285,0)
   <tab> ;;5.2;LAB SERVICE;**<patch list>;Sep 27, 1994
"BLD",5314,1,286,0)
 
"BLD",5314,1,287,0)
Using old logic:
"BLD",5314,1,288,0)
 
"BLD",5314,1,289,0)
                       CHECK^XTSUMBLD results
"BLD",5314,1,290,0)
   Routine        Before     After        
"BLD",5314,1,291,0)
   Name           Patch      Patch                Patch List
"BLD",5314,1,292,0)
   -----------    --------   ---------    ----------------------------
"BLD",5314,1,293,0)
   LR317            N/A       6221288     **317** (DELETED BY KIDS)
"BLD",5314,1,294,0)
   LR7OSAP        16576063   17166196     **121,187,230,256,259,317**
"BLD",5314,1,295,0)
   LR7OSAP1        8012437    8222916     **121,227,230,259,317**
"BLD",5314,1,296,0)
   LR7OSAP2       17315095   18146154     **230,256,259,317**
"BLD",5314,1,297,0)
   LRAPAUSR        7980343    8097532     **1,173,248,259,317**
"BLD",5314,1,298,0)
   LRAPBR1         8346961    8691424     **259,317**
"BLD",5314,1,299,0)
   LRAPBR4         5636439    5950657     **259,317**
"BLD",5314,1,300,0)
   LRAPD1          5673315    5050395     **41,91,248,259,317**
"BLD",5314,1,301,0)
   LRAPDA         11977101   13331988     **72,73,91,121,248,259,295,317**
"BLD",5314,1,302,0)
   LRAPDSR         4820936    5708731     **248,259,295,317**
"BLD",5314,1,303,0)
   LRAPMRL         8314291    8358357     **259,295,317**
"BLD",5314,1,304,0)
   LRAPMRL1        4140484    5097223     **259,317**
"BLD",5314,1,305,0)
   LRAPR          12791716   12536700     **72,248,259,317**
"BLD",5314,1,306,0)
   LRAPR1           N/A       5253992     **317**
"BLD",5314,1,307,0)
   LRAPRES        10849835   10161024     **259,295,317**
"BLD",5314,1,308,0)
   LRAPV           3996189    4248185     **72,201,259,317**
"BLD",5314,1,309,0)
   LRSPRPT        12082607   12449414     **1,72,248,259,317**
"BLD",5314,1,310,0)
 
"BLD",5314,1,311,0)
 
"BLD",5314,1,312,0)
Using new logic:
"BLD",5314,1,313,0)
                       CHECK1^XTSUMBLD results
"BLD",5314,1,314,0)
   Routine        Before     After        
"BLD",5314,1,315,0)
   Name           Patch      Patch                Patch List
"BLD",5314,1,316,0)
   -----------    --------   ---------    ----------------------------
"BLD",5314,1,317,0)
   LR317            N/A       18182916     **317** (DELETED BY KIDS)
"BLD",5314,1,318,0)
   LR7OSAP        34114559    37919526     **121,187,230,256,259,317**
"BLD",5314,1,319,0)
   LR7OSAP1       24974232    26109314     **121,227,230,259,317**
"BLD",5314,1,320,0)
   LR7OSAP2       52834321    59162352     **230,256,259,317**
"BLD",5314,1,321,0)
   LRAPAUSR       34065623    34793694     **1,173,248,259,317**
"BLD",5314,1,322,0)
   LRAPBR1        54673575    58834636     **259,317**
"BLD",5314,1,323,0)
   LRAPBR4        30127062    32957954     **259,317**
"BLD",5314,1,324,0)
   LRAPD1         24077474    22198195     **41,91,248,259,317**
"BLD",5314,1,325,0)
   LRAPDA         64317056    76606340  **72,73,91,121,248,259,295,317**
"BLD",5314,1,326,0)
   LRAPDSR        17788838    25438900     **248,259,295,317**
"BLD",5314,1,327,0)
   LRAPMRL        66524711    21952067     **259,295,317**
"BLD",5314,1,328,0)
   LRAPMRL1       15484610    21952067     **259,317**
"BLD",5314,1,329,0)
   LRAPR          89817361    84430863     **72,248,259,317**
"BLD",5314,1,330,0)
   LRAPR1           N/A       19317428     **317**
"BLD",5314,1,331,0)
   LRAPRES       103360947    94733481     **259,295,317**
"BLD",5314,1,332,0)
   LRAPV         13932043     15077938     **72,201,259,317**
"BLD",5314,1,333,0)
   LRSPRPT       88845330     92562557     **1,72,248,259,317**
"BLD",5314,1,334,0)
 
"BLD",5314,1,335,0)
   NOTE:  LR317 will be deleted after successful patch installation.
"BLD",5314,1,336,0)
 
"BLD",5314,1,337,0)
 
"BLD",5314,1,338,0)
SOFTWARE RETRIEVAL:
"BLD",5314,1,339,0)
===================
"BLD",5314,1,340,0)
  
"BLD",5314,1,341,0)
Software Retrieval
"BLD",5314,1,342,0)
------------------
"BLD",5314,1,343,0)
VistA Laboratory Anatomic Pathology Modifications/Enhancements 
"BLD",5314,1,344,0)
to Address PSI-04-025 Patch LR*5.2*317 software is distributed by 
"BLD",5314,1,345,0)
Packman.
"BLD",5314,1,346,0)
 
"BLD",5314,1,347,0)
Documentation Retrieval
"BLD",5314,1,348,0)
-----------------------
"BLD",5314,1,349,0)
VistA Laboratory Anatomic Pathology (AP) Modifications/Enhancements 
"BLD",5314,1,350,0)
to Address PSI-04-025 Patch LR*5.2*317 User Guide is available at the 
"BLD",5314,1,351,0)
following Office of Information Field Offices (OIFOs) ANONYMOUS.SOFTWARE 
"BLD",5314,1,352,0)
directories:
"BLD",5314,1,353,0)
 
"BLD",5314,1,354,0)
OI Field Office    FTP Address                 Directory
"BLD",5314,1,355,0)
---------------    -----------                 ---------
"BLD",5314,1,356,0)
ALBANY             ftp.fo-albany.med.va.gov    [ANONYMOUS.SOFTWARE]
"BLD",5314,1,357,0)
HINES              ftp.fo-hines.med.va.gov     [ANONYMOUS.SOFTWARE]
"BLD",5314,1,358,0)
SALT LAKE CITY     ftp.fo-slc.med.va.gov       [ANONYMOUS.SOFTWARE]
"BLD",5314,1,359,0)
 
"BLD",5314,1,360,0)
 
"BLD",5314,1,361,0)
Documentation Retrieval Formats
"BLD",5314,1,362,0)
-------------------------------
"BLD",5314,1,363,0)
VistA Laboratory Anatomic Pathology Supplementary Report Enhancements 
"BLD",5314,1,364,0)
Patch LR*5.2*317 User Guide files are exported in the following retrieval 
"BLD",5314,1,365,0)
formats:
"BLD",5314,1,366,0)
 
"BLD",5314,1,367,0)
File Name           Contents                        Retrieval Formats
"BLD",5314,1,368,0)
---------           --------                        -----------------
"BLD",5314,1,369,0)
LAB_52_317_UG.doc   VistA Laboratory Anatomic Pathology
"BLD",5314,1,370,0)
                     (AP) Modifications/Enhancements 
"BLD",5314,1,371,0)
                     to Address PSI-04-025 Patch 
"BLD",5314,1,372,0)
                     LR*5.2*317 User Guide                   BINARY
"BLD",5314,1,373,0)
 
"BLD",5314,1,374,0)
 LAB_52_317_UG.pdf   VistA Laboratory Anatomic Pathology
"BLD",5314,1,375,0)
                     (AP) Modifications/Enhancements
"BLD",5314,1,376,0)
                      to Address PSI-04-025 Patch
"BLD",5314,1,377,0)
                      LR*5.2*317 User Guide                  BINARY
"BLD",5314,1,378,0)
 
"BLD",5314,1,379,0)
VistA Website Locations:
"BLD",5314,1,380,0)
-----------------------
"BLD",5314,1,381,0)
VistA Laboratory Anatomic Pathology (AP) Modifications/Enhancements 
"BLD",5314,1,382,0)
to Address PSI-04-025 Patch LR*5.2*317 User Guide is accessible in 
"BLD",5314,1,383,0)
MS Word (.doc) and Portable Document Format (.pdf) at the following 
"BLD",5314,1,384,0)
VistA locations:
"BLD",5314,1,385,0)
 
"BLD",5314,1,386,0)
Laboratory Version 5.2 Home Page
"BLD",5314,1,387,0)
--------------------------------
"BLD",5314,1,388,0)
http://vista.med.va.gov/ClinicalSpecialties/lab/
"BLD",5314,1,389,0)
 
"BLD",5314,1,390,0)
VistA Documentation Library (VDL)
"BLD",5314,1,391,0)
---------------------------------
"BLD",5314,1,392,0)
www.va.gov/vdl/
"BLD",5314,1,393,0)
 
"BLD",5314,1,394,0)
 
"BLD",5314,1,395,0)
INSTALLATION INSTRUCTIONS
"BLD",5314,1,396,0)
=========================
"BLD",5314,1,397,0)
This patch can be installed with users on the system.  However, it is 
"BLD",5314,1,398,0)
recommended that installation occur when there is no Anatomic Pathology
"BLD",5314,1,399,0)
activity or activity is at a minimum.  This will prevent 'Cannot return to 
"BLD",5314,1,400,0)
source routine' errors.  The Anatomic Pathology menu will be disabled 
"BLD",5314,1,401,0)
automatically by this patch and re-enabled after installation.
"BLD",5314,1,402,0)
 
"BLD",5314,1,403,0)
Install Time - less than 5 minutes.
"BLD",5314,1,404,0)
 
"BLD",5314,1,405,0)
PRE-INSTALLATION INSTRUCTIONS
"BLD",5314,1,406,0)
=============================
"BLD",5314,1,407,0)
 
"BLD",5314,1,408,0)
***************************************************************************
"BLD",5314,1,409,0)
*** IT IS VERY IMPORTANT THAT YOU FOLLOW THE PRE-INSTALLATION           ***
"BLD",5314,1,410,0)
*** INSTRUCTIONS BEFORE INSTALLING THE PATCH.                           ***
"BLD",5314,1,411,0)
***                                                                     ***
"BLD",5314,1,412,0)
*** All outstanding (unreleased) supplementary reports from July 23,    *** 
"BLD",5314,1,413,0)
*** 2003, the date LR*5.2*259 Anatomic Pathology Electronic Signature   ***
"BLD",5314,1,414,0)
*** patch was first installed in a production account, until the present***
"BLD",5314,1,415,0)
*** MUST be released before installing this patch.  If there are        ***
"BLD",5314,1,416,0)
*** unverified supplementary reports, THE PATCH WILL NOT INSTALL.       *** 
"BLD",5314,1,417,0)
***                                                                     ***
"BLD",5314,1,418,0)
*** The appropriate Laboratory personnel should check for unverified    ***
"BLD",5314,1,419,0)
*** supplementary reports and make sure all are reviewed and released   ***
"BLD",5314,1,420,0)
*** before proceeding with this installation.  The following option     ***
"BLD",5314,1,421,0)
*** can be used to check for outstanding unreleased supplementary       ***
"BLD",5314,1,422,0)
*** reports:  List of unverified pathology reports [LRAPV] option.      ***
"BLD",5314,1,423,0)
*** Selection #2 will create a listing of unverified supplementary      ***
"BLD",5314,1,424,0)
*** reports.                                                            ***
"BLD",5314,1,425,0)
**************************************************************************
"BLD",5314,1,426,0)
**************************************************************************
"BLD",5314,1,427,0)
 
"BLD",5314,1,428,0)
1.     LOAD TRANSPORT GLOBAL
"BLD",5314,1,429,0)
       ---------------------------------------
"BLD",5314,1,430,0)
       Choose the PackMan message containing this patch and invoke the 
"BLD",5314,1,431,0)
       INSTALL/CHECK   MESSAGE PackMan option.
"BLD",5314,1,432,0)
 
"BLD",5314,1,433,0)
2.     START UP KIDS
"BLD",5314,1,434,0)
       Start up the Kernel Installation and distribution System 
"BLD",5314,1,435,0)
       Menu [XPD MAIN]:
"BLD",5314,1,436,0)
               Edits and Distribution ...
"BLD",5314,1,437,0)
                        Utilities ...
"BLD",5314,1,438,0)
                        Installation ...       
"BLD",5314,1,439,0)
       Select Kernel Installation & Distribution System Option:  INStallation
"BLD",5314,1,440,0)
                                                                 ----
"BLD",5314,1,441,0)
               1      Load a Distribution
"BLD",5314,1,442,0)
               2      Verify Checksums in Transport Global
"BLD",5314,1,443,0)
               3      Print Transport Global
"BLD",5314,1,444,0)
               4      Compare Transport Global to Current System
"BLD",5314,1,445,0)
               5      Backup a Transport Global
"BLD",5314,1,446,0)
               6      Install Package(s)
"BLD",5314,1,447,0)
                      Restart Install of Package(s)
"BLD",5314,1,448,0)
                      Unload a Distribution
"BLD",5314,1,449,0)
               DD     DD, 2nd Line Comparison
"BLD",5314,1,450,0)
       
"BLD",5314,1,451,0)
       Select Installation Option:                 
"BLD",5314,1,452,0)
 
"BLD",5314,1,453,0)
 
"BLD",5314,1,454,0)
3.     Select Installation Option:
"BLD",5314,1,455,0)
       -------------------------------
"BLD",5314,1,456,0)
       NOTE:  The following are OPTIONAL - (When prompted for the 
"BLD",5314,1,457,0)
       INSTALL NAME, enter LR*5.2*317):
"BLD",5314,1,458,0)
       a.  Backup a Transport Global - This option will create a 
"BLD",5314,1,459,0)
           backup message of any routines exported with this patch. 
"BLD",5314,1,460,0)
          It will not backup any other changes such as DD's or templates.
"BLD",5314,1,461,0)
       b.  Compare Transport Global to Current System - This option 
"BLD",5314,1,462,0)
           will allow you to view all changes that will be made when this 
"BLD",5314,1,463,0)
          patch is installed. It compares all components of this patch 
"BLD",5314,1,464,0)
          (routines, DD's, templates, etc.).
"BLD",5314,1,465,0)
       c.  Verify Checksums in Transport Global - This option will  
"BLD",5314,1,466,0)
           allow you to ensure the integrity of the routines that are in 
"BLD",5314,1,467,0)
           the transport global.
"BLD",5314,1,468,0)
     
"BLD",5314,1,469,0)
4.     Select Installation Option:  Install Package(s) 
"BLD",5314,1,470,0)
                                    ------------------
"BLD",5314,1,471,0)
       **This is the step to start the installation of this KIDS patch: 
"BLD",5314,1,472,0)
   
"BLD",5314,1,473,0)
       a.  Choose the Install Package(s) option to start the patch install.
"BLD",5314,1,474,0)
          (When prompted for the INSTALL NAME, enter LR*5.2*317.)
"BLD",5314,1,475,0)
       b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
"BLD",5314,1,476,0)
           YES//' answer NO (unless otherwise indicated)
"BLD",5314,1,477,0)
       c.  When prompted 'Want to DISABLE Scheduled Options, Menu Options,
"BLD",5314,1,478,0)
           and Protocols? YES//' answer NO (unless otherwise indicated)
"BLD",5314,1,479,0)
                 
"BLD",5314,1,480,0)
5.   If you have any unreleased supplementary reports from July 23, 2003
"BLD",5314,1,481,0)
       until the present, the install will abort.  To print the unreleased
"BLD",5314,1,482,0)
       supplementary reports, you can print the install file.
"BLD",5314,1,483,0)
       Here's an example:
"BLD",5314,1,484,0)
 
"BLD",5314,1,485,0)
Select Kernel Installation & Distribution System Option: utilities
"BLD",5314,1,486,0)
 
"BLD",5314,1,487,0)
Select Utilities Option: install File Print
"BLD",5314,1,488,0)
Select INSTALL NAME: lr*5.2*317   Loaded from Distribution  8/25/06@14:37:36       
"BLD",5314,1,489,0)
 
"BLD",5314,1,490,0)
DEVICE: HOME// ;;1000  UCX/TELNET
"BLD",5314,1,491,0)
 
"BLD",5314,1,492,0)
 
"BLD",5314,1,493,0)
PACKAGE: LR*5.2*317     Aug 25, 2006 2:39 pm                         PAGE 1
"BLD",5314,1,494,0)
                                             COMPLETED            ELAPSED
"BLD",5314,1,495,0)
---------------------------------------------------------------------------
"BLD",5314,1,496,0)
INSTALLED BY: IRM,PERSON
"BLD",5314,1,497,0)
NATIONAL PACKAGE: LAB SERVICE
"BLD",5314,1,498,0)
 
"BLD",5314,1,499,0)
INSTALL STARTED: 
"BLD",5314,1,500,0)
 
"BLD",5314,1,501,0)
ROUTINES:                                                        
"BLD",5314,1,502,0)
 
"BLD",5314,1,503,0)
PRE-INIT CHECK POINTS:
"BLD",5314,1,504,0)
XPD PREINSTALL STARTED                                           
"BLD",5314,1,505,0)
XPD PREINSTALL COMPLETED                                         
"BLD",5314,1,506,0)
 
"BLD",5314,1,507,0)
FILES:
"BLD",5314,1,508,0)
LAB DATA                                                         
"BLD",5314,1,509,0)
 
"BLD",5314,1,510,0)
POST-INIT CHECK POINTS:
"BLD",5314,1,511,0)
XPD POSTINSTALL STARTED                                          
"BLD",5314,1,512,0)
XPD POSTINSTALL COMPLETED                                        
"BLD",5314,1,513,0)
 
"BLD",5314,1,514,0)
MESSAGES:
"BLD",5314,1,515,0)
 
"BLD",5314,1,516,0)
           Sending transport global loaded alert to mail group G.LMI 
"BLD",5314,1,517,0)
            
"BLD",5314,1,518,0)
 
"BLD",5314,1,519,0)
Unreleased supplemental report(s) from July 23,2003 until present- must 
"BLD",5314,1,520,0)
be released before install.
"BLD",5314,1,521,0)
 
"BLD",5314,1,522,0)
 
"BLD",5314,1,523,0)
                     Name: TEST,PATIENT  Accession: NSP 04 2 
"BLD",5314,1,524,0)
                      
"BLD",5314,1,525,0)
 
"BLD",5314,1,526,0)
                    --- Install Environment Check FAILED 
"BLD",5314,1,527,0)
---                    
"BLD",5314,1,528,0)
 
"BLD",5314,1,529,0)
LR*5.2*317 Build will not be installed
"BLD",5314,1,530,0)
               Aug 25, 2006@14:38:55
"BLD",5314,1,531,0)
 
"BLD",5314,1,532,0)
 
"BLD",5314,1,533,0)
Select Utilities Option: 
"BLD",5314,1,534,0)
         
"BLD",5314,1,535,0)
 
"BLD",5314,1,536,0)
**NOTE: Routine LR317 will be deleted after successful patch installation.
"BLD",5314,4,0)
^9.64PA^63^1
"BLD",5314,4,63,0)
63
"BLD",5314,4,63,2,0)
^9.641^63.907^4
"BLD",5314,4,63,2,63.207,0)
SUPPLEMENTARY REPORT  (sub-file)
"BLD",5314,4,63,2,63.207,1,0)
^9.6411^.03^1
"BLD",5314,4,63,2,63.207,1,.03,0)
RELEASE SUPP REPORT MODIFIED
"BLD",5314,4,63,2,63.324,0)
AUTOPSY SUPPLEMENTARY REPORT  (sub-file)
"BLD",5314,4,63,2,63.324,1,0)
^9.6411^.03^1
"BLD",5314,4,63,2,63.324,1,.03,0)
RELEASE SUPP REPORT MODIFIED
"BLD",5314,4,63,2,63.817,0)
SUPPLEMENTARY REPORT  (sub-file)
"BLD",5314,4,63,2,63.817,1,0)
^9.6411^.03^1
"BLD",5314,4,63,2,63.817,1,.03,0)
RELEASE SUPP REPORT MODIFIED
"BLD",5314,4,63,2,63.907,0)
SUPPLEMENTARY REPORT  (sub-file)
"BLD",5314,4,63,2,63.907,1,0)
^9.6411^.03^1
"BLD",5314,4,63,2,63.907,1,.03,0)
RELEASE SUPP REPORT MODIFIED
"BLD",5314,4,63,222)
y^n^p^^^^n^^n
"BLD",5314,4,63,224)

"BLD",5314,4,"APDD",63,63.207)

"BLD",5314,4,"APDD",63,63.207,.03)

"BLD",5314,4,"APDD",63,63.324)

"BLD",5314,4,"APDD",63,63.324,.03)

"BLD",5314,4,"APDD",63,63.817)

"BLD",5314,4,"APDD",63,63.817,.03)

"BLD",5314,4,"APDD",63,63.907)

"BLD",5314,4,"APDD",63,63.907,.03)

"BLD",5314,4,"B",63,63)

"BLD",5314,6)
24^
"BLD",5314,"ABPKG")
n
"BLD",5314,"INI")
PRE^LR317
"BLD",5314,"INID")
n^n^n
"BLD",5314,"INIT")
POST^LR317
"BLD",5314,"KRN",0)
^9.67PA^8989.52^19
"BLD",5314,"KRN",.4,0)
.4
"BLD",5314,"KRN",.401,0)
.401
"BLD",5314,"KRN",.402,0)
.402
"BLD",5314,"KRN",.403,0)
.403
"BLD",5314,"KRN",.5,0)
.5
"BLD",5314,"KRN",.84,0)
.84
"BLD",5314,"KRN",3.6,0)
3.6
"BLD",5314,"KRN",3.8,0)
3.8
"BLD",5314,"KRN",9.2,0)
9.2
"BLD",5314,"KRN",9.8,0)
9.8
"BLD",5314,"KRN",9.8,"NM",0)
^9.68A^18^16
"BLD",5314,"KRN",9.8,"NM",1,0)
LRAPR^^0^B84430863
"BLD",5314,"KRN",9.8,"NM",3,0)
LRAPDA^^0^B76606340
"BLD",5314,"KRN",9.8,"NM",4,0)
LRAPMRL^^0^B65434742
"BLD",5314,"KRN",9.8,"NM",5,0)
LRAPMRL1^^0^B21952067
"BLD",5314,"KRN",9.8,"NM",6,0)
LRAPDSR^^0^B25438900
"BLD",5314,"KRN",9.8,"NM",7,0)
LRAPD1^^0^B22198195
"BLD",5314,"KRN",9.8,"NM",8,0)
LRAPRES^^0^B94733481
"BLD",5314,"KRN",9.8,"NM",10,0)
LR7OSAP^^0^B37919526
"BLD",5314,"KRN",9.8,"NM",11,0)
LR7OSAP2^^0^B59162352
"BLD",5314,"KRN",9.8,"NM",12,0)
LRAPR1^^0^B19317428
"BLD",5314,"KRN",9.8,"NM",13,0)
LRAPAUSR^^0^B34793694
"BLD",5314,"KRN",9.8,"NM",14,0)
LR7OSAP1^^0^B26109314
"BLD",5314,"KRN",9.8,"NM",15,0)
LRSPRPT^^0^B92562557
"BLD",5314,"KRN",9.8,"NM",16,0)
LRAPV^^0^B15077938
"BLD",5314,"KRN",9.8,"NM",17,0)
LRAPBR1^^0^B58834636
"BLD",5314,"KRN",9.8,"NM",18,0)
LRAPBR4^^0^B32957954
"BLD",5314,"KRN",9.8,"NM","B","LR7OSAP",10)

"BLD",5314,"KRN",9.8,"NM","B","LR7OSAP1",14)

"BLD",5314,"KRN",9.8,"NM","B","LR7OSAP2",11)

"BLD",5314,"KRN",9.8,"NM","B","LRAPAUSR",13)

"BLD",5314,"KRN",9.8,"NM","B","LRAPBR1",17)

"BLD",5314,"KRN",9.8,"NM","B","LRAPBR4",18)

"BLD",5314,"KRN",9.8,"NM","B","LRAPD1",7)

"BLD",5314,"KRN",9.8,"NM","B","LRAPDA",3)

"BLD",5314,"KRN",9.8,"NM","B","LRAPDSR",6)

"BLD",5314,"KRN",9.8,"NM","B","LRAPMRL",4)

"BLD",5314,"KRN",9.8,"NM","B","LRAPMRL1",5)

"BLD",5314,"KRN",9.8,"NM","B","LRAPR",1)

"BLD",5314,"KRN",9.8,"NM","B","LRAPR1",12)

"BLD",5314,"KRN",9.8,"NM","B","LRAPRES",8)

"BLD",5314,"KRN",9.8,"NM","B","LRAPV",16)

"BLD",5314,"KRN",9.8,"NM","B","LRSPRPT",15)

"BLD",5314,"KRN",19,0)
19
"BLD",5314,"KRN",19,"NM",0)
^9.68A^^
"BLD",5314,"KRN",19.1,0)
19.1
"BLD",5314,"KRN",101,0)
101
"BLD",5314,"KRN",409.61,0)
409.61
"BLD",5314,"KRN",771,0)
771
"BLD",5314,"KRN",870,0)
870
"BLD",5314,"KRN",8989.51,0)
8989.51
"BLD",5314,"KRN",8989.52,0)
8989.52
"BLD",5314,"KRN",8994,0)
8994
"BLD",5314,"KRN","B",.4,.4)

"BLD",5314,"KRN","B",.401,.401)

"BLD",5314,"KRN","B",.402,.402)

"BLD",5314,"KRN","B",.403,.403)

"BLD",5314,"KRN","B",.5,.5)

"BLD",5314,"KRN","B",.84,.84)

"BLD",5314,"KRN","B",3.6,3.6)

"BLD",5314,"KRN","B",3.8,3.8)

"BLD",5314,"KRN","B",9.2,9.2)

"BLD",5314,"KRN","B",9.8,9.8)

"BLD",5314,"KRN","B",19,19)

"BLD",5314,"KRN","B",19.1,19.1)

"BLD",5314,"KRN","B",101,101)

"BLD",5314,"KRN","B",409.61,409.61)

"BLD",5314,"KRN","B",771,771)

"BLD",5314,"KRN","B",870,870)

"BLD",5314,"KRN","B",8989.51,8989.51)

"BLD",5314,"KRN","B",8989.52,8989.52)

"BLD",5314,"KRN","B",8994,8994)

"BLD",5314,"PRE")
LR317
"BLD",5314,"QUES",0)
^9.62^^
"BLD",5314,"REQB",0)
^9.611^2^2
"BLD",5314,"REQB",1,0)
LR*5.2*259^1
"BLD",5314,"REQB",2,0)
LR*5.2*295^1
"BLD",5314,"REQB","B","LR*5.2*259",1)

"BLD",5314,"REQB","B","LR*5.2*295",2)

"FIA",63)
LAB DATA
"FIA",63,0)
^LR(
"FIA",63,0,0)
63
"FIA",63,0,1)
y^n^p^^^^n^^n
"FIA",63,0,10)

"FIA",63,0,11)

"FIA",63,0,"RLRO")

"FIA",63,0,"VR")
5.2^LR
"FIA",63,63)
1
"FIA",63,63.207)
1
"FIA",63,63.207,.03)

"FIA",63,63.324)
1
"FIA",63,63.324,.03)

"FIA",63,63.817)
1
"FIA",63,63.817,.03)

"FIA",63,63.907)
1
"FIA",63,63.907,.03)

"INI")
PRE^LR317
"INIT")
POST^LR317
"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2941128
"PKG",26,22,1,"PAH",1,0)
317^3061030^6473
"PKG",26,22,1,"PAH",1,1,0)
^^536^536^3061030
"PKG",26,22,1,"PAH",1,1,1,0)
Description:
"PKG",26,22,1,"PAH",1,1,2,0)
===========
"PKG",26,22,1,"PAH",1,1,3,0)
 
"PKG",26,22,1,"PAH",1,1,4,0)
               ************************************
"PKG",26,22,1,"PAH",1,1,5,0)
*************************************************************************
"PKG",26,22,1,"PAH",1,1,6,0)
SPECIAL NOTE:  
"PKG",26,22,1,"PAH",1,1,7,0)
Installation of this patch MUST be coordinated with Laboratory personnel.  
"PKG",26,22,1,"PAH",1,1,8,0)
The Pre-Installation instructions within the Installation Section below, 
"PKG",26,22,1,"PAH",1,1,9,0)
MUST be followed and completed before installation can begin.
"PKG",26,22,1,"PAH",1,1,10,0)
*************************************************************************
"PKG",26,22,1,"PAH",1,1,11,0)
               ************************************
"PKG",26,22,1,"PAH",1,1,12,0)
 
"PKG",26,22,1,"PAH",1,1,13,0)
BLOOD BANK CLEARANCE
"PKG",26,22,1,"PAH",1,1,14,0)
====================
"PKG",26,22,1,"PAH",1,1,15,0)
 
"PKG",26,22,1,"PAH",1,1,16,0)
VISTA Laboratory Package patch LR*5.2*317 contains changes to 
"PKG",26,22,1,"PAH",1,1,17,0)
software controlled by VHA DIRECTIVE 2004-053, titled VISTA BLOOD 
"PKG",26,22,1,"PAH",1,1,18,0)
BANK SOFTWARE. Changes include: 
"PKG",26,22,1,"PAH",1,1,19,0)
File     Sub-file     Field   Field Name                      Action
"PKG",26,22,1,"PAH",1,1,20,0)
----     --------     -----   ----------                      ------
"PKG",26,22,1,"PAH",1,1,21,0)
63       63.207       .03     RELEASE SUPP REPORT MODIFIED    New Field
"PKG",26,22,1,"PAH",1,1,22,0)
63       63.324       .03     RELEASE SUPP REPORT MODIFIED    New Field
"PKG",26,22,1,"PAH",1,1,23,0)
63       63.817       .03     RELEASE SUPP REPORT MODIFIED    New Field
"PKG",26,22,1,"PAH",1,1,24,0)
63       63.907       .03     RELEASE SUPP REPORT MODIFIED    New Field
"PKG",26,22,1,"PAH",1,1,25,0)
 
"PKG",26,22,1,"PAH",1,1,26,0)
All of the above changes have been reviewed by the VISTA Blood Bank 
"PKG",26,22,1,"PAH",1,1,27,0)
Developer and found to have no impact on the VISTA BLOOD BANK 
"PKG",26,22,1,"PAH",1,1,28,0)
SOFTWARE control functions.
"PKG",26,22,1,"PAH",1,1,29,0)
 
"PKG",26,22,1,"PAH",1,1,30,0)
RISK ANALYSIS: Changes made by patch LR*5.2*317 have no effect on 
"PKG",26,22,1,"PAH",1,1,31,0)
Blood Bank software functionality, therefore RISK is none.
"PKG",26,22,1,"PAH",1,1,32,0)
 
"PKG",26,22,1,"PAH",1,1,33,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LR*5.2*317 does 
"PKG",26,22,1,"PAH",1,1,34,0)
not alter or modify any software design safeguards or safety 
"PKG",26,22,1,"PAH",1,1,35,0)
critical elements functions.
"PKG",26,22,1,"PAH",1,1,36,0)
 
"PKG",26,22,1,"PAH",1,1,37,0)
POTENTIAL IMPACT ON SITES: This patch contains changes to 0 
"PKG",26,22,1,"PAH",1,1,38,0)
routines and 1 file identified in Veterans Health Administration 
"PKG",26,22,1,"PAH",1,1,39,0)
(VHA) Directive 2004-053, group B listing. The changes have no 
"PKG",26,22,1,"PAH",1,1,40,0)
effect on Blood Bank functionality or medical device control 
"PKG",26,22,1,"PAH",1,1,41,0)
functions. There is no adverse potential to sites.
"PKG",26,22,1,"PAH",1,1,42,0)
 
"PKG",26,22,1,"PAH",1,1,43,0)
VALIDATION REQUIREMENTS BY OPTION: 
"PKG",26,22,1,"PAH",1,1,44,0)
There are no validation requirements associated with this patch.
"PKG",26,22,1,"PAH",1,1,45,0)
 
"PKG",26,22,1,"PAH",1,1,46,0)
MINIMAL TEST CASE SCENARIOS BY OPTION, INCLUSIVE OF ALL CONTROL FUNCTIONS:
"PKG",26,22,1,"PAH",1,1,47,0)
There are no test case scenarios associated with this patch.
"PKG",26,22,1,"PAH",1,1,48,0)
 
"PKG",26,22,1,"PAH",1,1,49,0)
=================
"PKG",26,22,1,"PAH",1,1,50,0)
 
"PKG",26,22,1,"PAH",1,1,51,0)
VistA Laboratory Anatomic Pathology (AP) Modifications/Enhancements patch 
"PKG",26,22,1,"PAH",1,1,52,0)
LR*5.2*317 addresses two patient safety issues (PSI) reported in PSI-04-025 
"PKG",26,22,1,"PAH",1,1,53,0)
that arose from the release and implementation of the VistA Laboratory 
"PKG",26,22,1,"PAH",1,1,54,0)
Anatomic Pathology Electronic Signature Patch LR*5.2*259.
"PKG",26,22,1,"PAH",1,1,55,0)
 
"PKG",26,22,1,"PAH",1,1,56,0)
The patient safety issues are described as follows:
"PKG",26,22,1,"PAH",1,1,57,0)
 
"PKG",26,22,1,"PAH",1,1,58,0)
1. Users that should not be allowed to modify an Anatomic Pathology SF515 or 
"PKG",26,22,1,"PAH",1,1,59,0)
Autopsy Protocol released report are given access to the Modify released report 
"PKG",26,22,1,"PAH",1,1,60,0)
[LRAPMRL] option in order to allow the user to add supplementary reports.
"PKG",26,22,1,"PAH",1,1,61,0)
 
"PKG",26,22,1,"PAH",1,1,62,0)
2. The original Anatomic Pathology SF515 or Autopsy Protocol report is not 
"PKG",26,22,1,"PAH",1,1,63,0)
viewable in the Computer Patient Records System (CPRS) during the time a 
"PKG",26,22,1,"PAH",1,1,64,0)
supplementary report is underway. Personnel are unable to view the report 
"PKG",26,22,1,"PAH",1,1,65,0)
during this time.
"PKG",26,22,1,"PAH",1,1,66,0)
 
"PKG",26,22,1,"PAH",1,1,67,0)
The VistA Laboratory Anatomic Pathology Electronic Signature Patch 
"PKG",26,22,1,"PAH",1,1,68,0)
LR*5.2*259 changed the location and the method by which supplementary 
"PKG",26,22,1,"PAH",1,1,69,0)
reports are added. The Modify released report [LRAPMRL] option is used to add 
"PKG",26,22,1,"PAH",1,1,70,0)
supplementary reports to the original report. Laboratory personnel allowed to 
"PKG",26,22,1,"PAH",1,1,71,0)
add supplementary reports to Anatomic Pathology released reports must have 
"PKG",26,22,1,"PAH",1,1,72,0)
access to the Modify released report [LRAPMRL] option. This access opened up 
"PKG",26,22,1,"PAH",1,1,73,0)
the potential for errors in which the report could be accidentally modified 
"PKG",26,22,1,"PAH",1,1,74,0)
when a supplementary report was added.
"PKG",26,22,1,"PAH",1,1,75,0)
 
"PKG",26,22,1,"PAH",1,1,76,0)
Patch LR*5.2*317 resolves this problem by removing the supplementary report 
"PKG",26,22,1,"PAH",1,1,77,0)
addition functionality from the Modify released reports [LRAPMRL] option and 
"PKG",26,22,1,"PAH",1,1,78,0)
placing the functionality back to the Supplementary Report, Anat Path 
"PKG",26,22,1,"PAH",1,1,79,0)
[LRAPDSR] option for Cytology, Electron Microscopy, and Surgical Pathology 
"PKG",26,22,1,"PAH",1,1,80,0)
released reports and the Autopsy supplementary report [LRAPAUSR] option for 
"PKG",26,22,1,"PAH",1,1,81,0)
Autopsy released reports.
"PKG",26,22,1,"PAH",1,1,82,0)
 
"PKG",26,22,1,"PAH",1,1,83,0)
Another concern had to do with the addition of a supplementary report to a 
"PKG",26,22,1,"PAH",1,1,84,0)
released Anatomic Pathology report, which unreleased the original report and 
"PKG",26,22,1,"PAH",1,1,85,0)
made it unavailable for viewing in Computerized Patient Record System (CPRS).
"PKG",26,22,1,"PAH",1,1,86,0)
The time span in which the original report remained unavailable for viewing by 
"PKG",26,22,1,"PAH",1,1,87,0)
the Providers could be crucial. It was considered a major patient safety issue 
"PKG",26,22,1,"PAH",1,1,88,0)
if a doctor, who was with a patient, was not able to view the report at that 
"PKG",26,22,1,"PAH",1,1,89,0)
time.
"PKG",26,22,1,"PAH",1,1,90,0)
 
"PKG",26,22,1,"PAH",1,1,91,0)
Patch LR*5.2*317 resolves this problem by leaving the original report in 
"PKG",26,22,1,"PAH",1,1,92,0)
released status during the time a supplementary report is being added. The 
"PKG",26,22,1,"PAH",1,1,93,0)
original report remains available for viewing in CPRS during this time.
"PKG",26,22,1,"PAH",1,1,94,0)
 
"PKG",26,22,1,"PAH",1,1,95,0)
Enhancements to LAB DATA file (#63):
"PKG",26,22,1,"PAH",1,1,96,0)
-------------
"PKG",26,22,1,"PAH",1,1,97,0)
A new field, RELEASE SUPP REPORT MODIFIED (#.03), has been added to the 
"PKG",26,22,1,"PAH",1,1,98,0)
SUPPLEMENTARY REPORT SUB-FILE for the anatomic pathology sections 
"PKG",26,22,1,"PAH",1,1,99,0)
Cytopathology, Electron Microscopy, and Surgical Pathology; and to 
"PKG",26,22,1,"PAH",1,1,100,0)
the AUTOPSY SUPPLEMENTARY REPORT for Autopsy.  The field is a flag, when 
"PKG",26,22,1,"PAH",1,1,101,0)
set to '1', indicates a released supplementary report is being modified, 
"PKG",26,22,1,"PAH",1,1,102,0)
and has not yet been released.
"PKG",26,22,1,"PAH",1,1,103,0)
 
"PKG",26,22,1,"PAH",1,1,104,0)
63.207,.03    RELEASE SUPP REPORT MODIFIED 0;3 SET
"PKG",26,22,1,"PAH",1,1,105,0)
 
"PKG",26,22,1,"PAH",1,1,106,0)
                                 '1' FOR YES; 
"PKG",26,22,1,"PAH",1,1,107,0)
                                 '0' FOR NO; 
"PKG",26,22,1,"PAH",1,1,108,0)
              LAST EDITED:      SEP 08, 2004 
"PKG",26,22,1,"PAH",1,1,109,0)
              DESCRIPTION:      This flag will be set to '1' when a
"PKG",26,22,1,"PAH",1,1,110,0)
                  released supplementary report is modified. It is
"PKG",26,22,1,"PAH",1,1,111,0)
                  removed when the modified supplementary report is
"PKG",26,22,1,"PAH",1,1,112,0)
                  released.  
"PKG",26,22,1,"PAH",1,1,113,0)
 
"PKG",26,22,1,"PAH",1,1,114,0)
63.817,.03    RELEASE SUPP REPORT MODIFIED 0;3 SET
"PKG",26,22,1,"PAH",1,1,115,0)
 
"PKG",26,22,1,"PAH",1,1,116,0)
                                 '1' FOR YES; 
"PKG",26,22,1,"PAH",1,1,117,0)
                                 '0' FOR NO; 
"PKG",26,22,1,"PAH",1,1,118,0)
               LAST EDITED:      SEP 08, 2004 
"PKG",26,22,1,"PAH",1,1,119,0)
               DESCRIPTION:      This flag will be set to '1' when a 
"PKG",26,22,1,"PAH",1,1,120,0)
                released supplementary report is modified. It is 
"PKG",26,22,1,"PAH",1,1,121,0)
                removed when the modified supplementary report is
"PKG",26,22,1,"PAH",1,1,122,0)
                released.  
"PKG",26,22,1,"PAH",1,1,123,0)
 
"PKG",26,22,1,"PAH",1,1,124,0)
63.907,.03    RELEASE SUPP REPORT MODIFIED 0;3 SET
"PKG",26,22,1,"PAH",1,1,125,0)
 
"PKG",26,22,1,"PAH",1,1,126,0)
                                 '1' FOR YES; 
"PKG",26,22,1,"PAH",1,1,127,0)
                                 '0' FOR NO; 
"PKG",26,22,1,"PAH",1,1,128,0)
               LAST EDITED:      SEP 08, 2004 
"PKG",26,22,1,"PAH",1,1,129,0)
               DESCRIPTION:      This flag will be set to '1' when a 
"PKG",26,22,1,"PAH",1,1,130,0)
                 released supplementary report is modified.  It is
"PKG",26,22,1,"PAH",1,1,131,0)
                 removed when the modified supplementary report is
"PKG",26,22,1,"PAH",1,1,132,0)
                 released.  
"PKG",26,22,1,"PAH",1,1,133,0)
 
"PKG",26,22,1,"PAH",1,1,134,0)
63.324,.03    RELEASE SUPP REPORT MODIFIED 0;3 SET
"PKG",26,22,1,"PAH",1,1,135,0)
 
"PKG",26,22,1,"PAH",1,1,136,0)
                                 '1' FOR YES; 
"PKG",26,22,1,"PAH",1,1,137,0)
                                 '0' FOR NO; 
"PKG",26,22,1,"PAH",1,1,138,0)
               LAST EDITED:      SEP 08, 2004 
"PKG",26,22,1,"PAH",1,1,139,0)
               DESCRIPTION:      This flag will be set to '1' when a 
"PKG",26,22,1,"PAH",1,1,140,0)
                released supplementary report is modified. It is        
"PKG",26,22,1,"PAH",1,1,141,0)
                removed when the modified supplementary report is
"PKG",26,22,1,"PAH",1,1,142,0)
                released. 
"PKG",26,22,1,"PAH",1,1,143,0)
 
"PKG",26,22,1,"PAH",1,1,144,0)
Modifications:
"PKG",26,22,1,"PAH",1,1,145,0)
--------------
"PKG",26,22,1,"PAH",1,1,146,0)
The following options have been modified. Please refer to the User 
"PKG",26,22,1,"PAH",1,1,147,0)
Guide distributed with this patch for detailed information and examples.
"PKG",26,22,1,"PAH",1,1,148,0)
 
"PKG",26,22,1,"PAH",1,1,149,0)
Supplementary Report, Anat Path [LRAPDSR] option
"PKG",26,22,1,"PAH",1,1,150,0)
Supplementary report release, anat path [LRAPRS] option
"PKG",26,22,1,"PAH",1,1,151,0)
Autopsy supplementary report [LRAPAUSR] option
"PKG",26,22,1,"PAH",1,1,152,0)
Modify released pathology report [LRAPMRL] option 
"PKG",26,22,1,"PAH",1,1,153,0)
Print all reports on queue [LRAP PRINT ALL ON QUEUE] option
"PKG",26,22,1,"PAH",1,1,154,0)
Print single report only [LRAP PRINT SINGLE] option
"PKG",26,22,1,"PAH",1,1,155,0)
Print final path reports by accession # [LRAPFICH] option
"PKG",26,22,1,"PAH",1,1,156,0)
 
"PKG",26,22,1,"PAH",1,1,157,0)
 
"PKG",26,22,1,"PAH",1,1,158,0)
This patch addresses the following E3R's:
"PKG",26,22,1,"PAH",1,1,159,0)
========================================
"PKG",26,22,1,"PAH",1,1,160,0)
N/A
"PKG",26,22,1,"PAH",1,1,161,0)
 
"PKG",26,22,1,"PAH",1,1,162,0)
 
"PKG",26,22,1,"PAH",1,1,163,0)
This patch addresses the following NOIS / Remedy Ticket:
"PKG",26,22,1,"PAH",1,1,164,0)
=======================================================
"PKG",26,22,1,"PAH",1,1,165,0)
BRX-0704-11083 / HD0000000070862
"PKG",26,22,1,"PAH",1,1,166,0)
CPH-0904-40215 / HD0000000070983
"PKG",26,22,1,"PAH",1,1,167,0)
MIA-0604-31201 / HD0000000070788
"PKG",26,22,1,"PAH",1,1,168,0)
PRO-0604-10213 / HD0000000070762
"PKG",26,22,1,"PAH",1,1,169,0)
SLC-0604-50484 / HD0000000070766
"PKG",26,22,1,"PAH",1,1,170,0)
SLC-0604-50594 / HD0000000070769
"PKG",26,22,1,"PAH",1,1,171,0)
SLC-0604-51082 / H00000000070778
"PKG",26,22,1,"PAH",1,1,172,0)
 
"PKG",26,22,1,"PAH",1,1,173,0)
 
"PKG",26,22,1,"PAH",1,1,174,0)
Overview of NOIS / Remedy Tickets:
"PKG",26,22,1,"PAH",1,1,175,0)
=================================
"PKG",26,22,1,"PAH",1,1,176,0)
 
"PKG",26,22,1,"PAH",1,1,177,0)
BRX-0704-11083 / HD0000000070862
"PKG",26,22,1,"PAH",1,1,178,0)
Problem:  Pathologists are complaining about changes in procedure done
"PKG",26,22,1,"PAH",1,1,179,0)
by the Electronic Signature patch. When a supplemental report is added 
"PKG",26,22,1,"PAH",1,1,180,0)
the system un-verifies the parent report. This unverified report becomes 
"PKG",26,22,1,"PAH",1,1,181,0)
available for other Pathologists and transcriptionists to edit it. Before 
"PKG",26,22,1,"PAH",1,1,182,0)
once a report was verified it could not be changed. The Chief Pathologist 
"PKG",26,22,1,"PAH",1,1,183,0)
is very concerned with the legal and clinical ramifications of this change.
"PKG",26,22,1,"PAH",1,1,184,0)
 
"PKG",26,22,1,"PAH",1,1,185,0)
Resolution: The resolution of this issue is contained in the section 
"PKG",26,22,1,"PAH",1,1,186,0)
above that describes the resolution to patient safety issues #1 and #2.
"PKG",26,22,1,"PAH",1,1,187,0)
 
"PKG",26,22,1,"PAH",1,1,188,0)
CPH-0904-40215 / HD0000000070983 - 
"PKG",26,22,1,"PAH",1,1,189,0)
Problem:  Our pathologists are concerned that post patch 259, addition of 
"PKG",26,22,1,"PAH",1,1,190,0)
supplemental reports (additional information) must be added under MM Modify 
"PKG",26,22,1,"PAH",1,1,191,0)
option, thus un-releasing the original report, and necessitating the 
"PKG",26,22,1,"PAH",1,1,192,0)
re-release of both original and supplemental reports.  They feel modified 
"PKG",26,22,1,"PAH",1,1,193,0)
reports should be reserved for edition/correction of previous released 
"PKG",26,22,1,"PAH",1,1,194,0)
reports. They feel this is a patient safety issue.  
"PKG",26,22,1,"PAH",1,1,195,0)
The post 259 options [LRAPDSR] and [LRAPDSS] are redundant when they are 
"PKG",26,22,1,"PAH",1,1,196,0)
operable only with un-released reports.  
"PKG",26,22,1,"PAH",1,1,197,0)
 
"PKG",26,22,1,"PAH",1,1,198,0)
Resolution: The resolution of this issue is contained in the section 
"PKG",26,22,1,"PAH",1,1,199,0)
above that describes the resolution to patient safety issues #1 and #2.
"PKG",26,22,1,"PAH",1,1,200,0)
 
"PKG",26,22,1,"PAH",1,1,201,0)
MIA-0604-31201 / HD0000000070788 - 
"PKG",26,22,1,"PAH",1,1,202,0)
Problem:  According to our lab folks in Anatomic path they used to go in to 
"PKG",26,22,1,"PAH",1,1,203,0)
an option called Supplementary Report, Anat Path to make a correction to 
"PKG",26,22,1,"PAH",1,1,204,0)
the original after it is released.  They don't want to go under the edit 
"PKG",26,22,1,"PAH",1,1,205,0)
modify to reopen the report any ideas on how they can go into the 
"PKG",26,22,1,"PAH",1,1,206,0)
supplementary to attach to the original accession report or something like 
"PKG",26,22,1,"PAH",1,1,207,0)
that.  
"PKG",26,22,1,"PAH",1,1,208,0)
 
"PKG",26,22,1,"PAH",1,1,209,0)
Resolution: The resolution of this issue is contained in the section 
"PKG",26,22,1,"PAH",1,1,210,0)
above that describes the resolution to patient safety issues #1 and #2.
"PKG",26,22,1,"PAH",1,1,211,0)
 
"PKG",26,22,1,"PAH",1,1,212,0)
PRO-0604-10213 / HD0000000070762 - 
"PKG",26,22,1,"PAH",1,1,213,0)
Problem:  Our LAB Service Chief does not want IRM to install patch 
"PKG",26,22,1,"PAH",1,1,214,0)
LR*5.2*259 for the following  Patient Safety, integrity, and additional 
"PKG",26,22,1,"PAH",1,1,215,0)
keystrokes reasons.  For example the Surgical Pathology Reports, the new 
"PKG",26,22,1,"PAH",1,1,216,0)
patch, takes the Supplemental report feature away (ie. For a special 
"PKG",26,22,1,"PAH",1,1,217,0)
stain), it's replaced with a modified report feature, which allows you to 
"PKG",26,22,1,"PAH",1,1,218,0)
make changes to the original report in addition to adding.  Also, while  
"PKG",26,22,1,"PAH",1,1,219,0)
using the  modify report feature, while your in it, it makes the original 
"PKG",26,22,1,"PAH",1,1,220,0)
report unavailable for the Providers to view.  He feels that this is a 
"PKG",26,22,1,"PAH",1,1,221,0)
Major Patient Safety issue, that if a Doctor is with the patient, he won't 
"PKG",26,22,1,"PAH",1,1,222,0)
be able to view the report.  
"PKG",26,22,1,"PAH",1,1,223,0)
  
"PKG",26,22,1,"PAH",1,1,224,0)
Resolution: The resolution of this issue is contained in the section 
"PKG",26,22,1,"PAH",1,1,225,0)
above that describes the resolution to patient safety issues #1 and #2.
"PKG",26,22,1,"PAH",1,1,226,0)
 
"PKG",26,22,1,"PAH",1,1,227,0)
SLC-0604-50484 / HD0000000070766 - 
"PKG",26,22,1,"PAH",1,1,228,0)
Problem:  I've just reviewed the NOIS MEM-0504-71296, and we are struggling 
"PKG",26,22,1,"PAH",1,1,229,0)
with the same issues of supplementary reports that they are. (Post install 
"PKG",26,22,1,"PAH",1,1,230,0)
of patch LR*5.2*259).  We currently do not have the electronic signature 
"PKG",26,22,1,"PAH",1,1,231,0)
turned on.  The concern is, that once a report is unreleased, the 
"PKG",26,22,1,"PAH",1,1,232,0)
previously released portion of the report is not viewable on CPRS, and the 
"PKG",26,22,1,"PAH",1,1,233,0)
way we operate here is that the secretaries transcribe the report, and the 
"PKG",26,22,1,"PAH",1,1,234,0)
pathologist signs them sometime later.  We have only had the patch 
"PKG",26,22,1,"PAH",1,1,235,0)
installed for a couple of days, and the path lab has already received calls 
"PKG",26,22,1,"PAH",1,1,236,0)
that reports have "disappeared" on CPRS ... are there any suggestions for a 
"PKG",26,22,1,"PAH",1,1,237,0)
process change that could help with this?  
"PKG",26,22,1,"PAH",1,1,238,0)
 
"PKG",26,22,1,"PAH",1,1,239,0)
Resolution: The resolution of this issue is contained in the section 
"PKG",26,22,1,"PAH",1,1,240,0)
above that describes the resolution to patient safety issues #1 and #2.
"PKG",26,22,1,"PAH",1,1,241,0)
 
"PKG",26,22,1,"PAH",1,1,242,0)
SLC-0604-50594 / HD0000000070769 - 
"PKG",26,22,1,"PAH",1,1,243,0)
Problem:  Post installation of LA*5.2*259 we have encountered the usual 
"PKG",26,22,1,"PAH",1,1,244,0)
problems with any software install that changes the daily routine of 
"PKG",26,22,1,"PAH",1,1,245,0)
workflow, but there is a problem that we feel does affect patient care .  
"PKG",26,22,1,"PAH",1,1,246,0)
We now have to "unrelease" a report prior to adding a supplementary report, 
"PKG",26,22,1,"PAH",1,1,247,0)
the secretaries then transcribe the supplemental report, then the 
"PKG",26,22,1,"PAH",1,1,248,0)
pathologists must review/correct and sign it prior to the secretaries 
"PKG",26,22,1,"PAH",1,1,249,0)
re-releasing the report.  This leaves a window of several hours during 
"PKG",26,22,1,"PAH",1,1,250,0)
which the original report is not viewable on the computer, we have already 
"PKG",26,22,1,"PAH",1,1,251,0)
received calls about "disappearing" path reports.  Our pathologists feel 
"PKG",26,22,1,"PAH",1,1,252,0)
that a supplemental report should truly be regarded as an addendum to the 
"PKG",26,22,1,"PAH",1,1,253,0)
original report, and should not make the original report unviewable while 
"PKG",26,22,1,"PAH",1,1,254,0)
the supplemental report is being processed.    
"PKG",26,22,1,"PAH",1,1,255,0)
 
"PKG",26,22,1,"PAH",1,1,256,0)
Resolution: The resolution of this issue is contained in the section 
"PKG",26,22,1,"PAH",1,1,257,0)
above that describes the resolution to patient safety issues #1 and #2.
"PKG",26,22,1,"PAH",1,1,258,0)
 
"PKG",26,22,1,"PAH",1,1,259,0)
SLC-0604-51082 / H00000000070778 -
"PKG",26,22,1,"PAH",1,1,260,0)
Problem:  We have found a problem with the electronic signature patch.  Our 
"PKG",26,22,1,"PAH",1,1,261,0)
transcriptionist mistakenly selected the field to add a date to the 
"PKG",26,22,1,"PAH",1,1,262,0)
supplementary report field (thru edit/modify), but didn't add text to the 
"PKG",26,22,1,"PAH",1,1,263,0)
free text field.  He was unable to sign a supplementary report (the 
"PKG",26,22,1,"PAH",1,1,264,0)
computer says it doesn't exist), but when he tries to release the original 
"PKG",26,22,1,"PAH",1,1,265,0)
report, it says that the supplementary needs to be released first.  The lab 
"PKG",26,22,1,"PAH",1,1,266,0)
figured out a way to release this, but it is an issue.  
"PKG",26,22,1,"PAH",1,1,267,0)
 
"PKG",26,22,1,"PAH",1,1,268,0)
Resolution: The resolution of this issue is contained in the section 
"PKG",26,22,1,"PAH",1,1,269,0)
above that describes the resolution to patient safety issues #1 and #2.
"PKG",26,22,1,"PAH",1,1,270,0)
 
"PKG",26,22,1,"PAH",1,1,271,0)
 
"PKG",26,22,1,"PAH",1,1,272,0)
TEST SITES
"PKG",26,22,1,"PAH",1,1,273,0)
==========
"PKG",26,22,1,"PAH",1,1,274,0)
Ann Arbor VAMC  - CACHE/VMS, large site
"PKG",26,22,1,"PAH",1,1,275,0)
Boston HCS      - CACHE/VMS, large integrated site
"PKG",26,22,1,"PAH",1,1,276,0)
Long Beach VAMC - CACHE/VMS, large site
"PKG",26,22,1,"PAH",1,1,277,0)
Providence VAMC - CACHE/VMS, medium site
"PKG",26,22,1,"PAH",1,1,278,0)
Salem VAMC      - CACHE/VMS, medium site
"PKG",26,22,1,"PAH",1,1,279,0)
 
"PKG",26,22,1,"PAH",1,1,280,0)
ROUTINE SUMMARY:
"PKG",26,22,1,"PAH",1,1,281,0)
================
"PKG",26,22,1,"PAH",1,1,282,0)
The following is a list of the routines included  in this patch.  
"PKG",26,22,1,"PAH",1,1,283,0)
The second line of each of these routines look like:
"PKG",26,22,1,"PAH",1,1,284,0)
 
"PKG",26,22,1,"PAH",1,1,285,0)
   <tab> ;;5.2;LAB SERVICE;**<patch list>;Sep 27, 1994
"PKG",26,22,1,"PAH",1,1,286,0)
 
"PKG",26,22,1,"PAH",1,1,287,0)
Using old logic:
"PKG",26,22,1,"PAH",1,1,288,0)
 
"PKG",26,22,1,"PAH",1,1,289,0)
                       CHECK^XTSUMBLD results
"PKG",26,22,1,"PAH",1,1,290,0)
   Routine        Before     After        
"PKG",26,22,1,"PAH",1,1,291,0)
   Name           Patch      Patch                Patch List
"PKG",26,22,1,"PAH",1,1,292,0)
   -----------    --------   ---------    ----------------------------
"PKG",26,22,1,"PAH",1,1,293,0)
   LR317            N/A       6221288     **317** (DELETED BY KIDS)
"PKG",26,22,1,"PAH",1,1,294,0)
   LR7OSAP        16576063   17166196     **121,187,230,256,259,317**
"PKG",26,22,1,"PAH",1,1,295,0)
   LR7OSAP1        8012437    8222916     **121,227,230,259,317**
"PKG",26,22,1,"PAH",1,1,296,0)
   LR7OSAP2       17315095   18146154     **230,256,259,317**
"PKG",26,22,1,"PAH",1,1,297,0)
   LRAPAUSR        7980343    8097532     **1,173,248,259,317**
"PKG",26,22,1,"PAH",1,1,298,0)
   LRAPBR1         8346961    8691424     **259,317**
"PKG",26,22,1,"PAH",1,1,299,0)
   LRAPBR4         5636439    5950657     **259,317**
"PKG",26,22,1,"PAH",1,1,300,0)
   LRAPD1          5673315    5050395     **41,91,248,259,317**
"PKG",26,22,1,"PAH",1,1,301,0)
   LRAPDA         11977101   13331988     **72,73,91,121,248,259,295,317**
"PKG",26,22,1,"PAH",1,1,302,0)
   LRAPDSR         4820936    5708731     **248,259,295,317**
"PKG",26,22,1,"PAH",1,1,303,0)
   LRAPMRL         8314291    8358357     **259,295,317**
"PKG",26,22,1,"PAH",1,1,304,0)
   LRAPMRL1        4140484    5097223     **259,317**
"PKG",26,22,1,"PAH",1,1,305,0)
   LRAPR          12791716   12536700     **72,248,259,317**
"PKG",26,22,1,"PAH",1,1,306,0)
   LRAPR1           N/A       5253992     **317**
"PKG",26,22,1,"PAH",1,1,307,0)
   LRAPRES        10849835   10161024     **259,295,317**
"PKG",26,22,1,"PAH",1,1,308,0)
   LRAPV           3996189    4248185     **72,201,259,317**
"PKG",26,22,1,"PAH",1,1,309,0)
   LRSPRPT        12082607   12449414     **1,72,248,259,317**
"PKG",26,22,1,"PAH",1,1,310,0)
 
"PKG",26,22,1,"PAH",1,1,311,0)
 
"PKG",26,22,1,"PAH",1,1,312,0)
Using new logic:
"PKG",26,22,1,"PAH",1,1,313,0)
                       CHECK1^XTSUMBLD results
"PKG",26,22,1,"PAH",1,1,314,0)
   Routine        Before     After        
"PKG",26,22,1,"PAH",1,1,315,0)
   Name           Patch      Patch                Patch List
"PKG",26,22,1,"PAH",1,1,316,0)
   -----------    --------   ---------    ----------------------------
"PKG",26,22,1,"PAH",1,1,317,0)
   LR317            N/A       18182916     **317** (DELETED BY KIDS)
"PKG",26,22,1,"PAH",1,1,318,0)
   LR7OSAP        34114559    37919526     **121,187,230,256,259,317**
"PKG",26,22,1,"PAH",1,1,319,0)
   LR7OSAP1       24974232    26109314     **121,227,230,259,317**
"PKG",26,22,1,"PAH",1,1,320,0)
   LR7OSAP2       52834321    59162352     **230,256,259,317**
"PKG",26,22,1,"PAH",1,1,321,0)
   LRAPAUSR       34065623    34793694     **1,173,248,259,317**
"PKG",26,22,1,"PAH",1,1,322,0)
   LRAPBR1        54673575    58834636     **259,317**
"PKG",26,22,1,"PAH",1,1,323,0)
   LRAPBR4        30127062    32957954     **259,317**
"PKG",26,22,1,"PAH",1,1,324,0)
   LRAPD1         24077474    22198195     **41,91,248,259,317**
"PKG",26,22,1,"PAH",1,1,325,0)
   LRAPDA         64317056    76606340  **72,73,91,121,248,259,295,317**
"PKG",26,22,1,"PAH",1,1,326,0)
   LRAPDSR        17788838    25438900     **248,259,295,317**
"PKG",26,22,1,"PAH",1,1,327,0)
   LRAPMRL        66524711    21952067     **259,295,317**
"PKG",26,22,1,"PAH",1,1,328,0)
   LRAPMRL1       15484610    21952067     **259,317**
"PKG",26,22,1,"PAH",1,1,329,0)
   LRAPR          89817361    84430863     **72,248,259,317**
"PKG",26,22,1,"PAH",1,1,330,0)
   LRAPR1           N/A       19317428     **317**
"PKG",26,22,1,"PAH",1,1,331,0)
   LRAPRES       103360947    94733481     **259,295,317**
"PKG",26,22,1,"PAH",1,1,332,0)
   LRAPV         13932043     15077938     **72,201,259,317**
"PKG",26,22,1,"PAH",1,1,333,0)
   LRSPRPT       88845330     92562557     **1,72,248,259,317**
"PKG",26,22,1,"PAH",1,1,334,0)
 
"PKG",26,22,1,"PAH",1,1,335,0)
   NOTE:  LR317 will be deleted after successful patch installation.
"PKG",26,22,1,"PAH",1,1,336,0)
 
"PKG",26,22,1,"PAH",1,1,337,0)
 
"PKG",26,22,1,"PAH",1,1,338,0)
SOFTWARE RETRIEVAL:
"PKG",26,22,1,"PAH",1,1,339,0)
===================
"PKG",26,22,1,"PAH",1,1,340,0)
  
"PKG",26,22,1,"PAH",1,1,341,0)
Software Retrieval
"PKG",26,22,1,"PAH",1,1,342,0)
------------------
"PKG",26,22,1,"PAH",1,1,343,0)
VistA Laboratory Anatomic Pathology Modifications/Enhancements 
"PKG",26,22,1,"PAH",1,1,344,0)
to Address PSI-04-025 Patch LR*5.2*317 software is distributed by 
"PKG",26,22,1,"PAH",1,1,345,0)
Packman.
"PKG",26,22,1,"PAH",1,1,346,0)
 
"PKG",26,22,1,"PAH",1,1,347,0)
Documentation Retrieval
"PKG",26,22,1,"PAH",1,1,348,0)
-----------------------
"PKG",26,22,1,"PAH",1,1,349,0)
VistA Laboratory Anatomic Pathology (AP) Modifications/Enhancements 
"PKG",26,22,1,"PAH",1,1,350,0)
to Address PSI-04-025 Patch LR*5.2*317 User Guide is available at the 
"PKG",26,22,1,"PAH",1,1,351,0)
following Office of Information Field Offices (OIFOs) ANONYMOUS.SOFTWARE 
"PKG",26,22,1,"PAH",1,1,352,0)
directories:
"PKG",26,22,1,"PAH",1,1,353,0)
 
"PKG",26,22,1,"PAH",1,1,354,0)
OI Field Office    FTP Address                 Directory
"PKG",26,22,1,"PAH",1,1,355,0)
---------------    -----------                 ---------
"PKG",26,22,1,"PAH",1,1,356,0)
ALBANY             ftp.fo-albany.med.va.gov    [ANONYMOUS.SOFTWARE]
"PKG",26,22,1,"PAH",1,1,357,0)
HINES              ftp.fo-hines.med.va.gov     [ANONYMOUS.SOFTWARE]
"PKG",26,22,1,"PAH",1,1,358,0)
SALT LAKE CITY     ftp.fo-slc.med.va.gov       [ANONYMOUS.SOFTWARE]
"PKG",26,22,1,"PAH",1,1,359,0)
 
"PKG",26,22,1,"PAH",1,1,360,0)
 
"PKG",26,22,1,"PAH",1,1,361,0)
Documentation Retrieval Formats
"PKG",26,22,1,"PAH",1,1,362,0)
-------------------------------
"PKG",26,22,1,"PAH",1,1,363,0)
VistA Laboratory Anatomic Pathology Supplementary Report Enhancements 
"PKG",26,22,1,"PAH",1,1,364,0)
Patch LR*5.2*317 User Guide files are exported in the following retrieval 
"PKG",26,22,1,"PAH",1,1,365,0)
formats:
"PKG",26,22,1,"PAH",1,1,366,0)
 
"PKG",26,22,1,"PAH",1,1,367,0)
File Name           Contents                        Retrieval Formats
"PKG",26,22,1,"PAH",1,1,368,0)
---------           --------                        -----------------
"PKG",26,22,1,"PAH",1,1,369,0)
LAB_52_317_UG.doc   VistA Laboratory Anatomic Pathology
"PKG",26,22,1,"PAH",1,1,370,0)
                     (AP) Modifications/Enhancements 
"PKG",26,22,1,"PAH",1,1,371,0)
                     to Address PSI-04-025 Patch 
"PKG",26,22,1,"PAH",1,1,372,0)
                     LR*5.2*317 User Guide                   BINARY
"PKG",26,22,1,"PAH",1,1,373,0)
 
"PKG",26,22,1,"PAH",1,1,374,0)
 LAB_52_317_UG.pdf   VistA Laboratory Anatomic Pathology
"PKG",26,22,1,"PAH",1,1,375,0)
                     (AP) Modifications/Enhancements
"PKG",26,22,1,"PAH",1,1,376,0)
                      to Address PSI-04-025 Patch
"PKG",26,22,1,"PAH",1,1,377,0)
                      LR*5.2*317 User Guide                  BINARY
"PKG",26,22,1,"PAH",1,1,378,0)
 
"PKG",26,22,1,"PAH",1,1,379,0)
VistA Website Locations:
"PKG",26,22,1,"PAH",1,1,380,0)
-----------------------
"PKG",26,22,1,"PAH",1,1,381,0)
VistA Laboratory Anatomic Pathology (AP) Modifications/Enhancements 
"PKG",26,22,1,"PAH",1,1,382,0)
to Address PSI-04-025 Patch LR*5.2*317 User Guide is accessible in 
"PKG",26,22,1,"PAH",1,1,383,0)
MS Word (.doc) and Portable Document Format (.pdf) at the following 
"PKG",26,22,1,"PAH",1,1,384,0)
VistA locations:
"PKG",26,22,1,"PAH",1,1,385,0)
 
"PKG",26,22,1,"PAH",1,1,386,0)
Laboratory Version 5.2 Home Page
"PKG",26,22,1,"PAH",1,1,387,0)
--------------------------------
"PKG",26,22,1,"PAH",1,1,388,0)
http://vista.med.va.gov/ClinicalSpecialties/lab/
"PKG",26,22,1,"PAH",1,1,389,0)
 
"PKG",26,22,1,"PAH",1,1,390,0)
VistA Documentation Library (VDL)
"PKG",26,22,1,"PAH",1,1,391,0)
---------------------------------
"PKG",26,22,1,"PAH",1,1,392,0)
www.va.gov/vdl/
"PKG",26,22,1,"PAH",1,1,393,0)
 
"PKG",26,22,1,"PAH",1,1,394,0)
 
"PKG",26,22,1,"PAH",1,1,395,0)
INSTALLATION INSTRUCTIONS
"PKG",26,22,1,"PAH",1,1,396,0)
=========================
"PKG",26,22,1,"PAH",1,1,397,0)
This patch can be installed with users on the system.  However, it is 
"PKG",26,22,1,"PAH",1,1,398,0)
recommended that installation occur when there is no Anatomic Pathology
"PKG",26,22,1,"PAH",1,1,399,0)
activity or activity is at a minimum.  This will prevent 'Cannot return to 
"PKG",26,22,1,"PAH",1,1,400,0)
source routine' errors.  The Anatomic Pathology menu will be disabled 
"PKG",26,22,1,"PAH",1,1,401,0)
automatically by this patch and re-enabled after installation.
"PKG",26,22,1,"PAH",1,1,402,0)
 
"PKG",26,22,1,"PAH",1,1,403,0)
Install Time - less than 5 minutes.
"PKG",26,22,1,"PAH",1,1,404,0)
 
"PKG",26,22,1,"PAH",1,1,405,0)
PRE-INSTALLATION INSTRUCTIONS
"PKG",26,22,1,"PAH",1,1,406,0)
=============================
"PKG",26,22,1,"PAH",1,1,407,0)
 
"PKG",26,22,1,"PAH",1,1,408,0)
***************************************************************************
"PKG",26,22,1,"PAH",1,1,409,0)
*** IT IS VERY IMPORTANT THAT YOU FOLLOW THE PRE-INSTALLATION           ***
"PKG",26,22,1,"PAH",1,1,410,0)
*** INSTRUCTIONS BEFORE INSTALLING THE PATCH.                           ***
"PKG",26,22,1,"PAH",1,1,411,0)
***                                                                     ***
"PKG",26,22,1,"PAH",1,1,412,0)
*** All outstanding (unreleased) supplementary reports from July 23,    *** 
"PKG",26,22,1,"PAH",1,1,413,0)
*** 2003, the date LR*5.2*259 Anatomic Pathology Electronic Signature   ***
"PKG",26,22,1,"PAH",1,1,414,0)
*** patch was first installed in a production account, until the present***
"PKG",26,22,1,"PAH",1,1,415,0)
*** MUST be released before installing this patch.  If there are        ***
"PKG",26,22,1,"PAH",1,1,416,0)
*** unverified supplementary reports, THE PATCH WILL NOT INSTALL.       *** 
"PKG",26,22,1,"PAH",1,1,417,0)
***                                                                     ***
"PKG",26,22,1,"PAH",1,1,418,0)
*** The appropriate Laboratory personnel should check for unverified    ***
"PKG",26,22,1,"PAH",1,1,419,0)
*** supplementary reports and make sure all are reviewed and released   ***
"PKG",26,22,1,"PAH",1,1,420,0)
*** before proceeding with this installation.  The following option     ***
"PKG",26,22,1,"PAH",1,1,421,0)
*** can be used to check for outstanding unreleased supplementary       ***
"PKG",26,22,1,"PAH",1,1,422,0)
*** reports:  List of unverified pathology reports [LRAPV] option.      ***
"PKG",26,22,1,"PAH",1,1,423,0)
*** Selection #2 will create a listing of unverified supplementary      ***
"PKG",26,22,1,"PAH",1,1,424,0)
*** reports.                                                            ***
"PKG",26,22,1,"PAH",1,1,425,0)
**************************************************************************
"PKG",26,22,1,"PAH",1,1,426,0)
**************************************************************************
"PKG",26,22,1,"PAH",1,1,427,0)
 
"PKG",26,22,1,"PAH",1,1,428,0)
1.     LOAD TRANSPORT GLOBAL
"PKG",26,22,1,"PAH",1,1,429,0)
       ---------------------------------------
"PKG",26,22,1,"PAH",1,1,430,0)
       Choose the PackMan message containing this patch and invoke the 
"PKG",26,22,1,"PAH",1,1,431,0)
       INSTALL/CHECK   MESSAGE PackMan option.
"PKG",26,22,1,"PAH",1,1,432,0)
 
"PKG",26,22,1,"PAH",1,1,433,0)
2.     START UP KIDS
"PKG",26,22,1,"PAH",1,1,434,0)
       Start up the Kernel Installation and distribution System 
"PKG",26,22,1,"PAH",1,1,435,0)
       Menu [XPD MAIN]:
"PKG",26,22,1,"PAH",1,1,436,0)
               Edits and Distribution ...
"PKG",26,22,1,"PAH",1,1,437,0)
                        Utilities ...
"PKG",26,22,1,"PAH",1,1,438,0)
                        Installation ...       
"PKG",26,22,1,"PAH",1,1,439,0)
       Select Kernel Installation & Distribution System Option:  INStallation
"PKG",26,22,1,"PAH",1,1,440,0)
                                                                 ----
"PKG",26,22,1,"PAH",1,1,441,0)
               1      Load a Distribution
"PKG",26,22,1,"PAH",1,1,442,0)
               2      Verify Checksums in Transport Global
"PKG",26,22,1,"PAH",1,1,443,0)
               3      Print Transport Global
"PKG",26,22,1,"PAH",1,1,444,0)
               4      Compare Transport Global to Current System
"PKG",26,22,1,"PAH",1,1,445,0)
               5      Backup a Transport Global
"PKG",26,22,1,"PAH",1,1,446,0)
               6      Install Package(s)
"PKG",26,22,1,"PAH",1,1,447,0)
                      Restart Install of Package(s)
"PKG",26,22,1,"PAH",1,1,448,0)
                      Unload a Distribution
"PKG",26,22,1,"PAH",1,1,449,0)
               DD     DD, 2nd Line Comparison
"PKG",26,22,1,"PAH",1,1,450,0)
       
"PKG",26,22,1,"PAH",1,1,451,0)
       Select Installation Option:                 
"PKG",26,22,1,"PAH",1,1,452,0)
 
"PKG",26,22,1,"PAH",1,1,453,0)
 
"PKG",26,22,1,"PAH",1,1,454,0)
3.     Select Installation Option:
"PKG",26,22,1,"PAH",1,1,455,0)
       -------------------------------
"PKG",26,22,1,"PAH",1,1,456,0)
       NOTE:  The following are OPTIONAL - (When prompted for the 
"PKG",26,22,1,"PAH",1,1,457,0)
       INSTALL NAME, enter LR*5.2*317):
"PKG",26,22,1,"PAH",1,1,458,0)
       a.  Backup a Transport Global - This option will create a 
"PKG",26,22,1,"PAH",1,1,459,0)
           backup message of any routines exported with this patch. 
"PKG",26,22,1,"PAH",1,1,460,0)
          It will not backup any other changes such as DD's or templates.
"PKG",26,22,1,"PAH",1,1,461,0)
       b.  Compare Transport Global to Current System - This option 
"PKG",26,22,1,"PAH",1,1,462,0)
           will allow you to view all changes that will be made when this 
"PKG",26,22,1,"PAH",1,1,463,0)
          patch is installed. It compares all components of this patch 
"PKG",26,22,1,"PAH",1,1,464,0)
          (routines, DD's, templates, etc.).
"PKG",26,22,1,"PAH",1,1,465,0)
       c.  Verify Checksums in Transport Global - This option will  
"PKG",26,22,1,"PAH",1,1,466,0)
           allow you to ensure the integrity of the routines that are in 
"PKG",26,22,1,"PAH",1,1,467,0)
           the transport global.
"PKG",26,22,1,"PAH",1,1,468,0)
     
"PKG",26,22,1,"PAH",1,1,469,0)
4.     Select Installation Option:  Install Package(s) 
"PKG",26,22,1,"PAH",1,1,470,0)
                                    ------------------
"PKG",26,22,1,"PAH",1,1,471,0)
       **This is the step to start the installation of this KIDS patch: 
"PKG",26,22,1,"PAH",1,1,472,0)
   
"PKG",26,22,1,"PAH",1,1,473,0)
       a.  Choose the Install Package(s) option to start the patch install.
"PKG",26,22,1,"PAH",1,1,474,0)
          (When prompted for the INSTALL NAME, enter LR*5.2*317.)
"PKG",26,22,1,"PAH",1,1,475,0)
       b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
"PKG",26,22,1,"PAH",1,1,476,0)
           YES//' answer NO (unless otherwise indicated)
"PKG",26,22,1,"PAH",1,1,477,0)
       c.  When prompted 'Want to DISABLE Scheduled Options, Menu Options,
"PKG",26,22,1,"PAH",1,1,478,0)
           and Protocols? YES//' answer NO (unless otherwise indicated)
"PKG",26,22,1,"PAH",1,1,479,0)
                 
"PKG",26,22,1,"PAH",1,1,480,0)
5.   If you have any unreleased supplementary reports from July 23, 2003
"PKG",26,22,1,"PAH",1,1,481,0)
       until the present, the install will abort.  To print the unreleased
"PKG",26,22,1,"PAH",1,1,482,0)
       supplementary reports, you can print the install file.
"PKG",26,22,1,"PAH",1,1,483,0)
       Here's an example:
"PKG",26,22,1,"PAH",1,1,484,0)
 
"PKG",26,22,1,"PAH",1,1,485,0)
Select Kernel Installation & Distribution System Option: utilities
"PKG",26,22,1,"PAH",1,1,486,0)
 
"PKG",26,22,1,"PAH",1,1,487,0)
Select Utilities Option: install File Print
"PKG",26,22,1,"PAH",1,1,488,0)
Select INSTALL NAME: lr*5.2*317   Loaded from Distribution  8/25/06@14:37:36       
"PKG",26,22,1,"PAH",1,1,489,0)
 
"PKG",26,22,1,"PAH",1,1,490,0)
DEVICE: HOME// ;;1000  UCX/TELNET
"PKG",26,22,1,"PAH",1,1,491,0)
 
"PKG",26,22,1,"PAH",1,1,492,0)
 
"PKG",26,22,1,"PAH",1,1,493,0)
PACKAGE: LR*5.2*317     Aug 25, 2006 2:39 pm                         PAGE 1
"PKG",26,22,1,"PAH",1,1,494,0)
                                             COMPLETED            ELAPSED
"PKG",26,22,1,"PAH",1,1,495,0)
---------------------------------------------------------------------------
"PKG",26,22,1,"PAH",1,1,496,0)
INSTALLED BY: IRM,PERSON
"PKG",26,22,1,"PAH",1,1,497,0)
NATIONAL PACKAGE: LAB SERVICE
"PKG",26,22,1,"PAH",1,1,498,0)
 
"PKG",26,22,1,"PAH",1,1,499,0)
INSTALL STARTED: 
"PKG",26,22,1,"PAH",1,1,500,0)
 
"PKG",26,22,1,"PAH",1,1,501,0)
ROUTINES:                                                        
"PKG",26,22,1,"PAH",1,1,502,0)
 
"PKG",26,22,1,"PAH",1,1,503,0)
PRE-INIT CHECK POINTS:
"PKG",26,22,1,"PAH",1,1,504,0)
XPD PREINSTALL STARTED                                           
"PKG",26,22,1,"PAH",1,1,505,0)
XPD PREINSTALL COMPLETED                                         
"PKG",26,22,1,"PAH",1,1,506,0)
 
"PKG",26,22,1,"PAH",1,1,507,0)
FILES:
"PKG",26,22,1,"PAH",1,1,508,0)
LAB DATA                                                         
"PKG",26,22,1,"PAH",1,1,509,0)
 
"PKG",26,22,1,"PAH",1,1,510,0)
POST-INIT CHECK POINTS:
"PKG",26,22,1,"PAH",1,1,511,0)
XPD POSTINSTALL STARTED                                          
"PKG",26,22,1,"PAH",1,1,512,0)
XPD POSTINSTALL COMPLETED                                        
"PKG",26,22,1,"PAH",1,1,513,0)
 
"PKG",26,22,1,"PAH",1,1,514,0)
MESSAGES:
"PKG",26,22,1,"PAH",1,1,515,0)
 
"PKG",26,22,1,"PAH",1,1,516,0)
           Sending transport global loaded alert to mail group G.LMI 
"PKG",26,22,1,"PAH",1,1,517,0)
            
"PKG",26,22,1,"PAH",1,1,518,0)
 
"PKG",26,22,1,"PAH",1,1,519,0)
Unreleased supplemental report(s) from July 23,2003 until present- must 
"PKG",26,22,1,"PAH",1,1,520,0)
be released before install.
"PKG",26,22,1,"PAH",1,1,521,0)
 
"PKG",26,22,1,"PAH",1,1,522,0)
 
"PKG",26,22,1,"PAH",1,1,523,0)
                     Name: TEST,PATIENT  Accession: NSP 04 2 
"PKG",26,22,1,"PAH",1,1,524,0)
                      
"PKG",26,22,1,"PAH",1,1,525,0)
 
"PKG",26,22,1,"PAH",1,1,526,0)
                    --- Install Environment Check FAILED 
"PKG",26,22,1,"PAH",1,1,527,0)
---                    
"PKG",26,22,1,"PAH",1,1,528,0)
 
"PKG",26,22,1,"PAH",1,1,529,0)
LR*5.2*317 Build will not be installed
"PKG",26,22,1,"PAH",1,1,530,0)
               Aug 25, 2006@14:38:55
"PKG",26,22,1,"PAH",1,1,531,0)
 
"PKG",26,22,1,"PAH",1,1,532,0)
 
"PKG",26,22,1,"PAH",1,1,533,0)
Select Utilities Option: 
"PKG",26,22,1,"PAH",1,1,534,0)
         
"PKG",26,22,1,"PAH",1,1,535,0)
 
"PKG",26,22,1,"PAH",1,1,536,0)
**NOTE: Routine LR317 will be deleted after successful patch installation.
"PRE")
LR317
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
17
"RTN","LR317")
0^^B18182916^n/a
"RTN","LR317",1,0)
LR317 ;DALOI/KLL - LR*5.2*317 PATCH ENVIRONMENT CHECK ROUTINE ;09/21/02
"RTN","LR317",2,0)
 ;;5.2;LAB SERVICE;**317**;Sep 27, 1994
"RTN","LR317",3,0)
EN ; Does not prevent loading of the transport global.
"RTN","LR317",4,0)
 ; Environment check is done only during the install.
"RTN","LR317",5,0)
 ;
"RTN","LR317",6,0)
 I '$G(XPDENV) D  Q
"RTN","LR317",7,0)
 .N XQA,XQAMSG
"RTN","LR317",8,0)
 .S XQAMSG="Transport global for patch "_$G(XPDNM,"Unknown patch")
"RTN","LR317",9,0)
 .S XQAMSG=XQAMSG_" loaded on "_$$HTE^XLFDT($H)
"RTN","LR317",10,0)
 .S XQA("G.LMI")=""
"RTN","LR317",11,0)
 .D SETUP^XQALERT
"RTN","LR317",12,0)
 .S MSG="Sending transport global loaded alert to mail group G.LMI"
"RTN","LR317",13,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR317",14,0)
 ;
"RTN","LR317",15,0)
 D CHECK
"RTN","LR317",16,0)
 D EXIT
"RTN","LR317",17,0)
 Q
"RTN","LR317",18,0)
 ;
"RTN","LR317",19,0)
CHECK ; Perform environment check
"RTN","LR317",20,0)
 ;
"RTN","LR317",21,0)
 I $S('$G(IOM):1,'$G(IOSL):1,$G(U)'="^":1,1:0) D  Q
"RTN","LR317",22,0)
 .D BMES^XPDUTL($$CJ^XLFSTR("Terminal Device is not defined",80))
"RTN","LR317",23,0)
 .S XPDQUIT=2
"RTN","LR317",24,0)
 ;
"RTN","LR317",25,0)
 I $S('$G(DUZ):1,$D(DUZ)[0:1,$D(DUZ(0))[0:1,1:0) D  Q
"RTN","LR317",26,0)
 .S MSG="Please log in to set local DUZ... variables"
"RTN","LR317",27,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR317",28,0)
 .S XPDQUIT=2
"RTN","LR317",29,0)
 ;
"RTN","LR317",30,0)
 I '$D(^VA(200,$G(DUZ),0))#2 D  Q
"RTN","LR317",31,0)
 .S MSG="You are not a valid user on this system"
"RTN","LR317",32,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR317",33,0)
 .S XPDQUIT=2
"RTN","LR317",34,0)
 ;
"RTN","LR317",35,0)
 S XPDIQ("XPZ1","B")="NO"
"RTN","LR317",36,0)
 ;
"RTN","LR317",37,0)
 Q:'$$PROD^XUPROD  ;LINE ADDED FOR TEST SITES
"RTN","LR317",38,0)
 ;CHECK FOR UNRELEASED SUPPLEMENTARY REPORTS FROM JUNE 7,2004
"RTN","LR317",39,0)
 S MSG="Unreleased supplemental report(s) from July 23,2003 until present- must be released before install."
"RTN","LR317",40,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR317",41,0)
 S LRSS="AU",LRSDT=3030723-.01 D  S LRSS="CY",LRSDT=3030723-.01 D  S LRSS="EM",LRSDT=3030723-.01 D  S LRSS="SP",LRSDT=3030723-.01 D
"RTN","LR317",42,0)
 .S LRXR="A"_LRSS
"RTN","LR317",43,0)
 .F  S LRSDT=$O(^LR(LRXR,LRSDT)) Q:'LRSDT  S LRDFN=0 F  S LRDFN=$O(^LR(LRXR,LRSDT,LRDFN)) Q:'LRDFN  D
"RTN","LR317",44,0)
 ..S LRI=0 F  S LRI=$O(^LR(LRXR,LRSDT,LRDFN,LRI)) Q:'LRI  D
"RTN","LR317",45,0)
 ...S LRNUM=0 F  S LRNUM=$O(^LR(LRDFN,LRSS,LRI,1.2,LRNUM)) Q:'LRNUM  D
"RTN","LR317",46,0)
 ....I LRSS'="AU" S LRX=$G(^LR(LRDFN,LRSS,LRI,1.2,LRNUM,0))
"RTN","LR317",47,0)
 ....I LRSS="AU" S LRX=$G(^LR(LRDFN,84,LRNUM,0))
"RTN","LR317",48,0)
 ....S LRRLS2=+$P(LRX,"^",2)
"RTN","LR317",49,0)
 ....I 'LRRLS2 D
"RTN","LR317",50,0)
 .....I $G(^LR(LRDFN,0)) S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3)
"RTN","LR317",51,0)
 .....I LRDPF=2 S PNM=$P(^DPT(DFN,0),U)
"RTN","LR317",52,0)
 .....I LRDPF'=2 D
"RTN","LR317",53,0)
 ......S X=$$GET1^DID(1,LRDPF,"","GLOBAL NAME","ANS","ANS1")
"RTN","LR317",54,0)
 ......S X=X_DFN_",0)",X=$S($D(@X):@X,1:"") S PNM=$P(X,U)
"RTN","LR317",55,0)
 .....S MSG="Name: "_PNM_"  Accession: "_$P(^LR(LRDFN,LRSS,LRI,0),U,6)
"RTN","LR317",56,0)
 .....D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR317",57,0)
 .....S XPDQUIT=2
"RTN","LR317",58,0)
 ;
"RTN","LR317",59,0)
 Q
"RTN","LR317",60,0)
 ;
"RTN","LR317",61,0)
EXIT ;
"RTN","LR317",62,0)
 I $G(XPDQUIT) D
"RTN","LR317",63,0)
 .S MSG="--- Install Environment Check FAILED ---"
"RTN","LR317",64,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR317",65,0)
 I '$G(XPDQUIT) D
"RTN","LR317",66,0)
 .D BMES^XPDUTL($$CJ^XLFSTR("--- Environment Check is Ok ---",80))
"RTN","LR317",67,0)
 Q
"RTN","LR317",68,0)
 ;
"RTN","LR317",69,0)
PRE ; KIDS Pre install for LR*5.2*317
"RTN","LR317",70,0)
 ;
"RTN","LR317",71,0)
 N XQA,XQAMSG
"RTN","LR317",72,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")
"RTN","LR317",73,0)
 S XQAMSG=XQAMSG_" started on "_$$HTE^XLFDT($H)
"RTN","LR317",74,0)
 S XQA("G.LMI")=""
"RTN","LR317",75,0)
 D SETUP^XQALERT
"RTN","LR317",76,0)
 ;
"RTN","LR317",77,0)
 S MSG="Sending install started alert to mail group G.LMI"
"RTN","LR317",78,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR317",79,0)
 ;
"RTN","LR317",80,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install started ***",80))
"RTN","LR317",81,0)
 ;
"RTN","LR317",82,0)
 S Y=$$OPTDE^XPDUTL("LRAP",2)
"RTN","LR317",83,0)
 S MSG="Disabling Anatomic Pathology [LRAP] option"
"RTN","LR317",84,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR317",85,0)
 ;
"RTN","LR317",86,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install completed ***",80))
"RTN","LR317",87,0)
 ;
"RTN","LR317",88,0)
 Q
"RTN","LR317",89,0)
 ;
"RTN","LR317",90,0)
POST ; KIDS Post install for LR*5.2*317
"RTN","LR317",91,0)
 ;
"RTN","LR317",92,0)
 N XQA,XQAMSG
"RTN","LR317",93,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install started ***",80))
"RTN","LR317",94,0)
 ;
"RTN","LR317",95,0)
 S Y=$$OPTDE^XPDUTL("LRAP",1)
"RTN","LR317",96,0)
 S MSG="Enabling Anatomic Pathology [LRAP] option"
"RTN","LR317",97,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR317",98,0)
 ;
"RTN","LR317",99,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install completed ***",80))
"RTN","LR317",100,0)
 ;
"RTN","LR317",101,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")
"RTN","LR317",102,0)
 S XQAMSG=XQAMSG_" completed on "_$$HTE^XLFDT($H)
"RTN","LR317",103,0)
 S XQA("G.LMI")=""
"RTN","LR317",104,0)
 D SETUP^XQALERT
"RTN","LR317",105,0)
 ;
"RTN","LR317",106,0)
 S MSG="Sending install completion alert to mail group G.LMI"
"RTN","LR317",107,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR317",108,0)
 ;
"RTN","LR317",109,0)
 Q
"RTN","LR7OSAP")
0^10^B37919526^B34114559
"RTN","LR7OSAP",1,0)
LR7OSAP ;slc/dcm/wty - Silent AP rpt (compare to LRAPCUM) ;3/27/2002
"RTN","LR7OSAP",2,0)
 ;;5.2;LAB SERVICE;**121,187,230,256,259,317**;Sep 27, 1994
"RTN","LR7OSAP",3,0)
 ;
"RTN","LR7OSAP",4,0)
GET I '$D(^LR(LRDFN,LRSS)) Q
"RTN","LR7OSAP",5,0)
 N FST,X,LRPTR
"RTN","LR7OSAP",6,0)
 S (A,FST)=0,LRI=LRIN
"RTN","LR7OSAP",7,0)
 F  S LRI=$O(^LR(LRDFN,LRSS,LRI)) Q:'LRI!(CT1>COUNT)!(LRI>LROUT)  S B=$G(^(LRI,0)),CT1=CT1+1 I B D
"RTN","LR7OSAP",8,0)
 . D W
"RTN","LR7OSAP",9,0)
 . S X="",$P(X,"=",GIOM)=""
"RTN","LR7OSAP",10,0)
 . D LN
"RTN","LR7OSAP",11,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,X)
"RTN","LR7OSAP",12,0)
 . D LINE^LR7OSUM4
"RTN","LR7OSAP",13,0)
 Q
"RTN","LR7OSAP",14,0)
F(PIECE) ;
"RTN","LR7OSAP",15,0)
 ;If PIECE=1, then only get 1st piece; otherwise get whole node
"RTN","LR7OSAP",16,0)
 I '$G(PIECE) D WRAP^LR7OSAP1("^LR("_LRDFN_","""_LRSS_""","_LRI_","_LRV_")",79) Q
"RTN","LR7OSAP",17,0)
 S C=0
"RTN","LR7OSAP",18,0)
 F  S C=$O(^LR(LRDFN,LRSS,LRI,LRV,C)) Q:'C  S X=$P(^(C,0),"^") D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,X)
"RTN","LR7OSAP",19,0)
 Q
"RTN","LR7OSAP",20,0)
W ;
"RTN","LR7OSAP",21,0)
 N LRTEXT
"RTN","LR7OSAP",22,0)
 I 'FST D
"RTN","LR7OSAP",23,0)
 . D LINE^LR7OSUM4,LN
"RTN","LR7OSAP",24,0)
 . S X=GIOM/2-($L(LRAA(1))/2+5),^TMP("LRH",$J,LRAA(1))=GCNT,^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(X,CCNT,"---- "_LRAA(1)_" ----")
"RTN","LR7OSAP",25,0)
 I FST D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Next "_LRAA(1)_" Specimen...")
"RTN","LR7OSAP",26,0)
 S FST=1
"RTN","LR7OSAP",27,0)
 D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS,LRI)
"RTN","LR7OSAP",28,0)
 I +$G(LRPTR) D  Q
"RTN","LR7OSAP",29,0)
 .D MAIN^LR7OSAP3(LRPTR)
"RTN","LR7OSAP",30,0)
 S Y=+B
"RTN","LR7OSAP",31,0)
 D D^LRU
"RTN","LR7OSAP",32,0)
 S LRW(1)=Y,Y=$P(B,"^",10)
"RTN","LR7OSAP",33,0)
 D D^LRU
"RTN","LR7OSAP",34,0)
 S LRW(10)=Y,Y=$P(B,"^",3)
"RTN","LR7OSAP",35,0)
 D D^LRU
"RTN","LR7OSAP",36,0)
 S LRW(3)=Y,X=$P(B,"^",2)
"RTN","LR7OSAP",37,0)
 D:X D^LRUA
"RTN","LR7OSAP",38,0)
 S LRW(2)=X,LRW(11)=$P(B,"^",11),X=$P(B,"^",4)
"RTN","LR7OSAP",39,0)
 D:X D^LRUA
"RTN","LR7OSAP",40,0)
 S LRW(4)=X,X=$P(B,"^",7)
"RTN","LR7OSAP",41,0)
 D:X D^LRUA
"RTN","LR7OSAP",42,0)
 S LRW(7)=X
"RTN","LR7OSAP",43,0)
 D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Date Spec taken: "_LRW(1)),^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(38,CCNT,"Pathologist:"_LRW(2))
"RTN","LR7OSAP",44,0)
 D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Date Spec rec'd: "_LRW(10)),^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(38,CCNT,$S(LRSS="SP":"Resident: ",1:"Tech: ")_LRW(4))
"RTN","LR7OSAP",45,0)
 D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,$S($L(LRW(3)):"Date  completed: ",1:"REPORT INCOMPLETE")_LRW(3)),^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(38,CCNT,"Accession #: "_$P(B,"^",6))
"RTN","LR7OSAP",46,0)
 D LN S $P(LR("%"),"-",GIOM)="",^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Submitted by: "_$P(B,"^",5)),^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(38,CCNT,"Practitioner:"_LRW(7)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LR("%"))
"RTN","LR7OSAP",47,0)
 I LRW(11)="" D A,LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Report not verified") Q  ;don't show anymore data if not verified.
"RTN","LR7OSAP",48,0)
 I $D(^LR(LRDFN,LRSS,LRI,.1)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Specimen: ") S LRV=.1 D F(1)
"RTN","LR7OSAP",49,0)
 I $P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),"^",4) D
"RTN","LR7OSAP",50,0)
 .D LN
"RTN","LR7OSAP",51,0)
 .S LRTEXT="SUPPLEMENTARY REPORT HAS BEEN ADDED"
"RTN","LR7OSAP",52,0)
 .S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(14,CCNT,"*+* "_LRTEXT_" *+*")
"RTN","LR7OSAP",53,0)
 .D LN
"RTN","LR7OSAP",54,0)
 .S LRTEXT="REFER TO BOTTOM OF REPORT"
"RTN","LR7OSAP",55,0)
 .S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(19,CCNT,"*+* "_LRTEXT_" *+*")
"RTN","LR7OSAP",56,0)
 .D LN
"RTN","LR7OSAP",57,0)
 I $D(^LR(LRDFN,LRSS,LRI,.2)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Brief Clinical History:") S LRV=.2 D F()
"RTN","LR7OSAP",58,0)
 I $D(^LR(LRDFN,LRSS,LRI,.3)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Preoperative Diagnosis:") S LRV=.3 D F()
"RTN","LR7OSAP",59,0)
 I $D(^LR(LRDFN,LRSS,LRI,.4)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Operative Findings:") S LRV=.4 D F()
"RTN","LR7OSAP",60,0)
 I $D(^LR(LRDFN,LRSS,LRI,.5)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Postoperative Diagnosis:") S LRV=.5 D F()
"RTN","LR7OSAP",61,0)
 D SET^LRUA
"RTN","LR7OSAP",62,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.3,0)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LR(69.2,.13)) I $P($G(^LR(LRDFN,LRSS,LRI,6,0)),U,4) S LR(0)=6 D MOD^LR7OSAP1
"RTN","LR7OSAP",63,0)
 S LRV=1.3
"RTN","LR7OSAP",64,0)
 D F()
"RTN","LR7OSAP",65,0)
 I $O(^LR(LRDFN,LRSS,LRI,1,0)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LR(69.2,.03)) I $P($G(^LR(LRDFN,LRSS,LRI,7,0)),U,4) S LR(0)=7 D MOD^LR7OSAP1
"RTN","LR7OSAP",66,0)
 S LRV=1
"RTN","LR7OSAP",67,0)
 D F()
"RTN","LR7OSAP",68,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.1,0)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LR(69.2,.04)_" (Date Spec taken: "_LRW(1)_")") I $P($G(^LR(LRDFN,LRSS,LRI,4,0)),U,4) S LR(0)=4 D MOD^LR7OSAP1
"RTN","LR7OSAP",69,0)
 S LRV=1.1
"RTN","LR7OSAP",70,0)
 D F()
"RTN","LR7OSAP",71,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.4,0)) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LR(69.2,.14)) I $P($G(^LR(LRDFN,LRSS,LRI,5,0)),U,4) S LR(0)=5 D MOD^LR7OSAP1
"RTN","LR7OSAP",72,0)
 S LRV=1.4
"RTN","LR7OSAP",73,0)
 D F()
"RTN","LR7OSAP",74,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.2,0)) D
"RTN","LR7OSAP",75,0)
 . D LN
"RTN","LR7OSAP",76,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Supplementary Report:")
"RTN","LR7OSAP",77,0)
 . S C=0 F  S C=$O(^LR(LRDFN,LRSS,LRI,1.2,C)) Q:'C  D
"RTN","LR7OSAP",78,0)
 .. S X=^LR(LRDFN,LRSS,LRI,1.2,C,0),Y=+X,X=$P(X,U,2)
"RTN","LR7OSAP",79,0)
 .. ;Don't even print supp date if supp is not released
"RTN","LR7OSAP",80,0)
 .. Q:'X
"RTN","LR7OSAP",81,0)
 .. D D^LRU,LN
"RTN","LR7OSAP",82,0)
 .. S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(3,CCNT,"Date: "_Y)
"RTN","LR7OSAP",83,0)
 .. I 'X S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(1,CCNT," not verified")
"RTN","LR7OSAP",84,0)
 .. I $O(^LR(LRDFN,LRSS,LRI,1.2,C,2,0)) D MODSR^LR7OSAP1
"RTN","LR7OSAP",85,0)
 .. D:X U
"RTN","LR7OSAP",86,0)
 I $D(^LR(LRDFN,LRSS,LRI,2)) D B
"RTN","LR7OSAP",87,0)
 Q
"RTN","LR7OSAP",88,0)
U ;
"RTN","LR7OSAP",89,0)
 D WRAP^LR7OSAP1("^LR("_LRDFN_","""_LRSS_""","_LRI_",1.2,"_C_",1)",79)
"RTN","LR7OSAP",90,0)
 Q
"RTN","LR7OSAP",91,0)
B ;
"RTN","LR7OSAP",92,0)
 S C=0
"RTN","LR7OSAP",93,0)
 F  S C=$O(^LR(LRDFN,LRSS,LRI,2,C)) Q:'C  D SP
"RTN","LR7OSAP",94,0)
 Q
"RTN","LR7OSAP",95,0)
SP ;
"RTN","LR7OSAP",96,0)
 S G=0
"RTN","LR7OSAP",97,0)
 F  S G=$O(^LR(LRDFN,LRSS,LRI,2,C,5,G)) Q:'G  S X=^(G,0),Y=$P(X,"^",2),E=$P(X,"^",3),E(1)=$P(X,"^")_":",E(1)=$P($P($G(LR(LRSS)),E(1),2),";") D D^LRU S T(2)=Y D WP
"RTN","LR7OSAP",98,0)
 Q
"RTN","LR7OSAP",99,0)
WP ;
"RTN","LR7OSAP",100,0)
 D LN
"RTN","LR7OSAP",101,0)
 S X=E(1)_" "_E_" Date: "_T(2)_" ",^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,X)
"RTN","LR7OSAP",102,0)
 D WRAP^LR7OSAP1("^LR("_LRDFN_","""_LRSS_""","_LRI_",2,"_C_",5,"_G_",1)",79)
"RTN","LR7OSAP",103,0)
 Q
"RTN","LR7OSAP",104,0)
A ;
"RTN","LR7OSAP",105,0)
 D WRAP^LR7OSAP1("^LR("_LRDFN_","""_LRSS_""","_LRI_",97)",79)
"RTN","LR7OSAP",106,0)
 Q
"RTN","LR7OSAP",107,0)
LN ;Increment the counter
"RTN","LR7OSAP",108,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","LR7OSAP",109,0)
 Q
"RTN","LR7OSAP",110,0)
EN ;Get AP results
"RTN","LR7OSAP",111,0)
 I $S('$D(SUBHEAD):1,1:$D(SUBHEAD("CYTOPATHOLOGY"))) D CY
"RTN","LR7OSAP",112,0)
 I $S('$D(SUBHEAD):1,1:$D(SUBHEAD("SURGICAL PATHOLOGY"))) D SPA
"RTN","LR7OSAP",113,0)
 I $S('$D(SUBHEAD):1,1:$D(SUBHEAD("EM"))) D EM
"RTN","LR7OSAP",114,0)
 I $S('$D(SUBHEAD):1,1:$D(SUBHEAD("AUTOPSY"))),$D(^LR(LRDFN,"AU")) D AU
"RTN","LR7OSAP",115,0)
 Q
"RTN","LR7OSAP",116,0)
CY S LRSS="CY",LRAA(1)="CYTOPATHOLOGY",LRAA=+$O(^LRO(68,"B",LRAA(1),0)) S:'LRAA LRAA=$$FIND(LRSS) D GET
"RTN","LR7OSAP",117,0)
 Q
"RTN","LR7OSAP",118,0)
SPA S LRSS="SP",LRAA(1)="SURGICAL PATHOLOGY",LRAA=+$O(^LRO(68,"B",LRAA(1),0)) S:'LRAA LRAA=$$FIND(LRSS) D GET
"RTN","LR7OSAP",119,0)
 Q
"RTN","LR7OSAP",120,0)
EM S LRSS="EM",LRAA(1)="ELECTRON MICROSCOPY",LRAA=+$O(^LRO(68,"B","EM",0)) S:'LRAA LRAA=$$FIND(LRSS) D GET
"RTN","LR7OSAP",121,0)
 Q
"RTN","LR7OSAP",122,0)
AU D EN^LR7OSAP2(LRDFN)
"RTN","LR7OSAP",123,0)
 Q
"RTN","LR7OSAP",124,0)
FIND(SS) ;Find a valid entry in 68
"RTN","LR7OSAP",125,0)
 ;SS=LRSS value to look for
"RTN","LR7OSAP",126,0)
 N I,Y
"RTN","LR7OSAP",127,0)
 S I=0,Y="" F  S I=$O(^LRO(68,I)) Q:I<1  I $P($G(^LRO(68,I,0)),"^",2)=SS S Y=I Q
"RTN","LR7OSAP",128,0)
 Q Y
"RTN","LR7OSAP1")
0^14^B26109314^B24974232
"RTN","LR7OSAP1",1,0)
LR7OSAP1 ;slc/dcm/wty/kll - Silent AP rpt cont. ;3/28/2002
"RTN","LR7OSAP1",2,0)
 ;;5.2;LAB SERVICE;**121,227,230,259,317**;Sep 27, 1994
"RTN","LR7OSAP1",3,0)
 Q:'$D(^XUSEC("LRLAB",DUZ))
"RTN","LR7OSAP1",4,0)
 D LN
"RTN","LR7OSAP1",5,0)
 S $P(LR("%"),"-",GIOM)="",^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LR("%"))
"RTN","LR7OSAP1",6,0)
 D LN
"RTN","LR7OSAP1",7,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"SNOMED/ICD codes:")
"RTN","LR7OSAP1",8,0)
 S C=0
"RTN","LR7OSAP1",9,0)
 F  S C=$O(^LR(LRDFN,LRSS,LRI,2,C)) Q:'C  S T=+^(C,0),T=^LAB(61,T,0) D
"RTN","LR7OSAP1",10,0)
 . D LN
"RTN","LR7OSAP1",11,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"T-"_$P(T,"^",2)_": "),X=$P(T,"^")
"RTN","LR7OSAP1",12,0)
 . D:LR(69.2,.05) C^LRUA
"RTN","LR7OSAP1",13,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_X
"RTN","LR7OSAP1",14,0)
 . D M
"RTN","LR7OSAP1",15,0)
 D LINE^LR7OSUM4
"RTN","LR7OSAP1",16,0)
 S C=0
"RTN","LR7OSAP1",17,0)
 F  S C=$O(^LR(LRDFN,LRSS,LRI,3,C)) Q:'C  S X=+^(C,0),X=$G(^ICD9(X,0)) I $L(X) D
"RTN","LR7OSAP1",18,0)
 . S X(9)=$P(X,"^"),X=$P(X,"^",3)
"RTN","LR7OSAP1",19,0)
 . D LN
"RTN","LR7OSAP1",20,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"ICD code: "_X(9))
"RTN","LR7OSAP1",21,0)
 . D:LR(69.2,.05) C^LRUA
"RTN","LR7OSAP1",22,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(20,CCNT,X)
"RTN","LR7OSAP1",23,0)
 Q
"RTN","LR7OSAP1",24,0)
M ;
"RTN","LR7OSAP1",25,0)
 S B=0
"RTN","LR7OSAP1",26,0)
 F  S B=$O(^LR(LRDFN,LRSS,LRI,2,C,2,B)) Q:'B  S M=+^(B,0),M=$G(^LAB(61.1,M,0)) I $L(M) D
"RTN","LR7OSAP1",27,0)
 . D LN
"RTN","LR7OSAP1",28,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,"M-"_$P(M,"^",2)_": "),X=$P(M,"^")
"RTN","LR7OSAP1",29,0)
 . D:LR(69.2,.05) C^LRUA
"RTN","LR7OSAP1",30,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_X
"RTN","LR7OSAP1",31,0)
 . D EX
"RTN","LR7OSAP1",32,0)
 F B=1.4,3.3,4.5 S F=0 F  S F=$O(^LR(LRDFN,LRSS,LRI,2,C,$P(B,"."),F)) Q:'F  D A
"RTN","LR7OSAP1",33,0)
 Q
"RTN","LR7OSAP1",34,0)
A ;
"RTN","LR7OSAP1",35,0)
 S M=+^LR(LRDFN,LRSS,LRI,2,C,$P(B,"."),F,0),E="61."_$P(B,".",2),M=^LAB(E,M,0)
"RTN","LR7OSAP1",36,0)
 D LN
"RTN","LR7OSAP1",37,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,$S(B=1.4:"D-",B=3.3:"F-",B=4.5:"P-",1:"")_$P(M,"^",2)),X=$P(M,"^")
"RTN","LR7OSAP1",38,0)
 D:LR(69.2,.05) C^LRUA
"RTN","LR7OSAP1",39,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_": "_X
"RTN","LR7OSAP1",40,0)
 Q
"RTN","LR7OSAP1",41,0)
EX ;
"RTN","LR7OSAP1",42,0)
 S G=0
"RTN","LR7OSAP1",43,0)
 F  S G=$O(^LR(LRDFN,LRSS,LRI,2,C,2,B,1,G)) Q:'G  S E=+^(G,0),E=$G(^LAB(61.2,E,0)) I $L(E) D
"RTN","LR7OSAP1",44,0)
 . D LN
"RTN","LR7OSAP1",45,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(10,CCNT,"E-"_$P(E,"^",2)_": "),X=$P(E,"^")
"RTN","LR7OSAP1",46,0)
 . D:LR(69.2,.05) C^LRUA
"RTN","LR7OSAP1",47,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_X
"RTN","LR7OSAP1",48,0)
 Q
"RTN","LR7OSAP1",49,0)
LN ;Increment the counter
"RTN","LR7OSAP1",50,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","LR7OSAP1",51,0)
 Q
"RTN","LR7OSAP1",52,0)
MOD ;Modified report stuff
"RTN","LR7OSAP1",53,0)
 N A,B
"RTN","LR7OSAP1",54,0)
 D LN
"RTN","LR7OSAP1",55,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(28,CCNT,"*+* MODIFIED REPORT *+*")
"RTN","LR7OSAP1",56,0)
 D LN
"RTN","LR7OSAP1",57,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"(Last modified: ")
"RTN","LR7OSAP1",58,0)
 S B=0
"RTN","LR7OSAP1",59,0)
 F A=0:0 S A=$O(^LR(LRDFN,LRSS,LRI,LR(0),A)) Q:'A  S B=A
"RTN","LR7OSAP1",60,0)
 Q:'$D(^LR(LRDFN,LRSS,LRI,LR(0),B,0))  S A=^(0),Y=+A,A=$P(A,"^",2),A=$P($G(^VA(200,A,0),A),"^")
"RTN","LR7OSAP1",61,0)
 D D^LRU
"RTN","LR7OSAP1",62,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_Y_" typed by "_A_")"
"RTN","LR7OSAP1",63,0)
 D:$D(LRQ(9)) M1
"RTN","LR7OSAP1",64,0)
 Q
"RTN","LR7OSAP1",65,0)
MODSR ;Modified Supplementary Report Audit Info
"RTN","LR7OSAP1",66,0)
 N LRTEXT,LRSP1,LRSP2,LRFILE,LRIENS,LRR1,LRR2
"RTN","LR7OSAP1",67,0)
 S LRFILE=$S(LRSS="CY":63.9072,LRSS="SP":63.8172,LRSS="EM":63.2072,1:"")
"RTN","LR7OSAP1",68,0)
 Q:LRFILE=""
"RTN","LR7OSAP1",69,0)
 D LN
"RTN","LR7OSAP1",70,0)
 S LRTEXT="SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED"
"RTN","LR7OSAP1",71,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(14,CCNT,"*+* "_LRTEXT_" *+*")
"RTN","LR7OSAP1",72,0)
 D LN
"RTN","LR7OSAP1",73,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"(Added/Last modified: ")
"RTN","LR7OSAP1",74,0)
 S LRIENS=C_","_LRI_","_LRDFN_","
"RTN","LR7OSAP1",75,0)
 S LRSP1=0
"RTN","LR7OSAP1",76,0)
 F  S LRSP1=$O(^LR(LRDFN,LRSS,LRI,1.2,C,2,LRSP1)) Q:'LRSP1  D
"RTN","LR7OSAP1",77,0)
 .S LRSP2=LRSP1
"RTN","LR7OSAP1",78,0)
 Q:'$D(^LR(LRDFN,LRSS,LRI,1.2,C,2,LRSP2,0))
"RTN","LR7OSAP1",79,0)
 S LRS2=^(0),Y=+LRS2,LRS2A=$P(LRS2,"^",2),LRSGN=" typed by "
"RTN","LR7OSAP1",80,0)
 ;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LR7OSAP1",81,0)
 I $P(LRS2,"^",3) S Y=$P(LRS2,"^",4),LRS2A=$P(LRS2,"^",3),LRSGN=" signed by "
"RTN","LR7OSAP1",82,0)
 D D^LRU
"RTN","LR7OSAP1",83,0)
 S LRS2A=$S($D(^VA(200,LRS2A,0)):$P(^(0),"^"),1:LRS2A)
"RTN","LR7OSAP1",84,0)
 S LRR1=Y,LRR2=LRS2A
"RTN","LR7OSAP1",85,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_LRR1_LRSGN_LRR2_")"
"RTN","LR7OSAP1",86,0)
 ;If RELEASED SUPP REPORT MODIFIED set to 1, display "NOT VERIFIED"
"RTN","LR7OSAP1",87,0)
 I $P(^LR(LRDFN,LRSS,LRI,1.2,C,0),"^",3)=1 D
"RTN","LR7OSAP1",88,0)
 .D LN
"RTN","LR7OSAP1",89,0)
 .S LRTEXT="NOT VERIFIED"
"RTN","LR7OSAP1",90,0)
 .S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(25,CCNT,"**-* "_LRTEXT_" *-**")
"RTN","LR7OSAP1",91,0)
 Q
"RTN","LR7OSAP1",92,0)
M1 ;
"RTN","LR7OSAP1",93,0)
 S A=0
"RTN","LR7OSAP1",94,0)
 F  S A=$O(^LR(LRDFN,LRSS,LRI,LR(0),A)) Q:'A  S LRT=^(A,0),Y=+LRT,X=$P(LRT,"^",2),X=$P($G(^VA(200,X,0),X),"^") D
"RTN","LR7OSAP1",95,0)
 . D D^LRU,LN
"RTN","LR7OSAP1",96,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"Date modified:"_Y_" typed by "_X)
"RTN","LR7OSAP1",97,0)
 . D F
"RTN","LR7OSAP1",98,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(13,CCNT,"==========Text below appears on final report==========")
"RTN","LR7OSAP1",99,0)
 Q
"RTN","LR7OSAP1",100,0)
 ;
"RTN","LR7OSAP1",101,0)
F ;
"RTN","LR7OSAP1",102,0)
 S B=0
"RTN","LR7OSAP1",103,0)
 F  S B=$O(^LR(LRDFN,LRSS,LRI,LR(0),A,1,B)) Q:'B  S LRT=^(B,0),X=LRT D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,X)
"RTN","LR7OSAP1",104,0)
 Q
"RTN","LR7OSAP1",105,0)
WRAP(ROOT,FMT) ;Wrap text
"RTN","LR7OSAP1",106,0)
 I '$L($G(ROOT)) Q ""
"RTN","LR7OSAP1",107,0)
 S:'$G(FMT) FMT=79
"RTN","LR7OSAP1",108,0)
 N X,LRI,LRTX,LRINDX
"RTN","LR7OSAP1",109,0)
 S LRINDX=0,LRI=0
"RTN","LR7OSAP1",110,0)
 F  S LRI=$O(@ROOT@(LRI)) Q:LRI'>0  D
"RTN","LR7OSAP1",111,0)
 . S X=$S($L($G(@ROOT@(LRI))):@ROOT@(LRI),$L($G(@ROOT@(LRI,0))):@ROOT@(LRI,0),1:""),LRINDX=LRINDX+1
"RTN","LR7OSAP1",112,0)
 . S X=$$FMT(FMT,.LRINDX,X)
"RTN","LR7OSAP1",113,0)
 S LRI=0
"RTN","LR7OSAP1",114,0)
 F  S LRI=$O(LRTX(LRI)) Q:'LRI  D LN^LR7OSAP S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LRTX(LRI))
"RTN","LR7OSAP1",115,0)
 Q
"RTN","LR7OSAP1",116,0)
FMT(LENGTH,INDEX,TEXT) ;Format text
"RTN","LR7OSAP1",117,0)
 N X,Y,J
"RTN","LR7OSAP1",118,0)
 S Y=1
"RTN","LR7OSAP1",119,0)
 S:'$D(LRTX(INDEX)) LRTX(INDEX)=""
"RTN","LR7OSAP1",120,0)
 S X=$L(TEXT)+$L(LRTX(INDEX))+1
"RTN","LR7OSAP1",121,0)
 I X<255 S TEXT=$S($L(LRTX(INDEX)):LRTX(INDEX)_" "_TEXT,1:TEXT)
"RTN","LR7OSAP1",122,0)
 I X'<255 S INDEX=INDEX+1,LRTX(INDEX)=""
"RTN","LR7OSAP1",123,0)
 S LRTX(INDEX)=""
"RTN","LR7OSAP1",124,0)
 F J=1:1 S X=$P(TEXT," ",J) Q:J>$L(TEXT," ")  D
"RTN","LR7OSAP1",125,0)
 . Q:'$L(X)
"RTN","LR7OSAP1",126,0)
 . I ($L(X)+$L(LRTX(INDEX)))>LENGTH S Y=1,INDEX=INDEX+1,LRTX(INDEX)=""
"RTN","LR7OSAP1",127,0)
 . S LRTX(INDEX)=$S(Y:X,1:LRTX(INDEX)_" "_X),Y=0
"RTN","LR7OSAP1",128,0)
 S LRTX(INDEX)=$$STRIP(LRTX(INDEX))
"RTN","LR7OSAP1",129,0)
 Q INDEX
"RTN","LR7OSAP1",130,0)
STRIP(TEXT) ; Strips white space from text
"RTN","LR7OSAP1",131,0)
 N LRI,LRX
"RTN","LR7OSAP1",132,0)
 S LRX="" F LRI=1:1:$L(TEXT," ") S:$A($P(TEXT," ",LRI))>0 LRX=LRX_$S(LRI=1:"",1:" ")_$P(TEXT," ",LRI)
"RTN","LR7OSAP1",133,0)
 S TEXT=LRX
"RTN","LR7OSAP1",134,0)
 Q TEXT
"RTN","LR7OSAP2")
0^11^B59162352^B52834321
"RTN","LR7OSAP2",1,0)
LR7OSAP2 ;ISL/RAB/WTY/KLL -Silent Routine for autopsy report;3/28/2002
"RTN","LR7OSAP2",2,0)
 ;;5.2;LAB SERVICE;**230,256,259,317**;Sep 27, 1994
"RTN","LR7OSAP2",3,0)
 ;
"RTN","LR7OSAP2",4,0)
 ;Reference  to ^DD(63 supported by IA #999
"RTN","LR7OSAP2",5,0)
 ;
"RTN","LR7OSAP2",6,0)
EN(LRDFN) ;
"RTN","LR7OSAP2",7,0)
 N CCNT,GIOM,XPOS,LR,LRSS,X,I,LRAU,LRS,VERIFIED,LRTEXT,LRPTR,X2
"RTN","LR7OSAP2",8,0)
 S XPOS=0,(LRS(5),LR("M"),CCNT)=1,LRSS="AU",GIOM=80
"RTN","LR7OSAP2",9,0)
 D EN^LRUA,^LRAPU
"RTN","LR7OSAP2",10,0)
 S X=$S($D(^LRO(69.2,+Y,0)):^(0),1:""),LRAU(3)=$P(X,"^",3),LRAU(4)=$P(X,"^",4)
"RTN","LR7OSAP2",11,0)
 D LINE,LN
"RTN","LR7OSAP2",12,0)
 S ^TMP("LRH",$J,"AUTOPSY")=GCNT,^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(28,CCNT,"---- AUTOPSY ----")
"RTN","LR7OSAP2",13,0)
 S VERIFIED=$P($G(^LR(LRDFN,"AU")),U,15)
"RTN","LR7OSAP2",14,0)
 I 'VERIFIED D  Q
"RTN","LR7OSAP2",15,0)
 . D LN
"RTN","LR7OSAP2",16,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,"Report not verified.")
"RTN","LR7OSAP2",17,0)
 D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS)
"RTN","LR7OSAP2",18,0)
 I +$G(LRPTR) D  Q
"RTN","LR7OSAP2",19,0)
 .D MAIN^LR7OSAP3(LRPTR)
"RTN","LR7OSAP2",20,0)
 D ZZ,LINE
"RTN","LR7OSAP2",21,0)
 I $D(^LR(LRDFN,84)) D
"RTN","LR7OSAP2",22,0)
 .D LN
"RTN","LR7OSAP2",23,0)
 .S LRTEXT="SUPPLEMENTARY REPORT HAS BEEN ADDED"
"RTN","LR7OSAP2",24,0)
 .S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(14,CCNT,"*+* "_LRTEXT_" *+*")
"RTN","LR7OSAP2",25,0)
 .D LN
"RTN","LR7OSAP2",26,0)
 .S LRTEXT="REFER TO BOTTOM OF REPORT"
"RTN","LR7OSAP2",27,0)
 .S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(19,CCNT,"*+* "_LRTEXT_" *+*")
"RTN","LR7OSAP2",28,0)
 .D LN
"RTN","LR7OSAP2",29,0)
 I $D(^LR(LRDFN,81)) D 
"RTN","LR7OSAP2",30,0)
 . D LN
"RTN","LR7OSAP2",31,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,LRAU(3))
"RTN","LR7OSAP2",32,0)
 . D F(81)
"RTN","LR7OSAP2",33,0)
 I $D(^LR(LRDFN,82)) D 
"RTN","LR7OSAP2",34,0)
 . D LN
"RTN","LR7OSAP2",35,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,LRAU(4))
"RTN","LR7OSAP2",36,0)
 . D F(82)
"RTN","LR7OSAP2",37,0)
 I $O(^LR(LRDFN,84,0)) D
"RTN","LR7OSAP2",38,0)
 . S I=0 F  S I=$O(^LR(LRDFN,84,I)) Q:'I  S X=^(I,0) D
"RTN","LR7OSAP2",39,0)
 .. ;Don't print supp date and text if supp has not been released
"RTN","LR7OSAP2",40,0)
 .. S X1=$P(X,"^",1),X2=$P(X,"^",2)
"RTN","LR7OSAP2",41,0)
 .. Q:'X2
"RTN","LR7OSAP2",42,0)
 .. D LINE,LN
"RTN","LR7OSAP2",43,0)
 .. S LRTEXT="SUPPLEMENTARY REPORT DATE: "_$$FMTE^XLFDT(X1,"1P")
"RTN","LR7OSAP2",44,0)
 .. S ^TMP("LRC",$J,GCNT,0)=LRTEXT
"RTN","LR7OSAP2",45,0)
 .. I $O(^LR(LRDFN,84,I,2,0)) D MODSR
"RTN","LR7OSAP2",46,0)
 .. D WRAP^LR7OSAP1("^LR("_LRDFN_",84,"_I_",1)",79)
"RTN","LR7OSAP2",47,0)
 Q:'$D(^LR(LRDFN,"AW"))&('$D(^("AY")))&('$D(^("AWI")))
"RTN","LR7OSAP2",48,0)
 D WT
"RTN","LR7OSAP2",49,0)
 D LRAPT3
"RTN","LR7OSAP2",50,0)
 ;Removed code that prints SNOMED codes per LR*5.2*259
"RTN","LR7OSAP2",51,0)
 Q
"RTN","LR7OSAP2",52,0)
MODSR ;Modified Autopsy Supplementary Report Audit Info
"RTN","LR7OSAP2",53,0)
 N LRTEXT,LRSP1,LRSP2,LRFILE,LRIENS,LRR1,LRR2
"RTN","LR7OSAP2",54,0)
 S LRFILE=63.3242
"RTN","LR7OSAP2",55,0)
 D LN
"RTN","LR7OSAP2",56,0)
 S LRTEXT="SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED"
"RTN","LR7OSAP2",57,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(14,CCNT,"*** "_LRTEXT_" ***")
"RTN","LR7OSAP2",58,0)
 D LN
"RTN","LR7OSAP2",59,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"(Added/Last modified: ")
"RTN","LR7OSAP2",60,0)
 S LRIENS=I_","_LRDFN_","
"RTN","LR7OSAP2",61,0)
 S LRSP1=0
"RTN","LR7OSAP2",62,0)
 F  S LRSP1=$O(^LR(LRDFN,84,I,2,LRSP1)) Q:'LRSP1  D
"RTN","LR7OSAP2",63,0)
 .S LRSP2=LRSP1
"RTN","LR7OSAP2",64,0)
 Q:'$D(^LR(LRDFN,84,I,2,LRSP2,0))
"RTN","LR7OSAP2",65,0)
 S LRS2=^(0),Y=+LRS2,LRS2A=$P(LRS2,"^",2),LRSGN=" typed by "
"RTN","LR7OSAP2",66,0)
 ;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LR7OSAP2",67,0)
 I $P(LRS2,"^",3) S Y=$P(LRS2,"^",4),LRS2A=$P(LRS2,"^",3),LRSGN=" signed by "
"RTN","LR7OSAP2",68,0)
 S LRS2A=$S($D(^VA(200,LRS2A,0)):$P(^(0),"^"),1:LRS2A)
"RTN","LR7OSAP2",69,0)
 D D^LRU
"RTN","LR7OSAP2",70,0)
 S LRR1=Y,LRR2=LRS2A
"RTN","LR7OSAP2",71,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_LRR1_LRSGN_LRR2_")"
"RTN","LR7OSAP2",72,0)
 ;If RELEASED SUPP REPORT MODIFIED set to 1, display "NOT VERIFIED"
"RTN","LR7OSAP2",73,0)
 I $P(^LR(LRDFN,84,I,0),"^",3) D
"RTN","LR7OSAP2",74,0)
 .D LN
"RTN","LR7OSAP2",75,0)
 .S LRTEXT="NOT VERIFIED"
"RTN","LR7OSAP2",76,0)
 .S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(25,CCNT,"**-* "_LRTEXT_" *-**")
"RTN","LR7OSAP2",77,0)
 Q
"RTN","LR7OSAP2",78,0)
LN ;Increment the counter
"RTN","LR7OSAP2",79,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","LR7OSAP2",80,0)
 Q
"RTN","LR7OSAP2",81,0)
LINE ;Fill in the global with bank lines
"RTN","LR7OSAP2",82,0)
 N X
"RTN","LR7OSAP2",83,0)
 D LN
"RTN","LR7OSAP2",84,0)
 S X="",$P(X," ",GIOM)="",^TMP("LRC",$J,GCNT,0)=X
"RTN","LR7OSAP2",85,0)
 Q
"RTN","LR7OSAP2",86,0)
F(NODE) ;;
"RTN","LR7OSAP2",87,0)
 D WRAP^LR7OSAP1("^LR("_LRDFN_","_NODE_")",79)
"RTN","LR7OSAP2",88,0)
 Q
"RTN","LR7OSAP2",89,0)
D ;
"RTN","LR7OSAP2",90,0)
 N LRB,M,X
"RTN","LR7OSAP2",91,0)
 S LRB=0
"RTN","LR7OSAP2",92,0)
 F  S LRB=$O(^LR(LRDFN,"AY",I,1,LRB)) Q:'LRB  S X=^(LRB,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,$P(^LAB(61.4,+X,0),"^"))
"RTN","LR7OSAP2",93,0)
 S LRB=0
"RTN","LR7OSAP2",94,0)
 F  S LRB=$O(^LR(LRDFN,"AY",I,3,LRB)) Q:'LRB  S X=^(LRB,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,$P(^LAB(61.3,+X,0),"^"))
"RTN","LR7OSAP2",95,0)
 S LRB=0
"RTN","LR7OSAP2",96,0)
 F  S LRB=$O(^LR(LRDFN,"AY",I,4,LRB)) Q:'LRB  S X=^(LRB,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,$P(^LAB(61.5,+X,0),"^"))
"RTN","LR7OSAP2",97,0)
 S M=0
"RTN","LR7OSAP2",98,0)
 F  S M=$O(^LR(LRDFN,"AY",I,2,M)) Q:'M  S X=^(M,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,$P(^LAB(61.1,+X,0),"^")) D E
"RTN","LR7OSAP2",99,0)
 Q
"RTN","LR7OSAP2",100,0)
E ;
"RTN","LR7OSAP2",101,0)
 N E
"RTN","LR7OSAP2",102,0)
 S E=0
"RTN","LR7OSAP2",103,0)
 F  S E=$O(^LR(LRDFN,"AY",I,2,M,1,E)) Q:'E  S X=^(E,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(7,CCNT,$P(^LAB(61.2,+X,0),"^"))
"RTN","LR7OSAP2",104,0)
 Q
"RTN","LR7OSAP2",105,0)
HD ;
"RTN","LR7OSAP2",106,0)
 D LINE
"RTN","LR7OSAP2",107,0)
 D LN
"RTN","LR7OSAP2",108,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,"Organ/tissue:")_$$S^LR7OS(33,CCNT,"SNOMED CODING")
"RTN","LR7OSAP2",109,0)
 Q
"RTN","LR7OSAP2",110,0)
WT ;
"RTN","LR7OSAP2",111,0)
 N B,X,OUT
"RTN","LR7OSAP2",112,0)
 I '$D(^LR(LRDFN,"AW")) D 
"RTN","LR7OSAP2",113,0)
 . D LINE,LN
"RTN","LR7OSAP2",114,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(20,CCNT,"No organ weights entered.")
"RTN","LR7OSAP2",115,0)
 . D LINE
"RTN","LR7OSAP2",116,0)
 I $D(^LR(LRDFN,"AW")) S X=^("AW") D 
"RTN","LR7OSAP2",117,0)
 . S B(9)=$P(X,"^",9),B(1)=$P(X,"^",11,99)
"RTN","LR7OSAP2",118,0)
 . D LINE,LN
"RTN","LR7OSAP2",119,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,"Rt--Lung--Lt  Liver Spleen  RT--Kidney--Lt  Brain  Body Wt(lb)    Ht(in)")
"RTN","LR7OSAP2",120,0)
 I $D(B) D
"RTN","LR7OSAP2",121,0)
 . D LN
"RTN","LR7OSAP2",122,0)
 . S OUT=$$S^LR7OS(XPOS,CCNT,$J($P(X,"^",3),4))_$$S^LR7OS(9,CCNT,$J($P(X,"^",4),4))_$$S^LR7OS(15,CCNT,$J($P(X,"^",5),5))_$$S^LR7OS(22,CCNT,$J($P(X,"^",6),5))_$$S^LR7OS(29,CCNT,$J($P(X,"^",7),4))_$$S^LR7OS(39,CCNT,$J($P(X,"^",8),4))
"RTN","LR7OSAP2",123,0)
 . S OUT=OUT_$$S^LR7OS(45,CCNT,$J($P(X,"^",10),4))_$$S^LR7OS(55,CCNT,$P(X,"^",2))_$$S^LR7OS(68,CCNT,$P(X,"^"))
"RTN","LR7OSAP2",124,0)
 . S ^TMP("LRC",$J,GCNT,0)=OUT
"RTN","LR7OSAP2",125,0)
 D LINE,LN
"RTN","LR7OSAP2",126,0)
 S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSAP2",127,0)
 I $D(B) S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,"Heart(gm)")
"RTN","LR7OSAP2",128,0)
 I $D(^LR(LRDFN,"AV")) S X=^("AV"),B(2)=$P(X,"^",7,99),^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(12,CCNT,"TV(cm)  PV(cm)  MV(cm)  AV(cm)  RV(cm)  LV(cm)")
"RTN","LR7OSAP2",129,0)
 D LN
"RTN","LR7OSAP2",130,0)
 S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSAP2",131,0)
 I $D(B(9)) S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,$J(B(9),5))
"RTN","LR7OSAP2",132,0)
 I $D(B(2)) D
"RTN","LR7OSAP2",133,0)
 . S OUT=$$S^LR7OS(12,CCNT,$J($P(X,"^"),4))_$$S^LR7OS(20,CCNT,$J($P(X,"^",2),4))_$$S^LR7OS(28,CCNT,$J($P(X,"^",3),4))_$$S^LR7OS(36,CCNT,$J($P(X,"^",4),4))_$$S^LR7OS(44,CCNT,$J($P(X,"^",5),4))_$$S^LR7OS(52,CCNT,$J($P(X,"^",6),4))
"RTN","LR7OSAP2",134,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_OUT
"RTN","LR7OSAP2",135,0)
 . D LINE,LN
"RTN","LR7OSAP2",136,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,"Cavities(ml): Rt--Pleural--Lt  Pericardial  Peritoneal")
"RTN","LR7OSAP2",137,0)
 . D LN
"RTN","LR7OSAP2",138,0)
 . S OUT=$$S^LR7OS(14,CCNT,$J($P(B(2),"^",2),4))_$$S^LR7OS(25,CCNT,$J($P(B(2),"^"),4))_$$S^LR7OS(33,CCNT,$J($P(B(2),"^",3),4))_$$S^LR7OS(45,CCNT,$J($P(B(2),"^",4),4))
"RTN","LR7OSAP2",139,0)
 . S ^TMP("LRC",$J,GCNT,0)=OUT
"RTN","LR7OSAP2",140,0)
 I $D(B(1)) F B=1:1:8 D 
"RTN","LR7OSAP2",141,0)
 . I $P(B(1),"^",B) D 
"RTN","LR7OSAP2",142,0)
 .. S X="25."_B
"RTN","LR7OSAP2",143,0)
 .. D LN
"RTN","LR7OSAP2",144,0)
 .. S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,$P(^DD(63,X,0),"^")_": "_$P(B(1),"^",B))
"RTN","LR7OSAP2",145,0)
 I $D(^LR(LRDFN,"AWI")) S Y=^("AWI") F B=1:1:5 I $P(Y,"^",B) D LN S X=$S(B=1:25.9,1:25.9_(B-1)),^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,$P(^DD(63,X,0),"^")_": "_$P(Y,"^",B))
"RTN","LR7OSAP2",146,0)
 Q
"RTN","LR7OSAP2",147,0)
ZZ ;;
"RTN","LR7OSAP2",148,0)
 D LN
"RTN","LR7OSAP2",149,0)
 N OUT,X,LRLLOC,DA,A,B,C,LR,Y
"RTN","LR7OSAP2",150,0)
 S OUT=$$S^LR7OS(XPOS,CCNT,"Acc #")_$$S^LR7OS(9,CCNT,"Date/time Died")_$$S^LR7OS(27,CCNT,"Age")_$$S^LR7OS(33,CCNT,"AUTOPSY DATA")_$$S^LR7OS(53,CCNT,"Date/time of Autopsy"),^TMP("LRC",$J,GCNT,0)=OUT
"RTN","LR7OSAP2",151,0)
 S X=^LR(LRDFN,"AU"),LRLLOC=$P(X,"^",8),DA=LRDFN
"RTN","LR7OSAP2",152,0)
 D D^LRAUAW
"RTN","LR7OSAP2",153,0)
 S Y=LR(63,12)
"RTN","LR7OSAP2",154,0)
 D D^LRU,LN
"RTN","LR7OSAP2",155,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,($P(X,"^",6)_" "_Y))_$$S^LR7OS(26,CCNT,$J($P(X,"^",9),3))_$$S^LR7OS(33,CCNT,PNM)
"RTN","LR7OSAP2",156,0)
 S Y=+X
"RTN","LR7OSAP2",157,0)
 D D^LRU
"RTN","LR7OSAP2",158,0)
 I Y'[1700 S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(53,CCNT,Y)
"RTN","LR7OSAP2",159,0)
 D LN
"RTN","LR7OSAP2",160,0)
 S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSAP2",161,0)
 F X(1)=7,10 D
"RTN","LR7OSAP2",162,0)
 . S Y=$P(X,"^",X(1)),Y=$S(Y="":Y,$D(^VA(200,Y,0)):$P(^(0),"^"),1:Y)
"RTN","LR7OSAP2",163,0)
 . I Y]"" S ^TMP("LRC",$J,GCNT,0)=^TMP("LRC",$J,GCNT,0)_$S(X(1)=7:$$S^LR7OS(1,CCNT,"Resident: ")_Y,1:$$S^LR7OS(38,CCNT,"Senior: ")_Y)
"RTN","LR7OSAP2",164,0)
 Q
"RTN","LR7OSAP2",165,0)
LRAPT3 ;COPIED FROM ^LRAPT3
"RTN","LR7OSAP2",166,0)
 ;;
"RTN","LR7OSAP2",167,0)
 N A,C,X,T,F
"RTN","LR7OSAP2",168,0)
 S (F,A)=0
"RTN","LR7OSAP2",169,0)
 F  S A=$O(^LR(LRDFN,"AY",A)) Q:'A  D
"RTN","LR7OSAP2",170,0)
 .I $D(^LR(LRDFN,"AY",A,0)) S T=+^(0) D
"RTN","LR7OSAP2",171,0)
 ..S T(1)=$P($G(^LAB(61,T,0)),"^")
"RTN","LR7OSAP2",172,0)
 ..S C=0 F  S C=$O(^LR(LRDFN,"AY",A,5,C)) Q:'C  D
"RTN","LR7OSAP2",173,0)
 ...S X=^LR(LRDFN,"AY",A,5,C,0) D SP(X) S F=1
"RTN","LR7OSAP2",174,0)
 ;Removed code that prints ICD codes per LR*5.2*259
"RTN","LR7OSAP2",175,0)
 Q
"RTN","LR7OSAP2",176,0)
SP(NODE) ;
"RTN","LR7OSAP2",177,0)
 N Y,E,X,A1,B
"RTN","LR7OSAP2",178,0)
 S Y=$P(NODE,"^",2),E=$P(NODE,"^",3),X=$P(NODE,"^")_":",A1=$P($P(LRAU("S"),X,2),";",1)
"RTN","LR7OSAP2",179,0)
 D D^LRU
"RTN","LR7OSAP2",180,0)
 S T(2)=Y
"RTN","LR7OSAP2",181,0)
 I 'F D LINE,LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,T(1))
"RTN","LR7OSAP2",182,0)
 D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,A1_" "_E_" Date: "_T(2))
"RTN","LR7OSAP2",183,0)
 D WRAP^LR7OSAP1("^LR("_LRDFN_",""AY"","_A_",5,"_C_",1)",80)
"RTN","LR7OSAP2",184,0)
 Q
"RTN","LR7OSAP2",185,0)
OUT ;Show output
"RTN","LR7OSAP2",186,0)
 Q:'$D(^TMP("LRC",$J))
"RTN","LR7OSAP2",187,0)
 N I
"RTN","LR7OSAP2",188,0)
 S I=0
"RTN","LR7OSAP2",189,0)
 F  S I=$O(^TMP("LRC",$J,I)) Q:'I  W !,^(I,0)
"RTN","LR7OSAP2",190,0)
 Q
"RTN","LRAPAUSR")
0^13^B34793694^B34065623
"RTN","LRAPAUSR",1,0)
LRAPAUSR ;AVAMC/REG/WTY - AUTOPSY SUPPLEMENTARY REPORT;9/14/01
"RTN","LRAPAUSR",2,0)
 ;;5.2;LAB SERVICE;**1,173,248,259,317**;Sep 27, 1994
"RTN","LRAPAUSR",3,0)
 ;
"RTN","LRAPAUSR",4,0)
 ;Reference to ^DD(63 supported by IA #10155
"RTN","LRAPAUSR",5,0)
 ;
"RTN","LRAPAUSR",6,0)
 S X="T",%DT="" D ^%DT,D^LRU S LRH(3)=Y,LRFLG=1
"RTN","LRAPAUSR",7,0)
 W !!,LRO(68)," Autopsy Supplementary Reports" D XR^LRU
"RTN","LRAPAUSR",8,0)
 S LRS(1)=$P(^LRO(69.2,LRAA,0),U,3),LRS(2)=$P(^(0),U,4)
"RTN","LRAPAUSR",9,0)
 D EN2^LRUA
"RTN","LRAPAUSR",10,0)
 G END:LRAPX=2,SGL:LRAPX=3,CH:LRAPX=4
"RTN","LRAPAUSR",11,0)
 S XTMP="Someone else is building a print queue for this Accession Area"
"RTN","LRAPAUSR",12,0)
 L +^LRO(69.2,LRAA,3):5 I '$T D EN^DDIOL(XTMP,"","$C(7),!!") K XTMP Q
"RTN","LRAPAUSR",13,0)
GETP ;Add a patient to the report queue
"RTN","LRAPAUSR",14,0)
 W ! S X="" D ^LRUPS G GETP:LRAN["?" I LRAN=-1 L -^LRO(69.2,LRAA,3) Q
"RTN","LRAPAUSR",15,0)
 S FDAIEN(2)=LRAN
"RTN","LRAPAUSR",16,0)
 S FDA(1,69.29,"+2,"_+LRAA_",",.01)=LRDFN
"RTN","LRAPAUSR",17,0)
 D UPDATE^DIE("","FDA(1)","FDAIEN") K FDAIEN G GETP
"RTN","LRAPAUSR",18,0)
CH I '$O(^LRO(69.2,LRAA,3,0)) D  Q
"RTN","LRAPAUSR",19,0)
 .W $C(7),!!,"No AUTOPSY SUPPLEMENTARY REPORTS currently on the "
"RTN","LRAPAUSR",20,0)
 .W "print queue.",!!
"RTN","LRAPAUSR",21,0)
SPC R !,"(D)ouble or (S)ingle spacing of report(s): ",X:DTIME
"RTN","LRAPAUSR",22,0)
 Q:X=""!(X[U)
"RTN","LRAPAUSR",23,0)
 I $E(X)'="D"&($E(X)'="S") D  G SPC
"RTN","LRAPAUSR",24,0)
 .W $C(7),!,"Enter 'S' for single or 'D' for double spacing of reports"
"RTN","LRAPAUSR",25,0)
 S LRS=$S(X="D":"D",1:"")_"W" Q:LRAPX=3
"RTN","LRAPAUSR",26,0)
 W !!,"Save supplementary report list for reprinting "
"RTN","LRAPAUSR",27,0)
 S %=2 D YN^LRU S:%=1 LRSAV=1
"RTN","LRAPAUSR",28,0)
DEV ;
"RTN","LRAPAUSR",29,0)
 W !
"RTN","LRAPAUSR",30,0)
 S %ZIS="Q" D ^%ZIS
"RTN","LRAPAUSR",31,0)
 I POP W ! Q
"RTN","LRAPAUSR",32,0)
 I $D(IO("Q")) D  Q
"RTN","LRAPAUSR",33,0)
 .S ZTDESC="ANAT PATH FINAL REPORT"
"RTN","LRAPAUSR",34,0)
 .S ZTSAVE("LR*")="",ZTRTN="QUE^LRAPAUSR"
"RTN","LRAPAUSR",35,0)
 .D ^%ZTLOAD W:$D(ZTSK) !,"Request Queued, #",ZTSK W !
"RTN","LRAPAUSR",36,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","LRAPAUSR",37,0)
QUE U IO D L^LRU,S^LRU,EN^LRUA
"RTN","LRAPAUSR",38,0)
 ;LRSF515=1 indicates that an SF515 is being generated.
"RTN","LRAPAUSR",39,0)
 S:'$D(LRSF515) LRSF515=0
"RTN","LRAPAUSR",40,0)
 S (LRS(5),LRAURPT)=1
"RTN","LRAPAUSR",41,0)
 I $D(LRAP) S LRDFN=LRAP D EN Q:LR("Q")  K LRAP G LST
"RTN","LRAPAUSR",42,0)
 F LRAN=0:0 S LRAN=$O(^LRO(69.2,LRAA,3,LRAN)) Q:'LRAN!(LR("Q"))  D
"RTN","LRAPAUSR",43,0)
 .S LRDFN=+^(LRAN,0) D EN
"RTN","LRAPAUSR",44,0)
LST K:'$D(LRSAV) ^LRO(69.2,LRAA,3) K LRAURPT
"RTN","LRAPAUSR",45,0)
 S:'$D(^LRO(69.2,LRAA,3,0)) ^(0)="^69.29A^0^0"
"RTN","LRAPAUSR",46,0)
 I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRAPAUSR",47,0)
 K LRSAV D K^LRU
"RTN","LRAPAUSR",48,0)
 W:IOST?1"P-".E @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LRAPAUSR",49,0)
 K %,DIR,DTOUT,DUOUT,DIRUT,X,Y
"RTN","LRAPAUSR",50,0)
 Q
"RTN","LRAPAUSR",51,0)
W W !,LR("%") Q
"RTN","LRAPAUSR",52,0)
E K ^UTILITY($J) S DIWR=IOM-5,DIWL=5,DIWF=LRS Q
"RTN","LRAPAUSR",53,0)
 ;
"RTN","LRAPAUSR",54,0)
EN S LRQ=0,X=^LR(LRDFN,0) Q:'$O(^LR(LRDFN,84,0))  D ^LRUP
"RTN","LRAPAUSR",55,0)
 I '$D(^LR(LRDFN,"AU")) L +^LRO(69.2,LRAA,3,LRAN):5 Q:'$T  D  Q
"RTN","LRAPAUSR",56,0)
 .S DIK="^LRO(69.2,LRAA,3,",DA=LRAN,DA(1)=0
"RTN","LRAPAUSR",57,0)
 .D ^DIK K KA,DIK
"RTN","LRAPAUSR",58,0)
 .L -^LRO(69.2,LRAA,3,LRAN)
"RTN","LRAPAUSR",59,0)
 S X=^LR(LRDFN,"AU"),LRAC=$P(X,"^",6),LRM(2)=$P(X,"^",7)
"RTN","LRAPAUSR",60,0)
 S LRM(1)=$P(X,"^",12),LRW(9)=$P(X,"^",13),LRM(3)=$P(X,"^",10)
"RTN","LRAPAUSR",61,0)
 S Y=$P(X,"^"),LRH(2)=$E(Y,2,3) D D^LRU S LRH(1)=Y
"RTN","LRAPAUSR",62,0)
 S LRLLOC=$P(X,"^",5),AGE=$P(X,"^",9)
"RTN","LRAPAUSR",63,0)
 ;Define the service
"RTN","LRAPAUSR",64,0)
 S Y=$P(X,"^",8),C=$P(^DD(63,14.5,0),U,3)
"RTN","LRAPAUSR",65,0)
 D Y^DIQ S LRSVC=Y
"RTN","LRAPAUSR",66,0)
 ;Define autopsy type
"RTN","LRAPAUSR",67,0)
 S Y=$P(X,"^",11),C=$P(^DD(63,13.7,0),U,3)
"RTN","LRAPAUSR",68,0)
 D Y^DIQ S LRS(3)=Y
"RTN","LRAPAUSR",69,0)
 S DA=LRDFN D D^LRAUAW S Y=LR(63,12) D D^LRU S LRH=Y,X=LRM(1)
"RTN","LRAPAUSR",70,0)
 D:X D^LRUA S LRM(1)=X,X=LRM(2) D:X D^LRUA S LRM(2)=X,X=LRM(3)
"RTN","LRAPAUSR",71,0)
 D:X D^LRUA S LRM(3)=X
"RTN","LRAPAUSR",72,0)
 D H Q:LR("Q")  S LR("F")=1
"RTN","LRAPAUSR",73,0)
 W:LRH(1)="" !?20,"+*+* REPORT INCOMPLETE *+*+"
"RTN","LRAPAUSR",74,0)
 S LRA=0 F  S LRA=$O(^LR(LRDFN,84,LRA)) Q:'LRA!(LR("Q"))  D
"RTN","LRAPAUSR",75,0)
 .S LRB=^LR(LRDFN,84,LRA,0)
"RTN","LRAPAUSR",76,0)
 .D:$Y>(IOSL-13) FT,H Q:LR("Q")
"RTN","LRAPAUSR",77,0)
 .W !!,"SUPPLEMENTARY REPORT DATE: "
"RTN","LRAPAUSR",78,0)
 .S Y=LRB D D^LRU W Y
"RTN","LRAPAUSR",79,0)
 .D:$Y>(IOSL-13) FT,H Q:LR("Q")
"RTN","LRAPAUSR",80,0)
 .D:$P($G(^LR(LRDFN,84,LRA,2,0)),U,4) SUPA
"RTN","LRAPAUSR",81,0)
 .D WRT
"RTN","LRAPAUSR",82,0)
 Q:LR("Q")  D FT Q
"RTN","LRAPAUSR",83,0)
WRT D E S LRC=0
"RTN","LRAPAUSR",84,0)
 F LRZ=0:1 S LRC=$O(^LR(LRDFN,84,LRA,1,LRC)) Q:'LRC!(LR("Q"))  D
"RTN","LRAPAUSR",85,0)
 .D:$Y>(IOSL-13) FT,H S LR("F")=1 Q:LR("Q")
"RTN","LRAPAUSR",86,0)
 .S X=^LR(LRDFN,84,LRA,1,LRC,0) D:X["|TOP|" TOP D ^DIWP
"RTN","LRAPAUSR",87,0)
 Q:LR("Q")  D:LRZ ^DIWW
"RTN","LRAPAUSR",88,0)
 Q
"RTN","LRAPAUSR",89,0)
SUPA ;Print supplementary report audit information
"RTN","LRAPAUSR",90,0)
 W !?14,"*+* SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED*+*"
"RTN","LRAPAUSR",91,0)
 W !,"(Added/Last modified: "
"RTN","LRAPAUSR",92,0)
 S (A,B)=0 F  S A=$O(^LR(LRDFN,84,LRA,2,A)) Q:'A!(LR("Q"))  D
"RTN","LRAPAUSR",93,0)
 .S B=A
"RTN","LRAPAUSR",94,0)
 Q:LR("Q")
"RTN","LRAPAUSR",95,0)
 Q:'$D(^LR(LRDFN,84,LRA,2,B,0))
"RTN","LRAPAUSR",96,0)
 S A=^(0),Y=+A,LRSGN=" typed by ",A2=$P(A,"^",2)
"RTN","LRAPAUSR",97,0)
 I $P(A,"^",3) D
"RTN","LRAPAUSR",98,0)
 .S LRSGN=" signed by ",A2=$P(A,"^",3),Y=$P(A,"^",4)
"RTN","LRAPAUSR",99,0)
 S A2=$S($D(^VA(200,A2,0)):$P(^(0),"^"),1:A2)
"RTN","LRAPAUSR",100,0)
 ;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRAPAUSR",101,0)
 D D^LRU W Y,LRSGN,A2,")"
"RTN","LRAPAUSR",102,0)
 ;If RELEASE SUPP REPORT MODIFIED set to 1, display "NOT VERIFIED"
"RTN","LRAPAUSR",103,0)
 I $P(^LR(LRDFN,84,LRA,0),"^",3) W !,?25,"**-* NOT VERIFIED *-**"
"RTN","LRAPAUSR",104,0)
 D:$D(LRQ(9)) SUPM
"RTN","LRAPAUSR",105,0)
 Q
"RTN","LRAPAUSR",106,0)
SUPM ;Print previous versions of supplementary reports
"RTN","LRAPAUSR",107,0)
 ;This is used by menu option 'Print path modifications [LRAPMOD]'
"RTN","LRAPAUSR",108,0)
 ;
"RTN","LRAPAUSR",109,0)
 S A=0 F  S A=$O(^LR(LRDFN,84,LRA,2,A)) Q:'A!(LR("Q"))  D
"RTN","LRAPAUSR",110,0)
 .S LRT=^LR(LRDFN,84,LRA,2,A,0)
"RTN","LRAPAUSR",111,0)
 .D:$Y>(IOSL-13) FT,H Q:LR("Q")
"RTN","LRAPAUSR",112,0)
 .S Y=+LRT,Y2="modified: ",X=$P(LRT,"^",2),LRSGN="  typed by "
"RTN","LRAPAUSR",113,0)
 .;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRAPAUSR",114,0)
 .I $P(LRT,"^",3) S LRSGN=" signed by",X=$P(LRT,"^",3),Y=$P(LRT,"^",4),Y2="released: "
"RTN","LRAPAUSR",115,0)
 .S X=$S($D(^VA(200,X,0)):$P(^(0),"^"),1:X)
"RTN","LRAPAUSR",116,0)
 .D D^LRU W !,"Date ",Y2,Y,LRSGN,X
"RTN","LRAPAUSR",117,0)
 .K ^UTILITY($J) S DIWR=IOM-5,DIWL=5,DIWF="W"
"RTN","LRAPAUSR",118,0)
 .S B=0
"RTN","LRAPAUSR",119,0)
 .F LRZ=0:1 S B=$O(^LR(LRDFN,84,LRA,2,A,1,B)) Q:'B!(LR("Q"))  D
"RTN","LRAPAUSR",120,0)
 ..S LRT=^LR(LRDFN,84,LRA,2,A,1,B,0)
"RTN","LRAPAUSR",121,0)
 ..D:$Y>(IOSL-13) FT,H Q:LR("Q")
"RTN","LRAPAUSR",122,0)
 ..S X=LRT D ^DIWP
"RTN","LRAPAUSR",123,0)
 .Q:LR("Q")  D:LRZ ^DIWW
"RTN","LRAPAUSR",124,0)
 Q:LR("Q")
"RTN","LRAPAUSR",125,0)
 W !?13,"==========Text below appears on final report=========="
"RTN","LRAPAUSR",126,0)
 Q
"RTN","LRAPAUSR",127,0)
H ;Header
"RTN","LRAPAUSR",128,0)
 I $D(LR("F")),IOST?1"C".E D CONT  Q:LR("Q")
"RTN","LRAPAUSR",129,0)
 W:($D(LR("F"))) @IOF
"RTN","LRAPAUSR",130,0)
 S LRQ=LRQ+1
"RTN","LRAPAUSR",131,0)
 ;W:IOST?1"C".E!(IOST'?1"C".E&('$D(LRFLG))) @IOF,!
"RTN","LRAPAUSR",132,0)
 ;K LRFLG
"RTN","LRAPAUSR",133,0)
 W ! D W
"RTN","LRAPAUSR",134,0)
 W !?5,"CLINICAL RECORD |",?40,"AUTOPSY SUPPLEMENTARY REPORT"
"RTN","LRAPAUSR",135,0)
 W ?73,"Pg ",LRQ,!,LR("%")
"RTN","LRAPAUSR",136,0)
 W !,"Date died: ",LRH,?40,"| Autopsy date: ",LRH(1)
"RTN","LRAPAUSR",137,0)
 W !,"Resident: ",LRM(2),?40,"| ",LRS(3)
"RTN","LRAPAUSR",138,0)
 W ?56,"Autopsy No. ",$S(LRQ(8)]"":LRQ(8)_LRH(2)_" "_LRAC,1:LRAC)
"RTN","LRAPAUSR",139,0)
 W !,LR("%")
"RTN","LRAPAUSR",140,0)
 Q
"RTN","LRAPAUSR",141,0)
FT ;Footer
"RTN","LRAPAUSR",142,0)
 Q:LR("Q")
"RTN","LRAPAUSR",143,0)
 I IOSL'>66 F  Q:$Y>(IOSL-13)  W !
"RTN","LRAPAUSR",144,0)
 D W W !!,"Pathologist: ",LRM(3),?52,LRW(9),?55,"| Date ",$E(LRH(3),1,12)
"RTN","LRAPAUSR",145,0)
 D W W !,LRQ(1),?(IOM-30),"AUTOPSY SUPPLEMENTARY REPORT"
"RTN","LRAPAUSR",146,0)
 W !,$E(LRP,1,30),?31,SSN,?49,"SEX:",SEX,?55,"DOB:",DOB,!,LRLLOC
"RTN","LRAPAUSR",147,0)
 W ?31,LRM(1),?55,"AGE AT DEATH: ",AGE
"RTN","LRAPAUSR",148,0)
 Q
"RTN","LRAPAUSR",149,0)
SGL ;Entry point for printing single report
"RTN","LRAPAUSR",150,0)
 S X="" D ^LRUPS G:LRAN="?" SGL Q:LRAN=-1
"RTN","LRAPAUSR",151,0)
 I $D(LR("AU1")),'$P(^LR(LRDFN,"AU"),U,15) D  Q
"RTN","LRAPAUSR",152,0)
 .W $C(7),!!,"Report not verified."
"RTN","LRAPAUSR",153,0)
 D SPC Q:X=""!(X[U)
"RTN","LRAPAUSR",154,0)
 S LRAP=LRDFN,LRSAV=1
"RTN","LRAPAUSR",155,0)
 D EN2^LRUA
"RTN","LRAPAUSR",156,0)
 G DEV
"RTN","LRAPAUSR",157,0)
CONT ;
"RTN","LRAPAUSR",158,0)
 K DIR S DIR(0)="E"
"RTN","LRAPAUSR",159,0)
 D ^DIR W !
"RTN","LRAPAUSR",160,0)
 S:$D(DTOUT)!(X[U) LR("Q")=1
"RTN","LRAPAUSR",161,0)
 Q
"RTN","LRAPAUSR",162,0)
END ;
"RTN","LRAPAUSR",163,0)
 W $C(7),!!,"OK to delete the AUTOPSY SUPPLEMENTARY REPORT list "
"RTN","LRAPAUSR",164,0)
 S %=2 D YN^LRU
"RTN","LRAPAUSR",165,0)
 I %=1 K ^LRO(69.2,LRAA,3) S ^LRO(69.2,LRAA,3,0)="^69.29A^0^0" D  Q
"RTN","LRAPAUSR",166,0)
 .W $C(7),!,"LIST DELETED !",!
"RTN","LRAPAUSR",167,0)
 W !!,"OK, LET'S FORGET IT.",!
"RTN","LRAPAUSR",168,0)
 Q
"RTN","LRAPAUSR",169,0)
TOP S Z=$P(X,"|TOP|",1)_$P(X,"|TOP|",2)
"RTN","LRAPAUSR",170,0)
 D FT,H S X=Z,LR("F")=1
"RTN","LRAPAUSR",171,0)
 Q
"RTN","LRAPBR1")
0^17^B58834636^B54673575
"RTN","LRAPBR1",1,0)
LRAPBR1 ;DALOI/WTY/KLL;AP Browser Print Cont.;11/08/01
"RTN","LRAPBR1",2,0)
 ;;5.2;LAB SERVICE;**259,317**;Sep 27, 1994
"RTN","LRAPBR1",3,0)
 ;
"RTN","LRAPBR1",4,0)
 ;
"RTN","LRAPBR1",5,0)
ENTER ;from LRAPBR
"RTN","LRAPBR1",6,0)
 N LRCNT,LRTMP,LRA1,LRADESC,LRLENG1,LRLENG2,LRFILE,LRAPMD
"RTN","LRAPBR1",7,0)
 N LRFLD,LRV,LRV1,LRV2,LRB1,LRTEXT,LRSPCE,LRIENS,LRAPMR
"RTN","LRAPBR1",8,0)
 Q:'$D(^LR(LRDFN,LRSS,LRI,0))
"RTN","LRAPBR1",9,0)
 S:'LRTIU GROOT="^TMP(""LRAPBR"",$J,"
"RTN","LRAPBR1",10,0)
 S:LRTIU GROOT="^TMP(""TIUP"",$J,"
"RTN","LRAPBR1",11,0)
 D INP^VADPT S LRPRAC=+VAIN(2)
"RTN","LRAPBR1",12,0)
 S:'LRPRAC LRPRAC(1)=""
"RTN","LRAPBR1",13,0)
 I LRPRAC S X=LRPRAC D D^LRUA S LRPRAC(1)=X
"RTN","LRAPBR1",14,0)
 S LRQ=0 D ^LRUA,HEADER
"RTN","LRAPBR1",15,0)
 S LR("F")=1
"RTN","LRAPBR1",16,0)
 D DASH
"RTN","LRAPBR1",17,0)
 D:LRTIU GLENTRY("$TEXT",,1)
"RTN","LRAPBR1",18,0)
 D GLENTRY("Submitted by: "_LRW(5),"",1)
"RTN","LRAPBR1",19,0)
 D GLENTRY("Date obtained: "_LRTK,44)
"RTN","LRAPBR1",20,0)
 D:LRA DASH
"RTN","LRAPBR1",21,0)
MAIN ;
"RTN","LRAPBR1",22,0)
 D SPEC
"RTN","LRAPBR1",23,0)
 D MODCHK
"RTN","LRAPBR1",24,0)
 D SUPBNNR
"RTN","LRAPBR1",25,0)
 D DIAG
"RTN","LRAPBR1",26,0)
 D DOC
"RTN","LRAPBR1",27,0)
 D WPFLD
"RTN","LRAPBR1",28,0)
 D SUPRPT
"RTN","LRAPBR1",29,0)
 D SSJR
"RTN","LRAPBR1",30,0)
 Q
"RTN","LRAPBR1",31,0)
SPEC ;List specimens
"RTN","LRAPBR1",32,0)
 D GLENTRY("Specimen (Received "_LRTK(1)_"):","",1)
"RTN","LRAPBR1",33,0)
 S LRCNT=$P(^LR(LRDFN,LRSS,LRI,.1,0),U,4)
"RTN","LRAPBR1",34,0)
 Q:'LRCNT
"RTN","LRAPBR1",35,0)
 S LRFILE=+$$GET1^DID(LRSF,.012,"","SPECIFIER")
"RTN","LRAPBR1",36,0)
 S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPBR1",37,0)
 S LRCT2=0
"RTN","LRAPBR1",38,0)
 F LRB1=1:1 D  Q:LRCT2=LRCNT
"RTN","LRAPBR1",39,0)
 .D GETS^DIQ(LRFILE,LRB1_","_LRIENS,.01,"","LRTMP("_LRB1_")")
"RTN","LRAPBR1",40,0)
 .I $D(LRTMP(LRB1)) S LRCT2=LRCT2+1
"RTN","LRAPBR1",41,0)
 S LRA1=0 F  S LRA1=$O(LRTMP(LRA1)) Q:'LRA1  D
"RTN","LRAPBR1",42,0)
 .S LRTEXT=LRTMP(LRA1,LRFILE,LRA1_","_LRIENS,.01)
"RTN","LRAPBR1",43,0)
 .D GLENTRY(LRTEXT,"",1)
"RTN","LRAPBR1",44,0)
 Q
"RTN","LRAPBR1",45,0)
MODCHK ;Display modified banner if required
"RTN","LRAPBR1",46,0)
 S LRAPMR=$$GET1^DIQ(LRSF,LRIENS,.17,"I")
"RTN","LRAPBR1",47,0)
 Q:'LRAPMR
"RTN","LRAPBR1",48,0)
 S LRAPMD=$$GET1^DIQ(LRSF,LRIENS,.172,"I")
"RTN","LRAPBR1",49,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",50,0)
 S LRTEXT=""
"RTN","LRAPBR1",51,0)
 F LRCNT=1:1:$S(LRAPMD:14,1:15) D
"RTN","LRAPBR1",52,0)
 .S LRTEXT=LRTEXT_"*+"
"RTN","LRAPBR1",53,0)
 S LRTEXT=LRTEXT_" MODIFIED "
"RTN","LRAPBR1",54,0)
 S LRTEXT=LRTEXT_$S(LRAPMD:"DIAGNOSIS ",1:"REPORT ")
"RTN","LRAPBR1",55,0)
 F LRCNT=1:1:$S(LRAPMD:14,1:15) D
"RTN","LRAPBR1",56,0)
 .S LRTEXT=LRTEXT_"*+"
"RTN","LRAPBR1",57,0)
 D GLENTRY(LRTEXT,"",1)
"RTN","LRAPBR1",58,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",59,0)
 Q
"RTN","LRAPBR1",60,0)
SUPBNNR ;Display supplementary report header if one or more has been added
"RTN","LRAPBR1",61,0)
 I $P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),U,4) D
"RTN","LRAPBR1",62,0)
 .S LRTEXT="*+* SUPPLEMENTARY REPORT HAS BEEN ADDED *+*"
"RTN","LRAPBR1",63,0)
 .D GLENTRY($$CJ^XLFSTR(LRTEXT,IOM),"",1)
"RTN","LRAPBR1",64,0)
 .S LRTEXT="*+* REFER TO BOTTOM OF REPORT *+*"
"RTN","LRAPBR1",65,0)
 .D GLENTRY($$CJ^XLFSTR(LRTEXT,IOM),"",1)
"RTN","LRAPBR1",66,0)
 .D GLENTRY("","",1)
"RTN","LRAPBR1",67,0)
 Q
"RTN","LRAPBR1",68,0)
DIAG ;
"RTN","LRAPBR1",69,0)
 ;Display the Brief Clinical History, Preoperative Diagnosis,
"RTN","LRAPBR1",70,0)
 ;Operative Findings, and Postoperative Diagnosis
"RTN","LRAPBR1",71,0)
 S LRFILE=LRSF,LRCNT=0,LRIENS=LRI_","_LRDFN_","
"RTN","LRAPBR1",72,0)
 F LRFLD=.013:.001:.016 D
"RTN","LRAPBR1",73,0)
 .D:LRA DASH
"RTN","LRAPBR1",74,0)
 .S LRCNT=LRCNT+1
"RTN","LRAPBR1",75,0)
 .D GLENTRY($P($T(TEXT1+LRCNT),";",2),"",1)
"RTN","LRAPBR1",76,0)
 .D WP
"RTN","LRAPBR1",77,0)
 Q
"RTN","LRAPBR1",78,0)
DOC ;
"RTN","LRAPBR1",79,0)
 ;Pathologist information
"RTN","LRAPBR1",80,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",81,0)
 D GLENTRY("Surgeon/physician: "_LRMD,27,1)
"RTN","LRAPBR1",82,0)
 D:LRA GLENTRY(LR("%1"),"",1)
"RTN","LRAPBR1",83,0)
 D DASH
"RTN","LRAPBR1",84,0)
 D HEADER2
"RTN","LRAPBR1",85,0)
 D:LRA DASH
"RTN","LRAPBR1",86,0)
 I LRRC="" D
"RTN","LRAPBR1",87,0)
 .D GLENTRY("+*+* REPORT INCOMPLETE *+*+",20,1)
"RTN","LRAPBR1",88,0)
 .D GLENTRY("","",1)
"RTN","LRAPBR1",89,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",90,0)
 I LRRMD'="" D
"RTN","LRAPBR1",91,0)
 .S LRCNT=0 F LRA1="SP","CY","EM" D
"RTN","LRAPBR1",92,0)
 ..S LRCNT=LRCNT+1
"RTN","LRAPBR1",93,0)
 ..S LRTMP(LRA1)=$P($T(TEXT2+LRCNT),";",3)
"RTN","LRAPBR1",94,0)
 .S LRTMP=LRTMP(LRSS)
"RTN","LRAPBR1",95,0)
 .D GLENTRY(LRTMP_" "_LRRMD,31)
"RTN","LRAPBR1",96,0)
 Q
"RTN","LRAPBR1",97,0)
WPFLD ;
"RTN","LRAPBR1",98,0)
 ;Display Frozen Section, Gross Description, Microscopic Description
"RTN","LRAPBR1",99,0)
 ;and Surgical Path Diagnosis
"RTN","LRAPBR1",100,0)
 F LRCNT=1:1:4 D
"RTN","LRAPBR1",101,0)
 .S X=$T(FIELDS+LRCNT)
"RTN","LRAPBR1",102,0)
 .S LRV=$P(X,";",2),LRV1=$P(X,";",3),LRV2=$P(X,";",4)
"RTN","LRAPBR1",103,0)
 .I $P($G(^LR(LRDFN,LRSS,LRI,LRV,0)),U,4) D
"RTN","LRAPBR1",104,0)
 ..D GLENTRY("","",1),GLENTRY(LR(69.2,LRV1),"",1)
"RTN","LRAPBR1",105,0)
 ..S LRFILE=LRSF,LRIENS=LRI_","_LRDFN_",",LRFLD=LRV
"RTN","LRAPBR1",106,0)
 ..I $P($G(^LR(LRDFN,LRSS,LRI,LRV2,0)),U,4) D
"RTN","LRAPBR1",107,0)
 ...S LRFILE1=+$$GET1^DID(LRSF,LRV2,"","SPECIFIER")
"RTN","LRAPBR1",108,0)
 ...D GLENTRY("*+* MODIFIED REPORT *+*",28,1)
"RTN","LRAPBR1",109,0)
 ...D GLENTRY("(Last modified: ","",1)
"RTN","LRAPBR1",110,0)
 ...S (LRA1,LRB1)=0
"RTN","LRAPBR1",111,0)
 ...F  S LRA1=$O(^LR(LRDFN,LRSS,LRI,LRV2,LRA1)) Q:'LRA1  S LRB1=LRA1
"RTN","LRAPBR1",112,0)
 ...Q:'$D(^LR(LRDFN,LRSS,LRI,LRV2,LRB1,0))
"RTN","LRAPBR1",113,0)
 ...S LRSR1=$$GET1^DIQ(LRFILE1,LRB1_","_LRIENS,.01)
"RTN","LRAPBR1",114,0)
 ...S LRSR2=$$GET1^DIQ(LRFILE1,LRB1_","_LRIENS,.02)
"RTN","LRAPBR1",115,0)
 ...S LRTEXT=LRSR1_" typed by "_LRSR2_")"
"RTN","LRAPBR1",116,0)
 ...D GLENTRY(LRTEXT,BTAB)
"RTN","LRAPBR1",117,0)
 ..D WP
"RTN","LRAPBR1",118,0)
 Q
"RTN","LRAPBR1",119,0)
SUPRPT ;Supplementary Report
"RTN","LRAPBR1",120,0)
 I $P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),U,4) D
"RTN","LRAPBR1",121,0)
 .S LRFILE=+$$GET1^DID(LRSF,1.2,"","SPECIFIER")
"RTN","LRAPBR1",122,0)
 .S LRIENS1=LRI_","_LRDFN_","
"RTN","LRAPBR1",123,0)
 .D GLENTRY("","",1),GLENTRY("SUPPLEMENTARY REPORT(S):","",1)
"RTN","LRAPBR1",124,0)
 .S LRV=0 F  S LRV=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV)) Q:'LRV  D
"RTN","LRAPBR1",125,0)
 ..S LRIENS=LRV_","_LRIENS1
"RTN","LRAPBR1",126,0)
 ..S LRSR1=$$GET1^DIQ(LRFILE,LRIENS,.01)
"RTN","LRAPBR1",127,0)
 ..S LRSR2=+$$GET1^DIQ(LRFILE,LRIENS,.02)
"RTN","LRAPBR1",128,0)
 ..D GLENTRY("Supplementary Report Date: "_LRSR1,3,1)
"RTN","LRAPBR1",129,0)
 ..I $D(LR("R")),'LRSR2 D GLENTRY(" not verified",BTAB) Q
"RTN","LRAPBR1",130,0)
 ..I $P($G(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,0)),U,4) D
"RTN","LRAPBR1",131,0)
 ...S LRTEXT="*+* SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED *+*"
"RTN","LRAPBR1",132,0)
 ...D GLENTRY($$CJ^XLFSTR(LRTEXT,IOM),"",1)
"RTN","LRAPBR1",133,0)
 ...D GLENTRY("(Added/Last","",1)
"RTN","LRAPBR1",134,0)
 ...S (LRA1,LRB1)=0
"RTN","LRAPBR1",135,0)
 ...F  S LRA1=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,LRA1)) Q:'LRA1  D
"RTN","LRAPBR1",136,0)
 ....S LRB1=LRA1
"RTN","LRAPBR1",137,0)
 ...Q:'$D(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,LRB1,0))
"RTN","LRAPBR1",138,0)
 ...S LRA2=^(0),Y=+LRA2,LRA2A=$P(LRA2,"^",2),LRSGN=" Typed by ",LRDSC=" modified: "
"RTN","LRAPBR1",139,0)
 ...I $P(LRA2,"^",3) S LRSGN=" Signed by ",LRDSC=" released: ",LRA2A=$P(LRA2,"^",3),Y=$P(LRA2,"^",4)
"RTN","LRAPBR1",140,0)
 ...S LRA2A=$S($D(^VA(200,LRA2A,0)):$P(^(0),"^"),1:LRA2A)
"RTN","LRAPBR1",141,0)
 ...D D^LRU
"RTN","LRAPBR1",142,0)
 ...D GLENTRY(LRDSC_Y_LRSGN_LRA2A_")",BTAB)
"RTN","LRAPBR1",143,0)
 ..S LRFLD=1 D WP
"RTN","LRAPBR1",144,0)
 ..D GLENTRY("","",1)
"RTN","LRAPBR1",145,0)
 Q
"RTN","LRAPBR1",146,0)
SSJR ;Print special studies/journal references
"RTN","LRAPBR1",147,0)
 D ^LRAPBR3
"RTN","LRAPBR1",148,0)
 S LREFLG=1
"RTN","LRAPBR1",149,0)
 Q
"RTN","LRAPBR1",150,0)
WP ;Display word procesing fields
"RTN","LRAPBR1",151,0)
 K LRTMP,^UTILITY($J,"W")
"RTN","LRAPBR1",152,0)
 N X,DIWR,DIWL,LRINC
"RTN","LRAPBR1",153,0)
 S X=$$GET1^DIQ(LRFILE,LRIENS,LRFLD,"","LRTMP",)
"RTN","LRAPBR1",154,0)
 S DIWR=IOM-5,DIWL=5,DIWF=""
"RTN","LRAPBR1",155,0)
 S X=+$$GET1^DID(LRFILE,LRFLD,"","SPECIFIER")
"RTN","LRAPBR1",156,0)
 I $$GET1^DID(X,.01,"","SPECIFIER")["L" S DIWF="N"
"RTN","LRAPBR1",157,0)
 S LRINC=0
"RTN","LRAPBR1",158,0)
 F  S LRINC=$O(LRTMP(LRINC)) Q:'LRINC  S X=LRTMP(LRINC) D ^DIWP
"RTN","LRAPBR1",159,0)
 S LRINC=0
"RTN","LRAPBR1",160,0)
 F  S LRINC=$O(^UTILITY($J,"W",DIWL,LRINC)) Q:'LRINC  D
"RTN","LRAPBR1",161,0)
 .D GLENTRY(^UTILITY($J,"W",DIWL,LRINC,0),DIWL,1)
"RTN","LRAPBR1",162,0)
 K ^UTILITY($J,"W")
"RTN","LRAPBR1",163,0)
 Q
"RTN","LRAPBR1",164,0)
HEADER ;
"RTN","LRAPBR1",165,0)
 D:LRTIU GLENTRY("$APHDR",,1)
"RTN","LRAPBR1",166,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",167,0)
 D DASH
"RTN","LRAPBR1",168,0)
 D GLENTRY("MEDICAL RECORD |",5,1)
"RTN","LRAPBR1",169,0)
 D GLENTRY(LRAA1,40)
"RTN","LRAPBR1",170,0)
 D DASH
"RTN","LRAPBR1",171,0)
HEADER2 ;
"RTN","LRAPBR1",172,0)
 S LRADESC="Accession No. "_$S(LRQ(8)]"":LRQ(8)_LRW(1)_" "_LRAC,1:LRAC)
"RTN","LRAPBR1",173,0)
 S LRLENG1=$L(LRQ(1)),LRLENG2=$L(LRADESC),LRSPCE=IOM-LRLENG2-14
"RTN","LRAPBR1",174,0)
 S:LRLENG1>LRSPCE LRQ(1)=$E(LRQ(1),1,LRSPCE)
"RTN","LRAPBR1",175,0)
 D GLENTRY("PATHOLOGY REPORT",30,1)
"RTN","LRAPBR1",176,0)
 D GLENTRY("Laboratory: "_LRQ(1),"",1)
"RTN","LRAPBR1",177,0)
 D GLENTRY(LRADESC,IOM-LRLENG2-1)
"RTN","LRAPBR1",178,0)
 Q
"RTN","LRAPBR1",179,0)
FOOTER ;Footer-called from ^LRAPBR
"RTN","LRAPBR1",180,0)
 D:LRTIU GLENTRY("$FTR",,1)
"RTN","LRAPBR1",181,0)
 D DASH
"RTN","LRAPBR1",182,0)
 S LRTEXT=$S('$D(LR("W")):"",1:"See signed copy in chart")
"RTN","LRAPBR1",183,0)
 D GLENTRY(LRTEXT,"",1)
"RTN","LRAPBR1",184,0)
 S LRTEXT="("_$S($D(LREFLG):"End of report",1:"See next page")_")"
"RTN","LRAPBR1",185,0)
 D GLENTRY(LRTEXT,57)
"RTN","LRAPBR1",186,0)
 D GLENTRY(LRPMD,"",1),GLENTRY(LRW(9),52),GLENTRY("| Date "_LRRC,55)
"RTN","LRAPBR1",187,0)
 D DASH
"RTN","LRAPBR1",188,0)
 D GLENTRY(LRP,"",1)
"RTN","LRAPBR1",189,0)
 S LRTEXT=$S('$D(LR("W")):"STANDARD FORM 515",1:"WORK COPY ONLY !!")
"RTN","LRAPBR1",190,0)
 D GLENTRY(LRTEXT,50)
"RTN","LRAPBR1",191,0)
 D GLENTRY("ID:"_SSN,"",1)
"RTN","LRAPBR1",192,0)
 D GLENTRY("SEX:"_SEX,16),GLENTRY(" DOB:"_DOB,BTAB)
"RTN","LRAPBR1",193,0)
 I AGE D
"RTN","LRAPBR1",194,0)
 .S LRTEXT=$S($G(VADM(6))]"":" AGE AT DEATH: ",1:" AGE: ")_AGE
"RTN","LRAPBR1",195,0)
 .D GLENTRY(LRTEXT,BTAB)
"RTN","LRAPBR1",196,0)
 D GLENTRY(" LOC:"_LRLLOC,BTAB)
"RTN","LRAPBR1",197,0)
 D GLENTRY("","",1)
"RTN","LRAPBR1",198,0)
 D:$L(LRADM) GLENTRY("ADM:"_$P(LRADM,"@"),BTAB)
"RTN","LRAPBR1",199,0)
 D:$L(LRADX) GLENTRY("DX:"_$E(LRADX,1,26),17)
"RTN","LRAPBR1",200,0)
 D GLENTRY("PCP:",46)
"RTN","LRAPBR1",201,0)
 D:$L(LRPRAC) GLENTRY($E(LRPRAC(1),1,28),51)
"RTN","LRAPBR1",202,0)
 Q
"RTN","LRAPBR1",203,0)
ESIGLN ;Write signature block name, title, and date of signature
"RTN","LRAPBR1",204,0)
 D GLENTRY(,,1)
"RTN","LRAPBR1",205,0)
 I $D(^VA(200,DUZ,0)) D
"RTN","LRAPBR1",206,0)
 .S LRFILE=200,LRFLD=20.2,LRFLD2=20.3
"RTN","LRAPBR1",207,0)
 .S X=$$GET1^DIQ(LRFILE,DUZ,LRFLD)
"RTN","LRAPBR1",208,0)
 ;Compare DUZ to pathologist, if different, use proxy signature
"RTN","LRAPBR1",209,0)
 S:LRSS="AU" LRPATH=$$GET1^DIQ(63,LRDFN,13.6,"I")
"RTN","LRAPBR1",210,0)
 I LRSS'="AU" D
"RTN","LRAPBR1",211,0)
 .S LRFL2=$S(LRSS="EM":63.02,LRSS="CY":63.09,LRSS="SP":63.08,1:0)
"RTN","LRAPBR1",212,0)
 .S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPBR1",213,0)
 .S LRPATH=$$GET1^DIQ(LRFL2,LRIENS,.02,"I")
"RTN","LRAPBR1",214,0)
 S LRPATH2=""
"RTN","LRAPBR1",215,0)
 S:LRPATH'=DUZ LRPATH2=" FOR "_$$GET1^DIQ(LRFILE,LRPATH,LRFLD)
"RTN","LRAPBR1",216,0)
 S LRTEXT="/es/ "_X_LRPATH2
"RTN","LRAPBR1",217,0)
 ;S LRTEXT="/es/ "_X
"RTN","LRAPBR1",218,0)
 D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR1",219,0)
 S X=$$GET1^DIQ(LRFILE,DUZ,LRFLD2)
"RTN","LRAPBR1",220,0)
 S LRTEXT=X
"RTN","LRAPBR1",221,0)
 D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR1",222,0)
 S Y=LRNTIME D DD^%DT
"RTN","LRAPBR1",223,0)
 S LRTEXT="Signed "_Y
"RTN","LRAPBR1",224,0)
 D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR1",225,0)
 Q
"RTN","LRAPBR1",226,0)
DASH ;Display a line of dashes
"RTN","LRAPBR1",227,0)
 D GLENTRY(LR("%"),"",1)
"RTN","LRAPBR1",228,0)
 Q
"RTN","LRAPBR1",229,0)
GLENTRY(LRPR1,LRPR2,LRPR3) ;Write to global
"RTN","LRAPBR1",230,0)
 ;LRPR1 = Text to be written to global
"RTN","LRAPBR1",231,0)
 ;LRPR2 = Tab position
"RTN","LRAPBR1",232,0)
 ;LRPR3 = 1 means start a new line.  Othewise, write an current line.
"RTN","LRAPBR1",233,0)
 S LRPR1=$G(LRPR1)
"RTN","LRAPBR1",234,0)
 S LRPR2=+$G(LRPR2)
"RTN","LRAPBR1",235,0)
 S LRPR3=+$G(LRPR3)
"RTN","LRAPBR1",236,0)
 D:LRPR3 NEWLN^LRAPUTL(LRPR1,LRPR2)
"RTN","LRAPBR1",237,0)
 D:'LRPR3 GLBWRT^LRAPUTL(LRPR1,LRPR2)
"RTN","LRAPBR1",238,0)
 Q
"RTN","LRAPBR1",239,0)
TEXT1 ;Text for top of report
"RTN","LRAPBR1",240,0)
 ;BRIEF CLINICAL HISTORY:
"RTN","LRAPBR1",241,0)
 ;PREOPERATIVE DIAGNOSIS:
"RTN","LRAPBR1",242,0)
 ;OPERATIVE FINDINGS:
"RTN","LRAPBR1",243,0)
 ;POSTOPERATIVE DIAGNOSIS:
"RTN","LRAPBR1",244,0)
TEXT2 ;Descriptive text based on section
"RTN","LRAPBR1",245,0)
 ;SP;Pathology Resident:
"RTN","LRAPBR1",246,0)
 ;CY;Screened by:
"RTN","LRAPBR1",247,0)
 ;EM;Prepared by:
"RTN","LRAPBR1",248,0)
FIELDS ;Field numbers for word processing fields
"RTN","LRAPBR1",249,0)
 ;1.3;.13;6
"RTN","LRAPBR1",250,0)
 ;1;.03;7
"RTN","LRAPBR1",251,0)
 ;1.1;.04;4
"RTN","LRAPBR1",252,0)
 ;1.4;.14;5
"RTN","LRAPBR4")
0^18^B32957954^B30127062
"RTN","LRAPBR4",1,0)
LRAPBR4 ;DALOI/WTY/KLL - Autopsy Browser Display;7/27/01
"RTN","LRAPBR4",2,0)
 ;;5.2;LAB SERVICE;**259,317**;Sep 27, 1994
"RTN","LRAPBR4",3,0)
 ;
"RTN","LRAPBR4",4,0)
 ;Reference to ^DPT supported by IA #918
"RTN","LRAPBR4",5,0)
 ;
"RTN","LRAPBR4",6,0)
 Q
"RTN","LRAPBR4",7,0)
ENTER ;Entry point
"RTN","LRAPBR4",8,0)
 N LRTEXT,LRFILE,LRFIELD,LRTMP,LRFLG
"RTN","LRAPBR4",9,0)
 D INIT
"RTN","LRAPBR4",10,0)
 Q:'$D(^LR(LRDFN,LRSS))
"RTN","LRAPBR4",11,0)
 D HEADER
"RTN","LRAPBR4",12,0)
 D BODY
"RTN","LRAPBR4",13,0)
 D:'LRTIU POW
"RTN","LRAPBR4",14,0)
 D:LRTIU ESIGLN^LRAPBR1
"RTN","LRAPBR4",15,0)
 D FOOTER
"RTN","LRAPBR4",16,0)
 Q
"RTN","LRAPBR4",17,0)
INIT ;Initialize variables
"RTN","LRAPBR4",18,0)
 S X=^LR(LRDFN,0) D ^LRUP
"RTN","LRAPBR4",19,0)
 Q:'$D(^LR(LRDFN,LRSS))
"RTN","LRAPBR4",20,0)
 F LRTMP=1:1 D  Q:LRFIELD="Q"
"RTN","LRAPBR4",21,0)
 .S X=$T(VART1+LRTMP)
"RTN","LRAPBR4",22,0)
 .S LRFIELD=$P(X,";",2),VAR=$P(X,";",3),LRFLG=$P(X,";",4)
"RTN","LRAPBR4",23,0)
 .Q:LRFIELD="Q"
"RTN","LRAPBR4",24,0)
 .S @VAR=$$GET1^DIQ(63,LRDFN_",",LRFIELD,LRFLG)
"RTN","LRAPBR4",25,0)
 .I VAR["LRM",@VAR S X=@VAR D D^LRUA S @VAR=X
"RTN","LRAPBR4",26,0)
 S LRH(2)=$E(LRH(2),2,3)
"RTN","LRAPBR4",27,0)
 ;Get date of death (LRH)
"RTN","LRAPBR4",28,0)
 S DA=LRDFN D D^LRAUAW
"RTN","LRAPBR4",29,0)
 S Y=LR(63,12) D D^LRU S LRH=Y
"RTN","LRAPBR4",30,0)
 S LCT=0
"RTN","LRAPBR4",31,0)
 S:'LRTIU GROOT="^TMP(""LRAPBR"",$J,"
"RTN","LRAPBR4",32,0)
 S:LRTIU GROOT="^TMP(""TIUP"",$J,"
"RTN","LRAPBR4",33,0)
 K ^TMP("LRAPBR",$J)
"RTN","LRAPBR4",34,0)
 Q
"RTN","LRAPBR4",35,0)
BODY ;Report body
"RTN","LRAPBR4",36,0)
 D:LRTIU GLENTRY("$TEXT",,1)
"RTN","LRAPBR4",37,0)
 S LR("F")=1
"RTN","LRAPBR4",38,0)
 I LRH(1)="" D
"RTN","LRAPBR4",39,0)
 .D GLENTRY("+*+* REPORT INCOMPLETE *+*+",20,1)
"RTN","LRAPBR4",40,0)
 .D GLENTRY(,,1)
"RTN","LRAPBR4",41,0)
 D MODAUCK
"RTN","LRAPBR4",42,0)
 ;Display supplementary report header if one or more has been added
"RTN","LRAPBR4",43,0)
 I $P($G(^LR(LRDFN,84,0)),U,4) D
"RTN","LRAPBR4",44,0)
 .S LRTEXT="*+* SUPPLEMENTARY REPORT HAS BEEN ADDED *+*"
"RTN","LRAPBR4",45,0)
 .S LRTEXT=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPBR4",46,0)
 .D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR4",47,0)
 .S LRTEXT="*+* REFER TO BOTTOM OF REPORT *+*"
"RTN","LRAPBR4",48,0)
 .S LRTEXT=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPBR4",49,0)
 .D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR4",50,0)
 D GLENTRY(,,1)
"RTN","LRAPBR4",51,0)
 F LRV=81,82,84 D
"RTN","LRAPBR4",52,0)
 .D:LRV'=84 GLENTRY(,,1)
"RTN","LRAPBR4",53,0)
 .D:LRV=81 GLENTRY(LRAU(1),0)
"RTN","LRAPBR4",54,0)
 .D:LRV=82 GLENTRY(LRAU(2),0)
"RTN","LRAPBR4",55,0)
 .I LRV'=84 D
"RTN","LRAPBR4",56,0)
 ..D GLENTRY(,,1)
"RTN","LRAPBR4",57,0)
 ..S LRFILE=63,LRIENS=LRDFN_","
"RTN","LRAPBR4",58,0)
 ..S LRFIELD=$S(LRV=81:32.2,1:32.3)
"RTN","LRAPBR4",59,0)
 ..D WP
"RTN","LRAPBR4",60,0)
 .I LRV=84 D
"RTN","LRAPBR4",61,0)
 ..N LRIENS1,LRIENS
"RTN","LRAPBR4",62,0)
 ..S LRFILE=63.324
"RTN","LRAPBR4",63,0)
 ..S LRA=0 F  S LRA=$O(^LR(LRDFN,84,LRA)) Q:'LRA  D
"RTN","LRAPBR4",64,0)
 ...S LRIENS1=LRA_","_LRDFN_","
"RTN","LRAPBR4",65,0)
 ...D GLENTRY("SUPPLEMENTARY REPORT DATE: ",0,1)
"RTN","LRAPBR4",66,0)
 ...S LRB=$$GET1^DIQ(LRFILE,LRIENS1,.01)
"RTN","LRAPBR4",67,0)
 ...D GLENTRY(LRB,BTAB)
"RTN","LRAPBR4",68,0)
 ...D:$P($G(^LR(LRDFN,84,LRA,2,0)),U,4) SUPA
"RTN","LRAPBR4",69,0)
 ...S LRFIELD=1,LRIENS=LRIENS1 D WP
"RTN","LRAPBR4",70,0)
 ...D GLENTRY(,,1)
"RTN","LRAPBR4",71,0)
 .I LRV'=84 D DASH,GLENTRY(,,1)
"RTN","LRAPBR4",72,0)
 D ^LRAPBR5
"RTN","LRAPBR4",73,0)
 Q
"RTN","LRAPBR4",74,0)
WP ;Display word procesing fields
"RTN","LRAPBR4",75,0)
 K LRTMP,^UTILITY($J,"W")
"RTN","LRAPBR4",76,0)
 N LRX,DIWR,DIWL,LRA1
"RTN","LRAPBR4",77,0)
 S LRX=$$GET1^DIQ(LRFILE,LRIENS,LRFIELD,"","LRTMP","LRERR(1)")
"RTN","LRAPBR4",78,0)
 S DIWR=IOM-5,DIWL=5,DIWF=""
"RTN","LRAPBR4",79,0)
 S LRX=+$$GET1^DID(LRFILE,LRFIELD,"","SPECIFIER","LRERR(2)")
"RTN","LRAPBR4",80,0)
 I $$GET1^DID(LRX,.01,"","SPECIFIER","LRERR(2)")["L" S DIWF="N"
"RTN","LRAPBR4",81,0)
 S LRA1=0 F  S LRA1=$O(LRTMP(LRA1)) Q:'LRA1  S X=LRTMP(LRA1) D ^DIWP
"RTN","LRAPBR4",82,0)
 S LRA1=0 F  S LRA1=$O(^UTILITY($J,"W",DIWL,LRA1)) Q:'LRA1  D
"RTN","LRAPBR4",83,0)
 .D GLENTRY(^UTILITY($J,"W",DIWL,LRA1,0),DIWL,1)
"RTN","LRAPBR4",84,0)
 K ^UTILITY($J,"W")
"RTN","LRAPBR4",85,0)
 Q
"RTN","LRAPBR4",86,0)
SUPA ;Print supplementary report audit information
"RTN","LRAPBR4",87,0)
 N LRFILE,LRIENS1,LRWP
"RTN","LRAPBR4",88,0)
 S LRTEXT="*+* SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED *+*"
"RTN","LRAPBR4",89,0)
 S LRTEXT=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPBR4",90,0)
 D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR4",91,0)
 S LRTEXT="(Added/Last" D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",92,0)
 S (A,B)=0 F  S A=$O(^LR(LRDFN,84,LRA,2,A)) Q:'A  D
"RTN","LRAPBR4",93,0)
 .S B=A
"RTN","LRAPBR4",94,0)
 Q:'$D(^LR(LRDFN,84,LRA,2,B,0))
"RTN","LRAPBR4",95,0)
 S A=^(0),Y=+A,LRSGN=" typed by ",LRDSC=" modified: ",A2=$P(A,"^",2)
"RTN","LRAPBR4",96,0)
 ;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRAPBR4",97,0)
 I $P(A,"^",3) S LRSGN=" signed by ",LRDSC=" released: ",A2=$P(A,"^",3),Y=$P(A,"^",4)
"RTN","LRAPBR4",98,0)
 S A2=$S($D(^VA(200,A2,0)):$P(^(0),"^"),1:A2)
"RTN","LRAPBR4",99,0)
 ;S LRFILE=63.3242,LRIENS1=B_","_LRA_","_LRDFN_","
"RTN","LRAPBR4",100,0)
 ;D GETS^DIQ(LRFILE,LRIENS1,"*","","LRWP")
"RTN","LRAPBR4",101,0)
 ;S Y=LRWP(LRFILE,LRIENS1,.01)
"RTN","LRAPBR4",102,0)
 ;S A=LRWP(LRFILE,LRIENS1,.02)
"RTN","LRAPBR4",103,0)
 D D^LRU
"RTN","LRAPBR4",104,0)
 S LRTEXT=LRDSC_Y_LRSGN_A2_")" D GLENTRY(LRTEXT,BTAB)
"RTN","LRAPBR4",105,0)
 Q
"RTN","LRAPBR4",106,0)
HEADER ;
"RTN","LRAPBR4",107,0)
 S LRQ=LRQ+1
"RTN","LRAPBR4",108,0)
 D:LRTIU GLENTRY("$APHDR",,1)
"RTN","LRAPBR4",109,0)
 F I=1:1:2 D GLENTRY(,,1)
"RTN","LRAPBR4",110,0)
 D DASH
"RTN","LRAPBR4",111,0)
 S LRTEXT="CLINICAL RECORD |" D GLENTRY(LRTEXT,5,1)
"RTN","LRAPBR4",112,0)
 S LRTEXT="AUTOPSY PROTOCOL" D GLENTRY(LRTEXT,40)
"RTN","LRAPBR4",113,0)
 D DASH
"RTN","LRAPBR4",114,0)
 S LRTEXT="Date died: "_LRH D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",115,0)
 S LRTEXT="| Autopsy date: "_LRH(1) D GLENTRY(LRTEXT,40)
"RTN","LRAPBR4",116,0)
 S LRTEXT="Resident: "_LRM(2) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",117,0)
 S LRTEXT="| "_$E(LRS(3),1,13) D GLENTRY(LRTEXT,40)
"RTN","LRAPBR4",118,0)
 S LRTEXT="Autopsy No. "_$S(LRQ(8)'="":LRQ(8)_LRH(2)_" "_LRAC,1:LRAC)
"RTN","LRAPBR4",119,0)
 D GLENTRY(LRTEXT,56)
"RTN","LRAPBR4",120,0)
 D DASH
"RTN","LRAPBR4",121,0)
 Q
"RTN","LRAPBR4",122,0)
MODAUCK ;Display modified banner if required
"RTN","LRAPBR4",123,0)
 S LRAPMR=$$GET1^DIQ(63,LRDFN,102,"I")
"RTN","LRAPBR4",124,0)
 Q:'LRAPMR
"RTN","LRAPBR4",125,0)
 S LRAPMD=$$GET1^DIQ(63,LRDFN,102.2,"I")
"RTN","LRAPBR4",126,0)
 D GLENTRY("","",1)
"RTN","LRAPBR4",127,0)
 S LRTEXT=""
"RTN","LRAPBR4",128,0)
 F LRCNT=1:1:$S(LRAPMD:29,1:31) D
"RTN","LRAPBR4",129,0)
 .S LRTEXT=LRTEXT_"*"
"RTN","LRAPBR4",130,0)
 S LRTEXT=LRTEXT_" MODIFIED "
"RTN","LRAPBR4",131,0)
 S LRTEXT=LRTEXT_$S(LRAPMD:"DIAGNOSIS ",1:"REPORT ")
"RTN","LRAPBR4",132,0)
 F LRCNT=1:1:$S(LRAPMD:29,1:31) D
"RTN","LRAPBR4",133,0)
 .S LRTEXT=LRTEXT_"*"
"RTN","LRAPBR4",134,0)
 D GLENTRY(LRTEXT,"",1)
"RTN","LRAPBR4",135,0)
 D GLENTRY("","",1)
"RTN","LRAPBR4",136,0)
 Q
"RTN","LRAPBR4",137,0)
POW ;Determine POW or Persian Gulf status
"RTN","LRAPBR4",138,0)
 I $P($G(^LR(LRDFN,0)),"^",2)=2 D
"RTN","LRAPBR4",139,0)
 .S LRPOW=0
"RTN","LRAPBR4",140,0)
 .I $D(^DPT(DFN,.52)) S:$P(^(.52),U,5)="Y" LRPOW=1
"RTN","LRAPBR4",141,0)
 .I $D(^DPT(DFN,.322)) S:$P($G(^(.322)),"^",10)="Y" LRPOW=1
"RTN","LRAPBR4",142,0)
 .D ^LRAPBRPW
"RTN","LRAPBR4",143,0)
 .K LRPOW
"RTN","LRAPBR4",144,0)
 Q
"RTN","LRAPBR4",145,0)
FOOTER ;Report footer
"RTN","LRAPBR4",146,0)
 D:LRTIU GLENTRY("$FTR",,1)
"RTN","LRAPBR4",147,0)
 D DASH
"RTN","LRAPBR4",148,0)
 D GLENTRY(,,1)
"RTN","LRAPBR4",149,0)
 I LRH(3)=""&(LRH(17)'="") D
"RTN","LRAPBR4",150,0)
 .S LRTEXT="| Provisional Anatomic Dx"
"RTN","LRAPBR4",151,0)
 .D GLENTRY(LRTEXT,55)
"RTN","LRAPBR4",152,0)
 S LRTEXT="Pathologist: "_LRM(3) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",153,0)
 D GLENTRY(LRW(9),52)
"RTN","LRAPBR4",154,0)
 S LRTEXT="| Date " D GLENTRY(LRTEXT,55)
"RTN","LRAPBR4",155,0)
 S LRTEXT=$E($S(LRH(3)'="":LRH(3),1:LRH(17)),1,12) D GLENTRY(LRTEXT,BTAB)
"RTN","LRAPBR4",156,0)
 D DASH
"RTN","LRAPBR4",157,0)
 S LRTEXT=LRQ(1) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",158,0)
 S LRTEXT="AUTOPSY PROTOCOL" D GLENTRY(LRTEXT,IOM-17)
"RTN","LRAPBR4",159,0)
 S LRTEXT="Patient: "_$E(LRP,1,30) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",160,0)
 D GLENTRY(SSN,43),GLENTRY("SEX:"_SEX,56),GLENTRY("DOB:"_DOB,63)
"RTN","LRAPBR4",161,0)
 D GLENTRY($E(LRLLOC,1,22),0,1)
"RTN","LRAPBR4",162,0)
 S LRTEXT="Physician: "_$E(LRM(1),1,28) D GLENTRY(LRTEXT,23)
"RTN","LRAPBR4",163,0)
 S LRTEXT="AGE AT DEATH:"_$J(AGE,3) D GLENTRY(LRTEXT,63)
"RTN","LRAPBR4",164,0)
 Q
"RTN","LRAPBR4",165,0)
DASH ;
"RTN","LRAPBR4",166,0)
 D GLENTRY(LR("%"),0,1)
"RTN","LRAPBR4",167,0)
 Q
"RTN","LRAPBR4",168,0)
GLENTRY(LRPR1,LRPR2,LRPR3) ;Write to global
"RTN","LRAPBR4",169,0)
 ;LRPR1 = Text to be written to global
"RTN","LRAPBR4",170,0)
 ;LRPR2 = Tab position
"RTN","LRAPBR4",171,0)
 ;LRPR3 = 1 means start a new line.  Othewise, write on current line.
"RTN","LRAPBR4",172,0)
 S LRPR1=$G(LRPR1),LRPR2=+$G(LRPR2),LRPR3=+$G(LRPR3)
"RTN","LRAPBR4",173,0)
 D:LRPR3 NEWLN^LRAPUTL(LRPR1,LRPR2)
"RTN","LRAPBR4",174,0)
 D:'LRPR3 GLBWRT^LRAPUTL(LRPR1,LRPR2)
"RTN","LRAPBR4",175,0)
 Q
"RTN","LRAPBR4",176,0)
VART1 ;Setup variables
"RTN","LRAPBR4",177,0)
 ;14;LRAC;I;AUTOPSY ACCESSION #
"RTN","LRAPBR4",178,0)
 ;13.5;LRM(2);I;RESIDENT PATHOLOGIST
"RTN","LRAPBR4",179,0)
 ;12.1;LRM(1);I;PHYSICIAN
"RTN","LRAPBR4",180,0)
 ;13.01;LRW(9);I;AUTOPSY TYPIST
"RTN","LRAPBR4",181,0)
 ;13.6;LRM(3);I;SENIOR PATHOLOGIST
"RTN","LRAPBR4",182,0)
 ;11;LRH(1);;AUTOPSY DATE/TIME
"RTN","LRAPBR4",183,0)
 ;11;LRH(2);I;AUTOPSY DATE/TIME 2 DIGIT YEAR
"RTN","LRAPBR4",184,0)
 ;13;LRH(3);;DATE AUTOPSY REPORT COMPLETED
"RTN","LRAPBR4",185,0)
 ;14.9;LRH(17);;PROVISIONAL ANAT DX DATE
"RTN","LRAPBR4",186,0)
 ;14.1;LRLLOC;I;LOCATION
"RTN","LRAPBR4",187,0)
 ;12.5;AGE;I;AGE AT DEATH
"RTN","LRAPBR4",188,0)
 ;14.5;LRSVC;;SERVICE
"RTN","LRAPBR4",189,0)
 ;13.7;LRS(3);;AUTOPSY TYPE
"RTN","LRAPBR4",190,0)
 ;Q
"RTN","LRAPD1")
0^7^B22198195^B24077474
"RTN","LRAPD1",1,0)
LRAPD1 ;AVAMC/REG/WTY/KLL - AP DATA ENTRY ;9/25/00
"RTN","LRAPD1",2,0)
 ;;5.2;LAB SERVICE;**41,91,248,259,317**;Sep 27, 1994
"RTN","LRAPD1",3,0)
 ;
"RTN","LRAPD1",4,0)
 ;WTY;17-AUG-01;Unwrapped text and add kills for DR string
"RTN","LRAPD1",5,0)
 ;
"RTN","LRAPD1",6,0)
SP ;Gross Desc/Clinical Hx, Surg Path
"RTN","LRAPD1",7,0)
 S LRSOP="G"
"RTN","LRAPD1",8,0)
 K DR S DR=".09///^S X=LRWHO;.012;.013;.014;.015;.016;"
"RTN","LRAPD1",9,0)
 S DR=DR_".021//^S X=LR(""TR"");1;S:'LR(""FS"") Y=0;1.3"
"RTN","LRAPD1",10,0)
 S LR(6)=1,DR(2,63.812)=.01
"RTN","LRAPD1",11,0)
 Q
"RTN","LRAPD1",12,0)
MSP ;Micro Description/Gross Review, Surg Path
"RTN","LRAPD1",13,0)
 S LRSOP="M"
"RTN","LRAPD1",14,0)
 K DR S DR=".09///^S X=LRWHO;S:'LR(""FS"") Y=1;1.3;1;1.1;"
"RTN","LRAPD1",15,0)
 S DR=DR_"S:'LR(""DX"") Y=.02;1.4;.02;.03;S:'LRV Y=0;.14"
"RTN","LRAPD1",16,0)
 S (LR(7),LR(6))=1
"RTN","LRAPD1",17,0)
 Q
"RTN","LRAPD1",18,0)
BSP ;Micro Description/Snomed Coding
"RTN","LRAPD1",19,0)
 S LRSOP="B",(LR(2),LR(7),LR(6))=1
"RTN","LRAPD1",20,0)
 K DR S DR=".09///^S X=LRWHO;S:'LR(""FS"") Y=1;1.3;1;1.1;"
"RTN","LRAPD1",21,0)
 S DR=DR_"S:'LR(""DX"") Y=.02;1.4;.02;.03;S:'LRV Y=10;.14;10"
"RTN","LRAPD1",22,0)
 S DR(2,63.12)=".01;D T^LRAPD;S:'LR(8) Y=4;2;4;I '$D(LR(1)) S Y=0;"
"RTN","LRAPD1",23,0)
 S DR(2,63.12)=DR(2,63.12)_"1;1.5;3"
"RTN","LRAPD1",24,0)
 S DR(3,63.16)=".01;I '$D(LR(1)) S Y=0;1"
"RTN","LRAPD1",25,0)
 S DR(3,63.82)=".01;D R^LRAPD;.02"
"RTN","LRAPD1",26,0)
 Q
"RTN","LRAPD1",27,0)
ASP ;Micro Description/ICD9CM Coding
"RTN","LRAPD1",28,0)
 S LRSOP="A",(LR(7),LR(6))=1
"RTN","LRAPD1",29,0)
 K DR S DR=".09///^S X=LRWHO;S:'LR(""FS"") Y=1;1.3;1;1.1;"
"RTN","LRAPD1",30,0)
 S DR=DR_"S:'LR(""DX"") Y=.02;1.4;.02;.03;S:'LRV Y=80;.14;80"
"RTN","LRAPD1",31,0)
 Q
"RTN","LRAPD1",32,0)
SSP ;Supplementary Report, Surg Path
"RTN","LRAPD1",33,0)
 S (LRSOP,LRSFLG)="S",(LR(2),LR(7),LR(6))=1
"RTN","LRAPD1",34,0)
 K DR
"RTN","LRAPD1",35,0)
 ;Entry of Supp rept must be allowed on released reports
"RTN","LRAPD1",36,0)
 ;S DR="N LRREL D RELEASE^LRAPUTL(.LRREL,LRDFN,LRSS,LRI) "
"RTN","LRAPD1",37,0)
 ;S DR=DR_"I LRREL(1) D VMSG^LRAPD1 S LRSFLG="""",Y=0;"
"RTN","LRAPD1",38,0)
 ;S DR=DR_".09///^S X=LRWHO;.03;10"
"RTN","LRAPD1",39,0)
 S DR=".09///^S X=LRWHO;.03;10"
"RTN","LRAPD1",40,0)
 S DR(2,63.12)=".01;D T^LRAPD;S:'LR(8) Y=4;2;4;I '$D(LR(1)) "
"RTN","LRAPD1",41,0)
 S DR(2,63.12)=DR(2,63.12)_"S Y=0;1;1.5;3"
"RTN","LRAPD1",42,0)
 S DR(3,63.16)=".01;I '$D(LR(1)) S Y=0;1"
"RTN","LRAPD1",43,0)
 S DR(3,63.82)=".01;D R^LRAPD;.02"
"RTN","LRAPD1",44,0)
 Q
"RTN","LRAPD1",45,0)
PSP ;Special Studies, Surg Path
"RTN","LRAPD1",46,0)
 S LRSOP="P"
"RTN","LRAPD1",47,0)
 K DR
"RTN","LRAPD1",48,0)
 S DR="N LRREL D RELEASE^LRAPUTL(.LRREL,LRDFN,LRSS,LRI) "
"RTN","LRAPD1",49,0)
 S DR=DR_"I LRREL(1) D VMSG^LRAPD1 S Y=0;.03;10"
"RTN","LRAPD1",50,0)
 S DR(2,63.12)="5;1.5"
"RTN","LRAPD1",51,0)
 S DR(3,63.82)=".01;D R^LRAPD;.02",LR(7)=1
"RTN","LRAPD1",52,0)
 Q
"RTN","LRAPD1",53,0)
CY ;Gross Desc/Clinic Hx, Cytopath
"RTN","LRAPD1",54,0)
 S LRSOP="G"
"RTN","LRAPD1",55,0)
 K DR S DR=".09///^S X=LRWHO;.012;.013;.014;.015;.016;"
"RTN","LRAPD1",56,0)
 S DR=DR_".021//^S X=LR(""TR"");1"
"RTN","LRAPD1",57,0)
 S LR(6)=1,DR(2,63.902)=".01;.02"
"RTN","LRAPD1",58,0)
 Q
"RTN","LRAPD1",59,0)
MCY ;Micro Desc/Gross Review, Cytopath
"RTN","LRAPD1",60,0)
 S LRSOP="M"
"RTN","LRAPD1",61,0)
 K DR S DR=".09///^S X=LRWHO;1;1.1;S:'LR(""DX"") Y=.021;1.4;"
"RTN","LRAPD1",62,0)
 S DR=DR_".021//^S X=LR(""TR"");.02;.03;.101;S:'LRV Y=0;.14"
"RTN","LRAPD1",63,0)
 S (LR(7),LR(6))=1
"RTN","LRAPD1",64,0)
 Q
"RTN","LRAPD1",65,0)
BCY ;Micro Desc/SNOMED Coding, Cytopath
"RTN","LRAPD1",66,0)
 S LRSOP="B",DIC(0)="M"
"RTN","LRAPD1",67,0)
 S (LR(2),LR(7),LR(6))=1
"RTN","LRAPD1",68,0)
 K DR S DR=".09///^S X=LRWHO;1;1.1;S:'LR(""DX"") Y=.021;1.4;"
"RTN","LRAPD1",69,0)
 S DR=DR_".021//^S X=LR(""TR"");.02;.03;.101;S:'LRV Y=10;.14;10"
"RTN","LRAPD1",70,0)
 S DR(2,63.912)=".01;D T^LRAPD;S:'LR(8) Y=4;2;4;"
"RTN","LRAPD1",71,0)
 S DR(2,63.912)=DR(2,63.912)_"I '$D(LR(1)) S Y=0;1;1.5;3"
"RTN","LRAPD1",72,0)
 S DR(3,63.916)=".01;I '$D(LR(1)) S Y=0;1"
"RTN","LRAPD1",73,0)
 S DR(3,63.982)=".01;D R^LRAPD;.02"
"RTN","LRAPD1",74,0)
 Q
"RTN","LRAPD1",75,0)
ACY ;Micro Desc/ICD9CM Coding
"RTN","LRAPD1",76,0)
 S LRSOP="A"
"RTN","LRAPD1",77,0)
 S (LR(7),LR(6))=1
"RTN","LRAPD1",78,0)
 K DR S DR=".09///^S X=LRWHO;1;1.1;S:'LR(""DX"") Y=.021;1.4;"
"RTN","LRAPD1",79,0)
 S DR=DR_".021//^S X=LR(""TR"");.02;.03;.101;S:'LRV Y=80;.14;80"
"RTN","LRAPD1",80,0)
 Q
"RTN","LRAPD1",81,0)
SCY ;Supplementary Report, Cyto
"RTN","LRAPD1",82,0)
 S LRSFLG="S"
"RTN","LRAPD1",83,0)
 S (LR(2),LR(7),LR(6))=1
"RTN","LRAPD1",84,0)
 K DR
"RTN","LRAPD1",85,0)
 ;Entry of Supp rept must be allowed on released reports
"RTN","LRAPD1",86,0)
 ;S DR="N LRREL D RELEASE^LRAPUTL(.LRREL,LRDFN,LRSS,LRI) "
"RTN","LRAPD1",87,0)
 ;S DR=DR_"I LRREL(1) D VMSG^LRAPD1 S LRSFLG="""",Y=0;"
"RTN","LRAPD1",88,0)
 ;S DR=DR_".09///^S X=LRWHO;.03;10"
"RTN","LRAPD1",89,0)
 S DR=".09///^S X=LRWHO;.03;10"
"RTN","LRAPD1",90,0)
 S DR(2,63.912)=".01;D T^LRAPD;S:'LR(8) Y=4;2;4;I '$D(LR(1)) "
"RTN","LRAPD1",91,0)
 S DR(2,63.912)=DR(2,63.912)_"S Y=0;1;1.5;3"
"RTN","LRAPD1",92,0)
 S DR(3,63.916)=".01;I '$D(LR(1)) S Y=0;1"
"RTN","LRAPD1",93,0)
 S DR(3,63.982)=".01;D R^LRAPD;.02"
"RTN","LRAPD1",94,0)
 Q
"RTN","LRAPD1",95,0)
PCY ;Special Studies, Cyto
"RTN","LRAPD1",96,0)
 K DR
"RTN","LRAPD1",97,0)
 S DR="N LRREL D RELEASE^LRAPUTL(.LRREL,LRDFN,LRSS,LRI) "
"RTN","LRAPD1",98,0)
 S DR=DR_"I LRREL(1) D VMSG^LRAPD1 S Y=0;.03;10"
"RTN","LRAPD1",99,0)
 S DR(2,63.912)="5;1.5"
"RTN","LRAPD1",100,0)
 S DR(3,63.982)=".01;D R^LRAPD;.02"
"RTN","LRAPD1",101,0)
 S LR(7)=1
"RTN","LRAPD1",102,0)
 Q
"RTN","LRAPD1",103,0)
EM ;Gross Desc/Clinical Hx, Em
"RTN","LRAPD1",104,0)
 S LRSOP="G",LR(6)=1
"RTN","LRAPD1",105,0)
 K DR S DR=".09///^S X=LRWHO;.012;.013;.014;.015;.016;"
"RTN","LRAPD1",106,0)
 S DR=DR_".021//^S X=LR(""TR"");1"
"RTN","LRAPD1",107,0)
 S DR(2,63.202)=.01
"RTN","LRAPD1",108,0)
 Q
"RTN","LRAPD1",109,0)
MEM ;Micro Desc/Gross Review, EM
"RTN","LRAPD1",110,0)
 S LRSOP="M"
"RTN","LRAPD1",111,0)
 K DR S DR=".09///^S X=LRWHO;1;1.1;S:'LR(""DX"") Y=.021;1.4;"
"RTN","LRAPD1",112,0)
 S DR=DR_".021//^S X=LR(""TR"");.02;.03;S:'LRV Y=0;.14"
"RTN","LRAPD1",113,0)
 S (LR(7),LR(6))=1
"RTN","LRAPD1",114,0)
 Q
"RTN","LRAPD1",115,0)
BEM ;Micro Desc/SNOMED Coding
"RTN","LRAPD1",116,0)
 S LRSOP="B",(LR(2),LR(7),LR(6))=1
"RTN","LRAPD1",117,0)
 K DR S DR=".09///^S X=LRWHO;1;1.1;S:'LR(""DX"") Y=.021;1.4;"
"RTN","LRAPD1",118,0)
 S DR=DR_".021//^S X=LR(""TR"");.02;.03;S:'LRV Y=10;.14;10"
"RTN","LRAPD1",119,0)
 S DR(2,63.212)=".01;D T^LRAPD;S:'LR(8) Y=4;2;4;"
"RTN","LRAPD1",120,0)
 S DR(2,63.212)=DR(2,63.212)_"I '$D(LR(1)) S Y=0;1;1.5;3"
"RTN","LRAPD1",121,0)
 S DR(3,63.216)=".01;I '$D(LR(1)) S Y=0;1"
"RTN","LRAPD1",122,0)
 S DR(3,63.282)=".01;D R^LRAPD;.02"
"RTN","LRAPD1",123,0)
 Q
"RTN","LRAPD1",124,0)
AEM ;Micro Desc/ICD9CM Coding
"RTN","LRAPD1",125,0)
 S LRSOP="A"
"RTN","LRAPD1",126,0)
 S (LR(7),LR(6))=1
"RTN","LRAPD1",127,0)
 K DR S DR=".09///^S X=LRWHO;1;1.1;S:'LR(""DX"") Y=.021;1.4;"
"RTN","LRAPD1",128,0)
 S DR=DR_".021//^S X=LR(""TR"");.02;.03;S:'LRV Y=80;.14;80"
"RTN","LRAPD1",129,0)
 Q
"RTN","LRAPD1",130,0)
SEM ;Supplementary Report, EM
"RTN","LRAPD1",131,0)
 S LRSFLG="S"
"RTN","LRAPD1",132,0)
 S (LR(2),LR(7),LR(6))=1
"RTN","LRAPD1",133,0)
 K DR
"RTN","LRAPD1",134,0)
 ;Entry of Supp rept must be allowed on released reports
"RTN","LRAPD1",135,0)
 ;S DR="N LRREL D RELEASE^LRAPUTL(.LRREL,LRDFN,LRSS,LRI) "
"RTN","LRAPD1",136,0)
 ;S DR=DR_"I LRREL(1) D VMSG^LRAPD1 S LRSFLG="""",Y=0;"
"RTN","LRAPD1",137,0)
 ;S DR=DR_".09///^S X=LRWHO;.03;10"
"RTN","LRAPD1",138,0)
 S DR=".09///^S X=LRWHO;.03;10"
"RTN","LRAPD1",139,0)
 S DR(2,63.212)=".01;D T^LRAPD;S:'LR(8) Y=4;2;4;I '$D(LR(1)) "
"RTN","LRAPD1",140,0)
 S DR(2,63.212)=DR(2,63.212)_"S Y=0;1;1.5;3"
"RTN","LRAPD1",141,0)
 S DR(3,63.216)=".01;I '$D(LR(1)) S Y=0;1"
"RTN","LRAPD1",142,0)
 S DR(3,63.282)=".01;D R^LRAPD;.02"
"RTN","LRAPD1",143,0)
 Q
"RTN","LRAPD1",144,0)
PEM ;Special Studies, EM
"RTN","LRAPD1",145,0)
 K DR
"RTN","LRAPD1",146,0)
 S DR="N LRREL D RELEASE^LRAPUTL(.LRREL,LRDFN,LRSS,LRI) "
"RTN","LRAPD1",147,0)
 S DR=DR_"I LRREL(1) D VMSG^LRAPD1 S Y=0;.03;10"
"RTN","LRAPD1",148,0)
 S DR(2,63.212)=5,LR(7)=1
"RTN","LRAPD1",149,0)
 Q
"RTN","LRAPD1",150,0)
VMSG ;Verified message
"RTN","LRAPD1",151,0)
 N LRMSG
"RTN","LRAPD1",152,0)
 S LRMSG=$C(7)_"Report verified.  Cannot edit with this option."
"RTN","LRAPD1",153,0)
 D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPD1",154,0)
 Q
"RTN","LRAPDA")
0^3^B76606340^B64317056
"RTN","LRAPDA",1,0)
LRAPDA ;AVAMC/REG/WTY/KLL - ANATOMIC PATH DATA ENTRY;11/02/01
"RTN","LRAPDA",2,0)
 ;;5.2;LAB SERVICE;**72,73,91,121,248,259,295,317**;Sep 27, 1994
"RTN","LRAPDA",3,0)
 ;
"RTN","LRAPDA",4,0)
 ;Reference to ^%DT supported by IA #10003
"RTN","LRAPDA",5,0)
 ;Reference to ^DIE supported by IA #10018
"RTN","LRAPDA",6,0)
 ;Reference to ^VA(200 supported by IA #10060
"RTN","LRAPDA",7,0)
 ;Reference to EN^DDIOL supported by IA #10142
"RTN","LRAPDA",8,0)
 ;
"RTN","LRAPDA",9,0)
 W !?20,LRO(68)," (",LRABV,")",!
"RTN","LRAPDA",10,0)
 S:'$D(LRSOP) LRSOP=1 S:'$D(LRD(1)) LRD(1)="0"
"RTN","LRAPDA",11,0)
 S:'$D(^LRO(69.2,LRAA,2,0)) ^(0)="^69.23A^0^0"
"RTN","LRAPDA",12,0)
SEL K LR(1)
"RTN","LRAPDA",13,0)
 I $D(LR(2)) D  G:%<1 END S:%=1 LR(1)=1
"RTN","LRAPDA",14,0)
 .W !!,"Enter Etiology, Function, Procedure & Disease "
"RTN","LRAPDA",15,0)
 .S %=2 D YN^LRU
"RTN","LRAPDA",16,0)
AK ;from LRAPD1
"RTN","LRAPDA",17,0)
 N CORRECT
"RTN","LRAPDA",18,0)
 S:'$D(LRSFLG) LRSFLG=""
"RTN","LRAPDA",19,0)
 W !!,"Data entry for ",LRH(0)," "
"RTN","LRAPDA",20,0)
 S %=1 D YN^LRU G:%<1 END
"RTN","LRAPDA",21,0)
 I %=2 D  G:Y<1 END S LRAD=$E(Y,1,3)_"0000",LRH(0)=$E(Y,1,3)+1700
"RTN","LRAPDA",22,0)
 .S %DT="AE",%DT(0)="-N",%DT("A")="Enter YEAR: " D ^%DT K %DT
"RTN","LRAPDA",23,0)
 I '$O(^LRO(68,LRAA,1,LRAD,1,0)) D  Q
"RTN","LRAPDA",24,0)
 .W $C(7),!!,"NO ",LRO(68)," ACCESSIONS IN FILE FOR ",LRH(0),!!
"RTN","LRAPDA",25,0)
W K X,Y,LR("CK")
"RTN","LRAPDA",26,0)
 R !!,"Select Accession Number/Pt name: ",LRAN:DTIME
"RTN","LRAPDA",27,0)
 G:LRAN=""!(LRAN[U) END
"RTN","LRAPDA",28,0)
 I LRAN["?" D  G W
"RTN","LRAPDA",29,0)
 .W !!,"Enter the year ",LRH(0)," ",LRO(68)," accession number to be "
"RTN","LRAPDA",30,0)
 .W "updated"
"RTN","LRAPDA",31,0)
 .W !,"or locate the accession by entering the patient name."
"RTN","LRAPDA",32,0)
 I LRAN'?1N.N D PNAME G:LRAN<1 W D OE1^LR7OB63D,REST,OERR^LR7OB63D G W
"RTN","LRAPDA",33,0)
 D OE1^LR7OB63D,REST S:$D(DR(1))#2 DR=DR(1) D OERR^LR7OB63D G W
"RTN","LRAPDA",34,0)
REST ;
"RTN","LRAPDA",35,0)
 N LRXSTOP,LRX,LRX1
"RTN","LRAPDA",36,0)
 W "  for ",LRH(0)
"RTN","LRAPDA",37,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0)) D  Q
"RTN","LRAPDA",38,0)
 .W $C(7),!!,"Accession # ",LRAN," for ",LRH(0)," not in ",LRO(68),!!
"RTN","LRAPDA",39,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,0),LRLLOC=$P(X,"^",7),LRDFN=+X
"RTN","LRAPDA",40,0)
 Q:'$D(^LR(LRDFN,0))  S X=^(0) D ^LRUP
"RTN","LRAPDA",41,0)
 W !,LRP,"  ID: ",SSN
"RTN","LRAPDA",42,0)
 S LRI=+$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),"^",5)
"RTN","LRAPDA",43,0)
 I LRSS'="AU",'$D(^LR(LRDFN,LRSS,LRI,0)) D  Q
"RTN","LRAPDA",44,0)
 .W $C(7),!,"Inverse date missing or incorrect in Accession Area file "
"RTN","LRAPDA",45,0)
 .W "for",!,LRO(68),"  Year: ",$E(LRAD,2,3),"  Accession: ",LRAN
"RTN","LRAPDA",46,0)
 I "SPCYEM"[LRSS,$O(^LR(LRDFN,LRSS,LRI,.1,0)) D
"RTN","LRAPDA",47,0)
 .W !,"Specimen(s):"
"RTN","LRAPDA",48,0)
 .S X=0 F  S X=$O(^LR(LRDFN,LRSS,LRI,.1,X)) Q:'X  D
"RTN","LRAPDA",49,0)
 ..W !,$P($G(^LR(LRDFN,LRSS,LRI,.1,X,0)),"^")
"RTN","LRAPDA",50,0)
 ;
"RTN","LRAPDA",51,0)
 ;Don't allow supp. report to be added to a released report if 
"RTN","LRAPDA",52,0)
 ; modifications are being added via MM option
"RTN","LRAPDA",53,0)
 S LRXSTOP=0,(LRX,LRX1)=""
"RTN","LRAPDA",54,0)
 I LRSS'="AU",LRD(1)="S" D
"RTN","LRAPDA",55,0)
 .S LRX=$P($G(^LR(LRDFN,LRSS,LRI,0)),"^",11) ;release date/time
"RTN","LRAPDA",56,0)
 .S LRX1=$P($G(^LR(LRDFN,LRSS,LRI,0)),"^",15) ;orig rel date/time
"RTN","LRAPDA",57,0)
 I LRSS="AU",LRSOP="R" D
"RTN","LRAPDA",58,0)
 .S LRX=$P($G(^LR(LRDFN,"AU")),"^",15)  ;release date/time
"RTN","LRAPDA",59,0)
 .S LRX1=$P($G(^LR(LRDFN,"AU")),"^",3)  ;date report completed
"RTN","LRAPDA",60,0)
 I 'LRX,LRX1 D
"RTN","LRAPDA",61,0)
 .W $C(7),!!,"This "_$G(LRAA(1))_" report is currently being"
"RTN","LRAPDA",62,0)
 .W !,"modified; it must first be released before Supplementary"
"RTN","LRAPDA",63,0)
 .W !,"report can be added.",!
"RTN","LRAPDA",64,0)
 .S LRXSTOP=1
"RTN","LRAPDA",65,0)
 Q:LRXSTOP 
"RTN","LRAPDA",66,0)
 ;
"RTN","LRAPDA",67,0)
DIE ;Edit
"RTN","LRAPDA",68,0)
 I LRSS="AU" D AUE Q
"RTN","LRAPDA",69,0)
 N LRRDT1,LRRDT2,LRIENS,LREL,LRQUIT,LRSNO,LRCPT,LRESCPT
"RTN","LRAPDA",70,0)
 S (LREL,LRESCPT,LRQUIT,LRSNO,LRCPT)=0,LRIENS=LRI_","_LRDFN_","
"RTN","LRAPDA",71,0)
 S LRRDT1=$$GET1^DIQ(LRSF,LRIENS,.11,"I")
"RTN","LRAPDA",72,0)
 S LRRDT2=$$GET1^DIQ(LRSF,LRIENS,.15,"I")
"RTN","LRAPDA",73,0)
 S:LRRDT1!LRRDT2 LREL=1
"RTN","LRAPDA",74,0)
 I $T(ES^LRCAPES)'="" S LRESCPT=$$ES^LRCAPES()
"RTN","LRAPDA",75,0)
 I LRSOP="G",LREL D  Q
"RTN","LRAPDA",76,0)
 .W $C(7),!!,"Report verified.  Cannot edit with this option."
"RTN","LRAPDA",77,0)
 I LRSOP'="","ABM"[LRSOP,LREL D  Q:LRQUIT
"RTN","LRAPDA",78,0)
 .;Allow SNOMED and CPT coding even after release.
"RTN","LRAPDA",79,0)
 .W $C(7),!!,"Report has been verified.  "
"RTN","LRAPDA",80,0)
 .I 'LRESCPT,LRSOP'="B" D  Q
"RTN","LRAPDA",81,0)
 ..W "Cannot edit with this option."
"RTN","LRAPDA",82,0)
 ..S LRQUIT=1
"RTN","LRAPDA",83,0)
 .W "Only "
"RTN","LRAPDA",84,0)
 .I LRESCPT W "CPT " W:LRSOP="B" "and "
"RTN","LRAPDA",85,0)
 .W:LRSOP="B" "SNOMED "
"RTN","LRAPDA",86,0)
 .W "coding permitted.",!
"RTN","LRAPDA",87,0)
 .I LRSOP="B" D
"RTN","LRAPDA",88,0)
 ..K DIR S DIR(0)="Y",DIR("A")="Enter SNOMED coding",DIR("B")="NO"
"RTN","LRAPDA",89,0)
 ..D ^DIR W !
"RTN","LRAPDA",90,0)
 ..S LRSNO=+Y
"RTN","LRAPDA",91,0)
 .Q:'LRESCPT
"RTN","LRAPDA",92,0)
 .K DIR S DIR(0)="Y",DIR("A")="Enter CPT coding",DIR("B")="NO"
"RTN","LRAPDA",93,0)
 .D ^DIR W !
"RTN","LRAPDA",94,0)
 .S LRCPT=+Y
"RTN","LRAPDA",95,0)
 .I "AM"[LRSOP,'LRCPT S LRQUIT=1 Q
"RTN","LRAPDA",96,0)
 .I LRSOP="B",'LRCPT,'LRSNO S LRQUIT=1
"RTN","LRAPDA",97,0)
RESET ;Reset DR string if altered by prior accession/patient
"RTN","LRAPDA",98,0)
 ;Reset DR to orig value in LRAPD1
"RTN","LRAPDA",99,0)
 I LRSOP'="","AMBS"[LRSOP,$G(LRD)'="" D @LRD
"RTN","LRAPDA",100,0)
 I LRSFLG="S",$G(LRD)'="" D @LRD  ;For CY,EM Supp entry
"RTN","LRAPDA",101,0)
 S:LRSNO DR=10    ;Modify DR string if only SNOMED coding permitted
"RTN","LRAPDA",102,0)
 I 'LRSNO,LRCPT S DR=""  ;Set DR string to null in only CPT coding
"RTN","LRAPDA",103,0)
 ;If adding supp rpt to released rpt, remove date rpt completed from DR
"RTN","LRAPDA",104,0)
 I LRRDT1,LRSOP="S"!(LRSFLG="S") S DR=".09///^S X=LRWHO;10"
"RTN","LRAPDA",105,0)
EDIT ;Call to ^DIE
"RTN","LRAPDA",106,0)
 W ! S LRA=^LR(LRDFN,LRSS,LRI,0),LRRC=$P(LRA,"^",10)
"RTN","LRAPDA",107,0)
 I LRCAPA,"SPCYEM"[LRSS D C^LRAPSWK
"RTN","LRAPDA",108,0)
 S DIE="^LR(LRDFN,LRSS,",DA=LRI,DA(1)=LRDFN
"RTN","LRAPDA",109,0)
 D CK^LRU Q:$D(LR("CK"))
"RTN","LRAPDA",110,0)
 I LRSS="SP",LRSOP="B",$O(^LR(LRDFN,LRSS,LRI,1.3,0)) D
"RTN","LRAPDA",111,0)
 .W $C(7),!!,"This accession has a FROZEN SECTION report."
"RTN","LRAPDA",112,0)
 .W !,"Be sure 'FROZEN SECTION' is entered as a SNOMED code in the "
"RTN","LRAPDA",113,0)
 .W "PROCEDURE field"
"RTN","LRAPDA",114,0)
 .W !,"for the appropriate organ or tissue.",!!
"RTN","LRAPDA",115,0)
 D ^DIE
"RTN","LRAPDA",116,0)
 D UPDATE^LRPXRM(LRDFN,LRSS,LRI)
"RTN","LRAPDA",117,0)
 D:LRSFLG="S"&('$D(Y)) ^LRAPDSR
"RTN","LRAPDA",118,0)
 D FRE^LRU
"RTN","LRAPDA",119,0)
 I LRSOP'="","ABM"[LRSOP D CPTCOD
"RTN","LRAPDA",120,0)
WKLD ;Capture Workload
"RTN","LRAPDA",121,0)
 I LRSOP="Z","CYSP"[LRSS,LRCAPA D S^LRAPR Q
"RTN","LRAPDA",122,0)
 I LRCAPA,"SPCYEM"[LRSS,LRD(1)'="","MBA"[LRD(1) D C1^LRAPSWK
"RTN","LRAPDA",123,0)
 I LRCAPA,"SPCYEM"[LRSS,LRSOP="G" D C1^LRAPSWK
"RTN","LRAPDA",124,0)
QUEUES ;Update Queues
"RTN","LRAPDA",125,0)
 S X=$P(^LR(LRDFN,LRSS,LRI,0),"^",4)
"RTN","LRAPDA",126,0)
 I X,$D(^VA(200,X,0)) S LR("TR")=$P(^(0),"^")
"RTN","LRAPDA",127,0)
 I "CYEMSP"[LRSS,$D(LR(6)),LRSOP="G" Q:$D(^LRO(69.2,LRAA,1,LRAN,0))  D  Q
"RTN","LRAPDA",128,0)
 .L +^LRO(69.2,LRAA,1):5 I '$T D  Q
"RTN","LRAPDA",129,0)
 ..S MSG(1)="The preliminary reports queue is in use by another person."
"RTN","LRAPDA",130,0)
 ..S MSG(1,"F")="!!"
"RTN","LRAPDA",131,0)
 ..S MSG(2)="  You will need to add this accession to the queue later."
"RTN","LRAPDA",132,0)
 ..D EN^DDIOL(.MSG) K MSG
"RTN","LRAPDA",133,0)
 .S ^LRO(69.2,LRAA,1,LRAN,0)=LRDFN_"^"_LRI_"^"_LRH(0)
"RTN","LRAPDA",134,0)
 .S X=^LRO(69.2,LRAA,1,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRAPDA",135,0)
 .L -^LRO(69.2,LRAA,1)
"RTN","LRAPDA",136,0)
 I "CYEMSP"[LRSS,$D(LR(7)),'$D(^LRO(69.2,LRAA,2,LRAN,0)),LRD(1)'="S" D
"RTN","LRAPDA",137,0)
 .L +^LRO(69.2,LRAA,2):5 I '$T D  Q
"RTN","LRAPDA",138,0)
 ..S MSG(1)="The final reports queue is in use by another person.  "
"RTN","LRAPDA",139,0)
 ..S MSG(1,"F")="!!"
"RTN","LRAPDA",140,0)
 ..S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRAPDA",141,0)
 ..D EN^DDIOL(.MSG) K MSG
"RTN","LRAPDA",142,0)
 .S ^LRO(69.2,LRAA,2,LRAN,0)=LRDFN_"^"_LRI_"^"_LRH(0)
"RTN","LRAPDA",143,0)
 .S X=^LRO(69.2,LRAA,2,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRAPDA",144,0)
 .L -^LRO(69.2,LRAA,2)
"RTN","LRAPDA",145,0)
 D:LRSOP="M"!(LRSOP="B") EN^LRSPGD
"RTN","LRAPDA",146,0)
 Q
"RTN","LRAPDA",147,0)
NM ;
"RTN","LRAPDA",148,0)
 I X'["@"!(X["@"&(Y(Z)="")) D  Q
"RTN","LRAPDA",149,0)
 .W $C(7),!?4,"ENTER WHOLE NUMBERS ONLY",! K X
"RTN","LRAPDA",150,0)
 I Y(Z)'="" W $C(7),?40,"OK TO DELETE" S %=2 D YN^LRU I %'=1 K X Q
"RTN","LRAPDA",151,0)
 S Y(Z)="" Q
"RTN","LRAPDA",152,0)
 ;
"RTN","LRAPDA",153,0)
AUE ;Autopsy Data Entry
"RTN","LRAPDA",154,0)
 W !
"RTN","LRAPDA",155,0)
 N LREL,LRQUIT,LRSNO,LRESCPT,LRCPT
"RTN","LRAPDA",156,0)
 S (LREL,LRQUIT,LRSNO,LRCPT)=0
"RTN","LRAPDA",157,0)
 S LREL=+$$GET1^DIQ(63,LRDFN_",",14.7,"I")
"RTN","LRAPDA",158,0)
 I $T(ES^LRCAPES)'="" S LRESCPT=$$ES^LRCAPES()
"RTN","LRAPDA",159,0)
 ;  Allow supp report to be added on verified AU
"RTN","LRAPDA",160,0)
 I LRSOP'="","AFIP"[LRSOP,LREL D  Q:LRQUIT
"RTN","LRAPDA",161,0)
 .Q:LRESCPT&("AP"[LRSOP)
"RTN","LRAPDA",162,0)
 .W $C(7),!!,"Report verified.  Cannot edit with this option!"
"RTN","LRAPDA",163,0)
 .S LRQUIT=1
"RTN","LRAPDA",164,0)
 I LRSOP'="","ABP"[LRSOP,LREL D  Q:LRQUIT
"RTN","LRAPDA",165,0)
 .W $C(7),!!,"Report has been verified.  "
"RTN","LRAPDA",166,0)
 .W "Only "
"RTN","LRAPDA",167,0)
 .I LRESCPT W "CPT " W:LRSOP="B" "and "
"RTN","LRAPDA",168,0)
 .W:LRSOP="B" "SNOMED "
"RTN","LRAPDA",169,0)
 .W "coding permitted.",!
"RTN","LRAPDA",170,0)
 .I LRSOP="B" D
"RTN","LRAPDA",171,0)
 ..K DIR S DIR(0)="Y",DIR("A")="Enter SNOMED coding",DIR("B")="NO"
"RTN","LRAPDA",172,0)
 ..D ^DIR W !
"RTN","LRAPDA",173,0)
 ..S LRSNO=+Y
"RTN","LRAPDA",174,0)
 .Q:'LRESCPT
"RTN","LRAPDA",175,0)
 .K DIR S DIR(0)="Y",DIR("A")="Enter CPT coding",DIR("B")="NO"
"RTN","LRAPDA",176,0)
 .D ^DIR W !
"RTN","LRAPDA",177,0)
 .S LRCPT=+Y
"RTN","LRAPDA",178,0)
 .I "AP"[LRSOP,'LRCPT S LRQUIT=1 Q
"RTN","LRAPDA",179,0)
 .I LRSOP="B",'LRCPT,'LRSNO S LRQUIT=1
"RTN","LRAPDA",180,0)
AURESET ;Reset DR to orig value in LRAUDA
"RTN","LRAPDA",181,0)
 I LRSOP'="","AP"[LRSOP D @(LRSOP_"DR^LRAUDA")
"RTN","LRAPDA",182,0)
 I LRSOP="B" D BDR^LRAUDA
"RTN","LRAPDA",183,0)
 S:LRSNO DR=32       ;Modify DR string if only SNOMED coding permitted
"RTN","LRAPDA",184,0)
 I 'LRSNO,LRCPT S DR=""  ;Set DR string to null inf only CPT coding
"RTN","LRAPDA",185,0)
 ;                              ;
"RTN","LRAPDA",186,0)
 ;Not all of the autopsy fields are within the AU subscript.
"RTN","LRAPDA",187,0)
 ;Therefore, we must lock the entire LRDFN.
"RTN","LRAPDA",188,0)
 L +^LR(LRDFN):5 I '$T D  Q
"RTN","LRAPDA",189,0)
 .S MSG="This record is locked by another user.  "
"RTN","LRAPDA",190,0)
 .S MSG=MSG_"Please wait and try again."
"RTN","LRAPDA",191,0)
 .D EN^DDIOL(MSG,"","!!") K MSG
"RTN","LRAPDA",192,0)
 I LRSFLG'="S" D
"RTN","LRAPDA",193,0)
 .S DIE="^LR(",DA=LRDFN
"RTN","LRAPDA",194,0)
 .D ^DIE
"RTN","LRAPDA",195,0)
 D:LRSFLG="S" ^LRAPDSR
"RTN","LRAPDA",196,0)
 D UPDATE^LRPXRM(LRDFN,"AU")
"RTN","LRAPDA",197,0)
 L -^LR(LRDFN)
"RTN","LRAPDA",198,0)
 D:"BAP"[LRSOP AU
"RTN","LRAPDA",199,0)
 D:LRSOP="R" R
"RTN","LRAPDA",200,0)
 I LRSOP'="","ABP"[LRSOP D CPTCOD
"RTN","LRAPDA",201,0)
 Q
"RTN","LRAPDA",202,0)
AU I '$D(^LRO(69.2,LRAA,2,LRAN,0)) D
"RTN","LRAPDA",203,0)
 .L +^LRO(69.2,LRAA,2):5 I '$T D  Q
"RTN","LRAPDA",204,0)
 ..S MSG(1)="The final reports queue is in use by another person.  "
"RTN","LRAPDA",205,0)
 ..S MSG(1,"F")="!!"
"RTN","LRAPDA",206,0)
 ..S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRAPDA",207,0)
 ..D EN^DDIOL(.MSG) K MSG
"RTN","LRAPDA",208,0)
 .S ^LRO(69.2,LRAA,2,LRAN,0)=LRDFN
"RTN","LRAPDA",209,0)
 .S X=^LRO(69.2,LRAA,2,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRAPDA",210,0)
 .L -^LRO(69.2,LRAA,2)
"RTN","LRAPDA",211,0)
 D AU^LRSPGD
"RTN","LRAPDA",212,0)
 Q
"RTN","LRAPDA",213,0)
R I '$D(^LRO(69.2,LRAA,3,LRAN,0)) D
"RTN","LRAPDA",214,0)
 .L +^LRO(69.2,LRAA,3):5 I '$T D  Q
"RTN","LRAPDA",215,0)
 ..S MSG(1)="The interim reports queue is in use by another person.  "
"RTN","LRAPDA",216,0)
 ..S MSG(1,"F")="!!"
"RTN","LRAPDA",217,0)
 ..S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRAPDA",218,0)
 ..D EN^DDIOL(.MSG) K MSG
"RTN","LRAPDA",219,0)
 .S ^LRO(69.2,LRAA,3,LRAN,0)=LRDFN
"RTN","LRAPDA",220,0)
 .S X=^LRO(69.2,LRAA,3,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRAPDA",221,0)
 .L -^LRO(69.2,LRAA,3)
"RTN","LRAPDA",222,0)
 Q
"RTN","LRAPDA",223,0)
PNAME ;Patient Name Lookup
"RTN","LRAPDA",224,0)
 N LRPFLG            ;LRPFLG tells LRUPS to limit accessions to 
"RTN","LRAPDA",225,0)
 S X=LRAN,LRPFLG=1   ;the chosen year.
"RTN","LRAPDA",226,0)
 K LRAN,DIC,VADM,VAIN,VA
"RTN","LRAPDA",227,0)
 S DFN=-1,DIC(0)="EQM",(LRX,LRDPF)=""
"RTN","LRAPDA",228,0)
 D:'$D(LRLABKY) LABKEY^LRPARAM
"RTN","LRAPDA",229,0)
 D DPA1^LRDPA
"RTN","LRAPDA",230,0)
 I DFN=-1 S LRAN=-1 Q
"RTN","LRAPDA",231,0)
 D I^LRUPS
"RTN","LRAPDA",232,0)
 Q
"RTN","LRAPDA",233,0)
CPTCOD ;CPT Coding
"RTN","LRAPDA",234,0)
 N LRPRO
"RTN","LRAPDA",235,0)
 Q:$T(CPT^LRCAPES)=""
"RTN","LRAPDA",236,0)
 Q:LREL&('LRCPT)
"RTN","LRAPDA",237,0)
 I 'LREL D
"RTN","LRAPDA",238,0)
 .K DIR S DIR(0)="Y",DIR("A")="Enter CPT coding",DIR("B")="NO"
"RTN","LRAPDA",239,0)
 .D ^DIR W !
"RTN","LRAPDA",240,0)
 .S LRCPT=+Y
"RTN","LRAPDA",241,0)
 Q:'LRCPT
"RTN","LRAPDA",242,0)
 ;SET PROVIDER TO CURRENT USER, ALLOW UPDATES
"RTN","LRAPDA",243,0)
 S LRPRO=DUZ
"RTN","LRAPDA",244,0)
 D PROVIDR^LRAPUTL
"RTN","LRAPDA",245,0)
 Q:LRQUIT
"RTN","LRAPDA",246,0)
 D CPT^LRCAPES(LRAA,LRAD,LRAN,LRPRO)
"RTN","LRAPDA",247,0)
 Q
"RTN","LRAPDA",248,0)
END K LRSFLG
"RTN","LRAPDA",249,0)
 D:$T(CLEAN^LRCAPES)'="" CLEAN^LRCAPES
"RTN","LRAPDA",250,0)
 D V^LRU
"RTN","LRAPDA",251,0)
 Q
"RTN","LRAPDSR")
0^6^B25438900^B17788838
"RTN","LRAPDSR",1,0)
LRAPDSR ;DALOI/WTY/KLL - AP SUPPLEMENTARY REPORT ENTRY;12/05/00
"RTN","LRAPDSR",2,0)
 ;;5.2;LAB SERVICE;**248,259,295,317**;Sep 27, 1994
"RTN","LRAPDSR",3,0)
 ;
"RTN","LRAPDSR",4,0)
 N LRYTMP,LRWPROOT,LRRLS,LRRLS1,LRRLS2,LRX,LRIENS,LRFILE1,LRFILE,LRA
"RTN","LRAPDSR",5,0)
 N LRIENS1,LRXTMP,LRFDA,LRNOW,LRIENS2,LRFIELD,LRORIEN,LRFLG,LRDA,LRQUIT
"RTN","LRAPDSR",6,0)
 ;
"RTN","LRAPDSR",7,0)
MAIN ;Main Subroutine
"RTN","LRAPDSR",8,0)
 D RELEAS1
"RTN","LRAPDSR",9,0)
 D GETRPT
"RTN","LRAPDSR",10,0)
 Q:LRQUIT
"RTN","LRAPDSR",11,0)
 D RELEAS2
"RTN","LRAPDSR",12,0)
 D:LRRLS COPY
"RTN","LRAPDSR",13,0)
 Q:LRQUIT
"RTN","LRAPDSR",14,0)
 D RPT
"RTN","LRAPDSR",15,0)
 ;Add supp report to the PRELIMINARY print queue
"RTN","LRAPDSR",16,0)
 D QUESP
"RTN","LRAPDSR",17,0)
 Q:LRQUIT
"RTN","LRAPDSR",18,0)
 D COMPARE
"RTN","LRAPDSR",19,0)
 Q:LRQUIT
"RTN","LRAPDSR",20,0)
 ;If supp report is already released (LRRLS1), unrelease it,
"RTN","LRAPDSR",21,0)
 ;   but only if the E-Sign Switch is ON (LRESSW)
"RTN","LRAPDSR",22,0)
 N LRESSW
"RTN","LRAPDSR",23,0)
 D GETDATA^LRAPESON(.LRESSW)
"RTN","LRAPDSR",24,0)
 I LRRLS1,LRESSW D UNRELEAS
"RTN","LRAPDSR",25,0)
 D UPDATE
"RTN","LRAPDSR",26,0)
 Q:LRQUIT
"RTN","LRAPDSR",27,0)
 D STORE
"RTN","LRAPDSR",28,0)
 Q
"RTN","LRAPDSR",29,0)
RELEAS1 ;Is the ENTIRE report already released?
"RTN","LRAPDSR",30,0)
 S (LRRLS,LRRLS1,LRQUIT)=0
"RTN","LRAPDSR",31,0)
 I LRSS="AU" D  Q
"RTN","LRAPDSR",32,0)
 .S LRX=$P($G(^LR(LRDFN,LRSS)),"^",15)
"RTN","LRAPDSR",33,0)
 .Q:'LRX         ;Report has not been released so no audit will occur.
"RTN","LRAPDSR",34,0)
 .W $C(7),!!,"This AUTOPSY has been released.  Supplementary report "
"RTN","LRAPDSR",35,0)
 .W "additions/modifications"
"RTN","LRAPDSR",36,0)
 .W !,"will create an audit trail.",!
"RTN","LRAPDSR",37,0)
 .S LRRLS=1    ;Report has been released so auditing will occur.
"RTN","LRAPDSR",38,0)
 S LRX=$P($G(^LR(LRDFN,LRSS,LRI,0)),"^",11)
"RTN","LRAPDSR",39,0)
 ;
"RTN","LRAPDSR",40,0)
 I LRX D
"RTN","LRAPDSR",41,0)
 .W $C(7),!!,"This "_$G(LRAA(1))_" report has been released."
"RTN","LRAPDSR",42,0)
 .W !,"Supplementary report additions/modifications will create"
"RTN","LRAPDSR",43,0)
 .W " an audit trail.",!
"RTN","LRAPDSR",44,0)
 .S LRRLS=1
"RTN","LRAPDSR",45,0)
 Q
"RTN","LRAPDSR",46,0)
GETRPT ;First, select the report 
"RTN","LRAPDSR",47,0)
 S DIC(0)="QAEZL",DLAYGO=63
"RTN","LRAPDSR",48,0)
 S DIC("A")="Select SUPPLEMENTARY REPORT DATE: "
"RTN","LRAPDSR",49,0)
 S DIC=$S(LRSS="AU":"^LR(LRDFN,84,",1:"^LR(LRDFN,LRSS,LRI,1.2,")
"RTN","LRAPDSR",50,0)
 S DIC("P")=$S(LRSS="AU":"63,32.4,0",1:"LRSF,1.2,0")
"RTN","LRAPDSR",51,0)
 S DIC("P")=$P(@("^DD("_DIC("P")_")"),"^",2)
"RTN","LRAPDSR",52,0)
 S DIC("B")="" S LRX=0 F  S LRX=$O(@(DIC_"LRX)")) Q:'LRX  D
"RTN","LRAPDSR",53,0)
 .S DIC("B")=+(@(DIC_"LRX,0)"))
"RTN","LRAPDSR",54,0)
 D ^DIC K DLAYGO
"RTN","LRAPDSR",55,0)
 S:Y=-1 LRQUIT=1
"RTN","LRAPDSR",56,0)
 Q
"RTN","LRAPDSR",57,0)
RELEAS2 ;Is the supplementary report already released?
"RTN","LRAPDSR",58,0)
 S LRRLS2=0
"RTN","LRAPDSR",59,0)
 S:LRSS'="AU" LRX=$G(^LR(LRDFN,LRSS,LRI,1.2,+Y,0))
"RTN","LRAPDSR",60,0)
 S:LRSS="AU" LRX=$G(^LR(LRDFN,84,+Y,0))
"RTN","LRAPDSR",61,0)
 S LRRLS2=+$P(LRX,"^",2)
"RTN","LRAPDSR",62,0)
 I LRRLS2 D
"RTN","LRAPDSR",63,0)
 .W $C(7),!!,"This supplementary report has been released.  Additions/"
"RTN","LRAPDSR",64,0)
 .W "modifications",!,"will create an audit trail.",!
"RTN","LRAPDSR",65,0)
 .S LRRLS1=1
"RTN","LRAPDSR",66,0)
 Q
"RTN","LRAPDSR",67,0)
COPY ;Make a copy of the current report.
"RTN","LRAPDSR",68,0)
 K ^TMP("DIQ1",$J)
"RTN","LRAPDSR",69,0)
 S LRIENS=+Y_","_$S(LRSS'="AU":LRI_",",1:"")_LRDFN_","
"RTN","LRAPDSR",70,0)
 S LRFILE1=$S(LRSS="SP":63.817,LRSS="CY":63.907,LRSS="EM":63.207,1:"")
"RTN","LRAPDSR",71,0)
 S:LRFILE1="" LRFILE1=$S(LRSS="AU":63.324,1:"")
"RTN","LRAPDSR",72,0)
 I LRFILE1="" S LRQUIT=1 Q
"RTN","LRAPDSR",73,0)
 D GETS^DIQ(LRFILE1,LRIENS,"**","Z","^TMP(""DIQ1"",$J)")
"RTN","LRAPDSR",74,0)
 Q
"RTN","LRAPDSR",75,0)
RPT ;
"RTN","LRAPDSR",76,0)
 N DIE,DA,DR
"RTN","LRAPDSR",77,0)
 S DIE=DIC K DIC
"RTN","LRAPDSR",78,0)
 S (LRDA,DA)=+Y
"RTN","LRAPDSR",79,0)
 S:LRSS="AU" DA(1)=LRDFN
"RTN","LRAPDSR",80,0)
 S:LRSS'="AU" DA(1)=LRI,DA(2)=LRDFN
"RTN","LRAPDSR",81,0)
 S DR=".01;1" D ^DIE
"RTN","LRAPDSR",82,0)
 I 'LRRLS S LRQUIT=1
"RTN","LRAPDSR",83,0)
 Q
"RTN","LRAPDSR",84,0)
QUESP ;Update the preliminary report print queue
"RTN","LRAPDSR",85,0)
 N LRIENS
"RTN","LRAPDSR",86,0)
 I '$D(^LRO(69.2,LRAA,1,LRAN,0)) D
"RTN","LRAPDSR",87,0)
 .K LRFDA
"RTN","LRAPDSR",88,0)
 .L +^LRO(69.2,LRAA,1):5 I '$T D  Q
"RTN","LRAPDSR",89,0)
 ..S MSG(1)="The preliminary reports queue is in use.  "
"RTN","LRAPDSR",90,0)
 ..S MSG(1,"F")="!!"
"RTN","LRAPDSR",91,0)
 ..S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRAPDSR",92,0)
 ..D EN^DDIOL(.MSG) K MSG
"RTN","LRAPDSR",93,0)
 .S LRIENS="+1,"_LRAA_","
"RTN","LRAPDSR",94,0)
 .S LRFDA(69.21,LRIENS,.01)=LRDFN
"RTN","LRAPDSR",95,0)
 .S LRFDA(69.21,LRIENS,1)=LRI
"RTN","LRAPDSR",96,0)
 .S LRFDA(69.21,LRIENS,2)=LRH(0)
"RTN","LRAPDSR",97,0)
 .S LRORIEN(1)=LRAN
"RTN","LRAPDSR",98,0)
 .D UPDATE^DIE("","LRFDA","LRORIEN")
"RTN","LRAPDSR",99,0)
 .L -^LRO(69.2,LRAA,1)
"RTN","LRAPDSR",100,0)
 Q
"RTN","LRAPDSR",101,0)
COMPARE ;Compare reports
"RTN","LRAPDSR",102,0)
 I '$D(^TMP("DIQ1",$J)) S LRQUIT=1 Q
"RTN","LRAPDSR",103,0)
 S:LRSS'="AU" LRFILE="^LR(LRDFN,LRSS,LRI,1.2,LRDA,1,"
"RTN","LRAPDSR",104,0)
 S:LRSS="AU" LRFILE="^LR(LRDFN,84,LRDA,1,"
"RTN","LRAPDSR",105,0)
 I '$D(@(LRFILE_"0)")) D  Q
"RTN","LRAPDSR",106,0)
 .D:LRRLS1 UNRELEAS
"RTN","LRAPDSR",107,0)
 .S LRQUIT=1
"RTN","LRAPDSR",108,0)
 S LRA=0,LRFLG=1
"RTN","LRAPDSR",109,0)
 F  S LRA=$O(@(LRFILE_"LRA)")) Q:'LRA  D
"RTN","LRAPDSR",110,0)
 .S LRXTMP=@(LRFILE_"LRA,0)")
"RTN","LRAPDSR",111,0)
 .S:'$D(^TMP("DIQ1",$J,LRFILE1,LRIENS,1,LRA,0)) LRFLG=0
"RTN","LRAPDSR",112,0)
 .Q:'LRFLG
"RTN","LRAPDSR",113,0)
 .S LRYTMP=^TMP("DIQ1",$J,LRFILE1,LRIENS,1,LRA,0)
"RTN","LRAPDSR",114,0)
 .I LRXTMP'=LRYTMP S LRFLG=0
"RTN","LRAPDSR",115,0)
 I LRFLG D
"RTN","LRAPDSR",116,0)
 .S LRA=0 F  S LRA=$O(^TMP("DIQ1",$J,LRFILE1,LRIENS,1,LRA)) Q:'LRA  D
"RTN","LRAPDSR",117,0)
 ..I '$D(@(LRFILE_"LRA,0)")) S LRFLG=0
"RTN","LRAPDSR",118,0)
 I LRFLG D
"RTN","LRAPDSR",119,0)
 .W $C(7),!!,"No changes were made to the supplementary report."
"RTN","LRAPDSR",120,0)
 .K ^TMP("DIQ1",$J)
"RTN","LRAPDSR",121,0)
 .S LRQUIT=1
"RTN","LRAPDSR",122,0)
 Q
"RTN","LRAPDSR",123,0)
UNRELEAS ;Unrelease the supplementary report.
"RTN","LRAPDSR",124,0)
 K LRFDA
"RTN","LRAPDSR",125,0)
 S LRFDA(1,LRFILE1,LRIENS,.02)="@"
"RTN","LRAPDSR",126,0)
 D UPDATE^DIE("","LRFDA(1)")
"RTN","LRAPDSR",127,0)
 Q
"RTN","LRAPDSR",128,0)
UPDATE ;File changes
"RTN","LRAPDSR",129,0)
 ;First, store the date of the change and user ID
"RTN","LRAPDSR",130,0)
 D UPDATE^LRPXRM(LRDFN,LRSS,+$G(LRI))
"RTN","LRAPDSR",131,0)
 K LRFDA
"RTN","LRAPDSR",132,0)
 S X="NOW",%DT="T" D ^%DT S LRNOW=Y
"RTN","LRAPDSR",133,0)
 S LRIENS1="+1,"_LRIENS
"RTN","LRAPDSR",134,0)
 S LRFILE=$S(LRSS="SP":63.8172,LRSS="CY":63.9072,LRSS="EM":63.2072,1:"")
"RTN","LRAPDSR",135,0)
 S:LRFILE="" LRFILE=$S(LRSS="AU":63.3242,1:"")
"RTN","LRAPDSR",136,0)
 I LRFILE="" S LRQUIT=1 Q
"RTN","LRAPDSR",137,0)
 S LRFDA(1,LRFILE,LRIENS1,.01)=LRNOW
"RTN","LRAPDSR",138,0)
 S LRFDA(1,LRFILE,LRIENS1,.02)=DUZ,LRFIELD=1
"RTN","LRAPDSR",139,0)
 D UPDATE^DIE("","LRFDA(1)","LRORIEN")
"RTN","LRAPDSR",140,0)
 ;If E-Sign switch OFF,set 3rd piece .03 SUPP REPORT MODIFIED to 1
"RTN","LRAPDSR",141,0)
 ;  to flag the supp report so it can be released via RS
"RTN","LRAPDSR",142,0)
 I 'LRESSW D
"RTN","LRAPDSR",143,0)
 .S:LRSS'="AU" $P(^LR(LRDFN,LRSS,LRI,1.2,LRDA,0),"^",3)=1
"RTN","LRAPDSR",144,0)
 .S:LRSS="AU" $P(^LR(LRDFN,84,LRDA,0),"^",3)=1
"RTN","LRAPDSR",145,0)
 Q
"RTN","LRAPDSR",146,0)
STORE ;Second, store the original report
"RTN","LRAPDSR",147,0)
 S LRIENS2=LRORIEN(1)_","_LRIENS
"RTN","LRAPDSR",148,0)
 S LRWPROOT="^TMP(""DIQ1"",$J,LRFILE1,LRIENS,1)"
"RTN","LRAPDSR",149,0)
 D WP^DIE(LRFILE,LRIENS2,LRFIELD,"",LRWPROOT)
"RTN","LRAPDSR",150,0)
 K ^TMP("DIQ1",$J)
"RTN","LRAPDSR",151,0)
 Q
"RTN","LRAPMRL")
0^4^B65434742^B66524711
"RTN","LRAPMRL",1,0)
LRAPMRL ;DALOI/WTY/KLL- AP MODIFY RELEASED REPORT;12/04/01
"RTN","LRAPMRL",2,0)
 ;;5.2;LAB SERVICE;**259,295,317**;Sep 27, 1994
"RTN","LRAPMRL",3,0)
 ;
"RTN","LRAPMRL",4,0)
MAIN ;
"RTN","LRAPMRL",5,0)
 N LRQUIT,LRMSG,LREND,LRDATA,LRREL,LRAU,LREFPD,LRWM,LRCT,LRTMP,LRGMDF
"RTN","LRAPMRL",6,0)
 N LRFLD,LRDSC,LRCHG,LRXTMP,LRYTMP,LRIENS1,LRFILE,LRFLDA,LRAD1,LRIENS
"RTN","LRAPMRL",7,0)
 N LRORIEN,LRWPROOT,LRFDA,LRDA,LRFIELD,LRFILE1,LRIENS2,LRDT0,LRESCPT
"RTN","LRAPMRL",8,0)
 N LRQUIT1,LREDIAG,LRLOCK,LRNOTXT,LRORIEN
"RTN","LRAPMRL",9,0)
 S LRESCPT=0
"RTN","LRAPMRL",10,0)
 D TITLE
"RTN","LRAPMRL",11,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",12,0)
 D NOTICE
"RTN","LRAPMRL",13,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",14,0)
 D SECTION
"RTN","LRAPMRL",15,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",16,0)
 D WHAT
"RTN","LRAPMRL",17,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",18,0)
 D CPTCHK
"RTN","LRAPMRL",19,0)
 ;D SECTION
"RTN","LRAPMRL",20,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",21,0)
 D ASK
"RTN","LRAPMRL",22,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",23,0)
 D SETDR^LRAPMRL1
"RTN","LRAPMRL",24,0)
 D ACCYR
"RTN","LRAPMRL",25,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",26,0)
 D ACCPN
"RTN","LRAPMRL",27,0)
 D END
"RTN","LRAPMRL",28,0)
 Q
"RTN","LRAPMRL",29,0)
ACCPN ;Prompt for accesion number or patient name
"RTN","LRAPMRL",30,0)
 F  D  Q:LREND
"RTN","LRAPMRL",31,0)
 .S (LRQUIT,LREND)=0
"RTN","LRAPMRL",32,0)
 .D CPTCHK
"RTN","LRAPMRL",33,0)
 .D LOOKUP^LRAPUTL(.LRDATA,LRH(0),LRO(68),LRSS,LRAD,LRAA)
"RTN","LRAPMRL",34,0)
 .I (LRDATA<1)!('$G(LRAN))!($G(LRAN)=-1) S LREND=1 Q
"RTN","LRAPMRL",35,0)
 .S LRDFN=LRDATA,LRI=LRDATA(1)
"RTN","LRAPMRL",36,0)
 .S LRLOCK="^LR(LRDFN"_$S(LRAU:")",1:",LRSS,LRI)")
"RTN","LRAPMRL",37,0)
 .L +@(LRLOCK):5 I '$T D  Q
"RTN","LRAPMRL",38,0)
 ..S LRMSG="This record is locked by another user.  "
"RTN","LRAPMRL",39,0)
 ..S LRMSG=LRMSG_"Please try again later."
"RTN","LRAPMRL",40,0)
 ..D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPMRL",41,0)
 .S LRIENS=$S('LRAU:LRI_",",1:"")_LRDFN_","
"RTN","LRAPMRL",42,0)
 .D RELCHK^LRAPMRL1
"RTN","LRAPMRL",43,0)
 .I LRQUIT D UNLOCK Q
"RTN","LRAPMRL",44,0)
 .D RELEASE^LRAPMRL1
"RTN","LRAPMRL",45,0)
 .D QUEUPD^LRAPMRL1
"RTN","LRAPMRL",46,0)
 .D:LRCAPA&'LRAU C^LRAPSWK
"RTN","LRAPMRL",47,0)
 .D:'LREDIAG SETDR^LRAPMRL1,EDIT^LRAPMRL1
"RTN","LRAPMRL",48,0)
 .I LRQUIT D UNLOCK Q
"RTN","LRAPMRL",49,0)
 .I 'LRAU D
"RTN","LRAPMRL",50,0)
 ..F LRFLD=1,1.1,1.4,1.3 D  Q:LRQUIT
"RTN","LRAPMRL",51,0)
 ...Q:LREDIAG&(LRFLD'=1.4)
"RTN","LRAPMRL",52,0)
 ...Q:'LREDIAG&(LRFLD=1.4)
"RTN","LRAPMRL",53,0)
 ...Q:LRFLD=1.3&(LRSS'="SP")
"RTN","LRAPMRL",54,0)
 ...D ASK2 Q:LRQUIT!('LRGMDF)
"RTN","LRAPMRL",55,0)
 ...D SAVTXT
"RTN","LRAPMRL",56,0)
 ...K DR S DR=LRFLD
"RTN","LRAPMRL",57,0)
 ...D EDIT^LRAPMRL1
"RTN","LRAPMRL",58,0)
 ...D COMPARE Q:LRQUIT
"RTN","LRAPMRL",59,0)
 ...D AUDIT Q:LRQUIT
"RTN","LRAPMRL",60,0)
 ...D STORE
"RTN","LRAPMRL",61,0)
 .I LRAU,LREDIAG D
"RTN","LRAPMRL",62,0)
 ..S LRDSC="PATHOLOGICAL DIAGNOSIS"
"RTN","LRAPMRL",63,0)
 ..S LRFLD=32.3
"RTN","LRAPMRL",64,0)
 ..D SAVTXT
"RTN","LRAPMRL",65,0)
 ..K DR S DR=LRFLD
"RTN","LRAPMRL",66,0)
 ..D EDIT^LRAPMRL1
"RTN","LRAPMRL",67,0)
 ..D COMPARE
"RTN","LRAPMRL",68,0)
 .I $G(SEX)["F","SPCY"[LRSS D DEL^LRWOMEN
"RTN","LRAPMRL",69,0)
 .I LRQUIT D UNLOCK Q
"RTN","LRAPMRL",70,0)
 .I LREDIAG D UNLOCK Q
"RTN","LRAPMRL",71,0)
 .D:LRESCPT CPTCODE^LRAPMRL1
"RTN","LRAPMRL",72,0)
 .D UNLOCK
"RTN","LRAPMRL",73,0)
 Q
"RTN","LRAPMRL",74,0)
TITLE ;Title
"RTN","LRAPMRL",75,0)
 S (LRQUIT,LRQUIT1)=0
"RTN","LRAPMRL",76,0)
 D CK^LRAP
"RTN","LRAPMRL",77,0)
 I Y=-1 S LRQUIT=1 Q
"RTN","LRAPMRL",78,0)
 W @IOF
"RTN","LRAPMRL",79,0)
 S LRMSG="Modify Released Pathology Reports"
"RTN","LRAPMRL",80,0)
 S LRMSG(1)=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPMRL",81,0)
 S LRMSG(1,"F")="!!"
"RTN","LRAPMRL",82,0)
 S LRMSG(2)="",LRMSG(2,"F")="!"
"RTN","LRAPMRL",83,0)
 D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPMRL",84,0)
 Q
"RTN","LRAPMRL",85,0)
NOTICE ;Warn the user and allow an exit
"RTN","LRAPMRL",86,0)
 K LRMSG
"RTN","LRAPMRL",87,0)
 S LRMSG="NOTICE"
"RTN","LRAPMRL",88,0)
 S LRMSG(1)=$$CJ^XLFSTR(LRMSG,IOM),LRMSG(1,"F")="!!"
"RTN","LRAPMRL",89,0)
 S LRMSG(2)="",LRMSG(2,"F")="!"
"RTN","LRAPMRL",90,0)
 S LRMSG(3)=$C(7)_"This option allows modification of a verified/"
"RTN","LRAPMRL",91,0)
 S LRMSG(3)=LRMSG(3)_"released pathology report."
"RTN","LRAPMRL",92,0)
 S LRMSG(3,"F")="!?3"
"RTN","LRAPMRL",93,0)
 S LRMSG(4)="Continuing with this option will unrelease the report "
"RTN","LRAPMRL",94,0)
 S LRMSG(4)=LRMSG(4)_"and flag the report",LRMSG(4,"F")="!?3"
"RTN","LRAPMRL",95,0)
 S LRMSG(5)="as modified even if the data is unchanged.  It will "
"RTN","LRAPMRL",96,0)
 S LRMSG(5)=LRMSG(5)_"also be queued to the",LRMSG(5,"F")="!?3"
"RTN","LRAPMRL",97,0)
 S LRMSG(6)="final report queue so that it may be verified/released "
"RTN","LRAPMRL",98,0)
 S LRMSG(6)=LRMSG(6)_"again.",LRMSG(6,"F")="!?3"
"RTN","LRAPMRL",99,0)
 D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPMRL",100,0)
 W !!
"RTN","LRAPMRL",101,0)
 S DIR(0)="Y",DIR("A")="Do you wish to continue",DIR("B")="NO"
"RTN","LRAPMRL",102,0)
 D ^DIR
"RTN","LRAPMRL",103,0)
 S:Y<1 LRQUIT=1
"RTN","LRAPMRL",104,0)
 Q
"RTN","LRAPMRL",105,0)
WHAT ;What is to be edited
"RTN","LRAPMRL",106,0)
 W !
"RTN","LRAPMRL",107,0)
 K DIR
"RTN","LRAPMRL",108,0)
 ;Don't ask to Edit Diagnosis if initial entry of diagnosis is turned
"RTN","LRAPMRL",109,0)
 ;  off at data entry for SP, CY, EM's
"RTN","LRAPMRL",110,0)
 S LRASK=1,XASK=""
"RTN","LRAPMRL",111,0)
 I 'LRAU D
"RTN","LRAPMRL",112,0)
 .S X=$G(^LAB(69.9,1,11))
"RTN","LRAPMRL",113,0)
 .S XASK=$S(LRSS="SP":$P(X,"^",2),LRSS="CY":$P(X,"^",3),1:"")
"RTN","LRAPMRL",114,0)
 .S:XASK="" XASK=$S(LRSS="EM":$P(X,"^",4),1:"")
"RTN","LRAPMRL",115,0)
 .S LRASK=$$GET1^DIQ(69.9,1,XASK,"I")
"RTN","LRAPMRL",116,0)
 S:LRASK DIR(0)="S^1:Edit Report;2:Edit Diagnosis"
"RTN","LRAPMRL",117,0)
 S:LRASK DIR("A")="Enter selection",DIR("B")=1
"RTN","LRAPMRL",118,0)
 S:'LRASK DIR(0)="Y",DIR("B")="YES",DIR("A")="Edit Report?"
"RTN","LRAPMRL",119,0)
 D ^DIR
"RTN","LRAPMRL",120,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) S LRQUIT=1 Q
"RTN","LRAPMRL",121,0)
 S:Y=0 LRQUIT=1
"RTN","LRAPMRL",122,0)
 Q:LRQUIT=1
"RTN","LRAPMRL",123,0)
 S LREDIAG=Y
"RTN","LRAPMRL",124,0)
 S LREDIAG=$S(LREDIAG=2:1,1:0)
"RTN","LRAPMRL",125,0)
 Q
"RTN","LRAPMRL",126,0)
CPTCHK ;Determine if CPT is activated
"RTN","LRAPMRL",127,0)
 Q:$T(ES^LRCAPES)=""
"RTN","LRAPMRL",128,0)
 S LRESCPT=$$ES^LRCAPES()
"RTN","LRAPMRL",129,0)
 Q
"RTN","LRAPMRL",130,0)
SECTION ;Choose Anatomic Pathology section (AU,SP,CY,EM)
"RTN","LRAPMRL",131,0)
 W !
"RTN","LRAPMRL",132,0)
 D ^LRAP
"RTN","LRAPMRL",133,0)
 I '$D(Y)!('$D(LRSS)) S LRQUIT=1 Q
"RTN","LRAPMRL",134,0)
 S:LRO(68)="EM" LRO(68)="ELECTRON MICROSCOPY"
"RTN","LRAPMRL",135,0)
 S LRAU=0            ; LRAU = 0 - Not Autopsy
"RTN","LRAPMRL",136,0)
 S:LRSS="AU" LRAU=1  ;      = 1 - Autosy
"RTN","LRAPMRL",137,0)
 I LRCAPA D @(LRSS_"^LRAPSWK")
"RTN","LRAPMRL",138,0)
 S LRMSG(1)=LRO(68)_" ("_LRABV_")",LRMSG(1,"F")="!?20"
"RTN","LRAPMRL",139,0)
 S LRMSG(2)="",LRMSG(2,"F")="!"
"RTN","LRAPMRL",140,0)
 D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPMRL",141,0)
 Q
"RTN","LRAPMRL",142,0)
ASK ;Ask etiology,function,procedure,disease,weights,measures
"RTN","LRAPMRL",143,0)
 I LREDIAG D  Q
"RTN","LRAPMRL",144,0)
 .S:'LRAU LREFPD=0
"RTN","LRAPMRL",145,0)
 .S:LRAU LRWM=0
"RTN","LRAPMRL",146,0)
 W !
"RTN","LRAPMRL",147,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPMRL",148,0)
 S DIR("A")="Edit etiology, function, procedure & disease"
"RTN","LRAPMRL",149,0)
 D ^DIR
"RTN","LRAPMRL",150,0)
 I Y="^" S LRQUIT=1 Q
"RTN","LRAPMRL",151,0)
 S LREFPD=$S(+Y:1,1:0)
"RTN","LRAPMRL",152,0)
 I LRAU D
"RTN","LRAPMRL",153,0)
 .W !
"RTN","LRAPMRL",154,0)
 .S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPMRL",155,0)
 .S DIR("A")="Edit weights and measures"
"RTN","LRAPMRL",156,0)
 .D ^DIR
"RTN","LRAPMRL",157,0)
 .I Y="^" S LRQUIT=1 Q
"RTN","LRAPMRL",158,0)
 .S LRWM=$S(+Y:1,1:0)
"RTN","LRAPMRL",159,0)
 Q
"RTN","LRAPMRL",160,0)
ACCYR ;Determine Accession Year
"RTN","LRAPMRL",161,0)
 D ACCYR^LRAPUTL(.LRAD1,LRH(0),LRAA,LRO(68))
"RTN","LRAPMRL",162,0)
 I LRAD1=-1 S LRQUIT=1 Q
"RTN","LRAPMRL",163,0)
 I LRAD1 S LRAD=$P(LRAD1,U),LRH(0)=$P(LRAD1,U,2)
"RTN","LRAPMRL",164,0)
 Q
"RTN","LRAPMRL",165,0)
ASK2 ;Ask about other fields
"RTN","LRAPMRL",166,0)
 S LRGMDF=0
"RTN","LRAPMRL",167,0)
 K LRDSC
"RTN","LRAPMRL",168,0)
 I LRFLD=1!(LRFLD=1.1) D
"RTN","LRAPMRL",169,0)
 .S:LRFLD=1 LRFLDA=7
"RTN","LRAPMRL",170,0)
 .S:LRFLD=1.1 LRFLDA=4
"RTN","LRAPMRL",171,0)
 .S LRDSC=$S(LRFLD=1:"GROSS",LRFLD=1.1:"MICROSCOPIC",1:"")
"RTN","LRAPMRL",172,0)
 .S LRDSC=LRDSC_" DESCRIPTION"
"RTN","LRAPMRL",173,0)
 S:LRFLD=1.4 LRDSC="DIAGNOSIS",LRFLDA=5
"RTN","LRAPMRL",174,0)
 S:LRFLD=1.3 LRDSC="FROZEN SECTION",LRFLDA=6
"RTN","LRAPMRL",175,0)
 I 'LREDIAG D
"RTN","LRAPMRL",176,0)
 .S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPMRL",177,0)
 .S DIR("A")="Edit "_LRDSC
"RTN","LRAPMRL",178,0)
 .D ^DIR
"RTN","LRAPMRL",179,0)
 .I Y="^" S LRQUIT=1 Q
"RTN","LRAPMRL",180,0)
 .S LRGMDF=$S(+Y:1,1:0)
"RTN","LRAPMRL",181,0)
 S:LREDIAG LRGMDF=1
"RTN","LRAPMRL",182,0)
 Q
"RTN","LRAPMRL",183,0)
SAVTXT ;Save word processing field text.
"RTN","LRAPMRL",184,0)
 S LRNOTXT=0
"RTN","LRAPMRL",185,0)
 K ^TMP("DIQ1",$J)
"RTN","LRAPMRL",186,0)
 S:'LRAU LRIENS=LRI_","_LRDFN_",",LRFILE=LRSF
"RTN","LRAPMRL",187,0)
 S:LRAU LRIENS=LRDFN_",",LRFILE=63
"RTN","LRAPMRL",188,0)
 Q:LRFLD=""
"RTN","LRAPMRL",189,0)
 S LRTMP=$$GET1^DIQ(LRFILE,LRIENS,LRFLD,"","^TMP(""DIQ1"",$J)")
"RTN","LRAPMRL",190,0)
 I LRTMP="" D
"RTN","LRAPMRL",191,0)
 .K LRMSG
"RTN","LRAPMRL",192,0)
 .S LRMSG(1)="There is no "_LRDSC_" text to modify."
"RTN","LRAPMRL",193,0)
 .S LRMSG(1,"F")="!!"
"RTN","LRAPMRL",194,0)
 .S LRMSG(2)="Report was released before entering text."
"RTN","LRAPMRL",195,0)
 .S LRMSG(2,"F")="!"
"RTN","LRAPMRL",196,0)
 .D EN^DDIOL(.LRMSG)
"RTN","LRAPMRL",197,0)
 .S LRNOTXT=1
"RTN","LRAPMRL",198,0)
 Q
"RTN","LRAPMRL",199,0)
COMPARE ;Compare report text
"RTN","LRAPMRL",200,0)
 S (LRCHG,LRQUIT,LRCT)=0
"RTN","LRAPMRL",201,0)
 S:'LRAU LRFILE="^LR(LRDFN,LRSS,LRI,LRFLD,"
"RTN","LRAPMRL",202,0)
 S:LRAU LRFILE="^LR(LRDFN,82,"
"RTN","LRAPMRL",203,0)
 I '$D(@(LRFILE_"0)")) D  Q
"RTN","LRAPMRL",204,0)
 .Q:LRNOTXT
"RTN","LRAPMRL",205,0)
 .S LRQUIT=1
"RTN","LRAPMRL",206,0)
 F  S LRCT=$O(@(LRFILE_"LRCT)")) Q:'LRCT  D
"RTN","LRAPMRL",207,0)
 .S LRXTMP=@(LRFILE_"LRCT,0)")
"RTN","LRAPMRL",208,0)
 .I '$D(^TMP("DIQ1",$J,LRCT)) S LRCHG=1 Q
"RTN","LRAPMRL",209,0)
 .S LRYTMP=^TMP("DIQ1",$J,LRCT)
"RTN","LRAPMRL",210,0)
 .I LRXTMP'=LRYTMP S LRCHG=1
"RTN","LRAPMRL",211,0)
 I 'LRCHG D
"RTN","LRAPMRL",212,0)
 .S LRCT=0 F  S LRCT=$O(^TMP("DIQ1",$J,LRCT)) Q:'LRCT  D
"RTN","LRAPMRL",213,0)
 ..I '$D(@(LRFILE_"LRCT,0)")) S LRCHG=1
"RTN","LRAPMRL",214,0)
 I 'LRCHG D  Q
"RTN","LRAPMRL",215,0)
 .D EN^DDIOL("No changes made to "_LRDSC_".","","!!")
"RTN","LRAPMRL",216,0)
 .W !
"RTN","LRAPMRL",217,0)
 .K ^TMP("DIQ1",$J)
"RTN","LRAPMRL",218,0)
 I LRCHG&(LRFLD=1.4!(LRFLD=32.3)) D  ;Indicate that the diagnosis
"RTN","LRAPMRL",219,0)
 .K LRFDA                            ;has been modified.
"RTN","LRAPMRL",220,0)
 .S:'LRAU LRFDA(LRSF,LRIENS,.172)=1
"RTN","LRAPMRL",221,0)
 .;KLL-CORRECT BUG WHERE LRSF IS NULL, REPLACE LRSF WITH 63
"RTN","LRAPMRL",222,0)
 .S:LRAU LRFDA(63,LRIENS,102.2)=1
"RTN","LRAPMRL",223,0)
 .;S:LRAU LRFDA(LRSF,LRIENS,102.2)=1
"RTN","LRAPMRL",224,0)
 .D FILE^DIE("","LRFDA")
"RTN","LRAPMRL",225,0)
 Q
"RTN","LRAPMRL",226,0)
AUDIT ;
"RTN","LRAPMRL",227,0)
 N LRNTIME
"RTN","LRAPMRL",228,0)
 K LRFDA
"RTN","LRAPMRL",229,0)
 D NOW^%DTC S LRNTIME=%
"RTN","LRAPMRL",230,0)
 S LRIENS1="+1,"_LRIENS
"RTN","LRAPMRL",231,0)
 S LRFILE=+$$GET1^DID(LRSF,LRFLDA,"","SPECIFIER")
"RTN","LRAPMRL",232,0)
 I LRFILE="" S LRQUIT=1 Q
"RTN","LRAPMRL",233,0)
 S LRFDA(1,LRFILE,LRIENS1,.01)=LRNTIME
"RTN","LRAPMRL",234,0)
 S LRFDA(1,LRFILE,LRIENS1,.02)=DUZ
"RTN","LRAPMRL",235,0)
 D UPDATE^DIE("","LRFDA(1)","LRORIEN")
"RTN","LRAPMRL",236,0)
 Q
"RTN","LRAPMRL",237,0)
STORE ;
"RTN","LRAPMRL",238,0)
 K LRIENS1
"RTN","LRAPMRL",239,0)
 S LRIENS1=LRORIEN(1)_","_LRIENS
"RTN","LRAPMRL",240,0)
 S LRWPROOT="^TMP(""DIQ1"",$J)"
"RTN","LRAPMRL",241,0)
 D WP^DIE(LRFILE,LRIENS1,1,"",LRWPROOT)
"RTN","LRAPMRL",242,0)
 K ^TMP("DIQ1",$J)
"RTN","LRAPMRL",243,0)
 Q
"RTN","LRAPMRL",244,0)
SUPRPT ;Supplementary Report
"RTN","LRAPMRL",245,0)
 K DIR
"RTN","LRAPMRL",246,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPMRL",247,0)
 S DIR("A")="Edit SUPPLEMENTARY REPORTS"
"RTN","LRAPMRL",248,0)
 D ^DIR
"RTN","LRAPMRL",249,0)
 I Y="^" S LRQUIT1=1 Q
"RTN","LRAPMRL",250,0)
 Q:Y<1
"RTN","LRAPMRL",251,0)
 N LRX,LRRLS,LRA,LRFLG,LRNOW
"RTN","LRAPMRL",252,0)
 D GETRPT^LRAPDSR Q:LRQUIT
"RTN","LRAPMRL",253,0)
 S LRRLS=1,LRRLS1=0
"RTN","LRAPMRL",254,0)
 D COPY^LRAPDSR Q:LRQUIT
"RTN","LRAPMRL",255,0)
 D RPT^LRAPDSR Q:LRQUIT
"RTN","LRAPMRL",256,0)
 S Y=LRDA
"RTN","LRAPMRL",257,0)
 D RELEAS2^LRAPDSR
"RTN","LRAPMRL",258,0)
 D COMPARE^LRAPDSR Q:LRQUIT
"RTN","LRAPMRL",259,0)
 D UNRELEAS^LRAPDSR
"RTN","LRAPMRL",260,0)
 D UPDATE^LRAPDSR Q:LRQUIT
"RTN","LRAPMRL",261,0)
 D STORE^LRAPDSR
"RTN","LRAPMRL",262,0)
 Q
"RTN","LRAPMRL",263,0)
UNLOCK ;Unlock the record
"RTN","LRAPMRL",264,0)
 D UPDATE^LRPXRM(LRDFN,$G(LRSS,"AU"),$G(LRI))
"RTN","LRAPMRL",265,0)
 L -@(LRLOCK)
"RTN","LRAPMRL",266,0)
 Q
"RTN","LRAPMRL",267,0)
END ;Clean-up variables and quit
"RTN","LRAPMRL",268,0)
 K ^TMP("LRAPBR",$J),^TMP("TIUP",$J)
"RTN","LRAPMRL",269,0)
 D CLEAN^DILF
"RTN","LRAPMRL",270,0)
 D:$T(CLEAN^LRCAPES)'="" CLEAN^LRCAPES
"RTN","LRAPMRL",271,0)
 D V^LRU
"RTN","LRAPMRL",272,0)
 Q
"RTN","LRAPMRL1")
0^5^B21952067^B15484610
"RTN","LRAPMRL1",1,0)
LRAPMRL1 ;DALOI/WTY/KLL- AP MODIFY RELEASED REPORT CONT'D;12/04/01
"RTN","LRAPMRL1",2,0)
 ;;5.2;LAB SERVICE;**259,317**;Sep 27, 1994
"RTN","LRAPMRL1",3,0)
 ;
"RTN","LRAPMRL1",4,0)
 Q
"RTN","LRAPMRL1",5,0)
RELCHK ;Perform series of checks
"RTN","LRAPMRL1",6,0)
 S LRQUIT=0
"RTN","LRAPMRL1",7,0)
 I LRAU,$G(^LR(LRDFN,"AU"))="" D  Q
"RTN","LRAPMRL1",8,0)
 .S LRMSG="No information found for this accession in the "
"RTN","LRAPMRL1",9,0)
 .S LRMSG=LRMSG_"LAB DATA file (#63)."
"RTN","LRAPMRL1",10,0)
 .D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPMRL1",11,0)
 .S LRQUIT=1
"RTN","LRAPMRL1",12,0)
 Q:LRQUIT
"RTN","LRAPMRL1",13,0)
 K LRREL
"RTN","LRAPMRL1",14,0)
 D RELEASE^LRAPUTL(.LRREL,LRDFN,LRSS,$G(LRI))
"RTN","LRAPMRL1",15,0)
 I 'LRREL(1) D
"RTN","LRAPMRL1",16,0)
 .Q:'LRAU&($G(LRREL(3)))
"RTN","LRAPMRL1",17,0)
 .;KLL-SKIP THIS MSG IF AU RPT COMP DATE IS SET
"RTN","LRAPMRL1",18,0)
 .S RPCOMDT=$$GET1^DIQ(63,LRDFN,13,"I")
"RTN","LRAPMRL1",19,0)
 .Q:LRAU&($G(RPCOMDT))
"RTN","LRAPMRL1",20,0)
 .S LRMSG=$C(7)_"Report has not been released.  Do not use this "
"RTN","LRAPMRL1",21,0)
 .S LRMSG=LRMSG_"option."
"RTN","LRAPMRL1",22,0)
 .D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPMRL1",23,0)
 .S LRQUIT=1
"RTN","LRAPMRL1",24,0)
 ;Has a supplemental rept been entered, but not yet released? Don't
"RTN","LRAPMRL1",25,0)
 ;  allow modifications until supplemental rept. is released.
"RTN","LRAPMRL1",26,0)
 N LRSR,LRSR1,LRSR2
"RTN","LRAPMRL1",27,0)
 S LRSR=0,LRSR1=1
"RTN","LRAPMRL1",28,0)
 I LRREL(1),'LRAU D 
"RTN","LRAPMRL1",29,0)
 .Q:'+$P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),U,4)
"RTN","LRAPMRL1",30,0)
 .F  S LRSR=$O(^LR(LRDFN,LRSS,LRI,1.2,LRSR)) Q:LRSR'>0!('LRSR1)  D
"RTN","LRAPMRL1",31,0)
 ..S LRSR1=+$P(^LR(LRDFN,LRSS,LRI,1.2,LRSR,0),U,2)
"RTN","LRAPMRL1",32,0)
 ..I 'LRSR1 D
"RTN","LRAPMRL1",33,0)
 ...S Y=+$P(^LR(LRDFN,LRSS,LRI,1.2,LRSR,0),U)
"RTN","LRAPMRL1",34,0)
 ...D DD^%DT S LRSR2=Y
"RTN","LRAPMRL1",35,0)
 I LRREL(1),LRAU D
"RTN","LRAPMRL1",36,0)
 .S RPCOMDT=$$GET1^DIQ(63,LRDFN,13,"I")
"RTN","LRAPMRL1",37,0)
 .Q:'RPCOMDT
"RTN","LRAPMRL1",38,0)
 .Q:'+$P($G(^LR(LRDFN,84,0)),U,4)
"RTN","LRAPMRL1",39,0)
 .F  S LRSR=$O(^LR(LRDFN,84,LRSR)) Q:LRSR'>0!('LRSR1)  D
"RTN","LRAPMRL1",40,0)
 ..S LRSR1=+$P(^LR(LRDFN,84,LRSR,0),U,2)
"RTN","LRAPMRL1",41,0)
 ..I 'LRSR1 D
"RTN","LRAPMRL1",42,0)
 ...S Y=+$P(^LR(LRDFN,84,LRSR,0),U)
"RTN","LRAPMRL1",43,0)
 ...D DD^%DT S LRSR2=Y
"RTN","LRAPMRL1",44,0)
 I 'LRSR1 D
"RTN","LRAPMRL1",45,0)
 .S LRQUIT=1
"RTN","LRAPMRL1",46,0)
 .W $C(7),!,"Supplementary report "_LRSR2_" has not been released.  "
"RTN","LRAPMRL1",47,0)
 .W !,"Cannot modify the report."
"RTN","LRAPMRL1",48,0)
 .S Y=0
"RTN","LRAPMRL1",49,0)
 Q
"RTN","LRAPMRL1",50,0)
RELEASE ;Unrelease report
"RTN","LRAPMRL1",51,0)
 N LRNTIME
"RTN","LRAPMRL1",52,0)
 D NOW^%DTC S LRNTIME=%
"RTN","LRAPMRL1",53,0)
 K LRFDA
"RTN","LRAPMRL1",54,0)
 I 'LRAU D
"RTN","LRAPMRL1",55,0)
 .I '$G(LRREL(3)) S LRFDA(LRSF,LRIENS,.15)=LRREL(1)
"RTN","LRAPMRL1",56,0)
 .S LRFDA(LRSF,LRIENS,.11)="@"
"RTN","LRAPMRL1",57,0)
 .S LRFDA(LRSF,LRIENS,.13)="@"
"RTN","LRAPMRL1",58,0)
 .S LRFDA(LRSF,LRIENS,.17)=LRNTIME
"RTN","LRAPMRL1",59,0)
 .S LRFDA(LRSF,LRIENS,.171)=DUZ
"RTN","LRAPMRL1",60,0)
 I LRAU D
"RTN","LRAPMRL1",61,0)
 .S LRFDA(63,LRIENS,14.7)="@"
"RTN","LRAPMRL1",62,0)
 .S LRFDA(63,LRIENS,14.8)="@"
"RTN","LRAPMRL1",63,0)
 .;KLL-ONLY IF REPT COMP DATE IS SET,OK TO MARK AS MODIFIED
"RTN","LRAPMRL1",64,0)
 .S RPCOMDT=$$GET1^DIQ(63,LRIENS,13,"I")
"RTN","LRAPMRL1",65,0)
 .I RPCOMDT D
"RTN","LRAPMRL1",66,0)
 ..S LRFDA(63,LRIENS,102)=LRNTIME
"RTN","LRAPMRL1",67,0)
 ..S LRFDA(63,LRIENS,102.1)=DUZ
"RTN","LRAPMRL1",68,0)
 D FILE^DIE("","LRFDA")
"RTN","LRAPMRL1",69,0)
 Q
"RTN","LRAPMRL1",70,0)
QUEUPD ;Update the final report print queue
"RTN","LRAPMRL1",71,0)
 I '$D(^LRO(69.2,LRAA,2,LRAN,0)) D
"RTN","LRAPMRL1",72,0)
 .K LRFDA
"RTN","LRAPMRL1",73,0)
 .L +^LRO(69.2,LRAA,2):5 I '$T D  Q
"RTN","LRAPMRL1",74,0)
 ..S MSG(1)="The final reports queue is in use by another person.  "
"RTN","LRAPMRL1",75,0)
 ..S MSG(1,"F")="!!"
"RTN","LRAPMRL1",76,0)
 ..S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRAPMRL1",77,0)
 ..D EN^DDIOL(.MSG) K MSG
"RTN","LRAPMRL1",78,0)
 .S LRIENS="+1,"_LRAA_","
"RTN","LRAPMRL1",79,0)
 .S LRFDA(69.23,LRIENS,.01)=LRDFN
"RTN","LRAPMRL1",80,0)
 .S LRFDA(69.23,LRIENS,1)=LRI
"RTN","LRAPMRL1",81,0)
 .S LRFDA(69.23,LRIENS,2)=LRH(0)
"RTN","LRAPMRL1",82,0)
 .S LRORIEN(1)=LRAN
"RTN","LRAPMRL1",83,0)
 .D UPDATE^DIE("","LRFDA","LRORIEN")
"RTN","LRAPMRL1",84,0)
 .L -^LRO(69.2,LRAA,2)
"RTN","LRAPMRL1",85,0)
 Q
"RTN","LRAPMRL1",86,0)
EDIT ;
"RTN","LRAPMRL1",87,0)
 W !
"RTN","LRAPMRL1",88,0)
 I 'LRAU D
"RTN","LRAPMRL1",89,0)
 .S DA=LRI,DA(1)=LRDFN,DIE="^LR("_LRDFN_","""_LRSS_""","
"RTN","LRAPMRL1",90,0)
 S:LRAU DIE="^LR(",DA=LRDFN
"RTN","LRAPMRL1",91,0)
 D ^DIE
"RTN","LRAPMRL1",92,0)
 S:$D(Y) LRQUIT=1
"RTN","LRAPMRL1",93,0)
 S:$G(DTOUT) LRQUIT=1
"RTN","LRAPMRL1",94,0)
 Q
"RTN","LRAPMRL1",95,0)
SETDR ;Set the DR string
"RTN","LRAPMRL1",96,0)
 I LRAU D
"RTN","LRAPMRL1",97,0)
 .K DR
"RTN","LRAPMRL1",98,0)
 .S DR="13;13.01///^S X=LRWHO;32.1;99;11;14.1;14.5;14.6;12.1;"
"RTN","LRAPMRL1",99,0)
 .S DR=DR_"13.5;13.6;13.8;32;80;"
"RTN","LRAPMRL1",100,0)
 .S:LRWM DR=DR_"16:24;26:31;25;31.1;31.4;25.1;25.9"
"RTN","LRAPMRL1",101,0)
 .S DR(2,63.2)=".01;I 'LREFPD S Y=4;1;1.5;3;4;5"
"RTN","LRAPMRL1",102,0)
 .S DR(3,63.21)=".01",DR(3,63.22)=".01;I 'LREFPD S Y=0;1"
"RTN","LRAPMRL1",103,0)
 .S DR(3,63.24)=".01;S:'$P(^LAB(61.5,X,0),U,3) Y=0;.02"
"RTN","LRAPMRL1",104,0)
 .S DR(4,63.23)=".01"
"RTN","LRAPMRL1",105,0)
 I 'LRAU D
"RTN","LRAPMRL1",106,0)
 .S LRV=+$P($G(^LRO(69.2,LRAA,0)),U,10)  ;Ask TC codes?
"RTN","LRAPMRL1",107,0)
 .K DR
"RTN","LRAPMRL1",108,0)
 .S DR=".08;.07;.011;.012;.013;.014;.015;.016;.1;.02;.021;.99;.97;"
"RTN","LRAPMRL1",109,0)
 .S DR=DR_"10;80;.09///^S X=LRWHO;.03"
"RTN","LRAPMRL1",110,0)
 .I LRSS="SP" D
"RTN","LRAPMRL1",111,0)
 ..S DR(2,63.12)=".01;S LR(8)=$P(^LAB(61,X,0),U,4);S:'LR(8) Y=4;2;4;"
"RTN","LRAPMRL1",112,0)
 ..S DR(2,63.12)=DR(2,63.12)_"I 'LREFPD S Y=5;1;1.5;3;5"
"RTN","LRAPMRL1",113,0)
 ..S DR(2,63.812)=".01"
"RTN","LRAPMRL1",114,0)
 ..S DR(3,63.16)=".01;I 'LREFPD S Y=0;1"
"RTN","LRAPMRL1",115,0)
 ..S DR(3,63.82)=".01;D R^LRAPD;.02"
"RTN","LRAPMRL1",116,0)
 .I LRSS="CY" D
"RTN","LRAPMRL1",117,0)
 ..S DR(2,63.902)=".01;.02"
"RTN","LRAPMRL1",118,0)
 ..S DR(2,63.912)=".01;S LR(8)=$P(^LAB(61,X,0),U,4);S:'LR(8) Y=4;2;4;"
"RTN","LRAPMRL1",119,0)
 ..S DR(2,63.912)=DR(2,63.912)_"I 'LREFPD S Y=5;1;1.5;3;5"
"RTN","LRAPMRL1",120,0)
 ..S DR(3,63.916)=".01;I 'LREFPD S Y=0;1"
"RTN","LRAPMRL1",121,0)
 ..S DR(3,63.982)=".01;D R^LRAPD;.02"
"RTN","LRAPMRL1",122,0)
 .I LRSS="EM" D
"RTN","LRAPMRL1",123,0)
 ..S DR(2,63.202)=".01"
"RTN","LRAPMRL1",124,0)
 ..S DR(2,63.212)=".01;S LR(8)=$P(^LAB(61,X,0),U,4);S:'LR(8) Y=4;2;4;"
"RTN","LRAPMRL1",125,0)
 ..S DR(2,63.212)=DR(2,63.212)_"I 'LREFPD S Y=5;1;1.5;3;5"
"RTN","LRAPMRL1",126,0)
 ..S DR(3,63.216)=".01;I 'LREFPD S Y=0;1"
"RTN","LRAPMRL1",127,0)
 ..S DR(3,63.282)=".01;S:'$P(^LAB(61.5,X,0),U,3) Y=0;.02"
"RTN","LRAPMRL1",128,0)
 Q
"RTN","LRAPMRL1",129,0)
CPTCODE ;Enter CPT codes
"RTN","LRAPMRL1",130,0)
 K DIR
"RTN","LRAPMRL1",131,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPMRL1",132,0)
 S DIR("A")="Enter CPT CODING"
"RTN","LRAPMRL1",133,0)
 D ^DIR
"RTN","LRAPMRL1",134,0)
 I Y="^"!(Y<1) S LRQUIT=1 Q
"RTN","LRAPMRL1",135,0)
 N LRPRO
"RTN","LRAPMRL1",136,0)
 ;SET PROVIDER=CURRENT USER, ALLOW UPDATES
"RTN","LRAPMRL1",137,0)
 S LRPRO=DUZ
"RTN","LRAPMRL1",138,0)
 D PROVIDR^LRAPUTL
"RTN","LRAPMRL1",139,0)
 Q:LRQUIT
"RTN","LRAPMRL1",140,0)
 D CPT^LRCAPES(LRAA,LRAD,LRAN,LRPRO)
"RTN","LRAPMRL1",141,0)
 Q
"RTN","LRAPR")
0^1^B84430863^B89817361
"RTN","LRAPR",1,0)
LRAPR ;AVAMC/REG/WTY/KLL- ANAT RELEASE REPORTS ;10/30/01
"RTN","LRAPR",2,0)
 ;;5.2;LAB SERVICE;**72,248,259,317**;Sep 27, 1994
"RTN","LRAPR",3,0)
 ;
"RTN","LRAPR",4,0)
 N LRESSW
"RTN","LRAPR",5,0)
 D SWITCH
"RTN","LRAPR",6,0)
 I +LRESSW D  Q
"RTN","LRAPR",7,0)
 .D ^LRAPRES
"RTN","LRAPR",8,0)
 .D END
"RTN","LRAPR",9,0)
 W !!?27,"Release Pathology Reports",!!
"RTN","LRAPR",10,0)
 D A
"RTN","LRAPR",11,0)
 I '$D(LRSS) D END Q
"RTN","LRAPR",12,0)
 I LRCAPA D  G:'$D(X) END
"RTN","LRAPR",13,0)
 .S X=$S(LRSS="CY":"CYTOLOGY REPORTING",LRSS="SP":"SURGICAL PATH REPORTING",1:"")
"RTN","LRAPR",14,0)
 .D:X]"" X^LRUWK
"RTN","LRAPR",15,0)
 I LRSS="AU" D B Q
"RTN","LRAPR",16,0)
 S LRSOP="Z"
"RTN","LRAPR",17,0)
 S DR="S A=^LR(LRDFN,LRSS,LRI,0),LRZ=$P(A,U,3),LRZ(1)=$P(A,U,13),"
"RTN","LRAPR",18,0)
 S DR=DR_"LRZ(2)=$P(A,U,11),LRZ(3)=$P(A,U,2);"
"RTN","LRAPR",19,0)
 S DR=DR_"I 'LRZ W $C(7),!,""No date report completed.   "
"RTN","LRAPR",20,0)
 S DR=DR_"Cannot release."" S Y=0;"
"RTN","LRAPR",21,0)
 S DR=DR_"I 'LRZ(2) D NMPATH^LRAPR;"
"RTN","LRAPR",22,0)
 S DR=DR_"I LRZ(2) D RINFO^LRAPR S Y=0;"
"RTN","LRAPR",23,0)
 ;Perform supp edit regardless if date rept released since supp rpt
"RTN","LRAPR",24,0)
 ; is added to released report
"RTN","LRAPR",25,0)
 S DR=DR_"D SUPCHK^LRAPR;"
"RTN","LRAPR",26,0)
 S DR=DR_"S DIR(0)=""YA"",DIR(""A"")=""Release report? """
"RTN","LRAPR",27,0)
 S DR=DR_",DIR(""B"")=""NO"" D ^DIR K:Y Y S:$D(Y) Y=0;"
"RTN","LRAPR",28,0)
 S DR=DR_".11////^D NOW^%DTC S X=%;.13////^S X=DUZ;"
"RTN","LRAPR",29,0)
 S DR=DR_"W !!,""Report released..."""
"RTN","LRAPR",30,0)
 D ^LRAPDA
"RTN","LRAPR",31,0)
 D END
"RTN","LRAPR",32,0)
 Q
"RTN","LRAPR",33,0)
 ;
"RTN","LRAPR",34,0)
B ;Autopsy
"RTN","LRAPR",35,0)
 S LRSOP="Z"
"RTN","LRAPR",36,0)
 S DR="S A=$G(^LR(LRDFN,""AU"")) I A="""" S Y=0;"
"RTN","LRAPR",37,0)
 S DR=DR_"S LRZ=$P(A,U,3),LRZ(1)=$P(A,U,16),LRZ(2)=$P(A,U,15),"
"RTN","LRAPR",38,0)
 ;KLL-LRZ(3)=SR PATHOLOGIST,LRZ(4)=PROVISIONAL DATE
"RTN","LRAPR",39,0)
 S DR=DR_"LRZ(3)=$P(A,U,10),LRZ(4)=$P(A,U,17);"
"RTN","LRAPR",40,0)
 ;KLL-PROVISIONAL OR DATE REPORT COMPLETED IS REQUIRED
"RTN","LRAPR",41,0)
 S DR=DR_"I 'LRZ(4),'LRZ W $C(7),!,""Provisional date or date report completed required.   "
"RTN","LRAPR",42,0)
 S DR=DR_"Cannot release."" S Y=0;"
"RTN","LRAPR",43,0)
 S DR=DR_"I 'LRZ(2) D NMPATH^LRAPR;"
"RTN","LRAPR",44,0)
 S DR=DR_"I LRZ(2) D RINFO^LRAPR S Y=0;"
"RTN","LRAPR",45,0)
 ;Perform supp edit regardless if date rept released since supp rpt
"RTN","LRAPR",46,0)
 ; is added to released report
"RTN","LRAPR",47,0)
 S DR=DR_"D SUPCHK^LRAPR;"
"RTN","LRAPR",48,0)
 S DR=DR_"D RELEASE^LRAPR;"
"RTN","LRAPR",49,0)
 S DR=DR_"D NOW^%DTC S LRDTE=%;"
"RTN","LRAPR",50,0)
 S DR=DR_"14.7////^S X=$S(LRZ(2):""@"",1:LRDTE);"
"RTN","LRAPR",51,0)
 S DR=DR_"14.8////^S X=$S(LRZ(2):""@"",1:DUZ);"
"RTN","LRAPR",52,0)
 S DR=DR_"W !!,""Report "" W:LRZ(2) ""un"" W ""released..."";K LRDTE"
"RTN","LRAPR",53,0)
 D ^LRAPDA
"RTN","LRAPR",54,0)
 D END
"RTN","LRAPR",55,0)
 Q
"RTN","LRAPR",56,0)
EN ;Supplementary Report Entry Point
"RTN","LRAPR",57,0)
 N LRESSW
"RTN","LRAPR",58,0)
 D SWITCH
"RTN","LRAPR",59,0)
 W !!?20,"Release Supplementary Pathology Reports",!
"RTN","LRAPR",60,0)
 ;D A
"RTN","LRAPR",61,0)
 ;Section prompt replaces the line above
"RTN","LRAPR",62,0)
 S LRQUIT=0
"RTN","LRAPR",63,0)
 D SECTION^LRAPRES
"RTN","LRAPR",64,0)
 I '$D(LRSS) D END Q
"RTN","LRAPR",65,0)
 ;Verify User ID has access to release supp. reports
"RTN","LRAPR",66,0)
 S LREND=0
"RTN","LRAPR",67,0)
 I LRESSW D CLSSCHK^LRAPRES1(DUZ,.LREND)
"RTN","LRAPR",68,0)
 Q:LREND
"RTN","LRAPR",69,0)
 ;
"RTN","LRAPR",70,0)
 W !!,"Data entry for ",LRH(0)," "
"RTN","LRAPR",71,0)
 S %=1 D YN^LRU G:%<1 END
"RTN","LRAPR",72,0)
 I %=2 D  G:Y<1 END
"RTN","LRAPR",73,0)
 .S %DT="AE",%DT(0)="-N",%DT("A")="Enter YEAR: " D ^%DT K %DT
"RTN","LRAPR",74,0)
 .Q:Y<1  S LRAD=$E(Y,1,3)_"0000",LRH(0)=$E(Y,1,3)+1700
"RTN","LRAPR",75,0)
 I '$D(^LRO(68,LRAA,1,LRAD,0)) D  Q
"RTN","LRAPR",76,0)
 .W $C(7),!!,"NO ",LRAA(1)," ACCESIONS IN FILE FOR ",LRH(0),!!
"RTN","LRAPR",77,0)
W K X,Y,LR("CK") R !!,"Select Accession Number/Pt name: ",LRAN:DTIME
"RTN","LRAPR",78,0)
 G:LRAN=""!(LRAN[U) END
"RTN","LRAPR",79,0)
 I LRAN'?1N.N D  G:LRAN<1 END  G W
"RTN","LRAPR",80,0)
 .D PNAME^LRAPDA
"RTN","LRAPR",81,0)
 .Q:LRAN<1
"RTN","LRAPR",82,0)
 .D DIE
"RTN","LRAPR",83,0)
 D REST
"RTN","LRAPR",84,0)
 G W
"RTN","LRAPR",85,0)
REST W "  for ",LRH(0)
"RTN","LRAPR",86,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0)) D  Q
"RTN","LRAPR",87,0)
 .W $C(7),!!,"Accession # ",LRAN," for ",LRH(0)
"RTN","LRAPR",88,0)
 .W " not in ACCESSION file",!!
"RTN","LRAPR",89,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,0),LRLLOC=$P(X,"^",7),LRDFN=+X
"RTN","LRAPR",90,0)
 Q:'$D(^LR(LRDFN,0))  S X=^(0) D ^LRUP
"RTN","LRAPR",91,0)
 W !,LRP,"  ID: ",SSN
"RTN","LRAPR",92,0)
 I LRSS'="AU" D
"RTN","LRAPR",93,0)
 .S LRI=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),"^",5)
"RTN","LRAPR",94,0)
 .W !,"Specimen(s):"
"RTN","LRAPR",95,0)
 .S X=0 F  S X=$O(^LR(LRDFN,LRSS,LRI,.1,X)) Q:'X  D
"RTN","LRAPR",96,0)
 ..I $D(^LR(LRDFN,LRSS,LRI,.1,X,0)),$L(^(0)) W !,^(0)
"RTN","LRAPR",97,0)
DIE ;Define default supplementary report
"RTN","LRAPR",98,0)
 N LRFILE,LRIENS,LRIENS1,LRX,LRRLS,LRFDA,LRLKFL,LRDA,LRQUIT,LRNOSP
"RTN","LRAPR",99,0)
 N LRMSG,LRSRFL,LRFDA2,LRSRMD,LRRLM
"RTN","LRAPR",100,0)
 S DIC("B")="",LRNOSP=0
"RTN","LRAPR",101,0)
 I LRSS'="AU" D
"RTN","LRAPR",102,0)
 .S LRFILE=+$$GET1^DID(LRSF,1.2,"","SPECIFIER")
"RTN","LRAPR",103,0)
 .S LRIENS1=LRI_","_LRDFN_","
"RTN","LRAPR",104,0)
 .I '+$P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),"^",4) S LRNOSP=1 Q
"RTN","LRAPR",105,0)
 .S LRX=0 F  S LRX=$O(^LR(LRDFN,LRSS,LRI,1.2,LRX)) Q:'LRX  D
"RTN","LRAPR",106,0)
 ..S LRIENS=LRX_","_LRIENS1
"RTN","LRAPR",107,0)
 ..S LRSRFL=$$GET1^DIQ(LRFILE,LRIENS,.02,"I")
"RTN","LRAPR",108,0)
 ..;LRSRMD-set to 1 if supp rpt modified and requires release
"RTN","LRAPR",109,0)
 ..S LRSRMD=$$GET1^DIQ(LRFILE,LRIENS,.03,"I")
"RTN","LRAPR",110,0)
 ..Q:LRSRFL&('LRSRMD)
"RTN","LRAPR",111,0)
 ..S DIC("B")=$$GET1^DIQ(LRFILE,LRIENS,.01,"I")
"RTN","LRAPR",112,0)
 I LRSS="AU" D
"RTN","LRAPR",113,0)
 .S LRFILE=63.324,LRIENS1=LRDFN_","
"RTN","LRAPR",114,0)
 .I '+$P($G(^LR(LRDFN,84,0)),"^",4) S LRNOSP=1 Q
"RTN","LRAPR",115,0)
 .S LRX=0 F  S LRX=$O(^LR(LRDFN,84,LRX)) Q:'LRX  D
"RTN","LRAPR",116,0)
 ..S LRIENS=LRX_","_LRIENS1
"RTN","LRAPR",117,0)
 ..S LRSRFL=$$GET1^DIQ(LRFILE,LRIENS,.02,"I")
"RTN","LRAPR",118,0)
 ..;LRSRMD-set to 1 if supp rpt modified and requires release
"RTN","LRAPR",119,0)
 ..S LRSRMD=$$GET1^DIQ(LRFILE,LRIENS,.03,"I")
"RTN","LRAPR",120,0)
 ..Q:LRSRFL&('LRSRMD)
"RTN","LRAPR",121,0)
 ..S DIC("B")=$$GET1^DIQ(LRFILE,LRIENS,.01,"I")
"RTN","LRAPR",122,0)
 I LRNOSP D  Q
"RTN","LRAPR",123,0)
 .K LRMSG
"RTN","LRAPR",124,0)
 .S LRMSG=$C(7)_"No supplementary reports exist for this accession."
"RTN","LRAPR",125,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPR",126,0)
 I 'DIC("B") D  Q
"RTN","LRAPR",127,0)
 .K LRMSG
"RTN","LRAPR",128,0)
 .S LRMSG=$C(7)_"All supplementary reports have been released."
"RTN","LRAPR",129,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPR",130,0)
DIE1 ;
"RTN","LRAPR",131,0)
 S (LRQUIT,LRRLM)=0
"RTN","LRAPR",132,0)
 F  D  Q:LRQUIT
"RTN","LRAPR",133,0)
 .W !
"RTN","LRAPR",134,0)
 .S:LRSS="AU" (LRLKFL,DIC)="^LR(LRDFN,84,"
"RTN","LRAPR",135,0)
 .S:LRSS'="AU" (LRLKFL,DIC)="^LR(LRDFN,LRSS,LRI,1.2,"
"RTN","LRAPR",136,0)
 .S DIC("A")="Select SUPPLEMENTARY REPORT DATE: "
"RTN","LRAPR",137,0)
 .S DIC(0)="AEQM"
"RTN","LRAPR",138,0)
 .D ^DIC K DIC
"RTN","LRAPR",139,0)
 .I Y<1 S LRQUIT=1 Q
"RTN","LRAPR",140,0)
 .S LRDA=+Y
"RTN","LRAPR",141,0)
 .S LRIENS=LRDA_","_LRIENS1
"RTN","LRAPR",142,0)
 .S LRRLS=+$$GET1^DIQ(LRFILE,LRIENS,.02,"I")
"RTN","LRAPR",143,0)
 .;If E-Sign OFF, must check LRRLM.  LRRLM=1 if supp rpt has been
"RTN","LRAPR",144,0)
 .;  modified and requires release
"RTN","LRAPR",145,0)
 .S LRRLM=+$$GET1^DIQ(LRFILE,LRIENS,.03,"I")
"RTN","LRAPR",146,0)
 .I LRESSW,LRRLS D  Q
"RTN","LRAPR",147,0)
 ..W !!,"This supplementary report has already been released.",!
"RTN","LRAPR",148,0)
 .I 'LRESSW,LRRLS D  Q:'LRRLM
"RTN","LRAPR",149,0)
 ..I 'LRRLM W !!,"This supplementary rept has already been released.",!
"RTN","LRAPR",150,0)
 .W !
"RTN","LRAPR",151,0)
 .I LRESSW D  Q
"RTN","LRAPR",152,0)
 ..D ESIG Q:LRQUIT
"RTN","LRAPR",153,0)
 ..D UPDATE
"RTN","LRAPR",154,0)
 .S DIR("A")="Release supplementary report",DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPR",155,0)
 .D ^DIR K DIR
"RTN","LRAPR",156,0)
 .Q:'Y
"RTN","LRAPR",157,0)
 .D UPDATE
"RTN","LRAPR",158,0)
 .;If E-sign switch OFF and orig report released, must verify all
"RTN","LRAPR",159,0)
 .;  supp reports released before release main report.
"RTN","LRAPR",160,0)
 .I LRCKREL,'LRESSW D CHKSUP^LRAPR1
"RTN","LRAPR",161,0)
 Q
"RTN","LRAPR",162,0)
 ;
"RTN","LRAPR",163,0)
A D ^LRAP G:'$D(Y) END
"RTN","LRAPR",164,0)
 Q
"RTN","LRAPR",165,0)
C ;
"RTN","LRAPR",166,0)
 S LRDICS="SPCYEM" D ^LRAP
"RTN","LRAPR",167,0)
 G:'$D(Y) END
"RTN","LRAPR",168,0)
 Q
"RTN","LRAPR",169,0)
S ;from LRAPDA
"RTN","LRAPR",170,0)
 S LRK=$P(^LR(LRDFN,LRSS,LRI,0),"^",11) Q:'LRK  S:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,0)) ^(0)="^68.04PA^^"
"RTN","LRAPR",171,0)
 Q:$D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,0))  S ^(0)=LRT_"^50^^"_DUZ_"^"_LRK,X=^LRO(68,LRAA,1,LRAD,1,LRAN,4,0),^(0)=$P(X,"^",1,2)_"^"_LRT_"^"_($P(X,"^",4)+1)
"RTN","LRAPR",172,0)
 S:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,1,0)) ^(0)="^68.14P^^"
"RTN","LRAPR",173,0)
 S C=0 F  S C=$O(LRT(C)) Q:'C  D CAP
"RTN","LRAPR",174,0)
 S ^LRO(68,"AA",LRAA_"|"_LRAD_"|"_LRAN_"|"_LRT)=""
"RTN","LRAPR",175,0)
 Q
"RTN","LRAPR",176,0)
 ;
"RTN","LRAPR",177,0)
CAP S ^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,1,C,0)=C_"^1^0^0^^"_LRK_"^"_DUZ_"^"_DUZ(2)_"^"_LRAA_"^"_LRAA_"^"_LRAA
"RTN","LRAPR",178,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,1,0),^(0)=$P(X,"^",1,2)_"^"_C_"^"_($P(X,"^",4)+1)
"RTN","LRAPR",179,0)
 Q
"RTN","LRAPR",180,0)
 ;
"RTN","LRAPR",181,0)
SWITCH ;Check to see if electronic signature is enabled
"RTN","LRAPR",182,0)
 D GETDATA^LRAPESON(.LRESSW)
"RTN","LRAPR",183,0)
 Q
"RTN","LRAPR",184,0)
ESIG ;Prompt for electronic signature
"RTN","LRAPR",185,0)
 S LRQUIT=0
"RTN","LRAPR",186,0)
 D SIG^XUSESIG
"RTN","LRAPR",187,0)
 I X1="" D
"RTN","LRAPR",188,0)
 .W "  SIGNATURE NOT VERIFIED"
"RTN","LRAPR",189,0)
 .S LRQUIT=1
"RTN","LRAPR",190,0)
 Q
"RTN","LRAPR",191,0)
UPDATE ;
"RTN","LRAPR",192,0)
 S LRLKFL=LRLKFL_LRDA_",0)"
"RTN","LRAPR",193,0)
 L +@(LRLKFL):5 I '$T D  Q
"RTN","LRAPR",194,0)
 .S LRMSG="This record is locked by another user.  "
"RTN","LRAPR",195,0)
 .S LRMSG=LRMSG_"Please wait and try again."
"RTN","LRAPR",196,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPR",197,0)
 S LRFDA(LRFILE,LRIENS,.02)=1
"RTN","LRAPR",198,0)
 S LRFDA2(LRFILE,LRIENS,.02)="@" ;Set but don't file unless unrel needed
"RTN","LRAPR",199,0)
 ;File signer ID and Date/time of released supp report
"RTN","LRAPR",200,0)
 D CKSIGNR^LRAPR1
"RTN","LRAPR",201,0)
 D FILE^DIE("","LRFDA")
"RTN","LRAPR",202,0)
 W "...Released"
"RTN","LRAPR",203,0)
 L -@(LRLKFL)
"RTN","LRAPR",204,0)
 ;If all supp reports released, and E-Sign switch is ON, proceed to
"RTN","LRAPR",205,0)
 ;  release main report
"RTN","LRAPR",206,0)
 S LRCKREL=0
"RTN","LRAPR",207,0)
 S:LRSS'="AU" LRCKREL=$P(^LR(LRDFN,LRSS,LRI,0),"^",11)
"RTN","LRAPR",208,0)
 S:LRSS="AU" LRCKREL=$P(^LR(LRDFN,LRSS),"^",15)
"RTN","LRAPR",209,0)
 I LRCKREL,LRESSW D RELMN
"RTN","LRAPR",210,0)
 Q
"RTN","LRAPR",211,0)
SUPCHK ;Check for unreleased supplementary reports
"RTN","LRAPR",212,0)
 N LRSR,LRSR1,LRSR2
"RTN","LRAPR",213,0)
 S LRSR=0,LRSR1=1
"RTN","LRAPR",214,0)
 I LRSS'="AU" D
"RTN","LRAPR",215,0)
 .Q:'+$P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),U,4)
"RTN","LRAPR",216,0)
 .F  S LRSR=$O(^LR(LRDFN,LRSS,LRI,1.2,LRSR)) Q:LRSR'>0!('LRSR1)  D
"RTN","LRAPR",217,0)
 ..S LRSR1=+$P(^LR(LRDFN,LRSS,LRI,1.2,LRSR,0),U,2)
"RTN","LRAPR",218,0)
 ..I 'LRSR1 D
"RTN","LRAPR",219,0)
 ...S Y=+$P(^LR(LRDFN,LRSS,LRI,1.2,LRSR,0),U)
"RTN","LRAPR",220,0)
 ...D DD^%DT S LRSR2=Y
"RTN","LRAPR",221,0)
 I LRSS="AU" D
"RTN","LRAPR",222,0)
 .Q:'+$P($G(^LR(LRDFN,84,0)),U,4)
"RTN","LRAPR",223,0)
 .F  S LRSR=$O(^LR(LRDFN,84,LRSR)) Q:LRSR'>0!('LRSR1)  D
"RTN","LRAPR",224,0)
 ..S LRSR1=+$P(^LR(LRDFN,84,LRSR,0),U,2)
"RTN","LRAPR",225,0)
 ..I 'LRSR1 D
"RTN","LRAPR",226,0)
 ...S Y=+$P(^LR(LRDFN,84,LRSR,0),U)
"RTN","LRAPR",227,0)
 ...D DD^%DT S LRSR2=Y
"RTN","LRAPR",228,0)
 I 'LRSR1 D
"RTN","LRAPR",229,0)
 .W $C(7),!,"Supplementary report "_LRSR2_" has not been released.  "
"RTN","LRAPR",230,0)
 .W "Cannot release."
"RTN","LRAPR",231,0)
 .S Y=0
"RTN","LRAPR",232,0)
 Q
"RTN","LRAPR",233,0)
RINFO ;Display release information
"RTN","LRAPR",234,0)
 W $C(7),!,"Report "
"RTN","LRAPR",235,0)
 W:LRZ(2)=1 "has already been "
"RTN","LRAPR",236,0)
 W "released "
"RTN","LRAPR",237,0)
 S Y=LRZ(2)
"RTN","LRAPR",238,0)
 D DD^%DT
"RTN","LRAPR",239,0)
 W:LRZ(2)>1 Y
"RTN","LRAPR",240,0)
 W:LRZ(1)'="" " by "_$P($G(^VA(200,LRZ(1),0)),U)
"RTN","LRAPR",241,0)
 K Y
"RTN","LRAPR",242,0)
 Q
"RTN","LRAPR",243,0)
NMPATH ;Check for missing pathologist name
"RTN","LRAPR",244,0)
 I 'LRZ(3) D
"RTN","LRAPR",245,0)
 .W $C(7),!,"Pathologist name missing.  Cannot release."
"RTN","LRAPR",246,0)
 .S Y=0
"RTN","LRAPR",247,0)
 Q
"RTN","LRAPR",248,0)
RELEASE ;Prompt for release/unrelease
"RTN","LRAPR",249,0)
 W ! S DIR(0)="YA",DIR("B")="NO"
"RTN","LRAPR",250,0)
 S:LRZ(2) DIR("A")="Unrelease report? "
"RTN","LRAPR",251,0)
 S:'LRZ(2) DIR("A")="Release report? "
"RTN","LRAPR",252,0)
 D ^DIR
"RTN","LRAPR",253,0)
 K:Y Y
"RTN","LRAPR",254,0)
 I $D(Y) S Y=0
"RTN","LRAPR",255,0)
 Q
"RTN","LRAPR",256,0)
RELMN ;Allow release of main report as long as all supp reports are
"RTN","LRAPR",257,0)
 ;  released, and signer is same person for main and supp report(s)
"RTN","LRAPR",258,0)
 ;Make sure all supp reports signed out
"RTN","LRAPR",259,0)
 S LRQT=0
"RTN","LRAPR",260,0)
 D RELCHK^LRAPR1
"RTN","LRAPR",261,0)
 Q:LRQT
"RTN","LRAPR",262,0)
 ;
"RTN","LRAPR",263,0)
 ;Continue with electronic signature and storage in TIU
"RTN","LRAPR",264,0)
 S LRAU=$S(LRSS="AU":1,1:0)
"RTN","LRAPR",265,0)
 I 'LRAU D
"RTN","LRAPR",266,0)
 .S LRPAT=+$$GET1^DIQ(LRSF,LRIENS1,.02,"I")
"RTN","LRAPR",267,0)
 .S LRZ=$$GET1^DIQ(LRSF,LRIENS1,.03,"I")
"RTN","LRAPR",268,0)
 .S LRZ(1)=$$GET1^DIQ(LRSF,LRIENS1,.13,"I")
"RTN","LRAPR",269,0)
 .S LRZ(1.1)=$$GET1^DIQ(LRSF,LRIENS1,.13)
"RTN","LRAPR",270,0)
 .S LRZ(2)=$$GET1^DIQ(LRSF,LRIENS1,.11,"I")
"RTN","LRAPR",271,0)
 I LRAU D
"RTN","LRAPR",272,0)
 .S LRPAT=+$$GET1^DIQ(63,LRDFN_",",13.6,"I")
"RTN","LRAPR",273,0)
 .S LRZ=$$GET1^DIQ(63,LRDFN_",",13,"I")
"RTN","LRAPR",274,0)
 .S LRZ(1)=$$GET1^DIQ(63,LRDFN_",",14.8,"I")
"RTN","LRAPR",275,0)
 .S LRZ(1.1)=$$GET1^DIQ(63,LRDFN_",",14.8)
"RTN","LRAPR",276,0)
 .S LRZ(2)=$$GET1^DIQ(63,LRDFN_",",14.7,"I")
"RTN","LRAPR",277,0)
 .S LRI=""
"RTN","LRAPR",278,0)
 W !!,?25,"*** Main Report Release ***",!
"RTN","LRAPR",279,0)
 D NOW^%DTC S LRNTIME=%
"RTN","LRAPR",280,0)
 D TIUPREP^LRAPRES
"RTN","LRAPR",281,0)
 D STORE^LRAPRES
"RTN","LRAPR",282,0)
 I LRQUIT D FILE^DIE("","LRFDA2") Q
"RTN","LRAPR",283,0)
 D UNRLSE^LRAPR1
"RTN","LRAPR",284,0)
 D RELEASE^LRAPRES
"RTN","LRAPR",285,0)
 I LRQUIT D FILE^DIE("","LRFDA2") Q
"RTN","LRAPR",286,0)
 D MAIN^LRAPRES1(LRDFN,LRSS,LRI,LRSF,LRP,LRAC)
"RTN","LRAPR",287,0)
 D OERR^LR7OB63D
"RTN","LRAPR",288,0)
 S LRQUIT=1
"RTN","LRAPR",289,0)
 Q
"RTN","LRAPR",290,0)
END ;
"RTN","LRAPR",291,0)
 D V^LRU
"RTN","LRAPR",292,0)
 Q
"RTN","LRAPR1")
0^12^B19317428^n/a
"RTN","LRAPR1",1,0)
LRAPR1 ;AVAMC/KLL- ANAT RELEASE REPORTS CONT'D;07/26/04
"RTN","LRAPR1",2,0)
 ;;5.2;LAB SERVICE;**317**;Sep 27, 1994
"RTN","LRAPR1",3,0)
 ;
"RTN","LRAPR1",4,0)
RELCHK ;Check to make sure all supp reports are released
"RTN","LRAPR1",5,0)
 N LRFILE,LRIENS,LRIENS1,LRX,LRRLS,LRFDA,LRLKFL,LRDA,LRNOSP
"RTN","LRAPR1",6,0)
 N LRMSG,LRSRFL,LRSRMD
"RTN","LRAPR1",7,0)
 S DIC("B")=""
"RTN","LRAPR1",8,0)
 I LRSS'="AU" D
"RTN","LRAPR1",9,0)
 .S LRFILE=+$$GET1^DID(LRSF,1.2,"","SPECIFIER")
"RTN","LRAPR1",10,0)
 .S LRIENS1=LRI_","_LRDFN_","
"RTN","LRAPR1",11,0)
 .S LRX=0 F  S LRX=$O(^LR(LRDFN,LRSS,LRI,1.2,LRX)) Q:'LRX  D
"RTN","LRAPR1",12,0)
 ..S LRIENS=LRX_","_LRIENS1
"RTN","LRAPR1",13,0)
 ..S LRSRFL=$$GET1^DIQ(LRFILE,LRIENS,.02,"I")
"RTN","LRAPR1",14,0)
 ..;LRSRMD- if flag is true, supp rpt has been modified, needs release
"RTN","LRAPR1",15,0)
 ..S LRSRMD=$$GET1^DIQ(LRFILE,LRIENS,.03,"I")
"RTN","LRAPR1",16,0)
 ..Q:LRSRFL&('LRSRMD)
"RTN","LRAPR1",17,0)
 ..S DIC("B")=$$GET1^DIQ(LRFILE,LRIENS,.01,"I")
"RTN","LRAPR1",18,0)
 I LRSS="AU" D
"RTN","LRAPR1",19,0)
 .S LRFILE=63.324
"RTN","LRAPR1",20,0)
 .S LRX=0 F  S LRX=$O(^LR(LRDFN,84,LRX)) Q:'LRX  D
"RTN","LRAPR1",21,0)
 ..S LRIENS=LRX_","_LRDFN_","
"RTN","LRAPR1",22,0)
 ..S LRSRFL=$$GET1^DIQ(LRFILE,LRIENS,.02,"I")
"RTN","LRAPR1",23,0)
 ..;LRSRMD- if flag is true, supp rpt has been modified, needs release
"RTN","LRAPR1",24,0)
 ..S LRSRMD=$$GET1^DIQ(LRFILE,LRIENS,.03,"I")
"RTN","LRAPR1",25,0)
 ..Q:LRSRFL&('LRSRMD)
"RTN","LRAPR1",26,0)
 ..S DIC("B")=$$GET1^DIQ(LRFILE,LRIENS,.01,"I")
"RTN","LRAPR1",27,0)
 I $G(DIC("B")) S LRQT=1
"RTN","LRAPR1",28,0)
 Q
"RTN","LRAPR1",29,0)
CHKSUP ;Check for unreleased supp reports for E-sign switch OFF
"RTN","LRAPR1",30,0)
 N LRQT,LRZ11,LRZ15,LRIENS3
"RTN","LRAPR1",31,0)
 S (LRQT,LRZ11,LRZ15)=0
"RTN","LRAPR1",32,0)
 D RELCHK
"RTN","LRAPR1",33,0)
 I LRQT D  Q
"RTN","LRAPR1",34,0)
 .W !!,"All supp repts must be released before main report can be released."
"RTN","LRAPR1",35,0)
 I 'LRQT D
"RTN","LRAPR1",36,0)
 .K LRFDA
"RTN","LRAPR1",37,0)
 .D NOW^%DTC S LRNTIME=%
"RTN","LRAPR1",38,0)
 .I 'LRAU D
"RTN","LRAPR1",39,0)
 ..S LRZ15=$P($G(^LR(LRDFN,LRSS,LRI,0)),"^",15)
"RTN","LRAPR1",40,0)
 ..S LRZ11=$P($G(^LR(LRDFN,LRSS,LRI,0)),"^",11)
"RTN","LRAPR1",41,0)
 ..S LRIENS3=LRI_","_LRDFN_","
"RTN","LRAPR1",42,0)
 ..S LRFDA(LRSF,LRIENS3,.11)=LRNTIME
"RTN","LRAPR1",43,0)
 ..S LRFDA(LRSF,LRIENS3,.13)=DUZ
"RTN","LRAPR1",44,0)
 ..I 'LRZ15 S LRFDA(LRSF,LRIENS3,.15)=LRZ11
"RTN","LRAPR1",45,0)
 .I LRAU D
"RTN","LRAPR1",46,0)
 ..S LRIENS3=LRDFN_","
"RTN","LRAPR1",47,0)
 ..S LRFDA(63,LRIENS3,14.7)=LRNTIME
"RTN","LRAPR1",48,0)
 ..S LRFDA(63,LRIENS3,14.8)=DUZ
"RTN","LRAPR1",49,0)
 .;S LRSRMD=$$GET1^DIQ(LRFILE,LRIENS,.03,"I")
"RTN","LRAPR1",50,0)
 .;If MODIFY SUPP REPORT flag is set, remove it at this point
"RTN","LRAPR1",51,0)
 .;I LRSRMD S LRFDA(LRSF,LRIENS,.03)="@"
"RTN","LRAPR1",52,0)
 .D FILE^DIE("","LRFDA")
"RTN","LRAPR1",53,0)
 .W !!,"*** Main Report Has Been Released ***",!
"RTN","LRAPR1",54,0)
 Q
"RTN","LRAPR1",55,0)
UNRLSE ;Must unrelease at this point in order to successfully release
"RTN","LRAPR1",56,0)
 ;  below
"RTN","LRAPR1",57,0)
 K LRFDA
"RTN","LRAPR1",58,0)
 N LRREL,LRIENS3
"RTN","LRAPR1",59,0)
 D RELEASE^LRAPUTL(.LRREL,LRDFN,LRSS,$G(LRI))
"RTN","LRAPR1",60,0)
 I 'LRAU D
"RTN","LRAPR1",61,0)
 .S LRIENS3=LRI_","_LRDFN_","
"RTN","LRAPR1",62,0)
 .I '$G(LRREL(3)) S LRFDA(LRSF,LRIENS3,.15)=LRREL(1)
"RTN","LRAPR1",63,0)
 .S LRFDA(LRSF,LRIENS3,.11)="@"
"RTN","LRAPR1",64,0)
 .S LRFDA(LRSF,LRIENS3,.13)="@"
"RTN","LRAPR1",65,0)
 I LRAU D
"RTN","LRAPR1",66,0)
 .S LRZ(2)="" ;Must null this in order to prevent unrelease
"RTN","LRAPR1",67,0)
 .S LRFDA(63,LRDFN,14.7)="@"
"RTN","LRAPR1",68,0)
 .S LRFDA(63,LRDFN,14.8)="@"
"RTN","LRAPR1",69,0)
 D FILE^DIE("","LRFDA")
"RTN","LRAPR1",70,0)
 Q
"RTN","LRAPR1",71,0)
SUPCHK  ;Check Supplementary Reports
"RTN","LRAPR1",72,0)
 N LRSR,LRSR1,LRSR2,LRFILE,LRIENS,LRIENS1
"RTN","LRAPR1",73,0)
 S LRSR=0,LRSR1=1
"RTN","LRAPR1",74,0)
 I LRSS'="AU" D
"RTN","LRAPR1",75,0)
 .Q:'+$P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),U,4)
"RTN","LRAPR1",76,0)
 .S LRFILE=+$$GET1^DID(LRSF,1.2,"","SPECIFIER")
"RTN","LRAPR1",77,0)
 .S LRIENS1=LRI_","_LRDFN_","
"RTN","LRAPR1",78,0)
 .F  S LRSR=$O(^LR(LRDFN,LRSS,LRI,1.2,LRSR)) Q:LRSR'>0!('LRSR1)  D
"RTN","LRAPR1",79,0)
 ..S LRIENS=LRSR_","_LRIENS1
"RTN","LRAPR1",80,0)
 ..S LRSR1=+$$GET1^DIQ(LRFILE,LRIENS,.02,"I")
"RTN","LRAPR1",81,0)
 ..I 'LRSR1 S LRSR2=$$GET1^DIQ(LRFILE,LRIENS,.01)
"RTN","LRAPR1",82,0)
 I LRSS="AU" D
"RTN","LRAPR1",83,0)
 .Q:'+$P($G(^LR(LRDFN,84,0)),U,4)
"RTN","LRAPR1",84,0)
 .S LRFILE=63.324,LRIENS1=LRDFN_","
"RTN","LRAPR1",85,0)
 .F  S LRSR=$O(^LR(LRDFN,84,LRSR)) Q:LRSR'>0!('LRSR1)  D
"RTN","LRAPR1",86,0)
 ..S LRIENS=LRSR_","_LRIENS1
"RTN","LRAPR1",87,0)
 ..S LRSR1=+$$GET1^DIQ(LRFILE,LRIENS,.02,"I")
"RTN","LRAPR1",88,0)
 ..I 'LRSR1 S LRSR2=$$GET1^DIQ(LRFILE,LRIENS,.01)
"RTN","LRAPR1",89,0)
 I 'LRSR1 D
"RTN","LRAPR1",90,0)
 .S LRMSG="Supplementary report "_LRSR2_" has not been released.  "
"RTN","LRAPR1",91,0)
 .S LRMSG=LRMSG_"Cannot release."
"RTN","LRAPR1",92,0)
 .D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPR1",93,0)
 .S LRQUIT=1
"RTN","LRAPR1",94,0)
 Q
"RTN","LRAPR1",95,0)
CKSIGNR ;Update supp report with Releaser ID and Date/time
"RTN","LRAPR1",96,0)
 N LRIEN2,LRFLE,LRFL3
"RTN","LRAPR1",97,0)
 S LRQT2=0
"RTN","LRAPR1",98,0)
 I LRSS'="AU" D
"RTN","LRAPR1",99,0)
 .S (A,B)=0 F  S A=$O(^LR(LRDFN,LRSS,LRI,1.2,LRDA,2,A)) Q:'A  D
"RTN","LRAPR1",100,0)
 ..S B=A
"RTN","LRAPR1",101,0)
 .I '$D(^LR(LRDFN,LRSS,LRI,1.2,LRDA,2,B,0)) S LRQT2=1 Q
"RTN","LRAPR1",102,0)
 .S LRIEN2=B_","_LRDA_","_LRI_","_LRDFN_","
"RTN","LRAPR1",103,0)
 .S LRFLE=$S(LRSS="SP":63.8172,LRSS="CY":63.9072,LRSS="EM":63.2072,1:"")
"RTN","LRAPR1",104,0)
 .S LRFL3=$S(LRSS="SP":63.817,LRSS="CY":63.907,LRSS="EM":63.207,1:"")
"RTN","LRAPR1",105,0)
 I LRSS="AU" D
"RTN","LRAPR1",106,0)
 .S (A,B)=0 F  S A=$O(^LR(LRDFN,84,LRDA,2,A)) Q:'A  D
"RTN","LRAPR1",107,0)
 ..S B=A
"RTN","LRAPR1",108,0)
 .I '$D(^LR(LRDFN,84,LRDA,2,B,0)) S LRQT2=1 Q
"RTN","LRAPR1",109,0)
 .S LRIEN2=B_","_LRDA_","_LRDFN_","
"RTN","LRAPR1",110,0)
 .S LRFLE=$S(LRSS="AU":63.3242,1:"")
"RTN","LRAPR1",111,0)
 .S LRFL3=$S(LRSS="AU":63.324,1:"")
"RTN","LRAPR1",112,0)
 Q:LRQT2
"RTN","LRAPR1",113,0)
 S LRFDA(LRFLE,LRIEN2,.03)=DUZ
"RTN","LRAPR1",114,0)
 D NOW^%DTC
"RTN","LRAPR1",115,0)
 S LRFDA(LRFLE,LRIEN2,.04)=%
"RTN","LRAPR1",116,0)
 ;Must remove supp report modified flag once supp rpt is released
"RTN","LRAPR1",117,0)
 S LRFDA(LRFL3,LRIENS,.03)="@"
"RTN","LRAPR1",118,0)
 ;Set, but don't file unless unrelease required
"RTN","LRAPR1",119,0)
 S LRFDA2(LRFLE,LRIEN2,.03)="@"
"RTN","LRAPR1",120,0)
 S LRFDA2(LRFLE,LRIEN2,.04)="@"
"RTN","LRAPR1",121,0)
 Q
"RTN","LRAPRES")
0^8^B94733481^B103360947
"RTN","LRAPRES",1,0)
LRAPRES ;DALOI/WTY/KLL- AP ESIG RELEASE REPORT;10/30/01
"RTN","LRAPRES",2,0)
 ;;5.2;LAB SERVICE;**259,295,317**;Sep 27, 1994
"RTN","LRAPRES",3,0)
 ;
"RTN","LRAPRES",4,0)
 ;Reference to NEW^TIUPNAPI supported by IA #1911
"RTN","LRAPRES",5,0)
MAIN ;
"RTN","LRAPRES",6,0)
 N LRMSG,LRDEM,LREND,LRQUIT,LRNTIME,LRPRCLSS,LRVCDE,LRMTCH
"RTN","LRAPRES",7,0)
 N LRPCEXP,LRESCPT,LRPCSTR
"RTN","LRAPRES",8,0)
 S LRESCPT=0
"RTN","LRAPRES",9,0)
 D TITLE
"RTN","LRAPRES",10,0)
 I LRQUIT D END Q
"RTN","LRAPRES",11,0)
 D CPTCHK
"RTN","LRAPRES",12,0)
 F  D  Q:LRQUIT
"RTN","LRAPRES",13,0)
 .S LRQUIT=0
"RTN","LRAPRES",14,0)
 .D MENU
"RTN","LRAPRES",15,0)
 .Q:LRQUIT
"RTN","LRAPRES",16,0)
 .D SECTION
"RTN","LRAPRES",17,0)
 .Q:LRQUIT
"RTN","LRAPRES",18,0)
 .S LREND=0
"RTN","LRAPRES",19,0)
 .I LRSEL="E" S LREND=0 D CLSSCHK^LRAPRES1(DUZ,.LREND)
"RTN","LRAPRES",20,0)
 .Q:LREND
"RTN","LRAPRES",21,0)
 .D ACCYR
"RTN","LRAPRES",22,0)
 .Q:LRQUIT
"RTN","LRAPRES",23,0)
 .D ACCPN
"RTN","LRAPRES",24,0)
 D END
"RTN","LRAPRES",25,0)
 Q
"RTN","LRAPRES",26,0)
ACCPN ;Prompt for accesion number or patient name
"RTN","LRAPRES",27,0)
 F  D  Q:LREND
"RTN","LRAPRES",28,0)
 .S (LRQUIT,LREND)=0
"RTN","LRAPRES",29,0)
 .D CPTCHK
"RTN","LRAPRES",30,0)
 .D LOOKUP^LRAPUTL(.LRDATA,LRH(0),LRO(68),LRSS,LRAD,LRAA)
"RTN","LRAPRES",31,0)
 .Q:'LRDATA
"RTN","LRAPRES",32,0)
 .I LRDATA=-1 S LREND=1 Q
"RTN","LRAPRES",33,0)
 .S LRDFN=LRDATA,LRI=LRDATA(1)
"RTN","LRAPRES",34,0)
 .S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPRES",35,0)
 .I LRSEL="E" D  Q:LRQUIT
"RTN","LRAPRES",36,0)
 ..D RELCHK
"RTN","LRAPRES",37,0)
 ..Q:LRQUIT
"RTN","LRAPRES",38,0)
 ..D:'LRZ(2) BROWSE
"RTN","LRAPRES",39,0)
 ..D ESIG
"RTN","LRAPRES",40,0)
 ..Q:LRQUIT
"RTN","LRAPRES",41,0)
 ..D NOW^%DTC S LRNTIME=%
"RTN","LRAPRES",42,0)
 ..I 'LRZ(2) D TIUPREP,STORE
"RTN","LRAPRES",43,0)
 ..Q:LRQUIT
"RTN","LRAPRES",44,0)
 ..D RELEASE
"RTN","LRAPRES",45,0)
 ..Q:LRQUIT
"RTN","LRAPRES",46,0)
 ..D:'LRZ(2) MAIN^LRAPRES1(LRDFN,LRSS,LRI,LRSF,LRP,LRAC)
"RTN","LRAPRES",47,0)
 ..D OERR^LR7OB63D
"RTN","LRAPRES",48,0)
 .I LRSEL="C" D
"RTN","LRAPRES",49,0)
 ..Q:$T(CPT^LRCAPES)=""
"RTN","LRAPRES",50,0)
 ..S LRPRO=DUZ
"RTN","LRAPRES",51,0)
 ..D PROVIDR^LRAPUTL
"RTN","LRAPRES",52,0)
 ..Q:LRQUIT
"RTN","LRAPRES",53,0)
 ..D CPT^LRCAPES(LRAA,LRAD,LRAN,LRPRO)
"RTN","LRAPRES",54,0)
 .I LRSEL="V" D
"RTN","LRAPRES",55,0)
 ..D DEMARR
"RTN","LRAPRES",56,0)
 ..D INIT^LRAPSNMD(LRDFN,LRSS,LRI,LRSF,LRAA,LRAN,LRAD,.LRDEM,1)
"RTN","LRAPRES",57,0)
 Q
"RTN","LRAPRES",58,0)
TITLE ;Title
"RTN","LRAPRES",59,0)
 S LRQUIT=0
"RTN","LRAPRES",60,0)
 D CK^LRAP
"RTN","LRAPRES",61,0)
 I Y=-1 S LRQUIT=1 Q
"RTN","LRAPRES",62,0)
 W @IOF
"RTN","LRAPRES",63,0)
 S LRTEXT="Release/Electronically Sign Pathology Reports"
"RTN","LRAPRES",64,0)
 S LRMSG(1)=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPRES",65,0)
 S LRMSG(1,"F")="!!"
"RTN","LRAPRES",66,0)
 S LRMSG(2)="",LRMSG(2,"F")="!"
"RTN","LRAPRES",67,0)
 D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPRES",68,0)
 Q
"RTN","LRAPRES",69,0)
CPTCHK ;Determine if CPT is activated
"RTN","LRAPRES",70,0)
 Q:$T(ES^LRCAPES)=""
"RTN","LRAPRES",71,0)
 S LRESCPT=$$ES^LRCAPES()
"RTN","LRAPRES",72,0)
 Q
"RTN","LRAPRES",73,0)
DEMARR ;
"RTN","LRAPRES",74,0)
 I LRAU D
"RTN","LRAPRES",75,0)
 .S LRPRO=$$GET1^DIQ(63,LRDFN_",",13.5,"I")
"RTN","LRAPRES",76,0)
 .S LRPRO(1)=$$GET1^DIQ(63,LRDFN_",",13.5)
"RTN","LRAPRES",77,0)
 I 'LRAU D
"RTN","LRAPRES",78,0)
 .S LRPRO=$$GET1^DIQ(LRSF,LRI_","_LRDFN_",",.07,"I")
"RTN","LRAPRES",79,0)
 .S LRPRO(1)=$$GET1^DIQ(LRSF,LRI_","_LRDFN_",",.07)
"RTN","LRAPRES",80,0)
 S LRDEM("SEX")=SEX,LRDEM("DOB")=DOB
"RTN","LRAPRES",81,0)
 S LRDEM("AGE")=AGE
"RTN","LRAPRES",82,0)
 S LRDEM("SEC")=LRAA(1),LRDEM("PNM")=PNM
"RTN","LRAPRES",83,0)
 S LRDEM("SSN")=SSN,LRDEM("PRO")=LRPRO(1)
"RTN","LRAPRES",84,0)
 I LRAU D
"RTN","LRAPRES",85,0)
 .S LRDEM("DTH")=$P(VADM(6),"^",2)
"RTN","LRAPRES",86,0)
 .S LRDEM("AUDT")=$$GET1^DIQ(63,LRDFN_",",11)
"RTN","LRAPRES",87,0)
 .S LRDEM("AUTYP")=$$GET1^DIQ(63,LRDFN_",",13.7)
"RTN","LRAPRES",88,0)
 Q
"RTN","LRAPRES",89,0)
MENU ;
"RTN","LRAPRES",90,0)
 N DIR,X,Y
"RTN","LRAPRES",91,0)
 S DIR(0)="S^"
"RTN","LRAPRES",92,0)
 S:LRESCPT DIR(0)=DIR(0)_"C:CPT Coding;"
"RTN","LRAPRES",93,0)
 S DIR(0)=DIR(0)_"E:Electronically Sign Reports;V:View SNOMED Codes"
"RTN","LRAPRES",94,0)
 S DIR("A")="Selection"
"RTN","LRAPRES",95,0)
 D ^DIR
"RTN","LRAPRES",96,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) S LRQUIT=1 Q
"RTN","LRAPRES",97,0)
 S LRSEL=Y
"RTN","LRAPRES",98,0)
 Q
"RTN","LRAPRES",99,0)
SECTION ;Choose Anatomic Pathology section (AU,SP,CY,EM)
"RTN","LRAPRES",100,0)
 W !
"RTN","LRAPRES",101,0)
 D ^LRAP
"RTN","LRAPRES",102,0)
 I '$D(Y)!('$D(LRSS)) S LRQUIT=1 Q
"RTN","LRAPRES",103,0)
 S:LRO(68)="EM" LRO(68)="ELECTRON MICROSCOPY"
"RTN","LRAPRES",104,0)
 S LRAU=0            ; LRAU = 0 - Not Autopsy
"RTN","LRAPRES",105,0)
 S:LRSS="AU" LRAU=1  ;      = 1 - Autosy
"RTN","LRAPRES",106,0)
 I LRCAPA D  Q:LRQUIT
"RTN","LRAPRES",107,0)
 .S X=""
"RTN","LRAPRES",108,0)
 .S:LRSS="CY" X="CYTOLOGY REPORTING"
"RTN","LRAPRES",109,0)
 .S:LRSS="SP" X="SURGICAL PATH REPORTING"
"RTN","LRAPRES",110,0)
 .D:X'="" X^LRUWK
"RTN","LRAPRES",111,0)
 .S:'$D(X) LRQUIT=1
"RTN","LRAPRES",112,0)
 ;
"RTN","LRAPRES",113,0)
 S LRSOP="Z"
"RTN","LRAPRES",114,0)
 S LRMSG(1)=LRO(68)_" ("_LRABV_")",LRMSG(1,"F")="!?20"
"RTN","LRAPRES",115,0)
 S LRMSG(2)="",LRMSG(2,"F")="!"
"RTN","LRAPRES",116,0)
 D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPRES",117,0)
 Q
"RTN","LRAPRES",118,0)
ACCYR ;Determine Accession Year
"RTN","LRAPRES",119,0)
 D ACCYR^LRAPUTL(.LRAD1,LRH(0),LRAA,LRO(68))
"RTN","LRAPRES",120,0)
 I LRAD1=-1 S LRQUIT=1 Q
"RTN","LRAPRES",121,0)
 I LRAD1 S LRAD=$P(LRAD1,U),LRH(0)=$P(LRAD1,U,2)
"RTN","LRAPRES",122,0)
 Q
"RTN","LRAPRES",123,0)
RELCHK ;Perform series of checks
"RTN","LRAPRES",124,0)
 N LRPAT,LRSRLST,LRSRREL
"RTN","LRAPRES",125,0)
 S LRQUIT=0
"RTN","LRAPRES",126,0)
 I 'LRAU D  Q:LRQUIT
"RTN","LRAPRES",127,0)
 .S LRPAT=+$$GET1^DIQ(LRSF,LRIENS,.02,"I")
"RTN","LRAPRES",128,0)
 .S LRZ=$$GET1^DIQ(LRSF,LRIENS,.03,"I")
"RTN","LRAPRES",129,0)
 .S LRZ(1)=$$GET1^DIQ(LRSF,LRIENS,.13,"I")
"RTN","LRAPRES",130,0)
 .S LRZ(1.1)=$$GET1^DIQ(LRSF,LRIENS,.13)
"RTN","LRAPRES",131,0)
 .S LRZ(2)=$$GET1^DIQ(LRSF,LRIENS,.11,"I")
"RTN","LRAPRES",132,0)
 .I 'LRZ,'LRZ(2) D
"RTN","LRAPRES",133,0)
 ..W $C(7)
"RTN","LRAPRES",134,0)
 ..S LRMSG="No date report completed.  Cannot release."
"RTN","LRAPRES",135,0)
 ..D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",136,0)
 ..S LRQUIT=1
"RTN","LRAPRES",137,0)
 I LRAU D  Q:LRQUIT
"RTN","LRAPRES",138,0)
 .I $G(^LR(LRDFN,"AU"))="" D  Q
"RTN","LRAPRES",139,0)
 ..S LRMSG="No information found for this accession in the "
"RTN","LRAPRES",140,0)
 ..S LRMSG=LRMSG_"LAB DATA file (#63)."
"RTN","LRAPRES",141,0)
 ..D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",142,0)
 ..S LRQUIT=1
"RTN","LRAPRES",143,0)
 .S LRPAT=+$$GET1^DIQ(63,LRDFN_",",13.6,"I")
"RTN","LRAPRES",144,0)
 .S LRZ=$$GET1^DIQ(63,LRDFN_",",13,"I")
"RTN","LRAPRES",145,0)
 .S LRZ(1)=$$GET1^DIQ(63,LRDFN_",",14.8,"I")
"RTN","LRAPRES",146,0)
 .S LRZ(1.1)=$$GET1^DIQ(63,LRDFN_",",14.8)
"RTN","LRAPRES",147,0)
 .S LRZ(2)=$$GET1^DIQ(63,LRDFN_",",14.7,"I")
"RTN","LRAPRES",148,0)
 .;KLL-CHECK FOR PROVISIONAL DATE OR DATE REPORT COMPLETED
"RTN","LRAPRES",149,0)
 .S LRZ(3)=$$GET1^DIQ(63,LRDFN_",",14.9,"I")
"RTN","LRAPRES",150,0)
 .I 'LRZ,'LRZ(3) D
"RTN","LRAPRES",151,0)
 ..W $C(7)
"RTN","LRAPRES",152,0)
 ..S LRMSG="Provisional or date report completed required.  Cannot release."
"RTN","LRAPRES",153,0)
 ..D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",154,0)
 ..S LRQUIT=1
"RTN","LRAPRES",155,0)
 I 'LRPAT,'LRZ(2) D
"RTN","LRAPRES",156,0)
 .W $C(7)
"RTN","LRAPRES",157,0)
 .S LRMSG="Pathologist or Cytotechnologist entry missing. Cannot release."
"RTN","LRAPRES",158,0)
 .D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",159,0)
 .S LRQUIT=1
"RTN","LRAPRES",160,0)
 D:'LRZ(2) SUPCHK^LRAPR1
"RTN","LRAPRES",161,0)
 Q:LRQUIT
"RTN","LRAPRES",162,0)
 I LRZ(2) D  Q:LRQUIT
"RTN","LRAPRES",163,0)
 .W $C(7)
"RTN","LRAPRES",164,0)
 .S LRMSG="Report " S:LRZ(2)=1 LRMSG=LRMSG_"has already been "
"RTN","LRAPRES",165,0)
 .S LRMSG=LRMSG_"released "
"RTN","LRAPRES",166,0)
 .S Y=LRZ(2) D DD^%DT S:LRZ(2)>1 LRMSG=LRMSG_Y
"RTN","LRAPRES",167,0)
 .S:LRZ(1)'="" LRMSG=LRMSG_" by "_LRZ(1.1)
"RTN","LRAPRES",168,0)
 .D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",169,0)
 .S:'LRAU LRQUIT=1
"RTN","LRAPRES",170,0)
 ;KLL-DON'T ALLOW UNRELEASE IF REPT COMPLETED DATE EXISTS FOR AU 
"RTN","LRAPRES",171,0)
 I LRZ(2),LRZ S LRQUIT=1
"RTN","LRAPRES",172,0)
 S LRMSG="" D EN^DDIOL(LRMSG,"","!") K LRMSG
"RTN","LRAPRES",173,0)
 ;Don't allow unrelease if supp report not released for AU
"RTN","LRAPRES",174,0)
 I LRZ(2),'LRZ D
"RTN","LRAPRES",175,0)
 .S LRSRLST=$P($G(^LR(LRDFN,84,0)),"^",4)
"RTN","LRAPRES",176,0)
 .Q:'LRSRLST
"RTN","LRAPRES",177,0)
 .S LRSRREL=$P($G(^LR(LRDFN,84,LRSRLST,0)),"^",2)
"RTN","LRAPRES",178,0)
 .I 'LRSRREL D
"RTN","LRAPRES",179,0)
 ..S LRMSG=$C(7)_"Supplementary report has not been released. "
"RTN","LRAPRES",180,0)
 ..S LRMSG=LRMSG_"Cannot use this option."
"RTN","LRAPRES",181,0)
 ..D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",182,0)
 ..S LRQUIT=1
"RTN","LRAPRES",183,0)
 Q:LRQUIT
"RTN","LRAPRES",184,0)
 I LRZ(2),'LRZ D
"RTN","LRAPRES",185,0)
 .S DIR(0)="YA",DIR("B")="NO"
"RTN","LRAPRES",186,0)
 .S DIR("A")="Unrelease report? "
"RTN","LRAPRES",187,0)
 .D ^DIR
"RTN","LRAPRES",188,0)
 .I 'Y S LRQUIT=1
"RTN","LRAPRES",189,0)
 Q
"RTN","LRAPRES",190,0)
BROWSE ;Display the report in the browser
"RTN","LRAPRES",191,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","LRAPRES",192,0)
 S DIR("A")="View the report before signing? "
"RTN","LRAPRES",193,0)
 D ^DIR Q:'Y
"RTN","LRAPRES",194,0)
 K ^TMP("LRAPBR",$J)
"RTN","LRAPRES",195,0)
 S LRMSG="*** Report is being processed.  One moment please. ***"
"RTN","LRAPRES",196,0)
 S LRMSG=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPRES",197,0)
 D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES",198,0)
 D INIT^LRAPBR(LRAA,LRSS,LRI,LRDFN,LRO(68),LRAU,0)
"RTN","LRAPRES",199,0)
 Q
"RTN","LRAPRES",200,0)
ESIG ;Prompt for electronic signature
"RTN","LRAPRES",201,0)
 S LRQUIT=0
"RTN","LRAPRES",202,0)
 D SIG^XUSESIG
"RTN","LRAPRES",203,0)
 I X1="" D  Q
"RTN","LRAPRES",204,0)
 .W "  SIGNATURE NOT VERIFIED"
"RTN","LRAPRES",205,0)
 .S LRQUIT=1
"RTN","LRAPRES",206,0)
 Q
"RTN","LRAPRES",207,0)
TIUPREP ;
"RTN","LRAPRES",208,0)
 K ^TMP("TIUP",$J)
"RTN","LRAPRES",209,0)
 S LRMSG="*** Report is being processed"
"RTN","LRAPRES",210,0)
 ;Exclude patient files 67, 67.1, 67.2, 67.3, 62.3 from TIU storage
"RTN","LRAPRES",211,0)
 I LRDPF'=62.3,LRDPF'[67 S LRMSG=LRMSG_" for storage in TIU"
"RTN","LRAPRES",212,0)
 S LRMSG=LRMSG_".  One moment please. ***"
"RTN","LRAPRES",213,0)
 S LRMSG=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPRES",214,0)
 D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES",215,0)
 D INIT^LRAPBR(LRAA,LRSS,LRI,LRDFN,LRO(68),LRAU,1,LRNTIME)
"RTN","LRAPRES",216,0)
 Q
"RTN","LRAPRES",217,0)
RELEASE ;
"RTN","LRAPRES",218,0)
 I 'LRAU D
"RTN","LRAPRES",219,0)
 .S LRRC=$$GET1^DIQ(LRSF,LRIENS,.1,"I")
"RTN","LRAPRES",220,0)
 .I LRCAPA,'LRAU D C^LRAPSWK
"RTN","LRAPRES",221,0)
 .S DR=".11////^S X=LRNTIME;.13////^S X=DUZ"
"RTN","LRAPRES",222,0)
 .S DIE="^LR(LRDFN,LRSS,",DA=LRI,DA(1)=LRDFN
"RTN","LRAPRES",223,0)
 .;KLL-Set LRA for xref call to LRWOMEN
"RTN","LRAPRES",224,0)
 .S LRA=^LR(LRDFN,LRSS,LRI,0)
"RTN","LRAPRES",225,0)
 I LRAU D
"RTN","LRAPRES",226,0)
 .S DR="14.7////^S X=$S(LRZ(2):""@"",1:LRNTIME);"
"RTN","LRAPRES",227,0)
 .S DR=DR_"14.8////^S X=$S(LRZ(2):""@"",1:DUZ);"
"RTN","LRAPRES",228,0)
 .S DIE="^LR(",DA=LRDFN
"RTN","LRAPRES",229,0)
 D CK^LRU
"RTN","LRAPRES",230,0)
 Q:$D(LR("CK"))
"RTN","LRAPRES",231,0)
 D ^DIE
"RTN","LRAPRES",232,0)
 D UPDATE^LRPXRM(LRDFN,$G(LRSS,"AU"),$G(LRI))
"RTN","LRAPRES",233,0)
 D FRE^LRU
"RTN","LRAPRES",234,0)
 S LRMSG="*** Report "
"RTN","LRAPRES",235,0)
 I LRZ(2),LRAU S LRMSG=LRMSG_"un"
"RTN","LRAPRES",236,0)
 S LRMSG=LRMSG_"released. ***"
"RTN","LRAPRES",237,0)
 D EN^DDIOL($$CJ^XLFSTR(LRMSG,IOM),"","!!") K MSG
"RTN","LRAPRES",238,0)
 I "CYSP"[LRSS,LRCAPA D WKLD Q
"RTN","LRAPRES",239,0)
 ;I LRCAPA,"SPCYEM"[LRSS,LRD(1)'="","MBA"[LRD(1) D C1^LRAPSWK
"RTN","LRAPRES",240,0)
 Q
"RTN","LRAPRES",241,0)
STORE ;Store report in TIU
"RTN","LRAPRES",242,0)
 N LRTITLE,LRIENS,LRFILE,LRFDA,LRTIUPTR
"RTN","LRAPRES",243,0)
 ;Display informational message if referral patient
"RTN","LRAPRES",244,0)
 I LRDPF=62.3!(LRDPF[67) D REFRRL^LRAPUTL  Q
"RTN","LRAPRES",245,0)
 ;KLL-EDIT ADDED FOR MULTIDIVISIONAL LABS,TRANSLATE LRSS TO CORRECT
"RTN","LRAPRES",246,0)
 ;    NAME TO ENSURE SUCCESSFUL MATCH IN TIU(8925.1)
"RTN","LRAPRES",247,0)
 S:LRSS="SP" LRO68="SURGICAL PATHOLOGY"
"RTN","LRAPRES",248,0)
 S:LRSS="CY" LRO68="CYTOPATHOLOGY"
"RTN","LRAPRES",249,0)
 S:LRSS="EM" LRO68="ELECTRON MICROSCOPY"
"RTN","LRAPRES",250,0)
 S:LRSS="AU" LRO68="AUTOPSY"
"RTN","LRAPRES",251,0)
 S LRTITLE=$$FIND1^DIC(8925.1,,"O","LR "_LRO68_" REPORT")
"RTN","LRAPRES",252,0)
 D NEW^TIUPNAPI(.LRTIUPTR,DFN,DUZ,LRNTIME,LRTITLE,,,,DUZ)
"RTN","LRAPRES",253,0)
 I +LRTIUPTR=-1 D  Q
"RTN","LRAPRES",254,0)
 .S LRMSG="*** Report storage in TIU failed. ***"
"RTN","LRAPRES",255,0)
 .S LRMSG=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPRES",256,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES",257,0)
 .S LRQUIT=1
"RTN","LRAPRES",258,0)
 S LRMSG="*** Report storage in TIU is complete. ***"
"RTN","LRAPRES",259,0)
 S LRMSG=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPRES",260,0)
 D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES",261,0)
 ;KLL-Calculate checksum of TIU report text 
"RTN","LRAPRES",262,0)
 S LRVAL="^TIU(8925,"_+LRTIUPTR_",""TEXT"")"
"RTN","LRAPRES",263,0)
 S LRCHKSUM=$$CHKSUM^XUSESIG1(LRVAL)
"RTN","LRAPRES",264,0)
 ;Store pointer & checksum information in the LAB DATA (#63) file
"RTN","LRAPRES",265,0)
 S LRIENS="+1,"_$S('LRAU:LRI_",",1:"")_LRDFN_","
"RTN","LRAPRES",266,0)
 S LRFILE=$S(LRSS="SP":63.19,LRSS="CY":63.47,LRSS="EM":63.49,1:"")
"RTN","LRAPRES",267,0)
 S:LRFILE="" LRFILE=$S(LRSS="AU":63.101,1:"")
"RTN","LRAPRES",268,0)
 S LRFDA(1,LRFILE,LRIENS,.01)=LRNTIME
"RTN","LRAPRES",269,0)
 S LRFDA(1,LRFILE,LRIENS,1)=+LRTIUPTR
"RTN","LRAPRES",270,0)
 S LRFDA(1,LRFILE,LRIENS,2)=LRCHKSUM
"RTN","LRAPRES",271,0)
 D UPDATE^DIE("","LRFDA(1)")
"RTN","LRAPRES",272,0)
 D RETRACT^LRAPRES1(LRDFN,LRSS,LRI,+LRTIUPTR)
"RTN","LRAPRES",273,0)
 Q
"RTN","LRAPRES",274,0)
WKLD ;Capture workload
"RTN","LRAPRES",275,0)
 K LRFDA,ERR,IENS,OROUT,ORIEN
"RTN","LRAPRES",276,0)
 S LRK=$P(^LR(LRDFN,LRSS,LRI,0),"^",11) Q:'LRK
"RTN","LRAPRES",277,0)
 Q:$D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,0))
"RTN","LRAPRES",278,0)
 S RNUM=1
"RTN","LRAPRES",279,0)
 S IENS="+"_RNUM_","_LRAN_","_LRAD_","_LRAA_","
"RTN","LRAPRES",280,0)
 S FILE=68.04,ORIEN(1)=LRT
"RTN","LRAPRES",281,0)
 S LRFDA(1,FILE,IENS,.01)=LRT
"RTN","LRAPRES",282,0)
 S LRFDA(1,FILE,IENS,1)=50
"RTN","LRAPRES",283,0)
 S LRFDA(1,FILE,IENS,3)=DUZ
"RTN","LRAPRES",284,0)
 S LRFDA(1,FILE,IENS,4)=LRK
"RTN","LRAPRES",285,0)
 S FILE1=68.14
"RTN","LRAPRES",286,0)
 S C=0 F  S C=$O(LRT(C)) Q:'C  D
"RTN","LRAPRES",287,0)
 .S RNUM=RNUM+1
"RTN","LRAPRES",288,0)
 .S ORIEN(RNUM)=C
"RTN","LRAPRES",289,0)
 .S IENS1="+"_RNUM_","_IENS
"RTN","LRAPRES",290,0)
 .S LRFDA(1,FILE1,IENS1,.01)=C
"RTN","LRAPRES",291,0)
 .S LRFDA(1,FILE1,IENS1,.02)=1
"RTN","LRAPRES",292,0)
 .S LRFDA(1,FILE1,IENS1,.03)=0
"RTN","LRAPRES",293,0)
 .S LRFDA(1,FILE1,IENS1,.04)=0
"RTN","LRAPRES",294,0)
 .S LRFDA(1,FILE1,IENS1,1)=LRK
"RTN","LRAPRES",295,0)
 .S LRFDA(1,FILE1,IENS1,2)=DUZ
"RTN","LRAPRES",296,0)
 .S LRFDA(1,FILE1,IENS1,3)=DUZ(2)
"RTN","LRAPRES",297,0)
 .S LRFDA(1,FILE1,IENS1,4)=LRAA
"RTN","LRAPRES",298,0)
 .S LRFDA(1,FILE1,IENS1,5)=LRAA
"RTN","LRAPRES",299,0)
 .S LRFDA(1,FILE1,IENS1,6)=LRAA
"RTN","LRAPRES",300,0)
 D UPDATE^DIE("","LRFDA(1)","ORIEN","OROUT")
"RTN","LRAPRES",301,0)
 Q
"RTN","LRAPRES",302,0)
END ;Clean-up variables and quit
"RTN","LRAPRES",303,0)
 K LRAD1,LRDATA,LRAU,LRRDTE,LRTEXT,LRSEL,LRFILE,LRIENS,LRIENS1
"RTN","LRAPRES",304,0)
 K LRFDA,ERR,IENS,OROUT,ORIEN,LRTMP
"RTN","LRAPRES",305,0)
 K ^TMP("LRAPBR",$J),^TMP("TIUP",$J)
"RTN","LRAPRES",306,0)
 D:$T(CLEAN^LRCAPES)'="" CLEAN^LRCAPES
"RTN","LRAPRES",307,0)
 D V^LRU
"RTN","LRAPRES",308,0)
 Q
"RTN","LRAPV")
0^16^B15077938^B13932043
"RTN","LRAPV",1,0)
LRAPV ;AVAMC/REG/WTY - ANAT PATH REPORTS NOT VERIFIED ;1/17/02
"RTN","LRAPV",2,0)
 ;;5.2;LAB SERVICE;**72,201,259,317**;Sep 27, 1994
"RTN","LRAPV",3,0)
 ;
"RTN","LRAPV",4,0)
 ;Reference to ^DIC supported by IA #916
"RTN","LRAPV",5,0)
 ;
"RTN","LRAPV",6,0)
A ;Initialize some variables
"RTN","LRAPV",7,0)
 N LRI,LRFILE,LRFILE1,LRFILE2,LRPD,LRA
"RTN","LRAPV",8,0)
 D ^LRAP G:'$D(Y) END
"RTN","LRAPV",9,0)
 S LR("AU1")=$S(LRSS="AU":1,1:0)
"RTN","LRAPV",10,0)
 S:'LR("AU1") LRFILE="^LR(LRPD,LRSS,LRI",LRFILE1=LRFILE_",1.2,"
"RTN","LRAPV",11,0)
 S:LR("AU1") LRFILE="^LR(LRPD,LRSS",LRFILE1="^LR(LRPD,84,"
"RTN","LRAPV",12,0)
ASK ;Ask which option to run
"RTN","LRAPV",13,0)
 W !!?3,"1) List of Unverified ",LRO(68)," Reports"
"RTN","LRAPV",14,0)
 W !?3,"2) List of Unverified ",LRO(68)," Supplementary Reports"
"RTN","LRAPV",15,0)
 W !?3,"3) List of ",LRO(68)," Reports Missing SNOMED Codes"
"RTN","LRAPV",16,0)
 W !!,"Select 1,2 or 3: "
"RTN","LRAPV",17,0)
 R X:DTIME
"RTN","LRAPV",18,0)
 I X=""!(X[U) D END Q
"RTN","LRAPV",19,0)
 I X'?1N!("123"'[X) D  G ASK
"RTN","LRAPV",20,0)
 .W $C(7),!!,"Enter a single numeric digit 1,2 or 3"
"RTN","LRAPV",21,0)
 ;Give date ranges
"RTN","LRAPV",22,0)
 S LRB=X D B^LRU
"RTN","LRAPV",23,0)
 I Y<0 D END Q
"RTN","LRAPV",24,0)
DEV ;Get Device Info
"RTN","LRAPV",25,0)
 W !
"RTN","LRAPV",26,0)
 S %ZIS="Q" D ^%ZIS
"RTN","LRAPV",27,0)
 I POP W ! D END Q
"RTN","LRAPV",28,0)
 I $D(IO("Q")) D  Q
"RTN","LRAPV",29,0)
 .S ZTDESC="LIST OF ACC UNVERIF,MISSING SNOMED OR CPT"
"RTN","LRAPV",30,0)
 .S ZTSAVE("LR*")="",ZTRTN="QUE^LRAPV"
"RTN","LRAPV",31,0)
 .D ^%ZTLOAD W:$D(ZTSK) !,"Request Queued, #",ZTSK W !
"RTN","LRAPV",32,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","LRAPV",33,0)
 .D END
"RTN","LRAPV",34,0)
QUE ;
"RTN","LRAPV",35,0)
 U IO W:IOST["C-" @IOF
"RTN","LRAPV",36,0)
 S LRSDT=LRSDT-.01,LRLDT=LRLDT+.99
"RTN","LRAPV",37,0)
 D XR^LRU,L^LRU,S^LRU,H S LR("F")=1
"RTN","LRAPV",38,0)
 F  S LRSDT=$O(^LR(LRXR,LRSDT)) Q:'LRSDT!(LRSDT>LRLDT)!(LR("Q"))  D Y
"RTN","LRAPV",39,0)
 D END
"RTN","LRAPV",40,0)
 Q
"RTN","LRAPV",41,0)
Y ;Get patient info
"RTN","LRAPV",42,0)
 S LRPD=0 F  S LRPD=$O(^LR(LRXR,LRSDT,LRPD)) Q:'LRPD!(LR("Q"))  D
"RTN","LRAPV",43,0)
 .S X=^LR(LRPD,0),Y=$P(X,"^",3),(LRDPF,X)=$P(X,"^",2)
"RTN","LRAPV",44,0)
 .S X=^DIC(X,0,"GL"),X=@(X_Y_",0)"),LRP=$P(X,"^"),SSN=$P(X,"^",9)
"RTN","LRAPV",45,0)
 .D SSN^LRU
"RTN","LRAPV",46,0)
 .I 'LR("AU1") D I Q
"RTN","LRAPV",47,0)
 .I LR("AU1") D SEL
"RTN","LRAPV",48,0)
 Q
"RTN","LRAPV",49,0)
I ;Order through the cross reference
"RTN","LRAPV",50,0)
 S LRI=0 F  S LRI=$O(^LR(LRXR,LRSDT,LRPD,LRI)) Q:'LRI!(LR("Q"))  D
"RTN","LRAPV",51,0)
 .D:$Y>(IOSL-6) H Q:LR("Q")
"RTN","LRAPV",52,0)
 .I $P($P($G(@(LRFILE_$S('LR("AU1"):",0)",1:")"))),"^",6)," ")'=LRABV Q
"RTN","LRAPV",53,0)
 .D SEL
"RTN","LRAPV",54,0)
 Q
"RTN","LRAPV",55,0)
SEL ;
"RTN","LRAPV",56,0)
 D:LRB=1 RPT
"RTN","LRAPV",57,0)
 D:LRB=2 SUPP
"RTN","LRAPV",58,0)
 D:LRB=3 SNO
"RTN","LRAPV",59,0)
 Q
"RTN","LRAPV",60,0)
N ;
"RTN","LRAPV",61,0)
 Q
"RTN","LRAPV",62,0)
RPT ;Unverified reports
"RTN","LRAPV",63,0)
 S X=$G(@(LRFILE_$S('LR("AU1"):",0)",1:")")))
"RTN","LRAPV",64,0)
 I $L(X),'$P(X,"^",$S('LR("AU1"):11,1:15)) D
"RTN","LRAPV",65,0)
 .S LRDATE=@(LRFILE_$S('LR("AU1"):",0)",1:")"))
"RTN","LRAPV",66,0)
 .D W
"RTN","LRAPV",67,0)
 Q
"RTN","LRAPV",68,0)
SUPP ;Unverified Supplementary Reports
"RTN","LRAPV",69,0)
 ;If RELEASE SUPPLEMENTARY REPORT is null, or if RELEASE SUPP
"RTN","LRAPV",70,0)
 ;  REPORT MODIFIED is set to 1, then supp report is unverified
"RTN","LRAPV",71,0)
 S (LRA,LRC)=0 F  S LRA=$O(@(LRFILE1_"LRA)")) Q:'LRA!(LRC)  D
"RTN","LRAPV",72,0)
 .I '$P(@(LRFILE1_"LRA,0)"),"^",2) S LRC=1
"RTN","LRAPV",73,0)
 .;Flag if released supp has been modified but not yet released
"RTN","LRAPV",74,0)
 .I 'LRC,$P(@(LRFILE1_"LRA,0)"),"^",3) S LRC=1
"RTN","LRAPV",75,0)
 I LRC D
"RTN","LRAPV",76,0)
 .S LRDATE=@(LRFILE_$S('LR("AU1"):",0)",1:")"))
"RTN","LRAPV",77,0)
 .D W
"RTN","LRAPV",78,0)
 Q
"RTN","LRAPV",79,0)
SNO ;Missing SNOMED
"RTN","LRAPV",80,0)
 S LRC=0
"RTN","LRAPV",81,0)
 S:'LR("AU1") LRFILE2=LRFILE_",2"
"RTN","LRAPV",82,0)
 S:LR("AU1") LRFILE2="^LR(LRPD,""AY"""
"RTN","LRAPV",83,0)
 I '$D(@(LRFILE2_")")) S LRC=1
"RTN","LRAPV",84,0)
 I 'LRC,'+$P($G(@(LRFILE2_",0)")),"^",4) S LRC=1
"RTN","LRAPV",85,0)
 I LRC D
"RTN","LRAPV",86,0)
 .S LRDATE=@(LRFILE_$S('LR("AU1"):",0)",1:")"))
"RTN","LRAPV",87,0)
 .D W
"RTN","LRAPV",88,0)
 Q
"RTN","LRAPV",89,0)
W ;Write the report
"RTN","LRAPV",90,0)
 W !,$$FMTE^XLFDT(LRDATE,"D"),?19,$J($P(LRDATE,"^",6),5),?32,LRP
"RTN","LRAPV",91,0)
 W ?63,SSN
"RTN","LRAPV",92,0)
 I 'LR("AU1") D
"RTN","LRAPV",93,0)
 .S LRA=0 F  S LRA=$O(^LR(LRPD,LRSS,LRI,97,LRA)) Q:'LRA!(LR("Q"))  D
"RTN","LRAPV",94,0)
 ..S B=^LR(LRPD,LRSS,LRI,97,LRA,0)
"RTN","LRAPV",95,0)
 ..D:$Y>(IOSL-6) H1 Q:LR("Q")  W !?3,B
"RTN","LRAPV",96,0)
 Q
"RTN","LRAPV",97,0)
H ;Header
"RTN","LRAPV",98,0)
 I LRQ>0,IOST?1"C-".E D  Q:LR("Q")
"RTN","LRAPV",99,0)
 .K DIR S DIR(0)="E"
"RTN","LRAPV",100,0)
 .D ^DIR W !
"RTN","LRAPV",101,0)
 .S:$D(DTOUT)!(X[U) LR("Q")=1
"RTN","LRAPV",102,0)
 W:LRQ>0 @IOF S LRQ=LRQ+1
"RTN","LRAPV",103,0)
 S X="N",%DT="T" D ^%DT,D^LRU
"RTN","LRAPV",104,0)
 W !,Y,?22,LRQ(1),?(IOM-10),"Pg: ",LRQ
"RTN","LRAPV",105,0)
 W !,LRO(68)," (",LRABV,") "
"RTN","LRAPV",106,0)
 I LRB<3 W "UNVERIFIED" W:LRB=2 " SUPPLEMENTARY" W " REPORTS"
"RTN","LRAPV",107,0)
 W:LRB=3 "REPORTS MISSING SNOMED CODING"
"RTN","LRAPV",108,0)
 W !,"BY DATE SPECIMEN TAKEN FROM ",LRSTR," TO ",LRLST
"RTN","LRAPV",109,0)
 W !,"DATE",?15,"Accession number",?32,"Patient",?66,"SSN",!,LR("%")
"RTN","LRAPV",110,0)
 Q
"RTN","LRAPV",111,0)
H1 ;
"RTN","LRAPV",112,0)
 D H Q:LR("Q")  W !?19,$J($P(LRDATE,"^",6),5),?32,LRP,?63,SSN
"RTN","LRAPV",113,0)
 Q
"RTN","LRAPV",114,0)
END ;
"RTN","LRAPV",115,0)
 W:IOST?1"P-".E @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LRAPV",116,0)
 K %,DIR,DTOUT,DUOUT,DIRUT,X,Y
"RTN","LRAPV",117,0)
 D V^LRU
"RTN","LRAPV",118,0)
 Q
"RTN","LRSPRPT")
0^15^B92562557^B88845330
"RTN","LRSPRPT",1,0)
LRSPRPT ;AVAMC/REG/WTY/KLL - CY/EM/SP PATIENT RPT ;08/22/01
"RTN","LRSPRPT",2,0)
 ;;5.2;LAB SERVICE;**1,72,248,259,317**;Sep 27, 1994
"RTN","LRSPRPT",3,0)
 ;
"RTN","LRSPRPT",4,0)
 W !!?20,LRO(68)," FINAL PATIENT REPORTS"
"RTN","LRSPRPT",5,0)
 K LRSAV,LRAP,LRS(99)
"RTN","LRSPRPT",6,0)
 D EN2^LRUA
"RTN","LRSPRPT",7,0)
 G END^LRSPRPT1:LRAPX=2,SGL:LRAPX=3,CH:LRAPX=4
"RTN","LRSPRPT",8,0)
GETP ;
"RTN","LRSPRPT",9,0)
 D EN1^LRUPS Q:LRAN=-1
"RTN","LRSPRPT",10,0)
 G:$D(^LRO(69.2,LRAA,2,LRAN,0)) GETP
"RTN","LRSPRPT",11,0)
 L +^LRO(69.2,LRAA,2):5  I '$T D  G GETP
"RTN","LRSPRPT",12,0)
 .S MSG(1)="The final reports queue is in use by another person.  "
"RTN","LRSPRPT",13,0)
 .S MSG(1,"F")="!!"
"RTN","LRSPRPT",14,0)
 .S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRSPRPT",15,0)
 .D EN^DDIOL(.MSG) K MSG
"RTN","LRSPRPT",16,0)
 S ^LRO(69.2,LRAA,2,LRAN,0)=LRDFN_"^"_LRI
"RTN","LRSPRPT",17,0)
 S X=^LRO(69.2,LRAA,2,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRSPRPT",18,0)
 L -^LRO(69.2,LRAA,2)
"RTN","LRSPRPT",19,0)
 G GETP
"RTN","LRSPRPT",20,0)
CH ;
"RTN","LRSPRPT",21,0)
 S LRAPX(1)=2 D EN^LRSPRPT2 Q:%<1
"RTN","LRSPRPT",22,0)
 W !!,"Save final report list for reprinting "
"RTN","LRSPRPT",23,0)
 S %=2 D YN^LRU S:%=1 LRSAV=1
"RTN","LRSPRPT",24,0)
 ;Variable LR("DVD") is used to divide reports displayed in the browser
"RTN","LRSPRPT",25,0)
 K LR("DVD")
"RTN","LRSPRPT",26,0)
 S $P(LR("DVD"),"|",IOM)=""
"RTN","LRSPRPT",27,0)
DEV ;from LRAPMOD
"RTN","LRSPRPT",28,0)
 W !
"RTN","LRSPRPT",29,0)
 S %ZIS="Q" D ^%ZIS
"RTN","LRSPRPT",30,0)
 I POP W ! D END Q
"RTN","LRSPRPT",31,0)
 I $D(IO("Q")) D  Q
"RTN","LRSPRPT",32,0)
 .S ZTDESC="ANAT PATH FINAL REPORT"
"RTN","LRSPRPT",33,0)
 .S ZTSAVE("LR*")="",ZTRTN="QUE^LRSPRPT"
"RTN","LRSPRPT",34,0)
 .D ^%ZTLOAD W:$D(ZTSK) !,"Request Queued, #",ZTSK W !
"RTN","LRSPRPT",35,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","LRSPRPT",36,0)
QUE ;
"RTN","LRSPRPT",37,0)
 U IO
"RTN","LRSPRPT",38,0)
 N LRFFF
"RTN","LRSPRPT",39,0)
 ;LRSF515=1 means that this is generating an SF515
"RTN","LRSPRPT",40,0)
 S:'$D(LRSF515) LRSF515=0
"RTN","LRSPRPT",41,0)
 S:'$D(LRFOC) LRFOC=0
"RTN","LRSPRPT",42,0)
 S:'$D(LRQUIT) LRQUIT=0
"RTN","LRSPRPT",43,0)
 S LRFFF=1  ;Flag used to determine whether to perform final form feed
"RTN","LRSPRPT",44,0)
 I LRFOC S LRFFF=0  ;If final office copy, don't perform final form feed
"RTN","LRSPRPT",45,0)
 S LR(.21)=+$G(^LRO(69.2,LRAA,.2)),LR("DIWF")="W"
"RTN","LRSPRPT",46,0)
 S LRA=$S($D(^LRO(69.2,LRAA,0)):$P(^(0),U,9),1:1) S:LRA="" LRA=1
"RTN","LRSPRPT",47,0)
 D L^LRU,S^LRU,L1^LRU,SET^LRUA
"RTN","LRSPRPT",48,0)
PSGL ;Single Report
"RTN","LRSPRPT",49,0)
 I $D(LRAP) D  G LST
"RTN","LRSPRPT",50,0)
 .S LRDFN=$P(LRAP,"^"),LRI=$P(LRAP,"^",2)
"RTN","LRSPRPT",51,0)
 .I +$G(LRPTR) D  Q
"RTN","LRSPRPT",52,0)
 ..D MAIN^LRAPTIUP(LRPTR,0)
"RTN","LRSPRPT",53,0)
 ..S LRFFF=0 ;Don't do final form feed.  It's done by LRAPTIUP.
"RTN","LRSPRPT",54,0)
 ..I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",55,0)
 ..K LRAP S LR("F")=1
"RTN","LRSPRPT",56,0)
 ..I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",57,0)
 ..Q:LR("Q")
"RTN","LRSPRPT",58,0)
 ..I 'LRFOC S LR("Q")=1 Q
"RTN","LRSPRPT",59,0)
 ..D FOC
"RTN","LRSPRPT",60,0)
 ..I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",61,0)
 ..I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",62,0)
 .W:IOST?1"C-".E @IOF
"RTN","LRSPRPT",63,0)
 .D EN
"RTN","LRSPRPT",64,0)
 .K LRAP
"RTN","LRSPRPT",65,0)
 .I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",66,0)
 .Q:LR("Q")
"RTN","LRSPRPT",67,0)
 .I 'LRFOC S LR("Q")=1 Q
"RTN","LRSPRPT",68,0)
 .W !
"RTN","LRSPRPT",69,0)
 .W:IOST?1"P-".E @IOF
"RTN","LRSPRPT",70,0)
 .D FOC
"RTN","LRSPRPT",71,0)
 .I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",72,0)
 .I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",73,0)
PQUE ;Report from queue
"RTN","LRSPRPT",74,0)
 S LRAN=0
"RTN","LRSPRPT",75,0)
 F  S LRAN=$O(^LRO(69.2,LRAA,2,LRAN)) Q:'LRAN!(LR("Q"))  D
"RTN","LRSPRPT",76,0)
 .S LRQUIT=0
"RTN","LRSPRPT",77,0)
 .I 'LRFOC S LRFFF=1
"RTN","LRSPRPT",78,0)
 .K LR("F")
"RTN","LRSPRPT",79,0)
 .S X=^LRO(69.2,LRAA,2,LRAN,0),LRDFN=+X,LRI=$P(X,"^",2)
"RTN","LRSPRPT",80,0)
 .D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS,LRI)
"RTN","LRSPRPT",81,0)
 .I +$G(LRPTR) D  Q
"RTN","LRSPRPT",82,0)
 ..D MAIN^LRAPTIUP(LRPTR,0)
"RTN","LRSPRPT",83,0)
 ..S LRFFF=0
"RTN","LRSPRPT",84,0)
 ..W:IOST["BROWSER"&('LRFOC) !!,LR("DVD")
"RTN","LRSPRPT",85,0)
 ..K LRPTR
"RTN","LRSPRPT",86,0)
 ..I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",87,0)
 ..S LR("F")=1
"RTN","LRSPRPT",88,0)
 ..I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRSPRPT",89,0)
 ..Q:LR("Q")!('LRFOC)
"RTN","LRSPRPT",90,0)
 ..D FOC
"RTN","LRSPRPT",91,0)
 ..W:IOST["BROWSER" !!,LR("DVD")
"RTN","LRSPRPT",92,0)
 ..I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",93,0)
 ..I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",94,0)
 .W:IOST?1"C-".E @IOF
"RTN","LRSPRPT",95,0)
 .D EN
"RTN","LRSPRPT",96,0)
 .W:IOST?1"P-".E @IOF
"RTN","LRSPRPT",97,0)
 .W:IOST["BROWSER"&('LRFOC) !!,LR("DVD")
"RTN","LRSPRPT",98,0)
 .I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRSPRPT",99,0)
 .Q:LR("Q")
"RTN","LRSPRPT",100,0)
 .Q:'LRFOC
"RTN","LRSPRPT",101,0)
 .W !
"RTN","LRSPRPT",102,0)
 .D FOC
"RTN","LRSPRPT",103,0)
 .W:IOST["BROWSER" !!,LR("DVD")
"RTN","LRSPRPT",104,0)
 .I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",105,0)
 .I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",106,0)
 S LRFFF=0
"RTN","LRSPRPT",107,0)
LST ;
"RTN","LRSPRPT",108,0)
 K LRRMD,LRPMD,LRAP
"RTN","LRSPRPT",109,0)
 K:'$D(LRSAV) ^LRO(69.2,LRAA,2)
"RTN","LRSPRPT",110,0)
 S ^LRO(69.2,LRAA,2,0)="^69.23A^^0"
"RTN","LRSPRPT",111,0)
 K LRSAV,LRV,LRW,LRZ
"RTN","LRSPRPT",112,0)
 I IOST?1"P-".E W:LRFFF @IOF
"RTN","LRSPRPT",113,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LRSPRPT",114,0)
 K %,DIR,DTOUT,DUOUT,DIRUT,X,Y
"RTN","LRSPRPT",115,0)
 D END
"RTN","LRSPRPT",116,0)
 Q
"RTN","LRSPRPT",117,0)
W ;
"RTN","LRSPRPT",118,0)
 W !,LR("%")
"RTN","LRSPRPT",119,0)
 Q
"RTN","LRSPRPT",120,0)
F ;        
"RTN","LRSPRPT",121,0)
 D E
"RTN","LRSPRPT",122,0)
 S A=0 F LRZ=0:1 S A=$O(^LR(LRDFN,LRSS,LRI,LRV,A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPT",123,0)
 .D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",124,0)
 .S X=^LR(LRDFN,LRSS,LRI,LRV,A,0) D:X["|TOP|" TOP D ^DIWP
"RTN","LRSPRPT",125,0)
 Q:LR("Q")  D:LRZ ^DIWW
"RTN","LRSPRPT",126,0)
 Q
"RTN","LRSPRPT",127,0)
E ;
"RTN","LRSPRPT",128,0)
 K ^UTILITY($J)
"RTN","LRSPRPT",129,0)
 S DIWR=IOM-5,DIWL=5,DIWF=LR("DIWF")
"RTN","LRSPRPT",130,0)
 Q
"RTN","LRSPRPT",131,0)
 ;
"RTN","LRSPRPT",132,0)
EN ;from LRSPT
"RTN","LRSPRPT",133,0)
 ;KLL-Suppress printing of SNOMED codes, except on Preliminary prints
"RTN","LRSPRPT",134,0)
 S LR("SPSM")=$S($G(LRPRE):0,1:1)
"RTN","LRSPRPT",135,0)
 S LR(.21)=+$G(^LRO(69.2,+$G(LRAA),.2))
"RTN","LRSPRPT",136,0)
 K LRO Q:'$D(^LR(LRDFN,LRSS,LRI,0))
"RTN","LRSPRPT",137,0)
 S LRQ=0
"RTN","LRSPRPT",138,0)
 D ^LRUA
"RTN","LRSPRPT",139,0)
 D INP^VADPT S LRPRAC=+VAIN(2)
"RTN","LRSPRPT",140,0)
 S:'LRPRAC LRPRAC(1)=""
"RTN","LRSPRPT",141,0)
 I LRPRAC S X=LRPRAC D D^LRUA S LRPRAC(1)=X
"RTN","LRSPRPT",142,0)
 D ^LRAPF Q:LR("Q")
"RTN","LRSPRPT",143,0)
 S LR("F")=1 W !,"Submitted by: ",LRW(5),?44,"Date obtained: ",LRTK
"RTN","LRSPRPT",144,0)
 D:LRA W
"RTN","LRSPRPT",145,0)
 W !,"Specimen (Received ",LRTK(1),"):" S LRV=.1 D A Q:LR("Q")
"RTN","LRSPRPT",146,0)
 I $P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),"^",4) D
"RTN","LRSPRPT",147,0)
 .W !?14,"*+* SUPPLEMENTARY REPORT HAS BEEN ADDED *+*"
"RTN","LRSPRPT",148,0)
 .W !?19,"*+* REFER TO BOTTOM OF REPORT *+*",!
"RTN","LRSPRPT",149,0)
 D:LRA W W !,"Brief Clinical History:" S LRV=.2 D F Q:LR("Q")
"RTN","LRSPRPT",150,0)
 D:LRA W W !,"Preoperative Diagnosis:" S LRV=.3 D F Q:LR("Q")
"RTN","LRSPRPT",151,0)
 D:LRA W W !,"Operative Findings:" S LRV=.4 D F Q:LR("Q")
"RTN","LRSPRPT",152,0)
 D:LRA W W !,"Postoperative Diagnosis:" S LRV=.5 D F Q:LR("Q")
"RTN","LRSPRPT",153,0)
 W !?27,"Surgeon/physician: ",LRMD W:LRA !,LR("%1")
"RTN","LRSPRPT",154,0)
 D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",155,0)
 D P^LRAPF
"RTN","LRSPRPT",156,0)
 D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",157,0)
 D:LRA W
"RTN","LRSPRPT",158,0)
 W:LRRC="" !?20,"+*+* REPORT INCOMPLETE *+*+",!
"RTN","LRSPRPT",159,0)
 D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",160,0)
 W ! W:LRRMD]"" ?31,$S(LRSS="SP":"Pathology Resident: ",LRSS="CY":"Screened by: ",LRSS="EM":"Prepared by: ",1:" "),LRRMD
"RTN","LRSPRPT",161,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.3,0)) D  Q:LR("Q")
"RTN","LRSPRPT",162,0)
 .D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",163,0)
 .W !,LR(69.2,.13)
"RTN","LRSPRPT",164,0)
 .I $P($G(^LR(LRDFN,LRSS,LRI,6,0)),U,4) S LR(0)=6 D ^LRSPRPTM
"RTN","LRSPRPT",165,0)
 S LRV=1.3 D F Q:LR("Q")
"RTN","LRSPRPT",166,0)
 I $O(^LR(LRDFN,LRSS,LRI,1,0)) D  Q:LR("Q")
"RTN","LRSPRPT",167,0)
 .D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",168,0)
 .W !,LR(69.2,.03)
"RTN","LRSPRPT",169,0)
 .I $P($G(^LR(LRDFN,LRSS,LRI,7,0)),U,4) S LR(0)=7 D ^LRSPRPTM
"RTN","LRSPRPT",170,0)
 S LRV=1 D F Q:LR("Q")
"RTN","LRSPRPT",171,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.1,0)) D  Q:LR("Q")
"RTN","LRSPRPT",172,0)
 .D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",173,0)
 .W !,LR(69.2,.04)
"RTN","LRSPRPT",174,0)
 .I $P($G(^LR(LRDFN,LRSS,LRI,4,0)),"^",4) S LR(0)=4 D ^LRSPRPTM
"RTN","LRSPRPT",175,0)
 S LRV=1.1 D F Q:LR("Q")
"RTN","LRSPRPT",176,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.4,0)) D  Q:LR("Q")
"RTN","LRSPRPT",177,0)
 .D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",178,0)
 .W !,LR(69.2,.14)
"RTN","LRSPRPT",179,0)
 .I $P($G(^LR(LRDFN,LRSS,LRI,5,0)),U,4) S LR(0)=5 D ^LRSPRPTM
"RTN","LRSPRPT",180,0)
 S LRV=1.4 D F Q:LR("Q")
"RTN","LRSPRPT",181,0)
 ;Supplementary Report
"RTN","LRSPRPT",182,0)
 I $O(^LR(LRDFN,LRSS,LRI,1.2,0)) D:LR(.21) F^LRAPF,^LRAPF Q:LR("Q")  D
"RTN","LRSPRPT",183,0)
 .D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",184,0)
 .W !,"Supplementary Report:"
"RTN","LRSPRPT",185,0)
 .S LRV=0 F  S LRV=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV)) Q:'LRV!(LR("Q"))  D
"RTN","LRSPRPT",186,0)
 ..S X=^LR(LRDFN,LRSS,LRI,1.2,LRV,0) D S
"RTN","LRSPRPT",187,0)
 D ^LRSPRPT1 Q:LR("Q")
"RTN","LRSPRPT",188,0)
 Q:+$G(LRPRE)  ;Don't set the final flag and print the footer if prelim
"RTN","LRSPRPT",189,0)
 S LRO=1 D F^LRAPF
"RTN","LRSPRPT",190,0)
 Q
"RTN","LRSPRPT",191,0)
S ;
"RTN","LRSPRPT",192,0)
 S Y=+X,X=$P(X,U,2) D D^LRU
"RTN","LRSPRPT",193,0)
 W !?3,"Date: ",Y
"RTN","LRSPRPT",194,0)
 I $D(LR("R")),'X W " not verified" Q
"RTN","LRSPRPT",195,0)
 D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q") 
"RTN","LRSPRPT",196,0)
 D:$P($G(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,0)),U,4) SUPA
"RTN","LRSPRPT",197,0)
 D E S B=0
"RTN","LRSPRPT",198,0)
 F LRZ=0:1 S B=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,1,B)) Q:'B!(LR("Q"))  D
"RTN","LRSPRPT",199,0)
 .D:$Y>(IOSL-14) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",200,0)
 .S DIWF="W"
"RTN","LRSPRPT",201,0)
 .S X=^LR(LRDFN,LRSS,LRI,1.2,LRV,1,B,0) D ^DIWP Q:LR("Q")
"RTN","LRSPRPT",202,0)
 Q:LR("Q")
"RTN","LRSPRPT",203,0)
 D:LRZ ^DIWW
"RTN","LRSPRPT",204,0)
 Q
"RTN","LRSPRPT",205,0)
SGL ;Print Single Report
"RTN","LRSPRPT",206,0)
 N LRPTR
"RTN","LRSPRPT",207,0)
 S LRAPX(1)=""
"RTN","LRSPRPT",208,0)
 D EN1^LRUPS Q:LRAN=-1
"RTN","LRSPRPT",209,0)
 I '$P(^LR(LRDFN,LRSS,LRI,0),"^",11) D  G SGL
"RTN","LRSPRPT",210,0)
 .W $C(7)," Sorry, report not verified.",!
"RTN","LRSPRPT",211,0)
 D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS,LRI)
"RTN","LRSPRPT",212,0)
 S LRAP=LRDFN_"^"_LRI,LRSAV=1
"RTN","LRSPRPT",213,0)
 D EN2^LRUA
"RTN","LRSPRPT",214,0)
 G DEV
"RTN","LRSPRPT",215,0)
A ;
"RTN","LRSPRPT",216,0)
 S A=0 F  S A=$O(^LR(LRDFN,LRSS,LRI,LRV,A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPT",217,0)
 .D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",218,0)
 .W !,$P(^LR(LRDFN,LRSS,LRI,LRV,A,0),"^")
"RTN","LRSPRPT",219,0)
 Q
"RTN","LRSPRPT",220,0)
TOP ;
"RTN","LRSPRPT",221,0)
 S Z=$P(X,"|TOP|",1)_$P(X,"|TOP|",2) D F^LRAPF,^LRAPF S X=Z
"RTN","LRSPRPT",222,0)
 Q
"RTN","LRSPRPT",223,0)
SUPA ;Print supplementary report audit information
"RTN","LRSPRPT",224,0)
 W !?14,"*+* SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED *+*"
"RTN","LRSPRPT",225,0)
 W !,"(Added/Last modified: "
"RTN","LRSPRPT",226,0)
 S (A,B)=0 F  S A=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPT",227,0)
 .S B=A
"RTN","LRSPRPT",228,0)
 Q:LR("Q")
"RTN","LRSPRPT",229,0)
 Q:'$D(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,B,0))
"RTN","LRSPRPT",230,0)
 S A=^(0),Y=+A,LRSGN=" typed by ",A=$P(A,"^",2)
"RTN","LRSPRPT",231,0)
 I $P(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,B,0),"^",3) D
"RTN","LRSPRPT",232,0)
 .S A=^(0),LRSGN=" signed by ",A2=$P(A,"^",3),Y=$P(A,"^",4)
"RTN","LRSPRPT",233,0)
 .S A=A2
"RTN","LRSPRPT",234,0)
 S A=$S($D(^VA(200,A,0)):$P(^(0),"^"),1:A)
"RTN","LRSPRPT",235,0)
 ;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRSPRPT",236,0)
 D D^LRU W Y,LRSGN,A,")"
"RTN","LRSPRPT",237,0)
 ;If RELEASE SUPP REPORT MODIFIED set to 1, display "NOT VERIFIED"
"RTN","LRSPRPT",238,0)
 I $P(^LR(LRDFN,LRSS,LRI,1.2,LRV,0),"^",3) W !,?25,"**-* NOT VERIFIED *-**"
"RTN","LRSPRPT",239,0)
 D:$D(LRQ(9)) SUPM
"RTN","LRSPRPT",240,0)
 Q
"RTN","LRSPRPT",241,0)
SUPM ;Print previous versions of supplementary reports
"RTN","LRSPRPT",242,0)
 ;This is used by menu option 'Print path modifications [LRAPMOD]'
"RTN","LRSPRPT",243,0)
 ;
"RTN","LRSPRPT",244,0)
 S A=0 F  S A=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPT",245,0)
 .S LRT=^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A,0)
"RTN","LRSPRPT",246,0)
 .D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",247,0)
 .S Y=+LRT,Y2=" modified: ",X=$P(LRT,"^",2),LRSGN="  typed by "
"RTN","LRSPRPT",248,0)
 .;If supp rpt is released, display 'signed by' instead of 'typed by' 
"RTN","LRSPRPT",249,0)
 .I $P(LRT,"^",3) S LRSGN=" signed by ",X=$P(LRT,"^",3),Y=$P(LRT,"^",4),Y2=" released: "
"RTN","LRSPRPT",250,0)
 .S X=$S($D(^VA(200,X,0)):$P(^(0),"^"),1:X)
"RTN","LRSPRPT",251,0)
 .D D^LRU W !,"Date ",Y2,Y,LRSGN,X
"RTN","LRSPRPT",252,0)
 .K ^UTILITY($J)
"RTN","LRSPRPT",253,0)
 .S DIWR=IOM-5,DIWL=5,DIWF="W"
"RTN","LRSPRPT",254,0)
 .S B=0
"RTN","LRSPRPT",255,0)
 .F LRZ=0:1 S B=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A,1,B)) Q:'B!(LR("Q"))  D
"RTN","LRSPRPT",256,0)
 ..S LRT=^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A,1,B,0)
"RTN","LRSPRPT",257,0)
 ..D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",258,0)
 ..S X=LRT D ^DIWP
"RTN","LRSPRPT",259,0)
 .Q:LR("Q")  D:LRZ ^DIWW
"RTN","LRSPRPT",260,0)
 Q:LR("Q")
"RTN","LRSPRPT",261,0)
 W !?13,"==========Text below appears on final report=========="
"RTN","LRSPRPT",262,0)
 Q
"RTN","LRSPRPT",263,0)
CONT ;
"RTN","LRSPRPT",264,0)
 K DIR S DIR(0)="E"
"RTN","LRSPRPT",265,0)
 D ^DIR W !
"RTN","LRSPRPT",266,0)
 S:$D(DTOUT)!(X[U) LR("Q")=1
"RTN","LRSPRPT",267,0)
 Q
"RTN","LRSPRPT",268,0)
FOC ;Print final office copy page (SNOMEDS)
"RTN","LRSPRPT",269,0)
 N LRADC,LRCTR
"RTN","LRSPRPT",270,0)
 I '$D(LRAP) D
"RTN","LRSPRPT",271,0)
 .D:LRSS'="AU" ^LRUA
"RTN","LRSPRPT",272,0)
 .I LRSS="AU" S X=^LR(LRDFN,0) D ^LRUP
"RTN","LRSPRPT",273,0)
 I LRSS="AU" D
"RTN","LRSPRPT",274,0)
 .S LRADC=$E($P(^LR(LRDFN,LRSS),"^"),1,3)_"0000"
"RTN","LRSPRPT",275,0)
 .S:+$G(LRDPF)=2 LRDEM("DTH")=$P(VADM(6),"^",2)
"RTN","LRSPRPT",276,0)
 .;Get DATE DIED from Referral File for Referral Patients
"RTN","LRSPRPT",277,0)
 .S:+$G(LRDPF)'=2 LRDEM("DTH")=$$GET1^DIQ(67,DFN_",",.351)
"RTN","LRSPRPT",278,0)
 .S LRDEM("AUDT")=$$GET1^DIQ(63,LRDFN_",",11)
"RTN","LRSPRPT",279,0)
 .S LRDEM("AUTYP")=$$GET1^DIQ(63,LRDFN_",",13.7)
"RTN","LRSPRPT",280,0)
 .S LRDEM("PRO")=$$GET1^DIQ(63,LRDFN_",",13.5)
"RTN","LRSPRPT",281,0)
 I LRSS'="AU" D
"RTN","LRSPRPT",282,0)
 .S LRADC=$E($P(^LR(LRDFN,LRSS,LRI,0),"^"),1,3)_"0000"
"RTN","LRSPRPT",283,0)
 .S LRDEM("PRO")=LRMD
"RTN","LRSPRPT",284,0)
 S LRDEM("PNM")=LRP,LRDEM("SSN")=SSN
"RTN","LRSPRPT",285,0)
 S LRDEM("SEX")=SEX,LRDEM("AGE")=AGE,LRDEM("DOB")=DOB
"RTN","LRSPRPT",286,0)
 D INIT^LRAPSNMD(LRDFN,LRSS,$G(LRI),LRSF,LRAA,LRAN,LRADC,.LRDEM,0)
"RTN","LRSPRPT",287,0)
 Q
"RTN","LRSPRPT",288,0)
END ;
"RTN","LRSPRPT",289,0)
 D V^LRU
"RTN","LRSPRPT",290,0)
 K LRSF515
"RTN","LRSPRPT",291,0)
 Q
"UP",63,63.207,-2)
63^EM
"UP",63,63.207,-1)
63.02^1.2
"UP",63,63.207,0)
63.207
"UP",63,63.324,-1)
63^84
"UP",63,63.324,0)
63.324
"UP",63,63.817,-2)
63^SP
"UP",63,63.817,-1)
63.08^1.2
"UP",63,63.817,0)
63.817
"UP",63,63.907,-2)
63^CY
"UP",63,63.907,-1)
63.09^1.2
"UP",63,63.907,0)
63.907
"VER")
8.0^22.0
"^DD",63,63.207,.03,0)
RELEASE SUPP REPORT MODIFIED^S^1:YES;0:NO;^0;3^Q
"^DD",63,63.207,.03,21,0)
^^2^2^3040908^
"^DD",63,63.207,.03,21,1,0)
This flag will be set to '1' when a released supplementary report is modified. 
"^DD",63,63.207,.03,21,2,0)
It is removed when the modified supplementary report is released.  
"^DD",63,63.207,.03,"DT")
3040909
"^DD",63,63.324,.03,0)
RELEASE SUPP REPORT MODIFIED^S^1:YES;0:NO;^0;3^Q
"^DD",63,63.324,.03,21,0)
^^2^2^3040908^
"^DD",63,63.324,.03,21,1,0)
This flag will be set to '1' when a released supplementary report is modified. 
"^DD",63,63.324,.03,21,2,0)
It is removed when the modified supplementary report is released.  
"^DD",63,63.324,.03,"DT")
3040908
"^DD",63,63.817,.03,0)
RELEASE SUPP REPORT MODIFIED^S^1:YES;0:NO;^0;3^Q
"^DD",63,63.817,.03,21,0)
^^3^3^3040908^
"^DD",63,63.817,.03,21,1,0)
This flag will be set to '1' when a released supplementary report is 
"^DD",63,63.817,.03,21,2,0)
modified. It is removed when the modified supplementary report is
"^DD",63,63.817,.03,21,3,0)
released. 
"^DD",63,63.817,.03,"DT")
3040909
"^DD",63,63.907,.03,0)
RELEASE SUPP REPORT MODIFIED^S^1:YES;0:NO;^0;3^Q
"^DD",63,63.907,.03,21,0)
^^2^2^3040908^^^^
"^DD",63,63.907,.03,21,1,0)
This flag will be set to '1' when a released supplementary report is modified.
"^DD",63,63.907,.03,21,2,0)
It is removed when the modified supplementary report is released.
"^DD",63,63.907,.03,"DT")
3040909
"BLD",5314,6)
^285
**END**
**END**
