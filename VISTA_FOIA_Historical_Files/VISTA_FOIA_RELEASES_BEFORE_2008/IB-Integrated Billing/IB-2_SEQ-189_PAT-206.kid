Released IB*2*206 SEQ #189
Extracted from mail message
**KIDS**:IB*2.0*206^

**INSTALL NAME**
IB*2.0*206
"BLD",3847,0)
IB*2.0*206^INTEGRATED BILLING^0^3030318^y
"BLD",3847,1,0)
^^1^1^3030318^^^^
"BLD",3847,1,1,0)
The IB part of the HIPAA Confidential Communication project.
"BLD",3847,4,0)
^9.64PA^^
"BLD",3847,"KRN",0)
^9.67PA^8989.52^19
"BLD",3847,"KRN",.4,0)
.4
"BLD",3847,"KRN",.401,0)
.401
"BLD",3847,"KRN",.402,0)
.402
"BLD",3847,"KRN",.403,0)
.403
"BLD",3847,"KRN",.5,0)
.5
"BLD",3847,"KRN",.84,0)
.84
"BLD",3847,"KRN",3.6,0)
3.6
"BLD",3847,"KRN",3.8,0)
3.8
"BLD",3847,"KRN",9.2,0)
9.2
"BLD",3847,"KRN",9.8,0)
9.8
"BLD",3847,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",3847,"KRN",9.8,"NM",1,0)
IBARXEL^^0^B15436518
"BLD",3847,"KRN",9.8,"NM",2,0)
IBARXEPL^^0^B28025836
"BLD",3847,"KRN",9.8,"NM",4,0)
IBCU5^^0^B14993646
"BLD",3847,"KRN",9.8,"NM","B","IBARXEL",1)

"BLD",3847,"KRN",9.8,"NM","B","IBARXEPL",2)

"BLD",3847,"KRN",9.8,"NM","B","IBCU5",4)

"BLD",3847,"KRN",19,0)
19
"BLD",3847,"KRN",19.1,0)
19.1
"BLD",3847,"KRN",101,0)
101
"BLD",3847,"KRN",409.61,0)
409.61
"BLD",3847,"KRN",771,0)
771
"BLD",3847,"KRN",870,0)
870
"BLD",3847,"KRN",8989.51,0)
8989.51
"BLD",3847,"KRN",8989.52,0)
8989.52
"BLD",3847,"KRN",8994,0)
8994
"BLD",3847,"KRN","B",.4,.4)

"BLD",3847,"KRN","B",.401,.401)

"BLD",3847,"KRN","B",.402,.402)

"BLD",3847,"KRN","B",.403,.403)

"BLD",3847,"KRN","B",.5,.5)

"BLD",3847,"KRN","B",.84,.84)

"BLD",3847,"KRN","B",3.6,3.6)

"BLD",3847,"KRN","B",3.8,3.8)

"BLD",3847,"KRN","B",9.2,9.2)

"BLD",3847,"KRN","B",9.8,9.8)

"BLD",3847,"KRN","B",19,19)

"BLD",3847,"KRN","B",19.1,19.1)

"BLD",3847,"KRN","B",101,101)

"BLD",3847,"KRN","B",409.61,409.61)

"BLD",3847,"KRN","B",771,771)

"BLD",3847,"KRN","B",870,870)

"BLD",3847,"KRN","B",8989.51,8989.51)

"BLD",3847,"KRN","B",8989.52,8989.52)

"BLD",3847,"KRN","B",8994,8994)

"BLD",3847,"QUES",0)
^9.62^^
"BLD",3847,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
206^3030318^100980
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3030318
"PKG",200,22,1,"PAH",1,1,1,0)
The IB part of the HIPAA Confidential Communication project.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","IBARXEL")
0^1^B15436518
"RTN","IBARXEL",1,0)
IBARXEL ;ALB/CPM - RX COPAY EXEMPTION INCOME TEST REMINDERS ; 22-MAR-95
"RTN","IBARXEL",2,0)
 ;;2.0;INTEGRATED BILLING;**34,139,206**; 21-MAR-94
"RTN","IBARXEL",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBARXEL",4,0)
 ;
"RTN","IBARXEL",5,0)
EN ; Entry point for the generation of income test reminder letters.
"RTN","IBARXEL",6,0)
 ; Invoked by the nightly IB Background job (routine IBAMTC).
"RTN","IBARXEL",7,0)
 ;
"RTN","IBARXEL",8,0)
 ; - check the job parameters
"RTN","IBARXEL",9,0)
 S IBLET=$O(^IBE(354.6,"B","IB INCOME TEST REMINDER",0)) I 'IBLET G ENQ
"RTN","IBARXEL",10,0)
 S IBLET0=$G(^IBE(354.6,IBLET,0))
"RTN","IBARXEL",11,0)
 S IBDEV=$P(IBLET0,"^",5) I IBDEV="" G ENQ
"RTN","IBARXEL",12,0)
 S IBREPR=$P(IBLET0,"^",7)
"RTN","IBARXEL",13,0)
 ;
"RTN","IBARXEL",14,0)
 ; - should the job run tonight?
"RTN","IBARXEL",15,0)
 D NOW^%DTC S IBDAT=%
"RTN","IBARXEL",16,0)
 S IBDAY=$$DOW^XLFDT(IBDAT\1,1)
"RTN","IBARXEL",17,0)
 I $E(IBDAT,8,17)>.17 S IBDAY=$S(IBDAY=6:0,1:IBDAY+1)
"RTN","IBARXEL",18,0)
 I $P(IBLET0,"^",6)'[IBDAY G ENQ
"RTN","IBARXEL",19,0)
 ;
"RTN","IBARXEL",20,0)
 ; - who needs a letter?
"RTN","IBARXEL",21,0)
 S IBSTART=$$FMADD^XLFDT(IBDAT\1,-366)
"RTN","IBARXEL",22,0)
 S IBEND=$$FMADD^XLFDT(IBDAT\1,-305)
"RTN","IBARXEL",23,0)
 ;
"RTN","IBARXEL",24,0)
 K ^TMP("IBEX",$J)
"RTN","IBARXEL",25,0)
 S IBD=IBSTART F  S IBD=$O(^IBA(354.1,"B",IBD)) Q:'IBD!(IBD>IBEND)  D
"RTN","IBARXEL",26,0)
 .S IBEX=0 F  S IBEX=$O(^IBA(354.1,"B",IBD,IBEX)) Q:'IBEX  D
"RTN","IBARXEL",27,0)
 ..S IBEXD=$G(^IBA(354.1,IBEX,0)) Q:'IBEXD
"RTN","IBARXEL",28,0)
 ..;
"RTN","IBARXEL",29,0)
 ..; - don't reprint letter unless requested
"RTN","IBARXEL",30,0)
 ..S IBLASTPR=$P(IBEXD,"^",16)
"RTN","IBARXEL",31,0)
 ..I IBREPR,IBLASTPR,IBLASTPR'=IBREPR Q
"RTN","IBARXEL",32,0)
 ..I 'IBREPR,IBLASTPR Q
"RTN","IBARXEL",33,0)
 ..;
"RTN","IBARXEL",34,0)
 ..Q:$P(IBEXD,"^",3)'=1  ;           not a copay exemption
"RTN","IBARXEL",35,0)
 ..Q:'$P(IBEXD,"^",10)  ;            exemption is not active
"RTN","IBARXEL",36,0)
 ..;
"RTN","IBARXEL",37,0)
 ..S IBEXREA=$$ACODE^IBARXEU0(IBEXD)
"RTN","IBARXEL",38,0)
 ..I IBEXREA'=110,IBEXREA'=120 Q  ;  exemption is not based on income
"RTN","IBARXEL",39,0)
 ..;
"RTN","IBARXEL",40,0)
 ..S DFN=+$P(IBEXD,"^",2)
"RTN","IBARXEL",41,0)
 ..I $P(IBLET0,"^",8),$$DOM(DFN) Q  ;  vet is in a dom
"RTN","IBARXEL",42,0)
 ..Q:$G(^DPT(DFN,.35))  ;              vet is deceased
"RTN","IBARXEL",43,0)
 ..I +IBEXD'=$P($G(^IBA(354,DFN,0)),"^",3) Q  ;  exemption not current
"RTN","IBARXEL",44,0)
 ..Q:$D(^TMP("IBEX",$J,"V",DFN))  ;    vet already getting letter
"RTN","IBARXEL",45,0)
 ..;
"RTN","IBARXEL",46,0)
 ..; - sort letters by zip code
"RTN","IBARXEL",47,0)
 ..K VA,VAERR,VAPA D ADD^VADPT
"RTN","IBARXEL",48,0)
 ..S IBZIP=$P(VAPA($S($$CONFADD():18,1:11)),"^",2) S:IBZIP="" IBZIP="99999-9999"
"RTN","IBARXEL",49,0)
 ..S:'$P(IBZIP,"-",2) IBZIP=$E(IBZIP,1,5)_"-0000"
"RTN","IBARXEL",50,0)
 ..S ^TMP("IBEX",$J,"V",DFN)=""
"RTN","IBARXEL",51,0)
 ..S ^TMP("IBEX",$J,"L",IBZIP,IBEX)=+IBEXD_"^"_+$P(IBEXD,"^",4)_"^"_DFN
"RTN","IBARXEL",52,0)
 ;
"RTN","IBARXEL",53,0)
 ; - open a print device if necessary
"RTN","IBARXEL",54,0)
 I '$D(^TMP("IBEX",$J,"L")) G ENQ
"RTN","IBARXEL",55,0)
 S IOP=IBDEV D ^%ZIS I POP G ENQ
"RTN","IBARXEL",56,0)
 U IO
"RTN","IBARXEL",57,0)
 ;
"RTN","IBARXEL",58,0)
 ; - print the letters
"RTN","IBARXEL",59,0)
 S IBSCR="" F  S IBSCR=$O(^TMP("IBEX",$J,"L",IBSCR)) Q:IBSCR=""  D
"RTN","IBARXEL",60,0)
 .S IBEX=0 F  S IBEX=$O(^TMP("IBEX",$J,"L",IBSCR,IBEX)) Q:'IBEX  D PRINT
"RTN","IBARXEL",61,0)
 ;
"RTN","IBARXEL",62,0)
ENQ I $G(IBREPR),IBLET S DA=IBLET,DIE="^IBE(354.6,",DR=".07////@" D ^DIE K DA,DR,DIE
"RTN","IBARXEL",63,0)
 ;
"RTN","IBARXEL",64,0)
 D ^%ZISC
"RTN","IBARXEL",65,0)
 K ^TMP("IBEX",$J),DFN,VAPA,VA,VAERR,X
"RTN","IBARXEL",66,0)
 K IBD,IBEX,IBEXD,IBEXREA,IBDAT,IBDAY,IBDEV,IBZIP,IBLET0,IBREPR,IBQUIT
"RTN","IBARXEL",67,0)
 K IBEND,IBLET,IBSTART,IBSCR,IBEXPD,IBDATA,IBNAM,IBALIN,IBLASTPR
"RTN","IBARXEL",68,0)
 Q
"RTN","IBARXEL",69,0)
 ;
"RTN","IBARXEL",70,0)
 ;
"RTN","IBARXEL",71,0)
PRINT ; Print a reminder letter.
"RTN","IBARXEL",72,0)
 ;  Required variable input:
"RTN","IBARXEL",73,0)
 ;      IBEX  --  Pointer to exemption in file #354.1
"RTN","IBARXEL",74,0)
 ;     IBLET  --  Pointer to the reminder letter in file #354.6
"RTN","IBARXEL",75,0)
 ;
"RTN","IBARXEL",76,0)
 ; - set letter variables
"RTN","IBARXEL",77,0)
 S IBEXD=$G(^IBA(354.1,+IBEX,0))
"RTN","IBARXEL",78,0)
 S IBEXPD=$$DATE($$PLUS^IBARXEU0(+IBEXD))
"RTN","IBARXEL",79,0)
 ;S IBEXPD=$$DATE($$FMADD^XLFDT(+IBEXD,365))
"RTN","IBARXEL",80,0)
 S DFN=+$P(IBEXD,"^",2),IBQUIT=0
"RTN","IBARXEL",81,0)
 S IBDATA=$$PT^IBEFUNC(DFN),IBNAM=$P(IBDATA,"^")
"RTN","IBARXEL",82,0)
 S IBALIN=$P($G(^IBE(354.6,IBLET,0)),"^",4)
"RTN","IBARXEL",83,0)
 I IBALIN<10!(IBALIN>25) S IBALIN=15
"RTN","IBARXEL",84,0)
 ;
"RTN","IBARXEL",85,0)
 ; - print letter
"RTN","IBARXEL",86,0)
 D ONE^IBARXEPL
"RTN","IBARXEL",87,0)
 ;
"RTN","IBARXEL",88,0)
 ; - update the exemption
"RTN","IBARXEL",89,0)
 S DA=IBEX,DIE="^IBA(354.1,",DR=".16////"_DT D ^DIE K DA,DR,DIE
"RTN","IBARXEL",90,0)
 K IBEXD,TAB,IBCNTL,IB,IBCNT,IBX,VAPA,VA,VAERR
"RTN","IBARXEL",91,0)
 Q
"RTN","IBARXEL",92,0)
 ;
"RTN","IBARXEL",93,0)
 ;
"RTN","IBARXEL",94,0)
DATE(X) ; Format the exemption expiration date.
"RTN","IBARXEL",95,0)
 N A S A="January^February^March^April^May^June^July^August^September^October^November^December"
"RTN","IBARXEL",96,0)
 Q $P(A,"^",+$E(X,4,5))_" "_+$E(X,6,7)_", "_(1700+$E(X,1,3))
"RTN","IBARXEL",97,0)
 ;
"RTN","IBARXEL",98,0)
DOM(DFN) ; Is the veteran in a domiciliary?
"RTN","IBARXEL",99,0)
 ;  Input:  DFN  -  Pointer to the patient in file #2
"RTN","IBARXEL",100,0)
 ; Output:    0  -  Vet is not in a domiciliary
"RTN","IBARXEL",101,0)
 ;            1  -  Vet is in a domiciliary
"RTN","IBARXEL",102,0)
 ;
"RTN","IBARXEL",103,0)
 N VAIN,VA,VAERR
"RTN","IBARXEL",104,0)
 D INP^VADPT
"RTN","IBARXEL",105,0)
 Q $P($G(^DIC(42,+$G(VAIN(4)),0)),"^",3)="D"
"RTN","IBARXEL",106,0)
 ;
"RTN","IBARXEL",107,0)
CONFADD() ;Determine, does the patient has Confidential Address.
"RTN","IBARXEL",108,0)
 ; Input: VAPA() local array (by ADD^VADPT)
"RTN","IBARXEL",109,0)
 I '$G(VAPA(12)) Q 0  ; The Conf Address not active
"RTN","IBARXEL",110,0)
 I $P($G(VAPA(22,3)),U,3)'="Y" Q 0  ; The Conf Address is not valid for billing-related correspondence
"RTN","IBARXEL",111,0)
 Q 1
"RTN","IBARXEPL")
0^2^B28025836
"RTN","IBARXEPL",1,0)
IBARXEPL ;ALB/AAS - PRINT EXEMPTION LETTER - 28-APR-93
"RTN","IBARXEPL",2,0)
 ;;2.0;INTEGRATED BILLING;**34,54,190,206**;21-MAR-94
"RTN","IBARXEPL",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBARXEPL",4,0)
 ;
"RTN","IBARXEPL",5,0)
% I '$D(DT) D DT^DICRW
"RTN","IBARXEPL",6,0)
 I '$D(IOF) D HOME^%ZIS
"RTN","IBARXEPL",7,0)
 W @IOF,"Print Exemption letters to patients"
"RTN","IBARXEPL",8,0)
 K ^TMP("IBEX LIST",$J)
"RTN","IBARXEPL",9,0)
 S (IBTEMP,IBADDT,IBOK,IBQUIT)=""
"RTN","IBARXEPL",10,0)
 ;
"RTN","IBARXEPL",11,0)
 ; -- find template
"RTN","IBARXEPL",12,0)
 S IBTEMP=$O(^DIBT("B","IB EXEMPTION LETTER",0))
"RTN","IBARXEPL",13,0)
 ;
"RTN","IBARXEPL",14,0)
 ; -- use old template or build new one
"RTN","IBARXEPL",15,0)
 W !!!
"RTN","IBARXEPL",16,0)
 ;
"RTN","IBARXEPL",17,0)
 I IBTEMP D  G:IBQUIT END
"RTN","IBARXEPL",18,0)
 .S DIR(0)="Y",DIR("A")="Delete Results of Previous Search",DIR("B")="NO"
"RTN","IBARXEPL",19,0)
 .S DIR("?")="Enter 'Yes' if you would like to delete the results of a previous search, Enter 'No' if you want to keep the results (i.e. you may be reprinting letters from the same list)."
"RTN","IBARXEPL",20,0)
 .D ^DIR K DIR I $D(DIRUT) S IBQUIT=1
"RTN","IBARXEPL",21,0)
 .I Y=1 D DELT S IBTEMP=0
"RTN","IBARXEPL",22,0)
 .Q
"RTN","IBARXEPL",23,0)
 ;
"RTN","IBARXEPL",24,0)
 I 'IBTEMP D  G:IBQUIT END D:IBADD ADDT
"RTN","IBARXEPL",25,0)
 .S DIR(0)="Y",DIR("A")="Store results of Search in Template",DIR("B")="YES"
"RTN","IBARXEPL",26,0)
 .S DIR("?")="Enter 'Yes' if you would like the results of the search stored in a Sort Template named IB EXEMPTION LETTER.  Enter 'No' if you do not want the template created."
"RTN","IBARXEPL",27,0)
 .S DIR("?",1)="Creating the search template will allow you to",DIR("?",2)="print other lists from the patients you sent the letters to."
"RTN","IBARXEPL",28,0)
 .S DIR("?",3)=" "
"RTN","IBARXEPL",29,0)
 .D ^DIR K DIR I $D(DIRUT) S IBQUIT=1 Q
"RTN","IBARXEPL",30,0)
 .S IBADD=Y
"RTN","IBARXEPL",31,0)
 .Q
"RTN","IBARXEPL",32,0)
 ;
"RTN","IBARXEPL",33,0)
 D PRINT
"RTN","IBARXEPL",34,0)
 ;
"RTN","IBARXEPL",35,0)
END I $D(ZTQUEUED) Q
"RTN","IBARXEPL",36,0)
 D ^%ZISC,KVAR^VADPT
"RTN","IBARXEPL",37,0)
 K C,J,X,Y,D0,DIC,DA,DR,DIE,DFN,DLAYGO,DIR,DIRUT,IB,IBADD,IBADDT,IBTEMP
"RTN","IBARXEPL",38,0)
 K IBOK,IBLET,IBCNT,IBCNTL,IBQUIT,IBNAM,IBDATA,IBJ,IBX,TAB,POP,IBALIN
"RTN","IBARXEPL",39,0)
 K BY,DHD,DIOEND,FLDS,FR,I,L,TO,VAPA,^TMP("IBEX LIST",$J)
"RTN","IBARXEPL",40,0)
 Q
"RTN","IBARXEPL",41,0)
 ;
"RTN","IBARXEPL",42,0)
ADDT ; -- create new template in ^dibt
"RTN","IBARXEPL",43,0)
 K DD,DO
"RTN","IBARXEPL",44,0)
 S DIC="^DIBT(",DIC(0)="L",X="IB EXEMPTION LETTER",DIC("DR")="2///NOW;4///354;7///NOW"
"RTN","IBARXEPL",45,0)
 D FILE^DICN S IBTEMP=+Y I +Y S IBADDT=1 W !!,"<<< Search Template IB EXEMPTION LETTER created!",!
"RTN","IBARXEPL",46,0)
 Q
"RTN","IBARXEPL",47,0)
 ;
"RTN","IBARXEPL",48,0)
DELT ; -- delete search template
"RTN","IBARXEPL",49,0)
 Q:$P($G(^DIBT(+IBTEMP,0)),"^",1)'="IB EXEMPTION LETTER"
"RTN","IBARXEPL",50,0)
 S DIK="^DIBT(",DA=IBTEMP D ^DIK K DIK,DA
"RTN","IBARXEPL",51,0)
 W !!,"<<< Search Template IB EXEMPTION LETTER deleted!",!
"RTN","IBARXEPL",52,0)
 S IBTEMP=""
"RTN","IBARXEPL",53,0)
 Q
"RTN","IBARXEPL",54,0)
 ;
"RTN","IBARXEPL",55,0)
SCR ; -- don't send letters to deceased patients, non-vets
"RTN","IBARXEPL",56,0)
 ;    called by print template IB DO NOT USE
"RTN","IBARXEPL",57,0)
 S IBOK=0 N IBX
"RTN","IBARXEPL",58,0)
 I +$G(^DPT(D0,.35)) G SCRQ ; deceased
"RTN","IBARXEPL",59,0)
 I $P($G(^DPT(D0,"VET")),"^")="N" G SCRQ ; patient non-vet
"RTN","IBARXEPL",60,0)
 S IBX=$P($G(^IBE(354.2,+$P($G(^IBA(354,D0,0)),"^",5),0)),"^",5)
"RTN","IBARXEPL",61,0)
 I IBX=60 G SCRQ ;exemption is non-vet
"RTN","IBARXEPL",62,0)
 I IBX=10 G SCRQ ;sc>50
"RTN","IBARXEPL",63,0)
 S IBOK=1
"RTN","IBARXEPL",64,0)
SCRQ Q
"RTN","IBARXEPL",65,0)
 ;
"RTN","IBARXEPL",66,0)
PRINT ; -- run through list of letters to PRINT
"RTN","IBARXEPL",67,0)
 S X="IB NOW EXEMPT",DIC(0)="XZ",DIC="^IBE(354.6," D ^DIC S IBLET=+Y
"RTN","IBARXEPL",68,0)
 Q:IBLET<1
"RTN","IBARXEPL",69,0)
 ;
"RTN","IBARXEPL",70,0)
 S DIC="^IBA(354,",L=0,FLDS="[IB DO NOT USE]",BY="[IB EXEMPT PATIENTS]",(FR,TO)="?,?,?",DHD="@@"
"RTN","IBARXEPL",71,0)
 S DIOEND="D LET^IBARXEPL"
"RTN","IBARXEPL",72,0)
 D EN1^DIP
"RTN","IBARXEPL",73,0)
 Q
"RTN","IBARXEPL",74,0)
 ;
"RTN","IBARXEPL",75,0)
LET ; -- called by dioend, prints list from tmp array
"RTN","IBARXEPL",76,0)
 S IBALIN=$P($G(^IBE(354.6,IBLET,0)),"^",4)
"RTN","IBARXEPL",77,0)
 I IBALIN<10!(IBALIN>25) S IBALIN=15
"RTN","IBARXEPL",78,0)
 S IBNAM="" F  S IBNAM=$O(^TMP("IBEX LIST",$J,IBNAM)) Q:IBNAM=""!(IBQUIT)  S DFN=0 F  S DFN=$O(^TMP("IBEX LIST",$J,IBNAM,DFN)) Q:'DFN!(IBQUIT)  S IBDATA=^(DFN) D ONE
"RTN","IBARXEPL",79,0)
 D FINAL,END
"RTN","IBARXEPL",80,0)
 Q
"RTN","IBARXEPL",81,0)
 ;
"RTN","IBARXEPL",82,0)
ONE ; -- print one letter
"RTN","IBARXEPL",83,0)
 N IBCONF ; Confidential Address Flag
"RTN","IBARXEPL",84,0)
 S TAB=5
"RTN","IBARXEPL",85,0)
 I '$D(IOF) D HOME^%ZIS
"RTN","IBARXEPL",86,0)
 S IBCNTL=$G(IBCNTL)+1 I $E(IOST,1,2)="C-" W @IOF
"RTN","IBARXEPL",87,0)
 S IB=0
"RTN","IBARXEPL",88,0)
 ;
"RTN","IBARXEPL",89,0)
 ; -- print header
"RTN","IBARXEPL",90,0)
 S IBCNT=0
"RTN","IBARXEPL",91,0)
 F I=1:1:6 S IB=$O(^IBE(354.6,IBLET,2,IB)) Q:'IB  S X=$G(^(IB,0)) W !?(IOM-$L(X)+1/2),X S IBCNT=IBCNT+1
"RTN","IBARXEPL",92,0)
 W !?TAB S Y=DT D DT^DIQ S IBCNT=IBCNT+1
"RTN","IBARXEPL",93,0)
 F IBCNT=IBCNT:1:6 W ! S IBCNT=IBCNT+1
"RTN","IBARXEPL",94,0)
 W !?(IOM-28),"In Reply Refer To:" S IBCNT=IBCNT+1
"RTN","IBARXEPL",95,0)
 W !?(IOM-28),$E($P(IBDATA,"^")),$P($P(IBDATA,"^",2),"-",3),!
"RTN","IBARXEPL",96,0)
 S IBCNT=IBCNT+2
"RTN","IBARXEPL",97,0)
 S IBX=$$RXST^IBARXEU(DFN,DT) I $P($G(^IBE(354.6,IBLET,0)),"^",3)'=2,$P(IBX,"^",3)=120 S Y=$$PLUS^IBARXEU0($P(IBX,"^",5)) W ?(IOM-28),"Renewal Date: " D DT^DIQ
"RTN","IBARXEPL",98,0)
 ;
"RTN","IBARXEPL",99,0)
 ; -- print pt. name and address
"RTN","IBARXEPL",100,0)
 F IBCNT=IBCNT:1:(IBALIN-1) W !
"RTN","IBARXEPL",101,0)
 W !?TAB,$P(IBNAM,",",2)," ",$P(IBNAM,",") D ADD^VADPT S IBCNT=IBCNT+1
"RTN","IBARXEPL",102,0)
 S IBCONF=$$CONFADD^IBARXEL() ; Should we use Confidential Address?
"RTN","IBARXEPL",103,0)
 W !?TAB,VAPA($S(IBCONF:13,1:1)) S IBCNT=IBCNT+1
"RTN","IBARXEPL",104,0)
 I VAPA($S(IBCONF:14,1:2))'="" W !?TAB,VAPA($S(IBCONF:14,1:2)) I VAPA($S(IBCONF:15,1:3))'="" W ", ",VAPA($S(IBCONF:15,1:3)) S IBCNT=IBCNT+1
"RTN","IBARXEPL",105,0)
 W !?TAB,VAPA($S(IBCONF:16,1:4)),", ",$P($G(^DIC(5,+VAPA($S(IBCONF:17,1:5)),0)),"^",2),"  ",$S(IBCONF:$P(VAPA(18),"^",2),1:VAPA(6)) S IBCNT=IBCNT+1
"RTN","IBARXEPL",106,0)
 I $E(IOST,1,2)="C-" D PAUSE^IBOUTL Q:IBQUIT
"RTN","IBARXEPL",107,0)
 ;
"RTN","IBARXEPL",108,0)
 ; -- print main body
"RTN","IBARXEPL",109,0)
 W !! S IBCNT=IBCNT+2
"RTN","IBARXEPL",110,0)
 K ^UTILITY($J,"W"),DIWR,DIWL,DIWF,DN S DIWL=1,DIWF="C80WN"
"RTN","IBARXEPL",111,0)
 S IB=0 F  S IB=$O(^IBE(354.6,IBLET,1,IB)) Q:IB=""  S X=$G(^(IB,0)) D ^DIWP S IBCNT=IBCNT+1 ; W !,X
"RTN","IBARXEPL",112,0)
 D ^DIWW K ^UTILITY($J,"W")
"RTN","IBARXEPL",113,0)
 I $E(IOST,1,2)="C-" D PAUSE^IBOUTL Q:IBQUIT
"RTN","IBARXEPL",114,0)
 W:$E(IOST,1,2)'="C-" @IOF
"RTN","IBARXEPL",115,0)
 Q
"RTN","IBARXEPL",116,0)
 ;
"RTN","IBARXEPL",117,0)
FINAL ; -- Print last page
"RTN","IBARXEPL",118,0)
 W @IOF,!!!,?20,"EXEMPTION LETTERS PRINTING COMPLETED"
"RTN","IBARXEPL",119,0)
 W !!,?20,$G(IBCNTL)," LETTERS PRINTED"
"RTN","IBARXEPL",120,0)
 Q
"RTN","IBCU5")
0^4^B14993646
"RTN","IBCU5",1,0)
IBCU5 ;ALB/AAS - MCCR MAILING ADDRESS UTILITY ROUTINE ;26-FEB-90
"RTN","IBCU5",2,0)
 ;;2.0;INTEGRATED BILLING;**8,52,80,117,51,206**;21-MAR-94
"RTN","IBCU5",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCU5",4,0)
 ;
"RTN","IBCU5",5,0)
 ;MAP TO DGCRU5
"RTN","IBCU5",6,0)
 ;
"RTN","IBCU5",7,0)
EN ;Entry from X-REF from who's responsible
"RTN","IBCU5",8,0)
 ;doesn't set primary insurance field, must be second trigger.
"RTN","IBCU5",9,0)
 S X=$P(^DGCR(399,DA,0),"^",11)
"RTN","IBCU5",10,0)
 I X="p" D MAILP G ENQ
"RTN","IBCU5",11,0)
 I X="o" S DGTAG=$S('$D(^DGCR(399,DA,"M")):"MAILP",'$P(^("M"),"^",11):"MAILP",'$D(^DIC(4,$P(^("M"),"^",11),0)):"MAILP",1:"MAILIN") D @DGTAG G ENQ
"RTN","IBCU5",12,0)
 I X="i",+$G(^DGCR(399,DA,"MP")) D MAILA G ENQ
"RTN","IBCU5",13,0)
ENQ K DGTAG Q
"RTN","IBCU5",14,0)
 ;
"RTN","IBCU5",15,0)
EN1 ;Now Trigger of primary insurance policy from who's responsible
"RTN","IBCU5",16,0)
 ;if only one active policy
"RTN","IBCU5",17,0)
 ;; old Trigger of primary insurer from who's responsible
"RTN","IBCU5",18,0)
 ;Only should be called if primary insurer is null (condition of trigger)
"RTN","IBCU5",19,0)
 ;return ifn of insurer in X
"RTN","IBCU5",20,0)
 ;
"RTN","IBCU5",21,0)
 S X=""
"RTN","IBCU5",22,0)
 I $S('$D(IBAC):1,IBAC=6:1,1:0) Q
"RTN","IBCU5",23,0)
 ;
"RTN","IBCU5",24,0)
 S IBINDT=$S($G(IBIDS(151)):IBIDS(151),$P($G(^DGCR(399,DA,"U")),"^"):$P($G(^DGCR(399,DA,"U")),"^"),1:DT)
"RTN","IBCU5",25,0)
 D ALL^IBCNS1(DFN,"IBDD",2,IBINDT)
"RTN","IBCU5",26,0)
 I $G(IBDD(0))=1 S X=+$O(IBDD(0)) G EN1Q
"RTN","IBCU5",27,0)
 ;
"RTN","IBCU5",28,0)
 ;S IBOUTP=1,IBINDT=$S($G(IBIDS(151)):IBIDS(151),$P($G(^DGCR(399,DA,"U")),"^"):$P($G(^DGCR(399,DA,"U")),"^"),1:DT)
"RTN","IBCU5",29,0)
 ;D ^IBCNS I IBINS S X=IBDD($O(IBDD(0))) S:$O(IBDD(+X)) X="" S X=$S($D(^DIC(36,+X,0)):+X,1:"") G EN1Q
"RTN","IBCU5",30,0)
 S X=""
"RTN","IBCU5",31,0)
EN1Q K IBDD,IBINS,IBIN Q
"RTN","IBCU5",32,0)
 ;
"RTN","IBCU5",33,0)
MAILA ;Store Mailing Address for Bill Payer Carrier (and if not copying  bill or bill not authorized,
"RTN","IBCU5",34,0)
 ; insert Attending Physican Id [36,.1] into Form Locator 92 [399,213]
"RTN","IBCU5",35,0)
 ;
"RTN","IBCU5",36,0)
 S DA=$S('$D(DA):IBIFN,DA']"":IBIFN,1:DA)
"RTN","IBCU5",37,0)
 G MAILQ:$P(^DGCR(399,DA,0),U,11)="p" ; Patient is responsible for bill
"RTN","IBCU5",38,0)
 G MAILQ:$P(^DGCR(399,DA,0),U,11)="o" ; Other party is responsible for bill
"RTN","IBCU5",39,0)
 ;
"RTN","IBCU5",40,0)
 S IB01=+$G(^DGCR(399,DA,"MP"))
"RTN","IBCU5",41,0)
 G MAILQ:'$D(^DIC(36,+IB01,0)) ; Bad insurance data
"RTN","IBCU5",42,0)
 ;
"RTN","IBCU5",43,0)
 S IB02=$$ADD^IBCNADD(DA)
"RTN","IBCU5",44,0)
 ;
"RTN","IBCU5",45,0)
 D UPDMA(DA,IB01,IB02)
"RTN","IBCU5",46,0)
 ;
"RTN","IBCU5",47,0)
 I '$D(IBCAN)!($G(IBAC)<3) S $P(^DGCR(399,DA,"U1"),U,13)=$P($G(^DIC(36,+IB01,0)),U,10)
"RTN","IBCU5",48,0)
 ;
"RTN","IBCU5",49,0)
MAILQ K IB01,IB02,IB03 Q
"RTN","IBCU5",50,0)
 ;
"RTN","IBCU5",51,0)
UPDMA(DA,IB01,IB02) ; Update insurance company mailing address in file 399
"RTN","IBCU5",52,0)
 ; DA = bill ifn
"RTN","IBCU5",53,0)
 ;IB02 = string returned from call to ADD^IBCNADD
"RTN","IBCU5",54,0)
 ;IB01 = insurance company ifn
"RTN","IBCU5",55,0)
 S $P(^DGCR(399,DA,"M"),"^",4,9)=$E($P($G(^DIC(36,+IB01,0)),"^",1),1,30)_"^"_$P(IB02,"^",1)_"^"_$P(IB02,"^",2)_"^"_$P(IB02,"^",4)_"^"_$P(IB02,"^",5)_"^"_$P(IB02,"^",6)
"RTN","IBCU5",56,0)
 ;
"RTN","IBCU5",57,0)
 ; -- if send bill to employer, piece 7 = name
"RTN","IBCU5",58,0)
 I $P(IB02,"^",8)'="",+$P(IB02,"^",8)'=$P(IB02,"^",8) S $P(^DGCR(399,DA,"M"),"^",4)=$P(IB02,"^",8)
"RTN","IBCU5",59,0)
 ;
"RTN","IBCU5",60,0)
 S $P(^DGCR(399,DA,"M1"),U,1)=$P(IB02,U,3)
"RTN","IBCU5",61,0)
 Q
"RTN","IBCU5",62,0)
 ;
"RTN","IBCU5",63,0)
MAILIN ;Store Mailing Address for Institution
"RTN","IBCU5",64,0)
 S DA=$S('$D(DA):IBIFN,DA']"":IBIFN,1:DA),X=$P(^DGCR(399,DA,"M"),"^",11) G:X']"" MAILINQ G:'$D(^DIC(4,X,0)) MAILINQ
"RTN","IBCU5",65,0)
 S IB01=^DIC(4,X,0),IB02=$S($D(^(1)):^(1),1:"")
"RTN","IBCU5",66,0)
 S $P(^DGCR(399,IBIFN,"M"),"^",4,9)=$P(IB01,U,1)_"^"_$P(IB02,U,1)_"^"_$P(IB02,U,2)_"^"_$P(IB02,U,3)_"^"_$P(IB01,U,2)_"^"_$TR($P(IB02,U,4),"-")
"RTN","IBCU5",67,0)
 S $P(^DGCR(399,IBIFN,"M1"),"^",1)=""
"RTN","IBCU5",68,0)
MAILINQ K IB01,IB02,IB03 Q
"RTN","IBCU5",69,0)
 ;
"RTN","IBCU5",70,0)
MAILP ;Store Patient Mailing address
"RTN","IBCU5",71,0)
 N DFN,VAPA,DGNAM,IBCONF
"RTN","IBCU5",72,0)
 S DA=$S('$D(DA):IBIFN,DA']"":IBIFN,1:DA)
"RTN","IBCU5",73,0)
 S DFN=$P(^DGCR(399,DA,0),"^",2),VAPA("P")="" D DEM^VADPT,ADD^VADPT
"RTN","IBCU5",74,0)
 S IBCONF=$S('$G(VAPA(12)):0,$P($G(VAPA(22,3)),U,3)'="Y":0,1:1) ; Confidential Address
"RTN","IBCU5",75,0)
 S DGNAM=$P(VADM(1),",",2)_" "_$P(VADM(1),",",1)
"RTN","IBCU5",76,0)
 S DGNAM=$S($E(VADM(5))'="F":"MR.",'$D(^DIC(11,+$P(^DPT(DFN,0),"^",5),0)):"MS.","DMW"[$E(^DIC(11,$P(^DPT(DFN,0),"^",5),0)):"MRS.",1:"MS.")_DGNAM
"RTN","IBCU5",77,0)
 S $P(^DGCR(399,DA,"M"),"^",4)=DGNAM
"RTN","IBCU5",78,0)
 I IBCONF D  ; use conf. address for mailing
"RTN","IBCU5",79,0)
 . S $P(^DGCR(399,DA,"M"),"^",5,9)=VAPA(13)_"^"_VAPA(14)_"^"_VAPA(16)_"^"_+VAPA(17)_"^"_$P(VAPA(18),U,1)
"RTN","IBCU5",80,0)
 . S $P(^DGCR(399,DA,"M1"),"^",1)=VAPA(15)
"RTN","IBCU5",81,0)
 I 'IBCONF D
"RTN","IBCU5",82,0)
 . S $P(^DGCR(399,DA,"M"),"^",5,9)=VAPA(1)_"^"_VAPA(2)_"^"_VAPA(4)_"^"_+VAPA(5)_"^"_$P(VAPA(11),U,1)
"RTN","IBCU5",83,0)
 . S $P(^DGCR(399,DA,"M1"),"^",1)=VAPA(3)
"RTN","IBCU5",84,0)
MAILPQ Q
"RTN","IBCU5",85,0)
 ;
"RTN","IBCU5",86,0)
INSUR ;
"RTN","IBCU5",87,0)
 Q
"RTN","IBCU5",88,0)
DEL S $P(^DGCR(399,DA,"M"),"^",4,9)="^^^^^",$P(^("M1"),"^",1)=""
"RTN","IBCU5",89,0)
 Q
"VER")
8.0^22.0
**END**
**END**
