Released OR*3*250 SEQ #234
Extracted from mail message
**KIDS**:OR*3.0*250^

**INSTALL NAME**
OR*3.0*250
"BLD",6808,0)
OR*3.0*250^ORDER ENTRY/RESULTS REPORTING^0^3061023^y
"BLD",6808,1,0)
^^5^5^3060509^
"BLD",6808,1,1,0)
This patch addresses problems with:
"BLD",6808,1,2,0)
-The LAB Quick Orders not displaying (CH) LAB Quick Orders.
"BLD",6808,1,3,0)
-Expert System VITALS^ORQQVI not finding all vital measurements.
"BLD",6808,1,4,0)
-Display Patient Alerts and Alert Recipients, display truncating Order 
"BLD",6808,1,5,0)
 number.   
"BLD",6808,4,0)
^9.64PA^^
"BLD",6808,6.3)
1
"BLD",6808,"KRN",0)
^9.67PA^8989.52^19
"BLD",6808,"KRN",.4,0)
.4
"BLD",6808,"KRN",.401,0)
.401
"BLD",6808,"KRN",.402,0)
.402
"BLD",6808,"KRN",.403,0)
.403
"BLD",6808,"KRN",.5,0)
.5
"BLD",6808,"KRN",.84,0)
.84
"BLD",6808,"KRN",3.6,0)
3.6
"BLD",6808,"KRN",3.8,0)
3.8
"BLD",6808,"KRN",9.2,0)
9.2
"BLD",6808,"KRN",9.8,0)
9.8
"BLD",6808,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6808,"KRN",9.8,"NM",1,0)
ORB3U1^^0^B66271462
"BLD",6808,"KRN",9.8,"NM",2,0)
ORQQVI^^0^B39275783
"BLD",6808,"KRN",9.8,"NM",3,0)
ORWDLR32^^0^B56521033
"BLD",6808,"KRN",9.8,"NM","B","ORB3U1",1)

"BLD",6808,"KRN",9.8,"NM","B","ORQQVI",2)

"BLD",6808,"KRN",9.8,"NM","B","ORWDLR32",3)

"BLD",6808,"KRN",19,0)
19
"BLD",6808,"KRN",19.1,0)
19.1
"BLD",6808,"KRN",101,0)
101
"BLD",6808,"KRN",409.61,0)
409.61
"BLD",6808,"KRN",771,0)
771
"BLD",6808,"KRN",870,0)
870
"BLD",6808,"KRN",8989.51,0)
8989.51
"BLD",6808,"KRN",8989.52,0)
8989.52
"BLD",6808,"KRN",8994,0)
8994
"BLD",6808,"KRN","B",.4,.4)

"BLD",6808,"KRN","B",.401,.401)

"BLD",6808,"KRN","B",.402,.402)

"BLD",6808,"KRN","B",.403,.403)

"BLD",6808,"KRN","B",.5,.5)

"BLD",6808,"KRN","B",.84,.84)

"BLD",6808,"KRN","B",3.6,3.6)

"BLD",6808,"KRN","B",3.8,3.8)

"BLD",6808,"KRN","B",9.2,9.2)

"BLD",6808,"KRN","B",9.8,9.8)

"BLD",6808,"KRN","B",19,19)

"BLD",6808,"KRN","B",19.1,19.1)

"BLD",6808,"KRN","B",101,101)

"BLD",6808,"KRN","B",409.61,409.61)

"BLD",6808,"KRN","B",771,771)

"BLD",6808,"KRN","B",870,870)

"BLD",6808,"KRN","B",8989.51,8989.51)

"BLD",6808,"KRN","B",8989.52,8989.52)

"BLD",6808,"KRN","B",8994,8994)

"BLD",6808,"QUES",0)
^9.62^^
"BLD",6808,"REQB",0)
^9.611^3^2
"BLD",6808,"REQB",2,0)
OR*3.0*220^2
"BLD",6808,"REQB",3,0)
OR*3.0*215^2
"BLD",6808,"REQB","B","OR*3.0*215",3)

"BLD",6808,"REQB","B","OR*3.0*220",2)

"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2971217^2980417^1271
"PKG",167,22,1,"PAH",1,0)
250^3061023
"PKG",167,22,1,"PAH",1,1,0)
^^5^5^3061023
"PKG",167,22,1,"PAH",1,1,1,0)
This patch addresses problems with:
"PKG",167,22,1,"PAH",1,1,2,0)
-The LAB Quick Orders not displaying (CH) LAB Quick Orders.
"PKG",167,22,1,"PAH",1,1,3,0)
-Expert System VITALS^ORQQVI not finding all vital measurements.
"PKG",167,22,1,"PAH",1,1,4,0)
-Display Patient Alerts and Alert Recipients, display truncating Order 
"PKG",167,22,1,"PAH",1,1,5,0)
 number.   
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORB3U1")
0^1^B66271462^B62203040
"RTN","ORB3U1",1,0)
ORB3U1 ; slc/CLA - Utilities which support OE/RR 3 Notifications ;12/15/97
"RTN","ORB3U1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**9,74,88,91,105,179,220,250**;Dec 17, 1997;Build 1
"RTN","ORB3U1",3,0)
 Q
"RTN","ORB3U1",4,0)
LIST(Y) ;return list of notifications from Notification File [#100.9]
"RTN","ORB3U1",5,0)
 ; RETURN IEN^NAME^URGENCY
"RTN","ORB3U1",6,0)
 N I,J,V
"RTN","ORB3U1",7,0)
 S I=1
"RTN","ORB3U1",8,0)
 S J=0 F  S J=$O(^ORD(100.9,"B",J)) Q:J=""  S V=0,V=$O(^ORD(100.9,"B",J,V)) S Y(I)=V_"^"_J_"^"_^ORD(100.9,V,3),I=I+1
"RTN","ORB3U1",9,0)
 Q
"RTN","ORB3U1",10,0)
 ;
"RTN","ORB3U1",11,0)
ALRTHX ;report the recipients for an alert, when received, action taken
"RTN","ORB3U1",12,0)
 N ORBDFN,ORBSDT,ORBEDT
"RTN","ORB3U1",13,0)
 ;prompt for patient (required):
"RTN","ORB3U1",14,0)
 K DIC S DIC="^DPT(",DIC("A")="PATIENT (req'd): ",DIC(0)="AEQNM" D ^DIC
"RTN","ORB3U1",15,0)
 I Y<1 K DIC,Y Q
"RTN","ORB3U1",16,0)
 S ORBDFN=+Y,ORBPT=$P(Y,U,2)
"RTN","ORB3U1",17,0)
 K DIC,Y,DUOUT,DTOUT
"RTN","ORB3U1",18,0)
 ;
"RTN","ORB3U1",19,0)
 S %DT="AET",%DT("A")="Start Date/Time (req'd): ",%DT("B")="T-30" D ^%DT
"RTN","ORB3U1",20,0)
 I Y<1 K %DT,Y Q
"RTN","ORB3U1",21,0)
 S ORBSDT=Y
"RTN","ORB3U1",22,0)
 ;
"RTN","ORB3U1",23,0)
 S %DT="AET",%DT("A")="End Date/Time (req'd): ",%DT("B")="NOW" D ^%DT
"RTN","ORB3U1",24,0)
 I Y<1 K %DT,Y Q
"RTN","ORB3U1",25,0)
 S ORBEDT=Y
"RTN","ORB3U1",26,0)
 ;
"RTN","ORB3U1",27,0)
 ;get alerts for this patient from the alert tracking file:
"RTN","ORB3U1",28,0)
 D PATIENT^XQALERT("^TMP(""ORB"",$J)",ORBDFN,ORBSDT,ORBEDT)
"RTN","ORB3U1",29,0)
 W !!,"Processing..."
"RTN","ORB3U1",30,0)
 ;
"RTN","ORB3U1",31,0)
 D EN^VALM("OR PATIENT ALERTS")
"RTN","ORB3U1",32,0)
 Q
"RTN","ORB3U1",33,0)
SELECT ;if one or more alerts selected, display/print recipient data:
"RTN","ORB3U1",34,0)
 N ORN,ORNUMS,ORI,ORJ,ORBAL,ORBAID,ORBSMSG,ORY,DESC,HDR
"RTN","ORB3U1",35,0)
 S ORNUMS=$P(XQORNOD(0),"=",2)
"RTN","ORB3U1",36,0)
 Q:'$L(ORNUMS)
"RTN","ORB3U1",37,0)
 D FULL^VALM1
"RTN","ORB3U1",38,0)
 ;
"RTN","ORB3U1",39,0)
 S ORJ=1
"RTN","ORB3U1",40,0)
 F ORI=1:1:$L(ORNUMS,",")-1 D
"RTN","ORB3U1",41,0)
 .S ORN=$P(ORNUMS,",",ORI)
"RTN","ORB3U1",42,0)
 .S ORBAL=$G(^TMP("OR",$J,"ALERTS","IDX",ORN)) I $L(ORBAL) D
"RTN","ORB3U1",43,0)
 ..S ORBAID=$P(ORBAL,U)
"RTN","ORB3U1",44,0)
 ..S ORBSMSG=$P(ORBAL,U,2)
"RTN","ORB3U1",45,0)
 ..S ORY(ORJ)="RECIPIENTS OF ALERT: "_ORBSMSG,ORJ=ORJ+1
"RTN","ORB3U1",46,0)
 ..D GETRECS(ORBAID)  ;get recipient data
"RTN","ORB3U1",47,0)
 ..S ORJ=ORJ+1,ORY(ORJ)="",ORJ=ORJ+1,ORY(ORJ)="",ORJ=ORJ+1
"RTN","ORB3U1",48,0)
 S DESC="Recipients of a Kernel Alert"
"RTN","ORB3U1",49,0)
 S HDR="RECIPIENTS OF ALERTS FOR PATIENT: "_ORBPT
"RTN","ORB3U1",50,0)
 D OUTPUT(.ORY,DESC,HDR)
"RTN","ORB3U1",51,0)
 S VALMBCK="R"
"RTN","ORB3U1",52,0)
 Q
"RTN","ORB3U1",53,0)
LMHDR ; header for ListMgr display
"RTN","ORB3U1",54,0)
 S VALMHDR(1)="Alerts for "_ORBPT
"RTN","ORB3U1",55,0)
 Q
"RTN","ORB3U1",56,0)
LMHELP ; help for List Mgr display
"RTN","ORB3U1",57,0)
 N X
"RTN","ORB3U1",58,0)
 D FULL^VALM1 S VALMBCK="R"
"RTN","ORB3U1",59,0)
 W !!,"Enter the display number of the alert whose recipients you wish to review in detail."
"RTN","ORB3U1",60,0)
 W !!,"Press <return> to continue ..."
"RTN","ORB3U1",61,0)
 R X:DTIME
"RTN","ORB3U1",62,0)
 Q
"RTN","ORB3U1",63,0)
LMEXIT ; exit code for List Mgr display
"RTN","ORB3U1",64,0)
 D CLEAR^VALM1
"RTN","ORB3U1",65,0)
 K ORBPT,^TMP("OR",$J,"ALERTS"),XQORM("ALT"),^TMP("ORB",$J)
"RTN","ORB3U1",66,0)
 Q
"RTN","ORB3U1",67,0)
LMALT ; alternative selection code
"RTN","ORB3U1",68,0)
 D FULL^VALM1
"RTN","ORB3U1",69,0)
 S VALMBCK="R"
"RTN","ORB3U1",70,0)
 Q
"RTN","ORB3U1",71,0)
LMENTRY ; entry code for List Mgr display
"RTN","ORB3U1",72,0)
 N ORBA,ORBAID,ORBDT,ORBMSG,ORBX,ORNUM,ORDATA,ORAD,LCNT,NUM
"RTN","ORB3U1",73,0)
 N ORX,ORY,ORBMSGP1,ORBMSGP2
"RTN","ORB3U1",74,0)
 ;
"RTN","ORB3U1",75,0)
 D CLEAN^VALM10
"RTN","ORB3U1",76,0)
 ;
"RTN","ORB3U1",77,0)
 S ORBA="" F  S ORBA=$O(^TMP("ORB",$J,ORBA)) Q:ORBA=""  D
"RTN","ORB3U1",78,0)
 .S ORBX=$G(^TMP("ORB",$J,ORBA)) I $L(ORBX) D
"RTN","ORB3U1",79,0)
 ..S ORBAID=$P(ORBX,U,2)
"RTN","ORB3U1",80,0)
 ..Q:$P(ORBAID,",")'="OR"  ;quit if not "OR" (OE/RR Notifications) alert
"RTN","ORB3U1",81,0)
 ..W "."
"RTN","ORB3U1",82,0)
 ..;
"RTN","ORB3U1",83,0)
 ..;get alert details:
"RTN","ORB3U1",84,0)
 ..D ALERTDAT^XQALBUTL(ORBAID,"ORAD")
"RTN","ORB3U1",85,0)
 ..S ORBMSG=ORAD(1.01) I $L(ORBMSG) D
"RTN","ORB3U1",86,0)
 ...S ORBDT=$P(ORAD(.02),U)
"RTN","ORB3U1",87,0)
 ...S ORDATA=$G(ORAD(2))
"RTN","ORB3U1",88,0)
 ...S ORNUM=""
"RTN","ORB3U1",89,0)
 ...I ORDATA["@" S ORNUM=$P(ORDATA,"@")
"RTN","ORB3U1",90,0)
 ...S ORNUM=$S(+$G(ORNUM)>0:"["_+ORNUM_"]",1:"")
"RTN","ORB3U1",91,0)
 ...S ORBMSG=$P(ORBMSG,"): ",2)
"RTN","ORB3U1",92,0)
 ...S ORBMSGP1=$P(ORBMSG,":",1)   ;jeh
"RTN","ORB3U1",93,0)
 ...S ORBMSGP2=$P(ORBMSG,":",2,3)   ;jeh 
"RTN","ORB3U1",94,0)
 ...I $G(ORBMSGP1)="Order(s) needing clarification" D    ;jeh Shorten output to make room for OR IEN 
"RTN","ORB3U1",95,0)
 ....S ORBMSGP1="Order needs clarifying"  ;jeh
"RTN","ORB3U1",96,0)
 ....S ORBMSG=ORBMSGP1_":"_ORBMSGP2   ;jeh
"RTN","ORB3U1",97,0)
 ...S ORBMSG=$E(ORBMSG_$S($L(ORNUM):" "_$G(ORNUM),1:"")_U_"                                                            ",1,60)
"RTN","ORB3U1",98,0)
 ...S ^TMP("OR",$J,"ALERTS","B",9999999-ORBDT_ORBAID)=ORBAID_U_$P(ORBMSG,U)_U_$$FMTE^XLFDT($E(ORBDT,1,12),"2")
"RTN","ORB3U1",99,0)
 ;
"RTN","ORB3U1",100,0)
 S (LCNT,NUM)=0
"RTN","ORB3U1",101,0)
 S ORX="" F  S ORX=$O(^TMP("OR",$J,"ALERTS","B",ORX)) Q:ORX=""  D
"RTN","ORB3U1",102,0)
 .S ORY=^TMP("OR",$J,"ALERTS","B",ORX)
"RTN","ORB3U1",103,0)
 .S ORBMSG=$P(ORY,U,2)
"RTN","ORB3U1",104,0)
 .S ORBDT=$P(ORY,U,3)
"RTN","ORB3U1",105,0)
 .S LCNT=LCNT+1,NUM=NUM+1
"RTN","ORB3U1",106,0)
 .S ^TMP("OR",$J,"ALERTS","IDX",NUM)=ORY   ;alert id^text^date/time
"RTN","ORB3U1",107,0)
 .S ^TMP("OR",$J,"ALERTS",LCNT,0)=$$LJ^XLFSTR(NUM,4)_$$LJ^XLFSTR(ORBMSG,61)_$$LJ^XLFSTR(ORBDT,15)
"RTN","ORB3U1",108,0)
 .D CNTRL^VALM10(LCNT,1,5,IOINHI,IOINORM)
"RTN","ORB3U1",109,0)
 ;
"RTN","ORB3U1",110,0)
 S ^TMP("OR",$J,"ALERTS",0)=LCNT_U_NUM_U_"Patient Alerts"
"RTN","ORB3U1",111,0)
 S ^TMP("OR",$J,"ALERTS","#")=$O(^ORD(101,"B","OR SELECT ALERTS",0))_"^1:"_NUM
"RTN","ORB3U1",112,0)
 K VALMHDR
"RTN","ORB3U1",113,0)
 S VALMCNT=LCNT,VALMBG=1,VALMBCK="R"
"RTN","ORB3U1",114,0)
 Q
"RTN","ORB3U1",115,0)
GETRECS(ORBAID)  ;get recipient data for an alert
"RTN","ORB3U1",116,0)
 N ORX,ORBI,ORBR,ORBHX
"RTN","ORB3U1",117,0)
 D AHISTORY^XQALBUTL(ORBAID,"ORBHX")
"RTN","ORB3U1",118,0)
 S:$L($G(ORBHX(20,0))) ORX=$P(ORBHX(20,0),U,4)
"RTN","ORB3U1",119,0)
 F ORBI=1:1:ORX D
"RTN","ORB3U1",120,0)
 .S ORBR=ORBHX(20,ORBI,0)
"RTN","ORB3U1",121,0)
 .S ORY(ORJ)="",ORJ=ORJ+1
"RTN","ORB3U1",122,0)
 .S ORY(ORJ)=$P(^VA(200,$P(ORBR,U),0),U),ORJ=ORJ+1
"RTN","ORB3U1",123,0)
 .S ORY(ORJ)="  1st displayed to recipient: "_$$FMTE^XLFDT($P(ORBR,U,2),"1"),ORJ=ORJ+1
"RTN","ORB3U1",124,0)
 .S ORY(ORJ)="  1st selected by recipient:  "_$$FMTE^XLFDT($P(ORBR,U,3),"1"),ORJ=ORJ+1
"RTN","ORB3U1",125,0)
 .S ORY(ORJ)="  Processed by recipient:     "_$$FMTE^XLFDT($P(ORBR,U,4),"1"),ORJ=ORJ+1
"RTN","ORB3U1",126,0)
 .S ORY(ORJ)="  Deleted:                    "_$$FMTE^XLFDT($P(ORBR,U,5),"1"),ORJ=ORJ+1
"RTN","ORB3U1",127,0)
 .S ORY(ORJ)="  Auto deleted:               "_$$FMTE^XLFDT($P(ORBR,U,6),"1"),ORJ=ORJ+1
"RTN","ORB3U1",128,0)
 .S ORY(ORJ)="  Forwarded by:               "_$S($P(ORBR,U,7):$P(^VA(200,$P(ORBR,U,7),0),U),1:""),ORJ=ORJ+1
"RTN","ORB3U1",129,0)
 .S ORY(ORJ)="  Forwarded to recipient:     "_$$FMTE^XLFDT($P(ORBR,U,8),"1"),ORJ=ORJ+1
"RTN","ORB3U1",130,0)
 .S ORY(ORJ)="  Non-process deletion by:    "_$S($P(ORBR,U,9):$P(^VA(200,$P(ORBR,U,9),0),U),1:""),ORJ=ORJ+1
"RTN","ORB3U1",131,0)
 Q
"RTN","ORB3U1",132,0)
RECIPS ;determine/report the list of recipients for a notification
"RTN","ORB3U1",133,0)
 N ORY,ORN,ORBDFN,ORNUM,ORBADUZ,DESC,HDR,ORBPR,ORDIV
"RTN","ORB3U1",134,0)
 ;prompt for patient (required):
"RTN","ORB3U1",135,0)
 K DIC S DIC="^DPT(",DIC("A")="PATIENT (req'd): ",DIC(0)="AEQNM" D ^DIC Q:Y<1
"RTN","ORB3U1",136,0)
 S ORBDFN=+Y
"RTN","ORB3U1",137,0)
 Q:$D(DUOUT)
"RTN","ORB3U1",138,0)
 K DIC,Y,DUOUT,DTOUT
"RTN","ORB3U1",139,0)
 ;
"RTN","ORB3U1",140,0)
 ;prompt for notification (required):
"RTN","ORB3U1",141,0)
 S DIC="^ORD(100.9,",DIC("A")="NOTIFICATION (req'd): ",DIC(0)="AEQN" D ^DIC Q:Y<1
"RTN","ORB3U1",142,0)
 S ORN=+Y
"RTN","ORB3U1",143,0)
 Q:$D(DUOUT)
"RTN","ORB3U1",144,0)
 K DIC,Y,DUOUT,DTOUT
"RTN","ORB3U1",145,0)
 ;
"RTN","ORB3U1",146,0)
 S ORBPR=$$GET^XPAR("DIV^SYS^PKG","ORB PROVIDER RECIPIENTS",ORN,"I")
"RTN","ORB3U1",147,0)
 ;
"RTN","ORB3U1",148,0)
 ;prompt for order num if notif processes order num or is a flagged oi:
"RTN","ORB3U1",149,0)
 I (ORN=32)!(ORN=41)!(ORN=60)!(ORN=61)!(ORN=64)!(ORN=65)!(ORBPR["O")!(ORBPR["E") D
"RTN","ORB3U1",150,0)
 .K DIR S DIR(0)="NAO^::2",DIR("A")="ORDER NUMBER: "
"RTN","ORB3U1",151,0)
 .S DIR("?",1)="This notification uses order number to help determine alert recipients."
"RTN","ORB3U1",152,0)
 .S DIR("?",2)="Enter the order number associated with the alert for most accurate results."
"RTN","ORB3U1",153,0)
 .S DIR("?",3)="Order number must be entered as a whole number (e.g. 458829)."
"RTN","ORB3U1",154,0)
 .;
"RTN","ORB3U1",155,0)
 .S DIR("?")=" "
"RTN","ORB3U1",156,0)
 .D ^DIR
"RTN","ORB3U1",157,0)
 .S ORNUM=+Y
"RTN","ORB3U1",158,0)
 .I +$G(ORNUM)>0 D
"RTN","ORB3U1",159,0)
 ..S ORDIV=$$ORDIV^ORB31(ORNUM)
"RTN","ORB3U1",160,0)
 ..S:+$G(ORDIV)>0 ORBPR=$$GET^XPAR(ORDIV_";DIV(4,^SYS^PKG","ORB PROVIDER RECIPIENTS",ORN,"I")
"RTN","ORB3U1",161,0)
 Q:$D(DUOUT)
"RTN","ORB3U1",162,0)
 K DIR,Y,X,DTOUT,DUOUT,DIRUT
"RTN","ORB3U1",163,0)
 ;
"RTN","ORB3U1",164,0)
 ; get recipients for Lab Threshold notif:
"RTN","ORB3U1",165,0)
 I ORN=68 D LABTHR^ORB3U2(.ORBADUZ,ORBDFN,$G(ORNUM))
"RTN","ORB3U1",166,0)
 ;
"RTN","ORB3U1",167,0)
 ;prompt for pkg-defined recips if normally occurs with notif:
"RTN","ORB3U1",168,0)
 I (ORN=21)!(ORN=22)!(ORN=23)!(ORN=27)!(ORN=30)!(ORN=51)!(ORN=52)!(ORN=53)!(ORN=63) D
"RTN","ORB3U1",169,0)
 .F  K DIC,Y S DIC="^VA(200,",DIC(0)="AEQN",DIC("A")="RECIPIENT(S) FROM PACKAGE WHEN NOTIF WAS TRIGGERED: " D ^DIC Q:Y<1  S ORBADUZ(+Y)=""
"RTN","ORB3U1",170,0)
 Q:$D(DUOUT)
"RTN","ORB3U1",171,0)
 K DIC,Y,DUOUT,DTOUT
"RTN","ORB3U1",172,0)
 ;
"RTN","ORB3U1",173,0)
 ;prompt for recips entered at special GUI recipients prompts:
"RTN","ORB3U1",174,0)
 I (ORN=6)!(ORN=33) D
"RTN","ORB3U1",175,0)
 .F  K DIC,Y S DIC="^VA(200,",DIC(0)="AEQN",DIC("A")="RECIPIENT(S) ENTERED AT GUI PROMPTS: " D ^DIC Q:Y<1  S ORBADUZ(+Y)=""
"RTN","ORB3U1",176,0)
 Q:$D(DUOUT)
"RTN","ORB3U1",177,0)
 K DIC,Y,DUOUT,DTOUT
"RTN","ORB3U1",178,0)
 ;
"RTN","ORB3U1",179,0)
 W !,"Processing, please stand by..."
"RTN","ORB3U1",180,0)
 ;determine recipients and why:
"RTN","ORB3U1",181,0)
 S ORY="1"
"RTN","ORB3U1",182,0)
 D UTL^ORB3(.ORY,ORN,ORBDFN,$G(ORNUM),.ORBADUZ,"","")
"RTN","ORB3U1",183,0)
 S DESC="Determine Notification Recipients Report"
"RTN","ORB3U1",184,0)
 S HDR="DETERMINE NOTIFICATION RECIPIENTS REPORT"
"RTN","ORB3U1",185,0)
 D OUTPUT(.ORY,DESC,HDR)
"RTN","ORB3U1",186,0)
 Q
"RTN","ORB3U1",187,0)
OUTPUT(ORY,ORBDESC,ORBHDR) ;prompt for device and send report
"RTN","ORB3U1",188,0)
 N POP
"RTN","ORB3U1",189,0)
 ;prompt for device:
"RTN","ORB3U1",190,0)
 S %ZIS="Q"  ;prompt for Queueing
"RTN","ORB3U1",191,0)
 D ^%ZIS
"RTN","ORB3U1",192,0)
 Q:$G(POP)>0
"RTN","ORB3U1",193,0)
 I $D(IO("Q")) D  ;queue the report
"RTN","ORB3U1",194,0)
 .S ZTRTN="PRINT^ORB3U1"
"RTN","ORB3U1",195,0)
 .S ZTSAVE("ORY(")="",ZTSAVE("ORBHDR")=""
"RTN","ORB3U1",196,0)
 .S ZTDESC=ORBDESC
"RTN","ORB3U1",197,0)
 .D ^%ZTLOAD
"RTN","ORB3U1",198,0)
 .K ZTDESC,ZTRTN,ZTSAVE
"RTN","ORB3U1",199,0)
 .I $D(ZTSK)[0 W !!?5,"Report canceled!"
"RTN","ORB3U1",200,0)
 .E  W !!?5,"Report queued."
"RTN","ORB3U1",201,0)
 .D HOME^%ZIS
"RTN","ORB3U1",202,0)
 K %ZIS
"RTN","ORB3U1",203,0)
 I $D(IO("Q")) K IO("Q") Q
"RTN","ORB3U1",204,0)
PRINT ;print body of Determine Notification Recipients Report
"RTN","ORB3U1",205,0)
 N END,PAGE,X
"RTN","ORB3U1",206,0)
 S (END,PAGE,I)=0
"RTN","ORB3U1",207,0)
 U IO
"RTN","ORB3U1",208,0)
 D @("HDR"_(2-($E(IOST,1,2)="C-")))
"RTN","ORB3U1",209,0)
 F  S I=$O(ORY(I)) Q:I=""!(END=1)  D
"RTN","ORB3U1",210,0)
 .D HDR:$Y+5>IOSL
"RTN","ORB3U1",211,0)
 .Q:END=1
"RTN","ORB3U1",212,0)
 .W !,ORY(I)
"RTN","ORB3U1",213,0)
 I END=1 W !!,"           - Report Interrupted -",!
"RTN","ORB3U1",214,0)
 E  W !!!,"           - End of Report -",!
"RTN","ORB3U1",215,0)
 I ($E(IOST,1,2)="C-") W !,"Press RETURN to continue: " R X:DTIME
"RTN","ORB3U1",216,0)
 D ^%ZISC
"RTN","ORB3U1",217,0)
 D:$G(ZTSK) KILL^%ZTLOAD
"RTN","ORB3U1",218,0)
 Q
"RTN","ORB3U1",219,0)
HDR ;print header of report
"RTN","ORB3U1",220,0)
 I PAGE,($E(IOST,1,2)="C-") D
"RTN","ORB3U1",221,0)
 .W !,"Press RETURN to continue or '^' to exit: "
"RTN","ORB3U1",222,0)
 .R X:DTIME S END='$T!(X="^")
"RTN","ORB3U1",223,0)
 Q:END=1
"RTN","ORB3U1",224,0)
HDR1 W:'($E(IOST,1,2)='"C-"&'PAGE) @IOF
"RTN","ORB3U1",225,0)
HDR2 S PAGE=PAGE+1 W ?20,ORBHDR
"RTN","ORB3U1",226,0)
 W ?(IOM-10),"Page: ",$J(PAGE,3),!!
"RTN","ORB3U1",227,0)
 Q
"RTN","ORQQVI")
0^2^B39275783^B39228695
"RTN","ORQQVI",1,0)
ORQQVI ; slc/STAFF - Functions which return patient vital and I/O data ;2/12/99 [7/26/05 12:51pm]
"RTN","ORQQVI",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,198,215,250**;Dec 17, 1997;Build 1
"RTN","ORQQVI",3,0)
VITALS(ORY,DFN,ORSDT,OREDT) ; return patient's vital measurements taken between start date/time and end date/time
"RTN","ORQQVI",4,0)
 ;ORY: return variable, results are returned in the format:
"RTN","ORQQVI",5,0)
 ;     vital measurement ien^vital type^date/time taken^rate
"RTN","ORQQVI",6,0)
 ;DFN: patient identifier from Patient File [#2]
"RTN","ORQQVI",7,0)
 ;ORSDT: start date/time in Fileman format
"RTN","ORQQVI",8,0)
 ;OREDT: end date/time in Fileman format
"RTN","ORQQVI",9,0)
 K ^UTILITY($J,"GMRVD")
"RTN","ORQQVI",10,0)
 S GMRVSTR="BP;HT;WT;T;R;P;PN" ;dee 2/12/99 added PN
"RTN","ORQQVI",11,0)
 S GMRVSTR(0)=ORSDT_"^"_OREDT_"^"_"^"
"RTN","ORQQVI",12,0)
 D EN1^GMRVUT0
"RTN","ORQQVI",13,0)
 N ORT,ORD,ORI,I
"RTN","ORQQVI",14,0)
 S ORT="",ORD=0,ORI=0,I=0
"RTN","ORQQVI",15,0)
 F  S ORT=$O(^UTILITY($J,"GMRVD",ORT)) Q:ORT=""  D
"RTN","ORQQVI",16,0)
 .F  S ORD=$O(^UTILITY($J,"GMRVD",ORT,ORD)) Q:ORD<1  D
"RTN","ORQQVI",17,0)
 ..F  S ORI=$O(^UTILITY($J,"GMRVD",ORT,ORD,ORI)) Q:ORI<1  D
"RTN","ORQQVI",18,0)
 ...S I=I+1
"RTN","ORQQVI",19,0)
 ...S ORY(I)=ORI_"^"_ORT_"^"_$P(^UTILITY($J,"GMRVD",ORT,ORD,ORI),"^",8)_"^"_$P(^(ORI),"^")
"RTN","ORQQVI",20,0)
 I I=0 S ORY(1)="^No vitals found."
"RTN","ORQQVI",21,0)
 K GMRVSTR
"RTN","ORQQVI",22,0)
 Q
"RTN","ORQQVI",23,0)
 ;
"RTN","ORQQVI",24,0)
XFASTVIT(ORY,DFN,F1,F2) ; return patient's most recent vital measurements
"RTN","ORQQVI",25,0)
 ;ORY: return variable, results are returned in the format:
"RTN","ORQQVI",26,0)
 ;     vital measurement ien^vital type^rate^date/time taken
"RTN","ORQQVI",27,0)
 ;DFN: patient identifier from Patient File [#2]
"RTN","ORQQVI",28,0)
 ; F1 & F2 are ignored
"RTN","ORQQVI",29,0)
 ;
"RTN","ORQQVI",30,0)
 N CNT
"RTN","ORQQVI",31,0)
 S CNT=0
"RTN","ORQQVI",32,0)
 D VITAL("TEMPERATURE","T",DFN,.ORY,.CNT)
"RTN","ORQQVI",33,0)
 D VITAL("PULSE","P",DFN,.ORY,.CNT)
"RTN","ORQQVI",34,0)
 D VITAL("RESPIRATION","R",DFN,.ORY,.CNT)
"RTN","ORQQVI",35,0)
 D VITAL("BLOOD PRESSURE","BP",DFN,.ORY,.CNT)
"RTN","ORQQVI",36,0)
 D VITAL("HEIGHT","HT",DFN,.ORY,.CNT)
"RTN","ORQQVI",37,0)
 D VITAL("WEIGHT","WT",DFN,.ORY,.CNT)
"RTN","ORQQVI",38,0)
 D VITAL("PAIN","PN",DFN,ORY,.CNT) ;dee 2/11/99
"RTN","ORQQVI",39,0)
 Q
"RTN","ORQQVI",40,0)
 ;
"RTN","ORQQVI",41,0)
XVITAL(VITAL,ABBREV,DFN,ORY,CNT) ; get vital measurement
"RTN","ORQQVI",42,0)
 N DATA,IDT,IEN,OK,VTYPE
"RTN","ORQQVI",43,0)
 S VTYPE=$$FIND1^DIC(120.51,"","BX",VITAL,"","","ERR")
"RTN","ORQQVI",44,0)
 I 'VTYPE Q
"RTN","ORQQVI",45,0)
 S OK=0,IDT=0 F  S IDT=$O(^GMR(120.5,"AA",DFN,VTYPE,IDT)) Q:IDT<1  D  Q:OK
"RTN","ORQQVI",46,0)
 .S IEN=0 F  S IEN=$O(^GMR(120.5,"AA",DFN,VTYPE,IDT,IEN)) Q:IEN<1  D  Q:OK
"RTN","ORQQVI",47,0)
 ..I $P($G(^GMR(120.5,IEN,2)),U) Q  ; do not retrieve if entered in error
"RTN","ORQQVI",48,0)
 ..S DATA=$G(^GMR(120.5,IEN,0))
"RTN","ORQQVI",49,0)
 ..I 'DATA Q
"RTN","ORQQVI",50,0)
 ..S CNT=CNT+1,OK=1
"RTN","ORQQVI",51,0)
 ..S ORY(CNT)=IEN_U_ABBREV_U_$P(DATA,U,8)_U_$P(DATA,U)
"RTN","ORQQVI",52,0)
 Q
"RTN","ORQQVI",53,0)
 ;
"RTN","ORQQVI",54,0)
NOTEVIT(ORY,DFN,NOTEIEN) ;
"RTN","ORQQVI",55,0)
 N VSTR,NOTEDATE
"RTN","ORQQVI",56,0)
 D NOTEVSTR^ORWPCE(.VSTR,NOTEIEN)
"RTN","ORQQVI",57,0)
 Q:$P(VSTR,";",2)=""
"RTN","ORQQVI",58,0)
 D FASTVIT(.ORY,DFN,$P(VSTR,";",2))
"RTN","ORQQVI",59,0)
 Q
"RTN","ORQQVI",60,0)
 ;
"RTN","ORQQVI",61,0)
FASTVIT(ORY,DFN,F1,F2) ; return patient's most recent vital measurements
"RTN","ORQQVI",62,0)
 ; in date range
"RTN","ORQQVI",63,0)
 ;ORY: return variable, results are returned in the format:
"RTN","ORQQVI",64,0)
 ;     vital measurement ien^vital type^rate^date/time taken
"RTN","ORQQVI",65,0)
 ;DFN: patient identifier from Patient File [#2]
"RTN","ORQQVI",66,0)
 ; F1: starting date/time range
"RTN","ORQQVI",67,0)
 ; F2: ending date/time range
"RTN","ORQQVI",68,0)
 ;
"RTN","ORQQVI",69,0)
 N CNT,DT1,DT2
"RTN","ORQQVI",70,0)
 S CNT=0
"RTN","ORQQVI",71,0)
 I $G(F1)>0 D
"RTN","ORQQVI",72,0)
 . I $G(F2)="",F1["." S DT1=$P(F1,".",1)_"."_$E($P(F1,".",2),1,4)
"RTN","ORQQVI",73,0)
 . E  S DT1=F1
"RTN","ORQQVI",74,0)
 E  S DT1=1
"RTN","ORQQVI",75,0)
 S DT2=$S($G(F2)>0:F2,DT1>1:DT1,1:9999998)
"RTN","ORQQVI",76,0)
 ;
"RTN","ORQQVI",77,0)
 D VITAL("TEMPERATURE","T",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",78,0)
 D VITAL("PULSE","P",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",79,0)
 D VITAL("RESPIRATION","R",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",80,0)
 D VITAL("BLOOD PRESSURE","BP",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",81,0)
 D VITAL("HEIGHT","HT",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",82,0)
 D VITAL("WEIGHT","WT",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",83,0)
 D VITAL("PAIN","PN",DFN,.ORY,.CNT,DT1,DT2) ;dee 2/11/99
"RTN","ORQQVI",84,0)
 D VITAL("PULSE OXIMETRY","PO2",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",85,0)
 D VITAL("CENTRAL VENOUS PRESSURE","CVP",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",86,0)
 D VITAL("CIRCUMFERENCE/GIRTH","CG",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",87,0)
 Q
"RTN","ORQQVI",88,0)
 ;
"RTN","ORQQVI",89,0)
VITAL(VITAL,ABBREV,DFN,ORY,CNT,F1,F2) ;
"RTN","ORQQVI",90,0)
 ;get most recent vital measurement in date range
"RTN","ORQQVI",91,0)
 N DATA,IDT,ENDIDT,IEN,OK,VTYPE,MVAL,VALUE
"RTN","ORQQVI",92,0)
 S VTYPE=$$FIND1^DIC(120.51,"","BX",VITAL,"","","ERR")
"RTN","ORQQVI",93,0)
 I 'VTYPE Q
"RTN","ORQQVI",94,0)
 S OK=0
"RTN","ORQQVI",95,0)
 S IDT=9999999-(F2+$S(F2#1:.0000001,1:.7))
"RTN","ORQQVI",96,0)
 S ENDIDT=9999999-(F1-.0000001)
"RTN","ORQQVI",97,0)
 F  S IDT=$O(^GMR(120.5,"AA",DFN,VTYPE,IDT)) Q:IDT>ENDIDT!'IDT  D  Q:OK
"RTN","ORQQVI",98,0)
 .S IEN=0 F  S IEN=$O(^GMR(120.5,"AA",DFN,VTYPE,IDT,IEN)) Q:IEN<1  D  Q:OK
"RTN","ORQQVI",99,0)
 ..I $P($G(^GMR(120.5,IEN,2)),U) Q  ; do not retrieve if entered in error
"RTN","ORQQVI",100,0)
 ..S DATA=$G(^GMR(120.5,IEN,0))
"RTN","ORQQVI",101,0)
 ..I 'DATA Q
"RTN","ORQQVI",102,0)
 ..S CNT=CNT+1,OK=1,VALUE=$P(DATA,U,8)
"RTN","ORQQVI",103,0)
 ..; changed to display 'POX' rather than 'PO2' per CQ 10592
"RTN","ORQQVI",104,0)
 ..S ORY(CNT)=IEN_U_$S(ABBREV="PO2":"POX",1:ABBREV)_U_VALUE_U_$P(DATA,U)
"RTN","ORQQVI",105,0)
 ..I $P(ORY(CNT),"^",2)="T" D  ; Temperature.
"RTN","ORQQVI",106,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE_$S($E(VALUE):" F",1:"")
"RTN","ORQQVI",107,0)
 ...S MVAL=+VALUE
"RTN","ORQQVI",108,0)
 ...Q:'MVAL
"RTN","ORQQVI",109,0)
 ...S MVAL=MVAL-32
"RTN","ORQQVI",110,0)
 ...S MVAL=$J((MVAL*(5/9)),3,1)
"RTN","ORQQVI",111,0)
 ...S ORY(CNT)=ORY(CNT)_"^("_MVAL_" C)"
"RTN","ORQQVI",112,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",113,0)
 ..I $P(ORY(CNT),"^",2)="P" D  ; Pulse.
"RTN","ORQQVI",114,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE
"RTN","ORQQVI",115,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",116,0)
 ..I $P(ORY(CNT),"^",2)="R" D  ; Respiration.
"RTN","ORQQVI",117,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE
"RTN","ORQQVI",118,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",119,0)
 ..I $P(ORY(CNT),"^",2)="BP" D  ; Blood Pressure.
"RTN","ORQQVI",120,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE
"RTN","ORQQVI",121,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",122,0)
 ..I $P(ORY(CNT),"^",2)="HT" D  ; Height.
"RTN","ORQQVI",123,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE_$S($E(VALUE):" in",1:"")
"RTN","ORQQVI",124,0)
 ...S MVAL=+VALUE
"RTN","ORQQVI",125,0)
 ...Q:'MVAL
"RTN","ORQQVI",126,0)
 ...S MVAL=$J((MVAL*2.54),3,1)
"RTN","ORQQVI",127,0)
 ...S ORY(CNT)=ORY(CNT)_"^("_MVAL_" cm)"
"RTN","ORQQVI",128,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",129,0)
 ..I $P(ORY(CNT),"^",2)="WT" D  ; Weight.
"RTN","ORQQVI",130,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE_$S($E(VALUE):" lb",1:"")
"RTN","ORQQVI",131,0)
 ...S MVAL=+VALUE
"RTN","ORQQVI",132,0)
 ...Q:'MVAL
"RTN","ORQQVI",133,0)
 ...; changed 2.2 to 2.20462262 per CQ 10637
"RTN","ORQQVI",134,0)
 ...S MVAL=$J((MVAL/2.20462262),3,1)
"RTN","ORQQVI",135,0)
 ...S ORY(CNT)=ORY(CNT)_"^("_MVAL_" kg)"
"RTN","ORQQVI",136,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",137,0)
 ..I $P(ORY(CNT),"^",2)="PN" D   ; Pain
"RTN","ORQQVI",138,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE
"RTN","ORQQVI",139,0)
 ...S $P(ORY(CNT),U,7)="" ;pain doesn't have qualifiers
"RTN","ORQQVI",140,0)
 ..; looks for 'POX' rather than 'PO2' due to change for CQ 10592 above
"RTN","ORQQVI",141,0)
 ..I $P(ORY(CNT),"^",2)="POX" D  ; Pulse Oximetry.
"RTN","ORQQVI",142,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_$P(ORY(CNT),"^",3)
"RTN","ORQQVI",143,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8(+$P(ORY(CNT),U,1))
"RTN","ORQQVI",144,0)
 ...S $P(ORY(CNT),U,8)=$$SUPO2^GMVUTL8(+$P(ORY(CNT),U,1))
"RTN","ORQQVI",145,0)
 ..I $P(ORY(CNT),"^",2)="CVP" D  ; Central Venous Pressure.
"RTN","ORQQVI",146,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_$P(ORY(CNT),"^",3)
"RTN","ORQQVI",147,0)
 ...S MVAL=$P(ORY(CNT),"^",3)
"RTN","ORQQVI",148,0)
 ...I MVAL'=+MVAL,+MVAL=0 S ORY(CNT)=ORY(CNT)_"^",$P(ORY(CNT),U,7)="" Q
"RTN","ORQQVI",149,0)
 ...S MVAL=$J((MVAL/1.36),3,1)
"RTN","ORQQVI",150,0)
 ...S ORY(CNT)=ORY(CNT)_" cmH20^("_MVAL_" mmHg)"
"RTN","ORQQVI",151,0)
 ...S $P(ORY(CNT),U,7)="" ;cvp doesn't have qualifiers
"RTN","ORQQVI",152,0)
 ..I $P(ORY(CNT),"^",2)="CG" D  ; Circumference Girth.
"RTN","ORQQVI",153,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_$P(ORY(CNT),"^",3)
"RTN","ORQQVI",154,0)
 ...S MVAL=$P(ORY(CNT),"^",3)
"RTN","ORQQVI",155,0)
 ...I MVAL'=+MVAL,+MVAL=0 S ORY(CNT)=ORY(CNT)_"^",$P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8(+$P(ORY(CNT),U,1)) Q
"RTN","ORQQVI",156,0)
 ...S MVAL=$J((MVAL*2.54),3,1)
"RTN","ORQQVI",157,0)
 ...S ORY(CNT)=ORY(CNT)_" in^("_MVAL_" cm)"
"RTN","ORQQVI",158,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8(+$P(ORY(CNT),U,1))
"RTN","ORQQVI",159,0)
 Q
"RTN","ORWDLR32")
0^3^B56521033^B52893091
"RTN","ORWDLR32",1,0)
ORWDLR32 ; SLC/KCM/REV/JDL - Lab Calls 6/28/2002
"RTN","ORWDLR32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,141,215,250**;Dec 17, 1997;Build 1
"RTN","ORWDLR32",3,0)
 ;
"RTN","ORWDLR32",4,0)
 ; DBIA 2263   GETLST^XPAR  ^TMP($J,"WC")
"RTN","ORWDLR32",5,0)
 ;
"RTN","ORWDLR32",6,0)
DEF(LST,ALOC,ADIV) ; procedure
"RTN","ORWDLR32",7,0)
 ; For Event Delay Order
"RTN","ORWDLR32",8,0)
 ;  ALOC: Delay Event's default location
"RTN","ORWDLR32",9,0)
 ;  ADIV: Delay Event's default division
"RTN","ORWDLR32",10,0)
 ; get dialog definition specific to lab
"RTN","ORWDLR32",11,0)
 S ILST=0
"RTN","ORWDLR32",12,0)
 S LST($$NXT)="~ShortList" D SHORT
"RTN","ORWDLR32",13,0)
 S LST($$NXT)="~Lab Collection Times" D LCOLLTM
"RTN","ORWDLR32",14,0)
 S LST($$NXT)="~Ward Collection Times" D WCOLLTM
"RTN","ORWDLR32",15,0)
 S LST($$NXT)="~Send Patient Times" D SENDTM
"RTN","ORWDLR32",16,0)
 S LST($$NXT)="~Collection Types" D COLLTYP
"RTN","ORWDLR32",17,0)
 S LST($$NXT)="~Default Urgency" D URGENCY
"RTN","ORWDLR32",18,0)
 S LST($$NXT)="~Schedules" D SCHED
"RTN","ORWDLR32",19,0)
 S LST($$NXT)="~Common" D COMMON
"RTN","ORWDLR32",20,0)
 Q
"RTN","ORWDLR32",21,0)
SHORT ; from DEF, get short list of lab quick orders
"RTN","ORWDLR32",22,0)
 N I,ORTMP,ORDG,A
"RTN","ORWDLR32",23,0)
 S I=$O(^ORD(100.98,"B","LAB",0))  ; get IEN of parent lab
"RTN","ORWDLR32",24,0)
 D DG^ORCHANG1(I,"BILD",.ORDG)   ; find members groups for parent lab
"RTN","ORWDLR32",25,0)
 S I=0
"RTN","ORWDLR32",26,0)
 F  S I=$O(ORDG(I)) Q:'I  D   ; loop through list of members groups
"RTN","ORWDLR32",27,0)
 . D GETQLST^ORWDXQ(.ORTMP,I,"Q")   ;get quick order of each members groups
"RTN","ORWDLR32",28,0)
 . S A=0 F  S A=$O(ORTMP(A)) Q:'A  D   ; loop through returned quick orders and
"RTN","ORWDLR32",29,0)
 . . S LST($$NXT)="i"_ORTMP(A)  ; move quick orders to display list
"RTN","ORWDLR32",30,0)
 . K ORTMP   ; clean up for next members groups of quick orders
"RTN","ORWDLR32",31,0)
 Q
"RTN","ORWDLR32",32,0)
LCOLLTM ; get collection times
"RTN","ORWDLR32",33,0)
 N TDAY,TMRW,IGNOR,CNT,ICTM,ORCTM,DOW,AMPM,DAY,TIME,TXDT
"RTN","ORWDLR32",34,0)
 S TDAY=DT,TDAY("DOW")=$H#7,TDAY("H")=$H,TDAY("TX")="T"
"RTN","ORWDLR32",35,0)
 M TMRW=TDAY D INCDATE(.TMRW)
"RTN","ORWDLR32",36,0)
 I $G(ALOC),'$$GET^XPAR(ALOC_";SC(","LR EXCEPTED LOCATIONS",1,"Q") D
"RTN","ORWDLR32",37,0)
 . S IGNOR=$$GET^XPAR("ALL","LR IGNORE HOLIDAYS",1,"Q")
"RTN","ORWDLR32",38,0)
 . S DOW(0)=$$GET^XPAR("ALL","LR COLLECT THURSDAY",1,"Q")
"RTN","ORWDLR32",39,0)
 . S DOW(1)=$$GET^XPAR("ALL","LR COLLECT FRIDAY",1,"Q")
"RTN","ORWDLR32",40,0)
 . S DOW(2)=$$GET^XPAR("ALL","LR COLLECT SATURDAY",1,"Q")
"RTN","ORWDLR32",41,0)
 . S DOW(3)=$$GET^XPAR("ALL","LR COLLECT SUNDAY",1,"Q")
"RTN","ORWDLR32",42,0)
 . S DOW(4)=$$GET^XPAR("ALL","LR COLLECT MONDAY",1,"Q")
"RTN","ORWDLR32",43,0)
 . S DOW(5)=$$GET^XPAR("ALL","LR COLLECT TUESDAY",1,"Q")
"RTN","ORWDLR32",44,0)
 . S DOW(6)=$$GET^XPAR("ALL","LR COLLECT WEDNESDAY",1,"Q")
"RTN","ORWDLR32",45,0)
 . S CNT=0 F  Q:(DOW(TDAY("DOW"))=1)&((IGNOR=1)!('$D(^HOLIDAY(TDAY,0))))  D  Q:CNT>6
"RTN","ORWDLR32",46,0)
 . . D INCDATE(.TDAY) S CNT=CNT+1
"RTN","ORWDLR32",47,0)
 . S CNT=0 F  Q:(DOW(TMRW("DOW"))=1)&((IGNOR=1)!('$D(^HOLIDAY(TMRW,0))))  D  Q:CNT>6
"RTN","ORWDLR32",48,0)
 . . D INCDATE(.TMRW) S CNT=CNT+1
"RTN","ORWDLR32",49,0)
 I $G(ADIV) D GETLST^XPAR(.ORCTM,ADIV_";DIC(4,^SYS","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR32",50,0)
 E  D GETLST^XPAR(.ORCTM,"ALL","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR32",51,0)
 ;S DUZ(2)=TMPDIV
"RTN","ORWDLR32",52,0)
 S LST($$NXT)="iLNEXT^Next scheduled lab collection"
"RTN","ORWDLR32",53,0)
 S ICTM=0 F  S ICTM=$O(ORCTM(ICTM)) Q:'ICTM  D
"RTN","ORWDLR32",54,0)
 . I $P(ORCTM(ICTM),U)>$P($H,",",2) D
"RTN","ORWDLR32",55,0)
 . . S TXDT=TDAY("TX")
"RTN","ORWDLR32",56,0)
 . . I +TDAY("H")=+$H S DAY="Today"
"RTN","ORWDLR32",57,0)
 . . I TDAY("H")-$H=1 S DAY="Tomorrow"
"RTN","ORWDLR32",58,0)
 . . I TDAY("H")-$H>1 S DAY=$$DOWNAME(TDAY("DOW"))
"RTN","ORWDLR32",59,0)
 . E  D
"RTN","ORWDLR32",60,0)
 . . S TXDT=TMRW("TX")
"RTN","ORWDLR32",61,0)
 . . S DAY=$S(TMRW("H")-$H>1:$$DOWNAME(TMRW("DOW")),1:"Tomorrow")
"RTN","ORWDLR32",62,0)
 . S AMPM=$S($P(ORCTM(ICTM),U,2)>1159:"PM",1:"AM")
"RTN","ORWDLR32",63,0)
 . S TXDT=TXDT_"@"_$P(ORCTM(ICTM),"^",2)
"RTN","ORWDLR32",64,0)
 . S TIME=$P(ORCTM(ICTM),U,2),TIME=$E(TIME,1,2)_":"_$E(TIME,3,4)
"RTN","ORWDLR32",65,0)
 . S LST($$NXT)="iL"_TXDT_U_AMPM_" Collection: "_TIME_" ("_DAY_")"
"RTN","ORWDLR32",66,0)
 . S ^TMP($J,"WC",ILST)="iW"_TXDT_U_TIME_" "_AMPM_" ("_DAY_") Ward collect"  ;DBIA 2263
"RTN","ORWDLR32",67,0)
 ; D NOW^%DTC
"RTN","ORWDLR32",68,0)
 ;S LST($$NXT)="iWNOW^Now (Collect on ward)"
"RTN","ORWDLR32",69,0)
 S LST($$NXT)="iLO^Future"
"RTN","ORWDLR32",70,0)
 Q
"RTN","ORWDLR32",71,0)
WCOLLTM ; get Ward Collect times
"RTN","ORWDLR32",72,0)
 S I=""
"RTN","ORWDLR32",73,0)
 F  S I=$O(^TMP($J,"WC",I)) Q:I=""  D
"RTN","ORWDLR32",74,0)
 . S LST($$NXT)=^TMP($J,"WC",I)
"RTN","ORWDLR32",75,0)
 S LST($$NXT)="iWNOW^Now (Collect on ward)"
"RTN","ORWDLR32",76,0)
 ;S LST($$NXT)="iWO^Other"
"RTN","ORWDLR32",77,0)
 K ^TMP($J,"WC")
"RTN","ORWDLR32",78,0)
 Q
"RTN","ORWDLR32",79,0)
SENDTM ; get send patient times
"RTN","ORWDLR32",80,0)
 ;N X,X1,X2
"RTN","ORWDLR32",81,0)
 S LST($$NXT)="iLT^Today"
"RTN","ORWDLR32",82,0)
 ;S X1=DT,X2=1 D C^%DTC
"RTN","ORWDLR32",83,0)
 S LST($$NXT)="iLT+1^Tomorrow"
"RTN","ORWDLR32",84,0)
 ;S LST($$NXT)="iLO^Other"
"RTN","ORWDLR32",85,0)
 Q
"RTN","ORWDLR32",86,0)
COLLTYP ; Collection Types in effect for this division
"RTN","ORWDLR32",87,0)
 N Y S Y=""
"RTN","ORWDLR32",88,0)
 S LST($$NXT)="iLC^Lab Collect"
"RTN","ORWDLR32",89,0)
 S LST($$NXT)="iWC^Ward Collect"
"RTN","ORWDLR32",90,0)
 S LST($$NXT)="iSP^Send Patient to Lab"
"RTN","ORWDLR32",91,0)
 I +$$ON^LR7OV4(DUZ(2)) S LST($$NXT)="iI^Immediate Collect"
"RTN","ORWDLR32",92,0)
 S:$G(ALOC) Y=$$GET^XPAR("ALL^"_ALOC_";SC(","LR DEFAULT TYPE QUICK")
"RTN","ORWDLR32",93,0)
 I $L(Y) S LST($$NXT)="d"_Y
"RTN","ORWDLR32",94,0)
 Q
"RTN","ORWDLR32",95,0)
INCDATE(ADATE) ; called from COLLTM, increments date nodes in .ADATE
"RTN","ORWDLR32",96,0)
 N X,X1,X2,%H
"RTN","ORWDLR32",97,0)
 S X1=ADATE,X2=1 D C^%DTC S ADATE=X
"RTN","ORWDLR32",98,0)
 S ADATE("H")=ADATE("H")+1
"RTN","ORWDLR32",99,0)
 S ADATE("DOW")=ADATE("H")#7
"RTN","ORWDLR32",100,0)
 S ADATE("TX")="T+"_($P(ADATE("TX"),"+",2)+1)
"RTN","ORWDLR32",101,0)
 Q
"RTN","ORWDLR32",102,0)
DOWNAME(DOW) ; function
"RTN","ORWDLR32",103,0)
 ; Returns Day of Week name (DOW should be $H#7)
"RTN","ORWDLR32",104,0)
 I DOW=0 Q "Thursday"
"RTN","ORWDLR32",105,0)
 I DOW=1 Q "Friday"
"RTN","ORWDLR32",106,0)
 I DOW=2 Q "Saturday"
"RTN","ORWDLR32",107,0)
 I DOW=3 Q "Sunday"
"RTN","ORWDLR32",108,0)
 I DOW=4 Q "Monday"
"RTN","ORWDLR32",109,0)
 I DOW=5 Q "Tuesday"
"RTN","ORWDLR32",110,0)
 I DOW=6 Q "Wednesday"
"RTN","ORWDLR32",111,0)
 Q ""
"RTN","ORWDLR32",112,0)
URGENCY ; return default urgency for lab
"RTN","ORWDLR32",113,0)
 N URG
"RTN","ORWDLR32",114,0)
 S URG=$$DEFURG^LR7OR3
"RTN","ORWDLR32",115,0)
 S LST($$NXT)="i"_URG_U_$P(^LAB(62.05,URG,0),U,1)
"RTN","ORWDLR32",116,0)
 S LST($$NXT)="d"_URG_U_$P(^LAB(62.05,URG,0),U,1)
"RTN","ORWDLR32",117,0)
 Q
"RTN","ORWDLR32",118,0)
SCHED ; return list of schedules available for lab tests
"RTN","ORWDLR32",119,0)
 N X,X0,IEN
"RTN","ORWDLR32",120,0)
 S X="" F  S X=$O(^PS(51.1,"APLR",X)) Q:X=""  S IEN=$O(^(X,0)) I IEN D
"RTN","ORWDLR32",121,0)
 . S X0=$G(^PS(51.1,IEN,0)) Q:X0=""
"RTN","ORWDLR32",122,0)
 . I (($P(X0,U,5)="C")!($P(X0,U,5)="D")),(+$P(X0,U,3)=0) Q
"RTN","ORWDLR32",123,0)
 . S LST($$NXT)="i"_IEN_U_X_U_$P(X0,U,5)_U_$P(X0,U,3)
"RTN","ORWDLR32",124,0)
 . I X="ONE TIME" S LST($$NXT)="d"_IEN_U_X
"RTN","ORWDLR32",125,0)
 Q
"RTN","ORWDLR32",126,0)
COMMON ; return list of commonly ordered lab tests
"RTN","ORWDLR32",127,0)
 N ORLST,IEN,I
"RTN","ORWDLR32",128,0)
 D GETLST^XPAR(.ORLST,"ALL","ORWD COMMON LAB INPT")  ;DBIA 2263
"RTN","ORWDLR32",129,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORWDLR32",130,0)
 . S IEN=$P(ORLST(I),U,2)
"RTN","ORWDLR32",131,0)
 . S LST($$NXT)="i"_IEN_U_$P(^ORD(101.43,IEN,0),U,1)
"RTN","ORWDLR32",132,0)
 Q
"RTN","ORWDLR32",133,0)
LOAD(LST,TESTID) ; procedure
"RTN","ORWDLR32",134,0)
 ; Return sample, specimen, & urgency info about a lab test
"RTN","ORWDLR32",135,0)
 N I,J,X,X1,X4,ORY,ORLABID,ILST,PARAM
"RTN","ORWDLR32",136,0)
 S ILST=0
"RTN","ORWDLR32",137,0)
 S LST($$NXT)="~Test Name"
"RTN","ORWDLR32",138,0)
 S LST($$NXT)="d"_$P(^ORD(101.43,TESTID,0),U,1),ORLABID=$P(^(0),U,2)
"RTN","ORWDLR32",139,0)
 S LST($$NXT)="~Item ID"
"RTN","ORWDLR32",140,0)
 S LST($$NXT)="d"_+ORLABID
"RTN","ORWDLR32",141,0)
 S X=$P(ORLABID,";",1),X1=$P(ORLABID,";",2)
"RTN","ORWDLR32",142,0)
 I $E(X1,1,4)="99VB" S X1=$O(^LAB(60,"B","VBECS "_$P(^ORD(101.43,TESTID,0),"^"),0)) Q:'X1  S X=X1
"RTN","ORWDLR32",143,0)
 S X4=$P($G(^LAB(60,X,0)),U,4)
"RTN","ORWDLR32",144,0)
 S LST(ILST)=LST(ILST)_U_X4
"RTN","ORWDLR32",145,0)
 I $D(^ORD(101.43,TESTID,8))>1 S LST($$NXT)="~OIMessage"
"RTN","ORWDLR32",146,0)
 S I=0 F  S I=$O(^ORD(101.43,TESTID,8,I)) Q:'I  S LST($$NXT)="t"_^(I,0)
"RTN","ORWDLR32",147,0)
 S TESTID=+$P(^ORD(101.43,TESTID,0),U,2)
"RTN","ORWDLR32",148,0)
 D TEST^LR7OR3(TESTID,.ORY)
"RTN","ORWDLR32",149,0)
 S PARAM="" F  S PARAM=$O(ORY(PARAM)) Q:PARAM=""  D
"RTN","ORWDLR32",150,0)
 . S LST($$NXT)="~"_PARAM
"RTN","ORWDLR32",151,0)
 . I PARAM="ReqCom" D
"RTN","ORWDLR32",152,0)
 . . S LST($$NXT)="d"_$G(ORY("ReqCom")) Q
"RTN","ORWDLR32",153,0)
 . I PARAM="Default CollSamp" D
"RTN","ORWDLR32",154,0)
 . . S LST($$NXT)="d"_$G(ORY("Default CollSamp")) Q
"RTN","ORWDLR32",155,0)
 . I PARAM="Unique CollSamp" D
"RTN","ORWDLR32",156,0)
 . . S LST($$NXT)="d"_$G(ORY("Unique CollSamp")) Q
"RTN","ORWDLR32",157,0)
 . I PARAM="Default Urgency" D
"RTN","ORWDLR32",158,0)
 . . S LST($$NXT)="d"_$G(ORY("Default Urgency")) Q
"RTN","ORWDLR32",159,0)
 . I PARAM="Lab CollSamp" D
"RTN","ORWDLR32",160,0)
 . . S LST($$NXT)="d"_$G(ORY("Lab CollSamp")) Q
"RTN","ORWDLR32",161,0)
 . I $D(ORY(PARAM))>1 S I=0 F  S I=$O(ORY(PARAM,I)) Q:'I  D
"RTN","ORWDLR32",162,0)
 . . I PARAM="Specimens" S LST($$NXT)="i"_ORY(PARAM,I) Q
"RTN","ORWDLR32",163,0)
 . . I PARAM="Urgencies" S LST($$NXT)="i"_ORY(PARAM,I) Q
"RTN","ORWDLR32",164,0)
 . . I PARAM="GenWardInstructions" S LST($$NXT)="t"_ORY(PARAM,I,0) Q
"RTN","ORWDLR32",165,0)
 . . S LST($$NXT)="i"_I_U_ORY(PARAM,I)
"RTN","ORWDLR32",166,0)
 . . I PARAM="CollSamp" D
"RTN","ORWDLR32",167,0)
 . . . I $G(ORY("Lab CollSamp")) S $P(LST(ILST),U,8)=1
"RTN","ORWDLR32",168,0)
 . . . S X=+$P(ORY(PARAM,I),U,3)
"RTN","ORWDLR32",169,0)
 . . . I X S $P(LST(ILST),U,10)=$P($G(^LAB(61,X,0)),U,1)
"RTN","ORWDLR32",170,0)
 . . I $D(ORY(PARAM,I,"WP")) S J=0 F  S J=$O(ORY(PARAM,I,"WP",J)) Q:'J  D
"RTN","ORWDLR32",171,0)
 . . . S LST($$NXT)="t"_ORY(PARAM,I,"WP",J,0)
"RTN","ORWDLR32",172,0)
 Q
"RTN","ORWDLR32",173,0)
ALLSAMP(LST) ; procedure
"RTN","ORWDLR32",174,0)
 ; returns all collection samples
"RTN","ORWDLR32",175,0)
 ; n^SampIEN^SampName^SpecPtr^TubeTop^^^LabCollect^^SpecName
"RTN","ORWDLR32",176,0)
 N SMP,SPC,ILST,IEN,X,X0
"RTN","ORWDLR32",177,0)
 S ILST=0,LST($$NXT)="~CollSamp"
"RTN","ORWDLR32",178,0)
 S SMP="" F  S SMP=$O(^LAB(62,"B",SMP)) Q:SMP=""  D
"RTN","ORWDLR32",179,0)
 . S IEN=0 F  S IEN=$O(^LAB(62,"B",SMP,IEN)) Q:'IEN  D
"RTN","ORWDLR32",180,0)
 . . S X0=^LAB(62,IEN,0)
"RTN","ORWDLR32",181,0)
 . . S X="i"_U_IEN_U_SMP_U_$P(X0,U,2)_U_$P(X0,U,3)_U_U_U_$P(X0,U,7)
"RTN","ORWDLR32",182,0)
 . . I $P(X0,U,2) D
"RTN","ORWDLR32",183,0)
 . . . S $P(X,U,10)=$P(^LAB(61,+$P(X0,U,2),0),U,1)
"RTN","ORWDLR32",184,0)
 . . . S SPC($P(X,U,4))=$P(X,U,10)
"RTN","ORWDLR32",185,0)
 . . S LST($$NXT)=X
"RTN","ORWDLR32",186,0)
 S LST($$NXT)="~Specimens"
"RTN","ORWDLR32",187,0)
 S SPC=0 F  S SPC=$O(SPC(SPC)) Q:'SPC  S LST($$NXT)=SPC_U_SPC(SPC)
"RTN","ORWDLR32",188,0)
 Q
"RTN","ORWDLR32",189,0)
ONESAMP(LST,IEN) ;Return data for one colelction sample
"RTN","ORWDLR32",190,0)
 ; n^SampIEN^SampName^SpecPtr^TubeTop^^^LabCollect^^SpecName
"RTN","ORWDLR32",191,0)
 N SPC,ILST,X,X0
"RTN","ORWDLR32",192,0)
 Q:+$G(IEN)=0
"RTN","ORWDLR32",193,0)
 S ILST=0,LST($$NXT)="~CollSamp"
"RTN","ORWDLR32",194,0)
 S X0=^LAB(62,IEN,0)
"RTN","ORWDLR32",195,0)
 S X="i1"_U_IEN_U_$P(X0,U,1)_U_$P(X0,U,2)_U_$P(X0,U,3)_U_U_U_$P(X0,U,7)
"RTN","ORWDLR32",196,0)
 I $P(X0,U,2) D
"RTN","ORWDLR32",197,0)
 . S $P(X,U,10)=$P(^LAB(61,+$P(X0,U,2),0),U,1)
"RTN","ORWDLR32",198,0)
 . S SPC($P(X,U,4))=$P(X,U,10)
"RTN","ORWDLR32",199,0)
 S LST($$NXT)=X
"RTN","ORWDLR32",200,0)
 S LST($$NXT)="~Specimens"
"RTN","ORWDLR32",201,0)
 S SPC=0 F  S SPC=$O(SPC(SPC)) Q:'SPC  S LST($$NXT)=SPC_U_SPC(SPC)
"RTN","ORWDLR32",202,0)
 Q
"RTN","ORWDLR32",203,0)
ONESPEC(LST,IEN) ;return one specimen
"RTN","ORWDLR32",204,0)
 Q:(+$G(IEN)=0)!('$D(^LAB(61,IEN,0)))
"RTN","ORWDLR32",205,0)
 S LST=IEN_U_$P(^LAB(61,IEN,0),U,1)
"RTN","ORWDLR32",206,0)
 Q
"RTN","ORWDLR32",207,0)
ABBSPEC(LST) ; procedure
"RTN","ORWDLR32",208,0)
 ; returns specimens with abbreviation (uses 'E' xref)
"RTN","ORWDLR32",209,0)
 N X,IEN,ILST S ILST=0
"RTN","ORWDLR32",210,0)
 S X="" F  S X=$O(^LAB(61,"E",X)) Q:X=""  S IEN=$O(^(X,0)) D
"RTN","ORWDLR32",211,0)
 . S LST($$NXT)=IEN_U_$P(^LAB(61,IEN,0),U,1)
"RTN","ORWDLR32",212,0)
 Q
"RTN","ORWDLR32",213,0)
NXT() ; called by TESTINFO, increments ILST
"RTN","ORWDLR32",214,0)
 S ILST=ILST+1
"RTN","ORWDLR32",215,0)
 Q ILST
"RTN","ORWDLR32",216,0)
 ;
"VER")
8.0^22.0
"BLD",6808,6)
^234
**END**
**END**
