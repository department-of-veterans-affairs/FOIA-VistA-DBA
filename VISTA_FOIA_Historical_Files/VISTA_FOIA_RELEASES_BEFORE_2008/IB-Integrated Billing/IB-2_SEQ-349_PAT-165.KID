Released IB*2*165 SEQ #349
Extracted from mail message
**KIDS**:IB*2.0*165^

**INSTALL NAME**
IB*2.0*165
"BLD",3643,0)
IB*2.0*165^INTEGRATED BILLING^0^3060329^y
"BLD",3643,1,0)
^^1^1^3060126^^^^
"BLD",3643,1,1,0)
BILLING LAG TIME REPORT MODIFICATIONS
"BLD",3643,4,0)
^9.64PA^^0
"BLD",3643,"ABPKG")
n
"BLD",3643,"KRN",0)
^9.67PA^19^17
"BLD",3643,"KRN",.4,0)
.4
"BLD",3643,"KRN",.4,"NM",0)
^9.68A^^
"BLD",3643,"KRN",.401,0)
.401
"BLD",3643,"KRN",.402,0)
.402
"BLD",3643,"KRN",.403,0)
.403
"BLD",3643,"KRN",.5,0)
.5
"BLD",3643,"KRN",.84,0)
.84
"BLD",3643,"KRN",3.6,0)
3.6
"BLD",3643,"KRN",3.8,0)
3.8
"BLD",3643,"KRN",9.2,0)
9.2
"BLD",3643,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",3643,"KRN",9.8,0)
9.8
"BLD",3643,"KRN",9.8,"NM",0)
^9.68A^6^2
"BLD",3643,"KRN",9.8,"NM",5,0)
IBJDB1^^0^B26861090
"BLD",3643,"KRN",9.8,"NM",6,0)
IBJDB11^^0^B43524742
"BLD",3643,"KRN",9.8,"NM","B","IBJDB1",5)

"BLD",3643,"KRN",9.8,"NM","B","IBJDB11",6)

"BLD",3643,"KRN",19,0)
19
"BLD",3643,"KRN",19,"NM",0)
^9.68A^^
"BLD",3643,"KRN",19.1,0)
19.1
"BLD",3643,"KRN",101,0)
101
"BLD",3643,"KRN",409.61,0)
409.61
"BLD",3643,"KRN",771,0)
771
"BLD",3643,"KRN",870,0)
870
"BLD",3643,"KRN",8994,0)
8994
"BLD",3643,"KRN","B",.4,.4)

"BLD",3643,"KRN","B",.401,.401)

"BLD",3643,"KRN","B",.402,.402)

"BLD",3643,"KRN","B",.403,.403)

"BLD",3643,"KRN","B",.5,.5)

"BLD",3643,"KRN","B",.84,.84)

"BLD",3643,"KRN","B",3.6,3.6)

"BLD",3643,"KRN","B",3.8,3.8)

"BLD",3643,"KRN","B",9.2,9.2)

"BLD",3643,"KRN","B",9.8,9.8)

"BLD",3643,"KRN","B",19,19)

"BLD",3643,"KRN","B",19.1,19.1)

"BLD",3643,"KRN","B",101,101)

"BLD",3643,"KRN","B",409.61,409.61)

"BLD",3643,"KRN","B",771,771)

"BLD",3643,"KRN","B",870,870)

"BLD",3643,"KRN","B",8994,8994)

"BLD",3643,"QUES",0)
^9.62^^
"BLD",3643,"REQB",0)
^9.611^2^1
"BLD",3643,"REQB",2,0)
IB*2.0*118^1
"BLD",3643,"REQB","B","IB*2.0*118",2)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
165^3060329^1258
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3060329
"PKG",200,22,1,"PAH",1,1,1,0)
BILLING LAG TIME REPORT MODIFICATIONS
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IBJDB1")
0^5^B26861090^B26720805
"RTN","IBJDB1",1,0)
IBJDB1 ;ALB/CPM - BILLING LAG TIME REPORT ; 27-DEC-96
"RTN","IBJDB1",2,0)
 ;;2.0;INTEGRATED BILLING;**69,80,100,118,165**;21-MAR-94
"RTN","IBJDB1",3,0)
 ;
"RTN","IBJDB1",4,0)
EN ; - Option entry point.
"RTN","IBJDB1",5,0)
 ;
"RTN","IBJDB1",6,0)
 W !!,"This report measures the amount of time between significant"
"RTN","IBJDB1",7,0)
 W !,"milestones which occur from the time treatment has been provided"
"RTN","IBJDB1",8,0)
 W !,"to the time that the claim to the insurer for that treatment has"
"RTN","IBJDB1",9,0)
 W !,"been closed out.",!
"RTN","IBJDB1",10,0)
 ;
"RTN","IBJDB1",11,0)
DATE D DATE^IBOUTL I IBBDT=""!(IBEDT="") G ENQ
"RTN","IBJDB1",12,0)
 ;
"RTN","IBJDB1",13,0)
 ; - Sort by division.
"RTN","IBJDB1",14,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","IBJDB1",15,0)
 S DIR("A")="Do you wish to sort this report by division"
"RTN","IBJDB1",16,0)
 S DIR("?")="^D HLP1^IBJDB1" W !
"RTN","IBJDB1",17,0)
 D ^DIR K DIR I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) G ENQ
"RTN","IBJDB1",18,0)
 S IBSORT=+Y K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDB1",19,0)
 ;
"RTN","IBJDB1",20,0)
 ; - Issue prompt for division.
"RTN","IBJDB1",21,0)
 I IBSORT D PSDR^IBODIV G:Y<0 ENQ
"RTN","IBJDB1",22,0)
 ;
"RTN","IBJDB1",23,0)
 ; - Select a Detailed or Summary report.
"RTN","IBJDB1",24,0)
DS D DS^IBJD I "^"[IBRPT G ENQ
"RTN","IBJDB1",25,0)
 I IBRPT="S" S IBSEL=",1,2,3,4,5,6,7,8,9,10,11," G DEV
"RTN","IBJDB1",26,0)
 ;
"RTN","IBJDB1",27,0)
SEL ; - Select main report or line item reports.
"RTN","IBJDB1",28,0)
 W ! S DIR(0)="LO^1:11^K:+$P(X,""-"",2)>11 X"
"RTN","IBJDB1",29,0)
 F X=1:1:11 S DIR("A",X)=$S(X<10:" ",1:"")_X_" - Print "_$$TITLE(X,1)
"RTN","IBJDB1",30,0)
 S DIR("A",12)="",DIR("A")="Select",DIR("B")=1
"RTN","IBJDB1",31,0)
 S DIR("?")="^D HLP2^IBJDB1" D ^DIR K DIR G:Y["^" ENQ S IBSEL=Y
"RTN","IBJDB1",32,0)
 S DIR(0)="Y",DIR("A",1)="You have selected"
"RTN","IBJDB1",33,0)
 I IBSEL="1,2,3,4,5,6,7,8,9,10,11," D
"RTN","IBJDB1",34,0)
 .S DIR("A",1)=DIR("A",1)_" ALL the above reports."
"RTN","IBJDB1",35,0)
 E  F X=1:1 S X1=$P(IBSEL,",",X) Q:'X1  S DIR("A",X+1)=" "_$$TITLE(X1,1)
"RTN","IBJDB1",36,0)
 S DIR("A")="Are you sure",DIR("B")="NO"
"RTN","IBJDB1",37,0)
 W ! D ^DIR K DIR G ENQ:Y["^",SEL:'Y S IBSEL=","_IBSEL
"RTN","IBJDB1",38,0)
 ;
"RTN","IBJDB1",39,0)
DEV W !!,"This report only requires an 80 column printer."
"RTN","IBJDB1",40,0)
 ;
"RTN","IBJDB1",41,0)
 W !!,"Note: This report searches through all Reimb. Insurance claims."
"RTN","IBJDB1",42,0)
 W !?6,"You should queue this report to run after normal business hours."
"RTN","IBJDB1",43,0)
 ;
"RTN","IBJDB1",44,0)
 ; - Select a device.
"RTN","IBJDB1",45,0)
 W ! S %ZIS="QM" D ^%ZIS G:POP ENQ
"RTN","IBJDB1",46,0)
 I $D(IO("Q")) D  G ENQ
"RTN","IBJDB1",47,0)
 .S ZTRTN="DQ^IBJDB1",ZTDESC="IB - BILLING LAG TIME REPORT"
"RTN","IBJDB1",48,0)
 .F X="IB*","VAUTD","VAUTD(" S ZTSAVE(X)=""
"RTN","IBJDB1",49,0)
 .D ^%ZTLOAD W !!,$S($D(ZTSK):"This job has been queued. The task number is "_ZTSK_".",1:"Unable to queue this job.")
"RTN","IBJDB1",50,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBJDB1",51,0)
 ;
"RTN","IBJDB1",52,0)
 U IO
"RTN","IBJDB1",53,0)
 ;
"RTN","IBJDB1",54,0)
DQ ; - Tasked entry point.
"RTN","IBJDB1",55,0)
 ;
"RTN","IBJDB1",56,0)
 I $G(IBXTRACT) D E^IBJDE(10,1) ; Change extract status.
"RTN","IBJDB1",57,0)
 ;
"RTN","IBJDB1",58,0)
 K IBCT,IBTL,^TMP("IBJDB1",$J)
"RTN","IBJDB1",59,0)
 S IBQ=0 D ^IBJDB11 I IBQ G ENQ ; Compile data for reports.
"RTN","IBJDB1",60,0)
 ;
"RTN","IBJDB1",61,0)
 ; - Extract summary data.
"RTN","IBJDB1",62,0)
 I $G(IBXTRACT) D  G ENQ
"RTN","IBJDB1",63,0)
 .S X=0 F Y=1:1:4,9,10,11,"2I","3I","4I" D
"RTN","IBJDB1",64,0)
 ..S X=X+1,IB(X)=$J($S('IBCT(0,"OP",Y):0,1:IBTL(0,"OP",Y)/IBCT(0,"OP",Y)),0,2)
"RTN","IBJDB1",65,0)
 .F Y=5:1:11,"6I","7I","8I" D
"RTN","IBJDB1",66,0)
 ..S X=X+1,IB(X)=$J($S('IBCT(0,"IN",Y):0,1:IBTL(0,"IN",Y)/IBCT(0,"IN",Y)),0,2)
"RTN","IBJDB1",67,0)
 .D E^IBJDE(10,0)
"RTN","IBJDB1",68,0)
 ;
"RTN","IBJDB1",69,0)
 ; - Print the reports.
"RTN","IBJDB1",70,0)
 S IBQ=0
"RTN","IBJDB1",71,0)
 S IBDIV="" F  S IBDIV=$S(IBRPT="D":$O(^TMP("IBJDB1",$J,IBDIV)),1:$O(IBCT(IBDIV))) Q:IBDIV=""  D  Q:IBQ
"RTN","IBJDB1",72,0)
 .S IBPAG=0 D NOW^%DTC S IBRUN=$$DAT2^IBOUTL(%)
"RTN","IBJDB1",73,0)
 .I IBRPT="D" D OPT^IBJDB12 I 'IBQ D INP^IBJDB13
"RTN","IBJDB1",74,0)
 .I IBRPT="S" D SUM^IBJDB12
"RTN","IBJDB1",75,0)
 ;
"RTN","IBJDB1",76,0)
ENQ K ^TMP("IBJDB1",$J)
"RTN","IBJDB1",77,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDB1",78,0)
 ;
"RTN","IBJDB1",79,0)
 D ^%ZISC
"RTN","IBJDB1",80,0)
ENQ1 K IB,IBBDT,IBBN,IBEDT,IBCK,IBN,IBN0,IBRPT,IBPAG,IBQ,IBRUN,IBX,IBX1,IBX2
"RTN","IBJDB1",81,0)
 K IBX3,IBAUTH,IBDAT,IBDFN,IBNU,IBPTF,IBPOL,IBPOL1,IBTY,IBS,IBSEL,IBSEL1
"RTN","IBJDB1",82,0)
 K IBCT,IBDIV,IBSORT,IBTL,IBCHK,IBDCHK,DFN,POP,VAUTD,ZTDESC,ZTRTN,ZTSAVE
"RTN","IBJDB1",83,0)
 K IBDR,IBH,DIROUT,DTOUT,DUOUT,DIRUT,%,%ZIS,D,X,X1,X2,Y,Y1,Z,Z1,Z2,Z3
"RTN","IBJDB1",84,0)
 Q
"RTN","IBJDB1",85,0)
 ;
"RTN","IBJDB1",86,0)
HLP1 ; - 'Sort by Division?' prompt.
"RTN","IBJDB1",87,0)
 W !?1,"Enter a <CR> to print the report without regard to division,"
"RTN","IBJDB1",88,0)
 W !?1,"or 'Y' to select those divisions for which a separate report"
"RTN","IBJDB1",89,0)
 W !?1,"should be created. To quit this option, enter '^'."
"RTN","IBJDB1",90,0)
 Q
"RTN","IBJDB1",91,0)
 ;
"RTN","IBJDB1",92,0)
HLP2 ; - Line item report prompt.
"RTN","IBJDB1",93,0)
 W !?1,"Select '1-11' (Response can be a single number, list or range,"
"RTN","IBJDB1",94,0)
 W !?1,"e.g.: 1,3,5 or 2-6,10) to print up to 11 lag time reports based"
"RTN","IBJDB1",95,0)
 W !?1,"on the line items of the lag time summary reports. To quit this"
"RTN","IBJDB1",96,0)
 W !?1,"option, enter '^'."
"RTN","IBJDB1",97,0)
 Q
"RTN","IBJDB1",98,0)
 ;
"RTN","IBJDB1",99,0)
TITLE(X,Y) ; - Display/print report titles.
"RTN","IBJDB1",100,0)
 Q $P($T(TITLE1+X),";;",2)_$S(Y:$P($T(TITLE1+X),";;",3),1:"")
"RTN","IBJDB1",101,0)
 ;
"RTN","IBJDB1",102,0)
TITLE1 ; - Line item titles.
"RTN","IBJDB1",103,0)
 ;;Date of Care to Date of Check Out;; (Outpatient claims)
"RTN","IBJDB1",104,0)
 ;;Date of Check Out to Date Claim Authorized;; (Outpatient claims)
"RTN","IBJDB1",105,0)
 ;;Date of Care to Date of First Payment;; (Outpatient claims)
"RTN","IBJDB1",106,0)
 ;;Date of Care to Date Receivable Closed;; (Outpatient claims)
"RTN","IBJDB1",107,0)
 ;;Date of Discharge to Date PTF Transmitted;; (Inpatient claims)
"RTN","IBJDB1",108,0)
 ;;Date PTF Transmitted to Date Claim Authorized;; (Inpatient claims)
"RTN","IBJDB1",109,0)
 ;;Date of Discharge to Date of First Payment;; (Inpatient claims)
"RTN","IBJDB1",110,0)
 ;;Date of Discharge to Date Receivable Closed;; (Inpatient claims)
"RTN","IBJDB1",111,0)
 ;;Date Claim Authorized to Date Claim Activated
"RTN","IBJDB1",112,0)
 ;;Date Claim Activated to Date of First Payment
"RTN","IBJDB1",113,0)
 ;;Date of First Payment to Date Receivable Closed
"RTN","IBJDB11")
0^6^B43524742^B38226911
"RTN","IBJDB11",1,0)
IBJDB11 ;ALB/CPM - BILLING LAG TIME REPORT (COMPILE) ; 27-DEC-96
"RTN","IBJDB11",2,0)
 ;;2.0;INTEGRATED BILLING;**69,100,118,165**;21-MAR-94
"RTN","IBJDB11",3,0)
 ;
"RTN","IBJDB11",4,0)
EN ; - Entry point from IBJDB1.
"RTN","IBJDB11",5,0)
 ;
"RTN","IBJDB11",6,0)
 ; - 
"RTN","IBJDB11",7,0)
 I IBRPT="D" F X=2,3,4,6,7,8 S:IBSEL[X IBSEL=IBSEL_X_"I,"
"RTN","IBJDB11",8,0)
 I 'IBSORT D INIT(0) G REV
"RTN","IBJDB11",9,0)
 S X=0 F  S X=$S('VAUTD:$O(VAUTD(X)),1:$O(^DG(40.8,X))) Q:'X  D INIT(X)
"RTN","IBJDB11",10,0)
 ;
"RTN","IBJDB11",11,0)
REV ; - Review all claims in file #399.
"RTN","IBJDB11",12,0)
 S IBN=0 F  S IBN=$O(^DGCR(399,IBN)) Q:'IBN  S IBN0=$G(^(IBN,0)) D  Q:IBQ
"RTN","IBJDB11",13,0)
 .I IBN#100=0 S IBQ=$$STOP^IBOUTL("Billing Lag Time Report") Q:IBQ
"RTN","IBJDB11",14,0)
 .;
"RTN","IBJDB11",15,0)
 .I $P($G(^PRCA(430,IBN,0)),U,2)'=9 Q  ;              Not an RI claim.
"RTN","IBJDB11",16,0)
 .I $P(IBN0,U,13)<3 Q  ;                              Not authorized.
"RTN","IBJDB11",17,0)
 .I $P(IBN0,U,13)=7 Q  ;                              Cancelled in IB.
"RTN","IBJDB11",18,0)
 .S X=$P($G(^PRCA(430,IBN,0)),U,8) I X=26!(X=39) Q  ; Cancelled in AR.
"RTN","IBJDB11",19,0)
 .;
"RTN","IBJDB11",20,0)
 .; - Does claim meet report criteria?
"RTN","IBJDB11",21,0)
 .S IBAUTH=$$AUTH(IBN) I 'IBAUTH Q
"RTN","IBJDB11",22,0)
 .;
"RTN","IBJDB11",23,0)
 .; - Get division, if necessary.
"RTN","IBJDB11",24,0)
 .I 'IBSORT S IBDIV=0
"RTN","IBJDB11",25,0)
 .E  S IBDIV=$$DIV^IBJDF2(IBN) I 'IBDIV S IBDIV=+$$PRIM^VASITE()
"RTN","IBJDB11",26,0)
 .I IBSORT,'VAUTD,'$D(VAUTD(IBDIV)) Q  ;  Not a selected division.
"RTN","IBJDB11",27,0)
 .;
"RTN","IBJDB11",28,0)
 .S IBTY=$S($P(IBN0,U,5)<3:"IN",1:"OP") ; Inpatient or outpatient claim?
"RTN","IBJDB11",29,0)
 .;
"RTN","IBJDB11",30,0)
 .;- Get date PTF transmitted.
"RTN","IBJDB11",31,0)
 .S IBPTF="" I IBTY="IN" S IBPTF=$$PTF($P(IBN0,U,8)) Q:'IBPTF
"RTN","IBJDB11",32,0)
 .;
"RTN","IBJDB11",33,0)
 .; - Get other claim info and build date line.
"RTN","IBJDB11",34,0)
 .S IBDAT=$P(IBAUTH,U,2,5),DFN=+$P(IBN0,U,2),IBDFN=$G(^DPT(DFN,0))
"RTN","IBJDB11",35,0)
 .S IBPOL=+$G(^DPT(DFN,.312,+$P($G(^DGCR(399,IBN,"MP")),U,2),1))
"RTN","IBJDB11",36,0)
 .;
"RTN","IBJDB11",37,0)
 .; - Get care dates; quit if there are none.
"RTN","IBJDB11",38,0)
 .K IBDR S IBNU=$G(^DGCR(399,IBN,"U")) D
"RTN","IBJDB11",39,0)
 ..I IBTY="IN" S X=+$P(IBNU,U,2) S:'X X=+IBNU S:X IBDR(X)="" Q
"RTN","IBJDB11",40,0)
 ..I '$D(^DGCR(399,IBN,"OP")) D  Q
"RTN","IBJDB11",41,0)
 ...S X=+$P(IBNU,U,2) S:X IBDR(X)="" S:+IBNU&(+IBNU'=X) IBDR(+IBNU)=""
"RTN","IBJDB11",42,0)
 ..S X=0 F  S X=$O(^DGCR(399,IBN,"OP",X)) Q:'X  S IBDR(X)=""
"RTN","IBJDB11",43,0)
 .I '$D(IBDR) Q
"RTN","IBJDB11",44,0)
 .;
"RTN","IBJDB11",45,0)
 .; - Calculate statistics for each care date.
"RTN","IBJDB11",46,0)
 .S IBX=0 F  S IBX=$O(IBDR(IBX)) Q:'IBX  D
"RTN","IBJDB11",47,0)
 ..;
"RTN","IBJDB11",48,0)
 ..; - Get discharge date.
"RTN","IBJDB11",49,0)
 ..I IBTY="IN" D
"RTN","IBJDB11",50,0)
 ...S IBX1=+$G(^DGPT(+$P(IBN0,U,8),70))\1 I IBX1 Q
"RTN","IBJDB11",51,0)
 ...S IBX1=+$O(^DGPM("APTT3",DFN,(IBX-.0001)))\1 I 'IBX1 S IBX1=IBX
"RTN","IBJDB11",52,0)
 ..;
"RTN","IBJDB11",53,0)
 ..; - Get most recent check out date that has not been marked as non
"RTN","IBJDB11",54,0)
 ..;   billable by Claims Tracking; quit if there isn't one.
"RTN","IBJDB11",55,0)
 ..I IBTY="OP" D  K IBCL,IBCL1 Q:'IBCHK
"RTN","IBJDB11",56,0)
 ...D CL(IBN) ;GET LIST OF CLINICS FOR THIS BILL
"RTN","IBJDB11",57,0)
 ...S IBCHK=0,IBX1=IBX-.0001
"RTN","IBJDB11",58,0)
 ...F  S IBX1=$O(^SCE("ADFN",DFN,IBX1)) Q:'IBX1!((IBX1\1)>IBX)  D
"RTN","IBJDB11",59,0)
 ....S IBX2=0 F  S IBX2=$O(^SCE("ADFN",DFN,IBX1,IBX2)) Q:'IBX2  D
"RTN","IBJDB11",60,0)
 .....;
"RTN","IBJDB11",61,0)
 .....;CHECK TO SEE IF CLINICS MATCH
"RTN","IBJDB11",62,0)
 .....S IBCL1=+$P($G(^SCE(IBX2,0)),U,4) Q:'$D(IBCL(IBCL1))
"RTN","IBJDB11",63,0)
 .....I $P($G(^IBT(356,+$O(^IBT(356,"ASCE",IBX2,0)),0)),U,19) Q
"RTN","IBJDB11",64,0)
 .....S IBX3=$P($G(^SCE(IBX2,0)),U,7)\1 I IBX3,IBX3'>$P(IBAUTH,U,2)  D
"RTN","IBJDB11",65,0)
 ...... S:IBX3>IBCHK IBCHK=IBX3 Q
"RTN","IBJDB11",66,0)
 ..;
"RTN","IBJDB11",67,0)
 ..S X=$S(IBTY="IN":IBX1_U_+IBPTF,1:IBX_U_IBCHK)_U_IBDAT
"RTN","IBJDB11",68,0)
 ..S IBPOL1=$S(IBPOL>+X:1,1:0) ; Policy found after treatment.
"RTN","IBJDB11",69,0)
 ..;
"RTN","IBJDB11",70,0)
 ..; - Check date line for at least one date within the user specified
"RTN","IBJDB11",71,0)
 ..;   range; quit if there isn't any.
"RTN","IBJDB11",72,0)
 ..S IBDCHK=0 F Y=2:1:6 I $$DL(0,$P(X,U,Y)) S IBDCHK=1 Q
"RTN","IBJDB11",73,0)
 ..I 'IBDCHK Q
"RTN","IBJDB11",74,0)
 ..;
"RTN","IBJDB11",75,0)
 ..K D,Y,Z S IBSEL1=""
"RTN","IBJDB11",76,0)
 ..F Y=1:1:5 S Z(1)=$P(X,U,Y),Z(2)=$P(X,U,Y+1) D
"RTN","IBJDB11",77,0)
 ...;
"RTN","IBJDB11",78,0)
 ...; - Check out date/PTF transmission date.
"RTN","IBJDB11",79,0)
 ...I Y=1 D:Z(2)  Q
"RTN","IBJDB11",80,0)
 ....S D(0)=$$FMDIFF^XLFDT(Z(2),Z(1)),Z=$S(IBTY="IN":5,1:1)
"RTN","IBJDB11",81,0)
 ....I $$DL(Z,Z(2)) S IBSEL1=IBSEL1_Z_",",Y(Z)=$S(IBRPT="D":Z(1)_U_Z(2)_U_D(0),1:D(0))
"RTN","IBJDB11",82,0)
 ...;
"RTN","IBJDB11",83,0)
 ...; - Date authorized.
"RTN","IBJDB11",84,0)
 ...I Y=2 D:Z(1)  Q
"RTN","IBJDB11",85,0)
 ....S D(1)=$$FMDIFF^XLFDT(Z(2),Z(1)),Z=$S(IBTY="IN":6,1:2)
"RTN","IBJDB11",86,0)
 ....I $$DL(Z,Z(2)) D
"RTN","IBJDB11",87,0)
 .....S Z1=$S(IBPOL1:Z_"I",1:Z),IBSEL1=IBSEL1_Z1_",",Y(Z1)=$S(IBRPT="D":Z(1)_U_Z(2)_U_D(1),1:D(1))
"RTN","IBJDB11",88,0)
 .....I Z1=Z D
"RTN","IBJDB11",89,0)
 ......S Z2=Z_"I",IBSEL1=IBSEL1_Z2_",",Y(Z2)=$S(IBRPT="D":Z(1)_U_Z(2)_U_D(1),1:D(1))
"RTN","IBJDB11",90,0)
 ...;
"RTN","IBJDB11",91,0)
 ...; - Date activated.
"RTN","IBJDB11",92,0)
 ...I Y=3 D:Z(2)  Q
"RTN","IBJDB11",93,0)
 ....S D(2)=$$FMDIFF^XLFDT(Z(2),Z(1)) I $$DL(9,Z(2)) S IBSEL1=IBSEL1_"9,",Y(9)=$S(IBRPT="D":Z(1)_U_Z(2)_U_D(2),1:D(2))
"RTN","IBJDB11",94,0)
 ...;
"RTN","IBJDB11",95,0)
 ...; - Payment date.
"RTN","IBJDB11",96,0)
 ...I Y=4 D:Z(2)  Q
"RTN","IBJDB11",97,0)
 ....S D(3)=$$FMDIFF^XLFDT(Z(2),Z(1)),D(6)=$$FMDIFF^XLFDT(Z(2),+X)
"RTN","IBJDB11",98,0)
 ....F Z=$S(IBTY="IN":7,1:3),10 I $$DL(Z,Z(2)) D
"RTN","IBJDB11",99,0)
 .....S Z1=$S(IBPOL1&(Z<10):Z_"I",1:Z),Z2=$S(Z<10:6,1:3)
"RTN","IBJDB11",100,0)
 .....S IBSEL1=IBSEL1_Z1_",",Y(Z1)=$S(IBRPT="D":$S(Z2=3:Z(1),1:+X)_U_Z(2)_U_D(Z2),1:D(Z2))
"RTN","IBJDB11",101,0)
 .....I Z1=Z,Z<10 S Z3=Z_"I",IBSEL1=IBSEL1_Z3_",",Y(Z3)=$S(IBRPT="D":$S(Z2=3:Z(1),1:+X)_U_Z(2)_U_D(Z2),1:D(Z2))
"RTN","IBJDB11",102,0)
 ...;
"RTN","IBJDB11",103,0)
 ...; - Date closed.
"RTN","IBJDB11",104,0)
 ...I Z(2) D
"RTN","IBJDB11",105,0)
 ....S D(4)=$$FMDIFF^XLFDT(Z(2),Z(1)),D(5)=$$FMDIFF^XLFDT(Z(2),+X)
"RTN","IBJDB11",106,0)
 ....F Z=$S(IBTY="IN":8,1:4),11 I $$DL(Z,Z(2)) D
"RTN","IBJDB11",107,0)
 .....S Z1=$S(IBPOL1&(Z<11):Z_"I",1:Z),Z2=$S(Z<11:5,1:4)
"RTN","IBJDB11",108,0)
 .....S IBSEL1=IBSEL1_Z1_",",Y(Z1)=$S(IBRPT="D":$S(Z2=4:Z(1),1:+X)_U_Z(2)_U_D(Z2),1:D(Z2))
"RTN","IBJDB11",109,0)
 .....I Z1=Z,Z<11 S Z3=Z_"I",IBSEL1=IBSEL1_Z3_",",Y(Z3)=$S(IBRPT="D":$S(Z2=4:Z(1),1:+X)_U_Z(2)_U_D(Z2),1:D(Z2))
"RTN","IBJDB11",110,0)
 ..;
"RTN","IBJDB11",111,0)
 ..; - Save data for detail or summary report(s).
"RTN","IBJDB11",112,0)
 ..F Y=1:1 S Z=$P(IBSEL1,",",Y) Q:'Z  D
"RTN","IBJDB11",113,0)
 ...I IBRPT="D" D
"RTN","IBJDB11",114,0)
 ....S IBBN=$P(IBN0,U) S:IBPOL1 IBBN=IBBN_"*"
"RTN","IBJDB11",115,0)
 ....S Y(Z)=IBBN_U_Y(Z),Y1(Z)=$G(Y1(Z))+1
"RTN","IBJDB11",116,0)
 ....S ^TMP("IBJDB1",$J,IBDIV,IBTY,Z,$P(IBDFN,U)_"@@"_$P(IBDFN,U,9),Y1(Z))=Y(Z)
"RTN","IBJDB11",117,0)
 ...E  S IBCT(IBDIV,IBTY,Z)=IBCT(IBDIV,IBTY,Z)+1,IBTL(IBDIV,IBTY,Z)=IBTL(IBDIV,IBTY,Z)+Y(Z)
"RTN","IBJDB11",118,0)
 ;
"RTN","IBJDB11",119,0)
 Q
"RTN","IBJDB11",120,0)
 ;
"RTN","IBJDB11",121,0)
INIT(X) ; - Initialize summary accumulators/detail division nodes.
"RTN","IBJDB11",122,0)
 I IBRPT="D" S ^TMP("IBJDB1",$J,X)="" Q
"RTN","IBJDB11",123,0)
 F Y=1:1:4,9,10,11,"2I","3I","4I" S (IBCT(X,"OP",Y),IBTL(X,"OP",Y))=0
"RTN","IBJDB11",124,0)
 F Y=5:1:11,"6I","7I","8I" S (IBCT(X,"IN",Y),IBTL(X,"IN",Y))=0
"RTN","IBJDB11",125,0)
 Q
"RTN","IBJDB11",126,0)
 ;
"RTN","IBJDB11",127,0)
AUTH(IBN) ; - Is this an authorized claim?
"RTN","IBJDB11",128,0)
 ;  Input: IBN=Pointer to the AR in file #430
"RTN","IBJDB11",129,0)
 ; Output: VAL=1^2^3^4^5, where:
"RTN","IBJDB11",130,0)
 ;             1=1-Authorized claim
"RTN","IBJDB11",131,0)
 ;               0-Not an authorized claim
"RTN","IBJDB11",132,0)
 ;             2=Date AR was authorized
"RTN","IBJDB11",133,0)
 ;             3=Date AR was activated
"RTN","IBJDB11",134,0)
 ;             4=AR first payment date
"RTN","IBJDB11",135,0)
 ;             5=Date AR was closed
"RTN","IBJDB11",136,0)
 ;
"RTN","IBJDB11",137,0)
 N IBPAY,IBT,IBT0,IBT1,VAL,X
"RTN","IBJDB11",138,0)
 S VAL=0 I '$G(IBN) G AUTHQ
"RTN","IBJDB11",139,0)
 ;
"RTN","IBJDB11",140,0)
 ; - Get date authorized (required).
"RTN","IBJDB11",141,0)
 S X=$P($G(^DGCR(399,IBN,"S")),U,10) G:'X AUTHQ S VAL="1^"_X
"RTN","IBJDB11",142,0)
 ;
"RTN","IBJDB11",143,0)
 ; - Get date activated, if available.
"RTN","IBJDB11",144,0)
 S X=$P($G(^PRCA(430,IBN,6)),U,21) I X S $P(VAL,U,3)=X\1 G FP
"RTN","IBJDB11",145,0)
 S X=$P($G(^PRCA(430,IBN,9)),U,3) I X S $P(VAL,U,3)=X\1 G FP
"RTN","IBJDB11",146,0)
 S X=$P($G(^PRCA(430,IBN,0)),U,10) I X S $P(VAL,U,3)=X\1
"RTN","IBJDB11",147,0)
 ;
"RTN","IBJDB11",148,0)
FP ; - Get first payment date, if available.
"RTN","IBJDB11",149,0)
 I '$P($G(^PRCA(430,IBN,7)),U,7) G DC ; No payments made.
"RTN","IBJDB11",150,0)
 S (IBPAY,IBT)=0 F  S IBT=$O(^PRCA(433,"C",IBN,IBT)) Q:'IBT  D  Q:IBPAY
"RTN","IBJDB11",151,0)
 .S IBT0=$G(^PRCA(433,IBT,0)),IBT1=$G(^(1))
"RTN","IBJDB11",152,0)
 .I $P(IBT0,U,4)'=2 Q  ;                  Not complete.
"RTN","IBJDB11",153,0)
 .I $P(IBT1,U,2)'=2,$P(IBT1,U,2)'=34 Q  ; Not a payment.
"RTN","IBJDB11",154,0)
 .S X=$S(+IBT1:+IBT1,1:$P(IBT1,U,9)\1),$P(VAL,U,4)=X,IBPAY=1
"RTN","IBJDB11",155,0)
 ;
"RTN","IBJDB11",156,0)
DC ; - Get date AR closed.
"RTN","IBJDB11",157,0)
 S X=$$CLO^PRCAFN(IBN) I X>0 S $P(VAL,U,5)=X
"RTN","IBJDB11",158,0)
 ;
"RTN","IBJDB11",159,0)
 ; - Is there a payment date AND a closed date for this claim?
"RTN","IBJDB11",160,0)
 I '$P(VAL,U,4),$P(VAL,U,5) S $P(VAL,U)=0
"RTN","IBJDB11",161,0)
 ;
"RTN","IBJDB11",162,0)
AUTHQ Q VAL
"RTN","IBJDB11",163,0)
 ;
"RTN","IBJDB11",164,0)
DL(X,X1) ; - Is line item date valid for report?
"RTN","IBJDB11",165,0)
 ;  Input: X=Line item number (or 0), X1=Line item date
"RTN","IBJDB11",166,0)
 ; Output: 1=valid, 0=invalid 
"RTN","IBJDB11",167,0)
 ; *Requires pre-defined variables IBBDT, IBEDT, and IBSEL
"RTN","IBJDB11",168,0)
 S X2=0 I 'X1 G DLQ
"RTN","IBJDB11",169,0)
 I 'X S:X1'<IBBDT&(X1'>IBEDT) X2=1 G DLQ
"RTN","IBJDB11",170,0)
 I IBSEL[(","_X_","),X1'<IBBDT,X1'>IBEDT S X2=1
"RTN","IBJDB11",171,0)
DLQ Q X2
"RTN","IBJDB11",172,0)
 ;
"RTN","IBJDB11",173,0)
 ;
"RTN","IBJDB11",174,0)
PTF(X) ; - Get most recent PTF transmission date.
"RTN","IBJDB11",175,0)
 ;    Input: X=IEN of PTF file entry.
"RTN","IBJDB11",176,0)
 ;   Output: Y=PTF date.
"RTN","IBJDB11",177,0)
 N I,K,Y
"RTN","IBJDB11",178,0)
 S Y=0 G:'$O(^DGP(45.83,"C",+X,0)) PTFQ
"RTN","IBJDB11",179,0)
 S I=0 F  S I=$O(^DGP(45.83,"C",X,I)) Q:'I  D
"RTN","IBJDB11",180,0)
 .S J=$P($G(^DGP(45.83,I,0)),U,2)\1  Q:J>$P(IBAUTH,U,2)  S:J K(J)=""
"RTN","IBJDB11",181,0)
 S I=0 F  S I=$O(K(I)) Q:'I  S Y=I
"RTN","IBJDB11",182,0)
 ;
"RTN","IBJDB11",183,0)
PTFQ Q Y
"RTN","IBJDB11",184,0)
 ;
"RTN","IBJDB11",185,0)
CL(IBN) ; - Get the clinics for bill.
"RTN","IBJDB11",186,0)
 N I,J K IBCL ; IBCL=Bill clinic array.
"RTN","IBJDB11",187,0)
 S I=0 F  S I=$O(^DGCR(399,IBN,"CP",I)) Q:I=""  D
"RTN","IBJDB11",188,0)
 .S J=$P($G(^DGCR(399,IBN,"CP",I,0)),U,7) S:J IBCL(J)=""
"RTN","IBJDB11",189,0)
 Q
"VER")
8.0^22.0
"BLD",3643,6)
^349
**END**
**END**
