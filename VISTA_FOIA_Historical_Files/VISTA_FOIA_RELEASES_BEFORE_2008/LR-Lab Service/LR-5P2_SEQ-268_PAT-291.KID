Released LR*5.2*291 SEQ #268
Extracted from mail message
**KIDS**:LR*5.2*291^

**INSTALL NAME**
LR*5.2*291
"BLD",4959,0)
LR*5.2*291^LAB SERVICE^0^3060320^y
"BLD",4959,1,0)
^^1^1^3050216^
"BLD",4959,1,1,0)
VISTA Laboratory Clinical Indicator Data Capture (Patch LR*5.2*291)
"BLD",4959,4,0)
^9.64PA^69.9^4
"BLD",4959,4,60,0)
60
"BLD",4959,4,60,2,0)
^9.641^60^2
"BLD",4959,4,60,2,60,0)
LABORATORY TEST  (File-top level)
"BLD",4959,4,60,2,60,1,0)
^9.6411^508^3
"BLD",4959,4,60,2,60,1,506,0)
DEFAULT SITE/SPECIMEN CPT
"BLD",4959,4,60,2,60,1,507,0)
HCPCS CODE
"BLD",4959,4,60,2,60,1,508,0)
AMA COMPLIANT/BILLABLE PANEL?
"BLD",4959,4,60,2,60.196,0)
SPECIMEN CPT  (sub-file)
"BLD",4959,4,60,2,60.196,1,0)
^9.6411^^0
"BLD",4959,4,60,222)
y^n^p^^^^n^^n
"BLD",4959,4,60,224)

"BLD",4959,4,68,0)
68
"BLD",4959,4,68,2,0)
^9.641^68^1
"BLD",4959,4,68,2,68,0)
ACCESSION  (File-top level)
"BLD",4959,4,68,2,68,1,0)
^9.6411^12^2
"BLD",4959,4,68,2,68,1,.1,0)
RESPONSIBLE OFFICIAL
"BLD",4959,4,68,2,68,1,12,0)
EXTERNAL SERVICE AREA
"BLD",4959,4,68,222)
y^n^p^^^^n^^n
"BLD",4959,4,68,224)

"BLD",4959,4,69,0)
69
"BLD",4959,4,69,2,0)
^9.641^69.05^2
"BLD",4959,4,69,2,69.03,0)
TEST  (sub-file)
"BLD",4959,4,69,2,69.03,1,0)
^9.6411^22.1^2
"BLD",4959,4,69,2,69.03,1,22,0)
DATE OF SERVICE
"BLD",4959,4,69,2,69.03,1,22.1,0)
PANEL PENDING
"BLD",4959,4,69,2,69.05,0)
ICD-9 CODES  (sub-file)
"BLD",4959,4,69,2,69.05,1,0)
^9.6411^^
"BLD",4959,4,69,222)
y^n^p^^^^n^^n
"BLD",4959,4,69,224)

"BLD",4959,4,69.9,0)
69.9
"BLD",4959,4,69.9,2,0)
^9.641^69.9^1
"BLD",4959,4,69.9,2,69.9,0)
LABORATORY SITE  (File-top level)
"BLD",4959,4,69.9,2,69.9,1,0)
^9.6411^620^1
"BLD",4959,4,69.9,2,69.9,1,620,0)
PANEL PROCESS DATE
"BLD",4959,4,69.9,222)
y^n^p^^^^n^^n
"BLD",4959,4,69.9,224)

"BLD",4959,4,"APDD",60,60)

"BLD",4959,4,"APDD",60,60,506)

"BLD",4959,4,"APDD",60,60,507)

"BLD",4959,4,"APDD",60,60,508)

"BLD",4959,4,"APDD",60,60.196)

"BLD",4959,4,"APDD",68,68)

"BLD",4959,4,"APDD",68,68,.1)

"BLD",4959,4,"APDD",68,68,12)

"BLD",4959,4,"APDD",69,69.03)

"BLD",4959,4,"APDD",69,69.03,22)

"BLD",4959,4,"APDD",69,69.03,22.1)

"BLD",4959,4,"APDD",69,69.05)

"BLD",4959,4,"APDD",69.9,69.9)

"BLD",4959,4,"APDD",69.9,69.9,620)

"BLD",4959,4,"B",60,60)

"BLD",4959,4,"B",68,68)

"BLD",4959,4,"B",69,69)

"BLD",4959,4,"B",69.9,69.9)

"BLD",4959,"ABPKG")
n
"BLD",4959,"INI")
PRE^LR291
"BLD",4959,"INID")
y^^
"BLD",4959,"INIT")
POST^LR291
"BLD",4959,"KRN",0)
^9.67PA^8989.52^19
"BLD",4959,"KRN",.4,0)
.4
"BLD",4959,"KRN",.401,0)
.401
"BLD",4959,"KRN",.402,0)
.402
"BLD",4959,"KRN",.403,0)
.403
"BLD",4959,"KRN",.5,0)
.5
"BLD",4959,"KRN",.84,0)
.84
"BLD",4959,"KRN",3.6,0)
3.6
"BLD",4959,"KRN",3.8,0)
3.8
"BLD",4959,"KRN",9.2,0)
9.2
"BLD",4959,"KRN",9.8,0)
9.8
"BLD",4959,"KRN",9.8,"NM",0)
^9.68A^49^32
"BLD",4959,"KRN",9.8,"NM",2,0)
LRORD1^^0^B22670416
"BLD",4959,"KRN",9.8,"NM",3,0)
LRORDST^^0^B30093835
"BLD",4959,"KRN",9.8,"NM",9,0)
LRBEBA^^0^B62512443
"BLD",4959,"KRN",9.8,"NM",12,0)
LR7OF0^^0^B40209802
"BLD",4959,"KRN",9.8,"NM",14,0)
LRBEBA2^^0^B81298476
"BLD",4959,"KRN",9.8,"NM",16,0)
LRBEECPT^^0^B83809805
"BLD",4959,"KRN",9.8,"NM",17,0)
LRTSTSET^^0^B18867118
"BLD",4959,"KRN",9.8,"NM",18,0)
LRCAPPH1^^0^B49109396
"BLD",4959,"KRN",9.8,"NM",20,0)
LROW^^0^B11672894
"BLD",4959,"KRN",9.8,"NM",21,0)
LROW2A^^0^B11789915
"BLD",4959,"KRN",9.8,"NM",23,0)
LR7OB69^^0^B8923375
"BLD",4959,"KRN",9.8,"NM",24,0)
LR7OB3^^0^B24033857
"BLD",4959,"KRN",9.8,"NM",26,0)
LRFAST^^0^B29732413
"BLD",4959,"KRN",9.8,"NM",30,0)
LRTSTJAM^^0^B17412817
"BLD",4959,"KRN",9.8,"NM",32,0)
LRBEBAO^^0^B68648424
"BLD",4959,"KRN",9.8,"NM",33,0)
LRVR1^^0^B36555743
"BLD",4959,"KRN",9.8,"NM",34,0)
LRVR3^^0^B37947077
"BLD",4959,"KRN",9.8,"NM",35,0)
LRVER3^^0^B49207018
"BLD",4959,"KRN",9.8,"NM",36,0)
LRVER1^^0^B31119261
"BLD",4959,"KRN",9.8,"NM",37,0)
LRBEBA3^^0^B24961895
"BLD",4959,"KRN",9.8,"NM",38,0)
LR291^^0^B21675343
"BLD",4959,"KRN",9.8,"NM",39,0)
LR7OF1^^0^B24442487
"BLD",4959,"KRN",9.8,"NM",40,0)
LRBEBA4^^0^B57653585
"BLD",4959,"KRN",9.8,"NM",41,0)
LRWU1^^0^B7097286
"BLD",4959,"KRN",9.8,"NM",42,0)
LRBEPRPT^^0^B37091351
"BLD",4959,"KRN",9.8,"NM",43,0)
LRBEBA21^^0^B34208057
"BLD",4959,"KRN",9.8,"NM",44,0)
LRBEECP1^^0^B2583804
"BLD",4959,"KRN",9.8,"NM",45,0)
LRNIGHT^^0^B3519006
"BLD",4959,"KRN",9.8,"NM",46,0)
LRCAPPH3^^0^B41949665
"BLD",4959,"KRN",9.8,"NM",47,0)
LRBEBA31^^0^B6240256
"BLD",4959,"KRN",9.8,"NM",48,0)
LRBEBA5^^0^B50227072
"BLD",4959,"KRN",9.8,"NM",49,0)
LRBEPEND^^0^B47036238
"BLD",4959,"KRN",9.8,"NM","B","LR291",38)

"BLD",4959,"KRN",9.8,"NM","B","LR7OB3",24)

"BLD",4959,"KRN",9.8,"NM","B","LR7OB69",23)

"BLD",4959,"KRN",9.8,"NM","B","LR7OF0",12)

"BLD",4959,"KRN",9.8,"NM","B","LR7OF1",39)

"BLD",4959,"KRN",9.8,"NM","B","LRBEBA",9)

"BLD",4959,"KRN",9.8,"NM","B","LRBEBA2",14)

"BLD",4959,"KRN",9.8,"NM","B","LRBEBA21",43)

"BLD",4959,"KRN",9.8,"NM","B","LRBEBA3",37)

"BLD",4959,"KRN",9.8,"NM","B","LRBEBA31",47)

"BLD",4959,"KRN",9.8,"NM","B","LRBEBA4",40)

"BLD",4959,"KRN",9.8,"NM","B","LRBEBA5",48)

"BLD",4959,"KRN",9.8,"NM","B","LRBEBAO",32)

"BLD",4959,"KRN",9.8,"NM","B","LRBEECP1",44)

"BLD",4959,"KRN",9.8,"NM","B","LRBEECPT",16)

"BLD",4959,"KRN",9.8,"NM","B","LRBEPEND",49)

"BLD",4959,"KRN",9.8,"NM","B","LRBEPRPT",42)

"BLD",4959,"KRN",9.8,"NM","B","LRCAPPH1",18)

"BLD",4959,"KRN",9.8,"NM","B","LRCAPPH3",46)

"BLD",4959,"KRN",9.8,"NM","B","LRFAST",26)

"BLD",4959,"KRN",9.8,"NM","B","LRNIGHT",45)

"BLD",4959,"KRN",9.8,"NM","B","LRORD1",2)

"BLD",4959,"KRN",9.8,"NM","B","LRORDST",3)

"BLD",4959,"KRN",9.8,"NM","B","LROW",20)

"BLD",4959,"KRN",9.8,"NM","B","LROW2A",21)

"BLD",4959,"KRN",9.8,"NM","B","LRTSTJAM",30)

"BLD",4959,"KRN",9.8,"NM","B","LRTSTSET",17)

"BLD",4959,"KRN",9.8,"NM","B","LRVER1",36)

"BLD",4959,"KRN",9.8,"NM","B","LRVER3",35)

"BLD",4959,"KRN",9.8,"NM","B","LRVR1",33)

"BLD",4959,"KRN",9.8,"NM","B","LRVR3",34)

"BLD",4959,"KRN",9.8,"NM","B","LRWU1",41)

"BLD",4959,"KRN",19,0)
19
"BLD",4959,"KRN",19,"NM",0)
^9.68A^7^4
"BLD",4959,"KRN",19,"NM",2,0)
LRED CPT^^0
"BLD",4959,"KRN",19,"NM",5,0)
LRBE PANEL CPT REPORT^^0
"BLD",4959,"KRN",19,"NM",6,0)
LRBE PENDREP^^0
"BLD",4959,"KRN",19,"NM",7,0)
LRLIAISON^^2
"BLD",4959,"KRN",19,"NM","B","LRBE PANEL CPT REPORT",5)

"BLD",4959,"KRN",19,"NM","B","LRBE PENDREP",6)

"BLD",4959,"KRN",19,"NM","B","LRED CPT",2)

"BLD",4959,"KRN",19,"NM","B","LRLIAISON",7)

"BLD",4959,"KRN",19.1,0)
19.1
"BLD",4959,"KRN",101,0)
101
"BLD",4959,"KRN",409.61,0)
409.61
"BLD",4959,"KRN",771,0)
771
"BLD",4959,"KRN",870,0)
870
"BLD",4959,"KRN",8989.51,0)
8989.51
"BLD",4959,"KRN",8989.52,0)
8989.52
"BLD",4959,"KRN",8994,0)
8994
"BLD",4959,"KRN","B",.4,.4)

"BLD",4959,"KRN","B",.401,.401)

"BLD",4959,"KRN","B",.402,.402)

"BLD",4959,"KRN","B",.403,.403)

"BLD",4959,"KRN","B",.5,.5)

"BLD",4959,"KRN","B",.84,.84)

"BLD",4959,"KRN","B",3.6,3.6)

"BLD",4959,"KRN","B",3.8,3.8)

"BLD",4959,"KRN","B",9.2,9.2)

"BLD",4959,"KRN","B",9.8,9.8)

"BLD",4959,"KRN","B",19,19)

"BLD",4959,"KRN","B",19.1,19.1)

"BLD",4959,"KRN","B",101,101)

"BLD",4959,"KRN","B",409.61,409.61)

"BLD",4959,"KRN","B",771,771)

"BLD",4959,"KRN","B",870,870)

"BLD",4959,"KRN","B",8989.51,8989.51)

"BLD",4959,"KRN","B",8989.52,8989.52)

"BLD",4959,"KRN","B",8994,8994)

"BLD",4959,"PRE")
LR291
"BLD",4959,"QUES",0)
^9.62^^
"BLD",4959,"REQB",0)
^9.611^21^11
"BLD",4959,"REQB",12,0)
LR*5.2*286^2
"BLD",4959,"REQB",15,0)
LR*5.2*272^2
"BLD",4959,"REQB",16,0)
LR*5.2*274^2
"BLD",4959,"REQB",17,0)
LR*5.2*299^2
"BLD",4959,"REQB",18,0)
LA*5.2*64^2
"BLD",4959,"REQB",19,0)
LR*5.2*224^2
"BLD",4959,"REQB",20,0)
LR*5.2*290^2
"BLD",4959,"REQB",21,0)
LA*5.2*67^2
"BLD",4959,"REQB","B","LA*5.2*64",18)

"BLD",4959,"REQB","B","LA*5.2*67",21)

"BLD",4959,"REQB","B","LR*5.2*224",19)

"BLD",4959,"REQB","B","LR*5.2*272",15)

"BLD",4959,"REQB","B","LR*5.2*274",16)

"BLD",4959,"REQB","B","LR*5.2*286",12)

"BLD",4959,"REQB","B","LR*5.2*290",20)

"BLD",4959,"REQB","B","LR*5.2*299",17)

"FIA",60)
LABORATORY TEST
"FIA",60,0)
^LAB(60,
"FIA",60,0,0)
60I
"FIA",60,0,1)
y^n^p^^^^n^^n
"FIA",60,0,10)

"FIA",60,0,11)

"FIA",60,0,"RLRO")

"FIA",60,0,"VR")
5.2^LR
"FIA",60,60)
1
"FIA",60,60,506)

"FIA",60,60,507)

"FIA",60,60,508)

"FIA",60,60.01)
1
"FIA",60,60.01,96)

"FIA",60,60.196)
0
"FIA",68)
ACCESSION
"FIA",68,0)
^LRO(68,
"FIA",68,0,0)
68I
"FIA",68,0,1)
y^n^p^^^^n^^n
"FIA",68,0,10)

"FIA",68,0,11)

"FIA",68,0,"RLRO")

"FIA",68,0,"VR")
5.2^LR
"FIA",68,68)
1
"FIA",68,68,.1)

"FIA",68,68,12)

"FIA",69)
LAB ORDER ENTRY
"FIA",69,0)
^LRO(69,
"FIA",69,0,0)
69D
"FIA",69,0,1)
y^n^p^^^^n^^n
"FIA",69,0,10)

"FIA",69,0,11)

"FIA",69,0,"RLRO")

"FIA",69,0,"VR")
5.2^LR
"FIA",69,69)
1
"FIA",69,69.03)
1
"FIA",69,69.03,21)

"FIA",69,69.03,22)

"FIA",69,69.03,22.1)

"FIA",69,69.05)
0
"FIA",69.9)
LABORATORY SITE
"FIA",69.9,0)
^LAB(69.9,
"FIA",69.9,0,0)
69.9
"FIA",69.9,0,1)
y^n^p^^^^n^^n
"FIA",69.9,0,10)

"FIA",69.9,0,11)

"FIA",69.9,0,"RLRO")

"FIA",69.9,0,"VR")
5.2^LR
"FIA",69.9,69.9)
1
"FIA",69.9,69.9,620)

"INI")
PRE^LR291
"INIT")
POST^LR291
"IX",69,69,"APP",0)
69^APP^Index is used to send AMA/Billable panels to PCE.^MU^^R^IR^W^69.03^^^^^A
"IX",69,69,"APP",.1,0)
^^9^9^3060105^
"IX",69,69,"APP",.1,1,0)
The "APP" index is used by routine LRBEBA5 to send Lab data to PCE.
"IX",69,69,"APP",.1,2,0)
EN^LRBEBA5 is called from routine LRNIGHT, the nightly cleanup task.
"IX",69,69,"APP",.1,3,0)
If the current date is the same as the date stored in PANEL PROCESS
"IX",69,69,"APP",.1,4,0)
DATE field (#620) of the LABORATORY SITE file (#69.9), then routine
"IX",69,69,"APP",.1,5,0)
LRBEBA5 uses index "APP" to locate data for AMA/Billable panels that
"IX",69,69,"APP",.1,6,0)
have not been sent to PCE due to pending results for atomic tests on
"IX",69,69,"APP",.1,7,0)
the panel.  Panel tests from the previous calendar month will be
"IX",69,69,"APP",.1,8,0)
"unbundled" and the CPT Codes for the verified atomic tests are sent
"IX",69,69,"APP",.1,9,0)
to PCE.
"IX",69,69,"APP",1)
S ^LRO(69,"APP",+X2(2),DA(2),DA(1),DA)=""
"IX",69,69,"APP",1.4)
I X2(1),X2(2)
"IX",69,69,"APP",2)
K ^LRO(69,"APP",+X1(2),DA(2),DA(1),DA)
"IX",69,69,"APP",2.4)
I X1(1),X1(2),'X2(1)
"IX",69,69,"APP",11.1,0)
^.114IA^2^2
"IX",69,69,"APP",11.1,1,0)
1^F^69.03^22.1^^^F
"IX",69,69,"APP",11.1,2,0)
2^F^69.03^22^^^F
"KRN",19,8770,-1)
2^7
"KRN",19,8770,0)
LRLIAISON^Lab liaison menu^^M^2438^LRLIASON^^^^^^26
"KRN",19,8770,10,0)
^19.01IP^39^39
"KRN",19,8770,10,38,0)
12089
"KRN",19,8770,10,38,"^")
LRBE PANEL CPT REPORT
"KRN",19,8770,10,39,0)
12545
"KRN",19,8770,10,39,"^")
LRBE PENDREP
"KRN",19,8770,"U")
LAB LIAISON MENU
"KRN",19,11700,-1)
0^2
"KRN",19,11700,0)
LRED CPT^Test/Specimen/CPT Link^^R^^^^^^^^
"KRN",19,11700,1,0)
^19.06^5^5^3030912^^^^
"KRN",19,11700,1,1,0)
This option is used to update the LABORATORY TEST (#60) file with the
"KRN",19,11700,1,2,0)
appropriate CPT/HCPCS codes necessary for billing.  For each test, the option
"KRN",19,11700,1,3,0)
provides entry of CPT codes at the specimen level.  It also allows entry of a
"KRN",19,11700,1,4,0)
default CPT or default HCPCS code for the test.  If no CPT is entered, the
"KRN",19,11700,1,5,0)
billing system will use the CPT code located in the WKLD CODE (#64) file.
"KRN",19,11700,25)
LRBEECPT
"KRN",19,11700,99.1)
59976,39298
"KRN",19,11700,"U")
TEST/SPECIMEN/CPT LINK
"KRN",19,12089,-1)
0^5
"KRN",19,12089,0)
LRBE PANEL CPT REPORT^Lab Tests and CPT Report^^R^^^^^^n^^LAB SERVICE
"KRN",19,12089,1,0)
^19.06^47^47^3060318^^
"KRN",19,12089,1,1,0)
This option is designed to be reviewed by billing department and/or the
"KRN",19,12089,1,2,0)
Lab service to determine if laboratory file setup complies with billing
"KRN",19,12089,1,3,0)
guidelines and regulations. This option should be assigned to persons 
"KRN",19,12089,1,4,0)
involved with lab billing compliance including all applicable lab staff
"KRN",19,12089,1,5,0)
(e.g. LIM, Lab Manager, AO, etc.).
"KRN",19,12089,1,6,0)
 
"KRN",19,12089,1,7,0)
This option will print CPT codes that will be passed to PCE based on the 
"KRN",19,12089,1,8,0)
Laboratory Billing Aware PCE reporting hierarchy. This report should be 
"KRN",19,12089,1,9,0)
used to assist proper CPT coding of laboratory test and panels. This 
"KRN",19,12089,1,10,0)
report will provide an alphabetical list of active laboratory procedures 
"KRN",19,12089,1,11,0)
that have CPT codes. There are multiple report sorting options provided; 
"KRN",19,12089,1,12,0)
all are printed in the same format. The data printed is determined by 
"KRN",19,12089,1,13,0)
certain fields in the Laboratory Test (#60) file and WKLD CODE (#64) file.
"KRN",19,12089,1,14,0)
Consult patch LR*5.2*291 documentation for coding guidelines.
"KRN",19,12089,1,15,0)
 
"KRN",19,12089,1,16,0)
There are two forms of the report depending if the test is panel or 
"KRN",19,12089,1,17,0)
atomic. This is an example of a AMA Compliant panel test.
"KRN",19,12089,1,18,0)
Legend: IEN of test = Test Name
"KRN",19,12089,1,19,0)
       CPT code  CPT code name  [Field location where the CPT is located]*
"KRN",19,12089,1,20,0)
'*' Indicates this is a AMA Compliant panel.
"KRN",19,12089,1,21,0)
If test is a panel: a listing of the atomic tests
"KRN",19,12089,1,22,0)
*********** r = Required Test [IEN of test] Test Name
"KRN",19,12089,1,23,0)
 
"KRN",19,12089,1,24,0)
372  =  LYTES
"KRN",19,12089,1,25,0)
        80051  ELECTROLYTE PANEL  [DEFAULT SITE/SPECIMEN CPT]*
"KRN",19,12089,1,26,0)
 
"KRN",19,12089,1,27,0)
372 = LYTES
"KRN",19,12089,1,28,0)
**********     r[176]  SODIUM
"KRN",19,12089,1,29,0)
               r[177]  POTASSIUM
"KRN",19,12089,1,30,0)
               r[178]  CHLORIDE
"KRN",19,12089,1,31,0)
               r[179]  CO2
"KRN",19,12089,1,32,0)
 
"KRN",19,12089,1,33,0)
The second form is for atomic test. This form includes CPT codes by 
"KRN",19,12089,1,34,0)
specimen if the test has SITE/SPECIMEN  (multiple) entries.
"KRN",19,12089,1,35,0)
 
"KRN",19,12089,1,36,0)
176 = r SODIUM  
"KRN",19,12089,1,37,0)
        84295  ASSAY OF SERUM SODIUM  [WKLD CODE-84295.0000]
"KRN",19,12089,1,38,0)
176 = r SODIUM   (SPEC) = URINE
"KRN",19,12089,1,39,0)
        84300  ASSAY OF URINE SODIUM  [WKLD CODE-84300.0000]
"KRN",19,12089,1,40,0)
176 = r SODIUM   (SPEC) = SERUM
"KRN",19,12089,1,41,0)
        84295  ASSAY OF SERUM SODIUM  [WKLD CODE-84295.0000]
"KRN",19,12089,1,42,0)
176 = r SODIUM   (SPEC) = PLASMA
"KRN",19,12089,1,43,0)
        84295  ASSAY OF SERUM SODIUM  [WKLD CODE-84295.0000]
"KRN",19,12089,1,44,0)
 
"KRN",19,12089,1,45,0)
If the procedure has SITE/SPECIMEN (#100) field, each specimen will also 
"KRN",19,12089,1,46,0)
be indicated
"KRN",19,12089,1,47,0)
(SPEC) = Specimen name from TOPOGRAPHY FIELD (#61) file.
"KRN",19,12089,25)
ASK^LRBEPRPT
"KRN",19,12089,"U")
LAB TESTS AND CPT REPORT
"KRN",19,12545,-1)
0^6
"KRN",19,12545,0)
LRBE PENDREP^Print AMA CPT Panel Pending List^^R^^^^^^^^
"KRN",19,12545,1,0)
^19.06^12^12^3060119^^^^
"KRN",19,12545,1,1,0)
When one or more of the 'required' atomic tests of an AMA/Billable panel 
"KRN",19,12545,1,2,0)
remain in the PENDING status by the roll-up date, the laboratory sends the 
"KRN",19,12545,1,3,0)
individual atomic level CPT codes for each verified test to PCE.  On the 
"KRN",19,12545,1,4,0)
roll-up date the laboratory software searches the previous calendar month
"KRN",19,12545,1,5,0)
for panel tests in the pending status. 
"KRN",19,12545,1,6,0)
   
"KRN",19,12545,1,7,0)
The roll-up date can be found in the PROCESS PANEL DATE field (#620) of the
"KRN",19,12545,1,8,0)
LABORATORY SITE file (#69.9).
"KRN",19,12545,1,9,0)
   
"KRN",19,12545,1,10,0)
This report identifies AMA/Billable panel tests from the previous calendar 
"KRN",19,12545,1,11,0)
month that have one or more 'required' atomic tests that are still in a 
"KRN",19,12545,1,12,0)
pending status and require review.
"KRN",19,12545,25)
EN^LRBEPEND
"KRN",19,12545,"U")
PRINT AMA CPT PANEL PENDING LI
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2981028^66481
"PKG",26,22,1,"PAH",1,0)
291^3060320^2438
"PKG",26,22,1,"PAH",1,1,0)
^^1^1^3060320
"PKG",26,22,1,"PAH",1,1,1,0)
VISTA Laboratory Clinical Indicator Data Capture (Patch LR*5.2*291)
"PRE")
LR291
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
32
"RTN","LR291")
0^38^B21675343
"RTN","LR291",1,0)
LR291 ;DAL/WTY - LR*5.2*291 PATCH ENVIRONMENT CHECK ROUTINE ;8/10/04
"RTN","LR291",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LR291",3,0)
EN ; Does not prevent loading of the transport global.
"RTN","LR291",4,0)
 ; Environment check is done only during the install.
"RTN","LR291",5,0)
 ;
"RTN","LR291",6,0)
 I '$G(XPDENV) D  Q
"RTN","LR291",7,0)
 .N XQA,XQAMSG
"RTN","LR291",8,0)
 .S XQAMSG="Transport global for patch "_$G(XPDNM,"Unknown patch")
"RTN","LR291",9,0)
 .S XQAMSG=XQAMSG_" loaded on "_$$HTE^XLFDT($H)
"RTN","LR291",10,0)
 .S XQA("G.LMI")=""
"RTN","LR291",11,0)
 .D SETUP^XQALERT
"RTN","LR291",12,0)
 .S MSG="Sending transport global loaded alert to mail group G.LMI"
"RTN","LR291",13,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR291",14,0)
 ;
"RTN","LR291",15,0)
 D P68
"RTN","LR291",16,0)
 D CHECK
"RTN","LR291",17,0)
 D EXIT
"RTN","LR291",18,0)
 Q
"RTN","LR291",19,0)
 ;
"RTN","LR291",20,0)
CHECK ; Perform environment check
"RTN","LR291",21,0)
 ;
"RTN","LR291",22,0)
 I $S('$G(IOM):1,'$G(IOSL):1,$G(U)'="^":1,1:0) D  Q
"RTN","LR291",23,0)
 .D BMES^XPDUTL($$CJ^XLFSTR("Terminal Device is not defined",80))
"RTN","LR291",24,0)
 .S XPDQUIT=2
"RTN","LR291",25,0)
 ;
"RTN","LR291",26,0)
 I $S('$G(DUZ):1,$D(DUZ)[0:1,$D(DUZ(0))[0:1,1:0) D  Q
"RTN","LR291",27,0)
 .S MSG="Please log in to set local DUZ... variables"
"RTN","LR291",28,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR291",29,0)
 .S XPDQUIT=2
"RTN","LR291",30,0)
 ;
"RTN","LR291",31,0)
 I '$D(^VA(200,$G(DUZ),0))#2 D  Q
"RTN","LR291",32,0)
 .S MSG="You are not a valid user on this system"
"RTN","LR291",33,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR291",34,0)
 .S XPDQUIT=2
"RTN","LR291",35,0)
 ;
"RTN","LR291",36,0)
 S XPDDIQ("XPZ1")=0
"RTN","LR291",37,0)
 ;
"RTN","LR291",38,0)
 Q
"RTN","LR291",39,0)
 ;
"RTN","LR291",40,0)
EXIT ;
"RTN","LR291",41,0)
 I $G(XPDQUIT) D
"RTN","LR291",42,0)
 .S MSG="--- Install Environment Check FAILED ---"
"RTN","LR291",43,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR291",44,0)
 I '$G(XPDQUIT) D
"RTN","LR291",45,0)
 .D BMES^XPDUTL($$CJ^XLFSTR("--- Environment Check is Ok ---",80))
"RTN","LR291",46,0)
 Q
"RTN","LR291",47,0)
 ;
"RTN","LR291",48,0)
PRE ; KIDS Pre install for LR*5.2*291
"RTN","LR291",49,0)
 ;
"RTN","LR291",50,0)
 N XQA,XQAMSG
"RTN","LR291",51,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")
"RTN","LR291",52,0)
 S XQAMSG=XQAMSG_" started on "_$$HTE^XLFDT($H)
"RTN","LR291",53,0)
 S XQA("G.LMI")=""
"RTN","LR291",54,0)
 D SETUP^XQALERT
"RTN","LR291",55,0)
 ;
"RTN","LR291",56,0)
 S MSG="Sending install started alert to mail group G.LMI"
"RTN","LR291",57,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR291",58,0)
 ;
"RTN","LR291",59,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install started ***",80))
"RTN","LR291",60,0)
 ;
"RTN","LR291",61,0)
 S Y=$$OPTDE^XPDUTL("LRMENU",2)
"RTN","LR291",62,0)
 S MSG="Disabling Laboratory DHCP Menu [LRMENU] option"
"RTN","LR291",63,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR291",64,0)
 ;
"RTN","LR291",65,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install completed ***",80))
"RTN","LR291",66,0)
 ;
"RTN","LR291",67,0)
 Q
"RTN","LR291",68,0)
 ;
"RTN","LR291",69,0)
POST ; KIDS Post install for LR*5.2*291
"RTN","LR291",70,0)
 ;
"RTN","LR291",71,0)
 N XQA,XQAMSG
"RTN","LR291",72,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install started ***",80))
"RTN","LR291",73,0)
 ;
"RTN","LR291",74,0)
 K MSG
"RTN","LR291",75,0)
 S MSG(1)=" "
"RTN","LR291",76,0)
 S MSG(2)=" ************************ IMPORTANT ************************"
"RTN","LR291",77,0)
 S MSG(3)=" * Please run option LAB TESTS AND PANELS REPORT           *"
"RTN","LR291",78,0)
 S MSG(4)=" * [LRBE PANEL REPORT] to generate a listing of all tests  *"
"RTN","LR291",79,0)
 S MSG(5)=" * in the LABORATORY TEST (#60) file and the associated    *"
"RTN","LR291",80,0)
 S MSG(6)=" * CPT codes that will be sent to PCE for billing.  The    *"
"RTN","LR291",81,0)
 S MSG(7)=" * report should be used by the coders to enter the proper *"
"RTN","LR291",82,0)
 S MSG(8)=" * CPT codes in the LABORATORY TEST (#60) file. This option*"
"RTN","LR291",83,0)
 S MSG(9)=" * is located in the Lab liaison [LRLIAISON] menu.         *"
"RTN","LR291",84,0)
 S MSG(10)=" ***********************************************************"
"RTN","LR291",85,0)
 D BMES^XPDUTL(.MSG) K MSG
"RTN","LR291",86,0)
 ;
"RTN","LR291",87,0)
 S Y=$$OPTDE^XPDUTL("LRMENU",1)
"RTN","LR291",88,0)
 S MSG="Enabling Laboratory DHCP Menu [LRMENU] option"
"RTN","LR291",89,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR291",90,0)
 ;
"RTN","LR291",91,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install completed ***",80))
"RTN","LR291",92,0)
 ;
"RTN","LR291",93,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")
"RTN","LR291",94,0)
 S XQAMSG=XQAMSG_" completed on "_$$HTE^XLFDT($H)
"RTN","LR291",95,0)
 S XQA("G.LMI")=""
"RTN","LR291",96,0)
 D SETUP^XQALERT
"RTN","LR291",97,0)
 ;
"RTN","LR291",98,0)
 S MSG="Sending install completion alert to mail group G.LMI"
"RTN","LR291",99,0)
 D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR291",100,0)
 ;
"RTN","LR291",101,0)
 Q
"RTN","LR291",102,0)
P68 ; Modify the RESPONIBLE OFFICAL in #68
"RTN","LR291",103,0)
 N A,B,DIC,ENT,HD,QT,Y,USR
"RTN","LR291",104,0)
 S QT=0
"RTN","LR291",105,0)
 S A="" F  S A=$O(^LRO(68,"B",A)) Q:A=""!(QT)  D
"RTN","LR291",106,0)
 .S B="" F  S B=$O(^LRO(68,"B",A,B)) Q:B=""!(QT)  D
"RTN","LR291",107,0)
 ..I $P(^LRO(68,"B",A,B),"^",1)=1!('$D(^LRO(68,B))) Q
"RTN","LR291",108,0)
 ..S HD="ACCESSION AREA: "_A D EN^DDIOL(HD,"","!")
"RTN","LR291",109,0)
 ..S X=$$GET1^DIQ(68,B_",",".1","I")
"RTN","LR291",110,0)
 ..S USR=$S($D(^VA(200,+X,0)):$P(^(0),"^"),1:X)
"RTN","LR291",111,0)
 ..S ENT="  Old RESPONSIBLE OFFICIAL: "_USR D EN^DDIOL(ENT,"","!")
"RTN","LR291",112,0)
 ..S DIC="^VA(200,",DIC("A")="  New RESPONSIBLE OFFICIAL: "
"RTN","LR291",113,0)
 ..S DIC="^VA(200,",DIC("B")=USR,DIC(0)="AMEQZ" D ^DIC
"RTN","LR291",114,0)
 ..I $D(DTOUT)!($D(DUOUT))!(+Y=-1) S QT=1 K DIC Q:QT
"RTN","LR291",115,0)
 ..D SET(B,+Y)
"RTN","LR291",116,0)
 Q
"RTN","LR291",117,0)
SET(TIEN,RO) ; Set #68
"RTN","LR291",118,0)
 N LRFDA,FIL,IEN
"RTN","LR291",119,0)
 S FIL=68,IEN=TIEN_","
"RTN","LR291",120,0)
 S LRFDA(99,FIL,IEN,.1)=RO
"RTN","LR291",121,0)
 D UPDATE^DIE("","LRFDA(99)","","LRERR")
"RTN","LR291",122,0)
 Q
"RTN","LR7OB3")
0^24^B24033857^B23426692
"RTN","LR7OB3",1,0)
LR7OB3 ;DALOI/DCM/JAH - Build message, backdoor from Lab order # ;8/10/04
"RTN","LR7OB3",2,0)
 ;;5.2;LAB SERVICE;**121,187,272,291**;Sep 27, 1994
"RTN","LR7OB3",3,0)
69 K ^TMP("LRX",$J)
"RTN","LR7OB3",4,0)
 D 69^LR7OB69(ODT,SN) Q:'$D(^TMP("LRX",$J,69))  G OUT:'$D(DFN) D:LRFIRST FIRST^LR7OB0 S LRFIRST=0
"RTN","LR7OB3",5,0)
SNEAK ;
"RTN","LR7OB3",6,0)
 N Y,Y9,Y10,Y11,GRP,L1,L2,L3,END
"RTN","LR7OB3",7,0)
 S IFN=0 F  S IFN=$O(^TMP("LRX",$J,69,IFN)) Q:IFN<1  S (COBR,COBX)=0 D
"RTN","LR7OB3",8,0)
 . I $O(^TMP("LRX",$J,69,IFN,68,0)) S Z=^TMP("LRX",$J,69,IFN,68) D  Q
"RTN","LR7OB3",9,0)
 .. S IFN1=0 F  S IFN1=$O(^TMP("LRX",$J,69,IFN,68,IFN1)) Q:IFN1<1  S Z1=^TMP("LRX",$J,69,IFN,68,IFN1) D
"RTN","LR7OB3",10,0)
 ... S (Y9,Y10,Y11)="" I $P($G(^LAB(60,+Z1,64)),"^") S Y9=$P(^(64),"^"),Y10=$P(^LAM(Y9,0),"^"),Y9=$P(^(0),"^",2),Y11="99NLT"
"RTN","LR7OB3",11,0)
 ... S X1=$$UVID^LR7OU0($P(Z1,"^"),$P(^TMP("LRX",$J,69),"^",10),Y9,Y11,Y10,.MSG,$G(SS))
"RTN","LR7OB3",12,0)
 ... S X2=$$HL7DT^LR7OU0($P(Z,"^",4)) ;Obs Start date
"RTN","LR7OB3",13,0)
 ... S X3=$$ACTCODE^LR7OU0($P(^TMP("LRX",$J,69),"^",4)) ;Specimen Act Code
"RTN","LR7OB3",14,0)
 ... S X4=$$HL7DT^LR7OU0($P(Z,"^",5)) ;Specimen Received D/T
"RTN","LR7OB3",15,0)
 ... S X5=$$SAMP^LR7OU0($P(^TMP("LRX",$J,69),"^",3),$P(^TMP("LRX",$J,69),"^",10)) ;Specimen Source
"RTN","LR7OB3",16,0)
 ... S X6=$P(Z,"^",3) ;Filler Fld 1 (Accession)
"RTN","LR7OB3",17,0)
 ... S X7=$$HL7DT^LR7OU0($P(Z,"^",6)) ;Results rpt/Sts Change D/T
"RTN","LR7OB3",18,0)
 ... S (GRP,END)=0
"RTN","LR7OB3",19,0)
 ... I '$G(CORRECT),$P(Z,"^",6) S GRP=1
"RTN","LR7OB3",20,0)
 ... S X8=$S($G(CORRECT):"C",$P(Z,"^",6):$S(GRP:"F",1:"I"),$P(Z,"^",5):"I",1:"O") ;Result Status
"RTN","LR7OB3",21,0)
 ... D AX8
"RTN","LR7OB3",22,0)
 ... S X10=$P(^TMP("LRX",$J,69),"^",7),$P(@MSG@(3),"|",4)=X10 ;Routing Location
"RTN","LR7OB3",23,0)
 ... S X9="^^^^^"_$$URG^LR7OU0($P(^TMP("LRX",$J,69,IFN),"^",2))
"RTN","LR7OB3",24,0)
 ... I $O(LINK(0)) S CTR=CTR+1 D NTE^LR7OU01(2,"L","LINK(",CTR) K LINK
"RTN","LR7OB3",25,0)
 ... I $O(^TMP("LRX",$J,69,IFN,"NC",0)) S CTR=CTR+1 D NTE^LR7OU01("","L","^TMP(""LRX"",$J,69,"_IFN_",""NC"",",CTR)
"RTN","LR7OB3",26,0)
 ... I CONTROL'="SN" S CTR=CTR+1 D NTE^LR7OU01("","P","^TMP(""LRX"",$J,69,"_IFN_",""N"",",CTR)
"RTN","LR7OB3",27,0)
 ... I CONTROL'="SN" S CTR=CTR+1 D NTE^LR7OU01("","P","^TMP(""LRX"",$J,69,""N"",",CTR)
"RTN","LR7OB3",28,0)
 ... S CTR=CTR+1,COBR=COBR+1,OBRMSG=CTR D OBR^LR7OU01(CTR)
"RTN","LR7OB3",29,0)
 ... S CTR=CTR+1 D SDG1^LRBEBA2(IFN,.CTR,.MSG)
"RTN","LR7OB3",30,0)
 ... I CONTROL="SN" S CTR=CTR+1 D NTE^LR7OU01("","P","^TMP(""LRX"",$J,69,"_IFN_",""N"",",CTR)
"RTN","LR7OB3",31,0)
 ... I CONTROL="SN" S CTR=CTR+1 D NTE^LR7OU01("","P","^TMP(""LRX"",$J,69,""N"",",CTR)
"RTN","LR7OB3",32,0)
 .. S IFN1=0 F  S IFN1=$O(^TMP("LRX",$J,69,IFN,63,IFN1)) Q:IFN1<1  S Z1=^TMP("LRX",$J,69,IFN,63,IFN1) D
"RTN","LR7OB3",33,0)
 ... S X1=$S($L($P(Z1,"^",8)):$P(Z1,"^",8),1:"ST") ;Value type
"RTN","LR7OB3",34,0)
 ... S X2=$$UVID^LR7OU0($P(Z1,"^"),$P(^TMP("LRX",$J,69),"^",10),$P(Z1,"^",9),$P(Z1,"^",11),$P(Z1,"^",10),.MSG,$G(SS))
"RTN","LR7OB3",35,0)
 ... S X3=$P(Z1,"^",7) ;Obs SubID
"RTN","LR7OB3",36,0)
 ... S X4=$P(Z1,"^",2) S:$L($P(Z1,"^",9))&(MSG["LRAP") X4=$P(Z1,"^",9)_"^"_$P(Z1,"^",2)_"^"_$P(Z1,"^",10) ;Value
"RTN","LR7OB3",37,0)
 ... S X5=$P(Z1,"^",4) ;Units
"RTN","LR7OB3",38,0)
 ... S X6=$P(Z1,"^",5) ;Ref Ranges
"RTN","LR7OB3",39,0)
 ... S X7=$$FLAG^LR7OU0($P(Z1,"^",3)) ;Flag
"RTN","LR7OB3",40,0)
 ... S (GRP,END)=0
"RTN","LR7OB3",41,0)
 ... I '$G(CORRECT),$P(Z1,"^",6)="F"!($P(Z,"^",6)) S GRP=1
"RTN","LR7OB3",42,0)
 ... S X8=$S($G(CORRECT):"C",$P(Z1,"^",6)="F"!($P(Z,"^",6)):$S(GRP:"F",1:"I"),$L($P(Z1,"^",6)):$S($P(Z1,"^",6)'="F":$P(Z1,"^",6),1:"R"),1:"R")
"RTN","LR7OB3",43,0)
 ... S $P(@MSG@(OBRMSG),"|",26)=X8 ;Result Status
"RTN","LR7OB3",44,0)
 ... I @MSG@(OBRMSG)'?.E1"|",$O(@MSG@(OBRMSG,0))]"" S @MSG@(OBRMSG)=@MSG@(OBRMSG)_"|" ;RLM
"RTN","LR7OB3",45,0)
 ... D AX8
"RTN","LR7OB3",46,0)
 ... I $L($P(Z1,"^",18)) S X=$P(@MSG@(ORCMSG),"|",4),Y=$P(X,"^",2),X=$P(X,"^")_$P(Z1,"^",18) S $P(@MSG@(ORCMSG),"|",4)=X_"^"_Y ;Append 63 ptr to placer ID
"RTN","LR7OB3",47,0)
 ... S X10=$P(Z1,"^",14) ;Theraputic flag
"RTN","LR7OB3",48,0)
 ... S X11=$P(Z1,"^",12) ;Verified by
"RTN","LR7OB3",49,0)
 ... S CTR=CTR+1,COBX=COBX+1 D OBX^LR7OU01(CTR)
"RTN","LR7OB3",50,0)
 .. I $O(^TMP("LRX",$J,69,IFN,63,0)),$O(^("N",0)) S CTR=CTR+1 D NTE^LR7OU01("","L","^TMP(""LRX"",$J,69,"_IFN_",63,""N"",",CTR)
"RTN","LR7OB3",51,0)
 . S Z=$G(^TMP("LRX",$J,69,IFN))
"RTN","LR7OB3",52,0)
 . S (Y9,Y10,Y11)="" I $P($G(^LAB(60,+Z,64)),"^") S Y9=$P(^(64),"^"),Y10=$P(^LAM(Y9,0),"^"),Y9=$P(^(0),"^",2),Y11="99NLT"
"RTN","LR7OB3",53,0)
 . S X1=$$UVID^LR7OU0($P(Z,"^"),$P(^TMP("LRX",$J,69),"^",10),Y9,Y11,Y10,.MSG,$G(SS))
"RTN","LR7OB3",54,0)
 . S X2="" ;Obs Start date
"RTN","LR7OB3",55,0)
 . S X3=$$ACTCODE^LR7OU0($P(^TMP("LRX",$J,69),"^",4)) ;Specimen Action Code
"RTN","LR7OB3",56,0)
 . S X4="" ;Specimen Received D/T
"RTN","LR7OB3",57,0)
 . S X5=$$SAMP^LR7OU0($P(^TMP("LRX",$J,69),"^",3),$P(^TMP("LRX",$J,69),"^",10)) ;Specimen Source
"RTN","LR7OB3",58,0)
 . S X6="" ;Filler Fld 1 (Accession)
"RTN","LR7OB3",59,0)
 . S X7="" ;Results rpt/Sts change D/T
"RTN","LR7OB3",60,0)
 . S X8="O"
"RTN","LR7OB3",61,0)
 . I $G(CONTROL)="RE",$P(Z,"^",8) S X8=$S($G(CORRECT):"C",1:"F"),$P(@MSG@(ORCMSG),"|",6)="CM" ;Status
"RTN","LR7OB3",62,0)
 . S X10=$P(^TMP("LRX",$J,69),"^",7),$P(@MSG@(3),"|",4)=X10 ;Routing Location
"RTN","LR7OB3",63,0)
 . S X9="^^^^^"_$$URG^LR7OU0($P($G(^TMP("LRX",$J,69,IFN)),"^",2))
"RTN","LR7OB3",64,0)
 . I $O(LINK(0)) S CTR=CTR+1 D NTE^LR7OU01(2,"L","LINK(",CTR) K LINK
"RTN","LR7OB3",65,0)
 . I $O(^TMP("LRX",$J,69,IFN,"NC",0)) S CTR=CTR+1 D NTE^LR7OU01("","L","^TMP(""LRX"",$J,69,"_IFN_",""NC"",",CTR)
"RTN","LR7OB3",66,0)
 . I CONTROL'="SN" S CTR=CTR+1 D NTE^LR7OU01("","P","^TMP(""LRX"",$J,69,"_IFN_",""N"",",CTR)
"RTN","LR7OB3",67,0)
 . I CONTROL'="SN" S CTR=CTR+1 D NTE^LR7OU01("","P","^TMP(""LRX"",$J,69,""N"",",CTR)
"RTN","LR7OB3",68,0)
 . S CTR=CTR+1,COBR=COBR+1,OBRMSG=CTR D OBR^LR7OU01(CTR)
"RTN","LR7OB3",69,0)
 . S CTR=CTR+1 D SDG1^LRBEBA2(IFN,.CTR,.MSG)
"RTN","LR7OB3",70,0)
 . I CONTROL="SN" S CTR=CTR+1 D NTE^LR7OU01("","P","^TMP(""LRX"",$J,69,""N"",",CTR)
"RTN","LR7OB3",71,0)
 . I CONTROL="SN" S CTR=CTR+1 D NTE^LR7OU01("","P","^TMP(""LRX"",$J,69,"_IFN_",""N"",",CTR)
"RTN","LR7OB3",72,0)
OUT ;Exit here
"RTN","LR7OB3",73,0)
 K ^TMP("LRX",$J)
"RTN","LR7OB3",74,0)
 Q
"RTN","LR7OB3",75,0)
AX8 ;Modify order status based on result status
"RTN","LR7OB3",76,0)
 I X8="F"!(X8="C")!($G(LRSTATI)=2) S $P(@MSG@(ORCMSG),"|",6)="CM" Q  ;Order Status
"RTN","LR7OB3",77,0)
 I X8="I" S $P(@MSG@(ORCMSG),"|",6)="SC"
"RTN","LR7OB3",78,0)
 Q
"RTN","LR7OB69")
0^23^B8923375^B8682133
"RTN","LR7OB69",1,0)
LR7OB69 ;slc/dcm/JAH - Get Lab order data from 69 - 68 - 63 ;8/10/04
"RTN","LR7OB69",2,0)
 ;;5.2;LAB SERVICE;**121,187,224,291**;Sep 27, 1994
"RTN","LR7OB69",3,0)
 ;
"RTN","LR7OB69",4,0)
69(ODT,SN) ;Get data from file 69
"RTN","LR7OB69",5,0)
 ;ODT=Order Date subscript in file 69
"RTN","LR7OB69",6,0)
 ;SN=Specimen number subscript in file 69
"RTN","LR7OB69",7,0)
 ;Y1=Lab order number
"RTN","LR7OB69",8,0)
 ;Y2=Start date
"RTN","LR7OB69",9,0)
 ;Y3=Sample
"RTN","LR7OB69",10,0)
 ;Y4=Collection type/Specimen Action code
"RTN","LR7OB69",11,0)
 ;Y5=Order date
"RTN","LR7OB69",12,0)
 ;Y6=Provider
"RTN","LR7OB69",13,0)
 ;Y7=Routing Location
"RTN","LR7OB69",14,0)
 ;Y8=Lab arrival time
"RTN","LR7OB69",15,0)
 ;Y9=Date/Time Results Available
"RTN","LR7OB69",16,0)
 ;Y10=Specimen
"RTN","LR7OB69",17,0)
 ;Y11=OERR Order #
"RTN","LR7OB69",18,0)
 ;Y12=Entering person
"RTN","LR7OB69",19,0)
 ;^TMP("LRX",$J,69)=Y1^Y2^Y3^Y4^Y5^Y6^Y7^Y8^Y9^Y10^Y11^Y12
"RTN","LR7OB69",20,0)
 ;^TMP("LRX",$J,69,i)=Test^Urgency^Accession Date^Accession area^Accession #^Combined on order^ORIFN^Panel exploded
"RTN","LR7OB69",21,0)
 ;^TMP("LRX",$J,69,"N",i)=Specimen level comments (6 node)
"RTN","LR7OB69",22,0)
 ;^TMP("LRX",$J,69,i,"N",ifn)=Comments by test
"RTN","LR7OB69",23,0)
 ;^TMP("LRX",$J,69,i,"NC",ifn)=Free text cancel reason
"RTN","LR7OB69",24,0)
 ;^TMP("LRX",$J,69,i,"DGX",ifn)=diagnosis^SC^CV^AO^IR^EC^HNC^MST
"RTN","LR7OB69",25,0)
 ;^TMP("LRX",$J,69,i,63,ifn)=
"RTN","LR7OB69",26,0)
 ;Test subscript^Result^Flag^Units^Ref Range^Result status^Observation Sub ID^Value type^Natl Procedure code^Natl Procedure Name^Natl Coding System^Verified by^^Theraputic flag (T or "")^Print name^Accession^Order #^Link to 63
"RTN","LR7OB69",27,0)
 ;^TMP("LRX",$J,69,i,63,"N",ifn)=Result Comments
"RTN","LR7OB69",28,0)
 ;^TMP("LRX",$J,69,i,68)=Lab Order #^LRDFN^Accession^Draw Time^Lab Arrival time^DT Results Available^Inverse Date
"RTN","LR7OB69",29,0)
 ;^TMP("LRX",$J,69,i,68,ifn)=Test^Urgency^Technologist^Complete Date
"RTN","LR7OB69",30,0)
 ;^TMP("LRX",$J,69,"N",i)= Ward comments on specimen
"RTN","LR7OB69",31,0)
 N X,X0,XP1,X1,X4,Y1,Y2,Y3,Y4,Y5,Y6,Y7,Y8,Y9,Y10,Y11,Y12,IFN,TSTY,NOTE,GOTCOM K ^TMP("LRX",$J,69)
"RTN","LR7OB69",32,0)
 Q:'$D(^LRO(69,+ODT,1,+SN,0))  S X0=^(0),XP1=$G(^(.1)),X1=$G(^(1)),X3=$G(^(3)),X4=$O(^(4,0))
"RTN","LR7OB69",33,0)
 Q:'$D(^LR(+X0,0))  ;No matching entry in ^LR
"RTN","LR7OB69",34,0)
 S:'$D(DFN) DFN=$P(^LR(+X0,0),"^",3) S:'$D(LRDFN) LRDFN=+X0 S:'$D(LRDPF) LRDPF=$P(^LR(+X0,0),"^",2)_$G(^DIC(+$P(^LR(+X0,0),"^",2),0,"GL"))
"RTN","LR7OB69",35,0)
 S Y1=+XP1,Y2=$S($P(X1,"^"):$P(X1,"^"),1:$P(X0,"^",8)),Y3=$P(X0,"^",3),Y4=$P(X0,"^",4),Y5=$P(X0,"^",5),Y6=$P(X0,"^",6),Y7=$P(X0,"^",7),Y8=$P(X3,"^"),Y9=$P(X3,"^",2),Y11=$P(X0,"^",11),Y12=$P(X0,"^",2)
"RTN","LR7OB69",36,0)
 S:$L(Y7) Y7=$O(^SC("C",Y7,0))
"RTN","LR7OB69",37,0)
 ;canceled entries are skipped, so calls to this routine from options
"RTN","LR7OB69",38,0)
 ;that are removing tests need to make the call before setting the pieces
"RTN","LR7OB69",39,0)
 ;that cancel the test: $P(^LRO(69,ODT,1,SN,2,IFN,0),"^",11)
"RTN","LR7OB69",40,0)
 ;See DOUT^LRTSTJAN
"RTN","LR7OB69",41,0)
 S IFN=0 F  S IFN=$O(^LRO(69,ODT,1,SN,2,IFN)) Q:IFN<1  S X=$G(^(IFN,0)) I X,'$P(X,"^",11) D
"RTN","LR7OB69",42,0)
 . I $G(LRNIFN),$D(LRTMPO("LRIFN",LRNIFN)) Q:+X'=+LRTMPO("LRIFN",LRNIFN)
"RTN","LR7OB69",43,0)
 . S ^TMP("LRX",$J,69,IFN)=X,I=0
"RTN","LR7OB69",44,0)
 . D GDG1^LRBEBA2(ODT,SN,IFN)
"RTN","LR7OB69",45,0)
 . F  S I=$O(^LRO(69,ODT,1,SN,2,IFN,1,I)) Q:I<1  S X=^(I,0) D
"RTN","LR7OB69",46,0)
 .. S ^TMP("LRX",$J,69,IFN,"N",I)=X
"RTN","LR7OB69",47,0)
 . S I=0 F  S I=$O(^LRO(69,ODT,1,SN,2,IFN,1.1,I)) Q:I<1  S X=^(I,0) D
"RTN","LR7OB69",48,0)
 .. S ^TMP("LRX",$J,69,IFN,"NC",I)=X
"RTN","LR7OB69",49,0)
 S IFN=0 F  S IFN=$O(^LRO(69,ODT,1,SN,6,IFN)) Q:IFN<1  S X=^(IFN,0) D
"RTN","LR7OB69",50,0)
 . Q:X["removed ==>"  Q:X["deleted by"
"RTN","LR7OB69",51,0)
 . S ^TMP("LRX",$J,69,"N",IFN)=X
"RTN","LR7OB69",52,0)
 S Y10=$O(^LRO(69,ODT,1,SN,4,0)),Y10=$S(Y10:$P(^(Y10,0),"^"),1:"")
"RTN","LR7OB69",53,0)
 S ^TMP("LRX",$J,69)=Y1_"^"_Y2_"^"_Y3_"^"_Y4_"^"_Y5_"^"_Y6_"^"_Y7_"^"_Y8_"^"_Y9_"^"_Y10_"^"_Y11_"^"_Y12
"RTN","LR7OB69",54,0)
 S IFN=0 F  S IFN=$O(^TMP("LRX",$J,69,IFN)) Q:IFN<1  S X=^TMP("LRX",$J,69,IFN) S X1=$P(X,"^",3),X2=$P(X,"^",4),X3=$P(X,"^",5) K TSTY D EN^LR7OU1(+X,$P(^LAB(60,+X,0),"^",5)) D 68^LR7OB68(IFN,X1,X2,X3,+X)
"RTN","LR7OB69",55,0)
 Q
"RTN","LR7OF0")
0^12^B40209802^B39264678
"RTN","LR7OF0",1,0)
LR7OF0 ;slc/dcm/JAH - Receive/Route MSG array from OE/RR ;8/10/04
"RTN","LR7OF0",2,0)
 ;;5.2;LAB SERVICE;**121,187,223,230,256,291**;Sep 27, 1994
"RTN","LR7OF0",3,0)
 ;
"RTN","LR7OF0",4,0)
 ;This routine invokes IA #2187
"RTN","LR7OF0",5,0)
 ;
"RTN","LR7OF0",6,0)
EN(MSG,MSGTYPE) ;Route all messages from here
"RTN","LR7OF0",7,0)
 ;MSG=HL7 message array
"RTN","LR7OF0",8,0)
 ;MSGTYPE=LRCH for chem (default), LRAP for AP
"RTN","LR7OF0",9,0)
 N X,VISIT,LOC,LOCP,ROOM,DFN,LRPNM,LRXMSG,TEST,TESTN,TYPE,SAMP,SPEC,URG,ORIFN,STARTDT,LRDUZ,PROV,REASON,LRSX,LRLLOC,LROLLOC,LRPRAC,LROUTINE,LRSDT,LRXZ,LRODT,LRSAMP,LRSPEC,LRORDR,LRLB,LRNT,LRSX,LROT,LRCOM,LRI,LRIO,LRJ,LRORD,QUANT
"RTN","LR7OF0",10,0)
 N LOCA,LINE,LRHDR,LRORDER,LRORIFN,LRSN,LRSUM,LRSXN,LRTIME,LRTSTS,LRURG,LRSDT,LREND,LRXTYPE,LRXORC,LRDFN,LRDPF,LRPLACR,LRQUANT,LRVERZ,NOBR,NORC
"RTN","LR7OF0",11,0)
 S (NOBR,NORC)=1 ;flag to check for OBR, ORC segments
"RTN","LR7OF0",12,0)
 D END
"RTN","LR7OF0",13,0)
 S LRI=2,LRXORC="ORC"
"RTN","LR7OF0",14,0)
 F  S LRI=$O(MSG(LRI)) Q:LRI<1  S X=MSG(LRI) I $P(MSG(LRI),"|")="ORC" S LRXORC=MSG(LRI),NORC=0 Q
"RTN","LR7OF0",15,0)
 S LRHDR=$$HDRCHK($G(MSG(1)))
"RTN","LR7OF0",16,0)
 Q:'$L(LRHDR)
"RTN","LR7OF0",17,0)
 I '$$PIDCHK($G(MSG(2))) Q
"RTN","LR7OF0",18,0)
 I LRHDR="BHS" K ^TMP("OR",$J,"LRES")  Q  ;Initialization to begin batch
"RTN","LR7OF0",19,0)
 I LRHDR="BTS" D  Q  ;Clean-up to end batch
"RTN","LR7OF0",20,0)
 . D LC
"RTN","LR7OF0",21,0)
 . K ^TMP("OR",$J,"LRES")
"RTN","LR7OF0",22,0)
 S LINE=2,LRSX=0,LREND=0 F  S LINE=$O(MSG(LINE)) Q:LINE<1  S LRXMSG=MSG(LINE) D:$O(MSG(LINE,0)) SPLIT D  I LREND Q
"RTN","LR7OF0",23,0)
 . I $P(LRXMSG,"|")="PV1" S VISIT=$P(LRXMSG,"|",19),LOC=$P($P(LRXMSG,"|",4),"^"),ROOM=$P($P(LRXMSG,"|",4),"^",2),LOCP=LOC,LOCA=$S(LOCP:$P(^SC(LOCP,0),"^",2),1:"") Q
"RTN","LR7OF0",24,0)
 . I $P(LRXMSG,"|")="ORC" S NORC=0,LRXTYPE=$P(LRXMSG,"|",2),LRXORC=LRXMSG I LRXTYPE="NW" D NEW^LR7OF2 Q  ;New order, from OE/RR
"RTN","LR7OF0",25,0)
 . I $P(LRXMSG,"|")="ORC",LRXTYPE="CA" Q  ; D CANC^LR7OF2 S LREND=1 Q  ;Cancel order, from OE/RR
"RTN","LR7OF0",26,0)
 . I $P(LRXMSG,"|")="OBR" S NOBR=0 I LRXTYPE="CA" D CANC^LR7OF2 Q  ;Cancel tests identified in OBR segment
"RTN","LR7OF0",27,0)
 . I $P(LRXMSG,"|")="ORC",LRXTYPE="Z@" D PURG1^LR7OF4 S LREND=1 Q  ;Purge request-weird
"RTN","LR7OF0",28,0)
 . I $P(LRXMSG,"|")="OBR",LRXTYPE="Z@" D PURG^LR7OF4 S LREND=1 Q  ;Purge request
"RTN","LR7OF0",29,0)
 . I $P(LRXMSG,"|")="ORC",LRXTYPE="XO" D XO^LR7OF2 Q  ;Change order
"RTN","LR7OF0",30,0)
 . I $P(LRXMSG,"|")="ORC",LRXTYPE="NA" D NUM^LR7OF2 Q  ;Backdoor new order, request order number
"RTN","LR7OF0",31,0)
 . I $P(LRXMSG,"|")="ORC" S X="Unrecognized order control: "_LRXTYPE D ACK("DE",LRXORC,X) Q
"RTN","LR7OF0",32,0)
 . I $P(LRXMSG,"|")="OBR",LRXTYPE="NA" D NA^LR7OF2 Q  ;Backdoor assign ORIFN to test
"RTN","LR7OF0",33,0)
 . I $P(LRXMSG,"|")="OBR",LRXTYPE="NW" D OBR^LR7OF3 Q
"RTN","LR7OF0",34,0)
 . I $P(LRXMSG,"|")="OBR",LRXTYPE="XO" D OBR^LR7OF3 Q
"RTN","LR7OF0",35,0)
 . I $P(LRXMSG,"|")="DG1" D DG1^LRBEBA2(LRXMSG) Q    ; CIDC
"RTN","LR7OF0",36,0)
 . I $P(LRXMSG,"|")="ZCL" D ZCL^LRBEBA2(LRXMSG) Q    ; CIDC
"RTN","LR7OF0",37,0)
 . I $P(LRXMSG,"|")="NTE" D NTE^LR7OF2 Q  ;Order comments
"RTN","LR7OF0",38,0)
 . D ACK("DE",LRXORC,"Unrecognized Message segment: "_$P(LRXMSG,"|")) Q
"RTN","LR7OF0",39,0)
 I LREND S LREND=0 D END Q
"RTN","LR7OF0",40,0)
 I NORC D ACK("OC",LRXORC,"Incomplete transaction...no ORC segment in message!") D END Q
"RTN","LR7OF0",41,0)
 I NOBR D ACK("OC",LRXORC,"Incomplete transaction...no OBR segment in message") D END Q
"RTN","LR7OF0",42,0)
 I LRXTYPE="NW" D  ;Process new order request
"RTN","LR7OF0",43,0)
 . N REJECT
"RTN","LR7OF0",44,0)
 . S LROLLOC=LOCP,LRLLOC=$S($L($G(LOCA)):LOCA,1:"UNKNOWN"),LRPRAC=PROV,LROUTINE=$P(^LAB(69.9,1,3),"^",2)
"RTN","LR7OF0",45,0)
 . I $D(^TMP("OR",$J,"LROT")) S LRSDT=0 D
"RTN","LR7OF0",46,0)
 .. F  S LRSDT=$O(^TMP("OR",$J,"LROT",LRSDT)) Q:LRSDT<1  S LRXZ="" F LRI=0:0 S LRXZ=$O(^TMP("OR",$J,"LROT",LRSDT,LRXZ)) Q:LRXZ=""  S LRODT=$P(LRSDT,".") D
"RTN","LR7OF0",47,0)
 ... I $G(MSGTYPE)="LRAP" D EN^LR7OFA1 Q
"RTN","LR7OF0",48,0)
 ... D EN^LR7OF1
"RTN","LR7OF0",49,0)
 . D END,ACK("OK","ORC|OK|"_LRPLACR_"|"_LRORD_";"_LRODT_";"_LRSN_"^"_$S($G(MSG)="BBMSG":"LRBB",$G(MSG)="APMSG":"LRAP",1:"LRCH"),"")
"RTN","LR7OF0",50,0)
 Q
"RTN","LR7OF0",51,0)
HDRCHK(HDR) ;Check & return message Header (BHS,MSH,BTS)
"RTN","LR7OF0",52,0)
 I '$L(HDR) D ACK("DE",LRXORC,"No Message Header Defined") Q ""
"RTN","LR7OF0",53,0)
 I $P(HDR,"|")="BTS" Q "BTS"
"RTN","LR7OF0",54,0)
 I $P(HDR,"|")'="BHS",$P(HDR,"|")'="MSH" D ACK("DE",LRXORC,"Invalid Message Header: "_$P(HDR,"|")) Q ""
"RTN","LR7OF0",55,0)
 I $P(HDR,"|",2)'="^~\&" D ACK("DE",LRXORC,"Invalid Encoding Characters: "_$P(HDR,"|",2)) Q ""
"RTN","LR7OF0",56,0)
 I $P(HDR,"|",3)'="ORDER ENTRY" D ACK("DE",LRXORC,"Unrecognized message source: "_$P(HDR,"|",3)) Q ""
"RTN","LR7OF0",57,0)
 I $P(HDR,"|",4)'=DUZ(2) D ACK("DE",LRXORC,"DUZ(2) doesn't match institution in message: "_DUZ(2)_"'="_$P(HDR,"|",4)) Q ""
"RTN","LR7OF0",58,0)
 I $P(HDR,"|")="MSH",$P(HDR,"|",9)'="ORM"&($P(HDR,"|",9)'="ORR") D ACK("DE",LRXORC,"Unrecognized Message type: "_$P(HDR,"|",9)) Q ""
"RTN","LR7OF0",59,0)
 Q $P(HDR,"|")
"RTN","LR7OF0",60,0)
 ;
"RTN","LR7OF0",61,0)
PIDCHK(PID) ;Check PID & setup patient variables (DFN,LRDPF,LRDFN,LRPNM)
"RTN","LR7OF0",62,0)
 I '$L(PID) D ACK("DE",LRXORC,"No Patient ID in message") Q 0
"RTN","LR7OF0",63,0)
 I $P(PID,"|")'="PID" D ACK("DE",LRXORC,"Invalid (PID) message header: "_$P(X,"|")) Q 0
"RTN","LR7OF0",64,0)
 I '$L($P(PID,"|",6)) D ACK("DE",LRXORC,"No Patient Name") Q 0
"RTN","LR7OF0",65,0)
 S DFN=$S($P(PID,"|",4):$P(PID,"|",4),1:+$P(PID,"|",5)),LRDPF=$S($P(PID,"|",4):"2^DPT(",1:$P(@("^"_$P($P(PID,"|",5),";",2)_"0)"),"^",2)_"^"_$P($P(PID,"|",5),";",2)),LRPNM=$P(PID,"|",6),LRDFN=$$LRDFN^LR7OR1(+DFN,$P(LRDPF,"^",2))
"RTN","LR7OF0",66,0)
 I 'LRDFN D END^LRDPA I LRDFN<1 D ACK("DE",LRXORC,"Invalid LRDFN") Q 0
"RTN","LR7OF0",67,0)
 I '$D(@("^"_$P(LRDPF,"^",2)_+DFN_",0)")) D ACK("DE",LRXORC,"Patient identifier: "_LRDFN_" not found in "_LRDPF_" file") Q 0
"RTN","LR7OF0",68,0)
 Q 1
"RTN","LR7OF0",69,0)
 ;
"RTN","LR7OF0",70,0)
LC ;Print to LC Lab device
"RTN","LR7OF0",71,0)
 N LRSDT,LRXZ,CTR,LRODT,LRSN,LRPTR
"RTN","LR7OF0",72,0)
 S LRSDT=0
"RTN","LR7OF0",73,0)
 F  S LRSDT=$O(^TMP("OR",$J,"LRES",LRDFN,LRSDT)) Q:'LRSDT  S LRXZ="" F  S LRXZ=$O(^TMP("OR",$J,"LRES",LRDFN,LRSDT,LRXZ)) Q:LRXZ=""  D
"RTN","LR7OF0",74,0)
 . S CTR=0 F  S CTR=$O(^TMP("OR",$J,"LRES",LRDFN,LRSDT,LRXZ,CTR)) Q:'CTR  S X=^(CTR) D
"RTN","LR7OF0",75,0)
 .. S LRPTR(LRXZ,$P(X,"^",2),$P(X,"^",3))=""
"RTN","LR7OF0",76,0)
 S LRODT=0 F  S LRODT=$O(LRPTR("LC",LRODT)) Q:'LRODT  S LRSN=0 F  S LRSN=$O(LRPTR("LC",LRODT,LRSN)) Q:'LRSN  D
"RTN","LR7OF0",77,0)
 . S ION=$P($G(^LAB(69.9,1,3.5,+DUZ(2),0)),U,2) S:ION="" ION=$P(^LAB(69.9,1,3),U,4) I ION]"" D ^LROW2P
"RTN","LR7OF0",78,0)
 S LRODT=0 F  S LRODT=$O(LRPTR("I",LRODT)) Q:'LRODT  S LRSN=0 F  S LRSN=$O(LRPTR("I",LRODT,LRSN)) Q:'LRSN  D
"RTN","LR7OF0",79,0)
 . S ION=$P($G(^LAB(69.9,1,7,DUZ(2),0)),U,3) I ION]"" D ^LROW2P
"RTN","LR7OF0",80,0)
 Q
"RTN","LR7OF0",81,0)
ACK(TYPE,MSG3,COMMENT) ;Send back ok or nok to OE/RR
"RTN","LR7OF0",82,0)
 ;TYPE=Message control
"RTN","LR7OF0",83,0)
 ;COMMENT=Comment to be passed back
"RTN","LR7OF0",84,0)
 ;MSG3=contents of MSG(3) containing the ORC segment
"RTN","LR7OF0",85,0)
 N LRMSG,ARRAY,X8,VAR
"RTN","LR7OF0",86,0)
 I TYPE="DE" S VAR("XQY0")="" D EN^ORERR("BAD msg xchng OE/RR->LAB:"_$G(COMMENT),.MSG,.VAR) S:$P($G(MSG3),"|",2)="NW" TYPE="OC" ;Trap problem message and send back to OE/RR as an OC type
"RTN","LR7OF0",87,0)
 S LRMSG(1)=$$MSH^LR7OU0("ORR")
"RTN","LR7OF0",88,0)
 S LRMSG(2)=$G(MSG(2))
"RTN","LR7OF0",89,0)
 S LRMSG(3)=$G(MSG3),$P(LRMSG(3),"|",2)=TYPE
"RTN","LR7OF0",90,0)
 I $O(REJECT(0)),$O(^ORD(100.03,"C","LRDUP",0)) S X8=$$DC1^LROR6($O(^(0)),"Already ordered for this specimen, type and time"),$P(LRMSG(3),"|",2)="OC",$P(LRMSG(3),"|",4)="",$P(LRMSG(3),"|",17)=X8
"RTN","LR7OF0",91,0)
 I $D(COMMENT) N MSG S MSG="LRMSG",ARRAY(1)=COMMENT D NTE^LR7OU01(1,"L","ARRAY(",4)
"RTN","LR7OF0",92,0)
 S LRMSG="LRMSG"
"RTN","LR7OF0",93,0)
 D MSG^XQOR("LR7O CH EVSEND OR",.LRMSG) ;Lab accepts, returns Order #
"RTN","LR7OF0",94,0)
 Q
"RTN","LR7OF0",95,0)
SPLIT ;Build array for long segment
"RTN","LR7OF0",96,0)
 N I
"RTN","LR7OF0",97,0)
 S I=0 F  S I=$O(MSG(LINE,I)) Q:I<1  S LRXMSG(I)=MSG(LINE,I)
"RTN","LR7OF0",98,0)
 Q
"RTN","LR7OF0",99,0)
END ;Clean-up and get out
"RTN","LR7OF0",100,0)
 K ^TMP("OR",$J,"LROT"),^("COM")
"RTN","LR7OF0",101,0)
 Q
"RTN","LR7OF1")
0^39^B24442487^B24069320
"RTN","LR7OF1",1,0)
LR7OF1 ;slc/dcm/JAH - Setup new order from OE/RR ;8/10/04
"RTN","LR7OF1",2,0)
 ;;5.2;LAB SERVICE;**121,187,223,256,299,291**;Sep 27, 1994
"RTN","LR7OF1",3,0)
 ;
"RTN","LR7OF1",4,0)
EN ;Setup NEW orders from OE/RR messages
"RTN","LR7OF1",5,0)
 ;[^TMP("OR",$J,"LRES") DOCUMENTATION]
"RTN","LR7OF1",6,0)
 ; 'Combining of Orders' functionality depends on this TMP global
"RTN","LR7OF1",7,0)
 ; Set and Killed when BHS and BTS batch message headers are received
"RTN","LR7OF1",8,0)
 ; Global contains a list of lab orders for a session
"RTN","LR7OF1",9,0)
 ; Lab adds elements to the global array as orders are processed:
"RTN","LR7OF1",10,0)
 ;  ^TMP("OR",$J,"LRES",LRDFN,LRSDT,LRXZ,^TMP("OR",$J,"LRES","CTR"))=LRORD_"^"_LRODT_"^"_LRSN
"RTN","LR7OF1",11,0)
 ;  ^TMP("OR",$J,"LRES","CTR")=Count
"RTN","LR7OF1",12,0)
 N ZTSK,LRORDR,X,UNEEK,LRNT ;UNEEK forces a unique entry (Micro tests), set when ^..."LROT" built
"RTN","LR7OF1",13,0)
 D DT
"RTN","LR7OF1",14,0)
 S LRORDR=LRXZ
"RTN","LR7OF1",15,0)
 S:'$D(^TMP("OR",$J,"LRES","CTR")) ^("CTR")=0
"RTN","LR7OF1",16,0)
 F LRSAMP=-1:0 S LRSAMP=$O(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP)) Q:LRSAMP=""  D
"RTN","LR7OF1",17,0)
 . F LRSPEC=-1:0 S LRSPEC=$O(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC)) Q:LRSPEC=""  S X=^(LRSPEC,0) D
"RTN","LR7OF1",18,0)
 .. S ORIFN=+X,UNEEK=$P(X,"^",2)
"RTN","LR7OF1",19,0)
 .. D ZX
"RTN","LR7OF1",20,0)
 Q
"RTN","LR7OF1",21,0)
ZX ;
"RTN","LR7OF1",22,0)
 N COMBINE,X,NEWORD
"RTN","LR7OF1",23,0)
 I '$D(^LRO(69,LRODT,0)) D
"RTN","LR7OF1",24,0)
 . S ^(0)=$P(^LRO(69,0),U,1,2)_"^"_LRODT_"^"_(1+$P(^(0),U,4)),^LRO(69,LRODT,0)=LRODT,^LRO(69,"B",LRODT,LRODT)=""
"RTN","LR7OF1",25,0)
 S COMBINE=""
"RTN","LR7OF1",26,0)
 I 'UNEEK D
"RTN","LR7OF1",27,0)
 . S COMBINE=$$ORES^LR7OF5(LRDFN,LRSDT,LRXZ,+LRSAMP,LRPRAC,LROLLOC,LRSPEC,LRDUZ)
"RTN","LR7OF1",28,0)
 . I '$L(COMBINE) S COMBINE=$$FIND^LR7OF5(LRDFN,LRODT,LRSDT,LRXZ,+LRSAMP,LRPRAC,LROLLOC,LRSPEC,LRDUZ)
"RTN","LR7OF1",29,0)
 I '$L(COMBINE) S (NEWORD,ZTQUEUED)=1 L +^LRO(69,$E(DT,1,3)_"0000",2) D ORDER^LROW2 K ZTSK,ZTQUEUED,ZTREQ G LOCK
"RTN","LR7OF1",30,0)
 I $E(COMBINE,1,2)="S." S LRSN=$P(COMBINE,".",2),LRORD=$P(COMBINE,".",3) G ADD ;Combine on specimen
"RTN","LR7OF1",31,0)
 I $E(COMBINE,1,2)="O."!($E(COMBINE,1,2)="C.") S LRORD=$S($E(COMBINE,1,2)="O.":$P(COMBINE,".",2),1:$P(COMBINE,".",3)) ;Combine on order #
"RTN","LR7OF1",32,0)
LOCK ;
"RTN","LR7OF1",33,0)
 L +^LRO(69,LRODT,1):360
"RTN","LR7OF1",34,0)
 I '$T G LOCK
"RTN","LR7OF1",35,0)
 S LRSN=1+$O(^LRO(69,LRODT,1,999999999),-1),LRSUM=1+$S($D(^LRO(69,LRODT,1,0)):$P(^(0),U,4),1:0)
"RTN","LR7OF1",36,0)
ZSN ;
"RTN","LR7OF1",37,0)
 I $D(^LRO(69,LRODT,1,LRSN,0)) S LRSN=LRSN+1 G ZSN
"RTN","LR7OF1",38,0)
 S ^LRO(69,LRODT,1,LRSN,0)=LRDFN_"^"_LRDUZ_"^"_+LRSAMP_"^"_LRORDR_"^"_LRNT_"^"_LRPRAC_"^"_LRLLOC_"^"_LRSDT_"^"_LROLLOC_"^^"_ORIFN,^LRO(69,LRODT,1,0)="^69.01PA^"_LRSN_"^"_LRSUM
"RTN","LR7OF1",39,0)
 L -^LRO(69,LRODT,1)
"RTN","LR7OF1",40,0)
 S ^LRO(69,LRODT,1,"AA",LRDFN,LRSN)="",^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC,"SN")=LRSN,^LRO(69,"D",LRDFN,LRODT,LRSN)=""
"RTN","LR7OF1",41,0)
 I $L(LRLLOC) S ^LRO(69,LRODT,1,"AC",LRLLOC,LRSN)=""
"RTN","LR7OF1",42,0)
 I $L(LRSPEC) S ^LRO(69,LRODT,1,LRSN,4,0)="^69.02PA^1^1",^(1,0)=LRSPEC
"RTN","LR7OF1",43,0)
 S ^LRO(69,LRODT,1,LRSN,.1)=LRORD,^LRO(69,"C",+LRORD,LRODT,LRSN)=""
"RTN","LR7OF1",44,0)
 I $G(NEWORD) L -^LRO(69,$E(DT,1,3)_"0000",2)
"RTN","LR7OF1",45,0)
ADD ;
"RTN","LR7OF1",46,0)
 N I,J,LRJ,LRSXN,LRORIFN,NODE,STATUS
"RTN","LR7OF1",47,0)
 S ^TMP("OR",$J,"LRES","CTR")=^TMP("OR",$J,"LRES","CTR")+1,^TMP("OR",$J,"LRES",LRDFN,LRSDT,LRXZ,^TMP("OR",$J,"LRES","CTR"))=LRORD_"^"_LRODT_"^"_LRSN
"RTN","LR7OF1",48,0)
 S LRORIFN=+$G(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC,0))
"RTN","LR7OF1",49,0)
 S J=0
"RTN","LR7OF1",50,0)
 F LRJ=1:1 S J=$O(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC,J)) Q:J<1  S NODE=^(J),STATUS=$G(^(J,1)) D ZSN1(NODE,STATUS)
"RTN","LR7OF1",51,0)
 S (LRSXN,I)=0
"RTN","LR7OF1",52,0)
 F  S I=$O(^LRO(69,LRODT,1,LRSN,2,I)) Q:I<1  S LRSXN=LRSXN+1
"RTN","LR7OF1",53,0)
 S:LRSXN ^LRO(69,LRODT,1,LRSN,2,0)="^69.03PA^"_LRSXN_"^"_LRSXN
"RTN","LR7OF1",54,0)
 I $E(COMBINE,1,2)="C." D
"RTN","LR7OF1",55,0)
 . S (LRSXN,I)=0 F  S I=$O(^LRO(69,LRODT,1,+$P(COMBINE,".",2),2,I)) Q:I<1  S LRSXN=LRSXN+1
"RTN","LR7OF1",56,0)
 . S:LRSXN ^LRO(69,LRODT,1,+$P(COMBINE,".",2),2,0)="^69.03PA^"_LRSXN_"^"_LRSXN
"RTN","LR7OF1",57,0)
 Q
"RTN","LR7OF1",58,0)
ZSN1(NODE,STATUS)    ;Add tests
"RTN","LR7OF1",59,0)
 N CNT,XI,X,I,C,TCNT
"RTN","LR7OF1",60,0)
 S CNT=+$O(^LRO(69,LRODT,1,LRSN,2,99999),-1)
"RTN","LR7OF1",61,0)
 S LRTSTS=+NODE,LRQUANT=$P(NODE,"^",2)
"RTN","LR7OF1",62,0)
 I $D(^LRO(69,LRODT,1,LRSN,2,"B",LRTSTS)) S REJECT(LRTSTS)="" Q
"RTN","LR7OF1",63,0)
 S ^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,0)=LRTSTS_"^"_$S($L(STATUS):STATUS,1:LROUTINE)_"^^^^^"_LRORIFN
"RTN","LR7OF1",64,0)
 D SDGX69^LRBEBA2(J,(CNT+LRJ)_","_LRSN_","_LRODT_",")
"RTN","LR7OF1",65,0)
 I $O(^TMP("OR",$J,"COM",LRSDT,LRXZ,LRSAMP,LRSPEC,J,0)) D
"RTN","LR7OF1",66,0)
 . S X=^TMP("OR",$J,"COM",LRSDT,LRXZ,LRSAMP,LRSPEC,J)+$S($P($G(^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,1,0)),"^",4):$P(^(0),"^",4),1:0),^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,1,0)="^^"_X_"^"_X_"^"_DT
"RTN","LR7OF1",67,0)
 . S TCNT=+$O(^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,1,99999),-1),(C,I)=0
"RTN","LR7OF1",68,0)
 . F  S I=$O(^TMP("OR",$J,"COM",LRSDT,LRXZ,LRSAMP,LRSPEC,J,I)) Q:I<1  S C=C+1,^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,1,C+TCNT,0)=^TMP("OR",$J,"COM",LRSDT,LRXZ,LRSAMP,LRSPEC,J,I)
"RTN","LR7OF1",69,0)
 S ^LRO(69,LRODT,1,LRSN,2,"B",LRTSTS,CNT+LRJ)=""
"RTN","LR7OF1",70,0)
 S ^LRO(69,"AT",LRDFN,LRTSTS,LRSPEC,LRODT)="",^(-LRODT)=""
"RTN","LR7OF1",71,0)
 I $E(COMBINE,1,2)="C." S X=^LRO(69,LRODT,1,LRSN,2,CNT+LRJ,0),$P(^(0),"^",6)=LRORD,XI=$P($G(^LRO(69,LRODT,1,LRSN,1)),"^",7),XI=XI_LRORD_"/",$P(^(1),"^",7)=XI D
"RTN","LR7OF1",72,0)
 . N CNT1
"RTN","LR7OF1",73,0)
 . S CNT1=$O(^LRO(69,LRODT,1,+$P(COMBINE,".",2),2,99999),-1)+1,^(CNT1,0)=X,$P(^(0),"^",14)=LRODT_";"_LRSN_";"_(CNT+LRJ),^LRO(69,LRODT,1,$P(COMBINE,".",2),2,"B",LRTSTS,CNT1)=""
"RTN","LR7OF1",74,0)
 Q
"RTN","LR7OF1",75,0)
DT ;
"RTN","LR7OF1",76,0)
 S DT=$$DT^XLFDT()
"RTN","LR7OF1",77,0)
 S LRNT=$P($H,",",2),LRNT=LRNT\3600*100+(LRNT\60#60)/10000+DT
"RTN","LR7OF1",78,0)
 Q
"RTN","LRBEBA")
0^9^B62512443
"RTN","LRBEBA",1,0)
LRBEBA ;DALOI/JAH/FHS - SCI, EI, AND LRBEDGX QUESTIONS ;8/10/04
"RTN","LRBEBA",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRBEBA",3,0)
 ;
"RTN","LRBEBA",4,0)
 ; This routine contains the questions to be asked for 
"RTN","LRBEBA",5,0)
 ; Service Connected Indicator, Environmental Indicator,
"RTN","LRBEBA",6,0)
 ; and Diagnosis.
"RTN","LRBEBA",7,0)
 ;
"RTN","LRBEBA",8,0)
 ; Reference to EN^DDIOL supported by IA #10142
"RTN","LRBEBA",9,0)
 ; Reference to ^DIC supported by IA #10006
"RTN","LRBEBA",10,0)
 ; Reference to $$GET1^DIQ supported by IA #2056
"RTN","LRBEBA",11,0)
 ; Reference to ^DIR supported by IA #10026
"RTN","LRBEBA",12,0)
 ; Reference to ^ICD9 supported by IA #10082
"RTN","LRBEBA",13,0)
 ; Reference to ^DIC(9.4 supported by IA #10048
"RTN","LRBEBA",14,0)
 ;
"RTN","LRBEBA",15,0)
QUES(LRBEDFN,LRBESMP,LRBESPC,TST,DT,LRBEAR,LRBEDP) ; Start asking questions
"RTN","LRBEBA",16,0)
 N DIC,DIR,DTOUT,DUOUT,DIRUT,LRBEFMSG,LRBEST,LRBEQT,X,Y
"RTN","LRBEBA",17,0)
 S:$G(LRBEALO)="" LRBEALO=0 S (LRBEST,LRBEQT)=0
"RTN","LRBEBA",18,0)
 F  D  Q:LRBEQT
"RTN","LRBEBA",19,0)
 .;ensure it's active on the date of encounter
"RTN","LRBEBA",20,0)
 .;S DIC("S")="I $$STATCHK^ICDAPIU(Y,DT)" 
"RTN","LRBEBA",21,0)
 .S LRBEFMSG=" ICD-9 CODE: "
"RTN","LRBEBA",22,0)
 .S DIC("A")="Select "_$S(LRBEALO=0:"Primary",1:"Secondary")_LRBEFMSG
"RTN","LRBEBA",23,0)
 .S DIC="^ICD9(",DIC(0)="AMEQZ" D ^DIC
"RTN","LRBEBA",24,0)
 .I $D(DTOUT)!($D(DUOUT)) S (LRBEST,LRBEQT)=1 K DIC,LRBEAR Q:LRBEQT
"RTN","LRBEBA",25,0)
 .I +Y<1 K DIC S LRBEQT=1 Q:LRBEQT
"RTN","LRBEBA",26,0)
 .S LRBEDGX=+Y
"RTN","LRBEBA",27,0)
 .S LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,TST,LRBEDGX)=$P(Y(0),U,1,3)
"RTN","LRBEBA",28,0)
 .S:'LRBEALO $P(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,TST,LRBEDGX),U,11)=1
"RTN","LRBEBA",29,0)
 .S LRBEALO=1 D SCI(LRBEDFN,DT,.LRBEQT) Q:LRBEQT
"RTN","LRBEBA",30,0)
 K LRBEALO
"RTN","LRBEBA",31,0)
 Q LRBEST
"RTN","LRBEBA",32,0)
 ;
"RTN","LRBEBA",33,0)
SCI(LRBEDFN,LRBECDT,LRBEQT) ; Ask the Indicator Questions
"RTN","LRBEBA",34,0)
 N DIR,DTOUT,DUOUT,DIRUT,I,LRBEA,LRBEB,LRBEBL,LRBESEG,LRBECLY,Y
"RTN","LRBEBA",35,0)
 I $D(LRBEDP(LRBEDGX)) D  Q
"RTN","LRBEBA",36,0)
 .S LRBEBL=$L($G(LRBEDP(LRBEDGX)),U)
"RTN","LRBEBA",37,0)
 .S LRBEB=$P(LRBEDP(LRBEDGX),U,4,LRBEBL)
"RTN","LRBEBA",38,0)
 .S $P(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,TST,LRBEDGX),U,4,LRBEBL)=LRBEB
"RTN","LRBEBA",39,0)
 D CL^SDCO21(LRBEDFN,LRBECDT_".2359","",.LRBECLY)
"RTN","LRBEBA",40,0)
 S LRBESEG="3,7,1,2,4,5,6"
"RTN","LRBEBA",41,0)
 F I=1:1:$L(LRBESEG,",") S LRBEA=+$P(LRBESEG,",",I) D  Q:LRBEQT
"RTN","LRBEBA",42,0)
 .I $D(LRBECLY(LRBEA)) D  Q:LRBEQT
"RTN","LRBEBA",43,0)
 ..S DIR("A")="  "_$$GETI(LRBEA)
"RTN","LRBEBA",44,0)
 ..S DIR(0)="YO" D ^DIR
"RTN","LRBEBA",45,0)
 ..I $D(DTOUT)!($D(DUOUT)) S (LRBEST,LRBEQT)=1 K DIC,LRBEAR Q:LRBEQT
"RTN","LRBEBA",46,0)
 ..I +Y=-1 S LRBEQT=1 Q:LRBEQT
"RTN","LRBEBA",47,0)
 ..S $P(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,TST,LRBEDGX),U,LRBEA+3)=Y
"RTN","LRBEBA",48,0)
 ..S $P(LRBEDP(LRBEDGX),U,LRBEA+3)=Y
"RTN","LRBEBA",49,0)
 Q
"RTN","LRBEBA",50,0)
 ;
"RTN","LRBEBA",51,0)
GETI(LRBEA) ; Get type of Indicator
"RTN","LRBEBA",52,0)
 N LRBEX,LRBEQUES,LRBEQUS1
"RTN","LRBEBA",53,0)
 S LRBEQUES="Was treatment related to ",LRBEQUS1="Was treatment for a "
"RTN","LRBEBA",54,0)
 S:LRBEA=1 LRBEX=LRBEQUES_"Agent Orange exposure"
"RTN","LRBEBA",55,0)
 S:LRBEA=2 LRBEX=LRBEQUES_"Ionizing Radiation exposure"
"RTN","LRBEBA",56,0)
 S:LRBEA=3 LRBEX=LRBEQUS1_"Service Connected condition"
"RTN","LRBEBA",57,0)
 S:LRBEA=4 LRBEX=LRBEQUES_"Environmental Contaminant exposure"
"RTN","LRBEBA",58,0)
 S:LRBEA=5 LRBEX=LRBEQUES_"Military Sexual Trauma"
"RTN","LRBEBA",59,0)
 S:LRBEA=6 LRBEX=LRBEQUES_"Head and Neck Cancer"
"RTN","LRBEBA",60,0)
 S:LRBEA=7 LRBEX=LRBEQUES_"Combat Vet"
"RTN","LRBEBA",61,0)
 Q LRBEX
"RTN","LRBEBA",62,0)
 ;
"RTN","LRBEBA",63,0)
ERRMSG(MT) ; Display Error Message
"RTN","LRBEBA",64,0)
 N LRBEAST,LRBEFMT,LRBELIN,LRBEMS
"RTN","LRBEBA",65,0)
 S:MT=-1 LRBEMS="An error occurred. Data may or may not have been processed."
"RTN","LRBEBA",66,0)
 S:MT<-1 LRBEMS="No data was processed."
"RTN","LRBEBA",67,0)
 S LRBEMS="* "_LRBEMS_" *",LRBEAST="",$P(LRBEAST,"*",80)="",LRBEFMT="!?"_((80-$L(LRBEMS))/2)
"RTN","LRBEBA",68,0)
 S LRBELIN=$E(LRBEAST,1,$L(LRBEMS)+1)
"RTN","LRBEBA",69,0)
 D EN^DDIOL(LRBELIN,"",LRBEFMT),EN^DDIOL(LRBEMS,"",LRBEFMT),EN^DDIOL(LRBELIN,"",LRBEFMT)
"RTN","LRBEBA",70,0)
 Q
"RTN","LRBEBA",71,0)
 ;
"RTN","LRBEBA",72,0)
SDG1(LRODT,LRSN,LRTN,LRSAMP,LRSPEC,LRTSTS,LRBEAR) ; Set the diagnois 
"RTN","LRBEBA",73,0)
 ;                             and indicators file #69
"RTN","LRBEBA",74,0)
 N LRBEFIL,LRBEIEN,LRBEDFN,LRFDA,LRFDAIEN,LRERR,LRBEPDGX,LRBETNUM
"RTN","LRBEBA",75,0)
 N LRDA,LRBEP,DIK,DA
"RTN","LRBEBA",76,0)
 S DIK="^LRO(69,"_LRODT_",1,"_LRSN_",2,"_LRTN_",2,"
"RTN","LRBEBA",77,0)
 S LRDA=0 F  S LRDA=$O(^LRO(69,LRODT,1,LRSN,2,LRTN,2,LRDA)) Q:LRDA<1  D
"RTN","LRBEBA",78,0)
 . S DA=LRDA D ^DIK
"RTN","LRBEBA",79,0)
 K DA,DIK
"RTN","LRBEBA",80,0)
 S LRBEP=0
"RTN","LRBEBA",81,0)
 I '$D(DFN) S LRBEDFN=$$GET1^DIQ(63,LRDFN,.03,"I")
"RTN","LRBEBA",82,0)
 S:$D(DFN) LRBEDFN=DFN
"RTN","LRBEBA",83,0)
 S LRBEFIL=69.05,LRBETNUM=$O(^LRO(69,LRODT,1,LRSN,2,LRTN,2,""),-1)+1,LRBEPDGX=""
"RTN","LRBEBA",84,0)
 F  S LRBEPDGX=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRSAMP,LRSPEC,LRTSTS,LRBEPDGX)) Q:LRBEPDGX=""  D
"RTN","LRBEBA",85,0)
 .S LRBEPTDT=$G(LRBEAR(LRBEDFN,"LRBEDGX",LRSAMP,LRSPEC,LRTSTS,LRBEPDGX))
"RTN","LRBEBA",86,0)
 .I 'LRBEP,'$P(LRBEPTDT,U,11) Q
"RTN","LRBEBA",87,0)
 .S LRBEP=1
"RTN","LRBEBA",88,0)
 .S LRBEIEN="+"_LRBETNUM_","_LRTN_","_LRSN_","_LRODT_","
"RTN","LRBEBA",89,0)
 .S LRFDAIEN(LRBETNUM)=LRBETNUM
"RTN","LRBEBA",90,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN,.01)=LRBEPDGX
"RTN","LRBEBA",91,0)
 .S:$P(LRBEPTDT,U,6)'="" LRFDA(99,LRBEFIL,LRBEIEN,1)=$P(LRBEPTDT,U,6)
"RTN","LRBEBA",92,0)
 .S:$P(LRBEPTDT,U,10)'="" LRFDA(99,LRBEFIL,LRBEIEN,2)=$P(LRBEPTDT,U,10)
"RTN","LRBEBA",93,0)
 .S:$P(LRBEPTDT,U,4)'="" LRFDA(99,LRBEFIL,LRBEIEN,3)=$P(LRBEPTDT,U,4)
"RTN","LRBEBA",94,0)
 .S:$P(LRBEPTDT,U,5)'="" LRFDA(99,LRBEFIL,LRBEIEN,4)=$P(LRBEPTDT,U,5)
"RTN","LRBEBA",95,0)
 .S:$P(LRBEPTDT,U,7)'="" LRFDA(99,LRBEFIL,LRBEIEN,5)=$P(LRBEPTDT,U,7)
"RTN","LRBEBA",96,0)
 .S:$P(LRBEPTDT,U,8)'="" LRFDA(99,LRBEFIL,LRBEIEN,6)=$P(LRBEPTDT,U,8)
"RTN","LRBEBA",97,0)
 .S:$P(LRBEPTDT,U,9)'="" LRFDA(99,LRBEFIL,LRBEIEN,7)=$P(LRBEPTDT,U,9)
"RTN","LRBEBA",98,0)
 .S:$P(LRBEPTDT,U,11)=1 LRFDA(99,LRBEFIL,LRBEIEN,8)=1         ;Is Primary?
"RTN","LRBEBA",99,0)
 .S LRBETNUM=LRBETNUM+1
"RTN","LRBEBA",100,0)
 .I $P(LRBEPTDT,U,11) K LRBEAR(LRBEDFN,"LRBEDGX",LRSAMP,LRSPEC,LRTSTS,LRBEPDGX) S LRBEPDGX=""
"RTN","LRBEBA",101,0)
 D UPDATE^DIE("","LRFDA(99)","LRFDAIEN","LRERR")
"RTN","LRBEBA",102,0)
 Q
"RTN","LRBEBA",103,0)
 ;
"RTN","LRBEBA",104,0)
SDOS(LRODT,LRSN,LRTN,LRBECDT) ; Set DOS for CIDC
"RTN","LRBEBA",105,0)
 N LRBEIEN,LRFDA,LRERR
"RTN","LRBEBA",106,0)
 S LRBEIEN=LRTN_","_LRSN_","_LRODT_",",LRFDA(99,69.03,LRBEIEN,22)=LRBECDT
"RTN","LRBEBA",107,0)
 D UPDATE^DIE("","LRFDA(99)","","LRERR")
"RTN","LRBEBA",108,0)
 Q
"RTN","LRBEBA",109,0)
 ;
"RTN","LRBEBA",110,0)
CCPT(LRBECPT,LRBECDT,LRBEAR) ; Check the status of the CPT (CSV)
"RTN","LRBEBA",111,0)
 ;
"RTN","LRBEBA",112,0)
 ; Input:
"RTN","LRBEBA",113,0)
 ;  LRBECPT  -  CPT
"RTN","LRBEBA",114,0)
 ;  LRBECDT   -  Date To Be Checked ; Collection date/time
"RTN","LRBEBA",115,0)
 ;  LRBEAR   -  An array passed by reference to hold IEN and Status
"RTN","LRBEBA",116,0)
 ;
"RTN","LRBEBA",117,0)
 ; Output:
"RTN","LRBEBA",118,0)
 ;  ST       -  Status of CPT (Active (1),Inactive (0), or Invalid (-1))
"RTN","LRBEBA",119,0)
 ;  LRBEAR   -  An array passed by reference to hold IEN and Status
"RTN","LRBEBA",120,0)
 ;   LRBEAR(CPT)=IEN^NAME^EFFECTIVE DAT^STATUS 
"RTN","LRBEBA",121,0)
 ;
"RTN","LRBEBA",122,0)
 N LRBEST,LRBEPTDT
"RTN","LRBEBA",123,0)
 S LRBEST=""
"RTN","LRBEBA",124,0)
 S LRBEPTDT=$$CPT^ICPTCOD(LRBECPT,LRBECDT)
"RTN","LRBEBA",125,0)
 S LRBEST=$P(LRBEPTDT,U,7) I 'LRBEST S LRBEST=-1 Q LRBEST
"RTN","LRBEBA",126,0)
 S LRBEAR(LRBECPT)=$P(LRBEPTDT,U,1)_U_$P(LRBEPTDT,U,3)_U_$P(LRBEPTDT,U,6)_U_LRBEST
"RTN","LRBEBA",127,0)
 Q LRBEST
"RTN","LRBEBA",128,0)
 ;
"RTN","LRBEBA",129,0)
EMSGCPT(LRBEAR) ; Print out Inactive CPTs
"RTN","LRBEBA",130,0)
 N CNAM,LRBEASK,LRBEFMT,LRBELIN,LRBECPT,LRBEMS,LRBEMS2,LRBEMS3,LRBEMSG,LRBESP
"RTN","LRBEBA",131,0)
 S LRBEMSG="Please contact HISYS to correct the Inactive CPTs: "
"RTN","LRBEBA",132,0)
 S LRBEMS="*  "_LRBEMSG_"  *",LRBEAST="",$P(LRBEAST,"*",80)="",LRBEFMT="!?"_((80-$L(LRBEMS))/2)
"RTN","LRBEBA",133,0)
 S LRBESP="",$P(LRBESP," ",80)="",LRBELIN=$E(LRBEAST,1,$L(LRBEMS))
"RTN","LRBEBA",134,0)
 S LRBEMS2="*  "_$E(LRBESP,1,$L(LRBEMSG))_"  *"
"RTN","LRBEBA",135,0)
 D EN^DDIOL(LRBELIN,"","!"_LRBEFMT),EN^DDIOL(LRBEMS,"",LRBEFMT),EN^DDIOL(LRBEMS2,"",LRBEFMT)
"RTN","LRBEBA",136,0)
 S LRBECPT="" F  S LRBECPT=$O(LRBEAR(LRBECPT)) Q:LRBECPT=""  D
"RTN","LRBEBA",137,0)
 .Q:$P(LRBEAR(LRBECPT),U,4)'=0
"RTN","LRBEBA",138,0)
 .S CNAM=$P(LRBEAR(LRBECPT),U,2)
"RTN","LRBEBA",139,0)
 .S LRBEMS3="*     "_LRBECPT_$E(LRBESP,1,15-$L(LRBECPT))_$E(CNAM,1,30)
"RTN","LRBEBA",140,0)
 .S LRBEMS3=LRBEMS3_$E(LRBESP,1,($L(LRBEMS)-$L(LRBEMS3))-1)_"*"
"RTN","LRBEBA",141,0)
 .D EN^DDIOL(LRBEMS3,"",LRBEFMT)
"RTN","LRBEBA",142,0)
 D EN^DDIOL(LRBEMS2,"",LRBEFMT),EN^DDIOL(LRBELIN,"",LRBEFMT)
"RTN","LRBEBA",143,0)
 Q
"RTN","LRBEBA",144,0)
 ;
"RTN","LRBEBA",145,0)
BAWRK(LRODT,LRSN,LRI,LRBEY,LRTEST,LRBEDEL,LRBEVST,LRBEROLL,ORIEN) ; Send the Billing Information to PCE
"RTN","LRBEBA",146,0)
 ;input LRBEROLL = 1, if processing from routine LRBEBA5 for roll-up to PCE
"RTN","LRBEBA",147,0)
 ;input ORIEN = OERR Order #; only passed from WORK^LRBEBA4
"RTN","LRBEBA",148,0)
 Q:$G(LRCHG)=1
"RTN","LRBEBA",149,0)
 K ^TMP("LRPXAPI",$J),LRBEAR,LRBEAR1,LRBECPT
"RTN","LRBEBA",150,0)
 N D0,DA,DIC,DIE,DIR,I,T,X1,X2,X3,X9,Z,Z1,Z2,CNT,VADM,VAIN
"RTN","LRBEBA",151,0)
 N LRBETEST,LRTN,LRBESB,LRBETST,LRBEPAN,LRBEMSG,LRDBEDGX,LRBESEQ,LRNOP,LRX
"RTN","LRBEBA",152,0)
 N PXBREQ,LRVN,PXKDONE
"RTN","LRBEBA",153,0)
 I '$G(LRPKG) D
"RTN","LRBEBA",154,0)
 . S LRPKG=$$FIND1^DIC(9.4,,"B","LAB SERVICE","B","","ERR")
"RTN","LRBEBA",155,0)
 I LRPKG<1 D  Q
"RTN","LRBEBA",156,0)
 . D EN^DDIOL("PCE Error Condition -  Lab Service package not installed","","!")
"RTN","LRBEBA",157,0)
 N LRBEAR,LRBEDFN,LRBECDT,LRBEU,LRBEX,LRBEZ,LRBETYP,LRBECDT
"RTN","LRBEBA",158,0)
 N LRBENO,LRBEMOD,LROOS,LRPCECNT,LRI,X,Y,USR
"RTN","LRBEBA",159,0)
 M LRBETEST=LRTEST
"RTN","LRBEBA",160,0)
 M LRBESB=LRSB
"RTN","LRBEBA",161,0)
 S LROOS=$$GET1^DIQ(68,LRAA,.8,"I") I 'LROOS S LROOS=$$GET1^DIQ(69.9,1,.8,"I")
"RTN","LRBEBA",162,0)
 S LRBEMOD=$$GMOD^LRBEBA2(LRAA)
"RTN","LRBEBA",163,0)
 S LRBEDEL=$G(LRBEDEL)
"RTN","LRBEBA",164,0)
 I $G(LRDFN) S:'$G(DFN) DFN=$$GET1^DIQ(63,LRDFN_",",.03,"I")
"RTN","LRBEBA",165,0)
 S LRBEDFN=DFN
"RTN","LRBEBA",166,0)
 S:'$G(LRBEVST) LRBEVST=$P($G(^LRO(69,LRODT,1,LRSN,"PCE")),";")
"RTN","LRBEBA",167,0)
 S (LRBECDT,LRBEDT)=$J($$GET1^DIQ(69.01,LRSN_","_LRODT_",",10,"I"),7,4)
"RTN","LRBEBA",168,0)
 S I=0 F  S I=$O(LRBETEST(I)) Q:I<1  D
"RTN","LRBEBA",169,0)
 . S LRBETST=$P(LRBETEST(I),U,1)
"RTN","LRBEBA",170,0)
 . S LRTN=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETST,0))
"RTN","LRBEBA",171,0)
 . I LRTN D SDOS(LRODT,LRSN,LRTN,LRBECDT)
"RTN","LRBEBA",172,0)
 G:$G(LRBENO) KILL
"RTN","LRBEBA",173,0)
 D BLDAR^LRBEBA3(LRBEDFN,LRODT,LRSN,.LRBEAR,.LRBEY,.LRBETEST,.LRBEPAN,LRBEDEL) G:$G(LRBENO) KILL
"RTN","LRBEBA",174,0)
 D STDN^LRBEBA2(LRODT,LRSN,.LRBETEST,.LRBEY) G:$G(LRBENO) KILL
"RTN","LRBEBA",175,0)
 D SOP^LRBEBA2(LRBEDFN,.LRBESB,.LRBEY,.LRBEPAN,$G(LRBEROLL)) G:$G(LRBENO) KILL
"RTN","LRBEBA",176,0)
 I $D(LRBECPT)>1 D
"RTN","LRBEBA",177,0)
 .D OPORD^LRBEBAO Q:$G(LRBENO)
"RTN","LRBEBA",178,0)
 .D OPRES^LRBEBAO(.LRBEAR,.LRBEAR1,LRODT,LRSN,LRBEVST)
"RTN","LRBEBA",179,0)
KILL ;
"RTN","LRBEBA",180,0)
 K ^TMP("LRPXAPI",$J)
"RTN","LRBEBA",181,0)
 K LRPKG,LRBEDIA,LRBEVSIT,LRBEAR,LRBEAR1,LRBEDEL,LRBEDT,LRBEPOS
"RTN","LRBEBA",182,0)
 K LRBEIEN,LRBEMOD,LRBEPTDT,LRBETM,LRBEDN,LRBESMP,LRBESPC,LRBEDGX,LRBEVST,LROOS,LRBERES
"RTN","LRBEBA",183,0)
 K ERRDIS,INROOT,SRC,SUB1,SUB2,SUB3,USR
"RTN","LRBEBA",184,0)
 I '$G(LRBEROLL) K LRBECPT,LRBEY
"RTN","LRBEBA",185,0)
 Q
"RTN","LRBEBA",186,0)
 ;
"RTN","LRBEBA",187,0)
GEDT(LRODT,LRSN,LRBETST) ; Get the Date of Service
"RTN","LRBEBA",188,0)
 N X,Y,LRBEIEN,DIC,LRBEEDT
"RTN","LRBEBA",189,0)
 S LRBEEDT=""
"RTN","LRBEBA",190,0)
 S X=$$GET1^DIQ(60,LRBETST_",",.01)
"RTN","LRBEBA",191,0)
 S DIC="^LRO(69,"_LRODT_",1,"_LRSN_",2,"
"RTN","LRBEBA",192,0)
 S DIC(0)="Z" D ^DIC I +Y<0 K DIC Q 0
"RTN","LRBEBA",193,0)
 S LRBEIEN=+Y_","_LRSN_","_LRODT_","
"RTN","LRBEBA",194,0)
 S LRBEEDT=$$GET1^DIQ(69.03,LRBEIEN,22,"I")
"RTN","LRBEBA",195,0)
 Q LRBEEDT
"RTN","LRBEBA",196,0)
 ;
"RTN","LRBEBA",197,0)
GCDT(LRODT,LRSN) ; Get the collection date/time
"RTN","LRBEBA",198,0)
 N LRBECDT,LRBEIEN
"RTN","LRBEBA",199,0)
 S LRBECDT=""
"RTN","LRBEBA",200,0)
 S LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEBA",201,0)
 S LRBECDT=$$GET1^DIQ(69.01,LRBEIEN,10,"I")
"RTN","LRBEBA",202,0)
 Q LRBECDT
"RTN","LRBEBA2")
0^14^B81298476
"RTN","LRBEBA2",1,0)
LRBEBA2 ;DALOI/JAH/FHS - ORDERING AND RESULTING OUTPATIENT ;8/10/04
"RTN","LRBEBA2",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRBEBA2",3,0)
 ;
"RTN","LRBEBA2",4,0)
DG1(LRBESTG) ; Set the DG1 segment into the ^TMP
"RTN","LRBEBA2",5,0)
 N LRBEDGX,LRBETNUM
"RTN","LRBEBA2",6,0)
 S LRBETNUM=$O(^TMP("OR",$J,"LROT",STARTDT,TYPE,SAMP,SPEC,LRSX,"LRBEDGX",""),-1)
"RTN","LRBEBA2",7,0)
 S LRBETNUM=$G(LRBETNUM)+1
"RTN","LRBEBA2",8,0)
 S LRBEDGX=$P($P(LRBESTG,"|",4),"^",1)
"RTN","LRBEBA2",9,0)
 S ^TMP("OR",$J,"LROT",STARTDT,TYPE,SAMP,SPEC,LRSX,"LRBEDGX",LRBETNUM)=LRBEDGX
"RTN","LRBEBA2",10,0)
 Q
"RTN","LRBEBA2",11,0)
ZCL(LRBESTG) ; Set the ZCL segment into the ^TMP
"RTN","LRBEBA2",12,0)
 N LRBEX,LRBETNUM,LRBEIND
"RTN","LRBEBA2",13,0)
 S LRBETNUM=$O(^TMP("OR",$J,"LROT",STARTDT,TYPE,SAMP,SPEC,LRSX,"LRBEDGX",""),-1)
"RTN","LRBEBA2",14,0)
 S LRBEX=$P(LRBESTG,"|",3),LRBEIND=$P(LRBESTG,"|",4)
"RTN","LRBEBA2",15,0)
 S $P(^TMP("OR",$J,"LROT",STARTDT,TYPE,SAMP,SPEC,LRSX,"LRBEDGX",LRBETNUM),U,LRBEX+1)=LRBEIND
"RTN","LRBEBA2",16,0)
 Q
"RTN","LRBEBA2",17,0)
 ;
"RTN","LRBEBA2",18,0)
SDGX69(J,LRBEIEN) ; Set the diagnosis into #69
"RTN","LRBEBA2",19,0)
 N LRBEDGX,LRBEFIL,LRFDA,LRFDAIEN,LRBESEQ,LRBEPTDT,LRBEIEN2
"RTN","LRBEBA2",20,0)
 S LRBESEQ="",LRBEFIL=69.05
"RTN","LRBEBA2",21,0)
 F  S LRBESEQ=$O(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC,J,"LRBEDGX",LRBESEQ)) Q:LRBESEQ=""  D
"RTN","LRBEBA2",22,0)
 .S LRBEPTDT=$G(^TMP("OR",$J,"LROT",LRSDT,LRXZ,LRSAMP,LRSPEC,J,"LRBEDGX",LRBESEQ))
"RTN","LRBEBA2",23,0)
 .S LRBEIEN2=LRBESEQ_","_LRBEIEN
"RTN","LRBEBA2",24,0)
 .I '$D(^LRO(69,LRODT,1,LRSN,2,$P(LRBEIEN,",",1),2,"B",$P(LRBEPTDT,U,1))) S LRBEIEN2="+"_LRBEIEN2
"RTN","LRBEBA2",25,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,.01)=$P(LRBEPTDT,U,1),LRFDAIEN(LRBESEQ)=LRBESEQ
"RTN","LRBEBA2",26,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,1)=$P(LRBEPTDT,U,4)   ;SC
"RTN","LRBEBA2",27,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,2)=$P(LRBEPTDT,U,8)   ;CV
"RTN","LRBEBA2",28,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,3)=$P(LRBEPTDT,U,2)   ;AO
"RTN","LRBEBA2",29,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,4)=$P(LRBEPTDT,U,3)   ;IR
"RTN","LRBEBA2",30,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,5)=$P(LRBEPTDT,U,5)   ;EC
"RTN","LRBEBA2",31,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,6)=$P(LRBEPTDT,U,6)   ;MST
"RTN","LRBEBA2",32,0)
 .S LRFDA(99,LRBEFIL,LRBEIEN2,7)=$P(LRBEPTDT,U,7)   ;HNC
"RTN","LRBEBA2",33,0)
 .S:LRBESEQ=1 LRFDA(99,LRBEFIL,LRBEIEN2,8)=1         ;Is Primary?
"RTN","LRBEBA2",34,0)
 D UPDATE^DIE("","LRFDA(99)","LRFDAIEN","LRERR")
"RTN","LRBEBA2",35,0)
 Q
"RTN","LRBEBA2",36,0)
 ;
"RTN","LRBEBA2",37,0)
GDG1(LRODT,SN,IFN) ; diagnosis and indicators back to CPRS
"RTN","LRBEBA2",38,0)
 N LRBECNT,LRBEDGX,LRBESEQ,LRBEPTDT
"RTN","LRBEBA2",39,0)
 S LRBECNT=2
"RTN","LRBEBA2",40,0)
 S LRBESEQ=0 F  S LRBESEQ=$O(^LRO(69,LRODT,1,SN,2,IFN,2,LRBESEQ)) Q:LRBESEQ<1  D
"RTN","LRBEBA2",41,0)
 .S LRBEPTDT=$G(^LRO(69,LRODT,1,SN,2,IFN,2,LRBESEQ,0))
"RTN","LRBEBA2",42,0)
 .Q:'$G(LRBEPTDT)
"RTN","LRBEBA2",43,0)
 .S:$P(LRBEPTDT,"^",9)=1 ^TMP("LRX",$J,69,IFN,"LRBEDGX",1)=LRBEPTDT
"RTN","LRBEBA2",44,0)
 .S:$P(LRBEPTDT,"^",9)'=1 ^TMP("LRX",$J,69,IFN,"LRBEDGX",LRBECNT)=LRBEPTDT,LRBECNT=LRBECNT+1
"RTN","LRBEBA2",45,0)
 Q
"RTN","LRBEBA2",46,0)
 ;
"RTN","LRBEBA2",47,0)
SDG1(IFN,CTR,LRBEMSG) ; Setup the DG1 segment For CPRS
"RTN","LRBEBA2",48,0)
 N LRBEX,LRBEDGX,LRBEIEN,LRBESEQ,LRBEPTDT,LRBEXMSG
"RTN","LRBEBA2",49,0)
 S LRBESEQ="" F  S LRBESEQ=$O(^TMP("LRX",$J,69,IFN,"LRBEDGX",LRBESEQ)) Q:LRBESEQ=""  D
"RTN","LRBEBA2",50,0)
 .S LRBEPTDT=$G(^TMP("LRX",$J,69,IFN,"LRBEDGX",LRBESEQ))
"RTN","LRBEBA2",51,0)
 .S LRBEDGX=$$GET1^DIQ(80,$P(LRBEPTDT,U,1)_",",.01,"I")
"RTN","LRBEBA2",52,0)
 .S LRBEXMSG=$$GET1^DIQ(80,$P(LRBEPTDT,U,1)_",",3,"I")
"RTN","LRBEBA2",53,0)
 .S LRBEX=$P(LRBEPTDT,U,1)_"^"_LRBEXMSG_"^80^"_LRBEDGX_"^"_LRBEXMSG_"^ICD9"
"RTN","LRBEBA2",54,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="DG1|"_LRBESEQ_"||"_LRBEX_"|||||||||||||"
"RTN","LRBEBA2",55,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|1|"_$P(LRBEPTDT,U,4)
"RTN","LRBEBA2",56,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|2|"_$P(LRBEPTDT,U,5)
"RTN","LRBEBA2",57,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|3|"_$P(LRBEPTDT,U,2)
"RTN","LRBEBA2",58,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|4|"_$P(LRBEPTDT,U,6)
"RTN","LRBEBA2",59,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|5|"_$P(LRBEPTDT,U,7)
"RTN","LRBEBA2",60,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|6|"_$P(LRBEPTDT,U,8)
"RTN","LRBEBA2",61,0)
 .S CTR=CTR+1,@LRBEMSG@(CTR)="ZCL|"_LRBESEQ_"|7|"_$P(LRBEPTDT,U,3)
"RTN","LRBEBA2",62,0)
 Q
"RTN","LRBEBA2",63,0)
 ;
"RTN","LRBEBA2",64,0)
SLROT(LRXST,LRTEST,LRBEOT) ;LROT array
"RTN","LRBEBA2",65,0)
 N LRBEA,LRBESMP,LRBESPC
"RTN","LRBEBA2",66,0)
 S LRBESMP="" F  S LRBESMP=$O(LRXST(LRBESMP)) Q:LRBESMP=""  D
"RTN","LRBEBA2",67,0)
 .S LRBEA="" F  S LRBEA=$O(LRXST(LRBESMP,LRBEA)) Q:LRBEA=""  D
"RTN","LRBEBA2",68,0)
 ..S LRBESPC=$P(LRXST(LRBESMP,LRBEA),U,1)
"RTN","LRBEBA2",69,0)
 ..S LRBEOT(LRBESMP,LRBESPC,LRBEA)=$P(LRTEST(LRBEA),U,1)
"RTN","LRBEBA2",70,0)
 Q
"RTN","LRBEBA2",71,0)
 ;
"RTN","LRBEBA2",72,0)
GMOD(LRBEAA) ; Get mod
"RTN","LRBEBA2",73,0)
 N DIC,LRBEESA,LRBEMOD,X,Y
"RTN","LRBEBA2",74,0)
 S LRBEESA=$$GET1^DIQ(68,LRBEAA_",",12),LRBEMOD=""
"RTN","LRBEBA2",75,0)
 I LRBEESA D
"RTN","LRBEBA2",76,0)
 .S X=90,DIC="^DIC(81.3,",DIC(0)="Z" D ^DIC
"RTN","LRBEBA2",77,0)
 .I +Y<0 K DIC Q
"RTN","LRBEBA2",78,0)
 .S LRBEMOD=$P(Y,U,2)
"RTN","LRBEBA2",79,0)
 Q LRBEMOD
"RTN","LRBEBA2",80,0)
 ;
"RTN","LRBEBA2",81,0)
GOPRO(LRODT,LRSN) ; Get the Ordering Provider
"RTN","LRBEBA2",82,0)
 N X,Y,DIC,LRBEPRO
"RTN","LRBEBA2",83,0)
 S LRBEPRO=$$GET1^DIQ(69.01,LRSN_","_LRODT_",",7,"I")
"RTN","LRBEBA2",84,0)
 I $$GET^XUA4A72(LRBEPRO,DT)<0 S LRBEPRO=0 D
"RTN","LRBEBA2",85,0)
 .S X=$$GET1^DIQ(69.9,1,617,"I")
"RTN","LRBEBA2",86,0)
 .I $$GET^XUA4A72(X,DT)>0 S LRBEPRO=X
"RTN","LRBEBA2",87,0)
 Q LRBEPRO
"RTN","LRBEBA2",88,0)
 ;
"RTN","LRBEBA2",89,0)
SACC(LRODT,LRSN,LRTN,LRSAMP,LRSPEC,LRTSTS,LRBEX) ; Set Accession 
"RTN","LRBEBA2",90,0)
 N LRBEZ
"RTN","LRBEBA2",91,0)
 D CARR(.LRBEX,.LRBEZ,LRSAMP,LRSPEC,LRTSTS)
"RTN","LRBEBA2",92,0)
 D SDG1^LRBEBA(LRODT,LRSN,LRTN,LRSAMP,LRSPEC,LRTSTS,.LRBEZ)
"RTN","LRBEBA2",93,0)
 Q
"RTN","LRBEBA2",94,0)
 ;
"RTN","LRBEBA2",95,0)
CARR(LRBEAR,LRBEARR,LRBESAMP,LRBESPEC,LRTSTS) ; Change the array to only
"RTN","LRBEBA2",96,0)
 ; the specimen that needs to go
"RTN","LRBEBA2",97,0)
 N LRBEDFN,LRBETS,LRBESMP,LRBESPC
"RTN","LRBEBA2",98,0)
 M LRBEARR=LRBEAR
"RTN","LRBEBA2",99,0)
 I '$D(DFN) S LRBEDFN=$$GET1^DIQ(63,LRDFN,.03,"I")
"RTN","LRBEBA2",100,0)
 S:$D(DFN) LRBEDFN=DFN
"RTN","LRBEBA2",101,0)
 S LRBESMP=""
"RTN","LRBEBA2",102,0)
 F  S LRBESMP=$O(LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP)) Q:LRBESMP=""  D
"RTN","LRBEBA2",103,0)
 .I LRBESAMP'=LRBESMP D  Q
"RTN","LRBEBA2",104,0)
 ..K LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP)
"RTN","LRBEBA2",105,0)
  .S LRBESPC=""
"RTN","LRBEBA2",106,0)
 .F  S LRBESPC=$O(LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC)) Q:LRBESPC=""  D
"RTN","LRBEBA2",107,0)
 ..I LRBESPEC'=LRBESPC D  Q
"RTN","LRBEBA2",108,0)
 ...K LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC)
"RTN","LRBEBA2",109,0)
 ..S LRBETS=""
"RTN","LRBEBA2",110,0)
 ..F  S LRBETS=$O(LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETS)) Q:LRBETS=""  D
"RTN","LRBEBA2",111,0)
 ...I LRBETS'=LRTSTS K LRBEARR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETS)
"RTN","LRBEBA2",112,0)
 Q
"RTN","LRBEBA2",113,0)
 ;
"RTN","LRBEBA2",114,0)
BLDAR(LRBEDFN,LRODT,LRSN,LRTN,LRBESMP,LRBESPC,LRBETST,LRBEAR) ; Build array
"RTN","LRBEBA2",115,0)
 ;                                     with diagnosis and indicator info
"RTN","LRBEBA2",116,0)
 K LRBEMSG,LRBESEQ,LRBEPTDT,LRBEODT,LRBEDMSG,LRDBEDGX,LRD
"RTN","LRBEBA2",117,0)
 S LRBEODT=$P(LRODT,"."),LRBEPTDT=""
"RTN","LRBEBA2",118,0)
 S LRTN=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETST,0))
"RTN","LRBEBA2",119,0)
 Q:'$G(LRTN)
"RTN","LRBEBA2",120,0)
 S LRBESEQ=0 F  S LRBESEQ=$O(^LRO(69,LRODT,1,LRSN,2,LRTN,2,LRBESEQ)) Q:LRBESEQ<1  D
"RTN","LRBEBA2",121,0)
 . I LRBESEQ,$D(^LRO(69,LRODT,1,LRSN,2,LRTN,2,LRBESEQ,0)) S LRD=^(0) D
"RTN","LRBEBA2",122,0)
 . . S LRBEMSG=+LRD_"^^^"_$P(LRD,U,4)_U_$P(LRD,U,5)_U_$P(LRD,U,2)
"RTN","LRBEBA2",123,0)
 . . S LRBEMSG=LRBEMSG_U_$P(LRD,U,6)_U_$P(LRD,U,7)_U_$P(LRD,U,8)
"RTN","LRBEBA2",124,0)
 . . S LRBEMSG=LRBEMSG_U_$P(LRD,U,3)_U_$P(LRD,U,9)
"RTN","LRBEBA2",125,0)
 . . S LRBEDGX=+LRD
"RTN","LRBEBA2",126,0)
 . S LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,LRBEDGX)=LRBEMSG
"RTN","LRBEBA2",127,0)
 ;if test has no dx, sc/ei, then find default dx, sc/ei
"RTN","LRBEBA2",128,0)
 S LRBESEQ=$O(^LRO(69,LRODT,1,LRSN,2,LRTN,2,0)) I 'LRBESEQ D
"RTN","LRBEBA2",129,0)
 . D DEFAULT^LRBEBA4 Q:$G(LRBENO)
"RTN","LRBEBA2",130,0)
 . Q:'$G(LRDBEDGX)
"RTN","LRBEBA2",131,0)
 . S LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,LRDBEDGX)=LRBEDMSG
"RTN","LRBEBA2",132,0)
 N LRTNX,LRI,LRTNXID
"RTN","LRBEBA2",133,0)
 D BLDAR2(LRBETST,LRBETST,LRBESMP,LRBESPC)
"RTN","LRBEBA2",134,0)
 S LRI=0 F  S LRI=$O(^LAB(60,LRBETST,2,LRI)) Q:LRI<1  D
"RTN","LRBEBA2",135,0)
 . S LRTNX=+$G(^LAB(60,LRBETST,2,LRI,0)) Q:'LRTNX
"RTN","LRBEBA2",136,0)
 . S LRTNXID=$P($P(^LAB(60,LRTNX,0),U,5),";",2)
"RTN","LRBEBA2",137,0)
 . I LRTNXID="" D BLDAR2(LRBETST,LRTNX,LRBESMP,LRBESPC)
"RTN","LRBEBA2",138,0)
 Q
"RTN","LRBEBA2",139,0)
 ;
"RTN","LRBEBA2",140,0)
BLDAR2(LRBETST,XTEST,LRBESMP,LRBESPC) ;
"RTN","LRBEBA2",141,0)
 N LRTNX,LRI,DGX,LRX
"RTN","LRBEBA2",142,0)
 S LRI=0
"RTN","LRBEBA2",143,0)
 F  S LRI=$O(^LAB(60,XTEST,2,LRI)) Q:LRI<1  D
"RTN","LRBEBA2",144,0)
 . S LRTNX=+$G(^LAB(60,XTEST,2,LRI,0)) Q:'LRTNX  D
"RTN","LRBEBA2",145,0)
 . . S DGX=0 F  S DGX=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,DGX)) Q:DGX<1  D
"RTN","LRBEBA2",146,0)
 . . . S LRX=$G(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,DGX))
"RTN","LRBEBA2",147,0)
 . . . Q:'LRX
"RTN","LRBEBA2",148,0)
 . . . S LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRTNX,DGX)=LRX
"RTN","LRBEBA2",149,0)
 Q
"RTN","LRBEBA2",150,0)
 ;
"RTN","LRBEBA2",151,0)
STDN(LRODT,LRBESN,LRBETEST,LRBEAR1) ;  Test and Data Number
"RTN","LRBEBA2",152,0)
 N LRBEA,LRBEB,LRBEC,LRBED,LRBEDX,LRBEPTDT,X,Y
"RTN","LRBEBA2",153,0)
 S LRBEA="" F  S LRBEA=$O(LRBETEST(LRBEA)) Q:LRBEA=""  D
"RTN","LRBEBA2",154,0)
 .S DIC="^LRO(69,"_LRODT_","_1_","_LRBESN_","_"2,",DIC(0)="MZ"
"RTN","LRBEBA2",155,0)
 .S X=$P(LRBETEST(LRBEA),U,2) D ^DIC K DIC I +Y<1 Q
"RTN","LRBEBA2",156,0)
 .S LRBEB=0 F  S LRBEB=$O(^LRO(69,LRODT,1,LRBESN,2,+Y,2,"B",LRBEB)) Q:LRBEB<1  D
"RTN","LRBEBA2",157,0)
 ..S LRBEC=0 F  S LRBEC=$O(^LRO(69,LRODT,1,LRBESN,2,+Y,2,"B",LRBEB,LRBEC)) Q:'LRBEC  D
"RTN","LRBEBA2",158,0)
 ...S LRBED="" F  S LRBED=$O(LRBEAR1($P(LRBETEST(LRBEA),U,1),LRBED)) Q:LRBED=""  D
"RTN","LRBEBA2",159,0)
 ....S LRBEAR1($P(LRBETEST(LRBEA),U,1),LRBED,LRBEC)=LRBEB
"RTN","LRBEBA2",160,0)
 Q
"RTN","LRBEBA2",161,0)
 ;
"RTN","LRBEBA2",162,0)
SOP(LRBEDFN,LRBESB,LRBEAR1,LRBEPAN,LRBEROLL) ;Outpatient Resulting 
"RTN","LRBEBA2",163,0)
 ; Information in CIDC Array
"RTN","LRBEBA2",164,0)
 N DIC,LRBEDN,LRBESTG,LRBEMOD,LRBEDGX,LRBEEDT,LRBEEPRO,LRBEOPRO,LRBEQTY,LRBETST
"RTN","LRBEBA2",165,0)
 N LRBEPOS,LRORREFN,LRBE21
"RTN","LRBEBA2",166,0)
 ;LRBERES=Resend PCE date flag
"RTN","LRBEBA2",167,0)
 K LRBECPT S (LRBECPT,LRBEMOD,LRBEEDT,LRBEEPRO,LRBEOPRO,LRBEQTY,LRORREFN)=""
"RTN","LRBEBA2",168,0)
 S LRBEEPRO=$$GEPRO(LRAA),LRBEOPRO=$$GOPRO^LRBEBA2(LRODT,LRSN)
"RTN","LRBEBA2",169,0)
 S LRBETST=0 F  S LRBETST=$O(LRBEAR1(LRBETST)) Q:'LRBETST  D
"RTN","LRBEBA2",170,0)
 . S LRBE21=0
"RTN","LRBEBA2",171,0)
 . ;process AMA/billable panel CPT codes
"RTN","LRBEBA2",172,0)
 . I $D(LRBEPAN(LRBETST)) D EN^LRBEBA21(.LRBE21)
"RTN","LRBEBA2",173,0)
 . ;otherwise process atomic test(s) CPT codes
"RTN","LRBEBA2",174,0)
 . I 'LRBE21 D
"RTN","LRBEBA2",175,0)
 . . S LRY=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETST,0))
"RTN","LRBEBA2",176,0)
 . . Q:'LRY
"RTN","LRBEBA2",177,0)
 . . S LRY=LRY_","_LRSN_","_LRODT_","
"RTN","LRBEBA2",178,0)
 . . Q:$$GET1^DIQ(69.03,LRY,10,"I")
"RTN","LRBEBA2",179,0)
 . . I $G(ORIEN),$$GET1^DIQ(69.03,LRY,6,"I")'=ORIEN Q
"RTN","LRBEBA2",180,0)
 . . S LRBECDT=$$GET1^DIQ(69.03,LRY,22,"I")
"RTN","LRBEBA2",181,0)
 . . Q:'LRBECDT
"RTN","LRBEBA2",182,0)
 . . S LRBEDN="" F  S LRBEDN=$O(LRBEAR1(LRBETST,LRBEDN)) Q:LRBEDN=""  D SOP2
"RTN","LRBEBA2",183,0)
 . . I $D(LRBECPT)=11 S LRFDA(1,69.03,LRY,11)=1 D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA2",184,0)
 Q
"RTN","LRBEBA2",185,0)
 ;
"RTN","LRBEBA2",186,0)
SOP2 ;Process atomic test CPT code
"RTN","LRBEBA2",187,0)
 N OUT,LRBETSTX
"RTN","LRBEBA2",188,0)
 I $G(LRBESB(LRBEDN))'="" D
"RTN","LRBEBA2",189,0)
 . I $P(LRBESB(LRBEDN),U)="pending" Q
"RTN","LRBEBA2",190,0)
 . I $P(LRBESB(LRBEDN),U)="canc" Q
"RTN","LRBEBA2",191,0)
 . I '$G(LRBERES) Q:$P($G(LRBESB(LRBEDN)),U,13)
"RTN","LRBEBA2",192,0)
 . S LRBEQTY=1
"RTN","LRBEBA2",193,0)
 . D GPRO^LRBEBA4(LRBEDN,LRBECDT,LRSPEC,.LRBETSTX) I $G(LRBETSTX),$O(LRBECPT(LRBETSTX,0)) D
"RTN","LRBEBA2",194,0)
 . . D GOREF^LRBEBA21(LRODT,LRSN,LRBEDN,.LRBEAR1,.LRORREFN)
"RTN","LRBEBA2",195,0)
 . . S OUT=0 I $G(LRDFN),$G(LRIDT),$D(^LR(LRDFN,LRSS,LRIDT,$G(LRBEDN))) D
"RTN","LRBEBA2",196,0)
 . . . ;test already sent to PCE
"RTN","LRBEBA2",197,0)
 . . . I '$G(LRBERES) S OUT=$P(^LR(LRDFN,LRSS,LRIDT,$G(LRBEDN)),U,13) Q:OUT
"RTN","LRBEBA2",198,0)
 . . . ;otherwise, mark it as sent to PCE
"RTN","LRBEBA2",199,0)
 . . . S $P(^LR(LRDFN,LRSS,LRIDT,$G(LRBEDN)),U,13)=1
"RTN","LRBEBA2",200,0)
 . . ;don't continue if test already sent to PCE and not re-sending from WORK^LRBEBA4
"RTN","LRBEBA2",201,0)
 . . Q:OUT
"RTN","LRBEBA2",202,0)
 . . S LRI=0 F  S LRI=$O(LRBECPT(LRBETSTX,LRI)) Q:LRI<1  D
"RTN","LRBEBA2",203,0)
 . . . S LRBECPT=$O(LRBECPT(LRBETSTX,LRI,0))
"RTN","LRBEBA2",204,0)
 . . . S LRBEPOS=$$GPOS(.LRBESB,LRBEDN)
"RTN","LRBEBA2",205,0)
 . . . D GDGX^LRBEBA21(LRBETST,LRBEDN,.LRBEAR,.LRBEAR1,.LRBEDGX)
"RTN","LRBEBA2",206,0)
 . . . S LRBESTG=LRBECPT_U_LRBEMOD_U_$G(LRBEDGX(LRBETST,1))_U_$G(LRBEDGX(LRBETST,2))_U_$G(LRBEDGX(LRBETST,3))
"RTN","LRBEBA2",207,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,4))_U_LRBECDT_U_LRBEEPRO_U_LRBEOPRO_U_LRBEQTY_U_LRBEPOS
"RTN","LRBEBA2",208,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,5))_U_$G(LRBEDGX(LRBETST,6))_U_$G(LRBEDGX(LRBETST,7))
"RTN","LRBEBA2",209,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,8))_U_LRORREFN
"RTN","LRBEBA2",210,0)
 . . . S LRBEAR(LRBEDFN,"LRBEDGX",LRI,LRBEDN)=LRBESTG
"RTN","LRBEBA2",211,0)
 Q
"RTN","LRBEBA2",212,0)
 ;
"RTN","LRBEBA2",213,0)
GEPRO(LRBEAA) ; Provider - Responsible Official
"RTN","LRBEBA2",214,0)
 N X,LRBEPRO
"RTN","LRBEBA2",215,0)
 S LRBEPRO=$$GET1^DIQ(68,LRBEAA_",",.1,"I")
"RTN","LRBEBA2",216,0)
 I $$GET^XUA4A72(LRBEPRO,DT)<0 S LRBEPRO=$$GET1^DIQ(69.9,1,617,"I")
"RTN","LRBEBA2",217,0)
 Q LRBEPRO
"RTN","LRBEBA2",218,0)
 ;
"RTN","LRBEBA2",219,0)
GPOS(LRBESB,LRBEDN) ; Get the Place of Service
"RTN","LRBEBA2",220,0)
 Q $P($G(LRBESB(LRBEDN)),U,9)
"RTN","LRBEBA21")
0^43^B34208057
"RTN","LRBEBA21",1,0)
LRBEBA21 ;DALOI/JAH/FHS - PROCESS PANEL CPT CODE ;8/10/04
"RTN","LRBEBA21",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRBEBA21",3,0)
 ;Continued LRBEBA2
"RTN","LRBEBA21",4,0)
 ;Process panel test for CPT
"RTN","LRBEBA21",5,0)
 ;Set 13th piece of LRSB(X) to prevent double counting
"RTN","LRBEBA21",6,0)
EN(LRBE21) ;LRBEAR1(LRBETST,
"RTN","LRBEBA21",7,0)
 ;Returns LRBE21
"RTN","LRBEBA21",8,0)
 ;        0 = process as atomic test
"RTN","LRBEBA21",9,0)
 ;        1 = processed (or will be processed in future) as panel
"RTN","LRBEBA21",10,0)
 N LRI,LRY,LRTST,LRNOP,LRNP,LRPEND,LRCANC,LRBSB,LRFDA,ERR,OK
"RTN","LRBEBA21",11,0)
 N LRBECDT,LRBEEDT,LRORREFN,LRPCECNT,LRBEQTY,LRNOREQ,LRBESTG
"RTN","LRBEBA21",12,0)
 S (LRBE21,LRPCECNT,LRNP,LRNOP,LRPEND,LRCANC)=0
"RTN","LRBEBA21",13,0)
 I $D(LRBEAR1(LRBETST)) D
"RTN","LRBEBA21",14,0)
 . ;must be AMA/billable panel
"RTN","LRBEBA21",15,0)
 . Q:'($D(LRBEPAN(LRBETST)))
"RTN","LRBEBA21",16,0)
 . S LRY=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETST,0))
"RTN","LRBEBA21",17,0)
 . Q:'LRY
"RTN","LRBEBA21",18,0)
 . S LRY=LRY_","_LRSN_","_LRODT_","
"RTN","LRBEBA21",19,0)
 . ;canceled test
"RTN","LRBEBA21",20,0)
 . I $$GET1^DIQ(69.03,LRY,8,"I")="CA" K LRY Q
"RTN","LRBEBA21",21,0)
 . S LRBECDT=$$GET1^DIQ(69.03,LRY,22,"I")
"RTN","LRBEBA21",22,0)
 . I 'LRBECDT K LRY Q
"RTN","LRBEBA21",23,0)
 . I '$G(LRBERES) S LRPCECNT=$$GET1^DIQ(69.03,LRY,11,"I")
"RTN","LRBEBA21",24,0)
 . I LRPCECNT K LRY Q
"RTN","LRBEBA21",25,0)
 . S LRORREFN=$$GET1^DIQ(69.03,LRY,6,"I")
"RTN","LRBEBA21",26,0)
 . I $G(ORIEN),LRORREFN'=ORIEN K LRY Q
"RTN","LRBEBA21",27,0)
 . ;check status of atomic tests
"RTN","LRBEBA21",28,0)
 . S LRNOREQ=1
"RTN","LRBEBA21",29,0)
 . S LRBSB=0 F  S LRBSB=$O(LRBEAR1(LRBETST,LRBSB)) Q:'LRBSB  I $G(LRIDT) D
"RTN","LRBEBA21",30,0)
 . . ;check only 'required' atomic tests
"RTN","LRBEBA21",31,0)
 . . Q:'$D(LRBEAR1(LRBETST,LRBSB,"R"))
"RTN","LRBEBA21",32,0)
 . . S LRTST=+LRBEAR1(LRBETST,LRBSB,"R")
"RTN","LRBEBA21",33,0)
 . . S X=$G(LRBESB(LRBSB)) I 'LRTST S LRTST=+$P($P(X,"^",3),"!",7)
"RTN","LRBEBA21",34,0)
 . . I X="" S X=$G(^LR(LRDFN,LRSS,LRIDT,LRBSB)) S:(X'="") LRBESB(LRBSB)=X S:(X="") X="pending"
"RTN","LRBEBA21",35,0)
 . . ;check for not performed tests
"RTN","LRBEBA21",36,0)
 . . I $P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRTST,0)),U,6)="*Not Performed" S LRNP=1
"RTN","LRBEBA21",37,0)
 . . ;check for tests already sent to pce
"RTN","LRBEBA21",38,0)
 . . I $P(X,U,13)=1 S LRNOP=1 Q
"RTN","LRBEBA21",39,0)
 . . ;check for cancelled tests
"RTN","LRBEBA21",40,0)
 . . I $P(X,U,1)="canc" S LRCANC=1
"RTN","LRBEBA21",41,0)
 . . ;check for tests still pending
"RTN","LRBEBA21",42,0)
 . . I $P(X,U,1)="pending" S LRPEND=1
"RTN","LRBEBA21",43,0)
 . . S LRNOREQ=0
"RTN","LRBEBA21",44,0)
 . ;quit if any 'required' atomic tests not performed or cancelled
"RTN","LRBEBA21",45,0)
 . Q:((LRNOREQ=0)&(LRNP!LRCANC))
"RTN","LRBEBA21",46,0)
 . ;check for resulted tests in panel with no 'required' tests
"RTN","LRBEBA21",47,0)
 . S OK=0
"RTN","LRBEBA21",48,0)
 . I LRNOREQ S LRBSB=0 F  S LRBSB=$O(LRBEAR1(LRBETST,LRBSB)) Q:'LRBSB!($G(LRNP))  D
"RTN","LRBEBA21",49,0)
 . . S X=$G(LRBESB(LRBSB)),LRTST=+$P($P(X,"^",3),"!",7)
"RTN","LRBEBA21",50,0)
 . . I $P(X,U,1)'="",$P(X,U,1)'="canc",$P(X,U,1)'="pending" S OK=1
"RTN","LRBEBA21",51,0)
 . . ;check for not performed tests
"RTN","LRBEBA21",52,0)
 . . I $P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRTST,0)),U,6)="*Not Performed" S LRNP=1
"RTN","LRBEBA21",53,0)
 . ;quit if no 'required' tests on panel and no resulted tests
"RTN","LRBEBA21",54,0)
 . Q:(LRNOREQ&'OK)
"RTN","LRBEBA21",55,0)
 . ;if not roll-up to PCE, proceed to panel CPT; 
"RTN","LRBEBA21",56,0)
 . ;including case where none of atomic tests are 'required' (if results available)
"RTN","LRBEBA21",57,0)
 . I '$G(LRBEROLL) D PANEL^LRBEBA4 I $O(LRBECPT(LRBETST,0)) D
"RTN","LRBEBA21",58,0)
 . . S LRI=0 F  S LRI=$O(LRBECPT(LRBETST,LRI)) Q:LRI<1  D
"RTN","LRBEBA21",59,0)
 . . . S LRBECPT=$O(LRBECPT(LRBETST,LRI,0))
"RTN","LRBEBA21",60,0)
 . . . S LRBEPOS=DUZ,LRBEQTY=1,LRBEDN=+$O(LRBEAR1(LRBETST,0))
"RTN","LRBEBA21",61,0)
 . . . D GDGX^LRBEBA21(LRBETST,LRBEDN,.LRBEAR,.LRBEAR1,.LRBEDGX)
"RTN","LRBEBA21",62,0)
 . . . S LRBESTG=LRBECPT_U_$G(LRBEMOD)_U_$G(LRBEDGX(LRBETST,1))_U_$G(LRBEDGX(LRBETST,2))_U_$G(LRBEDGX(LRBETST,3))
"RTN","LRBEBA21",63,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,4))_U_LRBECDT_U_LRBEEPRO_U_LRBEOPRO_U_LRBEQTY_U_LRBEPOS
"RTN","LRBEBA21",64,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,5))_U_$G(LRBEDGX(LRBETST,6))_U_$G(LRBEDGX(LRBETST,7))
"RTN","LRBEBA21",65,0)
 . . . S LRBESTG=LRBESTG_U_$G(LRBEDGX(LRBETST,8))_U_LRORREFN
"RTN","LRBEBA21",66,0)
 . . . S LRBEAR(LRBEDFN,"LRBEDGX",LRI,LRBETST)=LRBESTG
"RTN","LRBEBA21",67,0)
 ;
"RTN","LRBEBA21",68,0)
 Q:$G(LRY)=""
"RTN","LRBEBA21",69,0)
 ;
"RTN","LRBEBA21",70,0)
 ;if PCE rollup, then 'unbundled' in SOP2^LRBEBA2
"RTN","LRBEBA21",71,0)
 I $G(LRBEROLL) D  Q
"RTN","LRBEBA21",72,0)
 . K LRBECPT(LRBETST)
"RTN","LRBEBA21",73,0)
 . ;clear 'pending panel' xref
"RTN","LRBEBA21",74,0)
 . S LRFDA(1,69.03,LRY,22.1)=0
"RTN","LRBEBA21",75,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",76,0)
 ;
"RTN","LRBEBA21",77,0)
 ;if no required tests on panel and panel CPT exists, at least one resulted atomic,
"RTN","LRBEBA21",78,0)
 ;then mark panel as processed; retain LRBECPT array for BAWRK^LRBEBA;
"RTN","LRBEBA21",79,0)
 ;set return to "1" to avoid 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",80,0)
 I $O(LRBECPT(LRBETST,0)),LRNOREQ D  Q
"RTN","LRBEBA21",81,0)
 . S LRBE21=1
"RTN","LRBEBA21",82,0)
 . D LRSB
"RTN","LRBEBA21",83,0)
 . S LRFDA(1,69.03,LRY,11)=1
"RTN","LRBEBA21",84,0)
 . ;clear 'pending panel' xref
"RTN","LRBEBA21",85,0)
 . S LRFDA(1,69.03,LRY,22.1)=0
"RTN","LRBEBA21",86,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",87,0)
 ;
"RTN","LRBEBA21",88,0)
 ;if no required tests on panel and panel has no CPT or inactive CPT,
"RTN","LRBEBA21",89,0)
 ;then return is "0" for 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",90,0)
 I '$O(LRBECPT(LRBETST,0)),LRNOREQ Q
"RTN","LRBEBA21",91,0)
 ;
"RTN","LRBEBA21",92,0)
 ;if resending (from WORK^LRBEBA4) and panel CPT determined,
"RTN","LRBEBA21",93,0)
 ;then return "1" to avoid 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",94,0)
 I $G(LRBERES)&LRNOP&('LRPEND)&($O(LRBECPT(LRBETST,0))) S LRBE21=1 Q
"RTN","LRBEBA21",95,0)
 ;
"RTN","LRBEBA21",96,0)
 ;if required atomic tests not performed, previously sent, or cancelled,
"RTN","LRBEBA21",97,0)
 ;then return is "0" for 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",98,0)
 I (LRNP!LRNOP!LRCANC) D  Q
"RTN","LRBEBA21",99,0)
 . K LRBECPT(LRBETST)
"RTN","LRBEBA21",100,0)
 . ;clear 'pending panel' xref
"RTN","LRBEBA21",101,0)
 . S LRFDA(1,69.03,LRY,22.1)=0
"RTN","LRBEBA21",102,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",103,0)
 ;
"RTN","LRBEBA21",104,0)
 ;if panel has CPT and no required atomic test still pending,
"RTN","LRBEBA21",105,0)
 ;then mark panel as processed; retain LRBECPT array for BAWRK^LRBEBA;
"RTN","LRBEBA21",106,0)
 ;set return to "1" to avoid 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",107,0)
 I $O(LRBECPT(LRBETST,0)),'LRPEND D  Q
"RTN","LRBEBA21",108,0)
 . S LRBE21=1
"RTN","LRBEBA21",109,0)
 . D LRSB
"RTN","LRBEBA21",110,0)
 . S LRFDA(1,69.03,LRY,11)=1
"RTN","LRBEBA21",111,0)
 . ;clear 'pending panel' xref
"RTN","LRBEBA21",112,0)
 . S LRFDA(1,69.03,LRY,22.1)=0
"RTN","LRBEBA21",113,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",114,0)
 ;
"RTN","LRBEBA21",115,0)
 ;if panel has no CPT or inactive CPT, but required atomic test still pending,
"RTN","LRBEBA21",116,0)
 ;then set return to "1" to avoid 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",117,0)
 I '$O(LRBECPT(LRBETST,0)),LRPEND D  Q
"RTN","LRBEBA21",118,0)
 . S LRBE21=1
"RTN","LRBEBA21",119,0)
 . ;set 'pending panel' xref
"RTN","LRBEBA21",120,0)
 . S LRFDA(1,69.03,LRY,22.1)=1
"RTN","LRBEBA21",121,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",122,0)
 ;
"RTN","LRBEBA21",123,0)
 ;if panel has CPT, but required atomic test still pending,
"RTN","LRBEBA21",124,0)
 ;then kill cpt to avoid transmission to PCE,
"RTN","LRBEBA21",125,0)
 ;set return to "1" to avoid 'unbundled' processing in SOP2^LRBEBA2
"RTN","LRBEBA21",126,0)
 I $O(LRBECPT(LRBETST,0)),LRPEND D
"RTN","LRBEBA21",127,0)
 . S LRBE21=1
"RTN","LRBEBA21",128,0)
 . S LRI=$O(LRBECPT(LRBETST,0)) K LRBEAR(LRBEDFN,"LRBEDGX",LRI,LRBETST)
"RTN","LRBEBA21",129,0)
 . K LRBECPT(LRBETST)
"RTN","LRBEBA21",130,0)
 . ;set 'pending panel' xref
"RTN","LRBEBA21",131,0)
 . S LRFDA(1,69.03,LRY,22.1)=1
"RTN","LRBEBA21",132,0)
 . D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA21",133,0)
 ;
"RTN","LRBEBA21",134,0)
 Q
"RTN","LRBEBA21",135,0)
 ;
"RTN","LRBEBA21",136,0)
LRSB ;Set LRBESB(TEST) 13th piece to 1, counted as part of panel.
"RTN","LRBEBA21",137,0)
 ;Set 13th piece of LRBESB(X) to prevent double counting
"RTN","LRBEBA21",138,0)
 N LRSBX
"RTN","LRBEBA21",139,0)
 S LRSBX=0 F  S LRSBX=$O(LRBEAR1(LRBETST,LRSBX)) Q:LRSBX<1  D
"RTN","LRBEBA21",140,0)
 . I $D(LRBESB(LRSBX))#2 S $P(LRBESB(LRSBX),U,13)=1
"RTN","LRBEBA21",141,0)
 . I $G(LRIDT),$D(^LR(LRDFN,LRSS,LRIDT,LRSBX)) S $P(^(LRSBX),U,13)=1
"RTN","LRBEBA21",142,0)
 Q
"RTN","LRBEBA21",143,0)
 ;
"RTN","LRBEBA21",144,0)
GDGX(LRBETST,LRBEDN,LRBEAR,LRBEAR1,LRBEDGX) ; Set diagnosis LRBEDGX
"RTN","LRBEBA21",145,0)
 N LRBEPOV,LRBEPTDT,LRBETNUM
"RTN","LRBEBA21",146,0)
 S (LRBEPOV,LRBETNUM)=""  F  S LRBEPOV=$O(LRBEAR1(LRBETST,LRBEDN,LRBEPOV)) Q:'LRBEPOV  D
"RTN","LRBEBA21",147,0)
 . S LRBEPTDT=$G(LRBEAR1(LRBETST,LRBEDN,LRBEPOV))
"RTN","LRBEBA21",148,0)
 . S LRBETNUM=$G(LRBETNUM)+1,LRBEDGX(LRBETST,LRBETNUM)=$P(LRBEPTDT,U,1)
"RTN","LRBEBA21",149,0)
  Q:$D(LRBEDGX(LRBETST,1))
"RTN","LRBEBA21",150,0)
 N DGX S DGX=0
"RTN","LRBEBA21",151,0)
 F  S DGX=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRSAMP,LRSPEC,LRBETST,DGX)) Q:DGX<1  D
"RTN","LRBEBA21",152,0)
 . S LRBETNUM=$G(LRBETNUM)+1,LRBEDGX(LRBETST,LRBETNUM)=DGX
"RTN","LRBEBA21",153,0)
 Q
"RTN","LRBEBA21",154,0)
GOREF(LRODT,LRSN,LRBEDN,LRBEAR1,LRORREFN) ;
"RTN","LRBEBA21",155,0)
 ;Get the OERR INTERNAL FILE #
"RTN","LRBEBA21",156,0)
 N LRX1,LRBEIEN1,LRBETST
"RTN","LRBEBA21",157,0)
 S LRBETST=""
"RTN","LRBEBA21",158,0)
 F  S LRBETST=$O(LRBEAR1(LRBETST)) Q:LRBETST=""  D
"RTN","LRBEBA21",159,0)
 .Q:'$D(LRBEAR1(LRBETST,LRBEDN))
"RTN","LRBEBA21",160,0)
 .S LRX1=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETST,0))
"RTN","LRBEBA21",161,0)
 .I $G(LRX1) D  Q
"RTN","LRBEBA21",162,0)
 ..S LRBEIEN1=LRX1_","_LRSN_","_LRODT_","
"RTN","LRBEBA21",163,0)
 ..S LRORREFN=$$GET1^DIQ(69.03,LRBEIEN1,6,"I")
"RTN","LRBEBA21",164,0)
 .S LRORREFN=""
"RTN","LRBEBA21",165,0)
 Q
"RTN","LRBEBA3")
0^37^B24961895
"RTN","LRBEBA3",1,0)
LRBEBA3 ;DALOI/JAH/FHS - ORDERING AND RESULTING OUTPATIENT ;8/10/04
"RTN","LRBEBA3",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRBEBA3",3,0)
 ;
"RTN","LRBEBA3",4,0)
BLDAR(LRBEDFN,LRODT,LRSN,LRBEAR,LRBEY,LRBETEST,LRBEPAN,LRBEDEL) ; Build LRBEAR array with
"RTN","LRBEBA3",5,0)
 ; CIDC information
"RTN","LRBEBA3",6,0)
 N LRBEODT,LRBEIEN,LRBETST,LRBETS,LRJ,N,NX,P,X,XX,REQX,OK
"RTN","LRBEBA3",7,0)
 S LRBEAR(LRBEDFN,"DSS ID")=LROOS
"RTN","LRBEBA3",8,0)
 S LRBEAR(LRBEDFN,"ORDGX")="O"
"RTN","LRBEBA3",9,0)
 S LRBEAR(LRBEDFN,"DOS")=LRBECDT
"RTN","LRBEBA3",10,0)
 S LRBEAR(LRBEDFN,"PAT")=$G(LRBEDFN)
"RTN","LRBEBA3",11,0)
 S LRBEAR(LRBEDFN,"POS")=LROOS
"RTN","LRBEBA3",12,0)
 S LRBEAR(LRBEDFN,"DEL")=LRBEDEL
"RTN","LRBEBA3",13,0)
 S LRBEAR(LRBEDFN,"USR")=DUZ
"RTN","LRBEBA3",14,0)
 S LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEBA3",15,0)
 S LRBEAR(LRBEDFN,"ORDPRO")=$$GET1^DIQ(69.01,LRBEIEN,7,"I")
"RTN","LRBEBA3",16,0)
 S:'+$G(LRSAMP) LRSAMP=$$GET1^DIQ(69.01,LRBEIEN,3,"I")
"RTN","LRBEBA3",17,0)
 ;reset LRBETEST, LRBEY for panel tests
"RTN","LRBEBA3",18,0)
 S LRBETS="" F  S LRBETS=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETS)) Q:'LRBETS  D
"RTN","LRBEBA3",19,0)
 .S LRJ=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRBETS,0))
"RTN","LRBEBA3",20,0)
 .Q:($P(^LRO(69,LRODT,1,LRSN,2,LRJ,0),U,9)="CA")
"RTN","LRBEBA3",21,0)
 .I $G(ORIEN),$P(^LRO(69,LRODT,1,LRSN,2,LRJ,0),U,7)'=ORIEN Q
"RTN","LRBEBA3",22,0)
 .I ($G(^LAB(60,LRBETS,12))),($D(^LAB(60,LRBETS,0))#2),'$L($P($G(^LAB(60,LRBETS,0)),U,5)) S LRBEPAN(LRBETS)=""
"RTN","LRBEBA3",23,0)
 .S OK=0,N=0 F  S N=$O(LRBETEST(N)) Q:'N  I LRBETS=+LRBETEST(N) S OK=1
"RTN","LRBEBA3",24,0)
 .I 'OK S N=$O(LRBETEST(""),-1),N=N+1,LRBETEST(N)=LRBETS_U_^LAB(60,LRBETS,0),LRBETEST(N,"P")=LRBETS_U_$$NLT^LRVER1(LRBETS)
"RTN","LRBEBA3",25,0)
 .S NX=0 F  S NX=$O(^LAB(60,LRBETS,2,NX)) Q:'NX  D
"RTN","LRBEBA3",26,0)
 ..S X=+^LAB(60,LRBETS,2,NX,0)
"RTN","LRBEBA3",27,0)
 ..S XX=$P($P(^LAB(60,X,0),U,5),";",2),REQX=$P(^(0),U,17)
"RTN","LRBEBA3",28,0)
 ..I XX,$D(LRBESB(XX)) S P(LRBETS,XX,X)=""
"RTN","LRBEBA3",29,0)
 ..I XX,$D(LRBEPAN(LRBETS)),REQX S P(LRBETS,XX,X)="R"
"RTN","LRBEBA3",30,0)
 ..;if XX null, then possibly another panel
"RTN","LRBEBA3",31,0)
 ..I 'XX D PARRAY(X,LRBETS,.P)
"RTN","LRBEBA3",32,0)
 .;reset LRBEY array;
"RTN","LRBEBA3",33,0)
 .;1st subscript is panel test; 2nd subscript is data identifier of atomic test
"RTN","LRBEBA3",34,0)
 .I $D(P(LRBETS)) D
"RTN","LRBEBA3",35,0)
 ..;retain original LRBEY array node if atomic test exists as a separate accession
"RTN","LRBEBA3",36,0)
 ..I '$D(^LRO(68,$G(LRAA),1,$G(LRAD),1,$G(LRAN),4,LRBETS,0)) K LRBEY(LRBETS)
"RTN","LRBEBA3",37,0)
 ..S XX=0 F  S XX=$O(P(LRBETS,XX)) Q:'XX  D
"RTN","LRBEBA3",38,0)
 ...S LRBEY(LRBETS,XX)=""
"RTN","LRBEBA3",39,0)
 ...S X=$O(P(LRBETS,XX,0))
"RTN","LRBEBA3",40,0)
 ...I P(LRBETS,XX,X)="R" S LRBEY(LRBETS,XX,"R")=X
"RTN","LRBEBA3",41,0)
 ;continue
"RTN","LRBEBA3",42,0)
 S LRBETS="" F  S LRBETS=$O(LRBETEST(LRBETS)) Q:LRBETS=""  D
"RTN","LRBEBA3",43,0)
 .S LRBETST=$P(LRBETEST(LRBETS),U,1)
"RTN","LRBEBA3",44,0)
 .D BLDAR^LRBEBA2(LRBEDFN,LRODT,LRSN,LRBETS,LRSAMP,LRSPEC,LRBETST,.LRBEAR)
"RTN","LRBEBA3",45,0)
 Q
"RTN","LRBEBA3",46,0)
 ;
"RTN","LRBEBA3",47,0)
PARRAY(XTEST,PTEST,P) ;
"RTN","LRBEBA3",48,0)
 N NX,X,XX,REQX
"RTN","LRBEBA3",49,0)
 S NX=0 F  S NX=$O(^LAB(60,XTEST,2,NX)) Q:'NX  D
"RTN","LRBEBA3",50,0)
 .S X=+^LAB(60,XTEST,2,NX,0)
"RTN","LRBEBA3",51,0)
 .S XX=$P($P(^LAB(60,X,0),U,5),";",2),REQX=$P(^(0),U,17)
"RTN","LRBEBA3",52,0)
 .I XX,$D(LRBESB(XX)) S P(PTEST,XX,X)=""
"RTN","LRBEBA3",53,0)
 .I XX,$D(LRBEPAN(PTEST)),REQX S P(PTEST,XX,X)="R"
"RTN","LRBEBA3",54,0)
 Q
"RTN","LRBEBA3",55,0)
 ;
"RTN","LRBEBA3",56,0)
QRYADD(LRODT,LRSN,LRTS,LRBEDFN,LRBESMP,LRBESPC,LRBETS,LRBEX,LRBEXD) ; Query #69 for
"RTN","LRBEBA3",57,0)
 ; default LRBEDGX and SC/EI
"RTN","LRBEBA3",58,0)
 N LRBEA,LRDGX,LRDX,LRDGXD
"RTN","LRBEBA3",59,0)
 S LRDGX=0
"RTN","LRBEBA3",60,0)
 F  S LRDGX=$O(^LRO(69,LRODT,1,LRSN,2,LRTS,2,LRDGX)) Q:LRDGX<1  D
"RTN","LRBEBA3",61,0)
 .S LRDGXD=2
"RTN","LRBEBA3",62,0)
 .S LRBEPTDT=$G(^LRO(69,LRODT,1,LRSN,2,LRTS,2,LRDGX,0)) Q:'LRBEPTDT
"RTN","LRBEBA3",63,0)
 .S LRBEA=$P(LRBEPTDT,U,1)_"^^^"_$P(LRBEPTDT,U,4)_U_$P(LRBEPTDT,U,5)
"RTN","LRBEBA3",64,0)
 .S LRBEA=LRBEA_U_$P(LRBEPTDT,U,2)_U_$P(LRBEPTDT,U,6)_U_$P(LRBEPTDT,U,8)
"RTN","LRBEBA3",65,0)
 .S LRBEA=LRBEA_U_$P(LRBEPTDT,U,7)_U_$P(LRBEPTDT,U,3)
"RTN","LRBEBA3",66,0)
 .I $P(LRBEPTDT,U,9)=1 S LRBEA=LRBEA_U_$P(LRBEPTDT,U,9),LRDGXD=1
"RTN","LRBEBA3",67,0)
 .S LRBEX(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETS,$P(LRBEA,U))=LRBEA
"RTN","LRBEBA3",68,0)
 .S LRBEXD(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETS,LRDGXD,$P(LRBEA,U))=LRBEA
"RTN","LRBEBA3",69,0)
 Q
"RTN","LRBEBA3",70,0)
 ;
"RTN","LRBEBA3",71,0)
ELIG(DFN) ; Display eligibility and disabilities
"RTN","LRBEBA3",72,0)
 D ELIG^VADPT W !," Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"    SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","LRBEBA3",73,0)
 W !," Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","LRBEBA3",74,0)
 .S LRDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),LRCNT=$P(I1,"^",2)
"RTN","LRBEBA3",75,0)
 .S LRDIS=$E(LRDIS,1,55)
"RTN","LRBEBA3",76,0)
 .I LRDIS]"" W ?15,LRDIS_" - "_LRCNT_"%("_$S($P(I1,"^",3):"SC",1:"NSC")_")",!
"RTN","LRBEBA3",77,0)
 K LRDIS,LRCNT,I,I1,VAEL
"RTN","LRBEBA3",78,0)
 Q
"RTN","LRBEBA3",79,0)
 ;
"RTN","LRBEBA3",80,0)
BALROW(LRODT,LRSN,LRTEST) ; CIDC LROW
"RTN","LRBEBA3",81,0)
 N LRBEA,LRBEB,LRBEAT,LRBET,LRBESN,LRBETS,LRBETST,LRBEQT,LRBEOT,LRBEVAL
"RTN","LRBEBA3",82,0)
 S LRBEVAL=$D(^XUSEC("PROVIDER",DUZ)) Q:'LRBEVAL
"RTN","LRBEBA3",83,0)
 S LRBEVAL=$$CIDC^IBBAPI(DFN) Q:'LRBEVAL
"RTN","LRBEBA3",84,0)
 I '$D(DFN) S LRBEDFN=$$GET1^DIQ(63,LRDFN_",",.03,"I")
"RTN","LRBEBA3",85,0)
 S:$G(LRSN)="" LRSN=1
"RTN","LRBEBA3",86,0)
 D SLROT^LRBEBA2(.LRXST,.LRTEST,.LRBEOT) S:$G(LRSS)="" LRSS="CH"
"RTN","LRBEBA3",87,0)
 S LRBEAT=1,LRBEY=$$SBA^LRBEBA31(LRDFN,.LRBEX,.LRBEQT,.LRBEOT)
"RTN","LRBEBA3",88,0)
 Q
"RTN","LRBEBA3",89,0)
 ;
"RTN","LRBEBA3",90,0)
AQ1 ; Ask question from LRORD1
"RTN","LRBEBA3",91,0)
 N LRBEVAL
"RTN","LRBEBA3",92,0)
 S LRBEVAL=$D(^XUSEC("PROVIDER",DUZ)) Q:'LRBEVAL
"RTN","LRBEBA3",93,0)
 S LRBEVAL=$$CIDC^IBBAPI(DFN) Q:'LRBEVAL
"RTN","LRBEBA3",94,0)
 K LRBEODT D DT^LRX S LRBEODT=%
"RTN","LRBEBA3",95,0)
 S:$G(LRSS)="" LRSS="CH"
"RTN","LRBEBA3",96,0)
 S LRBEAT=1,LRBEY=$$SBA^LRBEBA31(LRDFN,.LRBEX,.LRBEQT,.LROT)
"RTN","LRBEBA3",97,0)
 Q
"RTN","LRBEBA3",98,0)
 ;
"RTN","LRBEBA3",99,0)
AQ2 ; from LROW2A
"RTN","LRBEBA3",100,0)
 N LRBEVAL
"RTN","LRBEBA3",101,0)
 S LRBEVAL=$$CIDC^IBBAPI(DFN) Q:'LRBEVAL
"RTN","LRBEBA3",102,0)
 D SACC^LRBEBA2(LRODT,LRSN,LRTN,LRSSP,LRSPEC,$P(LRTEST(LRI),U,1),.LRBEX)
"RTN","LRBEBA3",103,0)
 Q
"RTN","LRBEBA3",104,0)
 ;
"RTN","LRBEBA3",105,0)
SVST(ENUM,ETYP,LRODT,LRSN) ; Set the Encounter # in #69
"RTN","LRBEBA3",106,0)
 S ^LRO(69,LRODT,1,LRSN,ETYP)=ENUM
"RTN","LRBEBA3",107,0)
 Q
"RTN","LRBEBA3",108,0)
 ;
"RTN","LRBEBA3",109,0)
BALROR(LRORD) ; CIDC LRORD
"RTN","LRBEBA3",110,0)
 N LRBEA,LRBEAT,LRBEB,LRBET,LRBESN,LRBETS,LRBETST,LRBEQT,LRBEODT
"RTN","LRBEBA3",111,0)
 N LRBEOT,LRBEVAL,LRBEZ,LRBETN
"RTN","LRBEBA3",112,0)
 S LRBEVAL=$D(^XUSEC("PROVIDER",DUZ)) Q:'LRBEVAL
"RTN","LRBEBA3",113,0)
 S LRBEVAL=$$CIDC^IBBAPI(DFN) Q:'LRBEVAL
"RTN","LRBEBA3",114,0)
 I '$D(DFN) S LRBEDFN=$$GET1^DIQ(63,LRDFN_",",.03,"I")
"RTN","LRBEBA3",115,0)
 S LRBEAT=1,LRBEY=$$SBA^LRBEBA31(LRDFN,.LRBEX,.LRBEQT,.LROT)
"RTN","LRBEBA3",116,0)
 Q
"RTN","LRBEBA31")
0^47^B6240256
"RTN","LRBEBA31",1,0)
LRBEBA31 ;DALOI/JAH/FHS - ORDERING AND RESULTING OUTPATIENT ;8/10/04
"RTN","LRBEBA31",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRBEBA31",3,0)
 ;
"RTN","LRBEBA31",4,0)
DADD(LRODT,LRSN,LRBETN,LRXDA,LRTS,LRBERF) ; Take care of ADDs to accession
"RTN","LRBEBA31",5,0)
 N LRBEALO,LRBEAALO,LRBEFN,LRBEX,LRBEVAL,LRBEXD,LRBEQT,LRBESPEC,LRBESAMP
"RTN","LRBEBA31",6,0)
 Q:'$$CIDC^IBBAPI(DFN)
"RTN","LRBEBA31",7,0)
 S LRBERF=$G(LRBERF)
"RTN","LRBEBA31",8,0)
 S LRBEVAL=$D(^XUSEC("PROVIDER",DUZ))
"RTN","LRBEBA31",9,0)
 S LRBEFN="O",LRBEDFN=DFN
"RTN","LRBEBA31",10,0)
 S X=^LRO(69,LRODT,1,LRSN,0),LRBESAMP=$P(X,"^",3) K X
"RTN","LRBEBA31",11,0)
 S LRBESPEC=$O(^LRO(69,LRODT,1,LRSN,4,0))
"RTN","LRBEBA31",12,0)
 S LRBESPEC=$S(LRBESPEC>0:$P(^LRO(69,LRODT,1,LRSN,4,LRBESPEC,0),"^",1),1:"")
"RTN","LRBEBA31",13,0)
 I LRBERF=1 D
"RTN","LRBEBA31",14,0)
 . D QRYADD^LRBEBA3(LRODT,LRSN,LRBETN,LRBEDFN,LRBESAMP,LRBESPEC,LRTS,.LRBEX)
"RTN","LRBEBA31",15,0)
 . D SACC^LRBEBA2(LRODT,LRSN,LRXDA,LRBESAMP,LRBESPEC,LRTS,.LRBEX)
"RTN","LRBEBA31",16,0)
 I LRBEVAL,LRBERF=0 D
"RTN","LRBEBA31",17,0)
 . D ELIG^LRBEBA3(LRBEDFN)
"RTN","LRBEBA31",18,0)
 . S LRBEQT=$$QUES^LRBEBA(LRBEDFN,LRBESAMP,LRBESPEC,LRTS,LRODT,.LRBEX)
"RTN","LRBEBA31",19,0)
 . D:'LRBEQT SACC^LRBEBA2(LRODT,LRSN,LRXDA,LRBESAMP,LRBESPEC,LRTS,.LRBEX)
"RTN","LRBEBA31",20,0)
 Q
"RTN","LRBEBA31",21,0)
 ;
"RTN","LRBEBA31",22,0)
SBA(LRDFN,LRBEX,LRBEQT,LROT) ; billing questions
"RTN","LRBEBA31",23,0)
 N LRBECNT,LRBEST,LRBEDFN,LRBESMP,LRBESPC,LRBEY,LRBETN,LRBEQT
"RTN","LRBEBA31",24,0)
 N LRBEOT,LRBETS,LRBEMSG,LRBEPTDT
"RTN","LRBEBA31",25,0)
 I '$D(DFN) S LRBEDFN=$$GET1^DIQ(63,LRDFN,.03,"I")
"RTN","LRBEBA31",26,0)
 S:$D(DFN) LRBEDFN=DFN
"RTN","LRBEBA31",27,0)
 D:$G(LRBEAT)=1 ELIG^LRBEBA3(LRBEDFN)
"RTN","LRBEBA31",28,0)
 S LRBEST=1,LRBEQT=0
"RTN","LRBEBA31",29,0)
 S LRBESMP="" F  S LRBESMP=$O(LROT(LRBESMP)) Q:LRBESMP=""!(LRBEQT)  D
"RTN","LRBEBA31",30,0)
 .S LRBESPC="" F  S LRBESPC=$O(LROT(LRBESMP,LRBESPC)) Q:LRBESPC=""  D
"RTN","LRBEBA31",31,0)
 ..S LRBEY="" F  S LRBEY=$O(LROT(LRBESMP,LRBESPC,LRBEY)) Q:LRBEY=""  D
"RTN","LRBEBA31",32,0)
 ...S LRBEOT(LRBEY,LRBESMP,LRBESPC)=""
"RTN","LRBEBA31",33,0)
 S LRBEY="" F  S LRBEY=$O(LRBEOT(LRBEY)) Q:LRBEY=""  D
"RTN","LRBEBA31",34,0)
 .S LRBESMP="" F  S LRBESMP=$O(LRBEOT(LRBEY,LRBESMP)) Q:LRBESMP=""!(LRBEQT)  D
"RTN","LRBEBA31",35,0)
 ..S LRBESPC="" F  S LRBESPC=$O(LRBEOT(LRBEY,LRBESMP,LRBESPC)) Q:LRBESPC=""  D
"RTN","LRBEBA31",36,0)
 ...S LRBEPTDT=$G(LROT(LRBESMP,LRBESPC,LRBEY)),LRBETS=$P(LRBEPTDT,U,1)
"RTN","LRBEBA31",37,0)
 ...S LRBETN=$$GET1^DIQ(60,LRBETS_",",.01)
"RTN","LRBEBA31",38,0)
 ...S LRBEMSG="Enter information for "_LRBETN D EN^DDIOL(LRBEMSG,"","!")
"RTN","LRBEBA31",39,0)
 ...S:$G(LRBEAT)'=1 LRBEALO=1
"RTN","LRBEBA31",40,0)
 ...S LRBEQT=$$QUES^LRBEBA(LRBEDFN,LRBESMP,LRBESPC,LRBETS,LRODT,.LRBEX)
"RTN","LRBEBA31",41,0)
 ...S:LRBEQT LRBEST=0 Q:LRBEQT
"RTN","LRBEBA31",42,0)
 ...D EN^DDIOL("","","!")
"RTN","LRBEBA31",43,0)
 Q LRBEST
"RTN","LRBEBA4")
0^40^B57653585
"RTN","LRBEBA4",1,0)
LRBEBA4 ;DALOI/JAH/FHS - ORDERING AND RESULTING OUTPATIENT ;8/10/04
"RTN","LRBEBA4",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRBEBA4",3,0)
 ;
"RTN","LRBEBA4",4,0)
GPRO(LRBEDN,LRBECDT,LRBESPC,LRBETST) ; Get the Procedure (CPT)
"RTN","LRBEBA4",5,0)
 ; A qualified coder will setup the CPTs in #60. The routine look for 
"RTN","LRBEBA4",6,0)
 ; CPTs by specimen, then HCPCS, and lasty, by a default.
"RTN","LRBEBA4",7,0)
 ;
"RTN","LRBEBA4",8,0)
 S X="CH;"_LRBEDN_";1",Y=$O(^LAB(60,"C",X,0))
"RTN","LRBEBA4",9,0)
 Q:+Y<0
"RTN","LRBEBA4",10,0)
 S LRBETST=+Y
"RTN","LRBEBA4",11,0)
PANEL ;Entry point for panel cpt
"RTN","LRBEBA4",12,0)
 N X,Y,DIC,LRBEIEN,LRBENLT,LRN
"RTN","LRBEBA4",13,0)
 S:$G(LRSPEC)="" LRSPEC=$G(LRBESPC)
"RTN","LRBEBA4",14,0)
 S (LRI,LRBECPT)=""
"RTN","LRBEBA4",15,0)
 ; #60 Specimen CPT
"RTN","LRBEBA4",16,0)
SP60 D GCPT(LRBETST,LRBECDT,LRSPEC) Q:$O(LRBECPT(LRBETST,0))
"RTN","LRBEBA4",17,0)
 ;HCPCS CODE
"RTN","LRBEBA4",18,0)
HCPCS D
"RTN","LRBEBA4",19,0)
 . S LRBECPT=$$GET1^DIQ(60,LRBETST_",","HCPCS CODE","I")
"RTN","LRBEBA4",20,0)
 . I LRBECPT D
"RTN","LRBEBA4",21,0)
 . . S LRBECPT=$$CPT^ICPTCOD(LRBECPT,LRBECDT)
"RTN","LRBEBA4",22,0)
 . . I '$P(LRBECPT,U,7) S LRBECPT="" Q
"RTN","LRBEBA4",23,0)
 . . S LRBECPT(LRBETST,$G(LRI)+1,$P(LRBECPT,U))="HCPCS CODE",LRI=$G(LRI)+1
"RTN","LRBEBA4",24,0)
 ;Try file #64
"RTN","LRBEBA4",25,0)
NLT Q:$O(LRBECPT(LRBETST,0))  D
"RTN","LRBEBA4",26,0)
 . N I,LRBENLT,LRX,LRN,LRNM,SUFX
"RTN","LRBEBA4",27,0)
 . S LRBENLT=$$GET1^DIQ(60,LRBETST_",",64,"I")
"RTN","LRBEBA4",28,0)
 . Q:'LRBENLT
"RTN","LRBEBA4",29,0)
 . S LRNM=$P($G(^LAM(LRBENLT,0)),U,2)
"RTN","LRBEBA4",30,0)
 . S SUFX=$P(LRNM,".",2) I 'SUFX S SUFX=$G(LRCDEF)
"RTN","LRBEBA4",31,0)
 . I SUFX S LRNM(1)=$P(LRNM,".",1)_"."_SUFX
"RTN","LRBEBA4",32,0)
 . S LRNM(2)=$P(LRNM,".",1)_".0000"
"RTN","LRBEBA4",33,0)
 . S I=0 F  S I=$O(LRNM(I)) Q:'I  Q:$O(LRBECPT(LRBETST,0))  D
"RTN","LRBEBA4",34,0)
 . . S LRBENLT=$O(^LAM("C",LRNM(I)_" ",0)) Q:'LRBENLT  D
"RTN","LRBEBA4",35,0)
 . . S LRN=0 F  S LRN=$O(^LAM(LRBENLT,4,"AC","CPT",LRN)) Q:LRN<1  D
"RTN","LRBEBA4",36,0)
 . . . S LRX=$G(^LAM(LRBENLT,4,LRN,0)) Q:'LRX  D
"RTN","LRBEBA4",37,0)
 . . . . Q:'$P(LRX,U,3)!($P(LRX,U,3)>LRBECDT)!($P(LRX,U,4)&($P(LRX,U,4)<LRBECDT))
"RTN","LRBEBA4",38,0)
 . . . . S LRBECPT=+LRX
"RTN","LRBEBA4",39,0)
 . . . . I '$P($$CPT^ICPTCOD(LRBECPT,LRBECDT),U,7) Q
"RTN","LRBEBA4",40,0)
 . . . . S LRBECPT(LRBETST,($G(LRI)+1),LRBECPT)="WKLD CODE-"_LRNM(I),LRI=$G(LRI)+1
"RTN","LRBEBA4",41,0)
 ;Default Site/Spec CPT
"RTN","LRBEBA4",42,0)
SPCPT Q:$O(LRBECPT(LRBETST,0))  D
"RTN","LRBEBA4",43,0)
 . S LRBECPT=$$GET1^DIQ(60,LRBETST_",","DEFAULT SITE/SPECIMEN CPT","E")
"RTN","LRBEBA4",44,0)
 . I LRBECPT D
"RTN","LRBEBA4",45,0)
 . . I '$P($$CPT^ICPTCOD(LRBECPT,LRBECDT),U,7) S LRBECPT="" Q
"RTN","LRBEBA4",46,0)
 . . S LRBECPT(LRBETST,$G(LRI)+1,LRBECPT)="DEFAULT SITE/SPECIMEN CPT",LRI=$G(LRI)+1
"RTN","LRBEBA4",47,0)
 Q
"RTN","LRBEBA4",48,0)
 ;
"RTN","LRBEBA4",49,0)
SCPT(CPT,TDAT) ; Get the CPT/HCPCS Code
"RTN","LRBEBA4",50,0)
 Q $$CPT^ICPTCOD(CPT,TDAT)
"RTN","LRBEBA4",51,0)
 ;
"RTN","LRBEBA4",52,0)
GCPT(LRBETST,LRBECDT,LRSPEC) ; Get the CPT
"RTN","LRBEBA4",53,0)
 N A,ARR,LRBEAX,LRBEIEN,LRBEAR60,X
"RTN","LRBEBA4",54,0)
 S LRBEIEN=LRSPEC_","_LRBETST_",",(LRI,LRBECPT)=""
"RTN","LRBEBA4",55,0)
 D GETS^DIQ(60.01,LRBEIEN,"96*","I","LRBEAR60")
"RTN","LRBEBA4",56,0)
 S A="" F  S A=$O(LRBEAR60(60.196,A)) Q:A=""  D
"RTN","LRBEBA4",57,0)
 . Q:$G(LRBEAR60(60.196,A,1,"I"))=""
"RTN","LRBEBA4",58,0)
 . S ARR($G(LRBEAR60(60.196,A,1,"I")))=$G(LRBEAR60(60.196,A,.01,"I"))
"RTN","LRBEBA4",59,0)
 S X=$O(ARR(LRBECDT),-1) I X D
"RTN","LRBEBA4",60,0)
 .S LRBEAX=ARR(X)
"RTN","LRBEBA4",61,0)
 .S LRBEAX=$$CPT^ICPTCOD(LRBEAX,LRBECDT)
"RTN","LRBEBA4",62,0)
 .Q:'$P(LRBEAX,U,7)
"RTN","LRBEBA4",63,0)
 .S LRBECPT(LRBETST,($G(LRI)+1),$P(LRBEAX,U))="SPECIMEN CPT",LRI=$G(LRI)+1
"RTN","LRBEBA4",64,0)
 Q
"RTN","LRBEBA4",65,0)
 ;
"RTN","LRBEBA4",66,0)
UPDOR(DFN,ORITEM,ORIEN,ORDX,ORSCEI) ; Update CIDC information from OERR
"RTN","LRBEBA4",67,0)
 I $G(^XTMP("LRPCELOG",0)) D
"RTN","LRBEBA4",68,0)
 . N LRLNOW,LRI
"RTN","LRBEBA4",69,0)
 . F  S LRLNOW=$$NOW^XLFDT Q:'$D(^XTMP("LRPCELOG",3,LRLNOW))
"RTN","LRBEBA4",70,0)
 . S ^XTMP("LRPCELOG",3,LRLNOW)=DFN_U_ORITEM_U_ORIEN_U_"["_ORSCEI_"]"
"RTN","LRBEBA4",71,0)
 . S LRI=0 F  S LRI=$O(ORDX(LRI)) Q:LRI=""  D
"RTN","LRBEBA4",72,0)
 . . S ^XTMP("LRPCELOG",3,LRLNOW,"ORDX",LRI)=ORDX(LRI)
"RTN","LRBEBA4",73,0)
 I $S('$O(ORDX(0)):1,ORSCEI="^^^^^":1,1:0) Q "O^No Diagnosis Entered"
"RTN","LRBEBA4",74,0)
 N LRBEAR,LRBEDFN,LRDFN,LRBEIEN,LRODT,LRORD,LRSN,LRBERMS,LRBETN,LRBETYP
"RTN","LRBEBA4",75,0)
 N LRBEVST,LRAA,LRLLOC,LRSAMP,LRSPEC,LRSB,LRBEY
"RTN","LRBEBA4",76,0)
 S LRBERMS=1,LRORD=$P(ORITEM,";",1),LRODT=$P(ORITEM,";",2)
"RTN","LRBEBA4",77,0)
 S LRSN=$P(ORITEM,";",3),LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEBA4",78,0)
 S (LRBEDFN,LRDFN)=$$GET1^DIQ(69.01,LRBEIEN,.01,"I")
"RTN","LRBEBA4",79,0)
 S LRSAMP=$$GET1^DIQ(69.01,LRBEIEN,3,"I")
"RTN","LRBEBA4",80,0)
 S LRLLOC=$$GET1^DIQ(69.01,LRBEIEN,8,"I")
"RTN","LRBEBA4",81,0)
 S LRSPEC=$$GET1^DIQ(69.02,"1,"_LRBEIEN,.01,"I") S:LRSPEC="" LRSPEC=72
"RTN","LRBEBA4",82,0)
 I LRORD'=$$GET1^DIQ(69.01,LRBEIEN,9.5,"I") D  Q LRBERMS
"RTN","LRBEBA4",83,0)
 .S LRBERMS="0^"_$$EMSG(1)
"RTN","LRBEBA4",84,0)
 I DFN'=$$GET1^DIQ(63,LRBEDFN_",",.03,"I") D  Q LRBERMS
"RTN","LRBEBA4",85,0)
 .S LRBERMS="0^"_$$EMSG(2)
"RTN","LRBEBA4",86,0)
 S LRBEVST=$P($G(^LRO(69,LRODT,1,LRSN,"PCE")),";",1) D WORK
"RTN","LRBEBA4",87,0)
 Q LRBERMS
"RTN","LRBEBA4",88,0)
 ;
"RTN","LRBEBA4",89,0)
WORK ; Enter the updated information into file
"RTN","LRBEBA4",90,0)
 N LRBEFND,LRBETNM,LRBETST,LRBEZ,LRBERES
"RTN","LRBEBA4",91,0)
 S (LRBETN,LRBEFND)=0
"RTN","LRBEBA4",92,0)
 F  S LRBETN=$O(^LRO(69,LRODT,1,LRSN,2,LRBETN)) Q:LRBETN=""!('LRBETN)  D
"RTN","LRBEBA4",93,0)
 .Q:ORIEN'=$$GET1^DIQ(69.03,LRBETN_","_LRBEIEN,6,"I")
"RTN","LRBEBA4",94,0)
 .S:'LRBEFND LRBEFND=1 S LRAA=""
"RTN","LRBEBA4",95,0)
 .S LRBETST=$$GET1^DIQ(69.03,LRBETN_","_LRBEIEN,.01,"I")
"RTN","LRBEBA4",96,0)
 .S LRBETNM=$$GET1^DIQ(60,LRBETST_",",.01,"I")
"RTN","LRBEBA4",97,0)
 .S LRBEZ(LRBETN)=LRBETST_"^"_LRBETNM K LRBEAR
"RTN","LRBEBA4",98,0)
 .D BLRSB(.LRSB,LRBETN_","_LRBEIEN,LRBETST,.LRBEY)
"RTN","LRBEBA4",99,0)
 .D KILL(LRODT,LRSN,LRBETN),SET(DFN,.ORDX,ORSCEI)
"RTN","LRBEBA4",100,0)
 .D SDG1(LRODT,LRSN,LRBETN,DFN,.LRBEAR)
"RTN","LRBEBA4",101,0)
 I 'LRBEFND S LRBERMS="0^"_$$EMSG(3) Q
"RTN","LRBEBA4",102,0)
 I LRBEVST'="",LRAA'="" S LRBERES=1 D BAWRK^LRBEBA(LRODT,LRSN,1,.LRBEY,.LRBEZ,"",LRBEVST,"",ORIEN)
"RTN","LRBEBA4",103,0)
 Q
"RTN","LRBEBA4",104,0)
 ;
"RTN","LRBEBA4",105,0)
KILL(LRBEODT,LRBESN,LRBETN) ; Kill the existing DGX and SC/EI
"RTN","LRBEBA4",106,0)
 N DA,DIK
"RTN","LRBEBA4",107,0)
 S DA(1)=LRBETN,DA(2)=LRSN,DA(3)=LRODT
"RTN","LRBEBA4",108,0)
 S DA="" F  S DA=$O(^LRO(69,DA(3),1,DA(2),2,DA(1),2,DA)) Q:DA=""  D
"RTN","LRBEBA4",109,0)
 .S DIK="^LRO(69,"_DA(3)_","_1_","_DA(2)_","_2_","_DA(1)_","_2_","
"RTN","LRBEBA4",110,0)
 .D ^DIK
"RTN","LRBEBA4",111,0)
 Q
"RTN","LRBEBA4",112,0)
 ;
"RTN","LRBEBA4",113,0)
SET(DFN,ORDX,ORSCEI) ; Set #69 with new DGX and SC/EI
"RTN","LRBEBA4",114,0)
 N LRBEA
"RTN","LRBEBA4",115,0)
 S LRBEA="" F  S LRBEA=$O(ORDX(LRBEA)) Q:LRBEA=""  D
"RTN","LRBEBA4",116,0)
 .S LRBEAR(DFN,"LRBEDGX",LRBEA,$G(ORDX(LRBEA)))="^^^"_ORSCEI
"RTN","LRBEBA4",117,0)
 .S:LRBEA=1 $P(LRBEAR(DFN,"LRBEDGX",LRBEA,$G(ORDX(LRBEA))),U,11)=1
"RTN","LRBEBA4",118,0)
 Q
"RTN","LRBEBA4",119,0)
 ;
"RTN","LRBEBA4",120,0)
SDG1(LRODT,LRSN,LRBETN,DFN,LRBEAR) ; Set the diagnois 
"RTN","LRBEBA4",121,0)
 ;                             and indicators file #69
"RTN","LRBEBA4",122,0)
 N LRBEA,LRBEFIL,LRBEIEN,LRFDA,LRFDAIEN,LRERR,LRBEPDGX,LRBETNUM
"RTN","LRBEBA4",123,0)
 S LRBEFIL=69.05,LRBETNUM=$O(^LRO(69,LRODT,1,LRSN,2,LRBETN,2,""),-1)+1
"RTN","LRBEBA4",124,0)
 S LRBEA="" F  S LRBEA=$O(LRBEAR(DFN,"LRBEDGX",LRBEA)) Q:LRBEA=""  D
"RTN","LRBEBA4",125,0)
 .S LRBEPDGX=""
"RTN","LRBEBA4",126,0)
 .F  S LRBEPDGX=$O(LRBEAR(DFN,"LRBEDGX",LRBEA,LRBEPDGX)) Q:LRBEPDGX=""  D
"RTN","LRBEBA4",127,0)
 ..S LRBEPTDT=$G(LRBEAR(DFN,"LRBEDGX",LRBEA,LRBEPDGX))
"RTN","LRBEBA4",128,0)
 ..S LRBEIEN="+"_LRBETNUM_","_LRBETN_","_LRSN_","_LRODT_","
"RTN","LRBEBA4",129,0)
 ..S LRFDAIEN(LRBETNUM)=LRBETNUM,LRFDA(99,LRBEFIL,LRBEIEN,.01)=LRBEPDGX
"RTN","LRBEBA4",130,0)
 ..S:$P(LRBEPTDT,U,6)'="" LRFDA(99,LRBEFIL,LRBEIEN,1)=$P(LRBEPTDT,U,6)
"RTN","LRBEBA4",131,0)
 ..S:$P(LRBEPTDT,U,10)'="" LRFDA(99,LRBEFIL,LRBEIEN,2)=$P(LRBEPTDT,U,10)
"RTN","LRBEBA4",132,0)
 ..S:$P(LRBEPTDT,U,4)'="" LRFDA(99,LRBEFIL,LRBEIEN,3)=$P(LRBEPTDT,U,4)
"RTN","LRBEBA4",133,0)
 ..S:$P(LRBEPTDT,U,5)'="" LRFDA(99,LRBEFIL,LRBEIEN,4)=$P(LRBEPTDT,U,5)
"RTN","LRBEBA4",134,0)
 ..S:$P(LRBEPTDT,U,7)'="" LRFDA(99,LRBEFIL,LRBEIEN,5)=$P(LRBEPTDT,U,7)
"RTN","LRBEBA4",135,0)
 ..S:$P(LRBEPTDT,U,8)'="" LRFDA(99,LRBEFIL,LRBEIEN,6)=$P(LRBEPTDT,U,8)
"RTN","LRBEBA4",136,0)
 ..S:$P(LRBEPTDT,U,9)'="" LRFDA(99,LRBEFIL,LRBEIEN,7)=$P(LRBEPTDT,U,9)
"RTN","LRBEBA4",137,0)
 ..S:$P(LRBEPTDT,U,11)=1 LRFDA(99,LRBEFIL,LRBEIEN,8)=1         ;Is Primary?
"RTN","LRBEBA4",138,0)
 ..S LRBETNUM=LRBETNUM+1
"RTN","LRBEBA4",139,0)
 D UPDATE^DIE("","LRFDA(99)","LRFDAIEN","LRERR")
"RTN","LRBEBA4",140,0)
 Q
"RTN","LRBEBA4",141,0)
 ;
"RTN","LRBEBA4",142,0)
EMSG(LRBETYP) ; Return Error Message
"RTN","LRBEBA4",143,0)
 N LRBEEMS,LRBETYPN
"RTN","LRBEBA4",144,0)
 S:LRBETYP=1 LRBETYPN="Order Number" S:LRBETYP=2 LRBETYPN="DFN"
"RTN","LRBEBA4",145,0)
 S:LRBETYP=3 LRBETYPN="Orderable Item"
"RTN","LRBEBA4",146,0)
 S LRBEEMS="Possible reasons for failure is the "_LRBETYPN_" did not match."
"RTN","LRBEBA4",147,0)
 Q LRBEEMS
"RTN","LRBEBA4",148,0)
 ;
"RTN","LRBEBA4",149,0)
BLRSB(LRSB,LRBEIENT,LRBETST,LRBEY) ; Build the LRSB global
"RTN","LRBEBA4",150,0)
 N LRBESS,LRBEIDT,LRBESB,LRBEAA,LRBEAD,LRBEAN,LRBEIEN2,LRBET,NX,XX
"RTN","LRBEBA4",151,0)
 S (LRAD,LRBEAD)=$$GET1^DIQ(69.03,LRBEIENT,2,"I")
"RTN","LRBEBA4",152,0)
 S (LRAA,LRBEAA)=$$GET1^DIQ(69.03,LRBEIENT,3,"I") Q:LRAA=""
"RTN","LRBEBA4",153,0)
 S (LRAN,LRBEAN)=$$GET1^DIQ(69.03,LRBEIENT,4,"I")
"RTN","LRBEBA4",154,0)
 S LRBEIEN2=LRBEAN_","_LRBEAD_","_LRBEAA_","
"RTN","LRBEBA4",155,0)
 S (LRSS,LRBESS)=$$GET1^DIQ(68,LRBEAA_",",.02,"I")
"RTN","LRBEBA4",156,0)
 S (LRIDT,LRBEIDT)=$$GET1^DIQ(68.02,LRBEIEN2,13.5,"I")
"RTN","LRBEBA4",157,0)
 S XX=$P($P(^LAB(60,LRBETST,0),U,5),";",2) I XX D
"RTN","LRBEBA4",158,0)
 .S LRSB(XX)=$G(^LR(LRDFN,LRSS,LRIDT,XX))
"RTN","LRBEBA4",159,0)
 .I LRSB(XX)="" K LRSB(XX) Q
"RTN","LRBEBA4",160,0)
 .I "pending^canc"[$P(LRSB(XX),U,1) K LRSB(XX) Q
"RTN","LRBEBA4",161,0)
 .S LRBEY(LRBETST,XX)=""
"RTN","LRBEBA4",162,0)
 S NX=0 F  S NX=$O(^LAB(60,LRBETST,2,NX)) Q:'NX  D
"RTN","LRBEBA4",163,0)
 .S LRBET=+^LAB(60,LRBETST,2,NX,0)
"RTN","LRBEBA4",164,0)
 .S XX=$P($P(^LAB(60,LRBET,0),U,5),";",2) I XX D
"RTN","LRBEBA4",165,0)
 ..S LRSB(XX)=$G(^LR(LRDFN,LRSS,LRIDT,XX))
"RTN","LRBEBA4",166,0)
 ..I LRSB(XX)="" K LRSB(XX) Q
"RTN","LRBEBA4",167,0)
 ..I "pending^canc"[$P(LRSB(XX),U,1) K LRSB(XX) Q
"RTN","LRBEBA4",168,0)
 ..S LRBEY(LRBETST,XX)=""
"RTN","LRBEBA4",169,0)
 Q
"RTN","LRBEBA4",170,0)
 ;
"RTN","LRBEBA4",171,0)
CHKINP(LRDFN,LRBEDAT) ; Check for Inpatient Status)
"RTN","LRBEBA4",172,0)
 N VAIN,VAINDT,LRDPF
"RTN","LRBEBA4",173,0)
 I '$G(DFN) D
"RTN","LRBEBA4",174,0)
 . S DFN=$$GET1^DIQ(63,LRDFN_",",.03,"I")
"RTN","LRBEBA4",175,0)
 . S LRDPF=$$GET1^DIQ(63,LRDFN_",",.02,"I")
"RTN","LRBEBA4",176,0)
 I $G(LRDPF)'=2 Q 0
"RTN","LRBEBA4",177,0)
 S VAINDT=LRBEDAT D INP^VADPT
"RTN","LRBEBA4",178,0)
 Q $G(VAIN(1))
"RTN","LRBEBA4",179,0)
 ;
"RTN","LRBEBA4",180,0)
RFLX() ; Ask the Reflex Question
"RTN","LRBEBA4",181,0)
 N DIR,DUOUT,DTOUT,DIRUT,Y
"RTN","LRBEBA4",182,0)
 S DIR("A")="Is this a Reflex Test? (Y/N): "
"RTN","LRBEBA4",183,0)
 S DIR(0)="YA" D ^DIR
"RTN","LRBEBA4",184,0)
 I $D(DIRUT)!($D(DUOUT)!$D(DTOUT)) Q -1
"RTN","LRBEBA4",185,0)
 Q +Y
"RTN","LRBEBA4",186,0)
 ;
"RTN","LRBEBA4",187,0)
DEFAULT ;Set Default diagnosis
"RTN","LRBEBA4",188,0)
 N LRD,LRI,LRX,LRY,LRD
"RTN","LRBEBA4",189,0)
 S (LRBEDMSG,LRDBEDGX)=""
"RTN","LRBEBA4",190,0)
 S LRI=$O(^LRO(69,LRODT,1,LRSN,2,1,2,0)) Q:LRI<1
"RTN","LRBEBA4",191,0)
 S LRD=$G(^LRO(69,LRODT,1,LRSN,2,1,2,LRI,0))
"RTN","LRBEBA4",192,0)
 Q:'LRD
"RTN","LRBEBA4",193,0)
 S LRDBEDGX=+LRD
"RTN","LRBEBA4",194,0)
 S LRBEDMSG=+LRD_"^^^"_$P(LRD,U,4)_U_$P(LRD,U,5)_U_$P(LRD,U,2)
"RTN","LRBEBA4",195,0)
 S LRBEDMSG=LRBEDMSG_U_$P(LRD,U,6)_U_$P(LRD,U,7)_U_$P(LRD,U,8)
"RTN","LRBEBA4",196,0)
 S LRBEDMSG=LRBEDMSG_U_$P(LRD,U,3)_U_$P(LRD,U,9)
"RTN","LRBEBA4",197,0)
 W:$G(LRDBUG) !,LRBEDMSG
"RTN","LRBEBA4",198,0)
 Q
"RTN","LRBEBA5")
0^48^B50227072
"RTN","LRBEBA5",1,0)
LRBEBA5 ;DALOI/JAH/FHS - PENDING PANEL ROLLUP TO PCE ;11/26/2005
"RTN","LRBEBA5",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRBEBA5",3,0)
 ;
"RTN","LRBEBA5",4,0)
EN ;Entry point from LRNIGHT
"RTN","LRBEBA5",5,0)
 ;check rollup date
"RTN","LRBEBA5",6,0)
 N LRBEROLL,LRBERLDT,DATX,YY,MM,STARTDT,ENDDT,NEWDT,TOTPAN
"RTN","LRBEBA5",7,0)
 S LRBEROLL=0,LRBERLDT=$P(^LAB(69.9,1,"VSIT"),U,2)
"RTN","LRBEBA5",8,0)
 S YY=$E(LRBERLDT,1,3),MM=+$E(LRBERLDT,4,5)
"RTN","LRBEBA5",9,0)
 S MM=$S(MM=1:12,1:MM-1) S YY=$S(MM=12:YY-1,1:YY) I $L(MM)=1 S MM="0"_MM
"RTN","LRBEBA5",10,0)
 S STARTDT=YY_MM_"01",ENDDT=YY_MM_"31"_".999999"
"RTN","LRBEBA5",11,0)
 S DATX=$O(^LRO(69,"APP",0))
"RTN","LRBEBA5",12,0)
 I DATX<STARTDT S STARTDT=DATX-1
"RTN","LRBEBA5",13,0)
 I LRBERLDT=DT S LRBEROLL=1
"RTN","LRBEBA5",14,0)
 I (LRBERLDT<DT) I DATX<ENDDT S LRBEROLL=1
"RTN","LRBEBA5",15,0)
 I LRBEROLL D
"RTN","LRBEBA5",16,0)
 .K ^TMP("LRROLLUP",$J)
"RTN","LRBEBA5",17,0)
 .S ^TMP("LRROLLUP",$J,0)=$$NOW^XLFDT_"^"
"RTN","LRBEBA5",18,0)
 .D START
"RTN","LRBEBA5",19,0)
 .D NEWDT
"RTN","LRBEBA5",20,0)
 .S ^TMP("LRROLLUP",$J,0)=^TMP("LRROLLUP",$J,0)_$$NOW^XLFDT()
"RTN","LRBEBA5",21,0)
 .D MAILRPT
"RTN","LRBEBA5",22,0)
 Q
"RTN","LRBEBA5",23,0)
 ;
"RTN","LRBEBA5",24,0)
START ;Loop thru pending panel xref in file #69
"RTN","LRBEBA5",25,0)
 N LINE,LRXDT,LRODT,LRSN,LRTN
"RTN","LRBEBA5",26,0)
 S LINE=100,TOTPAN=0
"RTN","LRBEBA5",27,0)
 S LRXDT=STARTDT F  S LRXDT=$O(^LRO(69,"APP",LRXDT)) Q:'LRXDT  Q:LRXDT>ENDDT  D
"RTN","LRBEBA5",28,0)
 .S LRODT=0 F  S LRODT=$O(^LRO(69,"APP",LRXDT,LRODT)) Q:'LRODT  D
"RTN","LRBEBA5",29,0)
 ..S LRSN=0 F  S LRSN=$O(^LRO(69,"APP",LRXDT,LRODT,LRSN)) Q:'LRSN  D
"RTN","LRBEBA5",30,0)
 ...S LRTN=0 F  S LRTN=$O(^LRO(69,"APP",LRXDT,LRODT,LRSN,LRTN)) Q:'LRTN  D
"RTN","LRBEBA5",31,0)
 ....D SET
"RTN","LRBEBA5",32,0)
 ....I $D(LRBEY)>1 D BAWRK^LRBEBA(LRODT,LRSN,LRTN,.LRBEY,.LRTEST,"","",LRBEROLL)
"RTN","LRBEBA5",33,0)
 ....I $D(LRBECPT)>1 D SETRPT
"RTN","LRBEBA5",34,0)
 ....D CLEAN
"RTN","LRBEBA5",35,0)
 Q
"RTN","LRBEBA5",36,0)
 ;
"RTN","LRBEBA5",37,0)
SET ;Setup background variables for call to BAWRK^LRBEBA
"RTN","LRBEBA5",38,0)
 N LRBET,LRBEIEN,LRFDA,I,NX,XX
"RTN","LRBEBA5",39,0)
 S LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEBA5",40,0)
 S LRDFN=$$GET1^DIQ(69.01,LRBEIEN,.01,"I")
"RTN","LRBEBA5",41,0)
 S LRORDER=$$GET1^DIQ(69.01,LRBEIEN,9.5,"I")
"RTN","LRBEBA5",42,0)
 S LRBEIEN=LRTN_","_LRSN_","_LRODT_","
"RTN","LRBEBA5",43,0)
 I $$GET1^DIQ(69.03,LRBEIEN,8,"I")="CA" D  Q
"RTN","LRBEBA5",44,0)
 .;clear 'pending panel' xref of not performed panel
"RTN","LRBEBA5",45,0)
 .S LRFDA(1,69.03,LRBEIEN,22.1)=0
"RTN","LRBEBA5",46,0)
 .D FILE^DIE("KS","LRFDA(1)","ERR")
"RTN","LRBEBA5",47,0)
 S LRBETST=$$GET1^DIQ(69.03,LRBEIEN,.01,"I")
"RTN","LRBEBA5",48,0)
 S LRAD=$$GET1^DIQ(69.03,LRBEIEN,2,"I")
"RTN","LRBEBA5",49,0)
 S LRAA=$$GET1^DIQ(69.03,LRBEIEN,3,"I")
"RTN","LRBEBA5",50,0)
 S LRAN=$$GET1^DIQ(69.03,LRBEIEN,4,"I")
"RTN","LRBEBA5",51,0)
 S LRUID=$$GET1^DIQ(69.03,LRBEIEN,13,"I")
"RTN","LRBEBA5",52,0)
 S LRBECDT=$$GET1^DIQ(69.03,LRBEIEN,22,"I")
"RTN","LRBEBA5",53,0)
 S LRBEDFN=$$GET1^DIQ(63,LRDFN,.03,"I")
"RTN","LRBEBA5",54,0)
 S LRSS=$$GET1^DIQ(68,LRAA,.02,"I")
"RTN","LRBEBA5",55,0)
 Q:'$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRBETST,0))
"RTN","LRBEBA5",56,0)
 S LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5)
"RTN","LRBEBA5",57,0)
 S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,5,0))
"RTN","LRBEBA5",58,0)
 I I S X=^LRO(68,LRAA,1,LRAD,1,LRAN,5,I,0),LRSPEC=$P(X,U,1),LRSAMP=$P(X,U,2)
"RTN","LRBEBA5",59,0)
 S NX=0 F  S NX=$O(^LAB(60,LRBETST,2,NX)) Q:'NX  D
"RTN","LRBEBA5",60,0)
 .S LRBET=+^LAB(60,LRBETST,2,NX,0)
"RTN","LRBEBA5",61,0)
 .S XX=$P($P(^LAB(60,LRBET,0),U,5),";",2)
"RTN","LRBEBA5",62,0)
 .;if null XX, possibly another panel
"RTN","LRBEBA5",63,0)
 .I 'XX D ARRS(LRBET,LRBETST) Q
"RTN","LRBEBA5",64,0)
 .S LRSB(XX)=$G(^LR(LRDFN,LRSS,LRIDT,XX))
"RTN","LRBEBA5",65,0)
 .I LRSB(XX)="" K LRSB(XX) Q
"RTN","LRBEBA5",66,0)
 .I "pending^canc"[$P(LRSB(XX),U,1) K LRSB(XX) Q
"RTN","LRBEBA5",67,0)
 .I $P(LRSB(XX),U,13) K LRSB(XX) Q
"RTN","LRBEBA5",68,0)
 .S LRBEY(LRBETST,XX)=""
"RTN","LRBEBA5",69,0)
 I $D(LRBEY)>1 D
"RTN","LRBEBA5",70,0)
 .S LRTEST(1)=LRBETST_U_^LAB(60,LRBETST,0),LRTEST(1,"P")=LRBETST_U_$$NLT^LRVER1(LRBETST)
"RTN","LRBEBA5",71,0)
 Q
"RTN","LRBEBA5",72,0)
 ;
"RTN","LRBEBA5",73,0)
ARRS(XTEST,PTEST) ;
"RTN","LRBEBA5",74,0)
 N NX,X,XX
"RTN","LRBEBA5",75,0)
 S NX=0 F  S NX=$O(^LAB(60,XTEST,2,NX)) Q:'NX  D
"RTN","LRBEBA5",76,0)
 .S X=+^LAB(60,XTEST,2,NX,0)
"RTN","LRBEBA5",77,0)
 .S XX=$P($P(^LAB(60,X,0),U,5),";",2)
"RTN","LRBEBA5",78,0)
 .Q:'XX
"RTN","LRBEBA5",79,0)
 .S LRSB(XX)=$G(^LR(LRDFN,LRSS,LRIDT,XX))
"RTN","LRBEBA5",80,0)
 .I LRSB(XX)="" K LRSB(XX) Q
"RTN","LRBEBA5",81,0)
 .I "pending^canc"[$P(LRSB(XX),U,1) K LRSB(XX) Q
"RTN","LRBEBA5",82,0)
 .I $P(LRSB(XX),U,13) K LRSB(XX) Q
"RTN","LRBEBA5",83,0)
 .S LRBEY(PTEST,XX)=""
"RTN","LRBEBA5",84,0)
 Q
"RTN","LRBEBA5",85,0)
 ;
"RTN","LRBEBA5",86,0)
CLEAN ;Clean-up variables
"RTN","LRBEBA5",87,0)
 K DFN,LRBEY,LRTEST,LRSB,LRBECPT,LRDFN,LRBEDFN,LRORDER
"RTN","LRBEBA5",88,0)
 K LRBETST,LRBEVST,LRAA,LRAN,LRAD,LRUID,LRBECDT,LRSS,LRIDT,LRSAMP,LRSPEC
"RTN","LRBEBA5",89,0)
 Q
"RTN","LRBEBA5",90,0)
 ;
"RTN","LRBEBA5",91,0)
SETRPT ;Set veriables into ^TMP( for report
"RTN","LRBEBA5",92,0)
 N SETLN,X,C,N,T,TNM,XCODE,LRPCE,LRBETST,LRBETSTN
"RTN","LRBEBA5",93,0)
 S TOTPAN=TOTPAN+1
"RTN","LRBEBA5",94,0)
 S SETLN="S LINE=LINE+1,^TMP(""LRROLLUP"",$J,LINE,0)=X"
"RTN","LRBEBA5",95,0)
 S LRPCE=$P(^LRO(69,LRODT,1,LRSN,"PCE"),U,1)
"RTN","LRBEBA5",96,0)
 Q:LRPCE=""
"RTN","LRBEBA5",97,0)
 S LRBETST=$P(LRTEST(1),U,1)
"RTN","LRBEBA5",98,0)
 S LRBETSTN=$P(^LAB(60,LRBETST,0),U,1),LRBETSTN="["_LRBETST_"] "_$E(LRBETSTN,1,30)
"RTN","LRBEBA5",99,0)
 S X=$$SETSTR^VALM1(LRORDER,"",1,10),X=$$SETSTR^VALM1(LRUID,X,12,10)
"RTN","LRBEBA5",100,0)
 S X=$$SETSTR^VALM1(LRPCE,X,26,10),X=$$SETSTR^VALM1(LRBETSTN,X,40,38) X SETLN
"RTN","LRBEBA5",101,0)
 S T=0,N=0 F  S T=$O(LRBECPT(T)) Q:'T  D
"RTN","LRBEBA5",102,0)
 . S N=N+1,TNM="["_T_"] "
"RTN","LRBEBA5",103,0)
 . I N=1 S X=$$SETSTR^VALM1("CPT Code(s) passed to PCE:","",12,28)
"RTN","LRBEBA5",104,0)
 . I N>1 S X=""
"RTN","LRBEBA5",105,0)
 . S C=$O(LRBECPT(T,1,0)),XCODE=$P($$CPT^ICPTCOD(C),U,2,3),XCODE=$TR(XCODE,"^"," "),XCODE=$E(XCODE,1,30)
"RTN","LRBEBA5",106,0)
 . S XCODE=TNM_XCODE,X=$$SETSTR^VALM1(XCODE,X,40,38) X SETLN
"RTN","LRBEBA5",107,0)
 S X=" " X SETLN
"RTN","LRBEBA5",108,0)
 Q
"RTN","LRBEBA5",109,0)
 ;
"RTN","LRBEBA5",110,0)
NEWDT ;Set new roll-up date
"RTN","LRBEBA5",111,0)
 N DD,MM,MM2,X1,X,YY
"RTN","LRBEBA5",112,0)
 Q:'$G(LRBERLDT)
"RTN","LRBEBA5",113,0)
 S MM=+$E(LRBERLDT,4,5) S MM2=$S(MM=12:1,1:MM+1) S:$L(MM2)=1 MM2="0"_MM2
"RTN","LRBEBA5",114,0)
 S DD=$E(LRBERLDT,6,7) S YY=$E(LRBERLDT,1,3) S:+MM2=1 YY=YY+1
"RTN","LRBEBA5",115,0)
 S NEWDT=YY_MM2_DD
"RTN","LRBEBA5",116,0)
 S X1=NEWDT,X=+$E(NEWDT,4,5),X=$S("^1^3^5^7^8^10^12^"[(U_X_U):31,X'=2:30,$E(X1,1,3)#4:28,1:29)
"RTN","LRBEBA5",117,0)
 I $E(X1,6,7)'<X S $E(NEWDT,6,7)=X-1
"RTN","LRBEBA5",118,0)
 S $P(^LAB(69.9,1,"VSIT"),U,2)=NEWDT
"RTN","LRBEBA5",119,0)
 Q
"RTN","LRBEBA5",120,0)
 ;
"RTN","LRBEBA5",121,0)
MAILRPT ;Set intro & send rollup report to mail group
"RTN","LRBEBA5",122,0)
 N XMY,XMSUB,XMDUZ,XMTEXT,XMZ,X,X1,Y,SETLN,LINE,DASH
"RTN","LRBEBA5",123,0)
 S ENDDT=$P(ENDDT,".",1),X=ENDDT D
"RTN","LRBEBA5",124,0)
 .S X1=X,X=+$E(X,4,5),X=$S("^1^3^5^7^8^10^12^"[(U_X_U):31,X'=2:30,$E(X1,1,3)#4:28,1:29)
"RTN","LRBEBA5",125,0)
 .I $E(X1,6,7)>X S $E(ENDDT,6,7)=X
"RTN","LRBEBA5",126,0)
 S LINE=0,SETLN="S LINE=LINE+1,^TMP(""LRROLLUP"",$J,LINE,0)=X"
"RTN","LRBEBA5",127,0)
 S $P(DASH,"-",78)=""
"RTN","LRBEBA5",128,0)
 S X=" " X SETLN
"RTN","LRBEBA5",129,0)
 S X="Normally, panel tests flagged as 'AMA/Billable' should be reported to PCE" X SETLN
"RTN","LRBEBA5",130,0)
 S X="using the CPT Code of the panel.  In order for the panel CPT Code to be" X SETLN
"RTN","LRBEBA5",131,0)
 S X="sent to PCE, a verified result must be present for each 'required' atomic" X SETLN
"RTN","LRBEBA5",132,0)
 S X="test comprising the panel." X SETLN
"RTN","LRBEBA5",133,0)
 S X=" " X SETLN
"RTN","LRBEBA5",134,0)
 S X="This report provides a listing of AMA/Billable panel tests that were pending" X SETLN
"RTN","LRBEBA5",135,0)
 S X="completion on the Lab Roll-up Date.  The Sample Collection Date for the" X SETLN
"RTN","LRBEBA5",136,0)
 S X="panel test fell within the date range indicated by Start Date and End Date." X SETLN
"RTN","LRBEBA5",137,0)
 S X="One or more of the 'required' atomic tests comprising the panel were still" X SETLN
"RTN","LRBEBA5",138,0)
 S X="pending on the Lab Roll-up Date.  Therefore, those atomic tests that had" X SETLN
"RTN","LRBEBA5",139,0)
 S X="been verified have now been sent to PCE.  If other atomic tests from the" X SETLN
"RTN","LRBEBA5",140,0)
 S X="panels listed are verified later, each will be sent to PCE using the CPT" X SETLN
"RTN","LRBEBA5",141,0)
 S X="Code for the atomic test." X SETLN
"RTN","LRBEBA5",142,0)
 S X=" " X SETLN
"RTN","LRBEBA5",143,0)
 S X=" " X SETLN
"RTN","LRBEBA5",144,0)
 S Y=LRBERLDT D DD^%DT S LRBERLDT=Y
"RTN","LRBEBA5",145,0)
 S X="Lab Roll-up Date         : "_LRBERLDT X SETLN
"RTN","LRBEBA5",146,0)
 S Y=NEWDT D DD^%DT S NEWDT=Y
"RTN","LRBEBA5",147,0)
 S X="Next Lab Roll-up Date    : "_NEWDT X SETLN
"RTN","LRBEBA5",148,0)
 S Y=STARTDT D DD^%DT S STARTDT=Y
"RTN","LRBEBA5",149,0)
 S X="Start Date               : "_STARTDT X SETLN
"RTN","LRBEBA5",150,0)
 S Y=ENDDT D DD^%DT S ENDDT=Y
"RTN","LRBEBA5",151,0)
 S X="End Date                 : "_ENDDT X SETLN
"RTN","LRBEBA5",152,0)
 S X="Total # Panels           : "_TOTPAN X SETLN
"RTN","LRBEBA5",153,0)
 S X=" " X SETLN
"RTN","LRBEBA5",154,0)
 S X=" " X SETLN
"RTN","LRBEBA5",155,0)
 S X=$$SETSTR^VALM1("Unique","",12,10),X=$$SETSTR^VALM1("PCE",X,26,10) X SETLN
"RTN","LRBEBA5",156,0)
 S X=$$SETSTR^VALM1("Order #","",1,10),X=$$SETSTR^VALM1("Identifier",X,12,10),X=$$SETSTR^VALM1("Encounter",X,26,10)
"RTN","LRBEBA5",157,0)
 S X=$$SETSTR^VALM1("Panel Test",X,40,38) X SETLN
"RTN","LRBEBA5",158,0)
 S X=$$SETSTR^VALM1(DASH,"",1,78) X SETLN
"RTN","LRBEBA5",159,0)
 S Y=DT D DD^%DT S XMSUB="Report on Roll-up to PCE for "_Y
"RTN","LRBEBA5",160,0)
 S XMDUZ=.5
"RTN","LRBEBA5",161,0)
 S XMY("G.LMI")=""
"RTN","LRBEBA5",162,0)
 S XMTEXT="^TMP(""LRROLLUP"",$J,"
"RTN","LRBEBA5",163,0)
 D ^XMD
"RTN","LRBEBA5",164,0)
 K ^TMP("LRROLLUP",$J)
"RTN","LRBEBA5",165,0)
 Q
"RTN","LRBEBAO")
0^32^B68648424
"RTN","LRBEBAO",1,0)
LRBEBAO ;DALOI/JAH/FHS - ORDERING AND RESULTING FOR OUTPATIENTS ;8/10/04
"RTN","LRBEBAO",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRBEBAO",3,0)
 ;
"RTN","LRBEBAO",4,0)
 ; This routine contains the subroutines that get the diagnosis pointers
"RTN","LRBEBAO",5,0)
 ; and indicators at order entry and result verification for outpatient.
"RTN","LRBEBAO",6,0)
 ;
"RTN","LRBEBAO",7,0)
 ; Reference to EN^DDIOL supported by IA #10142
"RTN","LRBEBAO",8,0)
 ; Reference to ^DIC supported by IA #10006
"RTN","LRBEBAO",9,0)
 ; Reference to $$GET1^DIQ supported by IA #2056
"RTN","LRBEBAO",10,0)
 ; Reference to ^DIR supported by IA #10026
"RTN","LRBEBAO",11,0)
 ; Reference to ^ICD9 supported by IA #10082
"RTN","LRBEBAO",12,0)
 ; Reference to ^DIC(9.4 supported by IA #10048
"RTN","LRBEBAO",13,0)
 ; Reference to ^DIC(81.3 supported by IA #2816
"RTN","LRBEBAO",14,0)
 ;
"RTN","LRBEBAO",15,0)
OPORD ; Outpatient Order Entry
"RTN","LRBEBAO",16,0)
 ;
"RTN","LRBEBAO",17,0)
 ; Input:
"RTN","LRBEBAO",18,0)
 ;  LRBEDFN    - Patient's DFN (#2)
"RTN","LRBEBAO",19,0)
 ;  LRBESMP    - Sample
"RTN","LRBEBAO",20,0)
 ;  LRBESPC    - Specimen
"RTN","LRBEBAO",21,0)
 ;  LRBETST    - Ordered Test
"RTN","LRBEBAO",22,0)
 ;  LRBEDGX    - Pointer to Diagnosis (#80)
"RTN","LRBEBAO",23,0)
 ;  LRBEAR(LRBEDFN,"DOS")      - Date of Service
"RTN","LRBEBAO",24,0)
 ;  LRBEAR(LRBEDFN,"PAT")      - Patient DFN (#2)
"RTN","LRBEBAO",25,0)
 ;  LRBEAR(LRBEDFN,"POS")      - Place of Service
"RTN","LRBEBAO",26,0)
 ;  LRBEAR(LRBEDFN,"ORDGX")    - Ordering or Resulting Diagnosis
"RTN","LRBEBAO",27,0)
 ;  LRBEAR(LRBEDFN,"USR")      - User
"RTN","LRBEBAO",28,0)
 ;  LRBEAR(LRBEDFN,"ORDPRO")    - Ordering Provider
"RTN","LRBEBAO",29,0)
 ;  LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,LRBEDGX)
"RTN","LRBEBAO",30,0)
 ;   Piece     Desc
"RTN","LRBEBAO",31,0)
 ;   -----     ---------------------------------
"RTN","LRBEBAO",32,0)
 ;   1     -   Diagnosis
"RTN","LRBEBAO",33,0)
 ;   2     -   Unused (blank)
"RTN","LRBEBAO",34,0)
 ;   3     -   Textual Description of  Diagnosis
"RTN","LRBEBAO",35,0)
 ;   4     -   Agent Orange
"RTN","LRBEBAO",36,0)
 ;   5     -   Ionizing Radiation
"RTN","LRBEBAO",37,0)
 ;   6     -   Service Connected Indicator
"RTN","LRBEBAO",38,0)
 ;   7     -   Environmental Contaminamts
"RTN","LRBEBAO",39,0)
 ;   8     -   MST (Military Sexual Tramua)
"RTN","LRBEBAO",40,0)
 ;   9     -   Head and Neck Cancer
"RTN","LRBEBAO",41,0)
 ;   10    -   Combat Veteran
"RTN","LRBEBAO",42,0)
 ;
"RTN","LRBEBAO",43,0)
 ; Output:
"RTN","LRBEBAO",44,0)
 ;  LRBEAR1(VISIT,TST,LRBEPOV)=LRBEDGX
"RTN","LRBEBAO",45,0)
 ;   VISIT      -  Pointer to VISIT (9000010) file
"RTN","LRBEBAO",46,0)
 ;   TST        -  Ordered Test
"RTN","LRBEBAO",47,0)
 ;   LRBEPOV        -  Pointer to V POV (#9000010.07) file
"RTN","LRBEBAO",48,0)
 ;   LRBEDGX        -  Pointer to Diagnosis (#80)
"RTN","LRBEBAO",49,0)
EN ;
"RTN","LRBEBAO",50,0)
 D INIT
"RTN","LRBEBAO",51,0)
 S SUB1="ENCOUNTER",SUB2="DX/PL",SUB3="PROVIDER"
"RTN","LRBEBAO",52,0)
 S LRBEDFN="" F  S LRBEDFN=$O(LRBEAR(LRBEDFN)) Q:LRBEDFN=""  D
"RTN","LRBEBAO",53,0)
 .S LRBETM=$S($P($G(LRBECDT),".",2):LRBECDT,$G(LRCDT):LRCDT,1:DT)
"RTN","LRBEBAO",54,0)
 .S LRBETM=$$PCETM(LRBETM)
"RTN","LRBEBAO",55,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"ENC D/T")=LRBETM
"RTN","LRBEBAO",56,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"DSS ID")=LROOS
"RTN","LRBEBAO",57,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"HOS LOC")=$G(LRBEAR(LRBEDFN,"POS"))
"RTN","LRBEBAO",58,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"PATIENT")=$G(LRBEAR(LRBEDFN,"PAT"))
"RTN","LRBEBAO",59,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"SERVICE CATEGORY")="X"
"RTN","LRBEBAO",60,0)
 .S ^TMP("LRPXAPI",$J,SUB1,1,"ENCOUNTER TYPE")="A"
"RTN","LRBEBAO",61,0)
 .S ^TMP("LRPXAPI",$J,SUB3,1,"NAME")=$G(LRBEAR(LRBEDFN,"ORDPRO"))
"RTN","LRBEBAO",62,0)
 .S ^TMP("LRPXAPI",$J,SUB3,1,"PRIMARY")=1
"RTN","LRBEBAO",63,0)
 .I $G(LRBEAR(LRBEDFN,"DEL")) D
"RTN","LRBEBAO",64,0)
 ..S ^TMP("LRPXAPI",$J,SUB1,1,"DELETE")=$G(LRBEAR(LRBEDFN,"DEL"))
"RTN","LRBEBAO",65,0)
 .S LRBESMP=""
"RTN","LRBEBAO",66,0)
 .F  S LRBESMP=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP)) Q:LRBESMP=""  D
"RTN","LRBEBAO",67,0)
 ..S LRBESPC=""
"RTN","LRBEBAO",68,0)
 ..F  S LRBESPC=+$O(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC)) Q:LRBESPC<1  D
"RTN","LRBEBAO",69,0)
 ...D OPWRK
"RTN","LRBEBAO",70,0)
 Q
"RTN","LRBEBAO",71,0)
 ;
"RTN","LRBEBAO",72,0)
OPWRK ; More Outpatient Work
"RTN","LRBEBAO",73,0)
 N X,XX,B,BG,N,DX,LRBEDIA
"RTN","LRBEBAO",74,0)
 ;get all primary (n=1) and secondary (n=2) dx
"RTN","LRBEBAO",75,0)
 S LRBETST="" F  S LRBETST=$O(LRBECPT(LRBETST)) Q:'LRBETST  D
"RTN","LRBEBAO",76,0)
 . S LRBETNUM=0 F  S LRBETNUM=$O(LRBECPT(LRBETST,LRBETNUM)) Q:LRBETNUM<1  D
"RTN","LRBEBAO",77,0)
 . . S LRBEDGX=""
"RTN","LRBEBAO",78,0)
 . . F  S LRBEDGX=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,LRBEDGX)) Q:LRBEDGX=""  D
"RTN","LRBEBAO",79,0)
 . . . S LRBEPTDT=$G(LRBEAR(LRBEDFN,"LRBEDGX",LRBESMP,LRBESPC,LRBETST,LRBEDGX))
"RTN","LRBEBAO",80,0)
 . . . S N=$S($P(LRBEPTDT,U,11):1,1:2),X=$P(LRBEPTDT,U,4,10)
"RTN","LRBEBAO",81,0)
 . . . ;collapse indicators for same dx
"RTN","LRBEBAO",82,0)
 . . . S XX=$G(DX(N,LRBEDGX))
"RTN","LRBEBAO",83,0)
 . . . F B=1:1:7 I $P(XX,U,B)'=1,$P(X,U,B)'="" S $P(XX,U,B)=$P(X,U,B)
"RTN","LRBEBAO",84,0)
 . . . S DX(N,LRBEDGX)=XX
"RTN","LRBEBAO",85,0)
 ;set primary dx in PCE array
"RTN","LRBEBAO",86,0)
 S LRBEDGX=""
"RTN","LRBEBAO",87,0)
 F  S LRBEDGX=$O(DX(1,LRBEDGX)) Q:LRBEDGX=""  D
"RTN","LRBEBAO",88,0)
 . S LRBEDIA=$G(LRBEDIA)+1,XX=DX(1,LRBEDGX)
"RTN","LRBEBAO",89,0)
 . S ^TMP("LRPXAPI",$J,SUB2,LRBEDIA,"DIAGNOSIS")=LRBEDGX
"RTN","LRBEBAO",90,0)
 . S ^TMP("LRPXAPI",$J,SUB2,LRBEDIA,"PRIMARY")=1
"RTN","LRBEBAO",91,0)
 . F B=1:1:7 I $P(XX,U,B)'="" D
"RTN","LRBEBAO",92,0)
 . . S BG=$$GETT(B)
"RTN","LRBEBAO",93,0)
 . . I '$G(^TMP("LRPXAPI",$J,SUB2,LRBEDIA,BG)) S ^TMP("LRPXAPI",$J,SUB2,LRBEDIA,BG)=$P(XX,U,B)
"RTN","LRBEBAO",94,0)
 . . ;collapse dx indicators into encounter node
"RTN","LRBEBAO",95,0)
 . . I '$G(^TMP("LRPXAPI",$J,SUB1,1,$P(BG," ",2))) S ^TMP("LRPXAPI",$J,SUB1,1,$P(BG," ",2))=$P(XX,U,B)
"RTN","LRBEBAO",96,0)
 ;set secondary dx in PCE array
"RTN","LRBEBAO",97,0)
 S LRBEDGX=""
"RTN","LRBEBAO",98,0)
 F  S LRBEDGX=$O(DX(2,LRBEDGX)) Q:LRBEDGX=""  D
"RTN","LRBEBAO",99,0)
 . S LRBEDIA=$G(LRBEDIA)+1,XX=DX(2,LRBEDGX)
"RTN","LRBEBAO",100,0)
 . S ^TMP("LRPXAPI",$J,SUB2,LRBEDIA,"DIAGNOSIS")=LRBEDGX
"RTN","LRBEBAO",101,0)
 . F B=1:1:7 I $P(XX,U,B)'="" D
"RTN","LRBEBAO",102,0)
 . . S BG=$$GETT(B)
"RTN","LRBEBAO",103,0)
 . . I '$G(^TMP("LRPXAPI",$J,SUB2,LRBEDIA,BG)) S ^TMP("LRPXAPI",$J,SUB2,LRBEDIA,BG)=$P(XX,U,B)
"RTN","LRBEBAO",104,0)
 . . ;collapse dx indicators into encounter node
"RTN","LRBEBAO",105,0)
 . . I '$G(^TMP("LRPXAPI",$J,SUB1,1,$P(BG," ",2))) S ^TMP("LRPXAPI",$J,SUB1,1,$P(BG," ",2))=$P(XX,U,B)
"RTN","LRBEBAO",106,0)
 Q
"RTN","LRBEBAO",107,0)
 ;
"RTN","LRBEBAO",108,0)
GETT(X) ; Indicators for ^TMP
"RTN","LRBEBAO",109,0)
 I '+X Q ""
"RTN","LRBEBAO",110,0)
 Q "PL "_$S(X=1:"AO",X=2:"IR",X=3:"SC",X=4:"EC",X=5:"MST",X=6:"HNC",1:"CV")
"RTN","LRBEBAO",111,0)
 ;
"RTN","LRBEBAO",112,0)
OPRES(LRBEAR,LRBEAR1,LRODT,LRSN,LRBEVST) ; Outpatient Final Resulting
"RTN","LRBEBAO",113,0)
 ;
"RTN","LRBEBAO",114,0)
 ; Inputs:
"RTN","LRBEBAO",115,0)
 ;  LRBEDFN   -  Patient's DFN
"RTN","LRBEBAO",116,0)
 ;  LRBEDN    -  Data Number of Test in #63 field 400
"RTN","LRBEBAO",117,0)
 ;  VISIT     -  Patient's Encounter Number #9000010
"RTN","LRBEBAO",118,0)
 ;  LRBEAR(LRBEDFN,"VST")     -  Patient's Encounter Number #9000010
"RTN","LRBEBAO",119,0)
 ;  LRBEAR(LRBEDFN,"LRBEDGX",LRBEDN)
"RTN","LRBEBAO",120,0)
 ;   Piece     Desc
"RTN","LRBEBAO",121,0)
 ;   -----     ---------------------------------
"RTN","LRBEBAO",122,0)
 ;   1     -   Procedure (CPT)
"RTN","LRBEBAO",123,0)
 ;   2     -   Modifiers (Sub-delimited by "~")
"RTN","LRBEBAO",124,0)
 ;   3     -   Diagnosis
"RTN","LRBEBAO",125,0)
 ;   4     -   Diagnosis 2
"RTN","LRBEBAO",126,0)
 ;   5     -   Diagnosis 3
"RTN","LRBEBAO",127,0)
 ;   6     -   Diagnosis 4
"RTN","LRBEBAO",128,0)
 ;   7     -   Event D/T  (DOS)
"RTN","LRBEBAO",129,0)
 ;   8     -   Encounter Provider
"RTN","LRBEBAO",130,0)
 ;   9     -   Ordering Provider
"RTN","LRBEBAO",131,0)
 ;   10    -   Quantity (Number of times procedure was performed)
"RTN","LRBEBAO",132,0)
 ;   11    -   Place of Service
"RTN","LRBEBAO",133,0)
 ; 
"RTN","LRBEBAO",134,0)
 ; Output:
"RTN","LRBEBAO",135,0)
 ;  LRBEAR1(VISIT,TST,LRBEPOV)=LRBEDGX
"RTN","LRBEBAO",136,0)
 ;   VISIT      -  Pointer to VISIT (9000010) file
"RTN","LRBEBAO",137,0)
 ;   TST        -  Ordered Test
"RTN","LRBEBAO",138,0)
 ;   LRBEPOV        -  Pointer to V POV (#9000010.07) file
"RTN","LRBEBAO",139,0)
 ;   LRBEDGX        -  Pointer to Diagnosis (#80)
"RTN","LRBEBAO",140,0)
 ;
"RTN","LRBEBAO",141,0)
 D INIT
"RTN","LRBEBAO",142,0)
 N LRSWSTAT,LRSWDATE
"RTN","LRBEBAO",143,0)
 S LRSWSTAT=$$SWSTAT^IBBAPI
"RTN","LRBEBAO",144,0)
 S LRSWDATE=+$P(LRSWSTAT,U,2)
"RTN","LRBEBAO",145,0)
 S LRSWSTAT=+$P(LRSWSTAT,U)
"RTN","LRBEBAO",146,0)
 S SUB1="PROCEDURE"
"RTN","LRBEBAO",147,0)
 I '$G(LRDBEDGX) D
"RTN","LRBEBAO",148,0)
 . N LRX
"RTN","LRBEBAO",149,0)
 . S (LRDBEDGX,LRX)=0
"RTN","LRBEBAO",150,0)
 . F  S LRX=$O(^LRO(69,LRODT,1,LRSN,2,LRX)) Q:LRX<1!($G(LRDBEDGX))  D
"RTN","LRBEBAO",151,0)
 . . ;set a default diagnosis and sc/ei indicators
"RTN","LRBEBAO",152,0)
 . . I $G(^LRO(69,LRODT,1,LRSN,2,LRX,2,1,0)) S LRDBEDGX=+^(0)
"RTN","LRBEBAO",153,0)
 S LRBEDFN="" F  S LRBEDFN=$O(LRBEAR(LRBEDFN)) Q:LRBEDFN=""  D
"RTN","LRBEBAO",154,0)
 . S LRI=0 F  S LRI=$O(LRBEAR(LRBEDFN,"LRBEDGX",LRI)) Q:LRI<1  D
"RTN","LRBEBAO",155,0)
 . . D OPWRK2
"RTN","LRBEBAO",156,0)
 D SEND
"RTN","LRBEBAO",157,0)
 Q
"RTN","LRBEBAO",158,0)
SEND ; Send if procedure is defined
"RTN","LRBEBAO",159,0)
 N LRLNOW,LRVX,PXALOOK,PXUCV
"RTN","LRBEBAO",160,0)
 I '$G(^TMP("LRPXAPI",$J,"PROCEDURE",1,"PROCEDURE")) G END
"RTN","LRBEBAO",161,0)
 I $G(^XTMP("LRPCELOG",0)) D
"RTN","LRBEBAO",162,0)
 . F  S LRLNOW=$$NOW^XLFDT Q:'$D(^XTMP("LRPCELOG",1,LRLNOW))
"RTN","LRBEBAO",163,0)
 . N LRACCX,LRUIDX
"RTN","LRBEBAO",164,0)
 . S LRACCX=$G(LRACC),LRUIDX=$G(LRUID)
"RTN","LRBEBAO",165,0)
 . M ^XTMP("LRPCELOG",2,LRLNOW)=^TMP("LRPXAPI",$J)
"RTN","LRBEBAO",166,0)
 . S ^XTMP("LRPCELOG",2,LRLNOW,0)=LRACCX_U_LRUIDX
"RTN","LRBEBAO",167,0)
 S LRVX=$$DATA2PCE^PXAPI(INROOT,LRPKG,SRC,.LRBEVSIT,USR,ERRDIS)
"RTN","LRBEBAO",168,0)
 I $D(^XTMP("LRPCELOG",2,+$G(LRLNOW),0)) D
"RTN","LRBEBAO",169,0)
 . S $P(^XTMP("LRPCELOG",2,+$G(LRLNOW),0),U,3,4)=LRVX_U_LRBEVSIT
"RTN","LRBEBAO",170,0)
 . M ^XTMP("LRPCELOG",2,LRLNOW)=^TMP("LRPXAPI",$J)
"RTN","LRBEBAO",171,0)
 I $G(LRBEVSIT) D SVST^LRBEBA3(LRBEVSIT,"PCE",LRODT,LRSN)
"RTN","LRBEBAO",172,0)
END K ^TMP("LRPXAPI",$J),LRBETNUM
"RTN","LRBEBAO",173,0)
 Q
"RTN","LRBEBAO",174,0)
 ;
"RTN","LRBEBAO",175,0)
OPWRK2 ; Outpatient Work Two
"RTN","LRBEBAO",176,0)
 K LRBEPTDT
"RTN","LRBEBAO",177,0)
 S LRBEDN=0 F  S LRBEDN=+$O(LRBEAR(LRBEDFN,"LRBEDGX",LRI,LRBEDN)) Q:LRBEDN<1  D OPWRK3
"RTN","LRBEBAO",178,0)
 Q
"RTN","LRBEBAO",179,0)
OPWRK3 ;
"RTN","LRBEBAO",180,0)
 N JJ
"RTN","LRBEBAO",181,0)
 S LRBEPTDT=$G(LRBEAR(LRBEDFN,"LRBEDGX",LRI,LRBEDN))
"RTN","LRBEBAO",182,0)
 Q:'($L(LRBEPTDT))
"RTN","LRBEBAO",183,0)
 I '$P(LRBEPTDT,U,3) D
"RTN","LRBEBAO",184,0)
 .S $P(LRBEPTDT,U,3)=LRDBEDGX
"RTN","LRBEBAO",185,0)
 .S JJ=$O(^TMP("LRPXAPI",$J,"DX/PL",99),-1)+1
"RTN","LRBEBAO",186,0)
 .S ^TMP("LRPXAPI",$J,"DX/PL",JJ,"DIAGNOSIS")=LRDBEDGX
"RTN","LRBEBAO",187,0)
 .I JJ=1 S ^TMP("LRPXAPI",$J,"DX/PL",JJ,"PRIMARY")=1
"RTN","LRBEBAO",188,0)
 .E  S ^TMP("LRPXAPI",$J,"DX/PL",JJ,"PRIMARY")=0
"RTN","LRBEBAO",189,0)
 S LRBETNUM=$G(LRBETNUM)+1,LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEBAO",190,0)
 I $P(LRBEPTDT,U,1)'="" D
"RTN","LRBEBAO",191,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"PROCEDURE")=$P(LRBEPTDT,U,1)
"RTN","LRBEBAO",192,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"QTY")=1
"RTN","LRBEBAO",193,0)
 I $P(LRBEPTDT,U,2)'="" D
"RTN","LRBEBAO",194,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"MODIFIER")=$P(LRBEPTDT,U,2)
"RTN","LRBEBAO",195,0)
 I $P(LRBEPTDT,U,3)'="" D
"RTN","LRBEBAO",196,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS")=$P(LRBEPTDT,U,3)
"RTN","LRBEBAO",197,0)
 I $P(LRBEPTDT,U,4)'="" D
"RTN","LRBEBAO",198,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 2")=$P(LRBEPTDT,U,4)
"RTN","LRBEBAO",199,0)
 I $P(LRBEPTDT,U,5)'="" D
"RTN","LRBEBAO",200,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 3")=$P(LRBEPTDT,U,5)
"RTN","LRBEBAO",201,0)
 I $P(LRBEPTDT,U,6)'="" D
"RTN","LRBEBAO",202,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 4")=$P(LRBEPTDT,U,6)
"RTN","LRBEBAO",203,0)
 I $P(LRBEPTDT,U,7)'="" D
"RTN","LRBEBAO",204,0)
 . N LRBETM S LRBETM=$P(LRBEPTDT,U,7)
"RTN","LRBEBAO",205,0)
 . S LRBETM=$$PCETM(LRBETM)
"RTN","LRBEBAO",206,0)
 . S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"EVENT D/T")=LRBETM
"RTN","LRBEBAO",207,0)
 I $P(LRBEPTDT,U,8)'="" D
"RTN","LRBEBAO",208,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"ENC PROVIDER")=$P(LRBEPTDT,U,8)
"RTN","LRBEBAO",209,0)
 I $P(LRBEPTDT,U,9)>0 D
"RTN","LRBEBAO",210,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"ORD PROVIDER")=$P(LRBEPTDT,U,9)
"RTN","LRBEBAO",211,0)
 I $P(LRBEPTDT,U,10)'="" D
"RTN","LRBEBAO",212,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"QTY")=$P(LRBEPTDT,U,10)
"RTN","LRBEBAO",213,0)
 I $P(LRBEPTDT,U,12)'="" D
"RTN","LRBEBAO",214,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 5")=$P(LRBEPTDT,U,12)
"RTN","LRBEBAO",215,0)
 I $P(LRBEPTDT,U,13)'="" D
"RTN","LRBEBAO",216,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 6")=$P(LRBEPTDT,U,13)
"RTN","LRBEBAO",217,0)
 I $P(LRBEPTDT,U,14)'="" D
"RTN","LRBEBAO",218,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 7")=$P(LRBEPTDT,U,14)
"RTN","LRBEBAO",219,0)
 I $P(LRBEPTDT,U,15)'="" D
"RTN","LRBEBAO",220,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"DIAGNOSIS 8")=$P(LRBEPTDT,U,15)
"RTN","LRBEBAO",221,0)
 I $P(LRBEPTDT,U,16)'="" D
"RTN","LRBEBAO",222,0)
 .S ^TMP("LRPXAPI",$J,SUB1,LRBETNUM,"ORD REFERENCE")=$P(LRBEPTDT,U,16)
"RTN","LRBEBAO",223,0)
 I LRSWSTAT,($P(LRBETM,".")'<LRSWDATE) D
"RTN","LRBEBAO",224,0)
 .S ^TMP("LRPXAPI",$J,"PROCEDURE",LRBETNUM,"DEPARTMENT")=108
"RTN","LRBEBAO",225,0)
 Q
"RTN","LRBEBAO",226,0)
 ;
"RTN","LRBEBAO",227,0)
INIT ;Setup PCE variables
"RTN","LRBEBAO",228,0)
 S INROOT="^TMP(""LRPXAPI"",$J)"
"RTN","LRBEBAO",229,0)
 I '$G(LRPKG) D  Q:'$G(LRPKG)
"RTN","LRBEBAO",230,0)
 . S X="LAB SERVICE",DIC="^DIC(9.4,",DIC(0)="Z" D ^DIC
"RTN","LRBEBAO",231,0)
 . I Y S LRPKG=+Y
"RTN","LRBEBAO",232,0)
 S SRC="LAB DATA",USR=DUZ,(LRBETNUM,ERRDIS)=0
"RTN","LRBEBAO",233,0)
 K DIC
"RTN","LRBEBAO",234,0)
 Q
"RTN","LRBEBAO",235,0)
PCETM(LRBETM) ;Return date/time without seconds
"RTN","LRBEBAO",236,0)
 N PCETM
"RTN","LRBEBAO",237,0)
 S LRBETM=$G(LRBETM)
"RTN","LRBEBAO",238,0)
 Q:'LRBETM LRBETM
"RTN","LRBEBAO",239,0)
 S PCETM=$E($P(LRBETM,".",2),1,4)
"RTN","LRBEBAO",240,0)
 F  Q:($L(PCETM)=4)  S PCETM=PCETM_0
"RTN","LRBEBAO",241,0)
 I PCETM>2359 S PCETM=2359
"RTN","LRBEBAO",242,0)
 I $E(PCETM,3,4)>59 S PCETM=$E(PCETM,1,2)_59
"RTN","LRBEBAO",243,0)
 I 'PCETM S PCETM="0001"
"RTN","LRBEBAO",244,0)
 S $P(LRBETM,".",2)=PCETM
"RTN","LRBEBAO",245,0)
 Q LRBETM
"RTN","LRBEECP1")
0^44^B2583804
"RTN","LRBEECP1",1,0)
LRBEECP1 ;DALOI/WTY - Edit CPT for CIDC (Cont'); 3/29/05
"RTN","LRBEECP1",2,0)
 ;;5.2;LAB SERVICES;**291**;Sep 27, 1994
"RTN","LRBEECP1",3,0)
 ;
"RTN","LRBEECP1",4,0)
 ;
"RTN","LRBEECP1",5,0)
 ; Called by LRBEECPT
"RTN","LRBEECP1",6,0)
 ;
"RTN","LRBEECP1",7,0)
 ; Reference to $$GET1^DIQ supported by IA #2056
"RTN","LRBEECP1",8,0)
 ; Reference to ^DIR supported by IA #10026
"RTN","LRBEECP1",9,0)
 ;
"RTN","LRBEECP1",10,0)
 Q
"RTN","LRBEECP1",11,0)
 ;
"RTN","LRBEECP1",12,0)
AAMA(LRBETST,LRBETSTN) ;If panel, ask if AMA compliant
"RTN","LRBEECP1",13,0)
 N LRBEAX,LRBEQT
"RTN","LRBEECP1",14,0)
 S LRBEQT=0 F  D  Q:LRBEQT!(LRBEQUIT)
"RTN","LRBEECP1",15,0)
 .S LRBEAX=$$GAMA(LRBETST,LRBETSTN)
"RTN","LRBEECP1",16,0)
 .S:LRBEAX="" LRBEQT=1 Q:LRBEQT!(LRBEQUIT)
"RTN","LRBEECP1",17,0)
 .I +LRBEAX=-2 S LRBEQT=1 Q:LRBEQT
"RTN","LRBEECP1",18,0)
 .S LRBEAR2("TEST",LRBETST,"03-AMA FLAG")=LRBEAX,LRBEQT=1
"RTN","LRBEECP1",19,0)
 Q
"RTN","LRBEECP1",20,0)
 ;
"RTN","LRBEECP1",21,0)
GAMA(LRBETST,LRBETSTN) ;
"RTN","LRBEECP1",22,0)
 N LRBEAMA,LRBECPT,LRBEDAMA,LRBEDT,LRBEMSG,LRBEFIL,LRBEFLD,LRBEQT,LRBEDESC
"RTN","LRBEECP1",23,0)
 S LRBEMSG="Are the CPT codes for "_LRBETSTN_" AMA compliant or otherwise billable? "
"RTN","LRBEECP1",24,0)
 S LRBEFIL=60,LRBEFLD=508
"RTN","LRBEECP1",25,0)
 S LRBEDAMA=$$GET1^DIQ(LRBEFIL,LRBETST_",",LRBEFLD,"I")
"RTN","LRBEECP1",26,0)
 S LRBEAMA=$$AMA(LRBEMSG,LRBEDAMA) Q:LRBEQUIT LRBEQUIT
"RTN","LRBEECP1",27,0)
 I LRBEAMA="" Q LRBEDAMA
"RTN","LRBEECP1",28,0)
 I LRBEAMA=LRBEDAMA Q -2
"RTN","LRBEECP1",29,0)
 Q LRBEAMA
"RTN","LRBEECP1",30,0)
 ;
"RTN","LRBEECP1",31,0)
AMA(LRBEMSG,DAMA) ; Ask if the panel CPTs are AMA compliant
"RTN","LRBEECP1",32,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT
"RTN","LRBEECP1",33,0)
 S DIR("B")=$S(DAMA:"YES",1:"NO")
"RTN","LRBEECP1",34,0)
 S DIR("A")=LRBEMSG,DIR(0)="YA" D ^DIR
"RTN","LRBEECP1",35,0)
 I $D(DTOUT)!($D(DUOUT))!(X[U) S LRBEQUIT=1 Q LRBEQUIT
"RTN","LRBEECP1",36,0)
 Q Y
"RTN","LRBEECPT")
0^16^B83809805
"RTN","LRBEECPT",1,0)
LRBEECPT ;DALOI/JAH - Edit CPT associated with CIDC; 3/29/05
"RTN","LRBEECPT",2,0)
 ;;5.2;LAB SERVICES;**291**;Sep 27, 1994
"RTN","LRBEECPT",3,0)
 ;
"RTN","LRBEECPT",4,0)
 ; To be able to provide a clean claim to the billing application, there
"RTN","LRBEECPT",5,0)
 ; needs be an association between the test, the specimen, and the 
"RTN","LRBEECPT",6,0)
 ; CPT/HCPCS codes. This routine is designed to allow the user to define
"RTN","LRBEECPT",7,0)
 ; this associaton.
"RTN","LRBEECPT",8,0)
 ;
"RTN","LRBEECPT",9,0)
 ; Reference to EN^DDIOL supported by IA #10142
"RTN","LRBEECPT",10,0)
 ; Reference to ^DIC supported by IA #10006
"RTN","LRBEECPT",11,0)
 ; Reference to $$GET1^DIQ supported by IA #2056
"RTN","LRBEECPT",12,0)
 ; Reference to ^DIR supported by IA #10026
"RTN","LRBEECPT",13,0)
 ; Reference to  $$CPT^ICPTCOD Supported by DBIA #1995-A
"RTN","LRBEECPT",14,0)
 ;
"RTN","LRBEECPT",15,0)
STRT ; Start the routine
"RTN","LRBEECPT",16,0)
 N DIC,DIR,X,Y,LRBEY,LRBEQUIT,LRBEPNL
"RTN","LRBEECPT",17,0)
 N LRBEAR,LRBEAR2,LRBEARP,LRBETST,LRBETSTN,LRBEMSG
"RTN","LRBEECPT",18,0)
 S LRBEQUIT=0
"RTN","LRBEECPT",19,0)
 F  D  Q:LRBEQUIT
"RTN","LRBEECPT",20,0)
 .D TST S:Y<1 LRBEQUIT=1 Q:LRBEQUIT 
"RTN","LRBEECPT",21,0)
 .D EN^DDIOL("","","!")
"RTN","LRBEECPT",22,0)
 .S DIR(0)="E" D ^DIR S:Y<1 LRBEQUIT=1
"RTN","LRBEECPT",23,0)
 .D EN^DDIOL("","","!")
"RTN","LRBEECPT",24,0)
 .D KLL
"RTN","LRBEECPT",25,0)
 Q
"RTN","LRBEECPT",26,0)
TST ; Ask the user for the test to work on.
"RTN","LRBEECPT",27,0)
 S DIC="^LAB(60,",DIC(0)="AEMQZ" D ^DIC
"RTN","LRBEECPT",28,0)
 I Y=-1 K DIC Q  ;quit if look-up fails
"RTN","LRBEECPT",29,0)
 S LRBEPNL=0
"RTN","LRBEECPT",30,0)
 I $P(Y(0),"^",5)="" S LRBEPNL=1  ;Selected test is a panel
"RTN","LRBEECPT",31,0)
 S LRBEY=Y D WORK(LRBEY) Q:LRBEQUIT
"RTN","LRBEECPT",32,0)
 Q
"RTN","LRBEECPT",33,0)
WORK(LRBEY) ; Start getting the CPT/HCPCS Codes
"RTN","LRBEECPT",34,0)
 S LRBETST=$P(LRBEY,U,1),LRBETSTN=$P(LRBEY,U,2)
"RTN","LRBEECPT",35,0)
 S LRBEAR2("TEST",LRBETST)=LRBEY
"RTN","LRBEECPT",36,0)
 W ! D SPEC(LRBETST) Q:LRBEQUIT
"RTN","LRBEECPT",37,0)
 W ! D DEFH(LRBETST,LRBETSTN) Q:LRBEQUIT
"RTN","LRBEECPT",38,0)
 W ! D DEFC(LRBETST,LRBETSTN) Q:LRBEQUIT
"RTN","LRBEECPT",39,0)
 I LRBEPNL D  Q:LRBEQUIT
"RTN","LRBEECPT",40,0)
 .W ! D AAMA^LRBEECP1(LRBETST,LRBETSTN)
"RTN","LRBEECPT",41,0)
 D DISCPT(.LRBEAR2) Q:LRBEQUIT
"RTN","LRBEECPT",42,0)
 Q
"RTN","LRBEECPT",43,0)
SPEC(LRBETST) ; Get the Specimen and CPT of the Test
"RTN","LRBEECPT",44,0)
 N A,LRBEAX,LRBESP,LRBESPI,LRBESPE,LRBECPT,LRBEFIL,LRBEFLD,LRBEDT,LRBEMSG
"RTN","LRBEECPT",45,0)
 N LRBEQT,LRBEXMSG,LRBEDCPT,LRX,LRBEDESC
"RTN","LRBEECPT",46,0)
 D SAR(LRBETST,.LRX)
"RTN","LRBEECPT",47,0)
 S A="" F  S A=$O(LRX(60.196,A)) Q:A=""!(LRBEQUIT)  D
"RTN","LRBEECPT",48,0)
 .S LRBESP=$O(LRX(60.196,A,""),-1)
"RTN","LRBEECPT",49,0)
 .S LRBESPI=$P(A,",",1)
"RTN","LRBEECPT",50,0)
 .S LRBESPE=$P($G(LRX(60.196,A,LRBESP)),"^",1)
"RTN","LRBEECPT",51,0)
 .S LRBEDCPT=$P($G(LRX(60.196,A,LRBESP)),"^",2)
"RTN","LRBEECPT",52,0)
 .S LRBEQT=0 F  D  Q:LRBEQT!(LRBEQUIT)
"RTN","LRBEECPT",53,0)
 ..S LRBEMSG="Enter a CPT for a "_LRBESPE_" specimen: "
"RTN","LRBEECPT",54,0)
 ..S LRBECPT=$$ACPT(LRBEMSG,LRBEDCPT) Q:LRBEQUIT
"RTN","LRBEECPT",55,0)
 ..I LRBEDCPT="",LRBECPT="@" D WMSG("","ND") Q
"RTN","LRBEECPT",56,0)
 ..I LRBECPT=LRBEDCPT S LRBEQT=1 Q:LRBEQT
"RTN","LRBEECPT",57,0)
 ..S:LRBECPT="" LRBEQT=1 Q:LRBEQT
"RTN","LRBEECPT",58,0)
 ..I $P(LRBECPT,U,1)="@" D  Q
"RTN","LRBEECPT",59,0)
 ...S LRBEDESC=$$GET1^DIQ(81,LRBEDCPT_",",2)
"RTN","LRBEECPT",60,0)
 ...S LRBECPT=LRBECPT_"^"_LRBEDCPT_"^"_LRBEDESC_"^"
"RTN","LRBEECPT",61,0)
 ...S LRBECPT=LRBECPT_LRBESP_","_LRBESPI_","_LRBETST_","
"RTN","LRBEECPT",62,0)
 ...S LRBEAR2("TEST",LRBETST,"00-SPECIMEN",LRBESPI)=LRBECPT,LRBEQT=1
"RTN","LRBEECPT",63,0)
 ...S $P(LRBEAR2("TEST",LRBETST,"00-SPECIMEN",LRBESPI,"S"),U,1)=LRBESPE
"RTN","LRBEECPT",64,0)
 ..S LRBEDT=$$ADAT("TODAY") Q:LRBEQUIT
"RTN","LRBEECPT",65,0)
 ..S LRBEAX=$$GCPT(LRBECPT,LRBEDT) Q:LRBEQUIT
"RTN","LRBEECPT",66,0)
 ..I +LRBEAX=-1 D WMSG($P(LRBEAX,U,2),"IV") Q
"RTN","LRBEECPT",67,0)
 ..I $P(LRBEAX,U,7)'=1 D WMSG("INACTIVE","IA") Q
"RTN","LRBEECPT",68,0)
 ..D WMSG($P(LRBEAX,U,3),"V")
"RTN","LRBEECPT",69,0)
 ..S $P(LRBEAR2("TEST",LRBETST,"00-SPECIMEN",LRBESPI),U,1)=LRBEAX,LRBEQT=1
"RTN","LRBEECPT",70,0)
 ..S LRBEAX=LRBESPE_"^"_LRBEDT
"RTN","LRBEECPT",71,0)
 ..S $P(LRBEAR2("TEST",LRBETST,"00-SPECIMEN",LRBESPI,"S"),U,1)=LRBESPE
"RTN","LRBEECPT",72,0)
 ..S $P(LRBEAR2("TEST",LRBETST,"00-SPECIMEN",LRBESPI,"D"),U,1)=LRBEDT
"RTN","LRBEECPT",73,0)
 Q
"RTN","LRBEECPT",74,0)
DEFH(LRBETST,LRBETSTN)  ; Get the Default HCPCS
"RTN","LRBEECPT",75,0)
 N LRBEAX,LRBEQT
"RTN","LRBEECPT",76,0)
 S LRBEQT=0 F  D  Q:LRBEQT!(LRBEQUIT)
"RTN","LRBEECPT",77,0)
 .S LRBEAX=$$DHCPCS(LRBETST,LRBETSTN)
"RTN","LRBEECPT",78,0)
 .S:LRBEAX="" LRBEQT=1 Q:LRBEQT!(LRBEQUIT)
"RTN","LRBEECPT",79,0)
 .I +LRBEAX=-3 D WMSG("","ND") Q
"RTN","LRBEECPT",80,0)
 .I $P(LRBEAX,U,1)="@" D  Q
"RTN","LRBEECPT",81,0)
 ..S LRBEAR2("TEST",LRBETST,"01-DEFAULT HCPCS")=LRBEAX,LRBEQT=1
"RTN","LRBEECPT",82,0)
 .I +LRBEAX=-2 S LRBEQT=1 Q:LRBEQT
"RTN","LRBEECPT",83,0)
 .I +LRBEAX=-1 D WMSG($P(LRBEAX,U,2),"IV") Q
"RTN","LRBEECPT",84,0)
 .I $P(LRBEAX,U,7)'=1 D WMSG("INACTIVE","IA") Q
"RTN","LRBEECPT",85,0)
 .D WMSG($P(LRBEAX,U,3),"V")
"RTN","LRBEECPT",86,0)
 .S LRBEAR2("TEST",LRBETST,"01-DEFAULT HCPCS")=LRBEAX,LRBEQT=1
"RTN","LRBEECPT",87,0)
 Q
"RTN","LRBEECPT",88,0)
DHCPCS(LRBETST,LRBETSTN)   ; Get the Default HCPCS code of the Test
"RTN","LRBEECPT",89,0)
 N LRBECPT,LRBEDCPT,LRBEDT,LRBEMSG,LRBEFIL,LRBEFLD,LRBEQT,LRBEDESC
"RTN","LRBEECPT",90,0)
 S LRBEMSG="Enter a HCPCS code for "_LRBETSTN_": "
"RTN","LRBEECPT",91,0)
 S LRBEFIL=60,LRBEFLD=507
"RTN","LRBEECPT",92,0)
 S LRBEDCPT=$$GET1^DIQ(LRBEFIL,LRBETST_",",LRBEFLD)
"RTN","LRBEECPT",93,0)
 S LRBECPT=$$ACPT(LRBEMSG,LRBEDCPT) Q:LRBEQUIT LRBEQUIT
"RTN","LRBEECPT",94,0)
 I LRBECPT="" Q LRBECPT
"RTN","LRBEECPT",95,0)
 I LRBEDCPT="",LRBECPT="@" Q -3
"RTN","LRBEECPT",96,0)
 I LRBECPT="@" D  Q LRBECPT
"RTN","LRBEECPT",97,0)
 .S LRBEDESC=$$GET1^DIQ(81,LRBEDCPT_",",2)
"RTN","LRBEECPT",98,0)
 .S LRBECPT=LRBECPT_"^"_LRBEDCPT_"^"_LRBEDESC
"RTN","LRBEECPT",99,0)
 I LRBECPT=LRBEDCPT Q -2
"RTN","LRBEECPT",100,0)
 S LRBEDT=$$ADAT("TODAY") Q:LRBEQUIT LRBEQUIT
"RTN","LRBEECPT",101,0)
 S $P(LRBEAR2("TEST",LRBETST,"01-DEFAULT HCPCS","D"),U,1)=LRBEDT
"RTN","LRBEECPT",102,0)
 Q $$GCPT(LRBECPT,LRBEDT)
"RTN","LRBEECPT",103,0)
DEFC(LRBETST,LRBETSTN) ; Get the Default CPT
"RTN","LRBEECPT",104,0)
 N LRBEAX,LRBEQT
"RTN","LRBEECPT",105,0)
 S LRBEQT=0 F  D  Q:LRBEQT!(LRBEQUIT)
"RTN","LRBEECPT",106,0)
 .S LRBEAX=$$DCPT(LRBETST,LRBETSTN)
"RTN","LRBEECPT",107,0)
 .S:LRBEAX="" LRBEQT=1 Q:LRBEQT!(LRBEQUIT)
"RTN","LRBEECPT",108,0)
 .I +LRBEAX=-3 D WMSG("","ND") Q
"RTN","LRBEECPT",109,0)
 .I $P(LRBEAX,U,1)="@" D  Q
"RTN","LRBEECPT",110,0)
 ..S LRBEAR2("TEST",LRBETST,"02-DEFAULT CPT")=LRBEAX,LRBEQT=1
"RTN","LRBEECPT",111,0)
 .I +LRBEAX=-2 S LRBEQT=1 Q:LRBEQT
"RTN","LRBEECPT",112,0)
 .I +LRBEAX=-1 D WMSG($P(LRBEAX,U,2),"IV") Q
"RTN","LRBEECPT",113,0)
 .I $P(LRBEAX,U,7)'=1 D WMSG("INACTIVE","IA") Q
"RTN","LRBEECPT",114,0)
 .D WMSG($P(LRBEAX,U,3),"V")
"RTN","LRBEECPT",115,0)
 .S LRBEAR2("TEST",LRBETST,"02-DEFAULT CPT")=LRBEAX,LRBEQT=1
"RTN","LRBEECPT",116,0)
 Q
"RTN","LRBEECPT",117,0)
DCPT(LRBETST,LRBETSTN)   ; Get the Default CPT code of the Test
"RTN","LRBEECPT",118,0)
 N LRBECPT,LRBEDCPT,LRBEDT,LRBEMSG,LRBEFIL,LRBEFLD,LRBEQT,LRBEDESC
"RTN","LRBEECPT",119,0)
 S LRBEMSG="Enter a Default CPT code for "_LRBETSTN_": "
"RTN","LRBEECPT",120,0)
 S LRBEFIL=60,LRBEFLD=506
"RTN","LRBEECPT",121,0)
 S LRBEDCPT=$$GET1^DIQ(LRBEFIL,LRBETST_",",LRBEFLD)
"RTN","LRBEECPT",122,0)
 S LRBECPT=$$RCPT(LRBEMSG,LRBEDCPT) Q:LRBEQUIT LRBEQUIT
"RTN","LRBEECPT",123,0)
 I LRBECPT="" Q LRBECPT
"RTN","LRBEECPT",124,0)
 I LRBEDCPT="",LRBECPT="@" Q -3
"RTN","LRBEECPT",125,0)
 I LRBECPT="@" D  Q LRBECPT
"RTN","LRBEECPT",126,0)
 .S LRBEDESC=$$GET1^DIQ(81,LRBEDCPT_",",2)
"RTN","LRBEECPT",127,0)
 .S LRBECPT=LRBECPT_"^"_LRBEDCPT_"^"_LRBEDESC
"RTN","LRBEECPT",128,0)
 I LRBECPT=LRBEDCPT Q -2
"RTN","LRBEECPT",129,0)
 S LRBEDT=$$ADAT("TODAY") Q:LRBEQUIT LRBEQUIT
"RTN","LRBEECPT",130,0)
 S $P(LRBEAR2("TEST",LRBETST,"02-DEFAULT CPT","D"),U,1)=LRBEDT
"RTN","LRBEECPT",131,0)
 Q $$GCPT(LRBECPT,LRBEDT)
"RTN","LRBEECPT",132,0)
ACPT(LRBEMSG,DCPT) ; Ask for CPT/HCPCS Code
"RTN","LRBEECPT",133,0)
 N X,Y,DIR,DUOUT,DTOUT,DIRUT
"RTN","LRBEECPT",134,0)
 S DIR("B")=DCPT
"RTN","LRBEECPT",135,0)
 S DIR("A")=LRBEMSG,DIR(0)="FAUO^3:10" D ^DIR
"RTN","LRBEECPT",136,0)
 I $D(DTOUT)!($D(DUOUT))!(X[U) S LRBEQUIT=1 Q LRBEQUIT
"RTN","LRBEECPT",137,0)
 I Y?1A.4N Q Y
"RTN","LRBEECPT",138,0)
 I X="@" Q X
"RTN","LRBEECPT",139,0)
 S:Y<1 Y=""
"RTN","LRBEECPT",140,0)
 Q Y
"RTN","LRBEECPT",141,0)
ADAT(LRBEMSG) ; Ask for date
"RTN","LRBEECPT",142,0)
 N X,Y,DIR,DUOUT,DTOUT,DIRUT
"RTN","LRBEECPT",143,0)
 D NOW^%DTC
"RTN","LRBEECPT",144,0)
 S DIR(0)="DAO^"_X_"::E",DIR("B")=LRBEMSG
"RTN","LRBEECPT",145,0)
 S DIR("A")="Enter Date to be Checked: "
"RTN","LRBEECPT",146,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) S Y=-1,LRBEQUIT=1
"RTN","LRBEECPT",147,0)
 Q Y_"."_$P(%,".",2)
"RTN","LRBEECPT",148,0)
RCPT(LRBEMSG,DCPT) ; Ask for Required default CPT/HCPCS Code
"RTN","LRBEECPT",149,0)
 N X,Y,DIR,DUOUT,DTOUT,DIRUT
"RTN","LRBEECPT",150,0)
 S DIR("B")=DCPT
"RTN","LRBEECPT",151,0)
 S DIR("A")=LRBEMSG,DIR(0)="FAUO^3:10" D ^DIR
"RTN","LRBEECPT",152,0)
 I $D(DTOUT)!($D(DUOUT))!(X[U) S LRBEQUIT=1 Q LRBEQUIT
"RTN","LRBEECPT",153,0)
 I X="@" Q X
"RTN","LRBEECPT",154,0)
 S:Y<1 Y=""
"RTN","LRBEECPT",155,0)
 Q Y
"RTN","LRBEECPT",156,0)
GCPT(CPT,TDAT) ; Get the CPT/HCPCS Code
"RTN","LRBEECPT",157,0)
 Q $$CPT^ICPTCOD(CPT,TDAT)
"RTN","LRBEECPT",158,0)
DISCPT(LRBEAR2)   ; Display the CPT code in File #60
"RTN","LRBEECPT",159,0)
 N LRBEAX,LRBEALO,LRBEBX,DIR,LRBEQT,X,Y
"RTN","LRBEECPT",160,0)
 S LRBEQT=0 D EN^DDIOL("","","!!")
"RTN","LRBEECPT",161,0)
 S LRBEAX="" F  S LRBEAX=$O(LRBEAR2("TEST",LRBEAX)) Q:LRBEAX=""!(LRBEQT)  D
"RTN","LRBEECPT",162,0)
 .I $D(LRBEAR2("TEST",LRBEAX))'=11 S LRBEQT=1 Q:LRBEQT
"RTN","LRBEECPT",163,0)
 .S LRBEALO=1
"RTN","LRBEECPT",164,0)
 .D EN^DDIOL("TEST:","","")
"RTN","LRBEECPT",165,0)
 .D EN^DDIOL($E($P(LRBEAR2("TEST",LRBEAX),U,2),1,30),"","?10")
"RTN","LRBEECPT",166,0)
 .S LRBEBX="" F  S LRBEBX=$O(LRBEAR2("TEST",LRBEAX,"00-SPECIMEN",LRBEBX)) Q:LRBEBX=""  D
"RTN","LRBEECPT",167,0)
 ..S X=$G(LRBEAR2("TEST",LRBEAX,"00-SPECIMEN",LRBEBX)) Q:X=""
"RTN","LRBEECPT",168,0)
 ..S Y=$G(LRBEAR2("TEST",LRBEAX,"00-SPECIMEN",LRBEBX,"S"))
"RTN","LRBEECPT",169,0)
 ..D:LRBEALO 
"RTN","LRBEECPT",170,0)
 ...D EN^DDIOL("SPECIMEN:","","!"),EN^DDIOL("","","!")
"RTN","LRBEECPT",171,0)
 ..D EN^DDIOL($E(Y,1,15),"","?3")
"RTN","LRBEECPT",172,0)
 ..D EN^DDIOL($E($P(X,U,3),1,35),"","?20")
"RTN","LRBEECPT",173,0)
 ..D EN^DDIOL($S($P(X,U,1)="@":$P(X,U,2)_" (DELETE)",1:$P(X,U,1)),"","?60")
"RTN","LRBEECPT",174,0)
 ..D EN^DDIOL("","","!") S LRBEALO=0
"RTN","LRBEECPT",175,0)
 .S X=$G(LRBEAR2("TEST",LRBEAX,"01-DEFAULT HCPCS"))
"RTN","LRBEECPT",176,0)
 .D:X'=""
"RTN","LRBEECPT",177,0)
 ..D EN^DDIOL("HCPCS:","","")
"RTN","LRBEECPT",178,0)
 ..D EN^DDIOL($E($P(X,U,3),1,35),"","?20")
"RTN","LRBEECPT",179,0)
 ..D EN^DDIOL($S($P(X,U,1)="@":$P(X,U,2)_" (DELETE)",1:$P(X,U,1)),"","?60")
"RTN","LRBEECPT",180,0)
 ..D EN^DDIOL("","","!")
"RTN","LRBEECPT",181,0)
 .S X=$G(LRBEAR2("TEST",LRBEAX,"02-DEFAULT CPT"))
"RTN","LRBEECPT",182,0)
 .D:X'=""
"RTN","LRBEECPT",183,0)
 ..D EN^DDIOL("Default CPT:","","")
"RTN","LRBEECPT",184,0)
 ..D EN^DDIOL($E($P(X,U,3),1,35),"","?20")
"RTN","LRBEECPT",185,0)
 ..D EN^DDIOL($S($P(X,U,1)="@":$P(X,U,2)_" (DELETE)",1:$P(X,U,1)),"","?60")
"RTN","LRBEECPT",186,0)
 ..D EN^DDIOL("","","!")
"RTN","LRBEECPT",187,0)
 .S X=$G(LRBEAR2("TEST",LRBEAX,"03-AMA FLAG"))
"RTN","LRBEECPT",188,0)
 .D:X'=""
"RTN","LRBEECPT",189,0)
 ..D EN^DDIOL("Panel CPT(S) AMA compliant or otherwise billable?:","","")
"RTN","LRBEECPT",190,0)
 ..D EN^DDIOL($S(X=1:"YES",1:"NO"),"","?60")
"RTN","LRBEECPT",191,0)
 ..D EN^DDIOL("","","!")
"RTN","LRBEECPT",192,0)
 Q:LRBEQT
"RTN","LRBEECPT",193,0)
 S DIR("A")="Is this correct",DIR(0)="Y",DIR("B")="YES" D ^DIR
"RTN","LRBEECPT",194,0)
 I Y D SCPT(.LRBEAR2)
"RTN","LRBEECPT",195,0)
 Q
"RTN","LRBEECPT",196,0)
SCPT(LRBEAR2) ; Set the CPT code in File #60
"RTN","LRBEECPT",197,0)
 N LRBEAX,LRBEBX,LRBEFIL1,LRBEFIL2,LRERR,LRFDA,LRBESEQ,LRBEX,LRBEXX
"RTN","LRBEECPT",198,0)
 N LRBEXIEN,LRBEDEL
"RTN","LRBEECPT",199,0)
 S LRBEFIL1=60,LRBEFIL2=60.196
"RTN","LRBEECPT",200,0)
 S LRBEAX="" F  S LRBEAX=$O(LRBEAR2("TEST",LRBEAX)) Q:LRBEAX=""  D
"RTN","LRBEECPT",201,0)
 .S LRBEX=$G(LRBEAR2("TEST",LRBEAX,"01-DEFAULT HCPCS"))
"RTN","LRBEECPT",202,0)
 .S:LRBEX'="" LRFDA(99,LRBEFIL1,LRBEAX_",",507)=$P(LRBEX,U,1)
"RTN","LRBEECPT",203,0)
 .S LRBEX=$G(LRBEAR2("TEST",LRBEAX,"02-DEFAULT CPT"))
"RTN","LRBEECPT",204,0)
 .S:LRBEX'="" LRFDA(99,LRBEFIL1,LRBEAX_",",506)=$P(LRBEX,U,1)
"RTN","LRBEECPT",205,0)
 .S LRBEX=$G(LRBEAR2("TEST",LRBEAX,"03-AMA FLAG"))
"RTN","LRBEECPT",206,0)
 .S:LRBEX'="" LRFDA(99,LRBEFIL1,LRBEAX_",",508)=$P(LRBEX,U)
"RTN","LRBEECPT",207,0)
 .S LRBEBX=""
"RTN","LRBEECPT",208,0)
 .F  S LRBEBX=$O(LRBEAR2("TEST",LRBEAX,"00-SPECIMEN",LRBEBX)) Q:LRBEBX=""  D
"RTN","LRBEECPT",209,0)
 ..S LRBEX=$G(LRBEAR2("TEST",LRBEAX,"00-SPECIMEN",LRBEBX))
"RTN","LRBEECPT",210,0)
 ..S LRBEDEL=$S($P(LRBEX,U)="@":1,1:0)
"RTN","LRBEECPT",211,0)
 ..I LRBEDEL D
"RTN","LRBEECPT",212,0)
 ...S LRBEXIEN=$P(LRBEX,U,4),LRFDAIEN=""
"RTN","LRBEECPT",213,0)
 ..I 'LRBEDEL D
"RTN","LRBEECPT",214,0)
 ...S LRBESEQ=$O(^LAB(60,LRBEAX,1,LRBEBX,3,"A"),-1)+1
"RTN","LRBEECPT",215,0)
 ...S LRBETNUM=$G(LRBETNUM)+1
"RTN","LRBEECPT",216,0)
 ...S LRBEXIEN="+"_LRBETNUM_","_LRBEBX_","_LRBEAX_","
"RTN","LRBEECPT",217,0)
 ...S LRFDAIEN(LRBETNUM)=LRBESEQ
"RTN","LRBEECPT",218,0)
 ...S LRBEXX=$G(LRBEAR2("TEST",LRBEAX,"00-SPECIMEN",LRBEBX,"D"))
"RTN","LRBEECPT",219,0)
 ..S LRFDA(99,LRBEFIL2,LRBEXIEN,.01)=$P(LRBEX,U,1)
"RTN","LRBEECPT",220,0)
 ..S:'LRBEDEL LRFDA(99,LRBEFIL2,LRBEXIEN,1)=$P(LRBEXX,U,1)
"RTN","LRBEECPT",221,0)
 D UPDATE^DIE("","LRFDA(99)","LRFDAIEN","LRERR")
"RTN","LRBEECPT",222,0)
 Q
"RTN","LRBEECPT",223,0)
SAR(LRBETST,LRBEAR2) ; Setup Array for Specimen
"RTN","LRBEECPT",224,0)
 N A,B,LRBEAR,LRBETNAM,LRBETNUM,LRBETCPT
"RTN","LRBEECPT",225,0)
 D GETS^DIQ(60,LRBETST_",","100*","","LRBEAR")
"RTN","LRBEECPT",226,0)
 S A="" F  S A=$O(LRBEAR(60.01,A)) Q:A=""  D
"RTN","LRBEECPT",227,0)
 .S LRBETNUM=1,LRBETCPT="",LRBETNAM=$P(LRBEAR(60.01,A,.01),U,1)
"RTN","LRBEECPT",228,0)
 .S B="" F  S B=$O(LRBEAR(60.196,B)) Q:B=""  D
"RTN","LRBEECPT",229,0)
 ..Q:A'=$P(B,",",2,4)
"RTN","LRBEECPT",230,0)
 ..S LRBETNUM=$P(B,",",1),LRBETCPT=$G(LRBEAR(60.196,B,.01))
"RTN","LRBEECPT",231,0)
 .S LRBEAR2(60.196,$P(A,",",1),LRBETNUM)=LRBETNAM_"^"_LRBETCPT
"RTN","LRBEECPT",232,0)
 Q
"RTN","LRBEECPT",233,0)
WMSG(LRBEDESC,LRBEFLG) ; Write Message
"RTN","LRBEECPT",234,0)
 N LRBEXMSG
"RTN","LRBEECPT",235,0)
 S:LRBEFLG="ND" LRBEXMSG="NOTHING TO DELETE"
"RTN","LRBEECPT",236,0)
 S:LRBEFLG="IV" LRBEXMSG="INVALID CPT: "_LRBEDESC
"RTN","LRBEECPT",237,0)
 S:LRBEFLG="IA" LRBEXMSG="INACTIVE CPT: NOT ACTIVE FOR THIS DATE"
"RTN","LRBEECPT",238,0)
 S:LRBEFLG="V" LRBEXMSG="VALID CPT: "_LRBEDESC
"RTN","LRBEECPT",239,0)
 D EN^DDIOL(LRBEXMSG,"","!?$X+5")
"RTN","LRBEECPT",240,0)
 Q
"RTN","LRBEECPT",241,0)
KLL ; Kill all variable
"RTN","LRBEECPT",242,0)
 K LRBEAX,DIC,DIR,LRBEQT,X,Y
"RTN","LRBEECPT",243,0)
 K LRBEAR,LRBEAR2,LRBEARP,LRBETST,LRBETSTN,LRBEMSG
"RTN","LRBEECPT",244,0)
 Q
"RTN","LRBEPEND")
0^49^B47036238
"RTN","LRBEPEND",1,0)
LRBEPEND ;DALOI/JAH/FHS - PENDING PANEL REPORT ;11/26/2005
"RTN","LRBEPEND",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRBEPEND",3,0)
 ;
"RTN","LRBEPEND",4,0)
EN ;Entry point from menu option LRBE PENDREP
"RTN","LRBEPEND",5,0)
 N ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","LRBEPEND",6,0)
 S ZTRTN="TASK^LRBEPEND"
"RTN","LRBEPEND",7,0)
 S ZTDESC="Lab Report on Pending AMA/Billable Panels"
"RTN","LRBEPEND",8,0)
 S ZTIO=""
"RTN","LRBEPEND",9,0)
 S ZTSAVE("DUZ")=""
"RTN","LRBEPEND",10,0)
 W !!,"This report option must be queued via TaskManager."
"RTN","LRBEPEND",11,0)
 W !,"The report will be sent to you as a MailMan message.",!
"RTN","LRBEPEND",12,0)
 D ^%ZTLOAD
"RTN","LRBEPEND",13,0)
 I $G(ZTSK) D
"RTN","LRBEPEND",14,0)
 .W !,"Report queueud as Task #: ",ZTSK
"RTN","LRBEPEND",15,0)
 W !
"RTN","LRBEPEND",16,0)
 Q
"RTN","LRBEPEND",17,0)
 ;
"RTN","LRBEPEND",18,0)
TASK ;Entry point from Taskmgr
"RTN","LRBEPEND",19,0)
 N LRBERLDT,DATX,YY,MM,STARTDT,ENDDT,TOTPAN
"RTN","LRBEPEND",20,0)
 K ^TMP("LRPENDING",$J)
"RTN","LRBEPEND",21,0)
 S ^TMP("LRPENDING",$J,0)=$$NOW^XLFDT_"^"
"RTN","LRBEPEND",22,0)
 S LRBERLDT=$P(^LAB(69.9,1,"VSIT"),U,2)
"RTN","LRBEPEND",23,0)
 I 'LRBERLDT S (STARTDT,ENDDT)=""
"RTN","LRBEPEND",24,0)
 I LRBERLDT D
"RTN","LRBEPEND",25,0)
 .S YY=$E(LRBERLDT,1,3),MM=+$E(LRBERLDT,4,5)
"RTN","LRBEPEND",26,0)
 .S MM=$S(MM=1:12,1:MM-1) S YY=$S(MM=12:YY-1,1:YY) I $L(MM)=1 S MM="0"_MM
"RTN","LRBEPEND",27,0)
 .S STARTDT=YY_MM_"01",ENDDT=YY_MM_"31"_".999999"
"RTN","LRBEPEND",28,0)
 .S DATX=$O(^LRO(69,"APP",0))
"RTN","LRBEPEND",29,0)
 .I DATX,DATX<STARTDT S STARTDT=DATX
"RTN","LRBEPEND",30,0)
 .D START
"RTN","LRBEPEND",31,0)
 S ^TMP("LRPENDING",$J,0)=^TMP("LRPENDING",$J,0)_$$NOW^XLFDT()
"RTN","LRBEPEND",32,0)
 D MAILRPT
"RTN","LRBEPEND",33,0)
 Q
"RTN","LRBEPEND",34,0)
 ;
"RTN","LRBEPEND",35,0)
START ;Loop thru pending panel xref in file #69
"RTN","LRBEPEND",36,0)
 N LINE,LRXDT,LRODT,LRSN,LRTN
"RTN","LRBEPEND",37,0)
 S LINE=100,TOTPAN=0
"RTN","LRBEPEND",38,0)
 S LRXDT=STARTDT-1 F  S LRXDT=$O(^LRO(69,"APP",LRXDT)) Q:'LRXDT  Q:LRXDT>ENDDT  D
"RTN","LRBEPEND",39,0)
 .S LRODT=0 F  S LRODT=$O(^LRO(69,"APP",LRXDT,LRODT)) Q:'LRODT  D
"RTN","LRBEPEND",40,0)
 ..S LRSN=0 F  S LRSN=$O(^LRO(69,"APP",LRXDT,LRODT,LRSN)) Q:'LRSN  D
"RTN","LRBEPEND",41,0)
 ...S LRTN=0 F  S LRTN=$O(^LRO(69,"APP",LRXDT,LRODT,LRSN,LRTN)) Q:'LRTN  D
"RTN","LRBEPEND",42,0)
 ....D SET
"RTN","LRBEPEND",43,0)
 ....I $D(LRBEY)>1 D SETRPT
"RTN","LRBEPEND",44,0)
 ....D CLEAN
"RTN","LRBEPEND",45,0)
 Q
"RTN","LRBEPEND",46,0)
 ;
"RTN","LRBEPEND",47,0)
SET ;Setup background variables for call to BAWRK^LRBEBA
"RTN","LRBEPEND",48,0)
 N I,LRBET,LRBEIEN,NX,XX
"RTN","LRBEPEND",49,0)
 S LRBEIEN=LRSN_","_LRODT_","
"RTN","LRBEPEND",50,0)
 S LRDFN=$$GET1^DIQ(69.01,LRBEIEN,.01,"I")
"RTN","LRBEPEND",51,0)
 S LRORDER=$$GET1^DIQ(69.01,LRBEIEN,9.5,"I")
"RTN","LRBEPEND",52,0)
 S LRBEIEN=LRTN_","_LRSN_","_LRODT_","
"RTN","LRBEPEND",53,0)
 S LRBETST=$$GET1^DIQ(69.03,LRBEIEN,.01,"I")
"RTN","LRBEPEND",54,0)
 S LRAD=$$GET1^DIQ(69.03,LRBEIEN,2,"I")
"RTN","LRBEPEND",55,0)
 S LRAA=$$GET1^DIQ(69.03,LRBEIEN,3,"I")
"RTN","LRBEPEND",56,0)
 S LRAN=$$GET1^DIQ(69.03,LRBEIEN,4,"I")
"RTN","LRBEPEND",57,0)
 S LRUID=$$GET1^DIQ(69.03,LRBEIEN,13,"I")
"RTN","LRBEPEND",58,0)
 S LRBECDT=$$GET1^DIQ(69.03,LRBEIEN,22,"I")
"RTN","LRBEPEND",59,0)
 S LRBEDFN=$$GET1^DIQ(63,LRDFN,.03,"I")
"RTN","LRBEPEND",60,0)
 S LRSS=$$GET1^DIQ(68,LRAA,.02,"I")
"RTN","LRBEPEND",61,0)
 Q:'$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRBETST,0))
"RTN","LRBEPEND",62,0)
 S LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5)
"RTN","LRBEPEND",63,0)
 S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,5,0))
"RTN","LRBEPEND",64,0)
 I I S X=^LRO(68,LRAA,1,LRAD,1,LRAN,5,I,0),LRSPEC=$P(X,U,1),LRSAMP=$P(X,U,2)
"RTN","LRBEPEND",65,0)
 S NX=0 F  S NX=$O(^LAB(60,LRBETST,2,NX)) Q:'NX  D
"RTN","LRBEPEND",66,0)
 .S LRBET=+^LAB(60,LRBETST,2,NX,0)
"RTN","LRBEPEND",67,0)
 .Q:('$P(^LAB(60,LRBET,0),U,17))
"RTN","LRBEPEND",68,0)
 .S XX=$P($P(^LAB(60,LRBET,0),U,5),";",2)
"RTN","LRBEPEND",69,0)
 .;if null XX, possibly another panel
"RTN","LRBEPEND",70,0)
 .Q:'XX
"RTN","LRBEPEND",71,0)
 .S LRSB(XX)=$G(^LR(LRDFN,LRSS,LRIDT,XX))
"RTN","LRBEPEND",72,0)
 .I LRSB(XX)="" K LRSB(XX) Q
"RTN","LRBEPEND",73,0)
 .I $P(LRSB(XX),U,1)["canc" K LRSB(XX) Q
"RTN","LRBEPEND",74,0)
 .I $P(LRSB(XX),U,13) K LRSB(XX) Q
"RTN","LRBEPEND",75,0)
 .S LRBEY(LRBETST,XX)=""
"RTN","LRBEPEND",76,0)
 I $D(LRBEY)>1 D
"RTN","LRBEPEND",77,0)
 .S LRTEST(1)=LRBETST_U_^LAB(60,LRBETST,0),LRTEST(1,"P")=LRBETST_U_$$NLT^LRVER1(LRBETST)
"RTN","LRBEPEND",78,0)
 Q
"RTN","LRBEPEND",79,0)
 ;
"RTN","LRBEPEND",80,0)
CLEAN ;Clean-up variables
"RTN","LRBEPEND",81,0)
 K LRBEY,LRTEST,LRSB,LRBECPT,LRDFN,LRBEDFN,LRORDER
"RTN","LRBEPEND",82,0)
 K LRBETST,LRBEVST,LRAA,LRAN,LRAD,LRUID,LRBECDT,LRSS,LRIDT,LRSAMP,LRSPEC
"RTN","LRBEPEND",83,0)
 Q
"RTN","LRBEPEND",84,0)
 ;
"RTN","LRBEPEND",85,0)
SETRPT ;Set veriables into ^TMP( for report
"RTN","LRBEPEND",86,0)
 N SETLN,X,C,CX,PATNM,XCODE,LRBETST,LRBETSTN
"RTN","LRBEPEND",87,0)
 S TOTPAN=TOTPAN+1
"RTN","LRBEPEND",88,0)
 S SETLN="S LINE=LINE+1,^TMP(""LRPENDING"",$J,LINE,0)=X"
"RTN","LRBEPEND",89,0)
 S X=$P(^DPT(LRBEDFN,0),U,1,9),PATNM=$E($P(X,U,1),1,20)_" ("_$E($P(X,U,9),6,9)_")"
"RTN","LRBEPEND",90,0)
 S LRBETST=$P(LRTEST(1),U,1)
"RTN","LRBEPEND",91,0)
 S LRBETSTN=$P(^LAB(60,LRBETST,0),U,1),LRBETSTN="["_LRBETST_"] "_$E(LRBETSTN,1,26)
"RTN","LRBEPEND",92,0)
 S:$G(LRBECDT)="" LRBECDT=DT D PANEL^LRBEBA4
"RTN","LRBEPEND",93,0)
 S X=$$SETSTR^VALM1(LRUID,"",1,10)
"RTN","LRBEPEND",94,0)
 S X=$$SETSTR^VALM1(PATNM,X,14,28),X=$$SETSTR^VALM1(LRBETSTN,X,44,34) X SETLN
"RTN","LRBEPEND",95,0)
 S C=$O(LRBECPT(LRBETST,1,0))
"RTN","LRBEPEND",96,0)
 I C D
"RTN","LRBEPEND",97,0)
 . S XCODE=$P($$CPT^ICPTCOD(C),U,2,3),XCODE=$TR(XCODE,"^"," "),XCODE=$E(XCODE,1,30)
"RTN","LRBEPEND",98,0)
 . S X=$$SETSTR^VALM1("Panel CPT Code:","",14,16),X=$$SETSTR^VALM1(XCODE,X,32,40) X SETLN
"RTN","LRBEPEND",99,0)
 . S CX=LRBECPT(LRBETST,1,C),X=$$SETSTR^VALM1(CX,"",32,40) X SETLN
"RTN","LRBEPEND",100,0)
 I 'C D
"RTN","LRBEPEND",101,0)
 . S X=$$SETSTR^VALM1("Panel CPT Code:","",14,16),X=$$SETSTR^VALM1("<No active CPT available>",X,32,40) X SETLN
"RTN","LRBEPEND",102,0)
 S X=" " X SETLN
"RTN","LRBEPEND",103,0)
 Q
"RTN","LRBEPEND",104,0)
 ;
"RTN","LRBEPEND",105,0)
MAILRPT ;Set intro & send pending panel report to user
"RTN","LRBEPEND",106,0)
 N XMY,XMSUB,XMDUZ,XMTEXT,XMZ,X,X1,Y,SETLN,LINE,DASH,REPDT
"RTN","LRBEPEND",107,0)
 S STARTDT=$P(STARTDT,".",1)
"RTN","LRBEPEND",108,0)
 I ENDDT S ENDDT=$P(ENDDT,".",1),X=ENDDT D
"RTN","LRBEPEND",109,0)
 .S X1=X,X=+$E(X,4,5),X=$S("^1^3^5^7^8^10^12^"[(U_X_U):31,X'=2:30,$E(X1,1,3)#4:28,1:29)
"RTN","LRBEPEND",110,0)
 .I $E(X1,6,7)>X S $E(ENDDT,6,7)=X
"RTN","LRBEPEND",111,0)
 S LINE=0,SETLN="S LINE=LINE+1,^TMP(""LRPENDING"",$J,LINE,0)=X"
"RTN","LRBEPEND",112,0)
 S $P(DASH,"-",78)=""
"RTN","LRBEPEND",113,0)
 S X=" " X SETLN
"RTN","LRBEPEND",114,0)
 S X="This report provides a listing of AMA/Billable panel tests that are pending" X SETLN
"RTN","LRBEPEND",115,0)
 S X="completion as of the Report Date/Time.  The Sample Collection Date for the" X SETLN
"RTN","LRBEPEND",116,0)
 S X="panel test falls within the date range indicated by Start Date and End Date." X SETLN
"RTN","LRBEPEND",117,0)
 S X="One or more of the 'required' atomic tests comprising the panel do not yet" X SETLN
"RTN","LRBEPEND",118,0)
 S X="have a verified result." X SETLN
"RTN","LRBEPEND",119,0)
 S X=" " X SETLN
"RTN","LRBEPEND",120,0)
 S X="Normally, panel tests flagged as 'AMA/Billable' should be reported to PCE" X SETLN
"RTN","LRBEPEND",121,0)
 S X="using the CPT Code of the panel.  In order for the panel CPT Code to be" X SETLN
"RTN","LRBEPEND",122,0)
 S X="sent to PCE, a verified result must be present for each 'required' atomic" X SETLN
"RTN","LRBEPEND",123,0)
 S X="test comprising the panel.  If all required atomic tests have not been" X SETLN
"RTN","LRBEPEND",124,0)
 S X="verified by the Next Lab Roll-up Date, then the CPT Codes for the individual" X SETLN
"RTN","LRBEPEND",125,0)
 S X="atomic tests will be sent to PCE." X SETLN
"RTN","LRBEPEND",126,0)
 S X=" " X SETLN
"RTN","LRBEPEND",127,0)
 S X="Note: This report may not show any panels if it is run after the roll-up to" X SETLN
"RTN","LRBEPEND",128,0)
 S X="PCE but before the end of the month. Please consult the Roll-up to PCE Report" X SETLN
"RTN","LRBEPEND",129,0)
 S X="sent to G.LIM for information on unbundled panels not reported here." X SETLN
"RTN","LRBEPEND",130,0)
 S X=" " X SETLN
"RTN","LRBEPEND",131,0)
 S X=" " X SETLN
"RTN","LRBEPEND",132,0)
 S Y=$$NOW^XLFDT() D DD^%DT S REPDT=Y
"RTN","LRBEPEND",133,0)
 S X="Report Date/Time         : "_REPDT X SETLN
"RTN","LRBEPEND",134,0)
 I LRBERLDT S Y=LRBERLDT D DD^%DT S LRBERLDT=Y
"RTN","LRBEPEND",135,0)
 S X="Next Lab Roll-up Date    : "_LRBERLDT X SETLN
"RTN","LRBEPEND",136,0)
 I STARTDT S Y=STARTDT D DD^%DT S STARTDT=Y
"RTN","LRBEPEND",137,0)
 S X="Start Date               : "_STARTDT X SETLN
"RTN","LRBEPEND",138,0)
 I ENDDT S Y=ENDDT D DD^%DT S ENDDT=Y
"RTN","LRBEPEND",139,0)
 S X="End Date                 : "_ENDDT X SETLN
"RTN","LRBEPEND",140,0)
 S X="Total # Panels           : "_$G(TOTPAN) X SETLN
"RTN","LRBEPEND",141,0)
 S X=" " X SETLN
"RTN","LRBEPEND",142,0)
 S X=" " X SETLN
"RTN","LRBEPEND",143,0)
 S X=$$SETSTR^VALM1("Unique","",1,10) X SETLN
"RTN","LRBEPEND",144,0)
 S X=$$SETSTR^VALM1("Identifier",X,1,10),X=$$SETSTR^VALM1("Patient",X,14,28)
"RTN","LRBEPEND",145,0)
 S X=$$SETSTR^VALM1("Panel Test",X,44,34) X SETLN
"RTN","LRBEPEND",146,0)
 S X=$$SETSTR^VALM1(DASH,"",1,78) X SETLN
"RTN","LRBEPEND",147,0)
 S XMSUB="AMA/Billable Panel Pending List "_REPDT
"RTN","LRBEPEND",148,0)
 S XMDUZ=.5
"RTN","LRBEPEND",149,0)
 S XMY(DUZ)=""
"RTN","LRBEPEND",150,0)
 S XMTEXT="^TMP(""LRPENDING"",$J,"
"RTN","LRBEPEND",151,0)
 D ^XMD
"RTN","LRBEPEND",152,0)
 K ^TMP("LRPENDING",$J)
"RTN","LRBEPEND",153,0)
 Q
"RTN","LRBEPRPT")
0^42^B37091351
"RTN","LRBEPRPT",1,0)
LRBEPRPT ;DALOI/FHS - PRINT CPT CODES FOR TESTS AND PANELS; 3/30/2005
"RTN","LRBEPRPT",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRBEPRPT",3,0)
BEBA ;Individual test CPT code look-up
"RTN","LRBEPRPT",4,0)
 K ^TMP("LR",$J,"VTO"),^TMP("LR",$J,"TMP")
"RTN","LRBEPRPT",5,0)
 S (LRBEPSY,LRBECPT)="" K DIR,X,Y,LRSTOP,LRPG
"RTN","LRBEPRPT",6,0)
 S LRBECDT=DT
"RTN","LRBEPRPT",7,0)
 S DIR(0)="PO^60:AQEZNM"
"RTN","LRBEPRPT",8,0)
 S DIR("S")="I $S('$L($P(^(0),U,3)):0,$P(^(0),U,3)=""N"":0,1:1)"
"RTN","LRBEPRPT",9,0)
 D ^DIR K DIR
"RTN","LRBEPRPT",10,0)
 I $G(Y)<1 D END Q
"RTN","LRBEPRPT",11,0)
 W @IOF
"RTN","LRBEPRPT",12,0)
 S LRBELOP=1,LRBEBY=Y,LRPRT=0
"RTN","LRBEPRPT",13,0)
 D LOOP
"RTN","LRBEPRPT",14,0)
 I $G(OUT) D  Q
"RTN","LRBEPRPT",15,0)
 . W !,+LRBEBY_"  = "_$P(^LAB(60,+LRBEBY,0),U)
"RTN","LRBEPRPT",16,0)
 . W !,"**********     ","Invalid data prevents display.",!
"RTN","LRBEPRPT",17,0)
 D:'$G(OUT) T1
"RTN","LRBEPRPT",18,0)
 D END
"RTN","LRBEPRPT",19,0)
 G BEBA
"RTN","LRBEPRPT",20,0)
LOOP ;
"RTN","LRBEPRPT",21,0)
 Q:$G(LRBEPSY)!($G(LRSTOP))
"RTN","LRBEPRPT",22,0)
 S:'$G(LRSPEC) LRSPEC=99999999 S:'$G(LRBECDT) LRBECDT=DT
"RTN","LRBEPRPT",23,0)
 K DIC,LRTEST,LRNAME,LRNLT,T1,LRY,LRBECPT,LRBEY,LRORD
"RTN","LRBEPRPT",24,0)
 K LRM,LRMX
"RTN","LRBEPRPT",25,0)
 K ^TMP("LR",$J,"VTO"),^TMP("LR",$J,"TMP")
"RTN","LRBEPRPT",26,0)
 S LRBECPT=""
"RTN","LRBEPRPT",27,0)
 S X=+LRBEBY_U_+LRBEBY,LRNLT=+LRBEBY,LRTEST(1,"P")=LRNLT_U_$$NLT^LRVER1(LRNLT)
"RTN","LRBEPRPT",28,0)
 S T1=1,LRTEST(T1)=+LRBEBY_U_^LAB(60,+LRBEBY,0)
"RTN","LRBEPRPT",29,0)
 S OUT=0,XX=$P(LRTEST(T1),U,6) D  Q:OUT
"RTN","LRBEPRPT",30,0)
 . I XX'="",+$P(XX,";",2)=0 S OUT=1 Q
"RTN","LRBEPRPT",31,0)
 . I $D(^LAB(60,+LRBEBY,2)) D
"RTN","LRBEPRPT",32,0)
 . . S I=0 F  S I=$O(^LAB(60,+LRBEBY,2,I)) Q:'I  Q:OUT  D
"RTN","LRBEPRPT",33,0)
 . . . S K=^LAB(60,+LRBEBY,2,I,0)
"RTN","LRBEPRPT",34,0)
 . . . S XX=$P(^LAB(60,K,0),U,5) I XX'="",+$P(XX,";",2)=0 S OUT=1
"RTN","LRBEPRPT",35,0)
 D EX1^LRVER1 K LRBECPT
"RTN","LRBEPRPT",36,0)
 S LRBETST=0,(LRPANEL,LRBEPYS)=""
"RTN","LRBEPRPT",37,0)
 S LRBETST=$O(LRBEY(LRBETST)) Q:LRBETST<1!($G(LRSTOP))  D
"RTN","LRBEPRPT",38,0)
 . Q:'$G(^LAB(60,LRBETST,12))
"RTN","LRBEPRPT",39,0)
 . Q:$L($P(^LAB(60,LRBETST,0),U,5))
"RTN","LRBEPRPT",40,0)
 . D PANEL^LRBEBA4
"RTN","LRBEPRPT",41,0)
 . I '$O(LRBECPT(LRBETST,0)) Q
"RTN","LRBEPRPT",42,0)
 . S LRPANEL="*"
"RTN","LRBEPRPT",43,0)
 . S LRBEPSY=1 D DISPLAY
"RTN","LRBEPRPT",44,0)
 . S (LRPANEL)=""
"RTN","LRBEPRPT",45,0)
 . W !
"RTN","LRBEPRPT",46,0)
PANEL ;Display panel test CPT
"RTN","LRBEPRPT",47,0)
 I $G(LRBEPSY) K LRBECPT Q
"RTN","LRBEPRPT",48,0)
 I $O(LRBECPT(0)) D  Q:$G(LRBELOP)!($G(LRSTOP))
"RTN","LRBEPRPT",49,0)
 . S LRBEPYS=1 D DISPLAY
"RTN","LRBEPRPT",50,0)
 Q:$S($G(LRBEPO):1,$G(LRBEPYS):1,1:0)
"RTN","LRBEPRPT",51,0)
 K LRBECPT
"RTN","LRBEPRPT",52,0)
 S LRTST=0,LRBETST=+LRBEBY
"RTN","LRBEPRPT",53,0)
NLT ;
"RTN","LRBEPRPT",54,0)
 S LRBECDT=DT D PANEL^LRBEBA4
"RTN","LRBEPRPT",55,0)
 Q:'$O(LRBECPT(0))
"RTN","LRBEPRPT",56,0)
 S LRI=0 F  S LRI=$O(LRBECPT(LRBETST,LRI)) Q:LRI<1!($G(LRSTOP))  D
"RTN","LRBEPRPT",57,0)
 . D LN Q:$G(LRSTOP)
"RTN","LRBEPRPT",58,0)
 . ;W !,"{"_LRBETST_"="_$P(^LAB(60,LRBETST,0),U)_"} "_$P($G(LRBEBY),U,2)
"RTN","LRBEPRPT",59,0)
 . ;W:$D(^LAB(61,LRSPEC,0))#2 "  (SPEC) = "_$E($P(^(0),U),1,30)
"RTN","LRBEPRPT",60,0)
 . S LRREQ=$S($P($G(^LAB(60,LRBETST,0)),U,17):"r ",1:" ")
"RTN","LRBEPRPT",61,0)
 . W !,LRBETST_" = "_LRREQ_$P($G(LRBEBY),U,2)_"  "  ;_$P(^LAB(60,LRBETST,0),U) 
"RTN","LRBEPRPT",62,0)
 . W:$D(^LAB(61,LRSPEC,0))#2 " (SPEC) = "_$E($P(^(0),U),1,30)
"RTN","LRBEPRPT",63,0)
 . D WRT
"RTN","LRBEPRPT",64,0)
 Q
"RTN","LRBEPRPT",65,0)
DISPLAY ;
"RTN","LRBEPRPT",66,0)
 Q:$G(LRSTOP)  K LRREQ
"RTN","LRBEPRPT",67,0)
 I $O(LRBECPT(0)),'$G(LRPRT) W ! S LRPRT=1
"RTN","LRBEPRPT",68,0)
 S LRBETST=0 F  S LRBETST=$O(LRBECPT(LRBETST)) Q:LRBETST<1!($G(LRSTOP))  D
"RTN","LRBEPRPT",69,0)
 . D LN Q:$G(LRSTOP)
"RTN","LRBEPRPT",70,0)
 . S LRREQ=$S($P($G(^LAB(60,LRBETST,0)),U,17):"r ",1:" ")
"RTN","LRBEPRPT",71,0)
 . W !,LRBETST_"  = "_LRREQ_$P(^LAB(60,LRBETST,0),U) I $D(^LAB(61,LRSPEC,0))#2 W " / "_$P(^(0),U)
"RTN","LRBEPRPT",72,0)
 . S LRI=0 F  S LRI=$O(LRBECPT(LRBETST,LRI)) Q:LRI<1  D WRT
"RTN","LRBEPRPT",73,0)
 Q
"RTN","LRBEPRPT",74,0)
WRT ;
"RTN","LRBEPRPT",75,0)
 D LN Q:$G(LRSTOP)
"RTN","LRBEPRPT",76,0)
 S LRPRT=1
"RTN","LRBEPRPT",77,0)
 S LRCPT=$O(LRBECPT(LRBETST,LRI,0)) Q:'LRCPT!($G(LRSTOP))  D
"RTN","LRBEPRPT",78,0)
 . D LN Q:$G(LRSTOP)
"RTN","LRBEPRPT",79,0)
 . S XCODE=$$CPT^ICPTCOD(LRCPT)
"RTN","LRBEPRPT",80,0)
 . W !?8,$P(XCODE,U,2)_"  "_$P(XCODE,U,3)_"  ["_LRBECPT(LRBETST,LRI,LRCPT)_"]"_$G(LRPANEL)
"RTN","LRBEPRPT",81,0)
 . K LRBECPT(LRBETST,LRI,LRCPT),XCODE
"RTN","LRBEPRPT",82,0)
 Q
"RTN","LRBEPRPT",83,0)
END ;Clean-up
"RTN","LRBEPRPT",84,0)
 W:$D(ZTQUEUED) @IOF
"RTN","LRBEPRPT",85,0)
 K DIC,DIR,DIRUT,DTOUT,DUOUT
"RTN","LRBEPRPT",86,0)
 K LRBEBY,LRBECPT,LRBECDT,LRBEDT,LRBELOP,LRBEPYS,LRBEYS,LRBENLT,LRBETST,LRBEY,LRCFL
"RTN","LRBEPRPT",87,0)
 K LRCPT,LRI,LRIEN,LRM,LRMX,LRNAME,LRNLT,LRNX,LRORD,LRBEPO,LRPANEL,LRPRT
"RTN","LRBEPRPT",88,0)
 K LRSPEC,LRSTOP,LRSUB,LRTEST,LRTN,LRTST,LRXX,LRY,S2,T1,X,Y,YY
"RTN","LRBEPRPT",89,0)
 K LRHDR,LRDEV,LRPG,POP
"RTN","LRBEPRPT",90,0)
 K ^TMP("LR",$J,"VTO"),^TMP("LR",$J,"TMP")
"RTN","LRBEPRPT",91,0)
 D ^%ZISC
"RTN","LRBEPRPT",92,0)
 Q
"RTN","LRBEPRPT",93,0)
TEST ;List all test with CPT codes
"RTN","LRBEPRPT",94,0)
 ;logic follows the Billing Aware CPT logic Hierarchy
"RTN","LRBEPRPT",95,0)
  U IO
"RTN","LRBEPRPT",96,0)
  I '$G(LRPG) D HDR
"RTN","LRBEPRPT",97,0)
 S LRBELOP=1,LRTN="A",LRBECDT=DT
"RTN","LRBEPRPT",98,0)
  S LRTN="^LAB(60,""B"")"
"RTN","LRBEPRPT",99,0)
 F  Q:$G(LRSTOP)  S LRTN=$Q(@LRTN) Q:$QS(LRTN,2)'="B"  D
"RTN","LRBEPRPT",100,0)
 . Q:$G(@LRTN)
"RTN","LRBEPRPT",101,0)
 . S LRSPEC=999999,LRBEBY=$QS(LRTN,4)
"RTN","LRBEPRPT",102,0)
 . Q:$S('$D(^LAB(60,LRBEBY,0))#2:1,'$L($P(^(0),U,3)):1,$P(^(0),U,3)="N":1,1:0)
"RTN","LRBEPRPT",103,0)
 . Q:$G(LRSTOP)
"RTN","LRBEPRPT",104,0)
 . S LRPRT=0,LRBEPSY=""
"RTN","LRBEPRPT",105,0)
 . S LRBEBY=LRBEBY_U_$P(^LAB(60,+LRBEBY,0),U) D LOOP
"RTN","LRBEPRPT",106,0)
 . Q:$G(OUT)
"RTN","LRBEPRPT",107,0)
 . Q:$G(LRSTOP)
"RTN","LRBEPRPT",108,0)
 . ;Q:$G(LRBEPSY)!($G(LRSTOP))
"RTN","LRBEPRPT",109,0)
 . S LRBEBY=$QS(LRTN,4)_U_$P(^LAB(60,+LRBEBY,0),U) D T1
"RTN","LRBEPRPT",110,0)
 . Q:$G(LRSTOP)
"RTN","LRBEPRPT",111,0)
 D END
"RTN","LRBEPRPT",112,0)
 Q
"RTN","LRBEPRPT",113,0)
T1 ;
"RTN","LRBEPRPT",114,0)
 S LRSPEC=0 F  S LRSPEC=$O(^LAB(60,+LRBEBY,1,LRSPEC)) Q:LRSPEC<1!($G(LRSTOP))  D
"RTN","LRBEPRPT",115,0)
 . D LOOP
"RTN","LRBEPRPT",116,0)
 . K LRBECPT
"RTN","LRBEPRPT",117,0)
 Q:$G(OUT)
"RTN","LRBEPRPT",118,0)
 Q:$G(LRSTOP)
"RTN","LRBEPRPT",119,0)
  D ATOMIC
"RTN","LRBEPRPT",120,0)
 I $G(LRPRT) W !
"RTN","LRBEPRPT",121,0)
 K LRBEPSY
"RTN","LRBEPRPT",122,0)
 Q
"RTN","LRBEPRPT",123,0)
AMA ;Print panels only
"RTN","LRBEPRPT",124,0)
 I '$G(LRPG) D HDR
"RTN","LRBEPRPT",125,0)
 S LRBEPO=1,LRBECDT=DT D TEST
"RTN","LRBEPRPT",126,0)
 Q
"RTN","LRBEPRPT",127,0)
ASK ;Present user with a selection of options
"RTN","LRBEPRPT",128,0)
 K DIR,Y,LRSTOP,POP,ZTRTN,OUT,XX
"RTN","LRBEPRPT",129,0)
 S OUT=0
"RTN","LRBEPRPT",130,0)
 S LRBECDT=DT
"RTN","LRBEPRPT",131,0)
 S DIR(0)="SO^1:Single Test Look-up;2:List Panels Only;3:List All Test"
"RTN","LRBEPRPT",132,0)
  D ^DIR K DIR
"RTN","LRBEPRPT",133,0)
 I Y<1 G END
"RTN","LRBEPRPT",134,0)
 I Y=1 D  G ASK
"RTN","LRBEPRPT",135,0)
 . S LRHDR="*** Single Test code listing (CPT) ***"
"RTN","LRBEPRPT",136,0)
 . D BEBA
"RTN","LRBEPRPT",137,0)
 I Y=2 D  G ASK
"RTN","LRBEPRPT",138,0)
 . S LRHDR="*** Panel Tests Only (CPT) ***"
"RTN","LRBEPRPT",139,0)
 . D DEV I $G(POP) D ^%ZISC Q
"RTN","LRBEPRPT",140,0)
 . I IO'=IO(0) D  Q
"RTN","LRBEPRPT",141,0)
 . . S ZTRTN="AMA^LRBEPRPT"
"RTN","LRBEPRPT",142,0)
 . . D LOAD
"RTN","LRBEPRPT",143,0)
 . D AMA
"RTN","LRBEPRPT",144,0)
 I Y=3 D  G ASK
"RTN","LRBEPRPT",145,0)
 . D DEV I $G(POP) D ^%ZISC Q
"RTN","LRBEPRPT",146,0)
 . S LRHDR="*** All Lab Tests (CPT) ***",LRPG=0
"RTN","LRBEPRPT",147,0)
 . I IO'=IO(0) D  Q
"RTN","LRBEPRPT",148,0)
 . . S ZTRTN="TEST^LRBEPRPT"
"RTN","LRBEPRPT",149,0)
 . . D LOAD
"RTN","LRBEPRPT",150,0)
 . D TEST
"RTN","LRBEPRPT",151,0)
 Q
"RTN","LRBEPRPT",152,0)
DEV ;Select print device
"RTN","LRBEPRPT",153,0)
 N %ZIS,LRMSG,ZTDESC,ZTDTH,ZTIO,ZTSK,ZTSAVE
"RTN","LRBEPRPT",154,0)
 S %ZIS="NQ",%ZIS("A")=" Select Print Device: "
"RTN","LRBEPRPT",155,0)
 S (LRDEV,%ZIS("B"))="Home" D ^%ZIS
"RTN","LRBEPRPT",156,0)
 Q
"RTN","LRBEPRPT",157,0)
LOAD ;%ZTLOAD section
"RTN","LRBEPRPT",158,0)
 N LRDEV,ZTDTH,ZTDESC,ZTIO,ZTSAVE
"RTN","LRBEPRPT",159,0)
 S ZTDTH=$H
"RTN","LRBEPRPT",160,0)
 S ZTDESC=$G(LRHDR)
"RTN","LRBEPRPT",161,0)
 S (LRDEV,ZTIO)=ION,ZTSAVE("LRHDR")=""
"RTN","LRBEPRPT",162,0)
 D ^%ZTLOAD W @IOF,!,$S($G(ZTSK):"Queued to device "_LRDEV,1:"Not Queued"),!
"RTN","LRBEPRPT",163,0)
 D ^%ZISC
"RTN","LRBEPRPT",164,0)
 D HOME^%ZIS
"RTN","LRBEPRPT",165,0)
 Q
"RTN","LRBEPRPT",166,0)
LN ;Check line spacing
"RTN","LRBEPRPT",167,0)
 Q:$Y<(IOSL-4)!($G(LRSTOP))
"RTN","LRBEPRPT",168,0)
 I $E(IOST,1)="C" D  Q:LRSTOP
"RTN","LRBEPRPT",169,0)
 . N DIR S DIR(0)="E" D ^DIR S LRSTOP=$G(DIRUT)
"RTN","LRBEPRPT",170,0)
HDR ;Report header
"RTN","LRBEPRPT",171,0)
 W @IOF,! S LRPG=$G(LRPG)+1
"RTN","LRBEPRPT",172,0)
 W $$CJ^XLFSTR($G(LRHDR)_"         "_$$FMTE^XLFDT(DT,5)_"    Pg "_LRPG,IOM),!
"RTN","LRBEPRPT",173,0)
 Q
"RTN","LRBEPRPT",174,0)
ATOMIC ; Print Atomic test of panel
"RTN","LRBEPRPT",175,0)
 Q:'$O(^LAB(60,+LRBEBY,2,0))  W !,+LRBEBY_" = "_$P(^LAB(60,+LRBEBY,0),U),!,"**********"
"RTN","LRBEPRPT",176,0)
 N LRBEBSY,LRII,LRREQ
"RTN","LRBEPRPT",177,0)
 S LRBEBSY=+LRBEBY N LRII S LRII=0
"RTN","LRBEPRPT",178,0)
 F  S LRII=$O(^LAB(60,LRBEBSY,2,LRII)) Q:LRII<1!($G(LRSTOP))  D
"RTN","LRBEPRPT",179,0)
 . S LRBEBY=+$G(^LAB(60,LRBEBSY,2,LRII,0)) Q:'LRBEBY!($G(LRSTOP))  D
"RTN","LRBEPRPT",180,0)
 . . S LRREQ=$S($P($G(^LAB(60,LRBEBY,0)),U,17):"r",1:" ")
"RTN","LRBEPRPT",181,0)
 . . I $D(^LAB(60,LRBEBY,0)) S LRBEBY=LRREQ_"["_LRBEBY_"]  "_$P(^(0),U) D
"RTN","LRBEPRPT",182,0)
 . . . W ?15,LRBEBY,! D LN
"RTN","LRBEPRPT",183,0)
 Q
"RTN","LRCAPPH1")
0^18^B49109396^B42645479
"RTN","LRCAPPH1",1,0)
LRCAPPH1 ;DALOI/SED/RKS/KLL - PROCESS PHLEBOTOMY WORKLOAD DATA CONT ;07/30/04
"RTN","LRCAPPH1",2,0)
 ;;5.2;LAB SERVICE;**127,136,138,158,263,264,274,291**;Sep 27, 1994
"RTN","LRCAPPH1",3,0)
 ; Reference to  ^SC( Supported by DBIA #1482
"RTN","LRCAPPH1",4,0)
 ; Reference to  $$CODM^ICPTCOD Supported by DBIA #1995-A
"RTN","LRCAPPH1",5,0)
 ; Reference to  $$CPT^ICPTCOD Supported by DBIA #1995-A
"RTN","LRCAPPH1",6,0)
 ; Reference to  $$DATA2PCE^PXAPI Supported by DBIA #1889-A
"RTN","LRCAPPH1",7,0)
 ; Reference to  $$DELVFILE^PXAPI Supported by DBIA #1889-B
"RTN","LRCAPPH1",8,0)
 ; Reference to  ENCEVENT^PXKENC Supported by DBIA #1889-F
"RTN","LRCAPPH1",9,0)
 ; Reference to  $$NOW^XLFDT Supported by Reference #10103
"RTN","LRCAPPH1",10,0)
 ; Reference to  $$GET^XUA4A72 Supported by Reference #1625
"RTN","LRCAPPH1",11,0)
EN3 ;LREDT = PATIENT ENCOUNTER DATE
"RTN","LRCAPPH1",12,0)
 N LREDT,LRNOP
"RTN","LRCAPPH1",13,0)
 K ^TMP("LRPXAPI",$J),LRXTST,LRVSITN,LRXCPT
"RTN","LRCAPPH1",14,0)
NP ;Not perform entry
"RTN","LRCAPPH1",15,0)
 S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=""
"RTN","LRCAPPH1",16,0)
 ;Turn off old style PCE reporting for CH subscripts.
"RTN","LRCAPPH1",17,0)
 ;Data passed via Billing Aware API
"RTN","LRCAPPH1",18,0)
 I $G(LRDAA),$P($G(^LRO(68,LRDAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",19,0)
 I $G(LRAA),$P($G(^LRO(68,LRAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",20,0)
 ;
"RTN","LRCAPPH1",21,0)
 S LREDT=$P($G(^LRO(69,LRCDT,1,LRSN,1)),U)
"RTN","LRCAPPH1",22,0)
 N LRDUZ
"RTN","LRCAPPH1",23,0)
 Q:+LREDT'>0!('$D(^LR(+NODE,0))#2)
"RTN","LRCAPPH1",24,0)
 S:$G(LRDBUG) LREDT=$$NOW^XLFDT
"RTN","LRCAPPH1",25,0)
 S EDATE=$P(LREDT,".")
"RTN","LRCAPPH1",26,0)
 S:'$P(LREDT,".",2) $P(LREDT,".",2)="1201"
"RTN","LRCAPPH1",27,0)
 S LOC=+$P(NODE,U,9),LRNINS=$P(NODE(1),U,8),LRPRO=+$P(NODE,U,6) ;CHECK
"RTN","LRCAPPH1",28,0)
 S LRDUZ=+$P(NODE,U,2)
"RTN","LRCAPPH1",29,0)
 S LRNINS=$S($P($G(^SC(LOC,0)),U,4):$P(^(0),U,4),$G(LRNINS):LRNINS,1:LRINS)
"RTN","LRCAPPH1",30,0)
 S LRPRO=$S($$GET^XUA4A72(LRPRO,EDATE)>0:LRPRO,1:LRDPRAC)
"RTN","LRCAPPH1",31,0)
 I $S('$G(LOC):1,"CMZ"'[$P($G(^SC(LOC,0)),U,3):1,1:0) Q
"RTN","LRCAPPH1",32,0)
 S:'$D(^LRO(69,LRCDT,1,LRSN,"PCE")) ^("PCE")=""
"RTN","LRCAPPH1",33,0)
 I $S('DFN:1,'LOC:1,1:0) S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=1 S LRNOP=1 Q
"RTN","LRCAPPH1",34,0)
 I 'LRNINS S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=2 S LRNOP=2 Q
"RTN","LRCAPPH1",35,0)
 I 'LRPRO S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=3 S LRNOP=3 Q
"RTN","LRCAPPH1",36,0)
 Q:$G(LRNP)
"RTN","LRCAPPH1",37,0)
EN5 ;GET THE CPT CODES FOR THE TESTS
"RTN","LRCAPPH1",38,0)
 I LRCDT,LRSN,$D(^LRO(69,LRCDT,1,LRSN,2,0)) D
"RTN","LRCAPPH1",39,0)
 . S (LRTST,LRCNT,LRXAA)=0 K LRXTST S LRXTST=""
"RTN","LRCAPPH1",40,0)
 . F  S LRTST=$O(^LRO(69,LRCDT,1,LRSN,2,LRTST)) Q:+LRTST'>0  D
"RTN","LRCAPPH1",41,0)
 . . Q:'$D(^LRO(69,LRCDT,1,LRSN,2,LRTST,0))#2  S LREN5=^(0)
"RTN","LRCAPPH1",42,0)
 . . Q:$S($P(LREN5,U,12):1,$P(LREN5,U,11):1,1:0)  ;Don't send cancel/already sent codes
"RTN","LRCAPPH1",43,0)
 . . S:'$G(LRDBUG) $P(^LRO(69,LRCDT,1,LRSN,2,LRTST,0),U,12)=1
"RTN","LRCAPPH1",44,0)
 . . S LRTSTP=+$P(LREN5,U),LRAA=+$P(LREN5,U,4) Q:$S('LRTSTP:1,'LRAA:1,1:0)
"RTN","LRCAPPH1",45,0)
 . . I $P($G(^LRO(68,LRAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",46,0)
 . . I 'LRXAA S LRXAA=LRAA D LOC
"RTN","LRCAPPH1",47,0)
 . . Q:'$G(LRDSSID)
"RTN","LRCAPPH1",48,0)
 . . I LRXAA'=LRAA,$D(^TMP("LRPXAPI",$J,"PROCEDURE")) D SEND K ^TMP("LRPXAPI",$J) S LRXAA=LRAA D LOC Q:'$G(LRDSSID)  D EN6 Q
"RTN","LRCAPPH1",49,0)
 . . D EN6
"RTN","LRCAPPH1",50,0)
 I $D(^TMP("LRPXAPI",$J,"PROCEDURE")),'$G(^LRO(69,"AA",LRCEX,LROA)) D SEND
"RTN","LRCAPPH1",51,0)
END Q:$G(LRDBUG)
"RTN","LRCAPPH1",52,0)
END0 K ^TMP("LRPXAPI",$J),LRINA,LRREL,LRNLT,CPT,LRPRO,LRICPT,EDATE,LRTST
"RTN","LRCAPPH1",53,0)
 K I,LOC,LRI,LRCNT,LRSTP,LRNINS,LROK,LRAA,LRXAA,LRDSSID,LREN5,LRXTST
"RTN","LRCAPPH1",54,0)
 K LRNLTN,LRIDT,LRXTSTU,LRXCPT
"RTN","LRCAPPH1",55,0)
 Q
"RTN","LRCAPPH1",56,0)
EN6 ;Called from LRCAPPNP
"RTN","LRCAPPH1",57,0)
 I $G(LRDAA),$P($G(^LRO(68,LRDAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",58,0)
 I $G(LRAA),$P($G(^LRO(68,LRAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",59,0)
 S LRNLT=+$P($G(^LAB(60,LRTSTP,64)),U),LRICPT=0
"RTN","LRCAPPH1",60,0)
 Q:+LRNLT'>0
"RTN","LRCAPPH1",61,0)
 Q:'$D(^LAM("AD",LRNLT,"CPT"))  S LRNLTN=$P(^LAM(LRNLT,0),U,2)
"RTN","LRCAPPH1",62,0)
 Q:'LRNLTN
"RTN","LRCAPPH1",63,0)
 F  S LRICPT=$O(^LAM("AD",LRNLT,"CPT",LRICPT)) Q:+LRICPT'>0  S CPT=+$P($G(^LAM(LRNLT,4,LRICPT,0)),U) I CPT,$P(^(0),U,2)="CPT" D
"RTN","LRCAPPH1",64,0)
 . Q:'$G(CPT)
"RTN","LRCAPPH1",65,0)
 . I '$P($$CPT^ICPTCOD(CPT,$P(LREDT,"."),,),U,7) S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=4 Q
"RTN","LRCAPPH1",66,0)
 . S LRREL=$P(^LAM(LRNLT,4,LRICPT,0),U,3),LRINA=$P(^(0),U,4)
"RTN","LRCAPPH1",67,0)
 . D:LRREL&(LRINA="") SET Q
"RTN","LRCAPPH1",68,0)
 . D:EDATE>(LRREL-1)&((EDATE<LRINA)!(LRINA="")) SET
"RTN","LRCAPPH1",69,0)
 Q
"RTN","LRCAPPH1",70,0)
LOC ;Called from LRCAPPNP
"RTN","LRCAPPH1",71,0)
 I '$G(LRAA) S LRNOP=4 Q
"RTN","LRCAPPH1",72,0)
 S LRDSSLOC=$S($G(^LRO(68,+LRAA,.8)):+^(.8),1:LRDLOC)
"RTN","LRCAPPH1",73,0)
 I 'LRDSSLOC S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=4 S LRNOP=4 Q
"RTN","LRCAPPH1",74,0)
 S LRDSSID=+$P($G(^SC(LRDSSLOC,0)),U,7)
"RTN","LRCAPPH1",75,0)
 I 'LRDSSID S:$D(^LRO(69,"AA",LRCEX,LROA)) ^(LROA)=5 S LRNOP=5
"RTN","LRCAPPH1",76,0)
 Q
"RTN","LRCAPPH1",77,0)
SET ;SET IF VALID PROCEDURE
"RTN","LRCAPPH1",78,0)
 I $G(LRNP),'$D(LRNPX(CPT))#2 Q
"RTN","LRCAPPH1",79,0)
 I '$D(^TMP("LRMOD",$J,CPT)) S ^(CPT)="" D
"RTN","LRCAPPH1",80,0)
 . N X
"RTN","LRCAPPH1",81,0)
 . S X=$$CODM^ICPTCOD(CPT,"^TMP(""LRMOD"",$J,CPT)",,)
"RTN","LRCAPPH1",82,0)
 I '$G(LRXCPT(CPT)) S LRCNT=$G(LRCNT)+1,LRXCPT(CPT)=LRCNT
"RTN","LRCAPPH1",83,0)
 S LRCNT=LRXCPT(CPT)
"RTN","LRCAPPH1",84,0)
 I '$G(LRNP) S LRXCPT(CPT,"P",LRCNT)=1+$G(LRXCPT(CPT,"P",LRCNT))
"RTN","LRCAPPH1",85,0)
 I $G(LRNP) D
"RTN","LRCAPPH1",86,0)
 . S LRXCPT(CPT,"P",LRCNT)=($G(LRNPX(CPT))-1)
"RTN","LRCAPPH1",87,0)
 . S LRNPX(CPT)=(LRNPX(CPT)-1)
"RTN","LRCAPPH1",88,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"ENC PROVIDER")=LRPRO
"RTN","LRCAPPH1",89,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"PROCEDURE")=CPT
"RTN","LRCAPPH1",90,0)
 I $G(LRNP) D
"RTN","LRCAPPH1",91,0)
 . Q:$G(LRXCPT(CPT,"P",LRCNT))>0
"RTN","LRCAPPH1",92,0)
 . S LRXCPT(CPT,"P",LRCNT)=1
"RTN","LRCAPPH1",93,0)
 . S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"DELETE")=1
"RTN","LRCAPPH1",94,0)
 S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"QTY")=$S($G(LRXCPT(CPT,"P",LRCNT)):LRXCPT(CPT,"P",LRCNT),1:1)
"RTN","LRCAPPH1",95,0)
 Q:$G(LRNP)
"RTN","LRCAPPH1",96,0)
 I $G(LRXCPT(CPT,"P",LRCNT))>1,$D(^TMP("LRMOD",$J,CPT,59))>0 D
"RTN","LRCAPPH1",97,0)
 . S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"MODIFIERS",59)=""
"RTN","LRCAPPH1",98,0)
 ;If Manual CPT coding always set modifier to 59 to force PCE to add CPT  code.
"RTN","LRCAPPH1",99,0)
 I $G(LRES) S ^TMP("LRPXAPI",$J,"PROCEDURE",LRCNT,"MODIFIERS",59)=""
"RTN","LRCAPPH1",100,0)
 S LRXTST(LRTST)=LRNLTN_U_LRTSTP
"RTN","LRCAPPH1",101,0)
 Q
"RTN","LRCAPPH1",102,0)
SEND ;BUILD ENCOUNTER INFO Called from LRCAPPNP
"RTN","LRCAPPH1",103,0)
 I '$G(LRESCPT) Q:$G(^LRO(69,"AA",$G(LRCEX),$G(LROA)))
"RTN","LRCAPPH1",104,0)
 ;Turn off old style PCE reporting - Reported by Billing Aware
"RTN","LRCAPPH1",105,0)
 I $G(LRAA),$P($G(^LRO(68,LRAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",106,0)
 I $G(LRDAA),$P($G(^LRO(68,LRDAA,0)),U,2)="CH" Q
"RTN","LRCAPPH1",107,0)
 ;
"RTN","LRCAPPH1",108,0)
 N LRENCDT ; Check for incorrect time
"RTN","LRCAPPH1",109,0)
 S LRENCDT=$J(LREDT,7,4),LRENCDT(1)=$P(LRENCDT,".",2)
"RTN","LRCAPPH1",110,0)
 S:'LRENCDT(1) LRENCDT(1)=1201
"RTN","LRCAPPH1",111,0)
 I $E(LRENCDT(1),3,4)>59 S LRENCDT(1)=$E(LRENCDT(1),1,2)_59
"RTN","LRCAPPH1",112,0)
 I $E(LRENCDT(1),1,2)>23 S LRENCDT(1)=23_$E(LRENCDT(1),3,4)
"RTN","LRCAPPH1",113,0)
 S $P(LRENCDT,".",2)=LRENCDT(1)
"RTN","LRCAPPH1",114,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"DSS ID")=LRDSSID
"RTN","LRCAPPH1",115,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"ENC D/T")=LRENCDT
"RTN","LRCAPPH1",116,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"HOS LOC")=LRDSSLOC
"RTN","LRCAPPH1",117,0)
 S:LRNINS ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"INSTITUTION")=LRNINS
"RTN","LRCAPPH1",118,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"PATIENT")=DFN
"RTN","LRCAPPH1",119,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"SERVICE CATEGORY")="X"
"RTN","LRCAPPH1",120,0)
 S ^TMP("LRPXAPI",$J,"ENCOUNTER",1,"ENCOUNTER TYPE")="A"
"RTN","LRCAPPH1",121,0)
PCE ;SEND DATA TO PCE
"RTN","LRCAPPH1",122,0)
 N LRLNOW
"RTN","LRCAPPH1",123,0)
 I $G(^XTMP("LRPCELOG",0)) D  ;Used to log/debug contents of ^TMP("LRPXAPI")
"RTN","LRCAPPH1",124,0)
 . F  S LRLNOW=$$NOW^XLFDT Q:'$D(^XTMP("LRPCELOG",1,LRLNOW))  H 1
"RTN","LRCAPPH1",125,0)
 . M ^XTMP("LRPCELOG",1,LRLNOW)=^TMP("LRPXAPI",$J)
"RTN","LRCAPPH1",126,0)
 K LRVSITN S (LROK,LRVSITN)=""
"RTN","LRCAPPH1",127,0)
 I $G(LRSS)="CH"!($G(LRSS)="MI") S LROK=1,LRVSITN=$G(LRBEVSIT)
"RTN","LRCAPPH1",128,0)
 I $G(LRSS)="AU"!($G(LRSS)="CY")!($G(LRSS)="EM")!($G(LRSS)="SP") D
"RTN","LRCAPPH1",129,0)
 .S LROK=$$DATA2PCE^PXAPI("^TMP(""LRPXAPI"",$J)",LRPKG,"LAB DATA",.LRVSITN,$G(LRDUZ))
"RTN","LRCAPPH1",130,0)
 I $G(^XTMP("LRPCELOG",0)),$G(LRLNOW) S ^XTMP("LRPCELOG",1,LRLNOW,"PCE")=LRVSITN
"RTN","LRCAPPH1",131,0)
 W:$G(LRDBUG) !,"LROK = ",LROK,!,$G(LRVSITN)
"RTN","LRCAPPH1",132,0)
 Q:$G(LRESCPT)
"RTN","LRCAPPH1",133,0)
 I '$G(LRNP),$D(^LRO(69,LRCDT,1,LRSN,"PCE")) S ^("PCE")=$E(^("PCE")_$S(LROK>0:LRVSITN,1:LROK)_";",1,30) D
"RTN","LRCAPPH1",134,0)
 . I LROK<1,$D(^LRO(69,"AA",LRCEX,LROA)) S ^(LROA)=LROK
"RTN","LRCAPPH1",135,0)
EN7 N LRFND,LRPCE
"RTN","LRCAPPH1",136,0)
 Q:'$G(LRNP)!(LROK<1)!('LRVSITN)
"RTN","LRCAPPH1",137,0)
 S LRPCE=$G(^LRO(69,LRCDT,1,LRSN,"PCE"))
"RTN","LRCAPPH1",138,0)
 I '$F(LRPCE,LRVSITN_"-CPT CANC") D
"RTN","LRCAPPH1",139,0)
 . S LRFND=$F(LRPCE,LRVSITN) Q:'LRFND
"RTN","LRCAPPH1",140,0)
 . I LRFND S LRPCE=$E(LRPCE,1,(LRFND-1))_"-CPT CANC"_$E(LRPCE,LRFND,$L(LRPCE))
"RTN","LRCAPPH1",141,0)
 . S ^LRO(69,LRCDT,1,LRSN,"PCE")=$E(LRPCE,1,30)
"RTN","LRCAPPH1",142,0)
CHK ;Determine if any CPT code remain on the encounter, then delete encounter if false
"RTN","LRCAPPH1",143,0)
 K ^TMP("PXKENC",$J)
"RTN","LRCAPPH1",144,0)
 D ENCEVENT^PXKENC(LRVSITN,1)
"RTN","LRCAPPH1",145,0)
 I $O(^TMP("PXKENC",$J,LRVSITN,"CPT",0)) K ^TMP("PXKENC",$J) Q
"RTN","LRCAPPH1",146,0)
 S LROK=$$DELVFILE^PXAPI("ALL",$G(LRVSITN),LRPKG,"LAB DATA",0,0,0)
"RTN","LRCAPPH1",147,0)
 K ^TMP("PXKENC",$J) Q:LROK<1
"RTN","LRCAPPH1",148,0)
 N LRSN
"RTN","LRCAPPH1",149,0)
 S LRSN=0
"RTN","LRCAPPH1",150,0)
 F  S LRSN=$O(^LRO(69,"C",LRCE,LRCDT,LRSN)) Q:LRSN<1  D DELCAN
"RTN","LRCAPPH1",151,0)
 Q
"RTN","LRCAPPH1",152,0)
DELCAN ;Mark PCE Encounter number as '-CPT CANC-ENC DEL'
"RTN","LRCAPPH1",153,0)
 ;LRVSITN = Encounter IEN
"RTN","LRCAPPH1",154,0)
 S LRPCE=$G(^LRO(69,LRCDT,1,LRSN,"PCE")) Q:'$L(LRPCE)  D
"RTN","LRCAPPH1",155,0)
 . Q:'$G(LRVSITN)
"RTN","LRCAPPH1",156,0)
 . I $F(LRPCE,LRVSITN_"-CPT CANC-ENC DEL;") Q
"RTN","LRCAPPH1",157,0)
 . S LRFND=$F($G(LRPCE),LRVSITN_"-CPT CANC") I LRFND D  Q
"RTN","LRCAPPH1",158,0)
 . . S LRPCE=$E(LRPCE,1,(LRFND-1))_"-ENC DEL"_$E(LRPCE,LRFND,$L(LRPCE))
"RTN","LRCAPPH1",159,0)
 . . S ^LRO(69,LRCDT,1,LRSN,"PCE")=$E(LRPCE,1,30)
"RTN","LRCAPPH1",160,0)
 . S LRFND=$F($G(LRPCE),LRVSITN) I LRFND D
"RTN","LRCAPPH1",161,0)
 . . S LRPCE=$E(LRPCE,1,(LRFND-1))_"-CPT CANC-ENC DEL"_$E(LRPCE,LRFND,$L(LRPCE))
"RTN","LRCAPPH1",162,0)
 . . S ^LRO(69,LRCDT,1,LRSN,"PCE")=$E(LRPCE,1,30)
"RTN","LRCAPPH1",163,0)
 Q
"RTN","LRCAPPH1",164,0)
TEST ;
"RTN","LRCAPPH1",165,0)
 S:'$G(LRDPRAC) LRDPRAC=DUZ
"RTN","LRCAPPH1",166,0)
 S LRDLOC=+$G(^LAB(69.9,1,.8))
"RTN","LRCAPPH1",167,0)
 S:'$G(LRPKG) LRPKG=26 S:'$G(LRDBUG) LRDBUG=1 S LRVSIT=2
"RTN","LRCAPPH1",168,0)
 S:'$G(LRCDT) LRCDT=DT S:'$G(LRSN) LRSN=1 S NODE=^LRO(69,LRCDT,1,LRSN,0)
"RTN","LRCAPPH1",169,0)
 S NODE(1)=^LRO(69,LRCDT,1,LRSN,1)
"RTN","LRCAPPH1",170,0)
 S DFN=$P(^LR(+NODE,0),U,3)
"RTN","LRCAPPH1",171,0)
 D EN3
"RTN","LRCAPPH1",172,0)
 Q
"RTN","LRCAPPH3")
0^46^B41949665^B22721141
"RTN","LRCAPPH3",1,0)
LRCAPPH3  ;DALOI/FHS/PC - CHECK CPT CODE AND FILE POINTERS ; 5/1/99
"RTN","LRCAPPH3",2,0)
 ;;5.2;LAB SERVICE;**263,291**;Sep 27, 1994
"RTN","LRCAPPH3",3,0)
 ;Called from LRCAPPH,LRCAPPH4
"RTN","LRCAPPH3",4,0)
EN ;
"RTN","LRCAPPH3",5,0)
 K ^TMP("LRCAPPH",$J),LRSEP S LRSEP(1)="==================="
"RTN","LRCAPPH3",6,0)
 S LRSEP(2)="****************"
"RTN","LRCAPPH3",7,0)
 K %DT S %DT="",X="T+5" D ^%DT S LRPGDT=Y
"RTN","LRCAPPH3",8,0)
 S ^TMP("LRCAPPH",$J,0)=Y_U_$$NOW^XLFDT_U_"LAB CPT DATA CHECKER"
"RTN","LRCAPPH3",9,0)
 S ^TMP("LRCAPPH60",$J,0)=Y_U_$$NOW^XLFDT_U_"LAB 60 CPT DATA CHECKER"
"RTN","LRCAPPH3",10,0)
 K %DT S %DT="" S X="T-1" D ^%DT S LRINADT=$$FMTE^XLFDT(Y,1)
"RTN","LRCAPPH3",11,0)
 S LRINADTX=Y K %DT
"RTN","LRCAPPH3",12,0)
AA  ;Look for CPT processing errors
"RTN","LRCAPPH3",13,0)
 D
"RTN","LRCAPPH3",14,0)
 . N LRAAN,LRCE,LRTXT,LRX
"RTN","LRCAPPH3",15,0)
 . S LRAAN="^LRO(69,""AA"")"
"RTN","LRCAPPH3",16,0)
 . F  S LRAAN=$Q(@LRAAN) Q:$QS(LRAAN,2)'="AA"  D
"RTN","LRCAPPH3",17,0)
 . . S LRX=@LRAAN Q:'LRX  S LRCE=$QS(LRAAN,3)
"RTN","LRCAPPH3",18,0)
 . . K LRTXT
"RTN","LRCAPPH3",19,0)
 . . S LRTXT="Lab Order Number "_LRCE_" "
"RTN","LRCAPPH3",20,0)
 . . I LRX<1 D
"RTN","LRCAPPH3",21,0)
 . . . S LRTXT(1)=LRTXT_" was rejected by the PCE API "
"RTN","LRCAPPH3",22,0)
 . . I LRX=2 D
"RTN","LRCAPPH3",23,0)
 . . . S LRTXT(1)=LRTXT_"has no Institution for the ordering location."
"RTN","LRCAPPH3",24,0)
 . . I LRX=3 D
"RTN","LRCAPPH3",25,0)
 . . . S LRTXT(1)=LRTXT_"Provider is InActive."
"RTN","LRCAPPH3",26,0)
 . . I LRX=4 D
"RTN","LRCAPPH3",27,0)
 . . . S LRTXT(1)=LRTXT_"Not Processed  "
"RTN","LRCAPPH3",28,0)
 . . . S LRTXT(2)=" - No DEFAULT LAB OOS LOCATION defined."
"RTN","LRCAPPH3",29,0)
 . . I LRX=5 D
"RTN","LRCAPPH3",30,0)
 . . . S LRTXT(1)=LRTXT_"Ordering Location "
"RTN","LRCAPPH3",31,0)
 . . . S LRTXT(2)=" has no STOP CODE NUMBER defined."
"RTN","LRCAPPH3",32,0)
 . . I $D(LRTXT(1)) S LRTXT(10)=LRSEP(1) D MSGSET("LRCAPPH",.LRTXT)
"RTN","LRCAPPH3",33,0)
LAM ;Look for inactive Codes and broken pointers.
"RTN","LRCAPPH3",34,0)
 ;in ^LAM
"RTN","LRCAPPH3",35,0)
 N LRI,LRXDT,LRY,LRII
"RTN","LRCAPPH3",36,0)
 S LRI=0 F  S LRI=$O(^LAM(LRI)) Q:LRI<1  D  I '$D(ZTQUEUED) W:'(LRI#50) "."
"RTN","LRCAPPH3",37,0)
 . I '$G(LRACT) Q:'$O(^LAM(LRI,7,0))
"RTN","LRCAPPH3",38,0)
 . S LRII=0 F  S LRII=$O(^LAM(LRI,4,LRII)) Q:LRII<1  D
"RTN","LRCAPPH3",39,0)
 . . I '$G(^LAM(LRI,4,LRII,0)) W:'$D(ZTQUEUED) !,"@@@@@@@@@@@",LRI,! D  Q
"RTN","LRCAPPH3",40,0)
 . .  . I '$L($P($G(^LAM(LRI,4,LRII,0)),U)) K ^LAM(LRI,4,LRII) Q
"RTN","LRCAPPH3",41,0)
 . .  . N DR,DA,DIE,DIK
"RTN","LRCAPPH3",42,0)
 . .  . S DA=LRII,DA(1)=LRI,DIK="^LAM("_LRI_",4," D ^DIK
"RTN","LRCAPPH3",43,0)
 . . K LRX S LRX=^LAM(LRI,4,LRII,0) D CK
"RTN","LRCAPPH3",44,0)
LAB ;Look for inactive Codes in ^LAB
"RTN","LRCAPPH3",45,0)
 N LRJ,LRN,LRSPEC,LRBECPT,MSGTYPE,MSGFLAG,DEFAULT,HCPCS,Y
"RTN","LRCAPPH3",46,0)
 S LRJ=0 F  S LRJ=$O(^LAB(60,LRJ)) Q:'LRJ  D
"RTN","LRCAPPH3",47,0)
 . S MSGFLAG=0
"RTN","LRCAPPH3",48,0)
 . S X=^LAB(60,LRJ,0),LRN=$P(X,U,1)
"RTN","LRCAPPH3",49,0)
 . I ($P(X,U,4)'="CH")&($P(X,U,4)'="MI") Q
"RTN","LRCAPPH3",50,0)
 . S LRSPEC=0 F  S LRSPEC=$O(^LAB(60,LRJ,1,LRSPEC)) Q:'LRSPEC  D
"RTN","LRCAPPH3",51,0)
 . . K LRBECPT
"RTN","LRCAPPH3",52,0)
 . . D IACPT(LRJ,DT,LRSPEC)
"RTN","LRCAPPH3",53,0)
 . . Q:('$D(LRBECPT(LRJ)))
"RTN","LRCAPPH3",54,0)
 . . S X=$O(LRBECPT(LRJ,1,0)) Q:'X
"RTN","LRCAPPH3",55,0)
 . . S MSGTYPE="SPECIMEN ("_LRSPEC_") CPT"
"RTN","LRCAPPH3",56,0)
 . . D MSG2(MSGTYPE)
"RTN","LRCAPPH3",57,0)
 . S X=$G(^LAB(60,LRJ,1.1)) S DEFAULT=$P(X,U,1),HCPCS=$P(X,U,2)
"RTN","LRCAPPH3",58,0)
 . I HCPCS D
"RTN","LRCAPPH3",59,0)
 . . S MSGTYPE="HCPCS CPT"
"RTN","LRCAPPH3",60,0)
 . . S X=HCPCS,Y=$$CPT^ICPTCOD(X,,,) I '$P(Y,U,7) S X=$P(Y,U,2) D MSG2(MSGTYPE)
"RTN","LRCAPPH3",61,0)
 . I DEFAULT D
"RTN","LRCAPPH3",62,0)
 . . S MSGTYPE="DEFAULT CPT"
"RTN","LRCAPPH3",63,0)
 . . S X=DEFAULT,Y=$$CPT^ICPTCOD(X,,,) I '$P(Y,U,7) S X=$P(Y,U,2) D MSG2(MSGTYPE)
"RTN","LRCAPPH3",64,0)
 . I MSGFLAG D MSGSET("LRCAPPH60",.LRMSG)
"RTN","LRCAPPH3",65,0)
 Q
"RTN","LRCAPPH3",66,0)
 ;
"RTN","LRCAPPH3",67,0)
IACPT(LRBETST,LRBECDT,LRSPEC) ; Get inactive specimen CPT
"RTN","LRCAPPH3",68,0)
 N A,ARR,LRBEAX,LRBEIEN,LRBEAR60,X
"RTN","LRCAPPH3",69,0)
 S LRBEIEN=LRSPEC_","_LRBETST_",",(LRI,LRBECPT)=""
"RTN","LRCAPPH3",70,0)
 D GETS^DIQ(60.01,LRBEIEN,"96*","I","LRBEAR60")
"RTN","LRCAPPH3",71,0)
 S A="" F  S A=$O(LRBEAR60(60.196,A)) Q:A=""  D
"RTN","LRCAPPH3",72,0)
 . Q:$G(LRBEAR60(60.196,A,1,"I"))=""
"RTN","LRCAPPH3",73,0)
 . S ARR($G(LRBEAR60(60.196,A,1,"I")))=$G(LRBEAR60(60.196,A,.01,"I"))
"RTN","LRCAPPH3",74,0)
 S X=$O(ARR(LRBECDT),-1) I X D
"RTN","LRCAPPH3",75,0)
 .S LRBEAX=ARR(X)
"RTN","LRCAPPH3",76,0)
 .S LRBEAX=$$CPT^ICPTCOD(LRBEAX,LRBECDT)
"RTN","LRCAPPH3",77,0)
 .I '$P(LRBEAX,U,7) S LRBECPT(LRBETST,1,$P(LRBEAX,U,2))="SPECIMEN CPT"
"RTN","LRCAPPH3",78,0)
 Q
"RTN","LRCAPPH3",79,0)
 ;
"RTN","LRCAPPH3",80,0)
EN0 ;Entry point for scan 64, scan 60, and mail reports to G.LMI
"RTN","LRCAPPH3",81,0)
 ;Called from LRCAPPH
"RTN","LRCAPPH3",82,0)
 D EN
"RTN","LRCAPPH3",83,0)
 D MAIL
"RTN","LRCAPPH3",84,0)
 D MAIL2
"RTN","LRCAPPH3",85,0)
END ;Called from LRCAPPH4
"RTN","LRCAPPH3",86,0)
 I $E($G(IOST),1,2)="P-" W @IOF
"RTN","LRCAPPH3",87,0)
 K DA,DIC,DIE,DIK,DR,I
"RTN","LRCAPPH3",88,0)
 K LRACT,LRCMT,LRINADT,LRINADTX,LRI,LRII,LRMSG,LRN,LRPGDT,LRTST,LRSEP,LRX
"RTN","LRCAPPH3",89,0)
 K LRTXT,X,XMTEXT,XMSUB,Y
"RTN","LRCAPPH3",90,0)
 K ^TMP("LRCAPPH",$J),^TMP("LRCAPPH60",$J)
"RTN","LRCAPPH3",91,0)
 D ^%ZISC
"RTN","LRCAPPH3",92,0)
 Q
"RTN","LRCAPPH3",93,0)
ACTIVE ;Print only WKLD CODES that have associated test assigned
"RTN","LRCAPPH3",94,0)
 ;and do not have inactivation dates
"RTN","LRCAPPH3",95,0)
 S LRACT=1 D EN0
"RTN","LRCAPPH3",96,0)
 Q
"RTN","LRCAPPH3",97,0)
CK ;
"RTN","LRCAPPH3",98,0)
 I '$G(LRACT) Q:$P(LRX,U,4)
"RTN","LRCAPPH3",99,0)
 K X,Y,DIC,LRMSG
"RTN","LRCAPPH3",100,0)
 F I=1:1:5 S LRX(I)=$P(LRX,U,I)
"RTN","LRCAPPH3",101,0)
 I LRX(2)="CPT" D  Q
"RTN","LRCAPPH3",102,0)
 . S X=$P(LRX(1),";")
"RTN","LRCAPPH3",103,0)
 . S Y=$$CPT^ICPTCOD(X,,,) I $S('$P(Y,U,7):1,LRX(4):1,1:0) D
"RTN","LRCAPPH3",104,0)
 . . S ^TMP("LRCAPPH",$J,"ICPT",X)=""
"RTN","LRCAPPH3",105,0)
 . . S Y(0)=$P(Y,U,2,3)_"^^1"
"RTN","LRCAPPH3",106,0)
 . . D MSG
"RTN","LRCAPPH3",107,0)
 S DIC(0)="XOZ",X=+LRX(1),DIC=U_$P(LRX(1),";",2)
"RTN","LRCAPPH3",108,0)
 S:$E(LRX(2))="L" DIC("S")="I '$P($G(^(4)),U)"
"RTN","LRCAPPH3",109,0)
 D ^DIC
"RTN","LRCAPPH3",110,0)
 I Y<1 D MSG Q
"RTN","LRCAPPH3",111,0)
 I $G(LRX(4)) D MSG
"RTN","LRCAPPH3",112,0)
 Q
"RTN","LRCAPPH3",113,0)
MSG ;
"RTN","LRCAPPH3",114,0)
 K LRMSG
"RTN","LRCAPPH3",115,0)
 S LRN=^LAM(LRI,0)
"RTN","LRCAPPH3",116,0)
 S LRCMT=$P($G(^TMP("LRCAPPH",$J,0)),U,4)+1
"RTN","LRCAPPH3",117,0)
 S LRMSG(LRCMT)=$P(LRN,U,2)_" ["_LRI_"]  "_$P(LRN,U),LRCMT=LRCMT+1
"RTN","LRCAPPH3",118,0)
 I Y<1 D  Q
"RTN","LRCAPPH3",119,0)
 . S LRMSG(LRCMT)="*** Has an invalid "_LRX(2)_" code of "_+X_" ."
"RTN","LRCAPPH3",120,0)
 . D TST
"RTN","LRCAPPH3",121,0)
 . I '$P(^LAM(LRI,4,LRII,0),U,4) S $P(^(0),U,4)=LRINADTX D
"RTN","LRCAPPH3",122,0)
 . . S LRCMT=LRCMT+1,LRMSG(LRCMT)="Inactivation date of "_LRINADT_" has been entered."
"RTN","LRCAPPH3",123,0)
 . S LRCMT=LRCMT+1,LRMSG(LRCMT)=LRSEP(1)
"RTN","LRCAPPH3",124,0)
 . D MSGSET("LRCAPPH",.LRMSG)
"RTN","LRCAPPH3",125,0)
 I $P($G(Y(0)),U,4) D
"RTN","LRCAPPH3",126,0)
 . N LRXDT
"RTN","LRCAPPH3",127,0)
 . S LRCMT=LRCMT+1,LRMSG(LRCMT)=$P(Y(0),U)_"  "_$P(Y(0),U,2),LRCMT=LRCMT+1
"RTN","LRCAPPH3",128,0)
 . S LRMSG(LRCMT)="Is an inactive "_LRX(2)_" code."
"RTN","LRCAPPH3",129,0)
 . D TST
"RTN","LRCAPPH3",130,0)
 . S:'$P(^LAM(LRI,4,LRII,0),U,4) $P(^(0),U,4)=LRINADTX
"RTN","LRCAPPH3",131,0)
 . S LRXDT=$P(^LAM(LRI,4,LRII,0),U,4)
"RTN","LRCAPPH3",132,0)
 . S LRCMT=LRCMT+1,LRMSG(LRCMT)="Inactivation date of "_$$FMTE^XLFDT(LRXDT,1)_" has been entered."
"RTN","LRCAPPH3",133,0)
 . S LRCMT=LRCMT+1,LRMSG(LRCMT)=LRSEP(2)
"RTN","LRCAPPH3",134,0)
 . D MSGSET("LRCAPPH",.LRMSG)
"RTN","LRCAPPH3",135,0)
 Q
"RTN","LRCAPPH3",136,0)
MAIL ;Send message to G.LMI local mail group
"RTN","LRCAPPH3",137,0)
 Q:'$O(^TMP("LRCAPPH",$J,0))
"RTN","LRCAPPH3",138,0)
 N DUZ,XMDUZ,XMSUB,XMTEXT
"RTN","LRCAPPH3",139,0)
 S LRCMT=$G(LRCMT)+1
"RTN","LRCAPPH3",140,0)
 S ^TMP("LRCAPPH",$J,LRCMT,0)="Listing of all offending codes:"
"RTN","LRCAPPH3",141,0)
 S LRCMT=$G(LRCMT)+1,^TMP("LRCAPPH",$J,LRCMT,0)=""
"RTN","LRCAPPH3",142,0)
 S LRC="^TMP(""LRCAPPH"",$J,""A"")" F  S LRC=$Q(@LRC) Q:$QS(LRC,2)'=$J  D
"RTN","LRCAPPH3",143,0)
 . S LRCMT=LRCMT+1,^TMP("LRCAPPH",$J,LRCMT,0)="   "_$QS(LRC,3)_"     "_$QS(LRC,4)
"RTN","LRCAPPH3",144,0)
 S XMSUB=" NIGHTLY WKLD CODE CHECK REPORT "_$$FMTE^XLFDT($$NOW^XLFDT,"1S")
"RTN","LRCAPPH3",145,0)
 S XMY("G.LMI")="",XMTEXT="^TMP(""LRCAPPH"","_$J_","
"RTN","LRCAPPH3",146,0)
 D ^XMD
"RTN","LRCAPPH3",147,0)
 Q
"RTN","LRCAPPH3",148,0)
TST  ;
"RTN","LRCAPPH3",149,0)
 Q:'$O(^LAM(LRI,7,0))
"RTN","LRCAPPH3",150,0)
 K LRT N X
"RTN","LRCAPPH3",151,0)
 S LRCMT=$G(LRCMT)+1 S LRMSG(LRCMT)="Associated Tests"
"RTN","LRCAPPH3",152,0)
 S LRT=0 F  S LRT=$O(^LAM(LRI,7,LRT)) Q:LRT<1  S LRTST=$G(^(LRT,0)) D
"RTN","LRCAPPH3",153,0)
 . S X=+LRTST
"RTN","LRCAPPH3",154,0)
 . S LRTST="^"_$P(LRTST,";",2)_$P(LRTST,";")_",0)",LRCMT=LRCMT+1
"RTN","LRCAPPH3",155,0)
 . S LRMSG(LRCMT)="     "_$P(@LRTST,U)_"  {"_X_"}"
"RTN","LRCAPPH3",156,0)
 Q
"RTN","LRCAPPH3",157,0)
MSGSET(SUB,TXT) ;SUB=subscript - TXT = array containing the message
"RTN","LRCAPPH3",158,0)
 N I        ;
"RTN","LRCAPPH3",159,0)
 S LRCMT=$P($G(^TMP(SUB,$J,0)),U,4)
"RTN","LRCAPPH3",160,0)
 S I=0 F  S I=$O(TXT(I)) Q:I<1  D
"RTN","LRCAPPH3",161,0)
 . S LRCMT=LRCMT+1,^TMP(SUB,$J,LRCMT,0)=TXT(I)
"RTN","LRCAPPH3",162,0)
 S $P(^TMP(SUB,$J,0),U,4)=LRCMT
"RTN","LRCAPPH3",163,0)
 Q
"RTN","LRCAPPH3",164,0)
 ;
"RTN","LRCAPPH3",165,0)
MSG2(MSGTYPE) ;
"RTN","LRCAPPH3",166,0)
 I 'MSGFLAG D
"RTN","LRCAPPH3",167,0)
 . K LRMSG
"RTN","LRCAPPH3",168,0)
 . S LRCMT=$P($G(^TMP("LRCAPPH",$J,0)),U,4)+1,LRMSG(LRCMT)="  "
"RTN","LRCAPPH3",169,0)
 . S LRCMT=LRCMT+1,LRMSG(LRCMT)=$P(LRN,U,1)_" ["_LRJ_"]"
"RTN","LRCAPPH3",170,0)
 S LRCMT=LRCMT+1
"RTN","LRCAPPH3",171,0)
 S LRMSG(LRCMT)="*** Has an inactive "_MSGTYPE_" Code of "_X_".",MSGFLAG=1
"RTN","LRCAPPH3",172,0)
 Q
"RTN","LRCAPPH3",173,0)
 ;
"RTN","LRCAPPH3",174,0)
MAIL2 ;Send message to G.LMI local mail group
"RTN","LRCAPPH3",175,0)
 N DUZ,XMDUZ,XMSUB,XMTEXT
"RTN","LRCAPPH3",176,0)
 Q:'$O(^TMP("LRCAPPH60",$J,0))
"RTN","LRCAPPH3",177,0)
 S LRCMT=$G(LRCMT)+1,^TMP("LRCAPPH60",$J,LRCMT,0)="  "
"RTN","LRCAPPH3",178,0)
 S XMSUB="NIGHTLY FILE #60 CPT CODE CHECK REPORT "_$$FMTE^XLFDT($$NOW^XLFDT,"1S")
"RTN","LRCAPPH3",179,0)
 S XMY("G.LMI")="",XMTEXT="^TMP(""LRCAPPH60"","_$J_","
"RTN","LRCAPPH3",180,0)
 D ^XMD
"RTN","LRCAPPH3",181,0)
 Q
"RTN","LRFAST")
0^26^B29732413^B27602884
"RTN","LRFAST",1,0)
LRFAST ;DALOI/CJS/JAH - FAST ENTRY ;8/10/04
"RTN","LRFAST",2,0)
 ;;5.2;LAB SERVICE;**100,121,201,286,291**;Sep 27, 1994
"RTN","LRFAST",3,0)
 N LRBEQT,LRBEVT,LRBETS,LRBEX,LRBEY,LRBEZ,LRBETYP    ; CIDC
"RTN","LRFAST",4,0)
 K LRLONG,LRNATURE
"RTN","LRFAST",5,0)
 S LRLONG=""
"RTN","LRFAST",6,0)
 D ^LRPARAM
"RTN","LRFAST",7,0)
SHORT S LRPANEL=0,LROUTINE=$P(^LAB(69.9,1,3),U,2),LRPTP=-1 I '$D(LRLONG) W !,"BYPASSING ORDER ENTRY!!",$C(7)
"RTN","LRFAST",8,0)
 I $D(^LAB(69.9,1,"RO")),+$H'=^("RO") W $C(7),!,"ROLLOVER ",$S($P(^("RO"),U,2):"IS RUNNING.",1:"HAS NOT RUN.")," ACCESSIONING SHOULDN'T BE DONE NOW.",$C(7),!,"  Are you sure you want to continue"
"RTN","LRFAST",9,0)
 I $T S %=2 D YN^DICN W:%=0 !,"Not sure?" I %'=1 W !,"OK, try later." Q
"RTN","LRFAST",10,0)
 S X=$$SELPL^LRVERA(DUZ(2))
"RTN","LRFAST",11,0)
 I X<1 D QUIT Q
"RTN","LRFAST",12,0)
 I X'=DUZ(2) N LRPL S LRPL=X
"RTN","LRFAST",13,0)
 ;
"RTN","LRFAST",14,0)
SH W !,"Do you want to enter draw times" S %=2 D YN^DICN S LRADT=(%=1) Q:%=-1
"RTN","LRFAST",15,0)
 I %=0 W !,"If you answer 'yes', you will be asked for the approximate time the specimen",!,"was taken from the patient.  Otherwise, the current time will be assumed." G SH
"RTN","LRFAST",16,0)
AMIS ;
"RTN","LRFAST",17,0)
 S U="^",(Y,LRNT)=$$NOW^XLFDT,LRODT=DT,LRAD=DT,LRIDT=9999999-Y,LRCDT=Y_"^1",LRSAMP="" K DFN,DIC S DIC(0)="EMQ"_$S($P(LRPARAM,U,6):"L",1:"") D ^LRDPA G:(LRDFN=-1)!$D(DUOUT)!$D(DTOUT) QUIT
"RTN","LRFAST",18,0)
 S:'$D(^LRO(69,LRODT,0)) ^(0)=$P(^LRO(69,0),U,1,2)_U_LRODT_U_(1+$P(^(0),U,4)),^LRO(69,LRODT,0)=LRODT,^LRO(69,"B",LRODT,LRODT)="" S %H=$H-60 D YMD^LRX S LRTM60=9999999-X
"RTN","LRFAST",19,0)
QSN1 D PT^LRX G:$G(LREND) QUIT K DR S LRLLOC=$S($L(LRWRD):LRWRD,$D(^LR(LRDFN,.1)):^(.1),1:"UNKNOWN") D:$L(LRWRD) DPT^LRWU
"RTN","LRFAST",20,0)
Q12 I $D(LRLONG) D LOC^LRWU G QUIT:LREND
"RTN","LRFAST",21,0)
Q11 D COLTY^LRWU G QUIT:LREND S LRPRAC="" I $D(LRLONG) D PRAC^LRWU1 I LREND W !!,$C(7),"ORDER CANCELED",!! G QUIT
"RTN","LRFAST",22,0)
URG ;
"RTN","LRFAST",23,0)
 S DIC="^LAB(62.05,",DIC(0)="AQE",DIC("S")="I '$P(^(0),U,3)",DIC("B")=$P($G(^LAB(62.05,LROUTINE,0)),U) D ^DIC S LRURG=$S(+Y<1:LROUTINE,1:+Y)
"RTN","LRFAST",24,0)
 S LRNN=1 D ^LROW1 G QUIT:'$D(X3) S S9=LRSPEC
"RTN","LRFAST",25,0)
QSN2 IF LRADT S %DT("A")="DRAW DATE/TIME: ",%DT(0)="-N",%DT="EATPX" D ^%DT K %DT G:Y<0 QUIT S LRCDT=Y_U,LRIDT=9999999-Y G QSN2:Y<1
"RTN","LRFAST",26,0)
 D NEW^LROR6() I $G(LRNATURE)=-1 W !!,$C(7),"...process aborted" S %="^" K LRNATURE Q
"RTN","LRFAST",27,0)
 S LRSNO=LRDFN_U_DUZ_U_LRSAMP_U_LRLWC_U_+LRCDT_U_LRPRAC_U_LRLLOC
"RTN","LRFAST",28,0)
 S LRBEY=1 I +LRDPF=2&($G(LRSS)'="BB")&('$$CHKINP^LRBEBA4(LRDFN,LRODT)) D  G QUIT:'LRBEY
"RTN","LRFAST",29,0)
 .D SLROT^LRBEBA2(.LRXST,.LRTEST,.LROT) ;Define LROT array
"RTN","LRFAST",30,0)
 .D AQ1^LRBEBA3  ; CIDC
"RTN","LRFAST",31,0)
 I ($D(LRBEY)<1)!$D(DUOUT)!$D(DTOUT) Q
"RTN","LRFAST",32,0)
 S LRNCWL=1 D REST^LROW2 K LRNCWL S ^LRO(69,LRODT,1,LRSN,1)=+LRCDT_"^^"_DUZ_"^C^^^^"_DUZ(2),^LRO(69,"AA",+$G(^(.1)),LRODT_"|"_LRSN)=""
"RTN","LRFAST",33,0)
 S LRSPEC=S9,LRTSTS=0,LRNOLABL=1 D ^LRWLST K LRNOLABL Q:'$D(LRAN)
"RTN","LRFAST",34,0)
LROE ;from LROE1
"RTN","LRFAST",35,0)
 S LRLLOC=$P(^LRO(69,LRODT,1,LRSN,0),U,7) S:'$L(LRLLOC) LRLLOC=0 K LROE
"RTN","LRFAST",36,0)
 S I1=0 F  S I1=$O(^LRO(69,LRODT,1,LRSN,2,I1)) Q:I1<1!($G(LREND))  S X=^(I1,0) I $P(X,U,4) S LRAA=$P(X,U,4),LRAN=$P(X,U,5),LRAD=$P(X,U,3) I '$D(LROE(LRAD_LRAA_LRAN)) S LROE(LRAD_LRAA_LRAN)="" D LROE1
"RTN","LRFAST",37,0)
 G QUIT
"RTN","LRFAST",38,0)
 ;
"RTN","LRFAST",39,0)
 ;
"RTN","LRFAST",40,0)
LROE1 S LRX=$G(^LRO(68,LRAA,0))
"RTN","LRFAST",41,0)
 S LRIDIV=$S($L($P(LRX,U,19)):$P(LRX,U,19),1:"CP")
"RTN","LRFAST",42,0)
 D:$P(LRPARAM,U,14)&($P($G(^LRO(68,LRAA,0)),U,16)) ^LRCAPV
"RTN","LRFAST",43,0)
 I $G(LREND) Q
"RTN","LRFAST",44,0)
 ; Check for different performing lab.
"RTN","LRFAST",45,0)
 I $G(LRPL) N LRDUZ S LRDUZ(2)=LRPL
"RTN","LRFAST",46,0)
 ;
"RTN","LRFAST",47,0)
 S LRUID=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,.3),"^")
"RTN","LRFAST",48,0)
 I $P(LRX,U,2)="CH" D ^LRVER1
"RTN","LRFAST",49,0)
 I $P(LRX,U,2)="MI" D
"RTN","LRFAST",50,0)
 . S LRPTP=-1,LRMIDEF=$P(^LAB(69.9,1,1),U,10),LRMIOTH=$P(^(0),U,11)
"RTN","LRFAST",51,0)
 . D PAT1^LRMIEDZ2
"RTN","LRFAST",52,0)
 . K LRMIDEF,LRMIOTH
"RTN","LRFAST",53,0)
 K LRX
"RTN","LRFAST",54,0)
 Q
"RTN","LRFAST",55,0)
 ;
"RTN","LRFAST",56,0)
 ;
"RTN","LRFAST",57,0)
QUIT K ^TMP("LR",$J,"TMP"),%,A,AGE,D1,D2,DFN,DIE,DL,DLAYGO,DOB,DQ,DR,DX,H8,I,J,K,LRAA,LRACC,LRAD,LRADT,LRAN,LRAP,LRCDT,LRCW,LRNATURE,I1
"RTN","LRFAST",58,0)
 K LRCWDT,LRD,LRDAT,LRDEL,LRDFN,LRDPF,LRDV,LRDVF,LREAL,LREDIT,LREND,LRFFLG,LRFP,LRIDT,LRIN,LRINI,LRIX,DIC,LRORD,LRSB
"RTN","LRFAST",59,0)
 K LRLBLBP,LRLCT,LRLDT,LRLLOC,LRLONG,LRMETH,LRNAME,LRNG,LRNG2,LRNG3,LRNG4,LRNG5,LRNP,LRNT,LRNTN,LRNX,LRODT,LROUT,LROUTINE,LROWDT,LROWLE,LRPR,LRPRAC,LRRB,LRPTP,LRSAMP,LRSN,LRSPEC,LRSS,LRSSP,LRST,LRSUB,LRSUM,LRTB,LRTD,LRTEST
"RTN","LRFAST",60,0)
 K LRTN,LRTS,LRTX,LRUNQ,LRURG,LRUSI,LRUSNM,^TMP("LR",$J,"VTO"),LRWL0,LRWLC,LRWRD,LRXD,LRXDH,LRXDP,LRYR,PNM,S,S9,SEX,SSN,T,X,X1,Y,Z,LRACD,LRADDTST,LRAOD,LRBED,LRCSS,LRDTO,LREXEC,LRFLOG,LRGCOM,LRGVP,LRIOZERO,LRNIDT,LROCN,LROID,LROLRDFN
"RTN","LRFAST",61,0)
 K LRCCOM,LRCFL,LRCS,LRCSN,LRCSP,LRCSX,LREXP,LRLWC,LRM,LRMAX,LRNN,LRSNO,LRTSTN,LRTY,LRVF,LRVRM,LRXS,I5,S2,S5,T1,POP,X2,X3,X9,LRORDER,LRORDR,LRORDTIM,LRORIFN,LROSN,LRPER,LRPHSET,LRPLOC,LRSPCDSC,LRSSQ,LRSSX,LRSVSN,LRTEC,LRTJ,LRTP,LRTSTNM
"RTN","LRFAST",62,0)
 K LRTCOM,LRALERT,LROE,LRUR,LRVOL,LRWPC,PNM,LROLLOC,LRTREA,LRMAX2,LRMX,LRCAPLOC,LRCOM,LRXST,LRY,LRJ,LRMA,LRMAX1,LRNOW,LRODTSV,LRPANEL,LRSNSV,LRTNSV,LRCDEF0X,LRDAX,LRNOCODE
"RTN","LRFAST",63,0)
 K LRSUF0,LRBEQT,LRBEVT,LRBETS,LRBEX,LRBEY,LRBEZ,LRBETYP
"RTN","LRFAST",64,0)
 D END^LRMIEDZ,^LRORDK ;LROEND^LRORDK
"RTN","LRFAST",65,0)
 D ^LRPARAM Q
"RTN","LRFAST",66,0)
EN D QUIT,^LRORDK,LROEND^LRORDK D ^LRPARAM S LRLONG="" G SHORT
"RTN","LRFAST",67,0)
% R %:DTIME Q:%=""!(%["N")!(%["Y")  W !,"Answer 'Y' or 'N': " G %
"RTN","LRNIGHT")
0^45^B3519006^B3406356
"RTN","LRNIGHT",1,0)
LRNIGHT ;SLC/CJS/AVAMC/REG - NIGHTLY LAB CLEANUP ;6/5/90  21:08 ;
"RTN","LRNIGHT",2,0)
 ;;5.2;LAB SERVICE;**291**;Sep 27, 1994
"RTN","LRNIGHT",3,0)
 ;D REQUE ;REQUED BY TASKMAN
"RTN","LRNIGHT",4,0)
 Q:'$D(^LAB(69.9,1,0))  S:$D(ZTQUEUED) DUZ(0)="@",ZTREQ="@" K ^LRO(69,"AN") K ^LRO(69,DT-1,1,"AD") I $P(^LAB(69.9,1,0),U,14) D MANUAL
"RTN","LRNIGHT",5,0)
 S %DT="",X="T-"_$S($P(^LAB(69.9,1,0),"^",9):$P(^(0),"^",9),1:7) D ^%DT S LRSAVE=Y
"RTN","LRNIGHT",6,0)
 F L=0:0 S L=$O(^LRO(69,"AT",L)) Q:L'>0  F T=0:0 S T=$O(^LRO(69,"AT",L,T)) Q:T'>0  F S=0:0 S S=$O(^LRO(69,"AT",L,T,S)) Q:S'>0  S X=-LRSAVE,X1=LRSAVE F X=X:0 S X=$O(^LRO(69,"AT",L,T,S,X)) Q:X=""!(X'<X1)  K ^LRO(69,"AT",L,T,S,X)
"RTN","LRNIGHT",7,0)
 K %,%H,%X,%Y,L,LRIOZERO,LRSAVE,POP,S,T,X,X1,Z,Y
"RTN","LRNIGHT",8,0)
STDQC ;Cleanup the XTMP("LRCAP" global
"RTN","LRNIGHT",9,0)
 D XTMP^LRCAPPH
"RTN","LRNIGHT",10,0)
 ;Check roll-up date; process pending panels if appropriate date
"RTN","LRNIGHT",11,0)
 S X=$T(EN^LRBEBA5) I X'="" D EN^LRBEBA5
"RTN","LRNIGHT",12,0)
 Q
"RTN","LRNIGHT",13,0)
REQUE S ZTDTH=$H+1_",1",ZTIO="",ZTRTN="^LRNIGHT" D ^%ZTLOAD K ZTDTH,ZTIO,ZTRTN,ZTSK Q
"RTN","LRNIGHT",14,0)
END K DUOUT,DTOUT,%DT,LRW,D,S2,S3,S4,S5,S6,S7,S8,S9,S10,S11,S12,S13,S14,S15,LRDFN,DFN,LRCD
"RTN","LRNIGHT",15,0)
 Q
"RTN","LRNIGHT",16,0)
MANUAL ;
"RTN","LRNIGHT",17,0)
RANGE ;
"RTN","LRNIGHT",18,0)
 S ZTRTN="LRCAPV2",ZTIO="",ZTDTH=$H,ZTDESC="TALLY CAP WORKLOAD" D ^%ZTLOAD Q
"RTN","LRORD1")
0^2^B22670416^B21032923
"RTN","LRORD1",1,0)
LRORD1 ;DALOI/CJS/JAH - LAZY ACCESSION LOGGING ;8/10/04
"RTN","LRORD1",2,0)
 ;;5.2;LAB SERVICE;**1,8,121,153,201,286,291**;Sep 27, 1994
"RTN","LRORD1",3,0)
L2 Q:$G(LREND)
"RTN","LRORD1",4,0)
 N LRBEQT,LRBEVT,LRBETS,LRBEX,LRBEY,LRBEZ,LRBETYP    ; CIDC
"RTN","LRORD1",5,0)
 K LROT,LRSAME,LRKIL,LRGCOM,LRCCOM,LR696IEN,LRNATURE
"RTN","LRORD1",6,0)
 S LRWPC=LRWP G:$D(LROR) LRFIRST
"RTN","LRORD1",7,0)
 I '$D(LRADDTST) K DFN,DIC S PNM="",DIC(0)="EMQ"_$S($P(LRPARAM,U,6)&$D(LRLABKY):"L",1:"") W ! D ^LRDPA I (LRDFN=-1)!$D(DUOUT)!$D(DTOUT) Q
"RTN","LRORD1",8,0)
 I $D(LRADDTST),LRADDTST="" Q
"RTN","LRORD1",9,0)
 S:'$D(LREND) LREND=0 I LRORDR="" D COLTY^LRWU G DROP:LREND
"RTN","LRORD1",10,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3)
"RTN","LRORD1",11,0)
Q12 D LOC^LRWU G DROP:LREND
"RTN","LRORD1",12,0)
Q11 D PRAC^LRWU1 G DROP:LREND
"RTN","LRORD1",13,0)
 K T,TT,LRDMAX,LRDTST,LRTMAX
"RTN","LRORD1",14,0)
 S DA=0
"RTN","LRORD1",15,0)
 F  S DA=$O(^LRO(69,LRODT,1,"AA",LRDFN,DA)) Q:DA<1  I $S($D(^LRO(69,LRODT,1,DA,1)):$P(^(1),U,4)'="U",1:1) S S=$S($D(^LRO(69,LRODT,1,DA,4,1,0)):+^(0),1:0) D
"RTN","LRORD1",16,0)
 . S I=0 F  S I=$O(^LRO(69,LRODT,1,DA,2,I)) Q:I<1  I $D(^(I,0)) S T(+^(0),DA)=S,X=+^(0) S:'$D(TT(X,S)) TT(X,S)=0 S TT(X,S)=TT(X,S)+1
"RTN","LRORD1",17,0)
 K DIC
"RTN","LRORD1",18,0)
 I $D(LRADDTST) S LRORD=+LRADDTST,LRADDTST="" G LRFIRST
"RTN","LRORD1",19,0)
 D ORDER^LROW2
"RTN","LRORD1",20,0)
 I $D(LRFLOG),$P(LRFLOG,U,3)="MI",$G(LRORDRR)'="R" K DUOUT D MICRO G L2:$D(DUOUT)!$D(DTOUT)
"RTN","LRORD1",21,0)
 ;
"RTN","LRORD1",22,0)
LRFIRST S LRSX=1 G Q13:'LRFIRST!(LRWP<2)
"RTN","LRORD1",23,0)
 W !,"Choose one (or more, separated by commas)  ('*' AFTER NUMBER TO CHANGE URGENCY) "
"RTN","LRORD1",24,0)
 F I=1:1:LRWPD D
"RTN","LRORD1",25,0)
 . N X
"RTN","LRORD1",26,0)
 . S X=^TMP("LRSTIK",$J,"B",I)
"RTN","LRORD1",27,0)
 . W !,X,?4,$P(^TMP("LRSTIK",$J,X),U,2)
"RTN","LRORD1",28,0)
 . S X=$G(^TMP("LRSTIK",$J,"B",I+LRWPD))
"RTN","LRORD1",29,0)
 . I X W ?39," ",X,?44,$P(^TMP("LRSTIK",$J,X),U,2)
"RTN","LRORD1",30,0)
Q13 S LREDO=0
"RTN","LRORD1",31,0)
LEDI ;
"RTN","LRORD1",32,0)
 ;
"RTN","LRORD1",33,0)
 ; If LEDI accessioning then check for pending orders in file #69.6
"RTN","LRORD1",34,0)
 I $G(LRRSTAT)="I",$G(LRRSITE("SMID"))'="",$G(LRSD("RUID"))'="" D  I $O(LROT(0)) G BAR
"RTN","LRORD1",35,0)
 . D EN^LRORDB(LRSD("RUID"),LRRSITE("SMID"))
"RTN","LRORD1",36,0)
 G:LRWP'>1 Q13A
"RTN","LRORD1",37,0)
 W ! W:'LRFIRST "'?' for list,  " S LRFIRST=0
"RTN","LRORD1",38,0)
 R "TEST number(s): ",LRSX:DTIME S:LRSX["?" LRFIRST=1 G LRFIRST:LRFIRST
"RTN","LRORD1",39,0)
 I LRSX=""!(LRSX["^") G BAR
"RTN","LRORD1",40,0)
 F I=1:1:$L(LRSX,",") D  Q:LREDO
"RTN","LRORD1",41,0)
 . S LRSSX=$P(LRSX,",",I)
"RTN","LRORD1",42,0)
 . I LRSSX'?1.3N.1"*" S LREDO=1 Q
"RTN","LRORD1",43,0)
 . S LRSSX=$P(LRSSX,"*")
"RTN","LRORD1",44,0)
 . I '$D(^TMP("LRSTIK",$J,LRSSX)) S LREDO=1
"RTN","LRORD1",45,0)
Q13A I LREDO W !,"Something was mistyped, try again." G Q13
"RTN","LRORD1",46,0)
 F LRK=1:1 S LRSSX=$P(LRSX,",",LRK) Q:LRSSX=""  D
"RTN","LRORD1",47,0)
 . N X
"RTN","LRORD1",48,0)
 . S LRST=$S(LRSSX["*":1,1:0),LRSSX=+LRSSX
"RTN","LRORD1",49,0)
 . S X=^TMP("LRSTIK",$J,LRSSX)
"RTN","LRORD1",50,0)
 . S LRSAMP=$P(X,U,3),LRSPEC=$P(X,U,5),LRTSTS=+X
"RTN","LRORD1",51,0)
 . D Q20^LRORDD
"RTN","LRORD1",52,0)
BAR S LRM=LRWPC+1,K=0 W !,"Other tests? N//" D % G Q14:'(%["Y")
"RTN","LRORD1",53,0)
LRM D MORE^LRORD2
"RTN","LRORD1",54,0)
Q14 D:$P(LRPARAM,U,17) ^LRORDD D ^LRORD2A D ENSTIK^LROW3 G LRM:'$D(%)&($D(LROT)'=11),DROP:$O(LROT(-1))="",LRM:'$D(%),DROP:%[U K DIC G DROP:'$D(LROT)!(%["N")
"RTN","LRORD1",55,0)
 S LRBEY=1 I +LRDPF=2&($G(LRSS)'="BB")&('$$CHKINP^LRBEBA4(LRDFN,LRODT)) D  G DROP:'LRBEY
"RTN","LRORD1",56,0)
 .D BALROR^LRBEBA3(.LRORD)  ; CIDC
"RTN","LRORD1",57,0)
 I ($D(LRBEY)<1)!$D(DUOUT)!$D(DTOUT) Q
"RTN","LRORD1",58,0)
 W !!,"LAB Order number: ",LRORD,!!
"RTN","LRORD1",59,0)
 I LRECT D  G DROP:LRCDT<1
"RTN","LRORD1",60,0)
 . I $G(LRORDRR)="R",$G(LRSD("CDT")) D  Q
"RTN","LRORD1",61,0)
 . . S LRCDT=LRSD("CDT")_"^"
"RTN","LRORD1",62,0)
 . . S LRORDTIM=$P(LRSD("CDT"),".",2)
"RTN","LRORD1",63,0)
 . . I 'LRORDTIM S $P(LRCDT,"^",2)=1
"RTN","LRORD1",64,0)
 . D TIME^LROE
"RTN","LRORD1",65,0)
 . I $G(LRCDT)<1 Q
"RTN","LRORD1",66,0)
 . S LRORDTIM=$P($P(LRCDT,U),".",2)
"RTN","LRORD1",67,0)
 D NOW^%DTC S LRNT=% S:'LRECT LRCDT=LRNT_"^1"
"RTN","LRORD1",68,0)
 S LRIDT=9999999-LRCDT
"RTN","LRORD1",69,0)
 D ^LRORDST Q:$D(LROR)
"RTN","LRORD1",70,0)
 I $D(LRFASTS) D LRWU4^LRFASTS
"RTN","LRORD1",71,0)
 Q:$G(LRKIK)  G L2
"RTN","LRORD1",72,0)
% R %:DTIME Q:%=""!(%["N")!(%["Y")  W !,"Answer 'Y' or 'N': " G %
"RTN","LRORD1",73,0)
 ;
"RTN","LRORD1",74,0)
Q20A ;from LRORD2
"RTN","LRORD1",75,0)
MAX ; CHECK FOR MAXIUM ORDER FREQUENCY
"RTN","LRORD1",76,0)
 I $D(TT(LRTSTS,LRSPEC)),$D(^LAB(60,LRTSTS,3,"B",LRCS(LRCSN))) D EN2^LRORDD I %'["Y" Q
"RTN","LRORD1",77,0)
 S I7=0 F I9=0:0 S I9=$O(T(LRTSTS,I9)) Q:I9=""  I $D(^LAB(60,LRTSTS,3,+$O(^LAB(60,LRTSTS,3,"B",LRSAMP,0)),0)),+$P(^(0),U,5),LRSPEC=T(LRTSTS,I9) S I7=1
"RTN","LRORD1",78,0)
 I I7 W $C(7),!!,"You have a duplicate: " S LRSN=0 F  S LRSN=$O(T(LRTSTS,LRSN)) Q:LRSN<1  W "  for ",$P(^LAB(60,LRTSTS,0),U) S LRZT=LRTSTS D ORDER^LROS S LRTSTS=LRZT
"RTN","LRORD1",79,0)
 I I7 W !,"You already have that test, do you really want another? N//" D %
"RTN","LRORD1",80,0)
 Q
"RTN","LRORD1",81,0)
 ;
"RTN","LRORD1",82,0)
URGG W !,"For ",$P(^TMP("LRSTIK",$J,LRSSX),U,2)
"RTN","LRORD1",83,0)
 D URG^LRORD2
"RTN","LRORD1",84,0)
 Q
"RTN","LRORD1",85,0)
 ;
"RTN","LRORD1",86,0)
 ;
"RTN","LRORD1",87,0)
DROP W !!,"ORDER CANCELED",$C(7),!! Q:$D(LROR)  G L2 ; !($G(LREND))  G L2
"RTN","LRORD1",88,0)
 ;
"RTN","LRORD1",89,0)
 ;
"RTN","LRORD1",90,0)
MICRO W !,"Is there one sample for this patient's order"
"RTN","LRORD1",91,0)
 S %=1 D YN^DICN
"RTN","LRORD1",92,0)
 I %=2!(%=-1) S:%=-1 DUOUT=1 Q
"RTN","LRORD1",93,0)
 I %=0 W !,"The collection sample and site/specimen will be used for all tests ordered",!,"at this time for this patient." G MICRO
"RTN","LRORD1",94,0)
 D GSNO^LRORD3 Q:$D(DUOUT)!$D(DTOUT)
"RTN","LRORD1",95,0)
 I +LRSAMP=-1&(LRSPEC=-1) W !,"Incompletely defined." G MICRO
"RTN","LRORD1",96,0)
 S LRSAME=LRSAMP_U_LRSPEC
"RTN","LRORD1",97,0)
 S LRECOM=0 D GCOM^LRORD2
"RTN","LRORD1",98,0)
 Q
"RTN","LRORD1",99,0)
 ;
"RTN","LRORD1",100,0)
 ;
"RTN","LRORD1",101,0)
PRAC ;from LRFAST
"RTN","LRORD1",102,0)
 S X=$S(+DIC("B"):$P(^VA(200,+DIC("B"),0),U),1:"")
"RTN","LRORD1",103,0)
 W !,"PRACTITIONER: ",X,$S($L(X):"//",1:"")
"RTN","LRORD1",104,0)
 R X:DTIME
"RTN","LRORD1",105,0)
 I DIC("B"),X="" S Y=DIC("B") Q
"RTN","LRORD1",106,0)
 D ^DIC K DIC
"RTN","LRORD1",107,0)
 Q
"RTN","LRORDST")
0^3^B30093835^B28541612
"RTN","LRORDST",1,0)
LRORDST ;SLC/CJS/WTY - SET THE ORDER AND ACCESSION ;5/16/05
"RTN","LRORDST",2,0)
 ;;5.2;LAB SERVICE;**100,107,121,153,202,290,291**;Sep 27, 1994
"RTN","LRORDST",3,0)
 ;Called to create orders and accessions from local LROT array
"RTN","LRORDST",4,0)
 D DT
"RTN","LRORDST",5,0)
 K ZTSK
"RTN","LRORDST",6,0)
 I $P(LRPARAM,U,4),'$D(LRNOLABL),'$D(LRTJ),LRORDR="" D ^LRLABLIO
"RTN","LRORDST",7,0)
 F LRSAMP=-1:0 S LRSAMP=$O(LROT(LRSAMP)) Q:LRSAMP=""  F LRSPEC=-1:0 S LRSPEC=$O(LROT(LRSAMP,LRSPEC)) Q:LRSPEC=""  D ZX
"RTN","LRORDST",8,0)
 ;
"RTN","LRORDST",9,0)
 I $D(LRLABLIO),$D(LRLBL) D
"RTN","LRORDST",10,0)
 . S ZTRTN="ENT^LRLABLD",ZTDESC="LAB LABELS",ZTDTH=$H
"RTN","LRORDST",11,0)
 . S ZTIO=LRLABLIO,ZTSAVE("LRLBL(")=""
"RTN","LRORDST",12,0)
 . D ^%ZTLOAD K LRLBL
"RTN","LRORDST",13,0)
 ;
"RTN","LRORDST",14,0)
 I $D(LRSLIP) F I1=0:0 S I1=$O(LROT(I1)) Q:I1<1  F I2=-1:0 S I2=$O(LROT(I1,I2)) Q:I2=""  S LRSN=LROT(I1,I2,"SN") D WCP
"RTN","LRORDST",15,0)
 K LRLBL,ZTSK
"RTN","LRORDST",16,0)
 Q
"RTN","LRORDST",17,0)
 ;
"RTN","LRORDST",18,0)
 ;
"RTN","LRORDST",19,0)
ZX K:$G(LRORDR)'="P" LRCOM,LRTCOM
"RTN","LRORDST",20,0)
 N I,COMB,LRCPRS
"RTN","LRORDST",21,0)
 I $D(LRGCOM) S LRCCOM=LRGCOM D RCS^LRORD2
"RTN","LRORDST",22,0)
 S LRSXN=0,I=0
"RTN","LRORDST",23,0)
 F  S I=$O(LROT(LRSAMP,LRSPEC,I)) Q:I<1  S LRSXN=LRSXN+1
"RTN","LRORDST",24,0)
 L +^LRO(69,LRODT,1)
"RTN","LRORDST",25,0)
 S LRSN=1+$P($G(^LRO(69,LRODT,1,0)),U,3)
"RTN","LRORDST",26,0)
 S LRSUM=1+$P($G(^LRO(69,LRODT,1,0)),U,4)
"RTN","LRORDST",27,0)
ZSN N I
"RTN","LRORDST",28,0)
 F  Q:'$D(^LRO(69,LRODT,1,LRSN,0))  S LRSN=LRSN+1
"RTN","LRORDST",29,0)
 S ^LRO(69,LRODT,1,LRSN,0)=LRDFN_"^"_DUZ_"^"_(+LRSAMP)_"^"_$S($L($G(LRLWC)):LRLWC,$L(LRORDR):LRORDR,1:"SP")_"^"_LRNT_"^"_LRPRAC_"^"_LRLLOC_"^"_LRODT_$S(+LRORDTIM:"."_LRORDTIM,1:"")_"^"_LROLLOC_"^^"_$G(LRORIFN)
"RTN","LRORDST",30,0)
 S ^LRO(69,LRODT,1,LRSN,2,0)="^69.03PA^"_LRSXN_U_LRSXN
"RTN","LRORDST",31,0)
 S ^LRO(69,LRODT,1,0)="^69.01PA^"_LRSN_U_LRSUM
"RTN","LRORDST",32,0)
 L -^LRO(69,LRODT,1)
"RTN","LRORDST",33,0)
 S ^LRO(69,LRODT,1,"AA",LRDFN,LRSN)=""
"RTN","LRORDST",34,0)
 S ^LRO(69,LRODT,1,"AC",LRLLOC,LRSN)=""
"RTN","LRORDST",35,0)
 S LROT(LRSAMP,LRSPEC,"SN")=LRSN
"RTN","LRORDST",36,0)
 S ^LRO(69,"D",LRDFN,LRODT,LRSN)=""
"RTN","LRORDST",37,0)
 S COMB=$P($G(^LRO(69,LRODT,1,LRSN,1)),"^",7)
"RTN","LRORDST",38,0)
 I $S($G(LRORDR)="":1,$G(LRORDR)="P":1,1:0) D
"RTN","LRORDST",39,0)
 . S $P(^LRO(69,LRODT,1,LRSN,1),"^")=$P(LRCDT,"^")
"RTN","LRORDST",40,0)
 . S $P(^LRO(69,LRODT,1,LRSN,1),"^",2)=$P(LRCDT,"^",2)
"RTN","LRORDST",41,0)
 . S $P(^LRO(69,LRODT,1,LRSN,1),"^",4)="C"
"RTN","LRORDST",42,0)
 . S $P(^LRO(69,LRODT,1,LRSN,1),"^",8)=DUZ(2)
"RTN","LRORDST",43,0)
 . ;S ^LRO(69,LRODT,1,LRSN,1)=LRCDT_"^^C^^^"_COMB_"^"_DUZ(2)
"RTN","LRORDST",44,0)
 . I $G(LRORDR)'="P" S ^LRO(69,"AA",+$G(LRORD),LRODT_"|"_LRSN)=""
"RTN","LRORDST",45,0)
 . ; PIECE 4 INDICATED COLLECTED (NOTE: LRCDT HAS 2 PIECES)
"RTN","LRORDST",46,0)
 I LRSPEC'="" S ^LRO(69,LRODT,1,LRSN,4,0)="^69.02PA^1^1",^(1,0)=LRSPEC
"RTN","LRORDST",47,0)
 S ^LRO(69,LRODT,1,LRSN,.1)=LRORD,^LRO(69,"C",+LRORD,LRODT,LRSN)="",LRJ=0
"RTN","LRORDST",48,0)
 F LRTN=1:1 S LRJ=$O(LROT(LRSAMP,LRSPEC,LRJ)) Q:LRJ<1  D ZSN1
"RTN","LRORDST",49,0)
 K LRBEX,LRBEY,LRBEAR,LRBERF  ;Clean-up CIDC variables
"RTN","LRORDST",50,0)
 I $D(LRCOM(LRSAMP,LRSPEC)),LRCOM(LRSAMP,LRSPEC) D
"RTN","LRORDST",51,0)
 . N I
"RTN","LRORDST",52,0)
 . S X=LRCOM(LRSAMP,LRSPEC)
"RTN","LRORDST",53,0)
 . S ^LRO(69,LRODT,1,LRSN,6,0)="^69.04W^"_X_U_X
"RTN","LRORDST",54,0)
 . F I=1:1:X S ^LRO(69,LRODT,1,LRSN,6,I,0)=LRCOM(LRSAMP,LRSPEC,I)
"RTN","LRORDST",55,0)
 D NEW^LR7OB1(LRODT,LRSN,"SN",$G(LRNATURE),.LRCPRS)
"RTN","LRORDST",56,0)
 I LRORDR="LC"!(LRORDR="I") D
"RTN","LRORDST",57,0)
 . S ION=$P($G(^LAB(69.9,1,3.5,+DUZ(2),0)),U,2)
"RTN","LRORDST",58,0)
 . S:ION="" ION=$P($G(^LAB(69.9,1,3)),U,4)
"RTN","LRORDST",59,0)
 . I ION'="",(LRORDR="LC"!(LRORDR="I")) D ^LROW2P
"RTN","LRORDST",60,0)
 I LRORDR="I" S ION=$P($G(^LAB(69.9,1,7,DUZ(2),0)),U,3) I ION'="" D ^LROW2P
"RTN","LRORDST",61,0)
 I $S(LRORDR="":1,LRORDR="P":1,1:0) D ^LRWLST
"RTN","LRORDST",62,0)
 Q
"RTN","LRORDST",63,0)
 ;
"RTN","LRORDST",64,0)
ZSN1 ;
"RTN","LRORDST",65,0)
 N LRORIFN
"RTN","LRORDST",66,0)
 S LRTSTS=LROT(LRSAMP,LRSPEC,LRJ),LRCPRS(LRTSTS)=""
"RTN","LRORDST",67,0)
 S ^LRO(69,LRODT,1,LRSN,2,LRTN,0)=LRTSTS_"^"_$S($D(LROT(LRSAMP,LRSPEC,LRJ,1)):LROT(LRSAMP,LRSPEC,LRJ,1),1:LROUTINE)
"RTN","LRORDST",68,0)
 D:+LRDPF=2&($G(LRSS)'="BB")&('$$CHKINP^LRBEBA4(LRDFN,LRODT))  ;CIDC
"RTN","LRORDST",69,0)
 .D SACC^LRBEBA2(LRODT,LRSN,LRTN,LRSAMP,LRSPEC,LRTSTS,.LRBEX)
"RTN","LRORDST",70,0)
 I $G(LRORIFN) S $P(^LRO(69,LRODT,1,LRSN,2,LRTN,0),"^",7)=LRORIFN ;OE/RR 2.5
"RTN","LRORDST",71,0)
 S $P(^LRO(69,LRODT,1,LRSN,2,LRTN,0),"^",9,10)="IP^L"
"RTN","LRORDST",72,0)
 S ^LRO(69,LRODT,1,LRSN,2,"B",LRTSTS,LRTN)=""
"RTN","LRORDST",73,0)
 S ^LRO(69,"AT",LRDFN,LRTSTS,LRSPEC,LRODT)="",^(-LRODT)=""
"RTN","LRORDST",74,0)
 D RCOM:$D(LROT(LRSAMP,LRSPEC,LRJ,2))
"RTN","LRORDST",75,0)
 D:$O(LRTCOM(LRTSTS,0)) TCOM^LROW2A(LRTSTS)
"RTN","LRORDST",76,0)
 Q
"RTN","LRORDST",77,0)
 ;
"RTN","LRORDST",78,0)
 ;
"RTN","LRORDST",79,0)
RCOM ; Required comment
"RTN","LRORDST",80,0)
 N LRTSTN,LRTEST
"RTN","LRORDST",81,0)
 S LRTSTN=1,LRTEST(LRTSTN)=LRTSTS
"RTN","LRORDST",82,0)
 S LRCCOM="~For Test: "_$P(^LAB(60,LRTSTS,0),U)_"   "_$P(^LAB(62,LRSAMP,0),U) S:$P(^(0),U)'=$P(^LAB(61,LRSPEC,0),U) LRCCOM=LRCCOM_"   "_$P(^LAB(61,LRSPEC,0),U) I $S('$D(DUZ("AG")):1,"ARMYAFN"'[DUZ("AG"):1,1:0) W !,LRCCOM
"RTN","LRORDST",83,0)
 S LREXP=LROT(LRSAMP,LRSPEC,LRJ,2)
"RTN","LRORDST",84,0)
 D RCS^LRORD2,RCOM^LRORD2
"RTN","LRORDST",85,0)
 I LRCCOM="",$D(LRCOM(LRSAMP,LRSPEC)) S X=+LRCOM(LRSAMP,LRSPEC) I $D(LRCOM(LRSAMP,LRSPEC,X)),LRCOM(LRSAMP,LRSPEC,X)["~For Test:" K LRCOM(LRSAMP,LRSPEC,X) S LRCOM(LRSAMP,LRSPEC)=X-1
"RTN","LRORDST",86,0)
 Q
"RTN","LRORDST",87,0)
 ;
"RTN","LRORDST",88,0)
 ;
"RTN","LRORDST",89,0)
OLD ; to allow unchanged routines to still work, from LROE1, LRPHSET1
"RTN","LRORDST",90,0)
 N LRNT
"RTN","LRORDST",91,0)
 D DT,NOW^%DTC
"RTN","LRORDST",92,0)
 S LRNT=%
"RTN","LRORDST",93,0)
 I $P(LRPARAM,U,4),'$D(LRNOLABL),'$D(LRTJ) D ^LRLABLIO
"RTN","LRORDST",94,0)
 D ^LRWLST
"RTN","LRORDST",95,0)
 Q
"RTN","LRORDST",96,0)
 ;
"RTN","LRORDST",97,0)
 ;
"RTN","LRORDST",98,0)
WCP Q:$D(LRNCWL)
"RTN","LRORDST",99,0)
 S:$D(LRORDER) ION=LRORDER
"RTN","LRORDST",100,0)
 I '$D(LRORDER) K %ZIS S IOP="HOME",%ZIS="NQ" D ^%ZIS G:POP WCP1 S X=ION,DIC(0)="EQ",DIC=3.5 D ^DIC G:Y<1 WCP1 G:'$D(^%ZIS(1,+Y,99)) WCP1 G:'$L($P(^(99),U)) WCP1 S IOP=$P(^%ZIS(1,$P(^(99),U),0),U),%ZIS="NQ" D ^%ZIS G:POP WCP1 K %ZIS,IOP
"RTN","LRORDST",101,0)
WCP2 S LRORDER=ION
"RTN","LRORDST",102,0)
 I IO(0)=IO R !!,"Press RETURN to continue...",X:DTIME S IOP=LRORDER,%ZIS="" D ^%ZIS D ENT2^LROW2P Q
"RTN","LRORDST",103,0)
 I IO'=IO(0) D ^LROW2P Q
"RTN","LRORDST",104,0)
 Q
"RTN","LRORDST",105,0)
 ;
"RTN","LRORDST",106,0)
 ;
"RTN","LRORDST",107,0)
DT S DT=$$DT^XLFDT()
"RTN","LRORDST",108,0)
 Q
"RTN","LRORDST",109,0)
 ;
"RTN","LRORDST",110,0)
 ;
"RTN","LRORDST",111,0)
WCP1 S %ZIS="NQ",%ZIS("A")="ORDER COPY DEVICE:"
"RTN","LRORDST",112,0)
 D ^%ZIS
"RTN","LRORDST",113,0)
 Q:POP
"RTN","LRORDST",114,0)
 G WCP2
"RTN","LRORDST",115,0)
 ;
"RTN","LRORDST",116,0)
 ;
"RTN","LRORDST",117,0)
OR ;OE/RR 2.5
"RTN","LRORDST",118,0)
 Q  ;Following logic not required - 2.5 is obsolete version
"RTN","LRORDST",119,0)
 N LRORDR
"RTN","LRORDST",120,0)
 Q:$G(LRORDRR)="R"
"RTN","LRORDST",121,0)
 S LRY=$S($D(LROT(LRSAMP,LRSPEC,LRJ,1)):LROT(LRSAMP,LRSPEC,LRJ,1),1:LROUTINE),LRI=1,LRTEST(LRI)=LRTSTS_"^"_LRY,LRORDR=$S($L($G(LRLWC)):LRLWC,1:"")
"RTN","LRORDST",122,0)
 D SET^LROR
"RTN","LRORDST",123,0)
 Q
"RTN","LROW")
0^20^B11672894^B10364832
"RTN","LROW",1,0)
LROW ;SLC/CJS/JAH - LAB ORDER ENTRY, WARD ;8/10/04
"RTN","LROW",2,0)
 ;;5.2;LAB SERVICE;**100,121,291**;Sep 27, 1994
"RTN","LROW",3,0)
 ;
"RTN","LROW",4,0)
W10 ;
"RTN","LROW",5,0)
 K LRBEOT,LRBEQT,LRBEVT,LRBETS,LRBEX,LRBEY,LRBEZ,LRBETYP,LRBEODT,LRBERF
"RTN","LROW",6,0)
 D ^LRPARAM K X3,LRNATURE S U="^" D DT^LRX I $D(LRADDTST) Q:LRADDTST=""
"RTN","LROW",7,0)
 D NOW^%DTC S LRCDT=% I $G(DFN) D EN2^LRDPA(DFN,0,0)
"RTN","LROW",8,0)
 K LRSN,LRCOM,DTOUT,LRTCOM W !! S (LRSN,LRMOR,LRNN)=0 I $D(LRADDTST),$P(LRADDTST,U,2)'="OUT" G MORE
"RTN","LROW",9,0)
 K DIC,DFN,LRXST,X3 S DIC(0)="EMQZ",PNM="" D ^LRDPA G LREND^LROW4:(LRDFN=-1)!$D(DUOUT)!$D(DTOUT)
"RTN","LROW",10,0)
 D EN2^LRDPA(DFN,1,1) I 'Y G W10
"RTN","LROW",11,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2)
"RTN","LROW",12,0)
Q12 D LOC^LRWU G W10:LREND
"RTN","LROW",13,0)
 D L5 G LREND^LROW4:LREND
"RTN","LROW",14,0)
 G PRAC
"RTN","LROW",15,0)
Q12A S S=$S($D(^LRO(69,LRODT,1,DA,4,1,0)):+^(0),1:0) S I=0 F  S I=$O(^LRO(69,LRODT,1,DA,2,I)) Q:I<1  S T(+^(I,0),DA)=S,X=+^(0) S:'$D(TT(X,S)) TT(X,S)=0 S TT(X,S)=TT(X,S)+1
"RTN","LROW",16,0)
 Q
"RTN","LROW",17,0)
PRAC D PRAC^LRWU1 I LREND W !!,$C(7),"ORDER CANCELED",!! G W10
"RTN","LROW",18,0)
 F I=0:0 K LROUTINE,DIC,LRY,LRURG W !,"Will the urgency for all tests ordered for this patient at this time be",!,$P(^LAB(62.05,+$P(^LAB(69.9,1,3),U,2),0),U) S %=1 D YN^DICN Q:%  W "  Answer 'Y'es or 'N'o."
"RTN","LROW",19,0)
 I %<0 S LREND=1 W !!,$C(7),"ORDER CANCELED",!! G W10
"RTN","LROW",20,0)
 I %'=2 S LROUTINE=$P(^LAB(69.9,1,3),U,2)
"RTN","LROW",21,0)
MORE ;from LROR
"RTN","LROW",22,0)
 K T,TT,LRCOM,LRTCOM,LROT,LRTMAX,LRDTST,LRDMAX,LRBEX
"RTN","LROW",23,0)
 S DA=0 F  S DA=$O(^LRO(69,LRODT,1,"AA",LRDFN,DA)) Q:DA<1  I $S($D(^LRO(69,LRODT,1,DA,1)):$P(^(1),U,4)'="U",1:1) S LRSAMP=$P(^(0),U,3) D Q12A
"RTN","LROW",24,0)
 S LRCCOM="" D ^LROW1
"RTN","LROW",25,0)
 S LRBEY=1 I +LRDPF=2&($G(LRSS)'="BB")&('$$CHKINP^LRBEBA4(LRDFN,LRODT)) D  G LEND:'LRBEY
"RTN","LROW",26,0)
 .D BALROW^LRBEBA3(LRODT,LRSN,.LRTEST)
"RTN","LROW",27,0)
 Q:$D(DIROUT)  I $D(LRADDTST),$P(LRADDTST,U,2)="OUT" G NOMORE
"RTN","LROW",28,0)
 G W10:LRTSTN=0
"RTN","LROW",29,0)
NOMORE ;from LROR
"RTN","LROW",30,0)
 S LRSNO=LRDFN_"^"_DUZ_"^^"_LRLWC_"^"_LRCDT_"^"_LRPRAC_"^"_LRLLOC_"^"_LRODT_$S(+LRORDTIM:"."_LRORDTIM,1:"")
"RTN","LROW",31,0)
 D ^LROW3 I %["N"!$D(DTOUT)!(%["^")!'$D(LRXST) D W20 G LREND^LROW4:$D(LRADDTST),W10
"RTN","LROW",32,0)
 D LROW^LRORDD
"RTN","LROW",33,0)
 D REST^LROW2 K LRBEX,LRORIFN Q:$D(LRADDTST)
"RTN","LROW",34,0)
 S DIR(0)="Y",DIR("A")="Do you want to place another order for this patient",DIR("B")="NO" D ^DIR K DIR
"RTN","LROW",35,0)
 G W10:Y'=1
"RTN","LROW",36,0)
 K X3,LRY,LRURG,LROUTINE D @$S(LRLWC="I":"^LRORDIM",1:"NEXTCOL^LROW5") G W10:LREND,MORE
"RTN","LROW",37,0)
W20 ;from LROE1
"RTN","LROW",38,0)
 K LRSNO,LRLLOC,LROLLOC,LRTREA,LRCDT,LRSN,LRSTATUS W:$D(LRXST) !!,$C(7),$S($D(LRADDTST):"ADDITIONAL ",1:""),"ORDER DELETED",! K LRXST Q
"RTN","LROW",39,0)
L5 ;from LROR, LROR4
"RTN","LROW",40,0)
 ;S LREND=0 W !," (S)END patient to lab",!," (W)ARD collect & deliver",!," (B)LOOD orders for lab draw",!," (I)MMED Lab Collect ",!
"RTN","LROW",41,0)
L5A ;R !,"Select: ",X:DTIME G LEND:X["^"!'$T,L5:X="" S X=$E(X,1)
"RTN","LROW",42,0)
 ;I "SBWI"'[X W !,"Enter 'S' for SEND TO LAB",!?6,"'W' for WARD COLLECT",!?6,"'B' for BLOOD COLLECTED BY LAB.",!?6,"'I' for Immediate Lab Collect",!?6,"'^' to Exit." G L5A
"RTN","LROW",43,0)
 ;S LRLWC=$S(X["W":"WC",X["S":"SP",X["I":"I",1:"LC")
"RTN","LROW",44,0)
L5B ;
"RTN","LROW",45,0)
 D COLTY^LRWU Q:LREND
"RTN","LROW",46,0)
 I LRLWC="I" D ^LRORDIM S:'$D(LRCDT) LREND=1 Q:LREND  S ^LRO(69,LRODT,0)=LRODT,^LRO(69,"B",LRODT,LRODT)="" Q
"RTN","LROW",47,0)
 D NEXTCOL^LROW5 Q:LREND  S ^LRO(69,LRODT,0)=LRODT,^LRO(69,"B",LRODT,LRODT)="" Q
"RTN","LROW",48,0)
LEND ;from LROW5
"RTN","LROW",49,0)
 S LREND=1 Q
"RTN","LROW",50,0)
TIME ;from LROW5
"RTN","LROW",51,0)
 S Z=$S(+$E(Y,1,2)>11:"PM",1:"AM"),Y=$E(Y_0,1,2)-$S($E(Y_0,1,2)=12:0,Z="PM":12,1:0)_":"_$E(Y_"000",3,4)_Z
"RTN","LROW",52,0)
 W Y
"RTN","LROW",53,0)
 Q
"RTN","LROW",54,0)
ADD ;from LRAD2ORD
"RTN","LROW",55,0)
 Q:LRADDTST=""  D DT^LRX D W10
"RTN","LROW",56,0)
 Q
"RTN","LROW2A")
0^21^B11789915^B11381802
"RTN","LROW2A",1,0)
LROW2A ;SLC/FHS/JAH - CONTINUING TEST & SAMPLE VERIFICATION ;8/10/04
"RTN","LROW2A",2,0)
 ;;5.2;LAB SERVICE;**20,40,100,107,121,291**;Sep 27, 1994
"RTN","LROW2A",3,0)
 ; Modified slc/jer to include set/kill for "D" cross-reference
"RTN","LROW2A",4,0)
 ;from LROW2
"RTN","LROW2A",5,0)
DUP L +^LRO(69,LRODT,1) S LRSN=1+$S($D(^LRO(69,LRODT,1,0)):$P(^(0),"^",3),1:0)
"RTN","LROW2A",6,0)
 I '$D(LR2ORD) F LRSN=LRSN:1 Q:'$D(^LRO(69,LRODT,1,LRSN,0))
"RTN","LROW2A",7,0)
 E  S LRSAME=-1 D ADD I LRSAME=-1 L -^LRO(69,LRODT,1) Q
"RTN","LROW2A",8,0)
 S ^LRO(69,LRODT,1,0)="^69.01PA^"_LRSN_U_LRSN,LRSN(LRSN)=""
"RTN","LROW2A",9,0)
 S LRTN=$S($D(LR2ORD)&$D(^LRO(69,LRODT,1,LRSN,2,0)):$P(^(0),U,3),1:0)
"RTN","LROW2A",10,0)
 S LRSAMP=LRSSP S:LRSAMP=0 LRSAMP=""
"RTN","LROW2A",11,0)
 S ^LRO(69,LRODT,1,LRSN,0)=$P(LRSNO,U,1,2)_U_LRSAMP_U_$P(LRSNO,U,4,8),$P(^(0),U,9)=LROLLOC,^(.1)=LRORD,^LRO(69,"C",+LRORD,LRODT,LRSN)=""
"RTN","LROW2A",12,0)
 L -^LRO(69,LRODT,1)
"RTN","LROW2A",13,0)
 S ^LRO(69,LRODT,1,"AA",LRDFN,LRSN)="",^LRO(69,"D",LRDFN,LRODT,LRSN)="" S:$L(LRLLOC) ^LRO(69,LRODT,1,"AC",LRLLOC,LRSN)=""
"RTN","LROW2A",14,0)
 S LRI=0
"RTN","LROW2A",15,0)
 F  S LRI=$O(LRXS(LRSSP,LRSPEC,LRI)) Q:LRI<1  D
"RTN","LROW2A",16,0)
 . D SET
"RTN","LROW2A",17,0)
 . D OR^LROW2 ;OE/RR 2.5
"RTN","LROW2A",18,0)
 . S ^LRO(69,LRODT,1,LRSN,2,LRTN,0)=LRTEST(LRI),^LRO(69,LRODT,1,LRSN,2,"B",+LRTEST(LRI),LRTN)="",^LRO(69,"AT",LRDFN,+LRTEST(LRI),LRSPEC,LRODT)="",^(-LRODT)=""
"RTN","LROW2A",19,0)
 . S $P(^LRO(69,LRODT,1,LRSN,2,LRTN,0),"^",9,10)="IP^L" D:$O(LRTCOM(+LRTEST(LRI),0)) TCOM(+LRTEST(LRI))
"RTN","LROW2A",20,0)
 . D:+LRDPF=2&($G(LRSS)'="BB")&('$$CHKINP^LRBEBA4(LRDFN,LRODT)) AQ2^LRBEBA3  ; CIDC
"RTN","LROW2A",21,0)
 S ^LRO(69,LRODT,1,LRSN,2,0)="^69.03PA^"_LRTN_U_LRTN
"RTN","LROW2A",22,0)
 S ^LRO(69,LRODT,1,LRSN,4,0)="^69.02PA^1^1",^(1,0)=LRSPEC
"RTN","LROW2A",23,0)
 I $D(LRCOM(LRSSP,LRSPEC)),LRCOM(LRSSP,LRSPEC) S X=LRCOM(LRSSP,LRSPEC),^LRO(69,LRODT,1,LRSN,6,0)="^69.04^"_X_U_X F J=1:1:X S ^LRO(69,LRODT,1,LRSN,6,J,0)=LRCOM(LRSSP,LRSPEC,J)
"RTN","LROW2A",24,0)
 N TSTZ S TSTZ=0 F  S TSTZ=$O(LRTEST(TSTZ)) Q:TSTZ<1  S TSTZ(+LRTEST(TSTZ))=""
"RTN","LROW2A",25,0)
 D NEW^LR7OB1(LRODT,LRSN,"SN",$G(LRNATURE),.TSTZ)
"RTN","LROW2A",26,0)
 I $D(LRLWC),LRLWC="LC" S ION=$P($G(^LAB(69.9,1,3.5,+DUZ(2),0)),U,2) S:ION="" ION=$P(^LAB(69.9,1,3),U,4) I ION]"" D ^LROW2P
"RTN","LROW2A",27,0)
 I $D(LRLWC),LRLWC="I" S ION=$P(^LAB(69.9,1,7,DUZ(2),0),U,3) I ION]"" D ^LROW2P
"RTN","LROW2A",28,0)
WCP Q:$D(LRNCWL)  Q:'$D(LRORDER)  S ION=LRORDER
"RTN","LROW2A",29,0)
 I $G(LRPIX)'=LRORD D PAUSE S LRPIX=LRORD
"RTN","LROW2A",30,0)
 I IO(0)=$G(IO) S IOP=LRORDER,%ZIS="Q" D ^%ZIS Q:POP  I '$D(IO("Q")) U IO D ENT2^LROW2P Q
"RTN","LROW2A",31,0)
 I $G(IO)'=IO(0)!($D(IO("Q"))) D ^LROW2P Q
"RTN","LROW2A",32,0)
 Q
"RTN","LROW2A",33,0)
ADD S LRSN1="" F ZZ=0:0 S LRSN1=$O(^LRO(69,LRODT,1,"AA",LRDFN,LRSN1)) Q:LRSN1=""  I ^LRO(69,LRODT,1,LRSN1,.1)=LRORD S LROLLOC=$P(^LRO(69,LRODT,1,LRSN1,0),U,9),LRSAME=$S(LRSSP=$P(^(0),U,3)&(LRSPEC=^(4,1,0)):1,1:0) I LRSAME=1 S LRSN=LRSN1 Q
"RTN","LROW2A",34,0)
 I LRSAME=0 F LRSN=LRSN:1 Q:'$D(^LRO(69,LRODT,1,LRSN,0))
"RTN","LROW2A",35,0)
 Q
"RTN","LROW2A",36,0)
PAUSE ;
"RTN","LROW2A",37,0)
 R !!,"Press RETURN to continue...",X:DTIME
"RTN","LROW2A",38,0)
 Q
"RTN","LROW2A",39,0)
SET ;
"RTN","LROW2A",40,0)
 S LRTN=LRTN+1 I $D(^LRO(69,LRODT,1,LRSN,2,LRTN)) G SET
"RTN","LROW2A",41,0)
 Q
"RTN","LROW2A",42,0)
TCOM(TEST) ;Insert test comments
"RTN","LROW2A",43,0)
 N J
"RTN","LROW2A",44,0)
 S ^LRO(69,LRODT,1,LRSN,2,LRTN,1,0)="^^"_LRTCOM(TEST)_"^"_DT_"^"
"RTN","LROW2A",45,0)
 S J=0 F  S J=$O(LRTCOM(TEST,J)) Q:J<1  S ^LRO(69,LRODT,1,LRSN,2,LRTN,1,J,0)=LRTCOM(TEST,J)
"RTN","LROW2A",46,0)
 Q
"RTN","LRTSTJAM")
0^30^B17412817^B16911767
"RTN","LRTSTJAM",1,0)
LRTSTJAM ;SLC/CJS/JAH - JAM TESTS ONTO (OR OFF) ACCESSIONS ;8/10/04
"RTN","LRTSTJAM",2,0)
 ;;5.2;LAB SERVICE;**121,153,291**;Sep 27, 1994
"RTN","LRTSTJAM",3,0)
EN ;
"RTN","LRTSTJAM",4,0)
ADD I $G(LRAA),$G(LRAD),$G(LRAN) L -^LRO(68,LRAA,1,LRAD,1,LRAN)
"RTN","LRTSTJAM",5,0)
 K LRPARAM D ^LRPARAM G:'$D(LRPARAM) END S LRACC=1 D LRACC^LRTSTOUT K LRACC,LRTSAD,LRNATURE G:LRAN<1 END ;ADD A TEST
"RTN","LRTSTJAM",6,0)
 I '$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,0)),U,2) W !?5,"This is not a valid Accession number ",!,$C(7) G ADD
"RTN","LRTSTJAM",7,0)
 L +^LRO(68,LRAA,1,LRAD,1,LRAN):1 I '$T W !?5,"Someone else is editing this entry ",!,$C(7) G ADD
"RTN","LRTSTJAM",8,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,0),LRDFN=$P(X,U),LRAODT=$P(X,U,3),LRODT=$P(X,U,4),LRSN=$P(X,U,5),LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX W !,PNM,?30,SSN
"RTN","LRTSTJAM",9,0)
 D:'$D(LRNATURE) NEW^LROR6() I $G(LRNATURE)=-1 W !!,"...process aborted",$C(7) K LRNATURE G ADD
"RTN","LRTSTJAM",10,0)
 W !,"TESTS ALREADY ON THE ACCESSION: " S I=0 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<1  W !,?5,$P(^LAB(60,I,0),U,1) S LRTSAD(1,I)=""
"RTN","LRTSTJAM",11,0)
LRTSP W ! K DIC,DA S DIC("A")="Select Original Ordered Test ",DA=LRSN,DA(1)=LRODT
"RTN","LRTSTJAM",12,0)
 I $P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3)),U,2) S DIC("S")="I $L($P($G(^(.3)),U))"
"RTN","LRTSTJAM",13,0)
 S DIC="^LRO(69,"_LRODT_",1,"_LRSN_",2,",DIC(0)="AQEZNM"
"RTN","LRTSTJAM",14,0)
 W ! D ^DIC K DIC,DA G:Y<1 ADD S LRTSP=$P(Y,U,2) W !
"RTN","LRTSTJAM",15,0)
ADDTST S DIC("A")="Add LABORATORY TEST: ",DIC=60,DIC(0)="AEMOQ",DIC("S")="I $P(^(0),U,4)'="""""_$S('$D(^XUSEC("LRSUPER",DUZ)):",""N""'[$P(^(0),U,3)",1:"") D ^DIC K DIC("A"),DIC("S") G ADD:Y<1 W !,"  ...OK" S %=1 D YN^DICN
"RTN","LRTSTJAM",16,0)
 G ADDTST:%=2,ADD:%'=1 S (LRTS,I)=+Y I $D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I,0)) W !,"The accession already has this test." G ADDTST
"RTN","LRTSTJAM",17,0)
 S LRTSUB=1 D EXPLD^LRTSTJM1 I $D(LRTSAD(1,LRTS)) W !,"The accession already has this test." G ADDTST
"RTN","LRTSTJAM",18,0)
 I $D(^LAB(60,I,8,+DUZ(2),0)) S J=$P(^LAB(60,I,8,+DUZ(2),0),U,2) I J,J'=LRAA W !,"That test normally belongs to accession area ",$P(^LRO(68,J,0),U),",",!,"are you sure" S %=2 D YN^DICN G ADD:%'=1
"RTN","LRTSTJAM",19,0)
 I $O(^LAB(60,LRTS,2,0)) S LRTSURG=$P(^LAB(60,LRTS,0),U,18) K LRTSAD(2) S LRTSAD(2,LRTS)="" S LRTSUB=2 D EXPLD^LRTSTJM1,COMPTST^LRTSTJM1 I 'LRTSUB G ADDTST
"RTN","LRTSTJAM",20,0)
 S LRFLG=1 S (LRURG,Y)=$P(^LAB(60,I,0),U,18) G SETTST:$L(Y)
"RTN","LRTSTJAM",21,0)
ADDURG S DIC=62.05,DIC("B")="ROUTINE" D ^DIC K DIC("B") W:Y<1 !,"URGENCY must be defined.  Test not added." G ADDTST:Y<1 W !,"  ...OK" S %=1 D YN^DICN
"RTN","LRTSTJAM",22,0)
 G ADDURG:%=2,ADD:%<1 S LRURG=+Y,LRFLG=""
"RTN","LRTSTJAM",23,0)
SETTST ;
"RTN","LRTSTJAM",24,0)
 D:+LRDPF=2&($G(LRSS)'="BB")&('$$CHKINP^LRBEBA4(LRDFN,LRODT))
"RTN","LRTSTJAM",25,0)
 .S LRBERF=$$RFLX^LRBEBA4()  ; CIDC
"RTN","LRTSTJAM",26,0)
 G EN^LRTSTSET Q
"RTN","LRTSTJAM",27,0)
 Q
"RTN","LRTSTJAM",28,0)
IDENT ;D LRACC^LRTSTOUT Q:LREND
"RTN","LRTSTJAM",29,0)
FXID S LRACC=1 D LRACC^LRTSTOUT K LRACC Q:LRAN<1  ;R !,"What Accession number: ",X:DTIME Q:X=""!(X["^")
"RTN","LRTSTJAM",30,0)
 S LRWDT1=DA(1) D:$D(^LRO(68,LRAA,.3))#2 ^LRWLST2 G FXID
"RTN","LRTSTJAM",31,0)
 ;
"RTN","LRTSTJAM",32,0)
% R %:DTIME Q:%=""!(%["N")!(%["Y")  W !,"Answer 'Y' or 'N': " G %
"RTN","LRTSTJAM",33,0)
 Q
"RTN","LRTSTJAM",34,0)
END I $G(LRAA),$G(LRAD),$G(LRAN) L -^LRO(68,LRAA,1,LRAD,1,LRAN)
"RTN","LRTSTJAM",35,0)
 K %,A,AGE,DD,DFN,DIC,DIE,DO,DOB,DR,I,K,LRAA,LRAD,LRACD,LRAN,LRCCOM,LRDFN,LRDPF,LREND,LRIDT,LRODT,LRSN,LRSS,LRTNM,LRTS,LRWRD,PNM,SEX,SSN,X,Y,Z,LRUSNM
"RTN","LRTSTJAM",36,0)
 K %DT,%H,%X,%Y,DA,J,LRBED,LRCS,LRCSS,LRDTM,LRDTO,LRGVP,LRIDENT,LRIOZERO,LRLLOC,LRLWC,LRNOP,LRONE,LRORD,LRORDTIM,LROWLE,LRPR,LRTP,LRTSN,LRUR,LRUSNM,LRWDT1,LRXD,POP,T
"RTN","LRTSTJAM",37,0)
 K LRTSAD,LRTSUB,LRDATE,D,D0,D1,DN,LRAODT,LRFLG,LRRB,LRSAMP,LRTREA,LRTSP
"RTN","LRTSTJAM",38,0)
 K LRURG,VA,LRX,LRBERF,LRBETN
"RTN","LRTSTJAM",39,0)
 Q
"RTN","LRTSTJAM",40,0)
CHK ;from LRTSTJAN
"RTN","LRTSTJAM",41,0)
 D CHK1 I LREND W !,$C(7),"CAN'T DO IT.  The data has been approved for that log number."
"RTN","LRTSTJAM",42,0)
 Q
"RTN","LRTSTJAM",43,0)
CHK1 I $D(^LRO(68,LRWL1,1,LRWDT1,1,LRAN,3)),$P(^(3),U,4) S LREND=1 Q
"RTN","LRTSTJAM",44,0)
 I $D(^LRO(69,LRODT,1,LRSN,3)),$P(^(3),U,2) S LREND=1 Q
"RTN","LRTSTJAM",45,0)
 S LRTST=0 F  S LRTST=$O(^LRO(68,LRWL1,1,LRWDT1,1,LRAN,4,LRTST)) Q:LRTST<1  I $D(^(LRTST,0)),$P(^(0),U,5) S LREND=1 Q
"RTN","LRTSTJAM",46,0)
 Q
"RTN","LRTSTSET")
0^17^B18867118^B17772964
"RTN","LRTSTSET",1,0)
LRTSTSET ;SLC/CJS/JAH - JAM TESTS ONTO (OR OFF) ACCESSIONS ;8/10/04
"RTN","LRTSTSET",2,0)
 ;;5.2;LAB SERVICE;**65,100,121,153,201,202,263,291**;Sep 27, 1994
"RTN","LRTSTSET",3,0)
 ;Formerly apart of LRTSTJAM
"RTN","LRTSTSET",4,0)
EN ;
"RTN","LRTSTSET",5,0)
 I '($D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))#2) W !?10,"Sorry  This accession "_LRAN_" No longer exist",!?10," Accession may have been deleted.",!,$C(7) G ADDTST^LRTSTJAM
"RTN","LRTSTSET",6,0)
 S ^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRTS,0)=LRTS_"^"_LRURG,$P(^(0),U,9)=$G(LRTSP),^LRO(68,LRAA,1,LRAD,1,LRAN,4,"B",LRTS,LRTS)="",$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),U,4)=""
"RTN","LRTSTSET",7,0)
 S $P(^LRO(68,LRAA,1,LRAD,1,LRAN,4,0),U,3)=LRTS,$P(^(0),U,4)=$P(^(0),U,4)+1 I $P(LRPARAM,U,14),$P(^LRO(68,LRAA,0),U,16) D CAP^LRWLST12
"RTN","LRTSTSET",8,0)
 S LRACD=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),"^",3),LRTSAD(1,LRTS)=""
"RTN","LRTSTSET",9,0)
 D EN^LA7ADL($P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3),0),"^")) ;Check for automatic downloading
"RTN","LRTSTSET",10,0)
 I LRACD,LRACD'=LRAD S ^LRO(68,LRAA,1,LRACD,1,LRAN,4,LRTS,0)=LRTS_"^"_LRURG,$P(^(0),U,9)=+LRTS D
"RTN","LRTSTSET",11,0)
 .S ^LRO(68,LRAA,1,LRACD,1,LRAN,4,"B",LRTS,LRTS)="",$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),"^",4)="" I $P(LRPARAM,U,14),$P(^LRO(68,LRAA,0),U,16) D CAP^LRWLST12
"RTN","LRTSTSET",12,0)
 F  L +^LRO(69,LRODT,1,LRSN):1 Q:$T  W !?7,"Someone else is editing this order",!,$C(7) H 20
"RTN","LRTSTSET",13,0)
 K LRXDA,DA,DIC,DIE,DR
"RTN","LRTSTSET",14,0)
 S DIC="^LRO(69,"_LRODT_",1,"_LRSN_",2,",DA(2)=LRODT,DA(1)=LRSN
"RTN","LRTSTSET",15,0)
 S DIC(0)="LOX",DLAYGO=69,X=$P(^LAB(60,LRTS,0),"^") D ^DIC
"RTN","LRTSTSET",16,0)
69 I Y>0 D
"RTN","LRTSTSET",17,0)
 . S LRXDA(3)=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3))
"RTN","LRTSTSET",18,0)
 . S (LRXDA,DA)=+Y,DIE=DIC,DR="1///^S X=LRURG;2///^S X=LRAODT;3///^S X=LRAA;4///^S X=LRAN;8///^S X=""IP"";9///^S X=""L"""
"RTN","LRTSTSET",19,0)
 . I $L($P(LRXDA(3),U)) D
"RTN","LRTSTSET",20,0)
 . . S DR=DR_";13///^S X=$P(LRXDA(3),U)"
"RTN","LRTSTSET",21,0)
 . . S:$P(LRXDA(3),U,2) DR=DR_";14////^S X=$P(LRXDA(3),U,2);15////^S X=$P(LRXDA(3),U,3);16///^S X=$P(LRXDA(3),U,4);17///^S X=$P(LRXDA(3),U,5)"
"RTN","LRTSTSET",22,0)
 . D ^DIE
"RTN","LRTSTSET",23,0)
 . D:$G(LRTSP)
"RTN","LRTSTSET",24,0)
 . . S LRBETN=$O(^LRO(69,LRODT,1,LRSN,2,"B",LRTSP,""))
"RTN","LRTSTSET",25,0)
 . . I LRBETN D DADD^LRBEBA31(LRODT,LRSN,LRBETN,LRXDA,LRTS,$G(LRBERF))
"RTN","LRTSTSET",26,0)
 . K LRBETN,LRBERF
"RTN","LRTSTSET",27,0)
 I $G(LRXDA) D
"RTN","LRTSTSET",28,0)
 . N X,Y
"RTN","LRTSTSET",29,0)
 . S Y=$P($$FMTE^XLFDT($$NOW^XLFDT,"5Z"),":",1,2)
"RTN","LRTSTSET",30,0)
 . S X=1+$S($D(^LRO(69,LRODT,1,LRSN,2,LRXDA,1,0)):$P(^(0),"^",3),1:0),^(0)="^^"_X_"^"_DT,^(X,0)=" Added by "_$G(DUZ)_" on "_Y
"RTN","LRTSTSET",31,0)
 . S ^LRO(69,"AA",+$G(^LRO(69,LRODT,1,LRSN,.1)),LRODT_"|"_LRSN)=""
"RTN","LRTSTSET",32,0)
 I '$D(LRFLG) K DLAYGO,DA,DIC,DIE,DR,LRXDA L -^LRO(69,LRODT,1,LRSN) Q
"RTN","LRTSTSET",33,0)
SETOR ;
"RTN","LRTSTSET",34,0)
 I $G(LRXDA),$$VER^LR7OU1<3 D  ;OE/RR 2.5
"RTN","LRTSTSET",35,0)
 . I '$D(ORNATR) S ORNATR=$S($D(LRNATURE):LRNATURE,1:"") I '$D(LRNATURE) D:$P($G(^ORD(100.99,1,2)),"^",2) OT^LROR6 S LRNATURE=ORNATR
"RTN","LRTSTSET",36,0)
 . S X=^LRO(69,LRODT,1,LRSN,0),LRLB=$P(^(.1),"^"),X1=$S($D(^(1)):^(1),1:$P(X,"^",8)),ORVP=$P(^LR(+X,0),"^",3)_";"_$P(^DIC($P(^LR(+X,0),"^",2),0,"GL"),"^",2)
"RTN","LRTSTSET",37,0)
 . I ORNATR="C" S OREPDUZ=$P(X,"^",2),ORLOG=$P(X,"^",5),ORNATR=""
"RTN","LRTSTSET",38,0)
 . S LRORSAMP=$P(X,"^",3),LRORTYPE=$P(X,"^",4),ORNP=$P(X,"^",6),ORL=$S($L($P(X,"^",7)):$P(X,"^",7),1:"UNKNOWN")
"RTN","LRTSTSET",39,0)
 . S ORL=$S($O(^SC("C",ORL,0))'="":$O(^(0))_";SC(",1:""),ORSTRT=$P(X1,"^"),X=^LRO(69,LRODT,1,LRSN,2,LRXDA,0),ORIT=+X_";LAB(60,",LRORSPEC=$O(^LRO(69,LRODT,1,LRSN,4,0)),LRORSPEC=$S(LRORSPEC>0:$P(^(LRORSPEC,0),"^"),1:"")
"RTN","LRTSTSET",40,0)
 . S X=$S($D(LRORSAMP):$S($D(^LAB(62,+LRORSAMP,0)):$P(^(0),"^"),1:""),1:""),Y=$S($D(LRORSPEC):$S($D(^LAB(61,+LRORSPEC,0)):$P(^(0),"^"),1:""),1:"")
"RTN","LRTSTSET",41,0)
 . S ORTX(1)=$P(^LAB(60,+LRTS,0),"^")_$S(Y'[X!(X=Y):" "_X,1:"")_$S(X'[Y:" "_Y,1:"")
"RTN","LRTSTSET",42,0)
 . S ORTX(1)=ORTX(1)_" LB #"_LRLB_"    "_$S($D(LRORTYPE):LRORTYPE,1:"")_$S(LRURG=9!('LRURG):"",1:"   "_$P(^LAB(62.05,LRURG,0),"^"))
"RTN","LRTSTSET",43,0)
 . S ORPCL=$P(^LAB(69.9,1,1),"^",6),ORSTS=6,ORTO=$P(^LAB(60,+ORIT,0),"^",6) S:$P(^LAB(69.9,1,0),"^",9) ORPURG=$P(^(0),"^",9)
"RTN","LRTSTSET",44,0)
 . S ORPCL=$P(^LAB(69.9,1,1),"^",6)_";ORD(101,",ORPK=LRODT_"^"_LRSN_"^"_DA,DA=LRXDA
"RTN","LRTSTSET",45,0)
 . D FILE^ORX
"RTN","LRTSTSET",46,0)
 . S:$D(ORIFN) $P(^LRO(69,LRODT,1,LRSN,2,LRXDA,0),"^",7)=ORIFN
"RTN","LRTSTSET",47,0)
 . K LRLB,LRXDA,LRFLG,LRORSPEC,LRORSAMP,LRORTYPE
"RTN","LRTSTSET",48,0)
 N LTS S LTS(LRTS)=""
"RTN","LRTSTSET",49,0)
 D NEW^LR7OB1(LRODT,LRSN,"SN",$G(LRNATURE),.LTS,6)
"RTN","LRTSTSET",50,0)
 K DLAYGO,DA,DIC,DIE,DR,LRBERF,LRBEFN,LRBEX L -^LRO(69,LRODT,1,LRSN)
"RTN","LRTSTSET",51,0)
B Q:$D(LRPHSET)  W !?5,$P(^LAB(60,LRTS,0),U,1)," ADDED" K DIC("B") Q:$D(LRTSAD(2))  G ADDTST^LRTSTJAM
"RTN","LRTSTSET",52,0)
 Q
"RTN","LRVER1")
0^36^B31119261^B30450805
"RTN","LRVER1",1,0)
LRVER1 ;DALOI/FHS/JAH - LAB ROUTINE DATA VERIFICATION ;8/10/04
"RTN","LRVER1",2,0)
 ;;5.2;LAB SERVICE;**42,153,201,215,239,240,263,232,286,291**;Sep 27, 1994
"RTN","LRVER1",3,0)
 ;
"RTN","LRVER1",4,0)
VER ; from LRGVP
"RTN","LRVER1",5,0)
 N LRBEY
"RTN","LRVER1",6,0)
 S LRLLOC=0,LRCW=8,LROUTINE=$P(^LAB(69.9,1,3),U,2) I $D(^LRO(69,LRODT,1,LRSN,0)) S LRLLOC=$P(^(0),U,7) S:'$L(LRLLOC) LRLLOC=0 W !,$P(^LRO(69,LRODT,1,LRSN,1),U,6)
"RTN","LRVER1",7,0)
 S LRCDT=$S($D(^LRO(68,LRAA,1,LRAD,1,LRAN,3)):$P(^(3),U,1,2),1:$P(^(0),U,3)_U),LREAL=$P(LRCDT,U,2)
"RTN","LRVER1",8,0)
 S LRCDT=+LRCDT,LRSAMP=$S($D(^LRO(69,LRODT,1,LRSN,0)):$P(^(0),U,3),1:"")
"RTN","LRVER1",9,0)
 S LRIDT=$S($P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5):$P(^(3),U,5),1:"")
"RTN","LRVER1",10,0)
 S:'LRIDT LRIDT=9999999-LRCDT
"RTN","LRVER1",11,0)
 D EXP
"RTN","LRVER1",12,0)
LD S LRSS="CH" ;ONLY WORKS FOR 'CH'
"RTN","LRVER1",13,0)
 S LRMETH=LRSS IF $D(^LR(LRDFN,LRSS,LRIDT,0)) S LRMETH=$P($P(^(0),U,8),";",1)
"RTN","LRVER1",14,0)
 W:$D(^LAB(62,+LRSAMP,0)) !,"Sample: ",$P(^(0),U)
"RTN","LRVER1",15,0)
 K ^TMP("LR",$J,"TMP"),LRORD,LRM
"RTN","LRVER1",16,0)
 D ^LRVER2
"RTN","LRVER1",17,0)
 K LRDL
"RTN","LRVER1",18,0)
 Q
"RTN","LRVER1",19,0)
 ;
"RTN","LRVER1",20,0)
 ;
"RTN","LRVER1",21,0)
EXP ; Get the list of tests for this ACC. from LRGVG1
"RTN","LRVER1",22,0)
 ; Do not process tests which have been "NP" (not performed).
"RTN","LRVER1",23,0)
 N I,N,IX,LRNLT,T1,X
"RTN","LRVER1",24,0)
 K LRTEST,LRNAME,LRSM60
"RTN","LRVER1",25,0)
 S LRALERT=LROUTINE,N=0,I=0,IX=+$G(^LRO(68,LRAA,1,LRAD,1,LRAN,5,1,0))
"RTN","LRVER1",26,0)
 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<.5  D
"RTN","LRVER1",27,0)
 . S X=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I,0))
"RTN","LRVER1",28,0)
 . I 'X Q
"RTN","LRVER1",29,0)
 . I $P(X,"^",6)="*Not Performed" Q
"RTN","LRVER1",30,0)
 . S N=N+1,LRTEST(N)=I,LRNLT=$S($P(X,"^",2)>50:$P(X,U,9),1:$P(X,"^"))
"RTN","LRVER1",31,0)
 . S LRTEST(N,"P")=LRNLT_U_$$NLT(LRNLT)
"RTN","LRVER1",32,0)
 . S LRAL=$P(X,U,2)#50
"RTN","LRVER1",33,0)
 . I LRAL S LRALERT=$S(LRAL<LRALERT:LRAL,1:LRALERT)
"RTN","LRVER1",34,0)
 ;
"RTN","LRVER1",35,0)
 S LRNTN=N
"RTN","LRVER1",36,0)
 F T1=1:1:N I $D(^LAB(60,+LRTEST(T1),0)) D
"RTN","LRVER1",37,0)
 . S LRTEST(T1)=LRTEST(T1)_U_^(0)
"RTN","LRVER1",38,0)
 . S LRNAME(T1)=$P(LRTEST(T1),U,2),LRNAME(T1,+LRTEST(T1))=""
"RTN","LRVER1",39,0)
 . S:$G(^(1,IX,3)) LRSM60(+$P(LRTEST(T1),";",2))=^(3)
"RTN","LRVER1",40,0)
 . D EX1
"RTN","LRVER1",41,0)
 K IX
"RTN","LRVER1",42,0)
 N X1,X
"RTN","LRVER1",43,0)
 S X=$P($H,","),X(1)=$P($H,",",2),I=0
"RTN","LRVER1",44,0)
 F  S I=$O(LRSM60(I)) Q:'I  S X1=X-LRSM60(I)_","_X(1),LRSM60(I)=9999999-$$HTFM^XLFDT(X1)
"RTN","LRVER1",45,0)
 Q
"RTN","LRVER1",46,0)
 ;
"RTN","LRVER1",47,0)
 ;
"RTN","LRVER1",48,0)
EX1 ; Expand the list of tests to edit.
"RTN","LRVER1",49,0)
 Q:'$D(LRTEST(T1))
"RTN","LRVER1",50,0)
 S X=LRTEST(T1),^TMP("LR",$J,"VTO",+X)=$P($P(X,U,6),";",2)
"RTN","LRVER1",51,0)
 S ^TMP("LR",$J,"VTO",+X,"P")=LRTEST(T1,"P"),S1=0,J=0
"RTN","LRVER1",52,0)
 D EX2
"RTN","LRVER1",53,0)
 K S1,J
"RTN","LRVER1",54,0)
 Q
"RTN","LRVER1",55,0)
 ;
"RTN","LRVER1",56,0)
EX2 ;
"RTN","LRVER1",57,0)
 S:'$D(LRCFL) LRCFL=""
"RTN","LRVER1",58,0)
 S LRSUB=$P(X,U,6)
"RTN","LRVER1",59,0)
 I $D(^LAB(60,+X,4)),$P(^(4),"^",2) S LRCFL=LRCFL_$P(^(4),"^",2)_U
"RTN","LRVER1",60,0)
 ;
"RTN","LRVER1",61,0)
 ; If atomic test then setup and quit
"RTN","LRVER1",62,0)
 I LRSUB'="" D  Q
"RTN","LRVER1",63,0)
 . S S2=$P(LRSUB,";",2)
"RTN","LRVER1",64,0)
 . D:'$D(^TMP("LR",$J,"TMP",S2)) ORD
"RTN","LRVER1",65,0)
 ;
"RTN","LRVER1",66,0)
 ; Explode panel tests
"RTN","LRVER1",67,0)
 ; Do not process tests which have been "NP" (not performed).
"RTN","LRVER1",68,0)
 S S1=S1+1,S1(S1)=X,S1(S1,1)=J
"RTN","LRVER1",69,0)
 S J=0
"RTN","LRVER1",70,0)
 F  S J=$O(^LAB(60,+S1(S1),2,J)) Q:J<1  D
"RTN","LRVER1",71,0)
 . S Y=+^(J,0),X=Y_U_^LAB(60,Y,0)
"RTN","LRVER1",72,0)
 . I $P($G(^LRO(68,+$G(LRAA),1,+$G(LRAD),1,+$G(LRAN),4,Y,0)),"^",6)="*Not Performed" Q
"RTN","LRVER1",73,0)
 . D EX2
"RTN","LRVER1",74,0)
 S X=S1(S1),J=S1(S1,1),S1=S1-1
"RTN","LRVER1",75,0)
 Q
"RTN","LRVER1",76,0)
 ;
"RTN","LRVER1",77,0)
 ;
"RTN","LRVER1",78,0)
ORD ;
"RTN","LRVER1",79,0)
 ; LRNX is set by caller
"RTN","LRVER1",80,0)
 S LRNX=+$G(LRNX)+1,LRORD(LRNX)=S2
"RTN","LRVER1",81,0)
 S LRBEY($P(LRTEST(T1),U,1),S2)=""   ; CIDC
"RTN","LRVER1",82,0)
 S ^TMP("LR",$J,"TMP",S2)=+X
"RTN","LRVER1",83,0)
 ; If panel being exploded then set parent("P" node)
"RTN","LRVER1",84,0)
 ;  to file #60 test being exploded
"RTN","LRVER1",85,0)
 I $G(LRTEST(T1,"P")) D
"RTN","LRVER1",86,0)
 . I +LRTEST(T1)=+LRTEST(T1,"P") S ^TMP("LR",$J,"TMP",S2,"P")=LRTEST(T1,"P")_"!"_$$RNLT(+X)
"RTN","LRVER1",87,0)
 . E  S ^TMP("LR",$J,"TMP",S2,"P")=+LRTEST(T1)_U_$$NLT(+LRTEST(T1))_"!"_$$RNLT(+X)
"RTN","LRVER1",88,0)
 ;
"RTN","LRVER1",89,0)
 I $P(X,U,18) D
"RTN","LRVER1",90,0)
 . S LRM(S2)=+X
"RTN","LRVER1",91,0)
 . S LRM(S2,"P")=$G(^TMP("LR",$J,"TMP",S2,"P"))
"RTN","LRVER1",92,0)
 . S LRMX(+X)=""
"RTN","LRVER1",93,0)
 Q
"RTN","LRVER1",94,0)
 ;
"RTN","LRVER1",95,0)
 ;
"RTN","LRVER1",96,0)
NLT(X) ;
"RTN","LRVER1",97,0)
 N Y
"RTN","LRVER1",98,0)
 S Y=$S($P($G(^LAM(+$G(^LAB(60,+X,64)),0)),U,2):$P(^(0),U,2),1:"")
"RTN","LRVER1",99,0)
 Q Y
"RTN","LRVER1",100,0)
 ;
"RTN","LRVER1",101,0)
 ;
"RTN","LRVER1",102,0)
RNLT(X) ;
"RTN","LRVER1",103,0)
 I 'X Q ""
"RTN","LRVER1",104,0)
 N Y
"RTN","LRVER1",105,0)
 S Y(1)=+$P($G(^LAB(60,X,64)),U,2)
"RTN","LRVER1",106,0)
 S Y=$S($P($G(^LAM(Y(1),0)),U,2):$P(^(0),U,2),1:"")
"RTN","LRVER1",107,0)
 I Y S $P(Y,"!",2)=$$LNC(Y,$G(LRCDEF),$G(LRSPEC))
"RTN","LRVER1",108,0)
 S $P(Y,"!",3)=$G(LRCDEF),$P(Y,"!",6)=X
"RTN","LRVER1",109,0)
 Q Y
"RTN","LRVER1",110,0)
 ;
"RTN","LRVER1",111,0)
 ;
"RTN","LRVER1",112,0)
LNC(LRNLT,LRCDEF,LRSPEC) ;reture the LOINC code for WKLD Code/Specimen
"RTN","LRVER1",113,0)
 ; Call with (nlt code,method suffix,test specimen)
"RTN","LRVER1",114,0)
 ; TA = Time Aspect
"RTN","LRVER1",115,0)
 N X,N,Y,LRSPECN,VAL,ERR,TA S X=""
"RTN","LRVER1",116,0)
 Q:'LRNLT X
"RTN","LRVER1",117,0)
 K LRMSGM
"RTN","LRVER1",118,0)
 S:$G(LRCDEF)="" LRCDEF="0000"
"RTN","LRVER1",119,0)
 I $P(LRCDEF,".",2) S LRCDEF=$P(LRCDEF,".",2)
"RTN","LRVER1",120,0)
 S LRCDEF=$S($P(LRNLT,".",2):$P(LRNLT,".",2),1:LRCDEF)
"RTN","LRVER1",121,0)
 I $L(LRCDEF)'=4 S LRCDEF=LRCDEF_$E("0000",$L(LRCDEF),($L(LRCDEF-4)))
"RTN","LRVER1",122,0)
 S LRCDEF=LRCDEF_" "
"RTN","LRVER1",123,0)
 S LRSPEC=+LRSPEC
"RTN","LRVER1",124,0)
 ;Get time aspect from 61
"RTN","LRVER1",125,0)
 S TA=$$GET1^DIQ(61,LRSPEC_",",.0961,"I")
"RTN","LRVER1",126,0)
 S LRSPECN=$S($D(^LAB(61,LRSPEC,0))#2:$$GET1^DIQ(61,LRSPEC_",",.01),1:"Unknown")
"RTN","LRVER1",127,0)
 S LRNLT=$P(LRNLT,".")_"."
"RTN","LRVER1",128,0)
 ;Check for WKLD CODE_LOAD/WORK LIST method suffix
"RTN","LRVER1",129,0)
 S VAL(1)=LRNLT_LRCDEF
"RTN","LRVER1",130,0)
 S N=$$FIND1^DIC(64,"","X",.VAL,"C","","ERR")
"RTN","LRVER1",131,0)
 ;Looking for specimen specific LOINC
"RTN","LRVER1",132,0)
 I N,LRSPEC D  I X D MSG(1) Q X
"RTN","LRVER1",133,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",134,0)
 . S TA=$O(^LAM(N,5,LRSPEC,1,0)) ; get time aspect
"RTN","LRVER1",135,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",136,0)
 ;Looking LOINC default
"RTN","LRVER1",137,0)
 I N S X=$$LDEF(N) I X D MSG(2) Q X
"RTN","LRVER1",138,0)
 I LRCDEF="0000 " Q ""
"RTN","LRVER1",139,0)
 ;Looking for WKLD CODE_GENERIC suffix
"RTN","LRVER1",140,0)
 K VAL
"RTN","LRVER1",141,0)
 S VAL(1)=LRNLT_"0000 "
"RTN","LRVER1",142,0)
 S N=$$FIND1^DIC(64,"","X",.VAL,"C","","ERR")
"RTN","LRVER1",143,0)
 I 'N Q ""
"RTN","LRVER1",144,0)
 ;Looking for WKLD CODE_GENERIC specimen specific LOINC
"RTN","LRVER1",145,0)
 I LRSPEC D  I X D MSG(3) Q X
"RTN","LRVER1",146,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",147,0)
 . S TA=$O(^LAM(N,5,LRSPEC,1,0)) ; get time aspect
"RTN","LRVER1",148,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",149,0)
 ;Looking for WKLD CODE_GENERIC default LOINC
"RTN","LRVER1",150,0)
 I 'X,N S X=$$LDEF(N) I X D MSG(4)
"RTN","LRVER1",151,0)
 I 'X S X=""
"RTN","LRVER1",152,0)
 Q X
"RTN","LRVER1",153,0)
 ;
"RTN","LRVER1",154,0)
 ;
"RTN","LRVER1",155,0)
LDEF(Y) ;Find the default LOINC code for WKLD CODE
"RTN","LRVER1",156,0)
 I 'Y Q ""
"RTN","LRVER1",157,0)
 S X=$$GET1^DIQ(64,Y_",",25,"I")
"RTN","LRVER1",158,0)
 I 'X S X=""
"RTN","LRVER1",159,0)
 Q X
"RTN","LRVER1",160,0)
 ;
"RTN","LRVER1",161,0)
 ;
"RTN","LRVER1",162,0)
TMPSB(LRSB) ; Get LOINC code from ^TMP("LR",$J,"TMP",LRSB,"P")
"RTN","LRVER1",163,0)
 S NODE=$G(^TMP("LR",$J,"TMP",LRSB,"P"))
"RTN","LRVER1",164,0)
 I 'NODE Q ""
"RTN","LRVER1",165,0)
 S $P(NODE,"!",3)=$$LNC($P(NODE,"!",2),$G(LRCDEF),$G(LRSPEC))
"RTN","LRVER1",166,0)
 S $P(NODE,"!",4)=$G(LRCDEF)
"RTN","LRVER1",167,0)
 Q $P(NODE,U,2)
"RTN","LRVER1",168,0)
 ;
"RTN","LRVER1",169,0)
 ;
"RTN","LRVER1",170,0)
MSG(VAL) ;Set output message
"RTN","LRVER1",171,0)
 Q:'$G(LRMSG)
"RTN","LRVER1",172,0)
 S LRMSGM="0-No LOINC Code Defined for "_LRNLT_LRCDEF
"RTN","LRVER1",173,0)
 N TANAME
"RTN","LRVER1",174,0)
 I $G(TA) S TANAME=$$GET1^DIQ(64.061,TA_",",.01,"E") ;TA Name
"RTN","LRVER1",175,0)
 I VAL=1 S LRMSGM="1-"_LRNLT_$E(LRCDEF,1,4)_" - "_LRSPECN
"RTN","LRVER1",176,0)
 I VAL=2 S LRMSGM="2-"_LRNLT_$E(LRCDEF,1,4)_" - Default LOINC"
"RTN","LRVER1",177,0)
 I VAL=3 S LRMSGM="3-"_LRNLT_"0000 - "_LRSPECN
"RTN","LRVER1",178,0)
 I VAL=4 S LRMSGM="4-"_LRNLT_"0000 - Default LOINC"
"RTN","LRVER1",179,0)
 I $G(TA) S LRMSGM=LRMSGM_" Time Aspect "_TANAME
"RTN","LRVER1",180,0)
 W:$G(LRDBUG) !,LRMSGM,!
"RTN","LRVER1",181,0)
 Q
"RTN","LRVER3")
0^35^B49207018^B48071171
"RTN","LRVER3",1,0)
LRVER3 ;DALOI/CJS/JAH - DATA VERIFICATION ;8/10/04
"RTN","LRVER3",2,0)
 ;;5.2;LAB SERVICE;**42,100,121,140,171,153,221,286,291**;Sep 27, 1994
"RTN","LRVER3",3,0)
 ;
"RTN","LRVER3",4,0)
 D V1
"RTN","LRVER3",5,0)
 I $D(LRLOCKER)#2 L -@(LRLOCKER) K LRLOCKER
"RTN","LRVER3",6,0)
 Q
"RTN","LRVER3",7,0)
 ;
"RTN","LRVER3",8,0)
 ;
"RTN","LRVER3",9,0)
V1 I $D(LRLOCKER)#2 L -@(LRLOCKER)
"RTN","LRVER3",10,0)
 S LRLOCKER="^LR("_LRDFN_","""_LRSS_""","_LRIDT_")"
"RTN","LRVER3",11,0)
 L +@(LRLOCKER):1
"RTN","LRVER3",12,0)
 I '$T W !," This entry is being edited by someone else." Q
"RTN","LRVER3",13,0)
 I $D(LRGVP) S X="1-"_LRNTN D RANGE^LRWU2 G L10
"RTN","LRVER3",14,0)
 S LRALL="",LRALERT=LROUTINE,LRLCT=6
"RTN","LRVER3",15,0)
 ;
"RTN","LRVER3",16,0)
 ; List any not performed tests.
"RTN","LRVER3",17,0)
 S I=0
"RTN","LRVER3",18,0)
 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<1  D
"RTN","LRVER3",19,0)
 . S LRX=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I,0))
"RTN","LRVER3",20,0)
 . I $P(LRX,"^",6)'="*Not Performed" Q
"RTN","LRVER3",21,0)
 . W !,?3,$P(^LAB(60,I,0),"^"),?25," ",$P(LRX,"^",6)
"RTN","LRVER3",22,0)
 . S LRLCT=LRLCT+1 D:LRLCT>22 WT^LRVER4
"RTN","LRVER3",23,0)
 ;
"RTN","LRVER3",24,0)
 ; No tests to edit
"RTN","LRVER3",25,0)
 I LRNTN=0 D COM^LRVR4 G EXIT
"RTN","LRVER3",26,0)
 ;
"RTN","LRVER3",27,0)
 F I=1:1:LRNTN I $D(LRNAME(I)) D
"RTN","LRVER3",28,0)
 . S LRALL=LRALL_","_I W !,I,"  ",LRNAME(I)
"RTN","LRVER3",29,0)
 . I $D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,$O(LRNAME(I,0)),0))#2 D
"RTN","LRVER3",30,0)
 . . S LRX=^LRO(68,LRAA,1,LRAD,1,LRAN,4,$O(LRNAME(I,0)),0)
"RTN","LRVER3",31,0)
 . . S LRAL=$P(LRX,U,2)#50
"RTN","LRVER3",32,0)
 . . I $P(LRX,U,5) W ?25,$S($P(LRX,U,6)'="":$P(LRX,U,6),1:" verified")
"RTN","LRVER3",33,0)
 . . I LRAL S LRALERT=$S(LRAL<LRALERT:LRAL,1:LRALERT)
"RTN","LRVER3",34,0)
 . S LRLCT=LRLCT+1 D:LRLCT>22 WT^LRVER4
"RTN","LRVER3",35,0)
 ;
"RTN","LRVER3",36,0)
 I $D(LRALERT),LRALERT<($P(LRPARAM,U,20)+1) D
"RTN","LRVER3",37,0)
 . W !?15 W:IOST["C-" @LRVIDO
"RTN","LRVER3",38,0)
 . W "Test ordered "_$P($G(^LAB(62.05,+LRALERT,0)),U)
"RTN","LRVER3",39,0)
 . W:IOST["C-" @LRVIDOF W !,$C(7)
"RTN","LRVER3",40,0)
 ;
"RTN","LRVER3",41,0)
 S X9="" I LRNTN=1 S T1=1 G L10
"RTN","LRVER3",42,0)
V9 S LRALL=$P(LRALL,",",2,99)
"RTN","LRVER3",43,0)
 R !!,"TEST #(s) (or ""ALL""): ",X:DTIME S:'$T X=U S:X["A" X=LRALL
"RTN","LRVER3",44,0)
 I X["?" W !,"Enter for example 1,2,5-9." G V9
"RTN","LRVER3",45,0)
 Q:X[U!(X="")  D RANGE^LRWU2 G EXIT:X9="" X (X9_"S:'$D(LRNAME(T1)) X=0") G EXIT:X=0
"RTN","LRVER3",46,0)
L10 ;
"RTN","LRVER3",47,0)
 N LRCORECT S LRCORECT=0
"RTN","LRVER3",48,0)
 S LRNX=0 X (X9_"D EX1^LRVER1")
"RTN","LRVER3",49,0)
 D V7^LRVER2
"RTN","LRVER3",50,0)
 S LRCMTDSP=$$CHKCDSP^LRVERA
"RTN","LRVER3",51,0)
 K LRSA,LRSB,LRORU3
"RTN","LRVER3",52,0)
 F LRSB=1:0 S LRSB=$O(^LR(LRDFN,LRSS,LRIDT,LRSB)) Q:LRSB<1  D
"RTN","LRVER3",53,0)
 . S LRSB(LRSB)=^(LRSB),LRSB(LRSB,"P")=$P(LRSB(LRSB),U,3)
"RTN","LRVER3",54,0)
 . I $D(LRNOVER) S LRNOVER(LRSB)=""
"RTN","LRVER3",55,0)
 S LREDIT=1
"RTN","LRVER3",56,0)
 D ^LRVER4
"RTN","LRVER3",57,0)
 ;
"RTN","LRVER3",58,0)
 ; If group data review then quit before updating results
"RTN","LRVER3",59,0)
 I $D(LRGVP) G EXIT
"RTN","LRVER3",60,0)
 ;
"RTN","LRVER3",61,0)
 I '$O(LRORD(0)) G EXIT
"RTN","LRVER3",62,0)
 I '$G(LRCHG),'LRVF F LRSB=1:0 S LRSB=$O(LRSB(LRSB)) Q:LRSB<1  S:LRSB(LRSB)'="" ^LR(LRDFN,LRSS,LRIDT,LRSB)=LRSB(LRSB)
"RTN","LRVER3",63,0)
 I $G(LRCHG) D CHG K LRCHG,LRUP I $G(LREND) S LREND=0 G EXIT
"RTN","LRVER3",64,0)
 ;
"RTN","LRVER3",65,0)
 I $D(LRSA),$D(LRF) K LRF S X=$P(^LR(LRDFN,LRSS,LRIDT,0),U,9) S:$L(X)&($E(X)'["-") $P(^(0),U,9)="-"_X G V11
"RTN","LRVER3",66,0)
 G EXIT:$D(LRGVP),V11:LRVF&$D(LRSA),V1:LRVF&(LRNTN>1),EXIT:LRVF
"RTN","LRVER3",67,0)
 ;
"RTN","LRVER3",68,0)
NOVER I $O(LRNOVER(0)) D  G EXIT
"RTN","LRVER3",69,0)
 . F I=0:0 S I=+$O(LRNOVER(I)) Q:I<2  W !,"Test Not Reviewed: ",$P(^DD(63.04,I,0),U) W:$D(LRSB(I))#2 " = "_$P(LRSB(I),U)_" "_$P(LRSB(I),U,2)
"RTN","LRVER3",70,0)
 . W !,$$CJ^XLFSTR("The above test(s) have results already entered,",80)
"RTN","LRVER3",71,0)
 . W !,$$CJ^XLFSTR("but you did not select them for review.",80)
"RTN","LRVER3",72,0)
 . W !,$$CJ^XLFSTR(" Accession NOT approved. ",80),$C(7)
"RTN","LRVER3",73,0)
 . W !,$$CJ^XLFSTR("You must review all results before ANY can be released.",80),!!
"RTN","LRVER3",74,0)
 . W:$E(IOST,1,2)="C-" @LRVIDO W $$CJ^XLFSTR("Suggest you select 'ALL' tests for verification/review. ",80) W:$E(IOST,1,2)="C-" @LRVIDOF W !,$C(7)
"RTN","LRVER3",75,0)
 I $O(LRNOVER(0)) W !,"Has not been reviewed and has data.  Not approved.",! G EXIT
"RTN","LRVER3",76,0)
 I '$P($G(LRLABKY),U) W !,$C(7),"ENTERED BUT NOT APPROVED",! G EXIT
"RTN","LRVER3",77,0)
 I '$O(LRSB(0)) W !?5,"Nothing verified ",$C(7),! G EXIT
"RTN","LRVER3",78,0)
 N CNT S CNT=1
"RTN","LRVER3",79,0)
AGAIN ;
"RTN","LRVER3",80,0)
 R !,"Approve for release by entering your initials: ",LRINI:DTIME
"RTN","LRVER3",81,0)
 I $E(LRINI)="^" W !!?5,$C(7),"Nothing verified!" D READ G EXIT
"RTN","LRVER3",82,0)
 I LRINI'=LRUSI,$$UP^XLFSTR(LRINI)=$$UP^XLFSTR(LRUSI) S LRINI=LRUSI
"RTN","LRVER3",83,0)
 I $S($E(LRINI)="?":1,LRINI'=LRUSI&(CNT<2):1,1:0) W !,$C(7),"Please enter your correct initials" S:$E(LRINI)="?" CNT=0 S CNT=CNT+1 G AGAIN
"RTN","LRVER3",84,0)
 I LRINI'=LRUSI W !!?5,$C(7),"Nothing verified!" D READ G EXIT
"RTN","LRVER3",85,0)
V11 I $D(XRTL) D T0^%ZOSV ; START RESPONSE TIME LOGGING
"RTN","LRVER3",86,0)
 I +LRDPF=2&($G(LRSS)'="BB")&('$$CHKINP^LRBEBA4(LRDFN,LRODT)) D
"RTN","LRVER3",87,0)
 .D BAWRK^LRBEBA(LRODT,LRSN,1,.LRBEY,.LRTEST)
"RTN","LRVER3",88,0)
 D VER^LRVER3A
"RTN","LRVER3",89,0)
 I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D LOOK^LRCAPV1
"RTN","LRVER3",90,0)
 N LRX
"RTN","LRVER3",91,0)
 S LRX=0
"RTN","LRVER3",92,0)
 F  S LRX=$O(^TMP("LR",$J,"TMP",LRX)) Q:LRX<1  S:'$D(^LRO(68,"AC",LRDFN,LRIDT,LRX)) ^(LRX)="" I LRVF S ^(LRX)=""
"RTN","LRVER3",93,0)
 I $P($G(LRORU3),U,3),$O(LRSB(0)) D LRORU3
"RTN","LRVER3",94,0)
 I $D(XRT0) S XRTN="V11^LRVER3" D T1^%ZOSV ; STOP RESPONSE TIME LOGGING
"RTN","LRVER3",95,0)
 S LRVF=1
"RTN","LRVER3",96,0)
 Q
"RTN","LRVER3",97,0)
 ;
"RTN","LRVER3",98,0)
 ;
"RTN","LRVER3",99,0)
EXIT Q
"RTN","LRVER3",100,0)
 ;
"RTN","LRVER3",101,0)
 ;
"RTN","LRVER3",102,0)
READ ;
"RTN","LRVER3",103,0)
 N X W !!,"Press ENTER or RETURN to continue: " R X:DTIME
"RTN","LRVER3",104,0)
 Q
"RTN","LRVER3",105,0)
 ;
"RTN","LRVER3",106,0)
 ;
"RTN","LRVER3",107,0)
CHG ; Check for changes, save results and create audit trail
"RTN","LRVER3",108,0)
 S LRUP=""
"RTN","LRVER3",109,0)
 F  S LRCHG=$O(LRSB(LRCHG)) Q:LRCHG<1  D
"RTN","LRVER3",110,0)
 . I '$D(LRSA(LRCHG)) S LRUP=1 Q
"RTN","LRVER3",111,0)
 . I $P(LRSA(LRCHG),"^")=""!($P(LRSA(LRCHG),"^")="pending") S LRUP=1 Q
"RTN","LRVER3",112,0)
 . I $P(LRSA(LRCHG),"^")'=$P(LRSB(LRCHG),"^") S LRUP=1,$P(LRSA(LRCHG,2),"^")=1 ; results changed
"RTN","LRVER3",113,0)
 . I $P(LRSA(LRCHG),"^",2)'=$P(LRSB(LRCHG),"^",2) S LRUP=1,$P(LRSA(LRCHG,2),"^",2)=1 ; normalcy flag changed
"RTN","LRVER3",114,0)
 . I $P(LRSA(LRCHG),"^",5)'=$P(LRSB(LRCHG),"^",5) D  ; units/normals changed
"RTN","LRVER3",115,0)
 . . N LRX,LRY
"RTN","LRVER3",116,0)
 . . S LRX=$$UP^XLFSTR($P(LRSA(LRCHG),"^",5)),LRX=$TR(LRX,"""")
"RTN","LRVER3",117,0)
 . . S LRY=$$UP^XLFSTR($P(LRSB(LRCHG),"^",5)),LRY=$TR(LRY,"""")
"RTN","LRVER3",118,0)
 . . I LRX'=LRY S LRUP=1,$P(LRSA(LRCHG,2),"^",5)=1
"RTN","LRVER3",119,0)
 I 'LRUP S LREND=1 Q
"RTN","LRVER3",120,0)
 S LREND=0
"RTN","LRVER3",121,0)
 W !! W:IOST["C-" @LRVIDO W "Approve update of data by entering your initials: " W:IOST["C-" @LRVIDOF
"RTN","LRVER3",122,0)
 R LRINI:DTIME
"RTN","LRVER3",123,0)
 I '$T S LREND=1
"RTN","LRVER3",124,0)
 I 'LREND,LRINI'=LRUSI,$$UP^XLFSTR(LRINI)=$$UP^XLFSTR(LRUSI) S LRINI=LRUSI
"RTN","LRVER3",125,0)
 I LRINI'=LRUSI S LREND=1
"RTN","LRVER3",126,0)
 I LREND W !,$C(7),"No updating occurred ",! Q
"RTN","LRVER3",127,0)
 ;
"RTN","LRVER3",128,0)
 F LRSB=1:0 S LRSB=$O(LRSB(LRSB)) Q:LRSB<1  D
"RTN","LRVER3",129,0)
 . K:'$D(^LR(LRDFN,LRSS,LRIDT,LRSB)) LRSA(LRSB)
"RTN","LRVER3",130,0)
 . S ^LR(LRDFN,LRSS,LRIDT,LRSB)=LRSB(LRSB)
"RTN","LRVER3",131,0)
 . I $D(LRSA(LRSB,1)),$D(LRSA(LRSB,2)) D DIDLE
"RTN","LRVER3",132,0)
 W !!
"RTN","LRVER3",133,0)
 Q
"RTN","LRVER3",134,0)
 ;
"RTN","LRVER3",135,0)
 ;
"RTN","LRVER3",136,0)
DIDLE ;
"RTN","LRVER3",137,0)
 ; Check if no previous result or pending result - no audit trail needed
"RTN","LRVER3",138,0)
 I $P(LRSA(LRSB),"^")=""!($P(LRSA(LRSB),"^")="pending") Q
"RTN","LRVER3",139,0)
 ;
"RTN","LRVER3",140,0)
 S LRF=1
"RTN","LRVER3",141,0)
 L +^LR(LRDFN,LRSS,LRIDT):999
"RTN","LRVER3",142,0)
NOW S LRNOW7=$$NOW^XLFDT
"RTN","LRVER3",143,0)
 W !
"RTN","LRVER3",144,0)
 D ^LRDIDLE0
"RTN","LRVER3",145,0)
 I 'LROK K LRSA
"RTN","LRVER3",146,0)
 L -^LR(LRDFN,LRSS,LRIDT)
"RTN","LRVER3",147,0)
 S LRCORECT=1
"RTN","LRVER3",148,0)
 Q
"RTN","LRVER3",149,0)
 ;
"RTN","LRVER3",150,0)
 ;
"RTN","LRVER3",151,0)
RONLT ; (R)esolve (O)rder NLT code from file #68 original ordered test or
"RTN","LRVER3",152,0)
 ; use default when not specified for file #60 test.
"RTN","LRVER3",153,0)
 ;
"RTN","LRVER3",154,0)
 N LR60,LRX,LRY,X
"RTN","LRVER3",155,0)
 S LR60=+LRTS,LRY=$P(LRSB(LRSB),U,3)
"RTN","LRVER3",156,0)
 ;
"RTN","LRVER3",157,0)
 ; Try to determine order NLT from original ordered test
"RTN","LRVER3",158,0)
 F  Q:'LR60  D
"RTN","LRVER3",159,0)
 . S LRX=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LR60,0)),LR60=+$P(LRX,"^",9)
"RTN","LRVER3",160,0)
 . I LR60,LR60'=$P(LRX,"^") D
"RTN","LRVER3",161,0)
 . . S X=$$NLT^LRVER1(LR60)
"RTN","LRVER3",162,0)
 . . I X'="" S $P(LRY,"!")=X
"RTN","LRVER3",163,0)
 . I LR60=$P(LRX,"^") S LR60=0
"RTN","LRVER3",164,0)
 ;
"RTN","LRVER3",165,0)
 ; Otherwise use default for lab package
"RTN","LRVER3",166,0)
 I $P(LRY,"!")="" S $P(LRY,"!")=$P($$DEFCODE^LA7VHLU5(LRSS,LRSB,LRY,+LRSPEC),"!")
"RTN","LRVER3",167,0)
 ;
"RTN","LRVER3",168,0)
 S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRVER3",169,0)
 ;
"RTN","LRVER3",170,0)
 Q
"RTN","LRVER3",171,0)
 ;
"RTN","LRVER3",172,0)
 ;
"RTN","LRVER3",173,0)
LRORU3 ;
"RTN","LRVER3",174,0)
SET ;
"RTN","LRVER3",175,0)
 N LR64,LR7V,LRDN,LROTA,LRT,LRTPN,LRTPNN,LRTYPE,X
"RTN","LRVER3",176,0)
 ;
"RTN","LRVER3",177,0)
 ; Go through LRSB array and sort results by order NLT code
"RTN","LRVER3",178,0)
 ; and put into ordered test array (LROTA).
"RTN","LRVER3",179,0)
 S LRDN=0
"RTN","LRVER3",180,0)
 F  S LRDN=$O(LRSB(LRDN)) Q:'LRDN  D
"RTN","LRVER3",181,0)
 . I $P(LRSB(LRDN),"^")="" Q
"RTN","LRVER3",182,0)
 . S LRTPNN=$P($P(LRSB(LRDN),U,3),"!"),LRT=+$G(^TMP("LR",$J,"TMP",LRDN))
"RTN","LRVER3",183,0)
 . I LRTPNN="" Q
"RTN","LRVER3",184,0)
 . S LRTYPE=$P($G(^LAB(60,LRT,0)),U,3)
"RTN","LRVER3",185,0)
 . I LRTYPE=""!("OB"'[LRTYPE) Q
"RTN","LRVER3",186,0)
 . S LROTA(LRTPNN,LRDN)=LRT
"RTN","LRVER3",187,0)
 . I $D(LRSA(LRDN,2)) S LROTA(LRTPNN,LRDN,1)="C"
"RTN","LRVER3",188,0)
 ;
"RTN","LRVER3",189,0)
 ; For each order NLT code setup call to put results into #62.49 queue
"RTN","LRVER3",190,0)
 S LRTPNN=""
"RTN","LRVER3",191,0)
 F  S LRTPNN=$O(LROTA(LRTPNN)) Q:LRTPNN=""  D
"RTN","LRVER3",192,0)
 . S LR64=+$O(^LAM("C",LRTPNN_" ",0)),LRTPN=$$GET1^DIQ(64,LR64_",",.01)
"RTN","LRVER3",193,0)
 . K LR7V
"RTN","LRVER3",194,0)
 . M LR7V=LROTA(LRTPNN)
"RTN","LRVER3",195,0)
 . D SET^LA7VMSG($P(LRORU3,U,4),$P(LRORU3,U,2),$P(LRORU3,U,5),$P(LRORU3,U,3),LRTPN,LRTPNN,LRIDT,LRSS,LRDFN,LRODT,.LR7V)
"RTN","LRVER3",196,0)
 Q
"RTN","LRVR1")
0^33^B36555743^B35974824
"RTN","LRVR1",1,0)
LRVR1 ;DALOI/CJS/JAH - LAB ROUTINE DATA VERIFICATION ;8/10/04
"RTN","LRVR1",2,0)
 ;;5.2;LAB SERVICE;**42,153,221,286,291**;Sep 27, 1994
"RTN","LRVR1",3,0)
 N LRI,LRN,LRBETST,LRBEY
"RTN","LRVR1",4,0)
 S (LRI,LRN)=0
"RTN","LRVR1",5,0)
 F  S LRI=$O(^LAH(LRLL,1,"C",LRAN,LRI)) Q:LRI<1  D
"RTN","LRVR1",6,0)
 . N LRX
"RTN","LRVR1",7,0)
 . S LRX=$G(^LAH(LRLL,1,LRI,0))
"RTN","LRVR1",8,0)
 . ; Quit if different accession area.
"RTN","LRVR1",9,0)
 . I $P(LRX,"^",3),$P(LRX,"^",3)'=LRAA Q
"RTN","LRVR1",10,0)
 . ; Quit if different accession date and not a rollover accession (same original accession date).
"RTN","LRVR1",11,0)
 . I $P(LRX,"^",4),$P(LRX,"^",4)'=LRAD,$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,0)),"^",3)'=$P($G(^LRO(68,LRAA,1,$P(LRX,"^",4),1,LRAN,0)),"^",3) Q
"RTN","LRVR1",12,0)
 . I LRN W !
"RTN","LRVR1",13,0)
 . S LRN=LRN+1,LRSQ=LRI
"RTN","LRVR1",14,0)
 . W !,?2,"Seq #: ",LRI,?13," Accession: ",$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.2)),"^")
"RTN","LRVR1",15,0)
 . I $P(LRX,"^",10) W ?40," Results received: ",$$FMTE^XLFDT($P(LRX,"^",10),"1M")
"RTN","LRVR1",16,0)
 . W !,?20,"UID: ",$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3),"UNKNOWN"),"^")
"RTN","LRVR1",17,0)
 . I $P(LRX,"^",11) W ?44," Last updated: ",$$FMTE^XLFDT($P(LRX,"^",11),"1M")
"RTN","LRVR1",18,0)
 G VER:LRN=1,T3:LRN>1
"RTN","LRVR1",19,0)
 ;
"RTN","LRVR1",20,0)
 ; If attempting to verify reference lab results and no entry in LAH
"RTN","LRVR1",21,0)
 ; associated with this accession then quit - do not allow manual entry
"RTN","LRVR1",22,0)
 ; of ref lab results via this option. Will not store units/normals.
"RTN","LRVR1",23,0)
 I $G(LRDUZ(2)),DUZ(2)'=LRDUZ(2) W !,"No data there" Q
"RTN","LRVR1",24,0)
 ;
"RTN","LRVR1",25,0)
T1 R !,"What tray: ",X:DTIME Q:X["^"!'$T  I X["?"!(X'?.N) W !,"Enter a number" G T1
"RTN","LRVR1",26,0)
 I X'="" S LRTRAY=X G T2
"RTN","LRVR1",27,0)
 I $D(^LRO(68.2,"AS",LRLL)) W !,"Can't MANUALLY add to a SEQUENCE instrument data file." G QUIT
"RTN","LRVR1",28,0)
 W !,"Enter manually" S %=1 D YN^DICN G QUIT:%<1,T1:%=2 S LRSQ=-1 G VER
"RTN","LRVR1",29,0)
 G VER
"RTN","LRVR1",30,0)
T2 R !,"What cup: ",X:DTIME Q:X["^"!'$T  I X["?"!(X'?.N) W !,"Enter a number" G T2
"RTN","LRVR1",31,0)
 Q:X=""  S LRTRCP=LRTRAY_";"_X
"RTN","LRVR1",32,0)
 K LRPRGSQ
"RTN","LRVR1",33,0)
 S LRN=0 F LRI=0:0 S LRI=$O(^LAH(LRLL,1,"B",LRTRCP,LRI)) Q:LRI<1  S LRN=LRN+1,LRSQ=LRI,LRPRGSQ(LRI)="" W !,?5,LRI
"RTN","LRVR1",34,0)
T3 I LRN=0 W !,"No data for that tray & cup" Q
"RTN","LRVR1",35,0)
 I LRN>1 R !,"Choose sequence number: ",X:DTIME Q:'$T  I X["?"!(X'?.N) W !,"Enter a number" G T3
"RTN","LRVR1",36,0)
 I X["^"!(X="") K LRPRGSQ Q
"RTN","LRVR1",37,0)
 S:LRN'=1 LRSQ=X I '$D(^LAH(LRLL,1,LRSQ,0)) W !,"No data there" G T3
"RTN","LRVR1",38,0)
 ;
"RTN","LRVR1",39,0)
VER ; from LRFLAG, LRGP, LRVRW
"RTN","LRVR1",40,0)
 N LRROOT
"RTN","LRVR1",41,0)
 K LRTEST,LRNM,^TMP("LR",$J,"TMP")
"RTN","LRVR1",42,0)
 S LRUID=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3)),"^")
"RTN","LRVR1",43,0)
 ;
"RTN","LRVR1",44,0)
 ; Determine if there are amended results to process via "EM"
"RTN","LRVR1",45,0)
 S LRROOT=$Q(^LAH("LA7 AMENDED RESULTS",LRUID,1,LRLL))
"RTN","LRVR1",46,0)
 I LRROOT'="",$QS(LRROOT,1)="LA7 AMENDED RESULTS",$QS(LRROOT,2)=LRUID,$QS(LRROOT,4)=LRLL D  Q
"RTN","LRVR1",47,0)
 . W !!,"Amended results exist for this accession. Please process these"
"RTN","LRVR1",48,0)
 . W !,"first using option Enter/verify/modify data (manual) [LRENTER]"
"RTN","LRVR1",49,0)
 ;
"RTN","LRVR1",50,0)
 D TEST
"RTN","LRVR1",51,0)
 I $O(^TMP("LR",$J,"TMP",0))="" W !,"No tests in editing profile" Q
"RTN","LRVR1",52,0)
 S X=DUZ D DUZ^LRX
"RTN","LRVR1",53,0)
 G V2:LRSQ>0
"RTN","LRVR1",54,0)
 L +^LAH(LRLL)
"RTN","LRVR1",55,0)
 S (^LAH(LRLL),LRSQ)=1+$G(^LAH(LRLL))
"RTN","LRVR1",56,0)
 S ^LAH(LRLL,1,LRSQ,0)="^^"_LRAA_"^"_LRAD_"^"_LRAN_"^^MANUAL"
"RTN","LRVR1",57,0)
 D UID^LAGEN(LRLL,LRSQ,LRUID)
"RTN","LRVR1",58,0)
 D UPDT^LAGEN(LRLL,LRSQ)
"RTN","LRVR1",59,0)
 S ^LAH(LRLL,1,"C",LRAN,LRSQ)=""
"RTN","LRVR1",60,0)
 L -^LAH(LRLL)
"RTN","LRVR1",61,0)
V2 K LRPRGSQ(LRSQ)
"RTN","LRVR1",62,0)
 S LRLLOC=0,LROUTINE=$P(^LAB(69.9,1,3),U,2)
"RTN","LRVR1",63,0)
 I $D(^LRO(69,LRODT,1,LRSN,0)) S LRLLOC=$P(^(0),U,7) S:'$L(LRLLOC) LRLLOC=0 W !,$P(^LRO(69,LRODT,1,LRSN,1),U,6)
"RTN","LRVR1",64,0)
 S LRCDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U)
"RTN","LRVR1",65,0)
 I '$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),"^",3) D
"RTN","LRVR1",66,0)
 . N %DT,LRA1,LRA2,LRA3
"RTN","LRVR1",67,0)
 . S %DT("B")=$$FMTE^XLFDT(LRCDT,"1")
"RTN","LRVR1",68,0)
 . S LRSTATUS="C",LRA1=LRAA,LRA2=LRAD,LRA3=LRAN
"RTN","LRVR1",69,0)
 . D P15^LROE1
"RTN","LRVR1",70,0)
 . S LRAA=LRA1,LRAD=LRA2,LRAN=LRA3
"RTN","LRVR1",71,0)
 . I LRCDT<1 Q
"RTN","LRVR1",72,0)
 . I '$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,3) S $P(^(3),U,3)=$$NOW^XLFDT
"RTN","LRVR1",73,0)
 ; If user did not update then go to next
"RTN","LRVR1",74,0)
 I '$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,3) Q
"RTN","LRVR1",75,0)
 S LRCDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U)
"RTN","LRVR1",76,0)
 I LRCDT<1 Q
"RTN","LRVR1",77,0)
 S LREAL=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,2),LRALERT=LROUTINE
"RTN","LRVR1",78,0)
 S I=0
"RTN","LRVR1",79,0)
 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<.5  I $G(^(I,0)) S LRAL=$P($G(^(0)),U,2) D
"RTN","LRVR1",80,0)
 . I $G(LRAL) S LRALERT=$S(LRAL<50&(LRAL<LRALERT):LRAL,LRAL>50&(LRAL-50<LRALERT):LRAL-50,1:LRALERT)
"RTN","LRVR1",81,0)
 S LRSAMP=$P($G(^LRO(69,LRODT,1,LRSN,0)),U,3)
"RTN","LRVR1",82,0)
 ;
"RTN","LRVR1",83,0)
 S LRSS=$P(^LRO(68,LRAA,0),U,2)
"RTN","LRVR1",84,0)
 I LRSS'="CH" Q
"RTN","LRVR1",85,0)
 ; Check for valid pointer to file #63 and entry in file #63.
"RTN","LRVR1",86,0)
 S LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5)
"RTN","LRVR1",87,0)
 I LRIDT<1 W !,">>>>ERROR - NO POINTER TO FILE #63 - PLEASE NOTIFY SYSTEM MANAGER^ <<<<<",! Q
"RTN","LRVR1",88,0)
 I '$D(^LR(LRDFN,LRSS,LRIDT,0)) W !,">>>>ERROR - NO ENTRY IN FILE #63 - PLEASE NOTIFY SYSTEM MANAGER<<^ <<<",! Q
"RTN","LRVR1",89,0)
 ;
"RTN","LRVR1",90,0)
 S LRCW=8
"RTN","LRVR1",91,0)
LD S LRSS="CH"
"RTN","LRVR1",92,0)
 I '($D(^LAH(LRLL,1,LRSQ,0))#2) W !!?5,"No Data for this Accession ",!! K ^LAH(LRLL,1,LRSQ),^LAH(LRLL,1,"C",LRAN,LRSQ) K LRPRGSQ Q
"RTN","LRVR1",93,0)
 ;
"RTN","LRVR1",94,0)
 ; Store any new methods with existing methods on file.
"RTN","LRVR1",95,0)
 S LRMETH=$P(^LAH(LRLL,1,LRSQ,0),U,7) S:$D(LRGVP) LRMETH=LRMETH_"(GV)"
"RTN","LRVR1",96,0)
 I $P($G(^LR(LRDFN,LRSS,LRIDT,0)),U,8)'="" D
"RTN","LRVR1",97,0)
 . N I,X
"RTN","LRVR1",98,0)
 . S X=$P(^LR(LRDFN,LRSS,LRIDT,0),U,8)
"RTN","LRVR1",99,0)
 . F I=1:1:$L(X,";") I $P(X,";",I)'="",LRMETH'[$P(X,";",I) S LRMETH=LRMETH_";"_$P(X,";",I)
"RTN","LRVR1",100,0)
 I LRMETH'="" S $P(^LR(LRDFN,LRSS,LRIDT,0),U,8)=LRMETH
"RTN","LRVR1",101,0)
 ;
"RTN","LRVR1",102,0)
 W:$D(^LAB(62,+LRSAMP,0)) !,"Sample: ",$P(^(0),U)
"RTN","LRVR1",103,0)
 ;
"RTN","LRVR1",104,0)
 D ^LRVR2
"RTN","LRVR1",105,0)
 K LRDL,LRPRGSQ
"RTN","LRVR1",106,0)
 Q  ; leave LRVR1, back to LRVR
"RTN","LRVR1",107,0)
 ;
"RTN","LRVR1",108,0)
 ;
"RTN","LRVR1",109,0)
TEST ; from LRGV1
"RTN","LRVR1",110,0)
 N LRI,LRX
"RTN","LRVR1",111,0)
 S LRI=0
"RTN","LRVR1",112,0)
 F  S LRI=$O(^TMP("LR",$J,"VTO",LRI)) Q:LRI<1  K ^(LRI,"P")
"RTN","LRVR1",113,0)
 S (LRI,LRNT)=0
"RTN","LRVR1",114,0)
 F  S LRI=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRI)) Q:LRI<.5  I $D(^(LRI,0)),'$L($P(^(0),U,6)) S X=^(0) I $D(^TMP("LR",$J,"VTO",+X)) D
"RTN","LRVR1",115,0)
 . S LRNT=LRNT+1,LRTEST(LRNT)=+X,LRX=$S($P(X,"^",2)>50:$P(X,"^",9),1:$P(X,"^"))
"RTN","LRVR1",116,0)
 . S LRTEST(LRNT,"P")=LRX_U_$$NLT^LRVER1(LRX)_"!"
"RTN","LRVR1",117,0)
 . S ^TMP("LR",$J,"VTO",+X,"P")=$P(LRTEST(LRNT,"P"),"!")
"RTN","LRVR1",118,0)
 ;
"RTN","LRVR1",119,0)
TEST1 ; from LRFLAG
"RTN","LRVR1",120,0)
 ;
"RTN","LRVR1",121,0)
 N LRI
"RTN","LRVR1",122,0)
 F LRI=1:1:LRNT S:$D(^LAB(60,+LRTEST(LRI),0)) (LRTEST(LRI),LRBETST(LRI))=LRTEST(LRI)_U_^(0)
"RTN","LRVR1",123,0)
 I $G(LRORDR)'="P" K ^TMP("LR",$J,"TMP")
"RTN","LRVR1",124,0)
 S LRNX=0
"RTN","LRVR1",125,0)
 K LRM
"RTN","LRVR1",126,0)
 F I=1:1 Q:'$D(LRTEST(I))  D
"RTN","LRVR1",127,0)
 . S X=LRTEST(I),XP=$G(LRTEST(I,"P"))
"RTN","LRVR1",128,0)
 . K LRTEST(I)
"RTN","LRVR1",129,0)
 . D EX2
"RTN","LRVR1",130,0)
 K LRTEST
"RTN","LRVR1",131,0)
 Q
"RTN","LRVR1",132,0)
 ;
"RTN","LRVR1",133,0)
 ;
"RTN","LRVR1",134,0)
EX2 ;
"RTN","LRVR1",135,0)
 ; If dataname then process and quit
"RTN","LRVR1",136,0)
 S LRSUB=$P(X,U,6)
"RTN","LRVR1",137,0)
 I LRSUB'="" D  Q
"RTN","LRVR1",138,0)
 . S LRSB=$P(LRSUB,";",2)
"RTN","LRVR1",139,0)
 . Q:'$D(LRVTS(LRSB))
"RTN","LRVR1",140,0)
 . I $D(^TMP("LR",$J,"TMP",LRSB)) S ^(LRSB,"P")=XP
"RTN","LRVR1",141,0)
 . Q:$D(^TMP("LR",$J,"TMP",LRSB))
"RTN","LRVR1",142,0)
 . S ^TMP("LR",$J,"TMP",LRSB)=+X
"RTN","LRVR1",143,0)
 . S XP=XP_$$RNLT^LRVER1(+X)
"RTN","LRVR1",144,0)
 . S ^TMP("LR",$J,"TMP",LRSB,"P")=XP
"RTN","LRVR1",145,0)
 . S:$P(X,U,18) LRM(LRSB)=+X,LRM(LRSB,"P")=XP
"RTN","LRVR1",146,0)
 . S LRBEY(+XP,LRSB)=""     ; CIDC
"RTN","LRVR1",147,0)
 ;
"RTN","LRVR1",148,0)
 I $D(^LAB(60,+X,4)),$P(^(4),"^",2) S LRCFL=LRCFL_$P(^(4),"^",2)_U
"RTN","LRVR1",149,0)
 ;
"RTN","LRVR1",150,0)
 ; If panel then explode components of panel and
"RTN","LRVR1",151,0)
 ;  set parent("P" node) to file #60 test being exploded
"RTN","LRVR1",152,0)
 S J=0
"RTN","LRVR1",153,0)
 F  S J=$O(^LAB(60,+X,2,J)) Q:J<1  I $D(^(J,0))#2 D
"RTN","LRVR1",154,0)
 . S LRNT=LRNT+1,Y=^LAB(60,+X,2,J,0)
"RTN","LRVR1",155,0)
 . S LRTEST(LRNT)=+Y_U_^LAB(60,+Y,0)
"RTN","LRVR1",156,0)
 . S LRTEST(LRNT,"P")=+XP_U_$$NLT^LRVER1(+XP)_"!"
"RTN","LRVR1",157,0)
 Q
"RTN","LRVR1",158,0)
 ;
"RTN","LRVR1",159,0)
 ;
"RTN","LRVR1",160,0)
QUIT Q
"RTN","LRVR1",161,0)
 ;
"RTN","LRVR1",162,0)
WAIT W !,"Type ""^"" to skip "
"RTN","LRVR1",163,0)
WAIT1 R X:10 G LRVR1:X[U,WAIT1:$O(^LAH(LRLL,1,"C",LRAN,0))<1 G LRVR1
"RTN","LRVR3")
0^34^B37947077^B36944972
"RTN","LRVR3",1,0)
LRVR3 ;DALOI/CJS/JAH - LAB ROUTINE DATA VERIFICATION ;8/10/04
"RTN","LRVR3",2,0)
 ;;5.2;LAB SERVICE;**42,121,153,286,291**;Sep 27, 1994
"RTN","LRVR3",3,0)
 D V1
"RTN","LRVR3",4,0)
 I $D(LRLOCKER)#2 L -@(LRLOCKER) K LRLOCKER
"RTN","LRVR3",5,0)
 K LRSA,LRSB,LRNOVER,LRSBCOM,LRLKOK
"RTN","LRVR3",6,0)
 Q  ;Leave LRVR3, back to LRVR2
"RTN","LRVR3",7,0)
 ;
"RTN","LRVR3",8,0)
 ;
"RTN","LRVR3",9,0)
V1 S LRTN=1
"RTN","LRVR3",10,0)
 I $D(LRLOCKER)#2 L -@(LRLOCKER)
"RTN","LRVR3",11,0)
 S LRLOCKER="^LR("_LRDFN_","""_LRSS_""","_LRIDT_")"
"RTN","LRVR3",12,0)
 L +@(LRLOCKER):1
"RTN","LRVR3",13,0)
 I '$T W !," This entry is being edited by someone else." Q
"RTN","LRVR3",14,0)
 ;LRNOVER set in LRVR2
"RTN","LRVR3",15,0)
 K LRLKOK D LINK Q:'$D(LRLKOK)  K LRLKOK D LKCHK Q:'$D(LRLKOK)
"RTN","LRVR3",16,0)
 K LRSA,LRSB,LRSBCOM
"RTN","LRVR3",17,0)
 ;
"RTN","LRVR3",18,0)
 S LRCMTDSP=$$CHKCDSP^LRVERA
"RTN","LRVR3",19,0)
 N LRX
"RTN","LRVR3",20,0)
 S LRX=1
"RTN","LRVR3",21,0)
 F  S LRX=$O(^LAH(LRLL,1,LRSQ,LRX)) Q:LRX<1  D
"RTN","LRVR3",22,0)
 . S LRSB(LRX)=^LAH(LRLL,1,LRSQ,LRX)
"RTN","LRVR3",23,0)
 . I $D(LRNOVER),$D(LRVTS(LRX)),$D(^TMP("LR",$J,"TMP",LRX)) S LRNOVER(LRX)=""
"RTN","LRVR3",24,0)
 ; Copy comments from LAH
"RTN","LRVR3",25,0)
 S LRX=0
"RTN","LRVR3",26,0)
 F  S LRX=$O(^LAH(LRLL,1,LRSQ,1,LRX)) Q:LRX=""  S LRSBCOM(LRX)=^(LRX)
"RTN","LRVR3",27,0)
 ;
"RTN","LRVR3",28,0)
EDIT I $D(^LAH(LRLL,1,LRSQ,0)) D
"RTN","LRVR3",29,0)
 . N X
"RTN","LRVR3",30,0)
 . S LREDIT=1
"RTN","LRVR3",31,0)
 . F LRX=0,.1,.3 M X(LRX)=^LAH(LRLL,1,LRSQ,LRX)
"RTN","LRVR3",32,0)
 . K ^LAH(LRLL,1,LRSQ),LRNUF
"RTN","LRVR3",33,0)
 . F LRX=0,.1,.3 M ^LAH(LRLL,1,LRSQ,LRX)=X(LRX) K X(LRX)
"RTN","LRVR3",34,0)
 . D ^LRVR4
"RTN","LRVR3",35,0)
 . F LRX=1:0 S LRX=$O(LRSB(LRX)) Q:LRX<1  S ^LAH(LRLL,1,LRSQ,LRX)=LRSB(LRX)
"RTN","LRVR3",36,0)
 I $O(^LAH(LRLL,1,LRSQ,1))<1 W !,"NO DATA TO APPROVE" Q
"RTN","LRVR3",37,0)
 Q:$D(LRGVP)
"RTN","LRVR3",38,0)
 F I=0:0 S I=$O(LRNOVER(I)) Q:I=""  W !,$P(^DD(63.04,I,0),U)
"RTN","LRVR3",39,0)
 I $O(LRNOVER(0)) W !,"Have not been reviewed and have data.  Not approved." QUIT
"RTN","LRVR3",40,0)
 I '$P($G(LRLABKY),U) W !,$C(7),"ENTERED BUT NOT APPROVED" QUIT
"RTN","LRVR3",41,0)
 N CNT S CNT=1
"RTN","LRVR3",42,0)
AGAIN ;
"RTN","LRVR3",43,0)
 R !,"Approve for release by entering your initials: ",LRINI:DTIME
"RTN","LRVR3",44,0)
 I $E(LRINI)="^" W !!?5,$C(7),"Nothing verified!" D READ Q
"RTN","LRVR3",45,0)
 I LRINI'=LRUSI,$$UP^XLFSTR(LRINI)=$$UP^XLFSTR(LRUSI) S LRINI=LRUSI
"RTN","LRVR3",46,0)
 I $S($E(LRINI)="?":1,LRINI'=LRUSI&(CNT<2):1,1:0) W !,$C(7),"Please enter your correct initials" S:$E(LRINI)="?" CNT=0 S CNT=CNT+1 G AGAIN
"RTN","LRVR3",47,0)
 I LRINI'=LRUSI W !!?5,$C(7),"Nothing verified!" D READ Q
"RTN","LRVR3",48,0)
 ;
"RTN","LRVR3",49,0)
V11 ;Still locked from V1 L ^LR(LRDFN,LRSS,LRIDT)
"RTN","LRVR3",50,0)
 N LRCORECT S LRCORECT=0
"RTN","LRVR3",51,0)
 N LRX
"RTN","LRVR3",52,0)
 S LRX=0
"RTN","LRVR3",53,0)
 F  S LRX=$O(^TMP("LR",$J,"TMP",LRX)) Q:LRX<1  I $D(LRVTS(LRX)),$D(LRSB(LRX)),$D(^(LRX)) D
"RTN","LRVR3",54,0)
 . K ^LAH(LRLL,1,LRSQ,LRX)
"RTN","LRVR3",55,0)
 . I LRSB(LRX)'="" S ^LR(LRDFN,LRSS,LRIDT,LRX)=LRSB(LRX) S:'$D(^LRO(68,"AC",LRDFN,LRIDT,LRX)) ^(LRX)="" I LRVF S ^(LRX)=""
"RTN","LRVR3",56,0)
 ;
"RTN","LRVR3",57,0)
 I $P($G(LRORU3),U,3),$O(LRSB(0)) D LRORU3^LRVER3
"RTN","LRVR3",58,0)
 ;
"RTN","LRVR3",59,0)
A3 I +LRDPF=2&($G(LRSS)'="BB")&('$$CHKINP^LRBEBA4(LRDFN,LRODT)) D
"RTN","LRVR3",60,0)
 .D BAWRK^LRBEBA(LRODT,LRSN,1,.LRBEY,.LRBETST)
"RTN","LRVR3",61,0)
 D VER^LRVER3A ;unlocked in LRVER
"RTN","LRVR3",62,0)
 K LRSBCOM
"RTN","LRVR3",63,0)
 D:$P(LRPARAM,U,14)&($P($G(^LRO(68,LRAA,0)),U,16)) LOOK^LRCAPV1
"RTN","LRVR3",64,0)
 ; Check for LEDI tests not reviewed
"RTN","LRVR3",65,0)
 I $G(LRDUZ(2)),LRDUZ(2)'=DUZ(2),LRSS="CH",'$D(ZTQUEUED) D TNR
"RTN","LRVR3",66,0)
 ;
"RTN","LRVR3",67,0)
 I +$O(^LAH(LRLL,1,LRSQ,1))<1 D ZAPALL(LRLL,LRSQ)
"RTN","LRVR3",68,0)
 I $D(LRPRGSQ),'$D(ZTQUEUED) D
"RTN","LRVR3",69,0)
 . W !,"Purge data from sequence number(s): "
"RTN","LRVR3",70,0)
 . F I=0:0 S I=$O(LRPRGSQ(I)) Q:I<1  W " ",I
"RTN","LRVR3",71,0)
 . S %=1 D YN^DICN Q:%'=1
"RTN","LRVR3",72,0)
 . N LAIEN
"RTN","LRVR3",73,0)
 . S LAIEN=0
"RTN","LRVR3",74,0)
 . F  S LAIEN=$O(LRPRGSQ(LAIEN)) Q:LAIEN<1  D ZAPALL(LRLL,LAIEN)
"RTN","LRVR3",75,0)
 Q
"RTN","LRVR3",76,0)
 ;
"RTN","LRVR3",77,0)
 ;
"RTN","LRVR3",78,0)
ZAP ; from LRLLS3
"RTN","LRVR3",79,0)
 D ZAPALL(LRLL,I)
"RTN","LRVR3",80,0)
 Q
"RTN","LRVR3",81,0)
 ;
"RTN","LRVR3",82,0)
 ;
"RTN","LRVR3",83,0)
LINK ; Check and save link
"RTN","LRVR3",84,0)
 D LKCHK Q:$D(LRLKOK)  S X=$S($D(^LRO(68,+$P(LRLK,U,3),1,+$P(LRLK,U,4),1,+$P(LRLK,U,5),0)):+^(0),1:"") G LINKOK:+X=LRDFN
"RTN","LRVR3",85,0)
 S S1=PNM,S2=SSN,S3=LRDPF W !,$C(7),"WARNING - NO MATCHING ACCESSION WAS FOUND.",!,"You may need to Clear instrument/worklist data,",!,"or correctly identify the sample to the system."
"RTN","LRVR3",86,0)
 I X S LRDPF=$P(^LR(X,0),U,2),DFN=$P(^(0),U,3) D PT^LRX W !,PNM,?30,SSN,!,$C(7) S PNM=S1,SSN=S2,LRDPF=S3
"RTN","LRVR3",87,0)
 K S1,S2,S3 Q:$D(LRGVP)  W !,"ARE YOU SURE THIS IS THE CORRECT DATA" S %=2 D YN^DICN Q:%'=1
"RTN","LRVR3",88,0)
LINKOK K:$P(LRLK,U,5) ^LAH(LRLL,1,"C",+$P(LRLK,U,5),LRSQ)
"RTN","LRVR3",89,0)
 S ^LAH(LRLL,1,"C",LRAN,LRSQ)="",$P(^LAH(LRLL,1,LRSQ,0),U,3,5)=LRAA_U_LRAD_U_LRAN,LRLKOK=1
"RTN","LRVR3",90,0)
 Q
"RTN","LRVR3",91,0)
 ;
"RTN","LRVR3",92,0)
LKCHK S LRLK=$S($D(^LAH(LRLL,1,LRSQ,0)):^(0),1:"") I $P(LRLK,U,3)=LRAA&($P(LRLK,U,4)=LRAD)&($P(LRLK,U,5)=LRAN) S LRLKOK=1
"RTN","LRVR3",93,0)
 Q
"RTN","LRVR3",94,0)
 ;
"RTN","LRVR3",95,0)
 ;
"RTN","LRVR3",96,0)
ZAP2 ;Clear ^LAH(
"RTN","LRVR3",97,0)
 D ZAPALL(LRLL,I)
"RTN","LRVR3",98,0)
 Q
"RTN","LRVR3",99,0)
 ;
"RTN","LRVR3",100,0)
 ;
"RTN","LRVR3",101,0)
ZAPALL(LRLL,LAIEN) ;Clean up
"RTN","LRVR3",102,0)
 N I,NODE,SEG,SUB
"RTN","LRVR3",103,0)
 Q:'$G(LRLL)!('$G(LAIEN))
"RTN","LRVR3",104,0)
 ;
"RTN","LRVR3",105,0)
 S NODE=$G(^LAH(LRLL,1,LAIEN,0))
"RTN","LRVR3",106,0)
 K ^LAH(LRLL,1,"B",+$P(NODE,U)_";"_+$P(NODE,U,2),LAIEN)
"RTN","LRVR3",107,0)
 K ^LAH(LRLL,1,"C",+$P(NODE,U,5),LAIEN)
"RTN","LRVR3",108,0)
 K ^LAH(LRLL,1,"D",+$P(NODE,U,6),LAIEN)
"RTN","LRVR3",109,0)
 K ^LAH(LRLL,1,"E",+$P(NODE,U,8),LAIEN)
"RTN","LRVR3",110,0)
 ;
"RTN","LRVR3",111,0)
 S NODE("U")=$P($G(^LAH(LRLL,1,LAIEN,.3)),U)
"RTN","LRVR3",112,0)
 I NODE("U")'="" D
"RTN","LRVR3",113,0)
 . K ^LAH(LRLL,1,"U",NODE("U"),LAIEN)
"RTN","LRVR3",114,0)
 . S I=0
"RTN","LRVR3",115,0)
 . F  S I=$O(^LAH("LA7 AMENDED RESULTS",NODE("U"),I)) Q:'I  D
"RTN","LRVR3",116,0)
 . . K ^LAH("LA7 AMENDED RESULTS",NODE("U"),I,LRLL,LAIEN)
"RTN","LRVR3",117,0)
 ;
"RTN","LRVR3",118,0)
 S SEG=""
"RTN","LRVR3",119,0)
 F  S SEG=$O(^LAH(LRLL,1,LAIEN,.1,SEG)) Q:SEG=""  D
"RTN","LRVR3",120,0)
 . S SEGID=""
"RTN","LRVR3",121,0)
 . F  S SEGID=$O(^LAH(LRLL,1,LAIEN,.1,SEG,SEGID)) Q:SEGID=""  D
"RTN","LRVR3",122,0)
 . . S SUB=$P($G(^LAH(LRLL,1,LAIEN,.1,SEG,SEGID)),U)
"RTN","LRVR3",123,0)
 . . I SUB'="" K ^LAH(LRLL,1,"A"_SEGID,SUB,LAIEN)
"RTN","LRVR3",124,0)
 ;
"RTN","LRVR3",125,0)
 K ^LAH(LRLL,1,LAIEN)
"RTN","LRVR3",126,0)
 ;
"RTN","LRVR3",127,0)
 ; Reset counter if loadlist is clear.
"RTN","LRVR3",128,0)
 I '$O(^LAH(LRLL,1,0)) D
"RTN","LRVR3",129,0)
 . L +^LAH(LRLL):1 Q:'$T
"RTN","LRVR3",130,0)
 . S ^LAH(LRLL)=0
"RTN","LRVR3",131,0)
 . L -^LAH(LRLL)
"RTN","LRVR3",132,0)
 ;
"RTN","LRVR3",133,0)
 Q
"RTN","LRVR3",134,0)
 ;
"RTN","LRVR3",135,0)
 ;
"RTN","LRVR3",136,0)
TNR ; List tests not reviewed and ask if user wants to delete.
"RTN","LRVR3",137,0)
 ;
"RTN","LRVR3",138,0)
 N DIR,DIROUT,DIRUT,DUOUT,LR60,I,X,Y
"RTN","LRVR3",139,0)
 ;
"RTN","LRVR3",140,0)
 ; Check if these results have already been verified
"RTN","LRVR3",141,0)
 S I=1
"RTN","LRVR3",142,0)
 F  S I=$O(^LAH(LRLL,1,LRSQ,I)) Q:'I  D
"RTN","LRVR3",143,0)
 . S X=^LAH(LRLL,1,LRSQ,I)
"RTN","LRVR3",144,0)
 . I $P(X,"^")=$P($G(^LR(LRDFN,LRSS,LRIDT,I)),"^") K ^LAH(LRLL,1,LRSQ,I)
"RTN","LRVR3",145,0)
 ;
"RTN","LRVR3",146,0)
 ; Quit if no unreviewed results
"RTN","LRVR3",147,0)
 I +$O(^LAH(LRLL,1,LRSQ,1))'>1 Q
"RTN","LRVR3",148,0)
 ;
"RTN","LRVR3",149,0)
 W !,"Test(s) Not Reviewed:",!
"RTN","LRVR3",150,0)
 S I=1
"RTN","LRVR3",151,0)
 F  S I=$O(^LAH(LRLL,1,LRSQ,I)) Q:'I  D
"RTN","LRVR3",152,0)
 . S X=^LAH(LRLL,1,LRSQ,I)
"RTN","LRVR3",153,0)
 . S LR60=+$O(^LAB(60,"C","CH;"_I_";1",0))
"RTN","LRVR3",154,0)
 . I LR60 W $$GET1^DIQ(60,LR60_",",.01)
"RTN","LRVR3",155,0)
 . E  W $$GET1^DID(63.04,I,"","LABEL")
"RTN","LRVR3",156,0)
 . W " = "_$P(X,"^")_" "_$P(X,"^",2)_"  "_$P($P(X,"^",5),"!",7),!
"RTN","LRVR3",157,0)
 ;
"RTN","LRVR3",158,0)
 S DIR(0)="Y",DIR("A")="Purge these test results",DIR("B")="NO"
"RTN","LRVR3",159,0)
 S DIR("?",1)="Answer 'NO' if you want to keep these results for later verification."
"RTN","LRVR3",160,0)
 S DIR("?",2)="You may need to add these tests to the loadlist profile your using"
"RTN","LRVR3",161,0)
 S DIR("?")="and/or add these tests to the accession your verifying."
"RTN","LRVR3",162,0)
 D ^DIR Q:$D(DIRUT)
"RTN","LRVR3",163,0)
 ;
"RTN","LRVR3",164,0)
 I Y=1 D ZAPALL(LRLL,LRSQ)
"RTN","LRVR3",165,0)
 Q
"RTN","LRVR3",166,0)
 ;
"RTN","LRVR3",167,0)
 ;
"RTN","LRVR3",168,0)
READ ;
"RTN","LRVR3",169,0)
 N X W !!,"Press ENTER or RETURN to continue: " R X:DTIME
"RTN","LRVR3",170,0)
 Q
"RTN","LRWU1")
0^41^B7097286^B6453701
"RTN","LRWU1",1,0)
LRWU1 ;DALOI/RWF/WTY - ORDERING/ACCESSION UTILITIES;12/08/04
"RTN","LRWU1",2,0)
 ;;5.2;LAB SERVICE;**153,272,291**;Sep 27, 1994
"RTN","LRWU1",3,0)
 ; Reference to ^DIC supported by IA #10007
"RTN","LRWU1",4,0)
 ; Reference to ^%DT supported by IA #10003
"RTN","LRWU1",5,0)
 ; Reference to YN^DICN supported by IA #10009
"RTN","LRWU1",6,0)
 ; Reference to INP^VADPT supported by IA #10061
"RTN","LRWU1",7,0)
 ; Reference to ^VA(200 supported by IA #10060
"RTN","LRWU1",8,0)
 ; Reference to $$ORESKEY^ORWDBA1 supported by IA #4569
"RTN","LRWU1",9,0)
 ; Reference to ^XUSEC("PROVIDER" supported by IA #10076
"RTN","LRWU1",10,0)
 ; Reference to $$ACTIVE^XUSER supported by IA #2343
"RTN","LRWU1",11,0)
 ;
"RTN","LRWU1",12,0)
URGG W !,"For ",$P(LRSTIK(LRSSX),U,2) D URG^LRORD2 Q
"RTN","LRWU1",13,0)
MICRO W !,"Is there one sample for this patient's order" S %=1 D YN^DICN I %=2!(%=-1) Q
"RTN","LRWU1",14,0)
 I %=0 W !,"The collection sample and site/specimen will be used for all tests ordered",!,"at this time for this patient." G MICRO
"RTN","LRWU1",15,0)
 D GSNO^LRORD3 Q:LREND
"RTN","LRWU1",16,0)
 I +LRSAMP=-1&(LRSPEC=-1) W !,"Incompletely defined." G MICRO
"RTN","LRWU1",17,0)
 S LRSAME=LRSAMP_U_LRSPEC
"RTN","LRWU1",18,0)
 S LRECOM=0 D GCOM^LRORD2
"RTN","LRWU1",19,0)
 Q
"RTN","LRWU1",20,0)
TIME ;
"RTN","LRWU1",21,0)
 N LRMSG
"RTN","LRWU1",22,0)
 S %DT="ET" R !,"Collection Date@Time: NOW//",X:DTIME
"RTN","LRWU1",23,0)
 I '$T!(X="^") S LRCDT=-1 G TE
"RTN","LRWU1",24,0)
 S:X="" X="N"
"RTN","LRWU1",25,0)
 I X["?" D
"RTN","LRWU1",26,0)
 .S LRMSG="You may enter ""T@U"" or just ""U"", for Today at Unknown "
"RTN","LRWU1",27,0)
 .S LRMSG=LRMSG_"time."
"RTN","LRWU1",28,0)
 .W !!,LRMSG,!!
"RTN","LRWU1",29,0)
 I X["@U",$P(X,"@U",2)="" D  G TIME:Y<1  Q
"RTN","LRWU1",30,0)
 .S X=$P(X,"@U",1) D ^%DT
"RTN","LRWU1",31,0)
 .Q:Y<1
"RTN","LRWU1",32,0)
 .S LRCDT=+Y_"^1"
"RTN","LRWU1",33,0)
 .D TE
"RTN","LRWU1",34,0)
 S:X="U" LRCDT=DT_"^1",Y=DT
"RTN","LRWU1",35,0)
 I X'="U" D ^%DT G TIME:X["?" S LRCDT=+Y_"^" G TIME:Y'["."
"RTN","LRWU1",36,0)
TE K %DT
"RTN","LRWU1",37,0)
 Q
"RTN","LRWU1",38,0)
PRAC ;
"RTN","LRWU1",39,0)
 I $G(LRORDRR)="R" D  Q
"RTN","LRWU1",40,0)
 . S LRPRAC="REF:"_+LRRSITE("RSITE")
"RTN","LRWU1",41,0)
 N %
"RTN","LRWU1",42,0)
 D:'$D(LRPARAM) ^LRPARAM K DIC S LREND=0,(VA200,DIC("B"))=""
"RTN","LRWU1",43,0)
 S DFN=$P(^LR(LRDFN,0),U,3) S LRDPF=$P(^LR(LRDFN,0),U,2)
"RTN","LRWU1",44,0)
 I LRDPF=2,$L($G(VAIN(2))) S DIC("B")=$P(VAIN(2),U)
"RTN","LRWU1",45,0)
 I LRDPF=2,'$D(VAIN(2)) D
"RTN","LRWU1",46,0)
 . N I,Y,X,N D INP^VADPT S (DIC("B"),LRPRAC)=$P(VAIN(2),U)
"RTN","LRWU1",47,0)
 I $D(LRLABKY),'DIC("B"),$P(LRPARAM,U,16) S DIC("B")=$S($D(^LR(LRDFN,.2)):+^(.2),1:"")
"RTN","LRWU1",48,0)
P1 I $D(^VA(200,+DIC("B"),0))#2 S:'$D(^VA(200,"AK.PROVIDER",$P($G(^VA(200,+DIC("B"),0)),U))) DIC("B")=""
"RTN","LRWU1",49,0)
 S DIC("B")=$P($G(^VA(200,+DIC("B"),0)),U) D P S:Y>0 (^LR(LRDFN,.2),LRPRAC)=+Y
"RTN","LRWU1",50,0)
 Q
"RTN","LRWU1",51,0)
P ;Prompt for PROVIDER
"RTN","LRWU1",52,0)
 S DIC="^VA(200,",DIC(0)="AMNEQ",LRPRAC=""
"RTN","LRWU1",53,0)
 S DIC("S")="I $D(^VA(200,""AK.PROVIDER"",$P(^(0),U))),"
"RTN","LRWU1",54,0)
 S DIC("S")=DIC("S")_"$$ACTIVE^XUSER(Y),"
"RTN","LRWU1",55,0)
 S DIC("S")=DIC("S")_"$D(^XUSEC(""PROVIDER"",Y))"
"RTN","LRWU1",56,0)
 S DIC("A")="PROVIDER: ",D="AK.PROVIDER"
"RTN","LRWU1",57,0)
 S DIC("W")="Q" D ^DIC K DIC
"RTN","LRWU1",58,0)
 I Y<0 D QUIT Q
"RTN","LRWU1",59,0)
 S LRPRAC=+Y
"RTN","LRWU1",60,0)
 Q
"RTN","LRWU1",61,0)
QUIT S LREND=1 Q
"UP",60,60.196,-2)
60^1
"UP",60,60.196,-1)
60.01^3
"UP",60,60.196,0)
60.196
"UP",69,69.03,-2)
69^1
"UP",69,69.03,-1)
69.01^2
"UP",69,69.03,0)
69.03
"UP",69,69.05,-3)
69^1
"UP",69,69.05,-2)
69.01^2
"UP",69,69.05,-1)
69.03^2
"UP",69,69.05,0)
69.05
"VER")
8.0^22.0
"^DD",60,60,506,0)
DEFAULT SITE/SPECIMEN CPT^P81'^ICPT(^1.1;1^Q
"^DD",60,60,506,3)

"^DD",60,60,506,21,0)
^.001^5^5^3060318^^^
"^DD",60,60,506,21,1,0)
If a CPT cannot be determined by the SPECIMEN CPT (#96) field within the 
"^DD",60,60,506,21,2,0)
SITE/SPECIMEN (#100) multiple, or by the HCPCS CODE (#507) field, or by
"^DD",60,60,506,21,3,0)
locating an active CPT Code in the WKLD CODE file (#64) entry pointed to
"^DD",60,60,506,21,4,0)
by the NATIONAL VA LAB CODE (#64) field, then the CPT in this field is
"^DD",60,60,506,21,5,0)
the default.
"^DD",60,60,506,"DT")
3041105
"^DD",60,60,507,0)
HCPCS CODE^P81'^ICPT(^1.1;2^Q
"^DD",60,60,507,3)

"^DD",60,60,507,21,0)
^^10^10^3041105^
"^DD",60,60,507,21,1,0)
HCFA Common Procedure Coding System (HCPCS) is a coding system that is 
"^DD",60,60,507,21,2,0)
composed of Level I codes (CPT codes), Level II codes (national codes),
"^DD",60,60,507,21,3,0)
and Level III codes (local codes). Level I (CPT) codes are five digit
"^DD",60,60,507,21,4,0)
numeric codes that describe procedures and tests. CPT codes are developed 
"^DD",60,60,507,21,5,0)
and maintained by the AMA with annual updates. Level II (national) codes 
"^DD",60,60,507,21,6,0)
are five digit alpha numeric codes that describe pharmaceuticals,
"^DD",60,60,507,21,7,0)
supplies, procedures, tests and services. Level II codes are developed and
"^DD",60,60,507,21,8,0)
maintained by CMS with quarterly updates. Level III (local) codes are five
"^DD",60,60,507,21,9,0)
digit alpha numeric codes that are being phased out by the fiscal 
"^DD",60,60,507,21,10,0)
intermediaries.
"^DD",60,60,507,"DT")
3041105
"^DD",60,60,508,0)
AMA COMPLIANT/BILLABLE PANEL^S^0:No;1:Yes;^12;1^Q
"^DD",60,60,508,21,0)
^.001^15^15^3050824^^
"^DD",60,60,508,21,1,0)
If this panel test is an AMA compliant or otherwise billable panel,
"^DD",60,60,508,21,2,0)
enter a 'Yes' in this field.  If this field is set to 'Yes' and a valid 
"^DD",60,60,508,21,3,0)
CPT code is on file, the CPT code for the panel will be sent to PCE for 
"^DD",60,60,508,21,4,0)
billing purposes as a bundled panel.
"^DD",60,60,508,21,5,0)
 
"^DD",60,60,508,21,6,0)
If this field is set to 'No', the panel will be unbundled into it's 
"^DD",60,60,508,21,7,0)
individual atomic tests and the CPT codes for those atomic tests will be 
"^DD",60,60,508,21,8,0)
sent to PCE for billing purposes.
"^DD",60,60,508,21,9,0)
 
"^DD",60,60,508,21,10,0)
Note: This field is only functional for a panel test. This field is 
"^DD",60,60,508,21,11,0)
ignored for an atomic test.
"^DD",60,60,508,21,12,0)
 
"^DD",60,60,508,21,13,0)
Refer to the Clinical Indicator Data Capture (CIDC) implementation
"^DD",60,60,508,21,14,0)
guide for further instruction for managing this field.
"^DD",60,60,508,21,15,0)

"^DD",60,60,508,"DT")
3060303
"^DD",60,60.01,96,0)
SPECIMEN CPT^60.196P^^3;0
"^DD",60,60.196,0)
SPECIMEN CPT SUB-FIELD^^1^2
"^DD",60,60.196,0,"DT")
3031003
"^DD",60,60.196,0,"IX","B",60.196,.01)

"^DD",60,60.196,0,"NM","SPECIMEN CPT")

"^DD",60,60.196,0,"UP")
60.01
"^DD",60,60.196,.01,0)
SPECIMEN CPT^P81'^ICPT(^0;1^Q
"^DD",60,60.196,.01,1,0)
^.1
"^DD",60,60.196,.01,1,1,0)
60.196^B
"^DD",60,60.196,.01,1,1,1)
S ^LAB(60,DA(2),1,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",60,60.196,.01,1,1,2)
K ^LAB(60,DA(2),1,DA(1),3,"B",$E(X,1,30),DA)
"^DD",60,60.196,.01,21,0)
^.001^1^1^3031003^^^
"^DD",60,60.196,.01,21,1,0)
A CPT associated with the specimen
"^DD",60,60.196,.01,"DT")
3030807
"^DD",60,60.196,1,0)
ACTIVE DATE (CSV)^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",60,60.196,1,21,0)
^.001^1^1^3031003^^
"^DD",60,60.196,1,21,1,0)
This the active date of the SPECIMEN CPT for CSV purposes.
"^DD",60,60.196,1,"DT")
3030807
"^DD",68,68,.1,0)
RESPONSIBLE OFFICIAL^P200'^VA(200,^0;9^Q
"^DD",68,68,.1,3)

"^DD",68,68,.1,21,0)
^.001^1^1^3040427^^^
"^DD",68,68,.1,21,1,0)
The responsible official in the laboratory.  Usually the Chief of Laboratory Service, or his designee.
"^DD",68,68,.1,"DT")
3040427
"^DD",68,68,12,0)
EXTERNAL SERVICE AREA^S^0:NO;1:YES;^0;22^Q
"^DD",68,68,12,21,0)
^.001^1^1^3060125^^^^
"^DD",68,68,12,21,1,0)
This field determines if the Accession Area is defined for send out tests.
"^DD",68,68,12,"DT")
3030423
"^DD",69,69.03,21,0)
ICD-9 CODES^69.05P^^2;0
"^DD",69,69.03,21,21,0)
^^1^1^3030924^
"^DD",69,69.03,21,21,1,0)
ICD-9 ordering diagnosis code.
"^DD",69,69.03,21,"DT")
3030917
"^DD",69,69.03,22,0)
DATE OF SERVICE^D^^3;1^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",69,69.03,22,21,0)
^.001^2^2^3051114^^
"^DD",69,69.03,22,21,1,0)
This is the Date of Service to be sent to the billing application for
"^DD",69,69.03,22,21,2,0)
billing.
"^DD",69,69.03,22,"DT")
3051210
"^DD",69,69.03,22.1,0)
PANEL PENDING^S^0:NO;1:YES;^3;2^Q
"^DD",69,69.03,22.1,1,0)
^.1^^0
"^DD",69,69.03,22.1,21,0)
^^4^4^3051114^
"^DD",69,69.03,22.1,21,1,0)
This field will be set to "YES" in the case where an AMA/Billable
"^DD",69,69.03,22.1,21,2,0)
Panel still has one or more atomic tests "pending" verified
"^DD",69,69.03,22.1,21,3,0)
results.
"^DD",69,69.03,22.1,21,4,0)
  
"^DD",69,69.03,22.1,"DT")
3051210
"^DD",69,69.05,0)
ICD-9 CODES SUB-FIELD^^8^9
"^DD",69,69.05,0,"DT")
3040322
"^DD",69,69.05,0,"IX","B",69.05,.01)

"^DD",69,69.05,0,"NM","ICD-9 CODES")

"^DD",69,69.05,0,"UP")
69.03
"^DD",69,69.05,.01,0)
ICD-9 CODES^P80'^ICD9(^0;1^Q
"^DD",69,69.05,.01,1,0)
^.1
"^DD",69,69.05,.01,1,1,0)
69.05^B
"^DD",69,69.05,.01,1,1,1)
S ^LRO(69,DA(3),1,DA(2),2,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",69,69.05,.01,1,1,2)
K ^LRO(69,DA(3),1,DA(2),2,DA(1),2,"B",$E(X,1,30),DA)
"^DD",69,69.05,.01,21,0)
^^5^5^3040210^
"^DD",69,69.05,.01,21,1,0)
ICD-9 ordering diagnosis code.  For CPRS laboratory orders, the ordering
"^DD",69,69.05,.01,21,2,0)
provider enters this diagnosis via CPRS.  For internal laboratory orders,
"^DD",69,69.05,.01,21,3,0)
the provider must indicate the diagnosis code on paper for entry by the
"^DD",69,69.05,.01,21,4,0)
laboratory staff.  When the lab test is resulted, the ordering diagnosis
"^DD",69,69.05,.01,21,5,0)
code will be sent to PCE/PTF for billing purposes.
"^DD",69,69.05,.01,"DT")
3040210
"^DD",69,69.05,1,0)
SERVICE CONNECTION INDICATOR^S^0:NO;1:YES;^0;2^Q
"^DD",69,69.05,1,21,0)
^.001^5^5^3030924^^^
"^DD",69,69.05,1,21,1,0)
Indicates if the care provided is for a service connected or non-service
"^DD",69,69.05,1,21,2,0)
connected condition.  The ordering provider is responsible for providing
"^DD",69,69.05,1,21,3,0)
Service Connection indicator to the laboratory via CPRS entry or, for internal
"^DD",69,69.05,1,21,4,0)
laboratory orders, on paper.  The Service Connection indicator
"^DD",69,69.05,1,21,5,0)
is sent to PCE/PTF at verification.
"^DD",69,69.05,1,"DT")
3030917
"^DD",69,69.05,2,0)
COMBAT VETERAN^S^0:NO;1:YES;^0;3^Q
"^DD",69,69.05,2,21,0)
^^5^5^3040123^
"^DD",69,69.05,2,21,1,0)
Indicates if the care provided is to treat a condition related to Combat 
"^DD",69,69.05,2,21,2,0)
Veteran exposure.  The ordering provider is responsible for providing the 
"^DD",69,69.05,2,21,3,0)
Combat Veteran indicator to the laboratory via CPRS entry or, for internal
"^DD",69,69.05,2,21,4,0)
laboratory orders, on paper.  The Combat Veteran indicator is sent to PCE
"^DD",69,69.05,2,21,5,0)
at verification.
"^DD",69,69.05,2,"DT")
3040123
"^DD",69,69.05,3,0)
AGENT ORANGE^S^0:NO;1:YES;^0;4^Q
"^DD",69,69.05,3,21,0)
^.001^5^5^3060131^^
"^DD",69,69.05,3,21,1,0)
Indicates if the care provided is to treat a condition related to Agent 
"^DD",69,69.05,3,21,2,0)
Orange exposure.  The ordering provider is responsible for providing the 
"^DD",69,69.05,3,21,3,0)
Agent Orange indicator to the laboratory via CPRS entry or, for internal 
"^DD",69,69.05,3,21,4,0)
laboratory orders, on paper.  The Agent Orange indicator is sent to PCE 
"^DD",69,69.05,3,21,5,0)
at verification.
"^DD",69,69.05,3,"DT")
3040123
"^DD",69,69.05,4,0)
IONIZING RADIATION^S^0:NO;1:YES;^0;5^Q
"^DD",69,69.05,4,21,0)
^^5^5^3040123^
"^DD",69,69.05,4,21,1,0)
Indicates if the care provided is to treat a condition related to Ionizing
"^DD",69,69.05,4,21,2,0)
Radiation exposure.  The ordering provider is responsible for ible for 
"^DD",69,69.05,4,21,3,0)
providing the Ionizing Radiation indicator to the laboratory via CPRS
"^DD",69,69.05,4,21,4,0)
entry or, for internal laboratory orders, on paper.  The Ionizing 
"^DD",69,69.05,4,21,5,0)
Radiation indicator is sent to PCE at verification.
"^DD",69,69.05,4,"DT")
3040123
"^DD",69,69.05,5,0)
ENVIRONMENTAL CONTAMINANTS^S^0:NO;1:YES;^0;6^Q
"^DD",69,69.05,5,21,0)
^^5^5^3040123^
"^DD",69,69.05,5,21,1,0)
Indicates if the care provided is to treat a condition related to 
"^DD",69,69.05,5,21,2,0)
Environmental Contaminants.  The ordering provider is responsible for 
"^DD",69,69.05,5,21,3,0)
providing the Environmental Contaminants indicator to the laboratory via 
"^DD",69,69.05,5,21,4,0)
CPRS entry or, for internal laboratory orders, on paper.  The 
"^DD",69,69.05,5,21,5,0)
Environmental Contaminants indicator is sent to PCE at verification.
"^DD",69,69.05,5,"DT")
3040123
"^DD",69,69.05,6,0)
MILITARY SEXUAL TRAUMA^S^0:NO;1:YES;^0;7^Q
"^DD",69,69.05,6,21,0)
^.001^4^4^3060104^^^
"^DD",69,69.05,6,21,1,0)
Indicates if the care provided is to treat a condition related to MST.  
"^DD",69,69.05,6,21,2,0)
The ordering provider is responsible for providing the Environmental MST
"^DD",69,69.05,6,21,3,0)
indicator to the laboratory via CPRS entry or, for internal laboratory 
"^DD",69,69.05,6,21,4,0)
orders, on paper.  The MST indicator is sent to PCE at verification.
"^DD",69,69.05,6,"DT")
3051223
"^DD",69,69.05,7,0)
HEAD AND NECK CANCER^S^0:NO;1:YES;^0;8^Q
"^DD",69,69.05,7,21,0)
^.001^5^5^3060104^^^^
"^DD",69,69.05,7,21,1,0)
Indicates if the care provided is to treat a condition related to Head 
"^DD",69,69.05,7,21,2,0)
and Neck Cancer. The ordering provider is responsible for providing the 
"^DD",69,69.05,7,21,3,0)
Head and Neck Cancer indicator to the laboratory via CPRS entry or, for 
"^DD",69,69.05,7,21,4,0)
internal laboratory orders, on paper.  The Head and Neck Cancer indicator
"^DD",69,69.05,7,21,5,0)
is sent to PCE at verification.
"^DD",69,69.05,7,"DT")
3051223
"^DD",69,69.05,8,0)
PRIMARY DIAGNOSIS^S^1:YES;0:NO;^0;9^Q
"^DD",69,69.05,8,21,0)
^^1^1^3040322^
"^DD",69,69.05,8,21,1,0)
This diagnosis is the primary diagnosis.
"^DD",69,69.05,8,"DT")
3040322
"^DD",69.9,69.9,620,0)
PANEL PROCESS DATE^D^^VSIT;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",69.9,69.9,620,21,0)
^.001^3^3^3060207^^^^
"^DD",69.9,69.9,620,21,1,0)
The day of the month used for processing panel tests that contain 
"^DD",69.9,69.9,620,21,2,0)
pending atomic tests for the prior calendar month.  This should be
"^DD",69.9,69.9,620,21,3,0)
one day prior to the monthly PCE roll-up date.
"^DD",69.9,69.9,620,"DT")
3051215
"BLD",4959,6)
^268
**END**
**END**
