Released DG*5.3*700 SEQ #621
Extracted from mail message
**KIDS**:DG*5.3*700^

**INSTALL NAME**
DG*5.3*700
"BLD",6597,0)
DG*5.3*700^REGISTRATION^0^3060313^y
"BLD",6597,1,0)
^^3^3^3060312^
"BLD",6597,1,1,0)
This patch updates the Multiple Birth Indicator and temporary address,
"BLD",6597,1,2,0)
corrects a date validation API, updates the patient name components and
"BLD",6597,1,3,0)
corrects the alias SSN.
"BLD",6597,4,0)
^9.64PA^^
"BLD",6597,"KRN",0)
^9.67PA^8989.52^19
"BLD",6597,"KRN",.4,0)
.4
"BLD",6597,"KRN",.401,0)
.401
"BLD",6597,"KRN",.402,0)
.402
"BLD",6597,"KRN",.403,0)
.403
"BLD",6597,"KRN",.5,0)
.5
"BLD",6597,"KRN",.84,0)
.84
"BLD",6597,"KRN",3.6,0)
3.6
"BLD",6597,"KRN",3.8,0)
3.8
"BLD",6597,"KRN",9.2,0)
9.2
"BLD",6597,"KRN",9.8,0)
9.8
"BLD",6597,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",6597,"KRN",9.8,"NM",1,0)
DGRP1^^0^B23750245
"BLD",6597,"KRN",9.8,"NM",2,0)
DGRPECE^^0^B48381081
"BLD",6597,"KRN",9.8,"NM",3,0)
DGDDC^^0^B8687243
"BLD",6597,"KRN",9.8,"NM",4,0)
DGMSTAPI^^0^B48586878
"BLD",6597,"KRN",9.8,"NM","B","DGDDC",3)

"BLD",6597,"KRN",9.8,"NM","B","DGMSTAPI",4)

"BLD",6597,"KRN",9.8,"NM","B","DGRP1",1)

"BLD",6597,"KRN",9.8,"NM","B","DGRPECE",2)

"BLD",6597,"KRN",19,0)
19
"BLD",6597,"KRN",19.1,0)
19.1
"BLD",6597,"KRN",101,0)
101
"BLD",6597,"KRN",409.61,0)
409.61
"BLD",6597,"KRN",771,0)
771
"BLD",6597,"KRN",870,0)
870
"BLD",6597,"KRN",8989.51,0)
8989.51
"BLD",6597,"KRN",8989.52,0)
8989.52
"BLD",6597,"KRN",8994,0)
8994
"BLD",6597,"KRN","B",.4,.4)

"BLD",6597,"KRN","B",.401,.401)

"BLD",6597,"KRN","B",.402,.402)

"BLD",6597,"KRN","B",.403,.403)

"BLD",6597,"KRN","B",.5,.5)

"BLD",6597,"KRN","B",.84,.84)

"BLD",6597,"KRN","B",3.6,3.6)

"BLD",6597,"KRN","B",3.8,3.8)

"BLD",6597,"KRN","B",9.2,9.2)

"BLD",6597,"KRN","B",9.8,9.8)

"BLD",6597,"KRN","B",19,19)

"BLD",6597,"KRN","B",19.1,19.1)

"BLD",6597,"KRN","B",101,101)

"BLD",6597,"KRN","B",409.61,409.61)

"BLD",6597,"KRN","B",771,771)

"BLD",6597,"KRN","B",870,870)

"BLD",6597,"KRN","B",8989.51,8989.51)

"BLD",6597,"KRN","B",8989.52,8989.52)

"BLD",6597,"KRN","B",8994,8994)

"BLD",6597,"QUES",0)
^9.62^^
"BLD",6597,"REQB",0)
^9.611^4^4
"BLD",6597,"REQB",1,0)
DG*5.3*527^1
"BLD",6597,"REQB",2,0)
DG*5.3*649^1
"BLD",6597,"REQB",3,0)
DG*5.3*682^1
"BLD",6597,"REQB",4,0)
DG*5.3*443^1
"BLD",6597,"REQB","B","DG*5.3*443",4)

"BLD",6597,"REQB","B","DG*5.3*527",1)

"BLD",6597,"REQB","B","DG*5.3*649",2)

"BLD",6597,"REQB","B","DG*5.3*682",3)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
700^3060313^100850
"PKG",5,22,1,"PAH",1,1,0)
^^3^3^3060313
"PKG",5,22,1,"PAH",1,1,1,0)
This patch updates the Multiple Birth Indicator and temporary address,
"PKG",5,22,1,"PAH",1,1,2,0)
corrects a date validation API, updates the patient name components and
"PKG",5,22,1,"PAH",1,1,3,0)
corrects the alias SSN.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DGDDC")
0^3^B8687243^B7666533
"RTN","DGDDC",1,0)
DGDDC ;ALB/MRL - X-ECUTE KILL X-REFERENCES [PATIENT] ;25 JUL 88@1337
"RTN","DGDDC",2,0)
 ;;5.3;Registration;**489,244,527,700**;Aug 13, 1993
"RTN","DGDDC",3,0)
 ;
"RTN","DGDDC",4,0)
 Q:$D(DGNOFDEL)  ;Flag variable to prevent deletion cascade
"RTN","DGDDC",5,0)
 ;
"RTN","DGDDC",6,0)
 Q:'$D(DGXRF)  N DGXRFX,DGXRF1,DGXRF2,DGXRF3,DGXRF3,DGXRF4,DGXRF5,DGXRF6,DGXRF7,DGXRF8,DGXRFP,DGXRFX
"RTN","DGDDC",7,0)
 S DGXRFX=X,DGXRF1=+$P(DGXRF,".",2),DGXRF2=$P($T(@DGXRF1),";;",2) G Q:DGXRF2=""
"RTN","DGDDC",8,0)
 I $D(^DD(2,DGXRF,0)) S DGXRFP=$P(^(0),"^",4),DGXRF6=$P(DGXRFP,";",2),DGXRF5=$P(DGXRFP,";",1) I $D(^DPT(DA,DGXRF5)),($P(^(DGXRF5),"^",DGXRF6)=DGXRFX) G Q
"RTN","DGDDC",9,0)
 I DGXRF=".1212",($D(^DPT(DA,DGXRF5))),($P(^(DGXRF5),"^",DGXRF6)="") S DGFDA(2,DA_",",.1213)="" D FILE^DIE("","DGFDA","DGERR") K DGFDA,DGERR G Q
"RTN","DGDDC",10,0)
 N DGFDA,DGERR
"RTN","DGDDC",11,0)
 ;F DGXRF3=1:1 S DGXRF4=$P(DGXRF2,"^",DGXRF3) Q:DGXRF4=""  I $D(^DD(2,DGXRF4,0)) S DGXRF5=$P(^(0),"^",4),DGXRF6=$P(DGXRF5,";",2),DGXRF5=$P(DGXRF5,";",1) I $D(^DPT(DA,DGXRF5)),$P(^(DGXRF5),"^",DGXRF6)'="" D KILL
"RTN","DGDDC",12,0)
 F DGXRF3=1:1 S DGXRF4=$P(DGXRF2,"^",DGXRF3) Q:DGXRF4=""  I $D(^DD(2,DGXRF4,0)) S DGXRF5=$P(^(0),"^",4),DGXRF6=$P(DGXRF5,";",2),DGXRF5=$P(DGXRF5,";",1) I $D(^DPT(DA,DGXRF5)),$P(^(DGXRF5),"^",DGXRF6)'="",DGXRF4'=".1212" D
"RTN","DGDDC",13,0)
 .I DGXRF4'=".1213" S DGFDA(2,DA_",",DGXRF4)=""
"RTN","DGDDC",14,0)
 I $D(DGFDA) D FILE^DIE("","DGFDA","DGERR")
"RTN","DGDDC",15,0)
Q S X=DGXRFX K DGXRF Q  ;,DGXRFX,DGXRF1,DGXRF2,DGXRF3,DGXRF3,DGXRF4,DGXRF5,DGXRF6,DGXRF7,DGXRF8,DGXRFP,DGXRFX Q
"RTN","DGDDC",16,0)
KILL S DGXRF7=$P(^DPT(DA,DGXRF5),"^",DGXRF6),$P(^DPT(DA,DGXRF5),"^",DGXRF6)=""
"RTN","DGDDC",17,0)
 F DGXRF8=0:0 S DGXRF8=$O(^DD(2,DGXRF4,1,DGXRF8)) Q:'DGXRF8  I $D(^DD(2,DGXRF4,1,DGXRF8,2)) S X=DGXRF7 X:^(2)'["DGXRF" ^(2) D SET I $D(^DD(2,DGXRF4,1,DGXRF8,1)) D SET
"RTN","DGDDC",18,0)
 Q
"RTN","DGDDC",19,0)
SET Q:^DD(2,DGXRF4,1,DGXRF8,1)'["DGXRF"  S X="" X ^(1) Q
"RTN","DGDDC",20,0)
 ;
"RTN","DGDDC",21,0)
152 ;;.1651^.1653^.1654^.1656^.307^
"RTN","DGDDC",22,0)
153 ;;.1657^.1658^.1659^
"RTN","DGDDC",23,0)
211 ;;.212^.2125^.213^.214^.215^.216^.217^.218^.219^.21011^.2207^
"RTN","DGDDC",24,0)
2191 ;;.2192^.21925^.2193^.2194^.2195^.2196^.2197^.2198^.2199^.211011^.2203^
"RTN","DGDDC",25,0)
251 ;;.252^.253^.254^.255^.256^.257^.258^.2206^
"RTN","DGDDC",26,0)
3111 ;;.3113^.3114^.3115^.3116^.3117^.3118^.3119^.2205^
"RTN","DGDDC",27,0)
331 ;;.332^.3305^.333^.334^.335^.336^.337^.338^.339^.33011^.2201^
"RTN","DGDDC",28,0)
3311 ;;.3312^.3313^.3314^.3315^.3316^.3317^.3318^.3319^.331011^.2204^
"RTN","DGDDC",29,0)
341 ;;.342^.3405^.343^.344^.345^.346^.347^.348^.349^.34011^.2202^
"RTN","DGDDC",30,0)
3285 ;;.329^.3291^.3292^.3293^.3294^
"RTN","DGDDC",31,0)
32945 ;;.3295^.3296^.3297^.3298^.3299^
"RTN","DGDDC",32,0)
111 ;;.112^.113
"RTN","DGDDC",33,0)
112 ;;.113
"RTN","DGDDC",34,0)
12105 ;;.1217^.1218
"RTN","DGDDC",35,0)
1211 ;;.1212^.1213
"RTN","DGDDC",36,0)
1212 ;;.1213
"RTN","DGDDC",37,0)
14105 ;;.1417^.1418
"RTN","DGDDC",38,0)
1411 ;;.1412^.1413
"RTN","DGDDC",39,0)
1412 ;;.1413
"RTN","DGDDC",40,0)
213 ;;.214^.215
"RTN","DGDDC",41,0)
214 ;;.215
"RTN","DGDDC",42,0)
2193 ;;.2194^.2195
"RTN","DGDDC",43,0)
2194 ;;.2195
"RTN","DGDDC",44,0)
252 ;;.253^.254
"RTN","DGDDC",45,0)
253 ;;.254
"RTN","DGDDC",46,0)
3113 ;;.3114^.3115
"RTN","DGDDC",47,0)
3114 ;;.3115
"RTN","DGDDC",48,0)
3313 ;;.3314^.3315
"RTN","DGDDC",49,0)
3314 ;;.3315
"RTN","DGDDC",50,0)
333 ;;.334^.335
"RTN","DGDDC",51,0)
334 ;;.335
"RTN","DGDDC",52,0)
343 ;;.344^.345
"RTN","DGDDC",53,0)
344 ;;.345
"RTN","DGDDC",54,0)
361 ;;.3611
"RTN","DGMSTAPI")
0^4^B48586878^B44462508
"RTN","DGMSTAPI",1,0)
DGMSTAPI ;ALB/SCK - API's for Military Sexual Trauma ; 2/28/02 4:56pm
"RTN","DGMSTAPI",2,0)
 ;;5.3;Registration;**195,243,308,353,379,443,700**;Aug 13, 1993
"RTN","DGMSTAPI",3,0)
 Q
"RTN","DGMSTAPI",4,0)
 ;
"RTN","DGMSTAPI",5,0)
GETSTAT(DFN,DGDATE) ;  Retrieves the current MST status for a patient
"RTN","DGMSTAPI",6,0)
 ;
"RTN","DGMSTAPI",7,0)
 ;  Input
"RTN","DGMSTAPI",8,0)
 ;    DFN  - IEN of patient in the PATIENT File (#2)
"RTN","DGMSTAPI",9,0)
 ;    DGDATE - Date for status lookup [OPTIONAL]
"RTN","DGMSTAPI",10,0)
 ;
"RTN","DGMSTAPI",11,0)
 ;  Output
"RTN","DGMSTAPI",12,0)
 ;    DGMST - Format will depend on result of lookup
"RTN","DGMSTAPI",13,0)
 ;
"RTN","DGMSTAPI",14,0)
 ;    If an entry is found then:
"RTN","DGMSTAPI",15,0)
 ;       DGMST returns a 7 piece data string, caret(^)-delimited:
"RTN","DGMSTAPI",16,0)
 ;        $P(1) = IEN of entry in MST HISTORY File (#29.11)
"RTN","DGMSTAPI",17,0)
 ;        $P(2) = Internal value of MST Status ("Y,N,D,U")
"RTN","DGMSTAPI",18,0)
 ;        $P(3) = Date of status change
"RTN","DGMSTAPI",19,0)
 ;        $P(4) = IEN of provider making determination, file (#200)
"RTN","DGMSTAPI",20,0)
 ;        $P(5) = IEN of user who entered status, file (#200)
"RTN","DGMSTAPI",21,0)
 ;        $P(6) = External format of MST Status
"RTN","DGMSTAPI",22,0)
 ;        $P(7) = IEN pointer of the INSTITUTION file (#4)
"RTN","DGMSTAPI",23,0)
 ;
"RTN","DGMSTAPI",24,0)
 ;    If no MST History is found, then:
"RTN","DGMSTAPI",25,0)
 ;       DGMST = 0^U
"RTN","DGMSTAPI",26,0)
 ;                "U" = (Unknown)
"RTN","DGMSTAPI",27,0)
 ;    If an error occured in the GETS^DIQ lookup, then:
"RTN","DGMSTAPI",28,0)
 ;       DGMST = -1^^Error Code IEN
"RTN","DGMSTAPI",29,0)
 ;                   (returned by GETS^DIQ call)
"RTN","DGMSTAPI",30,0)
 ;
"RTN","DGMSTAPI",31,0)
 ; Get most recent MST status entry for the patient from file using
"RTN","DGMSTAPI",32,0)
 ;  reverse $Order on the "APDT" x-ref.
"RTN","DGMSTAPI",33,0)
 ;
"RTN","DGMSTAPI",34,0)
 N DGMST,DGIEN,DGFDA,DGMSG
"RTN","DGMSTAPI",35,0)
 S DFN=$G(DFN)
"RTN","DGMSTAPI",36,0)
 I '+DFN!('$D(^DPT(DFN,0))) D  G STATQ
"RTN","DGMSTAPI",37,0)
 . S DGMST="-1"
"RTN","DGMSTAPI",38,0)
 I '$D(^DGMS(29.11,"APDT",DFN))  D  G STATQ
"RTN","DGMSTAPI",39,0)
 .S DGMST="0^U"
"RTN","DGMSTAPI",40,0)
 S DGDATE=$S(+$G(DGDATE)>0:DGDATE,1:$$NOW^XLFDT)
"RTN","DGMSTAPI",41,0)
 I '$D(^DGMS(29.11,"APDT",DFN,DGDATE)) S DGDATE=$$DATE(DFN,DGDATE)
"RTN","DGMSTAPI",42,0)
 I '+DGDATE D  G STATQ
"RTN","DGMSTAPI",43,0)
 . S DGMST="0^U"
"RTN","DGMSTAPI",44,0)
 S DGIEN=""
"RTN","DGMSTAPI",45,0)
 S DGIEN=+$P($Q(^DGMS(29.11,"APDT",DFN,DGDATE,DGIEN),-1),",",5)
"RTN","DGMSTAPI",46,0)
 ;
"RTN","DGMSTAPI",47,0)
 ; Check for valid ien, if entry missing, return Unknown
"RTN","DGMSTAPI",48,0)
 I +DGIEN'>0 D  G STATQ
"RTN","DGMSTAPI",49,0)
 . S DGMST="0^U"
"RTN","DGMSTAPI",50,0)
 ;
"RTN","DGMSTAPI",51,0)
 ; Retrieve data
"RTN","DGMSTAPI",52,0)
 D GETS^DIQ(29.11,+DGIEN_",","*","IE","DGFDA","DGMSG")
"RTN","DGMSTAPI",53,0)
 ; check for errors
"RTN","DGMSTAPI",54,0)
 I $D(DGMSG) D  G STATQ
"RTN","DGMSTAPI",55,0)
 .S DGMST="-1^^"_$G(DGMSG("DIERR",1))
"RTN","DGMSTAPI",56,0)
 ;
"RTN","DGMSTAPI",57,0)
 S DGMST=DGIEN_U_$G(DGFDA(29.11,+DGIEN_",",3,"I"))_U_$G(DGFDA(29.11,+DGIEN_",",.01,"I"))_U_$G(DGFDA(29.11,+DGIEN_",",4,"I"))_U_$G(DGFDA(29.11,+DGIEN_",",5,"I"))
"RTN","DGMSTAPI",58,0)
 S DGMST=DGMST_U_$G(DGFDA(29.11,+DGIEN_",",3,"E"))
"RTN","DGMSTAPI",59,0)
 S DGMST=DGMST_U_$S($G(DGFDA(29.11,+DGIEN_",",6,"I"))]"":$G(DGFDA(29.11,+DGIEN_",",6,"I")),1:$$SITE)
"RTN","DGMSTAPI",60,0)
 ;
"RTN","DGMSTAPI",61,0)
STATQ Q $G(DGMST)
"RTN","DGMSTAPI",62,0)
 ;
"RTN","DGMSTAPI",63,0)
NEWSTAT(DFN,DGSTAT,DGDATE,DGPROV,DGSITE,DGXMIT) ; MST HISTORY (#29.11) filer
"RTN","DGMSTAPI",64,0)
 ; Callpoint to create a new MST HISTORY FILE (#29.11) entry.
"RTN","DGMSTAPI",65,0)
 ; Will also queue HL7 message for HEC database updates.
"RTN","DGMSTAPI",66,0)
 ;
"RTN","DGMSTAPI",67,0)
 ;  Input
"RTN","DGMSTAPI",68,0)
 ;    DFN    - Patients DFN
"RTN","DGMSTAPI",69,0)
 ;    DGSTAT - MST Status code, "Y,N,D,U"
"RTN","DGMSTAPI",70,0)
 ;    DGDATE - Date of MST status change  [default=NOW]
"RTN","DGMSTAPI",71,0)
 ;    DGPROV - IEN of Provider making determination, file (#200)
"RTN","DGMSTAPI",72,0)
 ;    DGSITE - IEN pointer of the INSTITUTION file (#4)
"RTN","DGMSTAPI",73,0)
 ;    DGXMIT - HL7 transmit flag [OPTIONAL]
"RTN","DGMSTAPI",74,0)
 ;              0=don't queue a message
"RTN","DGMSTAPI",75,0)
 ;              1=queue a message [default])
"RTN","DGMSTAPI",76,0)
 ;
"RTN","DGMSTAPI",77,0)
 ;  Output
"RTN","DGMSTAPI",78,0)
 ;    DGRSLT - Returns IEN of file (#29.11) entry if successful
"RTN","DGMSTAPI",79,0)
 ;
"RTN","DGMSTAPI",80,0)
 ;    If no patient was defined, then:
"RTN","DGMSTAPI",81,0)
 ;       DGRSLT = -1^No patient defined
"RTN","DGMSTAPI",82,0)
 ;
"RTN","DGMSTAPI",83,0)
 ;    If an error occured in the GETS^DIQ lookup, then:
"RTN","DGMSTAPI",84,0)
 ;       DGMST = -1^^Error Code IEN
"RTN","DGMSTAPI",85,0)
 ;                   (returned by GETS^DIQ call)
"RTN","DGMSTAPI",86,0)
 ;
"RTN","DGMSTAPI",87,0)
 N DGFDA,DGMSG,DGERR,DGRSLT,MSTIEN
"RTN","DGMSTAPI",88,0)
 S DFN=$G(DFN)
"RTN","DGMSTAPI",89,0)
 I DFN']""!('$D(^DPT(DFN,0))) D  G NEWQ
"RTN","DGMSTAPI",90,0)
 . S DGRSLT="-1^No patient defined"
"RTN","DGMSTAPI",91,0)
 ;
"RTN","DGMSTAPI",92,0)
 S DGSTAT=$S($G(DGSTAT)]"":DGSTAT,1:"U")
"RTN","DGMSTAPI",93,0)
 S DGDATE=$G(DGDATE)
"RTN","DGMSTAPI",94,0)
 S DGPROV=$G(DGPROV)
"RTN","DGMSTAPI",95,0)
 S DGSITE=$G(DGSITE)
"RTN","DGMSTAPI",96,0)
 S DGXMIT=$S($G(DGXMIT)=0:DGXMIT,1:1)
"RTN","DGMSTAPI",97,0)
 S DGDATE=$S(+DGDATE>0:DGDATE,1:$$NOW^XLFDT)
"RTN","DGMSTAPI",98,0)
 S DGSITE=$S(+DGSITE>0:DGSITE,1:$$SITE)
"RTN","DGMSTAPI",99,0)
 ;
"RTN","DGMSTAPI",100,0)
 I '$$CHANGE(DFN,DGSTAT,DGDATE) D  G NEWQ
"RTN","DGMSTAPI",101,0)
 . S DGRSLT="0"
"RTN","DGMSTAPI",102,0)
 ;
"RTN","DGMSTAPI",103,0)
 I '$$VALID(DFN,DGSTAT,DGDATE,DGPROV,DGSITE,.DGERR) D  G NEWQ
"RTN","DGMSTAPI",104,0)
 . S DGRSLT="-1^"_DGERR
"RTN","DGMSTAPI",105,0)
 ;
"RTN","DGMSTAPI",106,0)
 S DGFDA(1,29.11,"+1,",.01)=DGDATE
"RTN","DGMSTAPI",107,0)
 S DGFDA(1,29.11,"+1,",2)=DFN
"RTN","DGMSTAPI",108,0)
 S DGFDA(1,29.11,"+1,",3)=DGSTAT
"RTN","DGMSTAPI",109,0)
 S DGFDA(1,29.11,"+1,",4)=DGPROV
"RTN","DGMSTAPI",110,0)
 S DGFDA(1,29.11,"+1,",5)=DUZ
"RTN","DGMSTAPI",111,0)
 S DGFDA(1,29.11,"+1,",6)=DGSITE
"RTN","DGMSTAPI",112,0)
 ;
"RTN","DGMSTAPI",113,0)
 D UPDATE^DIE("","DGFDA(1)","MSTIEN","DGERR")
"RTN","DGMSTAPI",114,0)
 I $D(DGERR) D  G NEWQ
"RTN","DGMSTAPI",115,0)
 . S DGRSLT="-1^"_$G(DGERR("DIERR",1))
"RTN","DGMSTAPI",116,0)
 ;
"RTN","DGMSTAPI",117,0)
 S DGRSLT=+MSTIEN(1)
"RTN","DGMSTAPI",118,0)
 ;
"RTN","DGMSTAPI",119,0)
 ; Callpoint to queue an entry that will trigger a HEC
"RTN","DGMSTAPI",120,0)
 ;  Enrollment Full Data Transmission (ORF/ORU~ZO7) HL7 message.
"RTN","DGMSTAPI",121,0)
 ; The HL7 message will contain the following three MST data elments
"RTN","DGMSTAPI",122,0)
 ;  as part of the VA-Specific Eligibility ZEL segment:
"RTN","DGMSTAPI",123,0)
 ;   (23) - MST STATUS
"RTN","DGMSTAPI",124,0)
 ;   (24) - DATE MST STATUS CHANGED
"RTN","DGMSTAPI",125,0)
 ;   (25) - SITE DETERMINING MST STATUS
"RTN","DGMSTAPI",126,0)
 ;
"RTN","DGMSTAPI",127,0)
 I DGXMIT D
"RTN","DGMSTAPI",128,0)
 . D SEND^DGMSTL1(DFN,"Z07")
"RTN","DGMSTAPI",129,0)
 ;
"RTN","DGMSTAPI",130,0)
NEWQ Q $G(DGRSLT)
"RTN","DGMSTAPI",131,0)
 ;
"RTN","DGMSTAPI",132,0)
DELMST(MSTIEN) ; Deletes the MST HISTORY File (#29.11) entry passed in.  
"RTN","DGMSTAPI",133,0)
 ; This call is not to be used except from inside the DG MST List
"RTN","DGMSTAPI",134,0)
 ; Manager interface.  
"RTN","DGMSTAPI",135,0)
 ;
"RTN","DGMSTAPI",136,0)
 ; Input
"RTN","DGMSTAPI",137,0)
 ;    MSTIEN   - IEN of the entry in the MST HISTORY File (#29.11)
"RTN","DGMSTAPI",138,0)
 ;
"RTN","DGMSTAPI",139,0)
 ; Output
"RTN","DGMSTAPI",140,0)
 ;    If no IEN passed in, return -1
"RTN","DGMSTAPI",141,0)
 ;    otherwise return 1
"RTN","DGMSTAPI",142,0)
 ;
"RTN","DGMSTAPI",143,0)
 Q:'$G(MSTIEN) "-1^No entry to delete"
"RTN","DGMSTAPI",144,0)
 ;
"RTN","DGMSTAPI",145,0)
 N DA,XD
"RTN","DGMSTAPI",146,0)
 S DA=+$G(MSTIEN)
"RTN","DGMSTAPI",147,0)
 S DIK="^DGMS(29.11,"
"RTN","DGMSTAPI",148,0)
 D ^DIK K DIK
"RTN","DGMSTAPI",149,0)
 Q 1
"RTN","DGMSTAPI",150,0)
 ;
"RTN","DGMSTAPI",151,0)
NAME(DA) ; Returns name from the VA NEW PERSON File using DIQ call
"RTN","DGMSTAPI",152,0)
 ;
"RTN","DGMSTAPI",153,0)
 N DGNAME,DGPROV,DIQ,DR,DIC
"RTN","DGMSTAPI",154,0)
 I $G(DA)="" G NAMEQ
"RTN","DGMSTAPI",155,0)
 S DIC=200,DR=".01",DIQ="DGPROV"
"RTN","DGMSTAPI",156,0)
 D EN^DIQ1
"RTN","DGMSTAPI",157,0)
 S DGNAME=$G(DGPROV(200,DA,.01))
"RTN","DGMSTAPI",158,0)
NAMEQ Q $G(DGNAME)
"RTN","DGMSTAPI",159,0)
 ;
"RTN","DGMSTAPI",160,0)
CHANGE(DFN,DGSTAT,DGDATE) ;Did the Status OR Date change?
"RTN","DGMSTAPI",161,0)
 ;  Input
"RTN","DGMSTAPI",162,0)
 ;      DFN    - Patients DFN
"RTN","DGMSTAPI",163,0)
 ;      DGSTAT - MST Status code, "Y,N,D,U"
"RTN","DGMSTAPI",164,0)
 ;      DGDATE - Date of MST Status Change (FM format)
"RTN","DGMSTAPI",165,0)
 ;
"RTN","DGMSTAPI",166,0)
 ;  Output
"RTN","DGMSTAPI",167,0)
 ;      Returns 0 if no status change
"RTN","DGMSTAPI",168,0)
 ;              1 if status changed
"RTN","DGMSTAPI",169,0)
 ;
"RTN","DGMSTAPI",170,0)
 N DGCHG,DGMST
"RTN","DGMSTAPI",171,0)
 S DGCHG=0
"RTN","DGMSTAPI",172,0)
 I +$G(DFN)'>0!('$D(^DPT(DFN,0))) G CHNGQ
"RTN","DGMSTAPI",173,0)
 S DGSTAT=$G(DGSTAT)
"RTN","DGMSTAPI",174,0)
 I DGSTAT'?1A!("YNDU"'[DGSTAT) G CHNGQ
"RTN","DGMSTAPI",175,0)
 S DGDATE=$G(DGDATE)
"RTN","DGMSTAPI",176,0)
 I DGDATE="" G CHNGQ
"RTN","DGMSTAPI",177,0)
 S DGMST=$$GETSTAT(DFN),DGMST=$G(DGMST)
"RTN","DGMSTAPI",178,0)
 I +DGMST<1!($P(DGMST,U,2)'=$G(DGSTAT))!($P(DGMST,U,3)'=$G(DGDATE)) S DGCHG=1
"RTN","DGMSTAPI",179,0)
CHNGQ Q DGCHG
"RTN","DGMSTAPI",180,0)
 ;
"RTN","DGMSTAPI",181,0)
SITE(DGSITE) ;Convert a station number into a pointer to the
"RTN","DGMSTAPI",182,0)
 ; INSTITUTION file (#4).  If called with a null parameter then
"RTN","DGMSTAPI",183,0)
 ; the pointer to the INSTITUTION file (#4) of the primary site
"RTN","DGMSTAPI",184,0)
 ; will be returned.
"RTN","DGMSTAPI",185,0)
 ;
"RTN","DGMSTAPI",186,0)
 ;  Input
"RTN","DGMSTAPI",187,0)
 ;    DGSITE - Station number (optional)
"RTN","DGMSTAPI",188,0)
 ;
"RTN","DGMSTAPI",189,0)
 ;  Output
"RTN","DGMSTAPI",190,0)
 ;    Return Site IEN to INSTITUTION file (#4)
"RTN","DGMSTAPI",191,0)
 ;
"RTN","DGMSTAPI",192,0)
 S DGSITE=$G(DGSITE)
"RTN","DGMSTAPI",193,0)
 I DGSITE]"",$D(^DIC(4,"D",DGSITE)) D
"RTN","DGMSTAPI",194,0)
 . S DGSITE=$O(^DIC(4,"D",DGSITE,0))
"RTN","DGMSTAPI",195,0)
 E  D
"RTN","DGMSTAPI",196,0)
 . S DGSITE=$P($$SITE^VASITE,U)
"RTN","DGMSTAPI",197,0)
 I +DGSITE'>0 S DGSITE=""
"RTN","DGMSTAPI",198,0)
 Q DGSITE
"RTN","DGMSTAPI",199,0)
 ;
"RTN","DGMSTAPI",200,0)
DATE(DFN,DGDT) ;Determine 'current' MST date
"RTN","DGMSTAPI",201,0)
 ; 
"RTN","DGMSTAPI",202,0)
 ;  Input
"RTN","DGMSTAPI",203,0)
 ;    DFN  - Patient's DFN
"RTN","DGMSTAPI",204,0)
 ;    DGDT - FileMan format date
"RTN","DGMSTAPI",205,0)
 ;
"RTN","DGMSTAPI",206,0)
 ;  Output
"RTN","DGMSTAPI",207,0)
 ;    Return MST effective date
"RTN","DGMSTAPI",208,0)
 ;
"RTN","DGMSTAPI",209,0)
 N DGMSTDT
"RTN","DGMSTAPI",210,0)
 S DFN=$G(DFN)
"RTN","DGMSTAPI",211,0)
 I '+DFN D  G DATEQ
"RTN","DGMSTAPI",212,0)
 . S DGMSTDT=""
"RTN","DGMSTAPI",213,0)
 S DGDT=$S(+$G(DGDT)>0:DGDT,1:$$NOW^XLFDT)
"RTN","DGMSTAPI",214,0)
 I $P(DGDT,".",2)="" S DGDT=DGDT_".999999"
"RTN","DGMSTAPI",215,0)
 S DGMSTDT=$O(^DGMS(29.11,"APDT",DFN,DGDT),-1)
"RTN","DGMSTAPI",216,0)
DATEQ Q DGMSTDT
"RTN","DGMSTAPI",217,0)
 ;
"RTN","DGMSTAPI",218,0)
VALID(DFN,DGSTAT,DGDATE,DGPROV,DGSITE,DGERR) ;Validate fields before filing
"RTN","DGMSTAPI",219,0)
 ; Input:
"RTN","DGMSTAPI",220,0)
 ;      DFN - [REQUIRED] - ien of Patient
"RTN","DGMSTAPI",221,0)
 ;   DGSTAT - [REQUIRED] - MST Status code, "Y,N,D,U"
"RTN","DGMSTAPI",222,0)
 ;   DGDATE - [REQUIRED] - Date of MST status change[FileMan Internal]
"RTN","DGMSTAPI",223,0)
 ;   DGPROV - [optional] - IEN of Provider making determination
"RTN","DGMSTAPI",224,0)
 ;   DGSITE - [optional] - IEN pointer of the INSTITUTION file
"RTN","DGMSTAPI",225,0)
 ;    DGERR - [optional] - error parameter passed by reference
"RTN","DGMSTAPI",226,0)
 ; Output:
"RTN","DGMSTAPI",227,0)
 ;   Function Value - Returns 1 - if validation checks passed
"RTN","DGMSTAPI",228,0)
 ;                            0 - if validation checks failed
"RTN","DGMSTAPI",229,0)
 ;            DGERR - an error message if validation checks fail
"RTN","DGMSTAPI",230,0)
 ; init variables
"RTN","DGMSTAPI",231,0)
 N I,DGFILE,DGFLD,DGMSG,DGSTR,DGVAL,DGVAR,DGX,VALID
"RTN","DGMSTAPI",232,0)
 S DGFILE=29.11,VALID=1,DGMSG=" IS REQUIRED"
"RTN","DGMSTAPI",233,0)
 ; Quit DO block if invalid condition found
"RTN","DGMSTAPI",234,0)
 ; Check for [REQUIRED] fields
"RTN","DGMSTAPI",235,0)
 D
"RTN","DGMSTAPI",236,0)
 . I DFN="" D MSG(DGFILE,2,DGMSG,.DGERR) Q        ;pat ien
"RTN","DGMSTAPI",237,0)
 . I DGSTAT="" D MSG(DGFILE,3,DGMSG,.DGERR) Q     ;mst status code
"RTN","DGMSTAPI",238,0)
 . I DGDATE="" D MSG(DGFILE,.01,DGMSG,.DGERR) Q   ;dt chg status
"RTN","DGMSTAPI",239,0)
 .;
"RTN","DGMSTAPI",240,0)
 .; Check for valid FIELD values
"RTN","DGMSTAPI",241,0)
 . S DGMSG=" IS NOT VALID"
"RTN","DGMSTAPI",242,0)
 .; need to strip off the 'seconds' to pass the CHK^DIE() call...
"RTN","DGMSTAPI",243,0)
 . I DGDATE["." N DGSECS S DGSECS=$E($P(DGDATE,".",2),5,6) I DGSECS'="" I DGSECS<0!(DGSECS>60) D MSG(DGFILE,.01,DGMSG,.DGERR) Q
"RTN","DGMSTAPI",244,0)
 . N DGDATEX S DGDATEX=DGDATE
"RTN","DGMSTAPI",245,0)
 . I DGDATEX["." S DGDATEX=$P(DGDATEX,".")_"."_$E($P(DGDATEX,".",2),1,4)
"RTN","DGMSTAPI",246,0)
 . I $E($P(DGDATEX,".",2),1,4)="0000" S DGDATEX=$P(DGDATEX,".")_".1"
"RTN","DGMSTAPI",247,0)
 . S DGSTR=".01;DGDATEX^2;DFN^3;DGSTAT^4;DGPROV^5;DUZ^6;DGSITE"
"RTN","DGMSTAPI",248,0)
 .;
"RTN","DGMSTAPI",249,0)
 . F I=1:1:$L(DGSTR,U) S DGX=$P(DGSTR,U,I) Q:DGX=""  D  Q:'VALID
"RTN","DGMSTAPI",250,0)
 .. S DGFLD=$P(DGX,";"),DGVAR=$P(DGX,";",2),DGVAL=@DGVAR
"RTN","DGMSTAPI",251,0)
 .. Q:DGVAL=""
"RTN","DGMSTAPI",252,0)
 .. S VALID=$$TESTVAL(DGFILE,DGFLD,DGVAL)
"RTN","DGMSTAPI",253,0)
 .. D:'VALID MSG(DGFILE,DGFLD,DGMSG,.DGERR)
"RTN","DGMSTAPI",254,0)
 Q VALID
"RTN","DGMSTAPI",255,0)
 ;
"RTN","DGMSTAPI",256,0)
MSG(DGFIL,DGFLD,DGMSG,DGERR) ; error message setup
"RTN","DGMSTAPI",257,0)
 ; Input:
"RTN","DGMSTAPI",258,0)
 ;   DGFIL - file number
"RTN","DGMSTAPI",259,0)
 ;   DGFLD - field number of file
"RTN","DGMSTAPI",260,0)
 ;   DGMSG - message type verbiage - " IS REQUIRED" or " IS NOT VALID"
"RTN","DGMSTAPI",261,0)
 ;   DGERR - error parameter passed by reference
"RTN","DGMSTAPI",262,0)
 ; Output:
"RTN","DGMSTAPI",263,0)
 ;   DGERR - error message
"RTN","DGMSTAPI",264,0)
 S DGERR=$$GET1^DID(DGFIL,DGFLD,,"LABEL")_DGMSG
"RTN","DGMSTAPI",265,0)
 Q
"RTN","DGMSTAPI",266,0)
 ;
"RTN","DGMSTAPI",267,0)
TESTVAL(DGFIL,DGFLD,DGVAL) ; Determine if a field value is valid.
"RTN","DGMSTAPI",268,0)
 ; Input:
"RTN","DGMSTAPI",269,0)
 ;   DGFIL - file number
"RTN","DGMSTAPI",270,0)
 ;   DGFLD - field number of file
"RTN","DGMSTAPI",271,0)
 ;   DGVAL - field value to be validated
"RTN","DGMSTAPI",272,0)
 ; Output:
"RTN","DGMSTAPI",273,0)
 ;   Function value: Returns 1 if field is valid
"RTN","DGMSTAPI",274,0)
 ;                           0 if validation fails
"RTN","DGMSTAPI",275,0)
 N DGVALEX,DGRSLT,VALID
"RTN","DGMSTAPI",276,0)
 S VALID=1
"RTN","DGMSTAPI",277,0)
 I DGVAL'="" D
"RTN","DGMSTAPI",278,0)
 . S DGVALEX=$$EXTERNAL^DILFD(DGFIL,DGFLD,"F",DGVAL)
"RTN","DGMSTAPI",279,0)
 . I DGVALEX="" S VALID=0 Q   ; no external value, not valid
"RTN","DGMSTAPI",280,0)
 . I $$GET1^DID(DGFIL,DGFLD,"","TYPE")'="POINTER" D
"RTN","DGMSTAPI",281,0)
 .. D CHK^DIE(DGFIL,DGFLD,,DGVALEX,.DGRSLT) I DGRSLT="^" S VALID=0
"RTN","DGMSTAPI",282,0)
 Q VALID
"RTN","DGRP1")
0^1^B23750245^B22435111
"RTN","DGRP1",1,0)
DGRP1 ;ALB/MRL - DEMOGRAPHIC DATA ; 4/27/05 10:53am
"RTN","DGRP1",2,0)
 ;;5.3;Registration;**109,161,506,244,546,570,629,638,649,700**;Aug 13, 1993
"RTN","DGRP1",3,0)
 ;
"RTN","DGRP1",4,0)
EN S (DGRPS,DGRPW)=1 D H^DGRPU F I=0,.11,.121,.13,.15,.24,57 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRP1",5,0)
 I $P(DGRP(.15),"^",2)]"" S Z="APPLICANT IS LISTED AS 'INELIGIBLE' FOR TREATMENT!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",6,0)
 ;I $P(DGRP(.15),"^",3)]"" S Z="APPLICANT IS LISTED AS 'MISSING'.  NOTIFY APPROPRIATE PERSONNEL!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",7,0)
 W ! S Z=1 D WW^DGRPV W "    Name: " S Z=$P(DGRP(0),"^",1),Z1=31 D WW1^DGRPV W "SS: " S X=$P(DGRP(0),"^",9),Z=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),Z1=13 D WW1^DGRPV S Y=$P(DGRP(0),"^",3) X ^DD("DD") W "DOB: ",Y
"RTN","DGRP1",8,0)
 D GETNCAL  ;Display name component, sex, and alias information
"RTN","DGRP1",9,0)
 S Z=3,DGRPX=DGRP(0) D WW^DGRPV W " Remarks: ",$S($P(DGRPX,"^",10)]"":$E($P(DGRPX,"^",10),1,65),1:"NO REMARKS ENTERED FOR THIS PATIENT") S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU I $P(DGRP(.121),"^",9)="Y" S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU
"RTN","DGRP1",10,0)
 S Z=4 D WW^DGRPV W " Permanent Address: " S Z=" ",Z1=17
"RTN","DGRP1",11,0)
 D WW1^DGRPV S Z=5,DGRPW=0 D WW^DGRPV W " Temporary Address: "
"RTN","DGRP1",12,0)
 W !?11
"RTN","DGRP1",13,0)
 S Z1=40,Z=$S($D(DGA(1)):DGA(1),1:"NONE ON FILE") D WW1^DGRPV W $S($D(DGA(2)):DGA(2),1:"NO TEMPORARY ADDRESS")
"RTN","DGRP1",14,0)
 S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>50) !?11 W:'(I#2) ?51 W DGA(I)
"RTN","DGRP1",15,0)
 S DGCC=$S($D(^DIC(5,+$P(DGRP(.11),U,5),1,+$P(DGRP(.11),U,7),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU) W !?3,"County: ",DGCC K DGCC
"RTN","DGRP1",16,0)
 S DGCC=$S($P(DGRP(.121),U,9)'="Y":"NOT APPLICABLE",$D(^DIC(5,+$P(DGRP(.121),U,5),1,+$P(DGRP(.121),U,11),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU) W ?43,"County: ",DGCC K DGCC
"RTN","DGRP1",17,0)
 W !?4,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGRPU),?44,"Phone: ",$S($P(DGRP(.121),U,9)'="Y":"NOT APPLICABLE",$P(DGRP(.121),U,10)]"":$P(DGRP(.121),U,10),1:DGRPU)
"RTN","DGRP1",18,0)
 S X="NOT APPLICABLE" I $P(DGRP(.121),U,9)="Y" S Y=$P(DGRP(.121),U,7) X:Y]"" ^DD("DD") S X=$S(Y]"":Y,1:DGRPU)_"-",Y=$P(DGRP(.121),U,8) X:Y]"" ^DD("DD") S X=X_$S(Y]"":Y,1:DGRPU)
"RTN","DGRP1",19,0)
 W !?3,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGRPU),?42,"From/To: ",X
"RTN","DGRP1",20,0)
 W !?1,"Bad Addr: ",$$EXTERNAL^DILFD(2,.121,"",$P(DGRP(.11),U,16))
"RTN","DGRP1",21,0)
 ;
"RTN","DGRP1",22,0)
 ; ***  Additional displays added for Pre-Registration
"RTN","DGRP1",23,0)
 I $G(DGPRFLG)=1 D
"RTN","DGRP1",24,0)
 . W !
"RTN","DGRP1",25,0)
 . N I,MIS1,X,X1,SA1,TP1,X2,X3,ES1
"RTN","DGRP1",26,0)
 . I $D(^DIA(2,"B",DFN)) S X="" F I=1:1 S X=$O(^DIA(2,"B",DFN,X)) Q:X<1  I $P(^DIA(2,X,0),U,3)=.05 S MIS1=$P(^DIA(2,X,0),U,2)
"RTN","DGRP1",27,0)
 . W:$D(MIS1)>0 !," [MARITAL STATUS CHANGED:] "_$$FMTE^XLFDT(MIS1,"5D")
"RTN","DGRP1",28,0)
 . I $D(^DIA(2,"B",DFN)) S X1="" F I=1:1 S X1=$O(^DIA(2,"B",DFN,X1)) Q:X1<1  S:$P(^DIA(2,X1,0),U,3)=.111 SA1=$P(^DIA(2,X1,0),U,2)
"RTN","DGRP1",29,0)
 . W:$D(SA1)>0 !," [STREET ADDRESS LAST CHANGED:] "_$$FMTE^XLFDT(SA1,"5D")
"RTN","DGRP1",30,0)
 . I $D(^DIA(2,"B",DFN)) S X2="" F I=1:1 S X2=$O(^DIA(2,"B",DFN,X2)) Q:X2<1  S:$P(^DIA(2,X2,0),U,3)=.131 TP1=$P(^DIA(2,X2,0),U,2)
"RTN","DGRP1",31,0)
 . W:$D(TP1)>0 !," [HOME PHONE NUMBER CHANGED:] "_$$FMTE^XLFDT(TP1,"5D")
"RTN","DGRP1",32,0)
 . I $D(^DIA(2,"B",DFN)) S X3="" F I=1:1 S X3=$O(^DIA(2,"B",DFN,X3)) Q:X3<1  S:$P(^DIA(2,X3,0),U,3)=.31115 ES1=$P(^DIA(2,X3,0),U,2)
"RTN","DGRP1",33,0)
 . W:$D(ES1)>0 !," [EMPLOYMENT STATUS CHANGED:] "_$$FMTE^XLFDT(ES1,"5D")
"RTN","DGRP1",34,0)
 . ; The IB Insurance API does not provide date entered or edited information, so this information will not be displayed for preregistration
"RTN","DGRP1",35,0)
 . I $$INSUR^IBBAPI(DFN,"","AR",.DGDATA,"1,10,11") F DGI=0:0 S DGI=$O(DGDATA("IBBAPI","INSUR",DGI)) Q:'DGI  D
"RTN","DGRP1",36,0)
 .. W !," [INSURANCE:] ",$P(DGDATA("IBBAPI","INSUR",DGI,1),U,2)
"RTN","DGRP1",37,0)
 .. W "  EFFECTIVE DATE: ",$$FMTE^XLFDT(DGDATA("IBBAPI","INSUR",DGI,10),"5D"),"  EXPIRATION DATE: ",$$FMTE^XLFDT(DGDATA("IBBAPI","INSUR",DGI,11),"5D")
"RTN","DGRP1",38,0)
 ;
"RTN","DGRP1",39,0)
 G ^DGRPP
"RTN","DGRP1",40,0)
 ;
"RTN","DGRP1",41,0)
GETNCAL ;Get name component values
"RTN","DGRP1",42,0)
 N DGCOMP,DGNC,DGI,DGA,DGALIAS,DGX,DGRPW
"RTN","DGRP1",43,0)
 S DGNC="Family^Given^Middle^Prefix^Suffix^Degree"
"RTN","DGRP1",44,0)
 S DGCOMP=+$G(^DPT(DFN,"NAME"))_","
"RTN","DGRP1",45,0)
 I DGCOMP D GETS^DIQ(20,DGCOMP,"1:6",,"DGCOMP")
"RTN","DGRP1",46,0)
 ;Get alias values
"RTN","DGRP1",47,0)
 S DGA=0 F DGI=1:1:5 D  Q:'$D(DGALIAS(DGI))
"RTN","DGRP1",48,0)
A2 .S DGA=$O(^DPT(DFN,.01,DGA))
"RTN","DGRP1",49,0)
 .I 'DGA D:DGI=1  Q
"RTN","DGRP1",50,0)
 ..S DGALIAS(DGI)="< No alias entries on file >" Q
"RTN","DGRP1",51,0)
 .I DGI=5 S DGALIAS(DGI)="< More alias entries on file >" Q
"RTN","DGRP1",52,0)
 .S DGX=$G(^DPT(DFN,.01,DGA,0)) G:'$L(DGX) A2
"RTN","DGRP1",53,0)
 .S DGALIAS(DGI)=$P(DGX,U),DGX=$P(DGX,U,2)
"RTN","DGRP1",54,0)
 .I $L(DGX) D
"RTN","DGRP1",55,0)
 ..S DGX=" "_$E(DGX,1,3)_"-"_$E(DGX,4,5)_"-"_$E(DGX,6,10)
"RTN","DGRP1",56,0)
 ..S DGALIAS(DGI)=$E(DGALIAS(DGI),1,19)
"RTN","DGRP1",57,0)
 ..S $E(DGALIAS(DGI),20)=DGX Q
"RTN","DGRP1",58,0)
 .S DGALIAS(DGI)=$E(DGALIAS(DGI),1,32)
"RTN","DGRP1",59,0)
 .Q
"RTN","DGRP1",60,0)
 ;Display name component, sex, multiple birth indicator and alias data
"RTN","DGRP1",61,0)
 F DGI=1:1:6 D
"RTN","DGRP1",62,0)
 .W !?5,$J($P(DGNC,U,DGI),6),": ",$E($G(DGCOMP(20,DGCOMP,DGI)),1,$S(DGI=1:23,1:27))
"RTN","DGRP1",63,0)
 .I DGI=1 S (Z,DGRPW)=1 W ?43,"Sex: " S X=$P(DGRP(0),"^",2),Z=$S(X="M":"MALE",X="F":"FEMALE",1:DGRPU),Z1=3 D WW1^DGRPV
"RTN","DGRP1",64,0)
 .I DGI=1 S (Z,DGRPW)=1 W ?56,"MBI: " S X=$P($G(^DPT(DFN,"MPIMB")),U),Z=$S(X="N":"NO",X="Y":"*MULTIPLE BIRTH*",1:DGRPU),Z1=16 D WW1^DGRPV
"RTN","DGRP1",65,0)
 .I DGI=2 S DGRPW=0,Z=2 W ?37 D WW^DGRPV W " Alias: "
"RTN","DGRP1",66,0)
 .I DGI>1 W ?47,$G(DGALIAS(DGI-1))
"RTN","DGRP1",67,0)
 .Q
"RTN","DGRP1",68,0)
 Q
"RTN","DGRPECE")
0^2^B48381081^B35524105
"RTN","DGRPECE",1,0)
DGRPECE ;ALB/MRY - REGISTRATION CATASTROPHIC EDITS ; 11/16/04 9:00am
"RTN","DGRPECE",2,0)
 ;;5.3;Registration;**638,682,700**;Aug 13, 1993
"RTN","DGRPECE",3,0)
 ;
"RTN","DGRPECE",4,0)
CEDITS(DFN) ;catastrophic edits  - buffer values, save after check
"RTN","DGRPECE",5,0)
 ;Input;
"RTN","DGRPECE",6,0)
 ;  DFN  := patient ien
"RTN","DGRPECE",7,0)
 ;Catastrophic edits will prompt for name, ssn, dob, and sex.  Placing
"RTN","DGRPECE",8,0)
 ;responses into a buffer space.  User will be alerted on catastrophic
"RTN","DGRPECE",9,0)
 ;edits on the following conditions:
"RTN","DGRPECE",10,0)
 ; 1. Two or more catastrophic edits will generate a warning message.
"RTN","DGRPECE",11,0)
 ; 2. Acceptance of two or more catatrophic edits will generate an alert
"RTN","DGRPECE",12,0)
 ; to appropriate supervising staff holding the DG CATASTROPHIC EDIT key.
"RTN","DGRPECE",13,0)
 ; 3. Acceptance of <2 catatrophic edits will process normally.
"RTN","DGRPECE",14,0)
 ;
"RTN","DGRPECE",15,0)
 ; Arrays: BEFORE - Holds patient values before the edit process
"RTN","DGRPECE",16,0)
 ;                  (before snapshot).
"RTN","DGRPECE",17,0)
 ;         BUFFER - initialized with BEFORE array, holds edited changes
"RTN","DGRPECE",18,0)
 ;                  (after snapshot).
"RTN","DGRPECE",19,0)
 ;         SAVE   - holds only edited changes for filing into file #2.
"RTN","DGRPECE",20,0)
 ;
"RTN","DGRPECE",21,0)
 N DA,DIR,DIRUT,Y,BUFFER,BEFORE,SAVE,DG20IEN
"RTN","DGRPECE",22,0)
 D BEFORE(DFN,.BEFORE,.BUFFER) ;retrieve before patient values
"RTN","DGRPECE",23,0)
 ;buffer - get name
"RTN","DGRPECE",24,0)
 K DG20NAME
"RTN","DGRPECE",25,0)
 S BUFFER("NAME")=$$NCEDIT^DPTNAME(DFN,,.DG20NAME)
"RTN","DGRPECE",26,0)
 I BUFFER("NAME")="" S BUFFER("NAME")=BEFORE("NAME")
"RTN","DGRPECE",27,0)
 I $D(DG20NAME("FAMILY")) S BUFFER("FAMILY")=DG20NAME("FAMILY")
"RTN","DGRPECE",28,0)
 I $D(DG20NAME("GIVEN")) S BUFFER("GIVEN")=DG20NAME("GIVEN")
"RTN","DGRPECE",29,0)
 I $D(DG20NAME("MIDDLE")) S BUFFER("MIDDLE")=DG20NAME("MIDDLE")
"RTN","DGRPECE",30,0)
 I $D(DG20NAME("SUFFIX")) S BUFFER("SUFFIX")=DG20NAME("SUFFIX")
"RTN","DGRPECE",31,0)
 ; the formal name is last name, first name, middle name and suffix
"RTN","DGRPECE",32,0)
 ; the prefix and degree are only stored in file 20
"RTN","DGRPECE",33,0)
 I $D(DG20NAME("PREFIX")) S BUFFER("PREFIX")=DG20NAME("PREFIX")
"RTN","DGRPECE",34,0)
 I $D(DG20NAME("DEGREE")) S BUFFER("DEGREE")=DG20NAME("DEGREE")
"RTN","DGRPECE",35,0)
 K DG20NAME
"RTN","DGRPECE",36,0)
 ;buffer - get ssn
"RTN","DGRPECE",37,0)
 S DIR(0)="2,.09^^"
"RTN","DGRPECE",38,0)
 S DA=DFN D ^DIR
"RTN","DGRPECE",39,0)
 I $D(DIRUT) D CECHECK Q
"RTN","DGRPECE",40,0)
 S BUFFER("SSN")=Y
"RTN","DGRPECE",41,0)
 ;buffer - get dob
"RTN","DGRPECE",42,0)
 S DIR(0)="2,.03^^"
"RTN","DGRPECE",43,0)
 S DA=DFN D ^DIR
"RTN","DGRPECE",44,0)
 I $D(DIRUT) D CECHECK Q
"RTN","DGRPECE",45,0)
 S BUFFER("DOB")=Y
"RTN","DGRPECE",46,0)
 ;buffer - get sex
"RTN","DGRPECE",47,0)
 S DIR(0)="2,.02^^"
"RTN","DGRPECE",48,0)
 S DA=DFN D ^DIR
"RTN","DGRPECE",49,0)
 I $D(DIRUT) D CECHECK Q
"RTN","DGRPECE",50,0)
 S BUFFER("SEX")=Y
"RTN","DGRPECE",51,0)
 ; buffer - get MBI (multiple birth indicator)
"RTN","DGRPECE",52,0)
 S DIR(0)="2,994^^"
"RTN","DGRPECE",53,0)
 S DA=DFN D ^DIR
"RTN","DGRPECE",54,0)
 I $D(DIRUT) D CECHECK Q
"RTN","DGRPECE",55,0)
 S BUFFER("MBI")=Y
"RTN","DGRPECE",56,0)
CECHECK ;do catastrophic edit checks, alert, and save
"RTN","DGRPECE",57,0)
 N DGCNT,DGCEFLG
"RTN","DGRPECE",58,0)
 ;Compare before/buffer arrays, putting edits into save array.
"RTN","DGRPECE",59,0)
 S DGCNT=$$AFTER(.BEFORE,.BUFFER,.SAVE)
"RTN","DGRPECE",60,0)
 ;   DGCNT:  0  = no changes
"RTN","DGRPECE",61,0)
 ;           1  = only one edit change, ok to save w/o CE message
"RTN","DGRPECE",62,0)
 ;           >1 = more then 1 edit, give CE message
"RTN","DGRPECE",63,0)
 I DGCNT>1 D  ;give CE message
"RTN","DGRPECE",64,0)
 . S DGCEFLG=$$WARNING()
"RTN","DGRPECE",65,0)
 . ;    DGCEFLG: 0  = exit without saving changes
"RTN","DGRPECE",66,0)
 . ;             1  = send alert and save
"RTN","DGRPECE",67,0)
 . I DGCEFLG=0 S DGCNT=0
"RTN","DGRPECE",68,0)
 I DGCNT>0 D SAVE(DFN) I $D(DGCEFLG),DGCEFLG D ALERT
"RTN","DGRPECE",69,0)
 Q
"RTN","DGRPECE",70,0)
 ;
"RTN","DGRPECE",71,0)
SAVE(DFN) ;store accepted/edited values into patient file
"RTN","DGRPECE",72,0)
 N FDATA,DIERR
"RTN","DGRPECE",73,0)
 I $D(SAVE("NAME")) S FDATA(2,+DFN_",",.01)=SAVE("NAME")
"RTN","DGRPECE",74,0)
 I $D(SAVE("DOB")) S FDATA(2,+DFN_",",.03)=SAVE("DOB")
"RTN","DGRPECE",75,0)
 I $D(SAVE("SEX")) S FDATA(2,+DFN_",",.02)=SAVE("SEX")
"RTN","DGRPECE",76,0)
 I $D(SAVE("SSN")) S FDATA(2,+DFN_",",.09)=SAVE("SSN")
"RTN","DGRPECE",77,0)
 I $D(SAVE("MBI")) S FDATA(2,+DFN_",",994)=SAVE("MBI")
"RTN","DGRPECE",78,0)
 D FILE^DIE("","FDATA","DIERR")
"RTN","DGRPECE",79,0)
 K FDATA,DIERR
"RTN","DGRPECE",80,0)
 I '$D(^VA(20,DG20IEN)) S DG20IEN=$$GET1^DIQ(2,+DFN_",",1.01,"I")
"RTN","DGRPECE",81,0)
 I $D(SAVE("NAME")) D
"RTN","DGRPECE",82,0)
 .S FDATA(20,+DG20IEN_",",1)=BUFFER("FAMILY")
"RTN","DGRPECE",83,0)
 .S FDATA(20,+DG20IEN_",",2)=BUFFER("GIVEN")
"RTN","DGRPECE",84,0)
 .S FDATA(20,+DG20IEN_",",3)=BUFFER("MIDDLE")
"RTN","DGRPECE",85,0)
 .S FDATA(20,+DG20IEN_",",5)=BUFFER("SUFFIX")
"RTN","DGRPECE",86,0)
 .D FILE^DIE("","FDATA","DIERR")
"RTN","DGRPECE",87,0)
 .K FDATA,DIERR
"RTN","DGRPECE",88,0)
 I $D(BUFFER("PREFIX")) S FDATA(20,+DG20IEN_",",4)=BUFFER("PREFIX")
"RTN","DGRPECE",89,0)
 I $D(BUFFER("DEGREE")) S FDATA(20,+DG20IEN_",",6)=BUFFER("DEGREE")
"RTN","DGRPECE",90,0)
 I $D(SAVE("PREFIX")) S FDATA(20,+DG20IEN_",",4)=SAVE("PREFIX")
"RTN","DGRPECE",91,0)
 I $D(SAVE("DEGREE")) S FDATA(20,+DG20IEN_",",6)=SAVE("DEGREE")
"RTN","DGRPECE",92,0)
 D FILE^DIE("","FDATA","DIERR")
"RTN","DGRPECE",93,0)
 K FDATA,DIERR
"RTN","DGRPECE",94,0)
 Q
"RTN","DGRPECE",95,0)
 ;
"RTN","DGRPECE",96,0)
BEFORE(IEN,BEF,BUF) ;save original name, ssn, dob, sex
"RTN","DGRPECE",97,0)
 N DG20
"RTN","DGRPECE",98,0)
 S BEF("NAME")=$$GET1^DIQ(2,+IEN_",",.01),BUF("NAME")=BEF("NAME")
"RTN","DGRPECE",99,0)
 S BEF("SSN")=$$GET1^DIQ(2,+IEN_",",.09),BUF("SSN")=BEF("SSN")
"RTN","DGRPECE",100,0)
 S BEF("DOB")=$$GET1^DIQ(2,+IEN_",",.03,"I"),BUF("DOB")=BEF("DOB")
"RTN","DGRPECE",101,0)
 S BEF("SEX")=$$GET1^DIQ(2,+IEN_",",.02,"I"),BUF("SEX")=BEF("SEX")
"RTN","DGRPECE",102,0)
 S BEF("MBI")=$$GET1^DIQ(2,+IEN_",",994,"I"),BUF("MBI")=BEF("MBI")
"RTN","DGRPECE",103,0)
 D GETS^DIQ(2,+IEN_",",1.01,"I","DG20")
"RTN","DGRPECE",104,0)
 S BEF("FAMILY")="",BEF("GIVEN")="",BUF("FAMILY")="",BUF("GIVEN")=""
"RTN","DGRPECE",105,0)
 S BEF("MIDDLE")="",BEF("SUFFIX")="",BUF("MIDDLE")="",BUF("MIDDLE")=""
"RTN","DGRPECE",106,0)
 S BEF("PREFIX")="",BEF("DEGREE")="",BUF("PREFIX")="",BUF("DEGREE")=""
"RTN","DGRPECE",107,0)
 S DG20IEN=DG20(2,+IEN_",",1.01,"I")
"RTN","DGRPECE",108,0)
 I $$GET1^DIQ(20,+DG20IEN_",",.03)[+IEN D
"RTN","DGRPECE",109,0)
 . S BEF("FAMILY")=$$GET1^DIQ(20,+DG20IEN_",",1),BUF("FAMILY")=BEF("FAMILY")
"RTN","DGRPECE",110,0)
 . S BEF("GIVEN")=$$GET1^DIQ(20,+DG20IEN_",",2),BUF("GIVEN")=BEF("GIVEN")
"RTN","DGRPECE",111,0)
 . S BEF("MIDDLE")=$$GET1^DIQ(20,+DG20IEN_",",3),BUF("MIDDLE")=BEF("MIDDLE")
"RTN","DGRPECE",112,0)
 . S BEF("SUFFIX")=$$GET1^DIQ(20,+DG20IEN_",",5),BUF("SUFFIX")=BEF("SUFFIX")
"RTN","DGRPECE",113,0)
 . S BEF("PREFIX")=$$GET1^DIQ(20,+DG20IEN_",",4),BUF("PREFIX")=BEF("PREFIX")
"RTN","DGRPECE",114,0)
 . S BEF("DEGREE")=$$GET1^DIQ(20,+DG20IEN_",",6),BUF("DEGREE")=BEF("DEGREE")
"RTN","DGRPECE",115,0)
 ;add some demographic information (before snapshot)
"RTN","DGRPECE",116,0)
 S BEF("MAIDEN")=$E($$GET1^DIQ(2,+IEN_",",.2403),1,17)
"RTN","DGRPECE",117,0)
 S BEF("POBCITY")=$E($$GET1^DIQ(2,+IEN_",",.092),1,15)
"RTN","DGRPECE",118,0)
 S BEF("POBSTATE")=$$GET1^DIQ(2,+IEN_",",.093,"I")
"RTN","DGRPECE",119,0)
 Q
"RTN","DGRPECE",120,0)
 ;
"RTN","DGRPECE",121,0)
AFTER(BEF,BUF,SAV) ;prevent catastrophic edit checks
"RTN","DGRPECE",122,0)
 N DGCNT,DG20CNT S (DGCNT,DG20CNT)=0
"RTN","DGRPECE",123,0)
 I $D(BUF("FAMILY")),BUF("FAMILY")'="",BUF("FAMILY")'=BEF("FAMILY") D
"RTN","DGRPECE",124,0)
 . S DG20CNT=DG20CNT+1
"RTN","DGRPECE",125,0)
 . S SAV("NAME")=BUF("NAME")
"RTN","DGRPECE",126,0)
 I $D(BUF("GIVEN")),BUF("GIVEN")'="",BUF("GIVEN")'=BEF("GIVEN") D
"RTN","DGRPECE",127,0)
 . S DG20CNT=DG20CNT+1
"RTN","DGRPECE",128,0)
 . S SAV("NAME")=BUF("NAME")
"RTN","DGRPECE",129,0)
 I $D(BUF("MIDDLE")),BUF("MIDDLE")'="",BUF("MIDDLE")'=BEF("MIDDLE") D
"RTN","DGRPECE",130,0)
 . S SAV("NAME")=BUF("NAME") ; minor change doesn't count
"RTN","DGRPECE",131,0)
 I $D(BUF("SUFFIX")),BUF("SUFFIX")'="",BUF("SUFFIX")'=BEF("SUFFIX") D
"RTN","DGRPECE",132,0)
 . S SAV("NAME")=BUF("NAME") ; minor change doesn't count
"RTN","DGRPECE",133,0)
 I DG20CNT>0 S DGCNT=1
"RTN","DGRPECE",134,0)
 I $D(BUF("PREFIX")),BUF("PREFIX")'=BEF("PREFIX") D
"RTN","DGRPECE",135,0)
 . S SAV("PREFIX")=BUF("PREFIX")
"RTN","DGRPECE",136,0)
 I $D(BUF("DEGREE")),BUF("DEGREE")'=BEF("DEGREE") D
"RTN","DGRPECE",137,0)
 . S SAV("DEGREE")=BUF("DEGREE")
"RTN","DGRPECE",138,0)
 I $D(BUF("DOB")),BUF("DOB")'="",BUF("DOB")'=BEF("DOB") D
"RTN","DGRPECE",139,0)
 . S SAV("DOB")=BUF("DOB"),DGCNT=DGCNT+1
"RTN","DGRPECE",140,0)
 I $D(BUF("SEX")),BUF("SEX")'="",BUF("SEX")'=BEF("SEX") D
"RTN","DGRPECE",141,0)
 . S SAV("SEX")=BUF("SEX"),DGCNT=DGCNT+1
"RTN","DGRPECE",142,0)
 I $D(BUF("SSN")),BUF("SSN")'="",BUF("SSN")'=BEF("SSN") D
"RTN","DGRPECE",143,0)
 . S SAV("SSN")=BUF("SSN"),DGCNT=DGCNT+1
"RTN","DGRPECE",144,0)
 I $D(BUF("MBI")),BUF("MBI")'="",BUF("MBI")'=BEF("MBI") D
"RTN","DGRPECE",145,0)
 . S SAV("MBI")=BUF("MBI"),DGCNT=DGCNT+1
"RTN","DGRPECE",146,0)
 I DGCNT=0,$D(SAV("NAME")) Q 1 ;minor name change (i.e. middle name or suffix)
"RTN","DGRPECE",147,0)
 I DGCNT=0,$D(SAV("PREFIX"))!($D(SAV("DEGREE"))) Q 1 ; prefix or degree change
"RTN","DGRPECE",148,0)
 I DGCNT=0 Q 0 ;no changes
"RTN","DGRPECE",149,0)
 I DGCNT<2 Q 1 ;make one change w/o alert
"RTN","DGRPECE",150,0)
 I DGCNT>1 Q 2 ;more than 1 change, send warning message
"RTN","DGRPECE",151,0)
 ;
"RTN","DGRPECE",152,0)
WARNING() ;CE warning message
"RTN","DGRPECE",153,0)
 ;Output     0  = exit without saving changes
"RTN","DGRPECE",154,0)
 ;           1  = send alert and save
"RTN","DGRPECE",155,0)
 W !!,?25,"**WARNING!!**"
"RTN","DGRPECE",156,0)
 W !!,"The edits you are about to make, may potentially change the identity of"
"RTN","DGRPECE",157,0)
 W !,"this patient.  Please verify that you have selected the correct patient"
"RTN","DGRPECE",158,0)
 W !,"and ensure that supporting documentation exists for these changes.  If"
"RTN","DGRPECE",159,0)
 W !,"you continue with these edits, an alert will be generated and sent to"
"RTN","DGRPECE",160,0)
 W !,"your Supervisor and ADPAC, notifying them of the changes."
"RTN","DGRPECE",161,0)
 N DIR,DGANS,Y
"RTN","DGRPECE",162,0)
 S DIR(0)="Y",DIR("A")="Do you wish to continue and save your edits:"
"RTN","DGRPECE",163,0)
 S DIR("B")="NO" D ^DIR K DIR S DGANS=Y
"RTN","DGRPECE",164,0)
 S DGANS=$S(Y=1:1,1:0) ;0=don't save, 1=save with CE alert
"RTN","DGRPECE",165,0)
 Q DGANS
"RTN","DGRPECE",166,0)
 ;
"RTN","DGRPECE",167,0)
ALERT ;Queue alert
"RTN","DGRPECE",168,0)
 X ^%ZOSF("UCI") S ZTUCI=Y,ZTRTN="ALERT^DGRPECE1",ZTDTH=$H,ZTIO="",IEN=DFN
"RTN","DGRPECE",169,0)
 F V="IEN","BEFORE(","BUFFER(","SAVE(","XQY" S ZTSAVE(V)=""
"RTN","DGRPECE",170,0)
 S ZTDESC="Patient Catastrophic Edits alert" K V,ZTSK N X D ^%ZTLOAD  Q
"RTN","DGRPECE",171,0)
 ;D ALERT^DGRPECE1(DFN,.BEFORE,.BUFFER,.SAVE)
"RTN","DGRPECE",172,0)
 Q
"VER")
8.0^22.0
"BLD",6597,6)
^621
**END**
**END**
