$TXT Created by FRANCE,VENESSA at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Tuesday, 01/20/04 at 15:35
=============================================================================
Run Date: MAR 08, 2004                     Designation: PSA*3*36
Package : PSA - DRUG ACCOUNTABILITY           Priority: Mandatory
Version : 3        SEQ #27                      Status: Released
                  Compliance Date: APR 08, 2004
=============================================================================

Associated patches: (v)PSA*3*21    <<= must be installed BEFORE `PSA*3*36'

Subject: ERROR IN EDIT VERIFIED INVOICES

Category: 
  - Routine

Description:
============

 This patch will fix two undefined errors in the menu option 'Edit Verified
 Invoices'.
 An undefined error occurs when editing a verified invoice if the user changes
 the name of a drug and the order units are different.  This error occurs when 
 prompting for the Dispense Units per Order Unit.
  
 When the user edits a line item and changes the drug name, the invoiced
 quantity is updated in the Drug File (#50);it is subtracted from the invoiced item 
 and added to the new item.  If the invoiced line item is not in the Drug File 
 (#50), an undefined error occurs when trying to subtract the invoiced
 quantity.
  
 ASSOCIATED NOIS:
 ================ 
 OKL-1003-72538       Drug Accountability Undefined error in Edit
                      Verified Invoices
  
  
 ASSOCIATED E3R:
 ===============
 N/A
  
 PARTICIPATING TEST SITES:
 =========================
 Oklahoma City 
 Fayetteville, AR
 Big Spring, TX
 Syracuse, NY (Upstate NY HCS) 
  
 NOIS OVERVIEW:
 ==============
 1. OKL-1003-72538       Drug Accountability Undefined error in Edit
       Verified Invoices
  
 Problem 1:
 ----------
 When the user changes the name of a drug on a verified invoice where the Order
 Units are different between the two drugs, the user is prompted for the 
 appropriate Dispense Units per Order Unit.  At this prompt the user gets an 
 undefined error since the variable DIE is not set when calling fileman to 
 prompt for the input.
  
 Resolution:
 ----------- 
 Modified routine PSAVERA to set the variable that causes the undefined error.
  
 Problem 2:
 ----------
 When the user edits a line item and changes the drug name, the invoiced
 quantity is updated in the Drug File (#50), subtracted from the invoiced item 
 and added to the new item.  If the invoiced line item is not in the Drug File 
 (#50), an undefined error occurs when trying to subtract the invoiced
 quantity.
  
 Resolution:
 -----------
 Modified routine PSAVERA to only subtract the invoice quantity from the 
 invoice item if it exists in the Drug file (#50).
  
 Technical:
 ==========
 NOIS: OKL-1003-72538       Drug Accountability Undefined error in Edit
       Verified Invoices
  
 Problem 1:
 Routine PSAVERA was modified at tag DRG1 to set variable DIE="^PSDRUG(" to 
 prevent an undefined error when changing the name of a drug on a verified
 invoice.
  
 Before:
 -------
         I $P($G(^PSDRUG(PSADRG,660)),"^",5)'=$G(PSADUOU) W !,"Please enter the
 appropriate Dispense Units per order unit" S DA=PSADRG,DR="15" D ^DIE S 
 PSADUOU=$P(^PSDRUG(PSADRG,660),"^",5)
  
 After:
 ------
         I $P($G(^PSDRUG(PSADRG,660)),"^",5)'=$G(PSADUOU) W !,"Please enter the
 appropriate Dispense Units per order unit" S DIE="^PSDRUG(",DA=PSADRG,DR="15"
 D ^DIE S PSADUOU=$P(^PSDRUG(PSADRG,660),"^",5)
  
 Problem 2:
 Routine PSAVERA was modified at tag ASK to only subtract the quantity from the
 invoiced item if it exists in the Drug file (#50).
  
 Before:
 -------
         ;VMP OIFO BAY PINES;VGF;PSA*3.0*36
         S PSAAFTER=PSADRG,PSADRG=PSABEFOR W !,"Removing "_$G(PSAQTY)_" from
 "_PSABEFOR(1)
         S FMDATA=$P($G(^PSDRUG(PSADRG,660.1)),"^")-PSAQTY
         S DIE="^PSDRUG(",DA=PSADRG,DR="50////^S X="_FMDATA D ^DIE K FMDATA
         S PSADRG=PSAAFTER
  
 After:
 ------
  
         ;VMP OIFO BAY PINES;VGF;PSA*3.0*36
         S PSAAFTER=PSADRG,PSADRG=PSABEFOR
         I $D(^PSDRUG(PSADRG)) D
         .W !,"Removing "_$G(PSAQTY)_" from "_PSABEFOR(1)
         .S FMDATA=$P($G(^PSDRUG(PSADRG,660.1)),"^")-PSAQTY
         .S DIE="^PSDRUG(",DA=PSADRG,DR="50////^S X="_FMDATA D ^DIE K FMDATA
         S PSADRG=PSAAFTER
  
 DATA DICTIONARY CHANGES:
 ========================
 N/A
  
 TEMPLATES:
 ==========
 N/A
  
 ROUTINE SUMMARY:
 ================
 The following is a list of the routine(s) included in this patch.  The
 second line of each of these routine(s) will look like:
  
      <tab>;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**[patch list]**;
  10/24/97
  
                             CHECK^XTSUMBLD results
  Routine name      Before Patch          After Patch         Patch List
  ============      ============          ===========         ==========
  PSAVERA               26659488             26757127             21,36
  
  
 Total number of routines - 1
  
 DISTRIBUTION:
 =============  
 This patch is exported using KIDS.
  
 INSTALLATION INSTRUCTIONS:
 ==========================
 This patch can be installed during business hours, but because the option 
 will be out of service during the installation process it is suggested 
 that it be queued for non-peak hours.
 Installation will take less than 5 minutes.
  
   
 1. Use the INSTALL/CHECK MESSAGE option on the PackMan menu. [Note:
    TEXT PRINT/DISPLAY option in the PackMan menu will display the
    patch text only].
      
 2. From the Kernel Installation and Distribution System (KIDS)
    menu, select the Installation menu.
  
 3. From this menu, you may elect to use the following options:
    (when prompted for INSTALL NAME, enter PSA*3.0*36)
     
    a.  Backup a Transport Global - this option will create a backup
        message of any routines exported with the patch.  It will
        NOT backup any other changes such as DDs or templates.
    b.  Compare Transport Global to Current System  - this option
        will allow you to view all changes that will be made when
        the patch is installed.  It compares all components of the
        patch (routines, DDs, templates, etc.).
    c.  Verify Checksums in Transport Global - this option will
        allow you to ensure the integrity of the routines that are
        in the transport global.
    d.  Print Transport Global - this option will allow you to view
        the components of the KIDS build.
     
 4. Use the Install Package(s) option and select the package
    PSA*3.0*36
     
 5. When prompted 'Want KIDS to INHIBIT LOGONs during the install?
    YES//', respond NO
     
 6. When prompted 'Want to DISABLE Scheduled Options, Menu Options, and
    Protocols? YES//', respond YES.  When prompted to select the options
    you would like to place out of order, enter the following:
  
  PSA EDIT VERIFIED INVOICE Edit Verified Invoices
  
 7. If routines were unmapped as part of step 2 (DSM for Open VMS sites
    only), they should be returned to the mapped set once the installation 
    has run to completion.

Routine Information:
====================

Routine Name:
  - PSAVERA


Routine Checksum:

=============================================================================
User Information:
Entered By  : FRANCE,VENESSA                Date Entered  : NOV 04, 2003
Completed By: ANDERSON,MAXINE               Date Completed: MAR 05, 2004
Released By : LYTTLE,KIM M                  Date Released : MAR 08, 2004
=============================================================================


Packman Mail Message:
=====================

$END TXT
